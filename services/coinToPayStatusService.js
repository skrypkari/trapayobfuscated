'use strict';const a48_0xd8cc2b=a48_0x478a;function a48_0x1fec(){const _0x4fc6a1=['set','parse','üîç\x20[CHECK]\x20Checking\x20','expired','\x20\x20\x20Amount:\x20','\x20\x20\x20-\x20Status:\x20','ü™ô\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','\x20has\x20no\x20gatewayPaymentId,\x20skipping','paymentTimers','üè¶\x20[CHECK]\x20Saved\x20IBAN:\x20','SINGLE','paymentLink','\x20updated\x20successfully','ü™ô\x20[DEBUG]\x20Creating\x20','default',',\x20using\x20default\x20commission\x2010%','push','\x20with\x20status\x20','‚úÖ\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','amountAfterGatewayCommissionUSDT','\x20\x20\x20üìù\x20Details:','EXPIRY_DAYS','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','logCoinToPayError','\x20\x20\x20üìç\x20Source:\x20','‚úÖ\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','\x20individual\x20payment\x20timers','currency','status_check','toLowerCase','checkSinglePayment','No\x20specific\x20commission\x20found\x20for\x20gateway\x20','\x20not\x20found,\x20clearing\x20timers','type','üîç\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','ü™ô\x20[GLOBAL]\x20Found\x20','üßπ\x20[DEBUG]\x20Clearing\x20','checkExpiredPayments','‚úÖ\x20[COINTOPAY]\x20Payment\x20link\x20','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','‚è∞\x20[EXPIRY]\x20Payment\x20','timers','‚úÖ\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','\x20is\x20too\x20new\x20(','50eGiVVU','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','\x20in\x20shop\x20','customerName','CoinToPay2Service','getPaymentTimerInfo','transactionId','log','confirmedOn','webhookEvents','cointopay2','timestamp','getGatewayIdByName','now',',\x20using\x20default\x2010%','\x20->\x20','./currencyService','\x20days','__esModule','213975lvkbjC','stringify','cointopay','475558sqGhox','‚úÖ\x20[TIMER]\x20Individual\x20check\x20#','getServiceStats','ü™ô\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','webhookLog','update','toFixed','remitterIban','checkPaymentStatus','text','map','getGatewayCommission','coinToPayService','./gateways/coinToPay2Service','-day\x20timeout',',\x20stopping\x20individual\x20checks','../types/gateway','‚ùå\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','COINTOPAY_ERROR','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','./loggerService','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','payment','\x20skipped,\x20','amountUSDT','Payment\x20older\x20than\x20','clearPaymentTimers','‚úÖ\x20[CHECK]\x20Payment\x20',',\x20status=','get','\x20found:','5508930QXyNIJ','getTime','\x20completed\x20for\x20payment\x20','\x20(age:\x20','defineProperty','‚ùå\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','gateway','‚è∞\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','148zxiIPK','includes','iban','‚è∞\x20[DEBUG]\x20Scheduled\x20check\x20#','ü™ô\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','checkAllPendingPayments','toISOString','‚è∞\x20[HOURLY]\x20Payment\x20','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','\x20is\x20valid\x20for\x20checking,\x20proceeding...','üõë\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','6FDrSly','cointopay_status_check_error','\x20marked\x20as\x20paid\x20at:\x20','bankDetails','\x20\x20\x20üìÖ\x20Time:\x20','‚ùå\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','findUnique','schedule_created','POST','setDate','üìä\x20[CHECK]\x20Payment\x20','createdOn','sendPaymentNotification','üìä\x20[HOURLY]\x20Payment\x20','shopId','\x20USDT','PAID','‚úÖ\x20[EXPIRY]\x20Payment\x20','checkSinglePaymentById','COINTOPAY_STATUS_CHANGE','size','2037651CDRMKc','‚ùå\x20[HOURLY]\x20Payment\x20','sendShopWebhook','length','error','delete','\x20status:\x20','\x20\x20\x20Gateway\x20','paymentLinkId','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','from','FAILED','getDate','PENDING','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','35645HJLYWR','\x20to\x20','orderId','gatewayCommissionRate','üÜî\x20[CHECK]\x20Transaction\x20ID:\x20','gatewaySettings','CoinToPayService','payment.pending','\x20status\x20unchanged\x20(','\x20\x20\x20-\x20Gateway:\x20','paid','has','commission','findMany','üìä\x20[CHECK]\x20CoinToPay\x20payment\x20','‚è∞\x20[GLOBAL]\x20Found\x20','h),\x20skipping\x20global\x20check','\x20\x20\x20-\x20ShopId:\x20','Failed\x20to\x20send\x20shop\x20webhook:','\x20\x20\x20-\x20Amount:\x20','catch','üìà\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','Payment\x20not\x20found','5\x20minutes','üè¶\x20[CHECK]\x20Bank\x20details\x20provided:\x20','\x20details:','\x20not\x20found\x20in\x20database',':\x20type=','\x20(after\x20','../config/database','\x20\x20\x20-\x20gatewayPaymentId:\x20','sendPaymentStatusNotification','ü™ô\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','\x20amounts\x20calculated:','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','üîÑ\x20[CHECK]\x20Updating\x20payment\x20','./gateways/coinToPayService','\x20days\x20(created\x20before\x20','paymentDetails','üîç\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','convertToUSDT','logShopWebhookSent','EXPIRED','payment.failed','4368928PuVoJQ','\x20current\x20status:\x20','‚ö†Ô∏è\x20[CHECK]\x20Payment\x20','auto_expire','globalCheckInterval','currencyService','‚úÖ\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','\x20has\x20no\x20gatewayPaymentId','\x20seconds\x20(','üîç\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','7nSxwgx','forEach','\x20for\x20payment\x20','coinToPay2Service','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','application/json','telegramBotService','paidAt','\x20days,\x20marking\x20as\x20EXPIRED','created','payment.success','üìà\x20[COINTOPAY]\x20Payment\x20','cointopay_auto_expired','logCoinToPayStatus','‚è∞\x20[GLOBAL]\x20Payment\x20','loggerService','not\x20found','\x20pending\x20CoinToPay\x20payments','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','amount','coinToPayStatusService','shop','1163763bSpfDz','delay','\x20status\x20changed\x20to\x20','ms)','2\x20minutes','paymentId','\x20commission:\x20','‚ùå\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','\x20status\x20is\x20','values','\x20\x20\x20‚ùå\x20Error:\x20','schedulePaymentChecks','\x20initial\x20timers\x20for\x20payment\x20','checkPaymentById','createdAt','description','\x20updated:\x20currentPayments=','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','status','\x20not\x20enabled\x20for\x20shop\x20','\x20\x20\x20Amount\x20after\x20commission:\x20','Payment\x20System/1.0','\x20checked,\x20','üí∞\x20[CHECK]\x20Payment\x20','gatewayPaymentId','\x20\x20\x20üìä\x20Status:\x20','logWhiteDomainError','Unknown\x20error','entries','Gateway\x20','Success','create','ü™ô\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','webhookUrl','floor','startPeriodicStatusCheck','currentPayments','CoinToPayStatusService','\x20expired\x20CoinToPay\x20payments','üìä\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','\x20payment\x20','/status/','GLOBAL_CHECK_INTERVAL_MS','unknown','‚úÖ\x20[DEBUG]\x20Successfully\x20scheduled\x20','message'];a48_0x1fec=function(){return _0x4fc6a1;};return a48_0x1fec();}(function(_0x195ffd,_0xa4b899){const _0x5ecaa6=a48_0x478a,_0x51931c=_0x195ffd();while(!![]){try{const _0x50f686=parseInt(_0x5ecaa6(0xd3))/0x1*(parseInt(_0x5ecaa6(0x105))/0x2)+parseInt(_0x5ecaa6(0x175))/0x3+parseInt(_0x5ecaa6(0xfa))/0x4*(-parseInt(_0x5ecaa6(0x129))/0x5)+-parseInt(_0x5ecaa6(0xf2))/0x6+parseInt(_0x5ecaa6(0x15f))/0x7*(parseInt(_0x5ecaa6(0x155))/0x8)+parseInt(_0x5ecaa6(0xd0))/0x9*(-parseInt(_0x5ecaa6(0xbd))/0xa)+-parseInt(_0x5ecaa6(0x11a))/0xb;if(_0x50f686===_0xa4b899)break;else _0x51931c['push'](_0x51931c['shift']());}catch(_0x4bad3a){_0x51931c['push'](_0x51931c['shift']());}}}(a48_0x1fec,0xd58ab));function a48_0x478a(_0xe33364,_0x34acd1){_0xe33364=_0xe33364-0xa1;const _0x1feca6=a48_0x1fec();let _0x478ab1=_0x1feca6[_0xe33364];return _0x478ab1;}var __importDefault=this&&this['__importDefault']||function(_0x6d9a65){const _0x7e4e1e=a48_0x478a;return _0x6d9a65&&_0x6d9a65[_0x7e4e1e(0xcf)]?_0x6d9a65:{'default':_0x6d9a65};};Object[a48_0xd8cc2b(0xf6)](exports,'__esModule',{'value':!![]}),exports['coinToPayStatusService']=exports[a48_0xd8cc2b(0x19b)]=void 0x0;const coinToPayService_1=require(a48_0xd8cc2b(0x14d)),coinToPay2Service_1=require(a48_0xd8cc2b(0xe0)),gateway_1=require(a48_0xd8cc2b(0xe3)),database_1=__importDefault(require(a48_0xd8cc2b(0x146))),telegramBotService_1=require('./telegramBotService'),loggerService_1=require(a48_0xd8cc2b(0xe7)),currencyService_1=require(a48_0xd8cc2b(0xcd));class CoinToPayStatusService{constructor(){const _0x48de3c=a48_0xd8cc2b;this[_0x48de3c(0x159)]=null,this[_0x48de3c(0x1a0)]=0x3c*0x3c*0x3e8,this['EXPIRY_DAYS']=0x5,this[_0x48de3c(0x1ac)]=new Map(),this[_0x48de3c(0xdf)]=new coinToPayService_1[(_0x48de3c(0x12f))](),this['coinToPay2Service']=new coinToPay2Service_1[(_0x48de3c(0xc1))](),console[_0x48de3c(0xc4)](_0x48de3c(0x1aa));}[a48_0xd8cc2b(0x180)](_0x324ff3,_0x20abcb){const _0x58ea64=a48_0xd8cc2b;console[_0x58ea64(0xc4)]('ü™ô\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:'),console[_0x58ea64(0xc4)]('\x20\x20\x20-\x20paymentId:\x20'+_0x324ff3),console[_0x58ea64(0xc4)](_0x58ea64(0x147)+_0x20abcb),this[_0x58ea64(0xed)](_0x324ff3);const _0x43b19a=[],_0x4a64bc=new Date(),_0x47a47c=[{'delay':0x1*0x3c*0x3e8,'description':'1\x20minute'},{'delay':0x2*0x3c*0x3e8,'description':_0x58ea64(0x179)},{'delay':0x5*0x3c*0x3e8,'description':_0x58ea64(0x140)},{'delay':0x5*0x3c*0x3e8,'description':'5\x20minutes'}];console[_0x58ea64(0xc4)](_0x58ea64(0x1b1)+_0x47a47c['length']+_0x58ea64(0x181)+_0x324ff3);let _0x526e32=0x0;_0x47a47c[_0x58ea64(0x160)]((_0x57f460,_0x94f9b8)=>{const _0x4f7028=_0x58ea64;_0x526e32+=_0x57f460[_0x4f7028(0x176)];const _0x26dde9=setTimeout(async()=>{const _0x5cf5be=_0x4f7028;console['log']('ü™ô\x20[TIMER]\x20Individual\x20check\x20#'+(_0x94f9b8+0x1)+'\x20triggered\x20for\x20payment\x20'+_0x324ff3+_0x5cf5be(0x145)+_0x57f460['description']+')');try{await this[_0x5cf5be(0x117)](_0x324ff3),console['log'](_0x5cf5be(0xd4)+(_0x94f9b8+0x1)+_0x5cf5be(0xf4)+_0x324ff3);}catch(_0x3431f7){console[_0x5cf5be(0x11e)]('‚ùå\x20[TIMER]\x20Failed\x20individual\x20check\x20#'+(_0x94f9b8+0x1)+_0x5cf5be(0x161)+_0x324ff3+':',_0x3431f7),this[_0x5cf5be(0xa8)](_0x324ff3,_0x20abcb,_0x3431f7,_0x5cf5be(0xad),{'checkNumber':_0x94f9b8+0x1,'scheduledAfter':_0x57f460[_0x5cf5be(0x184)],'isIndividualCheck':!![]});}},_0x526e32);_0x43b19a['push'](_0x26dde9),console['log'](_0x4f7028(0xfd)+(_0x94f9b8+0x1)+_0x4f7028(0x161)+_0x324ff3+'\x20in\x20'+_0x526e32/0x3e8+_0x4f7028(0x15d)+_0x57f460[_0x4f7028(0x184)]+')');});const _0x5e2866=setInterval(async()=>{const _0x315ae5=_0x58ea64;console[_0x315ae5(0xc4)]('ü™ô\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20'+_0x324ff3);try{const _0x236c69=await database_1[_0x315ae5(0x1b2)]['payment'][_0x315ae5(0x10b)]({'where':{'id':_0x324ff3},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x236c69){console['log'](_0x315ae5(0x11b)+_0x324ff3+_0x315ae5(0xb1)),this[_0x315ae5(0xed)](_0x324ff3);return;}console[_0x315ae5(0xc4)](_0x315ae5(0x112)+_0x324ff3+_0x315ae5(0x156)+_0x236c69['status']);if(_0x236c69['status']!==_0x315ae5(0x127)){console[_0x315ae5(0xc4)]('‚úÖ\x20[HOURLY]\x20Payment\x20'+_0x324ff3+_0x315ae5(0x17d)+_0x236c69[_0x315ae5(0x188)]+_0x315ae5(0xe2)),this['clearPaymentTimers'](_0x324ff3);return;}const _0x334d3c=Math[_0x315ae5(0x198)]((Date[_0x315ae5(0xca)]()-_0x236c69[_0x315ae5(0x183)][_0x315ae5(0xf3)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x334d3c>=this['EXPIRY_DAYS']){console['log'](_0x315ae5(0x101)+_0x324ff3+'\x20is\x20older\x20than\x20'+this[_0x315ae5(0xa6)]+_0x315ae5(0x102)),this[_0x315ae5(0xed)](_0x324ff3);return;}await this[_0x315ae5(0x117)](_0x324ff3),console[_0x315ae5(0xc4)](_0x315ae5(0xaa)+_0x324ff3);}catch(_0x3a315b){console[_0x315ae5(0x11e)]('‚ùå\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20'+_0x324ff3+':',_0x3a315b),this[_0x315ae5(0xa8)](_0x324ff3,_0x20abcb,_0x3a315b,_0x315ae5(0xad),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x43b19a[_0x58ea64(0xa1)](_0x5e2866),this['paymentTimers'][_0x58ea64(0x1a4)](_0x324ff3,{'timers':_0x43b19a,'paymentId':_0x324ff3,'gatewayPaymentId':_0x20abcb,'createdAt':_0x4a64bc}),console[_0x58ea64(0xc4)](_0x58ea64(0x1a2)+_0x47a47c[_0x58ea64(0x11d)]+_0x58ea64(0x187)+_0x324ff3),console[_0x58ea64(0xc4)](_0x58ea64(0x19d)+this[_0x58ea64(0x1ac)][_0x58ea64(0x119)]),this[_0x58ea64(0x16c)](_0x324ff3,_0x20abcb,_0x58ea64(0x127),'PENDING',_0x58ea64(0xad),{'action':_0x58ea64(0x10c),'scheduledChecks':_0x47a47c[_0x58ea64(0x11d)],'firstCheckIn':_0x47a47c[0x0][_0x58ea64(0x176)]/0x3e8,'totalTimers':this[_0x58ea64(0x1ac)][_0x58ea64(0x119)]});}[a48_0xd8cc2b(0xed)](_0xd2784b){const _0x46d1cb=a48_0xd8cc2b,_0x54b33e=this['paymentTimers'][_0x46d1cb(0xf0)](_0xd2784b);_0x54b33e?(console['log'](_0x46d1cb(0xb5)+_0x54b33e[_0x46d1cb(0xba)][_0x46d1cb(0x11d)]+'\x20timers\x20for\x20payment\x20'+_0xd2784b),_0x54b33e[_0x46d1cb(0xba)][_0x46d1cb(0x160)]((_0x165c97,_0x425e81)=>{const _0x1ce701=_0x46d1cb;_0x165c97&&(clearTimeout(_0x165c97),clearInterval(_0x165c97),console[_0x1ce701(0xc4)]('üßπ\x20[DEBUG]\x20Cleared\x20timer\x20#'+(_0x425e81+0x1)+_0x1ce701(0x161)+_0xd2784b));}),this[_0x46d1cb(0x1ac)][_0x46d1cb(0x11f)](_0xd2784b),console['log'](_0x46d1cb(0x15b)+_0xd2784b+'.\x20Remaining\x20active\x20timers:\x20'+this[_0x46d1cb(0x1ac)][_0x46d1cb(0x119)])):console[_0x46d1cb(0xc4)]('‚ö†Ô∏è\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20'+_0xd2784b+'\x20to\x20clear');}async['checkSinglePaymentById'](_0x4aa36f){const _0x3cc46f=a48_0xd8cc2b;console[_0x3cc46f(0xc4)](_0x3cc46f(0x150)+_0x4aa36f);const _0xac9001=await database_1[_0x3cc46f(0x1b2)]['payment'][_0x3cc46f(0x10b)]({'where':{'id':_0x4aa36f},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0xac9001){console['log']('‚ùå\x20[CHECK]\x20Payment\x20'+_0x4aa36f+_0x3cc46f(0x143));return;}console[_0x3cc46f(0xc4)]('üìä\x20[CHECK]\x20Payment\x20'+_0x4aa36f+_0x3cc46f(0xf1)),console[_0x3cc46f(0xc4)](_0x3cc46f(0x132)+_0xac9001[_0x3cc46f(0xf8)]),console[_0x3cc46f(0xc4)](_0x3cc46f(0x1a9)+_0xac9001[_0x3cc46f(0x188)]),console[_0x3cc46f(0xc4)]('\x20\x20\x20-\x20GatewayPaymentId:\x20'+_0xac9001['gatewayPaymentId']),console[_0x3cc46f(0xc4)](_0x3cc46f(0x13c)+_0xac9001[_0x3cc46f(0x172)]+'\x20'+_0xac9001[_0x3cc46f(0xac)]),console[_0x3cc46f(0xc4)](_0x3cc46f(0x13a)+_0xac9001[_0x3cc46f(0x113)]);if(_0xac9001[_0x3cc46f(0xf8)]!==_0x3cc46f(0xd2)&&_0xac9001[_0x3cc46f(0xf8)]!==_0x3cc46f(0xc7)){console[_0x3cc46f(0xc4)](_0x3cc46f(0x157)+_0x4aa36f+_0x3cc46f(0x186)+_0xac9001[_0x3cc46f(0xf8)]+')');return;}if(_0xac9001[_0x3cc46f(0x188)]!==_0x3cc46f(0x127)){console[_0x3cc46f(0xc4)]('‚ö†Ô∏è\x20[CHECK]\x20Payment\x20'+_0x4aa36f+_0x3cc46f(0x17d)+_0xac9001[_0x3cc46f(0x188)]+_0x3cc46f(0xe2)),this[_0x3cc46f(0xed)](_0x4aa36f);return;}if(!_0xac9001[_0x3cc46f(0x18e)]){console['log'](_0x3cc46f(0x157)+_0x4aa36f+_0x3cc46f(0x15c));return;}console[_0x3cc46f(0xc4)]('‚úÖ\x20[CHECK]\x20Payment\x20'+_0x4aa36f+_0x3cc46f(0x103)),await this[_0x3cc46f(0xaf)](_0xac9001);}['logCoinToPayStatus'](_0x56c170,_0x4d6562,_0x5c65f1,_0x5e6ae1,_0x217b89,_0x4c8b1e){const _0x2c9533=a48_0xd8cc2b,_0x530e51={'type':_0x2c9533(0x118),'paymentId':_0x56c170,'gatewayPaymentId':_0x4d6562,'oldStatus':_0x5c65f1,'newStatus':_0x5e6ae1,'source':_0x217b89,'timestamp':new Date()[_0x2c9533(0x100)](),'details':_0x4c8b1e||{}};loggerService_1[_0x2c9533(0x16e)][_0x2c9533(0x16c)](_0x530e51),console[_0x2c9533(0xc4)](_0x2c9533(0xd6)+_0x56c170+'\x20('+_0x4d6562+')'),console[_0x2c9533(0xc4)](_0x2c9533(0x18f)+_0x5c65f1+_0x2c9533(0xcc)+_0x5e6ae1),console[_0x2c9533(0xc4)](_0x2c9533(0xa9)+_0x217b89),console[_0x2c9533(0xc4)](_0x2c9533(0x109)+_0x530e51['timestamp']),_0x4c8b1e&&console['log'](_0x2c9533(0xa5),_0x4c8b1e);}[a48_0xd8cc2b(0xa8)](_0x3fce60,_0x121a0c,_0x53915c,_0x4dbacc,_0x202d61){const _0x1eba15=a48_0xd8cc2b,_0x44f396={'type':_0x1eba15(0xe5),'paymentId':_0x3fce60,'gatewayPaymentId':_0x121a0c,'error':_0x53915c instanceof Error?{'message':_0x53915c[_0x1eba15(0x1a3)],'stack':_0x53915c['stack']}:_0x53915c,'source':_0x4dbacc,'timestamp':new Date()['toISOString'](),'context':_0x202d61||{}};loggerService_1[_0x1eba15(0x16e)][_0x1eba15(0xa8)](_0x44f396),console[_0x1eba15(0x11e)]('ü™ô\x20[ERROR]\x20CoinToPay\x20Error:\x20'+_0x3fce60+'\x20('+_0x121a0c+')'),console[_0x1eba15(0x11e)](_0x1eba15(0x17f)+(_0x53915c instanceof Error?_0x53915c[_0x1eba15(0x1a3)]:_0x53915c)),console[_0x1eba15(0x11e)](_0x1eba15(0xa9)+_0x4dbacc),console['error'](_0x1eba15(0x109)+_0x44f396[_0x1eba15(0xc8)]),_0x202d61&&console['error']('\x20\x20\x20üìù\x20Context:',_0x202d61);}[a48_0xd8cc2b(0x199)](){const _0xa616b6=a48_0xd8cc2b;console['log']('ü™ô\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)'),this[_0xa616b6(0xff)]()[_0xa616b6(0x13d)](_0xfebcd6=>{const _0x585e5a=_0xa616b6;console[_0x585e5a(0x11e)](_0x585e5a(0xf7),_0xfebcd6);}),this[_0xa616b6(0x159)]=setInterval(async()=>{const _0x3522db=_0xa616b6;try{console[_0x3522db(0xc4)](_0x3522db(0x149)),await this[_0x3522db(0xff)](),console[_0x3522db(0xc4)](_0x3522db(0xbe));}catch(_0x3440cc){console[_0x3522db(0x11e)](_0x3522db(0xe4),_0x3440cc);}},this['GLOBAL_CHECK_INTERVAL_MS']),console[_0xa616b6(0xc4)](_0xa616b6(0xa3));}['stopPeriodicStatusCheck'](){const _0x453228=a48_0xd8cc2b;console['log']('üõë\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...');this[_0x453228(0x159)]&&(clearInterval(this[_0x453228(0x159)]),this[_0x453228(0x159)]=null,console[_0x453228(0xc4)](_0x453228(0x104)));const _0x29f4e1=this[_0x453228(0x1ac)][_0x453228(0x119)];for(const [_0x2db27a]of this[_0x453228(0x1ac)]){this[_0x453228(0xed)](_0x2db27a);}console[_0x453228(0xc4)]('üõë\x20[SHUTDOWN]\x20Cleared\x20'+_0x29f4e1+_0x453228(0xab));}async[a48_0xd8cc2b(0xff)](){const _0x2e8fbe=a48_0xd8cc2b;try{console['log'](_0x2e8fbe(0xfe));const _0x1d9aca=await database_1[_0x2e8fbe(0x1b2)]['payment'][_0x2e8fbe(0x136)]({'where':{'gateway':{'in':[_0x2e8fbe(0xd2),_0x2e8fbe(0xc7)]},'status':_0x2e8fbe(0x127),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console['log'](_0x2e8fbe(0xb4)+_0x1d9aca[_0x2e8fbe(0x11d)]+_0x2e8fbe(0x170));if(_0x1d9aca[_0x2e8fbe(0x11d)]===0x0){console[_0x2e8fbe(0xc4)](_0x2e8fbe(0x196));return;}const _0xd77a54=await this[_0x2e8fbe(0xb6)](_0x1d9aca);console[_0x2e8fbe(0xc4)](_0x2e8fbe(0x138)+_0xd77a54[_0x2e8fbe(0x11d)]+_0x2e8fbe(0x19c));let _0x4639d4=0x0,_0x4dfbfe=0x0;for(const _0x3b7cb2 of _0x1d9aca){try{if(_0xd77a54[_0x2e8fbe(0xfb)](_0x3b7cb2['id'])){console[_0x2e8fbe(0xc4)](_0x2e8fbe(0x16d)+_0x3b7cb2['id']+_0x2e8fbe(0x171)),_0x4dfbfe++;continue;}if(this[_0x2e8fbe(0x1ac)][_0x2e8fbe(0x134)](_0x3b7cb2['id'])){console['log'](_0x2e8fbe(0x16d)+_0x3b7cb2['id']+_0x2e8fbe(0x123)),_0x4dfbfe++;continue;}const _0x322c3d=(Date[_0x2e8fbe(0xca)]()-_0x3b7cb2[_0x2e8fbe(0x183)]['getTime']())/(0x3e8*0x3c*0x3c);if(_0x322c3d<0x1){console[_0x2e8fbe(0xc4)](_0x2e8fbe(0x16d)+_0x3b7cb2['id']+_0x2e8fbe(0xbc)+_0x322c3d[_0x2e8fbe(0xd9)](0x1)+_0x2e8fbe(0x139)),_0x4dfbfe++;continue;}console[_0x2e8fbe(0xc4)](_0x2e8fbe(0xb3)+_0x3b7cb2['id']+_0x2e8fbe(0xf5)+_0x322c3d['toFixed'](0x1)+'h)'),await this[_0x2e8fbe(0xaf)](_0x3b7cb2),_0x4639d4++,await new Promise(_0x45d8c6=>setTimeout(_0x45d8c6,0x7d0));}catch(_0x2921d6){console[_0x2e8fbe(0x11e)]('‚ùå\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20'+_0x3b7cb2['id']+':',_0x2921d6),this['logCoinToPayError'](_0x3b7cb2['id'],_0x3b7cb2[_0x2e8fbe(0x18e)]||_0x2e8fbe(0x1a1),_0x2921d6,_0x2e8fbe(0xad),{'isGlobalCheck':!![],'paymentAmount':_0x3b7cb2[_0x2e8fbe(0x172)],'paymentCurrency':_0x3b7cb2[_0x2e8fbe(0xac)],'shopId':_0x3b7cb2[_0x2e8fbe(0x113)],'createdAt':_0x3b7cb2[_0x2e8fbe(0x183)]}),loggerService_1[_0x2e8fbe(0x16e)][_0x2e8fbe(0x190)](_0x2e8fbe(0xd2),_0x2e8fbe(0x19f)+_0x3b7cb2[_0x2e8fbe(0x18e)],_0x2921d6);}}console[_0x2e8fbe(0xc4)](_0x2e8fbe(0xa7)+_0x4639d4+_0x2e8fbe(0x18c)+_0x4dfbfe+_0x2e8fbe(0xea)+_0xd77a54['length']+'\x20expired');}catch(_0x6e58f7){console['error'](_0x2e8fbe(0x14b),_0x6e58f7);}}async['checkExpiredPayments'](_0x1574a6){const _0x228d92=a48_0xd8cc2b,_0x3e9f85=[],_0x2d1afe=new Date();_0x2d1afe[_0x228d92(0x10e)](_0x2d1afe[_0x228d92(0x126)]()-this[_0x228d92(0xa6)]),console[_0x228d92(0xc4)](_0x228d92(0xf9)+this[_0x228d92(0xa6)]+_0x228d92(0x14e)+_0x2d1afe[_0x228d92(0x100)]()+')');for(const _0x265a85 of _0x1574a6){if(_0x265a85[_0x228d92(0x183)]<_0x2d1afe){console[_0x228d92(0xc4)](_0x228d92(0xb9)+_0x265a85['id']+'\x20is\x20older\x20than\x20'+this[_0x228d92(0xa6)]+_0x228d92(0x167));try{this[_0x228d92(0x16c)](_0x265a85['id'],_0x265a85[_0x228d92(0x18e)]||'unknown','PENDING',_0x228d92(0x153),_0x228d92(0x158),{'reason':_0x228d92(0xec)+this[_0x228d92(0xa6)]+_0x228d92(0xce),'createdAt':_0x265a85[_0x228d92(0x183)],'daysSinceCreation':Math['floor']((Date['now']()-_0x265a85[_0x228d92(0x183)][_0x228d92(0xf3)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x265a85[_0x228d92(0x172)],'paymentCurrency':_0x265a85[_0x228d92(0xac)],'shopId':_0x265a85[_0x228d92(0x113)]}),await database_1[_0x228d92(0x1b2)][_0x228d92(0xe9)][_0x228d92(0xd8)]({'where':{'id':_0x265a85['id']},'data':{'status':_0x228d92(0x153),'updatedAt':new Date()}}),await database_1[_0x228d92(0x1b2)][_0x228d92(0xd7)][_0x228d92(0x195)]({'data':{'paymentId':_0x265a85['id'],'shopId':_0x265a85[_0x228d92(0x113)],'event':_0x228d92(0x16b),'statusCode':0xc8,'responseBody':JSON[_0x228d92(0xd1)]({'reason':'Payment\x20older\x20than\x20'+this[_0x228d92(0xa6)]+_0x228d92(0xce),'createdAt':_0x265a85[_0x228d92(0x183)],'expiredAt':new Date()['toISOString'](),'daysSinceCreation':Math[_0x228d92(0x198)]((Date[_0x228d92(0xca)]()-_0x265a85[_0x228d92(0x183)]['getTime']())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x228d92(0x11c)](_0x265a85,_0x228d92(0x153)),await this[_0x228d92(0x148)](_0x265a85,_0x228d92(0x153)),this[_0x228d92(0xed)](_0x265a85['id']),_0x3e9f85[_0x228d92(0xa1)](_0x265a85['id']),console[_0x228d92(0xc4)](_0x228d92(0x116)+_0x265a85['id']+'\x20marked\x20as\x20EXPIRED\x20due\x20to\x20'+this[_0x228d92(0xa6)]+_0x228d92(0xe1));}catch(_0x472a6c){console[_0x228d92(0x11e)](_0x228d92(0x17c)+_0x265a85['id']+':',_0x472a6c),this['logCoinToPayError'](_0x265a85['id'],_0x265a85[_0x228d92(0x18e)]||_0x228d92(0x1a1),_0x472a6c,_0x228d92(0x158),{'reason':'Failed\x20to\x20mark\x20payment\x20as\x20expired','createdAt':_0x265a85[_0x228d92(0x183)],'daysSinceCreation':Math[_0x228d92(0x198)]((Date[_0x228d92(0xca)]()-_0x265a85['createdAt'][_0x228d92(0xf3)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x3e9f85;}async['checkSinglePayment'](_0x22de9f){const _0xa27335=a48_0xd8cc2b;if(!_0x22de9f[_0xa27335(0x18e)]){console[_0xa27335(0xc4)](_0xa27335(0x157)+_0x22de9f['id']+_0xa27335(0x1ab));return;}console[_0xa27335(0xc4)](_0xa27335(0x1a6)+_0x22de9f['gateway']+'\x20payment\x20'+_0x22de9f['id']+'\x20('+_0x22de9f[_0xa27335(0x18e)]+')');try{let _0x202c0e;_0x22de9f[_0xa27335(0xf8)]===_0xa27335(0xc7)?(_0x202c0e=await this[_0xa27335(0x162)]['checkPaymentStatus'](_0x22de9f[_0xa27335(0x18e)]),console[_0xa27335(0xc4)]('üìä\x20[CHECK]\x20CoinToPay2\x20payment\x20'+_0x22de9f['id']+'\x20status:\x20'+_0x202c0e[_0xa27335(0x188)])):(_0x202c0e=await this[_0xa27335(0xdf)][_0xa27335(0xdb)](_0x22de9f['gatewayPaymentId']),console[_0xa27335(0xc4)](_0xa27335(0x137)+_0x22de9f['id']+_0xa27335(0x120)+_0x202c0e[_0xa27335(0x188)]));_0x202c0e[_0xa27335(0x14f)]&&console[_0xa27335(0xc4)](_0xa27335(0x10f)+_0x22de9f['id']+_0xa27335(0x142),{'iban':_0x202c0e[_0xa27335(0x14f)][_0xa27335(0xfc)]||_0xa27335(0x16f),'transactionId':_0x202c0e[_0xa27335(0x14f)][_0xa27335(0xc3)],'createdOn':_0x202c0e[_0xa27335(0x14f)][_0xa27335(0x110)],'confirmedOn':_0x202c0e[_0xa27335(0x14f)][_0xa27335(0xc5)]||'not\x20confirmed'});if(_0x202c0e[_0xa27335(0x188)]!==_0x22de9f[_0xa27335(0x188)]){console[_0xa27335(0xc4)](_0xa27335(0x14c)+_0x22de9f['id']+'\x20status\x20from\x20'+_0x22de9f[_0xa27335(0x188)]+_0xa27335(0x12a)+_0x202c0e['status']),this[_0xa27335(0x16c)](_0x22de9f['id'],_0x22de9f['gatewayPaymentId'],_0x22de9f[_0xa27335(0x188)],_0x202c0e[_0xa27335(0x188)],_0xa27335(0xad),{'paymentDetails':_0x202c0e[_0xa27335(0x14f)],'amount':_0x202c0e[_0xa27335(0x172)],'currency':_0x202c0e['currency'],'shopId':_0x22de9f['shopId'],'checkTimestamp':new Date()[_0xa27335(0x100)]()});const _0x47fba5={'status':_0x202c0e[_0xa27335(0x188)],'updatedAt':new Date()};if(_0x202c0e[_0xa27335(0x188)]==='PAID'&&_0x22de9f['status']!==_0xa27335(0x115)){_0x47fba5[_0xa27335(0x166)]=new Date();if(!_0x22de9f['amountUSDT']){const _0x2f7401=await currencyService_1[_0xa27335(0x15a)][_0xa27335(0x151)](_0x22de9f['amount'],_0x22de9f[_0xa27335(0xac)]);_0x47fba5[_0xa27335(0xeb)]=_0x2f7401;const _0x52c4fe=await this[_0xa27335(0xde)](_0x22de9f[_0xa27335(0x113)],_0x22de9f[_0xa27335(0xf8)]),_0x3fc5a5=_0x2f7401*(0x1-_0x52c4fe/0x64);_0x47fba5[_0xa27335(0xa4)]=_0x3fc5a5,_0x47fba5[_0xa27335(0x12c)]=_0x52c4fe,console[_0xa27335(0xc4)](_0xa27335(0x18d)+_0x22de9f['id']+_0xa27335(0x14a)),console[_0xa27335(0xc4)](_0xa27335(0x1a8)+_0x22de9f[_0xa27335(0x172)]+'\x20'+_0x22de9f[_0xa27335(0xac)]+'\x20->\x20'+_0x2f7401['toFixed'](0x6)+_0xa27335(0x114)),console[_0xa27335(0xc4)](_0xa27335(0x121)+_0x22de9f[_0xa27335(0xf8)]+_0xa27335(0x17b)+_0x52c4fe+'%'),console['log'](_0xa27335(0x18a)+_0x3fc5a5[_0xa27335(0xd9)](0x6)+'\x20USDT');}console[_0xa27335(0xc4)](_0xa27335(0x18d)+_0x22de9f['id']+_0xa27335(0x107)+_0x47fba5[_0xa27335(0x166)][_0xa27335(0x100)]());}if(_0x202c0e[_0xa27335(0x14f)]){const _0x56659d=_0x202c0e[_0xa27335(0x14f)];_0x56659d[_0xa27335(0xfc)]&&(_0x47fba5[_0xa27335(0xda)]=_0x56659d[_0xa27335(0xfc)],console[_0xa27335(0xc4)](_0xa27335(0x1ad)+_0x56659d[_0xa27335(0xfc)])),_0x56659d[_0xa27335(0x108)]&&console[_0xa27335(0xc4)](_0xa27335(0x141)+_0x56659d['bankDetails']),_0x56659d[_0xa27335(0xc3)]&&console[_0xa27335(0xc4)](_0xa27335(0x12d)+_0x56659d[_0xa27335(0xc3)]),_0x56659d[_0xa27335(0xc5)]&&console[_0xa27335(0xc4)]('‚úÖ\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20'+_0x56659d[_0xa27335(0xc5)]);}await database_1[_0xa27335(0x1b2)][_0xa27335(0xe9)][_0xa27335(0xd8)]({'where':{'id':_0x22de9f['id']},'data':_0x47fba5});if(_0x202c0e[_0xa27335(0x188)]===_0xa27335(0x115)&&_0x22de9f['status']!=='PAID'){console[_0xa27335(0xc4)](_0xa27335(0x16a)+_0x22de9f['id']+_0xa27335(0xe6));const _0x5483a3=await database_1[_0xa27335(0x1b2)]['payment']['findUnique']({'where':{'id':_0x22de9f['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x5483a3?.[_0xa27335(0x122)]&&_0x5483a3[_0xa27335(0x1af)])try{const _0x22a8c4=_0x5483a3[_0xa27335(0x1af)];console['log'](_0xa27335(0x13e)+_0x22a8c4['id']+_0xa27335(0x144)+_0x22a8c4[_0xa27335(0xb2)]+',\x20currentPayments='+_0x22a8c4[_0xa27335(0x19a)]+',\x20status='+_0x22a8c4[_0xa27335(0x188)]);const _0x48c2fd=_0x22a8c4['currentPayments']+0x1,_0xf6ce56=_0x22a8c4['type']===_0xa27335(0x1ae)?'COMPLETED':_0x22a8c4[_0xa27335(0x188)];await database_1[_0xa27335(0x1b2)]['paymentLink']['update']({'where':{'id':_0x22a8c4['id']},'data':{'currentPayments':_0x48c2fd,'status':_0xf6ce56,'updatedAt':new Date()}}),console['log'](_0xa27335(0xb7)+_0x22a8c4['id']+_0xa27335(0x185)+_0x22a8c4[_0xa27335(0x19a)]+_0xa27335(0xcc)+_0x48c2fd+_0xa27335(0xef)+_0x22a8c4['status']+_0xa27335(0xcc)+_0xf6ce56);}catch(_0x3ca59c){console['error'](_0xa27335(0x10a),_0x3ca59c);}else console[_0xa27335(0xc4)]('üìà\x20[COINTOPAY]\x20Payment\x20'+_0x22de9f['id']+_0xa27335(0xb8));}await database_1[_0xa27335(0x1b2)]['webhookLog'][_0xa27335(0x195)]({'data':{'paymentId':_0x22de9f['id'],'shopId':_0x22de9f['shopId'],'event':'cointopay_status_check_'+_0x202c0e[_0xa27335(0x188)][_0xa27335(0xae)](),'statusCode':0xc8,'responseBody':JSON[_0xa27335(0xd1)]({'oldStatus':_0x22de9f[_0xa27335(0x188)],'newStatus':_0x202c0e['status'],'paymentDetails':_0x202c0e[_0xa27335(0x14f)],'checkedAt':new Date()[_0xa27335(0x100)]()})}}),await this[_0xa27335(0x11c)](_0x22de9f,_0x202c0e[_0xa27335(0x188)]),await this[_0xa27335(0x148)](_0x22de9f,_0x202c0e[_0xa27335(0x188)]),_0x202c0e[_0xa27335(0x188)]!==_0xa27335(0x127)&&(console[_0xa27335(0xc4)]('üßπ\x20[CHECK]\x20Payment\x20'+_0x22de9f['id']+_0xa27335(0x177)+_0x202c0e['status']+',\x20clearing\x20individual\x20timers'),this[_0xa27335(0xed)](_0x22de9f['id'])),console[_0xa27335(0xc4)](_0xa27335(0xee)+_0x22de9f['id']+_0xa27335(0x1b0));}else console['log'](_0xa27335(0x10f)+_0x22de9f['id']+_0xa27335(0x131)+_0x202c0e[_0xa27335(0x188)]+')'),this[_0xa27335(0x16c)](_0x22de9f['id'],_0x22de9f[_0xa27335(0x18e)],_0x22de9f[_0xa27335(0x188)],_0x202c0e[_0xa27335(0x188)],_0xa27335(0xad),{'statusUnchanged':!![],'paymentDetails':_0x202c0e[_0xa27335(0x14f)],'amount':_0x202c0e['amount'],'currency':_0x202c0e['currency'],'shopId':_0x22de9f['shopId'],'checkTimestamp':new Date()[_0xa27335(0x100)]()});}catch(_0x1d4f90){console[_0xa27335(0x11e)]('‚ùå\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20'+_0x22de9f['id']+':',_0x1d4f90),this[_0xa27335(0xa8)](_0x22de9f['id'],_0x22de9f['gatewayPaymentId'],_0x1d4f90,'status_check',{'paymentAmount':_0x22de9f[_0xa27335(0x172)],'paymentCurrency':_0x22de9f['currency'],'shopId':_0x22de9f[_0xa27335(0x113)],'createdAt':_0x22de9f[_0xa27335(0x183)]}),await database_1[_0xa27335(0x1b2)][_0xa27335(0xd7)][_0xa27335(0x195)]({'data':{'paymentId':_0x22de9f['id'],'shopId':_0x22de9f[_0xa27335(0x113)],'event':_0xa27335(0x106),'statusCode':0x1f4,'responseBody':JSON[_0xa27335(0xd1)]({'error':_0x1d4f90 instanceof Error?_0x1d4f90[_0xa27335(0x1a3)]:_0xa27335(0x191),'gatewayPaymentId':_0x22de9f['gatewayPaymentId'],'checkedAt':new Date()[_0xa27335(0x100)]()})}});}}async[a48_0xd8cc2b(0x11c)](_0x287fa1,_0x2a9b62){const _0x3f39b4=a48_0xd8cc2b,_0x192a84=Date[_0x3f39b4(0xca)]();try{const _0x2f8303=_0x287fa1[_0x3f39b4(0x174)],_0x43d0e6=_0x2f8303['settings'];if(!_0x43d0e6?.[_0x3f39b4(0x197)]){console['log'](_0x3f39b4(0x128)+_0x2f8303['id']);return;}const _0x4a1d60=_0x2a9b62==='PAID'?_0x3f39b4(0x169):_0x2a9b62===_0x3f39b4(0x125)?_0x3f39b4(0x154):_0x2a9b62==='EXPIRED'?_0x3f39b4(0x154):_0x3f39b4(0x130);if(!_0x43d0e6[_0x3f39b4(0xc6)]?.[_0x3f39b4(0xfb)](_0x4a1d60)){console['log']('Webhook\x20event\x20'+_0x4a1d60+_0x3f39b4(0x189)+_0x2f8303['id']);return;}const _0x3e785d=(0x0,gateway_1[_0x3f39b4(0xc9)])(_0x287fa1['gateway'])||_0x287fa1[_0x3f39b4(0xf8)],_0x5ac795={'event':_0x4a1d60,'payment':{'id':_0x287fa1['id'],'order_id':_0x287fa1[_0x3f39b4(0x12b)],'gateway_order_id':_0x287fa1['gatewayOrderId'],'gateway':_0x3e785d,'amount':_0x287fa1[_0x3f39b4(0x172)],'currency':_0x287fa1['currency'],'status':_0x2a9b62[_0x3f39b4(0xae)](),'customer_email':_0x287fa1['customerEmail'],'customer_name':_0x287fa1[_0x3f39b4(0xc0)],'created_at':_0x287fa1[_0x3f39b4(0x183)],'updated_at':new Date()}},_0x3e14d9=await fetch(_0x43d0e6[_0x3f39b4(0x197)],{'method':_0x3f39b4(0x10d),'headers':{'Content-Type':_0x3f39b4(0x164),'User-Agent':_0x3f39b4(0x18b)},'body':JSON[_0x3f39b4(0xd1)](_0x5ac795)}),_0x37b795=Date[_0x3f39b4(0xca)]()-_0x192a84,_0x58ea38=_0x3e14d9['ok']?_0x3f39b4(0x194):await _0x3e14d9[_0x3f39b4(0xdc)]();loggerService_1['loggerService'][_0x3f39b4(0x152)](_0x287fa1[_0x3f39b4(0x113)],_0x43d0e6[_0x3f39b4(0x197)],_0x4a1d60,_0x3e14d9[_0x3f39b4(0x188)],_0x37b795,_0x5ac795),console[_0x3f39b4(0xc4)]('Shop\x20webhook\x20sent\x20to\x20'+_0x43d0e6['webhookUrl']+_0x3f39b4(0xa2)+_0x3e14d9[_0x3f39b4(0x188)]+'\x20('+_0x37b795+_0x3f39b4(0x178));}catch(_0x4fbba2){console[_0x3f39b4(0x11e)](_0x3f39b4(0x13b),_0x4fbba2),loggerService_1[_0x3f39b4(0x16e)]['logShopWebhookError'](_0x287fa1[_0x3f39b4(0x113)],_0x287fa1[_0x3f39b4(0x174)]?.['settings']?.['webhookUrl']||'unknown','webhook_send',_0x4fbba2,{});}}async[a48_0xd8cc2b(0x148)](_0x191e6c,_0x4de8c5){const _0x5199e9=a48_0xd8cc2b;try{const _0x5df1ca={'PENDING':_0x5199e9(0x168),'PAID':_0x5199e9(0x133),'FAILED':'failed','EXPIRED':_0x5199e9(0x1a7)},_0x323064=_0x5df1ca[_0x4de8c5];if(!_0x323064||_0x323064===_0x5199e9(0x168))return;await telegramBotService_1[_0x5199e9(0x165)][_0x5199e9(0x111)](_0x191e6c[_0x5199e9(0x113)],_0x191e6c,_0x323064);}catch(_0x13ac26){console[_0x5199e9(0x11e)]('Failed\x20to\x20send\x20Telegram\x20payment\x20notification:',_0x13ac26);}}async[a48_0xd8cc2b(0x182)](_0x409b9c){const _0x4a379f=a48_0xd8cc2b;console[_0x4a379f(0xc4)](_0x4a379f(0x15e)+_0x409b9c);const _0x31bb4=await database_1[_0x4a379f(0x1b2)][_0x4a379f(0xe9)][_0x4a379f(0x10b)]({'where':{'id':_0x409b9c},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x31bb4)throw new Error(_0x4a379f(0x13f));if(_0x31bb4[_0x4a379f(0xf8)]!==_0x4a379f(0xd2)&&_0x31bb4[_0x4a379f(0xf8)]!==_0x4a379f(0xc7))throw new Error(_0x4a379f(0xe8));console[_0x4a379f(0xc4)](_0x4a379f(0xbb)+_0x31bb4[_0x4a379f(0xf8)]+_0x4a379f(0x19e)+_0x409b9c),await this[_0x4a379f(0xaf)](_0x31bb4),console[_0x4a379f(0xc4)]('‚úÖ\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20'+_0x409b9c);}[a48_0xd8cc2b(0xd5)](){const _0x462875=a48_0xd8cc2b,_0x32dc8a=this[_0x462875(0x159)]?this[_0x462875(0x1a0)]:undefined,_0x175275=Array[_0x462875(0x124)](this['paymentTimers'][_0x462875(0x17e)]())[_0x462875(0xdd)](_0x559227=>({'paymentId':_0x559227[_0x462875(0x17a)],'gatewayPaymentId':_0x559227[_0x462875(0x18e)],'createdAt':_0x559227['createdAt'],'timersCount':_0x559227[_0x462875(0xba)][_0x462875(0x11d)]}));return{'isActive':!!this[_0x462875(0x159)],'globalCheckIntervalMinutes':this[_0x462875(0x1a0)]/(0x3e8*0x3c),'expiryDays':this[_0x462875(0xa6)],'activeIndividualTimers':this[_0x462875(0x1ac)][_0x462875(0x119)],'nextGlobalCheckIn':_0x32dc8a,'paymentTimersDetails':_0x175275};}[a48_0xd8cc2b(0xc2)](_0x27f535){const _0x413247=a48_0xd8cc2b,_0x438c9e=this['paymentTimers'][_0x413247(0xf0)](_0x27f535);if(_0x438c9e)return{'hasTimers':!![],'timersCount':_0x438c9e['timers']['length'],'createdAt':_0x438c9e[_0x413247(0x183)],'gatewayPaymentId':_0x438c9e[_0x413247(0x18e)]};return{'hasTimers':![]};}async[a48_0xd8cc2b(0xde)](_0x337520,_0x27476a){const _0x4232e2=a48_0xd8cc2b;try{const _0x4824f1=await database_1[_0x4232e2(0x1b2)][_0x4232e2(0x174)][_0x4232e2(0x10b)]({'where':{'id':_0x337520},'select':{'gatewaySettings':!![]}});if(!_0x4824f1?.['gatewaySettings'])return console['log'](_0x4232e2(0x163)+_0x337520+_0x4232e2(0x1b3)),0xa;const _0x503436=JSON[_0x4232e2(0x1a5)](_0x4824f1[_0x4232e2(0x12e)]);for(const [_0x3f61ca,_0x4a4bae]of Object[_0x4232e2(0x192)](_0x503436)){if(_0x3f61ca[_0x4232e2(0xae)]()===_0x27476a['toLowerCase']()){const _0x7c286c=_0x4a4bae[_0x4232e2(0x135)]||0xa;return console['log'](_0x4232e2(0x193)+_0x27476a+'\x20commission\x20for\x20shop\x20'+_0x337520+':\x20'+_0x7c286c+'%'),_0x7c286c;}}return console['log'](_0x4232e2(0xb0)+_0x27476a+_0x4232e2(0xbf)+_0x337520+_0x4232e2(0xcb)),0xa;}catch(_0x512ed9){return console['error']('Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20'+_0x337520+',\x20gateway\x20'+_0x27476a+':',_0x512ed9),0xa;}}}exports[a48_0xd8cc2b(0x19b)]=CoinToPayStatusService,exports[a48_0xd8cc2b(0x173)]=new CoinToPayStatusService();