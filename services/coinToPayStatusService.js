'use strict';function a38_0x290c(_0x1c6a4d,_0x336da7){const _0x2b2bfd=a38_0x2b2b();return a38_0x290c=function(_0x290ceb,_0x28ab4e){_0x290ceb=_0x290ceb-0x184;let _0x20456d=_0x2b2bfd[_0x290ceb];return _0x20456d;},a38_0x290c(_0x1c6a4d,_0x336da7);}const a38_0x134fbb=a38_0x290c;(function(_0x29def7,_0x2dd48d){const _0x520ff2=a38_0x290c,_0x225aaf=_0x29def7();while(!![]){try{const _0x1b2544=-parseInt(_0x520ff2(0x1f8))/0x1*(-parseInt(_0x520ff2(0x1fb))/0x2)+-parseInt(_0x520ff2(0x18f))/0x3+parseInt(_0x520ff2(0x205))/0x4+-parseInt(_0x520ff2(0x296))/0x5+parseInt(_0x520ff2(0x20f))/0x6+parseInt(_0x520ff2(0x23b))/0x7*(-parseInt(_0x520ff2(0x1d1))/0x8)+-parseInt(_0x520ff2(0x193))/0x9*(-parseInt(_0x520ff2(0x222))/0xa);if(_0x1b2544===_0x2dd48d)break;else _0x225aaf['push'](_0x225aaf['shift']());}catch(_0x54fcc6){_0x225aaf['push'](_0x225aaf['shift']());}}}(a38_0x2b2b,0xacb13));var __importDefault=this&&this['__importDefault']||function(_0x28efa9){const _0x462d50=a38_0x290c;return _0x28efa9&&_0x28efa9[_0x462d50(0x1d9)]?_0x28efa9:{'default':_0x28efa9};};Object['defineProperty'](exports,a38_0x134fbb(0x1d9),{'value':!![]}),exports[a38_0x134fbb(0x279)]=exports[a38_0x134fbb(0x19a)]=void 0x0;const coinToPayService_1=require(a38_0x134fbb(0x19c)),coinToPay2Service_1=require(a38_0x134fbb(0x1e5)),gateway_1=require(a38_0x134fbb(0x207)),database_1=__importDefault(require(a38_0x134fbb(0x238))),telegramBotService_1=require(a38_0x134fbb(0x1ff)),loggerService_1=require(a38_0x134fbb(0x26e)),currencyService_1=require(a38_0x134fbb(0x212));function a38_0x2b2b(){const _0x8c899c=['getGatewayCommission','delete','\x20not\x20found\x20in\x20database','\x20to\x20clear','✅\x20[DEBUG]\x20Successfully\x20scheduled\x20','2\x20minutes','SINGLE','🪙\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','checkAllPendingPayments','logCoinToPayError','🪙\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','PENDING','gatewayOrderId','🛑\x20[SHUTDOWN]\x20Cleared\x20','❌\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','paymentTimers','catch','Success','4204552SqLqwS','FAILED','payment','length','⚠️\x20[CHECK]\x20Payment\x20','getDate','COINTOPAY_STATUS_CHANGE','\x20for\x20payment\x20','__esModule','\x20updated\x20successfully','🧹\x20[DEBUG]\x20Clearing\x20','\x20\x20\x20Amount:\x20','findUnique','\x20\x20\x20📅\x20Time:\x20','checkPaymentStatus','\x20pending\x20CoinToPay\x20payments','\x20status\x20unchanged\x20(','\x20expired\x20CoinToPay\x20payments','paidAt','\x20status\x20changed\x20to\x20','./gateways/coinToPay2Service','amount','convertToUSDT','auto_expire','\x20->\x20','\x20skipped,\x20','amountUSDT','customerEmail','🪙\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','\x20individual\x20payment\x20timers','\x20\x20\x20📝\x20Details:','push','toLowerCase','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','has','stopPeriodicStatusCheck','update','🪙\x20[DEBUG]\x20Creating\x20','❌\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','396giExdn','shop','❌\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','4864pHvXVl','\x20expired',',\x20clearing\x20individual\x20timers','❌\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','./telegramBotService','✅\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','✅\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','globalCheckInterval','remitterIban','logWhiteDomainError','3985176ONrrrp','setDate','../types/gateway','sendPaymentStatusNotification','webhookEvents','not\x20confirmed','\x20with\x20status\x20','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','shopId','🧹\x20[CHECK]\x20Payment\x20','1271724WWsAFQ','currency','\x20\x20\x20-\x20Status:\x20','./currencyService','getTime','\x20is\x20too\x20new\x20(','\x20status\x20from\x20','\x20in\x20shop\x20','Gateway\x20','coinToPay2Service','🧹\x20[DEBUG]\x20Cleared\x20timer\x20#','createdAt','payment.failed','paymentLinkId','✅\x20[EXPIRY]\x20Payment\x20','paymentDetails','values','✅\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','checkSinglePayment','10wEpIij','\x20current\x20status:\x20','✅\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','TesSoft\x20Payment\x20System/1.0','\x20completed\x20for\x20payment\x20','cointopay_status_check_error','\x20payment\x20','🪙\x20[GLOBAL]\x20Found\x20','🪙\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','Unknown\x20error','✅\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','❌\x20[HOURLY]\x20Payment\x20','🔄\x20[CHECK]\x20Updating\x20payment\x20',',\x20stopping\x20individual\x20checks','Bank\x20Details:\x20','logShopWebhookSent','cointopay','created','coinToPayService','1\x20minute','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','startPeriodicStatusCheck','../config/database','\x20days\x20without\x20payment\x20confirmation','Failed\x20to\x20send\x20shop\x20webhook:','7bHkvpZ','payment.success','toFixed','❌\x20[TIMER]\x20Failed\x20individual\x20check\x20#','get','🪙\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','CoinToPayService','type','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','webhookLog','\x20status\x20is\x20','webhookUrl','paymentLink','\x20\x20\x20-\x20Amount:\x20','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','\x20commission\x20for\x20shop\x20','not\x20found','sendShopWebhook','-day\x20timeout','COINTOPAY_ERROR','paid','amountAfterGatewayCommissionUSDT','🪙\x20[TIMER]\x20Individual\x20check\x20#','💰\x20[CHECK]\x20Payment\x20','getServiceStats','\x20\x20\x20Amount\x20after\x20commission:\x20','error','\x20has\x20no\x20gatewayPaymentId,\x20skipping','cointopay_auto_expired','parse','transactionId','📊\x20[CHECK]\x20Payment\x20','\x20is\x20older\x20than\x20','webhook_send','\x20details:','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','Payment\x20older\x20than\x20','log','\x20not\x20enabled\x20for\x20shop\x20','currentPayments','⏰\x20[GLOBAL]\x20Payment\x20','.\x20Remaining\x20active\x20timers:\x20','EXPIRED','gatewaySettings','checkSinglePaymentById','sendPaymentNotification','orderId','\x20status:\x20','✅\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','./loggerService','h),\x20skipping\x20global\x20check','✅\x20[CHECK]\x20Payment\x20','unknown','schedulePaymentChecks','gatewayPaymentId','telegramBotService','status','🔍\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','⏰\x20[GLOBAL]\x20Found\x20','\x20\x20\x20📝\x20Context:','coinToPayStatusService','⏰\x20[HOURLY]\x20Payment\x20','adminNotes','❌\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','📊\x20[CHECK]\x20CoinToPay\x20payment\x20','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','\x20is\x20valid\x20for\x20checking,\x20proceeding...','\x20marked\x20as\x20paid\x20at:\x20','Automatically\x20expired\x20after\x20','✅\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','📊\x20[CHECK]\x20CoinToPay2\x20payment\x20','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','delay','floor','\x20days\x20(created\x20before\x20','No\x20specific\x20commission\x20found\x20for\x20gateway\x20','PAID','\x20seconds\x20(','default','⚠️\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','🔍\x20[CHECK]\x20Checking\x20','iban','forEach','⏰\x20[EXPIRY]\x20Payment\x20','🆔\x20[CHECK]\x20Transaction\x20ID:\x20','failed','settings','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','cointopay_status_check_','3135495UPmWNg','\x20\x20\x20-\x20gatewayPaymentId:\x20','confirmedOn','\x20amounts\x20calculated:','stringify','currencyService','\x20in\x20','Failed\x20to\x20mark\x20payment\x20as\x20expired','📊\x20[HOURLY]\x20Payment\x20','\x20commission:\x20','EXPIRY_DAYS','cointopay2','\x20\x20\x20-\x20Gateway:\x20','schedule_created','❌\x20[CHECK]\x20Payment\x20','\x20found:','1452834EjajNo','description','gateway','\x20timers\x20for\x20payment\x20','1556757dENlSK','set','\x20days','\x20\x20\x20-\x20GatewayPaymentId:\x20','❌\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','size','create','CoinToPayStatusService','\x20(after\x20','./gateways/coinToPayService','from','🏦\x20[CHECK]\x20Saved\x20IBAN:\x20','🪙\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','bankDetails','🏦\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes','status_check','\x20\x20\x20-\x20ShopId:\x20','COMPLETED','clearPaymentTimers','logShopWebhookError','timers','text','now','timestamp','\x20has\x20no\x20gatewayPaymentId','message','\x20\x20\x20📍\x20Source:\x20','\x20\x20\x20❌\x20Error:\x20',',\x20status=','\x20initial\x20timers\x20for\x20payment\x20','GLOBAL_CHECK_INTERVAL_MS','📈\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','customerName','checkPaymentById','5\x20minutes','getGatewayIdByName','checkExpiredPayments','loggerService','toISOString','🔍\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','commission','logCoinToPayStatus','\x20(age:\x20'];a38_0x2b2b=function(){return _0x8c899c;};return a38_0x2b2b();}class CoinToPayStatusService{constructor(){const _0x137d84=a38_0x134fbb;this[_0x137d84(0x202)]=null,this[_0x137d84(0x1b2)]=0x3c*0x3c*0x3e8,this['EXPIRY_DAYS']=0x5,this[_0x137d84(0x1ce)]=new Map(),this[_0x137d84(0x234)]=new coinToPayService_1[(_0x137d84(0x241))](),this[_0x137d84(0x218)]=new coinToPay2Service_1['CoinToPay2Service'](),console[_0x137d84(0x262)]('🪙\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2');}[a38_0x134fbb(0x272)](_0x3f576b,_0x526b1a){const _0x362a4b=a38_0x134fbb;console[_0x362a4b(0x262)](_0x362a4b(0x22a)),console[_0x362a4b(0x262)]('\x20\x20\x20-\x20paymentId:\x20'+_0x3f576b),console[_0x362a4b(0x262)](_0x362a4b(0x297)+_0x526b1a),this[_0x362a4b(0x1a6)](_0x3f576b);const _0x215c6b=[],_0x5c0693=new Date(),_0x3201c9=[{'delay':0x1*0x3c*0x3e8,'description':_0x362a4b(0x235)},{'delay':0x2*0x3c*0x3e8,'description':_0x362a4b(0x1c4)},{'delay':0x5*0x3c*0x3e8,'description':_0x362a4b(0x1b6)},{'delay':0x5*0x3c*0x3e8,'description':_0x362a4b(0x1b6)}];console['log'](_0x362a4b(0x1f6)+_0x3201c9['length']+_0x362a4b(0x1b1)+_0x3f576b);let _0x452b25=0x0;_0x3201c9[_0x362a4b(0x28f)]((_0x2d6463,_0xabd936)=>{const _0x4d4877=_0x362a4b;_0x452b25+=_0x2d6463[_0x4d4877(0x285)];const _0x47472c=setTimeout(async()=>{const _0x423ee2=_0x4d4877;console['log'](_0x423ee2(0x252)+(_0xabd936+0x1)+'\x20triggered\x20for\x20payment\x20'+_0x3f576b+_0x423ee2(0x19b)+_0x2d6463[_0x423ee2(0x190)]+')');try{await this[_0x423ee2(0x269)](_0x3f576b),console[_0x423ee2(0x262)]('✅\x20[TIMER]\x20Individual\x20check\x20#'+(_0xabd936+0x1)+_0x423ee2(0x226)+_0x3f576b);}catch(_0x39ce4f){console['error'](_0x423ee2(0x23e)+(_0xabd936+0x1)+_0x423ee2(0x1d8)+_0x3f576b+':',_0x39ce4f),this[_0x423ee2(0x1c8)](_0x3f576b,_0x526b1a,_0x39ce4f,_0x423ee2(0x1a3),{'checkNumber':_0xabd936+0x1,'scheduledAfter':_0x2d6463[_0x423ee2(0x190)],'isIndividualCheck':!![]});}},_0x452b25);_0x215c6b[_0x4d4877(0x1f0)](_0x47472c),console[_0x4d4877(0x262)]('⏰\x20[DEBUG]\x20Scheduled\x20check\x20#'+(_0xabd936+0x1)+'\x20for\x20payment\x20'+_0x3f576b+_0x4d4877(0x185)+_0x452b25/0x3e8+_0x4d4877(0x28a)+_0x2d6463['description']+')');});const _0x18996d=setInterval(async()=>{const _0x2f2ccb=_0x362a4b;console[_0x2f2ccb(0x262)]('🪙\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20'+_0x3f576b);try{const _0x433813=await database_1['default']['payment']['findUnique']({'where':{'id':_0x3f576b},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x433813){console[_0x2f2ccb(0x262)](_0x2f2ccb(0x22d)+_0x3f576b+'\x20not\x20found,\x20clearing\x20timers'),this['clearPaymentTimers'](_0x3f576b);return;}console[_0x2f2ccb(0x262)](_0x2f2ccb(0x187)+_0x3f576b+_0x2f2ccb(0x223)+_0x433813[_0x2f2ccb(0x275)]);if(_0x433813[_0x2f2ccb(0x275)]!=='PENDING'){console[_0x2f2ccb(0x262)]('✅\x20[HOURLY]\x20Payment\x20'+_0x3f576b+_0x2f2ccb(0x246)+_0x433813[_0x2f2ccb(0x275)]+_0x2f2ccb(0x22f)),this[_0x2f2ccb(0x1a6)](_0x3f576b);return;}const _0x467609=Math[_0x2f2ccb(0x286)]((Date['now']()-_0x433813[_0x2f2ccb(0x21a)][_0x2f2ccb(0x213)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x467609>=this['EXPIRY_DAYS']){console[_0x2f2ccb(0x262)](_0x2f2ccb(0x27a)+_0x3f576b+'\x20is\x20older\x20than\x20'+this[_0x2f2ccb(0x189)]+_0x2f2ccb(0x284)),this['clearPaymentTimers'](_0x3f576b);return;}await this[_0x2f2ccb(0x269)](_0x3f576b),console['log'](_0x2f2ccb(0x200)+_0x3f576b);}catch(_0x8df9e8){console[_0x2f2ccb(0x256)]('❌\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20'+_0x3f576b+':',_0x8df9e8),this[_0x2f2ccb(0x1c8)](_0x3f576b,_0x526b1a,_0x8df9e8,_0x2f2ccb(0x1a3),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x215c6b[_0x362a4b(0x1f0)](_0x18996d),this[_0x362a4b(0x1ce)][_0x362a4b(0x194)](_0x3f576b,{'timers':_0x215c6b,'paymentId':_0x3f576b,'gatewayPaymentId':_0x526b1a,'createdAt':_0x5c0693}),console[_0x362a4b(0x262)](_0x362a4b(0x1c3)+_0x3201c9[_0x362a4b(0x1d4)]+_0x362a4b(0x20c)+_0x3f576b),console['log']('📊\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20'+this[_0x362a4b(0x1ce)][_0x362a4b(0x198)]),this['logCoinToPayStatus'](_0x3f576b,_0x526b1a,_0x362a4b(0x1ca),'PENDING',_0x362a4b(0x1a3),{'action':_0x362a4b(0x18c),'scheduledChecks':_0x3201c9[_0x362a4b(0x1d4)],'firstCheckIn':_0x3201c9[0x0][_0x362a4b(0x285)]/0x3e8,'totalTimers':this[_0x362a4b(0x1ce)][_0x362a4b(0x198)]});}[a38_0x134fbb(0x1a6)](_0x5e9b25){const _0x3aeb21=a38_0x134fbb,_0x1f40cd=this[_0x3aeb21(0x1ce)][_0x3aeb21(0x23f)](_0x5e9b25);_0x1f40cd?(console[_0x3aeb21(0x262)](_0x3aeb21(0x1db)+_0x1f40cd[_0x3aeb21(0x1a8)]['length']+_0x3aeb21(0x192)+_0x5e9b25),_0x1f40cd['timers'][_0x3aeb21(0x28f)]((_0x32eaf9,_0x1cb73c)=>{const _0x7593d9=_0x3aeb21;_0x32eaf9&&(clearTimeout(_0x32eaf9),clearInterval(_0x32eaf9),console['log'](_0x7593d9(0x219)+(_0x1cb73c+0x1)+_0x7593d9(0x1d8)+_0x5e9b25));}),this[_0x3aeb21(0x1ce)][_0x3aeb21(0x1c0)](_0x5e9b25),console['log'](_0x3aeb21(0x224)+_0x5e9b25+_0x3aeb21(0x266)+this['paymentTimers'][_0x3aeb21(0x198)])):console['log'](_0x3aeb21(0x28c)+_0x5e9b25+_0x3aeb21(0x1c2));}async[a38_0x134fbb(0x269)](_0x4d3583){const _0x7bf170=a38_0x134fbb;console[_0x7bf170(0x262)](_0x7bf170(0x276)+_0x4d3583);const _0x45a76b=await database_1[_0x7bf170(0x28b)]['payment']['findUnique']({'where':{'id':_0x4d3583},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x45a76b){console[_0x7bf170(0x262)](_0x7bf170(0x18d)+_0x4d3583+_0x7bf170(0x1c1));return;}console[_0x7bf170(0x262)](_0x7bf170(0x25b)+_0x4d3583+_0x7bf170(0x18e)),console[_0x7bf170(0x262)](_0x7bf170(0x18b)+_0x45a76b[_0x7bf170(0x191)]),console['log'](_0x7bf170(0x211)+_0x45a76b[_0x7bf170(0x275)]),console[_0x7bf170(0x262)](_0x7bf170(0x196)+_0x45a76b[_0x7bf170(0x273)]),console['log'](_0x7bf170(0x249)+_0x45a76b[_0x7bf170(0x1e6)]+'\x20'+_0x45a76b['currency']),console['log'](_0x7bf170(0x1a4)+_0x45a76b[_0x7bf170(0x20d)]);if(_0x45a76b[_0x7bf170(0x191)]!==_0x7bf170(0x232)&&_0x45a76b[_0x7bf170(0x191)]!==_0x7bf170(0x18a)){console[_0x7bf170(0x262)]('⚠️\x20[CHECK]\x20Payment\x20'+_0x4d3583+_0x7bf170(0x236)+_0x45a76b[_0x7bf170(0x191)]+')');return;}if(_0x45a76b['status']!==_0x7bf170(0x1ca)){console[_0x7bf170(0x262)]('⚠️\x20[CHECK]\x20Payment\x20'+_0x4d3583+'\x20status\x20is\x20'+_0x45a76b[_0x7bf170(0x275)]+_0x7bf170(0x22f)),this[_0x7bf170(0x1a6)](_0x4d3583);return;}if(!_0x45a76b[_0x7bf170(0x273)]){console['log'](_0x7bf170(0x1d5)+_0x4d3583+_0x7bf170(0x1ac));return;}console[_0x7bf170(0x262)](_0x7bf170(0x270)+_0x4d3583+_0x7bf170(0x27f)),await this[_0x7bf170(0x221)](_0x45a76b);}['logCoinToPayStatus'](_0x31739b,_0x42a381,_0x2c00f0,_0x3ee2a7,_0x267b5d,_0x261622){const _0x5b7749=a38_0x134fbb,_0xf83ab4={'type':_0x5b7749(0x1d7),'paymentId':_0x31739b,'gatewayPaymentId':_0x42a381,'oldStatus':_0x2c00f0,'newStatus':_0x3ee2a7,'source':_0x267b5d,'timestamp':new Date()[_0x5b7749(0x1ba)](),'details':_0x261622||{}};loggerService_1[_0x5b7749(0x1b9)][_0x5b7749(0x1bd)](_0xf83ab4),console[_0x5b7749(0x262)](_0x5b7749(0x240)+_0x31739b+'\x20('+_0x42a381+')'),console[_0x5b7749(0x262)]('\x20\x20\x20📊\x20Status:\x20'+_0x2c00f0+_0x5b7749(0x1e9)+_0x3ee2a7),console[_0x5b7749(0x262)](_0x5b7749(0x1ae)+_0x267b5d),console[_0x5b7749(0x262)](_0x5b7749(0x1de)+_0xf83ab4['timestamp']),_0x261622&&console[_0x5b7749(0x262)](_0x5b7749(0x1ef),_0x261622);}[a38_0x134fbb(0x1c8)](_0xc494a1,_0x7d6fd9,_0x300891,_0x4361a2,_0x434181){const _0x103bbc=a38_0x134fbb,_0x5c9925={'type':_0x103bbc(0x24f),'paymentId':_0xc494a1,'gatewayPaymentId':_0x7d6fd9,'error':_0x300891 instanceof Error?{'message':_0x300891[_0x103bbc(0x1ad)],'stack':_0x300891['stack']}:_0x300891,'source':_0x4361a2,'timestamp':new Date()[_0x103bbc(0x1ba)](),'context':_0x434181||{}};loggerService_1[_0x103bbc(0x1b9)][_0x103bbc(0x1c8)](_0x5c9925),console[_0x103bbc(0x256)]('🪙\x20[ERROR]\x20CoinToPay\x20Error:\x20'+_0xc494a1+'\x20('+_0x7d6fd9+')'),console[_0x103bbc(0x256)](_0x103bbc(0x1af)+(_0x300891 instanceof Error?_0x300891[_0x103bbc(0x1ad)]:_0x300891)),console[_0x103bbc(0x256)](_0x103bbc(0x1ae)+_0x4361a2),console['error']('\x20\x20\x20📅\x20Time:\x20'+_0x5c9925[_0x103bbc(0x1ab)]),_0x434181&&console[_0x103bbc(0x256)](_0x103bbc(0x278),_0x434181);}[a38_0x134fbb(0x237)](){const _0x45019a=a38_0x134fbb;console[_0x45019a(0x262)](_0x45019a(0x1c6)),this['checkAllPendingPayments']()[_0x45019a(0x1cf)](_0x6de337=>{const _0x414316=_0x45019a;console[_0x414316(0x256)](_0x414316(0x197),_0x6de337);}),this[_0x45019a(0x202)]=setInterval(async()=>{const _0x2f5ce6=_0x45019a;try{console[_0x2f5ce6(0x262)](_0x2f5ce6(0x1ed)),await this[_0x2f5ce6(0x1c7)](),console[_0x2f5ce6(0x262)](_0x2f5ce6(0x26d));}catch(_0x4e9aca){console[_0x2f5ce6(0x256)]('❌\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:',_0x4e9aca);}},this[_0x45019a(0x1b2)]),console[_0x45019a(0x262)](_0x45019a(0x22c));}[a38_0x134fbb(0x1f4)](){const _0xdf02a7=a38_0x134fbb;console[_0xdf02a7(0x262)]('🛑\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...');this[_0xdf02a7(0x202)]&&(clearInterval(this[_0xdf02a7(0x202)]),this['globalCheckInterval']=null,console['log']('🛑\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped'));const _0x4d001d=this['paymentTimers']['size'];for(const [_0x1c9cac]of this[_0xdf02a7(0x1ce)]){this[_0xdf02a7(0x1a6)](_0x1c9cac);}console[_0xdf02a7(0x262)](_0xdf02a7(0x1cc)+_0x4d001d+_0xdf02a7(0x1ee));}async[a38_0x134fbb(0x1c7)](){const _0x497462=a38_0x134fbb;try{console[_0x497462(0x262)](_0x497462(0x1c9));const _0xc16312=await database_1[_0x497462(0x28b)][_0x497462(0x1d3)]['findMany']({'where':{'gateway':{'in':[_0x497462(0x232),'cointopay2']},'status':'PENDING','gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x497462(0x262)](_0x497462(0x229)+_0xc16312['length']+_0x497462(0x1e0));if(_0xc16312[_0x497462(0x1d4)]===0x0){console[_0x497462(0x262)](_0x497462(0x19f));return;}const _0x1b7901=await this[_0x497462(0x1b8)](_0xc16312);console[_0x497462(0x262)](_0x497462(0x277)+_0x1b7901[_0x497462(0x1d4)]+_0x497462(0x1e2));let _0x46797b=0x0,_0x546b37=0x0;for(const _0x4c88e7 of _0xc16312){try{if(_0x1b7901['includes'](_0x4c88e7['id'])){console[_0x497462(0x262)](_0x497462(0x265)+_0x4c88e7['id']+_0x497462(0x1f2)),_0x546b37++;continue;}if(this[_0x497462(0x1ce)][_0x497462(0x1f3)](_0x4c88e7['id'])){console[_0x497462(0x262)]('⏰\x20[GLOBAL]\x20Payment\x20'+_0x4c88e7['id']+_0x497462(0x24a)),_0x546b37++;continue;}const _0x53d344=(Date['now']()-_0x4c88e7[_0x497462(0x21a)][_0x497462(0x213)]())/(0x3e8*0x3c*0x3c);if(_0x53d344<0x1){console[_0x497462(0x262)](_0x497462(0x265)+_0x4c88e7['id']+_0x497462(0x214)+_0x53d344['toFixed'](0x1)+_0x497462(0x26f)),_0x546b37++;continue;}console[_0x497462(0x262)](_0x497462(0x1bb)+_0x4c88e7['id']+_0x497462(0x1be)+_0x53d344[_0x497462(0x23d)](0x1)+'h)'),await this[_0x497462(0x221)](_0x4c88e7),_0x46797b++,await new Promise(_0x43d2e5=>setTimeout(_0x43d2e5,0x7d0));}catch(_0x2f4e71){console['error'](_0x497462(0x1fe)+_0x4c88e7['id']+':',_0x2f4e71),this[_0x497462(0x1c8)](_0x4c88e7['id'],_0x4c88e7[_0x497462(0x273)]||_0x497462(0x271),_0x2f4e71,'status_check',{'isGlobalCheck':!![],'paymentAmount':_0x4c88e7['amount'],'paymentCurrency':_0x4c88e7[_0x497462(0x210)],'shopId':_0x4c88e7[_0x497462(0x20d)],'createdAt':_0x4c88e7[_0x497462(0x21a)]}),loggerService_1['loggerService'][_0x497462(0x204)](_0x497462(0x232),'/status/'+_0x4c88e7[_0x497462(0x273)],_0x2f4e71);}}console['log'](_0x497462(0x201)+_0x46797b+'\x20checked,\x20'+_0x546b37+_0x497462(0x1ea)+_0x1b7901['length']+_0x497462(0x1fc));}catch(_0x4ef1c1){console[_0x497462(0x256)](_0x497462(0x27c),_0x4ef1c1);}}async[a38_0x134fbb(0x1b8)](_0x10c49b){const _0x159853=a38_0x134fbb,_0x7b780f=[],_0x3e1ef8=new Date();_0x3e1ef8[_0x159853(0x206)](_0x3e1ef8[_0x159853(0x1d6)]()-this[_0x159853(0x189)]),console['log']('⏰\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20'+this[_0x159853(0x189)]+_0x159853(0x287)+_0x3e1ef8[_0x159853(0x1ba)]()+')');for(const _0x44fc7e of _0x10c49b){if(_0x44fc7e[_0x159853(0x21a)]<_0x3e1ef8){console[_0x159853(0x262)](_0x159853(0x290)+_0x44fc7e['id']+_0x159853(0x25c)+this[_0x159853(0x189)]+'\x20days,\x20marking\x20as\x20EXPIRED');try{this[_0x159853(0x1bd)](_0x44fc7e['id'],_0x44fc7e['gatewayPaymentId']||_0x159853(0x271),_0x159853(0x1ca),_0x159853(0x267),_0x159853(0x1e8),{'reason':_0x159853(0x261)+this['EXPIRY_DAYS']+_0x159853(0x195),'createdAt':_0x44fc7e[_0x159853(0x21a)],'daysSinceCreation':Math[_0x159853(0x286)]((Date[_0x159853(0x1aa)]()-_0x44fc7e['createdAt'][_0x159853(0x213)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x44fc7e[_0x159853(0x1e6)],'paymentCurrency':_0x44fc7e[_0x159853(0x210)],'shopId':_0x44fc7e[_0x159853(0x20d)]}),await database_1[_0x159853(0x28b)][_0x159853(0x1d3)][_0x159853(0x1f5)]({'where':{'id':_0x44fc7e['id']},'data':{'status':'EXPIRED','updatedAt':new Date(),'adminNotes':_0x159853(0x281)+this[_0x159853(0x189)]+_0x159853(0x239)}}),await database_1['default'][_0x159853(0x245)][_0x159853(0x199)]({'data':{'paymentId':_0x44fc7e['id'],'shopId':_0x44fc7e[_0x159853(0x20d)],'event':_0x159853(0x258),'statusCode':0xc8,'responseBody':JSON['stringify']({'reason':_0x159853(0x261)+this[_0x159853(0x189)]+_0x159853(0x195),'createdAt':_0x44fc7e[_0x159853(0x21a)],'expiredAt':new Date()['toISOString'](),'daysSinceCreation':Math[_0x159853(0x286)]((Date[_0x159853(0x1aa)]()-_0x44fc7e[_0x159853(0x21a)][_0x159853(0x213)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x159853(0x24d)](_0x44fc7e,_0x159853(0x267)),await this[_0x159853(0x208)](_0x44fc7e,'EXPIRED'),this[_0x159853(0x1a6)](_0x44fc7e['id']),_0x7b780f[_0x159853(0x1f0)](_0x44fc7e['id']),console[_0x159853(0x262)](_0x159853(0x21d)+_0x44fc7e['id']+'\x20marked\x20as\x20EXPIRED\x20due\x20to\x20'+this[_0x159853(0x189)]+_0x159853(0x24e));}catch(_0x5877a8){console[_0x159853(0x256)](_0x159853(0x1cd)+_0x44fc7e['id']+':',_0x5877a8),this['logCoinToPayError'](_0x44fc7e['id'],_0x44fc7e[_0x159853(0x273)]||_0x159853(0x271),_0x5877a8,_0x159853(0x1e8),{'reason':_0x159853(0x186),'createdAt':_0x44fc7e['createdAt'],'daysSinceCreation':Math[_0x159853(0x286)]((Date[_0x159853(0x1aa)]()-_0x44fc7e['createdAt'][_0x159853(0x213)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x7b780f;}async[a38_0x134fbb(0x221)](_0x2db78a){const _0x1da603=a38_0x134fbb;if(!_0x2db78a[_0x1da603(0x273)]){console[_0x1da603(0x262)](_0x1da603(0x1d5)+_0x2db78a['id']+_0x1da603(0x257));return;}console[_0x1da603(0x262)](_0x1da603(0x28d)+_0x2db78a['gateway']+_0x1da603(0x228)+_0x2db78a['id']+'\x20('+_0x2db78a[_0x1da603(0x273)]+')');try{let _0x1a2531;_0x2db78a[_0x1da603(0x191)]===_0x1da603(0x18a)?(_0x1a2531=await this[_0x1da603(0x218)][_0x1da603(0x1df)](_0x2db78a['gatewayPaymentId']),console[_0x1da603(0x262)](_0x1da603(0x283)+_0x2db78a['id']+_0x1da603(0x26c)+_0x1a2531[_0x1da603(0x275)])):(_0x1a2531=await this[_0x1da603(0x234)][_0x1da603(0x1df)](_0x2db78a['gatewayPaymentId']),console[_0x1da603(0x262)](_0x1da603(0x27d)+_0x2db78a['id']+_0x1da603(0x26c)+_0x1a2531['status']));_0x1a2531[_0x1da603(0x21e)]&&console[_0x1da603(0x262)](_0x1da603(0x25b)+_0x2db78a['id']+_0x1da603(0x25e),{'iban':_0x1a2531[_0x1da603(0x21e)][_0x1da603(0x28e)]||_0x1da603(0x24c),'transactionId':_0x1a2531[_0x1da603(0x21e)][_0x1da603(0x25a)],'createdOn':_0x1a2531[_0x1da603(0x21e)]['createdOn'],'confirmedOn':_0x1a2531['paymentDetails'][_0x1da603(0x298)]||_0x1da603(0x20a)});if(_0x1a2531[_0x1da603(0x275)]!==_0x2db78a[_0x1da603(0x275)]){console[_0x1da603(0x262)](_0x1da603(0x22e)+_0x2db78a['id']+_0x1da603(0x215)+_0x2db78a['status']+'\x20to\x20'+_0x1a2531[_0x1da603(0x275)]),this[_0x1da603(0x1bd)](_0x2db78a['id'],_0x2db78a[_0x1da603(0x273)],_0x2db78a[_0x1da603(0x275)],_0x1a2531['status'],_0x1da603(0x1a3),{'paymentDetails':_0x1a2531[_0x1da603(0x21e)],'amount':_0x1a2531[_0x1da603(0x1e6)],'currency':_0x1a2531[_0x1da603(0x210)],'shopId':_0x2db78a[_0x1da603(0x20d)],'checkTimestamp':new Date()[_0x1da603(0x1ba)]()});const _0x3cf97b={'status':_0x1a2531[_0x1da603(0x275)],'updatedAt':new Date()};if(_0x1a2531['status']===_0x1da603(0x289)&&_0x2db78a[_0x1da603(0x275)]!==_0x1da603(0x289)){_0x3cf97b['paidAt']=new Date();if(!_0x2db78a[_0x1da603(0x1eb)]){const _0x1c8299=await currencyService_1[_0x1da603(0x184)][_0x1da603(0x1e7)](_0x2db78a['amount'],_0x2db78a[_0x1da603(0x210)]);_0x3cf97b[_0x1da603(0x1eb)]=_0x1c8299;const _0x479943=await this[_0x1da603(0x1bf)](_0x2db78a[_0x1da603(0x20d)],_0x2db78a[_0x1da603(0x191)]),_0x11a9bd=_0x1c8299*(0x1-_0x479943/0x64);_0x3cf97b[_0x1da603(0x251)]=_0x11a9bd,console['log']('💰\x20[CHECK]\x20Payment\x20'+_0x2db78a['id']+_0x1da603(0x299)),console[_0x1da603(0x262)](_0x1da603(0x1dc)+_0x2db78a['amount']+'\x20'+_0x2db78a[_0x1da603(0x210)]+_0x1da603(0x1e9)+_0x1c8299[_0x1da603(0x23d)](0x6)+'\x20USDT'),console[_0x1da603(0x262)]('\x20\x20\x20Gateway\x20'+_0x2db78a['gateway']+_0x1da603(0x188)+_0x479943+'%'),console['log'](_0x1da603(0x255)+_0x11a9bd[_0x1da603(0x23d)](0x6)+'\x20USDT');}console[_0x1da603(0x262)](_0x1da603(0x253)+_0x2db78a['id']+_0x1da603(0x280)+_0x3cf97b[_0x1da603(0x1e3)][_0x1da603(0x1ba)]());}if(_0x1a2531[_0x1da603(0x21e)]){const _0x513cad=_0x1a2531[_0x1da603(0x21e)];_0x513cad[_0x1da603(0x28e)]&&(_0x3cf97b[_0x1da603(0x203)]=_0x513cad[_0x1da603(0x28e)],console[_0x1da603(0x262)](_0x1da603(0x19e)+_0x513cad[_0x1da603(0x28e)]));if(_0x513cad[_0x1da603(0x1a1)]){const _0x5355fc=_0x2db78a[_0x1da603(0x27b)]||'',_0x23bad5=_0x1da603(0x230)+_0x513cad[_0x1da603(0x1a1)];_0x3cf97b[_0x1da603(0x27b)]=_0x5355fc?_0x5355fc+'\x0a\x0a'+_0x23bad5:_0x23bad5,console[_0x1da603(0x262)](_0x1da603(0x1a2));}_0x513cad[_0x1da603(0x25a)]&&console['log'](_0x1da603(0x291)+_0x513cad['transactionId']),_0x513cad['confirmedOn']&&console[_0x1da603(0x262)]('✅\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20'+_0x513cad['confirmedOn']);}await database_1[_0x1da603(0x28b)][_0x1da603(0x1d3)][_0x1da603(0x1f5)]({'where':{'id':_0x2db78a['id']},'data':_0x3cf97b});if(_0x1a2531['status']==='PAID'&&_0x2db78a[_0x1da603(0x275)]!==_0x1da603(0x289)){console[_0x1da603(0x262)]('📈\x20[COINTOPAY]\x20Payment\x20'+_0x2db78a['id']+_0x1da603(0x260));const _0xb03731=await database_1[_0x1da603(0x28b)]['payment'][_0x1da603(0x1dd)]({'where':{'id':_0x2db78a['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0xb03731?.[_0x1da603(0x21c)]&&_0xb03731[_0x1da603(0x248)])try{const _0x142045=_0xb03731[_0x1da603(0x248)];console[_0x1da603(0x262)](_0x1da603(0x1b3)+_0x142045['id']+':\x20type='+_0x142045['type']+',\x20currentPayments='+_0x142045[_0x1da603(0x264)]+_0x1da603(0x1b0)+_0x142045['status']);const _0x2cc30b=_0x142045[_0x1da603(0x264)]+0x1,_0x18b6fc=_0x142045[_0x1da603(0x242)]===_0x1da603(0x1c5)?_0x1da603(0x1a5):_0x142045[_0x1da603(0x275)];await database_1['default']['paymentLink']['update']({'where':{'id':_0x142045['id']},'data':{'currentPayments':_0x2cc30b,'status':_0x18b6fc,'updatedAt':new Date()}}),console[_0x1da603(0x262)]('✅\x20[COINTOPAY]\x20Payment\x20link\x20'+_0x142045['id']+'\x20updated:\x20currentPayments='+_0x142045[_0x1da603(0x264)]+'\x20->\x20'+_0x2cc30b+',\x20status='+_0x142045[_0x1da603(0x275)]+_0x1da603(0x1e9)+_0x18b6fc);}catch(_0xe5ac24){console[_0x1da603(0x256)](_0x1da603(0x1f7),_0xe5ac24);}else console['log']('📈\x20[COINTOPAY]\x20Payment\x20'+_0x2db78a['id']+_0x1da603(0x1a0));}await database_1[_0x1da603(0x28b)][_0x1da603(0x245)][_0x1da603(0x199)]({'data':{'paymentId':_0x2db78a['id'],'shopId':_0x2db78a['shopId'],'event':_0x1da603(0x295)+_0x1a2531[_0x1da603(0x275)][_0x1da603(0x1f1)](),'statusCode':0xc8,'responseBody':JSON['stringify']({'oldStatus':_0x2db78a[_0x1da603(0x275)],'newStatus':_0x1a2531['status'],'paymentDetails':_0x1a2531[_0x1da603(0x21e)],'checkedAt':new Date()['toISOString']()})}}),await this[_0x1da603(0x24d)](_0x2db78a,_0x1a2531[_0x1da603(0x275)]),await this[_0x1da603(0x208)](_0x2db78a,_0x1a2531[_0x1da603(0x275)]),_0x1a2531['status']!=='PENDING'&&(console[_0x1da603(0x262)](_0x1da603(0x20e)+_0x2db78a['id']+_0x1da603(0x1e4)+_0x1a2531['status']+_0x1da603(0x1fd)),this[_0x1da603(0x1a6)](_0x2db78a['id'])),console['log'](_0x1da603(0x270)+_0x2db78a['id']+_0x1da603(0x1da));}else console[_0x1da603(0x262)](_0x1da603(0x25b)+_0x2db78a['id']+_0x1da603(0x1e1)+_0x1a2531[_0x1da603(0x275)]+')'),this[_0x1da603(0x1bd)](_0x2db78a['id'],_0x2db78a[_0x1da603(0x273)],_0x2db78a[_0x1da603(0x275)],_0x1a2531[_0x1da603(0x275)],_0x1da603(0x1a3),{'statusUnchanged':!![],'paymentDetails':_0x1a2531[_0x1da603(0x21e)],'amount':_0x1a2531[_0x1da603(0x1e6)],'currency':_0x1a2531[_0x1da603(0x210)],'shopId':_0x2db78a[_0x1da603(0x20d)],'checkTimestamp':new Date()['toISOString']()});}catch(_0x4abe5d){console['error'](_0x1da603(0x1fa)+_0x2db78a['id']+':',_0x4abe5d),this[_0x1da603(0x1c8)](_0x2db78a['id'],_0x2db78a[_0x1da603(0x273)],_0x4abe5d,'status_check',{'paymentAmount':_0x2db78a[_0x1da603(0x1e6)],'paymentCurrency':_0x2db78a[_0x1da603(0x210)],'shopId':_0x2db78a['shopId'],'createdAt':_0x2db78a[_0x1da603(0x21a)]}),await database_1['default'][_0x1da603(0x245)][_0x1da603(0x199)]({'data':{'paymentId':_0x2db78a['id'],'shopId':_0x2db78a['shopId'],'event':_0x1da603(0x227),'statusCode':0x1f4,'responseBody':JSON[_0x1da603(0x29a)]({'error':_0x4abe5d instanceof Error?_0x4abe5d[_0x1da603(0x1ad)]:_0x1da603(0x22b),'gatewayPaymentId':_0x2db78a[_0x1da603(0x273)],'checkedAt':new Date()[_0x1da603(0x1ba)]()})}});}}async[a38_0x134fbb(0x24d)](_0x3de4e7,_0x41de00){const _0xe84455=a38_0x134fbb,_0x45c55c=Date[_0xe84455(0x1aa)]();try{const _0x5ba466=_0x3de4e7[_0xe84455(0x1f9)],_0x219d48=_0x5ba466[_0xe84455(0x293)];if(!_0x219d48?.['webhookUrl']){console[_0xe84455(0x262)](_0xe84455(0x27e)+_0x5ba466['id']);return;}const _0x4d406c=_0x41de00===_0xe84455(0x289)?_0xe84455(0x23c):_0x41de00===_0xe84455(0x1d2)?'payment.failed':_0x41de00===_0xe84455(0x267)?_0xe84455(0x21b):'payment.pending';if(!_0x219d48[_0xe84455(0x209)]?.['includes'](_0x4d406c)){console[_0xe84455(0x262)]('Webhook\x20event\x20'+_0x4d406c+_0xe84455(0x263)+_0x5ba466['id']);return;}const _0xe4b98d=(0x0,gateway_1[_0xe84455(0x1b7)])(_0x3de4e7['gateway'])||_0x3de4e7[_0xe84455(0x191)],_0x3e8c5b={'event':_0x4d406c,'payment':{'id':_0x3de4e7['id'],'order_id':_0x3de4e7[_0xe84455(0x26b)],'gateway_order_id':_0x3de4e7[_0xe84455(0x1cb)],'gateway':_0xe4b98d,'amount':_0x3de4e7[_0xe84455(0x1e6)],'currency':_0x3de4e7['currency'],'status':_0x41de00[_0xe84455(0x1f1)](),'customer_email':_0x3de4e7[_0xe84455(0x1ec)],'customer_name':_0x3de4e7[_0xe84455(0x1b4)],'created_at':_0x3de4e7[_0xe84455(0x21a)],'updated_at':new Date()}},_0x4a8266=await fetch(_0x219d48[_0xe84455(0x247)],{'method':'POST','headers':{'Content-Type':'application/json','User-Agent':_0xe84455(0x225)},'body':JSON[_0xe84455(0x29a)](_0x3e8c5b)}),_0x1cdb23=Date['now']()-_0x45c55c,_0x48ca89=_0x4a8266['ok']?_0xe84455(0x1d0):await _0x4a8266[_0xe84455(0x1a9)]();loggerService_1[_0xe84455(0x1b9)][_0xe84455(0x231)](_0x3de4e7[_0xe84455(0x20d)],_0x219d48['webhookUrl'],_0x4d406c,_0x4a8266[_0xe84455(0x275)],_0x1cdb23,_0x3e8c5b),console[_0xe84455(0x262)]('Shop\x20webhook\x20sent\x20to\x20'+_0x219d48[_0xe84455(0x247)]+_0xe84455(0x20b)+_0x4a8266['status']+'\x20('+_0x1cdb23+'ms)');}catch(_0x13e8e8){console[_0xe84455(0x256)](_0xe84455(0x23a),_0x13e8e8),loggerService_1[_0xe84455(0x1b9)][_0xe84455(0x1a7)](_0x3de4e7['shopId'],_0x3de4e7[_0xe84455(0x1f9)]?.[_0xe84455(0x293)]?.[_0xe84455(0x247)]||'unknown',_0xe84455(0x25d),_0x13e8e8,{});}}async[a38_0x134fbb(0x208)](_0x153fe7,_0x9b0a0){const _0x56d3cd=a38_0x134fbb;try{const _0x25032a={'PENDING':_0x56d3cd(0x233),'PAID':_0x56d3cd(0x250),'FAILED':_0x56d3cd(0x292),'EXPIRED':'expired'},_0x128f25=_0x25032a[_0x9b0a0];if(!_0x128f25||_0x128f25===_0x56d3cd(0x233))return;await telegramBotService_1[_0x56d3cd(0x274)][_0x56d3cd(0x26a)](_0x153fe7[_0x56d3cd(0x20d)],_0x153fe7,_0x128f25);}catch(_0x27a5b8){console[_0x56d3cd(0x256)](_0x56d3cd(0x243),_0x27a5b8);}}async[a38_0x134fbb(0x1b5)](_0x399529){const _0x3c42ab=a38_0x134fbb;console[_0x3c42ab(0x262)]('🔍\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20'+_0x399529);const _0x324e5a=await database_1[_0x3c42ab(0x28b)][_0x3c42ab(0x1d3)][_0x3c42ab(0x1dd)]({'where':{'id':_0x399529},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x324e5a)throw new Error('Payment\x20not\x20found');if(_0x324e5a[_0x3c42ab(0x191)]!==_0x3c42ab(0x232)&&_0x324e5a[_0x3c42ab(0x191)]!==_0x3c42ab(0x18a))throw new Error(_0x3c42ab(0x25f));console[_0x3c42ab(0x262)](_0x3c42ab(0x220)+_0x324e5a[_0x3c42ab(0x191)]+'\x20payment\x20'+_0x399529),await this[_0x3c42ab(0x221)](_0x324e5a),console['log'](_0x3c42ab(0x282)+_0x399529);}[a38_0x134fbb(0x254)](){const _0x30f74c=a38_0x134fbb,_0x2a8eca=this[_0x30f74c(0x202)]?this['GLOBAL_CHECK_INTERVAL_MS']:undefined,_0x3061d1=Array[_0x30f74c(0x19d)](this[_0x30f74c(0x1ce)][_0x30f74c(0x21f)]())['map'](_0x39fd62=>({'paymentId':_0x39fd62['paymentId'],'gatewayPaymentId':_0x39fd62[_0x30f74c(0x273)],'createdAt':_0x39fd62[_0x30f74c(0x21a)],'timersCount':_0x39fd62[_0x30f74c(0x1a8)][_0x30f74c(0x1d4)]}));return{'isActive':!!this['globalCheckInterval'],'globalCheckIntervalMinutes':this['GLOBAL_CHECK_INTERVAL_MS']/(0x3e8*0x3c),'expiryDays':this[_0x30f74c(0x189)],'activeIndividualTimers':this['paymentTimers'][_0x30f74c(0x198)],'nextGlobalCheckIn':_0x2a8eca,'paymentTimersDetails':_0x3061d1};}['getPaymentTimerInfo'](_0x46a5a9){const _0x319347=a38_0x134fbb,_0x37056e=this[_0x319347(0x1ce)][_0x319347(0x23f)](_0x46a5a9);if(_0x37056e)return{'hasTimers':!![],'timersCount':_0x37056e[_0x319347(0x1a8)][_0x319347(0x1d4)],'createdAt':_0x37056e[_0x319347(0x21a)],'gatewayPaymentId':_0x37056e[_0x319347(0x273)]};return{'hasTimers':![]};}async[a38_0x134fbb(0x1bf)](_0x48e848,_0x31b9c3){const _0x5110d3=a38_0x134fbb;try{const _0x4e4336=await database_1[_0x5110d3(0x28b)][_0x5110d3(0x1f9)]['findUnique']({'where':{'id':_0x48e848},'select':{'gatewaySettings':!![]}});if(!_0x4e4336?.['gatewaySettings'])return console[_0x5110d3(0x262)](_0x5110d3(0x244)+_0x48e848+',\x20using\x20default\x20commission\x2010%'),0xa;const _0x5cd3a1=JSON[_0x5110d3(0x259)](_0x4e4336[_0x5110d3(0x268)]);for(const [_0x527111,_0xf14d0]of Object['entries'](_0x5cd3a1)){if(_0x527111[_0x5110d3(0x1f1)]()===_0x31b9c3[_0x5110d3(0x1f1)]()){const _0x58cf8e=_0xf14d0[_0x5110d3(0x1bc)]||0xa;return console['log'](_0x5110d3(0x217)+_0x31b9c3+_0x5110d3(0x24b)+_0x48e848+':\x20'+_0x58cf8e+'%'),_0x58cf8e;}}return console['log'](_0x5110d3(0x288)+_0x31b9c3+_0x5110d3(0x216)+_0x48e848+',\x20using\x20default\x2010%'),0xa;}catch(_0x515fe7){return console['error'](_0x5110d3(0x294)+_0x48e848+',\x20gateway\x20'+_0x31b9c3+':',_0x515fe7),0xa;}}}exports['CoinToPayStatusService']=CoinToPayStatusService,exports[a38_0x134fbb(0x279)]=new CoinToPayStatusService();