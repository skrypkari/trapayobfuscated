'use strict';const a37_0x2b7862=a37_0x3e11;(function(_0x35bfaf,_0x4ed1ac){const _0xba2639=a37_0x3e11,_0x280bf3=_0x35bfaf();while(!![]){try{const _0x50e099=-parseInt(_0xba2639(0xf1))/0x1*(parseInt(_0xba2639(0x10e))/0x2)+parseInt(_0xba2639(0xd9))/0x3*(parseInt(_0xba2639(0x180))/0x4)+-parseInt(_0xba2639(0x176))/0x5*(-parseInt(_0xba2639(0xad))/0x6)+parseInt(_0xba2639(0x14a))/0x7*(-parseInt(_0xba2639(0xfb))/0x8)+parseInt(_0xba2639(0x191))/0x9*(-parseInt(_0xba2639(0xae))/0xa)+parseInt(_0xba2639(0x11f))/0xb+-parseInt(_0xba2639(0x140))/0xc*(-parseInt(_0xba2639(0x104))/0xd);if(_0x50e099===_0x4ed1ac)break;else _0x280bf3['push'](_0x280bf3['shift']());}catch(_0x143117){_0x280bf3['push'](_0x280bf3['shift']());}}}(a37_0x5600,0x88463));var __importDefault=this&&this['__importDefault']||function(_0x3cad6a){const _0xfc0087=a37_0x3e11;return _0x3cad6a&&_0x3cad6a[_0xfc0087(0x189)]?_0x3cad6a:{'default':_0x3cad6a};};Object['defineProperty'](exports,a37_0x2b7862(0x189),{'value':!![]}),exports[a37_0x2b7862(0xd6)]=exports[a37_0x2b7862(0x9c)]=void 0x0;const coinToPayService_1=require(a37_0x2b7862(0x15b)),coinToPay2Service_1=require('./gateways/coinToPay2Service'),gateway_1=require(a37_0x2b7862(0x14f)),database_1=__importDefault(require(a37_0x2b7862(0x157))),telegramBotService_1=require(a37_0x2b7862(0x129)),loggerService_1=require(a37_0x2b7862(0xa8)),currencyService_1=require(a37_0x2b7862(0x171));class CoinToPayStatusService{constructor(){const _0x1f60aa=a37_0x2b7862;this['globalCheckInterval']=null,this['GLOBAL_CHECK_INTERVAL_MS']=0x3c*0x3c*0x3e8,this[_0x1f60aa(0x100)]=0x5,this['paymentTimers']=new Map(),this[_0x1f60aa(0xf3)]=new coinToPayService_1['CoinToPayService'](),this[_0x1f60aa(0x131)]=new coinToPay2Service_1[(_0x1f60aa(0xcb))](),console[_0x1f60aa(0x170)]('ü™ô\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2');}[a37_0x2b7862(0xfa)](_0x265dda,_0x4c5269){const _0x385f66=a37_0x2b7862;console[_0x385f66(0x170)]('ü™ô\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:'),console[_0x385f66(0x170)]('\x20\x20\x20-\x20paymentId:\x20'+_0x265dda),console[_0x385f66(0x170)](_0x385f66(0x114)+_0x4c5269),this[_0x385f66(0x160)](_0x265dda);const _0x13ea30=[],_0x4e7d8f=new Date(),_0x4cca88=[{'delay':0x1*0x3c*0x3e8,'description':'1\x20minute'},{'delay':0x2*0x3c*0x3e8,'description':'2\x20minutes'},{'delay':0x5*0x3c*0x3e8,'description':_0x385f66(0xd1)},{'delay':0x5*0x3c*0x3e8,'description':'5\x20minutes'}];console[_0x385f66(0x170)](_0x385f66(0xec)+_0x4cca88[_0x385f66(0x95)]+_0x385f66(0x155)+_0x265dda);let _0xec92fa=0x0;_0x4cca88[_0x385f66(0x128)]((_0x313577,_0x54afdc)=>{const _0x3f7291=_0x385f66;_0xec92fa+=_0x313577[_0x3f7291(0x9e)];const _0x289d64=setTimeout(async()=>{const _0x35bbbb=_0x3f7291;console['log']('ü™ô\x20[TIMER]\x20Individual\x20check\x20#'+(_0x54afdc+0x1)+_0x35bbbb(0x159)+_0x265dda+_0x35bbbb(0xdb)+_0x313577[_0x35bbbb(0xfd)]+')');try{await this['checkSinglePaymentById'](_0x265dda),console['log']('‚úÖ\x20[TIMER]\x20Individual\x20check\x20#'+(_0x54afdc+0x1)+_0x35bbbb(0xbf)+_0x265dda);}catch(_0xf122c6){console[_0x35bbbb(0xda)]('‚ùå\x20[TIMER]\x20Failed\x20individual\x20check\x20#'+(_0x54afdc+0x1)+'\x20for\x20payment\x20'+_0x265dda+':',_0xf122c6),this[_0x35bbbb(0x17f)](_0x265dda,_0x4c5269,_0xf122c6,'status_check',{'checkNumber':_0x54afdc+0x1,'scheduledAfter':_0x313577[_0x35bbbb(0xfd)],'isIndividualCheck':!![]});}},_0xec92fa);_0x13ea30[_0x3f7291(0x101)](_0x289d64),console['log'](_0x3f7291(0x9b)+(_0x54afdc+0x1)+_0x3f7291(0xf5)+_0x265dda+_0x3f7291(0xcd)+_0xec92fa/0x3e8+_0x3f7291(0xe7)+_0x313577[_0x3f7291(0xfd)]+')');});const _0x1ac91a=setInterval(async()=>{const _0x5ef028=_0x385f66;console[_0x5ef028(0x170)](_0x5ef028(0x14d)+_0x265dda);try{const _0x165f16=await database_1[_0x5ef028(0xd0)][_0x5ef028(0x158)][_0x5ef028(0xc1)]({'where':{'id':_0x265dda},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x165f16){console['log'](_0x5ef028(0xb3)+_0x265dda+_0x5ef028(0x97)),this[_0x5ef028(0x160)](_0x265dda);return;}console[_0x5ef028(0x170)]('üìä\x20[HOURLY]\x20Payment\x20'+_0x265dda+_0x5ef028(0x10f)+_0x165f16[_0x5ef028(0xf0)]);if(_0x165f16[_0x5ef028(0xf0)]!=='PENDING'){console[_0x5ef028(0x170)](_0x5ef028(0xb0)+_0x265dda+_0x5ef028(0x121)+_0x165f16[_0x5ef028(0xf0)]+',\x20stopping\x20individual\x20checks'),this[_0x5ef028(0x160)](_0x265dda);return;}const _0xe0b556=Math['floor']((Date['now']()-_0x165f16[_0x5ef028(0x113)][_0x5ef028(0xc5)]())/(0x3e8*0x3c*0x3c*0x18));if(_0xe0b556>=this['EXPIRY_DAYS']){console[_0x5ef028(0x170)](_0x5ef028(0x18a)+_0x265dda+_0x5ef028(0xe2)+this[_0x5ef028(0x100)]+'\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check'),this['clearPaymentTimers'](_0x265dda);return;}await this[_0x5ef028(0x173)](_0x265dda),console[_0x5ef028(0x170)](_0x5ef028(0xb5)+_0x265dda);}catch(_0x2d7080){console['error'](_0x5ef028(0x17b)+_0x265dda+':',_0x2d7080),this[_0x5ef028(0x17f)](_0x265dda,_0x4c5269,_0x2d7080,_0x5ef028(0x103),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x13ea30[_0x385f66(0x101)](_0x1ac91a),this[_0x385f66(0x93)][_0x385f66(0x15d)](_0x265dda,{'timers':_0x13ea30,'paymentId':_0x265dda,'gatewayPaymentId':_0x4c5269,'createdAt':_0x4e7d8f}),console[_0x385f66(0x170)](_0x385f66(0x16f)+_0x4cca88[_0x385f66(0x95)]+'\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20'+_0x265dda),console[_0x385f66(0x170)]('üìä\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20'+this['paymentTimers']['size']),this[_0x385f66(0x124)](_0x265dda,_0x4c5269,'PENDING',_0x385f66(0x11d),_0x385f66(0x103),{'action':_0x385f66(0xb1),'scheduledChecks':_0x4cca88[_0x385f66(0x95)],'firstCheckIn':_0x4cca88[0x0][_0x385f66(0x9e)]/0x3e8,'totalTimers':this[_0x385f66(0x93)]['size']});}[a37_0x2b7862(0x160)](_0x3ec3bb){const _0x33b412=a37_0x2b7862,_0x5614ef=this[_0x33b412(0x93)][_0x33b412(0x120)](_0x3ec3bb);_0x5614ef?(console[_0x33b412(0x170)]('üßπ\x20[DEBUG]\x20Clearing\x20'+_0x5614ef[_0x33b412(0xe0)]['length']+'\x20timers\x20for\x20payment\x20'+_0x3ec3bb),_0x5614ef['timers'][_0x33b412(0x128)]((_0x261175,_0x5b5164)=>{const _0x542057=_0x33b412;_0x261175&&(clearTimeout(_0x261175),clearInterval(_0x261175),console[_0x542057(0x170)](_0x542057(0x196)+(_0x5b5164+0x1)+_0x542057(0xf5)+_0x3ec3bb));}),this[_0x33b412(0x93)][_0x33b412(0x13a)](_0x3ec3bb),console[_0x33b412(0x170)](_0x33b412(0xc8)+_0x3ec3bb+'.\x20Remaining\x20active\x20timers:\x20'+this[_0x33b412(0x93)][_0x33b412(0x108)])):console[_0x33b412(0x170)](_0x33b412(0xf8)+_0x3ec3bb+_0x33b412(0x193));}async[a37_0x2b7862(0x173)](_0x8f94ae){const _0x285117=a37_0x2b7862;console[_0x285117(0x170)]('üîç\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20'+_0x8f94ae);const _0xcaf39d=await database_1['default']['payment'][_0x285117(0xc1)]({'where':{'id':_0x8f94ae},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0xcaf39d){console[_0x285117(0x170)](_0x285117(0xa1)+_0x8f94ae+_0x285117(0xba));return;}console[_0x285117(0x170)](_0x285117(0x167)+_0x8f94ae+_0x285117(0x153)),console[_0x285117(0x170)](_0x285117(0x135)+_0xcaf39d[_0x285117(0x16b)]),console[_0x285117(0x170)](_0x285117(0x112)+_0xcaf39d[_0x285117(0xf0)]),console[_0x285117(0x170)](_0x285117(0x92)+_0xcaf39d[_0x285117(0x18f)]),console[_0x285117(0x170)](_0x285117(0x130)+_0xcaf39d[_0x285117(0x16a)]+'\x20'+_0xcaf39d[_0x285117(0x12c)]),console['log'](_0x285117(0x12a)+_0xcaf39d[_0x285117(0x16d)]);if(_0xcaf39d[_0x285117(0x16b)]!==_0x285117(0x9f)&&_0xcaf39d[_0x285117(0x16b)]!==_0x285117(0x182)){console[_0x285117(0x170)](_0x285117(0x15a)+_0x8f94ae+_0x285117(0x179)+_0xcaf39d[_0x285117(0x16b)]+')');return;}if(_0xcaf39d[_0x285117(0xf0)]!==_0x285117(0x11d)){console['log'](_0x285117(0x15a)+_0x8f94ae+_0x285117(0x121)+_0xcaf39d[_0x285117(0xf0)]+_0x285117(0x18e)),this[_0x285117(0x160)](_0x8f94ae);return;}if(!_0xcaf39d[_0x285117(0x18f)]){console[_0x285117(0x170)]('‚ö†Ô∏è\x20[CHECK]\x20Payment\x20'+_0x8f94ae+'\x20has\x20no\x20gatewayPaymentId');return;}console[_0x285117(0x170)](_0x285117(0x134)+_0x8f94ae+_0x285117(0x18c)),await this[_0x285117(0x111)](_0xcaf39d);}[a37_0x2b7862(0x124)](_0x12654f,_0x756876,_0x5e9f02,_0x5f5698,_0x5cbaf7,_0x4b07b4){const _0x44f804=a37_0x2b7862,_0x1514c3={'type':_0x44f804(0x175),'paymentId':_0x12654f,'gatewayPaymentId':_0x756876,'oldStatus':_0x5e9f02,'newStatus':_0x5f5698,'source':_0x5cbaf7,'timestamp':new Date()[_0x44f804(0x199)](),'details':_0x4b07b4||{}};loggerService_1['loggerService'][_0x44f804(0x124)](_0x1514c3),console[_0x44f804(0x170)](_0x44f804(0x110)+_0x12654f+'\x20('+_0x756876+')'),console[_0x44f804(0x170)](_0x44f804(0x142)+_0x5e9f02+'\x20->\x20'+_0x5f5698),console[_0x44f804(0x170)](_0x44f804(0xe6)+_0x5cbaf7),console['log'](_0x44f804(0xc4)+_0x1514c3[_0x44f804(0x12b)]),_0x4b07b4&&console[_0x44f804(0x170)]('\x20\x20\x20üìù\x20Details:',_0x4b07b4);}[a37_0x2b7862(0x17f)](_0x3cee96,_0x205995,_0x525615,_0x4c618a,_0x234b70){const _0x3efcea=a37_0x2b7862,_0x10d540={'type':_0x3efcea(0xa7),'paymentId':_0x3cee96,'gatewayPaymentId':_0x205995,'error':_0x525615 instanceof Error?{'message':_0x525615[_0x3efcea(0x10a)],'stack':_0x525615['stack']}:_0x525615,'source':_0x4c618a,'timestamp':new Date()[_0x3efcea(0x199)](),'context':_0x234b70||{}};loggerService_1['loggerService'][_0x3efcea(0x17f)](_0x10d540),console['error']('ü™ô\x20[ERROR]\x20CoinToPay\x20Error:\x20'+_0x3cee96+'\x20('+_0x205995+')'),console[_0x3efcea(0xda)](_0x3efcea(0x98)+(_0x525615 instanceof Error?_0x525615['message']:_0x525615)),console[_0x3efcea(0xda)](_0x3efcea(0xe6)+_0x4c618a),console[_0x3efcea(0xda)](_0x3efcea(0xc4)+_0x10d540[_0x3efcea(0x12b)]),_0x234b70&&console[_0x3efcea(0xda)](_0x3efcea(0xea),_0x234b70);}[a37_0x2b7862(0xb9)](){const _0x2035bb=a37_0x2b7862;console[_0x2035bb(0x170)](_0x2035bb(0x136)),this[_0x2035bb(0x106)]()[_0x2035bb(0x18d)](_0x1c41d5=>{const _0x204409=_0x2035bb;console[_0x204409(0xda)](_0x204409(0xac),_0x1c41d5);}),this['globalCheckInterval']=setInterval(async()=>{const _0x4a649a=_0x2035bb;try{console[_0x4a649a(0x170)]('ü™ô\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...'),await this[_0x4a649a(0x106)](),console[_0x4a649a(0x170)]('‚úÖ\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed');}catch(_0x1c6828){console[_0x4a649a(0xda)](_0x4a649a(0x162),_0x1c6828);}},this[_0x2035bb(0x149)]),console['log'](_0x2035bb(0xbb));}[a37_0x2b7862(0xd4)](){const _0x3d625a=a37_0x2b7862;console['log'](_0x3d625a(0x165));this[_0x3d625a(0xab)]&&(clearInterval(this['globalCheckInterval']),this[_0x3d625a(0xab)]=null,console['log'](_0x3d625a(0xb6)));const _0x34f7ec=this[_0x3d625a(0x93)]['size'];for(const [_0x2d7fa0]of this[_0x3d625a(0x93)]){this[_0x3d625a(0x160)](_0x2d7fa0);}console['log'](_0x3d625a(0x192)+_0x34f7ec+_0x3d625a(0x15f));}async[a37_0x2b7862(0x106)](){const _0x479e04=a37_0x2b7862;try{console['log'](_0x479e04(0xd7));const _0x3c0e67=await database_1[_0x479e04(0xd0)]['payment']['findMany']({'where':{'gateway':{'in':['cointopay',_0x479e04(0x182)]},'status':'PENDING','gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x479e04(0x170)](_0x479e04(0x194)+_0x3c0e67[_0x479e04(0x95)]+_0x479e04(0x13c));if(_0x3c0e67[_0x479e04(0x95)]===0x0){console[_0x479e04(0x170)](_0x479e04(0x17e));return;}const _0x311d8d=await this[_0x479e04(0x122)](_0x3c0e67);console[_0x479e04(0x170)]('‚è∞\x20[GLOBAL]\x20Found\x20'+_0x311d8d['length']+_0x479e04(0x177));let _0x55dcc7=0x0,_0x374976=0x0;for(const _0x8ea3d0 of _0x3c0e67){try{if(_0x311d8d[_0x479e04(0x178)](_0x8ea3d0['id'])){console[_0x479e04(0x170)](_0x479e04(0x9a)+_0x8ea3d0['id']+'\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check'),_0x374976++;continue;}if(this[_0x479e04(0x93)][_0x479e04(0xfe)](_0x8ea3d0['id'])){console[_0x479e04(0x170)](_0x479e04(0x9a)+_0x8ea3d0['id']+_0x479e04(0x90)),_0x374976++;continue;}const _0x54df83=(Date['now']()-_0x8ea3d0[_0x479e04(0x113)][_0x479e04(0xc5)]())/(0x3e8*0x3c*0x3c);if(_0x54df83<0x1){console['log']('‚è∞\x20[GLOBAL]\x20Payment\x20'+_0x8ea3d0['id']+_0x479e04(0xc7)+_0x54df83['toFixed'](0x1)+'h),\x20skipping\x20global\x20check'),_0x374976++;continue;}console[_0x479e04(0x170)]('üîç\x20[GLOBAL]\x20Checking\x20old\x20payment\x20'+_0x8ea3d0['id']+_0x479e04(0x185)+_0x54df83[_0x479e04(0x147)](0x1)+'h)'),await this[_0x479e04(0x111)](_0x8ea3d0),_0x55dcc7++,await new Promise(_0x3ee682=>setTimeout(_0x3ee682,0x7d0));}catch(_0x1d692d){console[_0x479e04(0xda)](_0x479e04(0xbc)+_0x8ea3d0['id']+':',_0x1d692d),this['logCoinToPayError'](_0x8ea3d0['id'],_0x8ea3d0['gatewayPaymentId']||_0x479e04(0x126),_0x1d692d,_0x479e04(0x103),{'isGlobalCheck':!![],'paymentAmount':_0x8ea3d0[_0x479e04(0x16a)],'paymentCurrency':_0x8ea3d0[_0x479e04(0x12c)],'shopId':_0x8ea3d0[_0x479e04(0x16d)],'createdAt':_0x8ea3d0[_0x479e04(0x113)]}),loggerService_1['loggerService'][_0x479e04(0xf4)](_0x479e04(0x9f),_0x479e04(0x12f)+_0x8ea3d0[_0x479e04(0x18f)],_0x1d692d);}}console['log'](_0x479e04(0x123)+_0x55dcc7+_0x479e04(0x166)+_0x374976+_0x479e04(0x17d)+_0x311d8d[_0x479e04(0x95)]+'\x20expired');}catch(_0x5199e0){console[_0x479e04(0xda)](_0x479e04(0x12d),_0x5199e0);}}async[a37_0x2b7862(0x122)](_0x5902d4){const _0xd72b25=a37_0x2b7862,_0x124bad=[],_0x2076e2=new Date();_0x2076e2[_0xd72b25(0x13f)](_0x2076e2['getDate']()-this[_0xd72b25(0x100)]),console[_0xd72b25(0x170)]('‚è∞\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20'+this['EXPIRY_DAYS']+_0xd72b25(0xf9)+_0x2076e2[_0xd72b25(0x199)]()+')');for(const _0x40f4e6 of _0x5902d4){if(_0x40f4e6[_0xd72b25(0x113)]<_0x2076e2){console[_0xd72b25(0x170)](_0xd72b25(0x164)+_0x40f4e6['id']+_0xd72b25(0xe2)+this[_0xd72b25(0x100)]+_0xd72b25(0xa5));try{this[_0xd72b25(0x124)](_0x40f4e6['id'],_0x40f4e6['gatewayPaymentId']||_0xd72b25(0x126),_0xd72b25(0x11d),_0xd72b25(0xee),'auto_expire',{'reason':'Payment\x20older\x20than\x20'+this[_0xd72b25(0x100)]+_0xd72b25(0x115),'createdAt':_0x40f4e6[_0xd72b25(0x113)],'daysSinceCreation':Math[_0xd72b25(0xa3)]((Date[_0xd72b25(0xd2)]()-_0x40f4e6[_0xd72b25(0x113)][_0xd72b25(0xc5)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x40f4e6[_0xd72b25(0x16a)],'paymentCurrency':_0x40f4e6[_0xd72b25(0x12c)],'shopId':_0x40f4e6[_0xd72b25(0x16d)]}),await database_1[_0xd72b25(0xd0)][_0xd72b25(0x158)]['update']({'where':{'id':_0x40f4e6['id']},'data':{'status':'EXPIRED','updatedAt':new Date(),'adminNotes':_0xd72b25(0x125)+this[_0xd72b25(0x100)]+_0xd72b25(0xe8)}}),await database_1['default'][_0xd72b25(0xaa)][_0xd72b25(0xa6)]({'data':{'paymentId':_0x40f4e6['id'],'shopId':_0x40f4e6[_0xd72b25(0x16d)],'event':_0xd72b25(0x145),'statusCode':0xc8,'responseBody':JSON['stringify']({'reason':_0xd72b25(0xeb)+this[_0xd72b25(0x100)]+_0xd72b25(0x115),'createdAt':_0x40f4e6[_0xd72b25(0x113)],'expiredAt':new Date()[_0xd72b25(0x199)](),'daysSinceCreation':Math[_0xd72b25(0xa3)]((Date[_0xd72b25(0xd2)]()-_0x40f4e6[_0xd72b25(0x113)][_0xd72b25(0xc5)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0xd72b25(0x169)](_0x40f4e6,_0xd72b25(0xee)),await this[_0xd72b25(0x183)](_0x40f4e6,_0xd72b25(0xee)),this['clearPaymentTimers'](_0x40f4e6['id']),_0x124bad[_0xd72b25(0x101)](_0x40f4e6['id']),console[_0xd72b25(0x170)](_0xd72b25(0x16c)+_0x40f4e6['id']+_0xd72b25(0x190)+this[_0xd72b25(0x100)]+_0xd72b25(0x14c));}catch(_0x197e90){console[_0xd72b25(0xda)]('‚ùå\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20'+_0x40f4e6['id']+':',_0x197e90),this['logCoinToPayError'](_0x40f4e6['id'],_0x40f4e6[_0xd72b25(0x18f)]||'unknown',_0x197e90,'auto_expire',{'reason':_0xd72b25(0xc6),'createdAt':_0x40f4e6[_0xd72b25(0x113)],'daysSinceCreation':Math[_0xd72b25(0xa3)]((Date[_0xd72b25(0xd2)]()-_0x40f4e6[_0xd72b25(0x113)][_0xd72b25(0xc5)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x124bad;}async[a37_0x2b7862(0x111)](_0x35fd50){const _0x4a2bed=a37_0x2b7862;if(!_0x35fd50['gatewayPaymentId']){console[_0x4a2bed(0x170)](_0x4a2bed(0x15a)+_0x35fd50['id']+_0x4a2bed(0xca));return;}console['log'](_0x4a2bed(0xff)+_0x35fd50[_0x4a2bed(0x16b)]+_0x4a2bed(0x116)+_0x35fd50['id']+'\x20('+_0x35fd50[_0x4a2bed(0x18f)]+')');try{let _0xd9725f;_0x35fd50['gateway']==='cointopay2'?(_0xd9725f=await this['coinToPay2Service']['checkPaymentStatus'](_0x35fd50[_0x4a2bed(0x18f)]),console[_0x4a2bed(0x170)](_0x4a2bed(0x96)+_0x35fd50['id']+_0x4a2bed(0x14e)+_0xd9725f[_0x4a2bed(0xf0)])):(_0xd9725f=await this[_0x4a2bed(0xf3)][_0x4a2bed(0x13d)](_0x35fd50['gatewayPaymentId']),console['log'](_0x4a2bed(0x156)+_0x35fd50['id']+'\x20status:\x20'+_0xd9725f[_0x4a2bed(0xf0)]));_0xd9725f['paymentDetails']&&console[_0x4a2bed(0x170)](_0x4a2bed(0x167)+_0x35fd50['id']+_0x4a2bed(0xa2),{'iban':_0xd9725f['paymentDetails'][_0x4a2bed(0x18b)]||_0x4a2bed(0xf6),'transactionId':_0xd9725f['paymentDetails'][_0x4a2bed(0x11b)],'createdOn':_0xd9725f[_0x4a2bed(0xbd)][_0x4a2bed(0xb8)],'confirmedOn':_0xd9725f[_0x4a2bed(0xbd)][_0x4a2bed(0x184)]||_0x4a2bed(0x150)});if(_0xd9725f['status']!==_0x35fd50[_0x4a2bed(0xf0)]){console[_0x4a2bed(0x170)](_0x4a2bed(0x161)+_0x35fd50['id']+_0x4a2bed(0x188)+_0x35fd50[_0x4a2bed(0xf0)]+_0x4a2bed(0x17c)+_0xd9725f[_0x4a2bed(0xf0)]),this[_0x4a2bed(0x124)](_0x35fd50['id'],_0x35fd50[_0x4a2bed(0x18f)],_0x35fd50[_0x4a2bed(0xf0)],_0xd9725f[_0x4a2bed(0xf0)],'status_check',{'paymentDetails':_0xd9725f['paymentDetails'],'amount':_0xd9725f['amount'],'currency':_0xd9725f[_0x4a2bed(0x12c)],'shopId':_0x35fd50[_0x4a2bed(0x16d)],'checkTimestamp':new Date()[_0x4a2bed(0x199)]()});const _0x33d754={'status':_0xd9725f['status'],'updatedAt':new Date()};if(_0xd9725f[_0x4a2bed(0xf0)]===_0x4a2bed(0x141)&&_0x35fd50['status']!=='PAID'){_0x33d754[_0x4a2bed(0x133)]=new Date();if(!_0x35fd50[_0x4a2bed(0x11c)]){const _0x10ed35=await currencyService_1[_0x4a2bed(0x10d)][_0x4a2bed(0x143)](_0x35fd50[_0x4a2bed(0x16a)],_0x35fd50[_0x4a2bed(0x12c)]);_0x33d754['amountUSDT']=_0x10ed35;const _0x21f773=await this['getGatewayCommission'](_0x35fd50[_0x4a2bed(0x16d)],_0x35fd50[_0x4a2bed(0x16b)]),_0x42c22b=_0x10ed35*(0x1-_0x21f773/0x64);_0x33d754['amountAfterGatewayCommissionUSDT']=_0x42c22b,console[_0x4a2bed(0x170)](_0x4a2bed(0x146)+_0x35fd50['id']+_0x4a2bed(0xd8)),console[_0x4a2bed(0x170)](_0x4a2bed(0x12e)+_0x35fd50['amount']+'\x20'+_0x35fd50[_0x4a2bed(0x12c)]+_0x4a2bed(0x127)+_0x10ed35[_0x4a2bed(0x147)](0x6)+_0x4a2bed(0xd3)),console[_0x4a2bed(0x170)](_0x4a2bed(0xdf)+_0x35fd50[_0x4a2bed(0x16b)]+_0x4a2bed(0xcc)+_0x21f773+'%'),console['log']('\x20\x20\x20Amount\x20after\x20commission:\x20'+_0x42c22b[_0x4a2bed(0x147)](0x6)+_0x4a2bed(0xd3));}console[_0x4a2bed(0x170)](_0x4a2bed(0x146)+_0x35fd50['id']+_0x4a2bed(0xd5)+_0x33d754[_0x4a2bed(0x133)]['toISOString']());}if(_0xd9725f[_0x4a2bed(0xbd)]){const _0x10951b=_0xd9725f[_0x4a2bed(0xbd)];_0x10951b['iban']&&(_0x33d754[_0x4a2bed(0x137)]=_0x10951b[_0x4a2bed(0x18b)],console[_0x4a2bed(0x170)](_0x4a2bed(0xb4)+_0x10951b['iban']));if(_0x10951b[_0x4a2bed(0xa0)]){const _0x11deba=_0x35fd50[_0x4a2bed(0x152)]||'',_0x202575=_0x4a2bed(0xc0)+_0x10951b[_0x4a2bed(0xa0)];_0x33d754[_0x4a2bed(0x152)]=_0x11deba?_0x11deba+'\x0a\x0a'+_0x202575:_0x202575,console['log']('üè¶\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes');}_0x10951b[_0x4a2bed(0x11b)]&&console[_0x4a2bed(0x170)]('üÜî\x20[CHECK]\x20Transaction\x20ID:\x20'+_0x10951b[_0x4a2bed(0x11b)]),_0x10951b['confirmedOn']&&console[_0x4a2bed(0x170)](_0x4a2bed(0xa9)+_0x10951b[_0x4a2bed(0x184)]);}await database_1['default']['payment'][_0x4a2bed(0xdd)]({'where':{'id':_0x35fd50['id']},'data':_0x33d754});if(_0xd9725f[_0x4a2bed(0xf0)]===_0x4a2bed(0x141)&&_0x35fd50[_0x4a2bed(0xf0)]!==_0x4a2bed(0x141)){console[_0x4a2bed(0x170)](_0x4a2bed(0x181)+_0x35fd50['id']+_0x4a2bed(0xe3));const _0x1ef742=await database_1[_0x4a2bed(0xd0)][_0x4a2bed(0x158)]['findUnique']({'where':{'id':_0x35fd50['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x1ef742?.[_0x4a2bed(0x119)]&&_0x1ef742[_0x4a2bed(0x105)])try{const _0x5aca5c=_0x1ef742['paymentLink'];console[_0x4a2bed(0x170)]('üìà\x20[COINTOPAY]\x20Found\x20payment\x20link\x20'+_0x5aca5c['id']+_0x4a2bed(0x144)+_0x5aca5c['type']+_0x4a2bed(0xf2)+_0x5aca5c[_0x4a2bed(0x151)]+_0x4a2bed(0x117)+_0x5aca5c[_0x4a2bed(0xf0)]);const _0x575279=_0x5aca5c[_0x4a2bed(0x151)]+0x1,_0x570d29=_0x5aca5c[_0x4a2bed(0x15e)]===_0x4a2bed(0x14b)?_0x4a2bed(0xc2):_0x5aca5c[_0x4a2bed(0xf0)];await database_1[_0x4a2bed(0xd0)][_0x4a2bed(0x105)][_0x4a2bed(0xdd)]({'where':{'id':_0x5aca5c['id']},'data':{'currentPayments':_0x575279,'status':_0x570d29,'updatedAt':new Date()}}),console['log'](_0x4a2bed(0xc9)+_0x5aca5c['id']+'\x20updated:\x20currentPayments='+_0x5aca5c['currentPayments']+_0x4a2bed(0x127)+_0x575279+_0x4a2bed(0x117)+_0x5aca5c['status']+_0x4a2bed(0x127)+_0x570d29);}catch(_0xa112a9){console[_0x4a2bed(0xda)]('‚ùå\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:',_0xa112a9);}else console[_0x4a2bed(0x170)](_0x4a2bed(0x181)+_0x35fd50['id']+'\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link');}await database_1[_0x4a2bed(0xd0)][_0x4a2bed(0xaa)][_0x4a2bed(0xa6)]({'data':{'paymentId':_0x35fd50['id'],'shopId':_0x35fd50[_0x4a2bed(0x16d)],'event':'cointopay_status_check_'+_0xd9725f[_0x4a2bed(0xf0)][_0x4a2bed(0xbe)](),'statusCode':0xc8,'responseBody':JSON[_0x4a2bed(0x10c)]({'oldStatus':_0x35fd50['status'],'newStatus':_0xd9725f['status'],'paymentDetails':_0xd9725f[_0x4a2bed(0xbd)],'checkedAt':new Date()[_0x4a2bed(0x199)]()})}}),await this['sendShopWebhook'](_0x35fd50,_0xd9725f[_0x4a2bed(0xf0)]),await this[_0x4a2bed(0x183)](_0x35fd50,_0xd9725f[_0x4a2bed(0xf0)]),_0xd9725f['status']!=='PENDING'&&(console[_0x4a2bed(0x170)](_0x4a2bed(0xed)+_0x35fd50['id']+_0x4a2bed(0x16e)+_0xd9725f[_0x4a2bed(0xf0)]+_0x4a2bed(0x99)),this[_0x4a2bed(0x160)](_0x35fd50['id'])),console['log'](_0x4a2bed(0x134)+_0x35fd50['id']+_0x4a2bed(0xef));}else console[_0x4a2bed(0x170)](_0x4a2bed(0x167)+_0x35fd50['id']+_0x4a2bed(0x186)+_0xd9725f[_0x4a2bed(0xf0)]+')'),this[_0x4a2bed(0x124)](_0x35fd50['id'],_0x35fd50['gatewayPaymentId'],_0x35fd50[_0x4a2bed(0xf0)],_0xd9725f[_0x4a2bed(0xf0)],_0x4a2bed(0x103),{'statusUnchanged':!![],'paymentDetails':_0xd9725f['paymentDetails'],'amount':_0xd9725f[_0x4a2bed(0x16a)],'currency':_0xd9725f[_0x4a2bed(0x12c)],'shopId':_0x35fd50['shopId'],'checkTimestamp':new Date()['toISOString']()});}catch(_0x1e1de2){console[_0x4a2bed(0xda)](_0x4a2bed(0xe1)+_0x35fd50['id']+':',_0x1e1de2),this[_0x4a2bed(0x17f)](_0x35fd50['id'],_0x35fd50[_0x4a2bed(0x18f)],_0x1e1de2,_0x4a2bed(0x103),{'paymentAmount':_0x35fd50[_0x4a2bed(0x16a)],'paymentCurrency':_0x35fd50[_0x4a2bed(0x12c)],'shopId':_0x35fd50[_0x4a2bed(0x16d)],'createdAt':_0x35fd50[_0x4a2bed(0x113)]}),await database_1[_0x4a2bed(0xd0)][_0x4a2bed(0xaa)]['create']({'data':{'paymentId':_0x35fd50['id'],'shopId':_0x35fd50['shopId'],'event':_0x4a2bed(0x195),'statusCode':0x1f4,'responseBody':JSON[_0x4a2bed(0x10c)]({'error':_0x1e1de2 instanceof Error?_0x1e1de2['message']:_0x4a2bed(0x163),'gatewayPaymentId':_0x35fd50[_0x4a2bed(0x18f)],'checkedAt':new Date()['toISOString']()})}});}}async['sendShopWebhook'](_0x4c6eb5,_0x416d96){const _0x1d7785=a37_0x2b7862,_0x3344e8=Date[_0x1d7785(0xd2)]();try{const _0x44c620=_0x4c6eb5[_0x1d7785(0xce)],_0x2f907e=_0x44c620[_0x1d7785(0xfc)];if(!_0x2f907e?.[_0x1d7785(0x198)]){console[_0x1d7785(0x170)](_0x1d7785(0x138)+_0x44c620['id']);return;}const _0x499602=_0x416d96===_0x1d7785(0x141)?_0x1d7785(0xb7):_0x416d96===_0x1d7785(0x10b)?_0x1d7785(0xe9):_0x416d96===_0x1d7785(0xee)?_0x1d7785(0xe9):'payment.pending';if(!_0x2f907e[_0x1d7785(0x107)]?.[_0x1d7785(0x178)](_0x499602)){console[_0x1d7785(0x170)](_0x1d7785(0x13e)+_0x499602+'\x20not\x20enabled\x20for\x20shop\x20'+_0x44c620['id']);return;}const _0x234e08=(0x0,gateway_1['getGatewayIdByName'])(_0x4c6eb5[_0x1d7785(0x16b)])||_0x4c6eb5['gateway'],_0x30438e={'event':_0x499602,'payment':{'id':_0x4c6eb5['id'],'order_id':_0x4c6eb5['orderId'],'gateway_order_id':_0x4c6eb5[_0x1d7785(0x168)],'gateway':_0x234e08,'amount':_0x4c6eb5[_0x1d7785(0x16a)],'currency':_0x4c6eb5[_0x1d7785(0x12c)],'status':_0x416d96[_0x1d7785(0xbe)](),'customer_email':_0x4c6eb5[_0x1d7785(0xa4)],'customer_name':_0x4c6eb5[_0x1d7785(0xe4)],'created_at':_0x4c6eb5[_0x1d7785(0x113)],'updated_at':new Date()}},_0xbbf7b0=await fetch(_0x2f907e[_0x1d7785(0x198)],{'method':_0x1d7785(0x139),'headers':{'Content-Type':_0x1d7785(0x148),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON['stringify'](_0x30438e)}),_0x4d2672=Date['now']()-_0x3344e8,_0x10f7f0=_0xbbf7b0['ok']?_0x1d7785(0x17a):await _0xbbf7b0[_0x1d7785(0x172)]();loggerService_1[_0x1d7785(0x174)]['logShopWebhookSent'](_0x4c6eb5[_0x1d7785(0x16d)],_0x2f907e[_0x1d7785(0x198)],_0x499602,_0xbbf7b0['status'],_0x4d2672,_0x30438e),console[_0x1d7785(0x170)](_0x1d7785(0x91)+_0x2f907e['webhookUrl']+'\x20with\x20status\x20'+_0xbbf7b0[_0x1d7785(0xf0)]+'\x20('+_0x4d2672+'ms)');}catch(_0x52cfd5){console[_0x1d7785(0xda)]('Failed\x20to\x20send\x20shop\x20webhook:',_0x52cfd5),loggerService_1[_0x1d7785(0x174)]['logShopWebhookError'](_0x4c6eb5[_0x1d7785(0x16d)],_0x4c6eb5['shop']?.[_0x1d7785(0xfc)]?.[_0x1d7785(0x198)]||_0x1d7785(0x126),_0x1d7785(0xcf),_0x52cfd5,{});}}async['sendPaymentStatusNotification'](_0x710b1f,_0x247e0a){const _0x24ff54=a37_0x2b7862;try{const _0x104c78={'PENDING':_0x24ff54(0xaf),'PAID':_0x24ff54(0xdc),'FAILED':_0x24ff54(0xf7),'EXPIRED':_0x24ff54(0x15c)},_0x5ea95b=_0x104c78[_0x247e0a];if(!_0x5ea95b||_0x5ea95b===_0x24ff54(0xaf))return;await telegramBotService_1['telegramBotService'][_0x24ff54(0x9d)](_0x710b1f[_0x24ff54(0x16d)],_0x710b1f,_0x5ea95b);}catch(_0x5cad98){console[_0x24ff54(0xda)](_0x24ff54(0x94),_0x5cad98);}}async['checkPaymentById'](_0x336821){const _0x221a4f=a37_0x2b7862;console[_0x221a4f(0x170)](_0x221a4f(0xe5)+_0x336821);const _0xe90d6e=await database_1[_0x221a4f(0xd0)]['payment'][_0x221a4f(0xc1)]({'where':{'id':_0x336821},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0xe90d6e)throw new Error('Payment\x20not\x20found');if(_0xe90d6e[_0x221a4f(0x16b)]!==_0x221a4f(0x9f)&&_0xe90d6e[_0x221a4f(0x16b)]!==_0x221a4f(0x182))throw new Error(_0x221a4f(0xb2));console[_0x221a4f(0x170)]('‚úÖ\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20'+_0xe90d6e['gateway']+_0x221a4f(0x116)+_0x336821),await this[_0x221a4f(0x111)](_0xe90d6e),console[_0x221a4f(0x170)](_0x221a4f(0x13b)+_0x336821);}['getServiceStats'](){const _0x10ba4b=a37_0x2b7862,_0x4b85de=this[_0x10ba4b(0xab)]?this[_0x10ba4b(0x149)]:undefined,_0xf9182a=Array['from'](this[_0x10ba4b(0x93)]['values']())['map'](_0x171424=>({'paymentId':_0x171424[_0x10ba4b(0x102)],'gatewayPaymentId':_0x171424[_0x10ba4b(0x18f)],'createdAt':_0x171424[_0x10ba4b(0x113)],'timersCount':_0x171424[_0x10ba4b(0xe0)][_0x10ba4b(0x95)]}));return{'isActive':!!this['globalCheckInterval'],'globalCheckIntervalMinutes':this[_0x10ba4b(0x149)]/(0x3e8*0x3c),'expiryDays':this[_0x10ba4b(0x100)],'activeIndividualTimers':this['paymentTimers'][_0x10ba4b(0x108)],'nextGlobalCheckIn':_0x4b85de,'paymentTimersDetails':_0xf9182a};}[a37_0x2b7862(0x118)](_0xdd6026){const _0x52a0c0=a37_0x2b7862,_0x5ac685=this['paymentTimers'][_0x52a0c0(0x120)](_0xdd6026);if(_0x5ac685)return{'hasTimers':!![],'timersCount':_0x5ac685[_0x52a0c0(0xe0)][_0x52a0c0(0x95)],'createdAt':_0x5ac685['createdAt'],'gatewayPaymentId':_0x5ac685[_0x52a0c0(0x18f)]};return{'hasTimers':![]};}async[a37_0x2b7862(0x132)](_0x3c7838,_0x26c13f){const _0x584554=a37_0x2b7862;try{const _0x552bce=await database_1['default']['shop'][_0x584554(0xc1)]({'where':{'id':_0x3c7838},'select':{'gatewaySettings':!![]}});if(!_0x552bce?.[_0x584554(0xc3)])return console[_0x584554(0x170)](_0x584554(0x197)+_0x3c7838+',\x20using\x20default\x20commission\x2010%'),0xa;const _0x5a7172=JSON[_0x584554(0x11a)](_0x552bce[_0x584554(0xc3)]);for(const [_0x48e312,_0x11adbb]of Object['entries'](_0x5a7172)){if(_0x48e312[_0x584554(0xbe)]()===_0x26c13f['toLowerCase']()){const _0x20d22e=_0x11adbb[_0x584554(0x154)]||0xa;return console[_0x584554(0x170)](_0x584554(0x187)+_0x26c13f+'\x20commission\x20for\x20shop\x20'+_0x3c7838+':\x20'+_0x20d22e+'%'),_0x20d22e;}}return console[_0x584554(0x170)](_0x584554(0x11e)+_0x26c13f+_0x584554(0x109)+_0x3c7838+_0x584554(0xde)),0xa;}catch(_0x4a7f4a){return console[_0x584554(0xda)]('Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20'+_0x3c7838+',\x20gateway\x20'+_0x26c13f+':',_0x4a7f4a),0xa;}}}exports[a37_0x2b7862(0x9c)]=CoinToPayStatusService,exports[a37_0x2b7862(0xd6)]=new CoinToPayStatusService();function a37_0x3e11(_0x3e7820,_0xb5f7e9){const _0x560071=a37_0x5600();return a37_0x3e11=function(_0x3e115,_0x603fc4){_0x3e115=_0x3e115-0x90;let _0x39e99c=_0x560071[_0x3e115];return _0x39e99c;},a37_0x3e11(_0x3e7820,_0xb5f7e9);}function a37_0x5600(){const _0x42123a=['\x20\x20\x20-\x20ShopId:\x20','timestamp','currency','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','\x20\x20\x20Amount:\x20','/status/','\x20\x20\x20-\x20Amount:\x20','coinToPay2Service','getGatewayCommission','paidAt','‚úÖ\x20[CHECK]\x20Payment\x20','\x20\x20\x20-\x20Gateway:\x20','ü™ô\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','remitterIban','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','POST','delete','‚úÖ\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','\x20pending\x20CoinToPay\x20payments','checkPaymentStatus','Webhook\x20event\x20','setDate','48WnnIao','PAID','\x20\x20\x20üìä\x20Status:\x20','convertToUSDT',':\x20type=','cointopay_auto_expired','üí∞\x20[CHECK]\x20Payment\x20','toFixed','application/json','GLOBAL_CHECK_INTERVAL_MS','3015873UuQVxp','SINGLE','-day\x20timeout','ü™ô\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','\x20status:\x20','../types/gateway','not\x20confirmed','currentPayments','adminNotes','\x20found:','commission','\x20initial\x20timers\x20for\x20payment\x20','üìä\x20[CHECK]\x20CoinToPay\x20payment\x20','../config/database','payment','\x20triggered\x20for\x20payment\x20','‚ö†Ô∏è\x20[CHECK]\x20Payment\x20','./gateways/coinToPayService','expired','set','type','\x20individual\x20payment\x20timers','clearPaymentTimers','üîÑ\x20[CHECK]\x20Updating\x20payment\x20','‚ùå\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','Unknown\x20error','‚è∞\x20[EXPIRY]\x20Payment\x20','üõë\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','\x20checked,\x20','üìä\x20[CHECK]\x20Payment\x20','gatewayOrderId','sendShopWebhook','amount','gateway','‚úÖ\x20[EXPIRY]\x20Payment\x20','shopId','\x20status\x20changed\x20to\x20','‚úÖ\x20[DEBUG]\x20Successfully\x20scheduled\x20','log','./currencyService','text','checkSinglePaymentById','loggerService','COINTOPAY_STATUS_CHANGE','5BrnJal','\x20expired\x20CoinToPay\x20payments','includes','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','Success','‚ùå\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','\x20to\x20','\x20skipped,\x20','ü™ô\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','logCoinToPayError','8DdycTc','üìà\x20[COINTOPAY]\x20Payment\x20','cointopay2','sendPaymentStatusNotification','confirmedOn','\x20(age:\x20','\x20status\x20unchanged\x20(','Gateway\x20','\x20status\x20from\x20','__esModule','‚è∞\x20[HOURLY]\x20Payment\x20','iban','\x20is\x20valid\x20for\x20checking,\x20proceeding...','catch',',\x20stopping\x20individual\x20checks','gatewayPaymentId','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','85419QRVzJn','üõë\x20[SHUTDOWN]\x20Cleared\x20','\x20to\x20clear','ü™ô\x20[GLOBAL]\x20Found\x20','cointopay_status_check_error','üßπ\x20[DEBUG]\x20Cleared\x20timer\x20#','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','webhookUrl','toISOString','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','Shop\x20webhook\x20sent\x20to\x20','\x20\x20\x20-\x20GatewayPaymentId:\x20','paymentTimers','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','length','üìä\x20[CHECK]\x20CoinToPay2\x20payment\x20','\x20not\x20found,\x20clearing\x20timers','\x20\x20\x20‚ùå\x20Error:\x20',',\x20clearing\x20individual\x20timers','‚è∞\x20[GLOBAL]\x20Payment\x20','‚è∞\x20[DEBUG]\x20Scheduled\x20check\x20#','CoinToPayStatusService','sendPaymentNotification','delay','cointopay','bankDetails','‚ùå\x20[CHECK]\x20Payment\x20','\x20details:','floor','customerEmail','\x20days,\x20marking\x20as\x20EXPIRED','create','COINTOPAY_ERROR','./loggerService','‚úÖ\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','webhookLog','globalCheckInterval','‚ùå\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','533556ihbSRR','390jSQIHD','created','‚úÖ\x20[HOURLY]\x20Payment\x20','schedule_created','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','‚ùå\x20[HOURLY]\x20Payment\x20','üè¶\x20[CHECK]\x20Saved\x20IBAN:\x20','‚úÖ\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','üõë\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','payment.success','createdOn','startPeriodicStatusCheck','\x20not\x20found\x20in\x20database','‚úÖ\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','paymentDetails','toLowerCase','\x20completed\x20for\x20payment\x20','Bank\x20Details:\x20','findUnique','COMPLETED','gatewaySettings','\x20\x20\x20üìÖ\x20Time:\x20','getTime','Failed\x20to\x20mark\x20payment\x20as\x20expired','\x20is\x20too\x20new\x20(','‚úÖ\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','‚úÖ\x20[COINTOPAY]\x20Payment\x20link\x20','\x20has\x20no\x20gatewayPaymentId,\x20skipping','CoinToPay2Service','\x20commission:\x20','\x20in\x20','shop','webhook_send','default','5\x20minutes','now','\x20USDT','stopPeriodicStatusCheck','\x20marked\x20as\x20paid\x20at:\x20','coinToPayStatusService','ü™ô\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','\x20amounts\x20calculated:','1055289zJGgFb','error','\x20(after\x20','paid','update',',\x20using\x20default\x2010%','\x20\x20\x20Gateway\x20','timers','‚ùå\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','\x20is\x20older\x20than\x20','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','customerName','üîç\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','\x20\x20\x20üìç\x20Source:\x20','\x20seconds\x20(','\x20days\x20without\x20payment\x20confirmation','payment.failed','\x20\x20\x20üìù\x20Context:','Payment\x20older\x20than\x20','ü™ô\x20[DEBUG]\x20Creating\x20','üßπ\x20[CHECK]\x20Payment\x20','EXPIRED','\x20updated\x20successfully','status','42331ESAgeh',',\x20currentPayments=','coinToPayService','logWhiteDomainError','\x20for\x20payment\x20','not\x20found','failed','‚ö†Ô∏è\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','\x20days\x20(created\x20before\x20','schedulePaymentChecks','16DeFyEa','settings','description','has','üîç\x20[CHECK]\x20Checking\x20','EXPIRY_DAYS','push','paymentId','status_check','2071277XCZcJi','paymentLink','checkAllPendingPayments','webhookEvents','size','\x20in\x20shop\x20','message','FAILED','stringify','currencyService','2omTWEa','\x20current\x20status:\x20','ü™ô\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','checkSinglePayment','\x20\x20\x20-\x20Status:\x20','createdAt','\x20\x20\x20-\x20gatewayPaymentId:\x20','\x20days','\x20payment\x20',',\x20status=','getPaymentTimerInfo','paymentLinkId','parse','transactionId','amountUSDT','PENDING','No\x20specific\x20commission\x20found\x20for\x20gateway\x20','4428259IXzenn','get','\x20status\x20is\x20','checkExpiredPayments','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','logCoinToPayStatus','Automatically\x20expired\x20after\x20','unknown','\x20->\x20','forEach','./telegramBotService'];a37_0x5600=function(){return _0x42123a;};return a37_0x5600();}