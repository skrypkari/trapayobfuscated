'use strict';const a50_0x55adfc=a50_0x26d3;(function(_0x2066c4,_0x5f4f46){const _0x15785f=a50_0x26d3,_0x131f3b=_0x2066c4();while(!![]){try{const _0x320c52=-parseInt(_0x15785f(0x20f))/0x1+-parseInt(_0x15785f(0x176))/0x2*(-parseInt(_0x15785f(0x24a))/0x3)+parseInt(_0x15785f(0x1b5))/0x4*(-parseInt(_0x15785f(0x214))/0x5)+-parseInt(_0x15785f(0x1cd))/0x6+-parseInt(_0x15785f(0x17b))/0x7+-parseInt(_0x15785f(0x1f1))/0x8*(parseInt(_0x15785f(0x1a4))/0x9)+parseInt(_0x15785f(0x239))/0xa*(parseInt(_0x15785f(0x187))/0xb);if(_0x320c52===_0x5f4f46)break;else _0x131f3b['push'](_0x131f3b['shift']());}catch(_0x14d8df){_0x131f3b['push'](_0x131f3b['shift']());}}}(a50_0x5b1d,0x97eb5));var __importDefault=this&&this[a50_0x55adfc(0x1d3)]||function(_0x1c01d2){const _0x32904b=a50_0x55adfc;return _0x1c01d2&&_0x1c01d2[_0x32904b(0x236)]?_0x1c01d2:{'default':_0x1c01d2};};Object[a50_0x55adfc(0x21c)](exports,a50_0x55adfc(0x236),{'value':!![]}),exports[a50_0x55adfc(0x217)]=exports[a50_0x55adfc(0x1e7)]=void 0x0;const coinToPayService_1=require(a50_0x55adfc(0x1f5)),coinToPay2Service_1=require(a50_0x55adfc(0x188)),gateway_1=require(a50_0x55adfc(0x205)),database_1=__importDefault(require(a50_0x55adfc(0x20e))),telegramBotService_1=require(a50_0x55adfc(0x194)),loggerService_1=require(a50_0x55adfc(0x1c1)),currencyService_1=require(a50_0x55adfc(0x24c));class CoinToPayStatusService{constructor(){const _0xa07300=a50_0x55adfc;this['globalCheckInterval']=null,this[_0xa07300(0x183)]=0x3c*0x3c*0x3e8,this[_0xa07300(0x1ec)]=0x5,this[_0xa07300(0x208)]=new Map(),this['coinToPayService']=new coinToPayService_1['CoinToPayService'](),this['coinToPay2Service']=new coinToPay2Service_1[(_0xa07300(0x245))](),console[_0xa07300(0x181)](_0xa07300(0x1df));}['schedulePaymentChecks'](_0x8264a5,_0x2534f3){const _0x59ed77=a50_0x55adfc;console[_0x59ed77(0x181)](_0x59ed77(0x210)),console['log'](_0x59ed77(0x171)+_0x8264a5),console[_0x59ed77(0x181)](_0x59ed77(0x1eb)+_0x2534f3),this['clearPaymentTimers'](_0x8264a5);const _0xb327d1=[],_0x60d66a=new Date(),_0x14fa9e=[{'delay':0x1*0x3c*0x3e8,'description':_0x59ed77(0x195)},{'delay':0x2*0x3c*0x3e8,'description':'2\x20minutes'},{'delay':0x5*0x3c*0x3e8,'description':_0x59ed77(0x182)},{'delay':0x5*0x3c*0x3e8,'description':'5\x20minutes'}];console['log'](_0x59ed77(0x18e)+_0x14fa9e[_0x59ed77(0x186)]+_0x59ed77(0x250)+_0x8264a5);let _0x3c051b=0x0;_0x14fa9e[_0x59ed77(0x1e3)]((_0x56af6e,_0x4404f4)=>{const _0x587403=_0x59ed77;_0x3c051b+=_0x56af6e[_0x587403(0x238)];const _0x47b880=setTimeout(async()=>{const _0x2fd12d=_0x587403;console[_0x2fd12d(0x181)](_0x2fd12d(0x1de)+(_0x4404f4+0x1)+_0x2fd12d(0x18b)+_0x8264a5+_0x2fd12d(0x173)+_0x56af6e[_0x2fd12d(0x192)]+')');try{await this[_0x2fd12d(0x1e1)](_0x8264a5),console[_0x2fd12d(0x181)](_0x2fd12d(0x18a)+(_0x4404f4+0x1)+_0x2fd12d(0x1bc)+_0x8264a5);}catch(_0x13c490){console[_0x2fd12d(0x212)](_0x2fd12d(0x1ed)+(_0x4404f4+0x1)+_0x2fd12d(0x167)+_0x8264a5+':',_0x13c490),this[_0x2fd12d(0x1dc)](_0x8264a5,_0x2534f3,_0x13c490,_0x2fd12d(0x1be),{'checkNumber':_0x4404f4+0x1,'scheduledAfter':_0x56af6e[_0x2fd12d(0x192)],'isIndividualCheck':!![]});}},_0x3c051b);_0xb327d1['push'](_0x47b880),console[_0x587403(0x181)](_0x587403(0x1f8)+(_0x4404f4+0x1)+'\x20for\x20payment\x20'+_0x8264a5+_0x587403(0x21a)+_0x3c051b/0x3e8+_0x587403(0x247)+_0x56af6e[_0x587403(0x192)]+')');});const _0x104415=setInterval(async()=>{const _0x4e50a4=_0x59ed77;console[_0x4e50a4(0x181)]('ü™ô\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20'+_0x8264a5);try{const _0x20d8d0=await database_1[_0x4e50a4(0x1e9)]['payment'][_0x4e50a4(0x251)]({'where':{'id':_0x8264a5},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x20d8d0){console[_0x4e50a4(0x181)](_0x4e50a4(0x22f)+_0x8264a5+'\x20not\x20found,\x20clearing\x20timers'),this[_0x4e50a4(0x259)](_0x8264a5);return;}console['log'](_0x4e50a4(0x1c3)+_0x8264a5+'\x20current\x20status:\x20'+_0x20d8d0[_0x4e50a4(0x219)]);if(_0x20d8d0[_0x4e50a4(0x219)]!==_0x4e50a4(0x22c)){console[_0x4e50a4(0x181)](_0x4e50a4(0x206)+_0x8264a5+_0x4e50a4(0x179)+_0x20d8d0['status']+',\x20stopping\x20individual\x20checks'),this[_0x4e50a4(0x259)](_0x8264a5);return;}const _0x274971=Math['floor']((Date['now']()-_0x20d8d0[_0x4e50a4(0x20b)]['getTime']())/(0x3e8*0x3c*0x3c*0x18));if(_0x274971>=this[_0x4e50a4(0x1ec)]){console[_0x4e50a4(0x181)](_0x4e50a4(0x204)+_0x8264a5+_0x4e50a4(0x1c9)+this[_0x4e50a4(0x1ec)]+'\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check'),this['clearPaymentTimers'](_0x8264a5);return;}await this[_0x4e50a4(0x1e1)](_0x8264a5),console[_0x4e50a4(0x181)](_0x4e50a4(0x22d)+_0x8264a5);}catch(_0x3c04f6){console[_0x4e50a4(0x212)](_0x4e50a4(0x23d)+_0x8264a5+':',_0x3c04f6),this['logCoinToPayError'](_0x8264a5,_0x2534f3,_0x3c04f6,'status_check',{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0xb327d1['push'](_0x104415),this['paymentTimers'][_0x59ed77(0x1f2)](_0x8264a5,{'timers':_0xb327d1,'paymentId':_0x8264a5,'gatewayPaymentId':_0x2534f3,'createdAt':_0x60d66a}),console[_0x59ed77(0x181)](_0x59ed77(0x22e)+_0x14fa9e['length']+_0x59ed77(0x1fb)+_0x8264a5),console[_0x59ed77(0x181)]('üìä\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20'+this[_0x59ed77(0x208)][_0x59ed77(0x1aa)]),this['logCoinToPayStatus'](_0x8264a5,_0x2534f3,_0x59ed77(0x22c),_0x59ed77(0x22c),_0x59ed77(0x1be),{'action':_0x59ed77(0x257),'scheduledChecks':_0x14fa9e[_0x59ed77(0x186)],'firstCheckIn':_0x14fa9e[0x0][_0x59ed77(0x238)]/0x3e8,'totalTimers':this[_0x59ed77(0x208)][_0x59ed77(0x1aa)]});}[a50_0x55adfc(0x259)](_0x5b3494){const _0x559298=a50_0x55adfc,_0x5e8cf8=this[_0x559298(0x208)][_0x559298(0x1e4)](_0x5b3494);_0x5e8cf8?(console[_0x559298(0x181)](_0x559298(0x189)+_0x5e8cf8[_0x559298(0x262)][_0x559298(0x186)]+_0x559298(0x25a)+_0x5b3494),_0x5e8cf8[_0x559298(0x262)]['forEach']((_0x2ae2d0,_0x3686e7)=>{const _0x20085d=_0x559298;_0x2ae2d0&&(clearTimeout(_0x2ae2d0),clearInterval(_0x2ae2d0),console[_0x20085d(0x181)]('üßπ\x20[DEBUG]\x20Cleared\x20timer\x20#'+(_0x3686e7+0x1)+_0x20085d(0x167)+_0x5b3494));}),this[_0x559298(0x208)][_0x559298(0x1fd)](_0x5b3494),console[_0x559298(0x181)]('‚úÖ\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20'+_0x5b3494+_0x559298(0x15a)+this['paymentTimers'][_0x559298(0x1aa)])):console[_0x559298(0x181)]('‚ö†Ô∏è\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20'+_0x5b3494+_0x559298(0x25d));}async[a50_0x55adfc(0x1e1)](_0x2e1887){const _0x3d0ae2=a50_0x55adfc;console[_0x3d0ae2(0x181)]('üîç\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20'+_0x2e1887);const _0x29abc5=await database_1['default']['payment'][_0x3d0ae2(0x251)]({'where':{'id':_0x2e1887},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x29abc5){console[_0x3d0ae2(0x181)]('‚ùå\x20[CHECK]\x20Payment\x20'+_0x2e1887+'\x20not\x20found\x20in\x20database');return;}console[_0x3d0ae2(0x181)](_0x3d0ae2(0x18d)+_0x2e1887+'\x20found:'),console['log'](_0x3d0ae2(0x1ff)+_0x29abc5[_0x3d0ae2(0x199)]),console[_0x3d0ae2(0x181)](_0x3d0ae2(0x207)+_0x29abc5[_0x3d0ae2(0x219)]),console[_0x3d0ae2(0x181)](_0x3d0ae2(0x1ac)+_0x29abc5['gatewayPaymentId']),console[_0x3d0ae2(0x181)]('\x20\x20\x20-\x20Amount:\x20'+_0x29abc5['amount']+'\x20'+_0x29abc5[_0x3d0ae2(0x166)]),console[_0x3d0ae2(0x181)]('\x20\x20\x20-\x20ShopId:\x20'+_0x29abc5['shopId']);if(_0x29abc5[_0x3d0ae2(0x199)]!==_0x3d0ae2(0x211)&&_0x29abc5[_0x3d0ae2(0x199)]!==_0x3d0ae2(0x15f)){console[_0x3d0ae2(0x181)]('‚ö†Ô∏è\x20[CHECK]\x20Payment\x20'+_0x2e1887+'\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20'+_0x29abc5[_0x3d0ae2(0x199)]+')');return;}if(_0x29abc5['status']!==_0x3d0ae2(0x22c)){console[_0x3d0ae2(0x181)](_0x3d0ae2(0x1ba)+_0x2e1887+_0x3d0ae2(0x179)+_0x29abc5[_0x3d0ae2(0x219)]+_0x3d0ae2(0x1ce)),this['clearPaymentTimers'](_0x2e1887);return;}if(!_0x29abc5[_0x3d0ae2(0x1d9)]){console[_0x3d0ae2(0x181)](_0x3d0ae2(0x1ba)+_0x2e1887+_0x3d0ae2(0x1a9));return;}console['log'](_0x3d0ae2(0x1af)+_0x2e1887+'\x20is\x20valid\x20for\x20checking,\x20proceeding...'),await this[_0x3d0ae2(0x1f4)](_0x29abc5);}[a50_0x55adfc(0x233)](_0x42e6f6,_0x15e24f,_0x53b309,_0x1028c9,_0x269493,_0x359188){const _0xd19f6c=a50_0x55adfc,_0x180b18={'type':_0xd19f6c(0x19a),'paymentId':_0x42e6f6,'gatewayPaymentId':_0x15e24f,'oldStatus':_0x53b309,'newStatus':_0x1028c9,'source':_0x269493,'timestamp':new Date()['toISOString'](),'details':_0x359188||{}};loggerService_1[_0xd19f6c(0x203)][_0xd19f6c(0x233)](_0x180b18),console['log'](_0xd19f6c(0x240)+_0x42e6f6+'\x20('+_0x15e24f+')'),console[_0xd19f6c(0x181)](_0xd19f6c(0x256)+_0x53b309+_0xd19f6c(0x165)+_0x1028c9),console['log']('\x20\x20\x20üìç\x20Source:\x20'+_0x269493),console[_0xd19f6c(0x181)](_0xd19f6c(0x19b)+_0x180b18['timestamp']),_0x359188&&console[_0xd19f6c(0x181)](_0xd19f6c(0x216),_0x359188);}[a50_0x55adfc(0x1dc)](_0xf1fd39,_0x14abfd,_0x1fab5b,_0x472f79,_0x5e8d95){const _0x465453=a50_0x55adfc,_0x3b2ac0={'type':_0x465453(0x15b),'paymentId':_0xf1fd39,'gatewayPaymentId':_0x14abfd,'error':_0x1fab5b instanceof Error?{'message':_0x1fab5b[_0x465453(0x1a6)],'stack':_0x1fab5b[_0x465453(0x193)]}:_0x1fab5b,'source':_0x472f79,'timestamp':new Date()[_0x465453(0x22a)](),'context':_0x5e8d95||{}};loggerService_1[_0x465453(0x203)][_0x465453(0x1dc)](_0x3b2ac0),console[_0x465453(0x212)](_0x465453(0x224)+_0xf1fd39+'\x20('+_0x14abfd+')'),console[_0x465453(0x212)](_0x465453(0x19e)+(_0x1fab5b instanceof Error?_0x1fab5b[_0x465453(0x1a6)]:_0x1fab5b)),console[_0x465453(0x212)](_0x465453(0x15d)+_0x472f79),console[_0x465453(0x212)](_0x465453(0x19b)+_0x3b2ac0['timestamp']),_0x5e8d95&&console[_0x465453(0x212)](_0x465453(0x1cc),_0x5e8d95);}[a50_0x55adfc(0x24d)](){const _0x50ddc2=a50_0x55adfc;console[_0x50ddc2(0x181)](_0x50ddc2(0x18f)),this['checkAllPendingPayments']()[_0x50ddc2(0x254)](_0x303678=>{const _0x89fa08=_0x50ddc2;console[_0x89fa08(0x212)](_0x89fa08(0x16c),_0x303678);}),this['globalCheckInterval']=setInterval(async()=>{const _0x3b9629=_0x50ddc2;try{console[_0x3b9629(0x181)]('ü™ô\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...'),await this['checkAllPendingPayments'](),console[_0x3b9629(0x181)](_0x3b9629(0x248));}catch(_0x55e302){console[_0x3b9629(0x212)](_0x3b9629(0x1dd),_0x55e302);}},this[_0x50ddc2(0x183)]),console[_0x50ddc2(0x181)](_0x50ddc2(0x17d));}[a50_0x55adfc(0x220)](){const _0x21a3e5=a50_0x55adfc;console[_0x21a3e5(0x181)](_0x21a3e5(0x197));this['globalCheckInterval']&&(clearInterval(this[_0x21a3e5(0x1cf)]),this['globalCheckInterval']=null,console[_0x21a3e5(0x181)](_0x21a3e5(0x1a2)));const _0x510d30=this[_0x21a3e5(0x208)][_0x21a3e5(0x1aa)];for(const [_0x389743]of this['paymentTimers']){this['clearPaymentTimers'](_0x389743);}console[_0x21a3e5(0x181)](_0x21a3e5(0x161)+_0x510d30+_0x21a3e5(0x230));}async[a50_0x55adfc(0x1ad)](){const _0x3b10f0=a50_0x55adfc;try{console[_0x3b10f0(0x181)]('ü™ô\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...');const _0x2a70e1=await database_1[_0x3b10f0(0x1e9)][_0x3b10f0(0x253)][_0x3b10f0(0x1c2)]({'where':{'gateway':{'in':[_0x3b10f0(0x211),_0x3b10f0(0x15f)]},'status':'PENDING','gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x3b10f0(0x181)]('ü™ô\x20[GLOBAL]\x20Found\x20'+_0x2a70e1[_0x3b10f0(0x186)]+_0x3b10f0(0x1fc));if(_0x2a70e1['length']===0x0){console[_0x3b10f0(0x181)](_0x3b10f0(0x242));return;}const _0x393073=await this['checkExpiredPayments'](_0x2a70e1);console[_0x3b10f0(0x181)]('‚è∞\x20[GLOBAL]\x20Found\x20'+_0x393073['length']+_0x3b10f0(0x1d4));let _0xb58f4=0x0,_0xf8085d=0x0;for(const _0x15a64 of _0x2a70e1){try{if(_0x393073[_0x3b10f0(0x1d8)](_0x15a64['id'])){console[_0x3b10f0(0x181)]('‚è∞\x20[GLOBAL]\x20Payment\x20'+_0x15a64['id']+_0x3b10f0(0x1bb)),_0xf8085d++;continue;}if(this[_0x3b10f0(0x208)][_0x3b10f0(0x201)](_0x15a64['id'])){console[_0x3b10f0(0x181)](_0x3b10f0(0x19d)+_0x15a64['id']+_0x3b10f0(0x260)),_0xf8085d++;continue;}const _0x301ac5=(Date[_0x3b10f0(0x1b3)]()-_0x15a64[_0x3b10f0(0x20b)][_0x3b10f0(0x25b)]())/(0x3e8*0x3c*0x3c);if(_0x301ac5<0x1){console[_0x3b10f0(0x181)](_0x3b10f0(0x19d)+_0x15a64['id']+'\x20is\x20too\x20new\x20('+_0x301ac5[_0x3b10f0(0x20d)](0x1)+_0x3b10f0(0x1db)),_0xf8085d++;continue;}console['log']('üîç\x20[GLOBAL]\x20Checking\x20old\x20payment\x20'+_0x15a64['id']+_0x3b10f0(0x249)+_0x301ac5['toFixed'](0x1)+'h)'),await this[_0x3b10f0(0x1f4)](_0x15a64),_0xb58f4++,await new Promise(_0x3efd33=>setTimeout(_0x3efd33,0x7d0));}catch(_0x4f6af6){console['error']('‚ùå\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20'+_0x15a64['id']+':',_0x4f6af6),this['logCoinToPayError'](_0x15a64['id'],_0x15a64['gatewayPaymentId']||'unknown',_0x4f6af6,_0x3b10f0(0x1be),{'isGlobalCheck':!![],'paymentAmount':_0x15a64[_0x3b10f0(0x175)],'paymentCurrency':_0x15a64[_0x3b10f0(0x166)],'shopId':_0x15a64[_0x3b10f0(0x19f)],'createdAt':_0x15a64['createdAt']}),loggerService_1[_0x3b10f0(0x203)]['logWhiteDomainError'](_0x3b10f0(0x211),_0x3b10f0(0x162)+_0x15a64[_0x3b10f0(0x1d9)],_0x4f6af6);}}console[_0x3b10f0(0x181)]('‚úÖ\x20[GLOBAL]\x20Global\x20check\x20completed:\x20'+_0xb58f4+_0x3b10f0(0x1ab)+_0xf8085d+_0x3b10f0(0x1ef)+_0x393073['length']+_0x3b10f0(0x16f));}catch(_0x2fa674){console[_0x3b10f0(0x212)]('‚ùå\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:',_0x2fa674);}}async[a50_0x55adfc(0x1a7)](_0xdef91e){const _0xe31ba9=a50_0x55adfc,_0x2936ec=[],_0x5c9a81=new Date();_0x5c9a81[_0xe31ba9(0x1f7)](_0x5c9a81[_0xe31ba9(0x213)]()-this[_0xe31ba9(0x1ec)]),console[_0xe31ba9(0x181)](_0xe31ba9(0x21d)+this[_0xe31ba9(0x1ec)]+_0xe31ba9(0x17a)+_0x5c9a81[_0xe31ba9(0x22a)]()+')');for(const _0x2f96b2 of _0xdef91e){if(_0x2f96b2[_0xe31ba9(0x20b)]<_0x5c9a81){console[_0xe31ba9(0x181)](_0xe31ba9(0x17c)+_0x2f96b2['id']+_0xe31ba9(0x1c9)+this[_0xe31ba9(0x1ec)]+'\x20days,\x20marking\x20as\x20EXPIRED');try{this[_0xe31ba9(0x233)](_0x2f96b2['id'],_0x2f96b2[_0xe31ba9(0x1d9)]||_0xe31ba9(0x15c),_0xe31ba9(0x22c),'EXPIRED',_0xe31ba9(0x23a),{'reason':'Payment\x20older\x20than\x20'+this['EXPIRY_DAYS']+_0xe31ba9(0x1d6),'createdAt':_0x2f96b2[_0xe31ba9(0x20b)],'daysSinceCreation':Math[_0xe31ba9(0x24e)]((Date[_0xe31ba9(0x1b3)]()-_0x2f96b2[_0xe31ba9(0x20b)][_0xe31ba9(0x25b)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x2f96b2['amount'],'paymentCurrency':_0x2f96b2[_0xe31ba9(0x166)],'shopId':_0x2f96b2[_0xe31ba9(0x19f)]}),await database_1['default']['payment'][_0xe31ba9(0x16b)]({'where':{'id':_0x2f96b2['id']},'data':{'status':'EXPIRED','updatedAt':new Date()}}),await database_1[_0xe31ba9(0x1e9)][_0xe31ba9(0x25f)][_0xe31ba9(0x1f3)]({'data':{'paymentId':_0x2f96b2['id'],'shopId':_0x2f96b2['shopId'],'event':_0xe31ba9(0x18c),'statusCode':0xc8,'responseBody':JSON[_0xe31ba9(0x246)]({'reason':_0xe31ba9(0x168)+this[_0xe31ba9(0x1ec)]+_0xe31ba9(0x1d6),'createdAt':_0x2f96b2[_0xe31ba9(0x20b)],'expiredAt':new Date()[_0xe31ba9(0x22a)](),'daysSinceCreation':Math[_0xe31ba9(0x24e)]((Date[_0xe31ba9(0x1b3)]()-_0x2f96b2[_0xe31ba9(0x20b)][_0xe31ba9(0x25b)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this['sendShopWebhook'](_0x2f96b2,_0xe31ba9(0x1b9)),await this[_0xe31ba9(0x1b0)](_0x2f96b2,_0xe31ba9(0x1b9)),this['clearPaymentTimers'](_0x2f96b2['id']),_0x2936ec['push'](_0x2f96b2['id']),console[_0xe31ba9(0x181)]('‚úÖ\x20[EXPIRY]\x20Payment\x20'+_0x2f96b2['id']+_0xe31ba9(0x1e8)+this['EXPIRY_DAYS']+_0xe31ba9(0x172));}catch(_0xfafada){console['error']('‚ùå\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20'+_0x2f96b2['id']+':',_0xfafada),this[_0xe31ba9(0x1dc)](_0x2f96b2['id'],_0x2f96b2[_0xe31ba9(0x1d9)]||_0xe31ba9(0x15c),_0xfafada,_0xe31ba9(0x23a),{'reason':_0xe31ba9(0x202),'createdAt':_0x2f96b2[_0xe31ba9(0x20b)],'daysSinceCreation':Math[_0xe31ba9(0x24e)]((Date[_0xe31ba9(0x1b3)]()-_0x2f96b2[_0xe31ba9(0x20b)][_0xe31ba9(0x25b)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x2936ec;}async[a50_0x55adfc(0x1f4)](_0x39683f){const _0x5861cb=a50_0x55adfc;if(!_0x39683f[_0x5861cb(0x1d9)]){console['log']('‚ö†Ô∏è\x20[CHECK]\x20Payment\x20'+_0x39683f['id']+_0x5861cb(0x218));return;}console[_0x5861cb(0x181)](_0x5861cb(0x1a8)+_0x39683f['gateway']+_0x5861cb(0x184)+_0x39683f['id']+'\x20('+_0x39683f[_0x5861cb(0x1d9)]+')');try{let _0x54933e;_0x39683f[_0x5861cb(0x199)]===_0x5861cb(0x15f)?(_0x54933e=await this[_0x5861cb(0x25c)][_0x5861cb(0x1b6)](_0x39683f['gatewayPaymentId']),console[_0x5861cb(0x181)](_0x5861cb(0x191)+_0x39683f['id']+_0x5861cb(0x1ae)+_0x54933e['status'])):(_0x54933e=await this['coinToPayService'][_0x5861cb(0x1b6)](_0x39683f['gatewayPaymentId']),console[_0x5861cb(0x181)](_0x5861cb(0x1e2)+_0x39683f['id']+_0x5861cb(0x1ae)+_0x54933e[_0x5861cb(0x219)]));_0x54933e['paymentDetails']&&console[_0x5861cb(0x181)](_0x5861cb(0x18d)+_0x39683f['id']+_0x5861cb(0x258),{'iban':_0x54933e['paymentDetails'][_0x5861cb(0x1c7)]||'not\x20found','transactionId':_0x54933e[_0x5861cb(0x1e6)]['transactionId'],'createdOn':_0x54933e[_0x5861cb(0x1e6)]['createdOn'],'confirmedOn':_0x54933e[_0x5861cb(0x1e6)][_0x5861cb(0x1b2)]||_0x5861cb(0x1d5)});if(_0x54933e['status']!==_0x39683f[_0x5861cb(0x219)]){console['log'](_0x5861cb(0x1bf)+_0x39683f['id']+_0x5861cb(0x23b)+_0x39683f[_0x5861cb(0x219)]+_0x5861cb(0x24b)+_0x54933e['status']),this['logCoinToPayStatus'](_0x39683f['id'],_0x39683f['gatewayPaymentId'],_0x39683f[_0x5861cb(0x219)],_0x54933e['status'],'status_check',{'paymentDetails':_0x54933e[_0x5861cb(0x1e6)],'amount':_0x54933e[_0x5861cb(0x175)],'currency':_0x54933e[_0x5861cb(0x166)],'shopId':_0x39683f[_0x5861cb(0x19f)],'checkTimestamp':new Date()[_0x5861cb(0x22a)]()});const _0x3169b4={'status':_0x54933e[_0x5861cb(0x219)],'updatedAt':new Date()};if(_0x54933e['status']===_0x5861cb(0x1b1)&&_0x39683f[_0x5861cb(0x219)]!==_0x5861cb(0x1b1)){_0x3169b4[_0x5861cb(0x16a)]=new Date();if(!_0x39683f[_0x5861cb(0x1a5)]){const _0x375e24=await currencyService_1[_0x5861cb(0x1d1)][_0x5861cb(0x196)](_0x39683f['amount'],_0x39683f[_0x5861cb(0x166)]);_0x3169b4[_0x5861cb(0x1a5)]=_0x375e24;const _0x1c9fd4=await this[_0x5861cb(0x1bd)](_0x39683f[_0x5861cb(0x19f)],_0x39683f[_0x5861cb(0x199)]),_0x1862b3=_0x375e24*(0x1-_0x1c9fd4/0x64);_0x3169b4[_0x5861cb(0x1ee)]=_0x1862b3,_0x3169b4[_0x5861cb(0x252)]=_0x1c9fd4,console[_0x5861cb(0x181)](_0x5861cb(0x185)+_0x39683f['id']+_0x5861cb(0x231)),console[_0x5861cb(0x181)]('\x20\x20\x20Amount:\x20'+_0x39683f[_0x5861cb(0x175)]+'\x20'+_0x39683f[_0x5861cb(0x166)]+'\x20->\x20'+_0x375e24['toFixed'](0x6)+_0x5861cb(0x21b)),console[_0x5861cb(0x181)](_0x5861cb(0x1c8)+_0x39683f[_0x5861cb(0x199)]+'\x20commission:\x20'+_0x1c9fd4+'%'),console[_0x5861cb(0x181)]('\x20\x20\x20Amount\x20after\x20commission:\x20'+_0x1862b3[_0x5861cb(0x20d)](0x6)+_0x5861cb(0x21b));}console[_0x5861cb(0x181)]('üí∞\x20[CHECK]\x20Payment\x20'+_0x39683f['id']+'\x20marked\x20as\x20paid\x20at:\x20'+_0x3169b4[_0x5861cb(0x16a)]['toISOString']());}if(_0x54933e[_0x5861cb(0x1e6)]){const _0x5ef769=_0x54933e['paymentDetails'];_0x5ef769[_0x5861cb(0x1c7)]&&(_0x3169b4[_0x5861cb(0x1c6)]=_0x5ef769['iban'],console[_0x5861cb(0x181)](_0x5861cb(0x180)+_0x5ef769[_0x5861cb(0x1c7)])),_0x5ef769[_0x5861cb(0x1c0)]&&console['log']('üè¶\x20[CHECK]\x20Bank\x20details\x20provided:\x20'+_0x5ef769[_0x5861cb(0x1c0)]),_0x5ef769[_0x5861cb(0x158)]&&console[_0x5861cb(0x181)](_0x5861cb(0x226)+_0x5ef769[_0x5861cb(0x158)]),_0x5ef769[_0x5861cb(0x1b2)]&&console['log'](_0x5861cb(0x1d7)+_0x5ef769[_0x5861cb(0x1b2)]);}await database_1[_0x5861cb(0x1e9)][_0x5861cb(0x253)]['update']({'where':{'id':_0x39683f['id']},'data':_0x3169b4});if(_0x54933e['status']===_0x5861cb(0x1b1)&&_0x39683f[_0x5861cb(0x219)]!=='PAID'){console[_0x5861cb(0x181)](_0x5861cb(0x1f0)+_0x39683f['id']+_0x5861cb(0x1d0));const _0x56dbae=await database_1[_0x5861cb(0x1e9)][_0x5861cb(0x253)][_0x5861cb(0x251)]({'where':{'id':_0x39683f['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x56dbae?.[_0x5861cb(0x1cb)]&&_0x56dbae['paymentLink'])try{const _0x3c3710=_0x56dbae['paymentLink'];console['log']('üìà\x20[COINTOPAY]\x20Found\x20payment\x20link\x20'+_0x3c3710['id']+':\x20type='+_0x3c3710[_0x5861cb(0x1e5)]+',\x20currentPayments='+_0x3c3710[_0x5861cb(0x234)]+_0x5861cb(0x1b8)+_0x3c3710[_0x5861cb(0x219)]);const _0x4f0537=_0x3c3710[_0x5861cb(0x234)]+0x1,_0x549708=_0x3c3710['type']==='SINGLE'?_0x5861cb(0x21f):_0x3c3710['status'];await database_1[_0x5861cb(0x1e9)][_0x5861cb(0x16e)][_0x5861cb(0x16b)]({'where':{'id':_0x3c3710['id']},'data':{'currentPayments':_0x4f0537,'status':_0x549708,'updatedAt':new Date()}}),console[_0x5861cb(0x181)](_0x5861cb(0x20c)+_0x3c3710['id']+_0x5861cb(0x1c4)+_0x3c3710[_0x5861cb(0x234)]+'\x20->\x20'+_0x4f0537+_0x5861cb(0x1b8)+_0x3c3710[_0x5861cb(0x219)]+_0x5861cb(0x165)+_0x549708);}catch(_0x2137ff){console[_0x5861cb(0x212)](_0x5861cb(0x1f9),_0x2137ff);}else console[_0x5861cb(0x181)]('üìà\x20[COINTOPAY]\x20Payment\x20'+_0x39683f['id']+'\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link');}await database_1['default'][_0x5861cb(0x25f)][_0x5861cb(0x1f3)]({'data':{'paymentId':_0x39683f['id'],'shopId':_0x39683f[_0x5861cb(0x19f)],'event':_0x5861cb(0x24f)+_0x54933e[_0x5861cb(0x219)][_0x5861cb(0x159)](),'statusCode':0xc8,'responseBody':JSON[_0x5861cb(0x246)]({'oldStatus':_0x39683f[_0x5861cb(0x219)],'newStatus':_0x54933e[_0x5861cb(0x219)],'paymentDetails':_0x54933e['paymentDetails'],'checkedAt':new Date()[_0x5861cb(0x22a)]()})}}),await this[_0x5861cb(0x177)](_0x39683f,_0x54933e['status']),await this['sendPaymentStatusNotification'](_0x39683f,_0x54933e[_0x5861cb(0x219)]),_0x54933e[_0x5861cb(0x219)]!=='PENDING'&&(console[_0x5861cb(0x181)](_0x5861cb(0x15e)+_0x39683f['id']+'\x20status\x20changed\x20to\x20'+_0x54933e[_0x5861cb(0x219)]+_0x5861cb(0x1d2)),this[_0x5861cb(0x259)](_0x39683f['id'])),console[_0x5861cb(0x181)](_0x5861cb(0x1af)+_0x39683f['id']+'\x20updated\x20successfully');}else console[_0x5861cb(0x181)](_0x5861cb(0x18d)+_0x39683f['id']+_0x5861cb(0x200)+_0x54933e['status']+')'),this[_0x5861cb(0x233)](_0x39683f['id'],_0x39683f[_0x5861cb(0x1d9)],_0x39683f[_0x5861cb(0x219)],_0x54933e[_0x5861cb(0x219)],_0x5861cb(0x1be),{'statusUnchanged':!![],'paymentDetails':_0x54933e[_0x5861cb(0x1e6)],'amount':_0x54933e[_0x5861cb(0x175)],'currency':_0x54933e[_0x5861cb(0x166)],'shopId':_0x39683f[_0x5861cb(0x19f)],'checkTimestamp':new Date()[_0x5861cb(0x22a)]()});}catch(_0x20e11a){console[_0x5861cb(0x212)]('‚ùå\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20'+_0x39683f['id']+':',_0x20e11a),this[_0x5861cb(0x1dc)](_0x39683f['id'],_0x39683f[_0x5861cb(0x1d9)],_0x20e11a,_0x5861cb(0x1be),{'paymentAmount':_0x39683f[_0x5861cb(0x175)],'paymentCurrency':_0x39683f[_0x5861cb(0x166)],'shopId':_0x39683f[_0x5861cb(0x19f)],'createdAt':_0x39683f[_0x5861cb(0x20b)]}),await database_1[_0x5861cb(0x1e9)]['webhookLog'][_0x5861cb(0x1f3)]({'data':{'paymentId':_0x39683f['id'],'shopId':_0x39683f[_0x5861cb(0x19f)],'event':'cointopay_status_check_error','statusCode':0x1f4,'responseBody':JSON[_0x5861cb(0x246)]({'error':_0x20e11a instanceof Error?_0x20e11a[_0x5861cb(0x1a6)]:_0x5861cb(0x198),'gatewayPaymentId':_0x39683f[_0x5861cb(0x1d9)],'checkedAt':new Date()[_0x5861cb(0x22a)]()})}});}}async['sendShopWebhook'](_0x2ea1ff,_0x5be552){const _0x39ffe8=a50_0x55adfc,_0x1164fc=Date[_0x39ffe8(0x1b3)]();try{const _0x4350cb=_0x2ea1ff[_0x39ffe8(0x23e)],_0x3c1c1d=_0x4350cb[_0x39ffe8(0x23c)];if(!_0x3c1c1d?.['webhookUrl']){console[_0x39ffe8(0x181)]('No\x20webhook\x20URL\x20configured\x20for\x20shop\x20'+_0x4350cb['id']);return;}const _0x1773c2=_0x5be552===_0x39ffe8(0x1b1)?'payment.success':_0x5be552===_0x39ffe8(0x17f)?_0x39ffe8(0x169):_0x5be552===_0x39ffe8(0x1b9)?_0x39ffe8(0x169):_0x39ffe8(0x16d);if(!_0x3c1c1d['webhookEvents']?.[_0x39ffe8(0x1d8)](_0x1773c2)){console[_0x39ffe8(0x181)](_0x39ffe8(0x232)+_0x1773c2+_0x39ffe8(0x1f6)+_0x4350cb['id']);return;}const _0x59607f=(0x0,gateway_1['getGatewayIdByName'])(_0x2ea1ff['gateway'])||_0x2ea1ff[_0x39ffe8(0x199)],_0x1e286f={'event':_0x1773c2,'payment':{'id':_0x2ea1ff['id'],'order_id':_0x2ea1ff[_0x39ffe8(0x243)],'gateway_order_id':_0x2ea1ff[_0x39ffe8(0x1a0)],'gateway':_0x59607f,'amount':_0x2ea1ff['amount'],'currency':_0x2ea1ff[_0x39ffe8(0x166)],'status':_0x5be552[_0x39ffe8(0x159)](),'customer_email':_0x2ea1ff[_0x39ffe8(0x229)],'customer_name':_0x2ea1ff[_0x39ffe8(0x221)],'created_at':_0x2ea1ff[_0x39ffe8(0x20b)],'updated_at':new Date()}},_0xf82159=await fetch(_0x3c1c1d[_0x39ffe8(0x1ca)],{'method':_0x39ffe8(0x1e0),'headers':{'Content-Type':_0x39ffe8(0x1fe),'User-Agent':_0x39ffe8(0x21e)},'body':JSON[_0x39ffe8(0x246)](_0x1e286f)}),_0x3275f8=Date['now']()-_0x1164fc,_0x4f755f=_0xf82159['ok']?'Success':await _0xf82159[_0x39ffe8(0x228)]();loggerService_1['loggerService'][_0x39ffe8(0x1a3)](_0x2ea1ff[_0x39ffe8(0x19f)],_0x3c1c1d[_0x39ffe8(0x1ca)],_0x1773c2,_0xf82159[_0x39ffe8(0x219)],_0x3275f8,_0x1e286f),console['log'](_0x39ffe8(0x1fa)+_0x3c1c1d[_0x39ffe8(0x1ca)]+_0x39ffe8(0x19c)+_0xf82159[_0x39ffe8(0x219)]+'\x20('+_0x3275f8+_0x39ffe8(0x163));}catch(_0x5b9ac2){console[_0x39ffe8(0x212)](_0x39ffe8(0x22b),_0x5b9ac2),loggerService_1['loggerService']['logShopWebhookError'](_0x2ea1ff[_0x39ffe8(0x19f)],_0x2ea1ff[_0x39ffe8(0x23e)]?.[_0x39ffe8(0x23c)]?.[_0x39ffe8(0x1ca)]||_0x39ffe8(0x15c),_0x39ffe8(0x241),_0x5b9ac2,{});}}async[a50_0x55adfc(0x1b0)](_0x431067,_0x4662a7){const _0x30e503=a50_0x55adfc;try{const _0x18db55={'PENDING':_0x30e503(0x23f),'PAID':_0x30e503(0x235),'FAILED':'failed','EXPIRED':_0x30e503(0x1b4)},_0x649cc6=_0x18db55[_0x4662a7];if(!_0x649cc6||_0x649cc6===_0x30e503(0x23f))return;await telegramBotService_1[_0x30e503(0x178)][_0x30e503(0x25e)](_0x431067[_0x30e503(0x19f)],_0x431067,_0x649cc6);}catch(_0x3ab43f){console[_0x30e503(0x212)](_0x30e503(0x223),_0x3ab43f);}}async[a50_0x55adfc(0x17e)](_0x61feb8){const _0x6c9eaf=a50_0x55adfc;console[_0x6c9eaf(0x181)](_0x6c9eaf(0x1da)+_0x61feb8);const _0x1ac3e0=await database_1['default'][_0x6c9eaf(0x253)]['findUnique']({'where':{'id':_0x61feb8},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x1ac3e0)throw new Error('Payment\x20not\x20found');if(_0x1ac3e0[_0x6c9eaf(0x199)]!==_0x6c9eaf(0x211)&&_0x1ac3e0['gateway']!==_0x6c9eaf(0x15f))throw new Error(_0x6c9eaf(0x215));console[_0x6c9eaf(0x181)](_0x6c9eaf(0x20a)+_0x1ac3e0['gateway']+'\x20payment\x20'+_0x61feb8),await this[_0x6c9eaf(0x1f4)](_0x1ac3e0),console['log'](_0x6c9eaf(0x255)+_0x61feb8);}[a50_0x55adfc(0x225)](){const _0x40d471=a50_0x55adfc,_0x2e63eb=this[_0x40d471(0x1cf)]?this[_0x40d471(0x183)]:undefined,_0x411a5f=Array[_0x40d471(0x209)](this[_0x40d471(0x208)][_0x40d471(0x190)]())[_0x40d471(0x164)](_0x20334e=>({'paymentId':_0x20334e['paymentId'],'gatewayPaymentId':_0x20334e[_0x40d471(0x1d9)],'createdAt':_0x20334e[_0x40d471(0x20b)],'timersCount':_0x20334e['timers']['length']}));return{'isActive':!!this[_0x40d471(0x1cf)],'globalCheckIntervalMinutes':this['GLOBAL_CHECK_INTERVAL_MS']/(0x3e8*0x3c),'expiryDays':this[_0x40d471(0x1ec)],'activeIndividualTimers':this[_0x40d471(0x208)]['size'],'nextGlobalCheckIn':_0x2e63eb,'paymentTimersDetails':_0x411a5f};}[a50_0x55adfc(0x1b7)](_0x10126a){const _0x16c9e9=a50_0x55adfc,_0x3e19d5=this[_0x16c9e9(0x208)][_0x16c9e9(0x1e4)](_0x10126a);if(_0x3e19d5)return{'hasTimers':!![],'timersCount':_0x3e19d5[_0x16c9e9(0x262)][_0x16c9e9(0x186)],'createdAt':_0x3e19d5[_0x16c9e9(0x20b)],'gatewayPaymentId':_0x3e19d5[_0x16c9e9(0x1d9)]};return{'hasTimers':![]};}async[a50_0x55adfc(0x1bd)](_0x466a08,_0xa3b939){const _0x182cd1=a50_0x55adfc;try{const _0x41347f=await database_1[_0x182cd1(0x1e9)]['shop'][_0x182cd1(0x251)]({'where':{'id':_0x466a08},'select':{'gatewaySettings':!![]}});if(!_0x41347f?.[_0x182cd1(0x1c5)])return console[_0x182cd1(0x181)](_0x182cd1(0x160)+_0x466a08+_0x182cd1(0x1ea)),0xa;const _0x469d21=JSON['parse'](_0x41347f[_0x182cd1(0x1c5)]);for(const [_0x3cca3e,_0x52e1c7]of Object[_0x182cd1(0x222)](_0x469d21)){if(_0x3cca3e[_0x182cd1(0x159)]()===_0xa3b939['toLowerCase']()){const _0x1c263a=_0x52e1c7[_0x182cd1(0x244)]||0xa;return console[_0x182cd1(0x181)](_0x182cd1(0x1a1)+_0xa3b939+_0x182cd1(0x170)+_0x466a08+':\x20'+_0x1c263a+'%'),_0x1c263a;}}return console[_0x182cd1(0x181)](_0x182cd1(0x174)+_0xa3b939+_0x182cd1(0x237)+_0x466a08+_0x182cd1(0x261)),0xa;}catch(_0x3ea307){return console['error'](_0x182cd1(0x227)+_0x466a08+',\x20gateway\x20'+_0xa3b939+':',_0x3ea307),0xa;}}}function a50_0x26d3(_0x4b51f4,_0x45ad8c){_0x4b51f4=_0x4b51f4-0x158;const _0x5b1df4=a50_0x5b1d();let _0x26d33b=_0x5b1df4[_0x4b51f4];return _0x26d33b;}exports[a50_0x55adfc(0x1e7)]=CoinToPayStatusService,exports[a50_0x55adfc(0x217)]=new CoinToPayStatusService();function a50_0x5b1d(){const _0x2ff4c9=['\x20\x20\x20‚ùå\x20Error:\x20','shopId','gatewayOrderId','Gateway\x20','üõë\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','logShopWebhookSent','18fDiagK','amountUSDT','message','checkExpiredPayments','üîç\x20[CHECK]\x20Checking\x20','\x20has\x20no\x20gatewayPaymentId','size','\x20checked,\x20','\x20\x20\x20-\x20GatewayPaymentId:\x20','checkAllPendingPayments','\x20status:\x20','‚úÖ\x20[CHECK]\x20Payment\x20','sendPaymentStatusNotification','PAID','confirmedOn','now','expired','8MOqgVy','checkPaymentStatus','getPaymentTimerInfo',',\x20status=','EXPIRED','‚ö†Ô∏è\x20[CHECK]\x20Payment\x20','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','\x20completed\x20for\x20payment\x20','getGatewayCommission','status_check','üîÑ\x20[CHECK]\x20Updating\x20payment\x20','bankDetails','./loggerService','findMany','üìä\x20[HOURLY]\x20Payment\x20','\x20updated:\x20currentPayments=','gatewaySettings','remitterIban','iban','\x20\x20\x20Gateway\x20','\x20is\x20older\x20than\x20','webhookUrl','paymentLinkId','\x20\x20\x20üìù\x20Context:','2856984VhGiFA',',\x20stopping\x20individual\x20checks','globalCheckInterval','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','currencyService',',\x20clearing\x20individual\x20timers','__importDefault','\x20expired\x20CoinToPay\x20payments','not\x20confirmed','\x20days','‚úÖ\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','includes','gatewayPaymentId','üîç\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','h),\x20skipping\x20global\x20check','logCoinToPayError','‚ùå\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','ü™ô\x20[TIMER]\x20Individual\x20check\x20#','ü™ô\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','POST','checkSinglePaymentById','üìä\x20[CHECK]\x20CoinToPay\x20payment\x20','forEach','get','type','paymentDetails','CoinToPayStatusService','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','default',',\x20using\x20default\x20commission\x2010%','\x20\x20\x20-\x20gatewayPaymentId:\x20','EXPIRY_DAYS','‚ùå\x20[TIMER]\x20Failed\x20individual\x20check\x20#','amountAfterGatewayCommissionUSDT','\x20skipped,\x20','üìà\x20[COINTOPAY]\x20Payment\x20','3600368zxwwpk','set','create','checkSinglePayment','./gateways/coinToPayService','\x20not\x20enabled\x20for\x20shop\x20','setDate','‚è∞\x20[DEBUG]\x20Scheduled\x20check\x20#','‚ùå\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','Shop\x20webhook\x20sent\x20to\x20','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','\x20pending\x20CoinToPay\x20payments','delete','application/json','\x20\x20\x20-\x20Gateway:\x20','\x20status\x20unchanged\x20(','has','Failed\x20to\x20mark\x20payment\x20as\x20expired','loggerService','‚è∞\x20[HOURLY]\x20Payment\x20','../types/gateway','‚úÖ\x20[HOURLY]\x20Payment\x20','\x20\x20\x20-\x20Status:\x20','paymentTimers','from','‚úÖ\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','createdAt','‚úÖ\x20[COINTOPAY]\x20Payment\x20link\x20','toFixed','../config/database','1067332KFbqUq','ü™ô\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','cointopay','error','getDate','1609165IxAMxq','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','\x20\x20\x20üìù\x20Details:','coinToPayStatusService','\x20has\x20no\x20gatewayPaymentId,\x20skipping','status','\x20in\x20','\x20USDT','defineProperty','‚è∞\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','Payment\x20System/1.0','COMPLETED','stopPeriodicStatusCheck','customerName','entries','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','ü™ô\x20[ERROR]\x20CoinToPay\x20Error:\x20','getServiceStats','üÜî\x20[CHECK]\x20Transaction\x20ID:\x20','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','text','customerEmail','toISOString','Failed\x20to\x20send\x20shop\x20webhook:','PENDING','‚úÖ\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','‚úÖ\x20[DEBUG]\x20Successfully\x20scheduled\x20','‚ùå\x20[HOURLY]\x20Payment\x20','\x20individual\x20payment\x20timers','\x20amounts\x20calculated:','Webhook\x20event\x20','logCoinToPayStatus','currentPayments','paid','__esModule','\x20in\x20shop\x20','delay','10FkkBrX','auto_expire','\x20status\x20from\x20','settings','‚ùå\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','shop','created','ü™ô\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','webhook_send','ü™ô\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','orderId','commission','CoinToPay2Service','stringify','\x20seconds\x20(','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','\x20(age:\x20','2996751wuepCK','\x20to\x20','./currencyService','startPeriodicStatusCheck','floor','cointopay_status_check_','\x20initial\x20timers\x20for\x20payment\x20','findUnique','gatewayCommissionRate','payment','catch','‚úÖ\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','\x20\x20\x20üìä\x20Status:\x20','schedule_created','\x20details:','clearPaymentTimers','\x20timers\x20for\x20payment\x20','getTime','coinToPay2Service','\x20to\x20clear','sendPaymentNotification','webhookLog','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check',',\x20using\x20default\x2010%','timers','transactionId','toLowerCase','.\x20Remaining\x20active\x20timers:\x20','COINTOPAY_ERROR','unknown','\x20\x20\x20üìç\x20Source:\x20','üßπ\x20[CHECK]\x20Payment\x20','cointopay2','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','üõë\x20[SHUTDOWN]\x20Cleared\x20','/status/','ms)','map','\x20->\x20','currency','\x20for\x20payment\x20','Payment\x20older\x20than\x20','payment.failed','paidAt','update','‚ùå\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','payment.pending','paymentLink','\x20expired','\x20commission\x20for\x20shop\x20','\x20\x20\x20-\x20paymentId:\x20','-day\x20timeout','\x20(after\x20','No\x20specific\x20commission\x20found\x20for\x20gateway\x20','amount','2YJFurm','sendShopWebhook','telegramBotService','\x20status\x20is\x20','\x20days\x20(created\x20before\x20','7601783zsMDcU','‚è∞\x20[EXPIRY]\x20Payment\x20','‚úÖ\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','checkPaymentById','FAILED','üè¶\x20[CHECK]\x20Saved\x20IBAN:\x20','log','5\x20minutes','GLOBAL_CHECK_INTERVAL_MS','\x20payment\x20','üí∞\x20[CHECK]\x20Payment\x20','length','41762237jUiyAl','./gateways/coinToPay2Service','üßπ\x20[DEBUG]\x20Clearing\x20','‚úÖ\x20[TIMER]\x20Individual\x20check\x20#','\x20triggered\x20for\x20payment\x20','cointopay_auto_expired','üìä\x20[CHECK]\x20Payment\x20','ü™ô\x20[DEBUG]\x20Creating\x20','ü™ô\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','values','üìä\x20[CHECK]\x20CoinToPay2\x20payment\x20','description','stack','./telegramBotService','1\x20minute','convertToUSDT','üõë\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','Unknown\x20error','gateway','COINTOPAY_STATUS_CHANGE','\x20\x20\x20üìÖ\x20Time:\x20','\x20with\x20status\x20','‚è∞\x20[GLOBAL]\x20Payment\x20'];a50_0x5b1d=function(){return _0x2ff4c9;};return a50_0x5b1d();}