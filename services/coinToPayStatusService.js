'use strict';const a42_0x5d3cc0=a42_0x1eeb;(function(_0x2d4678,_0x5281e2){const _0x29fef8=a42_0x1eeb,_0x5dd7c6=_0x2d4678();while(!![]){try{const _0x5028b5=-parseInt(_0x29fef8(0x12d))/0x1+parseInt(_0x29fef8(0x172))/0x2+parseInt(_0x29fef8(0x1ff))/0x3+parseInt(_0x29fef8(0xee))/0x4+-parseInt(_0x29fef8(0x149))/0x5+-parseInt(_0x29fef8(0x1ee))/0x6+-parseInt(_0x29fef8(0x147))/0x7;if(_0x5028b5===_0x5281e2)break;else _0x5dd7c6['push'](_0x5dd7c6['shift']());}catch(_0x17e044){_0x5dd7c6['push'](_0x5dd7c6['shift']());}}}(a42_0x551f,0x95732));function a42_0x1eeb(_0x4880c0,_0x598ed9){const _0x551f27=a42_0x551f();return a42_0x1eeb=function(_0x1eebf2,_0x3e78ce){_0x1eebf2=_0x1eebf2-0xec;let _0x4a65b7=_0x551f27[_0x1eebf2];return _0x4a65b7;},a42_0x1eeb(_0x4880c0,_0x598ed9);}function a42_0x551f(){const _0x592d03=['timestamp','SINGLE','‚úÖ\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','getGatewayIdByName','logCoinToPayError','\x20for\x20payment\x20','‚ö†Ô∏è\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','paymentDetails','not\x20confirmed','/status/','\x20updated:\x20currentPayments=','Bank\x20Details:\x20','322328DRBXan','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','get','\x20payment\x20','EXPIRED','\x20(age:\x20','\x20to\x20','toLowerCase','Failed\x20to\x20mark\x20payment\x20as\x20expired','log','amountAfterGatewayCommissionUSDT','‚ùå\x20[HOURLY]\x20Payment\x20','\x20is\x20older\x20than\x20','\x20not\x20found,\x20clearing\x20timers','‚úÖ\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20',',\x20status=','not\x20found','\x20amounts\x20calculated:','currencyService','ü™ô\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','transactionId','delay','delete','adminNotes','ü™ô\x20[TIMER]\x20Individual\x20check\x20#','status_check','üìä\x20[CHECK]\x20Payment\x20','\x20expired','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','üìä\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','./loggerService','createdOn','logShopWebhookError','default','‚è∞\x20[HOURLY]\x20Payment\x20','coinToPayService','\x20pending\x20CoinToPay\x20payments','webhookLog','shop','No\x20gateway\x20settings\x20found\x20for\x20shop\x20',',\x20gateway\x20','\x20is\x20valid\x20for\x20checking,\x20proceeding...','\x20status\x20is\x20','from','\x20\x20\x20-\x20Amount:\x20','./gateways/coinToPay2Service','clearPaymentTimers','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','.\x20Remaining\x20active\x20timers:\x20','confirmedOn','\x20\x20\x20-\x20ShopId:\x20','checkSinglePayment','\x20\x20\x20üìÖ\x20Time:\x20','‚úÖ\x20[COINTOPAY]\x20Payment\x20link\x20','has','‚ùå\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','__esModule','paymentId','üìà\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','globalCheckInterval','getServiceStats','description','paymentTimers','EXPIRY_DAYS','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','iban','cointopay_auto_expired','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','payment.pending','webhookEvents','\x20to\x20clear','Failed\x20to\x20send\x20shop\x20webhook:','shopId','Webhook\x20event\x20','includes','setDate','cointopay2',',\x20clearing\x20individual\x20timers','\x20\x20\x20Amount:\x20','\x20not\x20found\x20in\x20database','‚úÖ\x20[HOURLY]\x20Payment\x20','orderId','‚úÖ\x20[TIMER]\x20Individual\x20check\x20#','customerName','\x20\x20\x20üìù\x20Context:','logCoinToPayStatus','Gateway\x20','../types/gateway','\x20seconds\x20(',',\x20using\x20default\x2010%','toFixed','üìä\x20[CHECK]\x20CoinToPay2\x20payment\x20','\x20skipped,\x20','‚è∞\x20[GLOBAL]\x20Payment\x20','\x20checked,\x20','‚ùå\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','COMPLETED','amountUSDT','currency','\x20with\x20status\x20','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','remitterIban','\x20status:\x20','Unknown\x20error','\x20\x20\x20Amount\x20after\x20commission:\x20','convertToUSDT','forEach','amount','checkSinglePaymentById','text','paymentLink','gateway','message','üè¶\x20[CHECK]\x20Saved\x20IBAN:\x20','catch','size','‚ùå\x20[CHECK]\x20Payment\x20','\x20days','paid','gatewaySettings','üîç\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','Automatically\x20expired\x20after\x20','../config/database','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','242424jkougm','length','customerEmail','\x20USDT','\x20status\x20from\x20','createdAt','üõë\x20[SHUTDOWN]\x20Cleared\x20','unknown','stack','Shop\x20webhook\x20sent\x20to\x20','üßπ\x20[DEBUG]\x20Clearing\x20','‚úÖ\x20[DEBUG]\x20Successfully\x20scheduled\x20','üîç\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','-day\x20timeout','gatewayPaymentId','\x20\x20\x20-\x20paymentId:\x20','üÜî\x20[CHECK]\x20Transaction\x20ID:\x20','1595496OcVYsl','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','gatewayCommissionRate','./telegramBotService','4220040hVrhBV','checkPaymentById','üìà\x20[COINTOPAY]\x20Payment\x20','now','5\x20minutes','\x20expired\x20CoinToPay\x20payments','‚è∞\x20[EXPIRY]\x20Payment\x20','webhookUrl','./gateways/coinToPayService','sendShopWebhook','‚è∞\x20[GLOBAL]\x20Found\x20','\x20\x20\x20üìä\x20Status:\x20','PENDING','Payment\x20older\x20than\x20','\x20details:','Payment\x20System/1.0','\x20\x20\x20-\x20Status:\x20','PAID','coinToPayStatusService','sendPaymentStatusNotification','push','\x20\x20\x20‚ùå\x20Error:\x20','expired','settings','timers',',\x20stopping\x20individual\x20checks','ü™ô\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','schedule_created','payment.failed','ü™ô\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','checkPaymentStatus','‚úÖ\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','\x20->\x20','\x20\x20\x20üìç\x20Source:\x20','stringify','üí∞\x20[CHECK]\x20Payment\x20','\x20\x20\x20-\x20GatewayPaymentId:\x20','\x20found:','startPeriodicStatusCheck','update','getGatewayCommission','\x20in\x20shop\x20','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','ü™ô\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','üè¶\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes','COINTOPAY_STATUS_CHANGE','payment','bankDetails','findUnique','‚úÖ\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','application/json','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','üßπ\x20[CHECK]\x20Payment\x20','\x20status\x20changed\x20to\x20','‚ùå\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','./currencyService','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20',':\x20type=','cointopay_status_check_','currentPayments','‚ùå\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','\x20initial\x20timers\x20for\x20payment\x20','445059cflVCD','create','‚è∞\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','\x20commission:\x20','ü™ô\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','checkExpiredPayments','auto_expire',',\x20currentPayments=','floor','\x20days\x20(created\x20before\x20','parse','üîÑ\x20[CHECK]\x20Updating\x20payment\x20','status','stopPeriodicStatusCheck','entries','error','GLOBAL_CHECK_INTERVAL_MS','h),\x20skipping\x20global\x20check','\x20updated\x20successfully','‚úÖ\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','created','POST','\x20current\x20status:\x20','coinToPay2Service','‚úÖ\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','617211sqspvR','‚è∞\x20[DEBUG]\x20Scheduled\x20check\x20#','2811120abWsPS','getTime','cointopay','\x20individual\x20payment\x20timers','CoinToPayService','üßπ\x20[DEBUG]\x20Cleared\x20timer\x20#','üîç\x20[CHECK]\x20Checking\x20','‚úÖ\x20[CHECK]\x20Payment\x20','failed','\x20days\x20without\x20payment\x20confirmation','\x20in\x20','\x20status\x20unchanged\x20(','\x20\x20\x20üìù\x20Details:','paidAt','CoinToPayStatusService','2\x20minutes','‚ö†Ô∏è\x20[CHECK]\x20Payment\x20',',\x20using\x20default\x20commission\x2010%','logWhiteDomainError','toISOString','webhook_send','checkAllPendingPayments','logShopWebhookSent','üõë\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','findMany','\x20not\x20enabled\x20for\x20shop\x20','loggerService','FAILED','‚ùå\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20'];a42_0x551f=function(){return _0x592d03;};return a42_0x551f();}var __importDefault=this&&this['__importDefault']||function(_0x35fb4b){const _0x2540ac=a42_0x1eeb;return _0x35fb4b&&_0x35fb4b[_0x2540ac(0x1aa)]?_0x35fb4b:{'default':_0x35fb4b};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a42_0x5d3cc0(0x100)]=exports['CoinToPayStatusService']=void 0x0;const coinToPayService_1=require(a42_0x5d3cc0(0xf6)),coinToPay2Service_1=require(a42_0x5d3cc0(0x19f)),gateway_1=require(a42_0x5d3cc0(0x1c9)),database_1=__importDefault(require(a42_0x5d3cc0(0x1ec))),telegramBotService_1=require(a42_0x5d3cc0(0xed)),loggerService_1=require(a42_0x5d3cc0(0x190)),currencyService_1=require(a42_0x5d3cc0(0x126));class CoinToPayStatusService{constructor(){const _0x27e6b8=a42_0x5d3cc0;this['globalCheckInterval']=null,this[_0x27e6b8(0x13d)]=0x3c*0x3c*0x3e8,this['EXPIRY_DAYS']=0x5,this[_0x27e6b8(0x1b0)]=new Map(),this['coinToPayService']=new coinToPayService_1[(_0x27e6b8(0x14d))](),this[_0x27e6b8(0x144)]=new coinToPay2Service_1['CoinToPay2Service'](),console[_0x27e6b8(0x17b)]('ü™ô\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2');}['schedulePaymentChecks'](_0x7c0c79,_0x3b88b0){const _0xac8774=a42_0x5d3cc0;console[_0xac8774(0x17b)](_0xac8774(0x108)),console[_0xac8774(0x17b)](_0xac8774(0x1fd)+_0x7c0c79),console['log']('\x20\x20\x20-\x20gatewayPaymentId:\x20'+_0x3b88b0),this['clearPaymentTimers'](_0x7c0c79);const _0x246dbe=[],_0xac28f5=new Date(),_0x1fce92=[{'delay':0x1*0x3c*0x3e8,'description':'1\x20minute'},{'delay':0x2*0x3c*0x3e8,'description':_0xac8774(0x158)},{'delay':0x5*0x3c*0x3e8,'description':_0xac8774(0xf2)},{'delay':0x5*0x3c*0x3e8,'description':_0xac8774(0xf2)}];console[_0xac8774(0x17b)]('ü™ô\x20[DEBUG]\x20Creating\x20'+_0x1fce92[_0xac8774(0x1ef)]+_0xac8774(0x12c)+_0x7c0c79);let _0x57b773=0x0;_0x1fce92[_0xac8774(0x1dc)]((_0x1b40c6,_0x3abdf0)=>{const _0x9e5644=_0xac8774;_0x57b773+=_0x1b40c6[_0x9e5644(0x187)];const _0x3423aa=setTimeout(async()=>{const _0x1970fc=_0x9e5644;console[_0x1970fc(0x17b)](_0x1970fc(0x18a)+(_0x3abdf0+0x1)+'\x20triggered\x20for\x20payment\x20'+_0x7c0c79+'\x20(after\x20'+_0x1b40c6[_0x1970fc(0x1af)]+')');try{await this[_0x1970fc(0x1de)](_0x7c0c79),console[_0x1970fc(0x17b)](_0x1970fc(0x1c4)+(_0x3abdf0+0x1)+'\x20completed\x20for\x20payment\x20'+_0x7c0c79);}catch(_0x2b170c){console['error']('‚ùå\x20[TIMER]\x20Failed\x20individual\x20check\x20#'+(_0x3abdf0+0x1)+_0x1970fc(0x16b)+_0x7c0c79+':',_0x2b170c),this[_0x1970fc(0x16a)](_0x7c0c79,_0x3b88b0,_0x2b170c,_0x1970fc(0x18b),{'checkNumber':_0x3abdf0+0x1,'scheduledAfter':_0x1b40c6['description'],'isIndividualCheck':!![]});}},_0x57b773);_0x246dbe[_0x9e5644(0x102)](_0x3423aa),console[_0x9e5644(0x17b)](_0x9e5644(0x148)+(_0x3abdf0+0x1)+_0x9e5644(0x16b)+_0x7c0c79+_0x9e5644(0x153)+_0x57b773/0x3e8+_0x9e5644(0x1ca)+_0x1b40c6[_0x9e5644(0x1af)]+')');});const _0x1957f0=setInterval(async()=>{const _0x2b7c4e=_0xac8774;console[_0x2b7c4e(0x17b)]('ü™ô\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20'+_0x7c0c79);try{const _0x4e78f0=await database_1[_0x2b7c4e(0x193)]['payment'][_0x2b7c4e(0x11f)]({'where':{'id':_0x7c0c79},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x4e78f0){console['log'](_0x2b7c4e(0x17d)+_0x7c0c79+_0x2b7c4e(0x17f)),this['clearPaymentTimers'](_0x7c0c79);return;}console[_0x2b7c4e(0x17b)]('üìä\x20[HOURLY]\x20Payment\x20'+_0x7c0c79+_0x2b7c4e(0x143)+_0x4e78f0[_0x2b7c4e(0x139)]);if(_0x4e78f0['status']!==_0x2b7c4e(0xfa)){console['log'](_0x2b7c4e(0x1c2)+_0x7c0c79+_0x2b7c4e(0x19c)+_0x4e78f0['status']+_0x2b7c4e(0x107)),this[_0x2b7c4e(0x1a0)](_0x7c0c79);return;}const _0x31643e=Math[_0x2b7c4e(0x135)]((Date[_0x2b7c4e(0xf1)]()-_0x4e78f0[_0x2b7c4e(0x1f3)][_0x2b7c4e(0x14a)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x31643e>=this[_0x2b7c4e(0x1b1)]){console['log'](_0x2b7c4e(0x194)+_0x7c0c79+_0x2b7c4e(0x17e)+this[_0x2b7c4e(0x1b1)]+'\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check'),this[_0x2b7c4e(0x1a0)](_0x7c0c79);return;}await this[_0x2b7c4e(0x1de)](_0x7c0c79),console[_0x2b7c4e(0x17b)](_0x2b7c4e(0x120)+_0x7c0c79);}catch(_0x1a754f){console[_0x2b7c4e(0x13c)](_0x2b7c4e(0x12b)+_0x7c0c79+':',_0x1a754f),this[_0x2b7c4e(0x16a)](_0x7c0c79,_0x3b88b0,_0x1a754f,'status_check',{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x246dbe[_0xac8774(0x102)](_0x1957f0),this[_0xac8774(0x1b0)]['set'](_0x7c0c79,{'timers':_0x246dbe,'paymentId':_0x7c0c79,'gatewayPaymentId':_0x3b88b0,'createdAt':_0xac28f5}),console[_0xac8774(0x17b)](_0xac8774(0x1f9)+_0x1fce92[_0xac8774(0x1ef)]+'\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20'+_0x7c0c79),console[_0xac8774(0x17b)](_0xac8774(0x18f)+this[_0xac8774(0x1b0)][_0xac8774(0x1e5)]),this[_0xac8774(0x1c7)](_0x7c0c79,_0x3b88b0,_0xac8774(0xfa),_0xac8774(0xfa),_0xac8774(0x18b),{'action':_0xac8774(0x109),'scheduledChecks':_0x1fce92[_0xac8774(0x1ef)],'firstCheckIn':_0x1fce92[0x0][_0xac8774(0x187)]/0x3e8,'totalTimers':this[_0xac8774(0x1b0)]['size']});}[a42_0x5d3cc0(0x1a0)](_0x1a528f){const _0x558225=a42_0x5d3cc0,_0x35e61f=this[_0x558225(0x1b0)][_0x558225(0x174)](_0x1a528f);_0x35e61f?(console[_0x558225(0x17b)](_0x558225(0x1f8)+_0x35e61f[_0x558225(0x106)][_0x558225(0x1ef)]+'\x20timers\x20for\x20payment\x20'+_0x1a528f),_0x35e61f[_0x558225(0x106)][_0x558225(0x1dc)]((_0x590b3d,_0x880041)=>{const _0x379c1c=_0x558225;_0x590b3d&&(clearTimeout(_0x590b3d),clearInterval(_0x590b3d),console[_0x379c1c(0x17b)](_0x379c1c(0x14e)+(_0x880041+0x1)+'\x20for\x20payment\x20'+_0x1a528f));}),this[_0x558225(0x1b0)][_0x558225(0x188)](_0x1a528f),console[_0x558225(0x17b)](_0x558225(0x168)+_0x1a528f+_0x558225(0x1a2)+this[_0x558225(0x1b0)][_0x558225(0x1e5)])):console[_0x558225(0x17b)](_0x558225(0x16c)+_0x1a528f+_0x558225(0x1b8));}async['checkSinglePaymentById'](_0x10aad7){const _0x50da4c=a42_0x5d3cc0;console[_0x50da4c(0x17b)](_0x50da4c(0x1ea)+_0x10aad7);const _0x56392b=await database_1['default']['payment']['findUnique']({'where':{'id':_0x10aad7},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x56392b){console['log'](_0x50da4c(0x1e6)+_0x10aad7+_0x50da4c(0x1c1));return;}console[_0x50da4c(0x17b)](_0x50da4c(0x18c)+_0x10aad7+_0x50da4c(0x113)),console[_0x50da4c(0x17b)]('\x20\x20\x20-\x20Gateway:\x20'+_0x56392b['gateway']),console[_0x50da4c(0x17b)](_0x50da4c(0xfe)+_0x56392b['status']),console['log'](_0x50da4c(0x112)+_0x56392b[_0x50da4c(0x1fc)]),console[_0x50da4c(0x17b)](_0x50da4c(0x19e)+_0x56392b['amount']+'\x20'+_0x56392b[_0x50da4c(0x1d4)]),console[_0x50da4c(0x17b)](_0x50da4c(0x1a4)+_0x56392b['shopId']);if(_0x56392b[_0x50da4c(0x1e1)]!=='cointopay'&&_0x56392b[_0x50da4c(0x1e1)]!=='cointopay2'){console[_0x50da4c(0x17b)](_0x50da4c(0x159)+_0x10aad7+_0x50da4c(0x119)+_0x56392b[_0x50da4c(0x1e1)]+')');return;}if(_0x56392b[_0x50da4c(0x139)]!==_0x50da4c(0xfa)){console[_0x50da4c(0x17b)](_0x50da4c(0x159)+_0x10aad7+'\x20status\x20is\x20'+_0x56392b[_0x50da4c(0x139)]+_0x50da4c(0x107)),this['clearPaymentTimers'](_0x10aad7);return;}if(!_0x56392b[_0x50da4c(0x1fc)]){console[_0x50da4c(0x17b)](_0x50da4c(0x159)+_0x10aad7+'\x20has\x20no\x20gatewayPaymentId');return;}console[_0x50da4c(0x17b)](_0x50da4c(0x150)+_0x10aad7+_0x50da4c(0x19b)),await this[_0x50da4c(0x1a5)](_0x56392b);}[a42_0x5d3cc0(0x1c7)](_0x4978ca,_0x1c9693,_0x709b24,_0x14783b,_0x326e20,_0x1a8260){const _0x140190=a42_0x5d3cc0,_0x1d6b29={'type':_0x140190(0x11c),'paymentId':_0x4978ca,'gatewayPaymentId':_0x1c9693,'oldStatus':_0x709b24,'newStatus':_0x14783b,'source':_0x326e20,'timestamp':new Date()['toISOString'](),'details':_0x1a8260||{}};loggerService_1[_0x140190(0x163)][_0x140190(0x1c7)](_0x1d6b29),console['log'](_0x140190(0x185)+_0x4978ca+'\x20('+_0x1c9693+')'),console[_0x140190(0x17b)](_0x140190(0xf9)+_0x709b24+_0x140190(0x10e)+_0x14783b),console[_0x140190(0x17b)](_0x140190(0x10f)+_0x326e20),console[_0x140190(0x17b)](_0x140190(0x1a6)+_0x1d6b29[_0x140190(0x166)]),_0x1a8260&&console['log'](_0x140190(0x155),_0x1a8260);}[a42_0x5d3cc0(0x16a)](_0x23b8b7,_0x3e8e83,_0x2059bf,_0x28ca96,_0x10eb73){const _0x244fdf=a42_0x5d3cc0,_0x3d501e={'type':'COINTOPAY_ERROR','paymentId':_0x23b8b7,'gatewayPaymentId':_0x3e8e83,'error':_0x2059bf instanceof Error?{'message':_0x2059bf['message'],'stack':_0x2059bf[_0x244fdf(0x1f6)]}:_0x2059bf,'source':_0x28ca96,'timestamp':new Date()['toISOString'](),'context':_0x10eb73||{}};loggerService_1[_0x244fdf(0x163)][_0x244fdf(0x16a)](_0x3d501e),console[_0x244fdf(0x13c)]('ü™ô\x20[ERROR]\x20CoinToPay\x20Error:\x20'+_0x23b8b7+'\x20('+_0x3e8e83+')'),console[_0x244fdf(0x13c)](_0x244fdf(0x103)+(_0x2059bf instanceof Error?_0x2059bf[_0x244fdf(0x1e2)]:_0x2059bf)),console[_0x244fdf(0x13c)](_0x244fdf(0x10f)+_0x28ca96),console[_0x244fdf(0x13c)]('\x20\x20\x20üìÖ\x20Time:\x20'+_0x3d501e[_0x244fdf(0x166)]),_0x10eb73&&console['error'](_0x244fdf(0x1c6),_0x10eb73);}[a42_0x5d3cc0(0x114)](){const _0x3dc0c0=a42_0x5d3cc0;console['log'](_0x3dc0c0(0x11a)),this['checkAllPendingPayments']()[_0x3dc0c0(0x1e4)](_0x345b2a=>{const _0x36f7f3=_0x3dc0c0;console[_0x36f7f3(0x13c)](_0x36f7f3(0x125),_0x345b2a);}),this['globalCheckInterval']=setInterval(async()=>{const _0x2f1a91=_0x3dc0c0;try{console[_0x2f1a91(0x17b)]('ü™ô\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...'),await this[_0x2f1a91(0x15e)](),console[_0x2f1a91(0x17b)](_0x2f1a91(0x1b2));}catch(_0x2f5233){console[_0x2f1a91(0x13c)]('‚ùå\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:',_0x2f5233);}},this[_0x3dc0c0(0x13d)]),console[_0x3dc0c0(0x17b)](_0x3dc0c0(0x10d));}[a42_0x5d3cc0(0x13a)](){const _0x368a57=a42_0x5d3cc0;console[_0x368a57(0x17b)](_0x368a57(0x160));this[_0x368a57(0x1ad)]&&(clearInterval(this['globalCheckInterval']),this[_0x368a57(0x1ad)]=null,console[_0x368a57(0x17b)]('üõë\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped'));const _0x105a25=this[_0x368a57(0x1b0)][_0x368a57(0x1e5)];for(const [_0x4c78eb]of this[_0x368a57(0x1b0)]){this[_0x368a57(0x1a0)](_0x4c78eb);}console['log'](_0x368a57(0x1f4)+_0x105a25+_0x368a57(0x14c));}async[a42_0x5d3cc0(0x15e)](){const _0x102ade=a42_0x5d3cc0;try{console[_0x102ade(0x17b)](_0x102ade(0x131));const _0x126615=await database_1['default'][_0x102ade(0x11d)][_0x102ade(0x161)]({'where':{'gateway':{'in':[_0x102ade(0x14b),_0x102ade(0x1be)]},'status':'PENDING','gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x102ade(0x17b)]('ü™ô\x20[GLOBAL]\x20Found\x20'+_0x126615[_0x102ade(0x1ef)]+_0x102ade(0x196));if(_0x126615[_0x102ade(0x1ef)]===0x0){console[_0x102ade(0x17b)](_0x102ade(0x10b));return;}const _0x2f6bba=await this['checkExpiredPayments'](_0x126615);console['log'](_0x102ade(0xf8)+_0x2f6bba[_0x102ade(0x1ef)]+_0x102ade(0xf3));let _0xfbf6b=0x0,_0x311c97=0x0;for(const _0x24a5eb of _0x126615){try{if(_0x2f6bba[_0x102ade(0x1bc)](_0x24a5eb['id'])){console[_0x102ade(0x17b)](_0x102ade(0x1cf)+_0x24a5eb['id']+_0x102ade(0x1a1)),_0x311c97++;continue;}if(this[_0x102ade(0x1b0)][_0x102ade(0x1a8)](_0x24a5eb['id'])){console[_0x102ade(0x17b)](_0x102ade(0x1cf)+_0x24a5eb['id']+_0x102ade(0x200)),_0x311c97++;continue;}const _0x5b1c65=(Date[_0x102ade(0xf1)]()-_0x24a5eb[_0x102ade(0x1f3)][_0x102ade(0x14a)]())/(0x3e8*0x3c*0x3c);if(_0x5b1c65<0x1){console[_0x102ade(0x17b)](_0x102ade(0x1cf)+_0x24a5eb['id']+'\x20is\x20too\x20new\x20('+_0x5b1c65[_0x102ade(0x1cc)](0x1)+_0x102ade(0x13e)),_0x311c97++;continue;}console[_0x102ade(0x17b)]('üîç\x20[GLOBAL]\x20Checking\x20old\x20payment\x20'+_0x24a5eb['id']+_0x102ade(0x177)+_0x5b1c65[_0x102ade(0x1cc)](0x1)+'h)'),await this[_0x102ade(0x1a5)](_0x24a5eb),_0xfbf6b++,await new Promise(_0x2f9d36=>setTimeout(_0x2f9d36,0x7d0));}catch(_0x3a04c0){console['error']('‚ùå\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20'+_0x24a5eb['id']+':',_0x3a04c0),this[_0x102ade(0x16a)](_0x24a5eb['id'],_0x24a5eb[_0x102ade(0x1fc)]||'unknown',_0x3a04c0,_0x102ade(0x18b),{'isGlobalCheck':!![],'paymentAmount':_0x24a5eb['amount'],'paymentCurrency':_0x24a5eb[_0x102ade(0x1d4)],'shopId':_0x24a5eb[_0x102ade(0x1ba)],'createdAt':_0x24a5eb[_0x102ade(0x1f3)]}),loggerService_1[_0x102ade(0x163)][_0x102ade(0x15b)](_0x102ade(0x14b),_0x102ade(0x16f)+_0x24a5eb[_0x102ade(0x1fc)],_0x3a04c0);}}console[_0x102ade(0x17b)](_0x102ade(0x1ed)+_0xfbf6b+_0x102ade(0x1d0)+_0x311c97+_0x102ade(0x1ce)+_0x2f6bba['length']+_0x102ade(0x18d));}catch(_0x11cb19){console[_0x102ade(0x13c)](_0x102ade(0x122),_0x11cb19);}}async[a42_0x5d3cc0(0x132)](_0x2efab2){const _0x24211a=a42_0x5d3cc0,_0x5beee6=[],_0x5c366d=new Date();_0x5c366d[_0x24211a(0x1bd)](_0x5c366d['getDate']()-this[_0x24211a(0x1b1)]),console['log'](_0x24211a(0x12f)+this[_0x24211a(0x1b1)]+_0x24211a(0x136)+_0x5c366d[_0x24211a(0x15c)]()+')');for(const _0x1111e6 of _0x2efab2){if(_0x1111e6[_0x24211a(0x1f3)]<_0x5c366d){console[_0x24211a(0x17b)](_0x24211a(0xf4)+_0x1111e6['id']+'\x20is\x20older\x20than\x20'+this[_0x24211a(0x1b1)]+'\x20days,\x20marking\x20as\x20EXPIRED');try{this[_0x24211a(0x1c7)](_0x1111e6['id'],_0x1111e6[_0x24211a(0x1fc)]||_0x24211a(0x1f5),_0x24211a(0xfa),_0x24211a(0x176),'auto_expire',{'reason':_0x24211a(0xfb)+this[_0x24211a(0x1b1)]+'\x20days','createdAt':_0x1111e6[_0x24211a(0x1f3)],'daysSinceCreation':Math[_0x24211a(0x135)]((Date['now']()-_0x1111e6[_0x24211a(0x1f3)][_0x24211a(0x14a)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x1111e6['amount'],'paymentCurrency':_0x1111e6[_0x24211a(0x1d4)],'shopId':_0x1111e6['shopId']}),await database_1[_0x24211a(0x193)][_0x24211a(0x11d)][_0x24211a(0x115)]({'where':{'id':_0x1111e6['id']},'data':{'status':_0x24211a(0x176),'updatedAt':new Date(),'adminNotes':_0x24211a(0x1eb)+this[_0x24211a(0x1b1)]+_0x24211a(0x152)}}),await database_1[_0x24211a(0x193)][_0x24211a(0x197)][_0x24211a(0x12e)]({'data':{'paymentId':_0x1111e6['id'],'shopId':_0x1111e6[_0x24211a(0x1ba)],'event':_0x24211a(0x1b4),'statusCode':0xc8,'responseBody':JSON['stringify']({'reason':_0x24211a(0xfb)+this[_0x24211a(0x1b1)]+_0x24211a(0x1e7),'createdAt':_0x1111e6[_0x24211a(0x1f3)],'expiredAt':new Date()[_0x24211a(0x15c)](),'daysSinceCreation':Math[_0x24211a(0x135)]((Date['now']()-_0x1111e6[_0x24211a(0x1f3)]['getTime']())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x24211a(0xf7)](_0x1111e6,'EXPIRED'),await this[_0x24211a(0x101)](_0x1111e6,'EXPIRED'),this['clearPaymentTimers'](_0x1111e6['id']),_0x5beee6['push'](_0x1111e6['id']),console[_0x24211a(0x17b)]('‚úÖ\x20[EXPIRY]\x20Payment\x20'+_0x1111e6['id']+_0x24211a(0x1b5)+this[_0x24211a(0x1b1)]+_0x24211a(0x1fb));}catch(_0x1e166b){console[_0x24211a(0x13c)](_0x24211a(0x165)+_0x1111e6['id']+':',_0x1e166b),this[_0x24211a(0x16a)](_0x1111e6['id'],_0x1111e6[_0x24211a(0x1fc)]||_0x24211a(0x1f5),_0x1e166b,_0x24211a(0x133),{'reason':_0x24211a(0x17a),'createdAt':_0x1111e6[_0x24211a(0x1f3)],'daysSinceCreation':Math[_0x24211a(0x135)]((Date[_0x24211a(0xf1)]()-_0x1111e6['createdAt'][_0x24211a(0x14a)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x5beee6;}async[a42_0x5d3cc0(0x1a5)](_0x5d7441){const _0x2f6edf=a42_0x5d3cc0;if(!_0x5d7441[_0x2f6edf(0x1fc)]){console[_0x2f6edf(0x17b)]('‚ö†Ô∏è\x20[CHECK]\x20Payment\x20'+_0x5d7441['id']+'\x20has\x20no\x20gatewayPaymentId,\x20skipping');return;}console[_0x2f6edf(0x17b)](_0x2f6edf(0x14f)+_0x5d7441[_0x2f6edf(0x1e1)]+_0x2f6edf(0x175)+_0x5d7441['id']+'\x20('+_0x5d7441[_0x2f6edf(0x1fc)]+')');try{let _0x161598;_0x5d7441[_0x2f6edf(0x1e1)]===_0x2f6edf(0x1be)?(_0x161598=await this['coinToPay2Service'][_0x2f6edf(0x10c)](_0x5d7441[_0x2f6edf(0x1fc)]),console['log'](_0x2f6edf(0x1cd)+_0x5d7441['id']+_0x2f6edf(0x1d8)+_0x161598[_0x2f6edf(0x139)])):(_0x161598=await this[_0x2f6edf(0x195)][_0x2f6edf(0x10c)](_0x5d7441[_0x2f6edf(0x1fc)]),console[_0x2f6edf(0x17b)]('üìä\x20[CHECK]\x20CoinToPay\x20payment\x20'+_0x5d7441['id']+_0x2f6edf(0x1d8)+_0x161598[_0x2f6edf(0x139)]));_0x161598['paymentDetails']&&console[_0x2f6edf(0x17b)]('üìä\x20[CHECK]\x20Payment\x20'+_0x5d7441['id']+_0x2f6edf(0xfc),{'iban':_0x161598[_0x2f6edf(0x16d)][_0x2f6edf(0x1b3)]||_0x2f6edf(0x182),'transactionId':_0x161598[_0x2f6edf(0x16d)][_0x2f6edf(0x186)],'createdOn':_0x161598[_0x2f6edf(0x16d)][_0x2f6edf(0x191)],'confirmedOn':_0x161598[_0x2f6edf(0x16d)][_0x2f6edf(0x1a3)]||_0x2f6edf(0x16e)});if(_0x161598['status']!==_0x5d7441['status']){console[_0x2f6edf(0x17b)](_0x2f6edf(0x138)+_0x5d7441['id']+_0x2f6edf(0x1f2)+_0x5d7441['status']+_0x2f6edf(0x178)+_0x161598[_0x2f6edf(0x139)]),this[_0x2f6edf(0x1c7)](_0x5d7441['id'],_0x5d7441[_0x2f6edf(0x1fc)],_0x5d7441['status'],_0x161598['status'],_0x2f6edf(0x18b),{'paymentDetails':_0x161598['paymentDetails'],'amount':_0x161598['amount'],'currency':_0x161598[_0x2f6edf(0x1d4)],'shopId':_0x5d7441[_0x2f6edf(0x1ba)],'checkTimestamp':new Date()[_0x2f6edf(0x15c)]()});const _0x1afdd9={'status':_0x161598['status'],'updatedAt':new Date()};if(_0x161598[_0x2f6edf(0x139)]===_0x2f6edf(0xff)&&_0x5d7441[_0x2f6edf(0x139)]!=='PAID'){_0x1afdd9['paidAt']=new Date();if(!_0x5d7441[_0x2f6edf(0x1d3)]){const _0x900e09=await currencyService_1[_0x2f6edf(0x184)][_0x2f6edf(0x1db)](_0x5d7441[_0x2f6edf(0x1dd)],_0x5d7441['currency']);_0x1afdd9[_0x2f6edf(0x1d3)]=_0x900e09;const _0x499e3e=await this[_0x2f6edf(0x116)](_0x5d7441['shopId'],_0x5d7441['gateway']),_0x4594d7=_0x900e09*(0x1-_0x499e3e/0x64);_0x1afdd9[_0x2f6edf(0x17c)]=_0x4594d7,_0x1afdd9[_0x2f6edf(0xec)]=_0x499e3e,console[_0x2f6edf(0x17b)](_0x2f6edf(0x111)+_0x5d7441['id']+_0x2f6edf(0x183)),console[_0x2f6edf(0x17b)](_0x2f6edf(0x1c0)+_0x5d7441['amount']+'\x20'+_0x5d7441[_0x2f6edf(0x1d4)]+_0x2f6edf(0x10e)+_0x900e09[_0x2f6edf(0x1cc)](0x6)+_0x2f6edf(0x1f1)),console[_0x2f6edf(0x17b)]('\x20\x20\x20Gateway\x20'+_0x5d7441[_0x2f6edf(0x1e1)]+_0x2f6edf(0x130)+_0x499e3e+'%'),console[_0x2f6edf(0x17b)](_0x2f6edf(0x1da)+_0x4594d7[_0x2f6edf(0x1cc)](0x6)+_0x2f6edf(0x1f1));}console[_0x2f6edf(0x17b)]('üí∞\x20[CHECK]\x20Payment\x20'+_0x5d7441['id']+'\x20marked\x20as\x20paid\x20at:\x20'+_0x1afdd9[_0x2f6edf(0x156)]['toISOString']());}if(_0x161598[_0x2f6edf(0x16d)]){const _0x440841=_0x161598[_0x2f6edf(0x16d)];_0x440841['iban']&&(_0x1afdd9[_0x2f6edf(0x1d7)]=_0x440841[_0x2f6edf(0x1b3)],console[_0x2f6edf(0x17b)](_0x2f6edf(0x1e3)+_0x440841[_0x2f6edf(0x1b3)]));if(_0x440841[_0x2f6edf(0x11e)]){const _0x7b78de=_0x5d7441[_0x2f6edf(0x189)]||'',_0x39daa2=_0x2f6edf(0x171)+_0x440841[_0x2f6edf(0x11e)];_0x1afdd9[_0x2f6edf(0x189)]=_0x7b78de?_0x7b78de+'\x0a\x0a'+_0x39daa2:_0x39daa2,console[_0x2f6edf(0x17b)](_0x2f6edf(0x11b));}_0x440841['transactionId']&&console[_0x2f6edf(0x17b)](_0x2f6edf(0x1fe)+_0x440841[_0x2f6edf(0x186)]),_0x440841['confirmedOn']&&console[_0x2f6edf(0x17b)](_0x2f6edf(0x145)+_0x440841[_0x2f6edf(0x1a3)]);}await database_1[_0x2f6edf(0x193)][_0x2f6edf(0x11d)][_0x2f6edf(0x115)]({'where':{'id':_0x5d7441['id']},'data':_0x1afdd9});if(_0x161598[_0x2f6edf(0x139)]===_0x2f6edf(0xff)&&_0x5d7441[_0x2f6edf(0x139)]!=='PAID'){console[_0x2f6edf(0x17b)](_0x2f6edf(0xf0)+_0x5d7441['id']+_0x2f6edf(0x173));const _0x8d7680=await database_1[_0x2f6edf(0x193)][_0x2f6edf(0x11d)][_0x2f6edf(0x11f)]({'where':{'id':_0x5d7441['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x8d7680?.['paymentLinkId']&&_0x8d7680['paymentLink'])try{const _0x2c582=_0x8d7680[_0x2f6edf(0x1e0)];console[_0x2f6edf(0x17b)](_0x2f6edf(0x1ac)+_0x2c582['id']+_0x2f6edf(0x128)+_0x2c582['type']+_0x2f6edf(0x134)+_0x2c582[_0x2f6edf(0x12a)]+_0x2f6edf(0x181)+_0x2c582['status']);const _0x144be2=_0x2c582[_0x2f6edf(0x12a)]+0x1,_0x3daf05=_0x2c582['type']===_0x2f6edf(0x167)?_0x2f6edf(0x1d2):_0x2c582[_0x2f6edf(0x139)];await database_1[_0x2f6edf(0x193)][_0x2f6edf(0x1e0)]['update']({'where':{'id':_0x2c582['id']},'data':{'currentPayments':_0x144be2,'status':_0x3daf05,'updatedAt':new Date()}}),console[_0x2f6edf(0x17b)](_0x2f6edf(0x1a7)+_0x2c582['id']+_0x2f6edf(0x170)+_0x2c582[_0x2f6edf(0x12a)]+_0x2f6edf(0x10e)+_0x144be2+_0x2f6edf(0x181)+_0x2c582[_0x2f6edf(0x139)]+_0x2f6edf(0x10e)+_0x3daf05);}catch(_0x323461){console[_0x2f6edf(0x13c)](_0x2f6edf(0x1a9),_0x323461);}else console[_0x2f6edf(0x17b)](_0x2f6edf(0xf0)+_0x5d7441['id']+_0x2f6edf(0x118));}await database_1[_0x2f6edf(0x193)]['webhookLog']['create']({'data':{'paymentId':_0x5d7441['id'],'shopId':_0x5d7441[_0x2f6edf(0x1ba)],'event':_0x2f6edf(0x129)+_0x161598[_0x2f6edf(0x139)][_0x2f6edf(0x179)](),'statusCode':0xc8,'responseBody':JSON[_0x2f6edf(0x110)]({'oldStatus':_0x5d7441['status'],'newStatus':_0x161598[_0x2f6edf(0x139)],'paymentDetails':_0x161598[_0x2f6edf(0x16d)],'checkedAt':new Date()[_0x2f6edf(0x15c)]()})}}),await this['sendShopWebhook'](_0x5d7441,_0x161598[_0x2f6edf(0x139)]),await this[_0x2f6edf(0x101)](_0x5d7441,_0x161598['status']),_0x161598['status']!==_0x2f6edf(0xfa)&&(console[_0x2f6edf(0x17b)](_0x2f6edf(0x123)+_0x5d7441['id']+_0x2f6edf(0x124)+_0x161598[_0x2f6edf(0x139)]+_0x2f6edf(0x1bf)),this[_0x2f6edf(0x1a0)](_0x5d7441['id'])),console['log'](_0x2f6edf(0x150)+_0x5d7441['id']+_0x2f6edf(0x13f));}else console[_0x2f6edf(0x17b)](_0x2f6edf(0x18c)+_0x5d7441['id']+_0x2f6edf(0x154)+_0x161598['status']+')'),this[_0x2f6edf(0x1c7)](_0x5d7441['id'],_0x5d7441[_0x2f6edf(0x1fc)],_0x5d7441[_0x2f6edf(0x139)],_0x161598[_0x2f6edf(0x139)],_0x2f6edf(0x18b),{'statusUnchanged':!![],'paymentDetails':_0x161598[_0x2f6edf(0x16d)],'amount':_0x161598['amount'],'currency':_0x161598[_0x2f6edf(0x1d4)],'shopId':_0x5d7441['shopId'],'checkTimestamp':new Date()[_0x2f6edf(0x15c)]()});}catch(_0x44c88e){console[_0x2f6edf(0x13c)](_0x2f6edf(0x1d1)+_0x5d7441['id']+':',_0x44c88e),this['logCoinToPayError'](_0x5d7441['id'],_0x5d7441[_0x2f6edf(0x1fc)],_0x44c88e,_0x2f6edf(0x18b),{'paymentAmount':_0x5d7441[_0x2f6edf(0x1dd)],'paymentCurrency':_0x5d7441[_0x2f6edf(0x1d4)],'shopId':_0x5d7441[_0x2f6edf(0x1ba)],'createdAt':_0x5d7441[_0x2f6edf(0x1f3)]}),await database_1[_0x2f6edf(0x193)][_0x2f6edf(0x197)][_0x2f6edf(0x12e)]({'data':{'paymentId':_0x5d7441['id'],'shopId':_0x5d7441[_0x2f6edf(0x1ba)],'event':'cointopay_status_check_error','statusCode':0x1f4,'responseBody':JSON[_0x2f6edf(0x110)]({'error':_0x44c88e instanceof Error?_0x44c88e[_0x2f6edf(0x1e2)]:_0x2f6edf(0x1d9),'gatewayPaymentId':_0x5d7441[_0x2f6edf(0x1fc)],'checkedAt':new Date()[_0x2f6edf(0x15c)]()})}});}}async[a42_0x5d3cc0(0xf7)](_0x4b7dfc,_0x57c5f3){const _0x378884=a42_0x5d3cc0,_0x53ae66=Date['now']();try{const _0x33692e=_0x4b7dfc['shop'],_0x5da5bf=_0x33692e[_0x378884(0x105)];if(!_0x5da5bf?.['webhookUrl']){console[_0x378884(0x17b)](_0x378884(0x18e)+_0x33692e['id']);return;}const _0x123785=_0x57c5f3===_0x378884(0xff)?'payment.success':_0x57c5f3===_0x378884(0x164)?_0x378884(0x10a):_0x57c5f3===_0x378884(0x176)?_0x378884(0x10a):_0x378884(0x1b6);if(!_0x5da5bf[_0x378884(0x1b7)]?.['includes'](_0x123785)){console[_0x378884(0x17b)](_0x378884(0x1bb)+_0x123785+_0x378884(0x162)+_0x33692e['id']);return;}const _0x4dec7c=(0x0,gateway_1[_0x378884(0x169)])(_0x4b7dfc['gateway'])||_0x4b7dfc['gateway'],_0x59754a={'event':_0x123785,'payment':{'id':_0x4b7dfc['id'],'order_id':_0x4b7dfc[_0x378884(0x1c3)],'gateway_order_id':_0x4b7dfc['gatewayOrderId'],'gateway':_0x4dec7c,'amount':_0x4b7dfc[_0x378884(0x1dd)],'currency':_0x4b7dfc[_0x378884(0x1d4)],'status':_0x57c5f3['toLowerCase'](),'customer_email':_0x4b7dfc[_0x378884(0x1f0)],'customer_name':_0x4b7dfc[_0x378884(0x1c5)],'created_at':_0x4b7dfc[_0x378884(0x1f3)],'updated_at':new Date()}},_0x57e114=await fetch(_0x5da5bf[_0x378884(0xf5)],{'method':_0x378884(0x142),'headers':{'Content-Type':_0x378884(0x121),'User-Agent':_0x378884(0xfd)},'body':JSON[_0x378884(0x110)](_0x59754a)}),_0x43d0d4=Date[_0x378884(0xf1)]()-_0x53ae66,_0x3e1998=_0x57e114['ok']?'Success':await _0x57e114[_0x378884(0x1df)]();loggerService_1[_0x378884(0x163)][_0x378884(0x15f)](_0x4b7dfc[_0x378884(0x1ba)],_0x5da5bf[_0x378884(0xf5)],_0x123785,_0x57e114[_0x378884(0x139)],_0x43d0d4,_0x59754a),console[_0x378884(0x17b)](_0x378884(0x1f7)+_0x5da5bf[_0x378884(0xf5)]+_0x378884(0x1d5)+_0x57e114[_0x378884(0x139)]+'\x20('+_0x43d0d4+'ms)');}catch(_0x29f41a){console['error'](_0x378884(0x1b9),_0x29f41a),loggerService_1[_0x378884(0x163)][_0x378884(0x192)](_0x4b7dfc['shopId'],_0x4b7dfc[_0x378884(0x198)]?.['settings']?.[_0x378884(0xf5)]||'unknown',_0x378884(0x15d),_0x29f41a,{});}}async[a42_0x5d3cc0(0x101)](_0x395dcb,_0x5d27b2){const _0x3d6e7e=a42_0x5d3cc0;try{const _0x258ba6={'PENDING':_0x3d6e7e(0x141),'PAID':_0x3d6e7e(0x1e8),'FAILED':_0x3d6e7e(0x151),'EXPIRED':_0x3d6e7e(0x104)},_0x5cb209=_0x258ba6[_0x5d27b2];if(!_0x5cb209||_0x5cb209===_0x3d6e7e(0x141))return;await telegramBotService_1['telegramBotService']['sendPaymentNotification'](_0x395dcb[_0x3d6e7e(0x1ba)],_0x395dcb,_0x5cb209);}catch(_0x172908){console['error'](_0x3d6e7e(0x146),_0x172908);}}async[a42_0x5d3cc0(0xef)](_0x9fc700){const _0x98fdc0=a42_0x5d3cc0;console[_0x98fdc0(0x17b)](_0x98fdc0(0x1fa)+_0x9fc700);const _0x55844b=await database_1[_0x98fdc0(0x193)][_0x98fdc0(0x11d)][_0x98fdc0(0x11f)]({'where':{'id':_0x9fc700},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x55844b)throw new Error('Payment\x20not\x20found');if(_0x55844b[_0x98fdc0(0x1e1)]!==_0x98fdc0(0x14b)&&_0x55844b[_0x98fdc0(0x1e1)]!==_0x98fdc0(0x1be))throw new Error(_0x98fdc0(0x1d6));console[_0x98fdc0(0x17b)](_0x98fdc0(0x180)+_0x55844b[_0x98fdc0(0x1e1)]+_0x98fdc0(0x175)+_0x9fc700),await this[_0x98fdc0(0x1a5)](_0x55844b),console[_0x98fdc0(0x17b)](_0x98fdc0(0x140)+_0x9fc700);}[a42_0x5d3cc0(0x1ae)](){const _0x2bde7c=a42_0x5d3cc0,_0x53262d=this[_0x2bde7c(0x1ad)]?this[_0x2bde7c(0x13d)]:undefined,_0x1c052f=Array[_0x2bde7c(0x19d)](this[_0x2bde7c(0x1b0)]['values']())['map'](_0x30307a=>({'paymentId':_0x30307a[_0x2bde7c(0x1ab)],'gatewayPaymentId':_0x30307a['gatewayPaymentId'],'createdAt':_0x30307a['createdAt'],'timersCount':_0x30307a['timers'][_0x2bde7c(0x1ef)]}));return{'isActive':!!this['globalCheckInterval'],'globalCheckIntervalMinutes':this[_0x2bde7c(0x13d)]/(0x3e8*0x3c),'expiryDays':this['EXPIRY_DAYS'],'activeIndividualTimers':this[_0x2bde7c(0x1b0)]['size'],'nextGlobalCheckIn':_0x53262d,'paymentTimersDetails':_0x1c052f};}['getPaymentTimerInfo'](_0x2d67fe){const _0x4f7bad=a42_0x5d3cc0,_0x2c47e5=this[_0x4f7bad(0x1b0)][_0x4f7bad(0x174)](_0x2d67fe);if(_0x2c47e5)return{'hasTimers':!![],'timersCount':_0x2c47e5['timers'][_0x4f7bad(0x1ef)],'createdAt':_0x2c47e5[_0x4f7bad(0x1f3)],'gatewayPaymentId':_0x2c47e5['gatewayPaymentId']};return{'hasTimers':![]};}async[a42_0x5d3cc0(0x116)](_0x540c1c,_0xaa3e55){const _0x153187=a42_0x5d3cc0;try{const _0x535127=await database_1[_0x153187(0x193)]['shop'][_0x153187(0x11f)]({'where':{'id':_0x540c1c},'select':{'gatewaySettings':!![]}});if(!_0x535127?.['gatewaySettings'])return console[_0x153187(0x17b)](_0x153187(0x199)+_0x540c1c+_0x153187(0x15a)),0xa;const _0x45ad3e=JSON[_0x153187(0x137)](_0x535127[_0x153187(0x1e9)]);for(const [_0x4de31a,_0x35d091]of Object[_0x153187(0x13b)](_0x45ad3e)){if(_0x4de31a[_0x153187(0x179)]()===_0xaa3e55[_0x153187(0x179)]()){const _0x49bd70=_0x35d091['commission']||0xa;return console[_0x153187(0x17b)](_0x153187(0x1c8)+_0xaa3e55+'\x20commission\x20for\x20shop\x20'+_0x540c1c+':\x20'+_0x49bd70+'%'),_0x49bd70;}}return console[_0x153187(0x17b)]('No\x20specific\x20commission\x20found\x20for\x20gateway\x20'+_0xaa3e55+_0x153187(0x117)+_0x540c1c+_0x153187(0x1cb)),0xa;}catch(_0xed3c10){return console[_0x153187(0x13c)](_0x153187(0x127)+_0x540c1c+_0x153187(0x19a)+_0xaa3e55+':',_0xed3c10),0xa;}}}exports[a42_0x5d3cc0(0x157)]=CoinToPayStatusService,exports['coinToPayStatusService']=new CoinToPayStatusService();