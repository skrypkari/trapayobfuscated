'use strict';const a38_0x26d037=a38_0x2c42;(function(_0xa94a2d,_0x241212){const _0x1680b8=a38_0x2c42,_0xbbe29=_0xa94a2d();while(!![]){try{const _0x423a1c=-parseInt(_0x1680b8(0x15f))/0x1+parseInt(_0x1680b8(0x1b1))/0x2*(parseInt(_0x1680b8(0x171))/0x3)+parseInt(_0x1680b8(0x16c))/0x4+parseInt(_0x1680b8(0x161))/0x5*(parseInt(_0x1680b8(0x1a3))/0x6)+parseInt(_0x1680b8(0x128))/0x7+parseInt(_0x1680b8(0x21a))/0x8+-parseInt(_0x1680b8(0x13c))/0x9;if(_0x423a1c===_0x241212)break;else _0xbbe29['push'](_0xbbe29['shift']());}catch(_0x2e8a05){_0xbbe29['push'](_0xbbe29['shift']());}}}(a38_0x122e,0xa60e8));function a38_0x122e(){const _0x43b69f=['\x20has\x20no\x20gatewayPaymentId,\x20skipping','create','checkAllPendingPayments','\x20status\x20is\x20','1080708NPfhxN','transactionId','./gateways/coinToPay2Service',',\x20using\x20default\x2010%','iban','webhookEvents','checkSinglePayment','createdAt','\x20\x20\x20-\x20Gateway:\x20','confirmedOn','‚è∞\x20[GLOBAL]\x20Found\x20','logWhiteDomainError','\x20\x20\x20-\x20gatewayPaymentId:\x20','\x20commission:\x20','638kEgRDP','\x20is\x20valid\x20for\x20checking,\x20proceeding...','ü™ô\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','‚è∞\x20[GLOBAL]\x20Payment\x20','getGatewayCommission','getTime','üîç\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','coinToPay2Service','\x20\x20\x20üìù\x20Details:','checkPaymentStatus','\x20details:','h),\x20skipping\x20global\x20check','paidAt','timers','setDate','getGatewayIdByName','SINGLE','ü™ô\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','‚è∞\x20[DEBUG]\x20Scheduled\x20check\x20#',':\x20type=','PAID','../config/database','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','getDate','sendShopWebhook','\x20\x20\x20üìä\x20Status:\x20','‚ùå\x20[TIMER]\x20Failed\x20individual\x20check\x20#','\x20has\x20no\x20gatewayPaymentId','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','from','ü™ô\x20[DEBUG]\x20Creating\x20','coinToPayService','startPeriodicStatusCheck','CoinToPayStatusService','\x20to\x20','logCoinToPayStatus',',\x20using\x20default\x20commission\x2010%','logCoinToPayError','gateway',',\x20clearing\x20individual\x20timers','settings','logShopWebhookSent','toFixed','status','‚úÖ\x20[EXPIRY]\x20Payment\x20','\x20completed\x20for\x20payment\x20','globalCheckInterval','webhookLog','Shop\x20webhook\x20sent\x20to\x20','payment','\x20not\x20found\x20in\x20database','CoinToPayService','paymentDetails','size','üìà\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','Failed\x20to\x20mark\x20payment\x20as\x20expired','coinToPayStatusService','\x20\x20\x20Gateway\x20','toISOString','cointopay_auto_expired','\x20commission\x20for\x20shop\x20','paid','ü™ô\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','clearPaymentTimers','timestamp','set','checkSinglePaymentById','‚è∞\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','ü™ô\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','\x20\x20\x20-\x20Amount:\x20','schedulePaymentChecks','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','\x20amounts\x20calculated:','paymentTimers','\x20to\x20clear','findUnique','FAILED','toLowerCase','gatewayOrderId','description','values','sendPaymentStatusNotification','cointopay2','Unknown\x20error','customerEmail','./loggerService','__esModule','üìä\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','üìä\x20[CHECK]\x20Payment\x20','\x20status\x20changed\x20to\x20','message','cointopay_status_check_error','unknown','logShopWebhookError','\x20(age:\x20','default','\x20current\x20status:\x20','\x20\x20\x20-\x20ShopId:\x20','ü™ô\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','not\x20confirmed','cointopay','stopPeriodicStatusCheck','findMany','shop','10830272mFcWIH','üìä\x20[HOURLY]\x20Payment\x20','ms)','createdOn','üîç\x20[CHECK]\x20Checking\x20','\x20individual\x20payment\x20timers','\x20status:\x20','üßπ\x20[DEBUG]\x20Cleared\x20timer\x20#','paymentLink','üè¶\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes','‚úÖ\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','Gateway\x20','shopId','\x20USDT','push','../types/gateway','__importDefault','\x20not\x20enabled\x20for\x20shop\x20','\x20for\x20payment\x20','2\x20minutes',',\x20status=','COMPLETED','‚ùå\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','Payment\x20older\x20than\x20','webhookUrl','type','TesSoft\x20Payment\x20System/1.0','üìä\x20[CHECK]\x20CoinToPay\x20payment\x20','orderId','sendPaymentNotification','6636161BmRNVn','includes','\x20checked,\x20','delete','Automatically\x20expired\x20after\x20','ü™ô\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','payment.failed','commission','log','üîç\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','customerName','üõë\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','GLOBAL_CHECK_INTERVAL_MS','bankDetails','\x20\x20\x20Amount\x20after\x20commission:\x20','\x20\x20\x20üìç\x20Source:\x20','gatewayPaymentId','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','payment.pending','remitterIban','29515509VTOlnk','update','failed','üîÑ\x20[CHECK]\x20Updating\x20payment\x20','auto_expire','amountUSDT','forEach','currency','\x20marked\x20as\x20paid\x20at:\x20','length','expired','‚ùå\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','‚ùå\x20[CHECK]\x20Payment\x20','\x20initial\x20timers\x20for\x20payment\x20','Bank\x20Details:\x20','floor','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','1\x20minute','not\x20found','\x20expired\x20CoinToPay\x20payments','‚úÖ\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','getServiceStats','EXPIRY_DAYS','\x20\x20\x20-\x20Status:\x20','\x20is\x20older\x20than\x20','\x20days\x20without\x20payment\x20confirmation','‚ùå\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','ü™ô\x20[GLOBAL]\x20Found\x20','-day\x20timeout','ü™ô\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','payment.success','‚ùå\x20[HOURLY]\x20Payment\x20','amount','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','get','1034033rCucIC','\x20found:','35IrjUYQ',',\x20stopping\x20individual\x20checks','\x20->\x20','\x20\x20\x20üìù\x20Context:','\x20skipped,\x20','loggerService','/status/','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','currentPayments','created','paymentLinkId','491400LVHTSt','üßπ\x20[CHECK]\x20Payment\x20','adminNotes','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','Webhook\x20event\x20','12303bdiemN','map','Payment\x20not\x20found','currencyService','amountAfterGatewayCommissionUSDT','‚úÖ\x20[CHECK]\x20Payment\x20','üîç\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','text','ü™ô\x20[ERROR]\x20CoinToPay\x20Error:\x20','./telegramBotService','\x20\x20\x20-\x20GatewayPaymentId:\x20','getPaymentTimerInfo','.\x20Remaining\x20active\x20timers:\x20','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','üí∞\x20[CHECK]\x20Payment\x20','\x20with\x20status\x20','EXPIRED','parse','\x20days','entries','now','delay','üßπ\x20[DEBUG]\x20Clearing\x20','PENDING','‚è∞\x20[EXPIRY]\x20Payment\x20','\x20days,\x20marking\x20as\x20EXPIRED','\x20payment\x20','\x20days\x20(created\x20before\x20',',\x20gateway\x20','checkPaymentById','error','checkExpiredPayments','status_check','telegramBotService','‚ùå\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','has','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','‚ö†Ô∏è\x20[CHECK]\x20Payment\x20','üìà\x20[COINTOPAY]\x20Payment\x20','‚úÖ\x20[DEBUG]\x20Successfully\x20scheduled\x20','\x20\x20\x20Amount:\x20','5\x20minutes','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','stringify'];a38_0x122e=function(){return _0x43b69f;};return a38_0x122e();}function a38_0x2c42(_0x20b11d,_0x4ac6e8){const _0x122e72=a38_0x122e();return a38_0x2c42=function(_0x2c42bb,_0x2c47ea){_0x2c42bb=_0x2c42bb-0x128;let _0x1bf985=_0x122e72[_0x2c42bb];return _0x1bf985;},a38_0x2c42(_0x20b11d,_0x4ac6e8);}var __importDefault=this&&this[a38_0x26d037(0x22a)]||function(_0x520198){const _0x5f291a=a38_0x26d037;return _0x520198&&_0x520198[_0x5f291a(0x208)]?_0x520198:{'default':_0x520198};};Object['defineProperty'](exports,a38_0x26d037(0x208),{'value':!![]}),exports[a38_0x26d037(0x1ea)]=exports[a38_0x26d037(0x1d2)]=void 0x0;const coinToPayService_1=require('./gateways/coinToPayService'),coinToPay2Service_1=require(a38_0x26d037(0x1a5)),gateway_1=require(a38_0x26d037(0x229)),database_1=__importDefault(require(a38_0x26d037(0x1c6))),telegramBotService_1=require(a38_0x26d037(0x17b)),loggerService_1=require(a38_0x26d037(0x207)),currencyService_1=require('./currencyService');class CoinToPayStatusService{constructor(){const _0x3f8ab5=a38_0x26d037;this[_0x3f8ab5(0x1df)]=null,this['GLOBAL_CHECK_INTERVAL_MS']=0x3c*0x3c*0x3e8,this[_0x3f8ab5(0x152)]=0x5,this[_0x3f8ab5(0x1fb)]=new Map(),this[_0x3f8ab5(0x1d0)]=new coinToPayService_1[(_0x3f8ab5(0x1e4))](),this[_0x3f8ab5(0x1b8)]=new coinToPay2Service_1['CoinToPay2Service'](),console[_0x3f8ab5(0x130)](_0x3f8ab5(0x1f6));}[a38_0x26d037(0x1f8)](_0x43d79e,_0x5781ca){const _0x1df3bf=a38_0x26d037;console[_0x1df3bf(0x130)](_0x1df3bf(0x214)),console[_0x1df3bf(0x130)]('\x20\x20\x20-\x20paymentId:\x20'+_0x43d79e),console['log'](_0x1df3bf(0x1af)+_0x5781ca),this[_0x1df3bf(0x1f1)](_0x43d79e);const _0x2780b6=[],_0x1ff769=new Date(),_0x5a3f4a=[{'delay':0x1*0x3c*0x3e8,'description':_0x1df3bf(0x14d)},{'delay':0x2*0x3c*0x3e8,'description':_0x1df3bf(0x22d)},{'delay':0x5*0x3c*0x3e8,'description':_0x1df3bf(0x19b)},{'delay':0x5*0x3c*0x3e8,'description':_0x1df3bf(0x19b)}];console['log'](_0x1df3bf(0x1cf)+_0x5a3f4a[_0x1df3bf(0x145)]+_0x1df3bf(0x149)+_0x43d79e);let _0x67652f=0x0;_0x5a3f4a[_0x1df3bf(0x142)]((_0x2e7240,_0x479db7)=>{const _0x535eb8=_0x1df3bf;_0x67652f+=_0x2e7240[_0x535eb8(0x187)];const _0x233d4b=setTimeout(async()=>{const _0x2c90e3=_0x535eb8;console['log']('ü™ô\x20[TIMER]\x20Individual\x20check\x20#'+(_0x479db7+0x1)+'\x20triggered\x20for\x20payment\x20'+_0x43d79e+'\x20(after\x20'+_0x2e7240['description']+')');try{await this['checkSinglePaymentById'](_0x43d79e),console[_0x2c90e3(0x130)]('‚úÖ\x20[TIMER]\x20Individual\x20check\x20#'+(_0x479db7+0x1)+_0x2c90e3(0x1de)+_0x43d79e);}catch(_0x3fd6e2){console[_0x2c90e3(0x190)](_0x2c90e3(0x1cb)+(_0x479db7+0x1)+_0x2c90e3(0x22c)+_0x43d79e+':',_0x3fd6e2),this[_0x2c90e3(0x1d6)](_0x43d79e,_0x5781ca,_0x3fd6e2,_0x2c90e3(0x192),{'checkNumber':_0x479db7+0x1,'scheduledAfter':_0x2e7240[_0x2c90e3(0x201)],'isIndividualCheck':!![]});}},_0x67652f);_0x2780b6[_0x535eb8(0x228)](_0x233d4b),console[_0x535eb8(0x130)](_0x535eb8(0x1c3)+(_0x479db7+0x1)+_0x535eb8(0x22c)+_0x43d79e+'\x20in\x20'+_0x67652f/0x3e8+'\x20seconds\x20('+_0x2e7240[_0x535eb8(0x201)]+')');});const _0x25a58c=setInterval(async()=>{const _0x5d0365=_0x1df3bf;console[_0x5d0365(0x130)](_0x5d0365(0x12d)+_0x43d79e);try{const _0x11463d=await database_1[_0x5d0365(0x211)]['payment']['findUnique']({'where':{'id':_0x43d79e},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x11463d){console['log'](_0x5d0365(0x15b)+_0x43d79e+'\x20not\x20found,\x20clearing\x20timers'),this[_0x5d0365(0x1f1)](_0x43d79e);return;}console[_0x5d0365(0x130)](_0x5d0365(0x21b)+_0x43d79e+_0x5d0365(0x212)+_0x11463d[_0x5d0365(0x1dc)]);if(_0x11463d[_0x5d0365(0x1dc)]!==_0x5d0365(0x189)){console[_0x5d0365(0x130)]('‚úÖ\x20[HOURLY]\x20Payment\x20'+_0x43d79e+_0x5d0365(0x1a2)+_0x11463d[_0x5d0365(0x1dc)]+_0x5d0365(0x162)),this[_0x5d0365(0x1f1)](_0x43d79e);return;}const _0xa13b77=Math[_0x5d0365(0x14b)]((Date['now']()-_0x11463d[_0x5d0365(0x1aa)]['getTime']())/(0x3e8*0x3c*0x3c*0x18));if(_0xa13b77>=this[_0x5d0365(0x152)]){console[_0x5d0365(0x130)]('‚è∞\x20[HOURLY]\x20Payment\x20'+_0x43d79e+_0x5d0365(0x154)+this['EXPIRY_DAYS']+'\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check'),this[_0x5d0365(0x1f1)](_0x43d79e);return;}await this[_0x5d0365(0x1f4)](_0x43d79e),console[_0x5d0365(0x130)]('‚úÖ\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20'+_0x43d79e);}catch(_0x45ba1b){console[_0x5d0365(0x190)](_0x5d0365(0x230)+_0x43d79e+':',_0x45ba1b),this[_0x5d0365(0x1d6)](_0x43d79e,_0x5781ca,_0x45ba1b,'status_check',{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x2780b6[_0x1df3bf(0x228)](_0x25a58c),this[_0x1df3bf(0x1fb)][_0x1df3bf(0x1f3)](_0x43d79e,{'timers':_0x2780b6,'paymentId':_0x43d79e,'gatewayPaymentId':_0x5781ca,'createdAt':_0x1ff769}),console[_0x1df3bf(0x130)](_0x1df3bf(0x199)+_0x5a3f4a['length']+_0x1df3bf(0x1f9)+_0x43d79e),console[_0x1df3bf(0x130)](_0x1df3bf(0x209)+this[_0x1df3bf(0x1fb)][_0x1df3bf(0x1e6)]),this[_0x1df3bf(0x1d4)](_0x43d79e,_0x5781ca,'PENDING',_0x1df3bf(0x189),_0x1df3bf(0x192),{'action':'schedule_created','scheduledChecks':_0x5a3f4a['length'],'firstCheckIn':_0x5a3f4a[0x0][_0x1df3bf(0x187)]/0x3e8,'totalTimers':this[_0x1df3bf(0x1fb)][_0x1df3bf(0x1e6)]});}[a38_0x26d037(0x1f1)](_0x202126){const _0x49919f=a38_0x26d037,_0x54ab08=this[_0x49919f(0x1fb)][_0x49919f(0x15e)](_0x202126);_0x54ab08?(console[_0x49919f(0x130)](_0x49919f(0x188)+_0x54ab08[_0x49919f(0x1be)][_0x49919f(0x145)]+'\x20timers\x20for\x20payment\x20'+_0x202126),_0x54ab08[_0x49919f(0x1be)][_0x49919f(0x142)]((_0x17056f,_0x3b5dd3)=>{const _0x25dfa2=_0x49919f;_0x17056f&&(clearTimeout(_0x17056f),clearInterval(_0x17056f),console[_0x25dfa2(0x130)](_0x25dfa2(0x221)+(_0x3b5dd3+0x1)+_0x25dfa2(0x22c)+_0x202126));}),this[_0x49919f(0x1fb)][_0x49919f(0x12b)](_0x202126),console['log']('‚úÖ\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20'+_0x202126+_0x49919f(0x17e)+this[_0x49919f(0x1fb)][_0x49919f(0x1e6)])):console[_0x49919f(0x130)]('‚ö†Ô∏è\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20'+_0x202126+_0x49919f(0x1fc));}async[a38_0x26d037(0x1f4)](_0x442907){const _0x495b37=a38_0x26d037;console[_0x495b37(0x130)](_0x495b37(0x177)+_0x442907);const _0x3ec2c4=await database_1['default'][_0x495b37(0x1e2)]['findUnique']({'where':{'id':_0x442907},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x3ec2c4){console[_0x495b37(0x130)](_0x495b37(0x148)+_0x442907+_0x495b37(0x1e3));return;}console[_0x495b37(0x130)]('üìä\x20[CHECK]\x20Payment\x20'+_0x442907+_0x495b37(0x160)),console[_0x495b37(0x130)](_0x495b37(0x1ab)+_0x3ec2c4[_0x495b37(0x1d7)]),console[_0x495b37(0x130)](_0x495b37(0x153)+_0x3ec2c4[_0x495b37(0x1dc)]),console['log'](_0x495b37(0x17c)+_0x3ec2c4['gatewayPaymentId']),console[_0x495b37(0x130)](_0x495b37(0x1f7)+_0x3ec2c4[_0x495b37(0x15c)]+'\x20'+_0x3ec2c4[_0x495b37(0x143)]),console[_0x495b37(0x130)](_0x495b37(0x213)+_0x3ec2c4[_0x495b37(0x226)]);if(_0x3ec2c4['gateway']!=='cointopay'&&_0x3ec2c4[_0x495b37(0x1d7)]!==_0x495b37(0x204)){console[_0x495b37(0x130)]('‚ö†Ô∏è\x20[CHECK]\x20Payment\x20'+_0x442907+_0x495b37(0x178)+_0x3ec2c4['gateway']+')');return;}if(_0x3ec2c4['status']!==_0x495b37(0x189)){console['log'](_0x495b37(0x197)+_0x442907+_0x495b37(0x1a2)+_0x3ec2c4[_0x495b37(0x1dc)]+_0x495b37(0x162)),this['clearPaymentTimers'](_0x442907);return;}if(!_0x3ec2c4[_0x495b37(0x138)]){console['log']('‚ö†Ô∏è\x20[CHECK]\x20Payment\x20'+_0x442907+_0x495b37(0x1cc));return;}console[_0x495b37(0x130)](_0x495b37(0x176)+_0x442907+_0x495b37(0x1b2)),await this['checkSinglePayment'](_0x3ec2c4);}[a38_0x26d037(0x1d4)](_0x527e34,_0x3e61d5,_0x5833f0,_0x198feb,_0x1bedba,_0xa2b874){const _0x53ad9b=a38_0x26d037,_0x4805a0={'type':'COINTOPAY_STATUS_CHANGE','paymentId':_0x527e34,'gatewayPaymentId':_0x3e61d5,'oldStatus':_0x5833f0,'newStatus':_0x198feb,'source':_0x1bedba,'timestamp':new Date()[_0x53ad9b(0x1ec)](),'details':_0xa2b874||{}};loggerService_1[_0x53ad9b(0x166)][_0x53ad9b(0x1d4)](_0x4805a0),console[_0x53ad9b(0x130)]('ü™ô\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20'+_0x527e34+'\x20('+_0x3e61d5+')'),console[_0x53ad9b(0x130)](_0x53ad9b(0x1ca)+_0x5833f0+_0x53ad9b(0x163)+_0x198feb),console[_0x53ad9b(0x130)](_0x53ad9b(0x137)+_0x1bedba),console[_0x53ad9b(0x130)]('\x20\x20\x20üìÖ\x20Time:\x20'+_0x4805a0[_0x53ad9b(0x1f2)]),_0xa2b874&&console[_0x53ad9b(0x130)](_0x53ad9b(0x1b9),_0xa2b874);}[a38_0x26d037(0x1d6)](_0x7be471,_0x9f83e7,_0x577b79,_0x462cd1,_0x557add){const _0x4502bb=a38_0x26d037,_0x262c1f={'type':'COINTOPAY_ERROR','paymentId':_0x7be471,'gatewayPaymentId':_0x9f83e7,'error':_0x577b79 instanceof Error?{'message':_0x577b79[_0x4502bb(0x20c)],'stack':_0x577b79['stack']}:_0x577b79,'source':_0x462cd1,'timestamp':new Date()['toISOString'](),'context':_0x557add||{}};loggerService_1[_0x4502bb(0x166)]['logCoinToPayError'](_0x262c1f),console[_0x4502bb(0x190)](_0x4502bb(0x17a)+_0x7be471+'\x20('+_0x9f83e7+')'),console[_0x4502bb(0x190)]('\x20\x20\x20‚ùå\x20Error:\x20'+(_0x577b79 instanceof Error?_0x577b79['message']:_0x577b79)),console[_0x4502bb(0x190)]('\x20\x20\x20üìç\x20Source:\x20'+_0x462cd1),console[_0x4502bb(0x190)]('\x20\x20\x20üìÖ\x20Time:\x20'+_0x262c1f['timestamp']),_0x557add&&console[_0x4502bb(0x190)](_0x4502bb(0x164),_0x557add);}[a38_0x26d037(0x1d1)](){const _0x359d48=a38_0x26d037;console['log'](_0x359d48(0x1c2)),this[_0x359d48(0x1a1)]()['catch'](_0x4f47e5=>{console['error']('‚ùå\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:',_0x4f47e5);}),this[_0x359d48(0x1df)]=setInterval(async()=>{const _0x185efe=_0x359d48;try{console['log'](_0x185efe(0x159)),await this[_0x185efe(0x1a1)](),console[_0x185efe(0x130)](_0x185efe(0x19c));}catch(_0x50ad92){console[_0x185efe(0x190)]('‚ùå\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:',_0x50ad92);}},this[_0x359d48(0x134)]),console[_0x359d48(0x130)]('‚úÖ\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)');}[a38_0x26d037(0x217)](){const _0x360557=a38_0x26d037;console[_0x360557(0x130)]('üõë\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...');this['globalCheckInterval']&&(clearInterval(this[_0x360557(0x1df)]),this[_0x360557(0x1df)]=null,console[_0x360557(0x130)](_0x360557(0x133)));const _0x2d05bc=this[_0x360557(0x1fb)][_0x360557(0x1e6)];for(const [_0x5ee035]of this['paymentTimers']){this[_0x360557(0x1f1)](_0x5ee035);}console[_0x360557(0x130)]('üõë\x20[SHUTDOWN]\x20Cleared\x20'+_0x2d05bc+_0x360557(0x21f));}async['checkAllPendingPayments'](){const _0x54ecb9=a38_0x26d037;try{console['log'](_0x54ecb9(0x1f0));const _0x42f407=await database_1[_0x54ecb9(0x211)][_0x54ecb9(0x1e2)][_0x54ecb9(0x218)]({'where':{'gateway':{'in':[_0x54ecb9(0x216),_0x54ecb9(0x204)]},'status':_0x54ecb9(0x189),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console['log'](_0x54ecb9(0x157)+_0x42f407['length']+'\x20pending\x20CoinToPay\x20payments');if(_0x42f407['length']===0x0){console[_0x54ecb9(0x130)](_0x54ecb9(0x1b3));return;}const _0x1a3753=await this[_0x54ecb9(0x191)](_0x42f407);console[_0x54ecb9(0x130)](_0x54ecb9(0x1ad)+_0x1a3753[_0x54ecb9(0x145)]+_0x54ecb9(0x14f));let _0x2a74b2=0x0,_0x56ee12=0x0;for(const _0x2a7505 of _0x42f407){try{if(_0x1a3753[_0x54ecb9(0x129)](_0x2a7505['id'])){console[_0x54ecb9(0x130)](_0x54ecb9(0x1b4)+_0x2a7505['id']+'\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check'),_0x56ee12++;continue;}if(this['paymentTimers'][_0x54ecb9(0x195)](_0x2a7505['id'])){console['log'](_0x54ecb9(0x1b4)+_0x2a7505['id']+_0x54ecb9(0x196)),_0x56ee12++;continue;}const _0x24f3c7=(Date[_0x54ecb9(0x186)]()-_0x2a7505['createdAt'][_0x54ecb9(0x1b6)]())/(0x3e8*0x3c*0x3c);if(_0x24f3c7<0x1){console[_0x54ecb9(0x130)](_0x54ecb9(0x1b4)+_0x2a7505['id']+'\x20is\x20too\x20new\x20('+_0x24f3c7[_0x54ecb9(0x1db)](0x1)+_0x54ecb9(0x1bc)),_0x56ee12++;continue;}console[_0x54ecb9(0x130)](_0x54ecb9(0x131)+_0x2a7505['id']+_0x54ecb9(0x210)+_0x24f3c7['toFixed'](0x1)+'h)'),await this[_0x54ecb9(0x1a9)](_0x2a7505),_0x2a74b2++,await new Promise(_0x3836de=>setTimeout(_0x3836de,0x7d0));}catch(_0xbb52a8){console[_0x54ecb9(0x190)](_0x54ecb9(0x1cd)+_0x2a7505['id']+':',_0xbb52a8),this[_0x54ecb9(0x1d6)](_0x2a7505['id'],_0x2a7505['gatewayPaymentId']||_0x54ecb9(0x20e),_0xbb52a8,_0x54ecb9(0x192),{'isGlobalCheck':!![],'paymentAmount':_0x2a7505[_0x54ecb9(0x15c)],'paymentCurrency':_0x2a7505[_0x54ecb9(0x143)],'shopId':_0x2a7505[_0x54ecb9(0x226)],'createdAt':_0x2a7505[_0x54ecb9(0x1aa)]}),loggerService_1[_0x54ecb9(0x166)][_0x54ecb9(0x1ae)](_0x54ecb9(0x216),_0x54ecb9(0x167)+_0x2a7505[_0x54ecb9(0x138)],_0xbb52a8);}}console[_0x54ecb9(0x130)](_0x54ecb9(0x1c7)+_0x2a74b2+_0x54ecb9(0x12a)+_0x56ee12+_0x54ecb9(0x165)+_0x1a3753['length']+'\x20expired');}catch(_0x2f6325){console[_0x54ecb9(0x190)](_0x54ecb9(0x14c),_0x2f6325);}}async[a38_0x26d037(0x191)](_0x45fafe){const _0x19ff41=a38_0x26d037,_0xf7f8be=[],_0xb2dfc0=new Date();_0xb2dfc0[_0x19ff41(0x1bf)](_0xb2dfc0[_0x19ff41(0x1c8)]()-this[_0x19ff41(0x152)]),console[_0x19ff41(0x130)](_0x19ff41(0x1f5)+this[_0x19ff41(0x152)]+_0x19ff41(0x18d)+_0xb2dfc0[_0x19ff41(0x1ec)]()+')');for(const _0x18fe4d of _0x45fafe){if(_0x18fe4d['createdAt']<_0xb2dfc0){console[_0x19ff41(0x130)](_0x19ff41(0x18a)+_0x18fe4d['id']+_0x19ff41(0x154)+this['EXPIRY_DAYS']+_0x19ff41(0x18b));try{this[_0x19ff41(0x1d4)](_0x18fe4d['id'],_0x18fe4d[_0x19ff41(0x138)]||_0x19ff41(0x20e),_0x19ff41(0x189),_0x19ff41(0x182),'auto_expire',{'reason':_0x19ff41(0x231)+this[_0x19ff41(0x152)]+_0x19ff41(0x184),'createdAt':_0x18fe4d[_0x19ff41(0x1aa)],'daysSinceCreation':Math['floor']((Date[_0x19ff41(0x186)]()-_0x18fe4d['createdAt'][_0x19ff41(0x1b6)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x18fe4d[_0x19ff41(0x15c)],'paymentCurrency':_0x18fe4d[_0x19ff41(0x143)],'shopId':_0x18fe4d[_0x19ff41(0x226)]}),await database_1[_0x19ff41(0x211)][_0x19ff41(0x1e2)][_0x19ff41(0x13d)]({'where':{'id':_0x18fe4d['id']},'data':{'status':_0x19ff41(0x182),'updatedAt':new Date(),'adminNotes':_0x19ff41(0x12c)+this[_0x19ff41(0x152)]+_0x19ff41(0x155)}}),await database_1[_0x19ff41(0x211)][_0x19ff41(0x1e0)]['create']({'data':{'paymentId':_0x18fe4d['id'],'shopId':_0x18fe4d[_0x19ff41(0x226)],'event':_0x19ff41(0x1ed),'statusCode':0xc8,'responseBody':JSON[_0x19ff41(0x19e)]({'reason':'Payment\x20older\x20than\x20'+this[_0x19ff41(0x152)]+_0x19ff41(0x184),'createdAt':_0x18fe4d[_0x19ff41(0x1aa)],'expiredAt':new Date()['toISOString'](),'daysSinceCreation':Math['floor']((Date[_0x19ff41(0x186)]()-_0x18fe4d[_0x19ff41(0x1aa)][_0x19ff41(0x1b6)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x19ff41(0x1c9)](_0x18fe4d,_0x19ff41(0x182)),await this[_0x19ff41(0x203)](_0x18fe4d,_0x19ff41(0x182)),this['clearPaymentTimers'](_0x18fe4d['id']),_0xf7f8be[_0x19ff41(0x228)](_0x18fe4d['id']),console['log'](_0x19ff41(0x1dd)+_0x18fe4d['id']+_0x19ff41(0x168)+this[_0x19ff41(0x152)]+_0x19ff41(0x158));}catch(_0x196010){console[_0x19ff41(0x190)](_0x19ff41(0x156)+_0x18fe4d['id']+':',_0x196010),this[_0x19ff41(0x1d6)](_0x18fe4d['id'],_0x18fe4d[_0x19ff41(0x138)]||_0x19ff41(0x20e),_0x196010,_0x19ff41(0x140),{'reason':_0x19ff41(0x1e9),'createdAt':_0x18fe4d['createdAt'],'daysSinceCreation':Math['floor']((Date[_0x19ff41(0x186)]()-_0x18fe4d[_0x19ff41(0x1aa)]['getTime']())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0xf7f8be;}async[a38_0x26d037(0x1a9)](_0x454e29){const _0x1adb43=a38_0x26d037;if(!_0x454e29[_0x1adb43(0x138)]){console[_0x1adb43(0x130)](_0x1adb43(0x197)+_0x454e29['id']+_0x1adb43(0x19f));return;}console[_0x1adb43(0x130)](_0x1adb43(0x21e)+_0x454e29[_0x1adb43(0x1d7)]+_0x1adb43(0x18c)+_0x454e29['id']+'\x20('+_0x454e29['gatewayPaymentId']+')');try{let _0x25a35d;_0x454e29[_0x1adb43(0x1d7)]==='cointopay2'?(_0x25a35d=await this['coinToPay2Service'][_0x1adb43(0x1ba)](_0x454e29['gatewayPaymentId']),console['log']('üìä\x20[CHECK]\x20CoinToPay2\x20payment\x20'+_0x454e29['id']+_0x1adb43(0x220)+_0x25a35d['status'])):(_0x25a35d=await this[_0x1adb43(0x1d0)][_0x1adb43(0x1ba)](_0x454e29[_0x1adb43(0x138)]),console[_0x1adb43(0x130)](_0x1adb43(0x235)+_0x454e29['id']+_0x1adb43(0x220)+_0x25a35d[_0x1adb43(0x1dc)]));_0x25a35d[_0x1adb43(0x1e5)]&&console['log']('üìä\x20[CHECK]\x20Payment\x20'+_0x454e29['id']+_0x1adb43(0x1bb),{'iban':_0x25a35d['paymentDetails']['iban']||_0x1adb43(0x14e),'transactionId':_0x25a35d['paymentDetails'][_0x1adb43(0x1a4)],'createdOn':_0x25a35d[_0x1adb43(0x1e5)][_0x1adb43(0x21d)],'confirmedOn':_0x25a35d[_0x1adb43(0x1e5)]['confirmedOn']||_0x1adb43(0x215)});if(_0x25a35d[_0x1adb43(0x1dc)]!==_0x454e29[_0x1adb43(0x1dc)]){console[_0x1adb43(0x130)](_0x1adb43(0x13f)+_0x454e29['id']+'\x20status\x20from\x20'+_0x454e29[_0x1adb43(0x1dc)]+_0x1adb43(0x1d3)+_0x25a35d[_0x1adb43(0x1dc)]),this['logCoinToPayStatus'](_0x454e29['id'],_0x454e29[_0x1adb43(0x138)],_0x454e29[_0x1adb43(0x1dc)],_0x25a35d[_0x1adb43(0x1dc)],_0x1adb43(0x192),{'paymentDetails':_0x25a35d[_0x1adb43(0x1e5)],'amount':_0x25a35d[_0x1adb43(0x15c)],'currency':_0x25a35d[_0x1adb43(0x143)],'shopId':_0x454e29[_0x1adb43(0x226)],'checkTimestamp':new Date()[_0x1adb43(0x1ec)]()});const _0x280db4={'status':_0x25a35d[_0x1adb43(0x1dc)],'updatedAt':new Date()};if(_0x25a35d[_0x1adb43(0x1dc)]===_0x1adb43(0x1c5)&&_0x454e29['status']!==_0x1adb43(0x1c5)){_0x280db4['paidAt']=new Date();if(!_0x454e29[_0x1adb43(0x141)]){const _0x2d75d7=await currencyService_1[_0x1adb43(0x174)]['convertToUSDT'](_0x454e29['amount'],_0x454e29[_0x1adb43(0x143)]);_0x280db4[_0x1adb43(0x141)]=_0x2d75d7;const _0x4c42ad=await this[_0x1adb43(0x1b5)](_0x454e29[_0x1adb43(0x226)],_0x454e29[_0x1adb43(0x1d7)]),_0x382c4f=_0x2d75d7*(0x1-_0x4c42ad/0x64);_0x280db4[_0x1adb43(0x175)]=_0x382c4f,console['log'](_0x1adb43(0x180)+_0x454e29['id']+_0x1adb43(0x1fa)),console[_0x1adb43(0x130)](_0x1adb43(0x19a)+_0x454e29[_0x1adb43(0x15c)]+'\x20'+_0x454e29[_0x1adb43(0x143)]+_0x1adb43(0x163)+_0x2d75d7['toFixed'](0x6)+_0x1adb43(0x227)),console[_0x1adb43(0x130)](_0x1adb43(0x1eb)+_0x454e29['gateway']+_0x1adb43(0x1b0)+_0x4c42ad+'%'),console[_0x1adb43(0x130)](_0x1adb43(0x136)+_0x382c4f[_0x1adb43(0x1db)](0x6)+'\x20USDT');}console[_0x1adb43(0x130)](_0x1adb43(0x180)+_0x454e29['id']+_0x1adb43(0x144)+_0x280db4[_0x1adb43(0x1bd)][_0x1adb43(0x1ec)]());}if(_0x25a35d[_0x1adb43(0x1e5)]){const _0x9cac84=_0x25a35d[_0x1adb43(0x1e5)];_0x9cac84['iban']&&(_0x280db4[_0x1adb43(0x13b)]=_0x9cac84[_0x1adb43(0x1a7)],console[_0x1adb43(0x130)]('üè¶\x20[CHECK]\x20Saved\x20IBAN:\x20'+_0x9cac84['iban']));if(_0x9cac84[_0x1adb43(0x135)]){const _0x3a0248=_0x454e29[_0x1adb43(0x16e)]||'',_0x2f6355=_0x1adb43(0x14a)+_0x9cac84[_0x1adb43(0x135)];_0x280db4[_0x1adb43(0x16e)]=_0x3a0248?_0x3a0248+'\x0a\x0a'+_0x2f6355:_0x2f6355,console[_0x1adb43(0x130)](_0x1adb43(0x223));}_0x9cac84[_0x1adb43(0x1a4)]&&console[_0x1adb43(0x130)]('üÜî\x20[CHECK]\x20Transaction\x20ID:\x20'+_0x9cac84['transactionId']),_0x9cac84[_0x1adb43(0x1ac)]&&console[_0x1adb43(0x130)](_0x1adb43(0x150)+_0x9cac84[_0x1adb43(0x1ac)]);}await database_1[_0x1adb43(0x211)][_0x1adb43(0x1e2)][_0x1adb43(0x13d)]({'where':{'id':_0x454e29['id']},'data':_0x280db4});if(_0x25a35d['status']===_0x1adb43(0x1c5)&&_0x454e29[_0x1adb43(0x1dc)]!==_0x1adb43(0x1c5)){console[_0x1adb43(0x130)](_0x1adb43(0x198)+_0x454e29['id']+_0x1adb43(0x17f));const _0x19d46c=await database_1['default'][_0x1adb43(0x1e2)]['findUnique']({'where':{'id':_0x454e29['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x19d46c?.[_0x1adb43(0x16b)]&&_0x19d46c['paymentLink'])try{const _0x97c962=_0x19d46c[_0x1adb43(0x222)];console[_0x1adb43(0x130)](_0x1adb43(0x1e7)+_0x97c962['id']+_0x1adb43(0x1c4)+_0x97c962[_0x1adb43(0x233)]+',\x20currentPayments='+_0x97c962[_0x1adb43(0x169)]+_0x1adb43(0x22e)+_0x97c962[_0x1adb43(0x1dc)]);const _0x55f88c=_0x97c962[_0x1adb43(0x169)]+0x1,_0x8bebc3=_0x97c962[_0x1adb43(0x233)]===_0x1adb43(0x1c1)?_0x1adb43(0x22f):_0x97c962['status'];await database_1[_0x1adb43(0x211)][_0x1adb43(0x222)][_0x1adb43(0x13d)]({'where':{'id':_0x97c962['id']},'data':{'currentPayments':_0x55f88c,'status':_0x8bebc3,'updatedAt':new Date()}}),console[_0x1adb43(0x130)]('‚úÖ\x20[COINTOPAY]\x20Payment\x20link\x20'+_0x97c962['id']+'\x20updated:\x20currentPayments='+_0x97c962['currentPayments']+'\x20->\x20'+_0x55f88c+_0x1adb43(0x22e)+_0x97c962[_0x1adb43(0x1dc)]+_0x1adb43(0x163)+_0x8bebc3);}catch(_0x516a8a){console[_0x1adb43(0x190)](_0x1adb43(0x194),_0x516a8a);}else console['log'](_0x1adb43(0x198)+_0x454e29['id']+_0x1adb43(0x139));}await database_1[_0x1adb43(0x211)][_0x1adb43(0x1e0)][_0x1adb43(0x1a0)]({'data':{'paymentId':_0x454e29['id'],'shopId':_0x454e29[_0x1adb43(0x226)],'event':'cointopay_status_check_'+_0x25a35d[_0x1adb43(0x1dc)]['toLowerCase'](),'statusCode':0xc8,'responseBody':JSON['stringify']({'oldStatus':_0x454e29[_0x1adb43(0x1dc)],'newStatus':_0x25a35d[_0x1adb43(0x1dc)],'paymentDetails':_0x25a35d[_0x1adb43(0x1e5)],'checkedAt':new Date()[_0x1adb43(0x1ec)]()})}}),await this[_0x1adb43(0x1c9)](_0x454e29,_0x25a35d[_0x1adb43(0x1dc)]),await this['sendPaymentStatusNotification'](_0x454e29,_0x25a35d[_0x1adb43(0x1dc)]),_0x25a35d[_0x1adb43(0x1dc)]!=='PENDING'&&(console[_0x1adb43(0x130)](_0x1adb43(0x16d)+_0x454e29['id']+_0x1adb43(0x20b)+_0x25a35d['status']+_0x1adb43(0x1d8)),this[_0x1adb43(0x1f1)](_0x454e29['id'])),console[_0x1adb43(0x130)](_0x1adb43(0x176)+_0x454e29['id']+'\x20updated\x20successfully');}else console['log'](_0x1adb43(0x20a)+_0x454e29['id']+'\x20status\x20unchanged\x20('+_0x25a35d['status']+')'),this[_0x1adb43(0x1d4)](_0x454e29['id'],_0x454e29[_0x1adb43(0x138)],_0x454e29[_0x1adb43(0x1dc)],_0x25a35d[_0x1adb43(0x1dc)],_0x1adb43(0x192),{'statusUnchanged':!![],'paymentDetails':_0x25a35d['paymentDetails'],'amount':_0x25a35d[_0x1adb43(0x15c)],'currency':_0x25a35d[_0x1adb43(0x143)],'shopId':_0x454e29['shopId'],'checkTimestamp':new Date()['toISOString']()});}catch(_0x4c5948){console[_0x1adb43(0x190)](_0x1adb43(0x147)+_0x454e29['id']+':',_0x4c5948),this[_0x1adb43(0x1d6)](_0x454e29['id'],_0x454e29[_0x1adb43(0x138)],_0x4c5948,_0x1adb43(0x192),{'paymentAmount':_0x454e29['amount'],'paymentCurrency':_0x454e29[_0x1adb43(0x143)],'shopId':_0x454e29['shopId'],'createdAt':_0x454e29[_0x1adb43(0x1aa)]}),await database_1[_0x1adb43(0x211)][_0x1adb43(0x1e0)]['create']({'data':{'paymentId':_0x454e29['id'],'shopId':_0x454e29[_0x1adb43(0x226)],'event':_0x1adb43(0x20d),'statusCode':0x1f4,'responseBody':JSON[_0x1adb43(0x19e)]({'error':_0x4c5948 instanceof Error?_0x4c5948[_0x1adb43(0x20c)]:_0x1adb43(0x205),'gatewayPaymentId':_0x454e29['gatewayPaymentId'],'checkedAt':new Date()[_0x1adb43(0x1ec)]()})}});}}async[a38_0x26d037(0x1c9)](_0x359df5,_0x3a90f2){const _0x106830=a38_0x26d037,_0xebd9a9=Date['now']();try{const _0x539927=_0x359df5[_0x106830(0x219)],_0x3f44cc=_0x539927[_0x106830(0x1d9)];if(!_0x3f44cc?.[_0x106830(0x232)]){console[_0x106830(0x130)](_0x106830(0x16f)+_0x539927['id']);return;}const _0x4bbec6=_0x3a90f2===_0x106830(0x1c5)?_0x106830(0x15a):_0x3a90f2===_0x106830(0x1fe)?_0x106830(0x12e):_0x3a90f2===_0x106830(0x182)?_0x106830(0x12e):_0x106830(0x13a);if(!_0x3f44cc[_0x106830(0x1a8)]?.[_0x106830(0x129)](_0x4bbec6)){console[_0x106830(0x130)](_0x106830(0x170)+_0x4bbec6+_0x106830(0x22b)+_0x539927['id']);return;}const _0x43c530=(0x0,gateway_1[_0x106830(0x1c0)])(_0x359df5[_0x106830(0x1d7)])||_0x359df5[_0x106830(0x1d7)],_0x49e5e3={'event':_0x4bbec6,'payment':{'id':_0x359df5['id'],'order_id':_0x359df5[_0x106830(0x236)],'gateway_order_id':_0x359df5[_0x106830(0x200)],'gateway':_0x43c530,'amount':_0x359df5[_0x106830(0x15c)],'currency':_0x359df5[_0x106830(0x143)],'status':_0x3a90f2[_0x106830(0x1ff)](),'customer_email':_0x359df5[_0x106830(0x206)],'customer_name':_0x359df5[_0x106830(0x132)],'created_at':_0x359df5[_0x106830(0x1aa)],'updated_at':new Date()}},_0x4d5454=await fetch(_0x3f44cc['webhookUrl'],{'method':'POST','headers':{'Content-Type':'application/json','User-Agent':_0x106830(0x234)},'body':JSON[_0x106830(0x19e)](_0x49e5e3)}),_0x95b233=Date['now']()-_0xebd9a9,_0x25659d=_0x4d5454['ok']?'Success':await _0x4d5454[_0x106830(0x179)]();loggerService_1[_0x106830(0x166)][_0x106830(0x1da)](_0x359df5[_0x106830(0x226)],_0x3f44cc[_0x106830(0x232)],_0x4bbec6,_0x4d5454[_0x106830(0x1dc)],_0x95b233,_0x49e5e3),console[_0x106830(0x130)](_0x106830(0x1e1)+_0x3f44cc[_0x106830(0x232)]+_0x106830(0x181)+_0x4d5454[_0x106830(0x1dc)]+'\x20('+_0x95b233+_0x106830(0x21c));}catch(_0x113cd4){console[_0x106830(0x190)]('Failed\x20to\x20send\x20shop\x20webhook:',_0x113cd4),loggerService_1['loggerService'][_0x106830(0x20f)](_0x359df5[_0x106830(0x226)],_0x359df5[_0x106830(0x219)]?.[_0x106830(0x1d9)]?.['webhookUrl']||_0x106830(0x20e),'webhook_send',_0x113cd4,{});}}async[a38_0x26d037(0x203)](_0x27a07a,_0x505d11){const _0x3e54ec=a38_0x26d037;try{const _0x2fb092={'PENDING':'created','PAID':_0x3e54ec(0x1ef),'FAILED':_0x3e54ec(0x13e),'EXPIRED':_0x3e54ec(0x146)},_0x26cfd0=_0x2fb092[_0x505d11];if(!_0x26cfd0||_0x26cfd0===_0x3e54ec(0x16a))return;await telegramBotService_1[_0x3e54ec(0x193)][_0x3e54ec(0x237)](_0x27a07a[_0x3e54ec(0x226)],_0x27a07a,_0x26cfd0);}catch(_0x4d7025){console['error'](_0x3e54ec(0x1e8),_0x4d7025);}}async[a38_0x26d037(0x18f)](_0x62eb50){const _0x17fb56=a38_0x26d037;console[_0x17fb56(0x130)](_0x17fb56(0x1b7)+_0x62eb50);const _0x4616cd=await database_1[_0x17fb56(0x211)][_0x17fb56(0x1e2)][_0x17fb56(0x1fd)]({'where':{'id':_0x62eb50},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x4616cd)throw new Error(_0x17fb56(0x173));if(_0x4616cd[_0x17fb56(0x1d7)]!=='cointopay'&&_0x4616cd[_0x17fb56(0x1d7)]!==_0x17fb56(0x204))throw new Error(_0x17fb56(0x19d));console[_0x17fb56(0x130)](_0x17fb56(0x224)+_0x4616cd['gateway']+'\x20payment\x20'+_0x62eb50),await this[_0x17fb56(0x1a9)](_0x4616cd),console[_0x17fb56(0x130)]('‚úÖ\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20'+_0x62eb50);}[a38_0x26d037(0x151)](){const _0x108478=a38_0x26d037,_0x41f2e8=this['globalCheckInterval']?this['GLOBAL_CHECK_INTERVAL_MS']:undefined,_0x25e647=Array[_0x108478(0x1ce)](this[_0x108478(0x1fb)][_0x108478(0x202)]())[_0x108478(0x172)](_0x4e908c=>({'paymentId':_0x4e908c['paymentId'],'gatewayPaymentId':_0x4e908c['gatewayPaymentId'],'createdAt':_0x4e908c[_0x108478(0x1aa)],'timersCount':_0x4e908c[_0x108478(0x1be)][_0x108478(0x145)]}));return{'isActive':!!this[_0x108478(0x1df)],'globalCheckIntervalMinutes':this[_0x108478(0x134)]/(0x3e8*0x3c),'expiryDays':this[_0x108478(0x152)],'activeIndividualTimers':this[_0x108478(0x1fb)][_0x108478(0x1e6)],'nextGlobalCheckIn':_0x41f2e8,'paymentTimersDetails':_0x25e647};}[a38_0x26d037(0x17d)](_0x957588){const _0x98c328=a38_0x26d037,_0x3ecf4d=this[_0x98c328(0x1fb)][_0x98c328(0x15e)](_0x957588);if(_0x3ecf4d)return{'hasTimers':!![],'timersCount':_0x3ecf4d[_0x98c328(0x1be)][_0x98c328(0x145)],'createdAt':_0x3ecf4d[_0x98c328(0x1aa)],'gatewayPaymentId':_0x3ecf4d[_0x98c328(0x138)]};return{'hasTimers':![]};}async[a38_0x26d037(0x1b5)](_0x49a5fc,_0x20ec25){const _0x1f607a=a38_0x26d037;try{const _0x504e7a=await database_1['default'][_0x1f607a(0x219)][_0x1f607a(0x1fd)]({'where':{'id':_0x49a5fc},'select':{'gatewaySettings':!![]}});if(!_0x504e7a?.['gatewaySettings'])return console[_0x1f607a(0x130)](_0x1f607a(0x15d)+_0x49a5fc+_0x1f607a(0x1d5)),0xa;const _0x4dd6a3=JSON[_0x1f607a(0x183)](_0x504e7a['gatewaySettings']);for(const [_0x594ae7,_0x21eb52]of Object[_0x1f607a(0x185)](_0x4dd6a3)){if(_0x594ae7['toLowerCase']()===_0x20ec25['toLowerCase']()){const _0xcc971b=_0x21eb52[_0x1f607a(0x12f)]||0xa;return console[_0x1f607a(0x130)](_0x1f607a(0x225)+_0x20ec25+_0x1f607a(0x1ee)+_0x49a5fc+':\x20'+_0xcc971b+'%'),_0xcc971b;}}return console[_0x1f607a(0x130)]('No\x20specific\x20commission\x20found\x20for\x20gateway\x20'+_0x20ec25+'\x20in\x20shop\x20'+_0x49a5fc+_0x1f607a(0x1a6)),0xa;}catch(_0x3c68e2){return console[_0x1f607a(0x190)]('Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20'+_0x49a5fc+_0x1f607a(0x18e)+_0x20ec25+':',_0x3c68e2),0xa;}}}exports[a38_0x26d037(0x1d2)]=CoinToPayStatusService,exports[a38_0x26d037(0x1ea)]=new CoinToPayStatusService();