'use strict';function a42_0x3f45(_0x12c716,_0x559cad){const _0x246b61=a42_0x246b();return a42_0x3f45=function(_0x3f4571,_0x4051c8){_0x3f4571=_0x3f4571-0x92;let _0x299ae4=_0x246b61[_0x3f4571];return _0x299ae4;},a42_0x3f45(_0x12c716,_0x559cad);}const a42_0x4a60df=a42_0x3f45;(function(_0x23d10f,_0x44e8ae){const _0x3e7b30=a42_0x3f45,_0x42e3b0=_0x23d10f();while(!![]){try{const _0x5d24e4=-parseInt(_0x3e7b30(0xbc))/0x1+-parseInt(_0x3e7b30(0xd2))/0x2*(parseInt(_0x3e7b30(0xd1))/0x3)+parseInt(_0x3e7b30(0xb3))/0x4+parseInt(_0x3e7b30(0x152))/0x5+parseInt(_0x3e7b30(0xe9))/0x6*(parseInt(_0x3e7b30(0xe4))/0x7)+-parseInt(_0x3e7b30(0xdb))/0x8+-parseInt(_0x3e7b30(0x172))/0x9*(-parseInt(_0x3e7b30(0xf2))/0xa);if(_0x5d24e4===_0x44e8ae)break;else _0x42e3b0['push'](_0x42e3b0['shift']());}catch(_0xb3f7dd){_0x42e3b0['push'](_0x42e3b0['shift']());}}}(a42_0x246b,0x2ce35));var __importDefault=this&&this[a42_0x4a60df(0x18d)]||function(_0x381630){const _0x468217=a42_0x4a60df;return _0x381630&&_0x381630[_0x468217(0xbf)]?_0x381630:{'default':_0x381630};};Object[a42_0x4a60df(0x116)](exports,a42_0x4a60df(0xbf),{'value':!![]}),exports[a42_0x4a60df(0x98)]=exports[a42_0x4a60df(0x110)]=void 0x0;const coinToPayService_1=require('./gateways/coinToPayService'),coinToPay2Service_1=require(a42_0x4a60df(0xda)),gateway_1=require(a42_0x4a60df(0x153)),database_1=__importDefault(require(a42_0x4a60df(0x11c))),telegramBotService_1=require('./telegramBotService'),loggerService_1=require('./loggerService'),currencyService_1=require(a42_0x4a60df(0xb7));class CoinToPayStatusService{constructor(){const _0x503fda=a42_0x4a60df;this[_0x503fda(0x131)]=null,this['GLOBAL_CHECK_INTERVAL_MS']=0x3c*0x3c*0x3e8,this[_0x503fda(0xb6)]=0x5,this[_0x503fda(0xa0)]=new Map(),this[_0x503fda(0x14a)]=new coinToPayService_1[(_0x503fda(0xee))](),this[_0x503fda(0x148)]=new coinToPay2Service_1['CoinToPay2Service'](),console[_0x503fda(0x165)]('ü™ô\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2');}['schedulePaymentChecks'](_0x144e92,_0x49eb29){const _0x1c3377=a42_0x4a60df;console[_0x1c3377(0x165)]('ü™ô\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:'),console[_0x1c3377(0x165)](_0x1c3377(0xea)+_0x144e92),console[_0x1c3377(0x165)](_0x1c3377(0x15e)+_0x49eb29),this['clearPaymentTimers'](_0x144e92);const _0x3f58ab=[],_0x5315ae=new Date(),_0x5838e2=[{'delay':0x1*0x3c*0x3e8,'description':_0x1c3377(0x9a)},{'delay':0x2*0x3c*0x3e8,'description':'2\x20minutes'},{'delay':0x5*0x3c*0x3e8,'description':_0x1c3377(0x106)},{'delay':0x5*0x3c*0x3e8,'description':_0x1c3377(0x106)}];console[_0x1c3377(0x165)](_0x1c3377(0x176)+_0x5838e2[_0x1c3377(0xb8)]+_0x1c3377(0x96)+_0x144e92);let _0x21d10c=0x0;_0x5838e2[_0x1c3377(0x184)]((_0x832f11,_0x168be5)=>{const _0x4920b5=_0x1c3377;_0x21d10c+=_0x832f11['delay'];const _0x18fd31=setTimeout(async()=>{const _0x199340=a42_0x3f45;console['log'](_0x199340(0x16c)+(_0x168be5+0x1)+'\x20triggered\x20for\x20payment\x20'+_0x144e92+_0x199340(0x125)+_0x832f11[_0x199340(0x147)]+')');try{await this[_0x199340(0xa8)](_0x144e92),console['log'](_0x199340(0x128)+(_0x168be5+0x1)+_0x199340(0x18f)+_0x144e92);}catch(_0xe04044){console[_0x199340(0x174)]('‚ùå\x20[TIMER]\x20Failed\x20individual\x20check\x20#'+(_0x168be5+0x1)+_0x199340(0x12d)+_0x144e92+':',_0xe04044),this[_0x199340(0x10e)](_0x144e92,_0x49eb29,_0xe04044,'status_check',{'checkNumber':_0x168be5+0x1,'scheduledAfter':_0x832f11[_0x199340(0x147)],'isIndividualCheck':!![]});}},_0x21d10c);_0x3f58ab[_0x4920b5(0xf6)](_0x18fd31),console[_0x4920b5(0x165)](_0x4920b5(0x149)+(_0x168be5+0x1)+_0x4920b5(0x12d)+_0x144e92+_0x4920b5(0x158)+_0x21d10c/0x3e8+_0x4920b5(0x9d)+_0x832f11['description']+')');});const _0x3e1ee8=setInterval(async()=>{const _0x51d0ca=_0x1c3377;console[_0x51d0ca(0x165)]('ü™ô\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20'+_0x144e92);try{const _0x4c9746=await database_1[_0x51d0ca(0xac)][_0x51d0ca(0x15f)][_0x51d0ca(0x15d)]({'where':{'id':_0x144e92},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x4c9746){console[_0x51d0ca(0x165)](_0x51d0ca(0x10f)+_0x144e92+_0x51d0ca(0x188)),this[_0x51d0ca(0x15b)](_0x144e92);return;}console[_0x51d0ca(0x165)]('üìä\x20[HOURLY]\x20Payment\x20'+_0x144e92+_0x51d0ca(0x156)+_0x4c9746[_0x51d0ca(0x191)]);if(_0x4c9746[_0x51d0ca(0x191)]!==_0x51d0ca(0x11b)){console[_0x51d0ca(0x165)]('‚úÖ\x20[HOURLY]\x20Payment\x20'+_0x144e92+'\x20status\x20is\x20'+_0x4c9746[_0x51d0ca(0x191)]+_0x51d0ca(0x124)),this[_0x51d0ca(0x15b)](_0x144e92);return;}const _0x139bb3=Math[_0x51d0ca(0x193)]((Date[_0x51d0ca(0xd6)]()-_0x4c9746['createdAt'][_0x51d0ca(0x11d)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x139bb3>=this[_0x51d0ca(0xb6)]){console['log'](_0x51d0ca(0xed)+_0x144e92+_0x51d0ca(0x103)+this[_0x51d0ca(0xb6)]+'\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check'),this['clearPaymentTimers'](_0x144e92);return;}await this[_0x51d0ca(0xa8)](_0x144e92),console[_0x51d0ca(0x165)](_0x51d0ca(0xbe)+_0x144e92);}catch(_0x20a0be){console[_0x51d0ca(0x174)]('‚ùå\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20'+_0x144e92+':',_0x20a0be),this['logCoinToPayError'](_0x144e92,_0x49eb29,_0x20a0be,_0x51d0ca(0xdf),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x3f58ab[_0x1c3377(0xf6)](_0x3e1ee8),this[_0x1c3377(0xa0)][_0x1c3377(0x112)](_0x144e92,{'timers':_0x3f58ab,'paymentId':_0x144e92,'gatewayPaymentId':_0x49eb29,'createdAt':_0x5315ae}),console[_0x1c3377(0x165)](_0x1c3377(0xab)+_0x5838e2['length']+_0x1c3377(0x154)+_0x144e92),console[_0x1c3377(0x165)](_0x1c3377(0x12f)+this[_0x1c3377(0xa0)][_0x1c3377(0x138)]),this[_0x1c3377(0xeb)](_0x144e92,_0x49eb29,'PENDING','PENDING',_0x1c3377(0xdf),{'action':_0x1c3377(0xba),'scheduledChecks':_0x5838e2[_0x1c3377(0xb8)],'firstCheckIn':_0x5838e2[0x0][_0x1c3377(0x132)]/0x3e8,'totalTimers':this['paymentTimers'][_0x1c3377(0x138)]});}[a42_0x4a60df(0x15b)](_0x340a65){const _0xae5dc2=a42_0x4a60df,_0xb42c89=this['paymentTimers'][_0xae5dc2(0x114)](_0x340a65);_0xb42c89?(console[_0xae5dc2(0x165)]('üßπ\x20[DEBUG]\x20Clearing\x20'+_0xb42c89['timers'][_0xae5dc2(0xb8)]+_0xae5dc2(0x129)+_0x340a65),_0xb42c89[_0xae5dc2(0x181)][_0xae5dc2(0x184)]((_0x26ee7d,_0x1c72de)=>{const _0x2626da=_0xae5dc2;_0x26ee7d&&(clearTimeout(_0x26ee7d),clearInterval(_0x26ee7d),console[_0x2626da(0x165)](_0x2626da(0xe7)+(_0x1c72de+0x1)+_0x2626da(0x12d)+_0x340a65));}),this[_0xae5dc2(0xa0)][_0xae5dc2(0x157)](_0x340a65),console[_0xae5dc2(0x165)]('‚úÖ\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20'+_0x340a65+'.\x20Remaining\x20active\x20timers:\x20'+this[_0xae5dc2(0xa0)]['size'])):console[_0xae5dc2(0x165)]('‚ö†Ô∏è\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20'+_0x340a65+'\x20to\x20clear');}async[a42_0x4a60df(0xa8)](_0x2c188d){const _0x401dc8=a42_0x4a60df;console[_0x401dc8(0x165)](_0x401dc8(0x105)+_0x2c188d);const _0x5a516e=await database_1['default'][_0x401dc8(0x15f)][_0x401dc8(0x15d)]({'where':{'id':_0x2c188d},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x5a516e){console[_0x401dc8(0x165)](_0x401dc8(0xa6)+_0x2c188d+'\x20not\x20found\x20in\x20database');return;}console[_0x401dc8(0x165)](_0x401dc8(0x10b)+_0x2c188d+'\x20found:'),console[_0x401dc8(0x165)](_0x401dc8(0xd7)+_0x5a516e['gateway']),console['log'](_0x401dc8(0x13d)+_0x5a516e[_0x401dc8(0x191)]),console[_0x401dc8(0x165)](_0x401dc8(0x166)+_0x5a516e[_0x401dc8(0xb4)]),console[_0x401dc8(0x165)]('\x20\x20\x20-\x20Amount:\x20'+_0x5a516e[_0x401dc8(0x9c)]+'\x20'+_0x5a516e[_0x401dc8(0x18e)]),console[_0x401dc8(0x165)](_0x401dc8(0x95)+_0x5a516e[_0x401dc8(0xd9)]);if(_0x5a516e[_0x401dc8(0x133)]!=='cointopay'&&_0x5a516e[_0x401dc8(0x133)]!==_0x401dc8(0x121)){console['log'](_0x401dc8(0x9e)+_0x2c188d+_0x401dc8(0x11a)+_0x5a516e[_0x401dc8(0x133)]+')');return;}if(_0x5a516e['status']!==_0x401dc8(0x11b)){console['log']('‚ö†Ô∏è\x20[CHECK]\x20Payment\x20'+_0x2c188d+'\x20status\x20is\x20'+_0x5a516e[_0x401dc8(0x191)]+_0x401dc8(0x124)),this[_0x401dc8(0x15b)](_0x2c188d);return;}if(!_0x5a516e[_0x401dc8(0xb4)]){console['log'](_0x401dc8(0x9e)+_0x2c188d+'\x20has\x20no\x20gatewayPaymentId');return;}console['log']('‚úÖ\x20[CHECK]\x20Payment\x20'+_0x2c188d+_0x401dc8(0x104)),await this[_0x401dc8(0x171)](_0x5a516e);}[a42_0x4a60df(0xeb)](_0x445b60,_0x44bf1a,_0x5a7303,_0x579457,_0x5d393b,_0x5e3950){const _0x23e105=a42_0x4a60df,_0x31b04d={'type':_0x23e105(0x150),'paymentId':_0x445b60,'gatewayPaymentId':_0x44bf1a,'oldStatus':_0x5a7303,'newStatus':_0x579457,'source':_0x5d393b,'timestamp':new Date()[_0x23e105(0x16f)](),'details':_0x5e3950||{}};loggerService_1[_0x23e105(0xce)][_0x23e105(0xeb)](_0x31b04d),console[_0x23e105(0x165)](_0x23e105(0xc2)+_0x445b60+'\x20('+_0x44bf1a+')'),console[_0x23e105(0x165)](_0x23e105(0x190)+_0x5a7303+_0x23e105(0xb5)+_0x579457),console[_0x23e105(0x165)](_0x23e105(0x146)+_0x5d393b),console[_0x23e105(0x165)](_0x23e105(0xa9)+_0x31b04d[_0x23e105(0x178)]),_0x5e3950&&console['log']('\x20\x20\x20üìù\x20Details:',_0x5e3950);}[a42_0x4a60df(0x10e)](_0x629963,_0x4ac3cd,_0x3bc2ea,_0x34d6dd,_0x2f4a4f){const _0x121387=a42_0x4a60df,_0x1e45d9={'type':_0x121387(0xd8),'paymentId':_0x629963,'gatewayPaymentId':_0x4ac3cd,'error':_0x3bc2ea instanceof Error?{'message':_0x3bc2ea['message'],'stack':_0x3bc2ea['stack']}:_0x3bc2ea,'source':_0x34d6dd,'timestamp':new Date()[_0x121387(0x16f)](),'context':_0x2f4a4f||{}};loggerService_1['loggerService'][_0x121387(0x10e)](_0x1e45d9),console['error'](_0x121387(0xad)+_0x629963+'\x20('+_0x4ac3cd+')'),console[_0x121387(0x174)](_0x121387(0x111)+(_0x3bc2ea instanceof Error?_0x3bc2ea['message']:_0x3bc2ea)),console['error'](_0x121387(0x146)+_0x34d6dd),console[_0x121387(0x174)](_0x121387(0xa9)+_0x1e45d9[_0x121387(0x178)]),_0x2f4a4f&&console['error']('\x20\x20\x20üìù\x20Context:',_0x2f4a4f);}[a42_0x4a60df(0x134)](){const _0x1644b2=a42_0x4a60df;console[_0x1644b2(0x165)](_0x1644b2(0xf5)),this[_0x1644b2(0x182)]()[_0x1644b2(0x13c)](_0x5ca1bf=>{const _0x23bbb5=_0x1644b2;console[_0x23bbb5(0x174)](_0x23bbb5(0x10a),_0x5ca1bf);}),this[_0x1644b2(0x131)]=setInterval(async()=>{const _0x5b17a8=_0x1644b2;try{console['log']('ü™ô\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...'),await this[_0x5b17a8(0x182)](),console[_0x5b17a8(0x165)](_0x5b17a8(0xd0));}catch(_0x21cfa9){console['error']('‚ùå\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:',_0x21cfa9);}},this['GLOBAL_CHECK_INTERVAL_MS']),console[_0x1644b2(0x165)](_0x1644b2(0x16d));}[a42_0x4a60df(0x135)](){const _0x384faf=a42_0x4a60df;console[_0x384faf(0x165)](_0x384faf(0xa5));this['globalCheckInterval']&&(clearInterval(this['globalCheckInterval']),this['globalCheckInterval']=null,console[_0x384faf(0x165)](_0x384faf(0x115)));const _0x597ab8=this[_0x384faf(0xa0)][_0x384faf(0x138)];for(const [_0x45ef06]of this['paymentTimers']){this[_0x384faf(0x15b)](_0x45ef06);}console[_0x384faf(0x165)](_0x384faf(0xa4)+_0x597ab8+_0x384faf(0xfb));}async[a42_0x4a60df(0x182)](){const _0x34f70b=a42_0x4a60df;try{console[_0x34f70b(0x165)](_0x34f70b(0x11f));const _0x3de060=await database_1['default'][_0x34f70b(0x15f)][_0x34f70b(0xf0)]({'where':{'gateway':{'in':[_0x34f70b(0x122),_0x34f70b(0x121)]},'status':_0x34f70b(0x11b),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console['log']('ü™ô\x20[GLOBAL]\x20Found\x20'+_0x3de060[_0x34f70b(0xb8)]+'\x20pending\x20CoinToPay\x20payments');if(_0x3de060[_0x34f70b(0xb8)]===0x0){console[_0x34f70b(0x165)]('ü™ô\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check');return;}const _0x902b7f=await this[_0x34f70b(0x141)](_0x3de060);console['log'](_0x34f70b(0x126)+_0x902b7f[_0x34f70b(0xb8)]+_0x34f70b(0xf7));let _0x275a7a=0x0,_0x5892bd=0x0;for(const _0x58b3cb of _0x3de060){try{if(_0x902b7f[_0x34f70b(0x11e)](_0x58b3cb['id'])){console[_0x34f70b(0x165)](_0x34f70b(0xcc)+_0x58b3cb['id']+'\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check'),_0x5892bd++;continue;}if(this[_0x34f70b(0xa0)][_0x34f70b(0x14b)](_0x58b3cb['id'])){console[_0x34f70b(0x165)](_0x34f70b(0xcc)+_0x58b3cb['id']+_0x34f70b(0x123)),_0x5892bd++;continue;}const _0x5261cf=(Date[_0x34f70b(0xd6)]()-_0x58b3cb[_0x34f70b(0x17f)][_0x34f70b(0x11d)]())/(0x3e8*0x3c*0x3c);if(_0x5261cf<0x1){console[_0x34f70b(0x165)](_0x34f70b(0xcc)+_0x58b3cb['id']+_0x34f70b(0x179)+_0x5261cf[_0x34f70b(0xf9)](0x1)+_0x34f70b(0xfc)),_0x5892bd++;continue;}console['log'](_0x34f70b(0xe2)+_0x58b3cb['id']+_0x34f70b(0xec)+_0x5261cf[_0x34f70b(0xf9)](0x1)+'h)'),await this['checkSinglePayment'](_0x58b3cb),_0x275a7a++,await new Promise(_0x34c662=>setTimeout(_0x34c662,0x7d0));}catch(_0x3dfb39){console[_0x34f70b(0x174)]('‚ùå\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20'+_0x58b3cb['id']+':',_0x3dfb39),this[_0x34f70b(0x10e)](_0x58b3cb['id'],_0x58b3cb[_0x34f70b(0xb4)]||_0x34f70b(0xbd),_0x3dfb39,_0x34f70b(0xdf),{'isGlobalCheck':!![],'paymentAmount':_0x58b3cb[_0x34f70b(0x9c)],'paymentCurrency':_0x58b3cb['currency'],'shopId':_0x58b3cb[_0x34f70b(0xd9)],'createdAt':_0x58b3cb[_0x34f70b(0x17f)]}),loggerService_1[_0x34f70b(0xce)][_0x34f70b(0xe5)]('cointopay',_0x34f70b(0xb1)+_0x58b3cb[_0x34f70b(0xb4)],_0x3dfb39);}}console[_0x34f70b(0x165)]('‚úÖ\x20[GLOBAL]\x20Global\x20check\x20completed:\x20'+_0x275a7a+_0x34f70b(0x108)+_0x5892bd+_0x34f70b(0x15a)+_0x902b7f['length']+_0x34f70b(0x139));}catch(_0x48039e){console['error'](_0x34f70b(0xd5),_0x48039e);}}async[a42_0x4a60df(0x141)](_0x3a3423){const _0x2a7ecc=a42_0x4a60df,_0x2f92f4=[],_0x4da03c=new Date();_0x4da03c[_0x2a7ecc(0x192)](_0x4da03c[_0x2a7ecc(0x130)]()-this[_0x2a7ecc(0xb6)]),console[_0x2a7ecc(0x165)](_0x2a7ecc(0x12e)+this[_0x2a7ecc(0xb6)]+_0x2a7ecc(0x97)+_0x4da03c[_0x2a7ecc(0x16f)]()+')');for(const _0x54c47c of _0x3a3423){if(_0x54c47c['createdAt']<_0x4da03c){console[_0x2a7ecc(0x165)](_0x2a7ecc(0x140)+_0x54c47c['id']+'\x20is\x20older\x20than\x20'+this[_0x2a7ecc(0xb6)]+'\x20days,\x20marking\x20as\x20EXPIRED');try{this['logCoinToPayStatus'](_0x54c47c['id'],_0x54c47c[_0x2a7ecc(0xb4)]||_0x2a7ecc(0xbd),_0x2a7ecc(0x11b),_0x2a7ecc(0xf4),_0x2a7ecc(0xa1),{'reason':_0x2a7ecc(0xaf)+this[_0x2a7ecc(0xb6)]+'\x20days','createdAt':_0x54c47c['createdAt'],'daysSinceCreation':Math[_0x2a7ecc(0x193)]((Date[_0x2a7ecc(0xd6)]()-_0x54c47c[_0x2a7ecc(0x17f)][_0x2a7ecc(0x11d)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x54c47c[_0x2a7ecc(0x9c)],'paymentCurrency':_0x54c47c[_0x2a7ecc(0x18e)],'shopId':_0x54c47c[_0x2a7ecc(0xd9)]}),await database_1['default'][_0x2a7ecc(0x15f)][_0x2a7ecc(0x161)]({'where':{'id':_0x54c47c['id']},'data':{'status':_0x2a7ecc(0xf4),'updatedAt':new Date(),'adminNotes':_0x2a7ecc(0xe6)+this['EXPIRY_DAYS']+_0x2a7ecc(0x14e)}}),await database_1['default']['webhookLog'][_0x2a7ecc(0x144)]({'data':{'paymentId':_0x54c47c['id'],'shopId':_0x54c47c[_0x2a7ecc(0xd9)],'event':'cointopay_auto_expired','statusCode':0xc8,'responseBody':JSON[_0x2a7ecc(0x120)]({'reason':'Payment\x20older\x20than\x20'+this['EXPIRY_DAYS']+_0x2a7ecc(0xf3),'createdAt':_0x54c47c[_0x2a7ecc(0x17f)],'expiredAt':new Date()[_0x2a7ecc(0x16f)](),'daysSinceCreation':Math[_0x2a7ecc(0x193)]((Date[_0x2a7ecc(0xd6)]()-_0x54c47c['createdAt'][_0x2a7ecc(0x11d)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this['sendShopWebhook'](_0x54c47c,_0x2a7ecc(0xf4)),await this[_0x2a7ecc(0x12a)](_0x54c47c,_0x2a7ecc(0xf4)),this['clearPaymentTimers'](_0x54c47c['id']),_0x2f92f4[_0x2a7ecc(0xf6)](_0x54c47c['id']),console[_0x2a7ecc(0x165)]('‚úÖ\x20[EXPIRY]\x20Payment\x20'+_0x54c47c['id']+_0x2a7ecc(0x16a)+this[_0x2a7ecc(0xb6)]+_0x2a7ecc(0x194));}catch(_0x2d6451){console[_0x2a7ecc(0x174)](_0x2a7ecc(0x164)+_0x54c47c['id']+':',_0x2d6451),this['logCoinToPayError'](_0x54c47c['id'],_0x54c47c['gatewayPaymentId']||_0x2a7ecc(0xbd),_0x2d6451,_0x2a7ecc(0xa1),{'reason':_0x2a7ecc(0x93),'createdAt':_0x54c47c[_0x2a7ecc(0x17f)],'daysSinceCreation':Math['floor']((Date[_0x2a7ecc(0xd6)]()-_0x54c47c[_0x2a7ecc(0x17f)][_0x2a7ecc(0x11d)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x2f92f4;}async[a42_0x4a60df(0x171)](_0x2f1b73){const _0x3f0c9f=a42_0x4a60df;if(!_0x2f1b73[_0x3f0c9f(0xb4)]){console['log'](_0x3f0c9f(0x9e)+_0x2f1b73['id']+'\x20has\x20no\x20gatewayPaymentId,\x20skipping');return;}console['log'](_0x3f0c9f(0xc3)+_0x2f1b73['gateway']+_0x3f0c9f(0x9b)+_0x2f1b73['id']+'\x20('+_0x2f1b73[_0x3f0c9f(0xb4)]+')');try{let _0x529a45;_0x2f1b73['gateway']===_0x3f0c9f(0x121)?(_0x529a45=await this['coinToPay2Service'][_0x3f0c9f(0xe0)](_0x2f1b73[_0x3f0c9f(0xb4)]),console[_0x3f0c9f(0x165)](_0x3f0c9f(0x18b)+_0x2f1b73['id']+_0x3f0c9f(0x183)+_0x529a45[_0x3f0c9f(0x191)])):(_0x529a45=await this[_0x3f0c9f(0x14a)][_0x3f0c9f(0xe0)](_0x2f1b73['gatewayPaymentId']),console[_0x3f0c9f(0x165)](_0x3f0c9f(0x100)+_0x2f1b73['id']+_0x3f0c9f(0x183)+_0x529a45['status']));_0x529a45[_0x3f0c9f(0x137)]&&console[_0x3f0c9f(0x165)](_0x3f0c9f(0x10b)+_0x2f1b73['id']+'\x20details:',{'iban':_0x529a45[_0x3f0c9f(0x137)][_0x3f0c9f(0xc6)]||_0x3f0c9f(0xbb),'transactionId':_0x529a45[_0x3f0c9f(0x137)][_0x3f0c9f(0xb0)],'createdOn':_0x529a45[_0x3f0c9f(0x137)]['createdOn'],'confirmedOn':_0x529a45['paymentDetails']['confirmedOn']||'not\x20confirmed'});if(_0x529a45[_0x3f0c9f(0x191)]!==_0x2f1b73['status']){console['log'](_0x3f0c9f(0x92)+_0x2f1b73['id']+_0x3f0c9f(0xca)+_0x2f1b73[_0x3f0c9f(0x191)]+_0x3f0c9f(0xa3)+_0x529a45[_0x3f0c9f(0x191)]),this['logCoinToPayStatus'](_0x2f1b73['id'],_0x2f1b73[_0x3f0c9f(0xb4)],_0x2f1b73[_0x3f0c9f(0x191)],_0x529a45[_0x3f0c9f(0x191)],_0x3f0c9f(0xdf),{'paymentDetails':_0x529a45[_0x3f0c9f(0x137)],'amount':_0x529a45[_0x3f0c9f(0x9c)],'currency':_0x529a45[_0x3f0c9f(0x18e)],'shopId':_0x2f1b73['shopId'],'checkTimestamp':new Date()[_0x3f0c9f(0x16f)]()});const _0xb944e8={'status':_0x529a45[_0x3f0c9f(0x191)],'updatedAt':new Date()};if(_0x529a45[_0x3f0c9f(0x191)]===_0x3f0c9f(0xdd)&&_0x2f1b73[_0x3f0c9f(0x191)]!==_0x3f0c9f(0xdd)){_0xb944e8[_0x3f0c9f(0x18c)]=new Date();if(!_0x2f1b73[_0x3f0c9f(0x13a)]){const _0x398c36=await currencyService_1[_0x3f0c9f(0x10c)]['convertToUSDT'](_0x2f1b73[_0x3f0c9f(0x9c)],_0x2f1b73[_0x3f0c9f(0x18e)]);_0xb944e8['amountUSDT']=_0x398c36;const _0x491c7d=await this[_0x3f0c9f(0x9f)](_0x2f1b73['shopId'],_0x2f1b73[_0x3f0c9f(0x133)]),_0x52d89b=_0x398c36*(0x1-_0x491c7d/0x64);_0xb944e8[_0x3f0c9f(0xf1)]=_0x52d89b,_0xb944e8['gatewayCommissionRate']=_0x491c7d,console[_0x3f0c9f(0x165)](_0x3f0c9f(0x160)+_0x2f1b73['id']+_0x3f0c9f(0x151)),console[_0x3f0c9f(0x165)](_0x3f0c9f(0xc1)+_0x2f1b73[_0x3f0c9f(0x9c)]+'\x20'+_0x2f1b73['currency']+_0x3f0c9f(0xb5)+_0x398c36[_0x3f0c9f(0xf9)](0x6)+_0x3f0c9f(0x94)),console[_0x3f0c9f(0x165)](_0x3f0c9f(0x136)+_0x2f1b73[_0x3f0c9f(0x133)]+'\x20commission:\x20'+_0x491c7d+'%'),console[_0x3f0c9f(0x165)](_0x3f0c9f(0x99)+_0x52d89b[_0x3f0c9f(0xf9)](0x6)+_0x3f0c9f(0x94));}console['log'](_0x3f0c9f(0x160)+_0x2f1b73['id']+'\x20marked\x20as\x20paid\x20at:\x20'+_0xb944e8[_0x3f0c9f(0x18c)][_0x3f0c9f(0x16f)]());}if(_0x529a45[_0x3f0c9f(0x137)]){const _0x5b614f=_0x529a45[_0x3f0c9f(0x137)];_0x5b614f[_0x3f0c9f(0xc6)]&&(_0xb944e8[_0x3f0c9f(0xd4)]=_0x5b614f[_0x3f0c9f(0xc6)],console[_0x3f0c9f(0x165)]('üè¶\x20[CHECK]\x20Saved\x20IBAN:\x20'+_0x5b614f[_0x3f0c9f(0xc6)]));if(_0x5b614f['bankDetails']){const _0x51a871=_0x2f1b73[_0x3f0c9f(0xcb)]||'',_0x231064=_0x3f0c9f(0xff)+_0x5b614f[_0x3f0c9f(0xcd)];_0xb944e8[_0x3f0c9f(0xcb)]=_0x51a871?_0x51a871+'\x0a\x0a'+_0x231064:_0x231064,console[_0x3f0c9f(0x165)](_0x3f0c9f(0x13f));}_0x5b614f['transactionId']&&console[_0x3f0c9f(0x165)]('üÜî\x20[CHECK]\x20Transaction\x20ID:\x20'+_0x5b614f[_0x3f0c9f(0xb0)]),_0x5b614f[_0x3f0c9f(0xe8)]&&console['log'](_0x3f0c9f(0x162)+_0x5b614f[_0x3f0c9f(0xe8)]);}await database_1[_0x3f0c9f(0xac)][_0x3f0c9f(0x15f)][_0x3f0c9f(0x161)]({'where':{'id':_0x2f1b73['id']},'data':_0xb944e8});if(_0x529a45[_0x3f0c9f(0x191)]===_0x3f0c9f(0xdd)&&_0x2f1b73['status']!==_0x3f0c9f(0xdd)){console[_0x3f0c9f(0x165)]('üìà\x20[COINTOPAY]\x20Payment\x20'+_0x2f1b73['id']+_0x3f0c9f(0x14f));const _0x49392d=await database_1[_0x3f0c9f(0xac)][_0x3f0c9f(0x15f)]['findUnique']({'where':{'id':_0x2f1b73['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x49392d?.[_0x3f0c9f(0xdc)]&&_0x49392d[_0x3f0c9f(0xd3)])try{const _0x1e848f=_0x49392d[_0x3f0c9f(0xd3)];console[_0x3f0c9f(0x165)]('üìà\x20[COINTOPAY]\x20Found\x20payment\x20link\x20'+_0x1e848f['id']+_0x3f0c9f(0xc8)+_0x1e848f[_0x3f0c9f(0xa7)]+',\x20currentPayments='+_0x1e848f[_0x3f0c9f(0x15c)]+',\x20status='+_0x1e848f[_0x3f0c9f(0x191)]);const _0x42098a=_0x1e848f[_0x3f0c9f(0x15c)]+0x1,_0x207922=_0x1e848f['type']==='SINGLE'?_0x3f0c9f(0x109):_0x1e848f[_0x3f0c9f(0x191)];await database_1['default'][_0x3f0c9f(0xd3)][_0x3f0c9f(0x161)]({'where':{'id':_0x1e848f['id']},'data':{'currentPayments':_0x42098a,'status':_0x207922,'updatedAt':new Date()}}),console[_0x3f0c9f(0x165)](_0x3f0c9f(0x12b)+_0x1e848f['id']+_0x3f0c9f(0x177)+_0x1e848f[_0x3f0c9f(0x15c)]+_0x3f0c9f(0xb5)+_0x42098a+_0x3f0c9f(0x119)+_0x1e848f['status']+_0x3f0c9f(0xb5)+_0x207922);}catch(_0x2a0f58){console['error'](_0x3f0c9f(0x167),_0x2a0f58);}else console[_0x3f0c9f(0x165)]('üìà\x20[COINTOPAY]\x20Payment\x20'+_0x2f1b73['id']+_0x3f0c9f(0xc5));}await database_1['default'][_0x3f0c9f(0x14d)][_0x3f0c9f(0x144)]({'data':{'paymentId':_0x2f1b73['id'],'shopId':_0x2f1b73[_0x3f0c9f(0xd9)],'event':_0x3f0c9f(0x168)+_0x529a45['status'][_0x3f0c9f(0x102)](),'statusCode':0xc8,'responseBody':JSON[_0x3f0c9f(0x120)]({'oldStatus':_0x2f1b73[_0x3f0c9f(0x191)],'newStatus':_0x529a45[_0x3f0c9f(0x191)],'paymentDetails':_0x529a45[_0x3f0c9f(0x137)],'checkedAt':new Date()[_0x3f0c9f(0x16f)]()})}}),await this[_0x3f0c9f(0x185)](_0x2f1b73,_0x529a45['status']),await this[_0x3f0c9f(0x12a)](_0x2f1b73,_0x529a45['status']),_0x529a45[_0x3f0c9f(0x191)]!=='PENDING'&&(console[_0x3f0c9f(0x165)]('üßπ\x20[CHECK]\x20Payment\x20'+_0x2f1b73['id']+_0x3f0c9f(0x17d)+_0x529a45[_0x3f0c9f(0x191)]+',\x20clearing\x20individual\x20timers'),this[_0x3f0c9f(0x15b)](_0x2f1b73['id'])),console[_0x3f0c9f(0x165)]('‚úÖ\x20[CHECK]\x20Payment\x20'+_0x2f1b73['id']+'\x20updated\x20successfully');}else console[_0x3f0c9f(0x165)](_0x3f0c9f(0x10b)+_0x2f1b73['id']+_0x3f0c9f(0x175)+_0x529a45['status']+')'),this[_0x3f0c9f(0xeb)](_0x2f1b73['id'],_0x2f1b73[_0x3f0c9f(0xb4)],_0x2f1b73[_0x3f0c9f(0x191)],_0x529a45[_0x3f0c9f(0x191)],_0x3f0c9f(0xdf),{'statusUnchanged':!![],'paymentDetails':_0x529a45[_0x3f0c9f(0x137)],'amount':_0x529a45[_0x3f0c9f(0x9c)],'currency':_0x529a45[_0x3f0c9f(0x18e)],'shopId':_0x2f1b73[_0x3f0c9f(0xd9)],'checkTimestamp':new Date()[_0x3f0c9f(0x16f)]()});}catch(_0x5982d2){console['error'](_0x3f0c9f(0x17a)+_0x2f1b73['id']+':',_0x5982d2),this[_0x3f0c9f(0x10e)](_0x2f1b73['id'],_0x2f1b73[_0x3f0c9f(0xb4)],_0x5982d2,_0x3f0c9f(0xdf),{'paymentAmount':_0x2f1b73['amount'],'paymentCurrency':_0x2f1b73[_0x3f0c9f(0x18e)],'shopId':_0x2f1b73[_0x3f0c9f(0xd9)],'createdAt':_0x2f1b73[_0x3f0c9f(0x17f)]}),await database_1[_0x3f0c9f(0xac)][_0x3f0c9f(0x14d)]['create']({'data':{'paymentId':_0x2f1b73['id'],'shopId':_0x2f1b73['shopId'],'event':_0x3f0c9f(0x142),'statusCode':0x1f4,'responseBody':JSON[_0x3f0c9f(0x120)]({'error':_0x5982d2 instanceof Error?_0x5982d2[_0x3f0c9f(0x16b)]:_0x3f0c9f(0x143),'gatewayPaymentId':_0x2f1b73[_0x3f0c9f(0xb4)],'checkedAt':new Date()[_0x3f0c9f(0x16f)]()})}});}}async[a42_0x4a60df(0x185)](_0x14fb2d,_0x218ab9){const _0x546ecb=a42_0x4a60df,_0x5f0c04=Date[_0x546ecb(0xd6)]();try{const _0x2fc6cf=_0x14fb2d[_0x546ecb(0x113)],_0x106c6b=_0x2fc6cf[_0x546ecb(0x118)];if(!_0x106c6b?.[_0x546ecb(0x173)]){console['log'](_0x546ecb(0xb2)+_0x2fc6cf['id']);return;}const _0x497c8e=_0x218ab9===_0x546ecb(0xdd)?_0x546ecb(0x13e):_0x218ab9==='FAILED'?_0x546ecb(0xe3):_0x218ab9===_0x546ecb(0xf4)?_0x546ecb(0xe3):_0x546ecb(0x10d);if(!_0x106c6b[_0x546ecb(0x187)]?.[_0x546ecb(0x11e)](_0x497c8e)){console[_0x546ecb(0x165)](_0x546ecb(0x163)+_0x497c8e+'\x20not\x20enabled\x20for\x20shop\x20'+_0x2fc6cf['id']);return;}const _0x109da4=(0x0,gateway_1[_0x546ecb(0xcf)])(_0x14fb2d[_0x546ecb(0x133)])||_0x14fb2d['gateway'],_0x507fa4={'event':_0x497c8e,'payment':{'id':_0x14fb2d['id'],'order_id':_0x14fb2d['orderId'],'gateway_order_id':_0x14fb2d['gatewayOrderId'],'gateway':_0x109da4,'amount':_0x14fb2d['amount'],'currency':_0x14fb2d[_0x546ecb(0x18e)],'status':_0x218ab9[_0x546ecb(0x102)](),'customer_email':_0x14fb2d['customerEmail'],'customer_name':_0x14fb2d[_0x546ecb(0xae)],'created_at':_0x14fb2d[_0x546ecb(0x17f)],'updated_at':new Date()}},_0x41cb20=await fetch(_0x106c6b[_0x546ecb(0x173)],{'method':_0x546ecb(0xfa),'headers':{'Content-Type':_0x546ecb(0x18a),'User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x546ecb(0x120)](_0x507fa4)}),_0x49b836=Date[_0x546ecb(0xd6)]()-_0x5f0c04,_0xc670b3=_0x41cb20['ok']?_0x546ecb(0x117):await _0x41cb20[_0x546ecb(0x14c)]();loggerService_1[_0x546ecb(0xce)][_0x546ecb(0x107)](_0x14fb2d[_0x546ecb(0xd9)],_0x106c6b[_0x546ecb(0x173)],_0x497c8e,_0x41cb20['status'],_0x49b836,_0x507fa4),console[_0x546ecb(0x165)]('Shop\x20webhook\x20sent\x20to\x20'+_0x106c6b[_0x546ecb(0x173)]+_0x546ecb(0xde)+_0x41cb20['status']+'\x20('+_0x49b836+_0x546ecb(0xc9));}catch(_0x4eba19){console['error'](_0x546ecb(0xc0),_0x4eba19),loggerService_1[_0x546ecb(0xce)][_0x546ecb(0xb9)](_0x14fb2d[_0x546ecb(0xd9)],_0x14fb2d[_0x546ecb(0x113)]?.[_0x546ecb(0x118)]?.[_0x546ecb(0x173)]||_0x546ecb(0xbd),_0x546ecb(0x101),_0x4eba19,{});}}async[a42_0x4a60df(0x12a)](_0x6b9c30,_0x370d6b){const _0x3868d0=a42_0x4a60df;try{const _0x6b23e9={'PENDING':'created','PAID':_0x3868d0(0x189),'FAILED':_0x3868d0(0x145),'EXPIRED':_0x3868d0(0x17b)},_0x51d917=_0x6b23e9[_0x370d6b];if(!_0x51d917||_0x51d917===_0x3868d0(0x180))return;await telegramBotService_1['telegramBotService'][_0x3868d0(0x155)](_0x6b9c30['shopId'],_0x6b9c30,_0x51d917);}catch(_0x5e4928){console[_0x3868d0(0x174)](_0x3868d0(0xfe),_0x5e4928);}}async[a42_0x4a60df(0xf8)](_0x30f633){const _0x18e328=a42_0x4a60df;console['log'](_0x18e328(0x127)+_0x30f633);const _0xd7cf9=await database_1[_0x18e328(0xac)][_0x18e328(0x15f)]['findUnique']({'where':{'id':_0x30f633},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0xd7cf9)throw new Error(_0x18e328(0x186));if(_0xd7cf9[_0x18e328(0x133)]!==_0x18e328(0x122)&&_0xd7cf9[_0x18e328(0x133)]!==_0x18e328(0x121))throw new Error('Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment');console[_0x18e328(0x165)]('‚úÖ\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20'+_0xd7cf9[_0x18e328(0x133)]+'\x20payment\x20'+_0x30f633),await this[_0x18e328(0x171)](_0xd7cf9),console[_0x18e328(0x165)]('‚úÖ\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20'+_0x30f633);}[a42_0x4a60df(0xc4)](){const _0x88872c=a42_0x4a60df,_0xc429f3=this[_0x88872c(0x131)]?this[_0x88872c(0x17c)]:undefined,_0x5e039a=Array[_0x88872c(0xaa)](this[_0x88872c(0xa0)][_0x88872c(0x170)]())[_0x88872c(0xfd)](_0x3a5265=>({'paymentId':_0x3a5265[_0x88872c(0x12c)],'gatewayPaymentId':_0x3a5265[_0x88872c(0xb4)],'createdAt':_0x3a5265['createdAt'],'timersCount':_0x3a5265['timers'][_0x88872c(0xb8)]}));return{'isActive':!!this[_0x88872c(0x131)],'globalCheckIntervalMinutes':this['GLOBAL_CHECK_INTERVAL_MS']/(0x3e8*0x3c),'expiryDays':this['EXPIRY_DAYS'],'activeIndividualTimers':this[_0x88872c(0xa0)][_0x88872c(0x138)],'nextGlobalCheckIn':_0xc429f3,'paymentTimersDetails':_0x5e039a};}['getPaymentTimerInfo'](_0x146e75){const _0x42cacd=a42_0x4a60df,_0x4a89b9=this[_0x42cacd(0xa0)]['get'](_0x146e75);if(_0x4a89b9)return{'hasTimers':!![],'timersCount':_0x4a89b9[_0x42cacd(0x181)][_0x42cacd(0xb8)],'createdAt':_0x4a89b9['createdAt'],'gatewayPaymentId':_0x4a89b9[_0x42cacd(0xb4)]};return{'hasTimers':![]};}async[a42_0x4a60df(0x9f)](_0x452461,_0xc96d03){const _0x4346ec=a42_0x4a60df;try{const _0xccfa70=await database_1[_0x4346ec(0xac)][_0x4346ec(0x113)][_0x4346ec(0x15d)]({'where':{'id':_0x452461},'select':{'gatewaySettings':!![]}});if(!_0xccfa70?.[_0x4346ec(0x17e)])return console['log'](_0x4346ec(0x159)+_0x452461+',\x20using\x20default\x20commission\x2010%'),0xa;const _0x225e12=JSON[_0x4346ec(0xa2)](_0xccfa70['gatewaySettings']);for(const [_0xeb2fd9,_0x219f09]of Object['entries'](_0x225e12)){if(_0xeb2fd9[_0x4346ec(0x102)]()===_0xc96d03[_0x4346ec(0x102)]()){const _0x399a63=_0x219f09[_0x4346ec(0xef)]||0xa;return console[_0x4346ec(0x165)](_0x4346ec(0x169)+_0xc96d03+_0x4346ec(0x13b)+_0x452461+':\x20'+_0x399a63+'%'),_0x399a63;}}return console[_0x4346ec(0x165)](_0x4346ec(0xc7)+_0xc96d03+'\x20in\x20shop\x20'+_0x452461+_0x4346ec(0x16e)),0xa;}catch(_0x1f8b0b){return console['error'](_0x4346ec(0xe1)+_0x452461+',\x20gateway\x20'+_0xc96d03+':',_0x1f8b0b),0xa;}}}exports['CoinToPayStatusService']=CoinToPayStatusService,exports[a42_0x4a60df(0x98)]=new CoinToPayStatusService();function a42_0x246b(){const _0x51f52c=['CoinToPayService','commission','findMany','amountAfterGatewayCommissionUSDT','30WRqeAw','\x20days','EXPIRED','ü™ô\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','push','\x20expired\x20CoinToPay\x20payments','checkPaymentById','toFixed','POST','\x20individual\x20payment\x20timers','h),\x20skipping\x20global\x20check','map','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','Bank\x20Details:\x20','üìä\x20[CHECK]\x20CoinToPay\x20payment\x20','webhook_send','toLowerCase','\x20is\x20older\x20than\x20','\x20is\x20valid\x20for\x20checking,\x20proceeding...','üîç\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','5\x20minutes','logShopWebhookSent','\x20checked,\x20','COMPLETED','‚ùå\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','üìä\x20[CHECK]\x20Payment\x20','currencyService','payment.pending','logCoinToPayError','‚ùå\x20[HOURLY]\x20Payment\x20','CoinToPayStatusService','\x20\x20\x20‚ùå\x20Error:\x20','set','shop','get','üõë\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','defineProperty','Success','settings',',\x20status=','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','PENDING','../config/database','getTime','includes','ü™ô\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','stringify','cointopay2','cointopay','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check',',\x20stopping\x20individual\x20checks','\x20(after\x20','‚è∞\x20[GLOBAL]\x20Found\x20','üîç\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','‚úÖ\x20[TIMER]\x20Individual\x20check\x20#','\x20timers\x20for\x20payment\x20','sendPaymentStatusNotification','‚úÖ\x20[COINTOPAY]\x20Payment\x20link\x20','paymentId','\x20for\x20payment\x20','‚è∞\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','üìä\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','getDate','globalCheckInterval','delay','gateway','startPeriodicStatusCheck','stopPeriodicStatusCheck','\x20\x20\x20Gateway\x20','paymentDetails','size','\x20expired','amountUSDT','\x20commission\x20for\x20shop\x20','catch','\x20\x20\x20-\x20Status:\x20','payment.success','üè¶\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes','‚è∞\x20[EXPIRY]\x20Payment\x20','checkExpiredPayments','cointopay_status_check_error','Unknown\x20error','create','failed','\x20\x20\x20üìç\x20Source:\x20','description','coinToPay2Service','‚è∞\x20[DEBUG]\x20Scheduled\x20check\x20#','coinToPayService','has','text','webhookLog','\x20days\x20without\x20payment\x20confirmation','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','COINTOPAY_STATUS_CHANGE','\x20amounts\x20calculated:','401020fbyXid','../types/gateway','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','sendPaymentNotification','\x20current\x20status:\x20','delete','\x20in\x20','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','\x20skipped,\x20','clearPaymentTimers','currentPayments','findUnique','\x20\x20\x20-\x20gatewayPaymentId:\x20','payment','üí∞\x20[CHECK]\x20Payment\x20','update','‚úÖ\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','Webhook\x20event\x20','‚ùå\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','log','\x20\x20\x20-\x20GatewayPaymentId:\x20','‚ùå\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','cointopay_status_check_','Gateway\x20','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','message','ü™ô\x20[TIMER]\x20Individual\x20check\x20#','‚úÖ\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)',',\x20using\x20default\x2010%','toISOString','values','checkSinglePayment','548901RxIdhv','webhookUrl','error','\x20status\x20unchanged\x20(','ü™ô\x20[DEBUG]\x20Creating\x20','\x20updated:\x20currentPayments=','timestamp','\x20is\x20too\x20new\x20(','‚ùå\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','expired','GLOBAL_CHECK_INTERVAL_MS','\x20status\x20changed\x20to\x20','gatewaySettings','createdAt','created','timers','checkAllPendingPayments','\x20status:\x20','forEach','sendShopWebhook','Payment\x20not\x20found','webhookEvents','\x20not\x20found,\x20clearing\x20timers','paid','application/json','üìä\x20[CHECK]\x20CoinToPay2\x20payment\x20','paidAt','__importDefault','currency','\x20completed\x20for\x20payment\x20','\x20\x20\x20üìä\x20Status:\x20','status','setDate','floor','-day\x20timeout','üîÑ\x20[CHECK]\x20Updating\x20payment\x20','Failed\x20to\x20mark\x20payment\x20as\x20expired','\x20USDT','\x20\x20\x20-\x20ShopId:\x20','\x20initial\x20timers\x20for\x20payment\x20','\x20days\x20(created\x20before\x20','coinToPayStatusService','\x20\x20\x20Amount\x20after\x20commission:\x20','1\x20minute','\x20payment\x20','amount','\x20seconds\x20(','‚ö†Ô∏è\x20[CHECK]\x20Payment\x20','getGatewayCommission','paymentTimers','auto_expire','parse','\x20to\x20','üõë\x20[SHUTDOWN]\x20Cleared\x20','üõë\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','‚ùå\x20[CHECK]\x20Payment\x20','type','checkSinglePaymentById','\x20\x20\x20üìÖ\x20Time:\x20','from','‚úÖ\x20[DEBUG]\x20Successfully\x20scheduled\x20','default','ü™ô\x20[ERROR]\x20CoinToPay\x20Error:\x20','customerName','Payment\x20older\x20than\x20','transactionId','/status/','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','111640VYjDcE','gatewayPaymentId','\x20->\x20','EXPIRY_DAYS','./currencyService','length','logShopWebhookError','schedule_created','not\x20found','7361pBgHQI','unknown','‚úÖ\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','__esModule','Failed\x20to\x20send\x20shop\x20webhook:','\x20\x20\x20Amount:\x20','ü™ô\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','üîç\x20[CHECK]\x20Checking\x20','getServiceStats','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','iban','No\x20specific\x20commission\x20found\x20for\x20gateway\x20',':\x20type=','ms)','\x20status\x20from\x20','adminNotes','‚è∞\x20[GLOBAL]\x20Payment\x20','bankDetails','loggerService','getGatewayIdByName','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','203589mCINyM','8gVfLzX','paymentLink','remitterIban','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','now','\x20\x20\x20-\x20Gateway:\x20','COINTOPAY_ERROR','shopId','./gateways/coinToPay2Service','1429016OkoQJC','paymentLinkId','PAID','\x20with\x20status\x20','status_check','checkPaymentStatus','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','üîç\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','payment.failed','14lTaZCP','logWhiteDomainError','Automatically\x20expired\x20after\x20','üßπ\x20[DEBUG]\x20Cleared\x20timer\x20#','confirmedOn','1050660XjAmkj','\x20\x20\x20-\x20paymentId:\x20','logCoinToPayStatus','\x20(age:\x20','‚è∞\x20[HOURLY]\x20Payment\x20'];a42_0x246b=function(){return _0x51f52c;};return a42_0x246b();}