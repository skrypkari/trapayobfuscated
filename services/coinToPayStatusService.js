'use strict';const a40_0x6081c4=a40_0x113a;(function(_0x88a410,_0x4aaa56){const _0x1f05d4=a40_0x113a,_0x67fc61=_0x88a410();while(!![]){try{const _0x365ddb=parseInt(_0x1f05d4(0x24a))/0x1+-parseInt(_0x1f05d4(0x156))/0x2+parseInt(_0x1f05d4(0x176))/0x3+-parseInt(_0x1f05d4(0x21b))/0x4+-parseInt(_0x1f05d4(0x1a8))/0x5+parseInt(_0x1f05d4(0x1e0))/0x6+-parseInt(_0x1f05d4(0x251))/0x7;if(_0x365ddb===_0x4aaa56)break;else _0x67fc61['push'](_0x67fc61['shift']());}catch(_0x31d563){_0x67fc61['push'](_0x67fc61['shift']());}}}(a40_0x1283,0x5fcce));function a40_0x113a(_0x1d5054,_0x26c7a1){const _0x12831e=a40_0x1283();return a40_0x113a=function(_0x113a42,_0x3a7fc9){_0x113a42=_0x113a42-0x150;let _0x356cfb=_0x12831e[_0x113a42];return _0x356cfb;},a40_0x113a(_0x1d5054,_0x26c7a1);}var __importDefault=this&&this[a40_0x6081c4(0x216)]||function(_0x376e6b){return _0x376e6b&&_0x376e6b['__esModule']?_0x376e6b:{'default':_0x376e6b};};function a40_0x1283(){const _0x5b2b4b=['🆔\x20[CHECK]\x20Transaction\x20ID:\x20','❌\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','\x20(after\x20','payment.success','checkPaymentById','../config/database','timestamp','\x20status\x20is\x20','❌\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','⏰\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','coinToPayStatusService','COMPLETED','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','❌\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','stringify','\x20updated:\x20currentPayments=','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','failed','3797430nEmYuy','🔍\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','loggerService','stack',',\x20stopping\x20individual\x20checks','✅\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','orderId','size','\x20(age:\x20','delay','forEach','.\x20Remaining\x20active\x20timers:\x20','error','📊\x20[HOURLY]\x20Payment\x20','createdAt','checkSinglePaymentById','gatewayCommissionRate','checkExpiredPayments','🪙\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','./telegramBotService','\x20skipped,\x20','\x20\x20\x20Gateway\x20','EXPIRY_DAYS','payment','amount','PENDING','\x20timers\x20for\x20payment\x20','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','⏰\x20[HOURLY]\x20Payment\x20','webhook_send','toLowerCase','Payment\x20System/1.0','has','🪙\x20[DEBUG]\x20Creating\x20','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','transactionId','checkPaymentStatus','💰\x20[CHECK]\x20Payment\x20','created','globalCheckInterval','🪙\x20[TIMER]\x20Individual\x20check\x20#','✅\x20[CHECK]\x20Payment\x20','getGatewayCommission','./currencyService','setDate','\x20days\x20(created\x20before\x20','getPaymentTimerInfo','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','\x20amounts\x20calculated:','❌\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','sendShopWebhook','Automatically\x20expired\x20after\x20','GLOBAL_CHECK_INTERVAL_MS',':\x20type=','__importDefault','application/json','\x20in\x20','currencyService','convertToUSDT','200900YXADhY','telegramBotService','5\x20minutes','✅\x20[HOURLY]\x20Payment\x20','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','floor','startPeriodicStatusCheck','\x20\x20\x20Amount\x20after\x20commission:\x20','getDate','📈\x20[COINTOPAY]\x20Payment\x20','getTime','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','⏰\x20[DEBUG]\x20Scheduled\x20check\x20#','Bank\x20Details:\x20','timers','🪙\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','checkSinglePayment','confirmedOn','schedule_created','get','status_check','default','findMany','\x20pending\x20CoinToPay\x20payments','createdOn','webhookEvents','🪙\x20[ERROR]\x20CoinToPay\x20Error:\x20','\x20is\x20older\x20than\x20','✅\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','\x20commission:\x20','\x20is\x20too\x20new\x20(','cointopay_status_check_error','CoinToPayService','logCoinToPayStatus','settings','/status/','\x20found:','gatewaySettings','\x20has\x20no\x20gatewayPaymentId,\x20skipping','paymentId','gateway','⏰\x20[GLOBAL]\x20Found\x20','status','paymentTimers','\x20in\x20shop\x20','\x20days','webhookUrl','583297stjXqf','includes','push','\x20\x20\x20-\x20GatewayPaymentId:\x20','../types/gateway','🧹\x20[CHECK]\x20Payment\x20','./gateways/coinToPayService','2268903cXORat','from','🏦\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes','\x20with\x20status\x20','set','FAILED','\x20not\x20enabled\x20for\x20shop\x20','amountAfterGatewayCommissionUSDT','🪙\x20[GLOBAL]\x20Found\x20','cointopay','\x20->\x20','Success','702028aUovtR','toISOString','\x20\x20\x20📍\x20Source:\x20','✅\x20[DEBUG]\x20Successfully\x20scheduled\x20','COINTOPAY_STATUS_CHANGE','\x20\x20\x20❌\x20Error:\x20','\x20commission\x20for\x20shop\x20','toFixed','\x20USDT','❌\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','\x20days,\x20marking\x20as\x20EXPIRED','\x20has\x20no\x20gatewayPaymentId','./loggerService','findUnique','coinToPay2Service','log','checkAllPendingPayments','📊\x20[CHECK]\x20Payment\x20','\x20individual\x20payment\x20timers','sendPaymentStatusNotification','\x20initial\x20timers\x20for\x20payment\x20','\x20\x20\x20📅\x20Time:\x20','cointopay_status_check_','schedulePaymentChecks','CoinToPay2Service','⏰\x20[GLOBAL]\x20Payment\x20','\x20\x20\x20-\x20Status:\x20','not\x20confirmed','POST','\x20completed\x20for\x20payment\x20','✅\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','currentPayments','350358hkfKdy','\x20current\x20status:\x20','paymentLink','\x20status\x20changed\x20to\x20','Payment\x20older\x20than\x20','EXPIRED','paidAt','✅\x20[COINTOPAY]\x20Payment\x20link\x20','payment.failed','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','getGatewayIdByName','logShopWebhookError','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','h),\x20skipping\x20global\x20check','logCoinToPayError','PAID','\x20\x20\x20-\x20Gateway:\x20','cointopay2','clearPaymentTimers','parse','🔄\x20[CHECK]\x20Updating\x20payment\x20','CoinToPayStatusService','Shop\x20webhook\x20sent\x20to\x20','currency','📊\x20[CHECK]\x20CoinToPay\x20payment\x20','length','❌\x20[TIMER]\x20Failed\x20individual\x20check\x20#','🧹\x20[DEBUG]\x20Cleared\x20timer\x20#','\x20status\x20from\x20','\x20days\x20without\x20payment\x20confirmation','🔍\x20[CHECK]\x20Checking\x20','shopId','📊\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20',',\x20using\x20default\x2010%','create','❌\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','map','\x20\x20\x20📊\x20Status:\x20','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','🧹\x20[DEBUG]\x20Clearing\x20','🪙\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','\x20status:\x20','description','\x20status\x20unchanged\x20(','iban','now','🪙\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','🪙\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','\x20\x20\x20📝\x20Details:','🔍\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','1076110kIukdv','🏦\x20[CHECK]\x20Saved\x20IBAN:\x20','\x20to\x20','⚠️\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','coinToPayService','\x20for\x20payment\x20','values','unknown','\x20payment\x20','customerEmail','🪙\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','\x20updated\x20successfully','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','gatewayPaymentId','message','__esModule','Webhook\x20event\x20','webhookLog','🪙\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','update','adminNotes','🛑\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','shop','⚠️\x20[CHECK]\x20Payment\x20','type','🔍\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','\x20is\x20valid\x20for\x20checking,\x20proceeding...','auto_expire','\x20checked,\x20','paymentDetails','❌\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','amountUSDT','bankDetails','\x20expired\x20CoinToPay\x20payments','cointopay_auto_expired',',\x20currentPayments=','🛑\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','remitterIban'];a40_0x1283=function(){return _0x5b2b4b;};return a40_0x1283();}Object['defineProperty'](exports,a40_0x6081c4(0x1b7),{'value':!![]}),exports[a40_0x6081c4(0x1d8)]=exports[a40_0x6081c4(0x18b)]=void 0x0;const coinToPayService_1=require(a40_0x6081c4(0x250)),coinToPay2Service_1=require('./gateways/coinToPay2Service'),gateway_1=require(a40_0x6081c4(0x24e)),database_1=__importDefault(require(a40_0x6081c4(0x1d3))),telegramBotService_1=require(a40_0x6081c4(0x1f3)),loggerService_1=require(a40_0x6081c4(0x162)),currencyService_1=require(a40_0x6081c4(0x20b));class CoinToPayStatusService{constructor(){const _0x24a776=a40_0x6081c4;this[_0x24a776(0x207)]=null,this[_0x24a776(0x214)]=0x3c*0x3c*0x3e8,this['EXPIRY_DAYS']=0x5,this[_0x24a776(0x246)]=new Map(),this['coinToPayService']=new coinToPayService_1[(_0x24a776(0x23b))](),this[_0x24a776(0x164)]=new coinToPay2Service_1[(_0x24a776(0x16e))](),console[_0x24a776(0x165)]('🪙\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2');}[a40_0x6081c4(0x16d)](_0x5c606e,_0x45010e){const _0x2742d2=a40_0x6081c4;console[_0x2742d2(0x165)](_0x2742d2(0x19e)),console[_0x2742d2(0x165)]('\x20\x20\x20-\x20paymentId:\x20'+_0x5c606e),console['log']('\x20\x20\x20-\x20gatewayPaymentId:\x20'+_0x45010e),this[_0x2742d2(0x188)](_0x5c606e);const _0x4c74d7=[],_0x59fe5a=new Date(),_0x383b0c=[{'delay':0x1*0x3c*0x3e8,'description':'1\x20minute'},{'delay':0x2*0x3c*0x3e8,'description':'2\x20minutes'},{'delay':0x5*0x3c*0x3e8,'description':_0x2742d2(0x21d)},{'delay':0x5*0x3c*0x3e8,'description':_0x2742d2(0x21d)}];console[_0x2742d2(0x165)](_0x2742d2(0x201)+_0x383b0c[_0x2742d2(0x18f)]+_0x2742d2(0x16a)+_0x5c606e);let _0x416b15=0x0;_0x383b0c[_0x2742d2(0x1ea)]((_0x543657,_0x34d967)=>{const _0xd4a13f=_0x2742d2;_0x416b15+=_0x543657[_0xd4a13f(0x1e9)];const _0x20f518=setTimeout(async()=>{const _0x188724=_0xd4a13f;console[_0x188724(0x165)](_0x188724(0x208)+(_0x34d967+0x1)+'\x20triggered\x20for\x20payment\x20'+_0x5c606e+_0x188724(0x1d0)+_0x543657['description']+')');try{await this[_0x188724(0x1ef)](_0x5c606e),console[_0x188724(0x165)]('✅\x20[TIMER]\x20Individual\x20check\x20#'+(_0x34d967+0x1)+_0x188724(0x173)+_0x5c606e);}catch(_0x1d2f8a){console[_0x188724(0x1ec)](_0x188724(0x190)+(_0x34d967+0x1)+_0x188724(0x1ad)+_0x5c606e+':',_0x1d2f8a),this[_0x188724(0x184)](_0x5c606e,_0x45010e,_0x1d2f8a,'status_check',{'checkNumber':_0x34d967+0x1,'scheduledAfter':_0x543657[_0x188724(0x1a0)],'isIndividualCheck':!![]});}},_0x416b15);_0x4c74d7[_0xd4a13f(0x24c)](_0x20f518),console[_0xd4a13f(0x165)](_0xd4a13f(0x227)+(_0x34d967+0x1)+_0xd4a13f(0x1ad)+_0x5c606e+_0xd4a13f(0x218)+_0x416b15/0x3e8+'\x20seconds\x20('+_0x543657[_0xd4a13f(0x1a0)]+')');});const _0x26709b=setInterval(async()=>{const _0x3f0b7a=_0x2742d2;console[_0x3f0b7a(0x165)](_0x3f0b7a(0x22a)+_0x5c606e);try{const _0x1d4e5d=await database_1['default']['payment']['findUnique']({'where':{'id':_0x5c606e},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x1d4e5d){console[_0x3f0b7a(0x165)]('❌\x20[HOURLY]\x20Payment\x20'+_0x5c606e+'\x20not\x20found,\x20clearing\x20timers'),this[_0x3f0b7a(0x188)](_0x5c606e);return;}console[_0x3f0b7a(0x165)](_0x3f0b7a(0x1ed)+_0x5c606e+_0x3f0b7a(0x177)+_0x1d4e5d[_0x3f0b7a(0x245)]);if(_0x1d4e5d[_0x3f0b7a(0x245)]!==_0x3f0b7a(0x1f9)){console[_0x3f0b7a(0x165)](_0x3f0b7a(0x21e)+_0x5c606e+_0x3f0b7a(0x1d5)+_0x1d4e5d[_0x3f0b7a(0x245)]+',\x20stopping\x20individual\x20checks'),this[_0x3f0b7a(0x188)](_0x5c606e);return;}const _0x9deb68=Math['floor']((Date[_0x3f0b7a(0x1a3)]()-_0x1d4e5d[_0x3f0b7a(0x1ee)]['getTime']())/(0x3e8*0x3c*0x3c*0x18));if(_0x9deb68>=this[_0x3f0b7a(0x1f6)]){console[_0x3f0b7a(0x165)](_0x3f0b7a(0x1fc)+_0x5c606e+_0x3f0b7a(0x236)+this[_0x3f0b7a(0x1f6)]+_0x3f0b7a(0x20f)),this['clearPaymentTimers'](_0x5c606e);return;}await this[_0x3f0b7a(0x1ef)](_0x5c606e),console[_0x3f0b7a(0x165)](_0x3f0b7a(0x174)+_0x5c606e);}catch(_0x175fc5){console['error'](_0x3f0b7a(0x15f)+_0x5c606e+':',_0x175fc5),this[_0x3f0b7a(0x184)](_0x5c606e,_0x45010e,_0x175fc5,_0x3f0b7a(0x22f),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x4c74d7[_0x2742d2(0x24c)](_0x26709b),this[_0x2742d2(0x246)][_0x2742d2(0x255)](_0x5c606e,{'timers':_0x4c74d7,'paymentId':_0x5c606e,'gatewayPaymentId':_0x45010e,'createdAt':_0x59fe5a}),console[_0x2742d2(0x165)](_0x2742d2(0x159)+_0x383b0c[_0x2742d2(0x18f)]+_0x2742d2(0x1de)+_0x5c606e),console[_0x2742d2(0x165)](_0x2742d2(0x196)+this[_0x2742d2(0x246)][_0x2742d2(0x1e7)]),this['logCoinToPayStatus'](_0x5c606e,_0x45010e,_0x2742d2(0x1f9),'PENDING','status_check',{'action':_0x2742d2(0x22d),'scheduledChecks':_0x383b0c[_0x2742d2(0x18f)],'firstCheckIn':_0x383b0c[0x0]['delay']/0x3e8,'totalTimers':this[_0x2742d2(0x246)]['size']});}[a40_0x6081c4(0x188)](_0x58ca35){const _0x301dce=a40_0x6081c4,_0x432eca=this['paymentTimers'][_0x301dce(0x22e)](_0x58ca35);_0x432eca?(console[_0x301dce(0x165)](_0x301dce(0x19d)+_0x432eca[_0x301dce(0x229)][_0x301dce(0x18f)]+_0x301dce(0x1fa)+_0x58ca35),_0x432eca[_0x301dce(0x229)][_0x301dce(0x1ea)]((_0xb8665b,_0x339f20)=>{const _0x7eb4e7=_0x301dce;_0xb8665b&&(clearTimeout(_0xb8665b),clearInterval(_0xb8665b),console[_0x7eb4e7(0x165)](_0x7eb4e7(0x191)+(_0x339f20+0x1)+_0x7eb4e7(0x1ad)+_0x58ca35));}),this[_0x301dce(0x246)]['delete'](_0x58ca35),console[_0x301dce(0x165)](_0x301dce(0x237)+_0x58ca35+_0x301dce(0x1eb)+this[_0x301dce(0x246)][_0x301dce(0x1e7)])):console[_0x301dce(0x165)](_0x301dce(0x1ab)+_0x58ca35+'\x20to\x20clear');}async[a40_0x6081c4(0x1ef)](_0x43502d){const _0x441a40=a40_0x6081c4;console['log'](_0x441a40(0x1a7)+_0x43502d);const _0x5e1dab=await database_1[_0x441a40(0x230)][_0x441a40(0x1f7)]['findUnique']({'where':{'id':_0x43502d},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x5e1dab){console[_0x441a40(0x165)]('❌\x20[CHECK]\x20Payment\x20'+_0x43502d+'\x20not\x20found\x20in\x20database');return;}console[_0x441a40(0x165)](_0x441a40(0x167)+_0x43502d+_0x441a40(0x23f)),console['log'](_0x441a40(0x186)+_0x5e1dab[_0x441a40(0x243)]),console[_0x441a40(0x165)](_0x441a40(0x170)+_0x5e1dab['status']),console[_0x441a40(0x165)](_0x441a40(0x24d)+_0x5e1dab['gatewayPaymentId']),console['log']('\x20\x20\x20-\x20Amount:\x20'+_0x5e1dab['amount']+'\x20'+_0x5e1dab[_0x441a40(0x18d)]),console[_0x441a40(0x165)]('\x20\x20\x20-\x20ShopId:\x20'+_0x5e1dab['shopId']);if(_0x5e1dab[_0x441a40(0x243)]!==_0x441a40(0x153)&&_0x5e1dab['gateway']!==_0x441a40(0x187)){console['log']('⚠️\x20[CHECK]\x20Payment\x20'+_0x43502d+_0x441a40(0x1fb)+_0x5e1dab[_0x441a40(0x243)]+')');return;}if(_0x5e1dab['status']!==_0x441a40(0x1f9)){console[_0x441a40(0x165)](_0x441a40(0x1bf)+_0x43502d+_0x441a40(0x1d5)+_0x5e1dab[_0x441a40(0x245)]+_0x441a40(0x1e4)),this[_0x441a40(0x188)](_0x43502d);return;}if(!_0x5e1dab[_0x441a40(0x1b5)]){console[_0x441a40(0x165)]('⚠️\x20[CHECK]\x20Payment\x20'+_0x43502d+_0x441a40(0x161));return;}console[_0x441a40(0x165)](_0x441a40(0x209)+_0x43502d+_0x441a40(0x1c2)),await this[_0x441a40(0x22b)](_0x5e1dab);}[a40_0x6081c4(0x23c)](_0x38a0de,_0x26daff,_0x461191,_0x252073,_0x3a1966,_0x5821cf){const _0x4ccc2e=a40_0x6081c4,_0x5e129b={'type':_0x4ccc2e(0x15a),'paymentId':_0x38a0de,'gatewayPaymentId':_0x26daff,'oldStatus':_0x461191,'newStatus':_0x252073,'source':_0x3a1966,'timestamp':new Date()[_0x4ccc2e(0x157)](),'details':_0x5821cf||{}};loggerService_1['loggerService']['logCoinToPayStatus'](_0x5e129b),console[_0x4ccc2e(0x165)](_0x4ccc2e(0x1f2)+_0x38a0de+'\x20('+_0x26daff+')'),console[_0x4ccc2e(0x165)](_0x4ccc2e(0x19b)+_0x461191+'\x20->\x20'+_0x252073),console['log'](_0x4ccc2e(0x158)+_0x3a1966),console['log'](_0x4ccc2e(0x16b)+_0x5e129b['timestamp']),_0x5821cf&&console[_0x4ccc2e(0x165)](_0x4ccc2e(0x1a6),_0x5821cf);}[a40_0x6081c4(0x184)](_0x3a9db7,_0x5b8da8,_0x2328db,_0x16a441,_0x3ec156){const _0x41c0af=a40_0x6081c4,_0x3b047b={'type':'COINTOPAY_ERROR','paymentId':_0x3a9db7,'gatewayPaymentId':_0x5b8da8,'error':_0x2328db instanceof Error?{'message':_0x2328db[_0x41c0af(0x1b6)],'stack':_0x2328db[_0x41c0af(0x1e3)]}:_0x2328db,'source':_0x16a441,'timestamp':new Date()['toISOString'](),'context':_0x3ec156||{}};loggerService_1[_0x41c0af(0x1e2)]['logCoinToPayError'](_0x3b047b),console[_0x41c0af(0x1ec)](_0x41c0af(0x235)+_0x3a9db7+'\x20('+_0x5b8da8+')'),console['error'](_0x41c0af(0x15b)+(_0x2328db instanceof Error?_0x2328db[_0x41c0af(0x1b6)]:_0x2328db)),console['error'](_0x41c0af(0x158)+_0x16a441),console[_0x41c0af(0x1ec)]('\x20\x20\x20📅\x20Time:\x20'+_0x3b047b[_0x41c0af(0x1d4)]),_0x3ec156&&console[_0x41c0af(0x1ec)]('\x20\x20\x20📝\x20Context:',_0x3ec156);}[a40_0x6081c4(0x221)](){const _0x293285=a40_0x6081c4;console[_0x293285(0x165)](_0x293285(0x1a4)),this['checkAllPendingPayments']()['catch'](_0x4d4f9c=>{const _0x1ccf05=_0x293285;console['error'](_0x1ccf05(0x199),_0x4d4f9c);}),this['globalCheckInterval']=setInterval(async()=>{const _0x267ee8=_0x293285;try{console[_0x267ee8(0x165)](_0x267ee8(0x1b2)),await this[_0x267ee8(0x166)](),console[_0x267ee8(0x165)](_0x267ee8(0x1e5));}catch(_0x3a4202){console['error'](_0x267ee8(0x1d6),_0x3a4202);}},this[_0x293285(0x214)]),console[_0x293285(0x165)]('✅\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)');}['stopPeriodicStatusCheck'](){const _0x4a5cda=a40_0x6081c4;console['log'](_0x4a5cda(0x1cc));this['globalCheckInterval']&&(clearInterval(this[_0x4a5cda(0x207)]),this[_0x4a5cda(0x207)]=null,console[_0x4a5cda(0x165)](_0x4a5cda(0x1bd)));const _0x4a34f8=this[_0x4a5cda(0x246)][_0x4a5cda(0x1e7)];for(const [_0x20ab2f]of this[_0x4a5cda(0x246)]){this[_0x4a5cda(0x188)](_0x20ab2f);}console['log']('🛑\x20[SHUTDOWN]\x20Cleared\x20'+_0x4a34f8+_0x4a5cda(0x168));}async['checkAllPendingPayments'](){const _0x12ef59=a40_0x6081c4;try{console['log'](_0x12ef59(0x1ba));const _0x532d2b=await database_1[_0x12ef59(0x230)]['payment'][_0x12ef59(0x231)]({'where':{'gateway':{'in':['cointopay','cointopay2']},'status':_0x12ef59(0x1f9),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x12ef59(0x165)](_0x12ef59(0x152)+_0x532d2b['length']+_0x12ef59(0x232));if(_0x532d2b[_0x12ef59(0x18f)]===0x0){console[_0x12ef59(0x165)](_0x12ef59(0x1a5));return;}const _0x38ea2c=await this['checkExpiredPayments'](_0x532d2b);console[_0x12ef59(0x165)](_0x12ef59(0x244)+_0x38ea2c['length']+_0x12ef59(0x1c9));let _0x52e554=0x0,_0x480cb3=0x0;for(const _0x44c7a0 of _0x532d2b){try{if(_0x38ea2c[_0x12ef59(0x24b)](_0x44c7a0['id'])){console['log'](_0x12ef59(0x16f)+_0x44c7a0['id']+_0x12ef59(0x17f)),_0x480cb3++;continue;}if(this['paymentTimers'][_0x12ef59(0x200)](_0x44c7a0['id'])){console[_0x12ef59(0x165)]('⏰\x20[GLOBAL]\x20Payment\x20'+_0x44c7a0['id']+_0x12ef59(0x1b4)),_0x480cb3++;continue;}const _0x580d18=(Date[_0x12ef59(0x1a3)]()-_0x44c7a0[_0x12ef59(0x1ee)][_0x12ef59(0x225)]())/(0x3e8*0x3c*0x3c);if(_0x580d18<0x1){console['log']('⏰\x20[GLOBAL]\x20Payment\x20'+_0x44c7a0['id']+_0x12ef59(0x239)+_0x580d18[_0x12ef59(0x15d)](0x1)+_0x12ef59(0x183)),_0x480cb3++;continue;}console['log'](_0x12ef59(0x1c1)+_0x44c7a0['id']+_0x12ef59(0x1e8)+_0x580d18['toFixed'](0x1)+'h)'),await this[_0x12ef59(0x22b)](_0x44c7a0),_0x52e554++,await new Promise(_0x3fcd3f=>setTimeout(_0x3fcd3f,0x7d0));}catch(_0x1de022){console[_0x12ef59(0x1ec)]('❌\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20'+_0x44c7a0['id']+':',_0x1de022),this[_0x12ef59(0x184)](_0x44c7a0['id'],_0x44c7a0['gatewayPaymentId']||'unknown',_0x1de022,'status_check',{'isGlobalCheck':!![],'paymentAmount':_0x44c7a0['amount'],'paymentCurrency':_0x44c7a0[_0x12ef59(0x18d)],'shopId':_0x44c7a0['shopId'],'createdAt':_0x44c7a0[_0x12ef59(0x1ee)]}),loggerService_1['loggerService']['logWhiteDomainError'](_0x12ef59(0x153),_0x12ef59(0x23e)+_0x44c7a0[_0x12ef59(0x1b5)],_0x1de022);}}console[_0x12ef59(0x165)]('✅\x20[GLOBAL]\x20Global\x20check\x20completed:\x20'+_0x52e554+_0x12ef59(0x1c4)+_0x480cb3+_0x12ef59(0x1f4)+_0x38ea2c[_0x12ef59(0x18f)]+'\x20expired');}catch(_0x5cb436){console[_0x12ef59(0x1ec)](_0x12ef59(0x1c6),_0x5cb436);}}async[a40_0x6081c4(0x1f1)](_0x4e3d4a){const _0xc7f725=a40_0x6081c4,_0x2c95e7=[],_0x1bf03f=new Date();_0x1bf03f[_0xc7f725(0x20c)](_0x1bf03f[_0xc7f725(0x223)]()-this[_0xc7f725(0x1f6)]),console['log'](_0xc7f725(0x1d7)+this[_0xc7f725(0x1f6)]+_0xc7f725(0x20d)+_0x1bf03f[_0xc7f725(0x157)]()+')');for(const _0x543a0 of _0x4e3d4a){if(_0x543a0[_0xc7f725(0x1ee)]<_0x1bf03f){console[_0xc7f725(0x165)]('⏰\x20[EXPIRY]\x20Payment\x20'+_0x543a0['id']+_0xc7f725(0x236)+this['EXPIRY_DAYS']+_0xc7f725(0x160));try{this['logCoinToPayStatus'](_0x543a0['id'],_0x543a0[_0xc7f725(0x1b5)]||'unknown',_0xc7f725(0x1f9),'EXPIRED',_0xc7f725(0x1c3),{'reason':'Payment\x20older\x20than\x20'+this[_0xc7f725(0x1f6)]+_0xc7f725(0x248),'createdAt':_0x543a0[_0xc7f725(0x1ee)],'daysSinceCreation':Math[_0xc7f725(0x220)]((Date[_0xc7f725(0x1a3)]()-_0x543a0[_0xc7f725(0x1ee)][_0xc7f725(0x225)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x543a0[_0xc7f725(0x1f8)],'paymentCurrency':_0x543a0[_0xc7f725(0x18d)],'shopId':_0x543a0[_0xc7f725(0x195)]}),await database_1[_0xc7f725(0x230)]['payment'][_0xc7f725(0x1bb)]({'where':{'id':_0x543a0['id']},'data':{'status':_0xc7f725(0x17b),'updatedAt':new Date(),'adminNotes':_0xc7f725(0x213)+this[_0xc7f725(0x1f6)]+_0xc7f725(0x193)}}),await database_1[_0xc7f725(0x230)][_0xc7f725(0x1b9)][_0xc7f725(0x198)]({'data':{'paymentId':_0x543a0['id'],'shopId':_0x543a0[_0xc7f725(0x195)],'event':_0xc7f725(0x1ca),'statusCode':0xc8,'responseBody':JSON[_0xc7f725(0x1dc)]({'reason':_0xc7f725(0x17a)+this['EXPIRY_DAYS']+_0xc7f725(0x248),'createdAt':_0x543a0[_0xc7f725(0x1ee)],'expiredAt':new Date()['toISOString'](),'daysSinceCreation':Math['floor']((Date[_0xc7f725(0x1a3)]()-_0x543a0[_0xc7f725(0x1ee)][_0xc7f725(0x225)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0xc7f725(0x212)](_0x543a0,'EXPIRED'),await this[_0xc7f725(0x169)](_0x543a0,'EXPIRED'),this['clearPaymentTimers'](_0x543a0['id']),_0x2c95e7[_0xc7f725(0x24c)](_0x543a0['id']),console[_0xc7f725(0x165)]('✅\x20[EXPIRY]\x20Payment\x20'+_0x543a0['id']+'\x20marked\x20as\x20EXPIRED\x20due\x20to\x20'+this[_0xc7f725(0x1f6)]+'-day\x20timeout');}catch(_0x2f0f01){console['error'](_0xc7f725(0x211)+_0x543a0['id']+':',_0x2f0f01),this[_0xc7f725(0x184)](_0x543a0['id'],_0x543a0[_0xc7f725(0x1b5)]||_0xc7f725(0x1af),_0x2f0f01,_0xc7f725(0x1c3),{'reason':'Failed\x20to\x20mark\x20payment\x20as\x20expired','createdAt':_0x543a0[_0xc7f725(0x1ee)],'daysSinceCreation':Math[_0xc7f725(0x220)]((Date[_0xc7f725(0x1a3)]()-_0x543a0['createdAt']['getTime']())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x2c95e7;}async[a40_0x6081c4(0x22b)](_0xb7d52c){const _0x4d5db8=a40_0x6081c4;if(!_0xb7d52c[_0x4d5db8(0x1b5)]){console[_0x4d5db8(0x165)](_0x4d5db8(0x1bf)+_0xb7d52c['id']+_0x4d5db8(0x241));return;}console['log'](_0x4d5db8(0x194)+_0xb7d52c[_0x4d5db8(0x243)]+_0x4d5db8(0x1b0)+_0xb7d52c['id']+'\x20('+_0xb7d52c['gatewayPaymentId']+')');try{let _0x2a36bb;_0xb7d52c[_0x4d5db8(0x243)]==='cointopay2'?(_0x2a36bb=await this[_0x4d5db8(0x164)][_0x4d5db8(0x204)](_0xb7d52c[_0x4d5db8(0x1b5)]),console['log']('📊\x20[CHECK]\x20CoinToPay2\x20payment\x20'+_0xb7d52c['id']+_0x4d5db8(0x19f)+_0x2a36bb[_0x4d5db8(0x245)])):(_0x2a36bb=await this[_0x4d5db8(0x1ac)]['checkPaymentStatus'](_0xb7d52c[_0x4d5db8(0x1b5)]),console[_0x4d5db8(0x165)](_0x4d5db8(0x18e)+_0xb7d52c['id']+'\x20status:\x20'+_0x2a36bb['status']));_0x2a36bb[_0x4d5db8(0x1c5)]&&console[_0x4d5db8(0x165)](_0x4d5db8(0x167)+_0xb7d52c['id']+'\x20details:',{'iban':_0x2a36bb[_0x4d5db8(0x1c5)][_0x4d5db8(0x1a2)]||'not\x20found','transactionId':_0x2a36bb['paymentDetails']['transactionId'],'createdOn':_0x2a36bb[_0x4d5db8(0x1c5)][_0x4d5db8(0x233)],'confirmedOn':_0x2a36bb[_0x4d5db8(0x1c5)][_0x4d5db8(0x22c)]||_0x4d5db8(0x171)});if(_0x2a36bb[_0x4d5db8(0x245)]!==_0xb7d52c[_0x4d5db8(0x245)]){console['log'](_0x4d5db8(0x18a)+_0xb7d52c['id']+_0x4d5db8(0x192)+_0xb7d52c['status']+_0x4d5db8(0x1aa)+_0x2a36bb['status']),this[_0x4d5db8(0x23c)](_0xb7d52c['id'],_0xb7d52c[_0x4d5db8(0x1b5)],_0xb7d52c['status'],_0x2a36bb[_0x4d5db8(0x245)],'status_check',{'paymentDetails':_0x2a36bb['paymentDetails'],'amount':_0x2a36bb[_0x4d5db8(0x1f8)],'currency':_0x2a36bb[_0x4d5db8(0x18d)],'shopId':_0xb7d52c[_0x4d5db8(0x195)],'checkTimestamp':new Date()[_0x4d5db8(0x157)]()});const _0x4d9b14={'status':_0x2a36bb['status'],'updatedAt':new Date()};if(_0x2a36bb[_0x4d5db8(0x245)]===_0x4d5db8(0x185)&&_0xb7d52c[_0x4d5db8(0x245)]!==_0x4d5db8(0x185)){_0x4d9b14[_0x4d5db8(0x17c)]=new Date();if(!_0xb7d52c[_0x4d5db8(0x1c7)]){const _0x2fc37c=await currencyService_1[_0x4d5db8(0x219)][_0x4d5db8(0x21a)](_0xb7d52c[_0x4d5db8(0x1f8)],_0xb7d52c[_0x4d5db8(0x18d)]);_0x4d9b14[_0x4d5db8(0x1c7)]=_0x2fc37c;const _0x56a096=await this[_0x4d5db8(0x20a)](_0xb7d52c[_0x4d5db8(0x195)],_0xb7d52c[_0x4d5db8(0x243)]),_0xc036a0=_0x2fc37c*(0x1-_0x56a096/0x64);_0x4d9b14[_0x4d5db8(0x151)]=_0xc036a0,_0x4d9b14[_0x4d5db8(0x1f0)]=_0x56a096,console[_0x4d5db8(0x165)](_0x4d5db8(0x205)+_0xb7d52c['id']+_0x4d5db8(0x210)),console[_0x4d5db8(0x165)]('\x20\x20\x20Amount:\x20'+_0xb7d52c[_0x4d5db8(0x1f8)]+'\x20'+_0xb7d52c[_0x4d5db8(0x18d)]+_0x4d5db8(0x154)+_0x2fc37c['toFixed'](0x6)+_0x4d5db8(0x15e)),console[_0x4d5db8(0x165)](_0x4d5db8(0x1f5)+_0xb7d52c[_0x4d5db8(0x243)]+_0x4d5db8(0x238)+_0x56a096+'%'),console[_0x4d5db8(0x165)](_0x4d5db8(0x222)+_0xc036a0[_0x4d5db8(0x15d)](0x6)+_0x4d5db8(0x15e));}console['log'](_0x4d5db8(0x205)+_0xb7d52c['id']+'\x20marked\x20as\x20paid\x20at:\x20'+_0x4d9b14['paidAt']['toISOString']());}if(_0x2a36bb[_0x4d5db8(0x1c5)]){const _0x1f045f=_0x2a36bb[_0x4d5db8(0x1c5)];_0x1f045f[_0x4d5db8(0x1a2)]&&(_0x4d9b14[_0x4d5db8(0x1cd)]=_0x1f045f[_0x4d5db8(0x1a2)],console[_0x4d5db8(0x165)](_0x4d5db8(0x1a9)+_0x1f045f['iban']));if(_0x1f045f['bankDetails']){const _0xac4a7c=_0xb7d52c['adminNotes']||'',_0x39fbac=_0x4d5db8(0x228)+_0x1f045f[_0x4d5db8(0x1c8)];_0x4d9b14[_0x4d5db8(0x1bc)]=_0xac4a7c?_0xac4a7c+'\x0a\x0a'+_0x39fbac:_0x39fbac,console['log'](_0x4d5db8(0x253));}_0x1f045f[_0x4d5db8(0x203)]&&console['log'](_0x4d5db8(0x1ce)+_0x1f045f[_0x4d5db8(0x203)]),_0x1f045f['confirmedOn']&&console[_0x4d5db8(0x165)]('✅\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20'+_0x1f045f[_0x4d5db8(0x22c)]);}await database_1[_0x4d5db8(0x230)][_0x4d5db8(0x1f7)][_0x4d5db8(0x1bb)]({'where':{'id':_0xb7d52c['id']},'data':_0x4d9b14});if(_0x2a36bb[_0x4d5db8(0x245)]===_0x4d5db8(0x185)&&_0xb7d52c[_0x4d5db8(0x245)]!==_0x4d5db8(0x185)){console[_0x4d5db8(0x165)](_0x4d5db8(0x224)+_0xb7d52c['id']+_0x4d5db8(0x19c));const _0x1c00e6=await database_1[_0x4d5db8(0x230)]['payment'][_0x4d5db8(0x163)]({'where':{'id':_0xb7d52c['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x1c00e6?.['paymentLinkId']&&_0x1c00e6['paymentLink'])try{const _0x2aad04=_0x1c00e6[_0x4d5db8(0x178)];console[_0x4d5db8(0x165)]('📈\x20[COINTOPAY]\x20Found\x20payment\x20link\x20'+_0x2aad04['id']+_0x4d5db8(0x215)+_0x2aad04[_0x4d5db8(0x1c0)]+_0x4d5db8(0x1cb)+_0x2aad04[_0x4d5db8(0x175)]+',\x20status='+_0x2aad04['status']);const _0x37d47e=_0x2aad04[_0x4d5db8(0x175)]+0x1,_0xd309bd=_0x2aad04[_0x4d5db8(0x1c0)]==='SINGLE'?_0x4d5db8(0x1d9):_0x2aad04[_0x4d5db8(0x245)];await database_1[_0x4d5db8(0x230)]['paymentLink'][_0x4d5db8(0x1bb)]({'where':{'id':_0x2aad04['id']},'data':{'currentPayments':_0x37d47e,'status':_0xd309bd,'updatedAt':new Date()}}),console[_0x4d5db8(0x165)](_0x4d5db8(0x17d)+_0x2aad04['id']+_0x4d5db8(0x1dd)+_0x2aad04[_0x4d5db8(0x175)]+_0x4d5db8(0x154)+_0x37d47e+',\x20status='+_0x2aad04['status']+_0x4d5db8(0x154)+_0xd309bd);}catch(_0x2f4433){console[_0x4d5db8(0x1ec)](_0x4d5db8(0x1db),_0x2f4433);}else console[_0x4d5db8(0x165)]('📈\x20[COINTOPAY]\x20Payment\x20'+_0xb7d52c['id']+_0x4d5db8(0x182));}await database_1[_0x4d5db8(0x230)]['webhookLog'][_0x4d5db8(0x198)]({'data':{'paymentId':_0xb7d52c['id'],'shopId':_0xb7d52c[_0x4d5db8(0x195)],'event':_0x4d5db8(0x16c)+_0x2a36bb[_0x4d5db8(0x245)][_0x4d5db8(0x1fe)](),'statusCode':0xc8,'responseBody':JSON[_0x4d5db8(0x1dc)]({'oldStatus':_0xb7d52c[_0x4d5db8(0x245)],'newStatus':_0x2a36bb['status'],'paymentDetails':_0x2a36bb[_0x4d5db8(0x1c5)],'checkedAt':new Date()[_0x4d5db8(0x157)]()})}}),await this[_0x4d5db8(0x212)](_0xb7d52c,_0x2a36bb['status']),await this[_0x4d5db8(0x169)](_0xb7d52c,_0x2a36bb[_0x4d5db8(0x245)]),_0x2a36bb[_0x4d5db8(0x245)]!==_0x4d5db8(0x1f9)&&(console[_0x4d5db8(0x165)](_0x4d5db8(0x24f)+_0xb7d52c['id']+_0x4d5db8(0x179)+_0x2a36bb[_0x4d5db8(0x245)]+',\x20clearing\x20individual\x20timers'),this[_0x4d5db8(0x188)](_0xb7d52c['id'])),console[_0x4d5db8(0x165)](_0x4d5db8(0x209)+_0xb7d52c['id']+_0x4d5db8(0x1b3));}else console[_0x4d5db8(0x165)](_0x4d5db8(0x167)+_0xb7d52c['id']+_0x4d5db8(0x1a1)+_0x2a36bb[_0x4d5db8(0x245)]+')'),this[_0x4d5db8(0x23c)](_0xb7d52c['id'],_0xb7d52c[_0x4d5db8(0x1b5)],_0xb7d52c[_0x4d5db8(0x245)],_0x2a36bb[_0x4d5db8(0x245)],_0x4d5db8(0x22f),{'statusUnchanged':!![],'paymentDetails':_0x2a36bb[_0x4d5db8(0x1c5)],'amount':_0x2a36bb['amount'],'currency':_0x2a36bb['currency'],'shopId':_0xb7d52c[_0x4d5db8(0x195)],'checkTimestamp':new Date()[_0x4d5db8(0x157)]()});}catch(_0x3a2a92){console[_0x4d5db8(0x1ec)](_0x4d5db8(0x1cf)+_0xb7d52c['id']+':',_0x3a2a92),this[_0x4d5db8(0x184)](_0xb7d52c['id'],_0xb7d52c[_0x4d5db8(0x1b5)],_0x3a2a92,_0x4d5db8(0x22f),{'paymentAmount':_0xb7d52c[_0x4d5db8(0x1f8)],'paymentCurrency':_0xb7d52c[_0x4d5db8(0x18d)],'shopId':_0xb7d52c[_0x4d5db8(0x195)],'createdAt':_0xb7d52c['createdAt']}),await database_1[_0x4d5db8(0x230)][_0x4d5db8(0x1b9)][_0x4d5db8(0x198)]({'data':{'paymentId':_0xb7d52c['id'],'shopId':_0xb7d52c['shopId'],'event':_0x4d5db8(0x23a),'statusCode':0x1f4,'responseBody':JSON[_0x4d5db8(0x1dc)]({'error':_0x3a2a92 instanceof Error?_0x3a2a92[_0x4d5db8(0x1b6)]:'Unknown\x20error','gatewayPaymentId':_0xb7d52c[_0x4d5db8(0x1b5)],'checkedAt':new Date()[_0x4d5db8(0x157)]()})}});}}async[a40_0x6081c4(0x212)](_0x4fdcf0,_0x7a51d){const _0x585435=a40_0x6081c4,_0x181da=Date[_0x585435(0x1a3)]();try{const _0x219aa1=_0x4fdcf0[_0x585435(0x1be)],_0x12e2aa=_0x219aa1[_0x585435(0x23d)];if(!_0x12e2aa?.[_0x585435(0x249)]){console[_0x585435(0x165)](_0x585435(0x226)+_0x219aa1['id']);return;}const _0x207a1f=_0x7a51d==='PAID'?_0x585435(0x1d1):_0x7a51d===_0x585435(0x256)?_0x585435(0x17e):_0x7a51d===_0x585435(0x17b)?'payment.failed':'payment.pending';if(!_0x12e2aa[_0x585435(0x234)]?.['includes'](_0x207a1f)){console[_0x585435(0x165)](_0x585435(0x1b8)+_0x207a1f+_0x585435(0x150)+_0x219aa1['id']);return;}const _0x2296e3=(0x0,gateway_1[_0x585435(0x180)])(_0x4fdcf0[_0x585435(0x243)])||_0x4fdcf0[_0x585435(0x243)],_0x48c2fc={'event':_0x207a1f,'payment':{'id':_0x4fdcf0['id'],'order_id':_0x4fdcf0[_0x585435(0x1e6)],'gateway_order_id':_0x4fdcf0['gatewayOrderId'],'gateway':_0x2296e3,'amount':_0x4fdcf0[_0x585435(0x1f8)],'currency':_0x4fdcf0[_0x585435(0x18d)],'status':_0x7a51d[_0x585435(0x1fe)](),'customer_email':_0x4fdcf0[_0x585435(0x1b1)],'customer_name':_0x4fdcf0['customerName'],'created_at':_0x4fdcf0['createdAt'],'updated_at':new Date()}},_0x523321=await fetch(_0x12e2aa[_0x585435(0x249)],{'method':_0x585435(0x172),'headers':{'Content-Type':_0x585435(0x217),'User-Agent':_0x585435(0x1ff)},'body':JSON[_0x585435(0x1dc)](_0x48c2fc)}),_0x2fba08=Date[_0x585435(0x1a3)]()-_0x181da,_0x49f22a=_0x523321['ok']?_0x585435(0x155):await _0x523321['text']();loggerService_1[_0x585435(0x1e2)]['logShopWebhookSent'](_0x4fdcf0['shopId'],_0x12e2aa['webhookUrl'],_0x207a1f,_0x523321[_0x585435(0x245)],_0x2fba08,_0x48c2fc),console[_0x585435(0x165)](_0x585435(0x18c)+_0x12e2aa[_0x585435(0x249)]+_0x585435(0x254)+_0x523321['status']+'\x20('+_0x2fba08+'ms)');}catch(_0xb6fff1){console['error']('Failed\x20to\x20send\x20shop\x20webhook:',_0xb6fff1),loggerService_1[_0x585435(0x1e2)][_0x585435(0x181)](_0x4fdcf0['shopId'],_0x4fdcf0['shop']?.[_0x585435(0x23d)]?.[_0x585435(0x249)]||_0x585435(0x1af),_0x585435(0x1fd),_0xb6fff1,{});}}async[a40_0x6081c4(0x169)](_0x30d9e5,_0x441628){const _0x2daf85=a40_0x6081c4;try{const _0x3d9ac9={'PENDING':_0x2daf85(0x206),'PAID':'paid','FAILED':_0x2daf85(0x1df),'EXPIRED':'expired'},_0x4ea753=_0x3d9ac9[_0x441628];if(!_0x4ea753||_0x4ea753==='created')return;await telegramBotService_1[_0x2daf85(0x21c)]['sendPaymentNotification'](_0x30d9e5['shopId'],_0x30d9e5,_0x4ea753);}catch(_0x32971f){console[_0x2daf85(0x1ec)](_0x2daf85(0x1da),_0x32971f);}}async[a40_0x6081c4(0x1d2)](_0x579654){const _0x28336e=a40_0x6081c4;console[_0x28336e(0x165)](_0x28336e(0x1e1)+_0x579654);const _0x55fa3f=await database_1[_0x28336e(0x230)][_0x28336e(0x1f7)][_0x28336e(0x163)]({'where':{'id':_0x579654},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x55fa3f)throw new Error('Payment\x20not\x20found');if(_0x55fa3f[_0x28336e(0x243)]!==_0x28336e(0x153)&&_0x55fa3f[_0x28336e(0x243)]!==_0x28336e(0x187))throw new Error(_0x28336e(0x21f));console[_0x28336e(0x165)]('✅\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20'+_0x55fa3f[_0x28336e(0x243)]+_0x28336e(0x1b0)+_0x579654),await this[_0x28336e(0x22b)](_0x55fa3f),console[_0x28336e(0x165)]('✅\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20'+_0x579654);}['getServiceStats'](){const _0x7442ad=a40_0x6081c4,_0x4be52f=this[_0x7442ad(0x207)]?this[_0x7442ad(0x214)]:undefined,_0x27c789=Array[_0x7442ad(0x252)](this[_0x7442ad(0x246)][_0x7442ad(0x1ae)]())[_0x7442ad(0x19a)](_0x2a9c33=>({'paymentId':_0x2a9c33[_0x7442ad(0x242)],'gatewayPaymentId':_0x2a9c33['gatewayPaymentId'],'createdAt':_0x2a9c33['createdAt'],'timersCount':_0x2a9c33[_0x7442ad(0x229)]['length']}));return{'isActive':!!this[_0x7442ad(0x207)],'globalCheckIntervalMinutes':this['GLOBAL_CHECK_INTERVAL_MS']/(0x3e8*0x3c),'expiryDays':this['EXPIRY_DAYS'],'activeIndividualTimers':this['paymentTimers'][_0x7442ad(0x1e7)],'nextGlobalCheckIn':_0x4be52f,'paymentTimersDetails':_0x27c789};}[a40_0x6081c4(0x20e)](_0x32188b){const _0x386e99=a40_0x6081c4,_0x294900=this['paymentTimers']['get'](_0x32188b);if(_0x294900)return{'hasTimers':!![],'timersCount':_0x294900[_0x386e99(0x229)][_0x386e99(0x18f)],'createdAt':_0x294900['createdAt'],'gatewayPaymentId':_0x294900[_0x386e99(0x1b5)]};return{'hasTimers':![]};}async[a40_0x6081c4(0x20a)](_0x38f140,_0x1aebef){const _0x31e51f=a40_0x6081c4;try{const _0x2c4228=await database_1[_0x31e51f(0x230)][_0x31e51f(0x1be)][_0x31e51f(0x163)]({'where':{'id':_0x38f140},'select':{'gatewaySettings':!![]}});if(!_0x2c4228?.[_0x31e51f(0x240)])return console[_0x31e51f(0x165)](_0x31e51f(0x202)+_0x38f140+',\x20using\x20default\x20commission\x2010%'),0xa;const _0x4f3469=JSON[_0x31e51f(0x189)](_0x2c4228['gatewaySettings']);for(const [_0x2cf4be,_0xf84218]of Object['entries'](_0x4f3469)){if(_0x2cf4be['toLowerCase']()===_0x1aebef[_0x31e51f(0x1fe)]()){const _0x3e5565=_0xf84218['commission']||0xa;return console[_0x31e51f(0x165)]('Gateway\x20'+_0x1aebef+_0x31e51f(0x15c)+_0x38f140+':\x20'+_0x3e5565+'%'),_0x3e5565;}}return console['log']('No\x20specific\x20commission\x20found\x20for\x20gateway\x20'+_0x1aebef+_0x31e51f(0x247)+_0x38f140+_0x31e51f(0x197)),0xa;}catch(_0x79aec5){return console[_0x31e51f(0x1ec)]('Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20'+_0x38f140+',\x20gateway\x20'+_0x1aebef+':',_0x79aec5),0xa;}}}exports[a40_0x6081c4(0x18b)]=CoinToPayStatusService,exports[a40_0x6081c4(0x1d8)]=new CoinToPayStatusService();