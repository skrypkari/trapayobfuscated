'use strict';const a38_0x2b1ce3=a38_0x3bd1;(function(_0x45a6c2,_0x839dd8){const _0x5442d9=a38_0x3bd1,_0xa8a001=_0x45a6c2();while(!![]){try{const _0xfb0551=parseInt(_0x5442d9(0x2b0))/0x1+parseInt(_0x5442d9(0x1e9))/0x2*(-parseInt(_0x5442d9(0x252))/0x3)+parseInt(_0x5442d9(0x289))/0x4*(parseInt(_0x5442d9(0x268))/0x5)+-parseInt(_0x5442d9(0x299))/0x6*(parseInt(_0x5442d9(0x241))/0x7)+-parseInt(_0x5442d9(0x1f0))/0x8*(-parseInt(_0x5442d9(0x2ac))/0x9)+-parseInt(_0x5442d9(0x246))/0xa+parseInt(_0x5442d9(0x28a))/0xb;if(_0xfb0551===_0x839dd8)break;else _0xa8a001['push'](_0xa8a001['shift']());}catch(_0x27dcf1){_0xa8a001['push'](_0xa8a001['shift']());}}}(a38_0x4c70,0xd6f44));var __importDefault=this&&this[a38_0x2b1ce3(0x1c4)]||function(_0x55fc6a){const _0x3d593b=a38_0x2b1ce3;return _0x55fc6a&&_0x55fc6a[_0x3d593b(0x2a1)]?_0x55fc6a:{'default':_0x55fc6a};};Object[a38_0x2b1ce3(0x254)](exports,a38_0x2b1ce3(0x2a1),{'value':!![]}),exports['coinToPayStatusService']=exports[a38_0x2b1ce3(0x20c)]=void 0x0;function a38_0x4c70(){const _0x17bd2c=['❌\x20[TIMER]\x20Failed\x20individual\x20check\x20#','\x20current\x20status:\x20','default','expired','\x20\x20\x20-\x20GatewayPaymentId:\x20','transactionId','🪙\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','\x20status:\x20','⏰\x20[GLOBAL]\x20Payment\x20','logShopWebhookError','has','\x20status\x20is\x20','amountUSDT','✅\x20[CHECK]\x20Payment\x20','🪙\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','get','settings','Payment\x20not\x20found','./loggerService','\x20status\x20changed\x20to\x20','\x20details:','❌\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','Payment\x20older\x20than\x20','loggerService','\x20in\x20','coinToPayService','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','checkAllPendingPayments','payment.pending','No\x20specific\x20commission\x20found\x20for\x20gateway\x20',',\x20using\x20default\x2010%','\x20\x20\x20📍\x20Source:\x20','update','Unknown\x20error','📈\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','\x20payment\x20','unknown','commission','Webhook\x20event\x20','Shop\x20webhook\x20sent\x20to\x20','❌\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','telegramBotService','98xNJtIs','📈\x20[COINTOPAY]\x20Payment\x20','now',',\x20currentPayments=','✅\x20[TIMER]\x20Individual\x20check\x20#','4969870rxyUQo','📊\x20[CHECK]\x20CoinToPay2\x20payment\x20',',\x20stopping\x20individual\x20checks','toISOString','checkExpiredPayments','EXPIRY_DAYS','COINTOPAY_ERROR','gatewayPaymentId','\x20with\x20status\x20','forEach','5\x20minutes','getGatewayCommission','24BvcPSl','paymentDetails','defineProperty','📊\x20[CHECK]\x20Payment\x20','✅\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','CoinToPayService','🛑\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','message','adminNotes','\x20for\x20payment\x20','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','\x20in\x20shop\x20','🪙\x20[ERROR]\x20CoinToPay\x20Error:\x20','\x20\x20\x20❌\x20Error:\x20','currency','🪙\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','../types/gateway','customerEmail','✅\x20[DEBUG]\x20Successfully\x20scheduled\x20','⏰\x20[HOURLY]\x20Payment\x20','checkPaymentStatus','68455ynAFux','1\x20minute','type','FAILED','🛑\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','shop','✅\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','/status/','findMany','entries','push','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','✅\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','\x20\x20\x20📅\x20Time:\x20','🪙\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','gateway','payment','❌\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','\x20\x20\x20-\x20Status:\x20','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check',',\x20clearing\x20individual\x20timers','cointopay_status_check_error','\x20not\x20found\x20in\x20database',':\x20type=','Success','floor','stopPeriodicStatusCheck','amountAfterGatewayCommissionUSDT','paymentTimers','currencyService','webhookUrl','./currencyService','220lwFoDN','18737543YbAnTt','❌\x20[CHECK]\x20Payment\x20','cointopay','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','\x20status\x20from\x20','❌\x20[HOURLY]\x20Payment\x20','bankDetails','⏰\x20[GLOBAL]\x20Found\x20','sendPaymentStatusNotification','created','✅\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','SINGLE','gatewayOrderId','\x20initial\x20timers\x20for\x20payment\x20','ms)','394356WjDtmx','gatewaySettings','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','\x20\x20\x20Amount:\x20','status','paymentLinkId','🔍\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','✅\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','__esModule','webhook_send','from','EXPIRED','amount','checkSinglePaymentById','getGatewayIdByName','❌\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','toFixed','status_check','confirmedOn','15273yjBdMB','delete','globalCheckInterval','TesSoft\x20Payment\x20System/1.0','356547HOSmmO','.\x20Remaining\x20active\x20timers:\x20','cointopay_auto_expired','logCoinToPayError','⚠️\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','auto_expire',',\x20gateway\x20','sendShopWebhook','\x20status\x20unchanged\x20(','\x20expired','setDate','delay','\x20timers\x20for\x20payment\x20','text','PAID','GLOBAL_CHECK_INTERVAL_MS','\x20not\x20found,\x20clearing\x20timers','remitterIban','stringify','\x20expired\x20CoinToPay\x20payments','\x20updated:\x20currentPayments=','Bank\x20Details:\x20','\x20seconds\x20(','2\x20minutes','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','application/json','❌\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','createdOn','\x20marked\x20as\x20paid\x20at:\x20','\x20is\x20valid\x20for\x20checking,\x20proceeding...','__importDefault','shopId','\x20days,\x20marking\x20as\x20EXPIRED','\x20has\x20no\x20gatewayPaymentId','🏦\x20[CHECK]\x20Saved\x20IBAN:\x20','getTime','\x20amounts\x20calculated:','catch','📊\x20[HOURLY]\x20Payment\x20','getPaymentTimerInfo','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','create','\x20commission\x20for\x20shop\x20','coinToPay2Service','iban','cointopay2','customerName','paymentLink','🪙\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','startPeriodicStatusCheck','\x20is\x20older\x20than\x20','set','checkSinglePayment','coinToPayStatusService','\x20\x20\x20Gateway\x20','toLowerCase','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','\x20days\x20(created\x20before\x20','not\x20confirmed','\x20days\x20without\x20payment\x20confirmation','log','💰\x20[CHECK]\x20Payment\x20','❌\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','description','currentPayments','CoinToPay2Service','size','328238PgKjUW','clearPaymentTimers','🔍\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','getServiceStats','⚠️\x20[CHECK]\x20Payment\x20','logCoinToPayStatus','\x20checked,\x20','3760haXISm','\x20not\x20enabled\x20for\x20shop\x20','schedulePaymentChecks','map','../config/database','\x20->\x20','error','length','PENDING','createdAt','\x20has\x20no\x20gatewayPaymentId,\x20skipping','checkPaymentById','\x20(after\x20','findUnique','payment.success','getDate','logShopWebhookSent','COMPLETED','payment.failed','\x20days','🪙\x20[DEBUG]\x20Creating\x20','Failed\x20to\x20mark\x20payment\x20as\x20expired','🧹\x20[DEBUG]\x20Clearing\x20','sendPaymentNotification',',\x20status=','🏦\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes','timers','webhookLog','CoinToPayStatusService','paidAt','\x20USDT','\x20\x20\x20-\x20Amount:\x20','cointopay_status_check_','Automatically\x20expired\x20after\x20','✅\x20[HOURLY]\x20Payment\x20','logWhiteDomainError','\x20\x20\x20-\x20paymentId:\x20','includes','\x20commission:\x20'];a38_0x4c70=function(){return _0x17bd2c;};return a38_0x4c70();}const coinToPayService_1=require('./gateways/coinToPayService'),coinToPay2Service_1=require('./gateways/coinToPay2Service'),gateway_1=require(a38_0x2b1ce3(0x263)),database_1=__importDefault(require(a38_0x2b1ce3(0x1f4))),telegramBotService_1=require('./telegramBotService'),loggerService_1=require(a38_0x2b1ce3(0x229)),currencyService_1=require(a38_0x2b1ce3(0x288));class CoinToPayStatusService{constructor(){const _0x36b621=a38_0x2b1ce3;this[_0x36b621(0x2ae)]=null,this[_0x36b621(0x1b5)]=0x3c*0x3c*0x3e8,this[_0x36b621(0x24b)]=0x5,this[_0x36b621(0x285)]=new Map(),this[_0x36b621(0x230)]=new coinToPayService_1[(_0x36b621(0x257))](),this[_0x36b621(0x1d1)]=new coinToPay2Service_1[(_0x36b621(0x1e7))](),console[_0x36b621(0x1e2)](_0x36b621(0x225));}[a38_0x2b1ce3(0x1f2)](_0x4542e5,_0x28bdc2){const _0x1297c8=a38_0x2b1ce3;console[_0x1297c8(0x1e2)](_0x1297c8(0x21d)),console[_0x1297c8(0x1e2)](_0x1297c8(0x214)+_0x4542e5),console[_0x1297c8(0x1e2)]('\x20\x20\x20-\x20gatewayPaymentId:\x20'+_0x28bdc2),this[_0x1297c8(0x1ea)](_0x4542e5);const _0x26fd8f=[],_0x4e6477=new Date(),_0x15d70=[{'delay':0x1*0x3c*0x3e8,'description':_0x1297c8(0x269)},{'delay':0x2*0x3c*0x3e8,'description':_0x1297c8(0x1bd)},{'delay':0x5*0x3c*0x3e8,'description':_0x1297c8(0x250)},{'delay':0x5*0x3c*0x3e8,'description':'5\x20minutes'}];console[_0x1297c8(0x1e2)](_0x1297c8(0x204)+_0x15d70[_0x1297c8(0x1f7)]+_0x1297c8(0x297)+_0x4542e5);let _0x5986b6=0x0;_0x15d70['forEach']((_0xac450b,_0x521921)=>{const _0x552197=_0x1297c8;_0x5986b6+=_0xac450b[_0x552197(0x2bb)];const _0xdbcfbb=setTimeout(async()=>{const _0x2dadc1=_0x552197;console[_0x2dadc1(0x1e2)]('🪙\x20[TIMER]\x20Individual\x20check\x20#'+(_0x521921+0x1)+'\x20triggered\x20for\x20payment\x20'+_0x4542e5+_0x2dadc1(0x1fc)+_0xac450b[_0x2dadc1(0x1e5)]+')');try{await this[_0x2dadc1(0x2a6)](_0x4542e5),console[_0x2dadc1(0x1e2)](_0x2dadc1(0x245)+(_0x521921+0x1)+'\x20completed\x20for\x20payment\x20'+_0x4542e5);}catch(_0x105cab){console[_0x2dadc1(0x1f6)](_0x2dadc1(0x217)+(_0x521921+0x1)+'\x20for\x20payment\x20'+_0x4542e5+':',_0x105cab),this[_0x2dadc1(0x2b3)](_0x4542e5,_0x28bdc2,_0x105cab,_0x2dadc1(0x2aa),{'checkNumber':_0x521921+0x1,'scheduledAfter':_0xac450b[_0x2dadc1(0x1e5)],'isIndividualCheck':!![]});}},_0x5986b6);_0x26fd8f[_0x552197(0x272)](_0xdbcfbb),console[_0x552197(0x1e2)]('⏰\x20[DEBUG]\x20Scheduled\x20check\x20#'+(_0x521921+0x1)+_0x552197(0x25b)+_0x4542e5+_0x552197(0x22f)+_0x5986b6/0x3e8+_0x552197(0x1bc)+_0xac450b['description']+')');});const _0x3418d7=setInterval(async()=>{const _0x4e9d0f=_0x1297c8;console[_0x4e9d0f(0x1e2)](_0x4e9d0f(0x276)+_0x4542e5);try{const _0x3bcef3=await database_1[_0x4e9d0f(0x219)]['payment']['findUnique']({'where':{'id':_0x4542e5},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x3bcef3){console['log'](_0x4e9d0f(0x28f)+_0x4542e5+_0x4e9d0f(0x1b6)),this[_0x4e9d0f(0x1ea)](_0x4542e5);return;}console['log'](_0x4e9d0f(0x1cc)+_0x4542e5+_0x4e9d0f(0x218)+_0x3bcef3[_0x4e9d0f(0x29d)]);if(_0x3bcef3[_0x4e9d0f(0x29d)]!==_0x4e9d0f(0x1f8)){console['log'](_0x4e9d0f(0x212)+_0x4542e5+_0x4e9d0f(0x222)+_0x3bcef3[_0x4e9d0f(0x29d)]+_0x4e9d0f(0x248)),this[_0x4e9d0f(0x1ea)](_0x4542e5);return;}const _0x404d91=Math[_0x4e9d0f(0x282)]((Date[_0x4e9d0f(0x243)]()-_0x3bcef3['createdAt'][_0x4e9d0f(0x1c9)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x404d91>=this[_0x4e9d0f(0x24b)]){console[_0x4e9d0f(0x1e2)](_0x4e9d0f(0x266)+_0x4542e5+_0x4e9d0f(0x1d8)+this[_0x4e9d0f(0x24b)]+_0x4e9d0f(0x1de)),this[_0x4e9d0f(0x1ea)](_0x4542e5);return;}await this[_0x4e9d0f(0x2a6)](_0x4542e5),console['log'](_0x4e9d0f(0x26e)+_0x4542e5);}catch(_0x5ed77f){console['error'](_0x4e9d0f(0x1e4)+_0x4542e5+':',_0x5ed77f),this[_0x4e9d0f(0x2b3)](_0x4542e5,_0x28bdc2,_0x5ed77f,_0x4e9d0f(0x2aa),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x26fd8f[_0x1297c8(0x272)](_0x3418d7),this[_0x1297c8(0x285)][_0x1297c8(0x1d9)](_0x4542e5,{'timers':_0x26fd8f,'paymentId':_0x4542e5,'gatewayPaymentId':_0x28bdc2,'createdAt':_0x4e6477}),console[_0x1297c8(0x1e2)](_0x1297c8(0x265)+_0x15d70[_0x1297c8(0x1f7)]+_0x1297c8(0x231)+_0x4542e5),console[_0x1297c8(0x1e2)]('📊\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20'+this[_0x1297c8(0x285)][_0x1297c8(0x1e8)]),this[_0x1297c8(0x1ee)](_0x4542e5,_0x28bdc2,'PENDING','PENDING','status_check',{'action':'schedule_created','scheduledChecks':_0x15d70[_0x1297c8(0x1f7)],'firstCheckIn':_0x15d70[0x0][_0x1297c8(0x2bb)]/0x3e8,'totalTimers':this[_0x1297c8(0x285)]['size']});}['clearPaymentTimers'](_0x4e6ca4){const _0x4ab35f=a38_0x2b1ce3,_0xb56917=this[_0x4ab35f(0x285)]['get'](_0x4e6ca4);_0xb56917?(console['log'](_0x4ab35f(0x206)+_0xb56917[_0x4ab35f(0x20a)][_0x4ab35f(0x1f7)]+_0x4ab35f(0x2bc)+_0x4e6ca4),_0xb56917[_0x4ab35f(0x20a)][_0x4ab35f(0x24f)]((_0x2642dc,_0x20e662)=>{const _0x4221e3=_0x4ab35f;_0x2642dc&&(clearTimeout(_0x2642dc),clearInterval(_0x2642dc),console[_0x4221e3(0x1e2)]('🧹\x20[DEBUG]\x20Cleared\x20timer\x20#'+(_0x20e662+0x1)+'\x20for\x20payment\x20'+_0x4e6ca4));}),this[_0x4ab35f(0x285)][_0x4ab35f(0x2ad)](_0x4e6ca4),console[_0x4ab35f(0x1e2)](_0x4ab35f(0x294)+_0x4e6ca4+_0x4ab35f(0x2b1)+this['paymentTimers']['size'])):console[_0x4ab35f(0x1e2)](_0x4ab35f(0x2b4)+_0x4e6ca4+'\x20to\x20clear');}async[a38_0x2b1ce3(0x2a6)](_0x3e15c4){const _0x53e7a3=a38_0x2b1ce3;console[_0x53e7a3(0x1e2)](_0x53e7a3(0x29f)+_0x3e15c4);const _0x5ed37c=await database_1[_0x53e7a3(0x219)][_0x53e7a3(0x278)][_0x53e7a3(0x1fd)]({'where':{'id':_0x3e15c4},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x5ed37c){console['log'](_0x53e7a3(0x28b)+_0x3e15c4+_0x53e7a3(0x27f));return;}console[_0x53e7a3(0x1e2)](_0x53e7a3(0x255)+_0x3e15c4+'\x20found:'),console[_0x53e7a3(0x1e2)]('\x20\x20\x20-\x20Gateway:\x20'+_0x5ed37c[_0x53e7a3(0x277)]),console[_0x53e7a3(0x1e2)](_0x53e7a3(0x27a)+_0x5ed37c[_0x53e7a3(0x29d)]),console[_0x53e7a3(0x1e2)](_0x53e7a3(0x21b)+_0x5ed37c['gatewayPaymentId']),console[_0x53e7a3(0x1e2)](_0x53e7a3(0x20f)+_0x5ed37c['amount']+'\x20'+_0x5ed37c[_0x53e7a3(0x260)]),console['log']('\x20\x20\x20-\x20ShopId:\x20'+_0x5ed37c[_0x53e7a3(0x1c5)]);if(_0x5ed37c['gateway']!=='cointopay'&&_0x5ed37c[_0x53e7a3(0x277)]!==_0x53e7a3(0x1d3)){console['log']('⚠️\x20[CHECK]\x20Payment\x20'+_0x3e15c4+'\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20'+_0x5ed37c[_0x53e7a3(0x277)]+')');return;}if(_0x5ed37c['status']!=='PENDING'){console[_0x53e7a3(0x1e2)]('⚠️\x20[CHECK]\x20Payment\x20'+_0x3e15c4+_0x53e7a3(0x222)+_0x5ed37c['status']+_0x53e7a3(0x248)),this[_0x53e7a3(0x1ea)](_0x3e15c4);return;}if(!_0x5ed37c['gatewayPaymentId']){console['log'](_0x53e7a3(0x1ed)+_0x3e15c4+_0x53e7a3(0x1c7));return;}console['log'](_0x53e7a3(0x224)+_0x3e15c4+_0x53e7a3(0x1c3)),await this[_0x53e7a3(0x1da)](_0x5ed37c);}[a38_0x2b1ce3(0x1ee)](_0x363c71,_0x3670b7,_0x18496d,_0x38d21b,_0x390ecb,_0x451932){const _0x2ae25f=a38_0x2b1ce3,_0x11e9c5={'type':'COINTOPAY_STATUS_CHANGE','paymentId':_0x363c71,'gatewayPaymentId':_0x3670b7,'oldStatus':_0x18496d,'newStatus':_0x38d21b,'source':_0x390ecb,'timestamp':new Date()[_0x2ae25f(0x249)](),'details':_0x451932||{}};loggerService_1[_0x2ae25f(0x22e)][_0x2ae25f(0x1ee)](_0x11e9c5),console[_0x2ae25f(0x1e2)](_0x2ae25f(0x1d6)+_0x363c71+'\x20('+_0x3670b7+')'),console[_0x2ae25f(0x1e2)]('\x20\x20\x20📊\x20Status:\x20'+_0x18496d+_0x2ae25f(0x1f5)+_0x38d21b),console['log']('\x20\x20\x20📍\x20Source:\x20'+_0x390ecb),console[_0x2ae25f(0x1e2)](_0x2ae25f(0x275)+_0x11e9c5['timestamp']),_0x451932&&console['log']('\x20\x20\x20📝\x20Details:',_0x451932);}['logCoinToPayError'](_0x115d9c,_0x26b8a1,_0x5c4d2a,_0x3d7055,_0x4b4f27){const _0x3ebac3=a38_0x2b1ce3,_0x39e895={'type':_0x3ebac3(0x24c),'paymentId':_0x115d9c,'gatewayPaymentId':_0x26b8a1,'error':_0x5c4d2a instanceof Error?{'message':_0x5c4d2a['message'],'stack':_0x5c4d2a['stack']}:_0x5c4d2a,'source':_0x3d7055,'timestamp':new Date()[_0x3ebac3(0x249)](),'context':_0x4b4f27||{}};loggerService_1[_0x3ebac3(0x22e)]['logCoinToPayError'](_0x39e895),console[_0x3ebac3(0x1f6)](_0x3ebac3(0x25e)+_0x115d9c+'\x20('+_0x26b8a1+')'),console['error'](_0x3ebac3(0x25f)+(_0x5c4d2a instanceof Error?_0x5c4d2a['message']:_0x5c4d2a)),console['error'](_0x3ebac3(0x236)+_0x3d7055),console['error'](_0x3ebac3(0x275)+_0x39e895['timestamp']),_0x4b4f27&&console[_0x3ebac3(0x1f6)]('\x20\x20\x20📝\x20Context:',_0x4b4f27);}[a38_0x2b1ce3(0x1d7)](){const _0x59d354=a38_0x2b1ce3;console[_0x59d354(0x1e2)]('🪙\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)'),this[_0x59d354(0x232)]()[_0x59d354(0x1cb)](_0x453383=>{const _0x2e3217=_0x59d354;console[_0x2e3217(0x1f6)](_0x2e3217(0x23f),_0x453383);}),this[_0x59d354(0x2ae)]=setInterval(async()=>{const _0x3efc70=_0x59d354;try{console[_0x3efc70(0x1e2)]('🪙\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...'),await this[_0x3efc70(0x232)](),console[_0x3efc70(0x1e2)](_0x3efc70(0x256));}catch(_0x31797d){console[_0x3efc70(0x1f6)]('❌\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:',_0x31797d);}},this[_0x59d354(0x1b5)]),console[_0x59d354(0x1e2)](_0x59d354(0x2a0));}[a38_0x2b1ce3(0x283)](){const _0x6a56fc=a38_0x2b1ce3;console[_0x6a56fc(0x1e2)](_0x6a56fc(0x26c));this[_0x6a56fc(0x2ae)]&&(clearInterval(this['globalCheckInterval']),this['globalCheckInterval']=null,console[_0x6a56fc(0x1e2)](_0x6a56fc(0x258)));const _0x40114b=this[_0x6a56fc(0x285)][_0x6a56fc(0x1e8)];for(const [_0x2b49f9]of this[_0x6a56fc(0x285)]){this['clearPaymentTimers'](_0x2b49f9);}console['log']('🛑\x20[SHUTDOWN]\x20Cleared\x20'+_0x40114b+'\x20individual\x20payment\x20timers');}async[a38_0x2b1ce3(0x232)](){const _0x173b7a=a38_0x2b1ce3;try{console[_0x173b7a(0x1e2)](_0x173b7a(0x261));const _0x103a98=await database_1[_0x173b7a(0x219)][_0x173b7a(0x278)][_0x173b7a(0x270)]({'where':{'gateway':{'in':[_0x173b7a(0x28c),_0x173b7a(0x1d3)]},'status':_0x173b7a(0x1f8),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x173b7a(0x1e2)]('🪙\x20[GLOBAL]\x20Found\x20'+_0x103a98[_0x173b7a(0x1f7)]+'\x20pending\x20CoinToPay\x20payments');if(_0x103a98[_0x173b7a(0x1f7)]===0x0){console[_0x173b7a(0x1e2)]('🪙\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check');return;}const _0x16bc5b=await this[_0x173b7a(0x24a)](_0x103a98);console[_0x173b7a(0x1e2)](_0x173b7a(0x291)+_0x16bc5b[_0x173b7a(0x1f7)]+_0x173b7a(0x1b9));let _0x2ea0e4=0x0,_0x1875ab=0x0;for(const _0x51d6de of _0x103a98){try{if(_0x16bc5b[_0x173b7a(0x215)](_0x51d6de['id'])){console[_0x173b7a(0x1e2)](_0x173b7a(0x21f)+_0x51d6de['id']+_0x173b7a(0x27c)),_0x1875ab++;continue;}if(this[_0x173b7a(0x285)][_0x173b7a(0x221)](_0x51d6de['id'])){console[_0x173b7a(0x1e2)](_0x173b7a(0x21f)+_0x51d6de['id']+_0x173b7a(0x1ce)),_0x1875ab++;continue;}const _0x52d1c7=(Date['now']()-_0x51d6de['createdAt']['getTime']())/(0x3e8*0x3c*0x3c);if(_0x52d1c7<0x1){console[_0x173b7a(0x1e2)](_0x173b7a(0x21f)+_0x51d6de['id']+'\x20is\x20too\x20new\x20('+_0x52d1c7['toFixed'](0x1)+'h),\x20skipping\x20global\x20check'),_0x1875ab++;continue;}console[_0x173b7a(0x1e2)](_0x173b7a(0x1eb)+_0x51d6de['id']+'\x20(age:\x20'+_0x52d1c7['toFixed'](0x1)+'h)'),await this[_0x173b7a(0x1da)](_0x51d6de),_0x2ea0e4++,await new Promise(_0x882893=>setTimeout(_0x882893,0x7d0));}catch(_0x3cba5a){console['error'](_0x173b7a(0x22c)+_0x51d6de['id']+':',_0x3cba5a),this[_0x173b7a(0x2b3)](_0x51d6de['id'],_0x51d6de[_0x173b7a(0x24d)]||_0x173b7a(0x23b),_0x3cba5a,_0x173b7a(0x2aa),{'isGlobalCheck':!![],'paymentAmount':_0x51d6de['amount'],'paymentCurrency':_0x51d6de['currency'],'shopId':_0x51d6de[_0x173b7a(0x1c5)],'createdAt':_0x51d6de[_0x173b7a(0x1f9)]}),loggerService_1['loggerService'][_0x173b7a(0x213)]('cointopay',_0x173b7a(0x26f)+_0x51d6de[_0x173b7a(0x24d)],_0x3cba5a);}}console[_0x173b7a(0x1e2)]('✅\x20[GLOBAL]\x20Global\x20check\x20completed:\x20'+_0x2ea0e4+_0x173b7a(0x1ef)+_0x1875ab+'\x20skipped,\x20'+_0x16bc5b[_0x173b7a(0x1f7)]+_0x173b7a(0x2b9));}catch(_0xcb5299){console[_0x173b7a(0x1f6)](_0x173b7a(0x2a8),_0xcb5299);}}async['checkExpiredPayments'](_0xc06cb2){const _0x2a509a=a38_0x2b1ce3,_0x45f397=[],_0x444b67=new Date();_0x444b67[_0x2a509a(0x2ba)](_0x444b67[_0x2a509a(0x1ff)]()-this[_0x2a509a(0x24b)]),console[_0x2a509a(0x1e2)]('⏰\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20'+this['EXPIRY_DAYS']+_0x2a509a(0x1df)+_0x444b67['toISOString']()+')');for(const _0xf90226 of _0xc06cb2){if(_0xf90226['createdAt']<_0x444b67){console[_0x2a509a(0x1e2)]('⏰\x20[EXPIRY]\x20Payment\x20'+_0xf90226['id']+_0x2a509a(0x1d8)+this[_0x2a509a(0x24b)]+_0x2a509a(0x1c6));try{this[_0x2a509a(0x1ee)](_0xf90226['id'],_0xf90226[_0x2a509a(0x24d)]||_0x2a509a(0x23b),'PENDING',_0x2a509a(0x2a4),_0x2a509a(0x2b5),{'reason':_0x2a509a(0x22d)+this[_0x2a509a(0x24b)]+_0x2a509a(0x203),'createdAt':_0xf90226[_0x2a509a(0x1f9)],'daysSinceCreation':Math[_0x2a509a(0x282)]((Date[_0x2a509a(0x243)]()-_0xf90226['createdAt']['getTime']())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0xf90226[_0x2a509a(0x2a5)],'paymentCurrency':_0xf90226[_0x2a509a(0x260)],'shopId':_0xf90226[_0x2a509a(0x1c5)]}),await database_1[_0x2a509a(0x219)]['payment'][_0x2a509a(0x237)]({'where':{'id':_0xf90226['id']},'data':{'status':'EXPIRED','updatedAt':new Date(),'adminNotes':_0x2a509a(0x211)+this[_0x2a509a(0x24b)]+_0x2a509a(0x1e1)}}),await database_1[_0x2a509a(0x219)][_0x2a509a(0x20b)][_0x2a509a(0x1cf)]({'data':{'paymentId':_0xf90226['id'],'shopId':_0xf90226[_0x2a509a(0x1c5)],'event':_0x2a509a(0x2b2),'statusCode':0xc8,'responseBody':JSON['stringify']({'reason':'Payment\x20older\x20than\x20'+this[_0x2a509a(0x24b)]+_0x2a509a(0x203),'createdAt':_0xf90226[_0x2a509a(0x1f9)],'expiredAt':new Date()['toISOString'](),'daysSinceCreation':Math[_0x2a509a(0x282)]((Date[_0x2a509a(0x243)]()-_0xf90226[_0x2a509a(0x1f9)]['getTime']())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x2a509a(0x2b7)](_0xf90226,_0x2a509a(0x2a4)),await this[_0x2a509a(0x292)](_0xf90226,_0x2a509a(0x2a4)),this[_0x2a509a(0x1ea)](_0xf90226['id']),_0x45f397[_0x2a509a(0x272)](_0xf90226['id']),console['log']('✅\x20[EXPIRY]\x20Payment\x20'+_0xf90226['id']+_0x2a509a(0x273)+this['EXPIRY_DAYS']+'-day\x20timeout');}catch(_0x3cef0a){console[_0x2a509a(0x1f6)](_0x2a509a(0x279)+_0xf90226['id']+':',_0x3cef0a),this[_0x2a509a(0x2b3)](_0xf90226['id'],_0xf90226[_0x2a509a(0x24d)]||_0x2a509a(0x23b),_0x3cef0a,_0x2a509a(0x2b5),{'reason':_0x2a509a(0x205),'createdAt':_0xf90226[_0x2a509a(0x1f9)],'daysSinceCreation':Math[_0x2a509a(0x282)]((Date['now']()-_0xf90226[_0x2a509a(0x1f9)]['getTime']())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x45f397;}async[a38_0x2b1ce3(0x1da)](_0x495c19){const _0x32d82c=a38_0x2b1ce3;if(!_0x495c19[_0x32d82c(0x24d)]){console['log'](_0x32d82c(0x1ed)+_0x495c19['id']+_0x32d82c(0x1fa));return;}console[_0x32d82c(0x1e2)]('🔍\x20[CHECK]\x20Checking\x20'+_0x495c19[_0x32d82c(0x277)]+_0x32d82c(0x23a)+_0x495c19['id']+'\x20('+_0x495c19[_0x32d82c(0x24d)]+')');try{let _0x7ff2cc;_0x495c19[_0x32d82c(0x277)]==='cointopay2'?(_0x7ff2cc=await this[_0x32d82c(0x1d1)][_0x32d82c(0x267)](_0x495c19[_0x32d82c(0x24d)]),console['log'](_0x32d82c(0x247)+_0x495c19['id']+_0x32d82c(0x21e)+_0x7ff2cc['status'])):(_0x7ff2cc=await this[_0x32d82c(0x230)][_0x32d82c(0x267)](_0x495c19[_0x32d82c(0x24d)]),console[_0x32d82c(0x1e2)]('📊\x20[CHECK]\x20CoinToPay\x20payment\x20'+_0x495c19['id']+'\x20status:\x20'+_0x7ff2cc[_0x32d82c(0x29d)]));_0x7ff2cc[_0x32d82c(0x253)]&&console['log'](_0x32d82c(0x255)+_0x495c19['id']+_0x32d82c(0x22b),{'iban':_0x7ff2cc[_0x32d82c(0x253)][_0x32d82c(0x1d2)]||'not\x20found','transactionId':_0x7ff2cc[_0x32d82c(0x253)]['transactionId'],'createdOn':_0x7ff2cc[_0x32d82c(0x253)][_0x32d82c(0x1c1)],'confirmedOn':_0x7ff2cc['paymentDetails'][_0x32d82c(0x2ab)]||_0x32d82c(0x1e0)});if(_0x7ff2cc[_0x32d82c(0x29d)]!==_0x495c19[_0x32d82c(0x29d)]){console[_0x32d82c(0x1e2)]('🔄\x20[CHECK]\x20Updating\x20payment\x20'+_0x495c19['id']+_0x32d82c(0x28e)+_0x495c19[_0x32d82c(0x29d)]+'\x20to\x20'+_0x7ff2cc[_0x32d82c(0x29d)]),this[_0x32d82c(0x1ee)](_0x495c19['id'],_0x495c19['gatewayPaymentId'],_0x495c19['status'],_0x7ff2cc['status'],'status_check',{'paymentDetails':_0x7ff2cc[_0x32d82c(0x253)],'amount':_0x7ff2cc['amount'],'currency':_0x7ff2cc[_0x32d82c(0x260)],'shopId':_0x495c19[_0x32d82c(0x1c5)],'checkTimestamp':new Date()[_0x32d82c(0x249)]()});const _0x482811={'status':_0x7ff2cc[_0x32d82c(0x29d)],'updatedAt':new Date()};if(_0x7ff2cc[_0x32d82c(0x29d)]===_0x32d82c(0x2be)&&_0x495c19['status']!==_0x32d82c(0x2be)){_0x482811['paidAt']=new Date();if(!_0x495c19[_0x32d82c(0x223)]){const _0x3317b6=await currencyService_1[_0x32d82c(0x286)]['convertToUSDT'](_0x495c19[_0x32d82c(0x2a5)],_0x495c19[_0x32d82c(0x260)]);_0x482811['amountUSDT']=_0x3317b6;const _0x170294=await this['getGatewayCommission'](_0x495c19[_0x32d82c(0x1c5)],_0x495c19[_0x32d82c(0x277)]),_0x54a745=_0x3317b6*(0x1-_0x170294/0x64);_0x482811[_0x32d82c(0x284)]=_0x54a745,console[_0x32d82c(0x1e2)](_0x32d82c(0x1e3)+_0x495c19['id']+_0x32d82c(0x1ca)),console[_0x32d82c(0x1e2)](_0x32d82c(0x29c)+_0x495c19[_0x32d82c(0x2a5)]+'\x20'+_0x495c19[_0x32d82c(0x260)]+_0x32d82c(0x1f5)+_0x3317b6[_0x32d82c(0x2a9)](0x6)+_0x32d82c(0x20e)),console[_0x32d82c(0x1e2)](_0x32d82c(0x1dc)+_0x495c19[_0x32d82c(0x277)]+_0x32d82c(0x216)+_0x170294+'%'),console[_0x32d82c(0x1e2)]('\x20\x20\x20Amount\x20after\x20commission:\x20'+_0x54a745[_0x32d82c(0x2a9)](0x6)+_0x32d82c(0x20e));}console[_0x32d82c(0x1e2)](_0x32d82c(0x1e3)+_0x495c19['id']+_0x32d82c(0x1c2)+_0x482811[_0x32d82c(0x20d)]['toISOString']());}if(_0x7ff2cc[_0x32d82c(0x253)]){const _0x13787d=_0x7ff2cc[_0x32d82c(0x253)];_0x13787d[_0x32d82c(0x1d2)]&&(_0x482811[_0x32d82c(0x1b7)]=_0x13787d[_0x32d82c(0x1d2)],console[_0x32d82c(0x1e2)](_0x32d82c(0x1c8)+_0x13787d[_0x32d82c(0x1d2)]));if(_0x13787d[_0x32d82c(0x290)]){const _0x563f4a=_0x495c19[_0x32d82c(0x25a)]||'',_0x12748e=_0x32d82c(0x1bb)+_0x13787d[_0x32d82c(0x290)];_0x482811['adminNotes']=_0x563f4a?_0x563f4a+'\x0a\x0a'+_0x12748e:_0x12748e,console[_0x32d82c(0x1e2)](_0x32d82c(0x209));}_0x13787d[_0x32d82c(0x21c)]&&console[_0x32d82c(0x1e2)]('🆔\x20[CHECK]\x20Transaction\x20ID:\x20'+_0x13787d[_0x32d82c(0x21c)]),_0x13787d['confirmedOn']&&console[_0x32d82c(0x1e2)](_0x32d82c(0x274)+_0x13787d[_0x32d82c(0x2ab)]);}await database_1[_0x32d82c(0x219)][_0x32d82c(0x278)][_0x32d82c(0x237)]({'where':{'id':_0x495c19['id']},'data':_0x482811});if(_0x7ff2cc[_0x32d82c(0x29d)]===_0x32d82c(0x2be)&&_0x495c19['status']!==_0x32d82c(0x2be)){console[_0x32d82c(0x1e2)](_0x32d82c(0x242)+_0x495c19['id']+_0x32d82c(0x25c));const _0x1cefba=await database_1['default'][_0x32d82c(0x278)][_0x32d82c(0x1fd)]({'where':{'id':_0x495c19['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x1cefba?.[_0x32d82c(0x29e)]&&_0x1cefba[_0x32d82c(0x1d5)])try{const _0x5acb5e=_0x1cefba[_0x32d82c(0x1d5)];console['log'](_0x32d82c(0x239)+_0x5acb5e['id']+_0x32d82c(0x280)+_0x5acb5e[_0x32d82c(0x26a)]+_0x32d82c(0x244)+_0x5acb5e[_0x32d82c(0x1e6)]+',\x20status='+_0x5acb5e[_0x32d82c(0x29d)]);const _0x1ebc09=_0x5acb5e[_0x32d82c(0x1e6)]+0x1,_0x477547=_0x5acb5e['type']===_0x32d82c(0x295)?_0x32d82c(0x201):_0x5acb5e[_0x32d82c(0x29d)];await database_1[_0x32d82c(0x219)][_0x32d82c(0x1d5)][_0x32d82c(0x237)]({'where':{'id':_0x5acb5e['id']},'data':{'currentPayments':_0x1ebc09,'status':_0x477547,'updatedAt':new Date()}}),console[_0x32d82c(0x1e2)]('✅\x20[COINTOPAY]\x20Payment\x20link\x20'+_0x5acb5e['id']+_0x32d82c(0x1ba)+_0x5acb5e[_0x32d82c(0x1e6)]+_0x32d82c(0x1f5)+_0x1ebc09+_0x32d82c(0x208)+_0x5acb5e[_0x32d82c(0x29d)]+_0x32d82c(0x1f5)+_0x477547);}catch(_0x1c2f45){console[_0x32d82c(0x1f6)]('❌\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:',_0x1c2f45);}else console[_0x32d82c(0x1e2)](_0x32d82c(0x242)+_0x495c19['id']+_0x32d82c(0x28d));}await database_1[_0x32d82c(0x219)]['webhookLog'][_0x32d82c(0x1cf)]({'data':{'paymentId':_0x495c19['id'],'shopId':_0x495c19[_0x32d82c(0x1c5)],'event':_0x32d82c(0x210)+_0x7ff2cc[_0x32d82c(0x29d)][_0x32d82c(0x1dd)](),'statusCode':0xc8,'responseBody':JSON[_0x32d82c(0x1b8)]({'oldStatus':_0x495c19[_0x32d82c(0x29d)],'newStatus':_0x7ff2cc['status'],'paymentDetails':_0x7ff2cc[_0x32d82c(0x253)],'checkedAt':new Date()['toISOString']()})}}),await this[_0x32d82c(0x2b7)](_0x495c19,_0x7ff2cc['status']),await this[_0x32d82c(0x292)](_0x495c19,_0x7ff2cc[_0x32d82c(0x29d)]),_0x7ff2cc[_0x32d82c(0x29d)]!=='PENDING'&&(console['log']('🧹\x20[CHECK]\x20Payment\x20'+_0x495c19['id']+_0x32d82c(0x22a)+_0x7ff2cc[_0x32d82c(0x29d)]+_0x32d82c(0x27d)),this[_0x32d82c(0x1ea)](_0x495c19['id'])),console['log'](_0x32d82c(0x224)+_0x495c19['id']+'\x20updated\x20successfully');}else console[_0x32d82c(0x1e2)](_0x32d82c(0x255)+_0x495c19['id']+_0x32d82c(0x2b8)+_0x7ff2cc['status']+')'),this['logCoinToPayStatus'](_0x495c19['id'],_0x495c19[_0x32d82c(0x24d)],_0x495c19['status'],_0x7ff2cc[_0x32d82c(0x29d)],_0x32d82c(0x2aa),{'statusUnchanged':!![],'paymentDetails':_0x7ff2cc[_0x32d82c(0x253)],'amount':_0x7ff2cc[_0x32d82c(0x2a5)],'currency':_0x7ff2cc[_0x32d82c(0x260)],'shopId':_0x495c19[_0x32d82c(0x1c5)],'checkTimestamp':new Date()['toISOString']()});}catch(_0x357015){console[_0x32d82c(0x1f6)](_0x32d82c(0x1c0)+_0x495c19['id']+':',_0x357015),this['logCoinToPayError'](_0x495c19['id'],_0x495c19[_0x32d82c(0x24d)],_0x357015,_0x32d82c(0x2aa),{'paymentAmount':_0x495c19['amount'],'paymentCurrency':_0x495c19[_0x32d82c(0x260)],'shopId':_0x495c19[_0x32d82c(0x1c5)],'createdAt':_0x495c19[_0x32d82c(0x1f9)]}),await database_1[_0x32d82c(0x219)][_0x32d82c(0x20b)][_0x32d82c(0x1cf)]({'data':{'paymentId':_0x495c19['id'],'shopId':_0x495c19[_0x32d82c(0x1c5)],'event':_0x32d82c(0x27e),'statusCode':0x1f4,'responseBody':JSON[_0x32d82c(0x1b8)]({'error':_0x357015 instanceof Error?_0x357015[_0x32d82c(0x259)]:_0x32d82c(0x238),'gatewayPaymentId':_0x495c19['gatewayPaymentId'],'checkedAt':new Date()[_0x32d82c(0x249)]()})}});}}async[a38_0x2b1ce3(0x2b7)](_0x334153,_0x38fa1d){const _0xcb9064=a38_0x2b1ce3,_0x83024f=Date['now']();try{const _0x8c41ac=_0x334153[_0xcb9064(0x26d)],_0x33c7ac=_0x8c41ac[_0xcb9064(0x227)];if(!_0x33c7ac?.[_0xcb9064(0x287)]){console['log'](_0xcb9064(0x1be)+_0x8c41ac['id']);return;}const _0x534962=_0x38fa1d===_0xcb9064(0x2be)?_0xcb9064(0x1fe):_0x38fa1d===_0xcb9064(0x26b)?'payment.failed':_0x38fa1d===_0xcb9064(0x2a4)?_0xcb9064(0x202):_0xcb9064(0x233);if(!_0x33c7ac['webhookEvents']?.[_0xcb9064(0x215)](_0x534962)){console[_0xcb9064(0x1e2)](_0xcb9064(0x23d)+_0x534962+_0xcb9064(0x1f1)+_0x8c41ac['id']);return;}const _0x3dbf7c=(0x0,gateway_1[_0xcb9064(0x2a7)])(_0x334153[_0xcb9064(0x277)])||_0x334153[_0xcb9064(0x277)],_0x5a8b0d={'event':_0x534962,'payment':{'id':_0x334153['id'],'order_id':_0x334153['orderId'],'gateway_order_id':_0x334153[_0xcb9064(0x296)],'gateway':_0x3dbf7c,'amount':_0x334153[_0xcb9064(0x2a5)],'currency':_0x334153['currency'],'status':_0x38fa1d[_0xcb9064(0x1dd)](),'customer_email':_0x334153[_0xcb9064(0x264)],'customer_name':_0x334153[_0xcb9064(0x1d4)],'created_at':_0x334153[_0xcb9064(0x1f9)],'updated_at':new Date()}},_0x4a3327=await fetch(_0x33c7ac[_0xcb9064(0x287)],{'method':'POST','headers':{'Content-Type':_0xcb9064(0x1bf),'User-Agent':_0xcb9064(0x2af)},'body':JSON['stringify'](_0x5a8b0d)}),_0x6a58b4=Date[_0xcb9064(0x243)]()-_0x83024f,_0x45c36d=_0x4a3327['ok']?_0xcb9064(0x281):await _0x4a3327[_0xcb9064(0x2bd)]();loggerService_1[_0xcb9064(0x22e)][_0xcb9064(0x200)](_0x334153['shopId'],_0x33c7ac[_0xcb9064(0x287)],_0x534962,_0x4a3327[_0xcb9064(0x29d)],_0x6a58b4,_0x5a8b0d),console[_0xcb9064(0x1e2)](_0xcb9064(0x23e)+_0x33c7ac[_0xcb9064(0x287)]+_0xcb9064(0x24e)+_0x4a3327[_0xcb9064(0x29d)]+'\x20('+_0x6a58b4+_0xcb9064(0x298));}catch(_0x2f263e){console[_0xcb9064(0x1f6)]('Failed\x20to\x20send\x20shop\x20webhook:',_0x2f263e),loggerService_1[_0xcb9064(0x22e)][_0xcb9064(0x220)](_0x334153[_0xcb9064(0x1c5)],_0x334153['shop']?.[_0xcb9064(0x227)]?.[_0xcb9064(0x287)]||'unknown',_0xcb9064(0x2a2),_0x2f263e,{});}}async[a38_0x2b1ce3(0x292)](_0x534a5b,_0x414c65){const _0x24c22e=a38_0x2b1ce3;try{const _0x58f049={'PENDING':_0x24c22e(0x293),'PAID':'paid','FAILED':'failed','EXPIRED':_0x24c22e(0x21a)},_0x287903=_0x58f049[_0x414c65];if(!_0x287903||_0x287903==='created')return;await telegramBotService_1[_0x24c22e(0x240)][_0x24c22e(0x207)](_0x534a5b[_0x24c22e(0x1c5)],_0x534a5b,_0x287903);}catch(_0x5e5230){console['error']('Failed\x20to\x20send\x20Telegram\x20payment\x20notification:',_0x5e5230);}}async[a38_0x2b1ce3(0x1fb)](_0x211e0b){const _0x2cb3fb=a38_0x2b1ce3;console[_0x2cb3fb(0x1e2)]('🔍\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20'+_0x211e0b);const _0x1583bf=await database_1[_0x2cb3fb(0x219)][_0x2cb3fb(0x278)][_0x2cb3fb(0x1fd)]({'where':{'id':_0x211e0b},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x1583bf)throw new Error(_0x2cb3fb(0x228));if(_0x1583bf[_0x2cb3fb(0x277)]!==_0x2cb3fb(0x28c)&&_0x1583bf[_0x2cb3fb(0x277)]!==_0x2cb3fb(0x1d3))throw new Error(_0x2cb3fb(0x262));console['log']('✅\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20'+_0x1583bf[_0x2cb3fb(0x277)]+_0x2cb3fb(0x23a)+_0x211e0b),await this['checkSinglePayment'](_0x1583bf),console['log']('✅\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20'+_0x211e0b);}[a38_0x2b1ce3(0x1ec)](){const _0x3371c7=a38_0x2b1ce3,_0x26b1c4=this['globalCheckInterval']?this[_0x3371c7(0x1b5)]:undefined,_0x1c4d3d=Array[_0x3371c7(0x2a3)](this['paymentTimers']['values']())[_0x3371c7(0x1f3)](_0x471e1c=>({'paymentId':_0x471e1c['paymentId'],'gatewayPaymentId':_0x471e1c[_0x3371c7(0x24d)],'createdAt':_0x471e1c['createdAt'],'timersCount':_0x471e1c[_0x3371c7(0x20a)]['length']}));return{'isActive':!!this[_0x3371c7(0x2ae)],'globalCheckIntervalMinutes':this[_0x3371c7(0x1b5)]/(0x3e8*0x3c),'expiryDays':this[_0x3371c7(0x24b)],'activeIndividualTimers':this[_0x3371c7(0x285)]['size'],'nextGlobalCheckIn':_0x26b1c4,'paymentTimersDetails':_0x1c4d3d};}[a38_0x2b1ce3(0x1cd)](_0x3d5862){const _0x387aac=a38_0x2b1ce3,_0x1316fc=this[_0x387aac(0x285)][_0x387aac(0x226)](_0x3d5862);if(_0x1316fc)return{'hasTimers':!![],'timersCount':_0x1316fc[_0x387aac(0x20a)]['length'],'createdAt':_0x1316fc['createdAt'],'gatewayPaymentId':_0x1316fc[_0x387aac(0x24d)]};return{'hasTimers':![]};}async[a38_0x2b1ce3(0x251)](_0x3a3b12,_0x29c7a2){const _0x4f64ec=a38_0x2b1ce3;try{const _0x3ec01c=await database_1[_0x4f64ec(0x219)]['shop']['findUnique']({'where':{'id':_0x3a3b12},'select':{'gatewaySettings':!![]}});if(!_0x3ec01c?.[_0x4f64ec(0x29a)])return console['log'](_0x4f64ec(0x27b)+_0x3a3b12+',\x20using\x20default\x20commission\x2010%'),0xa;const _0x4b578f=JSON['parse'](_0x3ec01c[_0x4f64ec(0x29a)]);for(const [_0x2182f6,_0x2582e0]of Object[_0x4f64ec(0x271)](_0x4b578f)){if(_0x2182f6[_0x4f64ec(0x1dd)]()===_0x29c7a2[_0x4f64ec(0x1dd)]()){const _0x390321=_0x2582e0[_0x4f64ec(0x23c)]||0xa;return console[_0x4f64ec(0x1e2)]('Gateway\x20'+_0x29c7a2+_0x4f64ec(0x1d0)+_0x3a3b12+':\x20'+_0x390321+'%'),_0x390321;}}return console[_0x4f64ec(0x1e2)](_0x4f64ec(0x234)+_0x29c7a2+_0x4f64ec(0x25d)+_0x3a3b12+_0x4f64ec(0x235)),0xa;}catch(_0x55eef9){return console['error'](_0x4f64ec(0x29b)+_0x3a3b12+_0x4f64ec(0x2b6)+_0x29c7a2+':',_0x55eef9),0xa;}}}function a38_0x3bd1(_0x6f56f7,_0x13f7c6){const _0x4c70c1=a38_0x4c70();return a38_0x3bd1=function(_0x3bd1e3,_0x5372a8){_0x3bd1e3=_0x3bd1e3-0x1b5;let _0xd1db18=_0x4c70c1[_0x3bd1e3];return _0xd1db18;},a38_0x3bd1(_0x6f56f7,_0x13f7c6);}exports[a38_0x2b1ce3(0x20c)]=CoinToPayStatusService,exports[a38_0x2b1ce3(0x1db)]=new CoinToPayStatusService();