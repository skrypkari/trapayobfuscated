'use strict';const a38_0x208712=a38_0x326c;(function(_0x10ffea,_0x2f5030){const _0x50eb36=a38_0x326c,_0x586c28=_0x10ffea();while(!![]){try{const _0x516ac2=parseInt(_0x50eb36(0x22b))/0x1+-parseInt(_0x50eb36(0x1e0))/0x2+parseInt(_0x50eb36(0x19f))/0x3*(-parseInt(_0x50eb36(0x173))/0x4)+parseInt(_0x50eb36(0x1d9))/0x5+-parseInt(_0x50eb36(0x20c))/0x6*(-parseInt(_0x50eb36(0x176))/0x7)+parseInt(_0x50eb36(0x212))/0x8+-parseInt(_0x50eb36(0x18b))/0x9;if(_0x516ac2===_0x2f5030)break;else _0x586c28['push'](_0x586c28['shift']());}catch(_0x276a90){_0x586c28['push'](_0x586c28['shift']());}}}(a38_0x5acb,0xdaac5));function a38_0x326c(_0x50db78,_0x416474){const _0x5acbb1=a38_0x5acb();return a38_0x326c=function(_0x326c36,_0x150fde){_0x326c36=_0x326c36-0x126;let _0x1a3e83=_0x5acbb1[_0x326c36];return _0x1a3e83;},a38_0x326c(_0x50db78,_0x416474);}var __importDefault=this&&this[a38_0x208712(0x178)]||function(_0x2565cd){const _0x16fff9=a38_0x208712;return _0x2565cd&&_0x2565cd[_0x16fff9(0x172)]?_0x2565cd:{'default':_0x2565cd};};Object[a38_0x208712(0x1a4)](exports,a38_0x208712(0x172),{'value':!![]}),exports[a38_0x208712(0x1e5)]=exports[a38_0x208712(0x163)]=void 0x0;const coinToPayService_1=require('./gateways/coinToPayService'),coinToPay2Service_1=require('./gateways/coinToPay2Service'),gateway_1=require(a38_0x208712(0x198)),database_1=__importDefault(require(a38_0x208712(0x216))),telegramBotService_1=require(a38_0x208712(0x1b6)),loggerService_1=require('./loggerService'),currencyService_1=require(a38_0x208712(0x22e));class CoinToPayStatusService{constructor(){const _0x3a4250=a38_0x208712;this[_0x3a4250(0x140)]=null,this[_0x3a4250(0x146)]=0x3c*0x3c*0x3e8,this[_0x3a4250(0x1b9)]=0x5,this[_0x3a4250(0x13b)]=new Map(),this['coinToPayService']=new coinToPayService_1[(_0x3a4250(0x13d))](),this[_0x3a4250(0x1a0)]=new coinToPay2Service_1[(_0x3a4250(0x17d))](),console[_0x3a4250(0x1e6)](_0x3a4250(0x1f7));}[a38_0x208712(0x15e)](_0x573676,_0x2610d9){const _0x254e0e=a38_0x208712;console[_0x254e0e(0x1e6)]('ü™ô\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:'),console[_0x254e0e(0x1e6)]('\x20\x20\x20-\x20paymentId:\x20'+_0x573676),console[_0x254e0e(0x1e6)](_0x254e0e(0x1bb)+_0x2610d9),this[_0x254e0e(0x157)](_0x573676);const _0x1995a5=[],_0x2c0f6f=new Date(),_0x3e5043=[{'delay':0x1*0x3c*0x3e8,'description':_0x254e0e(0x1cb)},{'delay':0x2*0x3c*0x3e8,'description':'2\x20minutes'},{'delay':0x5*0x3c*0x3e8,'description':_0x254e0e(0x167)},{'delay':0x5*0x3c*0x3e8,'description':_0x254e0e(0x167)}];console['log']('ü™ô\x20[DEBUG]\x20Creating\x20'+_0x3e5043[_0x254e0e(0x1b2)]+'\x20initial\x20timers\x20for\x20payment\x20'+_0x573676);let _0x19f7c4=0x0;_0x3e5043['forEach']((_0x3278db,_0x2884de)=>{const _0x133fa1=_0x254e0e;_0x19f7c4+=_0x3278db[_0x133fa1(0x17f)];const _0x28904e=setTimeout(async()=>{const _0x2ae1a2=_0x133fa1;console['log'](_0x2ae1a2(0x18d)+(_0x2884de+0x1)+_0x2ae1a2(0x160)+_0x573676+_0x2ae1a2(0x1d4)+_0x3278db[_0x2ae1a2(0x206)]+')');try{await this['checkSinglePaymentById'](_0x573676),console[_0x2ae1a2(0x1e6)](_0x2ae1a2(0x16d)+(_0x2884de+0x1)+_0x2ae1a2(0x14d)+_0x573676);}catch(_0x145f7f){console['error']('‚ùå\x20[TIMER]\x20Failed\x20individual\x20check\x20#'+(_0x2884de+0x1)+_0x2ae1a2(0x17a)+_0x573676+':',_0x145f7f),this[_0x2ae1a2(0x1aa)](_0x573676,_0x2610d9,_0x145f7f,_0x2ae1a2(0x1d6),{'checkNumber':_0x2884de+0x1,'scheduledAfter':_0x3278db[_0x2ae1a2(0x206)],'isIndividualCheck':!![]});}},_0x19f7c4);_0x1995a5[_0x133fa1(0x210)](_0x28904e),console[_0x133fa1(0x1e6)]('‚è∞\x20[DEBUG]\x20Scheduled\x20check\x20#'+(_0x2884de+0x1)+'\x20for\x20payment\x20'+_0x573676+_0x133fa1(0x1fb)+_0x19f7c4/0x3e8+_0x133fa1(0x199)+_0x3278db[_0x133fa1(0x206)]+')');});const _0x2075ac=setInterval(async()=>{const _0x56316a=_0x254e0e;console[_0x56316a(0x1e6)]('ü™ô\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20'+_0x573676);try{const _0x34a158=await database_1[_0x56316a(0x1ea)][_0x56316a(0x148)]['findUnique']({'where':{'id':_0x573676},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x34a158){console[_0x56316a(0x1e6)]('‚ùå\x20[HOURLY]\x20Payment\x20'+_0x573676+_0x56316a(0x1fc)),this[_0x56316a(0x157)](_0x573676);return;}console[_0x56316a(0x1e6)](_0x56316a(0x164)+_0x573676+'\x20current\x20status:\x20'+_0x34a158[_0x56316a(0x1d8)]);if(_0x34a158[_0x56316a(0x1d8)]!==_0x56316a(0x15b)){console[_0x56316a(0x1e6)](_0x56316a(0x1da)+_0x573676+_0x56316a(0x1e1)+_0x34a158[_0x56316a(0x1d8)]+_0x56316a(0x179)),this[_0x56316a(0x157)](_0x573676);return;}const _0x45454d=Math[_0x56316a(0x152)]((Date[_0x56316a(0x183)]()-_0x34a158[_0x56316a(0x168)][_0x56316a(0x1bd)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x45454d>=this[_0x56316a(0x1b9)]){console[_0x56316a(0x1e6)](_0x56316a(0x197)+_0x573676+_0x56316a(0x225)+this[_0x56316a(0x1b9)]+_0x56316a(0x1fe)),this[_0x56316a(0x157)](_0x573676);return;}await this[_0x56316a(0x19c)](_0x573676),console[_0x56316a(0x1e6)](_0x56316a(0x190)+_0x573676);}catch(_0x322b8f){console[_0x56316a(0x211)]('‚ùå\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20'+_0x573676+':',_0x322b8f),this[_0x56316a(0x1aa)](_0x573676,_0x2610d9,_0x322b8f,_0x56316a(0x1d6),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x1995a5[_0x254e0e(0x210)](_0x2075ac),this[_0x254e0e(0x13b)][_0x254e0e(0x12e)](_0x573676,{'timers':_0x1995a5,'paymentId':_0x573676,'gatewayPaymentId':_0x2610d9,'createdAt':_0x2c0f6f}),console[_0x254e0e(0x1e6)](_0x254e0e(0x153)+_0x3e5043[_0x254e0e(0x1b2)]+'\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20'+_0x573676),console[_0x254e0e(0x1e6)](_0x254e0e(0x227)+this[_0x254e0e(0x13b)][_0x254e0e(0x1de)]),this[_0x254e0e(0x1b5)](_0x573676,_0x2610d9,_0x254e0e(0x15b),_0x254e0e(0x15b),_0x254e0e(0x1d6),{'action':'schedule_created','scheduledChecks':_0x3e5043[_0x254e0e(0x1b2)],'firstCheckIn':_0x3e5043[0x0][_0x254e0e(0x17f)]/0x3e8,'totalTimers':this['paymentTimers'][_0x254e0e(0x1de)]});}[a38_0x208712(0x157)](_0x257ec5){const _0x355cc1=a38_0x208712,_0x25bdd6=this[_0x355cc1(0x13b)][_0x355cc1(0x220)](_0x257ec5);_0x25bdd6?(console[_0x355cc1(0x1e6)](_0x355cc1(0x1a8)+_0x25bdd6[_0x355cc1(0x129)][_0x355cc1(0x1b2)]+_0x355cc1(0x1dc)+_0x257ec5),_0x25bdd6[_0x355cc1(0x129)]['forEach']((_0x1a383e,_0x142cdf)=>{const _0x5c5342=_0x355cc1;_0x1a383e&&(clearTimeout(_0x1a383e),clearInterval(_0x1a383e),console[_0x5c5342(0x1e6)](_0x5c5342(0x22a)+(_0x142cdf+0x1)+_0x5c5342(0x17a)+_0x257ec5));}),this[_0x355cc1(0x13b)]['delete'](_0x257ec5),console[_0x355cc1(0x1e6)]('‚úÖ\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20'+_0x257ec5+_0x355cc1(0x12c)+this[_0x355cc1(0x13b)][_0x355cc1(0x1de)])):console[_0x355cc1(0x1e6)](_0x355cc1(0x1db)+_0x257ec5+_0x355cc1(0x1a1));}async[a38_0x208712(0x19c)](_0x1fe82d){const _0x2786ee=a38_0x208712;console[_0x2786ee(0x1e6)](_0x2786ee(0x1df)+_0x1fe82d);const _0x103cc2=await database_1['default'][_0x2786ee(0x148)]['findUnique']({'where':{'id':_0x1fe82d},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x103cc2){console[_0x2786ee(0x1e6)](_0x2786ee(0x1f8)+_0x1fe82d+_0x2786ee(0x174));return;}console['log'](_0x2786ee(0x13f)+_0x1fe82d+_0x2786ee(0x1ec)),console[_0x2786ee(0x1e6)](_0x2786ee(0x1f0)+_0x103cc2[_0x2786ee(0x20a)]),console['log'](_0x2786ee(0x17e)+_0x103cc2[_0x2786ee(0x1d8)]),console[_0x2786ee(0x1e6)](_0x2786ee(0x1b3)+_0x103cc2[_0x2786ee(0x200)]),console[_0x2786ee(0x1e6)]('\x20\x20\x20-\x20Amount:\x20'+_0x103cc2['amount']+'\x20'+_0x103cc2[_0x2786ee(0x15f)]),console[_0x2786ee(0x1e6)](_0x2786ee(0x201)+_0x103cc2['shopId']);if(_0x103cc2[_0x2786ee(0x20a)]!=='cointopay'&&_0x103cc2[_0x2786ee(0x20a)]!==_0x2786ee(0x1d0)){console['log']('‚ö†Ô∏è\x20[CHECK]\x20Payment\x20'+_0x1fe82d+_0x2786ee(0x1c3)+_0x103cc2[_0x2786ee(0x20a)]+')');return;}if(_0x103cc2['status']!==_0x2786ee(0x15b)){console['log'](_0x2786ee(0x1dd)+_0x1fe82d+_0x2786ee(0x1e1)+_0x103cc2[_0x2786ee(0x1d8)]+',\x20stopping\x20individual\x20checks'),this[_0x2786ee(0x157)](_0x1fe82d);return;}if(!_0x103cc2[_0x2786ee(0x200)]){console[_0x2786ee(0x1e6)](_0x2786ee(0x1dd)+_0x1fe82d+'\x20has\x20no\x20gatewayPaymentId');return;}console[_0x2786ee(0x1e6)](_0x2786ee(0x1f2)+_0x1fe82d+_0x2786ee(0x21f)),await this[_0x2786ee(0x181)](_0x103cc2);}['logCoinToPayStatus'](_0x27fea8,_0x5c054f,_0x3ac799,_0xf568b7,_0x2a9dd5,_0x3ca923){const _0x395dd7=a38_0x208712,_0x452956={'type':_0x395dd7(0x1f6),'paymentId':_0x27fea8,'gatewayPaymentId':_0x5c054f,'oldStatus':_0x3ac799,'newStatus':_0xf568b7,'source':_0x2a9dd5,'timestamp':new Date()['toISOString'](),'details':_0x3ca923||{}};loggerService_1[_0x395dd7(0x16b)]['logCoinToPayStatus'](_0x452956),console[_0x395dd7(0x1e6)]('ü™ô\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20'+_0x27fea8+'\x20('+_0x5c054f+')'),console[_0x395dd7(0x1e6)](_0x395dd7(0x180)+_0x3ac799+_0x395dd7(0x1b4)+_0xf568b7),console[_0x395dd7(0x1e6)](_0x395dd7(0x1bf)+_0x2a9dd5),console['log'](_0x395dd7(0x1ab)+_0x452956[_0x395dd7(0x144)]),_0x3ca923&&console[_0x395dd7(0x1e6)](_0x395dd7(0x221),_0x3ca923);}[a38_0x208712(0x1aa)](_0x4a2b8b,_0x71aba5,_0x23e223,_0x5b4805,_0x188349){const _0x9f9223=a38_0x208712,_0x2b1526={'type':_0x9f9223(0x132),'paymentId':_0x4a2b8b,'gatewayPaymentId':_0x71aba5,'error':_0x23e223 instanceof Error?{'message':_0x23e223[_0x9f9223(0x175)],'stack':_0x23e223[_0x9f9223(0x1eb)]}:_0x23e223,'source':_0x5b4805,'timestamp':new Date()[_0x9f9223(0x19b)](),'context':_0x188349||{}};loggerService_1[_0x9f9223(0x16b)][_0x9f9223(0x1aa)](_0x2b1526),console['error']('ü™ô\x20[ERROR]\x20CoinToPay\x20Error:\x20'+_0x4a2b8b+'\x20('+_0x71aba5+')'),console[_0x9f9223(0x211)](_0x9f9223(0x159)+(_0x23e223 instanceof Error?_0x23e223[_0x9f9223(0x175)]:_0x23e223)),console['error'](_0x9f9223(0x1bf)+_0x5b4805),console[_0x9f9223(0x211)](_0x9f9223(0x1ab)+_0x2b1526[_0x9f9223(0x144)]),_0x188349&&console[_0x9f9223(0x211)](_0x9f9223(0x143),_0x188349);}['startPeriodicStatusCheck'](){const _0x5f140d=a38_0x208712;console['log'](_0x5f140d(0x150)),this[_0x5f140d(0x156)]()[_0x5f140d(0x1f1)](_0x482f7e=>{const _0x24237c=_0x5f140d;console[_0x24237c(0x211)](_0x24237c(0x1a3),_0x482f7e);}),this[_0x5f140d(0x140)]=setInterval(async()=>{const _0x364dd6=_0x5f140d;try{console[_0x364dd6(0x1e6)](_0x364dd6(0x1fd)),await this[_0x364dd6(0x156)](),console[_0x364dd6(0x1e6)](_0x364dd6(0x1b1));}catch(_0x394224){console[_0x364dd6(0x211)](_0x364dd6(0x18f),_0x394224);}},this['GLOBAL_CHECK_INTERVAL_MS']),console[_0x5f140d(0x1e6)](_0x5f140d(0x1a7));}[a38_0x208712(0x186)](){const _0x12443d=a38_0x208712;console[_0x12443d(0x1e6)](_0x12443d(0x1e3));this[_0x12443d(0x140)]&&(clearInterval(this[_0x12443d(0x140)]),this[_0x12443d(0x140)]=null,console['log'](_0x12443d(0x218)));const _0x51dc5c=this['paymentTimers'][_0x12443d(0x1de)];for(const [_0x37dea8]of this['paymentTimers']){this[_0x12443d(0x157)](_0x37dea8);}console[_0x12443d(0x1e6)](_0x12443d(0x1c4)+_0x51dc5c+'\x20individual\x20payment\x20timers');}async[a38_0x208712(0x156)](){const _0x12768b=a38_0x208712;try{console[_0x12768b(0x1e6)](_0x12768b(0x185));const _0x21ff02=await database_1[_0x12768b(0x1ea)][_0x12768b(0x148)][_0x12768b(0x1a6)]({'where':{'gateway':{'in':[_0x12768b(0x222),_0x12768b(0x1d0)]},'status':_0x12768b(0x15b),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x12768b(0x1e6)](_0x12768b(0x171)+_0x21ff02[_0x12768b(0x1b2)]+_0x12768b(0x1d2));if(_0x21ff02['length']===0x0){console['log'](_0x12768b(0x16a));return;}const _0x33ef6c=await this[_0x12768b(0x17b)](_0x21ff02);console[_0x12768b(0x1e6)](_0x12768b(0x229)+_0x33ef6c[_0x12768b(0x1b2)]+_0x12768b(0x1cc));let _0x14cd7a=0x0,_0x1844f9=0x0;for(const _0x465035 of _0x21ff02){try{if(_0x33ef6c[_0x12768b(0x169)](_0x465035['id'])){console['log'](_0x12768b(0x1ad)+_0x465035['id']+'\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check'),_0x1844f9++;continue;}if(this['paymentTimers']['has'](_0x465035['id'])){console[_0x12768b(0x1e6)]('‚è∞\x20[GLOBAL]\x20Payment\x20'+_0x465035['id']+_0x12768b(0x128)),_0x1844f9++;continue;}const _0x17b10f=(Date[_0x12768b(0x183)]()-_0x465035[_0x12768b(0x168)]['getTime']())/(0x3e8*0x3c*0x3c);if(_0x17b10f<0x1){console[_0x12768b(0x1e6)](_0x12768b(0x1ad)+_0x465035['id']+_0x12768b(0x1bc)+_0x17b10f[_0x12768b(0x203)](0x1)+_0x12768b(0x21a)),_0x1844f9++;continue;}console[_0x12768b(0x1e6)](_0x12768b(0x21d)+_0x465035['id']+_0x12768b(0x194)+_0x17b10f[_0x12768b(0x203)](0x1)+'h)'),await this['checkSinglePayment'](_0x465035),_0x14cd7a++,await new Promise(_0x3df88c=>setTimeout(_0x3df88c,0x7d0));}catch(_0x1c6ee7){console['error']('‚ùå\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20'+_0x465035['id']+':',_0x1c6ee7),this[_0x12768b(0x1aa)](_0x465035['id'],_0x465035[_0x12768b(0x200)]||'unknown',_0x1c6ee7,_0x12768b(0x1d6),{'isGlobalCheck':!![],'paymentAmount':_0x465035[_0x12768b(0x1e7)],'paymentCurrency':_0x465035[_0x12768b(0x15f)],'shopId':_0x465035[_0x12768b(0x1c8)],'createdAt':_0x465035[_0x12768b(0x168)]}),loggerService_1[_0x12768b(0x16b)][_0x12768b(0x15a)]('cointopay',_0x12768b(0x15c)+_0x465035[_0x12768b(0x200)],_0x1c6ee7);}}console[_0x12768b(0x1e6)](_0x12768b(0x184)+_0x14cd7a+'\x20checked,\x20'+_0x1844f9+'\x20skipped,\x20'+_0x33ef6c['length']+_0x12768b(0x155));}catch(_0x26cf0f){console[_0x12768b(0x211)]('‚ùå\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:',_0x26cf0f);}}async[a38_0x208712(0x17b)](_0x2571a6){const _0x1ae10b=a38_0x208712,_0xc1ecbb=[],_0x4c071e=new Date();_0x4c071e[_0x1ae10b(0x141)](_0x4c071e[_0x1ae10b(0x14e)]()-this[_0x1ae10b(0x1b9)]),console[_0x1ae10b(0x1e6)]('‚è∞\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20'+this[_0x1ae10b(0x1b9)]+_0x1ae10b(0x1ac)+_0x4c071e['toISOString']()+')');for(const _0xa71179 of _0x2571a6){if(_0xa71179[_0x1ae10b(0x168)]<_0x4c071e){console[_0x1ae10b(0x1e6)](_0x1ae10b(0x15d)+_0xa71179['id']+_0x1ae10b(0x225)+this['EXPIRY_DAYS']+_0x1ae10b(0x182));try{this['logCoinToPayStatus'](_0xa71179['id'],_0xa71179['gatewayPaymentId']||_0x1ae10b(0x191),_0x1ae10b(0x15b),_0x1ae10b(0x12d),_0x1ae10b(0x1c7),{'reason':_0x1ae10b(0x208)+this[_0x1ae10b(0x1b9)]+_0x1ae10b(0x147),'createdAt':_0xa71179[_0x1ae10b(0x168)],'daysSinceCreation':Math[_0x1ae10b(0x152)]((Date[_0x1ae10b(0x183)]()-_0xa71179[_0x1ae10b(0x168)]['getTime']())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0xa71179[_0x1ae10b(0x1e7)],'paymentCurrency':_0xa71179[_0x1ae10b(0x15f)],'shopId':_0xa71179[_0x1ae10b(0x1c8)]}),await database_1[_0x1ae10b(0x1ea)][_0x1ae10b(0x148)][_0x1ae10b(0x18a)]({'where':{'id':_0xa71179['id']},'data':{'status':_0x1ae10b(0x12d),'updatedAt':new Date(),'adminNotes':_0x1ae10b(0x1ff)+this[_0x1ae10b(0x1b9)]+_0x1ae10b(0x205)}}),await database_1[_0x1ae10b(0x1ea)]['webhookLog'][_0x1ae10b(0x19e)]({'data':{'paymentId':_0xa71179['id'],'shopId':_0xa71179[_0x1ae10b(0x1c8)],'event':'cointopay_auto_expired','statusCode':0xc8,'responseBody':JSON['stringify']({'reason':_0x1ae10b(0x208)+this[_0x1ae10b(0x1b9)]+_0x1ae10b(0x147),'createdAt':_0xa71179['createdAt'],'expiredAt':new Date()[_0x1ae10b(0x19b)](),'daysSinceCreation':Math[_0x1ae10b(0x152)]((Date[_0x1ae10b(0x183)]()-_0xa71179[_0x1ae10b(0x168)]['getTime']())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x1ae10b(0x1ba)](_0xa71179,_0x1ae10b(0x12d)),await this[_0x1ae10b(0x158)](_0xa71179,'EXPIRED'),this[_0x1ae10b(0x157)](_0xa71179['id']),_0xc1ecbb[_0x1ae10b(0x210)](_0xa71179['id']),console['log'](_0x1ae10b(0x1f4)+_0xa71179['id']+_0x1ae10b(0x127)+this[_0x1ae10b(0x1b9)]+_0x1ae10b(0x1f3));}catch(_0x492f17){console['error'](_0x1ae10b(0x223)+_0xa71179['id']+':',_0x492f17),this[_0x1ae10b(0x1aa)](_0xa71179['id'],_0xa71179[_0x1ae10b(0x200)]||_0x1ae10b(0x191),_0x492f17,_0x1ae10b(0x1c7),{'reason':'Failed\x20to\x20mark\x20payment\x20as\x20expired','createdAt':_0xa71179[_0x1ae10b(0x168)],'daysSinceCreation':Math[_0x1ae10b(0x152)]((Date[_0x1ae10b(0x183)]()-_0xa71179['createdAt']['getTime']())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0xc1ecbb;}async[a38_0x208712(0x181)](_0x536e48){const _0x3f02f9=a38_0x208712;if(!_0x536e48[_0x3f02f9(0x200)]){console[_0x3f02f9(0x1e6)](_0x3f02f9(0x1dd)+_0x536e48['id']+_0x3f02f9(0x1cd));return;}console[_0x3f02f9(0x1e6)](_0x3f02f9(0x165)+_0x536e48[_0x3f02f9(0x20a)]+_0x3f02f9(0x1fa)+_0x536e48['id']+'\x20('+_0x536e48[_0x3f02f9(0x200)]+')');try{let _0x48d887;_0x536e48[_0x3f02f9(0x20a)]===_0x3f02f9(0x1d0)?(_0x48d887=await this[_0x3f02f9(0x1a0)][_0x3f02f9(0x22d)](_0x536e48['gatewayPaymentId']),console[_0x3f02f9(0x1e6)]('üìä\x20[CHECK]\x20CoinToPay2\x20payment\x20'+_0x536e48['id']+_0x3f02f9(0x18e)+_0x48d887[_0x3f02f9(0x1d8)])):(_0x48d887=await this[_0x3f02f9(0x149)][_0x3f02f9(0x22d)](_0x536e48[_0x3f02f9(0x200)]),console[_0x3f02f9(0x1e6)]('üìä\x20[CHECK]\x20CoinToPay\x20payment\x20'+_0x536e48['id']+_0x3f02f9(0x18e)+_0x48d887[_0x3f02f9(0x1d8)]));_0x48d887[_0x3f02f9(0x14a)]&&console[_0x3f02f9(0x1e6)]('üìä\x20[CHECK]\x20Payment\x20'+_0x536e48['id']+_0x3f02f9(0x138),{'iban':_0x48d887[_0x3f02f9(0x14a)][_0x3f02f9(0x1af)]||_0x3f02f9(0x1c9),'transactionId':_0x48d887[_0x3f02f9(0x14a)][_0x3f02f9(0x20d)],'createdOn':_0x48d887[_0x3f02f9(0x14a)]['createdOn'],'confirmedOn':_0x48d887['paymentDetails'][_0x3f02f9(0x215)]||_0x3f02f9(0x145)});if(_0x48d887[_0x3f02f9(0x1d8)]!==_0x536e48[_0x3f02f9(0x1d8)]){console[_0x3f02f9(0x1e6)]('üîÑ\x20[CHECK]\x20Updating\x20payment\x20'+_0x536e48['id']+_0x3f02f9(0x12f)+_0x536e48['status']+'\x20to\x20'+_0x48d887['status']),this[_0x3f02f9(0x1b5)](_0x536e48['id'],_0x536e48[_0x3f02f9(0x200)],_0x536e48[_0x3f02f9(0x1d8)],_0x48d887[_0x3f02f9(0x1d8)],_0x3f02f9(0x1d6),{'paymentDetails':_0x48d887['paymentDetails'],'amount':_0x48d887['amount'],'currency':_0x48d887[_0x3f02f9(0x15f)],'shopId':_0x536e48['shopId'],'checkTimestamp':new Date()[_0x3f02f9(0x19b)]()});const _0x401bb0={'status':_0x48d887[_0x3f02f9(0x1d8)],'updatedAt':new Date()};if(_0x48d887[_0x3f02f9(0x1d8)]===_0x3f02f9(0x1e4)&&_0x536e48['status']!==_0x3f02f9(0x1e4)){_0x401bb0[_0x3f02f9(0x1c1)]=new Date();if(!_0x536e48[_0x3f02f9(0x188)]){const _0xb4726=await currencyService_1[_0x3f02f9(0x136)]['convertToUSDT'](_0x536e48[_0x3f02f9(0x1e7)],_0x536e48['currency']);_0x401bb0[_0x3f02f9(0x188)]=_0xb4726;const _0x4aad57=await this[_0x3f02f9(0x1e2)](_0x536e48[_0x3f02f9(0x1c8)],_0x536e48[_0x3f02f9(0x20a)]),_0x108a80=_0xb4726*(0x1-_0x4aad57/0x64);_0x401bb0[_0x3f02f9(0x14c)]=_0x108a80,_0x401bb0[_0x3f02f9(0x1c6)]=_0x4aad57,console[_0x3f02f9(0x1e6)](_0x3f02f9(0x134)+_0x536e48['id']+_0x3f02f9(0x16c)),console[_0x3f02f9(0x1e6)](_0x3f02f9(0x1ef)+_0x536e48[_0x3f02f9(0x1e7)]+'\x20'+_0x536e48[_0x3f02f9(0x15f)]+'\x20->\x20'+_0xb4726['toFixed'](0x6)+_0x3f02f9(0x1b8)),console[_0x3f02f9(0x1e6)](_0x3f02f9(0x133)+_0x536e48[_0x3f02f9(0x20a)]+'\x20commission:\x20'+_0x4aad57+'%'),console[_0x3f02f9(0x1e6)]('\x20\x20\x20Amount\x20after\x20commission:\x20'+_0x108a80[_0x3f02f9(0x203)](0x6)+'\x20USDT');}console[_0x3f02f9(0x1e6)](_0x3f02f9(0x134)+_0x536e48['id']+_0x3f02f9(0x12a)+_0x401bb0[_0x3f02f9(0x1c1)][_0x3f02f9(0x19b)]());}if(_0x48d887[_0x3f02f9(0x14a)]){const _0x1f1fbe=_0x48d887[_0x3f02f9(0x14a)];_0x1f1fbe[_0x3f02f9(0x1af)]&&(_0x401bb0[_0x3f02f9(0x135)]=_0x1f1fbe[_0x3f02f9(0x1af)],console[_0x3f02f9(0x1e6)]('üè¶\x20[CHECK]\x20Saved\x20IBAN:\x20'+_0x1f1fbe['iban']));if(_0x1f1fbe[_0x3f02f9(0x1f5)]){const _0x2caa10=_0x536e48['adminNotes']||'',_0x29b938=_0x3f02f9(0x213)+_0x1f1fbe['bankDetails'];_0x401bb0['adminNotes']=_0x2caa10?_0x2caa10+'\x0a\x0a'+_0x29b938:_0x29b938,console['log']('üè¶\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes');}_0x1f1fbe[_0x3f02f9(0x20d)]&&console['log']('üÜî\x20[CHECK]\x20Transaction\x20ID:\x20'+_0x1f1fbe[_0x3f02f9(0x20d)]),_0x1f1fbe[_0x3f02f9(0x215)]&&console['log'](_0x3f02f9(0x1e8)+_0x1f1fbe[_0x3f02f9(0x215)]);}await database_1['default'][_0x3f02f9(0x148)][_0x3f02f9(0x18a)]({'where':{'id':_0x536e48['id']},'data':_0x401bb0});if(_0x48d887[_0x3f02f9(0x1d8)]===_0x3f02f9(0x1e4)&&_0x536e48[_0x3f02f9(0x1d8)]!==_0x3f02f9(0x1e4)){console[_0x3f02f9(0x1e6)]('üìà\x20[COINTOPAY]\x20Payment\x20'+_0x536e48['id']+'\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link');const _0x565b26=await database_1[_0x3f02f9(0x1ea)]['payment'][_0x3f02f9(0x193)]({'where':{'id':_0x536e48['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x565b26?.[_0x3f02f9(0x14f)]&&_0x565b26[_0x3f02f9(0x202)])try{const _0x570564=_0x565b26[_0x3f02f9(0x202)];console[_0x3f02f9(0x1e6)](_0x3f02f9(0x1ce)+_0x570564['id']+_0x3f02f9(0x130)+_0x570564[_0x3f02f9(0x131)]+_0x3f02f9(0x217)+_0x570564[_0x3f02f9(0x22c)]+_0x3f02f9(0x161)+_0x570564[_0x3f02f9(0x1d8)]);const _0x38547a=_0x570564['currentPayments']+0x1,_0x4b758f=_0x570564[_0x3f02f9(0x131)]===_0x3f02f9(0x1d7)?_0x3f02f9(0x207):_0x570564[_0x3f02f9(0x1d8)];await database_1[_0x3f02f9(0x1ea)][_0x3f02f9(0x202)][_0x3f02f9(0x18a)]({'where':{'id':_0x570564['id']},'data':{'currentPayments':_0x38547a,'status':_0x4b758f,'updatedAt':new Date()}}),console[_0x3f02f9(0x1e6)](_0x3f02f9(0x177)+_0x570564['id']+_0x3f02f9(0x195)+_0x570564['currentPayments']+_0x3f02f9(0x1b4)+_0x38547a+_0x3f02f9(0x161)+_0x570564['status']+_0x3f02f9(0x1b4)+_0x4b758f);}catch(_0x1ae571){console[_0x3f02f9(0x211)](_0x3f02f9(0x1f9),_0x1ae571);}else console[_0x3f02f9(0x1e6)]('üìà\x20[COINTOPAY]\x20Payment\x20'+_0x536e48['id']+'\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link');}await database_1[_0x3f02f9(0x1ea)]['webhookLog'][_0x3f02f9(0x19e)]({'data':{'paymentId':_0x536e48['id'],'shopId':_0x536e48[_0x3f02f9(0x1c8)],'event':_0x3f02f9(0x16e)+_0x48d887['status'][_0x3f02f9(0x1ae)](),'statusCode':0xc8,'responseBody':JSON[_0x3f02f9(0x142)]({'oldStatus':_0x536e48['status'],'newStatus':_0x48d887[_0x3f02f9(0x1d8)],'paymentDetails':_0x48d887[_0x3f02f9(0x14a)],'checkedAt':new Date()[_0x3f02f9(0x19b)]()})}}),await this[_0x3f02f9(0x1ba)](_0x536e48,_0x48d887[_0x3f02f9(0x1d8)]),await this[_0x3f02f9(0x158)](_0x536e48,_0x48d887[_0x3f02f9(0x1d8)]),_0x48d887['status']!==_0x3f02f9(0x15b)&&(console[_0x3f02f9(0x1e6)](_0x3f02f9(0x21e)+_0x536e48['id']+_0x3f02f9(0x204)+_0x48d887[_0x3f02f9(0x1d8)]+_0x3f02f9(0x1b7)),this[_0x3f02f9(0x157)](_0x536e48['id'])),console[_0x3f02f9(0x1e6)](_0x3f02f9(0x1f2)+_0x536e48['id']+_0x3f02f9(0x219));}else console[_0x3f02f9(0x1e6)](_0x3f02f9(0x13f)+_0x536e48['id']+_0x3f02f9(0x1d3)+_0x48d887[_0x3f02f9(0x1d8)]+')'),this[_0x3f02f9(0x1b5)](_0x536e48['id'],_0x536e48[_0x3f02f9(0x200)],_0x536e48[_0x3f02f9(0x1d8)],_0x48d887[_0x3f02f9(0x1d8)],_0x3f02f9(0x1d6),{'statusUnchanged':!![],'paymentDetails':_0x48d887[_0x3f02f9(0x14a)],'amount':_0x48d887[_0x3f02f9(0x1e7)],'currency':_0x48d887[_0x3f02f9(0x15f)],'shopId':_0x536e48[_0x3f02f9(0x1c8)],'checkTimestamp':new Date()[_0x3f02f9(0x19b)]()});}catch(_0x55f0f6){console[_0x3f02f9(0x211)](_0x3f02f9(0x1be)+_0x536e48['id']+':',_0x55f0f6),this[_0x3f02f9(0x1aa)](_0x536e48['id'],_0x536e48[_0x3f02f9(0x200)],_0x55f0f6,_0x3f02f9(0x1d6),{'paymentAmount':_0x536e48[_0x3f02f9(0x1e7)],'paymentCurrency':_0x536e48[_0x3f02f9(0x15f)],'shopId':_0x536e48[_0x3f02f9(0x1c8)],'createdAt':_0x536e48['createdAt']}),await database_1[_0x3f02f9(0x1ea)][_0x3f02f9(0x192)]['create']({'data':{'paymentId':_0x536e48['id'],'shopId':_0x536e48['shopId'],'event':_0x3f02f9(0x19d),'statusCode':0x1f4,'responseBody':JSON[_0x3f02f9(0x142)]({'error':_0x55f0f6 instanceof Error?_0x55f0f6[_0x3f02f9(0x175)]:_0x3f02f9(0x228),'gatewayPaymentId':_0x536e48[_0x3f02f9(0x200)],'checkedAt':new Date()[_0x3f02f9(0x19b)]()})}});}}async['sendShopWebhook'](_0x3abc6c,_0x39c1e3){const _0x273e61=a38_0x208712,_0x144213=Date[_0x273e61(0x183)]();try{const _0x58fddb=_0x3abc6c[_0x273e61(0x1a2)],_0x558414=_0x58fddb[_0x273e61(0x21b)];if(!_0x558414?.[_0x273e61(0x1ee)]){console[_0x273e61(0x1e6)](_0x273e61(0x166)+_0x58fddb['id']);return;}const _0x90ac65=_0x39c1e3===_0x273e61(0x1e4)?_0x273e61(0x13c):_0x39c1e3==='FAILED'?_0x273e61(0x1d1):_0x39c1e3===_0x273e61(0x12d)?_0x273e61(0x1d1):_0x273e61(0x13e);if(!_0x558414[_0x273e61(0x19a)]?.[_0x273e61(0x169)](_0x90ac65)){console['log'](_0x273e61(0x162)+_0x90ac65+'\x20not\x20enabled\x20for\x20shop\x20'+_0x58fddb['id']);return;}const _0x4e256f=(0x0,gateway_1[_0x273e61(0x226)])(_0x3abc6c[_0x273e61(0x20a)])||_0x3abc6c['gateway'],_0x2b7228={'event':_0x90ac65,'payment':{'id':_0x3abc6c['id'],'order_id':_0x3abc6c[_0x273e61(0x1d5)],'gateway_order_id':_0x3abc6c['gatewayOrderId'],'gateway':_0x4e256f,'amount':_0x3abc6c[_0x273e61(0x1e7)],'currency':_0x3abc6c[_0x273e61(0x15f)],'status':_0x39c1e3['toLowerCase'](),'customer_email':_0x3abc6c[_0x273e61(0x1c5)],'customer_name':_0x3abc6c[_0x273e61(0x20b)],'created_at':_0x3abc6c[_0x273e61(0x168)],'updated_at':new Date()}},_0x3a915a=await fetch(_0x558414[_0x273e61(0x1ee)],{'method':'POST','headers':{'Content-Type':'application/json','User-Agent':_0x273e61(0x196)},'body':JSON['stringify'](_0x2b7228)}),_0x1ebcb7=Date[_0x273e61(0x183)]()-_0x144213,_0x3111c6=_0x3a915a['ok']?_0x273e61(0x137):await _0x3a915a['text']();loggerService_1[_0x273e61(0x16b)][_0x273e61(0x20e)](_0x3abc6c[_0x273e61(0x1c8)],_0x558414['webhookUrl'],_0x90ac65,_0x3a915a[_0x273e61(0x1d8)],_0x1ebcb7,_0x2b7228),console['log'](_0x273e61(0x1c2)+_0x558414[_0x273e61(0x1ee)]+_0x273e61(0x13a)+_0x3a915a[_0x273e61(0x1d8)]+'\x20('+_0x1ebcb7+'ms)');}catch(_0x149647){console[_0x273e61(0x211)](_0x273e61(0x151),_0x149647),loggerService_1[_0x273e61(0x16b)][_0x273e61(0x1cf)](_0x3abc6c[_0x273e61(0x1c8)],_0x3abc6c['shop']?.[_0x273e61(0x21b)]?.['webhookUrl']||'unknown',_0x273e61(0x14b),_0x149647,{});}}async['sendPaymentStatusNotification'](_0x499a5b,_0x4fd043){const _0x3f8352=a38_0x208712;try{const _0x32544d={'PENDING':_0x3f8352(0x1a9),'PAID':_0x3f8352(0x1ca),'FAILED':_0x3f8352(0x154),'EXPIRED':_0x3f8352(0x1ed)},_0x3f510f=_0x32544d[_0x4fd043];if(!_0x3f510f||_0x3f510f==='created')return;await telegramBotService_1[_0x3f8352(0x1a5)][_0x3f8352(0x12b)](_0x499a5b['shopId'],_0x499a5b,_0x3f510f);}catch(_0x17f210){console[_0x3f8352(0x211)](_0x3f8352(0x224),_0x17f210);}}async['checkPaymentById'](_0x54335c){const _0xc8b66e=a38_0x208712;console['log'](_0xc8b66e(0x209)+_0x54335c);const _0x5a0412=await database_1['default'][_0xc8b66e(0x148)][_0xc8b66e(0x193)]({'where':{'id':_0x54335c},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x5a0412)throw new Error('Payment\x20not\x20found');if(_0x5a0412['gateway']!==_0xc8b66e(0x222)&&_0x5a0412['gateway']!==_0xc8b66e(0x1d0))throw new Error(_0xc8b66e(0x139));console[_0xc8b66e(0x1e6)]('‚úÖ\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20'+_0x5a0412[_0xc8b66e(0x20a)]+'\x20payment\x20'+_0x54335c),await this[_0xc8b66e(0x181)](_0x5a0412),console['log'](_0xc8b66e(0x1e9)+_0x54335c);}[a38_0x208712(0x17c)](){const _0x536271=a38_0x208712,_0x10ea42=this[_0x536271(0x140)]?this[_0x536271(0x146)]:undefined,_0x3fa814=Array[_0x536271(0x16f)](this[_0x536271(0x13b)]['values']())[_0x536271(0x187)](_0x30756f=>({'paymentId':_0x30756f['paymentId'],'gatewayPaymentId':_0x30756f['gatewayPaymentId'],'createdAt':_0x30756f[_0x536271(0x168)],'timersCount':_0x30756f[_0x536271(0x129)]['length']}));return{'isActive':!!this[_0x536271(0x140)],'globalCheckIntervalMinutes':this[_0x536271(0x146)]/(0x3e8*0x3c),'expiryDays':this[_0x536271(0x1b9)],'activeIndividualTimers':this[_0x536271(0x13b)][_0x536271(0x1de)],'nextGlobalCheckIn':_0x10ea42,'paymentTimersDetails':_0x3fa814};}['getPaymentTimerInfo'](_0x584025){const _0x1917e7=a38_0x208712,_0x184a62=this[_0x1917e7(0x13b)]['get'](_0x584025);if(_0x184a62)return{'hasTimers':!![],'timersCount':_0x184a62[_0x1917e7(0x129)][_0x1917e7(0x1b2)],'createdAt':_0x184a62[_0x1917e7(0x168)],'gatewayPaymentId':_0x184a62[_0x1917e7(0x200)]};return{'hasTimers':![]};}async[a38_0x208712(0x1e2)](_0xe5d960,_0x2c1efd){const _0x1c3ed0=a38_0x208712;try{const _0x51f635=await database_1[_0x1c3ed0(0x1ea)][_0x1c3ed0(0x1a2)][_0x1c3ed0(0x193)]({'where':{'id':_0xe5d960},'select':{'gatewaySettings':!![]}});if(!_0x51f635?.[_0x1c3ed0(0x189)])return console[_0x1c3ed0(0x1e6)](_0x1c3ed0(0x170)+_0xe5d960+',\x20using\x20default\x20commission\x2010%'),0xa;const _0x320af3=JSON[_0x1c3ed0(0x18c)](_0x51f635[_0x1c3ed0(0x189)]);for(const [_0x1ea1aa,_0x10d160]of Object[_0x1c3ed0(0x1b0)](_0x320af3)){if(_0x1ea1aa[_0x1c3ed0(0x1ae)]()===_0x2c1efd[_0x1c3ed0(0x1ae)]()){const _0x258f55=_0x10d160[_0x1c3ed0(0x214)]||0xa;return console[_0x1c3ed0(0x1e6)](_0x1c3ed0(0x20f)+_0x2c1efd+_0x1c3ed0(0x126)+_0xe5d960+':\x20'+_0x258f55+'%'),_0x258f55;}}return console[_0x1c3ed0(0x1e6)](_0x1c3ed0(0x21c)+_0x2c1efd+_0x1c3ed0(0x1c0)+_0xe5d960+',\x20using\x20default\x2010%'),0xa;}catch(_0x11cede){return console['error']('Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20'+_0xe5d960+',\x20gateway\x20'+_0x2c1efd+':',_0x11cede),0xa;}}}exports[a38_0x208712(0x163)]=CoinToPayStatusService,exports['coinToPayStatusService']=new CoinToPayStatusService();function a38_0x5acb(){const _0x5ed616=['entries','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','length','\x20\x20\x20-\x20GatewayPaymentId:\x20','\x20->\x20','logCoinToPayStatus','./telegramBotService',',\x20clearing\x20individual\x20timers','\x20USDT','EXPIRY_DAYS','sendShopWebhook','\x20\x20\x20-\x20gatewayPaymentId:\x20','\x20is\x20too\x20new\x20(','getTime','‚ùå\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','\x20\x20\x20üìç\x20Source:\x20','\x20in\x20shop\x20','paidAt','Shop\x20webhook\x20sent\x20to\x20','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','üõë\x20[SHUTDOWN]\x20Cleared\x20','customerEmail','gatewayCommissionRate','auto_expire','shopId','not\x20found','paid','1\x20minute','\x20expired\x20CoinToPay\x20payments','\x20has\x20no\x20gatewayPaymentId,\x20skipping','üìà\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','logShopWebhookError','cointopay2','payment.failed','\x20pending\x20CoinToPay\x20payments','\x20status\x20unchanged\x20(','\x20(after\x20','orderId','status_check','SINGLE','status','2473575NWoOEJ','‚úÖ\x20[HOURLY]\x20Payment\x20','‚ö†Ô∏è\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','\x20timers\x20for\x20payment\x20','‚ö†Ô∏è\x20[CHECK]\x20Payment\x20','size','üîç\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','6982ERBdjJ','\x20status\x20is\x20','getGatewayCommission','üõë\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','PAID','coinToPayStatusService','log','amount','‚úÖ\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','‚úÖ\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','default','stack','\x20found:','expired','webhookUrl','\x20\x20\x20Amount:\x20','\x20\x20\x20-\x20Gateway:\x20','catch','‚úÖ\x20[CHECK]\x20Payment\x20','-day\x20timeout','‚úÖ\x20[EXPIRY]\x20Payment\x20','bankDetails','COINTOPAY_STATUS_CHANGE','ü™ô\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','‚ùå\x20[CHECK]\x20Payment\x20','‚ùå\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','\x20payment\x20','\x20in\x20','\x20not\x20found,\x20clearing\x20timers','ü™ô\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','Automatically\x20expired\x20after\x20','gatewayPaymentId','\x20\x20\x20-\x20ShopId:\x20','paymentLink','toFixed','\x20status\x20changed\x20to\x20','\x20days\x20without\x20payment\x20confirmation','description','COMPLETED','Payment\x20older\x20than\x20','üîç\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','gateway','customerName','534uuNfzN','transactionId','logShopWebhookSent','Gateway\x20','push','error','409712PyHtrg','Bank\x20Details:\x20','commission','confirmedOn','../config/database',',\x20currentPayments=','üõë\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','\x20updated\x20successfully','h),\x20skipping\x20global\x20check','settings','No\x20specific\x20commission\x20found\x20for\x20gateway\x20','üîç\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','üßπ\x20[CHECK]\x20Payment\x20','\x20is\x20valid\x20for\x20checking,\x20proceeding...','get','\x20\x20\x20üìù\x20Details:','cointopay','‚ùå\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','\x20is\x20older\x20than\x20','getGatewayIdByName','üìä\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','Unknown\x20error','‚è∞\x20[GLOBAL]\x20Found\x20','üßπ\x20[DEBUG]\x20Cleared\x20timer\x20#','503825EXhnhb','currentPayments','checkPaymentStatus','./currencyService','\x20commission\x20for\x20shop\x20','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','timers','\x20marked\x20as\x20paid\x20at:\x20','sendPaymentNotification','.\x20Remaining\x20active\x20timers:\x20','EXPIRED','set','\x20status\x20from\x20',':\x20type=','type','COINTOPAY_ERROR','\x20\x20\x20Gateway\x20','üí∞\x20[CHECK]\x20Payment\x20','remitterIban','currencyService','Success','\x20details:','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','\x20with\x20status\x20','paymentTimers','payment.success','CoinToPayService','payment.pending','üìä\x20[CHECK]\x20Payment\x20','globalCheckInterval','setDate','stringify','\x20\x20\x20üìù\x20Context:','timestamp','not\x20confirmed','GLOBAL_CHECK_INTERVAL_MS','\x20days','payment','coinToPayService','paymentDetails','webhook_send','amountAfterGatewayCommissionUSDT','\x20completed\x20for\x20payment\x20','getDate','paymentLinkId','ü™ô\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','Failed\x20to\x20send\x20shop\x20webhook:','floor','‚úÖ\x20[DEBUG]\x20Successfully\x20scheduled\x20','failed','\x20expired','checkAllPendingPayments','clearPaymentTimers','sendPaymentStatusNotification','\x20\x20\x20‚ùå\x20Error:\x20','logWhiteDomainError','PENDING','/status/','‚è∞\x20[EXPIRY]\x20Payment\x20','schedulePaymentChecks','currency','\x20triggered\x20for\x20payment\x20',',\x20status=','Webhook\x20event\x20','CoinToPayStatusService','üìä\x20[HOURLY]\x20Payment\x20','üîç\x20[CHECK]\x20Checking\x20','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','5\x20minutes','createdAt','includes','ü™ô\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','loggerService','\x20amounts\x20calculated:','‚úÖ\x20[TIMER]\x20Individual\x20check\x20#','cointopay_status_check_','from','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','ü™ô\x20[GLOBAL]\x20Found\x20','__esModule','4KRFrKY','\x20not\x20found\x20in\x20database','message','73227ruLSvh','‚úÖ\x20[COINTOPAY]\x20Payment\x20link\x20','__importDefault',',\x20stopping\x20individual\x20checks','\x20for\x20payment\x20','checkExpiredPayments','getServiceStats','CoinToPay2Service','\x20\x20\x20-\x20Status:\x20','delay','\x20\x20\x20üìä\x20Status:\x20','checkSinglePayment','\x20days,\x20marking\x20as\x20EXPIRED','now','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','ü™ô\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','stopPeriodicStatusCheck','map','amountUSDT','gatewaySettings','update','6488937aseBEk','parse','ü™ô\x20[TIMER]\x20Individual\x20check\x20#','\x20status:\x20','‚ùå\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','‚úÖ\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','unknown','webhookLog','findUnique','\x20(age:\x20','\x20updated:\x20currentPayments=','TesSoft\x20Payment\x20System/1.0','‚è∞\x20[HOURLY]\x20Payment\x20','../types/gateway','\x20seconds\x20(','webhookEvents','toISOString','checkSinglePaymentById','cointopay_status_check_error','create','1081842evpXjE','coinToPay2Service','\x20to\x20clear','shop','‚ùå\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','defineProperty','telegramBotService','findMany','‚úÖ\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','üßπ\x20[DEBUG]\x20Clearing\x20','created','logCoinToPayError','\x20\x20\x20üìÖ\x20Time:\x20','\x20days\x20(created\x20before\x20','‚è∞\x20[GLOBAL]\x20Payment\x20','toLowerCase','iban'];a38_0x5acb=function(){return _0x5ed616;};return a38_0x5acb();}