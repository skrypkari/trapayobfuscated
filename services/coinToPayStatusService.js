'use strict';const a40_0x4033b8=a40_0x14b7;(function(_0x2d57e4,_0x35d9e0){const _0x4d3906=a40_0x14b7,_0x32f3c4=_0x2d57e4();while(!![]){try{const _0x26b340=-parseInt(_0x4d3906(0xf8))/0x1+-parseInt(_0x4d3906(0x1b1))/0x2+parseInt(_0x4d3906(0x16b))/0x3*(parseInt(_0x4d3906(0x1b4))/0x4)+parseInt(_0x4d3906(0xde))/0x5*(-parseInt(_0x4d3906(0x1d7))/0x6)+parseInt(_0x4d3906(0xbd))/0x7*(parseInt(_0x4d3906(0xe7))/0x8)+parseInt(_0x4d3906(0x116))/0x9*(parseInt(_0x4d3906(0x11b))/0xa)+parseInt(_0x4d3906(0x198))/0xb;if(_0x26b340===_0x35d9e0)break;else _0x32f3c4['push'](_0x32f3c4['shift']());}catch(_0x17859f){_0x32f3c4['push'](_0x32f3c4['shift']());}}}(a40_0x7f6a,0x3d314));var __importDefault=this&&this['__importDefault']||function(_0x8e2a39){return _0x8e2a39&&_0x8e2a39['__esModule']?_0x8e2a39:{'default':_0x8e2a39};};Object['defineProperty'](exports,a40_0x4033b8(0xdd),{'value':!![]}),exports[a40_0x4033b8(0xed)]=exports[a40_0x4033b8(0x1ce)]=void 0x0;const coinToPayService_1=require('./gateways/coinToPayService'),coinToPay2Service_1=require('./gateways/coinToPay2Service'),gateway_1=require(a40_0x4033b8(0x11e)),database_1=__importDefault(require(a40_0x4033b8(0xd9))),telegramBotService_1=require(a40_0x4033b8(0x17b)),loggerService_1=require(a40_0x4033b8(0x170)),currencyService_1=require('./currencyService');class CoinToPayStatusService{constructor(){const _0x21f8f0=a40_0x4033b8;this[_0x21f8f0(0x19c)]=null,this[_0x21f8f0(0x199)]=0x3c*0x3c*0x3e8,this['EXPIRY_DAYS']=0x5,this[_0x21f8f0(0x189)]=new Map(),this['coinToPayService']=new coinToPayService_1[(_0x21f8f0(0xc9))](),this[_0x21f8f0(0x153)]=new coinToPay2Service_1['CoinToPay2Service'](),console[_0x21f8f0(0xcb)](_0x21f8f0(0x131));}['schedulePaymentChecks'](_0x53a05e,_0x3e2529){const _0x28bbf0=a40_0x4033b8;console[_0x28bbf0(0xcb)](_0x28bbf0(0x10c)),console[_0x28bbf0(0xcb)](_0x28bbf0(0xf2)+_0x53a05e),console[_0x28bbf0(0xcb)](_0x28bbf0(0xdc)+_0x3e2529),this[_0x28bbf0(0x159)](_0x53a05e);const _0x1a5f5f=[],_0x12b20e=new Date(),_0x335f8c=[{'delay':0x1*0x3c*0x3e8,'description':'1\x20minute'},{'delay':0x2*0x3c*0x3e8,'description':_0x28bbf0(0x156)},{'delay':0x5*0x3c*0x3e8,'description':'5\x20minutes'},{'delay':0x5*0x3c*0x3e8,'description':_0x28bbf0(0xd6)}];console['log'](_0x28bbf0(0x101)+_0x335f8c[_0x28bbf0(0x12c)]+_0x28bbf0(0x149)+_0x53a05e);let _0x5f3c63=0x0;_0x335f8c[_0x28bbf0(0x1d8)]((_0x291b27,_0x5c5fa3)=>{const _0x197ffa=_0x28bbf0;_0x5f3c63+=_0x291b27['delay'];const _0x128e52=setTimeout(async()=>{const _0x33d880=a40_0x14b7;console[_0x33d880(0xcb)]('🪙\x20[TIMER]\x20Individual\x20check\x20#'+(_0x5c5fa3+0x1)+_0x33d880(0x1d6)+_0x53a05e+'\x20(after\x20'+_0x291b27[_0x33d880(0xfc)]+')');try{await this['checkSinglePaymentById'](_0x53a05e),console['log'](_0x33d880(0x128)+(_0x5c5fa3+0x1)+_0x33d880(0x18c)+_0x53a05e);}catch(_0x2f26d7){console['error'](_0x33d880(0x15d)+(_0x5c5fa3+0x1)+'\x20for\x20payment\x20'+_0x53a05e+':',_0x2f26d7),this['logCoinToPayError'](_0x53a05e,_0x3e2529,_0x2f26d7,_0x33d880(0x1d0),{'checkNumber':_0x5c5fa3+0x1,'scheduledAfter':_0x291b27[_0x33d880(0xfc)],'isIndividualCheck':!![]});}},_0x5f3c63);_0x1a5f5f[_0x197ffa(0x121)](_0x128e52),console[_0x197ffa(0xcb)](_0x197ffa(0x169)+(_0x5c5fa3+0x1)+_0x197ffa(0x1d5)+_0x53a05e+_0x197ffa(0x174)+_0x5f3c63/0x3e8+_0x197ffa(0xda)+_0x291b27['description']+')');});const _0x2975b0=setInterval(async()=>{const _0x10a14d=_0x28bbf0;console[_0x10a14d(0xcb)]('🪙\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20'+_0x53a05e);try{const _0x2e53d6=await database_1[_0x10a14d(0xf0)]['payment'][_0x10a14d(0xdb)]({'where':{'id':_0x53a05e},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x2e53d6){console[_0x10a14d(0xcb)](_0x10a14d(0x1bc)+_0x53a05e+_0x10a14d(0xf3)),this[_0x10a14d(0x159)](_0x53a05e);return;}console[_0x10a14d(0xcb)]('📊\x20[HOURLY]\x20Payment\x20'+_0x53a05e+_0x10a14d(0x1cb)+_0x2e53d6[_0x10a14d(0xd8)]);if(_0x2e53d6[_0x10a14d(0xd8)]!==_0x10a14d(0x13e)){console[_0x10a14d(0xcb)](_0x10a14d(0x13a)+_0x53a05e+_0x10a14d(0x1c7)+_0x2e53d6[_0x10a14d(0xd8)]+_0x10a14d(0x138)),this[_0x10a14d(0x159)](_0x53a05e);return;}const _0x45d6e9=Math[_0x10a14d(0x179)]((Date[_0x10a14d(0x1d4)]()-_0x2e53d6[_0x10a14d(0x15f)][_0x10a14d(0x171)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x45d6e9>=this[_0x10a14d(0x187)]){console[_0x10a14d(0xcb)]('⏰\x20[HOURLY]\x20Payment\x20'+_0x53a05e+_0x10a14d(0x1a8)+this[_0x10a14d(0x187)]+_0x10a14d(0xe5)),this[_0x10a14d(0x159)](_0x53a05e);return;}await this[_0x10a14d(0xe6)](_0x53a05e),console[_0x10a14d(0xcb)](_0x10a14d(0x163)+_0x53a05e);}catch(_0x31ff7c){console[_0x10a14d(0x1ae)](_0x10a14d(0x1c1)+_0x53a05e+':',_0x31ff7c),this[_0x10a14d(0xc3)](_0x53a05e,_0x3e2529,_0x31ff7c,'status_check',{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x1a5f5f[_0x28bbf0(0x121)](_0x2975b0),this[_0x28bbf0(0x189)][_0x28bbf0(0x1a9)](_0x53a05e,{'timers':_0x1a5f5f,'paymentId':_0x53a05e,'gatewayPaymentId':_0x3e2529,'createdAt':_0x12b20e}),console[_0x28bbf0(0xcb)](_0x28bbf0(0x1a3)+_0x335f8c[_0x28bbf0(0x12c)]+_0x28bbf0(0x185)+_0x53a05e),console[_0x28bbf0(0xcb)](_0x28bbf0(0x114)+this['paymentTimers'][_0x28bbf0(0x122)]),this[_0x28bbf0(0x115)](_0x53a05e,_0x3e2529,_0x28bbf0(0x13e),_0x28bbf0(0x13e),'status_check',{'action':_0x28bbf0(0x16e),'scheduledChecks':_0x335f8c[_0x28bbf0(0x12c)],'firstCheckIn':_0x335f8c[0x0]['delay']/0x3e8,'totalTimers':this['paymentTimers'][_0x28bbf0(0x122)]});}['clearPaymentTimers'](_0x24e549){const _0x163f33=a40_0x4033b8,_0x46a675=this[_0x163f33(0x189)]['get'](_0x24e549);_0x46a675?(console['log'](_0x163f33(0x1c3)+_0x46a675[_0x163f33(0x182)][_0x163f33(0x12c)]+'\x20timers\x20for\x20payment\x20'+_0x24e549),_0x46a675[_0x163f33(0x182)][_0x163f33(0x1d8)]((_0x19c4ac,_0x2e74d1)=>{const _0x2ff559=_0x163f33;_0x19c4ac&&(clearTimeout(_0x19c4ac),clearInterval(_0x19c4ac),console['log'](_0x2ff559(0x1a5)+(_0x2e74d1+0x1)+_0x2ff559(0x1d5)+_0x24e549));}),this['paymentTimers']['delete'](_0x24e549),console[_0x163f33(0xcb)](_0x163f33(0x16f)+_0x24e549+_0x163f33(0xf1)+this[_0x163f33(0x189)][_0x163f33(0x122)])):console[_0x163f33(0xcb)](_0x163f33(0x129)+_0x24e549+_0x163f33(0x154));}async[a40_0x4033b8(0xe6)](_0x1c5188){const _0x4e2898=a40_0x4033b8;console['log'](_0x4e2898(0x173)+_0x1c5188);const _0x3bd4a4=await database_1[_0x4e2898(0xf0)][_0x4e2898(0x158)][_0x4e2898(0xdb)]({'where':{'id':_0x1c5188},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x3bd4a4){console['log'](_0x4e2898(0x190)+_0x1c5188+_0x4e2898(0x180));return;}console['log'](_0x4e2898(0xc4)+_0x1c5188+_0x4e2898(0x19a)),console[_0x4e2898(0xcb)]('\x20\x20\x20-\x20Gateway:\x20'+_0x3bd4a4[_0x4e2898(0x178)]),console[_0x4e2898(0xcb)](_0x4e2898(0x10a)+_0x3bd4a4[_0x4e2898(0xd8)]),console[_0x4e2898(0xcb)]('\x20\x20\x20-\x20GatewayPaymentId:\x20'+_0x3bd4a4[_0x4e2898(0xee)]),console[_0x4e2898(0xcb)](_0x4e2898(0x1a6)+_0x3bd4a4[_0x4e2898(0x1d2)]+'\x20'+_0x3bd4a4[_0x4e2898(0x196)]),console['log'](_0x4e2898(0x144)+_0x3bd4a4['shopId']);if(_0x3bd4a4['gateway']!==_0x4e2898(0x13c)&&_0x3bd4a4[_0x4e2898(0x178)]!==_0x4e2898(0x194)){console[_0x4e2898(0xcb)](_0x4e2898(0x11f)+_0x1c5188+_0x4e2898(0x15c)+_0x3bd4a4[_0x4e2898(0x178)]+')');return;}if(_0x3bd4a4[_0x4e2898(0xd8)]!==_0x4e2898(0x13e)){console[_0x4e2898(0xcb)](_0x4e2898(0x11f)+_0x1c5188+_0x4e2898(0x1c7)+_0x3bd4a4['status']+_0x4e2898(0x138)),this['clearPaymentTimers'](_0x1c5188);return;}if(!_0x3bd4a4[_0x4e2898(0xee)]){console[_0x4e2898(0xcb)](_0x4e2898(0x11f)+_0x1c5188+_0x4e2898(0xd2));return;}console[_0x4e2898(0xcb)]('✅\x20[CHECK]\x20Payment\x20'+_0x1c5188+'\x20is\x20valid\x20for\x20checking,\x20proceeding...'),await this[_0x4e2898(0x1b0)](_0x3bd4a4);}[a40_0x4033b8(0x115)](_0x24b115,_0x15bf1d,_0x1375cc,_0x3a776a,_0x249d26,_0x58f5df){const _0x53a30a=a40_0x4033b8,_0x3785df={'type':'COINTOPAY_STATUS_CHANGE','paymentId':_0x24b115,'gatewayPaymentId':_0x15bf1d,'oldStatus':_0x1375cc,'newStatus':_0x3a776a,'source':_0x249d26,'timestamp':new Date()[_0x53a30a(0xc1)](),'details':_0x58f5df||{}};loggerService_1['loggerService'][_0x53a30a(0x115)](_0x3785df),console[_0x53a30a(0xcb)](_0x53a30a(0x1d3)+_0x24b115+'\x20('+_0x15bf1d+')'),console['log'](_0x53a30a(0x19d)+_0x1375cc+'\x20->\x20'+_0x3a776a),console['log'](_0x53a30a(0x1be)+_0x249d26),console['log']('\x20\x20\x20📅\x20Time:\x20'+_0x3785df[_0x53a30a(0x181)]),_0x58f5df&&console['log']('\x20\x20\x20📝\x20Details:',_0x58f5df);}[a40_0x4033b8(0xc3)](_0x10c8d5,_0x12df2a,_0x11506a,_0x5cabf8,_0x3b635a){const _0x209e15=a40_0x4033b8,_0x5c378c={'type':_0x209e15(0xf6),'paymentId':_0x10c8d5,'gatewayPaymentId':_0x12df2a,'error':_0x11506a instanceof Error?{'message':_0x11506a['message'],'stack':_0x11506a['stack']}:_0x11506a,'source':_0x5cabf8,'timestamp':new Date()['toISOString'](),'context':_0x3b635a||{}};loggerService_1[_0x209e15(0xd3)][_0x209e15(0xc3)](_0x5c378c),console['error'](_0x209e15(0xcf)+_0x10c8d5+'\x20('+_0x12df2a+')'),console[_0x209e15(0x1ae)](_0x209e15(0xfe)+(_0x11506a instanceof Error?_0x11506a[_0x209e15(0xf5)]:_0x11506a)),console[_0x209e15(0x1ae)](_0x209e15(0x1be)+_0x5cabf8),console[_0x209e15(0x1ae)](_0x209e15(0x130)+_0x5c378c[_0x209e15(0x181)]),_0x3b635a&&console[_0x209e15(0x1ae)](_0x209e15(0x1b6),_0x3b635a);}['startPeriodicStatusCheck'](){const _0x5e70b6=a40_0x4033b8;console[_0x5e70b6(0xcb)](_0x5e70b6(0x15e)),this['checkAllPendingPayments']()['catch'](_0x208536=>{const _0x3a5e17=_0x5e70b6;console[_0x3a5e17(0x1ae)](_0x3a5e17(0xe4),_0x208536);}),this[_0x5e70b6(0x19c)]=setInterval(async()=>{const _0x18e340=_0x5e70b6;try{console[_0x18e340(0xcb)](_0x18e340(0x106)),await this[_0x18e340(0x117)](),console['log']('✅\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed');}catch(_0x405031){console['error'](_0x18e340(0x1d1),_0x405031);}},this[_0x5e70b6(0x199)]),console['log'](_0x5e70b6(0x15a));}[a40_0x4033b8(0xc6)](){const _0x3dc5d2=a40_0x4033b8;console[_0x3dc5d2(0xcb)](_0x3dc5d2(0x1b7));this[_0x3dc5d2(0x19c)]&&(clearInterval(this['globalCheckInterval']),this[_0x3dc5d2(0x19c)]=null,console[_0x3dc5d2(0xcb)](_0x3dc5d2(0x188)));const _0xbf7fd3=this['paymentTimers'][_0x3dc5d2(0x122)];for(const [_0x5ad397]of this['paymentTimers']){this[_0x3dc5d2(0x159)](_0x5ad397);}console['log']('🛑\x20[SHUTDOWN]\x20Cleared\x20'+_0xbf7fd3+_0x3dc5d2(0x191));}async[a40_0x4033b8(0x117)](){const _0x3f564e=a40_0x4033b8;try{console[_0x3f564e(0xcb)](_0x3f564e(0xfb));const _0x3306b2=await database_1[_0x3f564e(0xf0)][_0x3f564e(0x158)][_0x3f564e(0x150)]({'where':{'gateway':{'in':[_0x3f564e(0x13c),'cointopay2']},'status':_0x3f564e(0x13e),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console['log'](_0x3f564e(0x1c4)+_0x3306b2[_0x3f564e(0x12c)]+_0x3f564e(0xe1));if(_0x3306b2['length']===0x0){console[_0x3f564e(0xcb)](_0x3f564e(0x137));return;}const _0x14c694=await this[_0x3f564e(0x1ad)](_0x3306b2);console[_0x3f564e(0xcb)](_0x3f564e(0x1c6)+_0x14c694[_0x3f564e(0x12c)]+'\x20expired\x20CoinToPay\x20payments');let _0x4bc9af=0x0,_0x51e397=0x0;for(const _0x4742ba of _0x3306b2){try{if(_0x14c694[_0x3f564e(0x118)](_0x4742ba['id'])){console[_0x3f564e(0xcb)](_0x3f564e(0x105)+_0x4742ba['id']+_0x3f564e(0x139)),_0x51e397++;continue;}if(this[_0x3f564e(0x189)][_0x3f564e(0x1a7)](_0x4742ba['id'])){console[_0x3f564e(0xcb)](_0x3f564e(0x105)+_0x4742ba['id']+_0x3f564e(0x132)),_0x51e397++;continue;}const _0xa1d5c=(Date[_0x3f564e(0x1d4)]()-_0x4742ba[_0x3f564e(0x15f)]['getTime']())/(0x3e8*0x3c*0x3c);if(_0xa1d5c<0x1){console[_0x3f564e(0xcb)](_0x3f564e(0x105)+_0x4742ba['id']+_0x3f564e(0x172)+_0xa1d5c[_0x3f564e(0xea)](0x1)+'h),\x20skipping\x20global\x20check'),_0x51e397++;continue;}console[_0x3f564e(0xcb)](_0x3f564e(0x145)+_0x4742ba['id']+_0x3f564e(0x166)+_0xa1d5c[_0x3f564e(0xea)](0x1)+'h)'),await this['checkSinglePayment'](_0x4742ba),_0x4bc9af++,await new Promise(_0x2bc758=>setTimeout(_0x2bc758,0x7d0));}catch(_0x324de8){console[_0x3f564e(0x1ae)](_0x3f564e(0xd1)+_0x4742ba['id']+':',_0x324de8),this[_0x3f564e(0xc3)](_0x4742ba['id'],_0x4742ba[_0x3f564e(0xee)]||_0x3f564e(0x1ac),_0x324de8,_0x3f564e(0x1d0),{'isGlobalCheck':!![],'paymentAmount':_0x4742ba['amount'],'paymentCurrency':_0x4742ba[_0x3f564e(0x196)],'shopId':_0x4742ba[_0x3f564e(0x110)],'createdAt':_0x4742ba[_0x3f564e(0x15f)]}),loggerService_1[_0x3f564e(0xd3)][_0x3f564e(0x1ba)]('cointopay',_0x3f564e(0x12f)+_0x4742ba[_0x3f564e(0xee)],_0x324de8);}}console[_0x3f564e(0xcb)](_0x3f564e(0x10e)+_0x4bc9af+'\x20checked,\x20'+_0x51e397+_0x3f564e(0xf4)+_0x14c694[_0x3f564e(0x12c)]+'\x20expired');}catch(_0x6f926b){console[_0x3f564e(0x1ae)]('❌\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:',_0x6f926b);}}async['checkExpiredPayments'](_0x1d53d2){const _0x5c1c48=a40_0x4033b8,_0x4dffe9=[],_0x569964=new Date();_0x569964[_0x5c1c48(0x141)](_0x569964[_0x5c1c48(0x142)]()-this['EXPIRY_DAYS']),console[_0x5c1c48(0xcb)](_0x5c1c48(0xc2)+this[_0x5c1c48(0x187)]+'\x20days\x20(created\x20before\x20'+_0x569964[_0x5c1c48(0xc1)]()+')');for(const _0x5de0bf of _0x1d53d2){if(_0x5de0bf['createdAt']<_0x569964){console[_0x5c1c48(0xcb)](_0x5c1c48(0x102)+_0x5de0bf['id']+_0x5c1c48(0x1a8)+this[_0x5c1c48(0x187)]+_0x5c1c48(0x100));try{this[_0x5c1c48(0x115)](_0x5de0bf['id'],_0x5de0bf['gatewayPaymentId']||'unknown',_0x5c1c48(0x13e),_0x5c1c48(0x11d),_0x5c1c48(0xfa),{'reason':'Payment\x20older\x20than\x20'+this[_0x5c1c48(0x187)]+_0x5c1c48(0x123),'createdAt':_0x5de0bf['createdAt'],'daysSinceCreation':Math[_0x5c1c48(0x179)]((Date[_0x5c1c48(0x1d4)]()-_0x5de0bf[_0x5c1c48(0x15f)]['getTime']())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x5de0bf['amount'],'paymentCurrency':_0x5de0bf[_0x5c1c48(0x196)],'shopId':_0x5de0bf['shopId']}),await database_1[_0x5c1c48(0xf0)][_0x5c1c48(0x158)][_0x5c1c48(0x167)]({'where':{'id':_0x5de0bf['id']},'data':{'status':_0x5c1c48(0x11d),'updatedAt':new Date(),'adminNotes':_0x5c1c48(0x12d)+this[_0x5c1c48(0x187)]+'\x20days\x20without\x20payment\x20confirmation'}}),await database_1[_0x5c1c48(0xf0)][_0x5c1c48(0x161)][_0x5c1c48(0x175)]({'data':{'paymentId':_0x5de0bf['id'],'shopId':_0x5de0bf[_0x5c1c48(0x110)],'event':_0x5c1c48(0x1ab),'statusCode':0xc8,'responseBody':JSON[_0x5c1c48(0xec)]({'reason':_0x5c1c48(0x1b2)+this[_0x5c1c48(0x187)]+_0x5c1c48(0x123),'createdAt':_0x5de0bf[_0x5c1c48(0x15f)],'expiredAt':new Date()[_0x5c1c48(0xc1)](),'daysSinceCreation':Math[_0x5c1c48(0x179)]((Date[_0x5c1c48(0x1d4)]()-_0x5de0bf[_0x5c1c48(0x15f)][_0x5c1c48(0x171)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x5c1c48(0xcd)](_0x5de0bf,_0x5c1c48(0x11d)),await this[_0x5c1c48(0xdf)](_0x5de0bf,_0x5c1c48(0x11d)),this[_0x5c1c48(0x159)](_0x5de0bf['id']),_0x4dffe9[_0x5c1c48(0x121)](_0x5de0bf['id']),console[_0x5c1c48(0xcb)](_0x5c1c48(0xbe)+_0x5de0bf['id']+_0x5c1c48(0x162)+this[_0x5c1c48(0x187)]+_0x5c1c48(0xe0));}catch(_0x4977ee){console[_0x5c1c48(0x1ae)](_0x5c1c48(0x13f)+_0x5de0bf['id']+':',_0x4977ee),this[_0x5c1c48(0xc3)](_0x5de0bf['id'],_0x5de0bf[_0x5c1c48(0xee)]||'unknown',_0x4977ee,_0x5c1c48(0xfa),{'reason':_0x5c1c48(0x111),'createdAt':_0x5de0bf[_0x5c1c48(0x15f)],'daysSinceCreation':Math['floor']((Date['now']()-_0x5de0bf[_0x5c1c48(0x15f)][_0x5c1c48(0x171)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x4dffe9;}async[a40_0x4033b8(0x1b0)](_0x172e79){const _0x3df1a5=a40_0x4033b8;if(!_0x172e79['gatewayPaymentId']){console[_0x3df1a5(0xcb)](_0x3df1a5(0x11f)+_0x172e79['id']+'\x20has\x20no\x20gatewayPaymentId,\x20skipping');return;}console[_0x3df1a5(0xcb)]('🔍\x20[CHECK]\x20Checking\x20'+_0x172e79[_0x3df1a5(0x178)]+_0x3df1a5(0xe3)+_0x172e79['id']+'\x20('+_0x172e79[_0x3df1a5(0xee)]+')');try{let _0x311dbc;_0x172e79[_0x3df1a5(0x178)]===_0x3df1a5(0x194)?(_0x311dbc=await this['coinToPay2Service'][_0x3df1a5(0x1a4)](_0x172e79[_0x3df1a5(0xee)]),console[_0x3df1a5(0xcb)](_0x3df1a5(0x1b5)+_0x172e79['id']+_0x3df1a5(0x1bb)+_0x311dbc['status'])):(_0x311dbc=await this[_0x3df1a5(0x19e)][_0x3df1a5(0x1a4)](_0x172e79[_0x3df1a5(0xee)]),console[_0x3df1a5(0xcb)](_0x3df1a5(0x165)+_0x172e79['id']+_0x3df1a5(0x1bb)+_0x311dbc[_0x3df1a5(0xd8)]));_0x311dbc[_0x3df1a5(0x15b)]&&console[_0x3df1a5(0xcb)]('📊\x20[CHECK]\x20Payment\x20'+_0x172e79['id']+_0x3df1a5(0x1bd),{'iban':_0x311dbc['paymentDetails']['iban']||_0x3df1a5(0x192),'transactionId':_0x311dbc[_0x3df1a5(0x15b)][_0x3df1a5(0x14b)],'createdOn':_0x311dbc[_0x3df1a5(0x15b)][_0x3df1a5(0x11c)],'confirmedOn':_0x311dbc['paymentDetails'][_0x3df1a5(0x133)]||_0x3df1a5(0x14e)});if(_0x311dbc['status']!==_0x172e79[_0x3df1a5(0xd8)]){console['log'](_0x3df1a5(0xd5)+_0x172e79['id']+_0x3df1a5(0x1b3)+_0x172e79[_0x3df1a5(0xd8)]+_0x3df1a5(0x1a0)+_0x311dbc[_0x3df1a5(0xd8)]),this[_0x3df1a5(0x115)](_0x172e79['id'],_0x172e79[_0x3df1a5(0xee)],_0x172e79[_0x3df1a5(0xd8)],_0x311dbc['status'],'status_check',{'paymentDetails':_0x311dbc[_0x3df1a5(0x15b)],'amount':_0x311dbc[_0x3df1a5(0x1d2)],'currency':_0x311dbc[_0x3df1a5(0x196)],'shopId':_0x172e79['shopId'],'checkTimestamp':new Date()[_0x3df1a5(0xc1)]()});const _0x1ba5ff={'status':_0x311dbc[_0x3df1a5(0xd8)],'updatedAt':new Date()};if(_0x311dbc[_0x3df1a5(0xd8)]===_0x3df1a5(0xce)&&_0x172e79['status']!==_0x3df1a5(0xce)){_0x1ba5ff['paidAt']=new Date();if(!_0x172e79[_0x3df1a5(0x19f)]){const _0x30c543=await currencyService_1['currencyService'][_0x3df1a5(0x14d)](_0x172e79[_0x3df1a5(0x1d2)],_0x172e79[_0x3df1a5(0x196)]);_0x1ba5ff[_0x3df1a5(0x19f)]=_0x30c543;const _0x58e604=await this['getGatewayCommission'](_0x172e79['shopId'],_0x172e79[_0x3df1a5(0x178)]),_0x2b4492=_0x30c543*(0x1-_0x58e604/0x64);_0x1ba5ff[_0x3df1a5(0x17e)]=_0x2b4492,_0x1ba5ff[_0x3df1a5(0x1a1)]=_0x58e604,console[_0x3df1a5(0xcb)](_0x3df1a5(0x176)+_0x172e79['id']+_0x3df1a5(0x157)),console[_0x3df1a5(0xcb)](_0x3df1a5(0x140)+_0x172e79[_0x3df1a5(0x1d2)]+'\x20'+_0x172e79[_0x3df1a5(0x196)]+_0x3df1a5(0x10f)+_0x30c543[_0x3df1a5(0xea)](0x6)+_0x3df1a5(0x195)),console[_0x3df1a5(0xcb)](_0x3df1a5(0x1bf)+_0x172e79['gateway']+_0x3df1a5(0x107)+_0x58e604+'%'),console[_0x3df1a5(0xcb)](_0x3df1a5(0x11a)+_0x2b4492[_0x3df1a5(0xea)](0x6)+_0x3df1a5(0x195));}console['log'](_0x3df1a5(0x176)+_0x172e79['id']+_0x3df1a5(0x184)+_0x1ba5ff[_0x3df1a5(0x10b)][_0x3df1a5(0xc1)]());}if(_0x311dbc['paymentDetails']){const _0x5b9230=_0x311dbc[_0x3df1a5(0x15b)];_0x5b9230[_0x3df1a5(0x152)]&&(_0x1ba5ff[_0x3df1a5(0xc8)]=_0x5b9230[_0x3df1a5(0x152)],console[_0x3df1a5(0xcb)](_0x3df1a5(0x125)+_0x5b9230[_0x3df1a5(0x152)]));if(_0x5b9230['bankDetails']){const _0x4e0cb4=_0x172e79[_0x3df1a5(0x112)]||'',_0x287d41='Bank\x20Details:\x20'+_0x5b9230[_0x3df1a5(0x14c)];_0x1ba5ff[_0x3df1a5(0x112)]=_0x4e0cb4?_0x4e0cb4+'\x0a\x0a'+_0x287d41:_0x287d41,console[_0x3df1a5(0xcb)](_0x3df1a5(0x186));}_0x5b9230['transactionId']&&console['log'](_0x3df1a5(0x148)+_0x5b9230[_0x3df1a5(0x14b)]),_0x5b9230['confirmedOn']&&console['log']('✅\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20'+_0x5b9230[_0x3df1a5(0x133)]);}await database_1[_0x3df1a5(0xf0)][_0x3df1a5(0x158)][_0x3df1a5(0x167)]({'where':{'id':_0x172e79['id']},'data':_0x1ba5ff});if(_0x311dbc['status']===_0x3df1a5(0xce)&&_0x172e79[_0x3df1a5(0xd8)]!==_0x3df1a5(0xce)){console[_0x3df1a5(0xcb)](_0x3df1a5(0x1b9)+_0x172e79['id']+_0x3df1a5(0x1c9));const _0x12a3e3=await database_1['default']['payment']['findUnique']({'where':{'id':_0x172e79['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x12a3e3?.[_0x3df1a5(0x1cf)]&&_0x12a3e3[_0x3df1a5(0x12b)])try{const _0x539a9b=_0x12a3e3[_0x3df1a5(0x12b)];console[_0x3df1a5(0xcb)](_0x3df1a5(0x164)+_0x539a9b['id']+_0x3df1a5(0x13d)+_0x539a9b['type']+_0x3df1a5(0x17a)+_0x539a9b[_0x3df1a5(0x16d)]+_0x3df1a5(0x177)+_0x539a9b[_0x3df1a5(0xd8)]);const _0x157b1c=_0x539a9b[_0x3df1a5(0x16d)]+0x1,_0x488ff4=_0x539a9b[_0x3df1a5(0x13b)]===_0x3df1a5(0x127)?'COMPLETED':_0x539a9b[_0x3df1a5(0xd8)];await database_1[_0x3df1a5(0xf0)]['paymentLink']['update']({'where':{'id':_0x539a9b['id']},'data':{'currentPayments':_0x157b1c,'status':_0x488ff4,'updatedAt':new Date()}}),console['log'](_0x3df1a5(0xf9)+_0x539a9b['id']+_0x3df1a5(0x113)+_0x539a9b[_0x3df1a5(0x16d)]+'\x20->\x20'+_0x157b1c+_0x3df1a5(0x177)+_0x539a9b[_0x3df1a5(0xd8)]+_0x3df1a5(0x10f)+_0x488ff4);}catch(_0x4621a4){console['error'](_0x3df1a5(0x109),_0x4621a4);}else console['log'](_0x3df1a5(0x1b9)+_0x172e79['id']+_0x3df1a5(0x1c8));}await database_1['default'][_0x3df1a5(0x161)][_0x3df1a5(0x175)]({'data':{'paymentId':_0x172e79['id'],'shopId':_0x172e79[_0x3df1a5(0x110)],'event':_0x3df1a5(0xe9)+_0x311dbc[_0x3df1a5(0xd8)][_0x3df1a5(0xca)](),'statusCode':0xc8,'responseBody':JSON['stringify']({'oldStatus':_0x172e79['status'],'newStatus':_0x311dbc[_0x3df1a5(0xd8)],'paymentDetails':_0x311dbc['paymentDetails'],'checkedAt':new Date()[_0x3df1a5(0xc1)]()})}}),await this['sendShopWebhook'](_0x172e79,_0x311dbc['status']),await this[_0x3df1a5(0xdf)](_0x172e79,_0x311dbc[_0x3df1a5(0xd8)]),_0x311dbc['status']!==_0x3df1a5(0x13e)&&(console[_0x3df1a5(0xcb)](_0x3df1a5(0x16a)+_0x172e79['id']+'\x20status\x20changed\x20to\x20'+_0x311dbc[_0x3df1a5(0xd8)]+_0x3df1a5(0x1af)),this[_0x3df1a5(0x159)](_0x172e79['id'])),console['log'](_0x3df1a5(0xd7)+_0x172e79['id']+_0x3df1a5(0x1aa));}else console[_0x3df1a5(0xcb)](_0x3df1a5(0xc4)+_0x172e79['id']+'\x20status\x20unchanged\x20('+_0x311dbc['status']+')'),this[_0x3df1a5(0x115)](_0x172e79['id'],_0x172e79['gatewayPaymentId'],_0x172e79['status'],_0x311dbc[_0x3df1a5(0xd8)],_0x3df1a5(0x1d0),{'statusUnchanged':!![],'paymentDetails':_0x311dbc[_0x3df1a5(0x15b)],'amount':_0x311dbc[_0x3df1a5(0x1d2)],'currency':_0x311dbc[_0x3df1a5(0x196)],'shopId':_0x172e79[_0x3df1a5(0x110)],'checkTimestamp':new Date()[_0x3df1a5(0xc1)]()});}catch(_0x268d2a){console[_0x3df1a5(0x1ae)](_0x3df1a5(0x1c5)+_0x172e79['id']+':',_0x268d2a),this[_0x3df1a5(0xc3)](_0x172e79['id'],_0x172e79[_0x3df1a5(0xee)],_0x268d2a,_0x3df1a5(0x1d0),{'paymentAmount':_0x172e79['amount'],'paymentCurrency':_0x172e79[_0x3df1a5(0x196)],'shopId':_0x172e79[_0x3df1a5(0x110)],'createdAt':_0x172e79[_0x3df1a5(0x15f)]}),await database_1[_0x3df1a5(0xf0)][_0x3df1a5(0x161)]['create']({'data':{'paymentId':_0x172e79['id'],'shopId':_0x172e79[_0x3df1a5(0x110)],'event':_0x3df1a5(0x147),'statusCode':0x1f4,'responseBody':JSON[_0x3df1a5(0xec)]({'error':_0x268d2a instanceof Error?_0x268d2a['message']:_0x3df1a5(0xe8),'gatewayPaymentId':_0x172e79[_0x3df1a5(0xee)],'checkedAt':new Date()[_0x3df1a5(0xc1)]()})}});}}async[a40_0x4033b8(0xcd)](_0x18bfcc,_0x7e5071){const _0x5c663b=a40_0x4033b8,_0x243017=Date[_0x5c663b(0x1d4)]();try{const _0x46c30f=_0x18bfcc[_0x5c663b(0x14a)],_0x166e0f=_0x46c30f[_0x5c663b(0x17c)];if(!_0x166e0f?.[_0x5c663b(0x135)]){console[_0x5c663b(0xcb)]('No\x20webhook\x20URL\x20configured\x20for\x20shop\x20'+_0x46c30f['id']);return;}const _0x2f42dd=_0x7e5071===_0x5c663b(0xce)?_0x5c663b(0xc0):_0x7e5071==='FAILED'?'payment.failed':_0x7e5071==='EXPIRED'?_0x5c663b(0x16c):_0x5c663b(0x18f);if(!_0x166e0f[_0x5c663b(0xe2)]?.['includes'](_0x2f42dd)){console[_0x5c663b(0xcb)](_0x5c663b(0xf7)+_0x2f42dd+_0x5c663b(0x146)+_0x46c30f['id']);return;}const _0xc56cbc=(0x0,gateway_1[_0x5c663b(0x103)])(_0x18bfcc[_0x5c663b(0x178)])||_0x18bfcc[_0x5c663b(0x178)],_0xbbb53a={'event':_0x2f42dd,'payment':{'id':_0x18bfcc['id'],'order_id':_0x18bfcc['orderId'],'gateway_order_id':_0x18bfcc[_0x5c663b(0x1cc)],'gateway':_0xc56cbc,'amount':_0x18bfcc[_0x5c663b(0x1d2)],'currency':_0x18bfcc[_0x5c663b(0x196)],'status':_0x7e5071[_0x5c663b(0xca)](),'customer_email':_0x18bfcc[_0x5c663b(0x1a2)],'customer_name':_0x18bfcc[_0x5c663b(0x18e)],'created_at':_0x18bfcc[_0x5c663b(0x15f)],'updated_at':new Date()}},_0x2be248=await fetch(_0x166e0f['webhookUrl'],{'method':_0x5c663b(0xc7),'headers':{'Content-Type':_0x5c663b(0x18d),'User-Agent':_0x5c663b(0x108)},'body':JSON[_0x5c663b(0xec)](_0xbbb53a)}),_0xb0b237=Date['now']()-_0x243017,_0x423de2=_0x2be248['ok']?_0x5c663b(0x197):await _0x2be248[_0x5c663b(0x120)]();loggerService_1[_0x5c663b(0xd3)]['logShopWebhookSent'](_0x18bfcc[_0x5c663b(0x110)],_0x166e0f[_0x5c663b(0x135)],_0x2f42dd,_0x2be248['status'],_0xb0b237,_0xbbb53a),console[_0x5c663b(0xcb)]('Shop\x20webhook\x20sent\x20to\x20'+_0x166e0f[_0x5c663b(0x135)]+_0x5c663b(0xd0)+_0x2be248['status']+'\x20('+_0xb0b237+_0x5c663b(0x1cd));}catch(_0xa90faa){console[_0x5c663b(0x1ae)](_0x5c663b(0x119),_0xa90faa),loggerService_1['loggerService'][_0x5c663b(0xfd)](_0x18bfcc[_0x5c663b(0x110)],_0x18bfcc[_0x5c663b(0x14a)]?.[_0x5c663b(0x17c)]?.[_0x5c663b(0x135)]||_0x5c663b(0x1ac),_0x5c663b(0x1b8),_0xa90faa,{});}}async[a40_0x4033b8(0xdf)](_0x3c4706,_0xe1ea5d){const _0x77b3f6=a40_0x4033b8;try{const _0x4b8704={'PENDING':'created','PAID':_0x77b3f6(0x17f),'FAILED':_0x77b3f6(0x168),'EXPIRED':_0x77b3f6(0x12a)},_0x4f09f2=_0x4b8704[_0xe1ea5d];if(!_0x4f09f2||_0x4f09f2===_0x77b3f6(0x124))return;await telegramBotService_1[_0x77b3f6(0x19b)][_0x77b3f6(0x1c0)](_0x3c4706['shopId'],_0x3c4706,_0x4f09f2);}catch(_0x70e184){console[_0x77b3f6(0x1ae)](_0x77b3f6(0xef),_0x70e184);}}async[a40_0x4033b8(0x14f)](_0x5ac8e9){const _0x4c6803=a40_0x4033b8;console[_0x4c6803(0xcb)](_0x4c6803(0xff)+_0x5ac8e9);const _0x1ade69=await database_1[_0x4c6803(0xf0)][_0x4c6803(0x158)][_0x4c6803(0xdb)]({'where':{'id':_0x5ac8e9},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x1ade69)throw new Error(_0x4c6803(0x18b));if(_0x1ade69[_0x4c6803(0x178)]!==_0x4c6803(0x13c)&&_0x1ade69[_0x4c6803(0x178)]!==_0x4c6803(0x194))throw new Error(_0x4c6803(0x10d));console[_0x4c6803(0xcb)](_0x4c6803(0x126)+_0x1ade69[_0x4c6803(0x178)]+_0x4c6803(0xe3)+_0x5ac8e9),await this[_0x4c6803(0x1b0)](_0x1ade69),console[_0x4c6803(0xcb)](_0x4c6803(0x1c2)+_0x5ac8e9);}[a40_0x4033b8(0xd4)](){const _0xf9b74c=a40_0x4033b8,_0x4868a2=this[_0xf9b74c(0x19c)]?this['GLOBAL_CHECK_INTERVAL_MS']:undefined,_0x2de8c8=Array[_0xf9b74c(0x136)](this[_0xf9b74c(0x189)][_0xf9b74c(0x104)]())[_0xf9b74c(0x155)](_0x3cdf51=>({'paymentId':_0x3cdf51[_0xf9b74c(0x1ca)],'gatewayPaymentId':_0x3cdf51[_0xf9b74c(0xee)],'createdAt':_0x3cdf51[_0xf9b74c(0x15f)],'timersCount':_0x3cdf51['timers'][_0xf9b74c(0x12c)]}));return{'isActive':!!this[_0xf9b74c(0x19c)],'globalCheckIntervalMinutes':this[_0xf9b74c(0x199)]/(0x3e8*0x3c),'expiryDays':this[_0xf9b74c(0x187)],'activeIndividualTimers':this[_0xf9b74c(0x189)][_0xf9b74c(0x122)],'nextGlobalCheckIn':_0x4868a2,'paymentTimersDetails':_0x2de8c8};}[a40_0x4033b8(0xeb)](_0x662291){const _0x5c5d58=a40_0x4033b8,_0x3af199=this[_0x5c5d58(0x189)][_0x5c5d58(0x12e)](_0x662291);if(_0x3af199)return{'hasTimers':!![],'timersCount':_0x3af199['timers'][_0x5c5d58(0x12c)],'createdAt':_0x3af199[_0x5c5d58(0x15f)],'gatewayPaymentId':_0x3af199['gatewayPaymentId']};return{'hasTimers':![]};}async[a40_0x4033b8(0x18a)](_0x4b9b00,_0x42478d){const _0x414f51=a40_0x4033b8;try{const _0x44c853=await database_1['default'][_0x414f51(0x14a)][_0x414f51(0xdb)]({'where':{'id':_0x4b9b00},'select':{'gatewaySettings':!![]}});if(!_0x44c853?.['gatewaySettings'])return console[_0x414f51(0xcb)](_0x414f51(0xbf)+_0x4b9b00+_0x414f51(0xc5)),0xa;const _0x31ca03=JSON['parse'](_0x44c853[_0x414f51(0x183)]);for(const [_0x1ca57d,_0x2f4f7d]of Object[_0x414f51(0xcc)](_0x31ca03)){if(_0x1ca57d[_0x414f51(0xca)]()===_0x42478d[_0x414f51(0xca)]()){const _0x5947fb=_0x2f4f7d[_0x414f51(0xbc)]||0xa;return console[_0x414f51(0xcb)](_0x414f51(0x17d)+_0x42478d+'\x20commission\x20for\x20shop\x20'+_0x4b9b00+':\x20'+_0x5947fb+'%'),_0x5947fb;}}return console[_0x414f51(0xcb)](_0x414f51(0x151)+_0x42478d+_0x414f51(0x160)+_0x4b9b00+_0x414f51(0x134)),0xa;}catch(_0x332f46){return console[_0x414f51(0x1ae)](_0x414f51(0x143)+_0x4b9b00+_0x414f51(0x193)+_0x42478d+':',_0x332f46),0xa;}}}function a40_0x14b7(_0x376fe3,_0x2d1689){const _0x7f6ac7=a40_0x7f6a();return a40_0x14b7=function(_0x14b784,_0x593063){_0x14b784=_0x14b784-0xbc;let _0x52ac48=_0x7f6ac7[_0x14b784];return _0x52ac48;},a40_0x14b7(_0x376fe3,_0x2d1689);}function a40_0x7f6a(){const _0x2a1771=['../config/database','\x20seconds\x20(','findUnique','\x20\x20\x20-\x20gatewayPaymentId:\x20','__esModule','5FMJuKr','sendPaymentStatusNotification','-day\x20timeout','\x20pending\x20CoinToPay\x20payments','webhookEvents','\x20payment\x20','❌\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','checkSinglePaymentById','8fyDGiX','Unknown\x20error','cointopay_status_check_','toFixed','getPaymentTimerInfo','stringify','coinToPayStatusService','gatewayPaymentId','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','default','.\x20Remaining\x20active\x20timers:\x20','\x20\x20\x20-\x20paymentId:\x20','\x20not\x20found,\x20clearing\x20timers','\x20skipped,\x20','message','COINTOPAY_ERROR','Webhook\x20event\x20','11178GcnmYb','✅\x20[COINTOPAY]\x20Payment\x20link\x20','auto_expire','🪙\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','description','logShopWebhookError','\x20\x20\x20❌\x20Error:\x20','🔍\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','\x20days,\x20marking\x20as\x20EXPIRED','🪙\x20[DEBUG]\x20Creating\x20','⏰\x20[EXPIRY]\x20Payment\x20','getGatewayIdByName','values','⏰\x20[GLOBAL]\x20Payment\x20','🪙\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','\x20commission:\x20','Payment\x20System/1.0','❌\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','\x20\x20\x20-\x20Status:\x20','paidAt','🪙\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','✅\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','\x20->\x20','shopId','Failed\x20to\x20mark\x20payment\x20as\x20expired','adminNotes','\x20updated:\x20currentPayments=','📊\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','logCoinToPayStatus','63gulTUK','checkAllPendingPayments','includes','Failed\x20to\x20send\x20shop\x20webhook:','\x20\x20\x20Amount\x20after\x20commission:\x20','324910lzuTKW','createdOn','EXPIRED','../types/gateway','⚠️\x20[CHECK]\x20Payment\x20','text','push','size','\x20days','created','🏦\x20[CHECK]\x20Saved\x20IBAN:\x20','✅\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','SINGLE','✅\x20[TIMER]\x20Individual\x20check\x20#','⚠️\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','expired','paymentLink','length','Automatically\x20expired\x20after\x20','get','/status/','\x20\x20\x20📅\x20Time:\x20','🪙\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','confirmedOn',',\x20using\x20default\x2010%','webhookUrl','from','🪙\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check',',\x20stopping\x20individual\x20checks','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','✅\x20[HOURLY]\x20Payment\x20','type','cointopay',':\x20type=','PENDING','❌\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','\x20\x20\x20Amount:\x20','setDate','getDate','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','\x20\x20\x20-\x20ShopId:\x20','🔍\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','\x20not\x20enabled\x20for\x20shop\x20','cointopay_status_check_error','🆔\x20[CHECK]\x20Transaction\x20ID:\x20','\x20initial\x20timers\x20for\x20payment\x20','shop','transactionId','bankDetails','convertToUSDT','not\x20confirmed','checkPaymentById','findMany','No\x20specific\x20commission\x20found\x20for\x20gateway\x20','iban','coinToPay2Service','\x20to\x20clear','map','2\x20minutes','\x20amounts\x20calculated:','payment','clearPaymentTimers','✅\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','paymentDetails','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','❌\x20[TIMER]\x20Failed\x20individual\x20check\x20#','🪙\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','createdAt','\x20in\x20shop\x20','webhookLog','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','✅\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','📈\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','📊\x20[CHECK]\x20CoinToPay\x20payment\x20','\x20(age:\x20','update','failed','⏰\x20[DEBUG]\x20Scheduled\x20check\x20#','🧹\x20[CHECK]\x20Payment\x20','3HSoQIX','payment.failed','currentPayments','schedule_created','✅\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','./loggerService','getTime','\x20is\x20too\x20new\x20(','🔍\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','\x20in\x20','create','💰\x20[CHECK]\x20Payment\x20',',\x20status=','gateway','floor',',\x20currentPayments=','./telegramBotService','settings','Gateway\x20','amountAfterGatewayCommissionUSDT','paid','\x20not\x20found\x20in\x20database','timestamp','timers','gatewaySettings','\x20marked\x20as\x20paid\x20at:\x20','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','🏦\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes','EXPIRY_DAYS','🛑\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','paymentTimers','getGatewayCommission','Payment\x20not\x20found','\x20completed\x20for\x20payment\x20','application/json','customerName','payment.pending','❌\x20[CHECK]\x20Payment\x20','\x20individual\x20payment\x20timers','not\x20found',',\x20gateway\x20','cointopay2','\x20USDT','currency','Success','2185095AgYoRX','GLOBAL_CHECK_INTERVAL_MS','\x20found:','telegramBotService','globalCheckInterval','\x20\x20\x20📊\x20Status:\x20','coinToPayService','amountUSDT','\x20to\x20','gatewayCommissionRate','customerEmail','✅\x20[DEBUG]\x20Successfully\x20scheduled\x20','checkPaymentStatus','🧹\x20[DEBUG]\x20Cleared\x20timer\x20#','\x20\x20\x20-\x20Amount:\x20','has','\x20is\x20older\x20than\x20','set','\x20updated\x20successfully','cointopay_auto_expired','unknown','checkExpiredPayments','error',',\x20clearing\x20individual\x20timers','checkSinglePayment','159732VPJhvS','Payment\x20older\x20than\x20','\x20status\x20from\x20','967236AuBxTJ','📊\x20[CHECK]\x20CoinToPay2\x20payment\x20','\x20\x20\x20📝\x20Context:','🛑\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','webhook_send','📈\x20[COINTOPAY]\x20Payment\x20','logWhiteDomainError','\x20status:\x20','❌\x20[HOURLY]\x20Payment\x20','\x20details:','\x20\x20\x20📍\x20Source:\x20','\x20\x20\x20Gateway\x20','sendPaymentNotification','❌\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','✅\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','🧹\x20[DEBUG]\x20Clearing\x20','🪙\x20[GLOBAL]\x20Found\x20','❌\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','⏰\x20[GLOBAL]\x20Found\x20','\x20status\x20is\x20','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','paymentId','\x20current\x20status:\x20','gatewayOrderId','ms)','CoinToPayStatusService','paymentLinkId','status_check','❌\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','amount','🪙\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','now','\x20for\x20payment\x20','\x20triggered\x20for\x20payment\x20','2602206kJYuPx','forEach','commission','752486SKHoPQ','✅\x20[EXPIRY]\x20Payment\x20','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','payment.success','toISOString','⏰\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','logCoinToPayError','📊\x20[CHECK]\x20Payment\x20',',\x20using\x20default\x20commission\x2010%','stopPeriodicStatusCheck','POST','remitterIban','CoinToPayService','toLowerCase','log','entries','sendShopWebhook','PAID','🪙\x20[ERROR]\x20CoinToPay\x20Error:\x20','\x20with\x20status\x20','❌\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','\x20has\x20no\x20gatewayPaymentId','loggerService','getServiceStats','🔄\x20[CHECK]\x20Updating\x20payment\x20','5\x20minutes','✅\x20[CHECK]\x20Payment\x20','status'];a40_0x7f6a=function(){return _0x2a1771;};return a40_0x7f6a();}exports[a40_0x4033b8(0x1ce)]=CoinToPayStatusService,exports[a40_0x4033b8(0xed)]=new CoinToPayStatusService();