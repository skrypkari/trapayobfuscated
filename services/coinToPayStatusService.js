'use strict';const a40_0x255eb9=a40_0x19bb;function a40_0x19bb(_0x1215d5,_0x4219f7){const _0x53bbe1=a40_0x53bb();return a40_0x19bb=function(_0x19bb40,_0x35c403){_0x19bb40=_0x19bb40-0x104;let _0x110539=_0x53bbe1[_0x19bb40];return _0x110539;},a40_0x19bb(_0x1215d5,_0x4219f7);}(function(_0x105c9b,_0x186c66){const _0xd6d1f2=a40_0x19bb,_0x1b9c5c=_0x105c9b();while(!![]){try{const _0x58c924=parseInt(_0xd6d1f2(0x209))/0x1+-parseInt(_0xd6d1f2(0x1c7))/0x2+parseInt(_0xd6d1f2(0x1bf))/0x3*(parseInt(_0xd6d1f2(0x175))/0x4)+parseInt(_0xd6d1f2(0x112))/0x5*(-parseInt(_0xd6d1f2(0x199))/0x6)+parseInt(_0xd6d1f2(0x1cc))/0x7+-parseInt(_0xd6d1f2(0x14b))/0x8+-parseInt(_0xd6d1f2(0x125))/0x9*(-parseInt(_0xd6d1f2(0x1c1))/0xa);if(_0x58c924===_0x186c66)break;else _0x1b9c5c['push'](_0x1b9c5c['shift']());}catch(_0x55c6d7){_0x1b9c5c['push'](_0x1b9c5c['shift']());}}}(a40_0x53bb,0x3e1c7));var __importDefault=this&&this['__importDefault']||function(_0x4c3e14){const _0x1912bf=a40_0x19bb;return _0x4c3e14&&_0x4c3e14[_0x1912bf(0x1a0)]?_0x4c3e14:{'default':_0x4c3e14};};Object['defineProperty'](exports,a40_0x255eb9(0x1a0),{'value':!![]}),exports[a40_0x255eb9(0x20e)]=exports['CoinToPayStatusService']=void 0x0;const coinToPayService_1=require(a40_0x255eb9(0x139)),coinToPay2Service_1=require(a40_0x255eb9(0x184)),gateway_1=require(a40_0x255eb9(0x1ad)),database_1=__importDefault(require(a40_0x255eb9(0x1d4))),telegramBotService_1=require('./telegramBotService'),loggerService_1=require('./loggerService'),currencyService_1=require(a40_0x255eb9(0x153));class CoinToPayStatusService{constructor(){const _0x35bead=a40_0x255eb9;this['globalCheckInterval']=null,this[_0x35bead(0x1d0)]=0x3c*0x3c*0x3e8,this['EXPIRY_DAYS']=0x5,this[_0x35bead(0x106)]=new Map(),this[_0x35bead(0x141)]=new coinToPayService_1[(_0x35bead(0x11a))](),this[_0x35bead(0x1e3)]=new coinToPay2Service_1[(_0x35bead(0x1a7))](),console[_0x35bead(0x178)]('🪙\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2');}[a40_0x255eb9(0x1b4)](_0x252a93,_0x123c4d){const _0x2a12cf=a40_0x255eb9;console[_0x2a12cf(0x178)](_0x2a12cf(0x14f)),console[_0x2a12cf(0x178)](_0x2a12cf(0x13b)+_0x252a93),console[_0x2a12cf(0x178)](_0x2a12cf(0x1db)+_0x123c4d),this[_0x2a12cf(0x1bc)](_0x252a93);const _0xcade39=[],_0x3061b2=new Date(),_0x1f7d30=[{'delay':0x1*0x3c*0x3e8,'description':'1\x20minute'},{'delay':0x2*0x3c*0x3e8,'description':_0x2a12cf(0x132)},{'delay':0x5*0x3c*0x3e8,'description':_0x2a12cf(0x1f3)},{'delay':0x5*0x3c*0x3e8,'description':_0x2a12cf(0x1f3)}];console[_0x2a12cf(0x178)](_0x2a12cf(0x122)+_0x1f7d30['length']+_0x2a12cf(0x17f)+_0x252a93);let _0x136568=0x0;_0x1f7d30[_0x2a12cf(0x115)]((_0x5704d6,_0x595be4)=>{const _0x2d2b56=_0x2a12cf;_0x136568+=_0x5704d6[_0x2d2b56(0x20a)];const _0x279133=setTimeout(async()=>{const _0x4c038b=_0x2d2b56;console[_0x4c038b(0x178)]('🪙\x20[TIMER]\x20Individual\x20check\x20#'+(_0x595be4+0x1)+_0x4c038b(0x198)+_0x252a93+_0x4c038b(0x1d6)+_0x5704d6[_0x4c038b(0x15b)]+')');try{await this['checkSinglePaymentById'](_0x252a93),console['log']('✅\x20[TIMER]\x20Individual\x20check\x20#'+(_0x595be4+0x1)+'\x20completed\x20for\x20payment\x20'+_0x252a93);}catch(_0x4c6cbf){console[_0x4c038b(0x1c3)](_0x4c038b(0x110)+(_0x595be4+0x1)+_0x4c038b(0x135)+_0x252a93+':',_0x4c6cbf),this[_0x4c038b(0x1a5)](_0x252a93,_0x123c4d,_0x4c6cbf,_0x4c038b(0x177),{'checkNumber':_0x595be4+0x1,'scheduledAfter':_0x5704d6['description'],'isIndividualCheck':!![]});}},_0x136568);_0xcade39['push'](_0x279133),console[_0x2d2b56(0x178)](_0x2d2b56(0x18c)+(_0x595be4+0x1)+_0x2d2b56(0x135)+_0x252a93+_0x2d2b56(0x140)+_0x136568/0x3e8+'\x20seconds\x20('+_0x5704d6['description']+')');});const _0x38ae23=setInterval(async()=>{const _0x245e49=_0x2a12cf;console['log'](_0x245e49(0x180)+_0x252a93);try{const _0x315246=await database_1['default'][_0x245e49(0x1ce)][_0x245e49(0x1c4)]({'where':{'id':_0x252a93},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x315246){console['log'](_0x245e49(0x1c6)+_0x252a93+'\x20not\x20found,\x20clearing\x20timers'),this['clearPaymentTimers'](_0x252a93);return;}console[_0x245e49(0x178)](_0x245e49(0x15e)+_0x252a93+'\x20current\x20status:\x20'+_0x315246[_0x245e49(0x157)]);if(_0x315246[_0x245e49(0x157)]!==_0x245e49(0x18f)){console[_0x245e49(0x178)](_0x245e49(0x17c)+_0x252a93+_0x245e49(0x172)+_0x315246[_0x245e49(0x157)]+',\x20stopping\x20individual\x20checks'),this[_0x245e49(0x1bc)](_0x252a93);return;}const _0x5ac136=Math[_0x245e49(0x15c)]((Date['now']()-_0x315246[_0x245e49(0x11b)][_0x245e49(0x1e7)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x5ac136>=this['EXPIRY_DAYS']){console[_0x245e49(0x178)]('⏰\x20[HOURLY]\x20Payment\x20'+_0x252a93+_0x245e49(0x130)+this['EXPIRY_DAYS']+_0x245e49(0x14e)),this[_0x245e49(0x1bc)](_0x252a93);return;}await this[_0x245e49(0x1d5)](_0x252a93),console[_0x245e49(0x178)](_0x245e49(0x1b2)+_0x252a93);}catch(_0x58c570){console[_0x245e49(0x1c3)](_0x245e49(0x14c)+_0x252a93+':',_0x58c570),this[_0x245e49(0x1a5)](_0x252a93,_0x123c4d,_0x58c570,'status_check',{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0xcade39[_0x2a12cf(0x1a6)](_0x38ae23),this['paymentTimers'][_0x2a12cf(0x19c)](_0x252a93,{'timers':_0xcade39,'paymentId':_0x252a93,'gatewayPaymentId':_0x123c4d,'createdAt':_0x3061b2}),console[_0x2a12cf(0x178)](_0x2a12cf(0x183)+_0x1f7d30[_0x2a12cf(0x13a)]+_0x2a12cf(0x17a)+_0x252a93),console['log'](_0x2a12cf(0x120)+this['paymentTimers'][_0x2a12cf(0x19f)]),this[_0x2a12cf(0x1d3)](_0x252a93,_0x123c4d,'PENDING',_0x2a12cf(0x18f),_0x2a12cf(0x177),{'action':_0x2a12cf(0x1e4),'scheduledChecks':_0x1f7d30['length'],'firstCheckIn':_0x1f7d30[0x0]['delay']/0x3e8,'totalTimers':this[_0x2a12cf(0x106)][_0x2a12cf(0x19f)]});}[a40_0x255eb9(0x1bc)](_0x5cdcae){const _0x2f519c=a40_0x255eb9,_0x2d68e3=this[_0x2f519c(0x106)]['get'](_0x5cdcae);_0x2d68e3?(console[_0x2f519c(0x178)](_0x2f519c(0x166)+_0x2d68e3[_0x2f519c(0x14a)][_0x2f519c(0x13a)]+_0x2f519c(0x154)+_0x5cdcae),_0x2d68e3['timers'][_0x2f519c(0x115)]((_0x4282f9,_0x18b615)=>{const _0x70c523=_0x2f519c;_0x4282f9&&(clearTimeout(_0x4282f9),clearInterval(_0x4282f9),console[_0x70c523(0x178)](_0x70c523(0x1c2)+(_0x18b615+0x1)+_0x70c523(0x135)+_0x5cdcae));}),this[_0x2f519c(0x106)][_0x2f519c(0x173)](_0x5cdcae),console[_0x2f519c(0x178)]('✅\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20'+_0x5cdcae+_0x2f519c(0x11f)+this[_0x2f519c(0x106)][_0x2f519c(0x19f)])):console['log'](_0x2f519c(0x134)+_0x5cdcae+_0x2f519c(0x203));}async[a40_0x255eb9(0x1d5)](_0x4f99bc){const _0xa2b21d=a40_0x255eb9;console['log'](_0xa2b21d(0x1d8)+_0x4f99bc);const _0x377e02=await database_1['default']['payment'][_0xa2b21d(0x1c4)]({'where':{'id':_0x4f99bc},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x377e02){console[_0xa2b21d(0x178)](_0xa2b21d(0x176)+_0x4f99bc+_0xa2b21d(0x20d));return;}console[_0xa2b21d(0x178)](_0xa2b21d(0x116)+_0x4f99bc+'\x20found:'),console[_0xa2b21d(0x178)](_0xa2b21d(0x17d)+_0x377e02[_0xa2b21d(0x1af)]),console[_0xa2b21d(0x178)]('\x20\x20\x20-\x20Status:\x20'+_0x377e02[_0xa2b21d(0x157)]),console[_0xa2b21d(0x178)](_0xa2b21d(0x179)+_0x377e02[_0xa2b21d(0x146)]),console[_0xa2b21d(0x178)]('\x20\x20\x20-\x20Amount:\x20'+_0x377e02['amount']+'\x20'+_0x377e02[_0xa2b21d(0x128)]),console[_0xa2b21d(0x178)](_0xa2b21d(0x155)+_0x377e02[_0xa2b21d(0x1c5)]);if(_0x377e02['gateway']!==_0xa2b21d(0x151)&&_0x377e02[_0xa2b21d(0x1af)]!=='cointopay2'){console[_0xa2b21d(0x178)]('⚠️\x20[CHECK]\x20Payment\x20'+_0x4f99bc+_0xa2b21d(0x18d)+_0x377e02[_0xa2b21d(0x1af)]+')');return;}if(_0x377e02[_0xa2b21d(0x157)]!==_0xa2b21d(0x18f)){console[_0xa2b21d(0x178)]('⚠️\x20[CHECK]\x20Payment\x20'+_0x4f99bc+_0xa2b21d(0x172)+_0x377e02[_0xa2b21d(0x157)]+_0xa2b21d(0x1a8)),this[_0xa2b21d(0x1bc)](_0x4f99bc);return;}if(!_0x377e02[_0xa2b21d(0x146)]){console[_0xa2b21d(0x178)](_0xa2b21d(0x1d7)+_0x4f99bc+_0xa2b21d(0x11e));return;}console['log']('✅\x20[CHECK]\x20Payment\x20'+_0x4f99bc+_0xa2b21d(0x1b6)),await this['checkSinglePayment'](_0x377e02);}[a40_0x255eb9(0x1d3)](_0x21c5ab,_0x4aabda,_0x5e51f0,_0x250a86,_0x2049da,_0x266b04){const _0x2c0e91=a40_0x255eb9,_0x4f7b39={'type':'COINTOPAY_STATUS_CHANGE','paymentId':_0x21c5ab,'gatewayPaymentId':_0x4aabda,'oldStatus':_0x5e51f0,'newStatus':_0x250a86,'source':_0x2049da,'timestamp':new Date()[_0x2c0e91(0x164)](),'details':_0x266b04||{}};loggerService_1[_0x2c0e91(0x208)][_0x2c0e91(0x1d3)](_0x4f7b39),console[_0x2c0e91(0x178)](_0x2c0e91(0x18a)+_0x21c5ab+'\x20('+_0x4aabda+')'),console['log']('\x20\x20\x20📊\x20Status:\x20'+_0x5e51f0+_0x2c0e91(0x1f1)+_0x250a86),console['log']('\x20\x20\x20📍\x20Source:\x20'+_0x2049da),console[_0x2c0e91(0x178)](_0x2c0e91(0x131)+_0x4f7b39[_0x2c0e91(0x104)]),_0x266b04&&console[_0x2c0e91(0x178)](_0x2c0e91(0x12f),_0x266b04);}['logCoinToPayError'](_0x44aeda,_0x3aa22f,_0x11b36c,_0x353e81,_0x3f8f37){const _0x4e5124=a40_0x255eb9,_0x40c439={'type':_0x4e5124(0x152),'paymentId':_0x44aeda,'gatewayPaymentId':_0x3aa22f,'error':_0x11b36c instanceof Error?{'message':_0x11b36c['message'],'stack':_0x11b36c[_0x4e5124(0x14d)]}:_0x11b36c,'source':_0x353e81,'timestamp':new Date()[_0x4e5124(0x164)](),'context':_0x3f8f37||{}};loggerService_1[_0x4e5124(0x208)][_0x4e5124(0x1a5)](_0x40c439),console[_0x4e5124(0x1c3)](_0x4e5124(0x126)+_0x44aeda+'\x20('+_0x3aa22f+')'),console[_0x4e5124(0x1c3)](_0x4e5124(0x186)+(_0x11b36c instanceof Error?_0x11b36c[_0x4e5124(0x187)]:_0x11b36c)),console['error'](_0x4e5124(0x174)+_0x353e81),console['error'](_0x4e5124(0x131)+_0x40c439[_0x4e5124(0x104)]),_0x3f8f37&&console['error'](_0x4e5124(0x1c9),_0x3f8f37);}[a40_0x255eb9(0x1cd)](){const _0x5165bc=a40_0x255eb9;console[_0x5165bc(0x178)](_0x5165bc(0x158)),this[_0x5165bc(0x16f)]()['catch'](_0x31eb9b=>{const _0xc180a4=_0x5165bc;console[_0xc180a4(0x1c3)](_0xc180a4(0x138),_0x31eb9b);}),this['globalCheckInterval']=setInterval(async()=>{const _0x16ae2d=_0x5165bc;try{console['log'](_0x16ae2d(0x159)),await this[_0x16ae2d(0x16f)](),console[_0x16ae2d(0x178)](_0x16ae2d(0x1f2));}catch(_0x2def1c){console[_0x16ae2d(0x1c3)](_0x16ae2d(0x1f0),_0x2def1c);}},this[_0x5165bc(0x1d0)]),console['log'](_0x5165bc(0x161));}['stopPeriodicStatusCheck'](){const _0x574c6f=a40_0x255eb9;console[_0x574c6f(0x178)](_0x574c6f(0x188));this['globalCheckInterval']&&(clearInterval(this[_0x574c6f(0x142)]),this[_0x574c6f(0x142)]=null,console[_0x574c6f(0x178)]('🛑\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped'));const _0x4ad5ce=this[_0x574c6f(0x106)][_0x574c6f(0x19f)];for(const [_0x304841]of this[_0x574c6f(0x106)]){this[_0x574c6f(0x1bc)](_0x304841);}console[_0x574c6f(0x178)](_0x574c6f(0x108)+_0x4ad5ce+_0x574c6f(0x1ef));}async['checkAllPendingPayments'](){const _0x15c2cc=a40_0x255eb9;try{console['log'](_0x15c2cc(0x16a));const _0x800b41=await database_1['default'][_0x15c2cc(0x1ce)][_0x15c2cc(0x1f7)]({'where':{'gateway':{'in':[_0x15c2cc(0x151),'cointopay2']},'status':_0x15c2cc(0x18f),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console['log'](_0x15c2cc(0x190)+_0x800b41[_0x15c2cc(0x13a)]+'\x20pending\x20CoinToPay\x20payments');if(_0x800b41[_0x15c2cc(0x13a)]===0x0){console[_0x15c2cc(0x178)](_0x15c2cc(0x105));return;}const _0xddbb24=await this[_0x15c2cc(0x185)](_0x800b41);console[_0x15c2cc(0x178)]('⏰\x20[GLOBAL]\x20Found\x20'+_0xddbb24[_0x15c2cc(0x13a)]+_0x15c2cc(0x1fe));let _0x372df3=0x0,_0x3ef920=0x0;for(const _0x4ae7e8 of _0x800b41){try{if(_0xddbb24['includes'](_0x4ae7e8['id'])){console['log'](_0x15c2cc(0x17b)+_0x4ae7e8['id']+'\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check'),_0x3ef920++;continue;}if(this[_0x15c2cc(0x106)][_0x15c2cc(0x148)](_0x4ae7e8['id'])){console[_0x15c2cc(0x178)]('⏰\x20[GLOBAL]\x20Payment\x20'+_0x4ae7e8['id']+_0x15c2cc(0x1b8)),_0x3ef920++;continue;}const _0xd0fb05=(Date[_0x15c2cc(0x10a)]()-_0x4ae7e8['createdAt'][_0x15c2cc(0x1e7)]())/(0x3e8*0x3c*0x3c);if(_0xd0fb05<0x1){console['log'](_0x15c2cc(0x17b)+_0x4ae7e8['id']+_0x15c2cc(0x107)+_0xd0fb05[_0x15c2cc(0x1e9)](0x1)+_0x15c2cc(0x124)),_0x3ef920++;continue;}console[_0x15c2cc(0x178)](_0x15c2cc(0x1da)+_0x4ae7e8['id']+_0x15c2cc(0x147)+_0xd0fb05[_0x15c2cc(0x1e9)](0x1)+'h)'),await this[_0x15c2cc(0x12e)](_0x4ae7e8),_0x372df3++,await new Promise(_0x5a4e1d=>setTimeout(_0x5a4e1d,0x7d0));}catch(_0x32308d){console[_0x15c2cc(0x1c3)]('❌\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20'+_0x4ae7e8['id']+':',_0x32308d),this[_0x15c2cc(0x1a5)](_0x4ae7e8['id'],_0x4ae7e8[_0x15c2cc(0x146)]||_0x15c2cc(0x109),_0x32308d,_0x15c2cc(0x177),{'isGlobalCheck':!![],'paymentAmount':_0x4ae7e8[_0x15c2cc(0x1f8)],'paymentCurrency':_0x4ae7e8[_0x15c2cc(0x128)],'shopId':_0x4ae7e8[_0x15c2cc(0x1c5)],'createdAt':_0x4ae7e8[_0x15c2cc(0x11b)]}),loggerService_1[_0x15c2cc(0x208)]['logWhiteDomainError'](_0x15c2cc(0x151),'/status/'+_0x4ae7e8[_0x15c2cc(0x146)],_0x32308d);}}console[_0x15c2cc(0x178)]('✅\x20[GLOBAL]\x20Global\x20check\x20completed:\x20'+_0x372df3+_0x15c2cc(0x123)+_0x3ef920+_0x15c2cc(0x1dc)+_0xddbb24[_0x15c2cc(0x13a)]+_0x15c2cc(0x1be));}catch(_0x136e80){console['error'](_0x15c2cc(0x1bd),_0x136e80);}}async[a40_0x255eb9(0x185)](_0x119700){const _0x19a40a=a40_0x255eb9,_0x26ff94=[],_0x30ded7=new Date();_0x30ded7[_0x19a40a(0x169)](_0x30ded7[_0x19a40a(0x118)]()-this['EXPIRY_DAYS']),console[_0x19a40a(0x178)](_0x19a40a(0x1b1)+this[_0x19a40a(0x149)]+_0x19a40a(0x16c)+_0x30ded7[_0x19a40a(0x164)]()+')');for(const _0x5d7709 of _0x119700){if(_0x5d7709[_0x19a40a(0x11b)]<_0x30ded7){console[_0x19a40a(0x178)](_0x19a40a(0x205)+_0x5d7709['id']+_0x19a40a(0x130)+this[_0x19a40a(0x149)]+_0x19a40a(0x20f));try{this[_0x19a40a(0x1d3)](_0x5d7709['id'],_0x5d7709[_0x19a40a(0x146)]||_0x19a40a(0x109),_0x19a40a(0x18f),_0x19a40a(0x114),_0x19a40a(0x1cf),{'reason':_0x19a40a(0x170)+this[_0x19a40a(0x149)]+_0x19a40a(0x1ed),'createdAt':_0x5d7709[_0x19a40a(0x11b)],'daysSinceCreation':Math[_0x19a40a(0x15c)]((Date[_0x19a40a(0x10a)]()-_0x5d7709['createdAt'][_0x19a40a(0x1e7)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x5d7709[_0x19a40a(0x1f8)],'paymentCurrency':_0x5d7709[_0x19a40a(0x128)],'shopId':_0x5d7709[_0x19a40a(0x1c5)]}),await database_1[_0x19a40a(0x1ac)][_0x19a40a(0x1ce)][_0x19a40a(0x182)]({'where':{'id':_0x5d7709['id']},'data':{'status':_0x19a40a(0x114),'updatedAt':new Date(),'adminNotes':_0x19a40a(0x1f5)+this['EXPIRY_DAYS']+_0x19a40a(0x1a2)}}),await database_1[_0x19a40a(0x1ac)]['webhookLog'][_0x19a40a(0x1ae)]({'data':{'paymentId':_0x5d7709['id'],'shopId':_0x5d7709[_0x19a40a(0x1c5)],'event':'cointopay_auto_expired','statusCode':0xc8,'responseBody':JSON[_0x19a40a(0x20c)]({'reason':'Payment\x20older\x20than\x20'+this[_0x19a40a(0x149)]+_0x19a40a(0x1ed),'createdAt':_0x5d7709[_0x19a40a(0x11b)],'expiredAt':new Date()[_0x19a40a(0x164)](),'daysSinceCreation':Math[_0x19a40a(0x15c)]((Date['now']()-_0x5d7709[_0x19a40a(0x11b)][_0x19a40a(0x1e7)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this['sendShopWebhook'](_0x5d7709,_0x19a40a(0x114)),await this[_0x19a40a(0x10b)](_0x5d7709,_0x19a40a(0x114)),this['clearPaymentTimers'](_0x5d7709['id']),_0x26ff94[_0x19a40a(0x1a6)](_0x5d7709['id']),console[_0x19a40a(0x178)]('✅\x20[EXPIRY]\x20Payment\x20'+_0x5d7709['id']+_0x19a40a(0x1e2)+this[_0x19a40a(0x149)]+_0x19a40a(0x127));}catch(_0x38c954){console[_0x19a40a(0x1c3)]('❌\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20'+_0x5d7709['id']+':',_0x38c954),this[_0x19a40a(0x1a5)](_0x5d7709['id'],_0x5d7709[_0x19a40a(0x146)]||_0x19a40a(0x109),_0x38c954,'auto_expire',{'reason':'Failed\x20to\x20mark\x20payment\x20as\x20expired','createdAt':_0x5d7709[_0x19a40a(0x11b)],'daysSinceCreation':Math[_0x19a40a(0x15c)]((Date[_0x19a40a(0x10a)]()-_0x5d7709[_0x19a40a(0x11b)]['getTime']())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x26ff94;}async[a40_0x255eb9(0x12e)](_0x4d5b1b){const _0x159a4d=a40_0x255eb9;if(!_0x4d5b1b[_0x159a4d(0x146)]){console[_0x159a4d(0x178)](_0x159a4d(0x1d7)+_0x4d5b1b['id']+_0x159a4d(0x1e5));return;}console[_0x159a4d(0x178)](_0x159a4d(0x121)+_0x4d5b1b[_0x159a4d(0x1af)]+'\x20payment\x20'+_0x4d5b1b['id']+'\x20('+_0x4d5b1b['gatewayPaymentId']+')');try{let _0x22828f;_0x4d5b1b[_0x159a4d(0x1af)]===_0x159a4d(0x156)?(_0x22828f=await this['coinToPay2Service'][_0x159a4d(0x163)](_0x4d5b1b[_0x159a4d(0x146)]),console[_0x159a4d(0x178)](_0x159a4d(0x150)+_0x4d5b1b['id']+'\x20status:\x20'+_0x22828f[_0x159a4d(0x157)])):(_0x22828f=await this[_0x159a4d(0x141)][_0x159a4d(0x163)](_0x4d5b1b[_0x159a4d(0x146)]),console[_0x159a4d(0x178)](_0x159a4d(0x1a1)+_0x4d5b1b['id']+'\x20status:\x20'+_0x22828f[_0x159a4d(0x157)]));_0x22828f[_0x159a4d(0x119)]&&console[_0x159a4d(0x178)](_0x159a4d(0x116)+_0x4d5b1b['id']+_0x159a4d(0x145),{'iban':_0x22828f[_0x159a4d(0x119)][_0x159a4d(0x15d)]||'not\x20found','transactionId':_0x22828f[_0x159a4d(0x119)][_0x159a4d(0x201)],'createdOn':_0x22828f[_0x159a4d(0x119)][_0x159a4d(0x194)],'confirmedOn':_0x22828f['paymentDetails'][_0x159a4d(0x1a4)]||'not\x20confirmed'});if(_0x22828f[_0x159a4d(0x157)]!==_0x4d5b1b[_0x159a4d(0x157)]){console['log'](_0x159a4d(0x1dd)+_0x4d5b1b['id']+'\x20status\x20from\x20'+_0x4d5b1b['status']+'\x20to\x20'+_0x22828f[_0x159a4d(0x157)]),this[_0x159a4d(0x1d3)](_0x4d5b1b['id'],_0x4d5b1b[_0x159a4d(0x146)],_0x4d5b1b[_0x159a4d(0x157)],_0x22828f['status'],'status_check',{'paymentDetails':_0x22828f['paymentDetails'],'amount':_0x22828f['amount'],'currency':_0x22828f[_0x159a4d(0x128)],'shopId':_0x4d5b1b[_0x159a4d(0x1c5)],'checkTimestamp':new Date()[_0x159a4d(0x164)]()});const _0xd1a14b={'status':_0x22828f[_0x159a4d(0x157)],'updatedAt':new Date()};if(_0x22828f[_0x159a4d(0x157)]===_0x159a4d(0x171)&&_0x4d5b1b[_0x159a4d(0x157)]!==_0x159a4d(0x171)){_0xd1a14b[_0x159a4d(0x12b)]=new Date();if(!_0x4d5b1b[_0x159a4d(0x19d)]){const _0x5a13ba=await currencyService_1['currencyService'][_0x159a4d(0x1a3)](_0x4d5b1b['amount'],_0x4d5b1b[_0x159a4d(0x128)]);_0xd1a14b[_0x159a4d(0x19d)]=_0x5a13ba;const _0x38b27b=await this[_0x159a4d(0x1fa)](_0x4d5b1b[_0x159a4d(0x1c5)],_0x4d5b1b['gateway']),_0x357938=_0x5a13ba*(0x1-_0x38b27b/0x64);_0xd1a14b['amountAfterGatewayCommissionUSDT']=_0x357938,_0xd1a14b[_0x159a4d(0x197)]=_0x38b27b,console[_0x159a4d(0x178)](_0x159a4d(0x18b)+_0x4d5b1b['id']+_0x159a4d(0x191)),console[_0x159a4d(0x178)](_0x159a4d(0x1fd)+_0x4d5b1b[_0x159a4d(0x1f8)]+'\x20'+_0x4d5b1b[_0x159a4d(0x128)]+'\x20->\x20'+_0x5a13ba[_0x159a4d(0x1e9)](0x6)+_0x159a4d(0x15a)),console[_0x159a4d(0x178)](_0x159a4d(0x207)+_0x4d5b1b[_0x159a4d(0x1af)]+_0x159a4d(0x16d)+_0x38b27b+'%'),console[_0x159a4d(0x178)]('\x20\x20\x20Amount\x20after\x20commission:\x20'+_0x357938[_0x159a4d(0x1e9)](0x6)+'\x20USDT');}console['log'](_0x159a4d(0x18b)+_0x4d5b1b['id']+_0x159a4d(0x195)+_0xd1a14b['paidAt'][_0x159a4d(0x164)]());}if(_0x22828f[_0x159a4d(0x119)]){const _0x46eb66=_0x22828f[_0x159a4d(0x119)];_0x46eb66[_0x159a4d(0x15d)]&&(_0xd1a14b['remitterIban']=_0x46eb66[_0x159a4d(0x15d)],console[_0x159a4d(0x178)]('🏦\x20[CHECK]\x20Saved\x20IBAN:\x20'+_0x46eb66[_0x159a4d(0x15d)]));if(_0x46eb66['bankDetails']){const _0x5c73b9=_0x4d5b1b[_0x159a4d(0x1bb)]||'',_0x7d921='Bank\x20Details:\x20'+_0x46eb66[_0x159a4d(0x1a9)];_0xd1a14b[_0x159a4d(0x1bb)]=_0x5c73b9?_0x5c73b9+'\x0a\x0a'+_0x7d921:_0x7d921,console[_0x159a4d(0x178)](_0x159a4d(0x204));}_0x46eb66[_0x159a4d(0x201)]&&console[_0x159a4d(0x178)](_0x159a4d(0x1f9)+_0x46eb66[_0x159a4d(0x201)]),_0x46eb66[_0x159a4d(0x1a4)]&&console[_0x159a4d(0x178)]('✅\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20'+_0x46eb66[_0x159a4d(0x1a4)]);}await database_1[_0x159a4d(0x1ac)][_0x159a4d(0x1ce)]['update']({'where':{'id':_0x4d5b1b['id']},'data':_0xd1a14b});if(_0x22828f[_0x159a4d(0x157)]===_0x159a4d(0x171)&&_0x4d5b1b[_0x159a4d(0x157)]!==_0x159a4d(0x171)){console[_0x159a4d(0x178)]('📈\x20[COINTOPAY]\x20Payment\x20'+_0x4d5b1b['id']+_0x159a4d(0x1ba));const _0x5a6605=await database_1[_0x159a4d(0x1ac)][_0x159a4d(0x1ce)][_0x159a4d(0x1c4)]({'where':{'id':_0x4d5b1b['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x5a6605?.[_0x159a4d(0x167)]&&_0x5a6605['paymentLink'])try{const _0x336f2b=_0x5a6605['paymentLink'];console[_0x159a4d(0x178)](_0x159a4d(0x20b)+_0x336f2b['id']+_0x159a4d(0x143)+_0x336f2b['type']+_0x159a4d(0x196)+_0x336f2b[_0x159a4d(0x1ab)]+_0x159a4d(0x1ea)+_0x336f2b[_0x159a4d(0x157)]);const _0x5be4c5=_0x336f2b[_0x159a4d(0x1ab)]+0x1,_0x51fb92=_0x336f2b['type']===_0x159a4d(0x1d2)?_0x159a4d(0x1d1):_0x336f2b[_0x159a4d(0x157)];await database_1[_0x159a4d(0x1ac)][_0x159a4d(0x1d9)][_0x159a4d(0x182)]({'where':{'id':_0x336f2b['id']},'data':{'currentPayments':_0x5be4c5,'status':_0x51fb92,'updatedAt':new Date()}}),console[_0x159a4d(0x178)]('✅\x20[COINTOPAY]\x20Payment\x20link\x20'+_0x336f2b['id']+_0x159a4d(0x111)+_0x336f2b[_0x159a4d(0x1ab)]+'\x20->\x20'+_0x5be4c5+_0x159a4d(0x1ea)+_0x336f2b[_0x159a4d(0x157)]+_0x159a4d(0x1f1)+_0x51fb92);}catch(_0xd68c4e){console[_0x159a4d(0x1c3)](_0x159a4d(0x13d),_0xd68c4e);}else console[_0x159a4d(0x178)](_0x159a4d(0x1b9)+_0x4d5b1b['id']+'\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link');}await database_1[_0x159a4d(0x1ac)][_0x159a4d(0x1df)][_0x159a4d(0x1ae)]({'data':{'paymentId':_0x4d5b1b['id'],'shopId':_0x4d5b1b[_0x159a4d(0x1c5)],'event':_0x159a4d(0x1ff)+_0x22828f[_0x159a4d(0x157)]['toLowerCase'](),'statusCode':0xc8,'responseBody':JSON['stringify']({'oldStatus':_0x4d5b1b[_0x159a4d(0x157)],'newStatus':_0x22828f['status'],'paymentDetails':_0x22828f[_0x159a4d(0x119)],'checkedAt':new Date()[_0x159a4d(0x164)]()})}}),await this[_0x159a4d(0x1de)](_0x4d5b1b,_0x22828f[_0x159a4d(0x157)]),await this[_0x159a4d(0x10b)](_0x4d5b1b,_0x22828f[_0x159a4d(0x157)]),_0x22828f['status']!=='PENDING'&&(console[_0x159a4d(0x178)](_0x159a4d(0x1eb)+_0x4d5b1b['id']+_0x159a4d(0x1aa)+_0x22828f[_0x159a4d(0x157)]+_0x159a4d(0x10e)),this[_0x159a4d(0x1bc)](_0x4d5b1b['id'])),console[_0x159a4d(0x178)](_0x159a4d(0x117)+_0x4d5b1b['id']+_0x159a4d(0x10d));}else console[_0x159a4d(0x178)]('📊\x20[CHECK]\x20Payment\x20'+_0x4d5b1b['id']+_0x159a4d(0x10c)+_0x22828f[_0x159a4d(0x157)]+')'),this[_0x159a4d(0x1d3)](_0x4d5b1b['id'],_0x4d5b1b[_0x159a4d(0x146)],_0x4d5b1b[_0x159a4d(0x157)],_0x22828f[_0x159a4d(0x157)],_0x159a4d(0x177),{'statusUnchanged':!![],'paymentDetails':_0x22828f['paymentDetails'],'amount':_0x22828f['amount'],'currency':_0x22828f[_0x159a4d(0x128)],'shopId':_0x4d5b1b['shopId'],'checkTimestamp':new Date()[_0x159a4d(0x164)]()});}catch(_0x5dee16){console[_0x159a4d(0x1c3)](_0x159a4d(0x12a)+_0x4d5b1b['id']+':',_0x5dee16),this['logCoinToPayError'](_0x4d5b1b['id'],_0x4d5b1b['gatewayPaymentId'],_0x5dee16,_0x159a4d(0x177),{'paymentAmount':_0x4d5b1b[_0x159a4d(0x1f8)],'paymentCurrency':_0x4d5b1b[_0x159a4d(0x128)],'shopId':_0x4d5b1b[_0x159a4d(0x1c5)],'createdAt':_0x4d5b1b['createdAt']}),await database_1['default'][_0x159a4d(0x1df)]['create']({'data':{'paymentId':_0x4d5b1b['id'],'shopId':_0x4d5b1b[_0x159a4d(0x1c5)],'event':'cointopay_status_check_error','statusCode':0x1f4,'responseBody':JSON[_0x159a4d(0x20c)]({'error':_0x5dee16 instanceof Error?_0x5dee16[_0x159a4d(0x187)]:_0x159a4d(0x202),'gatewayPaymentId':_0x4d5b1b['gatewayPaymentId'],'checkedAt':new Date()[_0x159a4d(0x164)]()})}});}}async[a40_0x255eb9(0x1de)](_0x251c38,_0x17cad3){const _0x474c8f=a40_0x255eb9,_0x41528d=Date[_0x474c8f(0x10a)]();try{const _0x5bc351=_0x251c38['shop'],_0x223f1d=_0x5bc351['settings'];if(!_0x223f1d?.[_0x474c8f(0x192)]){console['log'](_0x474c8f(0x113)+_0x5bc351['id']);return;}const _0x48f8d8=_0x17cad3===_0x474c8f(0x171)?_0x474c8f(0x162):_0x17cad3==='FAILED'?'payment.failed':_0x17cad3===_0x474c8f(0x114)?_0x474c8f(0x1b7):'payment.pending';if(!_0x223f1d[_0x474c8f(0x1f4)]?.[_0x474c8f(0x181)](_0x48f8d8)){console[_0x474c8f(0x178)]('Webhook\x20event\x20'+_0x48f8d8+_0x474c8f(0x16b)+_0x5bc351['id']);return;}const _0x3b69eb=(0x0,gateway_1[_0x474c8f(0x11c)])(_0x251c38['gateway'])||_0x251c38[_0x474c8f(0x1af)],_0x2f854a={'event':_0x48f8d8,'payment':{'id':_0x251c38['id'],'order_id':_0x251c38[_0x474c8f(0x16e)],'gateway_order_id':_0x251c38[_0x474c8f(0x19b)],'gateway':_0x3b69eb,'amount':_0x251c38[_0x474c8f(0x1f8)],'currency':_0x251c38[_0x474c8f(0x128)],'status':_0x17cad3['toLowerCase'](),'customer_email':_0x251c38[_0x474c8f(0x1fb)],'customer_name':_0x251c38[_0x474c8f(0x1b5)],'created_at':_0x251c38[_0x474c8f(0x11b)],'updated_at':new Date()}},_0x12ff8b=await fetch(_0x223f1d['webhookUrl'],{'method':_0x474c8f(0x1e8),'headers':{'Content-Type':_0x474c8f(0x133),'User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x474c8f(0x20c)](_0x2f854a)}),_0x5b0615=Date[_0x474c8f(0x10a)]()-_0x41528d,_0x437d3e=_0x12ff8b['ok']?_0x474c8f(0x1e1):await _0x12ff8b[_0x474c8f(0x200)]();loggerService_1['loggerService'][_0x474c8f(0x15f)](_0x251c38[_0x474c8f(0x1c5)],_0x223f1d[_0x474c8f(0x192)],_0x48f8d8,_0x12ff8b['status'],_0x5b0615,_0x2f854a),console[_0x474c8f(0x178)]('Shop\x20webhook\x20sent\x20to\x20'+_0x223f1d['webhookUrl']+_0x474c8f(0x1ca)+_0x12ff8b[_0x474c8f(0x157)]+'\x20('+_0x5b0615+_0x474c8f(0x137));}catch(_0x269ae0){console['error'](_0x474c8f(0x160),_0x269ae0),loggerService_1['loggerService'][_0x474c8f(0x165)](_0x251c38[_0x474c8f(0x1c5)],_0x251c38[_0x474c8f(0x136)]?.[_0x474c8f(0x189)]?.[_0x474c8f(0x192)]||_0x474c8f(0x109),_0x474c8f(0x1fc),_0x269ae0,{});}}async['sendPaymentStatusNotification'](_0x4e353e,_0x467cbd){const _0x1772d1=a40_0x255eb9;try{const _0x285f5f={'PENDING':_0x1772d1(0x12d),'PAID':'paid','FAILED':_0x1772d1(0x13e),'EXPIRED':_0x1772d1(0x168)},_0x2185f3=_0x285f5f[_0x467cbd];if(!_0x2185f3||_0x2185f3==='created')return;await telegramBotService_1['telegramBotService'][_0x1772d1(0x1b0)](_0x4e353e[_0x1772d1(0x1c5)],_0x4e353e,_0x2185f3);}catch(_0xe17be4){console[_0x1772d1(0x1c3)](_0x1772d1(0x13f),_0xe17be4);}}async[a40_0x255eb9(0x1ee)](_0x2b1816){const _0x12e222=a40_0x255eb9;console['log'](_0x12e222(0x1cb)+_0x2b1816);const _0x431d23=await database_1['default'][_0x12e222(0x1ce)][_0x12e222(0x1c4)]({'where':{'id':_0x2b1816},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x431d23)throw new Error('Payment\x20not\x20found');if(_0x431d23[_0x12e222(0x1af)]!=='cointopay'&&_0x431d23[_0x12e222(0x1af)]!==_0x12e222(0x156))throw new Error('Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment');console[_0x12e222(0x178)](_0x12e222(0x17e)+_0x431d23[_0x12e222(0x1af)]+_0x12e222(0x193)+_0x2b1816),await this[_0x12e222(0x12e)](_0x431d23),console[_0x12e222(0x178)](_0x12e222(0x19a)+_0x2b1816);}[a40_0x255eb9(0x11d)](){const _0x32e629=a40_0x255eb9,_0x24e664=this[_0x32e629(0x142)]?this[_0x32e629(0x1d0)]:undefined,_0x2dc0cf=Array['from'](this[_0x32e629(0x106)][_0x32e629(0x1c8)]())[_0x32e629(0x13c)](_0x3b2b47=>({'paymentId':_0x3b2b47[_0x32e629(0x144)],'gatewayPaymentId':_0x3b2b47[_0x32e629(0x146)],'createdAt':_0x3b2b47[_0x32e629(0x11b)],'timersCount':_0x3b2b47[_0x32e629(0x14a)][_0x32e629(0x13a)]}));return{'isActive':!!this[_0x32e629(0x142)],'globalCheckIntervalMinutes':this[_0x32e629(0x1d0)]/(0x3e8*0x3c),'expiryDays':this['EXPIRY_DAYS'],'activeIndividualTimers':this[_0x32e629(0x106)][_0x32e629(0x19f)],'nextGlobalCheckIn':_0x24e664,'paymentTimersDetails':_0x2dc0cf};}[a40_0x255eb9(0x1f6)](_0x25049c){const _0x1adae7=a40_0x255eb9,_0x4e28a5=this[_0x1adae7(0x106)][_0x1adae7(0x12c)](_0x25049c);if(_0x4e28a5)return{'hasTimers':!![],'timersCount':_0x4e28a5['timers']['length'],'createdAt':_0x4e28a5[_0x1adae7(0x11b)],'gatewayPaymentId':_0x4e28a5[_0x1adae7(0x146)]};return{'hasTimers':![]};}async[a40_0x255eb9(0x1fa)](_0x4f5117,_0x35a7bd){const _0x1300f2=a40_0x255eb9;try{const _0x45a319=await database_1[_0x1300f2(0x1ac)]['shop'][_0x1300f2(0x1c4)]({'where':{'id':_0x4f5117},'select':{'gatewaySettings':!![]}});if(!_0x45a319?.[_0x1300f2(0x1e6)])return console[_0x1300f2(0x178)](_0x1300f2(0x1e0)+_0x4f5117+_0x1300f2(0x18e)),0xa;const _0x5ef2a5=JSON[_0x1300f2(0x129)](_0x45a319['gatewaySettings']);for(const [_0x5c06b5,_0x2316de]of Object['entries'](_0x5ef2a5)){if(_0x5c06b5['toLowerCase']()===_0x35a7bd['toLowerCase']()){const _0x2a53fc=_0x2316de[_0x1300f2(0x1b3)]||0xa;return console[_0x1300f2(0x178)]('Gateway\x20'+_0x35a7bd+'\x20commission\x20for\x20shop\x20'+_0x4f5117+':\x20'+_0x2a53fc+'%'),_0x2a53fc;}}return console['log']('No\x20specific\x20commission\x20found\x20for\x20gateway\x20'+_0x35a7bd+_0x1300f2(0x1ec)+_0x4f5117+_0x1300f2(0x206)),0xa;}catch(_0x47b8b3){return console[_0x1300f2(0x1c3)](_0x1300f2(0x1c0)+_0x4f5117+_0x1300f2(0x10f)+_0x35a7bd+':',_0x47b8b3),0xa;}}}exports[a40_0x255eb9(0x19e)]=CoinToPayStatusService,exports[a40_0x255eb9(0x20e)]=new CoinToPayStatusService();function a40_0x53bb(){const _0x577b3b=['Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','\x20in\x20','coinToPayService','globalCheckInterval',':\x20type=','paymentId','\x20details:','gatewayPaymentId','\x20(age:\x20','has','EXPIRY_DAYS','timers','3256736vzdqyO','❌\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','stack','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','🪙\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','📊\x20[CHECK]\x20CoinToPay2\x20payment\x20','cointopay','COINTOPAY_ERROR','./currencyService','\x20timers\x20for\x20payment\x20','\x20\x20\x20-\x20ShopId:\x20','cointopay2','status','🪙\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','🪙\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','\x20USDT','description','floor','iban','📊\x20[HOURLY]\x20Payment\x20','logShopWebhookSent','Failed\x20to\x20send\x20shop\x20webhook:','✅\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','payment.success','checkPaymentStatus','toISOString','logShopWebhookError','🧹\x20[DEBUG]\x20Clearing\x20','paymentLinkId','expired','setDate','🪙\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','\x20not\x20enabled\x20for\x20shop\x20','\x20days\x20(created\x20before\x20','\x20commission:\x20','orderId','checkAllPendingPayments','Payment\x20older\x20than\x20','PAID','\x20status\x20is\x20','delete','\x20\x20\x20📍\x20Source:\x20','4VYxGXJ','❌\x20[CHECK]\x20Payment\x20','status_check','log','\x20\x20\x20-\x20GatewayPaymentId:\x20','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','⏰\x20[GLOBAL]\x20Payment\x20','✅\x20[HOURLY]\x20Payment\x20','\x20\x20\x20-\x20Gateway:\x20','✅\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','\x20initial\x20timers\x20for\x20payment\x20','🪙\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','includes','update','✅\x20[DEBUG]\x20Successfully\x20scheduled\x20','./gateways/coinToPay2Service','checkExpiredPayments','\x20\x20\x20❌\x20Error:\x20','message','🛑\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','settings','🪙\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','💰\x20[CHECK]\x20Payment\x20','⏰\x20[DEBUG]\x20Scheduled\x20check\x20#','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20',',\x20using\x20default\x20commission\x2010%','PENDING','🪙\x20[GLOBAL]\x20Found\x20','\x20amounts\x20calculated:','webhookUrl','\x20payment\x20','createdOn','\x20marked\x20as\x20paid\x20at:\x20',',\x20currentPayments=','gatewayCommissionRate','\x20triggered\x20for\x20payment\x20','3498pLLXtb','✅\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','gatewayOrderId','set','amountUSDT','CoinToPayStatusService','size','__esModule','📊\x20[CHECK]\x20CoinToPay\x20payment\x20','\x20days\x20without\x20payment\x20confirmation','convertToUSDT','confirmedOn','logCoinToPayError','push','CoinToPay2Service',',\x20stopping\x20individual\x20checks','bankDetails','\x20status\x20changed\x20to\x20','currentPayments','default','../types/gateway','create','gateway','sendPaymentNotification','⏰\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','✅\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','commission','schedulePaymentChecks','customerName','\x20is\x20valid\x20for\x20checking,\x20proceeding...','payment.failed','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','📈\x20[COINTOPAY]\x20Payment\x20','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','adminNotes','clearPaymentTimers','❌\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','\x20expired','1213773QDrqwK','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','420aybuQe','🧹\x20[DEBUG]\x20Cleared\x20timer\x20#','error','findUnique','shopId','❌\x20[HOURLY]\x20Payment\x20','72096WapqFg','values','\x20\x20\x20📝\x20Context:','\x20with\x20status\x20','🔍\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','1949465zByyXP','startPeriodicStatusCheck','payment','auto_expire','GLOBAL_CHECK_INTERVAL_MS','COMPLETED','SINGLE','logCoinToPayStatus','../config/database','checkSinglePaymentById','\x20(after\x20','⚠️\x20[CHECK]\x20Payment\x20','🔍\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','paymentLink','🔍\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','\x20\x20\x20-\x20gatewayPaymentId:\x20','\x20skipped,\x20','🔄\x20[CHECK]\x20Updating\x20payment\x20','sendShopWebhook','webhookLog','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','Success','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','coinToPay2Service','schedule_created','\x20has\x20no\x20gatewayPaymentId,\x20skipping','gatewaySettings','getTime','POST','toFixed',',\x20status=','🧹\x20[CHECK]\x20Payment\x20','\x20in\x20shop\x20','\x20days','checkPaymentById','\x20individual\x20payment\x20timers','❌\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','\x20->\x20','✅\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','5\x20minutes','webhookEvents','Automatically\x20expired\x20after\x20','getPaymentTimerInfo','findMany','amount','🆔\x20[CHECK]\x20Transaction\x20ID:\x20','getGatewayCommission','customerEmail','webhook_send','\x20\x20\x20Amount:\x20','\x20expired\x20CoinToPay\x20payments','cointopay_status_check_','text','transactionId','Unknown\x20error','\x20to\x20clear','🏦\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes','⏰\x20[EXPIRY]\x20Payment\x20',',\x20using\x20default\x2010%','\x20\x20\x20Gateway\x20','loggerService','174574XvJJQJ','delay','📈\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','stringify','\x20not\x20found\x20in\x20database','coinToPayStatusService','\x20days,\x20marking\x20as\x20EXPIRED','timestamp','🪙\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','paymentTimers','\x20is\x20too\x20new\x20(','🛑\x20[SHUTDOWN]\x20Cleared\x20','unknown','now','sendPaymentStatusNotification','\x20status\x20unchanged\x20(','\x20updated\x20successfully',',\x20clearing\x20individual\x20timers',',\x20gateway\x20','❌\x20[TIMER]\x20Failed\x20individual\x20check\x20#','\x20updated:\x20currentPayments=','3015lfgRWd','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','EXPIRED','forEach','📊\x20[CHECK]\x20Payment\x20','✅\x20[CHECK]\x20Payment\x20','getDate','paymentDetails','CoinToPayService','createdAt','getGatewayIdByName','getServiceStats','\x20has\x20no\x20gatewayPaymentId','.\x20Remaining\x20active\x20timers:\x20','📊\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','🔍\x20[CHECK]\x20Checking\x20','🪙\x20[DEBUG]\x20Creating\x20','\x20checked,\x20','h),\x20skipping\x20global\x20check','41022NsODjK','🪙\x20[ERROR]\x20CoinToPay\x20Error:\x20','-day\x20timeout','currency','parse','❌\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','paidAt','get','created','checkSinglePayment','\x20\x20\x20📝\x20Details:','\x20is\x20older\x20than\x20','\x20\x20\x20📅\x20Time:\x20','2\x20minutes','application/json','⚠️\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','\x20for\x20payment\x20','shop','ms)','❌\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','./gateways/coinToPayService','length','\x20\x20\x20-\x20paymentId:\x20','map','❌\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','failed'];a40_0x53bb=function(){return _0x577b3b;};return a40_0x53bb();}