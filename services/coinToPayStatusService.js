'use strict';const a52_0x78a37d=a52_0x9096;(function(_0x38962a,_0xefd5c8){const _0x52b2a7=a52_0x9096,_0x1fa719=_0x38962a();while(!![]){try{const _0x466db8=-parseInt(_0x52b2a7(0x191))/0x1*(parseInt(_0x52b2a7(0x129))/0x2)+-parseInt(_0x52b2a7(0x1f5))/0x3+parseInt(_0x52b2a7(0x17b))/0x4+-parseInt(_0x52b2a7(0x15a))/0x5*(-parseInt(_0x52b2a7(0x188))/0x6)+parseInt(_0x52b2a7(0x10c))/0x7*(-parseInt(_0x52b2a7(0x19b))/0x8)+parseInt(_0x52b2a7(0x11d))/0x9+parseInt(_0x52b2a7(0x14c))/0xa;if(_0x466db8===_0xefd5c8)break;else _0x1fa719['push'](_0x1fa719['shift']());}catch(_0x2e0662){_0x1fa719['push'](_0x1fa719['shift']());}}}(a52_0x3464,0x9352c));function a52_0x9096(_0x89b555,_0x5f71f6){_0x89b555=_0x89b555-0x10b;const _0x34641c=a52_0x3464();let _0x90960a=_0x34641c[_0x89b555];return _0x90960a;}var __importDefault=this&&this['__importDefault']||function(_0xfbcf32){return _0xfbcf32&&_0xfbcf32['__esModule']?_0xfbcf32:{'default':_0xfbcf32};};Object[a52_0x78a37d(0x1b4)](exports,a52_0x78a37d(0x13d),{'value':!![]}),exports[a52_0x78a37d(0x135)]=exports[a52_0x78a37d(0x117)]=void 0x0;const coinToPayService_1=require(a52_0x78a37d(0x142)),coinToPay2Service_1=require(a52_0x78a37d(0x21c)),gateway_1=require(a52_0x78a37d(0x14f)),database_1=__importDefault(require(a52_0x78a37d(0x1a5))),telegramBotService_1=require(a52_0x78a37d(0x1fd)),loggerService_1=require(a52_0x78a37d(0x1f2)),currencyService_1=require(a52_0x78a37d(0x10e));function a52_0x3464(){const _0x37ab8a=['\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','\x20\x20\x20-\x20Amount:\x20','getGatewayIdByName','type','CoinToPayStatusService','confirmedOn','forEach','settings','customerEmail','‚ö†Ô∏è\x20[CHECK]\x20Payment\x20','1449171JCCTfU','\x20\x20\x20-\x20Status:\x20','‚ùå\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','paidAt','createdAt','\x20has\x20no\x20gatewayPaymentId','CoinToPayService','\x20is\x20older\x20than\x20','timers','COMPLETED','cointopay2','\x20commission\x20for\x20shop\x20','1536460iRQDut','gatewayOrderId','transactionId','status','\x20->\x20','gatewaySettings','sendShopWebhook','paymentLink','checkExpiredPayments',',\x20clearing\x20individual\x20timers','‚ùå\x20[CHECK]\x20Payment\x20','\x20status\x20from\x20','coinToPayStatusService','ms)','ü™ô\x20[DEBUG]\x20Creating\x20','orderId','\x20\x20\x20‚ùå\x20Error:\x20','üìä\x20[CHECK]\x20Payment\x20','\x20status\x20is\x20','‚ùå\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','__esModule','\x20status\x20unchanged\x20(','cointopay_auto_expired','toISOString','ü™ô\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','./gateways/coinToPayService','entries','‚úÖ\x20[DEBUG]\x20Successfully\x20scheduled\x20','üîç\x20[CHECK]\x20Checking\x20','Shop\x20webhook\x20sent\x20to\x20','üõë\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','‚úÖ\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','convertToUSDT','Failed\x20to\x20mark\x20payment\x20as\x20expired','11173650HjIbrJ','Webhook\x20event\x20','commission','../types/gateway','coinToPayService','stopPeriodicStatusCheck','üí∞\x20[CHECK]\x20Payment\x20','Failed\x20to\x20send\x20shop\x20webhook:','‚úÖ\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','currencyService','sendPaymentStatusNotification','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','get','‚úÖ\x20[TIMER]\x20Individual\x20check\x20#','10vFZHjJ','getDate','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','\x20for\x20payment\x20','h),\x20skipping\x20global\x20check','\x20with\x20status\x20','expired','floor','\x20skipped,\x20','not\x20found','amountUSDT','.\x20Remaining\x20active\x20timers:\x20','payment.success','üìä\x20[HOURLY]\x20Payment\x20','webhook_send','catch',',\x20using\x20default\x20commission\x2010%','POST','‚è∞\x20[GLOBAL]\x20Found\x20','amountAfterGatewayCommissionUSDT','1\x20minute','gateway','auto_expire','shop','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','application/json','createdOn','update','\x20completed\x20for\x20payment\x20','Payment\x20not\x20found','\x20has\x20no\x20gatewayPaymentId,\x20skipping','‚ùå\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','webhookUrl','2329876xDnSpm','timestamp','\x20\x20\x20üìç\x20Source:\x20','FAILED','\x20marked\x20as\x20paid\x20at:\x20','‚è∞\x20[EXPIRY]\x20Payment\x20','EXPIRED','checkPaymentStatus','paymentId','ü™ô\x20[TIMER]\x20Individual\x20check\x20#','ü™ô\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','logShopWebhookError','PENDING','3194292vpGaWu','üîç\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','EXPIRY_DAYS','üìà\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','GLOBAL_CHECK_INTERVAL_MS','getGatewayCommission','paymentTimers','set','findUnique','1hegdDu','üÜî\x20[CHECK]\x20Transaction\x20ID:\x20','currency','\x20pending\x20CoinToPay\x20payments','\x20timers\x20for\x20payment\x20','\x20is\x20too\x20new\x20(','‚úÖ\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','\x20in\x20','5\x20minutes','checkPaymentById','5672056EMZLdM','\x20updated:\x20currentPayments=','\x20\x20\x20üìù\x20Details:','globalCheckInterval','checkSinglePayment','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','toFixed','\x20status:\x20','\x20\x20\x20üìù\x20Context:','size','../config/database','ü™ô\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','stack','webhookLog','üè¶\x20[CHECK]\x20Saved\x20IBAN:\x20','values','‚è∞\x20[DEBUG]\x20Scheduled\x20check\x20#','not\x20confirmed','üìä\x20[CHECK]\x20CoinToPay2\x20payment\x20',',\x20stopping\x20individual\x20checks','‚ùå\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','/status/','description','payment','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','defineProperty','checkAllPendingPayments','cointopay_status_check_','\x20details:','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','stringify','‚úÖ\x20[HOURLY]\x20Payment\x20','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','‚úÖ\x20[CHECK]\x20Payment\x20','telegramBotService','\x20days','üîç\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','delete','sendPaymentNotification','has','status_check','PAID','COINTOPAY_ERROR','COINTOPAY_STATUS_CHANGE','create','‚ùå\x20[HOURLY]\x20Payment\x20','\x20\x20\x20üìÖ\x20Time:\x20','checkSinglePaymentById','payment.pending','paymentLinkId','\x20USDT','parse','getPaymentTimerInfo','now','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','text','shopId','üìà\x20[COINTOPAY]\x20Payment\x20','\x20\x20\x20Gateway\x20','default','cointopay','Gateway\x20','Success','CoinToPay2Service','\x20\x20\x20-\x20Gateway:\x20','ü™ô\x20[GLOBAL]\x20Found\x20','error','findMany','‚è∞\x20[GLOBAL]\x20Payment\x20','clearPaymentTimers','startPeriodicStatusCheck','‚ùå\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','\x20initial\x20timers\x20for\x20payment\x20','‚ö†Ô∏è\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','‚è∞\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','\x20(after\x20',':\x20type=','loggerService','currentPayments','paymentDetails',',\x20gateway\x20','toLowerCase','log','webhookEvents','includes','amount','ü™ô\x20[ERROR]\x20CoinToPay\x20Error:\x20','./loggerService','\x20expired\x20CoinToPay\x20payments','\x20status\x20changed\x20to\x20','2534832PmRLQq','\x20amounts\x20calculated:','\x20in\x20shop\x20','customerName','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','‚è∞\x20[HOURLY]\x20Payment\x20','\x20checked,\x20','setDate','./telegramBotService','\x20days,\x20marking\x20as\x20EXPIRED','failed','coinToPay2Service','gatewayCommissionRate','ü™ô\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','logCoinToPayError','\x20\x20\x20-\x20GatewayPaymentId:\x20','ü™ô\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','gatewayPaymentId','\x20payment\x20','\x20days\x20(created\x20before\x20','üßπ\x20[DEBUG]\x20Cleared\x20timer\x20#','getServiceStats','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','push','paid','\x20seconds\x20(','unknown','logCoinToPayStatus','map','created','schedulePaymentChecks','iban','üßπ\x20[DEBUG]\x20Clearing\x20','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20',',\x20status=','Payment\x20older\x20than\x20',',\x20using\x20default\x2010%','getTime','ü™ô\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','./gateways/coinToPay2Service','ü™ô\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','message','‚ùå\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','7BidqhL','length','./currencyService','\x20found:','\x20not\x20enabled\x20for\x20shop\x20','payment.failed','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20'];a52_0x3464=function(){return _0x37ab8a;};return a52_0x3464();}class CoinToPayStatusService{constructor(){const _0x523afc=a52_0x78a37d;this[_0x523afc(0x19e)]=null,this[_0x523afc(0x18c)]=0x3c*0x3c*0x3e8,this[_0x523afc(0x18a)]=0x5,this['paymentTimers']=new Map(),this[_0x523afc(0x150)]=new coinToPayService_1[(_0x523afc(0x123))](),this[_0x523afc(0x200)]=new coinToPay2Service_1[(_0x523afc(0x1da))](),console['log'](_0x523afc(0x141));}[a52_0x78a37d(0x213)](_0xde0407,_0x13e95f){const _0x426e77=a52_0x78a37d;console['log']('ü™ô\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:'),console['log']('\x20\x20\x20-\x20paymentId:\x20'+_0xde0407),console[_0x426e77(0x1ed)]('\x20\x20\x20-\x20gatewayPaymentId:\x20'+_0x13e95f),this[_0x426e77(0x1e0)](_0xde0407);const _0x17954f=[],_0x11d9fa=new Date(),_0x3e4e52=[{'delay':0x1*0x3c*0x3e8,'description':_0x426e77(0x16e)},{'delay':0x2*0x3c*0x3e8,'description':'2\x20minutes'},{'delay':0x5*0x3c*0x3e8,'description':_0x426e77(0x199)},{'delay':0x5*0x3c*0x3e8,'description':'5\x20minutes'}];console['log'](_0x426e77(0x137)+_0x3e4e52[_0x426e77(0x10d)]+_0x426e77(0x1e3)+_0xde0407);let _0x29e32b=0x0;_0x3e4e52['forEach']((_0x3449d8,_0x44474d)=>{const _0x3571b8=_0x426e77;_0x29e32b+=_0x3449d8['delay'];const _0x6e7936=setTimeout(async()=>{const _0x4987a8=a52_0x9096;console[_0x4987a8(0x1ed)](_0x4987a8(0x184)+(_0x44474d+0x1)+'\x20triggered\x20for\x20payment\x20'+_0xde0407+_0x4987a8(0x1e6)+_0x3449d8[_0x4987a8(0x1b1)]+')');try{await this[_0x4987a8(0x1ca)](_0xde0407),console[_0x4987a8(0x1ed)](_0x4987a8(0x159)+(_0x44474d+0x1)+_0x4987a8(0x176)+_0xde0407);}catch(_0x12a30a){console[_0x4987a8(0x1dd)]('‚ùå\x20[TIMER]\x20Failed\x20individual\x20check\x20#'+(_0x44474d+0x1)+'\x20for\x20payment\x20'+_0xde0407+':',_0x12a30a),this['logCoinToPayError'](_0xde0407,_0x13e95f,_0x12a30a,_0x4987a8(0x1c3),{'checkNumber':_0x44474d+0x1,'scheduledAfter':_0x3449d8['description'],'isIndividualCheck':!![]});}},_0x29e32b);_0x17954f[_0x3571b8(0x20c)](_0x6e7936),console[_0x3571b8(0x1ed)](_0x3571b8(0x1ab)+(_0x44474d+0x1)+_0x3571b8(0x15d)+_0xde0407+_0x3571b8(0x198)+_0x29e32b/0x3e8+_0x3571b8(0x20e)+_0x3449d8[_0x3571b8(0x1b1)]+')');});const _0x397491=setInterval(async()=>{const _0x54a58a=_0x426e77;console[_0x54a58a(0x1ed)](_0x54a58a(0x21b)+_0xde0407);try{const _0xaf94f1=await database_1[_0x54a58a(0x1d6)][_0x54a58a(0x1b2)][_0x54a58a(0x190)]({'where':{'id':_0xde0407},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0xaf94f1){console[_0x54a58a(0x1ed)](_0x54a58a(0x1c8)+_0xde0407+'\x20not\x20found,\x20clearing\x20timers'),this['clearPaymentTimers'](_0xde0407);return;}console[_0x54a58a(0x1ed)](_0x54a58a(0x167)+_0xde0407+'\x20current\x20status:\x20'+_0xaf94f1[_0x54a58a(0x12c)]);if(_0xaf94f1['status']!==_0x54a58a(0x187)){console['log'](_0x54a58a(0x1ba)+_0xde0407+'\x20status\x20is\x20'+_0xaf94f1[_0x54a58a(0x12c)]+_0x54a58a(0x1ae)),this[_0x54a58a(0x1e0)](_0xde0407);return;}const _0x414e99=Math[_0x54a58a(0x161)]((Date[_0x54a58a(0x1d0)]()-_0xaf94f1['createdAt'][_0x54a58a(0x21a)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x414e99>=this[_0x54a58a(0x18a)]){console[_0x54a58a(0x1ed)](_0x54a58a(0x1fa)+_0xde0407+_0x54a58a(0x124)+this[_0x54a58a(0x18a)]+_0x54a58a(0x113)),this[_0x54a58a(0x1e0)](_0xde0407);return;}await this[_0x54a58a(0x1ca)](_0xde0407),console[_0x54a58a(0x1ed)](_0x54a58a(0x149)+_0xde0407);}catch(_0x2ef083){console['error'](_0x54a58a(0x11f)+_0xde0407+':',_0x2ef083),this[_0x54a58a(0x203)](_0xde0407,_0x13e95f,_0x2ef083,'status_check',{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x17954f[_0x426e77(0x20c)](_0x397491),this[_0x426e77(0x18e)][_0x426e77(0x18f)](_0xde0407,{'timers':_0x17954f,'paymentId':_0xde0407,'gatewayPaymentId':_0x13e95f,'createdAt':_0x11d9fa}),console[_0x426e77(0x1ed)](_0x426e77(0x144)+_0x3e4e52['length']+_0x426e77(0x1a0)+_0xde0407),console[_0x426e77(0x1ed)]('üìä\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20'+this['paymentTimers']['size']),this['logCoinToPayStatus'](_0xde0407,_0x13e95f,_0x426e77(0x187),_0x426e77(0x187),_0x426e77(0x1c3),{'action':'schedule_created','scheduledChecks':_0x3e4e52['length'],'firstCheckIn':_0x3e4e52[0x0]['delay']/0x3e8,'totalTimers':this[_0x426e77(0x18e)][_0x426e77(0x1a4)]});}[a52_0x78a37d(0x1e0)](_0x530bca){const _0x5776ac=a52_0x78a37d,_0x4223d3=this[_0x5776ac(0x18e)][_0x5776ac(0x158)](_0x530bca);_0x4223d3?(console['log'](_0x5776ac(0x215)+_0x4223d3[_0x5776ac(0x125)][_0x5776ac(0x10d)]+_0x5776ac(0x195)+_0x530bca),_0x4223d3[_0x5776ac(0x125)][_0x5776ac(0x119)]((_0x1f85cd,_0x16e71a)=>{const _0x4f68d1=_0x5776ac;_0x1f85cd&&(clearTimeout(_0x1f85cd),clearInterval(_0x1f85cd),console[_0x4f68d1(0x1ed)](_0x4f68d1(0x209)+(_0x16e71a+0x1)+'\x20for\x20payment\x20'+_0x530bca));}),this[_0x5776ac(0x18e)][_0x5776ac(0x1c0)](_0x530bca),console['log'](_0x5776ac(0x197)+_0x530bca+_0x5776ac(0x165)+this[_0x5776ac(0x18e)][_0x5776ac(0x1a4)])):console[_0x5776ac(0x1ed)](_0x5776ac(0x1e4)+_0x530bca+'\x20to\x20clear');}async[a52_0x78a37d(0x1ca)](_0x4c3093){const _0x5709ea=a52_0x78a37d;console[_0x5709ea(0x1ed)]('üîç\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20'+_0x4c3093);const _0x236883=await database_1[_0x5709ea(0x1d6)][_0x5709ea(0x1b2)][_0x5709ea(0x190)]({'where':{'id':_0x4c3093},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x236883){console[_0x5709ea(0x1ed)](_0x5709ea(0x133)+_0x4c3093+'\x20not\x20found\x20in\x20database');return;}console[_0x5709ea(0x1ed)](_0x5709ea(0x13a)+_0x4c3093+_0x5709ea(0x10f)),console[_0x5709ea(0x1ed)](_0x5709ea(0x1db)+_0x236883[_0x5709ea(0x16f)]),console[_0x5709ea(0x1ed)](_0x5709ea(0x11e)+_0x236883['status']),console[_0x5709ea(0x1ed)](_0x5709ea(0x204)+_0x236883['gatewayPaymentId']),console['log'](_0x5709ea(0x114)+_0x236883['amount']+'\x20'+_0x236883['currency']),console[_0x5709ea(0x1ed)]('\x20\x20\x20-\x20ShopId:\x20'+_0x236883[_0x5709ea(0x1d3)]);if(_0x236883['gateway']!==_0x5709ea(0x1d7)&&_0x236883['gateway']!=='cointopay2'){console[_0x5709ea(0x1ed)](_0x5709ea(0x11c)+_0x4c3093+_0x5709ea(0x1f9)+_0x236883['gateway']+')');return;}if(_0x236883['status']!==_0x5709ea(0x187)){console[_0x5709ea(0x1ed)](_0x5709ea(0x11c)+_0x4c3093+_0x5709ea(0x13b)+_0x236883[_0x5709ea(0x12c)]+',\x20stopping\x20individual\x20checks'),this[_0x5709ea(0x1e0)](_0x4c3093);return;}if(!_0x236883['gatewayPaymentId']){console['log'](_0x5709ea(0x11c)+_0x4c3093+_0x5709ea(0x122));return;}console[_0x5709ea(0x1ed)](_0x5709ea(0x1bc)+_0x4c3093+'\x20is\x20valid\x20for\x20checking,\x20proceeding...'),await this['checkSinglePayment'](_0x236883);}[a52_0x78a37d(0x210)](_0x32e362,_0x14bb32,_0x5729d6,_0x2f44a4,_0x616135,_0x4f9678){const _0x49367a=a52_0x78a37d,_0x56c6b1={'type':_0x49367a(0x1c6),'paymentId':_0x32e362,'gatewayPaymentId':_0x14bb32,'oldStatus':_0x5729d6,'newStatus':_0x2f44a4,'source':_0x616135,'timestamp':new Date()['toISOString'](),'details':_0x4f9678||{}};loggerService_1[_0x49367a(0x1e8)]['logCoinToPayStatus'](_0x56c6b1),console[_0x49367a(0x1ed)](_0x49367a(0x202)+_0x32e362+'\x20('+_0x14bb32+')'),console[_0x49367a(0x1ed)]('\x20\x20\x20üìä\x20Status:\x20'+_0x5729d6+_0x49367a(0x12d)+_0x2f44a4),console[_0x49367a(0x1ed)](_0x49367a(0x17d)+_0x616135),console['log'](_0x49367a(0x1c9)+_0x56c6b1[_0x49367a(0x17c)]),_0x4f9678&&console[_0x49367a(0x1ed)](_0x49367a(0x19d),_0x4f9678);}[a52_0x78a37d(0x203)](_0x4b8373,_0x58599d,_0x318385,_0x23fa69,_0x2d5eb){const _0x5731af=a52_0x78a37d,_0x1eb0c3={'type':_0x5731af(0x1c5),'paymentId':_0x4b8373,'gatewayPaymentId':_0x58599d,'error':_0x318385 instanceof Error?{'message':_0x318385[_0x5731af(0x21e)],'stack':_0x318385[_0x5731af(0x1a7)]}:_0x318385,'source':_0x23fa69,'timestamp':new Date()['toISOString'](),'context':_0x2d5eb||{}};loggerService_1['loggerService'][_0x5731af(0x203)](_0x1eb0c3),console['error'](_0x5731af(0x1f1)+_0x4b8373+'\x20('+_0x58599d+')'),console['error'](_0x5731af(0x139)+(_0x318385 instanceof Error?_0x318385[_0x5731af(0x21e)]:_0x318385)),console['error'](_0x5731af(0x17d)+_0x23fa69),console['error'](_0x5731af(0x1c9)+_0x1eb0c3[_0x5731af(0x17c)]),_0x2d5eb&&console[_0x5731af(0x1dd)](_0x5731af(0x1a3),_0x2d5eb);}[a52_0x78a37d(0x1e1)](){const _0x4c0d34=a52_0x78a37d;console['log'](_0x4c0d34(0x1a6)),this['checkAllPendingPayments']()[_0x4c0d34(0x169)](_0x4d37ea=>{const _0x4f827e=_0x4c0d34;console[_0x4f827e(0x1dd)](_0x4f827e(0x10b),_0x4d37ea);}),this[_0x4c0d34(0x19e)]=setInterval(async()=>{const _0x3acf98=_0x4c0d34;try{console['log'](_0x3acf98(0x21d)),await this[_0x3acf98(0x1b5)](),console[_0x3acf98(0x1ed)]('‚úÖ\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed');}catch(_0xb4367d){console['error'](_0x3acf98(0x1e2),_0xb4367d);}},this[_0x4c0d34(0x18c)]),console['log']('‚úÖ\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)');}[a52_0x78a37d(0x151)](){const _0x1f5fb0=a52_0x78a37d;console[_0x1f5fb0(0x1ed)](_0x1f5fb0(0x147));this[_0x1f5fb0(0x19e)]&&(clearInterval(this[_0x1f5fb0(0x19e)]),this['globalCheckInterval']=null,console[_0x1f5fb0(0x1ed)]('üõë\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped'));const _0x4925c7=this['paymentTimers']['size'];for(const [_0x92420b]of this['paymentTimers']){this[_0x1f5fb0(0x1e0)](_0x92420b);}console[_0x1f5fb0(0x1ed)]('üõë\x20[SHUTDOWN]\x20Cleared\x20'+_0x4925c7+'\x20individual\x20payment\x20timers');}async[a52_0x78a37d(0x1b5)](){const _0x12158a=a52_0x78a37d;try{console[_0x12158a(0x1ed)](_0x12158a(0x185));const _0x5b8e33=await database_1['default'][_0x12158a(0x1b2)][_0x12158a(0x1de)]({'where':{'gateway':{'in':[_0x12158a(0x1d7),'cointopay2']},'status':_0x12158a(0x187),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console['log'](_0x12158a(0x1dc)+_0x5b8e33[_0x12158a(0x10d)]+_0x12158a(0x194));if(_0x5b8e33[_0x12158a(0x10d)]===0x0){console['log'](_0x12158a(0x205));return;}const _0x130185=await this[_0x12158a(0x131)](_0x5b8e33);console[_0x12158a(0x1ed)](_0x12158a(0x16c)+_0x130185[_0x12158a(0x10d)]+_0x12158a(0x1f3));let _0x4fbce2=0x0,_0x2aba1d=0x0;for(const _0x40f613 of _0x5b8e33){try{if(_0x130185[_0x12158a(0x1ef)](_0x40f613['id'])){console[_0x12158a(0x1ed)](_0x12158a(0x1df)+_0x40f613['id']+_0x12158a(0x172)),_0x2aba1d++;continue;}if(this[_0x12158a(0x18e)][_0x12158a(0x1c2)](_0x40f613['id'])){console['log'](_0x12158a(0x1df)+_0x40f613['id']+_0x12158a(0x148)),_0x2aba1d++;continue;}const _0x59212a=(Date[_0x12158a(0x1d0)]()-_0x40f613[_0x12158a(0x121)][_0x12158a(0x21a)]())/(0x3e8*0x3c*0x3c);if(_0x59212a<0x1){console[_0x12158a(0x1ed)](_0x12158a(0x1df)+_0x40f613['id']+_0x12158a(0x196)+_0x59212a[_0x12158a(0x1a1)](0x1)+_0x12158a(0x15e)),_0x2aba1d++;continue;}console[_0x12158a(0x1ed)](_0x12158a(0x189)+_0x40f613['id']+'\x20(age:\x20'+_0x59212a[_0x12158a(0x1a1)](0x1)+'h)'),await this[_0x12158a(0x19f)](_0x40f613),_0x4fbce2++,await new Promise(_0x202133=>setTimeout(_0x202133,0x7d0));}catch(_0xfbc4a){console[_0x12158a(0x1dd)](_0x12158a(0x216)+_0x40f613['id']+':',_0xfbc4a),this['logCoinToPayError'](_0x40f613['id'],_0x40f613[_0x12158a(0x206)]||'unknown',_0xfbc4a,_0x12158a(0x1c3),{'isGlobalCheck':!![],'paymentAmount':_0x40f613[_0x12158a(0x1f0)],'paymentCurrency':_0x40f613[_0x12158a(0x193)],'shopId':_0x40f613[_0x12158a(0x1d3)],'createdAt':_0x40f613[_0x12158a(0x121)]}),loggerService_1['loggerService']['logWhiteDomainError'](_0x12158a(0x1d7),_0x12158a(0x1b0)+_0x40f613[_0x12158a(0x206)],_0xfbc4a);}}console['log'](_0x12158a(0x157)+_0x4fbce2+_0x12158a(0x1fb)+_0x2aba1d+_0x12158a(0x162)+_0x130185['length']+'\x20expired');}catch(_0x2e78bb){console[_0x12158a(0x1dd)]('‚ùå\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:',_0x2e78bb);}}async[a52_0x78a37d(0x131)](_0x43296a){const _0x114132=a52_0x78a37d,_0x33e099=[],_0x5c44d7=new Date();_0x5c44d7[_0x114132(0x1fc)](_0x5c44d7[_0x114132(0x15b)]()-this[_0x114132(0x18a)]),console['log'](_0x114132(0x1e5)+this['EXPIRY_DAYS']+_0x114132(0x208)+_0x5c44d7['toISOString']()+')');for(const _0x46c9f1 of _0x43296a){if(_0x46c9f1[_0x114132(0x121)]<_0x5c44d7){console['log'](_0x114132(0x180)+_0x46c9f1['id']+_0x114132(0x124)+this[_0x114132(0x18a)]+_0x114132(0x1fe));try{this['logCoinToPayStatus'](_0x46c9f1['id'],_0x46c9f1['gatewayPaymentId']||_0x114132(0x20f),_0x114132(0x187),_0x114132(0x181),_0x114132(0x170),{'reason':_0x114132(0x218)+this[_0x114132(0x18a)]+_0x114132(0x1be),'createdAt':_0x46c9f1[_0x114132(0x121)],'daysSinceCreation':Math[_0x114132(0x161)]((Date[_0x114132(0x1d0)]()-_0x46c9f1[_0x114132(0x121)]['getTime']())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x46c9f1[_0x114132(0x1f0)],'paymentCurrency':_0x46c9f1['currency'],'shopId':_0x46c9f1['shopId']}),await database_1[_0x114132(0x1d6)][_0x114132(0x1b2)][_0x114132(0x175)]({'where':{'id':_0x46c9f1['id']},'data':{'status':_0x114132(0x181),'updatedAt':new Date()}}),await database_1[_0x114132(0x1d6)][_0x114132(0x1a8)][_0x114132(0x1c7)]({'data':{'paymentId':_0x46c9f1['id'],'shopId':_0x46c9f1[_0x114132(0x1d3)],'event':_0x114132(0x13f),'statusCode':0xc8,'responseBody':JSON[_0x114132(0x1b9)]({'reason':_0x114132(0x218)+this[_0x114132(0x18a)]+'\x20days','createdAt':_0x46c9f1['createdAt'],'expiredAt':new Date()[_0x114132(0x140)](),'daysSinceCreation':Math['floor']((Date['now']()-_0x46c9f1[_0x114132(0x121)][_0x114132(0x21a)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this['sendShopWebhook'](_0x46c9f1,_0x114132(0x181)),await this[_0x114132(0x156)](_0x46c9f1,_0x114132(0x181)),this[_0x114132(0x1e0)](_0x46c9f1['id']),_0x33e099['push'](_0x46c9f1['id']),console[_0x114132(0x1ed)]('‚úÖ\x20[EXPIRY]\x20Payment\x20'+_0x46c9f1['id']+'\x20marked\x20as\x20EXPIRED\x20due\x20to\x20'+this['EXPIRY_DAYS']+'-day\x20timeout');}catch(_0x38d966){console[_0x114132(0x1dd)](_0x114132(0x179)+_0x46c9f1['id']+':',_0x38d966),this[_0x114132(0x203)](_0x46c9f1['id'],_0x46c9f1[_0x114132(0x206)]||_0x114132(0x20f),_0x38d966,'auto_expire',{'reason':_0x114132(0x14b),'createdAt':_0x46c9f1[_0x114132(0x121)],'daysSinceCreation':Math[_0x114132(0x161)]((Date[_0x114132(0x1d0)]()-_0x46c9f1[_0x114132(0x121)][_0x114132(0x21a)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x33e099;}async[a52_0x78a37d(0x19f)](_0x12d3cf){const _0x24f067=a52_0x78a37d;if(!_0x12d3cf[_0x24f067(0x206)]){console[_0x24f067(0x1ed)](_0x24f067(0x11c)+_0x12d3cf['id']+_0x24f067(0x178));return;}console[_0x24f067(0x1ed)](_0x24f067(0x145)+_0x12d3cf[_0x24f067(0x16f)]+_0x24f067(0x207)+_0x12d3cf['id']+'\x20('+_0x12d3cf['gatewayPaymentId']+')');try{let _0x5bba1a;_0x12d3cf[_0x24f067(0x16f)]==='cointopay2'?(_0x5bba1a=await this[_0x24f067(0x200)]['checkPaymentStatus'](_0x12d3cf[_0x24f067(0x206)]),console[_0x24f067(0x1ed)](_0x24f067(0x1ad)+_0x12d3cf['id']+'\x20status:\x20'+_0x5bba1a['status'])):(_0x5bba1a=await this[_0x24f067(0x150)][_0x24f067(0x182)](_0x12d3cf[_0x24f067(0x206)]),console['log']('üìä\x20[CHECK]\x20CoinToPay\x20payment\x20'+_0x12d3cf['id']+_0x24f067(0x1a2)+_0x5bba1a['status']));_0x5bba1a[_0x24f067(0x1ea)]&&console['log'](_0x24f067(0x13a)+_0x12d3cf['id']+_0x24f067(0x1b7),{'iban':_0x5bba1a[_0x24f067(0x1ea)][_0x24f067(0x214)]||_0x24f067(0x163),'transactionId':_0x5bba1a['paymentDetails']['transactionId'],'createdOn':_0x5bba1a[_0x24f067(0x1ea)][_0x24f067(0x174)],'confirmedOn':_0x5bba1a['paymentDetails'][_0x24f067(0x118)]||_0x24f067(0x1ac)});if(_0x5bba1a[_0x24f067(0x12c)]!==_0x12d3cf[_0x24f067(0x12c)]){console['log']('üîÑ\x20[CHECK]\x20Updating\x20payment\x20'+_0x12d3cf['id']+_0x24f067(0x134)+_0x12d3cf['status']+'\x20to\x20'+_0x5bba1a[_0x24f067(0x12c)]),this[_0x24f067(0x210)](_0x12d3cf['id'],_0x12d3cf['gatewayPaymentId'],_0x12d3cf[_0x24f067(0x12c)],_0x5bba1a['status'],_0x24f067(0x1c3),{'paymentDetails':_0x5bba1a[_0x24f067(0x1ea)],'amount':_0x5bba1a['amount'],'currency':_0x5bba1a[_0x24f067(0x193)],'shopId':_0x12d3cf[_0x24f067(0x1d3)],'checkTimestamp':new Date()[_0x24f067(0x140)]()});const _0x1a0d6b={'status':_0x5bba1a[_0x24f067(0x12c)],'updatedAt':new Date()};if(_0x5bba1a[_0x24f067(0x12c)]===_0x24f067(0x1c4)&&_0x12d3cf['status']!==_0x24f067(0x1c4)){_0x1a0d6b[_0x24f067(0x120)]=new Date();if(!_0x12d3cf[_0x24f067(0x164)]){const _0x9a13e4=await currencyService_1[_0x24f067(0x155)][_0x24f067(0x14a)](_0x12d3cf[_0x24f067(0x1f0)],_0x12d3cf[_0x24f067(0x193)]);_0x1a0d6b[_0x24f067(0x164)]=_0x9a13e4;const _0x105a4a=await this[_0x24f067(0x18d)](_0x12d3cf[_0x24f067(0x1d3)],_0x12d3cf[_0x24f067(0x16f)]),_0x5eabe2=_0x9a13e4*(0x1-_0x105a4a/0x64);_0x1a0d6b[_0x24f067(0x16d)]=_0x5eabe2,_0x1a0d6b[_0x24f067(0x201)]=_0x105a4a,console['log']('üí∞\x20[CHECK]\x20Payment\x20'+_0x12d3cf['id']+_0x24f067(0x1f6)),console[_0x24f067(0x1ed)]('\x20\x20\x20Amount:\x20'+_0x12d3cf[_0x24f067(0x1f0)]+'\x20'+_0x12d3cf['currency']+_0x24f067(0x12d)+_0x9a13e4[_0x24f067(0x1a1)](0x6)+_0x24f067(0x1cd)),console[_0x24f067(0x1ed)](_0x24f067(0x1d5)+_0x12d3cf[_0x24f067(0x16f)]+'\x20commission:\x20'+_0x105a4a+'%'),console['log']('\x20\x20\x20Amount\x20after\x20commission:\x20'+_0x5eabe2[_0x24f067(0x1a1)](0x6)+'\x20USDT');}console['log'](_0x24f067(0x152)+_0x12d3cf['id']+_0x24f067(0x17f)+_0x1a0d6b[_0x24f067(0x120)][_0x24f067(0x140)]());}if(_0x5bba1a[_0x24f067(0x1ea)]){const _0x33d681=_0x5bba1a[_0x24f067(0x1ea)];_0x33d681[_0x24f067(0x214)]&&(_0x1a0d6b['remitterIban']=_0x33d681[_0x24f067(0x214)],console['log'](_0x24f067(0x1a9)+_0x33d681[_0x24f067(0x214)])),_0x33d681['bankDetails']&&console[_0x24f067(0x1ed)]('üè¶\x20[CHECK]\x20Bank\x20details\x20provided:\x20'+_0x33d681['bankDetails']),_0x33d681[_0x24f067(0x12b)]&&console['log'](_0x24f067(0x192)+_0x33d681[_0x24f067(0x12b)]),_0x33d681[_0x24f067(0x118)]&&console[_0x24f067(0x1ed)]('‚úÖ\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20'+_0x33d681[_0x24f067(0x118)]);}await database_1[_0x24f067(0x1d6)][_0x24f067(0x1b2)]['update']({'where':{'id':_0x12d3cf['id']},'data':_0x1a0d6b});if(_0x5bba1a[_0x24f067(0x12c)]==='PAID'&&_0x12d3cf[_0x24f067(0x12c)]!==_0x24f067(0x1c4)){console['log'](_0x24f067(0x1d4)+_0x12d3cf['id']+_0x24f067(0x1b8));const _0x3ca508=await database_1[_0x24f067(0x1d6)][_0x24f067(0x1b2)]['findUnique']({'where':{'id':_0x12d3cf['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x3ca508?.[_0x24f067(0x1cc)]&&_0x3ca508[_0x24f067(0x130)])try{const _0x13c8c8=_0x3ca508[_0x24f067(0x130)];console[_0x24f067(0x1ed)](_0x24f067(0x18b)+_0x13c8c8['id']+_0x24f067(0x1e7)+_0x13c8c8[_0x24f067(0x116)]+',\x20currentPayments='+_0x13c8c8[_0x24f067(0x1e9)]+',\x20status='+_0x13c8c8[_0x24f067(0x12c)]);const _0x43030d=_0x13c8c8[_0x24f067(0x1e9)]+0x1,_0x307768=_0x13c8c8[_0x24f067(0x116)]==='SINGLE'?_0x24f067(0x126):_0x13c8c8[_0x24f067(0x12c)];await database_1[_0x24f067(0x1d6)][_0x24f067(0x130)][_0x24f067(0x175)]({'where':{'id':_0x13c8c8['id']},'data':{'currentPayments':_0x43030d,'status':_0x307768,'updatedAt':new Date()}}),console[_0x24f067(0x1ed)]('‚úÖ\x20[COINTOPAY]\x20Payment\x20link\x20'+_0x13c8c8['id']+_0x24f067(0x19c)+_0x13c8c8[_0x24f067(0x1e9)]+_0x24f067(0x12d)+_0x43030d+_0x24f067(0x217)+_0x13c8c8[_0x24f067(0x12c)]+'\x20->\x20'+_0x307768);}catch(_0x1156cf){console[_0x24f067(0x1dd)](_0x24f067(0x1af),_0x1156cf);}else console[_0x24f067(0x1ed)](_0x24f067(0x1d4)+_0x12d3cf['id']+_0x24f067(0x1b3));}await database_1[_0x24f067(0x1d6)][_0x24f067(0x1a8)][_0x24f067(0x1c7)]({'data':{'paymentId':_0x12d3cf['id'],'shopId':_0x12d3cf[_0x24f067(0x1d3)],'event':_0x24f067(0x1b6)+_0x5bba1a[_0x24f067(0x12c)][_0x24f067(0x1ec)](),'statusCode':0xc8,'responseBody':JSON['stringify']({'oldStatus':_0x12d3cf['status'],'newStatus':_0x5bba1a[_0x24f067(0x12c)],'paymentDetails':_0x5bba1a[_0x24f067(0x1ea)],'checkedAt':new Date()[_0x24f067(0x140)]()})}}),await this[_0x24f067(0x12f)](_0x12d3cf,_0x5bba1a['status']),await this['sendPaymentStatusNotification'](_0x12d3cf,_0x5bba1a[_0x24f067(0x12c)]),_0x5bba1a['status']!==_0x24f067(0x187)&&(console[_0x24f067(0x1ed)]('üßπ\x20[CHECK]\x20Payment\x20'+_0x12d3cf['id']+_0x24f067(0x1f4)+_0x5bba1a[_0x24f067(0x12c)]+_0x24f067(0x132)),this[_0x24f067(0x1e0)](_0x12d3cf['id'])),console['log'](_0x24f067(0x1bc)+_0x12d3cf['id']+'\x20updated\x20successfully');}else console[_0x24f067(0x1ed)](_0x24f067(0x13a)+_0x12d3cf['id']+_0x24f067(0x13e)+_0x5bba1a[_0x24f067(0x12c)]+')'),this[_0x24f067(0x210)](_0x12d3cf['id'],_0x12d3cf[_0x24f067(0x206)],_0x12d3cf[_0x24f067(0x12c)],_0x5bba1a[_0x24f067(0x12c)],_0x24f067(0x1c3),{'statusUnchanged':!![],'paymentDetails':_0x5bba1a[_0x24f067(0x1ea)],'amount':_0x5bba1a[_0x24f067(0x1f0)],'currency':_0x5bba1a[_0x24f067(0x193)],'shopId':_0x12d3cf['shopId'],'checkTimestamp':new Date()[_0x24f067(0x140)]()});}catch(_0xe9db8b){console[_0x24f067(0x1dd)](_0x24f067(0x13c)+_0x12d3cf['id']+':',_0xe9db8b),this[_0x24f067(0x203)](_0x12d3cf['id'],_0x12d3cf[_0x24f067(0x206)],_0xe9db8b,_0x24f067(0x1c3),{'paymentAmount':_0x12d3cf['amount'],'paymentCurrency':_0x12d3cf[_0x24f067(0x193)],'shopId':_0x12d3cf[_0x24f067(0x1d3)],'createdAt':_0x12d3cf['createdAt']}),await database_1['default'][_0x24f067(0x1a8)][_0x24f067(0x1c7)]({'data':{'paymentId':_0x12d3cf['id'],'shopId':_0x12d3cf['shopId'],'event':'cointopay_status_check_error','statusCode':0x1f4,'responseBody':JSON['stringify']({'error':_0xe9db8b instanceof Error?_0xe9db8b['message']:'Unknown\x20error','gatewayPaymentId':_0x12d3cf['gatewayPaymentId'],'checkedAt':new Date()[_0x24f067(0x140)]()})}});}}async[a52_0x78a37d(0x12f)](_0x472c6b,_0x1cf139){const _0x57e1ba=a52_0x78a37d,_0x2211e2=Date[_0x57e1ba(0x1d0)]();try{const _0x5996fb=_0x472c6b[_0x57e1ba(0x171)],_0x2aedf2=_0x5996fb[_0x57e1ba(0x11a)];if(!_0x2aedf2?.[_0x57e1ba(0x17a)]){console[_0x57e1ba(0x1ed)](_0x57e1ba(0x112)+_0x5996fb['id']);return;}const _0x475158=_0x1cf139===_0x57e1ba(0x1c4)?_0x57e1ba(0x166):_0x1cf139===_0x57e1ba(0x17e)?'payment.failed':_0x1cf139==='EXPIRED'?_0x57e1ba(0x111):_0x57e1ba(0x1cb);if(!_0x2aedf2[_0x57e1ba(0x1ee)]?.['includes'](_0x475158)){console['log'](_0x57e1ba(0x14d)+_0x475158+_0x57e1ba(0x110)+_0x5996fb['id']);return;}const _0x10b3ef=(0x0,gateway_1[_0x57e1ba(0x115)])(_0x472c6b['gateway'])||_0x472c6b[_0x57e1ba(0x16f)],_0x47c201={'event':_0x475158,'payment':{'id':_0x472c6b['id'],'order_id':_0x472c6b[_0x57e1ba(0x138)],'gateway_order_id':_0x472c6b[_0x57e1ba(0x12a)],'gateway':_0x10b3ef,'amount':_0x472c6b[_0x57e1ba(0x1f0)],'currency':_0x472c6b['currency'],'status':_0x1cf139[_0x57e1ba(0x1ec)](),'customer_email':_0x472c6b[_0x57e1ba(0x11b)],'customer_name':_0x472c6b[_0x57e1ba(0x1f8)],'created_at':_0x472c6b[_0x57e1ba(0x121)],'updated_at':new Date()}},_0x1d15a0=await fetch(_0x2aedf2[_0x57e1ba(0x17a)],{'method':_0x57e1ba(0x16b),'headers':{'Content-Type':_0x57e1ba(0x173),'User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x57e1ba(0x1b9)](_0x47c201)}),_0x36bcb1=Date[_0x57e1ba(0x1d0)]()-_0x2211e2,_0x419368=_0x1d15a0['ok']?_0x57e1ba(0x1d9):await _0x1d15a0[_0x57e1ba(0x1d2)]();loggerService_1[_0x57e1ba(0x1e8)]['logShopWebhookSent'](_0x472c6b['shopId'],_0x2aedf2['webhookUrl'],_0x475158,_0x1d15a0[_0x57e1ba(0x12c)],_0x36bcb1,_0x47c201),console[_0x57e1ba(0x1ed)](_0x57e1ba(0x146)+_0x2aedf2[_0x57e1ba(0x17a)]+_0x57e1ba(0x15f)+_0x1d15a0[_0x57e1ba(0x12c)]+'\x20('+_0x36bcb1+_0x57e1ba(0x136));}catch(_0x113dfa){console[_0x57e1ba(0x1dd)](_0x57e1ba(0x153),_0x113dfa),loggerService_1[_0x57e1ba(0x1e8)][_0x57e1ba(0x186)](_0x472c6b[_0x57e1ba(0x1d3)],_0x472c6b[_0x57e1ba(0x171)]?.[_0x57e1ba(0x11a)]?.[_0x57e1ba(0x17a)]||_0x57e1ba(0x20f),_0x57e1ba(0x168),_0x113dfa,{});}}async[a52_0x78a37d(0x156)](_0x4054a6,_0x29529d){const _0x10610e=a52_0x78a37d;try{const _0x156097={'PENDING':_0x10610e(0x212),'PAID':_0x10610e(0x20d),'FAILED':_0x10610e(0x1ff),'EXPIRED':_0x10610e(0x160)},_0x1c9a91=_0x156097[_0x29529d];if(!_0x1c9a91||_0x1c9a91===_0x10610e(0x212))return;await telegramBotService_1[_0x10610e(0x1bd)][_0x10610e(0x1c1)](_0x4054a6[_0x10610e(0x1d3)],_0x4054a6,_0x1c9a91);}catch(_0x5de2aa){console[_0x10610e(0x1dd)](_0x10610e(0x1d1),_0x5de2aa);}}async[a52_0x78a37d(0x19a)](_0x32b9c0){const _0x286cb1=a52_0x78a37d;console['log'](_0x286cb1(0x1bf)+_0x32b9c0);const _0xb5981d=await database_1['default'][_0x286cb1(0x1b2)][_0x286cb1(0x190)]({'where':{'id':_0x32b9c0},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0xb5981d)throw new Error(_0x286cb1(0x177));if(_0xb5981d['gateway']!==_0x286cb1(0x1d7)&&_0xb5981d[_0x286cb1(0x16f)]!==_0x286cb1(0x127))throw new Error(_0x286cb1(0x1bb));console[_0x286cb1(0x1ed)](_0x286cb1(0x154)+_0xb5981d['gateway']+_0x286cb1(0x207)+_0x32b9c0),await this['checkSinglePayment'](_0xb5981d),console['log']('‚úÖ\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20'+_0x32b9c0);}[a52_0x78a37d(0x20a)](){const _0x5cf6b0=a52_0x78a37d,_0x3ee46c=this[_0x5cf6b0(0x19e)]?this[_0x5cf6b0(0x18c)]:undefined,_0x5dbe3f=Array['from'](this[_0x5cf6b0(0x18e)][_0x5cf6b0(0x1aa)]())[_0x5cf6b0(0x211)](_0x4ba771=>({'paymentId':_0x4ba771[_0x5cf6b0(0x183)],'gatewayPaymentId':_0x4ba771['gatewayPaymentId'],'createdAt':_0x4ba771[_0x5cf6b0(0x121)],'timersCount':_0x4ba771['timers'][_0x5cf6b0(0x10d)]}));return{'isActive':!!this[_0x5cf6b0(0x19e)],'globalCheckIntervalMinutes':this[_0x5cf6b0(0x18c)]/(0x3e8*0x3c),'expiryDays':this[_0x5cf6b0(0x18a)],'activeIndividualTimers':this[_0x5cf6b0(0x18e)][_0x5cf6b0(0x1a4)],'nextGlobalCheckIn':_0x3ee46c,'paymentTimersDetails':_0x5dbe3f};}[a52_0x78a37d(0x1cf)](_0x366cfc){const _0x55f77a=a52_0x78a37d,_0x33793e=this[_0x55f77a(0x18e)][_0x55f77a(0x158)](_0x366cfc);if(_0x33793e)return{'hasTimers':!![],'timersCount':_0x33793e['timers'][_0x55f77a(0x10d)],'createdAt':_0x33793e['createdAt'],'gatewayPaymentId':_0x33793e['gatewayPaymentId']};return{'hasTimers':![]};}async['getGatewayCommission'](_0x20229a,_0x5b7f8f){const _0x356666=a52_0x78a37d;try{const _0x5d6e65=await database_1[_0x356666(0x1d6)]['shop'][_0x356666(0x190)]({'where':{'id':_0x20229a},'select':{'gatewaySettings':!![]}});if(!_0x5d6e65?.[_0x356666(0x12e)])return console[_0x356666(0x1ed)](_0x356666(0x15c)+_0x20229a+_0x356666(0x16a)),0xa;const _0x2e7347=JSON[_0x356666(0x1ce)](_0x5d6e65[_0x356666(0x12e)]);for(const [_0x2cb993,_0x596beb]of Object[_0x356666(0x143)](_0x2e7347)){if(_0x2cb993['toLowerCase']()===_0x5b7f8f[_0x356666(0x1ec)]()){const _0x46f8e7=_0x596beb[_0x356666(0x14e)]||0xa;return console[_0x356666(0x1ed)](_0x356666(0x1d8)+_0x5b7f8f+_0x356666(0x128)+_0x20229a+':\x20'+_0x46f8e7+'%'),_0x46f8e7;}}return console[_0x356666(0x1ed)]('No\x20specific\x20commission\x20found\x20for\x20gateway\x20'+_0x5b7f8f+_0x356666(0x1f7)+_0x20229a+_0x356666(0x219)),0xa;}catch(_0x36893e){return console[_0x356666(0x1dd)](_0x356666(0x20b)+_0x20229a+_0x356666(0x1eb)+_0x5b7f8f+':',_0x36893e),0xa;}}}exports['CoinToPayStatusService']=CoinToPayStatusService,exports[a52_0x78a37d(0x135)]=new CoinToPayStatusService();