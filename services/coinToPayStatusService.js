'use strict';const a37_0x1254f2=a37_0x4389;(function(_0x3f4442,_0x40cb84){const _0xa06228=a37_0x4389,_0x3fd0fc=_0x3f4442();while(!![]){try{const _0x9ece41=-parseInt(_0xa06228(0x20f))/0x1*(parseInt(_0xa06228(0x2a2))/0x2)+-parseInt(_0xa06228(0x26d))/0x3+-parseInt(_0xa06228(0x28c))/0x4+-parseInt(_0xa06228(0x28a))/0x5*(-parseInt(_0xa06228(0x217))/0x6)+-parseInt(_0xa06228(0x1f0))/0x7*(-parseInt(_0xa06228(0x28d))/0x8)+-parseInt(_0xa06228(0x1e1))/0x9*(-parseInt(_0xa06228(0x2d1))/0xa)+parseInt(_0xa06228(0x25d))/0xb*(parseInt(_0xa06228(0x1e4))/0xc);if(_0x9ece41===_0x40cb84)break;else _0x3fd0fc['push'](_0x3fd0fc['shift']());}catch(_0xe7d2aa){_0x3fd0fc['push'](_0x3fd0fc['shift']());}}}(a37_0x315b,0x7b835));function a37_0x4389(_0x477a4d,_0x1eb3f5){const _0x315b96=a37_0x315b();return a37_0x4389=function(_0x4389f9,_0x54dac9){_0x4389f9=_0x4389f9-0x1dd;let _0x27a381=_0x315b96[_0x4389f9];return _0x27a381;},a37_0x4389(_0x477a4d,_0x1eb3f5);}var __createBinding=this&&this['__createBinding']||(Object[a37_0x1254f2(0x239)]?function(_0x2d247c,_0x4e5a81,_0x50dff0,_0x4d832f){const _0x4e3e36=a37_0x1254f2;if(_0x4d832f===undefined)_0x4d832f=_0x50dff0;var _0x402321=Object[_0x4e3e36(0x1e9)](_0x4e5a81,_0x50dff0);(!_0x402321||('get'in _0x402321?!_0x4e5a81[_0x4e3e36(0x1eb)]:_0x402321[_0x4e3e36(0x292)]||_0x402321[_0x4e3e36(0x1f3)]))&&(_0x402321={'enumerable':!![],'get':function(){return _0x4e5a81[_0x50dff0];}}),Object[_0x4e3e36(0x214)](_0x2d247c,_0x4d832f,_0x402321);}:function(_0xc8c173,_0x5728fe,_0x1107cd,_0x27e5f7){if(_0x27e5f7===undefined)_0x27e5f7=_0x1107cd;_0xc8c173[_0x27e5f7]=_0x5728fe[_0x1107cd];}),__setModuleDefault=this&&this[a37_0x1254f2(0x202)]||(Object[a37_0x1254f2(0x239)]?function(_0x544c91,_0x4d9f31){const _0xce4389=a37_0x1254f2;Object[_0xce4389(0x214)](_0x544c91,_0xce4389(0x20d),{'enumerable':!![],'value':_0x4d9f31});}:function(_0x4d9ef7,_0x2b22a2){const _0x36e66a=a37_0x1254f2;_0x4d9ef7[_0x36e66a(0x20d)]=_0x2b22a2;}),__importStar=this&&this[a37_0x1254f2(0x21f)]||(function(){var _0x432030=function(_0x325559){const _0x40a751=a37_0x4389;return _0x432030=Object[_0x40a751(0x295)]||function(_0x435650){const _0x30b689=_0x40a751;var _0x502b38=[];for(var _0x40c1b9 in _0x435650)if(Object[_0x30b689(0x21e)][_0x30b689(0x218)][_0x30b689(0x22d)](_0x435650,_0x40c1b9))_0x502b38[_0x502b38[_0x30b689(0x227)]]=_0x40c1b9;return _0x502b38;},_0x432030(_0x325559);};return function(_0x1fb4fb){const _0x541832=a37_0x4389;if(_0x1fb4fb&&_0x1fb4fb[_0x541832(0x1eb)])return _0x1fb4fb;var _0x27014d={};if(_0x1fb4fb!=null){for(var _0x45dcc4=_0x432030(_0x1fb4fb),_0x207f52=0x0;_0x207f52<_0x45dcc4[_0x541832(0x227)];_0x207f52++)if(_0x45dcc4[_0x207f52]!==_0x541832(0x20d))__createBinding(_0x27014d,_0x1fb4fb,_0x45dcc4[_0x207f52]);}return __setModuleDefault(_0x27014d,_0x1fb4fb),_0x27014d;};}()),__importDefault=this&&this['__importDefault']||function(_0x27c0e6){const _0x4789c8=a37_0x1254f2;return _0x27c0e6&&_0x27c0e6[_0x4789c8(0x1eb)]?_0x27c0e6:{'default':_0x27c0e6};};Object['defineProperty'](exports,a37_0x1254f2(0x1eb),{'value':!![]}),exports[a37_0x1254f2(0x1e8)]=exports[a37_0x1254f2(0x25a)]=void 0x0;function a37_0x315b(){const _0x528091=['checkAllPendingPayments','❌\x20[HOURLY]\x20Payment\x20','✅\x20[CHECK]\x20Payment\x20','map','Shop\x20webhook\x20sent\x20to\x20','./loggerService','\x20status\x20is\x20','cointopay_status_check_error','confirmedOn','\x20\x20\x20📍\x20Source:\x20','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','\x20\x20\x20-\x20ShopId:\x20','\x20for\x20payment\x20','📊\x20[CHECK]\x20Payment\x20','\x20\x20\x20-\x20Amount:\x20','\x20status\x20changed\x20to\x20','✅\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','📈\x20[CHECK]\x20Payment\x20link\x20counter\x20updated\x20for\x20payment\x20','⚠️\x20[CHECK]\x20Payment\x20','set','not\x20found','✅\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','clearPaymentTimers','payment.success','\x20triggered\x20for\x20payment\x20','amount','toLowerCase','35MwqiMP','checkSinglePayment','1699708RMXdvF','24NsAthC','delete','paymentDetails','\x20days,\x20marking\x20as\x20EXPIRED','createdOn','writable','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','🪙\x20[GLOBAL]\x20Found\x20','getOwnPropertyNames','CoinToPayService','update','-day\x20timeout','🪙\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','./paymentLinkService','toISOString','logCoinToPayStatus','stringify','Success','FAILED','sendShopWebhook','log','4jYXpjn','🪙\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','\x20pending\x20CoinToPay\x20payments','🛑\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','\x20checked,\x20','cointopay_status_check_','startPeriodicStatusCheck','\x20seconds\x20(','\x20status\x20from\x20','has','\x20individual\x20payment\x20timers','webhookUrl','GLOBAL_CHECK_INTERVAL_MS','getTime','now','customerName','❌\x20[CHECK]\x20Failed\x20to\x20update\x20payment\x20link\x20counter\x20for\x20payment\x20','error','checkSinglePaymentById','\x20(after\x20','🛑\x20[SHUTDOWN]\x20Cleared\x20','\x20details:','coinToPayService','includes','⏰\x20[HOURLY]\x20Payment\x20','🧹\x20[CHECK]\x20Payment\x20','getPaymentTimerInfo','💰\x20[CHECK]\x20Payment\x20','\x20\x20\x20📅\x20Time:\x20','orderId','created','currency','\x20\x20\x20📝\x20Details:','gateway','cointopay','PAID','\x20days\x20(created\x20before\x20','handleSuccessfulPayment','logShopWebhookError','schedulePaymentChecks','webhook_send','\x20current\x20status:\x20','❌\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','❌\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','/status/','🪙\x20CoinToPayStatusService\x20initialized','shopId','1550WuswCl','\x20\x20\x20-\x20GatewayPaymentId:\x20','description','shop','Automatically\x20expired\x20after\x20','\x20not\x20found,\x20clearing\x20timers','✅\x20[DEBUG]\x20Successfully\x20scheduled\x20','paymentId','EXPIRY_DAYS','🪙\x20[ERROR]\x20CoinToPay\x20Error:\x20','logCoinToPayError','🪙\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','createdAt','get','Unknown\x20error','failed','17559FbVcFt','\x20expired','✅\x20[TIMER]\x20Individual\x20check\x20#','18204zYMqZs','🛑\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','checkExpiredPayments','❌\x20[TIMER]\x20Failed\x20individual\x20check\x20#','coinToPayStatusService','getOwnPropertyDescriptor','⏰\x20[GLOBAL]\x20Payment\x20','__esModule','\x20not\x20enabled\x20for\x20shop\x20','delay','sendPaymentStatusNotification','push','1440229tdjzYB','\x20to\x20clear','\x20has\x20no\x20gatewayPaymentId,\x20skipping','configurable','text','✅\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20CoinToPay\x20payment\x20','\x20is\x20not\x20a\x20CoinToPay\x20payment\x20(gateway:\x20','timestamp','\x20days','globalCheckInterval','\x20expired\x20CoinToPay\x20payments','\x20skipped,\x20','sendPaymentNotification','status','resolve','\x20(age:\x20','toFixed','🏦\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes','__setModuleDefault','2\x20minutes','\x20status\x20unchanged\x20(',',\x20clearing\x20individual\x20timers','values','Payment\x20older\x20than\x20','5\x20minutes','forEach','🔄\x20[CHECK]\x20Updating\x20payment\x20','✅\x20[HOURLY]\x20Payment\x20','floor','default','\x20\x20\x20❌\x20Error:\x20','305714NSrEdk','payment.failed','❌\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','\x20is\x20too\x20new\x20(','h),\x20skipping\x20global\x20check','defineProperty','payment.pending','telegramBotService','344472xDDvPJ','hasOwnProperty','findUnique','\x20\x20\x20-\x20Status:\x20','adminNotes','not\x20confirmed','Bank\x20Details:\x20','prototype','__importStar','\x20\x20\x20📊\x20Status:\x20','📊\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','🪙\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','.\x20Remaining\x20active\x20timers:\x20','\x20marked\x20as\x20paid\x20at:\x20','✅\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','\x20initial\x20timers\x20for\x20payment\x20','length','⏰\x20[GLOBAL]\x20Found\x20','1\x20minute','expired','TesSoft\x20Payment\x20System/1.0','\x20\x20\x20-\x20gatewayPaymentId:\x20','call','paymentTimers','\x20not\x20found\x20in\x20database','COINTOPAY_STATUS_CHANGE','schedule_created','\x20\x20\x20-\x20Gateway:\x20','⏰\x20[EXPIRY]\x20Payment\x20','message','❌\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','stopPeriodicStatusCheck','webhookLog','🏦\x20[CHECK]\x20Saved\x20IBAN:\x20','create','unknown','❌\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','iban','transactionId','catch','auto_expire','\x20is\x20valid\x20for\x20checking,\x20proceeding...','timers','\x20has\x20no\x20gatewayPaymentId','Webhook\x20event\x20','⏰\x20[DEBUG]\x20Scheduled\x20check\x20#','PENDING','status_check','🪙\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','then','✅\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','\x20updated\x20successfully','0100','🪙\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','EXPIRED','loggerService','\x20in\x20','application/json','🪙\x20[DEBUG]\x20Creating\x20','\x20completed\x20for\x20payment\x20','Failed\x20to\x20send\x20shop\x20webhook:','paid','🪙\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','cointopay_auto_expired','🔍\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','customerEmail','gatewayPaymentId','CoinToPayStatusService','setDate','📊\x20[HOURLY]\x20Payment\x20','6589zefbRK','Payment\x20not\x20found','bankDetails','🪙\x20[TIMER]\x20Individual\x20check\x20#','gatewayOrderId','❌\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:',',\x20stopping\x20individual\x20checks','\x20found:','\x20is\x20older\x20than\x20','\x20->\x20','size','getServiceStats','settings','\x20to\x20','POST','⏰\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','2063847SOaxiN','payment'];a37_0x315b=function(){return _0x528091;};return a37_0x315b();}const coinToPayService_1=require('./gateways/coinToPayService'),database_1=__importDefault(require('../config/database')),telegramBotService_1=require('./telegramBotService'),loggerService_1=require(a37_0x1254f2(0x274));class CoinToPayStatusService{constructor(){const _0x3cf398=a37_0x1254f2;this[_0x3cf398(0x1f9)]=null,this[_0x3cf398(0x2ae)]=0x3c*0x3c*0x3e8,this[_0x3cf398(0x2d9)]=0x5,this[_0x3cf398(0x22e)]=new Map(),this[_0x3cf398(0x2b8)]=new coinToPayService_1[(_0x3cf398(0x296))](),console[_0x3cf398(0x2a1)](_0x3cf398(0x2cf));}[a37_0x1254f2(0x2c9)](_0x12ea6b,_0x337cd2){const _0x293602=a37_0x1254f2;console['log'](_0x293602(0x247)),console[_0x293602(0x2a1)]('\x20\x20\x20-\x20paymentId:\x20'+_0x12ea6b),console['log'](_0x293602(0x22c)+_0x337cd2),this[_0x293602(0x285)](_0x12ea6b);const _0x16edcf=[],_0x1d6e6f=new Date(),_0x220660=[{'delay':0x1*0x3c*0x3e8,'description':_0x293602(0x229)},{'delay':0x2*0x3c*0x3e8,'description':_0x293602(0x203)},{'delay':0x5*0x3c*0x3e8,'description':'5\x20minutes'},{'delay':0x5*0x3c*0x3e8,'description':_0x293602(0x208)}];console['log'](_0x293602(0x251)+_0x220660[_0x293602(0x227)]+_0x293602(0x226)+_0x12ea6b);let _0x552f18=0x0;_0x220660[_0x293602(0x209)]((_0x53992c,_0x411887)=>{const _0x1d8e63=_0x293602;_0x552f18+=_0x53992c[_0x1d8e63(0x1ed)];const _0x239a12=setTimeout(async()=>{const _0x4bc411=_0x1d8e63;console[_0x4bc411(0x2a1)](_0x4bc411(0x260)+(_0x411887+0x1)+_0x4bc411(0x287)+_0x12ea6b+_0x4bc411(0x2b5)+_0x53992c['description']+')');try{await this[_0x4bc411(0x2b4)](_0x12ea6b),console[_0x4bc411(0x2a1)](_0x4bc411(0x1e3)+(_0x411887+0x1)+_0x4bc411(0x252)+_0x12ea6b);}catch(_0x53d55d){console[_0x4bc411(0x2b3)](_0x4bc411(0x1e7)+(_0x411887+0x1)+_0x4bc411(0x27b)+_0x12ea6b+':',_0x53d55d),this[_0x4bc411(0x2db)](_0x12ea6b,_0x337cd2,_0x53d55d,_0x4bc411(0x246),{'checkNumber':_0x411887+0x1,'scheduledAfter':_0x53992c['description'],'isIndividualCheck':!![]});}},_0x552f18);_0x16edcf[_0x1d8e63(0x1ef)](_0x239a12),console[_0x1d8e63(0x2a1)](_0x1d8e63(0x244)+(_0x411887+0x1)+_0x1d8e63(0x27b)+_0x12ea6b+_0x1d8e63(0x24f)+_0x552f18/0x3e8+_0x1d8e63(0x2a9)+_0x53992c[_0x1d8e63(0x2d3)]+')');});const _0x8a9bca=setInterval(async()=>{const _0x414823=_0x293602;console[_0x414823(0x2a1)](_0x414823(0x2dc)+_0x12ea6b);try{const _0x39c70c=await database_1[_0x414823(0x20d)][_0x414823(0x26e)][_0x414823(0x219)]({'where':{'id':_0x12ea6b},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x39c70c){console[_0x414823(0x2a1)](_0x414823(0x270)+_0x12ea6b+_0x414823(0x2d6)),this[_0x414823(0x285)](_0x12ea6b);return;}console[_0x414823(0x2a1)](_0x414823(0x25c)+_0x12ea6b+_0x414823(0x2cb)+_0x39c70c['status']);if(_0x39c70c[_0x414823(0x1fd)]!==_0x414823(0x245)){console['log'](_0x414823(0x20b)+_0x12ea6b+_0x414823(0x275)+_0x39c70c[_0x414823(0x1fd)]+_0x414823(0x263)),this[_0x414823(0x285)](_0x12ea6b);return;}const _0xd10a59=Math[_0x414823(0x20c)]((Date[_0x414823(0x2b0)]()-_0x39c70c['createdAt'][_0x414823(0x2af)]())/(0x3e8*0x3c*0x3c*0x18));if(_0xd10a59>=this['EXPIRY_DAYS']){console[_0x414823(0x2a1)](_0x414823(0x2ba)+_0x12ea6b+_0x414823(0x265)+this[_0x414823(0x2d9)]+_0x414823(0x293)),this['clearPaymentTimers'](_0x12ea6b);return;}await this[_0x414823(0x2b4)](_0x12ea6b),console[_0x414823(0x2a1)](_0x414823(0x249)+_0x12ea6b);}catch(_0x1fa101){console[_0x414823(0x2b3)](_0x414823(0x23b)+_0x12ea6b+':',_0x1fa101),this[_0x414823(0x2db)](_0x12ea6b,_0x337cd2,_0x1fa101,'status_check',{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x16edcf[_0x293602(0x1ef)](_0x8a9bca),this['paymentTimers'][_0x293602(0x282)](_0x12ea6b,{'timers':_0x16edcf,'paymentId':_0x12ea6b,'gatewayPaymentId':_0x337cd2,'createdAt':_0x1d6e6f}),console[_0x293602(0x2a1)](_0x293602(0x2d7)+_0x220660[_0x293602(0x227)]+'\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20'+_0x12ea6b),console[_0x293602(0x2a1)](_0x293602(0x221)+this[_0x293602(0x22e)][_0x293602(0x267)]),this['logCoinToPayStatus'](_0x12ea6b,_0x337cd2,'PENDING','PENDING',_0x293602(0x246),{'action':_0x293602(0x231),'scheduledChecks':_0x220660[_0x293602(0x227)],'firstCheckIn':_0x220660[0x0][_0x293602(0x1ed)]/0x3e8,'totalTimers':this[_0x293602(0x22e)][_0x293602(0x267)]});}['clearPaymentTimers'](_0x81665e){const _0x1000d8=a37_0x1254f2,_0x2b92f7=this[_0x1000d8(0x22e)][_0x1000d8(0x1de)](_0x81665e);_0x2b92f7?(console[_0x1000d8(0x2a1)]('🧹\x20[DEBUG]\x20Clearing\x20'+_0x2b92f7['timers'][_0x1000d8(0x227)]+'\x20timers\x20for\x20payment\x20'+_0x81665e),_0x2b92f7[_0x1000d8(0x241)][_0x1000d8(0x209)]((_0x98743,_0x3b6495)=>{const _0x44746a=_0x1000d8;_0x98743&&(clearTimeout(_0x98743),clearInterval(_0x98743),console['log']('🧹\x20[DEBUG]\x20Cleared\x20timer\x20#'+(_0x3b6495+0x1)+_0x44746a(0x27b)+_0x81665e));}),this['paymentTimers'][_0x1000d8(0x28e)](_0x81665e),console[_0x1000d8(0x2a1)]('✅\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20'+_0x81665e+_0x1000d8(0x223)+this[_0x1000d8(0x22e)]['size'])):console['log']('⚠️\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20'+_0x81665e+_0x1000d8(0x1f1));}async[a37_0x1254f2(0x2b4)](_0x57fcdb){const _0x46a75c=a37_0x1254f2;console[_0x46a75c(0x2a1)]('🔍\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20'+_0x57fcdb);const _0x333799=await database_1[_0x46a75c(0x20d)]['payment']['findUnique']({'where':{'id':_0x57fcdb},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x333799){console[_0x46a75c(0x2a1)]('❌\x20[CHECK]\x20Payment\x20'+_0x57fcdb+_0x46a75c(0x22f));return;}console[_0x46a75c(0x2a1)](_0x46a75c(0x27c)+_0x57fcdb+_0x46a75c(0x264)),console[_0x46a75c(0x2a1)](_0x46a75c(0x232)+_0x333799[_0x46a75c(0x2c3)]),console['log'](_0x46a75c(0x21a)+_0x333799[_0x46a75c(0x1fd)]),console[_0x46a75c(0x2a1)](_0x46a75c(0x2d2)+_0x333799[_0x46a75c(0x259)]),console[_0x46a75c(0x2a1)](_0x46a75c(0x27d)+_0x333799[_0x46a75c(0x288)]+'\x20'+_0x333799['currency']),console[_0x46a75c(0x2a1)](_0x46a75c(0x27a)+_0x333799['shopId']);if(_0x333799[_0x46a75c(0x2c3)]!==_0x46a75c(0x2c4)){console[_0x46a75c(0x2a1)](_0x46a75c(0x281)+_0x57fcdb+_0x46a75c(0x1f6)+_0x333799[_0x46a75c(0x2c3)]+')');return;}if(_0x333799[_0x46a75c(0x1fd)]!=='PENDING'){console[_0x46a75c(0x2a1)](_0x46a75c(0x281)+_0x57fcdb+_0x46a75c(0x275)+_0x333799[_0x46a75c(0x1fd)]+_0x46a75c(0x263)),this[_0x46a75c(0x285)](_0x57fcdb);return;}if(!_0x333799[_0x46a75c(0x259)]){console['log']('⚠️\x20[CHECK]\x20Payment\x20'+_0x57fcdb+_0x46a75c(0x242));return;}console['log'](_0x46a75c(0x271)+_0x57fcdb+_0x46a75c(0x240)),await this[_0x46a75c(0x28b)](_0x333799);}[a37_0x1254f2(0x29c)](_0x2b523b,_0x8dba8b,_0x580fdb,_0x287144,_0x4f0b01,_0x2d248e){const _0x57bd44=a37_0x1254f2,_0x3a821c={'type':_0x57bd44(0x230),'paymentId':_0x2b523b,'gatewayPaymentId':_0x8dba8b,'oldStatus':_0x580fdb,'newStatus':_0x287144,'source':_0x4f0b01,'timestamp':new Date()[_0x57bd44(0x29b)](),'details':_0x2d248e||{}};loggerService_1[_0x57bd44(0x24e)][_0x57bd44(0x29c)](_0x3a821c),console[_0x57bd44(0x2a1)](_0x57bd44(0x222)+_0x2b523b+'\x20('+_0x8dba8b+')'),console['log'](_0x57bd44(0x220)+_0x580fdb+_0x57bd44(0x266)+_0x287144),console[_0x57bd44(0x2a1)](_0x57bd44(0x278)+_0x4f0b01),console[_0x57bd44(0x2a1)](_0x57bd44(0x2be)+_0x3a821c[_0x57bd44(0x1f7)]),_0x2d248e&&console['log'](_0x57bd44(0x2c2),_0x2d248e);}['logCoinToPayError'](_0x206d91,_0x54247a,_0x3c199d,_0x461419,_0x4507d3){const _0x1371d8=a37_0x1254f2,_0x5e1318={'type':'COINTOPAY_ERROR','paymentId':_0x206d91,'gatewayPaymentId':_0x54247a,'error':_0x3c199d instanceof Error?{'message':_0x3c199d[_0x1371d8(0x234)],'stack':_0x3c199d['stack']}:_0x3c199d,'source':_0x461419,'timestamp':new Date()[_0x1371d8(0x29b)](),'context':_0x4507d3||{}};loggerService_1[_0x1371d8(0x24e)][_0x1371d8(0x2db)](_0x5e1318),console[_0x1371d8(0x2b3)](_0x1371d8(0x2da)+_0x206d91+'\x20('+_0x54247a+')'),console[_0x1371d8(0x2b3)](_0x1371d8(0x20e)+(_0x3c199d instanceof Error?_0x3c199d[_0x1371d8(0x234)]:_0x3c199d)),console[_0x1371d8(0x2b3)](_0x1371d8(0x278)+_0x461419),console[_0x1371d8(0x2b3)](_0x1371d8(0x2be)+_0x5e1318[_0x1371d8(0x1f7)]),_0x4507d3&&console[_0x1371d8(0x2b3)]('\x20\x20\x20📝\x20Context:',_0x4507d3);}[a37_0x1254f2(0x2a8)](){const _0x16fbf1=a37_0x1254f2;console[_0x16fbf1(0x2a1)](_0x16fbf1(0x255)),this['checkAllPendingPayments']()[_0x16fbf1(0x23e)](_0x203711=>{const _0x4188e9=_0x16fbf1;console[_0x4188e9(0x2b3)]('❌\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:',_0x203711);}),this[_0x16fbf1(0x1f9)]=setInterval(async()=>{const _0x32b9f7=_0x16fbf1;try{console['log'](_0x32b9f7(0x299)),await this[_0x32b9f7(0x26f)](),console[_0x32b9f7(0x2a1)](_0x32b9f7(0x27f));}catch(_0x3eb4f2){console['error'](_0x32b9f7(0x211),_0x3eb4f2);}},this[_0x16fbf1(0x2ae)]),console[_0x16fbf1(0x2a1)](_0x16fbf1(0x284));}[a37_0x1254f2(0x236)](){const _0x1296c0=a37_0x1254f2;console[_0x1296c0(0x2a1)](_0x1296c0(0x2a5));this[_0x1296c0(0x1f9)]&&(clearInterval(this['globalCheckInterval']),this[_0x1296c0(0x1f9)]=null,console[_0x1296c0(0x2a1)](_0x1296c0(0x1e5)));const _0x490e6e=this['paymentTimers'][_0x1296c0(0x267)];for(const [_0x13bbad]of this[_0x1296c0(0x22e)]){this[_0x1296c0(0x285)](_0x13bbad);}console[_0x1296c0(0x2a1)](_0x1296c0(0x2b6)+_0x490e6e+_0x1296c0(0x2ac));}async[a37_0x1254f2(0x26f)](){const _0x57815b=a37_0x1254f2;try{console[_0x57815b(0x2a1)](_0x57815b(0x2a3));const _0x1397a6=await database_1[_0x57815b(0x20d)][_0x57815b(0x26e)]['findMany']({'where':{'gateway':_0x57815b(0x2c4),'status':'PENDING','gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x57815b(0x2a1)](_0x57815b(0x294)+_0x1397a6[_0x57815b(0x227)]+_0x57815b(0x2a4));if(_0x1397a6['length']===0x0){console['log'](_0x57815b(0x24c));return;}const _0xa1f20=await this[_0x57815b(0x1e6)](_0x1397a6);console[_0x57815b(0x2a1)](_0x57815b(0x228)+_0xa1f20['length']+_0x57815b(0x1fa));let _0x7da957=0x0,_0x4be8f6=0x0;for(const _0x8c51a4 of _0x1397a6){try{if(_0xa1f20['includes'](_0x8c51a4['id'])){console[_0x57815b(0x2a1)](_0x57815b(0x1ea)+_0x8c51a4['id']+'\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check'),_0x4be8f6++;continue;}if(this[_0x57815b(0x22e)][_0x57815b(0x2ab)](_0x8c51a4['id'])){console[_0x57815b(0x2a1)](_0x57815b(0x1ea)+_0x8c51a4['id']+'\x20has\x20individual\x20timers,\x20skipping\x20global\x20check'),_0x4be8f6++;continue;}const _0x298b3f=(Date[_0x57815b(0x2b0)]()-_0x8c51a4['createdAt'][_0x57815b(0x2af)]())/(0x3e8*0x3c*0x3c);if(_0x298b3f<0x1){console[_0x57815b(0x2a1)](_0x57815b(0x1ea)+_0x8c51a4['id']+_0x57815b(0x212)+_0x298b3f['toFixed'](0x1)+_0x57815b(0x213)),_0x4be8f6++;continue;}console[_0x57815b(0x2a1)](_0x57815b(0x257)+_0x8c51a4['id']+_0x57815b(0x1ff)+_0x298b3f[_0x57815b(0x200)](0x1)+'h)'),await this[_0x57815b(0x28b)](_0x8c51a4),_0x7da957++,await new Promise(_0x5259c0=>setTimeout(_0x5259c0,0x7d0));}catch(_0x38639e){console[_0x57815b(0x2b3)](_0x57815b(0x2cc)+_0x8c51a4['id']+':',_0x38639e),this[_0x57815b(0x2db)](_0x8c51a4['id'],_0x8c51a4['gatewayPaymentId']||_0x57815b(0x23a),_0x38639e,_0x57815b(0x246),{'isGlobalCheck':!![],'paymentAmount':_0x8c51a4[_0x57815b(0x288)],'paymentCurrency':_0x8c51a4[_0x57815b(0x2c1)],'shopId':_0x8c51a4[_0x57815b(0x2d0)],'createdAt':_0x8c51a4['createdAt']}),loggerService_1[_0x57815b(0x24e)]['logWhiteDomainError'](_0x57815b(0x2c4),_0x57815b(0x2ce)+_0x8c51a4[_0x57815b(0x259)],_0x38639e);}}console[_0x57815b(0x2a1)]('✅\x20[GLOBAL]\x20Global\x20check\x20completed:\x20'+_0x7da957+_0x57815b(0x2a6)+_0x4be8f6+_0x57815b(0x1fb)+_0xa1f20['length']+_0x57815b(0x1e2));}catch(_0x296b2d){console[_0x57815b(0x2b3)](_0x57815b(0x262),_0x296b2d);}}async[a37_0x1254f2(0x1e6)](_0x37df4d){const _0x4b50a9=a37_0x1254f2,_0x364d60=[],_0x4f2587=new Date();_0x4f2587[_0x4b50a9(0x25b)](_0x4f2587['getDate']()-this['EXPIRY_DAYS']),console[_0x4b50a9(0x2a1)](_0x4b50a9(0x26c)+this[_0x4b50a9(0x2d9)]+_0x4b50a9(0x2c6)+_0x4f2587[_0x4b50a9(0x29b)]()+')');for(const _0x21e12b of _0x37df4d){if(_0x21e12b[_0x4b50a9(0x1dd)]<_0x4f2587){console['log'](_0x4b50a9(0x233)+_0x21e12b['id']+'\x20is\x20older\x20than\x20'+this[_0x4b50a9(0x2d9)]+_0x4b50a9(0x290));try{this[_0x4b50a9(0x29c)](_0x21e12b['id'],_0x21e12b[_0x4b50a9(0x259)]||'unknown',_0x4b50a9(0x245),_0x4b50a9(0x24d),_0x4b50a9(0x23f),{'reason':_0x4b50a9(0x207)+this['EXPIRY_DAYS']+'\x20days','createdAt':_0x21e12b[_0x4b50a9(0x1dd)],'daysSinceCreation':Math[_0x4b50a9(0x20c)]((Date[_0x4b50a9(0x2b0)]()-_0x21e12b['createdAt'][_0x4b50a9(0x2af)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x21e12b[_0x4b50a9(0x288)],'paymentCurrency':_0x21e12b[_0x4b50a9(0x2c1)],'shopId':_0x21e12b['shopId']}),await database_1[_0x4b50a9(0x20d)][_0x4b50a9(0x26e)][_0x4b50a9(0x297)]({'where':{'id':_0x21e12b['id']},'data':{'status':_0x4b50a9(0x24d),'updatedAt':new Date(),'adminNotes':_0x4b50a9(0x2d5)+this[_0x4b50a9(0x2d9)]+'\x20days\x20without\x20payment\x20confirmation'}}),await database_1[_0x4b50a9(0x20d)]['webhookLog'][_0x4b50a9(0x239)]({'data':{'paymentId':_0x21e12b['id'],'shopId':_0x21e12b[_0x4b50a9(0x2d0)],'event':_0x4b50a9(0x256),'statusCode':0xc8,'responseBody':JSON[_0x4b50a9(0x29d)]({'reason':_0x4b50a9(0x207)+this['EXPIRY_DAYS']+_0x4b50a9(0x1f8),'createdAt':_0x21e12b[_0x4b50a9(0x1dd)],'expiredAt':new Date()[_0x4b50a9(0x29b)](),'daysSinceCreation':Math['floor']((Date[_0x4b50a9(0x2b0)]()-_0x21e12b['createdAt'][_0x4b50a9(0x2af)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x4b50a9(0x2a0)](_0x21e12b,_0x4b50a9(0x24d)),await this[_0x4b50a9(0x1ee)](_0x21e12b,_0x4b50a9(0x24d)),this[_0x4b50a9(0x285)](_0x21e12b['id']),_0x364d60[_0x4b50a9(0x1ef)](_0x21e12b['id']),console[_0x4b50a9(0x2a1)]('✅\x20[EXPIRY]\x20Payment\x20'+_0x21e12b['id']+'\x20marked\x20as\x20EXPIRED\x20due\x20to\x20'+this[_0x4b50a9(0x2d9)]+_0x4b50a9(0x298));}catch(_0x219239){console['error'](_0x4b50a9(0x235)+_0x21e12b['id']+':',_0x219239),this[_0x4b50a9(0x2db)](_0x21e12b['id'],_0x21e12b[_0x4b50a9(0x259)]||_0x4b50a9(0x23a),_0x219239,'auto_expire',{'reason':'Failed\x20to\x20mark\x20payment\x20as\x20expired','createdAt':_0x21e12b['createdAt'],'daysSinceCreation':Math['floor']((Date[_0x4b50a9(0x2b0)]()-_0x21e12b['createdAt'][_0x4b50a9(0x2af)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x364d60;}async[a37_0x1254f2(0x28b)](_0x4695ff){const _0x1c6ffc=a37_0x1254f2;if(!_0x4695ff['gatewayPaymentId']){console[_0x1c6ffc(0x2a1)]('⚠️\x20[CHECK]\x20Payment\x20'+_0x4695ff['id']+_0x1c6ffc(0x1f2));return;}console['log']('🔍\x20[CHECK]\x20Checking\x20CoinToPay\x20payment\x20'+_0x4695ff['id']+'\x20('+_0x4695ff['gatewayPaymentId']+')');try{const _0x2e26db=await this['coinToPayService']['checkPaymentStatus'](_0x4695ff[_0x1c6ffc(0x259)]);console[_0x1c6ffc(0x2a1)](_0x1c6ffc(0x27c)+_0x4695ff['id']+'\x20status:\x20'+_0x2e26db['status']);_0x2e26db['paymentDetails']&&console[_0x1c6ffc(0x2a1)]('📊\x20[CHECK]\x20Payment\x20'+_0x4695ff['id']+_0x1c6ffc(0x2b7),{'iban':_0x2e26db[_0x1c6ffc(0x28f)][_0x1c6ffc(0x23c)]||_0x1c6ffc(0x283),'transactionId':_0x2e26db['paymentDetails'][_0x1c6ffc(0x23d)],'createdOn':_0x2e26db[_0x1c6ffc(0x28f)][_0x1c6ffc(0x291)],'confirmedOn':_0x2e26db[_0x1c6ffc(0x28f)]['confirmedOn']||_0x1c6ffc(0x21c)});if(_0x2e26db[_0x1c6ffc(0x1fd)]!==_0x4695ff['status']){console[_0x1c6ffc(0x2a1)](_0x1c6ffc(0x20a)+_0x4695ff['id']+_0x1c6ffc(0x2aa)+_0x4695ff[_0x1c6ffc(0x1fd)]+_0x1c6ffc(0x26a)+_0x2e26db[_0x1c6ffc(0x1fd)]),this['logCoinToPayStatus'](_0x4695ff['id'],_0x4695ff[_0x1c6ffc(0x259)],_0x4695ff['status'],_0x2e26db['status'],_0x1c6ffc(0x246),{'paymentDetails':_0x2e26db[_0x1c6ffc(0x28f)],'amount':_0x2e26db[_0x1c6ffc(0x288)],'currency':_0x2e26db[_0x1c6ffc(0x2c1)],'shopId':_0x4695ff[_0x1c6ffc(0x2d0)],'checkTimestamp':new Date()[_0x1c6ffc(0x29b)]()});const _0x4007d1={'status':_0x2e26db[_0x1c6ffc(0x1fd)],'updatedAt':new Date()};_0x2e26db[_0x1c6ffc(0x1fd)]==='PAID'&&_0x4695ff[_0x1c6ffc(0x1fd)]!=='PAID'&&(_0x4007d1['paidAt']=new Date(),console[_0x1c6ffc(0x2a1)](_0x1c6ffc(0x2bd)+_0x4695ff['id']+_0x1c6ffc(0x224)+_0x4007d1['paidAt'][_0x1c6ffc(0x29b)]()));if(_0x2e26db[_0x1c6ffc(0x28f)]){const _0x614844=_0x2e26db[_0x1c6ffc(0x28f)];_0x614844[_0x1c6ffc(0x23c)]&&(_0x4007d1['remitterIban']=_0x614844['iban'],console['log'](_0x1c6ffc(0x238)+_0x614844['iban']));if(_0x614844['bankDetails']){const _0xae457a=_0x4695ff[_0x1c6ffc(0x21b)]||'',_0x3e5cef=_0x1c6ffc(0x21d)+_0x614844[_0x1c6ffc(0x25f)];_0x4007d1[_0x1c6ffc(0x21b)]=_0xae457a?_0xae457a+'\x0a\x0a'+_0x3e5cef:_0x3e5cef,console[_0x1c6ffc(0x2a1)](_0x1c6ffc(0x201));}_0x614844[_0x1c6ffc(0x23d)]&&console['log']('🆔\x20[CHECK]\x20Transaction\x20ID:\x20'+_0x614844[_0x1c6ffc(0x23d)]),_0x614844[_0x1c6ffc(0x277)]&&console['log']('✅\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20'+_0x614844[_0x1c6ffc(0x277)]);}await database_1[_0x1c6ffc(0x20d)][_0x1c6ffc(0x26e)][_0x1c6ffc(0x297)]({'where':{'id':_0x4695ff['id']},'data':_0x4007d1}),await database_1[_0x1c6ffc(0x20d)][_0x1c6ffc(0x237)][_0x1c6ffc(0x239)]({'data':{'paymentId':_0x4695ff['id'],'shopId':_0x4695ff[_0x1c6ffc(0x2d0)],'event':_0x1c6ffc(0x2a7)+_0x2e26db[_0x1c6ffc(0x1fd)][_0x1c6ffc(0x289)](),'statusCode':0xc8,'responseBody':JSON[_0x1c6ffc(0x29d)]({'oldStatus':_0x4695ff['status'],'newStatus':_0x2e26db[_0x1c6ffc(0x1fd)],'paymentDetails':_0x2e26db[_0x1c6ffc(0x28f)],'checkedAt':new Date()['toISOString']()})}}),await this['sendShopWebhook'](_0x4695ff,_0x2e26db[_0x1c6ffc(0x1fd)]),await this[_0x1c6ffc(0x1ee)](_0x4695ff,_0x2e26db[_0x1c6ffc(0x1fd)]);if(_0x2e26db[_0x1c6ffc(0x1fd)]===_0x1c6ffc(0x2c5)&&_0x4695ff[_0x1c6ffc(0x1fd)]!==_0x1c6ffc(0x2c5))try{const {PaymentLinkService:_0x29c03d}=await Promise[_0x1c6ffc(0x1fe)]()[_0x1c6ffc(0x248)](()=>__importStar(require(_0x1c6ffc(0x29a)))),_0x7491c4=new _0x29c03d();await _0x7491c4[_0x1c6ffc(0x2c7)](_0x4695ff['id']),console[_0x1c6ffc(0x2a1)](_0x1c6ffc(0x280)+_0x4695ff['id']);}catch(_0x4da39b){console[_0x1c6ffc(0x2b3)](_0x1c6ffc(0x2b2)+_0x4695ff['id']+':',_0x4da39b);}_0x2e26db['status']!==_0x1c6ffc(0x245)&&(console['log'](_0x1c6ffc(0x2bb)+_0x4695ff['id']+_0x1c6ffc(0x27e)+_0x2e26db[_0x1c6ffc(0x1fd)]+_0x1c6ffc(0x205)),this[_0x1c6ffc(0x285)](_0x4695ff['id'])),console['log']('✅\x20[CHECK]\x20Payment\x20'+_0x4695ff['id']+_0x1c6ffc(0x24a));}else console[_0x1c6ffc(0x2a1)]('📊\x20[CHECK]\x20Payment\x20'+_0x4695ff['id']+_0x1c6ffc(0x204)+_0x2e26db[_0x1c6ffc(0x1fd)]+')'),this['logCoinToPayStatus'](_0x4695ff['id'],_0x4695ff[_0x1c6ffc(0x259)],_0x4695ff[_0x1c6ffc(0x1fd)],_0x2e26db[_0x1c6ffc(0x1fd)],_0x1c6ffc(0x246),{'statusUnchanged':!![],'paymentDetails':_0x2e26db[_0x1c6ffc(0x28f)],'amount':_0x2e26db[_0x1c6ffc(0x288)],'currency':_0x2e26db[_0x1c6ffc(0x2c1)],'shopId':_0x4695ff[_0x1c6ffc(0x2d0)],'checkTimestamp':new Date()[_0x1c6ffc(0x29b)]()});}catch(_0x38d7ef){console[_0x1c6ffc(0x2b3)](_0x1c6ffc(0x2cd)+_0x4695ff['id']+':',_0x38d7ef),this[_0x1c6ffc(0x2db)](_0x4695ff['id'],_0x4695ff['gatewayPaymentId'],_0x38d7ef,_0x1c6ffc(0x246),{'paymentAmount':_0x4695ff[_0x1c6ffc(0x288)],'paymentCurrency':_0x4695ff['currency'],'shopId':_0x4695ff[_0x1c6ffc(0x2d0)],'createdAt':_0x4695ff[_0x1c6ffc(0x1dd)]}),await database_1[_0x1c6ffc(0x20d)][_0x1c6ffc(0x237)][_0x1c6ffc(0x239)]({'data':{'paymentId':_0x4695ff['id'],'shopId':_0x4695ff['shopId'],'event':_0x1c6ffc(0x276),'statusCode':0x1f4,'responseBody':JSON[_0x1c6ffc(0x29d)]({'error':_0x38d7ef instanceof Error?_0x38d7ef[_0x1c6ffc(0x234)]:_0x1c6ffc(0x1df),'gatewayPaymentId':_0x4695ff[_0x1c6ffc(0x259)],'checkedAt':new Date()[_0x1c6ffc(0x29b)]()})}});}}async['sendShopWebhook'](_0x12da32,_0x1381c8){const _0x178de3=a37_0x1254f2,_0x17e8f0=Date['now']();try{const _0x561272=_0x12da32[_0x178de3(0x2d4)],_0x33deea=_0x561272['settings'];if(!_0x33deea?.[_0x178de3(0x2ad)]){console[_0x178de3(0x2a1)]('No\x20webhook\x20URL\x20configured\x20for\x20shop\x20'+_0x561272['id']);return;}const _0x3aab23=_0x1381c8===_0x178de3(0x2c5)?_0x178de3(0x286):_0x1381c8===_0x178de3(0x29f)?_0x178de3(0x210):_0x1381c8===_0x178de3(0x24d)?'payment.failed':_0x178de3(0x215);if(!_0x33deea['webhookEvents']?.[_0x178de3(0x2b9)](_0x3aab23)){console[_0x178de3(0x2a1)](_0x178de3(0x243)+_0x3aab23+_0x178de3(0x1ec)+_0x561272['id']);return;}const _0x44f9aa={'event':_0x3aab23,'payment':{'id':_0x12da32['id'],'order_id':_0x12da32[_0x178de3(0x2bf)],'gateway_order_id':_0x12da32[_0x178de3(0x261)],'gateway':_0x178de3(0x24b),'amount':_0x12da32[_0x178de3(0x288)],'currency':_0x12da32['currency'],'status':_0x1381c8[_0x178de3(0x289)](),'customer_email':_0x12da32[_0x178de3(0x258)],'customer_name':_0x12da32[_0x178de3(0x2b1)],'created_at':_0x12da32[_0x178de3(0x1dd)],'updated_at':new Date()}},_0x2ccf5a=await fetch(_0x33deea[_0x178de3(0x2ad)],{'method':_0x178de3(0x26b),'headers':{'Content-Type':_0x178de3(0x250),'User-Agent':_0x178de3(0x22b)},'body':JSON['stringify'](_0x44f9aa)}),_0x190426=Date[_0x178de3(0x2b0)]()-_0x17e8f0,_0x3a1e64=_0x2ccf5a['ok']?_0x178de3(0x29e):await _0x2ccf5a[_0x178de3(0x1f4)]();loggerService_1[_0x178de3(0x24e)]['logShopWebhookSent'](_0x12da32[_0x178de3(0x2d0)],_0x33deea[_0x178de3(0x2ad)],_0x3aab23,_0x2ccf5a['status'],_0x190426,_0x44f9aa),console[_0x178de3(0x2a1)](_0x178de3(0x273)+_0x33deea[_0x178de3(0x2ad)]+'\x20with\x20status\x20'+_0x2ccf5a[_0x178de3(0x1fd)]+'\x20('+_0x190426+'ms)');}catch(_0x116e05){console['error'](_0x178de3(0x253),_0x116e05),loggerService_1['loggerService'][_0x178de3(0x2c8)](_0x12da32[_0x178de3(0x2d0)],_0x12da32[_0x178de3(0x2d4)]?.[_0x178de3(0x269)]?.[_0x178de3(0x2ad)]||_0x178de3(0x23a),_0x178de3(0x2ca),_0x116e05,{});}}async[a37_0x1254f2(0x1ee)](_0x450b8a,_0x5032f4){const _0x395fcf=a37_0x1254f2;try{const _0x177e95={'PENDING':_0x395fcf(0x2c0),'PAID':_0x395fcf(0x254),'FAILED':_0x395fcf(0x1e0),'EXPIRED':_0x395fcf(0x22a)},_0x372bfb=_0x177e95[_0x5032f4];if(!_0x372bfb||_0x372bfb==='created')return;await telegramBotService_1[_0x395fcf(0x216)][_0x395fcf(0x1fc)](_0x450b8a[_0x395fcf(0x2d0)],_0x450b8a,_0x372bfb);}catch(_0x191a4b){console[_0x395fcf(0x2b3)](_0x395fcf(0x279),_0x191a4b);}}async['checkPaymentById'](_0x2cc439){const _0x5cb55f=a37_0x1254f2;console['log']('🔍\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20'+_0x2cc439);const _0x37500=await database_1['default'][_0x5cb55f(0x26e)]['findUnique']({'where':{'id':_0x2cc439},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x37500)throw new Error(_0x5cb55f(0x25e));if(_0x37500[_0x5cb55f(0x2c3)]!==_0x5cb55f(0x2c4))throw new Error('Payment\x20is\x20not\x20a\x20CoinToPay\x20payment');console[_0x5cb55f(0x2a1)](_0x5cb55f(0x1f5)+_0x2cc439),await this[_0x5cb55f(0x28b)](_0x37500),console[_0x5cb55f(0x2a1)](_0x5cb55f(0x225)+_0x2cc439);}[a37_0x1254f2(0x268)](){const _0xdc84bf=a37_0x1254f2,_0xdbcec7=this[_0xdc84bf(0x1f9)]?this['GLOBAL_CHECK_INTERVAL_MS']:undefined,_0x2cde3f=Array['from'](this['paymentTimers'][_0xdc84bf(0x206)]())[_0xdc84bf(0x272)](_0x1adef1=>({'paymentId':_0x1adef1[_0xdc84bf(0x2d8)],'gatewayPaymentId':_0x1adef1['gatewayPaymentId'],'createdAt':_0x1adef1[_0xdc84bf(0x1dd)],'timersCount':_0x1adef1[_0xdc84bf(0x241)][_0xdc84bf(0x227)]}));return{'isActive':!!this[_0xdc84bf(0x1f9)],'globalCheckIntervalMinutes':this['GLOBAL_CHECK_INTERVAL_MS']/(0x3e8*0x3c),'expiryDays':this[_0xdc84bf(0x2d9)],'activeIndividualTimers':this[_0xdc84bf(0x22e)][_0xdc84bf(0x267)],'nextGlobalCheckIn':_0xdbcec7,'paymentTimersDetails':_0x2cde3f};}[a37_0x1254f2(0x2bc)](_0x57fe54){const _0x2f9090=a37_0x1254f2,_0x266e19=this[_0x2f9090(0x22e)][_0x2f9090(0x1de)](_0x57fe54);if(_0x266e19)return{'hasTimers':!![],'timersCount':_0x266e19[_0x2f9090(0x241)][_0x2f9090(0x227)],'createdAt':_0x266e19[_0x2f9090(0x1dd)],'gatewayPaymentId':_0x266e19[_0x2f9090(0x259)]};return{'hasTimers':![]};}}exports[a37_0x1254f2(0x25a)]=CoinToPayStatusService,exports[a37_0x1254f2(0x1e8)]=new CoinToPayStatusService();