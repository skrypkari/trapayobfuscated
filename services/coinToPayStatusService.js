'use strict';const a57_0x2ff739=a57_0x8c02;(function(_0x993ba3,_0x17b478){const _0x1ace1d=a57_0x8c02,_0x155ac5=_0x993ba3();while(!![]){try{const _0x1eac88=parseInt(_0x1ace1d(0x23e))/0x1+parseInt(_0x1ace1d(0x1b6))/0x2+-parseInt(_0x1ace1d(0x134))/0x3*(parseInt(_0x1ace1d(0x184))/0x4)+parseInt(_0x1ace1d(0x1f0))/0x5*(parseInt(_0x1ace1d(0x1d2))/0x6)+-parseInt(_0x1ace1d(0x1dc))/0x7*(-parseInt(_0x1ace1d(0x143))/0x8)+parseInt(_0x1ace1d(0x1ae))/0x9+-parseInt(_0x1ace1d(0x15d))/0xa;if(_0x1eac88===_0x17b478)break;else _0x155ac5['push'](_0x155ac5['shift']());}catch(_0x3ecc83){_0x155ac5['push'](_0x155ac5['shift']());}}}(a57_0xd4c7,0xb6ce2));var __importDefault=this&&this[a57_0x2ff739(0x1de)]||function(_0x5775ef){return _0x5775ef&&_0x5775ef['__esModule']?_0x5775ef:{'default':_0x5775ef};};Object[a57_0x2ff739(0x15b)](exports,'__esModule',{'value':!![]}),exports['coinToPayStatusService']=exports[a57_0x2ff739(0x1e9)]=void 0x0;function a57_0x8c02(_0x3e2921,_0x19a022){_0x3e2921=_0x3e2921-0x122;const _0xd4c7aa=a57_0xd4c7();let _0x8c02e9=_0xd4c7aa[_0x3e2921];return _0x8c02e9;}const crypto_1=__importDefault(require(a57_0x2ff739(0x1d5))),coinToPayService_1=require(a57_0x2ff739(0x229)),coinToPay2Service_1=require(a57_0x2ff739(0x16f)),gateway_1=require('../types/gateway'),database_1=__importDefault(require(a57_0x2ff739(0x177))),telegramBotService_1=require(a57_0x2ff739(0x15a)),loggerService_1=require(a57_0x2ff739(0x1b7)),currencyService_1=require(a57_0x2ff739(0x1e7));class CoinToPayStatusService{constructor(){const _0x186d0a=a57_0x2ff739;this[_0x186d0a(0x1d0)]=null,this['GLOBAL_CHECK_INTERVAL_MS']=0x3c*0x3c*0x3e8,this[_0x186d0a(0x23f)]=0x5,this[_0x186d0a(0x209)]=new Map(),this[_0x186d0a(0x12c)]=new coinToPayService_1[(_0x186d0a(0x1f8))](),this[_0x186d0a(0x163)]=new coinToPay2Service_1[(_0x186d0a(0x122))](),console[_0x186d0a(0x1d6)](_0x186d0a(0x17a));}[a57_0x2ff739(0x15c)](_0x4a3698,_0x3002b0){const _0x721aba=a57_0x2ff739;console[_0x721aba(0x1d6)](_0x721aba(0x13c)),console[_0x721aba(0x1d6)](_0x721aba(0x180)+_0x4a3698),console['log'](_0x721aba(0x1d4)+_0x3002b0),this[_0x721aba(0x17b)](_0x4a3698);const _0x57acb7=[],_0x146bc3=new Date(),_0x16d2bf=[{'delay':0x1*0x3c*0x3e8,'description':_0x721aba(0x1dd)},{'delay':0x2*0x3c*0x3e8,'description':_0x721aba(0x161)},{'delay':0x5*0x3c*0x3e8,'description':'5\x20minutes'},{'delay':0x5*0x3c*0x3e8,'description':'5\x20minutes'}];console['log']('ü™ô\x20[DEBUG]\x20Creating\x20'+_0x16d2bf[_0x721aba(0x23d)]+'\x20initial\x20timers\x20for\x20payment\x20'+_0x4a3698);let _0x2975de=0x0;_0x16d2bf['forEach']((_0x318bb0,_0x2de453)=>{const _0x21036d=_0x721aba;_0x2975de+=_0x318bb0[_0x21036d(0x146)];const _0x2784ec=setTimeout(async()=>{const _0x1eba37=_0x21036d;console[_0x1eba37(0x1d6)](_0x1eba37(0x164)+(_0x2de453+0x1)+_0x1eba37(0x157)+_0x4a3698+_0x1eba37(0x204)+_0x318bb0[_0x1eba37(0x22b)]+')');try{await this[_0x1eba37(0x17c)](_0x4a3698),console['log']('‚úÖ\x20[TIMER]\x20Individual\x20check\x20#'+(_0x2de453+0x1)+_0x1eba37(0x149)+_0x4a3698);}catch(_0x236b91){console[_0x1eba37(0x21b)](_0x1eba37(0x1ff)+(_0x2de453+0x1)+'\x20for\x20payment\x20'+_0x4a3698+':',_0x236b91),this[_0x1eba37(0x20c)](_0x4a3698,_0x3002b0,_0x236b91,_0x1eba37(0x18c),{'checkNumber':_0x2de453+0x1,'scheduledAfter':_0x318bb0['description'],'isIndividualCheck':!![]});}},_0x2975de);_0x57acb7[_0x21036d(0x13b)](_0x2784ec),console['log']('‚è∞\x20[DEBUG]\x20Scheduled\x20check\x20#'+(_0x2de453+0x1)+'\x20for\x20payment\x20'+_0x4a3698+_0x21036d(0x136)+_0x2975de/0x3e8+'\x20seconds\x20('+_0x318bb0[_0x21036d(0x22b)]+')');});const _0x1b012e=setInterval(async()=>{const _0x33a230=_0x721aba;console[_0x33a230(0x1d6)](_0x33a230(0x207)+_0x4a3698);try{const _0x2ae7cd=await database_1[_0x33a230(0x1a8)][_0x33a230(0x17f)][_0x33a230(0x15e)]({'where':{'id':_0x4a3698},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x2ae7cd){console[_0x33a230(0x1d6)](_0x33a230(0x1a7)+_0x4a3698+_0x33a230(0x14c)),this['clearPaymentTimers'](_0x4a3698);return;}console[_0x33a230(0x1d6)](_0x33a230(0x1c3)+_0x4a3698+_0x33a230(0x23a)+_0x2ae7cd[_0x33a230(0x22c)]);if(_0x2ae7cd[_0x33a230(0x22c)]!==_0x33a230(0x1a3)){console[_0x33a230(0x1d6)](_0x33a230(0x179)+_0x4a3698+'\x20status\x20is\x20'+_0x2ae7cd[_0x33a230(0x22c)]+_0x33a230(0x160)),this[_0x33a230(0x17b)](_0x4a3698);return;}const _0x516589=Math[_0x33a230(0x13a)]((Date[_0x33a230(0x16b)]()-_0x2ae7cd['createdAt']['getTime']())/(0x3e8*0x3c*0x3c*0x18));if(_0x516589>=this[_0x33a230(0x23f)]){console[_0x33a230(0x1d6)](_0x33a230(0x14a)+_0x4a3698+_0x33a230(0x215)+this[_0x33a230(0x23f)]+'\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check'),this[_0x33a230(0x17b)](_0x4a3698);return;}await this[_0x33a230(0x17c)](_0x4a3698),console[_0x33a230(0x1d6)](_0x33a230(0x1cb)+_0x4a3698);}catch(_0x1f077e){console[_0x33a230(0x21b)]('‚ùå\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20'+_0x4a3698+':',_0x1f077e),this['logCoinToPayError'](_0x4a3698,_0x3002b0,_0x1f077e,_0x33a230(0x18c),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x57acb7[_0x721aba(0x13b)](_0x1b012e),this[_0x721aba(0x209)][_0x721aba(0x237)](_0x4a3698,{'timers':_0x57acb7,'paymentId':_0x4a3698,'gatewayPaymentId':_0x3002b0,'createdAt':_0x146bc3}),console['log']('‚úÖ\x20[DEBUG]\x20Successfully\x20scheduled\x20'+_0x16d2bf['length']+_0x721aba(0x172)+_0x4a3698),console[_0x721aba(0x1d6)](_0x721aba(0x231)+this[_0x721aba(0x209)][_0x721aba(0x1c0)]),this['logCoinToPayStatus'](_0x4a3698,_0x3002b0,_0x721aba(0x1a3),'PENDING',_0x721aba(0x18c),{'action':_0x721aba(0x14b),'scheduledChecks':_0x16d2bf[_0x721aba(0x23d)],'firstCheckIn':_0x16d2bf[0x0][_0x721aba(0x146)]/0x3e8,'totalTimers':this['paymentTimers'][_0x721aba(0x1c0)]});}['clearPaymentTimers'](_0x1aa2da){const _0x162023=a57_0x2ff739,_0x5ca669=this['paymentTimers'][_0x162023(0x1c2)](_0x1aa2da);_0x5ca669?(console['log'](_0x162023(0x17e)+_0x5ca669[_0x162023(0x19a)]['length']+_0x162023(0x1c5)+_0x1aa2da),_0x5ca669[_0x162023(0x19a)][_0x162023(0x20f)]((_0x4af232,_0x281793)=>{const _0x26c5d8=_0x162023;_0x4af232&&(clearTimeout(_0x4af232),clearInterval(_0x4af232),console[_0x26c5d8(0x1d6)](_0x26c5d8(0x1f9)+(_0x281793+0x1)+_0x26c5d8(0x170)+_0x1aa2da));}),this[_0x162023(0x209)][_0x162023(0x18e)](_0x1aa2da),console['log'](_0x162023(0x22a)+_0x1aa2da+_0x162023(0x165)+this[_0x162023(0x209)][_0x162023(0x1c0)])):console[_0x162023(0x1d6)](_0x162023(0x13e)+_0x1aa2da+_0x162023(0x15f));}async[a57_0x2ff739(0x17c)](_0x133231){const _0x3ebb05=a57_0x2ff739;console['log'](_0x3ebb05(0x19c)+_0x133231);const _0x21e56e=await database_1[_0x3ebb05(0x1a8)][_0x3ebb05(0x17f)]['findUnique']({'where':{'id':_0x133231},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x21e56e){console[_0x3ebb05(0x1d6)](_0x3ebb05(0x208)+_0x133231+_0x3ebb05(0x1a9));return;}console[_0x3ebb05(0x1d6)](_0x3ebb05(0x239)+_0x133231+_0x3ebb05(0x23b)),console[_0x3ebb05(0x1d6)](_0x3ebb05(0x174)+_0x21e56e['gateway']),console[_0x3ebb05(0x1d6)](_0x3ebb05(0x139)+_0x21e56e['status']),console[_0x3ebb05(0x1d6)](_0x3ebb05(0x1ac)+_0x21e56e[_0x3ebb05(0x233)]),console[_0x3ebb05(0x1d6)](_0x3ebb05(0x1ce)+_0x21e56e[_0x3ebb05(0x1ed)]+'\x20'+_0x21e56e[_0x3ebb05(0x206)]),console['log'](_0x3ebb05(0x197)+_0x21e56e[_0x3ebb05(0x1cd)]);if(_0x21e56e['gateway']!==_0x3ebb05(0x21c)&&_0x21e56e[_0x3ebb05(0x17d)]!==_0x3ebb05(0x1b1)){console[_0x3ebb05(0x1d6)](_0x3ebb05(0x235)+_0x133231+'\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20'+_0x21e56e['gateway']+')');return;}if(_0x21e56e[_0x3ebb05(0x22c)]!==_0x3ebb05(0x1a3)){console[_0x3ebb05(0x1d6)](_0x3ebb05(0x235)+_0x133231+_0x3ebb05(0x1bc)+_0x21e56e[_0x3ebb05(0x22c)]+_0x3ebb05(0x160)),this[_0x3ebb05(0x17b)](_0x133231);return;}if(!_0x21e56e[_0x3ebb05(0x233)]){console[_0x3ebb05(0x1d6)]('‚ö†Ô∏è\x20[CHECK]\x20Payment\x20'+_0x133231+_0x3ebb05(0x221));return;}console[_0x3ebb05(0x1d6)](_0x3ebb05(0x126)+_0x133231+'\x20is\x20valid\x20for\x20checking,\x20proceeding...'),await this['checkSinglePayment'](_0x21e56e);}[a57_0x2ff739(0x155)](_0x4a9083,_0x3edec4,_0x5ad226,_0x4f7e30,_0x102027,_0x229653){const _0x16fdf1=a57_0x2ff739,_0x211863={'type':_0x16fdf1(0x18d),'paymentId':_0x4a9083,'gatewayPaymentId':_0x3edec4,'oldStatus':_0x5ad226,'newStatus':_0x4f7e30,'source':_0x102027,'timestamp':new Date()[_0x16fdf1(0x171)](),'details':_0x229653||{}};loggerService_1['loggerService'][_0x16fdf1(0x155)](_0x211863),console[_0x16fdf1(0x1d6)](_0x16fdf1(0x1e6)+_0x4a9083+'\x20('+_0x3edec4+')'),console[_0x16fdf1(0x1d6)](_0x16fdf1(0x1ad)+_0x5ad226+_0x16fdf1(0x150)+_0x4f7e30),console[_0x16fdf1(0x1d6)](_0x16fdf1(0x234)+_0x102027),console[_0x16fdf1(0x1d6)](_0x16fdf1(0x12a)+_0x211863[_0x16fdf1(0x19f)]),_0x229653&&console[_0x16fdf1(0x1d6)](_0x16fdf1(0x20b),_0x229653);}['logCoinToPayError'](_0x31dcfd,_0x2a7225,_0xae3385,_0x438050,_0x332a70){const _0x79c0cd=a57_0x2ff739,_0x2be83e={'type':_0x79c0cd(0x195),'paymentId':_0x31dcfd,'gatewayPaymentId':_0x2a7225,'error':_0xae3385 instanceof Error?{'message':_0xae3385[_0x79c0cd(0x153)],'stack':_0xae3385['stack']}:_0xae3385,'source':_0x438050,'timestamp':new Date()['toISOString'](),'context':_0x332a70||{}};loggerService_1[_0x79c0cd(0x18b)][_0x79c0cd(0x20c)](_0x2be83e),console[_0x79c0cd(0x21b)]('ü™ô\x20[ERROR]\x20CoinToPay\x20Error:\x20'+_0x31dcfd+'\x20('+_0x2a7225+')'),console[_0x79c0cd(0x21b)](_0x79c0cd(0x13f)+(_0xae3385 instanceof Error?_0xae3385['message']:_0xae3385)),console[_0x79c0cd(0x21b)](_0x79c0cd(0x234)+_0x438050),console[_0x79c0cd(0x21b)](_0x79c0cd(0x12a)+_0x2be83e['timestamp']),_0x332a70&&console['error']('\x20\x20\x20üìù\x20Context:',_0x332a70);}[a57_0x2ff739(0x1a4)](){const _0x525f08=a57_0x2ff739;console['log'](_0x525f08(0x198)),this[_0x525f08(0x16d)]()[_0x525f08(0x223)](_0x58d01f=>{const _0x26bef7=_0x525f08;console[_0x26bef7(0x21b)](_0x26bef7(0x1b2),_0x58d01f);}),this['globalCheckInterval']=setInterval(async()=>{const _0x22d89b=_0x525f08;try{console[_0x22d89b(0x1d6)](_0x22d89b(0x1a0)),await this['checkAllPendingPayments'](),console[_0x22d89b(0x1d6)](_0x22d89b(0x1f3));}catch(_0x1ea21f){console['error'](_0x22d89b(0x140),_0x1ea21f);}},this[_0x525f08(0x218)]),console[_0x525f08(0x1d6)](_0x525f08(0x214));}[a57_0x2ff739(0x21d)](){const _0xfe60c0=a57_0x2ff739;console[_0xfe60c0(0x1d6)](_0xfe60c0(0x1cf));this[_0xfe60c0(0x1d0)]&&(clearInterval(this[_0xfe60c0(0x1d0)]),this[_0xfe60c0(0x1d0)]=null,console[_0xfe60c0(0x1d6)](_0xfe60c0(0x178)));const _0x3597da=this[_0xfe60c0(0x209)]['size'];for(const [_0x42145e]of this[_0xfe60c0(0x209)]){this[_0xfe60c0(0x17b)](_0x42145e);}console['log'](_0xfe60c0(0x12b)+_0x3597da+_0xfe60c0(0x205));}async[a57_0x2ff739(0x16d)](){const _0x1ac6d5=a57_0x2ff739;try{console[_0x1ac6d5(0x1d6)](_0x1ac6d5(0x1af));const _0x2fffc0=await database_1['default'][_0x1ac6d5(0x17f)][_0x1ac6d5(0x16a)]({'where':{'gateway':{'in':[_0x1ac6d5(0x21c),_0x1ac6d5(0x1b1)]},'status':'PENDING','gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'secretKey':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x1ac6d5(0x1d6)](_0x1ac6d5(0x131)+_0x2fffc0['length']+_0x1ac6d5(0x199));if(_0x2fffc0[_0x1ac6d5(0x23d)]===0x0){console[_0x1ac6d5(0x1d6)](_0x1ac6d5(0x228));return;}const _0x1bd0ca=await this[_0x1ac6d5(0x147)](_0x2fffc0);console[_0x1ac6d5(0x1d6)](_0x1ac6d5(0x1d3)+_0x1bd0ca['length']+_0x1ac6d5(0x232));let _0x53d40c=0x0,_0x5b5052=0x0;for(const _0x38a52a of _0x2fffc0){try{if(_0x1bd0ca[_0x1ac6d5(0x138)](_0x38a52a['id'])){console[_0x1ac6d5(0x1d6)]('‚è∞\x20[GLOBAL]\x20Payment\x20'+_0x38a52a['id']+_0x1ac6d5(0x1fa)),_0x5b5052++;continue;}if(this['paymentTimers'][_0x1ac6d5(0x1f4)](_0x38a52a['id'])){console[_0x1ac6d5(0x1d6)](_0x1ac6d5(0x21f)+_0x38a52a['id']+_0x1ac6d5(0x152)),_0x5b5052++;continue;}const _0x412cca=(Date[_0x1ac6d5(0x16b)]()-_0x38a52a[_0x1ac6d5(0x1c1)]['getTime']())/(0x3e8*0x3c*0x3c);if(_0x412cca<0x1){console[_0x1ac6d5(0x1d6)](_0x1ac6d5(0x21f)+_0x38a52a['id']+_0x1ac6d5(0x191)+_0x412cca['toFixed'](0x1)+_0x1ac6d5(0x1ec)),_0x5b5052++;continue;}console[_0x1ac6d5(0x1d6)]('üîç\x20[GLOBAL]\x20Checking\x20old\x20payment\x20'+_0x38a52a['id']+_0x1ac6d5(0x225)+_0x412cca[_0x1ac6d5(0x13d)](0x1)+'h)'),await this[_0x1ac6d5(0x1b3)](_0x38a52a),_0x53d40c++,await new Promise(_0x3e4251=>setTimeout(_0x3e4251,0x7d0));}catch(_0x435dbb){console[_0x1ac6d5(0x21b)]('‚ùå\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20'+_0x38a52a['id']+':',_0x435dbb),this[_0x1ac6d5(0x20c)](_0x38a52a['id'],_0x38a52a[_0x1ac6d5(0x233)]||'unknown',_0x435dbb,_0x1ac6d5(0x18c),{'isGlobalCheck':!![],'paymentAmount':_0x38a52a[_0x1ac6d5(0x1ed)],'paymentCurrency':_0x38a52a[_0x1ac6d5(0x206)],'shopId':_0x38a52a[_0x1ac6d5(0x1cd)],'createdAt':_0x38a52a['createdAt']}),loggerService_1[_0x1ac6d5(0x18b)]['logWhiteDomainError'](_0x1ac6d5(0x21c),'/status/'+_0x38a52a['gatewayPaymentId'],_0x435dbb);}}console[_0x1ac6d5(0x1d6)](_0x1ac6d5(0x202)+_0x53d40c+'\x20checked,\x20'+_0x5b5052+'\x20skipped,\x20'+_0x1bd0ca[_0x1ac6d5(0x23d)]+_0x1ac6d5(0x23c));}catch(_0x1311d8){console[_0x1ac6d5(0x21b)](_0x1ac6d5(0x1d9),_0x1311d8);}}async['checkExpiredPayments'](_0x266200){const _0x94a835=a57_0x2ff739,_0x34111c=[],_0x5f0ec6=new Date();_0x5f0ec6[_0x94a835(0x21e)](_0x5f0ec6[_0x94a835(0x183)]()-this[_0x94a835(0x23f)]),console[_0x94a835(0x1d6)](_0x94a835(0x181)+this[_0x94a835(0x23f)]+_0x94a835(0x151)+_0x5f0ec6[_0x94a835(0x171)]()+')');for(const _0x2b1620 of _0x266200){if(_0x2b1620[_0x94a835(0x1c1)]<_0x5f0ec6){console[_0x94a835(0x1d6)](_0x94a835(0x127)+_0x2b1620['id']+_0x94a835(0x215)+this[_0x94a835(0x23f)]+_0x94a835(0x1ba));try{this[_0x94a835(0x155)](_0x2b1620['id'],_0x2b1620['gatewayPaymentId']||_0x94a835(0x193),_0x94a835(0x1a3),_0x94a835(0x21a),'auto_expire',{'reason':_0x94a835(0x1fb)+this[_0x94a835(0x23f)]+'\x20days','createdAt':_0x2b1620[_0x94a835(0x1c1)],'daysSinceCreation':Math[_0x94a835(0x13a)]((Date['now']()-_0x2b1620[_0x94a835(0x1c1)][_0x94a835(0x12f)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x2b1620['amount'],'paymentCurrency':_0x2b1620['currency'],'shopId':_0x2b1620[_0x94a835(0x1cd)]}),await database_1[_0x94a835(0x1a8)][_0x94a835(0x17f)]['update']({'where':{'id':_0x2b1620['id']},'data':{'status':_0x94a835(0x21a),'updatedAt':new Date()}}),await database_1[_0x94a835(0x1a8)][_0x94a835(0x145)][_0x94a835(0x189)]({'data':{'paymentId':_0x2b1620['id'],'shopId':_0x2b1620[_0x94a835(0x1cd)],'event':_0x94a835(0x200),'statusCode':0xc8,'responseBody':JSON['stringify']({'reason':_0x94a835(0x1fb)+this['EXPIRY_DAYS']+'\x20days','createdAt':_0x2b1620['createdAt'],'expiredAt':new Date()[_0x94a835(0x171)](),'daysSinceCreation':Math[_0x94a835(0x13a)]((Date['now']()-_0x2b1620[_0x94a835(0x1c1)]['getTime']())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x94a835(0x230)](_0x2b1620,_0x94a835(0x21a)),await this['sendPaymentStatusNotification'](_0x2b1620,'EXPIRED'),this['clearPaymentTimers'](_0x2b1620['id']),_0x34111c['push'](_0x2b1620['id']),console[_0x94a835(0x1d6)](_0x94a835(0x188)+_0x2b1620['id']+_0x94a835(0x1bb)+this[_0x94a835(0x23f)]+_0x94a835(0x1f1));}catch(_0x965bcc){console[_0x94a835(0x21b)](_0x94a835(0x156)+_0x2b1620['id']+':',_0x965bcc),this[_0x94a835(0x20c)](_0x2b1620['id'],_0x2b1620['gatewayPaymentId']||_0x94a835(0x193),_0x965bcc,_0x94a835(0x1b0),{'reason':_0x94a835(0x1f2),'createdAt':_0x2b1620[_0x94a835(0x1c1)],'daysSinceCreation':Math[_0x94a835(0x13a)]((Date[_0x94a835(0x16b)]()-_0x2b1620['createdAt'][_0x94a835(0x12f)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x34111c;}async[a57_0x2ff739(0x1b3)](_0x360b1c){const _0x1bad07=a57_0x2ff739;if(!_0x360b1c[_0x1bad07(0x233)]){console[_0x1bad07(0x1d6)](_0x1bad07(0x235)+_0x360b1c['id']+_0x1bad07(0x1d8));return;}console['log'](_0x1bad07(0x19d)+_0x360b1c[_0x1bad07(0x17d)]+'\x20payment\x20'+_0x360b1c['id']+'\x20('+_0x360b1c[_0x1bad07(0x233)]+')');try{let _0x4e2ccc;_0x360b1c[_0x1bad07(0x17d)]===_0x1bad07(0x1b1)?(_0x4e2ccc=await this['coinToPay2Service'][_0x1bad07(0x1a5)](_0x360b1c[_0x1bad07(0x233)]),console[_0x1bad07(0x1d6)]('üìä\x20[CHECK]\x20CoinToPay2\x20payment\x20'+_0x360b1c['id']+_0x1bad07(0x1b4)+_0x4e2ccc['status'])):(_0x4e2ccc=await this[_0x1bad07(0x12c)]['checkPaymentStatus'](_0x360b1c['gatewayPaymentId']),console['log'](_0x1bad07(0x1ee)+_0x360b1c['id']+_0x1bad07(0x1b4)+_0x4e2ccc[_0x1bad07(0x22c)]));_0x4e2ccc[_0x1bad07(0x1d1)]&&console[_0x1bad07(0x1d6)](_0x1bad07(0x239)+_0x360b1c['id']+_0x1bad07(0x1f6),{'iban':_0x4e2ccc[_0x1bad07(0x1d1)]['iban']||_0x1bad07(0x176),'transactionId':_0x4e2ccc[_0x1bad07(0x1d1)]['transactionId'],'createdOn':_0x4e2ccc[_0x1bad07(0x1d1)][_0x1bad07(0x1fc)],'confirmedOn':_0x4e2ccc[_0x1bad07(0x1d1)][_0x1bad07(0x168)]||_0x1bad07(0x1df)});if(_0x4e2ccc[_0x1bad07(0x22c)]!==_0x360b1c[_0x1bad07(0x22c)]){console[_0x1bad07(0x1d6)]('üîÑ\x20[CHECK]\x20Updating\x20payment\x20'+_0x360b1c['id']+_0x1bad07(0x182)+_0x360b1c[_0x1bad07(0x22c)]+'\x20to\x20'+_0x4e2ccc[_0x1bad07(0x22c)]),this[_0x1bad07(0x155)](_0x360b1c['id'],_0x360b1c[_0x1bad07(0x233)],_0x360b1c[_0x1bad07(0x22c)],_0x4e2ccc[_0x1bad07(0x22c)],_0x1bad07(0x18c),{'paymentDetails':_0x4e2ccc[_0x1bad07(0x1d1)],'amount':_0x4e2ccc['amount'],'currency':_0x4e2ccc[_0x1bad07(0x206)],'shopId':_0x360b1c[_0x1bad07(0x1cd)],'checkTimestamp':new Date()[_0x1bad07(0x171)]()});const _0x46c930={'status':_0x4e2ccc[_0x1bad07(0x22c)],'updatedAt':new Date()};if(_0x4e2ccc['status']===_0x1bad07(0x20e)&&_0x360b1c[_0x1bad07(0x22c)]!==_0x1bad07(0x20e)){_0x46c930[_0x1bad07(0x130)]=new Date();if(!_0x360b1c['amountUSDT']){const _0x28bd2d=await currencyService_1[_0x1bad07(0x1a6)][_0x1bad07(0x144)](_0x360b1c[_0x1bad07(0x1ed)],_0x360b1c[_0x1bad07(0x206)]);_0x46c930[_0x1bad07(0x148)]=_0x28bd2d;const _0xe9b6be=await this[_0x1bad07(0x1e2)](_0x360b1c['shopId'],_0x360b1c['gateway']),_0x5a642a=_0x28bd2d*(0x1-_0xe9b6be/0x64);_0x46c930['amountAfterGatewayCommissionUSDT']=_0x5a642a,_0x46c930['gatewayCommissionRate']=_0xe9b6be,console[_0x1bad07(0x1d6)](_0x1bad07(0x124)+_0x360b1c['id']+_0x1bad07(0x1e8)),console[_0x1bad07(0x1d6)]('\x20\x20\x20Amount:\x20'+_0x360b1c['amount']+'\x20'+_0x360b1c[_0x1bad07(0x206)]+_0x1bad07(0x150)+_0x28bd2d[_0x1bad07(0x13d)](0x6)+_0x1bad07(0x1d7)),console[_0x1bad07(0x1d6)](_0x1bad07(0x1f7)+_0x360b1c[_0x1bad07(0x17d)]+_0x1bad07(0x1bd)+_0xe9b6be+'%'),console[_0x1bad07(0x1d6)](_0x1bad07(0x1c4)+_0x5a642a[_0x1bad07(0x13d)](0x6)+'\x20USDT');}console[_0x1bad07(0x1d6)]('üí∞\x20[CHECK]\x20Payment\x20'+_0x360b1c['id']+_0x1bad07(0x141)+_0x46c930[_0x1bad07(0x130)][_0x1bad07(0x171)]());}if(_0x4e2ccc[_0x1bad07(0x1d1)]){const _0x21343d=_0x4e2ccc[_0x1bad07(0x1d1)];_0x21343d[_0x1bad07(0x132)]&&(_0x46c930[_0x1bad07(0x190)]=_0x21343d['iban'],console['log']('üè¶\x20[CHECK]\x20Saved\x20IBAN:\x20'+_0x21343d['iban'])),_0x21343d['bankDetails']&&console[_0x1bad07(0x1d6)](_0x1bad07(0x1ca)+_0x21343d[_0x1bad07(0x219)]),_0x21343d[_0x1bad07(0x1e1)]&&console[_0x1bad07(0x1d6)](_0x1bad07(0x1eb)+_0x21343d['transactionId']),_0x21343d['confirmedOn']&&console[_0x1bad07(0x1d6)](_0x1bad07(0x238)+_0x21343d[_0x1bad07(0x168)]);}await database_1[_0x1bad07(0x1a8)][_0x1bad07(0x17f)][_0x1bad07(0x1db)]({'where':{'id':_0x360b1c['id']},'data':_0x46c930});if(_0x4e2ccc['status']===_0x1bad07(0x20e)&&_0x360b1c[_0x1bad07(0x22c)]!=='PAID'){console[_0x1bad07(0x1d6)]('üìà\x20[COINTOPAY]\x20Payment\x20'+_0x360b1c['id']+'\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link');const _0x1066c9=await database_1[_0x1bad07(0x1a8)][_0x1bad07(0x17f)][_0x1bad07(0x15e)]({'where':{'id':_0x360b1c['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x1066c9?.[_0x1bad07(0x1aa)]&&_0x1066c9[_0x1bad07(0x212)])try{const _0x18dc2d=_0x1066c9[_0x1bad07(0x212)];console[_0x1bad07(0x1d6)](_0x1bad07(0x1ea)+_0x18dc2d['id']+_0x1bad07(0x22e)+_0x18dc2d['type']+_0x1bad07(0x22f)+_0x18dc2d[_0x1bad07(0x1bf)]+',\x20status='+_0x18dc2d[_0x1bad07(0x22c)]);const _0x2784de=_0x18dc2d[_0x1bad07(0x1bf)]+0x1,_0x293ea6=_0x18dc2d[_0x1bad07(0x1b8)]===_0x1bad07(0x135)?'COMPLETED':_0x18dc2d[_0x1bad07(0x22c)];await database_1[_0x1bad07(0x1a8)][_0x1bad07(0x212)][_0x1bad07(0x1db)]({'where':{'id':_0x18dc2d['id']},'data':{'currentPayments':_0x2784de,'status':_0x293ea6,'updatedAt':new Date()}}),console['log']('‚úÖ\x20[COINTOPAY]\x20Payment\x20link\x20'+_0x18dc2d['id']+_0x1bad07(0x222)+_0x18dc2d[_0x1bad07(0x1bf)]+_0x1bad07(0x150)+_0x2784de+_0x1bad07(0x1e5)+_0x18dc2d['status']+_0x1bad07(0x150)+_0x293ea6);}catch(_0x120a6b){console[_0x1bad07(0x21b)](_0x1bad07(0x1fe),_0x120a6b);}else console[_0x1bad07(0x1d6)](_0x1bad07(0x175)+_0x360b1c['id']+_0x1bad07(0x187));}await database_1[_0x1bad07(0x1a8)]['webhookLog']['create']({'data':{'paymentId':_0x360b1c['id'],'shopId':_0x360b1c[_0x1bad07(0x1cd)],'event':_0x1bad07(0x12e)+_0x4e2ccc[_0x1bad07(0x22c)][_0x1bad07(0x142)](),'statusCode':0xc8,'responseBody':JSON[_0x1bad07(0x217)]({'oldStatus':_0x360b1c[_0x1bad07(0x22c)],'newStatus':_0x4e2ccc[_0x1bad07(0x22c)],'paymentDetails':_0x4e2ccc['paymentDetails'],'checkedAt':new Date()['toISOString']()})}}),await this[_0x1bad07(0x230)](_0x360b1c,_0x4e2ccc[_0x1bad07(0x22c)]),await this[_0x1bad07(0x1ef)](_0x360b1c,_0x4e2ccc[_0x1bad07(0x22c)]),_0x4e2ccc[_0x1bad07(0x22c)]!==_0x1bad07(0x1a3)&&(console[_0x1bad07(0x1d6)](_0x1bad07(0x194)+_0x360b1c['id']+_0x1bad07(0x14d)+_0x4e2ccc[_0x1bad07(0x22c)]+',\x20clearing\x20individual\x20timers'),this['clearPaymentTimers'](_0x360b1c['id'])),console['log']('‚úÖ\x20[CHECK]\x20Payment\x20'+_0x360b1c['id']+_0x1bad07(0x185));}else console['log'](_0x1bad07(0x239)+_0x360b1c['id']+_0x1bad07(0x1ab)+_0x4e2ccc[_0x1bad07(0x22c)]+')'),this[_0x1bad07(0x155)](_0x360b1c['id'],_0x360b1c['gatewayPaymentId'],_0x360b1c[_0x1bad07(0x22c)],_0x4e2ccc[_0x1bad07(0x22c)],'status_check',{'statusUnchanged':!![],'paymentDetails':_0x4e2ccc[_0x1bad07(0x1d1)],'amount':_0x4e2ccc['amount'],'currency':_0x4e2ccc[_0x1bad07(0x206)],'shopId':_0x360b1c[_0x1bad07(0x1cd)],'checkTimestamp':new Date()[_0x1bad07(0x171)]()});}catch(_0xfb299e){console['error'](_0x1bad07(0x1c6)+_0x360b1c['id']+':',_0xfb299e),this[_0x1bad07(0x20c)](_0x360b1c['id'],_0x360b1c[_0x1bad07(0x233)],_0xfb299e,'status_check',{'paymentAmount':_0x360b1c[_0x1bad07(0x1ed)],'paymentCurrency':_0x360b1c['currency'],'shopId':_0x360b1c['shopId'],'createdAt':_0x360b1c[_0x1bad07(0x1c1)]}),await database_1['default'][_0x1bad07(0x145)]['create']({'data':{'paymentId':_0x360b1c['id'],'shopId':_0x360b1c[_0x1bad07(0x1cd)],'event':_0x1bad07(0x128),'statusCode':0x1f4,'responseBody':JSON[_0x1bad07(0x217)]({'error':_0xfb299e instanceof Error?_0xfb299e[_0x1bad07(0x153)]:_0x1bad07(0x1c9),'gatewayPaymentId':_0x360b1c[_0x1bad07(0x233)],'checkedAt':new Date()[_0x1bad07(0x171)]()})}});}}async[a57_0x2ff739(0x230)](_0x42f9dc,_0x1902cb){const _0xd7d577=a57_0x2ff739,_0x4fdbdb=Date[_0xd7d577(0x16b)]();try{const _0xe55df2=_0x42f9dc[_0xd7d577(0x1e0)],_0xd6b630=_0xe55df2[_0xd7d577(0x1f5)];if(!_0xd6b630?.['webhookUrl']){console[_0xd7d577(0x1d6)](_0xd7d577(0x129)+_0xe55df2['id']);return;}const _0x19cd8a=_0x1902cb===_0xd7d577(0x20e)?_0xd7d577(0x211):_0x1902cb==='FAILED'?_0xd7d577(0x227):_0x1902cb===_0xd7d577(0x21a)?_0xd7d577(0x227):_0xd7d577(0x186);if(!_0xd6b630[_0xd7d577(0x167)]?.['includes'](_0x19cd8a)){console[_0xd7d577(0x1d6)](_0xd7d577(0x216)+_0x19cd8a+_0xd7d577(0x203)+_0xe55df2['id']);return;}const _0x54b837=(0x0,gateway_1[_0xd7d577(0x20a)])(_0x42f9dc[_0xd7d577(0x17d)])||_0x42f9dc[_0xd7d577(0x17d)],_0x119052={'event':_0x19cd8a,'payment':{'id':_0x42f9dc['id'],'order_id':_0x42f9dc[_0xd7d577(0x240)],'gateway_order_id':_0x42f9dc[_0xd7d577(0x1e3)],'gateway':_0x54b837,'amount':_0x42f9dc[_0xd7d577(0x1ed)],'currency':_0x42f9dc[_0xd7d577(0x206)],'status':_0x1902cb[_0xd7d577(0x142)](),'customer_email':_0x42f9dc[_0xd7d577(0x1cc)],'customer_name':_0x42f9dc[_0xd7d577(0x14e)],'created_at':_0x42f9dc[_0xd7d577(0x1c1)],'updated_at':new Date()}},_0x252c37=JSON[_0xd7d577(0x217)](_0x119052),_0x2231f0=crypto_1[_0xd7d577(0x1a8)][_0xd7d577(0x125)](_0xd7d577(0x201),_0x42f9dc[_0xd7d577(0x1e0)][_0xd7d577(0x192)])[_0xd7d577(0x1db)](_0x252c37)[_0xd7d577(0x1c8)](_0xd7d577(0x18f)),_0x308e9a=await fetch(_0xd6b630[_0xd7d577(0x1da)],{'method':_0xd7d577(0x159),'headers':{'Content-Type':'application/json','User-Agent':_0xd7d577(0x22d),'X-Webhook-Signature':_0x2231f0},'body':_0x252c37}),_0x36f75f=Date[_0xd7d577(0x16b)]()-_0x4fdbdb,_0x31daeb=_0x308e9a['ok']?_0xd7d577(0x12d):await _0x308e9a[_0xd7d577(0x1e4)]();loggerService_1[_0xd7d577(0x18b)]['logShopWebhookSent'](_0x42f9dc[_0xd7d577(0x1cd)],_0xd6b630[_0xd7d577(0x1da)],_0x19cd8a,_0x308e9a[_0xd7d577(0x22c)],_0x36f75f,_0x119052),console['log'](_0xd7d577(0x1b9)+_0xd6b630[_0xd7d577(0x1da)]+_0xd7d577(0x18a)+_0x308e9a['status']+'\x20('+_0x36f75f+'ms)');}catch(_0x13b2fb){console[_0xd7d577(0x21b)](_0xd7d577(0x226),_0x13b2fb),loggerService_1[_0xd7d577(0x18b)][_0xd7d577(0x1c7)](_0x42f9dc[_0xd7d577(0x1cd)],_0x42f9dc[_0xd7d577(0x1e0)]?.[_0xd7d577(0x1f5)]?.[_0xd7d577(0x1da)]||'unknown','webhook_send',_0x13b2fb,{});}}async[a57_0x2ff739(0x1ef)](_0x428509,_0x4b9cdd){const _0x526f59=a57_0x2ff739;try{const _0x3f7564={'PENDING':'created','PAID':_0x526f59(0x133),'FAILED':_0x526f59(0x220),'EXPIRED':_0x526f59(0x162)},_0x427a60=_0x3f7564[_0x4b9cdd];if(!_0x427a60||_0x427a60==='created')return;await telegramBotService_1[_0x526f59(0x1a1)]['sendPaymentNotification'](_0x428509[_0x526f59(0x1cd)],_0x428509,_0x427a60);}catch(_0x5914a3){console[_0x526f59(0x21b)](_0x526f59(0x1fd),_0x5914a3);}}async[a57_0x2ff739(0x169)](_0x25c933){const _0x10c6cf=a57_0x2ff739;console[_0x10c6cf(0x1d6)](_0x10c6cf(0x14f)+_0x25c933);const _0x5bac48=await database_1[_0x10c6cf(0x1a8)][_0x10c6cf(0x17f)][_0x10c6cf(0x15e)]({'where':{'id':_0x25c933},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x5bac48)throw new Error(_0x10c6cf(0x19b));if(_0x5bac48[_0x10c6cf(0x17d)]!=='cointopay'&&_0x5bac48['gateway']!=='cointopay2')throw new Error(_0x10c6cf(0x213));console[_0x10c6cf(0x1d6)](_0x10c6cf(0x154)+_0x5bac48[_0x10c6cf(0x17d)]+_0x10c6cf(0x166)+_0x25c933),await this[_0x10c6cf(0x1b3)](_0x5bac48),console[_0x10c6cf(0x1d6)](_0x10c6cf(0x236)+_0x25c933);}[a57_0x2ff739(0x1a2)](){const _0x2422b8=a57_0x2ff739,_0xb563f3=this['globalCheckInterval']?this['GLOBAL_CHECK_INTERVAL_MS']:undefined,_0x5b71d8=Array[_0x2422b8(0x16e)](this[_0x2422b8(0x209)]['values']())[_0x2422b8(0x1b5)](_0x4f00e6=>({'paymentId':_0x4f00e6[_0x2422b8(0x20d)],'gatewayPaymentId':_0x4f00e6[_0x2422b8(0x233)],'createdAt':_0x4f00e6[_0x2422b8(0x1c1)],'timersCount':_0x4f00e6['timers'][_0x2422b8(0x23d)]}));return{'isActive':!!this['globalCheckInterval'],'globalCheckIntervalMinutes':this[_0x2422b8(0x218)]/(0x3e8*0x3c),'expiryDays':this[_0x2422b8(0x23f)],'activeIndividualTimers':this[_0x2422b8(0x209)][_0x2422b8(0x1c0)],'nextGlobalCheckIn':_0xb563f3,'paymentTimersDetails':_0x5b71d8};}['getPaymentTimerInfo'](_0x287c40){const _0x291f0e=a57_0x2ff739,_0x369d67=this['paymentTimers'][_0x291f0e(0x1c2)](_0x287c40);if(_0x369d67)return{'hasTimers':!![],'timersCount':_0x369d67[_0x291f0e(0x19a)][_0x291f0e(0x23d)],'createdAt':_0x369d67[_0x291f0e(0x1c1)],'gatewayPaymentId':_0x369d67[_0x291f0e(0x233)]};return{'hasTimers':![]};}async['getGatewayCommission'](_0x1bfc22,_0x3bdcd1){const _0x364172=a57_0x2ff739;try{const _0xa47108=await database_1['default']['shop'][_0x364172(0x15e)]({'where':{'id':_0x1bfc22},'select':{'gatewaySettings':!![]}});if(!_0xa47108?.[_0x364172(0x1be)])return console[_0x364172(0x1d6)](_0x364172(0x16c)+_0x1bfc22+_0x364172(0x224)),0xa;const _0x4917ad=JSON[_0x364172(0x158)](_0xa47108['gatewaySettings']);for(const [_0x1cbdc4,_0x406dd2]of Object[_0x364172(0x19e)](_0x4917ad)){if(_0x1cbdc4[_0x364172(0x142)]()===_0x3bdcd1[_0x364172(0x142)]()){const _0x12d445=_0x406dd2[_0x364172(0x137)]||0xa;return console[_0x364172(0x1d6)]('Gateway\x20'+_0x3bdcd1+'\x20commission\x20for\x20shop\x20'+_0x1bfc22+':\x20'+_0x12d445+'%'),_0x12d445;}}return console['log']('No\x20specific\x20commission\x20found\x20for\x20gateway\x20'+_0x3bdcd1+_0x364172(0x173)+_0x1bfc22+_0x364172(0x123)),0xa;}catch(_0x47d1a0){return console[_0x364172(0x21b)]('Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20'+_0x1bfc22+_0x364172(0x196)+_0x3bdcd1+':',_0x47d1a0),0xa;}}}function a57_0xd4c7(){const _0x39a303=['sendShopWebhook','üìä\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','\x20expired\x20CoinToPay\x20payments','gatewayPaymentId','\x20\x20\x20üìç\x20Source:\x20','‚ö†Ô∏è\x20[CHECK]\x20Payment\x20','‚úÖ\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','set','‚úÖ\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','üìä\x20[CHECK]\x20Payment\x20','\x20current\x20status:\x20','\x20found:','\x20expired','length','597714OjDGsJ','EXPIRY_DAYS','orderId','CoinToPay2Service',',\x20using\x20default\x2010%','üí∞\x20[CHECK]\x20Payment\x20','createHmac','‚úÖ\x20[CHECK]\x20Payment\x20','‚è∞\x20[EXPIRY]\x20Payment\x20','cointopay_status_check_error','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','\x20\x20\x20üìÖ\x20Time:\x20','üõë\x20[SHUTDOWN]\x20Cleared\x20','coinToPayService','Success','cointopay_status_check_','getTime','paidAt','ü™ô\x20[GLOBAL]\x20Found\x20','iban','paid','2529KDDNPs','SINGLE','\x20in\x20','commission','includes','\x20\x20\x20-\x20Status:\x20','floor','push','ü™ô\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','toFixed','‚ö†Ô∏è\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','\x20\x20\x20‚ùå\x20Error:\x20','‚ùå\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','\x20marked\x20as\x20paid\x20at:\x20','toLowerCase','16xhfZXU','convertToUSDT','webhookLog','delay','checkExpiredPayments','amountUSDT','\x20completed\x20for\x20payment\x20','‚è∞\x20[HOURLY]\x20Payment\x20','schedule_created','\x20not\x20found,\x20clearing\x20timers','\x20status\x20changed\x20to\x20','customerName','üîç\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','\x20->\x20','\x20days\x20(created\x20before\x20','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','message','‚úÖ\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','logCoinToPayStatus','‚ùå\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','\x20triggered\x20for\x20payment\x20','parse','POST','./telegramBotService','defineProperty','schedulePaymentChecks','9362740XzeZjC','findUnique','\x20to\x20clear',',\x20stopping\x20individual\x20checks','2\x20minutes','expired','coinToPay2Service','ü™ô\x20[TIMER]\x20Individual\x20check\x20#','.\x20Remaining\x20active\x20timers:\x20','\x20payment\x20','webhookEvents','confirmedOn','checkPaymentById','findMany','now','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','checkAllPendingPayments','from','./gateways/coinToPay2Service','\x20for\x20payment\x20','toISOString','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','\x20in\x20shop\x20','\x20\x20\x20-\x20Gateway:\x20','üìà\x20[COINTOPAY]\x20Payment\x20','not\x20found','../config/database','üõë\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','‚úÖ\x20[HOURLY]\x20Payment\x20','ü™ô\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','clearPaymentTimers','checkSinglePaymentById','gateway','üßπ\x20[DEBUG]\x20Clearing\x20','payment','\x20\x20\x20-\x20paymentId:\x20','‚è∞\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','\x20status\x20from\x20','getDate','6020Pggulz','\x20updated\x20successfully','payment.pending','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','‚úÖ\x20[EXPIRY]\x20Payment\x20','create','\x20with\x20status\x20','loggerService','status_check','COINTOPAY_STATUS_CHANGE','delete','hex','remitterIban','\x20is\x20too\x20new\x20(','secretKey','unknown','üßπ\x20[CHECK]\x20Payment\x20','COINTOPAY_ERROR',',\x20gateway\x20','\x20\x20\x20-\x20ShopId:\x20','ü™ô\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','\x20pending\x20CoinToPay\x20payments','timers','Payment\x20not\x20found','üîç\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','üîç\x20[CHECK]\x20Checking\x20','entries','timestamp','ü™ô\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','telegramBotService','getServiceStats','PENDING','startPeriodicStatusCheck','checkPaymentStatus','currencyService','‚ùå\x20[HOURLY]\x20Payment\x20','default','\x20not\x20found\x20in\x20database','paymentLinkId','\x20status\x20unchanged\x20(','\x20\x20\x20-\x20GatewayPaymentId:\x20','\x20\x20\x20üìä\x20Status:\x20','5003703NtqABP','ü™ô\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','auto_expire','cointopay2','‚ùå\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','checkSinglePayment','\x20status:\x20','map','442060LkBZMM','./loggerService','type','Shop\x20webhook\x20sent\x20to\x20','\x20days,\x20marking\x20as\x20EXPIRED','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','\x20status\x20is\x20','\x20commission:\x20','gatewaySettings','currentPayments','size','createdAt','get','üìä\x20[HOURLY]\x20Payment\x20','\x20\x20\x20Amount\x20after\x20commission:\x20','\x20timers\x20for\x20payment\x20','‚ùå\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','logShopWebhookError','digest','Unknown\x20error','üè¶\x20[CHECK]\x20Bank\x20details\x20provided:\x20','‚úÖ\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','customerEmail','shopId','\x20\x20\x20-\x20Amount:\x20','üõë\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','globalCheckInterval','paymentDetails','750654FEyecd','‚è∞\x20[GLOBAL]\x20Found\x20','\x20\x20\x20-\x20gatewayPaymentId:\x20','crypto','log','\x20USDT','\x20has\x20no\x20gatewayPaymentId,\x20skipping','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','webhookUrl','update','3775142maEHDd','1\x20minute','__importDefault','not\x20confirmed','shop','transactionId','getGatewayCommission','gatewayOrderId','text',',\x20status=','ü™ô\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','./currencyService','\x20amounts\x20calculated:','CoinToPayStatusService','üìà\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','üÜî\x20[CHECK]\x20Transaction\x20ID:\x20','h),\x20skipping\x20global\x20check','amount','üìä\x20[CHECK]\x20CoinToPay\x20payment\x20','sendPaymentStatusNotification','20oJiHom','-day\x20timeout','Failed\x20to\x20mark\x20payment\x20as\x20expired','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','has','settings','\x20details:','\x20\x20\x20Gateway\x20','CoinToPayService','üßπ\x20[DEBUG]\x20Cleared\x20timer\x20#','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','Payment\x20older\x20than\x20','createdOn','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','‚ùå\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','‚ùå\x20[TIMER]\x20Failed\x20individual\x20check\x20#','cointopay_auto_expired','sha256','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','\x20not\x20enabled\x20for\x20shop\x20','\x20(after\x20','\x20individual\x20payment\x20timers','currency','ü™ô\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','‚ùå\x20[CHECK]\x20Payment\x20','paymentTimers','getGatewayIdByName','\x20\x20\x20üìù\x20Details:','logCoinToPayError','paymentId','PAID','forEach','coinToPayStatusService','payment.success','paymentLink','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','‚úÖ\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','\x20is\x20older\x20than\x20','Webhook\x20event\x20','stringify','GLOBAL_CHECK_INTERVAL_MS','bankDetails','EXPIRED','error','cointopay','stopPeriodicStatusCheck','setDate','‚è∞\x20[GLOBAL]\x20Payment\x20','failed','\x20has\x20no\x20gatewayPaymentId','\x20updated:\x20currentPayments=','catch',',\x20using\x20default\x20commission\x2010%','\x20(age:\x20','Failed\x20to\x20send\x20shop\x20webhook:','payment.failed','ü™ô\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','./gateways/coinToPayService','‚úÖ\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','description','status','Payment\x20System/1.0',':\x20type=',',\x20currentPayments='];a57_0xd4c7=function(){return _0x39a303;};return a57_0xd4c7();}exports[a57_0x2ff739(0x1e9)]=CoinToPayStatusService,exports[a57_0x2ff739(0x210)]=new CoinToPayStatusService();