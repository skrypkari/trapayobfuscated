'use strict';function a57_0x5a65(){const _0x1086b8=['‚è∞\x20[GLOBAL]\x20Found\x20','commission','No\x20specific\x20commission\x20found\x20for\x20gateway\x20','checkSinglePaymentById','stopPeriodicStatusCheck','delete','./gateways/coinToPay2Service','\x20\x20\x20-\x20ShopId:\x20','‚úÖ\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','\x20timers\x20for\x20payment\x20','SINGLE','gatewayOrderId','logCoinToPayStatus','cointopay_status_check_error','paidAt','PENDING','Payment\x20not\x20found','push','globalCheckInterval','confirmedOn','\x20has\x20no\x20gatewayPaymentId','\x20status\x20unchanged\x20(','\x20current\x20status:\x20','‚úÖ\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','findMany','log','\x20status\x20is\x20','‚úÖ\x20[DEBUG]\x20Successfully\x20scheduled\x20','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','\x20marked\x20as\x20paid\x20at:\x20','../types/gateway','\x20seconds\x20(','paid','toLowerCase','auto_expire','\x20\x20\x20üìç\x20Source:\x20','üîç\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','loggerService','\x20\x20\x20-\x20GatewayPaymentId:\x20','unknown','üßπ\x20[DEBUG]\x20Clearing\x20','‚ùå\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','ü™ô\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','webhookLog','iban','FAILED','paymentTimers','\x20\x20\x20-\x20gatewayPaymentId:\x20','üìä\x20[CHECK]\x20CoinToPay\x20payment\x20','1352536tvamaj','POST','\x20USDT','telegramBotService','logCoinToPayError','remitterIban','\x20\x20\x20üìä\x20Status:\x20','\x20not\x20found,\x20clearing\x20timers','ü™ô\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','floor','CoinToPay2Service','1590920sGtPYV','payment.success','forEach','Failed\x20to\x20mark\x20payment\x20as\x20expired','status_check','cointopay2','toFixed','üîç\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','getGatewayCommission','ü™ô\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','bankDetails','paymentId','üìä\x20[HOURLY]\x20Payment\x20','339972VdTLMD','ms)','clearPaymentTimers','logShopWebhookSent','‚ùå\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','\x20(after\x20','message','currentPayments','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','5\x20minutes','includes','shopId','startPeriodicStatusCheck','\x20found:','webhookEvents','entries','schedule_created','\x20\x20\x20Amount:\x20','\x20updated:\x20currentPayments=','‚úÖ\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','gatewaySettings','\x20\x20\x20‚ùå\x20Error:\x20','Webhook\x20event\x20','description',':\x20type=','length','payment.failed','2\x20minutes','transactionId','‚è∞\x20[EXPIRY]\x20Payment\x20','‚úÖ\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','‚ö†Ô∏è\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','catch','\x20skipped,\x20','values','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','findUnique','Unknown\x20error','\x20updated\x20successfully','‚úÖ\x20[CHECK]\x20Payment\x20','6DQefUU','settings','\x20expired','\x20not\x20found\x20in\x20database','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20',',\x20gateway\x20','createdAt','setDate','Payment\x20older\x20than\x20','GLOBAL_CHECK_INTERVAL_MS','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','./loggerService','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','\x20\x20\x20-\x20Amount:\x20','ü™ô\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','‚ö†Ô∏è\x20[CHECK]\x20Payment\x20','\x20->\x20','üßπ\x20[DEBUG]\x20Cleared\x20timer\x20#','üí∞\x20[CHECK]\x20Payment\x20','COINTOPAY_ERROR','\x20payment\x20','‚è∞\x20[HOURLY]\x20Payment\x20','shop','üõë\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','\x20\x20\x20-\x20Status:\x20','\x20\x20\x20Gateway\x20','not\x20confirmed','toISOString','payment','coinToPayService','\x20(age:\x20','customerEmail','üè¶\x20[CHECK]\x20Bank\x20details\x20provided:\x20','\x20to\x20','\x20details:','now',',\x20stopping\x20individual\x20checks','__esModule','\x20\x20\x20üìù\x20Details:','created','CoinToPayService','./telegramBotService','status','ü™ô\x20[TIMER]\x20Individual\x20check\x20#','currency','getServiceStats','coinToPay2Service','\x20is\x20valid\x20for\x20checking,\x20proceeding...','logShopWebhookError','Payment\x20System/1.0','ü™ô\x20[ERROR]\x20CoinToPay\x20Error:\x20','\x20is\x20older\x20than\x20','stringify','coinToPayStatusService','Gateway\x20','gatewayCommissionRate','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','getTime','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','‚ùå\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','set','checkAllPendingPayments','EXPIRY_DAYS','defineProperty','checkSinglePayment','paymentLinkId','default','sendShopWebhook','\x20\x20\x20-\x20paymentId:\x20','Failed\x20to\x20send\x20shop\x20webhook:','üîç\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','‚úÖ\x20[TIMER]\x20Individual\x20check\x20#','\x20\x20\x20üìÖ\x20Time:\x20','getGatewayIdByName','failed','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','sha256','logWhiteDomainError','9062360KeHzDl','CoinToPayStatusService','1025724pwSWvj','\x20days','\x20expired\x20CoinToPay\x20payments','\x20\x20\x20üìù\x20Context:','./currencyService','2147905TdqBzc','has','amount','üìä\x20[CHECK]\x20Payment\x20','\x20\x20\x20-\x20Gateway:\x20','3558800dfMVHS','-day\x20timeout','1\x20minute','get','gatewayPaymentId','payment.pending','paymentDetails','orderId','getPaymentTimerInfo','sendPaymentStatusNotification','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','update','/status/','cointopay','\x20individual\x20payment\x20timers','stack','üîç\x20[CHECK]\x20Checking\x20','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','type','‚úÖ\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','create','ü™ô\x20[DEBUG]\x20Creating\x20','PAID','\x20status\x20changed\x20to\x20','createHmac','‚úÖ\x20[HOURLY]\x20Payment\x20','not\x20found','‚ùå\x20[HOURLY]\x20Payment\x20','webhookUrl','üõë\x20[SHUTDOWN]\x20Cleared\x20','h),\x20skipping\x20global\x20check','convertToUSDT',',\x20using\x20default\x20commission\x2010%','__importDefault','‚úÖ\x20[COINTOPAY]\x20Payment\x20link\x20','üîÑ\x20[CHECK]\x20Updating\x20payment\x20','‚úÖ\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20',',\x20using\x20default\x2010%','amountUSDT','webhook_send','‚ùå\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','\x20completed\x20for\x20payment\x20','paymentLink','üìà\x20[COINTOPAY]\x20Payment\x20',',\x20status=','secretKey','size','COMPLETED','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','ü™ô\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','\x20with\x20status\x20','‚è∞\x20[GLOBAL]\x20Payment\x20','\x20to\x20clear','\x20for\x20payment\x20','\x20initial\x20timers\x20for\x20payment\x20','ü™ô\x20[GLOBAL]\x20Found\x20','cointopay_auto_expired','‚ùå\x20[CHECK]\x20Payment\x20','timers','\x20is\x20too\x20new\x20(','error','digest','EXPIRED','\x20commission\x20for\x20shop\x20','text','getDate','\x20status:\x20','\x20days,\x20marking\x20as\x20EXPIRED','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','gateway','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','\x20status\x20from\x20','\x20amounts\x20calculated:','cointopay_status_check_'];a57_0x5a65=function(){return _0x1086b8;};return a57_0x5a65();}const a57_0x538a7f=a57_0x5b2a;function a57_0x5b2a(_0x346699,_0x4c1957){_0x346699=_0x346699-0xfc;const _0x5a6503=a57_0x5a65();let _0x5b2a81=_0x5a6503[_0x346699];return _0x5b2a81;}(function(_0x541ac6,_0x42c2c9){const _0x17df91=a57_0x5b2a,_0x15539c=_0x541ac6();while(!![]){try{const _0x1097e9=-parseInt(_0x17df91(0x150))/0x1+parseInt(_0x17df91(0x138))/0x2+parseInt(_0x17df91(0x1c8))/0x3+-parseInt(_0x17df91(0x143))/0x4+parseInt(_0x17df91(0x1cd))/0x5*(-parseInt(_0x17df91(0x178))/0x6)+-parseInt(_0x17df91(0x1d2))/0x7+parseInt(_0x17df91(0x1c6))/0x8;if(_0x1097e9===_0x42c2c9)break;else _0x15539c['push'](_0x15539c['shift']());}catch(_0x464ddd){_0x15539c['push'](_0x15539c['shift']());}}}(a57_0x5a65,0x74098));var __importDefault=this&&this[a57_0x538a7f(0x1f3)]||function(_0x1348a3){const _0x4fcd64=a57_0x538a7f;return _0x1348a3&&_0x1348a3[_0x4fcd64(0x19d)]?_0x1348a3:{'default':_0x1348a3};};Object[a57_0x538a7f(0x1b7)](exports,'__esModule',{'value':!![]}),exports[a57_0x538a7f(0x1ad)]=exports[a57_0x538a7f(0x1c7)]=void 0x0;const crypto_1=__importDefault(require('crypto')),coinToPayService_1=require('./gateways/coinToPayService'),coinToPay2Service_1=require(a57_0x538a7f(0x10d)),gateway_1=require(a57_0x538a7f(0x125)),database_1=__importDefault(require('../config/database')),telegramBotService_1=require(a57_0x538a7f(0x1a1)),loggerService_1=require(a57_0x538a7f(0x183)),currencyService_1=require(a57_0x538a7f(0x1cc));class CoinToPayStatusService{constructor(){const _0x461fe7=a57_0x538a7f;this[_0x461fe7(0x119)]=null,this['GLOBAL_CHECK_INTERVAL_MS']=0x3c*0x3c*0x3e8,this[_0x461fe7(0x1b6)]=0x5,this['paymentTimers']=new Map(),this[_0x461fe7(0x195)]=new coinToPayService_1[(_0x461fe7(0x1a0))](),this[_0x461fe7(0x1a6)]=new coinToPay2Service_1[(_0x461fe7(0x142))](),console[_0x461fe7(0x120)](_0x461fe7(0x203));}['schedulePaymentChecks'](_0x42020a,_0x125c8f){const _0x1e915d=a57_0x538a7f;console[_0x1e915d(0x120)](_0x1e915d(0x186)),console[_0x1e915d(0x120)](_0x1e915d(0x1bc)+_0x42020a),console[_0x1e915d(0x120)](_0x1e915d(0x136)+_0x125c8f),this[_0x1e915d(0x152)](_0x42020a);const _0x3f2e09=[],_0x475ed9=new Date(),_0x1cfc2a=[{'delay':0x1*0x3c*0x3e8,'description':_0x1e915d(0x1d4)},{'delay':0x2*0x3c*0x3e8,'description':_0x1e915d(0x16b)},{'delay':0x5*0x3c*0x3e8,'description':_0x1e915d(0x159)},{'delay':0x5*0x3c*0x3e8,'description':_0x1e915d(0x159)}];console['log'](_0x1e915d(0x1e7)+_0x1cfc2a['length']+_0x1e915d(0x208)+_0x42020a);let _0x368aa5=0x0;_0x1cfc2a[_0x1e915d(0x145)]((_0x4132e0,_0x4016f9)=>{const _0x540100=_0x1e915d;_0x368aa5+=_0x4132e0['delay'];const _0x1a9181=setTimeout(async()=>{const _0x431224=a57_0x5b2a;console[_0x431224(0x120)](_0x431224(0x1a3)+(_0x4016f9+0x1)+'\x20triggered\x20for\x20payment\x20'+_0x42020a+_0x431224(0x155)+_0x4132e0['description']+')');try{await this[_0x431224(0x10a)](_0x42020a),console['log'](_0x431224(0x1bf)+(_0x4016f9+0x1)+_0x431224(0x1fb)+_0x42020a);}catch(_0x1e490f){console[_0x431224(0x20e)]('‚ùå\x20[TIMER]\x20Failed\x20individual\x20check\x20#'+(_0x4016f9+0x1)+_0x431224(0x207)+_0x42020a+':',_0x1e490f),this[_0x431224(0x13c)](_0x42020a,_0x125c8f,_0x1e490f,_0x431224(0x147),{'checkNumber':_0x4016f9+0x1,'scheduledAfter':_0x4132e0[_0x431224(0x167)],'isIndividualCheck':!![]});}},_0x368aa5);_0x3f2e09[_0x540100(0x118)](_0x1a9181),console[_0x540100(0x120)]('‚è∞\x20[DEBUG]\x20Scheduled\x20check\x20#'+(_0x4016f9+0x1)+'\x20for\x20payment\x20'+_0x42020a+'\x20in\x20'+_0x368aa5/0x3e8+_0x540100(0x126)+_0x4132e0[_0x540100(0x167)]+')');});const _0x298119=setInterval(async()=>{const _0x1f9eca=_0x1e915d;console['log'](_0x1f9eca(0x140)+_0x42020a);try{const _0x3c0850=await database_1[_0x1f9eca(0x1ba)][_0x1f9eca(0x194)][_0x1f9eca(0x174)]({'where':{'id':_0x42020a},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x3c0850){console['log'](_0x1f9eca(0x1ed)+_0x42020a+_0x1f9eca(0x13f)),this[_0x1f9eca(0x152)](_0x42020a);return;}console['log'](_0x1f9eca(0x14f)+_0x42020a+_0x1f9eca(0x11d)+_0x3c0850[_0x1f9eca(0x1a2)]);if(_0x3c0850['status']!==_0x1f9eca(0x116)){console[_0x1f9eca(0x120)](_0x1f9eca(0x1eb)+_0x42020a+_0x1f9eca(0x121)+_0x3c0850['status']+_0x1f9eca(0x19c)),this['clearPaymentTimers'](_0x42020a);return;}const _0x5bc77a=Math[_0x1f9eca(0x141)]((Date[_0x1f9eca(0x19b)]()-_0x3c0850['createdAt'][_0x1f9eca(0x1b1)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x5bc77a>=this[_0x1f9eca(0x1b6)]){console['log'](_0x1f9eca(0x18d)+_0x42020a+_0x1f9eca(0x1ab)+this['EXPIRY_DAYS']+_0x1f9eca(0x158)),this[_0x1f9eca(0x152)](_0x42020a);return;}await this[_0x1f9eca(0x10a)](_0x42020a),console['log'](_0x1f9eca(0x10f)+_0x42020a);}catch(_0x1fa1c1){console['error'](_0x1f9eca(0x1fa)+_0x42020a+':',_0x1fa1c1),this[_0x1f9eca(0x13c)](_0x42020a,_0x125c8f,_0x1fa1c1,_0x1f9eca(0x147),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x3f2e09[_0x1e915d(0x118)](_0x298119),this[_0x1e915d(0x135)][_0x1e915d(0x1b4)](_0x42020a,{'timers':_0x3f2e09,'paymentId':_0x42020a,'gatewayPaymentId':_0x125c8f,'createdAt':_0x475ed9}),console[_0x1e915d(0x120)](_0x1e915d(0x122)+_0x1cfc2a[_0x1e915d(0x169)]+_0x1e915d(0x123)+_0x42020a),console[_0x1e915d(0x120)]('üìä\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20'+this[_0x1e915d(0x135)][_0x1e915d(0x200)]),this[_0x1e915d(0x113)](_0x42020a,_0x125c8f,_0x1e915d(0x116),'PENDING','status_check',{'action':_0x1e915d(0x160),'scheduledChecks':_0x1cfc2a[_0x1e915d(0x169)],'firstCheckIn':_0x1cfc2a[0x0]['delay']/0x3e8,'totalTimers':this['paymentTimers'][_0x1e915d(0x200)]});}[a57_0x538a7f(0x152)](_0x393617){const _0x14cd86=a57_0x538a7f,_0x2e74d4=this[_0x14cd86(0x135)]['get'](_0x393617);_0x2e74d4?(console['log'](_0x14cd86(0x12f)+_0x2e74d4[_0x14cd86(0x20c)][_0x14cd86(0x169)]+_0x14cd86(0x110)+_0x393617),_0x2e74d4[_0x14cd86(0x20c)]['forEach']((_0x494674,_0x56a4f0)=>{const _0x56f360=_0x14cd86;_0x494674&&(clearTimeout(_0x494674),clearInterval(_0x494674),console['log'](_0x56f360(0x189)+(_0x56a4f0+0x1)+_0x56f360(0x207)+_0x393617));}),this['paymentTimers'][_0x14cd86(0x10c)](_0x393617),console['log'](_0x14cd86(0x1e5)+_0x393617+'.\x20Remaining\x20active\x20timers:\x20'+this['paymentTimers'][_0x14cd86(0x200)])):console[_0x14cd86(0x120)](_0x14cd86(0x16f)+_0x393617+_0x14cd86(0x206));}async['checkSinglePaymentById'](_0x5c8ce1){const _0x1ea3fa=a57_0x538a7f;console[_0x1ea3fa(0x120)](_0x1ea3fa(0x1be)+_0x5c8ce1);const _0x491ea7=await database_1['default'][_0x1ea3fa(0x194)][_0x1ea3fa(0x174)]({'where':{'id':_0x5c8ce1},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x491ea7){console[_0x1ea3fa(0x120)](_0x1ea3fa(0x20b)+_0x5c8ce1+_0x1ea3fa(0x17b));return;}console[_0x1ea3fa(0x120)](_0x1ea3fa(0x1d0)+_0x5c8ce1+_0x1ea3fa(0x15d)),console[_0x1ea3fa(0x120)](_0x1ea3fa(0x1d1)+_0x491ea7[_0x1ea3fa(0x102)]),console['log'](_0x1ea3fa(0x190)+_0x491ea7['status']),console[_0x1ea3fa(0x120)](_0x1ea3fa(0x12d)+_0x491ea7[_0x1ea3fa(0x1d6)]),console[_0x1ea3fa(0x120)](_0x1ea3fa(0x185)+_0x491ea7[_0x1ea3fa(0x1cf)]+'\x20'+_0x491ea7[_0x1ea3fa(0x1a4)]),console[_0x1ea3fa(0x120)](_0x1ea3fa(0x10e)+_0x491ea7[_0x1ea3fa(0x15b)]);if(_0x491ea7[_0x1ea3fa(0x102)]!==_0x1ea3fa(0x1df)&&_0x491ea7['gateway']!==_0x1ea3fa(0x148)){console[_0x1ea3fa(0x120)](_0x1ea3fa(0x187)+_0x5c8ce1+_0x1ea3fa(0x1dc)+_0x491ea7[_0x1ea3fa(0x102)]+')');return;}if(_0x491ea7[_0x1ea3fa(0x1a2)]!==_0x1ea3fa(0x116)){console[_0x1ea3fa(0x120)](_0x1ea3fa(0x187)+_0x5c8ce1+_0x1ea3fa(0x121)+_0x491ea7[_0x1ea3fa(0x1a2)]+',\x20stopping\x20individual\x20checks'),this[_0x1ea3fa(0x152)](_0x5c8ce1);return;}if(!_0x491ea7['gatewayPaymentId']){console[_0x1ea3fa(0x120)](_0x1ea3fa(0x187)+_0x5c8ce1+_0x1ea3fa(0x11b));return;}console[_0x1ea3fa(0x120)](_0x1ea3fa(0x177)+_0x5c8ce1+_0x1ea3fa(0x1a7)),await this[_0x1ea3fa(0x1b8)](_0x491ea7);}['logCoinToPayStatus'](_0x27d080,_0x340911,_0x78a42e,_0x23d1ca,_0x565d14,_0x55d107){const _0x2020b8=a57_0x538a7f,_0x51acc3={'type':'COINTOPAY_STATUS_CHANGE','paymentId':_0x27d080,'gatewayPaymentId':_0x340911,'oldStatus':_0x78a42e,'newStatus':_0x23d1ca,'source':_0x565d14,'timestamp':new Date()[_0x2020b8(0x193)](),'details':_0x55d107||{}};loggerService_1[_0x2020b8(0x12c)][_0x2020b8(0x113)](_0x51acc3),console[_0x2020b8(0x120)](_0x2020b8(0x14c)+_0x27d080+'\x20('+_0x340911+')'),console[_0x2020b8(0x120)](_0x2020b8(0x13e)+_0x78a42e+'\x20->\x20'+_0x23d1ca),console[_0x2020b8(0x120)](_0x2020b8(0x12a)+_0x565d14),console[_0x2020b8(0x120)](_0x2020b8(0x1c0)+_0x51acc3['timestamp']),_0x55d107&&console[_0x2020b8(0x120)](_0x2020b8(0x19e),_0x55d107);}[a57_0x538a7f(0x13c)](_0x139f10,_0x278f6c,_0x1a1e37,_0x250457,_0x1e2fff){const _0xd78447=a57_0x538a7f,_0x62f2f6={'type':_0xd78447(0x18b),'paymentId':_0x139f10,'gatewayPaymentId':_0x278f6c,'error':_0x1a1e37 instanceof Error?{'message':_0x1a1e37[_0xd78447(0x156)],'stack':_0x1a1e37[_0xd78447(0x1e1)]}:_0x1a1e37,'source':_0x250457,'timestamp':new Date()['toISOString'](),'context':_0x1e2fff||{}};loggerService_1['loggerService'][_0xd78447(0x13c)](_0x62f2f6),console[_0xd78447(0x20e)](_0xd78447(0x1aa)+_0x139f10+'\x20('+_0x278f6c+')'),console[_0xd78447(0x20e)](_0xd78447(0x165)+(_0x1a1e37 instanceof Error?_0x1a1e37[_0xd78447(0x156)]:_0x1a1e37)),console[_0xd78447(0x20e)]('\x20\x20\x20üìç\x20Source:\x20'+_0x250457),console['error']('\x20\x20\x20üìÖ\x20Time:\x20'+_0x62f2f6['timestamp']),_0x1e2fff&&console[_0xd78447(0x20e)](_0xd78447(0x1cb),_0x1e2fff);}[a57_0x538a7f(0x15c)](){const _0x1d599f=a57_0x538a7f;console[_0x1d599f(0x120)](_0x1d599f(0x131)),this[_0x1d599f(0x1b5)]()[_0x1d599f(0x170)](_0x7529a6=>{const _0x47c01e=_0x1d599f;console[_0x47c01e(0x20e)]('‚ùå\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:',_0x7529a6);}),this[_0x1d599f(0x119)]=setInterval(async()=>{const _0x5acfb3=_0x1d599f;try{console[_0x5acfb3(0x120)]('ü™ô\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...'),await this['checkAllPendingPayments'](),console[_0x5acfb3(0x120)]('‚úÖ\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed');}catch(_0x57590b){console[_0x5acfb3(0x20e)](_0x5acfb3(0x130),_0x57590b);}},this[_0x1d599f(0x181)]),console[_0x1d599f(0x120)](_0x1d599f(0x11e));}[a57_0x538a7f(0x10b)](){const _0x232f58=a57_0x538a7f;console[_0x232f58(0x120)]('üõë\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...');this[_0x232f58(0x119)]&&(clearInterval(this[_0x232f58(0x119)]),this[_0x232f58(0x119)]=null,console[_0x232f58(0x120)](_0x232f58(0x18f)));const _0x327dd8=this[_0x232f58(0x135)][_0x232f58(0x200)];for(const [_0x2e6a1b]of this[_0x232f58(0x135)]){this[_0x232f58(0x152)](_0x2e6a1b);}console['log'](_0x232f58(0x1ef)+_0x327dd8+_0x232f58(0x1e0));}async[a57_0x538a7f(0x1b5)](){const _0x1a7e5e=a57_0x538a7f;try{console[_0x1a7e5e(0x120)]('ü™ô\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...');const _0x2e76d2=await database_1[_0x1a7e5e(0x1ba)][_0x1a7e5e(0x194)][_0x1a7e5e(0x11f)]({'where':{'gateway':{'in':[_0x1a7e5e(0x1df),_0x1a7e5e(0x148)]},'status':'PENDING','gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'secretKey':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console['log'](_0x1a7e5e(0x209)+_0x2e76d2['length']+'\x20pending\x20CoinToPay\x20payments');if(_0x2e76d2['length']===0x0){console[_0x1a7e5e(0x120)]('ü™ô\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check');return;}const _0x1df7de=await this['checkExpiredPayments'](_0x2e76d2);console[_0x1a7e5e(0x120)](_0x1a7e5e(0x107)+_0x1df7de[_0x1a7e5e(0x169)]+_0x1a7e5e(0x1ca));let _0x478c2b=0x0,_0x3a75e8=0x0;for(const _0x5514bb of _0x2e76d2){try{if(_0x1df7de[_0x1a7e5e(0x15a)](_0x5514bb['id'])){console['log']('‚è∞\x20[GLOBAL]\x20Payment\x20'+_0x5514bb['id']+_0x1a7e5e(0x101)),_0x3a75e8++;continue;}if(this[_0x1a7e5e(0x135)][_0x1a7e5e(0x1ce)](_0x5514bb['id'])){console['log'](_0x1a7e5e(0x205)+_0x5514bb['id']+_0x1a7e5e(0x103)),_0x3a75e8++;continue;}const _0x1243ff=(Date[_0x1a7e5e(0x19b)]()-_0x5514bb[_0x1a7e5e(0x17e)][_0x1a7e5e(0x1b1)]())/(0x3e8*0x3c*0x3c);if(_0x1243ff<0x1){console[_0x1a7e5e(0x120)](_0x1a7e5e(0x205)+_0x5514bb['id']+_0x1a7e5e(0x20d)+_0x1243ff['toFixed'](0x1)+_0x1a7e5e(0x1f0)),_0x3a75e8++;continue;}console[_0x1a7e5e(0x120)](_0x1a7e5e(0x12b)+_0x5514bb['id']+_0x1a7e5e(0x196)+_0x1243ff[_0x1a7e5e(0x149)](0x1)+'h)'),await this['checkSinglePayment'](_0x5514bb),_0x478c2b++,await new Promise(_0x1da850=>setTimeout(_0x1da850,0x7d0));}catch(_0x25a5b0){console[_0x1a7e5e(0x20e)](_0x1a7e5e(0x17c)+_0x5514bb['id']+':',_0x25a5b0),this[_0x1a7e5e(0x13c)](_0x5514bb['id'],_0x5514bb[_0x1a7e5e(0x1d6)]||_0x1a7e5e(0x12e),_0x25a5b0,_0x1a7e5e(0x147),{'isGlobalCheck':!![],'paymentAmount':_0x5514bb[_0x1a7e5e(0x1cf)],'paymentCurrency':_0x5514bb['currency'],'shopId':_0x5514bb[_0x1a7e5e(0x15b)],'createdAt':_0x5514bb['createdAt']}),loggerService_1[_0x1a7e5e(0x12c)][_0x1a7e5e(0x1c5)]('cointopay',_0x1a7e5e(0x1de)+_0x5514bb[_0x1a7e5e(0x1d6)],_0x25a5b0);}}console[_0x1a7e5e(0x120)](_0x1a7e5e(0x1e3)+_0x478c2b+'\x20checked,\x20'+_0x3a75e8+_0x1a7e5e(0x171)+_0x1df7de['length']+_0x1a7e5e(0x17a));}catch(_0xa39735){console['error']('‚ùå\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:',_0xa39735);}}async['checkExpiredPayments'](_0x515be2){const _0x58f969=a57_0x538a7f,_0x258e72=[],_0x54b6e0=new Date();_0x54b6e0[_0x58f969(0x17f)](_0x54b6e0[_0x58f969(0xfe)]()-this[_0x58f969(0x1b6)]),console[_0x58f969(0x120)]('‚è∞\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20'+this[_0x58f969(0x1b6)]+'\x20days\x20(created\x20before\x20'+_0x54b6e0['toISOString']()+')');for(const _0x28cdf4 of _0x515be2){if(_0x28cdf4[_0x58f969(0x17e)]<_0x54b6e0){console[_0x58f969(0x120)](_0x58f969(0x16d)+_0x28cdf4['id']+_0x58f969(0x1ab)+this[_0x58f969(0x1b6)]+_0x58f969(0x100));try{this[_0x58f969(0x113)](_0x28cdf4['id'],_0x28cdf4[_0x58f969(0x1d6)]||_0x58f969(0x12e),_0x58f969(0x116),_0x58f969(0x210),_0x58f969(0x129),{'reason':_0x58f969(0x180)+this['EXPIRY_DAYS']+'\x20days','createdAt':_0x28cdf4[_0x58f969(0x17e)],'daysSinceCreation':Math[_0x58f969(0x141)]((Date[_0x58f969(0x19b)]()-_0x28cdf4[_0x58f969(0x17e)][_0x58f969(0x1b1)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x28cdf4['amount'],'paymentCurrency':_0x28cdf4['currency'],'shopId':_0x28cdf4[_0x58f969(0x15b)]}),await database_1['default'][_0x58f969(0x194)]['update']({'where':{'id':_0x28cdf4['id']},'data':{'status':_0x58f969(0x210),'updatedAt':new Date()}}),await database_1[_0x58f969(0x1ba)]['webhookLog'][_0x58f969(0x1e6)]({'data':{'paymentId':_0x28cdf4['id'],'shopId':_0x28cdf4['shopId'],'event':_0x58f969(0x20a),'statusCode':0xc8,'responseBody':JSON[_0x58f969(0x1ac)]({'reason':_0x58f969(0x180)+this[_0x58f969(0x1b6)]+_0x58f969(0x1c9),'createdAt':_0x28cdf4[_0x58f969(0x17e)],'expiredAt':new Date()['toISOString'](),'daysSinceCreation':Math['floor']((Date[_0x58f969(0x19b)]()-_0x28cdf4[_0x58f969(0x17e)][_0x58f969(0x1b1)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x58f969(0x1bb)](_0x28cdf4,_0x58f969(0x210)),await this[_0x58f969(0x1db)](_0x28cdf4,_0x58f969(0x210)),this[_0x58f969(0x152)](_0x28cdf4['id']),_0x258e72['push'](_0x28cdf4['id']),console[_0x58f969(0x120)]('‚úÖ\x20[EXPIRY]\x20Payment\x20'+_0x28cdf4['id']+'\x20marked\x20as\x20EXPIRED\x20due\x20to\x20'+this[_0x58f969(0x1b6)]+_0x58f969(0x1d3));}catch(_0x2bc1d5){console[_0x58f969(0x20e)](_0x58f969(0x1b3)+_0x28cdf4['id']+':',_0x2bc1d5),this[_0x58f969(0x13c)](_0x28cdf4['id'],_0x28cdf4[_0x58f969(0x1d6)]||'unknown',_0x2bc1d5,'auto_expire',{'reason':_0x58f969(0x146),'createdAt':_0x28cdf4[_0x58f969(0x17e)],'daysSinceCreation':Math['floor']((Date[_0x58f969(0x19b)]()-_0x28cdf4[_0x58f969(0x17e)][_0x58f969(0x1b1)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x258e72;}async['checkSinglePayment'](_0x4e5794){const _0x387850=a57_0x538a7f;if(!_0x4e5794['gatewayPaymentId']){console[_0x387850(0x120)](_0x387850(0x187)+_0x4e5794['id']+'\x20has\x20no\x20gatewayPaymentId,\x20skipping');return;}console[_0x387850(0x120)](_0x387850(0x1e2)+_0x4e5794[_0x387850(0x102)]+_0x387850(0x18c)+_0x4e5794['id']+'\x20('+_0x4e5794[_0x387850(0x1d6)]+')');try{let _0x2d898f;_0x4e5794['gateway']===_0x387850(0x148)?(_0x2d898f=await this['coinToPay2Service']['checkPaymentStatus'](_0x4e5794[_0x387850(0x1d6)]),console[_0x387850(0x120)]('üìä\x20[CHECK]\x20CoinToPay2\x20payment\x20'+_0x4e5794['id']+_0x387850(0xff)+_0x2d898f[_0x387850(0x1a2)])):(_0x2d898f=await this[_0x387850(0x195)]['checkPaymentStatus'](_0x4e5794[_0x387850(0x1d6)]),console[_0x387850(0x120)](_0x387850(0x137)+_0x4e5794['id']+'\x20status:\x20'+_0x2d898f[_0x387850(0x1a2)]));_0x2d898f[_0x387850(0x1d8)]&&console['log'](_0x387850(0x1d0)+_0x4e5794['id']+_0x387850(0x19a),{'iban':_0x2d898f[_0x387850(0x1d8)][_0x387850(0x133)]||_0x387850(0x1ec),'transactionId':_0x2d898f[_0x387850(0x1d8)]['transactionId'],'createdOn':_0x2d898f['paymentDetails']['createdOn'],'confirmedOn':_0x2d898f[_0x387850(0x1d8)][_0x387850(0x11a)]||_0x387850(0x192)});if(_0x2d898f['status']!==_0x4e5794[_0x387850(0x1a2)]){console['log'](_0x387850(0x1f5)+_0x4e5794['id']+_0x387850(0x104)+_0x4e5794[_0x387850(0x1a2)]+_0x387850(0x199)+_0x2d898f[_0x387850(0x1a2)]),this[_0x387850(0x113)](_0x4e5794['id'],_0x4e5794['gatewayPaymentId'],_0x4e5794['status'],_0x2d898f['status'],_0x387850(0x147),{'paymentDetails':_0x2d898f[_0x387850(0x1d8)],'amount':_0x2d898f[_0x387850(0x1cf)],'currency':_0x2d898f[_0x387850(0x1a4)],'shopId':_0x4e5794[_0x387850(0x15b)],'checkTimestamp':new Date()[_0x387850(0x193)]()});const _0x14ac66={'status':_0x2d898f[_0x387850(0x1a2)],'updatedAt':new Date()};if(_0x2d898f[_0x387850(0x1a2)]==='PAID'&&_0x4e5794[_0x387850(0x1a2)]!==_0x387850(0x1e8)){_0x14ac66[_0x387850(0x115)]=new Date();if(!_0x4e5794[_0x387850(0x1f8)]){const _0x27d50c=await currencyService_1['currencyService'][_0x387850(0x1f1)](_0x4e5794[_0x387850(0x1cf)],_0x4e5794[_0x387850(0x1a4)]);_0x14ac66[_0x387850(0x1f8)]=_0x27d50c;const _0x3d5a3e=await this[_0x387850(0x14b)](_0x4e5794['shopId'],_0x4e5794['gateway']),_0x1fc60a=_0x27d50c*(0x1-_0x3d5a3e/0x64);_0x14ac66['amountAfterGatewayCommissionUSDT']=_0x1fc60a,_0x14ac66[_0x387850(0x1af)]=_0x3d5a3e,console['log'](_0x387850(0x18a)+_0x4e5794['id']+_0x387850(0x105)),console[_0x387850(0x120)](_0x387850(0x161)+_0x4e5794['amount']+'\x20'+_0x4e5794[_0x387850(0x1a4)]+_0x387850(0x188)+_0x27d50c[_0x387850(0x149)](0x6)+_0x387850(0x13a)),console['log'](_0x387850(0x191)+_0x4e5794[_0x387850(0x102)]+'\x20commission:\x20'+_0x3d5a3e+'%'),console[_0x387850(0x120)]('\x20\x20\x20Amount\x20after\x20commission:\x20'+_0x1fc60a[_0x387850(0x149)](0x6)+_0x387850(0x13a));}console[_0x387850(0x120)]('üí∞\x20[CHECK]\x20Payment\x20'+_0x4e5794['id']+_0x387850(0x124)+_0x14ac66['paidAt']['toISOString']());}if(_0x2d898f[_0x387850(0x1d8)]){const _0x2026a7=_0x2d898f[_0x387850(0x1d8)];_0x2026a7['iban']&&(_0x14ac66[_0x387850(0x13d)]=_0x2026a7[_0x387850(0x133)],console[_0x387850(0x120)]('üè¶\x20[CHECK]\x20Saved\x20IBAN:\x20'+_0x2026a7['iban'])),_0x2026a7[_0x387850(0x14d)]&&console['log'](_0x387850(0x198)+_0x2026a7[_0x387850(0x14d)]),_0x2026a7[_0x387850(0x16c)]&&console['log']('üÜî\x20[CHECK]\x20Transaction\x20ID:\x20'+_0x2026a7[_0x387850(0x16c)]),_0x2026a7[_0x387850(0x11a)]&&console['log'](_0x387850(0x1f6)+_0x2026a7[_0x387850(0x11a)]);}await database_1[_0x387850(0x1ba)][_0x387850(0x194)][_0x387850(0x1dd)]({'where':{'id':_0x4e5794['id']},'data':_0x14ac66});if(_0x2d898f[_0x387850(0x1a2)]===_0x387850(0x1e8)&&_0x4e5794['status']!==_0x387850(0x1e8)){console[_0x387850(0x120)](_0x387850(0x1fd)+_0x4e5794['id']+_0x387850(0x173));const _0x41b131=await database_1[_0x387850(0x1ba)][_0x387850(0x194)]['findUnique']({'where':{'id':_0x4e5794['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x41b131?.[_0x387850(0x1b9)]&&_0x41b131[_0x387850(0x1fc)])try{const _0x3287c9=_0x41b131['paymentLink'];console[_0x387850(0x120)]('üìà\x20[COINTOPAY]\x20Found\x20payment\x20link\x20'+_0x3287c9['id']+_0x387850(0x168)+_0x3287c9[_0x387850(0x1e4)]+',\x20currentPayments='+_0x3287c9['currentPayments']+_0x387850(0x1fe)+_0x3287c9['status']);const _0x16907d=_0x3287c9[_0x387850(0x157)]+0x1,_0x530318=_0x3287c9[_0x387850(0x1e4)]===_0x387850(0x111)?_0x387850(0x201):_0x3287c9[_0x387850(0x1a2)];await database_1[_0x387850(0x1ba)][_0x387850(0x1fc)][_0x387850(0x1dd)]({'where':{'id':_0x3287c9['id']},'data':{'currentPayments':_0x16907d,'status':_0x530318,'updatedAt':new Date()}}),console[_0x387850(0x120)](_0x387850(0x1f4)+_0x3287c9['id']+_0x387850(0x162)+_0x3287c9['currentPayments']+_0x387850(0x188)+_0x16907d+_0x387850(0x1fe)+_0x3287c9[_0x387850(0x1a2)]+_0x387850(0x188)+_0x530318);}catch(_0x10ded6){console[_0x387850(0x20e)](_0x387850(0x154),_0x10ded6);}else console[_0x387850(0x120)]('üìà\x20[COINTOPAY]\x20Payment\x20'+_0x4e5794['id']+_0x387850(0x202));}await database_1[_0x387850(0x1ba)][_0x387850(0x132)][_0x387850(0x1e6)]({'data':{'paymentId':_0x4e5794['id'],'shopId':_0x4e5794[_0x387850(0x15b)],'event':_0x387850(0x106)+_0x2d898f[_0x387850(0x1a2)]['toLowerCase'](),'statusCode':0xc8,'responseBody':JSON['stringify']({'oldStatus':_0x4e5794[_0x387850(0x1a2)],'newStatus':_0x2d898f[_0x387850(0x1a2)],'paymentDetails':_0x2d898f['paymentDetails'],'checkedAt':new Date()[_0x387850(0x193)]()})}}),await this[_0x387850(0x1bb)](_0x4e5794,_0x2d898f['status']),await this[_0x387850(0x1db)](_0x4e5794,_0x2d898f[_0x387850(0x1a2)]),_0x2d898f[_0x387850(0x1a2)]!==_0x387850(0x116)&&(console[_0x387850(0x120)]('üßπ\x20[CHECK]\x20Payment\x20'+_0x4e5794['id']+_0x387850(0x1e9)+_0x2d898f[_0x387850(0x1a2)]+',\x20clearing\x20individual\x20timers'),this['clearPaymentTimers'](_0x4e5794['id'])),console[_0x387850(0x120)](_0x387850(0x177)+_0x4e5794['id']+_0x387850(0x176));}else console[_0x387850(0x120)](_0x387850(0x1d0)+_0x4e5794['id']+_0x387850(0x11c)+_0x2d898f[_0x387850(0x1a2)]+')'),this['logCoinToPayStatus'](_0x4e5794['id'],_0x4e5794[_0x387850(0x1d6)],_0x4e5794['status'],_0x2d898f[_0x387850(0x1a2)],_0x387850(0x147),{'statusUnchanged':!![],'paymentDetails':_0x2d898f['paymentDetails'],'amount':_0x2d898f[_0x387850(0x1cf)],'currency':_0x2d898f[_0x387850(0x1a4)],'shopId':_0x4e5794[_0x387850(0x15b)],'checkTimestamp':new Date()['toISOString']()});}catch(_0xe86a15){console[_0x387850(0x20e)]('‚ùå\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20'+_0x4e5794['id']+':',_0xe86a15),this[_0x387850(0x13c)](_0x4e5794['id'],_0x4e5794[_0x387850(0x1d6)],_0xe86a15,_0x387850(0x147),{'paymentAmount':_0x4e5794[_0x387850(0x1cf)],'paymentCurrency':_0x4e5794[_0x387850(0x1a4)],'shopId':_0x4e5794['shopId'],'createdAt':_0x4e5794[_0x387850(0x17e)]}),await database_1[_0x387850(0x1ba)][_0x387850(0x132)][_0x387850(0x1e6)]({'data':{'paymentId':_0x4e5794['id'],'shopId':_0x4e5794['shopId'],'event':_0x387850(0x114),'statusCode':0x1f4,'responseBody':JSON[_0x387850(0x1ac)]({'error':_0xe86a15 instanceof Error?_0xe86a15[_0x387850(0x156)]:_0x387850(0x175),'gatewayPaymentId':_0x4e5794[_0x387850(0x1d6)],'checkedAt':new Date()['toISOString']()})}});}}async[a57_0x538a7f(0x1bb)](_0x21b1bc,_0x53b1e4){const _0x33ccd8=a57_0x538a7f,_0x640171=Date['now']();try{const _0x50a4d4=_0x21b1bc['shop'],_0x4599e8=_0x50a4d4['settings'];if(!_0x4599e8?.[_0x33ccd8(0x1ee)]){console[_0x33ccd8(0x120)](_0x33ccd8(0x1b2)+_0x50a4d4['id']);return;}const _0x2f2527=_0x53b1e4===_0x33ccd8(0x1e8)?_0x33ccd8(0x144):_0x53b1e4===_0x33ccd8(0x134)?_0x33ccd8(0x16a):_0x53b1e4===_0x33ccd8(0x210)?_0x33ccd8(0x16a):_0x33ccd8(0x1d7);if(!_0x4599e8[_0x33ccd8(0x15e)]?.[_0x33ccd8(0x15a)](_0x2f2527)){console[_0x33ccd8(0x120)](_0x33ccd8(0x166)+_0x2f2527+'\x20not\x20enabled\x20for\x20shop\x20'+_0x50a4d4['id']);return;}const _0x8ba34b=(0x0,gateway_1[_0x33ccd8(0x1c1)])(_0x21b1bc[_0x33ccd8(0x102)])||_0x21b1bc[_0x33ccd8(0x102)],_0x242545={'event':_0x2f2527,'payment':{'id':_0x21b1bc['id'],'order_id':_0x21b1bc[_0x33ccd8(0x1d9)],'gateway_order_id':_0x21b1bc[_0x33ccd8(0x112)],'gateway':_0x8ba34b,'amount':_0x21b1bc[_0x33ccd8(0x1cf)],'currency':_0x21b1bc['currency'],'status':_0x53b1e4[_0x33ccd8(0x128)](),'customer_email':_0x21b1bc[_0x33ccd8(0x197)],'customer_name':_0x21b1bc['customerName'],'created_at':_0x21b1bc[_0x33ccd8(0x17e)],'updated_at':new Date()}},_0x4376de=JSON['stringify'](_0x242545),_0x22cbfc=crypto_1[_0x33ccd8(0x1ba)][_0x33ccd8(0x1ea)](_0x33ccd8(0x1c4),_0x21b1bc[_0x33ccd8(0x18e)][_0x33ccd8(0x1ff)])[_0x33ccd8(0x1dd)](_0x4376de)[_0x33ccd8(0x20f)]('hex'),_0x217c13=await fetch(_0x4599e8[_0x33ccd8(0x1ee)],{'method':_0x33ccd8(0x139),'headers':{'Content-Type':'application/json','User-Agent':_0x33ccd8(0x1a9),'X-Webhook-Signature':_0x22cbfc},'body':_0x4376de}),_0x345528=Date[_0x33ccd8(0x19b)]()-_0x640171,_0x56df9b=_0x217c13['ok']?'Success':await _0x217c13[_0x33ccd8(0xfd)]();loggerService_1[_0x33ccd8(0x12c)][_0x33ccd8(0x153)](_0x21b1bc[_0x33ccd8(0x15b)],_0x4599e8['webhookUrl'],_0x2f2527,_0x217c13[_0x33ccd8(0x1a2)],_0x345528,_0x242545),console[_0x33ccd8(0x120)]('Shop\x20webhook\x20sent\x20to\x20'+_0x4599e8[_0x33ccd8(0x1ee)]+_0x33ccd8(0x204)+_0x217c13[_0x33ccd8(0x1a2)]+'\x20('+_0x345528+_0x33ccd8(0x151));}catch(_0x25971c){console['error'](_0x33ccd8(0x1bd),_0x25971c),loggerService_1['loggerService'][_0x33ccd8(0x1a8)](_0x21b1bc['shopId'],_0x21b1bc[_0x33ccd8(0x18e)]?.[_0x33ccd8(0x179)]?.[_0x33ccd8(0x1ee)]||_0x33ccd8(0x12e),_0x33ccd8(0x1f9),_0x25971c,{});}}async['sendPaymentStatusNotification'](_0x2b059c,_0x124d46){const _0xf295c1=a57_0x538a7f;try{const _0x1d97bf={'PENDING':'created','PAID':_0xf295c1(0x127),'FAILED':_0xf295c1(0x1c2),'EXPIRED':'expired'},_0x302058=_0x1d97bf[_0x124d46];if(!_0x302058||_0x302058===_0xf295c1(0x19f))return;await telegramBotService_1[_0xf295c1(0x13b)]['sendPaymentNotification'](_0x2b059c[_0xf295c1(0x15b)],_0x2b059c,_0x302058);}catch(_0x48a65b){console['error'](_0xf295c1(0x1c3),_0x48a65b);}}async['checkPaymentById'](_0x731f69){const _0x30f26b=a57_0x538a7f;console[_0x30f26b(0x120)](_0x30f26b(0x14a)+_0x731f69);const _0xff79e=await database_1[_0x30f26b(0x1ba)][_0x30f26b(0x194)]['findUnique']({'where':{'id':_0x731f69},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0xff79e)throw new Error(_0x30f26b(0x117));if(_0xff79e[_0x30f26b(0x102)]!==_0x30f26b(0x1df)&&_0xff79e[_0x30f26b(0x102)]!==_0x30f26b(0x148))throw new Error(_0x30f26b(0x184));console[_0x30f26b(0x120)](_0x30f26b(0x163)+_0xff79e['gateway']+_0x30f26b(0x18c)+_0x731f69),await this['checkSinglePayment'](_0xff79e),console[_0x30f26b(0x120)](_0x30f26b(0x16e)+_0x731f69);}[a57_0x538a7f(0x1a5)](){const _0x2ec0a7=a57_0x538a7f,_0x42ebba=this['globalCheckInterval']?this[_0x2ec0a7(0x181)]:undefined,_0x483f75=Array['from'](this[_0x2ec0a7(0x135)][_0x2ec0a7(0x172)]())['map'](_0x12a51d=>({'paymentId':_0x12a51d[_0x2ec0a7(0x14e)],'gatewayPaymentId':_0x12a51d['gatewayPaymentId'],'createdAt':_0x12a51d['createdAt'],'timersCount':_0x12a51d['timers'][_0x2ec0a7(0x169)]}));return{'isActive':!!this[_0x2ec0a7(0x119)],'globalCheckIntervalMinutes':this[_0x2ec0a7(0x181)]/(0x3e8*0x3c),'expiryDays':this[_0x2ec0a7(0x1b6)],'activeIndividualTimers':this[_0x2ec0a7(0x135)][_0x2ec0a7(0x200)],'nextGlobalCheckIn':_0x42ebba,'paymentTimersDetails':_0x483f75};}[a57_0x538a7f(0x1da)](_0x4d7bae){const _0x246ec9=a57_0x538a7f,_0x1f6583=this[_0x246ec9(0x135)][_0x246ec9(0x1d5)](_0x4d7bae);if(_0x1f6583)return{'hasTimers':!![],'timersCount':_0x1f6583['timers']['length'],'createdAt':_0x1f6583[_0x246ec9(0x17e)],'gatewayPaymentId':_0x1f6583[_0x246ec9(0x1d6)]};return{'hasTimers':![]};}async[a57_0x538a7f(0x14b)](_0x51574f,_0x2b20c0){const _0x1ca33b=a57_0x538a7f;try{const _0x43ac9a=await database_1[_0x1ca33b(0x1ba)][_0x1ca33b(0x18e)][_0x1ca33b(0x174)]({'where':{'id':_0x51574f},'select':{'gatewaySettings':!![]}});if(!_0x43ac9a?.[_0x1ca33b(0x164)])return console['log'](_0x1ca33b(0x182)+_0x51574f+_0x1ca33b(0x1f2)),0xa;const _0x323658=JSON['parse'](_0x43ac9a[_0x1ca33b(0x164)]);for(const [_0x511a68,_0x31f99b]of Object[_0x1ca33b(0x15f)](_0x323658)){if(_0x511a68[_0x1ca33b(0x128)]()===_0x2b20c0[_0x1ca33b(0x128)]()){const _0x1a78fe=_0x31f99b[_0x1ca33b(0x108)]||0xa;return console[_0x1ca33b(0x120)](_0x1ca33b(0x1ae)+_0x2b20c0+_0x1ca33b(0xfc)+_0x51574f+':\x20'+_0x1a78fe+'%'),_0x1a78fe;}}return console[_0x1ca33b(0x120)](_0x1ca33b(0x109)+_0x2b20c0+'\x20in\x20shop\x20'+_0x51574f+_0x1ca33b(0x1f7)),0xa;}catch(_0x301a68){return console[_0x1ca33b(0x20e)](_0x1ca33b(0x1b0)+_0x51574f+_0x1ca33b(0x17d)+_0x2b20c0+':',_0x301a68),0xa;}}}exports['CoinToPayStatusService']=CoinToPayStatusService,exports[a57_0x538a7f(0x1ad)]=new CoinToPayStatusService();