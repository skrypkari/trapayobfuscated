'use strict';const a37_0x5e507c=a37_0x3498;(function(_0x246d37,_0x914062){const _0x4663b2=a37_0x3498,_0x53e818=_0x246d37();while(!![]){try{const _0x2fde39=parseInt(_0x4663b2(0x193))/0x1*(parseInt(_0x4663b2(0x141))/0x2)+-parseInt(_0x4663b2(0x155))/0x3*(parseInt(_0x4663b2(0x133))/0x4)+parseInt(_0x4663b2(0x188))/0x5+parseInt(_0x4663b2(0x16d))/0x6*(parseInt(_0x4663b2(0x107))/0x7)+-parseInt(_0x4663b2(0x18a))/0x8+parseInt(_0x4663b2(0x164))/0x9+-parseInt(_0x4663b2(0xc3))/0xa*(parseInt(_0x4663b2(0xf2))/0xb);if(_0x2fde39===_0x914062)break;else _0x53e818['push'](_0x53e818['shift']());}catch(_0x2f8f8b){_0x53e818['push'](_0x53e818['shift']());}}}(a37_0xa4f3,0xbc4a6));var __importDefault=this&&this[a37_0x5e507c(0xe8)]||function(_0x42fae6){return _0x42fae6&&_0x42fae6['__esModule']?_0x42fae6:{'default':_0x42fae6};};Object['defineProperty'](exports,a37_0x5e507c(0x123),{'value':!![]}),exports[a37_0x5e507c(0x132)]=exports[a37_0x5e507c(0x187)]=void 0x0;function a37_0x3498(_0x2e6ac6,_0x300678){const _0xa4f379=a37_0xa4f3();return a37_0x3498=function(_0x349835,_0x2d7570){_0x349835=_0x349835-0x9a;let _0x4a3d81=_0xa4f379[_0x349835];return _0x4a3d81;},a37_0x3498(_0x2e6ac6,_0x300678);}const coinToPayService_1=require('./gateways/coinToPayService'),coinToPay2Service_1=require(a37_0x5e507c(0xa7)),gateway_1=require('../types/gateway'),database_1=__importDefault(require(a37_0x5e507c(0xac))),telegramBotService_1=require(a37_0x5e507c(0x12a)),loggerService_1=require(a37_0x5e507c(0x14c)),currencyService_1=require('./currencyService');class CoinToPayStatusService{constructor(){const _0x4ba0d9=a37_0x5e507c;this['globalCheckInterval']=null,this['GLOBAL_CHECK_INTERVAL_MS']=0x3c*0x3c*0x3e8,this[_0x4ba0d9(0x10f)]=0x5,this['paymentTimers']=new Map(),this[_0x4ba0d9(0x1a5)]=new coinToPayService_1[(_0x4ba0d9(0x1a2))](),this[_0x4ba0d9(0x12e)]=new coinToPay2Service_1[(_0x4ba0d9(0xf5))](),console[_0x4ba0d9(0x140)]('🪙\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2');}[a37_0x5e507c(0x197)](_0x5a3f0f,_0x2bf433){const _0x3c359b=a37_0x5e507c;console['log'](_0x3c359b(0x116)),console[_0x3c359b(0x140)]('\x20\x20\x20-\x20paymentId:\x20'+_0x5a3f0f),console[_0x3c359b(0x140)](_0x3c359b(0x121)+_0x2bf433),this[_0x3c359b(0xbc)](_0x5a3f0f);const _0x3fc7a0=[],_0x6e3032=new Date(),_0x3ffddd=[{'delay':0x1*0x3c*0x3e8,'description':_0x3c359b(0xc2)},{'delay':0x2*0x3c*0x3e8,'description':_0x3c359b(0x166)},{'delay':0x5*0x3c*0x3e8,'description':_0x3c359b(0x14a)},{'delay':0x5*0x3c*0x3e8,'description':'5\x20minutes'}];console[_0x3c359b(0x140)](_0x3c359b(0x16b)+_0x3ffddd[_0x3c359b(0x110)]+_0x3c359b(0x135)+_0x5a3f0f);let _0x24f6e0=0x0;_0x3ffddd['forEach']((_0x2109c6,_0xdf8f1c)=>{const _0x3259c2=_0x3c359b;_0x24f6e0+=_0x2109c6[_0x3259c2(0xc0)];const _0x1b3ec1=setTimeout(async()=>{const _0x2e6a9c=_0x3259c2;console[_0x2e6a9c(0x140)](_0x2e6a9c(0x11f)+(_0xdf8f1c+0x1)+_0x2e6a9c(0x13c)+_0x5a3f0f+'\x20(after\x20'+_0x2109c6['description']+')');try{await this['checkSinglePaymentById'](_0x5a3f0f),console['log'](_0x2e6a9c(0x9f)+(_0xdf8f1c+0x1)+_0x2e6a9c(0x106)+_0x5a3f0f);}catch(_0x42409a){console[_0x2e6a9c(0xcb)](_0x2e6a9c(0x102)+(_0xdf8f1c+0x1)+_0x2e6a9c(0x119)+_0x5a3f0f+':',_0x42409a),this['logCoinToPayError'](_0x5a3f0f,_0x2bf433,_0x42409a,'status_check',{'checkNumber':_0xdf8f1c+0x1,'scheduledAfter':_0x2109c6['description'],'isIndividualCheck':!![]});}},_0x24f6e0);_0x3fc7a0[_0x3259c2(0x138)](_0x1b3ec1),console[_0x3259c2(0x140)](_0x3259c2(0x183)+(_0xdf8f1c+0x1)+_0x3259c2(0x119)+_0x5a3f0f+_0x3259c2(0x13d)+_0x24f6e0/0x3e8+_0x3259c2(0x120)+_0x2109c6['description']+')');});const _0x351b98=setInterval(async()=>{const _0x162ac2=_0x3c359b;console['log'](_0x162ac2(0x10a)+_0x5a3f0f);try{const _0x52e07d=await database_1['default'][_0x162ac2(0xdd)]['findUnique']({'where':{'id':_0x5a3f0f},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x52e07d){console[_0x162ac2(0x140)](_0x162ac2(0xb0)+_0x5a3f0f+_0x162ac2(0x1a4)),this[_0x162ac2(0xbc)](_0x5a3f0f);return;}console['log']('📊\x20[HOURLY]\x20Payment\x20'+_0x5a3f0f+'\x20current\x20status:\x20'+_0x52e07d[_0x162ac2(0xdb)]);if(_0x52e07d['status']!==_0x162ac2(0x18b)){console['log'](_0x162ac2(0xe5)+_0x5a3f0f+'\x20status\x20is\x20'+_0x52e07d[_0x162ac2(0xdb)]+_0x162ac2(0xd3)),this[_0x162ac2(0xbc)](_0x5a3f0f);return;}const _0x3dedea=Math['floor']((Date[_0x162ac2(0xc7)]()-_0x52e07d[_0x162ac2(0x122)][_0x162ac2(0x177)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x3dedea>=this['EXPIRY_DAYS']){console[_0x162ac2(0x140)](_0x162ac2(0x175)+_0x5a3f0f+_0x162ac2(0x182)+this[_0x162ac2(0x10f)]+_0x162ac2(0x18d)),this[_0x162ac2(0xbc)](_0x5a3f0f);return;}await this[_0x162ac2(0x158)](_0x5a3f0f),console[_0x162ac2(0x140)]('✅\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20'+_0x5a3f0f);}catch(_0x56c5af){console[_0x162ac2(0xcb)](_0x162ac2(0x16e)+_0x5a3f0f+':',_0x56c5af),this[_0x162ac2(0x9c)](_0x5a3f0f,_0x2bf433,_0x56c5af,_0x162ac2(0xd6),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x3fc7a0[_0x3c359b(0x138)](_0x351b98),this[_0x3c359b(0xa8)]['set'](_0x5a3f0f,{'timers':_0x3fc7a0,'paymentId':_0x5a3f0f,'gatewayPaymentId':_0x2bf433,'createdAt':_0x6e3032}),console['log']('✅\x20[DEBUG]\x20Successfully\x20scheduled\x20'+_0x3ffddd[_0x3c359b(0x110)]+_0x3c359b(0x195)+_0x5a3f0f),console[_0x3c359b(0x140)](_0x3c359b(0x14f)+this[_0x3c359b(0xa8)][_0x3c359b(0xa9)]),this[_0x3c359b(0xb1)](_0x5a3f0f,_0x2bf433,_0x3c359b(0x18b),_0x3c359b(0x18b),_0x3c359b(0xd6),{'action':_0x3c359b(0x113),'scheduledChecks':_0x3ffddd[_0x3c359b(0x110)],'firstCheckIn':_0x3ffddd[0x0][_0x3c359b(0xc0)]/0x3e8,'totalTimers':this[_0x3c359b(0xa8)][_0x3c359b(0xa9)]});}[a37_0x5e507c(0xbc)](_0x56f26f){const _0x2a1af7=a37_0x5e507c,_0x3ffb3b=this[_0x2a1af7(0xa8)][_0x2a1af7(0x148)](_0x56f26f);_0x3ffb3b?(console[_0x2a1af7(0x140)](_0x2a1af7(0x171)+_0x3ffb3b['timers'][_0x2a1af7(0x110)]+_0x2a1af7(0x108)+_0x56f26f),_0x3ffb3b[_0x2a1af7(0xfd)]['forEach']((_0x2d2ec6,_0x3f150b)=>{const _0x5bd36a=_0x2a1af7;_0x2d2ec6&&(clearTimeout(_0x2d2ec6),clearInterval(_0x2d2ec6),console[_0x5bd36a(0x140)](_0x5bd36a(0x161)+(_0x3f150b+0x1)+'\x20for\x20payment\x20'+_0x56f26f));}),this[_0x2a1af7(0xa8)][_0x2a1af7(0xf8)](_0x56f26f),console[_0x2a1af7(0x140)](_0x2a1af7(0xf9)+_0x56f26f+_0x2a1af7(0xfb)+this['paymentTimers'][_0x2a1af7(0xa9)])):console[_0x2a1af7(0x140)](_0x2a1af7(0x11a)+_0x56f26f+_0x2a1af7(0x17a));}async[a37_0x5e507c(0x158)](_0x3acbf5){const _0x5e46f4=a37_0x5e507c;console[_0x5e46f4(0x140)](_0x5e46f4(0x115)+_0x3acbf5);const _0x1a5cb2=await database_1[_0x5e46f4(0xb2)][_0x5e46f4(0xdd)][_0x5e46f4(0x15e)]({'where':{'id':_0x3acbf5},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x1a5cb2){console['log'](_0x5e46f4(0x178)+_0x3acbf5+'\x20not\x20found\x20in\x20database');return;}console[_0x5e46f4(0x140)](_0x5e46f4(0x130)+_0x3acbf5+_0x5e46f4(0x137)),console['log'](_0x5e46f4(0xab)+_0x1a5cb2[_0x5e46f4(0x13a)]),console[_0x5e46f4(0x140)](_0x5e46f4(0x151)+_0x1a5cb2[_0x5e46f4(0xdb)]),console['log'](_0x5e46f4(0xbb)+_0x1a5cb2[_0x5e46f4(0x146)]),console['log'](_0x5e46f4(0x111)+_0x1a5cb2[_0x5e46f4(0x198)]+'\x20'+_0x1a5cb2[_0x5e46f4(0xd2)]),console[_0x5e46f4(0x140)](_0x5e46f4(0x15d)+_0x1a5cb2[_0x5e46f4(0x103)]);if(_0x1a5cb2['gateway']!==_0x5e46f4(0x18f)&&_0x1a5cb2[_0x5e46f4(0x13a)]!==_0x5e46f4(0xae)){console[_0x5e46f4(0x140)](_0x5e46f4(0xda)+_0x3acbf5+'\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20'+_0x1a5cb2[_0x5e46f4(0x13a)]+')');return;}if(_0x1a5cb2['status']!==_0x5e46f4(0x18b)){console[_0x5e46f4(0x140)]('⚠️\x20[CHECK]\x20Payment\x20'+_0x3acbf5+_0x5e46f4(0xee)+_0x1a5cb2[_0x5e46f4(0xdb)]+_0x5e46f4(0xd3)),this[_0x5e46f4(0xbc)](_0x3acbf5);return;}if(!_0x1a5cb2[_0x5e46f4(0x146)]){console[_0x5e46f4(0x140)](_0x5e46f4(0xda)+_0x3acbf5+_0x5e46f4(0xeb));return;}console[_0x5e46f4(0x140)](_0x5e46f4(0x1a7)+_0x3acbf5+'\x20is\x20valid\x20for\x20checking,\x20proceeding...'),await this['checkSinglePayment'](_0x1a5cb2);}[a37_0x5e507c(0xb1)](_0x3d5396,_0x4fc30e,_0x1bc038,_0x4e8788,_0x32c9e6,_0x58e20c){const _0x520685=a37_0x5e507c,_0x37cd2d={'type':'COINTOPAY_STATUS_CHANGE','paymentId':_0x3d5396,'gatewayPaymentId':_0x4fc30e,'oldStatus':_0x1bc038,'newStatus':_0x4e8788,'source':_0x32c9e6,'timestamp':new Date()[_0x520685(0x1a6)](),'details':_0x58e20c||{}};loggerService_1['loggerService'][_0x520685(0xb1)](_0x37cd2d),console['log']('🪙\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20'+_0x3d5396+'\x20('+_0x4fc30e+')'),console[_0x520685(0x140)](_0x520685(0x136)+_0x1bc038+_0x520685(0xf3)+_0x4e8788),console[_0x520685(0x140)]('\x20\x20\x20📍\x20Source:\x20'+_0x32c9e6),console['log'](_0x520685(0x18c)+_0x37cd2d[_0x520685(0x170)]),_0x58e20c&&console[_0x520685(0x140)](_0x520685(0x157),_0x58e20c);}[a37_0x5e507c(0x9c)](_0x408be6,_0x46c04c,_0x57fee0,_0x2c50c8,_0x4d58fa){const _0x1ef007=a37_0x5e507c,_0x570e0d={'type':_0x1ef007(0x192),'paymentId':_0x408be6,'gatewayPaymentId':_0x46c04c,'error':_0x57fee0 instanceof Error?{'message':_0x57fee0[_0x1ef007(0x17c)],'stack':_0x57fee0[_0x1ef007(0x114)]}:_0x57fee0,'source':_0x2c50c8,'timestamp':new Date()[_0x1ef007(0x1a6)](),'context':_0x4d58fa||{}};loggerService_1[_0x1ef007(0xd7)][_0x1ef007(0x9c)](_0x570e0d),console['error'](_0x1ef007(0xca)+_0x408be6+'\x20('+_0x46c04c+')'),console['error'](_0x1ef007(0x19c)+(_0x57fee0 instanceof Error?_0x57fee0[_0x1ef007(0x17c)]:_0x57fee0)),console['error']('\x20\x20\x20📍\x20Source:\x20'+_0x2c50c8),console[_0x1ef007(0xcb)]('\x20\x20\x20📅\x20Time:\x20'+_0x570e0d[_0x1ef007(0x170)]),_0x4d58fa&&console[_0x1ef007(0xcb)](_0x1ef007(0x176),_0x4d58fa);}[a37_0x5e507c(0x16f)](){const _0x723b6d=a37_0x5e507c;console[_0x723b6d(0x140)](_0x723b6d(0x12b)),this['checkAllPendingPayments']()[_0x723b6d(0x9a)](_0x137ac1=>{const _0xbc9657=_0x723b6d;console[_0xbc9657(0xcb)](_0xbc9657(0x19d),_0x137ac1);}),this[_0x723b6d(0xb5)]=setInterval(async()=>{const _0x43099f=_0x723b6d;try{console[_0x43099f(0x140)]('🪙\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...'),await this[_0x43099f(0xfc)](),console[_0x43099f(0x140)]('✅\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed');}catch(_0x325350){console[_0x43099f(0xcb)](_0x43099f(0x134),_0x325350);}},this[_0x723b6d(0x19e)]),console[_0x723b6d(0x140)](_0x723b6d(0x10b));}[a37_0x5e507c(0x180)](){const _0x96c9ee=a37_0x5e507c;console[_0x96c9ee(0x140)]('🛑\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...');this[_0x96c9ee(0xb5)]&&(clearInterval(this[_0x96c9ee(0xb5)]),this[_0x96c9ee(0xb5)]=null,console['log'](_0x96c9ee(0x131)));const _0x57acab=this[_0x96c9ee(0xa8)][_0x96c9ee(0xa9)];for(const [_0x5505e1]of this[_0x96c9ee(0xa8)]){this[_0x96c9ee(0xbc)](_0x5505e1);}console[_0x96c9ee(0x140)](_0x96c9ee(0x124)+_0x57acab+_0x96c9ee(0x11c));}async[a37_0x5e507c(0xfc)](){const _0x320e4d=a37_0x5e507c;try{console[_0x320e4d(0x140)](_0x320e4d(0xbd));const _0xc7fff0=await database_1['default']['payment'][_0x320e4d(0xb7)]({'where':{'gateway':{'in':[_0x320e4d(0x18f),_0x320e4d(0xae)]},'status':_0x320e4d(0x18b),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x320e4d(0x140)](_0x320e4d(0xd0)+_0xc7fff0[_0x320e4d(0x110)]+_0x320e4d(0xa3));if(_0xc7fff0[_0x320e4d(0x110)]===0x0){console[_0x320e4d(0x140)](_0x320e4d(0xde));return;}const _0x2b1f85=await this[_0x320e4d(0x154)](_0xc7fff0);console['log'](_0x320e4d(0xec)+_0x2b1f85[_0x320e4d(0x110)]+'\x20expired\x20CoinToPay\x20payments');let _0x4c5df5=0x0,_0x285918=0x0;for(const _0x535b29 of _0xc7fff0){try{if(_0x2b1f85[_0x320e4d(0x15c)](_0x535b29['id'])){console[_0x320e4d(0x140)](_0x320e4d(0x139)+_0x535b29['id']+_0x320e4d(0x16a)),_0x285918++;continue;}if(this[_0x320e4d(0xa8)][_0x320e4d(0x147)](_0x535b29['id'])){console['log'](_0x320e4d(0x139)+_0x535b29['id']+_0x320e4d(0xcc)),_0x285918++;continue;}const _0x307449=(Date['now']()-_0x535b29['createdAt'][_0x320e4d(0x177)]())/(0x3e8*0x3c*0x3c);if(_0x307449<0x1){console[_0x320e4d(0x140)](_0x320e4d(0x139)+_0x535b29['id']+_0x320e4d(0x19b)+_0x307449[_0x320e4d(0x160)](0x1)+_0x320e4d(0x1aa)),_0x285918++;continue;}console[_0x320e4d(0x140)]('🔍\x20[GLOBAL]\x20Checking\x20old\x20payment\x20'+_0x535b29['id']+_0x320e4d(0x14e)+_0x307449[_0x320e4d(0x160)](0x1)+'h)'),await this[_0x320e4d(0xb6)](_0x535b29),_0x4c5df5++,await new Promise(_0x24ae77=>setTimeout(_0x24ae77,0x7d0));}catch(_0x2b5759){console[_0x320e4d(0xcb)](_0x320e4d(0xba)+_0x535b29['id']+':',_0x2b5759),this[_0x320e4d(0x9c)](_0x535b29['id'],_0x535b29[_0x320e4d(0x146)]||'unknown',_0x2b5759,_0x320e4d(0xd6),{'isGlobalCheck':!![],'paymentAmount':_0x535b29['amount'],'paymentCurrency':_0x535b29[_0x320e4d(0xd2)],'shopId':_0x535b29[_0x320e4d(0x103)],'createdAt':_0x535b29[_0x320e4d(0x122)]}),loggerService_1[_0x320e4d(0xd7)][_0x320e4d(0xc8)](_0x320e4d(0x18f),_0x320e4d(0xe9)+_0x535b29[_0x320e4d(0x146)],_0x2b5759);}}console['log']('✅\x20[GLOBAL]\x20Global\x20check\x20completed:\x20'+_0x4c5df5+_0x320e4d(0x191)+_0x285918+_0x320e4d(0x152)+_0x2b1f85[_0x320e4d(0x110)]+_0x320e4d(0x1a0));}catch(_0x419de7){console[_0x320e4d(0xcb)](_0x320e4d(0x15f),_0x419de7);}}async[a37_0x5e507c(0x154)](_0x3a9d23){const _0x685471=a37_0x5e507c,_0xb5fade=[],_0x5c871e=new Date();_0x5c871e[_0x685471(0x128)](_0x5c871e[_0x685471(0x13e)]()-this[_0x685471(0x10f)]),console[_0x685471(0x140)]('⏰\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20'+this[_0x685471(0x10f)]+_0x685471(0x16c)+_0x5c871e['toISOString']()+')');for(const _0xc20242 of _0x3a9d23){if(_0xc20242[_0x685471(0x122)]<_0x5c871e){console[_0x685471(0x140)](_0x685471(0x9e)+_0xc20242['id']+_0x685471(0x182)+this[_0x685471(0x10f)]+_0x685471(0xa4));try{this[_0x685471(0xb1)](_0xc20242['id'],_0xc20242[_0x685471(0x146)]||'unknown',_0x685471(0x18b),'EXPIRED',_0x685471(0xa1),{'reason':_0x685471(0xbf)+this[_0x685471(0x10f)]+_0x685471(0x13f),'createdAt':_0xc20242[_0x685471(0x122)],'daysSinceCreation':Math[_0x685471(0xe7)]((Date[_0x685471(0xc7)]()-_0xc20242['createdAt']['getTime']())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0xc20242[_0x685471(0x198)],'paymentCurrency':_0xc20242[_0x685471(0xd2)],'shopId':_0xc20242['shopId']}),await database_1[_0x685471(0xb2)][_0x685471(0xdd)][_0x685471(0x165)]({'where':{'id':_0xc20242['id']},'data':{'status':'EXPIRED','updatedAt':new Date(),'adminNotes':'Automatically\x20expired\x20after\x20'+this[_0x685471(0x10f)]+_0x685471(0xa5)}}),await database_1[_0x685471(0xb2)][_0x685471(0x112)][_0x685471(0xd5)]({'data':{'paymentId':_0xc20242['id'],'shopId':_0xc20242[_0x685471(0x103)],'event':_0x685471(0x199),'statusCode':0xc8,'responseBody':JSON[_0x685471(0x174)]({'reason':'Payment\x20older\x20than\x20'+this[_0x685471(0x10f)]+_0x685471(0x13f),'createdAt':_0xc20242[_0x685471(0x122)],'expiredAt':new Date()['toISOString'](),'daysSinceCreation':Math[_0x685471(0xe7)]((Date[_0x685471(0xc7)]()-_0xc20242[_0x685471(0x122)][_0x685471(0x177)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x685471(0xf4)](_0xc20242,_0x685471(0xce)),await this[_0x685471(0x181)](_0xc20242,_0x685471(0xce)),this['clearPaymentTimers'](_0xc20242['id']),_0xb5fade[_0x685471(0x138)](_0xc20242['id']),console['log'](_0x685471(0x15b)+_0xc20242['id']+_0x685471(0x11b)+this['EXPIRY_DAYS']+_0x685471(0x156));}catch(_0x1ae474){console['error'](_0x685471(0xef)+_0xc20242['id']+':',_0x1ae474),this[_0x685471(0x9c)](_0xc20242['id'],_0xc20242[_0x685471(0x146)]||'unknown',_0x1ae474,_0x685471(0xa1),{'reason':_0x685471(0xb4),'createdAt':_0xc20242['createdAt'],'daysSinceCreation':Math[_0x685471(0xe7)]((Date['now']()-_0xc20242['createdAt'][_0x685471(0x177)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0xb5fade;}async['checkSinglePayment'](_0x4e125f){const _0x20c079=a37_0x5e507c;if(!_0x4e125f[_0x20c079(0x146)]){console[_0x20c079(0x140)](_0x20c079(0xda)+_0x4e125f['id']+_0x20c079(0xc9));return;}console[_0x20c079(0x140)]('🔍\x20[CHECK]\x20Checking\x20'+_0x4e125f[_0x20c079(0x13a)]+_0x20c079(0x17e)+_0x4e125f['id']+'\x20('+_0x4e125f[_0x20c079(0x146)]+')');try{let _0x5dd701;_0x4e125f['gateway']===_0x20c079(0xae)?(_0x5dd701=await this[_0x20c079(0x12e)][_0x20c079(0xb3)](_0x4e125f['gatewayPaymentId']),console[_0x20c079(0x140)](_0x20c079(0x150)+_0x4e125f['id']+_0x20c079(0x100)+_0x5dd701[_0x20c079(0xdb)])):(_0x5dd701=await this['coinToPayService'][_0x20c079(0xb3)](_0x4e125f[_0x20c079(0x146)]),console[_0x20c079(0x140)](_0x20c079(0xf1)+_0x4e125f['id']+_0x20c079(0x100)+_0x5dd701[_0x20c079(0xdb)]));_0x5dd701[_0x20c079(0x129)]&&console[_0x20c079(0x140)](_0x20c079(0x130)+_0x4e125f['id']+_0x20c079(0x17f),{'iban':_0x5dd701[_0x20c079(0x129)]['iban']||'not\x20found','transactionId':_0x5dd701[_0x20c079(0x129)][_0x20c079(0x10e)],'createdOn':_0x5dd701[_0x20c079(0x129)][_0x20c079(0x179)],'confirmedOn':_0x5dd701[_0x20c079(0x129)][_0x20c079(0x11d)]||_0x20c079(0x105)});if(_0x5dd701[_0x20c079(0xdb)]!==_0x4e125f[_0x20c079(0xdb)]){console['log'](_0x20c079(0x14b)+_0x4e125f['id']+_0x20c079(0x11e)+_0x4e125f['status']+'\x20to\x20'+_0x5dd701[_0x20c079(0xdb)]),this[_0x20c079(0xb1)](_0x4e125f['id'],_0x4e125f[_0x20c079(0x146)],_0x4e125f[_0x20c079(0xdb)],_0x5dd701[_0x20c079(0xdb)],_0x20c079(0xd6),{'paymentDetails':_0x5dd701[_0x20c079(0x129)],'amount':_0x5dd701[_0x20c079(0x198)],'currency':_0x5dd701[_0x20c079(0xd2)],'shopId':_0x4e125f['shopId'],'checkTimestamp':new Date()[_0x20c079(0x1a6)]()});const _0x58a160={'status':_0x5dd701[_0x20c079(0xdb)],'updatedAt':new Date()};if(_0x5dd701[_0x20c079(0xdb)]===_0x20c079(0xb9)&&_0x4e125f[_0x20c079(0xdb)]!=='PAID'){_0x58a160[_0x20c079(0xa2)]=new Date();if(!_0x4e125f[_0x20c079(0xa6)]){const _0x480820=await currencyService_1[_0x20c079(0x196)]['convertToUSDT'](_0x4e125f[_0x20c079(0x198)],_0x4e125f[_0x20c079(0xd2)]);_0x58a160[_0x20c079(0xa6)]=_0x480820;const _0x52f0ed=await this[_0x20c079(0xfa)](_0x4e125f[_0x20c079(0x103)],_0x4e125f[_0x20c079(0x13a)]),_0x9fa206=_0x480820*(0x1-_0x52f0ed/0x64);_0x58a160['amountAfterGatewayCommissionUSDT']=_0x9fa206,console[_0x20c079(0x140)]('💰\x20[CHECK]\x20Payment\x20'+_0x4e125f['id']+_0x20c079(0x15a)),console[_0x20c079(0x140)](_0x20c079(0x17b)+_0x4e125f[_0x20c079(0x198)]+'\x20'+_0x4e125f['currency']+_0x20c079(0xf3)+_0x480820[_0x20c079(0x160)](0x6)+_0x20c079(0x101)),console[_0x20c079(0x140)](_0x20c079(0x12c)+_0x4e125f[_0x20c079(0x13a)]+_0x20c079(0xa0)+_0x52f0ed+'%'),console[_0x20c079(0x140)](_0x20c079(0xd4)+_0x9fa206[_0x20c079(0x160)](0x6)+_0x20c079(0x101));}console[_0x20c079(0x140)](_0x20c079(0x17d)+_0x4e125f['id']+_0x20c079(0x10c)+_0x58a160[_0x20c079(0xa2)][_0x20c079(0x1a6)]());}if(_0x5dd701[_0x20c079(0x129)]){const _0x3d6239=_0x5dd701[_0x20c079(0x129)];_0x3d6239['iban']&&(_0x58a160[_0x20c079(0x149)]=_0x3d6239[_0x20c079(0xcd)],console[_0x20c079(0x140)]('🏦\x20[CHECK]\x20Saved\x20IBAN:\x20'+_0x3d6239[_0x20c079(0xcd)]));if(_0x3d6239[_0x20c079(0x1a9)]){const _0x5914d3=_0x4e125f[_0x20c079(0xbe)]||'',_0xdaddf9=_0x20c079(0x109)+_0x3d6239[_0x20c079(0x1a9)];_0x58a160[_0x20c079(0xbe)]=_0x5914d3?_0x5914d3+'\x0a\x0a'+_0xdaddf9:_0xdaddf9,console[_0x20c079(0x140)](_0x20c079(0x126));}_0x3d6239[_0x20c079(0x10e)]&&console[_0x20c079(0x140)](_0x20c079(0xb8)+_0x3d6239['transactionId']),_0x3d6239[_0x20c079(0x11d)]&&console[_0x20c079(0x140)](_0x20c079(0x163)+_0x3d6239[_0x20c079(0x11d)]);}await database_1[_0x20c079(0xb2)][_0x20c079(0xdd)]['update']({'where':{'id':_0x4e125f['id']},'data':_0x58a160});if(_0x5dd701[_0x20c079(0xdb)]==='PAID'&&_0x4e125f[_0x20c079(0xdb)]!=='PAID'){console[_0x20c079(0x140)](_0x20c079(0x145)+_0x4e125f['id']+_0x20c079(0xc4));const _0x53698a=await database_1[_0x20c079(0xb2)][_0x20c079(0xdd)][_0x20c079(0x15e)]({'where':{'id':_0x4e125f['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x53698a?.[_0x20c079(0x186)]&&_0x53698a[_0x20c079(0xff)])try{const _0x5acb4b=_0x53698a[_0x20c079(0xff)];console[_0x20c079(0x140)](_0x20c079(0x167)+_0x5acb4b['id']+':\x20type='+_0x5acb4b[_0x20c079(0x194)]+_0x20c079(0x13b)+_0x5acb4b[_0x20c079(0xd8)]+_0x20c079(0x117)+_0x5acb4b[_0x20c079(0xdb)]);const _0x5e8815=_0x5acb4b['currentPayments']+0x1,_0x4e9b0a=_0x5acb4b[_0x20c079(0x194)]===_0x20c079(0x162)?'COMPLETED':_0x5acb4b[_0x20c079(0xdb)];await database_1[_0x20c079(0xb2)]['paymentLink']['update']({'where':{'id':_0x5acb4b['id']},'data':{'currentPayments':_0x5e8815,'status':_0x4e9b0a,'updatedAt':new Date()}}),console[_0x20c079(0x140)](_0x20c079(0x190)+_0x5acb4b['id']+_0x20c079(0x144)+_0x5acb4b[_0x20c079(0xd8)]+_0x20c079(0xf3)+_0x5e8815+_0x20c079(0x117)+_0x5acb4b[_0x20c079(0xdb)]+_0x20c079(0xf3)+_0x4e9b0a);}catch(_0x471e79){console['error'](_0x20c079(0xdc),_0x471e79);}else console[_0x20c079(0x140)](_0x20c079(0x145)+_0x4e125f['id']+'\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link');}await database_1['default'][_0x20c079(0x112)][_0x20c079(0xd5)]({'data':{'paymentId':_0x4e125f['id'],'shopId':_0x4e125f[_0x20c079(0x103)],'event':'cointopay_status_check_'+_0x5dd701['status'][_0x20c079(0xd1)](),'statusCode':0xc8,'responseBody':JSON[_0x20c079(0x174)]({'oldStatus':_0x4e125f[_0x20c079(0xdb)],'newStatus':_0x5dd701['status'],'paymentDetails':_0x5dd701[_0x20c079(0x129)],'checkedAt':new Date()[_0x20c079(0x1a6)]()})}}),await this[_0x20c079(0xf4)](_0x4e125f,_0x5dd701['status']),await this[_0x20c079(0x181)](_0x4e125f,_0x5dd701[_0x20c079(0xdb)]),_0x5dd701['status']!==_0x20c079(0x18b)&&(console['log'](_0x20c079(0x12f)+_0x4e125f['id']+_0x20c079(0x10d)+_0x5dd701[_0x20c079(0xdb)]+',\x20clearing\x20individual\x20timers'),this[_0x20c079(0xbc)](_0x4e125f['id'])),console['log'](_0x20c079(0x1a7)+_0x4e125f['id']+'\x20updated\x20successfully');}else console[_0x20c079(0x140)](_0x20c079(0x130)+_0x4e125f['id']+'\x20status\x20unchanged\x20('+_0x5dd701['status']+')'),this[_0x20c079(0xb1)](_0x4e125f['id'],_0x4e125f[_0x20c079(0x146)],_0x4e125f[_0x20c079(0xdb)],_0x5dd701[_0x20c079(0xdb)],_0x20c079(0xd6),{'statusUnchanged':!![],'paymentDetails':_0x5dd701['paymentDetails'],'amount':_0x5dd701[_0x20c079(0x198)],'currency':_0x5dd701[_0x20c079(0xd2)],'shopId':_0x4e125f[_0x20c079(0x103)],'checkTimestamp':new Date()['toISOString']()});}catch(_0xd7d942){console[_0x20c079(0xcb)]('❌\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20'+_0x4e125f['id']+':',_0xd7d942),this[_0x20c079(0x9c)](_0x4e125f['id'],_0x4e125f[_0x20c079(0x146)],_0xd7d942,_0x20c079(0xd6),{'paymentAmount':_0x4e125f[_0x20c079(0x198)],'paymentCurrency':_0x4e125f[_0x20c079(0xd2)],'shopId':_0x4e125f[_0x20c079(0x103)],'createdAt':_0x4e125f[_0x20c079(0x122)]}),await database_1[_0x20c079(0xb2)][_0x20c079(0x112)][_0x20c079(0xd5)]({'data':{'paymentId':_0x4e125f['id'],'shopId':_0x4e125f[_0x20c079(0x103)],'event':_0x20c079(0x9d),'statusCode':0x1f4,'responseBody':JSON[_0x20c079(0x174)]({'error':_0xd7d942 instanceof Error?_0xd7d942[_0x20c079(0x17c)]:_0x20c079(0xcf),'gatewayPaymentId':_0x4e125f[_0x20c079(0x146)],'checkedAt':new Date()[_0x20c079(0x1a6)]()})}});}}async[a37_0x5e507c(0xf4)](_0x3274ed,_0x33c911){const _0x27ff67=a37_0x5e507c,_0x45625c=Date[_0x27ff67(0xc7)]();try{const _0x478ece=_0x3274ed[_0x27ff67(0xdf)],_0x5f21f3=_0x478ece[_0x27ff67(0x189)];if(!_0x5f21f3?.[_0x27ff67(0x172)]){console['log']('No\x20webhook\x20URL\x20configured\x20for\x20shop\x20'+_0x478ece['id']);return;}const _0x5bf431=_0x33c911===_0x27ff67(0xb9)?_0x27ff67(0xe4):_0x33c911==='FAILED'?_0x27ff67(0xc5):_0x33c911===_0x27ff67(0xce)?_0x27ff67(0xc5):_0x27ff67(0xe1);if(!_0x5f21f3[_0x27ff67(0x127)]?.[_0x27ff67(0x15c)](_0x5bf431)){console['log'](_0x27ff67(0x142)+_0x5bf431+_0x27ff67(0x1a3)+_0x478ece['id']);return;}const _0x21b3c2=(0x0,gateway_1[_0x27ff67(0xad)])(_0x3274ed['gateway'])||_0x3274ed[_0x27ff67(0x13a)],_0x275a97={'event':_0x5bf431,'payment':{'id':_0x3274ed['id'],'order_id':_0x3274ed['orderId'],'gateway_order_id':_0x3274ed[_0x27ff67(0x9b)],'gateway':_0x21b3c2,'amount':_0x3274ed[_0x27ff67(0x198)],'currency':_0x3274ed[_0x27ff67(0xd2)],'status':_0x33c911[_0x27ff67(0xd1)](),'customer_email':_0x3274ed['customerEmail'],'customer_name':_0x3274ed[_0x27ff67(0x159)],'created_at':_0x3274ed[_0x27ff67(0x122)],'updated_at':new Date()}},_0x385734=await fetch(_0x5f21f3[_0x27ff67(0x172)],{'method':'POST','headers':{'Content-Type':_0x27ff67(0xaa),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON['stringify'](_0x275a97)}),_0xae0346=Date[_0x27ff67(0xc7)]()-_0x45625c,_0x5c81c9=_0x385734['ok']?_0x27ff67(0x168):await _0x385734[_0x27ff67(0xaf)]();loggerService_1[_0x27ff67(0xd7)]['logShopWebhookSent'](_0x3274ed['shopId'],_0x5f21f3[_0x27ff67(0x172)],_0x5bf431,_0x385734['status'],_0xae0346,_0x275a97),console[_0x27ff67(0x140)](_0x27ff67(0x1a1)+_0x5f21f3[_0x27ff67(0x172)]+_0x27ff67(0xe3)+_0x385734[_0x27ff67(0xdb)]+'\x20('+_0xae0346+_0x27ff67(0xf6));}catch(_0x225d11){console[_0x27ff67(0xcb)]('Failed\x20to\x20send\x20shop\x20webhook:',_0x225d11),loggerService_1['loggerService'][_0x27ff67(0x19f)](_0x3274ed[_0x27ff67(0x103)],_0x3274ed[_0x27ff67(0xdf)]?.['settings']?.['webhookUrl']||_0x27ff67(0xf7),'webhook_send',_0x225d11,{});}}async[a37_0x5e507c(0x181)](_0x5237bc,_0xbd7bd2){const _0x48e0a2=a37_0x5e507c;try{const _0x29b282={'PENDING':_0x48e0a2(0x173),'PAID':'paid','FAILED':_0x48e0a2(0x19a),'EXPIRED':'expired'},_0x7b2798=_0x29b282[_0xbd7bd2];if(!_0x7b2798||_0x7b2798===_0x48e0a2(0x173))return;await telegramBotService_1['telegramBotService']['sendPaymentNotification'](_0x5237bc['shopId'],_0x5237bc,_0x7b2798);}catch(_0x2a9e25){console[_0x48e0a2(0xcb)](_0x48e0a2(0xe6),_0x2a9e25);}}async[a37_0x5e507c(0x184)](_0x2868a1){const _0xd0b1a6=a37_0x5e507c;console[_0xd0b1a6(0x140)](_0xd0b1a6(0x104)+_0x2868a1);const _0x793c1e=await database_1['default'][_0xd0b1a6(0xdd)]['findUnique']({'where':{'id':_0x2868a1},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x793c1e)throw new Error(_0xd0b1a6(0xe0));if(_0x793c1e[_0xd0b1a6(0x13a)]!=='cointopay'&&_0x793c1e[_0xd0b1a6(0x13a)]!==_0xd0b1a6(0xae))throw new Error(_0xd0b1a6(0x143));console['log'](_0xd0b1a6(0x169)+_0x793c1e[_0xd0b1a6(0x13a)]+'\x20payment\x20'+_0x2868a1),await this[_0xd0b1a6(0xb6)](_0x793c1e),console[_0xd0b1a6(0x140)](_0xd0b1a6(0xed)+_0x2868a1);}[a37_0x5e507c(0x185)](){const _0x2a2075=a37_0x5e507c,_0x389945=this['globalCheckInterval']?this[_0x2a2075(0x19e)]:undefined,_0x50c093=Array[_0x2a2075(0xf0)](this[_0x2a2075(0xa8)][_0x2a2075(0xd9)]())[_0x2a2075(0x118)](_0x26e949=>({'paymentId':_0x26e949['paymentId'],'gatewayPaymentId':_0x26e949[_0x2a2075(0x146)],'createdAt':_0x26e949[_0x2a2075(0x122)],'timersCount':_0x26e949[_0x2a2075(0xfd)][_0x2a2075(0x110)]}));return{'isActive':!!this[_0x2a2075(0xb5)],'globalCheckIntervalMinutes':this[_0x2a2075(0x19e)]/(0x3e8*0x3c),'expiryDays':this[_0x2a2075(0x10f)],'activeIndividualTimers':this[_0x2a2075(0xa8)]['size'],'nextGlobalCheckIn':_0x389945,'paymentTimersDetails':_0x50c093};}[a37_0x5e507c(0xe2)](_0x58a6e8){const _0x1e69d8=a37_0x5e507c,_0x233cf0=this[_0x1e69d8(0xa8)][_0x1e69d8(0x148)](_0x58a6e8);if(_0x233cf0)return{'hasTimers':!![],'timersCount':_0x233cf0[_0x1e69d8(0xfd)]['length'],'createdAt':_0x233cf0[_0x1e69d8(0x122)],'gatewayPaymentId':_0x233cf0[_0x1e69d8(0x146)]};return{'hasTimers':![]};}async[a37_0x5e507c(0xfa)](_0x9ebf83,_0x34fb7d){const _0xa30d0f=a37_0x5e507c;try{const _0x3099ba=await database_1['default'][_0xa30d0f(0xdf)][_0xa30d0f(0x15e)]({'where':{'id':_0x9ebf83},'select':{'gatewaySettings':!![]}});if(!_0x3099ba?.[_0xa30d0f(0x153)])return console[_0xa30d0f(0x140)](_0xa30d0f(0x18e)+_0x9ebf83+_0xa30d0f(0x1a8)),0xa;const _0x2b53a6=JSON[_0xa30d0f(0x12d)](_0x3099ba[_0xa30d0f(0x153)]);for(const [_0x1efd98,_0x732e4d]of Object['entries'](_0x2b53a6)){if(_0x1efd98['toLowerCase']()===_0x34fb7d[_0xa30d0f(0xd1)]()){const _0x3552d7=_0x732e4d[_0xa30d0f(0xc1)]||0xa;return console[_0xa30d0f(0x140)]('Gateway\x20'+_0x34fb7d+_0xa30d0f(0x125)+_0x9ebf83+':\x20'+_0x3552d7+'%'),_0x3552d7;}}return console[_0xa30d0f(0x140)](_0xa30d0f(0x14d)+_0x34fb7d+_0xa30d0f(0xc6)+_0x9ebf83+',\x20using\x20default\x2010%'),0xa;}catch(_0x3e3ee5){return console['error'](_0xa30d0f(0xea)+_0x9ebf83+_0xa30d0f(0xfe)+_0x34fb7d+':',_0x3e3ee5),0xa;}}}function a37_0xa4f3(){const _0x862a76=[',\x20stopping\x20individual\x20checks','\x20\x20\x20Amount\x20after\x20commission:\x20','create','status_check','loggerService','currentPayments','values','⚠️\x20[CHECK]\x20Payment\x20','status','❌\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','payment','🪙\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','shop','Payment\x20not\x20found','payment.pending','getPaymentTimerInfo','\x20with\x20status\x20','payment.success','✅\x20[HOURLY]\x20Payment\x20','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','floor','__importDefault','/status/','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','\x20has\x20no\x20gatewayPaymentId','⏰\x20[GLOBAL]\x20Found\x20','✅\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','\x20status\x20is\x20','❌\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','from','📊\x20[CHECK]\x20CoinToPay\x20payment\x20','12243RtvqUC','\x20->\x20','sendShopWebhook','CoinToPay2Service','ms)','unknown','delete','✅\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','getGatewayCommission','.\x20Remaining\x20active\x20timers:\x20','checkAllPendingPayments','timers',',\x20gateway\x20','paymentLink','\x20status:\x20','\x20USDT','❌\x20[TIMER]\x20Failed\x20individual\x20check\x20#','shopId','🔍\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','not\x20confirmed','\x20completed\x20for\x20payment\x20','2121TEtqHz','\x20timers\x20for\x20payment\x20','Bank\x20Details:\x20','🪙\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','✅\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','\x20marked\x20as\x20paid\x20at:\x20','\x20status\x20changed\x20to\x20','transactionId','EXPIRY_DAYS','length','\x20\x20\x20-\x20Amount:\x20','webhookLog','schedule_created','stack','🔍\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','🪙\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:',',\x20status=','map','\x20for\x20payment\x20','⚠️\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','\x20individual\x20payment\x20timers','confirmedOn','\x20status\x20from\x20','🪙\x20[TIMER]\x20Individual\x20check\x20#','\x20seconds\x20(','\x20\x20\x20-\x20gatewayPaymentId:\x20','createdAt','__esModule','🛑\x20[SHUTDOWN]\x20Cleared\x20','\x20commission\x20for\x20shop\x20','🏦\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes','webhookEvents','setDate','paymentDetails','./telegramBotService','🪙\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','\x20\x20\x20Gateway\x20','parse','coinToPay2Service','🧹\x20[CHECK]\x20Payment\x20','📊\x20[CHECK]\x20Payment\x20','🛑\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','coinToPayStatusService','44012ewClbM','❌\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','\x20initial\x20timers\x20for\x20payment\x20','\x20\x20\x20📊\x20Status:\x20','\x20found:','push','⏰\x20[GLOBAL]\x20Payment\x20','gateway',',\x20currentPayments=','\x20triggered\x20for\x20payment\x20','\x20in\x20','getDate','\x20days','log','102hqJnNE','Webhook\x20event\x20','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','\x20updated:\x20currentPayments=','📈\x20[COINTOPAY]\x20Payment\x20','gatewayPaymentId','has','get','remitterIban','5\x20minutes','🔄\x20[CHECK]\x20Updating\x20payment\x20','./loggerService','No\x20specific\x20commission\x20found\x20for\x20gateway\x20','\x20(age:\x20','📊\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','📊\x20[CHECK]\x20CoinToPay2\x20payment\x20','\x20\x20\x20-\x20Status:\x20','\x20skipped,\x20','gatewaySettings','checkExpiredPayments','249WjtjAj','-day\x20timeout','\x20\x20\x20📝\x20Details:','checkSinglePaymentById','customerName','\x20amounts\x20calculated:','✅\x20[EXPIRY]\x20Payment\x20','includes','\x20\x20\x20-\x20ShopId:\x20','findUnique','❌\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','toFixed','🧹\x20[DEBUG]\x20Cleared\x20timer\x20#','SINGLE','✅\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','9992016nkONWY','update','2\x20minutes','📈\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','Success','✅\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','🪙\x20[DEBUG]\x20Creating\x20','\x20days\x20(created\x20before\x20','10014ssMtjP','❌\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','startPeriodicStatusCheck','timestamp','🧹\x20[DEBUG]\x20Clearing\x20','webhookUrl','created','stringify','⏰\x20[HOURLY]\x20Payment\x20','\x20\x20\x20📝\x20Context:','getTime','❌\x20[CHECK]\x20Payment\x20','createdOn','\x20to\x20clear','\x20\x20\x20Amount:\x20','message','💰\x20[CHECK]\x20Payment\x20','\x20payment\x20','\x20details:','stopPeriodicStatusCheck','sendPaymentStatusNotification','\x20is\x20older\x20than\x20','⏰\x20[DEBUG]\x20Scheduled\x20check\x20#','checkPaymentById','getServiceStats','paymentLinkId','CoinToPayStatusService','3137960LyUSvu','settings','6321104RpLXTr','PENDING','\x20\x20\x20📅\x20Time:\x20','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','cointopay','✅\x20[COINTOPAY]\x20Payment\x20link\x20','\x20checked,\x20','COINTOPAY_ERROR','14723VUzzNE','type','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','currencyService','schedulePaymentChecks','amount','cointopay_auto_expired','failed','\x20is\x20too\x20new\x20(','\x20\x20\x20❌\x20Error:\x20','❌\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','GLOBAL_CHECK_INTERVAL_MS','logShopWebhookError','\x20expired','Shop\x20webhook\x20sent\x20to\x20','CoinToPayService','\x20not\x20enabled\x20for\x20shop\x20','\x20not\x20found,\x20clearing\x20timers','coinToPayService','toISOString','✅\x20[CHECK]\x20Payment\x20',',\x20using\x20default\x20commission\x2010%','bankDetails','h),\x20skipping\x20global\x20check','catch','gatewayOrderId','logCoinToPayError','cointopay_status_check_error','⏰\x20[EXPIRY]\x20Payment\x20','✅\x20[TIMER]\x20Individual\x20check\x20#','\x20commission:\x20','auto_expire','paidAt','\x20pending\x20CoinToPay\x20payments','\x20days,\x20marking\x20as\x20EXPIRED','\x20days\x20without\x20payment\x20confirmation','amountUSDT','./gateways/coinToPay2Service','paymentTimers','size','application/json','\x20\x20\x20-\x20Gateway:\x20','../config/database','getGatewayIdByName','cointopay2','text','❌\x20[HOURLY]\x20Payment\x20','logCoinToPayStatus','default','checkPaymentStatus','Failed\x20to\x20mark\x20payment\x20as\x20expired','globalCheckInterval','checkSinglePayment','findMany','🆔\x20[CHECK]\x20Transaction\x20ID:\x20','PAID','❌\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','\x20\x20\x20-\x20GatewayPaymentId:\x20','clearPaymentTimers','🪙\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','adminNotes','Payment\x20older\x20than\x20','delay','commission','1\x20minute','4670AVYDLm','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','payment.failed','\x20in\x20shop\x20','now','logWhiteDomainError','\x20has\x20no\x20gatewayPaymentId,\x20skipping','🪙\x20[ERROR]\x20CoinToPay\x20Error:\x20','error','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','iban','EXPIRED','Unknown\x20error','🪙\x20[GLOBAL]\x20Found\x20','toLowerCase','currency'];a37_0xa4f3=function(){return _0x862a76;};return a37_0xa4f3();}exports[a37_0x5e507c(0x187)]=CoinToPayStatusService,exports[a37_0x5e507c(0x132)]=new CoinToPayStatusService();