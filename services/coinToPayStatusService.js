'use strict';const a38_0x1ac5b6=a38_0x5b5d;(function(_0x4020a3,_0x52b17d){const _0x17a785=a38_0x5b5d,_0x5721c2=_0x4020a3();while(!![]){try{const _0x445c2f=-parseInt(_0x17a785(0x220))/0x1*(-parseInt(_0x17a785(0x22f))/0x2)+-parseInt(_0x17a785(0x1c5))/0x3*(parseInt(_0x17a785(0x241))/0x4)+-parseInt(_0x17a785(0x226))/0x5*(-parseInt(_0x17a785(0x234))/0x6)+-parseInt(_0x17a785(0x247))/0x7*(parseInt(_0x17a785(0x200))/0x8)+parseInt(_0x17a785(0x204))/0x9*(parseInt(_0x17a785(0x1c6))/0xa)+-parseInt(_0x17a785(0x27f))/0xb+parseInt(_0x17a785(0x1bd))/0xc;if(_0x445c2f===_0x52b17d)break;else _0x5721c2['push'](_0x5721c2['shift']());}catch(_0x50610b){_0x5721c2['push'](_0x5721c2['shift']());}}}(a38_0x3c0d,0xb2754));var __importDefault=this&&this[a38_0x1ac5b6(0x232)]||function(_0x379e25){const _0x2fa7cc=a38_0x1ac5b6;return _0x379e25&&_0x379e25[_0x2fa7cc(0x1dc)]?_0x379e25:{'default':_0x379e25};};Object[a38_0x1ac5b6(0x214)](exports,a38_0x1ac5b6(0x1dc),{'value':!![]}),exports[a38_0x1ac5b6(0x198)]=exports[a38_0x1ac5b6(0x1b7)]=void 0x0;function a38_0x5b5d(_0x1dfcf0,_0x20e06e){const _0x3c0dd0=a38_0x3c0d();return a38_0x5b5d=function(_0x5b5d5b,_0x5cf48c){_0x5b5d5b=_0x5b5d5b-0x177;let _0x475ca1=_0x3c0dd0[_0x5b5d5b];return _0x475ca1;},a38_0x5b5d(_0x1dfcf0,_0x20e06e);}const coinToPayService_1=require(a38_0x1ac5b6(0x22b)),coinToPay2Service_1=require(a38_0x1ac5b6(0x278)),gateway_1=require(a38_0x1ac5b6(0x1d8)),database_1=__importDefault(require(a38_0x1ac5b6(0x1b6))),telegramBotService_1=require('./telegramBotService'),loggerService_1=require(a38_0x1ac5b6(0x1fd)),currencyService_1=require('./currencyService');class CoinToPayStatusService{constructor(){const _0x45e175=a38_0x1ac5b6;this[_0x45e175(0x203)]=null,this[_0x45e175(0x1ca)]=0x3c*0x3c*0x3e8,this[_0x45e175(0x1a4)]=0x5,this['paymentTimers']=new Map(),this[_0x45e175(0x178)]=new coinToPayService_1[(_0x45e175(0x1e7))](),this[_0x45e175(0x27b)]=new coinToPay2Service_1['CoinToPay2Service'](),console[_0x45e175(0x1c8)](_0x45e175(0x206));}[a38_0x1ac5b6(0x1c0)](_0x554a11,_0x32cc2e){const _0x3f32ff=a38_0x1ac5b6;console[_0x3f32ff(0x1c8)](_0x3f32ff(0x18f)),console[_0x3f32ff(0x1c8)]('\x20\x20\x20-\x20paymentId:\x20'+_0x554a11),console[_0x3f32ff(0x1c8)](_0x3f32ff(0x1af)+_0x32cc2e),this[_0x3f32ff(0x1be)](_0x554a11);const _0x30d561=[],_0x2a323d=new Date(),_0x5d2fdc=[{'delay':0x1*0x3c*0x3e8,'description':'1\x20minute'},{'delay':0x2*0x3c*0x3e8,'description':_0x3f32ff(0x1b4)},{'delay':0x5*0x3c*0x3e8,'description':_0x3f32ff(0x229)},{'delay':0x5*0x3c*0x3e8,'description':_0x3f32ff(0x229)}];console[_0x3f32ff(0x1c8)]('ü™ô\x20[DEBUG]\x20Creating\x20'+_0x5d2fdc[_0x3f32ff(0x22a)]+_0x3f32ff(0x1e3)+_0x554a11);let _0x54356a=0x0;_0x5d2fdc[_0x3f32ff(0x201)]((_0xf5824e,_0x6a25a5)=>{const _0x5eb23e=_0x3f32ff;_0x54356a+=_0xf5824e[_0x5eb23e(0x1cc)];const _0x5b2845=setTimeout(async()=>{const _0x129120=_0x5eb23e;console[_0x129120(0x1c8)](_0x129120(0x1d7)+(_0x6a25a5+0x1)+_0x129120(0x252)+_0x554a11+_0x129120(0x262)+_0xf5824e[_0x129120(0x17f)]+')');try{await this[_0x129120(0x209)](_0x554a11),console[_0x129120(0x1c8)](_0x129120(0x23d)+(_0x6a25a5+0x1)+_0x129120(0x20b)+_0x554a11);}catch(_0x5971b6){console[_0x129120(0x1ed)](_0x129120(0x221)+(_0x6a25a5+0x1)+_0x129120(0x1c1)+_0x554a11+':',_0x5971b6),this[_0x129120(0x1ab)](_0x554a11,_0x32cc2e,_0x5971b6,'status_check',{'checkNumber':_0x6a25a5+0x1,'scheduledAfter':_0xf5824e[_0x129120(0x17f)],'isIndividualCheck':!![]});}},_0x54356a);_0x30d561['push'](_0x5b2845),console[_0x5eb23e(0x1c8)]('‚è∞\x20[DEBUG]\x20Scheduled\x20check\x20#'+(_0x6a25a5+0x1)+_0x5eb23e(0x1c1)+_0x554a11+_0x5eb23e(0x1ff)+_0x54356a/0x3e8+_0x5eb23e(0x22c)+_0xf5824e['description']+')');});const _0x21b364=setInterval(async()=>{const _0x46c03d=_0x3f32ff;console[_0x46c03d(0x1c8)](_0x46c03d(0x213)+_0x554a11);try{const _0x3c1de4=await database_1[_0x46c03d(0x21c)][_0x46c03d(0x1a5)][_0x46c03d(0x1e4)]({'where':{'id':_0x554a11},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x3c1de4){console[_0x46c03d(0x1c8)]('‚ùå\x20[HOURLY]\x20Payment\x20'+_0x554a11+_0x46c03d(0x189)),this[_0x46c03d(0x1be)](_0x554a11);return;}console[_0x46c03d(0x1c8)](_0x46c03d(0x1a9)+_0x554a11+'\x20current\x20status:\x20'+_0x3c1de4[_0x46c03d(0x1ba)]);if(_0x3c1de4['status']!=='PENDING'){console[_0x46c03d(0x1c8)](_0x46c03d(0x1c9)+_0x554a11+_0x46c03d(0x1db)+_0x3c1de4['status']+_0x46c03d(0x1df)),this['clearPaymentTimers'](_0x554a11);return;}const _0x5796ee=Math['floor']((Date['now']()-_0x3c1de4[_0x46c03d(0x1c4)]['getTime']())/(0x3e8*0x3c*0x3c*0x18));if(_0x5796ee>=this[_0x46c03d(0x1a4)]){console[_0x46c03d(0x1c8)](_0x46c03d(0x280)+_0x554a11+'\x20is\x20older\x20than\x20'+this[_0x46c03d(0x1a4)]+'\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check'),this[_0x46c03d(0x1be)](_0x554a11);return;}await this[_0x46c03d(0x209)](_0x554a11),console[_0x46c03d(0x1c8)](_0x46c03d(0x1aa)+_0x554a11);}catch(_0x31beb4){console[_0x46c03d(0x1ed)](_0x46c03d(0x26c)+_0x554a11+':',_0x31beb4),this[_0x46c03d(0x1ab)](_0x554a11,_0x32cc2e,_0x31beb4,_0x46c03d(0x1d5),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x30d561[_0x3f32ff(0x27c)](_0x21b364),this[_0x3f32ff(0x263)][_0x3f32ff(0x1bc)](_0x554a11,{'timers':_0x30d561,'paymentId':_0x554a11,'gatewayPaymentId':_0x32cc2e,'createdAt':_0x2a323d}),console['log'](_0x3f32ff(0x227)+_0x5d2fdc[_0x3f32ff(0x22a)]+'\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20'+_0x554a11),console[_0x3f32ff(0x1c8)](_0x3f32ff(0x25e)+this[_0x3f32ff(0x263)][_0x3f32ff(0x180)]),this[_0x3f32ff(0x1a1)](_0x554a11,_0x32cc2e,_0x3f32ff(0x1a8),_0x3f32ff(0x1a8),_0x3f32ff(0x1d5),{'action':_0x3f32ff(0x1d1),'scheduledChecks':_0x5d2fdc[_0x3f32ff(0x22a)],'firstCheckIn':_0x5d2fdc[0x0]['delay']/0x3e8,'totalTimers':this[_0x3f32ff(0x263)]['size']});}['clearPaymentTimers'](_0x5433c3){const _0x5c9f5d=a38_0x1ac5b6,_0x18567e=this['paymentTimers'][_0x5c9f5d(0x276)](_0x5433c3);_0x18567e?(console['log']('üßπ\x20[DEBUG]\x20Clearing\x20'+_0x18567e['timers'][_0x5c9f5d(0x22a)]+_0x5c9f5d(0x1ce)+_0x5433c3),_0x18567e[_0x5c9f5d(0x1cb)]['forEach']((_0x409294,_0x40329b)=>{const _0x3cbea7=_0x5c9f5d;_0x409294&&(clearTimeout(_0x409294),clearInterval(_0x409294),console[_0x3cbea7(0x1c8)]('üßπ\x20[DEBUG]\x20Cleared\x20timer\x20#'+(_0x40329b+0x1)+_0x3cbea7(0x1c1)+_0x5433c3));}),this[_0x5c9f5d(0x263)][_0x5c9f5d(0x269)](_0x5433c3),console[_0x5c9f5d(0x1c8)]('‚úÖ\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20'+_0x5433c3+_0x5c9f5d(0x237)+this[_0x5c9f5d(0x263)][_0x5c9f5d(0x180)])):console[_0x5c9f5d(0x1c8)]('‚ö†Ô∏è\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20'+_0x5433c3+_0x5c9f5d(0x202));}async[a38_0x1ac5b6(0x209)](_0x19558d){const _0x3387b8=a38_0x1ac5b6;console[_0x3387b8(0x1c8)](_0x3387b8(0x253)+_0x19558d);const _0x456a30=await database_1['default']['payment'][_0x3387b8(0x1e4)]({'where':{'id':_0x19558d},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x456a30){console[_0x3387b8(0x1c8)]('‚ùå\x20[CHECK]\x20Payment\x20'+_0x19558d+_0x3387b8(0x233));return;}console['log'](_0x3387b8(0x1b1)+_0x19558d+_0x3387b8(0x24f)),console[_0x3387b8(0x1c8)](_0x3387b8(0x270)+_0x456a30[_0x3387b8(0x265)]),console[_0x3387b8(0x1c8)](_0x3387b8(0x21f)+_0x456a30[_0x3387b8(0x1ba)]),console['log'](_0x3387b8(0x19c)+_0x456a30[_0x3387b8(0x1f1)]),console['log']('\x20\x20\x20-\x20Amount:\x20'+_0x456a30[_0x3387b8(0x235)]+'\x20'+_0x456a30['currency']),console[_0x3387b8(0x1c8)]('\x20\x20\x20-\x20ShopId:\x20'+_0x456a30[_0x3387b8(0x19b)]);if(_0x456a30['gateway']!==_0x3387b8(0x224)&&_0x456a30[_0x3387b8(0x265)]!=='cointopay2'){console['log'](_0x3387b8(0x243)+_0x19558d+_0x3387b8(0x20c)+_0x456a30[_0x3387b8(0x265)]+')');return;}if(_0x456a30[_0x3387b8(0x1ba)]!==_0x3387b8(0x1a8)){console[_0x3387b8(0x1c8)](_0x3387b8(0x243)+_0x19558d+_0x3387b8(0x1db)+_0x456a30[_0x3387b8(0x1ba)]+_0x3387b8(0x1df)),this[_0x3387b8(0x1be)](_0x19558d);return;}if(!_0x456a30[_0x3387b8(0x1f1)]){console[_0x3387b8(0x1c8)](_0x3387b8(0x243)+_0x19558d+_0x3387b8(0x264));return;}console[_0x3387b8(0x1c8)](_0x3387b8(0x19d)+_0x19558d+_0x3387b8(0x1eb)),await this['checkSinglePayment'](_0x456a30);}['logCoinToPayStatus'](_0x5bc299,_0x24292a,_0x4f6161,_0x7b73ca,_0x27b631,_0x42ff38){const _0xafcfc7=a38_0x1ac5b6,_0x8f7051={'type':'COINTOPAY_STATUS_CHANGE','paymentId':_0x5bc299,'gatewayPaymentId':_0x24292a,'oldStatus':_0x4f6161,'newStatus':_0x7b73ca,'source':_0x27b631,'timestamp':new Date()['toISOString'](),'details':_0x42ff38||{}};loggerService_1[_0xafcfc7(0x255)][_0xafcfc7(0x1a1)](_0x8f7051),console[_0xafcfc7(0x1c8)](_0xafcfc7(0x19a)+_0x5bc299+'\x20('+_0x24292a+')'),console[_0xafcfc7(0x1c8)]('\x20\x20\x20üìä\x20Status:\x20'+_0x4f6161+'\x20->\x20'+_0x7b73ca),console[_0xafcfc7(0x1c8)]('\x20\x20\x20üìç\x20Source:\x20'+_0x27b631),console[_0xafcfc7(0x1c8)](_0xafcfc7(0x1ee)+_0x8f7051[_0xafcfc7(0x26d)]),_0x42ff38&&console['log'](_0xafcfc7(0x1e2),_0x42ff38);}[a38_0x1ac5b6(0x1ab)](_0x54d0bf,_0x1decbd,_0x1ef4be,_0x11c3fe,_0xa39cd){const _0x4c4b7c=a38_0x1ac5b6,_0x384eda={'type':_0x4c4b7c(0x268),'paymentId':_0x54d0bf,'gatewayPaymentId':_0x1decbd,'error':_0x1ef4be instanceof Error?{'message':_0x1ef4be['message'],'stack':_0x1ef4be[_0x4c4b7c(0x1b9)]}:_0x1ef4be,'source':_0x11c3fe,'timestamp':new Date()[_0x4c4b7c(0x1b0)](),'context':_0xa39cd||{}};loggerService_1[_0x4c4b7c(0x255)][_0x4c4b7c(0x1ab)](_0x384eda),console[_0x4c4b7c(0x1ed)](_0x4c4b7c(0x1b8)+_0x54d0bf+'\x20('+_0x1decbd+')'),console[_0x4c4b7c(0x1ed)](_0x4c4b7c(0x254)+(_0x1ef4be instanceof Error?_0x1ef4be['message']:_0x1ef4be)),console[_0x4c4b7c(0x1ed)](_0x4c4b7c(0x20e)+_0x11c3fe),console[_0x4c4b7c(0x1ed)](_0x4c4b7c(0x1ee)+_0x384eda[_0x4c4b7c(0x26d)]),_0xa39cd&&console[_0x4c4b7c(0x1ed)]('\x20\x20\x20üìù\x20Context:',_0xa39cd);}['startPeriodicStatusCheck'](){const _0x52023e=a38_0x1ac5b6;console[_0x52023e(0x1c8)](_0x52023e(0x1b5)),this['checkAllPendingPayments']()['catch'](_0x30b8c8=>{const _0x485256=_0x52023e;console[_0x485256(0x1ed)](_0x485256(0x250),_0x30b8c8);}),this['globalCheckInterval']=setInterval(async()=>{const _0x469c56=_0x52023e;try{console[_0x469c56(0x1c8)](_0x469c56(0x181)),await this[_0x469c56(0x215)](),console[_0x469c56(0x1c8)]('‚úÖ\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed');}catch(_0x51a07b){console[_0x469c56(0x1ed)]('‚ùå\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:',_0x51a07b);}},this[_0x52023e(0x1ca)]),console[_0x52023e(0x1c8)](_0x52023e(0x242));}[a38_0x1ac5b6(0x275)](){const _0x1e7397=a38_0x1ac5b6;console[_0x1e7397(0x1c8)](_0x1e7397(0x184));this['globalCheckInterval']&&(clearInterval(this['globalCheckInterval']),this[_0x1e7397(0x203)]=null,console[_0x1e7397(0x1c8)](_0x1e7397(0x1a6)));const _0x56e5b6=this[_0x1e7397(0x263)][_0x1e7397(0x180)];for(const [_0x5dcd62]of this['paymentTimers']){this[_0x1e7397(0x1be)](_0x5dcd62);}console[_0x1e7397(0x1c8)]('üõë\x20[SHUTDOWN]\x20Cleared\x20'+_0x56e5b6+_0x1e7397(0x251));}async['checkAllPendingPayments'](){const _0x4c88fd=a38_0x1ac5b6;try{console['log'](_0x4c88fd(0x20f));const _0x3c61dc=await database_1[_0x4c88fd(0x21c)][_0x4c88fd(0x1a5)]['findMany']({'where':{'gateway':{'in':[_0x4c88fd(0x224),_0x4c88fd(0x196)]},'status':_0x4c88fd(0x1a8),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console['log'](_0x4c88fd(0x1f2)+_0x3c61dc[_0x4c88fd(0x22a)]+_0x4c88fd(0x1e8));if(_0x3c61dc[_0x4c88fd(0x22a)]===0x0){console[_0x4c88fd(0x1c8)]('ü™ô\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check');return;}const _0x12f6a6=await this[_0x4c88fd(0x24b)](_0x3c61dc);console['log'](_0x4c88fd(0x239)+_0x12f6a6[_0x4c88fd(0x22a)]+'\x20expired\x20CoinToPay\x20payments');let _0x344dee=0x0,_0x4bbec9=0x0;for(const _0x25c1ac of _0x3c61dc){try{if(_0x12f6a6[_0x4c88fd(0x223)](_0x25c1ac['id'])){console[_0x4c88fd(0x1c8)]('‚è∞\x20[GLOBAL]\x20Payment\x20'+_0x25c1ac['id']+'\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check'),_0x4bbec9++;continue;}if(this['paymentTimers'][_0x4c88fd(0x271)](_0x25c1ac['id'])){console[_0x4c88fd(0x1c8)]('‚è∞\x20[GLOBAL]\x20Payment\x20'+_0x25c1ac['id']+_0x4c88fd(0x1f0)),_0x4bbec9++;continue;}const _0x47b5c0=(Date[_0x4c88fd(0x1fc)]()-_0x25c1ac[_0x4c88fd(0x1c4)]['getTime']())/(0x3e8*0x3c*0x3c);if(_0x47b5c0<0x1){console['log'](_0x4c88fd(0x231)+_0x25c1ac['id']+_0x4c88fd(0x1d9)+_0x47b5c0[_0x4c88fd(0x1a7)](0x1)+_0x4c88fd(0x1d4)),_0x4bbec9++;continue;}console[_0x4c88fd(0x1c8)]('üîç\x20[GLOBAL]\x20Checking\x20old\x20payment\x20'+_0x25c1ac['id']+'\x20(age:\x20'+_0x47b5c0[_0x4c88fd(0x1a7)](0x1)+'h)'),await this[_0x4c88fd(0x218)](_0x25c1ac),_0x344dee++,await new Promise(_0x480f69=>setTimeout(_0x480f69,0x7d0));}catch(_0x27bf6e){console['error'](_0x4c88fd(0x1c3)+_0x25c1ac['id']+':',_0x27bf6e),this[_0x4c88fd(0x1ab)](_0x25c1ac['id'],_0x25c1ac[_0x4c88fd(0x1f1)]||_0x4c88fd(0x25c),_0x27bf6e,_0x4c88fd(0x1d5),{'isGlobalCheck':!![],'paymentAmount':_0x25c1ac['amount'],'paymentCurrency':_0x25c1ac[_0x4c88fd(0x21b)],'shopId':_0x25c1ac[_0x4c88fd(0x19b)],'createdAt':_0x25c1ac[_0x4c88fd(0x1c4)]}),loggerService_1[_0x4c88fd(0x255)][_0x4c88fd(0x17b)](_0x4c88fd(0x224),_0x4c88fd(0x24d)+_0x25c1ac['gatewayPaymentId'],_0x27bf6e);}}console[_0x4c88fd(0x1c8)]('‚úÖ\x20[GLOBAL]\x20Global\x20check\x20completed:\x20'+_0x344dee+_0x4c88fd(0x1bf)+_0x4bbec9+'\x20skipped,\x20'+_0x12f6a6[_0x4c88fd(0x22a)]+'\x20expired');}catch(_0xce4a0c){console[_0x4c88fd(0x1ed)](_0x4c88fd(0x211),_0xce4a0c);}}async[a38_0x1ac5b6(0x24b)](_0xdba8f1){const _0x52cac3=a38_0x1ac5b6,_0xa801ad=[],_0x5bdfb3=new Date();_0x5bdfb3['setDate'](_0x5bdfb3[_0x52cac3(0x23a)]()-this[_0x52cac3(0x1a4)]),console[_0x52cac3(0x1c8)](_0x52cac3(0x1ea)+this[_0x52cac3(0x1a4)]+_0x52cac3(0x1e0)+_0x5bdfb3[_0x52cac3(0x1b0)]()+')');for(const _0x81fad6 of _0xdba8f1){if(_0x81fad6[_0x52cac3(0x1c4)]<_0x5bdfb3){console[_0x52cac3(0x1c8)](_0x52cac3(0x1e5)+_0x81fad6['id']+'\x20is\x20older\x20than\x20'+this['EXPIRY_DAYS']+'\x20days,\x20marking\x20as\x20EXPIRED');try{this['logCoinToPayStatus'](_0x81fad6['id'],_0x81fad6[_0x52cac3(0x1f1)]||_0x52cac3(0x25c),_0x52cac3(0x1a8),_0x52cac3(0x222),'auto_expire',{'reason':_0x52cac3(0x1ec)+this[_0x52cac3(0x1a4)]+'\x20days','createdAt':_0x81fad6[_0x52cac3(0x1c4)],'daysSinceCreation':Math[_0x52cac3(0x1fa)]((Date[_0x52cac3(0x1fc)]()-_0x81fad6['createdAt']['getTime']())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x81fad6[_0x52cac3(0x235)],'paymentCurrency':_0x81fad6[_0x52cac3(0x21b)],'shopId':_0x81fad6[_0x52cac3(0x19b)]}),await database_1['default'][_0x52cac3(0x1a5)][_0x52cac3(0x1ad)]({'where':{'id':_0x81fad6['id']},'data':{'status':_0x52cac3(0x222),'updatedAt':new Date(),'adminNotes':_0x52cac3(0x25a)+this[_0x52cac3(0x1a4)]+_0x52cac3(0x207)}}),await database_1[_0x52cac3(0x21c)][_0x52cac3(0x1fe)][_0x52cac3(0x267)]({'data':{'paymentId':_0x81fad6['id'],'shopId':_0x81fad6[_0x52cac3(0x19b)],'event':_0x52cac3(0x257),'statusCode':0xc8,'responseBody':JSON[_0x52cac3(0x1e6)]({'reason':'Payment\x20older\x20than\x20'+this[_0x52cac3(0x1a4)]+_0x52cac3(0x240),'createdAt':_0x81fad6[_0x52cac3(0x1c4)],'expiredAt':new Date()[_0x52cac3(0x1b0)](),'daysSinceCreation':Math[_0x52cac3(0x1fa)]((Date[_0x52cac3(0x1fc)]()-_0x81fad6[_0x52cac3(0x1c4)]['getTime']())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x52cac3(0x27d)](_0x81fad6,_0x52cac3(0x222)),await this[_0x52cac3(0x25f)](_0x81fad6,_0x52cac3(0x222)),this['clearPaymentTimers'](_0x81fad6['id']),_0xa801ad['push'](_0x81fad6['id']),console['log'](_0x52cac3(0x18c)+_0x81fad6['id']+'\x20marked\x20as\x20EXPIRED\x20due\x20to\x20'+this[_0x52cac3(0x1a4)]+'-day\x20timeout');}catch(_0x4d8005){console[_0x52cac3(0x1ed)](_0x52cac3(0x23c)+_0x81fad6['id']+':',_0x4d8005),this[_0x52cac3(0x1ab)](_0x81fad6['id'],_0x81fad6['gatewayPaymentId']||_0x52cac3(0x25c),_0x4d8005,_0x52cac3(0x190),{'reason':_0x52cac3(0x266),'createdAt':_0x81fad6['createdAt'],'daysSinceCreation':Math[_0x52cac3(0x1fa)]((Date[_0x52cac3(0x1fc)]()-_0x81fad6[_0x52cac3(0x1c4)][_0x52cac3(0x1d6)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0xa801ad;}async['checkSinglePayment'](_0x4b6344){const _0x14bd54=a38_0x1ac5b6;if(!_0x4b6344['gatewayPaymentId']){console[_0x14bd54(0x1c8)](_0x14bd54(0x243)+_0x4b6344['id']+_0x14bd54(0x258));return;}console[_0x14bd54(0x1c8)](_0x14bd54(0x18d)+_0x4b6344[_0x14bd54(0x265)]+_0x14bd54(0x277)+_0x4b6344['id']+'\x20('+_0x4b6344[_0x14bd54(0x1f1)]+')');try{let _0x587266;_0x4b6344['gateway']===_0x14bd54(0x196)?(_0x587266=await this[_0x14bd54(0x27b)][_0x14bd54(0x219)](_0x4b6344[_0x14bd54(0x1f1)]),console[_0x14bd54(0x1c8)](_0x14bd54(0x24a)+_0x4b6344['id']+'\x20status:\x20'+_0x587266[_0x14bd54(0x1ba)])):(_0x587266=await this[_0x14bd54(0x178)][_0x14bd54(0x219)](_0x4b6344[_0x14bd54(0x1f1)]),console[_0x14bd54(0x1c8)](_0x14bd54(0x1f6)+_0x4b6344['id']+_0x14bd54(0x1ac)+_0x587266[_0x14bd54(0x1ba)]));_0x587266[_0x14bd54(0x21e)]&&console[_0x14bd54(0x1c8)](_0x14bd54(0x1b1)+_0x4b6344['id']+'\x20details:',{'iban':_0x587266[_0x14bd54(0x21e)][_0x14bd54(0x1dd)]||_0x14bd54(0x199),'transactionId':_0x587266[_0x14bd54(0x21e)][_0x14bd54(0x195)],'createdOn':_0x587266[_0x14bd54(0x21e)][_0x14bd54(0x21a)],'confirmedOn':_0x587266[_0x14bd54(0x21e)][_0x14bd54(0x23b)]||_0x14bd54(0x208)});if(_0x587266[_0x14bd54(0x1ba)]!==_0x4b6344[_0x14bd54(0x1ba)]){console[_0x14bd54(0x1c8)]('üîÑ\x20[CHECK]\x20Updating\x20payment\x20'+_0x4b6344['id']+_0x14bd54(0x210)+_0x4b6344[_0x14bd54(0x1ba)]+_0x14bd54(0x1c7)+_0x587266['status']),this[_0x14bd54(0x1a1)](_0x4b6344['id'],_0x4b6344[_0x14bd54(0x1f1)],_0x4b6344[_0x14bd54(0x1ba)],_0x587266['status'],_0x14bd54(0x1d5),{'paymentDetails':_0x587266[_0x14bd54(0x21e)],'amount':_0x587266[_0x14bd54(0x235)],'currency':_0x587266[_0x14bd54(0x21b)],'shopId':_0x4b6344['shopId'],'checkTimestamp':new Date()[_0x14bd54(0x1b0)]()});const _0x376ffa={'status':_0x587266['status'],'updatedAt':new Date()};if(_0x587266[_0x14bd54(0x1ba)]===_0x14bd54(0x183)&&_0x4b6344[_0x14bd54(0x1ba)]!==_0x14bd54(0x183)){_0x376ffa[_0x14bd54(0x22d)]=new Date();if(!_0x4b6344[_0x14bd54(0x20d)]){const _0x3b9753=await currencyService_1[_0x14bd54(0x217)][_0x14bd54(0x24c)](_0x4b6344[_0x14bd54(0x235)],_0x4b6344[_0x14bd54(0x21b)]);_0x376ffa['amountUSDT']=_0x3b9753;const _0x30a211=await this[_0x14bd54(0x205)](_0x4b6344[_0x14bd54(0x19b)],_0x4b6344[_0x14bd54(0x265)]),_0xf9e15a=_0x3b9753*(0x1-_0x30a211/0x64);_0x376ffa[_0x14bd54(0x1e1)]=_0xf9e15a,_0x376ffa['gatewayCommissionRate']=_0x30a211,console[_0x14bd54(0x1c8)](_0x14bd54(0x23e)+_0x4b6344['id']+_0x14bd54(0x1cd)),console[_0x14bd54(0x1c8)](_0x14bd54(0x1da)+_0x4b6344[_0x14bd54(0x235)]+'\x20'+_0x4b6344[_0x14bd54(0x21b)]+_0x14bd54(0x1f4)+_0x3b9753[_0x14bd54(0x1a7)](0x6)+'\x20USDT'),console[_0x14bd54(0x1c8)](_0x14bd54(0x272)+_0x4b6344[_0x14bd54(0x265)]+_0x14bd54(0x282)+_0x30a211+'%'),console['log'](_0x14bd54(0x1de)+_0xf9e15a[_0x14bd54(0x1a7)](0x6)+'\x20USDT');}console[_0x14bd54(0x1c8)](_0x14bd54(0x23e)+_0x4b6344['id']+_0x14bd54(0x1c2)+_0x376ffa[_0x14bd54(0x22d)]['toISOString']());}if(_0x587266['paymentDetails']){const _0x5059dd=_0x587266[_0x14bd54(0x21e)];_0x5059dd[_0x14bd54(0x1dd)]&&(_0x376ffa[_0x14bd54(0x1e9)]=_0x5059dd[_0x14bd54(0x1dd)],console[_0x14bd54(0x1c8)]('üè¶\x20[CHECK]\x20Saved\x20IBAN:\x20'+_0x5059dd['iban']));if(_0x5059dd[_0x14bd54(0x274)]){const _0x284895=_0x4b6344[_0x14bd54(0x194)]||'',_0x4d9b2a=_0x14bd54(0x256)+_0x5059dd[_0x14bd54(0x274)];_0x376ffa['adminNotes']=_0x284895?_0x284895+'\x0a\x0a'+_0x4d9b2a:_0x4d9b2a,console[_0x14bd54(0x1c8)](_0x14bd54(0x249));}_0x5059dd['transactionId']&&console['log'](_0x14bd54(0x179)+_0x5059dd[_0x14bd54(0x195)]),_0x5059dd[_0x14bd54(0x23b)]&&console[_0x14bd54(0x1c8)]('‚úÖ\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20'+_0x5059dd[_0x14bd54(0x23b)]);}await database_1[_0x14bd54(0x21c)]['payment'][_0x14bd54(0x1ad)]({'where':{'id':_0x4b6344['id']},'data':_0x376ffa});if(_0x587266[_0x14bd54(0x1ba)]===_0x14bd54(0x183)&&_0x4b6344[_0x14bd54(0x1ba)]!==_0x14bd54(0x183)){console[_0x14bd54(0x1c8)](_0x14bd54(0x225)+_0x4b6344['id']+_0x14bd54(0x279));const _0x57639c=await database_1[_0x14bd54(0x21c)][_0x14bd54(0x1a5)][_0x14bd54(0x1e4)]({'where':{'id':_0x4b6344['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x57639c?.[_0x14bd54(0x18e)]&&_0x57639c[_0x14bd54(0x186)])try{const _0x488f54=_0x57639c['paymentLink'];console['log'](_0x14bd54(0x19f)+_0x488f54['id']+':\x20type='+_0x488f54[_0x14bd54(0x246)]+',\x20currentPayments='+_0x488f54[_0x14bd54(0x193)]+_0x14bd54(0x185)+_0x488f54[_0x14bd54(0x1ba)]);const _0x5a5285=_0x488f54[_0x14bd54(0x193)]+0x1,_0x29bb99=_0x488f54[_0x14bd54(0x246)]===_0x14bd54(0x18b)?_0x14bd54(0x1fb):_0x488f54[_0x14bd54(0x1ba)];await database_1[_0x14bd54(0x21c)][_0x14bd54(0x186)][_0x14bd54(0x1ad)]({'where':{'id':_0x488f54['id']},'data':{'currentPayments':_0x5a5285,'status':_0x29bb99,'updatedAt':new Date()}}),console[_0x14bd54(0x1c8)](_0x14bd54(0x17d)+_0x488f54['id']+_0x14bd54(0x26b)+_0x488f54[_0x14bd54(0x193)]+'\x20->\x20'+_0x5a5285+_0x14bd54(0x185)+_0x488f54[_0x14bd54(0x1ba)]+_0x14bd54(0x1f4)+_0x29bb99);}catch(_0x18ead3){console[_0x14bd54(0x1ed)](_0x14bd54(0x1d0),_0x18ead3);}else console[_0x14bd54(0x1c8)](_0x14bd54(0x225)+_0x4b6344['id']+_0x14bd54(0x1d2));}await database_1[_0x14bd54(0x21c)][_0x14bd54(0x1fe)][_0x14bd54(0x267)]({'data':{'paymentId':_0x4b6344['id'],'shopId':_0x4b6344['shopId'],'event':'cointopay_status_check_'+_0x587266[_0x14bd54(0x1ba)][_0x14bd54(0x177)](),'statusCode':0xc8,'responseBody':JSON['stringify']({'oldStatus':_0x4b6344[_0x14bd54(0x1ba)],'newStatus':_0x587266[_0x14bd54(0x1ba)],'paymentDetails':_0x587266[_0x14bd54(0x21e)],'checkedAt':new Date()[_0x14bd54(0x1b0)]()})}}),await this['sendShopWebhook'](_0x4b6344,_0x587266['status']),await this[_0x14bd54(0x25f)](_0x4b6344,_0x587266[_0x14bd54(0x1ba)]),_0x587266[_0x14bd54(0x1ba)]!==_0x14bd54(0x1a8)&&(console[_0x14bd54(0x1c8)](_0x14bd54(0x17a)+_0x4b6344['id']+'\x20status\x20changed\x20to\x20'+_0x587266[_0x14bd54(0x1ba)]+',\x20clearing\x20individual\x20timers'),this[_0x14bd54(0x1be)](_0x4b6344['id'])),console['log'](_0x14bd54(0x19d)+_0x4b6344['id']+'\x20updated\x20successfully');}else console[_0x14bd54(0x1c8)](_0x14bd54(0x1b1)+_0x4b6344['id']+_0x14bd54(0x1f9)+_0x587266[_0x14bd54(0x1ba)]+')'),this['logCoinToPayStatus'](_0x4b6344['id'],_0x4b6344[_0x14bd54(0x1f1)],_0x4b6344['status'],_0x587266[_0x14bd54(0x1ba)],_0x14bd54(0x1d5),{'statusUnchanged':!![],'paymentDetails':_0x587266[_0x14bd54(0x21e)],'amount':_0x587266[_0x14bd54(0x235)],'currency':_0x587266[_0x14bd54(0x21b)],'shopId':_0x4b6344['shopId'],'checkTimestamp':new Date()['toISOString']()});}catch(_0x34d04d){console[_0x14bd54(0x1ed)]('‚ùå\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20'+_0x4b6344['id']+':',_0x34d04d),this[_0x14bd54(0x1ab)](_0x4b6344['id'],_0x4b6344['gatewayPaymentId'],_0x34d04d,_0x14bd54(0x1d5),{'paymentAmount':_0x4b6344[_0x14bd54(0x235)],'paymentCurrency':_0x4b6344[_0x14bd54(0x21b)],'shopId':_0x4b6344[_0x14bd54(0x19b)],'createdAt':_0x4b6344[_0x14bd54(0x1c4)]}),await database_1['default'][_0x14bd54(0x1fe)][_0x14bd54(0x267)]({'data':{'paymentId':_0x4b6344['id'],'shopId':_0x4b6344[_0x14bd54(0x19b)],'event':'cointopay_status_check_error','statusCode':0x1f4,'responseBody':JSON[_0x14bd54(0x1e6)]({'error':_0x34d04d instanceof Error?_0x34d04d[_0x14bd54(0x1f7)]:_0x14bd54(0x26e),'gatewayPaymentId':_0x4b6344[_0x14bd54(0x1f1)],'checkedAt':new Date()[_0x14bd54(0x1b0)]()})}});}}async[a38_0x1ac5b6(0x27d)](_0x18d318,_0x403e37){const _0x461520=a38_0x1ac5b6,_0x115daa=Date['now']();try{const _0x585b98=_0x18d318[_0x461520(0x261)],_0x495423=_0x585b98[_0x461520(0x17c)];if(!_0x495423?.[_0x461520(0x27e)]){console[_0x461520(0x1c8)](_0x461520(0x1b2)+_0x585b98['id']);return;}const _0x216b51=_0x403e37===_0x461520(0x183)?_0x461520(0x1d3):_0x403e37===_0x461520(0x260)?'payment.failed':_0x403e37===_0x461520(0x222)?_0x461520(0x212):_0x461520(0x191);if(!_0x495423[_0x461520(0x1bb)]?.[_0x461520(0x223)](_0x216b51)){console[_0x461520(0x1c8)](_0x461520(0x216)+_0x216b51+_0x461520(0x1a0)+_0x585b98['id']);return;}const _0x210d27=(0x0,gateway_1['getGatewayIdByName'])(_0x18d318[_0x461520(0x265)])||_0x18d318[_0x461520(0x265)],_0x12f66e={'event':_0x216b51,'payment':{'id':_0x18d318['id'],'order_id':_0x18d318[_0x461520(0x1b3)],'gateway_order_id':_0x18d318[_0x461520(0x1a3)],'gateway':_0x210d27,'amount':_0x18d318['amount'],'currency':_0x18d318[_0x461520(0x21b)],'status':_0x403e37[_0x461520(0x177)](),'customer_email':_0x18d318[_0x461520(0x281)],'customer_name':_0x18d318[_0x461520(0x22e)],'created_at':_0x18d318[_0x461520(0x1c4)],'updated_at':new Date()}},_0x196bb7=await fetch(_0x495423['webhookUrl'],{'method':_0x461520(0x236),'headers':{'Content-Type':_0x461520(0x244),'User-Agent':_0x461520(0x228)},'body':JSON[_0x461520(0x1e6)](_0x12f66e)}),_0x3a889b=Date[_0x461520(0x1fc)]()-_0x115daa,_0x46ccdc=_0x196bb7['ok']?_0x461520(0x26a):await _0x196bb7[_0x461520(0x192)]();loggerService_1[_0x461520(0x255)][_0x461520(0x248)](_0x18d318[_0x461520(0x19b)],_0x495423[_0x461520(0x27e)],_0x216b51,_0x196bb7['status'],_0x3a889b,_0x12f66e),console['log'](_0x461520(0x25d)+_0x495423['webhookUrl']+'\x20with\x20status\x20'+_0x196bb7[_0x461520(0x1ba)]+'\x20('+_0x3a889b+_0x461520(0x188));}catch(_0x3de167){console[_0x461520(0x1ed)](_0x461520(0x1ae),_0x3de167),loggerService_1['loggerService'][_0x461520(0x1f3)](_0x18d318[_0x461520(0x19b)],_0x18d318[_0x461520(0x261)]?.[_0x461520(0x17c)]?.[_0x461520(0x27e)]||_0x461520(0x25c),_0x461520(0x24e),_0x3de167,{});}}async['sendPaymentStatusNotification'](_0x222ba1,_0x18f119){const _0x1a72c0=a38_0x1ac5b6;try{const _0x19b070={'PENDING':'created','PAID':_0x1a72c0(0x238),'FAILED':_0x1a72c0(0x26f),'EXPIRED':'expired'},_0x2f4450=_0x19b070[_0x18f119];if(!_0x2f4450||_0x2f4450===_0x1a72c0(0x21d))return;await telegramBotService_1['telegramBotService'][_0x1a72c0(0x18a)](_0x222ba1[_0x1a72c0(0x19b)],_0x222ba1,_0x2f4450);}catch(_0x314ad7){console[_0x1a72c0(0x1ed)]('Failed\x20to\x20send\x20Telegram\x20payment\x20notification:',_0x314ad7);}}async['checkPaymentById'](_0x41a7c9){const _0x383b92=a38_0x1ac5b6;console[_0x383b92(0x1c8)]('üîç\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20'+_0x41a7c9);const _0x43b4bf=await database_1[_0x383b92(0x21c)][_0x383b92(0x1a5)][_0x383b92(0x1e4)]({'where':{'id':_0x41a7c9},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x43b4bf)throw new Error(_0x383b92(0x1cf));if(_0x43b4bf[_0x383b92(0x265)]!==_0x383b92(0x224)&&_0x43b4bf['gateway']!=='cointopay2')throw new Error('Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment');console[_0x383b92(0x1c8)](_0x383b92(0x230)+_0x43b4bf[_0x383b92(0x265)]+_0x383b92(0x277)+_0x41a7c9),await this[_0x383b92(0x218)](_0x43b4bf),console[_0x383b92(0x1c8)](_0x383b92(0x245)+_0x41a7c9);}[a38_0x1ac5b6(0x182)](){const _0x465ec6=a38_0x1ac5b6,_0x1d601d=this['globalCheckInterval']?this[_0x465ec6(0x1ca)]:undefined,_0xaebbb9=Array[_0x465ec6(0x273)](this[_0x465ec6(0x263)][_0x465ec6(0x25b)]())['map'](_0x131698=>({'paymentId':_0x131698[_0x465ec6(0x1a2)],'gatewayPaymentId':_0x131698['gatewayPaymentId'],'createdAt':_0x131698[_0x465ec6(0x1c4)],'timersCount':_0x131698['timers'][_0x465ec6(0x22a)]}));return{'isActive':!!this['globalCheckInterval'],'globalCheckIntervalMinutes':this['GLOBAL_CHECK_INTERVAL_MS']/(0x3e8*0x3c),'expiryDays':this[_0x465ec6(0x1a4)],'activeIndividualTimers':this[_0x465ec6(0x263)][_0x465ec6(0x180)],'nextGlobalCheckIn':_0x1d601d,'paymentTimersDetails':_0xaebbb9};}[a38_0x1ac5b6(0x23f)](_0x133aeb){const _0x5d7a63=a38_0x1ac5b6,_0x3e3863=this[_0x5d7a63(0x263)]['get'](_0x133aeb);if(_0x3e3863)return{'hasTimers':!![],'timersCount':_0x3e3863['timers'][_0x5d7a63(0x22a)],'createdAt':_0x3e3863['createdAt'],'gatewayPaymentId':_0x3e3863[_0x5d7a63(0x1f1)]};return{'hasTimers':![]};}async[a38_0x1ac5b6(0x205)](_0x222b0b,_0x613c58){const _0x58d2e4=a38_0x1ac5b6;try{const _0x7411fd=await database_1[_0x58d2e4(0x21c)][_0x58d2e4(0x261)][_0x58d2e4(0x1e4)]({'where':{'id':_0x222b0b},'select':{'gatewaySettings':!![]}});if(!_0x7411fd?.[_0x58d2e4(0x17e)])return console['log'](_0x58d2e4(0x1f8)+_0x222b0b+_0x58d2e4(0x19e)),0xa;const _0x296f01=JSON[_0x58d2e4(0x1ef)](_0x7411fd[_0x58d2e4(0x17e)]);for(const [_0x34f8f9,_0x11752d]of Object[_0x58d2e4(0x27a)](_0x296f01)){if(_0x34f8f9[_0x58d2e4(0x177)]()===_0x613c58['toLowerCase']()){const _0x2b312c=_0x11752d[_0x58d2e4(0x1f5)]||0xa;return console['log'](_0x58d2e4(0x187)+_0x613c58+_0x58d2e4(0x20a)+_0x222b0b+':\x20'+_0x2b312c+'%'),_0x2b312c;}}return console['log'](_0x58d2e4(0x259)+_0x613c58+'\x20in\x20shop\x20'+_0x222b0b+_0x58d2e4(0x197)),0xa;}catch(_0x39f8f2){return console['error']('Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20'+_0x222b0b+',\x20gateway\x20'+_0x613c58+':',_0x39f8f2),0xa;}}}exports[a38_0x1ac5b6(0x1b7)]=CoinToPayStatusService,exports[a38_0x1ac5b6(0x198)]=new CoinToPayStatusService();function a38_0x3c0d(){const _0x381881=['now','./loggerService','webhookLog','\x20in\x20','4833856OJzEdY','forEach','\x20to\x20clear','globalCheckInterval','27oHbNhd','getGatewayCommission','ü™ô\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','\x20days\x20without\x20payment\x20confirmation','not\x20confirmed','checkSinglePaymentById','\x20commission\x20for\x20shop\x20','\x20completed\x20for\x20payment\x20','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','amountUSDT','\x20\x20\x20üìç\x20Source:\x20','ü™ô\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','\x20status\x20from\x20','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','payment.failed','ü™ô\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','defineProperty','checkAllPendingPayments','Webhook\x20event\x20','currencyService','checkSinglePayment','checkPaymentStatus','createdOn','currency','default','created','paymentDetails','\x20\x20\x20-\x20Status:\x20','669853QryvbQ','‚ùå\x20[TIMER]\x20Failed\x20individual\x20check\x20#','EXPIRED','includes','cointopay','üìà\x20[COINTOPAY]\x20Payment\x20','1175CDxjmM','‚úÖ\x20[DEBUG]\x20Successfully\x20scheduled\x20','TesSoft\x20Payment\x20System/1.0','5\x20minutes','length','./gateways/coinToPayService','\x20seconds\x20(','paidAt','customerName','2sgtpcl','‚úÖ\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','‚è∞\x20[GLOBAL]\x20Payment\x20','__importDefault','\x20not\x20found\x20in\x20database','4122KYTlzL','amount','POST','.\x20Remaining\x20active\x20timers:\x20','paid','‚è∞\x20[GLOBAL]\x20Found\x20','getDate','confirmedOn','‚ùå\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','‚úÖ\x20[TIMER]\x20Individual\x20check\x20#','üí∞\x20[CHECK]\x20Payment\x20','getPaymentTimerInfo','\x20days','376ijuZMv','‚úÖ\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','‚ö†Ô∏è\x20[CHECK]\x20Payment\x20','application/json','‚úÖ\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','type','14zcjRpZ','logShopWebhookSent','üè¶\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes','üìä\x20[CHECK]\x20CoinToPay2\x20payment\x20','checkExpiredPayments','convertToUSDT','/status/','webhook_send','\x20found:','‚ùå\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','\x20individual\x20payment\x20timers','\x20triggered\x20for\x20payment\x20','üîç\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','\x20\x20\x20‚ùå\x20Error:\x20','loggerService','Bank\x20Details:\x20','cointopay_auto_expired','\x20has\x20no\x20gatewayPaymentId,\x20skipping','No\x20specific\x20commission\x20found\x20for\x20gateway\x20','Automatically\x20expired\x20after\x20','values','unknown','Shop\x20webhook\x20sent\x20to\x20','üìä\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','sendPaymentStatusNotification','FAILED','shop','\x20(after\x20','paymentTimers','\x20has\x20no\x20gatewayPaymentId','gateway','Failed\x20to\x20mark\x20payment\x20as\x20expired','create','COINTOPAY_ERROR','delete','Success','\x20updated:\x20currentPayments=','‚ùå\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','timestamp','Unknown\x20error','failed','\x20\x20\x20-\x20Gateway:\x20','has','\x20\x20\x20Gateway\x20','from','bankDetails','stopPeriodicStatusCheck','get','\x20payment\x20','./gateways/coinToPay2Service','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','entries','coinToPay2Service','push','sendShopWebhook','webhookUrl','15825293SxMXEs','‚è∞\x20[HOURLY]\x20Payment\x20','customerEmail','\x20commission:\x20','toLowerCase','coinToPayService','üÜî\x20[CHECK]\x20Transaction\x20ID:\x20','üßπ\x20[CHECK]\x20Payment\x20','logWhiteDomainError','settings','‚úÖ\x20[COINTOPAY]\x20Payment\x20link\x20','gatewaySettings','description','size','ü™ô\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','getServiceStats','PAID','üõë\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...',',\x20status=','paymentLink','Gateway\x20','ms)','\x20not\x20found,\x20clearing\x20timers','sendPaymentNotification','SINGLE','‚úÖ\x20[EXPIRY]\x20Payment\x20','üîç\x20[CHECK]\x20Checking\x20','paymentLinkId','ü™ô\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','auto_expire','payment.pending','text','currentPayments','adminNotes','transactionId','cointopay2',',\x20using\x20default\x2010%','coinToPayStatusService','not\x20found','ü™ô\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','shopId','\x20\x20\x20-\x20GatewayPaymentId:\x20','‚úÖ\x20[CHECK]\x20Payment\x20',',\x20using\x20default\x20commission\x2010%','üìà\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','\x20not\x20enabled\x20for\x20shop\x20','logCoinToPayStatus','paymentId','gatewayOrderId','EXPIRY_DAYS','payment','üõë\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','toFixed','PENDING','üìä\x20[HOURLY]\x20Payment\x20','‚úÖ\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','logCoinToPayError','\x20status:\x20','update','Failed\x20to\x20send\x20shop\x20webhook:','\x20\x20\x20-\x20gatewayPaymentId:\x20','toISOString','üìä\x20[CHECK]\x20Payment\x20','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','orderId','2\x20minutes','ü™ô\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','../config/database','CoinToPayStatusService','ü™ô\x20[ERROR]\x20CoinToPay\x20Error:\x20','stack','status','webhookEvents','set','26654160pHekEY','clearPaymentTimers','\x20checked,\x20','schedulePaymentChecks','\x20for\x20payment\x20','\x20marked\x20as\x20paid\x20at:\x20','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','createdAt','5097yfHPTs','1617730asyLfL','\x20to\x20','log','‚úÖ\x20[HOURLY]\x20Payment\x20','GLOBAL_CHECK_INTERVAL_MS','timers','delay','\x20amounts\x20calculated:','\x20timers\x20for\x20payment\x20','Payment\x20not\x20found','‚ùå\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','schedule_created','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','payment.success','h),\x20skipping\x20global\x20check','status_check','getTime','ü™ô\x20[TIMER]\x20Individual\x20check\x20#','../types/gateway','\x20is\x20too\x20new\x20(','\x20\x20\x20Amount:\x20','\x20status\x20is\x20','__esModule','iban','\x20\x20\x20Amount\x20after\x20commission:\x20',',\x20stopping\x20individual\x20checks','\x20days\x20(created\x20before\x20','amountAfterGatewayCommissionUSDT','\x20\x20\x20üìù\x20Details:','\x20initial\x20timers\x20for\x20payment\x20','findUnique','‚è∞\x20[EXPIRY]\x20Payment\x20','stringify','CoinToPayService','\x20pending\x20CoinToPay\x20payments','remitterIban','‚è∞\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','\x20is\x20valid\x20for\x20checking,\x20proceeding...','Payment\x20older\x20than\x20','error','\x20\x20\x20üìÖ\x20Time:\x20','parse','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','gatewayPaymentId','ü™ô\x20[GLOBAL]\x20Found\x20','logShopWebhookError','\x20->\x20','commission','üìä\x20[CHECK]\x20CoinToPay\x20payment\x20','message','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','\x20status\x20unchanged\x20(','floor','COMPLETED'];a38_0x3c0d=function(){return _0x381881;};return a38_0x3c0d();}