'use strict';function a48_0x39c0(_0x56ee06,_0x4fe2d2){_0x56ee06=_0x56ee06-0x151;const _0x1f99bd=a48_0x1f99();let _0x39c034=_0x1f99bd[_0x56ee06];return _0x39c034;}const a48_0x53ce1d=a48_0x39c0;(function(_0x122e57,_0x17d3bf){const _0x1aa5f7=a48_0x39c0,_0x3c9cf7=_0x122e57();while(!![]){try{const _0x165fe2=parseInt(_0x1aa5f7(0x208))/0x1+-parseInt(_0x1aa5f7(0x233))/0x2+-parseInt(_0x1aa5f7(0x1e6))/0x3+parseInt(_0x1aa5f7(0x1c9))/0x4*(parseInt(_0x1aa5f7(0x1eb))/0x5)+-parseInt(_0x1aa5f7(0x176))/0x6*(-parseInt(_0x1aa5f7(0x1b4))/0x7)+parseInt(_0x1aa5f7(0x18e))/0x8*(-parseInt(_0x1aa5f7(0x1b1))/0x9)+parseInt(_0x1aa5f7(0x1c0))/0xa;if(_0x165fe2===_0x17d3bf)break;else _0x3c9cf7['push'](_0x3c9cf7['shift']());}catch(_0x14c9e3){_0x3c9cf7['push'](_0x3c9cf7['shift']());}}}(a48_0x1f99,0x1f3cc));var __importDefault=this&&this[a48_0x53ce1d(0x23c)]||function(_0x5ee20c){return _0x5ee20c&&_0x5ee20c['__esModule']?_0x5ee20c:{'default':_0x5ee20c};};function a48_0x1f99(){const _0x328758=['webhookEvents','\x20status\x20unchanged\x20(','now','toFixed','PAID','454737csXXEw','currency','ðŸª™\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','createdOn','\x20\x20\x20-\x20GatewayPaymentId:\x20','8435bnXBAI','âœ…\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','\x20updated\x20successfully','amount','âš ï¸\x20[CHECK]\x20Payment\x20','ðŸ§¹\x20[CHECK]\x20Payment\x20','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','entries','Gateway\x20','âœ…\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','defineProperty','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','expired','status','\x20\x20\x20-\x20Status:\x20','logCoinToPayStatus','\x20seconds\x20(','ðŸ§¹\x20[DEBUG]\x20Cleared\x20timer\x20#','logShopWebhookError','\x20with\x20status\x20','ðŸª™\x20[DEBUG]\x20Creating\x20','ðŸ“ˆ\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','shopId','âŒ\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','stringify','\x20marked\x20as\x20paid\x20at:\x20','getTime',',\x20currentPayments=','COINTOPAY_STATUS_CHANGE','91836qeHqrk','gatewayCommissionRate','5\x20minutes','ðŸ“ˆ\x20[COINTOPAY]\x20Payment\x20','COINTOPAY_ERROR','create','get','\x20timers\x20for\x20payment\x20',':\x20type=','â°\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','cointopay_status_check_error','coinToPay2Service','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','âœ…\x20[CHECK]\x20Payment\x20','paidAt','\x20status\x20from\x20','âŒ\x20[CHECK]\x20Payment\x20','iban','paymentId','\x20status\x20changed\x20to\x20','â°\x20[GLOBAL]\x20Found\x20','GLOBAL_CHECK_INTERVAL_MS','toLowerCase','customerEmail','schedule_created','amountUSDT','loggerService','âŒ\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','â°\x20[HOURLY]\x20Payment\x20','cointopay_status_check_','checkSinglePayment','payment.failed','\x20in\x20shop\x20','delay','transactionId','getGatewayCommission','\x20expired\x20CoinToPay\x20payments','bankDetails','findUnique','\x20commission\x20for\x20shop\x20','No\x20gateway\x20settings\x20found\x20for\x20shop\x20',',\x20status=','â°\x20[GLOBAL]\x20Payment\x20','52248CvIYwX','\x20\x20\x20âŒ\x20Error:\x20','Payment\x20not\x20found','âœ…\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','ðŸ”\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','gatewaySettings','\x20days,\x20marking\x20as\x20EXPIRED','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','\x20not\x20found\x20in\x20database','__importDefault','âœ…\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','../types/gateway','cointopay2','âŒ\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','âŒ\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','clearPaymentTimers','\x20has\x20no\x20gatewayPaymentId,\x20skipping','timers','getPaymentTimerInfo','set','ðŸ’°\x20[CHECK]\x20Payment\x20','\x20\x20\x20-\x20gatewayPaymentId:\x20','Success','âŒ\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','checkSinglePaymentById','\x20(age:\x20','\x20details:','\x20to\x20','âœ…\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','./gateways/coinToPay2Service','webhookLog','Unknown\x20error','CoinToPayService','cointopay','logWhiteDomainError','\x20has\x20no\x20gatewayPaymentId','Failed\x20to\x20send\x20shop\x20webhook:','ðŸª™\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','ðŸ†”\x20[CHECK]\x20Transaction\x20ID:\x20','payment.pending','toISOString','\x20->\x20','\x20\x20\x20Amount:\x20','ðŸ”„\x20[CHECK]\x20Updating\x20payment\x20','includes','delete','\x20\x20\x20Gateway\x20','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','shop','\x20commission:\x20','checkPaymentById','â°\x20[EXPIRY]\x20Payment\x20','timestamp','remitterIban','webhookUrl','forEach',',\x20gateway\x20','getServiceStats','\x20in\x20','\x20for\x20payment\x20','__esModule','status_check','getGatewayIdByName','sendPaymentNotification','\x20is\x20too\x20new\x20(','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','ðŸ“Š\x20[CHECK]\x20Payment\x20','webhook_send','payment','unknown','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','ðŸª™\x20[GLOBAL]\x20Found\x20','â°\x20[DEBUG]\x20Scheduled\x20check\x20#','created','message','paymentLink','auto_expire',',\x20using\x20default\x2010%','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','sendPaymentStatusNotification','parse','default','paymentTimers','stopPeriodicStatusCheck','PENDING','\x20status\x20is\x20','\x20is\x20valid\x20for\x20checking,\x20proceeding...','23538vVAVWR','../config/database','type','description','Payment\x20System/1.0','ðŸª™\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','push','âœ…\x20[EXPIRY]\x20Payment\x20','FAILED','./loggerService','1\x20minute','./telegramBotService','SINGLE','âŒ\x20[TIMER]\x20Failed\x20individual\x20check\x20#',',\x20stopping\x20individual\x20checks','not\x20found','âŒ\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','failed','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','âœ…\x20[HOURLY]\x20Payment\x20','\x20updated:\x20currentPayments=','\x20\x20\x20ðŸ“…\x20Time:\x20','logCoinToPayError','\x20skipped,\x20','72YNXCVB','ðŸª™\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','./currencyService','update','ðŸ”\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','ðŸ›‘\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','ðŸ¦\x20[CHECK]\x20Saved\x20IBAN:\x20','size','\x20payment\x20','\x20USDT','\x20\x20\x20Amount\x20after\x20commission:\x20','\x20triggered\x20for\x20payment\x20','EXPIRY_DAYS','cointopay_auto_expired','gateway','./gateways/coinToPayService','Payment\x20older\x20than\x20','settings','âœ…\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','âŒ\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','coinToPayService','âœ…\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','gatewayPaymentId','length','confirmedOn','âœ…\x20[DEBUG]\x20Successfully\x20scheduled\x20','âŒ\x20[HOURLY]\x20Payment\x20','\x20current\x20status:\x20','catch','h),\x20skipping\x20global\x20check','log','\x20days','gatewayOrderId','logShopWebhookSent','ms)','241929vDsoyI','amountAfterGatewayCommissionUSDT','currentPayments','399ogyWpM','CoinToPayStatusService','orderId','ðŸª™\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','floor','Webhook\x20event\x20','coinToPayStatusService','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','commission','\x20not\x20found,\x20clearing\x20timers','âœ…\x20[TIMER]\x20Individual\x20check\x20#','âŒ\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','1798360hiRTvH','createdAt','checkAllPendingPayments','text','from','ðŸ“Š\x20[HOURLY]\x20Payment\x20','paymentDetails','findMany','paymentLinkId','124hawDbb','\x20\x20\x20-\x20Amount:\x20','ðŸª™\x20[TIMER]\x20Individual\x20check\x20#','ðŸª™\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','\x20is\x20older\x20than\x20','.\x20Remaining\x20active\x20timers:\x20','ðŸ“Š\x20[CHECK]\x20CoinToPay2\x20payment\x20','ðŸ“Š\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','error','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','sendShopWebhook','\x20checked,\x20','Shop\x20webhook\x20sent\x20to\x20','convertToUSDT','\x20expired','\x20\x20\x20ðŸ“Š\x20Status:\x20','globalCheckInterval','ðŸ¦\x20[CHECK]\x20Bank\x20details\x20provided:\x20','\x20found:','EXPIRED','Failed\x20to\x20mark\x20payment\x20as\x20expired','checkExpiredPayments','\x20status:\x20','ðŸ“Š\x20[CHECK]\x20CoinToPay\x20payment\x20'];a48_0x1f99=function(){return _0x328758;};return a48_0x1f99();}Object[a48_0x53ce1d(0x1f5)](exports,a48_0x53ce1d(0x15b),{'value':!![]}),exports['coinToPayStatusService']=exports[a48_0x53ce1d(0x1b5)]=void 0x0;const coinToPayService_1=require(a48_0x53ce1d(0x19d)),coinToPay2Service_1=require(a48_0x53ce1d(0x250)),gateway_1=require(a48_0x53ce1d(0x23e)),database_1=__importDefault(require(a48_0x53ce1d(0x177))),telegramBotService_1=require(a48_0x53ce1d(0x181)),loggerService_1=require(a48_0x53ce1d(0x17f)),currencyService_1=require(a48_0x53ce1d(0x190));class CoinToPayStatusService{constructor(){const _0x1bf129=a48_0x53ce1d;this['globalCheckInterval']=null,this[_0x1bf129(0x21d)]=0x3c*0x3c*0x3e8,this[_0x1bf129(0x19a)]=0x5,this[_0x1bf129(0x171)]=new Map(),this[_0x1bf129(0x1a2)]=new coinToPayService_1[(_0x1bf129(0x253))](),this[_0x1bf129(0x213)]=new coinToPay2Service_1['CoinToPay2Service'](),console['log'](_0x1bf129(0x17b));}['schedulePaymentChecks'](_0x462959,_0x5faa33){const _0x55dfef=a48_0x53ce1d;console[_0x55dfef(0x1ac)](_0x55dfef(0x1cc)),console[_0x55dfef(0x1ac)]('\x20\x20\x20-\x20paymentId:\x20'+_0x462959),console[_0x55dfef(0x1ac)](_0x55dfef(0x248)+_0x5faa33),this[_0x55dfef(0x242)](_0x462959);const _0x3aefd3=[],_0x53cc04=new Date(),_0x1f876f=[{'delay':0x1*0x3c*0x3e8,'description':_0x55dfef(0x180)},{'delay':0x2*0x3c*0x3e8,'description':'2\x20minutes'},{'delay':0x5*0x3c*0x3e8,'description':_0x55dfef(0x20a)},{'delay':0x5*0x3c*0x3e8,'description':'5\x20minutes'}];console['log'](_0x55dfef(0x1ff)+_0x1f876f['length']+'\x20initial\x20timers\x20for\x20payment\x20'+_0x462959);let _0x3e4c63=0x0;_0x1f876f[_0x55dfef(0x156)]((_0x489fcf,_0x5d0bf1)=>{const _0x1511fe=_0x55dfef;_0x3e4c63+=_0x489fcf[_0x1511fe(0x229)];const _0x444fbd=setTimeout(async()=>{const _0x60879a=_0x1511fe;console[_0x60879a(0x1ac)](_0x60879a(0x1cb)+(_0x5d0bf1+0x1)+_0x60879a(0x199)+_0x462959+'\x20(after\x20'+_0x489fcf['description']+')');try{await this[_0x60879a(0x24b)](_0x462959),console[_0x60879a(0x1ac)](_0x60879a(0x1be)+(_0x5d0bf1+0x1)+'\x20completed\x20for\x20payment\x20'+_0x462959);}catch(_0x17483a){console['error'](_0x60879a(0x183)+(_0x5d0bf1+0x1)+'\x20for\x20payment\x20'+_0x462959+':',_0x17483a),this[_0x60879a(0x18c)](_0x462959,_0x5faa33,_0x17483a,_0x60879a(0x15c),{'checkNumber':_0x5d0bf1+0x1,'scheduledAfter':_0x489fcf[_0x60879a(0x179)],'isIndividualCheck':!![]});}},_0x3e4c63);_0x3aefd3[_0x1511fe(0x17c)](_0x444fbd),console[_0x1511fe(0x1ac)](_0x1511fe(0x167)+(_0x5d0bf1+0x1)+_0x1511fe(0x15a)+_0x462959+_0x1511fe(0x159)+_0x3e4c63/0x3e8+_0x1511fe(0x1fb)+_0x489fcf[_0x1511fe(0x179)]+')');});const _0x117a3d=setInterval(async()=>{const _0x29c3c7=_0x55dfef;console[_0x29c3c7(0x1ac)](_0x29c3c7(0x258)+_0x462959);try{const _0x5811cc=await database_1[_0x29c3c7(0x170)][_0x29c3c7(0x163)][_0x29c3c7(0x22e)]({'where':{'id':_0x462959},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x5811cc){console[_0x29c3c7(0x1ac)](_0x29c3c7(0x1a8)+_0x462959+_0x29c3c7(0x1bd)),this['clearPaymentTimers'](_0x462959);return;}console['log'](_0x29c3c7(0x1c5)+_0x462959+_0x29c3c7(0x1a9)+_0x5811cc['status']);if(_0x5811cc[_0x29c3c7(0x1f8)]!==_0x29c3c7(0x173)){console['log'](_0x29c3c7(0x189)+_0x462959+_0x29c3c7(0x174)+_0x5811cc[_0x29c3c7(0x1f8)]+',\x20stopping\x20individual\x20checks'),this['clearPaymentTimers'](_0x462959);return;}const _0x3d7056=Math['floor']((Date[_0x29c3c7(0x1e3)]()-_0x5811cc['createdAt']['getTime']())/(0x3e8*0x3c*0x3c*0x18));if(_0x3d7056>=this['EXPIRY_DAYS']){console[_0x29c3c7(0x1ac)](_0x29c3c7(0x224)+_0x462959+_0x29c3c7(0x1cd)+this[_0x29c3c7(0x19a)]+_0x29c3c7(0x165)),this[_0x29c3c7(0x242)](_0x462959);return;}await this['checkSinglePaymentById'](_0x462959),console[_0x29c3c7(0x1ac)](_0x29c3c7(0x23d)+_0x462959);}catch(_0x20ccea){console['error'](_0x29c3c7(0x223)+_0x462959+':',_0x20ccea),this[_0x29c3c7(0x18c)](_0x462959,_0x5faa33,_0x20ccea,_0x29c3c7(0x15c),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x3aefd3[_0x55dfef(0x17c)](_0x117a3d),this[_0x55dfef(0x171)][_0x55dfef(0x246)](_0x462959,{'timers':_0x3aefd3,'paymentId':_0x462959,'gatewayPaymentId':_0x5faa33,'createdAt':_0x53cc04}),console[_0x55dfef(0x1ac)](_0x55dfef(0x1a7)+_0x1f876f[_0x55dfef(0x1a5)]+_0x55dfef(0x160)+_0x462959),console[_0x55dfef(0x1ac)](_0x55dfef(0x1d0)+this[_0x55dfef(0x171)][_0x55dfef(0x195)]),this[_0x55dfef(0x1fa)](_0x462959,_0x5faa33,_0x55dfef(0x173),'PENDING','status_check',{'action':_0x55dfef(0x220),'scheduledChecks':_0x1f876f['length'],'firstCheckIn':_0x1f876f[0x0][_0x55dfef(0x229)]/0x3e8,'totalTimers':this[_0x55dfef(0x171)][_0x55dfef(0x195)]});}[a48_0x53ce1d(0x242)](_0xbac3ad){const _0x58d27f=a48_0x53ce1d,_0x31aa93=this[_0x58d27f(0x171)][_0x58d27f(0x20e)](_0xbac3ad);_0x31aa93?(console[_0x58d27f(0x1ac)]('ðŸ§¹\x20[DEBUG]\x20Clearing\x20'+_0x31aa93[_0x58d27f(0x244)][_0x58d27f(0x1a5)]+_0x58d27f(0x20f)+_0xbac3ad),_0x31aa93[_0x58d27f(0x244)][_0x58d27f(0x156)]((_0x4fd370,_0x8a0fb8)=>{const _0x2e72b4=_0x58d27f;_0x4fd370&&(clearTimeout(_0x4fd370),clearInterval(_0x4fd370),console['log'](_0x2e72b4(0x1fc)+(_0x8a0fb8+0x1)+'\x20for\x20payment\x20'+_0xbac3ad));}),this[_0x58d27f(0x171)][_0x58d27f(0x260)](_0xbac3ad),console[_0x58d27f(0x1ac)](_0x58d27f(0x1a3)+_0xbac3ad+_0x58d27f(0x1ce)+this[_0x58d27f(0x171)][_0x58d27f(0x195)])):console[_0x58d27f(0x1ac)]('âš ï¸\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20'+_0xbac3ad+'\x20to\x20clear');}async[a48_0x53ce1d(0x24b)](_0x1f06a2){const _0x4b4a28=a48_0x53ce1d;console[_0x4b4a28(0x1ac)]('ðŸ”\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20'+_0x1f06a2);const _0x251fc4=await database_1[_0x4b4a28(0x170)][_0x4b4a28(0x163)][_0x4b4a28(0x22e)]({'where':{'id':_0x1f06a2},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x251fc4){console[_0x4b4a28(0x1ac)](_0x4b4a28(0x218)+_0x1f06a2+_0x4b4a28(0x23b));return;}console[_0x4b4a28(0x1ac)](_0x4b4a28(0x161)+_0x1f06a2+_0x4b4a28(0x1db)),console[_0x4b4a28(0x1ac)]('\x20\x20\x20-\x20Gateway:\x20'+_0x251fc4[_0x4b4a28(0x19c)]),console[_0x4b4a28(0x1ac)](_0x4b4a28(0x1f9)+_0x251fc4[_0x4b4a28(0x1f8)]),console['log'](_0x4b4a28(0x1ea)+_0x251fc4[_0x4b4a28(0x1a4)]),console['log'](_0x4b4a28(0x1ca)+_0x251fc4['amount']+'\x20'+_0x251fc4['currency']),console[_0x4b4a28(0x1ac)]('\x20\x20\x20-\x20ShopId:\x20'+_0x251fc4[_0x4b4a28(0x201)]);if(_0x251fc4[_0x4b4a28(0x19c)]!==_0x4b4a28(0x254)&&_0x251fc4[_0x4b4a28(0x19c)]!==_0x4b4a28(0x23f)){console[_0x4b4a28(0x1ac)](_0x4b4a28(0x1ef)+_0x1f06a2+_0x4b4a28(0x214)+_0x251fc4['gateway']+')');return;}if(_0x251fc4['status']!==_0x4b4a28(0x173)){console[_0x4b4a28(0x1ac)](_0x4b4a28(0x1ef)+_0x1f06a2+_0x4b4a28(0x174)+_0x251fc4['status']+_0x4b4a28(0x184)),this[_0x4b4a28(0x242)](_0x1f06a2);return;}if(!_0x251fc4[_0x4b4a28(0x1a4)]){console['log']('âš ï¸\x20[CHECK]\x20Payment\x20'+_0x1f06a2+_0x4b4a28(0x256));return;}console[_0x4b4a28(0x1ac)](_0x4b4a28(0x215)+_0x1f06a2+_0x4b4a28(0x175)),await this[_0x4b4a28(0x226)](_0x251fc4);}[a48_0x53ce1d(0x1fa)](_0x5229d8,_0xaec17d,_0x2b10fe,_0x19a8c0,_0x1c7e77,_0x4f566c){const _0x525c15=a48_0x53ce1d,_0x11303f={'type':_0x525c15(0x207),'paymentId':_0x5229d8,'gatewayPaymentId':_0xaec17d,'oldStatus':_0x2b10fe,'newStatus':_0x19a8c0,'source':_0x1c7e77,'timestamp':new Date()[_0x525c15(0x25b)](),'details':_0x4f566c||{}};loggerService_1['loggerService'][_0x525c15(0x1fa)](_0x11303f),console[_0x525c15(0x1ac)](_0x525c15(0x1b7)+_0x5229d8+'\x20('+_0xaec17d+')'),console['log'](_0x525c15(0x1d8)+_0x2b10fe+'\x20->\x20'+_0x19a8c0),console[_0x525c15(0x1ac)]('\x20\x20\x20ðŸ“\x20Source:\x20'+_0x1c7e77),console['log'](_0x525c15(0x18b)+_0x11303f[_0x525c15(0x153)]),_0x4f566c&&console[_0x525c15(0x1ac)]('\x20\x20\x20ðŸ“\x20Details:',_0x4f566c);}[a48_0x53ce1d(0x18c)](_0x15de12,_0x3d4ae7,_0x4e8eb0,_0x2a123e,_0x253b4d){const _0x530c61=a48_0x53ce1d,_0x194eef={'type':_0x530c61(0x20c),'paymentId':_0x15de12,'gatewayPaymentId':_0x3d4ae7,'error':_0x4e8eb0 instanceof Error?{'message':_0x4e8eb0['message'],'stack':_0x4e8eb0['stack']}:_0x4e8eb0,'source':_0x2a123e,'timestamp':new Date()['toISOString'](),'context':_0x253b4d||{}};loggerService_1[_0x530c61(0x222)]['logCoinToPayError'](_0x194eef),console[_0x530c61(0x1d1)]('ðŸª™\x20[ERROR]\x20CoinToPay\x20Error:\x20'+_0x15de12+'\x20('+_0x3d4ae7+')'),console[_0x530c61(0x1d1)](_0x530c61(0x234)+(_0x4e8eb0 instanceof Error?_0x4e8eb0[_0x530c61(0x169)]:_0x4e8eb0)),console[_0x530c61(0x1d1)]('\x20\x20\x20ðŸ“\x20Source:\x20'+_0x2a123e),console[_0x530c61(0x1d1)](_0x530c61(0x18b)+_0x194eef['timestamp']),_0x253b4d&&console['error']('\x20\x20\x20ðŸ“\x20Context:',_0x253b4d);}['startPeriodicStatusCheck'](){const _0x5e6fc0=a48_0x53ce1d;console[_0x5e6fc0(0x1ac)]('ðŸª™\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)'),this['checkAllPendingPayments']()[_0x5e6fc0(0x1aa)](_0x3fa8b6=>{const _0x22e4f8=_0x5e6fc0;console['error'](_0x22e4f8(0x1a1),_0x3fa8b6);}),this[_0x5e6fc0(0x1d9)]=setInterval(async()=>{const _0x121057=_0x5e6fc0;try{console['log'](_0x121057(0x1e8)),await this[_0x121057(0x1c2)](),console[_0x121057(0x1ac)]('âœ…\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed');}catch(_0x49b013){console[_0x121057(0x1d1)](_0x121057(0x202),_0x49b013);}},this['GLOBAL_CHECK_INTERVAL_MS']),console[_0x5e6fc0(0x1ac)](_0x5e6fc0(0x1f4));}[a48_0x53ce1d(0x172)](){const _0x59b768=a48_0x53ce1d;console[_0x59b768(0x1ac)]('ðŸ›‘\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...');this['globalCheckInterval']&&(clearInterval(this[_0x59b768(0x1d9)]),this[_0x59b768(0x1d9)]=null,console['log'](_0x59b768(0x193)));const _0x2eeebb=this['paymentTimers'][_0x59b768(0x195)];for(const [_0x3eaa64]of this[_0x59b768(0x171)]){this['clearPaymentTimers'](_0x3eaa64);}console[_0x59b768(0x1ac)]('ðŸ›‘\x20[SHUTDOWN]\x20Cleared\x20'+_0x2eeebb+'\x20individual\x20payment\x20timers');}async[a48_0x53ce1d(0x1c2)](){const _0xcf2227=a48_0x53ce1d;try{console['log'](_0xcf2227(0x18f));const _0xaf9718=await database_1[_0xcf2227(0x170)][_0xcf2227(0x163)][_0xcf2227(0x1c7)]({'where':{'gateway':{'in':[_0xcf2227(0x254),_0xcf2227(0x23f)]},'status':_0xcf2227(0x173),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0xcf2227(0x1ac)](_0xcf2227(0x166)+_0xaf9718[_0xcf2227(0x1a5)]+'\x20pending\x20CoinToPay\x20payments');if(_0xaf9718[_0xcf2227(0x1a5)]===0x0){console[_0xcf2227(0x1ac)]('ðŸª™\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check');return;}const _0x52be5e=await this[_0xcf2227(0x1de)](_0xaf9718);console[_0xcf2227(0x1ac)](_0xcf2227(0x21c)+_0x52be5e[_0xcf2227(0x1a5)]+_0xcf2227(0x22c));let _0x3c50b7=0x0,_0x58440c=0x0;for(const _0xe60fde of _0xaf9718){try{if(_0x52be5e[_0xcf2227(0x25f)](_0xe60fde['id'])){console['log'](_0xcf2227(0x232)+_0xe60fde['id']+_0xcf2227(0x1f1)),_0x58440c++;continue;}if(this[_0xcf2227(0x171)]['has'](_0xe60fde['id'])){console[_0xcf2227(0x1ac)](_0xcf2227(0x232)+_0xe60fde['id']+_0xcf2227(0x16d)),_0x58440c++;continue;}const _0x28995e=(Date[_0xcf2227(0x1e3)]()-_0xe60fde['createdAt']['getTime']())/(0x3e8*0x3c*0x3c);if(_0x28995e<0x1){console[_0xcf2227(0x1ac)](_0xcf2227(0x232)+_0xe60fde['id']+_0xcf2227(0x15f)+_0x28995e['toFixed'](0x1)+_0xcf2227(0x1ab)),_0x58440c++;continue;}console['log'](_0xcf2227(0x192)+_0xe60fde['id']+_0xcf2227(0x24c)+_0x28995e[_0xcf2227(0x1e4)](0x1)+'h)'),await this[_0xcf2227(0x226)](_0xe60fde),_0x3c50b7++,await new Promise(_0x5946f1=>setTimeout(_0x5946f1,0x7d0));}catch(_0x2dbc4b){console[_0xcf2227(0x1d1)](_0xcf2227(0x240)+_0xe60fde['id']+':',_0x2dbc4b),this[_0xcf2227(0x18c)](_0xe60fde['id'],_0xe60fde['gatewayPaymentId']||_0xcf2227(0x164),_0x2dbc4b,_0xcf2227(0x15c),{'isGlobalCheck':!![],'paymentAmount':_0xe60fde['amount'],'paymentCurrency':_0xe60fde[_0xcf2227(0x1e7)],'shopId':_0xe60fde[_0xcf2227(0x201)],'createdAt':_0xe60fde[_0xcf2227(0x1c1)]}),loggerService_1[_0xcf2227(0x222)][_0xcf2227(0x255)](_0xcf2227(0x254),'/status/'+_0xe60fde[_0xcf2227(0x1a4)],_0x2dbc4b);}}console[_0xcf2227(0x1ac)](_0xcf2227(0x24f)+_0x3c50b7+_0xcf2227(0x1d4)+_0x58440c+_0xcf2227(0x18d)+_0x52be5e[_0xcf2227(0x1a5)]+_0xcf2227(0x1d7));}catch(_0x31f7d1){console[_0xcf2227(0x1d1)](_0xcf2227(0x1bf),_0x31f7d1);}}async[a48_0x53ce1d(0x1de)](_0x19b5ed){const _0x46833b=a48_0x53ce1d,_0x30196b=[],_0x51fa25=new Date();_0x51fa25['setDate'](_0x51fa25['getDate']()-this['EXPIRY_DAYS']),console['log'](_0x46833b(0x211)+this[_0x46833b(0x19a)]+'\x20days\x20(created\x20before\x20'+_0x51fa25[_0x46833b(0x25b)]()+')');for(const _0x5a79fb of _0x19b5ed){if(_0x5a79fb['createdAt']<_0x51fa25){console[_0x46833b(0x1ac)](_0x46833b(0x152)+_0x5a79fb['id']+'\x20is\x20older\x20than\x20'+this[_0x46833b(0x19a)]+_0x46833b(0x239));try{this[_0x46833b(0x1fa)](_0x5a79fb['id'],_0x5a79fb['gatewayPaymentId']||_0x46833b(0x164),_0x46833b(0x173),_0x46833b(0x1dc),'auto_expire',{'reason':_0x46833b(0x19e)+this[_0x46833b(0x19a)]+_0x46833b(0x1ad),'createdAt':_0x5a79fb[_0x46833b(0x1c1)],'daysSinceCreation':Math[_0x46833b(0x1b8)]((Date[_0x46833b(0x1e3)]()-_0x5a79fb[_0x46833b(0x1c1)][_0x46833b(0x205)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x5a79fb[_0x46833b(0x1ee)],'paymentCurrency':_0x5a79fb[_0x46833b(0x1e7)],'shopId':_0x5a79fb[_0x46833b(0x201)]}),await database_1[_0x46833b(0x170)][_0x46833b(0x163)][_0x46833b(0x191)]({'where':{'id':_0x5a79fb['id']},'data':{'status':_0x46833b(0x1dc),'updatedAt':new Date()}}),await database_1[_0x46833b(0x170)][_0x46833b(0x251)]['create']({'data':{'paymentId':_0x5a79fb['id'],'shopId':_0x5a79fb[_0x46833b(0x201)],'event':_0x46833b(0x19b),'statusCode':0xc8,'responseBody':JSON[_0x46833b(0x203)]({'reason':_0x46833b(0x19e)+this[_0x46833b(0x19a)]+_0x46833b(0x1ad),'createdAt':_0x5a79fb[_0x46833b(0x1c1)],'expiredAt':new Date()['toISOString'](),'daysSinceCreation':Math[_0x46833b(0x1b8)]((Date[_0x46833b(0x1e3)]()-_0x5a79fb[_0x46833b(0x1c1)][_0x46833b(0x205)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x46833b(0x1d3)](_0x5a79fb,'EXPIRED'),await this['sendPaymentStatusNotification'](_0x5a79fb,_0x46833b(0x1dc)),this[_0x46833b(0x242)](_0x5a79fb['id']),_0x30196b[_0x46833b(0x17c)](_0x5a79fb['id']),console[_0x46833b(0x1ac)](_0x46833b(0x17d)+_0x5a79fb['id']+_0x46833b(0x23a)+this[_0x46833b(0x19a)]+'-day\x20timeout');}catch(_0x179f8f){console[_0x46833b(0x1d1)](_0x46833b(0x241)+_0x5a79fb['id']+':',_0x179f8f),this[_0x46833b(0x18c)](_0x5a79fb['id'],_0x5a79fb[_0x46833b(0x1a4)]||_0x46833b(0x164),_0x179f8f,_0x46833b(0x16b),{'reason':_0x46833b(0x1dd),'createdAt':_0x5a79fb['createdAt'],'daysSinceCreation':Math[_0x46833b(0x1b8)]((Date[_0x46833b(0x1e3)]()-_0x5a79fb[_0x46833b(0x1c1)][_0x46833b(0x205)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x30196b;}async['checkSinglePayment'](_0x4bdca5){const _0x20a2f0=a48_0x53ce1d;if(!_0x4bdca5[_0x20a2f0(0x1a4)]){console[_0x20a2f0(0x1ac)](_0x20a2f0(0x1ef)+_0x4bdca5['id']+_0x20a2f0(0x243));return;}console['log']('ðŸ”\x20[CHECK]\x20Checking\x20'+_0x4bdca5[_0x20a2f0(0x19c)]+'\x20payment\x20'+_0x4bdca5['id']+'\x20('+_0x4bdca5[_0x20a2f0(0x1a4)]+')');try{let _0x28976c;_0x4bdca5['gateway']===_0x20a2f0(0x23f)?(_0x28976c=await this[_0x20a2f0(0x213)]['checkPaymentStatus'](_0x4bdca5[_0x20a2f0(0x1a4)]),console[_0x20a2f0(0x1ac)](_0x20a2f0(0x1cf)+_0x4bdca5['id']+_0x20a2f0(0x1df)+_0x28976c[_0x20a2f0(0x1f8)])):(_0x28976c=await this['coinToPayService']['checkPaymentStatus'](_0x4bdca5[_0x20a2f0(0x1a4)]),console[_0x20a2f0(0x1ac)](_0x20a2f0(0x1e0)+_0x4bdca5['id']+'\x20status:\x20'+_0x28976c[_0x20a2f0(0x1f8)]));_0x28976c['paymentDetails']&&console[_0x20a2f0(0x1ac)]('ðŸ“Š\x20[CHECK]\x20Payment\x20'+_0x4bdca5['id']+_0x20a2f0(0x24d),{'iban':_0x28976c['paymentDetails'][_0x20a2f0(0x219)]||_0x20a2f0(0x185),'transactionId':_0x28976c[_0x20a2f0(0x1c6)][_0x20a2f0(0x22a)],'createdOn':_0x28976c['paymentDetails'][_0x20a2f0(0x1e9)],'confirmedOn':_0x28976c[_0x20a2f0(0x1c6)][_0x20a2f0(0x1a6)]||'not\x20confirmed'});if(_0x28976c[_0x20a2f0(0x1f8)]!==_0x4bdca5[_0x20a2f0(0x1f8)]){console[_0x20a2f0(0x1ac)](_0x20a2f0(0x25e)+_0x4bdca5['id']+_0x20a2f0(0x217)+_0x4bdca5['status']+_0x20a2f0(0x24e)+_0x28976c[_0x20a2f0(0x1f8)]),this[_0x20a2f0(0x1fa)](_0x4bdca5['id'],_0x4bdca5[_0x20a2f0(0x1a4)],_0x4bdca5['status'],_0x28976c[_0x20a2f0(0x1f8)],_0x20a2f0(0x15c),{'paymentDetails':_0x28976c['paymentDetails'],'amount':_0x28976c[_0x20a2f0(0x1ee)],'currency':_0x28976c['currency'],'shopId':_0x4bdca5['shopId'],'checkTimestamp':new Date()['toISOString']()});const _0x2205be={'status':_0x28976c['status'],'updatedAt':new Date()};if(_0x28976c[_0x20a2f0(0x1f8)]===_0x20a2f0(0x1e5)&&_0x4bdca5[_0x20a2f0(0x1f8)]!==_0x20a2f0(0x1e5)){_0x2205be['paidAt']=new Date();if(!_0x4bdca5['amountUSDT']){const _0x25aeb8=await currencyService_1['currencyService'][_0x20a2f0(0x1d6)](_0x4bdca5[_0x20a2f0(0x1ee)],_0x4bdca5[_0x20a2f0(0x1e7)]);_0x2205be[_0x20a2f0(0x221)]=_0x25aeb8;const _0x60e4bd=await this[_0x20a2f0(0x22b)](_0x4bdca5[_0x20a2f0(0x201)],_0x4bdca5[_0x20a2f0(0x19c)]),_0x26ec3b=_0x25aeb8*(0x1-_0x60e4bd/0x64);_0x2205be[_0x20a2f0(0x1b2)]=_0x26ec3b,_0x2205be[_0x20a2f0(0x209)]=_0x60e4bd,console[_0x20a2f0(0x1ac)](_0x20a2f0(0x247)+_0x4bdca5['id']+'\x20amounts\x20calculated:'),console[_0x20a2f0(0x1ac)](_0x20a2f0(0x25d)+_0x4bdca5[_0x20a2f0(0x1ee)]+'\x20'+_0x4bdca5[_0x20a2f0(0x1e7)]+'\x20->\x20'+_0x25aeb8[_0x20a2f0(0x1e4)](0x6)+_0x20a2f0(0x197)),console[_0x20a2f0(0x1ac)](_0x20a2f0(0x261)+_0x4bdca5['gateway']+_0x20a2f0(0x264)+_0x60e4bd+'%'),console[_0x20a2f0(0x1ac)](_0x20a2f0(0x198)+_0x26ec3b[_0x20a2f0(0x1e4)](0x6)+_0x20a2f0(0x197));}console[_0x20a2f0(0x1ac)]('ðŸ’°\x20[CHECK]\x20Payment\x20'+_0x4bdca5['id']+_0x20a2f0(0x204)+_0x2205be[_0x20a2f0(0x216)][_0x20a2f0(0x25b)]());}if(_0x28976c['paymentDetails']){const _0x4a17d1=_0x28976c[_0x20a2f0(0x1c6)];_0x4a17d1[_0x20a2f0(0x219)]&&(_0x2205be[_0x20a2f0(0x154)]=_0x4a17d1[_0x20a2f0(0x219)],console[_0x20a2f0(0x1ac)](_0x20a2f0(0x194)+_0x4a17d1[_0x20a2f0(0x219)])),_0x4a17d1[_0x20a2f0(0x22d)]&&console[_0x20a2f0(0x1ac)](_0x20a2f0(0x1da)+_0x4a17d1['bankDetails']),_0x4a17d1[_0x20a2f0(0x22a)]&&console[_0x20a2f0(0x1ac)](_0x20a2f0(0x259)+_0x4a17d1[_0x20a2f0(0x22a)]),_0x4a17d1[_0x20a2f0(0x1a6)]&&console[_0x20a2f0(0x1ac)](_0x20a2f0(0x1ec)+_0x4a17d1[_0x20a2f0(0x1a6)]);}await database_1[_0x20a2f0(0x170)][_0x20a2f0(0x163)][_0x20a2f0(0x191)]({'where':{'id':_0x4bdca5['id']},'data':_0x2205be});if(_0x28976c[_0x20a2f0(0x1f8)]==='PAID'&&_0x4bdca5[_0x20a2f0(0x1f8)]!==_0x20a2f0(0x1e5)){console[_0x20a2f0(0x1ac)](_0x20a2f0(0x20b)+_0x4bdca5['id']+'\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link');const _0x4a0726=await database_1[_0x20a2f0(0x170)]['payment'][_0x20a2f0(0x22e)]({'where':{'id':_0x4bdca5['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x4a0726?.[_0x20a2f0(0x1c8)]&&_0x4a0726[_0x20a2f0(0x16a)])try{const _0x1305ba=_0x4a0726[_0x20a2f0(0x16a)];console[_0x20a2f0(0x1ac)](_0x20a2f0(0x200)+_0x1305ba['id']+_0x20a2f0(0x210)+_0x1305ba[_0x20a2f0(0x178)]+_0x20a2f0(0x206)+_0x1305ba[_0x20a2f0(0x1b3)]+_0x20a2f0(0x231)+_0x1305ba[_0x20a2f0(0x1f8)]);const _0x30ee66=_0x1305ba[_0x20a2f0(0x1b3)]+0x1,_0x4b53a5=_0x1305ba['type']===_0x20a2f0(0x182)?'COMPLETED':_0x1305ba[_0x20a2f0(0x1f8)];await database_1[_0x20a2f0(0x170)][_0x20a2f0(0x16a)]['update']({'where':{'id':_0x1305ba['id']},'data':{'currentPayments':_0x30ee66,'status':_0x4b53a5,'updatedAt':new Date()}}),console['log']('âœ…\x20[COINTOPAY]\x20Payment\x20link\x20'+_0x1305ba['id']+_0x20a2f0(0x18a)+_0x1305ba[_0x20a2f0(0x1b3)]+'\x20->\x20'+_0x30ee66+_0x20a2f0(0x231)+_0x1305ba[_0x20a2f0(0x1f8)]+_0x20a2f0(0x25c)+_0x4b53a5);}catch(_0x473939){console[_0x20a2f0(0x1d1)](_0x20a2f0(0x186),_0x473939);}else console[_0x20a2f0(0x1ac)](_0x20a2f0(0x20b)+_0x4bdca5['id']+_0x20a2f0(0x1d2));}await database_1[_0x20a2f0(0x170)][_0x20a2f0(0x251)][_0x20a2f0(0x20d)]({'data':{'paymentId':_0x4bdca5['id'],'shopId':_0x4bdca5['shopId'],'event':_0x20a2f0(0x225)+_0x28976c[_0x20a2f0(0x1f8)][_0x20a2f0(0x21e)](),'statusCode':0xc8,'responseBody':JSON['stringify']({'oldStatus':_0x4bdca5['status'],'newStatus':_0x28976c[_0x20a2f0(0x1f8)],'paymentDetails':_0x28976c['paymentDetails'],'checkedAt':new Date()[_0x20a2f0(0x25b)]()})}}),await this[_0x20a2f0(0x1d3)](_0x4bdca5,_0x28976c['status']),await this['sendPaymentStatusNotification'](_0x4bdca5,_0x28976c[_0x20a2f0(0x1f8)]),_0x28976c[_0x20a2f0(0x1f8)]!==_0x20a2f0(0x173)&&(console['log'](_0x20a2f0(0x1f0)+_0x4bdca5['id']+_0x20a2f0(0x21b)+_0x28976c[_0x20a2f0(0x1f8)]+',\x20clearing\x20individual\x20timers'),this[_0x20a2f0(0x242)](_0x4bdca5['id'])),console['log'](_0x20a2f0(0x215)+_0x4bdca5['id']+_0x20a2f0(0x1ed));}else console[_0x20a2f0(0x1ac)](_0x20a2f0(0x161)+_0x4bdca5['id']+_0x20a2f0(0x1e2)+_0x28976c['status']+')'),this[_0x20a2f0(0x1fa)](_0x4bdca5['id'],_0x4bdca5['gatewayPaymentId'],_0x4bdca5[_0x20a2f0(0x1f8)],_0x28976c[_0x20a2f0(0x1f8)],_0x20a2f0(0x15c),{'statusUnchanged':!![],'paymentDetails':_0x28976c[_0x20a2f0(0x1c6)],'amount':_0x28976c['amount'],'currency':_0x28976c[_0x20a2f0(0x1e7)],'shopId':_0x4bdca5[_0x20a2f0(0x201)],'checkTimestamp':new Date()['toISOString']()});}catch(_0x2b9f97){console[_0x20a2f0(0x1d1)](_0x20a2f0(0x24a)+_0x4bdca5['id']+':',_0x2b9f97),this[_0x20a2f0(0x18c)](_0x4bdca5['id'],_0x4bdca5[_0x20a2f0(0x1a4)],_0x2b9f97,'status_check',{'paymentAmount':_0x4bdca5['amount'],'paymentCurrency':_0x4bdca5[_0x20a2f0(0x1e7)],'shopId':_0x4bdca5[_0x20a2f0(0x201)],'createdAt':_0x4bdca5[_0x20a2f0(0x1c1)]}),await database_1['default'][_0x20a2f0(0x251)][_0x20a2f0(0x20d)]({'data':{'paymentId':_0x4bdca5['id'],'shopId':_0x4bdca5[_0x20a2f0(0x201)],'event':_0x20a2f0(0x212),'statusCode':0x1f4,'responseBody':JSON[_0x20a2f0(0x203)]({'error':_0x2b9f97 instanceof Error?_0x2b9f97[_0x20a2f0(0x169)]:_0x20a2f0(0x252),'gatewayPaymentId':_0x4bdca5[_0x20a2f0(0x1a4)],'checkedAt':new Date()[_0x20a2f0(0x25b)]()})}});}}async[a48_0x53ce1d(0x1d3)](_0x4dfc27,_0x2d63c2){const _0x54c1ee=a48_0x53ce1d,_0x2f85f4=Date[_0x54c1ee(0x1e3)]();try{const _0x1c853f=_0x4dfc27[_0x54c1ee(0x263)],_0xf11b08=_0x1c853f[_0x54c1ee(0x19f)];if(!_0xf11b08?.['webhookUrl']){console['log'](_0x54c1ee(0x262)+_0x1c853f['id']);return;}const _0xdd919=_0x2d63c2===_0x54c1ee(0x1e5)?'payment.success':_0x2d63c2===_0x54c1ee(0x17e)?_0x54c1ee(0x227):_0x2d63c2===_0x54c1ee(0x1dc)?_0x54c1ee(0x227):_0x54c1ee(0x25a);if(!_0xf11b08[_0x54c1ee(0x1e1)]?.['includes'](_0xdd919)){console[_0x54c1ee(0x1ac)](_0x54c1ee(0x1b9)+_0xdd919+'\x20not\x20enabled\x20for\x20shop\x20'+_0x1c853f['id']);return;}const _0x210e51=(0x0,gateway_1[_0x54c1ee(0x15d)])(_0x4dfc27[_0x54c1ee(0x19c)])||_0x4dfc27['gateway'],_0x4497e3={'event':_0xdd919,'payment':{'id':_0x4dfc27['id'],'order_id':_0x4dfc27[_0x54c1ee(0x1b6)],'gateway_order_id':_0x4dfc27[_0x54c1ee(0x1ae)],'gateway':_0x210e51,'amount':_0x4dfc27[_0x54c1ee(0x1ee)],'currency':_0x4dfc27[_0x54c1ee(0x1e7)],'status':_0x2d63c2[_0x54c1ee(0x21e)](),'customer_email':_0x4dfc27[_0x54c1ee(0x21f)],'customer_name':_0x4dfc27['customerName'],'created_at':_0x4dfc27[_0x54c1ee(0x1c1)],'updated_at':new Date()}},_0x225bc9=await fetch(_0xf11b08[_0x54c1ee(0x155)],{'method':'POST','headers':{'Content-Type':'application/json','User-Agent':_0x54c1ee(0x17a)},'body':JSON['stringify'](_0x4497e3)}),_0x1c414a=Date[_0x54c1ee(0x1e3)]()-_0x2f85f4,_0x100487=_0x225bc9['ok']?_0x54c1ee(0x249):await _0x225bc9[_0x54c1ee(0x1c3)]();loggerService_1['loggerService'][_0x54c1ee(0x1af)](_0x4dfc27['shopId'],_0xf11b08[_0x54c1ee(0x155)],_0xdd919,_0x225bc9[_0x54c1ee(0x1f8)],_0x1c414a,_0x4497e3),console[_0x54c1ee(0x1ac)](_0x54c1ee(0x1d5)+_0xf11b08[_0x54c1ee(0x155)]+_0x54c1ee(0x1fe)+_0x225bc9[_0x54c1ee(0x1f8)]+'\x20('+_0x1c414a+_0x54c1ee(0x1b0));}catch(_0x264765){console[_0x54c1ee(0x1d1)](_0x54c1ee(0x257),_0x264765),loggerService_1[_0x54c1ee(0x222)][_0x54c1ee(0x1fd)](_0x4dfc27[_0x54c1ee(0x201)],_0x4dfc27[_0x54c1ee(0x263)]?.['settings']?.[_0x54c1ee(0x155)]||_0x54c1ee(0x164),_0x54c1ee(0x162),_0x264765,{});}}async[a48_0x53ce1d(0x16e)](_0x364bfc,_0x29a99d){const _0x138538=a48_0x53ce1d;try{const _0x55cbdc={'PENDING':_0x138538(0x168),'PAID':'paid','FAILED':_0x138538(0x187),'EXPIRED':_0x138538(0x1f7)},_0x41a511=_0x55cbdc[_0x29a99d];if(!_0x41a511||_0x41a511===_0x138538(0x168))return;await telegramBotService_1['telegramBotService'][_0x138538(0x15e)](_0x364bfc[_0x138538(0x201)],_0x364bfc,_0x41a511);}catch(_0x3a6dcb){console[_0x138538(0x1d1)](_0x138538(0x1f6),_0x3a6dcb);}}async[a48_0x53ce1d(0x151)](_0x475df0){const _0x3e16e2=a48_0x53ce1d;console[_0x3e16e2(0x1ac)](_0x3e16e2(0x237)+_0x475df0);const _0x2c7a76=await database_1[_0x3e16e2(0x170)][_0x3e16e2(0x163)]['findUnique']({'where':{'id':_0x475df0},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x2c7a76)throw new Error(_0x3e16e2(0x235));if(_0x2c7a76[_0x3e16e2(0x19c)]!==_0x3e16e2(0x254)&&_0x2c7a76[_0x3e16e2(0x19c)]!=='cointopay2')throw new Error(_0x3e16e2(0x188));console[_0x3e16e2(0x1ac)](_0x3e16e2(0x1a0)+_0x2c7a76[_0x3e16e2(0x19c)]+_0x3e16e2(0x196)+_0x475df0),await this[_0x3e16e2(0x226)](_0x2c7a76),console[_0x3e16e2(0x1ac)](_0x3e16e2(0x236)+_0x475df0);}[a48_0x53ce1d(0x158)](){const _0x53fbd7=a48_0x53ce1d,_0x503152=this[_0x53fbd7(0x1d9)]?this[_0x53fbd7(0x21d)]:undefined,_0x275d7a=Array[_0x53fbd7(0x1c4)](this[_0x53fbd7(0x171)]['values']())['map'](_0x5620b6=>({'paymentId':_0x5620b6[_0x53fbd7(0x21a)],'gatewayPaymentId':_0x5620b6['gatewayPaymentId'],'createdAt':_0x5620b6[_0x53fbd7(0x1c1)],'timersCount':_0x5620b6[_0x53fbd7(0x244)][_0x53fbd7(0x1a5)]}));return{'isActive':!!this[_0x53fbd7(0x1d9)],'globalCheckIntervalMinutes':this[_0x53fbd7(0x21d)]/(0x3e8*0x3c),'expiryDays':this[_0x53fbd7(0x19a)],'activeIndividualTimers':this[_0x53fbd7(0x171)][_0x53fbd7(0x195)],'nextGlobalCheckIn':_0x503152,'paymentTimersDetails':_0x275d7a};}[a48_0x53ce1d(0x245)](_0x1968d2){const _0x411627=a48_0x53ce1d,_0x5232dc=this[_0x411627(0x171)]['get'](_0x1968d2);if(_0x5232dc)return{'hasTimers':!![],'timersCount':_0x5232dc[_0x411627(0x244)]['length'],'createdAt':_0x5232dc[_0x411627(0x1c1)],'gatewayPaymentId':_0x5232dc[_0x411627(0x1a4)]};return{'hasTimers':![]};}async[a48_0x53ce1d(0x22b)](_0x174c53,_0x569fbb){const _0x37753e=a48_0x53ce1d;try{const _0x5f096f=await database_1[_0x37753e(0x170)][_0x37753e(0x263)][_0x37753e(0x22e)]({'where':{'id':_0x174c53},'select':{'gatewaySettings':!![]}});if(!_0x5f096f?.[_0x37753e(0x238)])return console[_0x37753e(0x1ac)](_0x37753e(0x230)+_0x174c53+',\x20using\x20default\x20commission\x2010%'),0xa;const _0x2ca807=JSON[_0x37753e(0x16f)](_0x5f096f[_0x37753e(0x238)]);for(const [_0x450d4a,_0xe4eebf]of Object[_0x37753e(0x1f2)](_0x2ca807)){if(_0x450d4a[_0x37753e(0x21e)]()===_0x569fbb[_0x37753e(0x21e)]()){const _0x45685c=_0xe4eebf[_0x37753e(0x1bc)]||0xa;return console['log'](_0x37753e(0x1f3)+_0x569fbb+_0x37753e(0x22f)+_0x174c53+':\x20'+_0x45685c+'%'),_0x45685c;}}return console['log']('No\x20specific\x20commission\x20found\x20for\x20gateway\x20'+_0x569fbb+_0x37753e(0x228)+_0x174c53+_0x37753e(0x16c)),0xa;}catch(_0x6f18c){return console[_0x37753e(0x1d1)](_0x37753e(0x1bb)+_0x174c53+_0x37753e(0x157)+_0x569fbb+':',_0x6f18c),0xa;}}}exports['CoinToPayStatusService']=CoinToPayStatusService,exports[a48_0x53ce1d(0x1ba)]=new CoinToPayStatusService();