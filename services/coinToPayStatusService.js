'use strict';const a40_0x1bb95c=a40_0x6416;(function(_0x4f145e,_0x497171){const _0x43fe25=a40_0x6416,_0x32c52f=_0x4f145e();while(!![]){try{const _0x57874b=parseInt(_0x43fe25(0x269))/0x1*(-parseInt(_0x43fe25(0x26d))/0x2)+-parseInt(_0x43fe25(0x1cc))/0x3*(parseInt(_0x43fe25(0x1e0))/0x4)+-parseInt(_0x43fe25(0x21b))/0x5+-parseInt(_0x43fe25(0x1df))/0x6*(-parseInt(_0x43fe25(0x215))/0x7)+-parseInt(_0x43fe25(0x1f1))/0x8*(-parseInt(_0x43fe25(0x1db))/0x9)+-parseInt(_0x43fe25(0x2a3))/0xa+-parseInt(_0x43fe25(0x276))/0xb*(-parseInt(_0x43fe25(0x1d5))/0xc);if(_0x57874b===_0x497171)break;else _0x32c52f['push'](_0x32c52f['shift']());}catch(_0x385d4c){_0x32c52f['push'](_0x32c52f['shift']());}}}(a40_0x2c3d,0xc59cb));var __importDefault=this&&this[a40_0x1bb95c(0x279)]||function(_0x2d4178){const _0x5b5bcd=a40_0x1bb95c;return _0x2d4178&&_0x2d4178[_0x5b5bcd(0x27f)]?_0x2d4178:{'default':_0x2d4178};};Object['defineProperty'](exports,a40_0x1bb95c(0x27f),{'value':!![]}),exports[a40_0x1bb95c(0x1ec)]=exports[a40_0x1bb95c(0x299)]=void 0x0;function a40_0x6416(_0x2a168b,_0x2dec21){const _0x2c3d99=a40_0x2c3d();return a40_0x6416=function(_0x641643,_0x19e2fa){_0x641643=_0x641643-0x1a0;let _0x900cb6=_0x2c3d99[_0x641643];return _0x900cb6;},a40_0x6416(_0x2a168b,_0x2dec21);}const coinToPayService_1=require(a40_0x1bb95c(0x1aa)),coinToPay2Service_1=require(a40_0x1bb95c(0x1da)),gateway_1=require(a40_0x1bb95c(0x1e3)),database_1=__importDefault(require(a40_0x1bb95c(0x254))),telegramBotService_1=require(a40_0x1bb95c(0x236)),loggerService_1=require(a40_0x1bb95c(0x1c4)),currencyService_1=require(a40_0x1bb95c(0x280));class CoinToPayStatusService{constructor(){const _0x25a80f=a40_0x1bb95c;this['globalCheckInterval']=null,this['GLOBAL_CHECK_INTERVAL_MS']=0x3c*0x3c*0x3e8,this[_0x25a80f(0x24a)]=0x5,this[_0x25a80f(0x29b)]=new Map(),this['coinToPayService']=new coinToPayService_1[(_0x25a80f(0x284))](),this[_0x25a80f(0x1c6)]=new coinToPay2Service_1['CoinToPay2Service'](),console[_0x25a80f(0x1a7)]('ü™ô\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2');}[a40_0x1bb95c(0x273)](_0x1522e6,_0x399215){const _0x12cd27=a40_0x1bb95c;console[_0x12cd27(0x1a7)](_0x12cd27(0x1bb)),console[_0x12cd27(0x1a7)](_0x12cd27(0x1b7)+_0x1522e6),console['log'](_0x12cd27(0x203)+_0x399215),this[_0x12cd27(0x228)](_0x1522e6);const _0x192c86=[],_0x5ca664=new Date(),_0x54203f=[{'delay':0x1*0x3c*0x3e8,'description':_0x12cd27(0x242)},{'delay':0x2*0x3c*0x3e8,'description':_0x12cd27(0x1f8)},{'delay':0x5*0x3c*0x3e8,'description':_0x12cd27(0x20f)},{'delay':0x5*0x3c*0x3e8,'description':_0x12cd27(0x20f)}];console[_0x12cd27(0x1a7)](_0x12cd27(0x275)+_0x54203f[_0x12cd27(0x1d0)]+_0x12cd27(0x1e5)+_0x1522e6);let _0x38a2aa=0x0;_0x54203f[_0x12cd27(0x2a8)]((_0x194b87,_0xbe59bb)=>{const _0x4e08d6=_0x12cd27;_0x38a2aa+=_0x194b87['delay'];const _0x47c82b=setTimeout(async()=>{const _0x50883a=a40_0x6416;console[_0x50883a(0x1a7)]('ü™ô\x20[TIMER]\x20Individual\x20check\x20#'+(_0xbe59bb+0x1)+_0x50883a(0x281)+_0x1522e6+'\x20(after\x20'+_0x194b87[_0x50883a(0x1d7)]+')');try{await this['checkSinglePaymentById'](_0x1522e6),console['log'](_0x50883a(0x27b)+(_0xbe59bb+0x1)+_0x50883a(0x1fc)+_0x1522e6);}catch(_0x2c6a8b){console[_0x50883a(0x239)]('‚ùå\x20[TIMER]\x20Failed\x20individual\x20check\x20#'+(_0xbe59bb+0x1)+_0x50883a(0x1c5)+_0x1522e6+':',_0x2c6a8b),this['logCoinToPayError'](_0x1522e6,_0x399215,_0x2c6a8b,_0x50883a(0x255),{'checkNumber':_0xbe59bb+0x1,'scheduledAfter':_0x194b87[_0x50883a(0x1d7)],'isIndividualCheck':!![]});}},_0x38a2aa);_0x192c86[_0x4e08d6(0x230)](_0x47c82b),console[_0x4e08d6(0x1a7)](_0x4e08d6(0x222)+(_0xbe59bb+0x1)+'\x20for\x20payment\x20'+_0x1522e6+_0x4e08d6(0x220)+_0x38a2aa/0x3e8+'\x20seconds\x20('+_0x194b87[_0x4e08d6(0x1d7)]+')');});const _0x14a9ba=setInterval(async()=>{const _0x2dfaad=_0x12cd27;console[_0x2dfaad(0x1a7)]('ü™ô\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20'+_0x1522e6);try{const _0x11ca7a=await database_1['default']['payment'][_0x2dfaad(0x1be)]({'where':{'id':_0x1522e6},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x11ca7a){console[_0x2dfaad(0x1a7)](_0x2dfaad(0x261)+_0x1522e6+_0x2dfaad(0x232)),this['clearPaymentTimers'](_0x1522e6);return;}console['log'](_0x2dfaad(0x206)+_0x1522e6+_0x2dfaad(0x23d)+_0x11ca7a[_0x2dfaad(0x1cf)]);if(_0x11ca7a[_0x2dfaad(0x1cf)]!==_0x2dfaad(0x1ba)){console[_0x2dfaad(0x1a7)]('‚úÖ\x20[HOURLY]\x20Payment\x20'+_0x1522e6+_0x2dfaad(0x25b)+_0x11ca7a[_0x2dfaad(0x1cf)]+',\x20stopping\x20individual\x20checks'),this[_0x2dfaad(0x228)](_0x1522e6);return;}const _0x588f8a=Math['floor']((Date['now']()-_0x11ca7a[_0x2dfaad(0x262)][_0x2dfaad(0x1ad)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x588f8a>=this[_0x2dfaad(0x24a)]){console[_0x2dfaad(0x1a7)](_0x2dfaad(0x248)+_0x1522e6+_0x2dfaad(0x26f)+this[_0x2dfaad(0x24a)]+_0x2dfaad(0x226)),this['clearPaymentTimers'](_0x1522e6);return;}await this[_0x2dfaad(0x237)](_0x1522e6),console[_0x2dfaad(0x1a7)](_0x2dfaad(0x1b2)+_0x1522e6);}catch(_0x5e0e46){console['error']('‚ùå\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20'+_0x1522e6+':',_0x5e0e46),this[_0x2dfaad(0x238)](_0x1522e6,_0x399215,_0x5e0e46,'status_check',{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x192c86[_0x12cd27(0x230)](_0x14a9ba),this[_0x12cd27(0x29b)][_0x12cd27(0x207)](_0x1522e6,{'timers':_0x192c86,'paymentId':_0x1522e6,'gatewayPaymentId':_0x399215,'createdAt':_0x5ca664}),console[_0x12cd27(0x1a7)](_0x12cd27(0x21a)+_0x54203f['length']+_0x12cd27(0x27d)+_0x1522e6),console[_0x12cd27(0x1a7)](_0x12cd27(0x209)+this[_0x12cd27(0x29b)]['size']),this[_0x12cd27(0x288)](_0x1522e6,_0x399215,_0x12cd27(0x1ba),_0x12cd27(0x1ba),'status_check',{'action':_0x12cd27(0x21d),'scheduledChecks':_0x54203f[_0x12cd27(0x1d0)],'firstCheckIn':_0x54203f[0x0][_0x12cd27(0x1c0)]/0x3e8,'totalTimers':this[_0x12cd27(0x29b)][_0x12cd27(0x263)]});}[a40_0x1bb95c(0x228)](_0x3b892c){const _0x439879=a40_0x1bb95c,_0x2d81e9=this[_0x439879(0x29b)][_0x439879(0x295)](_0x3b892c);_0x2d81e9?(console[_0x439879(0x1a7)](_0x439879(0x1fb)+_0x2d81e9[_0x439879(0x1fd)]['length']+_0x439879(0x1c1)+_0x3b892c),_0x2d81e9[_0x439879(0x1fd)][_0x439879(0x2a8)]((_0x41aa5f,_0x53df0b)=>{const _0xc9ff38=_0x439879;_0x41aa5f&&(clearTimeout(_0x41aa5f),clearInterval(_0x41aa5f),console['log'](_0xc9ff38(0x271)+(_0x53df0b+0x1)+_0xc9ff38(0x1c5)+_0x3b892c));}),this[_0x439879(0x29b)][_0x439879(0x23e)](_0x3b892c),console[_0x439879(0x1a7)](_0x439879(0x1ab)+_0x3b892c+_0x439879(0x21e)+this[_0x439879(0x29b)][_0x439879(0x263)])):console['log'](_0x439879(0x249)+_0x3b892c+_0x439879(0x29f));}async[a40_0x1bb95c(0x237)](_0x43c6b4){const _0x34b89b=a40_0x1bb95c;console[_0x34b89b(0x1a7)](_0x34b89b(0x22e)+_0x43c6b4);const _0x2a85a5=await database_1[_0x34b89b(0x29a)][_0x34b89b(0x233)][_0x34b89b(0x1be)]({'where':{'id':_0x43c6b4},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x2a85a5){console['log'](_0x34b89b(0x20a)+_0x43c6b4+'\x20not\x20found\x20in\x20database');return;}console[_0x34b89b(0x1a7)](_0x34b89b(0x2ad)+_0x43c6b4+_0x34b89b(0x25c)),console[_0x34b89b(0x1a7)](_0x34b89b(0x229)+_0x2a85a5[_0x34b89b(0x2a2)]),console[_0x34b89b(0x1a7)](_0x34b89b(0x28c)+_0x2a85a5[_0x34b89b(0x1cf)]),console[_0x34b89b(0x1a7)]('\x20\x20\x20-\x20GatewayPaymentId:\x20'+_0x2a85a5[_0x34b89b(0x22b)]),console[_0x34b89b(0x1a7)](_0x34b89b(0x1c7)+_0x2a85a5['amount']+'\x20'+_0x2a85a5[_0x34b89b(0x282)]),console[_0x34b89b(0x1a7)]('\x20\x20\x20-\x20ShopId:\x20'+_0x2a85a5[_0x34b89b(0x27a)]);if(_0x2a85a5[_0x34b89b(0x2a2)]!==_0x34b89b(0x277)&&_0x2a85a5[_0x34b89b(0x2a2)]!=='cointopay2'){console['log'](_0x34b89b(0x267)+_0x43c6b4+_0x34b89b(0x1b0)+_0x2a85a5[_0x34b89b(0x2a2)]+')');return;}if(_0x2a85a5[_0x34b89b(0x1cf)]!=='PENDING'){console['log'](_0x34b89b(0x267)+_0x43c6b4+_0x34b89b(0x25b)+_0x2a85a5[_0x34b89b(0x1cf)]+_0x34b89b(0x1ac)),this['clearPaymentTimers'](_0x43c6b4);return;}if(!_0x2a85a5[_0x34b89b(0x22b)]){console[_0x34b89b(0x1a7)]('‚ö†Ô∏è\x20[CHECK]\x20Payment\x20'+_0x43c6b4+'\x20has\x20no\x20gatewayPaymentId');return;}console[_0x34b89b(0x1a7)](_0x34b89b(0x1b1)+_0x43c6b4+_0x34b89b(0x2a6)),await this[_0x34b89b(0x289)](_0x2a85a5);}['logCoinToPayStatus'](_0x5b7cf8,_0x27c408,_0x19b57d,_0x40d676,_0x1b08c5,_0x5f38d8){const _0x379039=a40_0x1bb95c,_0x5d3912={'type':'COINTOPAY_STATUS_CHANGE','paymentId':_0x5b7cf8,'gatewayPaymentId':_0x27c408,'oldStatus':_0x19b57d,'newStatus':_0x40d676,'source':_0x1b08c5,'timestamp':new Date()['toISOString'](),'details':_0x5f38d8||{}};loggerService_1['loggerService'][_0x379039(0x288)](_0x5d3912),console['log'](_0x379039(0x1a5)+_0x5b7cf8+'\x20('+_0x27c408+')'),console[_0x379039(0x1a7)](_0x379039(0x28a)+_0x19b57d+_0x379039(0x26b)+_0x40d676),console[_0x379039(0x1a7)](_0x379039(0x1f5)+_0x1b08c5),console[_0x379039(0x1a7)](_0x379039(0x2a0)+_0x5d3912[_0x379039(0x1ef)]),_0x5f38d8&&console[_0x379039(0x1a7)](_0x379039(0x29e),_0x5f38d8);}[a40_0x1bb95c(0x238)](_0x24a184,_0x11be7c,_0x4590ca,_0x379622,_0x2bc23d){const _0xb9c5d3=a40_0x1bb95c,_0xa1bcf2={'type':_0xb9c5d3(0x274),'paymentId':_0x24a184,'gatewayPaymentId':_0x11be7c,'error':_0x4590ca instanceof Error?{'message':_0x4590ca[_0xb9c5d3(0x247)],'stack':_0x4590ca['stack']}:_0x4590ca,'source':_0x379622,'timestamp':new Date()[_0xb9c5d3(0x296)](),'context':_0x2bc23d||{}};loggerService_1[_0xb9c5d3(0x21c)][_0xb9c5d3(0x238)](_0xa1bcf2),console[_0xb9c5d3(0x239)](_0xb9c5d3(0x205)+_0x24a184+'\x20('+_0x11be7c+')'),console['error'](_0xb9c5d3(0x264)+(_0x4590ca instanceof Error?_0x4590ca['message']:_0x4590ca)),console[_0xb9c5d3(0x239)](_0xb9c5d3(0x1f5)+_0x379622),console['error'](_0xb9c5d3(0x2a0)+_0xa1bcf2[_0xb9c5d3(0x1ef)]),_0x2bc23d&&console[_0xb9c5d3(0x239)](_0xb9c5d3(0x1b8),_0x2bc23d);}[a40_0x1bb95c(0x1e1)](){const _0x13e6e3=a40_0x1bb95c;console['log'](_0x13e6e3(0x297)),this[_0x13e6e3(0x292)]()['catch'](_0xb70c9c=>{const _0x4a5b58=_0x13e6e3;console[_0x4a5b58(0x239)](_0x4a5b58(0x1fe),_0xb70c9c);}),this[_0x13e6e3(0x23a)]=setInterval(async()=>{const _0x1bc5bc=_0x13e6e3;try{console['log'](_0x1bc5bc(0x1ff)),await this['checkAllPendingPayments'](),console['log']('‚úÖ\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed');}catch(_0x10feae){console[_0x1bc5bc(0x239)](_0x1bc5bc(0x250),_0x10feae);}},this[_0x13e6e3(0x27c)]),console[_0x13e6e3(0x1a7)](_0x13e6e3(0x26a));}[a40_0x1bb95c(0x287)](){const _0x33fc91=a40_0x1bb95c;console[_0x33fc91(0x1a7)](_0x33fc91(0x28b));this[_0x33fc91(0x23a)]&&(clearInterval(this[_0x33fc91(0x23a)]),this[_0x33fc91(0x23a)]=null,console['log'](_0x33fc91(0x1d6)));const _0x564f14=this['paymentTimers'][_0x33fc91(0x263)];for(const [_0x3cf08d]of this[_0x33fc91(0x29b)]){this[_0x33fc91(0x228)](_0x3cf08d);}console[_0x33fc91(0x1a7)](_0x33fc91(0x22f)+_0x564f14+_0x33fc91(0x23f));}async[a40_0x1bb95c(0x292)](){const _0x18a687=a40_0x1bb95c;try{console[_0x18a687(0x1a7)]('ü™ô\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...');const _0x7130c=await database_1[_0x18a687(0x29a)][_0x18a687(0x233)][_0x18a687(0x1d8)]({'where':{'gateway':{'in':[_0x18a687(0x277),_0x18a687(0x1ee)]},'status':'PENDING','gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console['log'](_0x18a687(0x293)+_0x7130c[_0x18a687(0x1d0)]+_0x18a687(0x290));if(_0x7130c[_0x18a687(0x1d0)]===0x0){console[_0x18a687(0x1a7)](_0x18a687(0x2a7));return;}const _0x5e570c=await this[_0x18a687(0x272)](_0x7130c);console[_0x18a687(0x1a7)](_0x18a687(0x265)+_0x5e570c['length']+_0x18a687(0x2a1));let _0x1b7301=0x0,_0x13e17f=0x0;for(const _0x3dc116 of _0x7130c){try{if(_0x5e570c[_0x18a687(0x23c)](_0x3dc116['id'])){console[_0x18a687(0x1a7)]('‚è∞\x20[GLOBAL]\x20Payment\x20'+_0x3dc116['id']+_0x18a687(0x28e)),_0x13e17f++;continue;}if(this[_0x18a687(0x29b)][_0x18a687(0x1a3)](_0x3dc116['id'])){console[_0x18a687(0x1a7)](_0x18a687(0x29c)+_0x3dc116['id']+_0x18a687(0x1b4)),_0x13e17f++;continue;}const _0x5c65da=(Date[_0x18a687(0x24b)]()-_0x3dc116[_0x18a687(0x262)]['getTime']())/(0x3e8*0x3c*0x3c);if(_0x5c65da<0x1){console[_0x18a687(0x1a7)](_0x18a687(0x29c)+_0x3dc116['id']+_0x18a687(0x25f)+_0x5c65da[_0x18a687(0x20c)](0x1)+_0x18a687(0x1a4)),_0x13e17f++;continue;}console['log'](_0x18a687(0x1dc)+_0x3dc116['id']+_0x18a687(0x210)+_0x5c65da[_0x18a687(0x20c)](0x1)+'h)'),await this[_0x18a687(0x289)](_0x3dc116),_0x1b7301++,await new Promise(_0x25c2c0=>setTimeout(_0x25c2c0,0x7d0));}catch(_0x19e224){console[_0x18a687(0x239)](_0x18a687(0x2a9)+_0x3dc116['id']+':',_0x19e224),this[_0x18a687(0x238)](_0x3dc116['id'],_0x3dc116[_0x18a687(0x22b)]||_0x18a687(0x1f4),_0x19e224,_0x18a687(0x255),{'isGlobalCheck':!![],'paymentAmount':_0x3dc116['amount'],'paymentCurrency':_0x3dc116[_0x18a687(0x282)],'shopId':_0x3dc116[_0x18a687(0x27a)],'createdAt':_0x3dc116[_0x18a687(0x262)]}),loggerService_1[_0x18a687(0x21c)][_0x18a687(0x218)](_0x18a687(0x277),'/status/'+_0x3dc116[_0x18a687(0x22b)],_0x19e224);}}console[_0x18a687(0x1a7)]('‚úÖ\x20[GLOBAL]\x20Global\x20check\x20completed:\x20'+_0x1b7301+_0x18a687(0x216)+_0x13e17f+_0x18a687(0x235)+_0x5e570c[_0x18a687(0x1d0)]+'\x20expired');}catch(_0x38ae36){console['error'](_0x18a687(0x219),_0x38ae36);}}async[a40_0x1bb95c(0x272)](_0x51b899){const _0x55be36=a40_0x1bb95c,_0x3ff198=[],_0x1b70a9=new Date();_0x1b70a9[_0x55be36(0x2a4)](_0x1b70a9[_0x55be36(0x246)]()-this[_0x55be36(0x24a)]),console[_0x55be36(0x1a7)]('‚è∞\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20'+this[_0x55be36(0x24a)]+_0x55be36(0x1dd)+_0x1b70a9[_0x55be36(0x296)]()+')');for(const _0x2d5e93 of _0x51b899){if(_0x2d5e93[_0x55be36(0x262)]<_0x1b70a9){console[_0x55be36(0x1a7)](_0x55be36(0x224)+_0x2d5e93['id']+_0x55be36(0x26f)+this[_0x55be36(0x24a)]+_0x55be36(0x1cd));try{this['logCoinToPayStatus'](_0x2d5e93['id'],_0x2d5e93[_0x55be36(0x22b)]||'unknown','PENDING','EXPIRED','auto_expire',{'reason':_0x55be36(0x2a5)+this[_0x55be36(0x24a)]+'\x20days','createdAt':_0x2d5e93[_0x55be36(0x262)],'daysSinceCreation':Math[_0x55be36(0x22c)]((Date[_0x55be36(0x24b)]()-_0x2d5e93[_0x55be36(0x262)][_0x55be36(0x1ad)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x2d5e93[_0x55be36(0x278)],'paymentCurrency':_0x2d5e93[_0x55be36(0x282)],'shopId':_0x2d5e93[_0x55be36(0x27a)]}),await database_1['default']['payment'][_0x55be36(0x1c3)]({'where':{'id':_0x2d5e93['id']},'data':{'status':'EXPIRED','updatedAt':new Date(),'adminNotes':_0x55be36(0x1bc)+this['EXPIRY_DAYS']+_0x55be36(0x25d)}}),await database_1[_0x55be36(0x29a)][_0x55be36(0x266)]['create']({'data':{'paymentId':_0x2d5e93['id'],'shopId':_0x2d5e93[_0x55be36(0x27a)],'event':'cointopay_auto_expired','statusCode':0xc8,'responseBody':JSON[_0x55be36(0x1ae)]({'reason':_0x55be36(0x2a5)+this['EXPIRY_DAYS']+_0x55be36(0x285),'createdAt':_0x2d5e93[_0x55be36(0x262)],'expiredAt':new Date()[_0x55be36(0x296)](),'daysSinceCreation':Math['floor']((Date['now']()-_0x2d5e93[_0x55be36(0x262)][_0x55be36(0x1ad)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this['sendShopWebhook'](_0x2d5e93,_0x55be36(0x2ab)),await this['sendPaymentStatusNotification'](_0x2d5e93,_0x55be36(0x2ab)),this[_0x55be36(0x228)](_0x2d5e93['id']),_0x3ff198[_0x55be36(0x230)](_0x2d5e93['id']),console['log']('‚úÖ\x20[EXPIRY]\x20Payment\x20'+_0x2d5e93['id']+'\x20marked\x20as\x20EXPIRED\x20due\x20to\x20'+this[_0x55be36(0x24a)]+'-day\x20timeout');}catch(_0x5a48ce){console[_0x55be36(0x239)](_0x55be36(0x298)+_0x2d5e93['id']+':',_0x5a48ce),this[_0x55be36(0x238)](_0x2d5e93['id'],_0x2d5e93['gatewayPaymentId']||_0x55be36(0x1f4),_0x5a48ce,'auto_expire',{'reason':_0x55be36(0x1b6),'createdAt':_0x2d5e93[_0x55be36(0x262)],'daysSinceCreation':Math[_0x55be36(0x22c)]((Date[_0x55be36(0x24b)]()-_0x2d5e93[_0x55be36(0x262)]['getTime']())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x3ff198;}async[a40_0x1bb95c(0x289)](_0x20bd04){const _0x51b6e6=a40_0x1bb95c;if(!_0x20bd04[_0x51b6e6(0x22b)]){console[_0x51b6e6(0x1a7)](_0x51b6e6(0x267)+_0x20bd04['id']+_0x51b6e6(0x25a));return;}console['log']('üîç\x20[CHECK]\x20Checking\x20'+_0x20bd04[_0x51b6e6(0x2a2)]+'\x20payment\x20'+_0x20bd04['id']+'\x20('+_0x20bd04[_0x51b6e6(0x22b)]+')');try{let _0x509e42;_0x20bd04[_0x51b6e6(0x2a2)]==='cointopay2'?(_0x509e42=await this[_0x51b6e6(0x1c6)][_0x51b6e6(0x1a1)](_0x20bd04[_0x51b6e6(0x22b)]),console[_0x51b6e6(0x1a7)]('üìä\x20[CHECK]\x20CoinToPay2\x20payment\x20'+_0x20bd04['id']+'\x20status:\x20'+_0x509e42['status'])):(_0x509e42=await this[_0x51b6e6(0x253)]['checkPaymentStatus'](_0x20bd04['gatewayPaymentId']),console[_0x51b6e6(0x1a7)](_0x51b6e6(0x1a0)+_0x20bd04['id']+'\x20status:\x20'+_0x509e42[_0x51b6e6(0x1cf)]));_0x509e42[_0x51b6e6(0x1f6)]&&console[_0x51b6e6(0x1a7)](_0x51b6e6(0x2ad)+_0x20bd04['id']+_0x51b6e6(0x201),{'iban':_0x509e42[_0x51b6e6(0x1f6)][_0x51b6e6(0x243)]||_0x51b6e6(0x27e),'transactionId':_0x509e42[_0x51b6e6(0x1f6)]['transactionId'],'createdOn':_0x509e42[_0x51b6e6(0x1f6)][_0x51b6e6(0x1f9)],'confirmedOn':_0x509e42[_0x51b6e6(0x1f6)][_0x51b6e6(0x1eb)]||_0x51b6e6(0x217)});if(_0x509e42[_0x51b6e6(0x1cf)]!==_0x20bd04[_0x51b6e6(0x1cf)]){console[_0x51b6e6(0x1a7)]('üîÑ\x20[CHECK]\x20Updating\x20payment\x20'+_0x20bd04['id']+'\x20status\x20from\x20'+_0x20bd04[_0x51b6e6(0x1cf)]+'\x20to\x20'+_0x509e42[_0x51b6e6(0x1cf)]),this[_0x51b6e6(0x288)](_0x20bd04['id'],_0x20bd04[_0x51b6e6(0x22b)],_0x20bd04[_0x51b6e6(0x1cf)],_0x509e42[_0x51b6e6(0x1cf)],'status_check',{'paymentDetails':_0x509e42[_0x51b6e6(0x1f6)],'amount':_0x509e42[_0x51b6e6(0x278)],'currency':_0x509e42[_0x51b6e6(0x282)],'shopId':_0x20bd04[_0x51b6e6(0x27a)],'checkTimestamp':new Date()[_0x51b6e6(0x296)]()});const _0x1f3493={'status':_0x509e42[_0x51b6e6(0x1cf)],'updatedAt':new Date()};if(_0x509e42[_0x51b6e6(0x1cf)]==='PAID'&&_0x20bd04[_0x51b6e6(0x1cf)]!==_0x51b6e6(0x1c9)){_0x1f3493['paidAt']=new Date();if(!_0x20bd04[_0x51b6e6(0x1e4)]){const _0x50b473=await currencyService_1['currencyService'][_0x51b6e6(0x286)](_0x20bd04[_0x51b6e6(0x278)],_0x20bd04[_0x51b6e6(0x282)]);_0x1f3493[_0x51b6e6(0x1e4)]=_0x50b473;const _0x2868b5=await this[_0x51b6e6(0x1ce)](_0x20bd04['shopId'],_0x20bd04[_0x51b6e6(0x2a2)]),_0x26c8ab=_0x50b473*(0x1-_0x2868b5/0x64);_0x1f3493[_0x51b6e6(0x24c)]=_0x26c8ab,_0x1f3493[_0x51b6e6(0x1b3)]=_0x2868b5,console[_0x51b6e6(0x1a7)](_0x51b6e6(0x20e)+_0x20bd04['id']+'\x20amounts\x20calculated:'),console[_0x51b6e6(0x1a7)]('\x20\x20\x20Amount:\x20'+_0x20bd04['amount']+'\x20'+_0x20bd04['currency']+_0x51b6e6(0x26b)+_0x50b473[_0x51b6e6(0x20c)](0x6)+_0x51b6e6(0x22d)),console[_0x51b6e6(0x1a7)]('\x20\x20\x20Gateway\x20'+_0x20bd04['gateway']+_0x51b6e6(0x1e7)+_0x2868b5+'%'),console[_0x51b6e6(0x1a7)](_0x51b6e6(0x1ed)+_0x26c8ab['toFixed'](0x6)+'\x20USDT');}console[_0x51b6e6(0x1a7)](_0x51b6e6(0x20e)+_0x20bd04['id']+'\x20marked\x20as\x20paid\x20at:\x20'+_0x1f3493['paidAt'][_0x51b6e6(0x296)]());}if(_0x509e42[_0x51b6e6(0x1f6)]){const _0x1f8cd2=_0x509e42[_0x51b6e6(0x1f6)];_0x1f8cd2[_0x51b6e6(0x243)]&&(_0x1f3493['remitterIban']=_0x1f8cd2['iban'],console[_0x51b6e6(0x1a7)]('üè¶\x20[CHECK]\x20Saved\x20IBAN:\x20'+_0x1f8cd2[_0x51b6e6(0x243)]));if(_0x1f8cd2[_0x51b6e6(0x259)]){const _0x3acdcd=_0x20bd04['adminNotes']||'',_0x22148c=_0x51b6e6(0x231)+_0x1f8cd2['bankDetails'];_0x1f3493[_0x51b6e6(0x1c2)]=_0x3acdcd?_0x3acdcd+'\x0a\x0a'+_0x22148c:_0x22148c,console[_0x51b6e6(0x1a7)](_0x51b6e6(0x223));}_0x1f8cd2[_0x51b6e6(0x1d4)]&&console[_0x51b6e6(0x1a7)]('üÜî\x20[CHECK]\x20Transaction\x20ID:\x20'+_0x1f8cd2['transactionId']),_0x1f8cd2[_0x51b6e6(0x1eb)]&&console[_0x51b6e6(0x1a7)]('‚úÖ\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20'+_0x1f8cd2[_0x51b6e6(0x1eb)]);}await database_1[_0x51b6e6(0x29a)][_0x51b6e6(0x233)][_0x51b6e6(0x1c3)]({'where':{'id':_0x20bd04['id']},'data':_0x1f3493});if(_0x509e42[_0x51b6e6(0x1cf)]===_0x51b6e6(0x1c9)&&_0x20bd04[_0x51b6e6(0x1cf)]!==_0x51b6e6(0x1c9)){console[_0x51b6e6(0x1a7)](_0x51b6e6(0x26e)+_0x20bd04['id']+_0x51b6e6(0x24f));const _0x2f12a7=await database_1[_0x51b6e6(0x29a)]['payment'][_0x51b6e6(0x1be)]({'where':{'id':_0x20bd04['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x2f12a7?.['paymentLinkId']&&_0x2f12a7['paymentLink'])try{const _0xc35a8b=_0x2f12a7[_0x51b6e6(0x20b)];console[_0x51b6e6(0x1a7)](_0x51b6e6(0x256)+_0xc35a8b['id']+':\x20type='+_0xc35a8b[_0x51b6e6(0x25e)]+_0x51b6e6(0x234)+_0xc35a8b[_0x51b6e6(0x227)]+_0x51b6e6(0x24d)+_0xc35a8b[_0x51b6e6(0x1cf)]);const _0x1c1be9=_0xc35a8b['currentPayments']+0x1,_0x3a14b0=_0xc35a8b[_0x51b6e6(0x25e)]==='SINGLE'?'COMPLETED':_0xc35a8b[_0x51b6e6(0x1cf)];await database_1[_0x51b6e6(0x29a)][_0x51b6e6(0x20b)][_0x51b6e6(0x1c3)]({'where':{'id':_0xc35a8b['id']},'data':{'currentPayments':_0x1c1be9,'status':_0x3a14b0,'updatedAt':new Date()}}),console[_0x51b6e6(0x1a7)](_0x51b6e6(0x213)+_0xc35a8b['id']+_0x51b6e6(0x1e2)+_0xc35a8b[_0x51b6e6(0x227)]+_0x51b6e6(0x26b)+_0x1c1be9+_0x51b6e6(0x24d)+_0xc35a8b[_0x51b6e6(0x1cf)]+_0x51b6e6(0x26b)+_0x3a14b0);}catch(_0x3e94f1){console[_0x51b6e6(0x239)](_0x51b6e6(0x1af),_0x3e94f1);}else console['log'](_0x51b6e6(0x26e)+_0x20bd04['id']+_0x51b6e6(0x1e8));}await database_1[_0x51b6e6(0x29a)]['webhookLog'][_0x51b6e6(0x245)]({'data':{'paymentId':_0x20bd04['id'],'shopId':_0x20bd04[_0x51b6e6(0x27a)],'event':_0x51b6e6(0x1a6)+_0x509e42['status'][_0x51b6e6(0x252)](),'statusCode':0xc8,'responseBody':JSON['stringify']({'oldStatus':_0x20bd04[_0x51b6e6(0x1cf)],'newStatus':_0x509e42[_0x51b6e6(0x1cf)],'paymentDetails':_0x509e42['paymentDetails'],'checkedAt':new Date()['toISOString']()})}}),await this[_0x51b6e6(0x1d9)](_0x20bd04,_0x509e42[_0x51b6e6(0x1cf)]),await this[_0x51b6e6(0x241)](_0x20bd04,_0x509e42['status']),_0x509e42[_0x51b6e6(0x1cf)]!=='PENDING'&&(console[_0x51b6e6(0x1a7)](_0x51b6e6(0x1c8)+_0x20bd04['id']+_0x51b6e6(0x1f7)+_0x509e42[_0x51b6e6(0x1cf)]+_0x51b6e6(0x1d3)),this[_0x51b6e6(0x228)](_0x20bd04['id'])),console[_0x51b6e6(0x1a7)]('‚úÖ\x20[CHECK]\x20Payment\x20'+_0x20bd04['id']+_0x51b6e6(0x1f0));}else console['log'](_0x51b6e6(0x2ad)+_0x20bd04['id']+_0x51b6e6(0x1fa)+_0x509e42[_0x51b6e6(0x1cf)]+')'),this[_0x51b6e6(0x288)](_0x20bd04['id'],_0x20bd04[_0x51b6e6(0x22b)],_0x20bd04[_0x51b6e6(0x1cf)],_0x509e42[_0x51b6e6(0x1cf)],_0x51b6e6(0x255),{'statusUnchanged':!![],'paymentDetails':_0x509e42[_0x51b6e6(0x1f6)],'amount':_0x509e42[_0x51b6e6(0x278)],'currency':_0x509e42[_0x51b6e6(0x282)],'shopId':_0x20bd04[_0x51b6e6(0x27a)],'checkTimestamp':new Date()[_0x51b6e6(0x296)]()});}catch(_0x473f7c){console[_0x51b6e6(0x239)](_0x51b6e6(0x214)+_0x20bd04['id']+':',_0x473f7c),this['logCoinToPayError'](_0x20bd04['id'],_0x20bd04['gatewayPaymentId'],_0x473f7c,_0x51b6e6(0x255),{'paymentAmount':_0x20bd04['amount'],'paymentCurrency':_0x20bd04[_0x51b6e6(0x282)],'shopId':_0x20bd04[_0x51b6e6(0x27a)],'createdAt':_0x20bd04['createdAt']}),await database_1[_0x51b6e6(0x29a)][_0x51b6e6(0x266)][_0x51b6e6(0x245)]({'data':{'paymentId':_0x20bd04['id'],'shopId':_0x20bd04[_0x51b6e6(0x27a)],'event':_0x51b6e6(0x2ac),'statusCode':0x1f4,'responseBody':JSON['stringify']({'error':_0x473f7c instanceof Error?_0x473f7c[_0x51b6e6(0x247)]:_0x51b6e6(0x211),'gatewayPaymentId':_0x20bd04[_0x51b6e6(0x22b)],'checkedAt':new Date()[_0x51b6e6(0x296)]()})}});}}async[a40_0x1bb95c(0x1d9)](_0x5249a8,_0x32d279){const _0x3de718=a40_0x1bb95c,_0x44bee4=Date[_0x3de718(0x24b)]();try{const _0x3ae817=_0x5249a8[_0x3de718(0x204)],_0x29b025=_0x3ae817[_0x3de718(0x1f2)];if(!_0x29b025?.[_0x3de718(0x1cb)]){console[_0x3de718(0x1a7)](_0x3de718(0x1bf)+_0x3ae817['id']);return;}const _0x31047f=_0x32d279===_0x3de718(0x1c9)?_0x3de718(0x1a8):_0x32d279===_0x3de718(0x208)?_0x3de718(0x29d):_0x32d279===_0x3de718(0x2ab)?_0x3de718(0x29d):'payment.pending';if(!_0x29b025[_0x3de718(0x1ea)]?.[_0x3de718(0x23c)](_0x31047f)){console[_0x3de718(0x1a7)](_0x3de718(0x1d1)+_0x31047f+_0x3de718(0x270)+_0x3ae817['id']);return;}const _0x3d0339=(0x0,gateway_1['getGatewayIdByName'])(_0x5249a8['gateway'])||_0x5249a8[_0x3de718(0x2a2)],_0x3c7286={'event':_0x31047f,'payment':{'id':_0x5249a8['id'],'order_id':_0x5249a8['orderId'],'gateway_order_id':_0x5249a8['gatewayOrderId'],'gateway':_0x3d0339,'amount':_0x5249a8[_0x3de718(0x278)],'currency':_0x5249a8['currency'],'status':_0x32d279[_0x3de718(0x252)](),'customer_email':_0x5249a8[_0x3de718(0x291)],'customer_name':_0x5249a8[_0x3de718(0x2aa)],'created_at':_0x5249a8['createdAt'],'updated_at':new Date()}},_0x32646b=await fetch(_0x29b025[_0x3de718(0x1cb)],{'method':_0x3de718(0x22a),'headers':{'Content-Type':'application/json','User-Agent':_0x3de718(0x212)},'body':JSON['stringify'](_0x3c7286)}),_0x4e5328=Date[_0x3de718(0x24b)]()-_0x44bee4,_0x4adfaf=_0x32646b['ok']?'Success':await _0x32646b['text']();loggerService_1[_0x3de718(0x21c)][_0x3de718(0x268)](_0x5249a8[_0x3de718(0x27a)],_0x29b025[_0x3de718(0x1cb)],_0x31047f,_0x32646b[_0x3de718(0x1cf)],_0x4e5328,_0x3c7286),console[_0x3de718(0x1a7)]('Shop\x20webhook\x20sent\x20to\x20'+_0x29b025[_0x3de718(0x1cb)]+'\x20with\x20status\x20'+_0x32646b['status']+'\x20('+_0x4e5328+'ms)');}catch(_0x555a59){console[_0x3de718(0x239)](_0x3de718(0x260),_0x555a59),loggerService_1[_0x3de718(0x21c)][_0x3de718(0x1f3)](_0x5249a8[_0x3de718(0x27a)],_0x5249a8[_0x3de718(0x204)]?.[_0x3de718(0x1f2)]?.[_0x3de718(0x1cb)]||_0x3de718(0x1f4),'webhook_send',_0x555a59,{});}}async[a40_0x1bb95c(0x241)](_0x24f9bb,_0x241361){const _0x1cc0ca=a40_0x1bb95c;try{const _0x122f78={'PENDING':_0x1cc0ca(0x1b9),'PAID':_0x1cc0ca(0x21f),'FAILED':_0x1cc0ca(0x202),'EXPIRED':'expired'},_0x27ddb9=_0x122f78[_0x241361];if(!_0x27ddb9||_0x27ddb9===_0x1cc0ca(0x1b9))return;await telegramBotService_1[_0x1cc0ca(0x1de)][_0x1cc0ca(0x24e)](_0x24f9bb[_0x1cc0ca(0x27a)],_0x24f9bb,_0x27ddb9);}catch(_0x358c2f){console['error'](_0x1cc0ca(0x1d2),_0x358c2f);}}async[a40_0x1bb95c(0x225)](_0x4c0086){const _0x2d0d22=a40_0x1bb95c;console[_0x2d0d22(0x1a7)](_0x2d0d22(0x294)+_0x4c0086);const _0x1253b9=await database_1['default'][_0x2d0d22(0x233)]['findUnique']({'where':{'id':_0x4c0086},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x1253b9)throw new Error(_0x2d0d22(0x1bd));if(_0x1253b9[_0x2d0d22(0x2a2)]!==_0x2d0d22(0x277)&&_0x1253b9[_0x2d0d22(0x2a2)]!==_0x2d0d22(0x1ee))throw new Error(_0x2d0d22(0x244));console['log'](_0x2d0d22(0x1ca)+_0x1253b9[_0x2d0d22(0x2a2)]+_0x2d0d22(0x258)+_0x4c0086),await this[_0x2d0d22(0x289)](_0x1253b9),console[_0x2d0d22(0x1a7)]('‚úÖ\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20'+_0x4c0086);}[a40_0x1bb95c(0x283)](){const _0x41394e=a40_0x1bb95c,_0x3b968e=this[_0x41394e(0x23a)]?this[_0x41394e(0x27c)]:undefined,_0x714492=Array[_0x41394e(0x28d)](this[_0x41394e(0x29b)][_0x41394e(0x240)]())[_0x41394e(0x1e6)](_0x2f51f0=>({'paymentId':_0x2f51f0[_0x41394e(0x28f)],'gatewayPaymentId':_0x2f51f0[_0x41394e(0x22b)],'createdAt':_0x2f51f0[_0x41394e(0x262)],'timersCount':_0x2f51f0[_0x41394e(0x1fd)]['length']}));return{'isActive':!!this[_0x41394e(0x23a)],'globalCheckIntervalMinutes':this[_0x41394e(0x27c)]/(0x3e8*0x3c),'expiryDays':this['EXPIRY_DAYS'],'activeIndividualTimers':this['paymentTimers'][_0x41394e(0x263)],'nextGlobalCheckIn':_0x3b968e,'paymentTimersDetails':_0x714492};}['getPaymentTimerInfo'](_0x1561e4){const _0x488564=a40_0x1bb95c,_0x428897=this[_0x488564(0x29b)][_0x488564(0x295)](_0x1561e4);if(_0x428897)return{'hasTimers':!![],'timersCount':_0x428897['timers'][_0x488564(0x1d0)],'createdAt':_0x428897[_0x488564(0x262)],'gatewayPaymentId':_0x428897[_0x488564(0x22b)]};return{'hasTimers':![]};}async['getGatewayCommission'](_0x309d8e,_0x2a88cb){const _0x381799=a40_0x1bb95c;try{const _0x18a1b6=await database_1[_0x381799(0x29a)][_0x381799(0x204)][_0x381799(0x1be)]({'where':{'id':_0x309d8e},'select':{'gatewaySettings':!![]}});if(!_0x18a1b6?.[_0x381799(0x1a9)])return console['log'](_0x381799(0x26c)+_0x309d8e+_0x381799(0x23b)),0xa;const _0xe21a5c=JSON[_0x381799(0x1e9)](_0x18a1b6['gatewaySettings']);for(const [_0x229c0e,_0x2dd8e1]of Object[_0x381799(0x221)](_0xe21a5c)){if(_0x229c0e['toLowerCase']()===_0x2a88cb[_0x381799(0x252)]()){const _0x226495=_0x2dd8e1[_0x381799(0x257)]||0xa;return console[_0x381799(0x1a7)](_0x381799(0x20d)+_0x2a88cb+_0x381799(0x1a2)+_0x309d8e+':\x20'+_0x226495+'%'),_0x226495;}}return console[_0x381799(0x1a7)](_0x381799(0x1b5)+_0x2a88cb+'\x20in\x20shop\x20'+_0x309d8e+',\x20using\x20default\x2010%'),0xa;}catch(_0x47ef69){return console[_0x381799(0x239)](_0x381799(0x200)+_0x309d8e+_0x381799(0x251)+_0x2a88cb+':',_0x47ef69),0xa;}}}exports[a40_0x1bb95c(0x299)]=CoinToPayStatusService,exports['coinToPayStatusService']=new CoinToPayStatusService();function a40_0x2c3d(){const _0x591982=['logShopWebhookError','unknown','\x20\x20\x20üìç\x20Source:\x20','paymentDetails','\x20status\x20changed\x20to\x20','2\x20minutes','createdOn','\x20status\x20unchanged\x20(','üßπ\x20[DEBUG]\x20Clearing\x20','\x20completed\x20for\x20payment\x20','timers','‚ùå\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','ü™ô\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','\x20details:','failed','\x20\x20\x20-\x20gatewayPaymentId:\x20','shop','ü™ô\x20[ERROR]\x20CoinToPay\x20Error:\x20','üìä\x20[HOURLY]\x20Payment\x20','set','FAILED','üìä\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','‚ùå\x20[CHECK]\x20Payment\x20','paymentLink','toFixed','Gateway\x20','üí∞\x20[CHECK]\x20Payment\x20','5\x20minutes','\x20(age:\x20','Unknown\x20error','Payment\x20System/1.0','‚úÖ\x20[COINTOPAY]\x20Payment\x20link\x20','‚ùå\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','2128OIdPyR','\x20checked,\x20','not\x20confirmed','logWhiteDomainError','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','‚úÖ\x20[DEBUG]\x20Successfully\x20scheduled\x20','1881790RJiJqU','loggerService','schedule_created','.\x20Remaining\x20active\x20timers:\x20','paid','\x20in\x20','entries','‚è∞\x20[DEBUG]\x20Scheduled\x20check\x20#','üè¶\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes','‚è∞\x20[EXPIRY]\x20Payment\x20','checkPaymentById','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','currentPayments','clearPaymentTimers','\x20\x20\x20-\x20Gateway:\x20','POST','gatewayPaymentId','floor','\x20USDT','üîç\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','üõë\x20[SHUTDOWN]\x20Cleared\x20','push','Bank\x20Details:\x20','\x20not\x20found,\x20clearing\x20timers','payment',',\x20currentPayments=','\x20skipped,\x20','./telegramBotService','checkSinglePaymentById','logCoinToPayError','error','globalCheckInterval',',\x20using\x20default\x20commission\x2010%','includes','\x20current\x20status:\x20','delete','\x20individual\x20payment\x20timers','values','sendPaymentStatusNotification','1\x20minute','iban','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','create','getDate','message','‚è∞\x20[HOURLY]\x20Payment\x20','‚ö†Ô∏è\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','EXPIRY_DAYS','now','amountAfterGatewayCommissionUSDT',',\x20status=','sendPaymentNotification','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','‚ùå\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:',',\x20gateway\x20','toLowerCase','coinToPayService','../config/database','status_check','üìà\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','commission','\x20payment\x20','bankDetails','\x20has\x20no\x20gatewayPaymentId,\x20skipping','\x20status\x20is\x20','\x20found:','\x20days\x20without\x20payment\x20confirmation','type','\x20is\x20too\x20new\x20(','Failed\x20to\x20send\x20shop\x20webhook:','‚ùå\x20[HOURLY]\x20Payment\x20','createdAt','size','\x20\x20\x20‚ùå\x20Error:\x20','‚è∞\x20[GLOBAL]\x20Found\x20','webhookLog','‚ö†Ô∏è\x20[CHECK]\x20Payment\x20','logShopWebhookSent','67XQGTqj','‚úÖ\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','\x20->\x20','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','15646iYCLLU','üìà\x20[COINTOPAY]\x20Payment\x20','\x20is\x20older\x20than\x20','\x20not\x20enabled\x20for\x20shop\x20','üßπ\x20[DEBUG]\x20Cleared\x20timer\x20#','checkExpiredPayments','schedulePaymentChecks','COINTOPAY_ERROR','ü™ô\x20[DEBUG]\x20Creating\x20','808511bOOSKX','cointopay','amount','__importDefault','shopId','‚úÖ\x20[TIMER]\x20Individual\x20check\x20#','GLOBAL_CHECK_INTERVAL_MS','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','not\x20found','__esModule','./currencyService','\x20triggered\x20for\x20payment\x20','currency','getServiceStats','CoinToPayService','\x20days','convertToUSDT','stopPeriodicStatusCheck','logCoinToPayStatus','checkSinglePayment','\x20\x20\x20üìä\x20Status:\x20','üõë\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','\x20\x20\x20-\x20Status:\x20','from','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','paymentId','\x20pending\x20CoinToPay\x20payments','customerEmail','checkAllPendingPayments','ü™ô\x20[GLOBAL]\x20Found\x20','üîç\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','get','toISOString','ü™ô\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','‚ùå\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','CoinToPayStatusService','default','paymentTimers','‚è∞\x20[GLOBAL]\x20Payment\x20','payment.failed','\x20\x20\x20üìù\x20Details:','\x20to\x20clear','\x20\x20\x20üìÖ\x20Time:\x20','\x20expired\x20CoinToPay\x20payments','gateway','14494110RSPhWx','setDate','Payment\x20older\x20than\x20','\x20is\x20valid\x20for\x20checking,\x20proceeding...','ü™ô\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','forEach','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','customerName','EXPIRED','cointopay_status_check_error','üìä\x20[CHECK]\x20Payment\x20','üìä\x20[CHECK]\x20CoinToPay\x20payment\x20','checkPaymentStatus','\x20commission\x20for\x20shop\x20','has','h),\x20skipping\x20global\x20check','ü™ô\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','cointopay_status_check_','log','payment.success','gatewaySettings','./gateways/coinToPayService','‚úÖ\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20',',\x20stopping\x20individual\x20checks','getTime','stringify','‚ùå\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','‚úÖ\x20[CHECK]\x20Payment\x20','‚úÖ\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','gatewayCommissionRate','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','No\x20specific\x20commission\x20found\x20for\x20gateway\x20','Failed\x20to\x20mark\x20payment\x20as\x20expired','\x20\x20\x20-\x20paymentId:\x20','\x20\x20\x20üìù\x20Context:','created','PENDING','ü™ô\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','Automatically\x20expired\x20after\x20','Payment\x20not\x20found','findUnique','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','delay','\x20timers\x20for\x20payment\x20','adminNotes','update','./loggerService','\x20for\x20payment\x20','coinToPay2Service','\x20\x20\x20-\x20Amount:\x20','üßπ\x20[CHECK]\x20Payment\x20','PAID','‚úÖ\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','webhookUrl','2918610jFogdN','\x20days,\x20marking\x20as\x20EXPIRED','getGatewayCommission','status','length','Webhook\x20event\x20','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:',',\x20clearing\x20individual\x20timers','transactionId','288dQJJej','üõë\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','description','findMany','sendShopWebhook','./gateways/coinToPay2Service','9VySzMI','üîç\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','\x20days\x20(created\x20before\x20','telegramBotService','25476gMNdyU','4SkIaQC','startPeriodicStatusCheck','\x20updated:\x20currentPayments=','../types/gateway','amountUSDT','\x20initial\x20timers\x20for\x20payment\x20','map','\x20commission:\x20','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','parse','webhookEvents','confirmedOn','coinToPayStatusService','\x20\x20\x20Amount\x20after\x20commission:\x20','cointopay2','timestamp','\x20updated\x20successfully','8619128EFcdvu','settings'];a40_0x2c3d=function(){return _0x591982;};return a40_0x2c3d();}