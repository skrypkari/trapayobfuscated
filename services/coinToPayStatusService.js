'use strict';const a42_0x2a5ca9=a42_0xb031;(function(_0x5640c5,_0x3f7f31){const _0x31bd4d=a42_0xb031,_0x1e1949=_0x5640c5();while(!![]){try{const _0x473279=parseInt(_0x31bd4d(0x153))/0x1*(-parseInt(_0x31bd4d(0x1c8))/0x2)+parseInt(_0x31bd4d(0x166))/0x3*(parseInt(_0x31bd4d(0x158))/0x4)+parseInt(_0x31bd4d(0x1df))/0x5+parseInt(_0x31bd4d(0x212))/0x6+parseInt(_0x31bd4d(0x219))/0x7*(-parseInt(_0x31bd4d(0x1e1))/0x8)+parseInt(_0x31bd4d(0x23b))/0x9+-parseInt(_0x31bd4d(0x211))/0xa;if(_0x473279===_0x3f7f31)break;else _0x1e1949['push'](_0x1e1949['shift']());}catch(_0x55fc04){_0x1e1949['push'](_0x1e1949['shift']());}}}(a42_0x14f6,0x7ca1e));var __importDefault=this&&this[a42_0x2a5ca9(0x15f)]||function(_0x5e787c){const _0x4d6a59=a42_0x2a5ca9;return _0x5e787c&&_0x5e787c[_0x4d6a59(0x1eb)]?_0x5e787c:{'default':_0x5e787c};};Object['defineProperty'](exports,a42_0x2a5ca9(0x1eb),{'value':!![]}),exports[a42_0x2a5ca9(0x1f7)]=exports[a42_0x2a5ca9(0x137)]=void 0x0;const coinToPayService_1=require(a42_0x2a5ca9(0x188)),coinToPay2Service_1=require(a42_0x2a5ca9(0x1e8)),gateway_1=require(a42_0x2a5ca9(0x240)),database_1=__importDefault(require(a42_0x2a5ca9(0x1da))),telegramBotService_1=require(a42_0x2a5ca9(0x1d7)),loggerService_1=require(a42_0x2a5ca9(0x214)),currencyService_1=require(a42_0x2a5ca9(0x208));function a42_0x14f6(){const _0x23b80f=['bankDetails','Webhook\x20event\x20','\x20expired','❌\x20[CHECK]\x20Payment\x20','\x20status:\x20','❌\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','coinToPay2Service','./telegramBotService','loggerService','\x20in\x20','../config/database','\x20is\x20valid\x20for\x20checking,\x20proceeding...','checkSinglePaymentById','Payment\x20older\x20than\x20','logWhiteDomainError','3939190oiuhcK','webhook_send','208UzfsKw',',\x20currentPayments=','\x20completed\x20for\x20payment\x20','\x20USDT',':\x20type=','schedulePaymentChecks','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','./gateways/coinToPay2Service','currency','startPeriodicStatusCheck','__esModule','gateway','payment.success','getGatewayCommission','🪙\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','getTime','\x20current\x20status:\x20','❌\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','\x20(after\x20','timestamp','\x20updated:\x20currentPayments=','delete','coinToPayStatusService','.\x20Remaining\x20active\x20timers:\x20','includes','COMPLETED','create','failed','now','shopId','getGatewayIdByName','checkSinglePayment','🪙\x20[DEBUG]\x20Creating\x20','🪙\x20[GLOBAL]\x20Found\x20','⚠️\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','✅\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','🔍\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','timers','map','./currencyService','logShopWebhookError','⏰\x20[GLOBAL]\x20Payment\x20','payment.failed','GLOBAL_CHECK_INTERVAL_MS','orderId','ms)','toISOString','findMany','6375150JlhEWL','3983106axrEkL','📊\x20[CHECK]\x20CoinToPay\x20payment\x20','./loggerService','status_check','update','💰\x20[CHECK]\x20Payment\x20','currentPayments','206689cXclpN','\x20has\x20no\x20gatewayPaymentId','Failed\x20to\x20send\x20shop\x20webhook:','type','📊\x20[CHECK]\x20CoinToPay2\x20payment\x20','status','\x20status\x20is\x20','auto_expire','Failed\x20to\x20mark\x20payment\x20as\x20expired','✅\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','\x20pending\x20CoinToPay\x20payments','⚠️\x20[CHECK]\x20Payment\x20','🪙\x20[ERROR]\x20CoinToPay\x20Error:\x20','\x20with\x20status\x20','\x20\x20\x20Gateway\x20','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','EXPIRED','\x20seconds\x20(','cointopay2','CoinToPayService','unknown','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','gatewayPaymentId','cointopay_auto_expired','✅\x20[CHECK]\x20Payment\x20','✅\x20[TIMER]\x20Individual\x20check\x20#','1\x20minute','not\x20confirmed','forEach','Payment\x20System/1.0','cointopay_status_check_error','Success','🧹\x20[CHECK]\x20Payment\x20','paid','5996682ihjdOu','✅\x20[DEBUG]\x20Successfully\x20scheduled\x20','logCoinToPayError','🛑\x20[SHUTDOWN]\x20Cleared\x20','2\x20minutes','../types/gateway','❌\x20[HOURLY]\x20Payment\x20','\x20\x20\x20📝\x20Details:','cointopay_status_check_','⏰\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','-day\x20timeout','CoinToPayStatusService','getDate','⏰\x20[GLOBAL]\x20Found\x20','❌\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','\x20->\x20','\x20payment\x20','\x20\x20\x20❌\x20Error:\x20','COINTOPAY_ERROR','values','has','stack','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','stopPeriodicStatusCheck','webhookUrl','\x20\x20\x20-\x20Status:\x20','\x20to\x20','🪙\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','\x20status\x20changed\x20to\x20','amountAfterGatewayCommissionUSDT','🔍\x20[CHECK]\x20Checking\x20','findUnique','\x20timers\x20for\x20payment\x20','FAILED',',\x20clearing\x20individual\x20timers','\x20found:','customerEmail','expired','📊\x20[HOURLY]\x20Payment\x20','499gwLxjq','default','\x20days',',\x20gateway\x20','\x20individual\x20payment\x20timers','63148GvCxAP','entries','logShopWebhookSent','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','confirmedOn','\x20days,\x20marking\x20as\x20EXPIRED','toLowerCase','__importDefault',',\x20status=','error','\x20\x20\x20📍\x20Source:\x20','globalCheckInterval',',\x20using\x20default\x2010%','EXPIRY_DAYS','3GSvSSK','⏰\x20[DEBUG]\x20Scheduled\x20check\x20#','\x20not\x20found,\x20clearing\x20timers','length','⏰\x20[EXPIRY]\x20Payment\x20','✅\x20[HOURLY]\x20Payment\x20','📈\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','\x20\x20\x20📝\x20Context:','❌\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','floor','message','amountUSDT','🆔\x20[CHECK]\x20Transaction\x20ID:\x20','sendShopWebhook','\x20\x20\x20Amount\x20after\x20commission:\x20','\x20status\x20unchanged\x20(','\x20skipped,\x20','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','/status/','\x20\x20\x20📊\x20Status:\x20','📊\x20[CHECK]\x20Payment\x20','iban','size','logCoinToPayStatus','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','❌\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','shop','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','PENDING','stringify','payment','\x20not\x20found\x20in\x20database','parse','5\x20minutes','./gateways/coinToPayService','\x20triggered\x20for\x20payment\x20','description','gatewaySettings','coinToPayService','sendPaymentNotification','\x20in\x20shop\x20','\x20\x20\x20-\x20ShopId:\x20','Gateway\x20','POST','remitterIban','payment.pending','transactionId','\x20is\x20older\x20than\x20','\x20to\x20clear','❌\x20[TIMER]\x20Failed\x20individual\x20check\x20#','sendPaymentStatusNotification','paymentDetails','Unknown\x20error','\x20expired\x20CoinToPay\x20payments',',\x20stopping\x20individual\x20checks','cointopay','🛑\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','❌\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','🧹\x20[DEBUG]\x20Clearing\x20','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','checkPaymentStatus','SINGLE','✅\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','\x20\x20\x20-\x20Gateway:\x20','push','\x20\x20\x20📅\x20Time:\x20','get','clearPaymentTimers','paymentLinkId','toFixed','\x20\x20\x20-\x20Amount:\x20','🔍\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','📈\x20[COINTOPAY]\x20Payment\x20','\x20\x20\x20-\x20GatewayPaymentId:\x20','set','log','🪙\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','createdAt','checkExpiredPayments','created','checkAllPendingPayments','customerName','webhookEvents','\x20not\x20enabled\x20for\x20shop\x20','🏦\x20[CHECK]\x20Bank\x20details\x20provided:\x20','🛑\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','schedule_created','No\x20specific\x20commission\x20found\x20for\x20gateway\x20','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','paymentLink','\x20\x20\x20Amount:\x20','telegramBotService','h),\x20skipping\x20global\x20check','✅\x20[EXPIRY]\x20Payment\x20','\x20\x20\x20-\x20gatewayPaymentId:\x20','paymentTimers','\x20for\x20payment\x20','\x20marked\x20as\x20paid\x20at:\x20','874gxHUBI','delay','✅\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','🪙\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','settings','checkPaymentById','amount','PAID'];a42_0x14f6=function(){return _0x23b80f;};return a42_0x14f6();}class CoinToPayStatusService{constructor(){const _0x3c920d=a42_0x2a5ca9;this[_0x3c920d(0x163)]=null,this[_0x3c920d(0x20c)]=0x3c*0x3c*0x3e8,this[_0x3c920d(0x165)]=0x5,this['paymentTimers']=new Map(),this[_0x3c920d(0x18c)]=new coinToPayService_1[(_0x3c920d(0x22c))](),this[_0x3c920d(0x1d6)]=new coinToPay2Service_1['CoinToPay2Service'](),console[_0x3c920d(0x1b1)]('🪙\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2');}[a42_0x2a5ca9(0x1e6)](_0x2a7f0a,_0x3b15d1){const _0x2f414c=a42_0x2a5ca9;console['log'](_0x2f414c(0x1ef)),console[_0x2f414c(0x1b1)]('\x20\x20\x20-\x20paymentId:\x20'+_0x2a7f0a),console[_0x2f414c(0x1b1)](_0x2f414c(0x1c4)+_0x3b15d1),this['clearPaymentTimers'](_0x2a7f0a);const _0x49a74d=[],_0x216281=new Date(),_0x4d8697=[{'delay':0x1*0x3c*0x3e8,'description':_0x2f414c(0x233)},{'delay':0x2*0x3c*0x3e8,'description':_0x2f414c(0x23f)},{'delay':0x5*0x3c*0x3e8,'description':_0x2f414c(0x187)},{'delay':0x5*0x3c*0x3e8,'description':_0x2f414c(0x187)}];console[_0x2f414c(0x1b1)](_0x2f414c(0x201)+_0x4d8697[_0x2f414c(0x169)]+'\x20initial\x20timers\x20for\x20payment\x20'+_0x2a7f0a);let _0xabd983=0x0;_0x4d8697[_0x2f414c(0x235)]((_0x2a0d30,_0x5be6ae)=>{const _0x2ca599=_0x2f414c;_0xabd983+=_0x2a0d30[_0x2ca599(0x1c9)];const _0x5a6314=setTimeout(async()=>{const _0x4ffc71=_0x2ca599;console['log']('🪙\x20[TIMER]\x20Individual\x20check\x20#'+(_0x5be6ae+0x1)+_0x4ffc71(0x189)+_0x2a7f0a+_0x4ffc71(0x1f3)+_0x2a0d30['description']+')');try{await this[_0x4ffc71(0x1dc)](_0x2a7f0a),console[_0x4ffc71(0x1b1)](_0x4ffc71(0x232)+(_0x5be6ae+0x1)+_0x4ffc71(0x1e3)+_0x2a7f0a);}catch(_0x8da467){console['error'](_0x4ffc71(0x197)+(_0x5be6ae+0x1)+_0x4ffc71(0x1c6)+_0x2a7f0a+':',_0x8da467),this[_0x4ffc71(0x23d)](_0x2a7f0a,_0x3b15d1,_0x8da467,_0x4ffc71(0x215),{'checkNumber':_0x5be6ae+0x1,'scheduledAfter':_0x2a0d30['description'],'isIndividualCheck':!![]});}},_0xabd983);_0x49a74d[_0x2ca599(0x1a6)](_0x5a6314),console[_0x2ca599(0x1b1)](_0x2ca599(0x167)+(_0x5be6ae+0x1)+'\x20for\x20payment\x20'+_0x2a7f0a+_0x2ca599(0x1d9)+_0xabd983/0x3e8+_0x2ca599(0x22a)+_0x2a0d30[_0x2ca599(0x18a)]+')');});const _0x295f53=setInterval(async()=>{const _0x1045c6=_0x2f414c;console[_0x1045c6(0x1b1)](_0x1045c6(0x1cb)+_0x2a7f0a);try{const _0x1e0d19=await database_1[_0x1045c6(0x154)][_0x1045c6(0x184)][_0x1045c6(0x14b)]({'where':{'id':_0x2a7f0a},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x1e0d19){console[_0x1045c6(0x1b1)](_0x1045c6(0x241)+_0x2a7f0a+_0x1045c6(0x168)),this[_0x1045c6(0x1a9)](_0x2a7f0a);return;}console[_0x1045c6(0x1b1)](_0x1045c6(0x152)+_0x2a7f0a+_0x1045c6(0x1f1)+_0x1e0d19[_0x1045c6(0x21e)]);if(_0x1e0d19[_0x1045c6(0x21e)]!==_0x1045c6(0x182)){console[_0x1045c6(0x1b1)](_0x1045c6(0x16b)+_0x2a7f0a+_0x1045c6(0x21f)+_0x1e0d19[_0x1045c6(0x21e)]+_0x1045c6(0x19c)),this[_0x1045c6(0x1a9)](_0x2a7f0a);return;}const _0x513181=Math['floor']((Date[_0x1045c6(0x1fd)]()-_0x1e0d19['createdAt']['getTime']())/(0x3e8*0x3c*0x3c*0x18));if(_0x513181>=this[_0x1045c6(0x165)]){console[_0x1045c6(0x1b1)]('⏰\x20[HOURLY]\x20Payment\x20'+_0x2a7f0a+_0x1045c6(0x195)+this['EXPIRY_DAYS']+_0x1045c6(0x228)),this['clearPaymentTimers'](_0x2a7f0a);return;}await this['checkSinglePaymentById'](_0x2a7f0a),console[_0x1045c6(0x1b1)]('✅\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20'+_0x2a7f0a);}catch(_0x8bc57b){console[_0x1045c6(0x161)]('❌\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20'+_0x2a7f0a+':',_0x8bc57b),this['logCoinToPayError'](_0x2a7f0a,_0x3b15d1,_0x8bc57b,_0x1045c6(0x215),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x49a74d[_0x2f414c(0x1a6)](_0x295f53),this['paymentTimers'][_0x2f414c(0x1b0)](_0x2a7f0a,{'timers':_0x49a74d,'paymentId':_0x2a7f0a,'gatewayPaymentId':_0x3b15d1,'createdAt':_0x216281}),console[_0x2f414c(0x1b1)](_0x2f414c(0x23c)+_0x4d8697[_0x2f414c(0x169)]+'\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20'+_0x2a7f0a),console['log']('📊\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20'+this[_0x2f414c(0x1c5)][_0x2f414c(0x17c)]),this['logCoinToPayStatus'](_0x2a7f0a,_0x3b15d1,_0x2f414c(0x182),_0x2f414c(0x182),_0x2f414c(0x215),{'action':_0x2f414c(0x1bc),'scheduledChecks':_0x4d8697[_0x2f414c(0x169)],'firstCheckIn':_0x4d8697[0x0][_0x2f414c(0x1c9)]/0x3e8,'totalTimers':this[_0x2f414c(0x1c5)][_0x2f414c(0x17c)]});}[a42_0x2a5ca9(0x1a9)](_0x2fb7d7){const _0x4d6d3c=a42_0x2a5ca9,_0x5a208b=this[_0x4d6d3c(0x1c5)][_0x4d6d3c(0x1a8)](_0x2fb7d7);_0x5a208b?(console[_0x4d6d3c(0x1b1)](_0x4d6d3c(0x1a0)+_0x5a208b['timers']['length']+_0x4d6d3c(0x14c)+_0x2fb7d7),_0x5a208b[_0x4d6d3c(0x206)][_0x4d6d3c(0x235)]((_0x56f042,_0x117feb)=>{const _0x255550=_0x4d6d3c;_0x56f042&&(clearTimeout(_0x56f042),clearInterval(_0x56f042),console[_0x255550(0x1b1)]('🧹\x20[DEBUG]\x20Cleared\x20timer\x20#'+(_0x117feb+0x1)+_0x255550(0x1c6)+_0x2fb7d7));}),this[_0x4d6d3c(0x1c5)][_0x4d6d3c(0x1f6)](_0x2fb7d7),console[_0x4d6d3c(0x1b1)](_0x4d6d3c(0x1ca)+_0x2fb7d7+_0x4d6d3c(0x1f8)+this[_0x4d6d3c(0x1c5)][_0x4d6d3c(0x17c)])):console[_0x4d6d3c(0x1b1)](_0x4d6d3c(0x203)+_0x2fb7d7+_0x4d6d3c(0x196));}async[a42_0x2a5ca9(0x1dc)](_0x27365d){const _0xb7c350=a42_0x2a5ca9;console[_0xb7c350(0x1b1)](_0xb7c350(0x1ad)+_0x27365d);const _0xe140b7=await database_1[_0xb7c350(0x154)]['payment'][_0xb7c350(0x14b)]({'where':{'id':_0x27365d},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0xe140b7){console['log'](_0xb7c350(0x1d3)+_0x27365d+_0xb7c350(0x185));return;}console['log'](_0xb7c350(0x17a)+_0x27365d+_0xb7c350(0x14f)),console['log'](_0xb7c350(0x1a5)+_0xe140b7[_0xb7c350(0x1ec)]),console[_0xb7c350(0x1b1)](_0xb7c350(0x145)+_0xe140b7[_0xb7c350(0x21e)]),console[_0xb7c350(0x1b1)](_0xb7c350(0x1af)+_0xe140b7[_0xb7c350(0x22f)]),console[_0xb7c350(0x1b1)](_0xb7c350(0x1ac)+_0xe140b7[_0xb7c350(0x1ce)]+'\x20'+_0xe140b7[_0xb7c350(0x1e9)]),console[_0xb7c350(0x1b1)](_0xb7c350(0x18f)+_0xe140b7[_0xb7c350(0x1fe)]);if(_0xe140b7[_0xb7c350(0x1ec)]!=='cointopay'&&_0xe140b7[_0xb7c350(0x1ec)]!==_0xb7c350(0x22b)){console[_0xb7c350(0x1b1)](_0xb7c350(0x224)+_0x27365d+'\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20'+_0xe140b7['gateway']+')');return;}if(_0xe140b7['status']!==_0xb7c350(0x182)){console[_0xb7c350(0x1b1)](_0xb7c350(0x224)+_0x27365d+'\x20status\x20is\x20'+_0xe140b7['status']+_0xb7c350(0x19c)),this[_0xb7c350(0x1a9)](_0x27365d);return;}if(!_0xe140b7[_0xb7c350(0x22f)]){console[_0xb7c350(0x1b1)](_0xb7c350(0x224)+_0x27365d+_0xb7c350(0x21a));return;}console['log'](_0xb7c350(0x231)+_0x27365d+_0xb7c350(0x1db)),await this['checkSinglePayment'](_0xe140b7);}[a42_0x2a5ca9(0x17d)](_0x435256,_0xeed5d2,_0x3339d5,_0x3be6dd,_0x111359,_0x66a22e){const _0x387107=a42_0x2a5ca9,_0x48bdb6={'type':'COINTOPAY_STATUS_CHANGE','paymentId':_0x435256,'gatewayPaymentId':_0xeed5d2,'oldStatus':_0x3339d5,'newStatus':_0x3be6dd,'source':_0x111359,'timestamp':new Date()[_0x387107(0x20f)](),'details':_0x66a22e||{}};loggerService_1[_0x387107(0x1d8)][_0x387107(0x17d)](_0x48bdb6),console[_0x387107(0x1b1)](_0x387107(0x147)+_0x435256+'\x20('+_0xeed5d2+')'),console['log'](_0x387107(0x179)+_0x3339d5+_0x387107(0x13b)+_0x3be6dd),console[_0x387107(0x1b1)](_0x387107(0x162)+_0x111359),console[_0x387107(0x1b1)](_0x387107(0x1a7)+_0x48bdb6['timestamp']),_0x66a22e&&console[_0x387107(0x1b1)](_0x387107(0x242),_0x66a22e);}[a42_0x2a5ca9(0x23d)](_0x5c3b7d,_0x193415,_0x3935e9,_0x32a1a4,_0x53616c){const _0x564908=a42_0x2a5ca9,_0x56dfc1={'type':_0x564908(0x13e),'paymentId':_0x5c3b7d,'gatewayPaymentId':_0x193415,'error':_0x3935e9 instanceof Error?{'message':_0x3935e9['message'],'stack':_0x3935e9[_0x564908(0x141)]}:_0x3935e9,'source':_0x32a1a4,'timestamp':new Date()[_0x564908(0x20f)](),'context':_0x53616c||{}};loggerService_1[_0x564908(0x1d8)][_0x564908(0x23d)](_0x56dfc1),console[_0x564908(0x161)](_0x564908(0x225)+_0x5c3b7d+'\x20('+_0x193415+')'),console[_0x564908(0x161)](_0x564908(0x13d)+(_0x3935e9 instanceof Error?_0x3935e9[_0x564908(0x170)]:_0x3935e9)),console[_0x564908(0x161)](_0x564908(0x162)+_0x32a1a4),console[_0x564908(0x161)](_0x564908(0x1a7)+_0x56dfc1[_0x564908(0x1f4)]),_0x53616c&&console[_0x564908(0x161)](_0x564908(0x16d),_0x53616c);}[a42_0x2a5ca9(0x1ea)](){const _0x54c814=a42_0x2a5ca9;console[_0x54c814(0x1b1)]('🪙\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)'),this['checkAllPendingPayments']()['catch'](_0x1d9bf7=>{const _0x5c7aab=_0x54c814;console[_0x5c7aab(0x161)](_0x5c7aab(0x1f2),_0x1d9bf7);}),this['globalCheckInterval']=setInterval(async()=>{const _0x5c5061=_0x54c814;try{console[_0x5c5061(0x1b1)]('🪙\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...'),await this[_0x5c5061(0x1b6)](),console['log']('✅\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed');}catch(_0x3fd882){console[_0x5c5061(0x161)](_0x5c5061(0x13a),_0x3fd882);}},this[_0x54c814(0x20c)]),console['log'](_0x54c814(0x222));}[a42_0x2a5ca9(0x143)](){const _0x10fcaa=a42_0x2a5ca9;console[_0x10fcaa(0x1b1)](_0x10fcaa(0x19e));this['globalCheckInterval']&&(clearInterval(this['globalCheckInterval']),this[_0x10fcaa(0x163)]=null,console[_0x10fcaa(0x1b1)](_0x10fcaa(0x1bb)));const _0x16ff59=this[_0x10fcaa(0x1c5)][_0x10fcaa(0x17c)];for(const [_0x1d91a6]of this[_0x10fcaa(0x1c5)]){this[_0x10fcaa(0x1a9)](_0x1d91a6);}console[_0x10fcaa(0x1b1)](_0x10fcaa(0x23e)+_0x16ff59+_0x10fcaa(0x157));}async[a42_0x2a5ca9(0x1b6)](){const _0x1d9332=a42_0x2a5ca9;try{console[_0x1d9332(0x1b1)](_0x1d9332(0x1b2));const _0x51787e=await database_1[_0x1d9332(0x154)][_0x1d9332(0x184)][_0x1d9332(0x210)]({'where':{'gateway':{'in':['cointopay',_0x1d9332(0x22b)]},'status':_0x1d9332(0x182),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x1d9332(0x1b1)](_0x1d9332(0x202)+_0x51787e[_0x1d9332(0x169)]+_0x1d9332(0x223));if(_0x51787e[_0x1d9332(0x169)]===0x0){console['log']('🪙\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check');return;}const _0x3bc671=await this['checkExpiredPayments'](_0x51787e);console[_0x1d9332(0x1b1)](_0x1d9332(0x139)+_0x3bc671[_0x1d9332(0x169)]+_0x1d9332(0x19b));let _0x471ec7=0x0,_0xee427=0x0;for(const _0x28f700 of _0x51787e){try{if(_0x3bc671[_0x1d9332(0x1f9)](_0x28f700['id'])){console[_0x1d9332(0x1b1)](_0x1d9332(0x20a)+_0x28f700['id']+_0x1d9332(0x142)),_0xee427++;continue;}if(this[_0x1d9332(0x1c5)][_0x1d9332(0x140)](_0x28f700['id'])){console['log'](_0x1d9332(0x20a)+_0x28f700['id']+_0x1d9332(0x1e7)),_0xee427++;continue;}const _0x572392=(Date[_0x1d9332(0x1fd)]()-_0x28f700[_0x1d9332(0x1b3)]['getTime']())/(0x3e8*0x3c*0x3c);if(_0x572392<0x1){console[_0x1d9332(0x1b1)]('⏰\x20[GLOBAL]\x20Payment\x20'+_0x28f700['id']+'\x20is\x20too\x20new\x20('+_0x572392[_0x1d9332(0x1ab)](0x1)+_0x1d9332(0x1c2)),_0xee427++;continue;}console[_0x1d9332(0x1b1)](_0x1d9332(0x205)+_0x28f700['id']+'\x20(age:\x20'+_0x572392['toFixed'](0x1)+'h)'),await this[_0x1d9332(0x200)](_0x28f700),_0x471ec7++,await new Promise(_0x5814a5=>setTimeout(_0x5814a5,0x7d0));}catch(_0x329da5){console[_0x1d9332(0x161)](_0x1d9332(0x17f)+_0x28f700['id']+':',_0x329da5),this['logCoinToPayError'](_0x28f700['id'],_0x28f700[_0x1d9332(0x22f)]||'unknown',_0x329da5,'status_check',{'isGlobalCheck':!![],'paymentAmount':_0x28f700[_0x1d9332(0x1ce)],'paymentCurrency':_0x28f700[_0x1d9332(0x1e9)],'shopId':_0x28f700['shopId'],'createdAt':_0x28f700[_0x1d9332(0x1b3)]}),loggerService_1['loggerService'][_0x1d9332(0x1de)](_0x1d9332(0x19d),_0x1d9332(0x178)+_0x28f700['gatewayPaymentId'],_0x329da5);}}console[_0x1d9332(0x1b1)](_0x1d9332(0x1a4)+_0x471ec7+'\x20checked,\x20'+_0xee427+_0x1d9332(0x176)+_0x3bc671[_0x1d9332(0x169)]+_0x1d9332(0x1d2));}catch(_0x49400d){console['error'](_0x1d9332(0x16e),_0x49400d);}}async[a42_0x2a5ca9(0x1b4)](_0x23f1ba){const _0x406156=a42_0x2a5ca9,_0x27bdd4=[],_0x4c98de=new Date();_0x4c98de['setDate'](_0x4c98de[_0x406156(0x138)]()-this[_0x406156(0x165)]),console['log'](_0x406156(0x135)+this['EXPIRY_DAYS']+'\x20days\x20(created\x20before\x20'+_0x4c98de[_0x406156(0x20f)]()+')');for(const _0x5c2178 of _0x23f1ba){if(_0x5c2178[_0x406156(0x1b3)]<_0x4c98de){console[_0x406156(0x1b1)](_0x406156(0x16a)+_0x5c2178['id']+_0x406156(0x195)+this['EXPIRY_DAYS']+_0x406156(0x15d));try{this[_0x406156(0x17d)](_0x5c2178['id'],_0x5c2178[_0x406156(0x22f)]||_0x406156(0x22d),_0x406156(0x182),_0x406156(0x229),_0x406156(0x220),{'reason':_0x406156(0x1dd)+this[_0x406156(0x165)]+_0x406156(0x155),'createdAt':_0x5c2178[_0x406156(0x1b3)],'daysSinceCreation':Math[_0x406156(0x16f)]((Date['now']()-_0x5c2178[_0x406156(0x1b3)][_0x406156(0x1f0)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x5c2178[_0x406156(0x1ce)],'paymentCurrency':_0x5c2178[_0x406156(0x1e9)],'shopId':_0x5c2178[_0x406156(0x1fe)]}),await database_1[_0x406156(0x154)][_0x406156(0x184)]['update']({'where':{'id':_0x5c2178['id']},'data':{'status':_0x406156(0x229),'updatedAt':new Date()}}),await database_1['default']['webhookLog'][_0x406156(0x1fb)]({'data':{'paymentId':_0x5c2178['id'],'shopId':_0x5c2178[_0x406156(0x1fe)],'event':_0x406156(0x230),'statusCode':0xc8,'responseBody':JSON[_0x406156(0x183)]({'reason':_0x406156(0x1dd)+this[_0x406156(0x165)]+_0x406156(0x155),'createdAt':_0x5c2178[_0x406156(0x1b3)],'expiredAt':new Date()[_0x406156(0x20f)](),'daysSinceCreation':Math['floor']((Date[_0x406156(0x1fd)]()-_0x5c2178[_0x406156(0x1b3)]['getTime']())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x406156(0x173)](_0x5c2178,_0x406156(0x229)),await this['sendPaymentStatusNotification'](_0x5c2178,_0x406156(0x229)),this[_0x406156(0x1a9)](_0x5c2178['id']),_0x27bdd4['push'](_0x5c2178['id']),console[_0x406156(0x1b1)](_0x406156(0x1c3)+_0x5c2178['id']+_0x406156(0x177)+this[_0x406156(0x165)]+_0x406156(0x136));}catch(_0xbc762d){console[_0x406156(0x161)]('❌\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20'+_0x5c2178['id']+':',_0xbc762d),this[_0x406156(0x23d)](_0x5c2178['id'],_0x5c2178[_0x406156(0x22f)]||_0x406156(0x22d),_0xbc762d,_0x406156(0x220),{'reason':_0x406156(0x221),'createdAt':_0x5c2178['createdAt'],'daysSinceCreation':Math['floor']((Date['now']()-_0x5c2178['createdAt']['getTime']())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x27bdd4;}async['checkSinglePayment'](_0xf30522){const _0x483442=a42_0x2a5ca9;if(!_0xf30522['gatewayPaymentId']){console[_0x483442(0x1b1)](_0x483442(0x224)+_0xf30522['id']+'\x20has\x20no\x20gatewayPaymentId,\x20skipping');return;}console[_0x483442(0x1b1)](_0x483442(0x14a)+_0xf30522[_0x483442(0x1ec)]+_0x483442(0x13c)+_0xf30522['id']+'\x20('+_0xf30522['gatewayPaymentId']+')');try{let _0x322816;_0xf30522['gateway']===_0x483442(0x22b)?(_0x322816=await this[_0x483442(0x1d6)]['checkPaymentStatus'](_0xf30522['gatewayPaymentId']),console[_0x483442(0x1b1)](_0x483442(0x21d)+_0xf30522['id']+_0x483442(0x1d4)+_0x322816[_0x483442(0x21e)])):(_0x322816=await this['coinToPayService'][_0x483442(0x1a2)](_0xf30522[_0x483442(0x22f)]),console[_0x483442(0x1b1)](_0x483442(0x213)+_0xf30522['id']+_0x483442(0x1d4)+_0x322816[_0x483442(0x21e)]));_0x322816[_0x483442(0x199)]&&console[_0x483442(0x1b1)]('📊\x20[CHECK]\x20Payment\x20'+_0xf30522['id']+'\x20details:',{'iban':_0x322816[_0x483442(0x199)]['iban']||'not\x20found','transactionId':_0x322816[_0x483442(0x199)][_0x483442(0x194)],'createdOn':_0x322816['paymentDetails']['createdOn'],'confirmedOn':_0x322816['paymentDetails'][_0x483442(0x15c)]||_0x483442(0x234)});if(_0x322816['status']!==_0xf30522['status']){console[_0x483442(0x1b1)]('🔄\x20[CHECK]\x20Updating\x20payment\x20'+_0xf30522['id']+'\x20status\x20from\x20'+_0xf30522['status']+_0x483442(0x146)+_0x322816[_0x483442(0x21e)]),this[_0x483442(0x17d)](_0xf30522['id'],_0xf30522[_0x483442(0x22f)],_0xf30522[_0x483442(0x21e)],_0x322816[_0x483442(0x21e)],_0x483442(0x215),{'paymentDetails':_0x322816[_0x483442(0x199)],'amount':_0x322816[_0x483442(0x1ce)],'currency':_0x322816['currency'],'shopId':_0xf30522[_0x483442(0x1fe)],'checkTimestamp':new Date()[_0x483442(0x20f)]()});const _0x2feb80={'status':_0x322816[_0x483442(0x21e)],'updatedAt':new Date()};if(_0x322816[_0x483442(0x21e)]===_0x483442(0x1cf)&&_0xf30522[_0x483442(0x21e)]!=='PAID'){_0x2feb80['paidAt']=new Date();if(!_0xf30522[_0x483442(0x171)]){const _0x5fe4b3=await currencyService_1['currencyService']['convertToUSDT'](_0xf30522[_0x483442(0x1ce)],_0xf30522[_0x483442(0x1e9)]);_0x2feb80['amountUSDT']=_0x5fe4b3;const _0x5738f9=await this[_0x483442(0x1ee)](_0xf30522[_0x483442(0x1fe)],_0xf30522[_0x483442(0x1ec)]),_0x597869=_0x5fe4b3*(0x1-_0x5738f9/0x64);_0x2feb80[_0x483442(0x149)]=_0x597869,_0x2feb80['gatewayCommissionRate']=_0x5738f9,console[_0x483442(0x1b1)](_0x483442(0x217)+_0xf30522['id']+'\x20amounts\x20calculated:'),console[_0x483442(0x1b1)](_0x483442(0x1c0)+_0xf30522['amount']+'\x20'+_0xf30522[_0x483442(0x1e9)]+_0x483442(0x13b)+_0x5fe4b3[_0x483442(0x1ab)](0x6)+_0x483442(0x1e4)),console[_0x483442(0x1b1)](_0x483442(0x227)+_0xf30522[_0x483442(0x1ec)]+'\x20commission:\x20'+_0x5738f9+'%'),console[_0x483442(0x1b1)](_0x483442(0x174)+_0x597869[_0x483442(0x1ab)](0x6)+'\x20USDT');}console[_0x483442(0x1b1)](_0x483442(0x217)+_0xf30522['id']+_0x483442(0x1c7)+_0x2feb80['paidAt'][_0x483442(0x20f)]());}if(_0x322816[_0x483442(0x199)]){const _0x399784=_0x322816[_0x483442(0x199)];_0x399784[_0x483442(0x17b)]&&(_0x2feb80[_0x483442(0x192)]=_0x399784[_0x483442(0x17b)],console[_0x483442(0x1b1)]('🏦\x20[CHECK]\x20Saved\x20IBAN:\x20'+_0x399784['iban'])),_0x399784[_0x483442(0x1d0)]&&console[_0x483442(0x1b1)](_0x483442(0x1ba)+_0x399784[_0x483442(0x1d0)]),_0x399784['transactionId']&&console[_0x483442(0x1b1)](_0x483442(0x172)+_0x399784[_0x483442(0x194)]),_0x399784[_0x483442(0x15c)]&&console[_0x483442(0x1b1)]('✅\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20'+_0x399784[_0x483442(0x15c)]);}await database_1['default'][_0x483442(0x184)][_0x483442(0x216)]({'where':{'id':_0xf30522['id']},'data':_0x2feb80});if(_0x322816[_0x483442(0x21e)]===_0x483442(0x1cf)&&_0xf30522[_0x483442(0x21e)]!==_0x483442(0x1cf)){console['log']('📈\x20[COINTOPAY]\x20Payment\x20'+_0xf30522['id']+_0x483442(0x1a1));const _0x4a9b9f=await database_1['default'][_0x483442(0x184)][_0x483442(0x14b)]({'where':{'id':_0xf30522['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x4a9b9f?.[_0x483442(0x1aa)]&&_0x4a9b9f[_0x483442(0x1bf)])try{const _0x2fa23b=_0x4a9b9f['paymentLink'];console[_0x483442(0x1b1)](_0x483442(0x16c)+_0x2fa23b['id']+_0x483442(0x1e5)+_0x2fa23b[_0x483442(0x21c)]+_0x483442(0x1e2)+_0x2fa23b['currentPayments']+',\x20status='+_0x2fa23b[_0x483442(0x21e)]);const _0x76002e=_0x2fa23b[_0x483442(0x218)]+0x1,_0x139410=_0x2fa23b[_0x483442(0x21c)]===_0x483442(0x1a3)?_0x483442(0x1fa):_0x2fa23b['status'];await database_1['default'][_0x483442(0x1bf)][_0x483442(0x216)]({'where':{'id':_0x2fa23b['id']},'data':{'currentPayments':_0x76002e,'status':_0x139410,'updatedAt':new Date()}}),console['log']('✅\x20[COINTOPAY]\x20Payment\x20link\x20'+_0x2fa23b['id']+_0x483442(0x1f5)+_0x2fa23b[_0x483442(0x218)]+_0x483442(0x13b)+_0x76002e+_0x483442(0x160)+_0x2fa23b[_0x483442(0x21e)]+_0x483442(0x13b)+_0x139410);}catch(_0x34986e){console[_0x483442(0x161)](_0x483442(0x19f),_0x34986e);}else console[_0x483442(0x1b1)](_0x483442(0x1ae)+_0xf30522['id']+_0x483442(0x15b));}await database_1['default']['webhookLog'][_0x483442(0x1fb)]({'data':{'paymentId':_0xf30522['id'],'shopId':_0xf30522[_0x483442(0x1fe)],'event':_0x483442(0x134)+_0x322816[_0x483442(0x21e)][_0x483442(0x15e)](),'statusCode':0xc8,'responseBody':JSON['stringify']({'oldStatus':_0xf30522['status'],'newStatus':_0x322816[_0x483442(0x21e)],'paymentDetails':_0x322816[_0x483442(0x199)],'checkedAt':new Date()[_0x483442(0x20f)]()})}}),await this[_0x483442(0x173)](_0xf30522,_0x322816[_0x483442(0x21e)]),await this[_0x483442(0x198)](_0xf30522,_0x322816[_0x483442(0x21e)]),_0x322816[_0x483442(0x21e)]!==_0x483442(0x182)&&(console[_0x483442(0x1b1)](_0x483442(0x239)+_0xf30522['id']+_0x483442(0x148)+_0x322816['status']+_0x483442(0x14e)),this[_0x483442(0x1a9)](_0xf30522['id'])),console[_0x483442(0x1b1)]('✅\x20[CHECK]\x20Payment\x20'+_0xf30522['id']+'\x20updated\x20successfully');}else console[_0x483442(0x1b1)](_0x483442(0x17a)+_0xf30522['id']+_0x483442(0x175)+_0x322816[_0x483442(0x21e)]+')'),this[_0x483442(0x17d)](_0xf30522['id'],_0xf30522[_0x483442(0x22f)],_0xf30522[_0x483442(0x21e)],_0x322816[_0x483442(0x21e)],_0x483442(0x215),{'statusUnchanged':!![],'paymentDetails':_0x322816[_0x483442(0x199)],'amount':_0x322816[_0x483442(0x1ce)],'currency':_0x322816[_0x483442(0x1e9)],'shopId':_0xf30522[_0x483442(0x1fe)],'checkTimestamp':new Date()[_0x483442(0x20f)]()});}catch(_0x4803ed){console[_0x483442(0x161)](_0x483442(0x1d5)+_0xf30522['id']+':',_0x4803ed),this['logCoinToPayError'](_0xf30522['id'],_0xf30522[_0x483442(0x22f)],_0x4803ed,_0x483442(0x215),{'paymentAmount':_0xf30522[_0x483442(0x1ce)],'paymentCurrency':_0xf30522['currency'],'shopId':_0xf30522[_0x483442(0x1fe)],'createdAt':_0xf30522[_0x483442(0x1b3)]}),await database_1[_0x483442(0x154)]['webhookLog'][_0x483442(0x1fb)]({'data':{'paymentId':_0xf30522['id'],'shopId':_0xf30522['shopId'],'event':_0x483442(0x237),'statusCode':0x1f4,'responseBody':JSON[_0x483442(0x183)]({'error':_0x4803ed instanceof Error?_0x4803ed[_0x483442(0x170)]:_0x483442(0x19a),'gatewayPaymentId':_0xf30522[_0x483442(0x22f)],'checkedAt':new Date()['toISOString']()})}});}}async[a42_0x2a5ca9(0x173)](_0x707031,_0xa6c658){const _0x5434fa=a42_0x2a5ca9,_0x26596b=Date[_0x5434fa(0x1fd)]();try{const _0x157cff=_0x707031['shop'],_0x2893f8=_0x157cff[_0x5434fa(0x1cc)];if(!_0x2893f8?.[_0x5434fa(0x144)]){console[_0x5434fa(0x1b1)](_0x5434fa(0x1be)+_0x157cff['id']);return;}const _0x2c9bcf=_0xa6c658===_0x5434fa(0x1cf)?_0x5434fa(0x1ed):_0xa6c658===_0x5434fa(0x14d)?_0x5434fa(0x20b):_0xa6c658===_0x5434fa(0x229)?_0x5434fa(0x20b):_0x5434fa(0x193);if(!_0x2893f8[_0x5434fa(0x1b8)]?.['includes'](_0x2c9bcf)){console[_0x5434fa(0x1b1)](_0x5434fa(0x1d1)+_0x2c9bcf+_0x5434fa(0x1b9)+_0x157cff['id']);return;}const _0x332d03=(0x0,gateway_1[_0x5434fa(0x1ff)])(_0x707031['gateway'])||_0x707031[_0x5434fa(0x1ec)],_0x2e65f1={'event':_0x2c9bcf,'payment':{'id':_0x707031['id'],'order_id':_0x707031[_0x5434fa(0x20d)],'gateway_order_id':_0x707031['gatewayOrderId'],'gateway':_0x332d03,'amount':_0x707031[_0x5434fa(0x1ce)],'currency':_0x707031[_0x5434fa(0x1e9)],'status':_0xa6c658[_0x5434fa(0x15e)](),'customer_email':_0x707031[_0x5434fa(0x150)],'customer_name':_0x707031[_0x5434fa(0x1b7)],'created_at':_0x707031[_0x5434fa(0x1b3)],'updated_at':new Date()}},_0x4e0af4=await fetch(_0x2893f8[_0x5434fa(0x144)],{'method':_0x5434fa(0x191),'headers':{'Content-Type':'application/json','User-Agent':_0x5434fa(0x236)},'body':JSON[_0x5434fa(0x183)](_0x2e65f1)}),_0x4e78ce=Date['now']()-_0x26596b,_0x1c2ce5=_0x4e0af4['ok']?_0x5434fa(0x238):await _0x4e0af4['text']();loggerService_1[_0x5434fa(0x1d8)][_0x5434fa(0x15a)](_0x707031['shopId'],_0x2893f8[_0x5434fa(0x144)],_0x2c9bcf,_0x4e0af4[_0x5434fa(0x21e)],_0x4e78ce,_0x2e65f1),console[_0x5434fa(0x1b1)]('Shop\x20webhook\x20sent\x20to\x20'+_0x2893f8['webhookUrl']+_0x5434fa(0x226)+_0x4e0af4['status']+'\x20('+_0x4e78ce+_0x5434fa(0x20e));}catch(_0x431a78){console['error'](_0x5434fa(0x21b),_0x431a78),loggerService_1[_0x5434fa(0x1d8)][_0x5434fa(0x209)](_0x707031[_0x5434fa(0x1fe)],_0x707031[_0x5434fa(0x180)]?.[_0x5434fa(0x1cc)]?.[_0x5434fa(0x144)]||_0x5434fa(0x22d),_0x5434fa(0x1e0),_0x431a78,{});}}async[a42_0x2a5ca9(0x198)](_0x52661e,_0x730ef0){const _0x535172=a42_0x2a5ca9;try{const _0x44adb2={'PENDING':_0x535172(0x1b5),'PAID':_0x535172(0x23a),'FAILED':_0x535172(0x1fc),'EXPIRED':_0x535172(0x151)},_0x4c1359=_0x44adb2[_0x730ef0];if(!_0x4c1359||_0x4c1359==='created')return;await telegramBotService_1[_0x535172(0x1c1)][_0x535172(0x18d)](_0x52661e[_0x535172(0x1fe)],_0x52661e,_0x4c1359);}catch(_0x4400d1){console['error']('Failed\x20to\x20send\x20Telegram\x20payment\x20notification:',_0x4400d1);}}async[a42_0x2a5ca9(0x1cd)](_0x3771c6){const _0x10326b=a42_0x2a5ca9;console[_0x10326b(0x1b1)]('🔍\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20'+_0x3771c6);const _0x441ba8=await database_1[_0x10326b(0x154)][_0x10326b(0x184)][_0x10326b(0x14b)]({'where':{'id':_0x3771c6},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x441ba8)throw new Error('Payment\x20not\x20found');if(_0x441ba8['gateway']!==_0x10326b(0x19d)&&_0x441ba8[_0x10326b(0x1ec)]!==_0x10326b(0x22b))throw new Error(_0x10326b(0x22e));console[_0x10326b(0x1b1)]('✅\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20'+_0x441ba8[_0x10326b(0x1ec)]+_0x10326b(0x13c)+_0x3771c6),await this[_0x10326b(0x200)](_0x441ba8),console[_0x10326b(0x1b1)](_0x10326b(0x204)+_0x3771c6);}['getServiceStats'](){const _0x1e2eb9=a42_0x2a5ca9,_0x52b8d5=this[_0x1e2eb9(0x163)]?this['GLOBAL_CHECK_INTERVAL_MS']:undefined,_0x1f5f70=Array['from'](this[_0x1e2eb9(0x1c5)][_0x1e2eb9(0x13f)]())[_0x1e2eb9(0x207)](_0x442524=>({'paymentId':_0x442524['paymentId'],'gatewayPaymentId':_0x442524[_0x1e2eb9(0x22f)],'createdAt':_0x442524['createdAt'],'timersCount':_0x442524[_0x1e2eb9(0x206)][_0x1e2eb9(0x169)]}));return{'isActive':!!this['globalCheckInterval'],'globalCheckIntervalMinutes':this[_0x1e2eb9(0x20c)]/(0x3e8*0x3c),'expiryDays':this[_0x1e2eb9(0x165)],'activeIndividualTimers':this['paymentTimers'][_0x1e2eb9(0x17c)],'nextGlobalCheckIn':_0x52b8d5,'paymentTimersDetails':_0x1f5f70};}['getPaymentTimerInfo'](_0x2f4722){const _0x1a5ddc=a42_0x2a5ca9,_0x370cb9=this[_0x1a5ddc(0x1c5)][_0x1a5ddc(0x1a8)](_0x2f4722);if(_0x370cb9)return{'hasTimers':!![],'timersCount':_0x370cb9['timers']['length'],'createdAt':_0x370cb9['createdAt'],'gatewayPaymentId':_0x370cb9['gatewayPaymentId']};return{'hasTimers':![]};}async[a42_0x2a5ca9(0x1ee)](_0x1d8df5,_0x50e6d1){const _0x203018=a42_0x2a5ca9;try{const _0x395d52=await database_1[_0x203018(0x154)][_0x203018(0x180)][_0x203018(0x14b)]({'where':{'id':_0x1d8df5},'select':{'gatewaySettings':!![]}});if(!_0x395d52?.[_0x203018(0x18b)])return console[_0x203018(0x1b1)](_0x203018(0x181)+_0x1d8df5+',\x20using\x20default\x20commission\x2010%'),0xa;const _0x8b9d01=JSON[_0x203018(0x186)](_0x395d52['gatewaySettings']);for(const [_0x134a34,_0x319fdb]of Object[_0x203018(0x159)](_0x8b9d01)){if(_0x134a34[_0x203018(0x15e)]()===_0x50e6d1[_0x203018(0x15e)]()){const _0x167297=_0x319fdb['commission']||0xa;return console[_0x203018(0x1b1)](_0x203018(0x190)+_0x50e6d1+'\x20commission\x20for\x20shop\x20'+_0x1d8df5+':\x20'+_0x167297+'%'),_0x167297;}}return console['log'](_0x203018(0x1bd)+_0x50e6d1+_0x203018(0x18e)+_0x1d8df5+_0x203018(0x164)),0xa;}catch(_0x4fdb6c){return console['error'](_0x203018(0x17e)+_0x1d8df5+_0x203018(0x156)+_0x50e6d1+':',_0x4fdb6c),0xa;}}}function a42_0xb031(_0x47fc32,_0x162cd7){const _0x14f6a4=a42_0x14f6();return a42_0xb031=function(_0xb031b3,_0x3b97b8){_0xb031b3=_0xb031b3-0x134;let _0x240982=_0x14f6a4[_0xb031b3];return _0x240982;},a42_0xb031(_0x47fc32,_0x162cd7);}exports[a42_0x2a5ca9(0x137)]=CoinToPayStatusService,exports[a42_0x2a5ca9(0x1f7)]=new CoinToPayStatusService();