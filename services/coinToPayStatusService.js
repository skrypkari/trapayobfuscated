'use strict';const a48_0x1e2af2=a48_0x389b;(function(_0x24bb18,_0x5ca44b){const _0x5f1d70=a48_0x389b,_0x4f615c=_0x24bb18();while(!![]){try{const _0x200da9=parseInt(_0x5f1d70(0x174))/0x1*(parseInt(_0x5f1d70(0xfb))/0x2)+-parseInt(_0x5f1d70(0xa6))/0x3*(parseInt(_0x5f1d70(0xac))/0x4)+-parseInt(_0x5f1d70(0x125))/0x5+parseInt(_0x5f1d70(0xc3))/0x6*(parseInt(_0x5f1d70(0x178))/0x7)+-parseInt(_0x5f1d70(0x11b))/0x8+parseInt(_0x5f1d70(0xfa))/0x9*(-parseInt(_0x5f1d70(0x94))/0xa)+parseInt(_0x5f1d70(0x161))/0xb;if(_0x200da9===_0x5ca44b)break;else _0x4f615c['push'](_0x4f615c['shift']());}catch(_0x3f2ed9){_0x4f615c['push'](_0x4f615c['shift']());}}}(a48_0x2dc6,0x5b492));function a48_0x2dc6(){const _0x5b8335=['update','\x20is\x20valid\x20for\x20checking,\x20proceeding...','clearPaymentTimers','logShopWebhookSent','/status/','ü™ô\x20[TIMER]\x20Individual\x20check\x20#','üîç\x20[CHECK]\x20Checking\x20','iban','cointopay','error','convertToUSDT','EXPIRY_DAYS','338288TwhqEB','‚è∞\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','‚ùå\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','__esModule','findUnique','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','\x20timers\x20for\x20payment\x20','üÜî\x20[CHECK]\x20Transaction\x20ID:\x20','COINTOPAY_STATUS_CHANGE','paidAt','1756670KoEjdW','webhookUrl','not\x20found','üìä\x20[HOURLY]\x20Payment\x20',':\x20type=',',\x20using\x20default\x20commission\x2010%','__importDefault','\x20days,\x20marking\x20as\x20EXPIRED','GLOBAL_CHECK_INTERVAL_MS','\x20\x20\x20üìù\x20Details:','paymentDetails','paymentId','getDate','\x20pending\x20CoinToPay\x20payments','\x20status\x20changed\x20to\x20','transactionId','stringify','‚úÖ\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','payment.failed','ü™ô\x20[ERROR]\x20CoinToPay\x20Error:\x20','push','\x20triggered\x20for\x20payment\x20','ü™ô\x20[GLOBAL]\x20Found\x20','FAILED','\x20\x20\x20-\x20gatewayPaymentId:\x20','floor',',\x20status=','gatewayPaymentId','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','‚ùå\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','cointopay_status_check_','currency','createdOn','üí∞\x20[CHECK]\x20Payment\x20','SINGLE','orderId','PENDING','Failed\x20to\x20mark\x20payment\x20as\x20expired','\x20\x20\x20-\x20paymentId:\x20','status_check','üßπ\x20[CHECK]\x20Payment\x20','\x20\x20\x20-\x20Amount:\x20','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','now','‚è∞\x20[GLOBAL]\x20Payment\x20','üîç\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','üõë\x20[SHUTDOWN]\x20Cleared\x20','\x20has\x20no\x20gatewayPaymentId,\x20skipping','./loggerService','\x20\x20\x20-\x20ShopId:\x20','checkAllPendingPayments','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','Failed\x20to\x20send\x20shop\x20webhook:','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','paymentLinkId','payment.success','üßπ\x20[DEBUG]\x20Cleared\x20timer\x20#','customerName','log','./gateways/coinToPayService','615912fhfEOC','toFixed','./telegramBotService','paymentLink','\x20current\x20status:\x20','ü™ô\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','amount','application/json','coinToPay2Service','logCoinToPayStatus','webhook_send','Gateway\x20','‚ö†Ô∏è\x20[CHECK]\x20Payment\x20','startPeriodicStatusCheck','üìä\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','findMany','gateway','6kkXWsk','‚è∞\x20[EXPIRY]\x20Payment\x20','üè¶\x20[CHECK]\x20Bank\x20details\x20provided:\x20','‚úÖ\x20[DEBUG]\x20Successfully\x20scheduled\x20','435911opMeGz','sendPaymentStatusNotification','currencyService','created','timers',',\x20stopping\x20individual\x20checks','\x20\x20\x20üìÖ\x20Time:\x20','üè¶\x20[CHECK]\x20Saved\x20IBAN:\x20','cointopay_status_check_error','not\x20confirmed','map','ü™ô\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','catch','getPaymentTimerInfo','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','‚úÖ\x20[TIMER]\x20Individual\x20check\x20#','from','\x20\x20\x20Amount:\x20','timestamp','default','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','auto_expire','\x20expired\x20CoinToPay\x20payments','\x20to\x20clear','checkSinglePayment','\x20individual\x20payment\x20timers','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','üìä\x20[CHECK]\x20Payment\x20','\x20commission\x20for\x20shop\x20','checkSinglePaymentById','coinToPayStatusService','setDate','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','\x20found:','unknown','\x20\x20\x20üìç\x20Source:\x20','üìä\x20[CHECK]\x20CoinToPay2\x20payment\x20','telegramBotService','\x20\x20\x20Gateway\x20','5\x20minutes','\x20days\x20(created\x20before\x20','getTime','webhookLog','\x20details:','gatewayOrderId','‚ùå\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','10AIFchy','‚ùå\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','\x20commission:\x20','\x20checked,\x20','POST','\x20is\x20older\x20than\x20','size','amountAfterGatewayCommissionUSDT','status','toLowerCase','‚ùå\x20[TIMER]\x20Failed\x20individual\x20check\x20#','logCoinToPayError','checkPaymentById','‚è∞\x20[GLOBAL]\x20Found\x20','\x20not\x20enabled\x20for\x20shop\x20','COMPLETED','shop','bankDetails','63ncROUb','toISOString','\x20completed\x20for\x20payment\x20',',\x20clearing\x20individual\x20timers','.\x20Remaining\x20active\x20timers:\x20','‚úÖ\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','80564SiEIsJ','CoinToPayStatusService','cointopay_auto_expired','getGatewayCommission','\x20days','./gateways/coinToPay2Service','EXPIRED','\x20\x20\x20-\x20GatewayPaymentId:\x20','‚úÖ\x20[CHECK]\x20Payment\x20','‚úÖ\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','\x20not\x20found\x20in\x20database','‚è∞\x20[DEBUG]\x20Scheduled\x20check\x20#','description','ü™ô\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','\x20updated\x20successfully','Unknown\x20error','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','\x20\x20\x20-\x20Gateway:\x20','length','settings','loggerService','‚ùå\x20[HOURLY]\x20Payment\x20','1\x20minute','66qkCQYQ','get','\x20USDT','\x20(after\x20',',\x20currentPayments=','\x20\x20\x20üìù\x20Context:','\x20status:\x20','forEach','../types/gateway','ü™ô\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','create','amountUSDT','üõë\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','üìà\x20[COINTOPAY]\x20Payment\x20','\x20(age:\x20','commission','sendShopWebhook','-day\x20timeout','message','Success','ms)','type','\x20status\x20is\x20','confirmedOn',',\x20using\x20default\x2010%','stopPeriodicStatusCheck','\x20initial\x20timers\x20for\x20payment\x20','entries','getServiceStats','\x20->\x20','delete','includes','expired','Payment\x20older\x20than\x20','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','globalCheckInterval','cointopay2','üìà\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','\x20\x20\x20-\x20Status:\x20','ü™ô\x20[DEBUG]\x20Creating\x20','remitterIban','\x20for\x20payment\x20','parse','PAID','createdAt','Payment\x20not\x20found','../config/database','schedulePaymentChecks','checkPaymentStatus','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','currentPayments','schedule_created','failed','\x20in\x20','\x20marked\x20as\x20paid\x20at:\x20','101826YueWFi','153602klhMpe','ü™ô\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','customerEmail','\x20expired','has','‚ùå\x20[CHECK]\x20Payment\x20','\x20\x20\x20üìä\x20Status:\x20','checkExpiredPayments','gatewaySettings','üîç\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','set','logWhiteDomainError','paymentTimers','\x20\x20\x20‚ùå\x20Error:\x20','coinToPayService','shopId','payment','\x20with\x20status\x20','‚úÖ\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','\x20payment\x20'];a48_0x2dc6=function(){return _0x5b8335;};return a48_0x2dc6();}var __importDefault=this&&this[a48_0x1e2af2(0x12b)]||function(_0x441bf1){return _0x441bf1&&_0x441bf1['__esModule']?_0x441bf1:{'default':_0x441bf1};};function a48_0x389b(_0x134f85,_0x515b14){_0x134f85=_0x134f85-0x6f;const _0x2dc6ca=a48_0x2dc6();let _0x389b67=_0x2dc6ca[_0x134f85];return _0x389b67;}Object['defineProperty'](exports,a48_0x1e2af2(0x11e),{'value':!![]}),exports[a48_0x1e2af2(0x84)]=exports['CoinToPayStatusService']=void 0x0;const coinToPayService_1=require(a48_0x1e2af2(0x160)),coinToPay2Service_1=require(a48_0x1e2af2(0xb1)),gateway_1=require(a48_0x1e2af2(0xcb)),database_1=__importDefault(require(a48_0x1e2af2(0xf1))),telegramBotService_1=require(a48_0x1e2af2(0x163)),loggerService_1=require(a48_0x1e2af2(0x155)),currencyService_1=require('./currencyService');class CoinToPayStatusService{constructor(){const _0x29a051=a48_0x1e2af2;this['globalCheckInterval']=null,this[_0x29a051(0x12d)]=0x3c*0x3c*0x3e8,this[_0x29a051(0x11a)]=0x5,this[_0x29a051(0x107)]=new Map(),this[_0x29a051(0x109)]=new coinToPayService_1['CoinToPayService'](),this[_0x29a051(0x169)]=new coinToPay2Service_1['CoinToPay2Service'](),console[_0x29a051(0x15f)]('ü™ô\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2');}[a48_0x1e2af2(0xf2)](_0x3eb8cd,_0x5c4b51){const _0x2f4e73=a48_0x1e2af2;console[_0x2f4e73(0x15f)](_0x2f4e73(0xcc)),console[_0x2f4e73(0x15f)](_0x2f4e73(0x14b)+_0x3eb8cd),console[_0x2f4e73(0x15f)](_0x2f4e73(0x13d)+_0x5c4b51),this[_0x2f4e73(0x111)](_0x3eb8cd);const _0x5796bd=[],_0x1fcc3f=new Date(),_0x1501bf=[{'delay':0x1*0x3c*0x3e8,'description':_0x2f4e73(0xc2)},{'delay':0x2*0x3c*0x3e8,'description':'2\x20minutes'},{'delay':0x5*0x3c*0x3e8,'description':_0x2f4e73(0x8d)},{'delay':0x5*0x3c*0x3e8,'description':'5\x20minutes'}];console[_0x2f4e73(0x15f)](_0x2f4e73(0xea)+_0x1501bf[_0x2f4e73(0xbe)]+_0x2f4e73(0xdd)+_0x3eb8cd);let _0x4e9e79=0x0;_0x1501bf[_0x2f4e73(0xca)]((_0xccf01d,_0xcec48a)=>{const _0xc85236=_0x2f4e73;_0x4e9e79+=_0xccf01d['delay'];const _0x25a2cd=setTimeout(async()=>{const _0x5e72e9=a48_0x389b;console[_0x5e72e9(0x15f)](_0x5e72e9(0x114)+(_0xcec48a+0x1)+_0x5e72e9(0x13a)+_0x3eb8cd+_0x5e72e9(0xc6)+_0xccf01d[_0x5e72e9(0xb8)]+')');try{await this[_0x5e72e9(0x83)](_0x3eb8cd),console['log'](_0x5e72e9(0x75)+(_0xcec48a+0x1)+_0x5e72e9(0xa8)+_0x3eb8cd);}catch(_0x5cdc3d){console[_0x5e72e9(0x118)](_0x5e72e9(0x9e)+(_0xcec48a+0x1)+_0x5e72e9(0xec)+_0x3eb8cd+':',_0x5cdc3d),this['logCoinToPayError'](_0x3eb8cd,_0x5c4b51,_0x5cdc3d,_0x5e72e9(0x14c),{'checkNumber':_0xcec48a+0x1,'scheduledAfter':_0xccf01d[_0x5e72e9(0xb8)],'isIndividualCheck':!![]});}},_0x4e9e79);_0x5796bd[_0xc85236(0x139)](_0x25a2cd),console['log'](_0xc85236(0xb7)+(_0xcec48a+0x1)+_0xc85236(0xec)+_0x3eb8cd+_0xc85236(0xf8)+_0x4e9e79/0x3e8+'\x20seconds\x20('+_0xccf01d['description']+')');});const _0x35704f=setInterval(async()=>{const _0x1ab603=_0x2f4e73;console[_0x1ab603(0x15f)](_0x1ab603(0xfc)+_0x3eb8cd);try{const _0x4b826b=await database_1['default'][_0x1ab603(0x10b)][_0x1ab603(0x11f)]({'where':{'id':_0x3eb8cd},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x4b826b){console[_0x1ab603(0x15f)](_0x1ab603(0xc1)+_0x3eb8cd+'\x20not\x20found,\x20clearing\x20timers'),this[_0x1ab603(0x111)](_0x3eb8cd);return;}console[_0x1ab603(0x15f)](_0x1ab603(0x128)+_0x3eb8cd+_0x1ab603(0x165)+_0x4b826b['status']);if(_0x4b826b[_0x1ab603(0x9c)]!==_0x1ab603(0x149)){console[_0x1ab603(0x15f)]('‚úÖ\x20[HOURLY]\x20Payment\x20'+_0x3eb8cd+_0x1ab603(0xd9)+_0x4b826b[_0x1ab603(0x9c)]+_0x1ab603(0x17d)),this[_0x1ab603(0x111)](_0x3eb8cd);return;}const _0x3cb7f6=Math[_0x1ab603(0x13e)]((Date[_0x1ab603(0x150)]()-_0x4b826b[_0x1ab603(0xef)][_0x1ab603(0x8f)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x3cb7f6>=this[_0x1ab603(0x11a)]){console['log']('‚è∞\x20[HOURLY]\x20Payment\x20'+_0x3eb8cd+'\x20is\x20older\x20than\x20'+this[_0x1ab603(0x11a)]+_0x1ab603(0x86)),this[_0x1ab603(0x111)](_0x3eb8cd);return;}await this[_0x1ab603(0x83)](_0x3eb8cd),console[_0x1ab603(0x15f)](_0x1ab603(0xab)+_0x3eb8cd);}catch(_0x19992f){console[_0x1ab603(0x118)](_0x1ab603(0x142)+_0x3eb8cd+':',_0x19992f),this[_0x1ab603(0x9f)](_0x3eb8cd,_0x5c4b51,_0x19992f,_0x1ab603(0x14c),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x5796bd[_0x2f4e73(0x139)](_0x35704f),this['paymentTimers'][_0x2f4e73(0x105)](_0x3eb8cd,{'timers':_0x5796bd,'paymentId':_0x3eb8cd,'gatewayPaymentId':_0x5c4b51,'createdAt':_0x1fcc3f}),console[_0x2f4e73(0x15f)](_0x2f4e73(0x177)+_0x1501bf[_0x2f4e73(0xbe)]+_0x2f4e73(0xf4)+_0x3eb8cd),console[_0x2f4e73(0x15f)](_0x2f4e73(0x16f)+this[_0x2f4e73(0x107)][_0x2f4e73(0x9a)]),this[_0x2f4e73(0x16a)](_0x3eb8cd,_0x5c4b51,_0x2f4e73(0x149),'PENDING',_0x2f4e73(0x14c),{'action':_0x2f4e73(0xf6),'scheduledChecks':_0x1501bf[_0x2f4e73(0xbe)],'firstCheckIn':_0x1501bf[0x0]['delay']/0x3e8,'totalTimers':this['paymentTimers']['size']});}[a48_0x1e2af2(0x111)](_0xb5880e){const _0x2d2c40=a48_0x1e2af2,_0x338da9=this[_0x2d2c40(0x107)][_0x2d2c40(0xc4)](_0xb5880e);_0x338da9?(console[_0x2d2c40(0x15f)]('üßπ\x20[DEBUG]\x20Clearing\x20'+_0x338da9[_0x2d2c40(0x17c)][_0x2d2c40(0xbe)]+_0x2d2c40(0x121)+_0xb5880e),_0x338da9[_0x2d2c40(0x17c)][_0x2d2c40(0xca)]((_0x300c46,_0x30582f)=>{const _0x82cbb7=_0x2d2c40;_0x300c46&&(clearTimeout(_0x300c46),clearInterval(_0x300c46),console['log'](_0x82cbb7(0x15d)+(_0x30582f+0x1)+_0x82cbb7(0xec)+_0xb5880e));}),this[_0x2d2c40(0x107)][_0x2d2c40(0xe1)](_0xb5880e),console[_0x2d2c40(0x15f)](_0x2d2c40(0x136)+_0xb5880e+_0x2d2c40(0xaa)+this[_0x2d2c40(0x107)][_0x2d2c40(0x9a)])):console[_0x2d2c40(0x15f)]('‚ö†Ô∏è\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20'+_0xb5880e+_0x2d2c40(0x7d));}async[a48_0x1e2af2(0x83)](_0x181213){const _0x45d6c8=a48_0x1e2af2;console[_0x45d6c8(0x15f)](_0x45d6c8(0x152)+_0x181213);const _0x2bd55d=await database_1[_0x45d6c8(0x79)][_0x45d6c8(0x10b)]['findUnique']({'where':{'id':_0x181213},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x2bd55d){console[_0x45d6c8(0x15f)](_0x45d6c8(0x100)+_0x181213+_0x45d6c8(0xb6));return;}console[_0x45d6c8(0x15f)](_0x45d6c8(0x81)+_0x181213+_0x45d6c8(0x87)),console['log'](_0x45d6c8(0xbd)+_0x2bd55d[_0x45d6c8(0x173)]),console['log'](_0x45d6c8(0xe9)+_0x2bd55d['status']),console[_0x45d6c8(0x15f)](_0x45d6c8(0xb3)+_0x2bd55d['gatewayPaymentId']),console['log'](_0x45d6c8(0x14e)+_0x2bd55d[_0x45d6c8(0x167)]+'\x20'+_0x2bd55d[_0x45d6c8(0x144)]),console['log'](_0x45d6c8(0x156)+_0x2bd55d[_0x45d6c8(0x10a)]);if(_0x2bd55d[_0x45d6c8(0x173)]!==_0x45d6c8(0x117)&&_0x2bd55d[_0x45d6c8(0x173)]!==_0x45d6c8(0xe7)){console['log'](_0x45d6c8(0x16d)+_0x181213+_0x45d6c8(0x171)+_0x2bd55d[_0x45d6c8(0x173)]+')');return;}if(_0x2bd55d[_0x45d6c8(0x9c)]!=='PENDING'){console[_0x45d6c8(0x15f)](_0x45d6c8(0x16d)+_0x181213+_0x45d6c8(0xd9)+_0x2bd55d['status']+_0x45d6c8(0x17d)),this[_0x45d6c8(0x111)](_0x181213);return;}if(!_0x2bd55d[_0x45d6c8(0x140)]){console[_0x45d6c8(0x15f)](_0x45d6c8(0x16d)+_0x181213+'\x20has\x20no\x20gatewayPaymentId');return;}console['log']('‚úÖ\x20[CHECK]\x20Payment\x20'+_0x181213+_0x45d6c8(0x110)),await this[_0x45d6c8(0x7e)](_0x2bd55d);}[a48_0x1e2af2(0x16a)](_0x1befd0,_0xc6c84b,_0x37115e,_0x25cc3e,_0x4a1732,_0x135304){const _0x54bd91=a48_0x1e2af2,_0x53971e={'type':_0x54bd91(0x123),'paymentId':_0x1befd0,'gatewayPaymentId':_0xc6c84b,'oldStatus':_0x37115e,'newStatus':_0x25cc3e,'source':_0x4a1732,'timestamp':new Date()[_0x54bd91(0xa7)](),'details':_0x135304||{}};loggerService_1['loggerService'][_0x54bd91(0x16a)](_0x53971e),console[_0x54bd91(0x15f)]('ü™ô\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20'+_0x1befd0+'\x20('+_0xc6c84b+')'),console[_0x54bd91(0x15f)](_0x54bd91(0x101)+_0x37115e+_0x54bd91(0xe0)+_0x25cc3e),console['log'](_0x54bd91(0x89)+_0x4a1732),console[_0x54bd91(0x15f)](_0x54bd91(0x17e)+_0x53971e[_0x54bd91(0x78)]),_0x135304&&console[_0x54bd91(0x15f)](_0x54bd91(0x12e),_0x135304);}[a48_0x1e2af2(0x9f)](_0x1f707e,_0x5659aa,_0x47c4a8,_0x13977c,_0x12eb0f){const _0x38345d=a48_0x1e2af2,_0x4af1b7={'type':'COINTOPAY_ERROR','paymentId':_0x1f707e,'gatewayPaymentId':_0x5659aa,'error':_0x47c4a8 instanceof Error?{'message':_0x47c4a8[_0x38345d(0xd5)],'stack':_0x47c4a8['stack']}:_0x47c4a8,'source':_0x13977c,'timestamp':new Date()[_0x38345d(0xa7)](),'context':_0x12eb0f||{}};loggerService_1[_0x38345d(0xc0)]['logCoinToPayError'](_0x4af1b7),console['error'](_0x38345d(0x138)+_0x1f707e+'\x20('+_0x5659aa+')'),console[_0x38345d(0x118)](_0x38345d(0x108)+(_0x47c4a8 instanceof Error?_0x47c4a8['message']:_0x47c4a8)),console[_0x38345d(0x118)](_0x38345d(0x89)+_0x13977c),console[_0x38345d(0x118)](_0x38345d(0x17e)+_0x4af1b7[_0x38345d(0x78)]),_0x12eb0f&&console[_0x38345d(0x118)](_0x38345d(0xc8),_0x12eb0f);}[a48_0x1e2af2(0x16e)](){const _0x1e0e71=a48_0x1e2af2;console[_0x1e0e71(0x15f)](_0x1e0e71(0x71)),this[_0x1e0e71(0x157)]()[_0x1e0e71(0x72)](_0x29d0a5=>{const _0x273547=_0x1e0e71;console['error'](_0x273547(0x95),_0x29d0a5);}),this[_0x1e0e71(0xe6)]=setInterval(async()=>{const _0x2fc916=_0x1e0e71;try{console[_0x2fc916(0x15f)]('ü™ô\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...'),await this[_0x2fc916(0x157)](),console[_0x2fc916(0x15f)](_0x2fc916(0x141));}catch(_0x4239e8){console[_0x2fc916(0x118)](_0x2fc916(0x93),_0x4239e8);}},this[_0x1e0e71(0x12d)]),console['log']('‚úÖ\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)');}[a48_0x1e2af2(0xdc)](){const _0x26b5da=a48_0x1e2af2;console['log'](_0x26b5da(0xcf));this[_0x26b5da(0xe6)]&&(clearInterval(this[_0x26b5da(0xe6)]),this[_0x26b5da(0xe6)]=null,console['log']('üõë\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped'));const _0x381c66=this[_0x26b5da(0x107)]['size'];for(const [_0x1ea6c6]of this[_0x26b5da(0x107)]){this[_0x26b5da(0x111)](_0x1ea6c6);}console[_0x26b5da(0x15f)](_0x26b5da(0x153)+_0x381c66+_0x26b5da(0x7f));}async['checkAllPendingPayments'](){const _0x3dc953=a48_0x1e2af2;try{console[_0x3dc953(0x15f)](_0x3dc953(0xb9));const _0x12d34c=await database_1['default'][_0x3dc953(0x10b)][_0x3dc953(0x172)]({'where':{'gateway':{'in':[_0x3dc953(0x117),'cointopay2']},'status':_0x3dc953(0x149),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x3dc953(0x15f)](_0x3dc953(0x13b)+_0x12d34c[_0x3dc953(0xbe)]+_0x3dc953(0x132));if(_0x12d34c['length']===0x0){console[_0x3dc953(0x15f)](_0x3dc953(0x166));return;}const _0x6b8bb2=await this[_0x3dc953(0x102)](_0x12d34c);console[_0x3dc953(0x15f)](_0x3dc953(0xa1)+_0x6b8bb2[_0x3dc953(0xbe)]+_0x3dc953(0x7c));let _0x27d97a=0x0,_0x16b4c8=0x0;for(const _0x226d9b of _0x12d34c){try{if(_0x6b8bb2[_0x3dc953(0xe2)](_0x226d9b['id'])){console[_0x3dc953(0x15f)](_0x3dc953(0x151)+_0x226d9b['id']+_0x3dc953(0xbc)),_0x16b4c8++;continue;}if(this[_0x3dc953(0x107)][_0x3dc953(0xff)](_0x226d9b['id'])){console[_0x3dc953(0x15f)](_0x3dc953(0x151)+_0x226d9b['id']+_0x3dc953(0x14f)),_0x16b4c8++;continue;}const _0x4dcbf9=(Date[_0x3dc953(0x150)]()-_0x226d9b[_0x3dc953(0xef)][_0x3dc953(0x8f)]())/(0x3e8*0x3c*0x3c);if(_0x4dcbf9<0x1){console['log'](_0x3dc953(0x151)+_0x226d9b['id']+'\x20is\x20too\x20new\x20('+_0x4dcbf9[_0x3dc953(0x162)](0x1)+'h),\x20skipping\x20global\x20check'),_0x16b4c8++;continue;}console[_0x3dc953(0x15f)]('üîç\x20[GLOBAL]\x20Checking\x20old\x20payment\x20'+_0x226d9b['id']+_0x3dc953(0xd1)+_0x4dcbf9['toFixed'](0x1)+'h)'),await this[_0x3dc953(0x7e)](_0x226d9b),_0x27d97a++,await new Promise(_0x564f32=>setTimeout(_0x564f32,0x7d0));}catch(_0x49fbd5){console[_0x3dc953(0x118)](_0x3dc953(0x15a)+_0x226d9b['id']+':',_0x49fbd5),this[_0x3dc953(0x9f)](_0x226d9b['id'],_0x226d9b[_0x3dc953(0x140)]||'unknown',_0x49fbd5,_0x3dc953(0x14c),{'isGlobalCheck':!![],'paymentAmount':_0x226d9b[_0x3dc953(0x167)],'paymentCurrency':_0x226d9b[_0x3dc953(0x144)],'shopId':_0x226d9b[_0x3dc953(0x10a)],'createdAt':_0x226d9b[_0x3dc953(0xef)]}),loggerService_1[_0x3dc953(0xc0)][_0x3dc953(0x106)](_0x3dc953(0x117),_0x3dc953(0x113)+_0x226d9b[_0x3dc953(0x140)],_0x49fbd5);}}console['log'](_0x3dc953(0x7a)+_0x27d97a+_0x3dc953(0x97)+_0x16b4c8+'\x20skipped,\x20'+_0x6b8bb2[_0x3dc953(0xbe)]+_0x3dc953(0xfe));}catch(_0x489091){console[_0x3dc953(0x118)]('‚ùå\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:',_0x489091);}}async[a48_0x1e2af2(0x102)](_0x1bb54a){const _0x5f5cec=a48_0x1e2af2,_0x2656ff=[],_0x1e454d=new Date();_0x1e454d[_0x5f5cec(0x85)](_0x1e454d[_0x5f5cec(0x131)]()-this[_0x5f5cec(0x11a)]),console[_0x5f5cec(0x15f)](_0x5f5cec(0x11c)+this['EXPIRY_DAYS']+_0x5f5cec(0x8e)+_0x1e454d[_0x5f5cec(0xa7)]()+')');for(const _0x274335 of _0x1bb54a){if(_0x274335[_0x5f5cec(0xef)]<_0x1e454d){console[_0x5f5cec(0x15f)](_0x5f5cec(0x175)+_0x274335['id']+_0x5f5cec(0x99)+this['EXPIRY_DAYS']+_0x5f5cec(0x12c));try{this[_0x5f5cec(0x16a)](_0x274335['id'],_0x274335[_0x5f5cec(0x140)]||_0x5f5cec(0x88),_0x5f5cec(0x149),_0x5f5cec(0xb2),'auto_expire',{'reason':_0x5f5cec(0xe4)+this[_0x5f5cec(0x11a)]+_0x5f5cec(0xb0),'createdAt':_0x274335[_0x5f5cec(0xef)],'daysSinceCreation':Math['floor']((Date['now']()-_0x274335[_0x5f5cec(0xef)][_0x5f5cec(0x8f)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x274335[_0x5f5cec(0x167)],'paymentCurrency':_0x274335[_0x5f5cec(0x144)],'shopId':_0x274335[_0x5f5cec(0x10a)]}),await database_1[_0x5f5cec(0x79)][_0x5f5cec(0x10b)][_0x5f5cec(0x10f)]({'where':{'id':_0x274335['id']},'data':{'status':_0x5f5cec(0xb2),'updatedAt':new Date()}}),await database_1[_0x5f5cec(0x79)][_0x5f5cec(0x90)][_0x5f5cec(0xcd)]({'data':{'paymentId':_0x274335['id'],'shopId':_0x274335[_0x5f5cec(0x10a)],'event':_0x5f5cec(0xae),'statusCode':0xc8,'responseBody':JSON[_0x5f5cec(0x135)]({'reason':_0x5f5cec(0xe4)+this['EXPIRY_DAYS']+_0x5f5cec(0xb0),'createdAt':_0x274335[_0x5f5cec(0xef)],'expiredAt':new Date()['toISOString'](),'daysSinceCreation':Math[_0x5f5cec(0x13e)]((Date[_0x5f5cec(0x150)]()-_0x274335[_0x5f5cec(0xef)][_0x5f5cec(0x8f)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this['sendShopWebhook'](_0x274335,_0x5f5cec(0xb2)),await this[_0x5f5cec(0x179)](_0x274335,_0x5f5cec(0xb2)),this['clearPaymentTimers'](_0x274335['id']),_0x2656ff[_0x5f5cec(0x139)](_0x274335['id']),console[_0x5f5cec(0x15f)]('‚úÖ\x20[EXPIRY]\x20Payment\x20'+_0x274335['id']+_0x5f5cec(0x158)+this[_0x5f5cec(0x11a)]+_0x5f5cec(0xd4));}catch(_0x4df021){console[_0x5f5cec(0x118)](_0x5f5cec(0x11d)+_0x274335['id']+':',_0x4df021),this['logCoinToPayError'](_0x274335['id'],_0x274335['gatewayPaymentId']||'unknown',_0x4df021,_0x5f5cec(0x7b),{'reason':_0x5f5cec(0x14a),'createdAt':_0x274335['createdAt'],'daysSinceCreation':Math[_0x5f5cec(0x13e)]((Date[_0x5f5cec(0x150)]()-_0x274335['createdAt'][_0x5f5cec(0x8f)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x2656ff;}async['checkSinglePayment'](_0x105837){const _0x142800=a48_0x1e2af2;if(!_0x105837['gatewayPaymentId']){console[_0x142800(0x15f)](_0x142800(0x16d)+_0x105837['id']+_0x142800(0x154));return;}console[_0x142800(0x15f)](_0x142800(0x115)+_0x105837['gateway']+_0x142800(0x10e)+_0x105837['id']+'\x20('+_0x105837['gatewayPaymentId']+')');try{let _0x235d9e;_0x105837[_0x142800(0x173)]==='cointopay2'?(_0x235d9e=await this[_0x142800(0x169)][_0x142800(0xf3)](_0x105837[_0x142800(0x140)]),console['log'](_0x142800(0x8a)+_0x105837['id']+_0x142800(0xc9)+_0x235d9e['status'])):(_0x235d9e=await this['coinToPayService'][_0x142800(0xf3)](_0x105837[_0x142800(0x140)]),console['log']('üìä\x20[CHECK]\x20CoinToPay\x20payment\x20'+_0x105837['id']+_0x142800(0xc9)+_0x235d9e[_0x142800(0x9c)]));_0x235d9e[_0x142800(0x12f)]&&console[_0x142800(0x15f)](_0x142800(0x81)+_0x105837['id']+_0x142800(0x91),{'iban':_0x235d9e['paymentDetails'][_0x142800(0x116)]||_0x142800(0x127),'transactionId':_0x235d9e[_0x142800(0x12f)][_0x142800(0x134)],'createdOn':_0x235d9e['paymentDetails'][_0x142800(0x145)],'confirmedOn':_0x235d9e[_0x142800(0x12f)]['confirmedOn']||_0x142800(0x6f)});if(_0x235d9e[_0x142800(0x9c)]!==_0x105837['status']){console[_0x142800(0x15f)]('üîÑ\x20[CHECK]\x20Updating\x20payment\x20'+_0x105837['id']+'\x20status\x20from\x20'+_0x105837[_0x142800(0x9c)]+'\x20to\x20'+_0x235d9e[_0x142800(0x9c)]),this['logCoinToPayStatus'](_0x105837['id'],_0x105837[_0x142800(0x140)],_0x105837[_0x142800(0x9c)],_0x235d9e[_0x142800(0x9c)],_0x142800(0x14c),{'paymentDetails':_0x235d9e[_0x142800(0x12f)],'amount':_0x235d9e[_0x142800(0x167)],'currency':_0x235d9e['currency'],'shopId':_0x105837[_0x142800(0x10a)],'checkTimestamp':new Date()[_0x142800(0xa7)]()});const _0x30fb1f={'status':_0x235d9e[_0x142800(0x9c)],'updatedAt':new Date()};if(_0x235d9e[_0x142800(0x9c)]===_0x142800(0xee)&&_0x105837[_0x142800(0x9c)]!==_0x142800(0xee)){_0x30fb1f['paidAt']=new Date();if(!_0x105837['amountUSDT']){const _0x7bdc9=await currencyService_1[_0x142800(0x17a)][_0x142800(0x119)](_0x105837[_0x142800(0x167)],_0x105837[_0x142800(0x144)]);_0x30fb1f[_0x142800(0xce)]=_0x7bdc9;const _0x2d32be=await this[_0x142800(0xaf)](_0x105837[_0x142800(0x10a)],_0x105837[_0x142800(0x173)]),_0x53a6eb=_0x7bdc9*(0x1-_0x2d32be/0x64);_0x30fb1f[_0x142800(0x9b)]=_0x53a6eb,_0x30fb1f['gatewayCommissionRate']=_0x2d32be,console[_0x142800(0x15f)](_0x142800(0x146)+_0x105837['id']+'\x20amounts\x20calculated:'),console[_0x142800(0x15f)](_0x142800(0x77)+_0x105837['amount']+'\x20'+_0x105837[_0x142800(0x144)]+_0x142800(0xe0)+_0x7bdc9[_0x142800(0x162)](0x6)+'\x20USDT'),console[_0x142800(0x15f)](_0x142800(0x8c)+_0x105837[_0x142800(0x173)]+_0x142800(0x96)+_0x2d32be+'%'),console['log']('\x20\x20\x20Amount\x20after\x20commission:\x20'+_0x53a6eb['toFixed'](0x6)+_0x142800(0xc5));}console['log'](_0x142800(0x146)+_0x105837['id']+_0x142800(0xf9)+_0x30fb1f[_0x142800(0x124)][_0x142800(0xa7)]());}if(_0x235d9e[_0x142800(0x12f)]){const _0x581c30=_0x235d9e[_0x142800(0x12f)];_0x581c30['iban']&&(_0x30fb1f[_0x142800(0xeb)]=_0x581c30[_0x142800(0x116)],console[_0x142800(0x15f)](_0x142800(0x17f)+_0x581c30[_0x142800(0x116)])),_0x581c30[_0x142800(0xa5)]&&console['log'](_0x142800(0x176)+_0x581c30[_0x142800(0xa5)]),_0x581c30[_0x142800(0x134)]&&console[_0x142800(0x15f)](_0x142800(0x122)+_0x581c30[_0x142800(0x134)]),_0x581c30[_0x142800(0xda)]&&console[_0x142800(0x15f)](_0x142800(0xb5)+_0x581c30['confirmedOn']);}await database_1[_0x142800(0x79)][_0x142800(0x10b)][_0x142800(0x10f)]({'where':{'id':_0x105837['id']},'data':_0x30fb1f});if(_0x235d9e[_0x142800(0x9c)]===_0x142800(0xee)&&_0x105837[_0x142800(0x9c)]!==_0x142800(0xee)){console['log']('üìà\x20[COINTOPAY]\x20Payment\x20'+_0x105837['id']+'\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link');const _0x259a91=await database_1[_0x142800(0x79)][_0x142800(0x10b)][_0x142800(0x11f)]({'where':{'id':_0x105837['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x259a91?.[_0x142800(0x15b)]&&_0x259a91[_0x142800(0x164)])try{const _0x3b724f=_0x259a91[_0x142800(0x164)];console['log'](_0x142800(0xe8)+_0x3b724f['id']+_0x142800(0x129)+_0x3b724f['type']+_0x142800(0xc7)+_0x3b724f[_0x142800(0xf5)]+_0x142800(0x13f)+_0x3b724f[_0x142800(0x9c)]);const _0x25010d=_0x3b724f['currentPayments']+0x1,_0x4a54cd=_0x3b724f[_0x142800(0xd8)]===_0x142800(0x147)?_0x142800(0xa3):_0x3b724f[_0x142800(0x9c)];await database_1[_0x142800(0x79)]['paymentLink'][_0x142800(0x10f)]({'where':{'id':_0x3b724f['id']},'data':{'currentPayments':_0x25010d,'status':_0x4a54cd,'updatedAt':new Date()}}),console[_0x142800(0x15f)]('‚úÖ\x20[COINTOPAY]\x20Payment\x20link\x20'+_0x3b724f['id']+'\x20updated:\x20currentPayments='+_0x3b724f[_0x142800(0xf5)]+_0x142800(0xe0)+_0x25010d+_0x142800(0x13f)+_0x3b724f[_0x142800(0x9c)]+_0x142800(0xe0)+_0x4a54cd);}catch(_0x538413){console['error']('‚ùå\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:',_0x538413);}else console['log'](_0x142800(0xd0)+_0x105837['id']+_0x142800(0x170));}await database_1[_0x142800(0x79)][_0x142800(0x90)][_0x142800(0xcd)]({'data':{'paymentId':_0x105837['id'],'shopId':_0x105837[_0x142800(0x10a)],'event':_0x142800(0x143)+_0x235d9e[_0x142800(0x9c)]['toLowerCase'](),'statusCode':0xc8,'responseBody':JSON['stringify']({'oldStatus':_0x105837[_0x142800(0x9c)],'newStatus':_0x235d9e[_0x142800(0x9c)],'paymentDetails':_0x235d9e[_0x142800(0x12f)],'checkedAt':new Date()[_0x142800(0xa7)]()})}}),await this[_0x142800(0xd3)](_0x105837,_0x235d9e[_0x142800(0x9c)]),await this['sendPaymentStatusNotification'](_0x105837,_0x235d9e[_0x142800(0x9c)]),_0x235d9e[_0x142800(0x9c)]!==_0x142800(0x149)&&(console[_0x142800(0x15f)](_0x142800(0x14d)+_0x105837['id']+_0x142800(0x133)+_0x235d9e[_0x142800(0x9c)]+_0x142800(0xa9)),this[_0x142800(0x111)](_0x105837['id'])),console[_0x142800(0x15f)](_0x142800(0xb4)+_0x105837['id']+_0x142800(0xba));}else console['log'](_0x142800(0x81)+_0x105837['id']+'\x20status\x20unchanged\x20('+_0x235d9e['status']+')'),this[_0x142800(0x16a)](_0x105837['id'],_0x105837[_0x142800(0x140)],_0x105837[_0x142800(0x9c)],_0x235d9e[_0x142800(0x9c)],_0x142800(0x14c),{'statusUnchanged':!![],'paymentDetails':_0x235d9e['paymentDetails'],'amount':_0x235d9e[_0x142800(0x167)],'currency':_0x235d9e[_0x142800(0x144)],'shopId':_0x105837[_0x142800(0x10a)],'checkTimestamp':new Date()[_0x142800(0xa7)]()});}catch(_0x25d6c5){console[_0x142800(0x118)]('‚ùå\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20'+_0x105837['id']+':',_0x25d6c5),this[_0x142800(0x9f)](_0x105837['id'],_0x105837[_0x142800(0x140)],_0x25d6c5,_0x142800(0x14c),{'paymentAmount':_0x105837[_0x142800(0x167)],'paymentCurrency':_0x105837[_0x142800(0x144)],'shopId':_0x105837[_0x142800(0x10a)],'createdAt':_0x105837[_0x142800(0xef)]}),await database_1[_0x142800(0x79)]['webhookLog'][_0x142800(0xcd)]({'data':{'paymentId':_0x105837['id'],'shopId':_0x105837[_0x142800(0x10a)],'event':_0x142800(0x180),'statusCode':0x1f4,'responseBody':JSON[_0x142800(0x135)]({'error':_0x25d6c5 instanceof Error?_0x25d6c5[_0x142800(0xd5)]:_0x142800(0xbb),'gatewayPaymentId':_0x105837[_0x142800(0x140)],'checkedAt':new Date()[_0x142800(0xa7)]()})}});}}async[a48_0x1e2af2(0xd3)](_0x431bb5,_0x26ca6d){const _0xc15530=a48_0x1e2af2,_0x3cc98d=Date['now']();try{const _0x1fe7e3=_0x431bb5[_0xc15530(0xa4)],_0x4d8071=_0x1fe7e3['settings'];if(!_0x4d8071?.[_0xc15530(0x126)]){console[_0xc15530(0x15f)]('No\x20webhook\x20URL\x20configured\x20for\x20shop\x20'+_0x1fe7e3['id']);return;}const _0xe9f924=_0x26ca6d===_0xc15530(0xee)?_0xc15530(0x15c):_0x26ca6d===_0xc15530(0x13c)?_0xc15530(0x137):_0x26ca6d===_0xc15530(0xb2)?_0xc15530(0x137):'payment.pending';if(!_0x4d8071['webhookEvents']?.['includes'](_0xe9f924)){console['log']('Webhook\x20event\x20'+_0xe9f924+_0xc15530(0xa2)+_0x1fe7e3['id']);return;}const _0x536579=(0x0,gateway_1['getGatewayIdByName'])(_0x431bb5[_0xc15530(0x173)])||_0x431bb5[_0xc15530(0x173)],_0x550c04={'event':_0xe9f924,'payment':{'id':_0x431bb5['id'],'order_id':_0x431bb5[_0xc15530(0x148)],'gateway_order_id':_0x431bb5[_0xc15530(0x92)],'gateway':_0x536579,'amount':_0x431bb5[_0xc15530(0x167)],'currency':_0x431bb5[_0xc15530(0x144)],'status':_0x26ca6d[_0xc15530(0x9d)](),'customer_email':_0x431bb5[_0xc15530(0xfd)],'customer_name':_0x431bb5[_0xc15530(0x15e)],'created_at':_0x431bb5[_0xc15530(0xef)],'updated_at':new Date()}},_0x2c869a=await fetch(_0x4d8071[_0xc15530(0x126)],{'method':_0xc15530(0x98),'headers':{'Content-Type':_0xc15530(0x168),'User-Agent':'Payment\x20System/1.0'},'body':JSON[_0xc15530(0x135)](_0x550c04)}),_0x12d941=Date[_0xc15530(0x150)]()-_0x3cc98d,_0x2d2491=_0x2c869a['ok']?_0xc15530(0xd6):await _0x2c869a['text']();loggerService_1[_0xc15530(0xc0)][_0xc15530(0x112)](_0x431bb5[_0xc15530(0x10a)],_0x4d8071[_0xc15530(0x126)],_0xe9f924,_0x2c869a['status'],_0x12d941,_0x550c04),console[_0xc15530(0x15f)]('Shop\x20webhook\x20sent\x20to\x20'+_0x4d8071[_0xc15530(0x126)]+_0xc15530(0x10c)+_0x2c869a[_0xc15530(0x9c)]+'\x20('+_0x12d941+_0xc15530(0xd7));}catch(_0x305207){console['error'](_0xc15530(0x159),_0x305207),loggerService_1[_0xc15530(0xc0)]['logShopWebhookError'](_0x431bb5[_0xc15530(0x10a)],_0x431bb5[_0xc15530(0xa4)]?.[_0xc15530(0xbf)]?.['webhookUrl']||_0xc15530(0x88),_0xc15530(0x16b),_0x305207,{});}}async['sendPaymentStatusNotification'](_0x4a8746,_0x232cee){const _0x1034ca=a48_0x1e2af2;try{const _0x465007={'PENDING':_0x1034ca(0x17b),'PAID':'paid','FAILED':_0x1034ca(0xf7),'EXPIRED':_0x1034ca(0xe3)},_0x2cbbfc=_0x465007[_0x232cee];if(!_0x2cbbfc||_0x2cbbfc===_0x1034ca(0x17b))return;await telegramBotService_1[_0x1034ca(0x8b)]['sendPaymentNotification'](_0x4a8746[_0x1034ca(0x10a)],_0x4a8746,_0x2cbbfc);}catch(_0x223fc3){console['error'](_0x1034ca(0xe5),_0x223fc3);}}async[a48_0x1e2af2(0xa0)](_0x5789a3){const _0x1676ae=a48_0x1e2af2;console[_0x1676ae(0x15f)](_0x1676ae(0x104)+_0x5789a3);const _0x689035=await database_1[_0x1676ae(0x79)][_0x1676ae(0x10b)][_0x1676ae(0x11f)]({'where':{'id':_0x5789a3},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x689035)throw new Error(_0x1676ae(0xf0));if(_0x689035[_0x1676ae(0x173)]!=='cointopay'&&_0x689035[_0x1676ae(0x173)]!==_0x1676ae(0xe7))throw new Error(_0x1676ae(0x120));console[_0x1676ae(0x15f)](_0x1676ae(0x10d)+_0x689035['gateway']+'\x20payment\x20'+_0x5789a3),await this['checkSinglePayment'](_0x689035),console[_0x1676ae(0x15f)]('‚úÖ\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20'+_0x5789a3);}[a48_0x1e2af2(0xdf)](){const _0x213211=a48_0x1e2af2,_0x9c0e22=this[_0x213211(0xe6)]?this['GLOBAL_CHECK_INTERVAL_MS']:undefined,_0x3da867=Array[_0x213211(0x76)](this['paymentTimers']['values']())[_0x213211(0x70)](_0x288899=>({'paymentId':_0x288899[_0x213211(0x130)],'gatewayPaymentId':_0x288899[_0x213211(0x140)],'createdAt':_0x288899[_0x213211(0xef)],'timersCount':_0x288899[_0x213211(0x17c)][_0x213211(0xbe)]}));return{'isActive':!!this[_0x213211(0xe6)],'globalCheckIntervalMinutes':this[_0x213211(0x12d)]/(0x3e8*0x3c),'expiryDays':this[_0x213211(0x11a)],'activeIndividualTimers':this[_0x213211(0x107)][_0x213211(0x9a)],'nextGlobalCheckIn':_0x9c0e22,'paymentTimersDetails':_0x3da867};}[a48_0x1e2af2(0x73)](_0x4aa16e){const _0x260d7d=a48_0x1e2af2,_0x36f4e7=this['paymentTimers'][_0x260d7d(0xc4)](_0x4aa16e);if(_0x36f4e7)return{'hasTimers':!![],'timersCount':_0x36f4e7[_0x260d7d(0x17c)][_0x260d7d(0xbe)],'createdAt':_0x36f4e7['createdAt'],'gatewayPaymentId':_0x36f4e7[_0x260d7d(0x140)]};return{'hasTimers':![]};}async[a48_0x1e2af2(0xaf)](_0x4c5db5,_0x86be23){const _0x5ade1d=a48_0x1e2af2;try{const _0x187f9d=await database_1[_0x5ade1d(0x79)][_0x5ade1d(0xa4)]['findUnique']({'where':{'id':_0x4c5db5},'select':{'gatewaySettings':!![]}});if(!_0x187f9d?.[_0x5ade1d(0x103)])return console[_0x5ade1d(0x15f)](_0x5ade1d(0x74)+_0x4c5db5+_0x5ade1d(0x12a)),0xa;const _0x2ba47c=JSON[_0x5ade1d(0xed)](_0x187f9d[_0x5ade1d(0x103)]);for(const [_0x14019d,_0x259fdc]of Object[_0x5ade1d(0xde)](_0x2ba47c)){if(_0x14019d[_0x5ade1d(0x9d)]()===_0x86be23[_0x5ade1d(0x9d)]()){const _0x46d740=_0x259fdc[_0x5ade1d(0xd2)]||0xa;return console[_0x5ade1d(0x15f)](_0x5ade1d(0x16c)+_0x86be23+_0x5ade1d(0x82)+_0x4c5db5+':\x20'+_0x46d740+'%'),_0x46d740;}}return console[_0x5ade1d(0x15f)]('No\x20specific\x20commission\x20found\x20for\x20gateway\x20'+_0x86be23+'\x20in\x20shop\x20'+_0x4c5db5+_0x5ade1d(0xdb)),0xa;}catch(_0x263f06){return console[_0x5ade1d(0x118)](_0x5ade1d(0x80)+_0x4c5db5+',\x20gateway\x20'+_0x86be23+':',_0x263f06),0xa;}}}exports[a48_0x1e2af2(0xad)]=CoinToPayStatusService,exports[a48_0x1e2af2(0x84)]=new CoinToPayStatusService();