'use strict';const a40_0x2d86ab=a40_0x2805;(function(_0x3385ee,_0x3d4048){const _0x588e01=a40_0x2805,_0x3050df=_0x3385ee();while(!![]){try{const _0x3cd81a=-parseInt(_0x588e01(0x1a6))/0x1+parseInt(_0x588e01(0x187))/0x2*(-parseInt(_0x588e01(0xc9))/0x3)+parseInt(_0x588e01(0x182))/0x4+parseInt(_0x588e01(0xfd))/0x5*(parseInt(_0x588e01(0x12f))/0x6)+-parseInt(_0x588e01(0x1be))/0x7+-parseInt(_0x588e01(0xdd))/0x8+-parseInt(_0x588e01(0xfa))/0x9*(-parseInt(_0x588e01(0xc4))/0xa);if(_0x3cd81a===_0x3d4048)break;else _0x3050df['push'](_0x3050df['shift']());}catch(_0x4fb597){_0x3050df['push'](_0x3050df['shift']());}}}(a40_0x1986,0xb6346));var __importDefault=this&&this[a40_0x2d86ab(0x16b)]||function(_0x1fe235){return _0x1fe235&&_0x1fe235['__esModule']?_0x1fe235:{'default':_0x1fe235};};function a40_0x1986(){const _0x4ea055=['findUnique','\x20days','status_check','\x20commission:\x20','application/json','cointopay_status_check_error','📈\x20[COINTOPAY]\x20Payment\x20','payment','coinToPayService','bankDetails','🧹\x20[DEBUG]\x20Clearing\x20','cointopay2','\x20\x20\x20📍\x20Source:\x20','GLOBAL_CHECK_INTERVAL_MS','gateway','schedule_created','✅\x20[HOURLY]\x20Payment\x20','error','expired','PENDING','5\x20minutes',',\x20stopping\x20individual\x20checks','\x20to\x20clear','sendPaymentStatusNotification','cointopay','transactionId','Automatically\x20expired\x20after\x20','🏦\x20[CHECK]\x20Saved\x20IBAN:\x20','🆔\x20[CHECK]\x20Transaction\x20ID:\x20','getGatewayIdByName','FAILED','findMany','\x20(age:\x20','getPaymentTimerInfo','\x20in\x20','confirmedOn','🧹\x20[DEBUG]\x20Cleared\x20timer\x20#','\x20days\x20(created\x20before\x20','values','getServiceStats','\x20\x20\x20❌\x20Error:\x20','__esModule','🪙\x20[ERROR]\x20CoinToPay\x20Error:\x20','adminNotes','gatewayOrderId','\x20status\x20changed\x20to\x20','Success','❌\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','checkPaymentStatus','__importDefault','\x20timers\x20for\x20payment\x20','currency','amountUSDT','.\x20Remaining\x20active\x20timers:\x20','🪙\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','COINTOPAY_ERROR','📊\x20[CHECK]\x20Payment\x20','✅\x20[DEBUG]\x20Successfully\x20scheduled\x20','stringify','⏰\x20[DEBUG]\x20Scheduled\x20check\x20#','unknown','\x20status:\x20','checkAllPendingPayments','\x20triggered\x20for\x20payment\x20','paymentLink','\x20not\x20enabled\x20for\x20shop\x20','📊\x20[CHECK]\x20CoinToPay\x20payment\x20','\x20\x20\x20-\x20Amount:\x20','checkExpiredPayments','❌\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','status','../types/gateway','4326892ApDwUD',',\x20using\x20default\x20commission\x2010%','type','checkSinglePaymentById','getGatewayCommission','2SGiTRH','2\x20minutes','logCoinToPayError','Webhook\x20event\x20','❌\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','amount','\x20(after\x20','paymentId','🪙\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','📊\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','⏰\x20[EXPIRY]\x20Payment\x20','loggerService','\x20completed\x20for\x20payment\x20','logShopWebhookError',',\x20clearing\x20individual\x20timers','\x20\x20\x20-\x20GatewayPaymentId:\x20','COINTOPAY_STATUS_CHANGE','parse','./currencyService','CoinToPayService','❌\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','SINGLE','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','customerName','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','toFixed','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','🪙\x20[GLOBAL]\x20Found\x20','coinToPay2Service','1186853LzBCqD','schedulePaymentChecks','✅\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','Gateway\x20','\x20current\x20status:\x20','\x20initial\x20timers\x20for\x20payment\x20',',\x20gateway\x20','forEach','Shop\x20webhook\x20sent\x20to\x20','not\x20confirmed','Payment\x20not\x20found','\x20USDT','✅\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','✅\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','length','✅\x20[CHECK]\x20Payment\x20','webhookLog','gatewayCommissionRate','remitterIban','Payment\x20older\x20than\x20','⏰\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','\x20not\x20found\x20in\x20database','floor','🏦\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes','6425769NgepyF','gatewaySettings','❌\x20[HOURLY]\x20Payment\x20','getTime','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','stack','logCoinToPayStatus','EXPIRED','📊\x20[CHECK]\x20CoinToPay2\x20payment\x20','\x20with\x20status\x20','🛑\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','✅\x20[COINTOPAY]\x20Payment\x20link\x20','paidAt','2361740vJtxav','\x20individual\x20payment\x20timers','create','size','\x20marked\x20as\x20paid\x20at:\x20','2048097bkzIuG','message','logWhiteDomainError','now','🪙\x20[TIMER]\x20Individual\x20check\x20#','\x20status\x20is\x20','paid','🧹\x20[CHECK]\x20Payment\x20','update','❌\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','❌\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','\x20status\x20unchanged\x20(','📊\x20[HOURLY]\x20Payment\x20','timestamp','paymentDetails','has','from','log','toLowerCase','❌\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','11390744IxBxWy','not\x20found','\x20\x20\x20Amount:\x20','coinToPayStatusService',',\x20status=','getDate','PAID','\x20found:','shop','❌\x20[CHECK]\x20Payment\x20','\x20->\x20','settings',',\x20currentPayments=','paymentTimers','currentPayments','❌\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','webhookEvents','webhookUrl','\x20\x20\x20-\x20paymentId:\x20','text','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','timers','currencyService','🔍\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','\x20in\x20shop\x20','telegramBotService','⚠️\x20[CHECK]\x20Payment\x20','✅\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','catch','117mKwWHV','⏰\x20[GLOBAL]\x20Payment\x20','default','5ZJPXRZ','\x20\x20\x20Amount\x20after\x20commission:\x20','\x20\x20\x20📝\x20Details:','clearPaymentTimers','includes','paymentLinkId','sendShopWebhook','auto_expire','🪙\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','\x20status\x20from\x20','\x20commission\x20for\x20shop\x20','./loggerService','\x20seconds\x20(','\x20\x20\x20📝\x20Context:','🪙\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','🪙\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','\x20amounts\x20calculated:','\x20days\x20without\x20payment\x20confirmation','\x20has\x20no\x20gatewayPaymentId,\x20skipping','✅\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','\x20\x20\x20📊\x20Status:\x20','set','created',',\x20using\x20default\x2010%','sendPaymentNotification','\x20\x20\x20-\x20gatewayPaymentId:\x20','CoinToPayStatusService','../config/database','description','\x20\x20\x20Gateway\x20','✅\x20[TIMER]\x20Individual\x20check\x20#','webhook_send','EXPIRY_DAYS','gatewayPaymentId','Payment\x20System/1.0','createdAt','\x20for\x20payment\x20','delay','\x20payment\x20','push','globalCheckInterval','payment.failed','createdOn','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','./telegramBotService','iban','🪙\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','cointopay_status_check_','🔍\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','checkSinglePayment','4834122fbBAHw','get','POST','\x20\x20\x20📅\x20Time:\x20','toISOString','shopId','\x20is\x20valid\x20for\x20checking,\x20proceeding...','\x20is\x20older\x20than\x20','Unknown\x20error','checkPaymentById','🪙\x20[DEBUG]\x20Creating\x20'];a40_0x1986=function(){return _0x4ea055;};return a40_0x1986();}Object['defineProperty'](exports,a40_0x2d86ab(0x163),{'value':!![]}),exports[a40_0x2d86ab(0xe0)]=exports[a40_0x2d86ab(0x117)]=void 0x0;const coinToPayService_1=require('./gateways/coinToPayService'),coinToPay2Service_1=require('./gateways/coinToPay2Service'),gateway_1=require(a40_0x2d86ab(0x181)),database_1=__importDefault(require(a40_0x2d86ab(0x118))),telegramBotService_1=require(a40_0x2d86ab(0x129)),loggerService_1=require(a40_0x2d86ab(0x108)),currencyService_1=require(a40_0x2d86ab(0x199));function a40_0x2805(_0x20d800,_0x31bb57){const _0x1986e4=a40_0x1986();return a40_0x2805=function(_0x28051e,_0x1f39d2){_0x28051e=_0x28051e-0xbe;let _0x393b51=_0x1986e4[_0x28051e];return _0x393b51;},a40_0x2805(_0x20d800,_0x31bb57);}class CoinToPayStatusService{constructor(){const _0x3727db=a40_0x2d86ab;this[_0x3727db(0x125)]=null,this['GLOBAL_CHECK_INTERVAL_MS']=0x3c*0x3c*0x3e8,this[_0x3727db(0x11d)]=0x5,this[_0x3727db(0xea)]=new Map(),this[_0x3727db(0x142)]=new coinToPayService_1[(_0x3727db(0x19a))](),this['coinToPay2Service']=new coinToPay2Service_1['CoinToPay2Service'](),console[_0x3727db(0xda)](_0x3727db(0x12b));}[a40_0x2d86ab(0x1a7)](_0x2065bc,_0x128c96){const _0x3d9169=a40_0x2d86ab;console[_0x3d9169(0xda)](_0x3d9169(0x105)),console[_0x3d9169(0xda)](_0x3d9169(0xef)+_0x2065bc),console[_0x3d9169(0xda)](_0x3d9169(0x116)+_0x128c96),this[_0x3d9169(0x100)](_0x2065bc);const _0xd6b314=[],_0x153758=new Date(),_0x34dff1=[{'delay':0x1*0x3c*0x3e8,'description':'1\x20minute'},{'delay':0x2*0x3c*0x3e8,'description':_0x3d9169(0x188)},{'delay':0x5*0x3c*0x3e8,'description':_0x3d9169(0x14e)},{'delay':0x5*0x3c*0x3e8,'description':_0x3d9169(0x14e)}];console[_0x3d9169(0xda)](_0x3d9169(0x139)+_0x34dff1[_0x3d9169(0x1b4)]+_0x3d9169(0x1ab)+_0x2065bc);let _0x2d4fe7=0x0;_0x34dff1[_0x3d9169(0x1ad)]((_0x3e1fa2,_0x3da6da)=>{const _0x598b29=_0x3d9169;_0x2d4fe7+=_0x3e1fa2[_0x598b29(0x122)];const _0x10bb8d=setTimeout(async()=>{const _0x280a2f=_0x598b29;console[_0x280a2f(0xda)](_0x280a2f(0xcd)+(_0x3da6da+0x1)+_0x280a2f(0x179)+_0x2065bc+_0x280a2f(0x18d)+_0x3e1fa2[_0x280a2f(0x119)]+')');try{await this[_0x280a2f(0x185)](_0x2065bc),console[_0x280a2f(0xda)](_0x280a2f(0x11b)+(_0x3da6da+0x1)+_0x280a2f(0x193)+_0x2065bc);}catch(_0x269433){console['error']('❌\x20[TIMER]\x20Failed\x20individual\x20check\x20#'+(_0x3da6da+0x1)+_0x280a2f(0x121)+_0x2065bc+':',_0x269433),this[_0x280a2f(0x189)](_0x2065bc,_0x128c96,_0x269433,_0x280a2f(0x13c),{'checkNumber':_0x3da6da+0x1,'scheduledAfter':_0x3e1fa2[_0x280a2f(0x119)],'isIndividualCheck':!![]});}},_0x2d4fe7);_0xd6b314[_0x598b29(0x124)](_0x10bb8d),console[_0x598b29(0xda)](_0x598b29(0x175)+(_0x3da6da+0x1)+_0x598b29(0x121)+_0x2065bc+_0x598b29(0x15c)+_0x2d4fe7/0x3e8+_0x598b29(0x109)+_0x3e1fa2[_0x598b29(0x119)]+')');});const _0x212d0e=setInterval(async()=>{const _0x120212=_0x3d9169;console[_0x120212(0xda)](_0x120212(0x10b)+_0x2065bc);try{const _0x5f051a=await database_1[_0x120212(0xfc)][_0x120212(0x141)]['findUnique']({'where':{'id':_0x2065bc},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x5f051a){console[_0x120212(0xda)](_0x120212(0x1c0)+_0x2065bc+'\x20not\x20found,\x20clearing\x20timers'),this['clearPaymentTimers'](_0x2065bc);return;}console['log'](_0x120212(0xd5)+_0x2065bc+_0x120212(0x1aa)+_0x5f051a[_0x120212(0x180)]);if(_0x5f051a[_0x120212(0x180)]!==_0x120212(0x14d)){console['log'](_0x120212(0x14a)+_0x2065bc+'\x20status\x20is\x20'+_0x5f051a['status']+_0x120212(0x14f)),this['clearPaymentTimers'](_0x2065bc);return;}const _0x208845=Math[_0x120212(0x1bc)]((Date['now']()-_0x5f051a[_0x120212(0x120)][_0x120212(0x1c1)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x208845>=this[_0x120212(0x11d)]){console[_0x120212(0xda)]('⏰\x20[HOURLY]\x20Payment\x20'+_0x2065bc+'\x20is\x20older\x20than\x20'+this[_0x120212(0x11d)]+_0x120212(0x128)),this[_0x120212(0x100)](_0x2065bc);return;}await this[_0x120212(0x185)](_0x2065bc),console[_0x120212(0xda)](_0x120212(0x110)+_0x2065bc);}catch(_0x10d5e7){console[_0x120212(0x14b)](_0x120212(0x18b)+_0x2065bc+':',_0x10d5e7),this[_0x120212(0x189)](_0x2065bc,_0x128c96,_0x10d5e7,_0x120212(0x13c),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0xd6b314[_0x3d9169(0x124)](_0x212d0e),this[_0x3d9169(0xea)][_0x3d9169(0x112)](_0x2065bc,{'timers':_0xd6b314,'paymentId':_0x2065bc,'gatewayPaymentId':_0x128c96,'createdAt':_0x153758}),console[_0x3d9169(0xda)](_0x3d9169(0x173)+_0x34dff1[_0x3d9169(0x1b4)]+_0x3d9169(0xf1)+_0x2065bc),console[_0x3d9169(0xda)](_0x3d9169(0x190)+this[_0x3d9169(0xea)][_0x3d9169(0xc7)]),this[_0x3d9169(0x1c4)](_0x2065bc,_0x128c96,_0x3d9169(0x14d),_0x3d9169(0x14d),'status_check',{'action':_0x3d9169(0x149),'scheduledChecks':_0x34dff1[_0x3d9169(0x1b4)],'firstCheckIn':_0x34dff1[0x0][_0x3d9169(0x122)]/0x3e8,'totalTimers':this[_0x3d9169(0xea)][_0x3d9169(0xc7)]});}[a40_0x2d86ab(0x100)](_0x3da3de){const _0x2697dd=a40_0x2d86ab,_0x33179a=this[_0x2697dd(0xea)][_0x2697dd(0x130)](_0x3da3de);_0x33179a?(console[_0x2697dd(0xda)](_0x2697dd(0x144)+_0x33179a[_0x2697dd(0xf2)][_0x2697dd(0x1b4)]+_0x2697dd(0x16c)+_0x3da3de),_0x33179a[_0x2697dd(0xf2)]['forEach']((_0x269d06,_0x59e18b)=>{const _0x574862=_0x2697dd;_0x269d06&&(clearTimeout(_0x269d06),clearInterval(_0x269d06),console[_0x574862(0xda)](_0x574862(0x15e)+(_0x59e18b+0x1)+'\x20for\x20payment\x20'+_0x3da3de));}),this[_0x2697dd(0xea)]['delete'](_0x3da3de),console['log']('✅\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20'+_0x3da3de+_0x2697dd(0x16f)+this[_0x2697dd(0xea)][_0x2697dd(0xc7)])):console['log']('⚠️\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20'+_0x3da3de+_0x2697dd(0x150));}async[a40_0x2d86ab(0x185)](_0x318f98){const _0x4b1571=a40_0x2d86ab;console[_0x4b1571(0xda)](_0x4b1571(0xf4)+_0x318f98);const _0x186f5c=await database_1[_0x4b1571(0xfc)]['payment'][_0x4b1571(0x13a)]({'where':{'id':_0x318f98},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x186f5c){console[_0x4b1571(0xda)](_0x4b1571(0xe6)+_0x318f98+_0x4b1571(0x1bb));return;}console['log'](_0x4b1571(0x172)+_0x318f98+_0x4b1571(0xe4)),console[_0x4b1571(0xda)]('\x20\x20\x20-\x20Gateway:\x20'+_0x186f5c[_0x4b1571(0x148)]),console[_0x4b1571(0xda)]('\x20\x20\x20-\x20Status:\x20'+_0x186f5c[_0x4b1571(0x180)]),console[_0x4b1571(0xda)](_0x4b1571(0x196)+_0x186f5c[_0x4b1571(0x11e)]),console[_0x4b1571(0xda)](_0x4b1571(0x17d)+_0x186f5c[_0x4b1571(0x18c)]+'\x20'+_0x186f5c['currency']),console['log']('\x20\x20\x20-\x20ShopId:\x20'+_0x186f5c[_0x4b1571(0x134)]);if(_0x186f5c[_0x4b1571(0x148)]!==_0x4b1571(0x152)&&_0x186f5c[_0x4b1571(0x148)]!==_0x4b1571(0x145)){console[_0x4b1571(0xda)](_0x4b1571(0xf7)+_0x318f98+'\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20'+_0x186f5c[_0x4b1571(0x148)]+')');return;}if(_0x186f5c['status']!==_0x4b1571(0x14d)){console['log']('⚠️\x20[CHECK]\x20Payment\x20'+_0x318f98+_0x4b1571(0xce)+_0x186f5c['status']+_0x4b1571(0x14f)),this['clearPaymentTimers'](_0x318f98);return;}if(!_0x186f5c[_0x4b1571(0x11e)]){console[_0x4b1571(0xda)](_0x4b1571(0xf7)+_0x318f98+'\x20has\x20no\x20gatewayPaymentId');return;}console[_0x4b1571(0xda)]('✅\x20[CHECK]\x20Payment\x20'+_0x318f98+_0x4b1571(0x135)),await this['checkSinglePayment'](_0x186f5c);}[a40_0x2d86ab(0x1c4)](_0x2da79d,_0x49b5ca,_0x226c61,_0x405bc2,_0x583cad,_0x5b0290){const _0x4566c5=a40_0x2d86ab,_0x9df0bc={'type':_0x4566c5(0x197),'paymentId':_0x2da79d,'gatewayPaymentId':_0x49b5ca,'oldStatus':_0x226c61,'newStatus':_0x405bc2,'source':_0x583cad,'timestamp':new Date()['toISOString'](),'details':_0x5b0290||{}};loggerService_1[_0x4566c5(0x192)][_0x4566c5(0x1c4)](_0x9df0bc),console[_0x4566c5(0xda)](_0x4566c5(0x10c)+_0x2da79d+'\x20('+_0x49b5ca+')'),console[_0x4566c5(0xda)](_0x4566c5(0x111)+_0x226c61+_0x4566c5(0xe7)+_0x405bc2),console['log'](_0x4566c5(0x146)+_0x583cad),console['log'](_0x4566c5(0x132)+_0x9df0bc['timestamp']),_0x5b0290&&console[_0x4566c5(0xda)](_0x4566c5(0xff),_0x5b0290);}[a40_0x2d86ab(0x189)](_0x40c3e0,_0x4d301a,_0x5e4518,_0x2d780e,_0x2ad1fa){const _0x5d7bf6=a40_0x2d86ab,_0x50fd29={'type':_0x5d7bf6(0x171),'paymentId':_0x40c3e0,'gatewayPaymentId':_0x4d301a,'error':_0x5e4518 instanceof Error?{'message':_0x5e4518['message'],'stack':_0x5e4518[_0x5d7bf6(0x1c3)]}:_0x5e4518,'source':_0x2d780e,'timestamp':new Date()[_0x5d7bf6(0x133)](),'context':_0x2ad1fa||{}};loggerService_1['loggerService']['logCoinToPayError'](_0x50fd29),console['error'](_0x5d7bf6(0x164)+_0x40c3e0+'\x20('+_0x4d301a+')'),console['error'](_0x5d7bf6(0x162)+(_0x5e4518 instanceof Error?_0x5e4518[_0x5d7bf6(0xca)]:_0x5e4518)),console[_0x5d7bf6(0x14b)](_0x5d7bf6(0x146)+_0x2d780e),console['error'](_0x5d7bf6(0x132)+_0x50fd29[_0x5d7bf6(0xd6)]),_0x2ad1fa&&console[_0x5d7bf6(0x14b)](_0x5d7bf6(0x10a),_0x2ad1fa);}['startPeriodicStatusCheck'](){const _0xd80b3d=a40_0x2d86ab;console[_0xd80b3d(0xda)]('🪙\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)'),this[_0xd80b3d(0x178)]()[_0xd80b3d(0xf9)](_0x434221=>{const _0x34f5c6=_0xd80b3d;console[_0x34f5c6(0x14b)](_0x34f5c6(0x19b),_0x434221);}),this[_0xd80b3d(0x125)]=setInterval(async()=>{const _0x55052c=_0xd80b3d;try{console[_0x55052c(0xda)](_0x55052c(0x18f)),await this[_0x55052c(0x178)](),console[_0x55052c(0xda)](_0x55052c(0x1b3));}catch(_0x2d612e){console['error'](_0x55052c(0xd2),_0x2d612e);}},this[_0xd80b3d(0x147)]),console[_0xd80b3d(0xda)]('✅\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)');}['stopPeriodicStatusCheck'](){const _0x58e7a3=a40_0x2d86ab;console['log']('🛑\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...');this[_0x58e7a3(0x125)]&&(clearInterval(this[_0x58e7a3(0x125)]),this[_0x58e7a3(0x125)]=null,console[_0x58e7a3(0xda)](_0x58e7a3(0xc1)));const _0x251eb4=this['paymentTimers'][_0x58e7a3(0xc7)];for(const [_0x322db3]of this['paymentTimers']){this[_0x58e7a3(0x100)](_0x322db3);}console[_0x58e7a3(0xda)]('🛑\x20[SHUTDOWN]\x20Cleared\x20'+_0x251eb4+_0x58e7a3(0xc5));}async['checkAllPendingPayments'](){const _0x571cb1=a40_0x2d86ab;try{console['log']('🪙\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...');const _0x4b81ba=await database_1['default'][_0x571cb1(0x141)][_0x571cb1(0x159)]({'where':{'gateway':{'in':['cointopay',_0x571cb1(0x145)]},'status':'PENDING','gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x571cb1(0xda)](_0x571cb1(0x1a4)+_0x4b81ba['length']+'\x20pending\x20CoinToPay\x20payments');if(_0x4b81ba[_0x571cb1(0x1b4)]===0x0){console[_0x571cb1(0xda)](_0x571cb1(0x170));return;}const _0x21e1fe=await this[_0x571cb1(0x17e)](_0x4b81ba);console['log']('⏰\x20[GLOBAL]\x20Found\x20'+_0x21e1fe['length']+'\x20expired\x20CoinToPay\x20payments');let _0x37b2d6=0x0,_0x423278=0x0;for(const _0x4e6262 of _0x4b81ba){try{if(_0x21e1fe['includes'](_0x4e6262['id'])){console[_0x571cb1(0xda)](_0x571cb1(0xfb)+_0x4e6262['id']+_0x571cb1(0x1c2)),_0x423278++;continue;}if(this['paymentTimers'][_0x571cb1(0xd8)](_0x4e6262['id'])){console[_0x571cb1(0xda)](_0x571cb1(0xfb)+_0x4e6262['id']+'\x20has\x20individual\x20timers,\x20skipping\x20global\x20check'),_0x423278++;continue;}const _0x198a16=(Date[_0x571cb1(0xcc)]()-_0x4e6262['createdAt'][_0x571cb1(0x1c1)]())/(0x3e8*0x3c*0x3c);if(_0x198a16<0x1){console[_0x571cb1(0xda)](_0x571cb1(0xfb)+_0x4e6262['id']+'\x20is\x20too\x20new\x20('+_0x198a16[_0x571cb1(0x1a1)](0x1)+'h),\x20skipping\x20global\x20check'),_0x423278++;continue;}console['log'](_0x571cb1(0x12d)+_0x4e6262['id']+_0x571cb1(0x15a)+_0x198a16[_0x571cb1(0x1a1)](0x1)+'h)'),await this[_0x571cb1(0x12e)](_0x4e6262),_0x37b2d6++,await new Promise(_0x3838e4=>setTimeout(_0x3838e4,0x7d0));}catch(_0x2ffb0a){console[_0x571cb1(0x14b)](_0x571cb1(0xec)+_0x4e6262['id']+':',_0x2ffb0a),this[_0x571cb1(0x189)](_0x4e6262['id'],_0x4e6262[_0x571cb1(0x11e)]||'unknown',_0x2ffb0a,_0x571cb1(0x13c),{'isGlobalCheck':!![],'paymentAmount':_0x4e6262[_0x571cb1(0x18c)],'paymentCurrency':_0x4e6262[_0x571cb1(0x16d)],'shopId':_0x4e6262['shopId'],'createdAt':_0x4e6262[_0x571cb1(0x120)]}),loggerService_1[_0x571cb1(0x192)][_0x571cb1(0xcb)](_0x571cb1(0x152),'/status/'+_0x4e6262[_0x571cb1(0x11e)],_0x2ffb0a);}}console[_0x571cb1(0xda)](_0x571cb1(0x1b2)+_0x37b2d6+'\x20checked,\x20'+_0x423278+'\x20skipped,\x20'+_0x21e1fe[_0x571cb1(0x1b4)]+'\x20expired');}catch(_0x9349b2){console['error'](_0x571cb1(0x169),_0x9349b2);}}async[a40_0x2d86ab(0x17e)](_0x338655){const _0x1efbfa=a40_0x2d86ab,_0x315a7e=[],_0x1f1ff1=new Date();_0x1f1ff1['setDate'](_0x1f1ff1[_0x1efbfa(0xe2)]()-this[_0x1efbfa(0x11d)]),console[_0x1efbfa(0xda)](_0x1efbfa(0x1ba)+this['EXPIRY_DAYS']+_0x1efbfa(0x15f)+_0x1f1ff1['toISOString']()+')');for(const _0x146134 of _0x338655){if(_0x146134[_0x1efbfa(0x120)]<_0x1f1ff1){console[_0x1efbfa(0xda)](_0x1efbfa(0x191)+_0x146134['id']+_0x1efbfa(0x136)+this[_0x1efbfa(0x11d)]+'\x20days,\x20marking\x20as\x20EXPIRED');try{this[_0x1efbfa(0x1c4)](_0x146134['id'],_0x146134[_0x1efbfa(0x11e)]||_0x1efbfa(0x176),'PENDING',_0x1efbfa(0xbe),_0x1efbfa(0x104),{'reason':_0x1efbfa(0x1b9)+this[_0x1efbfa(0x11d)]+_0x1efbfa(0x13b),'createdAt':_0x146134[_0x1efbfa(0x120)],'daysSinceCreation':Math[_0x1efbfa(0x1bc)]((Date[_0x1efbfa(0xcc)]()-_0x146134['createdAt']['getTime']())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x146134[_0x1efbfa(0x18c)],'paymentCurrency':_0x146134[_0x1efbfa(0x16d)],'shopId':_0x146134['shopId']}),await database_1[_0x1efbfa(0xfc)][_0x1efbfa(0x141)][_0x1efbfa(0xd1)]({'where':{'id':_0x146134['id']},'data':{'status':_0x1efbfa(0xbe),'updatedAt':new Date(),'adminNotes':_0x1efbfa(0x154)+this['EXPIRY_DAYS']+_0x1efbfa(0x10e)}}),await database_1[_0x1efbfa(0xfc)][_0x1efbfa(0x1b6)][_0x1efbfa(0xc6)]({'data':{'paymentId':_0x146134['id'],'shopId':_0x146134[_0x1efbfa(0x134)],'event':'cointopay_auto_expired','statusCode':0xc8,'responseBody':JSON[_0x1efbfa(0x174)]({'reason':_0x1efbfa(0x1b9)+this['EXPIRY_DAYS']+_0x1efbfa(0x13b),'createdAt':_0x146134[_0x1efbfa(0x120)],'expiredAt':new Date()[_0x1efbfa(0x133)](),'daysSinceCreation':Math[_0x1efbfa(0x1bc)]((Date['now']()-_0x146134[_0x1efbfa(0x120)][_0x1efbfa(0x1c1)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x1efbfa(0x103)](_0x146134,_0x1efbfa(0xbe)),await this[_0x1efbfa(0x151)](_0x146134,_0x1efbfa(0xbe)),this[_0x1efbfa(0x100)](_0x146134['id']),_0x315a7e['push'](_0x146134['id']),console[_0x1efbfa(0xda)]('✅\x20[EXPIRY]\x20Payment\x20'+_0x146134['id']+_0x1efbfa(0x1a3)+this['EXPIRY_DAYS']+'-day\x20timeout');}catch(_0x6537a4){console[_0x1efbfa(0x14b)](_0x1efbfa(0xd3)+_0x146134['id']+':',_0x6537a4),this[_0x1efbfa(0x189)](_0x146134['id'],_0x146134['gatewayPaymentId']||'unknown',_0x6537a4,_0x1efbfa(0x104),{'reason':'Failed\x20to\x20mark\x20payment\x20as\x20expired','createdAt':_0x146134[_0x1efbfa(0x120)],'daysSinceCreation':Math['floor']((Date['now']()-_0x146134[_0x1efbfa(0x120)][_0x1efbfa(0x1c1)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x315a7e;}async[a40_0x2d86ab(0x12e)](_0x3eb9cd){const _0xc59960=a40_0x2d86ab;if(!_0x3eb9cd[_0xc59960(0x11e)]){console[_0xc59960(0xda)](_0xc59960(0xf7)+_0x3eb9cd['id']+_0xc59960(0x10f));return;}console['log']('🔍\x20[CHECK]\x20Checking\x20'+_0x3eb9cd['gateway']+_0xc59960(0x123)+_0x3eb9cd['id']+'\x20('+_0x3eb9cd['gatewayPaymentId']+')');try{let _0x83026d;_0x3eb9cd['gateway']===_0xc59960(0x145)?(_0x83026d=await this[_0xc59960(0x1a5)]['checkPaymentStatus'](_0x3eb9cd[_0xc59960(0x11e)]),console['log'](_0xc59960(0xbf)+_0x3eb9cd['id']+_0xc59960(0x177)+_0x83026d[_0xc59960(0x180)])):(_0x83026d=await this[_0xc59960(0x142)][_0xc59960(0x16a)](_0x3eb9cd[_0xc59960(0x11e)]),console[_0xc59960(0xda)](_0xc59960(0x17c)+_0x3eb9cd['id']+'\x20status:\x20'+_0x83026d[_0xc59960(0x180)]));_0x83026d[_0xc59960(0xd7)]&&console[_0xc59960(0xda)](_0xc59960(0x172)+_0x3eb9cd['id']+'\x20details:',{'iban':_0x83026d['paymentDetails'][_0xc59960(0x12a)]||_0xc59960(0xde),'transactionId':_0x83026d[_0xc59960(0xd7)][_0xc59960(0x153)],'createdOn':_0x83026d[_0xc59960(0xd7)][_0xc59960(0x127)],'confirmedOn':_0x83026d['paymentDetails'][_0xc59960(0x15d)]||_0xc59960(0x1af)});if(_0x83026d[_0xc59960(0x180)]!==_0x3eb9cd[_0xc59960(0x180)]){console[_0xc59960(0xda)]('🔄\x20[CHECK]\x20Updating\x20payment\x20'+_0x3eb9cd['id']+_0xc59960(0x106)+_0x3eb9cd[_0xc59960(0x180)]+'\x20to\x20'+_0x83026d[_0xc59960(0x180)]),this[_0xc59960(0x1c4)](_0x3eb9cd['id'],_0x3eb9cd[_0xc59960(0x11e)],_0x3eb9cd[_0xc59960(0x180)],_0x83026d[_0xc59960(0x180)],_0xc59960(0x13c),{'paymentDetails':_0x83026d['paymentDetails'],'amount':_0x83026d[_0xc59960(0x18c)],'currency':_0x83026d['currency'],'shopId':_0x3eb9cd[_0xc59960(0x134)],'checkTimestamp':new Date()['toISOString']()});const _0x116cfc={'status':_0x83026d[_0xc59960(0x180)],'updatedAt':new Date()};if(_0x83026d[_0xc59960(0x180)]===_0xc59960(0xe3)&&_0x3eb9cd[_0xc59960(0x180)]!==_0xc59960(0xe3)){_0x116cfc[_0xc59960(0xc3)]=new Date();if(!_0x3eb9cd[_0xc59960(0x16e)]){const _0x53444b=await currencyService_1[_0xc59960(0xf3)]['convertToUSDT'](_0x3eb9cd[_0xc59960(0x18c)],_0x3eb9cd[_0xc59960(0x16d)]);_0x116cfc[_0xc59960(0x16e)]=_0x53444b;const _0x4bdca2=await this['getGatewayCommission'](_0x3eb9cd[_0xc59960(0x134)],_0x3eb9cd['gateway']),_0x515654=_0x53444b*(0x1-_0x4bdca2/0x64);_0x116cfc['amountAfterGatewayCommissionUSDT']=_0x515654,_0x116cfc[_0xc59960(0x1b7)]=_0x4bdca2,console['log']('💰\x20[CHECK]\x20Payment\x20'+_0x3eb9cd['id']+_0xc59960(0x10d)),console[_0xc59960(0xda)](_0xc59960(0xdf)+_0x3eb9cd[_0xc59960(0x18c)]+'\x20'+_0x3eb9cd[_0xc59960(0x16d)]+_0xc59960(0xe7)+_0x53444b[_0xc59960(0x1a1)](0x6)+_0xc59960(0x1b1)),console[_0xc59960(0xda)](_0xc59960(0x11a)+_0x3eb9cd[_0xc59960(0x148)]+_0xc59960(0x13d)+_0x4bdca2+'%'),console[_0xc59960(0xda)](_0xc59960(0xfe)+_0x515654[_0xc59960(0x1a1)](0x6)+_0xc59960(0x1b1));}console[_0xc59960(0xda)]('💰\x20[CHECK]\x20Payment\x20'+_0x3eb9cd['id']+_0xc59960(0xc8)+_0x116cfc[_0xc59960(0xc3)][_0xc59960(0x133)]());}if(_0x83026d['paymentDetails']){const _0x352b97=_0x83026d[_0xc59960(0xd7)];_0x352b97[_0xc59960(0x12a)]&&(_0x116cfc[_0xc59960(0x1b8)]=_0x352b97[_0xc59960(0x12a)],console[_0xc59960(0xda)](_0xc59960(0x155)+_0x352b97[_0xc59960(0x12a)]));if(_0x352b97[_0xc59960(0x143)]){const _0x25b2c8=_0x3eb9cd['adminNotes']||'',_0x61af2e='Bank\x20Details:\x20'+_0x352b97[_0xc59960(0x143)];_0x116cfc[_0xc59960(0x165)]=_0x25b2c8?_0x25b2c8+'\x0a\x0a'+_0x61af2e:_0x61af2e,console[_0xc59960(0xda)](_0xc59960(0x1bd));}_0x352b97[_0xc59960(0x153)]&&console[_0xc59960(0xda)](_0xc59960(0x156)+_0x352b97[_0xc59960(0x153)]),_0x352b97[_0xc59960(0x15d)]&&console['log'](_0xc59960(0xf8)+_0x352b97[_0xc59960(0x15d)]);}await database_1['default'][_0xc59960(0x141)]['update']({'where':{'id':_0x3eb9cd['id']},'data':_0x116cfc});if(_0x83026d[_0xc59960(0x180)]==='PAID'&&_0x3eb9cd['status']!=='PAID'){console[_0xc59960(0xda)]('📈\x20[COINTOPAY]\x20Payment\x20'+_0x3eb9cd['id']+_0xc59960(0x19d));const _0x128021=await database_1[_0xc59960(0xfc)][_0xc59960(0x141)]['findUnique']({'where':{'id':_0x3eb9cd['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x128021?.[_0xc59960(0x102)]&&_0x128021[_0xc59960(0x17a)])try{const _0x531dc5=_0x128021[_0xc59960(0x17a)];console[_0xc59960(0xda)]('📈\x20[COINTOPAY]\x20Found\x20payment\x20link\x20'+_0x531dc5['id']+':\x20type='+_0x531dc5[_0xc59960(0x184)]+_0xc59960(0xe9)+_0x531dc5[_0xc59960(0xeb)]+_0xc59960(0xe1)+_0x531dc5['status']);const _0x15c46e=_0x531dc5[_0xc59960(0xeb)]+0x1,_0x1bc741=_0x531dc5['type']===_0xc59960(0x19c)?'COMPLETED':_0x531dc5['status'];await database_1[_0xc59960(0xfc)][_0xc59960(0x17a)][_0xc59960(0xd1)]({'where':{'id':_0x531dc5['id']},'data':{'currentPayments':_0x15c46e,'status':_0x1bc741,'updatedAt':new Date()}}),console[_0xc59960(0xda)](_0xc59960(0xc2)+_0x531dc5['id']+'\x20updated:\x20currentPayments='+_0x531dc5[_0xc59960(0xeb)]+_0xc59960(0xe7)+_0x15c46e+',\x20status='+_0x531dc5['status']+_0xc59960(0xe7)+_0x1bc741);}catch(_0x9687c9){console['error'](_0xc59960(0x17f),_0x9687c9);}else console[_0xc59960(0xda)](_0xc59960(0x140)+_0x3eb9cd['id']+'\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link');}await database_1[_0xc59960(0xfc)][_0xc59960(0x1b6)][_0xc59960(0xc6)]({'data':{'paymentId':_0x3eb9cd['id'],'shopId':_0x3eb9cd['shopId'],'event':_0xc59960(0x12c)+_0x83026d['status'][_0xc59960(0xdb)](),'statusCode':0xc8,'responseBody':JSON[_0xc59960(0x174)]({'oldStatus':_0x3eb9cd[_0xc59960(0x180)],'newStatus':_0x83026d['status'],'paymentDetails':_0x83026d['paymentDetails'],'checkedAt':new Date()[_0xc59960(0x133)]()})}}),await this[_0xc59960(0x103)](_0x3eb9cd,_0x83026d[_0xc59960(0x180)]),await this[_0xc59960(0x151)](_0x3eb9cd,_0x83026d[_0xc59960(0x180)]),_0x83026d[_0xc59960(0x180)]!=='PENDING'&&(console['log'](_0xc59960(0xd0)+_0x3eb9cd['id']+_0xc59960(0x167)+_0x83026d[_0xc59960(0x180)]+_0xc59960(0x195)),this[_0xc59960(0x100)](_0x3eb9cd['id'])),console[_0xc59960(0xda)](_0xc59960(0x1b5)+_0x3eb9cd['id']+'\x20updated\x20successfully');}else console['log']('📊\x20[CHECK]\x20Payment\x20'+_0x3eb9cd['id']+_0xc59960(0xd4)+_0x83026d[_0xc59960(0x180)]+')'),this['logCoinToPayStatus'](_0x3eb9cd['id'],_0x3eb9cd[_0xc59960(0x11e)],_0x3eb9cd['status'],_0x83026d[_0xc59960(0x180)],'status_check',{'statusUnchanged':!![],'paymentDetails':_0x83026d['paymentDetails'],'amount':_0x83026d[_0xc59960(0x18c)],'currency':_0x83026d[_0xc59960(0x16d)],'shopId':_0x3eb9cd[_0xc59960(0x134)],'checkTimestamp':new Date()[_0xc59960(0x133)]()});}catch(_0x12ce2c){console[_0xc59960(0x14b)](_0xc59960(0xdc)+_0x3eb9cd['id']+':',_0x12ce2c),this['logCoinToPayError'](_0x3eb9cd['id'],_0x3eb9cd[_0xc59960(0x11e)],_0x12ce2c,_0xc59960(0x13c),{'paymentAmount':_0x3eb9cd[_0xc59960(0x18c)],'paymentCurrency':_0x3eb9cd[_0xc59960(0x16d)],'shopId':_0x3eb9cd[_0xc59960(0x134)],'createdAt':_0x3eb9cd[_0xc59960(0x120)]}),await database_1['default'][_0xc59960(0x1b6)][_0xc59960(0xc6)]({'data':{'paymentId':_0x3eb9cd['id'],'shopId':_0x3eb9cd[_0xc59960(0x134)],'event':_0xc59960(0x13f),'statusCode':0x1f4,'responseBody':JSON['stringify']({'error':_0x12ce2c instanceof Error?_0x12ce2c[_0xc59960(0xca)]:_0xc59960(0x137),'gatewayPaymentId':_0x3eb9cd['gatewayPaymentId'],'checkedAt':new Date()[_0xc59960(0x133)]()})}});}}async[a40_0x2d86ab(0x103)](_0x2a8293,_0x364448){const _0x391b09=a40_0x2d86ab,_0x36a411=Date[_0x391b09(0xcc)]();try{const _0x48faf5=_0x2a8293[_0x391b09(0xe5)],_0x95025d=_0x48faf5[_0x391b09(0xe8)];if(!_0x95025d?.[_0x391b09(0xee)]){console[_0x391b09(0xda)](_0x391b09(0x1a0)+_0x48faf5['id']);return;}const _0x4c8f51=_0x364448===_0x391b09(0xe3)?'payment.success':_0x364448===_0x391b09(0x158)?_0x391b09(0x126):_0x364448===_0x391b09(0xbe)?_0x391b09(0x126):'payment.pending';if(!_0x95025d[_0x391b09(0xed)]?.[_0x391b09(0x101)](_0x4c8f51)){console['log'](_0x391b09(0x18a)+_0x4c8f51+_0x391b09(0x17b)+_0x48faf5['id']);return;}const _0x1275bd=(0x0,gateway_1[_0x391b09(0x157)])(_0x2a8293[_0x391b09(0x148)])||_0x2a8293[_0x391b09(0x148)],_0x9604df={'event':_0x4c8f51,'payment':{'id':_0x2a8293['id'],'order_id':_0x2a8293['orderId'],'gateway_order_id':_0x2a8293[_0x391b09(0x166)],'gateway':_0x1275bd,'amount':_0x2a8293[_0x391b09(0x18c)],'currency':_0x2a8293[_0x391b09(0x16d)],'status':_0x364448['toLowerCase'](),'customer_email':_0x2a8293['customerEmail'],'customer_name':_0x2a8293[_0x391b09(0x19e)],'created_at':_0x2a8293['createdAt'],'updated_at':new Date()}},_0x105226=await fetch(_0x95025d[_0x391b09(0xee)],{'method':_0x391b09(0x131),'headers':{'Content-Type':_0x391b09(0x13e),'User-Agent':_0x391b09(0x11f)},'body':JSON[_0x391b09(0x174)](_0x9604df)}),_0x420017=Date['now']()-_0x36a411,_0x3d80bb=_0x105226['ok']?_0x391b09(0x168):await _0x105226[_0x391b09(0xf0)]();loggerService_1[_0x391b09(0x192)]['logShopWebhookSent'](_0x2a8293['shopId'],_0x95025d[_0x391b09(0xee)],_0x4c8f51,_0x105226[_0x391b09(0x180)],_0x420017,_0x9604df),console[_0x391b09(0xda)](_0x391b09(0x1ae)+_0x95025d[_0x391b09(0xee)]+_0x391b09(0xc0)+_0x105226[_0x391b09(0x180)]+'\x20('+_0x420017+'ms)');}catch(_0x4ca760){console[_0x391b09(0x14b)]('Failed\x20to\x20send\x20shop\x20webhook:',_0x4ca760),loggerService_1[_0x391b09(0x192)][_0x391b09(0x194)](_0x2a8293[_0x391b09(0x134)],_0x2a8293[_0x391b09(0xe5)]?.[_0x391b09(0xe8)]?.['webhookUrl']||'unknown',_0x391b09(0x11c),_0x4ca760,{});}}async[a40_0x2d86ab(0x151)](_0x12be97,_0x28b344){const _0x4ce251=a40_0x2d86ab;try{const _0x3eb7d6={'PENDING':_0x4ce251(0x113),'PAID':_0x4ce251(0xcf),'FAILED':'failed','EXPIRED':_0x4ce251(0x14c)},_0x1982c6=_0x3eb7d6[_0x28b344];if(!_0x1982c6||_0x1982c6===_0x4ce251(0x113))return;await telegramBotService_1[_0x4ce251(0xf6)][_0x4ce251(0x115)](_0x12be97[_0x4ce251(0x134)],_0x12be97,_0x1982c6);}catch(_0x263c68){console[_0x4ce251(0x14b)]('Failed\x20to\x20send\x20Telegram\x20payment\x20notification:',_0x263c68);}}async[a40_0x2d86ab(0x138)](_0x3a7093){const _0x1aa86a=a40_0x2d86ab;console['log']('🔍\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20'+_0x3a7093);const _0xa67f44=await database_1[_0x1aa86a(0xfc)][_0x1aa86a(0x141)]['findUnique']({'where':{'id':_0x3a7093},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0xa67f44)throw new Error(_0x1aa86a(0x1b0));if(_0xa67f44[_0x1aa86a(0x148)]!==_0x1aa86a(0x152)&&_0xa67f44[_0x1aa86a(0x148)]!=='cointopay2')throw new Error(_0x1aa86a(0x19f));console[_0x1aa86a(0xda)](_0x1aa86a(0x1a8)+_0xa67f44[_0x1aa86a(0x148)]+_0x1aa86a(0x123)+_0x3a7093),await this[_0x1aa86a(0x12e)](_0xa67f44),console['log']('✅\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20'+_0x3a7093);}[a40_0x2d86ab(0x161)](){const _0x433440=a40_0x2d86ab,_0x57f20a=this[_0x433440(0x125)]?this[_0x433440(0x147)]:undefined,_0x3f3878=Array[_0x433440(0xd9)](this['paymentTimers'][_0x433440(0x160)]())['map'](_0x4100fd=>({'paymentId':_0x4100fd[_0x433440(0x18e)],'gatewayPaymentId':_0x4100fd[_0x433440(0x11e)],'createdAt':_0x4100fd[_0x433440(0x120)],'timersCount':_0x4100fd[_0x433440(0xf2)]['length']}));return{'isActive':!!this[_0x433440(0x125)],'globalCheckIntervalMinutes':this[_0x433440(0x147)]/(0x3e8*0x3c),'expiryDays':this['EXPIRY_DAYS'],'activeIndividualTimers':this[_0x433440(0xea)][_0x433440(0xc7)],'nextGlobalCheckIn':_0x57f20a,'paymentTimersDetails':_0x3f3878};}[a40_0x2d86ab(0x15b)](_0x5d0d0d){const _0x170612=a40_0x2d86ab,_0x1cba52=this['paymentTimers'][_0x170612(0x130)](_0x5d0d0d);if(_0x1cba52)return{'hasTimers':!![],'timersCount':_0x1cba52[_0x170612(0xf2)][_0x170612(0x1b4)],'createdAt':_0x1cba52[_0x170612(0x120)],'gatewayPaymentId':_0x1cba52[_0x170612(0x11e)]};return{'hasTimers':![]};}async[a40_0x2d86ab(0x186)](_0x1c87dc,_0x452e99){const _0x55d443=a40_0x2d86ab;try{const _0x3e91d4=await database_1[_0x55d443(0xfc)][_0x55d443(0xe5)][_0x55d443(0x13a)]({'where':{'id':_0x1c87dc},'select':{'gatewaySettings':!![]}});if(!_0x3e91d4?.[_0x55d443(0x1bf)])return console[_0x55d443(0xda)]('No\x20gateway\x20settings\x20found\x20for\x20shop\x20'+_0x1c87dc+_0x55d443(0x183)),0xa;const _0x3e3ba3=JSON[_0x55d443(0x198)](_0x3e91d4[_0x55d443(0x1bf)]);for(const [_0x3c4af7,_0x92e6c1]of Object['entries'](_0x3e3ba3)){if(_0x3c4af7[_0x55d443(0xdb)]()===_0x452e99['toLowerCase']()){const _0x5b4aae=_0x92e6c1['commission']||0xa;return console[_0x55d443(0xda)](_0x55d443(0x1a9)+_0x452e99+_0x55d443(0x107)+_0x1c87dc+':\x20'+_0x5b4aae+'%'),_0x5b4aae;}}return console['log']('No\x20specific\x20commission\x20found\x20for\x20gateway\x20'+_0x452e99+_0x55d443(0xf5)+_0x1c87dc+_0x55d443(0x114)),0xa;}catch(_0x5790cd){return console[_0x55d443(0x14b)](_0x55d443(0x1a2)+_0x1c87dc+_0x55d443(0x1ac)+_0x452e99+':',_0x5790cd),0xa;}}}exports[a40_0x2d86ab(0x117)]=CoinToPayStatusService,exports[a40_0x2d86ab(0xe0)]=new CoinToPayStatusService();