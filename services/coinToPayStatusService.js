'use strict';const a40_0x1a0441=a40_0x4fe9;function a40_0x46ce(){const _0x5d2a78=['\x20\x20\x20📝\x20Context:','.\x20Remaining\x20active\x20timers:\x20','🧹\x20[DEBUG]\x20Clearing\x20','❌\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','paidAt','✅\x20[TIMER]\x20Individual\x20check\x20#','../config/database','includes','\x20to\x20','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','\x20marked\x20as\x20paid\x20at:\x20','💰\x20[CHECK]\x20Payment\x20','\x20->\x20','✅\x20[DEBUG]\x20Successfully\x20scheduled\x20','paymentId','Gateway\x20','🪙\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','./telegramBotService','currencyService','logShopWebhookSent','currency','GLOBAL_CHECK_INTERVAL_MS','bankDetails','32BpYOUB','expired','remitterIban','set','toFixed','transactionId','6310835ukhwCV','✅\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','coinToPay2Service','11700BOaIaT','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','unknown','COMPLETED','getServiceStats','toLowerCase','🪙\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','❌\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','delete','\x20with\x20status\x20','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','parse','\x20for\x20payment\x20','paymentLink','\x20updated\x20successfully','shop','🪙\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','cointopay_status_check_error','not\x20found','✅\x20[HOURLY]\x20Payment\x20',',\x20currentPayments=','\x20initial\x20timers\x20for\x20payment\x20','Payment\x20not\x20found','\x20\x20\x20Amount\x20after\x20commission:\x20','🧹\x20[DEBUG]\x20Cleared\x20timer\x20#','clearPaymentTimers','h),\x20skipping\x20global\x20check','\x20payment\x20','auto_expire','🔍\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','❌\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','✅\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','catch','error','❌\x20[CHECK]\x20Payment\x20','✅\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','size','\x20status\x20from\x20','logCoinToPayStatus','\x20days,\x20marking\x20as\x20EXPIRED','loggerService','getDate','⚠️\x20[CHECK]\x20Payment\x20','✅\x20[EXPIRY]\x20Payment\x20','paymentLinkId','EXPIRY_DAYS','🔄\x20[CHECK]\x20Updating\x20payment\x20','payment.failed','\x20\x20\x20❌\x20Error:\x20','telegramBotService','application/json','timers','paymentTimers','toISOString','1\x20minute','PENDING','POST','🪙\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','Webhook\x20event\x20','cointopay2','🛑\x20[SHUTDOWN]\x20Cleared\x20','🔍\x20[CHECK]\x20Checking\x20','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','\x20status:\x20','\x20\x20\x20Amount:\x20','⏰\x20[GLOBAL]\x20Payment\x20','CoinToPayService','gatewayPaymentId','./gateways/coinToPayService','📊\x20[HOURLY]\x20Payment\x20','⏰\x20[GLOBAL]\x20Found\x20',',\x20status=','✅\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','\x20pending\x20CoinToPay\x20payments','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','\x20seconds\x20(','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','❌\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','\x20is\x20valid\x20for\x20checking,\x20proceeding...','✅\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','customerName','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','EXPIRED','⏰\x20[DEBUG]\x20Scheduled\x20check\x20#',',\x20using\x20default\x2010%','🛑\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','176892DypCXC','__esModule','\x20\x20\x20-\x20paymentId:\x20','status_check','webhookUrl','❌\x20[TIMER]\x20Failed\x20individual\x20check\x20#','🪙\x20[DEBUG]\x20Creating\x20','8109927iFDsSk','sendShopWebhook','stack','checkSinglePaymentById','shopId','\x20\x20\x20-\x20GatewayPaymentId:\x20','confirmedOn','Failed\x20to\x20send\x20shop\x20webhook:','\x20\x20\x20-\x20ShopId:\x20','currentPayments','SINGLE','schedulePaymentChecks','\x20individual\x20payment\x20timers','🪙\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','\x20checked,\x20','now','cointopay','stringify','2319282BhrRJR','1040870tciYRW','getGatewayIdByName','coinToPayStatusService','findUnique','20270obFxZN','\x20not\x20found\x20in\x20database','No\x20specific\x20commission\x20found\x20for\x20gateway\x20','update','🛑\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','FAILED','⏰\x20[HOURLY]\x20Payment\x20','\x20has\x20no\x20gatewayPaymentId,\x20skipping','⚠️\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','__importDefault','default','paymentDetails','🔍\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','9723672AeUWYF','\x20\x20\x20-\x20Amount:\x20','📊\x20[CHECK]\x20Payment\x20','CoinToPay2Service','type','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','\x20USDT','\x20\x20\x20-\x20gatewayPaymentId:\x20','🆔\x20[CHECK]\x20Transaction\x20ID:\x20','1WSHJmE','forEach',',\x20stopping\x20individual\x20checks','\x20is\x20older\x20than\x20','COINTOPAY_STATUS_CHANGE','5\x20minutes','gatewayCommissionRate','delay','payment.pending','coinToPayService','webhookLog','description','globalCheckInterval','📈\x20[COINTOPAY]\x20Payment\x20','commission','❌\x20[HOURLY]\x20Payment\x20','📊\x20[CHECK]\x20CoinToPay\x20payment\x20','\x20days\x20without\x20payment\x20confirmation','logShopWebhookError','log','setDate','-day\x20timeout','Automatically\x20expired\x20after\x20','settings','✅\x20[CHECK]\x20Payment\x20','orderId','customerEmail','🪙\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','webhook_send','length','message','push','Payment\x20older\x20than\x20','\x20\x20\x20Gateway\x20','createdAt','amount','checkExpiredPayments','PAID','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','\x20amounts\x20calculated:','\x20\x20\x20-\x20Gateway:\x20','✅\x20[COINTOPAY]\x20Payment\x20link\x20','amountUSDT','Success','sendPaymentStatusNotification','\x20timers\x20for\x20payment\x20','sendPaymentNotification','logWhiteDomainError','Unknown\x20error','/status/','2\x20minutes','payment','\x20\x20\x20📅\x20Time:\x20','\x20(age:\x20','create','\x20days\x20(created\x20before\x20','stopPeriodicStatusCheck','\x20in\x20','\x20has\x20no\x20gatewayPaymentId','checkPaymentById','\x20status\x20changed\x20to\x20','🔍\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','iban','checkAllPendingPayments','\x20status\x20is\x20','values','checkSinglePayment','\x20(after\x20','created','getTime','convertToUSDT','cointopay_auto_expired','getGatewayCommission','checkPaymentStatus','status','\x20\x20\x20-\x20Status:\x20','🪙\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','floor','\x20\x20\x20📍\x20Source:\x20',',\x20gateway\x20','📊\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','entries',':\x20type=','\x20not\x20found,\x20clearing\x20timers','\x20in\x20shop\x20','Payment\x20System/1.0','logCoinToPayError','\x20triggered\x20for\x20payment\x20','createdOn','gateway','Shop\x20webhook\x20sent\x20to\x20'];a40_0x46ce=function(){return _0x5d2a78;};return a40_0x46ce();}(function(_0x4fb483,_0x487178){const _0x2219d6=a40_0x4fe9,_0x10c0b1=_0x4fb483();while(!![]){try{const _0x31596d=parseInt(_0x2219d6(0x1d5))/0x1*(parseInt(_0x2219d6(0x1bb))/0x2)+-parseInt(_0x2219d6(0x1a1))/0x3*(parseInt(_0x2219d6(0x247))/0x4)+parseInt(_0x2219d6(0x24d))/0x5+-parseInt(_0x2219d6(0x1ba))/0x6+parseInt(_0x2219d6(0x1a8))/0x7+parseInt(_0x2219d6(0x1cc))/0x8+-parseInt(_0x2219d6(0x250))/0x9*(parseInt(_0x2219d6(0x1bf))/0xa);if(_0x31596d===_0x487178)break;else _0x10c0b1['push'](_0x10c0b1['shift']());}catch(_0x5e4528){_0x10c0b1['push'](_0x10c0b1['shift']());}}}(a40_0x46ce,0xa1edf));var __importDefault=this&&this[a40_0x1a0441(0x1c8)]||function(_0x1a8160){const _0x16cbb5=a40_0x1a0441;return _0x1a8160&&_0x1a8160[_0x16cbb5(0x1a2)]?_0x1a8160:{'default':_0x1a8160};};function a40_0x4fe9(_0x559548,_0x16827a){const _0x46cead=a40_0x46ce();return a40_0x4fe9=function(_0x4fe961,_0x34f6aa){_0x4fe961=_0x4fe961-0x17c;let _0x5c7f27=_0x46cead[_0x4fe961];return _0x5c7f27;},a40_0x4fe9(_0x559548,_0x16827a);}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['coinToPayStatusService']=exports['CoinToPayStatusService']=void 0x0;const coinToPayService_1=require(a40_0x1a0441(0x18f)),coinToPay2Service_1=require('./gateways/coinToPay2Service'),gateway_1=require('../types/gateway'),database_1=__importDefault(require(a40_0x1a0441(0x236))),telegramBotService_1=require(a40_0x1a0441(0x241)),loggerService_1=require('./loggerService'),currencyService_1=require('./currencyService');class CoinToPayStatusService{constructor(){const _0x1f0c63=a40_0x1a0441;this[_0x1f0c63(0x1e1)]=null,this[_0x1f0c63(0x245)]=0x3c*0x3c*0x3e8,this[_0x1f0c63(0x27d)]=0x5,this[_0x1f0c63(0x17f)]=new Map(),this[_0x1f0c63(0x1de)]=new coinToPayService_1[(_0x1f0c63(0x18d))](),this[_0x1f0c63(0x24f)]=new coinToPay2Service_1[(_0x1f0c63(0x1cf))](),console[_0x1f0c63(0x1e8)](_0x1f0c63(0x256));}[a40_0x1a0441(0x1b3)](_0x12c14c,_0xda5228){const _0x4d9a49=a40_0x1a0441;console['log'](_0x4d9a49(0x240)),console[_0x4d9a49(0x1e8)](_0x4d9a49(0x1a3)+_0x12c14c),console['log'](_0x4d9a49(0x1d3)+_0xda5228),this[_0x4d9a49(0x269)](_0x12c14c);const _0x390479=[],_0x2c1db8=new Date(),_0xfeb7e9=[{'delay':0x1*0x3c*0x3e8,'description':_0x4d9a49(0x181)},{'delay':0x2*0x3c*0x3e8,'description':_0x4d9a49(0x207)},{'delay':0x5*0x3c*0x3e8,'description':_0x4d9a49(0x1da)},{'delay':0x5*0x3c*0x3e8,'description':_0x4d9a49(0x1da)}];console[_0x4d9a49(0x1e8)](_0x4d9a49(0x1a7)+_0xfeb7e9[_0x4d9a49(0x1f2)]+_0x4d9a49(0x265)+_0x12c14c);let _0xa94983=0x0;_0xfeb7e9[_0x4d9a49(0x1d6)]((_0x2e3f1e,_0x26ff7d)=>{const _0x250d7a=_0x4d9a49;_0xa94983+=_0x2e3f1e[_0x250d7a(0x1dc)];const _0x3109f6=setTimeout(async()=>{const _0x27efa3=_0x250d7a;console[_0x27efa3(0x1e8)]('🪙\x20[TIMER]\x20Individual\x20check\x20#'+(_0x26ff7d+0x1)+_0x27efa3(0x22c)+_0x12c14c+_0x27efa3(0x218)+_0x2e3f1e[_0x27efa3(0x1e0)]+')');try{await this['checkSinglePaymentById'](_0x12c14c),console[_0x27efa3(0x1e8)](_0x27efa3(0x235)+(_0x26ff7d+0x1)+'\x20completed\x20for\x20payment\x20'+_0x12c14c);}catch(_0x3ebb34){console[_0x27efa3(0x271)](_0x27efa3(0x1a6)+(_0x26ff7d+0x1)+_0x27efa3(0x25c)+_0x12c14c+':',_0x3ebb34),this['logCoinToPayError'](_0x12c14c,_0xda5228,_0x3ebb34,'status_check',{'checkNumber':_0x26ff7d+0x1,'scheduledAfter':_0x2e3f1e[_0x27efa3(0x1e0)],'isIndividualCheck':!![]});}},_0xa94983);_0x390479[_0x250d7a(0x1f4)](_0x3109f6),console[_0x250d7a(0x1e8)](_0x250d7a(0x19e)+(_0x26ff7d+0x1)+'\x20for\x20payment\x20'+_0x12c14c+_0x250d7a(0x20e)+_0xa94983/0x3e8+_0x250d7a(0x196)+_0x2e3f1e[_0x250d7a(0x1e0)]+')');});const _0x332632=setInterval(async()=>{const _0x1e7fe0=_0x4d9a49;console[_0x1e7fe0(0x1e8)](_0x1e7fe0(0x1f0)+_0x12c14c);try{const _0x26df3d=await database_1[_0x1e7fe0(0x1c9)]['payment'][_0x1e7fe0(0x1be)]({'where':{'id':_0x12c14c},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x26df3d){console['log'](_0x1e7fe0(0x1e4)+_0x12c14c+_0x1e7fe0(0x228)),this[_0x1e7fe0(0x269)](_0x12c14c);return;}console[_0x1e7fe0(0x1e8)](_0x1e7fe0(0x190)+_0x12c14c+'\x20current\x20status:\x20'+_0x26df3d[_0x1e7fe0(0x21f)]);if(_0x26df3d[_0x1e7fe0(0x21f)]!==_0x1e7fe0(0x182)){console['log'](_0x1e7fe0(0x263)+_0x12c14c+'\x20status\x20is\x20'+_0x26df3d[_0x1e7fe0(0x21f)]+_0x1e7fe0(0x1d7)),this[_0x1e7fe0(0x269)](_0x12c14c);return;}const _0x17665b=Math[_0x1e7fe0(0x222)]((Date[_0x1e7fe0(0x1b7)]()-_0x26df3d[_0x1e7fe0(0x1f7)][_0x1e7fe0(0x21a)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x17665b>=this[_0x1e7fe0(0x27d)]){console['log'](_0x1e7fe0(0x1c5)+_0x12c14c+_0x1e7fe0(0x1d8)+this[_0x1e7fe0(0x27d)]+_0x1e7fe0(0x197)),this[_0x1e7fe0(0x269)](_0x12c14c);return;}await this[_0x1e7fe0(0x1ab)](_0x12c14c),console[_0x1e7fe0(0x1e8)](_0x1e7fe0(0x273)+_0x12c14c);}catch(_0x3ea23b){console[_0x1e7fe0(0x271)](_0x1e7fe0(0x26e)+_0x12c14c+':',_0x3ea23b),this[_0x1e7fe0(0x22b)](_0x12c14c,_0xda5228,_0x3ea23b,_0x1e7fe0(0x1a4),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x390479[_0x4d9a49(0x1f4)](_0x332632),this['paymentTimers'][_0x4d9a49(0x24a)](_0x12c14c,{'timers':_0x390479,'paymentId':_0x12c14c,'gatewayPaymentId':_0xda5228,'createdAt':_0x2c1db8}),console[_0x4d9a49(0x1e8)](_0x4d9a49(0x23d)+_0xfeb7e9[_0x4d9a49(0x1f2)]+_0x4d9a49(0x239)+_0x12c14c),console['log'](_0x4d9a49(0x225)+this[_0x4d9a49(0x17f)]['size']),this[_0x4d9a49(0x276)](_0x12c14c,_0xda5228,_0x4d9a49(0x182),_0x4d9a49(0x182),'status_check',{'action':'schedule_created','scheduledChecks':_0xfeb7e9[_0x4d9a49(0x1f2)],'firstCheckIn':_0xfeb7e9[0x0][_0x4d9a49(0x1dc)]/0x3e8,'totalTimers':this['paymentTimers']['size']});}[a40_0x1a0441(0x269)](_0x1b2dbc){const _0xaa8f=a40_0x1a0441,_0x3afa80=this[_0xaa8f(0x17f)]['get'](_0x1b2dbc);_0x3afa80?(console[_0xaa8f(0x1e8)](_0xaa8f(0x232)+_0x3afa80[_0xaa8f(0x17e)]['length']+_0xaa8f(0x202)+_0x1b2dbc),_0x3afa80[_0xaa8f(0x17e)]['forEach']((_0x176c82,_0x5b3ef9)=>{const _0x329098=_0xaa8f;_0x176c82&&(clearTimeout(_0x176c82),clearInterval(_0x176c82),console['log'](_0x329098(0x268)+(_0x5b3ef9+0x1)+_0x329098(0x25c)+_0x1b2dbc));}),this['paymentTimers'][_0xaa8f(0x258)](_0x1b2dbc),console[_0xaa8f(0x1e8)]('✅\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20'+_0x1b2dbc+_0xaa8f(0x231)+this[_0xaa8f(0x17f)][_0xaa8f(0x274)])):console[_0xaa8f(0x1e8)](_0xaa8f(0x1c7)+_0x1b2dbc+'\x20to\x20clear');}async[a40_0x1a0441(0x1ab)](_0x3440c6){const _0x494e3b=a40_0x1a0441;console['log'](_0x494e3b(0x1cb)+_0x3440c6);const _0x2d4f4d=await database_1[_0x494e3b(0x1c9)][_0x494e3b(0x208)][_0x494e3b(0x1be)]({'where':{'id':_0x3440c6},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x2d4f4d){console[_0x494e3b(0x1e8)](_0x494e3b(0x272)+_0x3440c6+_0x494e3b(0x1c0));return;}console[_0x494e3b(0x1e8)](_0x494e3b(0x1ce)+_0x3440c6+'\x20found:'),console[_0x494e3b(0x1e8)](_0x494e3b(0x1fd)+_0x2d4f4d[_0x494e3b(0x22e)]),console[_0x494e3b(0x1e8)](_0x494e3b(0x220)+_0x2d4f4d[_0x494e3b(0x21f)]),console[_0x494e3b(0x1e8)](_0x494e3b(0x1ad)+_0x2d4f4d[_0x494e3b(0x18e)]),console[_0x494e3b(0x1e8)](_0x494e3b(0x1cd)+_0x2d4f4d['amount']+'\x20'+_0x2d4f4d[_0x494e3b(0x244)]),console[_0x494e3b(0x1e8)](_0x494e3b(0x1b0)+_0x2d4f4d[_0x494e3b(0x1ac)]);if(_0x2d4f4d['gateway']!==_0x494e3b(0x1b8)&&_0x2d4f4d[_0x494e3b(0x22e)]!==_0x494e3b(0x186)){console['log'](_0x494e3b(0x27a)+_0x3440c6+_0x494e3b(0x19c)+_0x2d4f4d[_0x494e3b(0x22e)]+')');return;}if(_0x2d4f4d['status']!==_0x494e3b(0x182)){console[_0x494e3b(0x1e8)](_0x494e3b(0x27a)+_0x3440c6+_0x494e3b(0x215)+_0x2d4f4d[_0x494e3b(0x21f)]+_0x494e3b(0x1d7)),this[_0x494e3b(0x269)](_0x3440c6);return;}if(!_0x2d4f4d[_0x494e3b(0x18e)]){console['log'](_0x494e3b(0x27a)+_0x3440c6+_0x494e3b(0x20f));return;}console[_0x494e3b(0x1e8)](_0x494e3b(0x1ed)+_0x3440c6+_0x494e3b(0x199)),await this['checkSinglePayment'](_0x2d4f4d);}[a40_0x1a0441(0x276)](_0x3036df,_0x2a597a,_0x2d3748,_0x5e56a7,_0x5b8794,_0x4f440b){const _0x2f6981=a40_0x1a0441,_0x5ef85a={'type':_0x2f6981(0x1d9),'paymentId':_0x3036df,'gatewayPaymentId':_0x2a597a,'oldStatus':_0x2d3748,'newStatus':_0x5e56a7,'source':_0x5b8794,'timestamp':new Date()[_0x2f6981(0x180)](),'details':_0x4f440b||{}};loggerService_1[_0x2f6981(0x278)][_0x2f6981(0x276)](_0x5ef85a),console[_0x2f6981(0x1e8)](_0x2f6981(0x1b5)+_0x3036df+'\x20('+_0x2a597a+')'),console[_0x2f6981(0x1e8)]('\x20\x20\x20📊\x20Status:\x20'+_0x2d3748+_0x2f6981(0x23c)+_0x5e56a7),console['log'](_0x2f6981(0x223)+_0x5b8794),console[_0x2f6981(0x1e8)]('\x20\x20\x20📅\x20Time:\x20'+_0x5ef85a['timestamp']),_0x4f440b&&console[_0x2f6981(0x1e8)]('\x20\x20\x20📝\x20Details:',_0x4f440b);}[a40_0x1a0441(0x22b)](_0x270e81,_0x49a2ee,_0x241f3c,_0x5a7a27,_0xab513){const _0x15cdb2=a40_0x1a0441,_0x32a010={'type':'COINTOPAY_ERROR','paymentId':_0x270e81,'gatewayPaymentId':_0x49a2ee,'error':_0x241f3c instanceof Error?{'message':_0x241f3c['message'],'stack':_0x241f3c[_0x15cdb2(0x1aa)]}:_0x241f3c,'source':_0x5a7a27,'timestamp':new Date()[_0x15cdb2(0x180)](),'context':_0xab513||{}};loggerService_1[_0x15cdb2(0x278)]['logCoinToPayError'](_0x32a010),console[_0x15cdb2(0x271)]('🪙\x20[ERROR]\x20CoinToPay\x20Error:\x20'+_0x270e81+'\x20('+_0x49a2ee+')'),console[_0x15cdb2(0x271)](_0x15cdb2(0x280)+(_0x241f3c instanceof Error?_0x241f3c[_0x15cdb2(0x1f3)]:_0x241f3c)),console[_0x15cdb2(0x271)](_0x15cdb2(0x223)+_0x5a7a27),console['error'](_0x15cdb2(0x209)+_0x32a010['timestamp']),_0xab513&&console['error'](_0x15cdb2(0x230),_0xab513);}['startPeriodicStatusCheck'](){const _0x5d56b0=a40_0x1a0441;console['log'](_0x5d56b0(0x221)),this[_0x5d56b0(0x214)]()[_0x5d56b0(0x270)](_0x385ab7=>{const _0x4661b6=_0x5d56b0;console[_0x4661b6(0x271)](_0x4661b6(0x233),_0x385ab7);}),this[_0x5d56b0(0x1e1)]=setInterval(async()=>{const _0x1abb74=_0x5d56b0;try{console[_0x1abb74(0x1e8)](_0x1abb74(0x184)),await this[_0x1abb74(0x214)](),console[_0x1abb74(0x1e8)]('✅\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed');}catch(_0x1eb91d){console[_0x1abb74(0x271)]('❌\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:',_0x1eb91d);}},this[_0x5d56b0(0x245)]),console[_0x5d56b0(0x1e8)]('✅\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)');}[a40_0x1a0441(0x20d)](){const _0x44ac10=a40_0x1a0441;console[_0x44ac10(0x1e8)](_0x44ac10(0x1a0));this[_0x44ac10(0x1e1)]&&(clearInterval(this[_0x44ac10(0x1e1)]),this[_0x44ac10(0x1e1)]=null,console[_0x44ac10(0x1e8)](_0x44ac10(0x1c3)));const _0x118739=this[_0x44ac10(0x17f)][_0x44ac10(0x274)];for(const [_0x506114]of this[_0x44ac10(0x17f)]){this[_0x44ac10(0x269)](_0x506114);}console['log'](_0x44ac10(0x187)+_0x118739+_0x44ac10(0x1b4));}async[a40_0x1a0441(0x214)](){const _0x14b5f4=a40_0x1a0441;try{console['log'](_0x14b5f4(0x260));const _0x131620=await database_1[_0x14b5f4(0x1c9)]['payment']['findMany']({'where':{'gateway':{'in':[_0x14b5f4(0x1b8),_0x14b5f4(0x186)]},'status':'PENDING','gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x14b5f4(0x1e8)]('🪙\x20[GLOBAL]\x20Found\x20'+_0x131620['length']+_0x14b5f4(0x194));if(_0x131620['length']===0x0){console['log']('🪙\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check');return;}const _0x13691f=await this['checkExpiredPayments'](_0x131620);console['log'](_0x14b5f4(0x191)+_0x13691f[_0x14b5f4(0x1f2)]+'\x20expired\x20CoinToPay\x20payments');let _0x1a77e4=0x0,_0x557c13=0x0;for(const _0x13775b of _0x131620){try{if(_0x13691f[_0x14b5f4(0x237)](_0x13775b['id'])){console[_0x14b5f4(0x1e8)](_0x14b5f4(0x18c)+_0x13775b['id']+_0x14b5f4(0x189)),_0x557c13++;continue;}if(this[_0x14b5f4(0x17f)]['has'](_0x13775b['id'])){console['log'](_0x14b5f4(0x18c)+_0x13775b['id']+_0x14b5f4(0x1fb)),_0x557c13++;continue;}const _0x455e79=(Date[_0x14b5f4(0x1b7)]()-_0x13775b[_0x14b5f4(0x1f7)][_0x14b5f4(0x21a)]())/(0x3e8*0x3c*0x3c);if(_0x455e79<0x1){console['log'](_0x14b5f4(0x18c)+_0x13775b['id']+'\x20is\x20too\x20new\x20('+_0x455e79[_0x14b5f4(0x24b)](0x1)+_0x14b5f4(0x26a)),_0x557c13++;continue;}console[_0x14b5f4(0x1e8)](_0x14b5f4(0x212)+_0x13775b['id']+_0x14b5f4(0x20a)+_0x455e79[_0x14b5f4(0x24b)](0x1)+'h)'),await this[_0x14b5f4(0x217)](_0x13775b),_0x1a77e4++,await new Promise(_0x1a66ff=>setTimeout(_0x1a66ff,0x7d0));}catch(_0x2bcde7){console['error']('❌\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20'+_0x13775b['id']+':',_0x2bcde7),this[_0x14b5f4(0x22b)](_0x13775b['id'],_0x13775b[_0x14b5f4(0x18e)]||'unknown',_0x2bcde7,_0x14b5f4(0x1a4),{'isGlobalCheck':!![],'paymentAmount':_0x13775b[_0x14b5f4(0x1f8)],'paymentCurrency':_0x13775b[_0x14b5f4(0x244)],'shopId':_0x13775b[_0x14b5f4(0x1ac)],'createdAt':_0x13775b[_0x14b5f4(0x1f7)]}),loggerService_1['loggerService'][_0x14b5f4(0x204)](_0x14b5f4(0x1b8),_0x14b5f4(0x206)+_0x13775b[_0x14b5f4(0x18e)],_0x2bcde7);}}console[_0x14b5f4(0x1e8)](_0x14b5f4(0x24e)+_0x1a77e4+_0x14b5f4(0x1b6)+_0x557c13+'\x20skipped,\x20'+_0x13691f[_0x14b5f4(0x1f2)]+'\x20expired');}catch(_0x32e1fb){console['error']('❌\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:',_0x32e1fb);}}async[a40_0x1a0441(0x1f9)](_0x1d3765){const _0x185dec=a40_0x1a0441,_0x5e283c=[],_0x2a80fd=new Date();_0x2a80fd[_0x185dec(0x1e9)](_0x2a80fd[_0x185dec(0x279)]()-this[_0x185dec(0x27d)]),console[_0x185dec(0x1e8)]('⏰\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20'+this[_0x185dec(0x27d)]+_0x185dec(0x20c)+_0x2a80fd[_0x185dec(0x180)]()+')');for(const _0x437f90 of _0x1d3765){if(_0x437f90['createdAt']<_0x2a80fd){console[_0x185dec(0x1e8)]('⏰\x20[EXPIRY]\x20Payment\x20'+_0x437f90['id']+_0x185dec(0x1d8)+this[_0x185dec(0x27d)]+_0x185dec(0x277));try{this[_0x185dec(0x276)](_0x437f90['id'],_0x437f90[_0x185dec(0x18e)]||_0x185dec(0x252),'PENDING',_0x185dec(0x19d),'auto_expire',{'reason':'Payment\x20older\x20than\x20'+this['EXPIRY_DAYS']+'\x20days','createdAt':_0x437f90[_0x185dec(0x1f7)],'daysSinceCreation':Math['floor']((Date[_0x185dec(0x1b7)]()-_0x437f90['createdAt'][_0x185dec(0x21a)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x437f90[_0x185dec(0x1f8)],'paymentCurrency':_0x437f90[_0x185dec(0x244)],'shopId':_0x437f90[_0x185dec(0x1ac)]}),await database_1['default'][_0x185dec(0x208)][_0x185dec(0x1c2)]({'where':{'id':_0x437f90['id']},'data':{'status':_0x185dec(0x19d),'updatedAt':new Date(),'adminNotes':_0x185dec(0x1eb)+this[_0x185dec(0x27d)]+_0x185dec(0x1e6)}}),await database_1[_0x185dec(0x1c9)][_0x185dec(0x1df)]['create']({'data':{'paymentId':_0x437f90['id'],'shopId':_0x437f90[_0x185dec(0x1ac)],'event':_0x185dec(0x21c),'statusCode':0xc8,'responseBody':JSON[_0x185dec(0x1b9)]({'reason':_0x185dec(0x1f5)+this[_0x185dec(0x27d)]+'\x20days','createdAt':_0x437f90['createdAt'],'expiredAt':new Date()[_0x185dec(0x180)](),'daysSinceCreation':Math[_0x185dec(0x222)]((Date[_0x185dec(0x1b7)]()-_0x437f90[_0x185dec(0x1f7)]['getTime']())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x185dec(0x1a9)](_0x437f90,'EXPIRED'),await this[_0x185dec(0x201)](_0x437f90,_0x185dec(0x19d)),this[_0x185dec(0x269)](_0x437f90['id']),_0x5e283c[_0x185dec(0x1f4)](_0x437f90['id']),console[_0x185dec(0x1e8)](_0x185dec(0x27b)+_0x437f90['id']+'\x20marked\x20as\x20EXPIRED\x20due\x20to\x20'+this[_0x185dec(0x27d)]+_0x185dec(0x1ea));}catch(_0x78d068){console['error'](_0x185dec(0x257)+_0x437f90['id']+':',_0x78d068),this[_0x185dec(0x22b)](_0x437f90['id'],_0x437f90[_0x185dec(0x18e)]||'unknown',_0x78d068,_0x185dec(0x26c),{'reason':'Failed\x20to\x20mark\x20payment\x20as\x20expired','createdAt':_0x437f90[_0x185dec(0x1f7)],'daysSinceCreation':Math[_0x185dec(0x222)]((Date[_0x185dec(0x1b7)]()-_0x437f90[_0x185dec(0x1f7)][_0x185dec(0x21a)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x5e283c;}async[a40_0x1a0441(0x217)](_0x50ea49){const _0xe0f08f=a40_0x1a0441;if(!_0x50ea49[_0xe0f08f(0x18e)]){console[_0xe0f08f(0x1e8)]('⚠️\x20[CHECK]\x20Payment\x20'+_0x50ea49['id']+_0xe0f08f(0x1c6));return;}console[_0xe0f08f(0x1e8)](_0xe0f08f(0x188)+_0x50ea49[_0xe0f08f(0x22e)]+_0xe0f08f(0x26b)+_0x50ea49['id']+'\x20('+_0x50ea49[_0xe0f08f(0x18e)]+')');try{let _0x34c136;_0x50ea49['gateway']===_0xe0f08f(0x186)?(_0x34c136=await this[_0xe0f08f(0x24f)][_0xe0f08f(0x21e)](_0x50ea49[_0xe0f08f(0x18e)]),console[_0xe0f08f(0x1e8)]('📊\x20[CHECK]\x20CoinToPay2\x20payment\x20'+_0x50ea49['id']+_0xe0f08f(0x18a)+_0x34c136[_0xe0f08f(0x21f)])):(_0x34c136=await this['coinToPayService'][_0xe0f08f(0x21e)](_0x50ea49[_0xe0f08f(0x18e)]),console[_0xe0f08f(0x1e8)](_0xe0f08f(0x1e5)+_0x50ea49['id']+_0xe0f08f(0x18a)+_0x34c136['status']));_0x34c136[_0xe0f08f(0x1ca)]&&console[_0xe0f08f(0x1e8)](_0xe0f08f(0x1ce)+_0x50ea49['id']+'\x20details:',{'iban':_0x34c136[_0xe0f08f(0x1ca)]['iban']||_0xe0f08f(0x262),'transactionId':_0x34c136[_0xe0f08f(0x1ca)][_0xe0f08f(0x24c)],'createdOn':_0x34c136['paymentDetails'][_0xe0f08f(0x22d)],'confirmedOn':_0x34c136[_0xe0f08f(0x1ca)]['confirmedOn']||'not\x20confirmed'});if(_0x34c136['status']!==_0x50ea49[_0xe0f08f(0x21f)]){console[_0xe0f08f(0x1e8)](_0xe0f08f(0x27e)+_0x50ea49['id']+_0xe0f08f(0x275)+_0x50ea49[_0xe0f08f(0x21f)]+_0xe0f08f(0x238)+_0x34c136[_0xe0f08f(0x21f)]),this[_0xe0f08f(0x276)](_0x50ea49['id'],_0x50ea49[_0xe0f08f(0x18e)],_0x50ea49['status'],_0x34c136[_0xe0f08f(0x21f)],'status_check',{'paymentDetails':_0x34c136['paymentDetails'],'amount':_0x34c136['amount'],'currency':_0x34c136['currency'],'shopId':_0x50ea49[_0xe0f08f(0x1ac)],'checkTimestamp':new Date()['toISOString']()});const _0x71bee7={'status':_0x34c136[_0xe0f08f(0x21f)],'updatedAt':new Date()};if(_0x34c136['status']===_0xe0f08f(0x1fa)&&_0x50ea49[_0xe0f08f(0x21f)]!==_0xe0f08f(0x1fa)){_0x71bee7[_0xe0f08f(0x234)]=new Date();if(!_0x50ea49[_0xe0f08f(0x1ff)]){const _0x1df855=await currencyService_1[_0xe0f08f(0x242)][_0xe0f08f(0x21b)](_0x50ea49[_0xe0f08f(0x1f8)],_0x50ea49[_0xe0f08f(0x244)]);_0x71bee7[_0xe0f08f(0x1ff)]=_0x1df855;const _0x3907a7=await this[_0xe0f08f(0x21d)](_0x50ea49[_0xe0f08f(0x1ac)],_0x50ea49['gateway']),_0x29ed02=_0x1df855*(0x1-_0x3907a7/0x64);_0x71bee7['amountAfterGatewayCommissionUSDT']=_0x29ed02,_0x71bee7[_0xe0f08f(0x1db)]=_0x3907a7,console['log'](_0xe0f08f(0x23b)+_0x50ea49['id']+_0xe0f08f(0x1fc)),console[_0xe0f08f(0x1e8)](_0xe0f08f(0x18b)+_0x50ea49[_0xe0f08f(0x1f8)]+'\x20'+_0x50ea49[_0xe0f08f(0x244)]+_0xe0f08f(0x23c)+_0x1df855[_0xe0f08f(0x24b)](0x6)+_0xe0f08f(0x1d2)),console[_0xe0f08f(0x1e8)](_0xe0f08f(0x1f6)+_0x50ea49[_0xe0f08f(0x22e)]+'\x20commission:\x20'+_0x3907a7+'%'),console['log'](_0xe0f08f(0x267)+_0x29ed02[_0xe0f08f(0x24b)](0x6)+_0xe0f08f(0x1d2));}console[_0xe0f08f(0x1e8)](_0xe0f08f(0x23b)+_0x50ea49['id']+_0xe0f08f(0x23a)+_0x71bee7[_0xe0f08f(0x234)][_0xe0f08f(0x180)]());}if(_0x34c136[_0xe0f08f(0x1ca)]){const _0xb86589=_0x34c136[_0xe0f08f(0x1ca)];_0xb86589[_0xe0f08f(0x213)]&&(_0x71bee7[_0xe0f08f(0x249)]=_0xb86589[_0xe0f08f(0x213)],console[_0xe0f08f(0x1e8)]('🏦\x20[CHECK]\x20Saved\x20IBAN:\x20'+_0xb86589['iban']));if(_0xb86589[_0xe0f08f(0x246)]){const _0x497f3a=_0x50ea49['adminNotes']||'',_0x2615cd='Bank\x20Details:\x20'+_0xb86589[_0xe0f08f(0x246)];_0x71bee7['adminNotes']=_0x497f3a?_0x497f3a+'\x0a\x0a'+_0x2615cd:_0x2615cd,console[_0xe0f08f(0x1e8)]('🏦\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes');}_0xb86589['transactionId']&&console[_0xe0f08f(0x1e8)](_0xe0f08f(0x1d4)+_0xb86589['transactionId']),_0xb86589[_0xe0f08f(0x1ae)]&&console[_0xe0f08f(0x1e8)](_0xe0f08f(0x19a)+_0xb86589[_0xe0f08f(0x1ae)]);}await database_1[_0xe0f08f(0x1c9)][_0xe0f08f(0x208)]['update']({'where':{'id':_0x50ea49['id']},'data':_0x71bee7});if(_0x34c136['status']==='PAID'&&_0x50ea49['status']!==_0xe0f08f(0x1fa)){console[_0xe0f08f(0x1e8)](_0xe0f08f(0x1e2)+_0x50ea49['id']+'\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link');const _0x1942f9=await database_1[_0xe0f08f(0x1c9)][_0xe0f08f(0x208)][_0xe0f08f(0x1be)]({'where':{'id':_0x50ea49['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x1942f9?.[_0xe0f08f(0x27c)]&&_0x1942f9[_0xe0f08f(0x25d)])try{const _0x51304a=_0x1942f9[_0xe0f08f(0x25d)];console[_0xe0f08f(0x1e8)]('📈\x20[COINTOPAY]\x20Found\x20payment\x20link\x20'+_0x51304a['id']+_0xe0f08f(0x227)+_0x51304a[_0xe0f08f(0x1d0)]+_0xe0f08f(0x264)+_0x51304a[_0xe0f08f(0x1b1)]+',\x20status='+_0x51304a[_0xe0f08f(0x21f)]);const _0x2d3f97=_0x51304a['currentPayments']+0x1,_0x1f2377=_0x51304a[_0xe0f08f(0x1d0)]===_0xe0f08f(0x1b2)?_0xe0f08f(0x253):_0x51304a[_0xe0f08f(0x21f)];await database_1['default']['paymentLink'][_0xe0f08f(0x1c2)]({'where':{'id':_0x51304a['id']},'data':{'currentPayments':_0x2d3f97,'status':_0x1f2377,'updatedAt':new Date()}}),console[_0xe0f08f(0x1e8)](_0xe0f08f(0x1fe)+_0x51304a['id']+'\x20updated:\x20currentPayments='+_0x51304a[_0xe0f08f(0x1b1)]+_0xe0f08f(0x23c)+_0x2d3f97+_0xe0f08f(0x192)+_0x51304a['status']+_0xe0f08f(0x23c)+_0x1f2377);}catch(_0x2569b1){console[_0xe0f08f(0x271)]('❌\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:',_0x2569b1);}else console[_0xe0f08f(0x1e8)]('📈\x20[COINTOPAY]\x20Payment\x20'+_0x50ea49['id']+_0xe0f08f(0x1d1));}await database_1[_0xe0f08f(0x1c9)]['webhookLog'][_0xe0f08f(0x20b)]({'data':{'paymentId':_0x50ea49['id'],'shopId':_0x50ea49[_0xe0f08f(0x1ac)],'event':'cointopay_status_check_'+_0x34c136[_0xe0f08f(0x21f)][_0xe0f08f(0x255)](),'statusCode':0xc8,'responseBody':JSON[_0xe0f08f(0x1b9)]({'oldStatus':_0x50ea49[_0xe0f08f(0x21f)],'newStatus':_0x34c136[_0xe0f08f(0x21f)],'paymentDetails':_0x34c136[_0xe0f08f(0x1ca)],'checkedAt':new Date()[_0xe0f08f(0x180)]()})}}),await this[_0xe0f08f(0x1a9)](_0x50ea49,_0x34c136[_0xe0f08f(0x21f)]),await this['sendPaymentStatusNotification'](_0x50ea49,_0x34c136[_0xe0f08f(0x21f)]),_0x34c136[_0xe0f08f(0x21f)]!=='PENDING'&&(console[_0xe0f08f(0x1e8)]('🧹\x20[CHECK]\x20Payment\x20'+_0x50ea49['id']+_0xe0f08f(0x211)+_0x34c136[_0xe0f08f(0x21f)]+',\x20clearing\x20individual\x20timers'),this[_0xe0f08f(0x269)](_0x50ea49['id'])),console[_0xe0f08f(0x1e8)](_0xe0f08f(0x1ed)+_0x50ea49['id']+_0xe0f08f(0x25e));}else console[_0xe0f08f(0x1e8)](_0xe0f08f(0x1ce)+_0x50ea49['id']+'\x20status\x20unchanged\x20('+_0x34c136[_0xe0f08f(0x21f)]+')'),this[_0xe0f08f(0x276)](_0x50ea49['id'],_0x50ea49[_0xe0f08f(0x18e)],_0x50ea49[_0xe0f08f(0x21f)],_0x34c136[_0xe0f08f(0x21f)],_0xe0f08f(0x1a4),{'statusUnchanged':!![],'paymentDetails':_0x34c136[_0xe0f08f(0x1ca)],'amount':_0x34c136[_0xe0f08f(0x1f8)],'currency':_0x34c136[_0xe0f08f(0x244)],'shopId':_0x50ea49[_0xe0f08f(0x1ac)],'checkTimestamp':new Date()[_0xe0f08f(0x180)]()});}catch(_0x599dc5){console[_0xe0f08f(0x271)](_0xe0f08f(0x198)+_0x50ea49['id']+':',_0x599dc5),this[_0xe0f08f(0x22b)](_0x50ea49['id'],_0x50ea49['gatewayPaymentId'],_0x599dc5,_0xe0f08f(0x1a4),{'paymentAmount':_0x50ea49[_0xe0f08f(0x1f8)],'paymentCurrency':_0x50ea49[_0xe0f08f(0x244)],'shopId':_0x50ea49['shopId'],'createdAt':_0x50ea49[_0xe0f08f(0x1f7)]}),await database_1[_0xe0f08f(0x1c9)][_0xe0f08f(0x1df)][_0xe0f08f(0x20b)]({'data':{'paymentId':_0x50ea49['id'],'shopId':_0x50ea49['shopId'],'event':_0xe0f08f(0x261),'statusCode':0x1f4,'responseBody':JSON['stringify']({'error':_0x599dc5 instanceof Error?_0x599dc5['message']:_0xe0f08f(0x205),'gatewayPaymentId':_0x50ea49[_0xe0f08f(0x18e)],'checkedAt':new Date()[_0xe0f08f(0x180)]()})}});}}async[a40_0x1a0441(0x1a9)](_0x405458,_0x3c4fc6){const _0x274b0b=a40_0x1a0441,_0x5a819e=Date[_0x274b0b(0x1b7)]();try{const _0x4d4bb1=_0x405458[_0x274b0b(0x25f)],_0x455124=_0x4d4bb1[_0x274b0b(0x1ec)];if(!_0x455124?.[_0x274b0b(0x1a5)]){console[_0x274b0b(0x1e8)]('No\x20webhook\x20URL\x20configured\x20for\x20shop\x20'+_0x4d4bb1['id']);return;}const _0x1ef3b8=_0x3c4fc6===_0x274b0b(0x1fa)?'payment.success':_0x3c4fc6===_0x274b0b(0x1c4)?'payment.failed':_0x3c4fc6==='EXPIRED'?_0x274b0b(0x27f):_0x274b0b(0x1dd);if(!_0x455124['webhookEvents']?.[_0x274b0b(0x237)](_0x1ef3b8)){console[_0x274b0b(0x1e8)](_0x274b0b(0x185)+_0x1ef3b8+'\x20not\x20enabled\x20for\x20shop\x20'+_0x4d4bb1['id']);return;}const _0x16e26a=(0x0,gateway_1[_0x274b0b(0x1bc)])(_0x405458['gateway'])||_0x405458['gateway'],_0x16095c={'event':_0x1ef3b8,'payment':{'id':_0x405458['id'],'order_id':_0x405458[_0x274b0b(0x1ee)],'gateway_order_id':_0x405458['gatewayOrderId'],'gateway':_0x16e26a,'amount':_0x405458[_0x274b0b(0x1f8)],'currency':_0x405458[_0x274b0b(0x244)],'status':_0x3c4fc6[_0x274b0b(0x255)](),'customer_email':_0x405458[_0x274b0b(0x1ef)],'customer_name':_0x405458[_0x274b0b(0x19b)],'created_at':_0x405458[_0x274b0b(0x1f7)],'updated_at':new Date()}},_0x3245ff=await fetch(_0x455124['webhookUrl'],{'method':_0x274b0b(0x183),'headers':{'Content-Type':_0x274b0b(0x17d),'User-Agent':_0x274b0b(0x22a)},'body':JSON['stringify'](_0x16095c)}),_0x3161c3=Date[_0x274b0b(0x1b7)]()-_0x5a819e,_0x43d901=_0x3245ff['ok']?_0x274b0b(0x200):await _0x3245ff['text']();loggerService_1[_0x274b0b(0x278)][_0x274b0b(0x243)](_0x405458[_0x274b0b(0x1ac)],_0x455124[_0x274b0b(0x1a5)],_0x1ef3b8,_0x3245ff[_0x274b0b(0x21f)],_0x3161c3,_0x16095c),console[_0x274b0b(0x1e8)](_0x274b0b(0x22f)+_0x455124[_0x274b0b(0x1a5)]+_0x274b0b(0x259)+_0x3245ff[_0x274b0b(0x21f)]+'\x20('+_0x3161c3+'ms)');}catch(_0x436409){console[_0x274b0b(0x271)](_0x274b0b(0x1af),_0x436409),loggerService_1[_0x274b0b(0x278)][_0x274b0b(0x1e7)](_0x405458[_0x274b0b(0x1ac)],_0x405458[_0x274b0b(0x25f)]?.[_0x274b0b(0x1ec)]?.[_0x274b0b(0x1a5)]||_0x274b0b(0x252),_0x274b0b(0x1f1),_0x436409,{});}}async[a40_0x1a0441(0x201)](_0xfe06ba,_0x3ffe25){const _0x42722c=a40_0x1a0441;try{const _0x5d195a={'PENDING':_0x42722c(0x219),'PAID':'paid','FAILED':'failed','EXPIRED':_0x42722c(0x248)},_0x3f8ab4=_0x5d195a[_0x3ffe25];if(!_0x3f8ab4||_0x3f8ab4===_0x42722c(0x219))return;await telegramBotService_1[_0x42722c(0x17c)][_0x42722c(0x203)](_0xfe06ba[_0x42722c(0x1ac)],_0xfe06ba,_0x3f8ab4);}catch(_0x2e3c82){console[_0x42722c(0x271)](_0x42722c(0x195),_0x2e3c82);}}async[a40_0x1a0441(0x210)](_0x382c6a){const _0x2f91d2=a40_0x1a0441;console['log'](_0x2f91d2(0x26d)+_0x382c6a);const _0x1499cc=await database_1['default'][_0x2f91d2(0x208)][_0x2f91d2(0x1be)]({'where':{'id':_0x382c6a},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x1499cc)throw new Error(_0x2f91d2(0x266));if(_0x1499cc[_0x2f91d2(0x22e)]!=='cointopay'&&_0x1499cc[_0x2f91d2(0x22e)]!==_0x2f91d2(0x186))throw new Error(_0x2f91d2(0x25a));console[_0x2f91d2(0x1e8)](_0x2f91d2(0x193)+_0x1499cc[_0x2f91d2(0x22e)]+_0x2f91d2(0x26b)+_0x382c6a),await this[_0x2f91d2(0x217)](_0x1499cc),console[_0x2f91d2(0x1e8)](_0x2f91d2(0x26f)+_0x382c6a);}[a40_0x1a0441(0x254)](){const _0x218817=a40_0x1a0441,_0xeb33a3=this[_0x218817(0x1e1)]?this[_0x218817(0x245)]:undefined,_0x2d422a=Array['from'](this[_0x218817(0x17f)][_0x218817(0x216)]())['map'](_0x33eb89=>({'paymentId':_0x33eb89[_0x218817(0x23e)],'gatewayPaymentId':_0x33eb89[_0x218817(0x18e)],'createdAt':_0x33eb89['createdAt'],'timersCount':_0x33eb89[_0x218817(0x17e)][_0x218817(0x1f2)]}));return{'isActive':!!this[_0x218817(0x1e1)],'globalCheckIntervalMinutes':this[_0x218817(0x245)]/(0x3e8*0x3c),'expiryDays':this['EXPIRY_DAYS'],'activeIndividualTimers':this[_0x218817(0x17f)][_0x218817(0x274)],'nextGlobalCheckIn':_0xeb33a3,'paymentTimersDetails':_0x2d422a};}['getPaymentTimerInfo'](_0x4ac1ff){const _0x55329e=a40_0x1a0441,_0x4bdf16=this[_0x55329e(0x17f)]['get'](_0x4ac1ff);if(_0x4bdf16)return{'hasTimers':!![],'timersCount':_0x4bdf16[_0x55329e(0x17e)][_0x55329e(0x1f2)],'createdAt':_0x4bdf16[_0x55329e(0x1f7)],'gatewayPaymentId':_0x4bdf16[_0x55329e(0x18e)]};return{'hasTimers':![]};}async[a40_0x1a0441(0x21d)](_0x5638da,_0x18a256){const _0x3ac377=a40_0x1a0441;try{const _0x1fe00c=await database_1[_0x3ac377(0x1c9)][_0x3ac377(0x25f)][_0x3ac377(0x1be)]({'where':{'id':_0x5638da},'select':{'gatewaySettings':!![]}});if(!_0x1fe00c?.['gatewaySettings'])return console[_0x3ac377(0x1e8)](_0x3ac377(0x251)+_0x5638da+',\x20using\x20default\x20commission\x2010%'),0xa;const _0x5c9bd6=JSON[_0x3ac377(0x25b)](_0x1fe00c['gatewaySettings']);for(const [_0x4727c2,_0x160f41]of Object[_0x3ac377(0x226)](_0x5c9bd6)){if(_0x4727c2[_0x3ac377(0x255)]()===_0x18a256[_0x3ac377(0x255)]()){const _0x598e94=_0x160f41[_0x3ac377(0x1e3)]||0xa;return console[_0x3ac377(0x1e8)](_0x3ac377(0x23f)+_0x18a256+'\x20commission\x20for\x20shop\x20'+_0x5638da+':\x20'+_0x598e94+'%'),_0x598e94;}}return console[_0x3ac377(0x1e8)](_0x3ac377(0x1c1)+_0x18a256+_0x3ac377(0x229)+_0x5638da+_0x3ac377(0x19f)),0xa;}catch(_0x47ba6f){return console[_0x3ac377(0x271)]('Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20'+_0x5638da+_0x3ac377(0x224)+_0x18a256+':',_0x47ba6f),0xa;}}}exports['CoinToPayStatusService']=CoinToPayStatusService,exports[a40_0x1a0441(0x1bd)]=new CoinToPayStatusService();