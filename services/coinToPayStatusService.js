'use strict';const a40_0x39ae52=a40_0x2fd7;(function(_0x3ffc57,_0x367f83){const _0xb3f44f=a40_0x2fd7,_0x4168d2=_0x3ffc57();while(!![]){try{const _0x2f3b70=-parseInt(_0xb3f44f(0x276))/0x1+-parseInt(_0xb3f44f(0x229))/0x2*(-parseInt(_0xb3f44f(0x1b7))/0x3)+parseInt(_0xb3f44f(0x1c5))/0x4*(-parseInt(_0xb3f44f(0x175))/0x5)+-parseInt(_0xb3f44f(0x23f))/0x6*(-parseInt(_0xb3f44f(0x266))/0x7)+parseInt(_0xb3f44f(0x19c))/0x8*(parseInt(_0xb3f44f(0x1c4))/0x9)+-parseInt(_0xb3f44f(0x202))/0xa+-parseInt(_0xb3f44f(0x1dd))/0xb*(-parseInt(_0xb3f44f(0x1c1))/0xc);if(_0x2f3b70===_0x367f83)break;else _0x4168d2['push'](_0x4168d2['shift']());}catch(_0x2ec853){_0x4168d2['push'](_0x4168d2['shift']());}}}(a40_0x4bb5,0x2c4d8));var __importDefault=this&&this[a40_0x39ae52(0x192)]||function(_0x20c5ba){const _0x4916cf=a40_0x39ae52;return _0x20c5ba&&_0x20c5ba[_0x4916cf(0x23d)]?_0x20c5ba:{'default':_0x20c5ba};};Object[a40_0x39ae52(0x1bc)](exports,'__esModule',{'value':!![]}),exports[a40_0x39ae52(0x263)]=exports[a40_0x39ae52(0x165)]=void 0x0;function a40_0x4bb5(){const _0x443fef=['⏰\x20[EXPIRY]\x20Payment\x20','781121uxsyNS','forEach','❌\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','checkExpiredPayments','\x20initial\x20timers\x20for\x20payment\x20','size','📊\x20[CHECK]\x20Payment\x20','FAILED','❌\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','🪙\x20[TIMER]\x20Individual\x20check\x20#','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','paymentTimers','\x20is\x20older\x20than\x20','❌\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','5\x20minutes','\x20not\x20enabled\x20for\x20shop\x20','\x20expired','not\x20found',',\x20using\x20default\x2010%','\x20status:\x20','\x20\x20\x20❌\x20Error:\x20','orderId','📈\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','🏦\x20[CHECK]\x20Saved\x20IBAN:\x20','COINTOPAY_STATUS_CHANGE','sendShopWebhook','stack','iban','EXPIRY_DAYS','\x20\x20\x20-\x20Amount:\x20','map','🪙\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','./currencyService','stopPeriodicStatusCheck','bankDetails','Success','\x20status\x20unchanged\x20(','3283730ssqkLw','Automatically\x20expired\x20after\x20','.\x20Remaining\x20active\x20timers:\x20','shopId','confirmedOn','logShopWebhookSent','application/json','unknown','🪙\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','webhook_send','timestamp','\x20to\x20clear','\x20commission:\x20','❌\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','✅\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','✅\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','set','✅\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','toISOString','amountAfterGatewayCommissionUSDT','🪙\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','stringify','Failed\x20to\x20send\x20shop\x20webhook:','getGatewayIdByName','findMany','Shop\x20webhook\x20sent\x20to\x20','payment.failed','✅\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','🧹\x20[CHECK]\x20Payment\x20','Bank\x20Details:\x20','POST','⚠️\x20[CHECK]\x20Payment\x20','customerEmail','🪙\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','checkSinglePayment','\x20in\x20shop\x20','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','🔍\x20[CHECK]\x20Checking\x20','cointopay_auto_expired','510482tJZFwg','createdAt','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','\x20in\x20','globalCheckInterval','📊\x20[CHECK]\x20CoinToPay2\x20payment\x20','webhookEvents','✅\x20[DEBUG]\x20Successfully\x20scheduled\x20','getPaymentTimerInfo','TesSoft\x20Payment\x20System/1.0','values','default','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','status_check','\x20completed\x20for\x20payment\x20','\x20has\x20no\x20gatewayPaymentId','now','includes','Payment\x20not\x20found','✅\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','__esModule','parse','54ZwyydT','coinToPay2Service','2\x20minutes','CoinToPayService','cointopay','currency','currencyService','entries','✅\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','../config/database','\x20\x20\x20-\x20GatewayPaymentId:\x20','logWhiteDomainError','🪙\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','get',',\x20currentPayments=','gatewaySettings','findUnique','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','telegramBotService','🛑\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','\x20\x20\x20-\x20ShopId:\x20','GLOBAL_CHECK_INTERVAL_MS','paymentDetails','\x20updated:\x20currentPayments=','🔍\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','sendPaymentStatusNotification','⏰\x20[GLOBAL]\x20Found\x20','currentPayments','\x20individual\x20payment\x20timers','🆔\x20[CHECK]\x20Transaction\x20ID:\x20','\x20found:','\x20\x20\x20-\x20Status:\x20','./gateways/coinToPay2Service','text','toLowerCase','🧹\x20[DEBUG]\x20Clearing\x20','coinToPayStatusService','\x20days\x20without\x20payment\x20confirmation','getTime','124397sseCWU','createdOn','\x20status\x20from\x20','remitterIban',',\x20gateway\x20','\x20USDT','gatewayOrderId','Gateway\x20',',\x20status=','\x20skipped,\x20','loggerService','checkAllPendingPayments','\x20\x20\x20📍\x20Source:\x20','delay','📈\x20[COINTOPAY]\x20Payment\x20','getGatewayCommission','158804JbWnFk','getServiceStats','✅\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','CoinToPay2Service','✅\x20[COINTOPAY]\x20Payment\x20link\x20','❌\x20[TIMER]\x20Failed\x20individual\x20check\x20#','amount','message','\x20\x20\x20Amount:\x20','cointopay2','create','Payment\x20older\x20than\x20','CoinToPayStatusService','\x20\x20\x20Amount\x20after\x20commission:\x20','❌\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','✅\x20[HOURLY]\x20Payment\x20','🪙\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','\x20updated\x20successfully','floor','Webhook\x20event\x20','📊\x20[HOURLY]\x20Payment\x20','update','\x20\x20\x20📝\x20Details:','EXPIRED','\x20not\x20found,\x20clearing\x20timers','\x20days\x20(created\x20before\x20','\x20days,\x20marking\x20as\x20EXPIRED','❌\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','1545RhIPzR','checkPaymentById','🔍\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','gatewayPaymentId','logCoinToPayStatus','🪙\x20[DEBUG]\x20Creating\x20','\x20status\x20changed\x20to\x20','./loggerService','paid','coinToPayService','push','ms)','auto_expire','checkPaymentStatus','\x20\x20\x20-\x20paymentId:\x20','webhookUrl','gatewayCommissionRate','📊\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','\x20\x20\x20📝\x20Context:','🛑\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','payment','paymentLinkId','from','schedule_created','amountUSDT','log','type','-day\x20timeout','⏰\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','__importDefault','clearPaymentTimers','⏰\x20[HOURLY]\x20Payment\x20','\x20commission\x20for\x20shop\x20','transactionId','logCoinToPayError','PENDING','created','\x20details:','cointopay_status_check_error','8HCsFjQ','\x20current\x20status:\x20','checkSinglePaymentById','\x20is\x20too\x20new\x20(','\x20for\x20payment\x20','startPeriodicStatusCheck','settings','❌\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','PAID','delete','error','💰\x20[CHECK]\x20Payment\x20','✅\x20[CHECK]\x20Payment\x20','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','shop','gateway','status','/status/','toFixed','\x20\x20\x20-\x20Gateway:\x20','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','\x20\x20\x20📅\x20Time:\x20','🪙\x20[ERROR]\x20CoinToPay\x20Error:\x20','Failed\x20to\x20mark\x20payment\x20as\x20expired','paymentLink','\x20status\x20is\x20',',\x20stopping\x20individual\x20checks','3eSMQwN','sendPaymentNotification','⏰\x20[DEBUG]\x20Scheduled\x20check\x20#','No\x20specific\x20commission\x20found\x20for\x20gateway\x20','✅\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','defineProperty','getDate','not\x20confirmed','webhookLog','paidAt','60zVxoWt','🪙\x20[GLOBAL]\x20Found\x20','./gateways/coinToPayService','662481jDNWBf','2268txMLOS','timers','customerName','setDate','📊\x20[CHECK]\x20CoinToPay\x20payment\x20','\x20marked\x20as\x20paid\x20at:\x20','payment.success','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','⏰\x20[GLOBAL]\x20Payment\x20','length','failed','paymentId','logShopWebhookError','✅\x20[TIMER]\x20Individual\x20check\x20#','\x20is\x20valid\x20for\x20checking,\x20proceeding...','has','⚠️\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','description','🧹\x20[DEBUG]\x20Cleared\x20timer\x20#','convertToUSDT','1\x20minute','\x20checked,\x20','\x20->\x20'];a40_0x4bb5=function(){return _0x443fef;};return a40_0x4bb5();}const coinToPayService_1=require(a40_0x39ae52(0x1c3)),coinToPay2Service_1=require(a40_0x39ae52(0x25f)),gateway_1=require('../types/gateway'),database_1=__importDefault(require(a40_0x39ae52(0x248))),telegramBotService_1=require('./telegramBotService'),loggerService_1=require(a40_0x39ae52(0x17c)),currencyService_1=require(a40_0x39ae52(0x1fd));function a40_0x2fd7(_0x4be7da,_0x2ed568){const _0x4bb567=a40_0x4bb5();return a40_0x2fd7=function(_0x2fd78a,_0x2856db){_0x2fd78a=_0x2fd78a-0x160;let _0x3d7e3c=_0x4bb567[_0x2fd78a];return _0x3d7e3c;},a40_0x2fd7(_0x4be7da,_0x2ed568);}class CoinToPayStatusService{constructor(){const _0x486c77=a40_0x39ae52;this[_0x486c77(0x22d)]=null,this[_0x486c77(0x254)]=0x3c*0x3c*0x3e8,this[_0x486c77(0x1f9)]=0x5,this[_0x486c77(0x1e8)]=new Map(),this[_0x486c77(0x17e)]=new coinToPayService_1[(_0x486c77(0x242))](),this[_0x486c77(0x240)]=new coinToPay2Service_1[(_0x486c77(0x279))](),console[_0x486c77(0x18e)](_0x486c77(0x216));}['schedulePaymentChecks'](_0x1075ae,_0x404486){const _0x4d93f8=a40_0x39ae52;console[_0x4d93f8(0x18e)](_0x4d93f8(0x1fc)),console[_0x4d93f8(0x18e)](_0x4d93f8(0x183)+_0x1075ae),console['log']('\x20\x20\x20-\x20gatewayPaymentId:\x20'+_0x404486),this[_0x4d93f8(0x193)](_0x1075ae);const _0x8e53e3=[],_0x35b7df=new Date(),_0x36ff99=[{'delay':0x1*0x3c*0x3e8,'description':_0x4d93f8(0x1d9)},{'delay':0x2*0x3c*0x3e8,'description':_0x4d93f8(0x241)},{'delay':0x5*0x3c*0x3e8,'description':_0x4d93f8(0x1eb)},{'delay':0x5*0x3c*0x3e8,'description':_0x4d93f8(0x1eb)}];console[_0x4d93f8(0x18e)](_0x4d93f8(0x17a)+_0x36ff99[_0x4d93f8(0x1ce)]+_0x4d93f8(0x1e1)+_0x1075ae);let _0x4dcf1a=0x0;_0x36ff99[_0x4d93f8(0x1de)]((_0x3f0e3f,_0x5afc5b)=>{const _0x4396ed=_0x4d93f8;_0x4dcf1a+=_0x3f0e3f[_0x4396ed(0x273)];const _0x1a9df4=setTimeout(async()=>{const _0x1555c8=_0x4396ed;console[_0x1555c8(0x18e)](_0x1555c8(0x1e6)+(_0x5afc5b+0x1)+'\x20triggered\x20for\x20payment\x20'+_0x1075ae+'\x20(after\x20'+_0x3f0e3f[_0x1555c8(0x1d6)]+')');try{await this['checkSinglePaymentById'](_0x1075ae),console[_0x1555c8(0x18e)](_0x1555c8(0x1d2)+(_0x5afc5b+0x1)+_0x1555c8(0x237)+_0x1075ae);}catch(_0x32375c){console[_0x1555c8(0x1a6)](_0x1555c8(0x27b)+(_0x5afc5b+0x1)+_0x1555c8(0x1a0)+_0x1075ae+':',_0x32375c),this[_0x1555c8(0x197)](_0x1075ae,_0x404486,_0x32375c,'status_check',{'checkNumber':_0x5afc5b+0x1,'scheduledAfter':_0x3f0e3f['description'],'isIndividualCheck':!![]});}},_0x4dcf1a);_0x8e53e3[_0x4396ed(0x17f)](_0x1a9df4),console[_0x4396ed(0x18e)](_0x4396ed(0x1b9)+(_0x5afc5b+0x1)+_0x4396ed(0x1a0)+_0x1075ae+_0x4396ed(0x22c)+_0x4dcf1a/0x3e8+'\x20seconds\x20('+_0x3f0e3f[_0x4396ed(0x1d6)]+')');});const _0x391b58=setInterval(async()=>{const _0x15c504=_0x4d93f8;console[_0x15c504(0x18e)]('🪙\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20'+_0x1075ae);try{const _0x52e0b3=await database_1[_0x15c504(0x234)][_0x15c504(0x189)][_0x15c504(0x24f)]({'where':{'id':_0x1075ae},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x52e0b3){console[_0x15c504(0x18e)]('❌\x20[HOURLY]\x20Payment\x20'+_0x1075ae+_0x15c504(0x171)),this['clearPaymentTimers'](_0x1075ae);return;}console[_0x15c504(0x18e)](_0x15c504(0x16d)+_0x1075ae+_0x15c504(0x19d)+_0x52e0b3[_0x15c504(0x1ac)]);if(_0x52e0b3[_0x15c504(0x1ac)]!==_0x15c504(0x198)){console[_0x15c504(0x18e)](_0x15c504(0x168)+_0x1075ae+'\x20status\x20is\x20'+_0x52e0b3[_0x15c504(0x1ac)]+',\x20stopping\x20individual\x20checks'),this[_0x15c504(0x193)](_0x1075ae);return;}const _0x3b431d=Math[_0x15c504(0x16b)]((Date['now']()-_0x52e0b3[_0x15c504(0x22a)][_0x15c504(0x265)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x3b431d>=this[_0x15c504(0x1f9)]){console[_0x15c504(0x18e)](_0x15c504(0x194)+_0x1075ae+_0x15c504(0x1e9)+this[_0x15c504(0x1f9)]+_0x15c504(0x1e7)),this[_0x15c504(0x193)](_0x1075ae);return;}await this[_0x15c504(0x19e)](_0x1075ae),console[_0x15c504(0x18e)](_0x15c504(0x23c)+_0x1075ae);}catch(_0x16546a){console['error'](_0x15c504(0x174)+_0x1075ae+':',_0x16546a),this['logCoinToPayError'](_0x1075ae,_0x404486,_0x16546a,_0x15c504(0x236),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x8e53e3['push'](_0x391b58),this['paymentTimers'][_0x4d93f8(0x212)](_0x1075ae,{'timers':_0x8e53e3,'paymentId':_0x1075ae,'gatewayPaymentId':_0x404486,'createdAt':_0x35b7df}),console[_0x4d93f8(0x18e)](_0x4d93f8(0x230)+_0x36ff99[_0x4d93f8(0x1ce)]+'\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20'+_0x1075ae),console[_0x4d93f8(0x18e)](_0x4d93f8(0x186)+this[_0x4d93f8(0x1e8)][_0x4d93f8(0x1e2)]),this[_0x4d93f8(0x179)](_0x1075ae,_0x404486,'PENDING',_0x4d93f8(0x198),_0x4d93f8(0x236),{'action':_0x4d93f8(0x18c),'scheduledChecks':_0x36ff99[_0x4d93f8(0x1ce)],'firstCheckIn':_0x36ff99[0x0][_0x4d93f8(0x273)]/0x3e8,'totalTimers':this['paymentTimers'][_0x4d93f8(0x1e2)]});}[a40_0x39ae52(0x193)](_0x5b993f){const _0x2d3b5a=a40_0x39ae52,_0x4adfdf=this[_0x2d3b5a(0x1e8)]['get'](_0x5b993f);_0x4adfdf?(console[_0x2d3b5a(0x18e)](_0x2d3b5a(0x262)+_0x4adfdf[_0x2d3b5a(0x1c6)][_0x2d3b5a(0x1ce)]+'\x20timers\x20for\x20payment\x20'+_0x5b993f),_0x4adfdf[_0x2d3b5a(0x1c6)][_0x2d3b5a(0x1de)]((_0xe108c1,_0x3decc0)=>{const _0x44523b=_0x2d3b5a;_0xe108c1&&(clearTimeout(_0xe108c1),clearInterval(_0xe108c1),console['log'](_0x44523b(0x1d7)+(_0x3decc0+0x1)+'\x20for\x20payment\x20'+_0x5b993f));}),this['paymentTimers'][_0x2d3b5a(0x1a5)](_0x5b993f),console['log'](_0x2d3b5a(0x1bb)+_0x5b993f+_0x2d3b5a(0x204)+this[_0x2d3b5a(0x1e8)][_0x2d3b5a(0x1e2)])):console['log'](_0x2d3b5a(0x1d5)+_0x5b993f+_0x2d3b5a(0x20d));}async[a40_0x39ae52(0x19e)](_0x31e451){const _0x78f02e=a40_0x39ae52;console[_0x78f02e(0x18e)](_0x78f02e(0x257)+_0x31e451);const _0x5c6240=await database_1[_0x78f02e(0x234)][_0x78f02e(0x189)][_0x78f02e(0x24f)]({'where':{'id':_0x31e451},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x5c6240){console['log']('❌\x20[CHECK]\x20Payment\x20'+_0x31e451+'\x20not\x20found\x20in\x20database');return;}console['log'](_0x78f02e(0x1e3)+_0x31e451+_0x78f02e(0x25d)),console['log'](_0x78f02e(0x1af)+_0x5c6240[_0x78f02e(0x1ab)]),console[_0x78f02e(0x18e)](_0x78f02e(0x25e)+_0x5c6240[_0x78f02e(0x1ac)]),console[_0x78f02e(0x18e)](_0x78f02e(0x249)+_0x5c6240['gatewayPaymentId']),console[_0x78f02e(0x18e)](_0x78f02e(0x1fa)+_0x5c6240[_0x78f02e(0x27c)]+'\x20'+_0x5c6240[_0x78f02e(0x244)]),console[_0x78f02e(0x18e)](_0x78f02e(0x253)+_0x5c6240[_0x78f02e(0x205)]);if(_0x5c6240[_0x78f02e(0x1ab)]!==_0x78f02e(0x243)&&_0x5c6240['gateway']!==_0x78f02e(0x162)){console[_0x78f02e(0x18e)](_0x78f02e(0x221)+_0x31e451+_0x78f02e(0x1b0)+_0x5c6240[_0x78f02e(0x1ab)]+')');return;}if(_0x5c6240[_0x78f02e(0x1ac)]!=='PENDING'){console[_0x78f02e(0x18e)](_0x78f02e(0x221)+_0x31e451+_0x78f02e(0x1b5)+_0x5c6240['status']+_0x78f02e(0x1b6)),this['clearPaymentTimers'](_0x31e451);return;}if(!_0x5c6240['gatewayPaymentId']){console[_0x78f02e(0x18e)](_0x78f02e(0x221)+_0x31e451+_0x78f02e(0x238));return;}console[_0x78f02e(0x18e)](_0x78f02e(0x1a8)+_0x31e451+_0x78f02e(0x1d3)),await this[_0x78f02e(0x224)](_0x5c6240);}[a40_0x39ae52(0x179)](_0x43a94d,_0x2ec455,_0x3fbfa4,_0x48c532,_0x91a671,_0x14e1c5){const _0xd5bb2d=a40_0x39ae52,_0x55ff1a={'type':_0xd5bb2d(0x1f5),'paymentId':_0x43a94d,'gatewayPaymentId':_0x2ec455,'oldStatus':_0x3fbfa4,'newStatus':_0x48c532,'source':_0x91a671,'timestamp':new Date()['toISOString'](),'details':_0x14e1c5||{}};loggerService_1['loggerService'][_0xd5bb2d(0x179)](_0x55ff1a),console[_0xd5bb2d(0x18e)](_0xd5bb2d(0x223)+_0x43a94d+'\x20('+_0x2ec455+')'),console[_0xd5bb2d(0x18e)]('\x20\x20\x20📊\x20Status:\x20'+_0x3fbfa4+_0xd5bb2d(0x1db)+_0x48c532),console['log'](_0xd5bb2d(0x272)+_0x91a671),console[_0xd5bb2d(0x18e)](_0xd5bb2d(0x1b1)+_0x55ff1a['timestamp']),_0x14e1c5&&console[_0xd5bb2d(0x18e)](_0xd5bb2d(0x16f),_0x14e1c5);}[a40_0x39ae52(0x197)](_0xb6b21d,_0x3a3693,_0x4f7da5,_0x455d01,_0x36c498){const _0x296c2e=a40_0x39ae52,_0x42e894={'type':'COINTOPAY_ERROR','paymentId':_0xb6b21d,'gatewayPaymentId':_0x3a3693,'error':_0x4f7da5 instanceof Error?{'message':_0x4f7da5[_0x296c2e(0x160)],'stack':_0x4f7da5[_0x296c2e(0x1f7)]}:_0x4f7da5,'source':_0x455d01,'timestamp':new Date()[_0x296c2e(0x214)](),'context':_0x36c498||{}};loggerService_1[_0x296c2e(0x270)][_0x296c2e(0x197)](_0x42e894),console['error'](_0x296c2e(0x1b2)+_0xb6b21d+'\x20('+_0x3a3693+')'),console[_0x296c2e(0x1a6)](_0x296c2e(0x1f1)+(_0x4f7da5 instanceof Error?_0x4f7da5['message']:_0x4f7da5)),console[_0x296c2e(0x1a6)]('\x20\x20\x20📍\x20Source:\x20'+_0x455d01),console[_0x296c2e(0x1a6)](_0x296c2e(0x1b1)+_0x42e894[_0x296c2e(0x20c)]),_0x36c498&&console['error'](_0x296c2e(0x187),_0x36c498);}[a40_0x39ae52(0x1a1)](){const _0x5bde31=a40_0x39ae52;console[_0x5bde31(0x18e)](_0x5bde31(0x169)),this[_0x5bde31(0x271)]()['catch'](_0x37f483=>{const _0x2c2260=_0x5bde31;console[_0x2c2260(0x1a6)](_0x2c2260(0x167),_0x37f483);}),this[_0x5bde31(0x22d)]=setInterval(async()=>{const _0x2814c5=_0x5bde31;try{console['log']('🪙\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...'),await this['checkAllPendingPayments'](),console[_0x2814c5(0x18e)](_0x2814c5(0x213));}catch(_0x362da6){console[_0x2814c5(0x1a6)](_0x2814c5(0x20f),_0x362da6);}},this[_0x5bde31(0x254)]),console[_0x5bde31(0x18e)](_0x5bde31(0x210));}[a40_0x39ae52(0x1fe)](){const _0x10f53b=a40_0x39ae52;console[_0x10f53b(0x18e)](_0x10f53b(0x252));this[_0x10f53b(0x22d)]&&(clearInterval(this[_0x10f53b(0x22d)]),this[_0x10f53b(0x22d)]=null,console[_0x10f53b(0x18e)](_0x10f53b(0x188)));const _0x5d9c2f=this[_0x10f53b(0x1e8)][_0x10f53b(0x1e2)];for(const [_0x273cb2]of this['paymentTimers']){this[_0x10f53b(0x193)](_0x273cb2);}console[_0x10f53b(0x18e)]('🛑\x20[SHUTDOWN]\x20Cleared\x20'+_0x5d9c2f+_0x10f53b(0x25b));}async[a40_0x39ae52(0x271)](){const _0x2a5e9a=a40_0x39ae52;try{console['log'](_0x2a5e9a(0x20a));const _0x58990f=await database_1[_0x2a5e9a(0x234)][_0x2a5e9a(0x189)][_0x2a5e9a(0x21a)]({'where':{'gateway':{'in':['cointopay',_0x2a5e9a(0x162)]},'status':_0x2a5e9a(0x198),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x2a5e9a(0x18e)](_0x2a5e9a(0x1c2)+_0x58990f[_0x2a5e9a(0x1ce)]+'\x20pending\x20CoinToPay\x20payments');if(_0x58990f[_0x2a5e9a(0x1ce)]===0x0){console['log'](_0x2a5e9a(0x24b));return;}const _0x53a46f=await this['checkExpiredPayments'](_0x58990f);console['log'](_0x2a5e9a(0x259)+_0x53a46f[_0x2a5e9a(0x1ce)]+'\x20expired\x20CoinToPay\x20payments');let _0x2a8ef5=0x0,_0x4e6ad7=0x0;for(const _0x3e9562 of _0x58990f){try{if(_0x53a46f[_0x2a5e9a(0x23a)](_0x3e9562['id'])){console['log'](_0x2a5e9a(0x1cd)+_0x3e9562['id']+'\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check'),_0x4e6ad7++;continue;}if(this[_0x2a5e9a(0x1e8)][_0x2a5e9a(0x1d4)](_0x3e9562['id'])){console[_0x2a5e9a(0x18e)]('⏰\x20[GLOBAL]\x20Payment\x20'+_0x3e9562['id']+'\x20has\x20individual\x20timers,\x20skipping\x20global\x20check'),_0x4e6ad7++;continue;}const _0x52042f=(Date[_0x2a5e9a(0x239)]()-_0x3e9562[_0x2a5e9a(0x22a)]['getTime']())/(0x3e8*0x3c*0x3c);if(_0x52042f<0x1){console[_0x2a5e9a(0x18e)](_0x2a5e9a(0x1cd)+_0x3e9562['id']+_0x2a5e9a(0x19f)+_0x52042f[_0x2a5e9a(0x1ae)](0x1)+'h),\x20skipping\x20global\x20check'),_0x4e6ad7++;continue;}console[_0x2a5e9a(0x18e)]('🔍\x20[GLOBAL]\x20Checking\x20old\x20payment\x20'+_0x3e9562['id']+'\x20(age:\x20'+_0x52042f[_0x2a5e9a(0x1ae)](0x1)+'h)'),await this[_0x2a5e9a(0x224)](_0x3e9562),_0x2a8ef5++,await new Promise(_0x7a079b=>setTimeout(_0x7a079b,0x7d0));}catch(_0x1bca0f){console[_0x2a5e9a(0x1a6)](_0x2a5e9a(0x1a3)+_0x3e9562['id']+':',_0x1bca0f),this[_0x2a5e9a(0x197)](_0x3e9562['id'],_0x3e9562[_0x2a5e9a(0x178)]||_0x2a5e9a(0x209),_0x1bca0f,_0x2a5e9a(0x236),{'isGlobalCheck':!![],'paymentAmount':_0x3e9562[_0x2a5e9a(0x27c)],'paymentCurrency':_0x3e9562['currency'],'shopId':_0x3e9562[_0x2a5e9a(0x205)],'createdAt':_0x3e9562[_0x2a5e9a(0x22a)]}),loggerService_1['loggerService'][_0x2a5e9a(0x24a)]('cointopay',_0x2a5e9a(0x1ad)+_0x3e9562[_0x2a5e9a(0x178)],_0x1bca0f);}}console[_0x2a5e9a(0x18e)](_0x2a5e9a(0x247)+_0x2a8ef5+_0x2a5e9a(0x1da)+_0x4e6ad7+_0x2a5e9a(0x26f)+_0x53a46f['length']+_0x2a5e9a(0x1ed));}catch(_0x5ae2e6){console[_0x2a5e9a(0x1a6)](_0x2a5e9a(0x1df),_0x5ae2e6);}}async[a40_0x39ae52(0x1e0)](_0x41c2dd){const _0x4a416a=a40_0x39ae52,_0x3496e8=[],_0x2e23ad=new Date();_0x2e23ad[_0x4a416a(0x1c8)](_0x2e23ad[_0x4a416a(0x1bd)]()-this[_0x4a416a(0x1f9)]),console[_0x4a416a(0x18e)](_0x4a416a(0x191)+this['EXPIRY_DAYS']+_0x4a416a(0x172)+_0x2e23ad[_0x4a416a(0x214)]()+')');for(const _0x119e7c of _0x41c2dd){if(_0x119e7c[_0x4a416a(0x22a)]<_0x2e23ad){console[_0x4a416a(0x18e)](_0x4a416a(0x1dc)+_0x119e7c['id']+_0x4a416a(0x1e9)+this[_0x4a416a(0x1f9)]+_0x4a416a(0x173));try{this[_0x4a416a(0x179)](_0x119e7c['id'],_0x119e7c[_0x4a416a(0x178)]||_0x4a416a(0x209),_0x4a416a(0x198),'EXPIRED',_0x4a416a(0x181),{'reason':_0x4a416a(0x164)+this['EXPIRY_DAYS']+'\x20days','createdAt':_0x119e7c[_0x4a416a(0x22a)],'daysSinceCreation':Math['floor']((Date[_0x4a416a(0x239)]()-_0x119e7c[_0x4a416a(0x22a)][_0x4a416a(0x265)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x119e7c[_0x4a416a(0x27c)],'paymentCurrency':_0x119e7c['currency'],'shopId':_0x119e7c[_0x4a416a(0x205)]}),await database_1[_0x4a416a(0x234)]['payment'][_0x4a416a(0x16e)]({'where':{'id':_0x119e7c['id']},'data':{'status':_0x4a416a(0x170),'updatedAt':new Date(),'adminNotes':_0x4a416a(0x203)+this[_0x4a416a(0x1f9)]+_0x4a416a(0x264)}}),await database_1['default'][_0x4a416a(0x1bf)][_0x4a416a(0x163)]({'data':{'paymentId':_0x119e7c['id'],'shopId':_0x119e7c[_0x4a416a(0x205)],'event':_0x4a416a(0x228),'statusCode':0xc8,'responseBody':JSON[_0x4a416a(0x217)]({'reason':_0x4a416a(0x164)+this['EXPIRY_DAYS']+'\x20days','createdAt':_0x119e7c[_0x4a416a(0x22a)],'expiredAt':new Date()[_0x4a416a(0x214)](),'daysSinceCreation':Math['floor']((Date[_0x4a416a(0x239)]()-_0x119e7c[_0x4a416a(0x22a)][_0x4a416a(0x265)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x4a416a(0x1f6)](_0x119e7c,_0x4a416a(0x170)),await this[_0x4a416a(0x258)](_0x119e7c,'EXPIRED'),this[_0x4a416a(0x193)](_0x119e7c['id']),_0x3496e8[_0x4a416a(0x17f)](_0x119e7c['id']),console[_0x4a416a(0x18e)]('✅\x20[EXPIRY]\x20Payment\x20'+_0x119e7c['id']+_0x4a416a(0x1a9)+this[_0x4a416a(0x1f9)]+_0x4a416a(0x190));}catch(_0x3aa219){console[_0x4a416a(0x1a6)](_0x4a416a(0x1ea)+_0x119e7c['id']+':',_0x3aa219),this[_0x4a416a(0x197)](_0x119e7c['id'],_0x119e7c['gatewayPaymentId']||'unknown',_0x3aa219,_0x4a416a(0x181),{'reason':_0x4a416a(0x1b3),'createdAt':_0x119e7c[_0x4a416a(0x22a)],'daysSinceCreation':Math[_0x4a416a(0x16b)]((Date[_0x4a416a(0x239)]()-_0x119e7c[_0x4a416a(0x22a)][_0x4a416a(0x265)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x3496e8;}async[a40_0x39ae52(0x224)](_0x1ef903){const _0x567918=a40_0x39ae52;if(!_0x1ef903[_0x567918(0x178)]){console[_0x567918(0x18e)]('⚠️\x20[CHECK]\x20Payment\x20'+_0x1ef903['id']+'\x20has\x20no\x20gatewayPaymentId,\x20skipping');return;}console[_0x567918(0x18e)](_0x567918(0x227)+_0x1ef903[_0x567918(0x1ab)]+'\x20payment\x20'+_0x1ef903['id']+'\x20('+_0x1ef903[_0x567918(0x178)]+')');try{let _0x4cf37c;_0x1ef903['gateway']===_0x567918(0x162)?(_0x4cf37c=await this[_0x567918(0x240)][_0x567918(0x182)](_0x1ef903[_0x567918(0x178)]),console[_0x567918(0x18e)](_0x567918(0x22e)+_0x1ef903['id']+_0x567918(0x1f0)+_0x4cf37c[_0x567918(0x1ac)])):(_0x4cf37c=await this[_0x567918(0x17e)][_0x567918(0x182)](_0x1ef903[_0x567918(0x178)]),console[_0x567918(0x18e)](_0x567918(0x1c9)+_0x1ef903['id']+'\x20status:\x20'+_0x4cf37c[_0x567918(0x1ac)]));_0x4cf37c[_0x567918(0x255)]&&console['log'](_0x567918(0x1e3)+_0x1ef903['id']+_0x567918(0x19a),{'iban':_0x4cf37c[_0x567918(0x255)][_0x567918(0x1f8)]||_0x567918(0x1ee),'transactionId':_0x4cf37c[_0x567918(0x255)]['transactionId'],'createdOn':_0x4cf37c[_0x567918(0x255)][_0x567918(0x267)],'confirmedOn':_0x4cf37c[_0x567918(0x255)][_0x567918(0x206)]||_0x567918(0x1be)});if(_0x4cf37c[_0x567918(0x1ac)]!==_0x1ef903['status']){console[_0x567918(0x18e)]('🔄\x20[CHECK]\x20Updating\x20payment\x20'+_0x1ef903['id']+_0x567918(0x268)+_0x1ef903[_0x567918(0x1ac)]+'\x20to\x20'+_0x4cf37c[_0x567918(0x1ac)]),this['logCoinToPayStatus'](_0x1ef903['id'],_0x1ef903[_0x567918(0x178)],_0x1ef903[_0x567918(0x1ac)],_0x4cf37c[_0x567918(0x1ac)],_0x567918(0x236),{'paymentDetails':_0x4cf37c[_0x567918(0x255)],'amount':_0x4cf37c[_0x567918(0x27c)],'currency':_0x4cf37c[_0x567918(0x244)],'shopId':_0x1ef903[_0x567918(0x205)],'checkTimestamp':new Date()['toISOString']()});const _0x13bc7c={'status':_0x4cf37c[_0x567918(0x1ac)],'updatedAt':new Date()};if(_0x4cf37c[_0x567918(0x1ac)]===_0x567918(0x1a4)&&_0x1ef903[_0x567918(0x1ac)]!==_0x567918(0x1a4)){_0x13bc7c[_0x567918(0x1c0)]=new Date();if(!_0x1ef903['amountUSDT']){const _0x1c02e8=await currencyService_1[_0x567918(0x245)][_0x567918(0x1d8)](_0x1ef903[_0x567918(0x27c)],_0x1ef903[_0x567918(0x244)]);_0x13bc7c[_0x567918(0x18d)]=_0x1c02e8;const _0x22abd0=await this[_0x567918(0x275)](_0x1ef903[_0x567918(0x205)],_0x1ef903[_0x567918(0x1ab)]),_0x2ae84d=_0x1c02e8*(0x1-_0x22abd0/0x64);_0x13bc7c[_0x567918(0x215)]=_0x2ae84d,_0x13bc7c[_0x567918(0x185)]=_0x22abd0,console[_0x567918(0x18e)]('💰\x20[CHECK]\x20Payment\x20'+_0x1ef903['id']+'\x20amounts\x20calculated:'),console[_0x567918(0x18e)](_0x567918(0x161)+_0x1ef903[_0x567918(0x27c)]+'\x20'+_0x1ef903['currency']+_0x567918(0x1db)+_0x1c02e8[_0x567918(0x1ae)](0x6)+_0x567918(0x26b)),console[_0x567918(0x18e)]('\x20\x20\x20Gateway\x20'+_0x1ef903[_0x567918(0x1ab)]+_0x567918(0x20e)+_0x22abd0+'%'),console[_0x567918(0x18e)](_0x567918(0x166)+_0x2ae84d[_0x567918(0x1ae)](0x6)+_0x567918(0x26b));}console[_0x567918(0x18e)](_0x567918(0x1a7)+_0x1ef903['id']+_0x567918(0x1ca)+_0x13bc7c[_0x567918(0x1c0)][_0x567918(0x214)]());}if(_0x4cf37c[_0x567918(0x255)]){const _0x1b980d=_0x4cf37c[_0x567918(0x255)];_0x1b980d['iban']&&(_0x13bc7c[_0x567918(0x269)]=_0x1b980d[_0x567918(0x1f8)],console[_0x567918(0x18e)](_0x567918(0x1f4)+_0x1b980d[_0x567918(0x1f8)]));if(_0x1b980d[_0x567918(0x1ff)]){const _0x32f99e=_0x1ef903['adminNotes']||'',_0x45abc3=_0x567918(0x21f)+_0x1b980d['bankDetails'];_0x13bc7c['adminNotes']=_0x32f99e?_0x32f99e+'\x0a\x0a'+_0x45abc3:_0x45abc3,console[_0x567918(0x18e)]('🏦\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes');}_0x1b980d[_0x567918(0x196)]&&console['log'](_0x567918(0x25c)+_0x1b980d[_0x567918(0x196)]),_0x1b980d[_0x567918(0x206)]&&console['log'](_0x567918(0x211)+_0x1b980d[_0x567918(0x206)]);}await database_1[_0x567918(0x234)][_0x567918(0x189)][_0x567918(0x16e)]({'where':{'id':_0x1ef903['id']},'data':_0x13bc7c});if(_0x4cf37c[_0x567918(0x1ac)]===_0x567918(0x1a4)&&_0x1ef903[_0x567918(0x1ac)]!==_0x567918(0x1a4)){console[_0x567918(0x18e)](_0x567918(0x274)+_0x1ef903['id']+_0x567918(0x226));const _0x128b86=await database_1['default'][_0x567918(0x189)][_0x567918(0x24f)]({'where':{'id':_0x1ef903['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x128b86?.[_0x567918(0x18a)]&&_0x128b86[_0x567918(0x1b4)])try{const _0x5cbc6a=_0x128b86[_0x567918(0x1b4)];console['log'](_0x567918(0x1f3)+_0x5cbc6a['id']+':\x20type='+_0x5cbc6a[_0x567918(0x18f)]+_0x567918(0x24d)+_0x5cbc6a[_0x567918(0x25a)]+',\x20status='+_0x5cbc6a[_0x567918(0x1ac)]);const _0x4834d8=_0x5cbc6a[_0x567918(0x25a)]+0x1,_0x103d90=_0x5cbc6a[_0x567918(0x18f)]==='SINGLE'?'COMPLETED':_0x5cbc6a['status'];await database_1['default']['paymentLink'][_0x567918(0x16e)]({'where':{'id':_0x5cbc6a['id']},'data':{'currentPayments':_0x4834d8,'status':_0x103d90,'updatedAt':new Date()}}),console['log'](_0x567918(0x27a)+_0x5cbc6a['id']+_0x567918(0x256)+_0x5cbc6a[_0x567918(0x25a)]+_0x567918(0x1db)+_0x4834d8+_0x567918(0x26e)+_0x5cbc6a['status']+_0x567918(0x1db)+_0x103d90);}catch(_0x2c13c5){console[_0x567918(0x1a6)]('❌\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:',_0x2c13c5);}else console[_0x567918(0x18e)]('📈\x20[COINTOPAY]\x20Payment\x20'+_0x1ef903['id']+'\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link');}await database_1[_0x567918(0x234)]['webhookLog']['create']({'data':{'paymentId':_0x1ef903['id'],'shopId':_0x1ef903[_0x567918(0x205)],'event':'cointopay_status_check_'+_0x4cf37c['status']['toLowerCase'](),'statusCode':0xc8,'responseBody':JSON[_0x567918(0x217)]({'oldStatus':_0x1ef903[_0x567918(0x1ac)],'newStatus':_0x4cf37c[_0x567918(0x1ac)],'paymentDetails':_0x4cf37c[_0x567918(0x255)],'checkedAt':new Date()[_0x567918(0x214)]()})}}),await this[_0x567918(0x1f6)](_0x1ef903,_0x4cf37c[_0x567918(0x1ac)]),await this[_0x567918(0x258)](_0x1ef903,_0x4cf37c[_0x567918(0x1ac)]),_0x4cf37c[_0x567918(0x1ac)]!==_0x567918(0x198)&&(console[_0x567918(0x18e)](_0x567918(0x21e)+_0x1ef903['id']+_0x567918(0x17b)+_0x4cf37c[_0x567918(0x1ac)]+',\x20clearing\x20individual\x20timers'),this[_0x567918(0x193)](_0x1ef903['id'])),console[_0x567918(0x18e)]('✅\x20[CHECK]\x20Payment\x20'+_0x1ef903['id']+_0x567918(0x16a));}else console[_0x567918(0x18e)](_0x567918(0x1e3)+_0x1ef903['id']+_0x567918(0x201)+_0x4cf37c['status']+')'),this[_0x567918(0x179)](_0x1ef903['id'],_0x1ef903[_0x567918(0x178)],_0x1ef903[_0x567918(0x1ac)],_0x4cf37c[_0x567918(0x1ac)],'status_check',{'statusUnchanged':!![],'paymentDetails':_0x4cf37c[_0x567918(0x255)],'amount':_0x4cf37c['amount'],'currency':_0x4cf37c[_0x567918(0x244)],'shopId':_0x1ef903['shopId'],'checkTimestamp':new Date()[_0x567918(0x214)]()});}catch(_0x37e231){console[_0x567918(0x1a6)](_0x567918(0x1e5)+_0x1ef903['id']+':',_0x37e231),this[_0x567918(0x197)](_0x1ef903['id'],_0x1ef903['gatewayPaymentId'],_0x37e231,_0x567918(0x236),{'paymentAmount':_0x1ef903[_0x567918(0x27c)],'paymentCurrency':_0x1ef903[_0x567918(0x244)],'shopId':_0x1ef903['shopId'],'createdAt':_0x1ef903[_0x567918(0x22a)]}),await database_1[_0x567918(0x234)]['webhookLog']['create']({'data':{'paymentId':_0x1ef903['id'],'shopId':_0x1ef903[_0x567918(0x205)],'event':_0x567918(0x19b),'statusCode':0x1f4,'responseBody':JSON[_0x567918(0x217)]({'error':_0x37e231 instanceof Error?_0x37e231[_0x567918(0x160)]:'Unknown\x20error','gatewayPaymentId':_0x1ef903[_0x567918(0x178)],'checkedAt':new Date()['toISOString']()})}});}}async[a40_0x39ae52(0x1f6)](_0x23e82c,_0x21f22d){const _0x17e989=a40_0x39ae52,_0x2bd3a6=Date[_0x17e989(0x239)]();try{const _0x2a4407=_0x23e82c[_0x17e989(0x1aa)],_0x1e6d73=_0x2a4407[_0x17e989(0x1a2)];if(!_0x1e6d73?.[_0x17e989(0x184)]){console['log'](_0x17e989(0x1cc)+_0x2a4407['id']);return;}const _0x5c6c1e=_0x21f22d==='PAID'?_0x17e989(0x1cb):_0x21f22d===_0x17e989(0x1e4)?_0x17e989(0x21c):_0x21f22d===_0x17e989(0x170)?_0x17e989(0x21c):'payment.pending';if(!_0x1e6d73[_0x17e989(0x22f)]?.['includes'](_0x5c6c1e)){console[_0x17e989(0x18e)](_0x17e989(0x16c)+_0x5c6c1e+_0x17e989(0x1ec)+_0x2a4407['id']);return;}const _0x9e1648=(0x0,gateway_1[_0x17e989(0x219)])(_0x23e82c[_0x17e989(0x1ab)])||_0x23e82c[_0x17e989(0x1ab)],_0x56d481={'event':_0x5c6c1e,'payment':{'id':_0x23e82c['id'],'order_id':_0x23e82c[_0x17e989(0x1f2)],'gateway_order_id':_0x23e82c[_0x17e989(0x26c)],'gateway':_0x9e1648,'amount':_0x23e82c[_0x17e989(0x27c)],'currency':_0x23e82c[_0x17e989(0x244)],'status':_0x21f22d[_0x17e989(0x261)](),'customer_email':_0x23e82c[_0x17e989(0x222)],'customer_name':_0x23e82c[_0x17e989(0x1c7)],'created_at':_0x23e82c[_0x17e989(0x22a)],'updated_at':new Date()}},_0x459bbe=await fetch(_0x1e6d73[_0x17e989(0x184)],{'method':_0x17e989(0x220),'headers':{'Content-Type':_0x17e989(0x208),'User-Agent':_0x17e989(0x232)},'body':JSON[_0x17e989(0x217)](_0x56d481)}),_0x47562a=Date[_0x17e989(0x239)]()-_0x2bd3a6,_0x19da2a=_0x459bbe['ok']?_0x17e989(0x200):await _0x459bbe[_0x17e989(0x260)]();loggerService_1[_0x17e989(0x270)][_0x17e989(0x207)](_0x23e82c[_0x17e989(0x205)],_0x1e6d73[_0x17e989(0x184)],_0x5c6c1e,_0x459bbe[_0x17e989(0x1ac)],_0x47562a,_0x56d481),console['log'](_0x17e989(0x21b)+_0x1e6d73[_0x17e989(0x184)]+'\x20with\x20status\x20'+_0x459bbe[_0x17e989(0x1ac)]+'\x20('+_0x47562a+_0x17e989(0x180));}catch(_0x907d3e){console[_0x17e989(0x1a6)](_0x17e989(0x218),_0x907d3e),loggerService_1[_0x17e989(0x270)][_0x17e989(0x1d1)](_0x23e82c[_0x17e989(0x205)],_0x23e82c[_0x17e989(0x1aa)]?.['settings']?.[_0x17e989(0x184)]||_0x17e989(0x209),_0x17e989(0x20b),_0x907d3e,{});}}async[a40_0x39ae52(0x258)](_0xa4b413,_0x2ab271){const _0x5b0f45=a40_0x39ae52;try{const _0x56ba6f={'PENDING':_0x5b0f45(0x199),'PAID':_0x5b0f45(0x17d),'FAILED':_0x5b0f45(0x1cf),'EXPIRED':'expired'},_0x4819ac=_0x56ba6f[_0x2ab271];if(!_0x4819ac||_0x4819ac==='created')return;await telegramBotService_1[_0x5b0f45(0x251)][_0x5b0f45(0x1b8)](_0xa4b413['shopId'],_0xa4b413,_0x4819ac);}catch(_0x37fb66){console[_0x5b0f45(0x1a6)](_0x5b0f45(0x250),_0x37fb66);}}async[a40_0x39ae52(0x176)](_0x29969a){const _0x12067c=a40_0x39ae52;console[_0x12067c(0x18e)](_0x12067c(0x177)+_0x29969a);const _0x2e1942=await database_1[_0x12067c(0x234)][_0x12067c(0x189)][_0x12067c(0x24f)]({'where':{'id':_0x29969a},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x2e1942)throw new Error(_0x12067c(0x23b));if(_0x2e1942[_0x12067c(0x1ab)]!=='cointopay'&&_0x2e1942[_0x12067c(0x1ab)]!==_0x12067c(0x162))throw new Error(_0x12067c(0x22b));console[_0x12067c(0x18e)](_0x12067c(0x21d)+_0x2e1942[_0x12067c(0x1ab)]+'\x20payment\x20'+_0x29969a),await this[_0x12067c(0x224)](_0x2e1942),console[_0x12067c(0x18e)](_0x12067c(0x278)+_0x29969a);}[a40_0x39ae52(0x277)](){const _0x2c8d81=a40_0x39ae52,_0x338ae2=this[_0x2c8d81(0x22d)]?this[_0x2c8d81(0x254)]:undefined,_0x254cc2=Array[_0x2c8d81(0x18b)](this[_0x2c8d81(0x1e8)][_0x2c8d81(0x233)]())[_0x2c8d81(0x1fb)](_0x3470c5=>({'paymentId':_0x3470c5[_0x2c8d81(0x1d0)],'gatewayPaymentId':_0x3470c5[_0x2c8d81(0x178)],'createdAt':_0x3470c5[_0x2c8d81(0x22a)],'timersCount':_0x3470c5[_0x2c8d81(0x1c6)][_0x2c8d81(0x1ce)]}));return{'isActive':!!this[_0x2c8d81(0x22d)],'globalCheckIntervalMinutes':this[_0x2c8d81(0x254)]/(0x3e8*0x3c),'expiryDays':this[_0x2c8d81(0x1f9)],'activeIndividualTimers':this[_0x2c8d81(0x1e8)][_0x2c8d81(0x1e2)],'nextGlobalCheckIn':_0x338ae2,'paymentTimersDetails':_0x254cc2};}[a40_0x39ae52(0x231)](_0x48fcc2){const _0x5ce358=a40_0x39ae52,_0x598e09=this[_0x5ce358(0x1e8)][_0x5ce358(0x24c)](_0x48fcc2);if(_0x598e09)return{'hasTimers':!![],'timersCount':_0x598e09[_0x5ce358(0x1c6)]['length'],'createdAt':_0x598e09[_0x5ce358(0x22a)],'gatewayPaymentId':_0x598e09[_0x5ce358(0x178)]};return{'hasTimers':![]};}async[a40_0x39ae52(0x275)](_0x2dd759,_0x540472){const _0x1cb395=a40_0x39ae52;try{const _0x37356b=await database_1[_0x1cb395(0x234)]['shop'][_0x1cb395(0x24f)]({'where':{'id':_0x2dd759},'select':{'gatewaySettings':!![]}});if(!_0x37356b?.['gatewaySettings'])return console[_0x1cb395(0x18e)](_0x1cb395(0x235)+_0x2dd759+',\x20using\x20default\x20commission\x2010%'),0xa;const _0x309851=JSON[_0x1cb395(0x23e)](_0x37356b[_0x1cb395(0x24e)]);for(const [_0x1f1f20,_0x57d42b]of Object[_0x1cb395(0x246)](_0x309851)){if(_0x1f1f20[_0x1cb395(0x261)]()===_0x540472[_0x1cb395(0x261)]()){const _0x186529=_0x57d42b['commission']||0xa;return console[_0x1cb395(0x18e)](_0x1cb395(0x26d)+_0x540472+_0x1cb395(0x195)+_0x2dd759+':\x20'+_0x186529+'%'),_0x186529;}}return console['log'](_0x1cb395(0x1ba)+_0x540472+_0x1cb395(0x225)+_0x2dd759+_0x1cb395(0x1ef)),0xa;}catch(_0x1cc4a7){return console[_0x1cb395(0x1a6)]('Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20'+_0x2dd759+_0x1cb395(0x26a)+_0x540472+':',_0x1cc4a7),0xa;}}}exports[a40_0x39ae52(0x165)]=CoinToPayStatusService,exports['coinToPayStatusService']=new CoinToPayStatusService();