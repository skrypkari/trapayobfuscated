'use strict';const a38_0x485f7f=a38_0x3dd7;(function(_0x49a1b9,_0x1868da){const _0x1dd7e6=a38_0x3dd7,_0x1b5a2f=_0x49a1b9();while(!![]){try{const _0x56f07c=-parseInt(_0x1dd7e6(0x1ab))/0x1*(parseInt(_0x1dd7e6(0x18f))/0x2)+-parseInt(_0x1dd7e6(0x109))/0x3+-parseInt(_0x1dd7e6(0x15f))/0x4*(parseInt(_0x1dd7e6(0x15c))/0x5)+parseInt(_0x1dd7e6(0x116))/0x6*(-parseInt(_0x1dd7e6(0xd0))/0x7)+-parseInt(_0x1dd7e6(0x146))/0x8+-parseInt(_0x1dd7e6(0x143))/0x9*(-parseInt(_0x1dd7e6(0x1c3))/0xa)+parseInt(_0x1dd7e6(0x1a2))/0xb;if(_0x56f07c===_0x1868da)break;else _0x1b5a2f['push'](_0x1b5a2f['shift']());}catch(_0x3a3188){_0x1b5a2f['push'](_0x1b5a2f['shift']());}}}(a38_0x4c58,0x4cfd9));function a38_0x3dd7(_0x5e5565,_0x276403){const _0x4c5800=a38_0x4c58();return a38_0x3dd7=function(_0x3dd782,_0x28f6af){_0x3dd782=_0x3dd782-0xd0;let _0x1b27a0=_0x4c5800[_0x3dd782];return _0x1b27a0;},a38_0x3dd7(_0x5e5565,_0x276403);}var __importDefault=this&&this[a38_0x485f7f(0x133)]||function(_0x18f7c5){const _0x5b2b44=a38_0x485f7f;return _0x18f7c5&&_0x18f7c5[_0x5b2b44(0xf3)]?_0x18f7c5:{'default':_0x18f7c5};};Object[a38_0x485f7f(0x1c6)](exports,a38_0x485f7f(0xf3),{'value':!![]}),exports[a38_0x485f7f(0x195)]=exports[a38_0x485f7f(0x178)]=void 0x0;const coinToPayService_1=require('./gateways/coinToPayService'),coinToPay2Service_1=require(a38_0x485f7f(0x13b)),gateway_1=require(a38_0x485f7f(0x188)),database_1=__importDefault(require(a38_0x485f7f(0x17b))),telegramBotService_1=require(a38_0x485f7f(0xd4)),loggerService_1=require(a38_0x485f7f(0x1d7)),currencyService_1=require(a38_0x485f7f(0x183));class CoinToPayStatusService{constructor(){const _0x5d3b52=a38_0x485f7f;this[_0x5d3b52(0x1ce)]=null,this['GLOBAL_CHECK_INTERVAL_MS']=0x3c*0x3c*0x3e8,this['EXPIRY_DAYS']=0x5,this[_0x5d3b52(0x100)]=new Map(),this[_0x5d3b52(0x12d)]=new coinToPayService_1['CoinToPayService'](),this[_0x5d3b52(0x15b)]=new coinToPay2Service_1[(_0x5d3b52(0x17d))](),console[_0x5d3b52(0x15d)]('🪙\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2');}[a38_0x485f7f(0x1a9)](_0x516f95,_0x2bed0b){const _0x472233=a38_0x485f7f;console['log']('🪙\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:'),console[_0x472233(0x15d)]('\x20\x20\x20-\x20paymentId:\x20'+_0x516f95),console[_0x472233(0x15d)](_0x472233(0x1be)+_0x2bed0b),this['clearPaymentTimers'](_0x516f95);const _0x1499f6=[],_0x34b9a7=new Date(),_0x2a404b=[{'delay':0x1*0x3c*0x3e8,'description':_0x472233(0x14e)},{'delay':0x2*0x3c*0x3e8,'description':_0x472233(0x1c0)},{'delay':0x5*0x3c*0x3e8,'description':_0x472233(0x124)},{'delay':0x5*0x3c*0x3e8,'description':_0x472233(0x124)}];console[_0x472233(0x15d)](_0x472233(0x16e)+_0x2a404b['length']+_0x472233(0x101)+_0x516f95);let _0x5938f4=0x0;_0x2a404b[_0x472233(0x1c5)]((_0xa70c92,_0xeaa666)=>{const _0x583c78=_0x472233;_0x5938f4+=_0xa70c92[_0x583c78(0x1c8)];const _0x4b9e9c=setTimeout(async()=>{const _0x36761e=_0x583c78;console[_0x36761e(0x15d)](_0x36761e(0x1d6)+(_0xeaa666+0x1)+_0x36761e(0x1b3)+_0x516f95+_0x36761e(0x191)+_0xa70c92[_0x36761e(0xe1)]+')');try{await this[_0x36761e(0x175)](_0x516f95),console[_0x36761e(0x15d)](_0x36761e(0x17a)+(_0xeaa666+0x1)+_0x36761e(0x13c)+_0x516f95);}catch(_0x2c3f38){console['error'](_0x36761e(0x18a)+(_0xeaa666+0x1)+_0x36761e(0x1d3)+_0x516f95+':',_0x2c3f38),this[_0x36761e(0xd8)](_0x516f95,_0x2bed0b,_0x2c3f38,'status_check',{'checkNumber':_0xeaa666+0x1,'scheduledAfter':_0xa70c92[_0x36761e(0xe1)],'isIndividualCheck':!![]});}},_0x5938f4);_0x1499f6['push'](_0x4b9e9c),console['log'](_0x583c78(0x11e)+(_0xeaa666+0x1)+'\x20for\x20payment\x20'+_0x516f95+_0x583c78(0x11a)+_0x5938f4/0x3e8+'\x20seconds\x20('+_0xa70c92['description']+')');});const _0x1edf0c=setInterval(async()=>{const _0x23e3a1=_0x472233;console[_0x23e3a1(0x15d)](_0x23e3a1(0x10f)+_0x516f95);try{const _0x3f813f=await database_1[_0x23e3a1(0x17c)][_0x23e3a1(0x1d4)][_0x23e3a1(0x1bf)]({'where':{'id':_0x516f95},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x3f813f){console[_0x23e3a1(0x15d)]('❌\x20[HOURLY]\x20Payment\x20'+_0x516f95+_0x23e3a1(0x165)),this['clearPaymentTimers'](_0x516f95);return;}console['log'](_0x23e3a1(0x16d)+_0x516f95+_0x23e3a1(0x139)+_0x3f813f[_0x23e3a1(0xf4)]);if(_0x3f813f[_0x23e3a1(0xf4)]!==_0x23e3a1(0xe0)){console[_0x23e3a1(0x15d)]('✅\x20[HOURLY]\x20Payment\x20'+_0x516f95+'\x20status\x20is\x20'+_0x3f813f[_0x23e3a1(0xf4)]+_0x23e3a1(0x131)),this[_0x23e3a1(0x180)](_0x516f95);return;}const _0x5ceb72=Math[_0x23e3a1(0x104)]((Date[_0x23e3a1(0x1b7)]()-_0x3f813f[_0x23e3a1(0x160)][_0x23e3a1(0xd5)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x5ceb72>=this['EXPIRY_DAYS']){console[_0x23e3a1(0x15d)](_0x23e3a1(0x186)+_0x516f95+_0x23e3a1(0x1ae)+this[_0x23e3a1(0x184)]+_0x23e3a1(0xea)),this[_0x23e3a1(0x180)](_0x516f95);return;}await this[_0x23e3a1(0x175)](_0x516f95),console[_0x23e3a1(0x15d)](_0x23e3a1(0xe8)+_0x516f95);}catch(_0x226793){console[_0x23e3a1(0x189)](_0x23e3a1(0xeb)+_0x516f95+':',_0x226793),this[_0x23e3a1(0xd8)](_0x516f95,_0x2bed0b,_0x226793,_0x23e3a1(0x19f),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x1499f6[_0x472233(0x19c)](_0x1edf0c),this[_0x472233(0x100)][_0x472233(0x151)](_0x516f95,{'timers':_0x1499f6,'paymentId':_0x516f95,'gatewayPaymentId':_0x2bed0b,'createdAt':_0x34b9a7}),console[_0x472233(0x15d)](_0x472233(0x194)+_0x2a404b[_0x472233(0x122)]+'\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20'+_0x516f95),console[_0x472233(0x15d)](_0x472233(0x129)+this[_0x472233(0x100)][_0x472233(0x1dd)]),this[_0x472233(0xfe)](_0x516f95,_0x2bed0b,_0x472233(0xe0),_0x472233(0xe0),_0x472233(0x19f),{'action':_0x472233(0x138),'scheduledChecks':_0x2a404b['length'],'firstCheckIn':_0x2a404b[0x0][_0x472233(0x1c8)]/0x3e8,'totalTimers':this['paymentTimers']['size']});}[a38_0x485f7f(0x180)](_0x1bd173){const _0x2a7ae3=a38_0x485f7f,_0x3afde4=this[_0x2a7ae3(0x100)][_0x2a7ae3(0x137)](_0x1bd173);_0x3afde4?(console[_0x2a7ae3(0x15d)](_0x2a7ae3(0xfd)+_0x3afde4[_0x2a7ae3(0x1ba)][_0x2a7ae3(0x122)]+_0x2a7ae3(0x18b)+_0x1bd173),_0x3afde4[_0x2a7ae3(0x1ba)]['forEach']((_0xcd746b,_0x5dbe2a)=>{_0xcd746b&&(clearTimeout(_0xcd746b),clearInterval(_0xcd746b),console['log']('🧹\x20[DEBUG]\x20Cleared\x20timer\x20#'+(_0x5dbe2a+0x1)+'\x20for\x20payment\x20'+_0x1bd173));}),this[_0x2a7ae3(0x100)][_0x2a7ae3(0x172)](_0x1bd173),console[_0x2a7ae3(0x15d)](_0x2a7ae3(0x1db)+_0x1bd173+_0x2a7ae3(0xff)+this[_0x2a7ae3(0x100)]['size'])):console[_0x2a7ae3(0x15d)](_0x2a7ae3(0x170)+_0x1bd173+_0x2a7ae3(0x17f));}async[a38_0x485f7f(0x175)](_0x43fe6d){const _0x4badca=a38_0x485f7f;console[_0x4badca(0x15d)](_0x4badca(0x179)+_0x43fe6d);const _0x5b68dc=await database_1['default'][_0x4badca(0x1d4)][_0x4badca(0x1bf)]({'where':{'id':_0x43fe6d},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x5b68dc){console[_0x4badca(0x15d)](_0x4badca(0x1a0)+_0x43fe6d+_0x4badca(0x166));return;}console[_0x4badca(0x15d)](_0x4badca(0xe2)+_0x43fe6d+'\x20found:'),console[_0x4badca(0x15d)](_0x4badca(0x17e)+_0x5b68dc[_0x4badca(0x1d0)]),console[_0x4badca(0x15d)](_0x4badca(0x147)+_0x5b68dc[_0x4badca(0xf4)]),console[_0x4badca(0x15d)](_0x4badca(0x106)+_0x5b68dc[_0x4badca(0x1a1)]),console['log'](_0x4badca(0x14f)+_0x5b68dc[_0x4badca(0x19d)]+'\x20'+_0x5b68dc[_0x4badca(0x1d2)]),console[_0x4badca(0x15d)](_0x4badca(0x144)+_0x5b68dc['shopId']);if(_0x5b68dc['gateway']!==_0x4badca(0x1c1)&&_0x5b68dc[_0x4badca(0x1d0)]!==_0x4badca(0x1ad)){console[_0x4badca(0x15d)](_0x4badca(0x1cb)+_0x43fe6d+_0x4badca(0x1d1)+_0x5b68dc[_0x4badca(0x1d0)]+')');return;}if(_0x5b68dc[_0x4badca(0xf4)]!==_0x4badca(0xe0)){console['log'](_0x4badca(0x1cb)+_0x43fe6d+_0x4badca(0x16a)+_0x5b68dc[_0x4badca(0xf4)]+_0x4badca(0x131)),this[_0x4badca(0x180)](_0x43fe6d);return;}if(!_0x5b68dc['gatewayPaymentId']){console[_0x4badca(0x15d)](_0x4badca(0x1cb)+_0x43fe6d+_0x4badca(0x150));return;}console[_0x4badca(0x15d)](_0x4badca(0x1de)+_0x43fe6d+_0x4badca(0x110)),await this[_0x4badca(0x1cf)](_0x5b68dc);}['logCoinToPayStatus'](_0x3ae5b8,_0x5f42c5,_0x5aabe2,_0x58177b,_0x2f54c1,_0x1cf17b){const _0x1794ca=a38_0x485f7f,_0x5801be={'type':'COINTOPAY_STATUS_CHANGE','paymentId':_0x3ae5b8,'gatewayPaymentId':_0x5f42c5,'oldStatus':_0x5aabe2,'newStatus':_0x58177b,'source':_0x2f54c1,'timestamp':new Date()[_0x1794ca(0x10b)](),'details':_0x1cf17b||{}};loggerService_1['loggerService'][_0x1794ca(0xfe)](_0x5801be),console[_0x1794ca(0x15d)](_0x1794ca(0x15e)+_0x3ae5b8+'\x20('+_0x5f42c5+')'),console['log'](_0x1794ca(0x107)+_0x5aabe2+_0x1794ca(0x157)+_0x58177b),console[_0x1794ca(0x15d)]('\x20\x20\x20📍\x20Source:\x20'+_0x2f54c1),console[_0x1794ca(0x15d)](_0x1794ca(0x134)+_0x5801be['timestamp']),_0x1cf17b&&console[_0x1794ca(0x15d)](_0x1794ca(0x119),_0x1cf17b);}['logCoinToPayError'](_0x3a9290,_0x5bcbe7,_0x37469a,_0x4c9a96,_0x3ba039){const _0x2aee69=a38_0x485f7f,_0x3e0b32={'type':_0x2aee69(0x121),'paymentId':_0x3a9290,'gatewayPaymentId':_0x5bcbe7,'error':_0x37469a instanceof Error?{'message':_0x37469a[_0x2aee69(0xe3)],'stack':_0x37469a[_0x2aee69(0x163)]}:_0x37469a,'source':_0x4c9a96,'timestamp':new Date()['toISOString'](),'context':_0x3ba039||{}};loggerService_1['loggerService'][_0x2aee69(0xd8)](_0x3e0b32),console[_0x2aee69(0x189)]('🪙\x20[ERROR]\x20CoinToPay\x20Error:\x20'+_0x3a9290+'\x20('+_0x5bcbe7+')'),console['error']('\x20\x20\x20❌\x20Error:\x20'+(_0x37469a instanceof Error?_0x37469a[_0x2aee69(0xe3)]:_0x37469a)),console['error'](_0x2aee69(0x13a)+_0x4c9a96),console[_0x2aee69(0x189)]('\x20\x20\x20📅\x20Time:\x20'+_0x3e0b32[_0x2aee69(0x1ca)]),_0x3ba039&&console[_0x2aee69(0x189)](_0x2aee69(0x10c),_0x3ba039);}['startPeriodicStatusCheck'](){const _0x4a2143=a38_0x485f7f;console[_0x4a2143(0x15d)](_0x4a2143(0xda)),this['checkAllPendingPayments']()[_0x4a2143(0x1dc)](_0x1c1b9c=>{const _0x3b6c6d=_0x4a2143;console[_0x3b6c6d(0x189)](_0x3b6c6d(0x113),_0x1c1b9c);}),this[_0x4a2143(0x1ce)]=setInterval(async()=>{const _0x475ce9=_0x4a2143;try{console['log'](_0x475ce9(0xf0)),await this[_0x475ce9(0x1a7)](),console[_0x475ce9(0x15d)]('✅\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed');}catch(_0x1be7cc){console[_0x475ce9(0x189)]('❌\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:',_0x1be7cc);}},this[_0x4a2143(0x103)]),console[_0x4a2143(0x15d)]('✅\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)');}[a38_0x485f7f(0x1b9)](){const _0x16e0d7=a38_0x485f7f;console['log']('🛑\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...');this['globalCheckInterval']&&(clearInterval(this['globalCheckInterval']),this[_0x16e0d7(0x1ce)]=null,console[_0x16e0d7(0x15d)](_0x16e0d7(0x16f)));const _0x3ca489=this[_0x16e0d7(0x100)][_0x16e0d7(0x1dd)];for(const [_0x287c7c]of this[_0x16e0d7(0x100)]){this['clearPaymentTimers'](_0x287c7c);}console['log'](_0x16e0d7(0x1aa)+_0x3ca489+'\x20individual\x20payment\x20timers');}async[a38_0x485f7f(0x1a7)](){const _0x3b0af3=a38_0x485f7f;try{console[_0x3b0af3(0x15d)]('🪙\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...');const _0x543410=await database_1['default'][_0x3b0af3(0x1d4)][_0x3b0af3(0x123)]({'where':{'gateway':{'in':['cointopay',_0x3b0af3(0x1ad)]},'status':_0x3b0af3(0xe0),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x3b0af3(0x15d)](_0x3b0af3(0x167)+_0x543410[_0x3b0af3(0x122)]+_0x3b0af3(0x1a6));if(_0x543410['length']===0x0){console['log'](_0x3b0af3(0xe9));return;}const _0x3cbb46=await this[_0x3b0af3(0x149)](_0x543410);console[_0x3b0af3(0x15d)](_0x3b0af3(0xdd)+_0x3cbb46['length']+_0x3b0af3(0x12b));let _0x254b58=0x0,_0x4cf827=0x0;for(const _0x17a7ae of _0x543410){try{if(_0x3cbb46['includes'](_0x17a7ae['id'])){console[_0x3b0af3(0x15d)](_0x3b0af3(0x10d)+_0x17a7ae['id']+_0x3b0af3(0x1c9)),_0x4cf827++;continue;}if(this['paymentTimers'][_0x3b0af3(0x1df)](_0x17a7ae['id'])){console['log'](_0x3b0af3(0x10d)+_0x17a7ae['id']+'\x20has\x20individual\x20timers,\x20skipping\x20global\x20check'),_0x4cf827++;continue;}const _0x3c43f5=(Date[_0x3b0af3(0x1b7)]()-_0x17a7ae[_0x3b0af3(0x160)][_0x3b0af3(0xd5)]())/(0x3e8*0x3c*0x3c);if(_0x3c43f5<0x1){console[_0x3b0af3(0x15d)]('⏰\x20[GLOBAL]\x20Payment\x20'+_0x17a7ae['id']+_0x3b0af3(0x102)+_0x3c43f5[_0x3b0af3(0x1a5)](0x1)+'h),\x20skipping\x20global\x20check'),_0x4cf827++;continue;}console[_0x3b0af3(0x15d)](_0x3b0af3(0x114)+_0x17a7ae['id']+'\x20(age:\x20'+_0x3c43f5[_0x3b0af3(0x1a5)](0x1)+'h)'),await this[_0x3b0af3(0x1cf)](_0x17a7ae),_0x254b58++,await new Promise(_0xacc4cc=>setTimeout(_0xacc4cc,0x7d0));}catch(_0x100e18){console[_0x3b0af3(0x189)]('❌\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20'+_0x17a7ae['id']+':',_0x100e18),this[_0x3b0af3(0xd8)](_0x17a7ae['id'],_0x17a7ae[_0x3b0af3(0x1a1)]||_0x3b0af3(0xfa),_0x100e18,_0x3b0af3(0x19f),{'isGlobalCheck':!![],'paymentAmount':_0x17a7ae[_0x3b0af3(0x19d)],'paymentCurrency':_0x17a7ae[_0x3b0af3(0x1d2)],'shopId':_0x17a7ae[_0x3b0af3(0x115)],'createdAt':_0x17a7ae[_0x3b0af3(0x160)]}),loggerService_1[_0x3b0af3(0x18d)][_0x3b0af3(0x158)]('cointopay',_0x3b0af3(0x152)+_0x17a7ae[_0x3b0af3(0x1a1)],_0x100e18);}}console[_0x3b0af3(0x15d)]('✅\x20[GLOBAL]\x20Global\x20check\x20completed:\x20'+_0x254b58+_0x3b0af3(0x187)+_0x4cf827+_0x3b0af3(0x117)+_0x3cbb46[_0x3b0af3(0x122)]+'\x20expired');}catch(_0x1d02d6){console['error']('❌\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:',_0x1d02d6);}}async[a38_0x485f7f(0x149)](_0x557b6c){const _0x27db1c=a38_0x485f7f,_0x16abcb=[],_0x28c998=new Date();_0x28c998['setDate'](_0x28c998[_0x27db1c(0x198)]()-this[_0x27db1c(0x184)]),console['log']('⏰\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20'+this[_0x27db1c(0x184)]+_0x27db1c(0x1bd)+_0x28c998[_0x27db1c(0x10b)]()+')');for(const _0x32026c of _0x557b6c){if(_0x32026c['createdAt']<_0x28c998){console[_0x27db1c(0x15d)]('⏰\x20[EXPIRY]\x20Payment\x20'+_0x32026c['id']+_0x27db1c(0x1ae)+this[_0x27db1c(0x184)]+_0x27db1c(0x1af));try{this['logCoinToPayStatus'](_0x32026c['id'],_0x32026c[_0x27db1c(0x1a1)]||'unknown',_0x27db1c(0xe0),_0x27db1c(0x14d),_0x27db1c(0x1d9),{'reason':'Payment\x20older\x20than\x20'+this[_0x27db1c(0x184)]+_0x27db1c(0x1c7),'createdAt':_0x32026c[_0x27db1c(0x160)],'daysSinceCreation':Math[_0x27db1c(0x104)]((Date['now']()-_0x32026c[_0x27db1c(0x160)][_0x27db1c(0xd5)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x32026c[_0x27db1c(0x19d)],'paymentCurrency':_0x32026c[_0x27db1c(0x1d2)],'shopId':_0x32026c['shopId']}),await database_1[_0x27db1c(0x17c)][_0x27db1c(0x1d4)][_0x27db1c(0x148)]({'where':{'id':_0x32026c['id']},'data':{'status':'EXPIRED','updatedAt':new Date(),'adminNotes':'Automatically\x20expired\x20after\x20'+this[_0x27db1c(0x184)]+'\x20days\x20without\x20payment\x20confirmation'}}),await database_1[_0x27db1c(0x17c)][_0x27db1c(0xe6)][_0x27db1c(0x196)]({'data':{'paymentId':_0x32026c['id'],'shopId':_0x32026c[_0x27db1c(0x115)],'event':_0x27db1c(0x1c2),'statusCode':0xc8,'responseBody':JSON[_0x27db1c(0x120)]({'reason':_0x27db1c(0x177)+this[_0x27db1c(0x184)]+_0x27db1c(0x1c7),'createdAt':_0x32026c[_0x27db1c(0x160)],'expiredAt':new Date()[_0x27db1c(0x10b)](),'daysSinceCreation':Math['floor']((Date[_0x27db1c(0x1b7)]()-_0x32026c['createdAt']['getTime']())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x27db1c(0x19e)](_0x32026c,'EXPIRED'),await this['sendPaymentStatusNotification'](_0x32026c,_0x27db1c(0x14d)),this['clearPaymentTimers'](_0x32026c['id']),_0x16abcb['push'](_0x32026c['id']),console[_0x27db1c(0x15d)]('✅\x20[EXPIRY]\x20Payment\x20'+_0x32026c['id']+_0x27db1c(0x111)+this[_0x27db1c(0x184)]+_0x27db1c(0x12c));}catch(_0xaf85fc){console[_0x27db1c(0x189)]('❌\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20'+_0x32026c['id']+':',_0xaf85fc),this[_0x27db1c(0xd8)](_0x32026c['id'],_0x32026c[_0x27db1c(0x1a1)]||_0x27db1c(0xfa),_0xaf85fc,_0x27db1c(0x1d9),{'reason':_0x27db1c(0x153),'createdAt':_0x32026c['createdAt'],'daysSinceCreation':Math[_0x27db1c(0x104)]((Date[_0x27db1c(0x1b7)]()-_0x32026c[_0x27db1c(0x160)][_0x27db1c(0xd5)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x16abcb;}async[a38_0x485f7f(0x1cf)](_0x9e531f){const _0x29400c=a38_0x485f7f;if(!_0x9e531f[_0x29400c(0x1a1)]){console[_0x29400c(0x15d)](_0x29400c(0x1cb)+_0x9e531f['id']+_0x29400c(0xef));return;}console[_0x29400c(0x15d)](_0x29400c(0x164)+_0x9e531f[_0x29400c(0x1d0)]+_0x29400c(0xde)+_0x9e531f['id']+'\x20('+_0x9e531f['gatewayPaymentId']+')');try{let _0x3cbff5;_0x9e531f[_0x29400c(0x1d0)]==='cointopay2'?(_0x3cbff5=await this['coinToPay2Service'][_0x29400c(0xdf)](_0x9e531f[_0x29400c(0x1a1)]),console[_0x29400c(0x15d)](_0x29400c(0xd6)+_0x9e531f['id']+'\x20status:\x20'+_0x3cbff5[_0x29400c(0xf4)])):(_0x3cbff5=await this[_0x29400c(0x12d)][_0x29400c(0xdf)](_0x9e531f['gatewayPaymentId']),console[_0x29400c(0x15d)](_0x29400c(0x162)+_0x9e531f['id']+_0x29400c(0x118)+_0x3cbff5[_0x29400c(0xf4)]));_0x3cbff5['paymentDetails']&&console['log'](_0x29400c(0xe2)+_0x9e531f['id']+'\x20details:',{'iban':_0x3cbff5[_0x29400c(0xd3)]['iban']||_0x29400c(0xe4),'transactionId':_0x3cbff5[_0x29400c(0xd3)]['transactionId'],'createdOn':_0x3cbff5[_0x29400c(0xd3)][_0x29400c(0xf6)],'confirmedOn':_0x3cbff5[_0x29400c(0xd3)][_0x29400c(0x145)]||'not\x20confirmed'});if(_0x3cbff5[_0x29400c(0xf4)]!==_0x9e531f[_0x29400c(0xf4)]){console[_0x29400c(0x15d)](_0x29400c(0x11c)+_0x9e531f['id']+'\x20status\x20from\x20'+_0x9e531f[_0x29400c(0xf4)]+_0x29400c(0xd2)+_0x3cbff5[_0x29400c(0xf4)]),this[_0x29400c(0xfe)](_0x9e531f['id'],_0x9e531f['gatewayPaymentId'],_0x9e531f[_0x29400c(0xf4)],_0x3cbff5[_0x29400c(0xf4)],_0x29400c(0x19f),{'paymentDetails':_0x3cbff5[_0x29400c(0xd3)],'amount':_0x3cbff5[_0x29400c(0x19d)],'currency':_0x3cbff5[_0x29400c(0x1d2)],'shopId':_0x9e531f[_0x29400c(0x115)],'checkTimestamp':new Date()[_0x29400c(0x10b)]()});const _0x3780b8={'status':_0x3cbff5[_0x29400c(0xf4)],'updatedAt':new Date()};if(_0x3cbff5[_0x29400c(0xf4)]===_0x29400c(0xd1)&&_0x9e531f[_0x29400c(0xf4)]!==_0x29400c(0xd1)){_0x3780b8[_0x29400c(0x1cc)]=new Date();if(!_0x9e531f['amountUSDT']){const _0x9220de=await currencyService_1['currencyService'][_0x29400c(0x14a)](_0x9e531f[_0x29400c(0x19d)],_0x9e531f[_0x29400c(0x1d2)]);_0x3780b8[_0x29400c(0x193)]=_0x9220de;const _0x4e6bc8=await this['getGatewayCommission'](_0x9e531f[_0x29400c(0x115)],_0x9e531f[_0x29400c(0x1d0)]),_0xafcc59=_0x9220de*(0x1-_0x4e6bc8/0x64);_0x3780b8[_0x29400c(0x11d)]=_0xafcc59,_0x3780b8[_0x29400c(0x1d5)]=_0x4e6bc8,console[_0x29400c(0x15d)](_0x29400c(0x128)+_0x9e531f['id']+_0x29400c(0xf2)),console['log'](_0x29400c(0xf7)+_0x9e531f[_0x29400c(0x19d)]+'\x20'+_0x9e531f[_0x29400c(0x1d2)]+_0x29400c(0x157)+_0x9220de[_0x29400c(0x1a5)](0x6)+'\x20USDT'),console[_0x29400c(0x15d)]('\x20\x20\x20Gateway\x20'+_0x9e531f[_0x29400c(0x1d0)]+_0x29400c(0x192)+_0x4e6bc8+'%'),console[_0x29400c(0x15d)](_0x29400c(0x1bc)+_0xafcc59[_0x29400c(0x1a5)](0x6)+_0x29400c(0x18c));}console[_0x29400c(0x15d)](_0x29400c(0x128)+_0x9e531f['id']+_0x29400c(0x135)+_0x3780b8['paidAt'][_0x29400c(0x10b)]());}if(_0x3cbff5['paymentDetails']){const _0x1458ae=_0x3cbff5[_0x29400c(0xd3)];_0x1458ae[_0x29400c(0x155)]&&(_0x3780b8[_0x29400c(0x12a)]=_0x1458ae[_0x29400c(0x155)],console[_0x29400c(0x15d)](_0x29400c(0x1b2)+_0x1458ae[_0x29400c(0x155)]));if(_0x1458ae['bankDetails']){const _0x502a17=_0x9e531f[_0x29400c(0x1b0)]||'',_0x2815ff=_0x29400c(0xe7)+_0x1458ae[_0x29400c(0x132)];_0x3780b8['adminNotes']=_0x502a17?_0x502a17+'\x0a\x0a'+_0x2815ff:_0x2815ff,console[_0x29400c(0x15d)](_0x29400c(0x1b1));}_0x1458ae['transactionId']&&console['log'](_0x29400c(0x1b4)+_0x1458ae[_0x29400c(0xfc)]),_0x1458ae[_0x29400c(0x145)]&&console['log'](_0x29400c(0x14b)+_0x1458ae[_0x29400c(0x145)]);}await database_1[_0x29400c(0x17c)][_0x29400c(0x1d4)]['update']({'where':{'id':_0x9e531f['id']},'data':_0x3780b8});if(_0x3cbff5[_0x29400c(0xf4)]==='PAID'&&_0x9e531f[_0x29400c(0xf4)]!==_0x29400c(0xd1)){console['log'](_0x29400c(0xd7)+_0x9e531f['id']+_0x29400c(0xf5));const _0xfb4c09=await database_1[_0x29400c(0x17c)][_0x29400c(0x1d4)][_0x29400c(0x1bf)]({'where':{'id':_0x9e531f['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0xfb4c09?.['paymentLinkId']&&_0xfb4c09['paymentLink'])try{const _0x38074a=_0xfb4c09['paymentLink'];console['log'](_0x29400c(0xdc)+_0x38074a['id']+_0x29400c(0x14c)+_0x38074a[_0x29400c(0x161)]+',\x20currentPayments='+_0x38074a[_0x29400c(0xec)]+_0x29400c(0x140)+_0x38074a[_0x29400c(0xf4)]);const _0x2c4882=_0x38074a[_0x29400c(0xec)]+0x1,_0x696259=_0x38074a[_0x29400c(0x161)]===_0x29400c(0x1da)?'COMPLETED':_0x38074a[_0x29400c(0xf4)];await database_1[_0x29400c(0x17c)][_0x29400c(0x1b6)]['update']({'where':{'id':_0x38074a['id']},'data':{'currentPayments':_0x2c4882,'status':_0x696259,'updatedAt':new Date()}}),console[_0x29400c(0x15d)](_0x29400c(0x10a)+_0x38074a['id']+_0x29400c(0x1b8)+_0x38074a[_0x29400c(0xec)]+_0x29400c(0x157)+_0x2c4882+_0x29400c(0x140)+_0x38074a[_0x29400c(0xf4)]+_0x29400c(0x157)+_0x696259);}catch(_0x1ae373){console[_0x29400c(0x189)](_0x29400c(0x1a3),_0x1ae373);}else console[_0x29400c(0x15d)](_0x29400c(0xd7)+_0x9e531f['id']+_0x29400c(0x1ac));}await database_1[_0x29400c(0x17c)][_0x29400c(0xe6)][_0x29400c(0x196)]({'data':{'paymentId':_0x9e531f['id'],'shopId':_0x9e531f[_0x29400c(0x115)],'event':_0x29400c(0x171)+_0x3cbff5[_0x29400c(0xf4)][_0x29400c(0x125)](),'statusCode':0xc8,'responseBody':JSON[_0x29400c(0x120)]({'oldStatus':_0x9e531f[_0x29400c(0xf4)],'newStatus':_0x3cbff5['status'],'paymentDetails':_0x3cbff5['paymentDetails'],'checkedAt':new Date()['toISOString']()})}}),await this['sendShopWebhook'](_0x9e531f,_0x3cbff5[_0x29400c(0xf4)]),await this['sendPaymentStatusNotification'](_0x9e531f,_0x3cbff5[_0x29400c(0xf4)]),_0x3cbff5[_0x29400c(0xf4)]!=='PENDING'&&(console[_0x29400c(0x15d)]('🧹\x20[CHECK]\x20Payment\x20'+_0x9e531f['id']+_0x29400c(0xed)+_0x3cbff5[_0x29400c(0xf4)]+_0x29400c(0x1a8)),this[_0x29400c(0x180)](_0x9e531f['id'])),console[_0x29400c(0x15d)]('✅\x20[CHECK]\x20Payment\x20'+_0x9e531f['id']+'\x20updated\x20successfully');}else console[_0x29400c(0x15d)](_0x29400c(0xe2)+_0x9e531f['id']+'\x20status\x20unchanged\x20('+_0x3cbff5[_0x29400c(0xf4)]+')'),this[_0x29400c(0xfe)](_0x9e531f['id'],_0x9e531f[_0x29400c(0x1a1)],_0x9e531f[_0x29400c(0xf4)],_0x3cbff5[_0x29400c(0xf4)],'status_check',{'statusUnchanged':!![],'paymentDetails':_0x3cbff5[_0x29400c(0xd3)],'amount':_0x3cbff5[_0x29400c(0x19d)],'currency':_0x3cbff5[_0x29400c(0x1d2)],'shopId':_0x9e531f['shopId'],'checkTimestamp':new Date()[_0x29400c(0x10b)]()});}catch(_0x2ad359){console[_0x29400c(0x189)]('❌\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20'+_0x9e531f['id']+':',_0x2ad359),this[_0x29400c(0xd8)](_0x9e531f['id'],_0x9e531f[_0x29400c(0x1a1)],_0x2ad359,_0x29400c(0x19f),{'paymentAmount':_0x9e531f[_0x29400c(0x19d)],'paymentCurrency':_0x9e531f[_0x29400c(0x1d2)],'shopId':_0x9e531f[_0x29400c(0x115)],'createdAt':_0x9e531f[_0x29400c(0x160)]}),await database_1['default'][_0x29400c(0xe6)][_0x29400c(0x196)]({'data':{'paymentId':_0x9e531f['id'],'shopId':_0x9e531f[_0x29400c(0x115)],'event':_0x29400c(0x112),'statusCode':0x1f4,'responseBody':JSON[_0x29400c(0x120)]({'error':_0x2ad359 instanceof Error?_0x2ad359[_0x29400c(0xe3)]:_0x29400c(0xf8),'gatewayPaymentId':_0x9e531f[_0x29400c(0x1a1)],'checkedAt':new Date()[_0x29400c(0x10b)]()})}});}}async[a38_0x485f7f(0x19e)](_0x5534b6,_0x1dcec5){const _0x224c80=a38_0x485f7f,_0xace10a=Date['now']();try{const _0x331b4f=_0x5534b6['shop'],_0x13e310=_0x331b4f[_0x224c80(0x12f)];if(!_0x13e310?.[_0x224c80(0x141)]){console[_0x224c80(0x15d)](_0x224c80(0x12e)+_0x331b4f['id']);return;}const _0x21be5e=_0x1dcec5==='PAID'?_0x224c80(0x185):_0x1dcec5===_0x224c80(0x13e)?_0x224c80(0x13f):_0x1dcec5===_0x224c80(0x14d)?_0x224c80(0x13f):_0x224c80(0xdb);if(!_0x13e310[_0x224c80(0x181)]?.[_0x224c80(0x1cd)](_0x21be5e)){console[_0x224c80(0x15d)]('Webhook\x20event\x20'+_0x21be5e+'\x20not\x20enabled\x20for\x20shop\x20'+_0x331b4f['id']);return;}const _0x2251e7=(0x0,gateway_1[_0x224c80(0x15a)])(_0x5534b6[_0x224c80(0x1d0)])||_0x5534b6[_0x224c80(0x1d0)],_0x101973={'event':_0x21be5e,'payment':{'id':_0x5534b6['id'],'order_id':_0x5534b6[_0x224c80(0x16c)],'gateway_order_id':_0x5534b6['gatewayOrderId'],'gateway':_0x2251e7,'amount':_0x5534b6[_0x224c80(0x19d)],'currency':_0x5534b6['currency'],'status':_0x1dcec5[_0x224c80(0x125)](),'customer_email':_0x5534b6['customerEmail'],'customer_name':_0x5534b6[_0x224c80(0x174)],'created_at':_0x5534b6['createdAt'],'updated_at':new Date()}},_0x478771=await fetch(_0x13e310['webhookUrl'],{'method':_0x224c80(0x173),'headers':{'Content-Type':_0x224c80(0x136),'User-Agent':_0x224c80(0xd9)},'body':JSON['stringify'](_0x101973)}),_0x3a64a=Date[_0x224c80(0x1b7)]()-_0xace10a,_0x15bcc8=_0x478771['ok']?'Success':await _0x478771[_0x224c80(0x182)]();loggerService_1['loggerService']['logShopWebhookSent'](_0x5534b6[_0x224c80(0x115)],_0x13e310[_0x224c80(0x141)],_0x21be5e,_0x478771[_0x224c80(0xf4)],_0x3a64a,_0x101973),console[_0x224c80(0x15d)](_0x224c80(0x154)+_0x13e310['webhookUrl']+_0x224c80(0xfb)+_0x478771[_0x224c80(0xf4)]+'\x20('+_0x3a64a+_0x224c80(0x156));}catch(_0x315b50){console[_0x224c80(0x189)](_0x224c80(0x127),_0x315b50),loggerService_1[_0x224c80(0x18d)][_0x224c80(0x169)](_0x5534b6[_0x224c80(0x115)],_0x5534b6[_0x224c80(0xe5)]?.[_0x224c80(0x12f)]?.['webhookUrl']||'unknown','webhook_send',_0x315b50,{});}}async['sendPaymentStatusNotification'](_0x42eeaf,_0x12c1b5){const _0x122150=a38_0x485f7f;try{const _0x5edb8b={'PENDING':'created','PAID':_0x122150(0x168),'FAILED':_0x122150(0xf9),'EXPIRED':_0x122150(0xf1)},_0x45bea6=_0x5edb8b[_0x12c1b5];if(!_0x45bea6||_0x45bea6===_0x122150(0x126))return;await telegramBotService_1[_0x122150(0x1b5)]['sendPaymentNotification'](_0x42eeaf['shopId'],_0x42eeaf,_0x45bea6);}catch(_0x48c875){console[_0x122150(0x189)]('Failed\x20to\x20send\x20Telegram\x20payment\x20notification:',_0x48c875);}}async[a38_0x485f7f(0x1d8)](_0x5128ff){const _0x4f16ac=a38_0x485f7f;console[_0x4f16ac(0x15d)](_0x4f16ac(0x16b)+_0x5128ff);const _0x2a6347=await database_1[_0x4f16ac(0x17c)]['payment'][_0x4f16ac(0x1bf)]({'where':{'id':_0x5128ff},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x2a6347)throw new Error('Payment\x20not\x20found');if(_0x2a6347[_0x4f16ac(0x1d0)]!==_0x4f16ac(0x1c1)&&_0x2a6347[_0x4f16ac(0x1d0)]!==_0x4f16ac(0x1ad))throw new Error(_0x4f16ac(0xee));console[_0x4f16ac(0x15d)](_0x4f16ac(0x19b)+_0x2a6347['gateway']+_0x4f16ac(0xde)+_0x5128ff),await this['checkSinglePayment'](_0x2a6347),console['log'](_0x4f16ac(0x11b)+_0x5128ff);}[a38_0x485f7f(0x1bb)](){const _0x456589=a38_0x485f7f,_0x505da9=this['globalCheckInterval']?this[_0x456589(0x103)]:undefined,_0x165a7a=Array[_0x456589(0x108)](this[_0x456589(0x100)][_0x456589(0x1a4)]())['map'](_0x8c8bd=>({'paymentId':_0x8c8bd['paymentId'],'gatewayPaymentId':_0x8c8bd['gatewayPaymentId'],'createdAt':_0x8c8bd[_0x456589(0x160)],'timersCount':_0x8c8bd['timers'][_0x456589(0x122)]}));return{'isActive':!!this[_0x456589(0x1ce)],'globalCheckIntervalMinutes':this[_0x456589(0x103)]/(0x3e8*0x3c),'expiryDays':this[_0x456589(0x184)],'activeIndividualTimers':this['paymentTimers'][_0x456589(0x1dd)],'nextGlobalCheckIn':_0x505da9,'paymentTimersDetails':_0x165a7a};}[a38_0x485f7f(0x197)](_0xd95cd3){const _0x224994=a38_0x485f7f,_0xe7657=this['paymentTimers']['get'](_0xd95cd3);if(_0xe7657)return{'hasTimers':!![],'timersCount':_0xe7657[_0x224994(0x1ba)][_0x224994(0x122)],'createdAt':_0xe7657[_0x224994(0x160)],'gatewayPaymentId':_0xe7657[_0x224994(0x1a1)]};return{'hasTimers':![]};}async[a38_0x485f7f(0x199)](_0x275a61,_0x26bb16){const _0x5d5aca=a38_0x485f7f;try{const _0x19dc78=await database_1[_0x5d5aca(0x17c)][_0x5d5aca(0xe5)][_0x5d5aca(0x1bf)]({'where':{'id':_0x275a61},'select':{'gatewaySettings':!![]}});if(!_0x19dc78?.[_0x5d5aca(0x1c4)])return console[_0x5d5aca(0x15d)](_0x5d5aca(0x190)+_0x275a61+_0x5d5aca(0x159)),0xa;const _0x57ddca=JSON[_0x5d5aca(0x13d)](_0x19dc78[_0x5d5aca(0x1c4)]);for(const [_0x1071dc,_0x1364d4]of Object[_0x5d5aca(0x19a)](_0x57ddca)){if(_0x1071dc[_0x5d5aca(0x125)]()===_0x26bb16['toLowerCase']()){const _0x3610fb=_0x1364d4[_0x5d5aca(0x105)]||0xa;return console[_0x5d5aca(0x15d)](_0x5d5aca(0x18e)+_0x26bb16+'\x20commission\x20for\x20shop\x20'+_0x275a61+':\x20'+_0x3610fb+'%'),_0x3610fb;}}return console['log'](_0x5d5aca(0x11f)+_0x26bb16+_0x5d5aca(0x142)+_0x275a61+_0x5d5aca(0x130)),0xa;}catch(_0x37dbf3){return console[_0x5d5aca(0x189)](_0x5d5aca(0x176)+_0x275a61+_0x5d5aca(0x10e)+_0x26bb16+':',_0x37dbf3),0xa;}}}exports[a38_0x485f7f(0x178)]=CoinToPayStatusService,exports[a38_0x485f7f(0x195)]=new CoinToPayStatusService();function a38_0x4c58(){const _0x5bacc0=['⏰\x20[DEBUG]\x20Scheduled\x20check\x20#','No\x20specific\x20commission\x20found\x20for\x20gateway\x20','stringify','COINTOPAY_ERROR','length','findMany','5\x20minutes','toLowerCase','created','Failed\x20to\x20send\x20shop\x20webhook:','💰\x20[CHECK]\x20Payment\x20','📊\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','remitterIban','\x20expired\x20CoinToPay\x20payments','-day\x20timeout','coinToPayService','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','settings',',\x20using\x20default\x2010%',',\x20stopping\x20individual\x20checks','bankDetails','__importDefault','\x20\x20\x20📅\x20Time:\x20','\x20marked\x20as\x20paid\x20at:\x20','application/json','get','schedule_created','\x20current\x20status:\x20','\x20\x20\x20📍\x20Source:\x20','./gateways/coinToPay2Service','\x20completed\x20for\x20payment\x20','parse','FAILED','payment.failed',',\x20status=','webhookUrl','\x20in\x20shop\x20','4967559gxREKL','\x20\x20\x20-\x20ShopId:\x20','confirmedOn','1504336BvKUYI','\x20\x20\x20-\x20Status:\x20','update','checkExpiredPayments','convertToUSDT','✅\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20',':\x20type=','EXPIRED','1\x20minute','\x20\x20\x20-\x20Amount:\x20','\x20has\x20no\x20gatewayPaymentId','set','/status/','Failed\x20to\x20mark\x20payment\x20as\x20expired','Shop\x20webhook\x20sent\x20to\x20','iban','ms)','\x20->\x20','logWhiteDomainError',',\x20using\x20default\x20commission\x2010%','getGatewayIdByName','coinToPay2Service','3775WuRxZi','log','🪙\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','2260XgjwGe','createdAt','type','📊\x20[CHECK]\x20CoinToPay\x20payment\x20','stack','🔍\x20[CHECK]\x20Checking\x20','\x20not\x20found,\x20clearing\x20timers','\x20not\x20found\x20in\x20database','🪙\x20[GLOBAL]\x20Found\x20','paid','logShopWebhookError','\x20status\x20is\x20','🔍\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','orderId','📊\x20[HOURLY]\x20Payment\x20','🪙\x20[DEBUG]\x20Creating\x20','🛑\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','⚠️\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','cointopay_status_check_','delete','POST','customerName','checkSinglePaymentById','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','Payment\x20older\x20than\x20','CoinToPayStatusService','🔍\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','✅\x20[TIMER]\x20Individual\x20check\x20#','../config/database','default','CoinToPay2Service','\x20\x20\x20-\x20Gateway:\x20','\x20to\x20clear','clearPaymentTimers','webhookEvents','text','./currencyService','EXPIRY_DAYS','payment.success','⏰\x20[HOURLY]\x20Payment\x20','\x20checked,\x20','../types/gateway','error','❌\x20[TIMER]\x20Failed\x20individual\x20check\x20#','\x20timers\x20for\x20payment\x20','\x20USDT','loggerService','Gateway\x20','40550DDpjYo','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','\x20(after\x20','\x20commission:\x20','amountUSDT','✅\x20[DEBUG]\x20Successfully\x20scheduled\x20','coinToPayStatusService','create','getPaymentTimerInfo','getDate','getGatewayCommission','entries','✅\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','push','amount','sendShopWebhook','status_check','❌\x20[CHECK]\x20Payment\x20','gatewayPaymentId','10637253bxpEOL','❌\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','values','toFixed','\x20pending\x20CoinToPay\x20payments','checkAllPendingPayments',',\x20clearing\x20individual\x20timers','schedulePaymentChecks','🛑\x20[SHUTDOWN]\x20Cleared\x20','13BCDFui','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','cointopay2','\x20is\x20older\x20than\x20','\x20days,\x20marking\x20as\x20EXPIRED','adminNotes','🏦\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes','🏦\x20[CHECK]\x20Saved\x20IBAN:\x20','\x20triggered\x20for\x20payment\x20','🆔\x20[CHECK]\x20Transaction\x20ID:\x20','telegramBotService','paymentLink','now','\x20updated:\x20currentPayments=','stopPeriodicStatusCheck','timers','getServiceStats','\x20\x20\x20Amount\x20after\x20commission:\x20','\x20days\x20(created\x20before\x20','\x20\x20\x20-\x20gatewayPaymentId:\x20','findUnique','2\x20minutes','cointopay','cointopay_auto_expired','10xyiaAi','gatewaySettings','forEach','defineProperty','\x20days','delay','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','timestamp','⚠️\x20[CHECK]\x20Payment\x20','paidAt','includes','globalCheckInterval','checkSinglePayment','gateway','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','currency','\x20for\x20payment\x20','payment','gatewayCommissionRate','🪙\x20[TIMER]\x20Individual\x20check\x20#','./loggerService','checkPaymentById','auto_expire','SINGLE','✅\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','catch','size','✅\x20[CHECK]\x20Payment\x20','has','35wlZjxo','PAID','\x20to\x20','paymentDetails','./telegramBotService','getTime','📊\x20[CHECK]\x20CoinToPay2\x20payment\x20','📈\x20[COINTOPAY]\x20Payment\x20','logCoinToPayError','TesSoft\x20Payment\x20System/1.0','🪙\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','payment.pending','📈\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','⏰\x20[GLOBAL]\x20Found\x20','\x20payment\x20','checkPaymentStatus','PENDING','description','📊\x20[CHECK]\x20Payment\x20','message','not\x20found','shop','webhookLog','Bank\x20Details:\x20','✅\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','🪙\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','❌\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','currentPayments','\x20status\x20changed\x20to\x20','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','\x20has\x20no\x20gatewayPaymentId,\x20skipping','🪙\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','expired','\x20amounts\x20calculated:','__esModule','status','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','createdOn','\x20\x20\x20Amount:\x20','Unknown\x20error','failed','unknown','\x20with\x20status\x20','transactionId','🧹\x20[DEBUG]\x20Clearing\x20','logCoinToPayStatus','.\x20Remaining\x20active\x20timers:\x20','paymentTimers','\x20initial\x20timers\x20for\x20payment\x20','\x20is\x20too\x20new\x20(','GLOBAL_CHECK_INTERVAL_MS','floor','commission','\x20\x20\x20-\x20GatewayPaymentId:\x20','\x20\x20\x20📊\x20Status:\x20','from','312507GTpgcM','✅\x20[COINTOPAY]\x20Payment\x20link\x20','toISOString','\x20\x20\x20📝\x20Context:','⏰\x20[GLOBAL]\x20Payment\x20',',\x20gateway\x20','🪙\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','\x20is\x20valid\x20for\x20checking,\x20proceeding...','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','cointopay_status_check_error','❌\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','🔍\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','shopId','265512tWJPao','\x20skipped,\x20','\x20status:\x20','\x20\x20\x20📝\x20Details:','\x20in\x20','✅\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','🔄\x20[CHECK]\x20Updating\x20payment\x20','amountAfterGatewayCommissionUSDT'];a38_0x4c58=function(){return _0x5bacc0;};return a38_0x4c58();}