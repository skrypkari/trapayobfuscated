'use strict';const a38_0x1d2569=a38_0x4cb6;(function(_0x1dbc46,_0x2da671){const _0x12d36d=a38_0x4cb6,_0x4565d2=_0x1dbc46();while(!![]){try{const _0x301134=-parseInt(_0x12d36d(0x1a4))/0x1*(parseInt(_0x12d36d(0x1a3))/0x2)+-parseInt(_0x12d36d(0x254))/0x3*(parseInt(_0x12d36d(0x1c6))/0x4)+parseInt(_0x12d36d(0x246))/0x5*(-parseInt(_0x12d36d(0x27e))/0x6)+parseInt(_0x12d36d(0x289))/0x7+-parseInt(_0x12d36d(0x182))/0x8*(parseInt(_0x12d36d(0x210))/0x9)+-parseInt(_0x12d36d(0x18f))/0xa+parseInt(_0x12d36d(0x225))/0xb;if(_0x301134===_0x2da671)break;else _0x4565d2['push'](_0x4565d2['shift']());}catch(_0x438a8f){_0x4565d2['push'](_0x4565d2['shift']());}}}(a38_0x51a2,0x7e2d4));function a38_0x51a2(){const _0x4996b4=['bankDetails','❌\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','🪙\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','\x20\x20\x20❌\x20Error:\x20','globalCheckInterval','✅\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','\x20\x20\x20Amount\x20after\x20commission:\x20','8TlGEqY','setDate','PAID','\x20not\x20found,\x20clearing\x20timers','\x20not\x20enabled\x20for\x20shop\x20','Automatically\x20expired\x20after\x20','⏰\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','\x20commission\x20for\x20shop\x20','🛑\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','\x20\x20\x20-\x20GatewayPaymentId:\x20','🪙\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','\x20\x20\x20📍\x20Source:\x20','\x20days\x20without\x20payment\x20confirmation','1600240sAGtAy','\x20expired','toFixed','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','\x20checked,\x20','🪙\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','\x20\x20\x20-\x20Gateway:\x20','currencyService','\x20commission:\x20','\x20completed\x20for\x20payment\x20','size','telegramBotService','shopId','💰\x20[CHECK]\x20Payment\x20','description','__esModule',',\x20clearing\x20individual\x20timers','expired','./currencyService','not\x20confirmed','58eqGywb','681nVrIgL','⏰\x20[HOURLY]\x20Payment\x20','toISOString','❌\x20[HOURLY]\x20Payment\x20','coinToPayStatusService','./gateways/coinToPay2Service','checkExpiredPayments','logCoinToPayStatus','\x20(after\x20','gatewayOrderId','\x20status:\x20','checkPaymentById','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','Shop\x20webhook\x20sent\x20to\x20','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','\x20for\x20payment\x20','toLowerCase','✅\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','🧹\x20[CHECK]\x20Payment\x20','sendPaymentNotification','delete','cointopay_status_check_error','floor','checkAllPendingPayments','🪙\x20[GLOBAL]\x20Found\x20','cointopay2','\x20marked\x20as\x20paid\x20at:\x20','⚠️\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','created','\x20payment\x20','getServiceStats','\x20initial\x20timers\x20for\x20payment\x20','delay','🪙\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','4LadqZr','coinToPay2Service','gateway','checkSinglePayment','Success','settings',',\x20status=','checkPaymentStatus','log','TesSoft\x20Payment\x20System/1.0','\x20seconds\x20(','\x20details:','webhookUrl','logShopWebhookError','⏰\x20[GLOBAL]\x20Payment\x20','customerEmail','cointopay_status_check_','POST','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','\x20\x20\x20-\x20ShopId:\x20','clearPaymentTimers','payment.success','ms)',',\x20gateway\x20','map','payment.failed',':\x20type=','./loggerService','✅\x20[HOURLY]\x20Payment\x20','adminNotes','-day\x20timeout','findUnique','logWhiteDomainError','cointopay_auto_expired','schedulePaymentChecks','transactionId','\x20days,\x20marking\x20as\x20EXPIRED','⏰\x20[GLOBAL]\x20Found\x20','🪙\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','amountAfterGatewayCommissionUSDT','../config/database','🆔\x20[CHECK]\x20Transaction\x20ID:\x20','get','\x20to\x20clear','\x20current\x20status:\x20','\x20\x20\x20-\x20paymentId:\x20','defineProperty','\x20\x20\x20-\x20Status:\x20','🪙\x20[ERROR]\x20CoinToPay\x20Error:\x20','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','EXPIRED','\x20with\x20status\x20','logShopWebhookSent','SINGLE','COINTOPAY_ERROR','create','❌\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','getDate','\x20found:','\x20in\x20',',\x20currentPayments=','currency','stack','🪙\x20[DEBUG]\x20Creating\x20','\x20in\x20shop\x20','text','Failed\x20to\x20send\x20shop\x20webhook:','\x20status\x20is\x20','\x20not\x20found\x20in\x20database','❌\x20[TIMER]\x20Failed\x20individual\x20check\x20#','\x20\x20\x20Gateway\x20','GLOBAL_CHECK_INTERVAL_MS','commission','✅\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','4948245mvbCIt','type','paymentDetails','🛑\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','PENDING','⏰\x20[EXPIRY]\x20Payment\x20','getPaymentTimerInfo','orderId','confirmedOn','paymentTimers','COMPLETED','gatewayPaymentId','../types/gateway','set','\x20individual\x20payment\x20timers','📊\x20[HOURLY]\x20Payment\x20','Webhook\x20event\x20','status_check','\x20\x20\x20Amount:\x20','timers','webhookEvents','13337445doCddQ','\x20days','amount','webhook_send','\x20\x20\x20-\x20gatewayPaymentId:\x20','\x20triggered\x20for\x20payment\x20','COINTOPAY_STATUS_CHANGE','Failed\x20to\x20mark\x20payment\x20as\x20expired','stopPeriodicStatusCheck','payment','❌\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','getGatewayIdByName','\x20\x20\x20📝\x20Context:','error','not\x20found','🪙\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','timestamp','.\x20Remaining\x20active\x20timers:\x20','\x20is\x20too\x20new\x20(','convertToUSDT','✅\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','🔍\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','coinToPayService','\x20has\x20no\x20gatewayPaymentId,\x20skipping','gatewaySettings','🪙\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','payment.pending','push','unknown','\x20status\x20from\x20','\x20\x20\x20📅\x20Time:\x20','✅\x20[CHECK]\x20Payment\x20','5bMaMMW','./gateways/coinToPayService','currentPayments','📈\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','1\x20minute','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','getGatewayCommission','CoinToPayStatusService','Payment\x20older\x20than\x20','CoinToPayService','\x20days\x20(created\x20before\x20','\x20status\x20changed\x20to\x20','shop','\x20\x20\x20-\x20Amount:\x20','737499xouYGg','\x20\x20\x20📊\x20Status:\x20','auto_expire','values','paymentLink','\x20is\x20older\x20than\x20','EXPIRY_DAYS','default','sendShopWebhook','remitterIban','📊\x20[CHECK]\x20Payment\x20','now','getTime','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','sendPaymentStatusNotification','📊\x20[CHECK]\x20CoinToPay2\x20payment\x20','❌\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','⚠️\x20[CHECK]\x20Payment\x20','stringify','includes','amountUSDT','Gateway\x20','forEach','loggerService','iban','5\x20minutes','update','from','catch','findMany','webhookLog','\x20USDT','\x20expired\x20CoinToPay\x20payments','\x20updated\x20successfully','length','./telegramBotService','✅\x20[DEBUG]\x20Successfully\x20scheduled\x20','message','\x20status\x20unchanged\x20(','\x20->\x20','paymentId','status','2042916IDkKpZ','paymentLinkId','❌\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','checkSinglePaymentById','FAILED','✅\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','❌\x20[CHECK]\x20Payment\x20','parse','failed','🔍\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','❌\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','4341554iVclMe',',\x20stopping\x20individual\x20checks','createdAt','cointopay','logCoinToPayError'];a38_0x51a2=function(){return _0x4996b4;};return a38_0x51a2();}var __importDefault=this&&this['__importDefault']||function(_0x1fe952){const _0x44eaba=a38_0x4cb6;return _0x1fe952&&_0x1fe952[_0x44eaba(0x19e)]?_0x1fe952:{'default':_0x1fe952};};Object[a38_0x1d2569(0x1f4)](exports,a38_0x1d2569(0x19e),{'value':!![]}),exports['coinToPayStatusService']=exports[a38_0x1d2569(0x24d)]=void 0x0;const coinToPayService_1=require(a38_0x1d2569(0x247)),coinToPay2Service_1=require(a38_0x1d2569(0x1a9)),gateway_1=require(a38_0x1d2569(0x21c)),database_1=__importDefault(require(a38_0x1d2569(0x1ee))),telegramBotService_1=require(a38_0x1d2569(0x277)),loggerService_1=require(a38_0x1d2569(0x1e1)),currencyService_1=require(a38_0x1d2569(0x1a1));class CoinToPayStatusService{constructor(){const _0x38fd56=a38_0x1d2569;this[_0x38fd56(0x17f)]=null,this['GLOBAL_CHECK_INTERVAL_MS']=0x3c*0x3c*0x3e8,this[_0x38fd56(0x25a)]=0x5,this[_0x38fd56(0x219)]=new Map(),this[_0x38fd56(0x23c)]=new coinToPayService_1[(_0x38fd56(0x24f))](),this[_0x38fd56(0x1c7)]=new coinToPay2Service_1['CoinToPay2Service'](),console[_0x38fd56(0x1ce)](_0x38fd56(0x18c));}[a38_0x1d2569(0x1e8)](_0x2b2e9a,_0x34d99b){const _0x23bf01=a38_0x1d2569;console[_0x23bf01(0x1ce)](_0x23bf01(0x1c5)),console[_0x23bf01(0x1ce)](_0x23bf01(0x1f3)+_0x2b2e9a),console[_0x23bf01(0x1ce)](_0x23bf01(0x229)+_0x34d99b),this[_0x23bf01(0x1da)](_0x2b2e9a);const _0x44ce7a=[],_0x16b384=new Date(),_0xc086ba=[{'delay':0x1*0x3c*0x3e8,'description':_0x23bf01(0x24a)},{'delay':0x2*0x3c*0x3e8,'description':'2\x20minutes'},{'delay':0x5*0x3c*0x3e8,'description':_0x23bf01(0x26d)},{'delay':0x5*0x3c*0x3e8,'description':_0x23bf01(0x26d)}];console[_0x23bf01(0x1ce)](_0x23bf01(0x205)+_0xc086ba[_0x23bf01(0x276)]+_0x23bf01(0x1c3)+_0x2b2e9a);let _0x141c53=0x0;_0xc086ba[_0x23bf01(0x26a)]((_0x1a9c5d,_0x26668a)=>{const _0x4b1883=_0x23bf01;_0x141c53+=_0x1a9c5d[_0x4b1883(0x1c4)];const _0x161194=setTimeout(async()=>{const _0x419845=_0x4b1883;console['log']('🪙\x20[TIMER]\x20Individual\x20check\x20#'+(_0x26668a+0x1)+_0x419845(0x22a)+_0x2b2e9a+_0x419845(0x1ac)+_0x1a9c5d[_0x419845(0x19d)]+')');try{await this[_0x419845(0x281)](_0x2b2e9a),console[_0x419845(0x1ce)]('✅\x20[TIMER]\x20Individual\x20check\x20#'+(_0x26668a+0x1)+_0x419845(0x198)+_0x2b2e9a);}catch(_0x7f2bf9){console[_0x419845(0x232)](_0x419845(0x20b)+(_0x26668a+0x1)+_0x419845(0x1b3)+_0x2b2e9a+':',_0x7f2bf9),this[_0x419845(0x17a)](_0x2b2e9a,_0x34d99b,_0x7f2bf9,_0x419845(0x221),{'checkNumber':_0x26668a+0x1,'scheduledAfter':_0x1a9c5d[_0x419845(0x19d)],'isIndividualCheck':!![]});}},_0x141c53);_0x44ce7a[_0x4b1883(0x241)](_0x161194),console['log']('⏰\x20[DEBUG]\x20Scheduled\x20check\x20#'+(_0x26668a+0x1)+_0x4b1883(0x1b3)+_0x2b2e9a+_0x4b1883(0x201)+_0x141c53/0x3e8+_0x4b1883(0x1d0)+_0x1a9c5d[_0x4b1883(0x19d)]+')');});const _0x5a77fa=setInterval(async()=>{const _0x427967=_0x23bf01;console['log']('🪙\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20'+_0x2b2e9a);try{const _0xe80ab3=await database_1['default']['payment'][_0x427967(0x1e5)]({'where':{'id':_0x2b2e9a},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0xe80ab3){console[_0x427967(0x1ce)](_0x427967(0x1a7)+_0x2b2e9a+_0x427967(0x185)),this[_0x427967(0x1da)](_0x2b2e9a);return;}console[_0x427967(0x1ce)](_0x427967(0x21f)+_0x2b2e9a+_0x427967(0x1f2)+_0xe80ab3[_0x427967(0x27d)]);if(_0xe80ab3[_0x427967(0x27d)]!==_0x427967(0x214)){console[_0x427967(0x1ce)](_0x427967(0x1e2)+_0x2b2e9a+_0x427967(0x209)+_0xe80ab3[_0x427967(0x27d)]+_0x427967(0x177)),this[_0x427967(0x1da)](_0x2b2e9a);return;}const _0x594c26=Math[_0x427967(0x1ba)]((Date['now']()-_0xe80ab3['createdAt'][_0x427967(0x260)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x594c26>=this[_0x427967(0x25a)]){console[_0x427967(0x1ce)](_0x427967(0x1a5)+_0x2b2e9a+_0x427967(0x259)+this[_0x427967(0x25a)]+_0x427967(0x1b0)),this['clearPaymentTimers'](_0x2b2e9a);return;}await this[_0x427967(0x281)](_0x2b2e9a),console[_0x427967(0x1ce)]('✅\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20'+_0x2b2e9a);}catch(_0x10e842){console[_0x427967(0x232)]('❌\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20'+_0x2b2e9a+':',_0x10e842),this[_0x427967(0x17a)](_0x2b2e9a,_0x34d99b,_0x10e842,_0x427967(0x221),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x44ce7a['push'](_0x5a77fa),this[_0x23bf01(0x219)][_0x23bf01(0x21d)](_0x2b2e9a,{'timers':_0x44ce7a,'paymentId':_0x2b2e9a,'gatewayPaymentId':_0x34d99b,'createdAt':_0x16b384}),console[_0x23bf01(0x1ce)](_0x23bf01(0x278)+_0xc086ba[_0x23bf01(0x276)]+_0x23bf01(0x24b)+_0x2b2e9a),console[_0x23bf01(0x1ce)]('📊\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20'+this[_0x23bf01(0x219)][_0x23bf01(0x199)]),this[_0x23bf01(0x1ab)](_0x2b2e9a,_0x34d99b,_0x23bf01(0x214),_0x23bf01(0x214),_0x23bf01(0x221),{'action':'schedule_created','scheduledChecks':_0xc086ba[_0x23bf01(0x276)],'firstCheckIn':_0xc086ba[0x0][_0x23bf01(0x1c4)]/0x3e8,'totalTimers':this['paymentTimers'][_0x23bf01(0x199)]});}[a38_0x1d2569(0x1da)](_0x35ea53){const _0x26e957=a38_0x1d2569,_0x53a57d=this['paymentTimers']['get'](_0x35ea53);_0x53a57d?(console[_0x26e957(0x1ce)]('🧹\x20[DEBUG]\x20Clearing\x20'+_0x53a57d[_0x26e957(0x223)]['length']+'\x20timers\x20for\x20payment\x20'+_0x35ea53),_0x53a57d['timers'][_0x26e957(0x26a)]((_0x38008b,_0x52ec87)=>{const _0x16d736=_0x26e957;_0x38008b&&(clearTimeout(_0x38008b),clearInterval(_0x38008b),console[_0x16d736(0x1ce)]('🧹\x20[DEBUG]\x20Cleared\x20timer\x20#'+(_0x52ec87+0x1)+_0x16d736(0x1b3)+_0x35ea53));}),this['paymentTimers'][_0x26e957(0x1b8)](_0x35ea53),console[_0x26e957(0x1ce)](_0x26e957(0x1b5)+_0x35ea53+_0x26e957(0x237)+this['paymentTimers'][_0x26e957(0x199)])):console[_0x26e957(0x1ce)](_0x26e957(0x1bf)+_0x35ea53+_0x26e957(0x1f1));}async[a38_0x1d2569(0x281)](_0x589be7){const _0x47525e=a38_0x1d2569;console[_0x47525e(0x1ce)](_0x47525e(0x23b)+_0x589be7);const _0x19f39f=await database_1['default'][_0x47525e(0x22e)][_0x47525e(0x1e5)]({'where':{'id':_0x589be7},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x19f39f){console[_0x47525e(0x1ce)](_0x47525e(0x284)+_0x589be7+_0x47525e(0x20a));return;}console[_0x47525e(0x1ce)](_0x47525e(0x25e)+_0x589be7+_0x47525e(0x200)),console[_0x47525e(0x1ce)](_0x47525e(0x195)+_0x19f39f[_0x47525e(0x1c8)]),console[_0x47525e(0x1ce)](_0x47525e(0x1f5)+_0x19f39f[_0x47525e(0x27d)]),console[_0x47525e(0x1ce)](_0x47525e(0x18b)+_0x19f39f[_0x47525e(0x21b)]),console[_0x47525e(0x1ce)](_0x47525e(0x253)+_0x19f39f[_0x47525e(0x227)]+'\x20'+_0x19f39f[_0x47525e(0x203)]),console['log'](_0x47525e(0x1d9)+_0x19f39f['shopId']);if(_0x19f39f[_0x47525e(0x1c8)]!==_0x47525e(0x179)&&_0x19f39f[_0x47525e(0x1c8)]!==_0x47525e(0x1bd)){console[_0x47525e(0x1ce)](_0x47525e(0x265)+_0x589be7+_0x47525e(0x1f7)+_0x19f39f['gateway']+')');return;}if(_0x19f39f[_0x47525e(0x27d)]!==_0x47525e(0x214)){console[_0x47525e(0x1ce)](_0x47525e(0x265)+_0x589be7+_0x47525e(0x209)+_0x19f39f['status']+_0x47525e(0x177)),this[_0x47525e(0x1da)](_0x589be7);return;}if(!_0x19f39f[_0x47525e(0x21b)]){console[_0x47525e(0x1ce)](_0x47525e(0x265)+_0x589be7+'\x20has\x20no\x20gatewayPaymentId');return;}console[_0x47525e(0x1ce)](_0x47525e(0x245)+_0x589be7+'\x20is\x20valid\x20for\x20checking,\x20proceeding...'),await this[_0x47525e(0x1c9)](_0x19f39f);}[a38_0x1d2569(0x1ab)](_0x46d3bf,_0x5eea26,_0x4d7ecf,_0x2a7bd2,_0x4d57d1,_0x11f065){const _0x38bca8=a38_0x1d2569,_0x29af8={'type':_0x38bca8(0x22b),'paymentId':_0x46d3bf,'gatewayPaymentId':_0x5eea26,'oldStatus':_0x4d7ecf,'newStatus':_0x2a7bd2,'source':_0x4d57d1,'timestamp':new Date()[_0x38bca8(0x1a6)](),'details':_0x11f065||{}};loggerService_1[_0x38bca8(0x26b)]['logCoinToPayStatus'](_0x29af8),console[_0x38bca8(0x1ce)](_0x38bca8(0x23f)+_0x46d3bf+'\x20('+_0x5eea26+')'),console['log'](_0x38bca8(0x255)+_0x4d7ecf+_0x38bca8(0x27b)+_0x2a7bd2),console['log'](_0x38bca8(0x18d)+_0x4d57d1),console[_0x38bca8(0x1ce)](_0x38bca8(0x244)+_0x29af8[_0x38bca8(0x236)]),_0x11f065&&console[_0x38bca8(0x1ce)]('\x20\x20\x20📝\x20Details:',_0x11f065);}[a38_0x1d2569(0x17a)](_0x201d58,_0x3bf1d6,_0x2229c2,_0x5eafe2,_0x3c7421){const _0x1eaf27=a38_0x1d2569,_0x3057cc={'type':_0x1eaf27(0x1fc),'paymentId':_0x201d58,'gatewayPaymentId':_0x3bf1d6,'error':_0x2229c2 instanceof Error?{'message':_0x2229c2[_0x1eaf27(0x279)],'stack':_0x2229c2[_0x1eaf27(0x204)]}:_0x2229c2,'source':_0x5eafe2,'timestamp':new Date()[_0x1eaf27(0x1a6)](),'context':_0x3c7421||{}};loggerService_1[_0x1eaf27(0x26b)][_0x1eaf27(0x17a)](_0x3057cc),console[_0x1eaf27(0x232)](_0x1eaf27(0x1f6)+_0x201d58+'\x20('+_0x3bf1d6+')'),console[_0x1eaf27(0x232)](_0x1eaf27(0x17e)+(_0x2229c2 instanceof Error?_0x2229c2['message']:_0x2229c2)),console[_0x1eaf27(0x232)](_0x1eaf27(0x18d)+_0x5eafe2),console[_0x1eaf27(0x232)](_0x1eaf27(0x244)+_0x3057cc['timestamp']),_0x3c7421&&console[_0x1eaf27(0x232)](_0x1eaf27(0x231),_0x3c7421);}['startPeriodicStatusCheck'](){const _0x2092e1=a38_0x1d2569;console[_0x2092e1(0x1ce)](_0x2092e1(0x194)),this[_0x2092e1(0x1bb)]()[_0x2092e1(0x270)](_0x38694b=>{const _0x2df1c4=_0x2092e1;console[_0x2df1c4(0x232)](_0x2df1c4(0x264),_0x38694b);}),this[_0x2092e1(0x17f)]=setInterval(async()=>{const _0x2df5b6=_0x2092e1;try{console[_0x2df5b6(0x1ce)](_0x2df5b6(0x1ec)),await this[_0x2df5b6(0x1bb)](),console[_0x2df5b6(0x1ce)](_0x2df5b6(0x283));}catch(_0x9dafb9){console['error'](_0x2df5b6(0x22f),_0x9dafb9);}},this['GLOBAL_CHECK_INTERVAL_MS']),console[_0x2092e1(0x1ce)]('✅\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)');}[a38_0x1d2569(0x22d)](){const _0x2e6829=a38_0x1d2569;console['log'](_0x2e6829(0x18a));this[_0x2e6829(0x17f)]&&(clearInterval(this[_0x2e6829(0x17f)]),this[_0x2e6829(0x17f)]=null,console['log'](_0x2e6829(0x213)));const _0x5aa926=this[_0x2e6829(0x219)]['size'];for(const [_0x192d14]of this[_0x2e6829(0x219)]){this[_0x2e6829(0x1da)](_0x192d14);}console[_0x2e6829(0x1ce)]('🛑\x20[SHUTDOWN]\x20Cleared\x20'+_0x5aa926+_0x2e6829(0x21e));}async[a38_0x1d2569(0x1bb)](){const _0x16de58=a38_0x1d2569;try{console[_0x16de58(0x1ce)](_0x16de58(0x17d));const _0x569246=await database_1[_0x16de58(0x25b)][_0x16de58(0x22e)][_0x16de58(0x271)]({'where':{'gateway':{'in':['cointopay',_0x16de58(0x1bd)]},'status':_0x16de58(0x214),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x16de58(0x1ce)](_0x16de58(0x1bc)+_0x569246[_0x16de58(0x276)]+'\x20pending\x20CoinToPay\x20payments');if(_0x569246['length']===0x0){console[_0x16de58(0x1ce)](_0x16de58(0x234));return;}const _0x593da4=await this[_0x16de58(0x1aa)](_0x569246);console[_0x16de58(0x1ce)](_0x16de58(0x1eb)+_0x593da4[_0x16de58(0x276)]+_0x16de58(0x274));let _0x41c6f2=0x0,_0x1e5d64=0x0;for(const _0x6e658a of _0x569246){try{if(_0x593da4[_0x16de58(0x267)](_0x6e658a['id'])){console[_0x16de58(0x1ce)](_0x16de58(0x1d4)+_0x6e658a['id']+'\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check'),_0x1e5d64++;continue;}if(this[_0x16de58(0x219)]['has'](_0x6e658a['id'])){console['log'](_0x16de58(0x1d4)+_0x6e658a['id']+_0x16de58(0x235)),_0x1e5d64++;continue;}const _0x4e4366=(Date['now']()-_0x6e658a[_0x16de58(0x178)][_0x16de58(0x260)]())/(0x3e8*0x3c*0x3c);if(_0x4e4366<0x1){console[_0x16de58(0x1ce)](_0x16de58(0x1d4)+_0x6e658a['id']+_0x16de58(0x238)+_0x4e4366[_0x16de58(0x191)](0x1)+'h),\x20skipping\x20global\x20check'),_0x1e5d64++;continue;}console[_0x16de58(0x1ce)]('🔍\x20[GLOBAL]\x20Checking\x20old\x20payment\x20'+_0x6e658a['id']+'\x20(age:\x20'+_0x4e4366[_0x16de58(0x191)](0x1)+'h)'),await this[_0x16de58(0x1c9)](_0x6e658a),_0x41c6f2++,await new Promise(_0x14021b=>setTimeout(_0x14021b,0x7d0));}catch(_0x336987){console[_0x16de58(0x232)](_0x16de58(0x280)+_0x6e658a['id']+':',_0x336987),this[_0x16de58(0x17a)](_0x6e658a['id'],_0x6e658a[_0x16de58(0x21b)]||_0x16de58(0x242),_0x336987,_0x16de58(0x221),{'isGlobalCheck':!![],'paymentAmount':_0x6e658a[_0x16de58(0x227)],'paymentCurrency':_0x6e658a['currency'],'shopId':_0x6e658a[_0x16de58(0x19b)],'createdAt':_0x6e658a[_0x16de58(0x178)]}),loggerService_1[_0x16de58(0x26b)][_0x16de58(0x1e6)]('cointopay','/status/'+_0x6e658a[_0x16de58(0x21b)],_0x336987);}}console['log'](_0x16de58(0x180)+_0x41c6f2+_0x16de58(0x193)+_0x1e5d64+'\x20skipped,\x20'+_0x593da4[_0x16de58(0x276)]+_0x16de58(0x190));}catch(_0x4f14df){console[_0x16de58(0x232)](_0x16de58(0x288),_0x4f14df);}}async[a38_0x1d2569(0x1aa)](_0x31ead2){const _0x33f9dd=a38_0x1d2569,_0x19a3b2=[],_0x1df4c2=new Date();_0x1df4c2[_0x33f9dd(0x183)](_0x1df4c2[_0x33f9dd(0x1ff)]()-this[_0x33f9dd(0x25a)]),console[_0x33f9dd(0x1ce)](_0x33f9dd(0x188)+this[_0x33f9dd(0x25a)]+_0x33f9dd(0x250)+_0x1df4c2['toISOString']()+')');for(const _0x5321aa of _0x31ead2){if(_0x5321aa[_0x33f9dd(0x178)]<_0x1df4c2){console['log'](_0x33f9dd(0x215)+_0x5321aa['id']+_0x33f9dd(0x259)+this['EXPIRY_DAYS']+_0x33f9dd(0x1ea));try{this[_0x33f9dd(0x1ab)](_0x5321aa['id'],_0x5321aa['gatewayPaymentId']||'unknown',_0x33f9dd(0x214),_0x33f9dd(0x1f8),_0x33f9dd(0x256),{'reason':_0x33f9dd(0x24e)+this[_0x33f9dd(0x25a)]+_0x33f9dd(0x226),'createdAt':_0x5321aa[_0x33f9dd(0x178)],'daysSinceCreation':Math['floor']((Date[_0x33f9dd(0x25f)]()-_0x5321aa[_0x33f9dd(0x178)][_0x33f9dd(0x260)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x5321aa[_0x33f9dd(0x227)],'paymentCurrency':_0x5321aa[_0x33f9dd(0x203)],'shopId':_0x5321aa[_0x33f9dd(0x19b)]}),await database_1[_0x33f9dd(0x25b)][_0x33f9dd(0x22e)][_0x33f9dd(0x26e)]({'where':{'id':_0x5321aa['id']},'data':{'status':_0x33f9dd(0x1f8),'updatedAt':new Date(),'adminNotes':_0x33f9dd(0x187)+this[_0x33f9dd(0x25a)]+_0x33f9dd(0x18e)}}),await database_1[_0x33f9dd(0x25b)]['webhookLog'][_0x33f9dd(0x1fd)]({'data':{'paymentId':_0x5321aa['id'],'shopId':_0x5321aa[_0x33f9dd(0x19b)],'event':_0x33f9dd(0x1e7),'statusCode':0xc8,'responseBody':JSON[_0x33f9dd(0x266)]({'reason':_0x33f9dd(0x24e)+this['EXPIRY_DAYS']+'\x20days','createdAt':_0x5321aa[_0x33f9dd(0x178)],'expiredAt':new Date()[_0x33f9dd(0x1a6)](),'daysSinceCreation':Math['floor']((Date[_0x33f9dd(0x25f)]()-_0x5321aa[_0x33f9dd(0x178)][_0x33f9dd(0x260)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x33f9dd(0x25c)](_0x5321aa,_0x33f9dd(0x1f8)),await this[_0x33f9dd(0x262)](_0x5321aa,_0x33f9dd(0x1f8)),this[_0x33f9dd(0x1da)](_0x5321aa['id']),_0x19a3b2[_0x33f9dd(0x241)](_0x5321aa['id']),console[_0x33f9dd(0x1ce)]('✅\x20[EXPIRY]\x20Payment\x20'+_0x5321aa['id']+'\x20marked\x20as\x20EXPIRED\x20due\x20to\x20'+this[_0x33f9dd(0x25a)]+_0x33f9dd(0x1e4));}catch(_0x29f7f6){console[_0x33f9dd(0x232)](_0x33f9dd(0x1fe)+_0x5321aa['id']+':',_0x29f7f6),this['logCoinToPayError'](_0x5321aa['id'],_0x5321aa[_0x33f9dd(0x21b)]||_0x33f9dd(0x242),_0x29f7f6,_0x33f9dd(0x256),{'reason':_0x33f9dd(0x22c),'createdAt':_0x5321aa[_0x33f9dd(0x178)],'daysSinceCreation':Math[_0x33f9dd(0x1ba)]((Date['now']()-_0x5321aa[_0x33f9dd(0x178)][_0x33f9dd(0x260)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x19a3b2;}async[a38_0x1d2569(0x1c9)](_0x144f56){const _0x22582d=a38_0x1d2569;if(!_0x144f56[_0x22582d(0x21b)]){console[_0x22582d(0x1ce)]('⚠️\x20[CHECK]\x20Payment\x20'+_0x144f56['id']+_0x22582d(0x23d));return;}console[_0x22582d(0x1ce)]('🔍\x20[CHECK]\x20Checking\x20'+_0x144f56[_0x22582d(0x1c8)]+_0x22582d(0x1c1)+_0x144f56['id']+'\x20('+_0x144f56[_0x22582d(0x21b)]+')');try{let _0x363946;_0x144f56[_0x22582d(0x1c8)]===_0x22582d(0x1bd)?(_0x363946=await this['coinToPay2Service'][_0x22582d(0x1cd)](_0x144f56[_0x22582d(0x21b)]),console[_0x22582d(0x1ce)](_0x22582d(0x263)+_0x144f56['id']+_0x22582d(0x1ae)+_0x363946['status'])):(_0x363946=await this[_0x22582d(0x23c)][_0x22582d(0x1cd)](_0x144f56[_0x22582d(0x21b)]),console['log']('📊\x20[CHECK]\x20CoinToPay\x20payment\x20'+_0x144f56['id']+_0x22582d(0x1ae)+_0x363946['status']));_0x363946[_0x22582d(0x212)]&&console[_0x22582d(0x1ce)]('📊\x20[CHECK]\x20Payment\x20'+_0x144f56['id']+_0x22582d(0x1d1),{'iban':_0x363946[_0x22582d(0x212)][_0x22582d(0x26c)]||_0x22582d(0x233),'transactionId':_0x363946[_0x22582d(0x212)][_0x22582d(0x1e9)],'createdOn':_0x363946[_0x22582d(0x212)]['createdOn'],'confirmedOn':_0x363946['paymentDetails']['confirmedOn']||_0x22582d(0x1a2)});if(_0x363946[_0x22582d(0x27d)]!==_0x144f56['status']){console[_0x22582d(0x1ce)]('🔄\x20[CHECK]\x20Updating\x20payment\x20'+_0x144f56['id']+_0x22582d(0x243)+_0x144f56[_0x22582d(0x27d)]+'\x20to\x20'+_0x363946[_0x22582d(0x27d)]),this[_0x22582d(0x1ab)](_0x144f56['id'],_0x144f56[_0x22582d(0x21b)],_0x144f56['status'],_0x363946[_0x22582d(0x27d)],_0x22582d(0x221),{'paymentDetails':_0x363946[_0x22582d(0x212)],'amount':_0x363946[_0x22582d(0x227)],'currency':_0x363946[_0x22582d(0x203)],'shopId':_0x144f56[_0x22582d(0x19b)],'checkTimestamp':new Date()[_0x22582d(0x1a6)]()});const _0x427772={'status':_0x363946[_0x22582d(0x27d)],'updatedAt':new Date()};if(_0x363946[_0x22582d(0x27d)]===_0x22582d(0x184)&&_0x144f56[_0x22582d(0x27d)]!==_0x22582d(0x184)){_0x427772['paidAt']=new Date();if(!_0x144f56[_0x22582d(0x268)]){const _0x2faf52=await currencyService_1[_0x22582d(0x196)][_0x22582d(0x239)](_0x144f56['amount'],_0x144f56[_0x22582d(0x203)]);_0x427772[_0x22582d(0x268)]=_0x2faf52;const _0x5e41b1=await this[_0x22582d(0x24c)](_0x144f56[_0x22582d(0x19b)],_0x144f56[_0x22582d(0x1c8)]),_0x3633d8=_0x2faf52*(0x1-_0x5e41b1/0x64);_0x427772[_0x22582d(0x1ed)]=_0x3633d8,console[_0x22582d(0x1ce)]('💰\x20[CHECK]\x20Payment\x20'+_0x144f56['id']+'\x20amounts\x20calculated:'),console[_0x22582d(0x1ce)](_0x22582d(0x222)+_0x144f56['amount']+'\x20'+_0x144f56['currency']+_0x22582d(0x27b)+_0x2faf52[_0x22582d(0x191)](0x6)+'\x20USDT'),console[_0x22582d(0x1ce)](_0x22582d(0x20c)+_0x144f56[_0x22582d(0x1c8)]+_0x22582d(0x197)+_0x5e41b1+'%'),console[_0x22582d(0x1ce)](_0x22582d(0x181)+_0x3633d8[_0x22582d(0x191)](0x6)+_0x22582d(0x273));}console[_0x22582d(0x1ce)](_0x22582d(0x19c)+_0x144f56['id']+_0x22582d(0x1be)+_0x427772['paidAt'][_0x22582d(0x1a6)]());}if(_0x363946[_0x22582d(0x212)]){const _0x307489=_0x363946['paymentDetails'];_0x307489[_0x22582d(0x26c)]&&(_0x427772[_0x22582d(0x25d)]=_0x307489[_0x22582d(0x26c)],console[_0x22582d(0x1ce)]('🏦\x20[CHECK]\x20Saved\x20IBAN:\x20'+_0x307489[_0x22582d(0x26c)]));if(_0x307489['bankDetails']){const _0x4bff23=_0x144f56['adminNotes']||'',_0x56e3d1='Bank\x20Details:\x20'+_0x307489[_0x22582d(0x17b)];_0x427772[_0x22582d(0x1e3)]=_0x4bff23?_0x4bff23+'\x0a\x0a'+_0x56e3d1:_0x56e3d1,console['log']('🏦\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes');}_0x307489[_0x22582d(0x1e9)]&&console[_0x22582d(0x1ce)](_0x22582d(0x1ef)+_0x307489['transactionId']),_0x307489[_0x22582d(0x218)]&&console[_0x22582d(0x1ce)](_0x22582d(0x23a)+_0x307489[_0x22582d(0x218)]);}await database_1[_0x22582d(0x25b)][_0x22582d(0x22e)][_0x22582d(0x26e)]({'where':{'id':_0x144f56['id']},'data':_0x427772});if(_0x363946[_0x22582d(0x27d)]===_0x22582d(0x184)&&_0x144f56[_0x22582d(0x27d)]!=='PAID'){console[_0x22582d(0x1ce)]('📈\x20[COINTOPAY]\x20Payment\x20'+_0x144f56['id']+_0x22582d(0x261));const _0xce7d53=await database_1[_0x22582d(0x25b)][_0x22582d(0x22e)]['findUnique']({'where':{'id':_0x144f56['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0xce7d53?.[_0x22582d(0x27f)]&&_0xce7d53[_0x22582d(0x258)])try{const _0x412f36=_0xce7d53[_0x22582d(0x258)];console['log'](_0x22582d(0x249)+_0x412f36['id']+_0x22582d(0x1e0)+_0x412f36['type']+_0x22582d(0x202)+_0x412f36[_0x22582d(0x248)]+_0x22582d(0x1cc)+_0x412f36[_0x22582d(0x27d)]);const _0x31b238=_0x412f36[_0x22582d(0x248)]+0x1,_0xb7f10a=_0x412f36[_0x22582d(0x211)]===_0x22582d(0x1fb)?_0x22582d(0x21a):_0x412f36['status'];await database_1['default'][_0x22582d(0x258)]['update']({'where':{'id':_0x412f36['id']},'data':{'currentPayments':_0x31b238,'status':_0xb7f10a,'updatedAt':new Date()}}),console[_0x22582d(0x1ce)]('✅\x20[COINTOPAY]\x20Payment\x20link\x20'+_0x412f36['id']+'\x20updated:\x20currentPayments='+_0x412f36[_0x22582d(0x248)]+'\x20->\x20'+_0x31b238+',\x20status='+_0x412f36['status']+_0x22582d(0x27b)+_0xb7f10a);}catch(_0x111f81){console[_0x22582d(0x232)]('❌\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:',_0x111f81);}else console['log']('📈\x20[COINTOPAY]\x20Payment\x20'+_0x144f56['id']+'\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link');}await database_1['default']['webhookLog'][_0x22582d(0x1fd)]({'data':{'paymentId':_0x144f56['id'],'shopId':_0x144f56[_0x22582d(0x19b)],'event':_0x22582d(0x1d6)+_0x363946[_0x22582d(0x27d)][_0x22582d(0x1b4)](),'statusCode':0xc8,'responseBody':JSON[_0x22582d(0x266)]({'oldStatus':_0x144f56['status'],'newStatus':_0x363946[_0x22582d(0x27d)],'paymentDetails':_0x363946[_0x22582d(0x212)],'checkedAt':new Date()[_0x22582d(0x1a6)]()})}}),await this[_0x22582d(0x25c)](_0x144f56,_0x363946[_0x22582d(0x27d)]),await this[_0x22582d(0x262)](_0x144f56,_0x363946['status']),_0x363946[_0x22582d(0x27d)]!==_0x22582d(0x214)&&(console[_0x22582d(0x1ce)](_0x22582d(0x1b6)+_0x144f56['id']+_0x22582d(0x251)+_0x363946[_0x22582d(0x27d)]+_0x22582d(0x19f)),this[_0x22582d(0x1da)](_0x144f56['id'])),console[_0x22582d(0x1ce)]('✅\x20[CHECK]\x20Payment\x20'+_0x144f56['id']+_0x22582d(0x275));}else console[_0x22582d(0x1ce)]('📊\x20[CHECK]\x20Payment\x20'+_0x144f56['id']+_0x22582d(0x27a)+_0x363946[_0x22582d(0x27d)]+')'),this[_0x22582d(0x1ab)](_0x144f56['id'],_0x144f56[_0x22582d(0x21b)],_0x144f56[_0x22582d(0x27d)],_0x363946[_0x22582d(0x27d)],_0x22582d(0x221),{'statusUnchanged':!![],'paymentDetails':_0x363946[_0x22582d(0x212)],'amount':_0x363946[_0x22582d(0x227)],'currency':_0x363946[_0x22582d(0x203)],'shopId':_0x144f56[_0x22582d(0x19b)],'checkTimestamp':new Date()[_0x22582d(0x1a6)]()});}catch(_0x146a0b){console['error'](_0x22582d(0x17c)+_0x144f56['id']+':',_0x146a0b),this['logCoinToPayError'](_0x144f56['id'],_0x144f56[_0x22582d(0x21b)],_0x146a0b,_0x22582d(0x221),{'paymentAmount':_0x144f56[_0x22582d(0x227)],'paymentCurrency':_0x144f56[_0x22582d(0x203)],'shopId':_0x144f56[_0x22582d(0x19b)],'createdAt':_0x144f56[_0x22582d(0x178)]}),await database_1[_0x22582d(0x25b)][_0x22582d(0x272)][_0x22582d(0x1fd)]({'data':{'paymentId':_0x144f56['id'],'shopId':_0x144f56[_0x22582d(0x19b)],'event':_0x22582d(0x1b9),'statusCode':0x1f4,'responseBody':JSON[_0x22582d(0x266)]({'error':_0x146a0b instanceof Error?_0x146a0b[_0x22582d(0x279)]:'Unknown\x20error','gatewayPaymentId':_0x144f56[_0x22582d(0x21b)],'checkedAt':new Date()[_0x22582d(0x1a6)]()})}});}}async[a38_0x1d2569(0x25c)](_0x5ad35f,_0x4b6219){const _0x49ac3b=a38_0x1d2569,_0x1237ec=Date['now']();try{const _0x2e2d0d=_0x5ad35f['shop'],_0x3cf9e0=_0x2e2d0d[_0x49ac3b(0x1cb)];if(!_0x3cf9e0?.[_0x49ac3b(0x1d2)]){console[_0x49ac3b(0x1ce)](_0x49ac3b(0x192)+_0x2e2d0d['id']);return;}const _0x5efc63=_0x4b6219===_0x49ac3b(0x184)?_0x49ac3b(0x1db):_0x4b6219===_0x49ac3b(0x282)?_0x49ac3b(0x1df):_0x4b6219===_0x49ac3b(0x1f8)?_0x49ac3b(0x1df):_0x49ac3b(0x240);if(!_0x3cf9e0[_0x49ac3b(0x224)]?.['includes'](_0x5efc63)){console['log'](_0x49ac3b(0x220)+_0x5efc63+_0x49ac3b(0x186)+_0x2e2d0d['id']);return;}const _0x40ee72=(0x0,gateway_1[_0x49ac3b(0x230)])(_0x5ad35f[_0x49ac3b(0x1c8)])||_0x5ad35f['gateway'],_0x3cacff={'event':_0x5efc63,'payment':{'id':_0x5ad35f['id'],'order_id':_0x5ad35f[_0x49ac3b(0x217)],'gateway_order_id':_0x5ad35f[_0x49ac3b(0x1ad)],'gateway':_0x40ee72,'amount':_0x5ad35f[_0x49ac3b(0x227)],'currency':_0x5ad35f[_0x49ac3b(0x203)],'status':_0x4b6219[_0x49ac3b(0x1b4)](),'customer_email':_0x5ad35f[_0x49ac3b(0x1d5)],'customer_name':_0x5ad35f['customerName'],'created_at':_0x5ad35f['createdAt'],'updated_at':new Date()}},_0x256393=await fetch(_0x3cf9e0[_0x49ac3b(0x1d2)],{'method':_0x49ac3b(0x1d7),'headers':{'Content-Type':'application/json','User-Agent':_0x49ac3b(0x1cf)},'body':JSON[_0x49ac3b(0x266)](_0x3cacff)}),_0x1bc7e8=Date[_0x49ac3b(0x25f)]()-_0x1237ec,_0x24a601=_0x256393['ok']?_0x49ac3b(0x1ca):await _0x256393[_0x49ac3b(0x207)]();loggerService_1[_0x49ac3b(0x26b)][_0x49ac3b(0x1fa)](_0x5ad35f['shopId'],_0x3cf9e0[_0x49ac3b(0x1d2)],_0x5efc63,_0x256393[_0x49ac3b(0x27d)],_0x1bc7e8,_0x3cacff),console[_0x49ac3b(0x1ce)](_0x49ac3b(0x1b1)+_0x3cf9e0[_0x49ac3b(0x1d2)]+_0x49ac3b(0x1f9)+_0x256393[_0x49ac3b(0x27d)]+'\x20('+_0x1bc7e8+_0x49ac3b(0x1dc));}catch(_0x36be04){console[_0x49ac3b(0x232)](_0x49ac3b(0x208),_0x36be04),loggerService_1[_0x49ac3b(0x26b)][_0x49ac3b(0x1d3)](_0x5ad35f[_0x49ac3b(0x19b)],_0x5ad35f['shop']?.[_0x49ac3b(0x1cb)]?.[_0x49ac3b(0x1d2)]||'unknown',_0x49ac3b(0x228),_0x36be04,{});}}async[a38_0x1d2569(0x262)](_0x11fb8f,_0x3d3fca){const _0x1d0296=a38_0x1d2569;try{const _0x178da9={'PENDING':_0x1d0296(0x1c0),'PAID':'paid','FAILED':_0x1d0296(0x286),'EXPIRED':_0x1d0296(0x1a0)},_0x118590=_0x178da9[_0x3d3fca];if(!_0x118590||_0x118590===_0x1d0296(0x1c0))return;await telegramBotService_1[_0x1d0296(0x19a)][_0x1d0296(0x1b7)](_0x11fb8f[_0x1d0296(0x19b)],_0x11fb8f,_0x118590);}catch(_0x54718c){console[_0x1d0296(0x232)]('Failed\x20to\x20send\x20Telegram\x20payment\x20notification:',_0x54718c);}}async[a38_0x1d2569(0x1af)](_0x2bba1b){const _0x1a532b=a38_0x1d2569;console['log'](_0x1a532b(0x287)+_0x2bba1b);const _0x351744=await database_1[_0x1a532b(0x25b)][_0x1a532b(0x22e)][_0x1a532b(0x1e5)]({'where':{'id':_0x2bba1b},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x351744)throw new Error('Payment\x20not\x20found');if(_0x351744['gateway']!==_0x1a532b(0x179)&&_0x351744['gateway']!==_0x1a532b(0x1bd))throw new Error('Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment');console[_0x1a532b(0x1ce)]('✅\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20'+_0x351744[_0x1a532b(0x1c8)]+_0x1a532b(0x1c1)+_0x2bba1b),await this[_0x1a532b(0x1c9)](_0x351744),console[_0x1a532b(0x1ce)](_0x1a532b(0x20f)+_0x2bba1b);}[a38_0x1d2569(0x1c2)](){const _0x27d506=a38_0x1d2569,_0x18d21b=this[_0x27d506(0x17f)]?this[_0x27d506(0x20d)]:undefined,_0x52f762=Array[_0x27d506(0x26f)](this[_0x27d506(0x219)][_0x27d506(0x257)]())[_0x27d506(0x1de)](_0x917a34=>({'paymentId':_0x917a34[_0x27d506(0x27c)],'gatewayPaymentId':_0x917a34[_0x27d506(0x21b)],'createdAt':_0x917a34[_0x27d506(0x178)],'timersCount':_0x917a34[_0x27d506(0x223)][_0x27d506(0x276)]}));return{'isActive':!!this[_0x27d506(0x17f)],'globalCheckIntervalMinutes':this[_0x27d506(0x20d)]/(0x3e8*0x3c),'expiryDays':this['EXPIRY_DAYS'],'activeIndividualTimers':this['paymentTimers'][_0x27d506(0x199)],'nextGlobalCheckIn':_0x18d21b,'paymentTimersDetails':_0x52f762};}[a38_0x1d2569(0x216)](_0x174af6){const _0x23275d=a38_0x1d2569,_0x12274a=this[_0x23275d(0x219)][_0x23275d(0x1f0)](_0x174af6);if(_0x12274a)return{'hasTimers':!![],'timersCount':_0x12274a[_0x23275d(0x223)][_0x23275d(0x276)],'createdAt':_0x12274a['createdAt'],'gatewayPaymentId':_0x12274a[_0x23275d(0x21b)]};return{'hasTimers':![]};}async[a38_0x1d2569(0x24c)](_0x232143,_0x10093d){const _0x407b10=a38_0x1d2569;try{const _0x2e227d=await database_1[_0x407b10(0x25b)][_0x407b10(0x252)][_0x407b10(0x1e5)]({'where':{'id':_0x232143},'select':{'gatewaySettings':!![]}});if(!_0x2e227d?.[_0x407b10(0x23e)])return console[_0x407b10(0x1ce)](_0x407b10(0x1b2)+_0x232143+',\x20using\x20default\x20commission\x2010%'),0xa;const _0x2ec56c=JSON[_0x407b10(0x285)](_0x2e227d['gatewaySettings']);for(const [_0x3886df,_0x2f3426]of Object['entries'](_0x2ec56c)){if(_0x3886df[_0x407b10(0x1b4)]()===_0x10093d[_0x407b10(0x1b4)]()){const _0x1ea1e8=_0x2f3426[_0x407b10(0x20e)]||0xa;return console['log'](_0x407b10(0x269)+_0x10093d+_0x407b10(0x189)+_0x232143+':\x20'+_0x1ea1e8+'%'),_0x1ea1e8;}}return console[_0x407b10(0x1ce)]('No\x20specific\x20commission\x20found\x20for\x20gateway\x20'+_0x10093d+_0x407b10(0x206)+_0x232143+',\x20using\x20default\x2010%'),0xa;}catch(_0xbaf783){return console['error'](_0x407b10(0x1d8)+_0x232143+_0x407b10(0x1dd)+_0x10093d+':',_0xbaf783),0xa;}}}function a38_0x4cb6(_0x46cf26,_0x11b7e6){const _0x51a200=a38_0x51a2();return a38_0x4cb6=function(_0x4cb65e,_0x4ea626){_0x4cb65e=_0x4cb65e-0x177;let _0x18847c=_0x51a200[_0x4cb65e];return _0x18847c;},a38_0x4cb6(_0x46cf26,_0x11b7e6);}exports['CoinToPayStatusService']=CoinToPayStatusService,exports[a38_0x1d2569(0x1a8)]=new CoinToPayStatusService();