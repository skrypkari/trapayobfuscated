'use strict';const a37_0x5bd185=a37_0x18a3;(function(_0xa63fa5,_0x13bda2){const _0x280afd=a37_0x18a3,_0x19ae1e=_0xa63fa5();while(!![]){try{const _0x471c5d=-parseInt(_0x280afd(0x1ed))/0x1*(-parseInt(_0x280afd(0x23e))/0x2)+-parseInt(_0x280afd(0x27e))/0x3*(parseInt(_0x280afd(0x1d1))/0x4)+parseInt(_0x280afd(0x236))/0x5*(parseInt(_0x280afd(0x245))/0x6)+-parseInt(_0x280afd(0x22e))/0x7+-parseInt(_0x280afd(0x2b5))/0x8+parseInt(_0x280afd(0x287))/0x9+-parseInt(_0x280afd(0x1e2))/0xa;if(_0x471c5d===_0x13bda2)break;else _0x19ae1e['push'](_0x19ae1e['shift']());}catch(_0x35a9b3){_0x19ae1e['push'](_0x19ae1e['shift']());}}}(a37_0x55aa,0xb3dbf));function a37_0x18a3(_0xd77382,_0x1f0f11){const _0x55aa4b=a37_0x55aa();return a37_0x18a3=function(_0x18a31d,_0x53e3b9){_0x18a31d=_0x18a31d-0x1bd;let _0x32a242=_0x55aa4b[_0x18a31d];return _0x32a242;},a37_0x18a3(_0xd77382,_0x1f0f11);}var __importDefault=this&&this[a37_0x5bd185(0x228)]||function(_0x4df46){const _0xf2812c=a37_0x5bd185;return _0x4df46&&_0x4df46[_0xf2812c(0x1df)]?_0x4df46:{'default':_0x4df46};};Object[a37_0x5bd185(0x217)](exports,a37_0x5bd185(0x1df),{'value':!![]}),exports[a37_0x5bd185(0x240)]=exports['CoinToPayStatusService']=void 0x0;const coinToPayService_1=require(a37_0x5bd185(0x28c)),coinToPay2Service_1=require(a37_0x5bd185(0x28e)),gateway_1=require('../types/gateway'),database_1=__importDefault(require(a37_0x5bd185(0x265))),telegramBotService_1=require('./telegramBotService'),loggerService_1=require(a37_0x5bd185(0x262));class CoinToPayStatusService{constructor(){const _0x4b818b=a37_0x5bd185;this['globalCheckInterval']=null,this[_0x4b818b(0x204)]=0x3c*0x3c*0x3e8,this['EXPIRY_DAYS']=0x5,this[_0x4b818b(0x1f7)]=new Map(),this[_0x4b818b(0x27a)]=new coinToPayService_1[(_0x4b818b(0x26d))](),this[_0x4b818b(0x1bd)]=new coinToPay2Service_1['CoinToPay2Service'](),console[_0x4b818b(0x1be)](_0x4b818b(0x24e));}[a37_0x5bd185(0x21c)](_0x56c20e,_0x5df77b){const _0x26c64a=a37_0x5bd185;console['log'](_0x26c64a(0x1d2)),console[_0x26c64a(0x1be)](_0x26c64a(0x239)+_0x56c20e),console[_0x26c64a(0x1be)](_0x26c64a(0x283)+_0x5df77b),this['clearPaymentTimers'](_0x56c20e);const _0x23263b=[],_0x73aadf=new Date(),_0x4192f1=[{'delay':0x1*0x3c*0x3e8,'description':_0x26c64a(0x27d)},{'delay':0x2*0x3c*0x3e8,'description':_0x26c64a(0x294)},{'delay':0x5*0x3c*0x3e8,'description':_0x26c64a(0x1c8)},{'delay':0x5*0x3c*0x3e8,'description':_0x26c64a(0x1c8)}];console[_0x26c64a(0x1be)]('🪙\x20[DEBUG]\x20Creating\x20'+_0x4192f1[_0x26c64a(0x264)]+_0x26c64a(0x250)+_0x56c20e);let _0x2119d8=0x0;_0x4192f1[_0x26c64a(0x2b3)]((_0x5e4459,_0x134c82)=>{const _0x4e7325=_0x26c64a;_0x2119d8+=_0x5e4459[_0x4e7325(0x26a)];const _0x1e04e2=setTimeout(async()=>{const _0x5c5ac3=_0x4e7325;console[_0x5c5ac3(0x1be)](_0x5c5ac3(0x244)+(_0x134c82+0x1)+_0x5c5ac3(0x1f9)+_0x56c20e+_0x5c5ac3(0x210)+_0x5e4459['description']+')');try{await this[_0x5c5ac3(0x257)](_0x56c20e),console[_0x5c5ac3(0x1be)]('✅\x20[TIMER]\x20Individual\x20check\x20#'+(_0x134c82+0x1)+'\x20completed\x20for\x20payment\x20'+_0x56c20e);}catch(_0x3ff77f){console['error'](_0x5c5ac3(0x1d3)+(_0x134c82+0x1)+'\x20for\x20payment\x20'+_0x56c20e+':',_0x3ff77f),this[_0x5c5ac3(0x2b9)](_0x56c20e,_0x5df77b,_0x3ff77f,'status_check',{'checkNumber':_0x134c82+0x1,'scheduledAfter':_0x5e4459[_0x5c5ac3(0x2ac)],'isIndividualCheck':!![]});}},_0x2119d8);_0x23263b['push'](_0x1e04e2),console[_0x4e7325(0x1be)](_0x4e7325(0x2a7)+(_0x134c82+0x1)+'\x20for\x20payment\x20'+_0x56c20e+_0x4e7325(0x1ec)+_0x2119d8/0x3e8+'\x20seconds\x20('+_0x5e4459[_0x4e7325(0x2ac)]+')');});const _0x359a68=setInterval(async()=>{const _0x3ca023=_0x26c64a;console['log']('🪙\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20'+_0x56c20e);try{const _0x37d955=await database_1[_0x3ca023(0x2a1)][_0x3ca023(0x24c)][_0x3ca023(0x1e9)]({'where':{'id':_0x56c20e},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x37d955){console[_0x3ca023(0x1be)]('❌\x20[HOURLY]\x20Payment\x20'+_0x56c20e+_0x3ca023(0x21a)),this[_0x3ca023(0x29d)](_0x56c20e);return;}console[_0x3ca023(0x1be)](_0x3ca023(0x1e8)+_0x56c20e+'\x20current\x20status:\x20'+_0x37d955['status']);if(_0x37d955['status']!==_0x3ca023(0x2b8)){console[_0x3ca023(0x1be)](_0x3ca023(0x241)+_0x56c20e+_0x3ca023(0x2ab)+_0x37d955['status']+_0x3ca023(0x255)),this['clearPaymentTimers'](_0x56c20e);return;}const _0x470264=Math[_0x3ca023(0x2a5)]((Date['now']()-_0x37d955[_0x3ca023(0x220)][_0x3ca023(0x232)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x470264>=this[_0x3ca023(0x274)]){console[_0x3ca023(0x1be)](_0x3ca023(0x280)+_0x56c20e+'\x20is\x20older\x20than\x20'+this[_0x3ca023(0x274)]+_0x3ca023(0x1da)),this[_0x3ca023(0x29d)](_0x56c20e);return;}await this[_0x3ca023(0x257)](_0x56c20e),console['log']('✅\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20'+_0x56c20e);}catch(_0x1f8dc0){console[_0x3ca023(0x247)](_0x3ca023(0x221)+_0x56c20e+':',_0x1f8dc0),this[_0x3ca023(0x2b9)](_0x56c20e,_0x5df77b,_0x1f8dc0,_0x3ca023(0x24f),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x23263b[_0x26c64a(0x263)](_0x359a68),this['paymentTimers']['set'](_0x56c20e,{'timers':_0x23263b,'paymentId':_0x56c20e,'gatewayPaymentId':_0x5df77b,'createdAt':_0x73aadf}),console[_0x26c64a(0x1be)]('✅\x20[DEBUG]\x20Successfully\x20scheduled\x20'+_0x4192f1[_0x26c64a(0x264)]+_0x26c64a(0x1d8)+_0x56c20e),console[_0x26c64a(0x1be)]('📊\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20'+this['paymentTimers'][_0x26c64a(0x1eb)]),this['logCoinToPayStatus'](_0x56c20e,_0x5df77b,_0x26c64a(0x2b8),_0x26c64a(0x2b8),_0x26c64a(0x24f),{'action':_0x26c64a(0x1e5),'scheduledChecks':_0x4192f1[_0x26c64a(0x264)],'firstCheckIn':_0x4192f1[0x0]['delay']/0x3e8,'totalTimers':this[_0x26c64a(0x1f7)]['size']});}[a37_0x5bd185(0x29d)](_0x4f6de8){const _0xfe5402=a37_0x5bd185,_0x1cc2ad=this[_0xfe5402(0x1f7)][_0xfe5402(0x295)](_0x4f6de8);_0x1cc2ad?(console[_0xfe5402(0x1be)](_0xfe5402(0x1db)+_0x1cc2ad['timers'][_0xfe5402(0x264)]+_0xfe5402(0x22f)+_0x4f6de8),_0x1cc2ad[_0xfe5402(0x237)][_0xfe5402(0x2b3)]((_0x5d61a4,_0xbc19ce)=>{const _0x301d4e=_0xfe5402;_0x5d61a4&&(clearTimeout(_0x5d61a4),clearInterval(_0x5d61a4),console[_0x301d4e(0x1be)](_0x301d4e(0x2ba)+(_0xbc19ce+0x1)+'\x20for\x20payment\x20'+_0x4f6de8));}),this[_0xfe5402(0x1f7)]['delete'](_0x4f6de8),console['log'](_0xfe5402(0x2b1)+_0x4f6de8+_0xfe5402(0x293)+this[_0xfe5402(0x1f7)][_0xfe5402(0x1eb)])):console['log'](_0xfe5402(0x1fe)+_0x4f6de8+_0xfe5402(0x1c7));}async[a37_0x5bd185(0x257)](_0xaee902){const _0x4d72f1=a37_0x5bd185;console[_0x4d72f1(0x1be)]('🔍\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20'+_0xaee902);const _0x39f412=await database_1[_0x4d72f1(0x2a1)][_0x4d72f1(0x24c)][_0x4d72f1(0x1e9)]({'where':{'id':_0xaee902},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x39f412){console['log'](_0x4d72f1(0x21d)+_0xaee902+_0x4d72f1(0x207));return;}console[_0x4d72f1(0x1be)]('📊\x20[CHECK]\x20Payment\x20'+_0xaee902+_0x4d72f1(0x271)),console[_0x4d72f1(0x1be)](_0x4d72f1(0x1ef)+_0x39f412[_0x4d72f1(0x20d)]),console[_0x4d72f1(0x1be)](_0x4d72f1(0x249)+_0x39f412['status']),console[_0x4d72f1(0x1be)](_0x4d72f1(0x1f5)+_0x39f412[_0x4d72f1(0x218)]),console['log'](_0x4d72f1(0x25c)+_0x39f412[_0x4d72f1(0x24d)]+'\x20'+_0x39f412[_0x4d72f1(0x1e6)]),console[_0x4d72f1(0x1be)](_0x4d72f1(0x1c9)+_0x39f412[_0x4d72f1(0x267)]);if(_0x39f412[_0x4d72f1(0x20d)]!==_0x4d72f1(0x2b7)&&_0x39f412[_0x4d72f1(0x20d)]!==_0x4d72f1(0x26b)){console[_0x4d72f1(0x1be)](_0x4d72f1(0x1ff)+_0xaee902+_0x4d72f1(0x258)+_0x39f412[_0x4d72f1(0x20d)]+')');return;}if(_0x39f412['status']!==_0x4d72f1(0x2b8)){console[_0x4d72f1(0x1be)](_0x4d72f1(0x1ff)+_0xaee902+_0x4d72f1(0x2ab)+_0x39f412[_0x4d72f1(0x1c5)]+_0x4d72f1(0x255)),this[_0x4d72f1(0x29d)](_0xaee902);return;}if(!_0x39f412[_0x4d72f1(0x218)]){console[_0x4d72f1(0x1be)](_0x4d72f1(0x1ff)+_0xaee902+_0x4d72f1(0x1bf));return;}console[_0x4d72f1(0x1be)](_0x4d72f1(0x20b)+_0xaee902+_0x4d72f1(0x212)),await this[_0x4d72f1(0x1e3)](_0x39f412);}['logCoinToPayStatus'](_0x4be329,_0x419466,_0x6b3733,_0x4ec120,_0x59e1cc,_0xd463c4){const _0x72dc71=a37_0x5bd185,_0x15d92b={'type':_0x72dc71(0x289),'paymentId':_0x4be329,'gatewayPaymentId':_0x419466,'oldStatus':_0x6b3733,'newStatus':_0x4ec120,'source':_0x59e1cc,'timestamp':new Date()[_0x72dc71(0x1dc)](),'details':_0xd463c4||{}};loggerService_1['loggerService'][_0x72dc71(0x21f)](_0x15d92b),console[_0x72dc71(0x1be)]('🪙\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20'+_0x4be329+'\x20('+_0x419466+')'),console[_0x72dc71(0x1be)](_0x72dc71(0x1fc)+_0x6b3733+_0x72dc71(0x1d0)+_0x4ec120),console[_0x72dc71(0x1be)]('\x20\x20\x20📍\x20Source:\x20'+_0x59e1cc),console[_0x72dc71(0x1be)]('\x20\x20\x20📅\x20Time:\x20'+_0x15d92b[_0x72dc71(0x234)]),_0xd463c4&&console[_0x72dc71(0x1be)](_0x72dc71(0x1dd),_0xd463c4);}[a37_0x5bd185(0x2b9)](_0x30c93d,_0xb7d427,_0x4d03ef,_0x16a911,_0x166af1){const _0x554a17=a37_0x5bd185,_0x3ea607={'type':_0x554a17(0x248),'paymentId':_0x30c93d,'gatewayPaymentId':_0xb7d427,'error':_0x4d03ef instanceof Error?{'message':_0x4d03ef[_0x554a17(0x21b)],'stack':_0x4d03ef['stack']}:_0x4d03ef,'source':_0x16a911,'timestamp':new Date()[_0x554a17(0x1dc)](),'context':_0x166af1||{}};loggerService_1[_0x554a17(0x277)][_0x554a17(0x2b9)](_0x3ea607),console[_0x554a17(0x247)](_0x554a17(0x27c)+_0x30c93d+'\x20('+_0xb7d427+')'),console[_0x554a17(0x247)](_0x554a17(0x1f6)+(_0x4d03ef instanceof Error?_0x4d03ef[_0x554a17(0x21b)]:_0x4d03ef)),console[_0x554a17(0x247)](_0x554a17(0x1d5)+_0x16a911),console[_0x554a17(0x247)](_0x554a17(0x23a)+_0x3ea607[_0x554a17(0x234)]),_0x166af1&&console[_0x554a17(0x247)](_0x554a17(0x268),_0x166af1);}[a37_0x5bd185(0x2b4)](){const _0x4ec885=a37_0x5bd185;console[_0x4ec885(0x1be)](_0x4ec885(0x1ca)),this[_0x4ec885(0x27b)]()['catch'](_0x308594=>{const _0x186c19=_0x4ec885;console[_0x186c19(0x247)](_0x186c19(0x272),_0x308594);}),this[_0x4ec885(0x23f)]=setInterval(async()=>{const _0x4849aa=_0x4ec885;try{console[_0x4849aa(0x1be)](_0x4849aa(0x1c6)),await this[_0x4849aa(0x27b)](),console['log'](_0x4849aa(0x270));}catch(_0x455187){console[_0x4849aa(0x247)](_0x4849aa(0x279),_0x455187);}},this[_0x4ec885(0x204)]),console[_0x4ec885(0x1be)](_0x4ec885(0x254));}['stopPeriodicStatusCheck'](){const _0x4c77ef=a37_0x5bd185;console[_0x4c77ef(0x1be)](_0x4c77ef(0x1cb));this['globalCheckInterval']&&(clearInterval(this[_0x4c77ef(0x23f)]),this['globalCheckInterval']=null,console[_0x4c77ef(0x1be)]('🛑\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped'));const _0x216719=this[_0x4c77ef(0x1f7)][_0x4c77ef(0x1eb)];for(const [_0x281f10]of this[_0x4c77ef(0x1f7)]){this[_0x4c77ef(0x29d)](_0x281f10);}console[_0x4c77ef(0x1be)](_0x4c77ef(0x29e)+_0x216719+_0x4c77ef(0x252));}async[a37_0x5bd185(0x27b)](){const _0x3267a9=a37_0x5bd185;try{console[_0x3267a9(0x1be)](_0x3267a9(0x235));const _0x4b87fd=await database_1[_0x3267a9(0x2a1)][_0x3267a9(0x24c)][_0x3267a9(0x1ea)]({'where':{'gateway':{'in':['cointopay',_0x3267a9(0x26b)]},'status':_0x3267a9(0x2b8),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x3267a9(0x1be)](_0x3267a9(0x25e)+_0x4b87fd[_0x3267a9(0x264)]+'\x20pending\x20CoinToPay\x20payments');if(_0x4b87fd[_0x3267a9(0x264)]===0x0){console[_0x3267a9(0x1be)](_0x3267a9(0x29c));return;}const _0x4b9f06=await this[_0x3267a9(0x20f)](_0x4b87fd);console[_0x3267a9(0x1be)](_0x3267a9(0x22d)+_0x4b9f06[_0x3267a9(0x264)]+_0x3267a9(0x23b));let _0x1df7e4=0x0,_0x3f5261=0x0;for(const _0x5ba546 of _0x4b87fd){try{if(_0x4b9f06[_0x3267a9(0x251)](_0x5ba546['id'])){console['log'](_0x3267a9(0x286)+_0x5ba546['id']+'\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check'),_0x3f5261++;continue;}if(this[_0x3267a9(0x1f7)][_0x3267a9(0x278)](_0x5ba546['id'])){console[_0x3267a9(0x1be)](_0x3267a9(0x286)+_0x5ba546['id']+_0x3267a9(0x22b)),_0x3f5261++;continue;}const _0x246e4f=(Date[_0x3267a9(0x1f4)]()-_0x5ba546[_0x3267a9(0x220)]['getTime']())/(0x3e8*0x3c*0x3c);if(_0x246e4f<0x1){console[_0x3267a9(0x1be)](_0x3267a9(0x286)+_0x5ba546['id']+_0x3267a9(0x2a4)+_0x246e4f['toFixed'](0x1)+_0x3267a9(0x296)),_0x3f5261++;continue;}console[_0x3267a9(0x1be)]('🔍\x20[GLOBAL]\x20Checking\x20old\x20payment\x20'+_0x5ba546['id']+_0x3267a9(0x225)+_0x246e4f[_0x3267a9(0x1d4)](0x1)+'h)'),await this[_0x3267a9(0x1e3)](_0x5ba546),_0x1df7e4++,await new Promise(_0x17707e=>setTimeout(_0x17707e,0x7d0));}catch(_0x4d0573){console[_0x3267a9(0x247)](_0x3267a9(0x29f)+_0x5ba546['id']+':',_0x4d0573),this[_0x3267a9(0x2b9)](_0x5ba546['id'],_0x5ba546[_0x3267a9(0x218)]||'unknown',_0x4d0573,'status_check',{'isGlobalCheck':!![],'paymentAmount':_0x5ba546[_0x3267a9(0x24d)],'paymentCurrency':_0x5ba546['currency'],'shopId':_0x5ba546[_0x3267a9(0x267)],'createdAt':_0x5ba546[_0x3267a9(0x220)]}),loggerService_1[_0x3267a9(0x277)][_0x3267a9(0x28b)](_0x3267a9(0x2b7),_0x3267a9(0x224)+_0x5ba546[_0x3267a9(0x218)],_0x4d0573);}}console[_0x3267a9(0x1be)](_0x3267a9(0x290)+_0x1df7e4+'\x20checked,\x20'+_0x3f5261+_0x3267a9(0x298)+_0x4b9f06[_0x3267a9(0x264)]+_0x3267a9(0x26f));}catch(_0x5c832a){console[_0x3267a9(0x247)](_0x3267a9(0x219),_0x5c832a);}}async[a37_0x5bd185(0x20f)](_0x599956){const _0x4d3163=a37_0x5bd185,_0x360fde=[],_0x4282e6=new Date();_0x4282e6[_0x4d3163(0x1c3)](_0x4282e6[_0x4d3163(0x1d9)]()-this[_0x4d3163(0x274)]),console[_0x4d3163(0x1be)](_0x4d3163(0x261)+this[_0x4d3163(0x274)]+_0x4d3163(0x2a3)+_0x4282e6[_0x4d3163(0x1dc)]()+')');for(const _0x5cc637 of _0x599956){if(_0x5cc637[_0x4d3163(0x220)]<_0x4282e6){console[_0x4d3163(0x1be)](_0x4d3163(0x1f1)+_0x5cc637['id']+_0x4d3163(0x275)+this[_0x4d3163(0x274)]+_0x4d3163(0x2b6));try{this[_0x4d3163(0x21f)](_0x5cc637['id'],_0x5cc637[_0x4d3163(0x218)]||_0x4d3163(0x23c),_0x4d3163(0x2b8),_0x4d3163(0x29b),_0x4d3163(0x1e4),{'reason':'Payment\x20older\x20than\x20'+this['EXPIRY_DAYS']+_0x4d3163(0x288),'createdAt':_0x5cc637[_0x4d3163(0x220)],'daysSinceCreation':Math[_0x4d3163(0x2a5)]((Date[_0x4d3163(0x1f4)]()-_0x5cc637[_0x4d3163(0x220)][_0x4d3163(0x232)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x5cc637[_0x4d3163(0x24d)],'paymentCurrency':_0x5cc637['currency'],'shopId':_0x5cc637['shopId']}),await database_1[_0x4d3163(0x2a1)][_0x4d3163(0x24c)][_0x4d3163(0x25b)]({'where':{'id':_0x5cc637['id']},'data':{'status':_0x4d3163(0x29b),'updatedAt':new Date(),'adminNotes':'Automatically\x20expired\x20after\x20'+this[_0x4d3163(0x274)]+_0x4d3163(0x299)}}),await database_1[_0x4d3163(0x2a1)][_0x4d3163(0x24a)][_0x4d3163(0x297)]({'data':{'paymentId':_0x5cc637['id'],'shopId':_0x5cc637['shopId'],'event':_0x4d3163(0x215),'statusCode':0xc8,'responseBody':JSON[_0x4d3163(0x2aa)]({'reason':_0x4d3163(0x216)+this[_0x4d3163(0x274)]+_0x4d3163(0x288),'createdAt':_0x5cc637[_0x4d3163(0x220)],'expiredAt':new Date()['toISOString'](),'daysSinceCreation':Math[_0x4d3163(0x2a5)]((Date[_0x4d3163(0x1f4)]()-_0x5cc637[_0x4d3163(0x220)][_0x4d3163(0x232)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this['sendShopWebhook'](_0x5cc637,_0x4d3163(0x29b)),await this[_0x4d3163(0x246)](_0x5cc637,'EXPIRED'),this[_0x4d3163(0x29d)](_0x5cc637['id']),_0x360fde[_0x4d3163(0x263)](_0x5cc637['id']),console['log']('✅\x20[EXPIRY]\x20Payment\x20'+_0x5cc637['id']+_0x4d3163(0x20e)+this['EXPIRY_DAYS']+'-day\x20timeout');}catch(_0x59c0b5){console['error'](_0x4d3163(0x273)+_0x5cc637['id']+':',_0x59c0b5),this['logCoinToPayError'](_0x5cc637['id'],_0x5cc637[_0x4d3163(0x218)]||'unknown',_0x59c0b5,_0x4d3163(0x1e4),{'reason':_0x4d3163(0x1e1),'createdAt':_0x5cc637[_0x4d3163(0x220)],'daysSinceCreation':Math[_0x4d3163(0x2a5)]((Date[_0x4d3163(0x1f4)]()-_0x5cc637[_0x4d3163(0x220)][_0x4d3163(0x232)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x360fde;}async[a37_0x5bd185(0x1e3)](_0x15e87f){const _0x59d286=a37_0x5bd185;if(!_0x15e87f[_0x59d286(0x218)]){console['log'](_0x59d286(0x1ff)+_0x15e87f['id']+_0x59d286(0x26c));return;}console[_0x59d286(0x1be)](_0x59d286(0x1d7)+_0x15e87f['gateway']+'\x20payment\x20'+_0x15e87f['id']+'\x20('+_0x15e87f[_0x59d286(0x218)]+')');try{let _0x3f5117;_0x15e87f[_0x59d286(0x20d)]===_0x59d286(0x26b)?(_0x3f5117=await this[_0x59d286(0x1bd)][_0x59d286(0x227)](_0x15e87f[_0x59d286(0x218)]),console['log'](_0x59d286(0x281)+_0x15e87f['id']+_0x59d286(0x26e)+_0x3f5117[_0x59d286(0x1c5)])):(_0x3f5117=await this['coinToPayService'][_0x59d286(0x227)](_0x15e87f[_0x59d286(0x218)]),console[_0x59d286(0x1be)]('📊\x20[CHECK]\x20CoinToPay\x20payment\x20'+_0x15e87f['id']+_0x59d286(0x26e)+_0x3f5117[_0x59d286(0x1c5)]));_0x3f5117[_0x59d286(0x1ee)]&&console[_0x59d286(0x1be)](_0x59d286(0x1cd)+_0x15e87f['id']+'\x20details:',{'iban':_0x3f5117[_0x59d286(0x1ee)][_0x59d286(0x1e0)]||'not\x20found','transactionId':_0x3f5117[_0x59d286(0x1ee)][_0x59d286(0x1f0)],'createdOn':_0x3f5117[_0x59d286(0x1ee)][_0x59d286(0x22c)],'confirmedOn':_0x3f5117['paymentDetails'][_0x59d286(0x1c1)]||_0x59d286(0x291)});if(_0x3f5117[_0x59d286(0x1c5)]!==_0x15e87f[_0x59d286(0x1c5)]){console[_0x59d286(0x1be)]('🔄\x20[CHECK]\x20Updating\x20payment\x20'+_0x15e87f['id']+_0x59d286(0x200)+_0x15e87f['status']+_0x59d286(0x284)+_0x3f5117[_0x59d286(0x1c5)]),this[_0x59d286(0x21f)](_0x15e87f['id'],_0x15e87f[_0x59d286(0x218)],_0x15e87f[_0x59d286(0x1c5)],_0x3f5117[_0x59d286(0x1c5)],_0x59d286(0x24f),{'paymentDetails':_0x3f5117[_0x59d286(0x1ee)],'amount':_0x3f5117[_0x59d286(0x24d)],'currency':_0x3f5117[_0x59d286(0x1e6)],'shopId':_0x15e87f['shopId'],'checkTimestamp':new Date()[_0x59d286(0x1dc)]()});const _0x159cb6={'status':_0x3f5117[_0x59d286(0x1c5)],'updatedAt':new Date()};_0x3f5117[_0x59d286(0x1c5)]==='PAID'&&_0x15e87f[_0x59d286(0x1c5)]!==_0x59d286(0x1c2)&&(_0x159cb6[_0x59d286(0x214)]=new Date(),console['log'](_0x59d286(0x292)+_0x15e87f['id']+_0x59d286(0x28d)+_0x159cb6[_0x59d286(0x214)][_0x59d286(0x1dc)]()));if(_0x3f5117['paymentDetails']){const _0x4732c4=_0x3f5117[_0x59d286(0x1ee)];_0x4732c4[_0x59d286(0x1e0)]&&(_0x159cb6[_0x59d286(0x25d)]=_0x4732c4[_0x59d286(0x1e0)],console[_0x59d286(0x1be)](_0x59d286(0x2a2)+_0x4732c4[_0x59d286(0x1e0)]));if(_0x4732c4['bankDetails']){const _0x3895a2=_0x15e87f[_0x59d286(0x1e7)]||'',_0x755afc=_0x59d286(0x229)+_0x4732c4['bankDetails'];_0x159cb6[_0x59d286(0x1e7)]=_0x3895a2?_0x3895a2+'\x0a\x0a'+_0x755afc:_0x755afc,console['log'](_0x59d286(0x2af));}_0x4732c4[_0x59d286(0x1f0)]&&console[_0x59d286(0x1be)](_0x59d286(0x282)+_0x4732c4['transactionId']),_0x4732c4[_0x59d286(0x1c1)]&&console['log']('✅\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20'+_0x4732c4[_0x59d286(0x1c1)]);}await database_1[_0x59d286(0x2a1)][_0x59d286(0x24c)]['update']({'where':{'id':_0x15e87f['id']},'data':_0x159cb6});if(_0x3f5117[_0x59d286(0x1c5)]===_0x59d286(0x1c2)&&_0x15e87f[_0x59d286(0x1c5)]!=='PAID'){console[_0x59d286(0x1be)]('📈\x20[COINTOPAY]\x20Payment\x20'+_0x15e87f['id']+'\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link');const _0x27df79=await database_1[_0x59d286(0x2a1)][_0x59d286(0x24c)][_0x59d286(0x1e9)]({'where':{'id':_0x15e87f['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x27df79?.[_0x59d286(0x230)]&&_0x27df79['paymentLink'])try{const _0x51eb6c=_0x27df79['paymentLink'];console[_0x59d286(0x1be)](_0x59d286(0x231)+_0x51eb6c['id']+_0x59d286(0x25f)+_0x51eb6c[_0x59d286(0x226)]+',\x20currentPayments='+_0x51eb6c[_0x59d286(0x203)]+',\x20status='+_0x51eb6c[_0x59d286(0x1c5)]);const _0x227794=_0x51eb6c[_0x59d286(0x203)]+0x1,_0x43ba81=_0x51eb6c[_0x59d286(0x226)]===_0x59d286(0x2b0)?'COMPLETED':_0x51eb6c[_0x59d286(0x1c5)];await database_1[_0x59d286(0x2a1)][_0x59d286(0x243)]['update']({'where':{'id':_0x51eb6c['id']},'data':{'currentPayments':_0x227794,'status':_0x43ba81,'updatedAt':new Date()}}),console['log'](_0x59d286(0x205)+_0x51eb6c['id']+_0x59d286(0x28f)+_0x51eb6c[_0x59d286(0x203)]+_0x59d286(0x1d0)+_0x227794+',\x20status='+_0x51eb6c[_0x59d286(0x1c5)]+'\x20->\x20'+_0x43ba81);}catch(_0x2dd18e){console[_0x59d286(0x247)](_0x59d286(0x2ad),_0x2dd18e);}else console[_0x59d286(0x1be)](_0x59d286(0x2b2)+_0x15e87f['id']+_0x59d286(0x24b));}await database_1[_0x59d286(0x2a1)]['webhookLog']['create']({'data':{'paymentId':_0x15e87f['id'],'shopId':_0x15e87f[_0x59d286(0x267)],'event':_0x59d286(0x23d)+_0x3f5117[_0x59d286(0x1c5)][_0x59d286(0x21e)](),'statusCode':0xc8,'responseBody':JSON[_0x59d286(0x2aa)]({'oldStatus':_0x15e87f[_0x59d286(0x1c5)],'newStatus':_0x3f5117['status'],'paymentDetails':_0x3f5117[_0x59d286(0x1ee)],'checkedAt':new Date()[_0x59d286(0x1dc)]()})}}),await this[_0x59d286(0x206)](_0x15e87f,_0x3f5117[_0x59d286(0x1c5)]),await this[_0x59d286(0x246)](_0x15e87f,_0x3f5117[_0x59d286(0x1c5)]),_0x3f5117[_0x59d286(0x1c5)]!==_0x59d286(0x2b8)&&(console[_0x59d286(0x1be)](_0x59d286(0x2ae)+_0x15e87f['id']+_0x59d286(0x1f3)+_0x3f5117[_0x59d286(0x1c5)]+_0x59d286(0x22a)),this[_0x59d286(0x29d)](_0x15e87f['id'])),console[_0x59d286(0x1be)]('✅\x20[CHECK]\x20Payment\x20'+_0x15e87f['id']+_0x59d286(0x1fd));}else console['log'](_0x59d286(0x1cd)+_0x15e87f['id']+_0x59d286(0x27f)+_0x3f5117[_0x59d286(0x1c5)]+')'),this[_0x59d286(0x21f)](_0x15e87f['id'],_0x15e87f[_0x59d286(0x218)],_0x15e87f['status'],_0x3f5117[_0x59d286(0x1c5)],_0x59d286(0x24f),{'statusUnchanged':!![],'paymentDetails':_0x3f5117['paymentDetails'],'amount':_0x3f5117[_0x59d286(0x24d)],'currency':_0x3f5117['currency'],'shopId':_0x15e87f[_0x59d286(0x267)],'checkTimestamp':new Date()[_0x59d286(0x1dc)]()});}catch(_0x26b9cb){console[_0x59d286(0x247)]('❌\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20'+_0x15e87f['id']+':',_0x26b9cb),this[_0x59d286(0x2b9)](_0x15e87f['id'],_0x15e87f['gatewayPaymentId'],_0x26b9cb,_0x59d286(0x24f),{'paymentAmount':_0x15e87f[_0x59d286(0x24d)],'paymentCurrency':_0x15e87f[_0x59d286(0x1e6)],'shopId':_0x15e87f['shopId'],'createdAt':_0x15e87f[_0x59d286(0x220)]}),await database_1[_0x59d286(0x2a1)][_0x59d286(0x24a)]['create']({'data':{'paymentId':_0x15e87f['id'],'shopId':_0x15e87f[_0x59d286(0x267)],'event':'cointopay_status_check_error','statusCode':0x1f4,'responseBody':JSON[_0x59d286(0x2aa)]({'error':_0x26b9cb instanceof Error?_0x26b9cb[_0x59d286(0x21b)]:'Unknown\x20error','gatewayPaymentId':_0x15e87f[_0x59d286(0x218)],'checkedAt':new Date()['toISOString']()})}});}}async[a37_0x5bd185(0x206)](_0x2d8884,_0x2dea7b){const _0xca3284=a37_0x5bd185,_0xcc9de=Date[_0xca3284(0x1f4)]();try{const _0x4cf11e=_0x2d8884[_0xca3284(0x1f2)],_0x1ad03e=_0x4cf11e[_0xca3284(0x1fb)];if(!_0x1ad03e?.[_0xca3284(0x211)]){console[_0xca3284(0x1be)](_0xca3284(0x2a0)+_0x4cf11e['id']);return;}const _0x41dfb2=_0x2dea7b===_0xca3284(0x1c2)?_0xca3284(0x260):_0x2dea7b===_0xca3284(0x2a6)?_0xca3284(0x202):_0x2dea7b==='EXPIRED'?_0xca3284(0x202):_0xca3284(0x20a);if(!_0x1ad03e['webhookEvents']?.['includes'](_0x41dfb2)){console['log'](_0xca3284(0x1c0)+_0x41dfb2+_0xca3284(0x1d6)+_0x4cf11e['id']);return;}const _0x31851c=(0x0,gateway_1['getGatewayIdByName'])(_0x2d8884['gateway'])||_0x2d8884[_0xca3284(0x20d)],_0x517788={'event':_0x41dfb2,'payment':{'id':_0x2d8884['id'],'order_id':_0x2d8884[_0xca3284(0x213)],'gateway_order_id':_0x2d8884[_0xca3284(0x209)],'gateway':_0x31851c,'amount':_0x2d8884[_0xca3284(0x24d)],'currency':_0x2d8884[_0xca3284(0x1e6)],'status':_0x2dea7b['toLowerCase'](),'customer_email':_0x2d8884[_0xca3284(0x276)],'customer_name':_0x2d8884[_0xca3284(0x222)],'created_at':_0x2d8884['createdAt'],'updated_at':new Date()}},_0x54dcee=await fetch(_0x1ad03e['webhookUrl'],{'method':'POST','headers':{'Content-Type':_0xca3284(0x208),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON['stringify'](_0x517788)}),_0x10e886=Date[_0xca3284(0x1f4)]()-_0xcc9de,_0xd222da=_0x54dcee['ok']?_0xca3284(0x201):await _0x54dcee[_0xca3284(0x1cc)]();loggerService_1[_0xca3284(0x277)]['logShopWebhookSent'](_0x2d8884['shopId'],_0x1ad03e[_0xca3284(0x211)],_0x41dfb2,_0x54dcee[_0xca3284(0x1c5)],_0x10e886,_0x517788),console[_0xca3284(0x1be)](_0xca3284(0x253)+_0x1ad03e[_0xca3284(0x211)]+_0xca3284(0x285)+_0x54dcee[_0xca3284(0x1c5)]+'\x20('+_0x10e886+_0xca3284(0x1de));}catch(_0x14e4a5){console[_0xca3284(0x247)]('Failed\x20to\x20send\x20shop\x20webhook:',_0x14e4a5),loggerService_1[_0xca3284(0x277)][_0xca3284(0x1c4)](_0x2d8884[_0xca3284(0x267)],_0x2d8884[_0xca3284(0x1f2)]?.[_0xca3284(0x1fb)]?.[_0xca3284(0x211)]||'unknown','webhook_send',_0x14e4a5,{});}}async[a37_0x5bd185(0x246)](_0x3fb91b,_0x5983a0){const _0x45e6b8=a37_0x5bd185;try{const _0x58372b={'PENDING':_0x45e6b8(0x259),'PAID':'paid','FAILED':_0x45e6b8(0x238),'EXPIRED':_0x45e6b8(0x223)},_0x1efca3=_0x58372b[_0x5983a0];if(!_0x1efca3||_0x1efca3===_0x45e6b8(0x259))return;await telegramBotService_1[_0x45e6b8(0x20c)][_0x45e6b8(0x2a8)](_0x3fb91b[_0x45e6b8(0x267)],_0x3fb91b,_0x1efca3);}catch(_0x399314){console[_0x45e6b8(0x247)](_0x45e6b8(0x269),_0x399314);}}async[a37_0x5bd185(0x256)](_0x1e9fd5){const _0x52debe=a37_0x5bd185;console[_0x52debe(0x1be)](_0x52debe(0x242)+_0x1e9fd5);const _0x255535=await database_1[_0x52debe(0x2a1)][_0x52debe(0x24c)][_0x52debe(0x1e9)]({'where':{'id':_0x1e9fd5},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x255535)throw new Error('Payment\x20not\x20found');if(_0x255535[_0x52debe(0x20d)]!==_0x52debe(0x2b7)&&_0x255535[_0x52debe(0x20d)]!==_0x52debe(0x26b))throw new Error(_0x52debe(0x25a));console[_0x52debe(0x1be)](_0x52debe(0x28a)+_0x255535[_0x52debe(0x20d)]+_0x52debe(0x1cf)+_0x1e9fd5),await this[_0x52debe(0x1e3)](_0x255535),console[_0x52debe(0x1be)](_0x52debe(0x1fa)+_0x1e9fd5);}[a37_0x5bd185(0x2a9)](){const _0x450d1a=a37_0x5bd185,_0x272cbf=this[_0x450d1a(0x23f)]?this[_0x450d1a(0x204)]:undefined,_0x2ea40d=Array[_0x450d1a(0x233)](this[_0x450d1a(0x1f7)]['values']())[_0x450d1a(0x266)](_0x421b11=>({'paymentId':_0x421b11[_0x450d1a(0x1f8)],'gatewayPaymentId':_0x421b11[_0x450d1a(0x218)],'createdAt':_0x421b11[_0x450d1a(0x220)],'timersCount':_0x421b11[_0x450d1a(0x237)][_0x450d1a(0x264)]}));return{'isActive':!!this[_0x450d1a(0x23f)],'globalCheckIntervalMinutes':this[_0x450d1a(0x204)]/(0x3e8*0x3c),'expiryDays':this[_0x450d1a(0x274)],'activeIndividualTimers':this[_0x450d1a(0x1f7)][_0x450d1a(0x1eb)],'nextGlobalCheckIn':_0x272cbf,'paymentTimersDetails':_0x2ea40d};}[a37_0x5bd185(0x1ce)](_0x642308){const _0x202377=a37_0x5bd185,_0x5c1611=this[_0x202377(0x1f7)]['get'](_0x642308);if(_0x5c1611)return{'hasTimers':!![],'timersCount':_0x5c1611[_0x202377(0x237)]['length'],'createdAt':_0x5c1611['createdAt'],'gatewayPaymentId':_0x5c1611[_0x202377(0x218)]};return{'hasTimers':![]};}}exports[a37_0x5bd185(0x29a)]=CoinToPayStatusService,exports[a37_0x5bd185(0x240)]=new CoinToPayStatusService();function a37_0x55aa(){const _0x793c04=['webhookUrl','\x20is\x20valid\x20for\x20checking,\x20proceeding...','orderId','paidAt','cointopay_auto_expired','Payment\x20older\x20than\x20','defineProperty','gatewayPaymentId','❌\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','\x20not\x20found,\x20clearing\x20timers','message','schedulePaymentChecks','❌\x20[CHECK]\x20Payment\x20','toLowerCase','logCoinToPayStatus','createdAt','❌\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','customerName','expired','/status/','\x20(age:\x20','type','checkPaymentStatus','__importDefault','Bank\x20Details:\x20',',\x20clearing\x20individual\x20timers','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','createdOn','⏰\x20[GLOBAL]\x20Found\x20','670740WPYzbX','\x20timers\x20for\x20payment\x20','paymentLinkId','📈\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','getTime','from','timestamp','🪙\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','4841695EzSTuU','timers','failed','\x20\x20\x20-\x20paymentId:\x20','\x20\x20\x20📅\x20Time:\x20','\x20expired\x20CoinToPay\x20payments','unknown','cointopay_status_check_','591246JUYPyo','globalCheckInterval','coinToPayStatusService','✅\x20[HOURLY]\x20Payment\x20','🔍\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','paymentLink','🪙\x20[TIMER]\x20Individual\x20check\x20#','6NxWIjw','sendPaymentStatusNotification','error','COINTOPAY_ERROR','\x20\x20\x20-\x20Status:\x20','webhookLog','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','payment','amount','🪙\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','status_check','\x20initial\x20timers\x20for\x20payment\x20','includes','\x20individual\x20payment\x20timers','Shop\x20webhook\x20sent\x20to\x20','✅\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)',',\x20stopping\x20individual\x20checks','checkPaymentById','checkSinglePaymentById','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','created','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','update','\x20\x20\x20-\x20Amount:\x20','remitterIban','🪙\x20[GLOBAL]\x20Found\x20',':\x20type=','payment.success','⏰\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','./loggerService','push','length','../config/database','map','shopId','\x20\x20\x20📝\x20Context:','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','delay','cointopay2','\x20has\x20no\x20gatewayPaymentId,\x20skipping','CoinToPayService','\x20status:\x20','\x20expired','✅\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','\x20found:','❌\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','❌\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','EXPIRY_DAYS','\x20is\x20older\x20than\x20','customerEmail','loggerService','has','❌\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','coinToPayService','checkAllPendingPayments','🪙\x20[ERROR]\x20CoinToPay\x20Error:\x20','1\x20minute','444dOWgUL','\x20status\x20unchanged\x20(','⏰\x20[HOURLY]\x20Payment\x20','📊\x20[CHECK]\x20CoinToPay2\x20payment\x20','🆔\x20[CHECK]\x20Transaction\x20ID:\x20','\x20\x20\x20-\x20gatewayPaymentId:\x20','\x20to\x20','\x20with\x20status\x20','⏰\x20[GLOBAL]\x20Payment\x20','10169784CEPzKL','\x20days','COINTOPAY_STATUS_CHANGE','✅\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','logWhiteDomainError','./gateways/coinToPayService','\x20marked\x20as\x20paid\x20at:\x20','./gateways/coinToPay2Service','\x20updated:\x20currentPayments=','✅\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','not\x20confirmed','💰\x20[CHECK]\x20Payment\x20','.\x20Remaining\x20active\x20timers:\x20','2\x20minutes','get','h),\x20skipping\x20global\x20check','create','\x20skipped,\x20','\x20days\x20without\x20payment\x20confirmation','CoinToPayStatusService','EXPIRED','🪙\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','clearPaymentTimers','🛑\x20[SHUTDOWN]\x20Cleared\x20','❌\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','default','🏦\x20[CHECK]\x20Saved\x20IBAN:\x20','\x20days\x20(created\x20before\x20','\x20is\x20too\x20new\x20(','floor','FAILED','⏰\x20[DEBUG]\x20Scheduled\x20check\x20#','sendPaymentNotification','getServiceStats','stringify','\x20status\x20is\x20','description','❌\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','🧹\x20[CHECK]\x20Payment\x20','🏦\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes','SINGLE','✅\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','📈\x20[COINTOPAY]\x20Payment\x20','forEach','startPeriodicStatusCheck','102248PIbQoE','\x20days,\x20marking\x20as\x20EXPIRED','cointopay','PENDING','logCoinToPayError','🧹\x20[DEBUG]\x20Cleared\x20timer\x20#','coinToPay2Service','log','\x20has\x20no\x20gatewayPaymentId','Webhook\x20event\x20','confirmedOn','PAID','setDate','logShopWebhookError','status','🪙\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','\x20to\x20clear','5\x20minutes','\x20\x20\x20-\x20ShopId:\x20','🪙\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','🛑\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','text','📊\x20[CHECK]\x20Payment\x20','getPaymentTimerInfo','\x20payment\x20','\x20->\x20','36724ulHLyr','🪙\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','❌\x20[TIMER]\x20Failed\x20individual\x20check\x20#','toFixed','\x20\x20\x20📍\x20Source:\x20','\x20not\x20enabled\x20for\x20shop\x20','🔍\x20[CHECK]\x20Checking\x20','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','getDate','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','🧹\x20[DEBUG]\x20Clearing\x20','toISOString','\x20\x20\x20📝\x20Details:','ms)','__esModule','iban','Failed\x20to\x20mark\x20payment\x20as\x20expired','1898460ziohTk','checkSinglePayment','auto_expire','schedule_created','currency','adminNotes','📊\x20[HOURLY]\x20Payment\x20','findUnique','findMany','size','\x20in\x20','1hgnWJO','paymentDetails','\x20\x20\x20-\x20Gateway:\x20','transactionId','⏰\x20[EXPIRY]\x20Payment\x20','shop','\x20status\x20changed\x20to\x20','now','\x20\x20\x20-\x20GatewayPaymentId:\x20','\x20\x20\x20❌\x20Error:\x20','paymentTimers','paymentId','\x20triggered\x20for\x20payment\x20','✅\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','settings','\x20\x20\x20📊\x20Status:\x20','\x20updated\x20successfully','⚠️\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','⚠️\x20[CHECK]\x20Payment\x20','\x20status\x20from\x20','Success','payment.failed','currentPayments','GLOBAL_CHECK_INTERVAL_MS','✅\x20[COINTOPAY]\x20Payment\x20link\x20','sendShopWebhook','\x20not\x20found\x20in\x20database','application/json','gatewayOrderId','payment.pending','✅\x20[CHECK]\x20Payment\x20','telegramBotService','gateway','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','checkExpiredPayments','\x20(after\x20'];a37_0x55aa=function(){return _0x793c04;};return a37_0x55aa();}