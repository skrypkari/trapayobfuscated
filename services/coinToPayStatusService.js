'use strict';const a57_0x31ef6e=a57_0x3fd5;(function(_0x381e31,_0x363960){const _0x578486=a57_0x3fd5,_0x2ec2e0=_0x381e31();while(!![]){try{const _0x1bfe60=parseInt(_0x578486(0x218))/0x1+-parseInt(_0x578486(0x242))/0x2*(parseInt(_0x578486(0x280))/0x3)+parseInt(_0x578486(0x1a5))/0x4+-parseInt(_0x578486(0x1ce))/0x5*(parseInt(_0x578486(0x28b))/0x6)+-parseInt(_0x578486(0x243))/0x7+-parseInt(_0x578486(0x229))/0x8+-parseInt(_0x578486(0x1df))/0x9*(-parseInt(_0x578486(0x240))/0xa);if(_0x1bfe60===_0x363960)break;else _0x2ec2e0['push'](_0x2ec2e0['shift']());}catch(_0x326ea8){_0x2ec2e0['push'](_0x2ec2e0['shift']());}}}(a57_0x4f71,0xee324));function a57_0x3fd5(_0x39058a,_0x55ec50){_0x39058a=_0x39058a-0x197;const _0x4f71eb=a57_0x4f71();let _0x3fd530=_0x4f71eb[_0x39058a];return _0x3fd530;}function a57_0x4f71(){const _0x16b734=['ü™ô\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','\x20\x20\x20‚ùå\x20Error:\x20','üìä\x20[CHECK]\x20CoinToPay2\x20payment\x20','Failed\x20to\x20mark\x20payment\x20as\x20expired','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','paymentId','1\x20minute','convertToUSDT','auto_expire','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','POST','üìä\x20[CHECK]\x20CoinToPay\x20payment\x20','‚úÖ\x20[TIMER]\x20Individual\x20check\x20#','45235900NzSBAF','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','38CCcAPH','3375316TLZAEg','\x20\x20\x20Amount:\x20','toISOString','‚úÖ\x20[HOURLY]\x20Payment\x20','5\x20minutes',',\x20stopping\x20individual\x20checks','status','‚úÖ\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','ü™ô\x20[DEBUG]\x20Creating\x20','gatewayCommissionRate','push','./currencyService','sendShopWebhook','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','üè¶\x20[CHECK]\x20Saved\x20IBAN:\x20','\x20is\x20too\x20new\x20(','\x20\x20\x20-\x20Amount:\x20','log','delay',',\x20using\x20default\x20commission\x2010%','default','\x20marked\x20as\x20paid\x20at:\x20','logWhiteDomainError','PAID','Gateway\x20','cointopay','ü™ô\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','logCoinToPayStatus','checkExpiredPayments','clearPaymentTimers','loggerService','paidAt','payment.success','telegramBotService','\x20status\x20is\x20','findMany','../types/gateway','‚ö†Ô∏è\x20[CHECK]\x20Payment\x20','\x20\x20\x20üìç\x20Source:\x20','sha256','entries','length','\x20\x20\x20üìÖ\x20Time:\x20','size','‚ùå\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','schedule_created','cointopay_auto_expired','2\x20minutes','‚úÖ\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','\x20\x20\x20Amount\x20after\x20commission:\x20','‚úÖ\x20[CHECK]\x20Payment\x20','bankDetails','expired','üìà\x20[COINTOPAY]\x20Payment\x20','No\x20specific\x20commission\x20found\x20for\x20gateway\x20','catch','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','iban','getServiceStats','getTime','\x20individual\x20payment\x20timers','285945hJrtEP','Shop\x20webhook\x20sent\x20to\x20','paymentDetails','üÜî\x20[CHECK]\x20Transaction\x20ID:\x20','\x20\x20\x20-\x20GatewayPaymentId:\x20','üßπ\x20[DEBUG]\x20Clearing\x20','\x20status\x20changed\x20to\x20','paymentLink','has','üìä\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20',':\x20type=','12CiMXEU','logCoinToPayError','‚ùå\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','\x20updated\x20successfully','\x20\x20\x20üìù\x20Context:','\x20found:','schedulePaymentChecks','\x20payment\x20','‚ùå\x20[CHECK]\x20Payment\x20','\x20status:\x20','‚è∞\x20[EXPIRY]\x20Payment\x20','‚ùå\x20[TIMER]\x20Failed\x20individual\x20check\x20#','create','created','globalCheckInterval','ü™ô\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','‚ö†Ô∏è\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','‚è∞\x20[GLOBAL]\x20Payment\x20','coinToPayService','‚úÖ\x20[COINTOPAY]\x20Payment\x20link\x20','\x20USDT','ü™ô\x20[ERROR]\x20CoinToPay\x20Error:\x20','\x20is\x20valid\x20for\x20checking,\x20proceeding...','üõë\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','checkSinglePayment','\x20commission:\x20','startPeriodicStatusCheck','\x20initial\x20timers\x20for\x20payment\x20','toLowerCase','‚ùå\x20[HOURLY]\x20Payment\x20','currentPayments',',\x20status=','checkPaymentById','5779604pPXgGr','\x20not\x20found,\x20clearing\x20timers','forEach','shop','get','‚úÖ\x20[DEBUG]\x20Successfully\x20scheduled\x20','logShopWebhookSent','/status/','\x20is\x20older\x20than\x20','set','\x20days','payment','\x20in\x20','amount','\x20not\x20enabled\x20for\x20shop\x20','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','\x20days\x20(created\x20before\x20','confirmedOn','‚ùå\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','Success','\x20\x20\x20üìù\x20Details:','Unknown\x20error','SINGLE','gatewayPaymentId','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','unknown','\x20\x20\x20üìä\x20Status:\x20','\x20\x20\x20-\x20gatewayPaymentId:\x20','hex','getDate','\x20(age:\x20','paymentTimers','\x20for\x20payment\x20','createdAt','update','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','\x20to\x20clear','\x20(after\x20','Payment\x20not\x20found','parse','floor','4636820VognHQ','Payment\x20older\x20than\x20','COMPLETED','amountUSDT','createdOn','webhook_send',',\x20gateway\x20','CoinToPayService','üõë\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','PENDING','\x20with\x20status\x20','error','sendPaymentNotification','includes','secretKey','CoinToPayStatusService','\x20status\x20unchanged\x20(','9mxZOfv','gateway','values','text',',\x20using\x20default\x2010%','checkAllPendingPayments','status_check','\x20skipped,\x20','getGatewayCommission','message','coinToPayStatusService','\x20expired\x20CoinToPay\x20payments','EXPIRY_DAYS','\x20expired','transactionId','__importDefault','EXPIRED','payment.failed','not\x20found','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','üìä\x20[CHECK]\x20Payment\x20','customerName','webhookUrl','üè¶\x20[CHECK]\x20Bank\x20details\x20provided:\x20','‚úÖ\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','type','ms)','cointopay2','crypto','GLOBAL_CHECK_INTERVAL_MS','\x20timers\x20for\x20payment\x20','‚è∞\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','checkSinglePaymentById','failed','üîç\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','stopPeriodicStatusCheck','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','findUnique','shopId','checkPaymentStatus','üí∞\x20[CHECK]\x20Payment\x20','now','üßπ\x20[CHECK]\x20Payment\x20','defineProperty','COINTOPAY_ERROR','coinToPay2Service','\x20details:','\x20updated:\x20currentPayments=','webhookLog','currency','gatewaySettings','./gateways/coinToPay2Service','\x20\x20\x20-\x20ShopId:\x20','timers','\x20->\x20','\x20days,\x20marking\x20as\x20EXPIRED','üìà\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','834964ClMsHO','commission','üìä\x20[HOURLY]\x20Payment\x20',',\x20currentPayments=','cointopay_status_check_','delete','ü™ô\x20[GLOBAL]\x20Found\x20','CoinToPay2Service','‚úÖ\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','stack','timestamp','sendPaymentStatusNotification','stringify','\x20\x20\x20-\x20Status:\x20','\x20status\x20from\x20','./gateways/coinToPayService','\x20commission\x20for\x20shop\x20','13439216GWSgOn','map','\x20checked,\x20','‚è∞\x20[HOURLY]\x20Payment\x20','üîç\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','\x20has\x20no\x20gatewayPaymentId,\x20skipping','\x20not\x20found\x20in\x20database','ü™ô\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','toFixed','currencyService'];a57_0x4f71=function(){return _0x16b734;};return a57_0x4f71();}var __importDefault=this&&this[a57_0x31ef6e(0x1ee)]||function(_0x3f30b2){return _0x3f30b2&&_0x3f30b2['__esModule']?_0x3f30b2:{'default':_0x3f30b2};};Object[a57_0x31ef6e(0x20a)](exports,'__esModule',{'value':!![]}),exports['coinToPayStatusService']=exports[a57_0x31ef6e(0x1dd)]=void 0x0;const crypto_1=__importDefault(require(a57_0x31ef6e(0x1fb))),coinToPayService_1=require(a57_0x31ef6e(0x227)),coinToPay2Service_1=require(a57_0x31ef6e(0x212)),gateway_1=require(a57_0x31ef6e(0x267)),database_1=__importDefault(require('../config/database')),telegramBotService_1=require('./telegramBotService'),loggerService_1=require('./loggerService'),currencyService_1=require(a57_0x31ef6e(0x24e));class CoinToPayStatusService{constructor(){const _0x1c6adf=a57_0x31ef6e;this[_0x1c6adf(0x29a)]=null,this[_0x1c6adf(0x1fc)]=0x3c*0x3c*0x3e8,this[_0x1c6adf(0x1eb)]=0x5,this[_0x1c6adf(0x1c4)]=new Map(),this[_0x1c6adf(0x29e)]=new coinToPayService_1[(_0x1c6adf(0x1d5))](),this[_0x1c6adf(0x20c)]=new coinToPay2Service_1[(_0x1c6adf(0x21f))](),console[_0x1c6adf(0x254)](_0x1c6adf(0x29b));}[a57_0x31ef6e(0x292)](_0x493c7b,_0x48f4c3){const _0x2be149=a57_0x31ef6e;console[_0x2be149(0x254)]('ü™ô\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:'),console[_0x2be149(0x254)]('\x20\x20\x20-\x20paymentId:\x20'+_0x493c7b),console['log'](_0x2be149(0x1c0)+_0x48f4c3),this[_0x2be149(0x260)](_0x493c7b);const _0x47afe8=[],_0x5d959e=new Date(),_0x9235ac=[{'delay':0x1*0x3c*0x3e8,'description':_0x2be149(0x239)},{'delay':0x2*0x3c*0x3e8,'description':_0x2be149(0x272)},{'delay':0x5*0x3c*0x3e8,'description':_0x2be149(0x247)},{'delay':0x5*0x3c*0x3e8,'description':_0x2be149(0x247)}];console[_0x2be149(0x254)](_0x2be149(0x24b)+_0x9235ac[_0x2be149(0x26c)]+_0x2be149(0x19f)+_0x493c7b);let _0x2f92e1=0x0;_0x9235ac['forEach']((_0x5c90cf,_0x24d7a5)=>{const _0x152fe1=_0x2be149;_0x2f92e1+=_0x5c90cf[_0x152fe1(0x255)];const _0x57cc3b=setTimeout(async()=>{const _0x364967=_0x152fe1;console[_0x364967(0x254)]('ü™ô\x20[TIMER]\x20Individual\x20check\x20#'+(_0x24d7a5+0x1)+'\x20triggered\x20for\x20payment\x20'+_0x493c7b+_0x364967(0x1ca)+_0x5c90cf['description']+')');try{await this[_0x364967(0x1ff)](_0x493c7b),console[_0x364967(0x254)](_0x364967(0x23f)+(_0x24d7a5+0x1)+'\x20completed\x20for\x20payment\x20'+_0x493c7b);}catch(_0x46fc96){console[_0x364967(0x1d9)](_0x364967(0x297)+(_0x24d7a5+0x1)+'\x20for\x20payment\x20'+_0x493c7b+':',_0x46fc96),this[_0x364967(0x28c)](_0x493c7b,_0x48f4c3,_0x46fc96,_0x364967(0x1e5),{'checkNumber':_0x24d7a5+0x1,'scheduledAfter':_0x5c90cf['description'],'isIndividualCheck':!![]});}},_0x2f92e1);_0x47afe8[_0x152fe1(0x24d)](_0x57cc3b),console['log']('‚è∞\x20[DEBUG]\x20Scheduled\x20check\x20#'+(_0x24d7a5+0x1)+'\x20for\x20payment\x20'+_0x493c7b+_0x152fe1(0x1b1)+_0x2f92e1/0x3e8+'\x20seconds\x20('+_0x5c90cf['description']+')');});const _0x10e66b=setInterval(async()=>{const _0x550036=_0x2be149;console['log'](_0x550036(0x230)+_0x493c7b);try{const _0x4d9a7d=await database_1['default']['payment']['findUnique']({'where':{'id':_0x493c7b},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x4d9a7d){console[_0x550036(0x254)](_0x550036(0x1a1)+_0x493c7b+_0x550036(0x1a6)),this[_0x550036(0x260)](_0x493c7b);return;}console[_0x550036(0x254)](_0x550036(0x21a)+_0x493c7b+'\x20current\x20status:\x20'+_0x4d9a7d[_0x550036(0x249)]);if(_0x4d9a7d[_0x550036(0x249)]!==_0x550036(0x1d7)){console['log'](_0x550036(0x246)+_0x493c7b+'\x20status\x20is\x20'+_0x4d9a7d[_0x550036(0x249)]+_0x550036(0x248)),this[_0x550036(0x260)](_0x493c7b);return;}const _0x38dead=Math['floor']((Date[_0x550036(0x208)]()-_0x4d9a7d[_0x550036(0x1c6)][_0x550036(0x27e)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x38dead>=this['EXPIRY_DAYS']){console['log'](_0x550036(0x22c)+_0x493c7b+_0x550036(0x1ad)+this[_0x550036(0x1eb)]+'\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check'),this[_0x550036(0x260)](_0x493c7b);return;}await this[_0x550036(0x1ff)](_0x493c7b),console[_0x550036(0x254)]('‚úÖ\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20'+_0x493c7b);}catch(_0x5e4796){console[_0x550036(0x1d9)]('‚ùå\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20'+_0x493c7b+':',_0x5e4796),this['logCoinToPayError'](_0x493c7b,_0x48f4c3,_0x5e4796,_0x550036(0x1e5),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x47afe8[_0x2be149(0x24d)](_0x10e66b),this[_0x2be149(0x1c4)][_0x2be149(0x1ae)](_0x493c7b,{'timers':_0x47afe8,'paymentId':_0x493c7b,'gatewayPaymentId':_0x48f4c3,'createdAt':_0x5d959e}),console['log'](_0x2be149(0x1aa)+_0x9235ac['length']+_0x2be149(0x1f2)+_0x493c7b),console[_0x2be149(0x254)](_0x2be149(0x289)+this[_0x2be149(0x1c4)]['size']),this[_0x2be149(0x25e)](_0x493c7b,_0x48f4c3,_0x2be149(0x1d7),'PENDING',_0x2be149(0x1e5),{'action':_0x2be149(0x270),'scheduledChecks':_0x9235ac[_0x2be149(0x26c)],'firstCheckIn':_0x9235ac[0x0][_0x2be149(0x255)]/0x3e8,'totalTimers':this[_0x2be149(0x1c4)][_0x2be149(0x26e)]});}[a57_0x31ef6e(0x260)](_0x2e81cf){const _0x44e0d5=a57_0x31ef6e,_0x2306cb=this[_0x44e0d5(0x1c4)][_0x44e0d5(0x1a9)](_0x2e81cf);_0x2306cb?(console[_0x44e0d5(0x254)](_0x44e0d5(0x285)+_0x2306cb[_0x44e0d5(0x214)][_0x44e0d5(0x26c)]+_0x44e0d5(0x1fd)+_0x2e81cf),_0x2306cb['timers'][_0x44e0d5(0x1a7)]((_0x14c8c7,_0x25047f)=>{const _0x205142=_0x44e0d5;_0x14c8c7&&(clearTimeout(_0x14c8c7),clearInterval(_0x14c8c7),console[_0x205142(0x254)]('üßπ\x20[DEBUG]\x20Cleared\x20timer\x20#'+(_0x25047f+0x1)+_0x205142(0x1c5)+_0x2e81cf));}),this['paymentTimers'][_0x44e0d5(0x21d)](_0x2e81cf),console[_0x44e0d5(0x254)](_0x44e0d5(0x273)+_0x2e81cf+'.\x20Remaining\x20active\x20timers:\x20'+this[_0x44e0d5(0x1c4)][_0x44e0d5(0x26e)])):console[_0x44e0d5(0x254)](_0x44e0d5(0x29c)+_0x2e81cf+_0x44e0d5(0x1c9));}async[a57_0x31ef6e(0x1ff)](_0x460495){const _0x21dbc3=a57_0x31ef6e;console['log'](_0x21dbc3(0x22d)+_0x460495);const _0x35b45a=await database_1[_0x21dbc3(0x257)]['payment'][_0x21dbc3(0x204)]({'where':{'id':_0x460495},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x35b45a){console[_0x21dbc3(0x254)](_0x21dbc3(0x294)+_0x460495+_0x21dbc3(0x22f));return;}console[_0x21dbc3(0x254)](_0x21dbc3(0x1f3)+_0x460495+_0x21dbc3(0x291)),console[_0x21dbc3(0x254)]('\x20\x20\x20-\x20Gateway:\x20'+_0x35b45a[_0x21dbc3(0x1e0)]),console[_0x21dbc3(0x254)](_0x21dbc3(0x225)+_0x35b45a['status']),console[_0x21dbc3(0x254)](_0x21dbc3(0x284)+_0x35b45a['gatewayPaymentId']),console[_0x21dbc3(0x254)](_0x21dbc3(0x253)+_0x35b45a['amount']+'\x20'+_0x35b45a['currency']),console[_0x21dbc3(0x254)](_0x21dbc3(0x213)+_0x35b45a['shopId']);if(_0x35b45a[_0x21dbc3(0x1e0)]!==_0x21dbc3(0x25c)&&_0x35b45a['gateway']!==_0x21dbc3(0x1fa)){console['log'](_0x21dbc3(0x268)+_0x460495+_0x21dbc3(0x27b)+_0x35b45a[_0x21dbc3(0x1e0)]+')');return;}if(_0x35b45a['status']!==_0x21dbc3(0x1d7)){console[_0x21dbc3(0x254)]('‚ö†Ô∏è\x20[CHECK]\x20Payment\x20'+_0x460495+_0x21dbc3(0x265)+_0x35b45a['status']+',\x20stopping\x20individual\x20checks'),this[_0x21dbc3(0x260)](_0x460495);return;}if(!_0x35b45a['gatewayPaymentId']){console[_0x21dbc3(0x254)]('‚ö†Ô∏è\x20[CHECK]\x20Payment\x20'+_0x460495+'\x20has\x20no\x20gatewayPaymentId');return;}console[_0x21dbc3(0x254)](_0x21dbc3(0x275)+_0x460495+_0x21dbc3(0x19a)),await this['checkSinglePayment'](_0x35b45a);}[a57_0x31ef6e(0x25e)](_0x8ac8b5,_0x5da803,_0x1d616a,_0x1b9c31,_0x31646e,_0x3111d2){const _0xf6d03b=a57_0x31ef6e,_0x1634c0={'type':'COINTOPAY_STATUS_CHANGE','paymentId':_0x8ac8b5,'gatewayPaymentId':_0x5da803,'oldStatus':_0x1d616a,'newStatus':_0x1b9c31,'source':_0x31646e,'timestamp':new Date()[_0xf6d03b(0x245)](),'details':_0x3111d2||{}};loggerService_1['loggerService'][_0xf6d03b(0x25e)](_0x1634c0),console[_0xf6d03b(0x254)]('ü™ô\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20'+_0x8ac8b5+'\x20('+_0x5da803+')'),console[_0xf6d03b(0x254)](_0xf6d03b(0x1bf)+_0x1d616a+_0xf6d03b(0x215)+_0x1b9c31),console['log'](_0xf6d03b(0x269)+_0x31646e),console['log']('\x20\x20\x20üìÖ\x20Time:\x20'+_0x1634c0[_0xf6d03b(0x222)]),_0x3111d2&&console[_0xf6d03b(0x254)](_0xf6d03b(0x1b9),_0x3111d2);}['logCoinToPayError'](_0x106079,_0x363e2d,_0x2a38a3,_0x1af071,_0x1ce5c3){const _0x4fe626=a57_0x31ef6e,_0x28ccf9={'type':_0x4fe626(0x20b),'paymentId':_0x106079,'gatewayPaymentId':_0x363e2d,'error':_0x2a38a3 instanceof Error?{'message':_0x2a38a3['message'],'stack':_0x2a38a3[_0x4fe626(0x221)]}:_0x2a38a3,'source':_0x1af071,'timestamp':new Date()[_0x4fe626(0x245)](),'context':_0x1ce5c3||{}};loggerService_1[_0x4fe626(0x261)][_0x4fe626(0x28c)](_0x28ccf9),console[_0x4fe626(0x1d9)](_0x4fe626(0x199)+_0x106079+'\x20('+_0x363e2d+')'),console[_0x4fe626(0x1d9)](_0x4fe626(0x234)+(_0x2a38a3 instanceof Error?_0x2a38a3[_0x4fe626(0x1e8)]:_0x2a38a3)),console[_0x4fe626(0x1d9)](_0x4fe626(0x269)+_0x1af071),console[_0x4fe626(0x1d9)](_0x4fe626(0x26d)+_0x28ccf9[_0x4fe626(0x222)]),_0x1ce5c3&&console[_0x4fe626(0x1d9)](_0x4fe626(0x290),_0x1ce5c3);}[a57_0x31ef6e(0x19e)](){const _0x325510=a57_0x31ef6e;console[_0x325510(0x254)]('ü™ô\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)'),this[_0x325510(0x1e4)]()[_0x325510(0x27a)](_0x4fd7fc=>{const _0x21f4e2=_0x325510;console[_0x21f4e2(0x1d9)](_0x21f4e2(0x1b7),_0x4fd7fc);}),this[_0x325510(0x29a)]=setInterval(async()=>{const _0x567846=_0x325510;try{console[_0x567846(0x254)]('ü™ô\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...'),await this[_0x567846(0x1e4)](),console['log'](_0x567846(0x250));}catch(_0x49ca00){console[_0x567846(0x1d9)]('‚ùå\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:',_0x49ca00);}},this[_0x325510(0x1fc)]),console['log'](_0x325510(0x1f7));}[a57_0x31ef6e(0x202)](){const _0x198595=a57_0x31ef6e;console['log'](_0x198595(0x1d6));this[_0x198595(0x29a)]&&(clearInterval(this[_0x198595(0x29a)]),this[_0x198595(0x29a)]=null,console[_0x198595(0x254)](_0x198595(0x19b)));const _0x3ff28a=this[_0x198595(0x1c4)]['size'];for(const [_0x282d17]of this[_0x198595(0x1c4)]){this[_0x198595(0x260)](_0x282d17);}console['log']('üõë\x20[SHUTDOWN]\x20Cleared\x20'+_0x3ff28a+_0x198595(0x27f));}async['checkAllPendingPayments'](){const _0x2e584e=a57_0x31ef6e;try{console['log'](_0x2e584e(0x233));const _0x47f36a=await database_1[_0x2e584e(0x257)][_0x2e584e(0x1b0)][_0x2e584e(0x266)]({'where':{'gateway':{'in':[_0x2e584e(0x25c),'cointopay2']},'status':_0x2e584e(0x1d7),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'secretKey':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x2e584e(0x254)](_0x2e584e(0x21e)+_0x47f36a[_0x2e584e(0x26c)]+'\x20pending\x20CoinToPay\x20payments');if(_0x47f36a[_0x2e584e(0x26c)]===0x0){console[_0x2e584e(0x254)](_0x2e584e(0x25d));return;}const _0x503188=await this['checkExpiredPayments'](_0x47f36a);console[_0x2e584e(0x254)]('‚è∞\x20[GLOBAL]\x20Found\x20'+_0x503188['length']+_0x2e584e(0x1ea));let _0x391a7e=0x0,_0x484926=0x0;for(const _0x28f77e of _0x47f36a){try{if(_0x503188['includes'](_0x28f77e['id'])){console[_0x2e584e(0x254)](_0x2e584e(0x29d)+_0x28f77e['id']+'\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check'),_0x484926++;continue;}if(this['paymentTimers'][_0x2e584e(0x288)](_0x28f77e['id'])){console[_0x2e584e(0x254)](_0x2e584e(0x29d)+_0x28f77e['id']+_0x2e584e(0x28e)),_0x484926++;continue;}const _0x485f7c=(Date['now']()-_0x28f77e['createdAt'][_0x2e584e(0x27e)]())/(0x3e8*0x3c*0x3c);if(_0x485f7c<0x1){console[_0x2e584e(0x254)](_0x2e584e(0x29d)+_0x28f77e['id']+_0x2e584e(0x252)+_0x485f7c[_0x2e584e(0x231)](0x1)+'h),\x20skipping\x20global\x20check'),_0x484926++;continue;}console[_0x2e584e(0x254)](_0x2e584e(0x201)+_0x28f77e['id']+_0x2e584e(0x1c3)+_0x485f7c[_0x2e584e(0x231)](0x1)+'h)'),await this[_0x2e584e(0x19c)](_0x28f77e),_0x391a7e++,await new Promise(_0x2da8f7=>setTimeout(_0x2da8f7,0x7d0));}catch(_0xd5f2a6){console[_0x2e584e(0x1d9)]('‚ùå\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20'+_0x28f77e['id']+':',_0xd5f2a6),this['logCoinToPayError'](_0x28f77e['id'],_0x28f77e[_0x2e584e(0x1bc)]||_0x2e584e(0x1be),_0xd5f2a6,'status_check',{'isGlobalCheck':!![],'paymentAmount':_0x28f77e['amount'],'paymentCurrency':_0x28f77e[_0x2e584e(0x210)],'shopId':_0x28f77e['shopId'],'createdAt':_0x28f77e['createdAt']}),loggerService_1[_0x2e584e(0x261)][_0x2e584e(0x259)](_0x2e584e(0x25c),_0x2e584e(0x1ac)+_0x28f77e[_0x2e584e(0x1bc)],_0xd5f2a6);}}console[_0x2e584e(0x254)](_0x2e584e(0x23c)+_0x391a7e+_0x2e584e(0x22b)+_0x484926+_0x2e584e(0x1e6)+_0x503188['length']+_0x2e584e(0x1ec));}catch(_0xf1cb2e){console[_0x2e584e(0x1d9)]('‚ùå\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:',_0xf1cb2e);}}async[a57_0x31ef6e(0x25f)](_0xe7bc27){const _0x1a1547=a57_0x31ef6e,_0x442d28=[],_0x10c68f=new Date();_0x10c68f['setDate'](_0x10c68f[_0x1a1547(0x1c2)]()-this['EXPIRY_DAYS']),console[_0x1a1547(0x254)](_0x1a1547(0x1fe)+this[_0x1a1547(0x1eb)]+_0x1a1547(0x1b5)+_0x10c68f[_0x1a1547(0x245)]()+')');for(const _0x359f8b of _0xe7bc27){if(_0x359f8b[_0x1a1547(0x1c6)]<_0x10c68f){console[_0x1a1547(0x254)](_0x1a1547(0x296)+_0x359f8b['id']+'\x20is\x20older\x20than\x20'+this[_0x1a1547(0x1eb)]+_0x1a1547(0x216));try{this[_0x1a1547(0x25e)](_0x359f8b['id'],_0x359f8b[_0x1a1547(0x1bc)]||_0x1a1547(0x1be),_0x1a1547(0x1d7),_0x1a1547(0x1ef),_0x1a1547(0x23b),{'reason':_0x1a1547(0x1cf)+this[_0x1a1547(0x1eb)]+_0x1a1547(0x1af),'createdAt':_0x359f8b['createdAt'],'daysSinceCreation':Math[_0x1a1547(0x1cd)]((Date['now']()-_0x359f8b[_0x1a1547(0x1c6)][_0x1a1547(0x27e)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x359f8b['amount'],'paymentCurrency':_0x359f8b[_0x1a1547(0x210)],'shopId':_0x359f8b[_0x1a1547(0x205)]}),await database_1[_0x1a1547(0x257)]['payment']['update']({'where':{'id':_0x359f8b['id']},'data':{'status':_0x1a1547(0x1ef),'updatedAt':new Date()}}),await database_1['default'][_0x1a1547(0x20f)][_0x1a1547(0x298)]({'data':{'paymentId':_0x359f8b['id'],'shopId':_0x359f8b[_0x1a1547(0x205)],'event':_0x1a1547(0x271),'statusCode':0xc8,'responseBody':JSON['stringify']({'reason':'Payment\x20older\x20than\x20'+this[_0x1a1547(0x1eb)]+_0x1a1547(0x1af),'createdAt':_0x359f8b['createdAt'],'expiredAt':new Date()[_0x1a1547(0x245)](),'daysSinceCreation':Math[_0x1a1547(0x1cd)]((Date[_0x1a1547(0x208)]()-_0x359f8b[_0x1a1547(0x1c6)][_0x1a1547(0x27e)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x1a1547(0x24f)](_0x359f8b,'EXPIRED'),await this[_0x1a1547(0x223)](_0x359f8b,_0x1a1547(0x1ef)),this['clearPaymentTimers'](_0x359f8b['id']),_0x442d28[_0x1a1547(0x24d)](_0x359f8b['id']),console[_0x1a1547(0x254)]('‚úÖ\x20[EXPIRY]\x20Payment\x20'+_0x359f8b['id']+'\x20marked\x20as\x20EXPIRED\x20due\x20to\x20'+this[_0x1a1547(0x1eb)]+'-day\x20timeout');}catch(_0x31350b){console[_0x1a1547(0x1d9)]('‚ùå\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20'+_0x359f8b['id']+':',_0x31350b),this[_0x1a1547(0x28c)](_0x359f8b['id'],_0x359f8b[_0x1a1547(0x1bc)]||_0x1a1547(0x1be),_0x31350b,'auto_expire',{'reason':_0x1a1547(0x236),'createdAt':_0x359f8b[_0x1a1547(0x1c6)],'daysSinceCreation':Math[_0x1a1547(0x1cd)]((Date['now']()-_0x359f8b[_0x1a1547(0x1c6)][_0x1a1547(0x27e)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x442d28;}async['checkSinglePayment'](_0x597ad8){const _0x25ebef=a57_0x31ef6e;if(!_0x597ad8['gatewayPaymentId']){console['log'](_0x25ebef(0x268)+_0x597ad8['id']+_0x25ebef(0x22e));return;}console[_0x25ebef(0x254)]('üîç\x20[CHECK]\x20Checking\x20'+_0x597ad8[_0x25ebef(0x1e0)]+_0x25ebef(0x293)+_0x597ad8['id']+'\x20('+_0x597ad8[_0x25ebef(0x1bc)]+')');try{let _0x8c9efb;_0x597ad8[_0x25ebef(0x1e0)]===_0x25ebef(0x1fa)?(_0x8c9efb=await this[_0x25ebef(0x20c)]['checkPaymentStatus'](_0x597ad8[_0x25ebef(0x1bc)]),console[_0x25ebef(0x254)](_0x25ebef(0x235)+_0x597ad8['id']+_0x25ebef(0x295)+_0x8c9efb[_0x25ebef(0x249)])):(_0x8c9efb=await this[_0x25ebef(0x29e)][_0x25ebef(0x206)](_0x597ad8['gatewayPaymentId']),console[_0x25ebef(0x254)](_0x25ebef(0x23e)+_0x597ad8['id']+'\x20status:\x20'+_0x8c9efb[_0x25ebef(0x249)]));_0x8c9efb[_0x25ebef(0x282)]&&console['log'](_0x25ebef(0x1f3)+_0x597ad8['id']+_0x25ebef(0x20d),{'iban':_0x8c9efb['paymentDetails'][_0x25ebef(0x27c)]||_0x25ebef(0x1f1),'transactionId':_0x8c9efb[_0x25ebef(0x282)][_0x25ebef(0x1ed)],'createdOn':_0x8c9efb['paymentDetails'][_0x25ebef(0x1d2)],'confirmedOn':_0x8c9efb[_0x25ebef(0x282)]['confirmedOn']||'not\x20confirmed'});if(_0x8c9efb['status']!==_0x597ad8[_0x25ebef(0x249)]){console['log']('üîÑ\x20[CHECK]\x20Updating\x20payment\x20'+_0x597ad8['id']+_0x25ebef(0x226)+_0x597ad8[_0x25ebef(0x249)]+'\x20to\x20'+_0x8c9efb[_0x25ebef(0x249)]),this['logCoinToPayStatus'](_0x597ad8['id'],_0x597ad8[_0x25ebef(0x1bc)],_0x597ad8[_0x25ebef(0x249)],_0x8c9efb['status'],_0x25ebef(0x1e5),{'paymentDetails':_0x8c9efb[_0x25ebef(0x282)],'amount':_0x8c9efb[_0x25ebef(0x1b2)],'currency':_0x8c9efb[_0x25ebef(0x210)],'shopId':_0x597ad8[_0x25ebef(0x205)],'checkTimestamp':new Date()[_0x25ebef(0x245)]()});const _0x212f27={'status':_0x8c9efb[_0x25ebef(0x249)],'updatedAt':new Date()};if(_0x8c9efb[_0x25ebef(0x249)]==='PAID'&&_0x597ad8['status']!==_0x25ebef(0x25a)){_0x212f27[_0x25ebef(0x262)]=new Date();if(!_0x597ad8[_0x25ebef(0x1d1)]){const _0x1760dd=await currencyService_1[_0x25ebef(0x232)][_0x25ebef(0x23a)](_0x597ad8['amount'],_0x597ad8[_0x25ebef(0x210)]);_0x212f27[_0x25ebef(0x1d1)]=_0x1760dd;const _0x2f080f=await this[_0x25ebef(0x1e7)](_0x597ad8[_0x25ebef(0x205)],_0x597ad8['gateway']),_0x3b43a3=_0x1760dd*(0x1-_0x2f080f/0x64);_0x212f27['amountAfterGatewayCommissionUSDT']=_0x3b43a3,_0x212f27[_0x25ebef(0x24c)]=_0x2f080f,console[_0x25ebef(0x254)](_0x25ebef(0x207)+_0x597ad8['id']+'\x20amounts\x20calculated:'),console[_0x25ebef(0x254)](_0x25ebef(0x244)+_0x597ad8[_0x25ebef(0x1b2)]+'\x20'+_0x597ad8[_0x25ebef(0x210)]+_0x25ebef(0x215)+_0x1760dd[_0x25ebef(0x231)](0x6)+_0x25ebef(0x198)),console[_0x25ebef(0x254)]('\x20\x20\x20Gateway\x20'+_0x597ad8[_0x25ebef(0x1e0)]+_0x25ebef(0x19d)+_0x2f080f+'%'),console[_0x25ebef(0x254)](_0x25ebef(0x274)+_0x3b43a3[_0x25ebef(0x231)](0x6)+_0x25ebef(0x198));}console[_0x25ebef(0x254)]('üí∞\x20[CHECK]\x20Payment\x20'+_0x597ad8['id']+_0x25ebef(0x258)+_0x212f27[_0x25ebef(0x262)]['toISOString']());}if(_0x8c9efb[_0x25ebef(0x282)]){const _0x1331c3=_0x8c9efb[_0x25ebef(0x282)];_0x1331c3[_0x25ebef(0x27c)]&&(_0x212f27['remitterIban']=_0x1331c3['iban'],console['log'](_0x25ebef(0x251)+_0x1331c3[_0x25ebef(0x27c)])),_0x1331c3[_0x25ebef(0x276)]&&console[_0x25ebef(0x254)](_0x25ebef(0x1f6)+_0x1331c3[_0x25ebef(0x276)]),_0x1331c3[_0x25ebef(0x1ed)]&&console[_0x25ebef(0x254)](_0x25ebef(0x283)+_0x1331c3[_0x25ebef(0x1ed)]),_0x1331c3[_0x25ebef(0x1b6)]&&console['log'](_0x25ebef(0x220)+_0x1331c3[_0x25ebef(0x1b6)]);}await database_1[_0x25ebef(0x257)][_0x25ebef(0x1b0)][_0x25ebef(0x1c7)]({'where':{'id':_0x597ad8['id']},'data':_0x212f27});if(_0x8c9efb[_0x25ebef(0x249)]===_0x25ebef(0x25a)&&_0x597ad8[_0x25ebef(0x249)]!=='PAID'){console[_0x25ebef(0x254)](_0x25ebef(0x278)+_0x597ad8['id']+_0x25ebef(0x237));const _0x363fd7=await database_1[_0x25ebef(0x257)][_0x25ebef(0x1b0)][_0x25ebef(0x204)]({'where':{'id':_0x597ad8['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x363fd7?.['paymentLinkId']&&_0x363fd7[_0x25ebef(0x287)])try{const _0x542d88=_0x363fd7[_0x25ebef(0x287)];console[_0x25ebef(0x254)](_0x25ebef(0x217)+_0x542d88['id']+_0x25ebef(0x28a)+_0x542d88[_0x25ebef(0x1f8)]+_0x25ebef(0x21b)+_0x542d88[_0x25ebef(0x1a2)]+_0x25ebef(0x1a3)+_0x542d88[_0x25ebef(0x249)]);const _0x212568=_0x542d88[_0x25ebef(0x1a2)]+0x1,_0x395213=_0x542d88[_0x25ebef(0x1f8)]===_0x25ebef(0x1bb)?_0x25ebef(0x1d0):_0x542d88[_0x25ebef(0x249)];await database_1[_0x25ebef(0x257)][_0x25ebef(0x287)][_0x25ebef(0x1c7)]({'where':{'id':_0x542d88['id']},'data':{'currentPayments':_0x212568,'status':_0x395213,'updatedAt':new Date()}}),console['log'](_0x25ebef(0x197)+_0x542d88['id']+_0x25ebef(0x20e)+_0x542d88['currentPayments']+'\x20->\x20'+_0x212568+_0x25ebef(0x1a3)+_0x542d88[_0x25ebef(0x249)]+_0x25ebef(0x215)+_0x395213);}catch(_0x48c12d){console[_0x25ebef(0x1d9)](_0x25ebef(0x26f),_0x48c12d);}else console[_0x25ebef(0x254)](_0x25ebef(0x278)+_0x597ad8['id']+_0x25ebef(0x1c8));}await database_1[_0x25ebef(0x257)][_0x25ebef(0x20f)][_0x25ebef(0x298)]({'data':{'paymentId':_0x597ad8['id'],'shopId':_0x597ad8[_0x25ebef(0x205)],'event':_0x25ebef(0x21c)+_0x8c9efb[_0x25ebef(0x249)][_0x25ebef(0x1a0)](),'statusCode':0xc8,'responseBody':JSON['stringify']({'oldStatus':_0x597ad8['status'],'newStatus':_0x8c9efb[_0x25ebef(0x249)],'paymentDetails':_0x8c9efb[_0x25ebef(0x282)],'checkedAt':new Date()[_0x25ebef(0x245)]()})}}),await this[_0x25ebef(0x24f)](_0x597ad8,_0x8c9efb[_0x25ebef(0x249)]),await this[_0x25ebef(0x223)](_0x597ad8,_0x8c9efb[_0x25ebef(0x249)]),_0x8c9efb[_0x25ebef(0x249)]!==_0x25ebef(0x1d7)&&(console[_0x25ebef(0x254)](_0x25ebef(0x209)+_0x597ad8['id']+_0x25ebef(0x286)+_0x8c9efb[_0x25ebef(0x249)]+',\x20clearing\x20individual\x20timers'),this['clearPaymentTimers'](_0x597ad8['id'])),console['log'](_0x25ebef(0x275)+_0x597ad8['id']+_0x25ebef(0x28f));}else console[_0x25ebef(0x254)](_0x25ebef(0x1f3)+_0x597ad8['id']+_0x25ebef(0x1de)+_0x8c9efb[_0x25ebef(0x249)]+')'),this[_0x25ebef(0x25e)](_0x597ad8['id'],_0x597ad8[_0x25ebef(0x1bc)],_0x597ad8[_0x25ebef(0x249)],_0x8c9efb[_0x25ebef(0x249)],_0x25ebef(0x1e5),{'statusUnchanged':!![],'paymentDetails':_0x8c9efb[_0x25ebef(0x282)],'amount':_0x8c9efb[_0x25ebef(0x1b2)],'currency':_0x8c9efb[_0x25ebef(0x210)],'shopId':_0x597ad8['shopId'],'checkTimestamp':new Date()[_0x25ebef(0x245)]()});}catch(_0x504961){console[_0x25ebef(0x1d9)](_0x25ebef(0x28d)+_0x597ad8['id']+':',_0x504961),this[_0x25ebef(0x28c)](_0x597ad8['id'],_0x597ad8['gatewayPaymentId'],_0x504961,'status_check',{'paymentAmount':_0x597ad8['amount'],'paymentCurrency':_0x597ad8['currency'],'shopId':_0x597ad8['shopId'],'createdAt':_0x597ad8[_0x25ebef(0x1c6)]}),await database_1[_0x25ebef(0x257)][_0x25ebef(0x20f)][_0x25ebef(0x298)]({'data':{'paymentId':_0x597ad8['id'],'shopId':_0x597ad8['shopId'],'event':'cointopay_status_check_error','statusCode':0x1f4,'responseBody':JSON[_0x25ebef(0x224)]({'error':_0x504961 instanceof Error?_0x504961[_0x25ebef(0x1e8)]:_0x25ebef(0x1ba),'gatewayPaymentId':_0x597ad8[_0x25ebef(0x1bc)],'checkedAt':new Date()[_0x25ebef(0x245)]()})}});}}async[a57_0x31ef6e(0x24f)](_0x4c5e6a,_0x21672b){const _0x4457d9=a57_0x31ef6e,_0x5c0376=Date[_0x4457d9(0x208)]();try{const _0x52cdfe=_0x4c5e6a['shop'],_0x2d1396=_0x52cdfe['settings'];if(!_0x2d1396?.[_0x4457d9(0x1f5)]){console[_0x4457d9(0x254)](_0x4457d9(0x1b4)+_0x52cdfe['id']);return;}const _0x378f73=_0x21672b===_0x4457d9(0x25a)?_0x4457d9(0x263):_0x21672b==='FAILED'?_0x4457d9(0x1f0):_0x21672b===_0x4457d9(0x1ef)?_0x4457d9(0x1f0):'payment.pending';if(!_0x2d1396['webhookEvents']?.[_0x4457d9(0x1db)](_0x378f73)){console[_0x4457d9(0x254)]('Webhook\x20event\x20'+_0x378f73+_0x4457d9(0x1b3)+_0x52cdfe['id']);return;}const _0x25891e=(0x0,gateway_1['getGatewayIdByName'])(_0x4c5e6a[_0x4457d9(0x1e0)])||_0x4c5e6a[_0x4457d9(0x1e0)],_0x3ff8d8={'event':_0x378f73,'payment':{'id':_0x4c5e6a['id'],'order_id':_0x4c5e6a['orderId'],'gateway_order_id':_0x4c5e6a['gatewayOrderId'],'gateway':_0x25891e,'amount':_0x4c5e6a[_0x4457d9(0x1b2)],'currency':_0x4c5e6a[_0x4457d9(0x210)],'status':_0x21672b['toLowerCase'](),'customer_email':_0x4c5e6a['customerEmail'],'customer_name':_0x4c5e6a[_0x4457d9(0x1f4)],'created_at':_0x4c5e6a[_0x4457d9(0x1c6)],'updated_at':new Date()}},_0x2a6bc0=JSON[_0x4457d9(0x224)](_0x3ff8d8),_0x3f225a=crypto_1[_0x4457d9(0x257)]['createHmac'](_0x4457d9(0x26a),_0x4c5e6a[_0x4457d9(0x1a8)][_0x4457d9(0x1dc)])[_0x4457d9(0x1c7)](_0x2a6bc0)['digest'](_0x4457d9(0x1c1)),_0x173ee8=await fetch(_0x2d1396['webhookUrl'],{'method':_0x4457d9(0x23d),'headers':{'Content-Type':'application/json','User-Agent':'Payment\x20System/1.0','X-Webhook-Signature':_0x3f225a},'body':_0x2a6bc0}),_0x94d41a=Date['now']()-_0x5c0376,_0x32f4ea=_0x173ee8['ok']?_0x4457d9(0x1b8):await _0x173ee8[_0x4457d9(0x1e2)]();loggerService_1['loggerService'][_0x4457d9(0x1ab)](_0x4c5e6a['shopId'],_0x2d1396[_0x4457d9(0x1f5)],_0x378f73,_0x173ee8[_0x4457d9(0x249)],_0x94d41a,_0x3ff8d8),console[_0x4457d9(0x254)](_0x4457d9(0x281)+_0x2d1396[_0x4457d9(0x1f5)]+_0x4457d9(0x1d8)+_0x173ee8[_0x4457d9(0x249)]+'\x20('+_0x94d41a+_0x4457d9(0x1f9));}catch(_0x531386){console['error']('Failed\x20to\x20send\x20shop\x20webhook:',_0x531386),loggerService_1['loggerService']['logShopWebhookError'](_0x4c5e6a[_0x4457d9(0x205)],_0x4c5e6a['shop']?.['settings']?.[_0x4457d9(0x1f5)]||_0x4457d9(0x1be),_0x4457d9(0x1d3),_0x531386,{});}}async['sendPaymentStatusNotification'](_0x2bccac,_0x4fca9d){const _0x5d5b19=a57_0x31ef6e;try{const _0x39bfd2={'PENDING':_0x5d5b19(0x299),'PAID':'paid','FAILED':_0x5d5b19(0x200),'EXPIRED':_0x5d5b19(0x277)},_0xa162dd=_0x39bfd2[_0x4fca9d];if(!_0xa162dd||_0xa162dd===_0x5d5b19(0x299))return;await telegramBotService_1[_0x5d5b19(0x264)][_0x5d5b19(0x1da)](_0x2bccac[_0x5d5b19(0x205)],_0x2bccac,_0xa162dd);}catch(_0x4fee84){console['error']('Failed\x20to\x20send\x20Telegram\x20payment\x20notification:',_0x4fee84);}}async[a57_0x31ef6e(0x1a4)](_0x1fa1c6){const _0x111d1a=a57_0x31ef6e;console['log']('üîç\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20'+_0x1fa1c6);const _0x57930a=await database_1[_0x111d1a(0x257)]['payment'][_0x111d1a(0x204)]({'where':{'id':_0x1fa1c6},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x57930a)throw new Error(_0x111d1a(0x1cb));if(_0x57930a[_0x111d1a(0x1e0)]!==_0x111d1a(0x25c)&&_0x57930a[_0x111d1a(0x1e0)]!==_0x111d1a(0x1fa))throw new Error(_0x111d1a(0x203));console['log'](_0x111d1a(0x24a)+_0x57930a[_0x111d1a(0x1e0)]+_0x111d1a(0x293)+_0x1fa1c6),await this[_0x111d1a(0x19c)](_0x57930a),console[_0x111d1a(0x254)]('‚úÖ\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20'+_0x1fa1c6);}[a57_0x31ef6e(0x27d)](){const _0x510e27=a57_0x31ef6e,_0x3a8025=this['globalCheckInterval']?this[_0x510e27(0x1fc)]:undefined,_0x1d1172=Array['from'](this[_0x510e27(0x1c4)][_0x510e27(0x1e1)]())[_0x510e27(0x22a)](_0x253cfd=>({'paymentId':_0x253cfd[_0x510e27(0x238)],'gatewayPaymentId':_0x253cfd[_0x510e27(0x1bc)],'createdAt':_0x253cfd[_0x510e27(0x1c6)],'timersCount':_0x253cfd['timers']['length']}));return{'isActive':!!this[_0x510e27(0x29a)],'globalCheckIntervalMinutes':this[_0x510e27(0x1fc)]/(0x3e8*0x3c),'expiryDays':this['EXPIRY_DAYS'],'activeIndividualTimers':this[_0x510e27(0x1c4)][_0x510e27(0x26e)],'nextGlobalCheckIn':_0x3a8025,'paymentTimersDetails':_0x1d1172};}['getPaymentTimerInfo'](_0x181be5){const _0x57bc85=a57_0x31ef6e,_0x4eb88c=this[_0x57bc85(0x1c4)]['get'](_0x181be5);if(_0x4eb88c)return{'hasTimers':!![],'timersCount':_0x4eb88c[_0x57bc85(0x214)]['length'],'createdAt':_0x4eb88c[_0x57bc85(0x1c6)],'gatewayPaymentId':_0x4eb88c[_0x57bc85(0x1bc)]};return{'hasTimers':![]};}async['getGatewayCommission'](_0x207d37,_0x1dfa6d){const _0x27581a=a57_0x31ef6e;try{const _0x4da0fd=await database_1[_0x27581a(0x257)][_0x27581a(0x1a8)][_0x27581a(0x204)]({'where':{'id':_0x207d37},'select':{'gatewaySettings':!![]}});if(!_0x4da0fd?.[_0x27581a(0x211)])return console[_0x27581a(0x254)](_0x27581a(0x1bd)+_0x207d37+_0x27581a(0x256)),0xa;const _0x379342=JSON[_0x27581a(0x1cc)](_0x4da0fd[_0x27581a(0x211)]);for(const [_0x258380,_0x4ad84c]of Object[_0x27581a(0x26b)](_0x379342)){if(_0x258380['toLowerCase']()===_0x1dfa6d[_0x27581a(0x1a0)]()){const _0x3945c4=_0x4ad84c[_0x27581a(0x219)]||0xa;return console['log'](_0x27581a(0x25b)+_0x1dfa6d+_0x27581a(0x228)+_0x207d37+':\x20'+_0x3945c4+'%'),_0x3945c4;}}return console[_0x27581a(0x254)](_0x27581a(0x279)+_0x1dfa6d+'\x20in\x20shop\x20'+_0x207d37+_0x27581a(0x1e3)),0xa;}catch(_0x528abc){return console[_0x27581a(0x1d9)](_0x27581a(0x241)+_0x207d37+_0x27581a(0x1d4)+_0x1dfa6d+':',_0x528abc),0xa;}}}exports['CoinToPayStatusService']=CoinToPayStatusService,exports[a57_0x31ef6e(0x1e9)]=new CoinToPayStatusService();