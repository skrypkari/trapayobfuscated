'use strict';const a38_0x422eab=a38_0x4481;(function(_0x6e84c0,_0x36297a){const _0x2be44b=a38_0x4481,_0x106be8=_0x6e84c0();while(!![]){try{const _0x42ae36=parseInt(_0x2be44b(0x199))/0x1+parseInt(_0x2be44b(0x185))/0x2+parseInt(_0x2be44b(0xfb))/0x3+parseInt(_0x2be44b(0x11d))/0x4+parseInt(_0x2be44b(0x1a8))/0x5*(-parseInt(_0x2be44b(0x192))/0x6)+parseInt(_0x2be44b(0xfa))/0x7+-parseInt(_0x2be44b(0x168))/0x8;if(_0x42ae36===_0x36297a)break;else _0x106be8['push'](_0x106be8['shift']());}catch(_0x5ef701){_0x106be8['push'](_0x106be8['shift']());}}}(a38_0x22b3,0xc342b));function a38_0x4481(_0x34b048,_0x2eafdc){const _0x22b3f8=a38_0x22b3();return a38_0x4481=function(_0x448163,_0x5f2c6c){_0x448163=_0x448163-0xc7;let _0x23bcaa=_0x22b3f8[_0x448163];return _0x23bcaa;},a38_0x4481(_0x34b048,_0x2eafdc);}function a38_0x22b3(){const _0x191ba8=['\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','✅\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','logShopWebhookError','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','created','❌\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','Webhook\x20event\x20','Gateway\x20','📈\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','paymentLink','checkAllPendingPayments','settings','\x20current\x20status:\x20','amount','CoinToPayStatusService','gateway','sendPaymentNotification','confirmedOn','\x20marked\x20as\x20paid\x20at:\x20','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','\x20days\x20(created\x20before\x20','\x20\x20\x20-\x20GatewayPaymentId:\x20','⚠️\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','Failed\x20to\x20mark\x20payment\x20as\x20expired','🔍\x20[CHECK]\x20Checking\x20','🪙\x20[GLOBAL]\x20Found\x20','5151468dITNNs','4669680hjAKbh','⏰\x20[EXPIRY]\x20Payment\x20','entries','🏦\x20[CHECK]\x20Saved\x20IBAN:\x20','gatewayCommissionRate','\x20individual\x20payment\x20timers','logCoinToPayError','./loggerService','globalCheckInterval','TesSoft\x20Payment\x20System/1.0','\x20(age:\x20','🔄\x20[CHECK]\x20Updating\x20payment\x20','failed','clearPaymentTimers','⏰\x20[DEBUG]\x20Scheduled\x20check\x20#','📊\x20[CHECK]\x20CoinToPay2\x20payment\x20','webhookUrl','\x20status\x20from\x20','⏰\x20[GLOBAL]\x20Payment\x20','📊\x20[CHECK]\x20CoinToPay\x20payment\x20','❌\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','✅\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','✅\x20[CHECK]\x20Payment\x20','coinToPayStatusService','setDate','amountAfterGatewayCommissionUSDT','\x20triggered\x20for\x20payment\x20','2\x20minutes','paymentTimers','webhookEvents','\x20amounts\x20calculated:','❌\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','\x20status:\x20','create','3492612iNUtbh','✅\x20[TIMER]\x20Individual\x20check\x20#','delete','update','🧹\x20[DEBUG]\x20Cleared\x20timer\x20#','⏰\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','POST','EXPIRY_DAYS','\x20days','shopId','telegramBotService','text','size','Bank\x20Details:\x20','🪙\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','timestamp','CoinToPayService','FAILED','\x20\x20\x20📝\x20Details:','\x20skipped,\x20','🏦\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes','currencyService','\x20\x20\x20-\x20gatewayPaymentId:\x20','schedulePaymentChecks','\x20\x20\x20📍\x20Source:\x20','getGatewayCommission','Unknown\x20error','\x20checked,\x20','gatewayOrderId','\x20status\x20changed\x20to\x20','coinToPay2Service',',\x20clearing\x20individual\x20timers','../config/database','gatewayPaymentId','map','❌\x20[TIMER]\x20Failed\x20individual\x20check\x20#','set','now','getServiceStats','❌\x20[CHECK]\x20Payment\x20','adminNotes','\x20timers\x20for\x20payment\x20','getDate','Payment\x20not\x20found','\x20\x20\x20📅\x20Time:\x20','createdAt','❌\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','commission','\x20is\x20valid\x20for\x20checking,\x20proceeding...','GLOBAL_CHECK_INTERVAL_MS','getGatewayIdByName','\x20to\x20clear','cointopay','catch','delay','\x20with\x20status\x20','💰\x20[CHECK]\x20Payment\x20','findUnique','\x20\x20\x20Gateway\x20','currency',',\x20stopping\x20individual\x20checks','webhookLog','status_check',',\x20status=','payment.success','message','currentPayments','checkSinglePaymentById','PENDING','✅\x20[EXPIRY]\x20Payment\x20','🪙\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','🛑\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','stringify','push',',\x20currentPayments=','24336280RYSvoq','payment','logShopWebhookSent','__esModule',',\x20using\x20default\x2010%','❌\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','checkExpiredPayments','h),\x20skipping\x20global\x20check','convertToUSDT','not\x20found','📊\x20[HOURLY]\x20Payment\x20','\x20status\x20is\x20','sendPaymentStatusNotification','🧹\x20[CHECK]\x20Payment\x20','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','timers','forEach','.\x20Remaining\x20active\x20timers:\x20','\x20updated:\x20currentPayments=','toLowerCase','log','bankDetails','transactionId',':\x20type=','🪙\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','✅\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','checkSinglePayment','logCoinToPayStatus','shop','534170mOVMak','\x20updated\x20successfully','EXPIRED','✅\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','5\x20minutes','Automatically\x20expired\x20after\x20','amountUSDT','customerName','\x20\x20\x20-\x20Amount:\x20','length','loggerService','🪙\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','\x20days\x20without\x20payment\x20confirmation','1361886CWgJVB','coinToPayService','logWhiteDomainError','🧹\x20[DEBUG]\x20Clearing\x20','error','❌\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','getTime','1090043dTdqpl','\x20not\x20found,\x20clearing\x20timers',',\x20using\x20default\x20commission\x2010%','Shop\x20webhook\x20sent\x20to\x20','⏰\x20[HOURLY]\x20Payment\x20','gatewaySettings','⚠️\x20[CHECK]\x20Payment\x20','\x20for\x20payment\x20','stack','🪙\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','🪙\x20[DEBUG]\x20Creating\x20','paidAt','COMPLETED','🔍\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','cointopay_auto_expired','15tBPAFf','../types/gateway','\x20\x20\x20-\x20paymentId:\x20','\x20(after\x20','🆔\x20[CHECK]\x20Transaction\x20ID:\x20','from','📊\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','🪙\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','\x20commission:\x20','\x20\x20\x20-\x20Status:\x20','payment.pending','\x20is\x20older\x20than\x20','❌\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','\x20details:','floor','Payment\x20older\x20than\x20','✅\x20[DEBUG]\x20Successfully\x20scheduled\x20','sendShopWebhook','\x20USDT',',\x20gateway\x20','📊\x20[CHECK]\x20Payment\x20','./telegramBotService','unknown','checkPaymentById','\x20completed\x20for\x20payment\x20','\x20pending\x20CoinToPay\x20payments','SINGLE','\x20\x20\x20Amount\x20after\x20commission:\x20','✅\x20[HOURLY]\x20Payment\x20','createdOn','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','\x20->\x20','status','\x20\x20\x20-\x20ShopId:\x20','\x20initial\x20timers\x20for\x20payment\x20','\x20days,\x20marking\x20as\x20EXPIRED','🪙\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','__importDefault','\x20not\x20enabled\x20for\x20shop\x20','description','\x20has\x20no\x20gatewayPaymentId,\x20skipping','values','PAID','webhook_send','✅\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','paymentDetails','✅\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','cointopay2','./currencyService','customerEmail','\x20expired\x20CoinToPay\x20payments','not\x20confirmed','Failed\x20to\x20send\x20shop\x20webhook:','default','stopPeriodicStatusCheck','application/json','get','iban','toISOString','📈\x20[COINTOPAY]\x20Payment\x20','checkPaymentStatus','1\x20minute','\x20to\x20','remitterIban','✅\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','\x20not\x20found\x20in\x20database','has','Success'];a38_0x22b3=function(){return _0x191ba8;};return a38_0x22b3();}var __importDefault=this&&this[a38_0x422eab(0x1cd)]||function(_0x159b40){return _0x159b40&&_0x159b40['__esModule']?_0x159b40:{'default':_0x159b40};};Object['defineProperty'](exports,a38_0x422eab(0x16b),{'value':!![]}),exports['coinToPayStatusService']=exports[a38_0x422eab(0xee)]=void 0x0;const coinToPayService_1=require('./gateways/coinToPayService'),coinToPay2Service_1=require('./gateways/coinToPay2Service'),gateway_1=require(a38_0x422eab(0x1a9)),database_1=__importDefault(require(a38_0x422eab(0x13d))),telegramBotService_1=require(a38_0x422eab(0x1bd)),loggerService_1=require(a38_0x422eab(0x102)),currencyService_1=require(a38_0x422eab(0xcc));class CoinToPayStatusService{constructor(){const _0x5ac61f=a38_0x422eab;this[_0x5ac61f(0x103)]=null,this[_0x5ac61f(0x14e)]=0x3c*0x3c*0x3e8,this[_0x5ac61f(0x124)]=0x5,this[_0x5ac61f(0x117)]=new Map(),this['coinToPayService']=new coinToPayService_1[(_0x5ac61f(0x12d))](),this[_0x5ac61f(0x13b)]=new coinToPay2Service_1['CoinToPay2Service'](),console[_0x5ac61f(0x17c)]('🪙\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2');}[a38_0x422eab(0x134)](_0x481f00,_0x76f242){const _0x5c7f17=a38_0x422eab;console[_0x5c7f17(0x17c)](_0x5c7f17(0x163)),console['log'](_0x5c7f17(0x1aa)+_0x481f00),console[_0x5c7f17(0x17c)](_0x5c7f17(0x133)+_0x76f242),this[_0x5c7f17(0x108)](_0x481f00);const _0x1b71d5=[],_0x2d7b42=new Date(),_0xb358f0=[{'delay':0x1*0x3c*0x3e8,'description':_0x5c7f17(0xd9)},{'delay':0x2*0x3c*0x3e8,'description':_0x5c7f17(0x116)},{'delay':0x5*0x3c*0x3e8,'description':_0x5c7f17(0x189)},{'delay':0x5*0x3c*0x3e8,'description':_0x5c7f17(0x189)}];console['log'](_0x5c7f17(0x1a3)+_0xb358f0[_0x5c7f17(0x18e)]+_0x5c7f17(0x1ca)+_0x481f00);let _0xd8d277=0x0;_0xb358f0[_0x5c7f17(0x178)]((_0x5dadf3,_0x43157b)=>{const _0x566b66=_0x5c7f17;_0xd8d277+=_0x5dadf3[_0x566b66(0x153)];const _0x24ac54=setTimeout(async()=>{const _0x1a2a07=_0x566b66;console[_0x1a2a07(0x17c)]('🪙\x20[TIMER]\x20Individual\x20check\x20#'+(_0x43157b+0x1)+_0x1a2a07(0x115)+_0x481f00+_0x1a2a07(0x1ab)+_0x5dadf3['description']+')');try{await this[_0x1a2a07(0x160)](_0x481f00),console[_0x1a2a07(0x17c)](_0x1a2a07(0x11e)+(_0x43157b+0x1)+_0x1a2a07(0x1c0)+_0x481f00);}catch(_0x409292){console[_0x1a2a07(0x196)](_0x1a2a07(0x140)+(_0x43157b+0x1)+_0x1a2a07(0x1a0)+_0x481f00+':',_0x409292),this[_0x1a2a07(0x101)](_0x481f00,_0x76f242,_0x409292,'status_check',{'checkNumber':_0x43157b+0x1,'scheduledAfter':_0x5dadf3[_0x1a2a07(0x1cf)],'isIndividualCheck':!![]});}},_0xd8d277);_0x1b71d5[_0x566b66(0x166)](_0x24ac54),console[_0x566b66(0x17c)](_0x566b66(0x109)+(_0x43157b+0x1)+'\x20for\x20payment\x20'+_0x481f00+'\x20in\x20'+_0xd8d277/0x3e8+'\x20seconds\x20('+_0x5dadf3[_0x566b66(0x1cf)]+')');});const _0xedfc4a=setInterval(async()=>{const _0x40786a=_0x5c7f17;console[_0x40786a(0x17c)](_0x40786a(0x180)+_0x481f00);try{const _0x1698b6=await database_1[_0x40786a(0xd1)]['payment'][_0x40786a(0x156)]({'where':{'id':_0x481f00},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x1698b6){console[_0x40786a(0x17c)]('❌\x20[HOURLY]\x20Payment\x20'+_0x481f00+_0x40786a(0x19a)),this[_0x40786a(0x108)](_0x481f00);return;}console[_0x40786a(0x17c)](_0x40786a(0x172)+_0x481f00+_0x40786a(0xec)+_0x1698b6[_0x40786a(0x1c8)]);if(_0x1698b6[_0x40786a(0x1c8)]!==_0x40786a(0x161)){console[_0x40786a(0x17c)](_0x40786a(0x1c4)+_0x481f00+_0x40786a(0x173)+_0x1698b6[_0x40786a(0x1c8)]+_0x40786a(0x159)),this[_0x40786a(0x108)](_0x481f00);return;}const _0x3bb176=Math[_0x40786a(0x1b6)]((Date['now']()-_0x1698b6['createdAt'][_0x40786a(0x198)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x3bb176>=this[_0x40786a(0x124)]){console[_0x40786a(0x17c)](_0x40786a(0x19d)+_0x481f00+_0x40786a(0x1b3)+this[_0x40786a(0x124)]+'\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check'),this[_0x40786a(0x108)](_0x481f00);return;}await this[_0x40786a(0x160)](_0x481f00),console[_0x40786a(0x17c)](_0x40786a(0xe1)+_0x481f00);}catch(_0x326b7f){console[_0x40786a(0x196)](_0x40786a(0x197)+_0x481f00+':',_0x326b7f),this[_0x40786a(0x101)](_0x481f00,_0x76f242,_0x326b7f,'status_check',{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x1b71d5[_0x5c7f17(0x166)](_0xedfc4a),this['paymentTimers'][_0x5c7f17(0x141)](_0x481f00,{'timers':_0x1b71d5,'paymentId':_0x481f00,'gatewayPaymentId':_0x76f242,'createdAt':_0x2d7b42}),console['log'](_0x5c7f17(0x1b8)+_0xb358f0[_0x5c7f17(0x18e)]+'\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20'+_0x481f00),console[_0x5c7f17(0x17c)](_0x5c7f17(0x1ae)+this[_0x5c7f17(0x117)][_0x5c7f17(0x129)]),this[_0x5c7f17(0x183)](_0x481f00,_0x76f242,'PENDING',_0x5c7f17(0x161),_0x5c7f17(0x15b),{'action':'schedule_created','scheduledChecks':_0xb358f0['length'],'firstCheckIn':_0xb358f0[0x0][_0x5c7f17(0x153)]/0x3e8,'totalTimers':this[_0x5c7f17(0x117)]['size']});}[a38_0x422eab(0x108)](_0x10f027){const _0x2b91b7=a38_0x422eab,_0x4ca5d1=this[_0x2b91b7(0x117)][_0x2b91b7(0xd4)](_0x10f027);_0x4ca5d1?(console[_0x2b91b7(0x17c)](_0x2b91b7(0x195)+_0x4ca5d1[_0x2b91b7(0x177)][_0x2b91b7(0x18e)]+_0x2b91b7(0x146)+_0x10f027),_0x4ca5d1[_0x2b91b7(0x177)]['forEach']((_0x26a3c9,_0x5cb73a)=>{const _0x351711=_0x2b91b7;_0x26a3c9&&(clearTimeout(_0x26a3c9),clearInterval(_0x26a3c9),console[_0x351711(0x17c)](_0x351711(0x121)+(_0x5cb73a+0x1)+_0x351711(0x1a0)+_0x10f027));}),this[_0x2b91b7(0x117)][_0x2b91b7(0x11f)](_0x10f027),console[_0x2b91b7(0x17c)](_0x2b91b7(0x188)+_0x10f027+_0x2b91b7(0x179)+this[_0x2b91b7(0x117)][_0x2b91b7(0x129)])):console[_0x2b91b7(0x17c)](_0x2b91b7(0xf6)+_0x10f027+_0x2b91b7(0x150));}async[a38_0x422eab(0x160)](_0x13174d){const _0xcff09f=a38_0x422eab;console['log'](_0xcff09f(0x1a6)+_0x13174d);const _0x568349=await database_1[_0xcff09f(0xd1)][_0xcff09f(0x169)][_0xcff09f(0x156)]({'where':{'id':_0x13174d},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x568349){console[_0xcff09f(0x17c)](_0xcff09f(0x144)+_0x13174d+_0xcff09f(0xdd));return;}console['log'](_0xcff09f(0x1bc)+_0x13174d+'\x20found:'),console[_0xcff09f(0x17c)]('\x20\x20\x20-\x20Gateway:\x20'+_0x568349[_0xcff09f(0xef)]),console[_0xcff09f(0x17c)](_0xcff09f(0x1b1)+_0x568349[_0xcff09f(0x1c8)]),console[_0xcff09f(0x17c)](_0xcff09f(0xf5)+_0x568349[_0xcff09f(0x13e)]),console['log'](_0xcff09f(0x18d)+_0x568349[_0xcff09f(0xed)]+'\x20'+_0x568349[_0xcff09f(0x158)]),console[_0xcff09f(0x17c)](_0xcff09f(0x1c9)+_0x568349[_0xcff09f(0x126)]);if(_0x568349['gateway']!==_0xcff09f(0x151)&&_0x568349[_0xcff09f(0xef)]!==_0xcff09f(0xcb)){console[_0xcff09f(0x17c)](_0xcff09f(0x19f)+_0x13174d+'\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20'+_0x568349['gateway']+')');return;}if(_0x568349[_0xcff09f(0x1c8)]!==_0xcff09f(0x161)){console[_0xcff09f(0x17c)](_0xcff09f(0x19f)+_0x13174d+_0xcff09f(0x173)+_0x568349['status']+_0xcff09f(0x159)),this[_0xcff09f(0x108)](_0x13174d);return;}if(!_0x568349['gatewayPaymentId']){console[_0xcff09f(0x17c)](_0xcff09f(0x19f)+_0x13174d+'\x20has\x20no\x20gatewayPaymentId');return;}console[_0xcff09f(0x17c)](_0xcff09f(0x111)+_0x13174d+_0xcff09f(0x14d)),await this['checkSinglePayment'](_0x568349);}[a38_0x422eab(0x183)](_0x32e67b,_0x75bae5,_0x353ab4,_0xbaebb5,_0x3fc78c,_0x116bbf){const _0x35acd7=a38_0x422eab,_0x5bbe83={'type':'COINTOPAY_STATUS_CHANGE','paymentId':_0x32e67b,'gatewayPaymentId':_0x75bae5,'oldStatus':_0x353ab4,'newStatus':_0xbaebb5,'source':_0x3fc78c,'timestamp':new Date()['toISOString'](),'details':_0x116bbf||{}};loggerService_1[_0x35acd7(0x18f)]['logCoinToPayStatus'](_0x5bbe83),console[_0x35acd7(0x17c)](_0x35acd7(0x1cc)+_0x32e67b+'\x20('+_0x75bae5+')'),console['log']('\x20\x20\x20📊\x20Status:\x20'+_0x353ab4+_0x35acd7(0x1c7)+_0xbaebb5),console['log'](_0x35acd7(0x135)+_0x3fc78c),console['log'](_0x35acd7(0x149)+_0x5bbe83[_0x35acd7(0x12c)]),_0x116bbf&&console[_0x35acd7(0x17c)](_0x35acd7(0x12f),_0x116bbf);}[a38_0x422eab(0x101)](_0xe25657,_0x2488d2,_0x14d732,_0x263a77,_0x447f4e){const _0x446a9a=a38_0x422eab,_0x1e29bc={'type':'COINTOPAY_ERROR','paymentId':_0xe25657,'gatewayPaymentId':_0x2488d2,'error':_0x14d732 instanceof Error?{'message':_0x14d732[_0x446a9a(0x15e)],'stack':_0x14d732[_0x446a9a(0x1a1)]}:_0x14d732,'source':_0x263a77,'timestamp':new Date()[_0x446a9a(0xd6)](),'context':_0x447f4e||{}};loggerService_1[_0x446a9a(0x18f)][_0x446a9a(0x101)](_0x1e29bc),console[_0x446a9a(0x196)]('🪙\x20[ERROR]\x20CoinToPay\x20Error:\x20'+_0xe25657+'\x20('+_0x2488d2+')'),console['error']('\x20\x20\x20❌\x20Error:\x20'+(_0x14d732 instanceof Error?_0x14d732[_0x446a9a(0x15e)]:_0x14d732)),console[_0x446a9a(0x196)](_0x446a9a(0x135)+_0x263a77),console[_0x446a9a(0x196)](_0x446a9a(0x149)+_0x1e29bc[_0x446a9a(0x12c)]),_0x447f4e&&console['error']('\x20\x20\x20📝\x20Context:',_0x447f4e);}['startPeriodicStatusCheck'](){const _0x421b16=a38_0x422eab;console[_0x421b16(0x17c)](_0x421b16(0x1a2)),this[_0x421b16(0xea)]()[_0x421b16(0x152)](_0x45ff0d=>{const _0x588e68=_0x421b16;console[_0x588e68(0x196)]('❌\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:',_0x45ff0d);}),this['globalCheckInterval']=setInterval(async()=>{const _0x121a97=_0x421b16;try{console[_0x121a97(0x17c)](_0x121a97(0x1af)),await this[_0x121a97(0xea)](),console['log'](_0x121a97(0xca));}catch(_0x1c6497){console[_0x121a97(0x196)](_0x121a97(0x1b4),_0x1c6497);}},this[_0x421b16(0x14e)]),console[_0x421b16(0x17c)]('✅\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)');}[a38_0x422eab(0xd2)](){const _0x181817=a38_0x422eab;console[_0x181817(0x17c)](_0x181817(0x164));this[_0x181817(0x103)]&&(clearInterval(this['globalCheckInterval']),this[_0x181817(0x103)]=null,console[_0x181817(0x17c)]('🛑\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped'));const _0x4a162c=this[_0x181817(0x117)]['size'];for(const [_0x4e2d3e]of this[_0x181817(0x117)]){this[_0x181817(0x108)](_0x4e2d3e);}console[_0x181817(0x17c)]('🛑\x20[SHUTDOWN]\x20Cleared\x20'+_0x4a162c+_0x181817(0x100));}async[a38_0x422eab(0xea)](){const _0x14098a=a38_0x422eab;try{console[_0x14098a(0x17c)](_0x14098a(0x190));const _0x4c2e70=await database_1[_0x14098a(0xd1)][_0x14098a(0x169)]['findMany']({'where':{'gateway':{'in':[_0x14098a(0x151),'cointopay2']},'status':_0x14098a(0x161),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console['log'](_0x14098a(0xf9)+_0x4c2e70['length']+_0x14098a(0x1c1));if(_0x4c2e70[_0x14098a(0x18e)]===0x0){console[_0x14098a(0x17c)](_0x14098a(0x12b));return;}const _0x53ba3f=await this[_0x14098a(0x16e)](_0x4c2e70);console[_0x14098a(0x17c)]('⏰\x20[GLOBAL]\x20Found\x20'+_0x53ba3f[_0x14098a(0x18e)]+_0x14098a(0xce));let _0x2e6277=0x0,_0x5c0195=0x0;for(const _0x467ddc of _0x4c2e70){try{if(_0x53ba3f['includes'](_0x467ddc['id'])){console[_0x14098a(0x17c)](_0x14098a(0x10d)+_0x467ddc['id']+_0x14098a(0x1c6)),_0x5c0195++;continue;}if(this[_0x14098a(0x117)][_0x14098a(0xde)](_0x467ddc['id'])){console['log'](_0x14098a(0x10d)+_0x467ddc['id']+'\x20has\x20individual\x20timers,\x20skipping\x20global\x20check'),_0x5c0195++;continue;}const _0x4f01bd=(Date[_0x14098a(0x142)]()-_0x467ddc['createdAt'][_0x14098a(0x198)]())/(0x3e8*0x3c*0x3c);if(_0x4f01bd<0x1){console[_0x14098a(0x17c)](_0x14098a(0x10d)+_0x467ddc['id']+'\x20is\x20too\x20new\x20('+_0x4f01bd['toFixed'](0x1)+_0x14098a(0x16f)),_0x5c0195++;continue;}console[_0x14098a(0x17c)]('🔍\x20[GLOBAL]\x20Checking\x20old\x20payment\x20'+_0x467ddc['id']+_0x14098a(0x105)+_0x4f01bd['toFixed'](0x1)+'h)'),await this[_0x14098a(0x182)](_0x467ddc),_0x2e6277++,await new Promise(_0x15af4f=>setTimeout(_0x15af4f,0x7d0));}catch(_0x30302b){console[_0x14098a(0x196)](_0x14098a(0x11a)+_0x467ddc['id']+':',_0x30302b),this['logCoinToPayError'](_0x467ddc['id'],_0x467ddc['gatewayPaymentId']||'unknown',_0x30302b,_0x14098a(0x15b),{'isGlobalCheck':!![],'paymentAmount':_0x467ddc[_0x14098a(0xed)],'paymentCurrency':_0x467ddc[_0x14098a(0x158)],'shopId':_0x467ddc[_0x14098a(0x126)],'createdAt':_0x467ddc[_0x14098a(0x14a)]}),loggerService_1['loggerService'][_0x14098a(0x194)](_0x14098a(0x151),'/status/'+_0x467ddc[_0x14098a(0x13e)],_0x30302b);}}console[_0x14098a(0x17c)](_0x14098a(0xdc)+_0x2e6277+_0x14098a(0x138)+_0x5c0195+_0x14098a(0x130)+_0x53ba3f[_0x14098a(0x18e)]+'\x20expired');}catch(_0x4bdb90){console[_0x14098a(0x196)](_0x14098a(0x10f),_0x4bdb90);}}async[a38_0x422eab(0x16e)](_0x254b23){const _0x4160ef=a38_0x422eab,_0x2fc97c=[],_0x15713f=new Date();_0x15713f[_0x4160ef(0x113)](_0x15713f[_0x4160ef(0x147)]()-this[_0x4160ef(0x124)]),console['log'](_0x4160ef(0x122)+this['EXPIRY_DAYS']+_0x4160ef(0xf4)+_0x15713f[_0x4160ef(0xd6)]()+')');for(const _0x415095 of _0x254b23){if(_0x415095[_0x4160ef(0x14a)]<_0x15713f){console[_0x4160ef(0x17c)](_0x4160ef(0xfc)+_0x415095['id']+_0x4160ef(0x1b3)+this[_0x4160ef(0x124)]+_0x4160ef(0x1cb));try{this['logCoinToPayStatus'](_0x415095['id'],_0x415095[_0x4160ef(0x13e)]||'unknown',_0x4160ef(0x161),_0x4160ef(0x187),'auto_expire',{'reason':_0x4160ef(0x1b7)+this[_0x4160ef(0x124)]+_0x4160ef(0x125),'createdAt':_0x415095[_0x4160ef(0x14a)],'daysSinceCreation':Math[_0x4160ef(0x1b6)]((Date[_0x4160ef(0x142)]()-_0x415095[_0x4160ef(0x14a)][_0x4160ef(0x198)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x415095[_0x4160ef(0xed)],'paymentCurrency':_0x415095['currency'],'shopId':_0x415095[_0x4160ef(0x126)]}),await database_1[_0x4160ef(0xd1)]['payment'][_0x4160ef(0x120)]({'where':{'id':_0x415095['id']},'data':{'status':'EXPIRED','updatedAt':new Date(),'adminNotes':_0x4160ef(0x18a)+this[_0x4160ef(0x124)]+_0x4160ef(0x191)}}),await database_1[_0x4160ef(0xd1)][_0x4160ef(0x15a)][_0x4160ef(0x11c)]({'data':{'paymentId':_0x415095['id'],'shopId':_0x415095[_0x4160ef(0x126)],'event':_0x4160ef(0x1a7),'statusCode':0xc8,'responseBody':JSON[_0x4160ef(0x165)]({'reason':'Payment\x20older\x20than\x20'+this[_0x4160ef(0x124)]+'\x20days','createdAt':_0x415095[_0x4160ef(0x14a)],'expiredAt':new Date()[_0x4160ef(0xd6)](),'daysSinceCreation':Math[_0x4160ef(0x1b6)]((Date[_0x4160ef(0x142)]()-_0x415095['createdAt'][_0x4160ef(0x198)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x4160ef(0x1b9)](_0x415095,_0x4160ef(0x187)),await this[_0x4160ef(0x174)](_0x415095,_0x4160ef(0x187)),this[_0x4160ef(0x108)](_0x415095['id']),_0x2fc97c[_0x4160ef(0x166)](_0x415095['id']),console['log'](_0x4160ef(0x162)+_0x415095['id']+_0x4160ef(0xe0)+this[_0x4160ef(0x124)]+'-day\x20timeout');}catch(_0x322c72){console[_0x4160ef(0x196)](_0x4160ef(0x14b)+_0x415095['id']+':',_0x322c72),this[_0x4160ef(0x101)](_0x415095['id'],_0x415095[_0x4160ef(0x13e)]||_0x4160ef(0x1be),_0x322c72,'auto_expire',{'reason':_0x4160ef(0xf7),'createdAt':_0x415095[_0x4160ef(0x14a)],'daysSinceCreation':Math[_0x4160ef(0x1b6)]((Date[_0x4160ef(0x142)]()-_0x415095[_0x4160ef(0x14a)][_0x4160ef(0x198)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x2fc97c;}async['checkSinglePayment'](_0x4840a7){const _0x4363ea=a38_0x422eab;if(!_0x4840a7[_0x4363ea(0x13e)]){console['log'](_0x4363ea(0x19f)+_0x4840a7['id']+_0x4363ea(0x1d0));return;}console[_0x4363ea(0x17c)](_0x4363ea(0xf8)+_0x4840a7['gateway']+'\x20payment\x20'+_0x4840a7['id']+'\x20('+_0x4840a7[_0x4363ea(0x13e)]+')');try{let _0x360af5;_0x4840a7[_0x4363ea(0xef)]===_0x4363ea(0xcb)?(_0x360af5=await this[_0x4363ea(0x13b)][_0x4363ea(0xd8)](_0x4840a7['gatewayPaymentId']),console[_0x4363ea(0x17c)](_0x4363ea(0x10a)+_0x4840a7['id']+'\x20status:\x20'+_0x360af5[_0x4363ea(0x1c8)])):(_0x360af5=await this[_0x4363ea(0x193)][_0x4363ea(0xd8)](_0x4840a7['gatewayPaymentId']),console['log'](_0x4363ea(0x10e)+_0x4840a7['id']+_0x4363ea(0x11b)+_0x360af5[_0x4363ea(0x1c8)]));_0x360af5[_0x4363ea(0xc9)]&&console['log'](_0x4363ea(0x1bc)+_0x4840a7['id']+_0x4363ea(0x1b5),{'iban':_0x360af5[_0x4363ea(0xc9)][_0x4363ea(0xd5)]||_0x4363ea(0x171),'transactionId':_0x360af5['paymentDetails'][_0x4363ea(0x17e)],'createdOn':_0x360af5[_0x4363ea(0xc9)][_0x4363ea(0x1c5)],'confirmedOn':_0x360af5[_0x4363ea(0xc9)][_0x4363ea(0xf1)]||_0x4363ea(0xcf)});if(_0x360af5[_0x4363ea(0x1c8)]!==_0x4840a7[_0x4363ea(0x1c8)]){console[_0x4363ea(0x17c)](_0x4363ea(0x106)+_0x4840a7['id']+_0x4363ea(0x10c)+_0x4840a7['status']+_0x4363ea(0xda)+_0x360af5[_0x4363ea(0x1c8)]),this[_0x4363ea(0x183)](_0x4840a7['id'],_0x4840a7[_0x4363ea(0x13e)],_0x4840a7['status'],_0x360af5[_0x4363ea(0x1c8)],_0x4363ea(0x15b),{'paymentDetails':_0x360af5[_0x4363ea(0xc9)],'amount':_0x360af5['amount'],'currency':_0x360af5['currency'],'shopId':_0x4840a7['shopId'],'checkTimestamp':new Date()[_0x4363ea(0xd6)]()});const _0x173c94={'status':_0x360af5['status'],'updatedAt':new Date()};if(_0x360af5[_0x4363ea(0x1c8)]===_0x4363ea(0x1d2)&&_0x4840a7[_0x4363ea(0x1c8)]!==_0x4363ea(0x1d2)){_0x173c94[_0x4363ea(0x1a4)]=new Date();if(!_0x4840a7[_0x4363ea(0x18b)]){const _0x4b5b6b=await currencyService_1[_0x4363ea(0x132)][_0x4363ea(0x170)](_0x4840a7['amount'],_0x4840a7['currency']);_0x173c94[_0x4363ea(0x18b)]=_0x4b5b6b;const _0x16a0d9=await this[_0x4363ea(0x136)](_0x4840a7[_0x4363ea(0x126)],_0x4840a7[_0x4363ea(0xef)]),_0x264f48=_0x4b5b6b*(0x1-_0x16a0d9/0x64);_0x173c94[_0x4363ea(0x114)]=_0x264f48,_0x173c94[_0x4363ea(0xff)]=_0x16a0d9,console[_0x4363ea(0x17c)](_0x4363ea(0x155)+_0x4840a7['id']+_0x4363ea(0x119)),console['log']('\x20\x20\x20Amount:\x20'+_0x4840a7[_0x4363ea(0xed)]+'\x20'+_0x4840a7[_0x4363ea(0x158)]+'\x20->\x20'+_0x4b5b6b['toFixed'](0x6)+_0x4363ea(0x1ba)),console[_0x4363ea(0x17c)](_0x4363ea(0x157)+_0x4840a7['gateway']+_0x4363ea(0x1b0)+_0x16a0d9+'%'),console['log'](_0x4363ea(0x1c3)+_0x264f48['toFixed'](0x6)+_0x4363ea(0x1ba));}console[_0x4363ea(0x17c)](_0x4363ea(0x155)+_0x4840a7['id']+_0x4363ea(0xf2)+_0x173c94[_0x4363ea(0x1a4)][_0x4363ea(0xd6)]());}if(_0x360af5[_0x4363ea(0xc9)]){const _0x36f4e2=_0x360af5[_0x4363ea(0xc9)];_0x36f4e2[_0x4363ea(0xd5)]&&(_0x173c94[_0x4363ea(0xdb)]=_0x36f4e2[_0x4363ea(0xd5)],console[_0x4363ea(0x17c)](_0x4363ea(0xfe)+_0x36f4e2['iban']));if(_0x36f4e2[_0x4363ea(0x17d)]){const _0x15101b=_0x4840a7[_0x4363ea(0x145)]||'',_0x4fc584=_0x4363ea(0x12a)+_0x36f4e2[_0x4363ea(0x17d)];_0x173c94['adminNotes']=_0x15101b?_0x15101b+'\x0a\x0a'+_0x4fc584:_0x4fc584,console[_0x4363ea(0x17c)](_0x4363ea(0x131));}_0x36f4e2[_0x4363ea(0x17e)]&&console[_0x4363ea(0x17c)](_0x4363ea(0x1ac)+_0x36f4e2[_0x4363ea(0x17e)]),_0x36f4e2[_0x4363ea(0xf1)]&&console[_0x4363ea(0x17c)](_0x4363ea(0x110)+_0x36f4e2[_0x4363ea(0xf1)]);}await database_1['default'][_0x4363ea(0x169)][_0x4363ea(0x120)]({'where':{'id':_0x4840a7['id']},'data':_0x173c94});if(_0x360af5[_0x4363ea(0x1c8)]===_0x4363ea(0x1d2)&&_0x4840a7[_0x4363ea(0x1c8)]!==_0x4363ea(0x1d2)){console[_0x4363ea(0x17c)](_0x4363ea(0xd7)+_0x4840a7['id']+'\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link');const _0x5b753b=await database_1[_0x4363ea(0xd1)][_0x4363ea(0x169)][_0x4363ea(0x156)]({'where':{'id':_0x4840a7['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x5b753b?.['paymentLinkId']&&_0x5b753b[_0x4363ea(0xe9)])try{const _0x5715e1=_0x5b753b[_0x4363ea(0xe9)];console['log'](_0x4363ea(0xe8)+_0x5715e1['id']+_0x4363ea(0x17f)+_0x5715e1['type']+_0x4363ea(0x167)+_0x5715e1[_0x4363ea(0x15f)]+',\x20status='+_0x5715e1[_0x4363ea(0x1c8)]);const _0x107464=_0x5715e1[_0x4363ea(0x15f)]+0x1,_0x112180=_0x5715e1['type']===_0x4363ea(0x1c2)?_0x4363ea(0x1a5):_0x5715e1[_0x4363ea(0x1c8)];await database_1['default'][_0x4363ea(0xe9)][_0x4363ea(0x120)]({'where':{'id':_0x5715e1['id']},'data':{'currentPayments':_0x107464,'status':_0x112180,'updatedAt':new Date()}}),console[_0x4363ea(0x17c)]('✅\x20[COINTOPAY]\x20Payment\x20link\x20'+_0x5715e1['id']+_0x4363ea(0x17a)+_0x5715e1[_0x4363ea(0x15f)]+_0x4363ea(0x1c7)+_0x107464+_0x4363ea(0x15c)+_0x5715e1[_0x4363ea(0x1c8)]+_0x4363ea(0x1c7)+_0x112180);}catch(_0x5852f8){console[_0x4363ea(0x196)](_0x4363ea(0x16d),_0x5852f8);}else console['log'](_0x4363ea(0xd7)+_0x4840a7['id']+_0x4363ea(0xe3));}await database_1[_0x4363ea(0xd1)][_0x4363ea(0x15a)][_0x4363ea(0x11c)]({'data':{'paymentId':_0x4840a7['id'],'shopId':_0x4840a7['shopId'],'event':'cointopay_status_check_'+_0x360af5[_0x4363ea(0x1c8)][_0x4363ea(0x17b)](),'statusCode':0xc8,'responseBody':JSON[_0x4363ea(0x165)]({'oldStatus':_0x4840a7[_0x4363ea(0x1c8)],'newStatus':_0x360af5[_0x4363ea(0x1c8)],'paymentDetails':_0x360af5['paymentDetails'],'checkedAt':new Date()['toISOString']()})}}),await this[_0x4363ea(0x1b9)](_0x4840a7,_0x360af5[_0x4363ea(0x1c8)]),await this[_0x4363ea(0x174)](_0x4840a7,_0x360af5[_0x4363ea(0x1c8)]),_0x360af5['status']!=='PENDING'&&(console[_0x4363ea(0x17c)](_0x4363ea(0x175)+_0x4840a7['id']+_0x4363ea(0x13a)+_0x360af5['status']+_0x4363ea(0x13c)),this[_0x4363ea(0x108)](_0x4840a7['id'])),console[_0x4363ea(0x17c)](_0x4363ea(0x111)+_0x4840a7['id']+_0x4363ea(0x186));}else console[_0x4363ea(0x17c)](_0x4363ea(0x1bc)+_0x4840a7['id']+'\x20status\x20unchanged\x20('+_0x360af5[_0x4363ea(0x1c8)]+')'),this[_0x4363ea(0x183)](_0x4840a7['id'],_0x4840a7[_0x4363ea(0x13e)],_0x4840a7[_0x4363ea(0x1c8)],_0x360af5['status'],'status_check',{'statusUnchanged':!![],'paymentDetails':_0x360af5['paymentDetails'],'amount':_0x360af5[_0x4363ea(0xed)],'currency':_0x360af5[_0x4363ea(0x158)],'shopId':_0x4840a7[_0x4363ea(0x126)],'checkTimestamp':new Date()[_0x4363ea(0xd6)]()});}catch(_0x3e18d2){console[_0x4363ea(0x196)](_0x4363ea(0xe5)+_0x4840a7['id']+':',_0x3e18d2),this[_0x4363ea(0x101)](_0x4840a7['id'],_0x4840a7[_0x4363ea(0x13e)],_0x3e18d2,_0x4363ea(0x15b),{'paymentAmount':_0x4840a7['amount'],'paymentCurrency':_0x4840a7[_0x4363ea(0x158)],'shopId':_0x4840a7[_0x4363ea(0x126)],'createdAt':_0x4840a7[_0x4363ea(0x14a)]}),await database_1['default']['webhookLog'][_0x4363ea(0x11c)]({'data':{'paymentId':_0x4840a7['id'],'shopId':_0x4840a7['shopId'],'event':'cointopay_status_check_error','statusCode':0x1f4,'responseBody':JSON[_0x4363ea(0x165)]({'error':_0x3e18d2 instanceof Error?_0x3e18d2['message']:_0x4363ea(0x137),'gatewayPaymentId':_0x4840a7[_0x4363ea(0x13e)],'checkedAt':new Date()[_0x4363ea(0xd6)]()})}});}}async[a38_0x422eab(0x1b9)](_0xdeb3a,_0x1bb0de){const _0x29d54e=a38_0x422eab,_0x4eaebb=Date['now']();try{const _0x2fde38=_0xdeb3a[_0x29d54e(0x184)],_0x53babd=_0x2fde38[_0x29d54e(0xeb)];if(!_0x53babd?.[_0x29d54e(0x10b)]){console[_0x29d54e(0x17c)](_0x29d54e(0x176)+_0x2fde38['id']);return;}const _0x80e562=_0x1bb0de==='PAID'?_0x29d54e(0x15d):_0x1bb0de===_0x29d54e(0x12e)?'payment.failed':_0x1bb0de==='EXPIRED'?'payment.failed':_0x29d54e(0x1b2);if(!_0x53babd[_0x29d54e(0x118)]?.['includes'](_0x80e562)){console['log'](_0x29d54e(0xe6)+_0x80e562+_0x29d54e(0x1ce)+_0x2fde38['id']);return;}const _0x5374ae=(0x0,gateway_1[_0x29d54e(0x14f)])(_0xdeb3a[_0x29d54e(0xef)])||_0xdeb3a[_0x29d54e(0xef)],_0xd84d32={'event':_0x80e562,'payment':{'id':_0xdeb3a['id'],'order_id':_0xdeb3a['orderId'],'gateway_order_id':_0xdeb3a[_0x29d54e(0x139)],'gateway':_0x5374ae,'amount':_0xdeb3a[_0x29d54e(0xed)],'currency':_0xdeb3a[_0x29d54e(0x158)],'status':_0x1bb0de[_0x29d54e(0x17b)](),'customer_email':_0xdeb3a[_0x29d54e(0xcd)],'customer_name':_0xdeb3a[_0x29d54e(0x18c)],'created_at':_0xdeb3a['createdAt'],'updated_at':new Date()}},_0x485100=await fetch(_0x53babd['webhookUrl'],{'method':_0x29d54e(0x123),'headers':{'Content-Type':_0x29d54e(0xd3),'User-Agent':_0x29d54e(0x104)},'body':JSON[_0x29d54e(0x165)](_0xd84d32)}),_0x3bef6d=Date[_0x29d54e(0x142)]()-_0x4eaebb,_0x52df07=_0x485100['ok']?_0x29d54e(0xdf):await _0x485100[_0x29d54e(0x128)]();loggerService_1[_0x29d54e(0x18f)][_0x29d54e(0x16a)](_0xdeb3a['shopId'],_0x53babd[_0x29d54e(0x10b)],_0x80e562,_0x485100[_0x29d54e(0x1c8)],_0x3bef6d,_0xd84d32),console[_0x29d54e(0x17c)](_0x29d54e(0x19c)+_0x53babd[_0x29d54e(0x10b)]+_0x29d54e(0x154)+_0x485100['status']+'\x20('+_0x3bef6d+'ms)');}catch(_0x4b8cd5){console['error'](_0x29d54e(0xd0),_0x4b8cd5),loggerService_1['loggerService'][_0x29d54e(0xe2)](_0xdeb3a[_0x29d54e(0x126)],_0xdeb3a[_0x29d54e(0x184)]?.[_0x29d54e(0xeb)]?.[_0x29d54e(0x10b)]||_0x29d54e(0x1be),_0x29d54e(0x1d3),_0x4b8cd5,{});}}async[a38_0x422eab(0x174)](_0x1151cf,_0x1ed6ff){const _0x18bb4c=a38_0x422eab;try{const _0x96a300={'PENDING':_0x18bb4c(0xe4),'PAID':'paid','FAILED':_0x18bb4c(0x107),'EXPIRED':'expired'},_0xe42ecb=_0x96a300[_0x1ed6ff];if(!_0xe42ecb||_0xe42ecb==='created')return;await telegramBotService_1[_0x18bb4c(0x127)][_0x18bb4c(0xf0)](_0x1151cf[_0x18bb4c(0x126)],_0x1151cf,_0xe42ecb);}catch(_0x56f7f8){console[_0x18bb4c(0x196)]('Failed\x20to\x20send\x20Telegram\x20payment\x20notification:',_0x56f7f8);}}async[a38_0x422eab(0x1bf)](_0x103ddc){const _0x10c2fa=a38_0x422eab;console[_0x10c2fa(0x17c)]('🔍\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20'+_0x103ddc);const _0x38a9b=await database_1[_0x10c2fa(0xd1)][_0x10c2fa(0x169)][_0x10c2fa(0x156)]({'where':{'id':_0x103ddc},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x38a9b)throw new Error(_0x10c2fa(0x148));if(_0x38a9b[_0x10c2fa(0xef)]!=='cointopay'&&_0x38a9b['gateway']!==_0x10c2fa(0xcb))throw new Error(_0x10c2fa(0xc8));console[_0x10c2fa(0x17c)](_0x10c2fa(0xc7)+_0x38a9b[_0x10c2fa(0xef)]+'\x20payment\x20'+_0x103ddc),await this[_0x10c2fa(0x182)](_0x38a9b),console[_0x10c2fa(0x17c)](_0x10c2fa(0x181)+_0x103ddc);}[a38_0x422eab(0x143)](){const _0x4cbf88=a38_0x422eab,_0xa4ea8b=this[_0x4cbf88(0x103)]?this[_0x4cbf88(0x14e)]:undefined,_0x453816=Array[_0x4cbf88(0x1ad)](this[_0x4cbf88(0x117)][_0x4cbf88(0x1d1)]())[_0x4cbf88(0x13f)](_0x2526ab=>({'paymentId':_0x2526ab['paymentId'],'gatewayPaymentId':_0x2526ab[_0x4cbf88(0x13e)],'createdAt':_0x2526ab[_0x4cbf88(0x14a)],'timersCount':_0x2526ab[_0x4cbf88(0x177)][_0x4cbf88(0x18e)]}));return{'isActive':!!this[_0x4cbf88(0x103)],'globalCheckIntervalMinutes':this[_0x4cbf88(0x14e)]/(0x3e8*0x3c),'expiryDays':this['EXPIRY_DAYS'],'activeIndividualTimers':this[_0x4cbf88(0x117)][_0x4cbf88(0x129)],'nextGlobalCheckIn':_0xa4ea8b,'paymentTimersDetails':_0x453816};}['getPaymentTimerInfo'](_0x98f36c){const _0x58db9a=a38_0x422eab,_0x36283a=this[_0x58db9a(0x117)][_0x58db9a(0xd4)](_0x98f36c);if(_0x36283a)return{'hasTimers':!![],'timersCount':_0x36283a[_0x58db9a(0x177)][_0x58db9a(0x18e)],'createdAt':_0x36283a[_0x58db9a(0x14a)],'gatewayPaymentId':_0x36283a[_0x58db9a(0x13e)]};return{'hasTimers':![]};}async['getGatewayCommission'](_0x254438,_0x110b7b){const _0x31641a=a38_0x422eab;try{const _0x420f98=await database_1['default'][_0x31641a(0x184)]['findUnique']({'where':{'id':_0x254438},'select':{'gatewaySettings':!![]}});if(!_0x420f98?.['gatewaySettings'])return console[_0x31641a(0x17c)]('No\x20gateway\x20settings\x20found\x20for\x20shop\x20'+_0x254438+_0x31641a(0x19b)),0xa;const _0x782f60=JSON['parse'](_0x420f98[_0x31641a(0x19e)]);for(const [_0x352aac,_0x2d0d13]of Object[_0x31641a(0xfd)](_0x782f60)){if(_0x352aac[_0x31641a(0x17b)]()===_0x110b7b[_0x31641a(0x17b)]()){const _0x259b24=_0x2d0d13[_0x31641a(0x14c)]||0xa;return console['log'](_0x31641a(0xe7)+_0x110b7b+'\x20commission\x20for\x20shop\x20'+_0x254438+':\x20'+_0x259b24+'%'),_0x259b24;}}return console[_0x31641a(0x17c)]('No\x20specific\x20commission\x20found\x20for\x20gateway\x20'+_0x110b7b+'\x20in\x20shop\x20'+_0x254438+_0x31641a(0x16c)),0xa;}catch(_0x3c7cb9){return console['error'](_0x31641a(0xf3)+_0x254438+_0x31641a(0x1bb)+_0x110b7b+':',_0x3c7cb9),0xa;}}}exports[a38_0x422eab(0xee)]=CoinToPayStatusService,exports[a38_0x422eab(0x112)]=new CoinToPayStatusService();