'use strict';const a37_0x47ad7d=a37_0x2530;(function(_0x2d7d33,_0x33d0ea){const _0x7a858f=a37_0x2530,_0x37d74a=_0x2d7d33();while(!![]){try{const _0x5b215f=-parseInt(_0x7a858f(0x128))/0x1+-parseInt(_0x7a858f(0x15a))/0x2*(parseInt(_0x7a858f(0x11e))/0x3)+-parseInt(_0x7a858f(0x16a))/0x4+parseInt(_0x7a858f(0x191))/0x5+-parseInt(_0x7a858f(0xfa))/0x6*(-parseInt(_0x7a858f(0x18f))/0x7)+-parseInt(_0x7a858f(0x104))/0x8*(-parseInt(_0x7a858f(0xea))/0x9)+parseInt(_0x7a858f(0x14d))/0xa*(parseInt(_0x7a858f(0xed))/0xb);if(_0x5b215f===_0x33d0ea)break;else _0x37d74a['push'](_0x37d74a['shift']());}catch(_0x1386de){_0x37d74a['push'](_0x37d74a['shift']());}}}(a37_0x5ebf,0xe167c));var __importDefault=this&&this[a37_0x47ad7d(0x176)]||function(_0x1c4cb2){const _0x58288e=a37_0x47ad7d;return _0x1c4cb2&&_0x1c4cb2[_0x58288e(0xcd)]?_0x1c4cb2:{'default':_0x1c4cb2};};function a37_0x2530(_0x39b337,_0x3d81f7){const _0x5ebffb=a37_0x5ebf();return a37_0x2530=function(_0x25304d,_0x411ac0){_0x25304d=_0x25304d-0xc0;let _0xf9697=_0x5ebffb[_0x25304d];return _0xf9697;},a37_0x2530(_0x39b337,_0x3d81f7);}function a37_0x5ebf(){const _0x53b380=['\x20days\x20(created\x20before\x20','toISOString',',\x20status=','status','coinToPayService','\x20status:\x20',',\x20currentPayments=','payment.success','telegramBotService','\x20timers\x20for\x20payment\x20','3912OfUEum','values','message','🏦\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes','\x20status\x20from\x20','🔍\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','\x20has\x20no\x20gatewayPaymentId','findUnique','❌\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','unknown','2589976uPheow','status_check','✅\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','\x20not\x20found\x20in\x20database','🔍\x20[CHECK]\x20Checking\x20','Shop\x20webhook\x20sent\x20to\x20','\x20to\x20clear','./loggerService','\x20to\x20','❌\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','transactionId','currentPayments','remitterIban','log','Payment\x20older\x20than\x20','paymentTimers','✅\x20[CHECK]\x20Payment\x20','⏰\x20[EXPIRY]\x20Payment\x20','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','error','coinToPayStatusService','✅\x20[DEBUG]\x20Successfully\x20scheduled\x20','logCoinToPayStatus','\x20is\x20older\x20than\x20','\x20\x20\x20-\x20gatewayPaymentId:\x20','checkSinglePaymentById','3NLUqbF','\x20\x20\x20❌\x20Error:\x20','TesSoft\x20Payment\x20System/1.0','gatewayOrderId','2\x20minutes','forEach','\x20status\x20is\x20','webhook_send','\x20(age:\x20','payment.pending','643114aXXjHG','\x20has\x20no\x20gatewayPaymentId,\x20skipping','COMPLETED','❌\x20[CHECK]\x20Payment\x20','failed','\x20\x20\x20-\x20GatewayPaymentId:\x20','create','❌\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','../types/gateway','adminNotes','auto_expire','5\x20minutes','h),\x20skipping\x20global\x20check','createdAt','default','get','Failed\x20to\x20send\x20shop\x20webhook:','gatewayPaymentId','\x20\x20\x20-\x20Gateway:\x20','\x20days\x20without\x20payment\x20confirmation','\x20\x20\x20📍\x20Source:\x20','⏰\x20[DEBUG]\x20Scheduled\x20check\x20#','\x20expired\x20CoinToPay\x20payments','\x20updated\x20successfully','\x20for\x20payment\x20','❌\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','shopId','stack','payment','\x20current\x20status:\x20','✅\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','paymentLink','paymentId','Automatically\x20expired\x20after\x20','webhookLog','\x20details:','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','10FLuuxx','startPeriodicStatusCheck','🪙\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','timers','\x20is\x20valid\x20for\x20checking,\x20proceeding...','text','logCoinToPayError','Bank\x20Details:\x20','now','\x20triggered\x20for\x20payment\x20','\x20pending\x20CoinToPay\x20payments','bankDetails','PAID','2094580HSQbDr','\x20initial\x20timers\x20for\x20payment\x20','📊\x20[CHECK]\x20Payment\x20','coinToPay2Service','checkPaymentStatus','CoinToPay2Service','POST','COINTOPAY_ERROR','❌\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','❌\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','has','EXPIRED','❌\x20[TIMER]\x20Failed\x20individual\x20check\x20#','🛑\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','🪙\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','\x20not\x20enabled\x20for\x20shop\x20','691624QOvbaA','CoinToPayStatusService','payment.failed','⏰\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','GLOBAL_CHECK_INTERVAL_MS','.\x20Remaining\x20active\x20timers:\x20','floor','schedule_created','not\x20confirmed','./telegramBotService','set','toLowerCase','__importDefault','🪙\x20[ERROR]\x20CoinToPay\x20Error:\x20','delay','✅\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','includes','⏰\x20[GLOBAL]\x20Payment\x20','cointopay','✅\x20[TIMER]\x20Individual\x20check\x20#','\x20\x20\x20-\x20Status:\x20','⚠️\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','cointopay2','setDate','amount','FAILED','checkAllPendingPayments','✅\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','paymentDetails','sendShopWebhook','description','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','stringify','size','./gateways/coinToPayService',',\x20stopping\x20individual\x20checks','checkExpiredPayments','12460RFKzpQ','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','644335IpzVJM','🔍\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','webhookEvents','webhookUrl','⏰\x20[HOURLY]\x20Payment\x20','findMany','Webhook\x20event\x20','clearPaymentTimers','PENDING','📈\x20[COINTOPAY]\x20Payment\x20','checkSinglePayment','✅\x20[HOURLY]\x20Payment\x20','customerEmail','gateway','🪙\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','-day\x20timeout','type','✅\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','iban','ms)','push','\x20payment\x20','created','not\x20found','getDate','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','✅\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','update','🆔\x20[CHECK]\x20Transaction\x20ID:\x20','🪙\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','getTime','\x20checked,\x20','/status/','COINTOPAY_STATUS_CHANGE','settings','globalCheckInterval','currency','Failed\x20to\x20mark\x20payment\x20as\x20expired','🪙\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','\x20days',',\x20clearing\x20individual\x20timers','\x20\x20\x20📅\x20Time:\x20','🧹\x20[DEBUG]\x20Cleared\x20timer\x20#','__esModule','🏦\x20[CHECK]\x20Saved\x20IBAN:\x20','✅\x20[EXPIRY]\x20Payment\x20','\x20individual\x20payment\x20timers','confirmedOn','\x20\x20\x20📝\x20Details:','⚠️\x20[CHECK]\x20Payment\x20','timestamp','💰\x20[CHECK]\x20Payment\x20','\x20days,\x20marking\x20as\x20EXPIRED','\x20\x20\x20-\x20paymentId:\x20','\x20in\x20','📊\x20[HOURLY]\x20Payment\x20','🪙\x20[GLOBAL]\x20Found\x20','\x20(after\x20','\x20seconds\x20(','SINGLE','paidAt','length','\x20\x20\x20📝\x20Context:','logShopWebhookError','from','../config/database','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','\x20marked\x20as\x20paid\x20at:\x20','Unknown\x20error','🛑\x20[SHUTDOWN]\x20Cleared\x20','loggerService',':\x20type=','18RnONGN','EXPIRY_DAYS','cointopay_status_check_error','9346139VdduWi','toFixed','🔄\x20[CHECK]\x20Updating\x20payment\x20'];a37_0x5ebf=function(){return _0x53b380;};return a37_0x5ebf();}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a37_0x47ad7d(0x118)]=exports['CoinToPayStatusService']=void 0x0;const coinToPayService_1=require(a37_0x47ad7d(0x18c)),coinToPay2Service_1=require('./gateways/coinToPay2Service'),gateway_1=require(a37_0x47ad7d(0x130)),database_1=__importDefault(require(a37_0x47ad7d(0xe3))),telegramBotService_1=require(a37_0x47ad7d(0x173)),loggerService_1=require(a37_0x47ad7d(0x10b));class CoinToPayStatusService{constructor(){const _0xd6815e=a37_0x47ad7d;this[_0xd6815e(0xc5)]=null,this['GLOBAL_CHECK_INTERVAL_MS']=0x3c*0x3c*0x3e8,this['EXPIRY_DAYS']=0x5,this[_0xd6815e(0x113)]=new Map(),this[_0xd6815e(0xf4)]=new coinToPayService_1['CoinToPayService'](),this[_0xd6815e(0x15d)]=new coinToPay2Service_1[(_0xd6815e(0x15f))](),console[_0xd6815e(0x111)](_0xd6815e(0x1ae));}['schedulePaymentChecks'](_0xc2077d,_0x14d4d5){const _0xb1e818=a37_0x47ad7d;console['log'](_0xb1e818(0x19f)),console[_0xb1e818(0x111)](_0xb1e818(0xd7)+_0xc2077d),console[_0xb1e818(0x111)](_0xb1e818(0x11c)+_0x14d4d5),this[_0xb1e818(0x198)](_0xc2077d);const _0x592a53=[],_0x3b0ffc=new Date(),_0x3a450b=[{'delay':0x1*0x3c*0x3e8,'description':'1\x20minute'},{'delay':0x2*0x3c*0x3e8,'description':_0xb1e818(0x122)},{'delay':0x5*0x3c*0x3e8,'description':_0xb1e818(0x133)},{'delay':0x5*0x3c*0x3e8,'description':_0xb1e818(0x133)}];console[_0xb1e818(0x111)]('🪙\x20[DEBUG]\x20Creating\x20'+_0x3a450b[_0xb1e818(0xdf)]+_0xb1e818(0x15b)+_0xc2077d);let _0x4713a1=0x0;_0x3a450b[_0xb1e818(0x123)]((_0x54e087,_0x605821)=>{const _0x1f7b1d=_0xb1e818;_0x4713a1+=_0x54e087['delay'];const _0x1afd0e=setTimeout(async()=>{const _0x92a6a3=a37_0x2530;console[_0x92a6a3(0x111)]('🪙\x20[TIMER]\x20Individual\x20check\x20#'+(_0x605821+0x1)+_0x92a6a3(0x156)+_0xc2077d+_0x92a6a3(0xdb)+_0x54e087[_0x92a6a3(0x188)]+')');try{await this[_0x92a6a3(0x11d)](_0xc2077d),console[_0x92a6a3(0x111)](_0x92a6a3(0x17d)+(_0x605821+0x1)+'\x20completed\x20for\x20payment\x20'+_0xc2077d);}catch(_0x5111c7){console[_0x92a6a3(0x117)](_0x92a6a3(0x166)+(_0x605821+0x1)+_0x92a6a3(0x140)+_0xc2077d+':',_0x5111c7),this['logCoinToPayError'](_0xc2077d,_0x14d4d5,_0x5111c7,_0x92a6a3(0x105),{'checkNumber':_0x605821+0x1,'scheduledAfter':_0x54e087[_0x92a6a3(0x188)],'isIndividualCheck':!![]});}},_0x4713a1);_0x592a53[_0x1f7b1d(0x1a5)](_0x1afd0e),console['log'](_0x1f7b1d(0x13d)+(_0x605821+0x1)+_0x1f7b1d(0x140)+_0xc2077d+_0x1f7b1d(0xd8)+_0x4713a1/0x3e8+_0x1f7b1d(0xdc)+_0x54e087['description']+')');});const _0x2ce7fb=setInterval(async()=>{const _0x49b556=_0xb1e818;console[_0x49b556(0x111)](_0x49b556(0x168)+_0xc2077d);try{const _0x1ce12a=await database_1[_0x49b556(0x136)][_0x49b556(0x144)][_0x49b556(0x101)]({'where':{'id':_0xc2077d},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x1ce12a){console['log']('❌\x20[HOURLY]\x20Payment\x20'+_0xc2077d+'\x20not\x20found,\x20clearing\x20timers'),this['clearPaymentTimers'](_0xc2077d);return;}console[_0x49b556(0x111)](_0x49b556(0xd9)+_0xc2077d+_0x49b556(0x145)+_0x1ce12a[_0x49b556(0xf3)]);if(_0x1ce12a[_0x49b556(0xf3)]!=='PENDING'){console[_0x49b556(0x111)](_0x49b556(0x19c)+_0xc2077d+_0x49b556(0x124)+_0x1ce12a[_0x49b556(0xf3)]+_0x49b556(0x18d)),this['clearPaymentTimers'](_0xc2077d);return;}const _0x41189e=Math['floor']((Date[_0x49b556(0x155)]()-_0x1ce12a[_0x49b556(0x135)][_0x49b556(0xc0)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x41189e>=this[_0x49b556(0xeb)]){console[_0x49b556(0x111)](_0x49b556(0x195)+_0xc2077d+_0x49b556(0x11b)+this[_0x49b556(0xeb)]+_0x49b556(0x1aa)),this[_0x49b556(0x198)](_0xc2077d);return;}await this[_0x49b556(0x11d)](_0xc2077d),console[_0x49b556(0x111)](_0x49b556(0x106)+_0xc2077d);}catch(_0x5adb15){console[_0x49b556(0x117)]('❌\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20'+_0xc2077d+':',_0x5adb15),this[_0x49b556(0x153)](_0xc2077d,_0x14d4d5,_0x5adb15,_0x49b556(0x105),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x592a53[_0xb1e818(0x1a5)](_0x2ce7fb),this[_0xb1e818(0x113)][_0xb1e818(0x174)](_0xc2077d,{'timers':_0x592a53,'paymentId':_0xc2077d,'gatewayPaymentId':_0x14d4d5,'createdAt':_0x3b0ffc}),console[_0xb1e818(0x111)](_0xb1e818(0x119)+_0x3a450b[_0xb1e818(0xdf)]+'\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20'+_0xc2077d),console[_0xb1e818(0x111)]('📊\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20'+this[_0xb1e818(0x113)][_0xb1e818(0x18b)]),this['logCoinToPayStatus'](_0xc2077d,_0x14d4d5,_0xb1e818(0x199),_0xb1e818(0x199),_0xb1e818(0x105),{'action':_0xb1e818(0x171),'scheduledChecks':_0x3a450b[_0xb1e818(0xdf)],'firstCheckIn':_0x3a450b[0x0][_0xb1e818(0x178)]/0x3e8,'totalTimers':this[_0xb1e818(0x113)][_0xb1e818(0x18b)]});}[a37_0x47ad7d(0x198)](_0x4fac8d){const _0x5a871c=a37_0x47ad7d,_0x32d1d7=this['paymentTimers'][_0x5a871c(0x137)](_0x4fac8d);_0x32d1d7?(console[_0x5a871c(0x111)]('🧹\x20[DEBUG]\x20Clearing\x20'+_0x32d1d7[_0x5a871c(0x150)][_0x5a871c(0xdf)]+_0x5a871c(0xf9)+_0x4fac8d),_0x32d1d7[_0x5a871c(0x150)][_0x5a871c(0x123)]((_0x4b8db0,_0x306718)=>{const _0x14d0c6=_0x5a871c;_0x4b8db0&&(clearTimeout(_0x4b8db0),clearInterval(_0x4b8db0),console[_0x14d0c6(0x111)](_0x14d0c6(0xcc)+(_0x306718+0x1)+_0x14d0c6(0x140)+_0x4fac8d));}),this['paymentTimers']['delete'](_0x4fac8d),console['log'](_0x5a871c(0x185)+_0x4fac8d+_0x5a871c(0x16f)+this[_0x5a871c(0x113)][_0x5a871c(0x18b)])):console[_0x5a871c(0x111)](_0x5a871c(0x17f)+_0x4fac8d+_0x5a871c(0x10a));}async[a37_0x47ad7d(0x11d)](_0x3ac848){const _0x2d4c1a=a37_0x47ad7d;console[_0x2d4c1a(0x111)]('🔍\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20'+_0x3ac848);const _0x42ce1e=await database_1[_0x2d4c1a(0x136)][_0x2d4c1a(0x144)][_0x2d4c1a(0x101)]({'where':{'id':_0x3ac848},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x42ce1e){console[_0x2d4c1a(0x111)](_0x2d4c1a(0x12b)+_0x3ac848+_0x2d4c1a(0x107));return;}console[_0x2d4c1a(0x111)]('📊\x20[CHECK]\x20Payment\x20'+_0x3ac848+'\x20found:'),console[_0x2d4c1a(0x111)](_0x2d4c1a(0x13a)+_0x42ce1e[_0x2d4c1a(0x19e)]),console[_0x2d4c1a(0x111)](_0x2d4c1a(0x17e)+_0x42ce1e[_0x2d4c1a(0xf3)]),console[_0x2d4c1a(0x111)](_0x2d4c1a(0x12d)+_0x42ce1e['gatewayPaymentId']),console[_0x2d4c1a(0x111)]('\x20\x20\x20-\x20Amount:\x20'+_0x42ce1e[_0x2d4c1a(0x182)]+'\x20'+_0x42ce1e[_0x2d4c1a(0xc6)]),console[_0x2d4c1a(0x111)]('\x20\x20\x20-\x20ShopId:\x20'+_0x42ce1e[_0x2d4c1a(0x142)]);if(_0x42ce1e[_0x2d4c1a(0x19e)]!==_0x2d4c1a(0x17c)&&_0x42ce1e[_0x2d4c1a(0x19e)]!==_0x2d4c1a(0x180)){console[_0x2d4c1a(0x111)](_0x2d4c1a(0xd3)+_0x3ac848+'\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20'+_0x42ce1e['gateway']+')');return;}if(_0x42ce1e['status']!==_0x2d4c1a(0x199)){console[_0x2d4c1a(0x111)](_0x2d4c1a(0xd3)+_0x3ac848+'\x20status\x20is\x20'+_0x42ce1e[_0x2d4c1a(0xf3)]+_0x2d4c1a(0x18d)),this[_0x2d4c1a(0x198)](_0x3ac848);return;}if(!_0x42ce1e['gatewayPaymentId']){console[_0x2d4c1a(0x111)]('⚠️\x20[CHECK]\x20Payment\x20'+_0x3ac848+_0x2d4c1a(0x100));return;}console[_0x2d4c1a(0x111)](_0x2d4c1a(0x114)+_0x3ac848+_0x2d4c1a(0x151)),await this['checkSinglePayment'](_0x42ce1e);}['logCoinToPayStatus'](_0xa7d844,_0x4f42dc,_0x398579,_0x5ca798,_0x694a0d,_0x1c42b6){const _0x5597a6=a37_0x47ad7d,_0x3cebfa={'type':_0x5597a6(0xc3),'paymentId':_0xa7d844,'gatewayPaymentId':_0x4f42dc,'oldStatus':_0x398579,'newStatus':_0x5ca798,'source':_0x694a0d,'timestamp':new Date()['toISOString'](),'details':_0x1c42b6||{}};loggerService_1['loggerService'][_0x5597a6(0x11a)](_0x3cebfa),console['log'](_0x5597a6(0x14f)+_0xa7d844+'\x20('+_0x4f42dc+')'),console[_0x5597a6(0x111)]('\x20\x20\x20📊\x20Status:\x20'+_0x398579+'\x20->\x20'+_0x5ca798),console['log'](_0x5597a6(0x13c)+_0x694a0d),console[_0x5597a6(0x111)](_0x5597a6(0xcb)+_0x3cebfa[_0x5597a6(0xd4)]),_0x1c42b6&&console['log'](_0x5597a6(0xd2),_0x1c42b6);}[a37_0x47ad7d(0x153)](_0x12e0d3,_0x516576,_0x5ec721,_0xe4e9a1,_0x1e4f8c){const _0x4ec580=a37_0x47ad7d,_0x5eacf3={'type':_0x4ec580(0x161),'paymentId':_0x12e0d3,'gatewayPaymentId':_0x516576,'error':_0x5ec721 instanceof Error?{'message':_0x5ec721[_0x4ec580(0xfc)],'stack':_0x5ec721[_0x4ec580(0x143)]}:_0x5ec721,'source':_0xe4e9a1,'timestamp':new Date()[_0x4ec580(0xf1)](),'context':_0x1e4f8c||{}};loggerService_1[_0x4ec580(0xe8)][_0x4ec580(0x153)](_0x5eacf3),console[_0x4ec580(0x117)](_0x4ec580(0x177)+_0x12e0d3+'\x20('+_0x516576+')'),console[_0x4ec580(0x117)](_0x4ec580(0x11f)+(_0x5ec721 instanceof Error?_0x5ec721[_0x4ec580(0xfc)]:_0x5ec721)),console['error'](_0x4ec580(0x13c)+_0xe4e9a1),console['error'](_0x4ec580(0xcb)+_0x5eacf3[_0x4ec580(0xd4)]),_0x1e4f8c&&console['error'](_0x4ec580(0xe0),_0x1e4f8c);}[a37_0x47ad7d(0x14e)](){const _0x396f28=a37_0x47ad7d;console['log']('🪙\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)'),this[_0x396f28(0x184)]()['catch'](_0x88021b=>{const _0x2cdb70=_0x396f28;console[_0x2cdb70(0x117)](_0x2cdb70(0x10d),_0x88021b);}),this['globalCheckInterval']=setInterval(async()=>{const _0xf3fc7=_0x396f28;try{console[_0xf3fc7(0x111)](_0xf3fc7(0xc8)),await this[_0xf3fc7(0x184)](),console[_0xf3fc7(0x111)](_0xf3fc7(0x1a2));}catch(_0x5f2741){console[_0xf3fc7(0x117)](_0xf3fc7(0x163),_0x5f2741);}},this[_0x396f28(0x16e)]),console['log'](_0x396f28(0x179));}['stopPeriodicStatusCheck'](){const _0x3c374a=a37_0x47ad7d;console[_0x3c374a(0x111)]('🛑\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...');this[_0x3c374a(0xc5)]&&(clearInterval(this[_0x3c374a(0xc5)]),this[_0x3c374a(0xc5)]=null,console[_0x3c374a(0x111)](_0x3c374a(0x167)));const _0x4d3c82=this[_0x3c374a(0x113)][_0x3c374a(0x18b)];for(const [_0x378c9b]of this[_0x3c374a(0x113)]){this['clearPaymentTimers'](_0x378c9b);}console[_0x3c374a(0x111)](_0x3c374a(0xe7)+_0x4d3c82+_0x3c374a(0xd0));}async[a37_0x47ad7d(0x184)](){const _0x52c049=a37_0x47ad7d;try{console['log']('🪙\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...');const _0x55828d=await database_1[_0x52c049(0x136)][_0x52c049(0x144)][_0x52c049(0x196)]({'where':{'gateway':{'in':[_0x52c049(0x17c),_0x52c049(0x180)]},'status':'PENDING','gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x52c049(0x111)](_0x52c049(0xda)+_0x55828d[_0x52c049(0xdf)]+_0x52c049(0x157));if(_0x55828d[_0x52c049(0xdf)]===0x0){console[_0x52c049(0x111)]('🪙\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check');return;}const _0x295efc=await this[_0x52c049(0x18e)](_0x55828d);console[_0x52c049(0x111)]('⏰\x20[GLOBAL]\x20Found\x20'+_0x295efc['length']+_0x52c049(0x13e));let _0x2b69c8=0x0,_0x478b03=0x0;for(const _0x57a03a of _0x55828d){try{if(_0x295efc[_0x52c049(0x17a)](_0x57a03a['id'])){console[_0x52c049(0x111)](_0x52c049(0x17b)+_0x57a03a['id']+_0x52c049(0xe4)),_0x478b03++;continue;}if(this[_0x52c049(0x113)][_0x52c049(0x164)](_0x57a03a['id'])){console[_0x52c049(0x111)]('⏰\x20[GLOBAL]\x20Payment\x20'+_0x57a03a['id']+'\x20has\x20individual\x20timers,\x20skipping\x20global\x20check'),_0x478b03++;continue;}const _0x22877a=(Date['now']()-_0x57a03a['createdAt'][_0x52c049(0xc0)]())/(0x3e8*0x3c*0x3c);if(_0x22877a<0x1){console[_0x52c049(0x111)](_0x52c049(0x17b)+_0x57a03a['id']+'\x20is\x20too\x20new\x20('+_0x22877a[_0x52c049(0xee)](0x1)+_0x52c049(0x134)),_0x478b03++;continue;}console[_0x52c049(0x111)](_0x52c049(0x192)+_0x57a03a['id']+_0x52c049(0x126)+_0x22877a[_0x52c049(0xee)](0x1)+'h)'),await this[_0x52c049(0x19b)](_0x57a03a),_0x2b69c8++,await new Promise(_0x42b4db=>setTimeout(_0x42b4db,0x7d0));}catch(_0x175542){console[_0x52c049(0x117)](_0x52c049(0x102)+_0x57a03a['id']+':',_0x175542),this[_0x52c049(0x153)](_0x57a03a['id'],_0x57a03a['gatewayPaymentId']||'unknown',_0x175542,_0x52c049(0x105),{'isGlobalCheck':!![],'paymentAmount':_0x57a03a[_0x52c049(0x182)],'paymentCurrency':_0x57a03a['currency'],'shopId':_0x57a03a[_0x52c049(0x142)],'createdAt':_0x57a03a['createdAt']}),loggerService_1[_0x52c049(0xe8)]['logWhiteDomainError']('cointopay',_0x52c049(0xc2)+_0x57a03a[_0x52c049(0x139)],_0x175542);}}console[_0x52c049(0x111)]('✅\x20[GLOBAL]\x20Global\x20check\x20completed:\x20'+_0x2b69c8+_0x52c049(0xc1)+_0x478b03+'\x20skipped,\x20'+_0x295efc[_0x52c049(0xdf)]+'\x20expired');}catch(_0x6dab15){console['error']('❌\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:',_0x6dab15);}}async['checkExpiredPayments'](_0x1531af){const _0x27ed64=a37_0x47ad7d,_0x4a7e37=[],_0xd9c4ac=new Date();_0xd9c4ac[_0x27ed64(0x181)](_0xd9c4ac[_0x27ed64(0x1a9)]()-this[_0x27ed64(0xeb)]),console[_0x27ed64(0x111)](_0x27ed64(0x16d)+this['EXPIRY_DAYS']+_0x27ed64(0xf0)+_0xd9c4ac[_0x27ed64(0xf1)]()+')');for(const _0x51df91 of _0x1531af){if(_0x51df91[_0x27ed64(0x135)]<_0xd9c4ac){console[_0x27ed64(0x111)](_0x27ed64(0x115)+_0x51df91['id']+_0x27ed64(0x11b)+this[_0x27ed64(0xeb)]+_0x27ed64(0xd6));try{this[_0x27ed64(0x11a)](_0x51df91['id'],_0x51df91['gatewayPaymentId']||_0x27ed64(0x103),_0x27ed64(0x199),_0x27ed64(0x165),'auto_expire',{'reason':_0x27ed64(0x112)+this[_0x27ed64(0xeb)]+_0x27ed64(0xc9),'createdAt':_0x51df91[_0x27ed64(0x135)],'daysSinceCreation':Math[_0x27ed64(0x170)]((Date['now']()-_0x51df91[_0x27ed64(0x135)][_0x27ed64(0xc0)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x51df91[_0x27ed64(0x182)],'paymentCurrency':_0x51df91[_0x27ed64(0xc6)],'shopId':_0x51df91['shopId']}),await database_1[_0x27ed64(0x136)]['payment'][_0x27ed64(0x1ac)]({'where':{'id':_0x51df91['id']},'data':{'status':'EXPIRED','updatedAt':new Date(),'adminNotes':_0x27ed64(0x149)+this[_0x27ed64(0xeb)]+_0x27ed64(0x13b)}}),await database_1['default'][_0x27ed64(0x14a)]['create']({'data':{'paymentId':_0x51df91['id'],'shopId':_0x51df91[_0x27ed64(0x142)],'event':'cointopay_auto_expired','statusCode':0xc8,'responseBody':JSON['stringify']({'reason':_0x27ed64(0x112)+this[_0x27ed64(0xeb)]+_0x27ed64(0xc9),'createdAt':_0x51df91[_0x27ed64(0x135)],'expiredAt':new Date()[_0x27ed64(0xf1)](),'daysSinceCreation':Math[_0x27ed64(0x170)]((Date['now']()-_0x51df91[_0x27ed64(0x135)][_0x27ed64(0xc0)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x27ed64(0x187)](_0x51df91,_0x27ed64(0x165)),await this['sendPaymentStatusNotification'](_0x51df91,_0x27ed64(0x165)),this[_0x27ed64(0x198)](_0x51df91['id']),_0x4a7e37[_0x27ed64(0x1a5)](_0x51df91['id']),console['log'](_0x27ed64(0xcf)+_0x51df91['id']+_0x27ed64(0x14c)+this['EXPIRY_DAYS']+_0x27ed64(0x1a0));}catch(_0x530cb4){console[_0x27ed64(0x117)](_0x27ed64(0x162)+_0x51df91['id']+':',_0x530cb4),this[_0x27ed64(0x153)](_0x51df91['id'],_0x51df91[_0x27ed64(0x139)]||_0x27ed64(0x103),_0x530cb4,_0x27ed64(0x132),{'reason':_0x27ed64(0xc7),'createdAt':_0x51df91['createdAt'],'daysSinceCreation':Math[_0x27ed64(0x170)]((Date[_0x27ed64(0x155)]()-_0x51df91[_0x27ed64(0x135)][_0x27ed64(0xc0)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x4a7e37;}async['checkSinglePayment'](_0x4362ef){const _0x4019ee=a37_0x47ad7d;if(!_0x4362ef[_0x4019ee(0x139)]){console[_0x4019ee(0x111)]('⚠️\x20[CHECK]\x20Payment\x20'+_0x4362ef['id']+_0x4019ee(0x129));return;}console['log'](_0x4019ee(0x108)+_0x4362ef['gateway']+'\x20payment\x20'+_0x4362ef['id']+'\x20('+_0x4362ef[_0x4019ee(0x139)]+')');try{let _0x108ef5;_0x4362ef[_0x4019ee(0x19e)]===_0x4019ee(0x180)?(_0x108ef5=await this[_0x4019ee(0x15d)][_0x4019ee(0x15e)](_0x4362ef['gatewayPaymentId']),console[_0x4019ee(0x111)]('📊\x20[CHECK]\x20CoinToPay2\x20payment\x20'+_0x4362ef['id']+_0x4019ee(0xf5)+_0x108ef5['status'])):(_0x108ef5=await this[_0x4019ee(0xf4)][_0x4019ee(0x15e)](_0x4362ef['gatewayPaymentId']),console[_0x4019ee(0x111)]('📊\x20[CHECK]\x20CoinToPay\x20payment\x20'+_0x4362ef['id']+_0x4019ee(0xf5)+_0x108ef5['status']));_0x108ef5[_0x4019ee(0x186)]&&console[_0x4019ee(0x111)](_0x4019ee(0x15c)+_0x4362ef['id']+_0x4019ee(0x14b),{'iban':_0x108ef5[_0x4019ee(0x186)][_0x4019ee(0x1a3)]||_0x4019ee(0x1a8),'transactionId':_0x108ef5['paymentDetails'][_0x4019ee(0x10e)],'createdOn':_0x108ef5[_0x4019ee(0x186)]['createdOn'],'confirmedOn':_0x108ef5[_0x4019ee(0x186)]['confirmedOn']||_0x4019ee(0x172)});if(_0x108ef5[_0x4019ee(0xf3)]!==_0x4362ef[_0x4019ee(0xf3)]){console[_0x4019ee(0x111)](_0x4019ee(0xef)+_0x4362ef['id']+_0x4019ee(0xfe)+_0x4362ef[_0x4019ee(0xf3)]+_0x4019ee(0x10c)+_0x108ef5[_0x4019ee(0xf3)]),this[_0x4019ee(0x11a)](_0x4362ef['id'],_0x4362ef[_0x4019ee(0x139)],_0x4362ef[_0x4019ee(0xf3)],_0x108ef5['status'],_0x4019ee(0x105),{'paymentDetails':_0x108ef5['paymentDetails'],'amount':_0x108ef5[_0x4019ee(0x182)],'currency':_0x108ef5[_0x4019ee(0xc6)],'shopId':_0x4362ef[_0x4019ee(0x142)],'checkTimestamp':new Date()[_0x4019ee(0xf1)]()});const _0x47c389={'status':_0x108ef5['status'],'updatedAt':new Date()};_0x108ef5[_0x4019ee(0xf3)]===_0x4019ee(0x159)&&_0x4362ef['status']!=='PAID'&&(_0x47c389[_0x4019ee(0xde)]=new Date(),console[_0x4019ee(0x111)](_0x4019ee(0xd5)+_0x4362ef['id']+_0x4019ee(0xe5)+_0x47c389[_0x4019ee(0xde)][_0x4019ee(0xf1)]()));if(_0x108ef5[_0x4019ee(0x186)]){const _0x3be913=_0x108ef5['paymentDetails'];_0x3be913[_0x4019ee(0x1a3)]&&(_0x47c389[_0x4019ee(0x110)]=_0x3be913['iban'],console['log'](_0x4019ee(0xce)+_0x3be913[_0x4019ee(0x1a3)]));if(_0x3be913[_0x4019ee(0x158)]){const _0xacbb0f=_0x4362ef[_0x4019ee(0x131)]||'',_0x306c59=_0x4019ee(0x154)+_0x3be913['bankDetails'];_0x47c389[_0x4019ee(0x131)]=_0xacbb0f?_0xacbb0f+'\x0a\x0a'+_0x306c59:_0x306c59,console[_0x4019ee(0x111)](_0x4019ee(0xfd));}_0x3be913[_0x4019ee(0x10e)]&&console[_0x4019ee(0x111)](_0x4019ee(0x1ad)+_0x3be913[_0x4019ee(0x10e)]),_0x3be913[_0x4019ee(0xd1)]&&console[_0x4019ee(0x111)](_0x4019ee(0x1ab)+_0x3be913[_0x4019ee(0xd1)]);}await database_1[_0x4019ee(0x136)][_0x4019ee(0x144)][_0x4019ee(0x1ac)]({'where':{'id':_0x4362ef['id']},'data':_0x47c389});if(_0x108ef5[_0x4019ee(0xf3)]==='PAID'&&_0x4362ef[_0x4019ee(0xf3)]!=='PAID'){console[_0x4019ee(0x111)](_0x4019ee(0x19a)+_0x4362ef['id']+_0x4019ee(0x190));const _0x26ac44=await database_1[_0x4019ee(0x136)][_0x4019ee(0x144)][_0x4019ee(0x101)]({'where':{'id':_0x4362ef['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x26ac44?.['paymentLinkId']&&_0x26ac44[_0x4019ee(0x147)])try{const _0xa44586=_0x26ac44[_0x4019ee(0x147)];console[_0x4019ee(0x111)]('📈\x20[COINTOPAY]\x20Found\x20payment\x20link\x20'+_0xa44586['id']+_0x4019ee(0xe9)+_0xa44586[_0x4019ee(0x1a1)]+_0x4019ee(0xf6)+_0xa44586[_0x4019ee(0x10f)]+_0x4019ee(0xf2)+_0xa44586[_0x4019ee(0xf3)]);const _0x31c9a0=_0xa44586[_0x4019ee(0x10f)]+0x1,_0x3ed4b1=_0xa44586['type']===_0x4019ee(0xdd)?_0x4019ee(0x12a):_0xa44586[_0x4019ee(0xf3)];await database_1[_0x4019ee(0x136)][_0x4019ee(0x147)][_0x4019ee(0x1ac)]({'where':{'id':_0xa44586['id']},'data':{'currentPayments':_0x31c9a0,'status':_0x3ed4b1,'updatedAt':new Date()}}),console[_0x4019ee(0x111)]('✅\x20[COINTOPAY]\x20Payment\x20link\x20'+_0xa44586['id']+'\x20updated:\x20currentPayments='+_0xa44586[_0x4019ee(0x10f)]+'\x20->\x20'+_0x31c9a0+_0x4019ee(0xf2)+_0xa44586[_0x4019ee(0xf3)]+'\x20->\x20'+_0x3ed4b1);}catch(_0x1a797f){console[_0x4019ee(0x117)](_0x4019ee(0x12f),_0x1a797f);}else console[_0x4019ee(0x111)]('📈\x20[COINTOPAY]\x20Payment\x20'+_0x4362ef['id']+'\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link');}await database_1[_0x4019ee(0x136)][_0x4019ee(0x14a)][_0x4019ee(0x12e)]({'data':{'paymentId':_0x4362ef['id'],'shopId':_0x4362ef[_0x4019ee(0x142)],'event':'cointopay_status_check_'+_0x108ef5['status'][_0x4019ee(0x175)](),'statusCode':0xc8,'responseBody':JSON['stringify']({'oldStatus':_0x4362ef[_0x4019ee(0xf3)],'newStatus':_0x108ef5[_0x4019ee(0xf3)],'paymentDetails':_0x108ef5['paymentDetails'],'checkedAt':new Date()[_0x4019ee(0xf1)]()})}}),await this[_0x4019ee(0x187)](_0x4362ef,_0x108ef5[_0x4019ee(0xf3)]),await this['sendPaymentStatusNotification'](_0x4362ef,_0x108ef5[_0x4019ee(0xf3)]),_0x108ef5['status']!==_0x4019ee(0x199)&&(console['log']('🧹\x20[CHECK]\x20Payment\x20'+_0x4362ef['id']+'\x20status\x20changed\x20to\x20'+_0x108ef5['status']+_0x4019ee(0xca)),this[_0x4019ee(0x198)](_0x4362ef['id'])),console['log'](_0x4019ee(0x114)+_0x4362ef['id']+_0x4019ee(0x13f));}else console[_0x4019ee(0x111)]('📊\x20[CHECK]\x20Payment\x20'+_0x4362ef['id']+'\x20status\x20unchanged\x20('+_0x108ef5[_0x4019ee(0xf3)]+')'),this[_0x4019ee(0x11a)](_0x4362ef['id'],_0x4362ef[_0x4019ee(0x139)],_0x4362ef[_0x4019ee(0xf3)],_0x108ef5[_0x4019ee(0xf3)],'status_check',{'statusUnchanged':!![],'paymentDetails':_0x108ef5[_0x4019ee(0x186)],'amount':_0x108ef5['amount'],'currency':_0x108ef5['currency'],'shopId':_0x4362ef[_0x4019ee(0x142)],'checkTimestamp':new Date()[_0x4019ee(0xf1)]()});}catch(_0x5946ae){console['error'](_0x4019ee(0x141)+_0x4362ef['id']+':',_0x5946ae),this[_0x4019ee(0x153)](_0x4362ef['id'],_0x4362ef['gatewayPaymentId'],_0x5946ae,_0x4019ee(0x105),{'paymentAmount':_0x4362ef[_0x4019ee(0x182)],'paymentCurrency':_0x4362ef['currency'],'shopId':_0x4362ef[_0x4019ee(0x142)],'createdAt':_0x4362ef[_0x4019ee(0x135)]}),await database_1[_0x4019ee(0x136)][_0x4019ee(0x14a)][_0x4019ee(0x12e)]({'data':{'paymentId':_0x4362ef['id'],'shopId':_0x4362ef[_0x4019ee(0x142)],'event':_0x4019ee(0xec),'statusCode':0x1f4,'responseBody':JSON[_0x4019ee(0x18a)]({'error':_0x5946ae instanceof Error?_0x5946ae[_0x4019ee(0xfc)]:_0x4019ee(0xe6),'gatewayPaymentId':_0x4362ef['gatewayPaymentId'],'checkedAt':new Date()['toISOString']()})}});}}async[a37_0x47ad7d(0x187)](_0x2ea368,_0x55b484){const _0x24edae=a37_0x47ad7d,_0x1df355=Date[_0x24edae(0x155)]();try{const _0x3d9582=_0x2ea368['shop'],_0x1a1aca=_0x3d9582[_0x24edae(0xc4)];if(!_0x1a1aca?.[_0x24edae(0x194)]){console[_0x24edae(0x111)](_0x24edae(0x116)+_0x3d9582['id']);return;}const _0x1f6960=_0x55b484===_0x24edae(0x159)?_0x24edae(0xf7):_0x55b484===_0x24edae(0x183)?_0x24edae(0x16c):_0x55b484==='EXPIRED'?_0x24edae(0x16c):_0x24edae(0x127);if(!_0x1a1aca[_0x24edae(0x193)]?.[_0x24edae(0x17a)](_0x1f6960)){console[_0x24edae(0x111)](_0x24edae(0x197)+_0x1f6960+_0x24edae(0x169)+_0x3d9582['id']);return;}const _0xeb5a98=(0x0,gateway_1['getGatewayIdByName'])(_0x2ea368[_0x24edae(0x19e)])||_0x2ea368[_0x24edae(0x19e)],_0x33c188={'event':_0x1f6960,'payment':{'id':_0x2ea368['id'],'order_id':_0x2ea368['orderId'],'gateway_order_id':_0x2ea368[_0x24edae(0x121)],'gateway':_0xeb5a98,'amount':_0x2ea368['amount'],'currency':_0x2ea368[_0x24edae(0xc6)],'status':_0x55b484[_0x24edae(0x175)](),'customer_email':_0x2ea368[_0x24edae(0x19d)],'customer_name':_0x2ea368['customerName'],'created_at':_0x2ea368[_0x24edae(0x135)],'updated_at':new Date()}},_0x18be6a=await fetch(_0x1a1aca['webhookUrl'],{'method':_0x24edae(0x160),'headers':{'Content-Type':'application/json','User-Agent':_0x24edae(0x120)},'body':JSON[_0x24edae(0x18a)](_0x33c188)}),_0x4eccef=Date[_0x24edae(0x155)]()-_0x1df355,_0x1fb5e0=_0x18be6a['ok']?'Success':await _0x18be6a[_0x24edae(0x152)]();loggerService_1[_0x24edae(0xe8)]['logShopWebhookSent'](_0x2ea368['shopId'],_0x1a1aca[_0x24edae(0x194)],_0x1f6960,_0x18be6a[_0x24edae(0xf3)],_0x4eccef,_0x33c188),console[_0x24edae(0x111)](_0x24edae(0x109)+_0x1a1aca['webhookUrl']+'\x20with\x20status\x20'+_0x18be6a[_0x24edae(0xf3)]+'\x20('+_0x4eccef+_0x24edae(0x1a4));}catch(_0x52da32){console[_0x24edae(0x117)](_0x24edae(0x138),_0x52da32),loggerService_1[_0x24edae(0xe8)][_0x24edae(0xe1)](_0x2ea368[_0x24edae(0x142)],_0x2ea368['shop']?.[_0x24edae(0xc4)]?.[_0x24edae(0x194)]||_0x24edae(0x103),_0x24edae(0x125),_0x52da32,{});}}async['sendPaymentStatusNotification'](_0x6c2ae,_0x472360){const _0x5d192=a37_0x47ad7d;try{const _0x5940cb={'PENDING':'created','PAID':'paid','FAILED':_0x5d192(0x12c),'EXPIRED':'expired'},_0xe1b925=_0x5940cb[_0x472360];if(!_0xe1b925||_0xe1b925===_0x5d192(0x1a7))return;await telegramBotService_1[_0x5d192(0xf8)]['sendPaymentNotification'](_0x6c2ae['shopId'],_0x6c2ae,_0xe1b925);}catch(_0x32626c){console[_0x5d192(0x117)]('Failed\x20to\x20send\x20Telegram\x20payment\x20notification:',_0x32626c);}}async['checkPaymentById'](_0x8bf30){const _0x263c30=a37_0x47ad7d;console[_0x263c30(0x111)](_0x263c30(0xff)+_0x8bf30);const _0x439683=await database_1['default'][_0x263c30(0x144)][_0x263c30(0x101)]({'where':{'id':_0x8bf30},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x439683)throw new Error('Payment\x20not\x20found');if(_0x439683['gateway']!=='cointopay'&&_0x439683[_0x263c30(0x19e)]!==_0x263c30(0x180))throw new Error(_0x263c30(0x189));console[_0x263c30(0x111)](_0x263c30(0x146)+_0x439683[_0x263c30(0x19e)]+_0x263c30(0x1a6)+_0x8bf30),await this[_0x263c30(0x19b)](_0x439683),console[_0x263c30(0x111)]('✅\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20'+_0x8bf30);}['getServiceStats'](){const _0x2016e4=a37_0x47ad7d,_0x34a7c2=this['globalCheckInterval']?this[_0x2016e4(0x16e)]:undefined,_0x356cfe=Array[_0x2016e4(0xe2)](this[_0x2016e4(0x113)][_0x2016e4(0xfb)]())['map'](_0xf8ca33=>({'paymentId':_0xf8ca33[_0x2016e4(0x148)],'gatewayPaymentId':_0xf8ca33['gatewayPaymentId'],'createdAt':_0xf8ca33[_0x2016e4(0x135)],'timersCount':_0xf8ca33[_0x2016e4(0x150)][_0x2016e4(0xdf)]}));return{'isActive':!!this[_0x2016e4(0xc5)],'globalCheckIntervalMinutes':this[_0x2016e4(0x16e)]/(0x3e8*0x3c),'expiryDays':this['EXPIRY_DAYS'],'activeIndividualTimers':this['paymentTimers']['size'],'nextGlobalCheckIn':_0x34a7c2,'paymentTimersDetails':_0x356cfe};}['getPaymentTimerInfo'](_0x21e55a){const _0x1f27a6=a37_0x47ad7d,_0x10785a=this[_0x1f27a6(0x113)][_0x1f27a6(0x137)](_0x21e55a);if(_0x10785a)return{'hasTimers':!![],'timersCount':_0x10785a[_0x1f27a6(0x150)][_0x1f27a6(0xdf)],'createdAt':_0x10785a[_0x1f27a6(0x135)],'gatewayPaymentId':_0x10785a[_0x1f27a6(0x139)]};return{'hasTimers':![]};}}exports[a37_0x47ad7d(0x16b)]=CoinToPayStatusService,exports[a37_0x47ad7d(0x118)]=new CoinToPayStatusService();