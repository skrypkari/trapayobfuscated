'use strict';const a50_0x93843a=a50_0x6b7c;(function(_0x801b1,_0x53fe35){const _0xa42b6e=a50_0x6b7c,_0x25cfdb=_0x801b1();while(!![]){try{const _0x4feb9c=-parseInt(_0xa42b6e(0x15b))/0x1*(parseInt(_0xa42b6e(0x17c))/0x2)+parseInt(_0xa42b6e(0x166))/0x3*(parseInt(_0xa42b6e(0x1a4))/0x4)+parseInt(_0xa42b6e(0x19b))/0x5+-parseInt(_0xa42b6e(0x1b1))/0x6+parseInt(_0xa42b6e(0x1aa))/0x7+parseInt(_0xa42b6e(0x205))/0x8+-parseInt(_0xa42b6e(0x1f3))/0x9;if(_0x4feb9c===_0x53fe35)break;else _0x25cfdb['push'](_0x25cfdb['shift']());}catch(_0x375d41){_0x25cfdb['push'](_0x25cfdb['shift']());}}}(a50_0x5238,0xef4da));function a50_0x6b7c(_0x5d1af6,_0x43d5c6){_0x5d1af6=_0x5d1af6-0x13e;const _0x52385a=a50_0x5238();let _0x6b7cbe=_0x52385a[_0x5d1af6];return _0x6b7cbe;}var __importDefault=this&&this[a50_0x93843a(0x21e)]||function(_0x5dec4e){return _0x5dec4e&&_0x5dec4e['__esModule']?_0x5dec4e:{'default':_0x5dec4e};};Object[a50_0x93843a(0x1d4)](exports,a50_0x93843a(0x22b),{'value':!![]}),exports[a50_0x93843a(0x176)]=exports['CoinToPayStatusService']=void 0x0;function a50_0x5238(){const _0x474b3f=['message','‚ùå\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','\x20\x20\x20-\x20paymentId:\x20','update','shopId','‚ùå\x20[HOURLY]\x20Payment\x20','checkPaymentStatus','./loggerService','9222120WBRrLt','\x20in\x20shop\x20','not\x20found','1\x20minute','confirmedOn','status','delay','üìä\x20[CHECK]\x20CoinToPay\x20payment\x20',',\x20status=','‚úÖ\x20[CHECK]\x20Payment\x20','\x20\x20\x20-\x20Status:\x20','clearPaymentTimers','üÜî\x20[CHECK]\x20Transaction\x20ID:\x20','/status/','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','\x20\x20\x20üìù\x20Context:','paid','\x20days','8900304ycLFBc','push','cointopay2','paymentDetails','ü™ô\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','üõë\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','from','üîç\x20[CHECK]\x20Checking\x20','\x20updated:\x20currentPayments=','now','\x20details:','createdOn','Success','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','‚è∞\x20[EXPIRY]\x20Payment\x20','ü™ô\x20[TIMER]\x20Individual\x20check\x20#','\x20status\x20is\x20','Shop\x20webhook\x20sent\x20to\x20','üõë\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','globalCheckInterval','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','üìä\x20[CHECK]\x20Payment\x20','commission','ü™ô\x20[ERROR]\x20CoinToPay\x20Error:\x20','PAID','__importDefault','cointopay_status_check_error','delete','ü™ô\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','Gateway\x20','ms)',',\x20stopping\x20individual\x20checks','status_check','PENDING','‚úÖ\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','checkSinglePayment','getDate','auto_expire','__esModule','amountUSDT','‚úÖ\x20[DEBUG]\x20Successfully\x20scheduled\x20','\x20(after\x20','5\x20minutes','getTime','checkPaymentById','findMany','\x20for\x20payment\x20','\x20has\x20no\x20gatewayPaymentId','\x20\x20\x20‚ùå\x20Error:\x20','COMPLETED','‚úÖ\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','üßπ\x20[DEBUG]\x20Cleared\x20timer\x20#','\x20is\x20valid\x20for\x20checking,\x20proceeding...','\x20current\x20status:\x20','ü™ô\x20[DEBUG]\x20Creating\x20','\x20commission\x20for\x20shop\x20','customerEmail','ü™ô\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','‚ö†Ô∏è\x20[CHECK]\x20Payment\x20','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','\x20\x20\x20Amount\x20after\x20commission:\x20','length','CoinToPayStatusService','paidAt','‚ùå\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','sendPaymentStatusNotification','EXPIRY_DAYS','checkAllPendingPayments','\x20timers\x20for\x20payment\x20','EXPIRED','startPeriodicStatusCheck','shop','sendShopWebhook','convertToUSDT','paymentLinkId','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','paymentId','entries','üí∞\x20[CHECK]\x20Payment\x20','log','currency','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','webhookUrl','currentPayments','logCoinToPayError','set','\x20(age:\x20','\x20not\x20found\x20in\x20database','ü™ô\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','\x20not\x20found,\x20clearing\x20timers','\x20\x20\x20-\x20GatewayPaymentId:\x20','values','ü™ô\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2',',\x20using\x20default\x2010%','‚ùå\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','\x20in\x20','SINGLE','./currencyService','h),\x20skipping\x20global\x20check','\x20has\x20no\x20gatewayPaymentId,\x20skipping','üßπ\x20[DEBUG]\x20Clearing\x20','\x20expired\x20CoinToPay\x20payments','2AHsKtl','\x20updated\x20successfully','getGatewayCommission','\x20status:\x20',',\x20gateway\x20','‚úÖ\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','has','\x20\x20\x20üìù\x20Details:','currencyService','logCoinToPayStatus','üè¶\x20[CHECK]\x20Saved\x20IBAN:\x20','68070aQqdNS','iban','\x20\x20\x20üìÖ\x20Time:\x20','getPaymentTimerInfo','‚úÖ\x20[EXPIRY]\x20Payment\x20','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','paymentLink','\x20with\x20status\x20','\x20status\x20unchanged\x20(','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link',',\x20currentPayments=','createdAt','failed','CoinToPay2Service','\x20amounts\x20calculated:','schedule_created','coinToPayStatusService','create','not\x20confirmed','toISOString','ü™ô\x20[GLOBAL]\x20Found\x20','paymentTimers','1648166rzccLy','settings','2\x20minutes','loggerService','Payment\x20older\x20than\x20','catch','payment','get','\x20->\x20','‚è∞\x20[HOURLY]\x20Payment\x20','\x20days,\x20marking\x20as\x20EXPIRED','\x20to\x20','error','coinToPay2Service','\x20skipped,\x20','‚ùå\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','\x20found:','POST','üõë\x20[SHUTDOWN]\x20Cleared\x20','amount','logShopWebhookSent','toLowerCase','logWhiteDomainError','checkExpiredPayments','transactionId','üîç\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','‚è∞\x20[GLOBAL]\x20Payment\x20','application/json','Webhook\x20event\x20','forEach','parse','3519025EFLdit','default','‚úÖ\x20[HOURLY]\x20Payment\x20','webhookLog','telegramBotService','size','sendPaymentNotification','üìä\x20[HOURLY]\x20Payment\x20','cointopay','308XnxPrb','\x20is\x20older\x20than\x20',':\x20type=','GLOBAL_CHECK_INTERVAL_MS','floor','Failed\x20to\x20mark\x20payment\x20as\x20expired','7930965kjvBzs','‚úÖ\x20[COINTOPAY]\x20Payment\x20link\x20','map','gatewaySettings','includes','gatewayCommissionRate','customerName','6260616mlLRzB','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','\x20checked,\x20','\x20commission:\x20','./telegramBotService','timers','‚úÖ\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','setDate','‚ùå\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','Failed\x20to\x20send\x20shop\x20webhook:','\x20\x20\x20Gateway\x20','COINTOPAY_ERROR','gatewayOrderId','Payment\x20not\x20found','description','\x20status\x20changed\x20to\x20','\x20marked\x20as\x20paid\x20at:\x20','gateway','checkSinglePaymentById','\x20is\x20too\x20new\x20(','üìà\x20[COINTOPAY]\x20Payment\x20','‚ùå\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','-day\x20timeout','unknown','Payment\x20System/1.0','bankDetails','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','coinToPayService','text','getServiceStats','\x20\x20\x20Amount:\x20','toFixed','‚è∞\x20[GLOBAL]\x20Found\x20','‚úÖ\x20[TIMER]\x20Individual\x20check\x20#','defineProperty','üîç\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','\x20not\x20enabled\x20for\x20shop\x20','\x20payment\x20','\x20expired','expired','payment.failed','findUnique','.\x20Remaining\x20active\x20timers:\x20','type','created','timestamp','\x20USDT','./gateways/coinToPayService','gatewayPaymentId','üìä\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','payment.success','ü™ô\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','stringify','üßπ\x20[CHECK]\x20Payment\x20','ü™ô\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','\x20completed\x20for\x20payment\x20','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20'];a50_0x5238=function(){return _0x474b3f;};return a50_0x5238();}const coinToPayService_1=require(a50_0x93843a(0x1e1)),coinToPay2Service_1=require('./gateways/coinToPay2Service'),gateway_1=require('../types/gateway'),database_1=__importDefault(require('../config/database')),telegramBotService_1=require(a50_0x93843a(0x1b6)),loggerService_1=require(a50_0x93843a(0x1f2)),currencyService_1=require(a50_0x93843a(0x156));class CoinToPayStatusService{constructor(){const _0x5edd9a=a50_0x93843a;this[_0x5edd9a(0x218)]=null,this[_0x5edd9a(0x1a7)]=0x3c*0x3c*0x3e8,this[_0x5edd9a(0x247)]=0x5,this[_0x5edd9a(0x17b)]=new Map(),this[_0x5edd9a(0x1cd)]=new coinToPayService_1['CoinToPayService'](),this['coinToPay2Service']=new coinToPay2Service_1[(_0x5edd9a(0x173))](),console[_0x5edd9a(0x144)](_0x5edd9a(0x151));}['schedulePaymentChecks'](_0xc579d4,_0x215343){const _0x4f90b9=a50_0x93843a;console[_0x4f90b9(0x144)](_0x4f90b9(0x14d)),console['log'](_0x4f90b9(0x1ed)+_0xc579d4),console[_0x4f90b9(0x144)]('\x20\x20\x20-\x20gatewayPaymentId:\x20'+_0x215343),this['clearPaymentTimers'](_0xc579d4);const _0x879a40=[],_0x35c7df=new Date(),_0x5591de=[{'delay':0x1*0x3c*0x3e8,'description':_0x4f90b9(0x1f6)},{'delay':0x2*0x3c*0x3e8,'description':_0x4f90b9(0x17e)},{'delay':0x5*0x3c*0x3e8,'description':_0x4f90b9(0x22f)},{'delay':0x5*0x3c*0x3e8,'description':'5\x20minutes'}];console['log'](_0x4f90b9(0x23b)+_0x5591de[_0x4f90b9(0x242)]+'\x20initial\x20timers\x20for\x20payment\x20'+_0xc579d4);let _0x3725d0=0x0;_0x5591de[_0x4f90b9(0x199)]((_0x84a528,_0x3a8929)=>{const _0x24cf03=_0x4f90b9;_0x3725d0+=_0x84a528['delay'];const _0x5e6bf7=setTimeout(async()=>{const _0x11b6a5=a50_0x6b7c;console['log'](_0x11b6a5(0x214)+(_0x3a8929+0x1)+'\x20triggered\x20for\x20payment\x20'+_0xc579d4+_0x11b6a5(0x22e)+_0x84a528[_0x11b6a5(0x1c0)]+')');try{await this[_0x11b6a5(0x1c4)](_0xc579d4),console[_0x11b6a5(0x144)](_0x11b6a5(0x1d3)+(_0x3a8929+0x1)+_0x11b6a5(0x1e9)+_0xc579d4);}catch(_0x1473c2){console[_0x11b6a5(0x188)]('‚ùå\x20[TIMER]\x20Failed\x20individual\x20check\x20#'+(_0x3a8929+0x1)+_0x11b6a5(0x233)+_0xc579d4+':',_0x1473c2),this['logCoinToPayError'](_0xc579d4,_0x215343,_0x1473c2,'status_check',{'checkNumber':_0x3a8929+0x1,'scheduledAfter':_0x84a528[_0x11b6a5(0x1c0)],'isIndividualCheck':!![]});}},_0x3725d0);_0x879a40[_0x24cf03(0x206)](_0x5e6bf7),console[_0x24cf03(0x144)]('‚è∞\x20[DEBUG]\x20Scheduled\x20check\x20#'+(_0x3a8929+0x1)+_0x24cf03(0x233)+_0xc579d4+_0x24cf03(0x154)+_0x3725d0/0x3e8+'\x20seconds\x20('+_0x84a528[_0x24cf03(0x1c0)]+')');});const _0x409093=setInterval(async()=>{const _0x3c4e3b=_0x4f90b9;console['log'](_0x3c4e3b(0x221)+_0xc579d4);try{const _0x52a7bf=await database_1[_0x3c4e3b(0x19c)][_0x3c4e3b(0x182)][_0x3c4e3b(0x1db)]({'where':{'id':_0xc579d4},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x52a7bf){console[_0x3c4e3b(0x144)](_0x3c4e3b(0x1f0)+_0xc579d4+_0x3c4e3b(0x14e)),this[_0x3c4e3b(0x1fe)](_0xc579d4);return;}console[_0x3c4e3b(0x144)](_0x3c4e3b(0x1a2)+_0xc579d4+_0x3c4e3b(0x23a)+_0x52a7bf['status']);if(_0x52a7bf['status']!=='PENDING'){console['log'](_0x3c4e3b(0x19d)+_0xc579d4+_0x3c4e3b(0x215)+_0x52a7bf[_0x3c4e3b(0x1f8)]+_0x3c4e3b(0x224)),this[_0x3c4e3b(0x1fe)](_0xc579d4);return;}const _0x4805e3=Math[_0x3c4e3b(0x1a8)]((Date[_0x3c4e3b(0x20e)]()-_0x52a7bf['createdAt'][_0x3c4e3b(0x230)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x4805e3>=this['EXPIRY_DAYS']){console['log'](_0x3c4e3b(0x185)+_0xc579d4+_0x3c4e3b(0x1a5)+this[_0x3c4e3b(0x247)]+_0x3c4e3b(0x1cc)),this[_0x3c4e3b(0x1fe)](_0xc579d4);return;}await this[_0x3c4e3b(0x1c4)](_0xc579d4),console['log']('‚úÖ\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20'+_0xc579d4);}catch(_0xb41111){console['error'](_0x3c4e3b(0x153)+_0xc579d4+':',_0xb41111),this['logCoinToPayError'](_0xc579d4,_0x215343,_0xb41111,'status_check',{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x879a40[_0x4f90b9(0x206)](_0x409093),this[_0x4f90b9(0x17b)][_0x4f90b9(0x14a)](_0xc579d4,{'timers':_0x879a40,'paymentId':_0xc579d4,'gatewayPaymentId':_0x215343,'createdAt':_0x35c7df}),console['log'](_0x4f90b9(0x22d)+_0x5591de[_0x4f90b9(0x242)]+'\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20'+_0xc579d4),console[_0x4f90b9(0x144)](_0x4f90b9(0x1e3)+this[_0x4f90b9(0x17b)][_0x4f90b9(0x1a0)]),this[_0x4f90b9(0x164)](_0xc579d4,_0x215343,'PENDING',_0x4f90b9(0x226),'status_check',{'action':_0x4f90b9(0x175),'scheduledChecks':_0x5591de[_0x4f90b9(0x242)],'firstCheckIn':_0x5591de[0x0][_0x4f90b9(0x1f9)]/0x3e8,'totalTimers':this['paymentTimers']['size']});}['clearPaymentTimers'](_0x385067){const _0x25a793=a50_0x93843a,_0x291444=this[_0x25a793(0x17b)][_0x25a793(0x183)](_0x385067);_0x291444?(console['log'](_0x25a793(0x159)+_0x291444['timers']['length']+_0x25a793(0x249)+_0x385067),_0x291444['timers'][_0x25a793(0x199)]((_0x27a706,_0x1c29f1)=>{const _0x2cd806=_0x25a793;_0x27a706&&(clearTimeout(_0x27a706),clearInterval(_0x27a706),console[_0x2cd806(0x144)](_0x2cd806(0x238)+(_0x1c29f1+0x1)+_0x2cd806(0x233)+_0x385067));}),this[_0x25a793(0x17b)][_0x25a793(0x220)](_0x385067),console[_0x25a793(0x144)](_0x25a793(0x160)+_0x385067+_0x25a793(0x1dc)+this[_0x25a793(0x17b)]['size'])):console[_0x25a793(0x144)]('‚ö†Ô∏è\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20'+_0x385067+'\x20to\x20clear');}async[a50_0x93843a(0x1c4)](_0x5e3012){const _0x3d9236=a50_0x93843a;console['log'](_0x3d9236(0x1d5)+_0x5e3012);const _0xa00271=await database_1['default'][_0x3d9236(0x182)][_0x3d9236(0x1db)]({'where':{'id':_0x5e3012},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0xa00271){console[_0x3d9236(0x144)]('‚ùå\x20[CHECK]\x20Payment\x20'+_0x5e3012+_0x3d9236(0x14c));return;}console['log']('üìä\x20[CHECK]\x20Payment\x20'+_0x5e3012+_0x3d9236(0x18c)),console['log']('\x20\x20\x20-\x20Gateway:\x20'+_0xa00271[_0x3d9236(0x1c3)]),console[_0x3d9236(0x144)](_0x3d9236(0x1fd)+_0xa00271[_0x3d9236(0x1f8)]),console[_0x3d9236(0x144)](_0x3d9236(0x14f)+_0xa00271['gatewayPaymentId']),console[_0x3d9236(0x144)]('\x20\x20\x20-\x20Amount:\x20'+_0xa00271[_0x3d9236(0x18f)]+'\x20'+_0xa00271[_0x3d9236(0x145)]),console['log']('\x20\x20\x20-\x20ShopId:\x20'+_0xa00271[_0x3d9236(0x1ef)]);if(_0xa00271['gateway']!=='cointopay'&&_0xa00271['gateway']!=='cointopay2'){console['log'](_0x3d9236(0x23f)+_0x5e3012+_0x3d9236(0x16b)+_0xa00271[_0x3d9236(0x1c3)]+')');return;}if(_0xa00271['status']!=='PENDING'){console[_0x3d9236(0x144)](_0x3d9236(0x23f)+_0x5e3012+'\x20status\x20is\x20'+_0xa00271[_0x3d9236(0x1f8)]+',\x20stopping\x20individual\x20checks'),this[_0x3d9236(0x1fe)](_0x5e3012);return;}if(!_0xa00271[_0x3d9236(0x1e2)]){console[_0x3d9236(0x144)](_0x3d9236(0x23f)+_0x5e3012+_0x3d9236(0x234));return;}console[_0x3d9236(0x144)](_0x3d9236(0x1fc)+_0x5e3012+_0x3d9236(0x239)),await this[_0x3d9236(0x228)](_0xa00271);}[a50_0x93843a(0x164)](_0xa74750,_0x464472,_0x50eff0,_0x1bce61,_0x4fdaac,_0x2142ff){const _0x3337f5=a50_0x93843a,_0x37c7e8={'type':'COINTOPAY_STATUS_CHANGE','paymentId':_0xa74750,'gatewayPaymentId':_0x464472,'oldStatus':_0x50eff0,'newStatus':_0x1bce61,'source':_0x4fdaac,'timestamp':new Date()[_0x3337f5(0x179)](),'details':_0x2142ff||{}};loggerService_1[_0x3337f5(0x17f)][_0x3337f5(0x164)](_0x37c7e8),console['log'](_0x3337f5(0x23e)+_0xa74750+'\x20('+_0x464472+')'),console['log']('\x20\x20\x20üìä\x20Status:\x20'+_0x50eff0+_0x3337f5(0x184)+_0x1bce61),console[_0x3337f5(0x144)]('\x20\x20\x20üìç\x20Source:\x20'+_0x4fdaac),console[_0x3337f5(0x144)](_0x3337f5(0x168)+_0x37c7e8[_0x3337f5(0x1df)]),_0x2142ff&&console['log'](_0x3337f5(0x162),_0x2142ff);}[a50_0x93843a(0x149)](_0x29452b,_0x4b556e,_0x41e4d1,_0x5f97e5,_0x4adab5){const _0x2b1386=a50_0x93843a,_0x1eebfd={'type':_0x2b1386(0x1bd),'paymentId':_0x29452b,'gatewayPaymentId':_0x4b556e,'error':_0x41e4d1 instanceof Error?{'message':_0x41e4d1[_0x2b1386(0x1eb)],'stack':_0x41e4d1['stack']}:_0x41e4d1,'source':_0x5f97e5,'timestamp':new Date()['toISOString'](),'context':_0x4adab5||{}};loggerService_1['loggerService']['logCoinToPayError'](_0x1eebfd),console[_0x2b1386(0x188)](_0x2b1386(0x21c)+_0x29452b+'\x20('+_0x4b556e+')'),console[_0x2b1386(0x188)](_0x2b1386(0x235)+(_0x41e4d1 instanceof Error?_0x41e4d1[_0x2b1386(0x1eb)]:_0x41e4d1)),console['error']('\x20\x20\x20üìç\x20Source:\x20'+_0x5f97e5),console[_0x2b1386(0x188)]('\x20\x20\x20üìÖ\x20Time:\x20'+_0x1eebfd['timestamp']),_0x4adab5&&console[_0x2b1386(0x188)](_0x2b1386(0x202),_0x4adab5);}[a50_0x93843a(0x24b)](){const _0x4415ad=a50_0x93843a;console[_0x4415ad(0x144)](_0x4415ad(0x1e8)),this['checkAllPendingPayments']()[_0x4415ad(0x181)](_0x8388b3=>{const _0xceef7a=_0x4415ad;console[_0xceef7a(0x188)](_0xceef7a(0x245),_0x8388b3);}),this[_0x4415ad(0x218)]=setInterval(async()=>{const _0x5482be=_0x4415ad;try{console[_0x5482be(0x144)](_0x5482be(0x209)),await this[_0x5482be(0x248)](),console[_0x5482be(0x144)]('‚úÖ\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed');}catch(_0x91ac1f){console[_0x5482be(0x188)](_0x5482be(0x1ec),_0x91ac1f);}},this[_0x4415ad(0x1a7)]),console['log'](_0x4415ad(0x237));}['stopPeriodicStatusCheck'](){const _0x295564=a50_0x93843a;console[_0x295564(0x144)](_0x295564(0x20a));this[_0x295564(0x218)]&&(clearInterval(this[_0x295564(0x218)]),this[_0x295564(0x218)]=null,console[_0x295564(0x144)](_0x295564(0x217)));const _0x367b21=this['paymentTimers'][_0x295564(0x1a0)];for(const [_0xbd9c78]of this[_0x295564(0x17b)]){this['clearPaymentTimers'](_0xbd9c78);}console['log'](_0x295564(0x18e)+_0x367b21+'\x20individual\x20payment\x20timers');}async['checkAllPendingPayments'](){const _0x12d56d=a50_0x93843a;try{console[_0x12d56d(0x144)](_0x12d56d(0x1e5));const _0x59ffd0=await database_1['default'][_0x12d56d(0x182)][_0x12d56d(0x232)]({'where':{'gateway':{'in':['cointopay',_0x12d56d(0x207)]},'status':_0x12d56d(0x226),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x12d56d(0x144)](_0x12d56d(0x17a)+_0x59ffd0['length']+'\x20pending\x20CoinToPay\x20payments');if(_0x59ffd0[_0x12d56d(0x242)]===0x0){console[_0x12d56d(0x144)]('ü™ô\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check');return;}const _0x6af9de=await this['checkExpiredPayments'](_0x59ffd0);console[_0x12d56d(0x144)](_0x12d56d(0x1d2)+_0x6af9de[_0x12d56d(0x242)]+_0x12d56d(0x15a));let _0x5d4874=0x0,_0x544a3a=0x0;for(const _0x824d39 of _0x59ffd0){try{if(_0x6af9de['includes'](_0x824d39['id'])){console['log']('‚è∞\x20[GLOBAL]\x20Payment\x20'+_0x824d39['id']+_0x12d56d(0x1b2)),_0x544a3a++;continue;}if(this['paymentTimers'][_0x12d56d(0x161)](_0x824d39['id'])){console[_0x12d56d(0x144)](_0x12d56d(0x196)+_0x824d39['id']+_0x12d56d(0x140)),_0x544a3a++;continue;}const _0x1f22fc=(Date[_0x12d56d(0x20e)]()-_0x824d39[_0x12d56d(0x171)][_0x12d56d(0x230)]())/(0x3e8*0x3c*0x3c);if(_0x1f22fc<0x1){console[_0x12d56d(0x144)]('‚è∞\x20[GLOBAL]\x20Payment\x20'+_0x824d39['id']+_0x12d56d(0x1c5)+_0x1f22fc[_0x12d56d(0x1d1)](0x1)+_0x12d56d(0x157)),_0x544a3a++;continue;}console['log']('üîç\x20[GLOBAL]\x20Checking\x20old\x20payment\x20'+_0x824d39['id']+_0x12d56d(0x14b)+_0x1f22fc[_0x12d56d(0x1d1)](0x1)+'h)'),await this['checkSinglePayment'](_0x824d39),_0x5d4874++,await new Promise(_0x16cefc=>setTimeout(_0x16cefc,0x7d0));}catch(_0x4e1442){console['error'](_0x12d56d(0x240)+_0x824d39['id']+':',_0x4e1442),this[_0x12d56d(0x149)](_0x824d39['id'],_0x824d39[_0x12d56d(0x1e2)]||_0x12d56d(0x1c9),_0x4e1442,_0x12d56d(0x225),{'isGlobalCheck':!![],'paymentAmount':_0x824d39[_0x12d56d(0x18f)],'paymentCurrency':_0x824d39[_0x12d56d(0x145)],'shopId':_0x824d39['shopId'],'createdAt':_0x824d39[_0x12d56d(0x171)]}),loggerService_1[_0x12d56d(0x17f)][_0x12d56d(0x192)](_0x12d56d(0x1a3),_0x12d56d(0x200)+_0x824d39['gatewayPaymentId'],_0x4e1442);}}console['log'](_0x12d56d(0x212)+_0x5d4874+_0x12d56d(0x1b4)+_0x544a3a+_0x12d56d(0x18a)+_0x6af9de[_0x12d56d(0x242)]+_0x12d56d(0x1d8));}catch(_0x41633e){console['error'](_0x12d56d(0x201),_0x41633e);}}async[a50_0x93843a(0x193)](_0x53039c){const _0x2704e3=a50_0x93843a,_0x5d8408=[],_0x546152=new Date();_0x546152[_0x2704e3(0x1b9)](_0x546152[_0x2704e3(0x229)]()-this[_0x2704e3(0x247)]),console[_0x2704e3(0x144)]('‚è∞\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20'+this[_0x2704e3(0x247)]+'\x20days\x20(created\x20before\x20'+_0x546152[_0x2704e3(0x179)]()+')');for(const _0x55e38d of _0x53039c){if(_0x55e38d['createdAt']<_0x546152){console[_0x2704e3(0x144)](_0x2704e3(0x213)+_0x55e38d['id']+_0x2704e3(0x1a5)+this['EXPIRY_DAYS']+_0x2704e3(0x186));try{this[_0x2704e3(0x164)](_0x55e38d['id'],_0x55e38d[_0x2704e3(0x1e2)]||'unknown','PENDING',_0x2704e3(0x24a),'auto_expire',{'reason':_0x2704e3(0x180)+this[_0x2704e3(0x247)]+_0x2704e3(0x204),'createdAt':_0x55e38d[_0x2704e3(0x171)],'daysSinceCreation':Math[_0x2704e3(0x1a8)]((Date[_0x2704e3(0x20e)]()-_0x55e38d[_0x2704e3(0x171)][_0x2704e3(0x230)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x55e38d[_0x2704e3(0x18f)],'paymentCurrency':_0x55e38d['currency'],'shopId':_0x55e38d[_0x2704e3(0x1ef)]}),await database_1['default']['payment'][_0x2704e3(0x1ee)]({'where':{'id':_0x55e38d['id']},'data':{'status':_0x2704e3(0x24a),'updatedAt':new Date()}}),await database_1['default'][_0x2704e3(0x19e)]['create']({'data':{'paymentId':_0x55e38d['id'],'shopId':_0x55e38d[_0x2704e3(0x1ef)],'event':'cointopay_auto_expired','statusCode':0xc8,'responseBody':JSON['stringify']({'reason':_0x2704e3(0x180)+this[_0x2704e3(0x247)]+_0x2704e3(0x204),'createdAt':_0x55e38d['createdAt'],'expiredAt':new Date()['toISOString'](),'daysSinceCreation':Math['floor']((Date[_0x2704e3(0x20e)]()-_0x55e38d[_0x2704e3(0x171)]['getTime']())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x2704e3(0x24d)](_0x55e38d,_0x2704e3(0x24a)),await this[_0x2704e3(0x246)](_0x55e38d,_0x2704e3(0x24a)),this['clearPaymentTimers'](_0x55e38d['id']),_0x5d8408['push'](_0x55e38d['id']),console['log'](_0x2704e3(0x16a)+_0x55e38d['id']+_0x2704e3(0x1ea)+this[_0x2704e3(0x247)]+_0x2704e3(0x1c8));}catch(_0x3001c4){console[_0x2704e3(0x188)](_0x2704e3(0x1c7)+_0x55e38d['id']+':',_0x3001c4),this[_0x2704e3(0x149)](_0x55e38d['id'],_0x55e38d[_0x2704e3(0x1e2)]||_0x2704e3(0x1c9),_0x3001c4,_0x2704e3(0x22a),{'reason':_0x2704e3(0x1a9),'createdAt':_0x55e38d['createdAt'],'daysSinceCreation':Math[_0x2704e3(0x1a8)]((Date[_0x2704e3(0x20e)]()-_0x55e38d[_0x2704e3(0x171)][_0x2704e3(0x230)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x5d8408;}async[a50_0x93843a(0x228)](_0xea307a){const _0xa39a00=a50_0x93843a;if(!_0xea307a[_0xa39a00(0x1e2)]){console['log']('‚ö†Ô∏è\x20[CHECK]\x20Payment\x20'+_0xea307a['id']+_0xa39a00(0x158));return;}console['log'](_0xa39a00(0x20c)+_0xea307a[_0xa39a00(0x1c3)]+_0xa39a00(0x1d7)+_0xea307a['id']+'\x20('+_0xea307a[_0xa39a00(0x1e2)]+')');try{let _0x25a6b3;_0xea307a['gateway']==='cointopay2'?(_0x25a6b3=await this[_0xa39a00(0x189)]['checkPaymentStatus'](_0xea307a['gatewayPaymentId']),console[_0xa39a00(0x144)]('üìä\x20[CHECK]\x20CoinToPay2\x20payment\x20'+_0xea307a['id']+_0xa39a00(0x15e)+_0x25a6b3[_0xa39a00(0x1f8)])):(_0x25a6b3=await this[_0xa39a00(0x1cd)][_0xa39a00(0x1f1)](_0xea307a[_0xa39a00(0x1e2)]),console[_0xa39a00(0x144)](_0xa39a00(0x1fa)+_0xea307a['id']+_0xa39a00(0x15e)+_0x25a6b3[_0xa39a00(0x1f8)]));_0x25a6b3['paymentDetails']&&console[_0xa39a00(0x144)](_0xa39a00(0x21a)+_0xea307a['id']+_0xa39a00(0x20f),{'iban':_0x25a6b3[_0xa39a00(0x208)]['iban']||_0xa39a00(0x1f5),'transactionId':_0x25a6b3[_0xa39a00(0x208)][_0xa39a00(0x194)],'createdOn':_0x25a6b3[_0xa39a00(0x208)][_0xa39a00(0x210)],'confirmedOn':_0x25a6b3[_0xa39a00(0x208)][_0xa39a00(0x1f7)]||_0xa39a00(0x178)});if(_0x25a6b3[_0xa39a00(0x1f8)]!==_0xea307a['status']){console[_0xa39a00(0x144)]('üîÑ\x20[CHECK]\x20Updating\x20payment\x20'+_0xea307a['id']+'\x20status\x20from\x20'+_0xea307a[_0xa39a00(0x1f8)]+_0xa39a00(0x187)+_0x25a6b3[_0xa39a00(0x1f8)]),this[_0xa39a00(0x164)](_0xea307a['id'],_0xea307a[_0xa39a00(0x1e2)],_0xea307a['status'],_0x25a6b3[_0xa39a00(0x1f8)],'status_check',{'paymentDetails':_0x25a6b3[_0xa39a00(0x208)],'amount':_0x25a6b3[_0xa39a00(0x18f)],'currency':_0x25a6b3[_0xa39a00(0x145)],'shopId':_0xea307a[_0xa39a00(0x1ef)],'checkTimestamp':new Date()['toISOString']()});const _0x5f053b={'status':_0x25a6b3['status'],'updatedAt':new Date()};if(_0x25a6b3[_0xa39a00(0x1f8)]===_0xa39a00(0x21d)&&_0xea307a[_0xa39a00(0x1f8)]!=='PAID'){_0x5f053b[_0xa39a00(0x244)]=new Date();if(!_0xea307a[_0xa39a00(0x22c)]){const _0x23e355=await currencyService_1[_0xa39a00(0x163)][_0xa39a00(0x13e)](_0xea307a['amount'],_0xea307a[_0xa39a00(0x145)]);_0x5f053b[_0xa39a00(0x22c)]=_0x23e355;const _0x3e1c98=await this['getGatewayCommission'](_0xea307a[_0xa39a00(0x1ef)],_0xea307a[_0xa39a00(0x1c3)]),_0x49c67e=_0x23e355*(0x1-_0x3e1c98/0x64);_0x5f053b['amountAfterGatewayCommissionUSDT']=_0x49c67e,_0x5f053b[_0xa39a00(0x1af)]=_0x3e1c98,console[_0xa39a00(0x144)](_0xa39a00(0x143)+_0xea307a['id']+_0xa39a00(0x174)),console[_0xa39a00(0x144)](_0xa39a00(0x1d0)+_0xea307a[_0xa39a00(0x18f)]+'\x20'+_0xea307a['currency']+_0xa39a00(0x184)+_0x23e355[_0xa39a00(0x1d1)](0x6)+_0xa39a00(0x1e0)),console[_0xa39a00(0x144)](_0xa39a00(0x1bc)+_0xea307a[_0xa39a00(0x1c3)]+_0xa39a00(0x1b5)+_0x3e1c98+'%'),console[_0xa39a00(0x144)](_0xa39a00(0x241)+_0x49c67e[_0xa39a00(0x1d1)](0x6)+_0xa39a00(0x1e0));}console[_0xa39a00(0x144)](_0xa39a00(0x143)+_0xea307a['id']+_0xa39a00(0x1c2)+_0x5f053b[_0xa39a00(0x244)][_0xa39a00(0x179)]());}if(_0x25a6b3['paymentDetails']){const _0x28ee54=_0x25a6b3[_0xa39a00(0x208)];_0x28ee54[_0xa39a00(0x167)]&&(_0x5f053b['remitterIban']=_0x28ee54[_0xa39a00(0x167)],console[_0xa39a00(0x144)](_0xa39a00(0x165)+_0x28ee54[_0xa39a00(0x167)])),_0x28ee54[_0xa39a00(0x1cb)]&&console[_0xa39a00(0x144)]('üè¶\x20[CHECK]\x20Bank\x20details\x20provided:\x20'+_0x28ee54['bankDetails']),_0x28ee54[_0xa39a00(0x194)]&&console[_0xa39a00(0x144)](_0xa39a00(0x1ff)+_0x28ee54['transactionId']),_0x28ee54[_0xa39a00(0x1f7)]&&console[_0xa39a00(0x144)](_0xa39a00(0x1b8)+_0x28ee54[_0xa39a00(0x1f7)]);}await database_1[_0xa39a00(0x19c)][_0xa39a00(0x182)][_0xa39a00(0x1ee)]({'where':{'id':_0xea307a['id']},'data':_0x5f053b});if(_0x25a6b3[_0xa39a00(0x1f8)]==='PAID'&&_0xea307a[_0xa39a00(0x1f8)]!=='PAID'){console[_0xa39a00(0x144)]('üìà\x20[COINTOPAY]\x20Payment\x20'+_0xea307a['id']+_0xa39a00(0x16f));const _0x5d5d7e=await database_1[_0xa39a00(0x19c)][_0xa39a00(0x182)][_0xa39a00(0x1db)]({'where':{'id':_0xea307a['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x5d5d7e?.[_0xa39a00(0x13f)]&&_0x5d5d7e[_0xa39a00(0x16c)])try{const _0x253172=_0x5d5d7e[_0xa39a00(0x16c)];console[_0xa39a00(0x144)]('üìà\x20[COINTOPAY]\x20Found\x20payment\x20link\x20'+_0x253172['id']+_0xa39a00(0x1a6)+_0x253172[_0xa39a00(0x1dd)]+_0xa39a00(0x170)+_0x253172[_0xa39a00(0x148)]+_0xa39a00(0x1fb)+_0x253172[_0xa39a00(0x1f8)]);const _0x2dc072=_0x253172['currentPayments']+0x1,_0x583023=_0x253172[_0xa39a00(0x1dd)]===_0xa39a00(0x155)?_0xa39a00(0x236):_0x253172[_0xa39a00(0x1f8)];await database_1[_0xa39a00(0x19c)][_0xa39a00(0x16c)][_0xa39a00(0x1ee)]({'where':{'id':_0x253172['id']},'data':{'currentPayments':_0x2dc072,'status':_0x583023,'updatedAt':new Date()}}),console[_0xa39a00(0x144)](_0xa39a00(0x1ab)+_0x253172['id']+_0xa39a00(0x20d)+_0x253172[_0xa39a00(0x148)]+_0xa39a00(0x184)+_0x2dc072+_0xa39a00(0x1fb)+_0x253172[_0xa39a00(0x1f8)]+_0xa39a00(0x184)+_0x583023);}catch(_0x5e90f0){console[_0xa39a00(0x188)](_0xa39a00(0x18b),_0x5e90f0);}else console[_0xa39a00(0x144)](_0xa39a00(0x1c6)+_0xea307a['id']+_0xa39a00(0x146));}await database_1[_0xa39a00(0x19c)][_0xa39a00(0x19e)][_0xa39a00(0x177)]({'data':{'paymentId':_0xea307a['id'],'shopId':_0xea307a[_0xa39a00(0x1ef)],'event':'cointopay_status_check_'+_0x25a6b3['status'][_0xa39a00(0x191)](),'statusCode':0xc8,'responseBody':JSON[_0xa39a00(0x1e6)]({'oldStatus':_0xea307a[_0xa39a00(0x1f8)],'newStatus':_0x25a6b3[_0xa39a00(0x1f8)],'paymentDetails':_0x25a6b3[_0xa39a00(0x208)],'checkedAt':new Date()['toISOString']()})}}),await this[_0xa39a00(0x24d)](_0xea307a,_0x25a6b3[_0xa39a00(0x1f8)]),await this[_0xa39a00(0x246)](_0xea307a,_0x25a6b3[_0xa39a00(0x1f8)]),_0x25a6b3[_0xa39a00(0x1f8)]!==_0xa39a00(0x226)&&(console[_0xa39a00(0x144)](_0xa39a00(0x1e7)+_0xea307a['id']+_0xa39a00(0x1c1)+_0x25a6b3[_0xa39a00(0x1f8)]+',\x20clearing\x20individual\x20timers'),this[_0xa39a00(0x1fe)](_0xea307a['id'])),console['log'](_0xa39a00(0x1fc)+_0xea307a['id']+_0xa39a00(0x15c));}else console[_0xa39a00(0x144)]('üìä\x20[CHECK]\x20Payment\x20'+_0xea307a['id']+_0xa39a00(0x16e)+_0x25a6b3[_0xa39a00(0x1f8)]+')'),this[_0xa39a00(0x164)](_0xea307a['id'],_0xea307a[_0xa39a00(0x1e2)],_0xea307a['status'],_0x25a6b3[_0xa39a00(0x1f8)],_0xa39a00(0x225),{'statusUnchanged':!![],'paymentDetails':_0x25a6b3[_0xa39a00(0x208)],'amount':_0x25a6b3[_0xa39a00(0x18f)],'currency':_0x25a6b3[_0xa39a00(0x145)],'shopId':_0xea307a[_0xa39a00(0x1ef)],'checkTimestamp':new Date()[_0xa39a00(0x179)]()});}catch(_0xaf8832){console['error'](_0xa39a00(0x1ba)+_0xea307a['id']+':',_0xaf8832),this[_0xa39a00(0x149)](_0xea307a['id'],_0xea307a[_0xa39a00(0x1e2)],_0xaf8832,_0xa39a00(0x225),{'paymentAmount':_0xea307a[_0xa39a00(0x18f)],'paymentCurrency':_0xea307a[_0xa39a00(0x145)],'shopId':_0xea307a['shopId'],'createdAt':_0xea307a[_0xa39a00(0x171)]}),await database_1[_0xa39a00(0x19c)][_0xa39a00(0x19e)][_0xa39a00(0x177)]({'data':{'paymentId':_0xea307a['id'],'shopId':_0xea307a['shopId'],'event':_0xa39a00(0x21f),'statusCode':0x1f4,'responseBody':JSON[_0xa39a00(0x1e6)]({'error':_0xaf8832 instanceof Error?_0xaf8832[_0xa39a00(0x1eb)]:'Unknown\x20error','gatewayPaymentId':_0xea307a['gatewayPaymentId'],'checkedAt':new Date()[_0xa39a00(0x179)]()})}});}}async['sendShopWebhook'](_0x7ae6c3,_0x5bac6d){const _0x1ce554=a50_0x93843a,_0x2ff30c=Date[_0x1ce554(0x20e)]();try{const _0x405462=_0x7ae6c3['shop'],_0x48b74c=_0x405462[_0x1ce554(0x17d)];if(!_0x48b74c?.[_0x1ce554(0x147)]){console[_0x1ce554(0x144)](_0x1ce554(0x219)+_0x405462['id']);return;}const _0xc2307e=_0x5bac6d===_0x1ce554(0x21d)?_0x1ce554(0x1e4):_0x5bac6d==='FAILED'?'payment.failed':_0x5bac6d===_0x1ce554(0x24a)?_0x1ce554(0x1da):'payment.pending';if(!_0x48b74c['webhookEvents']?.[_0x1ce554(0x1ae)](_0xc2307e)){console['log'](_0x1ce554(0x198)+_0xc2307e+_0x1ce554(0x1d6)+_0x405462['id']);return;}const _0x48a9b8=(0x0,gateway_1['getGatewayIdByName'])(_0x7ae6c3['gateway'])||_0x7ae6c3[_0x1ce554(0x1c3)],_0x272d81={'event':_0xc2307e,'payment':{'id':_0x7ae6c3['id'],'order_id':_0x7ae6c3['orderId'],'gateway_order_id':_0x7ae6c3[_0x1ce554(0x1be)],'gateway':_0x48a9b8,'amount':_0x7ae6c3['amount'],'currency':_0x7ae6c3['currency'],'status':_0x5bac6d[_0x1ce554(0x191)](),'customer_email':_0x7ae6c3[_0x1ce554(0x23d)],'customer_name':_0x7ae6c3[_0x1ce554(0x1b0)],'created_at':_0x7ae6c3['createdAt'],'updated_at':new Date()}},_0x3fb554=await fetch(_0x48b74c[_0x1ce554(0x147)],{'method':_0x1ce554(0x18d),'headers':{'Content-Type':_0x1ce554(0x197),'User-Agent':_0x1ce554(0x1ca)},'body':JSON['stringify'](_0x272d81)}),_0x114dff=Date['now']()-_0x2ff30c,_0x24f0b3=_0x3fb554['ok']?_0x1ce554(0x211):await _0x3fb554[_0x1ce554(0x1ce)]();loggerService_1[_0x1ce554(0x17f)][_0x1ce554(0x190)](_0x7ae6c3[_0x1ce554(0x1ef)],_0x48b74c[_0x1ce554(0x147)],_0xc2307e,_0x3fb554[_0x1ce554(0x1f8)],_0x114dff,_0x272d81),console['log'](_0x1ce554(0x216)+_0x48b74c[_0x1ce554(0x147)]+_0x1ce554(0x16d)+_0x3fb554['status']+'\x20('+_0x114dff+_0x1ce554(0x223));}catch(_0x52baaa){console['error'](_0x1ce554(0x1bb),_0x52baaa),loggerService_1[_0x1ce554(0x17f)]['logShopWebhookError'](_0x7ae6c3[_0x1ce554(0x1ef)],_0x7ae6c3[_0x1ce554(0x24c)]?.[_0x1ce554(0x17d)]?.[_0x1ce554(0x147)]||'unknown','webhook_send',_0x52baaa,{});}}async[a50_0x93843a(0x246)](_0x414a10,_0x463ed1){const _0xc9b4f2=a50_0x93843a;try{const _0x5096aa={'PENDING':_0xc9b4f2(0x1de),'PAID':_0xc9b4f2(0x203),'FAILED':_0xc9b4f2(0x172),'EXPIRED':_0xc9b4f2(0x1d9)},_0x40d746=_0x5096aa[_0x463ed1];if(!_0x40d746||_0x40d746==='created')return;await telegramBotService_1[_0xc9b4f2(0x19f)][_0xc9b4f2(0x1a1)](_0x414a10[_0xc9b4f2(0x1ef)],_0x414a10,_0x40d746);}catch(_0x3e7293){console['error']('Failed\x20to\x20send\x20Telegram\x20payment\x20notification:',_0x3e7293);}}async[a50_0x93843a(0x231)](_0x95e44d){const _0x1d7804=a50_0x93843a;console[_0x1d7804(0x144)](_0x1d7804(0x195)+_0x95e44d);const _0x495558=await database_1['default'][_0x1d7804(0x182)][_0x1d7804(0x1db)]({'where':{'id':_0x95e44d},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x495558)throw new Error(_0x1d7804(0x1bf));if(_0x495558[_0x1d7804(0x1c3)]!=='cointopay'&&_0x495558[_0x1d7804(0x1c3)]!==_0x1d7804(0x207))throw new Error(_0x1d7804(0x1b3));console['log'](_0x1d7804(0x227)+_0x495558[_0x1d7804(0x1c3)]+_0x1d7804(0x1d7)+_0x95e44d),await this[_0x1d7804(0x228)](_0x495558),console[_0x1d7804(0x144)]('‚úÖ\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20'+_0x95e44d);}[a50_0x93843a(0x1cf)](){const _0x5a3944=a50_0x93843a,_0x2b3e98=this[_0x5a3944(0x218)]?this[_0x5a3944(0x1a7)]:undefined,_0x50a754=Array[_0x5a3944(0x20b)](this[_0x5a3944(0x17b)][_0x5a3944(0x150)]())[_0x5a3944(0x1ac)](_0x3cface=>({'paymentId':_0x3cface[_0x5a3944(0x141)],'gatewayPaymentId':_0x3cface[_0x5a3944(0x1e2)],'createdAt':_0x3cface['createdAt'],'timersCount':_0x3cface['timers']['length']}));return{'isActive':!!this[_0x5a3944(0x218)],'globalCheckIntervalMinutes':this['GLOBAL_CHECK_INTERVAL_MS']/(0x3e8*0x3c),'expiryDays':this['EXPIRY_DAYS'],'activeIndividualTimers':this[_0x5a3944(0x17b)][_0x5a3944(0x1a0)],'nextGlobalCheckIn':_0x2b3e98,'paymentTimersDetails':_0x50a754};}[a50_0x93843a(0x169)](_0x45fdfc){const _0x1a1c3c=a50_0x93843a,_0x2d541e=this[_0x1a1c3c(0x17b)]['get'](_0x45fdfc);if(_0x2d541e)return{'hasTimers':!![],'timersCount':_0x2d541e[_0x1a1c3c(0x1b7)][_0x1a1c3c(0x242)],'createdAt':_0x2d541e[_0x1a1c3c(0x171)],'gatewayPaymentId':_0x2d541e[_0x1a1c3c(0x1e2)]};return{'hasTimers':![]};}async[a50_0x93843a(0x15d)](_0x281695,_0x3bc21){const _0x3268ed=a50_0x93843a;try{const _0x1b6406=await database_1['default']['shop'][_0x3268ed(0x1db)]({'where':{'id':_0x281695},'select':{'gatewaySettings':!![]}});if(!_0x1b6406?.[_0x3268ed(0x1ad)])return console[_0x3268ed(0x144)]('No\x20gateway\x20settings\x20found\x20for\x20shop\x20'+_0x281695+',\x20using\x20default\x20commission\x2010%'),0xa;const _0xe19544=JSON[_0x3268ed(0x19a)](_0x1b6406[_0x3268ed(0x1ad)]);for(const [_0x5d5db3,_0xbb53f0]of Object[_0x3268ed(0x142)](_0xe19544)){if(_0x5d5db3['toLowerCase']()===_0x3bc21[_0x3268ed(0x191)]()){const _0x99f8bf=_0xbb53f0[_0x3268ed(0x21b)]||0xa;return console[_0x3268ed(0x144)](_0x3268ed(0x222)+_0x3bc21+_0x3268ed(0x23c)+_0x281695+':\x20'+_0x99f8bf+'%'),_0x99f8bf;}}return console['log']('No\x20specific\x20commission\x20found\x20for\x20gateway\x20'+_0x3bc21+_0x3268ed(0x1f4)+_0x281695+_0x3268ed(0x152)),0xa;}catch(_0x43b7b3){return console['error']('Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20'+_0x281695+_0x3268ed(0x15f)+_0x3bc21+':',_0x43b7b3),0xa;}}}exports[a50_0x93843a(0x243)]=CoinToPayStatusService,exports[a50_0x93843a(0x176)]=new CoinToPayStatusService();