'use strict';function a40_0x25da(_0x31bf14,_0x3b2736){const _0x2285c4=a40_0x2285();return a40_0x25da=function(_0x25da4f,_0x11f783){_0x25da4f=_0x25da4f-0x174;let _0x1491b6=_0x2285c4[_0x25da4f];return _0x1491b6;},a40_0x25da(_0x31bf14,_0x3b2736);}const a40_0x18552b=a40_0x25da;(function(_0x22466b,_0x5b2c18){const _0x22f066=a40_0x25da,_0x5badd3=_0x22466b();while(!![]){try{const _0x3ab0d1=parseInt(_0x22f066(0x212))/0x1+parseInt(_0x22f066(0x233))/0x2+parseInt(_0x22f066(0x26d))/0x3*(parseInt(_0x22f066(0x272))/0x4)+parseInt(_0x22f066(0x260))/0x5+parseInt(_0x22f066(0x20b))/0x6*(parseInt(_0x22f066(0x195))/0x7)+-parseInt(_0x22f066(0x1b2))/0x8*(-parseInt(_0x22f066(0x1a2))/0x9)+-parseInt(_0x22f066(0x182))/0xa;if(_0x3ab0d1===_0x5b2c18)break;else _0x5badd3['push'](_0x5badd3['shift']());}catch(_0x4e1f20){_0x5badd3['push'](_0x5badd3['shift']());}}}(a40_0x2285,0x1a219));var __importDefault=this&&this[a40_0x18552b(0x20f)]||function(_0x1fd1df){const _0x365a53=a40_0x18552b;return _0x1fd1df&&_0x1fd1df[_0x365a53(0x1db)]?_0x1fd1df:{'default':_0x1fd1df};};function a40_0x2285(){const _0x4fab73=['webhookLog','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','üè¶\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes','‚úÖ\x20[TIMER]\x20Individual\x20check\x20#','currency','-day\x20timeout','‚ùå\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','sendShopWebhook','sendPaymentNotification','\x20days,\x20marking\x20as\x20EXPIRED','unknown','Unknown\x20error','üìà\x20[COINTOPAY]\x20Payment\x20','message','\x20\x20\x20üìù\x20Context:','application/json','\x20not\x20found\x20in\x20database','cointopay','üìä\x20[CHECK]\x20Payment\x20','Payment\x20older\x20than\x20','‚è∞\x20[HOURLY]\x20Payment\x20','currencyService','from','setDate','\x20\x20\x20-\x20gatewayPaymentId:\x20','\x20pending\x20CoinToPay\x20payments','ms)','\x20\x20\x20-\x20Status:\x20','\x20is\x20too\x20new\x20(','\x20commission:\x20','ü™ô\x20[TIMER]\x20Individual\x20check\x20#','default','‚è∞\x20[GLOBAL]\x20Found\x20','\x20status\x20is\x20','amountAfterGatewayCommissionUSDT','checkSinglePayment','ü™ô\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','__esModule','gatewaySettings','\x20USDT','auto_expire','telegramBotService','\x20updated:\x20currentPayments=','\x20to\x20clear','‚úÖ\x20[CHECK]\x20Payment\x20','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','ü™ô\x20[ERROR]\x20CoinToPay\x20Error:\x20','set','checkPaymentById','update','shop','payment.pending','create','‚ùå\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','\x20status\x20unchanged\x20(','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','getTime','‚úÖ\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','\x20with\x20status\x20','log','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','‚ùå\x20[HOURLY]\x20Payment\x20','\x20\x20\x20üìç\x20Source:\x20','push','\x20\x20\x20Amount:\x20','‚ùå\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','‚úÖ\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','üí∞\x20[CHECK]\x20Payment\x20','findUnique','üßπ\x20[DEBUG]\x20Clearing\x20','1\x20minute','type','getGatewayCommission','payment.failed','created','checkExpiredPayments','orderId','ü™ô\x20[GLOBAL]\x20Found\x20','\x20\x20\x20Gateway\x20','\x20expired\x20CoinToPay\x20payments','Bank\x20Details:\x20','./telegramBotService','cointopay_status_check_','forEach','1014DqiWfG','ü™ô\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','iban','‚ùå\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','__importDefault','transactionId','‚ö†Ô∏è\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','59158DtyIjt','\x20\x20\x20üìÖ\x20Time:\x20','getServiceStats','‚ùå\x20[CHECK]\x20Payment\x20','\x20\x20\x20-\x20paymentId:\x20','‚è∞\x20[EXPIRY]\x20Payment\x20','\x20to\x20','\x20has\x20no\x20gatewayPaymentId','paymentLink','ü™ô\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','../types/gateway','üîç\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','map','\x20not\x20found,\x20clearing\x20timers','\x20found:','COMPLETED','gatewayPaymentId','\x20days\x20without\x20payment\x20confirmation','amountUSDT','paymentDetails','üìä\x20[CHECK]\x20CoinToPay\x20payment\x20','./currencyService','paidAt','status','./gateways/coinToPayService','toISOString','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','gateway','ü™ô\x20[DEBUG]\x20Creating\x20','payment.success','‚úÖ\x20[DEBUG]\x20Successfully\x20scheduled\x20','\x20skipped,\x20','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','47756OBkOhe','paymentId','createdAt','schedule_created',',\x20stopping\x20individual\x20checks','has','webhookEvents','clearPaymentTimers','logShopWebhookSent','logCoinToPayStatus','‚úÖ\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','\x20has\x20no\x20gatewayPaymentId,\x20skipping','\x20\x20\x20-\x20ShopId:\x20','COINTOPAY_ERROR','convertToUSDT','ü™ô\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','confirmedOn','\x20seconds\x20(','checkSinglePaymentById','floor','‚úÖ\x20[COINTOPAY]\x20Payment\x20link\x20','\x20\x20\x20üìù\x20Details:','coinToPay2Service','logCoinToPayError','\x20details:','\x20completed\x20for\x20payment\x20',',\x20status=','coinToPayService','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','EXPIRY_DAYS','\x20days\x20(created\x20before\x20','get','Shop\x20webhook\x20sent\x20to\x20','‚ùå\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','h),\x20skipping\x20global\x20check','now','\x20is\x20valid\x20for\x20checking,\x20proceeding...','\x20in\x20shop\x20','COINTOPAY_STATUS_CHANGE','paymentTimers','üõë\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','\x20triggered\x20for\x20payment\x20','text','\x20updated\x20successfully','loggerService','726975tQFpVR','Webhook\x20event\x20','\x20initial\x20timers\x20for\x20payment\x20','./loggerService','üìä\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','status_check','ü™ô\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','\x20status:\x20','coinToPayStatusService','not\x20confirmed','amount','\x20marked\x20as\x20paid\x20at:\x20','üÜî\x20[CHECK]\x20Transaction\x20ID:\x20','90939kztfJl','EXPIRED','../config/database','\x20amounts\x20calculated:','remitterIban','12vjBcCW','findMany','catch','\x20\x20\x20-\x20GatewayPaymentId:\x20','‚è∞\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','‚úÖ\x20[EXPIRY]\x20Payment\x20','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','\x20(after\x20','Payment\x20not\x20found','GLOBAL_CHECK_INTERVAL_MS','\x20\x20\x20üìä\x20Status:\x20','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','customerEmail','settings','\x20for\x20payment\x20',':\x20type=','entries','‚úÖ\x20[HOURLY]\x20Payment\x20','sendPaymentStatusNotification','not\x20found','\x20individual\x20payment\x20timers',',\x20clearing\x20individual\x20timers','‚úÖ\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','logShopWebhookError','cointopay2','PENDING','currentPayments','\x20->\x20','\x20current\x20status:\x20','\x20\x20\x20-\x20Gateway:\x20','failed','üìä\x20[CHECK]\x20CoinToPay2\x20payment\x20','FAILED','CoinToPayService','checkPaymentStatus','globalCheckInterval','toFixed','checkAllPendingPayments','payment','delay','4403390prLCXs',',\x20using\x20default\x20commission\x2010%','2\x20minutes','error','/status/','No\x20specific\x20commission\x20found\x20for\x20gateway\x20','customerName','5\x20minutes','üßπ\x20[DEBUG]\x20Cleared\x20timer\x20#','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','getGatewayIdByName','webhookUrl','\x20\x20\x20Amount\x20after\x20commission:\x20','Success','PAID','SINGLE','üõë\x20[SHUTDOWN]\x20Cleared\x20','stopPeriodicStatusCheck','‚è∞\x20[GLOBAL]\x20Payment\x20','4417jEUzoL','\x20days','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','\x20checked,\x20','shopId','bankDetails',',\x20currentPayments=','toLowerCase','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','‚úÖ\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','parse','description','timers','1089CdbXid','ü™ô\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','delete','size','\x20commission\x20for\x20shop\x20','CoinToPay2Service','üîç\x20[CHECK]\x20Checking\x20','CoinToPayStatusService','\x20\x20\x20‚ùå\x20Error:\x20','‚è∞\x20[DEBUG]\x20Scheduled\x20check\x20#','\x20not\x20enabled\x20for\x20shop\x20','stringify','‚ö†Ô∏è\x20[CHECK]\x20Payment\x20','startPeriodicStatusCheck','timestamp','length','8024fzyIzS','\x20payment\x20','paid','Gateway\x20'];a40_0x2285=function(){return _0x4fab73;};return a40_0x2285();}Object['defineProperty'](exports,a40_0x18552b(0x1db),{'value':!![]}),exports[a40_0x18552b(0x268)]=exports[a40_0x18552b(0x1a9)]=void 0x0;const coinToPayService_1=require(a40_0x18552b(0x22a)),coinToPay2Service_1=require('./gateways/coinToPay2Service'),gateway_1=require(a40_0x18552b(0x21c)),database_1=__importDefault(require(a40_0x18552b(0x26f))),telegramBotService_1=require(a40_0x18552b(0x208)),loggerService_1=require(a40_0x18552b(0x263)),currencyService_1=require(a40_0x18552b(0x227));class CoinToPayStatusService{constructor(){const _0x4f1102=a40_0x18552b;this['globalCheckInterval']=null,this[_0x4f1102(0x27b)]=0x3c*0x3c*0x3e8,this['EXPIRY_DAYS']=0x5,this[_0x4f1102(0x25a)]=new Map(),this[_0x4f1102(0x24e)]=new coinToPayService_1[(_0x4f1102(0x17b))](),this[_0x4f1102(0x249)]=new coinToPay2Service_1[(_0x4f1102(0x1a7))](),console[_0x4f1102(0x1f1)](_0x4f1102(0x20c));}['schedulePaymentChecks'](_0x10e0c8,_0x1912c6){const _0xf43997=a40_0x18552b;console[_0xf43997(0x1f1)](_0xf43997(0x1da)),console[_0xf43997(0x1f1)](_0xf43997(0x216)+_0x10e0c8),console['log'](_0xf43997(0x1ce)+_0x1912c6),this[_0xf43997(0x23a)](_0x10e0c8);const _0x185e34=[],_0x1c8355=new Date(),_0xd5f20a=[{'delay':0x1*0x3c*0x3e8,'description':_0xf43997(0x1fd)},{'delay':0x2*0x3c*0x3e8,'description':_0xf43997(0x184)},{'delay':0x5*0x3c*0x3e8,'description':_0xf43997(0x189)},{'delay':0x5*0x3c*0x3e8,'description':_0xf43997(0x189)}];console[_0xf43997(0x1f1)](_0xf43997(0x22e)+_0xd5f20a[_0xf43997(0x1b1)]+_0xf43997(0x262)+_0x10e0c8);let _0x869da8=0x0;_0xd5f20a[_0xf43997(0x20a)]((_0x1a7dc5,_0x4c5803)=>{const _0x23c9bd=_0xf43997;_0x869da8+=_0x1a7dc5[_0x23c9bd(0x181)];const _0x2f5ebf=setTimeout(async()=>{const _0x349bdd=_0x23c9bd;console[_0x349bdd(0x1f1)](_0x349bdd(0x1d4)+(_0x4c5803+0x1)+_0x349bdd(0x25c)+_0x10e0c8+_0x349bdd(0x279)+_0x1a7dc5[_0x349bdd(0x1a0)]+')');try{await this['checkSinglePaymentById'](_0x10e0c8),console[_0x349bdd(0x1f1)](_0x349bdd(0x1b9)+(_0x4c5803+0x1)+_0x349bdd(0x24c)+_0x10e0c8);}catch(_0x46aa88){console[_0x349bdd(0x185)]('‚ùå\x20[TIMER]\x20Failed\x20individual\x20check\x20#'+(_0x4c5803+0x1)+_0x349bdd(0x280)+_0x10e0c8+':',_0x46aa88),this[_0x349bdd(0x24a)](_0x10e0c8,_0x1912c6,_0x46aa88,_0x349bdd(0x265),{'checkNumber':_0x4c5803+0x1,'scheduledAfter':_0x1a7dc5[_0x349bdd(0x1a0)],'isIndividualCheck':!![]});}},_0x869da8);_0x185e34['push'](_0x2f5ebf),console['log'](_0x23c9bd(0x1ab)+(_0x4c5803+0x1)+_0x23c9bd(0x280)+_0x10e0c8+'\x20in\x20'+_0x869da8/0x3e8+_0x23c9bd(0x244)+_0x1a7dc5[_0x23c9bd(0x1a0)]+')');});const _0x137d30=setInterval(async()=>{const _0x209458=_0xf43997;console['log']('ü™ô\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20'+_0x10e0c8);try{const _0x3e68a5=await database_1[_0x209458(0x1d5)][_0x209458(0x180)][_0x209458(0x1fb)]({'where':{'id':_0x10e0c8},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x3e68a5){console[_0x209458(0x1f1)](_0x209458(0x1f3)+_0x10e0c8+_0x209458(0x21f)),this[_0x209458(0x23a)](_0x10e0c8);return;}console[_0x209458(0x1f1)]('üìä\x20[HOURLY]\x20Payment\x20'+_0x10e0c8+_0x209458(0x176)+_0x3e68a5[_0x209458(0x229)]);if(_0x3e68a5['status']!==_0x209458(0x28b)){console[_0x209458(0x1f1)](_0x209458(0x283)+_0x10e0c8+_0x209458(0x1d7)+_0x3e68a5[_0x209458(0x229)]+_0x209458(0x237)),this[_0x209458(0x23a)](_0x10e0c8);return;}const _0xfcff7d=Math[_0x209458(0x246)]((Date[_0x209458(0x256)]()-_0x3e68a5[_0x209458(0x235)][_0x209458(0x1ee)]())/(0x3e8*0x3c*0x3c*0x18));if(_0xfcff7d>=this[_0x209458(0x250)]){console[_0x209458(0x1f1)](_0x209458(0x1ca)+_0x10e0c8+'\x20is\x20older\x20than\x20'+this['EXPIRY_DAYS']+_0x209458(0x1ed)),this['clearPaymentTimers'](_0x10e0c8);return;}await this[_0x209458(0x245)](_0x10e0c8),console[_0x209458(0x1f1)](_0x209458(0x288)+_0x10e0c8);}catch(_0x5957f3){console[_0x209458(0x185)](_0x209458(0x1eb)+_0x10e0c8+':',_0x5957f3),this['logCoinToPayError'](_0x10e0c8,_0x1912c6,_0x5957f3,_0x209458(0x265),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x185e34['push'](_0x137d30),this[_0xf43997(0x25a)][_0xf43997(0x1e5)](_0x10e0c8,{'timers':_0x185e34,'paymentId':_0x10e0c8,'gatewayPaymentId':_0x1912c6,'createdAt':_0x1c8355}),console[_0xf43997(0x1f1)](_0xf43997(0x230)+_0xd5f20a[_0xf43997(0x1b1)]+_0xf43997(0x232)+_0x10e0c8),console[_0xf43997(0x1f1)](_0xf43997(0x264)+this[_0xf43997(0x25a)]['size']),this['logCoinToPayStatus'](_0x10e0c8,_0x1912c6,'PENDING',_0xf43997(0x28b),_0xf43997(0x265),{'action':_0xf43997(0x236),'scheduledChecks':_0xd5f20a[_0xf43997(0x1b1)],'firstCheckIn':_0xd5f20a[0x0][_0xf43997(0x181)]/0x3e8,'totalTimers':this['paymentTimers'][_0xf43997(0x1a5)]});}[a40_0x18552b(0x23a)](_0x13ad62){const _0x52c305=a40_0x18552b,_0x1f71e5=this[_0x52c305(0x25a)][_0x52c305(0x252)](_0x13ad62);_0x1f71e5?(console[_0x52c305(0x1f1)](_0x52c305(0x1fc)+_0x1f71e5['timers']['length']+'\x20timers\x20for\x20payment\x20'+_0x13ad62),_0x1f71e5[_0x52c305(0x1a1)]['forEach']((_0x545d63,_0x39ad1c)=>{const _0x23d37c=_0x52c305;_0x545d63&&(clearTimeout(_0x545d63),clearInterval(_0x545d63),console[_0x23d37c(0x1f1)](_0x23d37c(0x18a)+(_0x39ad1c+0x1)+'\x20for\x20payment\x20'+_0x13ad62));}),this['paymentTimers'][_0x52c305(0x1a4)](_0x13ad62),console[_0x52c305(0x1f1)](_0x52c305(0x23d)+_0x13ad62+'.\x20Remaining\x20active\x20timers:\x20'+this[_0x52c305(0x25a)][_0x52c305(0x1a5)])):console[_0x52c305(0x1f1)](_0x52c305(0x211)+_0x13ad62+_0x52c305(0x1e1));}async['checkSinglePaymentById'](_0x2654f2){const _0x5313cf=a40_0x18552b;console[_0x5313cf(0x1f1)]('üîç\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20'+_0x2654f2);const _0x1b8671=await database_1[_0x5313cf(0x1d5)][_0x5313cf(0x180)][_0x5313cf(0x1fb)]({'where':{'id':_0x2654f2},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x1b8671){console[_0x5313cf(0x1f1)](_0x5313cf(0x215)+_0x2654f2+_0x5313cf(0x1c6));return;}console[_0x5313cf(0x1f1)]('üìä\x20[CHECK]\x20Payment\x20'+_0x2654f2+_0x5313cf(0x220)),console[_0x5313cf(0x1f1)](_0x5313cf(0x177)+_0x1b8671[_0x5313cf(0x22d)]),console['log'](_0x5313cf(0x1d1)+_0x1b8671['status']),console[_0x5313cf(0x1f1)](_0x5313cf(0x275)+_0x1b8671['gatewayPaymentId']),console[_0x5313cf(0x1f1)]('\x20\x20\x20-\x20Amount:\x20'+_0x1b8671[_0x5313cf(0x26a)]+'\x20'+_0x1b8671[_0x5313cf(0x1ba)]),console[_0x5313cf(0x1f1)](_0x5313cf(0x23f)+_0x1b8671[_0x5313cf(0x199)]);if(_0x1b8671[_0x5313cf(0x22d)]!==_0x5313cf(0x1c7)&&_0x1b8671[_0x5313cf(0x22d)]!==_0x5313cf(0x28a)){console[_0x5313cf(0x1f1)]('‚ö†Ô∏è\x20[CHECK]\x20Payment\x20'+_0x2654f2+_0x5313cf(0x27d)+_0x1b8671[_0x5313cf(0x22d)]+')');return;}if(_0x1b8671[_0x5313cf(0x229)]!==_0x5313cf(0x28b)){console[_0x5313cf(0x1f1)](_0x5313cf(0x1ae)+_0x2654f2+'\x20status\x20is\x20'+_0x1b8671[_0x5313cf(0x229)]+_0x5313cf(0x237)),this[_0x5313cf(0x23a)](_0x2654f2);return;}if(!_0x1b8671[_0x5313cf(0x222)]){console[_0x5313cf(0x1f1)](_0x5313cf(0x1ae)+_0x2654f2+_0x5313cf(0x219));return;}console[_0x5313cf(0x1f1)](_0x5313cf(0x1e2)+_0x2654f2+_0x5313cf(0x257)),await this[_0x5313cf(0x1d9)](_0x1b8671);}['logCoinToPayStatus'](_0x2a65b6,_0x4c79a4,_0x4d37c1,_0x506971,_0x230594,_0x4fb935){const _0x40ee31=a40_0x18552b,_0x1076d1={'type':_0x40ee31(0x259),'paymentId':_0x2a65b6,'gatewayPaymentId':_0x4c79a4,'oldStatus':_0x4d37c1,'newStatus':_0x506971,'source':_0x230594,'timestamp':new Date()[_0x40ee31(0x22b)](),'details':_0x4fb935||{}};loggerService_1[_0x40ee31(0x25f)]['logCoinToPayStatus'](_0x1076d1),console[_0x40ee31(0x1f1)]('ü™ô\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20'+_0x2a65b6+'\x20('+_0x4c79a4+')'),console[_0x40ee31(0x1f1)](_0x40ee31(0x27c)+_0x4d37c1+_0x40ee31(0x175)+_0x506971),console[_0x40ee31(0x1f1)](_0x40ee31(0x1f4)+_0x230594),console[_0x40ee31(0x1f1)](_0x40ee31(0x213)+_0x1076d1[_0x40ee31(0x1b0)]),_0x4fb935&&console[_0x40ee31(0x1f1)](_0x40ee31(0x248),_0x4fb935);}[a40_0x18552b(0x24a)](_0x3a2a6d,_0x5692a8,_0x58ae04,_0x21abd4,_0x4de67a){const _0x33ccb0=a40_0x18552b,_0x440861={'type':_0x33ccb0(0x240),'paymentId':_0x3a2a6d,'gatewayPaymentId':_0x5692a8,'error':_0x58ae04 instanceof Error?{'message':_0x58ae04['message'],'stack':_0x58ae04['stack']}:_0x58ae04,'source':_0x21abd4,'timestamp':new Date()[_0x33ccb0(0x22b)](),'context':_0x4de67a||{}};loggerService_1['loggerService'][_0x33ccb0(0x24a)](_0x440861),console['error'](_0x33ccb0(0x1e4)+_0x3a2a6d+'\x20('+_0x5692a8+')'),console[_0x33ccb0(0x185)](_0x33ccb0(0x1aa)+(_0x58ae04 instanceof Error?_0x58ae04[_0x33ccb0(0x1c3)]:_0x58ae04)),console['error']('\x20\x20\x20üìç\x20Source:\x20'+_0x21abd4),console[_0x33ccb0(0x185)](_0x33ccb0(0x213)+_0x440861['timestamp']),_0x4de67a&&console[_0x33ccb0(0x185)](_0x33ccb0(0x1c4),_0x4de67a);}[a40_0x18552b(0x1af)](){const _0x347eb2=a40_0x18552b;console['log'](_0x347eb2(0x242)),this[_0x347eb2(0x17f)]()[_0x347eb2(0x274)](_0x460c31=>{const _0x138739=_0x347eb2;console[_0x138739(0x185)](_0x138739(0x1bc),_0x460c31);}),this[_0x347eb2(0x17d)]=setInterval(async()=>{const _0x3c9995=_0x347eb2;try{console[_0x3c9995(0x1f1)](_0x3c9995(0x1a3)),await this['checkAllPendingPayments'](),console[_0x3c9995(0x1f1)]('‚úÖ\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed');}catch(_0x389d43){console[_0x3c9995(0x185)](_0x3c9995(0x1f7),_0x389d43);}},this[_0x347eb2(0x27b)]),console[_0x347eb2(0x1f1)](_0x347eb2(0x19e));}[a40_0x18552b(0x193)](){const _0x4804bc=a40_0x18552b;console['log'](_0x4804bc(0x25b));this[_0x4804bc(0x17d)]&&(clearInterval(this['globalCheckInterval']),this['globalCheckInterval']=null,console[_0x4804bc(0x1f1)]('üõë\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped'));const _0x11b022=this[_0x4804bc(0x25a)][_0x4804bc(0x1a5)];for(const [_0x56148e]of this[_0x4804bc(0x25a)]){this[_0x4804bc(0x23a)](_0x56148e);}console['log'](_0x4804bc(0x192)+_0x11b022+_0x4804bc(0x286));}async['checkAllPendingPayments'](){const _0x58c3e6=a40_0x18552b;try{console[_0x58c3e6(0x1f1)](_0x58c3e6(0x21b));const _0x8ba629=await database_1['default'][_0x58c3e6(0x180)][_0x58c3e6(0x273)]({'where':{'gateway':{'in':[_0x58c3e6(0x1c7),_0x58c3e6(0x28a)]},'status':_0x58c3e6(0x28b),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x58c3e6(0x1f1)](_0x58c3e6(0x204)+_0x8ba629[_0x58c3e6(0x1b1)]+_0x58c3e6(0x1cf));if(_0x8ba629['length']===0x0){console[_0x58c3e6(0x1f1)](_0x58c3e6(0x266));return;}const _0x1fa36a=await this[_0x58c3e6(0x202)](_0x8ba629);console['log'](_0x58c3e6(0x1d6)+_0x1fa36a[_0x58c3e6(0x1b1)]+_0x58c3e6(0x206));let _0x29a1e9=0x0,_0x7362de=0x0;for(const _0x5643ed of _0x8ba629){try{if(_0x1fa36a['includes'](_0x5643ed['id'])){console[_0x58c3e6(0x1f1)](_0x58c3e6(0x194)+_0x5643ed['id']+'\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check'),_0x7362de++;continue;}if(this[_0x58c3e6(0x25a)][_0x58c3e6(0x238)](_0x5643ed['id'])){console['log'](_0x58c3e6(0x194)+_0x5643ed['id']+_0x58c3e6(0x1e3)),_0x7362de++;continue;}const _0x663ccb=(Date['now']()-_0x5643ed[_0x58c3e6(0x235)][_0x58c3e6(0x1ee)]())/(0x3e8*0x3c*0x3c);if(_0x663ccb<0x1){console[_0x58c3e6(0x1f1)](_0x58c3e6(0x194)+_0x5643ed['id']+_0x58c3e6(0x1d2)+_0x663ccb[_0x58c3e6(0x17e)](0x1)+_0x58c3e6(0x255)),_0x7362de++;continue;}console[_0x58c3e6(0x1f1)](_0x58c3e6(0x21d)+_0x5643ed['id']+'\x20(age:\x20'+_0x663ccb[_0x58c3e6(0x17e)](0x1)+'h)'),await this['checkSinglePayment'](_0x5643ed),_0x29a1e9++,await new Promise(_0x403e98=>setTimeout(_0x403e98,0x7d0));}catch(_0x195d60){console[_0x58c3e6(0x185)]('‚ùå\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20'+_0x5643ed['id']+':',_0x195d60),this[_0x58c3e6(0x24a)](_0x5643ed['id'],_0x5643ed[_0x58c3e6(0x222)]||_0x58c3e6(0x1c0),_0x195d60,_0x58c3e6(0x265),{'isGlobalCheck':!![],'paymentAmount':_0x5643ed[_0x58c3e6(0x26a)],'paymentCurrency':_0x5643ed[_0x58c3e6(0x1ba)],'shopId':_0x5643ed[_0x58c3e6(0x199)],'createdAt':_0x5643ed['createdAt']}),loggerService_1[_0x58c3e6(0x25f)]['logWhiteDomainError'](_0x58c3e6(0x1c7),_0x58c3e6(0x186)+_0x5643ed[_0x58c3e6(0x222)],_0x195d60);}}console[_0x58c3e6(0x1f1)](_0x58c3e6(0x1b7)+_0x29a1e9+_0x58c3e6(0x198)+_0x7362de+_0x58c3e6(0x231)+_0x1fa36a['length']+'\x20expired');}catch(_0x163c05){console['error'](_0x58c3e6(0x24f),_0x163c05);}}async['checkExpiredPayments'](_0x2c7d6c){const _0x45071d=a40_0x18552b,_0x4cec56=[],_0x5071a5=new Date();_0x5071a5[_0x45071d(0x1cd)](_0x5071a5['getDate']()-this['EXPIRY_DAYS']),console[_0x45071d(0x1f1)](_0x45071d(0x276)+this[_0x45071d(0x250)]+_0x45071d(0x251)+_0x5071a5[_0x45071d(0x22b)]()+')');for(const _0xd3417 of _0x2c7d6c){if(_0xd3417[_0x45071d(0x235)]<_0x5071a5){console[_0x45071d(0x1f1)](_0x45071d(0x217)+_0xd3417['id']+'\x20is\x20older\x20than\x20'+this[_0x45071d(0x250)]+_0x45071d(0x1bf));try{this[_0x45071d(0x23c)](_0xd3417['id'],_0xd3417[_0x45071d(0x222)]||_0x45071d(0x1c0),_0x45071d(0x28b),_0x45071d(0x26e),_0x45071d(0x1de),{'reason':_0x45071d(0x1c9)+this[_0x45071d(0x250)]+'\x20days','createdAt':_0xd3417[_0x45071d(0x235)],'daysSinceCreation':Math[_0x45071d(0x246)]((Date[_0x45071d(0x256)]()-_0xd3417[_0x45071d(0x235)][_0x45071d(0x1ee)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0xd3417[_0x45071d(0x26a)],'paymentCurrency':_0xd3417[_0x45071d(0x1ba)],'shopId':_0xd3417[_0x45071d(0x199)]}),await database_1[_0x45071d(0x1d5)][_0x45071d(0x180)][_0x45071d(0x1e7)]({'where':{'id':_0xd3417['id']},'data':{'status':_0x45071d(0x26e),'updatedAt':new Date(),'adminNotes':'Automatically\x20expired\x20after\x20'+this[_0x45071d(0x250)]+_0x45071d(0x223)}}),await database_1['default'][_0x45071d(0x1b6)][_0x45071d(0x1ea)]({'data':{'paymentId':_0xd3417['id'],'shopId':_0xd3417[_0x45071d(0x199)],'event':'cointopay_auto_expired','statusCode':0xc8,'responseBody':JSON[_0x45071d(0x1ad)]({'reason':_0x45071d(0x1c9)+this[_0x45071d(0x250)]+_0x45071d(0x196),'createdAt':_0xd3417[_0x45071d(0x235)],'expiredAt':new Date()[_0x45071d(0x22b)](),'daysSinceCreation':Math[_0x45071d(0x246)]((Date[_0x45071d(0x256)]()-_0xd3417[_0x45071d(0x235)][_0x45071d(0x1ee)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x45071d(0x1bd)](_0xd3417,_0x45071d(0x26e)),await this[_0x45071d(0x284)](_0xd3417,'EXPIRED'),this[_0x45071d(0x23a)](_0xd3417['id']),_0x4cec56[_0x45071d(0x1f5)](_0xd3417['id']),console['log'](_0x45071d(0x277)+_0xd3417['id']+_0x45071d(0x1f8)+this['EXPIRY_DAYS']+_0x45071d(0x1bb));}catch(_0x3f5e07){console['error'](_0x45071d(0x254)+_0xd3417['id']+':',_0x3f5e07),this[_0x45071d(0x24a)](_0xd3417['id'],_0xd3417[_0x45071d(0x222)]||_0x45071d(0x1c0),_0x3f5e07,_0x45071d(0x1de),{'reason':'Failed\x20to\x20mark\x20payment\x20as\x20expired','createdAt':_0xd3417[_0x45071d(0x235)],'daysSinceCreation':Math['floor']((Date['now']()-_0xd3417['createdAt']['getTime']())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x4cec56;}async['checkSinglePayment'](_0x1d992d){const _0x4bc86d=a40_0x18552b;if(!_0x1d992d[_0x4bc86d(0x222)]){console[_0x4bc86d(0x1f1)](_0x4bc86d(0x1ae)+_0x1d992d['id']+_0x4bc86d(0x23e));return;}console[_0x4bc86d(0x1f1)](_0x4bc86d(0x1a8)+_0x1d992d['gateway']+'\x20payment\x20'+_0x1d992d['id']+'\x20('+_0x1d992d[_0x4bc86d(0x222)]+')');try{let _0x4d46d7;_0x1d992d[_0x4bc86d(0x22d)]===_0x4bc86d(0x28a)?(_0x4d46d7=await this['coinToPay2Service'][_0x4bc86d(0x17c)](_0x1d992d[_0x4bc86d(0x222)]),console[_0x4bc86d(0x1f1)](_0x4bc86d(0x179)+_0x1d992d['id']+_0x4bc86d(0x267)+_0x4d46d7[_0x4bc86d(0x229)])):(_0x4d46d7=await this[_0x4bc86d(0x24e)][_0x4bc86d(0x17c)](_0x1d992d[_0x4bc86d(0x222)]),console[_0x4bc86d(0x1f1)](_0x4bc86d(0x226)+_0x1d992d['id']+_0x4bc86d(0x267)+_0x4d46d7[_0x4bc86d(0x229)]));_0x4d46d7[_0x4bc86d(0x225)]&&console['log'](_0x4bc86d(0x1c8)+_0x1d992d['id']+_0x4bc86d(0x24b),{'iban':_0x4d46d7[_0x4bc86d(0x225)][_0x4bc86d(0x20d)]||_0x4bc86d(0x285),'transactionId':_0x4d46d7['paymentDetails'][_0x4bc86d(0x210)],'createdOn':_0x4d46d7[_0x4bc86d(0x225)]['createdOn'],'confirmedOn':_0x4d46d7['paymentDetails'][_0x4bc86d(0x243)]||_0x4bc86d(0x269)});if(_0x4d46d7[_0x4bc86d(0x229)]!==_0x1d992d[_0x4bc86d(0x229)]){console['log']('üîÑ\x20[CHECK]\x20Updating\x20payment\x20'+_0x1d992d['id']+'\x20status\x20from\x20'+_0x1d992d[_0x4bc86d(0x229)]+_0x4bc86d(0x218)+_0x4d46d7[_0x4bc86d(0x229)]),this[_0x4bc86d(0x23c)](_0x1d992d['id'],_0x1d992d[_0x4bc86d(0x222)],_0x1d992d['status'],_0x4d46d7['status'],_0x4bc86d(0x265),{'paymentDetails':_0x4d46d7['paymentDetails'],'amount':_0x4d46d7[_0x4bc86d(0x26a)],'currency':_0x4d46d7[_0x4bc86d(0x1ba)],'shopId':_0x1d992d[_0x4bc86d(0x199)],'checkTimestamp':new Date()[_0x4bc86d(0x22b)]()});const _0x430ac5={'status':_0x4d46d7[_0x4bc86d(0x229)],'updatedAt':new Date()};if(_0x4d46d7[_0x4bc86d(0x229)]===_0x4bc86d(0x190)&&_0x1d992d['status']!==_0x4bc86d(0x190)){_0x430ac5[_0x4bc86d(0x228)]=new Date();if(!_0x1d992d[_0x4bc86d(0x224)]){const _0x1a2010=await currencyService_1[_0x4bc86d(0x1cb)][_0x4bc86d(0x241)](_0x1d992d['amount'],_0x1d992d[_0x4bc86d(0x1ba)]);_0x430ac5[_0x4bc86d(0x224)]=_0x1a2010;const _0x3f86a5=await this[_0x4bc86d(0x1ff)](_0x1d992d['shopId'],_0x1d992d[_0x4bc86d(0x22d)]),_0x22cb63=_0x1a2010*(0x1-_0x3f86a5/0x64);_0x430ac5[_0x4bc86d(0x1d8)]=_0x22cb63,_0x430ac5['gatewayCommissionRate']=_0x3f86a5,console[_0x4bc86d(0x1f1)]('üí∞\x20[CHECK]\x20Payment\x20'+_0x1d992d['id']+_0x4bc86d(0x270)),console[_0x4bc86d(0x1f1)](_0x4bc86d(0x1f6)+_0x1d992d[_0x4bc86d(0x26a)]+'\x20'+_0x1d992d['currency']+_0x4bc86d(0x175)+_0x1a2010[_0x4bc86d(0x17e)](0x6)+_0x4bc86d(0x1dd)),console[_0x4bc86d(0x1f1)](_0x4bc86d(0x205)+_0x1d992d['gateway']+_0x4bc86d(0x1d3)+_0x3f86a5+'%'),console['log'](_0x4bc86d(0x18e)+_0x22cb63[_0x4bc86d(0x17e)](0x6)+'\x20USDT');}console[_0x4bc86d(0x1f1)](_0x4bc86d(0x1fa)+_0x1d992d['id']+_0x4bc86d(0x26b)+_0x430ac5[_0x4bc86d(0x228)]['toISOString']());}if(_0x4d46d7['paymentDetails']){const _0x4e0687=_0x4d46d7[_0x4bc86d(0x225)];_0x4e0687[_0x4bc86d(0x20d)]&&(_0x430ac5[_0x4bc86d(0x271)]=_0x4e0687[_0x4bc86d(0x20d)],console[_0x4bc86d(0x1f1)]('üè¶\x20[CHECK]\x20Saved\x20IBAN:\x20'+_0x4e0687[_0x4bc86d(0x20d)]));if(_0x4e0687[_0x4bc86d(0x19a)]){const _0xe72bd6=_0x1d992d['adminNotes']||'',_0x41812c=_0x4bc86d(0x207)+_0x4e0687[_0x4bc86d(0x19a)];_0x430ac5['adminNotes']=_0xe72bd6?_0xe72bd6+'\x0a\x0a'+_0x41812c:_0x41812c,console[_0x4bc86d(0x1f1)](_0x4bc86d(0x1b8));}_0x4e0687[_0x4bc86d(0x210)]&&console[_0x4bc86d(0x1f1)](_0x4bc86d(0x26c)+_0x4e0687['transactionId']),_0x4e0687[_0x4bc86d(0x243)]&&console[_0x4bc86d(0x1f1)](_0x4bc86d(0x1ef)+_0x4e0687['confirmedOn']);}await database_1['default'][_0x4bc86d(0x180)][_0x4bc86d(0x1e7)]({'where':{'id':_0x1d992d['id']},'data':_0x430ac5});if(_0x4d46d7[_0x4bc86d(0x229)]===_0x4bc86d(0x190)&&_0x1d992d[_0x4bc86d(0x229)]!==_0x4bc86d(0x190)){console[_0x4bc86d(0x1f1)](_0x4bc86d(0x1c2)+_0x1d992d['id']+_0x4bc86d(0x197));const _0x428e35=await database_1['default'][_0x4bc86d(0x180)][_0x4bc86d(0x1fb)]({'where':{'id':_0x1d992d['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x428e35?.['paymentLinkId']&&_0x428e35[_0x4bc86d(0x21a)])try{const _0xbd7fa1=_0x428e35[_0x4bc86d(0x21a)];console[_0x4bc86d(0x1f1)]('üìà\x20[COINTOPAY]\x20Found\x20payment\x20link\x20'+_0xbd7fa1['id']+_0x4bc86d(0x281)+_0xbd7fa1[_0x4bc86d(0x1fe)]+_0x4bc86d(0x19b)+_0xbd7fa1[_0x4bc86d(0x174)]+',\x20status='+_0xbd7fa1['status']);const _0x1d62a8=_0xbd7fa1[_0x4bc86d(0x174)]+0x1,_0x139f9e=_0xbd7fa1[_0x4bc86d(0x1fe)]===_0x4bc86d(0x191)?_0x4bc86d(0x221):_0xbd7fa1[_0x4bc86d(0x229)];await database_1['default']['paymentLink']['update']({'where':{'id':_0xbd7fa1['id']},'data':{'currentPayments':_0x1d62a8,'status':_0x139f9e,'updatedAt':new Date()}}),console['log'](_0x4bc86d(0x247)+_0xbd7fa1['id']+_0x4bc86d(0x1e0)+_0xbd7fa1['currentPayments']+_0x4bc86d(0x175)+_0x1d62a8+_0x4bc86d(0x24d)+_0xbd7fa1['status']+_0x4bc86d(0x175)+_0x139f9e);}catch(_0x4c770e){console['error'](_0x4bc86d(0x20e),_0x4c770e);}else console[_0x4bc86d(0x1f1)](_0x4bc86d(0x1c2)+_0x1d992d['id']+'\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link');}await database_1[_0x4bc86d(0x1d5)][_0x4bc86d(0x1b6)][_0x4bc86d(0x1ea)]({'data':{'paymentId':_0x1d992d['id'],'shopId':_0x1d992d['shopId'],'event':_0x4bc86d(0x209)+_0x4d46d7[_0x4bc86d(0x229)][_0x4bc86d(0x19c)](),'statusCode':0xc8,'responseBody':JSON[_0x4bc86d(0x1ad)]({'oldStatus':_0x1d992d[_0x4bc86d(0x229)],'newStatus':_0x4d46d7[_0x4bc86d(0x229)],'paymentDetails':_0x4d46d7[_0x4bc86d(0x225)],'checkedAt':new Date()['toISOString']()})}}),await this[_0x4bc86d(0x1bd)](_0x1d992d,_0x4d46d7['status']),await this[_0x4bc86d(0x284)](_0x1d992d,_0x4d46d7[_0x4bc86d(0x229)]),_0x4d46d7[_0x4bc86d(0x229)]!==_0x4bc86d(0x28b)&&(console[_0x4bc86d(0x1f1)]('üßπ\x20[CHECK]\x20Payment\x20'+_0x1d992d['id']+'\x20status\x20changed\x20to\x20'+_0x4d46d7[_0x4bc86d(0x229)]+_0x4bc86d(0x287)),this[_0x4bc86d(0x23a)](_0x1d992d['id'])),console[_0x4bc86d(0x1f1)](_0x4bc86d(0x1e2)+_0x1d992d['id']+_0x4bc86d(0x25e));}else console[_0x4bc86d(0x1f1)](_0x4bc86d(0x1c8)+_0x1d992d['id']+_0x4bc86d(0x1ec)+_0x4d46d7[_0x4bc86d(0x229)]+')'),this[_0x4bc86d(0x23c)](_0x1d992d['id'],_0x1d992d[_0x4bc86d(0x222)],_0x1d992d[_0x4bc86d(0x229)],_0x4d46d7[_0x4bc86d(0x229)],'status_check',{'statusUnchanged':!![],'paymentDetails':_0x4d46d7[_0x4bc86d(0x225)],'amount':_0x4d46d7[_0x4bc86d(0x26a)],'currency':_0x4d46d7['currency'],'shopId':_0x1d992d[_0x4bc86d(0x199)],'checkTimestamp':new Date()['toISOString']()});}catch(_0x2c0874){console[_0x4bc86d(0x185)]('‚ùå\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20'+_0x1d992d['id']+':',_0x2c0874),this['logCoinToPayError'](_0x1d992d['id'],_0x1d992d['gatewayPaymentId'],_0x2c0874,_0x4bc86d(0x265),{'paymentAmount':_0x1d992d[_0x4bc86d(0x26a)],'paymentCurrency':_0x1d992d[_0x4bc86d(0x1ba)],'shopId':_0x1d992d['shopId'],'createdAt':_0x1d992d[_0x4bc86d(0x235)]}),await database_1[_0x4bc86d(0x1d5)][_0x4bc86d(0x1b6)][_0x4bc86d(0x1ea)]({'data':{'paymentId':_0x1d992d['id'],'shopId':_0x1d992d[_0x4bc86d(0x199)],'event':'cointopay_status_check_error','statusCode':0x1f4,'responseBody':JSON[_0x4bc86d(0x1ad)]({'error':_0x2c0874 instanceof Error?_0x2c0874[_0x4bc86d(0x1c3)]:_0x4bc86d(0x1c1),'gatewayPaymentId':_0x1d992d[_0x4bc86d(0x222)],'checkedAt':new Date()[_0x4bc86d(0x22b)]()})}});}}async[a40_0x18552b(0x1bd)](_0x249d14,_0x40320f){const _0xe9737b=a40_0x18552b,_0x3ffd36=Date[_0xe9737b(0x256)]();try{const _0x4b9697=_0x249d14['shop'],_0x168a1e=_0x4b9697[_0xe9737b(0x27f)];if(!_0x168a1e?.[_0xe9737b(0x18d)]){console[_0xe9737b(0x1f1)](_0xe9737b(0x19d)+_0x4b9697['id']);return;}const _0x14459b=_0x40320f===_0xe9737b(0x190)?_0xe9737b(0x22f):_0x40320f===_0xe9737b(0x17a)?_0xe9737b(0x200):_0x40320f===_0xe9737b(0x26e)?_0xe9737b(0x200):_0xe9737b(0x1e9);if(!_0x168a1e[_0xe9737b(0x239)]?.['includes'](_0x14459b)){console[_0xe9737b(0x1f1)](_0xe9737b(0x261)+_0x14459b+_0xe9737b(0x1ac)+_0x4b9697['id']);return;}const _0x25f4df=(0x0,gateway_1[_0xe9737b(0x18c)])(_0x249d14[_0xe9737b(0x22d)])||_0x249d14[_0xe9737b(0x22d)],_0x41e269={'event':_0x14459b,'payment':{'id':_0x249d14['id'],'order_id':_0x249d14[_0xe9737b(0x203)],'gateway_order_id':_0x249d14['gatewayOrderId'],'gateway':_0x25f4df,'amount':_0x249d14[_0xe9737b(0x26a)],'currency':_0x249d14[_0xe9737b(0x1ba)],'status':_0x40320f[_0xe9737b(0x19c)](),'customer_email':_0x249d14[_0xe9737b(0x27e)],'customer_name':_0x249d14[_0xe9737b(0x188)],'created_at':_0x249d14[_0xe9737b(0x235)],'updated_at':new Date()}},_0x56f574=await fetch(_0x168a1e['webhookUrl'],{'method':'POST','headers':{'Content-Type':_0xe9737b(0x1c5),'User-Agent':'Payment\x20System/1.0'},'body':JSON[_0xe9737b(0x1ad)](_0x41e269)}),_0x40cabc=Date['now']()-_0x3ffd36,_0x2713ca=_0x56f574['ok']?_0xe9737b(0x18f):await _0x56f574[_0xe9737b(0x25d)]();loggerService_1[_0xe9737b(0x25f)][_0xe9737b(0x23b)](_0x249d14['shopId'],_0x168a1e[_0xe9737b(0x18d)],_0x14459b,_0x56f574[_0xe9737b(0x229)],_0x40cabc,_0x41e269),console[_0xe9737b(0x1f1)](_0xe9737b(0x253)+_0x168a1e['webhookUrl']+_0xe9737b(0x1f0)+_0x56f574[_0xe9737b(0x229)]+'\x20('+_0x40cabc+_0xe9737b(0x1d0));}catch(_0x1366b1){console[_0xe9737b(0x185)]('Failed\x20to\x20send\x20shop\x20webhook:',_0x1366b1),loggerService_1[_0xe9737b(0x25f)][_0xe9737b(0x289)](_0x249d14['shopId'],_0x249d14[_0xe9737b(0x1e8)]?.[_0xe9737b(0x27f)]?.[_0xe9737b(0x18d)]||_0xe9737b(0x1c0),'webhook_send',_0x1366b1,{});}}async[a40_0x18552b(0x284)](_0x1ba4a8,_0x36a22b){const _0x18fb8c=a40_0x18552b;try{const _0x35443e={'PENDING':'created','PAID':_0x18fb8c(0x1b4),'FAILED':_0x18fb8c(0x178),'EXPIRED':'expired'},_0x215fa1=_0x35443e[_0x36a22b];if(!_0x215fa1||_0x215fa1===_0x18fb8c(0x201))return;await telegramBotService_1[_0x18fb8c(0x1df)][_0x18fb8c(0x1be)](_0x1ba4a8[_0x18fb8c(0x199)],_0x1ba4a8,_0x215fa1);}catch(_0x389a53){console[_0x18fb8c(0x185)](_0x18fb8c(0x18b),_0x389a53);}}async[a40_0x18552b(0x1e6)](_0x160b5c){const _0x5c0849=a40_0x18552b;console[_0x5c0849(0x1f1)]('üîç\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20'+_0x160b5c);const _0x256ecf=await database_1[_0x5c0849(0x1d5)][_0x5c0849(0x180)][_0x5c0849(0x1fb)]({'where':{'id':_0x160b5c},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x256ecf)throw new Error(_0x5c0849(0x27a));if(_0x256ecf[_0x5c0849(0x22d)]!==_0x5c0849(0x1c7)&&_0x256ecf[_0x5c0849(0x22d)]!==_0x5c0849(0x28a))throw new Error(_0x5c0849(0x22c));console[_0x5c0849(0x1f1)](_0x5c0849(0x1f9)+_0x256ecf['gateway']+_0x5c0849(0x1b3)+_0x160b5c),await this[_0x5c0849(0x1d9)](_0x256ecf),console[_0x5c0849(0x1f1)]('‚úÖ\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20'+_0x160b5c);}[a40_0x18552b(0x214)](){const _0x44f025=a40_0x18552b,_0x4b7f42=this[_0x44f025(0x17d)]?this[_0x44f025(0x27b)]:undefined,_0x18b10e=Array[_0x44f025(0x1cc)](this[_0x44f025(0x25a)]['values']())[_0x44f025(0x21e)](_0x55716e=>({'paymentId':_0x55716e[_0x44f025(0x234)],'gatewayPaymentId':_0x55716e['gatewayPaymentId'],'createdAt':_0x55716e[_0x44f025(0x235)],'timersCount':_0x55716e['timers']['length']}));return{'isActive':!!this[_0x44f025(0x17d)],'globalCheckIntervalMinutes':this[_0x44f025(0x27b)]/(0x3e8*0x3c),'expiryDays':this['EXPIRY_DAYS'],'activeIndividualTimers':this[_0x44f025(0x25a)]['size'],'nextGlobalCheckIn':_0x4b7f42,'paymentTimersDetails':_0x18b10e};}['getPaymentTimerInfo'](_0x5e53e9){const _0x9bf975=a40_0x18552b,_0x44479d=this[_0x9bf975(0x25a)]['get'](_0x5e53e9);if(_0x44479d)return{'hasTimers':!![],'timersCount':_0x44479d[_0x9bf975(0x1a1)][_0x9bf975(0x1b1)],'createdAt':_0x44479d['createdAt'],'gatewayPaymentId':_0x44479d[_0x9bf975(0x222)]};return{'hasTimers':![]};}async[a40_0x18552b(0x1ff)](_0x330550,_0x110a26){const _0x265594=a40_0x18552b;try{const _0x31bab8=await database_1[_0x265594(0x1d5)]['shop'][_0x265594(0x1fb)]({'where':{'id':_0x330550},'select':{'gatewaySettings':!![]}});if(!_0x31bab8?.[_0x265594(0x1dc)])return console[_0x265594(0x1f1)](_0x265594(0x278)+_0x330550+_0x265594(0x183)),0xa;const _0x3e8898=JSON[_0x265594(0x19f)](_0x31bab8[_0x265594(0x1dc)]);for(const [_0x1b23d4,_0x2a38f3]of Object[_0x265594(0x282)](_0x3e8898)){if(_0x1b23d4['toLowerCase']()===_0x110a26[_0x265594(0x19c)]()){const _0x286729=_0x2a38f3['commission']||0xa;return console['log'](_0x265594(0x1b5)+_0x110a26+_0x265594(0x1a6)+_0x330550+':\x20'+_0x286729+'%'),_0x286729;}}return console[_0x265594(0x1f1)](_0x265594(0x187)+_0x110a26+_0x265594(0x258)+_0x330550+',\x20using\x20default\x2010%'),0xa;}catch(_0x37243a){return console[_0x265594(0x185)](_0x265594(0x1f2)+_0x330550+',\x20gateway\x20'+_0x110a26+':',_0x37243a),0xa;}}}exports['CoinToPayStatusService']=CoinToPayStatusService,exports[a40_0x18552b(0x268)]=new CoinToPayStatusService();