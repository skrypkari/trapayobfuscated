'use strict';function a38_0xeb5c(){const _0x489162=['\x20(after\x20','ü™ô\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','ü™ô\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','payment','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','gateway','\x20days,\x20marking\x20as\x20EXPIRED','üßπ\x20[DEBUG]\x20Clearing\x20','toFixed','application/json','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','ü™ô\x20[TIMER]\x20Individual\x20check\x20#','clearPaymentTimers','Unknown\x20error','paymentLink','not\x20confirmed','\x20not\x20enabled\x20for\x20shop\x20','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','ü™ô\x20[DEBUG]\x20Creating\x20','message','stringify','üîç\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','\x20not\x20found\x20in\x20database','\x20\x20\x20‚ùå\x20Error:\x20','Automatically\x20expired\x20after\x20','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','4712rAOZXM','\x20in\x20','checkSinglePaymentById','sendPaymentStatusNotification','‚úÖ\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','\x20updated:\x20currentPayments=','transactionId','Gateway\x20','Payment\x20not\x20found','‚úÖ\x20[EXPIRY]\x20Payment\x20','2243681UnFSsO','ü™ô\x20[ERROR]\x20CoinToPay\x20Error:\x20','paymentTimers','‚è∞\x20[HOURLY]\x20Payment\x20','\x20status\x20from\x20','/status/',',\x20using\x20default\x20commission\x2010%','COMPLETED','No\x20specific\x20commission\x20found\x20for\x20gateway\x20','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','\x20->\x20','üìä\x20[CHECK]\x20CoinToPay\x20payment\x20','\x20\x20\x20-\x20ShopId:\x20','COINTOPAY_STATUS_CHANGE','amount',',\x20clearing\x20individual\x20timers','schedule_created','‚úÖ\x20[HOURLY]\x20Payment\x20','ü™ô\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','confirmedOn','CoinToPay2Service','checkExpiredPayments','\x20to\x20clear','\x20status\x20is\x20','create','FAILED','delay','status','getGatewayCommission','\x20\x20\x20üìù\x20Details:','cointopay2','üìä\x20[CHECK]\x20Payment\x20','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','../config/database','paidAt','491966afODzL','length','‚è∞\x20[GLOBAL]\x20Payment\x20','‚úÖ\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','\x20has\x20no\x20gatewayPaymentId','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','orderId','currencyService','‚ùå\x20[CHECK]\x20Payment\x20','‚ùå\x20[TIMER]\x20Failed\x20individual\x20check\x20#','\x20\x20\x20-\x20Status:\x20','get','customerName','PENDING','cointopay_status_check_error','3akocVO','globalCheckInterval','map','currency','default','checkPaymentById','CoinToPayStatusService','5\x20minutes','‚úÖ\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','54LHiYFb','\x20status:\x20','size','loggerService','getTime','\x20individual\x20payment\x20timers','description','sendPaymentNotification','timers','CoinToPayService','POST','set','üîÑ\x20[CHECK]\x20Updating\x20payment\x20','\x20\x20\x20üìÖ\x20Time:\x20','findUnique','üìà\x20[COINTOPAY]\x20Payment\x20','\x20not\x20found,\x20clearing\x20timers','\x20payment\x20','./gateways/coinToPayService','amountAfterGatewayCommissionUSDT','payment.success','status_check','Failed\x20to\x20mark\x20payment\x20as\x20expired','amountUSDT','\x20\x20\x20-\x20paymentId:\x20','üîç\x20[CHECK]\x20Checking\x20','paid','‚ùå\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','‚úÖ\x20[TIMER]\x20Individual\x20check\x20#','\x20skipped,\x20',':\x20type=','getPaymentTimerInfo','cointopay_auto_expired','__importDefault','h),\x20skipping\x20global\x20check','üí∞\x20[CHECK]\x20Payment\x20','\x20commission:\x20','üìä\x20[CHECK]\x20CoinToPay2\x20payment\x20','\x20days\x20without\x20payment\x20confirmation','Failed\x20to\x20send\x20shop\x20webhook:','sendShopWebhook','auto_expire','timestamp','\x20found:','logShopWebhookError','bankDetails','\x20is\x20too\x20new\x20(','‚ùå\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','\x20expired','checkPaymentStatus','üõë\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','\x20has\x20no\x20gatewayPaymentId,\x20skipping','GLOBAL_CHECK_INTERVAL_MS','\x20is\x20older\x20than\x20','‚ö†Ô∏è\x20[CHECK]\x20Payment\x20','üõë\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','coinToPayService','143456ZUGVGP','‚úÖ\x20[COINTOPAY]\x20Payment\x20link\x20','‚úÖ\x20[CHECK]\x20Payment\x20','currentPayments','\x20for\x20payment\x20','./telegramBotService','\x20in\x20shop\x20','üßπ\x20[DEBUG]\x20Cleared\x20timer\x20#','payment.failed','‚úÖ\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','SINGLE','unknown','failed','catch','ms)','forEach','shopId',',\x20currentPayments=','webhookLog','error','webhook_send','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','log','adminNotes','‚è∞\x20[DEBUG]\x20Scheduled\x20check\x20#','setDate','\x20status\x20unchanged\x20(','üÜî\x20[CHECK]\x20Transaction\x20ID:\x20','‚è∞\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','PAID',',\x20gateway\x20','EXPIRED','COINTOPAY_ERROR','toISOString','includes','defineProperty','iban','coinToPay2Service','commission','gatewaySettings','telegramBotService','\x20with\x20status\x20','\x20(age:\x20','‚è∞\x20[EXPIRY]\x20Payment\x20','has','\x20status\x20changed\x20to\x20','expired','1535kTMlem','cointopay_status_check_','checkSinglePayment','toLowerCase','2\x20minutes','logCoinToPayStatus','\x20\x20\x20-\x20Gateway:\x20','remitterIban','logCoinToPayError','Webhook\x20event\x20','‚úÖ\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20',',\x20using\x20default\x2010%','\x20\x20\x20-\x20gatewayPaymentId:\x20','logShopWebhookSent','paymentDetails','üìä\x20[HOURLY]\x20Payment\x20','\x20days','\x20triggered\x20for\x20payment\x20','3709554soAdpP','not\x20found','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','gatewayPaymentId','delete','30JCpLzv','cointopay','stack','1\x20minute','ü™ô\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','\x20\x20\x20Amount:\x20','Success','4772824snrjZh','__esModule',',\x20stopping\x20individual\x20checks','floor','Payment\x20older\x20than\x20','payment.pending','üè¶\x20[CHECK]\x20Saved\x20IBAN:\x20','ü™ô\x20[GLOBAL]\x20Found\x20','\x20seconds\x20(','push','-day\x20timeout',',\x20status=','üõë\x20[SHUTDOWN]\x20Cleared\x20','üîç\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','parse','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','\x20\x20\x20Gateway\x20','coinToPayStatusService','\x20details:','webhookUrl','.\x20Remaining\x20active\x20timers:\x20','checkAllPendingPayments','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','‚ùå\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','created','startPeriodicStatusCheck','settings','../types/gateway','\x20expired\x20CoinToPay\x20payments','values','createdAt','\x20\x20\x20üìç\x20Source:\x20','getGatewayIdByName','shop','now','type','1169726qdDFFO','\x20updated\x20successfully','EXPIRY_DAYS','\x20marked\x20as\x20paid\x20at:\x20','\x20USDT','\x20is\x20valid\x20for\x20checking,\x20proceeding...','\x20timers\x20for\x20payment\x20','\x20completed\x20for\x20payment\x20','ü™ô\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','text','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','‚è∞\x20[GLOBAL]\x20Found\x20','‚ö†Ô∏è\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','update','üìà\x20[COINTOPAY]\x20Found\x20payment\x20link\x20'];a38_0xeb5c=function(){return _0x489162;};return a38_0xeb5c();}const a38_0x4bbf78=a38_0x593a;(function(_0x54eb99,_0x6c68b8){const _0x59f37c=a38_0x593a,_0x5d5a24=_0x54eb99();while(!![]){try{const _0x1d2696=-parseInt(_0x59f37c(0x247))/0x1+-parseInt(_0x59f37c(0x1f1))/0x2*(parseInt(_0x59f37c(0x256))/0x3)+-parseInt(_0x59f37c(0x21a))/0x4*(parseInt(_0x59f37c(0x1af))/0x5)+parseInt(_0x59f37c(0x1c1))/0x6+parseInt(_0x59f37c(0x1cd))/0x7+-parseInt(_0x59f37c(0x180))/0x8*(-parseInt(_0x59f37c(0x25f))/0x9)+-parseInt(_0x59f37c(0x1c6))/0xa*(-parseInt(_0x59f37c(0x224))/0xb);if(_0x1d2696===_0x6c68b8)break;else _0x5d5a24['push'](_0x5d5a24['shift']());}catch(_0x248dd5){_0x5d5a24['push'](_0x5d5a24['shift']());}}}(a38_0xeb5c,0x8de01));function a38_0x593a(_0x4514cc,_0x478c7f){const _0xeb5c1a=a38_0xeb5c();return a38_0x593a=function(_0x593add,_0x355d1b){_0x593add=_0x593add-0x14c;let _0x187648=_0xeb5c1a[_0x593add];return _0x187648;},a38_0x593a(_0x4514cc,_0x478c7f);}var __importDefault=this&&this[a38_0x4bbf78(0x168)]||function(_0x1c6cde){const _0x47ceb0=a38_0x4bbf78;return _0x1c6cde&&_0x1c6cde[_0x47ceb0(0x1ce)]?_0x1c6cde:{'default':_0x1c6cde};};Object[a38_0x4bbf78(0x1a3)](exports,'__esModule',{'value':!![]}),exports[a38_0x4bbf78(0x1de)]=exports[a38_0x4bbf78(0x25c)]=void 0x0;const coinToPayService_1=require(a38_0x4bbf78(0x159)),coinToPay2Service_1=require('./gateways/coinToPay2Service'),gateway_1=require(a38_0x4bbf78(0x1e8)),database_1=__importDefault(require(a38_0x4bbf78(0x245))),telegramBotService_1=require(a38_0x4bbf78(0x185)),loggerService_1=require('./loggerService'),currencyService_1=require('./currencyService');class CoinToPayStatusService{constructor(){const _0x4efa01=a38_0x4bbf78;this[_0x4efa01(0x257)]=null,this[_0x4efa01(0x17b)]=0x3c*0x3c*0x3e8,this[_0x4efa01(0x1f3)]=0x5,this['paymentTimers']=new Map(),this[_0x4efa01(0x17f)]=new coinToPayService_1[(_0x4efa01(0x150))](),this[_0x4efa01(0x1a5)]=new coinToPay2Service_1[(_0x4efa01(0x238))](),console[_0x4efa01(0x196)](_0x4efa01(0x236));}['schedulePaymentChecks'](_0x3dea96,_0x29cff4){const _0x4aaa15=a38_0x4bbf78;console[_0x4aaa15(0x196)](_0x4aaa15(0x1ca)),console[_0x4aaa15(0x196)](_0x4aaa15(0x15f)+_0x3dea96),console['log'](_0x4aaa15(0x1bb)+_0x29cff4),this[_0x4aaa15(0x20c)](_0x3dea96);const _0x436fe6=[],_0x42e40d=new Date(),_0x4204c5=[{'delay':0x1*0x3c*0x3e8,'description':_0x4aaa15(0x1c9)},{'delay':0x2*0x3c*0x3e8,'description':_0x4aaa15(0x1b3)},{'delay':0x5*0x3c*0x3e8,'description':_0x4aaa15(0x25d)},{'delay':0x5*0x3c*0x3e8,'description':_0x4aaa15(0x25d)}];console[_0x4aaa15(0x196)](_0x4aaa15(0x212)+_0x4204c5['length']+'\x20initial\x20timers\x20for\x20payment\x20'+_0x3dea96);let _0x32f5d0=0x0;_0x4204c5[_0x4aaa15(0x18f)]((_0x4eab05,_0x264032)=>{const _0x38daa3=_0x4aaa15;_0x32f5d0+=_0x4eab05[_0x38daa3(0x23e)];const _0x129c47=setTimeout(async()=>{const _0x317220=_0x38daa3;console['log'](_0x317220(0x20b)+(_0x264032+0x1)+_0x317220(0x1c0)+_0x3dea96+_0x317220(0x200)+_0x4eab05[_0x317220(0x14d)]+')');try{await this['checkSinglePaymentById'](_0x3dea96),console[_0x317220(0x196)](_0x317220(0x163)+(_0x264032+0x1)+_0x317220(0x1f8)+_0x3dea96);}catch(_0x5e2712){console[_0x317220(0x193)](_0x317220(0x250)+(_0x264032+0x1)+'\x20for\x20payment\x20'+_0x3dea96+':',_0x5e2712),this['logCoinToPayError'](_0x3dea96,_0x29cff4,_0x5e2712,_0x317220(0x15c),{'checkNumber':_0x264032+0x1,'scheduledAfter':_0x4eab05['description'],'isIndividualCheck':!![]});}},_0x32f5d0);_0x436fe6[_0x38daa3(0x1d6)](_0x129c47),console[_0x38daa3(0x196)](_0x38daa3(0x198)+(_0x264032+0x1)+_0x38daa3(0x184)+_0x3dea96+_0x38daa3(0x21b)+_0x32f5d0/0x3e8+_0x38daa3(0x1d5)+_0x4eab05['description']+')');});const _0x4bd6f8=setInterval(async()=>{const _0x43148a=_0x4aaa15;console[_0x43148a(0x196)]('ü™ô\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20'+_0x3dea96);try{const _0xbaba32=await database_1[_0x43148a(0x25a)]['payment'][_0x43148a(0x155)]({'where':{'id':_0x3dea96},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0xbaba32){console[_0x43148a(0x196)]('‚ùå\x20[HOURLY]\x20Payment\x20'+_0x3dea96+_0x43148a(0x157)),this[_0x43148a(0x20c)](_0x3dea96);return;}console[_0x43148a(0x196)](_0x43148a(0x1be)+_0x3dea96+'\x20current\x20status:\x20'+_0xbaba32[_0x43148a(0x23f)]);if(_0xbaba32['status']!==_0x43148a(0x254)){console[_0x43148a(0x196)](_0x43148a(0x235)+_0x3dea96+_0x43148a(0x23b)+_0xbaba32[_0x43148a(0x23f)]+_0x43148a(0x1cf)),this[_0x43148a(0x20c)](_0x3dea96);return;}const _0xba18cf=Math[_0x43148a(0x1d0)]((Date[_0x43148a(0x1ef)]()-_0xbaba32[_0x43148a(0x1eb)]['getTime']())/(0x3e8*0x3c*0x3c*0x18));if(_0xba18cf>=this[_0x43148a(0x1f3)]){console['log'](_0x43148a(0x227)+_0x3dea96+'\x20is\x20older\x20than\x20'+this[_0x43148a(0x1f3)]+'\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check'),this[_0x43148a(0x20c)](_0x3dea96);return;}await this[_0x43148a(0x21c)](_0x3dea96),console[_0x43148a(0x196)](_0x43148a(0x24a)+_0x3dea96);}catch(_0x41bcf4){console[_0x43148a(0x193)]('‚ùå\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20'+_0x3dea96+':',_0x41bcf4),this[_0x43148a(0x1b7)](_0x3dea96,_0x29cff4,_0x41bcf4,_0x43148a(0x15c),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x436fe6[_0x4aaa15(0x1d6)](_0x4bd6f8),this['paymentTimers'][_0x4aaa15(0x152)](_0x3dea96,{'timers':_0x436fe6,'paymentId':_0x3dea96,'gatewayPaymentId':_0x29cff4,'createdAt':_0x42e40d}),console[_0x4aaa15(0x196)]('‚úÖ\x20[DEBUG]\x20Successfully\x20scheduled\x20'+_0x4204c5['length']+'\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20'+_0x3dea96),console['log']('üìä\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20'+this[_0x4aaa15(0x226)][_0x4aaa15(0x261)]),this[_0x4aaa15(0x1b4)](_0x3dea96,_0x29cff4,_0x4aaa15(0x254),_0x4aaa15(0x254),_0x4aaa15(0x15c),{'action':_0x4aaa15(0x234),'scheduledChecks':_0x4204c5['length'],'firstCheckIn':_0x4204c5[0x0]['delay']/0x3e8,'totalTimers':this[_0x4aaa15(0x226)][_0x4aaa15(0x261)]});}[a38_0x4bbf78(0x20c)](_0x260551){const _0x30015b=a38_0x4bbf78,_0x5773e2=this[_0x30015b(0x226)][_0x30015b(0x252)](_0x260551);_0x5773e2?(console[_0x30015b(0x196)](_0x30015b(0x207)+_0x5773e2[_0x30015b(0x14f)]['length']+_0x30015b(0x1f7)+_0x260551),_0x5773e2[_0x30015b(0x14f)][_0x30015b(0x18f)]((_0x324800,_0x20d615)=>{const _0x365b09=_0x30015b;_0x324800&&(clearTimeout(_0x324800),clearInterval(_0x324800),console['log'](_0x365b09(0x187)+(_0x20d615+0x1)+_0x365b09(0x184)+_0x260551));}),this[_0x30015b(0x226)][_0x30015b(0x1c5)](_0x260551),console['log'](_0x30015b(0x1b9)+_0x260551+_0x30015b(0x1e1)+this[_0x30015b(0x226)][_0x30015b(0x261)])):console[_0x30015b(0x196)](_0x30015b(0x1fd)+_0x260551+_0x30015b(0x23a));}async['checkSinglePaymentById'](_0x178a94){const _0x4a7c33=a38_0x4bbf78;console['log']('üîç\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20'+_0x178a94);const _0x455af3=await database_1[_0x4a7c33(0x25a)][_0x4a7c33(0x203)]['findUnique']({'where':{'id':_0x178a94},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x455af3){console[_0x4a7c33(0x196)](_0x4a7c33(0x24f)+_0x178a94+_0x4a7c33(0x216));return;}console['log']('üìä\x20[CHECK]\x20Payment\x20'+_0x178a94+_0x4a7c33(0x172)),console[_0x4a7c33(0x196)](_0x4a7c33(0x1b5)+_0x455af3[_0x4a7c33(0x205)]),console[_0x4a7c33(0x196)](_0x4a7c33(0x251)+_0x455af3[_0x4a7c33(0x23f)]),console[_0x4a7c33(0x196)]('\x20\x20\x20-\x20GatewayPaymentId:\x20'+_0x455af3[_0x4a7c33(0x1c4)]),console[_0x4a7c33(0x196)]('\x20\x20\x20-\x20Amount:\x20'+_0x455af3[_0x4a7c33(0x232)]+'\x20'+_0x455af3[_0x4a7c33(0x259)]),console[_0x4a7c33(0x196)](_0x4a7c33(0x230)+_0x455af3['shopId']);if(_0x455af3['gateway']!==_0x4a7c33(0x1c7)&&_0x455af3['gateway']!=='cointopay2'){console[_0x4a7c33(0x196)]('‚ö†Ô∏è\x20[CHECK]\x20Payment\x20'+_0x178a94+_0x4a7c33(0x211)+_0x455af3[_0x4a7c33(0x205)]+')');return;}if(_0x455af3[_0x4a7c33(0x23f)]!==_0x4a7c33(0x254)){console[_0x4a7c33(0x196)](_0x4a7c33(0x17d)+_0x178a94+_0x4a7c33(0x23b)+_0x455af3['status']+_0x4a7c33(0x1cf)),this[_0x4a7c33(0x20c)](_0x178a94);return;}if(!_0x455af3['gatewayPaymentId']){console['log'](_0x4a7c33(0x17d)+_0x178a94+_0x4a7c33(0x24b));return;}console[_0x4a7c33(0x196)](_0x4a7c33(0x182)+_0x178a94+_0x4a7c33(0x1f6)),await this[_0x4a7c33(0x1b1)](_0x455af3);}['logCoinToPayStatus'](_0x457aaa,_0xb289c3,_0x18f52e,_0x22c867,_0x1c146f,_0x57985b){const _0x613c5a=a38_0x4bbf78,_0x457d66={'type':_0x613c5a(0x231),'paymentId':_0x457aaa,'gatewayPaymentId':_0xb289c3,'oldStatus':_0x18f52e,'newStatus':_0x22c867,'source':_0x1c146f,'timestamp':new Date()[_0x613c5a(0x1a1)](),'details':_0x57985b||{}};loggerService_1[_0x613c5a(0x262)]['logCoinToPayStatus'](_0x457d66),console[_0x613c5a(0x196)]('ü™ô\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20'+_0x457aaa+'\x20('+_0xb289c3+')'),console[_0x613c5a(0x196)]('\x20\x20\x20üìä\x20Status:\x20'+_0x18f52e+_0x613c5a(0x22e)+_0x22c867),console[_0x613c5a(0x196)](_0x613c5a(0x1ec)+_0x1c146f),console['log']('\x20\x20\x20üìÖ\x20Time:\x20'+_0x457d66['timestamp']),_0x57985b&&console[_0x613c5a(0x196)](_0x613c5a(0x241),_0x57985b);}[a38_0x4bbf78(0x1b7)](_0x3fb988,_0x5a467c,_0x2e3bff,_0x1fe54e,_0x2980ae){const _0x168230=a38_0x4bbf78,_0x5bbd50={'type':_0x168230(0x1a0),'paymentId':_0x3fb988,'gatewayPaymentId':_0x5a467c,'error':_0x2e3bff instanceof Error?{'message':_0x2e3bff['message'],'stack':_0x2e3bff[_0x168230(0x1c8)]}:_0x2e3bff,'source':_0x1fe54e,'timestamp':new Date()['toISOString'](),'context':_0x2980ae||{}};loggerService_1[_0x168230(0x262)][_0x168230(0x1b7)](_0x5bbd50),console[_0x168230(0x193)](_0x168230(0x225)+_0x3fb988+'\x20('+_0x5a467c+')'),console[_0x168230(0x193)](_0x168230(0x217)+(_0x2e3bff instanceof Error?_0x2e3bff[_0x168230(0x213)]:_0x2e3bff)),console[_0x168230(0x193)](_0x168230(0x1ec)+_0x1fe54e),console[_0x168230(0x193)](_0x168230(0x154)+_0x5bbd50[_0x168230(0x171)]),_0x2980ae&&console[_0x168230(0x193)]('\x20\x20\x20üìù\x20Context:',_0x2980ae);}[a38_0x4bbf78(0x1e6)](){const _0x50a171=a38_0x4bbf78;console['log'](_0x50a171(0x1f9)),this[_0x50a171(0x1e2)]()[_0x50a171(0x18d)](_0x6901e3=>{const _0xc1abfd=_0x50a171;console[_0xc1abfd(0x193)]('‚ùå\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:',_0x6901e3);}),this[_0x50a171(0x257)]=setInterval(async()=>{const _0x5aa61f=_0x50a171;try{console[_0x5aa61f(0x196)]('ü™ô\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...'),await this[_0x5aa61f(0x1e2)](),console['log'](_0x5aa61f(0x244));}catch(_0x2a9c6e){console[_0x5aa61f(0x193)](_0x5aa61f(0x1e4),_0x2a9c6e);}},this[_0x50a171(0x17b)]),console['log'](_0x50a171(0x189));}['stopPeriodicStatusCheck'](){const _0x4b105e=a38_0x4bbf78;console[_0x4b105e(0x196)](_0x4b105e(0x17e));this[_0x4b105e(0x257)]&&(clearInterval(this[_0x4b105e(0x257)]),this[_0x4b105e(0x257)]=null,console[_0x4b105e(0x196)](_0x4b105e(0x179)));const _0x3d8fed=this[_0x4b105e(0x226)][_0x4b105e(0x261)];for(const [_0x2aa26c]of this['paymentTimers']){this[_0x4b105e(0x20c)](_0x2aa26c);}console['log'](_0x4b105e(0x1d9)+_0x3d8fed+_0x4b105e(0x14c));}async[a38_0x4bbf78(0x1e2)](){const _0x14e773=a38_0x4bbf78;try{console[_0x14e773(0x196)](_0x14e773(0x202));const _0x226736=await database_1[_0x14e773(0x25a)][_0x14e773(0x203)]['findMany']({'where':{'gateway':{'in':[_0x14e773(0x1c7),_0x14e773(0x242)]},'status':_0x14e773(0x254),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x14e773(0x196)](_0x14e773(0x1d4)+_0x226736['length']+'\x20pending\x20CoinToPay\x20payments');if(_0x226736[_0x14e773(0x248)]===0x0){console['log'](_0x14e773(0x201));return;}const _0x1b0079=await this['checkExpiredPayments'](_0x226736);console[_0x14e773(0x196)](_0x14e773(0x1fc)+_0x1b0079[_0x14e773(0x248)]+_0x14e773(0x1e9));let _0x22dca9=0x0,_0x52c34c=0x0;for(const _0x65774d of _0x226736){try{if(_0x1b0079[_0x14e773(0x1a2)](_0x65774d['id'])){console[_0x14e773(0x196)](_0x14e773(0x249)+_0x65774d['id']+_0x14e773(0x195)),_0x52c34c++;continue;}if(this[_0x14e773(0x226)][_0x14e773(0x1ac)](_0x65774d['id'])){console['log'](_0x14e773(0x249)+_0x65774d['id']+_0x14e773(0x1dc)),_0x52c34c++;continue;}const _0x4bfe10=(Date[_0x14e773(0x1ef)]()-_0x65774d[_0x14e773(0x1eb)]['getTime']())/(0x3e8*0x3c*0x3c);if(_0x4bfe10<0x1){console[_0x14e773(0x196)]('‚è∞\x20[GLOBAL]\x20Payment\x20'+_0x65774d['id']+_0x14e773(0x175)+_0x4bfe10[_0x14e773(0x208)](0x1)+_0x14e773(0x169)),_0x52c34c++;continue;}console['log'](_0x14e773(0x1da)+_0x65774d['id']+_0x14e773(0x1aa)+_0x4bfe10['toFixed'](0x1)+'h)'),await this[_0x14e773(0x1b1)](_0x65774d),_0x22dca9++,await new Promise(_0x481e6a=>setTimeout(_0x481e6a,0x7d0));}catch(_0x245a21){console['error'](_0x14e773(0x204)+_0x65774d['id']+':',_0x245a21),this[_0x14e773(0x1b7)](_0x65774d['id'],_0x65774d[_0x14e773(0x1c4)]||_0x14e773(0x18b),_0x245a21,_0x14e773(0x15c),{'isGlobalCheck':!![],'paymentAmount':_0x65774d[_0x14e773(0x232)],'paymentCurrency':_0x65774d[_0x14e773(0x259)],'shopId':_0x65774d[_0x14e773(0x190)],'createdAt':_0x65774d[_0x14e773(0x1eb)]}),loggerService_1[_0x14e773(0x262)]['logWhiteDomainError'](_0x14e773(0x1c7),_0x14e773(0x229)+_0x65774d[_0x14e773(0x1c4)],_0x245a21);}}console['log'](_0x14e773(0x22d)+_0x22dca9+'\x20checked,\x20'+_0x52c34c+_0x14e773(0x164)+_0x1b0079[_0x14e773(0x248)]+_0x14e773(0x177));}catch(_0x15a66e){console['error'](_0x14e773(0x1fb),_0x15a66e);}}async[a38_0x4bbf78(0x239)](_0x37b3b5){const _0x44c27a=a38_0x4bbf78,_0x27990a=[],_0x402c33=new Date();_0x402c33[_0x44c27a(0x199)](_0x402c33['getDate']()-this[_0x44c27a(0x1f3)]),console[_0x44c27a(0x196)](_0x44c27a(0x19c)+this[_0x44c27a(0x1f3)]+'\x20days\x20(created\x20before\x20'+_0x402c33[_0x44c27a(0x1a1)]()+')');for(const _0x4eaf23 of _0x37b3b5){if(_0x4eaf23[_0x44c27a(0x1eb)]<_0x402c33){console['log'](_0x44c27a(0x1ab)+_0x4eaf23['id']+_0x44c27a(0x17c)+this[_0x44c27a(0x1f3)]+_0x44c27a(0x206));try{this[_0x44c27a(0x1b4)](_0x4eaf23['id'],_0x4eaf23[_0x44c27a(0x1c4)]||_0x44c27a(0x18b),_0x44c27a(0x254),_0x44c27a(0x19f),_0x44c27a(0x170),{'reason':_0x44c27a(0x1d1)+this[_0x44c27a(0x1f3)]+_0x44c27a(0x1bf),'createdAt':_0x4eaf23[_0x44c27a(0x1eb)],'daysSinceCreation':Math['floor']((Date[_0x44c27a(0x1ef)]()-_0x4eaf23[_0x44c27a(0x1eb)][_0x44c27a(0x263)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x4eaf23[_0x44c27a(0x232)],'paymentCurrency':_0x4eaf23[_0x44c27a(0x259)],'shopId':_0x4eaf23[_0x44c27a(0x190)]}),await database_1[_0x44c27a(0x25a)]['payment'][_0x44c27a(0x1fe)]({'where':{'id':_0x4eaf23['id']},'data':{'status':_0x44c27a(0x19f),'updatedAt':new Date(),'adminNotes':_0x44c27a(0x218)+this[_0x44c27a(0x1f3)]+_0x44c27a(0x16d)}}),await database_1[_0x44c27a(0x25a)][_0x44c27a(0x192)][_0x44c27a(0x23c)]({'data':{'paymentId':_0x4eaf23['id'],'shopId':_0x4eaf23['shopId'],'event':_0x44c27a(0x167),'statusCode':0xc8,'responseBody':JSON['stringify']({'reason':_0x44c27a(0x1d1)+this[_0x44c27a(0x1f3)]+_0x44c27a(0x1bf),'createdAt':_0x4eaf23['createdAt'],'expiredAt':new Date()['toISOString'](),'daysSinceCreation':Math[_0x44c27a(0x1d0)]((Date[_0x44c27a(0x1ef)]()-_0x4eaf23['createdAt'][_0x44c27a(0x263)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x44c27a(0x16f)](_0x4eaf23,'EXPIRED'),await this[_0x44c27a(0x21d)](_0x4eaf23,'EXPIRED'),this[_0x44c27a(0x20c)](_0x4eaf23['id']),_0x27990a['push'](_0x4eaf23['id']),console['log'](_0x44c27a(0x223)+_0x4eaf23['id']+'\x20marked\x20as\x20EXPIRED\x20due\x20to\x20'+this['EXPIRY_DAYS']+_0x44c27a(0x1d7));}catch(_0x5ecdff){console[_0x44c27a(0x193)](_0x44c27a(0x176)+_0x4eaf23['id']+':',_0x5ecdff),this[_0x44c27a(0x1b7)](_0x4eaf23['id'],_0x4eaf23[_0x44c27a(0x1c4)]||'unknown',_0x5ecdff,_0x44c27a(0x170),{'reason':_0x44c27a(0x15d),'createdAt':_0x4eaf23['createdAt'],'daysSinceCreation':Math[_0x44c27a(0x1d0)]((Date[_0x44c27a(0x1ef)]()-_0x4eaf23[_0x44c27a(0x1eb)][_0x44c27a(0x263)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x27990a;}async['checkSinglePayment'](_0x55103c){const _0x2b901e=a38_0x4bbf78;if(!_0x55103c[_0x2b901e(0x1c4)]){console[_0x2b901e(0x196)](_0x2b901e(0x17d)+_0x55103c['id']+_0x2b901e(0x17a));return;}console[_0x2b901e(0x196)](_0x2b901e(0x160)+_0x55103c[_0x2b901e(0x205)]+_0x2b901e(0x158)+_0x55103c['id']+'\x20('+_0x55103c['gatewayPaymentId']+')');try{let _0xbd797f;_0x55103c['gateway']==='cointopay2'?(_0xbd797f=await this['coinToPay2Service'][_0x2b901e(0x178)](_0x55103c['gatewayPaymentId']),console[_0x2b901e(0x196)](_0x2b901e(0x16c)+_0x55103c['id']+'\x20status:\x20'+_0xbd797f[_0x2b901e(0x23f)])):(_0xbd797f=await this[_0x2b901e(0x17f)][_0x2b901e(0x178)](_0x55103c[_0x2b901e(0x1c4)]),console['log'](_0x2b901e(0x22f)+_0x55103c['id']+_0x2b901e(0x260)+_0xbd797f['status']));_0xbd797f[_0x2b901e(0x1bd)]&&console[_0x2b901e(0x196)]('üìä\x20[CHECK]\x20Payment\x20'+_0x55103c['id']+_0x2b901e(0x1df),{'iban':_0xbd797f[_0x2b901e(0x1bd)][_0x2b901e(0x1a4)]||_0x2b901e(0x1c2),'transactionId':_0xbd797f[_0x2b901e(0x1bd)]['transactionId'],'createdOn':_0xbd797f[_0x2b901e(0x1bd)]['createdOn'],'confirmedOn':_0xbd797f[_0x2b901e(0x1bd)]['confirmedOn']||_0x2b901e(0x20f)});if(_0xbd797f[_0x2b901e(0x23f)]!==_0x55103c[_0x2b901e(0x23f)]){console[_0x2b901e(0x196)](_0x2b901e(0x153)+_0x55103c['id']+_0x2b901e(0x228)+_0x55103c[_0x2b901e(0x23f)]+'\x20to\x20'+_0xbd797f[_0x2b901e(0x23f)]),this['logCoinToPayStatus'](_0x55103c['id'],_0x55103c[_0x2b901e(0x1c4)],_0x55103c[_0x2b901e(0x23f)],_0xbd797f[_0x2b901e(0x23f)],_0x2b901e(0x15c),{'paymentDetails':_0xbd797f[_0x2b901e(0x1bd)],'amount':_0xbd797f[_0x2b901e(0x232)],'currency':_0xbd797f[_0x2b901e(0x259)],'shopId':_0x55103c['shopId'],'checkTimestamp':new Date()[_0x2b901e(0x1a1)]()});const _0x498b73={'status':_0xbd797f['status'],'updatedAt':new Date()};if(_0xbd797f[_0x2b901e(0x23f)]===_0x2b901e(0x19d)&&_0x55103c[_0x2b901e(0x23f)]!==_0x2b901e(0x19d)){_0x498b73[_0x2b901e(0x246)]=new Date();if(!_0x55103c[_0x2b901e(0x15e)]){const _0x17a3cc=await currencyService_1[_0x2b901e(0x24e)]['convertToUSDT'](_0x55103c['amount'],_0x55103c['currency']);_0x498b73[_0x2b901e(0x15e)]=_0x17a3cc;const _0x3f353e=await this[_0x2b901e(0x240)](_0x55103c[_0x2b901e(0x190)],_0x55103c[_0x2b901e(0x205)]),_0x420ae2=_0x17a3cc*(0x1-_0x3f353e/0x64);_0x498b73[_0x2b901e(0x15a)]=_0x420ae2,console[_0x2b901e(0x196)](_0x2b901e(0x16a)+_0x55103c['id']+'\x20amounts\x20calculated:'),console['log'](_0x2b901e(0x1cb)+_0x55103c[_0x2b901e(0x232)]+'\x20'+_0x55103c[_0x2b901e(0x259)]+_0x2b901e(0x22e)+_0x17a3cc[_0x2b901e(0x208)](0x6)+_0x2b901e(0x1f5)),console[_0x2b901e(0x196)](_0x2b901e(0x1dd)+_0x55103c[_0x2b901e(0x205)]+_0x2b901e(0x16b)+_0x3f353e+'%'),console[_0x2b901e(0x196)]('\x20\x20\x20Amount\x20after\x20commission:\x20'+_0x420ae2[_0x2b901e(0x208)](0x6)+_0x2b901e(0x1f5));}console[_0x2b901e(0x196)](_0x2b901e(0x16a)+_0x55103c['id']+_0x2b901e(0x1f4)+_0x498b73[_0x2b901e(0x246)]['toISOString']());}if(_0xbd797f[_0x2b901e(0x1bd)]){const _0x4f15e6=_0xbd797f[_0x2b901e(0x1bd)];_0x4f15e6[_0x2b901e(0x1a4)]&&(_0x498b73[_0x2b901e(0x1b6)]=_0x4f15e6['iban'],console[_0x2b901e(0x196)](_0x2b901e(0x1d3)+_0x4f15e6[_0x2b901e(0x1a4)]));if(_0x4f15e6[_0x2b901e(0x174)]){const _0xfd812a=_0x55103c[_0x2b901e(0x197)]||'',_0x5c5816='Bank\x20Details:\x20'+_0x4f15e6[_0x2b901e(0x174)];_0x498b73[_0x2b901e(0x197)]=_0xfd812a?_0xfd812a+'\x0a\x0a'+_0x5c5816:_0x5c5816,console[_0x2b901e(0x196)]('üè¶\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes');}_0x4f15e6[_0x2b901e(0x220)]&&console['log'](_0x2b901e(0x19b)+_0x4f15e6['transactionId']),_0x4f15e6[_0x2b901e(0x237)]&&console[_0x2b901e(0x196)](_0x2b901e(0x25e)+_0x4f15e6['confirmedOn']);}await database_1['default']['payment'][_0x2b901e(0x1fe)]({'where':{'id':_0x55103c['id']},'data':_0x498b73});if(_0xbd797f['status']==='PAID'&&_0x55103c['status']!=='PAID'){console[_0x2b901e(0x196)](_0x2b901e(0x156)+_0x55103c['id']+_0x2b901e(0x20a));const _0x235e33=await database_1[_0x2b901e(0x25a)][_0x2b901e(0x203)]['findUnique']({'where':{'id':_0x55103c['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x235e33?.['paymentLinkId']&&_0x235e33[_0x2b901e(0x20e)])try{const _0xae06ef=_0x235e33['paymentLink'];console['log'](_0x2b901e(0x1ff)+_0xae06ef['id']+_0x2b901e(0x165)+_0xae06ef['type']+_0x2b901e(0x191)+_0xae06ef[_0x2b901e(0x183)]+_0x2b901e(0x1d8)+_0xae06ef[_0x2b901e(0x23f)]);const _0x356487=_0xae06ef['currentPayments']+0x1,_0x5cde58=_0xae06ef[_0x2b901e(0x1f0)]===_0x2b901e(0x18a)?_0x2b901e(0x22b):_0xae06ef[_0x2b901e(0x23f)];await database_1[_0x2b901e(0x25a)][_0x2b901e(0x20e)][_0x2b901e(0x1fe)]({'where':{'id':_0xae06ef['id']},'data':{'currentPayments':_0x356487,'status':_0x5cde58,'updatedAt':new Date()}}),console[_0x2b901e(0x196)](_0x2b901e(0x181)+_0xae06ef['id']+_0x2b901e(0x21f)+_0xae06ef[_0x2b901e(0x183)]+_0x2b901e(0x22e)+_0x356487+',\x20status='+_0xae06ef[_0x2b901e(0x23f)]+_0x2b901e(0x22e)+_0x5cde58);}catch(_0x5bd412){console[_0x2b901e(0x193)]('‚ùå\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:',_0x5bd412);}else console[_0x2b901e(0x196)](_0x2b901e(0x156)+_0x55103c['id']+_0x2b901e(0x1c3));}await database_1[_0x2b901e(0x25a)]['webhookLog']['create']({'data':{'paymentId':_0x55103c['id'],'shopId':_0x55103c['shopId'],'event':_0x2b901e(0x1b0)+_0xbd797f[_0x2b901e(0x23f)]['toLowerCase'](),'statusCode':0xc8,'responseBody':JSON[_0x2b901e(0x214)]({'oldStatus':_0x55103c['status'],'newStatus':_0xbd797f[_0x2b901e(0x23f)],'paymentDetails':_0xbd797f['paymentDetails'],'checkedAt':new Date()[_0x2b901e(0x1a1)]()})}}),await this[_0x2b901e(0x16f)](_0x55103c,_0xbd797f['status']),await this['sendPaymentStatusNotification'](_0x55103c,_0xbd797f[_0x2b901e(0x23f)]),_0xbd797f['status']!=='PENDING'&&(console[_0x2b901e(0x196)]('üßπ\x20[CHECK]\x20Payment\x20'+_0x55103c['id']+_0x2b901e(0x1ad)+_0xbd797f['status']+_0x2b901e(0x233)),this['clearPaymentTimers'](_0x55103c['id'])),console[_0x2b901e(0x196)](_0x2b901e(0x182)+_0x55103c['id']+_0x2b901e(0x1f2));}else console[_0x2b901e(0x196)](_0x2b901e(0x243)+_0x55103c['id']+_0x2b901e(0x19a)+_0xbd797f['status']+')'),this[_0x2b901e(0x1b4)](_0x55103c['id'],_0x55103c['gatewayPaymentId'],_0x55103c['status'],_0xbd797f['status'],_0x2b901e(0x15c),{'statusUnchanged':!![],'paymentDetails':_0xbd797f['paymentDetails'],'amount':_0xbd797f['amount'],'currency':_0xbd797f[_0x2b901e(0x259)],'shopId':_0x55103c[_0x2b901e(0x190)],'checkTimestamp':new Date()[_0x2b901e(0x1a1)]()});}catch(_0x439742){console[_0x2b901e(0x193)](_0x2b901e(0x162)+_0x55103c['id']+':',_0x439742),this['logCoinToPayError'](_0x55103c['id'],_0x55103c[_0x2b901e(0x1c4)],_0x439742,'status_check',{'paymentAmount':_0x55103c[_0x2b901e(0x232)],'paymentCurrency':_0x55103c[_0x2b901e(0x259)],'shopId':_0x55103c[_0x2b901e(0x190)],'createdAt':_0x55103c[_0x2b901e(0x1eb)]}),await database_1[_0x2b901e(0x25a)][_0x2b901e(0x192)][_0x2b901e(0x23c)]({'data':{'paymentId':_0x55103c['id'],'shopId':_0x55103c[_0x2b901e(0x190)],'event':_0x2b901e(0x255),'statusCode':0x1f4,'responseBody':JSON[_0x2b901e(0x214)]({'error':_0x439742 instanceof Error?_0x439742[_0x2b901e(0x213)]:_0x2b901e(0x20d),'gatewayPaymentId':_0x55103c[_0x2b901e(0x1c4)],'checkedAt':new Date()[_0x2b901e(0x1a1)]()})}});}}async['sendShopWebhook'](_0x70f9e,_0x3b5a88){const _0xeb4d7b=a38_0x4bbf78,_0x5e5b2c=Date[_0xeb4d7b(0x1ef)]();try{const _0x3375e3=_0x70f9e[_0xeb4d7b(0x1ee)],_0x30c5ba=_0x3375e3[_0xeb4d7b(0x1e7)];if(!_0x30c5ba?.[_0xeb4d7b(0x1e0)]){console['log'](_0xeb4d7b(0x1e3)+_0x3375e3['id']);return;}const _0x3a066c=_0x3b5a88===_0xeb4d7b(0x19d)?_0xeb4d7b(0x15b):_0x3b5a88===_0xeb4d7b(0x23d)?'payment.failed':_0x3b5a88===_0xeb4d7b(0x19f)?_0xeb4d7b(0x188):_0xeb4d7b(0x1d2);if(!_0x30c5ba['webhookEvents']?.[_0xeb4d7b(0x1a2)](_0x3a066c)){console[_0xeb4d7b(0x196)](_0xeb4d7b(0x1b8)+_0x3a066c+_0xeb4d7b(0x210)+_0x3375e3['id']);return;}const _0x4a3d56=(0x0,gateway_1[_0xeb4d7b(0x1ed)])(_0x70f9e[_0xeb4d7b(0x205)])||_0x70f9e[_0xeb4d7b(0x205)],_0x36f498={'event':_0x3a066c,'payment':{'id':_0x70f9e['id'],'order_id':_0x70f9e[_0xeb4d7b(0x24d)],'gateway_order_id':_0x70f9e['gatewayOrderId'],'gateway':_0x4a3d56,'amount':_0x70f9e[_0xeb4d7b(0x232)],'currency':_0x70f9e[_0xeb4d7b(0x259)],'status':_0x3b5a88[_0xeb4d7b(0x1b2)](),'customer_email':_0x70f9e['customerEmail'],'customer_name':_0x70f9e[_0xeb4d7b(0x253)],'created_at':_0x70f9e[_0xeb4d7b(0x1eb)],'updated_at':new Date()}},_0x4af4ac=await fetch(_0x30c5ba[_0xeb4d7b(0x1e0)],{'method':_0xeb4d7b(0x151),'headers':{'Content-Type':_0xeb4d7b(0x209),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON['stringify'](_0x36f498)}),_0x4bad7a=Date[_0xeb4d7b(0x1ef)]()-_0x5e5b2c,_0x1e9f12=_0x4af4ac['ok']?_0xeb4d7b(0x1cc):await _0x4af4ac[_0xeb4d7b(0x1fa)]();loggerService_1[_0xeb4d7b(0x262)][_0xeb4d7b(0x1bc)](_0x70f9e[_0xeb4d7b(0x190)],_0x30c5ba['webhookUrl'],_0x3a066c,_0x4af4ac['status'],_0x4bad7a,_0x36f498),console[_0xeb4d7b(0x196)]('Shop\x20webhook\x20sent\x20to\x20'+_0x30c5ba[_0xeb4d7b(0x1e0)]+_0xeb4d7b(0x1a9)+_0x4af4ac[_0xeb4d7b(0x23f)]+'\x20('+_0x4bad7a+_0xeb4d7b(0x18e));}catch(_0xef6088){console[_0xeb4d7b(0x193)](_0xeb4d7b(0x16e),_0xef6088),loggerService_1[_0xeb4d7b(0x262)][_0xeb4d7b(0x173)](_0x70f9e['shopId'],_0x70f9e['shop']?.[_0xeb4d7b(0x1e7)]?.[_0xeb4d7b(0x1e0)]||_0xeb4d7b(0x18b),_0xeb4d7b(0x194),_0xef6088,{});}}async[a38_0x4bbf78(0x21d)](_0x18545d,_0x33525c){const _0x24882f=a38_0x4bbf78;try{const _0x797718={'PENDING':_0x24882f(0x1e5),'PAID':_0x24882f(0x161),'FAILED':_0x24882f(0x18c),'EXPIRED':_0x24882f(0x1ae)},_0xfcc9c=_0x797718[_0x33525c];if(!_0xfcc9c||_0xfcc9c===_0x24882f(0x1e5))return;await telegramBotService_1[_0x24882f(0x1a8)][_0x24882f(0x14e)](_0x18545d[_0x24882f(0x190)],_0x18545d,_0xfcc9c);}catch(_0x42dd7c){console[_0x24882f(0x193)]('Failed\x20to\x20send\x20Telegram\x20payment\x20notification:',_0x42dd7c);}}async[a38_0x4bbf78(0x25b)](_0x37d4a8){const _0x3409bc=a38_0x4bbf78;console[_0x3409bc(0x196)](_0x3409bc(0x215)+_0x37d4a8);const _0x27065e=await database_1[_0x3409bc(0x25a)][_0x3409bc(0x203)][_0x3409bc(0x155)]({'where':{'id':_0x37d4a8},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x27065e)throw new Error(_0x3409bc(0x222));if(_0x27065e[_0x3409bc(0x205)]!=='cointopay'&&_0x27065e[_0x3409bc(0x205)]!==_0x3409bc(0x242))throw new Error(_0x3409bc(0x219));console[_0x3409bc(0x196)](_0x3409bc(0x21e)+_0x27065e['gateway']+_0x3409bc(0x158)+_0x37d4a8),await this['checkSinglePayment'](_0x27065e),console[_0x3409bc(0x196)]('‚úÖ\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20'+_0x37d4a8);}['getServiceStats'](){const _0x1edc35=a38_0x4bbf78,_0x547130=this[_0x1edc35(0x257)]?this[_0x1edc35(0x17b)]:undefined,_0x211094=Array['from'](this[_0x1edc35(0x226)][_0x1edc35(0x1ea)]())[_0x1edc35(0x258)](_0x43f05b=>({'paymentId':_0x43f05b['paymentId'],'gatewayPaymentId':_0x43f05b[_0x1edc35(0x1c4)],'createdAt':_0x43f05b[_0x1edc35(0x1eb)],'timersCount':_0x43f05b[_0x1edc35(0x14f)][_0x1edc35(0x248)]}));return{'isActive':!!this[_0x1edc35(0x257)],'globalCheckIntervalMinutes':this[_0x1edc35(0x17b)]/(0x3e8*0x3c),'expiryDays':this[_0x1edc35(0x1f3)],'activeIndividualTimers':this[_0x1edc35(0x226)][_0x1edc35(0x261)],'nextGlobalCheckIn':_0x547130,'paymentTimersDetails':_0x211094};}[a38_0x4bbf78(0x166)](_0x526b62){const _0x4d9626=a38_0x4bbf78,_0x30bdf5=this['paymentTimers'][_0x4d9626(0x252)](_0x526b62);if(_0x30bdf5)return{'hasTimers':!![],'timersCount':_0x30bdf5['timers']['length'],'createdAt':_0x30bdf5['createdAt'],'gatewayPaymentId':_0x30bdf5[_0x4d9626(0x1c4)]};return{'hasTimers':![]};}async[a38_0x4bbf78(0x240)](_0x119448,_0x4cf2d7){const _0x4be894=a38_0x4bbf78;try{const _0x1cd8f0=await database_1['default'][_0x4be894(0x1ee)][_0x4be894(0x155)]({'where':{'id':_0x119448},'select':{'gatewaySettings':!![]}});if(!_0x1cd8f0?.['gatewaySettings'])return console['log']('No\x20gateway\x20settings\x20found\x20for\x20shop\x20'+_0x119448+_0x4be894(0x22a)),0xa;const _0x1cfbff=JSON[_0x4be894(0x1db)](_0x1cd8f0[_0x4be894(0x1a7)]);for(const [_0x1411d2,_0x1eec13]of Object['entries'](_0x1cfbff)){if(_0x1411d2[_0x4be894(0x1b2)]()===_0x4cf2d7[_0x4be894(0x1b2)]()){const _0x767df3=_0x1eec13[_0x4be894(0x1a6)]||0xa;return console[_0x4be894(0x196)](_0x4be894(0x221)+_0x4cf2d7+'\x20commission\x20for\x20shop\x20'+_0x119448+':\x20'+_0x767df3+'%'),_0x767df3;}}return console[_0x4be894(0x196)](_0x4be894(0x22c)+_0x4cf2d7+_0x4be894(0x186)+_0x119448+_0x4be894(0x1ba)),0xa;}catch(_0x11d814){return console['error'](_0x4be894(0x24c)+_0x119448+_0x4be894(0x19e)+_0x4cf2d7+':',_0x11d814),0xa;}}}exports[a38_0x4bbf78(0x25c)]=CoinToPayStatusService,exports[a38_0x4bbf78(0x1de)]=new CoinToPayStatusService();