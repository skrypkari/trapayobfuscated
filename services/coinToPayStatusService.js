'use strict';const a37_0x1b533d=a37_0x32f4;(function(_0x15fb21,_0x592565){const _0x5d9f1b=a37_0x32f4,_0x5dacd2=_0x15fb21();while(!![]){try{const _0x4cf029=parseInt(_0x5d9f1b(0x112))/0x1*(parseInt(_0x5d9f1b(0x105))/0x2)+parseInt(_0x5d9f1b(0x1a0))/0x3*(parseInt(_0x5d9f1b(0x10c))/0x4)+-parseInt(_0x5d9f1b(0x149))/0x5*(parseInt(_0x5d9f1b(0x95))/0x6)+-parseInt(_0x5d9f1b(0xd4))/0x7*(parseInt(_0x5d9f1b(0x18e))/0x8)+-parseInt(_0x5d9f1b(0x151))/0x9*(-parseInt(_0x5d9f1b(0x92))/0xa)+-parseInt(_0x5d9f1b(0x119))/0xb*(-parseInt(_0x5d9f1b(0xf8))/0xc)+-parseInt(_0x5d9f1b(0xeb))/0xd;if(_0x4cf029===_0x592565)break;else _0x5dacd2['push'](_0x5dacd2['shift']());}catch(_0x5b69c7){_0x5dacd2['push'](_0x5dacd2['shift']());}}}(a37_0x5349,0xe2d39));var __importDefault=this&&this[a37_0x1b533d(0x12b)]||function(_0x553b1f){return _0x553b1f&&_0x553b1f['__esModule']?_0x553b1f:{'default':_0x553b1f};};Object[a37_0x1b533d(0xcf)](exports,a37_0x1b533d(0x16c),{'value':!![]}),exports[a37_0x1b533d(0x19c)]=exports[a37_0x1b533d(0xd6)]=void 0x0;function a37_0x32f4(_0x17c496,_0xb16fdb){const _0x53495a=a37_0x5349();return a37_0x32f4=function(_0x32f446,_0x4eb134){_0x32f446=_0x32f446-0x8d;let _0x457321=_0x53495a[_0x32f446];return _0x457321;},a37_0x32f4(_0x17c496,_0xb16fdb);}const coinToPayService_1=require(a37_0x1b533d(0x14f)),coinToPay2Service_1=require(a37_0x1b533d(0x172)),gateway_1=require(a37_0x1b533d(0xef)),database_1=__importDefault(require(a37_0x1b533d(0xd0))),telegramBotService_1=require(a37_0x1b533d(0x182)),loggerService_1=require(a37_0x1b533d(0x18c)),currencyService_1=require('./currencyService');class CoinToPayStatusService{constructor(){const _0x298925=a37_0x1b533d;this['globalCheckInterval']=null,this[_0x298925(0x181)]=0x3c*0x3c*0x3e8,this[_0x298925(0x99)]=0x5,this[_0x298925(0x16d)]=new Map(),this[_0x298925(0xf2)]=new coinToPayService_1[(_0x298925(0x9e))](),this[_0x298925(0x195)]=new coinToPay2Service_1[(_0x298925(0xb4))](),console[_0x298925(0x15b)](_0x298925(0x140));}[a37_0x1b533d(0x118)](_0xb10d67,_0x21b7a6){const _0x11babf=a37_0x1b533d;console['log']('🪙\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:'),console[_0x11babf(0x15b)](_0x11babf(0x11b)+_0xb10d67),console[_0x11babf(0x15b)](_0x11babf(0xc9)+_0x21b7a6),this[_0x11babf(0xc2)](_0xb10d67);const _0x44a228=[],_0x1ea4a3=new Date(),_0x288a3c=[{'delay':0x1*0x3c*0x3e8,'description':_0x11babf(0x116)},{'delay':0x2*0x3c*0x3e8,'description':_0x11babf(0x147)},{'delay':0x5*0x3c*0x3e8,'description':'5\x20minutes'},{'delay':0x5*0x3c*0x3e8,'description':'5\x20minutes'}];console[_0x11babf(0x15b)](_0x11babf(0xbc)+_0x288a3c[_0x11babf(0x155)]+_0x11babf(0xd1)+_0xb10d67);let _0x37ea2c=0x0;_0x288a3c['forEach']((_0x3cf10b,_0x20b9ff)=>{const _0x48530d=_0x11babf;_0x37ea2c+=_0x3cf10b[_0x48530d(0xe9)];const _0x1acd8a=setTimeout(async()=>{const _0x325f8b=_0x48530d;console[_0x325f8b(0x15b)](_0x325f8b(0xe7)+(_0x20b9ff+0x1)+_0x325f8b(0x18d)+_0xb10d67+'\x20(after\x20'+_0x3cf10b[_0x325f8b(0x17d)]+')');try{await this['checkSinglePaymentById'](_0xb10d67),console['log']('✅\x20[TIMER]\x20Individual\x20check\x20#'+(_0x20b9ff+0x1)+'\x20completed\x20for\x20payment\x20'+_0xb10d67);}catch(_0x310275){console[_0x325f8b(0x111)](_0x325f8b(0x158)+(_0x20b9ff+0x1)+_0x325f8b(0x15c)+_0xb10d67+':',_0x310275),this[_0x325f8b(0x153)](_0xb10d67,_0x21b7a6,_0x310275,_0x325f8b(0x98),{'checkNumber':_0x20b9ff+0x1,'scheduledAfter':_0x3cf10b[_0x325f8b(0x17d)],'isIndividualCheck':!![]});}},_0x37ea2c);_0x44a228[_0x48530d(0x122)](_0x1acd8a),console[_0x48530d(0x15b)]('⏰\x20[DEBUG]\x20Scheduled\x20check\x20#'+(_0x20b9ff+0x1)+'\x20for\x20payment\x20'+_0xb10d67+_0x48530d(0xee)+_0x37ea2c/0x3e8+_0x48530d(0x139)+_0x3cf10b[_0x48530d(0x17d)]+')');});const _0x47baf0=setInterval(async()=>{const _0x42c01f=_0x11babf;console[_0x42c01f(0x15b)](_0x42c01f(0xf9)+_0xb10d67);try{const _0x1117b2=await database_1[_0x42c01f(0x150)][_0x42c01f(0x100)][_0x42c01f(0x12f)]({'where':{'id':_0xb10d67},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x1117b2){console['log'](_0x42c01f(0x170)+_0xb10d67+'\x20not\x20found,\x20clearing\x20timers'),this[_0x42c01f(0xc2)](_0xb10d67);return;}console['log'](_0x42c01f(0x125)+_0xb10d67+_0x42c01f(0xa5)+_0x1117b2[_0x42c01f(0x180)]);if(_0x1117b2[_0x42c01f(0x180)]!=='PENDING'){console[_0x42c01f(0x15b)](_0x42c01f(0xa6)+_0xb10d67+_0x42c01f(0x135)+_0x1117b2[_0x42c01f(0x180)]+_0x42c01f(0x117)),this[_0x42c01f(0xc2)](_0xb10d67);return;}const _0x37b07d=Math[_0x42c01f(0xcd)]((Date[_0x42c01f(0x128)]()-_0x1117b2[_0x42c01f(0x123)][_0x42c01f(0xdc)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x37b07d>=this[_0x42c01f(0x99)]){console[_0x42c01f(0x15b)]('⏰\x20[HOURLY]\x20Payment\x20'+_0xb10d67+_0x42c01f(0xd7)+this[_0x42c01f(0x99)]+'\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check'),this[_0x42c01f(0xc2)](_0xb10d67);return;}await this['checkSinglePaymentById'](_0xb10d67),console['log'](_0x42c01f(0xbb)+_0xb10d67);}catch(_0x5eee){console[_0x42c01f(0x111)](_0x42c01f(0xd3)+_0xb10d67+':',_0x5eee),this['logCoinToPayError'](_0xb10d67,_0x21b7a6,_0x5eee,_0x42c01f(0x98),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x44a228['push'](_0x47baf0),this['paymentTimers'][_0x11babf(0x1a1)](_0xb10d67,{'timers':_0x44a228,'paymentId':_0xb10d67,'gatewayPaymentId':_0x21b7a6,'createdAt':_0x1ea4a3}),console[_0x11babf(0x15b)](_0x11babf(0xa0)+_0x288a3c[_0x11babf(0x155)]+'\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20'+_0xb10d67),console[_0x11babf(0x15b)]('📊\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20'+this[_0x11babf(0x16d)][_0x11babf(0xba)]),this[_0x11babf(0x16b)](_0xb10d67,_0x21b7a6,_0x11babf(0xfd),'PENDING',_0x11babf(0x98),{'action':'schedule_created','scheduledChecks':_0x288a3c[_0x11babf(0x155)],'firstCheckIn':_0x288a3c[0x0][_0x11babf(0xe9)]/0x3e8,'totalTimers':this[_0x11babf(0x16d)][_0x11babf(0xba)]});}['clearPaymentTimers'](_0x11c5d8){const _0x3a361a=a37_0x1b533d,_0xd49a87=this[_0x3a361a(0x16d)][_0x3a361a(0xed)](_0x11c5d8);_0xd49a87?(console[_0x3a361a(0x15b)](_0x3a361a(0x175)+_0xd49a87[_0x3a361a(0x19d)][_0x3a361a(0x155)]+_0x3a361a(0x171)+_0x11c5d8),_0xd49a87[_0x3a361a(0x19d)]['forEach']((_0x1eab55,_0x5e43c3)=>{const _0x1cfa5e=_0x3a361a;_0x1eab55&&(clearTimeout(_0x1eab55),clearInterval(_0x1eab55),console[_0x1cfa5e(0x15b)](_0x1cfa5e(0x133)+(_0x5e43c3+0x1)+_0x1cfa5e(0x15c)+_0x11c5d8));}),this[_0x3a361a(0x16d)]['delete'](_0x11c5d8),console[_0x3a361a(0x15b)](_0x3a361a(0x131)+_0x11c5d8+_0x3a361a(0x11a)+this[_0x3a361a(0x16d)]['size'])):console['log'](_0x3a361a(0x17a)+_0x11c5d8+'\x20to\x20clear');}async[a37_0x1b533d(0xd5)](_0x543746){const _0x1f09ef=a37_0x1b533d;console[_0x1f09ef(0x15b)](_0x1f09ef(0xcc)+_0x543746);const _0x36b239=await database_1[_0x1f09ef(0x150)]['payment'][_0x1f09ef(0x12f)]({'where':{'id':_0x543746},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x36b239){console['log'](_0x1f09ef(0xe5)+_0x543746+_0x1f09ef(0x179));return;}console[_0x1f09ef(0x15b)]('📊\x20[CHECK]\x20Payment\x20'+_0x543746+'\x20found:'),console['log'](_0x1f09ef(0xb5)+_0x36b239[_0x1f09ef(0x188)]),console[_0x1f09ef(0x15b)](_0x1f09ef(0xac)+_0x36b239['status']),console[_0x1f09ef(0x15b)](_0x1f09ef(0x13c)+_0x36b239[_0x1f09ef(0xce)]),console[_0x1f09ef(0x15b)](_0x1f09ef(0x15d)+_0x36b239[_0x1f09ef(0x141)]+'\x20'+_0x36b239[_0x1f09ef(0x101)]),console['log']('\x20\x20\x20-\x20ShopId:\x20'+_0x36b239[_0x1f09ef(0x19e)]);if(_0x36b239[_0x1f09ef(0x188)]!=='cointopay'&&_0x36b239[_0x1f09ef(0x188)]!=='cointopay2'){console[_0x1f09ef(0x15b)](_0x1f09ef(0xae)+_0x543746+_0x1f09ef(0x191)+_0x36b239[_0x1f09ef(0x188)]+')');return;}if(_0x36b239[_0x1f09ef(0x180)]!=='PENDING'){console[_0x1f09ef(0x15b)](_0x1f09ef(0xae)+_0x543746+_0x1f09ef(0x135)+_0x36b239[_0x1f09ef(0x180)]+_0x1f09ef(0x117)),this[_0x1f09ef(0xc2)](_0x543746);return;}if(!_0x36b239['gatewayPaymentId']){console['log'](_0x1f09ef(0xae)+_0x543746+_0x1f09ef(0xa7));return;}console[_0x1f09ef(0x15b)](_0x1f09ef(0xde)+_0x543746+_0x1f09ef(0xc4)),await this['checkSinglePayment'](_0x36b239);}[a37_0x1b533d(0x16b)](_0x23bbae,_0x77cfa1,_0x4367f9,_0x12ca32,_0x8620ab,_0x2e4fbb){const _0x336c26=a37_0x1b533d,_0x126153={'type':_0x336c26(0x126),'paymentId':_0x23bbae,'gatewayPaymentId':_0x77cfa1,'oldStatus':_0x4367f9,'newStatus':_0x12ca32,'source':_0x8620ab,'timestamp':new Date()[_0x336c26(0x10b)](),'details':_0x2e4fbb||{}};loggerService_1['loggerService'][_0x336c26(0x16b)](_0x126153),console[_0x336c26(0x15b)]('🪙\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20'+_0x23bbae+'\x20('+_0x77cfa1+')'),console[_0x336c26(0x15b)](_0x336c26(0x152)+_0x4367f9+'\x20->\x20'+_0x12ca32),console[_0x336c26(0x15b)](_0x336c26(0xbd)+_0x8620ab),console[_0x336c26(0x15b)](_0x336c26(0xb8)+_0x126153['timestamp']),_0x2e4fbb&&console['log'](_0x336c26(0x162),_0x2e4fbb);}[a37_0x1b533d(0x153)](_0x2a72a8,_0x174c2a,_0x23512f,_0x4e9302,_0x166a65){const _0x5440ba=a37_0x1b533d,_0x47c9e1={'type':'COINTOPAY_ERROR','paymentId':_0x2a72a8,'gatewayPaymentId':_0x174c2a,'error':_0x23512f instanceof Error?{'message':_0x23512f['message'],'stack':_0x23512f['stack']}:_0x23512f,'source':_0x4e9302,'timestamp':new Date()[_0x5440ba(0x10b)](),'context':_0x166a65||{}};loggerService_1['loggerService'][_0x5440ba(0x153)](_0x47c9e1),console[_0x5440ba(0x111)](_0x5440ba(0x18f)+_0x2a72a8+'\x20('+_0x174c2a+')'),console[_0x5440ba(0x111)](_0x5440ba(0x9a)+(_0x23512f instanceof Error?_0x23512f['message']:_0x23512f)),console[_0x5440ba(0x111)](_0x5440ba(0xbd)+_0x4e9302),console[_0x5440ba(0x111)](_0x5440ba(0xb8)+_0x47c9e1[_0x5440ba(0xb9)]),_0x166a65&&console['error']('\x20\x20\x20📝\x20Context:',_0x166a65);}['startPeriodicStatusCheck'](){const _0x61439a=a37_0x1b533d;console[_0x61439a(0x15b)](_0x61439a(0xa4)),this['checkAllPendingPayments']()[_0x61439a(0x160)](_0x1bf63b=>{const _0x5a0f04=_0x61439a;console['error'](_0x5a0f04(0x193),_0x1bf63b);}),this[_0x61439a(0x12d)]=setInterval(async()=>{const _0x3a2ea1=_0x61439a;try{console[_0x3a2ea1(0x15b)](_0x3a2ea1(0x12e)),await this[_0x3a2ea1(0xe1)](),console[_0x3a2ea1(0x15b)](_0x3a2ea1(0x90));}catch(_0x517e2a){console[_0x3a2ea1(0x111)](_0x3a2ea1(0x17e),_0x517e2a);}},this[_0x61439a(0x181)]),console[_0x61439a(0x15b)](_0x61439a(0xe4));}['stopPeriodicStatusCheck'](){const _0xb5b631=a37_0x1b533d;console['log']('🛑\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...');this['globalCheckInterval']&&(clearInterval(this[_0xb5b631(0x12d)]),this['globalCheckInterval']=null,console[_0xb5b631(0x15b)]('🛑\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped'));const _0x103fda=this[_0xb5b631(0x16d)][_0xb5b631(0xba)];for(const [_0x32a1e]of this['paymentTimers']){this['clearPaymentTimers'](_0x32a1e);}console['log'](_0xb5b631(0x165)+_0x103fda+'\x20individual\x20payment\x20timers');}async[a37_0x1b533d(0xe1)](){const _0x530341=a37_0x1b533d;try{console[_0x530341(0x15b)]('🪙\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...');const _0x5651f4=await database_1[_0x530341(0x150)][_0x530341(0x100)][_0x530341(0x159)]({'where':{'gateway':{'in':[_0x530341(0xf7),_0x530341(0xd9)]},'status':_0x530341(0xfd),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x530341(0x15b)](_0x530341(0x127)+_0x5651f4['length']+_0x530341(0x16e));if(_0x5651f4[_0x530341(0x155)]===0x0){console[_0x530341(0x15b)](_0x530341(0x121));return;}const _0x3ea008=await this[_0x530341(0x136)](_0x5651f4);console[_0x530341(0x15b)](_0x530341(0x154)+_0x3ea008[_0x530341(0x155)]+_0x530341(0x174));let _0x47600b=0x0,_0xaa277e=0x0;for(const _0xe8042d of _0x5651f4){try{if(_0x3ea008[_0x530341(0x96)](_0xe8042d['id'])){console[_0x530341(0x15b)](_0x530341(0x10a)+_0xe8042d['id']+_0x530341(0x14c)),_0xaa277e++;continue;}if(this['paymentTimers'][_0x530341(0x113)](_0xe8042d['id'])){console[_0x530341(0x15b)](_0x530341(0x10a)+_0xe8042d['id']+_0x530341(0x11f)),_0xaa277e++;continue;}const _0x23ba28=(Date[_0x530341(0x128)]()-_0xe8042d[_0x530341(0x123)][_0x530341(0xdc)]())/(0x3e8*0x3c*0x3c);if(_0x23ba28<0x1){console[_0x530341(0x15b)](_0x530341(0x10a)+_0xe8042d['id']+_0x530341(0x11d)+_0x23ba28[_0x530341(0x198)](0x1)+_0x530341(0x12a)),_0xaa277e++;continue;}console[_0x530341(0x15b)](_0x530341(0x110)+_0xe8042d['id']+_0x530341(0xe0)+_0x23ba28['toFixed'](0x1)+'h)'),await this['checkSinglePayment'](_0xe8042d),_0x47600b++,await new Promise(_0x213329=>setTimeout(_0x213329,0x7d0));}catch(_0x1be694){console[_0x530341(0x111)]('❌\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20'+_0xe8042d['id']+':',_0x1be694),this[_0x530341(0x153)](_0xe8042d['id'],_0xe8042d[_0x530341(0xce)]||_0x530341(0x17b),_0x1be694,'status_check',{'isGlobalCheck':!![],'paymentAmount':_0xe8042d[_0x530341(0x141)],'paymentCurrency':_0xe8042d[_0x530341(0x101)],'shopId':_0xe8042d['shopId'],'createdAt':_0xe8042d[_0x530341(0x123)]}),loggerService_1['loggerService'][_0x530341(0xfe)](_0x530341(0xf7),'/status/'+_0xe8042d[_0x530341(0xce)],_0x1be694);}}console[_0x530341(0x15b)](_0x530341(0xb1)+_0x47600b+_0x530341(0x166)+_0xaa277e+_0x530341(0xbf)+_0x3ea008[_0x530341(0x155)]+_0x530341(0xa1));}catch(_0x3ea187){console['error']('❌\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:',_0x3ea187);}}async[a37_0x1b533d(0x136)](_0x149058){const _0x40bca7=a37_0x1b533d,_0x4ec789=[],_0x54b649=new Date();_0x54b649[_0x40bca7(0x15a)](_0x54b649['getDate']()-this['EXPIRY_DAYS']),console[_0x40bca7(0x15b)](_0x40bca7(0x177)+this[_0x40bca7(0x99)]+'\x20days\x20(created\x20before\x20'+_0x54b649['toISOString']()+')');for(const _0x3c0ebf of _0x149058){if(_0x3c0ebf[_0x40bca7(0x123)]<_0x54b649){console[_0x40bca7(0x15b)](_0x40bca7(0x197)+_0x3c0ebf['id']+_0x40bca7(0xd7)+this[_0x40bca7(0x99)]+'\x20days,\x20marking\x20as\x20EXPIRED');try{this[_0x40bca7(0x16b)](_0x3c0ebf['id'],_0x3c0ebf[_0x40bca7(0xce)]||_0x40bca7(0x17b),_0x40bca7(0xfd),'EXPIRED',_0x40bca7(0x10e),{'reason':_0x40bca7(0xfb)+this['EXPIRY_DAYS']+_0x40bca7(0x8e),'createdAt':_0x3c0ebf[_0x40bca7(0x123)],'daysSinceCreation':Math['floor']((Date[_0x40bca7(0x128)]()-_0x3c0ebf['createdAt'][_0x40bca7(0xdc)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x3c0ebf[_0x40bca7(0x141)],'paymentCurrency':_0x3c0ebf[_0x40bca7(0x101)],'shopId':_0x3c0ebf[_0x40bca7(0x19e)]}),await database_1[_0x40bca7(0x150)][_0x40bca7(0x100)][_0x40bca7(0xf4)]({'where':{'id':_0x3c0ebf['id']},'data':{'status':_0x40bca7(0x10d),'updatedAt':new Date(),'adminNotes':_0x40bca7(0x94)+this[_0x40bca7(0x99)]+_0x40bca7(0x178)}}),await database_1[_0x40bca7(0x150)][_0x40bca7(0x144)]['create']({'data':{'paymentId':_0x3c0ebf['id'],'shopId':_0x3c0ebf['shopId'],'event':_0x40bca7(0x120),'statusCode':0xc8,'responseBody':JSON['stringify']({'reason':'Payment\x20older\x20than\x20'+this['EXPIRY_DAYS']+'\x20days','createdAt':_0x3c0ebf[_0x40bca7(0x123)],'expiredAt':new Date()['toISOString'](),'daysSinceCreation':Math['floor']((Date['now']()-_0x3c0ebf['createdAt']['getTime']())/(0x3e8*0x3c*0x3c*0x18))})}}),await this['sendShopWebhook'](_0x3c0ebf,_0x40bca7(0x10d)),await this['sendPaymentStatusNotification'](_0x3c0ebf,_0x40bca7(0x10d)),this['clearPaymentTimers'](_0x3c0ebf['id']),_0x4ec789[_0x40bca7(0x122)](_0x3c0ebf['id']),console['log'](_0x40bca7(0x15e)+_0x3c0ebf['id']+_0x40bca7(0x189)+this[_0x40bca7(0x99)]+_0x40bca7(0x9d));}catch(_0x4aae41){console['error']('❌\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20'+_0x3c0ebf['id']+':',_0x4aae41),this[_0x40bca7(0x153)](_0x3c0ebf['id'],_0x3c0ebf[_0x40bca7(0xce)]||_0x40bca7(0x17b),_0x4aae41,_0x40bca7(0x10e),{'reason':_0x40bca7(0xc6),'createdAt':_0x3c0ebf['createdAt'],'daysSinceCreation':Math[_0x40bca7(0xcd)]((Date[_0x40bca7(0x128)]()-_0x3c0ebf[_0x40bca7(0x123)][_0x40bca7(0xdc)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x4ec789;}async[a37_0x1b533d(0x173)](_0x12e8ed){const _0x4ecd81=a37_0x1b533d;if(!_0x12e8ed['gatewayPaymentId']){console[_0x4ecd81(0x15b)](_0x4ecd81(0xae)+_0x12e8ed['id']+_0x4ecd81(0x186));return;}console[_0x4ecd81(0x15b)](_0x4ecd81(0x194)+_0x12e8ed[_0x4ecd81(0x188)]+_0x4ecd81(0xff)+_0x12e8ed['id']+'\x20('+_0x12e8ed['gatewayPaymentId']+')');try{let _0x43566a;_0x12e8ed[_0x4ecd81(0x188)]===_0x4ecd81(0xd9)?(_0x43566a=await this[_0x4ecd81(0x195)][_0x4ecd81(0x97)](_0x12e8ed[_0x4ecd81(0xce)]),console[_0x4ecd81(0x15b)]('📊\x20[CHECK]\x20CoinToPay2\x20payment\x20'+_0x12e8ed['id']+_0x4ecd81(0x164)+_0x43566a[_0x4ecd81(0x180)])):(_0x43566a=await this[_0x4ecd81(0xf2)]['checkPaymentStatus'](_0x12e8ed[_0x4ecd81(0xce)]),console['log'](_0x4ecd81(0x184)+_0x12e8ed['id']+_0x4ecd81(0x164)+_0x43566a[_0x4ecd81(0x180)]));_0x43566a[_0x4ecd81(0x15f)]&&console[_0x4ecd81(0x15b)](_0x4ecd81(0x130)+_0x12e8ed['id']+_0x4ecd81(0xf3),{'iban':_0x43566a['paymentDetails'][_0x4ecd81(0xbe)]||_0x4ecd81(0x11e),'transactionId':_0x43566a[_0x4ecd81(0x15f)][_0x4ecd81(0x14d)],'createdOn':_0x43566a[_0x4ecd81(0x15f)][_0x4ecd81(0x146)],'confirmedOn':_0x43566a[_0x4ecd81(0x15f)][_0x4ecd81(0x167)]||'not\x20confirmed'});if(_0x43566a[_0x4ecd81(0x180)]!==_0x12e8ed[_0x4ecd81(0x180)]){console[_0x4ecd81(0x15b)](_0x4ecd81(0x1a3)+_0x12e8ed['id']+_0x4ecd81(0xab)+_0x12e8ed[_0x4ecd81(0x180)]+_0x4ecd81(0xaf)+_0x43566a[_0x4ecd81(0x180)]),this['logCoinToPayStatus'](_0x12e8ed['id'],_0x12e8ed[_0x4ecd81(0xce)],_0x12e8ed[_0x4ecd81(0x180)],_0x43566a[_0x4ecd81(0x180)],'status_check',{'paymentDetails':_0x43566a[_0x4ecd81(0x15f)],'amount':_0x43566a[_0x4ecd81(0x141)],'currency':_0x43566a[_0x4ecd81(0x101)],'shopId':_0x12e8ed['shopId'],'checkTimestamp':new Date()[_0x4ecd81(0x10b)]()});const _0x1f772e={'status':_0x43566a[_0x4ecd81(0x180)],'updatedAt':new Date()};if(_0x43566a['status']===_0x4ecd81(0x1a2)&&_0x12e8ed[_0x4ecd81(0x180)]!==_0x4ecd81(0x1a2)){_0x1f772e[_0x4ecd81(0x104)]=new Date();if(!_0x12e8ed[_0x4ecd81(0xc5)]){const _0x5066dd=await currencyService_1[_0x4ecd81(0xfc)][_0x4ecd81(0x19a)](_0x12e8ed[_0x4ecd81(0x141)],_0x12e8ed['currency']);_0x1f772e[_0x4ecd81(0xc5)]=_0x5066dd;const _0x1b1cd1=await this['getGatewayCommission'](_0x12e8ed[_0x4ecd81(0x19e)],_0x12e8ed[_0x4ecd81(0x188)]),_0x4d29ad=_0x5066dd*(0x1-_0x1b1cd1/0x64);_0x1f772e[_0x4ecd81(0x161)]=_0x4d29ad,console[_0x4ecd81(0x15b)]('💰\x20[CHECK]\x20Payment\x20'+_0x12e8ed['id']+_0x4ecd81(0x192)),console[_0x4ecd81(0x15b)](_0x4ecd81(0xe2)+_0x12e8ed['amount']+'\x20'+_0x12e8ed[_0x4ecd81(0x101)]+_0x4ecd81(0xa3)+_0x5066dd['toFixed'](0x6)+_0x4ecd81(0x13f)),console[_0x4ecd81(0x15b)](_0x4ecd81(0x143)+_0x12e8ed[_0x4ecd81(0x188)]+_0x4ecd81(0x9b)+_0x1b1cd1+'%'),console[_0x4ecd81(0x15b)](_0x4ecd81(0x19b)+_0x4d29ad['toFixed'](0x6)+_0x4ecd81(0x13f));}console[_0x4ecd81(0x15b)](_0x4ecd81(0x115)+_0x12e8ed['id']+_0x4ecd81(0xc3)+_0x1f772e[_0x4ecd81(0x104)]['toISOString']());}if(_0x43566a['paymentDetails']){const _0x3d7a05=_0x43566a[_0x4ecd81(0x15f)];_0x3d7a05[_0x4ecd81(0xbe)]&&(_0x1f772e[_0x4ecd81(0xb0)]=_0x3d7a05[_0x4ecd81(0xbe)],console[_0x4ecd81(0x15b)]('🏦\x20[CHECK]\x20Saved\x20IBAN:\x20'+_0x3d7a05[_0x4ecd81(0xbe)]));if(_0x3d7a05[_0x4ecd81(0x13a)]){const _0x2ceb37=_0x12e8ed[_0x4ecd81(0x185)]||'',_0x15f89b='Bank\x20Details:\x20'+_0x3d7a05[_0x4ecd81(0x13a)];_0x1f772e[_0x4ecd81(0x185)]=_0x2ceb37?_0x2ceb37+'\x0a\x0a'+_0x15f89b:_0x15f89b,console[_0x4ecd81(0x15b)](_0x4ecd81(0xca));}_0x3d7a05[_0x4ecd81(0x14d)]&&console[_0x4ecd81(0x15b)]('🆔\x20[CHECK]\x20Transaction\x20ID:\x20'+_0x3d7a05['transactionId']),_0x3d7a05[_0x4ecd81(0x167)]&&console[_0x4ecd81(0x15b)](_0x4ecd81(0x14b)+_0x3d7a05[_0x4ecd81(0x167)]);}await database_1[_0x4ecd81(0x150)]['payment'][_0x4ecd81(0xf4)]({'where':{'id':_0x12e8ed['id']},'data':_0x1f772e});if(_0x43566a['status']===_0x4ecd81(0x1a2)&&_0x12e8ed[_0x4ecd81(0x180)]!==_0x4ecd81(0x1a2)){console[_0x4ecd81(0x15b)](_0x4ecd81(0xa9)+_0x12e8ed['id']+_0x4ecd81(0x102));const _0x32fc64=await database_1['default'][_0x4ecd81(0x100)][_0x4ecd81(0x12f)]({'where':{'id':_0x12e8ed['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x32fc64?.[_0x4ecd81(0x190)]&&_0x32fc64[_0x4ecd81(0xd2)])try{const _0x3f60a7=_0x32fc64[_0x4ecd81(0xd2)];console[_0x4ecd81(0x15b)](_0x4ecd81(0x14e)+_0x3f60a7['id']+_0x4ecd81(0x18b)+_0x3f60a7['type']+',\x20currentPayments='+_0x3f60a7[_0x4ecd81(0x16f)]+_0x4ecd81(0xf5)+_0x3f60a7[_0x4ecd81(0x180)]);const _0x4410eb=_0x3f60a7['currentPayments']+0x1,_0x1bd1fd=_0x3f60a7[_0x4ecd81(0x93)]===_0x4ecd81(0x8f)?_0x4ecd81(0x12c):_0x3f60a7['status'];await database_1[_0x4ecd81(0x150)][_0x4ecd81(0xd2)]['update']({'where':{'id':_0x3f60a7['id']},'data':{'currentPayments':_0x4410eb,'status':_0x1bd1fd,'updatedAt':new Date()}}),console[_0x4ecd81(0x15b)](_0x4ecd81(0x19f)+_0x3f60a7['id']+_0x4ecd81(0x176)+_0x3f60a7[_0x4ecd81(0x16f)]+'\x20->\x20'+_0x4410eb+_0x4ecd81(0xf5)+_0x3f60a7[_0x4ecd81(0x180)]+_0x4ecd81(0xa3)+_0x1bd1fd);}catch(_0x2e590a){console[_0x4ecd81(0x111)]('❌\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:',_0x2e590a);}else console[_0x4ecd81(0x15b)](_0x4ecd81(0xa9)+_0x12e8ed['id']+'\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link');}await database_1[_0x4ecd81(0x150)][_0x4ecd81(0x144)][_0x4ecd81(0x106)]({'data':{'paymentId':_0x12e8ed['id'],'shopId':_0x12e8ed[_0x4ecd81(0x19e)],'event':_0x4ecd81(0x91)+_0x43566a[_0x4ecd81(0x180)][_0x4ecd81(0xda)](),'statusCode':0xc8,'responseBody':JSON[_0x4ecd81(0x11c)]({'oldStatus':_0x12e8ed[_0x4ecd81(0x180)],'newStatus':_0x43566a[_0x4ecd81(0x180)],'paymentDetails':_0x43566a[_0x4ecd81(0x15f)],'checkedAt':new Date()[_0x4ecd81(0x10b)]()})}}),await this[_0x4ecd81(0x187)](_0x12e8ed,_0x43566a[_0x4ecd81(0x180)]),await this[_0x4ecd81(0x142)](_0x12e8ed,_0x43566a[_0x4ecd81(0x180)]),_0x43566a[_0x4ecd81(0x180)]!==_0x4ecd81(0xfd)&&(console['log'](_0x4ecd81(0x134)+_0x12e8ed['id']+_0x4ecd81(0x9f)+_0x43566a[_0x4ecd81(0x180)]+_0x4ecd81(0x169)),this[_0x4ecd81(0xc2)](_0x12e8ed['id'])),console[_0x4ecd81(0x15b)](_0x4ecd81(0xde)+_0x12e8ed['id']+_0x4ecd81(0xf6));}else console[_0x4ecd81(0x15b)](_0x4ecd81(0x130)+_0x12e8ed['id']+_0x4ecd81(0x16a)+_0x43566a['status']+')'),this['logCoinToPayStatus'](_0x12e8ed['id'],_0x12e8ed[_0x4ecd81(0xce)],_0x12e8ed['status'],_0x43566a['status'],_0x4ecd81(0x98),{'statusUnchanged':!![],'paymentDetails':_0x43566a['paymentDetails'],'amount':_0x43566a['amount'],'currency':_0x43566a[_0x4ecd81(0x101)],'shopId':_0x12e8ed[_0x4ecd81(0x19e)],'checkTimestamp':new Date()['toISOString']()});}catch(_0x444220){console[_0x4ecd81(0x111)](_0x4ecd81(0xa2)+_0x12e8ed['id']+':',_0x444220),this[_0x4ecd81(0x153)](_0x12e8ed['id'],_0x12e8ed[_0x4ecd81(0xce)],_0x444220,'status_check',{'paymentAmount':_0x12e8ed[_0x4ecd81(0x141)],'paymentCurrency':_0x12e8ed[_0x4ecd81(0x101)],'shopId':_0x12e8ed[_0x4ecd81(0x19e)],'createdAt':_0x12e8ed[_0x4ecd81(0x123)]}),await database_1[_0x4ecd81(0x150)]['webhookLog'][_0x4ecd81(0x106)]({'data':{'paymentId':_0x12e8ed['id'],'shopId':_0x12e8ed[_0x4ecd81(0x19e)],'event':'cointopay_status_check_error','statusCode':0x1f4,'responseBody':JSON[_0x4ecd81(0x11c)]({'error':_0x444220 instanceof Error?_0x444220[_0x4ecd81(0xc8)]:_0x4ecd81(0x107),'gatewayPaymentId':_0x12e8ed[_0x4ecd81(0xce)],'checkedAt':new Date()[_0x4ecd81(0x10b)]()})}});}}async[a37_0x1b533d(0x187)](_0x37684e,_0x21c3ce){const _0xe4c91a=a37_0x1b533d,_0x127045=Date[_0xe4c91a(0x128)]();try{const _0x36ca7e=_0x37684e[_0xe4c91a(0xaa)],_0x4ea900=_0x36ca7e[_0xe4c91a(0xfa)];if(!_0x4ea900?.['webhookUrl']){console['log'](_0xe4c91a(0x148)+_0x36ca7e['id']);return;}const _0x1ff5ab=_0x21c3ce===_0xe4c91a(0x1a2)?_0xe4c91a(0x103):_0x21c3ce===_0xe4c91a(0xb2)?'payment.failed':_0x21c3ce===_0xe4c91a(0x10d)?'payment.failed':_0xe4c91a(0x138);if(!_0x4ea900[_0xe4c91a(0x9c)]?.[_0xe4c91a(0x96)](_0x1ff5ab)){console[_0xe4c91a(0x15b)](_0xe4c91a(0xb3)+_0x1ff5ab+_0xe4c91a(0x137)+_0x36ca7e['id']);return;}const _0x1694f6=(0x0,gateway_1[_0xe4c91a(0xc0)])(_0x37684e[_0xe4c91a(0x188)])||_0x37684e['gateway'],_0x1dd7ec={'event':_0x1ff5ab,'payment':{'id':_0x37684e['id'],'order_id':_0x37684e[_0xe4c91a(0x18a)],'gateway_order_id':_0x37684e[_0xe4c91a(0x168)],'gateway':_0x1694f6,'amount':_0x37684e[_0xe4c91a(0x141)],'currency':_0x37684e['currency'],'status':_0x21c3ce[_0xe4c91a(0xda)](),'customer_email':_0x37684e[_0xe4c91a(0x13b)],'customer_name':_0x37684e[_0xe4c91a(0x13e)],'created_at':_0x37684e['createdAt'],'updated_at':new Date()}},_0x35e6ee=await fetch(_0x4ea900[_0xe4c91a(0x199)],{'method':_0xe4c91a(0x8d),'headers':{'Content-Type':_0xe4c91a(0xb6),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0xe4c91a(0x11c)](_0x1dd7ec)}),_0x3fbe24=Date[_0xe4c91a(0x128)]()-_0x127045,_0x20ad30=_0x35e6ee['ok']?_0xe4c91a(0x157):await _0x35e6ee[_0xe4c91a(0x17c)]();loggerService_1[_0xe4c91a(0xdf)]['logShopWebhookSent'](_0x37684e[_0xe4c91a(0x19e)],_0x4ea900['webhookUrl'],_0x1ff5ab,_0x35e6ee[_0xe4c91a(0x180)],_0x3fbe24,_0x1dd7ec),console[_0xe4c91a(0x15b)](_0xe4c91a(0xa8)+_0x4ea900[_0xe4c91a(0x199)]+_0xe4c91a(0xe6)+_0x35e6ee['status']+'\x20('+_0x3fbe24+_0xe4c91a(0xdd));}catch(_0x1cf868){console[_0xe4c91a(0x111)](_0xe4c91a(0x163),_0x1cf868),loggerService_1[_0xe4c91a(0xdf)]['logShopWebhookError'](_0x37684e[_0xe4c91a(0x19e)],_0x37684e[_0xe4c91a(0xaa)]?.[_0xe4c91a(0xfa)]?.[_0xe4c91a(0x199)]||_0xe4c91a(0x17b),_0xe4c91a(0xd8),_0x1cf868,{});}}async['sendPaymentStatusNotification'](_0x583c23,_0x341185){const _0x386897=a37_0x1b533d;try{const _0x365cd7={'PENDING':_0x386897(0x14a),'PAID':_0x386897(0x132),'FAILED':_0x386897(0x196),'EXPIRED':_0x386897(0xad)},_0x5af520=_0x365cd7[_0x341185];if(!_0x5af520||_0x5af520===_0x386897(0x14a))return;await telegramBotService_1['telegramBotService'][_0x386897(0x114)](_0x583c23[_0x386897(0x19e)],_0x583c23,_0x5af520);}catch(_0x30dbb7){console['error'](_0x386897(0x17f),_0x30dbb7);}}async[a37_0x1b533d(0xc1)](_0x4d0c96){const _0x1df039=a37_0x1b533d;console['log']('🔍\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20'+_0x4d0c96);const _0x2112b5=await database_1[_0x1df039(0x150)]['payment'][_0x1df039(0x12f)]({'where':{'id':_0x4d0c96},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x2112b5)throw new Error(_0x1df039(0x13d));if(_0x2112b5[_0x1df039(0x188)]!=='cointopay'&&_0x2112b5[_0x1df039(0x188)]!==_0x1df039(0xd9))throw new Error('Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment');console[_0x1df039(0x15b)](_0x1df039(0x183)+_0x2112b5[_0x1df039(0x188)]+'\x20payment\x20'+_0x4d0c96),await this[_0x1df039(0x173)](_0x2112b5),console[_0x1df039(0x15b)](_0x1df039(0x109)+_0x4d0c96);}['getServiceStats'](){const _0x310c7d=a37_0x1b533d,_0x1e0212=this[_0x310c7d(0x12d)]?this[_0x310c7d(0x181)]:undefined,_0x507843=Array[_0x310c7d(0x156)](this[_0x310c7d(0x16d)][_0x310c7d(0xb7)]())['map'](_0x4d09d6=>({'paymentId':_0x4d09d6[_0x310c7d(0x10f)],'gatewayPaymentId':_0x4d09d6[_0x310c7d(0xce)],'createdAt':_0x4d09d6['createdAt'],'timersCount':_0x4d09d6[_0x310c7d(0x19d)][_0x310c7d(0x155)]}));return{'isActive':!!this['globalCheckInterval'],'globalCheckIntervalMinutes':this[_0x310c7d(0x181)]/(0x3e8*0x3c),'expiryDays':this[_0x310c7d(0x99)],'activeIndividualTimers':this[_0x310c7d(0x16d)][_0x310c7d(0xba)],'nextGlobalCheckIn':_0x1e0212,'paymentTimersDetails':_0x507843};}[a37_0x1b533d(0xec)](_0x311185){const _0x40dcc4=a37_0x1b533d,_0x11d7e3=this[_0x40dcc4(0x16d)]['get'](_0x311185);if(_0x11d7e3)return{'hasTimers':!![],'timersCount':_0x11d7e3[_0x40dcc4(0x19d)][_0x40dcc4(0x155)],'createdAt':_0x11d7e3[_0x40dcc4(0x123)],'gatewayPaymentId':_0x11d7e3[_0x40dcc4(0xce)]};return{'hasTimers':![]};}async[a37_0x1b533d(0xe8)](_0x3f4832,_0x410627){const _0x5e746d=a37_0x1b533d;try{const _0x251749=await database_1[_0x5e746d(0x150)][_0x5e746d(0xaa)][_0x5e746d(0x12f)]({'where':{'id':_0x3f4832},'select':{'gatewaySettings':!![]}});if(!_0x251749?.[_0x5e746d(0x145)])return console['log'](_0x5e746d(0xea)+_0x3f4832+_0x5e746d(0xe3)),0xa;const _0x475541=JSON[_0x5e746d(0x124)](_0x251749[_0x5e746d(0x145)]);for(const [_0x5ed952,_0x114bab]of Object[_0x5e746d(0x108)](_0x475541)){if(_0x5ed952['toLowerCase']()===_0x410627[_0x5e746d(0xda)]()){const _0x56ad3a=_0x114bab[_0x5e746d(0x129)]||0xa;return console['log'](_0x5e746d(0xf1)+_0x410627+'\x20commission\x20for\x20shop\x20'+_0x3f4832+':\x20'+_0x56ad3a+'%'),_0x56ad3a;}}return console[_0x5e746d(0x15b)](_0x5e746d(0xdb)+_0x410627+'\x20in\x20shop\x20'+_0x3f4832+_0x5e746d(0xf0)),0xa;}catch(_0x58afe0){return console[_0x5e746d(0x111)](_0x5e746d(0xcb)+_0x3f4832+_0x5e746d(0xc7)+_0x410627+':',_0x58afe0),0xa;}}}function a37_0x5349(){const _0x329e78=['\x20for\x20payment\x20','\x20\x20\x20-\x20Amount:\x20','✅\x20[EXPIRY]\x20Payment\x20','paymentDetails','catch','amountAfterGatewayCommissionUSDT','\x20\x20\x20📝\x20Details:','Failed\x20to\x20send\x20shop\x20webhook:','\x20status:\x20','🛑\x20[SHUTDOWN]\x20Cleared\x20','\x20checked,\x20','confirmedOn','gatewayOrderId',',\x20clearing\x20individual\x20timers','\x20status\x20unchanged\x20(','logCoinToPayStatus','__esModule','paymentTimers','\x20pending\x20CoinToPay\x20payments','currentPayments','❌\x20[HOURLY]\x20Payment\x20','\x20timers\x20for\x20payment\x20','./gateways/coinToPay2Service','checkSinglePayment','\x20expired\x20CoinToPay\x20payments','🧹\x20[DEBUG]\x20Clearing\x20','\x20updated:\x20currentPayments=','⏰\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','\x20days\x20without\x20payment\x20confirmation','\x20not\x20found\x20in\x20database','⚠️\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','unknown','text','description','❌\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','status','GLOBAL_CHECK_INTERVAL_MS','./telegramBotService','✅\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','📊\x20[CHECK]\x20CoinToPay\x20payment\x20','adminNotes','\x20has\x20no\x20gatewayPaymentId,\x20skipping','sendShopWebhook','gateway','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','orderId',':\x20type=','./loggerService','\x20triggered\x20for\x20payment\x20','8nPUPgB','🪙\x20[ERROR]\x20CoinToPay\x20Error:\x20','paymentLinkId','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','\x20amounts\x20calculated:','❌\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','🔍\x20[CHECK]\x20Checking\x20','coinToPay2Service','failed','⏰\x20[EXPIRY]\x20Payment\x20','toFixed','webhookUrl','convertToUSDT','\x20\x20\x20Amount\x20after\x20commission:\x20','coinToPayStatusService','timers','shopId','✅\x20[COINTOPAY]\x20Payment\x20link\x20','1349907MeNXdh','set','PAID','🔄\x20[CHECK]\x20Updating\x20payment\x20','POST','\x20days','SINGLE','✅\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','cointopay_status_check_','109510ROexKH','type','Automatically\x20expired\x20after\x20','383856KEssAG','includes','checkPaymentStatus','status_check','EXPIRY_DAYS','\x20\x20\x20❌\x20Error:\x20','\x20commission:\x20','webhookEvents','-day\x20timeout','CoinToPayService','\x20status\x20changed\x20to\x20','✅\x20[DEBUG]\x20Successfully\x20scheduled\x20','\x20expired','❌\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','\x20->\x20','🪙\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','\x20current\x20status:\x20','✅\x20[HOURLY]\x20Payment\x20','\x20has\x20no\x20gatewayPaymentId','Shop\x20webhook\x20sent\x20to\x20','📈\x20[COINTOPAY]\x20Payment\x20','shop','\x20status\x20from\x20','\x20\x20\x20-\x20Status:\x20','expired','⚠️\x20[CHECK]\x20Payment\x20','\x20to\x20','remitterIban','✅\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','FAILED','Webhook\x20event\x20','CoinToPay2Service','\x20\x20\x20-\x20Gateway:\x20','application/json','values','\x20\x20\x20📅\x20Time:\x20','timestamp','size','✅\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','🪙\x20[DEBUG]\x20Creating\x20','\x20\x20\x20📍\x20Source:\x20','iban','\x20skipped,\x20','getGatewayIdByName','checkPaymentById','clearPaymentTimers','\x20marked\x20as\x20paid\x20at:\x20','\x20is\x20valid\x20for\x20checking,\x20proceeding...','amountUSDT','Failed\x20to\x20mark\x20payment\x20as\x20expired',',\x20gateway\x20','message','\x20\x20\x20-\x20gatewayPaymentId:\x20','🏦\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','🔍\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','floor','gatewayPaymentId','defineProperty','../config/database','\x20initial\x20timers\x20for\x20payment\x20','paymentLink','❌\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','4646341zglsBI','checkSinglePaymentById','CoinToPayStatusService','\x20is\x20older\x20than\x20','webhook_send','cointopay2','toLowerCase','No\x20specific\x20commission\x20found\x20for\x20gateway\x20','getTime','ms)','✅\x20[CHECK]\x20Payment\x20','loggerService','\x20(age:\x20','checkAllPendingPayments','\x20\x20\x20Amount:\x20',',\x20using\x20default\x20commission\x2010%','✅\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','❌\x20[CHECK]\x20Payment\x20','\x20with\x20status\x20','🪙\x20[TIMER]\x20Individual\x20check\x20#','getGatewayCommission','delay','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','48841715fXzALD','getPaymentTimerInfo','get','\x20in\x20','../types/gateway',',\x20using\x20default\x2010%','Gateway\x20','coinToPayService','\x20details:','update',',\x20status=','\x20updated\x20successfully','cointopay','12SuhXTD','🪙\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','settings','Payment\x20older\x20than\x20','currencyService','PENDING','logWhiteDomainError','\x20payment\x20','payment','currency','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','payment.success','paidAt','323698ljNkFW','create','Unknown\x20error','entries','✅\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','⏰\x20[GLOBAL]\x20Payment\x20','toISOString','16ENxvHx','EXPIRED','auto_expire','paymentId','🔍\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','error','11LFDHUc','has','sendPaymentNotification','💰\x20[CHECK]\x20Payment\x20','1\x20minute',',\x20stopping\x20individual\x20checks','schedulePaymentChecks','14375383kHhuMc','.\x20Remaining\x20active\x20timers:\x20','\x20\x20\x20-\x20paymentId:\x20','stringify','\x20is\x20too\x20new\x20(','not\x20found','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','cointopay_auto_expired','🪙\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','push','createdAt','parse','📊\x20[HOURLY]\x20Payment\x20','COINTOPAY_STATUS_CHANGE','🪙\x20[GLOBAL]\x20Found\x20','now','commission','h),\x20skipping\x20global\x20check','__importDefault','COMPLETED','globalCheckInterval','🪙\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','findUnique','📊\x20[CHECK]\x20Payment\x20','✅\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','paid','🧹\x20[DEBUG]\x20Cleared\x20timer\x20#','🧹\x20[CHECK]\x20Payment\x20','\x20status\x20is\x20','checkExpiredPayments','\x20not\x20enabled\x20for\x20shop\x20','payment.pending','\x20seconds\x20(','bankDetails','customerEmail','\x20\x20\x20-\x20GatewayPaymentId:\x20','Payment\x20not\x20found','customerName','\x20USDT','🪙\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','amount','sendPaymentStatusNotification','\x20\x20\x20Gateway\x20','webhookLog','gatewaySettings','createdOn','2\x20minutes','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','40QDLGgC','created','✅\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','transactionId','📈\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','./gateways/coinToPayService','default','801JOAspx','\x20\x20\x20📊\x20Status:\x20','logCoinToPayError','⏰\x20[GLOBAL]\x20Found\x20','length','from','Success','❌\x20[TIMER]\x20Failed\x20individual\x20check\x20#','findMany','setDate','log'];a37_0x5349=function(){return _0x329e78;};return a37_0x5349();}exports[a37_0x1b533d(0xd6)]=CoinToPayStatusService,exports[a37_0x1b533d(0x19c)]=new CoinToPayStatusService();