'use strict';const a38_0x55bd31=a38_0x1e09;(function(_0x2edc88,_0x5a5efb){const _0x57aa7f=a38_0x1e09,_0x20585c=_0x2edc88();while(!![]){try{const _0x2c9b9f=-parseInt(_0x57aa7f(0x27e))/0x1+parseInt(_0x57aa7f(0x219))/0x2*(-parseInt(_0x57aa7f(0x1eb))/0x3)+-parseInt(_0x57aa7f(0x2ac))/0x4*(-parseInt(_0x57aa7f(0x293))/0x5)+-parseInt(_0x57aa7f(0x2d3))/0x6+parseInt(_0x57aa7f(0x25b))/0x7+parseInt(_0x57aa7f(0x200))/0x8*(-parseInt(_0x57aa7f(0x2b3))/0x9)+parseInt(_0x57aa7f(0x281))/0xa*(parseInt(_0x57aa7f(0x1f9))/0xb);if(_0x2c9b9f===_0x5a5efb)break;else _0x20585c['push'](_0x20585c['shift']());}catch(_0x116998){_0x20585c['push'](_0x20585c['shift']());}}}(a38_0x3650,0x4a55b));function a38_0x1e09(_0x5cd3e5,_0x23dffc){const _0x365029=a38_0x3650();return a38_0x1e09=function(_0x1e0963,_0x36244b){_0x1e0963=_0x1e0963-0x1e0;let _0x5e86c9=_0x365029[_0x1e0963];return _0x5e86c9;},a38_0x1e09(_0x5cd3e5,_0x23dffc);}function a38_0x3650(){const _0x25c443=['logCoinToPayError','createdAt','Payment\x20older\x20than\x20','\x20not\x20found,\x20clearing\x20timers','🪙\x20[DEBUG]\x20Creating\x20','unknown','🪙\x20[ERROR]\x20CoinToPay\x20Error:\x20',',\x20using\x20default\x20commission\x2010%','⏰\x20[EXPIRY]\x20Payment\x20','\x20status:\x20','\x20status\x20changed\x20to\x20','text','currentPayments','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','🏦\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes','COINTOPAY_STATUS_CHANGE','globalCheckInterval','forEach','type','./gateways/coinToPayService','customerEmail','iban','transactionId','⏰\x20[GLOBAL]\x20Payment\x20','expired','message','error','\x20commission:\x20','logWhiteDomainError','🪙\x20[TIMER]\x20Individual\x20check\x20#','3200078uRtFsO','../config/database','schedulePaymentChecks','2\x20minutes','\x20seconds\x20(','🔄\x20[CHECK]\x20Updating\x20payment\x20','orderId','coinToPayStatusService','⚠️\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','🛑\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','stringify','Failed\x20to\x20mark\x20payment\x20as\x20expired','Shop\x20webhook\x20sent\x20to\x20','\x20has\x20no\x20gatewayPaymentId','paidAt','✅\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','\x20status\x20unchanged\x20(','shop','🔍\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','payment','\x20is\x20valid\x20for\x20checking,\x20proceeding...','\x20to\x20','PAID','ms)','toLowerCase','COINTOPAY_ERROR','\x20payment\x20','✅\x20[EXPIRY]\x20Payment\x20','🪙\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','❌\x20[CHECK]\x20Payment\x20','SINGLE','checkSinglePayment',',\x20currentPayments=','\x20not\x20found\x20in\x20database','399452GfXsQy','payment.failed','📈\x20[COINTOPAY]\x20Payment\x20','2220yaHSos','📊\x20[CHECK]\x20CoinToPay2\x20payment\x20','gateway','\x20\x20\x20-\x20Gateway:\x20','\x20\x20\x20-\x20gatewayPaymentId:\x20','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','\x20timers\x20for\x20payment\x20','❌\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','🛑\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','findMany','\x20days\x20without\x20payment\x20confirmation','map','get','h),\x20skipping\x20global\x20check','\x20\x20\x20📅\x20Time:\x20','\x20(age:\x20','/status/','description','59435pqGQRU','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','cointopay_status_check_','✅\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','defineProperty','entries','🪙\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','status','❌\x20[TIMER]\x20Failed\x20individual\x20check\x20#','✅\x20[DEBUG]\x20Successfully\x20scheduled\x20','paymentId','./telegramBotService','EXPIRED','\x20\x20\x20Amount:\x20',',\x20status=','log','🏦\x20[CHECK]\x20Saved\x20IBAN:\x20','convertToUSDT','gatewayPaymentId','🪙\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:',':\x20type=','📈\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','\x20skipped,\x20','💰\x20[CHECK]\x20Payment\x20','gatewaySettings','116PpweFh','cointopay_auto_expired','🛑\x20[SHUTDOWN]\x20Cleared\x20','parse','\x20days\x20(created\x20before\x20','status_check','created','31095pkofZN','toFixed','Failed\x20to\x20send\x20shop\x20webhook:','size','📊\x20[CHECK]\x20CoinToPay\x20payment\x20',',\x20using\x20default\x2010%','🔍\x20[CHECK]\x20Checking\x20','\x20updated\x20successfully','confirmedOn','🪙\x20[GLOBAL]\x20Found\x20','✅\x20[CHECK]\x20Payment\x20','telegramBotService','✅\x20[TIMER]\x20Individual\x20check\x20#','cointopay','\x20expired\x20CoinToPay\x20payments','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','getGatewayIdByName','paymentTimers','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','clearPaymentTimers','__esModule','catch','checkPaymentStatus','amount','getPaymentTimerInfo','❌\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','default','✅\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','logShopWebhookError','📊\x20[CHECK]\x20Payment\x20','5\x20minutes','❌\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','2679726qaeUiJ','\x20\x20\x20-\x20GatewayPaymentId:\x20','🪙\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','\x20in\x20','coinToPayService','length','checkPaymentById','loggerService','logCoinToPayStatus','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','\x20\x20\x20-\x20ShopId:\x20','\x20\x20\x20❌\x20Error:\x20','\x20\x20\x20-\x20Amount:\x20','from','getDate','✅\x20[COINTOPAY]\x20Payment\x20link\x20','✅\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','logShopWebhookSent','-day\x20timeout','cointopay_status_check_error','PENDING','./currencyService','\x20is\x20too\x20new\x20(','POST','\x20\x20\x20📊\x20Status:\x20','FAILED','sendPaymentStatusNotification','sendShopWebhook','getServiceStats','cointopay2','checkAllPendingPayments','sendPaymentNotification','settings','paymentDetails','set','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','customerName','\x20individual\x20payment\x20timers','now','remitterIban','bankDetails','71202xYaWdN','Webhook\x20event\x20','\x20\x20\x20📍\x20Source:\x20','⏰\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','Unknown\x20error','No\x20specific\x20commission\x20found\x20for\x20gateway\x20','getTime','update','gatewayOrderId','\x20amounts\x20calculated:','⏰\x20[HOURLY]\x20Payment\x20','application/json','\x20status\x20from\x20','\x20found:','57849aCgZDO','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','CoinToPayService','⏰\x20[DEBUG]\x20Scheduled\x20check\x20#','.\x20Remaining\x20active\x20timers:\x20','\x20\x20\x20📝\x20Context:','✅\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','632FoqCGL','has','⚠️\x20[CHECK]\x20Payment\x20','webhookUrl','floor','\x20completed\x20for\x20payment\x20','🔍\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','❌\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','\x20details:','push','\x20has\x20no\x20gatewayPaymentId,\x20skipping','\x20days,\x20marking\x20as\x20EXPIRED','🧹\x20[CHECK]\x20Payment\x20','CoinToPayStatusService','startPeriodicStatusCheck','currency','✅\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','shopId','Bank\x20Details:\x20','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','webhookLog','\x20status\x20is\x20','❌\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','Gateway\x20','\x20for\x20payment\x20','46YDgCqA','values','❌\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','timestamp','Automatically\x20expired\x20after\x20','🪙\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','⏰\x20[GLOBAL]\x20Found\x20','GLOBAL_CHECK_INTERVAL_MS','amountAfterGatewayCommissionUSDT','\x20\x20\x20Gateway\x20','checkExpiredPayments','\x20is\x20older\x20than\x20','paymentLink','timers','📊\x20[HOURLY]\x20Payment\x20','create','\x20not\x20enabled\x20for\x20shop\x20','coinToPay2Service','\x20marked\x20as\x20paid\x20at:\x20',',\x20stopping\x20individual\x20checks','toISOString','getGatewayCommission','EXPIRY_DAYS','🪙\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','\x20updated:\x20currentPayments=','auto_expire','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','findUnique','adminNotes','🆔\x20[CHECK]\x20Transaction\x20ID:\x20','includes','TesSoft\x20Payment\x20System/1.0','\x20->\x20','setDate','./loggerService','✅\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20'];a38_0x3650=function(){return _0x25c443;};return a38_0x3650();}var __importDefault=this&&this['__importDefault']||function(_0x4a5de6){const _0x4df1ad=a38_0x1e09;return _0x4a5de6&&_0x4a5de6[_0x4df1ad(0x2c7)]?_0x4a5de6:{'default':_0x4a5de6};};Object[a38_0x55bd31(0x297)](exports,a38_0x55bd31(0x2c7),{'value':!![]}),exports[a38_0x55bd31(0x262)]=exports[a38_0x55bd31(0x20d)]=void 0x0;const coinToPayService_1=require(a38_0x55bd31(0x250)),coinToPay2Service_1=require('./gateways/coinToPay2Service'),gateway_1=require('../types/gateway'),database_1=__importDefault(require(a38_0x55bd31(0x25c))),telegramBotService_1=require(a38_0x55bd31(0x29e)),loggerService_1=require(a38_0x55bd31(0x23b)),currencyService_1=require(a38_0x55bd31(0x2e8));class CoinToPayStatusService{constructor(){const _0x3263c9=a38_0x55bd31;this['globalCheckInterval']=null,this[_0x3263c9(0x220)]=0x3c*0x3c*0x3e8,this[_0x3263c9(0x22f)]=0x5,this['paymentTimers']=new Map(),this['coinToPayService']=new coinToPayService_1[(_0x3263c9(0x1fb))](),this[_0x3263c9(0x22a)]=new coinToPay2Service_1['CoinToPay2Service'](),console[_0x3263c9(0x2a2)](_0x3263c9(0x230));}[a38_0x55bd31(0x25d)](_0x3aab4a,_0x18a523){const _0x16c2b4=a38_0x55bd31;console[_0x16c2b4(0x2a2)](_0x16c2b4(0x2a6)),console[_0x16c2b4(0x2a2)]('\x20\x20\x20-\x20paymentId:\x20'+_0x3aab4a),console[_0x16c2b4(0x2a2)](_0x16c2b4(0x285)+_0x18a523),this['clearPaymentTimers'](_0x3aab4a);const _0x81b695=[],_0x4f37ad=new Date(),_0x505cd8=[{'delay':0x1*0x3c*0x3e8,'description':'1\x20minute'},{'delay':0x2*0x3c*0x3e8,'description':_0x16c2b4(0x25e)},{'delay':0x5*0x3c*0x3e8,'description':_0x16c2b4(0x2d1)},{'delay':0x5*0x3c*0x3e8,'description':_0x16c2b4(0x2d1)}];console[_0x16c2b4(0x2a2)](_0x16c2b4(0x241)+_0x505cd8[_0x16c2b4(0x2d8)]+'\x20initial\x20timers\x20for\x20payment\x20'+_0x3aab4a);let _0x3fa6f2=0x0;_0x505cd8[_0x16c2b4(0x24e)]((_0x1cd7be,_0x30c9ab)=>{const _0x2349bc=_0x16c2b4;_0x3fa6f2+=_0x1cd7be['delay'];const _0xcc9bbc=setTimeout(async()=>{const _0x4cfa50=a38_0x1e09;console[_0x4cfa50(0x2a2)](_0x4cfa50(0x25a)+(_0x30c9ab+0x1)+'\x20triggered\x20for\x20payment\x20'+_0x3aab4a+'\x20(after\x20'+_0x1cd7be[_0x4cfa50(0x292)]+')');try{await this['checkSinglePaymentById'](_0x3aab4a),console[_0x4cfa50(0x2a2)](_0x4cfa50(0x2bf)+(_0x30c9ab+0x1)+_0x4cfa50(0x205)+_0x3aab4a);}catch(_0x4d7027){console[_0x4cfa50(0x257)](_0x4cfa50(0x29b)+(_0x30c9ab+0x1)+_0x4cfa50(0x218)+_0x3aab4a+':',_0x4d7027),this[_0x4cfa50(0x23d)](_0x3aab4a,_0x18a523,_0x4d7027,_0x4cfa50(0x2b1),{'checkNumber':_0x30c9ab+0x1,'scheduledAfter':_0x1cd7be['description'],'isIndividualCheck':!![]});}},_0x3fa6f2);_0x81b695[_0x2349bc(0x209)](_0xcc9bbc),console[_0x2349bc(0x2a2)](_0x2349bc(0x1fc)+(_0x30c9ab+0x1)+_0x2349bc(0x218)+_0x3aab4a+_0x2349bc(0x2d6)+_0x3fa6f2/0x3e8+_0x2349bc(0x25f)+_0x1cd7be[_0x2349bc(0x292)]+')');});const _0x3a5097=setInterval(async()=>{const _0x48a167=_0x16c2b4;console[_0x48a167(0x2a2)](_0x48a167(0x21e)+_0x3aab4a);try{const _0x414582=await database_1[_0x48a167(0x2cd)]['payment'][_0x48a167(0x234)]({'where':{'id':_0x3aab4a},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x414582){console[_0x48a167(0x2a2)]('❌\x20[HOURLY]\x20Payment\x20'+_0x3aab4a+_0x48a167(0x240)),this[_0x48a167(0x2c6)](_0x3aab4a);return;}console['log'](_0x48a167(0x227)+_0x3aab4a+'\x20current\x20status:\x20'+_0x414582[_0x48a167(0x29a)]);if(_0x414582[_0x48a167(0x29a)]!==_0x48a167(0x2e7)){console['log']('✅\x20[HOURLY]\x20Payment\x20'+_0x3aab4a+_0x48a167(0x215)+_0x414582['status']+_0x48a167(0x22c)),this[_0x48a167(0x2c6)](_0x3aab4a);return;}const _0x86265f=Math['floor']((Date[_0x48a167(0x1e8)]()-_0x414582['createdAt'][_0x48a167(0x1f1)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x86265f>=this['EXPIRY_DAYS']){console[_0x48a167(0x2a2)](_0x48a167(0x1f5)+_0x3aab4a+'\x20is\x20older\x20than\x20'+this[_0x48a167(0x22f)]+_0x48a167(0x26b)),this['clearPaymentTimers'](_0x3aab4a);return;}await this['checkSinglePaymentById'](_0x3aab4a),console[_0x48a167(0x2a2)](_0x48a167(0x26a)+_0x3aab4a);}catch(_0x4bd273){console['error'](_0x48a167(0x2d2)+_0x3aab4a+':',_0x4bd273),this[_0x48a167(0x23d)](_0x3aab4a,_0x18a523,_0x4bd273,_0x48a167(0x2b1),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x81b695[_0x16c2b4(0x209)](_0x3a5097),this[_0x16c2b4(0x2c4)][_0x16c2b4(0x1e4)](_0x3aab4a,{'timers':_0x81b695,'paymentId':_0x3aab4a,'gatewayPaymentId':_0x18a523,'createdAt':_0x4f37ad}),console[_0x16c2b4(0x2a2)](_0x16c2b4(0x29c)+_0x505cd8[_0x16c2b4(0x2d8)]+_0x16c2b4(0x2c5)+_0x3aab4a),console['log']('📊\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20'+this[_0x16c2b4(0x2c4)]['size']),this[_0x16c2b4(0x2db)](_0x3aab4a,_0x18a523,'PENDING',_0x16c2b4(0x2e7),_0x16c2b4(0x2b1),{'action':'schedule_created','scheduledChecks':_0x505cd8[_0x16c2b4(0x2d8)],'firstCheckIn':_0x505cd8[0x0]['delay']/0x3e8,'totalTimers':this['paymentTimers'][_0x16c2b4(0x2b6)]});}['clearPaymentTimers'](_0x1031e6){const _0x2a7582=a38_0x55bd31,_0x5c3ac2=this[_0x2a7582(0x2c4)][_0x2a7582(0x28d)](_0x1031e6);_0x5c3ac2?(console[_0x2a7582(0x2a2)]('🧹\x20[DEBUG]\x20Clearing\x20'+_0x5c3ac2[_0x2a7582(0x226)][_0x2a7582(0x2d8)]+_0x2a7582(0x287)+_0x1031e6),_0x5c3ac2[_0x2a7582(0x226)][_0x2a7582(0x24e)]((_0x13fbdf,_0x26c1c6)=>{const _0x5e6abe=_0x2a7582;_0x13fbdf&&(clearTimeout(_0x13fbdf),clearInterval(_0x13fbdf),console[_0x5e6abe(0x2a2)]('🧹\x20[DEBUG]\x20Cleared\x20timer\x20#'+(_0x26c1c6+0x1)+'\x20for\x20payment\x20'+_0x1031e6));}),this['paymentTimers']['delete'](_0x1031e6),console['log'](_0x2a7582(0x1ff)+_0x1031e6+_0x2a7582(0x1fd)+this[_0x2a7582(0x2c4)][_0x2a7582(0x2b6)])):console[_0x2a7582(0x2a2)](_0x2a7582(0x263)+_0x1031e6+'\x20to\x20clear');}async['checkSinglePaymentById'](_0xa3de3f){const _0x16b268=a38_0x55bd31;console[_0x16b268(0x2a2)](_0x16b268(0x26e)+_0xa3de3f);const _0x1a3e9b=await database_1[_0x16b268(0x2cd)][_0x16b268(0x26f)][_0x16b268(0x234)]({'where':{'id':_0xa3de3f},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x1a3e9b){console[_0x16b268(0x2a2)](_0x16b268(0x279)+_0xa3de3f+_0x16b268(0x27d));return;}console['log'](_0x16b268(0x2d0)+_0xa3de3f+_0x16b268(0x1f8)),console[_0x16b268(0x2a2)](_0x16b268(0x284)+_0x1a3e9b[_0x16b268(0x283)]),console[_0x16b268(0x2a2)]('\x20\x20\x20-\x20Status:\x20'+_0x1a3e9b[_0x16b268(0x29a)]),console['log'](_0x16b268(0x2d4)+_0x1a3e9b[_0x16b268(0x2a5)]),console[_0x16b268(0x2a2)](_0x16b268(0x2df)+_0x1a3e9b[_0x16b268(0x2ca)]+'\x20'+_0x1a3e9b['currency']),console[_0x16b268(0x2a2)](_0x16b268(0x2dd)+_0x1a3e9b[_0x16b268(0x211)]);if(_0x1a3e9b['gateway']!==_0x16b268(0x2c0)&&_0x1a3e9b[_0x16b268(0x283)]!==_0x16b268(0x2f0)){console['log'](_0x16b268(0x202)+_0xa3de3f+_0x16b268(0x1fa)+_0x1a3e9b['gateway']+')');return;}if(_0x1a3e9b[_0x16b268(0x29a)]!==_0x16b268(0x2e7)){console[_0x16b268(0x2a2)](_0x16b268(0x202)+_0xa3de3f+_0x16b268(0x215)+_0x1a3e9b[_0x16b268(0x29a)]+_0x16b268(0x22c)),this[_0x16b268(0x2c6)](_0xa3de3f);return;}if(!_0x1a3e9b['gatewayPaymentId']){console[_0x16b268(0x2a2)](_0x16b268(0x202)+_0xa3de3f+_0x16b268(0x268));return;}console[_0x16b268(0x2a2)](_0x16b268(0x2bd)+_0xa3de3f+_0x16b268(0x270)),await this['checkSinglePayment'](_0x1a3e9b);}[a38_0x55bd31(0x2db)](_0x20e817,_0x3d727d,_0x7405b9,_0x5d7e58,_0xba6a69,_0x1dadee){const _0x57c765=a38_0x55bd31,_0x3bf927={'type':_0x57c765(0x24c),'paymentId':_0x20e817,'gatewayPaymentId':_0x3d727d,'oldStatus':_0x7405b9,'newStatus':_0x5d7e58,'source':_0xba6a69,'timestamp':new Date()[_0x57c765(0x22d)](),'details':_0x1dadee||{}};loggerService_1[_0x57c765(0x2da)][_0x57c765(0x2db)](_0x3bf927),console[_0x57c765(0x2a2)](_0x57c765(0x299)+_0x20e817+'\x20('+_0x3d727d+')'),console[_0x57c765(0x2a2)](_0x57c765(0x2eb)+_0x7405b9+'\x20->\x20'+_0x5d7e58),console['log'](_0x57c765(0x1ed)+_0xba6a69),console[_0x57c765(0x2a2)](_0x57c765(0x28f)+_0x3bf927[_0x57c765(0x21c)]),_0x1dadee&&console[_0x57c765(0x2a2)]('\x20\x20\x20📝\x20Details:',_0x1dadee);}[a38_0x55bd31(0x23d)](_0x17b77c,_0x144307,_0x28b2f5,_0x1a8ae4,_0x1703ad){const _0x5ef755=a38_0x55bd31,_0x427ed1={'type':_0x5ef755(0x275),'paymentId':_0x17b77c,'gatewayPaymentId':_0x144307,'error':_0x28b2f5 instanceof Error?{'message':_0x28b2f5[_0x5ef755(0x256)],'stack':_0x28b2f5['stack']}:_0x28b2f5,'source':_0x1a8ae4,'timestamp':new Date()[_0x5ef755(0x22d)](),'context':_0x1703ad||{}};loggerService_1[_0x5ef755(0x2da)][_0x5ef755(0x23d)](_0x427ed1),console[_0x5ef755(0x257)](_0x5ef755(0x243)+_0x17b77c+'\x20('+_0x144307+')'),console[_0x5ef755(0x257)](_0x5ef755(0x2de)+(_0x28b2f5 instanceof Error?_0x28b2f5[_0x5ef755(0x256)]:_0x28b2f5)),console[_0x5ef755(0x257)](_0x5ef755(0x1ed)+_0x1a8ae4),console[_0x5ef755(0x257)](_0x5ef755(0x28f)+_0x427ed1[_0x5ef755(0x21c)]),_0x1703ad&&console['error'](_0x5ef755(0x1fe),_0x1703ad);}[a38_0x55bd31(0x20e)](){const _0x29ae57=a38_0x55bd31;console[_0x29ae57(0x2a2)]('🪙\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)'),this['checkAllPendingPayments']()[_0x29ae57(0x2c8)](_0x3ab936=>{const _0x2525d2=_0x29ae57;console[_0x2525d2(0x257)](_0x2525d2(0x216),_0x3ab936);}),this['globalCheckInterval']=setInterval(async()=>{const _0x34821c=_0x29ae57;try{console['log']('🪙\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...'),await this['checkAllPendingPayments'](),console[_0x34821c(0x2a2)](_0x34821c(0x296));}catch(_0xcc910f){console[_0x34821c(0x257)](_0x34821c(0x207),_0xcc910f);}},this[_0x29ae57(0x220)]),console['log'](_0x29ae57(0x2e3));}['stopPeriodicStatusCheck'](){const _0x43d9f2=a38_0x55bd31;console[_0x43d9f2(0x2a2)](_0x43d9f2(0x264));this[_0x43d9f2(0x24d)]&&(clearInterval(this[_0x43d9f2(0x24d)]),this['globalCheckInterval']=null,console[_0x43d9f2(0x2a2)](_0x43d9f2(0x289)));const _0x29debe=this[_0x43d9f2(0x2c4)]['size'];for(const [_0x7d3fac]of this[_0x43d9f2(0x2c4)]){this[_0x43d9f2(0x2c6)](_0x7d3fac);}console[_0x43d9f2(0x2a2)](_0x43d9f2(0x2ae)+_0x29debe+_0x43d9f2(0x1e7));}async[a38_0x55bd31(0x1e0)](){const _0x5a3199=a38_0x55bd31;try{console[_0x5a3199(0x2a2)](_0x5a3199(0x278));const _0x29be47=await database_1[_0x5a3199(0x2cd)][_0x5a3199(0x26f)][_0x5a3199(0x28a)]({'where':{'gateway':{'in':[_0x5a3199(0x2c0),_0x5a3199(0x2f0)]},'status':_0x5a3199(0x2e7),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x5a3199(0x2a2)](_0x5a3199(0x2bc)+_0x29be47['length']+'\x20pending\x20CoinToPay\x20payments');if(_0x29be47[_0x5a3199(0x2d8)]===0x0){console['log'](_0x5a3199(0x2d5));return;}const _0x1007a0=await this['checkExpiredPayments'](_0x29be47);console[_0x5a3199(0x2a2)](_0x5a3199(0x21f)+_0x1007a0[_0x5a3199(0x2d8)]+_0x5a3199(0x2c1));let _0x407fc3=0x0,_0x42fc47=0x0;for(const _0x179a94 of _0x29be47){try{if(_0x1007a0[_0x5a3199(0x237)](_0x179a94['id'])){console['log']('⏰\x20[GLOBAL]\x20Payment\x20'+_0x179a94['id']+_0x5a3199(0x1e5)),_0x42fc47++;continue;}if(this[_0x5a3199(0x2c4)][_0x5a3199(0x201)](_0x179a94['id'])){console[_0x5a3199(0x2a2)](_0x5a3199(0x254)+_0x179a94['id']+_0x5a3199(0x213)),_0x42fc47++;continue;}const _0x9f25f2=(Date['now']()-_0x179a94[_0x5a3199(0x23e)][_0x5a3199(0x1f1)]())/(0x3e8*0x3c*0x3c);if(_0x9f25f2<0x1){console[_0x5a3199(0x2a2)](_0x5a3199(0x254)+_0x179a94['id']+_0x5a3199(0x2e9)+_0x9f25f2[_0x5a3199(0x2b4)](0x1)+_0x5a3199(0x28e)),_0x42fc47++;continue;}console[_0x5a3199(0x2a2)](_0x5a3199(0x206)+_0x179a94['id']+_0x5a3199(0x290)+_0x9f25f2['toFixed'](0x1)+'h)'),await this[_0x5a3199(0x27b)](_0x179a94),_0x407fc3++,await new Promise(_0x7981d8=>setTimeout(_0x7981d8,0x7d0));}catch(_0x551f7f){console[_0x5a3199(0x257)](_0x5a3199(0x2cc)+_0x179a94['id']+':',_0x551f7f),this[_0x5a3199(0x23d)](_0x179a94['id'],_0x179a94[_0x5a3199(0x2a5)]||_0x5a3199(0x242),_0x551f7f,_0x5a3199(0x2b1),{'isGlobalCheck':!![],'paymentAmount':_0x179a94['amount'],'paymentCurrency':_0x179a94['currency'],'shopId':_0x179a94['shopId'],'createdAt':_0x179a94[_0x5a3199(0x23e)]}),loggerService_1[_0x5a3199(0x2da)][_0x5a3199(0x259)](_0x5a3199(0x2c0),_0x5a3199(0x291)+_0x179a94[_0x5a3199(0x2a5)],_0x551f7f);}}console[_0x5a3199(0x2a2)](_0x5a3199(0x2ce)+_0x407fc3+'\x20checked,\x20'+_0x42fc47+_0x5a3199(0x2a9)+_0x1007a0['length']+'\x20expired');}catch(_0x21e1a9){console[_0x5a3199(0x257)]('❌\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:',_0x21e1a9);}}async[a38_0x55bd31(0x223)](_0x2b3c11){const _0x70b60d=a38_0x55bd31,_0x93e8d9=[],_0xc0c27b=new Date();_0xc0c27b[_0x70b60d(0x23a)](_0xc0c27b[_0x70b60d(0x2e1)]()-this[_0x70b60d(0x22f)]),console[_0x70b60d(0x2a2)](_0x70b60d(0x1ee)+this[_0x70b60d(0x22f)]+_0x70b60d(0x2b0)+_0xc0c27b[_0x70b60d(0x22d)]()+')');for(const _0x19e699 of _0x2b3c11){if(_0x19e699[_0x70b60d(0x23e)]<_0xc0c27b){console[_0x70b60d(0x2a2)](_0x70b60d(0x245)+_0x19e699['id']+_0x70b60d(0x224)+this['EXPIRY_DAYS']+_0x70b60d(0x20b));try{this[_0x70b60d(0x2db)](_0x19e699['id'],_0x19e699[_0x70b60d(0x2a5)]||'unknown','PENDING',_0x70b60d(0x29f),_0x70b60d(0x232),{'reason':_0x70b60d(0x23f)+this[_0x70b60d(0x22f)]+'\x20days','createdAt':_0x19e699[_0x70b60d(0x23e)],'daysSinceCreation':Math['floor']((Date[_0x70b60d(0x1e8)]()-_0x19e699[_0x70b60d(0x23e)][_0x70b60d(0x1f1)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x19e699[_0x70b60d(0x2ca)],'paymentCurrency':_0x19e699[_0x70b60d(0x20f)],'shopId':_0x19e699['shopId']}),await database_1[_0x70b60d(0x2cd)]['payment'][_0x70b60d(0x1f2)]({'where':{'id':_0x19e699['id']},'data':{'status':_0x70b60d(0x29f),'updatedAt':new Date(),'adminNotes':_0x70b60d(0x21d)+this['EXPIRY_DAYS']+_0x70b60d(0x28b)}}),await database_1[_0x70b60d(0x2cd)][_0x70b60d(0x214)][_0x70b60d(0x228)]({'data':{'paymentId':_0x19e699['id'],'shopId':_0x19e699[_0x70b60d(0x211)],'event':_0x70b60d(0x2ad),'statusCode':0xc8,'responseBody':JSON['stringify']({'reason':_0x70b60d(0x23f)+this[_0x70b60d(0x22f)]+'\x20days','createdAt':_0x19e699['createdAt'],'expiredAt':new Date()[_0x70b60d(0x22d)](),'daysSinceCreation':Math[_0x70b60d(0x204)]((Date[_0x70b60d(0x1e8)]()-_0x19e699[_0x70b60d(0x23e)]['getTime']())/(0x3e8*0x3c*0x3c*0x18))})}}),await this['sendShopWebhook'](_0x19e699,_0x70b60d(0x29f)),await this[_0x70b60d(0x2ed)](_0x19e699,'EXPIRED'),this[_0x70b60d(0x2c6)](_0x19e699['id']),_0x93e8d9[_0x70b60d(0x209)](_0x19e699['id']),console[_0x70b60d(0x2a2)](_0x70b60d(0x277)+_0x19e699['id']+_0x70b60d(0x294)+this[_0x70b60d(0x22f)]+_0x70b60d(0x2e5));}catch(_0x2f0f01){console[_0x70b60d(0x257)]('❌\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20'+_0x19e699['id']+':',_0x2f0f01),this[_0x70b60d(0x23d)](_0x19e699['id'],_0x19e699[_0x70b60d(0x2a5)]||_0x70b60d(0x242),_0x2f0f01,_0x70b60d(0x232),{'reason':_0x70b60d(0x266),'createdAt':_0x19e699[_0x70b60d(0x23e)],'daysSinceCreation':Math['floor']((Date[_0x70b60d(0x1e8)]()-_0x19e699[_0x70b60d(0x23e)]['getTime']())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x93e8d9;}async[a38_0x55bd31(0x27b)](_0xaace3e){const _0x30c370=a38_0x55bd31;if(!_0xaace3e['gatewayPaymentId']){console[_0x30c370(0x2a2)]('⚠️\x20[CHECK]\x20Payment\x20'+_0xaace3e['id']+_0x30c370(0x20a));return;}console[_0x30c370(0x2a2)](_0x30c370(0x2b9)+_0xaace3e['gateway']+_0x30c370(0x276)+_0xaace3e['id']+'\x20('+_0xaace3e[_0x30c370(0x2a5)]+')');try{let _0x32e822;_0xaace3e[_0x30c370(0x283)]===_0x30c370(0x2f0)?(_0x32e822=await this[_0x30c370(0x22a)][_0x30c370(0x2c9)](_0xaace3e[_0x30c370(0x2a5)]),console['log'](_0x30c370(0x282)+_0xaace3e['id']+_0x30c370(0x246)+_0x32e822[_0x30c370(0x29a)])):(_0x32e822=await this[_0x30c370(0x2d7)][_0x30c370(0x2c9)](_0xaace3e[_0x30c370(0x2a5)]),console['log'](_0x30c370(0x2b7)+_0xaace3e['id']+_0x30c370(0x246)+_0x32e822[_0x30c370(0x29a)]));_0x32e822['paymentDetails']&&console[_0x30c370(0x2a2)](_0x30c370(0x2d0)+_0xaace3e['id']+_0x30c370(0x208),{'iban':_0x32e822[_0x30c370(0x1e3)]['iban']||'not\x20found','transactionId':_0x32e822[_0x30c370(0x1e3)][_0x30c370(0x253)],'createdOn':_0x32e822[_0x30c370(0x1e3)]['createdOn'],'confirmedOn':_0x32e822['paymentDetails'][_0x30c370(0x2bb)]||'not\x20confirmed'});if(_0x32e822[_0x30c370(0x29a)]!==_0xaace3e[_0x30c370(0x29a)]){console[_0x30c370(0x2a2)](_0x30c370(0x260)+_0xaace3e['id']+_0x30c370(0x1f7)+_0xaace3e['status']+_0x30c370(0x271)+_0x32e822[_0x30c370(0x29a)]),this[_0x30c370(0x2db)](_0xaace3e['id'],_0xaace3e[_0x30c370(0x2a5)],_0xaace3e[_0x30c370(0x29a)],_0x32e822[_0x30c370(0x29a)],'status_check',{'paymentDetails':_0x32e822['paymentDetails'],'amount':_0x32e822[_0x30c370(0x2ca)],'currency':_0x32e822[_0x30c370(0x20f)],'shopId':_0xaace3e['shopId'],'checkTimestamp':new Date()[_0x30c370(0x22d)]()});const _0x8edef={'status':_0x32e822[_0x30c370(0x29a)],'updatedAt':new Date()};if(_0x32e822[_0x30c370(0x29a)]==='PAID'&&_0xaace3e[_0x30c370(0x29a)]!==_0x30c370(0x272)){_0x8edef[_0x30c370(0x269)]=new Date();if(!_0xaace3e['amountUSDT']){const _0x2073c3=await currencyService_1['currencyService'][_0x30c370(0x2a4)](_0xaace3e[_0x30c370(0x2ca)],_0xaace3e[_0x30c370(0x20f)]);_0x8edef['amountUSDT']=_0x2073c3;const _0x51d1f5=await this[_0x30c370(0x22e)](_0xaace3e['shopId'],_0xaace3e[_0x30c370(0x283)]),_0x28e965=_0x2073c3*(0x1-_0x51d1f5/0x64);_0x8edef[_0x30c370(0x221)]=_0x28e965,console[_0x30c370(0x2a2)](_0x30c370(0x2aa)+_0xaace3e['id']+_0x30c370(0x1f4)),console['log'](_0x30c370(0x2a0)+_0xaace3e[_0x30c370(0x2ca)]+'\x20'+_0xaace3e['currency']+_0x30c370(0x239)+_0x2073c3[_0x30c370(0x2b4)](0x6)+'\x20USDT'),console[_0x30c370(0x2a2)](_0x30c370(0x222)+_0xaace3e[_0x30c370(0x283)]+_0x30c370(0x258)+_0x51d1f5+'%'),console[_0x30c370(0x2a2)]('\x20\x20\x20Amount\x20after\x20commission:\x20'+_0x28e965['toFixed'](0x6)+'\x20USDT');}console[_0x30c370(0x2a2)]('💰\x20[CHECK]\x20Payment\x20'+_0xaace3e['id']+_0x30c370(0x22b)+_0x8edef[_0x30c370(0x269)][_0x30c370(0x22d)]());}if(_0x32e822[_0x30c370(0x1e3)]){const _0x20bce0=_0x32e822['paymentDetails'];_0x20bce0[_0x30c370(0x252)]&&(_0x8edef[_0x30c370(0x1e9)]=_0x20bce0[_0x30c370(0x252)],console[_0x30c370(0x2a2)](_0x30c370(0x2a3)+_0x20bce0[_0x30c370(0x252)]));if(_0x20bce0[_0x30c370(0x1ea)]){const _0x265898=_0xaace3e[_0x30c370(0x235)]||'',_0x1df4fa=_0x30c370(0x212)+_0x20bce0['bankDetails'];_0x8edef[_0x30c370(0x235)]=_0x265898?_0x265898+'\x0a\x0a'+_0x1df4fa:_0x1df4fa,console['log'](_0x30c370(0x24b));}_0x20bce0[_0x30c370(0x253)]&&console[_0x30c370(0x2a2)](_0x30c370(0x236)+_0x20bce0['transactionId']),_0x20bce0['confirmedOn']&&console[_0x30c370(0x2a2)]('✅\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20'+_0x20bce0[_0x30c370(0x2bb)]);}await database_1['default']['payment'][_0x30c370(0x1f2)]({'where':{'id':_0xaace3e['id']},'data':_0x8edef});if(_0x32e822['status']==='PAID'&&_0xaace3e[_0x30c370(0x29a)]!==_0x30c370(0x272)){console[_0x30c370(0x2a2)]('📈\x20[COINTOPAY]\x20Payment\x20'+_0xaace3e['id']+'\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link');const _0x37d6cd=await database_1[_0x30c370(0x2cd)][_0x30c370(0x26f)][_0x30c370(0x234)]({'where':{'id':_0xaace3e['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x37d6cd?.['paymentLinkId']&&_0x37d6cd[_0x30c370(0x225)])try{const _0x399a6e=_0x37d6cd[_0x30c370(0x225)];console[_0x30c370(0x2a2)](_0x30c370(0x2a8)+_0x399a6e['id']+_0x30c370(0x2a7)+_0x399a6e[_0x30c370(0x24f)]+_0x30c370(0x27c)+_0x399a6e[_0x30c370(0x249)]+_0x30c370(0x2a1)+_0x399a6e[_0x30c370(0x29a)]);const _0x427259=_0x399a6e[_0x30c370(0x249)]+0x1,_0x5829a2=_0x399a6e['type']===_0x30c370(0x27a)?'COMPLETED':_0x399a6e['status'];await database_1[_0x30c370(0x2cd)][_0x30c370(0x225)][_0x30c370(0x1f2)]({'where':{'id':_0x399a6e['id']},'data':{'currentPayments':_0x427259,'status':_0x5829a2,'updatedAt':new Date()}}),console[_0x30c370(0x2a2)](_0x30c370(0x2e2)+_0x399a6e['id']+_0x30c370(0x231)+_0x399a6e['currentPayments']+_0x30c370(0x239)+_0x427259+_0x30c370(0x2a1)+_0x399a6e[_0x30c370(0x29a)]+'\x20->\x20'+_0x5829a2);}catch(_0x37f848){console[_0x30c370(0x257)](_0x30c370(0x21b),_0x37f848);}else console[_0x30c370(0x2a2)](_0x30c370(0x280)+_0xaace3e['id']+'\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link');}await database_1['default'][_0x30c370(0x214)][_0x30c370(0x228)]({'data':{'paymentId':_0xaace3e['id'],'shopId':_0xaace3e['shopId'],'event':_0x30c370(0x295)+_0x32e822[_0x30c370(0x29a)][_0x30c370(0x274)](),'statusCode':0xc8,'responseBody':JSON[_0x30c370(0x265)]({'oldStatus':_0xaace3e[_0x30c370(0x29a)],'newStatus':_0x32e822[_0x30c370(0x29a)],'paymentDetails':_0x32e822[_0x30c370(0x1e3)],'checkedAt':new Date()[_0x30c370(0x22d)]()})}}),await this[_0x30c370(0x2ee)](_0xaace3e,_0x32e822[_0x30c370(0x29a)]),await this[_0x30c370(0x2ed)](_0xaace3e,_0x32e822['status']),_0x32e822[_0x30c370(0x29a)]!==_0x30c370(0x2e7)&&(console[_0x30c370(0x2a2)](_0x30c370(0x20c)+_0xaace3e['id']+_0x30c370(0x247)+_0x32e822['status']+',\x20clearing\x20individual\x20timers'),this[_0x30c370(0x2c6)](_0xaace3e['id'])),console[_0x30c370(0x2a2)](_0x30c370(0x2bd)+_0xaace3e['id']+_0x30c370(0x2ba));}else console[_0x30c370(0x2a2)](_0x30c370(0x2d0)+_0xaace3e['id']+_0x30c370(0x26c)+_0x32e822[_0x30c370(0x29a)]+')'),this['logCoinToPayStatus'](_0xaace3e['id'],_0xaace3e[_0x30c370(0x2a5)],_0xaace3e[_0x30c370(0x29a)],_0x32e822[_0x30c370(0x29a)],_0x30c370(0x2b1),{'statusUnchanged':!![],'paymentDetails':_0x32e822['paymentDetails'],'amount':_0x32e822[_0x30c370(0x2ca)],'currency':_0x32e822[_0x30c370(0x20f)],'shopId':_0xaace3e['shopId'],'checkTimestamp':new Date()[_0x30c370(0x22d)]()});}catch(_0x4b1f42){console['error'](_0x30c370(0x288)+_0xaace3e['id']+':',_0x4b1f42),this[_0x30c370(0x23d)](_0xaace3e['id'],_0xaace3e['gatewayPaymentId'],_0x4b1f42,_0x30c370(0x2b1),{'paymentAmount':_0xaace3e[_0x30c370(0x2ca)],'paymentCurrency':_0xaace3e['currency'],'shopId':_0xaace3e[_0x30c370(0x211)],'createdAt':_0xaace3e[_0x30c370(0x23e)]}),await database_1[_0x30c370(0x2cd)][_0x30c370(0x214)][_0x30c370(0x228)]({'data':{'paymentId':_0xaace3e['id'],'shopId':_0xaace3e[_0x30c370(0x211)],'event':_0x30c370(0x2e6),'statusCode':0x1f4,'responseBody':JSON['stringify']({'error':_0x4b1f42 instanceof Error?_0x4b1f42['message']:_0x30c370(0x1ef),'gatewayPaymentId':_0xaace3e['gatewayPaymentId'],'checkedAt':new Date()[_0x30c370(0x22d)]()})}});}}async[a38_0x55bd31(0x2ee)](_0x5f4b3c,_0x3e4fc0){const _0xfa7240=a38_0x55bd31,_0x26cc07=Date[_0xfa7240(0x1e8)]();try{const _0x490bd1=_0x5f4b3c[_0xfa7240(0x26d)],_0x5bbf6c=_0x490bd1[_0xfa7240(0x1e2)];if(!_0x5bbf6c?.[_0xfa7240(0x203)]){console[_0xfa7240(0x2a2)](_0xfa7240(0x24a)+_0x490bd1['id']);return;}const _0x381c44=_0x3e4fc0==='PAID'?'payment.success':_0x3e4fc0===_0xfa7240(0x2ec)?_0xfa7240(0x27f):_0x3e4fc0===_0xfa7240(0x29f)?_0xfa7240(0x27f):'payment.pending';if(!_0x5bbf6c['webhookEvents']?.[_0xfa7240(0x237)](_0x381c44)){console[_0xfa7240(0x2a2)](_0xfa7240(0x1ec)+_0x381c44+_0xfa7240(0x229)+_0x490bd1['id']);return;}const _0x41dde1=(0x0,gateway_1[_0xfa7240(0x2c3)])(_0x5f4b3c[_0xfa7240(0x283)])||_0x5f4b3c['gateway'],_0x3dcd8e={'event':_0x381c44,'payment':{'id':_0x5f4b3c['id'],'order_id':_0x5f4b3c[_0xfa7240(0x261)],'gateway_order_id':_0x5f4b3c[_0xfa7240(0x1f3)],'gateway':_0x41dde1,'amount':_0x5f4b3c[_0xfa7240(0x2ca)],'currency':_0x5f4b3c[_0xfa7240(0x20f)],'status':_0x3e4fc0[_0xfa7240(0x274)](),'customer_email':_0x5f4b3c[_0xfa7240(0x251)],'customer_name':_0x5f4b3c[_0xfa7240(0x1e6)],'created_at':_0x5f4b3c['createdAt'],'updated_at':new Date()}},_0x2b6e3e=await fetch(_0x5bbf6c[_0xfa7240(0x203)],{'method':_0xfa7240(0x2ea),'headers':{'Content-Type':_0xfa7240(0x1f6),'User-Agent':_0xfa7240(0x238)},'body':JSON[_0xfa7240(0x265)](_0x3dcd8e)}),_0xa19f02=Date[_0xfa7240(0x1e8)]()-_0x26cc07,_0x3079e2=_0x2b6e3e['ok']?'Success':await _0x2b6e3e[_0xfa7240(0x248)]();loggerService_1[_0xfa7240(0x2da)][_0xfa7240(0x2e4)](_0x5f4b3c[_0xfa7240(0x211)],_0x5bbf6c[_0xfa7240(0x203)],_0x381c44,_0x2b6e3e[_0xfa7240(0x29a)],_0xa19f02,_0x3dcd8e),console[_0xfa7240(0x2a2)](_0xfa7240(0x267)+_0x5bbf6c[_0xfa7240(0x203)]+'\x20with\x20status\x20'+_0x2b6e3e[_0xfa7240(0x29a)]+'\x20('+_0xa19f02+_0xfa7240(0x273));}catch(_0x33ba76){console[_0xfa7240(0x257)](_0xfa7240(0x2b5),_0x33ba76),loggerService_1[_0xfa7240(0x2da)][_0xfa7240(0x2cf)](_0x5f4b3c[_0xfa7240(0x211)],_0x5f4b3c[_0xfa7240(0x26d)]?.[_0xfa7240(0x1e2)]?.[_0xfa7240(0x203)]||_0xfa7240(0x242),'webhook_send',_0x33ba76,{});}}async['sendPaymentStatusNotification'](_0x3df14d,_0x291b90){const _0xf300dc=a38_0x55bd31;try{const _0x34de03={'PENDING':'created','PAID':'paid','FAILED':'failed','EXPIRED':_0xf300dc(0x255)},_0xd94d21=_0x34de03[_0x291b90];if(!_0xd94d21||_0xd94d21===_0xf300dc(0x2b2))return;await telegramBotService_1[_0xf300dc(0x2be)][_0xf300dc(0x1e1)](_0x3df14d[_0xf300dc(0x211)],_0x3df14d,_0xd94d21);}catch(_0x406b83){console[_0xf300dc(0x257)](_0xf300dc(0x2dc),_0x406b83);}}async[a38_0x55bd31(0x2d9)](_0x48f816){const _0x2a7a2e=a38_0x55bd31;console[_0x2a7a2e(0x2a2)]('🔍\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20'+_0x48f816);const _0x117658=await database_1[_0x2a7a2e(0x2cd)][_0x2a7a2e(0x26f)][_0x2a7a2e(0x234)]({'where':{'id':_0x48f816},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x117658)throw new Error('Payment\x20not\x20found');if(_0x117658[_0x2a7a2e(0x283)]!==_0x2a7a2e(0x2c0)&&_0x117658[_0x2a7a2e(0x283)]!=='cointopay2')throw new Error(_0x2a7a2e(0x2c2));console[_0x2a7a2e(0x2a2)](_0x2a7a2e(0x210)+_0x117658[_0x2a7a2e(0x283)]+_0x2a7a2e(0x276)+_0x48f816),await this[_0x2a7a2e(0x27b)](_0x117658),console[_0x2a7a2e(0x2a2)](_0x2a7a2e(0x23c)+_0x48f816);}[a38_0x55bd31(0x2ef)](){const _0x35d9e1=a38_0x55bd31,_0x16fd5a=this['globalCheckInterval']?this[_0x35d9e1(0x220)]:undefined,_0x2857df=Array[_0x35d9e1(0x2e0)](this[_0x35d9e1(0x2c4)][_0x35d9e1(0x21a)]())[_0x35d9e1(0x28c)](_0x2fbfce=>({'paymentId':_0x2fbfce[_0x35d9e1(0x29d)],'gatewayPaymentId':_0x2fbfce[_0x35d9e1(0x2a5)],'createdAt':_0x2fbfce[_0x35d9e1(0x23e)],'timersCount':_0x2fbfce[_0x35d9e1(0x226)]['length']}));return{'isActive':!!this[_0x35d9e1(0x24d)],'globalCheckIntervalMinutes':this[_0x35d9e1(0x220)]/(0x3e8*0x3c),'expiryDays':this[_0x35d9e1(0x22f)],'activeIndividualTimers':this[_0x35d9e1(0x2c4)][_0x35d9e1(0x2b6)],'nextGlobalCheckIn':_0x16fd5a,'paymentTimersDetails':_0x2857df};}[a38_0x55bd31(0x2cb)](_0x4cf703){const _0x557d27=a38_0x55bd31,_0x21db7=this[_0x557d27(0x2c4)][_0x557d27(0x28d)](_0x4cf703);if(_0x21db7)return{'hasTimers':!![],'timersCount':_0x21db7['timers'][_0x557d27(0x2d8)],'createdAt':_0x21db7[_0x557d27(0x23e)],'gatewayPaymentId':_0x21db7[_0x557d27(0x2a5)]};return{'hasTimers':![]};}async['getGatewayCommission'](_0x1caf6d,_0x4bc140){const _0x469160=a38_0x55bd31;try{const _0x405da5=await database_1[_0x469160(0x2cd)][_0x469160(0x26d)]['findUnique']({'where':{'id':_0x1caf6d},'select':{'gatewaySettings':!![]}});if(!_0x405da5?.[_0x469160(0x2ab)])return console[_0x469160(0x2a2)](_0x469160(0x233)+_0x1caf6d+_0x469160(0x244)),0xa;const _0x20b4c0=JSON[_0x469160(0x2af)](_0x405da5['gatewaySettings']);for(const [_0x571dcc,_0x362e5f]of Object[_0x469160(0x298)](_0x20b4c0)){if(_0x571dcc[_0x469160(0x274)]()===_0x4bc140[_0x469160(0x274)]()){const _0x569302=_0x362e5f['commission']||0xa;return console[_0x469160(0x2a2)](_0x469160(0x217)+_0x4bc140+'\x20commission\x20for\x20shop\x20'+_0x1caf6d+':\x20'+_0x569302+'%'),_0x569302;}}return console[_0x469160(0x2a2)](_0x469160(0x1f0)+_0x4bc140+'\x20in\x20shop\x20'+_0x1caf6d+_0x469160(0x2b8)),0xa;}catch(_0x58319){return console[_0x469160(0x257)](_0x469160(0x286)+_0x1caf6d+',\x20gateway\x20'+_0x4bc140+':',_0x58319),0xa;}}}exports['CoinToPayStatusService']=CoinToPayStatusService,exports[a38_0x55bd31(0x262)]=new CoinToPayStatusService();