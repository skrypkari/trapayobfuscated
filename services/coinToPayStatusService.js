'use strict';function a42_0x1d33(_0x4548af,_0xd9aa86){const _0x4465cd=a42_0x4465();return a42_0x1d33=function(_0x1d3302,_0x3a8774){_0x1d3302=_0x1d3302-0x131;let _0x5ecb22=_0x4465cd[_0x1d3302];return _0x5ecb22;},a42_0x1d33(_0x4548af,_0xd9aa86);}const a42_0x3989f2=a42_0x1d33;(function(_0x15f9e1,_0x4a699f){const _0x3e5b15=a42_0x1d33,_0x5ad1bc=_0x15f9e1();while(!![]){try{const _0x57d2e7=parseInt(_0x3e5b15(0x1ea))/0x1+parseInt(_0x3e5b15(0x188))/0x2+-parseInt(_0x3e5b15(0x235))/0x3+parseInt(_0x3e5b15(0x206))/0x4*(parseInt(_0x3e5b15(0x164))/0x5)+parseInt(_0x3e5b15(0x151))/0x6*(parseInt(_0x3e5b15(0x17d))/0x7)+-parseInt(_0x3e5b15(0x1a9))/0x8+-parseInt(_0x3e5b15(0x219))/0x9;if(_0x57d2e7===_0x4a699f)break;else _0x5ad1bc['push'](_0x5ad1bc['shift']());}catch(_0x4dfc18){_0x5ad1bc['push'](_0x5ad1bc['shift']());}}}(a42_0x4465,0x2e34f));var __importDefault=this&&this[a42_0x3989f2(0x1b2)]||function(_0x21b5a3){const _0xedf1d7=a42_0x3989f2;return _0x21b5a3&&_0x21b5a3[_0xedf1d7(0x1c1)]?_0x21b5a3:{'default':_0x21b5a3};};Object[a42_0x3989f2(0x15a)](exports,a42_0x3989f2(0x1c1),{'value':!![]}),exports[a42_0x3989f2(0x169)]=exports[a42_0x3989f2(0x175)]=void 0x0;const coinToPayService_1=require(a42_0x3989f2(0x14b)),coinToPay2Service_1=require(a42_0x3989f2(0x136)),gateway_1=require(a42_0x3989f2(0x1ad)),database_1=__importDefault(require(a42_0x3989f2(0x21e))),telegramBotService_1=require(a42_0x3989f2(0x236)),loggerService_1=require(a42_0x3989f2(0x161)),currencyService_1=require(a42_0x3989f2(0x205));class CoinToPayStatusService{constructor(){const _0x5b908d=a42_0x3989f2;this[_0x5b908d(0x19c)]=null,this['GLOBAL_CHECK_INTERVAL_MS']=0x3c*0x3c*0x3e8,this[_0x5b908d(0x1e6)]=0x5,this[_0x5b908d(0x20f)]=new Map(),this['coinToPayService']=new coinToPayService_1['CoinToPayService'](),this[_0x5b908d(0x162)]=new coinToPay2Service_1[(_0x5b908d(0x1e7))](),console['log'](_0x5b908d(0x16e));}['schedulePaymentChecks'](_0x1f7bd1,_0xe31945){const _0x387cb6=a42_0x3989f2;console['log'](_0x387cb6(0x1a5)),console[_0x387cb6(0x1d7)](_0x387cb6(0x14a)+_0x1f7bd1),console[_0x387cb6(0x1d7)](_0x387cb6(0x1fa)+_0xe31945),this[_0x387cb6(0x1d3)](_0x1f7bd1);const _0x450066=[],_0x2255d2=new Date(),_0x4f3b86=[{'delay':0x1*0x3c*0x3e8,'description':_0x387cb6(0x179)},{'delay':0x2*0x3c*0x3e8,'description':_0x387cb6(0x1b6)},{'delay':0x5*0x3c*0x3e8,'description':_0x387cb6(0x141)},{'delay':0x5*0x3c*0x3e8,'description':_0x387cb6(0x141)}];console[_0x387cb6(0x1d7)](_0x387cb6(0x1f1)+_0x4f3b86[_0x387cb6(0x198)]+_0x387cb6(0x234)+_0x1f7bd1);let _0x3771ba=0x0;_0x4f3b86[_0x387cb6(0x200)]((_0x35e5d7,_0x3cfbb4)=>{const _0x3efce2=_0x387cb6;_0x3771ba+=_0x35e5d7[_0x3efce2(0x211)];const _0x487339=setTimeout(async()=>{const _0x11be72=_0x3efce2;console[_0x11be72(0x1d7)](_0x11be72(0x1c9)+(_0x3cfbb4+0x1)+'\x20triggered\x20for\x20payment\x20'+_0x1f7bd1+'\x20(after\x20'+_0x35e5d7[_0x11be72(0x13a)]+')');try{await this[_0x11be72(0x224)](_0x1f7bd1),console[_0x11be72(0x1d7)](_0x11be72(0x1b4)+(_0x3cfbb4+0x1)+'\x20completed\x20for\x20payment\x20'+_0x1f7bd1);}catch(_0x19633f){console[_0x11be72(0x230)](_0x11be72(0x16f)+(_0x3cfbb4+0x1)+'\x20for\x20payment\x20'+_0x1f7bd1+':',_0x19633f),this[_0x11be72(0x217)](_0x1f7bd1,_0xe31945,_0x19633f,_0x11be72(0x23d),{'checkNumber':_0x3cfbb4+0x1,'scheduledAfter':_0x35e5d7[_0x11be72(0x13a)],'isIndividualCheck':!![]});}},_0x3771ba);_0x450066[_0x3efce2(0x1f8)](_0x487339),console[_0x3efce2(0x1d7)](_0x3efce2(0x1cd)+(_0x3cfbb4+0x1)+_0x3efce2(0x1e1)+_0x1f7bd1+_0x3efce2(0x1af)+_0x3771ba/0x3e8+'\x20seconds\x20('+_0x35e5d7[_0x3efce2(0x13a)]+')');});const _0x11ebd7=setInterval(async()=>{const _0x4a4b54=_0x387cb6;console[_0x4a4b54(0x1d7)]('🪙\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20'+_0x1f7bd1);try{const _0x316157=await database_1[_0x4a4b54(0x1b9)][_0x4a4b54(0x1bf)][_0x4a4b54(0x1a2)]({'where':{'id':_0x1f7bd1},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x316157){console['log'](_0x4a4b54(0x182)+_0x1f7bd1+_0x4a4b54(0x1ff)),this['clearPaymentTimers'](_0x1f7bd1);return;}console['log'](_0x4a4b54(0x1d4)+_0x1f7bd1+_0x4a4b54(0x1cf)+_0x316157[_0x4a4b54(0x20d)]);if(_0x316157['status']!==_0x4a4b54(0x1da)){console[_0x4a4b54(0x1d7)](_0x4a4b54(0x1b1)+_0x1f7bd1+'\x20status\x20is\x20'+_0x316157[_0x4a4b54(0x20d)]+_0x4a4b54(0x1f3)),this['clearPaymentTimers'](_0x1f7bd1);return;}const _0x5a68df=Math[_0x4a4b54(0x1d9)]((Date['now']()-_0x316157[_0x4a4b54(0x14e)][_0x4a4b54(0x21b)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x5a68df>=this[_0x4a4b54(0x1e6)]){console['log'](_0x4a4b54(0x1db)+_0x1f7bd1+_0x4a4b54(0x1eb)+this[_0x4a4b54(0x1e6)]+'\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check'),this['clearPaymentTimers'](_0x1f7bd1);return;}await this[_0x4a4b54(0x224)](_0x1f7bd1),console[_0x4a4b54(0x1d7)](_0x4a4b54(0x1bc)+_0x1f7bd1);}catch(_0x165c3d){console[_0x4a4b54(0x230)]('❌\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20'+_0x1f7bd1+':',_0x165c3d),this[_0x4a4b54(0x217)](_0x1f7bd1,_0xe31945,_0x165c3d,'status_check',{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x450066[_0x387cb6(0x1f8)](_0x11ebd7),this['paymentTimers']['set'](_0x1f7bd1,{'timers':_0x450066,'paymentId':_0x1f7bd1,'gatewayPaymentId':_0xe31945,'createdAt':_0x2255d2}),console[_0x387cb6(0x1d7)](_0x387cb6(0x1f0)+_0x4f3b86['length']+_0x387cb6(0x229)+_0x1f7bd1),console[_0x387cb6(0x1d7)](_0x387cb6(0x150)+this[_0x387cb6(0x20f)][_0x387cb6(0x1b8)]),this['logCoinToPayStatus'](_0x1f7bd1,_0xe31945,'PENDING',_0x387cb6(0x1da),_0x387cb6(0x23d),{'action':'schedule_created','scheduledChecks':_0x4f3b86['length'],'firstCheckIn':_0x4f3b86[0x0][_0x387cb6(0x211)]/0x3e8,'totalTimers':this['paymentTimers'][_0x387cb6(0x1b8)]});}['clearPaymentTimers'](_0x4e875f){const _0x31bc0a=a42_0x3989f2,_0x2a8853=this[_0x31bc0a(0x20f)][_0x31bc0a(0x18b)](_0x4e875f);_0x2a8853?(console['log'](_0x31bc0a(0x22e)+_0x2a8853[_0x31bc0a(0x1e9)]['length']+'\x20timers\x20for\x20payment\x20'+_0x4e875f),_0x2a8853[_0x31bc0a(0x1e9)][_0x31bc0a(0x200)]((_0x1bb799,_0x34a454)=>{const _0x524a8e=_0x31bc0a;_0x1bb799&&(clearTimeout(_0x1bb799),clearInterval(_0x1bb799),console[_0x524a8e(0x1d7)](_0x524a8e(0x1a0)+(_0x34a454+0x1)+_0x524a8e(0x1e1)+_0x4e875f));}),this['paymentTimers'][_0x31bc0a(0x23b)](_0x4e875f),console[_0x31bc0a(0x1d7)](_0x31bc0a(0x23a)+_0x4e875f+_0x31bc0a(0x20c)+this[_0x31bc0a(0x20f)]['size'])):console[_0x31bc0a(0x1d7)]('⚠️\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20'+_0x4e875f+_0x31bc0a(0x202));}async[a42_0x3989f2(0x224)](_0x400dd5){const _0x5201db=a42_0x3989f2;console[_0x5201db(0x1d7)](_0x5201db(0x20a)+_0x400dd5);const _0xe0e682=await database_1[_0x5201db(0x1b9)][_0x5201db(0x1bf)][_0x5201db(0x1a2)]({'where':{'id':_0x400dd5},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0xe0e682){console[_0x5201db(0x1d7)]('❌\x20[CHECK]\x20Payment\x20'+_0x400dd5+_0x5201db(0x15e));return;}console[_0x5201db(0x1d7)]('📊\x20[CHECK]\x20Payment\x20'+_0x400dd5+_0x5201db(0x1c0)),console[_0x5201db(0x1d7)](_0x5201db(0x214)+_0xe0e682['gateway']),console['log'](_0x5201db(0x15d)+_0xe0e682['status']),console[_0x5201db(0x1d7)](_0x5201db(0x144)+_0xe0e682[_0x5201db(0x209)]),console[_0x5201db(0x1d7)](_0x5201db(0x166)+_0xe0e682[_0x5201db(0x23c)]+'\x20'+_0xe0e682[_0x5201db(0x1ee)]),console[_0x5201db(0x1d7)](_0x5201db(0x19e)+_0xe0e682[_0x5201db(0x1bb)]);if(_0xe0e682[_0x5201db(0x1ac)]!==_0x5201db(0x240)&&_0xe0e682[_0x5201db(0x1ac)]!=='cointopay2'){console[_0x5201db(0x1d7)](_0x5201db(0x17f)+_0x400dd5+'\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20'+_0xe0e682[_0x5201db(0x1ac)]+')');return;}if(_0xe0e682[_0x5201db(0x20d)]!=='PENDING'){console[_0x5201db(0x1d7)]('⚠️\x20[CHECK]\x20Payment\x20'+_0x400dd5+_0x5201db(0x181)+_0xe0e682[_0x5201db(0x20d)]+_0x5201db(0x1f3)),this[_0x5201db(0x1d3)](_0x400dd5);return;}if(!_0xe0e682['gatewayPaymentId']){console[_0x5201db(0x1d7)](_0x5201db(0x17f)+_0x400dd5+_0x5201db(0x1d2));return;}console[_0x5201db(0x1d7)](_0x5201db(0x147)+_0x400dd5+'\x20is\x20valid\x20for\x20checking,\x20proceeding...'),await this[_0x5201db(0x19f)](_0xe0e682);}[a42_0x3989f2(0x189)](_0xa85156,_0x12d2e3,_0x2dbbf1,_0x2e5c67,_0x4747cd,_0x29d6e4){const _0x54e334=a42_0x3989f2,_0x44df09={'type':'COINTOPAY_STATUS_CHANGE','paymentId':_0xa85156,'gatewayPaymentId':_0x12d2e3,'oldStatus':_0x2dbbf1,'newStatus':_0x2e5c67,'source':_0x4747cd,'timestamp':new Date()[_0x54e334(0x199)](),'details':_0x29d6e4||{}};loggerService_1[_0x54e334(0x17c)][_0x54e334(0x189)](_0x44df09),console['log'](_0x54e334(0x1ab)+_0xa85156+'\x20('+_0x12d2e3+')'),console['log'](_0x54e334(0x238)+_0x2dbbf1+_0x54e334(0x187)+_0x2e5c67),console[_0x54e334(0x1d7)](_0x54e334(0x231)+_0x4747cd),console['log'](_0x54e334(0x1a1)+_0x44df09[_0x54e334(0x135)]),_0x29d6e4&&console[_0x54e334(0x1d7)](_0x54e334(0x154),_0x29d6e4);}[a42_0x3989f2(0x217)](_0x2489aa,_0x400606,_0x1cf9f8,_0x13f9ad,_0xeac85d){const _0x2a657f=a42_0x3989f2,_0xef4bf6={'type':_0x2a657f(0x1a7),'paymentId':_0x2489aa,'gatewayPaymentId':_0x400606,'error':_0x1cf9f8 instanceof Error?{'message':_0x1cf9f8['message'],'stack':_0x1cf9f8[_0x2a657f(0x1d8)]}:_0x1cf9f8,'source':_0x13f9ad,'timestamp':new Date()[_0x2a657f(0x199)](),'context':_0xeac85d||{}};loggerService_1['loggerService'][_0x2a657f(0x217)](_0xef4bf6),console[_0x2a657f(0x230)](_0x2a657f(0x163)+_0x2489aa+'\x20('+_0x400606+')'),console['error'](_0x2a657f(0x15b)+(_0x1cf9f8 instanceof Error?_0x1cf9f8[_0x2a657f(0x178)]:_0x1cf9f8)),console[_0x2a657f(0x230)]('\x20\x20\x20📍\x20Source:\x20'+_0x13f9ad),console[_0x2a657f(0x230)](_0x2a657f(0x1a1)+_0xef4bf6[_0x2a657f(0x135)]),_0xeac85d&&console[_0x2a657f(0x230)](_0x2a657f(0x1fe),_0xeac85d);}[a42_0x3989f2(0x21d)](){const _0x1f2f98=a42_0x3989f2;console[_0x1f2f98(0x1d7)](_0x1f2f98(0x1c6)),this['checkAllPendingPayments']()['catch'](_0x64dd88=>{const _0x15afac=_0x1f2f98;console['error'](_0x15afac(0x1c8),_0x64dd88);}),this[_0x1f2f98(0x19c)]=setInterval(async()=>{const _0x1a6fc5=_0x1f2f98;try{console['log'](_0x1a6fc5(0x177)),await this[_0x1a6fc5(0x1fc)](),console[_0x1a6fc5(0x1d7)](_0x1a6fc5(0x1f5));}catch(_0x4a9454){console['error'](_0x1a6fc5(0x233),_0x4a9454);}},this['GLOBAL_CHECK_INTERVAL_MS']),console[_0x1f2f98(0x1d7)](_0x1f2f98(0x22f));}['stopPeriodicStatusCheck'](){const _0x3e88aa=a42_0x3989f2;console[_0x3e88aa(0x1d7)](_0x3e88aa(0x132));this['globalCheckInterval']&&(clearInterval(this[_0x3e88aa(0x19c)]),this[_0x3e88aa(0x19c)]=null,console[_0x3e88aa(0x1d7)](_0x3e88aa(0x21f)));const _0x19388a=this[_0x3e88aa(0x20f)][_0x3e88aa(0x1b8)];for(const [_0x15e72a]of this[_0x3e88aa(0x20f)]){this[_0x3e88aa(0x1d3)](_0x15e72a);}console[_0x3e88aa(0x1d7)]('🛑\x20[SHUTDOWN]\x20Cleared\x20'+_0x19388a+'\x20individual\x20payment\x20timers');}async[a42_0x3989f2(0x1fc)](){const _0x584e7a=a42_0x3989f2;try{console[_0x584e7a(0x1d7)](_0x584e7a(0x148));const _0x49d988=await database_1['default']['payment'][_0x584e7a(0x156)]({'where':{'gateway':{'in':[_0x584e7a(0x240),'cointopay2']},'status':_0x584e7a(0x1da),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console['log'](_0x584e7a(0x16d)+_0x49d988[_0x584e7a(0x198)]+_0x584e7a(0x19d));if(_0x49d988[_0x584e7a(0x198)]===0x0){console[_0x584e7a(0x1d7)]('🪙\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check');return;}const _0x17cd0f=await this[_0x584e7a(0x140)](_0x49d988);console[_0x584e7a(0x1d7)](_0x584e7a(0x134)+_0x17cd0f[_0x584e7a(0x198)]+_0x584e7a(0x216));let _0x2707b6=0x0,_0x50bc10=0x0;for(const _0x49d819 of _0x49d988){try{if(_0x17cd0f[_0x584e7a(0x1be)](_0x49d819['id'])){console[_0x584e7a(0x1d7)](_0x584e7a(0x227)+_0x49d819['id']+_0x584e7a(0x1df)),_0x50bc10++;continue;}if(this[_0x584e7a(0x20f)][_0x584e7a(0x17e)](_0x49d819['id'])){console[_0x584e7a(0x1d7)](_0x584e7a(0x227)+_0x49d819['id']+_0x584e7a(0x1cb)),_0x50bc10++;continue;}const _0x50330d=(Date[_0x584e7a(0x160)]()-_0x49d819[_0x584e7a(0x14e)][_0x584e7a(0x21b)]())/(0x3e8*0x3c*0x3c);if(_0x50330d<0x1){console['log'](_0x584e7a(0x227)+_0x49d819['id']+_0x584e7a(0x1ec)+_0x50330d[_0x584e7a(0x208)](0x1)+'h),\x20skipping\x20global\x20check'),_0x50bc10++;continue;}console[_0x584e7a(0x1d7)](_0x584e7a(0x137)+_0x49d819['id']+'\x20(age:\x20'+_0x50330d[_0x584e7a(0x208)](0x1)+'h)'),await this['checkSinglePayment'](_0x49d819),_0x2707b6++,await new Promise(_0xabdadc=>setTimeout(_0xabdadc,0x7d0));}catch(_0x2f6958){console[_0x584e7a(0x230)](_0x584e7a(0x14f)+_0x49d819['id']+':',_0x2f6958),this['logCoinToPayError'](_0x49d819['id'],_0x49d819[_0x584e7a(0x209)]||_0x584e7a(0x18d),_0x2f6958,'status_check',{'isGlobalCheck':!![],'paymentAmount':_0x49d819['amount'],'paymentCurrency':_0x49d819[_0x584e7a(0x1ee)],'shopId':_0x49d819[_0x584e7a(0x1bb)],'createdAt':_0x49d819[_0x584e7a(0x14e)]}),loggerService_1[_0x584e7a(0x17c)][_0x584e7a(0x210)](_0x584e7a(0x240),'/status/'+_0x49d819[_0x584e7a(0x209)],_0x2f6958);}}console[_0x584e7a(0x1d7)]('✅\x20[GLOBAL]\x20Global\x20check\x20completed:\x20'+_0x2707b6+_0x584e7a(0x225)+_0x50bc10+_0x584e7a(0x1dd)+_0x17cd0f[_0x584e7a(0x198)]+'\x20expired');}catch(_0x1b5aa1){console['error'](_0x584e7a(0x170),_0x1b5aa1);}}async[a42_0x3989f2(0x140)](_0x34a12b){const _0x3b444f=a42_0x3989f2,_0x58f4fc=[],_0x403d49=new Date();_0x403d49[_0x3b444f(0x1c7)](_0x403d49[_0x3b444f(0x228)]()-this[_0x3b444f(0x1e6)]),console['log']('⏰\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20'+this['EXPIRY_DAYS']+_0x3b444f(0x1d6)+_0x403d49[_0x3b444f(0x199)]()+')');for(const _0x4423bb of _0x34a12b){if(_0x4423bb[_0x3b444f(0x14e)]<_0x403d49){console[_0x3b444f(0x1d7)]('⏰\x20[EXPIRY]\x20Payment\x20'+_0x4423bb['id']+_0x3b444f(0x1eb)+this[_0x3b444f(0x1e6)]+_0x3b444f(0x131));try{this[_0x3b444f(0x189)](_0x4423bb['id'],_0x4423bb['gatewayPaymentId']||'unknown',_0x3b444f(0x1da),_0x3b444f(0x153),_0x3b444f(0x15c),{'reason':_0x3b444f(0x1d1)+this[_0x3b444f(0x1e6)]+_0x3b444f(0x1f4),'createdAt':_0x4423bb[_0x3b444f(0x14e)],'daysSinceCreation':Math[_0x3b444f(0x1d9)]((Date[_0x3b444f(0x160)]()-_0x4423bb[_0x3b444f(0x14e)][_0x3b444f(0x21b)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x4423bb['amount'],'paymentCurrency':_0x4423bb[_0x3b444f(0x1ee)],'shopId':_0x4423bb[_0x3b444f(0x1bb)]}),await database_1[_0x3b444f(0x1b9)][_0x3b444f(0x1bf)]['update']({'where':{'id':_0x4423bb['id']},'data':{'status':_0x3b444f(0x153),'updatedAt':new Date(),'adminNotes':'Automatically\x20expired\x20after\x20'+this[_0x3b444f(0x1e6)]+_0x3b444f(0x21c)}}),await database_1[_0x3b444f(0x1b9)]['webhookLog']['create']({'data':{'paymentId':_0x4423bb['id'],'shopId':_0x4423bb[_0x3b444f(0x1bb)],'event':_0x3b444f(0x17a),'statusCode':0xc8,'responseBody':JSON[_0x3b444f(0x213)]({'reason':_0x3b444f(0x1d1)+this[_0x3b444f(0x1e6)]+_0x3b444f(0x1f4),'createdAt':_0x4423bb[_0x3b444f(0x14e)],'expiredAt':new Date()[_0x3b444f(0x199)](),'daysSinceCreation':Math['floor']((Date[_0x3b444f(0x160)]()-_0x4423bb[_0x3b444f(0x14e)][_0x3b444f(0x21b)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x3b444f(0x237)](_0x4423bb,_0x3b444f(0x153)),await this['sendPaymentStatusNotification'](_0x4423bb,_0x3b444f(0x153)),this[_0x3b444f(0x1d3)](_0x4423bb['id']),_0x58f4fc[_0x3b444f(0x1f8)](_0x4423bb['id']),console['log']('✅\x20[EXPIRY]\x20Payment\x20'+_0x4423bb['id']+'\x20marked\x20as\x20EXPIRED\x20due\x20to\x20'+this[_0x3b444f(0x1e6)]+_0x3b444f(0x16a));}catch(_0x1d8cbb){console[_0x3b444f(0x230)]('❌\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20'+_0x4423bb['id']+':',_0x1d8cbb),this[_0x3b444f(0x217)](_0x4423bb['id'],_0x4423bb[_0x3b444f(0x209)]||_0x3b444f(0x18d),_0x1d8cbb,_0x3b444f(0x15c),{'reason':_0x3b444f(0x165),'createdAt':_0x4423bb['createdAt'],'daysSinceCreation':Math[_0x3b444f(0x1d9)]((Date[_0x3b444f(0x160)]()-_0x4423bb[_0x3b444f(0x14e)][_0x3b444f(0x21b)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x58f4fc;}async[a42_0x3989f2(0x19f)](_0x3b52e2){const _0xdc1991=a42_0x3989f2;if(!_0x3b52e2[_0xdc1991(0x209)]){console[_0xdc1991(0x1d7)]('⚠️\x20[CHECK]\x20Payment\x20'+_0x3b52e2['id']+_0xdc1991(0x19a));return;}console[_0xdc1991(0x1d7)](_0xdc1991(0x1b0)+_0x3b52e2['gateway']+_0xdc1991(0x13b)+_0x3b52e2['id']+'\x20('+_0x3b52e2[_0xdc1991(0x209)]+')');try{let _0x2158be;_0x3b52e2[_0xdc1991(0x1ac)]===_0xdc1991(0x20e)?(_0x2158be=await this['coinToPay2Service']['checkPaymentStatus'](_0x3b52e2[_0xdc1991(0x209)]),console[_0xdc1991(0x1d7)](_0xdc1991(0x196)+_0x3b52e2['id']+'\x20status:\x20'+_0x2158be[_0xdc1991(0x20d)])):(_0x2158be=await this[_0xdc1991(0x1d0)][_0xdc1991(0x142)](_0x3b52e2[_0xdc1991(0x209)]),console[_0xdc1991(0x1d7)](_0xdc1991(0x1b3)+_0x3b52e2['id']+'\x20status:\x20'+_0x2158be['status']));_0x2158be[_0xdc1991(0x17b)]&&console['log'](_0xdc1991(0x152)+_0x3b52e2['id']+'\x20details:',{'iban':_0x2158be[_0xdc1991(0x17b)][_0xdc1991(0x1f2)]||_0xdc1991(0x1b7),'transactionId':_0x2158be['paymentDetails'][_0xdc1991(0x223)],'createdOn':_0x2158be[_0xdc1991(0x17b)]['createdOn'],'confirmedOn':_0x2158be[_0xdc1991(0x17b)][_0xdc1991(0x1ed)]||'not\x20confirmed'});if(_0x2158be[_0xdc1991(0x20d)]!==_0x3b52e2[_0xdc1991(0x20d)]){console[_0xdc1991(0x1d7)]('🔄\x20[CHECK]\x20Updating\x20payment\x20'+_0x3b52e2['id']+_0xdc1991(0x1d5)+_0x3b52e2[_0xdc1991(0x20d)]+_0xdc1991(0x1e8)+_0x2158be[_0xdc1991(0x20d)]),this[_0xdc1991(0x189)](_0x3b52e2['id'],_0x3b52e2[_0xdc1991(0x209)],_0x3b52e2[_0xdc1991(0x20d)],_0x2158be[_0xdc1991(0x20d)],_0xdc1991(0x23d),{'paymentDetails':_0x2158be[_0xdc1991(0x17b)],'amount':_0x2158be[_0xdc1991(0x23c)],'currency':_0x2158be[_0xdc1991(0x1ee)],'shopId':_0x3b52e2[_0xdc1991(0x1bb)],'checkTimestamp':new Date()[_0xdc1991(0x199)]()});const _0x557117={'status':_0x2158be[_0xdc1991(0x20d)],'updatedAt':new Date()};if(_0x2158be['status']===_0xdc1991(0x173)&&_0x3b52e2[_0xdc1991(0x20d)]!==_0xdc1991(0x173)){_0x557117['paidAt']=new Date();if(!_0x3b52e2[_0xdc1991(0x193)]){const _0x229772=await currencyService_1[_0xdc1991(0x1ba)][_0xdc1991(0x155)](_0x3b52e2['amount'],_0x3b52e2[_0xdc1991(0x1ee)]);_0x557117['amountUSDT']=_0x229772;const _0x532038=await this[_0xdc1991(0x1b5)](_0x3b52e2[_0xdc1991(0x1bb)],_0x3b52e2['gateway']),_0x16fdf9=_0x229772*(0x1-_0x532038/0x64);_0x557117[_0xdc1991(0x22c)]=_0x16fdf9,_0x557117[_0xdc1991(0x18c)]=_0x532038,console[_0xdc1991(0x1d7)](_0xdc1991(0x16b)+_0x3b52e2['id']+_0xdc1991(0x22b)),console[_0xdc1991(0x1d7)]('\x20\x20\x20Amount:\x20'+_0x3b52e2[_0xdc1991(0x23c)]+'\x20'+_0x3b52e2[_0xdc1991(0x1ee)]+_0xdc1991(0x187)+_0x229772['toFixed'](0x6)+_0xdc1991(0x13f)),console[_0xdc1991(0x1d7)](_0xdc1991(0x1c2)+_0x3b52e2[_0xdc1991(0x1ac)]+_0xdc1991(0x1a8)+_0x532038+'%'),console[_0xdc1991(0x1d7)](_0xdc1991(0x157)+_0x16fdf9['toFixed'](0x6)+_0xdc1991(0x13f));}console['log']('💰\x20[CHECK]\x20Payment\x20'+_0x3b52e2['id']+'\x20marked\x20as\x20paid\x20at:\x20'+_0x557117[_0xdc1991(0x22a)][_0xdc1991(0x199)]());}if(_0x2158be['paymentDetails']){const _0x170c98=_0x2158be[_0xdc1991(0x17b)];_0x170c98[_0xdc1991(0x1f2)]&&(_0x557117[_0xdc1991(0x16c)]=_0x170c98[_0xdc1991(0x1f2)],console['log'](_0xdc1991(0x1e5)+_0x170c98[_0xdc1991(0x1f2)]));if(_0x170c98['bankDetails']){const _0x32bf1c=_0x3b52e2[_0xdc1991(0x14d)]||'',_0x5b13d6=_0xdc1991(0x139)+_0x170c98[_0xdc1991(0x18f)];_0x557117['adminNotes']=_0x32bf1c?_0x32bf1c+'\x0a\x0a'+_0x5b13d6:_0x5b13d6,console[_0xdc1991(0x1d7)](_0xdc1991(0x190));}_0x170c98[_0xdc1991(0x223)]&&console['log'](_0xdc1991(0x195)+_0x170c98[_0xdc1991(0x223)]),_0x170c98[_0xdc1991(0x1ed)]&&console[_0xdc1991(0x1d7)](_0xdc1991(0x1e2)+_0x170c98[_0xdc1991(0x1ed)]);}await database_1[_0xdc1991(0x1b9)][_0xdc1991(0x1bf)][_0xdc1991(0x172)]({'where':{'id':_0x3b52e2['id']},'data':_0x557117});if(_0x2158be[_0xdc1991(0x20d)]===_0xdc1991(0x173)&&_0x3b52e2['status']!==_0xdc1991(0x173)){console[_0xdc1991(0x1d7)]('📈\x20[COINTOPAY]\x20Payment\x20'+_0x3b52e2['id']+_0xdc1991(0x174));const _0x30936c=await database_1[_0xdc1991(0x1b9)]['payment'][_0xdc1991(0x1a2)]({'where':{'id':_0x3b52e2['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x30936c?.[_0xdc1991(0x221)]&&_0x30936c[_0xdc1991(0x203)])try{const _0x2c588e=_0x30936c[_0xdc1991(0x203)];console[_0xdc1991(0x1d7)](_0xdc1991(0x1f6)+_0x2c588e['id']+_0xdc1991(0x201)+_0x2c588e[_0xdc1991(0x15f)]+_0xdc1991(0x185)+_0x2c588e[_0xdc1991(0x1ca)]+',\x20status='+_0x2c588e[_0xdc1991(0x20d)]);const _0x1ede1d=_0x2c588e['currentPayments']+0x1,_0x491463=_0x2c588e['type']==='SINGLE'?_0xdc1991(0x1fb):_0x2c588e[_0xdc1991(0x20d)];await database_1['default'][_0xdc1991(0x203)][_0xdc1991(0x172)]({'where':{'id':_0x2c588e['id']},'data':{'currentPayments':_0x1ede1d,'status':_0x491463,'updatedAt':new Date()}}),console[_0xdc1991(0x1d7)](_0xdc1991(0x184)+_0x2c588e['id']+_0xdc1991(0x143)+_0x2c588e['currentPayments']+_0xdc1991(0x187)+_0x1ede1d+',\x20status='+_0x2c588e['status']+_0xdc1991(0x187)+_0x491463);}catch(_0x8b54a4){console[_0xdc1991(0x230)](_0xdc1991(0x138),_0x8b54a4);}else console[_0xdc1991(0x1d7)](_0xdc1991(0x133)+_0x3b52e2['id']+_0xdc1991(0x191));}await database_1[_0xdc1991(0x1b9)][_0xdc1991(0x197)][_0xdc1991(0x20b)]({'data':{'paymentId':_0x3b52e2['id'],'shopId':_0x3b52e2[_0xdc1991(0x1bb)],'event':_0xdc1991(0x171)+_0x2158be[_0xdc1991(0x20d)][_0xdc1991(0x1aa)](),'statusCode':0xc8,'responseBody':JSON[_0xdc1991(0x213)]({'oldStatus':_0x3b52e2[_0xdc1991(0x20d)],'newStatus':_0x2158be['status'],'paymentDetails':_0x2158be['paymentDetails'],'checkedAt':new Date()[_0xdc1991(0x199)]()})}}),await this[_0xdc1991(0x237)](_0x3b52e2,_0x2158be[_0xdc1991(0x20d)]),await this['sendPaymentStatusNotification'](_0x3b52e2,_0x2158be[_0xdc1991(0x20d)]),_0x2158be[_0xdc1991(0x20d)]!=='PENDING'&&(console[_0xdc1991(0x1d7)](_0xdc1991(0x180)+_0x3b52e2['id']+_0xdc1991(0x167)+_0x2158be[_0xdc1991(0x20d)]+',\x20clearing\x20individual\x20timers'),this[_0xdc1991(0x1d3)](_0x3b52e2['id'])),console[_0xdc1991(0x1d7)](_0xdc1991(0x147)+_0x3b52e2['id']+_0xdc1991(0x23f));}else console[_0xdc1991(0x1d7)](_0xdc1991(0x152)+_0x3b52e2['id']+_0xdc1991(0x1de)+_0x2158be['status']+')'),this['logCoinToPayStatus'](_0x3b52e2['id'],_0x3b52e2['gatewayPaymentId'],_0x3b52e2[_0xdc1991(0x20d)],_0x2158be[_0xdc1991(0x20d)],_0xdc1991(0x23d),{'statusUnchanged':!![],'paymentDetails':_0x2158be[_0xdc1991(0x17b)],'amount':_0x2158be[_0xdc1991(0x23c)],'currency':_0x2158be[_0xdc1991(0x1ee)],'shopId':_0x3b52e2[_0xdc1991(0x1bb)],'checkTimestamp':new Date()['toISOString']()});}catch(_0x604d68){console[_0xdc1991(0x230)]('❌\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20'+_0x3b52e2['id']+':',_0x604d68),this[_0xdc1991(0x217)](_0x3b52e2['id'],_0x3b52e2[_0xdc1991(0x209)],_0x604d68,_0xdc1991(0x23d),{'paymentAmount':_0x3b52e2[_0xdc1991(0x23c)],'paymentCurrency':_0x3b52e2[_0xdc1991(0x1ee)],'shopId':_0x3b52e2[_0xdc1991(0x1bb)],'createdAt':_0x3b52e2['createdAt']}),await database_1['default'][_0xdc1991(0x197)][_0xdc1991(0x20b)]({'data':{'paymentId':_0x3b52e2['id'],'shopId':_0x3b52e2['shopId'],'event':_0xdc1991(0x194),'statusCode':0x1f4,'responseBody':JSON[_0xdc1991(0x213)]({'error':_0x604d68 instanceof Error?_0x604d68['message']:_0xdc1991(0x13c),'gatewayPaymentId':_0x3b52e2['gatewayPaymentId'],'checkedAt':new Date()['toISOString']()})}});}}async[a42_0x3989f2(0x237)](_0x501346,_0x552cf4){const _0x1cde77=a42_0x3989f2,_0x3f434=Date[_0x1cde77(0x160)]();try{const _0x3c6b09=_0x501346['shop'],_0x531e26=_0x3c6b09[_0x1cde77(0x186)];if(!_0x531e26?.['webhookUrl']){console[_0x1cde77(0x1d7)](_0x1cde77(0x192)+_0x3c6b09['id']);return;}const _0x5c1dbd=_0x552cf4===_0x1cde77(0x173)?_0x1cde77(0x149):_0x552cf4===_0x1cde77(0x1bd)?_0x1cde77(0x23e):_0x552cf4==='EXPIRED'?_0x1cde77(0x23e):_0x1cde77(0x1cc);if(!_0x531e26[_0x1cde77(0x239)]?.[_0x1cde77(0x1be)](_0x5c1dbd)){console[_0x1cde77(0x1d7)](_0x1cde77(0x1f7)+_0x5c1dbd+'\x20not\x20enabled\x20for\x20shop\x20'+_0x3c6b09['id']);return;}const _0x117b67=(0x0,gateway_1['getGatewayIdByName'])(_0x501346['gateway'])||_0x501346['gateway'],_0xc645cd={'event':_0x5c1dbd,'payment':{'id':_0x501346['id'],'order_id':_0x501346[_0x1cde77(0x22d)],'gateway_order_id':_0x501346[_0x1cde77(0x1a3)],'gateway':_0x117b67,'amount':_0x501346[_0x1cde77(0x23c)],'currency':_0x501346[_0x1cde77(0x1ee)],'status':_0x552cf4[_0x1cde77(0x1aa)](),'customer_email':_0x501346[_0x1cde77(0x19b)],'customer_name':_0x501346[_0x1cde77(0x215)],'created_at':_0x501346['createdAt'],'updated_at':new Date()}},_0x37d4fe=await fetch(_0x531e26['webhookUrl'],{'method':_0x1cde77(0x168),'headers':{'Content-Type':_0x1cde77(0x13e),'User-Agent':_0x1cde77(0x183)},'body':JSON['stringify'](_0xc645cd)}),_0x43f79c=Date[_0x1cde77(0x160)]()-_0x3f434,_0x36244f=_0x37d4fe['ok']?_0x1cde77(0x1c4):await _0x37d4fe[_0x1cde77(0x1dc)]();loggerService_1['loggerService'][_0x1cde77(0x1ce)](_0x501346[_0x1cde77(0x1bb)],_0x531e26[_0x1cde77(0x176)],_0x5c1dbd,_0x37d4fe[_0x1cde77(0x20d)],_0x43f79c,_0xc645cd),console[_0x1cde77(0x1d7)](_0x1cde77(0x1c5)+_0x531e26['webhookUrl']+_0x1cde77(0x159)+_0x37d4fe[_0x1cde77(0x20d)]+'\x20('+_0x43f79c+_0x1cde77(0x13d));}catch(_0x213eaa){console[_0x1cde77(0x230)](_0x1cde77(0x212),_0x213eaa),loggerService_1[_0x1cde77(0x17c)][_0x1cde77(0x1ae)](_0x501346['shopId'],_0x501346[_0x1cde77(0x218)]?.[_0x1cde77(0x186)]?.['webhookUrl']||_0x1cde77(0x18d),'webhook_send',_0x213eaa,{});}}async[a42_0x3989f2(0x21a)](_0x40173f,_0x3c142f){const _0xbd2053=a42_0x3989f2;try{const _0x5ceaff={'PENDING':_0xbd2053(0x1c3),'PAID':'paid','FAILED':_0xbd2053(0x1e4),'EXPIRED':'expired'},_0x3ed05a=_0x5ceaff[_0x3c142f];if(!_0x3ed05a||_0x3ed05a===_0xbd2053(0x1c3))return;await telegramBotService_1[_0xbd2053(0x18e)]['sendPaymentNotification'](_0x40173f[_0xbd2053(0x1bb)],_0x40173f,_0x3ed05a);}catch(_0x59bbc2){console['error'](_0xbd2053(0x241),_0x59bbc2);}}async['checkPaymentById'](_0x1ce425){const _0x12a703=a42_0x3989f2;console[_0x12a703(0x1d7)](_0x12a703(0x145)+_0x1ce425);const _0x3b79a=await database_1[_0x12a703(0x1b9)][_0x12a703(0x1bf)][_0x12a703(0x1a2)]({'where':{'id':_0x1ce425},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x3b79a)throw new Error(_0x12a703(0x204));if(_0x3b79a['gateway']!=='cointopay'&&_0x3b79a[_0x12a703(0x1ac)]!==_0x12a703(0x20e))throw new Error(_0x12a703(0x207));console[_0x12a703(0x1d7)]('✅\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20'+_0x3b79a[_0x12a703(0x1ac)]+'\x20payment\x20'+_0x1ce425),await this[_0x12a703(0x19f)](_0x3b79a),console[_0x12a703(0x1d7)](_0x12a703(0x1e3)+_0x1ce425);}[a42_0x3989f2(0x1ef)](){const _0x1c97cb=a42_0x3989f2,_0x5341be=this['globalCheckInterval']?this['GLOBAL_CHECK_INTERVAL_MS']:undefined,_0x111ddf=Array['from'](this['paymentTimers']['values']())['map'](_0x20f7d7=>({'paymentId':_0x20f7d7[_0x1c97cb(0x1a4)],'gatewayPaymentId':_0x20f7d7[_0x1c97cb(0x209)],'createdAt':_0x20f7d7[_0x1c97cb(0x14e)],'timersCount':_0x20f7d7[_0x1c97cb(0x1e9)][_0x1c97cb(0x198)]}));return{'isActive':!!this['globalCheckInterval'],'globalCheckIntervalMinutes':this[_0x1c97cb(0x1fd)]/(0x3e8*0x3c),'expiryDays':this[_0x1c97cb(0x1e6)],'activeIndividualTimers':this[_0x1c97cb(0x20f)]['size'],'nextGlobalCheckIn':_0x5341be,'paymentTimersDetails':_0x111ddf};}[a42_0x3989f2(0x1e0)](_0x403cb5){const _0x524e18=a42_0x3989f2,_0x4de140=this[_0x524e18(0x20f)][_0x524e18(0x18b)](_0x403cb5);if(_0x4de140)return{'hasTimers':!![],'timersCount':_0x4de140[_0x524e18(0x1e9)][_0x524e18(0x198)],'createdAt':_0x4de140[_0x524e18(0x14e)],'gatewayPaymentId':_0x4de140['gatewayPaymentId']};return{'hasTimers':![]};}async[a42_0x3989f2(0x1b5)](_0x4b212a,_0x3d3087){const _0x5c3a32=a42_0x3989f2;try{const _0x258e7e=await database_1[_0x5c3a32(0x1b9)][_0x5c3a32(0x218)][_0x5c3a32(0x1a2)]({'where':{'id':_0x4b212a},'select':{'gatewaySettings':!![]}});if(!_0x258e7e?.['gatewaySettings'])return console['log'](_0x5c3a32(0x1a6)+_0x4b212a+_0x5c3a32(0x158)),0xa;const _0x1b1796=JSON[_0x5c3a32(0x220)](_0x258e7e[_0x5c3a32(0x14c)]);for(const [_0x3747bc,_0x3b7ae6]of Object['entries'](_0x1b1796)){if(_0x3747bc[_0x5c3a32(0x1aa)]()===_0x3d3087[_0x5c3a32(0x1aa)]()){const _0x2deb7f=_0x3b7ae6[_0x5c3a32(0x18a)]||0xa;return console['log'](_0x5c3a32(0x232)+_0x3d3087+_0x5c3a32(0x146)+_0x4b212a+':\x20'+_0x2deb7f+'%'),_0x2deb7f;}}return console['log']('No\x20specific\x20commission\x20found\x20for\x20gateway\x20'+_0x3d3087+_0x5c3a32(0x226)+_0x4b212a+_0x5c3a32(0x1f9)),0xa;}catch(_0x4e9065){return console[_0x5c3a32(0x230)](_0x5c3a32(0x222)+_0x4b212a+',\x20gateway\x20'+_0x3d3087+':',_0x4e9065),0xa;}}}function a42_0x4465(){const _0xb00933=['logShopWebhookSent','\x20current\x20status:\x20','coinToPayService','Payment\x20older\x20than\x20','\x20has\x20no\x20gatewayPaymentId','clearPaymentTimers','📊\x20[HOURLY]\x20Payment\x20','\x20status\x20from\x20','\x20days\x20(created\x20before\x20','log','stack','floor','PENDING','⏰\x20[HOURLY]\x20Payment\x20','text','\x20skipped,\x20','\x20status\x20unchanged\x20(','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','getPaymentTimerInfo','\x20for\x20payment\x20','✅\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','✅\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','failed','🏦\x20[CHECK]\x20Saved\x20IBAN:\x20','EXPIRY_DAYS','CoinToPay2Service','\x20to\x20','timers','283355agQSOL','\x20is\x20older\x20than\x20','\x20is\x20too\x20new\x20(','confirmedOn','currency','getServiceStats','✅\x20[DEBUG]\x20Successfully\x20scheduled\x20','🪙\x20[DEBUG]\x20Creating\x20','iban',',\x20stopping\x20individual\x20checks','\x20days','✅\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','📈\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','Webhook\x20event\x20','push',',\x20using\x20default\x2010%','\x20\x20\x20-\x20gatewayPaymentId:\x20','COMPLETED','checkAllPendingPayments','GLOBAL_CHECK_INTERVAL_MS','\x20\x20\x20📝\x20Context:','\x20not\x20found,\x20clearing\x20timers','forEach',':\x20type=','\x20to\x20clear','paymentLink','Payment\x20not\x20found','./currencyService','4WptQhe','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','toFixed','gatewayPaymentId','🔍\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','create','.\x20Remaining\x20active\x20timers:\x20','status','cointopay2','paymentTimers','logWhiteDomainError','delay','Failed\x20to\x20send\x20shop\x20webhook:','stringify','\x20\x20\x20-\x20Gateway:\x20','customerName','\x20expired\x20CoinToPay\x20payments','logCoinToPayError','shop','701595FBBOaL','sendPaymentStatusNotification','getTime','\x20days\x20without\x20payment\x20confirmation','startPeriodicStatusCheck','../config/database','🛑\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','parse','paymentLinkId','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','transactionId','checkSinglePaymentById','\x20checked,\x20','\x20in\x20shop\x20','⏰\x20[GLOBAL]\x20Payment\x20','getDate','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','paidAt','\x20amounts\x20calculated:','amountAfterGatewayCommissionUSDT','orderId','🧹\x20[DEBUG]\x20Clearing\x20','✅\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','error','\x20\x20\x20📍\x20Source:\x20','Gateway\x20','❌\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','\x20initial\x20timers\x20for\x20payment\x20','1130001GsSZnX','./telegramBotService','sendShopWebhook','\x20\x20\x20📊\x20Status:\x20','webhookEvents','✅\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','delete','amount','status_check','payment.failed','\x20updated\x20successfully','cointopay','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','\x20days,\x20marking\x20as\x20EXPIRED','🛑\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','📈\x20[COINTOPAY]\x20Payment\x20','⏰\x20[GLOBAL]\x20Found\x20','timestamp','./gateways/coinToPay2Service','🔍\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','❌\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','Bank\x20Details:\x20','description','\x20payment\x20','Unknown\x20error','ms)','application/json','\x20USDT','checkExpiredPayments','5\x20minutes','checkPaymentStatus','\x20updated:\x20currentPayments=','\x20\x20\x20-\x20GatewayPaymentId:\x20','🔍\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','\x20commission\x20for\x20shop\x20','✅\x20[CHECK]\x20Payment\x20','🪙\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','payment.success','\x20\x20\x20-\x20paymentId:\x20','./gateways/coinToPayService','gatewaySettings','adminNotes','createdAt','❌\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','📊\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','6BNUgWv','📊\x20[CHECK]\x20Payment\x20','EXPIRED','\x20\x20\x20📝\x20Details:','convertToUSDT','findMany','\x20\x20\x20Amount\x20after\x20commission:\x20',',\x20using\x20default\x20commission\x2010%','\x20with\x20status\x20','defineProperty','\x20\x20\x20❌\x20Error:\x20','auto_expire','\x20\x20\x20-\x20Status:\x20','\x20not\x20found\x20in\x20database','type','now','./loggerService','coinToPay2Service','🪙\x20[ERROR]\x20CoinToPay\x20Error:\x20','996575WUfzKx','Failed\x20to\x20mark\x20payment\x20as\x20expired','\x20\x20\x20-\x20Amount:\x20','\x20status\x20changed\x20to\x20','POST','coinToPayStatusService','-day\x20timeout','💰\x20[CHECK]\x20Payment\x20','remitterIban','🪙\x20[GLOBAL]\x20Found\x20','🪙\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','❌\x20[TIMER]\x20Failed\x20individual\x20check\x20#','❌\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','cointopay_status_check_','update','PAID','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','CoinToPayStatusService','webhookUrl','🪙\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','message','1\x20minute','cointopay_auto_expired','paymentDetails','loggerService','339052WoUyAV','has','⚠️\x20[CHECK]\x20Payment\x20','🧹\x20[CHECK]\x20Payment\x20','\x20status\x20is\x20','❌\x20[HOURLY]\x20Payment\x20','Payment\x20System/1.0','✅\x20[COINTOPAY]\x20Payment\x20link\x20',',\x20currentPayments=','settings','\x20->\x20','460714oENLZO','logCoinToPayStatus','commission','get','gatewayCommissionRate','unknown','telegramBotService','bankDetails','🏦\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','amountUSDT','cointopay_status_check_error','🆔\x20[CHECK]\x20Transaction\x20ID:\x20','📊\x20[CHECK]\x20CoinToPay2\x20payment\x20','webhookLog','length','toISOString','\x20has\x20no\x20gatewayPaymentId,\x20skipping','customerEmail','globalCheckInterval','\x20pending\x20CoinToPay\x20payments','\x20\x20\x20-\x20ShopId:\x20','checkSinglePayment','🧹\x20[DEBUG]\x20Cleared\x20timer\x20#','\x20\x20\x20📅\x20Time:\x20','findUnique','gatewayOrderId','paymentId','🪙\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','COINTOPAY_ERROR','\x20commission:\x20','940624MrnXNw','toLowerCase','🪙\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','gateway','../types/gateway','logShopWebhookError','\x20in\x20','🔍\x20[CHECK]\x20Checking\x20','✅\x20[HOURLY]\x20Payment\x20','__importDefault','📊\x20[CHECK]\x20CoinToPay\x20payment\x20','✅\x20[TIMER]\x20Individual\x20check\x20#','getGatewayCommission','2\x20minutes','not\x20found','size','default','currencyService','shopId','✅\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','FAILED','includes','payment','\x20found:','__esModule','\x20\x20\x20Gateway\x20','created','Success','Shop\x20webhook\x20sent\x20to\x20','🪙\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','setDate','❌\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','🪙\x20[TIMER]\x20Individual\x20check\x20#','currentPayments','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','payment.pending','⏰\x20[DEBUG]\x20Scheduled\x20check\x20#'];a42_0x4465=function(){return _0xb00933;};return a42_0x4465();}exports[a42_0x3989f2(0x175)]=CoinToPayStatusService,exports['coinToPayStatusService']=new CoinToPayStatusService();