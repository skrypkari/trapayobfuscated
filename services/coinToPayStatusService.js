'use strict';function a38_0x4bc9(){const _0xf2f04a=['coinToPayService','text','‚ùå\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','paid','delay','\x20current\x20status:\x20','\x20\x20\x20Gateway\x20','üõë\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','./loggerService','description','\x20to\x20clear',',\x20status=','üìà\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','setDate','üìä\x20[CHECK]\x20CoinToPay\x20payment\x20','globalCheckInterval','GLOBAL_CHECK_INTERVAL_MS','üîÑ\x20[CHECK]\x20Updating\x20payment\x20','\x20USDT','clearPaymentTimers','checkPaymentStatus','findUnique','\x20\x20\x20üìç\x20Source:\x20','\x20is\x20older\x20than\x20',',\x20clearing\x20individual\x20timers','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','‚úÖ\x20[DEBUG]\x20Successfully\x20scheduled\x20','\x20has\x20no\x20gatewayPaymentId,\x20skipping','type','checkExpiredPayments','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','‚è∞\x20[DEBUG]\x20Scheduled\x20check\x20#','PAID','\x20is\x20too\x20new\x20(','logCoinToPayError','‚è∞\x20[GLOBAL]\x20Found\x20','1175920pbODmh','paidAt','schedulePaymentChecks','üí∞\x20[CHECK]\x20Payment\x20','amount','‚ö†Ô∏è\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','ü™ô\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','customerName','stopPeriodicStatusCheck','values','\x20updated:\x20currentPayments=','\x20in\x20','42607QWLRlR','expired','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','Payment\x20older\x20than\x20','\x20pending\x20CoinToPay\x20payments','üìä\x20[HOURLY]\x20Payment\x20','gatewayPaymentId','Payment\x20not\x20found','gatewaySettings','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','\x20status\x20changed\x20to\x20','cointopay2','\x20(after\x20','‚úÖ\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','\x20\x20\x20üìù\x20Details:','currentPayments','logCoinToPayStatus','log','getTime','\x20\x20\x20-\x20paymentId:\x20','status','\x20details:','912KsfCVF','__importDefault','‚úÖ\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','CoinToPayStatusService','ü™ô\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','paymentLink','3168060tGBBWf','‚è∞\x20[HOURLY]\x20Payment\x20','FAILED','üßπ\x20[DEBUG]\x20Cleared\x20timer\x20#','Gateway\x20','COINTOPAY_ERROR','Failed\x20to\x20send\x20shop\x20webhook:','cointopay','paymentLinkId','24MYZEbs','\x20\x20\x20Amount:\x20','\x20\x20\x20-\x20ShopId:\x20','../types/gateway','\x20to\x20','payment.success','delete','EXPIRY_DAYS','\x20days','ü™ô\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','ü™ô\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','remitterIban','\x20for\x20payment\x20','shop','\x20\x20\x20üìÖ\x20Time:\x20','\x20status\x20unchanged\x20(','\x20(age:\x20','coinToPayStatusService','telegramBotService','üìä\x20[CHECK]\x20CoinToPay2\x20payment\x20','webhook_send','\x20initial\x20timers\x20for\x20payment\x20','iban','10RGLiiP','webhookEvents','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','payment.failed','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','\x20commission\x20for\x20shop\x20','‚úÖ\x20[CHECK]\x20Payment\x20','\x20not\x20enabled\x20for\x20shop\x20','8023664BLNFGQ','üìà\x20[COINTOPAY]\x20Payment\x20','size','\x20commission:\x20','\x20days\x20(created\x20before\x20','getPaymentTimerInfo','checkSinglePaymentById','floor','gateway','Automatically\x20expired\x20after\x20','application/json','üßπ\x20[CHECK]\x20Payment\x20','‚ö†Ô∏è\x20[CHECK]\x20Payment\x20','customerEmail','message','‚è∞\x20[GLOBAL]\x20Payment\x20','checkSinglePayment',',\x20gateway\x20','create','toLowerCase','\x20not\x20found,\x20clearing\x20timers','./telegramBotService','\x20checked,\x20','\x20->\x20','has','POST','82zXYETw','stack','convertToUSDT','üîç\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','__esModule','\x20\x20\x20-\x20Amount:\x20','schedule_created','findMany','‚úÖ\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','toFixed','\x20completed\x20for\x20payment\x20','5\x20minutes','‚úÖ\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20',',\x20currentPayments=','üîç\x20[CHECK]\x20Checking\x20','‚ùå\x20[HOURLY]\x20Payment\x20','16457GHOzCr','get','webhookLog','logWhiteDomainError','stringify','confirmedOn','üõë\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','ü™ô\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','gatewayOrderId','ü™ô\x20[GLOBAL]\x20Found\x20','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','amountAfterGatewayCommissionUSDT','set','TesSoft\x20Payment\x20System/1.0','sendPaymentNotification','currencyService','cointopay_status_check_error','forEach','COMPLETED','unknown','sendPaymentStatusNotification','Failed\x20to\x20mark\x20payment\x20as\x20expired','SINGLE','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:',',\x20stopping\x20individual\x20checks','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','\x20updated\x20successfully','‚úÖ\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','721656aTTzfi',',\x20using\x20default\x2010%','checkAllPendingPayments','\x20\x20\x20‚ùå\x20Error:\x20','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','PENDING','h),\x20skipping\x20global\x20check','coinToPay2Service','createdAt','\x20found:','ü™ô\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','ü™ô\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','‚ùå\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','\x20\x20\x20-\x20GatewayPaymentId:\x20','timestamp','created','toISOString','not\x20confirmed','‚úÖ\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','sendShopWebhook','loggerService','‚ùå\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','now','\x20in\x20shop\x20','catch','\x20marked\x20as\x20paid\x20at:\x20','cointopay_auto_expired','webhookUrl','üìä\x20[CHECK]\x20Payment\x20','No\x20specific\x20commission\x20found\x20for\x20gateway\x20','‚è∞\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','/status/','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','\x20days\x20without\x20payment\x20confirmation','\x20has\x20no\x20gatewayPaymentId','\x20with\x20status\x20','getGatewayCommission','1\x20minute','\x20triggered\x20for\x20payment\x20','‚úÖ\x20[TIMER]\x20Individual\x20check\x20#','ü™ô\x20[DEBUG]\x20Creating\x20','includes','./gateways/coinToPay2Service','paymentDetails','shopId','payment.pending','status_check','COINTOPAY_STATUS_CHANGE','\x20\x20\x20-\x20Gateway:\x20','push','adminNotes','üè¶\x20[CHECK]\x20Saved\x20IBAN:\x20','logShopWebhookError','checkPaymentById','\x20skipped,\x20','\x20status:\x20','‚ùå\x20[CHECK]\x20Payment\x20','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','bankDetails','ü™ô\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','amountUSDT','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','commission','\x20status\x20from\x20','Shop\x20webhook\x20sent\x20to\x20','110Leucwn','‚úÖ\x20[EXPIRY]\x20Payment\x20','../config/database','\x20amounts\x20calculated:','getGatewayIdByName','./gateways/coinToPayService','üìä\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','üßπ\x20[DEBUG]\x20Clearing\x20','auto_expire','length','CoinToPayService','üîç\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','payment','Success','default','\x20status\x20is\x20','paymentTimers','4390725oYldkd','error','\x20not\x20found\x20in\x20database','\x20\x20\x20üìù\x20Context:','currency','cointopay_status_check_','update','Unknown\x20error','\x20payment\x20','timers','EXPIRED','transactionId'];a38_0x4bc9=function(){return _0xf2f04a;};return a38_0x4bc9();}const a38_0x22c0f3=a38_0x47f4;(function(_0x57946c,_0x230c01){const _0x3fcf4c=a38_0x47f4,_0x51c759=_0x57946c();while(!![]){try{const _0x2185e3=parseInt(_0x3fcf4c(0x155))/0x1*(parseInt(_0x3fcf4c(0x1b3))/0x2)+-parseInt(_0x3fcf4c(0x231))/0x3+-parseInt(_0x3fcf4c(0x17a))/0x4*(parseInt(_0x3fcf4c(0x149))/0x5)+parseInt(_0x3fcf4c(0x16b))/0x6*(parseInt(_0x3fcf4c(0x1c3))/0x7)+-parseInt(_0x3fcf4c(0x199))/0x8+parseInt(_0x3fcf4c(0x1df))/0x9*(parseInt(_0x3fcf4c(0x191))/0xa)+-parseInt(_0x3fcf4c(0x220))/0xb*(-parseInt(_0x3fcf4c(0x171))/0xc);if(_0x2185e3===_0x230c01)break;else _0x51c759['push'](_0x51c759['shift']());}catch(_0x4831d0){_0x51c759['push'](_0x51c759['shift']());}}}(a38_0x4bc9,0xe7294));var __importDefault=this&&this[a38_0x22c0f3(0x16c)]||function(_0x168263){const _0x24e32b=a38_0x22c0f3;return _0x168263&&_0x168263[_0x24e32b(0x1b7)]?_0x168263:{'default':_0x168263};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a38_0x22c0f3(0x18b)]=exports[a38_0x22c0f3(0x16e)]=void 0x0;const coinToPayService_1=require(a38_0x22c0f3(0x225)),coinToPay2Service_1=require(a38_0x22c0f3(0x209)),gateway_1=require(a38_0x22c0f3(0x17d)),database_1=__importDefault(require(a38_0x22c0f3(0x222))),telegramBotService_1=require(a38_0x22c0f3(0x1ae)),loggerService_1=require(a38_0x22c0f3(0x12d)),currencyService_1=require('./currencyService');class CoinToPayStatusService{constructor(){const _0x1053f2=a38_0x22c0f3;this[_0x1053f2(0x134)]=null,this[_0x1053f2(0x135)]=0x3c*0x3c*0x3e8,this[_0x1053f2(0x181)]=0x5,this[_0x1053f2(0x230)]=new Map(),this[_0x1053f2(0x125)]=new coinToPayService_1[(_0x1053f2(0x22a))](),this[_0x1053f2(0x1e6)]=new coinToPay2Service_1['CoinToPay2Service'](),console[_0x1053f2(0x166)](_0x1053f2(0x1ca));}[a38_0x22c0f3(0x14b)](_0xe5cf49,_0x5e00ae){const _0x3909de=a38_0x22c0f3;console[_0x3909de(0x166)](_0x3909de(0x21a)),console[_0x3909de(0x166)](_0x3909de(0x168)+_0xe5cf49),console[_0x3909de(0x166)]('\x20\x20\x20-\x20gatewayPaymentId:\x20'+_0x5e00ae),this[_0x3909de(0x138)](_0xe5cf49);const _0x33b2d1=[],_0x297cd7=new Date(),_0x11814b=[{'delay':0x1*0x3c*0x3e8,'description':_0x3909de(0x204)},{'delay':0x2*0x3c*0x3e8,'description':'2\x20minutes'},{'delay':0x5*0x3c*0x3e8,'description':_0x3909de(0x1be)},{'delay':0x5*0x3c*0x3e8,'description':'5\x20minutes'}];console['log'](_0x3909de(0x207)+_0x11814b['length']+_0x3909de(0x18f)+_0xe5cf49);let _0x3e4bb9=0x0;_0x11814b[_0x3909de(0x1d4)]((_0x4f0dc7,_0x3205ae)=>{const _0x202892=_0x3909de;_0x3e4bb9+=_0x4f0dc7[_0x202892(0x129)];const _0x5027b2=setTimeout(async()=>{const _0x1c06a3=_0x202892;console[_0x1c06a3(0x166)]('ü™ô\x20[TIMER]\x20Individual\x20check\x20#'+(_0x3205ae+0x1)+_0x1c06a3(0x205)+_0xe5cf49+_0x1c06a3(0x161)+_0x4f0dc7[_0x1c06a3(0x12e)]+')');try{await this[_0x1c06a3(0x19f)](_0xe5cf49),console[_0x1c06a3(0x166)](_0x1c06a3(0x206)+(_0x3205ae+0x1)+_0x1c06a3(0x1bd)+_0xe5cf49);}catch(_0x31384b){console[_0x1c06a3(0x232)]('‚ùå\x20[TIMER]\x20Failed\x20individual\x20check\x20#'+(_0x3205ae+0x1)+_0x1c06a3(0x186)+_0xe5cf49+':',_0x31384b),this['logCoinToPayError'](_0xe5cf49,_0x5e00ae,_0x31384b,_0x1c06a3(0x20d),{'checkNumber':_0x3205ae+0x1,'scheduledAfter':_0x4f0dc7[_0x1c06a3(0x12e)],'isIndividualCheck':!![]});}},_0x3e4bb9);_0x33b2d1['push'](_0x5027b2),console[_0x202892(0x166)](_0x202892(0x144)+(_0x3205ae+0x1)+_0x202892(0x186)+_0xe5cf49+_0x202892(0x154)+_0x3e4bb9/0x3e8+'\x20seconds\x20('+_0x4f0dc7[_0x202892(0x12e)]+')');});const _0xe7680b=setInterval(async()=>{const _0x563132=_0x3909de;console[_0x563132(0x166)](_0x563132(0x1e9)+_0xe5cf49);try{const _0x446309=await database_1[_0x563132(0x22e)][_0x563132(0x22c)][_0x563132(0x13a)]({'where':{'id':_0xe5cf49},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x446309){console['log'](_0x563132(0x1c2)+_0xe5cf49+_0x563132(0x1ad)),this[_0x563132(0x138)](_0xe5cf49);return;}console[_0x563132(0x166)](_0x563132(0x15a)+_0xe5cf49+_0x563132(0x12a)+_0x446309[_0x563132(0x169)]);if(_0x446309[_0x563132(0x169)]!==_0x563132(0x1e4)){console['log']('‚úÖ\x20[HOURLY]\x20Payment\x20'+_0xe5cf49+_0x563132(0x22f)+_0x446309[_0x563132(0x169)]+_0x563132(0x1db)),this[_0x563132(0x138)](_0xe5cf49);return;}const _0x49dc53=Math[_0x563132(0x1a0)]((Date['now']()-_0x446309[_0x563132(0x1e7)][_0x563132(0x167)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x49dc53>=this[_0x563132(0x181)]){console[_0x563132(0x166)](_0x563132(0x172)+_0xe5cf49+_0x563132(0x13c)+this[_0x563132(0x181)]+_0x563132(0x1ff)),this['clearPaymentTimers'](_0xe5cf49);return;}await this[_0x563132(0x19f)](_0xe5cf49),console[_0x563132(0x166)](_0x563132(0x1bb)+_0xe5cf49);}catch(_0x33a245){console[_0x563132(0x232)]('‚ùå\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20'+_0xe5cf49+':',_0x33a245),this[_0x563132(0x147)](_0xe5cf49,_0x5e00ae,_0x33a245,_0x563132(0x20d),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x33b2d1['push'](_0xe7680b),this[_0x3909de(0x230)][_0x3909de(0x1cf)](_0xe5cf49,{'timers':_0x33b2d1,'paymentId':_0xe5cf49,'gatewayPaymentId':_0x5e00ae,'createdAt':_0x297cd7}),console[_0x3909de(0x166)](_0x3909de(0x13f)+_0x11814b[_0x3909de(0x229)]+_0x3909de(0x13e)+_0xe5cf49),console[_0x3909de(0x166)](_0x3909de(0x226)+this['paymentTimers']['size']),this[_0x3909de(0x165)](_0xe5cf49,_0x5e00ae,_0x3909de(0x1e4),_0x3909de(0x1e4),'status_check',{'action':_0x3909de(0x1b9),'scheduledChecks':_0x11814b['length'],'firstCheckIn':_0x11814b[0x0][_0x3909de(0x129)]/0x3e8,'totalTimers':this[_0x3909de(0x230)]['size']});}[a38_0x22c0f3(0x138)](_0x3161c4){const _0x27d677=a38_0x22c0f3,_0x3b8a3d=this[_0x27d677(0x230)][_0x27d677(0x1c4)](_0x3161c4);_0x3b8a3d?(console['log'](_0x27d677(0x227)+_0x3b8a3d[_0x27d677(0x122)]['length']+'\x20timers\x20for\x20payment\x20'+_0x3161c4),_0x3b8a3d[_0x27d677(0x122)][_0x27d677(0x1d4)]((_0x491609,_0x3c9e61)=>{const _0x3a9570=_0x27d677;_0x491609&&(clearTimeout(_0x491609),clearInterval(_0x491609),console[_0x3a9570(0x166)](_0x3a9570(0x174)+(_0x3c9e61+0x1)+_0x3a9570(0x186)+_0x3161c4));}),this['paymentTimers'][_0x27d677(0x180)](_0x3161c4),console[_0x27d677(0x166)](_0x27d677(0x1f1)+_0x3161c4+'.\x20Remaining\x20active\x20timers:\x20'+this[_0x27d677(0x230)]['size'])):console['log'](_0x27d677(0x14e)+_0x3161c4+_0x27d677(0x12f));}async[a38_0x22c0f3(0x19f)](_0xe3c753){const _0x33f434=a38_0x22c0f3;console['log'](_0x33f434(0x1b6)+_0xe3c753);const _0x8c573b=await database_1[_0x33f434(0x22e)][_0x33f434(0x22c)][_0x33f434(0x13a)]({'where':{'id':_0xe3c753},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x8c573b){console[_0x33f434(0x166)](_0x33f434(0x217)+_0xe3c753+_0x33f434(0x233));return;}console[_0x33f434(0x166)](_0x33f434(0x1fb)+_0xe3c753+_0x33f434(0x1e8)),console[_0x33f434(0x166)](_0x33f434(0x20f)+_0x8c573b[_0x33f434(0x1a1)]),console[_0x33f434(0x166)]('\x20\x20\x20-\x20Status:\x20'+_0x8c573b[_0x33f434(0x169)]),console[_0x33f434(0x166)](_0x33f434(0x1ec)+_0x8c573b[_0x33f434(0x15b)]),console[_0x33f434(0x166)](_0x33f434(0x1b8)+_0x8c573b[_0x33f434(0x14d)]+'\x20'+_0x8c573b['currency']),console[_0x33f434(0x166)](_0x33f434(0x17c)+_0x8c573b[_0x33f434(0x20b)]);if(_0x8c573b['gateway']!==_0x33f434(0x178)&&_0x8c573b[_0x33f434(0x1a1)]!==_0x33f434(0x160)){console['log'](_0x33f434(0x1a5)+_0xe3c753+_0x33f434(0x193)+_0x8c573b[_0x33f434(0x1a1)]+')');return;}if(_0x8c573b['status']!=='PENDING'){console['log'](_0x33f434(0x1a5)+_0xe3c753+_0x33f434(0x22f)+_0x8c573b[_0x33f434(0x169)]+_0x33f434(0x1db)),this[_0x33f434(0x138)](_0xe3c753);return;}if(!_0x8c573b[_0x33f434(0x15b)]){console[_0x33f434(0x166)](_0x33f434(0x1a5)+_0xe3c753+_0x33f434(0x201));return;}console[_0x33f434(0x166)]('‚úÖ\x20[CHECK]\x20Payment\x20'+_0xe3c753+'\x20is\x20valid\x20for\x20checking,\x20proceeding...'),await this['checkSinglePayment'](_0x8c573b);}['logCoinToPayStatus'](_0x21eaba,_0x56333e,_0x6ba1b7,_0x4f3a74,_0x50e612,_0x368511){const _0x32106f=a38_0x22c0f3,_0x3658c7={'type':_0x32106f(0x20e),'paymentId':_0x21eaba,'gatewayPaymentId':_0x56333e,'oldStatus':_0x6ba1b7,'newStatus':_0x4f3a74,'source':_0x50e612,'timestamp':new Date()[_0x32106f(0x1ef)](),'details':_0x368511||{}};loggerService_1[_0x32106f(0x1f3)]['logCoinToPayStatus'](_0x3658c7),console['log'](_0x32106f(0x184)+_0x21eaba+'\x20('+_0x56333e+')'),console['log']('\x20\x20\x20üìä\x20Status:\x20'+_0x6ba1b7+_0x32106f(0x1b0)+_0x4f3a74),console[_0x32106f(0x166)](_0x32106f(0x13b)+_0x50e612),console[_0x32106f(0x166)]('\x20\x20\x20üìÖ\x20Time:\x20'+_0x3658c7[_0x32106f(0x1ed)]),_0x368511&&console[_0x32106f(0x166)](_0x32106f(0x163),_0x368511);}['logCoinToPayError'](_0x2081f5,_0x29796c,_0x567921,_0x11c6a6,_0x149880){const _0xcbe337=a38_0x22c0f3,_0x4f50f4={'type':_0xcbe337(0x176),'paymentId':_0x2081f5,'gatewayPaymentId':_0x29796c,'error':_0x567921 instanceof Error?{'message':_0x567921[_0xcbe337(0x1a7)],'stack':_0x567921[_0xcbe337(0x1b4)]}:_0x567921,'source':_0x11c6a6,'timestamp':new Date()['toISOString'](),'context':_0x149880||{}};loggerService_1[_0xcbe337(0x1f3)][_0xcbe337(0x147)](_0x4f50f4),console['error']('ü™ô\x20[ERROR]\x20CoinToPay\x20Error:\x20'+_0x2081f5+'\x20('+_0x29796c+')'),console[_0xcbe337(0x232)](_0xcbe337(0x1e2)+(_0x567921 instanceof Error?_0x567921['message']:_0x567921)),console[_0xcbe337(0x232)](_0xcbe337(0x13b)+_0x11c6a6),console[_0xcbe337(0x232)](_0xcbe337(0x188)+_0x4f50f4[_0xcbe337(0x1ed)]),_0x149880&&console[_0xcbe337(0x232)](_0xcbe337(0x234),_0x149880);}['startPeriodicStatusCheck'](){const _0x1251c3=a38_0x22c0f3;console['log'](_0x1251c3(0x14f)),this[_0x1251c3(0x1e1)]()[_0x1251c3(0x1f7)](_0x38f001=>{const _0xc43bf4=_0x1251c3;console[_0xc43bf4(0x232)]('‚ùå\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:',_0x38f001);}),this[_0x1251c3(0x134)]=setInterval(async()=>{const _0x250a15=_0x1251c3;try{console[_0x250a15(0x166)](_0x250a15(0x16f)),await this[_0x250a15(0x1e1)](),console[_0x250a15(0x166)]('‚úÖ\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed');}catch(_0x4373e8){console[_0x250a15(0x232)](_0x250a15(0x127),_0x4373e8);}},this[_0x1251c3(0x135)]),console[_0x1251c3(0x166)](_0x1251c3(0x162));}[a38_0x22c0f3(0x151)](){const _0x4d1f14=a38_0x22c0f3;console[_0x4d1f14(0x166)](_0x4d1f14(0x1c9));this[_0x4d1f14(0x134)]&&(clearInterval(this[_0x4d1f14(0x134)]),this[_0x4d1f14(0x134)]=null,console['log'](_0x4d1f14(0x12c)));const _0x4cb659=this['paymentTimers'][_0x4d1f14(0x19b)];for(const [_0x4bb67f]of this[_0x4d1f14(0x230)]){this[_0x4d1f14(0x138)](_0x4bb67f);}console[_0x4d1f14(0x166)]('üõë\x20[SHUTDOWN]\x20Cleared\x20'+_0x4cb659+'\x20individual\x20payment\x20timers');}async[a38_0x22c0f3(0x1e1)](){const _0x21ff5e=a38_0x22c0f3;try{console['log'](_0x21ff5e(0x183));const _0x61aa21=await database_1['default'][_0x21ff5e(0x22c)][_0x21ff5e(0x1ba)]({'where':{'gateway':{'in':[_0x21ff5e(0x178),_0x21ff5e(0x160)]},'status':_0x21ff5e(0x1e4),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x21ff5e(0x166)](_0x21ff5e(0x1cc)+_0x61aa21['length']+_0x21ff5e(0x159));if(_0x61aa21[_0x21ff5e(0x229)]===0x0){console[_0x21ff5e(0x166)](_0x21ff5e(0x1ea));return;}const _0x196488=await this[_0x21ff5e(0x142)](_0x61aa21);console[_0x21ff5e(0x166)](_0x21ff5e(0x148)+_0x196488[_0x21ff5e(0x229)]+'\x20expired\x20CoinToPay\x20payments');let _0x47769d=0x0,_0x3632dc=0x0;for(const _0x19ce29 of _0x61aa21){try{if(_0x196488['includes'](_0x19ce29['id'])){console['log'](_0x21ff5e(0x1a8)+_0x19ce29['id']+_0x21ff5e(0x15e)),_0x3632dc++;continue;}if(this[_0x21ff5e(0x230)][_0x21ff5e(0x1b1)](_0x19ce29['id'])){console['log'](_0x21ff5e(0x1a8)+_0x19ce29['id']+_0x21ff5e(0x1e3)),_0x3632dc++;continue;}const _0x3d6a05=(Date[_0x21ff5e(0x1f5)]()-_0x19ce29[_0x21ff5e(0x1e7)][_0x21ff5e(0x167)]())/(0x3e8*0x3c*0x3c);if(_0x3d6a05<0x1){console[_0x21ff5e(0x166)](_0x21ff5e(0x1a8)+_0x19ce29['id']+_0x21ff5e(0x146)+_0x3d6a05['toFixed'](0x1)+_0x21ff5e(0x1e5)),_0x3632dc++;continue;}console[_0x21ff5e(0x166)](_0x21ff5e(0x22b)+_0x19ce29['id']+_0x21ff5e(0x18a)+_0x3d6a05[_0x21ff5e(0x1bc)](0x1)+'h)'),await this[_0x21ff5e(0x1a9)](_0x19ce29),_0x47769d++,await new Promise(_0x202ea7=>setTimeout(_0x202ea7,0x7d0));}catch(_0x135ddf){console['error']('‚ùå\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20'+_0x19ce29['id']+':',_0x135ddf),this[_0x21ff5e(0x147)](_0x19ce29['id'],_0x19ce29[_0x21ff5e(0x15b)]||_0x21ff5e(0x1d6),_0x135ddf,_0x21ff5e(0x20d),{'isGlobalCheck':!![],'paymentAmount':_0x19ce29[_0x21ff5e(0x14d)],'paymentCurrency':_0x19ce29[_0x21ff5e(0x11d)],'shopId':_0x19ce29['shopId'],'createdAt':_0x19ce29[_0x21ff5e(0x1e7)]}),loggerService_1[_0x21ff5e(0x1f3)][_0x21ff5e(0x1c6)](_0x21ff5e(0x178),_0x21ff5e(0x1fe)+_0x19ce29[_0x21ff5e(0x15b)],_0x135ddf);}}console[_0x21ff5e(0x166)]('‚úÖ\x20[GLOBAL]\x20Global\x20check\x20completed:\x20'+_0x47769d+_0x21ff5e(0x1af)+_0x3632dc+_0x21ff5e(0x215)+_0x196488[_0x21ff5e(0x229)]+'\x20expired');}catch(_0x364506){console[_0x21ff5e(0x232)](_0x21ff5e(0x1cd),_0x364506);}}async[a38_0x22c0f3(0x142)](_0x474258){const _0x4c2d87=a38_0x22c0f3,_0x187603=[],_0x88ac0e=new Date();_0x88ac0e[_0x4c2d87(0x132)](_0x88ac0e['getDate']()-this[_0x4c2d87(0x181)]),console[_0x4c2d87(0x166)](_0x4c2d87(0x1fd)+this[_0x4c2d87(0x181)]+_0x4c2d87(0x19d)+_0x88ac0e[_0x4c2d87(0x1ef)]()+')');for(const _0x463ad4 of _0x474258){if(_0x463ad4[_0x4c2d87(0x1e7)]<_0x88ac0e){console[_0x4c2d87(0x166)]('‚è∞\x20[EXPIRY]\x20Payment\x20'+_0x463ad4['id']+_0x4c2d87(0x13c)+this[_0x4c2d87(0x181)]+'\x20days,\x20marking\x20as\x20EXPIRED');try{this[_0x4c2d87(0x165)](_0x463ad4['id'],_0x463ad4[_0x4c2d87(0x15b)]||_0x4c2d87(0x1d6),_0x4c2d87(0x1e4),'EXPIRED','auto_expire',{'reason':'Payment\x20older\x20than\x20'+this['EXPIRY_DAYS']+_0x4c2d87(0x182),'createdAt':_0x463ad4['createdAt'],'daysSinceCreation':Math['floor']((Date['now']()-_0x463ad4[_0x4c2d87(0x1e7)][_0x4c2d87(0x167)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x463ad4[_0x4c2d87(0x14d)],'paymentCurrency':_0x463ad4['currency'],'shopId':_0x463ad4[_0x4c2d87(0x20b)]}),await database_1[_0x4c2d87(0x22e)]['payment']['update']({'where':{'id':_0x463ad4['id']},'data':{'status':'EXPIRED','updatedAt':new Date(),'adminNotes':_0x4c2d87(0x1a2)+this['EXPIRY_DAYS']+_0x4c2d87(0x200)}}),await database_1['default'][_0x4c2d87(0x1c5)][_0x4c2d87(0x1ab)]({'data':{'paymentId':_0x463ad4['id'],'shopId':_0x463ad4[_0x4c2d87(0x20b)],'event':_0x4c2d87(0x1f9),'statusCode':0xc8,'responseBody':JSON[_0x4c2d87(0x1c7)]({'reason':_0x4c2d87(0x158)+this[_0x4c2d87(0x181)]+'\x20days','createdAt':_0x463ad4[_0x4c2d87(0x1e7)],'expiredAt':new Date()[_0x4c2d87(0x1ef)](),'daysSinceCreation':Math[_0x4c2d87(0x1a0)]((Date[_0x4c2d87(0x1f5)]()-_0x463ad4[_0x4c2d87(0x1e7)][_0x4c2d87(0x167)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this['sendShopWebhook'](_0x463ad4,'EXPIRED'),await this[_0x4c2d87(0x1d7)](_0x463ad4,_0x4c2d87(0x123)),this['clearPaymentTimers'](_0x463ad4['id']),_0x187603[_0x4c2d87(0x210)](_0x463ad4['id']),console[_0x4c2d87(0x166)](_0x4c2d87(0x221)+_0x463ad4['id']+_0x4c2d87(0x1dc)+this[_0x4c2d87(0x181)]+'-day\x20timeout');}catch(_0x41151f){console['error'](_0x4c2d87(0x1eb)+_0x463ad4['id']+':',_0x41151f),this[_0x4c2d87(0x147)](_0x463ad4['id'],_0x463ad4['gatewayPaymentId']||_0x4c2d87(0x1d6),_0x41151f,_0x4c2d87(0x228),{'reason':_0x4c2d87(0x1d8),'createdAt':_0x463ad4[_0x4c2d87(0x1e7)],'daysSinceCreation':Math['floor']((Date[_0x4c2d87(0x1f5)]()-_0x463ad4[_0x4c2d87(0x1e7)][_0x4c2d87(0x167)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x187603;}async['checkSinglePayment'](_0x4e28f9){const _0x2a8db4=a38_0x22c0f3;if(!_0x4e28f9[_0x2a8db4(0x15b)]){console[_0x2a8db4(0x166)]('‚ö†Ô∏è\x20[CHECK]\x20Payment\x20'+_0x4e28f9['id']+_0x2a8db4(0x140));return;}console[_0x2a8db4(0x166)](_0x2a8db4(0x1c1)+_0x4e28f9[_0x2a8db4(0x1a1)]+_0x2a8db4(0x121)+_0x4e28f9['id']+'\x20('+_0x4e28f9[_0x2a8db4(0x15b)]+')');try{let _0x375103;_0x4e28f9[_0x2a8db4(0x1a1)]===_0x2a8db4(0x160)?(_0x375103=await this[_0x2a8db4(0x1e6)][_0x2a8db4(0x139)](_0x4e28f9['gatewayPaymentId']),console['log'](_0x2a8db4(0x18d)+_0x4e28f9['id']+_0x2a8db4(0x216)+_0x375103[_0x2a8db4(0x169)])):(_0x375103=await this[_0x2a8db4(0x125)][_0x2a8db4(0x139)](_0x4e28f9['gatewayPaymentId']),console['log'](_0x2a8db4(0x133)+_0x4e28f9['id']+_0x2a8db4(0x216)+_0x375103['status']));_0x375103['paymentDetails']&&console[_0x2a8db4(0x166)](_0x2a8db4(0x1fb)+_0x4e28f9['id']+_0x2a8db4(0x16a),{'iban':_0x375103[_0x2a8db4(0x20a)][_0x2a8db4(0x190)]||'not\x20found','transactionId':_0x375103[_0x2a8db4(0x20a)]['transactionId'],'createdOn':_0x375103[_0x2a8db4(0x20a)]['createdOn'],'confirmedOn':_0x375103['paymentDetails']['confirmedOn']||_0x2a8db4(0x1f0)});if(_0x375103['status']!==_0x4e28f9['status']){console[_0x2a8db4(0x166)](_0x2a8db4(0x136)+_0x4e28f9['id']+_0x2a8db4(0x21e)+_0x4e28f9['status']+_0x2a8db4(0x17e)+_0x375103[_0x2a8db4(0x169)]),this[_0x2a8db4(0x165)](_0x4e28f9['id'],_0x4e28f9[_0x2a8db4(0x15b)],_0x4e28f9[_0x2a8db4(0x169)],_0x375103[_0x2a8db4(0x169)],'status_check',{'paymentDetails':_0x375103[_0x2a8db4(0x20a)],'amount':_0x375103[_0x2a8db4(0x14d)],'currency':_0x375103[_0x2a8db4(0x11d)],'shopId':_0x4e28f9[_0x2a8db4(0x20b)],'checkTimestamp':new Date()[_0x2a8db4(0x1ef)]()});const _0x57f3d7={'status':_0x375103[_0x2a8db4(0x169)],'updatedAt':new Date()};if(_0x375103['status']===_0x2a8db4(0x145)&&_0x4e28f9[_0x2a8db4(0x169)]!==_0x2a8db4(0x145)){_0x57f3d7['paidAt']=new Date();if(!_0x4e28f9[_0x2a8db4(0x21b)]){const _0x418cdb=await currencyService_1[_0x2a8db4(0x1d2)][_0x2a8db4(0x1b5)](_0x4e28f9[_0x2a8db4(0x14d)],_0x4e28f9[_0x2a8db4(0x11d)]);_0x57f3d7[_0x2a8db4(0x21b)]=_0x418cdb;const _0xc45076=await this['getGatewayCommission'](_0x4e28f9[_0x2a8db4(0x20b)],_0x4e28f9[_0x2a8db4(0x1a1)]),_0x17c63c=_0x418cdb*(0x1-_0xc45076/0x64);_0x57f3d7[_0x2a8db4(0x1ce)]=_0x17c63c,console[_0x2a8db4(0x166)](_0x2a8db4(0x14c)+_0x4e28f9['id']+_0x2a8db4(0x223)),console['log'](_0x2a8db4(0x17b)+_0x4e28f9['amount']+'\x20'+_0x4e28f9['currency']+'\x20->\x20'+_0x418cdb[_0x2a8db4(0x1bc)](0x6)+'\x20USDT'),console[_0x2a8db4(0x166)](_0x2a8db4(0x12b)+_0x4e28f9[_0x2a8db4(0x1a1)]+_0x2a8db4(0x19c)+_0xc45076+'%'),console[_0x2a8db4(0x166)]('\x20\x20\x20Amount\x20after\x20commission:\x20'+_0x17c63c['toFixed'](0x6)+_0x2a8db4(0x137));}console[_0x2a8db4(0x166)](_0x2a8db4(0x14c)+_0x4e28f9['id']+_0x2a8db4(0x1f8)+_0x57f3d7[_0x2a8db4(0x14a)]['toISOString']());}if(_0x375103['paymentDetails']){const _0x2ff58e=_0x375103[_0x2a8db4(0x20a)];_0x2ff58e['iban']&&(_0x57f3d7[_0x2a8db4(0x185)]=_0x2ff58e['iban'],console[_0x2a8db4(0x166)](_0x2a8db4(0x212)+_0x2ff58e[_0x2a8db4(0x190)]));if(_0x2ff58e[_0x2a8db4(0x219)]){const _0x30ec62=_0x4e28f9[_0x2a8db4(0x211)]||'',_0x42ac41='Bank\x20Details:\x20'+_0x2ff58e[_0x2a8db4(0x219)];_0x57f3d7['adminNotes']=_0x30ec62?_0x30ec62+'\x0a\x0a'+_0x42ac41:_0x42ac41,console[_0x2a8db4(0x166)]('üè¶\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes');}_0x2ff58e['transactionId']&&console[_0x2a8db4(0x166)]('üÜî\x20[CHECK]\x20Transaction\x20ID:\x20'+_0x2ff58e[_0x2a8db4(0x124)]),_0x2ff58e[_0x2a8db4(0x1c8)]&&console[_0x2a8db4(0x166)](_0x2a8db4(0x1de)+_0x2ff58e[_0x2a8db4(0x1c8)]);}await database_1[_0x2a8db4(0x22e)][_0x2a8db4(0x22c)][_0x2a8db4(0x11f)]({'where':{'id':_0x4e28f9['id']},'data':_0x57f3d7});if(_0x375103[_0x2a8db4(0x169)]===_0x2a8db4(0x145)&&_0x4e28f9[_0x2a8db4(0x169)]!==_0x2a8db4(0x145)){console[_0x2a8db4(0x166)](_0x2a8db4(0x19a)+_0x4e28f9['id']+'\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link');const _0xc39ee6=await database_1['default'][_0x2a8db4(0x22c)]['findUnique']({'where':{'id':_0x4e28f9['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0xc39ee6?.[_0x2a8db4(0x179)]&&_0xc39ee6[_0x2a8db4(0x170)])try{const _0x39fc75=_0xc39ee6['paymentLink'];console[_0x2a8db4(0x166)](_0x2a8db4(0x131)+_0x39fc75['id']+':\x20type='+_0x39fc75[_0x2a8db4(0x141)]+_0x2a8db4(0x1c0)+_0x39fc75[_0x2a8db4(0x164)]+_0x2a8db4(0x130)+_0x39fc75['status']);const _0x495bdd=_0x39fc75[_0x2a8db4(0x164)]+0x1,_0x16a9f4=_0x39fc75[_0x2a8db4(0x141)]===_0x2a8db4(0x1d9)?_0x2a8db4(0x1d5):_0x39fc75[_0x2a8db4(0x169)];await database_1[_0x2a8db4(0x22e)][_0x2a8db4(0x170)][_0x2a8db4(0x11f)]({'where':{'id':_0x39fc75['id']},'data':{'currentPayments':_0x495bdd,'status':_0x16a9f4,'updatedAt':new Date()}}),console['log']('‚úÖ\x20[COINTOPAY]\x20Payment\x20link\x20'+_0x39fc75['id']+_0x2a8db4(0x153)+_0x39fc75[_0x2a8db4(0x164)]+'\x20->\x20'+_0x495bdd+_0x2a8db4(0x130)+_0x39fc75[_0x2a8db4(0x169)]+_0x2a8db4(0x1b0)+_0x16a9f4);}catch(_0x1229bb){console['error'](_0x2a8db4(0x1f4),_0x1229bb);}else console['log'](_0x2a8db4(0x19a)+_0x4e28f9['id']+_0x2a8db4(0x21c));}await database_1['default'][_0x2a8db4(0x1c5)][_0x2a8db4(0x1ab)]({'data':{'paymentId':_0x4e28f9['id'],'shopId':_0x4e28f9['shopId'],'event':_0x2a8db4(0x11e)+_0x375103['status'][_0x2a8db4(0x1ac)](),'statusCode':0xc8,'responseBody':JSON[_0x2a8db4(0x1c7)]({'oldStatus':_0x4e28f9[_0x2a8db4(0x169)],'newStatus':_0x375103[_0x2a8db4(0x169)],'paymentDetails':_0x375103[_0x2a8db4(0x20a)],'checkedAt':new Date()[_0x2a8db4(0x1ef)]()})}}),await this[_0x2a8db4(0x1f2)](_0x4e28f9,_0x375103[_0x2a8db4(0x169)]),await this[_0x2a8db4(0x1d7)](_0x4e28f9,_0x375103[_0x2a8db4(0x169)]),_0x375103[_0x2a8db4(0x169)]!==_0x2a8db4(0x1e4)&&(console[_0x2a8db4(0x166)](_0x2a8db4(0x1a4)+_0x4e28f9['id']+_0x2a8db4(0x15f)+_0x375103[_0x2a8db4(0x169)]+_0x2a8db4(0x13d)),this[_0x2a8db4(0x138)](_0x4e28f9['id'])),console[_0x2a8db4(0x166)](_0x2a8db4(0x197)+_0x4e28f9['id']+_0x2a8db4(0x1dd));}else console[_0x2a8db4(0x166)](_0x2a8db4(0x1fb)+_0x4e28f9['id']+_0x2a8db4(0x189)+_0x375103[_0x2a8db4(0x169)]+')'),this[_0x2a8db4(0x165)](_0x4e28f9['id'],_0x4e28f9[_0x2a8db4(0x15b)],_0x4e28f9['status'],_0x375103[_0x2a8db4(0x169)],_0x2a8db4(0x20d),{'statusUnchanged':!![],'paymentDetails':_0x375103[_0x2a8db4(0x20a)],'amount':_0x375103[_0x2a8db4(0x14d)],'currency':_0x375103[_0x2a8db4(0x11d)],'shopId':_0x4e28f9['shopId'],'checkTimestamp':new Date()[_0x2a8db4(0x1ef)]()});}catch(_0x2b6914){console['error']('‚ùå\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20'+_0x4e28f9['id']+':',_0x2b6914),this[_0x2a8db4(0x147)](_0x4e28f9['id'],_0x4e28f9[_0x2a8db4(0x15b)],_0x2b6914,'status_check',{'paymentAmount':_0x4e28f9['amount'],'paymentCurrency':_0x4e28f9['currency'],'shopId':_0x4e28f9[_0x2a8db4(0x20b)],'createdAt':_0x4e28f9['createdAt']}),await database_1[_0x2a8db4(0x22e)][_0x2a8db4(0x1c5)][_0x2a8db4(0x1ab)]({'data':{'paymentId':_0x4e28f9['id'],'shopId':_0x4e28f9[_0x2a8db4(0x20b)],'event':_0x2a8db4(0x1d3),'statusCode':0x1f4,'responseBody':JSON[_0x2a8db4(0x1c7)]({'error':_0x2b6914 instanceof Error?_0x2b6914[_0x2a8db4(0x1a7)]:_0x2a8db4(0x120),'gatewayPaymentId':_0x4e28f9[_0x2a8db4(0x15b)],'checkedAt':new Date()['toISOString']()})}});}}async['sendShopWebhook'](_0x13ffe3,_0x229ba8){const _0x35702c=a38_0x22c0f3,_0xca4a28=Date['now']();try{const _0x45f676=_0x13ffe3[_0x35702c(0x187)],_0x5343bd=_0x45f676['settings'];if(!_0x5343bd?.[_0x35702c(0x1fa)]){console[_0x35702c(0x166)](_0x35702c(0x195)+_0x45f676['id']);return;}const _0x2af85d=_0x229ba8===_0x35702c(0x145)?_0x35702c(0x17f):_0x229ba8===_0x35702c(0x173)?_0x35702c(0x194):_0x229ba8===_0x35702c(0x123)?_0x35702c(0x194):_0x35702c(0x20c);if(!_0x5343bd[_0x35702c(0x192)]?.[_0x35702c(0x208)](_0x2af85d)){console[_0x35702c(0x166)]('Webhook\x20event\x20'+_0x2af85d+_0x35702c(0x198)+_0x45f676['id']);return;}const _0x3b28a8=(0x0,gateway_1[_0x35702c(0x224)])(_0x13ffe3[_0x35702c(0x1a1)])||_0x13ffe3[_0x35702c(0x1a1)],_0x56a7e1={'event':_0x2af85d,'payment':{'id':_0x13ffe3['id'],'order_id':_0x13ffe3['orderId'],'gateway_order_id':_0x13ffe3[_0x35702c(0x1cb)],'gateway':_0x3b28a8,'amount':_0x13ffe3[_0x35702c(0x14d)],'currency':_0x13ffe3['currency'],'status':_0x229ba8['toLowerCase'](),'customer_email':_0x13ffe3[_0x35702c(0x1a6)],'customer_name':_0x13ffe3[_0x35702c(0x150)],'created_at':_0x13ffe3[_0x35702c(0x1e7)],'updated_at':new Date()}},_0x62c973=await fetch(_0x5343bd[_0x35702c(0x1fa)],{'method':_0x35702c(0x1b2),'headers':{'Content-Type':_0x35702c(0x1a3),'User-Agent':_0x35702c(0x1d0)},'body':JSON[_0x35702c(0x1c7)](_0x56a7e1)}),_0x4ff2e7=Date[_0x35702c(0x1f5)]()-_0xca4a28,_0x46574e=_0x62c973['ok']?_0x35702c(0x22d):await _0x62c973[_0x35702c(0x126)]();loggerService_1['loggerService']['logShopWebhookSent'](_0x13ffe3[_0x35702c(0x20b)],_0x5343bd[_0x35702c(0x1fa)],_0x2af85d,_0x62c973['status'],_0x4ff2e7,_0x56a7e1),console[_0x35702c(0x166)](_0x35702c(0x21f)+_0x5343bd[_0x35702c(0x1fa)]+_0x35702c(0x202)+_0x62c973[_0x35702c(0x169)]+'\x20('+_0x4ff2e7+'ms)');}catch(_0x2c31cc){console[_0x35702c(0x232)](_0x35702c(0x177),_0x2c31cc),loggerService_1[_0x35702c(0x1f3)][_0x35702c(0x213)](_0x13ffe3['shopId'],_0x13ffe3[_0x35702c(0x187)]?.['settings']?.[_0x35702c(0x1fa)]||_0x35702c(0x1d6),_0x35702c(0x18e),_0x2c31cc,{});}}async['sendPaymentStatusNotification'](_0x4e6e98,_0x41e658){const _0x2a340c=a38_0x22c0f3;try{const _0x26ba5a={'PENDING':_0x2a340c(0x1ee),'PAID':_0x2a340c(0x128),'FAILED':'failed','EXPIRED':_0x2a340c(0x156)},_0x21c08e=_0x26ba5a[_0x41e658];if(!_0x21c08e||_0x21c08e===_0x2a340c(0x1ee))return;await telegramBotService_1[_0x2a340c(0x18c)][_0x2a340c(0x1d1)](_0x4e6e98[_0x2a340c(0x20b)],_0x4e6e98,_0x21c08e);}catch(_0x38c04a){console[_0x2a340c(0x232)](_0x2a340c(0x1da),_0x38c04a);}}async[a38_0x22c0f3(0x214)](_0xd40b6){const _0x5ce855=a38_0x22c0f3;console[_0x5ce855(0x166)]('üîç\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20'+_0xd40b6);const _0x2afb29=await database_1[_0x5ce855(0x22e)][_0x5ce855(0x22c)][_0x5ce855(0x13a)]({'where':{'id':_0xd40b6},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x2afb29)throw new Error(_0x5ce855(0x15c));if(_0x2afb29[_0x5ce855(0x1a1)]!=='cointopay'&&_0x2afb29[_0x5ce855(0x1a1)]!==_0x5ce855(0x160))throw new Error(_0x5ce855(0x218));console[_0x5ce855(0x166)](_0x5ce855(0x16d)+_0x2afb29['gateway']+_0x5ce855(0x121)+_0xd40b6),await this[_0x5ce855(0x1a9)](_0x2afb29),console['log'](_0x5ce855(0x1bf)+_0xd40b6);}['getServiceStats'](){const _0x1614ba=a38_0x22c0f3,_0x1e8b57=this['globalCheckInterval']?this[_0x1614ba(0x135)]:undefined,_0x130620=Array['from'](this['paymentTimers'][_0x1614ba(0x152)]())['map'](_0x4b3733=>({'paymentId':_0x4b3733['paymentId'],'gatewayPaymentId':_0x4b3733[_0x1614ba(0x15b)],'createdAt':_0x4b3733[_0x1614ba(0x1e7)],'timersCount':_0x4b3733[_0x1614ba(0x122)]['length']}));return{'isActive':!!this[_0x1614ba(0x134)],'globalCheckIntervalMinutes':this[_0x1614ba(0x135)]/(0x3e8*0x3c),'expiryDays':this[_0x1614ba(0x181)],'activeIndividualTimers':this[_0x1614ba(0x230)]['size'],'nextGlobalCheckIn':_0x1e8b57,'paymentTimersDetails':_0x130620};}[a38_0x22c0f3(0x19e)](_0x3b43bf){const _0x16d63a=a38_0x22c0f3,_0x48d127=this['paymentTimers'][_0x16d63a(0x1c4)](_0x3b43bf);if(_0x48d127)return{'hasTimers':!![],'timersCount':_0x48d127[_0x16d63a(0x122)][_0x16d63a(0x229)],'createdAt':_0x48d127[_0x16d63a(0x1e7)],'gatewayPaymentId':_0x48d127[_0x16d63a(0x15b)]};return{'hasTimers':![]};}async[a38_0x22c0f3(0x203)](_0x1ca308,_0x3a44d3){const _0x8249c6=a38_0x22c0f3;try{const _0x3140bd=await database_1[_0x8249c6(0x22e)]['shop']['findUnique']({'where':{'id':_0x1ca308},'select':{'gatewaySettings':!![]}});if(!_0x3140bd?.[_0x8249c6(0x15d)])return console[_0x8249c6(0x166)](_0x8249c6(0x143)+_0x1ca308+',\x20using\x20default\x20commission\x2010%'),0xa;const _0x1d8688=JSON['parse'](_0x3140bd[_0x8249c6(0x15d)]);for(const [_0x5de775,_0x3b62a1]of Object['entries'](_0x1d8688)){if(_0x5de775[_0x8249c6(0x1ac)]()===_0x3a44d3[_0x8249c6(0x1ac)]()){const _0x310657=_0x3b62a1[_0x8249c6(0x21d)]||0xa;return console['log'](_0x8249c6(0x175)+_0x3a44d3+_0x8249c6(0x196)+_0x1ca308+':\x20'+_0x310657+'%'),_0x310657;}}return console[_0x8249c6(0x166)](_0x8249c6(0x1fc)+_0x3a44d3+_0x8249c6(0x1f6)+_0x1ca308+_0x8249c6(0x1e0)),0xa;}catch(_0x560ecb){return console[_0x8249c6(0x232)](_0x8249c6(0x157)+_0x1ca308+_0x8249c6(0x1aa)+_0x3a44d3+':',_0x560ecb),0xa;}}}function a38_0x47f4(_0x4839dd,_0xd7ce62){const _0x4bc940=a38_0x4bc9();return a38_0x47f4=function(_0x47f489,_0x5670ac){_0x47f489=_0x47f489-0x11d;let _0x2acf9e=_0x4bc940[_0x47f489];return _0x2acf9e;},a38_0x47f4(_0x4839dd,_0xd7ce62);}exports[a38_0x22c0f3(0x16e)]=CoinToPayStatusService,exports[a38_0x22c0f3(0x18b)]=new CoinToPayStatusService();