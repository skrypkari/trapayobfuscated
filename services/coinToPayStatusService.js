'use strict';const a50_0x18f614=a50_0x3607;(function(_0x2dac5c,_0xe218b7){const _0x34a991=a50_0x3607,_0x17784e=_0x2dac5c();while(!![]){try{const _0x23435e=-parseInt(_0x34a991(0x1ef))/0x1+parseInt(_0x34a991(0x231))/0x2*(-parseInt(_0x34a991(0x19f))/0x3)+-parseInt(_0x34a991(0x1fb))/0x4+parseInt(_0x34a991(0x225))/0x5+parseInt(_0x34a991(0x17d))/0x6*(-parseInt(_0x34a991(0x237))/0x7)+parseInt(_0x34a991(0x16f))/0x8+parseInt(_0x34a991(0x212))/0x9*(parseInt(_0x34a991(0x1f4))/0xa);if(_0x23435e===_0xe218b7)break;else _0x17784e['push'](_0x17784e['shift']());}catch(_0x403edc){_0x17784e['push'](_0x17784e['shift']());}}}(a50_0xdedf,0x7eeae));function a50_0xdedf(){const _0x120924=['‚úÖ\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','paidAt','telegramBotService','checkAllPendingPayments','paymentTimers','GLOBAL_CHECK_INTERVAL_MS','\x20(after\x20',',\x20gateway\x20','/status/','text','\x20\x20\x20-\x20GatewayPaymentId:\x20','delay','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','cointopay_status_check_error','coinToPayService','\x20\x20\x20Gateway\x20','webhook_send','üîç\x20[CHECK]\x20Checking\x20','./loggerService','webhookLog','h),\x20skipping\x20global\x20check','not\x20found','findMany','remitterIban','logShopWebhookError','üìä\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','size','ü™ô\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','settings','status','‚è∞\x20[EXPIRY]\x20Payment\x20','log','Success','PENDING','\x20has\x20no\x20gatewayPaymentId','transactionId','‚úÖ\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','toFixed','getGatewayCommission','\x20->\x20','payment.success','910376Rbfsko','üßπ\x20[DEBUG]\x20Cleared\x20timer\x20#','\x20triggered\x20for\x20payment\x20','status_check','‚è∞\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','\x20\x20\x20-\x20ShopId:\x20','now','paymentLink','\x20current\x20status:\x20','üõë\x20[SHUTDOWN]\x20Cleared\x20',',\x20clearing\x20individual\x20timers','timestamp','sendShopWebhook','clearPaymentTimers','2622DAPAwH','Gateway\x20','\x20\x20\x20-\x20Status:\x20','push','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','convertToUSDT','checkSinglePaymentById','get','\x20\x20\x20Amount\x20after\x20commission:\x20','commission','values','checkExpiredPayments','\x20has\x20no\x20gatewayPaymentId,\x20skipping','‚ùå\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','‚úÖ\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','Failed\x20to\x20send\x20shop\x20webhook:','checkPaymentStatus','\x20for\x20payment\x20','ms)','setDate','../types/gateway','sendPaymentNotification','amountAfterGatewayCommissionUSDT','gatewayCommissionRate','PAID','sendPaymentStatusNotification','checkSinglePayment','üÜî\x20[CHECK]\x20Transaction\x20ID:\x20','amountUSDT','üìä\x20[CHECK]\x20Payment\x20','timers','application/json','\x20is\x20too\x20new\x20(','\x20payment\x20','5898QFgpBU','customerName','gatewayPaymentId','‚ùå\x20[TIMER]\x20Failed\x20individual\x20check\x20#','\x20\x20\x20üìù\x20Details:','ü™ô\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','ü™ô\x20[ERROR]\x20CoinToPay\x20Error:\x20','ü™ô\x20[GLOBAL]\x20Found\x20','ü™ô\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','‚ö†Ô∏è\x20[CHECK]\x20Payment\x20','currency','\x20expired\x20CoinToPay\x20payments','2\x20minutes','‚úÖ\x20[TIMER]\x20Individual\x20check\x20#','webhookEvents','\x20\x20\x20üìç\x20Source:\x20','bankDetails','set','./gateways/coinToPay2Service','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','loggerService','CoinToPay2Service','created','\x20\x20\x20üìÖ\x20Time:\x20','from','toLowerCase','length','‚è∞\x20[GLOBAL]\x20Payment\x20','\x20pending\x20CoinToPay\x20payments','üí∞\x20[CHECK]\x20Payment\x20','COINTOPAY_STATUS_CHANGE','getGatewayIdByName','\x20commission:\x20','\x20\x20\x20-\x20gatewayPaymentId:\x20','shopId','checkPaymentById','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','\x20updated\x20successfully','logCoinToPayError','‚ùå\x20[HOURLY]\x20Payment\x20','Payment\x20older\x20than\x20','\x20in\x20','\x20days\x20(created\x20before\x20','EXPIRED','\x20updated:\x20currentPayments=','../config/database','‚úÖ\x20[CHECK]\x20Payment\x20','SINGLE','logShopWebhookSent','__importDefault','üîç\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','error','1\x20minute','getDate','\x20days','üîç\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','findUnique','Shop\x20webhook\x20sent\x20to\x20','defineProperty','paymentLinkId','createdOn','has','gatewayOrderId','\x20commission\x20for\x20shop\x20','‚úÖ\x20[DEBUG]\x20Successfully\x20scheduled\x20','üîÑ\x20[CHECK]\x20Updating\x20payment\x20','No\x20specific\x20commission\x20found\x20for\x20gateway\x20','-day\x20timeout','\x20found:','‚úÖ\x20[COINTOPAY]\x20Payment\x20link\x20','‚ùå\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','\x20status\x20from\x20','paymentDetails','Unknown\x20error','auto_expire','‚úÖ\x20[EXPIRY]\x20Payment\x20','\x20\x20\x20Amount:\x20','toISOString','COINTOPAY_ERROR','unknown','188491mqlBjF','\x20checked,\x20','üìà\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','getPaymentTimerInfo','\x20marked\x20as\x20paid\x20at:\x20','50PXIDoO','\x20skipped,\x20',':\x20type=','ü™ô\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','‚úÖ\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','paid','1345696ajzvGj','Webhook\x20event\x20','getTime','createdAt','\x20to\x20clear',',\x20using\x20default\x20commission\x2010%','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','update','üìà\x20[COINTOPAY]\x20Payment\x20','FAILED','payment','failed','üßπ\x20[DEBUG]\x20Clearing\x20','includes','üõë\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','\x20amounts\x20calculated:','\x20status\x20unchanged\x20(','cointopay2','create','gatewaySettings','ü™ô\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','‚úÖ\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','amount','1354743rmJabG','ü™ô\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','\x20expired','ü™ô\x20[TIMER]\x20Individual\x20check\x20#','webhookUrl','\x20\x20\x20‚ùå\x20Error:\x20','message','\x20in\x20shop\x20','catch','CoinToPayService','entries','‚ùå\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','confirmedOn','\x20\x20\x20üìä\x20Status:\x20','EXPIRY_DAYS','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','üè¶\x20[CHECK]\x20Bank\x20details\x20provided:\x20','iban','./currencyService','5131660lOCnVA','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','currentPayments',',\x20currentPayments=','not\x20confirmed','expired','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','üìä\x20[HOURLY]\x20Payment\x20','\x20USDT','\x20status:\x20','\x20initial\x20timers\x20for\x20payment\x20','cointopay','14TrJBEg','orderId','\x20seconds\x20(','‚ùå\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','gateway','payment.pending','13363wjHhps','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','\x20is\x20older\x20than\x20','forEach','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','customerEmail','__esModule','5\x20minutes','üè¶\x20[CHECK]\x20Saved\x20IBAN:\x20','logWhiteDomainError','üìä\x20[CHECK]\x20CoinToPay2\x20payment\x20','coinToPayStatusService','default','\x20(age:\x20','‚ùå\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','stopPeriodicStatusCheck','\x20\x20\x20-\x20Gateway:\x20',',\x20stopping\x20individual\x20checks','‚è∞\x20[HOURLY]\x20Payment\x20','\x20not\x20found\x20in\x20database','description','üõë\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','logCoinToPayStatus','\x20days,\x20marking\x20as\x20EXPIRED','stringify','\x20\x20\x20-\x20Amount:\x20','shop','payment.failed','floor','\x20status\x20is\x20','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','CoinToPayStatusService','globalCheckInterval','./telegramBotService'];a50_0xdedf=function(){return _0x120924;};return a50_0xdedf();}var __importDefault=this&&this[a50_0x18f614(0x1d0)]||function(_0x3ecdc5){const _0x5491d7=a50_0x18f614;return _0x3ecdc5&&_0x3ecdc5[_0x5491d7(0x23d)]?_0x3ecdc5:{'default':_0x3ecdc5};};Object[a50_0x18f614(0x1d9)](exports,a50_0x18f614(0x23d),{'value':!![]}),exports[a50_0x18f614(0x242)]=exports[a50_0x18f614(0x142)]=void 0x0;const coinToPayService_1=require('./gateways/coinToPayService'),coinToPay2Service_1=require(a50_0x18f614(0x1b1)),gateway_1=require(a50_0x18f614(0x191)),database_1=__importDefault(require(a50_0x18f614(0x1cc))),telegramBotService_1=require(a50_0x18f614(0x144)),loggerService_1=require(a50_0x18f614(0x157)),currencyService_1=require(a50_0x18f614(0x224));class CoinToPayStatusService{constructor(){const _0x1bc579=a50_0x18f614;this[_0x1bc579(0x143)]=null,this[_0x1bc579(0x14a)]=0x3c*0x3c*0x3e8,this[_0x1bc579(0x220)]=0x5,this[_0x1bc579(0x149)]=new Map(),this[_0x1bc579(0x153)]=new coinToPayService_1[(_0x1bc579(0x21b))](),this['coinToPay2Service']=new coinToPay2Service_1[(_0x1bc579(0x1b4))](),console[_0x1bc579(0x164)]('ü™ô\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2');}['schedulePaymentChecks'](_0x16b98a,_0x3cdbf1){const _0x3b8745=a50_0x18f614;console[_0x3b8745(0x164)](_0x3b8745(0x160)),console[_0x3b8745(0x164)]('\x20\x20\x20-\x20paymentId:\x20'+_0x16b98a),console['log'](_0x3b8745(0x1c0)+_0x3cdbf1),this[_0x3b8745(0x17c)](_0x16b98a);const _0x43dd10=[],_0x5f5195=new Date(),_0x1a8006=[{'delay':0x1*0x3c*0x3e8,'description':_0x3b8745(0x1d3)},{'delay':0x2*0x3c*0x3e8,'description':_0x3b8745(0x1ab)},{'delay':0x5*0x3c*0x3e8,'description':'5\x20minutes'},{'delay':0x5*0x3c*0x3e8,'description':_0x3b8745(0x23e)}];console[_0x3b8745(0x164)]('ü™ô\x20[DEBUG]\x20Creating\x20'+_0x1a8006['length']+_0x3b8745(0x22f)+_0x16b98a);let _0x457fb3=0x0;_0x1a8006['forEach']((_0x47ffde,_0x1c4045)=>{const _0x403ec5=_0x3b8745;_0x457fb3+=_0x47ffde['delay'];const _0x1250f1=setTimeout(async()=>{const _0x1e6f32=a50_0x3607;console[_0x1e6f32(0x164)](_0x1e6f32(0x215)+(_0x1c4045+0x1)+_0x1e6f32(0x171)+_0x16b98a+_0x1e6f32(0x14b)+_0x47ffde[_0x1e6f32(0x24b)]+')');try{await this[_0x1e6f32(0x183)](_0x16b98a),console[_0x1e6f32(0x164)](_0x1e6f32(0x1ac)+(_0x1c4045+0x1)+'\x20completed\x20for\x20payment\x20'+_0x16b98a);}catch(_0x48c8e7){console[_0x1e6f32(0x1d2)](_0x1e6f32(0x1a2)+(_0x1c4045+0x1)+_0x1e6f32(0x18e)+_0x16b98a+':',_0x48c8e7),this['logCoinToPayError'](_0x16b98a,_0x3cdbf1,_0x48c8e7,'status_check',{'checkNumber':_0x1c4045+0x1,'scheduledAfter':_0x47ffde[_0x1e6f32(0x24b)],'isIndividualCheck':!![]});}},_0x457fb3);_0x43dd10[_0x403ec5(0x180)](_0x1250f1),console[_0x403ec5(0x164)]('‚è∞\x20[DEBUG]\x20Scheduled\x20check\x20#'+(_0x1c4045+0x1)+_0x403ec5(0x18e)+_0x16b98a+_0x403ec5(0x1c8)+_0x457fb3/0x3e8+_0x403ec5(0x233)+_0x47ffde[_0x403ec5(0x24b)]+')');});const _0x429784=setInterval(async()=>{const _0x285eb6=_0x3b8745;console['log'](_0x285eb6(0x1a4)+_0x16b98a);try{const _0x4aa77d=await database_1[_0x285eb6(0x243)][_0x285eb6(0x205)][_0x285eb6(0x1d7)]({'where':{'id':_0x16b98a},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x4aa77d){console['log'](_0x285eb6(0x1c6)+_0x16b98a+'\x20not\x20found,\x20clearing\x20timers'),this[_0x285eb6(0x17c)](_0x16b98a);return;}console[_0x285eb6(0x164)](_0x285eb6(0x22c)+_0x16b98a+_0x285eb6(0x177)+_0x4aa77d[_0x285eb6(0x162)]);if(_0x4aa77d['status']!==_0x285eb6(0x166)){console[_0x285eb6(0x164)]('‚úÖ\x20[HOURLY]\x20Payment\x20'+_0x16b98a+_0x285eb6(0x140)+_0x4aa77d[_0x285eb6(0x162)]+_0x285eb6(0x248)),this[_0x285eb6(0x17c)](_0x16b98a);return;}const _0x482848=Math[_0x285eb6(0x13f)]((Date['now']()-_0x4aa77d['createdAt'][_0x285eb6(0x1fd)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x482848>=this[_0x285eb6(0x220)]){console[_0x285eb6(0x164)](_0x285eb6(0x249)+_0x16b98a+_0x285eb6(0x239)+this[_0x285eb6(0x220)]+_0x285eb6(0x226)),this['clearPaymentTimers'](_0x16b98a);return;}await this['checkSinglePaymentById'](_0x16b98a),console[_0x285eb6(0x164)](_0x285eb6(0x210)+_0x16b98a);}catch(_0x5a0251){console['error'](_0x285eb6(0x234)+_0x16b98a+':',_0x5a0251),this[_0x285eb6(0x1c5)](_0x16b98a,_0x3cdbf1,_0x5a0251,_0x285eb6(0x172),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x43dd10['push'](_0x429784),this[_0x3b8745(0x149)][_0x3b8745(0x1b0)](_0x16b98a,{'timers':_0x43dd10,'paymentId':_0x16b98a,'gatewayPaymentId':_0x3cdbf1,'createdAt':_0x5f5195}),console['log'](_0x3b8745(0x1df)+_0x1a8006['length']+_0x3b8745(0x22b)+_0x16b98a),console[_0x3b8745(0x164)](_0x3b8745(0x15e)+this[_0x3b8745(0x149)][_0x3b8745(0x15f)]),this[_0x3b8745(0x24d)](_0x16b98a,_0x3cdbf1,_0x3b8745(0x166),'PENDING','status_check',{'action':'schedule_created','scheduledChecks':_0x1a8006[_0x3b8745(0x1b9)],'firstCheckIn':_0x1a8006[0x0][_0x3b8745(0x150)]/0x3e8,'totalTimers':this['paymentTimers'][_0x3b8745(0x15f)]});}[a50_0x18f614(0x17c)](_0x356306){const _0xd6d2ae=a50_0x18f614,_0x15133a=this[_0xd6d2ae(0x149)][_0xd6d2ae(0x184)](_0x356306);_0x15133a?(console[_0xd6d2ae(0x164)](_0xd6d2ae(0x207)+_0x15133a[_0xd6d2ae(0x19b)][_0xd6d2ae(0x1b9)]+'\x20timers\x20for\x20payment\x20'+_0x356306),_0x15133a['timers'][_0xd6d2ae(0x23a)]((_0x3e7591,_0x20812c)=>{const _0x1bd0f3=_0xd6d2ae;_0x3e7591&&(clearTimeout(_0x3e7591),clearInterval(_0x3e7591),console[_0x1bd0f3(0x164)](_0x1bd0f3(0x170)+(_0x20812c+0x1)+_0x1bd0f3(0x18e)+_0x356306));}),this[_0xd6d2ae(0x149)]['delete'](_0x356306),console[_0xd6d2ae(0x164)](_0xd6d2ae(0x145)+_0x356306+'.\x20Remaining\x20active\x20timers:\x20'+this[_0xd6d2ae(0x149)][_0xd6d2ae(0x15f)])):console[_0xd6d2ae(0x164)]('‚ö†Ô∏è\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20'+_0x356306+_0xd6d2ae(0x1ff));}async[a50_0x18f614(0x183)](_0x2960bd){const _0x2c9d57=a50_0x18f614;console['log']('üîç\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20'+_0x2960bd);const _0x43b2db=await database_1['default']['payment'][_0x2c9d57(0x1d7)]({'where':{'id':_0x2960bd},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x43b2db){console[_0x2c9d57(0x164)]('‚ùå\x20[CHECK]\x20Payment\x20'+_0x2960bd+_0x2c9d57(0x24a));return;}console[_0x2c9d57(0x164)]('üìä\x20[CHECK]\x20Payment\x20'+_0x2960bd+_0x2c9d57(0x1e3)),console[_0x2c9d57(0x164)](_0x2c9d57(0x247)+_0x43b2db['gateway']),console[_0x2c9d57(0x164)](_0x2c9d57(0x17f)+_0x43b2db[_0x2c9d57(0x162)]),console[_0x2c9d57(0x164)](_0x2c9d57(0x14f)+_0x43b2db[_0x2c9d57(0x1a1)]),console[_0x2c9d57(0x164)](_0x2c9d57(0x13c)+_0x43b2db['amount']+'\x20'+_0x43b2db[_0x2c9d57(0x1a9)]),console['log'](_0x2c9d57(0x174)+_0x43b2db[_0x2c9d57(0x1c1)]);if(_0x43b2db[_0x2c9d57(0x235)]!==_0x2c9d57(0x230)&&_0x43b2db[_0x2c9d57(0x235)]!==_0x2c9d57(0x20c)){console[_0x2c9d57(0x164)](_0x2c9d57(0x1a8)+_0x2960bd+_0x2c9d57(0x238)+_0x43b2db['gateway']+')');return;}if(_0x43b2db[_0x2c9d57(0x162)]!==_0x2c9d57(0x166)){console[_0x2c9d57(0x164)](_0x2c9d57(0x1a8)+_0x2960bd+_0x2c9d57(0x140)+_0x43b2db[_0x2c9d57(0x162)]+_0x2c9d57(0x248)),this[_0x2c9d57(0x17c)](_0x2960bd);return;}if(!_0x43b2db[_0x2c9d57(0x1a1)]){console['log'](_0x2c9d57(0x1a8)+_0x2960bd+_0x2c9d57(0x167));return;}console['log']('‚úÖ\x20[CHECK]\x20Payment\x20'+_0x2960bd+'\x20is\x20valid\x20for\x20checking,\x20proceeding...'),await this[_0x2c9d57(0x197)](_0x43b2db);}[a50_0x18f614(0x24d)](_0x133f5f,_0x36d2dd,_0x19c156,_0x5b9686,_0x8f1418,_0x49633d){const _0x2c9b97=a50_0x18f614,_0x47913b={'type':_0x2c9b97(0x1bd),'paymentId':_0x133f5f,'gatewayPaymentId':_0x36d2dd,'oldStatus':_0x19c156,'newStatus':_0x5b9686,'source':_0x8f1418,'timestamp':new Date()[_0x2c9b97(0x1ec)](),'details':_0x49633d||{}};loggerService_1['loggerService'][_0x2c9b97(0x24d)](_0x47913b),console[_0x2c9b97(0x164)](_0x2c9b97(0x20f)+_0x133f5f+'\x20('+_0x36d2dd+')'),console[_0x2c9b97(0x164)](_0x2c9b97(0x21f)+_0x19c156+_0x2c9b97(0x16d)+_0x5b9686),console[_0x2c9b97(0x164)](_0x2c9b97(0x1ae)+_0x8f1418),console[_0x2c9b97(0x164)](_0x2c9b97(0x1b6)+_0x47913b[_0x2c9b97(0x17a)]),_0x49633d&&console['log'](_0x2c9b97(0x1a3),_0x49633d);}[a50_0x18f614(0x1c5)](_0x5bb768,_0x138062,_0x387cba,_0x2675eb,_0x47adbb){const _0x3fdd86=a50_0x18f614,_0xf54538={'type':_0x3fdd86(0x1ed),'paymentId':_0x5bb768,'gatewayPaymentId':_0x138062,'error':_0x387cba instanceof Error?{'message':_0x387cba['message'],'stack':_0x387cba['stack']}:_0x387cba,'source':_0x2675eb,'timestamp':new Date()[_0x3fdd86(0x1ec)](),'context':_0x47adbb||{}};loggerService_1[_0x3fdd86(0x1b3)][_0x3fdd86(0x1c5)](_0xf54538),console[_0x3fdd86(0x1d2)](_0x3fdd86(0x1a5)+_0x5bb768+'\x20('+_0x138062+')'),console['error'](_0x3fdd86(0x217)+(_0x387cba instanceof Error?_0x387cba[_0x3fdd86(0x218)]:_0x387cba)),console['error'](_0x3fdd86(0x1ae)+_0x2675eb),console[_0x3fdd86(0x1d2)](_0x3fdd86(0x1b6)+_0xf54538[_0x3fdd86(0x17a)]),_0x47adbb&&console[_0x3fdd86(0x1d2)]('\x20\x20\x20üìù\x20Context:',_0x47adbb);}['startPeriodicStatusCheck'](){const _0x195524=a50_0x18f614;console['log']('ü™ô\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)'),this['checkAllPendingPayments']()[_0x195524(0x21a)](_0x484b9c=>{console['error']('‚ùå\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:',_0x484b9c);}),this['globalCheckInterval']=setInterval(async()=>{const _0x45c2ee=_0x195524;try{console[_0x45c2ee(0x164)](_0x45c2ee(0x1a7)),await this[_0x45c2ee(0x148)](),console[_0x45c2ee(0x164)]('‚úÖ\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed');}catch(_0x4e606d){console['error'](_0x45c2ee(0x245),_0x4e606d);}},this['GLOBAL_CHECK_INTERVAL_MS']),console[_0x195524(0x164)](_0x195524(0x1f8));}[a50_0x18f614(0x246)](){const _0x54004f=a50_0x18f614;console[_0x54004f(0x164)](_0x54004f(0x24c));this[_0x54004f(0x143)]&&(clearInterval(this[_0x54004f(0x143)]),this['globalCheckInterval']=null,console[_0x54004f(0x164)](_0x54004f(0x209)));const _0x54ee74=this[_0x54004f(0x149)][_0x54004f(0x15f)];for(const [_0x504a24]of this[_0x54004f(0x149)]){this[_0x54004f(0x17c)](_0x504a24);}console[_0x54004f(0x164)](_0x54004f(0x178)+_0x54ee74+'\x20individual\x20payment\x20timers');}async['checkAllPendingPayments'](){const _0x487a00=a50_0x18f614;try{console[_0x487a00(0x164)](_0x487a00(0x1f7));const _0x159597=await database_1[_0x487a00(0x243)]['payment'][_0x487a00(0x15b)]({'where':{'gateway':{'in':['cointopay',_0x487a00(0x20c)]},'status':_0x487a00(0x166),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console['log'](_0x487a00(0x1a6)+_0x159597['length']+_0x487a00(0x1bb));if(_0x159597[_0x487a00(0x1b9)]===0x0){console[_0x487a00(0x164)](_0x487a00(0x213));return;}const _0x4b5529=await this[_0x487a00(0x188)](_0x159597);console[_0x487a00(0x164)]('‚è∞\x20[GLOBAL]\x20Found\x20'+_0x4b5529[_0x487a00(0x1b9)]+_0x487a00(0x1aa));let _0x133da5=0x0,_0x201d9e=0x0;for(const _0x31601b of _0x159597){try{if(_0x4b5529[_0x487a00(0x208)](_0x31601b['id'])){console[_0x487a00(0x164)](_0x487a00(0x1ba)+_0x31601b['id']+_0x487a00(0x1c3)),_0x201d9e++;continue;}if(this[_0x487a00(0x149)][_0x487a00(0x1dc)](_0x31601b['id'])){console[_0x487a00(0x164)]('‚è∞\x20[GLOBAL]\x20Payment\x20'+_0x31601b['id']+_0x487a00(0x23b)),_0x201d9e++;continue;}const _0xa321c9=(Date['now']()-_0x31601b[_0x487a00(0x1fe)][_0x487a00(0x1fd)]())/(0x3e8*0x3c*0x3c);if(_0xa321c9<0x1){console[_0x487a00(0x164)](_0x487a00(0x1ba)+_0x31601b['id']+_0x487a00(0x19d)+_0xa321c9[_0x487a00(0x16b)](0x1)+_0x487a00(0x159)),_0x201d9e++;continue;}console[_0x487a00(0x164)](_0x487a00(0x1d6)+_0x31601b['id']+_0x487a00(0x244)+_0xa321c9[_0x487a00(0x16b)](0x1)+'h)'),await this[_0x487a00(0x197)](_0x31601b),_0x133da5++,await new Promise(_0x29adc3=>setTimeout(_0x29adc3,0x7d0));}catch(_0x5c42da){console[_0x487a00(0x1d2)](_0x487a00(0x16a)+_0x31601b['id']+':',_0x5c42da),this[_0x487a00(0x1c5)](_0x31601b['id'],_0x31601b[_0x487a00(0x1a1)]||'unknown',_0x5c42da,_0x487a00(0x172),{'isGlobalCheck':!![],'paymentAmount':_0x31601b[_0x487a00(0x211)],'paymentCurrency':_0x31601b[_0x487a00(0x1a9)],'shopId':_0x31601b[_0x487a00(0x1c1)],'createdAt':_0x31601b[_0x487a00(0x1fe)]}),loggerService_1[_0x487a00(0x1b3)][_0x487a00(0x240)]('cointopay',_0x487a00(0x14d)+_0x31601b[_0x487a00(0x1a1)],_0x5c42da);}}console[_0x487a00(0x164)]('‚úÖ\x20[GLOBAL]\x20Global\x20check\x20completed:\x20'+_0x133da5+_0x487a00(0x1f0)+_0x201d9e+_0x487a00(0x1f5)+_0x4b5529['length']+_0x487a00(0x214));}catch(_0xe6ba29){console[_0x487a00(0x1d2)](_0x487a00(0x151),_0xe6ba29);}}async[a50_0x18f614(0x188)](_0x387737){const _0x18abbe=a50_0x18f614,_0x5cf12b=[],_0x50dc0b=new Date();_0x50dc0b[_0x18abbe(0x190)](_0x50dc0b[_0x18abbe(0x1d4)]()-this[_0x18abbe(0x220)]),console[_0x18abbe(0x164)](_0x18abbe(0x173)+this[_0x18abbe(0x220)]+_0x18abbe(0x1c9)+_0x50dc0b[_0x18abbe(0x1ec)]()+')');for(const _0x4dc3c8 of _0x387737){if(_0x4dc3c8[_0x18abbe(0x1fe)]<_0x50dc0b){console['log'](_0x18abbe(0x163)+_0x4dc3c8['id']+_0x18abbe(0x239)+this[_0x18abbe(0x220)]+_0x18abbe(0x24e));try{this[_0x18abbe(0x24d)](_0x4dc3c8['id'],_0x4dc3c8[_0x18abbe(0x1a1)]||_0x18abbe(0x1ee),_0x18abbe(0x166),'EXPIRED','auto_expire',{'reason':_0x18abbe(0x1c7)+this[_0x18abbe(0x220)]+_0x18abbe(0x1d5),'createdAt':_0x4dc3c8['createdAt'],'daysSinceCreation':Math[_0x18abbe(0x13f)]((Date[_0x18abbe(0x175)]()-_0x4dc3c8[_0x18abbe(0x1fe)][_0x18abbe(0x1fd)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x4dc3c8[_0x18abbe(0x211)],'paymentCurrency':_0x4dc3c8[_0x18abbe(0x1a9)],'shopId':_0x4dc3c8[_0x18abbe(0x1c1)]}),await database_1[_0x18abbe(0x243)][_0x18abbe(0x205)][_0x18abbe(0x202)]({'where':{'id':_0x4dc3c8['id']},'data':{'status':_0x18abbe(0x1ca),'updatedAt':new Date()}}),await database_1[_0x18abbe(0x243)]['webhookLog'][_0x18abbe(0x20d)]({'data':{'paymentId':_0x4dc3c8['id'],'shopId':_0x4dc3c8[_0x18abbe(0x1c1)],'event':'cointopay_auto_expired','statusCode':0xc8,'responseBody':JSON[_0x18abbe(0x13b)]({'reason':_0x18abbe(0x1c7)+this[_0x18abbe(0x220)]+_0x18abbe(0x1d5),'createdAt':_0x4dc3c8[_0x18abbe(0x1fe)],'expiredAt':new Date()['toISOString'](),'daysSinceCreation':Math['floor']((Date[_0x18abbe(0x175)]()-_0x4dc3c8['createdAt'][_0x18abbe(0x1fd)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x18abbe(0x17b)](_0x4dc3c8,'EXPIRED'),await this[_0x18abbe(0x196)](_0x4dc3c8,_0x18abbe(0x1ca)),this[_0x18abbe(0x17c)](_0x4dc3c8['id']),_0x5cf12b[_0x18abbe(0x180)](_0x4dc3c8['id']),console[_0x18abbe(0x164)](_0x18abbe(0x1ea)+_0x4dc3c8['id']+_0x18abbe(0x201)+this['EXPIRY_DAYS']+_0x18abbe(0x1e2));}catch(_0x1cf9c5){console['error'](_0x18abbe(0x21d)+_0x4dc3c8['id']+':',_0x1cf9c5),this[_0x18abbe(0x1c5)](_0x4dc3c8['id'],_0x4dc3c8[_0x18abbe(0x1a1)]||_0x18abbe(0x1ee),_0x1cf9c5,_0x18abbe(0x1e9),{'reason':'Failed\x20to\x20mark\x20payment\x20as\x20expired','createdAt':_0x4dc3c8[_0x18abbe(0x1fe)],'daysSinceCreation':Math[_0x18abbe(0x13f)]((Date[_0x18abbe(0x175)]()-_0x4dc3c8['createdAt'][_0x18abbe(0x1fd)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x5cf12b;}async[a50_0x18f614(0x197)](_0x31fb71){const _0x227128=a50_0x18f614;if(!_0x31fb71[_0x227128(0x1a1)]){console['log'](_0x227128(0x1a8)+_0x31fb71['id']+_0x227128(0x189));return;}console[_0x227128(0x164)](_0x227128(0x156)+_0x31fb71[_0x227128(0x235)]+_0x227128(0x19e)+_0x31fb71['id']+'\x20('+_0x31fb71['gatewayPaymentId']+')');try{let _0x282378;_0x31fb71[_0x227128(0x235)]==='cointopay2'?(_0x282378=await this['coinToPay2Service'][_0x227128(0x18d)](_0x31fb71[_0x227128(0x1a1)]),console[_0x227128(0x164)](_0x227128(0x241)+_0x31fb71['id']+_0x227128(0x22e)+_0x282378[_0x227128(0x162)])):(_0x282378=await this['coinToPayService'][_0x227128(0x18d)](_0x31fb71[_0x227128(0x1a1)]),console[_0x227128(0x164)]('üìä\x20[CHECK]\x20CoinToPay\x20payment\x20'+_0x31fb71['id']+'\x20status:\x20'+_0x282378[_0x227128(0x162)]));_0x282378[_0x227128(0x1e7)]&&console[_0x227128(0x164)](_0x227128(0x19a)+_0x31fb71['id']+'\x20details:',{'iban':_0x282378[_0x227128(0x1e7)][_0x227128(0x223)]||_0x227128(0x15a),'transactionId':_0x282378[_0x227128(0x1e7)][_0x227128(0x168)],'createdOn':_0x282378['paymentDetails'][_0x227128(0x1db)],'confirmedOn':_0x282378[_0x227128(0x1e7)]['confirmedOn']||_0x227128(0x229)});if(_0x282378[_0x227128(0x162)]!==_0x31fb71['status']){console[_0x227128(0x164)](_0x227128(0x1e0)+_0x31fb71['id']+_0x227128(0x1e6)+_0x31fb71[_0x227128(0x162)]+'\x20to\x20'+_0x282378['status']),this[_0x227128(0x24d)](_0x31fb71['id'],_0x31fb71[_0x227128(0x1a1)],_0x31fb71[_0x227128(0x162)],_0x282378['status'],_0x227128(0x172),{'paymentDetails':_0x282378['paymentDetails'],'amount':_0x282378[_0x227128(0x211)],'currency':_0x282378[_0x227128(0x1a9)],'shopId':_0x31fb71[_0x227128(0x1c1)],'checkTimestamp':new Date()[_0x227128(0x1ec)]()});const _0x1cd3ec={'status':_0x282378['status'],'updatedAt':new Date()};if(_0x282378[_0x227128(0x162)]===_0x227128(0x195)&&_0x31fb71['status']!==_0x227128(0x195)){_0x1cd3ec[_0x227128(0x146)]=new Date();if(!_0x31fb71[_0x227128(0x199)]){const _0xe9f9e3=await currencyService_1['currencyService'][_0x227128(0x182)](_0x31fb71[_0x227128(0x211)],_0x31fb71[_0x227128(0x1a9)]);_0x1cd3ec[_0x227128(0x199)]=_0xe9f9e3;const _0x47a1bb=await this[_0x227128(0x16c)](_0x31fb71[_0x227128(0x1c1)],_0x31fb71[_0x227128(0x235)]),_0x53e2ff=_0xe9f9e3*(0x1-_0x47a1bb/0x64);_0x1cd3ec[_0x227128(0x193)]=_0x53e2ff,_0x1cd3ec[_0x227128(0x194)]=_0x47a1bb,console[_0x227128(0x164)](_0x227128(0x1bc)+_0x31fb71['id']+_0x227128(0x20a)),console['log'](_0x227128(0x1eb)+_0x31fb71[_0x227128(0x211)]+'\x20'+_0x31fb71['currency']+_0x227128(0x16d)+_0xe9f9e3[_0x227128(0x16b)](0x6)+'\x20USDT'),console[_0x227128(0x164)](_0x227128(0x154)+_0x31fb71[_0x227128(0x235)]+_0x227128(0x1bf)+_0x47a1bb+'%'),console[_0x227128(0x164)](_0x227128(0x185)+_0x53e2ff['toFixed'](0x6)+_0x227128(0x22d));}console[_0x227128(0x164)](_0x227128(0x1bc)+_0x31fb71['id']+_0x227128(0x1f3)+_0x1cd3ec[_0x227128(0x146)][_0x227128(0x1ec)]());}if(_0x282378[_0x227128(0x1e7)]){const _0xee2875=_0x282378['paymentDetails'];_0xee2875[_0x227128(0x223)]&&(_0x1cd3ec[_0x227128(0x15c)]=_0xee2875[_0x227128(0x223)],console[_0x227128(0x164)](_0x227128(0x23f)+_0xee2875[_0x227128(0x223)])),_0xee2875['bankDetails']&&console[_0x227128(0x164)](_0x227128(0x222)+_0xee2875[_0x227128(0x1af)]),_0xee2875['transactionId']&&console['log'](_0x227128(0x198)+_0xee2875[_0x227128(0x168)]),_0xee2875[_0x227128(0x21e)]&&console[_0x227128(0x164)]('‚úÖ\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20'+_0xee2875[_0x227128(0x21e)]);}await database_1[_0x227128(0x243)][_0x227128(0x205)][_0x227128(0x202)]({'where':{'id':_0x31fb71['id']},'data':_0x1cd3ec});if(_0x282378['status']==='PAID'&&_0x31fb71[_0x227128(0x162)]!=='PAID'){console[_0x227128(0x164)](_0x227128(0x203)+_0x31fb71['id']+_0x227128(0x1f9));const _0x1c94e6=await database_1[_0x227128(0x243)]['payment'][_0x227128(0x1d7)]({'where':{'id':_0x31fb71['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x1c94e6?.[_0x227128(0x1da)]&&_0x1c94e6[_0x227128(0x176)])try{const _0x6d3d9d=_0x1c94e6[_0x227128(0x176)];console[_0x227128(0x164)](_0x227128(0x1f1)+_0x6d3d9d['id']+_0x227128(0x1f6)+_0x6d3d9d['type']+_0x227128(0x228)+_0x6d3d9d['currentPayments']+',\x20status='+_0x6d3d9d['status']);const _0xe411f2=_0x6d3d9d[_0x227128(0x227)]+0x1,_0x2d154b=_0x6d3d9d['type']===_0x227128(0x1ce)?'COMPLETED':_0x6d3d9d[_0x227128(0x162)];await database_1[_0x227128(0x243)][_0x227128(0x176)][_0x227128(0x202)]({'where':{'id':_0x6d3d9d['id']},'data':{'currentPayments':_0xe411f2,'status':_0x2d154b,'updatedAt':new Date()}}),console[_0x227128(0x164)](_0x227128(0x1e4)+_0x6d3d9d['id']+_0x227128(0x1cb)+_0x6d3d9d[_0x227128(0x227)]+_0x227128(0x16d)+_0xe411f2+',\x20status='+_0x6d3d9d['status']+_0x227128(0x16d)+_0x2d154b);}catch(_0x128d47){console[_0x227128(0x1d2)](_0x227128(0x1e5),_0x128d47);}else console[_0x227128(0x164)](_0x227128(0x203)+_0x31fb71['id']+_0x227128(0x1b2));}await database_1[_0x227128(0x243)][_0x227128(0x158)][_0x227128(0x20d)]({'data':{'paymentId':_0x31fb71['id'],'shopId':_0x31fb71['shopId'],'event':'cointopay_status_check_'+_0x282378[_0x227128(0x162)]['toLowerCase'](),'statusCode':0xc8,'responseBody':JSON[_0x227128(0x13b)]({'oldStatus':_0x31fb71[_0x227128(0x162)],'newStatus':_0x282378[_0x227128(0x162)],'paymentDetails':_0x282378['paymentDetails'],'checkedAt':new Date()[_0x227128(0x1ec)]()})}}),await this[_0x227128(0x17b)](_0x31fb71,_0x282378[_0x227128(0x162)]),await this[_0x227128(0x196)](_0x31fb71,_0x282378[_0x227128(0x162)]),_0x282378[_0x227128(0x162)]!=='PENDING'&&(console[_0x227128(0x164)]('üßπ\x20[CHECK]\x20Payment\x20'+_0x31fb71['id']+'\x20status\x20changed\x20to\x20'+_0x282378[_0x227128(0x162)]+_0x227128(0x179)),this[_0x227128(0x17c)](_0x31fb71['id'])),console[_0x227128(0x164)](_0x227128(0x1cd)+_0x31fb71['id']+_0x227128(0x1c4));}else console[_0x227128(0x164)](_0x227128(0x19a)+_0x31fb71['id']+_0x227128(0x20b)+_0x282378['status']+')'),this[_0x227128(0x24d)](_0x31fb71['id'],_0x31fb71[_0x227128(0x1a1)],_0x31fb71[_0x227128(0x162)],_0x282378['status'],_0x227128(0x172),{'statusUnchanged':!![],'paymentDetails':_0x282378['paymentDetails'],'amount':_0x282378[_0x227128(0x211)],'currency':_0x282378[_0x227128(0x1a9)],'shopId':_0x31fb71[_0x227128(0x1c1)],'checkTimestamp':new Date()[_0x227128(0x1ec)]()});}catch(_0x251ad9){console['error'](_0x227128(0x18a)+_0x31fb71['id']+':',_0x251ad9),this['logCoinToPayError'](_0x31fb71['id'],_0x31fb71[_0x227128(0x1a1)],_0x251ad9,'status_check',{'paymentAmount':_0x31fb71[_0x227128(0x211)],'paymentCurrency':_0x31fb71[_0x227128(0x1a9)],'shopId':_0x31fb71[_0x227128(0x1c1)],'createdAt':_0x31fb71['createdAt']}),await database_1[_0x227128(0x243)][_0x227128(0x158)][_0x227128(0x20d)]({'data':{'paymentId':_0x31fb71['id'],'shopId':_0x31fb71['shopId'],'event':_0x227128(0x152),'statusCode':0x1f4,'responseBody':JSON['stringify']({'error':_0x251ad9 instanceof Error?_0x251ad9[_0x227128(0x218)]:_0x227128(0x1e8),'gatewayPaymentId':_0x31fb71['gatewayPaymentId'],'checkedAt':new Date()[_0x227128(0x1ec)]()})}});}}async[a50_0x18f614(0x17b)](_0x5e4bbd,_0x54cb20){const _0x143ef5=a50_0x18f614,_0x4bacab=Date[_0x143ef5(0x175)]();try{const _0x55b481=_0x5e4bbd[_0x143ef5(0x13d)],_0x2fb0bb=_0x55b481[_0x143ef5(0x161)];if(!_0x2fb0bb?.[_0x143ef5(0x216)]){console[_0x143ef5(0x164)](_0x143ef5(0x141)+_0x55b481['id']);return;}const _0x33bef7=_0x54cb20===_0x143ef5(0x195)?_0x143ef5(0x16e):_0x54cb20===_0x143ef5(0x204)?_0x143ef5(0x13e):_0x54cb20===_0x143ef5(0x1ca)?_0x143ef5(0x13e):_0x143ef5(0x236);if(!_0x2fb0bb[_0x143ef5(0x1ad)]?.[_0x143ef5(0x208)](_0x33bef7)){console[_0x143ef5(0x164)](_0x143ef5(0x1fc)+_0x33bef7+'\x20not\x20enabled\x20for\x20shop\x20'+_0x55b481['id']);return;}const _0x47be19=(0x0,gateway_1[_0x143ef5(0x1be)])(_0x5e4bbd[_0x143ef5(0x235)])||_0x5e4bbd[_0x143ef5(0x235)],_0xf50281={'event':_0x33bef7,'payment':{'id':_0x5e4bbd['id'],'order_id':_0x5e4bbd[_0x143ef5(0x232)],'gateway_order_id':_0x5e4bbd[_0x143ef5(0x1dd)],'gateway':_0x47be19,'amount':_0x5e4bbd[_0x143ef5(0x211)],'currency':_0x5e4bbd['currency'],'status':_0x54cb20[_0x143ef5(0x1b8)](),'customer_email':_0x5e4bbd[_0x143ef5(0x23c)],'customer_name':_0x5e4bbd[_0x143ef5(0x1a0)],'created_at':_0x5e4bbd[_0x143ef5(0x1fe)],'updated_at':new Date()}},_0x2170ea=await fetch(_0x2fb0bb[_0x143ef5(0x216)],{'method':'POST','headers':{'Content-Type':_0x143ef5(0x19c),'User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x143ef5(0x13b)](_0xf50281)}),_0x410b27=Date['now']()-_0x4bacab,_0x338fe3=_0x2170ea['ok']?_0x143ef5(0x165):await _0x2170ea[_0x143ef5(0x14e)]();loggerService_1[_0x143ef5(0x1b3)][_0x143ef5(0x1cf)](_0x5e4bbd[_0x143ef5(0x1c1)],_0x2fb0bb['webhookUrl'],_0x33bef7,_0x2170ea[_0x143ef5(0x162)],_0x410b27,_0xf50281),console[_0x143ef5(0x164)](_0x143ef5(0x1d8)+_0x2fb0bb[_0x143ef5(0x216)]+'\x20with\x20status\x20'+_0x2170ea['status']+'\x20('+_0x410b27+_0x143ef5(0x18f));}catch(_0x1f8785){console['error'](_0x143ef5(0x18c),_0x1f8785),loggerService_1[_0x143ef5(0x1b3)][_0x143ef5(0x15d)](_0x5e4bbd[_0x143ef5(0x1c1)],_0x5e4bbd[_0x143ef5(0x13d)]?.[_0x143ef5(0x161)]?.[_0x143ef5(0x216)]||'unknown',_0x143ef5(0x155),_0x1f8785,{});}}async['sendPaymentStatusNotification'](_0x380ad0,_0x572fb3){const _0x4e26d2=a50_0x18f614;try{const _0x54aee4={'PENDING':_0x4e26d2(0x1b5),'PAID':_0x4e26d2(0x1fa),'FAILED':_0x4e26d2(0x206),'EXPIRED':_0x4e26d2(0x22a)},_0x4cdee2=_0x54aee4[_0x572fb3];if(!_0x4cdee2||_0x4cdee2==='created')return;await telegramBotService_1[_0x4e26d2(0x147)][_0x4e26d2(0x192)](_0x380ad0[_0x4e26d2(0x1c1)],_0x380ad0,_0x4cdee2);}catch(_0x278e8a){console[_0x4e26d2(0x1d2)]('Failed\x20to\x20send\x20Telegram\x20payment\x20notification:',_0x278e8a);}}async[a50_0x18f614(0x1c2)](_0x56bc5e){const _0x40b4a2=a50_0x18f614;console[_0x40b4a2(0x164)](_0x40b4a2(0x1d1)+_0x56bc5e);const _0x418fba=await database_1[_0x40b4a2(0x243)]['payment'][_0x40b4a2(0x1d7)]({'where':{'id':_0x56bc5e},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x418fba)throw new Error('Payment\x20not\x20found');if(_0x418fba[_0x40b4a2(0x235)]!==_0x40b4a2(0x230)&&_0x418fba['gateway']!==_0x40b4a2(0x20c))throw new Error('Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment');console[_0x40b4a2(0x164)](_0x40b4a2(0x169)+_0x418fba[_0x40b4a2(0x235)]+_0x40b4a2(0x19e)+_0x56bc5e),await this[_0x40b4a2(0x197)](_0x418fba),console['log'](_0x40b4a2(0x18b)+_0x56bc5e);}['getServiceStats'](){const _0x58f0e6=a50_0x18f614,_0x19ac32=this[_0x58f0e6(0x143)]?this[_0x58f0e6(0x14a)]:undefined,_0x5a52ed=Array[_0x58f0e6(0x1b7)](this[_0x58f0e6(0x149)][_0x58f0e6(0x187)]())['map'](_0x53e95e=>({'paymentId':_0x53e95e['paymentId'],'gatewayPaymentId':_0x53e95e[_0x58f0e6(0x1a1)],'createdAt':_0x53e95e[_0x58f0e6(0x1fe)],'timersCount':_0x53e95e[_0x58f0e6(0x19b)][_0x58f0e6(0x1b9)]}));return{'isActive':!!this[_0x58f0e6(0x143)],'globalCheckIntervalMinutes':this[_0x58f0e6(0x14a)]/(0x3e8*0x3c),'expiryDays':this[_0x58f0e6(0x220)],'activeIndividualTimers':this[_0x58f0e6(0x149)]['size'],'nextGlobalCheckIn':_0x19ac32,'paymentTimersDetails':_0x5a52ed};}[a50_0x18f614(0x1f2)](_0x1cd971){const _0x4faf5a=a50_0x18f614,_0x418e19=this[_0x4faf5a(0x149)][_0x4faf5a(0x184)](_0x1cd971);if(_0x418e19)return{'hasTimers':!![],'timersCount':_0x418e19[_0x4faf5a(0x19b)][_0x4faf5a(0x1b9)],'createdAt':_0x418e19[_0x4faf5a(0x1fe)],'gatewayPaymentId':_0x418e19[_0x4faf5a(0x1a1)]};return{'hasTimers':![]};}async[a50_0x18f614(0x16c)](_0x1fc124,_0xb1493d){const _0x216613=a50_0x18f614;try{const _0x13236a=await database_1['default'][_0x216613(0x13d)][_0x216613(0x1d7)]({'where':{'id':_0x1fc124},'select':{'gatewaySettings':!![]}});if(!_0x13236a?.['gatewaySettings'])return console[_0x216613(0x164)](_0x216613(0x221)+_0x1fc124+_0x216613(0x200)),0xa;const _0x1c825a=JSON['parse'](_0x13236a[_0x216613(0x20e)]);for(const [_0x1c5374,_0x198dfb]of Object[_0x216613(0x21c)](_0x1c825a)){if(_0x1c5374[_0x216613(0x1b8)]()===_0xb1493d[_0x216613(0x1b8)]()){const _0x2d60ae=_0x198dfb[_0x216613(0x186)]||0xa;return console[_0x216613(0x164)](_0x216613(0x17e)+_0xb1493d+_0x216613(0x1de)+_0x1fc124+':\x20'+_0x2d60ae+'%'),_0x2d60ae;}}return console[_0x216613(0x164)](_0x216613(0x1e1)+_0xb1493d+_0x216613(0x219)+_0x1fc124+',\x20using\x20default\x2010%'),0xa;}catch(_0x3949e8){return console[_0x216613(0x1d2)](_0x216613(0x181)+_0x1fc124+_0x216613(0x14c)+_0xb1493d+':',_0x3949e8),0xa;}}}function a50_0x3607(_0xf6d70c,_0x1e1267){_0xf6d70c=_0xf6d70c-0x13b;const _0xdedf6d=a50_0xdedf();let _0x360752=_0xdedf6d[_0xf6d70c];return _0x360752;}exports[a50_0x18f614(0x142)]=CoinToPayStatusService,exports[a50_0x18f614(0x242)]=new CoinToPayStatusService();