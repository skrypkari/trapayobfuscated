'use strict';const a50_0x362882=a50_0x2be3;function a50_0x2be3(_0x52ca1d,_0x25ad85){_0x52ca1d=_0x52ca1d-0x157;const _0x15b270=a50_0x15b2();let _0x2be3d7=_0x15b270[_0x52ca1d];return _0x2be3d7;}(function(_0x298563,_0x1deeff){const _0x203ffe=a50_0x2be3,_0x2707bd=_0x298563();while(!![]){try{const _0x12c918=parseInt(_0x203ffe(0x238))/0x1+-parseInt(_0x203ffe(0x1cd))/0x2+-parseInt(_0x203ffe(0x1ef))/0x3+-parseInt(_0x203ffe(0x24d))/0x4*(-parseInt(_0x203ffe(0x218))/0x5)+-parseInt(_0x203ffe(0x220))/0x6+parseInt(_0x203ffe(0x1cc))/0x7+parseInt(_0x203ffe(0x164))/0x8;if(_0x12c918===_0x1deeff)break;else _0x2707bd['push'](_0x2707bd['shift']());}catch(_0x3274f2){_0x2707bd['push'](_0x2707bd['shift']());}}}(a50_0x15b2,0xbe5f5));var __importDefault=this&&this[a50_0x362882(0x1bf)]||function(_0x153455){const _0xd89f98=a50_0x362882;return _0x153455&&_0x153455[_0xd89f98(0x222)]?_0x153455:{'default':_0x153455};};Object[a50_0x362882(0x1e2)](exports,'__esModule',{'value':!![]}),exports[a50_0x362882(0x17d)]=exports[a50_0x362882(0x20f)]=void 0x0;const coinToPayService_1=require(a50_0x362882(0x1a9)),coinToPay2Service_1=require('./gateways/coinToPay2Service'),gateway_1=require('../types/gateway'),database_1=__importDefault(require(a50_0x362882(0x1e7))),telegramBotService_1=require(a50_0x362882(0x17c)),loggerService_1=require(a50_0x362882(0x1c6)),currencyService_1=require('./currencyService');function a50_0x15b2(){const _0x3a0105=['\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','296JncjXp','üßπ\x20[DEBUG]\x20Clearing\x20','PENDING','ü™ô\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','findMany','\x20individual\x20payment\x20timers','Shop\x20webhook\x20sent\x20to\x20','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','expired','cointopay','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','forEach','checkPaymentStatus','payment.pending','not\x20found','getGatewayCommission','getPaymentTimerInfo','Success','‚ùå\x20[TIMER]\x20Failed\x20individual\x20check\x20#','‚úÖ\x20[HOURLY]\x20Payment\x20','stringify','\x20\x20\x20üìù\x20Context:','status','ü™ô\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','ms)','update','Failed\x20to\x20mark\x20payment\x20as\x20expired','paymentTimers','\x20status:\x20','\x20status\x20is\x20','description','‚è∞\x20[GLOBAL]\x20Payment\x20','\x20timers\x20for\x20payment\x20','webhookEvents','\x20not\x20enabled\x20for\x20shop\x20','EXPIRY_DAYS','‚è∞\x20[GLOBAL]\x20Found\x20','values','checkAllPendingPayments','type','\x20is\x20valid\x20for\x20checking,\x20proceeding...','logShopWebhookSent','ü™ô\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','getGatewayIdByName','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','cointopay2','create','8760592BxEnTO','error','\x20days','h),\x20skipping\x20global\x20check','createdAt','\x20pending\x20CoinToPay\x20payments','remitterIban','log','webhookUrl','ü™ô\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','‚ùå\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','stopPeriodicStatusCheck','set',',\x20stopping\x20individual\x20checks','\x20status\x20changed\x20to\x20','PAID','\x20with\x20status\x20','\x20has\x20no\x20gatewayPaymentId,\x20skipping',',\x20using\x20default\x20commission\x2010%','schedule_created','\x20\x20\x20-\x20Gateway:\x20','\x20amounts\x20calculated:','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','\x20status\x20from\x20','./telegramBotService','coinToPayStatusService','\x20days\x20(created\x20before\x20','‚úÖ\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','setDate','startPeriodicStatusCheck','üÜî\x20[CHECK]\x20Transaction\x20ID:\x20','üõë\x20[SHUTDOWN]\x20Cleared\x20','webhook_send','2\x20minutes','‚ö†Ô∏è\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','\x20has\x20no\x20gatewayPaymentId','coinToPayService','convertToUSDT','currency','\x20\x20\x20üìä\x20Status:\x20','üìà\x20[COINTOPAY]\x20Payment\x20','‚ùå\x20[HOURLY]\x20Payment\x20','delay','telegramBotService','logCoinToPayStatus','\x20days,\x20marking\x20as\x20EXPIRED','commission','\x20\x20\x20-\x20Status:\x20',',\x20currentPayments=','findUnique','‚ùå\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:',',\x20gateway\x20','Payment\x20older\x20than\x20',',\x20clearing\x20individual\x20timers','\x20in\x20shop\x20','\x20completed\x20for\x20payment\x20','Gateway\x20','amountUSDT','payment.success','‚úÖ\x20[TIMER]\x20Individual\x20check\x20#','‚úÖ\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','toISOString','üßπ\x20[CHECK]\x20Payment\x20','now','‚ùå\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','COINTOPAY_STATUS_CHANGE','üí∞\x20[CHECK]\x20Payment\x20','cointopay_status_check_','\x20updated\x20successfully','./gateways/coinToPayService','has','\x20commission:\x20','floor','loggerService','size','logShopWebhookError','COMPLETED','ü™ô\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','FAILED','‚ùå\x20[CHECK]\x20Payment\x20','\x20\x20\x20-\x20ShopId:\x20','toFixed','failed','iban','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','amount','\x20to\x20clear','ü™ô\x20[DEBUG]\x20Creating\x20','payment.failed','sendShopWebhook','confirmedOn','__importDefault','payment','\x20expired','üîÑ\x20[CHECK]\x20Updating\x20payment\x20','\x20USDT','checkSinglePayment','\x20\x20\x20üìç\x20Source:\x20','./loggerService','‚úÖ\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','logCoinToPayError','paymentId','status_check','from','3305701RoBaNG','1963142ZbPYPd','üîç\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','\x20marked\x20as\x20paid\x20at:\x20','toLowerCase','‚è∞\x20[DEBUG]\x20Scheduled\x20check\x20#','\x20is\x20too\x20new\x20(','amountAfterGatewayCommissionUSDT','\x20updated:\x20currentPayments=','gatewaySettings','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','default','\x20for\x20payment\x20','üîç\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','currencyService',',\x20status=','üìà\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','sendPaymentNotification','üìä\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','\x20(age:\x20','No\x20specific\x20commission\x20found\x20for\x20gateway\x20','includes','defineProperty','message','\x20->\x20','get','\x20\x20\x20-\x20Amount:\x20','../config/database','1\x20minute','CoinToPayService','‚è∞\x20[EXPIRY]\x20Payment\x20','\x20\x20\x20üìù\x20Details:','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','bankDetails','\x20is\x20older\x20than\x20','3314646vmnWSV','gateway','gatewayOrderId','ü™ô\x20[TIMER]\x20Individual\x20check\x20#','sendPaymentStatusNotification','\x20initial\x20timers\x20for\x20payment\x20','timestamp','üßπ\x20[DEBUG]\x20Cleared\x20timer\x20#','ü™ô\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','5\x20minutes','\x20triggered\x20for\x20payment\x20','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','checkSinglePaymentById','\x20not\x20found\x20in\x20database','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','\x20status\x20unchanged\x20(','paymentLinkId','/status/','Webhook\x20event\x20','not\x20confirmed','auto_expire','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','orderId','Payment\x20System/1.0','‚ùå\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','coinToPay2Service','paymentDetails','\x20to\x20','\x20\x20\x20Amount:\x20','getTime','gatewayCommissionRate','currentPayments','CoinToPayStatusService','shopId','\x20\x20\x20-\x20gatewayPaymentId:\x20','EXPIRED','‚úÖ\x20[CHECK]\x20Payment\x20','\x20checked,\x20','üìä\x20[CHECK]\x20Payment\x20','webhookLog','Unknown\x20error','32815fQhjbl','‚ùå\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','\x20\x20\x20Gateway\x20','map','unknown','üîç\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','customerName','üìä\x20[CHECK]\x20CoinToPay2\x20payment\x20','1651908jenJgw','gatewayPaymentId','__esModule','Payment\x20not\x20found','‚úÖ\x20[DEBUG]\x20Successfully\x20scheduled\x20','paidAt','delete','push','\x20skipped,\x20','\x20in\x20','‚è∞\x20[HOURLY]\x20Payment\x20','clearPaymentTimers','stack','created','parse','ü™ô\x20[ERROR]\x20CoinToPay\x20Error:\x20','.\x20Remaining\x20active\x20timers:\x20','‚ö†Ô∏è\x20[CHECK]\x20Payment\x20','\x20payment\x20','‚úÖ\x20[COINTOPAY]\x20Payment\x20link\x20','settings','‚úÖ\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','GLOBAL_CHECK_INTERVAL_MS','\x20\x20\x20-\x20GatewayPaymentId:\x20','1088557cOBFIw','timers','checkExpiredPayments','entries','transactionId','text','\x20found:','shop','globalCheckInterval','\x20(after\x20','getDate','Failed\x20to\x20send\x20shop\x20webhook:','createdOn','POST','length','\x20expired\x20CoinToPay\x20payments','paymentLink','\x20\x20\x20-\x20paymentId:\x20','üõë\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','\x20\x20\x20üìÖ\x20Time:\x20'];a50_0x15b2=function(){return _0x3a0105;};return a50_0x15b2();}class CoinToPayStatusService{constructor(){const _0x5084e2=a50_0x362882;this[_0x5084e2(0x240)]=null,this['GLOBAL_CHECK_INTERVAL_MS']=0x3c*0x3c*0x3e8,this['EXPIRY_DAYS']=0x5,this[_0x5084e2(0x269)]=new Map(),this[_0x5084e2(0x188)]=new coinToPayService_1[(_0x5084e2(0x1e9))](),this[_0x5084e2(0x208)]=new coinToPay2Service_1['CoinToPay2Service'](),console[_0x5084e2(0x16b)](_0x5084e2(0x1b1));}['schedulePaymentChecks'](_0x3c02d2,_0x4ffc05){const _0x49706a=a50_0x362882;console[_0x49706a(0x16b)]('ü™ô\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:'),console[_0x49706a(0x16b)](_0x49706a(0x249)+_0x3c02d2),console[_0x49706a(0x16b)](_0x49706a(0x211)+_0x4ffc05),this[_0x49706a(0x22b)](_0x3c02d2);const _0x525653=[],_0xb5684a=new Date(),_0x4c56b0=[{'delay':0x1*0x3c*0x3e8,'description':_0x49706a(0x1e8)},{'delay':0x2*0x3c*0x3e8,'description':_0x49706a(0x185)},{'delay':0x5*0x3c*0x3e8,'description':_0x49706a(0x1f8)},{'delay':0x5*0x3c*0x3e8,'description':_0x49706a(0x1f8)}];console[_0x49706a(0x16b)](_0x49706a(0x1bb)+_0x4c56b0[_0x49706a(0x246)]+_0x49706a(0x1f4)+_0x3c02d2);let _0x114c06=0x0;_0x4c56b0[_0x49706a(0x259)]((_0x5b99ea,_0x1b6d79)=>{const _0x4146ab=_0x49706a;_0x114c06+=_0x5b99ea[_0x4146ab(0x18e)];const _0x2098d8=setTimeout(async()=>{const _0x2513cf=_0x4146ab;console[_0x2513cf(0x16b)](_0x2513cf(0x1f2)+(_0x1b6d79+0x1)+_0x2513cf(0x1f9)+_0x3c02d2+_0x2513cf(0x241)+_0x5b99ea[_0x2513cf(0x26c)]+')');try{await this[_0x2513cf(0x1fb)](_0x3c02d2),console['log'](_0x2513cf(0x19f)+(_0x1b6d79+0x1)+_0x2513cf(0x19b)+_0x3c02d2);}catch(_0x4b9799){console[_0x2513cf(0x165)](_0x2513cf(0x260)+(_0x1b6d79+0x1)+_0x2513cf(0x1d8)+_0x3c02d2+':',_0x4b9799),this[_0x2513cf(0x1c8)](_0x3c02d2,_0x4ffc05,_0x4b9799,_0x2513cf(0x1ca),{'checkNumber':_0x1b6d79+0x1,'scheduledAfter':_0x5b99ea[_0x2513cf(0x26c)],'isIndividualCheck':!![]});}},_0x114c06);_0x525653[_0x4146ab(0x227)](_0x2098d8),console['log'](_0x4146ab(0x1d1)+(_0x1b6d79+0x1)+_0x4146ab(0x1d8)+_0x3c02d2+_0x4146ab(0x229)+_0x114c06/0x3e8+'\x20seconds\x20('+_0x5b99ea[_0x4146ab(0x26c)]+')');});const _0x323b33=setInterval(async()=>{const _0x1a11bc=_0x49706a;console['log'](_0x1a11bc(0x265)+_0x3c02d2);try{const _0x4d9210=await database_1[_0x1a11bc(0x1d7)][_0x1a11bc(0x1c0)][_0x1a11bc(0x195)]({'where':{'id':_0x3c02d2},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x4d9210){console[_0x1a11bc(0x16b)](_0x1a11bc(0x18d)+_0x3c02d2+'\x20not\x20found,\x20clearing\x20timers'),this['clearPaymentTimers'](_0x3c02d2);return;}console[_0x1a11bc(0x16b)]('üìä\x20[HOURLY]\x20Payment\x20'+_0x3c02d2+'\x20current\x20status:\x20'+_0x4d9210[_0x1a11bc(0x264)]);if(_0x4d9210[_0x1a11bc(0x264)]!=='PENDING'){console[_0x1a11bc(0x16b)](_0x1a11bc(0x261)+_0x3c02d2+_0x1a11bc(0x26b)+_0x4d9210['status']+_0x1a11bc(0x171)),this[_0x1a11bc(0x22b)](_0x3c02d2);return;}const _0x32a143=Math['floor']((Date[_0x1a11bc(0x1a3)]()-_0x4d9210[_0x1a11bc(0x168)][_0x1a11bc(0x20c)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x32a143>=this[_0x1a11bc(0x158)]){console['log'](_0x1a11bc(0x22a)+_0x3c02d2+_0x1a11bc(0x1ee)+this[_0x1a11bc(0x158)]+'\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check'),this[_0x1a11bc(0x22b)](_0x3c02d2);return;}await this['checkSinglePaymentById'](_0x3c02d2),console[_0x1a11bc(0x16b)](_0x1a11bc(0x1a0)+_0x3c02d2);}catch(_0x137ef2){console['error'](_0x1a11bc(0x16e)+_0x3c02d2+':',_0x137ef2),this[_0x1a11bc(0x1c8)](_0x3c02d2,_0x4ffc05,_0x137ef2,_0x1a11bc(0x1ca),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x525653['push'](_0x323b33),this[_0x49706a(0x269)][_0x49706a(0x170)](_0x3c02d2,{'timers':_0x525653,'paymentId':_0x3c02d2,'gatewayPaymentId':_0x4ffc05,'createdAt':_0xb5684a}),console[_0x49706a(0x16b)](_0x49706a(0x224)+_0x4c56b0['length']+_0x49706a(0x161)+_0x3c02d2),console['log'](_0x49706a(0x1de)+this[_0x49706a(0x269)][_0x49706a(0x1ae)]),this[_0x49706a(0x190)](_0x3c02d2,_0x4ffc05,_0x49706a(0x24f),_0x49706a(0x24f),_0x49706a(0x1ca),{'action':_0x49706a(0x177),'scheduledChecks':_0x4c56b0['length'],'firstCheckIn':_0x4c56b0[0x0][_0x49706a(0x18e)]/0x3e8,'totalTimers':this[_0x49706a(0x269)][_0x49706a(0x1ae)]});}[a50_0x362882(0x22b)](_0xd8ab25){const _0xa299eb=a50_0x362882,_0x3c79fc=this[_0xa299eb(0x269)][_0xa299eb(0x1e5)](_0xd8ab25);_0x3c79fc?(console['log'](_0xa299eb(0x24e)+_0x3c79fc[_0xa299eb(0x239)]['length']+_0xa299eb(0x26e)+_0xd8ab25),_0x3c79fc[_0xa299eb(0x239)]['forEach']((_0xf1de02,_0x3e5379)=>{const _0x76f091=_0xa299eb;_0xf1de02&&(clearTimeout(_0xf1de02),clearInterval(_0xf1de02),console[_0x76f091(0x16b)](_0x76f091(0x1f6)+(_0x3e5379+0x1)+'\x20for\x20payment\x20'+_0xd8ab25));}),this[_0xa299eb(0x269)][_0xa299eb(0x226)](_0xd8ab25),console['log'](_0xa299eb(0x1c7)+_0xd8ab25+_0xa299eb(0x230)+this['paymentTimers'][_0xa299eb(0x1ae)])):console[_0xa299eb(0x16b)](_0xa299eb(0x186)+_0xd8ab25+_0xa299eb(0x1ba));}async['checkSinglePaymentById'](_0x2f29b7){const _0x2ee541=a50_0x362882;console['log'](_0x2ee541(0x21d)+_0x2f29b7);const _0x2cb3e4=await database_1[_0x2ee541(0x1d7)][_0x2ee541(0x1c0)]['findUnique']({'where':{'id':_0x2f29b7},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x2cb3e4){console[_0x2ee541(0x16b)](_0x2ee541(0x1b3)+_0x2f29b7+_0x2ee541(0x1fc));return;}console[_0x2ee541(0x16b)](_0x2ee541(0x215)+_0x2f29b7+_0x2ee541(0x23e)),console['log'](_0x2ee541(0x178)+_0x2cb3e4[_0x2ee541(0x1f0)]),console['log'](_0x2ee541(0x193)+_0x2cb3e4[_0x2ee541(0x264)]),console[_0x2ee541(0x16b)](_0x2ee541(0x237)+_0x2cb3e4['gatewayPaymentId']),console[_0x2ee541(0x16b)](_0x2ee541(0x1e6)+_0x2cb3e4[_0x2ee541(0x1b9)]+'\x20'+_0x2cb3e4['currency']),console[_0x2ee541(0x16b)](_0x2ee541(0x1b4)+_0x2cb3e4['shopId']);if(_0x2cb3e4[_0x2ee541(0x1f0)]!==_0x2ee541(0x257)&&_0x2cb3e4[_0x2ee541(0x1f0)]!==_0x2ee541(0x162)){console['log'](_0x2ee541(0x231)+_0x2f29b7+_0x2ee541(0x24c)+_0x2cb3e4[_0x2ee541(0x1f0)]+')');return;}if(_0x2cb3e4[_0x2ee541(0x264)]!==_0x2ee541(0x24f)){console[_0x2ee541(0x16b)]('‚ö†Ô∏è\x20[CHECK]\x20Payment\x20'+_0x2f29b7+_0x2ee541(0x26b)+_0x2cb3e4['status']+_0x2ee541(0x171)),this[_0x2ee541(0x22b)](_0x2f29b7);return;}if(!_0x2cb3e4[_0x2ee541(0x221)]){console['log'](_0x2ee541(0x231)+_0x2f29b7+_0x2ee541(0x187));return;}console[_0x2ee541(0x16b)](_0x2ee541(0x213)+_0x2f29b7+_0x2ee541(0x15d)),await this[_0x2ee541(0x1c4)](_0x2cb3e4);}[a50_0x362882(0x190)](_0x32dcd1,_0x3cfa0d,_0x379bbb,_0x1317c1,_0x1df570,_0x4061a2){const _0x336d40=a50_0x362882,_0x2d96af={'type':_0x336d40(0x1a5),'paymentId':_0x32dcd1,'gatewayPaymentId':_0x3cfa0d,'oldStatus':_0x379bbb,'newStatus':_0x1317c1,'source':_0x1df570,'timestamp':new Date()['toISOString'](),'details':_0x4061a2||{}};loggerService_1[_0x336d40(0x1ad)][_0x336d40(0x190)](_0x2d96af),console[_0x336d40(0x16b)](_0x336d40(0x250)+_0x32dcd1+'\x20('+_0x3cfa0d+')'),console[_0x336d40(0x16b)](_0x336d40(0x18b)+_0x379bbb+_0x336d40(0x1e4)+_0x1317c1),console[_0x336d40(0x16b)](_0x336d40(0x1c5)+_0x1df570),console[_0x336d40(0x16b)](_0x336d40(0x24b)+_0x2d96af[_0x336d40(0x1f5)]),_0x4061a2&&console[_0x336d40(0x16b)](_0x336d40(0x1eb),_0x4061a2);}[a50_0x362882(0x1c8)](_0x162651,_0x1b4e62,_0x4279b4,_0x2ff4a3,_0x60892f){const _0x1f8460=a50_0x362882,_0x4d0f36={'type':'COINTOPAY_ERROR','paymentId':_0x162651,'gatewayPaymentId':_0x1b4e62,'error':_0x4279b4 instanceof Error?{'message':_0x4279b4[_0x1f8460(0x1e3)],'stack':_0x4279b4[_0x1f8460(0x22c)]}:_0x4279b4,'source':_0x2ff4a3,'timestamp':new Date()[_0x1f8460(0x1a1)](),'context':_0x60892f||{}};loggerService_1[_0x1f8460(0x1ad)][_0x1f8460(0x1c8)](_0x4d0f36),console[_0x1f8460(0x165)](_0x1f8460(0x22f)+_0x162651+'\x20('+_0x1b4e62+')'),console[_0x1f8460(0x165)]('\x20\x20\x20‚ùå\x20Error:\x20'+(_0x4279b4 instanceof Error?_0x4279b4[_0x1f8460(0x1e3)]:_0x4279b4)),console[_0x1f8460(0x165)]('\x20\x20\x20üìç\x20Source:\x20'+_0x2ff4a3),console[_0x1f8460(0x165)]('\x20\x20\x20üìÖ\x20Time:\x20'+_0x4d0f36[_0x1f8460(0x1f5)]),_0x60892f&&console[_0x1f8460(0x165)](_0x1f8460(0x263),_0x60892f);}[a50_0x362882(0x181)](){const _0x3aae6c=a50_0x362882;console[_0x3aae6c(0x16b)](_0x3aae6c(0x1f7)),this[_0x3aae6c(0x15b)]()['catch'](_0x33607e=>{const _0x48a31f=_0x3aae6c;console[_0x48a31f(0x165)]('‚ùå\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:',_0x33607e);}),this[_0x3aae6c(0x240)]=setInterval(async()=>{const _0x4661a1=_0x3aae6c;try{console['log'](_0x4661a1(0x16d)),await this['checkAllPendingPayments'](),console['log']('‚úÖ\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed');}catch(_0x54ceec){console[_0x4661a1(0x165)](_0x4661a1(0x219),_0x54ceec);}},this['GLOBAL_CHECK_INTERVAL_MS']),console[_0x3aae6c(0x16b)]('‚úÖ\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)');}[a50_0x362882(0x16f)](){const _0x246430=a50_0x362882;console[_0x246430(0x16b)](_0x246430(0x24a));this[_0x246430(0x240)]&&(clearInterval(this[_0x246430(0x240)]),this[_0x246430(0x240)]=null,console[_0x246430(0x16b)]('üõë\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped'));const _0x35b6e1=this[_0x246430(0x269)][_0x246430(0x1ae)];for(const [_0x5f0c1c]of this['paymentTimers']){this[_0x246430(0x22b)](_0x5f0c1c);}console[_0x246430(0x16b)](_0x246430(0x183)+_0x35b6e1+_0x246430(0x253));}async[a50_0x362882(0x15b)](){const _0xf39ebd=a50_0x362882;try{console[_0xf39ebd(0x16b)]('ü™ô\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...');const _0x426ed3=await database_1[_0xf39ebd(0x1d7)][_0xf39ebd(0x1c0)][_0xf39ebd(0x252)]({'where':{'gateway':{'in':[_0xf39ebd(0x257),'cointopay2']},'status':_0xf39ebd(0x24f),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0xf39ebd(0x16b)]('ü™ô\x20[GLOBAL]\x20Found\x20'+_0x426ed3[_0xf39ebd(0x246)]+_0xf39ebd(0x169));if(_0x426ed3['length']===0x0){console['log'](_0xf39ebd(0x15f));return;}const _0xf80707=await this[_0xf39ebd(0x23a)](_0x426ed3);console[_0xf39ebd(0x16b)](_0xf39ebd(0x159)+_0xf80707[_0xf39ebd(0x246)]+_0xf39ebd(0x247));let _0x4dec08=0x0,_0x29dd40=0x0;for(const _0xbdf8f5 of _0x426ed3){try{if(_0xf80707[_0xf39ebd(0x1e1)](_0xbdf8f5['id'])){console[_0xf39ebd(0x16b)](_0xf39ebd(0x26d)+_0xbdf8f5['id']+'\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check'),_0x29dd40++;continue;}if(this['paymentTimers'][_0xf39ebd(0x1aa)](_0xbdf8f5['id'])){console[_0xf39ebd(0x16b)]('‚è∞\x20[GLOBAL]\x20Payment\x20'+_0xbdf8f5['id']+_0xf39ebd(0x204)),_0x29dd40++;continue;}const _0x2f10e0=(Date['now']()-_0xbdf8f5[_0xf39ebd(0x168)]['getTime']())/(0x3e8*0x3c*0x3c);if(_0x2f10e0<0x1){console['log']('‚è∞\x20[GLOBAL]\x20Payment\x20'+_0xbdf8f5['id']+_0xf39ebd(0x1d2)+_0x2f10e0[_0xf39ebd(0x1b5)](0x1)+_0xf39ebd(0x167)),_0x29dd40++;continue;}console[_0xf39ebd(0x16b)](_0xf39ebd(0x1d9)+_0xbdf8f5['id']+_0xf39ebd(0x1df)+_0x2f10e0[_0xf39ebd(0x1b5)](0x1)+'h)'),await this[_0xf39ebd(0x1c4)](_0xbdf8f5),_0x4dec08++,await new Promise(_0x4c09f7=>setTimeout(_0x4c09f7,0x7d0));}catch(_0x23b301){console[_0xf39ebd(0x165)](_0xf39ebd(0x1fd)+_0xbdf8f5['id']+':',_0x23b301),this[_0xf39ebd(0x1c8)](_0xbdf8f5['id'],_0xbdf8f5[_0xf39ebd(0x221)]||_0xf39ebd(0x21c),_0x23b301,'status_check',{'isGlobalCheck':!![],'paymentAmount':_0xbdf8f5[_0xf39ebd(0x1b9)],'paymentCurrency':_0xbdf8f5['currency'],'shopId':_0xbdf8f5['shopId'],'createdAt':_0xbdf8f5['createdAt']}),loggerService_1[_0xf39ebd(0x1ad)]['logWhiteDomainError'](_0xf39ebd(0x257),_0xf39ebd(0x200)+_0xbdf8f5[_0xf39ebd(0x221)],_0x23b301);}}console[_0xf39ebd(0x16b)](_0xf39ebd(0x258)+_0x4dec08+_0xf39ebd(0x214)+_0x29dd40+_0xf39ebd(0x228)+_0xf80707[_0xf39ebd(0x246)]+_0xf39ebd(0x1c1));}catch(_0x56c83f){console[_0xf39ebd(0x165)]('‚ùå\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:',_0x56c83f);}}async['checkExpiredPayments'](_0x3ebfc2){const _0x9fd210=a50_0x362882,_0x2c775b=[],_0x4d5d00=new Date();_0x4d5d00[_0x9fd210(0x180)](_0x4d5d00[_0x9fd210(0x242)]()-this[_0x9fd210(0x158)]),console[_0x9fd210(0x16b)]('‚è∞\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20'+this[_0x9fd210(0x158)]+_0x9fd210(0x17e)+_0x4d5d00[_0x9fd210(0x1a1)]()+')');for(const _0x313ccf of _0x3ebfc2){if(_0x313ccf['createdAt']<_0x4d5d00){console['log'](_0x9fd210(0x1ea)+_0x313ccf['id']+'\x20is\x20older\x20than\x20'+this[_0x9fd210(0x158)]+_0x9fd210(0x191));try{this['logCoinToPayStatus'](_0x313ccf['id'],_0x313ccf[_0x9fd210(0x221)]||_0x9fd210(0x21c),_0x9fd210(0x24f),_0x9fd210(0x212),_0x9fd210(0x203),{'reason':_0x9fd210(0x198)+this[_0x9fd210(0x158)]+_0x9fd210(0x166),'createdAt':_0x313ccf[_0x9fd210(0x168)],'daysSinceCreation':Math['floor']((Date[_0x9fd210(0x1a3)]()-_0x313ccf[_0x9fd210(0x168)]['getTime']())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x313ccf['amount'],'paymentCurrency':_0x313ccf[_0x9fd210(0x18a)],'shopId':_0x313ccf['shopId']}),await database_1[_0x9fd210(0x1d7)]['payment'][_0x9fd210(0x267)]({'where':{'id':_0x313ccf['id']},'data':{'status':'EXPIRED','updatedAt':new Date()}}),await database_1[_0x9fd210(0x1d7)][_0x9fd210(0x216)][_0x9fd210(0x163)]({'data':{'paymentId':_0x313ccf['id'],'shopId':_0x313ccf[_0x9fd210(0x210)],'event':'cointopay_auto_expired','statusCode':0xc8,'responseBody':JSON[_0x9fd210(0x262)]({'reason':_0x9fd210(0x198)+this['EXPIRY_DAYS']+'\x20days','createdAt':_0x313ccf['createdAt'],'expiredAt':new Date()[_0x9fd210(0x1a1)](),'daysSinceCreation':Math['floor']((Date[_0x9fd210(0x1a3)]()-_0x313ccf[_0x9fd210(0x168)][_0x9fd210(0x20c)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x9fd210(0x1bd)](_0x313ccf,_0x9fd210(0x212)),await this[_0x9fd210(0x1f3)](_0x313ccf,'EXPIRED'),this['clearPaymentTimers'](_0x313ccf['id']),_0x2c775b[_0x9fd210(0x227)](_0x313ccf['id']),console[_0x9fd210(0x16b)]('‚úÖ\x20[EXPIRY]\x20Payment\x20'+_0x313ccf['id']+'\x20marked\x20as\x20EXPIRED\x20due\x20to\x20'+this['EXPIRY_DAYS']+'-day\x20timeout');}catch(_0x2cb381){console[_0x9fd210(0x165)](_0x9fd210(0x1a4)+_0x313ccf['id']+':',_0x2cb381),this['logCoinToPayError'](_0x313ccf['id'],_0x313ccf[_0x9fd210(0x221)]||_0x9fd210(0x21c),_0x2cb381,_0x9fd210(0x203),{'reason':_0x9fd210(0x268),'createdAt':_0x313ccf['createdAt'],'daysSinceCreation':Math[_0x9fd210(0x1ac)]((Date[_0x9fd210(0x1a3)]()-_0x313ccf['createdAt'][_0x9fd210(0x20c)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x2c775b;}async[a50_0x362882(0x1c4)](_0x97320b){const _0x186320=a50_0x362882;if(!_0x97320b[_0x186320(0x221)]){console[_0x186320(0x16b)](_0x186320(0x231)+_0x97320b['id']+_0x186320(0x175));return;}console[_0x186320(0x16b)]('üîç\x20[CHECK]\x20Checking\x20'+_0x97320b[_0x186320(0x1f0)]+_0x186320(0x232)+_0x97320b['id']+'\x20('+_0x97320b[_0x186320(0x221)]+')');try{let _0x200782;_0x97320b['gateway']===_0x186320(0x162)?(_0x200782=await this[_0x186320(0x208)][_0x186320(0x25a)](_0x97320b[_0x186320(0x221)]),console['log'](_0x186320(0x21f)+_0x97320b['id']+_0x186320(0x26a)+_0x200782[_0x186320(0x264)])):(_0x200782=await this[_0x186320(0x188)][_0x186320(0x25a)](_0x97320b[_0x186320(0x221)]),console[_0x186320(0x16b)]('üìä\x20[CHECK]\x20CoinToPay\x20payment\x20'+_0x97320b['id']+'\x20status:\x20'+_0x200782['status']));_0x200782['paymentDetails']&&console[_0x186320(0x16b)](_0x186320(0x215)+_0x97320b['id']+'\x20details:',{'iban':_0x200782[_0x186320(0x209)][_0x186320(0x1b7)]||_0x186320(0x25c),'transactionId':_0x200782[_0x186320(0x209)][_0x186320(0x23c)],'createdOn':_0x200782[_0x186320(0x209)][_0x186320(0x244)],'confirmedOn':_0x200782[_0x186320(0x209)]['confirmedOn']||_0x186320(0x202)});if(_0x200782[_0x186320(0x264)]!==_0x97320b[_0x186320(0x264)]){console['log'](_0x186320(0x1c2)+_0x97320b['id']+_0x186320(0x17b)+_0x97320b['status']+_0x186320(0x20a)+_0x200782[_0x186320(0x264)]),this[_0x186320(0x190)](_0x97320b['id'],_0x97320b['gatewayPaymentId'],_0x97320b[_0x186320(0x264)],_0x200782[_0x186320(0x264)],_0x186320(0x1ca),{'paymentDetails':_0x200782[_0x186320(0x209)],'amount':_0x200782[_0x186320(0x1b9)],'currency':_0x200782['currency'],'shopId':_0x97320b['shopId'],'checkTimestamp':new Date()[_0x186320(0x1a1)]()});const _0x20061={'status':_0x200782[_0x186320(0x264)],'updatedAt':new Date()};if(_0x200782['status']===_0x186320(0x173)&&_0x97320b['status']!==_0x186320(0x173)){_0x20061[_0x186320(0x225)]=new Date();if(!_0x97320b[_0x186320(0x19d)]){const _0x1c4e97=await currencyService_1[_0x186320(0x1da)][_0x186320(0x189)](_0x97320b[_0x186320(0x1b9)],_0x97320b[_0x186320(0x18a)]);_0x20061['amountUSDT']=_0x1c4e97;const _0x3073e1=await this[_0x186320(0x25d)](_0x97320b[_0x186320(0x210)],_0x97320b[_0x186320(0x1f0)]),_0x10f925=_0x1c4e97*(0x1-_0x3073e1/0x64);_0x20061[_0x186320(0x1d3)]=_0x10f925,_0x20061[_0x186320(0x20d)]=_0x3073e1,console[_0x186320(0x16b)]('üí∞\x20[CHECK]\x20Payment\x20'+_0x97320b['id']+_0x186320(0x179)),console[_0x186320(0x16b)](_0x186320(0x20b)+_0x97320b[_0x186320(0x1b9)]+'\x20'+_0x97320b[_0x186320(0x18a)]+_0x186320(0x1e4)+_0x1c4e97[_0x186320(0x1b5)](0x6)+_0x186320(0x1c3)),console[_0x186320(0x16b)](_0x186320(0x21a)+_0x97320b[_0x186320(0x1f0)]+_0x186320(0x1ab)+_0x3073e1+'%'),console[_0x186320(0x16b)]('\x20\x20\x20Amount\x20after\x20commission:\x20'+_0x10f925[_0x186320(0x1b5)](0x6)+_0x186320(0x1c3));}console['log'](_0x186320(0x1a6)+_0x97320b['id']+_0x186320(0x1cf)+_0x20061[_0x186320(0x225)][_0x186320(0x1a1)]());}if(_0x200782['paymentDetails']){const _0x43ab1f=_0x200782['paymentDetails'];_0x43ab1f[_0x186320(0x1b7)]&&(_0x20061[_0x186320(0x16a)]=_0x43ab1f['iban'],console['log']('üè¶\x20[CHECK]\x20Saved\x20IBAN:\x20'+_0x43ab1f[_0x186320(0x1b7)])),_0x43ab1f[_0x186320(0x1ed)]&&console[_0x186320(0x16b)]('üè¶\x20[CHECK]\x20Bank\x20details\x20provided:\x20'+_0x43ab1f['bankDetails']),_0x43ab1f[_0x186320(0x23c)]&&console[_0x186320(0x16b)](_0x186320(0x182)+_0x43ab1f['transactionId']),_0x43ab1f[_0x186320(0x1be)]&&console['log']('‚úÖ\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20'+_0x43ab1f[_0x186320(0x1be)]);}await database_1[_0x186320(0x1d7)][_0x186320(0x1c0)][_0x186320(0x267)]({'where':{'id':_0x97320b['id']},'data':_0x20061});if(_0x200782['status']===_0x186320(0x173)&&_0x97320b['status']!==_0x186320(0x173)){console['log'](_0x186320(0x18c)+_0x97320b['id']+_0x186320(0x1fa));const _0x1aaa37=await database_1[_0x186320(0x1d7)][_0x186320(0x1c0)][_0x186320(0x195)]({'where':{'id':_0x97320b['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x1aaa37?.[_0x186320(0x1ff)]&&_0x1aaa37['paymentLink'])try{const _0x581c4b=_0x1aaa37[_0x186320(0x248)];console[_0x186320(0x16b)](_0x186320(0x1dc)+_0x581c4b['id']+':\x20type='+_0x581c4b[_0x186320(0x15c)]+_0x186320(0x194)+_0x581c4b['currentPayments']+',\x20status='+_0x581c4b[_0x186320(0x264)]);const _0x317ae8=_0x581c4b[_0x186320(0x20e)]+0x1,_0xae1fe4=_0x581c4b[_0x186320(0x15c)]==='SINGLE'?_0x186320(0x1b0):_0x581c4b[_0x186320(0x264)];await database_1['default']['paymentLink'][_0x186320(0x267)]({'where':{'id':_0x581c4b['id']},'data':{'currentPayments':_0x317ae8,'status':_0xae1fe4,'updatedAt':new Date()}}),console[_0x186320(0x16b)](_0x186320(0x233)+_0x581c4b['id']+_0x186320(0x1d4)+_0x581c4b[_0x186320(0x20e)]+_0x186320(0x1e4)+_0x317ae8+_0x186320(0x1db)+_0x581c4b[_0x186320(0x264)]+_0x186320(0x1e4)+_0xae1fe4);}catch(_0x2307dd){console[_0x186320(0x165)](_0x186320(0x196),_0x2307dd);}else console[_0x186320(0x16b)](_0x186320(0x18c)+_0x97320b['id']+_0x186320(0x17a));}await database_1[_0x186320(0x1d7)][_0x186320(0x216)]['create']({'data':{'paymentId':_0x97320b['id'],'shopId':_0x97320b[_0x186320(0x210)],'event':_0x186320(0x1a7)+_0x200782[_0x186320(0x264)][_0x186320(0x1d0)](),'statusCode':0xc8,'responseBody':JSON[_0x186320(0x262)]({'oldStatus':_0x97320b[_0x186320(0x264)],'newStatus':_0x200782['status'],'paymentDetails':_0x200782[_0x186320(0x209)],'checkedAt':new Date()['toISOString']()})}}),await this[_0x186320(0x1bd)](_0x97320b,_0x200782['status']),await this[_0x186320(0x1f3)](_0x97320b,_0x200782['status']),_0x200782[_0x186320(0x264)]!=='PENDING'&&(console[_0x186320(0x16b)](_0x186320(0x1a2)+_0x97320b['id']+_0x186320(0x172)+_0x200782[_0x186320(0x264)]+_0x186320(0x199)),this[_0x186320(0x22b)](_0x97320b['id'])),console[_0x186320(0x16b)](_0x186320(0x213)+_0x97320b['id']+_0x186320(0x1a8));}else console[_0x186320(0x16b)]('üìä\x20[CHECK]\x20Payment\x20'+_0x97320b['id']+_0x186320(0x1fe)+_0x200782['status']+')'),this[_0x186320(0x190)](_0x97320b['id'],_0x97320b[_0x186320(0x221)],_0x97320b['status'],_0x200782[_0x186320(0x264)],_0x186320(0x1ca),{'statusUnchanged':!![],'paymentDetails':_0x200782[_0x186320(0x209)],'amount':_0x200782[_0x186320(0x1b9)],'currency':_0x200782[_0x186320(0x18a)],'shopId':_0x97320b[_0x186320(0x210)],'checkTimestamp':new Date()[_0x186320(0x1a1)]()});}catch(_0x103dfb){console['error'](_0x186320(0x207)+_0x97320b['id']+':',_0x103dfb),this['logCoinToPayError'](_0x97320b['id'],_0x97320b[_0x186320(0x221)],_0x103dfb,_0x186320(0x1ca),{'paymentAmount':_0x97320b[_0x186320(0x1b9)],'paymentCurrency':_0x97320b[_0x186320(0x18a)],'shopId':_0x97320b[_0x186320(0x210)],'createdAt':_0x97320b['createdAt']}),await database_1['default'][_0x186320(0x216)][_0x186320(0x163)]({'data':{'paymentId':_0x97320b['id'],'shopId':_0x97320b[_0x186320(0x210)],'event':'cointopay_status_check_error','statusCode':0x1f4,'responseBody':JSON[_0x186320(0x262)]({'error':_0x103dfb instanceof Error?_0x103dfb[_0x186320(0x1e3)]:_0x186320(0x217),'gatewayPaymentId':_0x97320b[_0x186320(0x221)],'checkedAt':new Date()[_0x186320(0x1a1)]()})}});}}async['sendShopWebhook'](_0x302ab8,_0x3e02bf){const _0x18968d=a50_0x362882,_0xb27612=Date[_0x18968d(0x1a3)]();try{const _0x2a4c4f=_0x302ab8[_0x18968d(0x23f)],_0xeb9c14=_0x2a4c4f['settings'];if(!_0xeb9c14?.[_0x18968d(0x16c)]){console[_0x18968d(0x16b)](_0x18968d(0x255)+_0x2a4c4f['id']);return;}const _0x58833d=_0x3e02bf==='PAID'?_0x18968d(0x19e):_0x3e02bf===_0x18968d(0x1b2)?'payment.failed':_0x3e02bf===_0x18968d(0x212)?_0x18968d(0x1bc):_0x18968d(0x25b);if(!_0xeb9c14[_0x18968d(0x26f)]?.[_0x18968d(0x1e1)](_0x58833d)){console['log'](_0x18968d(0x201)+_0x58833d+_0x18968d(0x157)+_0x2a4c4f['id']);return;}const _0xc10fde=(0x0,gateway_1[_0x18968d(0x160)])(_0x302ab8[_0x18968d(0x1f0)])||_0x302ab8[_0x18968d(0x1f0)],_0x50d614={'event':_0x58833d,'payment':{'id':_0x302ab8['id'],'order_id':_0x302ab8[_0x18968d(0x205)],'gateway_order_id':_0x302ab8[_0x18968d(0x1f1)],'gateway':_0xc10fde,'amount':_0x302ab8[_0x18968d(0x1b9)],'currency':_0x302ab8[_0x18968d(0x18a)],'status':_0x3e02bf[_0x18968d(0x1d0)](),'customer_email':_0x302ab8['customerEmail'],'customer_name':_0x302ab8[_0x18968d(0x21e)],'created_at':_0x302ab8['createdAt'],'updated_at':new Date()}},_0x2f9c97=await fetch(_0xeb9c14[_0x18968d(0x16c)],{'method':_0x18968d(0x245),'headers':{'Content-Type':'application/json','User-Agent':_0x18968d(0x206)},'body':JSON['stringify'](_0x50d614)}),_0x367044=Date[_0x18968d(0x1a3)]()-_0xb27612,_0x4fbfe7=_0x2f9c97['ok']?_0x18968d(0x25f):await _0x2f9c97[_0x18968d(0x23d)]();loggerService_1[_0x18968d(0x1ad)][_0x18968d(0x15e)](_0x302ab8[_0x18968d(0x210)],_0xeb9c14['webhookUrl'],_0x58833d,_0x2f9c97[_0x18968d(0x264)],_0x367044,_0x50d614),console['log'](_0x18968d(0x254)+_0xeb9c14[_0x18968d(0x16c)]+_0x18968d(0x174)+_0x2f9c97[_0x18968d(0x264)]+'\x20('+_0x367044+_0x18968d(0x266));}catch(_0x48f73a){console[_0x18968d(0x165)](_0x18968d(0x243),_0x48f73a),loggerService_1[_0x18968d(0x1ad)][_0x18968d(0x1af)](_0x302ab8[_0x18968d(0x210)],_0x302ab8[_0x18968d(0x23f)]?.[_0x18968d(0x234)]?.['webhookUrl']||_0x18968d(0x21c),_0x18968d(0x184),_0x48f73a,{});}}async[a50_0x362882(0x1f3)](_0x40922e,_0xdf70a5){const _0x2b72a2=a50_0x362882;try{const _0x1aa382={'PENDING':_0x2b72a2(0x22d),'PAID':'paid','FAILED':_0x2b72a2(0x1b6),'EXPIRED':_0x2b72a2(0x256)},_0x5ef5b2=_0x1aa382[_0xdf70a5];if(!_0x5ef5b2||_0x5ef5b2==='created')return;await telegramBotService_1[_0x2b72a2(0x18f)][_0x2b72a2(0x1dd)](_0x40922e[_0x2b72a2(0x210)],_0x40922e,_0x5ef5b2);}catch(_0x3266bc){console[_0x2b72a2(0x165)](_0x2b72a2(0x1b8),_0x3266bc);}}async['checkPaymentById'](_0x186661){const _0x19b805=a50_0x362882;console[_0x19b805(0x16b)](_0x19b805(0x1ce)+_0x186661);const _0x4c752a=await database_1[_0x19b805(0x1d7)][_0x19b805(0x1c0)][_0x19b805(0x195)]({'where':{'id':_0x186661},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x4c752a)throw new Error(_0x19b805(0x223));if(_0x4c752a[_0x19b805(0x1f0)]!==_0x19b805(0x257)&&_0x4c752a[_0x19b805(0x1f0)]!=='cointopay2')throw new Error(_0x19b805(0x1d6));console[_0x19b805(0x16b)](_0x19b805(0x17f)+_0x4c752a[_0x19b805(0x1f0)]+_0x19b805(0x232)+_0x186661),await this[_0x19b805(0x1c4)](_0x4c752a),console[_0x19b805(0x16b)](_0x19b805(0x235)+_0x186661);}['getServiceStats'](){const _0x3461c9=a50_0x362882,_0x28583f=this[_0x3461c9(0x240)]?this[_0x3461c9(0x236)]:undefined,_0x447ecf=Array[_0x3461c9(0x1cb)](this[_0x3461c9(0x269)][_0x3461c9(0x15a)]())[_0x3461c9(0x21b)](_0x73c0d=>({'paymentId':_0x73c0d[_0x3461c9(0x1c9)],'gatewayPaymentId':_0x73c0d['gatewayPaymentId'],'createdAt':_0x73c0d[_0x3461c9(0x168)],'timersCount':_0x73c0d[_0x3461c9(0x239)][_0x3461c9(0x246)]}));return{'isActive':!!this[_0x3461c9(0x240)],'globalCheckIntervalMinutes':this[_0x3461c9(0x236)]/(0x3e8*0x3c),'expiryDays':this['EXPIRY_DAYS'],'activeIndividualTimers':this['paymentTimers']['size'],'nextGlobalCheckIn':_0x28583f,'paymentTimersDetails':_0x447ecf};}[a50_0x362882(0x25e)](_0x5e5533){const _0x167d35=a50_0x362882,_0x19264d=this[_0x167d35(0x269)]['get'](_0x5e5533);if(_0x19264d)return{'hasTimers':!![],'timersCount':_0x19264d[_0x167d35(0x239)][_0x167d35(0x246)],'createdAt':_0x19264d[_0x167d35(0x168)],'gatewayPaymentId':_0x19264d[_0x167d35(0x221)]};return{'hasTimers':![]};}async['getGatewayCommission'](_0x58bf80,_0x3f02ae){const _0x3c8c38=a50_0x362882;try{const _0x5cde99=await database_1[_0x3c8c38(0x1d7)]['shop']['findUnique']({'where':{'id':_0x58bf80},'select':{'gatewaySettings':!![]}});if(!_0x5cde99?.['gatewaySettings'])return console['log'](_0x3c8c38(0x251)+_0x58bf80+_0x3c8c38(0x176)),0xa;const _0x4dbd2f=JSON[_0x3c8c38(0x22e)](_0x5cde99[_0x3c8c38(0x1d5)]);for(const [_0xfb3bac,_0x29a1f0]of Object[_0x3c8c38(0x23b)](_0x4dbd2f)){if(_0xfb3bac['toLowerCase']()===_0x3f02ae[_0x3c8c38(0x1d0)]()){const _0x3d3d69=_0x29a1f0[_0x3c8c38(0x192)]||0xa;return console[_0x3c8c38(0x16b)](_0x3c8c38(0x19c)+_0x3f02ae+'\x20commission\x20for\x20shop\x20'+_0x58bf80+':\x20'+_0x3d3d69+'%'),_0x3d3d69;}}return console[_0x3c8c38(0x16b)](_0x3c8c38(0x1e0)+_0x3f02ae+_0x3c8c38(0x19a)+_0x58bf80+',\x20using\x20default\x2010%'),0xa;}catch(_0x52f490){return console[_0x3c8c38(0x165)](_0x3c8c38(0x1ec)+_0x58bf80+_0x3c8c38(0x197)+_0x3f02ae+':',_0x52f490),0xa;}}}exports[a50_0x362882(0x20f)]=CoinToPayStatusService,exports['coinToPayStatusService']=new CoinToPayStatusService();