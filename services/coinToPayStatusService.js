'use strict';function a48_0xa960(_0x32be23,_0x12fcdf){_0x32be23=_0x32be23-0xcf;const _0x44ace6=a48_0x44ac();let _0xa960d1=_0x44ace6[_0x32be23];return _0xa960d1;}const a48_0x37ed61=a48_0xa960;(function(_0x5ba5a9,_0x221e93){const _0x16f75b=a48_0xa960,_0x36e744=_0x5ba5a9();while(!![]){try{const _0x1ef086=-parseInt(_0x16f75b(0x107))/0x1+-parseInt(_0x16f75b(0x1ba))/0x2+-parseInt(_0x16f75b(0x12e))/0x3*(-parseInt(_0x16f75b(0x14c))/0x4)+-parseInt(_0x16f75b(0xfa))/0x5*(parseInt(_0x16f75b(0x16b))/0x6)+-parseInt(_0x16f75b(0x141))/0x7+parseInt(_0x16f75b(0x142))/0x8+parseInt(_0x16f75b(0xec))/0x9;if(_0x1ef086===_0x221e93)break;else _0x36e744['push'](_0x36e744['shift']());}catch(_0x15e634){_0x36e744['push'](_0x36e744['shift']());}}}(a48_0x44ac,0xaf1e4));var __importDefault=this&&this[a48_0x37ed61(0xd4)]||function(_0x29c81c){return _0x29c81c&&_0x29c81c['__esModule']?_0x29c81c:{'default':_0x29c81c};};Object['defineProperty'](exports,a48_0x37ed61(0x12a),{'value':!![]}),exports['coinToPayStatusService']=exports[a48_0x37ed61(0x1a7)]=void 0x0;function a48_0x44ac(){const _0x3ac7a3=['‚úÖ\x20[TIMER]\x20Individual\x20check\x20#','COINTOPAY_ERROR',':\x20type=','6dfSlZQ','Gateway\x20','../types/gateway','cointopay','checkAllPendingPayments','ü™ô\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','getGatewayCommission','auto_expire','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','Payment\x20older\x20than\x20','toFixed','confirmedOn','üîç\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','getTime','\x20status\x20unchanged\x20(','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','ü™ô\x20[ERROR]\x20CoinToPay\x20Error:\x20','coinToPay2Service','‚è∞\x20[GLOBAL]\x20Found\x20','8276723rKdUju','1604080pvpXLj','gatewayPaymentId','üìä\x20[CHECK]\x20CoinToPay\x20payment\x20','\x20amounts\x20calculated:','\x20\x20\x20Gateway\x20','1\x20minute',',\x20stopping\x20individual\x20checks','‚úÖ\x20[EXPIRY]\x20Payment\x20','‚ùå\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','values','13504zDaGXS','timestamp','Webhook\x20event\x20','amount','\x20expired\x20CoinToPay\x20payments','‚ö†Ô∏è\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','\x20triggered\x20for\x20payment\x20','map','update','\x20(age:\x20','\x20skipped,\x20','\x20completed\x20for\x20payment\x20','coinToPayStatusService','status_check','\x20commission:\x20','paymentLinkId','üîç\x20[CHECK]\x20Checking\x20','\x20(after\x20','payment','payment.pending','COMPLETED','\x20for\x20payment\x20','h),\x20skipping\x20global\x20check','transactionId','customerName','\x20\x20\x20üìù\x20Context:','webhookLog','checkPaymentStatus','\x20\x20\x20-\x20paymentId:\x20','delete','\x20\x20\x20‚ùå\x20Error:\x20','7304370aEFVPC','checkExpiredPayments','paymentDetails','timers','coinToPayService','set','‚ö†Ô∏è\x20[CHECK]\x20Payment\x20','sendPaymentStatusNotification','üìà\x20[COINTOPAY]\x20Payment\x20','üìä\x20[CHECK]\x20CoinToPay2\x20payment\x20','\x20initial\x20timers\x20for\x20payment\x20','\x20days','sendShopWebhook','‚è∞\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','‚úÖ\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','Unknown\x20error','floor','\x20\x20\x20Amount:\x20','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','Shop\x20webhook\x20sent\x20to\x20','üí∞\x20[CHECK]\x20Payment\x20','üõë\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','type','‚ùå\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','\x20->\x20','sendPaymentNotification','paymentLink','globalCheckInterval','\x20is\x20too\x20new\x20(','delay','GLOBAL_CHECK_INTERVAL_MS','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','.\x20Remaining\x20active\x20timers:\x20','log','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','\x20is\x20older\x20than\x20','\x20to\x20','logShopWebhookSent','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','Success',',\x20using\x20default\x20commission\x2010%','createdAt','\x20checked,\x20','convertToUSDT','stack','ü™ô\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','‚ùå\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','\x20updated\x20successfully','toLowerCase','/status/','./loggerService','\x20\x20\x20-\x20Amount:\x20','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','size','message','remitterIban','paymentTimers','paidAt','‚úÖ\x20[COINTOPAY]\x20Payment\x20link\x20','checkPaymentById','CoinToPayStatusService','\x20current\x20status:\x20','‚ùå\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','toISOString','catch','schedulePaymentChecks','logCoinToPayError','create','üè¶\x20[CHECK]\x20Bank\x20details\x20provided:\x20','webhookUrl','push','\x20USDT','gatewayCommissionRate','\x20status\x20changed\x20to\x20','\x20expired','\x20status:\x20','üîÑ\x20[CHECK]\x20Updating\x20payment\x20','webhook_send','üßπ\x20[CHECK]\x20Payment\x20','2331592qElcPL','payment.failed','\x20to\x20clear','\x20\x20\x20üìä\x20Status:\x20','\x20timers\x20for\x20payment\x20','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','‚ùå\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','üìä\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','length','üÜî\x20[CHECK]\x20Transaction\x20ID:\x20','paymentId','üõë\x20[SHUTDOWN]\x20Cleared\x20','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','status','gatewayOrderId','‚úÖ\x20[CHECK]\x20Payment\x20','expired',',\x20gateway\x20','gateway','‚úÖ\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','Failed\x20to\x20mark\x20payment\x20as\x20expired','clearPaymentTimers','currency','2\x20minutes','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','checkSinglePayment','now','üìä\x20[CHECK]\x20Payment\x20','-day\x20timeout','ü™ô\x20[GLOBAL]\x20Found\x20','‚è∞\x20[EXPIRY]\x20Payment\x20','loggerService','customerEmail','has','\x20\x20\x20üìç\x20Source:\x20','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','CoinToPay2Service','\x20individual\x20payment\x20timers','default','\x20status\x20is\x20','EXPIRED','paid','\x20\x20\x20-\x20Status:\x20','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','\x20marked\x20as\x20paid\x20at:\x20','application/json','description','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','error','setDate','stringify','__importDefault','SINGLE','\x20not\x20enabled\x20for\x20shop\x20','shopId','from','‚ùå\x20[TIMER]\x20Failed\x20individual\x20check\x20#','‚úÖ\x20[DEBUG]\x20Successfully\x20scheduled\x20','./gateways/coinToPay2Service','\x20status\x20from\x20','entries','\x20\x20\x20üìù\x20Details:','Payment\x20not\x20found','\x20\x20\x20-\x20gatewayPaymentId:\x20',',\x20using\x20default\x2010%','payment.success','üè¶\x20[CHECK]\x20Saved\x20IBAN:\x20','stopPeriodicStatusCheck','created','EXPIRY_DAYS','PAID','\x20not\x20found,\x20clearing\x20timers','\x20updated:\x20currentPayments=','COINTOPAY_STATUS_CHANGE','üßπ\x20[DEBUG]\x20Cleared\x20timer\x20#','37856196PPzbJK','\x20has\x20no\x20gatewayPaymentId,\x20skipping','logCoinToPayStatus','createdOn','PENDING','iban','\x20payment\x20','ü™ô\x20[TIMER]\x20Individual\x20check\x20#','./currencyService','telegramBotService',',\x20currentPayments=','getDate','\x20\x20\x20-\x20Gateway:\x20','üìà\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','5cwrHfs','currentPayments','failed','‚úÖ\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','./telegramBotService','Failed\x20to\x20send\x20shop\x20webhook:','amountAfterGatewayCommissionUSDT','checkSinglePaymentById','../config/database','Payment\x20System/1.0','ü™ô\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','getGatewayIdByName','cointopay_auto_expired','130642pIvntl','forEach','webhookEvents','No\x20specific\x20commission\x20found\x20for\x20gateway\x20','\x20\x20\x20üìÖ\x20Time:\x20','POST','‚ùå\x20[HOURLY]\x20Payment\x20','amountUSDT','ms)','unknown','shop',',\x20status=',',\x20clearing\x20individual\x20timers','logShopWebhookError','getPaymentTimerInfo','parse','\x20details:','ü™ô\x20[DEBUG]\x20Creating\x20','cointopay2','üìä\x20[HOURLY]\x20Payment\x20','\x20with\x20status\x20','findUnique','‚è∞\x20[GLOBAL]\x20Payment\x20','\x20\x20\x20-\x20GatewayPaymentId:\x20','5\x20minutes','not\x20confirmed','‚ùå\x20[CHECK]\x20Payment\x20','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','\x20found:','üîç\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','includes','gatewaySettings','\x20\x20\x20-\x20ShopId:\x20','get','üõë\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','__esModule'];a48_0x44ac=function(){return _0x3ac7a3;};return a48_0x44ac();}const coinToPayService_1=require('./gateways/coinToPayService'),coinToPay2Service_1=require(a48_0x37ed61(0xdb)),gateway_1=require(a48_0x37ed61(0x130)),database_1=__importDefault(require(a48_0x37ed61(0x102))),telegramBotService_1=require(a48_0x37ed61(0xfe)),loggerService_1=require(a48_0x37ed61(0x19d)),currencyService_1=require(a48_0x37ed61(0xf4));class CoinToPayStatusService{constructor(){const _0x1c92a0=a48_0x37ed61;this[_0x1c92a0(0x186)]=null,this[_0x1c92a0(0x189)]=0x3c*0x3c*0x3e8,this[_0x1c92a0(0xe6)]=0x5,this[_0x1c92a0(0x1a3)]=new Map(),this[_0x1c92a0(0x16f)]=new coinToPayService_1['CoinToPayService'](),this['coinToPay2Service']=new coinToPay2Service_1[(_0x1c92a0(0x1de))](),console[_0x1c92a0(0x18c)](_0x1c92a0(0x198));}[a48_0x37ed61(0x1ac)](_0x5d5f26,_0x34ca7c){const _0x423847=a48_0x37ed61;console[_0x423847(0x18c)]('ü™ô\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:'),console[_0x423847(0x18c)](_0x423847(0x168)+_0x5d5f26),console['log'](_0x423847(0xe0)+_0x34ca7c),this[_0x423847(0x1cf)](_0x5d5f26);const _0x2646be=[],_0x2d0dff=new Date(),_0x5e39c6=[{'delay':0x1*0x3c*0x3e8,'description':_0x423847(0x147)},{'delay':0x2*0x3c*0x3e8,'description':_0x423847(0x1d1)},{'delay':0x5*0x3c*0x3e8,'description':_0x423847(0x11f)},{'delay':0x5*0x3c*0x3e8,'description':_0x423847(0x11f)}];console['log'](_0x423847(0x118)+_0x5e39c6[_0x423847(0x1c2)]+_0x423847(0x175)+_0x5d5f26);let _0x1fda32=0x0;_0x5e39c6[_0x423847(0x108)]((_0x5ecf22,_0x630229)=>{const _0xa3ce27=_0x423847;_0x1fda32+=_0x5ecf22[_0xa3ce27(0x188)];const _0x39171c=setTimeout(async()=>{const _0x37185f=_0xa3ce27;console[_0x37185f(0x18c)](_0x37185f(0xf3)+(_0x630229+0x1)+_0x37185f(0x152)+_0x5d5f26+_0x37185f(0x15d)+_0x5ecf22[_0x37185f(0xcf)]+')');try{await this[_0x37185f(0x101)](_0x5d5f26),console['log'](_0x37185f(0x12b)+(_0x630229+0x1)+_0x37185f(0x157)+_0x5d5f26);}catch(_0x2897e2){console['error'](_0x37185f(0xd9)+(_0x630229+0x1)+_0x37185f(0x161)+_0x5d5f26+':',_0x2897e2),this['logCoinToPayError'](_0x5d5f26,_0x34ca7c,_0x2897e2,_0x37185f(0x159),{'checkNumber':_0x630229+0x1,'scheduledAfter':_0x5ecf22['description'],'isIndividualCheck':!![]});}},_0x1fda32);_0x2646be[_0xa3ce27(0x1b1)](_0x39171c),console[_0xa3ce27(0x18c)]('‚è∞\x20[DEBUG]\x20Scheduled\x20check\x20#'+(_0x630229+0x1)+_0xa3ce27(0x161)+_0x5d5f26+'\x20in\x20'+_0x1fda32/0x3e8+'\x20seconds\x20('+_0x5ecf22[_0xa3ce27(0xcf)]+')');});const _0x489554=setInterval(async()=>{const _0x5afdc8=_0x423847;console[_0x5afdc8(0x18c)]('ü™ô\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20'+_0x5d5f26);try{const _0x1df25a=await database_1['default'][_0x5afdc8(0x15e)][_0x5afdc8(0x11c)]({'where':{'id':_0x5d5f26},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x1df25a){console['log'](_0x5afdc8(0x10d)+_0x5d5f26+_0x5afdc8(0xe8)),this['clearPaymentTimers'](_0x5d5f26);return;}console['log'](_0x5afdc8(0x11a)+_0x5d5f26+_0x5afdc8(0x1a8)+_0x1df25a['status']);if(_0x1df25a[_0x5afdc8(0x1c7)]!==_0x5afdc8(0xf0)){console['log']('‚úÖ\x20[HOURLY]\x20Payment\x20'+_0x5d5f26+_0x5afdc8(0x1e1)+_0x1df25a[_0x5afdc8(0x1c7)]+',\x20stopping\x20individual\x20checks'),this[_0x5afdc8(0x1cf)](_0x5d5f26);return;}const _0x594eda=Math[_0x5afdc8(0x17b)]((Date[_0x5afdc8(0x1d4)]()-_0x1df25a[_0x5afdc8(0x194)][_0x5afdc8(0x13b)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x594eda>=this['EXPIRY_DAYS']){console[_0x5afdc8(0x18c)]('‚è∞\x20[HOURLY]\x20Payment\x20'+_0x5d5f26+_0x5afdc8(0x18e)+this[_0x5afdc8(0xe6)]+_0x5afdc8(0x1bf)),this[_0x5afdc8(0x1cf)](_0x5d5f26);return;}await this['checkSinglePaymentById'](_0x5d5f26),console[_0x5afdc8(0x18c)](_0x5afdc8(0x179)+_0x5d5f26);}catch(_0x23496c){console[_0x5afdc8(0xd1)](_0x5afdc8(0x199)+_0x5d5f26+':',_0x23496c),this[_0x5afdc8(0x1ad)](_0x5d5f26,_0x34ca7c,_0x23496c,_0x5afdc8(0x159),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x2646be[_0x423847(0x1b1)](_0x489554),this['paymentTimers'][_0x423847(0x170)](_0x5d5f26,{'timers':_0x2646be,'paymentId':_0x5d5f26,'gatewayPaymentId':_0x34ca7c,'createdAt':_0x2d0dff}),console[_0x423847(0x18c)](_0x423847(0xda)+_0x5e39c6[_0x423847(0x1c2)]+'\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20'+_0x5d5f26),console[_0x423847(0x18c)](_0x423847(0x1c1)+this[_0x423847(0x1a3)][_0x423847(0x1a0)]),this[_0x423847(0xee)](_0x5d5f26,_0x34ca7c,'PENDING',_0x423847(0xf0),_0x423847(0x159),{'action':'schedule_created','scheduledChecks':_0x5e39c6['length'],'firstCheckIn':_0x5e39c6[0x0][_0x423847(0x188)]/0x3e8,'totalTimers':this[_0x423847(0x1a3)]['size']});}[a48_0x37ed61(0x1cf)](_0x5f1d29){const _0x31fb9f=a48_0x37ed61,_0x453a7f=this[_0x31fb9f(0x1a3)]['get'](_0x5f1d29);_0x453a7f?(console['log']('üßπ\x20[DEBUG]\x20Clearing\x20'+_0x453a7f['timers'][_0x31fb9f(0x1c2)]+_0x31fb9f(0x1be)+_0x5f1d29),_0x453a7f['timers'][_0x31fb9f(0x108)]((_0x489281,_0x43a944)=>{const _0x48ee4c=_0x31fb9f;_0x489281&&(clearTimeout(_0x489281),clearInterval(_0x489281),console[_0x48ee4c(0x18c)](_0x48ee4c(0xeb)+(_0x43a944+0x1)+_0x48ee4c(0x161)+_0x5f1d29));}),this[_0x31fb9f(0x1a3)][_0x31fb9f(0x169)](_0x5f1d29),console[_0x31fb9f(0x18c)]('‚úÖ\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20'+_0x5f1d29+_0x31fb9f(0x18b)+this[_0x31fb9f(0x1a3)][_0x31fb9f(0x1a0)])):console['log'](_0x31fb9f(0x151)+_0x5f1d29+_0x31fb9f(0x1bc));}async[a48_0x37ed61(0x101)](_0x335c5e){const _0x3b845b=a48_0x37ed61;console['log'](_0x3b845b(0x13a)+_0x335c5e);const _0x234d06=await database_1[_0x3b845b(0x1e0)][_0x3b845b(0x15e)][_0x3b845b(0x11c)]({'where':{'id':_0x335c5e},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x234d06){console['log'](_0x3b845b(0x121)+_0x335c5e+'\x20not\x20found\x20in\x20database');return;}console[_0x3b845b(0x18c)](_0x3b845b(0x1d5)+_0x335c5e+_0x3b845b(0x123)),console[_0x3b845b(0x18c)](_0x3b845b(0xf8)+_0x234d06['gateway']),console[_0x3b845b(0x18c)](_0x3b845b(0x1e4)+_0x234d06[_0x3b845b(0x1c7)]),console[_0x3b845b(0x18c)](_0x3b845b(0x11e)+_0x234d06['gatewayPaymentId']),console['log'](_0x3b845b(0x19e)+_0x234d06['amount']+'\x20'+_0x234d06[_0x3b845b(0x1d0)]),console[_0x3b845b(0x18c)](_0x3b845b(0x127)+_0x234d06[_0x3b845b(0xd7)]);if(_0x234d06[_0x3b845b(0x1cc)]!==_0x3b845b(0x131)&&_0x234d06[_0x3b845b(0x1cc)]!=='cointopay2'){console['log']('‚ö†Ô∏è\x20[CHECK]\x20Payment\x20'+_0x335c5e+_0x3b845b(0x17d)+_0x234d06[_0x3b845b(0x1cc)]+')');return;}if(_0x234d06['status']!=='PENDING'){console[_0x3b845b(0x18c)](_0x3b845b(0x171)+_0x335c5e+'\x20status\x20is\x20'+_0x234d06[_0x3b845b(0x1c7)]+_0x3b845b(0x148)),this[_0x3b845b(0x1cf)](_0x335c5e);return;}if(!_0x234d06[_0x3b845b(0x143)]){console[_0x3b845b(0x18c)](_0x3b845b(0x171)+_0x335c5e+'\x20has\x20no\x20gatewayPaymentId');return;}console['log'](_0x3b845b(0x1c9)+_0x335c5e+'\x20is\x20valid\x20for\x20checking,\x20proceeding...'),await this[_0x3b845b(0x1d3)](_0x234d06);}[a48_0x37ed61(0xee)](_0x491848,_0x18fb45,_0x2801da,_0x33297e,_0x47d31b,_0x4d4b84){const _0x14e598=a48_0x37ed61,_0x5f1845={'type':_0x14e598(0xea),'paymentId':_0x491848,'gatewayPaymentId':_0x18fb45,'oldStatus':_0x2801da,'newStatus':_0x33297e,'source':_0x47d31b,'timestamp':new Date()['toISOString'](),'details':_0x4d4b84||{}};loggerService_1['loggerService'][_0x14e598(0xee)](_0x5f1845),console['log']('ü™ô\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20'+_0x491848+'\x20('+_0x18fb45+')'),console[_0x14e598(0x18c)](_0x14e598(0x1bd)+_0x2801da+_0x14e598(0x183)+_0x33297e),console['log'](_0x14e598(0x1dc)+_0x47d31b),console['log']('\x20\x20\x20üìÖ\x20Time:\x20'+_0x5f1845[_0x14e598(0x14d)]),_0x4d4b84&&console[_0x14e598(0x18c)](_0x14e598(0xde),_0x4d4b84);}['logCoinToPayError'](_0x365c52,_0x10e081,_0x2f425f,_0x677941,_0x3564fb){const _0x53757e=a48_0x37ed61,_0x4fc1e6={'type':_0x53757e(0x12c),'paymentId':_0x365c52,'gatewayPaymentId':_0x10e081,'error':_0x2f425f instanceof Error?{'message':_0x2f425f[_0x53757e(0x1a1)],'stack':_0x2f425f[_0x53757e(0x197)]}:_0x2f425f,'source':_0x677941,'timestamp':new Date()[_0x53757e(0x1aa)](),'context':_0x3564fb||{}};loggerService_1[_0x53757e(0x1d9)][_0x53757e(0x1ad)](_0x4fc1e6),console[_0x53757e(0xd1)](_0x53757e(0x13e)+_0x365c52+'\x20('+_0x10e081+')'),console[_0x53757e(0xd1)](_0x53757e(0x16a)+(_0x2f425f instanceof Error?_0x2f425f[_0x53757e(0x1a1)]:_0x2f425f)),console[_0x53757e(0xd1)](_0x53757e(0x1dc)+_0x677941),console[_0x53757e(0xd1)](_0x53757e(0x10b)+_0x4fc1e6['timestamp']),_0x3564fb&&console[_0x53757e(0xd1)](_0x53757e(0x165),_0x3564fb);}['startPeriodicStatusCheck'](){const _0x2d7583=a48_0x37ed61;console['log']('ü™ô\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)'),this[_0x2d7583(0x132)]()[_0x2d7583(0x1ab)](_0x5a0968=>{const _0x390d52=_0x2d7583;console[_0x390d52(0xd1)](_0x390d52(0x14a),_0x5a0968);}),this['globalCheckInterval']=setInterval(async()=>{const _0x33bbbd=_0x2d7583;try{console[_0x33bbbd(0x18c)](_0x33bbbd(0x104)),await this['checkAllPendingPayments'](),console[_0x33bbbd(0x18c)](_0x33bbbd(0x18a));}catch(_0x2d7d8a){console['error'](_0x33bbbd(0x1a9),_0x2d7d8a);}},this[_0x2d7583(0x189)]),console[_0x2d7583(0x18c)]('‚úÖ\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)');}[a48_0x37ed61(0xe4)](){const _0xbb6d78=a48_0x37ed61;console['log'](_0xbb6d78(0x180));this[_0xbb6d78(0x186)]&&(clearInterval(this['globalCheckInterval']),this[_0xbb6d78(0x186)]=null,console['log'](_0xbb6d78(0x129)));const _0x4488d8=this[_0xbb6d78(0x1a3)][_0xbb6d78(0x1a0)];for(const [_0x44fa44]of this['paymentTimers']){this[_0xbb6d78(0x1cf)](_0x44fa44);}console[_0xbb6d78(0x18c)](_0xbb6d78(0x1c5)+_0x4488d8+_0xbb6d78(0x1df));}async['checkAllPendingPayments'](){const _0x5d9684=a48_0x37ed61;try{console[_0x5d9684(0x18c)]('ü™ô\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...');const _0x1001bb=await database_1[_0x5d9684(0x1e0)][_0x5d9684(0x15e)]['findMany']({'where':{'gateway':{'in':[_0x5d9684(0x131),_0x5d9684(0x119)]},'status':_0x5d9684(0xf0),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x5d9684(0x18c)](_0x5d9684(0x1d7)+_0x1001bb[_0x5d9684(0x1c2)]+'\x20pending\x20CoinToPay\x20payments');if(_0x1001bb[_0x5d9684(0x1c2)]===0x0){console[_0x5d9684(0x18c)](_0x5d9684(0x133));return;}const _0x33a2ca=await this[_0x5d9684(0x16c)](_0x1001bb);console[_0x5d9684(0x18c)](_0x5d9684(0x140)+_0x33a2ca[_0x5d9684(0x1c2)]+_0x5d9684(0x150));let _0x4e17ac=0x0,_0xfd99bd=0x0;for(const _0x5da460 of _0x1001bb){try{if(_0x33a2ca[_0x5d9684(0x125)](_0x5da460['id'])){console[_0x5d9684(0x18c)](_0x5d9684(0x11d)+_0x5da460['id']+_0x5d9684(0xd0)),_0xfd99bd++;continue;}if(this[_0x5d9684(0x1a3)][_0x5d9684(0x1db)](_0x5da460['id'])){console[_0x5d9684(0x18c)]('‚è∞\x20[GLOBAL]\x20Payment\x20'+_0x5da460['id']+_0x5d9684(0x1d2)),_0xfd99bd++;continue;}const _0x2d8fce=(Date[_0x5d9684(0x1d4)]()-_0x5da460[_0x5d9684(0x194)][_0x5d9684(0x13b)]())/(0x3e8*0x3c*0x3c);if(_0x2d8fce<0x1){console[_0x5d9684(0x18c)]('‚è∞\x20[GLOBAL]\x20Payment\x20'+_0x5da460['id']+_0x5d9684(0x187)+_0x2d8fce['toFixed'](0x1)+_0x5d9684(0x162)),_0xfd99bd++;continue;}console[_0x5d9684(0x18c)]('üîç\x20[GLOBAL]\x20Checking\x20old\x20payment\x20'+_0x5da460['id']+_0x5d9684(0x155)+_0x2d8fce[_0x5d9684(0x138)](0x1)+'h)'),await this['checkSinglePayment'](_0x5da460),_0x4e17ac++,await new Promise(_0x562156=>setTimeout(_0x562156,0x7d0));}catch(_0x4f87f0){console[_0x5d9684(0xd1)]('‚ùå\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20'+_0x5da460['id']+':',_0x4f87f0),this[_0x5d9684(0x1ad)](_0x5da460['id'],_0x5da460['gatewayPaymentId']||'unknown',_0x4f87f0,'status_check',{'isGlobalCheck':!![],'paymentAmount':_0x5da460['amount'],'paymentCurrency':_0x5da460[_0x5d9684(0x1d0)],'shopId':_0x5da460[_0x5d9684(0xd7)],'createdAt':_0x5da460[_0x5d9684(0x194)]}),loggerService_1[_0x5d9684(0x1d9)]['logWhiteDomainError'](_0x5d9684(0x131),_0x5d9684(0x19c)+_0x5da460[_0x5d9684(0x143)],_0x4f87f0);}}console[_0x5d9684(0x18c)](_0x5d9684(0x1c6)+_0x4e17ac+_0x5d9684(0x195)+_0xfd99bd+_0x5d9684(0x156)+_0x33a2ca['length']+_0x5d9684(0x1b5));}catch(_0x197ca3){console['error'](_0x5d9684(0x1dd),_0x197ca3);}}async[a48_0x37ed61(0x16c)](_0x385b61){const _0x45d211=a48_0x37ed61,_0x471e74=[],_0x2b0768=new Date();_0x2b0768[_0x45d211(0xd2)](_0x2b0768[_0x45d211(0xf7)]()-this['EXPIRY_DAYS']),console[_0x45d211(0x18c)](_0x45d211(0x178)+this[_0x45d211(0xe6)]+'\x20days\x20(created\x20before\x20'+_0x2b0768[_0x45d211(0x1aa)]()+')');for(const _0x37370f of _0x385b61){if(_0x37370f[_0x45d211(0x194)]<_0x2b0768){console[_0x45d211(0x18c)](_0x45d211(0x1d8)+_0x37370f['id']+'\x20is\x20older\x20than\x20'+this[_0x45d211(0xe6)]+'\x20days,\x20marking\x20as\x20EXPIRED');try{this[_0x45d211(0xee)](_0x37370f['id'],_0x37370f[_0x45d211(0x143)]||'unknown',_0x45d211(0xf0),_0x45d211(0x1e2),_0x45d211(0x135),{'reason':_0x45d211(0x137)+this['EXPIRY_DAYS']+_0x45d211(0x176),'createdAt':_0x37370f[_0x45d211(0x194)],'daysSinceCreation':Math['floor']((Date['now']()-_0x37370f[_0x45d211(0x194)][_0x45d211(0x13b)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x37370f[_0x45d211(0x14f)],'paymentCurrency':_0x37370f[_0x45d211(0x1d0)],'shopId':_0x37370f[_0x45d211(0xd7)]}),await database_1[_0x45d211(0x1e0)]['payment']['update']({'where':{'id':_0x37370f['id']},'data':{'status':'EXPIRED','updatedAt':new Date()}}),await database_1['default']['webhookLog'][_0x45d211(0x1ae)]({'data':{'paymentId':_0x37370f['id'],'shopId':_0x37370f['shopId'],'event':_0x45d211(0x106),'statusCode':0xc8,'responseBody':JSON['stringify']({'reason':_0x45d211(0x137)+this[_0x45d211(0xe6)]+_0x45d211(0x176),'createdAt':_0x37370f[_0x45d211(0x194)],'expiredAt':new Date()[_0x45d211(0x1aa)](),'daysSinceCreation':Math[_0x45d211(0x17b)]((Date[_0x45d211(0x1d4)]()-_0x37370f[_0x45d211(0x194)][_0x45d211(0x13b)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this['sendShopWebhook'](_0x37370f,_0x45d211(0x1e2)),await this[_0x45d211(0x172)](_0x37370f,'EXPIRED'),this[_0x45d211(0x1cf)](_0x37370f['id']),_0x471e74[_0x45d211(0x1b1)](_0x37370f['id']),console['log'](_0x45d211(0x149)+_0x37370f['id']+_0x45d211(0x13d)+this[_0x45d211(0xe6)]+_0x45d211(0x1d6));}catch(_0x4bf891){console[_0x45d211(0xd1)](_0x45d211(0x182)+_0x37370f['id']+':',_0x4bf891),this['logCoinToPayError'](_0x37370f['id'],_0x37370f['gatewayPaymentId']||_0x45d211(0x110),_0x4bf891,_0x45d211(0x135),{'reason':_0x45d211(0x1ce),'createdAt':_0x37370f['createdAt'],'daysSinceCreation':Math[_0x45d211(0x17b)]((Date['now']()-_0x37370f['createdAt'][_0x45d211(0x13b)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x471e74;}async[a48_0x37ed61(0x1d3)](_0x3b06a2){const _0x4f0560=a48_0x37ed61;if(!_0x3b06a2[_0x4f0560(0x143)]){console[_0x4f0560(0x18c)](_0x4f0560(0x171)+_0x3b06a2['id']+_0x4f0560(0xed));return;}console[_0x4f0560(0x18c)](_0x4f0560(0x15c)+_0x3b06a2['gateway']+_0x4f0560(0xf2)+_0x3b06a2['id']+'\x20('+_0x3b06a2[_0x4f0560(0x143)]+')');try{let _0x3dda4f;_0x3b06a2[_0x4f0560(0x1cc)]==='cointopay2'?(_0x3dda4f=await this[_0x4f0560(0x13f)][_0x4f0560(0x167)](_0x3b06a2['gatewayPaymentId']),console[_0x4f0560(0x18c)](_0x4f0560(0x174)+_0x3b06a2['id']+_0x4f0560(0x1b6)+_0x3dda4f['status'])):(_0x3dda4f=await this['coinToPayService'][_0x4f0560(0x167)](_0x3b06a2[_0x4f0560(0x143)]),console[_0x4f0560(0x18c)](_0x4f0560(0x144)+_0x3b06a2['id']+_0x4f0560(0x1b6)+_0x3dda4f['status']));_0x3dda4f['paymentDetails']&&console[_0x4f0560(0x18c)](_0x4f0560(0x1d5)+_0x3b06a2['id']+_0x4f0560(0x117),{'iban':_0x3dda4f[_0x4f0560(0x16d)]['iban']||'not\x20found','transactionId':_0x3dda4f[_0x4f0560(0x16d)][_0x4f0560(0x163)],'createdOn':_0x3dda4f['paymentDetails'][_0x4f0560(0xef)],'confirmedOn':_0x3dda4f[_0x4f0560(0x16d)][_0x4f0560(0x139)]||_0x4f0560(0x120)});if(_0x3dda4f['status']!==_0x3b06a2[_0x4f0560(0x1c7)]){console[_0x4f0560(0x18c)](_0x4f0560(0x1b7)+_0x3b06a2['id']+_0x4f0560(0xdc)+_0x3b06a2['status']+_0x4f0560(0x18f)+_0x3dda4f[_0x4f0560(0x1c7)]),this[_0x4f0560(0xee)](_0x3b06a2['id'],_0x3b06a2['gatewayPaymentId'],_0x3b06a2['status'],_0x3dda4f['status'],_0x4f0560(0x159),{'paymentDetails':_0x3dda4f[_0x4f0560(0x16d)],'amount':_0x3dda4f[_0x4f0560(0x14f)],'currency':_0x3dda4f['currency'],'shopId':_0x3b06a2['shopId'],'checkTimestamp':new Date()[_0x4f0560(0x1aa)]()});const _0x1fa9b4={'status':_0x3dda4f['status'],'updatedAt':new Date()};if(_0x3dda4f[_0x4f0560(0x1c7)]===_0x4f0560(0xe7)&&_0x3b06a2[_0x4f0560(0x1c7)]!==_0x4f0560(0xe7)){_0x1fa9b4[_0x4f0560(0x1a4)]=new Date();if(!_0x3b06a2[_0x4f0560(0x10e)]){const _0x1d0626=await currencyService_1['currencyService'][_0x4f0560(0x196)](_0x3b06a2[_0x4f0560(0x14f)],_0x3b06a2[_0x4f0560(0x1d0)]);_0x1fa9b4[_0x4f0560(0x10e)]=_0x1d0626;const _0x40b574=await this[_0x4f0560(0x134)](_0x3b06a2[_0x4f0560(0xd7)],_0x3b06a2[_0x4f0560(0x1cc)]),_0x579ff8=_0x1d0626*(0x1-_0x40b574/0x64);_0x1fa9b4[_0x4f0560(0x100)]=_0x579ff8,_0x1fa9b4[_0x4f0560(0x1b3)]=_0x40b574,console['log']('üí∞\x20[CHECK]\x20Payment\x20'+_0x3b06a2['id']+_0x4f0560(0x145)),console[_0x4f0560(0x18c)](_0x4f0560(0x17c)+_0x3b06a2[_0x4f0560(0x14f)]+'\x20'+_0x3b06a2[_0x4f0560(0x1d0)]+_0x4f0560(0x183)+_0x1d0626[_0x4f0560(0x138)](0x6)+_0x4f0560(0x1b2)),console[_0x4f0560(0x18c)](_0x4f0560(0x146)+_0x3b06a2[_0x4f0560(0x1cc)]+_0x4f0560(0x15a)+_0x40b574+'%'),console[_0x4f0560(0x18c)]('\x20\x20\x20Amount\x20after\x20commission:\x20'+_0x579ff8[_0x4f0560(0x138)](0x6)+'\x20USDT');}console['log'](_0x4f0560(0x17f)+_0x3b06a2['id']+_0x4f0560(0x1e6)+_0x1fa9b4['paidAt'][_0x4f0560(0x1aa)]());}if(_0x3dda4f[_0x4f0560(0x16d)]){const _0x3d3bd0=_0x3dda4f['paymentDetails'];_0x3d3bd0['iban']&&(_0x1fa9b4[_0x4f0560(0x1a2)]=_0x3d3bd0[_0x4f0560(0xf1)],console[_0x4f0560(0x18c)](_0x4f0560(0xe3)+_0x3d3bd0[_0x4f0560(0xf1)])),_0x3d3bd0['bankDetails']&&console[_0x4f0560(0x18c)](_0x4f0560(0x1af)+_0x3d3bd0['bankDetails']),_0x3d3bd0['transactionId']&&console[_0x4f0560(0x18c)](_0x4f0560(0x1c3)+_0x3d3bd0['transactionId']),_0x3d3bd0[_0x4f0560(0x139)]&&console['log'](_0x4f0560(0x1cd)+_0x3d3bd0['confirmedOn']);}await database_1[_0x4f0560(0x1e0)][_0x4f0560(0x15e)][_0x4f0560(0x154)]({'where':{'id':_0x3b06a2['id']},'data':_0x1fa9b4});if(_0x3dda4f['status']==='PAID'&&_0x3b06a2['status']!==_0x4f0560(0xe7)){console[_0x4f0560(0x18c)](_0x4f0560(0x173)+_0x3b06a2['id']+_0x4f0560(0x1e5));const _0xb4486e=await database_1[_0x4f0560(0x1e0)]['payment'][_0x4f0560(0x11c)]({'where':{'id':_0x3b06a2['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0xb4486e?.[_0x4f0560(0x15b)]&&_0xb4486e[_0x4f0560(0x185)])try{const _0x4d0774=_0xb4486e[_0x4f0560(0x185)];console[_0x4f0560(0x18c)](_0x4f0560(0xf9)+_0x4d0774['id']+_0x4f0560(0x12d)+_0x4d0774['type']+_0x4f0560(0xf6)+_0x4d0774[_0x4f0560(0xfb)]+',\x20status='+_0x4d0774[_0x4f0560(0x1c7)]);const _0x42fdc1=_0x4d0774[_0x4f0560(0xfb)]+0x1,_0x258a60=_0x4d0774[_0x4f0560(0x181)]===_0x4f0560(0xd5)?_0x4f0560(0x160):_0x4d0774[_0x4f0560(0x1c7)];await database_1[_0x4f0560(0x1e0)][_0x4f0560(0x185)][_0x4f0560(0x154)]({'where':{'id':_0x4d0774['id']},'data':{'currentPayments':_0x42fdc1,'status':_0x258a60,'updatedAt':new Date()}}),console[_0x4f0560(0x18c)](_0x4f0560(0x1a5)+_0x4d0774['id']+_0x4f0560(0xe9)+_0x4d0774['currentPayments']+_0x4f0560(0x183)+_0x42fdc1+_0x4f0560(0x112)+_0x4d0774[_0x4f0560(0x1c7)]+_0x4f0560(0x183)+_0x258a60);}catch(_0x52e560){console[_0x4f0560(0xd1)]('‚ùå\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:',_0x52e560);}else console['log'](_0x4f0560(0x173)+_0x3b06a2['id']+'\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link');}await database_1['default'][_0x4f0560(0x166)]['create']({'data':{'paymentId':_0x3b06a2['id'],'shopId':_0x3b06a2[_0x4f0560(0xd7)],'event':'cointopay_status_check_'+_0x3dda4f[_0x4f0560(0x1c7)][_0x4f0560(0x19b)](),'statusCode':0xc8,'responseBody':JSON[_0x4f0560(0xd3)]({'oldStatus':_0x3b06a2['status'],'newStatus':_0x3dda4f[_0x4f0560(0x1c7)],'paymentDetails':_0x3dda4f[_0x4f0560(0x16d)],'checkedAt':new Date()['toISOString']()})}}),await this[_0x4f0560(0x177)](_0x3b06a2,_0x3dda4f[_0x4f0560(0x1c7)]),await this['sendPaymentStatusNotification'](_0x3b06a2,_0x3dda4f[_0x4f0560(0x1c7)]),_0x3dda4f[_0x4f0560(0x1c7)]!==_0x4f0560(0xf0)&&(console['log'](_0x4f0560(0x1b9)+_0x3b06a2['id']+_0x4f0560(0x1b4)+_0x3dda4f[_0x4f0560(0x1c7)]+_0x4f0560(0x113)),this[_0x4f0560(0x1cf)](_0x3b06a2['id'])),console[_0x4f0560(0x18c)](_0x4f0560(0x1c9)+_0x3b06a2['id']+_0x4f0560(0x19a));}else console['log'](_0x4f0560(0x1d5)+_0x3b06a2['id']+_0x4f0560(0x13c)+_0x3dda4f[_0x4f0560(0x1c7)]+')'),this['logCoinToPayStatus'](_0x3b06a2['id'],_0x3b06a2['gatewayPaymentId'],_0x3b06a2['status'],_0x3dda4f[_0x4f0560(0x1c7)],_0x4f0560(0x159),{'statusUnchanged':!![],'paymentDetails':_0x3dda4f[_0x4f0560(0x16d)],'amount':_0x3dda4f['amount'],'currency':_0x3dda4f['currency'],'shopId':_0x3b06a2[_0x4f0560(0xd7)],'checkTimestamp':new Date()[_0x4f0560(0x1aa)]()});}catch(_0xd0f7fe){console[_0x4f0560(0xd1)](_0x4f0560(0x1c0)+_0x3b06a2['id']+':',_0xd0f7fe),this[_0x4f0560(0x1ad)](_0x3b06a2['id'],_0x3b06a2[_0x4f0560(0x143)],_0xd0f7fe,_0x4f0560(0x159),{'paymentAmount':_0x3b06a2[_0x4f0560(0x14f)],'paymentCurrency':_0x3b06a2['currency'],'shopId':_0x3b06a2[_0x4f0560(0xd7)],'createdAt':_0x3b06a2[_0x4f0560(0x194)]}),await database_1[_0x4f0560(0x1e0)][_0x4f0560(0x166)][_0x4f0560(0x1ae)]({'data':{'paymentId':_0x3b06a2['id'],'shopId':_0x3b06a2[_0x4f0560(0xd7)],'event':'cointopay_status_check_error','statusCode':0x1f4,'responseBody':JSON[_0x4f0560(0xd3)]({'error':_0xd0f7fe instanceof Error?_0xd0f7fe[_0x4f0560(0x1a1)]:_0x4f0560(0x17a),'gatewayPaymentId':_0x3b06a2[_0x4f0560(0x143)],'checkedAt':new Date()[_0x4f0560(0x1aa)]()})}});}}async['sendShopWebhook'](_0x1d8aff,_0x49af7a){const _0x325942=a48_0x37ed61,_0x4ac2f2=Date[_0x325942(0x1d4)]();try{const _0x171866=_0x1d8aff[_0x325942(0x111)],_0x967cc3=_0x171866['settings'];if(!_0x967cc3?.[_0x325942(0x1b0)]){console[_0x325942(0x18c)](_0x325942(0x18d)+_0x171866['id']);return;}const _0x1f7231=_0x49af7a===_0x325942(0xe7)?_0x325942(0xe2):_0x49af7a==='FAILED'?_0x325942(0x1bb):_0x49af7a===_0x325942(0x1e2)?_0x325942(0x1bb):_0x325942(0x15f);if(!_0x967cc3[_0x325942(0x109)]?.[_0x325942(0x125)](_0x1f7231)){console[_0x325942(0x18c)](_0x325942(0x14e)+_0x1f7231+_0x325942(0xd6)+_0x171866['id']);return;}const _0x465801=(0x0,gateway_1[_0x325942(0x105)])(_0x1d8aff[_0x325942(0x1cc)])||_0x1d8aff[_0x325942(0x1cc)],_0x115dac={'event':_0x1f7231,'payment':{'id':_0x1d8aff['id'],'order_id':_0x1d8aff['orderId'],'gateway_order_id':_0x1d8aff[_0x325942(0x1c8)],'gateway':_0x465801,'amount':_0x1d8aff[_0x325942(0x14f)],'currency':_0x1d8aff['currency'],'status':_0x49af7a[_0x325942(0x19b)](),'customer_email':_0x1d8aff[_0x325942(0x1da)],'customer_name':_0x1d8aff[_0x325942(0x164)],'created_at':_0x1d8aff['createdAt'],'updated_at':new Date()}},_0x1289d8=await fetch(_0x967cc3[_0x325942(0x1b0)],{'method':_0x325942(0x10c),'headers':{'Content-Type':_0x325942(0x1e7),'User-Agent':_0x325942(0x103)},'body':JSON[_0x325942(0xd3)](_0x115dac)}),_0x529ae2=Date[_0x325942(0x1d4)]()-_0x4ac2f2,_0x9d3e19=_0x1289d8['ok']?_0x325942(0x192):await _0x1289d8['text']();loggerService_1[_0x325942(0x1d9)][_0x325942(0x190)](_0x1d8aff['shopId'],_0x967cc3[_0x325942(0x1b0)],_0x1f7231,_0x1289d8[_0x325942(0x1c7)],_0x529ae2,_0x115dac),console[_0x325942(0x18c)](_0x325942(0x17e)+_0x967cc3['webhookUrl']+_0x325942(0x11b)+_0x1289d8[_0x325942(0x1c7)]+'\x20('+_0x529ae2+_0x325942(0x10f));}catch(_0x5e2361){console[_0x325942(0xd1)](_0x325942(0xff),_0x5e2361),loggerService_1['loggerService'][_0x325942(0x114)](_0x1d8aff[_0x325942(0xd7)],_0x1d8aff[_0x325942(0x111)]?.['settings']?.['webhookUrl']||_0x325942(0x110),_0x325942(0x1b8),_0x5e2361,{});}}async[a48_0x37ed61(0x172)](_0x9f6baa,_0xe1e3){const _0x3545db=a48_0x37ed61;try{const _0x349734={'PENDING':'created','PAID':_0x3545db(0x1e3),'FAILED':_0x3545db(0xfc),'EXPIRED':_0x3545db(0x1ca)},_0x119920=_0x349734[_0xe1e3];if(!_0x119920||_0x119920===_0x3545db(0xe5))return;await telegramBotService_1[_0x3545db(0xf5)][_0x3545db(0x184)](_0x9f6baa[_0x3545db(0xd7)],_0x9f6baa,_0x119920);}catch(_0x5d17c9){console[_0x3545db(0xd1)](_0x3545db(0x136),_0x5d17c9);}}async[a48_0x37ed61(0x1a6)](_0x1cd750){const _0x287751=a48_0x37ed61;console[_0x287751(0x18c)](_0x287751(0x124)+_0x1cd750);const _0x401161=await database_1[_0x287751(0x1e0)][_0x287751(0x15e)][_0x287751(0x11c)]({'where':{'id':_0x1cd750},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x401161)throw new Error(_0x287751(0xdf));if(_0x401161['gateway']!=='cointopay'&&_0x401161[_0x287751(0x1cc)]!==_0x287751(0x119))throw new Error(_0x287751(0x19f));console[_0x287751(0x18c)](_0x287751(0xfd)+_0x401161[_0x287751(0x1cc)]+_0x287751(0xf2)+_0x1cd750),await this[_0x287751(0x1d3)](_0x401161),console[_0x287751(0x18c)]('‚úÖ\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20'+_0x1cd750);}['getServiceStats'](){const _0x4e0558=a48_0x37ed61,_0x479da4=this['globalCheckInterval']?this['GLOBAL_CHECK_INTERVAL_MS']:undefined,_0x554583=Array[_0x4e0558(0xd8)](this[_0x4e0558(0x1a3)][_0x4e0558(0x14b)]())[_0x4e0558(0x153)](_0x2bf925=>({'paymentId':_0x2bf925[_0x4e0558(0x1c4)],'gatewayPaymentId':_0x2bf925[_0x4e0558(0x143)],'createdAt':_0x2bf925[_0x4e0558(0x194)],'timersCount':_0x2bf925[_0x4e0558(0x16e)][_0x4e0558(0x1c2)]}));return{'isActive':!!this[_0x4e0558(0x186)],'globalCheckIntervalMinutes':this[_0x4e0558(0x189)]/(0x3e8*0x3c),'expiryDays':this['EXPIRY_DAYS'],'activeIndividualTimers':this[_0x4e0558(0x1a3)]['size'],'nextGlobalCheckIn':_0x479da4,'paymentTimersDetails':_0x554583};}[a48_0x37ed61(0x115)](_0x2a6df6){const _0x34c46b=a48_0x37ed61,_0x4d521d=this[_0x34c46b(0x1a3)][_0x34c46b(0x128)](_0x2a6df6);if(_0x4d521d)return{'hasTimers':!![],'timersCount':_0x4d521d[_0x34c46b(0x16e)]['length'],'createdAt':_0x4d521d[_0x34c46b(0x194)],'gatewayPaymentId':_0x4d521d['gatewayPaymentId']};return{'hasTimers':![]};}async[a48_0x37ed61(0x134)](_0x7cef41,_0x2bb6a6){const _0x1b2fdc=a48_0x37ed61;try{const _0x1427af=await database_1[_0x1b2fdc(0x1e0)][_0x1b2fdc(0x111)]['findUnique']({'where':{'id':_0x7cef41},'select':{'gatewaySettings':!![]}});if(!_0x1427af?.[_0x1b2fdc(0x126)])return console[_0x1b2fdc(0x18c)](_0x1b2fdc(0x191)+_0x7cef41+_0x1b2fdc(0x193)),0xa;const _0x172046=JSON[_0x1b2fdc(0x116)](_0x1427af[_0x1b2fdc(0x126)]);for(const [_0x30b718,_0x37b127]of Object[_0x1b2fdc(0xdd)](_0x172046)){if(_0x30b718[_0x1b2fdc(0x19b)]()===_0x2bb6a6['toLowerCase']()){const _0x2ad02b=_0x37b127['commission']||0xa;return console[_0x1b2fdc(0x18c)](_0x1b2fdc(0x12f)+_0x2bb6a6+'\x20commission\x20for\x20shop\x20'+_0x7cef41+':\x20'+_0x2ad02b+'%'),_0x2ad02b;}}return console[_0x1b2fdc(0x18c)](_0x1b2fdc(0x10a)+_0x2bb6a6+'\x20in\x20shop\x20'+_0x7cef41+_0x1b2fdc(0xe1)),0xa;}catch(_0x309482){return console[_0x1b2fdc(0xd1)](_0x1b2fdc(0x122)+_0x7cef41+_0x1b2fdc(0x1cb)+_0x2bb6a6+':',_0x309482),0xa;}}}exports[a48_0x37ed61(0x1a7)]=CoinToPayStatusService,exports[a48_0x37ed61(0x158)]=new CoinToPayStatusService();