'use strict';const a57_0x4d4f3e=a57_0x17f9;(function(_0x1b8a84,_0x5d076c){const _0x2bbe76=a57_0x17f9,_0x27d2a1=_0x1b8a84();while(!![]){try{const _0x2cfa95=parseInt(_0x2bbe76(0x1d8))/0x1+-parseInt(_0x2bbe76(0x29a))/0x2+parseInt(_0x2bbe76(0x292))/0x3+-parseInt(_0x2bbe76(0x1d2))/0x4+-parseInt(_0x2bbe76(0x1e7))/0x5*(parseInt(_0x2bbe76(0x23f))/0x6)+-parseInt(_0x2bbe76(0x287))/0x7+parseInt(_0x2bbe76(0x1df))/0x8;if(_0x2cfa95===_0x5d076c)break;else _0x27d2a1['push'](_0x27d2a1['shift']());}catch(_0x597b2b){_0x27d2a1['push'](_0x27d2a1['shift']());}}}(a57_0x429b,0x613db));function a57_0x17f9(_0x3398af,_0x5b59b4){_0x3398af=_0x3398af-0x1cf;const _0x429bd9=a57_0x429b();let _0x17f9d9=_0x429bd9[_0x3398af];return _0x17f9d9;}var __importDefault=this&&this[a57_0x4d4f3e(0x26e)]||function(_0x5ccda9){const _0xbf7ed0=a57_0x4d4f3e;return _0x5ccda9&&_0x5ccda9[_0xbf7ed0(0x200)]?_0x5ccda9:{'default':_0x5ccda9};};Object[a57_0x4d4f3e(0x1da)](exports,'__esModule',{'value':!![]}),exports[a57_0x4d4f3e(0x2b6)]=exports[a57_0x4d4f3e(0x297)]=void 0x0;const crypto_1=__importDefault(require(a57_0x4d4f3e(0x286))),coinToPayService_1=require(a57_0x4d4f3e(0x2ba)),coinToPay2Service_1=require(a57_0x4d4f3e(0x1f5)),gateway_1=require(a57_0x4d4f3e(0x1e5)),database_1=__importDefault(require('../config/database')),telegramBotService_1=require('./telegramBotService'),loggerService_1=require('./loggerService'),currencyService_1=require('./currencyService');class CoinToPayStatusService{constructor(){const _0x37e981=a57_0x4d4f3e;this[_0x37e981(0x2b7)]=null,this[_0x37e981(0x25b)]=0x3c*0x3c*0x3e8,this[_0x37e981(0x2b5)]=0x5,this['paymentTimers']=new Map(),this[_0x37e981(0x1ea)]=new coinToPayService_1[(_0x37e981(0x264))](),this[_0x37e981(0x1dd)]=new coinToPay2Service_1[(_0x37e981(0x1fb))](),console[_0x37e981(0x263)]('ü™ô\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2');}[a57_0x4d4f3e(0x216)](_0x45e5ab,_0x474e3f){const _0xd89ca1=a57_0x4d4f3e;console[_0xd89ca1(0x263)](_0xd89ca1(0x27c)),console[_0xd89ca1(0x263)]('\x20\x20\x20-\x20paymentId:\x20'+_0x45e5ab),console[_0xd89ca1(0x263)](_0xd89ca1(0x293)+_0x474e3f),this[_0xd89ca1(0x2a0)](_0x45e5ab);const _0x5d5ad=[],_0x114486=new Date(),_0x130fc2=[{'delay':0x1*0x3c*0x3e8,'description':_0xd89ca1(0x27f)},{'delay':0x2*0x3c*0x3e8,'description':'2\x20minutes'},{'delay':0x5*0x3c*0x3e8,'description':_0xd89ca1(0x25a)},{'delay':0x5*0x3c*0x3e8,'description':_0xd89ca1(0x25a)}];console[_0xd89ca1(0x263)]('ü™ô\x20[DEBUG]\x20Creating\x20'+_0x130fc2[_0xd89ca1(0x267)]+_0xd89ca1(0x259)+_0x45e5ab);let _0x551b94=0x0;_0x130fc2[_0xd89ca1(0x1d5)]((_0x3166fc,_0x1a7ec3)=>{const _0x913217=_0xd89ca1;_0x551b94+=_0x3166fc[_0x913217(0x28f)];const _0x1f44fd=setTimeout(async()=>{const _0x253ec6=_0x913217;console[_0x253ec6(0x263)]('ü™ô\x20[TIMER]\x20Individual\x20check\x20#'+(_0x1a7ec3+0x1)+_0x253ec6(0x269)+_0x45e5ab+'\x20(after\x20'+_0x3166fc[_0x253ec6(0x1f1)]+')');try{await this[_0x253ec6(0x240)](_0x45e5ab),console[_0x253ec6(0x263)](_0x253ec6(0x26c)+(_0x1a7ec3+0x1)+_0x253ec6(0x288)+_0x45e5ab);}catch(_0x1711bc){console[_0x253ec6(0x1db)]('‚ùå\x20[TIMER]\x20Failed\x20individual\x20check\x20#'+(_0x1a7ec3+0x1)+_0x253ec6(0x280)+_0x45e5ab+':',_0x1711bc),this['logCoinToPayError'](_0x45e5ab,_0x474e3f,_0x1711bc,_0x253ec6(0x2a4),{'checkNumber':_0x1a7ec3+0x1,'scheduledAfter':_0x3166fc[_0x253ec6(0x1f1)],'isIndividualCheck':!![]});}},_0x551b94);_0x5d5ad[_0x913217(0x1d7)](_0x1f44fd),console['log'](_0x913217(0x1cf)+(_0x1a7ec3+0x1)+_0x913217(0x280)+_0x45e5ab+_0x913217(0x282)+_0x551b94/0x3e8+_0x913217(0x2c1)+_0x3166fc['description']+')');});const _0x27bb1d=setInterval(async()=>{const _0x36e210=_0xd89ca1;console[_0x36e210(0x263)](_0x36e210(0x247)+_0x45e5ab);try{const _0x26f9a8=await database_1[_0x36e210(0x26f)][_0x36e210(0x2ae)][_0x36e210(0x1dc)]({'where':{'id':_0x45e5ab},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x26f9a8){console[_0x36e210(0x263)]('‚ùå\x20[HOURLY]\x20Payment\x20'+_0x45e5ab+_0x36e210(0x1ec)),this[_0x36e210(0x2a0)](_0x45e5ab);return;}console[_0x36e210(0x263)](_0x36e210(0x23c)+_0x45e5ab+_0x36e210(0x296)+_0x26f9a8[_0x36e210(0x22f)]);if(_0x26f9a8['status']!==_0x36e210(0x29d)){console[_0x36e210(0x263)]('‚úÖ\x20[HOURLY]\x20Payment\x20'+_0x45e5ab+_0x36e210(0x246)+_0x26f9a8[_0x36e210(0x22f)]+_0x36e210(0x236)),this[_0x36e210(0x2a0)](_0x45e5ab);return;}const _0x21135c=Math[_0x36e210(0x20a)]((Date['now']()-_0x26f9a8[_0x36e210(0x220)]['getTime']())/(0x3e8*0x3c*0x3c*0x18));if(_0x21135c>=this[_0x36e210(0x2b5)]){console['log'](_0x36e210(0x22e)+_0x45e5ab+'\x20is\x20older\x20than\x20'+this[_0x36e210(0x2b5)]+_0x36e210(0x252)),this[_0x36e210(0x2a0)](_0x45e5ab);return;}await this[_0x36e210(0x240)](_0x45e5ab),console['log']('‚úÖ\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20'+_0x45e5ab);}catch(_0x2e39e5){console[_0x36e210(0x1db)](_0x36e210(0x1e1)+_0x45e5ab+':',_0x2e39e5),this[_0x36e210(0x270)](_0x45e5ab,_0x474e3f,_0x2e39e5,_0x36e210(0x2a4),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x5d5ad[_0xd89ca1(0x1d7)](_0x27bb1d),this[_0xd89ca1(0x2c6)][_0xd89ca1(0x2af)](_0x45e5ab,{'timers':_0x5d5ad,'paymentId':_0x45e5ab,'gatewayPaymentId':_0x474e3f,'createdAt':_0x114486}),console[_0xd89ca1(0x263)]('‚úÖ\x20[DEBUG]\x20Successfully\x20scheduled\x20'+_0x130fc2[_0xd89ca1(0x267)]+'\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20'+_0x45e5ab),console['log'](_0xd89ca1(0x27a)+this['paymentTimers'][_0xd89ca1(0x214)]),this[_0xd89ca1(0x289)](_0x45e5ab,_0x474e3f,_0xd89ca1(0x29d),_0xd89ca1(0x29d),_0xd89ca1(0x2a4),{'action':_0xd89ca1(0x210),'scheduledChecks':_0x130fc2[_0xd89ca1(0x267)],'firstCheckIn':_0x130fc2[0x0][_0xd89ca1(0x28f)]/0x3e8,'totalTimers':this['paymentTimers'][_0xd89ca1(0x214)]});}[a57_0x4d4f3e(0x2a0)](_0x4c78a1){const _0x4d2f28=a57_0x4d4f3e,_0x59b0f8=this[_0x4d2f28(0x2c6)]['get'](_0x4c78a1);_0x59b0f8?(console['log'](_0x4d2f28(0x2b4)+_0x59b0f8[_0x4d2f28(0x1eb)][_0x4d2f28(0x267)]+_0x4d2f28(0x235)+_0x4c78a1),_0x59b0f8['timers']['forEach']((_0x2b112d,_0x5579e3)=>{const _0x2c9b5c=_0x4d2f28;_0x2b112d&&(clearTimeout(_0x2b112d),clearInterval(_0x2b112d),console[_0x2c9b5c(0x263)](_0x2c9b5c(0x1f6)+(_0x5579e3+0x1)+_0x2c9b5c(0x280)+_0x4c78a1));}),this[_0x4d2f28(0x2c6)][_0x4d2f28(0x2b3)](_0x4c78a1),console[_0x4d2f28(0x263)](_0x4d2f28(0x285)+_0x4c78a1+_0x4d2f28(0x21d)+this['paymentTimers'][_0x4d2f28(0x214)])):console[_0x4d2f28(0x263)]('‚ö†Ô∏è\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20'+_0x4c78a1+_0x4d2f28(0x28b));}async[a57_0x4d4f3e(0x240)](_0x102428){const _0x33d3c3=a57_0x4d4f3e;console[_0x33d3c3(0x263)](_0x33d3c3(0x23d)+_0x102428);const _0x255193=await database_1[_0x33d3c3(0x26f)][_0x33d3c3(0x2ae)][_0x33d3c3(0x1dc)]({'where':{'id':_0x102428},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x255193){console[_0x33d3c3(0x263)](_0x33d3c3(0x25d)+_0x102428+'\x20not\x20found\x20in\x20database');return;}console[_0x33d3c3(0x263)](_0x33d3c3(0x2ab)+_0x102428+_0x33d3c3(0x256)),console[_0x33d3c3(0x263)](_0x33d3c3(0x258)+_0x255193[_0x33d3c3(0x1f7)]),console[_0x33d3c3(0x263)]('\x20\x20\x20-\x20Status:\x20'+_0x255193['status']),console['log'](_0x33d3c3(0x226)+_0x255193[_0x33d3c3(0x28e)]),console['log'](_0x33d3c3(0x255)+_0x255193['amount']+'\x20'+_0x255193[_0x33d3c3(0x228)]),console['log']('\x20\x20\x20-\x20ShopId:\x20'+_0x255193[_0x33d3c3(0x2cf)]);if(_0x255193[_0x33d3c3(0x1f7)]!=='cointopay'&&_0x255193[_0x33d3c3(0x1f7)]!==_0x33d3c3(0x275)){console[_0x33d3c3(0x263)](_0x33d3c3(0x1fa)+_0x102428+_0x33d3c3(0x232)+_0x255193[_0x33d3c3(0x1f7)]+')');return;}if(_0x255193[_0x33d3c3(0x22f)]!==_0x33d3c3(0x29d)){console[_0x33d3c3(0x263)](_0x33d3c3(0x1fa)+_0x102428+'\x20status\x20is\x20'+_0x255193[_0x33d3c3(0x22f)]+_0x33d3c3(0x236)),this[_0x33d3c3(0x2a0)](_0x102428);return;}if(!_0x255193[_0x33d3c3(0x28e)]){console[_0x33d3c3(0x263)]('‚ö†Ô∏è\x20[CHECK]\x20Payment\x20'+_0x102428+_0x33d3c3(0x28d));return;}console[_0x33d3c3(0x263)](_0x33d3c3(0x2d4)+_0x102428+_0x33d3c3(0x257)),await this[_0x33d3c3(0x2c9)](_0x255193);}[a57_0x4d4f3e(0x289)](_0x43d490,_0x440184,_0x2065ac,_0x29b5da,_0x1baa1a,_0x12310b){const _0x2dc919=a57_0x4d4f3e,_0x2f8375={'type':_0x2dc919(0x26b),'paymentId':_0x43d490,'gatewayPaymentId':_0x440184,'oldStatus':_0x2065ac,'newStatus':_0x29b5da,'source':_0x1baa1a,'timestamp':new Date()['toISOString'](),'details':_0x12310b||{}};loggerService_1['loggerService'][_0x2dc919(0x289)](_0x2f8375),console[_0x2dc919(0x263)](_0x2dc919(0x21f)+_0x43d490+'\x20('+_0x440184+')'),console[_0x2dc919(0x263)](_0x2dc919(0x2c2)+_0x2065ac+_0x2dc919(0x25e)+_0x29b5da),console['log'](_0x2dc919(0x1d3)+_0x1baa1a),console[_0x2dc919(0x263)]('\x20\x20\x20üìÖ\x20Time:\x20'+_0x2f8375[_0x2dc919(0x1e9)]),_0x12310b&&console['log'](_0x2dc919(0x2ad),_0x12310b);}[a57_0x4d4f3e(0x270)](_0x3b7221,_0x3fa2bb,_0x30a588,_0x51d1dd,_0x41d1c6){const _0x3af67c=a57_0x4d4f3e,_0x4ed8c1={'type':'COINTOPAY_ERROR','paymentId':_0x3b7221,'gatewayPaymentId':_0x3fa2bb,'error':_0x30a588 instanceof Error?{'message':_0x30a588[_0x3af67c(0x28c)],'stack':_0x30a588[_0x3af67c(0x23e)]}:_0x30a588,'source':_0x51d1dd,'timestamp':new Date()[_0x3af67c(0x253)](),'context':_0x41d1c6||{}};loggerService_1[_0x3af67c(0x2a6)][_0x3af67c(0x270)](_0x4ed8c1),console[_0x3af67c(0x1db)]('ü™ô\x20[ERROR]\x20CoinToPay\x20Error:\x20'+_0x3b7221+'\x20('+_0x3fa2bb+')'),console['error']('\x20\x20\x20‚ùå\x20Error:\x20'+(_0x30a588 instanceof Error?_0x30a588[_0x3af67c(0x28c)]:_0x30a588)),console['error'](_0x3af67c(0x1d3)+_0x51d1dd),console[_0x3af67c(0x1db)](_0x3af67c(0x24d)+_0x4ed8c1[_0x3af67c(0x1e9)]),_0x41d1c6&&console['error'](_0x3af67c(0x217),_0x41d1c6);}['startPeriodicStatusCheck'](){const _0x2ebf1c=a57_0x4d4f3e;console[_0x2ebf1c(0x263)](_0x2ebf1c(0x23b)),this[_0x2ebf1c(0x1d9)]()[_0x2ebf1c(0x24a)](_0x102d68=>{const _0x1ccc42=_0x2ebf1c;console[_0x1ccc42(0x1db)](_0x1ccc42(0x244),_0x102d68);}),this[_0x2ebf1c(0x2b7)]=setInterval(async()=>{const _0x397a55=_0x2ebf1c;try{console[_0x397a55(0x263)](_0x397a55(0x239)),await this['checkAllPendingPayments'](),console[_0x397a55(0x263)](_0x397a55(0x2c8));}catch(_0x31150f){console[_0x397a55(0x1db)](_0x397a55(0x250),_0x31150f);}},this[_0x2ebf1c(0x25b)]),console[_0x2ebf1c(0x263)](_0x2ebf1c(0x2a7));}['stopPeriodicStatusCheck'](){const _0x5cce05=a57_0x4d4f3e;console[_0x5cce05(0x263)](_0x5cce05(0x25c));this[_0x5cce05(0x2b7)]&&(clearInterval(this[_0x5cce05(0x2b7)]),this[_0x5cce05(0x2b7)]=null,console[_0x5cce05(0x263)]('üõë\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped'));const _0x3caee3=this[_0x5cce05(0x2c6)][_0x5cce05(0x214)];for(const [_0x4189fb]of this['paymentTimers']){this[_0x5cce05(0x2a0)](_0x4189fb);}console[_0x5cce05(0x263)](_0x5cce05(0x206)+_0x3caee3+_0x5cce05(0x221));}async[a57_0x4d4f3e(0x1d9)](){const _0x14638f=a57_0x4d4f3e;try{console[_0x14638f(0x263)](_0x14638f(0x1f4));const _0x3dcc6e=await database_1[_0x14638f(0x26f)][_0x14638f(0x2ae)][_0x14638f(0x20e)]({'where':{'gateway':{'in':[_0x14638f(0x211),'cointopay2']},'status':'PENDING','gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'secretKey':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x14638f(0x263)](_0x14638f(0x224)+_0x3dcc6e[_0x14638f(0x267)]+_0x14638f(0x2c0));if(_0x3dcc6e[_0x14638f(0x267)]===0x0){console['log']('ü™ô\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check');return;}const _0x45f8df=await this[_0x14638f(0x27e)](_0x3dcc6e);console[_0x14638f(0x263)](_0x14638f(0x219)+_0x45f8df[_0x14638f(0x267)]+'\x20expired\x20CoinToPay\x20payments');let _0x1260b5=0x0,_0x2668bd=0x0;for(const _0x1e5217 of _0x3dcc6e){try{if(_0x45f8df['includes'](_0x1e5217['id'])){console[_0x14638f(0x263)](_0x14638f(0x2d5)+_0x1e5217['id']+_0x14638f(0x1fe)),_0x2668bd++;continue;}if(this[_0x14638f(0x2c6)][_0x14638f(0x27b)](_0x1e5217['id'])){console[_0x14638f(0x263)](_0x14638f(0x2d5)+_0x1e5217['id']+_0x14638f(0x22c)),_0x2668bd++;continue;}const _0x5738ee=(Date[_0x14638f(0x24f)]()-_0x1e5217[_0x14638f(0x220)][_0x14638f(0x208)]())/(0x3e8*0x3c*0x3c);if(_0x5738ee<0x1){console['log']('‚è∞\x20[GLOBAL]\x20Payment\x20'+_0x1e5217['id']+_0x14638f(0x2c4)+_0x5738ee['toFixed'](0x1)+'h),\x20skipping\x20global\x20check'),_0x2668bd++;continue;}console['log'](_0x14638f(0x276)+_0x1e5217['id']+'\x20(age:\x20'+_0x5738ee[_0x14638f(0x204)](0x1)+'h)'),await this['checkSinglePayment'](_0x1e5217),_0x1260b5++,await new Promise(_0x1b3595=>setTimeout(_0x1b3595,0x7d0));}catch(_0x2c9a5c){console[_0x14638f(0x1db)](_0x14638f(0x238)+_0x1e5217['id']+':',_0x2c9a5c),this['logCoinToPayError'](_0x1e5217['id'],_0x1e5217['gatewayPaymentId']||'unknown',_0x2c9a5c,'status_check',{'isGlobalCheck':!![],'paymentAmount':_0x1e5217['amount'],'paymentCurrency':_0x1e5217['currency'],'shopId':_0x1e5217[_0x14638f(0x2cf)],'createdAt':_0x1e5217[_0x14638f(0x220)]}),loggerService_1['loggerService']['logWhiteDomainError']('cointopay',_0x14638f(0x29b)+_0x1e5217[_0x14638f(0x28e)],_0x2c9a5c);}}console[_0x14638f(0x263)]('‚úÖ\x20[GLOBAL]\x20Global\x20check\x20completed:\x20'+_0x1260b5+'\x20checked,\x20'+_0x2668bd+_0x14638f(0x2cd)+_0x45f8df[_0x14638f(0x267)]+'\x20expired');}catch(_0x394d7c){console[_0x14638f(0x1db)](_0x14638f(0x2b0),_0x394d7c);}}async[a57_0x4d4f3e(0x27e)](_0x5ee782){const _0x237730=a57_0x4d4f3e,_0x3628be=[],_0x1bd16e=new Date();_0x1bd16e[_0x237730(0x1ed)](_0x1bd16e['getDate']()-this[_0x237730(0x2b5)]),console['log'](_0x237730(0x2b1)+this[_0x237730(0x2b5)]+'\x20days\x20(created\x20before\x20'+_0x1bd16e[_0x237730(0x253)]()+')');for(const _0x57fd3a of _0x5ee782){if(_0x57fd3a[_0x237730(0x220)]<_0x1bd16e){console[_0x237730(0x263)](_0x237730(0x24b)+_0x57fd3a['id']+_0x237730(0x2bc)+this[_0x237730(0x2b5)]+_0x237730(0x218));try{this[_0x237730(0x289)](_0x57fd3a['id'],_0x57fd3a[_0x237730(0x28e)]||_0x237730(0x1ee),'PENDING','EXPIRED',_0x237730(0x294),{'reason':_0x237730(0x283)+this[_0x237730(0x2b5)]+_0x237730(0x25f),'createdAt':_0x57fd3a[_0x237730(0x220)],'daysSinceCreation':Math['floor']((Date[_0x237730(0x24f)]()-_0x57fd3a[_0x237730(0x220)][_0x237730(0x208)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x57fd3a[_0x237730(0x254)],'paymentCurrency':_0x57fd3a[_0x237730(0x228)],'shopId':_0x57fd3a[_0x237730(0x2cf)]}),await database_1[_0x237730(0x26f)][_0x237730(0x2ae)][_0x237730(0x205)]({'where':{'id':_0x57fd3a['id']},'data':{'status':_0x237730(0x2b2),'updatedAt':new Date()}}),await database_1[_0x237730(0x26f)][_0x237730(0x295)]['create']({'data':{'paymentId':_0x57fd3a['id'],'shopId':_0x57fd3a[_0x237730(0x2cf)],'event':_0x237730(0x215),'statusCode':0xc8,'responseBody':JSON[_0x237730(0x20d)]({'reason':_0x237730(0x283)+this[_0x237730(0x2b5)]+'\x20days','createdAt':_0x57fd3a[_0x237730(0x220)],'expiredAt':new Date()[_0x237730(0x253)](),'daysSinceCreation':Math[_0x237730(0x20a)]((Date['now']()-_0x57fd3a['createdAt'][_0x237730(0x208)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this['sendShopWebhook'](_0x57fd3a,_0x237730(0x2b2)),await this['sendPaymentStatusNotification'](_0x57fd3a,_0x237730(0x2b2)),this[_0x237730(0x2a0)](_0x57fd3a['id']),_0x3628be['push'](_0x57fd3a['id']),console[_0x237730(0x263)](_0x237730(0x274)+_0x57fd3a['id']+_0x237730(0x260)+this['EXPIRY_DAYS']+_0x237730(0x1e4));}catch(_0x504195){console[_0x237730(0x1db)](_0x237730(0x21c)+_0x57fd3a['id']+':',_0x504195),this['logCoinToPayError'](_0x57fd3a['id'],_0x57fd3a[_0x237730(0x28e)]||'unknown',_0x504195,_0x237730(0x294),{'reason':_0x237730(0x278),'createdAt':_0x57fd3a[_0x237730(0x220)],'daysSinceCreation':Math[_0x237730(0x20a)]((Date[_0x237730(0x24f)]()-_0x57fd3a[_0x237730(0x220)][_0x237730(0x208)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x3628be;}async[a57_0x4d4f3e(0x2c9)](_0x156708){const _0x53bdb8=a57_0x4d4f3e;if(!_0x156708[_0x53bdb8(0x28e)]){console[_0x53bdb8(0x263)](_0x53bdb8(0x1fa)+_0x156708['id']+_0x53bdb8(0x2be));return;}console['log']('üîç\x20[CHECK]\x20Checking\x20'+_0x156708[_0x53bdb8(0x1f7)]+_0x53bdb8(0x2bf)+_0x156708['id']+'\x20('+_0x156708[_0x53bdb8(0x28e)]+')');try{let _0x38f4e0;_0x156708['gateway']==='cointopay2'?(_0x38f4e0=await this['coinToPay2Service'][_0x53bdb8(0x1de)](_0x156708[_0x53bdb8(0x28e)]),console[_0x53bdb8(0x263)](_0x53bdb8(0x229)+_0x156708['id']+_0x53bdb8(0x251)+_0x38f4e0[_0x53bdb8(0x22f)])):(_0x38f4e0=await this[_0x53bdb8(0x1ea)][_0x53bdb8(0x1de)](_0x156708[_0x53bdb8(0x28e)]),console[_0x53bdb8(0x263)](_0x53bdb8(0x271)+_0x156708['id']+_0x53bdb8(0x251)+_0x38f4e0[_0x53bdb8(0x22f)]));_0x38f4e0[_0x53bdb8(0x2a2)]&&console[_0x53bdb8(0x263)](_0x53bdb8(0x2ab)+_0x156708['id']+_0x53bdb8(0x249),{'iban':_0x38f4e0[_0x53bdb8(0x2a2)]['iban']||_0x53bdb8(0x1ef),'transactionId':_0x38f4e0[_0x53bdb8(0x2a2)]['transactionId'],'createdOn':_0x38f4e0[_0x53bdb8(0x2a2)][_0x53bdb8(0x2d3)],'confirmedOn':_0x38f4e0[_0x53bdb8(0x2a2)]['confirmedOn']||_0x53bdb8(0x265)});if(_0x38f4e0[_0x53bdb8(0x22f)]!==_0x156708['status']){console[_0x53bdb8(0x263)](_0x53bdb8(0x241)+_0x156708['id']+_0x53bdb8(0x2c7)+_0x156708[_0x53bdb8(0x22f)]+'\x20to\x20'+_0x38f4e0['status']),this[_0x53bdb8(0x289)](_0x156708['id'],_0x156708[_0x53bdb8(0x28e)],_0x156708[_0x53bdb8(0x22f)],_0x38f4e0[_0x53bdb8(0x22f)],_0x53bdb8(0x2a4),{'paymentDetails':_0x38f4e0['paymentDetails'],'amount':_0x38f4e0[_0x53bdb8(0x254)],'currency':_0x38f4e0[_0x53bdb8(0x228)],'shopId':_0x156708[_0x53bdb8(0x2cf)],'checkTimestamp':new Date()[_0x53bdb8(0x253)]()});const _0x3819ca={'status':_0x38f4e0[_0x53bdb8(0x22f)],'updatedAt':new Date()};if(_0x38f4e0[_0x53bdb8(0x22f)]===_0x53bdb8(0x1ff)&&_0x156708['status']!==_0x53bdb8(0x1ff)){_0x3819ca[_0x53bdb8(0x2a5)]=new Date();if(!_0x156708[_0x53bdb8(0x1f2)]){const _0x1a4325=await currencyService_1[_0x53bdb8(0x2bd)]['convertToUSDT'](_0x156708['amount'],_0x156708[_0x53bdb8(0x228)]);_0x3819ca[_0x53bdb8(0x1f2)]=_0x1a4325;const _0x57cfa8=await this['getGatewayCommission'](_0x156708[_0x53bdb8(0x2cf)],_0x156708[_0x53bdb8(0x1f7)]),_0xc40012=_0x1a4325*(0x1-_0x57cfa8/0x64);_0x3819ca[_0x53bdb8(0x1e3)]=_0xc40012,_0x3819ca[_0x53bdb8(0x24c)]=_0x57cfa8,console[_0x53bdb8(0x263)](_0x53bdb8(0x290)+_0x156708['id']+_0x53bdb8(0x2a1)),console[_0x53bdb8(0x263)](_0x53bdb8(0x1e8)+_0x156708[_0x53bdb8(0x254)]+'\x20'+_0x156708[_0x53bdb8(0x228)]+_0x53bdb8(0x25e)+_0x1a4325[_0x53bdb8(0x204)](0x6)+_0x53bdb8(0x230)),console['log']('\x20\x20\x20Gateway\x20'+_0x156708[_0x53bdb8(0x1f7)]+_0x53bdb8(0x22a)+_0x57cfa8+'%'),console[_0x53bdb8(0x263)](_0x53bdb8(0x222)+_0xc40012[_0x53bdb8(0x204)](0x6)+_0x53bdb8(0x230));}console[_0x53bdb8(0x263)](_0x53bdb8(0x290)+_0x156708['id']+_0x53bdb8(0x1f8)+_0x3819ca[_0x53bdb8(0x2a5)][_0x53bdb8(0x253)]());}if(_0x38f4e0[_0x53bdb8(0x2a2)]){const _0x494d8c=_0x38f4e0[_0x53bdb8(0x2a2)];_0x494d8c['iban']&&(_0x3819ca[_0x53bdb8(0x279)]=_0x494d8c[_0x53bdb8(0x233)],console[_0x53bdb8(0x263)]('üè¶\x20[CHECK]\x20Saved\x20IBAN:\x20'+_0x494d8c[_0x53bdb8(0x233)])),_0x494d8c[_0x53bdb8(0x262)]&&console[_0x53bdb8(0x263)](_0x53bdb8(0x28a)+_0x494d8c[_0x53bdb8(0x262)]),_0x494d8c[_0x53bdb8(0x237)]&&console[_0x53bdb8(0x263)]('üÜî\x20[CHECK]\x20Transaction\x20ID:\x20'+_0x494d8c[_0x53bdb8(0x237)]),_0x494d8c[_0x53bdb8(0x2d1)]&&console[_0x53bdb8(0x263)](_0x53bdb8(0x273)+_0x494d8c[_0x53bdb8(0x2d1)]);}await database_1[_0x53bdb8(0x26f)][_0x53bdb8(0x2ae)][_0x53bdb8(0x205)]({'where':{'id':_0x156708['id']},'data':_0x3819ca});if(_0x38f4e0[_0x53bdb8(0x22f)]===_0x53bdb8(0x1ff)&&_0x156708['status']!==_0x53bdb8(0x1ff)){console[_0x53bdb8(0x263)](_0x53bdb8(0x1fc)+_0x156708['id']+'\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link');const _0x13be32=await database_1['default'][_0x53bdb8(0x2ae)][_0x53bdb8(0x1dc)]({'where':{'id':_0x156708['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x13be32?.[_0x53bdb8(0x201)]&&_0x13be32[_0x53bdb8(0x23a)])try{const _0x4d01cb=_0x13be32[_0x53bdb8(0x23a)];console[_0x53bdb8(0x263)](_0x53bdb8(0x27d)+_0x4d01cb['id']+_0x53bdb8(0x1f3)+_0x4d01cb[_0x53bdb8(0x1e6)]+_0x53bdb8(0x26d)+_0x4d01cb[_0x53bdb8(0x212)]+_0x53bdb8(0x284)+_0x4d01cb[_0x53bdb8(0x22f)]);const _0x734fac=_0x4d01cb['currentPayments']+0x1,_0x570aec=_0x4d01cb[_0x53bdb8(0x1e6)]===_0x53bdb8(0x20b)?_0x53bdb8(0x2a9):_0x4d01cb['status'];await database_1[_0x53bdb8(0x26f)][_0x53bdb8(0x23a)]['update']({'where':{'id':_0x4d01cb['id']},'data':{'currentPayments':_0x734fac,'status':_0x570aec,'updatedAt':new Date()}}),console[_0x53bdb8(0x263)](_0x53bdb8(0x21e)+_0x4d01cb['id']+'\x20updated:\x20currentPayments='+_0x4d01cb[_0x53bdb8(0x212)]+_0x53bdb8(0x25e)+_0x734fac+_0x53bdb8(0x284)+_0x4d01cb[_0x53bdb8(0x22f)]+_0x53bdb8(0x25e)+_0x570aec);}catch(_0x11890a){console[_0x53bdb8(0x1db)](_0x53bdb8(0x213),_0x11890a);}else console['log'](_0x53bdb8(0x1fc)+_0x156708['id']+'\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link');}await database_1[_0x53bdb8(0x26f)][_0x53bdb8(0x295)][_0x53bdb8(0x2d2)]({'data':{'paymentId':_0x156708['id'],'shopId':_0x156708[_0x53bdb8(0x2cf)],'event':_0x53bdb8(0x20f)+_0x38f4e0[_0x53bdb8(0x22f)][_0x53bdb8(0x261)](),'statusCode':0xc8,'responseBody':JSON['stringify']({'oldStatus':_0x156708[_0x53bdb8(0x22f)],'newStatus':_0x38f4e0[_0x53bdb8(0x22f)],'paymentDetails':_0x38f4e0[_0x53bdb8(0x2a2)],'checkedAt':new Date()['toISOString']()})}}),await this[_0x53bdb8(0x2b9)](_0x156708,_0x38f4e0[_0x53bdb8(0x22f)]),await this[_0x53bdb8(0x209)](_0x156708,_0x38f4e0[_0x53bdb8(0x22f)]),_0x38f4e0[_0x53bdb8(0x22f)]!==_0x53bdb8(0x29d)&&(console[_0x53bdb8(0x263)](_0x53bdb8(0x225)+_0x156708['id']+'\x20status\x20changed\x20to\x20'+_0x38f4e0['status']+_0x53bdb8(0x2cc)),this['clearPaymentTimers'](_0x156708['id'])),console[_0x53bdb8(0x263)]('‚úÖ\x20[CHECK]\x20Payment\x20'+_0x156708['id']+_0x53bdb8(0x21a));}else console[_0x53bdb8(0x263)](_0x53bdb8(0x2ab)+_0x156708['id']+_0x53bdb8(0x1fd)+_0x38f4e0[_0x53bdb8(0x22f)]+')'),this[_0x53bdb8(0x289)](_0x156708['id'],_0x156708['gatewayPaymentId'],_0x156708[_0x53bdb8(0x22f)],_0x38f4e0[_0x53bdb8(0x22f)],'status_check',{'statusUnchanged':!![],'paymentDetails':_0x38f4e0[_0x53bdb8(0x2a2)],'amount':_0x38f4e0[_0x53bdb8(0x254)],'currency':_0x38f4e0['currency'],'shopId':_0x156708[_0x53bdb8(0x2cf)],'checkTimestamp':new Date()[_0x53bdb8(0x253)]()});}catch(_0x3b8e24){console[_0x53bdb8(0x1db)](_0x53bdb8(0x2a3)+_0x156708['id']+':',_0x3b8e24),this[_0x53bdb8(0x270)](_0x156708['id'],_0x156708['gatewayPaymentId'],_0x3b8e24,_0x53bdb8(0x2a4),{'paymentAmount':_0x156708['amount'],'paymentCurrency':_0x156708[_0x53bdb8(0x228)],'shopId':_0x156708[_0x53bdb8(0x2cf)],'createdAt':_0x156708[_0x53bdb8(0x220)]}),await database_1[_0x53bdb8(0x26f)][_0x53bdb8(0x295)][_0x53bdb8(0x2d2)]({'data':{'paymentId':_0x156708['id'],'shopId':_0x156708[_0x53bdb8(0x2cf)],'event':_0x53bdb8(0x277),'statusCode':0x1f4,'responseBody':JSON['stringify']({'error':_0x3b8e24 instanceof Error?_0x3b8e24['message']:'Unknown\x20error','gatewayPaymentId':_0x156708[_0x53bdb8(0x28e)],'checkedAt':new Date()['toISOString']()})}});}}async[a57_0x4d4f3e(0x2b9)](_0x4a7720,_0x1a6585){const _0xe0567=a57_0x4d4f3e,_0x21c8fb=Date[_0xe0567(0x24f)]();try{const _0x207c8e=_0x4a7720[_0xe0567(0x298)],_0xfa47f8=_0x207c8e[_0xe0567(0x248)];if(!_0xfa47f8?.['webhookUrl']){console[_0xe0567(0x263)]('No\x20webhook\x20URL\x20configured\x20for\x20shop\x20'+_0x207c8e['id']);return;}const _0x773346=_0x1a6585===_0xe0567(0x1ff)?_0xe0567(0x22b):_0x1a6585==='FAILED'?_0xe0567(0x202):_0x1a6585===_0xe0567(0x2b2)?_0xe0567(0x202):_0xe0567(0x2cb);if(!_0xfa47f8[_0xe0567(0x291)]?.[_0xe0567(0x20c)](_0x773346)){console[_0xe0567(0x263)]('Webhook\x20event\x20'+_0x773346+_0xe0567(0x234)+_0x207c8e['id']);return;}const _0x32d45f=(0x0,gateway_1[_0xe0567(0x1d6)])(_0x4a7720[_0xe0567(0x1f7)])||_0x4a7720[_0xe0567(0x1f7)],_0x55009a={'event':_0x773346,'payment':{'id':_0x4a7720['id'],'order_id':_0x4a7720[_0xe0567(0x2ca)],'gateway_order_id':_0x4a7720[_0xe0567(0x26a)],'gateway':_0x32d45f,'amount':_0x4a7720[_0xe0567(0x254)],'currency':_0x4a7720[_0xe0567(0x228)],'status':_0x1a6585[_0xe0567(0x261)](),'customer_email':_0x4a7720[_0xe0567(0x2bb)],'customer_name':_0x4a7720[_0xe0567(0x2a8)],'created_at':_0x4a7720[_0xe0567(0x220)],'updated_at':new Date()}},_0x2793ca=JSON[_0xe0567(0x20d)](_0x55009a),_0x24edbe=crypto_1[_0xe0567(0x26f)][_0xe0567(0x266)](_0xe0567(0x268),_0x4a7720[_0xe0567(0x298)]['secretKey'])['update'](_0x2793ca)[_0xe0567(0x1f9)](_0xe0567(0x2ac)),_0x4206c4=await fetch(_0xfa47f8[_0xe0567(0x21b)],{'method':_0xe0567(0x22d),'headers':{'Content-Type':'application/json','User-Agent':_0xe0567(0x1d4),'X-Webhook-Signature':_0x24edbe},'body':_0x2793ca}),_0x4e9e3a=Date['now']()-_0x21c8fb,_0x320342=_0x4206c4['ok']?'Success':await _0x4206c4[_0xe0567(0x242)]();loggerService_1[_0xe0567(0x2a6)][_0xe0567(0x29c)](_0x4a7720[_0xe0567(0x2cf)],_0xfa47f8[_0xe0567(0x21b)],_0x773346,_0x4206c4[_0xe0567(0x22f)],_0x4e9e3a,_0x55009a),console[_0xe0567(0x263)](_0xe0567(0x2c3)+_0xfa47f8[_0xe0567(0x21b)]+_0xe0567(0x1e0)+_0x4206c4['status']+'\x20('+_0x4e9e3a+'ms)');}catch(_0x557e7a){console[_0xe0567(0x1db)]('Failed\x20to\x20send\x20shop\x20webhook:',_0x557e7a),loggerService_1['loggerService'][_0xe0567(0x227)](_0x4a7720[_0xe0567(0x2cf)],_0x4a7720[_0xe0567(0x298)]?.[_0xe0567(0x248)]?.[_0xe0567(0x21b)]||_0xe0567(0x1ee),'webhook_send',_0x557e7a,{});}}async[a57_0x4d4f3e(0x209)](_0x439d0e,_0x3c28be){const _0x2d75a3=a57_0x4d4f3e;try{const _0x59bcad={'PENDING':_0x2d75a3(0x245),'PAID':'paid','FAILED':'failed','EXPIRED':_0x2d75a3(0x223)},_0x2a3b41=_0x59bcad[_0x3c28be];if(!_0x2a3b41||_0x2a3b41==='created')return;await telegramBotService_1[_0x2d75a3(0x207)]['sendPaymentNotification'](_0x439d0e['shopId'],_0x439d0e,_0x2a3b41);}catch(_0x3b7e61){console[_0x2d75a3(0x1db)](_0x2d75a3(0x2b8),_0x3b7e61);}}async[a57_0x4d4f3e(0x1d0)](_0x48794c){const _0x35d43a=a57_0x4d4f3e;console['log'](_0x35d43a(0x203)+_0x48794c);const _0x14ca3d=await database_1['default'][_0x35d43a(0x2ae)][_0x35d43a(0x1dc)]({'where':{'id':_0x48794c},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x14ca3d)throw new Error(_0x35d43a(0x2c5));if(_0x14ca3d['gateway']!==_0x35d43a(0x211)&&_0x14ca3d['gateway']!==_0x35d43a(0x275))throw new Error('Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment');console['log'](_0x35d43a(0x231)+_0x14ca3d['gateway']+_0x35d43a(0x2bf)+_0x48794c),await this[_0x35d43a(0x2c9)](_0x14ca3d),console[_0x35d43a(0x263)](_0x35d43a(0x1e2)+_0x48794c);}[a57_0x4d4f3e(0x272)](){const _0x19105c=a57_0x4d4f3e,_0x5d12c6=this[_0x19105c(0x2b7)]?this[_0x19105c(0x25b)]:undefined,_0x1e16de=Array[_0x19105c(0x2d0)](this[_0x19105c(0x2c6)][_0x19105c(0x1d1)]())['map'](_0x2b948b=>({'paymentId':_0x2b948b[_0x19105c(0x24e)],'gatewayPaymentId':_0x2b948b['gatewayPaymentId'],'createdAt':_0x2b948b['createdAt'],'timersCount':_0x2b948b[_0x19105c(0x1eb)]['length']}));return{'isActive':!!this[_0x19105c(0x2b7)],'globalCheckIntervalMinutes':this[_0x19105c(0x25b)]/(0x3e8*0x3c),'expiryDays':this['EXPIRY_DAYS'],'activeIndividualTimers':this[_0x19105c(0x2c6)]['size'],'nextGlobalCheckIn':_0x5d12c6,'paymentTimersDetails':_0x1e16de};}[a57_0x4d4f3e(0x2aa)](_0x2df0ca){const _0x138b03=a57_0x4d4f3e,_0x5ff22=this[_0x138b03(0x2c6)]['get'](_0x2df0ca);if(_0x5ff22)return{'hasTimers':!![],'timersCount':_0x5ff22[_0x138b03(0x1eb)][_0x138b03(0x267)],'createdAt':_0x5ff22['createdAt'],'gatewayPaymentId':_0x5ff22[_0x138b03(0x28e)]};return{'hasTimers':![]};}async['getGatewayCommission'](_0x3702cc,_0x11669e){const _0x43cca0=a57_0x4d4f3e;try{const _0x508cc7=await database_1['default'][_0x43cca0(0x298)][_0x43cca0(0x1dc)]({'where':{'id':_0x3702cc},'select':{'gatewaySettings':!![]}});if(!_0x508cc7?.['gatewaySettings'])return console[_0x43cca0(0x263)]('No\x20gateway\x20settings\x20found\x20for\x20shop\x20'+_0x3702cc+_0x43cca0(0x299)),0xa;const _0x39af38=JSON[_0x43cca0(0x1f0)](_0x508cc7[_0x43cca0(0x29f)]);for(const [_0x42c872,_0x500baa]of Object['entries'](_0x39af38)){if(_0x42c872[_0x43cca0(0x261)]()===_0x11669e[_0x43cca0(0x261)]()){const _0x5b9fee=_0x500baa[_0x43cca0(0x243)]||0xa;return console[_0x43cca0(0x263)](_0x43cca0(0x2ce)+_0x11669e+'\x20commission\x20for\x20shop\x20'+_0x3702cc+':\x20'+_0x5b9fee+'%'),_0x5b9fee;}}return console[_0x43cca0(0x263)](_0x43cca0(0x281)+_0x11669e+'\x20in\x20shop\x20'+_0x3702cc+',\x20using\x20default\x2010%'),0xa;}catch(_0x1aab93){return console[_0x43cca0(0x1db)]('Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20'+_0x3702cc+_0x43cca0(0x29e)+_0x11669e+':',_0x1aab93),0xa;}}}function a57_0x429b(){const _0x4d521c=['create','createdOn','‚úÖ\x20[CHECK]\x20Payment\x20','‚è∞\x20[GLOBAL]\x20Payment\x20','‚è∞\x20[DEBUG]\x20Scheduled\x20check\x20#','checkPaymentById','values','2591968gefnow','\x20\x20\x20üìç\x20Source:\x20','Payment\x20System/1.0','forEach','getGatewayIdByName','push','464117oLqbwY','checkAllPendingPayments','defineProperty','error','findUnique','coinToPay2Service','checkPaymentStatus','14949176AUxZti','\x20with\x20status\x20','‚ùå\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','‚úÖ\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','amountAfterGatewayCommissionUSDT','-day\x20timeout','../types/gateway','type','5UXrqzv','\x20\x20\x20Amount:\x20','timestamp','coinToPayService','timers','\x20not\x20found,\x20clearing\x20timers','setDate','unknown','not\x20found','parse','description','amountUSDT',':\x20type=','ü™ô\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','./gateways/coinToPay2Service','üßπ\x20[DEBUG]\x20Cleared\x20timer\x20#','gateway','\x20marked\x20as\x20paid\x20at:\x20','digest','‚ö†Ô∏è\x20[CHECK]\x20Payment\x20','CoinToPay2Service','üìà\x20[COINTOPAY]\x20Payment\x20','\x20status\x20unchanged\x20(','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','PAID','__esModule','paymentLinkId','payment.failed','üîç\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','toFixed','update','üõë\x20[SHUTDOWN]\x20Cleared\x20','telegramBotService','getTime','sendPaymentStatusNotification','floor','SINGLE','includes','stringify','findMany','cointopay_status_check_','schedule_created','cointopay','currentPayments','‚ùå\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','size','cointopay_auto_expired','schedulePaymentChecks','\x20\x20\x20üìù\x20Context:','\x20days,\x20marking\x20as\x20EXPIRED','‚è∞\x20[GLOBAL]\x20Found\x20','\x20updated\x20successfully','webhookUrl','‚ùå\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','.\x20Remaining\x20active\x20timers:\x20','‚úÖ\x20[COINTOPAY]\x20Payment\x20link\x20','ü™ô\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','createdAt','\x20individual\x20payment\x20timers','\x20\x20\x20Amount\x20after\x20commission:\x20','expired','ü™ô\x20[GLOBAL]\x20Found\x20','üßπ\x20[CHECK]\x20Payment\x20','\x20\x20\x20-\x20GatewayPaymentId:\x20','logShopWebhookError','currency','üìä\x20[CHECK]\x20CoinToPay2\x20payment\x20','\x20commission:\x20','payment.success','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','POST','‚è∞\x20[HOURLY]\x20Payment\x20','status','\x20USDT','‚úÖ\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','iban','\x20not\x20enabled\x20for\x20shop\x20','\x20timers\x20for\x20payment\x20',',\x20stopping\x20individual\x20checks','transactionId','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','ü™ô\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','paymentLink','ü™ô\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','üìä\x20[HOURLY]\x20Payment\x20','üîç\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','stack','1955364fXuqBT','checkSinglePaymentById','üîÑ\x20[CHECK]\x20Updating\x20payment\x20','text','commission','‚ùå\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','created','\x20status\x20is\x20','ü™ô\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','settings','\x20details:','catch','‚è∞\x20[EXPIRY]\x20Payment\x20','gatewayCommissionRate','\x20\x20\x20üìÖ\x20Time:\x20','paymentId','now','‚ùå\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','\x20status:\x20','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','toISOString','amount','\x20\x20\x20-\x20Amount:\x20','\x20found:','\x20is\x20valid\x20for\x20checking,\x20proceeding...','\x20\x20\x20-\x20Gateway:\x20','\x20initial\x20timers\x20for\x20payment\x20','5\x20minutes','GLOBAL_CHECK_INTERVAL_MS','üõë\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','‚ùå\x20[CHECK]\x20Payment\x20','\x20->\x20','\x20days','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','toLowerCase','bankDetails','log','CoinToPayService','not\x20confirmed','createHmac','length','sha256','\x20triggered\x20for\x20payment\x20','gatewayOrderId','COINTOPAY_STATUS_CHANGE','‚úÖ\x20[TIMER]\x20Individual\x20check\x20#',',\x20currentPayments=','__importDefault','default','logCoinToPayError','üìä\x20[CHECK]\x20CoinToPay\x20payment\x20','getServiceStats','‚úÖ\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','‚úÖ\x20[EXPIRY]\x20Payment\x20','cointopay2','üîç\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','cointopay_status_check_error','Failed\x20to\x20mark\x20payment\x20as\x20expired','remitterIban','üìä\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','has','ü™ô\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','üìà\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','checkExpiredPayments','1\x20minute','\x20for\x20payment\x20','No\x20specific\x20commission\x20found\x20for\x20gateway\x20','\x20in\x20','Payment\x20older\x20than\x20',',\x20status=','‚úÖ\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','crypto','3195612vDAPeO','\x20completed\x20for\x20payment\x20','logCoinToPayStatus','üè¶\x20[CHECK]\x20Bank\x20details\x20provided:\x20','\x20to\x20clear','message','\x20has\x20no\x20gatewayPaymentId','gatewayPaymentId','delay','üí∞\x20[CHECK]\x20Payment\x20','webhookEvents','230577YEqBGK','\x20\x20\x20-\x20gatewayPaymentId:\x20','auto_expire','webhookLog','\x20current\x20status:\x20','CoinToPayStatusService','shop',',\x20using\x20default\x20commission\x2010%','1161844ktArRf','/status/','logShopWebhookSent','PENDING',',\x20gateway\x20','gatewaySettings','clearPaymentTimers','\x20amounts\x20calculated:','paymentDetails','‚ùå\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','status_check','paidAt','loggerService','‚úÖ\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','customerName','COMPLETED','getPaymentTimerInfo','üìä\x20[CHECK]\x20Payment\x20','hex','\x20\x20\x20üìù\x20Details:','payment','set','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','‚è∞\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','EXPIRED','delete','üßπ\x20[DEBUG]\x20Clearing\x20','EXPIRY_DAYS','coinToPayStatusService','globalCheckInterval','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','sendShopWebhook','./gateways/coinToPayService','customerEmail','\x20is\x20older\x20than\x20','currencyService','\x20has\x20no\x20gatewayPaymentId,\x20skipping','\x20payment\x20','\x20pending\x20CoinToPay\x20payments','\x20seconds\x20(','\x20\x20\x20üìä\x20Status:\x20','Shop\x20webhook\x20sent\x20to\x20','\x20is\x20too\x20new\x20(','Payment\x20not\x20found','paymentTimers','\x20status\x20from\x20','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','checkSinglePayment','orderId','payment.pending',',\x20clearing\x20individual\x20timers','\x20skipped,\x20','Gateway\x20','shopId','from','confirmedOn'];a57_0x429b=function(){return _0x4d521c;};return a57_0x429b();}exports[a57_0x4d4f3e(0x297)]=CoinToPayStatusService,exports[a57_0x4d4f3e(0x2b6)]=new CoinToPayStatusService();