'use strict';const a37_0xca77e9=a37_0x3efd;(function(_0x349428,_0x52f30d){const _0x3c3a6a=a37_0x3efd,_0x198a30=_0x349428();while(!![]){try{const _0x2c5b84=-parseInt(_0x3c3a6a(0x163))/0x1*(parseInt(_0x3c3a6a(0x1b4))/0x2)+parseInt(_0x3c3a6a(0xfe))/0x3*(parseInt(_0x3c3a6a(0x18b))/0x4)+parseInt(_0x3c3a6a(0x10a))/0x5+parseInt(_0x3c3a6a(0x169))/0x6+parseInt(_0x3c3a6a(0x174))/0x7*(-parseInt(_0x3c3a6a(0x198))/0x8)+-parseInt(_0x3c3a6a(0xee))/0x9+-parseInt(_0x3c3a6a(0x126))/0xa*(parseInt(_0x3c3a6a(0xd3))/0xb);if(_0x2c5b84===_0x52f30d)break;else _0x198a30['push'](_0x198a30['shift']());}catch(_0x332822){_0x198a30['push'](_0x198a30['shift']());}}}(a37_0x50e1,0x37082));var __createBinding=this&&this[a37_0xca77e9(0x186)]||(Object[a37_0xca77e9(0x128)]?function(_0xd7e03a,_0x321f18,_0x5d3558,_0x37958c){const _0x560935=a37_0xca77e9;if(_0x37958c===undefined)_0x37958c=_0x5d3558;var _0x3d8b90=Object[_0x560935(0x10d)](_0x321f18,_0x5d3558);(!_0x3d8b90||(_0x560935(0xe4)in _0x3d8b90?!_0x321f18[_0x560935(0x1b2)]:_0x3d8b90[_0x560935(0xdb)]||_0x3d8b90['configurable']))&&(_0x3d8b90={'enumerable':!![],'get':function(){return _0x321f18[_0x5d3558];}}),Object[_0x560935(0x1be)](_0xd7e03a,_0x37958c,_0x3d8b90);}:function(_0x1c9fae,_0x42b0b9,_0x3b489d,_0x509f37){if(_0x509f37===undefined)_0x509f37=_0x3b489d;_0x1c9fae[_0x509f37]=_0x42b0b9[_0x3b489d];}),__setModuleDefault=this&&this[a37_0xca77e9(0x199)]||(Object[a37_0xca77e9(0x128)]?function(_0x419357,_0x1c5377){const _0x4bfac2=a37_0xca77e9;Object['defineProperty'](_0x419357,_0x4bfac2(0x121),{'enumerable':!![],'value':_0x1c5377});}:function(_0x4b4710,_0x5b9e65){const _0x51f571=a37_0xca77e9;_0x4b4710[_0x51f571(0x121)]=_0x5b9e65;}),__importStar=this&&this[a37_0xca77e9(0x14a)]||(function(){var _0xb5136=function(_0x2b4bf7){return _0xb5136=Object['getOwnPropertyNames']||function(_0x204367){const _0x1406b4=a37_0x3efd;var _0x4363a5=[];for(var _0x21a27f in _0x204367)if(Object[_0x1406b4(0x12c)][_0x1406b4(0x13a)][_0x1406b4(0x134)](_0x204367,_0x21a27f))_0x4363a5[_0x4363a5['length']]=_0x21a27f;return _0x4363a5;},_0xb5136(_0x2b4bf7);};return function(_0x17a753){const _0xdb0753=a37_0x3efd;if(_0x17a753&&_0x17a753['__esModule'])return _0x17a753;var _0x1eef33={};if(_0x17a753!=null){for(var _0x1e7efa=_0xb5136(_0x17a753),_0x362ebe=0x0;_0x362ebe<_0x1e7efa[_0xdb0753(0x16a)];_0x362ebe++)if(_0x1e7efa[_0x362ebe]!==_0xdb0753(0x121))__createBinding(_0x1eef33,_0x17a753,_0x1e7efa[_0x362ebe]);}return __setModuleDefault(_0x1eef33,_0x17a753),_0x1eef33;};}()),__importDefault=this&&this[a37_0xca77e9(0x11b)]||function(_0x15f5f9){const _0x49ca85=a37_0xca77e9;return _0x15f5f9&&_0x15f5f9[_0x49ca85(0x1b2)]?_0x15f5f9:{'default':_0x15f5f9};};function a37_0x3efd(_0x1bad28,_0x314e05){const _0x50e132=a37_0x50e1();return a37_0x3efd=function(_0x3efd39,_0x5406e2){_0x3efd39=_0x3efd39-0xcc;let _0x15e741=_0x50e132[_0x3efd39];return _0x15e741;},a37_0x3efd(_0x1bad28,_0x314e05);}function a37_0x50e1(){const _0x9496c9=['1677684vmbdrm','length','startPeriodicStatusCheck','\x20\x20\x20-\x20gatewayPaymentId:\x20','currency','paymentId','❌\x20[CHECK]\x20Payment\x20','\x20days,\x20marking\x20as\x20EXPIRED','❌\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','🧹\x20[DEBUG]\x20Cleared\x20timer\x20#','💰\x20[CHECK]\x20Payment\x20','7DSYLFV','\x20\x20\x20-\x20Amount:\x20','cointopay_auto_expired','⏰\x20[DEBUG]\x20Scheduled\x20check\x20#','toISOString','PENDING','logCoinToPayStatus','webhookLog','Automatically\x20expired\x20after\x20','✅\x20[DEBUG]\x20Successfully\x20scheduled\x20','✅\x20[CHECK]\x20Payment\x20','payment.success','\x20days\x20without\x20payment\x20confirmation','Unknown\x20error','getDate','🆔\x20[CHECK]\x20Transaction\x20ID:\x20','checkExpiredPayments','sendPaymentNotification','__createBinding','.\x20Remaining\x20active\x20timers:\x20','remitterIban','\x20has\x20no\x20gatewayPaymentId','includes','7044oZmECV','settings','webhookUrl','webhook_send',',\x20clearing\x20individual\x20timers','paymentTimers','❌\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','🛑\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','clearPaymentTimers','⏰\x20[GLOBAL]\x20Payment\x20','created','auto_expire','EXPIRY_DAYS','180808BXHezy','__setModuleDefault','\x20seconds\x20(','❌\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','cointopay','shop','🪙\x20[GLOBAL]\x20Found\x20','stopPeriodicStatusCheck','\x20(age:\x20','✅\x20[EXPIRY]\x20Payment\x20','5\x20minutes','logCoinToPayError','GLOBAL_CHECK_INTERVAL_MS','🔍\x20[CHECK]\x20Checking\x20CoinToPay\x20payment\x20','gateway','findUnique','PAID','\x20is\x20older\x20than\x20','⚠️\x20[CHECK]\x20Payment\x20','push','✅\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','\x20\x20\x20❌\x20Error:\x20','sendShopWebhook','\x20days','transactionId','\x20updated\x20successfully','__esModule','update','456132kixAWa','✅\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','set','confirmedOn','createdAt','\x20to\x20','🪙\x20[TIMER]\x20Individual\x20check\x20#','./paymentLinkService','\x20is\x20valid\x20for\x20checking,\x20proceeding...','coinToPayStatusService','defineProperty','⏰\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','\x20\x20\x20-\x20paymentId:\x20','not\x20found','\x20pending\x20CoinToPay\x20payments','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','❌\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','\x20triggered\x20for\x20payment\x20','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20',',\x20stopping\x20individual\x20checks','✅\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','\x20is\x20too\x20new\x20(','\x20to\x20clear','27214Hvyqyw','✅\x20[TIMER]\x20Individual\x20check\x20#','payment','⏰\x20[HOURLY]\x20Payment\x20','size','\x20status\x20changed\x20to\x20','1\x20minute','TesSoft\x20Payment\x20System/1.0','writable','then','toLowerCase','unknown','Payment\x20is\x20not\x20a\x20CoinToPay\x20payment','createdOn','✅\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20CoinToPay\x20payment\x20','expired','ms)','get','\x20days\x20(created\x20before\x20','resolve','0100','payment.failed','\x20not\x20found,\x20clearing\x20timers','coinToPayService','schedulePaymentChecks','logShopWebhookError','status_check','2715075ioQHNQ','delete','📊\x20[HOURLY]\x20Payment\x20','Shop\x20webhook\x20sent\x20to\x20','log','now','logShopWebhookSent','⚠️\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','\x20initial\x20timers\x20for\x20payment\x20','../config/database','📊\x20[CHECK]\x20Payment\x20','floor','🪙\x20[ERROR]\x20CoinToPay\x20Error:\x20','POST','status','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','618RYHkPV','\x20\x20\x20-\x20Gateway:\x20','catch','error','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','orderId','\x20not\x20found\x20in\x20database','customerName','logWhiteDomainError','getTime','checkSinglePayment','🏦\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes','1381950Bficex','🧹\x20[DEBUG]\x20Clearing\x20','2\x20minutes','getOwnPropertyDescriptor','paymentDetails','stack','schedule_created','\x20status\x20is\x20','customerEmail','✅\x20[HOURLY]\x20Payment\x20','✅\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','\x20has\x20no\x20gatewayPaymentId,\x20skipping','failed','\x20timers\x20for\x20payment\x20','payment.pending','🛑\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','timers','__importDefault','stringify','\x20with\x20status\x20','getServiceStats','⏰\x20[GLOBAL]\x20Found\x20','adminNotes','default','not\x20confirmed','\x20expired\x20CoinToPay\x20payments','shopId','-day\x20timeout','570mCLAOO','\x20is\x20not\x20a\x20CoinToPay\x20payment\x20(gateway:\x20','create','\x20\x20\x20📅\x20Time:\x20','gatewayOrderId','map','prototype','\x20for\x20payment\x20','description','message','\x20status\x20unchanged\x20(','\x20expired','sendPaymentStatusNotification','amount','call','Payment\x20older\x20than\x20','✅\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','\x20not\x20enabled\x20for\x20shop\x20','\x20(after\x20','Payment\x20not\x20found','hasOwnProperty','toFixed','paidAt','\x20in\x20','🪙\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','getPaymentTimerInfo','🔍\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','\x20\x20\x20-\x20GatewayPaymentId:\x20','application/json','🔍\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','🔍\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','\x20skipped,\x20','🧹\x20[CHECK]\x20Payment\x20','CoinToPayStatusService','📈\x20[CHECK]\x20Payment\x20link\x20counter\x20updated\x20for\x20payment\x20','checkAllPendingPayments','__importStar','EXPIRED','\x20\x20\x20📝\x20Details:','📊\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','\x20\x20\x20📝\x20Context:','timestamp','\x20\x20\x20📍\x20Source:\x20','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','cointopay_status_check_','🪙\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','loggerService','🔄\x20[CHECK]\x20Updating\x20payment\x20','🪙\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','🪙\x20[DEBUG]\x20Creating\x20','COINTOPAY_ERROR','globalCheckInterval','🪙\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','./telegramBotService','\x20completed\x20for\x20payment\x20','cointopay_status_check_error','bankDetails','⏰\x20[EXPIRY]\x20Payment\x20','gatewayPaymentId','iban','1eEFFdj','delay','paid','telegramBotService','\x20found:','has'];a37_0x50e1=function(){return _0x9496c9;};return a37_0x50e1();}Object[a37_0xca77e9(0x1be)](exports,a37_0xca77e9(0x1b2),{'value':!![]}),exports[a37_0xca77e9(0x1bd)]=exports[a37_0xca77e9(0x147)]=void 0x0;const coinToPayService_1=require('./gateways/coinToPayService'),database_1=__importDefault(require(a37_0xca77e9(0xf7))),telegramBotService_1=require(a37_0xca77e9(0x15c)),loggerService_1=require('./loggerService');class CoinToPayStatusService{constructor(){const _0x293827=a37_0xca77e9;this[_0x293827(0x15a)]=null,this[_0x293827(0x1a4)]=0x3c*0x3c*0x3e8,this[_0x293827(0x197)]=0x5,this[_0x293827(0x190)]=new Map(),this['coinToPayService']=new coinToPayService_1['CoinToPayService'](),console['log']('🪙\x20CoinToPayStatusService\x20initialized');}[a37_0xca77e9(0xeb)](_0x31ef3a,_0x50c503){const _0x381a1d=a37_0xca77e9;console[_0x381a1d(0xf2)](_0x381a1d(0x157)),console[_0x381a1d(0xf2)](_0x381a1d(0x1c0)+_0x31ef3a),console[_0x381a1d(0xf2)](_0x381a1d(0x16c)+_0x50c503),this[_0x381a1d(0x193)](_0x31ef3a);const _0x779cf4=[],_0x26f4b0=new Date(),_0x2b772b=[{'delay':0x1*0x3c*0x3e8,'description':_0x381a1d(0xd9)},{'delay':0x2*0x3c*0x3e8,'description':_0x381a1d(0x10c)},{'delay':0x5*0x3c*0x3e8,'description':_0x381a1d(0x1a2)},{'delay':0x5*0x3c*0x3e8,'description':_0x381a1d(0x1a2)}];console[_0x381a1d(0xf2)](_0x381a1d(0x158)+_0x2b772b[_0x381a1d(0x16a)]+_0x381a1d(0xf6)+_0x31ef3a);let _0x23c4d0=0x0;_0x2b772b['forEach']((_0x48fe5d,_0x2943bb)=>{const _0x5b9fa6=_0x381a1d;_0x23c4d0+=_0x48fe5d[_0x5b9fa6(0x164)];const _0x107777=setTimeout(async()=>{const _0xdeb1f9=_0x5b9fa6;console[_0xdeb1f9(0xf2)](_0xdeb1f9(0x1ba)+(_0x2943bb+0x1)+_0xdeb1f9(0xcd)+_0x31ef3a+_0xdeb1f9(0x138)+_0x48fe5d[_0xdeb1f9(0x12e)]+')');try{await this['checkSinglePaymentById'](_0x31ef3a),console[_0xdeb1f9(0xf2)](_0xdeb1f9(0xd4)+(_0x2943bb+0x1)+_0xdeb1f9(0x15d)+_0x31ef3a);}catch(_0x2d1f4c){console['error']('❌\x20[TIMER]\x20Failed\x20individual\x20check\x20#'+(_0x2943bb+0x1)+_0xdeb1f9(0x12d)+_0x31ef3a+':',_0x2d1f4c),this['logCoinToPayError'](_0x31ef3a,_0x50c503,_0x2d1f4c,_0xdeb1f9(0xed),{'checkNumber':_0x2943bb+0x1,'scheduledAfter':_0x48fe5d[_0xdeb1f9(0x12e)],'isIndividualCheck':!![]});}},_0x23c4d0);_0x779cf4['push'](_0x107777),console['log'](_0x5b9fa6(0x177)+(_0x2943bb+0x1)+_0x5b9fa6(0x12d)+_0x31ef3a+_0x5b9fa6(0x13d)+_0x23c4d0/0x3e8+_0x5b9fa6(0x19a)+_0x48fe5d[_0x5b9fa6(0x12e)]+')');});const _0x2c986b=setInterval(async()=>{const _0x50d05c=_0x381a1d;console[_0x50d05c(0xf2)]('🪙\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20'+_0x31ef3a);try{const _0x4d32b1=await database_1['default'][_0x50d05c(0xd5)][_0x50d05c(0x1a7)]({'where':{'id':_0x31ef3a},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x4d32b1){console['log']('❌\x20[HOURLY]\x20Payment\x20'+_0x31ef3a+_0x50d05c(0xe9)),this[_0x50d05c(0x193)](_0x31ef3a);return;}console[_0x50d05c(0xf2)](_0x50d05c(0xf0)+_0x31ef3a+'\x20current\x20status:\x20'+_0x4d32b1[_0x50d05c(0xfc)]);if(_0x4d32b1[_0x50d05c(0xfc)]!==_0x50d05c(0x179)){console[_0x50d05c(0xf2)](_0x50d05c(0x113)+_0x31ef3a+_0x50d05c(0x111)+_0x4d32b1['status']+_0x50d05c(0xcf)),this[_0x50d05c(0x193)](_0x31ef3a);return;}const _0x42d9a0=Math['floor']((Date[_0x50d05c(0xf3)]()-_0x4d32b1[_0x50d05c(0x1b8)][_0x50d05c(0x107)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x42d9a0>=this['EXPIRY_DAYS']){console[_0x50d05c(0xf2)](_0x50d05c(0xd6)+_0x31ef3a+_0x50d05c(0x1a9)+this[_0x50d05c(0x197)]+_0x50d05c(0x14e)),this[_0x50d05c(0x193)](_0x31ef3a);return;}await this['checkSinglePaymentById'](_0x31ef3a),console[_0x50d05c(0xf2)](_0x50d05c(0xd0)+_0x31ef3a);}catch(_0x4a668c){console[_0x50d05c(0x101)]('❌\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20'+_0x31ef3a+':',_0x4a668c),this['logCoinToPayError'](_0x31ef3a,_0x50c503,_0x4a668c,_0x50d05c(0xed),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x779cf4[_0x381a1d(0x1ab)](_0x2c986b),this[_0x381a1d(0x190)][_0x381a1d(0x1b6)](_0x31ef3a,{'timers':_0x779cf4,'paymentId':_0x31ef3a,'gatewayPaymentId':_0x50c503,'createdAt':_0x26f4b0}),console[_0x381a1d(0xf2)](_0x381a1d(0x17d)+_0x2b772b[_0x381a1d(0x16a)]+_0x381a1d(0xce)+_0x31ef3a),console[_0x381a1d(0xf2)](_0x381a1d(0x14d)+this[_0x381a1d(0x190)][_0x381a1d(0xd7)]),this[_0x381a1d(0x17a)](_0x31ef3a,_0x50c503,'PENDING',_0x381a1d(0x179),_0x381a1d(0xed),{'action':_0x381a1d(0x110),'scheduledChecks':_0x2b772b['length'],'firstCheckIn':_0x2b772b[0x0][_0x381a1d(0x164)]/0x3e8,'totalTimers':this[_0x381a1d(0x190)][_0x381a1d(0xd7)]});}[a37_0xca77e9(0x193)](_0x29a4ff){const _0x49bf9d=a37_0xca77e9,_0x4ac8a7=this[_0x49bf9d(0x190)][_0x49bf9d(0xe4)](_0x29a4ff);_0x4ac8a7?(console[_0x49bf9d(0xf2)](_0x49bf9d(0x10b)+_0x4ac8a7[_0x49bf9d(0x11a)]['length']+_0x49bf9d(0x117)+_0x29a4ff),_0x4ac8a7[_0x49bf9d(0x11a)]['forEach']((_0x3f1135,_0x642917)=>{const _0x17afb5=_0x49bf9d;_0x3f1135&&(clearTimeout(_0x3f1135),clearInterval(_0x3f1135),console['log'](_0x17afb5(0x172)+(_0x642917+0x1)+'\x20for\x20payment\x20'+_0x29a4ff));}),this['paymentTimers'][_0x49bf9d(0xef)](_0x29a4ff),console['log'](_0x49bf9d(0x1ac)+_0x29a4ff+_0x49bf9d(0x187)+this['paymentTimers'][_0x49bf9d(0xd7)])):console[_0x49bf9d(0xf2)](_0x49bf9d(0xf5)+_0x29a4ff+_0x49bf9d(0xd2));}async['checkSinglePaymentById'](_0xdce65d){const _0x529683=a37_0xca77e9;console[_0x529683(0xf2)](_0x529683(0x140)+_0xdce65d);const _0x16e914=await database_1[_0x529683(0x121)][_0x529683(0xd5)][_0x529683(0x1a7)]({'where':{'id':_0xdce65d},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x16e914){console[_0x529683(0xf2)](_0x529683(0x16f)+_0xdce65d+_0x529683(0x104));return;}console[_0x529683(0xf2)](_0x529683(0xf8)+_0xdce65d+_0x529683(0x167)),console[_0x529683(0xf2)](_0x529683(0xff)+_0x16e914[_0x529683(0x1a6)]),console[_0x529683(0xf2)]('\x20\x20\x20-\x20Status:\x20'+_0x16e914[_0x529683(0xfc)]),console[_0x529683(0xf2)](_0x529683(0x141)+_0x16e914[_0x529683(0x161)]),console['log'](_0x529683(0x175)+_0x16e914[_0x529683(0x133)]+'\x20'+_0x16e914[_0x529683(0x16d)]),console[_0x529683(0xf2)]('\x20\x20\x20-\x20ShopId:\x20'+_0x16e914[_0x529683(0x124)]);if(_0x16e914[_0x529683(0x1a6)]!==_0x529683(0x19c)){console[_0x529683(0xf2)](_0x529683(0x1aa)+_0xdce65d+_0x529683(0x127)+_0x16e914[_0x529683(0x1a6)]+')');return;}if(_0x16e914[_0x529683(0xfc)]!=='PENDING'){console[_0x529683(0xf2)]('⚠️\x20[CHECK]\x20Payment\x20'+_0xdce65d+_0x529683(0x111)+_0x16e914[_0x529683(0xfc)]+_0x529683(0xcf)),this['clearPaymentTimers'](_0xdce65d);return;}if(!_0x16e914[_0x529683(0x161)]){console[_0x529683(0xf2)](_0x529683(0x1aa)+_0xdce65d+_0x529683(0x189));return;}console[_0x529683(0xf2)](_0x529683(0x17e)+_0xdce65d+_0x529683(0x1bc)),await this[_0x529683(0x108)](_0x16e914);}['logCoinToPayStatus'](_0x4de8a,_0x33f409,_0x2bce7a,_0x360f87,_0x5318ab,_0x4945f1){const _0x3a040a=a37_0xca77e9,_0x50a25b={'type':'COINTOPAY_STATUS_CHANGE','paymentId':_0x4de8a,'gatewayPaymentId':_0x33f409,'oldStatus':_0x2bce7a,'newStatus':_0x360f87,'source':_0x5318ab,'timestamp':new Date()[_0x3a040a(0x178)](),'details':_0x4945f1||{}};loggerService_1[_0x3a040a(0x155)][_0x3a040a(0x17a)](_0x50a25b),console[_0x3a040a(0xf2)]('🪙\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20'+_0x4de8a+'\x20('+_0x33f409+')'),console[_0x3a040a(0xf2)]('\x20\x20\x20📊\x20Status:\x20'+_0x2bce7a+'\x20->\x20'+_0x360f87),console['log'](_0x3a040a(0x151)+_0x5318ab),console['log']('\x20\x20\x20📅\x20Time:\x20'+_0x50a25b[_0x3a040a(0x150)]),_0x4945f1&&console['log'](_0x3a040a(0x14c),_0x4945f1);}[a37_0xca77e9(0x1a3)](_0x1cceac,_0x515d2d,_0xdf7f5,_0x575b11,_0x4c36db){const _0x3a19ad=a37_0xca77e9,_0x28a085={'type':_0x3a19ad(0x159),'paymentId':_0x1cceac,'gatewayPaymentId':_0x515d2d,'error':_0xdf7f5 instanceof Error?{'message':_0xdf7f5[_0x3a19ad(0x12f)],'stack':_0xdf7f5[_0x3a19ad(0x10f)]}:_0xdf7f5,'source':_0x575b11,'timestamp':new Date()[_0x3a19ad(0x178)](),'context':_0x4c36db||{}};loggerService_1[_0x3a19ad(0x155)][_0x3a19ad(0x1a3)](_0x28a085),console[_0x3a19ad(0x101)](_0x3a19ad(0xfa)+_0x1cceac+'\x20('+_0x515d2d+')'),console[_0x3a19ad(0x101)](_0x3a19ad(0x1ad)+(_0xdf7f5 instanceof Error?_0xdf7f5[_0x3a19ad(0x12f)]:_0xdf7f5)),console[_0x3a19ad(0x101)]('\x20\x20\x20📍\x20Source:\x20'+_0x575b11),console[_0x3a19ad(0x101)](_0x3a19ad(0x129)+_0x28a085[_0x3a19ad(0x150)]),_0x4c36db&&console[_0x3a19ad(0x101)](_0x3a19ad(0x14f),_0x4c36db);}[a37_0xca77e9(0x16b)](){const _0x5f09d6=a37_0xca77e9;console[_0x5f09d6(0xf2)](_0x5f09d6(0x13e)),this[_0x5f09d6(0x149)]()[_0x5f09d6(0x100)](_0x2ede8d=>{const _0x220e35=_0x5f09d6;console[_0x220e35(0x101)]('❌\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:',_0x2ede8d);}),this[_0x5f09d6(0x15a)]=setInterval(async()=>{const _0x158621=_0x5f09d6;try{console['log']('🪙\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...'),await this[_0x158621(0x149)](),console[_0x158621(0xf2)](_0x158621(0x1b5));}catch(_0x15e298){console[_0x158621(0x101)](_0x158621(0x171),_0x15e298);}},this[_0x5f09d6(0x1a4)]),console[_0x5f09d6(0xf2)](_0x5f09d6(0x114));}[a37_0xca77e9(0x19f)](){const _0x19cd40=a37_0xca77e9;console[_0x19cd40(0xf2)](_0x19cd40(0x192));this[_0x19cd40(0x15a)]&&(clearInterval(this[_0x19cd40(0x15a)]),this[_0x19cd40(0x15a)]=null,console[_0x19cd40(0xf2)](_0x19cd40(0x119)));const _0x2edab8=this[_0x19cd40(0x190)][_0x19cd40(0xd7)];for(const [_0x5421bd]of this[_0x19cd40(0x190)]){this['clearPaymentTimers'](_0x5421bd);}console[_0x19cd40(0xf2)]('🛑\x20[SHUTDOWN]\x20Cleared\x20'+_0x2edab8+'\x20individual\x20payment\x20timers');}async['checkAllPendingPayments'](){const _0x5b602e=a37_0xca77e9;try{console['log'](_0x5b602e(0x15b));const _0x528509=await database_1['default'][_0x5b602e(0xd5)]['findMany']({'where':{'gateway':_0x5b602e(0x19c),'status':_0x5b602e(0x179),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console['log'](_0x5b602e(0x19e)+_0x528509[_0x5b602e(0x16a)]+_0x5b602e(0x1c2));if(_0x528509[_0x5b602e(0x16a)]===0x0){console['log'](_0x5b602e(0x154));return;}const _0x519821=await this[_0x5b602e(0x184)](_0x528509);console[_0x5b602e(0xf2)](_0x5b602e(0x11f)+_0x519821[_0x5b602e(0x16a)]+_0x5b602e(0x123));let _0x55f2e3=0x0,_0x13da2a=0x0;for(const _0x2724e7 of _0x528509){try{if(_0x519821['includes'](_0x2724e7['id'])){console['log'](_0x5b602e(0x194)+_0x2724e7['id']+_0x5b602e(0xfd)),_0x13da2a++;continue;}if(this[_0x5b602e(0x190)][_0x5b602e(0x168)](_0x2724e7['id'])){console[_0x5b602e(0xf2)]('⏰\x20[GLOBAL]\x20Payment\x20'+_0x2724e7['id']+'\x20has\x20individual\x20timers,\x20skipping\x20global\x20check'),_0x13da2a++;continue;}const _0x408d3e=(Date['now']()-_0x2724e7[_0x5b602e(0x1b8)]['getTime']())/(0x3e8*0x3c*0x3c);if(_0x408d3e<0x1){console[_0x5b602e(0xf2)](_0x5b602e(0x194)+_0x2724e7['id']+_0x5b602e(0xd1)+_0x408d3e[_0x5b602e(0x13b)](0x1)+'h),\x20skipping\x20global\x20check'),_0x13da2a++;continue;}console['log'](_0x5b602e(0x143)+_0x2724e7['id']+_0x5b602e(0x1a0)+_0x408d3e[_0x5b602e(0x13b)](0x1)+'h)'),await this['checkSinglePayment'](_0x2724e7),_0x55f2e3++,await new Promise(_0x1790f0=>setTimeout(_0x1790f0,0x7d0));}catch(_0x5eab5d){console[_0x5b602e(0x101)](_0x5b602e(0xcc)+_0x2724e7['id']+':',_0x5eab5d),this['logCoinToPayError'](_0x2724e7['id'],_0x2724e7['gatewayPaymentId']||_0x5b602e(0xde),_0x5eab5d,_0x5b602e(0xed),{'isGlobalCheck':!![],'paymentAmount':_0x2724e7[_0x5b602e(0x133)],'paymentCurrency':_0x2724e7[_0x5b602e(0x16d)],'shopId':_0x2724e7[_0x5b602e(0x124)],'createdAt':_0x2724e7[_0x5b602e(0x1b8)]}),loggerService_1['loggerService'][_0x5b602e(0x106)](_0x5b602e(0x19c),'/status/'+_0x2724e7[_0x5b602e(0x161)],_0x5eab5d);}}console['log'](_0x5b602e(0x136)+_0x55f2e3+'\x20checked,\x20'+_0x13da2a+_0x5b602e(0x145)+_0x519821['length']+_0x5b602e(0x131));}catch(_0x2f48af){console[_0x5b602e(0x101)](_0x5b602e(0x19b),_0x2f48af);}}async[a37_0xca77e9(0x184)](_0x3dc750){const _0xf46ef5=a37_0xca77e9,_0x29b5c7=[],_0x8485c1=new Date();_0x8485c1['setDate'](_0x8485c1[_0xf46ef5(0x182)]()-this[_0xf46ef5(0x197)]),console[_0xf46ef5(0xf2)](_0xf46ef5(0x1bf)+this[_0xf46ef5(0x197)]+_0xf46ef5(0xe5)+_0x8485c1['toISOString']()+')');for(const _0x25fcd0 of _0x3dc750){if(_0x25fcd0['createdAt']<_0x8485c1){console[_0xf46ef5(0xf2)](_0xf46ef5(0x160)+_0x25fcd0['id']+_0xf46ef5(0x1a9)+this[_0xf46ef5(0x197)]+_0xf46ef5(0x170));try{this[_0xf46ef5(0x17a)](_0x25fcd0['id'],_0x25fcd0[_0xf46ef5(0x161)]||'unknown',_0xf46ef5(0x179),'EXPIRED',_0xf46ef5(0x196),{'reason':_0xf46ef5(0x135)+this[_0xf46ef5(0x197)]+'\x20days','createdAt':_0x25fcd0['createdAt'],'daysSinceCreation':Math[_0xf46ef5(0xf9)]((Date[_0xf46ef5(0xf3)]()-_0x25fcd0['createdAt'][_0xf46ef5(0x107)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x25fcd0['amount'],'paymentCurrency':_0x25fcd0[_0xf46ef5(0x16d)],'shopId':_0x25fcd0[_0xf46ef5(0x124)]}),await database_1[_0xf46ef5(0x121)]['payment'][_0xf46ef5(0x1b3)]({'where':{'id':_0x25fcd0['id']},'data':{'status':_0xf46ef5(0x14b),'updatedAt':new Date(),'adminNotes':_0xf46ef5(0x17c)+this[_0xf46ef5(0x197)]+_0xf46ef5(0x180)}}),await database_1[_0xf46ef5(0x121)][_0xf46ef5(0x17b)][_0xf46ef5(0x128)]({'data':{'paymentId':_0x25fcd0['id'],'shopId':_0x25fcd0[_0xf46ef5(0x124)],'event':_0xf46ef5(0x176),'statusCode':0xc8,'responseBody':JSON['stringify']({'reason':'Payment\x20older\x20than\x20'+this[_0xf46ef5(0x197)]+_0xf46ef5(0x1af),'createdAt':_0x25fcd0[_0xf46ef5(0x1b8)],'expiredAt':new Date()[_0xf46ef5(0x178)](),'daysSinceCreation':Math['floor']((Date['now']()-_0x25fcd0[_0xf46ef5(0x1b8)][_0xf46ef5(0x107)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0xf46ef5(0x1ae)](_0x25fcd0,'EXPIRED'),await this['sendPaymentStatusNotification'](_0x25fcd0,_0xf46ef5(0x14b)),this[_0xf46ef5(0x193)](_0x25fcd0['id']),_0x29b5c7[_0xf46ef5(0x1ab)](_0x25fcd0['id']),console[_0xf46ef5(0xf2)](_0xf46ef5(0x1a1)+_0x25fcd0['id']+_0xf46ef5(0x1c3)+this[_0xf46ef5(0x197)]+_0xf46ef5(0x125));}catch(_0x6efa72){console[_0xf46ef5(0x101)](_0xf46ef5(0x191)+_0x25fcd0['id']+':',_0x6efa72),this[_0xf46ef5(0x1a3)](_0x25fcd0['id'],_0x25fcd0['gatewayPaymentId']||_0xf46ef5(0xde),_0x6efa72,_0xf46ef5(0x196),{'reason':'Failed\x20to\x20mark\x20payment\x20as\x20expired','createdAt':_0x25fcd0[_0xf46ef5(0x1b8)],'daysSinceCreation':Math[_0xf46ef5(0xf9)]((Date[_0xf46ef5(0xf3)]()-_0x25fcd0[_0xf46ef5(0x1b8)][_0xf46ef5(0x107)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x29b5c7;}async[a37_0xca77e9(0x108)](_0x23536a){const _0x3b35bb=a37_0xca77e9;if(!_0x23536a['gatewayPaymentId']){console[_0x3b35bb(0xf2)]('⚠️\x20[CHECK]\x20Payment\x20'+_0x23536a['id']+_0x3b35bb(0x115));return;}console[_0x3b35bb(0xf2)](_0x3b35bb(0x1a5)+_0x23536a['id']+'\x20('+_0x23536a[_0x3b35bb(0x161)]+')');try{const _0x13c933=await this[_0x3b35bb(0xea)]['checkPaymentStatus'](_0x23536a[_0x3b35bb(0x161)]);console[_0x3b35bb(0xf2)](_0x3b35bb(0xf8)+_0x23536a['id']+'\x20status:\x20'+_0x13c933[_0x3b35bb(0xfc)]);_0x13c933[_0x3b35bb(0x10e)]&&console[_0x3b35bb(0xf2)](_0x3b35bb(0xf8)+_0x23536a['id']+'\x20details:',{'iban':_0x13c933[_0x3b35bb(0x10e)][_0x3b35bb(0x162)]||_0x3b35bb(0x1c1),'transactionId':_0x13c933[_0x3b35bb(0x10e)][_0x3b35bb(0x1b0)],'createdOn':_0x13c933[_0x3b35bb(0x10e)][_0x3b35bb(0xe0)],'confirmedOn':_0x13c933[_0x3b35bb(0x10e)][_0x3b35bb(0x1b7)]||_0x3b35bb(0x122)});if(_0x13c933[_0x3b35bb(0xfc)]!==_0x23536a[_0x3b35bb(0xfc)]){console['log'](_0x3b35bb(0x156)+_0x23536a['id']+'\x20status\x20from\x20'+_0x23536a[_0x3b35bb(0xfc)]+_0x3b35bb(0x1b9)+_0x13c933['status']),this[_0x3b35bb(0x17a)](_0x23536a['id'],_0x23536a[_0x3b35bb(0x161)],_0x23536a[_0x3b35bb(0xfc)],_0x13c933[_0x3b35bb(0xfc)],_0x3b35bb(0xed),{'paymentDetails':_0x13c933[_0x3b35bb(0x10e)],'amount':_0x13c933[_0x3b35bb(0x133)],'currency':_0x13c933[_0x3b35bb(0x16d)],'shopId':_0x23536a[_0x3b35bb(0x124)],'checkTimestamp':new Date()[_0x3b35bb(0x178)]()});const _0x5e9d76={'status':_0x13c933[_0x3b35bb(0xfc)],'updatedAt':new Date()};_0x13c933[_0x3b35bb(0xfc)]===_0x3b35bb(0x1a8)&&_0x23536a[_0x3b35bb(0xfc)]!==_0x3b35bb(0x1a8)&&(_0x5e9d76[_0x3b35bb(0x13c)]=new Date(),console[_0x3b35bb(0xf2)](_0x3b35bb(0x173)+_0x23536a['id']+'\x20marked\x20as\x20paid\x20at:\x20'+_0x5e9d76[_0x3b35bb(0x13c)][_0x3b35bb(0x178)]()));if(_0x13c933[_0x3b35bb(0x10e)]){const _0x352476=_0x13c933['paymentDetails'];_0x352476[_0x3b35bb(0x162)]&&(_0x5e9d76[_0x3b35bb(0x188)]=_0x352476['iban'],console['log']('🏦\x20[CHECK]\x20Saved\x20IBAN:\x20'+_0x352476[_0x3b35bb(0x162)]));if(_0x352476[_0x3b35bb(0x15f)]){const _0x34421b=_0x23536a[_0x3b35bb(0x120)]||'',_0x16f369='Bank\x20Details:\x20'+_0x352476[_0x3b35bb(0x15f)];_0x5e9d76[_0x3b35bb(0x120)]=_0x34421b?_0x34421b+'\x0a\x0a'+_0x16f369:_0x16f369,console['log'](_0x3b35bb(0x109));}_0x352476[_0x3b35bb(0x1b0)]&&console[_0x3b35bb(0xf2)](_0x3b35bb(0x183)+_0x352476[_0x3b35bb(0x1b0)]),_0x352476[_0x3b35bb(0x1b7)]&&console[_0x3b35bb(0xf2)]('✅\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20'+_0x352476[_0x3b35bb(0x1b7)]);}await database_1[_0x3b35bb(0x121)][_0x3b35bb(0xd5)][_0x3b35bb(0x1b3)]({'where':{'id':_0x23536a['id']},'data':_0x5e9d76}),await database_1[_0x3b35bb(0x121)][_0x3b35bb(0x17b)][_0x3b35bb(0x128)]({'data':{'paymentId':_0x23536a['id'],'shopId':_0x23536a[_0x3b35bb(0x124)],'event':_0x3b35bb(0x153)+_0x13c933[_0x3b35bb(0xfc)]['toLowerCase'](),'statusCode':0xc8,'responseBody':JSON[_0x3b35bb(0x11c)]({'oldStatus':_0x23536a[_0x3b35bb(0xfc)],'newStatus':_0x13c933[_0x3b35bb(0xfc)],'paymentDetails':_0x13c933[_0x3b35bb(0x10e)],'checkedAt':new Date()[_0x3b35bb(0x178)]()})}}),await this[_0x3b35bb(0x1ae)](_0x23536a,_0x13c933[_0x3b35bb(0xfc)]),await this[_0x3b35bb(0x132)](_0x23536a,_0x13c933[_0x3b35bb(0xfc)]);if(_0x13c933['status']==='PAID'&&_0x23536a[_0x3b35bb(0xfc)]!==_0x3b35bb(0x1a8))try{const {PaymentLinkService:_0x22bc9c}=await Promise[_0x3b35bb(0xe6)]()[_0x3b35bb(0xdc)](()=>__importStar(require(_0x3b35bb(0x1bb)))),_0x273121=new _0x22bc9c();await _0x273121['handleSuccessfulPayment'](_0x23536a['id']),console[_0x3b35bb(0xf2)](_0x3b35bb(0x148)+_0x23536a['id']);}catch(_0x402807){console[_0x3b35bb(0x101)]('❌\x20[CHECK]\x20Failed\x20to\x20update\x20payment\x20link\x20counter\x20for\x20payment\x20'+_0x23536a['id']+':',_0x402807);}_0x13c933['status']!==_0x3b35bb(0x179)&&(console['log'](_0x3b35bb(0x146)+_0x23536a['id']+_0x3b35bb(0xd8)+_0x13c933[_0x3b35bb(0xfc)]+_0x3b35bb(0x18f)),this[_0x3b35bb(0x193)](_0x23536a['id'])),console[_0x3b35bb(0xf2)](_0x3b35bb(0x17e)+_0x23536a['id']+_0x3b35bb(0x1b1));}else console[_0x3b35bb(0xf2)](_0x3b35bb(0xf8)+_0x23536a['id']+_0x3b35bb(0x130)+_0x13c933[_0x3b35bb(0xfc)]+')'),this[_0x3b35bb(0x17a)](_0x23536a['id'],_0x23536a[_0x3b35bb(0x161)],_0x23536a[_0x3b35bb(0xfc)],_0x13c933[_0x3b35bb(0xfc)],_0x3b35bb(0xed),{'statusUnchanged':!![],'paymentDetails':_0x13c933[_0x3b35bb(0x10e)],'amount':_0x13c933[_0x3b35bb(0x133)],'currency':_0x13c933['currency'],'shopId':_0x23536a['shopId'],'checkTimestamp':new Date()[_0x3b35bb(0x178)]()});}catch(_0x5cc33c){console[_0x3b35bb(0x101)]('❌\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20'+_0x23536a['id']+':',_0x5cc33c),this[_0x3b35bb(0x1a3)](_0x23536a['id'],_0x23536a['gatewayPaymentId'],_0x5cc33c,'status_check',{'paymentAmount':_0x23536a[_0x3b35bb(0x133)],'paymentCurrency':_0x23536a[_0x3b35bb(0x16d)],'shopId':_0x23536a[_0x3b35bb(0x124)],'createdAt':_0x23536a['createdAt']}),await database_1[_0x3b35bb(0x121)]['webhookLog'][_0x3b35bb(0x128)]({'data':{'paymentId':_0x23536a['id'],'shopId':_0x23536a[_0x3b35bb(0x124)],'event':_0x3b35bb(0x15e),'statusCode':0x1f4,'responseBody':JSON['stringify']({'error':_0x5cc33c instanceof Error?_0x5cc33c[_0x3b35bb(0x12f)]:_0x3b35bb(0x181),'gatewayPaymentId':_0x23536a[_0x3b35bb(0x161)],'checkedAt':new Date()['toISOString']()})}});}}async[a37_0xca77e9(0x1ae)](_0x19da49,_0x3c3037){const _0x5e5b10=a37_0xca77e9,_0x3f86da=Date[_0x5e5b10(0xf3)]();try{const _0x556727=_0x19da49['shop'],_0x47eff9=_0x556727[_0x5e5b10(0x18c)];if(!_0x47eff9?.[_0x5e5b10(0x18d)]){console['log'](_0x5e5b10(0x102)+_0x556727['id']);return;}const _0x3f78a6=_0x3c3037==='PAID'?_0x5e5b10(0x17f):_0x3c3037==='FAILED'?_0x5e5b10(0xe8):_0x3c3037===_0x5e5b10(0x14b)?_0x5e5b10(0xe8):_0x5e5b10(0x118);if(!_0x47eff9['webhookEvents']?.[_0x5e5b10(0x18a)](_0x3f78a6)){console[_0x5e5b10(0xf2)]('Webhook\x20event\x20'+_0x3f78a6+_0x5e5b10(0x137)+_0x556727['id']);return;}const _0x3e7af9={'event':_0x3f78a6,'payment':{'id':_0x19da49['id'],'order_id':_0x19da49[_0x5e5b10(0x103)],'gateway_order_id':_0x19da49[_0x5e5b10(0x12a)],'gateway':_0x5e5b10(0xe7),'amount':_0x19da49[_0x5e5b10(0x133)],'currency':_0x19da49[_0x5e5b10(0x16d)],'status':_0x3c3037[_0x5e5b10(0xdd)](),'customer_email':_0x19da49[_0x5e5b10(0x112)],'customer_name':_0x19da49[_0x5e5b10(0x105)],'created_at':_0x19da49[_0x5e5b10(0x1b8)],'updated_at':new Date()}},_0xc53081=await fetch(_0x47eff9[_0x5e5b10(0x18d)],{'method':_0x5e5b10(0xfb),'headers':{'Content-Type':_0x5e5b10(0x142),'User-Agent':_0x5e5b10(0xda)},'body':JSON['stringify'](_0x3e7af9)}),_0x3a6fb3=Date[_0x5e5b10(0xf3)]()-_0x3f86da,_0x12c2a8=_0xc53081['ok']?'Success':await _0xc53081['text']();loggerService_1['loggerService'][_0x5e5b10(0xf4)](_0x19da49[_0x5e5b10(0x124)],_0x47eff9[_0x5e5b10(0x18d)],_0x3f78a6,_0xc53081[_0x5e5b10(0xfc)],_0x3a6fb3,_0x3e7af9),console[_0x5e5b10(0xf2)](_0x5e5b10(0xf1)+_0x47eff9['webhookUrl']+_0x5e5b10(0x11d)+_0xc53081[_0x5e5b10(0xfc)]+'\x20('+_0x3a6fb3+_0x5e5b10(0xe3));}catch(_0x318e63){console['error']('Failed\x20to\x20send\x20shop\x20webhook:',_0x318e63),loggerService_1[_0x5e5b10(0x155)][_0x5e5b10(0xec)](_0x19da49[_0x5e5b10(0x124)],_0x19da49[_0x5e5b10(0x19d)]?.[_0x5e5b10(0x18c)]?.[_0x5e5b10(0x18d)]||'unknown',_0x5e5b10(0x18e),_0x318e63,{});}}async[a37_0xca77e9(0x132)](_0x4a94b0,_0x59b6f3){const _0x291777=a37_0xca77e9;try{const _0x5a2e3a={'PENDING':_0x291777(0x195),'PAID':_0x291777(0x165),'FAILED':_0x291777(0x116),'EXPIRED':_0x291777(0xe2)},_0x81c295=_0x5a2e3a[_0x59b6f3];if(!_0x81c295||_0x81c295===_0x291777(0x195))return;await telegramBotService_1[_0x291777(0x166)][_0x291777(0x185)](_0x4a94b0[_0x291777(0x124)],_0x4a94b0,_0x81c295);}catch(_0x1c795c){console[_0x291777(0x101)](_0x291777(0x152),_0x1c795c);}}async['checkPaymentById'](_0x3ecb1f){const _0x3742ec=a37_0xca77e9;console[_0x3742ec(0xf2)](_0x3742ec(0x144)+_0x3ecb1f);const _0x549109=await database_1['default']['payment'][_0x3742ec(0x1a7)]({'where':{'id':_0x3ecb1f},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x549109)throw new Error(_0x3742ec(0x139));if(_0x549109[_0x3742ec(0x1a6)]!=='cointopay')throw new Error(_0x3742ec(0xdf));console['log'](_0x3742ec(0xe1)+_0x3ecb1f),await this[_0x3742ec(0x108)](_0x549109),console[_0x3742ec(0xf2)]('✅\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20'+_0x3ecb1f);}[a37_0xca77e9(0x11e)](){const _0x101d97=a37_0xca77e9,_0x56eb71=this[_0x101d97(0x15a)]?this[_0x101d97(0x1a4)]:undefined,_0x52adf1=Array['from'](this[_0x101d97(0x190)]['values']())[_0x101d97(0x12b)](_0x500b3f=>({'paymentId':_0x500b3f[_0x101d97(0x16e)],'gatewayPaymentId':_0x500b3f[_0x101d97(0x161)],'createdAt':_0x500b3f[_0x101d97(0x1b8)],'timersCount':_0x500b3f[_0x101d97(0x11a)][_0x101d97(0x16a)]}));return{'isActive':!!this[_0x101d97(0x15a)],'globalCheckIntervalMinutes':this['GLOBAL_CHECK_INTERVAL_MS']/(0x3e8*0x3c),'expiryDays':this[_0x101d97(0x197)],'activeIndividualTimers':this[_0x101d97(0x190)]['size'],'nextGlobalCheckIn':_0x56eb71,'paymentTimersDetails':_0x52adf1};}[a37_0xca77e9(0x13f)](_0x21871d){const _0x1bd11a=a37_0xca77e9,_0x300d85=this[_0x1bd11a(0x190)][_0x1bd11a(0xe4)](_0x21871d);if(_0x300d85)return{'hasTimers':!![],'timersCount':_0x300d85[_0x1bd11a(0x11a)]['length'],'createdAt':_0x300d85[_0x1bd11a(0x1b8)],'gatewayPaymentId':_0x300d85[_0x1bd11a(0x161)]};return{'hasTimers':![]};}}exports[a37_0xca77e9(0x147)]=CoinToPayStatusService,exports['coinToPayStatusService']=new CoinToPayStatusService();