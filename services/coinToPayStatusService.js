'use strict';const a37_0x58cd0e=a37_0xea20;(function(_0x506b64,_0x338c0c){const _0x24d1f7=a37_0xea20,_0x2ac5b=_0x506b64();while(!![]){try{const _0x2e9dd1=parseInt(_0x24d1f7(0x16c))/0x1+-parseInt(_0x24d1f7(0x168))/0x2*(-parseInt(_0x24d1f7(0x23f))/0x3)+parseInt(_0x24d1f7(0x22d))/0x4+-parseInt(_0x24d1f7(0x1bb))/0x5+parseInt(_0x24d1f7(0x205))/0x6+-parseInt(_0x24d1f7(0x191))/0x7+-parseInt(_0x24d1f7(0x1c1))/0x8;if(_0x2e9dd1===_0x338c0c)break;else _0x2ac5b['push'](_0x2ac5b['shift']());}catch(_0x42ed5a){_0x2ac5b['push'](_0x2ac5b['shift']());}}}(a37_0x2b00,0xb8100));function a37_0xea20(_0x44f9ad,_0x210d14){const _0x2b00a6=a37_0x2b00();return a37_0xea20=function(_0xea20c0,_0x1ba744){_0xea20c0=_0xea20c0-0x14f;let _0x86e445=_0x2b00a6[_0xea20c0];return _0x86e445;},a37_0xea20(_0x44f9ad,_0x210d14);}function a37_0x2b00(){const _0x2bd9ca=['setDate','\x20\x20\x20📝\x20Context:','🪙\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','shopId','\x20with\x20status\x20','\x20expired\x20CoinToPay\x20payments','checkPaymentStatus','⏰\x20[GLOBAL]\x20Payment\x20','gatewayOrderId','default','map','🪙\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','\x20\x20\x20-\x20gatewayPaymentId:\x20','auto_expire','🛑\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','bankDetails','Payment\x20not\x20found','getPaymentTimerInfo','amount','🆔\x20[CHECK]\x20Transaction\x20ID:\x20','message','cointopay','sendShopWebhook','./loggerService','EXPIRED','paymentId','./telegramBotService','logShopWebhookSent','\x20to\x20clear','includes','❌\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','✅\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','getServiceStats','sendPaymentNotification','🧹\x20[DEBUG]\x20Cleared\x20timer\x20#','gateway','4039861rzpYiv','\x20status:\x20','payment','\x20found:','\x20completed\x20for\x20payment\x20','\x20checked,\x20','⏰\x20[DEBUG]\x20Scheduled\x20check\x20#','\x20pending\x20CoinToPay\x20payments','POST','⏰\x20[GLOBAL]\x20Found\x20','❌\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','❌\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','adminNotes','❌\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','1\x20minute','cointopay_status_check_','\x20not\x20enabled\x20for\x20shop\x20','sendPaymentStatusNotification','findUnique','logWhiteDomainError','COINTOPAY_ERROR',',\x20stopping\x20individual\x20checks','✅\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','\x20\x20\x20❌\x20Error:\x20','./gateways/coinToPay2Service','push','-day\x20timeout','⏰\x20[HOURLY]\x20Payment\x20','loggerService','.\x20Remaining\x20active\x20timers:\x20','\x20is\x20older\x20than\x20','coinToPayStatusService','stopPeriodicStatusCheck','5\x20minutes','toFixed','Failed\x20to\x20mark\x20payment\x20as\x20expired','checkSinglePaymentById','\x20days\x20(created\x20before\x20','payment.success','🔍\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','/status/','toISOString','1903510KPSGbz','📊\x20[CHECK]\x20Payment\x20','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','unknown','iban','created','3069752QBtLjB','\x20individual\x20payment\x20timers','currentPayments','\x20days\x20without\x20payment\x20confirmation','getGatewayIdByName','🛑\x20[SHUTDOWN]\x20Cleared\x20','📊\x20[CHECK]\x20CoinToPay2\x20payment\x20','customerName','from','CoinToPay2Service','create','telegramBotService','ms)','floor','🔍\x20[CHECK]\x20Checking\x20','transactionId','🔍\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','findMany','currency','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','\x20updated:\x20currentPayments=',',\x20currentPayments=','\x20\x20\x20📝\x20Details:','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','✅\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','SINGLE','../types/gateway','timers','settings','__esModule','❌\x20[HOURLY]\x20Payment\x20','cointopay_status_check_error','\x20\x20\x20📅\x20Time:\x20','orderId','\x20is\x20valid\x20for\x20checking,\x20proceeding...','coinToPayService','toLowerCase','cointopay2','checkSinglePayment','\x20\x20\x20-\x20Gateway:\x20','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','🪙\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','paymentDetails','catch','\x20->\x20','globalCheckInterval','\x20days','webhookUrl','\x20\x20\x20-\x20ShopId:\x20','CoinToPayStatusService','📊\x20[HOURLY]\x20Payment\x20','📈\x20[COINTOPAY]\x20Payment\x20','TesSoft\x20Payment\x20System/1.0','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','📈\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','❌\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','getTime','GLOBAL_CHECK_INTERVAL_MS','✅\x20[EXPIRY]\x20Payment\x20','PENDING','../config/database','\x20status\x20is\x20','❌\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','✅\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','✅\x20[CHECK]\x20Payment\x20','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','💰\x20[CHECK]\x20Payment\x20','42948vzjzEY','Webhook\x20event\x20','\x20expired','🛑\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','\x20is\x20too\x20new\x20(','\x20payment\x20','\x20not\x20found\x20in\x20database','getDate','\x20in\x20','logShopWebhookError','COMPLETED','checkExpiredPayments','🧹\x20[CHECK]\x20Payment\x20','type','log','startPeriodicStatusCheck','status','PAID','COINTOPAY_STATUS_CHANGE','get','EXPIRY_DAYS','logCoinToPayStatus','cointopay_auto_expired','defineProperty','gatewayPaymentId','✅\x20[TIMER]\x20Individual\x20check\x20#','schedule_created','⚠️\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','\x20marked\x20as\x20paid\x20at:\x20','\x20\x20\x20-\x20Status:\x20','❌\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','\x20current\x20status:\x20','\x20to\x20','checkPaymentById','update','🧹\x20[DEBUG]\x20Clearing\x20','webhookLog','🔍\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','\x20seconds\x20(',':\x20type=','3458776MtVsDs','🪙\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','logCoinToPayError','❌\x20[CHECK]\x20Payment\x20','\x20initial\x20timers\x20for\x20payment\x20','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','now','🪙\x20[ERROR]\x20CoinToPay\x20Error:\x20','createdAt','paymentTimers','\x20for\x20payment\x20','clearPaymentTimers','confirmedOn','FAILED','📊\x20[CHECK]\x20CoinToPay\x20payment\x20','\x20\x20\x20-\x20paymentId:\x20','\x20\x20\x20📊\x20Status:\x20','error','3291186qOYuml','\x20(age:\x20','🔄\x20[CHECK]\x20Updating\x20payment\x20','🏦\x20[CHECK]\x20Saved\x20IBAN:\x20','delete','🪙\x20[GLOBAL]\x20Found\x20','timestamp','\x20has\x20no\x20gatewayPaymentId','schedulePaymentChecks','paymentLinkId','payment.pending','\x20days,\x20marking\x20as\x20EXPIRED','remitterIban','\x20triggered\x20for\x20payment\x20','❌\x20[TIMER]\x20Failed\x20individual\x20check\x20#','h),\x20skipping\x20global\x20check','\x20updated\x20successfully','paymentLink','Success','📊\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','payment.failed','description','length','failed',',\x20clearing\x20individual\x20timers','⚠️\x20[CHECK]\x20Payment\x20','Automatically\x20expired\x20after\x20','size','checkAllPendingPayments','createdOn','has','forEach','\x20not\x20found,\x20clearing\x20timers','2yNHemj','status_check','coinToPay2Service','shop','126550FXzgZe'];a37_0x2b00=function(){return _0x2bd9ca;};return a37_0x2b00();}var __importDefault=this&&this['__importDefault']||function(_0x2916be){const _0x3a8327=a37_0xea20;return _0x2916be&&_0x2916be[_0x3a8327(0x1df)]?_0x2916be:{'default':_0x2916be};};Object[a37_0x58cd0e(0x21c)](exports,a37_0x58cd0e(0x1df),{'value':!![]}),exports['coinToPayStatusService']=exports['CoinToPayStatusService']=void 0x0;const coinToPayService_1=require('./gateways/coinToPayService'),coinToPay2Service_1=require(a37_0x58cd0e(0x1a9)),gateway_1=require(a37_0x58cd0e(0x1dc)),database_1=__importDefault(require(a37_0x58cd0e(0x1fe))),telegramBotService_1=require(a37_0x58cd0e(0x187)),loggerService_1=require(a37_0x58cd0e(0x184));class CoinToPayStatusService{constructor(){const _0x117fb6=a37_0x58cd0e;this[_0x117fb6(0x1ef)]=null,this['GLOBAL_CHECK_INTERVAL_MS']=0x3c*0x3c*0x3e8,this[_0x117fb6(0x219)]=0x5,this[_0x117fb6(0x236)]=new Map(),this[_0x117fb6(0x1e5)]=new coinToPayService_1['CoinToPayService'](),this[_0x117fb6(0x16a)]=new coinToPay2Service_1[(_0x117fb6(0x1ca))](),console[_0x117fb6(0x213)](_0x117fb6(0x16f));}[a37_0x58cd0e(0x14f)](_0x37e97f,_0x2211fd){const _0xd2a66d=a37_0x58cd0e;console['log']('🪙\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:'),console['log'](_0xd2a66d(0x23c)+_0x37e97f),console[_0xd2a66d(0x213)](_0xd2a66d(0x179)+_0x2211fd),this[_0xd2a66d(0x238)](_0x37e97f);const _0x44cafe=[],_0x593264=new Date(),_0x113bbc=[{'delay':0x1*0x3c*0x3e8,'description':_0xd2a66d(0x19f)},{'delay':0x2*0x3c*0x3e8,'description':'2\x20minutes'},{'delay':0x5*0x3c*0x3e8,'description':_0xd2a66d(0x1b2)},{'delay':0x5*0x3c*0x3e8,'description':'5\x20minutes'}];console[_0xd2a66d(0x213)]('🪙\x20[DEBUG]\x20Creating\x20'+_0x113bbc[_0xd2a66d(0x15d)]+_0xd2a66d(0x231)+_0x37e97f);let _0x21b4d9=0x0;_0x113bbc['forEach']((_0x3dd3c2,_0x4bc451)=>{const _0x333cf2=_0xd2a66d;_0x21b4d9+=_0x3dd3c2['delay'];const _0x36802e=setTimeout(async()=>{const _0x480e69=a37_0xea20;console['log']('🪙\x20[TIMER]\x20Individual\x20check\x20#'+(_0x4bc451+0x1)+_0x480e69(0x154)+_0x37e97f+'\x20(after\x20'+_0x3dd3c2[_0x480e69(0x15c)]+')');try{await this['checkSinglePaymentById'](_0x37e97f),console[_0x480e69(0x213)](_0x480e69(0x21e)+(_0x4bc451+0x1)+_0x480e69(0x195)+_0x37e97f);}catch(_0x143b16){console[_0x480e69(0x23e)](_0x480e69(0x155)+(_0x4bc451+0x1)+'\x20for\x20payment\x20'+_0x37e97f+':',_0x143b16),this['logCoinToPayError'](_0x37e97f,_0x2211fd,_0x143b16,_0x480e69(0x169),{'checkNumber':_0x4bc451+0x1,'scheduledAfter':_0x3dd3c2['description'],'isIndividualCheck':!![]});}},_0x21b4d9);_0x44cafe['push'](_0x36802e),console[_0x333cf2(0x213)](_0x333cf2(0x197)+(_0x4bc451+0x1)+_0x333cf2(0x237)+_0x37e97f+_0x333cf2(0x20d)+_0x21b4d9/0x3e8+_0x333cf2(0x22b)+_0x3dd3c2[_0x333cf2(0x15c)]+')');});const _0x4cb055=setInterval(async()=>{const _0x49d9ba=_0xd2a66d;console['log'](_0x49d9ba(0x178)+_0x37e97f);try{const _0x248f08=await database_1[_0x49d9ba(0x176)][_0x49d9ba(0x193)][_0x49d9ba(0x1a3)]({'where':{'id':_0x37e97f},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x248f08){console[_0x49d9ba(0x213)](_0x49d9ba(0x1e0)+_0x37e97f+_0x49d9ba(0x167)),this[_0x49d9ba(0x238)](_0x37e97f);return;}console[_0x49d9ba(0x213)](_0x49d9ba(0x1f4)+_0x37e97f+_0x49d9ba(0x224)+_0x248f08['status']);if(_0x248f08['status']!==_0x49d9ba(0x1fd)){console[_0x49d9ba(0x213)]('✅\x20[HOURLY]\x20Payment\x20'+_0x37e97f+_0x49d9ba(0x1ff)+_0x248f08[_0x49d9ba(0x215)]+_0x49d9ba(0x1a6)),this['clearPaymentTimers'](_0x37e97f);return;}const _0x3e754c=Math[_0x49d9ba(0x1ce)]((Date[_0x49d9ba(0x233)]()-_0x248f08['createdAt']['getTime']())/(0x3e8*0x3c*0x3c*0x18));if(_0x3e754c>=this[_0x49d9ba(0x219)]){console[_0x49d9ba(0x213)](_0x49d9ba(0x1ac)+_0x37e97f+_0x49d9ba(0x1af)+this['EXPIRY_DAYS']+_0x49d9ba(0x1bd)),this[_0x49d9ba(0x238)](_0x37e97f);return;}await this['checkSinglePaymentById'](_0x37e97f),console[_0x49d9ba(0x213)](_0x49d9ba(0x18c)+_0x37e97f);}catch(_0x1e6574){console[_0x49d9ba(0x23e)](_0x49d9ba(0x19b)+_0x37e97f+':',_0x1e6574),this[_0x49d9ba(0x22f)](_0x37e97f,_0x2211fd,_0x1e6574,'status_check',{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x44cafe[_0xd2a66d(0x1aa)](_0x4cb055),this['paymentTimers']['set'](_0x37e97f,{'timers':_0x44cafe,'paymentId':_0x37e97f,'gatewayPaymentId':_0x2211fd,'createdAt':_0x593264}),console['log']('✅\x20[DEBUG]\x20Successfully\x20scheduled\x20'+_0x113bbc[_0xd2a66d(0x15d)]+'\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20'+_0x37e97f),console[_0xd2a66d(0x213)](_0xd2a66d(0x15a)+this['paymentTimers'][_0xd2a66d(0x162)]),this[_0xd2a66d(0x21a)](_0x37e97f,_0x2211fd,_0xd2a66d(0x1fd),_0xd2a66d(0x1fd),'status_check',{'action':_0xd2a66d(0x21f),'scheduledChecks':_0x113bbc[_0xd2a66d(0x15d)],'firstCheckIn':_0x113bbc[0x0]['delay']/0x3e8,'totalTimers':this[_0xd2a66d(0x236)][_0xd2a66d(0x162)]});}[a37_0x58cd0e(0x238)](_0x14aeb9){const _0x28d8ac=a37_0x58cd0e,_0x2dfdcc=this[_0x28d8ac(0x236)][_0x28d8ac(0x218)](_0x14aeb9);_0x2dfdcc?(console[_0x28d8ac(0x213)](_0x28d8ac(0x228)+_0x2dfdcc[_0x28d8ac(0x1dd)]['length']+'\x20timers\x20for\x20payment\x20'+_0x14aeb9),_0x2dfdcc[_0x28d8ac(0x1dd)][_0x28d8ac(0x166)]((_0x283b1e,_0x3c0273)=>{const _0x48739a=_0x28d8ac;_0x283b1e&&(clearTimeout(_0x283b1e),clearInterval(_0x283b1e),console[_0x48739a(0x213)](_0x48739a(0x18f)+(_0x3c0273+0x1)+'\x20for\x20payment\x20'+_0x14aeb9));}),this[_0x28d8ac(0x236)][_0x28d8ac(0x243)](_0x14aeb9),console[_0x28d8ac(0x213)]('✅\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20'+_0x14aeb9+_0x28d8ac(0x1ae)+this[_0x28d8ac(0x236)][_0x28d8ac(0x162)])):console[_0x28d8ac(0x213)](_0x28d8ac(0x220)+_0x14aeb9+_0x28d8ac(0x189));}async[a37_0x58cd0e(0x1b5)](_0x2407fd){const _0x2eb745=a37_0x58cd0e;console[_0x2eb745(0x213)](_0x2eb745(0x1d1)+_0x2407fd);const _0x375cdd=await database_1[_0x2eb745(0x176)][_0x2eb745(0x193)]['findUnique']({'where':{'id':_0x2407fd},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x375cdd){console[_0x2eb745(0x213)](_0x2eb745(0x230)+_0x2407fd+_0x2eb745(0x20b));return;}console[_0x2eb745(0x213)](_0x2eb745(0x1bc)+_0x2407fd+_0x2eb745(0x194)),console[_0x2eb745(0x213)](_0x2eb745(0x1e9)+_0x375cdd[_0x2eb745(0x190)]),console[_0x2eb745(0x213)](_0x2eb745(0x222)+_0x375cdd['status']),console['log']('\x20\x20\x20-\x20GatewayPaymentId:\x20'+_0x375cdd[_0x2eb745(0x21d)]),console[_0x2eb745(0x213)]('\x20\x20\x20-\x20Amount:\x20'+_0x375cdd[_0x2eb745(0x17f)]+'\x20'+_0x375cdd[_0x2eb745(0x1d3)]),console['log'](_0x2eb745(0x1f2)+_0x375cdd[_0x2eb745(0x170)]);if(_0x375cdd[_0x2eb745(0x190)]!==_0x2eb745(0x182)&&_0x375cdd[_0x2eb745(0x190)]!==_0x2eb745(0x1e7)){console[_0x2eb745(0x213)](_0x2eb745(0x160)+_0x2407fd+'\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20'+_0x375cdd[_0x2eb745(0x190)]+')');return;}if(_0x375cdd[_0x2eb745(0x215)]!==_0x2eb745(0x1fd)){console[_0x2eb745(0x213)](_0x2eb745(0x160)+_0x2407fd+_0x2eb745(0x1ff)+_0x375cdd[_0x2eb745(0x215)]+',\x20stopping\x20individual\x20checks'),this[_0x2eb745(0x238)](_0x2407fd);return;}if(!_0x375cdd[_0x2eb745(0x21d)]){console['log']('⚠️\x20[CHECK]\x20Payment\x20'+_0x2407fd+_0x2eb745(0x246));return;}console[_0x2eb745(0x213)](_0x2eb745(0x202)+_0x2407fd+_0x2eb745(0x1e4)),await this[_0x2eb745(0x1e8)](_0x375cdd);}[a37_0x58cd0e(0x21a)](_0x1a2da3,_0x622799,_0x555fda,_0x8034a3,_0x2d93dd,_0x223514){const _0x1d59ca=a37_0x58cd0e,_0x486518={'type':_0x1d59ca(0x217),'paymentId':_0x1a2da3,'gatewayPaymentId':_0x622799,'oldStatus':_0x555fda,'newStatus':_0x8034a3,'source':_0x2d93dd,'timestamp':new Date()[_0x1d59ca(0x1ba)](),'details':_0x223514||{}};loggerService_1[_0x1d59ca(0x1ad)][_0x1d59ca(0x21a)](_0x486518),console[_0x1d59ca(0x213)]('🪙\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20'+_0x1a2da3+'\x20('+_0x622799+')'),console[_0x1d59ca(0x213)](_0x1d59ca(0x23d)+_0x555fda+'\x20->\x20'+_0x8034a3),console[_0x1d59ca(0x213)]('\x20\x20\x20📍\x20Source:\x20'+_0x2d93dd),console[_0x1d59ca(0x213)](_0x1d59ca(0x1e2)+_0x486518[_0x1d59ca(0x245)]),_0x223514&&console[_0x1d59ca(0x213)](_0x1d59ca(0x1d7),_0x223514);}[a37_0x58cd0e(0x22f)](_0x38c921,_0x2391e4,_0x599e11,_0x379236,_0x2c6474){const _0x586c07=a37_0x58cd0e,_0x5aa4b6={'type':_0x586c07(0x1a5),'paymentId':_0x38c921,'gatewayPaymentId':_0x2391e4,'error':_0x599e11 instanceof Error?{'message':_0x599e11[_0x586c07(0x181)],'stack':_0x599e11['stack']}:_0x599e11,'source':_0x379236,'timestamp':new Date()[_0x586c07(0x1ba)](),'context':_0x2c6474||{}};loggerService_1[_0x586c07(0x1ad)]['logCoinToPayError'](_0x5aa4b6),console[_0x586c07(0x23e)](_0x586c07(0x234)+_0x38c921+'\x20('+_0x2391e4+')'),console[_0x586c07(0x23e)](_0x586c07(0x1a8)+(_0x599e11 instanceof Error?_0x599e11[_0x586c07(0x181)]:_0x599e11)),console['error']('\x20\x20\x20📍\x20Source:\x20'+_0x379236),console[_0x586c07(0x23e)](_0x586c07(0x1e2)+_0x5aa4b6[_0x586c07(0x245)]),_0x2c6474&&console[_0x586c07(0x23e)](_0x586c07(0x16e),_0x2c6474);}[a37_0x58cd0e(0x214)](){const _0x391922=a37_0x58cd0e;console[_0x391922(0x213)]('🪙\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)'),this[_0x391922(0x163)]()[_0x391922(0x1ed)](_0x3b2bff=>{const _0xfde0c5=_0x391922;console['error'](_0xfde0c5(0x19e),_0x3b2bff);}),this['globalCheckInterval']=setInterval(async()=>{const _0x512c0a=_0x391922;try{console[_0x512c0a(0x213)](_0x512c0a(0x22e)),await this[_0x512c0a(0x163)](),console[_0x512c0a(0x213)](_0x512c0a(0x1a7));}catch(_0x1d9d30){console[_0x512c0a(0x23e)](_0x512c0a(0x1f9),_0x1d9d30);}},this['GLOBAL_CHECK_INTERVAL_MS']),console[_0x391922(0x213)]('✅\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)');}[a37_0x58cd0e(0x1b1)](){const _0x2c4984=a37_0x58cd0e;console[_0x2c4984(0x213)](_0x2c4984(0x208));this['globalCheckInterval']&&(clearInterval(this['globalCheckInterval']),this[_0x2c4984(0x1ef)]=null,console[_0x2c4984(0x213)](_0x2c4984(0x17b)));const _0x59a792=this[_0x2c4984(0x236)]['size'];for(const [_0x105f4d]of this[_0x2c4984(0x236)]){this[_0x2c4984(0x238)](_0x105f4d);}console['log'](_0x2c4984(0x1c6)+_0x59a792+_0x2c4984(0x1c2));}async[a37_0x58cd0e(0x163)](){const _0x51edf3=a37_0x58cd0e;try{console[_0x51edf3(0x213)](_0x51edf3(0x1eb));const _0x36ee34=await database_1[_0x51edf3(0x176)][_0x51edf3(0x193)][_0x51edf3(0x1d2)]({'where':{'gateway':{'in':[_0x51edf3(0x182),_0x51edf3(0x1e7)]},'status':'PENDING','gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console['log'](_0x51edf3(0x244)+_0x36ee34[_0x51edf3(0x15d)]+_0x51edf3(0x198));if(_0x36ee34[_0x51edf3(0x15d)]===0x0){console[_0x51edf3(0x213)]('🪙\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check');return;}const _0x4c88fb=await this[_0x51edf3(0x210)](_0x36ee34);console[_0x51edf3(0x213)](_0x51edf3(0x19a)+_0x4c88fb['length']+_0x51edf3(0x172));let _0x11dc96=0x0,_0x1a8e3e=0x0;for(const _0x427b6d of _0x36ee34){try{if(_0x4c88fb[_0x51edf3(0x18a)](_0x427b6d['id'])){console[_0x51edf3(0x213)](_0x51edf3(0x174)+_0x427b6d['id']+_0x51edf3(0x1d9)),_0x1a8e3e++;continue;}if(this['paymentTimers'][_0x51edf3(0x165)](_0x427b6d['id'])){console[_0x51edf3(0x213)](_0x51edf3(0x174)+_0x427b6d['id']+_0x51edf3(0x1d8)),_0x1a8e3e++;continue;}const _0x21dff9=(Date[_0x51edf3(0x233)]()-_0x427b6d['createdAt'][_0x51edf3(0x1fa)]())/(0x3e8*0x3c*0x3c);if(_0x21dff9<0x1){console[_0x51edf3(0x213)](_0x51edf3(0x174)+_0x427b6d['id']+_0x51edf3(0x209)+_0x21dff9[_0x51edf3(0x1b3)](0x1)+_0x51edf3(0x156)),_0x1a8e3e++;continue;}console[_0x51edf3(0x213)](_0x51edf3(0x1b8)+_0x427b6d['id']+_0x51edf3(0x240)+_0x21dff9[_0x51edf3(0x1b3)](0x1)+'h)'),await this[_0x51edf3(0x1e8)](_0x427b6d),_0x11dc96++,await new Promise(_0x208d3e=>setTimeout(_0x208d3e,0x7d0));}catch(_0x4e6636){console[_0x51edf3(0x23e)](_0x51edf3(0x18b)+_0x427b6d['id']+':',_0x4e6636),this[_0x51edf3(0x22f)](_0x427b6d['id'],_0x427b6d[_0x51edf3(0x21d)]||_0x51edf3(0x1be),_0x4e6636,_0x51edf3(0x169),{'isGlobalCheck':!![],'paymentAmount':_0x427b6d[_0x51edf3(0x17f)],'paymentCurrency':_0x427b6d['currency'],'shopId':_0x427b6d[_0x51edf3(0x170)],'createdAt':_0x427b6d['createdAt']}),loggerService_1[_0x51edf3(0x1ad)][_0x51edf3(0x1a4)](_0x51edf3(0x182),_0x51edf3(0x1b9)+_0x427b6d[_0x51edf3(0x21d)],_0x4e6636);}}console['log'](_0x51edf3(0x1da)+_0x11dc96+_0x51edf3(0x196)+_0x1a8e3e+'\x20skipped,\x20'+_0x4c88fb['length']+_0x51edf3(0x207));}catch(_0x1eeeff){console[_0x51edf3(0x23e)](_0x51edf3(0x223),_0x1eeeff);}}async[a37_0x58cd0e(0x210)](_0x136151){const _0x15bcfd=a37_0x58cd0e,_0x57ceef=[],_0x5c3b4d=new Date();_0x5c3b4d[_0x15bcfd(0x16d)](_0x5c3b4d[_0x15bcfd(0x20c)]()-this[_0x15bcfd(0x219)]),console[_0x15bcfd(0x213)]('⏰\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20'+this[_0x15bcfd(0x219)]+_0x15bcfd(0x1b6)+_0x5c3b4d[_0x15bcfd(0x1ba)]()+')');for(const _0x325802 of _0x136151){if(_0x325802['createdAt']<_0x5c3b4d){console[_0x15bcfd(0x213)]('⏰\x20[EXPIRY]\x20Payment\x20'+_0x325802['id']+_0x15bcfd(0x1af)+this['EXPIRY_DAYS']+_0x15bcfd(0x152));try{this['logCoinToPayStatus'](_0x325802['id'],_0x325802[_0x15bcfd(0x21d)]||_0x15bcfd(0x1be),_0x15bcfd(0x1fd),_0x15bcfd(0x185),_0x15bcfd(0x17a),{'reason':'Payment\x20older\x20than\x20'+this[_0x15bcfd(0x219)]+_0x15bcfd(0x1f0),'createdAt':_0x325802[_0x15bcfd(0x235)],'daysSinceCreation':Math[_0x15bcfd(0x1ce)]((Date[_0x15bcfd(0x233)]()-_0x325802[_0x15bcfd(0x235)][_0x15bcfd(0x1fa)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x325802['amount'],'paymentCurrency':_0x325802['currency'],'shopId':_0x325802[_0x15bcfd(0x170)]}),await database_1['default']['payment'][_0x15bcfd(0x227)]({'where':{'id':_0x325802['id']},'data':{'status':_0x15bcfd(0x185),'updatedAt':new Date(),'adminNotes':_0x15bcfd(0x161)+this[_0x15bcfd(0x219)]+_0x15bcfd(0x1c4)}}),await database_1['default'][_0x15bcfd(0x229)]['create']({'data':{'paymentId':_0x325802['id'],'shopId':_0x325802[_0x15bcfd(0x170)],'event':_0x15bcfd(0x21b),'statusCode':0xc8,'responseBody':JSON['stringify']({'reason':'Payment\x20older\x20than\x20'+this[_0x15bcfd(0x219)]+_0x15bcfd(0x1f0),'createdAt':_0x325802[_0x15bcfd(0x235)],'expiredAt':new Date()[_0x15bcfd(0x1ba)](),'daysSinceCreation':Math[_0x15bcfd(0x1ce)]((Date['now']()-_0x325802[_0x15bcfd(0x235)][_0x15bcfd(0x1fa)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x15bcfd(0x183)](_0x325802,_0x15bcfd(0x185)),await this[_0x15bcfd(0x1a2)](_0x325802,_0x15bcfd(0x185)),this[_0x15bcfd(0x238)](_0x325802['id']),_0x57ceef[_0x15bcfd(0x1aa)](_0x325802['id']),console[_0x15bcfd(0x213)](_0x15bcfd(0x1fc)+_0x325802['id']+'\x20marked\x20as\x20EXPIRED\x20due\x20to\x20'+this[_0x15bcfd(0x219)]+_0x15bcfd(0x1ab));}catch(_0x106955){console[_0x15bcfd(0x23e)](_0x15bcfd(0x19c)+_0x325802['id']+':',_0x106955),this[_0x15bcfd(0x22f)](_0x325802['id'],_0x325802[_0x15bcfd(0x21d)]||_0x15bcfd(0x1be),_0x106955,_0x15bcfd(0x17a),{'reason':_0x15bcfd(0x1b4),'createdAt':_0x325802[_0x15bcfd(0x235)],'daysSinceCreation':Math[_0x15bcfd(0x1ce)]((Date['now']()-_0x325802['createdAt'][_0x15bcfd(0x1fa)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x57ceef;}async['checkSinglePayment'](_0x3afa86){const _0x21b9f5=a37_0x58cd0e;if(!_0x3afa86['gatewayPaymentId']){console[_0x21b9f5(0x213)]('⚠️\x20[CHECK]\x20Payment\x20'+_0x3afa86['id']+'\x20has\x20no\x20gatewayPaymentId,\x20skipping');return;}console['log'](_0x21b9f5(0x1cf)+_0x3afa86[_0x21b9f5(0x190)]+_0x21b9f5(0x20a)+_0x3afa86['id']+'\x20('+_0x3afa86[_0x21b9f5(0x21d)]+')');try{let _0xfca98d;_0x3afa86[_0x21b9f5(0x190)]===_0x21b9f5(0x1e7)?(_0xfca98d=await this['coinToPay2Service'][_0x21b9f5(0x173)](_0x3afa86[_0x21b9f5(0x21d)]),console[_0x21b9f5(0x213)](_0x21b9f5(0x1c7)+_0x3afa86['id']+_0x21b9f5(0x192)+_0xfca98d[_0x21b9f5(0x215)])):(_0xfca98d=await this[_0x21b9f5(0x1e5)][_0x21b9f5(0x173)](_0x3afa86[_0x21b9f5(0x21d)]),console[_0x21b9f5(0x213)](_0x21b9f5(0x23b)+_0x3afa86['id']+_0x21b9f5(0x192)+_0xfca98d[_0x21b9f5(0x215)]));_0xfca98d[_0x21b9f5(0x1ec)]&&console[_0x21b9f5(0x213)](_0x21b9f5(0x1bc)+_0x3afa86['id']+'\x20details:',{'iban':_0xfca98d[_0x21b9f5(0x1ec)][_0x21b9f5(0x1bf)]||'not\x20found','transactionId':_0xfca98d[_0x21b9f5(0x1ec)][_0x21b9f5(0x1d0)],'createdOn':_0xfca98d['paymentDetails'][_0x21b9f5(0x164)],'confirmedOn':_0xfca98d['paymentDetails'][_0x21b9f5(0x239)]||'not\x20confirmed'});if(_0xfca98d['status']!==_0x3afa86[_0x21b9f5(0x215)]){console[_0x21b9f5(0x213)](_0x21b9f5(0x241)+_0x3afa86['id']+'\x20status\x20from\x20'+_0x3afa86[_0x21b9f5(0x215)]+_0x21b9f5(0x225)+_0xfca98d[_0x21b9f5(0x215)]),this['logCoinToPayStatus'](_0x3afa86['id'],_0x3afa86[_0x21b9f5(0x21d)],_0x3afa86['status'],_0xfca98d[_0x21b9f5(0x215)],_0x21b9f5(0x169),{'paymentDetails':_0xfca98d[_0x21b9f5(0x1ec)],'amount':_0xfca98d[_0x21b9f5(0x17f)],'currency':_0xfca98d[_0x21b9f5(0x1d3)],'shopId':_0x3afa86[_0x21b9f5(0x170)],'checkTimestamp':new Date()['toISOString']()});const _0x80b2d3={'status':_0xfca98d[_0x21b9f5(0x215)],'updatedAt':new Date()};_0xfca98d[_0x21b9f5(0x215)]==='PAID'&&_0x3afa86[_0x21b9f5(0x215)]!==_0x21b9f5(0x216)&&(_0x80b2d3['paidAt']=new Date(),console[_0x21b9f5(0x213)](_0x21b9f5(0x204)+_0x3afa86['id']+_0x21b9f5(0x221)+_0x80b2d3['paidAt'][_0x21b9f5(0x1ba)]()));if(_0xfca98d[_0x21b9f5(0x1ec)]){const _0x1ed90a=_0xfca98d[_0x21b9f5(0x1ec)];_0x1ed90a[_0x21b9f5(0x1bf)]&&(_0x80b2d3[_0x21b9f5(0x153)]=_0x1ed90a[_0x21b9f5(0x1bf)],console[_0x21b9f5(0x213)](_0x21b9f5(0x242)+_0x1ed90a[_0x21b9f5(0x1bf)]));if(_0x1ed90a['bankDetails']){const _0x59ef48=_0x3afa86['adminNotes']||'',_0x4f4c91='Bank\x20Details:\x20'+_0x1ed90a[_0x21b9f5(0x17c)];_0x80b2d3[_0x21b9f5(0x19d)]=_0x59ef48?_0x59ef48+'\x0a\x0a'+_0x4f4c91:_0x4f4c91,console[_0x21b9f5(0x213)]('🏦\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes');}_0x1ed90a['transactionId']&&console[_0x21b9f5(0x213)](_0x21b9f5(0x180)+_0x1ed90a[_0x21b9f5(0x1d0)]),_0x1ed90a[_0x21b9f5(0x239)]&&console[_0x21b9f5(0x213)]('✅\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20'+_0x1ed90a[_0x21b9f5(0x239)]);}await database_1[_0x21b9f5(0x176)][_0x21b9f5(0x193)][_0x21b9f5(0x227)]({'where':{'id':_0x3afa86['id']},'data':_0x80b2d3});if(_0xfca98d[_0x21b9f5(0x215)]==='PAID'&&_0x3afa86['status']!==_0x21b9f5(0x216)){console[_0x21b9f5(0x213)](_0x21b9f5(0x1f5)+_0x3afa86['id']+_0x21b9f5(0x232));const _0xeb20be=await database_1[_0x21b9f5(0x176)][_0x21b9f5(0x193)]['findUnique']({'where':{'id':_0x3afa86['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0xeb20be?.[_0x21b9f5(0x150)]&&_0xeb20be[_0x21b9f5(0x158)])try{const _0x2d4120=_0xeb20be[_0x21b9f5(0x158)];console[_0x21b9f5(0x213)](_0x21b9f5(0x1f8)+_0x2d4120['id']+_0x21b9f5(0x22c)+_0x2d4120[_0x21b9f5(0x212)]+_0x21b9f5(0x1d6)+_0x2d4120[_0x21b9f5(0x1c3)]+',\x20status='+_0x2d4120[_0x21b9f5(0x215)]);const _0x185050=_0x2d4120['currentPayments']+0x1,_0x381969=_0x2d4120[_0x21b9f5(0x212)]===_0x21b9f5(0x1db)?_0x21b9f5(0x20f):_0x2d4120[_0x21b9f5(0x215)];await database_1[_0x21b9f5(0x176)][_0x21b9f5(0x158)][_0x21b9f5(0x227)]({'where':{'id':_0x2d4120['id']},'data':{'currentPayments':_0x185050,'status':_0x381969,'updatedAt':new Date()}}),console[_0x21b9f5(0x213)]('✅\x20[COINTOPAY]\x20Payment\x20link\x20'+_0x2d4120['id']+_0x21b9f5(0x1d5)+_0x2d4120[_0x21b9f5(0x1c3)]+_0x21b9f5(0x1ee)+_0x185050+',\x20status='+_0x2d4120['status']+_0x21b9f5(0x1ee)+_0x381969);}catch(_0x26f90a){console['error']('❌\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:',_0x26f90a);}else console[_0x21b9f5(0x213)]('📈\x20[COINTOPAY]\x20Payment\x20'+_0x3afa86['id']+_0x21b9f5(0x1d4));}await database_1['default'][_0x21b9f5(0x229)][_0x21b9f5(0x1cb)]({'data':{'paymentId':_0x3afa86['id'],'shopId':_0x3afa86[_0x21b9f5(0x170)],'event':_0x21b9f5(0x1a0)+_0xfca98d[_0x21b9f5(0x215)][_0x21b9f5(0x1e6)](),'statusCode':0xc8,'responseBody':JSON['stringify']({'oldStatus':_0x3afa86['status'],'newStatus':_0xfca98d[_0x21b9f5(0x215)],'paymentDetails':_0xfca98d['paymentDetails'],'checkedAt':new Date()[_0x21b9f5(0x1ba)]()})}}),await this['sendShopWebhook'](_0x3afa86,_0xfca98d['status']),await this[_0x21b9f5(0x1a2)](_0x3afa86,_0xfca98d[_0x21b9f5(0x215)]),_0xfca98d[_0x21b9f5(0x215)]!==_0x21b9f5(0x1fd)&&(console[_0x21b9f5(0x213)](_0x21b9f5(0x211)+_0x3afa86['id']+'\x20status\x20changed\x20to\x20'+_0xfca98d[_0x21b9f5(0x215)]+_0x21b9f5(0x15f)),this[_0x21b9f5(0x238)](_0x3afa86['id'])),console['log']('✅\x20[CHECK]\x20Payment\x20'+_0x3afa86['id']+_0x21b9f5(0x157));}else console[_0x21b9f5(0x213)]('📊\x20[CHECK]\x20Payment\x20'+_0x3afa86['id']+'\x20status\x20unchanged\x20('+_0xfca98d[_0x21b9f5(0x215)]+')'),this[_0x21b9f5(0x21a)](_0x3afa86['id'],_0x3afa86[_0x21b9f5(0x21d)],_0x3afa86[_0x21b9f5(0x215)],_0xfca98d['status'],_0x21b9f5(0x169),{'statusUnchanged':!![],'paymentDetails':_0xfca98d[_0x21b9f5(0x1ec)],'amount':_0xfca98d[_0x21b9f5(0x17f)],'currency':_0xfca98d['currency'],'shopId':_0x3afa86[_0x21b9f5(0x170)],'checkTimestamp':new Date()[_0x21b9f5(0x1ba)]()});}catch(_0x237dac){console[_0x21b9f5(0x23e)](_0x21b9f5(0x200)+_0x3afa86['id']+':',_0x237dac),this[_0x21b9f5(0x22f)](_0x3afa86['id'],_0x3afa86[_0x21b9f5(0x21d)],_0x237dac,_0x21b9f5(0x169),{'paymentAmount':_0x3afa86[_0x21b9f5(0x17f)],'paymentCurrency':_0x3afa86[_0x21b9f5(0x1d3)],'shopId':_0x3afa86[_0x21b9f5(0x170)],'createdAt':_0x3afa86[_0x21b9f5(0x235)]}),await database_1[_0x21b9f5(0x176)]['webhookLog']['create']({'data':{'paymentId':_0x3afa86['id'],'shopId':_0x3afa86[_0x21b9f5(0x170)],'event':_0x21b9f5(0x1e1),'statusCode':0x1f4,'responseBody':JSON['stringify']({'error':_0x237dac instanceof Error?_0x237dac[_0x21b9f5(0x181)]:'Unknown\x20error','gatewayPaymentId':_0x3afa86[_0x21b9f5(0x21d)],'checkedAt':new Date()[_0x21b9f5(0x1ba)]()})}});}}async[a37_0x58cd0e(0x183)](_0x2c8a1b,_0x12d4ca){const _0x20f5be=a37_0x58cd0e,_0x24e5df=Date['now']();try{const _0x26020b=_0x2c8a1b[_0x20f5be(0x16b)],_0x46b397=_0x26020b[_0x20f5be(0x1de)];if(!_0x46b397?.[_0x20f5be(0x1f1)]){console[_0x20f5be(0x213)](_0x20f5be(0x1ea)+_0x26020b['id']);return;}const _0x27f2cf=_0x12d4ca===_0x20f5be(0x216)?_0x20f5be(0x1b7):_0x12d4ca===_0x20f5be(0x23a)?_0x20f5be(0x15b):_0x12d4ca===_0x20f5be(0x185)?_0x20f5be(0x15b):_0x20f5be(0x151);if(!_0x46b397['webhookEvents']?.[_0x20f5be(0x18a)](_0x27f2cf)){console[_0x20f5be(0x213)](_0x20f5be(0x206)+_0x27f2cf+_0x20f5be(0x1a1)+_0x26020b['id']);return;}const _0x301933=(0x0,gateway_1[_0x20f5be(0x1c5)])(_0x2c8a1b[_0x20f5be(0x190)])||_0x2c8a1b[_0x20f5be(0x190)],_0x3f4d93={'event':_0x27f2cf,'payment':{'id':_0x2c8a1b['id'],'order_id':_0x2c8a1b[_0x20f5be(0x1e3)],'gateway_order_id':_0x2c8a1b[_0x20f5be(0x175)],'gateway':_0x301933,'amount':_0x2c8a1b[_0x20f5be(0x17f)],'currency':_0x2c8a1b[_0x20f5be(0x1d3)],'status':_0x12d4ca[_0x20f5be(0x1e6)](),'customer_email':_0x2c8a1b['customerEmail'],'customer_name':_0x2c8a1b[_0x20f5be(0x1c8)],'created_at':_0x2c8a1b[_0x20f5be(0x235)],'updated_at':new Date()}},_0x19ff95=await fetch(_0x46b397[_0x20f5be(0x1f1)],{'method':_0x20f5be(0x199),'headers':{'Content-Type':'application/json','User-Agent':_0x20f5be(0x1f6)},'body':JSON['stringify'](_0x3f4d93)}),_0x249aec=Date[_0x20f5be(0x233)]()-_0x24e5df,_0x16db49=_0x19ff95['ok']?_0x20f5be(0x159):await _0x19ff95['text']();loggerService_1[_0x20f5be(0x1ad)][_0x20f5be(0x188)](_0x2c8a1b[_0x20f5be(0x170)],_0x46b397['webhookUrl'],_0x27f2cf,_0x19ff95['status'],_0x249aec,_0x3f4d93),console['log']('Shop\x20webhook\x20sent\x20to\x20'+_0x46b397[_0x20f5be(0x1f1)]+_0x20f5be(0x171)+_0x19ff95[_0x20f5be(0x215)]+'\x20('+_0x249aec+_0x20f5be(0x1cd));}catch(_0x3b8e9e){console['error']('Failed\x20to\x20send\x20shop\x20webhook:',_0x3b8e9e),loggerService_1[_0x20f5be(0x1ad)][_0x20f5be(0x20e)](_0x2c8a1b['shopId'],_0x2c8a1b[_0x20f5be(0x16b)]?.['settings']?.[_0x20f5be(0x1f1)]||'unknown','webhook_send',_0x3b8e9e,{});}}async[a37_0x58cd0e(0x1a2)](_0x55cbb6,_0x2e81fc){const _0x31445f=a37_0x58cd0e;try{const _0x3db678={'PENDING':_0x31445f(0x1c0),'PAID':'paid','FAILED':_0x31445f(0x15e),'EXPIRED':'expired'},_0x94aed9=_0x3db678[_0x2e81fc];if(!_0x94aed9||_0x94aed9===_0x31445f(0x1c0))return;await telegramBotService_1[_0x31445f(0x1cc)][_0x31445f(0x18e)](_0x55cbb6['shopId'],_0x55cbb6,_0x94aed9);}catch(_0x4fb740){console[_0x31445f(0x23e)](_0x31445f(0x203),_0x4fb740);}}async[a37_0x58cd0e(0x226)](_0xc43993){const _0x5b4ec3=a37_0x58cd0e;console[_0x5b4ec3(0x213)](_0x5b4ec3(0x22a)+_0xc43993);const _0x4e9215=await database_1[_0x5b4ec3(0x176)][_0x5b4ec3(0x193)][_0x5b4ec3(0x1a3)]({'where':{'id':_0xc43993},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x4e9215)throw new Error(_0x5b4ec3(0x17d));if(_0x4e9215[_0x5b4ec3(0x190)]!=='cointopay'&&_0x4e9215['gateway']!==_0x5b4ec3(0x1e7))throw new Error(_0x5b4ec3(0x1f7));console[_0x5b4ec3(0x213)]('✅\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20'+_0x4e9215['gateway']+_0x5b4ec3(0x20a)+_0xc43993),await this[_0x5b4ec3(0x1e8)](_0x4e9215),console['log'](_0x5b4ec3(0x201)+_0xc43993);}[a37_0x58cd0e(0x18d)](){const _0x25f07a=a37_0x58cd0e,_0x28cfc3=this[_0x25f07a(0x1ef)]?this[_0x25f07a(0x1fb)]:undefined,_0xa9f5eb=Array[_0x25f07a(0x1c9)](this['paymentTimers']['values']())[_0x25f07a(0x177)](_0x184ea2=>({'paymentId':_0x184ea2[_0x25f07a(0x186)],'gatewayPaymentId':_0x184ea2[_0x25f07a(0x21d)],'createdAt':_0x184ea2[_0x25f07a(0x235)],'timersCount':_0x184ea2['timers'][_0x25f07a(0x15d)]}));return{'isActive':!!this[_0x25f07a(0x1ef)],'globalCheckIntervalMinutes':this[_0x25f07a(0x1fb)]/(0x3e8*0x3c),'expiryDays':this[_0x25f07a(0x219)],'activeIndividualTimers':this[_0x25f07a(0x236)][_0x25f07a(0x162)],'nextGlobalCheckIn':_0x28cfc3,'paymentTimersDetails':_0xa9f5eb};}[a37_0x58cd0e(0x17e)](_0x57e4ef){const _0xdcd7d2=a37_0x58cd0e,_0x722a32=this[_0xdcd7d2(0x236)][_0xdcd7d2(0x218)](_0x57e4ef);if(_0x722a32)return{'hasTimers':!![],'timersCount':_0x722a32['timers'][_0xdcd7d2(0x15d)],'createdAt':_0x722a32[_0xdcd7d2(0x235)],'gatewayPaymentId':_0x722a32['gatewayPaymentId']};return{'hasTimers':![]};}}exports[a37_0x58cd0e(0x1f3)]=CoinToPayStatusService,exports[a37_0x58cd0e(0x1b0)]=new CoinToPayStatusService();