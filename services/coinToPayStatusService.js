'use strict';const a37_0x5eedd7=a37_0x1628;(function(_0x557bc5,_0x49886){const _0x1e9107=a37_0x1628,_0x4b535c=_0x557bc5();while(!![]){try{const _0x4b8cb2=-parseInt(_0x1e9107(0x1d9))/0x1*(-parseInt(_0x1e9107(0x11f))/0x2)+-parseInt(_0x1e9107(0x16b))/0x3+-parseInt(_0x1e9107(0x1bb))/0x4+-parseInt(_0x1e9107(0x1d5))/0x5+parseInt(_0x1e9107(0x17a))/0x6+parseInt(_0x1e9107(0x1b0))/0x7+parseInt(_0x1e9107(0x1c5))/0x8*(parseInt(_0x1e9107(0x16d))/0x9);if(_0x4b8cb2===_0x49886)break;else _0x4b535c['push'](_0x4b535c['shift']());}catch(_0x2f42e4){_0x4b535c['push'](_0x4b535c['shift']());}}}(a37_0x3696,0x41a3c));function a37_0x1628(_0x353373,_0x5b21d9){const _0x3696bd=a37_0x3696();return a37_0x1628=function(_0x1628b0,_0x107329){_0x1628b0=_0x1628b0-0xf0;let _0x1e06f9=_0x3696bd[_0x1628b0];return _0x1e06f9;},a37_0x1628(_0x353373,_0x5b21d9);}function a37_0x3696(){const _0x5b5114=['shopId','\x20current\x20status:\x20','\x20to\x20clear','auto_expire','❌\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','stringify','✅\x20[CHECK]\x20Payment\x20','Webhook\x20event\x20','\x20updated\x20successfully','schedule_created','gatewayPaymentId','./gateways/coinToPay2Service','update','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','PENDING','📊\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','⚠️\x20[CHECK]\x20Payment\x20','✅\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','webhook_send','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','paymentId','shop','\x20expired\x20CoinToPay\x20payments','paid','PAID','Payment\x20older\x20than\x20',',\x20status=','payment.failed','❌\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','🪙\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','gateway','coinToPay2Service','from','⏰\x20[HOURLY]\x20Payment\x20','create','\x20not\x20enabled\x20for\x20shop\x20','🪙\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','\x20\x20\x20-\x20GatewayPaymentId:\x20','⏰\x20[EXPIRY]\x20Payment\x20','checkExpiredPayments','\x20(age:\x20','iban','defineProperty','🛑\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','cointopay_status_check_','🏦\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes','EXPIRY_DAYS','\x20\x20\x20-\x20gatewayPaymentId:\x20','427401kNUrYv','customerEmail','18aQJVNt','application/json','includes','COMPLETED','findUnique','🪙\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','cointopay','❌\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','globalCheckInterval','findMany','🔍\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','EXPIRED','\x20has\x20no\x20gatewayPaymentId','2851764zVEPAt','💰\x20[CHECK]\x20Payment\x20','📊\x20[CHECK]\x20Payment\x20','⚠️\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','ms)','sendPaymentStatusNotification','\x20triggered\x20for\x20payment\x20','\x20not\x20found,\x20clearing\x20timers','message','logCoinToPayError','toFixed','timers','\x20pending\x20CoinToPay\x20payments','now','\x20\x20\x20❌\x20Error:\x20','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','map','log','\x20completed\x20for\x20payment\x20','📈\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','❌\x20[TIMER]\x20Failed\x20individual\x20check\x20#','🆔\x20[CHECK]\x20Transaction\x20ID:\x20','🔍\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','\x20status\x20from\x20','GLOBAL_CHECK_INTERVAL_MS','\x20days\x20without\x20payment\x20confirmation','checkSinglePaymentById','./telegramBotService','❌\x20[HOURLY]\x20Payment\x20','paymentLink','5\x20minutes','\x20status:\x20','\x20\x20\x20-\x20Status:\x20','bankDetails','\x20\x20\x20-\x20paymentId:\x20','__importDefault','\x20\x20\x20-\x20ShopId:\x20','description','currentPayments','\x20payment\x20','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','✅\x20[DEBUG]\x20Successfully\x20scheduled\x20','\x20expired','__esModule','createdOn',',\x20clearing\x20individual\x20timers','\x20\x20\x20📝\x20Context:','🪙\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','COINTOPAY_ERROR','⏰\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','not\x20confirmed','\x20with\x20status\x20','logCoinToPayStatus','stopPeriodicStatusCheck','1101562WUvYkD','\x20\x20\x20📍\x20Source:\x20','\x20in\x20','default','orderId','CoinToPay2Service','📊\x20[HOURLY]\x20Payment\x20','\x20\x20\x20📅\x20Time:\x20','created','\x20\x20\x20-\x20Gateway:\x20','amount','1492040BuDaCL','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','h),\x20skipping\x20global\x20check','\x20for\x20payment\x20','set','has','paymentLinkId','paidAt','\x20status\x20is\x20','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','1576248ZrdYGJ','🪙\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','\x20initial\x20timers\x20for\x20payment\x20','SINGLE','failed','\x20days','values','transactionId','getPaymentTimerInfo','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','startPeriodicStatusCheck','expired',',\x20stopping\x20individual\x20checks','CoinToPayStatusService','remitterIban','getGatewayIdByName','1766390idznHB','Bank\x20Details:\x20','./gateways/coinToPayService','webhookUrl','1eBGZxA','2\x20minutes','❌\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','\x20is\x20valid\x20for\x20checking,\x20proceeding...','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','\x20updated:\x20currentPayments=','coinToPayStatusService','confirmedOn','clearPaymentTimers','✅\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','currency','❌\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','webhookLog','🛑\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','\x20marked\x20as\x20paid\x20at:\x20','\x20has\x20no\x20gatewayPaymentId,\x20skipping','size','catch','\x20days,\x20marking\x20as\x20EXPIRED','getTime','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','status_check','✅\x20[TIMER]\x20Individual\x20check\x20#','\x20details:','push','timestamp','CoinToPayService','\x20found:','error','length','type','checkSinglePayment','../types/gateway',':\x20type=','Success','sendShopWebhook','setDate','.\x20Remaining\x20active\x20timers:\x20','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','📈\x20[COINTOPAY]\x20Payment\x20','\x20->\x20','✅\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','sendPaymentNotification','✅\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','gatewayOrderId',',\x20currentPayments=','paymentTimers','Payment\x20not\x20found','📊\x20[CHECK]\x20CoinToPay2\x20payment\x20','FAILED','createdAt','221786RUBniY','⏰\x20[GLOBAL]\x20Payment\x20','🪙\x20[ERROR]\x20CoinToPay\x20Error:\x20','Shop\x20webhook\x20sent\x20to\x20','not\x20found','cointopay2','\x20\x20\x20📝\x20Details:','forEach','status','toISOString','floor','get','coinToPayService','🧹\x20[DEBUG]\x20Clearing\x20','\x20(after\x20','stack','checkPaymentById','loggerService','paymentDetails','✅\x20[EXPIRY]\x20Payment\x20','checkAllPendingPayments','unknown','payment','toLowerCase','✅\x20[HOURLY]\x20Payment\x20','checkPaymentStatus','✅\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','adminNotes'];a37_0x3696=function(){return _0x5b5114;};return a37_0x3696();}var __importDefault=this&&this[a37_0x5eedd7(0x19d)]||function(_0x184cf3){const _0x36b63d=a37_0x5eedd7;return _0x184cf3&&_0x184cf3[_0x36b63d(0x1a5)]?_0x184cf3:{'default':_0x184cf3};};Object[a37_0x5eedd7(0x165)](exports,a37_0x5eedd7(0x1a5),{'value':!![]}),exports[a37_0x5eedd7(0xf2)]=exports['CoinToPayStatusService']=void 0x0;const coinToPayService_1=require(a37_0x5eedd7(0x1d7)),coinToPay2Service_1=require(a37_0x5eedd7(0x146)),gateway_1=require(a37_0x5eedd7(0x10c)),database_1=__importDefault(require('../config/database')),telegramBotService_1=require(a37_0x5eedd7(0x195)),loggerService_1=require('./loggerService');class CoinToPayStatusService{constructor(){const _0x45c4fa=a37_0x5eedd7;this[_0x45c4fa(0x175)]=null,this['GLOBAL_CHECK_INTERVAL_MS']=0x3c*0x3c*0x3e8,this[_0x45c4fa(0x169)]=0x5,this['paymentTimers']=new Map(),this['coinToPayService']=new coinToPayService_1[(_0x45c4fa(0x106))](),this['coinToPay2Service']=new coinToPay2Service_1[(_0x45c4fa(0x1b5))](),console[_0x45c4fa(0x18b)]('🪙\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2');}['schedulePaymentChecks'](_0x47c869,_0x270a73){const _0x3cdff7=a37_0x5eedd7;console[_0x3cdff7(0x18b)]('🪙\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:'),console[_0x3cdff7(0x18b)](_0x3cdff7(0x19c)+_0x47c869),console[_0x3cdff7(0x18b)](_0x3cdff7(0x16a)+_0x270a73),this[_0x3cdff7(0xf4)](_0x47c869);const _0x3a9f91=[],_0xdde894=new Date(),_0x3e842f=[{'delay':0x1*0x3c*0x3e8,'description':'1\x20minute'},{'delay':0x2*0x3c*0x3e8,'description':_0x3cdff7(0x1da)},{'delay':0x5*0x3c*0x3e8,'description':_0x3cdff7(0x198)},{'delay':0x5*0x3c*0x3e8,'description':'5\x20minutes'}];console[_0x3cdff7(0x18b)]('🪙\x20[DEBUG]\x20Creating\x20'+_0x3e842f['length']+_0x3cdff7(0x1c7)+_0x47c869);let _0x56f81b=0x0;_0x3e842f[_0x3cdff7(0x126)]((_0x92fe47,_0x395a88)=>{const _0x53705e=_0x3cdff7;_0x56f81b+=_0x92fe47['delay'];const _0x5bcd62=setTimeout(async()=>{const _0x5bed12=a37_0x1628;console['log']('🪙\x20[TIMER]\x20Individual\x20check\x20#'+(_0x395a88+0x1)+_0x5bed12(0x180)+_0x47c869+_0x5bed12(0x12d)+_0x92fe47['description']+')');try{await this['checkSinglePaymentById'](_0x47c869),console[_0x5bed12(0x18b)](_0x5bed12(0x102)+(_0x395a88+0x1)+_0x5bed12(0x18c)+_0x47c869);}catch(_0x17dc10){console[_0x5bed12(0x108)](_0x5bed12(0x18e)+(_0x395a88+0x1)+_0x5bed12(0x1be)+_0x47c869+':',_0x17dc10),this[_0x5bed12(0x183)](_0x47c869,_0x270a73,_0x17dc10,_0x5bed12(0x101),{'checkNumber':_0x395a88+0x1,'scheduledAfter':_0x92fe47[_0x5bed12(0x19f)],'isIndividualCheck':!![]});}},_0x56f81b);_0x3a9f91[_0x53705e(0x104)](_0x5bcd62),console[_0x53705e(0x18b)]('⏰\x20[DEBUG]\x20Scheduled\x20check\x20#'+(_0x395a88+0x1)+'\x20for\x20payment\x20'+_0x47c869+_0x53705e(0x1b2)+_0x56f81b/0x3e8+'\x20seconds\x20('+_0x92fe47[_0x53705e(0x19f)]+')');});const _0x1ff894=setInterval(async()=>{const _0x5d0d51=_0x3cdff7;console[_0x5d0d51(0x18b)](_0x5d0d51(0x158)+_0x47c869);try{const _0xf108ed=await database_1['default'][_0x5d0d51(0x135)]['findUnique']({'where':{'id':_0x47c869},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0xf108ed){console[_0x5d0d51(0x18b)](_0x5d0d51(0x196)+_0x47c869+_0x5d0d51(0x181)),this[_0x5d0d51(0xf4)](_0x47c869);return;}console[_0x5d0d51(0x18b)](_0x5d0d51(0x1b6)+_0x47c869+_0x5d0d51(0x13c)+_0xf108ed[_0x5d0d51(0x127)]);if(_0xf108ed[_0x5d0d51(0x127)]!==_0x5d0d51(0x149)){console[_0x5d0d51(0x18b)](_0x5d0d51(0x137)+_0x47c869+_0x5d0d51(0x1c3)+_0xf108ed[_0x5d0d51(0x127)]+',\x20stopping\x20individual\x20checks'),this[_0x5d0d51(0xf4)](_0x47c869);return;}const _0x53e143=Math[_0x5d0d51(0x129)]((Date[_0x5d0d51(0x187)]()-_0xf108ed[_0x5d0d51(0x11e)][_0x5d0d51(0xff)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x53e143>=this[_0x5d0d51(0x169)]){console['log'](_0x5d0d51(0x15c)+_0x47c869+'\x20is\x20older\x20than\x20'+this['EXPIRY_DAYS']+_0x5d0d51(0x112)),this[_0x5d0d51(0xf4)](_0x47c869);return;}await this['checkSinglePaymentById'](_0x47c869),console['log']('✅\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20'+_0x47c869);}catch(_0x331fcd){console['error']('❌\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20'+_0x47c869+':',_0x331fcd),this[_0x5d0d51(0x183)](_0x47c869,_0x270a73,_0x331fcd,'status_check',{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x3a9f91[_0x3cdff7(0x104)](_0x1ff894),this['paymentTimers'][_0x3cdff7(0x1bf)](_0x47c869,{'timers':_0x3a9f91,'paymentId':_0x47c869,'gatewayPaymentId':_0x270a73,'createdAt':_0xdde894}),console['log'](_0x3cdff7(0x1a3)+_0x3e842f[_0x3cdff7(0x109)]+_0x3cdff7(0x1c4)+_0x47c869),console['log'](_0x3cdff7(0x14a)+this[_0x3cdff7(0x11a)][_0x3cdff7(0xfc)]),this[_0x3cdff7(0x1ae)](_0x47c869,_0x270a73,_0x3cdff7(0x149),_0x3cdff7(0x149),_0x3cdff7(0x101),{'action':_0x3cdff7(0x144),'scheduledChecks':_0x3e842f[_0x3cdff7(0x109)],'firstCheckIn':_0x3e842f[0x0]['delay']/0x3e8,'totalTimers':this[_0x3cdff7(0x11a)][_0x3cdff7(0xfc)]});}['clearPaymentTimers'](_0x4d69b0){const _0x19081b=a37_0x5eedd7,_0x1c3ca0=this[_0x19081b(0x11a)][_0x19081b(0x12a)](_0x4d69b0);_0x1c3ca0?(console[_0x19081b(0x18b)](_0x19081b(0x12c)+_0x1c3ca0[_0x19081b(0x185)][_0x19081b(0x109)]+'\x20timers\x20for\x20payment\x20'+_0x4d69b0),_0x1c3ca0[_0x19081b(0x185)][_0x19081b(0x126)]((_0x343d3a,_0x1bef2d)=>{const _0x14e170=_0x19081b;_0x343d3a&&(clearTimeout(_0x343d3a),clearInterval(_0x343d3a),console[_0x14e170(0x18b)]('🧹\x20[DEBUG]\x20Cleared\x20timer\x20#'+(_0x1bef2d+0x1)+_0x14e170(0x1be)+_0x4d69b0));}),this[_0x19081b(0x11a)]['delete'](_0x4d69b0),console[_0x19081b(0x18b)](_0x19081b(0x139)+_0x4d69b0+_0x19081b(0x111)+this[_0x19081b(0x11a)]['size'])):console[_0x19081b(0x18b)](_0x19081b(0x17d)+_0x4d69b0+_0x19081b(0x13d));}async[a37_0x5eedd7(0x194)](_0x5a1182){const _0x11d8ff=a37_0x5eedd7;console[_0x11d8ff(0x18b)]('🔍\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20'+_0x5a1182);const _0x3b1086=await database_1[_0x11d8ff(0x1b3)][_0x11d8ff(0x135)][_0x11d8ff(0x171)]({'where':{'id':_0x5a1182},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x3b1086){console[_0x11d8ff(0x18b)]('❌\x20[CHECK]\x20Payment\x20'+_0x5a1182+'\x20not\x20found\x20in\x20database');return;}console[_0x11d8ff(0x18b)]('📊\x20[CHECK]\x20Payment\x20'+_0x5a1182+_0x11d8ff(0x107)),console[_0x11d8ff(0x18b)](_0x11d8ff(0x1b9)+_0x3b1086['gateway']),console[_0x11d8ff(0x18b)](_0x11d8ff(0x19a)+_0x3b1086[_0x11d8ff(0x127)]),console['log'](_0x11d8ff(0x160)+_0x3b1086[_0x11d8ff(0x145)]),console[_0x11d8ff(0x18b)]('\x20\x20\x20-\x20Amount:\x20'+_0x3b1086[_0x11d8ff(0x1ba)]+'\x20'+_0x3b1086[_0x11d8ff(0xf6)]),console[_0x11d8ff(0x18b)](_0x11d8ff(0x19e)+_0x3b1086[_0x11d8ff(0x13b)]);if(_0x3b1086[_0x11d8ff(0x159)]!=='cointopay'&&_0x3b1086[_0x11d8ff(0x159)]!==_0x11d8ff(0x124)){console[_0x11d8ff(0x18b)]('⚠️\x20[CHECK]\x20Payment\x20'+_0x5a1182+'\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20'+_0x3b1086['gateway']+')');return;}if(_0x3b1086[_0x11d8ff(0x127)]!=='PENDING'){console[_0x11d8ff(0x18b)](_0x11d8ff(0x14b)+_0x5a1182+_0x11d8ff(0x1c3)+_0x3b1086[_0x11d8ff(0x127)]+_0x11d8ff(0x1d1)),this['clearPaymentTimers'](_0x5a1182);return;}if(!_0x3b1086[_0x11d8ff(0x145)]){console[_0x11d8ff(0x18b)](_0x11d8ff(0x14b)+_0x5a1182+_0x11d8ff(0x179));return;}console['log'](_0x11d8ff(0x141)+_0x5a1182+_0x11d8ff(0x1dc)),await this[_0x11d8ff(0x10b)](_0x3b1086);}[a37_0x5eedd7(0x1ae)](_0x278e35,_0x5bc802,_0x1e8a32,_0x23119b,_0x49a3c0,_0x13c16c){const _0x4b410e=a37_0x5eedd7,_0x4886e3={'type':'COINTOPAY_STATUS_CHANGE','paymentId':_0x278e35,'gatewayPaymentId':_0x5bc802,'oldStatus':_0x1e8a32,'newStatus':_0x23119b,'source':_0x49a3c0,'timestamp':new Date()['toISOString'](),'details':_0x13c16c||{}};loggerService_1[_0x4b410e(0x130)]['logCoinToPayStatus'](_0x4886e3),console[_0x4b410e(0x18b)](_0x4b410e(0x1a9)+_0x278e35+'\x20('+_0x5bc802+')'),console['log']('\x20\x20\x20📊\x20Status:\x20'+_0x1e8a32+_0x4b410e(0x114)+_0x23119b),console['log'](_0x4b410e(0x1b1)+_0x49a3c0),console[_0x4b410e(0x18b)]('\x20\x20\x20📅\x20Time:\x20'+_0x4886e3[_0x4b410e(0x105)]),_0x13c16c&&console['log'](_0x4b410e(0x125),_0x13c16c);}['logCoinToPayError'](_0x1b7cd4,_0x2fada0,_0x281847,_0x50441b,_0x1a2aa6){const _0x1864b1=a37_0x5eedd7,_0x5a407c={'type':_0x1864b1(0x1aa),'paymentId':_0x1b7cd4,'gatewayPaymentId':_0x2fada0,'error':_0x281847 instanceof Error?{'message':_0x281847[_0x1864b1(0x182)],'stack':_0x281847[_0x1864b1(0x12e)]}:_0x281847,'source':_0x50441b,'timestamp':new Date()[_0x1864b1(0x128)](),'context':_0x1a2aa6||{}};loggerService_1['loggerService']['logCoinToPayError'](_0x5a407c),console[_0x1864b1(0x108)](_0x1864b1(0x121)+_0x1b7cd4+'\x20('+_0x2fada0+')'),console['error'](_0x1864b1(0x188)+(_0x281847 instanceof Error?_0x281847[_0x1864b1(0x182)]:_0x281847)),console[_0x1864b1(0x108)](_0x1864b1(0x1b1)+_0x50441b),console[_0x1864b1(0x108)](_0x1864b1(0x1b7)+_0x5a407c[_0x1864b1(0x105)]),_0x1a2aa6&&console['error'](_0x1864b1(0x1a8),_0x1a2aa6);}[a37_0x5eedd7(0x1cf)](){const _0x3a3cf6=a37_0x5eedd7;console['log']('🪙\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)'),this[_0x3a3cf6(0x133)]()[_0x3a3cf6(0xfd)](_0x2ebe56=>{const _0x545d8a=_0x3a3cf6;console[_0x545d8a(0x108)](_0x545d8a(0x157),_0x2ebe56);}),this[_0x3a3cf6(0x175)]=setInterval(async()=>{const _0x1d3ba6=_0x3a3cf6;try{console[_0x1d3ba6(0x18b)](_0x1d3ba6(0x15f)),await this['checkAllPendingPayments'](),console[_0x1d3ba6(0x18b)](_0x1d3ba6(0x115));}catch(_0x1795ab){console['error']('❌\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:',_0x1795ab);}},this[_0x3a3cf6(0x192)]),console[_0x3a3cf6(0x18b)](_0x3a3cf6(0x14c));}[a37_0x5eedd7(0x1af)](){const _0x140a81=a37_0x5eedd7;console[_0x140a81(0x18b)](_0x140a81(0x166));this[_0x140a81(0x175)]&&(clearInterval(this[_0x140a81(0x175)]),this['globalCheckInterval']=null,console['log'](_0x140a81(0xf9)));const _0x31cda1=this['paymentTimers']['size'];for(const [_0x2e7cf8]of this[_0x140a81(0x11a)]){this['clearPaymentTimers'](_0x2e7cf8);}console[_0x140a81(0x18b)]('🛑\x20[SHUTDOWN]\x20Cleared\x20'+_0x31cda1+'\x20individual\x20payment\x20timers');}async['checkAllPendingPayments'](){const _0x404b07=a37_0x5eedd7;try{console[_0x404b07(0x18b)](_0x404b07(0x1c6));const _0x2df057=await database_1[_0x404b07(0x1b3)]['payment'][_0x404b07(0x176)]({'where':{'gateway':{'in':[_0x404b07(0x173),'cointopay2']},'status':_0x404b07(0x149),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x404b07(0x18b)]('🪙\x20[GLOBAL]\x20Found\x20'+_0x2df057[_0x404b07(0x109)]+_0x404b07(0x186));if(_0x2df057[_0x404b07(0x109)]===0x0){console[_0x404b07(0x18b)](_0x404b07(0x172));return;}const _0x44bb1f=await this[_0x404b07(0x162)](_0x2df057);console[_0x404b07(0x18b)]('⏰\x20[GLOBAL]\x20Found\x20'+_0x44bb1f[_0x404b07(0x109)]+_0x404b07(0x151));let _0xb7feca=0x0,_0x301a37=0x0;for(const _0x23c866 of _0x2df057){try{if(_0x44bb1f[_0x404b07(0x16f)](_0x23c866['id'])){console[_0x404b07(0x18b)](_0x404b07(0x120)+_0x23c866['id']+_0x404b07(0x1bc)),_0x301a37++;continue;}if(this[_0x404b07(0x11a)][_0x404b07(0x1c0)](_0x23c866['id'])){console[_0x404b07(0x18b)]('⏰\x20[GLOBAL]\x20Payment\x20'+_0x23c866['id']+_0x404b07(0x148)),_0x301a37++;continue;}const _0xa7cb82=(Date[_0x404b07(0x187)]()-_0x23c866[_0x404b07(0x11e)][_0x404b07(0xff)]())/(0x3e8*0x3c*0x3c);if(_0xa7cb82<0x1){console[_0x404b07(0x18b)](_0x404b07(0x120)+_0x23c866['id']+'\x20is\x20too\x20new\x20('+_0xa7cb82[_0x404b07(0x184)](0x1)+_0x404b07(0x1bd)),_0x301a37++;continue;}console[_0x404b07(0x18b)](_0x404b07(0x190)+_0x23c866['id']+_0x404b07(0x163)+_0xa7cb82['toFixed'](0x1)+'h)'),await this[_0x404b07(0x10b)](_0x23c866),_0xb7feca++,await new Promise(_0x3c1cd2=>setTimeout(_0x3c1cd2,0x7d0));}catch(_0x42a56b){console[_0x404b07(0x108)](_0x404b07(0x174)+_0x23c866['id']+':',_0x42a56b),this['logCoinToPayError'](_0x23c866['id'],_0x23c866['gatewayPaymentId']||'unknown',_0x42a56b,_0x404b07(0x101),{'isGlobalCheck':!![],'paymentAmount':_0x23c866[_0x404b07(0x1ba)],'paymentCurrency':_0x23c866[_0x404b07(0xf6)],'shopId':_0x23c866[_0x404b07(0x13b)],'createdAt':_0x23c866[_0x404b07(0x11e)]}),loggerService_1[_0x404b07(0x130)]['logWhiteDomainError'](_0x404b07(0x173),'/status/'+_0x23c866[_0x404b07(0x145)],_0x42a56b);}}console[_0x404b07(0x18b)]('✅\x20[GLOBAL]\x20Global\x20check\x20completed:\x20'+_0xb7feca+'\x20checked,\x20'+_0x301a37+'\x20skipped,\x20'+_0x44bb1f[_0x404b07(0x109)]+_0x404b07(0x1a4));}catch(_0x43afa1){console[_0x404b07(0x108)](_0x404b07(0x13f),_0x43afa1);}}async[a37_0x5eedd7(0x162)](_0xf6bbc3){const _0x34fc61=a37_0x5eedd7,_0x6d5dd6=[],_0x4219ee=new Date();_0x4219ee[_0x34fc61(0x110)](_0x4219ee['getDate']()-this[_0x34fc61(0x169)]),console['log'](_0x34fc61(0x1ab)+this[_0x34fc61(0x169)]+'\x20days\x20(created\x20before\x20'+_0x4219ee['toISOString']()+')');for(const _0x1d9dd9 of _0xf6bbc3){if(_0x1d9dd9['createdAt']<_0x4219ee){console[_0x34fc61(0x18b)](_0x34fc61(0x161)+_0x1d9dd9['id']+'\x20is\x20older\x20than\x20'+this[_0x34fc61(0x169)]+_0x34fc61(0xfe));try{this[_0x34fc61(0x1ae)](_0x1d9dd9['id'],_0x1d9dd9[_0x34fc61(0x145)]||_0x34fc61(0x134),_0x34fc61(0x149),_0x34fc61(0x178),_0x34fc61(0x13e),{'reason':_0x34fc61(0x154)+this[_0x34fc61(0x169)]+_0x34fc61(0x1ca),'createdAt':_0x1d9dd9[_0x34fc61(0x11e)],'daysSinceCreation':Math[_0x34fc61(0x129)]((Date[_0x34fc61(0x187)]()-_0x1d9dd9[_0x34fc61(0x11e)][_0x34fc61(0xff)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x1d9dd9[_0x34fc61(0x1ba)],'paymentCurrency':_0x1d9dd9[_0x34fc61(0xf6)],'shopId':_0x1d9dd9['shopId']}),await database_1[_0x34fc61(0x1b3)][_0x34fc61(0x135)][_0x34fc61(0x147)]({'where':{'id':_0x1d9dd9['id']},'data':{'status':_0x34fc61(0x178),'updatedAt':new Date(),'adminNotes':'Automatically\x20expired\x20after\x20'+this[_0x34fc61(0x169)]+_0x34fc61(0x193)}}),await database_1['default']['webhookLog'][_0x34fc61(0x15d)]({'data':{'paymentId':_0x1d9dd9['id'],'shopId':_0x1d9dd9['shopId'],'event':'cointopay_auto_expired','statusCode':0xc8,'responseBody':JSON[_0x34fc61(0x140)]({'reason':_0x34fc61(0x154)+this['EXPIRY_DAYS']+_0x34fc61(0x1ca),'createdAt':_0x1d9dd9['createdAt'],'expiredAt':new Date()[_0x34fc61(0x128)](),'daysSinceCreation':Math[_0x34fc61(0x129)]((Date[_0x34fc61(0x187)]()-_0x1d9dd9[_0x34fc61(0x11e)][_0x34fc61(0xff)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x34fc61(0x10f)](_0x1d9dd9,_0x34fc61(0x178)),await this['sendPaymentStatusNotification'](_0x1d9dd9,_0x34fc61(0x178)),this[_0x34fc61(0xf4)](_0x1d9dd9['id']),_0x6d5dd6['push'](_0x1d9dd9['id']),console[_0x34fc61(0x18b)](_0x34fc61(0x132)+_0x1d9dd9['id']+_0x34fc61(0x1ce)+this[_0x34fc61(0x169)]+'-day\x20timeout');}catch(_0x48a27c){console[_0x34fc61(0x108)](_0x34fc61(0xf7)+_0x1d9dd9['id']+':',_0x48a27c),this[_0x34fc61(0x183)](_0x1d9dd9['id'],_0x1d9dd9[_0x34fc61(0x145)]||'unknown',_0x48a27c,_0x34fc61(0x13e),{'reason':'Failed\x20to\x20mark\x20payment\x20as\x20expired','createdAt':_0x1d9dd9[_0x34fc61(0x11e)],'daysSinceCreation':Math[_0x34fc61(0x129)]((Date[_0x34fc61(0x187)]()-_0x1d9dd9[_0x34fc61(0x11e)][_0x34fc61(0xff)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x6d5dd6;}async['checkSinglePayment'](_0xaefa7a){const _0x20c9ac=a37_0x5eedd7;if(!_0xaefa7a[_0x20c9ac(0x145)]){console[_0x20c9ac(0x18b)](_0x20c9ac(0x14b)+_0xaefa7a['id']+_0x20c9ac(0xfb));return;}console[_0x20c9ac(0x18b)]('🔍\x20[CHECK]\x20Checking\x20'+_0xaefa7a['gateway']+'\x20payment\x20'+_0xaefa7a['id']+'\x20('+_0xaefa7a[_0x20c9ac(0x145)]+')');try{let _0x13b926;_0xaefa7a[_0x20c9ac(0x159)]===_0x20c9ac(0x124)?(_0x13b926=await this[_0x20c9ac(0x15a)]['checkPaymentStatus'](_0xaefa7a[_0x20c9ac(0x145)]),console['log'](_0x20c9ac(0x11c)+_0xaefa7a['id']+_0x20c9ac(0x199)+_0x13b926[_0x20c9ac(0x127)])):(_0x13b926=await this[_0x20c9ac(0x12b)][_0x20c9ac(0x138)](_0xaefa7a[_0x20c9ac(0x145)]),console[_0x20c9ac(0x18b)]('📊\x20[CHECK]\x20CoinToPay\x20payment\x20'+_0xaefa7a['id']+_0x20c9ac(0x199)+_0x13b926[_0x20c9ac(0x127)]));_0x13b926[_0x20c9ac(0x131)]&&console[_0x20c9ac(0x18b)]('📊\x20[CHECK]\x20Payment\x20'+_0xaefa7a['id']+_0x20c9ac(0x103),{'iban':_0x13b926[_0x20c9ac(0x131)][_0x20c9ac(0x164)]||_0x20c9ac(0x123),'transactionId':_0x13b926[_0x20c9ac(0x131)][_0x20c9ac(0x1cc)],'createdOn':_0x13b926['paymentDetails'][_0x20c9ac(0x1a6)],'confirmedOn':_0x13b926['paymentDetails'][_0x20c9ac(0xf3)]||_0x20c9ac(0x1ac)});if(_0x13b926['status']!==_0xaefa7a['status']){console[_0x20c9ac(0x18b)]('🔄\x20[CHECK]\x20Updating\x20payment\x20'+_0xaefa7a['id']+_0x20c9ac(0x191)+_0xaefa7a['status']+'\x20to\x20'+_0x13b926[_0x20c9ac(0x127)]),this[_0x20c9ac(0x1ae)](_0xaefa7a['id'],_0xaefa7a[_0x20c9ac(0x145)],_0xaefa7a[_0x20c9ac(0x127)],_0x13b926[_0x20c9ac(0x127)],_0x20c9ac(0x101),{'paymentDetails':_0x13b926[_0x20c9ac(0x131)],'amount':_0x13b926[_0x20c9ac(0x1ba)],'currency':_0x13b926[_0x20c9ac(0xf6)],'shopId':_0xaefa7a[_0x20c9ac(0x13b)],'checkTimestamp':new Date()[_0x20c9ac(0x128)]()});const _0x100f63={'status':_0x13b926[_0x20c9ac(0x127)],'updatedAt':new Date()};_0x13b926[_0x20c9ac(0x127)]===_0x20c9ac(0x153)&&_0xaefa7a[_0x20c9ac(0x127)]!=='PAID'&&(_0x100f63[_0x20c9ac(0x1c2)]=new Date(),console[_0x20c9ac(0x18b)](_0x20c9ac(0x17b)+_0xaefa7a['id']+_0x20c9ac(0xfa)+_0x100f63[_0x20c9ac(0x1c2)]['toISOString']()));if(_0x13b926[_0x20c9ac(0x131)]){const _0x18be5d=_0x13b926[_0x20c9ac(0x131)];_0x18be5d[_0x20c9ac(0x164)]&&(_0x100f63[_0x20c9ac(0x1d3)]=_0x18be5d[_0x20c9ac(0x164)],console[_0x20c9ac(0x18b)]('🏦\x20[CHECK]\x20Saved\x20IBAN:\x20'+_0x18be5d[_0x20c9ac(0x164)]));if(_0x18be5d[_0x20c9ac(0x19b)]){const _0x5aaeac=_0xaefa7a[_0x20c9ac(0x13a)]||'',_0x3185a1=_0x20c9ac(0x1d6)+_0x18be5d['bankDetails'];_0x100f63['adminNotes']=_0x5aaeac?_0x5aaeac+'\x0a\x0a'+_0x3185a1:_0x3185a1,console[_0x20c9ac(0x18b)](_0x20c9ac(0x168));}_0x18be5d[_0x20c9ac(0x1cc)]&&console[_0x20c9ac(0x18b)](_0x20c9ac(0x18f)+_0x18be5d[_0x20c9ac(0x1cc)]),_0x18be5d[_0x20c9ac(0xf3)]&&console['log']('✅\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20'+_0x18be5d[_0x20c9ac(0xf3)]);}await database_1['default'][_0x20c9ac(0x135)][_0x20c9ac(0x147)]({'where':{'id':_0xaefa7a['id']},'data':_0x100f63});if(_0x13b926[_0x20c9ac(0x127)]===_0x20c9ac(0x153)&&_0xaefa7a[_0x20c9ac(0x127)]!==_0x20c9ac(0x153)){console[_0x20c9ac(0x18b)](_0x20c9ac(0x113)+_0xaefa7a['id']+_0x20c9ac(0x100));const _0x44ce32=await database_1[_0x20c9ac(0x1b3)][_0x20c9ac(0x135)]['findUnique']({'where':{'id':_0xaefa7a['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x44ce32?.[_0x20c9ac(0x1c1)]&&_0x44ce32[_0x20c9ac(0x197)])try{const _0x245a2c=_0x44ce32[_0x20c9ac(0x197)];console[_0x20c9ac(0x18b)](_0x20c9ac(0x18d)+_0x245a2c['id']+_0x20c9ac(0x10d)+_0x245a2c[_0x20c9ac(0x10a)]+_0x20c9ac(0x119)+_0x245a2c[_0x20c9ac(0x1a0)]+_0x20c9ac(0x155)+_0x245a2c['status']);const _0x26449c=_0x245a2c['currentPayments']+0x1,_0x4777a1=_0x245a2c[_0x20c9ac(0x10a)]===_0x20c9ac(0x1c8)?_0x20c9ac(0x170):_0x245a2c[_0x20c9ac(0x127)];await database_1[_0x20c9ac(0x1b3)][_0x20c9ac(0x197)]['update']({'where':{'id':_0x245a2c['id']},'data':{'currentPayments':_0x26449c,'status':_0x4777a1,'updatedAt':new Date()}}),console['log']('✅\x20[COINTOPAY]\x20Payment\x20link\x20'+_0x245a2c['id']+_0x20c9ac(0xf1)+_0x245a2c[_0x20c9ac(0x1a0)]+'\x20->\x20'+_0x26449c+',\x20status='+_0x245a2c[_0x20c9ac(0x127)]+_0x20c9ac(0x114)+_0x4777a1);}catch(_0x1d8c7d){console['error']('❌\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:',_0x1d8c7d);}else console[_0x20c9ac(0x18b)](_0x20c9ac(0x113)+_0xaefa7a['id']+_0x20c9ac(0x1a2));}await database_1[_0x20c9ac(0x1b3)][_0x20c9ac(0xf8)]['create']({'data':{'paymentId':_0xaefa7a['id'],'shopId':_0xaefa7a[_0x20c9ac(0x13b)],'event':_0x20c9ac(0x167)+_0x13b926[_0x20c9ac(0x127)][_0x20c9ac(0x136)](),'statusCode':0xc8,'responseBody':JSON[_0x20c9ac(0x140)]({'oldStatus':_0xaefa7a[_0x20c9ac(0x127)],'newStatus':_0x13b926['status'],'paymentDetails':_0x13b926[_0x20c9ac(0x131)],'checkedAt':new Date()[_0x20c9ac(0x128)]()})}}),await this[_0x20c9ac(0x10f)](_0xaefa7a,_0x13b926['status']),await this[_0x20c9ac(0x17f)](_0xaefa7a,_0x13b926[_0x20c9ac(0x127)]),_0x13b926['status']!==_0x20c9ac(0x149)&&(console['log']('🧹\x20[CHECK]\x20Payment\x20'+_0xaefa7a['id']+'\x20status\x20changed\x20to\x20'+_0x13b926[_0x20c9ac(0x127)]+_0x20c9ac(0x1a7)),this[_0x20c9ac(0xf4)](_0xaefa7a['id'])),console[_0x20c9ac(0x18b)](_0x20c9ac(0x141)+_0xaefa7a['id']+_0x20c9ac(0x143));}else console['log'](_0x20c9ac(0x17c)+_0xaefa7a['id']+'\x20status\x20unchanged\x20('+_0x13b926[_0x20c9ac(0x127)]+')'),this[_0x20c9ac(0x1ae)](_0xaefa7a['id'],_0xaefa7a['gatewayPaymentId'],_0xaefa7a['status'],_0x13b926['status'],_0x20c9ac(0x101),{'statusUnchanged':!![],'paymentDetails':_0x13b926[_0x20c9ac(0x131)],'amount':_0x13b926['amount'],'currency':_0x13b926[_0x20c9ac(0xf6)],'shopId':_0xaefa7a['shopId'],'checkTimestamp':new Date()[_0x20c9ac(0x128)]()});}catch(_0x461cd1){console[_0x20c9ac(0x108)](_0x20c9ac(0x1db)+_0xaefa7a['id']+':',_0x461cd1),this[_0x20c9ac(0x183)](_0xaefa7a['id'],_0xaefa7a[_0x20c9ac(0x145)],_0x461cd1,_0x20c9ac(0x101),{'paymentAmount':_0xaefa7a[_0x20c9ac(0x1ba)],'paymentCurrency':_0xaefa7a[_0x20c9ac(0xf6)],'shopId':_0xaefa7a[_0x20c9ac(0x13b)],'createdAt':_0xaefa7a['createdAt']}),await database_1[_0x20c9ac(0x1b3)]['webhookLog'][_0x20c9ac(0x15d)]({'data':{'paymentId':_0xaefa7a['id'],'shopId':_0xaefa7a[_0x20c9ac(0x13b)],'event':'cointopay_status_check_error','statusCode':0x1f4,'responseBody':JSON['stringify']({'error':_0x461cd1 instanceof Error?_0x461cd1[_0x20c9ac(0x182)]:'Unknown\x20error','gatewayPaymentId':_0xaefa7a[_0x20c9ac(0x145)],'checkedAt':new Date()['toISOString']()})}});}}async[a37_0x5eedd7(0x10f)](_0x33e8ad,_0x4b4615){const _0x1e87c0=a37_0x5eedd7,_0xb002d0=Date['now']();try{const _0x1371fa=_0x33e8ad[_0x1e87c0(0x150)],_0x38e921=_0x1371fa['settings'];if(!_0x38e921?.[_0x1e87c0(0x1d8)]){console[_0x1e87c0(0x18b)](_0x1e87c0(0x189)+_0x1371fa['id']);return;}const _0x3e5a95=_0x4b4615==='PAID'?'payment.success':_0x4b4615===_0x1e87c0(0x11d)?'payment.failed':_0x4b4615===_0x1e87c0(0x178)?_0x1e87c0(0x156):'payment.pending';if(!_0x38e921['webhookEvents']?.[_0x1e87c0(0x16f)](_0x3e5a95)){console[_0x1e87c0(0x18b)](_0x1e87c0(0x142)+_0x3e5a95+_0x1e87c0(0x15e)+_0x1371fa['id']);return;}const _0x327206=(0x0,gateway_1[_0x1e87c0(0x1d4)])(_0x33e8ad[_0x1e87c0(0x159)])||_0x33e8ad['gateway'],_0x1b922a={'event':_0x3e5a95,'payment':{'id':_0x33e8ad['id'],'order_id':_0x33e8ad[_0x1e87c0(0x1b4)],'gateway_order_id':_0x33e8ad[_0x1e87c0(0x118)],'gateway':_0x327206,'amount':_0x33e8ad[_0x1e87c0(0x1ba)],'currency':_0x33e8ad[_0x1e87c0(0xf6)],'status':_0x4b4615[_0x1e87c0(0x136)](),'customer_email':_0x33e8ad[_0x1e87c0(0x16c)],'customer_name':_0x33e8ad['customerName'],'created_at':_0x33e8ad[_0x1e87c0(0x11e)],'updated_at':new Date()}},_0x335479=await fetch(_0x38e921['webhookUrl'],{'method':'POST','headers':{'Content-Type':_0x1e87c0(0x16e),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x1e87c0(0x140)](_0x1b922a)}),_0x16ec8b=Date[_0x1e87c0(0x187)]()-_0xb002d0,_0x531b49=_0x335479['ok']?_0x1e87c0(0x10e):await _0x335479['text']();loggerService_1[_0x1e87c0(0x130)]['logShopWebhookSent'](_0x33e8ad[_0x1e87c0(0x13b)],_0x38e921[_0x1e87c0(0x1d8)],_0x3e5a95,_0x335479[_0x1e87c0(0x127)],_0x16ec8b,_0x1b922a),console[_0x1e87c0(0x18b)](_0x1e87c0(0x122)+_0x38e921[_0x1e87c0(0x1d8)]+_0x1e87c0(0x1ad)+_0x335479[_0x1e87c0(0x127)]+'\x20('+_0x16ec8b+_0x1e87c0(0x17e));}catch(_0x458789){console[_0x1e87c0(0x108)]('Failed\x20to\x20send\x20shop\x20webhook:',_0x458789),loggerService_1[_0x1e87c0(0x130)]['logShopWebhookError'](_0x33e8ad[_0x1e87c0(0x13b)],_0x33e8ad['shop']?.['settings']?.[_0x1e87c0(0x1d8)]||_0x1e87c0(0x134),_0x1e87c0(0x14d),_0x458789,{});}}async[a37_0x5eedd7(0x17f)](_0x455212,_0x379e17){const _0x33adb8=a37_0x5eedd7;try{const _0x2a20aa={'PENDING':_0x33adb8(0x1b8),'PAID':_0x33adb8(0x152),'FAILED':_0x33adb8(0x1c9),'EXPIRED':_0x33adb8(0x1d0)},_0x2893a4=_0x2a20aa[_0x379e17];if(!_0x2893a4||_0x2893a4==='created')return;await telegramBotService_1['telegramBotService'][_0x33adb8(0x116)](_0x455212[_0x33adb8(0x13b)],_0x455212,_0x2893a4);}catch(_0x1e9ef6){console[_0x33adb8(0x108)](_0x33adb8(0xf0),_0x1e9ef6);}}async[a37_0x5eedd7(0x12f)](_0x41c789){const _0x5e9d14=a37_0x5eedd7;console['log'](_0x5e9d14(0x177)+_0x41c789);const _0x45ae83=await database_1['default'][_0x5e9d14(0x135)]['findUnique']({'where':{'id':_0x41c789},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x45ae83)throw new Error(_0x5e9d14(0x11b));if(_0x45ae83[_0x5e9d14(0x159)]!==_0x5e9d14(0x173)&&_0x45ae83[_0x5e9d14(0x159)]!==_0x5e9d14(0x124))throw new Error(_0x5e9d14(0x14e));console['log'](_0x5e9d14(0x117)+_0x45ae83['gateway']+_0x5e9d14(0x1a1)+_0x41c789),await this[_0x5e9d14(0x10b)](_0x45ae83),console['log'](_0x5e9d14(0xf5)+_0x41c789);}['getServiceStats'](){const _0x56e6ea=a37_0x5eedd7,_0x1b4fb1=this[_0x56e6ea(0x175)]?this[_0x56e6ea(0x192)]:undefined,_0x3326cd=Array[_0x56e6ea(0x15b)](this[_0x56e6ea(0x11a)][_0x56e6ea(0x1cb)]())[_0x56e6ea(0x18a)](_0x3481c6=>({'paymentId':_0x3481c6[_0x56e6ea(0x14f)],'gatewayPaymentId':_0x3481c6[_0x56e6ea(0x145)],'createdAt':_0x3481c6[_0x56e6ea(0x11e)],'timersCount':_0x3481c6[_0x56e6ea(0x185)][_0x56e6ea(0x109)]}));return{'isActive':!!this[_0x56e6ea(0x175)],'globalCheckIntervalMinutes':this[_0x56e6ea(0x192)]/(0x3e8*0x3c),'expiryDays':this[_0x56e6ea(0x169)],'activeIndividualTimers':this[_0x56e6ea(0x11a)][_0x56e6ea(0xfc)],'nextGlobalCheckIn':_0x1b4fb1,'paymentTimersDetails':_0x3326cd};}[a37_0x5eedd7(0x1cd)](_0x2da051){const _0x1e7425=a37_0x5eedd7,_0x18dca8=this[_0x1e7425(0x11a)]['get'](_0x2da051);if(_0x18dca8)return{'hasTimers':!![],'timersCount':_0x18dca8[_0x1e7425(0x185)][_0x1e7425(0x109)],'createdAt':_0x18dca8[_0x1e7425(0x11e)],'gatewayPaymentId':_0x18dca8['gatewayPaymentId']};return{'hasTimers':![]};}}exports[a37_0x5eedd7(0x1d2)]=CoinToPayStatusService,exports['coinToPayStatusService']=new CoinToPayStatusService();