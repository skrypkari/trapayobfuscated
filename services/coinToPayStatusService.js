'use strict';function a37_0x1861(_0x199a76,_0x2b766b){const _0x7ccc79=a37_0x7ccc();return a37_0x1861=function(_0x186118,_0x3740d6){_0x186118=_0x186118-0x1b9;let _0x58b98f=_0x7ccc79[_0x186118];return _0x58b98f;},a37_0x1861(_0x199a76,_0x2b766b);}const a37_0x737d2c=a37_0x1861;(function(_0x566e48,_0x1c6dd9){const _0x5e03df=a37_0x1861,_0x49264d=_0x566e48();while(!![]){try{const _0x451e3d=-parseInt(_0x5e03df(0x1c5))/0x1*(parseInt(_0x5e03df(0x21e))/0x2)+-parseInt(_0x5e03df(0x25c))/0x3*(parseInt(_0x5e03df(0x2af))/0x4)+-parseInt(_0x5e03df(0x28e))/0x5+-parseInt(_0x5e03df(0x1d0))/0x6+-parseInt(_0x5e03df(0x221))/0x7+-parseInt(_0x5e03df(0x1eb))/0x8*(-parseInt(_0x5e03df(0x1d1))/0x9)+parseInt(_0x5e03df(0x297))/0xa;if(_0x451e3d===_0x1c6dd9)break;else _0x49264d['push'](_0x49264d['shift']());}catch(_0x526029){_0x49264d['push'](_0x49264d['shift']());}}}(a37_0x7ccc,0x7924d));var __importDefault=this&&this[a37_0x737d2c(0x239)]||function(_0x2420ca){const _0x4f22fa=a37_0x737d2c;return _0x2420ca&&_0x2420ca[_0x4f22fa(0x1c6)]?_0x2420ca:{'default':_0x2420ca};};function a37_0x7ccc(){const _0x384aaa=['\x20is\x20too\x20new\x20(','⚠️\x20[CHECK]\x20Payment\x20','checkSinglePayment','\x20updated\x20successfully','currency','3MLsIoz','__esModule','auto_expire','size','ms)','\x20checked,\x20','🔍\x20[CHECK]\x20Checking\x20','🔍\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','iban','payment','createdAt','599778lYVAtk','936801ncXwBA','❌\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','🔍\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','\x20not\x20found,\x20clearing\x20timers','\x20completed\x20for\x20payment\x20','\x20\x20\x20❌\x20Error:\x20','gatewayPaymentId','clearPaymentTimers','cointopay_auto_expired','Unknown\x20error','message','✅\x20[DEBUG]\x20Successfully\x20scheduled\x20','stringify','floor','paymentLink','checkExpiredPayments','🪙\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','🪙\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','has','Failed\x20to\x20mark\x20payment\x20as\x20expired','default','now','Shop\x20webhook\x20sent\x20to\x20','cointopay_status_check_error','shopId','paid','16hmdWKy','getTime',',\x20stopping\x20individual\x20checks','\x20\x20\x20📅\x20Time:\x20','checkPaymentStatus','\x20\x20\x20-\x20Gateway:\x20','logWhiteDomainError','🪙\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','shop','✅\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','✅\x20[EXPIRY]\x20Payment\x20','🪙\x20[DEBUG]\x20Creating\x20','✅\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','🪙\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','../types/gateway','type','⏰\x20[GLOBAL]\x20Payment\x20','paymentTimers','timers','bankDetails','🪙\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','payment.success','PAID','\x20has\x20no\x20gatewayPaymentId,\x20skipping','error','\x20status\x20changed\x20to\x20','✅\x20[CHECK]\x20Payment\x20','findMany','\x20\x20\x20📊\x20Status:\x20','FAILED','\x20payment\x20','\x20\x20\x20-\x20gatewayPaymentId:\x20','⏰\x20[DEBUG]\x20Scheduled\x20check\x20#','5\x20minutes','payment.pending','not\x20confirmed','\x20expired\x20CoinToPay\x20payments','stopPeriodicStatusCheck','\x20is\x20valid\x20for\x20checking,\x20proceeding...','❌\x20[TIMER]\x20Failed\x20individual\x20check\x20#','get','🪙\x20[ERROR]\x20CoinToPay\x20Error:\x20','paymentId','loggerService','\x20days','Failed\x20to\x20send\x20shop\x20webhook:','\x20not\x20found\x20in\x20database','\x20is\x20older\x20than\x20','2\x20minutes','map','cointopay','650924YgNSIX','COMPLETED','webhook_send','363153ezqqFP','logCoinToPayStatus','length','\x20timers\x20for\x20payment\x20','h),\x20skipping\x20global\x20check','CoinToPayService','coinToPayService','getDate','🏦\x20[CHECK]\x20Saved\x20IBAN:\x20','EXPIRY_DAYS','\x20(age:\x20','Payment\x20not\x20found','\x20\x20\x20-\x20GatewayPaymentId:\x20','📊\x20[CHECK]\x20Payment\x20','settings','catch','\x20\x20\x20📍\x20Source:\x20','create','🪙\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','✅\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','\x20for\x20payment\x20','checkPaymentById','🔍\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','📊\x20[CHECK]\x20CoinToPay2\x20payment\x20','__importDefault','Automatically\x20expired\x20after\x20','\x20days\x20(created\x20before\x20','\x20status\x20is\x20','\x20days,\x20marking\x20as\x20EXPIRED','\x20\x20\x20📝\x20Context:','paymentDetails','checkSinglePaymentById','Bank\x20Details:\x20','⏰\x20[EXPIRY]\x20Payment\x20','Success','webhookLog','sendShopWebhook','globalCheckInterval','logShopWebhookSent','defineProperty','📈\x20[COINTOPAY]\x20Payment\x20','✅\x20[HOURLY]\x20Payment\x20','Payment\x20older\x20than\x20','\x20status:\x20','paidAt','\x20->\x20','POST','🆔\x20[CHECK]\x20Transaction\x20ID:\x20','not\x20found','\x20not\x20enabled\x20for\x20shop\x20','\x20found:','COINTOPAY_ERROR','push','📊\x20[CHECK]\x20CoinToPay\x20payment\x20','\x20expired','\x20status\x20unchanged\x20(','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','remitterIban','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','1391694nKOMOf','\x20skipped,\x20','🛑\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','sendPaymentNotification','status_check','adminNotes','✅\x20[COINTOPAY]\x20Payment\x20link\x20','\x20has\x20no\x20gatewayPaymentId','payment.failed','\x20\x20\x20-\x20Status:\x20','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','\x20to\x20','CoinToPayStatusService','./loggerService','🧹\x20[CHECK]\x20Payment\x20','📈\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','./telegramBotService',',\x20currentPayments=','❌\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','\x20individual\x20payment\x20timers','PENDING','cointopay2','🪙\x20[GLOBAL]\x20Found\x20','webhookUrl','delay','confirmedOn','🪙\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','\x20marked\x20as\x20paid\x20at:\x20','getGatewayIdByName','update','🧹\x20[DEBUG]\x20Clearing\x20','cointopay_status_check_','webhookEvents','TesSoft\x20Payment\x20System/1.0','includes','currentPayments','sendPaymentStatusNotification','description','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','.\x20Remaining\x20active\x20timers:\x20','📊\x20[HOURLY]\x20Payment\x20','Webhook\x20event\x20','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','values','orderId','logCoinToPayError','⏰\x20[GLOBAL]\x20Found\x20','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','1\x20minute','⏰\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','3268310toEtut','⚠️\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','timestamp','✅\x20[TIMER]\x20Individual\x20check\x20#','log','🪙\x20[TIMER]\x20Individual\x20check\x20#','EXPIRED','❌\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','gatewayOrderId','29977130lWYrjY','checkAllPendingPayments','coinToPay2Service','../config/database','\x20with\x20status\x20','\x20days\x20without\x20payment\x20confirmation','🏦\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes','toISOString','logShopWebhookError',',\x20status=','/status/','created','GLOBAL_CHECK_INTERVAL_MS','stack','amount','customerEmail','\x20\x20\x20📝\x20Details:','\x20pending\x20CoinToPay\x20payments','transactionId','./gateways/coinToPay2Service','❌\x20[CHECK]\x20Payment\x20','\x20details:',',\x20clearing\x20individual\x20timers','findUnique','8ldLofd','coinToPayStatusService','schedule_created','unknown','gateway','status','forEach','❌\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','❌\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','❌\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:'];a37_0x7ccc=function(){return _0x384aaa;};return a37_0x7ccc();}Object[a37_0x737d2c(0x248)](exports,a37_0x737d2c(0x1c6),{'value':!![]}),exports[a37_0x737d2c(0x2b0)]=exports[a37_0x737d2c(0x268)]=void 0x0;const coinToPayService_1=require('./gateways/coinToPayService'),coinToPay2Service_1=require(a37_0x737d2c(0x2aa)),gateway_1=require(a37_0x737d2c(0x1f9)),database_1=__importDefault(require(a37_0x737d2c(0x29a))),telegramBotService_1=require(a37_0x737d2c(0x26c)),loggerService_1=require(a37_0x737d2c(0x269));class CoinToPayStatusService{constructor(){const _0x5ade31=a37_0x737d2c;this[_0x5ade31(0x246)]=null,this[_0x5ade31(0x2a3)]=0x3c*0x3c*0x3e8,this['EXPIRY_DAYS']=0x5,this[_0x5ade31(0x1fc)]=new Map(),this[_0x5ade31(0x227)]=new coinToPayService_1[(_0x5ade31(0x226))](),this[_0x5ade31(0x299)]=new coinToPay2Service_1['CoinToPay2Service'](),console[_0x5ade31(0x292)](_0x5ade31(0x1f2));}['schedulePaymentChecks'](_0x2819c4,_0x19cc7e){const _0x502fbd=a37_0x737d2c;console[_0x502fbd(0x292)](_0x502fbd(0x1e2)),console['log']('\x20\x20\x20-\x20paymentId:\x20'+_0x2819c4),console[_0x502fbd(0x292)](_0x502fbd(0x20a)+_0x19cc7e),this[_0x502fbd(0x1d8)](_0x2819c4);const _0x4cd72e=[],_0x4c7c14=new Date(),_0x2aadb9=[{'delay':0x1*0x3c*0x3e8,'description':_0x502fbd(0x28c)},{'delay':0x2*0x3c*0x3e8,'description':_0x502fbd(0x21b)},{'delay':0x5*0x3c*0x3e8,'description':_0x502fbd(0x20c)},{'delay':0x5*0x3c*0x3e8,'description':_0x502fbd(0x20c)}];console[_0x502fbd(0x292)](_0x502fbd(0x1f6)+_0x2aadb9[_0x502fbd(0x223)]+'\x20initial\x20timers\x20for\x20payment\x20'+_0x2819c4);let _0x1af191=0x0;_0x2aadb9['forEach']((_0x10a7b9,_0x5cb354)=>{const _0x1346f3=_0x502fbd;_0x1af191+=_0x10a7b9['delay'];const _0x3d965a=setTimeout(async()=>{const _0x2b492f=a37_0x1861;console[_0x2b492f(0x292)](_0x2b492f(0x293)+(_0x5cb354+0x1)+'\x20triggered\x20for\x20payment\x20'+_0x2819c4+'\x20(after\x20'+_0x10a7b9[_0x2b492f(0x281)]+')');try{await this[_0x2b492f(0x240)](_0x2819c4),console[_0x2b492f(0x292)](_0x2b492f(0x291)+(_0x5cb354+0x1)+_0x2b492f(0x1d5)+_0x2819c4);}catch(_0x4b9fdd){console[_0x2b492f(0x203)](_0x2b492f(0x212)+(_0x5cb354+0x1)+_0x2b492f(0x235)+_0x2819c4+':',_0x4b9fdd),this['logCoinToPayError'](_0x2819c4,_0x19cc7e,_0x4b9fdd,'status_check',{'checkNumber':_0x5cb354+0x1,'scheduledAfter':_0x10a7b9[_0x2b492f(0x281)],'isIndividualCheck':!![]});}},_0x1af191);_0x4cd72e[_0x1346f3(0x255)](_0x3d965a),console[_0x1346f3(0x292)](_0x1346f3(0x20b)+(_0x5cb354+0x1)+_0x1346f3(0x235)+_0x2819c4+'\x20in\x20'+_0x1af191/0x3e8+'\x20seconds\x20('+_0x10a7b9[_0x1346f3(0x281)]+')');});const _0x2cb291=setInterval(async()=>{const _0x30fe62=_0x502fbd;console['log'](_0x30fe62(0x276)+_0x2819c4);try{const _0x568ade=await database_1[_0x30fe62(0x1e5)][_0x30fe62(0x1ce)][_0x30fe62(0x2ae)]({'where':{'id':_0x2819c4},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x568ade){console[_0x30fe62(0x292)]('❌\x20[HOURLY]\x20Payment\x20'+_0x2819c4+_0x30fe62(0x1d4)),this[_0x30fe62(0x1d8)](_0x2819c4);return;}console[_0x30fe62(0x292)](_0x30fe62(0x284)+_0x2819c4+'\x20current\x20status:\x20'+_0x568ade[_0x30fe62(0x1bb)]);if(_0x568ade[_0x30fe62(0x1bb)]!=='PENDING'){console['log'](_0x30fe62(0x24a)+_0x2819c4+_0x30fe62(0x23c)+_0x568ade[_0x30fe62(0x1bb)]+',\x20stopping\x20individual\x20checks'),this[_0x30fe62(0x1d8)](_0x2819c4);return;}const _0x243fbf=Math[_0x30fe62(0x1de)]((Date[_0x30fe62(0x1e6)]()-_0x568ade[_0x30fe62(0x1cf)]['getTime']())/(0x3e8*0x3c*0x3c*0x18));if(_0x243fbf>=this[_0x30fe62(0x22a)]){console[_0x30fe62(0x292)]('⏰\x20[HOURLY]\x20Payment\x20'+_0x2819c4+_0x30fe62(0x21a)+this[_0x30fe62(0x22a)]+_0x30fe62(0x282)),this[_0x30fe62(0x1d8)](_0x2819c4);return;}await this['checkSinglePaymentById'](_0x2819c4),console[_0x30fe62(0x292)]('✅\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20'+_0x2819c4);}catch(_0x395ae5){console[_0x30fe62(0x203)](_0x30fe62(0x26e)+_0x2819c4+':',_0x395ae5),this[_0x30fe62(0x289)](_0x2819c4,_0x19cc7e,_0x395ae5,'status_check',{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x4cd72e['push'](_0x2cb291),this[_0x502fbd(0x1fc)]['set'](_0x2819c4,{'timers':_0x4cd72e,'paymentId':_0x2819c4,'gatewayPaymentId':_0x19cc7e,'createdAt':_0x4c7c14}),console[_0x502fbd(0x292)](_0x502fbd(0x1dc)+_0x2aadb9[_0x502fbd(0x223)]+'\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20'+_0x2819c4),console[_0x502fbd(0x292)]('📊\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20'+this[_0x502fbd(0x1fc)][_0x502fbd(0x1c8)]),this[_0x502fbd(0x222)](_0x2819c4,_0x19cc7e,_0x502fbd(0x270),_0x502fbd(0x270),_0x502fbd(0x260),{'action':_0x502fbd(0x2b1),'scheduledChecks':_0x2aadb9[_0x502fbd(0x223)],'firstCheckIn':_0x2aadb9[0x0][_0x502fbd(0x274)]/0x3e8,'totalTimers':this['paymentTimers'][_0x502fbd(0x1c8)]});}['clearPaymentTimers'](_0x396076){const _0x50ccb7=a37_0x737d2c,_0x3308c3=this[_0x50ccb7(0x1fc)]['get'](_0x396076);_0x3308c3?(console[_0x50ccb7(0x292)](_0x50ccb7(0x27a)+_0x3308c3[_0x50ccb7(0x1fd)][_0x50ccb7(0x223)]+_0x50ccb7(0x224)+_0x396076),_0x3308c3[_0x50ccb7(0x1fd)][_0x50ccb7(0x1bc)]((_0x46135f,_0x39b18e)=>{const _0x42e4ca=_0x50ccb7;_0x46135f&&(clearTimeout(_0x46135f),clearInterval(_0x46135f),console[_0x42e4ca(0x292)]('🧹\x20[DEBUG]\x20Cleared\x20timer\x20#'+(_0x39b18e+0x1)+_0x42e4ca(0x235)+_0x396076));}),this[_0x50ccb7(0x1fc)]['delete'](_0x396076),console['log']('✅\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20'+_0x396076+_0x50ccb7(0x283)+this[_0x50ccb7(0x1fc)][_0x50ccb7(0x1c8)])):console['log'](_0x50ccb7(0x28f)+_0x396076+'\x20to\x20clear');}async['checkSinglePaymentById'](_0x363bb5){const _0x1599dc=a37_0x737d2c;console[_0x1599dc(0x292)](_0x1599dc(0x1cc)+_0x363bb5);const _0x522323=await database_1[_0x1599dc(0x1e5)][_0x1599dc(0x1ce)]['findUnique']({'where':{'id':_0x363bb5},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x522323){console[_0x1599dc(0x292)](_0x1599dc(0x2ab)+_0x363bb5+_0x1599dc(0x219));return;}console['log'](_0x1599dc(0x22e)+_0x363bb5+_0x1599dc(0x253)),console[_0x1599dc(0x292)](_0x1599dc(0x1f0)+_0x522323['gateway']),console['log'](_0x1599dc(0x265)+_0x522323[_0x1599dc(0x1bb)]),console[_0x1599dc(0x292)](_0x1599dc(0x22d)+_0x522323[_0x1599dc(0x1d7)]),console[_0x1599dc(0x292)]('\x20\x20\x20-\x20Amount:\x20'+_0x522323['amount']+'\x20'+_0x522323[_0x1599dc(0x1c4)]),console[_0x1599dc(0x292)]('\x20\x20\x20-\x20ShopId:\x20'+_0x522323[_0x1599dc(0x1e9)]);if(_0x522323[_0x1599dc(0x1ba)]!==_0x1599dc(0x21d)&&_0x522323[_0x1599dc(0x1ba)]!=='cointopay2'){console[_0x1599dc(0x292)]('⚠️\x20[CHECK]\x20Payment\x20'+_0x363bb5+'\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20'+_0x522323[_0x1599dc(0x1ba)]+')');return;}if(_0x522323[_0x1599dc(0x1bb)]!=='PENDING'){console[_0x1599dc(0x292)]('⚠️\x20[CHECK]\x20Payment\x20'+_0x363bb5+'\x20status\x20is\x20'+_0x522323[_0x1599dc(0x1bb)]+_0x1599dc(0x1ed)),this[_0x1599dc(0x1d8)](_0x363bb5);return;}if(!_0x522323['gatewayPaymentId']){console[_0x1599dc(0x292)](_0x1599dc(0x1c1)+_0x363bb5+_0x1599dc(0x263));return;}console['log'](_0x1599dc(0x205)+_0x363bb5+_0x1599dc(0x211)),await this['checkSinglePayment'](_0x522323);}['logCoinToPayStatus'](_0x5205f0,_0x10939f,_0x244f3b,_0x28faa1,_0x4903c5,_0x572d91){const _0x49e9a4=a37_0x737d2c,_0x251a4e={'type':'COINTOPAY_STATUS_CHANGE','paymentId':_0x5205f0,'gatewayPaymentId':_0x10939f,'oldStatus':_0x244f3b,'newStatus':_0x28faa1,'source':_0x4903c5,'timestamp':new Date()['toISOString'](),'details':_0x572d91||{}};loggerService_1[_0x49e9a4(0x216)][_0x49e9a4(0x222)](_0x251a4e),console['log']('🪙\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20'+_0x5205f0+'\x20('+_0x10939f+')'),console[_0x49e9a4(0x292)](_0x49e9a4(0x207)+_0x244f3b+_0x49e9a4(0x24e)+_0x28faa1),console[_0x49e9a4(0x292)](_0x49e9a4(0x231)+_0x4903c5),console['log'](_0x49e9a4(0x1ee)+_0x251a4e[_0x49e9a4(0x290)]),_0x572d91&&console[_0x49e9a4(0x292)](_0x49e9a4(0x2a7),_0x572d91);}[a37_0x737d2c(0x289)](_0x2fab6c,_0x1a6eff,_0x13ef0d,_0xc167b1,_0x594322){const _0x53b55a=a37_0x737d2c,_0x3fc81b={'type':_0x53b55a(0x254),'paymentId':_0x2fab6c,'gatewayPaymentId':_0x1a6eff,'error':_0x13ef0d instanceof Error?{'message':_0x13ef0d[_0x53b55a(0x1db)],'stack':_0x13ef0d[_0x53b55a(0x2a4)]}:_0x13ef0d,'source':_0xc167b1,'timestamp':new Date()['toISOString'](),'context':_0x594322||{}};loggerService_1[_0x53b55a(0x216)][_0x53b55a(0x289)](_0x3fc81b),console[_0x53b55a(0x203)](_0x53b55a(0x214)+_0x2fab6c+'\x20('+_0x1a6eff+')'),console[_0x53b55a(0x203)](_0x53b55a(0x1d6)+(_0x13ef0d instanceof Error?_0x13ef0d[_0x53b55a(0x1db)]:_0x13ef0d)),console['error'](_0x53b55a(0x231)+_0xc167b1),console['error'](_0x53b55a(0x1ee)+_0x3fc81b[_0x53b55a(0x290)]),_0x594322&&console[_0x53b55a(0x203)](_0x53b55a(0x23e),_0x594322);}['startPeriodicStatusCheck'](){const _0x4beabb=a37_0x737d2c;console[_0x4beabb(0x292)](_0x4beabb(0x1e1)),this[_0x4beabb(0x298)]()[_0x4beabb(0x230)](_0x2a91f9=>{const _0x4e6727=_0x4beabb;console[_0x4e6727(0x203)]('❌\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:',_0x2a91f9);}),this[_0x4beabb(0x246)]=setInterval(async()=>{const _0x1f7b98=_0x4beabb;try{console[_0x1f7b98(0x292)](_0x1f7b98(0x1ff)),await this[_0x1f7b98(0x298)](),console[_0x1f7b98(0x292)]('✅\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed');}catch(_0x4a2e16){console[_0x1f7b98(0x203)](_0x1f7b98(0x1d2),_0x4a2e16);}},this['GLOBAL_CHECK_INTERVAL_MS']),console[_0x4beabb(0x292)]('✅\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)');}[a37_0x737d2c(0x210)](){const _0x5d61d8=a37_0x737d2c;console[_0x5d61d8(0x292)](_0x5d61d8(0x25e));this['globalCheckInterval']&&(clearInterval(this[_0x5d61d8(0x246)]),this['globalCheckInterval']=null,console['log']('🛑\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped'));const _0x4ff55b=this[_0x5d61d8(0x1fc)][_0x5d61d8(0x1c8)];for(const [_0x34915a]of this['paymentTimers']){this[_0x5d61d8(0x1d8)](_0x34915a);}console[_0x5d61d8(0x292)]('🛑\x20[SHUTDOWN]\x20Cleared\x20'+_0x4ff55b+_0x5d61d8(0x26f));}async['checkAllPendingPayments'](){const _0x288f07=a37_0x737d2c;try{console['log'](_0x288f07(0x233));const _0xeee65f=await database_1[_0x288f07(0x1e5)][_0x288f07(0x1ce)][_0x288f07(0x206)]({'where':{'gateway':{'in':[_0x288f07(0x21d),_0x288f07(0x271)]},'status':_0x288f07(0x270),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x288f07(0x292)](_0x288f07(0x272)+_0xeee65f[_0x288f07(0x223)]+_0x288f07(0x2a8));if(_0xeee65f[_0x288f07(0x223)]===0x0){console[_0x288f07(0x292)](_0x288f07(0x1f8));return;}const _0x2e9a90=await this[_0x288f07(0x1e0)](_0xeee65f);console['log'](_0x288f07(0x28a)+_0x2e9a90[_0x288f07(0x223)]+_0x288f07(0x20f));let _0x10b4ac=0x0,_0x323883=0x0;for(const _0x2d8af2 of _0xeee65f){try{if(_0x2e9a90[_0x288f07(0x27e)](_0x2d8af2['id'])){console[_0x288f07(0x292)]('⏰\x20[GLOBAL]\x20Payment\x20'+_0x2d8af2['id']+_0x288f07(0x28b)),_0x323883++;continue;}if(this['paymentTimers'][_0x288f07(0x1e3)](_0x2d8af2['id'])){console[_0x288f07(0x292)](_0x288f07(0x1fb)+_0x2d8af2['id']+_0x288f07(0x25b)),_0x323883++;continue;}const _0x495b87=(Date[_0x288f07(0x1e6)]()-_0x2d8af2[_0x288f07(0x1cf)][_0x288f07(0x1ec)]())/(0x3e8*0x3c*0x3c);if(_0x495b87<0x1){console[_0x288f07(0x292)](_0x288f07(0x1fb)+_0x2d8af2['id']+_0x288f07(0x1c0)+_0x495b87['toFixed'](0x1)+_0x288f07(0x225)),_0x323883++;continue;}console[_0x288f07(0x292)](_0x288f07(0x1d3)+_0x2d8af2['id']+_0x288f07(0x22b)+_0x495b87['toFixed'](0x1)+'h)'),await this[_0x288f07(0x1c2)](_0x2d8af2),_0x10b4ac++,await new Promise(_0x2ed4c8=>setTimeout(_0x2ed4c8,0x7d0));}catch(_0x438eea){console[_0x288f07(0x203)](_0x288f07(0x1be)+_0x2d8af2['id']+':',_0x438eea),this[_0x288f07(0x289)](_0x2d8af2['id'],_0x2d8af2['gatewayPaymentId']||_0x288f07(0x1b9),_0x438eea,_0x288f07(0x260),{'isGlobalCheck':!![],'paymentAmount':_0x2d8af2[_0x288f07(0x2a5)],'paymentCurrency':_0x2d8af2[_0x288f07(0x1c4)],'shopId':_0x2d8af2[_0x288f07(0x1e9)],'createdAt':_0x2d8af2[_0x288f07(0x1cf)]}),loggerService_1[_0x288f07(0x216)][_0x288f07(0x1f1)](_0x288f07(0x21d),_0x288f07(0x2a1)+_0x2d8af2[_0x288f07(0x1d7)],_0x438eea);}}console[_0x288f07(0x292)](_0x288f07(0x234)+_0x10b4ac+_0x288f07(0x1ca)+_0x323883+_0x288f07(0x25d)+_0x2e9a90[_0x288f07(0x223)]+_0x288f07(0x257));}catch(_0x4188e0){console[_0x288f07(0x203)](_0x288f07(0x295),_0x4188e0);}}async['checkExpiredPayments'](_0x4bc49a){const _0x996080=a37_0x737d2c,_0x222253=[],_0x58bed6=new Date();_0x58bed6['setDate'](_0x58bed6[_0x996080(0x228)]()-this[_0x996080(0x22a)]),console[_0x996080(0x292)](_0x996080(0x28d)+this[_0x996080(0x22a)]+_0x996080(0x23b)+_0x58bed6[_0x996080(0x29e)]()+')');for(const _0x3bf7b1 of _0x4bc49a){if(_0x3bf7b1['createdAt']<_0x58bed6){console[_0x996080(0x292)](_0x996080(0x242)+_0x3bf7b1['id']+_0x996080(0x21a)+this[_0x996080(0x22a)]+_0x996080(0x23d));try{this[_0x996080(0x222)](_0x3bf7b1['id'],_0x3bf7b1[_0x996080(0x1d7)]||_0x996080(0x1b9),_0x996080(0x270),'EXPIRED',_0x996080(0x1c7),{'reason':_0x996080(0x24b)+this[_0x996080(0x22a)]+_0x996080(0x217),'createdAt':_0x3bf7b1[_0x996080(0x1cf)],'daysSinceCreation':Math['floor']((Date[_0x996080(0x1e6)]()-_0x3bf7b1['createdAt'][_0x996080(0x1ec)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x3bf7b1['amount'],'paymentCurrency':_0x3bf7b1[_0x996080(0x1c4)],'shopId':_0x3bf7b1[_0x996080(0x1e9)]}),await database_1[_0x996080(0x1e5)][_0x996080(0x1ce)]['update']({'where':{'id':_0x3bf7b1['id']},'data':{'status':'EXPIRED','updatedAt':new Date(),'adminNotes':_0x996080(0x23a)+this['EXPIRY_DAYS']+_0x996080(0x29c)}}),await database_1[_0x996080(0x1e5)][_0x996080(0x244)][_0x996080(0x232)]({'data':{'paymentId':_0x3bf7b1['id'],'shopId':_0x3bf7b1[_0x996080(0x1e9)],'event':_0x996080(0x1d9),'statusCode':0xc8,'responseBody':JSON['stringify']({'reason':_0x996080(0x24b)+this[_0x996080(0x22a)]+_0x996080(0x217),'createdAt':_0x3bf7b1['createdAt'],'expiredAt':new Date()['toISOString'](),'daysSinceCreation':Math[_0x996080(0x1de)]((Date[_0x996080(0x1e6)]()-_0x3bf7b1['createdAt']['getTime']())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x996080(0x245)](_0x3bf7b1,_0x996080(0x294)),await this[_0x996080(0x280)](_0x3bf7b1,_0x996080(0x294)),this[_0x996080(0x1d8)](_0x3bf7b1['id']),_0x222253[_0x996080(0x255)](_0x3bf7b1['id']),console[_0x996080(0x292)](_0x996080(0x1f5)+_0x3bf7b1['id']+'\x20marked\x20as\x20EXPIRED\x20due\x20to\x20'+this[_0x996080(0x22a)]+'-day\x20timeout');}catch(_0x1b512a){console['error']('❌\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20'+_0x3bf7b1['id']+':',_0x1b512a),this[_0x996080(0x289)](_0x3bf7b1['id'],_0x3bf7b1[_0x996080(0x1d7)]||_0x996080(0x1b9),_0x1b512a,_0x996080(0x1c7),{'reason':_0x996080(0x1e4),'createdAt':_0x3bf7b1['createdAt'],'daysSinceCreation':Math[_0x996080(0x1de)]((Date[_0x996080(0x1e6)]()-_0x3bf7b1[_0x996080(0x1cf)][_0x996080(0x1ec)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x222253;}async[a37_0x737d2c(0x1c2)](_0x589462){const _0x1846f1=a37_0x737d2c;if(!_0x589462['gatewayPaymentId']){console['log']('⚠️\x20[CHECK]\x20Payment\x20'+_0x589462['id']+_0x1846f1(0x202));return;}console['log'](_0x1846f1(0x1cb)+_0x589462[_0x1846f1(0x1ba)]+_0x1846f1(0x209)+_0x589462['id']+'\x20('+_0x589462[_0x1846f1(0x1d7)]+')');try{let _0x3021a9;_0x589462[_0x1846f1(0x1ba)]==='cointopay2'?(_0x3021a9=await this[_0x1846f1(0x299)][_0x1846f1(0x1ef)](_0x589462[_0x1846f1(0x1d7)]),console['log'](_0x1846f1(0x238)+_0x589462['id']+_0x1846f1(0x24c)+_0x3021a9[_0x1846f1(0x1bb)])):(_0x3021a9=await this['coinToPayService'][_0x1846f1(0x1ef)](_0x589462[_0x1846f1(0x1d7)]),console[_0x1846f1(0x292)](_0x1846f1(0x256)+_0x589462['id']+_0x1846f1(0x24c)+_0x3021a9[_0x1846f1(0x1bb)]));_0x3021a9[_0x1846f1(0x23f)]&&console[_0x1846f1(0x292)]('📊\x20[CHECK]\x20Payment\x20'+_0x589462['id']+_0x1846f1(0x2ac),{'iban':_0x3021a9[_0x1846f1(0x23f)][_0x1846f1(0x1cd)]||_0x1846f1(0x251),'transactionId':_0x3021a9[_0x1846f1(0x23f)][_0x1846f1(0x2a9)],'createdOn':_0x3021a9[_0x1846f1(0x23f)]['createdOn'],'confirmedOn':_0x3021a9[_0x1846f1(0x23f)][_0x1846f1(0x275)]||_0x1846f1(0x20e)});if(_0x3021a9[_0x1846f1(0x1bb)]!==_0x589462[_0x1846f1(0x1bb)]){console['log']('🔄\x20[CHECK]\x20Updating\x20payment\x20'+_0x589462['id']+'\x20status\x20from\x20'+_0x589462[_0x1846f1(0x1bb)]+_0x1846f1(0x267)+_0x3021a9['status']),this['logCoinToPayStatus'](_0x589462['id'],_0x589462[_0x1846f1(0x1d7)],_0x589462[_0x1846f1(0x1bb)],_0x3021a9['status'],_0x1846f1(0x260),{'paymentDetails':_0x3021a9['paymentDetails'],'amount':_0x3021a9[_0x1846f1(0x2a5)],'currency':_0x3021a9['currency'],'shopId':_0x589462['shopId'],'checkTimestamp':new Date()[_0x1846f1(0x29e)]()});const _0x46e4a4={'status':_0x3021a9[_0x1846f1(0x1bb)],'updatedAt':new Date()};_0x3021a9['status']===_0x1846f1(0x201)&&_0x589462[_0x1846f1(0x1bb)]!=='PAID'&&(_0x46e4a4['paidAt']=new Date(),console[_0x1846f1(0x292)]('💰\x20[CHECK]\x20Payment\x20'+_0x589462['id']+_0x1846f1(0x277)+_0x46e4a4[_0x1846f1(0x24d)][_0x1846f1(0x29e)]()));if(_0x3021a9['paymentDetails']){const _0x440fea=_0x3021a9[_0x1846f1(0x23f)];_0x440fea[_0x1846f1(0x1cd)]&&(_0x46e4a4[_0x1846f1(0x25a)]=_0x440fea[_0x1846f1(0x1cd)],console['log'](_0x1846f1(0x229)+_0x440fea[_0x1846f1(0x1cd)]));if(_0x440fea[_0x1846f1(0x1fe)]){const _0x4af827=_0x589462[_0x1846f1(0x261)]||'',_0x323687=_0x1846f1(0x241)+_0x440fea[_0x1846f1(0x1fe)];_0x46e4a4[_0x1846f1(0x261)]=_0x4af827?_0x4af827+'\x0a\x0a'+_0x323687:_0x323687,console[_0x1846f1(0x292)](_0x1846f1(0x29d));}_0x440fea[_0x1846f1(0x2a9)]&&console[_0x1846f1(0x292)](_0x1846f1(0x250)+_0x440fea[_0x1846f1(0x2a9)]),_0x440fea[_0x1846f1(0x275)]&&console[_0x1846f1(0x292)](_0x1846f1(0x1f4)+_0x440fea[_0x1846f1(0x275)]);}await database_1[_0x1846f1(0x1e5)]['payment']['update']({'where':{'id':_0x589462['id']},'data':_0x46e4a4});if(_0x3021a9[_0x1846f1(0x1bb)]===_0x1846f1(0x201)&&_0x589462[_0x1846f1(0x1bb)]!==_0x1846f1(0x201)){console[_0x1846f1(0x292)](_0x1846f1(0x249)+_0x589462['id']+_0x1846f1(0x286));const _0x32f815=await database_1[_0x1846f1(0x1e5)][_0x1846f1(0x1ce)][_0x1846f1(0x2ae)]({'where':{'id':_0x589462['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x32f815?.['paymentLinkId']&&_0x32f815[_0x1846f1(0x1df)])try{const _0x27d2d6=_0x32f815[_0x1846f1(0x1df)];console[_0x1846f1(0x292)](_0x1846f1(0x26b)+_0x27d2d6['id']+':\x20type='+_0x27d2d6[_0x1846f1(0x1fa)]+_0x1846f1(0x26d)+_0x27d2d6['currentPayments']+_0x1846f1(0x2a0)+_0x27d2d6['status']);const _0x3ff0f6=_0x27d2d6[_0x1846f1(0x27f)]+0x1,_0x2a0bac=_0x27d2d6[_0x1846f1(0x1fa)]==='SINGLE'?_0x1846f1(0x21f):_0x27d2d6['status'];await database_1[_0x1846f1(0x1e5)][_0x1846f1(0x1df)][_0x1846f1(0x279)]({'where':{'id':_0x27d2d6['id']},'data':{'currentPayments':_0x3ff0f6,'status':_0x2a0bac,'updatedAt':new Date()}}),console[_0x1846f1(0x292)](_0x1846f1(0x262)+_0x27d2d6['id']+'\x20updated:\x20currentPayments='+_0x27d2d6[_0x1846f1(0x27f)]+_0x1846f1(0x24e)+_0x3ff0f6+',\x20status='+_0x27d2d6[_0x1846f1(0x1bb)]+_0x1846f1(0x24e)+_0x2a0bac);}catch(_0x416782){console['error'](_0x1846f1(0x1bf),_0x416782);}else console[_0x1846f1(0x292)](_0x1846f1(0x249)+_0x589462['id']+_0x1846f1(0x266));}await database_1[_0x1846f1(0x1e5)][_0x1846f1(0x244)][_0x1846f1(0x232)]({'data':{'paymentId':_0x589462['id'],'shopId':_0x589462[_0x1846f1(0x1e9)],'event':_0x1846f1(0x27b)+_0x3021a9[_0x1846f1(0x1bb)]['toLowerCase'](),'statusCode':0xc8,'responseBody':JSON['stringify']({'oldStatus':_0x589462[_0x1846f1(0x1bb)],'newStatus':_0x3021a9[_0x1846f1(0x1bb)],'paymentDetails':_0x3021a9[_0x1846f1(0x23f)],'checkedAt':new Date()[_0x1846f1(0x29e)]()})}}),await this[_0x1846f1(0x245)](_0x589462,_0x3021a9[_0x1846f1(0x1bb)]),await this[_0x1846f1(0x280)](_0x589462,_0x3021a9['status']),_0x3021a9[_0x1846f1(0x1bb)]!=='PENDING'&&(console[_0x1846f1(0x292)](_0x1846f1(0x26a)+_0x589462['id']+_0x1846f1(0x204)+_0x3021a9[_0x1846f1(0x1bb)]+_0x1846f1(0x2ad)),this[_0x1846f1(0x1d8)](_0x589462['id'])),console[_0x1846f1(0x292)](_0x1846f1(0x205)+_0x589462['id']+_0x1846f1(0x1c3));}else console[_0x1846f1(0x292)](_0x1846f1(0x22e)+_0x589462['id']+_0x1846f1(0x258)+_0x3021a9[_0x1846f1(0x1bb)]+')'),this['logCoinToPayStatus'](_0x589462['id'],_0x589462['gatewayPaymentId'],_0x589462[_0x1846f1(0x1bb)],_0x3021a9['status'],_0x1846f1(0x260),{'statusUnchanged':!![],'paymentDetails':_0x3021a9[_0x1846f1(0x23f)],'amount':_0x3021a9[_0x1846f1(0x2a5)],'currency':_0x3021a9[_0x1846f1(0x1c4)],'shopId':_0x589462[_0x1846f1(0x1e9)],'checkTimestamp':new Date()['toISOString']()});}catch(_0x59340f){console[_0x1846f1(0x203)](_0x1846f1(0x1bd)+_0x589462['id']+':',_0x59340f),this[_0x1846f1(0x289)](_0x589462['id'],_0x589462[_0x1846f1(0x1d7)],_0x59340f,_0x1846f1(0x260),{'paymentAmount':_0x589462['amount'],'paymentCurrency':_0x589462[_0x1846f1(0x1c4)],'shopId':_0x589462[_0x1846f1(0x1e9)],'createdAt':_0x589462[_0x1846f1(0x1cf)]}),await database_1['default'][_0x1846f1(0x244)][_0x1846f1(0x232)]({'data':{'paymentId':_0x589462['id'],'shopId':_0x589462[_0x1846f1(0x1e9)],'event':_0x1846f1(0x1e8),'statusCode':0x1f4,'responseBody':JSON['stringify']({'error':_0x59340f instanceof Error?_0x59340f[_0x1846f1(0x1db)]:_0x1846f1(0x1da),'gatewayPaymentId':_0x589462[_0x1846f1(0x1d7)],'checkedAt':new Date()[_0x1846f1(0x29e)]()})}});}}async[a37_0x737d2c(0x245)](_0x50fe7d,_0x26af85){const _0x3af212=a37_0x737d2c,_0x53ba04=Date[_0x3af212(0x1e6)]();try{const _0x170415=_0x50fe7d[_0x3af212(0x1f3)],_0xfbdca7=_0x170415[_0x3af212(0x22f)];if(!_0xfbdca7?.[_0x3af212(0x273)]){console[_0x3af212(0x292)]('No\x20webhook\x20URL\x20configured\x20for\x20shop\x20'+_0x170415['id']);return;}const _0x42c045=_0x26af85===_0x3af212(0x201)?_0x3af212(0x200):_0x26af85===_0x3af212(0x208)?_0x3af212(0x264):_0x26af85===_0x3af212(0x294)?_0x3af212(0x264):_0x3af212(0x20d);if(!_0xfbdca7[_0x3af212(0x27c)]?.[_0x3af212(0x27e)](_0x42c045)){console[_0x3af212(0x292)](_0x3af212(0x285)+_0x42c045+_0x3af212(0x252)+_0x170415['id']);return;}const _0x4a8837=(0x0,gateway_1[_0x3af212(0x278)])(_0x50fe7d['gateway'])||_0x50fe7d['gateway'],_0x1bb216={'event':_0x42c045,'payment':{'id':_0x50fe7d['id'],'order_id':_0x50fe7d[_0x3af212(0x288)],'gateway_order_id':_0x50fe7d[_0x3af212(0x296)],'gateway':_0x4a8837,'amount':_0x50fe7d['amount'],'currency':_0x50fe7d[_0x3af212(0x1c4)],'status':_0x26af85['toLowerCase'](),'customer_email':_0x50fe7d[_0x3af212(0x2a6)],'customer_name':_0x50fe7d['customerName'],'created_at':_0x50fe7d[_0x3af212(0x1cf)],'updated_at':new Date()}},_0x17a335=await fetch(_0xfbdca7[_0x3af212(0x273)],{'method':_0x3af212(0x24f),'headers':{'Content-Type':'application/json','User-Agent':_0x3af212(0x27d)},'body':JSON[_0x3af212(0x1dd)](_0x1bb216)}),_0x55d994=Date[_0x3af212(0x1e6)]()-_0x53ba04,_0x6c9205=_0x17a335['ok']?_0x3af212(0x243):await _0x17a335['text']();loggerService_1[_0x3af212(0x216)][_0x3af212(0x247)](_0x50fe7d[_0x3af212(0x1e9)],_0xfbdca7[_0x3af212(0x273)],_0x42c045,_0x17a335[_0x3af212(0x1bb)],_0x55d994,_0x1bb216),console['log'](_0x3af212(0x1e7)+_0xfbdca7[_0x3af212(0x273)]+_0x3af212(0x29b)+_0x17a335['status']+'\x20('+_0x55d994+_0x3af212(0x1c9));}catch(_0x5e775b){console[_0x3af212(0x203)](_0x3af212(0x218),_0x5e775b),loggerService_1[_0x3af212(0x216)][_0x3af212(0x29f)](_0x50fe7d[_0x3af212(0x1e9)],_0x50fe7d[_0x3af212(0x1f3)]?.[_0x3af212(0x22f)]?.[_0x3af212(0x273)]||'unknown',_0x3af212(0x220),_0x5e775b,{});}}async['sendPaymentStatusNotification'](_0x2c840c,_0xc002ba){const _0x392574=a37_0x737d2c;try{const _0x5ca53f={'PENDING':_0x392574(0x2a2),'PAID':_0x392574(0x1ea),'FAILED':'failed','EXPIRED':'expired'},_0x3d37e8=_0x5ca53f[_0xc002ba];if(!_0x3d37e8||_0x3d37e8==='created')return;await telegramBotService_1['telegramBotService'][_0x392574(0x25f)](_0x2c840c[_0x392574(0x1e9)],_0x2c840c,_0x3d37e8);}catch(_0x5174a4){console[_0x392574(0x203)]('Failed\x20to\x20send\x20Telegram\x20payment\x20notification:',_0x5174a4);}}async[a37_0x737d2c(0x236)](_0x19a386){const _0x5089b9=a37_0x737d2c;console[_0x5089b9(0x292)](_0x5089b9(0x237)+_0x19a386);const _0x5db234=await database_1[_0x5089b9(0x1e5)][_0x5089b9(0x1ce)][_0x5089b9(0x2ae)]({'where':{'id':_0x19a386},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x5db234)throw new Error(_0x5089b9(0x22c));if(_0x5db234['gateway']!==_0x5089b9(0x21d)&&_0x5db234[_0x5089b9(0x1ba)]!==_0x5089b9(0x271))throw new Error(_0x5089b9(0x259));console[_0x5089b9(0x292)](_0x5089b9(0x1f7)+_0x5db234[_0x5089b9(0x1ba)]+_0x5089b9(0x209)+_0x19a386),await this[_0x5089b9(0x1c2)](_0x5db234),console['log']('✅\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20'+_0x19a386);}['getServiceStats'](){const _0x281fec=a37_0x737d2c,_0x347046=this[_0x281fec(0x246)]?this['GLOBAL_CHECK_INTERVAL_MS']:undefined,_0x4f4544=Array['from'](this[_0x281fec(0x1fc)][_0x281fec(0x287)]())[_0x281fec(0x21c)](_0x3de72a=>({'paymentId':_0x3de72a[_0x281fec(0x215)],'gatewayPaymentId':_0x3de72a[_0x281fec(0x1d7)],'createdAt':_0x3de72a[_0x281fec(0x1cf)],'timersCount':_0x3de72a[_0x281fec(0x1fd)][_0x281fec(0x223)]}));return{'isActive':!!this['globalCheckInterval'],'globalCheckIntervalMinutes':this[_0x281fec(0x2a3)]/(0x3e8*0x3c),'expiryDays':this[_0x281fec(0x22a)],'activeIndividualTimers':this[_0x281fec(0x1fc)][_0x281fec(0x1c8)],'nextGlobalCheckIn':_0x347046,'paymentTimersDetails':_0x4f4544};}['getPaymentTimerInfo'](_0x388d7a){const _0x5a224f=a37_0x737d2c,_0x372b36=this['paymentTimers'][_0x5a224f(0x213)](_0x388d7a);if(_0x372b36)return{'hasTimers':!![],'timersCount':_0x372b36[_0x5a224f(0x1fd)][_0x5a224f(0x223)],'createdAt':_0x372b36[_0x5a224f(0x1cf)],'gatewayPaymentId':_0x372b36[_0x5a224f(0x1d7)]};return{'hasTimers':![]};}}exports[a37_0x737d2c(0x268)]=CoinToPayStatusService,exports['coinToPayStatusService']=new CoinToPayStatusService();