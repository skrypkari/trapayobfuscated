'use strict';const a52_0x5551c7=a52_0x24ad;(function(_0x1a7f40,_0xaddcb6){const _0x5e66bf=a52_0x24ad,_0x12b648=_0x1a7f40();while(!![]){try{const _0x104cca=-parseInt(_0x5e66bf(0x183))/0x1+-parseInt(_0x5e66bf(0x180))/0x2*(-parseInt(_0x5e66bf(0x13f))/0x3)+parseInt(_0x5e66bf(0xf7))/0x4*(-parseInt(_0x5e66bf(0x12c))/0x5)+-parseInt(_0x5e66bf(0x18f))/0x6*(parseInt(_0x5e66bf(0x1a3))/0x7)+parseInt(_0x5e66bf(0x14b))/0x8+-parseInt(_0x5e66bf(0x1ae))/0x9+parseInt(_0x5e66bf(0x10e))/0xa;if(_0x104cca===_0xaddcb6)break;else _0x12b648['push'](_0x12b648['shift']());}catch(_0x461fcd){_0x12b648['push'](_0x12b648['shift']());}}}(a52_0x113c,0x6c025));function a52_0x24ad(_0x490beb,_0x18cd78){_0x490beb=_0x490beb-0xeb;const _0x113c40=a52_0x113c();let _0x24ad46=_0x113c40[_0x490beb];return _0x24ad46;}var __importDefault=this&&this[a52_0x5551c7(0x17f)]||function(_0x233e0e){const _0x3914a5=a52_0x5551c7;return _0x233e0e&&_0x233e0e[_0x3914a5(0x1a1)]?_0x233e0e:{'default':_0x233e0e};};Object[a52_0x5551c7(0x17b)](exports,'__esModule',{'value':!![]}),exports[a52_0x5551c7(0xf8)]=exports[a52_0x5551c7(0x184)]=void 0x0;function a52_0x113c(){const _0x2825ea=['üîç\x20[CHECK]\x20Checking\x20','Shop\x20webhook\x20sent\x20to\x20','sendShopWebhook','‚úÖ\x20[DEBUG]\x20Successfully\x20scheduled\x20','1\x20minute','webhook_send','findUnique',',\x20using\x20default\x2010%','\x20\x20\x20üìç\x20Source:\x20','type','üîç\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','\x20not\x20enabled\x20for\x20shop\x20','created','üìä\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','__esModule','üìà\x20[COINTOPAY]\x20Payment\x20','1958054PlaPbu','paid','ü™ô\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','checkPaymentStatus','paymentLink','\x20commission:\x20','default','üìà\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','getDate','/status/','EXPIRY_DAYS','1534716gyyZwG','coinToPayService','\x20individual\x20payment\x20timers','commission','\x20\x20\x20-\x20GatewayPaymentId:\x20','‚è∞\x20[HOURLY]\x20Payment\x20','delete',',\x20gateway\x20','-day\x20timeout','update','get','ü™ô\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','message','coinToPay2Service','length','cointopay_status_check_','sendPaymentNotification','description','ü™ô\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','webhookLog','paymentLinkId','currency','amount','startPeriodicStatusCheck','\x20in\x20','has','map','\x20triggered\x20for\x20payment\x20','\x20details:','checkAllPendingPayments','\x20with\x20status\x20','status','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','payment.pending','‚ùå\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','clearPaymentTimers','üìä\x20[CHECK]\x20CoinToPay\x20payment\x20','\x20to\x20clear','\x20is\x20valid\x20for\x20checking,\x20proceeding...','\x20has\x20no\x20gatewayPaymentId,\x20skipping','GLOBAL_CHECK_INTERVAL_MS','\x20USDT','\x20is\x20older\x20than\x20','üßπ\x20[CHECK]\x20Payment\x20','\x20not\x20found\x20in\x20database','stringify','\x20\x20\x20üìÖ\x20Time:\x20','\x20status\x20is\x20','timestamp','‚ö†Ô∏è\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','expired','getTime','üîç\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','unknown','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','./currencyService','‚úÖ\x20[TIMER]\x20Individual\x20check\x20#','ü™ô\x20[DEBUG]\x20Creating\x20','shop','toISOString','remitterIban','gatewaySettings','getServiceStats','5\x20minutes','\x20completed\x20for\x20payment\x20','ü™ô\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','‚ùå\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','\x20status\x20unchanged\x20(','\x20(age:\x20','üìä\x20[CHECK]\x20Payment\x20','\x20\x20\x20üìù\x20Context:','shopId','status_check','currencyService','\x20marked\x20as\x20paid\x20at:\x20','schedule_created','entries','\x20\x20\x20Amount\x20after\x20commission:\x20','h),\x20skipping\x20global\x20check','ü™ô\x20[ERROR]\x20CoinToPay\x20Error:\x20','2\x20minutes','not\x20confirmed','bankDetails','settings','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','652bRUKrC','coinToPayStatusService','‚úÖ\x20[COINTOPAY]\x20Payment\x20link\x20','stack','loggerService','üìä\x20[HOURLY]\x20Payment\x20','ü™ô\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','\x20has\x20no\x20gatewayPaymentId','globalCheckInterval','\x20days','\x20status\x20from\x20','ü™ô\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','\x20expired\x20CoinToPay\x20payments','üîÑ\x20[CHECK]\x20Updating\x20payment\x20','üè¶\x20[CHECK]\x20Bank\x20details\x20provided:\x20','schedulePaymentChecks','logShopWebhookSent',',\x20status=','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','orderId','‚è∞\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','‚úÖ\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','./gateways/coinToPayService','675800zicAfT','SINGLE','not\x20found','parse','paymentDetails','telegramBotService','‚úÖ\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','\x20for\x20payment\x20','‚è∞\x20[EXPIRY]\x20Payment\x20','\x20\x20\x20Gateway\x20','logCoinToPayError','COMPLETED','‚úÖ\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','No\x20specific\x20commission\x20found\x20for\x20gateway\x20','\x20initial\x20timers\x20for\x20payment\x20','\x20current\x20status:\x20','PENDING','webhookUrl','FAILED','paymentTimers','from','create','‚ùå\x20[CHECK]\x20Payment\x20','confirmedOn','‚úÖ\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','\x20->\x20','Failed\x20to\x20send\x20shop\x20webhook:','PAID','\x20\x20\x20-\x20Gateway:\x20','3660VVyBvq','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','gatewayOrderId','./loggerService','\x20pending\x20CoinToPay\x20payments','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','size',':\x20type=','COINTOPAY_ERROR','../config/database','‚úÖ\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','\x20\x20\x20Amount:\x20','POST','floor','‚ö†Ô∏è\x20[CHECK]\x20Payment\x20','\x20payment\x20','üßπ\x20[DEBUG]\x20Cleared\x20timer\x20#','Payment\x20older\x20than\x20','322467QUDCoo','stopPeriodicStatusCheck','now','checkExpiredPayments','cointopay2','\x20status\x20changed\x20to\x20','EXPIRED','Webhook\x20event\x20','üÜî\x20[CHECK]\x20Transaction\x20ID:\x20','Unknown\x20error','payment.failed','getGatewayIdByName','3253520VqDxdm','CoinToPayService','toLowerCase','webhookEvents',',\x20stopping\x20individual\x20checks','amountAfterGatewayCommissionUSDT','set','\x20status:\x20','currentPayments','\x20days\x20(created\x20before\x20','Payment\x20not\x20found','cointopay','checkSinglePaymentById','.\x20Remaining\x20active\x20timers:\x20','sendPaymentStatusNotification','transactionId','text','log','\x20\x20\x20‚ùå\x20Error:\x20','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','gatewayPaymentId','üõë\x20[SHUTDOWN]\x20Cleared\x20','ü™ô\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','payment','\x20checked,\x20','getGatewayCommission','\x20in\x20shop\x20','‚è∞\x20[DEBUG]\x20Scheduled\x20check\x20#','‚ùå\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','‚ùå\x20[HOURLY]\x20Payment\x20','\x20skipped,\x20','\x20to\x20','\x20seconds\x20(','customerEmail','timers','push','includes','./gateways/coinToPay2Service','logCoinToPayStatus','error','gatewayCommissionRate','gateway','toFixed','ms)','checkSinglePayment','paidAt','\x20(after\x20','values','defineProperty','COINTOPAY_STATUS_CHANGE','iban','createdAt','__importDefault','12cLSvvn','catch','logWhiteDomainError','107237etHMLe','CoinToPayStatusService',',\x20clearing\x20individual\x20timers','üìä\x20[CHECK]\x20CoinToPay2\x20payment\x20','forEach','delay','\x20found:','\x20expired','./telegramBotService',',\x20using\x20default\x20commission\x2010%','\x20commission\x20for\x20shop\x20','‚è∞\x20[GLOBAL]\x20Payment\x20','6quhtBS','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:',',\x20currentPayments=','Success'];a52_0x113c=function(){return _0x2825ea;};return a52_0x113c();}const coinToPayService_1=require(a52_0x5551c7(0x10d)),coinToPay2Service_1=require(a52_0x5551c7(0x170)),gateway_1=require('../types/gateway'),database_1=__importDefault(require(a52_0x5551c7(0x136))),telegramBotService_1=require(a52_0x5551c7(0x18b)),loggerService_1=require(a52_0x5551c7(0x12f)),currencyService_1=require(a52_0x5551c7(0x1e5));class CoinToPayStatusService{constructor(){const _0x288615=a52_0x5551c7;this['globalCheckInterval']=null,this[_0x288615(0x1d6)]=0x3c*0x3c*0x3e8,this['EXPIRY_DAYS']=0x5,this[_0x288615(0x121)]=new Map(),this['coinToPayService']=new coinToPayService_1[(_0x288615(0x14c))](),this[_0x288615(0x1bb)]=new coinToPay2Service_1['CoinToPay2Service'](),console[_0x288615(0x15c)](_0x288615(0xfd));}[a52_0x5551c7(0x106)](_0x1b541a,_0x1ff657){const _0x263e93=a52_0x5551c7;console[_0x263e93(0x15c)](_0x263e93(0x1b9)),console[_0x263e93(0x15c)]('\x20\x20\x20-\x20paymentId:\x20'+_0x1b541a),console['log']('\x20\x20\x20-\x20gatewayPaymentId:\x20'+_0x1ff657),this[_0x263e93(0x1d1)](_0x1b541a);const _0x53f595=[],_0x2d3ba4=new Date(),_0x3bf081=[{'delay':0x1*0x3c*0x3e8,'description':_0x263e93(0x197)},{'delay':0x2*0x3c*0x3e8,'description':_0x263e93(0xf2)},{'delay':0x5*0x3c*0x3e8,'description':_0x263e93(0x1ed)},{'delay':0x5*0x3c*0x3e8,'description':_0x263e93(0x1ed)}];console[_0x263e93(0x15c)](_0x263e93(0x1e7)+_0x3bf081[_0x263e93(0x1bc)]+_0x263e93(0x11c)+_0x1b541a);let _0xa91c0a=0x0;_0x3bf081['forEach']((_0x25bc68,_0x3a32d2)=>{const _0x58fa15=_0x263e93;_0xa91c0a+=_0x25bc68[_0x58fa15(0x188)];const _0x2db407=setTimeout(async()=>{const _0x44254c=_0x58fa15;console[_0x44254c(0x15c)]('ü™ô\x20[TIMER]\x20Individual\x20check\x20#'+(_0x3a32d2+0x1)+_0x44254c(0x1c9)+_0x1b541a+_0x44254c(0x179)+_0x25bc68['description']+')');try{await this['checkSinglePaymentById'](_0x1b541a),console['log'](_0x44254c(0x1e6)+(_0x3a32d2+0x1)+_0x44254c(0x1ee)+_0x1b541a);}catch(_0x3c00b8){console[_0x44254c(0x172)]('‚ùå\x20[TIMER]\x20Failed\x20individual\x20check\x20#'+(_0x3a32d2+0x1)+_0x44254c(0x115)+_0x1b541a+':',_0x3c00b8),this[_0x44254c(0x118)](_0x1b541a,_0x1ff657,_0x3c00b8,_0x44254c(0x1f6),{'checkNumber':_0x3a32d2+0x1,'scheduledAfter':_0x25bc68[_0x44254c(0x1bf)],'isIndividualCheck':!![]});}},_0xa91c0a);_0x53f595['push'](_0x2db407),console[_0x58fa15(0x15c)](_0x58fa15(0x166)+(_0x3a32d2+0x1)+'\x20for\x20payment\x20'+_0x1b541a+_0x58fa15(0x1c6)+_0xa91c0a/0x3e8+_0x58fa15(0x16b)+_0x25bc68['description']+')');});const _0x59a0e1=setInterval(async()=>{const _0x260e4a=_0x263e93;console[_0x260e4a(0x15c)]('ü™ô\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20'+_0x1b541a);try{const _0x7c9aac=await database_1['default'][_0x260e4a(0x162)]['findUnique']({'where':{'id':_0x1b541a},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x7c9aac){console[_0x260e4a(0x15c)](_0x260e4a(0x168)+_0x1b541a+'\x20not\x20found,\x20clearing\x20timers'),this['clearPaymentTimers'](_0x1b541a);return;}console['log'](_0x260e4a(0xfc)+_0x1b541a+_0x260e4a(0x11d)+_0x7c9aac[_0x260e4a(0x1cd)]);if(_0x7c9aac[_0x260e4a(0x1cd)]!==_0x260e4a(0x11e)){console[_0x260e4a(0x15c)]('‚úÖ\x20[HOURLY]\x20Payment\x20'+_0x1b541a+_0x260e4a(0x1dd)+_0x7c9aac['status']+_0x260e4a(0x14f)),this['clearPaymentTimers'](_0x1b541a);return;}const _0x1e9319=Math[_0x260e4a(0x13a)]((Date[_0x260e4a(0x141)]()-_0x7c9aac['createdAt'][_0x260e4a(0x1e1)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x1e9319>=this['EXPIRY_DAYS']){console['log'](_0x260e4a(0x1b3)+_0x1b541a+_0x260e4a(0x1d8)+this[_0x260e4a(0x1ad)]+_0x260e4a(0x1ce)),this['clearPaymentTimers'](_0x1b541a);return;}await this[_0x260e4a(0x157)](_0x1b541a),console[_0x260e4a(0x15c)](_0x260e4a(0x10c)+_0x1b541a);}catch(_0x187ecf){console['error'](_0x260e4a(0x1f0)+_0x1b541a+':',_0x187ecf),this[_0x260e4a(0x118)](_0x1b541a,_0x1ff657,_0x187ecf,'status_check',{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x53f595[_0x263e93(0x16e)](_0x59a0e1),this[_0x263e93(0x121)][_0x263e93(0x151)](_0x1b541a,{'timers':_0x53f595,'paymentId':_0x1b541a,'gatewayPaymentId':_0x1ff657,'createdAt':_0x2d3ba4}),console[_0x263e93(0x15c)](_0x263e93(0x196)+_0x3bf081[_0x263e93(0x1bc)]+'\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20'+_0x1b541a),console[_0x263e93(0x15c)](_0x263e93(0x1a0)+this[_0x263e93(0x121)][_0x263e93(0x133)]),this[_0x263e93(0x171)](_0x1b541a,_0x1ff657,_0x263e93(0x11e),_0x263e93(0x11e),'status_check',{'action':_0x263e93(0xed),'scheduledChecks':_0x3bf081['length'],'firstCheckIn':_0x3bf081[0x0][_0x263e93(0x188)]/0x3e8,'totalTimers':this[_0x263e93(0x121)]['size']});}[a52_0x5551c7(0x1d1)](_0x199da8){const _0x599558=a52_0x5551c7,_0x311b07=this[_0x599558(0x121)][_0x599558(0x1b8)](_0x199da8);_0x311b07?(console['log']('üßπ\x20[DEBUG]\x20Clearing\x20'+_0x311b07[_0x599558(0x16d)][_0x599558(0x1bc)]+'\x20timers\x20for\x20payment\x20'+_0x199da8),_0x311b07['timers'][_0x599558(0x187)]((_0x563768,_0x3eee62)=>{const _0x3e3982=_0x599558;_0x563768&&(clearTimeout(_0x563768),clearInterval(_0x563768),console[_0x3e3982(0x15c)](_0x3e3982(0x13d)+(_0x3eee62+0x1)+_0x3e3982(0x115)+_0x199da8));}),this[_0x599558(0x121)][_0x599558(0x1b4)](_0x199da8),console[_0x599558(0x15c)](_0x599558(0x137)+_0x199da8+_0x599558(0x158)+this[_0x599558(0x121)][_0x599558(0x133)])):console[_0x599558(0x15c)](_0x599558(0x1df)+_0x199da8+_0x599558(0x1d3));}async['checkSinglePaymentById'](_0x16569f){const _0x515b7b=a52_0x5551c7;console[_0x515b7b(0x15c)](_0x515b7b(0x19d)+_0x16569f);const _0x524ed4=await database_1[_0x515b7b(0x1a9)][_0x515b7b(0x162)][_0x515b7b(0x199)]({'where':{'id':_0x16569f},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x524ed4){console['log'](_0x515b7b(0x124)+_0x16569f+_0x515b7b(0x1da));return;}console[_0x515b7b(0x15c)](_0x515b7b(0x1f3)+_0x16569f+_0x515b7b(0x189)),console[_0x515b7b(0x15c)](_0x515b7b(0x12b)+_0x524ed4[_0x515b7b(0x174)]),console[_0x515b7b(0x15c)]('\x20\x20\x20-\x20Status:\x20'+_0x524ed4[_0x515b7b(0x1cd)]),console['log'](_0x515b7b(0x1b2)+_0x524ed4[_0x515b7b(0x15f)]),console['log']('\x20\x20\x20-\x20Amount:\x20'+_0x524ed4[_0x515b7b(0x1c4)]+'\x20'+_0x524ed4['currency']),console[_0x515b7b(0x15c)]('\x20\x20\x20-\x20ShopId:\x20'+_0x524ed4['shopId']);if(_0x524ed4[_0x515b7b(0x174)]!==_0x515b7b(0x156)&&_0x524ed4[_0x515b7b(0x174)]!==_0x515b7b(0x143)){console['log'](_0x515b7b(0x13b)+_0x16569f+'\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20'+_0x524ed4[_0x515b7b(0x174)]+')');return;}if(_0x524ed4[_0x515b7b(0x1cd)]!==_0x515b7b(0x11e)){console[_0x515b7b(0x15c)]('‚ö†Ô∏è\x20[CHECK]\x20Payment\x20'+_0x16569f+_0x515b7b(0x1dd)+_0x524ed4[_0x515b7b(0x1cd)]+',\x20stopping\x20individual\x20checks'),this['clearPaymentTimers'](_0x16569f);return;}if(!_0x524ed4[_0x515b7b(0x15f)]){console[_0x515b7b(0x15c)](_0x515b7b(0x13b)+_0x16569f+_0x515b7b(0xfe));return;}console[_0x515b7b(0x15c)]('‚úÖ\x20[CHECK]\x20Payment\x20'+_0x16569f+_0x515b7b(0x1d4)),await this[_0x515b7b(0x177)](_0x524ed4);}[a52_0x5551c7(0x171)](_0x358d5d,_0x2e4c18,_0x4a2681,_0x36421e,_0x29dbde,_0x2a33da){const _0x360244=a52_0x5551c7,_0x1c5f71={'type':_0x360244(0x17c),'paymentId':_0x358d5d,'gatewayPaymentId':_0x2e4c18,'oldStatus':_0x4a2681,'newStatus':_0x36421e,'source':_0x29dbde,'timestamp':new Date()[_0x360244(0x1e9)](),'details':_0x2a33da||{}};loggerService_1[_0x360244(0xfb)]['logCoinToPayStatus'](_0x1c5f71),console[_0x360244(0x15c)](_0x360244(0x1ef)+_0x358d5d+'\x20('+_0x2e4c18+')'),console[_0x360244(0x15c)]('\x20\x20\x20üìä\x20Status:\x20'+_0x4a2681+_0x360244(0x128)+_0x36421e),console['log'](_0x360244(0x19b)+_0x29dbde),console[_0x360244(0x15c)](_0x360244(0x1dc)+_0x1c5f71[_0x360244(0x1de)]),_0x2a33da&&console[_0x360244(0x15c)]('\x20\x20\x20üìù\x20Details:',_0x2a33da);}['logCoinToPayError'](_0x1347d9,_0xdcfba9,_0x34a428,_0x39d0e5,_0x1f78fd){const _0xcc4c0f=a52_0x5551c7,_0x1855ab={'type':_0xcc4c0f(0x135),'paymentId':_0x1347d9,'gatewayPaymentId':_0xdcfba9,'error':_0x34a428 instanceof Error?{'message':_0x34a428[_0xcc4c0f(0x1ba)],'stack':_0x34a428[_0xcc4c0f(0xfa)]}:_0x34a428,'source':_0x39d0e5,'timestamp':new Date()[_0xcc4c0f(0x1e9)](),'context':_0x1f78fd||{}};loggerService_1[_0xcc4c0f(0xfb)][_0xcc4c0f(0x118)](_0x1855ab),console[_0xcc4c0f(0x172)](_0xcc4c0f(0xf1)+_0x1347d9+'\x20('+_0xdcfba9+')'),console[_0xcc4c0f(0x172)](_0xcc4c0f(0x15d)+(_0x34a428 instanceof Error?_0x34a428[_0xcc4c0f(0x1ba)]:_0x34a428)),console[_0xcc4c0f(0x172)](_0xcc4c0f(0x19b)+_0x39d0e5),console[_0xcc4c0f(0x172)]('\x20\x20\x20üìÖ\x20Time:\x20'+_0x1855ab[_0xcc4c0f(0x1de)]),_0x1f78fd&&console[_0xcc4c0f(0x172)](_0xcc4c0f(0x1f4),_0x1f78fd);}[a52_0x5551c7(0x1c5)](){const _0x2d2223=a52_0x5551c7;console['log'](_0x2d2223(0x161)),this[_0x2d2223(0x1cb)]()[_0x2d2223(0x181)](_0x207636=>{const _0x2f3fdc=_0x2d2223;console[_0x2f3fdc(0x172)]('‚ùå\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:',_0x207636);}),this[_0x2d2223(0xff)]=setInterval(async()=>{const _0x1d9481=_0x2d2223;try{console[_0x1d9481(0x15c)](_0x1d9481(0x1a5)),await this[_0x1d9481(0x1cb)](),console['log'](_0x1d9481(0x127));}catch(_0x338f66){console[_0x1d9481(0x172)]('‚ùå\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:',_0x338f66);}},this['GLOBAL_CHECK_INTERVAL_MS']),console['log']('‚úÖ\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)');}[a52_0x5551c7(0x140)](){const _0x60a135=a52_0x5551c7;console['log']('üõë\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...');this[_0x60a135(0xff)]&&(clearInterval(this[_0x60a135(0xff)]),this[_0x60a135(0xff)]=null,console[_0x60a135(0x15c)]('üõë\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped'));const _0x317a68=this[_0x60a135(0x121)][_0x60a135(0x133)];for(const [_0x5a6a6c]of this[_0x60a135(0x121)]){this[_0x60a135(0x1d1)](_0x5a6a6c);}console[_0x60a135(0x15c)](_0x60a135(0x160)+_0x317a68+_0x60a135(0x1b0));}async[a52_0x5551c7(0x1cb)](){const _0x942f47=a52_0x5551c7;try{console[_0x942f47(0x15c)](_0x942f47(0x1c0));const _0x10ec18=await database_1['default'][_0x942f47(0x162)]['findMany']({'where':{'gateway':{'in':[_0x942f47(0x156),_0x942f47(0x143)]},'status':_0x942f47(0x11e),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x942f47(0x15c)]('ü™ô\x20[GLOBAL]\x20Found\x20'+_0x10ec18[_0x942f47(0x1bc)]+_0x942f47(0x130));if(_0x10ec18[_0x942f47(0x1bc)]===0x0){console[_0x942f47(0x15c)](_0x942f47(0x102));return;}const _0x1f991f=await this[_0x942f47(0x142)](_0x10ec18);console[_0x942f47(0x15c)]('‚è∞\x20[GLOBAL]\x20Found\x20'+_0x1f991f[_0x942f47(0x1bc)]+_0x942f47(0x103));let _0xfd82aa=0x0,_0x288277=0x0;for(const _0x296a04 of _0x10ec18){try{if(_0x1f991f[_0x942f47(0x16f)](_0x296a04['id'])){console['log'](_0x942f47(0x18e)+_0x296a04['id']+'\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check'),_0x288277++;continue;}if(this[_0x942f47(0x121)][_0x942f47(0x1c7)](_0x296a04['id'])){console[_0x942f47(0x15c)](_0x942f47(0x18e)+_0x296a04['id']+_0x942f47(0x132)),_0x288277++;continue;}const _0x3965df=(Date[_0x942f47(0x141)]()-_0x296a04[_0x942f47(0x17e)][_0x942f47(0x1e1)]())/(0x3e8*0x3c*0x3c);if(_0x3965df<0x1){console['log'](_0x942f47(0x18e)+_0x296a04['id']+'\x20is\x20too\x20new\x20('+_0x3965df[_0x942f47(0x175)](0x1)+_0x942f47(0xf0)),_0x288277++;continue;}console['log'](_0x942f47(0x1e2)+_0x296a04['id']+_0x942f47(0x1f2)+_0x3965df[_0x942f47(0x175)](0x1)+'h)'),await this['checkSinglePayment'](_0x296a04),_0xfd82aa++,await new Promise(_0x4a3c75=>setTimeout(_0x4a3c75,0x7d0));}catch(_0x410edf){console[_0x942f47(0x172)]('‚ùå\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20'+_0x296a04['id']+':',_0x410edf),this[_0x942f47(0x118)](_0x296a04['id'],_0x296a04['gatewayPaymentId']||_0x942f47(0x1e3),_0x410edf,_0x942f47(0x1f6),{'isGlobalCheck':!![],'paymentAmount':_0x296a04[_0x942f47(0x1c4)],'paymentCurrency':_0x296a04['currency'],'shopId':_0x296a04[_0x942f47(0x1f5)],'createdAt':_0x296a04[_0x942f47(0x17e)]}),loggerService_1[_0x942f47(0xfb)][_0x942f47(0x182)]('cointopay',_0x942f47(0x1ac)+_0x296a04[_0x942f47(0x15f)],_0x410edf);}}console[_0x942f47(0x15c)](_0x942f47(0xf6)+_0xfd82aa+_0x942f47(0x163)+_0x288277+_0x942f47(0x169)+_0x1f991f[_0x942f47(0x1bc)]+_0x942f47(0x18a));}catch(_0x187b27){console['error'](_0x942f47(0x109),_0x187b27);}}async[a52_0x5551c7(0x142)](_0xb30c8a){const _0x181e51=a52_0x5551c7,_0x384e3d=[],_0x40b8a4=new Date();_0x40b8a4['setDate'](_0x40b8a4[_0x181e51(0x1ab)]()-this[_0x181e51(0x1ad)]),console[_0x181e51(0x15c)](_0x181e51(0x10b)+this[_0x181e51(0x1ad)]+_0x181e51(0x154)+_0x40b8a4[_0x181e51(0x1e9)]()+')');for(const _0x273f20 of _0xb30c8a){if(_0x273f20[_0x181e51(0x17e)]<_0x40b8a4){console[_0x181e51(0x15c)](_0x181e51(0x116)+_0x273f20['id']+_0x181e51(0x1d8)+this[_0x181e51(0x1ad)]+'\x20days,\x20marking\x20as\x20EXPIRED');try{this[_0x181e51(0x171)](_0x273f20['id'],_0x273f20['gatewayPaymentId']||_0x181e51(0x1e3),_0x181e51(0x11e),'EXPIRED','auto_expire',{'reason':_0x181e51(0x13e)+this[_0x181e51(0x1ad)]+_0x181e51(0x100),'createdAt':_0x273f20[_0x181e51(0x17e)],'daysSinceCreation':Math[_0x181e51(0x13a)]((Date['now']()-_0x273f20[_0x181e51(0x17e)][_0x181e51(0x1e1)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x273f20[_0x181e51(0x1c4)],'paymentCurrency':_0x273f20[_0x181e51(0x1c3)],'shopId':_0x273f20[_0x181e51(0x1f5)]}),await database_1[_0x181e51(0x1a9)][_0x181e51(0x162)][_0x181e51(0x1b7)]({'where':{'id':_0x273f20['id']},'data':{'status':_0x181e51(0x145),'updatedAt':new Date()}}),await database_1[_0x181e51(0x1a9)][_0x181e51(0x1c1)][_0x181e51(0x123)]({'data':{'paymentId':_0x273f20['id'],'shopId':_0x273f20['shopId'],'event':'cointopay_auto_expired','statusCode':0xc8,'responseBody':JSON[_0x181e51(0x1db)]({'reason':'Payment\x20older\x20than\x20'+this['EXPIRY_DAYS']+'\x20days','createdAt':_0x273f20[_0x181e51(0x17e)],'expiredAt':new Date()[_0x181e51(0x1e9)](),'daysSinceCreation':Math['floor']((Date[_0x181e51(0x141)]()-_0x273f20[_0x181e51(0x17e)]['getTime']())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x181e51(0x195)](_0x273f20,'EXPIRED'),await this['sendPaymentStatusNotification'](_0x273f20,_0x181e51(0x145)),this[_0x181e51(0x1d1)](_0x273f20['id']),_0x384e3d[_0x181e51(0x16e)](_0x273f20['id']),console[_0x181e51(0x15c)]('‚úÖ\x20[EXPIRY]\x20Payment\x20'+_0x273f20['id']+'\x20marked\x20as\x20EXPIRED\x20due\x20to\x20'+this[_0x181e51(0x1ad)]+_0x181e51(0x1b6));}catch(_0x535e01){console[_0x181e51(0x172)]('‚ùå\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20'+_0x273f20['id']+':',_0x535e01),this[_0x181e51(0x118)](_0x273f20['id'],_0x273f20[_0x181e51(0x15f)]||_0x181e51(0x1e3),_0x535e01,'auto_expire',{'reason':'Failed\x20to\x20mark\x20payment\x20as\x20expired','createdAt':_0x273f20['createdAt'],'daysSinceCreation':Math['floor']((Date[_0x181e51(0x141)]()-_0x273f20['createdAt'][_0x181e51(0x1e1)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x384e3d;}async[a52_0x5551c7(0x177)](_0x5a7e52){const _0x294c4a=a52_0x5551c7;if(!_0x5a7e52[_0x294c4a(0x15f)]){console['log'](_0x294c4a(0x13b)+_0x5a7e52['id']+_0x294c4a(0x1d5));return;}console[_0x294c4a(0x15c)](_0x294c4a(0x193)+_0x5a7e52[_0x294c4a(0x174)]+'\x20payment\x20'+_0x5a7e52['id']+'\x20('+_0x5a7e52['gatewayPaymentId']+')');try{let _0x4417cf;_0x5a7e52[_0x294c4a(0x174)]===_0x294c4a(0x143)?(_0x4417cf=await this[_0x294c4a(0x1bb)][_0x294c4a(0x1a6)](_0x5a7e52[_0x294c4a(0x15f)]),console[_0x294c4a(0x15c)](_0x294c4a(0x186)+_0x5a7e52['id']+_0x294c4a(0x152)+_0x4417cf[_0x294c4a(0x1cd)])):(_0x4417cf=await this[_0x294c4a(0x1af)][_0x294c4a(0x1a6)](_0x5a7e52[_0x294c4a(0x15f)]),console[_0x294c4a(0x15c)](_0x294c4a(0x1d2)+_0x5a7e52['id']+_0x294c4a(0x152)+_0x4417cf[_0x294c4a(0x1cd)]));_0x4417cf['paymentDetails']&&console[_0x294c4a(0x15c)]('üìä\x20[CHECK]\x20Payment\x20'+_0x5a7e52['id']+_0x294c4a(0x1ca),{'iban':_0x4417cf[_0x294c4a(0x112)][_0x294c4a(0x17d)]||_0x294c4a(0x110),'transactionId':_0x4417cf[_0x294c4a(0x112)][_0x294c4a(0x15a)],'createdOn':_0x4417cf[_0x294c4a(0x112)]['createdOn'],'confirmedOn':_0x4417cf[_0x294c4a(0x112)][_0x294c4a(0x125)]||_0x294c4a(0xf3)});if(_0x4417cf['status']!==_0x5a7e52[_0x294c4a(0x1cd)]){console[_0x294c4a(0x15c)](_0x294c4a(0x104)+_0x5a7e52['id']+_0x294c4a(0x101)+_0x5a7e52[_0x294c4a(0x1cd)]+_0x294c4a(0x16a)+_0x4417cf['status']),this[_0x294c4a(0x171)](_0x5a7e52['id'],_0x5a7e52[_0x294c4a(0x15f)],_0x5a7e52['status'],_0x4417cf[_0x294c4a(0x1cd)],_0x294c4a(0x1f6),{'paymentDetails':_0x4417cf[_0x294c4a(0x112)],'amount':_0x4417cf['amount'],'currency':_0x4417cf[_0x294c4a(0x1c3)],'shopId':_0x5a7e52[_0x294c4a(0x1f5)],'checkTimestamp':new Date()[_0x294c4a(0x1e9)]()});const _0x37cdf1={'status':_0x4417cf['status'],'updatedAt':new Date()};if(_0x4417cf[_0x294c4a(0x1cd)]===_0x294c4a(0x12a)&&_0x5a7e52[_0x294c4a(0x1cd)]!==_0x294c4a(0x12a)){_0x37cdf1['paidAt']=new Date();if(!_0x5a7e52['amountUSDT']){const _0x5eac8b=await currencyService_1[_0x294c4a(0xeb)]['convertToUSDT'](_0x5a7e52['amount'],_0x5a7e52[_0x294c4a(0x1c3)]);_0x37cdf1['amountUSDT']=_0x5eac8b;const _0x12d777=await this[_0x294c4a(0x164)](_0x5a7e52[_0x294c4a(0x1f5)],_0x5a7e52[_0x294c4a(0x174)]),_0x45eefb=_0x5eac8b*(0x1-_0x12d777/0x64);_0x37cdf1[_0x294c4a(0x150)]=_0x45eefb,_0x37cdf1[_0x294c4a(0x173)]=_0x12d777,console['log']('üí∞\x20[CHECK]\x20Payment\x20'+_0x5a7e52['id']+'\x20amounts\x20calculated:'),console[_0x294c4a(0x15c)](_0x294c4a(0x138)+_0x5a7e52[_0x294c4a(0x1c4)]+'\x20'+_0x5a7e52[_0x294c4a(0x1c3)]+_0x294c4a(0x128)+_0x5eac8b[_0x294c4a(0x175)](0x6)+'\x20USDT'),console[_0x294c4a(0x15c)](_0x294c4a(0x117)+_0x5a7e52['gateway']+_0x294c4a(0x1a8)+_0x12d777+'%'),console[_0x294c4a(0x15c)](_0x294c4a(0xef)+_0x45eefb['toFixed'](0x6)+_0x294c4a(0x1d7));}console[_0x294c4a(0x15c)]('üí∞\x20[CHECK]\x20Payment\x20'+_0x5a7e52['id']+_0x294c4a(0xec)+_0x37cdf1[_0x294c4a(0x178)]['toISOString']());}if(_0x4417cf[_0x294c4a(0x112)]){const _0x158937=_0x4417cf['paymentDetails'];_0x158937[_0x294c4a(0x17d)]&&(_0x37cdf1[_0x294c4a(0x1ea)]=_0x158937[_0x294c4a(0x17d)],console['log']('üè¶\x20[CHECK]\x20Saved\x20IBAN:\x20'+_0x158937[_0x294c4a(0x17d)])),_0x158937['bankDetails']&&console['log'](_0x294c4a(0x105)+_0x158937[_0x294c4a(0xf4)]),_0x158937['transactionId']&&console['log'](_0x294c4a(0x147)+_0x158937['transactionId']),_0x158937['confirmedOn']&&console[_0x294c4a(0x15c)](_0x294c4a(0x114)+_0x158937[_0x294c4a(0x125)]);}await database_1[_0x294c4a(0x1a9)][_0x294c4a(0x162)][_0x294c4a(0x1b7)]({'where':{'id':_0x5a7e52['id']},'data':_0x37cdf1});if(_0x4417cf[_0x294c4a(0x1cd)]===_0x294c4a(0x12a)&&_0x5a7e52[_0x294c4a(0x1cd)]!=='PAID'){console['log']('üìà\x20[COINTOPAY]\x20Payment\x20'+_0x5a7e52['id']+_0x294c4a(0x1e4));const _0xcdfecb=await database_1['default'][_0x294c4a(0x162)][_0x294c4a(0x199)]({'where':{'id':_0x5a7e52['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0xcdfecb?.[_0x294c4a(0x1c2)]&&_0xcdfecb[_0x294c4a(0x1a7)])try{const _0x2ff99d=_0xcdfecb[_0x294c4a(0x1a7)];console[_0x294c4a(0x15c)](_0x294c4a(0x1aa)+_0x2ff99d['id']+_0x294c4a(0x134)+_0x2ff99d[_0x294c4a(0x19c)]+_0x294c4a(0x191)+_0x2ff99d[_0x294c4a(0x153)]+',\x20status='+_0x2ff99d[_0x294c4a(0x1cd)]);const _0x8487c8=_0x2ff99d['currentPayments']+0x1,_0x3a634a=_0x2ff99d[_0x294c4a(0x19c)]===_0x294c4a(0x10f)?_0x294c4a(0x119):_0x2ff99d[_0x294c4a(0x1cd)];await database_1[_0x294c4a(0x1a9)][_0x294c4a(0x1a7)][_0x294c4a(0x1b7)]({'where':{'id':_0x2ff99d['id']},'data':{'currentPayments':_0x8487c8,'status':_0x3a634a,'updatedAt':new Date()}}),console[_0x294c4a(0x15c)](_0x294c4a(0xf9)+_0x2ff99d['id']+'\x20updated:\x20currentPayments='+_0x2ff99d[_0x294c4a(0x153)]+'\x20->\x20'+_0x8487c8+_0x294c4a(0x108)+_0x2ff99d[_0x294c4a(0x1cd)]+'\x20->\x20'+_0x3a634a);}catch(_0x2c6f4f){console[_0x294c4a(0x172)](_0x294c4a(0x167),_0x2c6f4f);}else console[_0x294c4a(0x15c)](_0x294c4a(0x1a2)+_0x5a7e52['id']+_0x294c4a(0x131));}await database_1['default']['webhookLog']['create']({'data':{'paymentId':_0x5a7e52['id'],'shopId':_0x5a7e52[_0x294c4a(0x1f5)],'event':_0x294c4a(0x1bd)+_0x4417cf['status'][_0x294c4a(0x14d)](),'statusCode':0xc8,'responseBody':JSON[_0x294c4a(0x1db)]({'oldStatus':_0x5a7e52[_0x294c4a(0x1cd)],'newStatus':_0x4417cf[_0x294c4a(0x1cd)],'paymentDetails':_0x4417cf[_0x294c4a(0x112)],'checkedAt':new Date()[_0x294c4a(0x1e9)]()})}}),await this[_0x294c4a(0x195)](_0x5a7e52,_0x4417cf[_0x294c4a(0x1cd)]),await this[_0x294c4a(0x159)](_0x5a7e52,_0x4417cf[_0x294c4a(0x1cd)]),_0x4417cf[_0x294c4a(0x1cd)]!==_0x294c4a(0x11e)&&(console[_0x294c4a(0x15c)](_0x294c4a(0x1d9)+_0x5a7e52['id']+_0x294c4a(0x144)+_0x4417cf[_0x294c4a(0x1cd)]+_0x294c4a(0x185)),this[_0x294c4a(0x1d1)](_0x5a7e52['id'])),console[_0x294c4a(0x15c)]('‚úÖ\x20[CHECK]\x20Payment\x20'+_0x5a7e52['id']+'\x20updated\x20successfully');}else console[_0x294c4a(0x15c)](_0x294c4a(0x1f3)+_0x5a7e52['id']+_0x294c4a(0x1f1)+_0x4417cf['status']+')'),this[_0x294c4a(0x171)](_0x5a7e52['id'],_0x5a7e52['gatewayPaymentId'],_0x5a7e52[_0x294c4a(0x1cd)],_0x4417cf[_0x294c4a(0x1cd)],'status_check',{'statusUnchanged':!![],'paymentDetails':_0x4417cf[_0x294c4a(0x112)],'amount':_0x4417cf[_0x294c4a(0x1c4)],'currency':_0x4417cf[_0x294c4a(0x1c3)],'shopId':_0x5a7e52['shopId'],'checkTimestamp':new Date()[_0x294c4a(0x1e9)]()});}catch(_0x387f0f){console[_0x294c4a(0x172)](_0x294c4a(0x1d0)+_0x5a7e52['id']+':',_0x387f0f),this[_0x294c4a(0x118)](_0x5a7e52['id'],_0x5a7e52['gatewayPaymentId'],_0x387f0f,_0x294c4a(0x1f6),{'paymentAmount':_0x5a7e52[_0x294c4a(0x1c4)],'paymentCurrency':_0x5a7e52[_0x294c4a(0x1c3)],'shopId':_0x5a7e52[_0x294c4a(0x1f5)],'createdAt':_0x5a7e52[_0x294c4a(0x17e)]}),await database_1[_0x294c4a(0x1a9)][_0x294c4a(0x1c1)][_0x294c4a(0x123)]({'data':{'paymentId':_0x5a7e52['id'],'shopId':_0x5a7e52[_0x294c4a(0x1f5)],'event':'cointopay_status_check_error','statusCode':0x1f4,'responseBody':JSON[_0x294c4a(0x1db)]({'error':_0x387f0f instanceof Error?_0x387f0f[_0x294c4a(0x1ba)]:_0x294c4a(0x148),'gatewayPaymentId':_0x5a7e52[_0x294c4a(0x15f)],'checkedAt':new Date()[_0x294c4a(0x1e9)]()})}});}}async['sendShopWebhook'](_0x40e186,_0x364317){const _0x327f6e=a52_0x5551c7,_0x347e6a=Date[_0x327f6e(0x141)]();try{const _0x2cb374=_0x40e186['shop'],_0x393002=_0x2cb374[_0x327f6e(0xf5)];if(!_0x393002?.[_0x327f6e(0x11f)]){console[_0x327f6e(0x15c)]('No\x20webhook\x20URL\x20configured\x20for\x20shop\x20'+_0x2cb374['id']);return;}const _0x531f53=_0x364317===_0x327f6e(0x12a)?'payment.success':_0x364317===_0x327f6e(0x120)?_0x327f6e(0x149):_0x364317===_0x327f6e(0x145)?_0x327f6e(0x149):_0x327f6e(0x1cf);if(!_0x393002[_0x327f6e(0x14e)]?.[_0x327f6e(0x16f)](_0x531f53)){console[_0x327f6e(0x15c)](_0x327f6e(0x146)+_0x531f53+_0x327f6e(0x19e)+_0x2cb374['id']);return;}const _0x272ea0=(0x0,gateway_1[_0x327f6e(0x14a)])(_0x40e186['gateway'])||_0x40e186[_0x327f6e(0x174)],_0x59a80c={'event':_0x531f53,'payment':{'id':_0x40e186['id'],'order_id':_0x40e186[_0x327f6e(0x10a)],'gateway_order_id':_0x40e186[_0x327f6e(0x12e)],'gateway':_0x272ea0,'amount':_0x40e186['amount'],'currency':_0x40e186[_0x327f6e(0x1c3)],'status':_0x364317['toLowerCase'](),'customer_email':_0x40e186[_0x327f6e(0x16c)],'customer_name':_0x40e186['customerName'],'created_at':_0x40e186[_0x327f6e(0x17e)],'updated_at':new Date()}},_0x1c9c69=await fetch(_0x393002[_0x327f6e(0x11f)],{'method':_0x327f6e(0x139),'headers':{'Content-Type':'application/json','User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x327f6e(0x1db)](_0x59a80c)}),_0x47afaa=Date[_0x327f6e(0x141)]()-_0x347e6a,_0x3199c2=_0x1c9c69['ok']?_0x327f6e(0x192):await _0x1c9c69[_0x327f6e(0x15b)]();loggerService_1[_0x327f6e(0xfb)][_0x327f6e(0x107)](_0x40e186[_0x327f6e(0x1f5)],_0x393002[_0x327f6e(0x11f)],_0x531f53,_0x1c9c69[_0x327f6e(0x1cd)],_0x47afaa,_0x59a80c),console[_0x327f6e(0x15c)](_0x327f6e(0x194)+_0x393002[_0x327f6e(0x11f)]+_0x327f6e(0x1cc)+_0x1c9c69[_0x327f6e(0x1cd)]+'\x20('+_0x47afaa+_0x327f6e(0x176));}catch(_0x482719){console['error'](_0x327f6e(0x129),_0x482719),loggerService_1[_0x327f6e(0xfb)]['logShopWebhookError'](_0x40e186[_0x327f6e(0x1f5)],_0x40e186[_0x327f6e(0x1e8)]?.[_0x327f6e(0xf5)]?.[_0x327f6e(0x11f)]||_0x327f6e(0x1e3),_0x327f6e(0x198),_0x482719,{});}}async['sendPaymentStatusNotification'](_0x22c36a,_0x2c398e){const _0x5b0efd=a52_0x5551c7;try{const _0x3eb5ee={'PENDING':_0x5b0efd(0x19f),'PAID':_0x5b0efd(0x1a4),'FAILED':'failed','EXPIRED':_0x5b0efd(0x1e0)},_0x24176f=_0x3eb5ee[_0x2c398e];if(!_0x24176f||_0x24176f===_0x5b0efd(0x19f))return;await telegramBotService_1[_0x5b0efd(0x113)][_0x5b0efd(0x1be)](_0x22c36a[_0x5b0efd(0x1f5)],_0x22c36a,_0x24176f);}catch(_0x12c704){console[_0x5b0efd(0x172)](_0x5b0efd(0x190),_0x12c704);}}async['checkPaymentById'](_0x324f1c){const _0x1ba1c6=a52_0x5551c7;console[_0x1ba1c6(0x15c)]('üîç\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20'+_0x324f1c);const _0x3b1f23=await database_1[_0x1ba1c6(0x1a9)][_0x1ba1c6(0x162)][_0x1ba1c6(0x199)]({'where':{'id':_0x324f1c},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x3b1f23)throw new Error(_0x1ba1c6(0x155));if(_0x3b1f23[_0x1ba1c6(0x174)]!==_0x1ba1c6(0x156)&&_0x3b1f23[_0x1ba1c6(0x174)]!==_0x1ba1c6(0x143))throw new Error(_0x1ba1c6(0x15e));console[_0x1ba1c6(0x15c)](_0x1ba1c6(0x11a)+_0x3b1f23[_0x1ba1c6(0x174)]+_0x1ba1c6(0x13c)+_0x324f1c),await this[_0x1ba1c6(0x177)](_0x3b1f23),console[_0x1ba1c6(0x15c)](_0x1ba1c6(0x126)+_0x324f1c);}[a52_0x5551c7(0x1ec)](){const _0xb4a827=a52_0x5551c7,_0xa7f2a0=this[_0xb4a827(0xff)]?this[_0xb4a827(0x1d6)]:undefined,_0x3b269f=Array[_0xb4a827(0x122)](this[_0xb4a827(0x121)][_0xb4a827(0x17a)]())[_0xb4a827(0x1c8)](_0x59cf79=>({'paymentId':_0x59cf79['paymentId'],'gatewayPaymentId':_0x59cf79['gatewayPaymentId'],'createdAt':_0x59cf79[_0xb4a827(0x17e)],'timersCount':_0x59cf79[_0xb4a827(0x16d)][_0xb4a827(0x1bc)]}));return{'isActive':!!this[_0xb4a827(0xff)],'globalCheckIntervalMinutes':this['GLOBAL_CHECK_INTERVAL_MS']/(0x3e8*0x3c),'expiryDays':this[_0xb4a827(0x1ad)],'activeIndividualTimers':this[_0xb4a827(0x121)][_0xb4a827(0x133)],'nextGlobalCheckIn':_0xa7f2a0,'paymentTimersDetails':_0x3b269f};}['getPaymentTimerInfo'](_0x5b4863){const _0xeb76e=a52_0x5551c7,_0xa90291=this[_0xeb76e(0x121)][_0xeb76e(0x1b8)](_0x5b4863);if(_0xa90291)return{'hasTimers':!![],'timersCount':_0xa90291[_0xeb76e(0x16d)][_0xeb76e(0x1bc)],'createdAt':_0xa90291[_0xeb76e(0x17e)],'gatewayPaymentId':_0xa90291['gatewayPaymentId']};return{'hasTimers':![]};}async['getGatewayCommission'](_0x4ffbc5,_0x4c61ff){const _0x218452=a52_0x5551c7;try{const _0x50b2fe=await database_1[_0x218452(0x1a9)][_0x218452(0x1e8)][_0x218452(0x199)]({'where':{'id':_0x4ffbc5},'select':{'gatewaySettings':!![]}});if(!_0x50b2fe?.[_0x218452(0x1eb)])return console['log'](_0x218452(0x12d)+_0x4ffbc5+_0x218452(0x18c)),0xa;const _0x47c510=JSON[_0x218452(0x111)](_0x50b2fe[_0x218452(0x1eb)]);for(const [_0x55d469,_0x540f47]of Object[_0x218452(0xee)](_0x47c510)){if(_0x55d469[_0x218452(0x14d)]()===_0x4c61ff['toLowerCase']()){const _0x25a3f5=_0x540f47[_0x218452(0x1b1)]||0xa;return console[_0x218452(0x15c)]('Gateway\x20'+_0x4c61ff+_0x218452(0x18d)+_0x4ffbc5+':\x20'+_0x25a3f5+'%'),_0x25a3f5;}}return console[_0x218452(0x15c)](_0x218452(0x11b)+_0x4c61ff+_0x218452(0x165)+_0x4ffbc5+_0x218452(0x19a)),0xa;}catch(_0x4452eb){return console[_0x218452(0x172)]('Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20'+_0x4ffbc5+_0x218452(0x1b5)+_0x4c61ff+':',_0x4452eb),0xa;}}}exports[a52_0x5551c7(0x184)]=CoinToPayStatusService,exports['coinToPayStatusService']=new CoinToPayStatusService();