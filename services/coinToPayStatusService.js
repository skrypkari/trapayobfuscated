'use strict';function a38_0x3ca8(_0x3f6905,_0x5010f1){const _0xd4f60f=a38_0xd4f6();return a38_0x3ca8=function(_0x3ca877,_0x1e8f3d){_0x3ca877=_0x3ca877-0x1d8;let _0x1b3781=_0xd4f60f[_0x3ca877];return _0x1b3781;},a38_0x3ca8(_0x3f6905,_0x5010f1);}const a38_0x35ffb4=a38_0x3ca8;(function(_0x4bd930,_0x20ca3e){const _0x3f0032=a38_0x3ca8,_0x2b4741=_0x4bd930();while(!![]){try{const _0x21aea7=parseInt(_0x3f0032(0x24f))/0x1+parseInt(_0x3f0032(0x200))/0x2+parseInt(_0x3f0032(0x207))/0x3*(parseInt(_0x3f0032(0x206))/0x4)+parseInt(_0x3f0032(0x2cc))/0x5+-parseInt(_0x3f0032(0x280))/0x6*(-parseInt(_0x3f0032(0x2c7))/0x7)+parseInt(_0x3f0032(0x1f7))/0x8+-parseInt(_0x3f0032(0x254))/0x9;if(_0x21aea7===_0x20ca3e)break;else _0x2b4741['push'](_0x2b4741['shift']());}catch(_0x48d132){_0x2b4741['push'](_0x2b4741['shift']());}}}(a38_0xd4f6,0x9a3c8));var __importDefault=this&&this[a38_0x35ffb4(0x281)]||function(_0x1a5242){const _0x4fe169=a38_0x35ffb4;return _0x1a5242&&_0x1a5242[_0x4fe169(0x24b)]?_0x1a5242:{'default':_0x1a5242};};Object[a38_0x35ffb4(0x229)](exports,a38_0x35ffb4(0x24b),{'value':!![]}),exports[a38_0x35ffb4(0x2c9)]=exports[a38_0x35ffb4(0x2dd)]=void 0x0;const coinToPayService_1=require(a38_0x35ffb4(0x2be)),coinToPay2Service_1=require('./gateways/coinToPay2Service'),gateway_1=require(a38_0x35ffb4(0x272)),database_1=__importDefault(require(a38_0x35ffb4(0x274))),telegramBotService_1=require(a38_0x35ffb4(0x2f3)),loggerService_1=require(a38_0x35ffb4(0x209)),currencyService_1=require(a38_0x35ffb4(0x21a));function a38_0xd4f6(){const _0x31c3a8=['findMany','✅\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','from','\x20\x20\x20❌\x20Error:\x20','getTime','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','stack','\x20completed\x20for\x20payment\x20','EXPIRY_DAYS','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','delete','confirmedOn','📈\x20[COINTOPAY]\x20Payment\x20','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','checkSinglePayment','COMPLETED','parse','message','findUnique','Failed\x20to\x20mark\x20payment\x20as\x20expired','1306200MMWagO','CoinToPay2Service','not\x20found','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','gatewayPaymentId','now',',\x20gateway\x20','\x20\x20\x20📍\x20Source:\x20','telegramBotService','1066972DlmjPD','🪙\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','created','transactionId','\x20is\x20too\x20new\x20(','type','4OJXaPa','530889GlmNeu','2\x20minutes','./loggerService','status_check','🆔\x20[CHECK]\x20Transaction\x20ID:\x20','COINTOPAY_STATUS_CHANGE','\x20->\x20','Gateway\x20','payment.failed','convertToUSDT','schedule_created','🪙\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','coinToPay2Service','iban','\x20status\x20changed\x20to\x20','auto_expire','Payment\x20not\x20found','\x20USDT','Shop\x20webhook\x20sent\x20to\x20','./currencyService','✅\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','update','createdAt','\x20\x20\x20Amount:\x20','getServiceStats','\x20individual\x20payment\x20timers','error','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','startPeriodicStatusCheck','\x20days\x20without\x20payment\x20confirmation','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','\x20status\x20is\x20','loggerService','✅\x20[COINTOPAY]\x20Payment\x20link\x20','defineProperty','ms)','schedulePaymentChecks','\x20triggered\x20for\x20payment\x20','application/json','clearPaymentTimers','toFixed','⏰\x20[GLOBAL]\x20Found\x20','shopId','failed','text','Automatically\x20expired\x20after\x20','\x20\x20\x20-\x20Amount:\x20','forEach','📊\x20[CHECK]\x20Payment\x20','customerName','\x20days','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','5\x20minutes','\x20is\x20valid\x20for\x20checking,\x20proceeding...','unknown','\x20amounts\x20calculated:','bankDetails','Failed\x20to\x20send\x20shop\x20webhook:','\x20days,\x20marking\x20as\x20EXPIRED','\x20pending\x20CoinToPay\x20payments','\x20not\x20enabled\x20for\x20shop\x20','\x20commission:\x20','timers',',\x20using\x20default\x20commission\x2010%','payment.pending','🔄\x20[CHECK]\x20Updating\x20payment\x20','\x20\x20\x20-\x20Gateway:\x20','timestamp','__esModule','shop','coinToPayService','❌\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','42924uagnQw','floor','/status/','📊\x20[HOURLY]\x20Payment\x20','size','13096917flDjTE','getGatewayCommission','🪙\x20[TIMER]\x20Individual\x20check\x20#','logShopWebhookError','paymentLink','❌\x20[TIMER]\x20Failed\x20individual\x20check\x20#','🧹\x20[DEBUG]\x20Cleared\x20timer\x20#','toLowerCase','createdOn','🛑\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','Success','\x20is\x20older\x20than\x20','💰\x20[CHECK]\x20Payment\x20','set','❌\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','Unknown\x20error','orderId','gateway','\x20expired\x20CoinToPay\x20payments','cointopay_status_check_error','✅\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','\x20\x20\x20Amount\x20after\x20commission:\x20','❌\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','⚠️\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','includes','❌\x20[HOURLY]\x20Payment\x20','Webhook\x20event\x20','description','🧹\x20[CHECK]\x20Payment\x20','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','../types/gateway','h),\x20skipping\x20global\x20check','../config/database','currencyService','✅\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','PAID','expired','currency','sendShopWebhook','getDate','No\x20specific\x20commission\x20found\x20for\x20gateway\x20','📊\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','\x20days\x20(created\x20before\x20','\x20\x20\x20📊\x20Status:\x20','30Ejqqgs','__importDefault','🧹\x20[DEBUG]\x20Clearing\x20','TesSoft\x20Payment\x20System/1.0','FAILED','customerEmail',',\x20status=','\x20(after\x20','\x20updated:\x20currentPayments=','❌\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','default','\x20expired','has','globalCheckInterval','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','GLOBAL_CHECK_INTERVAL_MS','🪙\x20[DEBUG]\x20Creating\x20','🔍\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','COINTOPAY_ERROR','Payment\x20older\x20than\x20','webhookUrl','logCoinToPayStatus',',\x20stopping\x20individual\x20checks','1\x20minute','webhook_send',',\x20currentPayments=','payment','log','❌\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','⚠️\x20[CHECK]\x20Payment\x20','⏰\x20[DEBUG]\x20Scheduled\x20check\x20#','\x20for\x20payment\x20','PENDING','\x20checked,\x20','paymentDetails','logShopWebhookSent','push','paymentTimers','\x20status\x20from\x20','length','❌\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','EXPIRED','currentPayments','📈\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','delay','\x20\x20\x20-\x20GatewayPaymentId:\x20','paid','cointopay_auto_expired','amount','\x20\x20\x20Gateway\x20','cointopay2','⏰\x20[GLOBAL]\x20Payment\x20','\x20initial\x20timers\x20for\x20payment\x20','🪙\x20[GLOBAL]\x20Found\x20','\x20to\x20clear','\x20current\x20status:\x20','sendPaymentNotification','\x20\x20\x20📝\x20Details:','\x20has\x20no\x20gatewayPaymentId','amountAfterGatewayCommissionUSDT','checkAllPendingPayments','./gateways/coinToPayService','📊\x20[CHECK]\x20CoinToPay2\x20payment\x20','Bank\x20Details:\x20','payment.success','✅\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','\x20has\x20no\x20gatewayPaymentId,\x20skipping','CoinToPayService','\x20skipped,\x20','paidAt','161441cKTPEB','settings','coinToPayStatusService','checkPaymentStatus','✅\x20[DEBUG]\x20Successfully\x20scheduled\x20','5275010jkpnln','get','\x20seconds\x20(','cointopay','🛑\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','✅\x20[TIMER]\x20Individual\x20check\x20#','\x20\x20\x20-\x20Status:\x20','stopPeriodicStatusCheck','\x20not\x20found\x20in\x20database','🪙\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','amountUSDT','\x20marked\x20as\x20paid\x20at:\x20','logCoinToPayError','❌\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','webhookLog','✅\x20[CHECK]\x20Payment\x20','toISOString','CoinToPayStatusService','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','checkSinglePaymentById','remitterIban','checkExpiredPayments','\x20\x20\x20-\x20gatewayPaymentId:\x20','🔍\x20[CHECK]\x20Checking\x20','getPaymentTimerInfo','stringify','\x20status\x20unchanged\x20(','🛑\x20[SHUTDOWN]\x20Cleared\x20','\x20details:','\x20commission\x20for\x20shop\x20','⏰\x20[HOURLY]\x20Payment\x20','\x20status:\x20','✅\x20[EXPIRY]\x20Payment\x20','SINGLE','create','✅\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','✅\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','🔍\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','🪙\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','./telegramBotService','\x20\x20\x20📅\x20Time:\x20','\x20\x20\x20📝\x20Context:','\x20\x20\x20-\x20paymentId:\x20',',\x20clearing\x20individual\x20timers','🏦\x20[CHECK]\x20Saved\x20IBAN:\x20','\x20payment\x20','gatewaySettings','\x20found:','🏦\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes','sendPaymentStatusNotification','adminNotes',':\x20type=','status'];a38_0xd4f6=function(){return _0x31c3a8;};return a38_0xd4f6();}class CoinToPayStatusService{constructor(){const _0x4fbbb1=a38_0x35ffb4;this[_0x4fbbb1(0x28d)]=null,this[_0x4fbbb1(0x28f)]=0x3c*0x3c*0x3e8,this[_0x4fbbb1(0x1eb)]=0x5,this['paymentTimers']=new Map(),this[_0x4fbbb1(0x24d)]=new coinToPayService_1[(_0x4fbbb1(0x2c4))](),this[_0x4fbbb1(0x213)]=new coinToPay2Service_1[(_0x4fbbb1(0x1f8))](),console['log']('🪙\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2');}[a38_0x35ffb4(0x22b)](_0x55de0e,_0x59d3f0){const _0x14fd07=a38_0x35ffb4;console[_0x14fd07(0x29b)](_0x14fd07(0x212)),console[_0x14fd07(0x29b)](_0x14fd07(0x1d8)+_0x55de0e),console[_0x14fd07(0x29b)](_0x14fd07(0x2e2)+_0x59d3f0),this['clearPaymentTimers'](_0x55de0e);const _0x1f4800=[],_0x49798e=new Date(),_0x21bb0d=[{'delay':0x1*0x3c*0x3e8,'description':_0x14fd07(0x297)},{'delay':0x2*0x3c*0x3e8,'description':_0x14fd07(0x208)},{'delay':0x5*0x3c*0x3e8,'description':_0x14fd07(0x23b)},{'delay':0x5*0x3c*0x3e8,'description':_0x14fd07(0x23b)}];console[_0x14fd07(0x29b)](_0x14fd07(0x290)+_0x21bb0d[_0x14fd07(0x2a7)]+_0x14fd07(0x2b5)+_0x55de0e);let _0x16c553=0x0;_0x21bb0d['forEach']((_0x1cda08,_0x121c24)=>{const _0xd79fb3=_0x14fd07;_0x16c553+=_0x1cda08['delay'];const _0x2ee13f=setTimeout(async()=>{const _0x4eef1b=a38_0x3ca8;console[_0x4eef1b(0x29b)](_0x4eef1b(0x256)+(_0x121c24+0x1)+_0x4eef1b(0x22c)+_0x55de0e+_0x4eef1b(0x287)+_0x1cda08[_0x4eef1b(0x26f)]+')');try{await this[_0x4eef1b(0x2df)](_0x55de0e),console[_0x4eef1b(0x29b)](_0x4eef1b(0x2d1)+(_0x121c24+0x1)+_0x4eef1b(0x1ea)+_0x55de0e);}catch(_0x41db59){console[_0x4eef1b(0x221)](_0x4eef1b(0x259)+(_0x121c24+0x1)+_0x4eef1b(0x29f)+_0x55de0e+':',_0x41db59),this[_0x4eef1b(0x2d8)](_0x55de0e,_0x59d3f0,_0x41db59,'status_check',{'checkNumber':_0x121c24+0x1,'scheduledAfter':_0x1cda08[_0x4eef1b(0x26f)],'isIndividualCheck':!![]});}},_0x16c553);_0x1f4800['push'](_0x2ee13f),console['log'](_0xd79fb3(0x29e)+(_0x121c24+0x1)+'\x20for\x20payment\x20'+_0x55de0e+'\x20in\x20'+_0x16c553/0x3e8+_0xd79fb3(0x2ce)+_0x1cda08[_0xd79fb3(0x26f)]+')');});const _0x5d51e7=setInterval(async()=>{const _0x541d40=_0x14fd07;console['log'](_0x541d40(0x201)+_0x55de0e);try{const _0x300cb=await database_1[_0x541d40(0x28a)][_0x541d40(0x29a)][_0x541d40(0x1f5)]({'where':{'id':_0x55de0e},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x300cb){console['log'](_0x541d40(0x26d)+_0x55de0e+'\x20not\x20found,\x20clearing\x20timers'),this[_0x541d40(0x22e)](_0x55de0e);return;}console[_0x541d40(0x29b)](_0x541d40(0x252)+_0x55de0e+_0x541d40(0x2b8)+_0x300cb[_0x541d40(0x1e2)]);if(_0x300cb[_0x541d40(0x1e2)]!==_0x541d40(0x2a0)){console[_0x541d40(0x29b)]('✅\x20[HOURLY]\x20Payment\x20'+_0x55de0e+_0x541d40(0x226)+_0x300cb[_0x541d40(0x1e2)]+',\x20stopping\x20individual\x20checks'),this[_0x541d40(0x22e)](_0x55de0e);return;}const _0x748995=Math[_0x541d40(0x250)]((Date[_0x541d40(0x1fc)]()-_0x300cb[_0x541d40(0x21d)][_0x541d40(0x1e7)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x748995>=this[_0x541d40(0x1eb)]){console['log'](_0x541d40(0x2ea)+_0x55de0e+_0x541d40(0x25f)+this[_0x541d40(0x1eb)]+_0x541d40(0x1ec)),this[_0x541d40(0x22e)](_0x55de0e);return;}await this[_0x541d40(0x2df)](_0x55de0e),console[_0x541d40(0x29b)](_0x541d40(0x21b)+_0x55de0e);}catch(_0x4bb3b8){console['error']('❌\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20'+_0x55de0e+':',_0x4bb3b8),this[_0x541d40(0x2d8)](_0x55de0e,_0x59d3f0,_0x4bb3b8,_0x541d40(0x20a),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x1f4800[_0x14fd07(0x2a4)](_0x5d51e7),this[_0x14fd07(0x2a5)][_0x14fd07(0x261)](_0x55de0e,{'timers':_0x1f4800,'paymentId':_0x55de0e,'gatewayPaymentId':_0x59d3f0,'createdAt':_0x49798e}),console['log'](_0x14fd07(0x2cb)+_0x21bb0d['length']+_0x14fd07(0x225)+_0x55de0e),console[_0x14fd07(0x29b)](_0x14fd07(0x27d)+this[_0x14fd07(0x2a5)][_0x14fd07(0x253)]),this['logCoinToPayStatus'](_0x55de0e,_0x59d3f0,_0x14fd07(0x2a0),'PENDING',_0x14fd07(0x20a),{'action':_0x14fd07(0x211),'scheduledChecks':_0x21bb0d[_0x14fd07(0x2a7)],'firstCheckIn':_0x21bb0d[0x0][_0x14fd07(0x2ad)]/0x3e8,'totalTimers':this[_0x14fd07(0x2a5)][_0x14fd07(0x253)]});}[a38_0x35ffb4(0x22e)](_0x3fbcd4){const _0x1e4f8c=a38_0x35ffb4,_0x328fcc=this['paymentTimers'][_0x1e4f8c(0x2cd)](_0x3fbcd4);_0x328fcc?(console['log'](_0x1e4f8c(0x282)+_0x328fcc[_0x1e4f8c(0x245)][_0x1e4f8c(0x2a7)]+'\x20timers\x20for\x20payment\x20'+_0x3fbcd4),_0x328fcc['timers'][_0x1e4f8c(0x236)]((_0x33e946,_0x54cba9)=>{const _0x2bd59b=_0x1e4f8c;_0x33e946&&(clearTimeout(_0x33e946),clearInterval(_0x33e946),console['log'](_0x2bd59b(0x25a)+(_0x54cba9+0x1)+_0x2bd59b(0x29f)+_0x3fbcd4));}),this[_0x1e4f8c(0x2a5)][_0x1e4f8c(0x1ed)](_0x3fbcd4),console['log'](_0x1e4f8c(0x2f0)+_0x3fbcd4+'.\x20Remaining\x20active\x20timers:\x20'+this['paymentTimers'][_0x1e4f8c(0x253)])):console[_0x1e4f8c(0x29b)](_0x1e4f8c(0x26b)+_0x3fbcd4+_0x1e4f8c(0x2b7));}async[a38_0x35ffb4(0x2df)](_0x4ef835){const _0x2c6a7f=a38_0x35ffb4;console[_0x2c6a7f(0x29b)](_0x2c6a7f(0x2f1)+_0x4ef835);const _0x3ac4f8=await database_1[_0x2c6a7f(0x28a)][_0x2c6a7f(0x29a)][_0x2c6a7f(0x1f5)]({'where':{'id':_0x4ef835},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x3ac4f8){console[_0x2c6a7f(0x29b)]('❌\x20[CHECK]\x20Payment\x20'+_0x4ef835+_0x2c6a7f(0x2d4));return;}console['log'](_0x2c6a7f(0x237)+_0x4ef835+_0x2c6a7f(0x1dd)),console[_0x2c6a7f(0x29b)](_0x2c6a7f(0x249)+_0x3ac4f8[_0x2c6a7f(0x265)]),console['log'](_0x2c6a7f(0x2d2)+_0x3ac4f8['status']),console[_0x2c6a7f(0x29b)](_0x2c6a7f(0x2ae)+_0x3ac4f8[_0x2c6a7f(0x1fb)]),console[_0x2c6a7f(0x29b)](_0x2c6a7f(0x235)+_0x3ac4f8[_0x2c6a7f(0x2b1)]+'\x20'+_0x3ac4f8[_0x2c6a7f(0x279)]),console[_0x2c6a7f(0x29b)]('\x20\x20\x20-\x20ShopId:\x20'+_0x3ac4f8[_0x2c6a7f(0x231)]);if(_0x3ac4f8[_0x2c6a7f(0x265)]!=='cointopay'&&_0x3ac4f8[_0x2c6a7f(0x265)]!==_0x2c6a7f(0x2b3)){console[_0x2c6a7f(0x29b)](_0x2c6a7f(0x29d)+_0x4ef835+_0x2c6a7f(0x1fa)+_0x3ac4f8[_0x2c6a7f(0x265)]+')');return;}if(_0x3ac4f8[_0x2c6a7f(0x1e2)]!==_0x2c6a7f(0x2a0)){console[_0x2c6a7f(0x29b)](_0x2c6a7f(0x29d)+_0x4ef835+_0x2c6a7f(0x226)+_0x3ac4f8[_0x2c6a7f(0x1e2)]+_0x2c6a7f(0x296)),this[_0x2c6a7f(0x22e)](_0x4ef835);return;}if(!_0x3ac4f8[_0x2c6a7f(0x1fb)]){console[_0x2c6a7f(0x29b)](_0x2c6a7f(0x29d)+_0x4ef835+_0x2c6a7f(0x2bb));return;}console[_0x2c6a7f(0x29b)](_0x2c6a7f(0x2db)+_0x4ef835+_0x2c6a7f(0x23c)),await this[_0x2c6a7f(0x1f1)](_0x3ac4f8);}[a38_0x35ffb4(0x295)](_0x3c429a,_0x25031c,_0x118515,_0x3cfb8c,_0x228548,_0xf4c59a){const _0x8b09cf=a38_0x35ffb4,_0x525ef4={'type':_0x8b09cf(0x20c),'paymentId':_0x3c429a,'gatewayPaymentId':_0x25031c,'oldStatus':_0x118515,'newStatus':_0x3cfb8c,'source':_0x228548,'timestamp':new Date()['toISOString'](),'details':_0xf4c59a||{}};loggerService_1[_0x8b09cf(0x227)]['logCoinToPayStatus'](_0x525ef4),console[_0x8b09cf(0x29b)](_0x8b09cf(0x2f2)+_0x3c429a+'\x20('+_0x25031c+')'),console[_0x8b09cf(0x29b)](_0x8b09cf(0x27f)+_0x118515+_0x8b09cf(0x20d)+_0x3cfb8c),console[_0x8b09cf(0x29b)]('\x20\x20\x20📍\x20Source:\x20'+_0x228548),console[_0x8b09cf(0x29b)](_0x8b09cf(0x2f4)+_0x525ef4[_0x8b09cf(0x24a)]),_0xf4c59a&&console[_0x8b09cf(0x29b)](_0x8b09cf(0x2ba),_0xf4c59a);}[a38_0x35ffb4(0x2d8)](_0x45a8c9,_0x103884,_0x552f8a,_0x2def88,_0x16690e){const _0x4525d4=a38_0x35ffb4,_0x2ff574={'type':_0x4525d4(0x292),'paymentId':_0x45a8c9,'gatewayPaymentId':_0x103884,'error':_0x552f8a instanceof Error?{'message':_0x552f8a[_0x4525d4(0x1f4)],'stack':_0x552f8a[_0x4525d4(0x1e9)]}:_0x552f8a,'source':_0x2def88,'timestamp':new Date()[_0x4525d4(0x2dc)](),'context':_0x16690e||{}};loggerService_1[_0x4525d4(0x227)][_0x4525d4(0x2d8)](_0x2ff574),console[_0x4525d4(0x221)]('🪙\x20[ERROR]\x20CoinToPay\x20Error:\x20'+_0x45a8c9+'\x20('+_0x103884+')'),console[_0x4525d4(0x221)](_0x4525d4(0x1e6)+(_0x552f8a instanceof Error?_0x552f8a['message']:_0x552f8a)),console[_0x4525d4(0x221)](_0x4525d4(0x1fe)+_0x2def88),console['error'](_0x4525d4(0x2f4)+_0x2ff574[_0x4525d4(0x24a)]),_0x16690e&&console[_0x4525d4(0x221)](_0x4525d4(0x2f5),_0x16690e);}[a38_0x35ffb4(0x223)](){const _0xa92d2a=a38_0x35ffb4;console['log'](_0xa92d2a(0x2d5)),this['checkAllPendingPayments']()['catch'](_0xba0e0e=>{const _0x53a873=_0xa92d2a;console[_0x53a873(0x221)](_0x53a873(0x2a8),_0xba0e0e);}),this['globalCheckInterval']=setInterval(async()=>{const _0x5eee16=_0xa92d2a;try{console['log']('🪙\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...'),await this['checkAllPendingPayments'](),console[_0x5eee16(0x29b)](_0x5eee16(0x276));}catch(_0x268293){console['error'](_0x5eee16(0x289),_0x268293);}},this['GLOBAL_CHECK_INTERVAL_MS']),console[_0xa92d2a(0x29b)](_0xa92d2a(0x2ef));}[a38_0x35ffb4(0x2d3)](){const _0x408467=a38_0x35ffb4;console[_0x408467(0x29b)](_0x408467(0x25d));this['globalCheckInterval']&&(clearInterval(this[_0x408467(0x28d)]),this[_0x408467(0x28d)]=null,console[_0x408467(0x29b)](_0x408467(0x2d0)));const _0x4c9861=this[_0x408467(0x2a5)][_0x408467(0x253)];for(const [_0x4ff0d0]of this[_0x408467(0x2a5)]){this[_0x408467(0x22e)](_0x4ff0d0);}console['log'](_0x408467(0x2e7)+_0x4c9861+_0x408467(0x220));}async[a38_0x35ffb4(0x2bd)](){const _0xa67d98=a38_0x35ffb4;try{console['log']('🪙\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...');const _0x3e85bf=await database_1[_0xa67d98(0x28a)][_0xa67d98(0x29a)][_0xa67d98(0x1e3)]({'where':{'gateway':{'in':[_0xa67d98(0x2cf),'cointopay2']},'status':'PENDING','gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0xa67d98(0x29b)](_0xa67d98(0x2b6)+_0x3e85bf[_0xa67d98(0x2a7)]+_0xa67d98(0x242));if(_0x3e85bf[_0xa67d98(0x2a7)]===0x0){console[_0xa67d98(0x29b)]('🪙\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check');return;}const _0xc197b=await this[_0xa67d98(0x2e1)](_0x3e85bf);console['log'](_0xa67d98(0x230)+_0xc197b[_0xa67d98(0x2a7)]+_0xa67d98(0x266));let _0x3a2bad=0x0,_0x4bee6e=0x0;for(const _0x1242e4 of _0x3e85bf){try{if(_0xc197b[_0xa67d98(0x26c)](_0x1242e4['id'])){console[_0xa67d98(0x29b)](_0xa67d98(0x2b4)+_0x1242e4['id']+_0xa67d98(0x271)),_0x4bee6e++;continue;}if(this['paymentTimers'][_0xa67d98(0x28c)](_0x1242e4['id'])){console['log']('⏰\x20[GLOBAL]\x20Payment\x20'+_0x1242e4['id']+'\x20has\x20individual\x20timers,\x20skipping\x20global\x20check'),_0x4bee6e++;continue;}const _0x4b603b=(Date[_0xa67d98(0x1fc)]()-_0x1242e4['createdAt'][_0xa67d98(0x1e7)]())/(0x3e8*0x3c*0x3c);if(_0x4b603b<0x1){console['log'](_0xa67d98(0x2b4)+_0x1242e4['id']+_0xa67d98(0x204)+_0x4b603b[_0xa67d98(0x22f)](0x1)+_0xa67d98(0x273)),_0x4bee6e++;continue;}console[_0xa67d98(0x29b)]('🔍\x20[GLOBAL]\x20Checking\x20old\x20payment\x20'+_0x1242e4['id']+'\x20(age:\x20'+_0x4b603b['toFixed'](0x1)+'h)'),await this[_0xa67d98(0x1f1)](_0x1242e4),_0x3a2bad++,await new Promise(_0x15eb84=>setTimeout(_0x15eb84,0x7d0));}catch(_0x38dc84){console[_0xa67d98(0x221)](_0xa67d98(0x24e)+_0x1242e4['id']+':',_0x38dc84),this['logCoinToPayError'](_0x1242e4['id'],_0x1242e4[_0xa67d98(0x1fb)]||'unknown',_0x38dc84,'status_check',{'isGlobalCheck':!![],'paymentAmount':_0x1242e4[_0xa67d98(0x2b1)],'paymentCurrency':_0x1242e4['currency'],'shopId':_0x1242e4[_0xa67d98(0x231)],'createdAt':_0x1242e4[_0xa67d98(0x21d)]}),loggerService_1[_0xa67d98(0x227)]['logWhiteDomainError'](_0xa67d98(0x2cf),_0xa67d98(0x251)+_0x1242e4[_0xa67d98(0x1fb)],_0x38dc84);}}console[_0xa67d98(0x29b)](_0xa67d98(0x1e4)+_0x3a2bad+_0xa67d98(0x2a1)+_0x4bee6e+_0xa67d98(0x2c5)+_0xc197b[_0xa67d98(0x2a7)]+_0xa67d98(0x28b));}catch(_0x56650b){console[_0xa67d98(0x221)](_0xa67d98(0x262),_0x56650b);}}async[a38_0x35ffb4(0x2e1)](_0x1fd006){const _0x3503ea=a38_0x35ffb4,_0x5b0861=[],_0x4ff0c1=new Date();_0x4ff0c1['setDate'](_0x4ff0c1[_0x3503ea(0x27b)]()-this['EXPIRY_DAYS']),console[_0x3503ea(0x29b)]('⏰\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20'+this['EXPIRY_DAYS']+_0x3503ea(0x27e)+_0x4ff0c1[_0x3503ea(0x2dc)]()+')');for(const _0x3dc879 of _0x1fd006){if(_0x3dc879[_0x3503ea(0x21d)]<_0x4ff0c1){console[_0x3503ea(0x29b)]('⏰\x20[EXPIRY]\x20Payment\x20'+_0x3dc879['id']+'\x20is\x20older\x20than\x20'+this['EXPIRY_DAYS']+_0x3503ea(0x241));try{this[_0x3503ea(0x295)](_0x3dc879['id'],_0x3dc879[_0x3503ea(0x1fb)]||_0x3503ea(0x23d),_0x3503ea(0x2a0),'EXPIRED',_0x3503ea(0x216),{'reason':_0x3503ea(0x293)+this[_0x3503ea(0x1eb)]+_0x3503ea(0x239),'createdAt':_0x3dc879[_0x3503ea(0x21d)],'daysSinceCreation':Math[_0x3503ea(0x250)]((Date[_0x3503ea(0x1fc)]()-_0x3dc879[_0x3503ea(0x21d)]['getTime']())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x3dc879[_0x3503ea(0x2b1)],'paymentCurrency':_0x3dc879[_0x3503ea(0x279)],'shopId':_0x3dc879['shopId']}),await database_1[_0x3503ea(0x28a)][_0x3503ea(0x29a)][_0x3503ea(0x21c)]({'where':{'id':_0x3dc879['id']},'data':{'status':_0x3503ea(0x2aa),'updatedAt':new Date(),'adminNotes':_0x3503ea(0x234)+this[_0x3503ea(0x1eb)]+_0x3503ea(0x224)}}),await database_1['default'][_0x3503ea(0x2da)]['create']({'data':{'paymentId':_0x3dc879['id'],'shopId':_0x3dc879['shopId'],'event':_0x3503ea(0x2b0),'statusCode':0xc8,'responseBody':JSON[_0x3503ea(0x2e5)]({'reason':'Payment\x20older\x20than\x20'+this[_0x3503ea(0x1eb)]+_0x3503ea(0x239),'createdAt':_0x3dc879[_0x3503ea(0x21d)],'expiredAt':new Date()[_0x3503ea(0x2dc)](),'daysSinceCreation':Math[_0x3503ea(0x250)]((Date[_0x3503ea(0x1fc)]()-_0x3dc879[_0x3503ea(0x21d)][_0x3503ea(0x1e7)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this['sendShopWebhook'](_0x3dc879,_0x3503ea(0x2aa)),await this[_0x3503ea(0x1df)](_0x3dc879,_0x3503ea(0x2aa)),this[_0x3503ea(0x22e)](_0x3dc879['id']),_0x5b0861[_0x3503ea(0x2a4)](_0x3dc879['id']),console[_0x3503ea(0x29b)](_0x3503ea(0x2ec)+_0x3dc879['id']+_0x3503ea(0x23a)+this['EXPIRY_DAYS']+'-day\x20timeout');}catch(_0x2e7ec0){console[_0x3503ea(0x221)](_0x3503ea(0x2d9)+_0x3dc879['id']+':',_0x2e7ec0),this['logCoinToPayError'](_0x3dc879['id'],_0x3dc879['gatewayPaymentId']||_0x3503ea(0x23d),_0x2e7ec0,_0x3503ea(0x216),{'reason':_0x3503ea(0x1f6),'createdAt':_0x3dc879[_0x3503ea(0x21d)],'daysSinceCreation':Math[_0x3503ea(0x250)]((Date['now']()-_0x3dc879[_0x3503ea(0x21d)][_0x3503ea(0x1e7)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x5b0861;}async['checkSinglePayment'](_0x1f2ce0){const _0x2030e1=a38_0x35ffb4;if(!_0x1f2ce0['gatewayPaymentId']){console[_0x2030e1(0x29b)](_0x2030e1(0x29d)+_0x1f2ce0['id']+_0x2030e1(0x2c3));return;}console[_0x2030e1(0x29b)](_0x2030e1(0x2e3)+_0x1f2ce0[_0x2030e1(0x265)]+_0x2030e1(0x1db)+_0x1f2ce0['id']+'\x20('+_0x1f2ce0['gatewayPaymentId']+')');try{let _0x584b29;_0x1f2ce0[_0x2030e1(0x265)]===_0x2030e1(0x2b3)?(_0x584b29=await this[_0x2030e1(0x213)][_0x2030e1(0x2ca)](_0x1f2ce0[_0x2030e1(0x1fb)]),console[_0x2030e1(0x29b)](_0x2030e1(0x2bf)+_0x1f2ce0['id']+_0x2030e1(0x2eb)+_0x584b29[_0x2030e1(0x1e2)])):(_0x584b29=await this[_0x2030e1(0x24d)][_0x2030e1(0x2ca)](_0x1f2ce0['gatewayPaymentId']),console[_0x2030e1(0x29b)]('📊\x20[CHECK]\x20CoinToPay\x20payment\x20'+_0x1f2ce0['id']+_0x2030e1(0x2eb)+_0x584b29[_0x2030e1(0x1e2)]));_0x584b29[_0x2030e1(0x2a2)]&&console['log'](_0x2030e1(0x237)+_0x1f2ce0['id']+_0x2030e1(0x2e8),{'iban':_0x584b29['paymentDetails'][_0x2030e1(0x214)]||_0x2030e1(0x1f9),'transactionId':_0x584b29[_0x2030e1(0x2a2)][_0x2030e1(0x203)],'createdOn':_0x584b29[_0x2030e1(0x2a2)][_0x2030e1(0x25c)],'confirmedOn':_0x584b29['paymentDetails']['confirmedOn']||'not\x20confirmed'});if(_0x584b29['status']!==_0x1f2ce0[_0x2030e1(0x1e2)]){console['log'](_0x2030e1(0x248)+_0x1f2ce0['id']+_0x2030e1(0x2a6)+_0x1f2ce0[_0x2030e1(0x1e2)]+'\x20to\x20'+_0x584b29['status']),this[_0x2030e1(0x295)](_0x1f2ce0['id'],_0x1f2ce0['gatewayPaymentId'],_0x1f2ce0[_0x2030e1(0x1e2)],_0x584b29[_0x2030e1(0x1e2)],'status_check',{'paymentDetails':_0x584b29[_0x2030e1(0x2a2)],'amount':_0x584b29[_0x2030e1(0x2b1)],'currency':_0x584b29[_0x2030e1(0x279)],'shopId':_0x1f2ce0[_0x2030e1(0x231)],'checkTimestamp':new Date()[_0x2030e1(0x2dc)]()});const _0x5a972c={'status':_0x584b29[_0x2030e1(0x1e2)],'updatedAt':new Date()};if(_0x584b29[_0x2030e1(0x1e2)]===_0x2030e1(0x277)&&_0x1f2ce0['status']!==_0x2030e1(0x277)){_0x5a972c[_0x2030e1(0x2c6)]=new Date();if(!_0x1f2ce0[_0x2030e1(0x2d6)]){const _0x3a697e=await currencyService_1[_0x2030e1(0x275)][_0x2030e1(0x210)](_0x1f2ce0[_0x2030e1(0x2b1)],_0x1f2ce0[_0x2030e1(0x279)]);_0x5a972c[_0x2030e1(0x2d6)]=_0x3a697e;const _0x4064b6=await this[_0x2030e1(0x255)](_0x1f2ce0[_0x2030e1(0x231)],_0x1f2ce0[_0x2030e1(0x265)]),_0x2ccb72=_0x3a697e*(0x1-_0x4064b6/0x64);_0x5a972c[_0x2030e1(0x2bc)]=_0x2ccb72,console['log'](_0x2030e1(0x260)+_0x1f2ce0['id']+_0x2030e1(0x23e)),console[_0x2030e1(0x29b)](_0x2030e1(0x21e)+_0x1f2ce0['amount']+'\x20'+_0x1f2ce0[_0x2030e1(0x279)]+_0x2030e1(0x20d)+_0x3a697e[_0x2030e1(0x22f)](0x6)+_0x2030e1(0x218)),console[_0x2030e1(0x29b)](_0x2030e1(0x2b2)+_0x1f2ce0[_0x2030e1(0x265)]+_0x2030e1(0x244)+_0x4064b6+'%'),console[_0x2030e1(0x29b)](_0x2030e1(0x269)+_0x2ccb72['toFixed'](0x6)+_0x2030e1(0x218));}console[_0x2030e1(0x29b)](_0x2030e1(0x260)+_0x1f2ce0['id']+_0x2030e1(0x2d7)+_0x5a972c[_0x2030e1(0x2c6)]['toISOString']());}if(_0x584b29[_0x2030e1(0x2a2)]){const _0x3442e8=_0x584b29[_0x2030e1(0x2a2)];_0x3442e8[_0x2030e1(0x214)]&&(_0x5a972c[_0x2030e1(0x2e0)]=_0x3442e8[_0x2030e1(0x214)],console['log'](_0x2030e1(0x1da)+_0x3442e8[_0x2030e1(0x214)]));if(_0x3442e8[_0x2030e1(0x23f)]){const _0x3a2706=_0x1f2ce0[_0x2030e1(0x1e0)]||'',_0x43f542=_0x2030e1(0x2c0)+_0x3442e8['bankDetails'];_0x5a972c[_0x2030e1(0x1e0)]=_0x3a2706?_0x3a2706+'\x0a\x0a'+_0x43f542:_0x43f542,console[_0x2030e1(0x29b)](_0x2030e1(0x1de));}_0x3442e8[_0x2030e1(0x203)]&&console[_0x2030e1(0x29b)](_0x2030e1(0x20b)+_0x3442e8['transactionId']),_0x3442e8['confirmedOn']&&console[_0x2030e1(0x29b)](_0x2030e1(0x2c2)+_0x3442e8[_0x2030e1(0x1ee)]);}await database_1[_0x2030e1(0x28a)][_0x2030e1(0x29a)][_0x2030e1(0x21c)]({'where':{'id':_0x1f2ce0['id']},'data':_0x5a972c});if(_0x584b29[_0x2030e1(0x1e2)]===_0x2030e1(0x277)&&_0x1f2ce0[_0x2030e1(0x1e2)]!==_0x2030e1(0x277)){console['log']('📈\x20[COINTOPAY]\x20Payment\x20'+_0x1f2ce0['id']+'\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link');const _0xd0e2b0=await database_1['default'][_0x2030e1(0x29a)]['findUnique']({'where':{'id':_0x1f2ce0['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0xd0e2b0?.['paymentLinkId']&&_0xd0e2b0['paymentLink'])try{const _0x1c122b=_0xd0e2b0[_0x2030e1(0x258)];console[_0x2030e1(0x29b)](_0x2030e1(0x2ac)+_0x1c122b['id']+_0x2030e1(0x1e1)+_0x1c122b['type']+_0x2030e1(0x299)+_0x1c122b[_0x2030e1(0x2ab)]+_0x2030e1(0x286)+_0x1c122b[_0x2030e1(0x1e2)]);const _0x11560b=_0x1c122b[_0x2030e1(0x2ab)]+0x1,_0x18fa45=_0x1c122b[_0x2030e1(0x205)]===_0x2030e1(0x2ed)?_0x2030e1(0x1f2):_0x1c122b[_0x2030e1(0x1e2)];await database_1[_0x2030e1(0x28a)][_0x2030e1(0x258)][_0x2030e1(0x21c)]({'where':{'id':_0x1c122b['id']},'data':{'currentPayments':_0x11560b,'status':_0x18fa45,'updatedAt':new Date()}}),console['log'](_0x2030e1(0x228)+_0x1c122b['id']+_0x2030e1(0x288)+_0x1c122b['currentPayments']+_0x2030e1(0x20d)+_0x11560b+_0x2030e1(0x286)+_0x1c122b[_0x2030e1(0x1e2)]+_0x2030e1(0x20d)+_0x18fa45);}catch(_0x27d182){console[_0x2030e1(0x221)](_0x2030e1(0x26a),_0x27d182);}else console[_0x2030e1(0x29b)](_0x2030e1(0x1ef)+_0x1f2ce0['id']+_0x2030e1(0x2a9));}await database_1[_0x2030e1(0x28a)][_0x2030e1(0x2da)][_0x2030e1(0x2ee)]({'data':{'paymentId':_0x1f2ce0['id'],'shopId':_0x1f2ce0[_0x2030e1(0x231)],'event':'cointopay_status_check_'+_0x584b29['status'][_0x2030e1(0x25b)](),'statusCode':0xc8,'responseBody':JSON[_0x2030e1(0x2e5)]({'oldStatus':_0x1f2ce0['status'],'newStatus':_0x584b29[_0x2030e1(0x1e2)],'paymentDetails':_0x584b29[_0x2030e1(0x2a2)],'checkedAt':new Date()['toISOString']()})}}),await this[_0x2030e1(0x27a)](_0x1f2ce0,_0x584b29[_0x2030e1(0x1e2)]),await this[_0x2030e1(0x1df)](_0x1f2ce0,_0x584b29['status']),_0x584b29['status']!=='PENDING'&&(console[_0x2030e1(0x29b)](_0x2030e1(0x270)+_0x1f2ce0['id']+_0x2030e1(0x215)+_0x584b29['status']+_0x2030e1(0x1d9)),this[_0x2030e1(0x22e)](_0x1f2ce0['id'])),console[_0x2030e1(0x29b)]('✅\x20[CHECK]\x20Payment\x20'+_0x1f2ce0['id']+'\x20updated\x20successfully');}else console[_0x2030e1(0x29b)](_0x2030e1(0x237)+_0x1f2ce0['id']+_0x2030e1(0x2e6)+_0x584b29['status']+')'),this[_0x2030e1(0x295)](_0x1f2ce0['id'],_0x1f2ce0['gatewayPaymentId'],_0x1f2ce0[_0x2030e1(0x1e2)],_0x584b29[_0x2030e1(0x1e2)],_0x2030e1(0x20a),{'statusUnchanged':!![],'paymentDetails':_0x584b29['paymentDetails'],'amount':_0x584b29['amount'],'currency':_0x584b29[_0x2030e1(0x279)],'shopId':_0x1f2ce0[_0x2030e1(0x231)],'checkTimestamp':new Date()[_0x2030e1(0x2dc)]()});}catch(_0x4f61b5){console[_0x2030e1(0x221)](_0x2030e1(0x29c)+_0x1f2ce0['id']+':',_0x4f61b5),this[_0x2030e1(0x2d8)](_0x1f2ce0['id'],_0x1f2ce0[_0x2030e1(0x1fb)],_0x4f61b5,'status_check',{'paymentAmount':_0x1f2ce0[_0x2030e1(0x2b1)],'paymentCurrency':_0x1f2ce0[_0x2030e1(0x279)],'shopId':_0x1f2ce0[_0x2030e1(0x231)],'createdAt':_0x1f2ce0[_0x2030e1(0x21d)]}),await database_1[_0x2030e1(0x28a)]['webhookLog'][_0x2030e1(0x2ee)]({'data':{'paymentId':_0x1f2ce0['id'],'shopId':_0x1f2ce0[_0x2030e1(0x231)],'event':_0x2030e1(0x267),'statusCode':0x1f4,'responseBody':JSON['stringify']({'error':_0x4f61b5 instanceof Error?_0x4f61b5[_0x2030e1(0x1f4)]:_0x2030e1(0x263),'gatewayPaymentId':_0x1f2ce0[_0x2030e1(0x1fb)],'checkedAt':new Date()[_0x2030e1(0x2dc)]()})}});}}async[a38_0x35ffb4(0x27a)](_0x418eef,_0x2221c9){const _0x5eea6e=a38_0x35ffb4,_0x4dce4a=Date['now']();try{const _0x72c7c=_0x418eef[_0x5eea6e(0x24c)],_0x27a5ec=_0x72c7c['settings'];if(!_0x27a5ec?.[_0x5eea6e(0x294)]){console[_0x5eea6e(0x29b)](_0x5eea6e(0x28e)+_0x72c7c['id']);return;}const _0x503b92=_0x2221c9==='PAID'?_0x5eea6e(0x2c1):_0x2221c9===_0x5eea6e(0x284)?_0x5eea6e(0x20f):_0x2221c9===_0x5eea6e(0x2aa)?_0x5eea6e(0x20f):_0x5eea6e(0x247);if(!_0x27a5ec['webhookEvents']?.['includes'](_0x503b92)){console[_0x5eea6e(0x29b)](_0x5eea6e(0x26e)+_0x503b92+_0x5eea6e(0x243)+_0x72c7c['id']);return;}const _0xe6dd71=(0x0,gateway_1['getGatewayIdByName'])(_0x418eef[_0x5eea6e(0x265)])||_0x418eef[_0x5eea6e(0x265)],_0x3ae496={'event':_0x503b92,'payment':{'id':_0x418eef['id'],'order_id':_0x418eef[_0x5eea6e(0x264)],'gateway_order_id':_0x418eef['gatewayOrderId'],'gateway':_0xe6dd71,'amount':_0x418eef[_0x5eea6e(0x2b1)],'currency':_0x418eef[_0x5eea6e(0x279)],'status':_0x2221c9[_0x5eea6e(0x25b)](),'customer_email':_0x418eef[_0x5eea6e(0x285)],'customer_name':_0x418eef[_0x5eea6e(0x238)],'created_at':_0x418eef[_0x5eea6e(0x21d)],'updated_at':new Date()}},_0x2c2903=await fetch(_0x27a5ec[_0x5eea6e(0x294)],{'method':'POST','headers':{'Content-Type':_0x5eea6e(0x22d),'User-Agent':_0x5eea6e(0x283)},'body':JSON[_0x5eea6e(0x2e5)](_0x3ae496)}),_0x1b4006=Date[_0x5eea6e(0x1fc)]()-_0x4dce4a,_0xfcec7d=_0x2c2903['ok']?_0x5eea6e(0x25e):await _0x2c2903[_0x5eea6e(0x233)]();loggerService_1[_0x5eea6e(0x227)][_0x5eea6e(0x2a3)](_0x418eef[_0x5eea6e(0x231)],_0x27a5ec[_0x5eea6e(0x294)],_0x503b92,_0x2c2903[_0x5eea6e(0x1e2)],_0x1b4006,_0x3ae496),console[_0x5eea6e(0x29b)](_0x5eea6e(0x219)+_0x27a5ec['webhookUrl']+'\x20with\x20status\x20'+_0x2c2903['status']+'\x20('+_0x1b4006+_0x5eea6e(0x22a));}catch(_0x909be5){console[_0x5eea6e(0x221)](_0x5eea6e(0x240),_0x909be5),loggerService_1[_0x5eea6e(0x227)][_0x5eea6e(0x257)](_0x418eef[_0x5eea6e(0x231)],_0x418eef[_0x5eea6e(0x24c)]?.[_0x5eea6e(0x2c8)]?.[_0x5eea6e(0x294)]||_0x5eea6e(0x23d),_0x5eea6e(0x298),_0x909be5,{});}}async[a38_0x35ffb4(0x1df)](_0x5940b3,_0x3a32ed){const _0x26d920=a38_0x35ffb4;try{const _0x46eabd={'PENDING':_0x26d920(0x202),'PAID':_0x26d920(0x2af),'FAILED':_0x26d920(0x232),'EXPIRED':_0x26d920(0x278)},_0xa74ae3=_0x46eabd[_0x3a32ed];if(!_0xa74ae3||_0xa74ae3===_0x26d920(0x202))return;await telegramBotService_1[_0x26d920(0x1ff)][_0x26d920(0x2b9)](_0x5940b3['shopId'],_0x5940b3,_0xa74ae3);}catch(_0x1ca4f4){console[_0x26d920(0x221)](_0x26d920(0x1f0),_0x1ca4f4);}}async['checkPaymentById'](_0x55cfa9){const _0x3e5297=a38_0x35ffb4;console[_0x3e5297(0x29b)](_0x3e5297(0x291)+_0x55cfa9);const _0x78d26f=await database_1[_0x3e5297(0x28a)][_0x3e5297(0x29a)][_0x3e5297(0x1f5)]({'where':{'id':_0x55cfa9},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x78d26f)throw new Error(_0x3e5297(0x217));if(_0x78d26f[_0x3e5297(0x265)]!=='cointopay'&&_0x78d26f[_0x3e5297(0x265)]!=='cointopay2')throw new Error(_0x3e5297(0x2de));console[_0x3e5297(0x29b)](_0x3e5297(0x268)+_0x78d26f['gateway']+_0x3e5297(0x1db)+_0x55cfa9),await this[_0x3e5297(0x1f1)](_0x78d26f),console[_0x3e5297(0x29b)]('✅\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20'+_0x55cfa9);}[a38_0x35ffb4(0x21f)](){const _0x88b75a=a38_0x35ffb4,_0x1a1e7b=this['globalCheckInterval']?this[_0x88b75a(0x28f)]:undefined,_0x142d91=Array[_0x88b75a(0x1e5)](this[_0x88b75a(0x2a5)]['values']())['map'](_0x11ffcf=>({'paymentId':_0x11ffcf['paymentId'],'gatewayPaymentId':_0x11ffcf[_0x88b75a(0x1fb)],'createdAt':_0x11ffcf[_0x88b75a(0x21d)],'timersCount':_0x11ffcf[_0x88b75a(0x245)][_0x88b75a(0x2a7)]}));return{'isActive':!!this['globalCheckInterval'],'globalCheckIntervalMinutes':this[_0x88b75a(0x28f)]/(0x3e8*0x3c),'expiryDays':this[_0x88b75a(0x1eb)],'activeIndividualTimers':this['paymentTimers'][_0x88b75a(0x253)],'nextGlobalCheckIn':_0x1a1e7b,'paymentTimersDetails':_0x142d91};}[a38_0x35ffb4(0x2e4)](_0xafdd1e){const _0x5c8016=a38_0x35ffb4,_0x46cc56=this[_0x5c8016(0x2a5)]['get'](_0xafdd1e);if(_0x46cc56)return{'hasTimers':!![],'timersCount':_0x46cc56[_0x5c8016(0x245)][_0x5c8016(0x2a7)],'createdAt':_0x46cc56[_0x5c8016(0x21d)],'gatewayPaymentId':_0x46cc56[_0x5c8016(0x1fb)]};return{'hasTimers':![]};}async['getGatewayCommission'](_0x16b310,_0x7b0b25){const _0x5b2a45=a38_0x35ffb4;try{const _0x439ced=await database_1[_0x5b2a45(0x28a)]['shop'][_0x5b2a45(0x1f5)]({'where':{'id':_0x16b310},'select':{'gatewaySettings':!![]}});if(!_0x439ced?.[_0x5b2a45(0x1dc)])return console[_0x5b2a45(0x29b)](_0x5b2a45(0x222)+_0x16b310+_0x5b2a45(0x246)),0xa;const _0x107215=JSON[_0x5b2a45(0x1f3)](_0x439ced[_0x5b2a45(0x1dc)]);for(const [_0x5d05cf,_0x22ed09]of Object['entries'](_0x107215)){if(_0x5d05cf['toLowerCase']()===_0x7b0b25[_0x5b2a45(0x25b)]()){const _0x45e9a4=_0x22ed09['commission']||0xa;return console['log'](_0x5b2a45(0x20e)+_0x7b0b25+_0x5b2a45(0x2e9)+_0x16b310+':\x20'+_0x45e9a4+'%'),_0x45e9a4;}}return console[_0x5b2a45(0x29b)](_0x5b2a45(0x27c)+_0x7b0b25+'\x20in\x20shop\x20'+_0x16b310+',\x20using\x20default\x2010%'),0xa;}catch(_0x2faf7d){return console[_0x5b2a45(0x221)](_0x5b2a45(0x1e8)+_0x16b310+_0x5b2a45(0x1fd)+_0x7b0b25+':',_0x2faf7d),0xa;}}}exports[a38_0x35ffb4(0x2dd)]=CoinToPayStatusService,exports[a38_0x35ffb4(0x2c9)]=new CoinToPayStatusService();