'use strict';function a38_0x33ea(_0xb1da01,_0x476078){const _0xe6ac23=a38_0xe6ac();return a38_0x33ea=function(_0x33eabd,_0x2bc02a){_0x33eabd=_0x33eabd-0x80;let _0x3fd521=_0xe6ac23[_0x33eabd];return _0x3fd521;},a38_0x33ea(_0xb1da01,_0x476078);}const a38_0x33a10e=a38_0x33ea;(function(_0x5695e2,_0x1dae8b){const _0x3de007=a38_0x33ea,_0x201ec2=_0x5695e2();while(!![]){try{const _0x4572dc=-parseInt(_0x3de007(0x87))/0x1*(parseInt(_0x3de007(0x80))/0x2)+parseInt(_0x3de007(0x13c))/0x3+-parseInt(_0x3de007(0x11d))/0x4*(parseInt(_0x3de007(0xf2))/0x5)+-parseInt(_0x3de007(0x17a))/0x6+parseInt(_0x3de007(0xa0))/0x7+parseInt(_0x3de007(0x85))/0x8+-parseInt(_0x3de007(0xd4))/0x9*(-parseInt(_0x3de007(0x86))/0xa);if(_0x4572dc===_0x1dae8b)break;else _0x201ec2['push'](_0x201ec2['shift']());}catch(_0x5e7b62){_0x201ec2['push'](_0x201ec2['shift']());}}}(a38_0xe6ac,0xd2310));var __importDefault=this&&this[a38_0x33a10e(0x10d)]||function(_0x1112be){return _0x1112be&&_0x1112be['__esModule']?_0x1112be:{'default':_0x1112be};};Object[a38_0x33a10e(0x119)](exports,a38_0x33a10e(0x9f),{'value':!![]}),exports[a38_0x33a10e(0x14d)]=exports[a38_0x33a10e(0x98)]=void 0x0;const coinToPayService_1=require(a38_0x33a10e(0xaf)),coinToPay2Service_1=require(a38_0x33a10e(0xc4)),gateway_1=require(a38_0x33a10e(0x112)),database_1=__importDefault(require('../config/database')),telegramBotService_1=require(a38_0x33a10e(0x115)),loggerService_1=require('./loggerService'),currencyService_1=require(a38_0x33a10e(0x15a));class CoinToPayStatusService{constructor(){const _0x333381=a38_0x33a10e;this[_0x333381(0x162)]=null,this['GLOBAL_CHECK_INTERVAL_MS']=0x3c*0x3c*0x3e8,this[_0x333381(0xa6)]=0x5,this[_0x333381(0x10e)]=new Map(),this['coinToPayService']=new coinToPayService_1[(_0x333381(0x116))](),this['coinToPay2Service']=new coinToPay2Service_1['CoinToPay2Service'](),console[_0x333381(0x8c)](_0x333381(0x130));}[a38_0x33a10e(0xbe)](_0x155652,_0x465812){const _0x8f03dd=a38_0x33a10e;console[_0x8f03dd(0x8c)](_0x8f03dd(0x10a)),console[_0x8f03dd(0x8c)](_0x8f03dd(0x149)+_0x155652),console[_0x8f03dd(0x8c)](_0x8f03dd(0x169)+_0x465812),this[_0x8f03dd(0x81)](_0x155652);const _0x5d6f3b=[],_0xa24657=new Date(),_0x2ac4dd=[{'delay':0x1*0x3c*0x3e8,'description':_0x8f03dd(0x16c)},{'delay':0x2*0x3c*0x3e8,'description':_0x8f03dd(0xed)},{'delay':0x5*0x3c*0x3e8,'description':_0x8f03dd(0x99)},{'delay':0x5*0x3c*0x3e8,'description':_0x8f03dd(0x99)}];console[_0x8f03dd(0x8c)](_0x8f03dd(0xa2)+_0x2ac4dd[_0x8f03dd(0xb6)]+_0x8f03dd(0x9c)+_0x155652);let _0x40d81b=0x0;_0x2ac4dd[_0x8f03dd(0x123)]((_0x18e4e6,_0x2e1ac8)=>{const _0x345337=_0x8f03dd;_0x40d81b+=_0x18e4e6[_0x345337(0x12f)];const _0x45982e=setTimeout(async()=>{const _0x24d3d5=_0x345337;console[_0x24d3d5(0x8c)](_0x24d3d5(0x13d)+(_0x2e1ac8+0x1)+_0x24d3d5(0x173)+_0x155652+'\x20(after\x20'+_0x18e4e6[_0x24d3d5(0x103)]+')');try{await this['checkSinglePaymentById'](_0x155652),console[_0x24d3d5(0x8c)](_0x24d3d5(0x8d)+(_0x2e1ac8+0x1)+_0x24d3d5(0x19b)+_0x155652);}catch(_0x8a8485){console[_0x24d3d5(0x122)](_0x24d3d5(0xb8)+(_0x2e1ac8+0x1)+_0x24d3d5(0x100)+_0x155652+':',_0x8a8485),this[_0x24d3d5(0xa3)](_0x155652,_0x465812,_0x8a8485,_0x24d3d5(0xf5),{'checkNumber':_0x2e1ac8+0x1,'scheduledAfter':_0x18e4e6[_0x24d3d5(0x103)],'isIndividualCheck':!![]});}},_0x40d81b);_0x5d6f3b[_0x345337(0xb3)](_0x45982e),console[_0x345337(0x8c)](_0x345337(0x8e)+(_0x2e1ac8+0x1)+'\x20for\x20payment\x20'+_0x155652+'\x20in\x20'+_0x40d81b/0x3e8+'\x20seconds\x20('+_0x18e4e6[_0x345337(0x103)]+')');});const _0x3f33a7=setInterval(async()=>{const _0x404ab3=_0x8f03dd;console[_0x404ab3(0x8c)](_0x404ab3(0x10c)+_0x155652);try{const _0x46941c=await database_1[_0x404ab3(0xe5)][_0x404ab3(0x14f)][_0x404ab3(0x155)]({'where':{'id':_0x155652},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x46941c){console[_0x404ab3(0x8c)](_0x404ab3(0x93)+_0x155652+_0x404ab3(0xd7)),this[_0x404ab3(0x81)](_0x155652);return;}console[_0x404ab3(0x8c)]('📊\x20[HOURLY]\x20Payment\x20'+_0x155652+_0x404ab3(0x141)+_0x46941c[_0x404ab3(0xc7)]);if(_0x46941c['status']!==_0x404ab3(0x84)){console['log'](_0x404ab3(0xff)+_0x155652+_0x404ab3(0x138)+_0x46941c[_0x404ab3(0xc7)]+_0x404ab3(0x187)),this[_0x404ab3(0x81)](_0x155652);return;}const _0x38fbd5=Math[_0x404ab3(0x132)]((Date[_0x404ab3(0x15d)]()-_0x46941c[_0x404ab3(0x157)][_0x404ab3(0x109)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x38fbd5>=this[_0x404ab3(0xa6)]){console[_0x404ab3(0x8c)](_0x404ab3(0x199)+_0x155652+_0x404ab3(0x182)+this[_0x404ab3(0xa6)]+_0x404ab3(0x135)),this['clearPaymentTimers'](_0x155652);return;}await this[_0x404ab3(0xae)](_0x155652),console[_0x404ab3(0x8c)](_0x404ab3(0xde)+_0x155652);}catch(_0x1fa124){console[_0x404ab3(0x122)](_0x404ab3(0x183)+_0x155652+':',_0x1fa124),this[_0x404ab3(0xa3)](_0x155652,_0x465812,_0x1fa124,'status_check',{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x5d6f3b[_0x8f03dd(0xb3)](_0x3f33a7),this[_0x8f03dd(0x10e)]['set'](_0x155652,{'timers':_0x5d6f3b,'paymentId':_0x155652,'gatewayPaymentId':_0x465812,'createdAt':_0xa24657}),console['log'](_0x8f03dd(0xcc)+_0x2ac4dd['length']+_0x8f03dd(0xe9)+_0x155652),console[_0x8f03dd(0x8c)](_0x8f03dd(0x1a4)+this['paymentTimers'][_0x8f03dd(0xf1)]),this[_0x8f03dd(0x104)](_0x155652,_0x465812,'PENDING',_0x8f03dd(0x84),_0x8f03dd(0xf5),{'action':_0x8f03dd(0xc5),'scheduledChecks':_0x2ac4dd[_0x8f03dd(0xb6)],'firstCheckIn':_0x2ac4dd[0x0][_0x8f03dd(0x12f)]/0x3e8,'totalTimers':this[_0x8f03dd(0x10e)][_0x8f03dd(0xf1)]});}[a38_0x33a10e(0x81)](_0x93ca90){const _0x32d7be=a38_0x33a10e,_0x3602b7=this['paymentTimers']['get'](_0x93ca90);_0x3602b7?(console[_0x32d7be(0x8c)](_0x32d7be(0x175)+_0x3602b7[_0x32d7be(0x9b)][_0x32d7be(0xb6)]+_0x32d7be(0x126)+_0x93ca90),_0x3602b7['timers'][_0x32d7be(0x123)]((_0x294c47,_0xd4bd9b)=>{const _0x41df08=_0x32d7be;_0x294c47&&(clearTimeout(_0x294c47),clearInterval(_0x294c47),console[_0x41df08(0x8c)](_0x41df08(0x128)+(_0xd4bd9b+0x1)+_0x41df08(0x100)+_0x93ca90));}),this['paymentTimers'][_0x32d7be(0xf4)](_0x93ca90),console['log']('✅\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20'+_0x93ca90+_0x32d7be(0x105)+this['paymentTimers'][_0x32d7be(0xf1)])):console['log'](_0x32d7be(0xb4)+_0x93ca90+_0x32d7be(0x154));}async[a38_0x33a10e(0xae)](_0xdddfbe){const _0x2c0faf=a38_0x33a10e;console[_0x2c0faf(0x8c)]('🔍\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20'+_0xdddfbe);const _0x565660=await database_1['default'][_0x2c0faf(0x14f)][_0x2c0faf(0x155)]({'where':{'id':_0xdddfbe},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x565660){console['log'](_0x2c0faf(0x139)+_0xdddfbe+_0x2c0faf(0x82));return;}console['log'](_0x2c0faf(0x107)+_0xdddfbe+_0x2c0faf(0x164)),console[_0x2c0faf(0x8c)](_0x2c0faf(0x18b)+_0x565660[_0x2c0faf(0x11a)]),console[_0x2c0faf(0x8c)](_0x2c0faf(0xba)+_0x565660[_0x2c0faf(0xc7)]),console[_0x2c0faf(0x8c)]('\x20\x20\x20-\x20GatewayPaymentId:\x20'+_0x565660[_0x2c0faf(0x131)]),console['log'](_0x2c0faf(0x90)+_0x565660[_0x2c0faf(0x190)]+'\x20'+_0x565660['currency']),console[_0x2c0faf(0x8c)](_0x2c0faf(0xf6)+_0x565660[_0x2c0faf(0xb1)]);if(_0x565660[_0x2c0faf(0x11a)]!==_0x2c0faf(0x168)&&_0x565660[_0x2c0faf(0x11a)]!==_0x2c0faf(0x14a)){console[_0x2c0faf(0x8c)]('⚠️\x20[CHECK]\x20Payment\x20'+_0xdddfbe+_0x2c0faf(0x13a)+_0x565660[_0x2c0faf(0x11a)]+')');return;}if(_0x565660[_0x2c0faf(0xc7)]!==_0x2c0faf(0x84)){console[_0x2c0faf(0x8c)]('⚠️\x20[CHECK]\x20Payment\x20'+_0xdddfbe+'\x20status\x20is\x20'+_0x565660[_0x2c0faf(0xc7)]+_0x2c0faf(0x187)),this[_0x2c0faf(0x81)](_0xdddfbe);return;}if(!_0x565660['gatewayPaymentId']){console[_0x2c0faf(0x8c)]('⚠️\x20[CHECK]\x20Payment\x20'+_0xdddfbe+_0x2c0faf(0xc1));return;}console[_0x2c0faf(0x8c)](_0x2c0faf(0x161)+_0xdddfbe+_0x2c0faf(0x15e)),await this[_0x2c0faf(0xe6)](_0x565660);}[a38_0x33a10e(0x104)](_0x164f63,_0x35790c,_0x4da84e,_0x85648c,_0x5f3086,_0x1498d1){const _0x39d15b=a38_0x33a10e,_0x5d9764={'type':_0x39d15b(0x181),'paymentId':_0x164f63,'gatewayPaymentId':_0x35790c,'oldStatus':_0x4da84e,'newStatus':_0x85648c,'source':_0x5f3086,'timestamp':new Date()[_0x39d15b(0xf7)](),'details':_0x1498d1||{}};loggerService_1['loggerService'][_0x39d15b(0x104)](_0x5d9764),console[_0x39d15b(0x8c)](_0x39d15b(0xa1)+_0x164f63+'\x20('+_0x35790c+')'),console['log'](_0x39d15b(0xfe)+_0x4da84e+_0x39d15b(0xfc)+_0x85648c),console['log'](_0x39d15b(0x9a)+_0x5f3086),console[_0x39d15b(0x8c)](_0x39d15b(0x17f)+_0x5d9764[_0x39d15b(0xea)]),_0x1498d1&&console[_0x39d15b(0x8c)](_0x39d15b(0x165),_0x1498d1);}[a38_0x33a10e(0xa3)](_0x1b6173,_0x163336,_0x2d644c,_0x547ca3,_0x565eef){const _0x382545=a38_0x33a10e,_0x1f8c51={'type':_0x382545(0x176),'paymentId':_0x1b6173,'gatewayPaymentId':_0x163336,'error':_0x2d644c instanceof Error?{'message':_0x2d644c[_0x382545(0xab)],'stack':_0x2d644c[_0x382545(0x129)]}:_0x2d644c,'source':_0x547ca3,'timestamp':new Date()[_0x382545(0xf7)](),'context':_0x565eef||{}};loggerService_1[_0x382545(0x197)][_0x382545(0xa3)](_0x1f8c51),console[_0x382545(0x122)](_0x382545(0x19d)+_0x1b6173+'\x20('+_0x163336+')'),console[_0x382545(0x122)](_0x382545(0x117)+(_0x2d644c instanceof Error?_0x2d644c[_0x382545(0xab)]:_0x2d644c)),console['error']('\x20\x20\x20📍\x20Source:\x20'+_0x547ca3),console[_0x382545(0x122)](_0x382545(0x17f)+_0x1f8c51[_0x382545(0xea)]),_0x565eef&&console[_0x382545(0x122)](_0x382545(0xfd),_0x565eef);}[a38_0x33a10e(0x177)](){const _0x454478=a38_0x33a10e;console[_0x454478(0x8c)]('🪙\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)'),this[_0x454478(0xdd)]()[_0x454478(0xb0)](_0x5e47d5=>{const _0x429483=_0x454478;console[_0x429483(0x122)](_0x429483(0x102),_0x5e47d5);}),this['globalCheckInterval']=setInterval(async()=>{const _0x51f14f=_0x454478;try{console['log'](_0x51f14f(0xd6)),await this[_0x51f14f(0xdd)](),console['log'](_0x51f14f(0x14b));}catch(_0x34251a){console[_0x51f14f(0x122)](_0x51f14f(0xd3),_0x34251a);}},this[_0x454478(0x151)]),console[_0x454478(0x8c)](_0x454478(0x1a2));}[a38_0x33a10e(0x12c)](){const _0x1dfd60=a38_0x33a10e;console[_0x1dfd60(0x8c)]('🛑\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...');this[_0x1dfd60(0x162)]&&(clearInterval(this[_0x1dfd60(0x162)]),this[_0x1dfd60(0x162)]=null,console[_0x1dfd60(0x8c)](_0x1dfd60(0xc9)));const _0x48a77c=this['paymentTimers'][_0x1dfd60(0xf1)];for(const [_0xebceb6]of this[_0x1dfd60(0x10e)]){this[_0x1dfd60(0x81)](_0xebceb6);}console['log'](_0x1dfd60(0x147)+_0x48a77c+_0x1dfd60(0x156));}async[a38_0x33a10e(0xdd)](){const _0x210650=a38_0x33a10e;try{console[_0x210650(0x8c)](_0x210650(0x113));const _0x27dec8=await database_1[_0x210650(0xe5)]['payment'][_0x210650(0xbd)]({'where':{'gateway':{'in':[_0x210650(0x168),_0x210650(0x14a)]},'status':_0x210650(0x84),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x210650(0x8c)](_0x210650(0xc3)+_0x27dec8[_0x210650(0xb6)]+_0x210650(0x19f));if(_0x27dec8[_0x210650(0xb6)]===0x0){console[_0x210650(0x8c)](_0x210650(0x101));return;}const _0x3f1e20=await this[_0x210650(0xc2)](_0x27dec8);console[_0x210650(0x8c)](_0x210650(0x146)+_0x3f1e20[_0x210650(0xb6)]+_0x210650(0x189));let _0x1b4baa=0x0,_0x137c55=0x0;for(const _0x2aa592 of _0x27dec8){try{if(_0x3f1e20[_0x210650(0xd9)](_0x2aa592['id'])){console[_0x210650(0x8c)](_0x210650(0xb5)+_0x2aa592['id']+_0x210650(0x11b)),_0x137c55++;continue;}if(this[_0x210650(0x10e)][_0x210650(0x9d)](_0x2aa592['id'])){console[_0x210650(0x8c)]('⏰\x20[GLOBAL]\x20Payment\x20'+_0x2aa592['id']+_0x210650(0x17b)),_0x137c55++;continue;}const _0x3f9a9a=(Date[_0x210650(0x15d)]()-_0x2aa592[_0x210650(0x157)][_0x210650(0x109)]())/(0x3e8*0x3c*0x3c);if(_0x3f9a9a<0x1){console[_0x210650(0x8c)](_0x210650(0xb5)+_0x2aa592['id']+'\x20is\x20too\x20new\x20('+_0x3f9a9a[_0x210650(0x16b)](0x1)+_0x210650(0x15c)),_0x137c55++;continue;}console[_0x210650(0x8c)]('🔍\x20[GLOBAL]\x20Checking\x20old\x20payment\x20'+_0x2aa592['id']+_0x210650(0x193)+_0x3f9a9a[_0x210650(0x16b)](0x1)+'h)'),await this[_0x210650(0xe6)](_0x2aa592),_0x1b4baa++,await new Promise(_0x277597=>setTimeout(_0x277597,0x7d0));}catch(_0x44aa9b){console['error'](_0x210650(0x159)+_0x2aa592['id']+':',_0x44aa9b),this[_0x210650(0xa3)](_0x2aa592['id'],_0x2aa592[_0x210650(0x131)]||_0x210650(0x12a),_0x44aa9b,'status_check',{'isGlobalCheck':!![],'paymentAmount':_0x2aa592[_0x210650(0x190)],'paymentCurrency':_0x2aa592[_0x210650(0xad)],'shopId':_0x2aa592[_0x210650(0xb1)],'createdAt':_0x2aa592[_0x210650(0x157)]}),loggerService_1['loggerService']['logWhiteDomainError']('cointopay',_0x210650(0x136)+_0x2aa592[_0x210650(0x131)],_0x44aa9b);}}console[_0x210650(0x8c)](_0x210650(0xdb)+_0x1b4baa+_0x210650(0x19c)+_0x137c55+_0x210650(0xf8)+_0x3f1e20[_0x210650(0xb6)]+_0x210650(0x16d));}catch(_0x457579){console['error'](_0x210650(0xe8),_0x457579);}}async[a38_0x33a10e(0xc2)](_0x232eca){const _0x1a98d5=a38_0x33a10e,_0x144286=[],_0x1dcdef=new Date();_0x1dcdef[_0x1a98d5(0x195)](_0x1dcdef['getDate']()-this[_0x1a98d5(0xa6)]),console[_0x1a98d5(0x8c)](_0x1a98d5(0x94)+this['EXPIRY_DAYS']+_0x1a98d5(0x15b)+_0x1dcdef[_0x1a98d5(0xf7)]()+')');for(const _0x375fde of _0x232eca){if(_0x375fde[_0x1a98d5(0x157)]<_0x1dcdef){console['log'](_0x1a98d5(0x10b)+_0x375fde['id']+_0x1a98d5(0x182)+this[_0x1a98d5(0xa6)]+_0x1a98d5(0x127));try{this[_0x1a98d5(0x104)](_0x375fde['id'],_0x375fde['gatewayPaymentId']||'unknown',_0x1a98d5(0x84),'EXPIRED',_0x1a98d5(0xa4),{'reason':_0x1a98d5(0x134)+this['EXPIRY_DAYS']+_0x1a98d5(0x14e),'createdAt':_0x375fde[_0x1a98d5(0x157)],'daysSinceCreation':Math[_0x1a98d5(0x132)]((Date[_0x1a98d5(0x15d)]()-_0x375fde['createdAt'][_0x1a98d5(0x109)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x375fde[_0x1a98d5(0x190)],'paymentCurrency':_0x375fde[_0x1a98d5(0xad)],'shopId':_0x375fde[_0x1a98d5(0xb1)]}),await database_1[_0x1a98d5(0xe5)]['payment']['update']({'where':{'id':_0x375fde['id']},'data':{'status':_0x1a98d5(0x170),'updatedAt':new Date(),'adminNotes':_0x1a98d5(0x194)+this['EXPIRY_DAYS']+'\x20days\x20without\x20payment\x20confirmation'}}),await database_1['default'][_0x1a98d5(0x124)][_0x1a98d5(0x1a1)]({'data':{'paymentId':_0x375fde['id'],'shopId':_0x375fde[_0x1a98d5(0xb1)],'event':'cointopay_auto_expired','statusCode':0xc8,'responseBody':JSON[_0x1a98d5(0x92)]({'reason':_0x1a98d5(0x134)+this[_0x1a98d5(0xa6)]+'\x20days','createdAt':_0x375fde[_0x1a98d5(0x157)],'expiredAt':new Date()['toISOString'](),'daysSinceCreation':Math[_0x1a98d5(0x132)]((Date['now']()-_0x375fde['createdAt'][_0x1a98d5(0x109)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x1a98d5(0x96)](_0x375fde,_0x1a98d5(0x170)),await this[_0x1a98d5(0xc6)](_0x375fde,'EXPIRED'),this[_0x1a98d5(0x81)](_0x375fde['id']),_0x144286[_0x1a98d5(0xb3)](_0x375fde['id']),console[_0x1a98d5(0x8c)](_0x1a98d5(0x120)+_0x375fde['id']+_0x1a98d5(0xd2)+this['EXPIRY_DAYS']+_0x1a98d5(0xd8));}catch(_0x1e62a4){console['error'](_0x1a98d5(0xee)+_0x375fde['id']+':',_0x1e62a4),this['logCoinToPayError'](_0x375fde['id'],_0x375fde['gatewayPaymentId']||_0x1a98d5(0x12a),_0x1e62a4,'auto_expire',{'reason':_0x1a98d5(0x16f),'createdAt':_0x375fde[_0x1a98d5(0x157)],'daysSinceCreation':Math[_0x1a98d5(0x132)]((Date[_0x1a98d5(0x15d)]()-_0x375fde[_0x1a98d5(0x157)][_0x1a98d5(0x109)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x144286;}async['checkSinglePayment'](_0x233dd9){const _0x1e9d4d=a38_0x33a10e;if(!_0x233dd9[_0x1e9d4d(0x131)]){console[_0x1e9d4d(0x8c)](_0x1e9d4d(0x184)+_0x233dd9['id']+_0x1e9d4d(0xec));return;}console[_0x1e9d4d(0x8c)](_0x1e9d4d(0xcd)+_0x233dd9['gateway']+_0x1e9d4d(0x17e)+_0x233dd9['id']+'\x20('+_0x233dd9[_0x1e9d4d(0x131)]+')');try{let _0x3636ce;_0x233dd9[_0x1e9d4d(0x11a)]==='cointopay2'?(_0x3636ce=await this[_0x1e9d4d(0x160)][_0x1e9d4d(0x148)](_0x233dd9[_0x1e9d4d(0x131)]),console[_0x1e9d4d(0x8c)](_0x1e9d4d(0xd1)+_0x233dd9['id']+'\x20status:\x20'+_0x3636ce['status'])):(_0x3636ce=await this['coinToPayService'][_0x1e9d4d(0x148)](_0x233dd9[_0x1e9d4d(0x131)]),console[_0x1e9d4d(0x8c)](_0x1e9d4d(0xa8)+_0x233dd9['id']+_0x1e9d4d(0x144)+_0x3636ce[_0x1e9d4d(0xc7)]));_0x3636ce[_0x1e9d4d(0x172)]&&console[_0x1e9d4d(0x8c)]('📊\x20[CHECK]\x20Payment\x20'+_0x233dd9['id']+_0x1e9d4d(0x12e),{'iban':_0x3636ce[_0x1e9d4d(0x172)]['iban']||_0x1e9d4d(0x8f),'transactionId':_0x3636ce[_0x1e9d4d(0x172)]['transactionId'],'createdOn':_0x3636ce[_0x1e9d4d(0x172)][_0x1e9d4d(0x178)],'confirmedOn':_0x3636ce['paymentDetails']['confirmedOn']||_0x1e9d4d(0x166)});if(_0x3636ce[_0x1e9d4d(0xc7)]!==_0x233dd9['status']){console[_0x1e9d4d(0x8c)]('🔄\x20[CHECK]\x20Updating\x20payment\x20'+_0x233dd9['id']+'\x20status\x20from\x20'+_0x233dd9['status']+_0x1e9d4d(0x192)+_0x3636ce['status']),this[_0x1e9d4d(0x104)](_0x233dd9['id'],_0x233dd9[_0x1e9d4d(0x131)],_0x233dd9[_0x1e9d4d(0xc7)],_0x3636ce[_0x1e9d4d(0xc7)],_0x1e9d4d(0xf5),{'paymentDetails':_0x3636ce['paymentDetails'],'amount':_0x3636ce[_0x1e9d4d(0x190)],'currency':_0x3636ce[_0x1e9d4d(0xad)],'shopId':_0x233dd9[_0x1e9d4d(0xb1)],'checkTimestamp':new Date()[_0x1e9d4d(0xf7)]()});const _0x36e427={'status':_0x3636ce[_0x1e9d4d(0xc7)],'updatedAt':new Date()};if(_0x3636ce['status']===_0x1e9d4d(0xe3)&&_0x233dd9['status']!==_0x1e9d4d(0xe3)){_0x36e427[_0x1e9d4d(0x18f)]=new Date();if(!_0x233dd9[_0x1e9d4d(0x140)]){const _0x1285bb=await currencyService_1[_0x1e9d4d(0xe7)]['convertToUSDT'](_0x233dd9[_0x1e9d4d(0x190)],_0x233dd9['currency']);_0x36e427[_0x1e9d4d(0x140)]=_0x1285bb;const _0x59136d=await this[_0x1e9d4d(0x186)](_0x233dd9['shopId'],_0x233dd9[_0x1e9d4d(0x11a)]),_0x474e49=_0x1285bb*(0x1-_0x59136d/0x64);_0x36e427[_0x1e9d4d(0xf3)]=_0x474e49,_0x36e427[_0x1e9d4d(0x8a)]=_0x59136d,console['log']('💰\x20[CHECK]\x20Payment\x20'+_0x233dd9['id']+'\x20amounts\x20calculated:'),console[_0x1e9d4d(0x8c)](_0x1e9d4d(0x125)+_0x233dd9[_0x1e9d4d(0x190)]+'\x20'+_0x233dd9[_0x1e9d4d(0xad)]+_0x1e9d4d(0xfc)+_0x1285bb[_0x1e9d4d(0x16b)](0x6)+_0x1e9d4d(0x1a3)),console[_0x1e9d4d(0x8c)](_0x1e9d4d(0x198)+_0x233dd9[_0x1e9d4d(0x11a)]+_0x1e9d4d(0x150)+_0x59136d+'%'),console[_0x1e9d4d(0x8c)](_0x1e9d4d(0x167)+_0x474e49['toFixed'](0x6)+_0x1e9d4d(0x1a3));}console[_0x1e9d4d(0x8c)]('💰\x20[CHECK]\x20Payment\x20'+_0x233dd9['id']+_0x1e9d4d(0x158)+_0x36e427[_0x1e9d4d(0x18f)][_0x1e9d4d(0xf7)]());}if(_0x3636ce['paymentDetails']){const _0x262410=_0x3636ce[_0x1e9d4d(0x172)];_0x262410[_0x1e9d4d(0x18e)]&&(_0x36e427[_0x1e9d4d(0x13e)]=_0x262410['iban'],console['log'](_0x1e9d4d(0x188)+_0x262410['iban']));if(_0x262410['bankDetails']){const _0x3a4636=_0x233dd9['adminNotes']||'',_0x374e67=_0x1e9d4d(0x145)+_0x262410['bankDetails'];_0x36e427['adminNotes']=_0x3a4636?_0x3a4636+'\x0a\x0a'+_0x374e67:_0x374e67,console['log'](_0x1e9d4d(0x17c));}_0x262410[_0x1e9d4d(0x196)]&&console[_0x1e9d4d(0x8c)](_0x1e9d4d(0x118)+_0x262410[_0x1e9d4d(0x196)]),_0x262410[_0x1e9d4d(0xd5)]&&console[_0x1e9d4d(0x8c)](_0x1e9d4d(0xa7)+_0x262410[_0x1e9d4d(0xd5)]);}await database_1[_0x1e9d4d(0xe5)][_0x1e9d4d(0x14f)][_0x1e9d4d(0xc0)]({'where':{'id':_0x233dd9['id']},'data':_0x36e427});if(_0x3636ce[_0x1e9d4d(0xc7)]==='PAID'&&_0x233dd9[_0x1e9d4d(0xc7)]!=='PAID'){console[_0x1e9d4d(0x8c)]('📈\x20[COINTOPAY]\x20Payment\x20'+_0x233dd9['id']+'\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link');const _0x5c6539=await database_1[_0x1e9d4d(0xe5)]['payment'][_0x1e9d4d(0x155)]({'where':{'id':_0x233dd9['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x5c6539?.[_0x1e9d4d(0xb7)]&&_0x5c6539['paymentLink'])try{const _0x53f45d=_0x5c6539['paymentLink'];console[_0x1e9d4d(0x8c)](_0x1e9d4d(0x19a)+_0x53f45d['id']+_0x1e9d4d(0x171)+_0x53f45d['type']+_0x1e9d4d(0x153)+_0x53f45d['currentPayments']+',\x20status='+_0x53f45d[_0x1e9d4d(0xc7)]);const _0x1a524d=_0x53f45d[_0x1e9d4d(0x191)]+0x1,_0x558109=_0x53f45d[_0x1e9d4d(0x9e)]===_0x1e9d4d(0xb9)?_0x1e9d4d(0x12d):_0x53f45d[_0x1e9d4d(0xc7)];await database_1[_0x1e9d4d(0xe5)][_0x1e9d4d(0x114)][_0x1e9d4d(0xc0)]({'where':{'id':_0x53f45d['id']},'data':{'currentPayments':_0x1a524d,'status':_0x558109,'updatedAt':new Date()}}),console[_0x1e9d4d(0x8c)](_0x1e9d4d(0x89)+_0x53f45d['id']+_0x1e9d4d(0xa5)+_0x53f45d['currentPayments']+_0x1e9d4d(0xfc)+_0x1a524d+',\x20status='+_0x53f45d[_0x1e9d4d(0xc7)]+_0x1e9d4d(0xfc)+_0x558109);}catch(_0x55bffe){console['error'](_0x1e9d4d(0x83),_0x55bffe);}else console[_0x1e9d4d(0x8c)](_0x1e9d4d(0xe0)+_0x233dd9['id']+_0x1e9d4d(0xeb));}await database_1[_0x1e9d4d(0xe5)]['webhookLog'][_0x1e9d4d(0x1a1)]({'data':{'paymentId':_0x233dd9['id'],'shopId':_0x233dd9['shopId'],'event':_0x1e9d4d(0x179)+_0x3636ce[_0x1e9d4d(0xc7)]['toLowerCase'](),'statusCode':0xc8,'responseBody':JSON[_0x1e9d4d(0x92)]({'oldStatus':_0x233dd9[_0x1e9d4d(0xc7)],'newStatus':_0x3636ce['status'],'paymentDetails':_0x3636ce[_0x1e9d4d(0x172)],'checkedAt':new Date()[_0x1e9d4d(0xf7)]()})}}),await this[_0x1e9d4d(0x96)](_0x233dd9,_0x3636ce[_0x1e9d4d(0xc7)]),await this['sendPaymentStatusNotification'](_0x233dd9,_0x3636ce[_0x1e9d4d(0xc7)]),_0x3636ce['status']!=='PENDING'&&(console[_0x1e9d4d(0x8c)](_0x1e9d4d(0x152)+_0x233dd9['id']+_0x1e9d4d(0x185)+_0x3636ce['status']+_0x1e9d4d(0x13f)),this['clearPaymentTimers'](_0x233dd9['id'])),console[_0x1e9d4d(0x8c)](_0x1e9d4d(0x161)+_0x233dd9['id']+'\x20updated\x20successfully');}else console[_0x1e9d4d(0x8c)](_0x1e9d4d(0x107)+_0x233dd9['id']+_0x1e9d4d(0x18d)+_0x3636ce[_0x1e9d4d(0xc7)]+')'),this[_0x1e9d4d(0x104)](_0x233dd9['id'],_0x233dd9[_0x1e9d4d(0x131)],_0x233dd9['status'],_0x3636ce[_0x1e9d4d(0xc7)],_0x1e9d4d(0xf5),{'statusUnchanged':!![],'paymentDetails':_0x3636ce[_0x1e9d4d(0x172)],'amount':_0x3636ce[_0x1e9d4d(0x190)],'currency':_0x3636ce[_0x1e9d4d(0xad)],'shopId':_0x233dd9[_0x1e9d4d(0xb1)],'checkTimestamp':new Date()[_0x1e9d4d(0xf7)]()});}catch(_0x580330){console[_0x1e9d4d(0x122)]('❌\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20'+_0x233dd9['id']+':',_0x580330),this[_0x1e9d4d(0xa3)](_0x233dd9['id'],_0x233dd9[_0x1e9d4d(0x131)],_0x580330,_0x1e9d4d(0xf5),{'paymentAmount':_0x233dd9['amount'],'paymentCurrency':_0x233dd9['currency'],'shopId':_0x233dd9[_0x1e9d4d(0xb1)],'createdAt':_0x233dd9[_0x1e9d4d(0x157)]}),await database_1[_0x1e9d4d(0xe5)]['webhookLog'][_0x1e9d4d(0x1a1)]({'data':{'paymentId':_0x233dd9['id'],'shopId':_0x233dd9[_0x1e9d4d(0xb1)],'event':_0x1e9d4d(0xcb),'statusCode':0x1f4,'responseBody':JSON[_0x1e9d4d(0x92)]({'error':_0x580330 instanceof Error?_0x580330[_0x1e9d4d(0xab)]:_0x1e9d4d(0xce),'gatewayPaymentId':_0x233dd9[_0x1e9d4d(0x131)],'checkedAt':new Date()[_0x1e9d4d(0xf7)]()})}});}}async[a38_0x33a10e(0x96)](_0x42fcbc,_0x24d9b9){const _0x196e97=a38_0x33a10e,_0x30c07d=Date[_0x196e97(0x15d)]();try{const _0x3ebb86=_0x42fcbc[_0x196e97(0x108)],_0x32ea89=_0x3ebb86[_0x196e97(0x180)];if(!_0x32ea89?.[_0x196e97(0xfa)]){console['log'](_0x196e97(0x11c)+_0x3ebb86['id']);return;}const _0x2c3dc2=_0x24d9b9==='PAID'?_0x196e97(0xf9):_0x24d9b9==='FAILED'?_0x196e97(0x19e):_0x24d9b9===_0x196e97(0x170)?_0x196e97(0x19e):_0x196e97(0x163);if(!_0x32ea89[_0x196e97(0xbf)]?.[_0x196e97(0xd9)](_0x2c3dc2)){console['log'](_0x196e97(0x16a)+_0x2c3dc2+_0x196e97(0xac)+_0x3ebb86['id']);return;}const _0x146ecb=(0x0,gateway_1[_0x196e97(0xa9)])(_0x42fcbc[_0x196e97(0x11a)])||_0x42fcbc[_0x196e97(0x11a)],_0x33da5d={'event':_0x2c3dc2,'payment':{'id':_0x42fcbc['id'],'order_id':_0x42fcbc[_0x196e97(0xcf)],'gateway_order_id':_0x42fcbc[_0x196e97(0x137)],'gateway':_0x146ecb,'amount':_0x42fcbc[_0x196e97(0x190)],'currency':_0x42fcbc['currency'],'status':_0x24d9b9[_0x196e97(0x95)](),'customer_email':_0x42fcbc['customerEmail'],'customer_name':_0x42fcbc[_0x196e97(0x16e)],'created_at':_0x42fcbc[_0x196e97(0x157)],'updated_at':new Date()}},_0x3bb868=await fetch(_0x32ea89[_0x196e97(0xfa)],{'method':'POST','headers':{'Content-Type':_0x196e97(0xd0),'User-Agent':_0x196e97(0x13b)},'body':JSON['stringify'](_0x33da5d)}),_0x53e032=Date[_0x196e97(0x15d)]()-_0x30c07d,_0x29fe30=_0x3bb868['ok']?_0x196e97(0x12b):await _0x3bb868[_0x196e97(0xb2)]();loggerService_1[_0x196e97(0x197)][_0x196e97(0x106)](_0x42fcbc[_0x196e97(0xb1)],_0x32ea89[_0x196e97(0xfa)],_0x2c3dc2,_0x3bb868[_0x196e97(0xc7)],_0x53e032,_0x33da5d),console['log'](_0x196e97(0x133)+_0x32ea89[_0x196e97(0xfa)]+_0x196e97(0x10f)+_0x3bb868[_0x196e97(0xc7)]+'\x20('+_0x53e032+_0x196e97(0xe2));}catch(_0x163f1b){console[_0x196e97(0x122)](_0x196e97(0x121),_0x163f1b),loggerService_1[_0x196e97(0x197)][_0x196e97(0xfb)](_0x42fcbc[_0x196e97(0xb1)],_0x42fcbc[_0x196e97(0x108)]?.[_0x196e97(0x180)]?.[_0x196e97(0xfa)]||_0x196e97(0x12a),_0x196e97(0x18c),_0x163f1b,{});}}async[a38_0x33a10e(0xc6)](_0x12d04d,_0x16a807){const _0x2070bb=a38_0x33a10e;try{const _0x35038e={'PENDING':_0x2070bb(0x11e),'PAID':_0x2070bb(0x143),'FAILED':_0x2070bb(0x91),'EXPIRED':_0x2070bb(0xbc)},_0x450dba=_0x35038e[_0x16a807];if(!_0x450dba||_0x450dba===_0x2070bb(0x11e))return;await telegramBotService_1[_0x2070bb(0xda)][_0x2070bb(0x142)](_0x12d04d[_0x2070bb(0xb1)],_0x12d04d,_0x450dba);}catch(_0x284b36){console[_0x2070bb(0x122)](_0x2070bb(0x174),_0x284b36);}}async[a38_0x33a10e(0xe4)](_0x2657c1){const _0x18f0da=a38_0x33a10e;console[_0x18f0da(0x8c)](_0x18f0da(0x17d)+_0x2657c1);const _0x4d4938=await database_1[_0x18f0da(0xe5)]['payment'][_0x18f0da(0x155)]({'where':{'id':_0x2657c1},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x4d4938)throw new Error(_0x18f0da(0x15f));if(_0x4d4938[_0x18f0da(0x11a)]!==_0x18f0da(0x168)&&_0x4d4938[_0x18f0da(0x11a)]!==_0x18f0da(0x14a))throw new Error('Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment');console['log'](_0x18f0da(0x18a)+_0x4d4938['gateway']+'\x20payment\x20'+_0x2657c1),await this['checkSinglePayment'](_0x4d4938),console[_0x18f0da(0x8c)](_0x18f0da(0xaa)+_0x2657c1);}[a38_0x33a10e(0xc8)](){const _0x244e1c=a38_0x33a10e,_0x1df84b=this[_0x244e1c(0x162)]?this[_0x244e1c(0x151)]:undefined,_0x3154e2=Array[_0x244e1c(0x11f)](this['paymentTimers'][_0x244e1c(0x111)]())[_0x244e1c(0x88)](_0xa8ff27=>({'paymentId':_0xa8ff27[_0x244e1c(0x97)],'gatewayPaymentId':_0xa8ff27[_0x244e1c(0x131)],'createdAt':_0xa8ff27[_0x244e1c(0x157)],'timersCount':_0xa8ff27[_0x244e1c(0x9b)]['length']}));return{'isActive':!!this[_0x244e1c(0x162)],'globalCheckIntervalMinutes':this[_0x244e1c(0x151)]/(0x3e8*0x3c),'expiryDays':this[_0x244e1c(0xa6)],'activeIndividualTimers':this[_0x244e1c(0x10e)]['size'],'nextGlobalCheckIn':_0x1df84b,'paymentTimersDetails':_0x3154e2};}[a38_0x33a10e(0x110)](_0x2228af){const _0x1fedc1=a38_0x33a10e,_0x545266=this['paymentTimers'][_0x1fedc1(0xdf)](_0x2228af);if(_0x545266)return{'hasTimers':!![],'timersCount':_0x545266[_0x1fedc1(0x9b)][_0x1fedc1(0xb6)],'createdAt':_0x545266[_0x1fedc1(0x157)],'gatewayPaymentId':_0x545266['gatewayPaymentId']};return{'hasTimers':![]};}async[a38_0x33a10e(0x186)](_0x22fd96,_0x2261ca){const _0x3fb1d7=a38_0x33a10e;try{const _0x3ac974=await database_1[_0x3fb1d7(0xe5)][_0x3fb1d7(0x108)][_0x3fb1d7(0x155)]({'where':{'id':_0x22fd96},'select':{'gatewaySettings':!![]}});if(!_0x3ac974?.[_0x3fb1d7(0xdc)])return console[_0x3fb1d7(0x8c)](_0x3fb1d7(0x14c)+_0x22fd96+_0x3fb1d7(0x1a0)),0xa;const _0x5f1cb3=JSON[_0x3fb1d7(0xe1)](_0x3ac974[_0x3fb1d7(0xdc)]);for(const [_0x52337e,_0x43280a]of Object['entries'](_0x5f1cb3)){if(_0x52337e[_0x3fb1d7(0x95)]()===_0x2261ca[_0x3fb1d7(0x95)]()){const _0x588c04=_0x43280a['commission']||0xa;return console[_0x3fb1d7(0x8c)]('Gateway\x20'+_0x2261ca+'\x20commission\x20for\x20shop\x20'+_0x22fd96+':\x20'+_0x588c04+'%'),_0x588c04;}}return console['log'](_0x3fb1d7(0xef)+_0x2261ca+_0x3fb1d7(0xca)+_0x22fd96+_0x3fb1d7(0x8b)),0xa;}catch(_0x2ecf6c){return console[_0x3fb1d7(0x122)](_0x3fb1d7(0xf0)+_0x22fd96+_0x3fb1d7(0xbb)+_0x2261ca+':',_0x2ecf6c),0xa;}}}exports[a38_0x33a10e(0x98)]=CoinToPayStatusService,exports[a38_0x33a10e(0x14d)]=new CoinToPayStatusService();function a38_0xe6ac(){const _0x550a2b=['\x20updated:\x20currentPayments=','EXPIRY_DAYS','✅\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','📊\x20[CHECK]\x20CoinToPay\x20payment\x20','getGatewayIdByName','✅\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','message','\x20not\x20enabled\x20for\x20shop\x20','currency','checkSinglePaymentById','./gateways/coinToPayService','catch','shopId','text','push','⚠️\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','⏰\x20[GLOBAL]\x20Payment\x20','length','paymentLinkId','❌\x20[TIMER]\x20Failed\x20individual\x20check\x20#','SINGLE','\x20\x20\x20-\x20Status:\x20',',\x20gateway\x20','expired','findMany','schedulePaymentChecks','webhookEvents','update','\x20has\x20no\x20gatewayPaymentId','checkExpiredPayments','🪙\x20[GLOBAL]\x20Found\x20','./gateways/coinToPay2Service','schedule_created','sendPaymentStatusNotification','status','getServiceStats','🛑\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','\x20in\x20shop\x20','cointopay_status_check_error','✅\x20[DEBUG]\x20Successfully\x20scheduled\x20','🔍\x20[CHECK]\x20Checking\x20','Unknown\x20error','orderId','application/json','📊\x20[CHECK]\x20CoinToPay2\x20payment\x20','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','❌\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','2276334eZfhFe','confirmedOn','🪙\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','\x20not\x20found,\x20clearing\x20timers','-day\x20timeout','includes','telegramBotService','✅\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','gatewaySettings','checkAllPendingPayments','✅\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','get','📈\x20[COINTOPAY]\x20Payment\x20','parse','ms)','PAID','checkPaymentById','default','checkSinglePayment','currencyService','❌\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','timestamp','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','\x20has\x20no\x20gatewayPaymentId,\x20skipping','2\x20minutes','❌\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','No\x20specific\x20commission\x20found\x20for\x20gateway\x20','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','size','10EaothR','amountAfterGatewayCommissionUSDT','delete','status_check','\x20\x20\x20-\x20ShopId:\x20','toISOString','\x20skipped,\x20','payment.success','webhookUrl','logShopWebhookError','\x20->\x20','\x20\x20\x20📝\x20Context:','\x20\x20\x20📊\x20Status:\x20','✅\x20[HOURLY]\x20Payment\x20','\x20for\x20payment\x20','🪙\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','❌\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','description','logCoinToPayStatus','.\x20Remaining\x20active\x20timers:\x20','logShopWebhookSent','📊\x20[CHECK]\x20Payment\x20','shop','getTime','🪙\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','⏰\x20[EXPIRY]\x20Payment\x20','🪙\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','__importDefault','paymentTimers','\x20with\x20status\x20','getPaymentTimerInfo','values','../types/gateway','🪙\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','paymentLink','./telegramBotService','CoinToPayService','\x20\x20\x20❌\x20Error:\x20','🆔\x20[CHECK]\x20Transaction\x20ID:\x20','defineProperty','gateway','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','2107780VIcTdR','created','from','✅\x20[EXPIRY]\x20Payment\x20','Failed\x20to\x20send\x20shop\x20webhook:','error','forEach','webhookLog','\x20\x20\x20Amount:\x20','\x20timers\x20for\x20payment\x20','\x20days,\x20marking\x20as\x20EXPIRED','🧹\x20[DEBUG]\x20Cleared\x20timer\x20#','stack','unknown','Success','stopPeriodicStatusCheck','COMPLETED','\x20details:','delay','🪙\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','gatewayPaymentId','floor','Shop\x20webhook\x20sent\x20to\x20','Payment\x20older\x20than\x20','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','/status/','gatewayOrderId','\x20status\x20is\x20','❌\x20[CHECK]\x20Payment\x20','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','TesSoft\x20Payment\x20System/1.0','5006205kjCCyl','🪙\x20[TIMER]\x20Individual\x20check\x20#','remitterIban',',\x20clearing\x20individual\x20timers','amountUSDT','\x20current\x20status:\x20','sendPaymentNotification','paid','\x20status:\x20','Bank\x20Details:\x20','⏰\x20[GLOBAL]\x20Found\x20','🛑\x20[SHUTDOWN]\x20Cleared\x20','checkPaymentStatus','\x20\x20\x20-\x20paymentId:\x20','cointopay2','✅\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','coinToPayStatusService','\x20days','payment','\x20commission:\x20','GLOBAL_CHECK_INTERVAL_MS','🧹\x20[CHECK]\x20Payment\x20',',\x20currentPayments=','\x20to\x20clear','findUnique','\x20individual\x20payment\x20timers','createdAt','\x20marked\x20as\x20paid\x20at:\x20','❌\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','./currencyService','\x20days\x20(created\x20before\x20','h),\x20skipping\x20global\x20check','now','\x20is\x20valid\x20for\x20checking,\x20proceeding...','Payment\x20not\x20found','coinToPay2Service','✅\x20[CHECK]\x20Payment\x20','globalCheckInterval','payment.pending','\x20found:','\x20\x20\x20📝\x20Details:','not\x20confirmed','\x20\x20\x20Amount\x20after\x20commission:\x20','cointopay','\x20\x20\x20-\x20gatewayPaymentId:\x20','Webhook\x20event\x20','toFixed','1\x20minute','\x20expired','customerName','Failed\x20to\x20mark\x20payment\x20as\x20expired','EXPIRED',':\x20type=','paymentDetails','\x20triggered\x20for\x20payment\x20','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','🧹\x20[DEBUG]\x20Clearing\x20','COINTOPAY_ERROR','startPeriodicStatusCheck','createdOn','cointopay_status_check_','9987648NejHwA','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','🏦\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes','🔍\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','\x20payment\x20','\x20\x20\x20📅\x20Time:\x20','settings','COINTOPAY_STATUS_CHANGE','\x20is\x20older\x20than\x20','❌\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','⚠️\x20[CHECK]\x20Payment\x20','\x20status\x20changed\x20to\x20','getGatewayCommission',',\x20stopping\x20individual\x20checks','🏦\x20[CHECK]\x20Saved\x20IBAN:\x20','\x20expired\x20CoinToPay\x20payments','✅\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','\x20\x20\x20-\x20Gateway:\x20','webhook_send','\x20status\x20unchanged\x20(','iban','paidAt','amount','currentPayments','\x20to\x20','\x20(age:\x20','Automatically\x20expired\x20after\x20','setDate','transactionId','loggerService','\x20\x20\x20Gateway\x20','⏰\x20[HOURLY]\x20Payment\x20','📈\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','\x20completed\x20for\x20payment\x20','\x20checked,\x20','🪙\x20[ERROR]\x20CoinToPay\x20Error:\x20','payment.failed','\x20pending\x20CoinToPay\x20payments',',\x20using\x20default\x20commission\x2010%','create','✅\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','\x20USDT','📊\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','708814uPQunP','clearPaymentTimers','\x20not\x20found\x20in\x20database','❌\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','PENDING','325960LPCpkV','80IwMMBa','4jEFvvx','map','✅\x20[COINTOPAY]\x20Payment\x20link\x20','gatewayCommissionRate',',\x20using\x20default\x2010%','log','✅\x20[TIMER]\x20Individual\x20check\x20#','⏰\x20[DEBUG]\x20Scheduled\x20check\x20#','not\x20found','\x20\x20\x20-\x20Amount:\x20','failed','stringify','❌\x20[HOURLY]\x20Payment\x20','⏰\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','toLowerCase','sendShopWebhook','paymentId','CoinToPayStatusService','5\x20minutes','\x20\x20\x20📍\x20Source:\x20','timers','\x20initial\x20timers\x20for\x20payment\x20','has','type','__esModule','8849274sYHmmS','🪙\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','🪙\x20[DEBUG]\x20Creating\x20','logCoinToPayError','auto_expire'];a38_0xe6ac=function(){return _0x550a2b;};return a38_0xe6ac();}