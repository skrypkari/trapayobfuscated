'use strict';const a42_0x438f6d=a42_0x434c;(function(_0x32d3f1,_0x16608b){const _0x564f8=a42_0x434c,_0x45835e=_0x32d3f1();while(!![]){try{const _0x28e32f=-parseInt(_0x564f8(0xf8))/0x1+parseInt(_0x564f8(0xf1))/0x2+parseInt(_0x564f8(0x176))/0x3*(-parseInt(_0x564f8(0x180))/0x4)+parseInt(_0x564f8(0x132))/0x5*(parseInt(_0x564f8(0x130))/0x6)+-parseInt(_0x564f8(0x140))/0x7*(-parseInt(_0x564f8(0x16e))/0x8)+parseInt(_0x564f8(0xba))/0x9*(-parseInt(_0x564f8(0x13a))/0xa)+parseInt(_0x564f8(0x11d))/0xb;if(_0x28e32f===_0x16608b)break;else _0x45835e['push'](_0x45835e['shift']());}catch(_0x47defe){_0x45835e['push'](_0x45835e['shift']());}}}(a42_0x37a3,0xac6b0));function a42_0x434c(_0x21b77d,_0x147950){const _0x37a3a0=a42_0x37a3();return a42_0x434c=function(_0x434c05,_0x1c9ae9){_0x434c05=_0x434c05-0x76;let _0x4f4af1=_0x37a3a0[_0x434c05];return _0x4f4af1;},a42_0x434c(_0x21b77d,_0x147950);}var __importDefault=this&&this[a42_0x438f6d(0x146)]||function(_0x3c9b24){return _0x3c9b24&&_0x3c9b24['__esModule']?_0x3c9b24:{'default':_0x3c9b24};};function a42_0x37a3(){const _0x2207ff=['error','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','cointopay2','üîç\x20[CHECK]\x20Checking\x20','1932942nlCDtL','payment','Unknown\x20error','shop','getPaymentTimerInfo','status_check','‚è∞\x20[GLOBAL]\x20Payment\x20','1315977aExJvZ','settings','findUnique','now',',\x20using\x20default\x20commission\x2010%','‚úÖ\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','not\x20confirmed','\x20completed\x20for\x20payment\x20','amount','Failed\x20to\x20mark\x20payment\x20as\x20expired','paymentLinkId','amountAfterGatewayCommissionUSDT','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','unknown','ü™ô\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','orderId','transactionId','checkPaymentById','‚úÖ\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','PENDING','\x20\x20\x20üìç\x20Source:\x20','\x20initial\x20timers\x20for\x20payment\x20','set','timestamp','\x20payment\x20','amountUSDT','CoinToPayStatusService','\x20is\x20too\x20new\x20(','coinToPayService','‚è∞\x20[EXPIRY]\x20Payment\x20','\x20not\x20enabled\x20for\x20shop\x20','message','schedule_created','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','‚úÖ\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','‚ùå\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','type','22178519RhSGAX','timers','created','floor','üîç\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','defineProperty','currency','EXPIRED','length','map','‚úÖ\x20[EXPIRY]\x20Payment\x20','paidAt','stringify','iban','üÜî\x20[CHECK]\x20Transaction\x20ID:\x20','push','üìä\x20[CHECK]\x20CoinToPay2\x20payment\x20','webhook_send','logCoinToPayStatus','307038OHVTpH','Payment\x20older\x20than\x20','55ptHWnb','toFixed','‚ùå\x20[CHECK]\x20Payment\x20','üìä\x20[CHECK]\x20Payment\x20','\x20\x20\x20üìù\x20Context:','COINTOPAY_STATUS_CHANGE','text','‚ùå\x20[TIMER]\x20Failed\x20individual\x20check\x20#','12252090QthQKu','\x20\x20\x20-\x20Amount:\x20','\x20(age:\x20','üìä\x20[CHECK]\x20CoinToPay\x20payment\x20','üìä\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','\x20current\x20status:\x20','73801rbbkex','getGatewayIdByName','\x20is\x20older\x20than\x20','ü™ô\x20[TIMER]\x20Individual\x20check\x20#','checkSinglePayment','size','__importDefault','ü™ô\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','‚ùå\x20[HOURLY]\x20Payment\x20','delete','checkAllPendingPayments','paymentLink','currencyService','\x20skipped,\x20','1\x20minute','üí∞\x20[CHECK]\x20Payment\x20','paymentTimers','failed','ü™ô\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','/status/','payment.success','webhookLog','expired','\x20pending\x20CoinToPay\x20payments','\x20\x20\x20Amount\x20after\x20commission:\x20','üìà\x20[COINTOPAY]\x20Payment\x20','5\x20minutes','\x20USDT',',\x20currentPayments=','toLowerCase','üßπ\x20[DEBUG]\x20Clearing\x20','parse','üßπ\x20[CHECK]\x20Payment\x20','‚úÖ\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','\x20triggered\x20for\x20payment\x20','\x20checked,\x20','GLOBAL_CHECK_INTERVAL_MS','includes','üìà\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','\x20\x20\x20-\x20gatewayPaymentId:\x20','getTime','\x20timers\x20for\x20payment\x20',',\x20gateway\x20','üîç\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','\x20found:','ü™ô\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','696LITHCa','üßπ\x20[DEBUG]\x20Cleared\x20timer\x20#','\x20status\x20from\x20','gatewayCommissionRate','‚úÖ\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','PAID','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','getGatewayCommission','3282ZeczWD','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','description','status','update','__esModule','\x20days','‚ùå\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','‚ùå\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','confirmedOn','4444IVJUfM','logCoinToPayError','‚ùå\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','./gateways/coinToPayService','h),\x20skipping\x20global\x20check','Payment\x20not\x20found','not\x20found','\x20(after\x20','\x20is\x20valid\x20for\x20checking,\x20proceeding...','telegramBotService','checkPaymentStatus','ü™ô\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','getDate','./gateways/coinToPay2Service','\x20\x20\x20Gateway\x20','webhookEvents','\x20\x20\x20üìÖ\x20Time:\x20','\x20\x20\x20-\x20Status:\x20','‚ö†Ô∏è\x20[CHECK]\x20Payment\x20','‚úÖ\x20[DEBUG]\x20Successfully\x20scheduled\x20','./currencyService','has','from','Gateway\x20','cointopay','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','\x20status\x20is\x20','Shop\x20webhook\x20sent\x20to\x20','\x20commission:\x20','globalCheckInterval','\x20status\x20changed\x20to\x20','COMPLETED','toISOString','stopPeriodicStatusCheck','../types/gateway','‚è∞\x20[GLOBAL]\x20Found\x20','cointopay_status_check_error','\x20status:\x20','\x20individual\x20payment\x20timers','\x20has\x20no\x20gatewayPaymentId,\x20skipping','Webhook\x20event\x20','‚è∞\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','sendPaymentStatusNotification','coinToPayStatusService','\x20\x20\x20‚ùå\x20Error:\x20','currentPayments','convertToUSDT','payment.failed','üîç\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','\x20commission\x20for\x20shop\x20','üõë\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','loggerService','sendShopWebhook','gatewaySettings','ü™ô\x20[ERROR]\x20CoinToPay\x20Error:\x20','\x20seconds\x20(','‚úÖ\x20[COINTOPAY]\x20Payment\x20link\x20','checkExpiredPayments','üõë\x20[SHUTDOWN]\x20Cleared\x20','shopId','SINGLE','\x20\x20\x20-\x20paymentId:\x20','POST','\x20days,\x20marking\x20as\x20EXPIRED','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','log','cointopay_status_check_','ü™ô\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','getServiceStats','bankDetails','\x20\x20\x20-\x20ShopId:\x20','‚úÖ\x20[TIMER]\x20Individual\x20check\x20#','EXPIRY_DAYS','CoinToPayService','\x20has\x20no\x20gatewayPaymentId','\x20not\x20found,\x20clearing\x20timers','CoinToPay2Service','get','gateway','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','values','\x20status\x20unchanged\x20(','\x20not\x20found\x20in\x20database','9LvMkAd','startPeriodicStatusCheck','forEach',',\x20stopping\x20individual\x20checks','paymentId','webhookUrl','No\x20specific\x20commission\x20found\x20for\x20gateway\x20','\x20days\x20(created\x20before\x20','delay','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','\x20to\x20','\x20->\x20','‚è∞\x20[DEBUG]\x20Scheduled\x20check\x20#','default','application/json','catch','\x20\x20\x20-\x20GatewayPaymentId:\x20','\x20\x20\x20üìä\x20Status:\x20','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','customerEmail','create',',\x20clearing\x20individual\x20timers','paid','‚úÖ\x20[CHECK]\x20Payment\x20','ms)','gatewayPaymentId',':\x20type=','entries','auto_expire','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','./loggerService','Failed\x20to\x20send\x20shop\x20webhook:',',\x20status=','\x20updated\x20successfully','\x20to\x20clear','\x20for\x20payment\x20','payment.pending','schedulePaymentChecks','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','üè¶\x20[CHECK]\x20Bank\x20details\x20provided:\x20','\x20with\x20status\x20','../config/database','coinToPay2Service','clearPaymentTimers','createdAt','checkSinglePaymentById','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','ü™ô\x20[DEBUG]\x20Creating\x20','paymentDetails','logShopWebhookSent','remitterIban'];a42_0x37a3=function(){return _0x2207ff;};return a42_0x37a3();}Object[a42_0x438f6d(0x122)](exports,a42_0x438f6d(0x17b),{'value':!![]}),exports['coinToPayStatusService']=exports[a42_0x438f6d(0x112)]=void 0x0;const coinToPayService_1=require(a42_0x438f6d(0x183)),coinToPay2Service_1=require(a42_0x438f6d(0x18d)),gateway_1=require(a42_0x438f6d(0x89)),database_1=__importDefault(require(a42_0x438f6d(0xe3))),telegramBotService_1=require('./telegramBotService'),loggerService_1=require(a42_0x438f6d(0xd8)),currencyService_1=require(a42_0x438f6d(0x7b));class CoinToPayStatusService{constructor(){const _0x3796c5=a42_0x438f6d;this['globalCheckInterval']=null,this[_0x3796c5(0x164)]=0x3c*0x3c*0x3e8,this['EXPIRY_DAYS']=0x5,this[_0x3796c5(0x150)]=new Map(),this[_0x3796c5(0x114)]=new coinToPayService_1[(_0x3796c5(0xb0))](),this[_0x3796c5(0xe4)]=new coinToPay2Service_1[(_0x3796c5(0xb3))](),console['log'](_0x3796c5(0x106));}[a42_0x438f6d(0xdf)](_0x27965d,_0x509e2d){const _0x3ac5ef=a42_0x438f6d;console[_0x3ac5ef(0xa8)]('ü™ô\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:'),console[_0x3ac5ef(0xa8)](_0x3ac5ef(0xa4)+_0x27965d),console[_0x3ac5ef(0xa8)](_0x3ac5ef(0x167)+_0x509e2d),this[_0x3ac5ef(0xe5)](_0x27965d);const _0xecfe88=[],_0x16102b=new Date(),_0x1e570d=[{'delay':0x1*0x3c*0x3e8,'description':_0x3ac5ef(0x14e)},{'delay':0x2*0x3c*0x3e8,'description':'2\x20minutes'},{'delay':0x5*0x3c*0x3e8,'description':_0x3ac5ef(0x15a)},{'delay':0x5*0x3c*0x3e8,'description':_0x3ac5ef(0x15a)}];console['log'](_0x3ac5ef(0xe9)+_0x1e570d[_0x3ac5ef(0x125)]+_0x3ac5ef(0x10d)+_0x27965d);let _0x135e9c=0x0;_0x1e570d[_0x3ac5ef(0xbc)]((_0x13f477,_0x490f8f)=>{const _0x3f77c3=_0x3ac5ef;_0x135e9c+=_0x13f477[_0x3f77c3(0xc2)];const _0x17c51c=setTimeout(async()=>{const _0x324091=_0x3f77c3;console[_0x324091(0xa8)](_0x324091(0x143)+(_0x490f8f+0x1)+_0x324091(0x162)+_0x27965d+_0x324091(0x187)+_0x13f477[_0x324091(0x178)]+')');try{await this['checkSinglePaymentById'](_0x27965d),console['log'](_0x324091(0xae)+(_0x490f8f+0x1)+_0x324091(0xff)+_0x27965d);}catch(_0x218e2b){console[_0x324091(0xed)](_0x324091(0x139)+(_0x490f8f+0x1)+_0x324091(0xdd)+_0x27965d+':',_0x218e2b),this[_0x324091(0x181)](_0x27965d,_0x509e2d,_0x218e2b,'status_check',{'checkNumber':_0x490f8f+0x1,'scheduledAfter':_0x13f477[_0x324091(0x178)],'isIndividualCheck':!![]});}},_0x135e9c);_0xecfe88[_0x3f77c3(0x12c)](_0x17c51c),console[_0x3f77c3(0xa8)](_0x3f77c3(0xc6)+(_0x490f8f+0x1)+'\x20for\x20payment\x20'+_0x27965d+'\x20in\x20'+_0x135e9c/0x3e8+_0x3f77c3(0x9e)+_0x13f477[_0x3f77c3(0x178)]+')');});const _0x50ed84=setInterval(async()=>{const _0x18eaad=_0x3ac5ef;console[_0x18eaad(0xa8)](_0x18eaad(0x18b)+_0x27965d);try{const _0x45280e=await database_1[_0x18eaad(0xc7)][_0x18eaad(0xf2)][_0x18eaad(0xfa)]({'where':{'id':_0x27965d},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x45280e){console[_0x18eaad(0xa8)](_0x18eaad(0x148)+_0x27965d+_0x18eaad(0xb2)),this['clearPaymentTimers'](_0x27965d);return;}console[_0x18eaad(0xa8)]('üìä\x20[HOURLY]\x20Payment\x20'+_0x27965d+_0x18eaad(0x13f)+_0x45280e[_0x18eaad(0x179)]);if(_0x45280e[_0x18eaad(0x179)]!==_0x18eaad(0x10b)){console[_0x18eaad(0xa8)]('‚úÖ\x20[HOURLY]\x20Payment\x20'+_0x27965d+_0x18eaad(0x81)+_0x45280e['status']+',\x20stopping\x20individual\x20checks'),this[_0x18eaad(0xe5)](_0x27965d);return;}const _0x27c1bc=Math[_0x18eaad(0x120)]((Date[_0x18eaad(0xfb)]()-_0x45280e[_0x18eaad(0xe6)]['getTime']())/(0x3e8*0x3c*0x3c*0x18));if(_0x27c1bc>=this[_0x18eaad(0xaf)]){console[_0x18eaad(0xa8)]('‚è∞\x20[HOURLY]\x20Payment\x20'+_0x27965d+'\x20is\x20older\x20than\x20'+this[_0x18eaad(0xaf)]+_0x18eaad(0xe0)),this[_0x18eaad(0xe5)](_0x27965d);return;}await this[_0x18eaad(0xe7)](_0x27965d),console['log'](_0x18eaad(0xfd)+_0x27965d);}catch(_0x720f40){console['error']('‚ùå\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20'+_0x27965d+':',_0x720f40),this[_0x18eaad(0x181)](_0x27965d,_0x509e2d,_0x720f40,'status_check',{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0xecfe88[_0x3ac5ef(0x12c)](_0x50ed84),this[_0x3ac5ef(0x150)][_0x3ac5ef(0x10e)](_0x27965d,{'timers':_0xecfe88,'paymentId':_0x27965d,'gatewayPaymentId':_0x509e2d,'createdAt':_0x16102b}),console[_0x3ac5ef(0xa8)](_0x3ac5ef(0x7a)+_0x1e570d[_0x3ac5ef(0x125)]+_0x3ac5ef(0x80)+_0x27965d),console['log'](_0x3ac5ef(0x13e)+this['paymentTimers'][_0x3ac5ef(0x145)]),this['logCoinToPayStatus'](_0x27965d,_0x509e2d,_0x3ac5ef(0x10b),'PENDING','status_check',{'action':_0x3ac5ef(0x118),'scheduledChecks':_0x1e570d[_0x3ac5ef(0x125)],'firstCheckIn':_0x1e570d[0x0][_0x3ac5ef(0xc2)]/0x3e8,'totalTimers':this['paymentTimers'][_0x3ac5ef(0x145)]});}['clearPaymentTimers'](_0x5377df){const _0x436990=a42_0x438f6d,_0x412ce0=this['paymentTimers'][_0x436990(0xb4)](_0x5377df);_0x412ce0?(console[_0x436990(0xa8)](_0x436990(0x15e)+_0x412ce0['timers'][_0x436990(0x125)]+_0x436990(0x169)+_0x5377df),_0x412ce0['timers'][_0x436990(0xbc)]((_0x48f219,_0x401c73)=>{const _0x4d1397=_0x436990;_0x48f219&&(clearTimeout(_0x48f219),clearInterval(_0x48f219),console[_0x4d1397(0xa8)](_0x4d1397(0x16f)+(_0x401c73+0x1)+'\x20for\x20payment\x20'+_0x5377df));}),this['paymentTimers'][_0x436990(0x149)](_0x5377df),console[_0x436990(0xa8)](_0x436990(0x161)+_0x5377df+'.\x20Remaining\x20active\x20timers:\x20'+this['paymentTimers'][_0x436990(0x145)])):console[_0x436990(0xa8)]('‚ö†Ô∏è\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20'+_0x5377df+_0x436990(0xdc));}async[a42_0x438f6d(0xe7)](_0x5b5e64){const _0xe7c0a3=a42_0x438f6d;console['log'](_0xe7c0a3(0x121)+_0x5b5e64);const _0x136081=await database_1[_0xe7c0a3(0xc7)]['payment'][_0xe7c0a3(0xfa)]({'where':{'id':_0x5b5e64},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x136081){console[_0xe7c0a3(0xa8)](_0xe7c0a3(0x134)+_0x5b5e64+_0xe7c0a3(0xb9));return;}console['log'](_0xe7c0a3(0x135)+_0x5b5e64+_0xe7c0a3(0x16c)),console[_0xe7c0a3(0xa8)]('\x20\x20\x20-\x20Gateway:\x20'+_0x136081[_0xe7c0a3(0xb5)]),console[_0xe7c0a3(0xa8)](_0xe7c0a3(0x78)+_0x136081[_0xe7c0a3(0x179)]),console[_0xe7c0a3(0xa8)](_0xe7c0a3(0xca)+_0x136081[_0xe7c0a3(0xd3)]),console[_0xe7c0a3(0xa8)](_0xe7c0a3(0x13b)+_0x136081[_0xe7c0a3(0x100)]+'\x20'+_0x136081[_0xe7c0a3(0x123)]),console[_0xe7c0a3(0xa8)](_0xe7c0a3(0xad)+_0x136081[_0xe7c0a3(0xa2)]);if(_0x136081[_0xe7c0a3(0xb5)]!==_0xe7c0a3(0x7f)&&_0x136081[_0xe7c0a3(0xb5)]!==_0xe7c0a3(0xef)){console[_0xe7c0a3(0xa8)](_0xe7c0a3(0x79)+_0x5b5e64+_0xe7c0a3(0x104)+_0x136081['gateway']+')');return;}if(_0x136081[_0xe7c0a3(0x179)]!==_0xe7c0a3(0x10b)){console[_0xe7c0a3(0xa8)](_0xe7c0a3(0x79)+_0x5b5e64+'\x20status\x20is\x20'+_0x136081[_0xe7c0a3(0x179)]+_0xe7c0a3(0xbd)),this[_0xe7c0a3(0xe5)](_0x5b5e64);return;}if(!_0x136081[_0xe7c0a3(0xd3)]){console[_0xe7c0a3(0xa8)](_0xe7c0a3(0x79)+_0x5b5e64+_0xe7c0a3(0xb1));return;}console['log'](_0xe7c0a3(0xd1)+_0x5b5e64+_0xe7c0a3(0x188)),await this['checkSinglePayment'](_0x136081);}[a42_0x438f6d(0x12f)](_0x5261b5,_0x43c29f,_0x4e1809,_0x467d76,_0x57001e,_0x535e9f){const _0x3a4075=a42_0x438f6d,_0x30d5bd={'type':_0x3a4075(0x137),'paymentId':_0x5261b5,'gatewayPaymentId':_0x43c29f,'oldStatus':_0x4e1809,'newStatus':_0x467d76,'source':_0x57001e,'timestamp':new Date()[_0x3a4075(0x87)](),'details':_0x535e9f||{}};loggerService_1[_0x3a4075(0x9a)][_0x3a4075(0x12f)](_0x30d5bd),console[_0x3a4075(0xa8)](_0x3a4075(0xaa)+_0x5261b5+'\x20('+_0x43c29f+')'),console[_0x3a4075(0xa8)](_0x3a4075(0xcb)+_0x4e1809+_0x3a4075(0xc5)+_0x467d76),console[_0x3a4075(0xa8)](_0x3a4075(0x10c)+_0x57001e),console[_0x3a4075(0xa8)](_0x3a4075(0x77)+_0x30d5bd[_0x3a4075(0x10f)]),_0x535e9f&&console['log']('\x20\x20\x20üìù\x20Details:',_0x535e9f);}['logCoinToPayError'](_0x131c2c,_0x5174c1,_0x4f8899,_0x240092,_0x6589c4){const _0x57e622=a42_0x438f6d,_0x14623a={'type':'COINTOPAY_ERROR','paymentId':_0x131c2c,'gatewayPaymentId':_0x5174c1,'error':_0x4f8899 instanceof Error?{'message':_0x4f8899['message'],'stack':_0x4f8899['stack']}:_0x4f8899,'source':_0x240092,'timestamp':new Date()[_0x57e622(0x87)](),'context':_0x6589c4||{}};loggerService_1[_0x57e622(0x9a)][_0x57e622(0x181)](_0x14623a),console[_0x57e622(0xed)](_0x57e622(0x9d)+_0x131c2c+'\x20('+_0x5174c1+')'),console['error'](_0x57e622(0x93)+(_0x4f8899 instanceof Error?_0x4f8899[_0x57e622(0x117)]:_0x4f8899)),console[_0x57e622(0xed)]('\x20\x20\x20üìç\x20Source:\x20'+_0x240092),console['error'](_0x57e622(0x77)+_0x14623a[_0x57e622(0x10f)]),_0x6589c4&&console[_0x57e622(0xed)](_0x57e622(0x136),_0x6589c4);}[a42_0x438f6d(0xbb)](){const _0x3a7fdc=a42_0x438f6d;console['log'](_0x3a7fdc(0x152)),this[_0x3a7fdc(0x14a)]()[_0x3a7fdc(0xc9)](_0x39685b=>{const _0xb06d1=_0x3a7fdc;console[_0xb06d1(0xed)](_0xb06d1(0x17d),_0x39685b);}),this[_0x3a7fdc(0x84)]=setInterval(async()=>{const _0x284fb5=_0x3a7fdc;try{console[_0x284fb5(0xa8)]('ü™ô\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...'),await this[_0x284fb5(0x14a)](),console[_0x284fb5(0xa8)](_0x284fb5(0xcc));}catch(_0x185d6a){console[_0x284fb5(0xed)](_0x284fb5(0x11b),_0x185d6a);}},this[_0x3a7fdc(0x164)]),console[_0x3a7fdc(0xa8)]('‚úÖ\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)');}[a42_0x438f6d(0x88)](){const _0x3303fc=a42_0x438f6d;console[_0x3303fc(0xa8)](_0x3303fc(0x99));this['globalCheckInterval']&&(clearInterval(this[_0x3303fc(0x84)]),this[_0x3303fc(0x84)]=null,console[_0x3303fc(0xa8)]('üõë\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped'));const _0x3d4c59=this[_0x3303fc(0x150)]['size'];for(const [_0x438c53]of this[_0x3303fc(0x150)]){this['clearPaymentTimers'](_0x438c53);}console[_0x3303fc(0xa8)](_0x3303fc(0xa1)+_0x3d4c59+_0x3303fc(0x8d));}async[a42_0x438f6d(0x14a)](){const _0x689ed7=a42_0x438f6d;try{console[_0x689ed7(0xa8)](_0x689ed7(0x16d));const _0x1c0a70=await database_1[_0x689ed7(0xc7)][_0x689ed7(0xf2)]['findMany']({'where':{'gateway':{'in':[_0x689ed7(0x7f),_0x689ed7(0xef)]},'status':'PENDING','gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x689ed7(0xa8)]('ü™ô\x20[GLOBAL]\x20Found\x20'+_0x1c0a70[_0x689ed7(0x125)]+_0x689ed7(0x157));if(_0x1c0a70['length']===0x0){console[_0x689ed7(0xa8)](_0x689ed7(0x147));return;}const _0x53e0be=await this['checkExpiredPayments'](_0x1c0a70);console[_0x689ed7(0xa8)](_0x689ed7(0x8a)+_0x53e0be[_0x689ed7(0x125)]+'\x20expired\x20CoinToPay\x20payments');let _0x4757cd=0x0,_0x19dad0=0x0;for(const _0x24b769 of _0x1c0a70){try{if(_0x53e0be[_0x689ed7(0x165)](_0x24b769['id'])){console[_0x689ed7(0xa8)]('‚è∞\x20[GLOBAL]\x20Payment\x20'+_0x24b769['id']+_0x689ed7(0xa7)),_0x19dad0++;continue;}if(this['paymentTimers'][_0x689ed7(0x7c)](_0x24b769['id'])){console[_0x689ed7(0xa8)]('‚è∞\x20[GLOBAL]\x20Payment\x20'+_0x24b769['id']+'\x20has\x20individual\x20timers,\x20skipping\x20global\x20check'),_0x19dad0++;continue;}const _0xf69f43=(Date['now']()-_0x24b769['createdAt']['getTime']())/(0x3e8*0x3c*0x3c);if(_0xf69f43<0x1){console[_0x689ed7(0xa8)](_0x689ed7(0xf7)+_0x24b769['id']+_0x689ed7(0x113)+_0xf69f43[_0x689ed7(0x133)](0x1)+_0x689ed7(0x184)),_0x19dad0++;continue;}console[_0x689ed7(0xa8)](_0x689ed7(0x16b)+_0x24b769['id']+_0x689ed7(0x13c)+_0xf69f43['toFixed'](0x1)+'h)'),await this[_0x689ed7(0x144)](_0x24b769),_0x4757cd++,await new Promise(_0x4ec8c1=>setTimeout(_0x4ec8c1,0x7d0));}catch(_0x4ac744){console[_0x689ed7(0xed)]('‚ùå\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20'+_0x24b769['id']+':',_0x4ac744),this[_0x689ed7(0x181)](_0x24b769['id'],_0x24b769['gatewayPaymentId']||_0x689ed7(0x105),_0x4ac744,'status_check',{'isGlobalCheck':!![],'paymentAmount':_0x24b769[_0x689ed7(0x100)],'paymentCurrency':_0x24b769['currency'],'shopId':_0x24b769[_0x689ed7(0xa2)],'createdAt':_0x24b769[_0x689ed7(0xe6)]}),loggerService_1['loggerService']['logWhiteDomainError'](_0x689ed7(0x7f),_0x689ed7(0x153)+_0x24b769['gatewayPaymentId'],_0x4ac744);}}console[_0x689ed7(0xa8)](_0x689ed7(0xb6)+_0x4757cd+_0x689ed7(0x163)+_0x19dad0+_0x689ed7(0x14d)+_0x53e0be[_0x689ed7(0x125)]+'\x20expired');}catch(_0xd970bd){console[_0x689ed7(0xed)](_0x689ed7(0xee),_0xd970bd);}}async[a42_0x438f6d(0xa0)](_0x573250){const _0x181ec2=a42_0x438f6d,_0x499ccc=[],_0x20bf3e=new Date();_0x20bf3e['setDate'](_0x20bf3e[_0x181ec2(0x18c)]()-this[_0x181ec2(0xaf)]),console[_0x181ec2(0xa8)](_0x181ec2(0x90)+this['EXPIRY_DAYS']+_0x181ec2(0xc1)+_0x20bf3e[_0x181ec2(0x87)]()+')');for(const _0x5d4cb3 of _0x573250){if(_0x5d4cb3[_0x181ec2(0xe6)]<_0x20bf3e){console[_0x181ec2(0xa8)](_0x181ec2(0x115)+_0x5d4cb3['id']+_0x181ec2(0x142)+this['EXPIRY_DAYS']+_0x181ec2(0xa6));try{this[_0x181ec2(0x12f)](_0x5d4cb3['id'],_0x5d4cb3[_0x181ec2(0xd3)]||_0x181ec2(0x105),_0x181ec2(0x10b),_0x181ec2(0x124),_0x181ec2(0xd6),{'reason':_0x181ec2(0x131)+this[_0x181ec2(0xaf)]+'\x20days','createdAt':_0x5d4cb3[_0x181ec2(0xe6)],'daysSinceCreation':Math[_0x181ec2(0x120)]((Date['now']()-_0x5d4cb3['createdAt'][_0x181ec2(0x168)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x5d4cb3['amount'],'paymentCurrency':_0x5d4cb3[_0x181ec2(0x123)],'shopId':_0x5d4cb3[_0x181ec2(0xa2)]}),await database_1['default'][_0x181ec2(0xf2)]['update']({'where':{'id':_0x5d4cb3['id']},'data':{'status':_0x181ec2(0x124),'updatedAt':new Date()}}),await database_1[_0x181ec2(0xc7)][_0x181ec2(0x155)][_0x181ec2(0xce)]({'data':{'paymentId':_0x5d4cb3['id'],'shopId':_0x5d4cb3[_0x181ec2(0xa2)],'event':'cointopay_auto_expired','statusCode':0xc8,'responseBody':JSON['stringify']({'reason':_0x181ec2(0x131)+this[_0x181ec2(0xaf)]+_0x181ec2(0x17c),'createdAt':_0x5d4cb3['createdAt'],'expiredAt':new Date()[_0x181ec2(0x87)](),'daysSinceCreation':Math['floor']((Date[_0x181ec2(0xfb)]()-_0x5d4cb3['createdAt'][_0x181ec2(0x168)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this['sendShopWebhook'](_0x5d4cb3,_0x181ec2(0x124)),await this[_0x181ec2(0x91)](_0x5d4cb3,'EXPIRED'),this[_0x181ec2(0xe5)](_0x5d4cb3['id']),_0x499ccc['push'](_0x5d4cb3['id']),console[_0x181ec2(0xa8)](_0x181ec2(0x127)+_0x5d4cb3['id']+_0x181ec2(0x177)+this[_0x181ec2(0xaf)]+'-day\x20timeout');}catch(_0x4b8a05){console[_0x181ec2(0xed)]('‚ùå\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20'+_0x5d4cb3['id']+':',_0x4b8a05),this['logCoinToPayError'](_0x5d4cb3['id'],_0x5d4cb3[_0x181ec2(0xd3)]||_0x181ec2(0x105),_0x4b8a05,_0x181ec2(0xd6),{'reason':_0x181ec2(0x101),'createdAt':_0x5d4cb3[_0x181ec2(0xe6)],'daysSinceCreation':Math['floor']((Date[_0x181ec2(0xfb)]()-_0x5d4cb3[_0x181ec2(0xe6)]['getTime']())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x499ccc;}async[a42_0x438f6d(0x144)](_0x171d83){const _0x7b9d02=a42_0x438f6d;if(!_0x171d83[_0x7b9d02(0xd3)]){console['log'](_0x7b9d02(0x79)+_0x171d83['id']+_0x7b9d02(0x8e));return;}console[_0x7b9d02(0xa8)](_0x7b9d02(0xf0)+_0x171d83[_0x7b9d02(0xb5)]+_0x7b9d02(0x110)+_0x171d83['id']+'\x20('+_0x171d83[_0x7b9d02(0xd3)]+')');try{let _0x275685;_0x171d83[_0x7b9d02(0xb5)]===_0x7b9d02(0xef)?(_0x275685=await this[_0x7b9d02(0xe4)]['checkPaymentStatus'](_0x171d83[_0x7b9d02(0xd3)]),console[_0x7b9d02(0xa8)](_0x7b9d02(0x12d)+_0x171d83['id']+_0x7b9d02(0x8c)+_0x275685['status'])):(_0x275685=await this[_0x7b9d02(0x114)][_0x7b9d02(0x18a)](_0x171d83[_0x7b9d02(0xd3)]),console[_0x7b9d02(0xa8)](_0x7b9d02(0x13d)+_0x171d83['id']+_0x7b9d02(0x8c)+_0x275685[_0x7b9d02(0x179)]));_0x275685[_0x7b9d02(0xea)]&&console['log'](_0x7b9d02(0x135)+_0x171d83['id']+'\x20details:',{'iban':_0x275685['paymentDetails'][_0x7b9d02(0x12a)]||_0x7b9d02(0x186),'transactionId':_0x275685['paymentDetails']['transactionId'],'createdOn':_0x275685[_0x7b9d02(0xea)]['createdOn'],'confirmedOn':_0x275685['paymentDetails'][_0x7b9d02(0x17f)]||_0x7b9d02(0xfe)});if(_0x275685[_0x7b9d02(0x179)]!==_0x171d83['status']){console[_0x7b9d02(0xa8)]('üîÑ\x20[CHECK]\x20Updating\x20payment\x20'+_0x171d83['id']+_0x7b9d02(0x170)+_0x171d83[_0x7b9d02(0x179)]+_0x7b9d02(0xc4)+_0x275685[_0x7b9d02(0x179)]),this[_0x7b9d02(0x12f)](_0x171d83['id'],_0x171d83[_0x7b9d02(0xd3)],_0x171d83[_0x7b9d02(0x179)],_0x275685[_0x7b9d02(0x179)],_0x7b9d02(0xf6),{'paymentDetails':_0x275685[_0x7b9d02(0xea)],'amount':_0x275685[_0x7b9d02(0x100)],'currency':_0x275685[_0x7b9d02(0x123)],'shopId':_0x171d83[_0x7b9d02(0xa2)],'checkTimestamp':new Date()[_0x7b9d02(0x87)]()});const _0x891813={'status':_0x275685[_0x7b9d02(0x179)],'updatedAt':new Date()};if(_0x275685[_0x7b9d02(0x179)]===_0x7b9d02(0x173)&&_0x171d83[_0x7b9d02(0x179)]!=='PAID'){_0x891813[_0x7b9d02(0x128)]=new Date();if(!_0x171d83[_0x7b9d02(0x111)]){const _0x120db5=await currencyService_1[_0x7b9d02(0x14c)][_0x7b9d02(0x95)](_0x171d83[_0x7b9d02(0x100)],_0x171d83[_0x7b9d02(0x123)]);_0x891813[_0x7b9d02(0x111)]=_0x120db5;const _0x334a22=await this[_0x7b9d02(0x175)](_0x171d83[_0x7b9d02(0xa2)],_0x171d83[_0x7b9d02(0xb5)]),_0x1c174f=_0x120db5*(0x1-_0x334a22/0x64);_0x891813[_0x7b9d02(0x103)]=_0x1c174f,_0x891813[_0x7b9d02(0x171)]=_0x334a22,console[_0x7b9d02(0xa8)](_0x7b9d02(0x14f)+_0x171d83['id']+'\x20amounts\x20calculated:'),console['log']('\x20\x20\x20Amount:\x20'+_0x171d83['amount']+'\x20'+_0x171d83[_0x7b9d02(0x123)]+_0x7b9d02(0xc5)+_0x120db5[_0x7b9d02(0x133)](0x6)+_0x7b9d02(0x15b)),console['log'](_0x7b9d02(0x18e)+_0x171d83[_0x7b9d02(0xb5)]+_0x7b9d02(0x83)+_0x334a22+'%'),console['log'](_0x7b9d02(0x158)+_0x1c174f[_0x7b9d02(0x133)](0x6)+_0x7b9d02(0x15b));}console[_0x7b9d02(0xa8)](_0x7b9d02(0x14f)+_0x171d83['id']+'\x20marked\x20as\x20paid\x20at:\x20'+_0x891813[_0x7b9d02(0x128)][_0x7b9d02(0x87)]());}if(_0x275685[_0x7b9d02(0xea)]){const _0x215546=_0x275685[_0x7b9d02(0xea)];_0x215546[_0x7b9d02(0x12a)]&&(_0x891813[_0x7b9d02(0xec)]=_0x215546[_0x7b9d02(0x12a)],console[_0x7b9d02(0xa8)]('üè¶\x20[CHECK]\x20Saved\x20IBAN:\x20'+_0x215546[_0x7b9d02(0x12a)])),_0x215546[_0x7b9d02(0xac)]&&console[_0x7b9d02(0xa8)](_0x7b9d02(0xe1)+_0x215546['bankDetails']),_0x215546['transactionId']&&console[_0x7b9d02(0xa8)](_0x7b9d02(0x12b)+_0x215546[_0x7b9d02(0x108)]),_0x215546[_0x7b9d02(0x17f)]&&console['log'](_0x7b9d02(0x172)+_0x215546[_0x7b9d02(0x17f)]);}await database_1[_0x7b9d02(0xc7)][_0x7b9d02(0xf2)]['update']({'where':{'id':_0x171d83['id']},'data':_0x891813});if(_0x275685['status']==='PAID'&&_0x171d83['status']!==_0x7b9d02(0x173)){console[_0x7b9d02(0xa8)]('üìà\x20[COINTOPAY]\x20Payment\x20'+_0x171d83['id']+_0x7b9d02(0x174));const _0x17d02e=await database_1[_0x7b9d02(0xc7)]['payment'][_0x7b9d02(0xfa)]({'where':{'id':_0x171d83['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x17d02e?.[_0x7b9d02(0x102)]&&_0x17d02e['paymentLink'])try{const _0x3c3641=_0x17d02e[_0x7b9d02(0x14b)];console[_0x7b9d02(0xa8)](_0x7b9d02(0x166)+_0x3c3641['id']+_0x7b9d02(0xd4)+_0x3c3641[_0x7b9d02(0x11c)]+_0x7b9d02(0x15c)+_0x3c3641[_0x7b9d02(0x94)]+_0x7b9d02(0xda)+_0x3c3641[_0x7b9d02(0x179)]);const _0x4ecb80=_0x3c3641[_0x7b9d02(0x94)]+0x1,_0x11363e=_0x3c3641['type']===_0x7b9d02(0xa3)?_0x7b9d02(0x86):_0x3c3641[_0x7b9d02(0x179)];await database_1[_0x7b9d02(0xc7)][_0x7b9d02(0x14b)][_0x7b9d02(0x17a)]({'where':{'id':_0x3c3641['id']},'data':{'currentPayments':_0x4ecb80,'status':_0x11363e,'updatedAt':new Date()}}),console[_0x7b9d02(0xa8)](_0x7b9d02(0x9f)+_0x3c3641['id']+'\x20updated:\x20currentPayments='+_0x3c3641[_0x7b9d02(0x94)]+_0x7b9d02(0xc5)+_0x4ecb80+_0x7b9d02(0xda)+_0x3c3641[_0x7b9d02(0x179)]+_0x7b9d02(0xc5)+_0x11363e);}catch(_0x52d9e1){console[_0x7b9d02(0xed)](_0x7b9d02(0x182),_0x52d9e1);}else console[_0x7b9d02(0xa8)](_0x7b9d02(0x159)+_0x171d83['id']+_0x7b9d02(0xc3));}await database_1['default'][_0x7b9d02(0x155)]['create']({'data':{'paymentId':_0x171d83['id'],'shopId':_0x171d83['shopId'],'event':_0x7b9d02(0xa9)+_0x275685[_0x7b9d02(0x179)][_0x7b9d02(0x15d)](),'statusCode':0xc8,'responseBody':JSON['stringify']({'oldStatus':_0x171d83['status'],'newStatus':_0x275685[_0x7b9d02(0x179)],'paymentDetails':_0x275685[_0x7b9d02(0xea)],'checkedAt':new Date()[_0x7b9d02(0x87)]()})}}),await this[_0x7b9d02(0x9b)](_0x171d83,_0x275685[_0x7b9d02(0x179)]),await this[_0x7b9d02(0x91)](_0x171d83,_0x275685[_0x7b9d02(0x179)]),_0x275685[_0x7b9d02(0x179)]!==_0x7b9d02(0x10b)&&(console['log'](_0x7b9d02(0x160)+_0x171d83['id']+_0x7b9d02(0x85)+_0x275685[_0x7b9d02(0x179)]+_0x7b9d02(0xcf)),this[_0x7b9d02(0xe5)](_0x171d83['id'])),console['log'](_0x7b9d02(0xd1)+_0x171d83['id']+_0x7b9d02(0xdb));}else console[_0x7b9d02(0xa8)]('üìä\x20[CHECK]\x20Payment\x20'+_0x171d83['id']+_0x7b9d02(0xb8)+_0x275685[_0x7b9d02(0x179)]+')'),this['logCoinToPayStatus'](_0x171d83['id'],_0x171d83[_0x7b9d02(0xd3)],_0x171d83[_0x7b9d02(0x179)],_0x275685[_0x7b9d02(0x179)],'status_check',{'statusUnchanged':!![],'paymentDetails':_0x275685[_0x7b9d02(0xea)],'amount':_0x275685['amount'],'currency':_0x275685[_0x7b9d02(0x123)],'shopId':_0x171d83[_0x7b9d02(0xa2)],'checkTimestamp':new Date()[_0x7b9d02(0x87)]()});}catch(_0x192b4c){console[_0x7b9d02(0xed)](_0x7b9d02(0x17e)+_0x171d83['id']+':',_0x192b4c),this['logCoinToPayError'](_0x171d83['id'],_0x171d83[_0x7b9d02(0xd3)],_0x192b4c,_0x7b9d02(0xf6),{'paymentAmount':_0x171d83[_0x7b9d02(0x100)],'paymentCurrency':_0x171d83['currency'],'shopId':_0x171d83[_0x7b9d02(0xa2)],'createdAt':_0x171d83[_0x7b9d02(0xe6)]}),await database_1['default']['webhookLog'][_0x7b9d02(0xce)]({'data':{'paymentId':_0x171d83['id'],'shopId':_0x171d83[_0x7b9d02(0xa2)],'event':_0x7b9d02(0x8b),'statusCode':0x1f4,'responseBody':JSON['stringify']({'error':_0x192b4c instanceof Error?_0x192b4c[_0x7b9d02(0x117)]:_0x7b9d02(0xf3),'gatewayPaymentId':_0x171d83[_0x7b9d02(0xd3)],'checkedAt':new Date()[_0x7b9d02(0x87)]()})}});}}async[a42_0x438f6d(0x9b)](_0x223639,_0x17aa1e){const _0x4c2884=a42_0x438f6d,_0x2ba335=Date[_0x4c2884(0xfb)]();try{const _0x93060a=_0x223639[_0x4c2884(0xf4)],_0xf83fe=_0x93060a[_0x4c2884(0xf9)];if(!_0xf83fe?.[_0x4c2884(0xbf)]){console[_0x4c2884(0xa8)](_0x4c2884(0x119)+_0x93060a['id']);return;}const _0x3fa220=_0x17aa1e===_0x4c2884(0x173)?_0x4c2884(0x154):_0x17aa1e==='FAILED'?'payment.failed':_0x17aa1e===_0x4c2884(0x124)?_0x4c2884(0x96):_0x4c2884(0xde);if(!_0xf83fe[_0x4c2884(0x76)]?.[_0x4c2884(0x165)](_0x3fa220)){console[_0x4c2884(0xa8)](_0x4c2884(0x8f)+_0x3fa220+_0x4c2884(0x116)+_0x93060a['id']);return;}const _0x6beab4=(0x0,gateway_1[_0x4c2884(0x141)])(_0x223639[_0x4c2884(0xb5)])||_0x223639[_0x4c2884(0xb5)],_0x1985f3={'event':_0x3fa220,'payment':{'id':_0x223639['id'],'order_id':_0x223639[_0x4c2884(0x107)],'gateway_order_id':_0x223639['gatewayOrderId'],'gateway':_0x6beab4,'amount':_0x223639[_0x4c2884(0x100)],'currency':_0x223639['currency'],'status':_0x17aa1e['toLowerCase'](),'customer_email':_0x223639[_0x4c2884(0xcd)],'customer_name':_0x223639['customerName'],'created_at':_0x223639['createdAt'],'updated_at':new Date()}},_0x1d2287=await fetch(_0xf83fe[_0x4c2884(0xbf)],{'method':_0x4c2884(0xa5),'headers':{'Content-Type':_0x4c2884(0xc8),'User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x4c2884(0x129)](_0x1985f3)}),_0x12c9f0=Date['now']()-_0x2ba335,_0x11a754=_0x1d2287['ok']?'Success':await _0x1d2287[_0x4c2884(0x138)]();loggerService_1['loggerService'][_0x4c2884(0xeb)](_0x223639['shopId'],_0xf83fe[_0x4c2884(0xbf)],_0x3fa220,_0x1d2287[_0x4c2884(0x179)],_0x12c9f0,_0x1985f3),console[_0x4c2884(0xa8)](_0x4c2884(0x82)+_0xf83fe[_0x4c2884(0xbf)]+_0x4c2884(0xe2)+_0x1d2287[_0x4c2884(0x179)]+'\x20('+_0x12c9f0+_0x4c2884(0xd2));}catch(_0x3f9fe8){console[_0x4c2884(0xed)](_0x4c2884(0xd9),_0x3f9fe8),loggerService_1[_0x4c2884(0x9a)]['logShopWebhookError'](_0x223639[_0x4c2884(0xa2)],_0x223639[_0x4c2884(0xf4)]?.['settings']?.[_0x4c2884(0xbf)]||_0x4c2884(0x105),_0x4c2884(0x12e),_0x3f9fe8,{});}}async[a42_0x438f6d(0x91)](_0x4f942d,_0x3dd83a){const _0x4a1d3f=a42_0x438f6d;try{const _0x2c4bb5={'PENDING':'created','PAID':_0x4a1d3f(0xd0),'FAILED':_0x4a1d3f(0x151),'EXPIRED':_0x4a1d3f(0x156)},_0x9293a5=_0x2c4bb5[_0x3dd83a];if(!_0x9293a5||_0x9293a5===_0x4a1d3f(0x11f))return;await telegramBotService_1[_0x4a1d3f(0x189)]['sendPaymentNotification'](_0x4f942d[_0x4a1d3f(0xa2)],_0x4f942d,_0x9293a5);}catch(_0x27c807){console[_0x4a1d3f(0xed)](_0x4a1d3f(0xd7),_0x27c807);}}async[a42_0x438f6d(0x109)](_0x1a3486){const _0x5e564c=a42_0x438f6d;console[_0x5e564c(0xa8)](_0x5e564c(0x97)+_0x1a3486);const _0x1c4409=await database_1[_0x5e564c(0xc7)]['payment'][_0x5e564c(0xfa)]({'where':{'id':_0x1a3486},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x1c4409)throw new Error(_0x5e564c(0x185));if(_0x1c4409['gateway']!==_0x5e564c(0x7f)&&_0x1c4409['gateway']!==_0x5e564c(0xef))throw new Error(_0x5e564c(0xe8));console[_0x5e564c(0xa8)](_0x5e564c(0x10a)+_0x1c4409['gateway']+'\x20payment\x20'+_0x1a3486),await this[_0x5e564c(0x144)](_0x1c4409),console[_0x5e564c(0xa8)](_0x5e564c(0x11a)+_0x1a3486);}[a42_0x438f6d(0xab)](){const _0x3e23c5=a42_0x438f6d,_0x2d3081=this[_0x3e23c5(0x84)]?this[_0x3e23c5(0x164)]:undefined,_0x1449a2=Array[_0x3e23c5(0x7d)](this[_0x3e23c5(0x150)][_0x3e23c5(0xb7)]())[_0x3e23c5(0x126)](_0x11a956=>({'paymentId':_0x11a956[_0x3e23c5(0xbe)],'gatewayPaymentId':_0x11a956[_0x3e23c5(0xd3)],'createdAt':_0x11a956[_0x3e23c5(0xe6)],'timersCount':_0x11a956['timers']['length']}));return{'isActive':!!this[_0x3e23c5(0x84)],'globalCheckIntervalMinutes':this[_0x3e23c5(0x164)]/(0x3e8*0x3c),'expiryDays':this[_0x3e23c5(0xaf)],'activeIndividualTimers':this[_0x3e23c5(0x150)][_0x3e23c5(0x145)],'nextGlobalCheckIn':_0x2d3081,'paymentTimersDetails':_0x1449a2};}[a42_0x438f6d(0xf5)](_0xe6798){const _0x1dd7cc=a42_0x438f6d,_0x170ee1=this['paymentTimers'][_0x1dd7cc(0xb4)](_0xe6798);if(_0x170ee1)return{'hasTimers':!![],'timersCount':_0x170ee1[_0x1dd7cc(0x11e)][_0x1dd7cc(0x125)],'createdAt':_0x170ee1[_0x1dd7cc(0xe6)],'gatewayPaymentId':_0x170ee1['gatewayPaymentId']};return{'hasTimers':![]};}async['getGatewayCommission'](_0x5e4541,_0x1b86d4){const _0x2d7750=a42_0x438f6d;try{const _0x4c7309=await database_1[_0x2d7750(0xc7)][_0x2d7750(0xf4)][_0x2d7750(0xfa)]({'where':{'id':_0x5e4541},'select':{'gatewaySettings':!![]}});if(!_0x4c7309?.[_0x2d7750(0x9c)])return console[_0x2d7750(0xa8)]('No\x20gateway\x20settings\x20found\x20for\x20shop\x20'+_0x5e4541+_0x2d7750(0xfc)),0xa;const _0x26c716=JSON[_0x2d7750(0x15f)](_0x4c7309[_0x2d7750(0x9c)]);for(const [_0x2b044e,_0x14c7ca]of Object[_0x2d7750(0xd5)](_0x26c716)){if(_0x2b044e[_0x2d7750(0x15d)]()===_0x1b86d4[_0x2d7750(0x15d)]()){const _0x37c747=_0x14c7ca['commission']||0xa;return console[_0x2d7750(0xa8)](_0x2d7750(0x7e)+_0x1b86d4+_0x2d7750(0x98)+_0x5e4541+':\x20'+_0x37c747+'%'),_0x37c747;}}return console[_0x2d7750(0xa8)](_0x2d7750(0xc0)+_0x1b86d4+'\x20in\x20shop\x20'+_0x5e4541+',\x20using\x20default\x2010%'),0xa;}catch(_0x443572){return console['error']('Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20'+_0x5e4541+_0x2d7750(0x16a)+_0x1b86d4+':',_0x443572),0xa;}}}exports['CoinToPayStatusService']=CoinToPayStatusService,exports[a42_0x438f6d(0x92)]=new CoinToPayStatusService();