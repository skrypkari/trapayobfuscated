'use strict';const a57_0x13ae73=a57_0x4370;(function(_0x381c34,_0x55cdb5){const _0x5d6d35=a57_0x4370,_0x2de78e=_0x381c34();while(!![]){try{const _0x44aa84=-parseInt(_0x5d6d35(0x225))/0x1*(parseInt(_0x5d6d35(0x298))/0x2)+parseInt(_0x5d6d35(0x241))/0x3+parseInt(_0x5d6d35(0x246))/0x4+parseInt(_0x5d6d35(0x231))/0x5+-parseInt(_0x5d6d35(0x237))/0x6*(parseInt(_0x5d6d35(0x24b))/0x7)+parseInt(_0x5d6d35(0x20b))/0x8+-parseInt(_0x5d6d35(0x281))/0x9*(parseInt(_0x5d6d35(0x1a5))/0xa);if(_0x44aa84===_0x55cdb5)break;else _0x2de78e['push'](_0x2de78e['shift']());}catch(_0x54ca82){_0x2de78e['push'](_0x2de78e['shift']());}}}(a57_0x36ed,0x22ad5));function a57_0x36ed(){const _0x57f940=['paymentDetails','includes','\x20to\x20','‚ùå\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','error','\x20\x20\x20üìù\x20Details:','startPeriodicStatusCheck','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','/status/','iban','logShopWebhookSent','\x20status\x20from\x20','\x20->\x20','floor','\x20status\x20unchanged\x20(','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','\x20(age:\x20','‚ùå\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','logShopWebhookError','2MEqSCc','CoinToPayStatusService','\x20not\x20found\x20in\x20database','ü™ô\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','\x20\x20\x20-\x20Gateway:\x20','\x20in\x20','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','Unknown\x20error','webhookEvents','digest','has','payment.failed','653110HYHsyT','CoinToPay2Service','paidAt','‚ö†Ô∏è\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','üìä\x20[CHECK]\x20CoinToPay2\x20payment\x20','üìà\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','30SevmfZ','\x20updated:\x20currentPayments=','‚ùå\x20[HOURLY]\x20Payment\x20','‚úÖ\x20[DEBUG]\x20Successfully\x20scheduled\x20','findMany','\x20\x20\x20-\x20Status:\x20','shop','‚ùå\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','set','üìà\x20[COINTOPAY]\x20Payment\x20','471639qnwEmV','webhookLog','getDate','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','-day\x20timeout','880892uHjRyG','cointopay2','clearPaymentTimers','type','default','1834dnPXSS','./gateways/coinToPayService','\x20payment\x20','üí∞\x20[CHECK]\x20Payment\x20',',\x20clearing\x20individual\x20timers','EXPIRY_DAYS','PENDING','üßπ\x20[DEBUG]\x20Clearing\x20','‚ö†Ô∏è\x20[CHECK]\x20Payment\x20','failed','checkPaymentById','sha256','stringify','remitterIban','transactionId','defineProperty','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:',',\x20gateway\x20','schedule_created','forEach','\x20status\x20changed\x20to\x20','globalCheckInterval','amount','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','\x20is\x20valid\x20for\x20checking,\x20proceeding...','now','‚úÖ\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','checkSinglePayment',',\x20using\x20default\x20commission\x2010%','delay','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','‚ùå\x20[CHECK]\x20Payment\x20','from','\x20in\x20shop\x20','‚úÖ\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','auto_expire','coinToPayService','getGatewayCommission','h),\x20skipping\x20global\x20check',',\x20status=','‚úÖ\x20[CHECK]\x20Payment\x20','\x20days,\x20marking\x20as\x20EXPIRED','gatewayPaymentId','COINTOPAY_STATUS_CHANGE','schedulePaymentChecks','üîç\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','gatewaySettings','description','update','üõë\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','\x20found:','\x20commission:\x20','PAID','checkExpiredPayments','1026KlUyOg','No\x20specific\x20commission\x20found\x20for\x20gateway\x20','\x20skipped,\x20','./telegramBotService','‚ùå\x20[TIMER]\x20Failed\x20individual\x20check\x20#','\x20pending\x20CoinToPay\x20payments',',\x20currentPayments=','webhookUrl','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','ü™ô\x20[GLOBAL]\x20Found\x20','currency','\x20initial\x20timers\x20for\x20payment\x20',':\x20type=','amountUSDT','setDate','status','paymentLink','\x20\x20\x20Amount\x20after\x20commission:\x20','createdAt','\x20to\x20clear','sendPaymentNotification','\x20amounts\x20calculated:','cointopay_auto_expired','116474GATeHp','get','unknown','\x20marked\x20as\x20paid\x20at:\x20','\x20for\x20payment\x20','üÜî\x20[CHECK]\x20Transaction\x20ID:\x20','findUnique','GLOBAL_CHECK_INTERVAL_MS','‚úÖ\x20[TIMER]\x20Individual\x20check\x20#','ü™ô\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','getServiceStats','crypto','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','‚è∞\x20[EXPIRY]\x20Payment\x20','EXPIRED','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','POST','Payment\x20System/1.0','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','logCoinToPayError','expired','./currencyService','size','stopPeriodicStatusCheck','‚úÖ\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','getPaymentTimerInfo','COMPLETED','üìä\x20[CHECK]\x20Payment\x20','paymentLinkId','\x20days','cointopay_status_check_error','‚úÖ\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','\x20\x20\x20-\x20gatewayPaymentId:\x20','logWhiteDomainError','logCoinToPayStatus','37860ZNlNZM','\x20\x20\x20üìç\x20Source:\x20','create','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','parse','hex','paymentId','\x20days\x20(created\x20before\x20','sendPaymentStatusNotification','Webhook\x20event\x20','‚è∞\x20[GLOBAL]\x20Payment\x20','message','\x20USDT','webhook_send','paymentTimers','üîÑ\x20[CHECK]\x20Updating\x20payment\x20','\x20triggered\x20for\x20payment\x20',',\x20stopping\x20individual\x20checks','payment.success','coinToPay2Service','customerName','status_check','üè¶\x20[CHECK]\x20Bank\x20details\x20provided:\x20','ü™ô\x20[TIMER]\x20Individual\x20check\x20#',',\x20using\x20default\x2010%','loggerService','timestamp','\x20\x20\x20‚ùå\x20Error:\x20','settings','\x20expired\x20CoinToPay\x20payments','not\x20found','5\x20minutes','\x20checked,\x20','confirmedOn','coinToPayStatusService','currentPayments','cointopay','payment','bankDetails','payment.pending','convertToUSDT','toFixed','ü™ô\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','gateway','./gateways/coinToPay2Service','‚úÖ\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','sendShopWebhook','\x20status\x20is\x20','secretKey','\x20completed\x20for\x20payment\x20','ms)','checkPaymentStatus','push','\x20is\x20older\x20than\x20','gatewayCommissionRate','\x20\x20\x20-\x20ShopId:\x20','../config/database','Shop\x20webhook\x20sent\x20to\x20','‚úÖ\x20[COINTOPAY]\x20Payment\x20link\x20','\x20individual\x20payment\x20timers','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','getTime','‚úÖ\x20[EXPIRY]\x20Payment\x20','\x20\x20\x20-\x20paymentId:\x20','checkAllPendingPayments','ü™ô\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','\x20timers\x20for\x20payment\x20','\x20current\x20status:\x20','\x20commission\x20for\x20shop\x20','delete','‚è∞\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','\x20with\x20status\x20','./loggerService','Payment\x20older\x20than\x20','Payment\x20not\x20found','COINTOPAY_ERROR','created','2\x20minutes','üõë\x20[SHUTDOWN]\x20Cleared\x20','not\x20confirmed','‚è∞\x20[HOURLY]\x20Payment\x20','currencyService','\x20\x20\x20üìÖ\x20Time:\x20','timers','toISOString','‚è∞\x20[GLOBAL]\x20Found\x20','shopId','‚úÖ\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','createHmac','toLowerCase','üìä\x20[CHECK]\x20CoinToPay\x20payment\x20','‚ùå\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','__esModule','\x20updated\x20successfully','telegramBotService','cointopay_status_check_','log','__importDefault','map','length','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','checkSinglePaymentById','1466936aKlxbL','stack','‚ùå\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','\x20has\x20no\x20gatewayPaymentId,\x20skipping','üîç\x20[CHECK]\x20Checking\x20','text','ü™ô\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...'];a57_0x36ed=function(){return _0x57f940;};return a57_0x36ed();}var __importDefault=this&&this[a57_0x13ae73(0x206)]||function(_0x373ab8){const _0x5d11f9=a57_0x13ae73;return _0x373ab8&&_0x373ab8[_0x5d11f9(0x201)]?_0x373ab8:{'default':_0x373ab8};};function a57_0x4370(_0x47a662,_0x17e20e){_0x47a662=_0x47a662-0x1a5;const _0x36eda4=a57_0x36ed();let _0x43703f=_0x36eda4[_0x47a662];return _0x43703f;}Object[a57_0x13ae73(0x25a)](exports,a57_0x13ae73(0x201),{'value':!![]}),exports['coinToPayStatusService']=exports[a57_0x13ae73(0x226)]=void 0x0;const crypto_1=__importDefault(require(a57_0x13ae73(0x2a3))),coinToPayService_1=require(a57_0x13ae73(0x24c)),coinToPay2Service_1=require(a57_0x13ae73(0x1d1)),gateway_1=require('../types/gateway'),database_1=__importDefault(require(a57_0x13ae73(0x1dd))),telegramBotService_1=require(a57_0x13ae73(0x284)),loggerService_1=require(a57_0x13ae73(0x1ed)),currencyService_1=require(a57_0x13ae73(0x2ad));class CoinToPayStatusService{constructor(){const _0x238014=a57_0x13ae73;this['globalCheckInterval']=null,this[_0x238014(0x29f)]=0x3c*0x3c*0x3e8,this[_0x238014(0x250)]=0x5,this[_0x238014(0x1b3)]=new Map(),this[_0x238014(0x26f)]=new coinToPayService_1['CoinToPayService'](),this['coinToPay2Service']=new coinToPay2Service_1[(_0x238014(0x232))](),console['log'](_0x238014(0x1cf));}[a57_0x13ae73(0x277)](_0x166987,_0x34062b){const _0x5540a0=a57_0x13ae73;console[_0x5540a0(0x205)]('ü™ô\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:'),console[_0x5540a0(0x205)](_0x5540a0(0x1e4)+_0x166987),console[_0x5540a0(0x205)](_0x5540a0(0x2b8)+_0x34062b),this[_0x5540a0(0x248)](_0x166987);const _0x434863=[],_0x2aab01=new Date(),_0x3f3607=[{'delay':0x1*0x3c*0x3e8,'description':'1\x20minute'},{'delay':0x2*0x3c*0x3e8,'description':_0x5540a0(0x1f2)},{'delay':0x5*0x3c*0x3e8,'description':_0x5540a0(0x1c4)},{'delay':0x5*0x3c*0x3e8,'description':_0x5540a0(0x1c4)}];console[_0x5540a0(0x205)]('ü™ô\x20[DEBUG]\x20Creating\x20'+_0x3f3607['length']+_0x5540a0(0x28c)+_0x166987);let _0x37724b=0x0;_0x3f3607[_0x5540a0(0x25e)]((_0x334cde,_0x231ef3)=>{const _0x30477e=_0x5540a0;_0x37724b+=_0x334cde[_0x30477e(0x268)];const _0x4ccc53=setTimeout(async()=>{const _0x46e265=_0x30477e;console[_0x46e265(0x205)](_0x46e265(0x1bc)+(_0x231ef3+0x1)+_0x46e265(0x1b5)+_0x166987+'\x20(after\x20'+_0x334cde['description']+')');try{await this[_0x46e265(0x20a)](_0x166987),console[_0x46e265(0x205)](_0x46e265(0x2a0)+(_0x231ef3+0x1)+_0x46e265(0x1d6)+_0x166987);}catch(_0x1ab868){console[_0x46e265(0x216)](_0x46e265(0x285)+(_0x231ef3+0x1)+'\x20for\x20payment\x20'+_0x166987+':',_0x1ab868),this[_0x46e265(0x2ab)](_0x166987,_0x34062b,_0x1ab868,_0x46e265(0x1ba),{'checkNumber':_0x231ef3+0x1,'scheduledAfter':_0x334cde[_0x46e265(0x27a)],'isIndividualCheck':!![]});}},_0x37724b);_0x434863['push'](_0x4ccc53),console['log']('‚è∞\x20[DEBUG]\x20Scheduled\x20check\x20#'+(_0x231ef3+0x1)+_0x30477e(0x29c)+_0x166987+_0x30477e(0x22a)+_0x37724b/0x3e8+'\x20seconds\x20('+_0x334cde['description']+')');});const _0x1a5da2=setInterval(async()=>{const _0x2f1968=_0x5540a0;console['log'](_0x2f1968(0x2a1)+_0x166987);try{const _0x163f44=await database_1['default'][_0x2f1968(0x1ca)][_0x2f1968(0x29e)]({'where':{'id':_0x166987},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x163f44){console[_0x2f1968(0x205)](_0x2f1968(0x239)+_0x166987+'\x20not\x20found,\x20clearing\x20timers'),this[_0x2f1968(0x248)](_0x166987);return;}console[_0x2f1968(0x205)]('üìä\x20[HOURLY]\x20Payment\x20'+_0x166987+_0x2f1968(0x1e8)+_0x163f44[_0x2f1968(0x290)]);if(_0x163f44[_0x2f1968(0x290)]!=='PENDING'){console['log']('‚úÖ\x20[HOURLY]\x20Payment\x20'+_0x166987+_0x2f1968(0x1d4)+_0x163f44[_0x2f1968(0x290)]+',\x20stopping\x20individual\x20checks'),this[_0x2f1968(0x248)](_0x166987);return;}const _0x470962=Math['floor']((Date['now']()-_0x163f44['createdAt']['getTime']())/(0x3e8*0x3c*0x3c*0x18));if(_0x470962>=this[_0x2f1968(0x250)]){console['log'](_0x2f1968(0x1f5)+_0x166987+'\x20is\x20older\x20than\x20'+this[_0x2f1968(0x250)]+'\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check'),this[_0x2f1968(0x248)](_0x166987);return;}await this[_0x2f1968(0x20a)](_0x166987),console[_0x2f1968(0x205)](_0x2f1968(0x1fc)+_0x166987);}catch(_0x328bd5){console[_0x2f1968(0x216)](_0x2f1968(0x223)+_0x166987+':',_0x328bd5),this[_0x2f1968(0x2ab)](_0x166987,_0x34062b,_0x328bd5,_0x2f1968(0x1ba),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x434863[_0x5540a0(0x1d9)](_0x1a5da2),this[_0x5540a0(0x1b3)][_0x5540a0(0x23f)](_0x166987,{'timers':_0x434863,'paymentId':_0x166987,'gatewayPaymentId':_0x34062b,'createdAt':_0x2aab01}),console[_0x5540a0(0x205)](_0x5540a0(0x23a)+_0x3f3607['length']+_0x5540a0(0x1e1)+_0x166987),console[_0x5540a0(0x205)]('üìä\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20'+this[_0x5540a0(0x1b3)][_0x5540a0(0x2ae)]),this['logCoinToPayStatus'](_0x166987,_0x34062b,_0x5540a0(0x251),_0x5540a0(0x251),'status_check',{'action':_0x5540a0(0x25d),'scheduledChecks':_0x3f3607[_0x5540a0(0x208)],'firstCheckIn':_0x3f3607[0x0][_0x5540a0(0x268)]/0x3e8,'totalTimers':this[_0x5540a0(0x1b3)][_0x5540a0(0x2ae)]});}['clearPaymentTimers'](_0x24c363){const _0x53d9bb=a57_0x13ae73,_0x10bd2c=this['paymentTimers'][_0x53d9bb(0x299)](_0x24c363);_0x10bd2c?(console[_0x53d9bb(0x205)](_0x53d9bb(0x252)+_0x10bd2c[_0x53d9bb(0x1f8)]['length']+_0x53d9bb(0x1e7)+_0x24c363),_0x10bd2c[_0x53d9bb(0x1f8)][_0x53d9bb(0x25e)]((_0x51faa6,_0x2ceeb7)=>{_0x51faa6&&(clearTimeout(_0x51faa6),clearInterval(_0x51faa6),console['log']('üßπ\x20[DEBUG]\x20Cleared\x20timer\x20#'+(_0x2ceeb7+0x1)+'\x20for\x20payment\x20'+_0x24c363));}),this[_0x53d9bb(0x1b3)][_0x53d9bb(0x1ea)](_0x24c363),console[_0x53d9bb(0x205)](_0x53d9bb(0x1d2)+_0x24c363+'.\x20Remaining\x20active\x20timers:\x20'+this['paymentTimers'][_0x53d9bb(0x2ae)])):console['log'](_0x53d9bb(0x234)+_0x24c363+_0x53d9bb(0x294));}async[a57_0x13ae73(0x20a)](_0x7130eb){const _0x37ad33=a57_0x13ae73;console[_0x37ad33(0x205)](_0x37ad33(0x278)+_0x7130eb);const _0x530a43=await database_1['default'][_0x37ad33(0x1ca)][_0x37ad33(0x29e)]({'where':{'id':_0x7130eb},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x530a43){console[_0x37ad33(0x205)](_0x37ad33(0x26a)+_0x7130eb+_0x37ad33(0x227));return;}console[_0x37ad33(0x205)](_0x37ad33(0x2b3)+_0x7130eb+_0x37ad33(0x27d)),console[_0x37ad33(0x205)](_0x37ad33(0x229)+_0x530a43[_0x37ad33(0x1d0)]),console[_0x37ad33(0x205)](_0x37ad33(0x23c)+_0x530a43['status']),console[_0x37ad33(0x205)]('\x20\x20\x20-\x20GatewayPaymentId:\x20'+_0x530a43['gatewayPaymentId']),console[_0x37ad33(0x205)]('\x20\x20\x20-\x20Amount:\x20'+_0x530a43[_0x37ad33(0x261)]+'\x20'+_0x530a43[_0x37ad33(0x28b)]),console['log'](_0x37ad33(0x1dc)+_0x530a43[_0x37ad33(0x1fb)]);if(_0x530a43[_0x37ad33(0x1d0)]!=='cointopay'&&_0x530a43[_0x37ad33(0x1d0)]!==_0x37ad33(0x247)){console[_0x37ad33(0x205)](_0x37ad33(0x253)+_0x7130eb+_0x37ad33(0x22b)+_0x530a43[_0x37ad33(0x1d0)]+')');return;}if(_0x530a43[_0x37ad33(0x290)]!==_0x37ad33(0x251)){console['log'](_0x37ad33(0x253)+_0x7130eb+_0x37ad33(0x1d4)+_0x530a43[_0x37ad33(0x290)]+_0x37ad33(0x1b6)),this[_0x37ad33(0x248)](_0x7130eb);return;}if(!_0x530a43[_0x37ad33(0x275)]){console[_0x37ad33(0x205)](_0x37ad33(0x253)+_0x7130eb+'\x20has\x20no\x20gatewayPaymentId');return;}console['log'](_0x37ad33(0x273)+_0x7130eb+_0x37ad33(0x263)),await this[_0x37ad33(0x266)](_0x530a43);}[a57_0x13ae73(0x2ba)](_0x5b5253,_0x46c7ef,_0x116cf3,_0x5474ec,_0x12f81e,_0x87e2b2){const _0x333bbc=a57_0x13ae73,_0xc20e32={'type':_0x333bbc(0x276),'paymentId':_0x5b5253,'gatewayPaymentId':_0x46c7ef,'oldStatus':_0x116cf3,'newStatus':_0x5474ec,'source':_0x12f81e,'timestamp':new Date()[_0x333bbc(0x1f9)](),'details':_0x87e2b2||{}};loggerService_1[_0x333bbc(0x1be)][_0x333bbc(0x2ba)](_0xc20e32),console[_0x333bbc(0x205)](_0x333bbc(0x1e6)+_0x5b5253+'\x20('+_0x46c7ef+')'),console[_0x333bbc(0x205)]('\x20\x20\x20üìä\x20Status:\x20'+_0x116cf3+'\x20->\x20'+_0x5474ec),console['log']('\x20\x20\x20üìç\x20Source:\x20'+_0x12f81e),console['log'](_0x333bbc(0x1f7)+_0xc20e32['timestamp']),_0x87e2b2&&console[_0x333bbc(0x205)](_0x333bbc(0x217),_0x87e2b2);}[a57_0x13ae73(0x2ab)](_0x1c9902,_0x4f0ab7,_0x2a1d56,_0x54803f,_0x159d41){const _0x199072=a57_0x13ae73,_0x3f1261={'type':_0x199072(0x1f0),'paymentId':_0x1c9902,'gatewayPaymentId':_0x4f0ab7,'error':_0x2a1d56 instanceof Error?{'message':_0x2a1d56['message'],'stack':_0x2a1d56[_0x199072(0x20c)]}:_0x2a1d56,'source':_0x54803f,'timestamp':new Date()[_0x199072(0x1f9)](),'context':_0x159d41||{}};loggerService_1[_0x199072(0x1be)]['logCoinToPayError'](_0x3f1261),console[_0x199072(0x216)]('ü™ô\x20[ERROR]\x20CoinToPay\x20Error:\x20'+_0x1c9902+'\x20('+_0x4f0ab7+')'),console[_0x199072(0x216)](_0x199072(0x1c0)+(_0x2a1d56 instanceof Error?_0x2a1d56[_0x199072(0x1b0)]:_0x2a1d56)),console[_0x199072(0x216)](_0x199072(0x1a6)+_0x54803f),console[_0x199072(0x216)](_0x199072(0x1f7)+_0x3f1261[_0x199072(0x1bf)]),_0x159d41&&console[_0x199072(0x216)]('\x20\x20\x20üìù\x20Context:',_0x159d41);}[a57_0x13ae73(0x218)](){const _0x5eb43a=a57_0x13ae73;console['log']('ü™ô\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)'),this[_0x5eb43a(0x1e5)]()['catch'](_0x436d4a=>{const _0x236aad=_0x5eb43a;console['error'](_0x236aad(0x23e),_0x436d4a);}),this[_0x5eb43a(0x260)]=setInterval(async()=>{const _0xe226a0=_0x5eb43a;try{console[_0xe226a0(0x205)](_0xe226a0(0x228)),await this['checkAllPendingPayments'](),console['log']('‚úÖ\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed');}catch(_0x12e35e){console[_0xe226a0(0x216)](_0xe226a0(0x215),_0x12e35e);}},this[_0x5eb43a(0x29f)]),console[_0x5eb43a(0x205)](_0x5eb43a(0x265));}[a57_0x13ae73(0x2af)](){const _0x57f169=a57_0x13ae73;console['log']('üõë\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...');this[_0x57f169(0x260)]&&(clearInterval(this[_0x57f169(0x260)]),this[_0x57f169(0x260)]=null,console[_0x57f169(0x205)](_0x57f169(0x27c)));const _0x18fa2f=this[_0x57f169(0x1b3)][_0x57f169(0x2ae)];for(const [_0x6554f4]of this['paymentTimers']){this[_0x57f169(0x248)](_0x6554f4);}console['log'](_0x57f169(0x1f3)+_0x18fa2f+_0x57f169(0x1e0));}async['checkAllPendingPayments'](){const _0x54e9b5=a57_0x13ae73;try{console[_0x54e9b5(0x205)](_0x54e9b5(0x211));const _0x2fe3fd=await database_1['default'][_0x54e9b5(0x1ca)][_0x54e9b5(0x23b)]({'where':{'gateway':{'in':[_0x54e9b5(0x1c9),_0x54e9b5(0x247)]},'status':_0x54e9b5(0x251),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'secretKey':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x54e9b5(0x205)](_0x54e9b5(0x28a)+_0x2fe3fd[_0x54e9b5(0x208)]+_0x54e9b5(0x286));if(_0x2fe3fd[_0x54e9b5(0x208)]===0x0){console['log']('ü™ô\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check');return;}const _0x1668fe=await this[_0x54e9b5(0x280)](_0x2fe3fd);console['log'](_0x54e9b5(0x1fa)+_0x1668fe[_0x54e9b5(0x208)]+_0x54e9b5(0x1c2));let _0x52cc33=0x0,_0x312d8d=0x0;for(const _0x4f4696 of _0x2fe3fd){try{if(_0x1668fe[_0x54e9b5(0x213)](_0x4f4696['id'])){console[_0x54e9b5(0x205)](_0x54e9b5(0x1af)+_0x4f4696['id']+_0x54e9b5(0x244)),_0x312d8d++;continue;}if(this[_0x54e9b5(0x1b3)][_0x54e9b5(0x22f)](_0x4f4696['id'])){console[_0x54e9b5(0x205)]('‚è∞\x20[GLOBAL]\x20Payment\x20'+_0x4f4696['id']+_0x54e9b5(0x262)),_0x312d8d++;continue;}const _0x3299db=(Date[_0x54e9b5(0x264)]()-_0x4f4696[_0x54e9b5(0x293)][_0x54e9b5(0x1e2)]())/(0x3e8*0x3c*0x3c);if(_0x3299db<0x1){console[_0x54e9b5(0x205)](_0x54e9b5(0x1af)+_0x4f4696['id']+'\x20is\x20too\x20new\x20('+_0x3299db[_0x54e9b5(0x1ce)](0x1)+_0x54e9b5(0x271)),_0x312d8d++;continue;}console['log']('üîç\x20[GLOBAL]\x20Checking\x20old\x20payment\x20'+_0x4f4696['id']+_0x54e9b5(0x222)+_0x3299db[_0x54e9b5(0x1ce)](0x1)+'h)'),await this[_0x54e9b5(0x266)](_0x4f4696),_0x52cc33++,await new Promise(_0xd138ad=>setTimeout(_0xd138ad,0x7d0));}catch(_0x5c059c){console[_0x54e9b5(0x216)](_0x54e9b5(0x269)+_0x4f4696['id']+':',_0x5c059c),this[_0x54e9b5(0x2ab)](_0x4f4696['id'],_0x4f4696[_0x54e9b5(0x275)]||_0x54e9b5(0x29a),_0x5c059c,_0x54e9b5(0x1ba),{'isGlobalCheck':!![],'paymentAmount':_0x4f4696[_0x54e9b5(0x261)],'paymentCurrency':_0x4f4696[_0x54e9b5(0x28b)],'shopId':_0x4f4696['shopId'],'createdAt':_0x4f4696[_0x54e9b5(0x293)]}),loggerService_1[_0x54e9b5(0x1be)][_0x54e9b5(0x2b9)](_0x54e9b5(0x1c9),_0x54e9b5(0x21a)+_0x4f4696[_0x54e9b5(0x275)],_0x5c059c);}}console['log'](_0x54e9b5(0x289)+_0x52cc33+_0x54e9b5(0x1c5)+_0x312d8d+_0x54e9b5(0x283)+_0x1668fe['length']+'\x20expired');}catch(_0x2c0963){console[_0x54e9b5(0x216)](_0x54e9b5(0x25b),_0x2c0963);}}async[a57_0x13ae73(0x280)](_0x2f7760){const _0x451d9f=a57_0x13ae73,_0x59cf52=[],_0x2ca487=new Date();_0x2ca487[_0x451d9f(0x28f)](_0x2ca487[_0x451d9f(0x243)]()-this[_0x451d9f(0x250)]),console[_0x451d9f(0x205)](_0x451d9f(0x1eb)+this[_0x451d9f(0x250)]+_0x451d9f(0x1ac)+_0x2ca487['toISOString']()+')');for(const _0x1f59d6 of _0x2f7760){if(_0x1f59d6['createdAt']<_0x2ca487){console[_0x451d9f(0x205)](_0x451d9f(0x2a5)+_0x1f59d6['id']+_0x451d9f(0x1da)+this['EXPIRY_DAYS']+_0x451d9f(0x274));try{this[_0x451d9f(0x2ba)](_0x1f59d6['id'],_0x1f59d6['gatewayPaymentId']||_0x451d9f(0x29a),_0x451d9f(0x251),_0x451d9f(0x2a6),_0x451d9f(0x26e),{'reason':_0x451d9f(0x1ee)+this['EXPIRY_DAYS']+_0x451d9f(0x2b5),'createdAt':_0x1f59d6['createdAt'],'daysSinceCreation':Math['floor']((Date[_0x451d9f(0x264)]()-_0x1f59d6[_0x451d9f(0x293)][_0x451d9f(0x1e2)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x1f59d6['amount'],'paymentCurrency':_0x1f59d6['currency'],'shopId':_0x1f59d6[_0x451d9f(0x1fb)]}),await database_1[_0x451d9f(0x24a)][_0x451d9f(0x1ca)][_0x451d9f(0x27b)]({'where':{'id':_0x1f59d6['id']},'data':{'status':_0x451d9f(0x2a6),'updatedAt':new Date()}}),await database_1['default'][_0x451d9f(0x242)][_0x451d9f(0x1a7)]({'data':{'paymentId':_0x1f59d6['id'],'shopId':_0x1f59d6[_0x451d9f(0x1fb)],'event':_0x451d9f(0x297),'statusCode':0xc8,'responseBody':JSON[_0x451d9f(0x257)]({'reason':_0x451d9f(0x1ee)+this[_0x451d9f(0x250)]+'\x20days','createdAt':_0x1f59d6[_0x451d9f(0x293)],'expiredAt':new Date()[_0x451d9f(0x1f9)](),'daysSinceCreation':Math[_0x451d9f(0x21f)]((Date['now']()-_0x1f59d6[_0x451d9f(0x293)][_0x451d9f(0x1e2)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x451d9f(0x1d3)](_0x1f59d6,'EXPIRED'),await this[_0x451d9f(0x1ad)](_0x1f59d6,_0x451d9f(0x2a6)),this[_0x451d9f(0x248)](_0x1f59d6['id']),_0x59cf52[_0x451d9f(0x1d9)](_0x1f59d6['id']),console['log'](_0x451d9f(0x1e3)+_0x1f59d6['id']+_0x451d9f(0x2a7)+this[_0x451d9f(0x250)]+_0x451d9f(0x245));}catch(_0x5d30d5){console[_0x451d9f(0x216)](_0x451d9f(0x20d)+_0x1f59d6['id']+':',_0x5d30d5),this[_0x451d9f(0x2ab)](_0x1f59d6['id'],_0x1f59d6[_0x451d9f(0x275)]||_0x451d9f(0x29a),_0x5d30d5,_0x451d9f(0x26e),{'reason':'Failed\x20to\x20mark\x20payment\x20as\x20expired','createdAt':_0x1f59d6[_0x451d9f(0x293)],'daysSinceCreation':Math['floor']((Date[_0x451d9f(0x264)]()-_0x1f59d6[_0x451d9f(0x293)][_0x451d9f(0x1e2)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x59cf52;}async[a57_0x13ae73(0x266)](_0x25e76b){const _0x51e260=a57_0x13ae73;if(!_0x25e76b[_0x51e260(0x275)]){console[_0x51e260(0x205)](_0x51e260(0x253)+_0x25e76b['id']+_0x51e260(0x20e));return;}console[_0x51e260(0x205)](_0x51e260(0x20f)+_0x25e76b[_0x51e260(0x1d0)]+_0x51e260(0x24d)+_0x25e76b['id']+'\x20('+_0x25e76b[_0x51e260(0x275)]+')');try{let _0x253e64;_0x25e76b[_0x51e260(0x1d0)]===_0x51e260(0x247)?(_0x253e64=await this[_0x51e260(0x1b8)][_0x51e260(0x1d8)](_0x25e76b[_0x51e260(0x275)]),console[_0x51e260(0x205)](_0x51e260(0x235)+_0x25e76b['id']+'\x20status:\x20'+_0x253e64[_0x51e260(0x290)])):(_0x253e64=await this[_0x51e260(0x26f)][_0x51e260(0x1d8)](_0x25e76b['gatewayPaymentId']),console[_0x51e260(0x205)](_0x51e260(0x1ff)+_0x25e76b['id']+'\x20status:\x20'+_0x253e64['status']));_0x253e64[_0x51e260(0x212)]&&console[_0x51e260(0x205)](_0x51e260(0x2b3)+_0x25e76b['id']+'\x20details:',{'iban':_0x253e64[_0x51e260(0x212)][_0x51e260(0x21b)]||_0x51e260(0x1c3),'transactionId':_0x253e64[_0x51e260(0x212)][_0x51e260(0x259)],'createdOn':_0x253e64[_0x51e260(0x212)]['createdOn'],'confirmedOn':_0x253e64[_0x51e260(0x212)][_0x51e260(0x1c6)]||_0x51e260(0x1f4)});if(_0x253e64['status']!==_0x25e76b[_0x51e260(0x290)]){console[_0x51e260(0x205)](_0x51e260(0x1b4)+_0x25e76b['id']+_0x51e260(0x21d)+_0x25e76b['status']+_0x51e260(0x214)+_0x253e64[_0x51e260(0x290)]),this[_0x51e260(0x2ba)](_0x25e76b['id'],_0x25e76b['gatewayPaymentId'],_0x25e76b[_0x51e260(0x290)],_0x253e64[_0x51e260(0x290)],_0x51e260(0x1ba),{'paymentDetails':_0x253e64[_0x51e260(0x212)],'amount':_0x253e64[_0x51e260(0x261)],'currency':_0x253e64[_0x51e260(0x28b)],'shopId':_0x25e76b[_0x51e260(0x1fb)],'checkTimestamp':new Date()[_0x51e260(0x1f9)]()});const _0x6c76a4={'status':_0x253e64[_0x51e260(0x290)],'updatedAt':new Date()};if(_0x253e64['status']===_0x51e260(0x27f)&&_0x25e76b[_0x51e260(0x290)]!==_0x51e260(0x27f)){_0x6c76a4[_0x51e260(0x233)]=new Date();if(!_0x25e76b[_0x51e260(0x28e)]){const _0x2fdcd7=await currencyService_1[_0x51e260(0x1f6)][_0x51e260(0x1cd)](_0x25e76b[_0x51e260(0x261)],_0x25e76b[_0x51e260(0x28b)]);_0x6c76a4[_0x51e260(0x28e)]=_0x2fdcd7;const _0xe96e8b=await this[_0x51e260(0x270)](_0x25e76b[_0x51e260(0x1fb)],_0x25e76b['gateway']),_0xfb9cf4=_0x2fdcd7*(0x1-_0xe96e8b/0x64);_0x6c76a4['amountAfterGatewayCommissionUSDT']=_0xfb9cf4,_0x6c76a4[_0x51e260(0x1db)]=_0xe96e8b,console[_0x51e260(0x205)](_0x51e260(0x24e)+_0x25e76b['id']+_0x51e260(0x296)),console[_0x51e260(0x205)]('\x20\x20\x20Amount:\x20'+_0x25e76b['amount']+'\x20'+_0x25e76b[_0x51e260(0x28b)]+'\x20->\x20'+_0x2fdcd7['toFixed'](0x6)+_0x51e260(0x1b1)),console[_0x51e260(0x205)]('\x20\x20\x20Gateway\x20'+_0x25e76b[_0x51e260(0x1d0)]+_0x51e260(0x27e)+_0xe96e8b+'%'),console['log'](_0x51e260(0x292)+_0xfb9cf4[_0x51e260(0x1ce)](0x6)+_0x51e260(0x1b1));}console[_0x51e260(0x205)](_0x51e260(0x24e)+_0x25e76b['id']+_0x51e260(0x29b)+_0x6c76a4[_0x51e260(0x233)]['toISOString']());}if(_0x253e64[_0x51e260(0x212)]){const _0x4f7a66=_0x253e64[_0x51e260(0x212)];_0x4f7a66['iban']&&(_0x6c76a4[_0x51e260(0x258)]=_0x4f7a66['iban'],console[_0x51e260(0x205)]('üè¶\x20[CHECK]\x20Saved\x20IBAN:\x20'+_0x4f7a66[_0x51e260(0x21b)])),_0x4f7a66[_0x51e260(0x1cb)]&&console['log'](_0x51e260(0x1bb)+_0x4f7a66[_0x51e260(0x1cb)]),_0x4f7a66[_0x51e260(0x259)]&&console[_0x51e260(0x205)](_0x51e260(0x29d)+_0x4f7a66[_0x51e260(0x259)]),_0x4f7a66[_0x51e260(0x1c6)]&&console[_0x51e260(0x205)](_0x51e260(0x26d)+_0x4f7a66[_0x51e260(0x1c6)]);}await database_1[_0x51e260(0x24a)][_0x51e260(0x1ca)][_0x51e260(0x27b)]({'where':{'id':_0x25e76b['id']},'data':_0x6c76a4});if(_0x253e64['status']===_0x51e260(0x27f)&&_0x25e76b[_0x51e260(0x290)]!=='PAID'){console[_0x51e260(0x205)](_0x51e260(0x240)+_0x25e76b['id']+'\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link');const _0x18c68d=await database_1['default'][_0x51e260(0x1ca)]['findUnique']({'where':{'id':_0x25e76b['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x18c68d?.[_0x51e260(0x2b4)]&&_0x18c68d[_0x51e260(0x291)])try{const _0x403193=_0x18c68d['paymentLink'];console['log'](_0x51e260(0x236)+_0x403193['id']+_0x51e260(0x28d)+_0x403193[_0x51e260(0x249)]+_0x51e260(0x287)+_0x403193[_0x51e260(0x1c8)]+',\x20status='+_0x403193[_0x51e260(0x290)]);const _0x32a244=_0x403193[_0x51e260(0x1c8)]+0x1,_0x5820f0=_0x403193[_0x51e260(0x249)]==='SINGLE'?_0x51e260(0x2b2):_0x403193['status'];await database_1['default'][_0x51e260(0x291)][_0x51e260(0x27b)]({'where':{'id':_0x403193['id']},'data':{'currentPayments':_0x32a244,'status':_0x5820f0,'updatedAt':new Date()}}),console[_0x51e260(0x205)](_0x51e260(0x1df)+_0x403193['id']+_0x51e260(0x238)+_0x403193[_0x51e260(0x1c8)]+_0x51e260(0x21e)+_0x32a244+_0x51e260(0x272)+_0x403193[_0x51e260(0x290)]+_0x51e260(0x21e)+_0x5820f0);}catch(_0x5d2019){console[_0x51e260(0x216)](_0x51e260(0x200),_0x5d2019);}else console['log'](_0x51e260(0x240)+_0x25e76b['id']+_0x51e260(0x209));}await database_1['default'][_0x51e260(0x242)]['create']({'data':{'paymentId':_0x25e76b['id'],'shopId':_0x25e76b[_0x51e260(0x1fb)],'event':_0x51e260(0x204)+_0x253e64[_0x51e260(0x290)][_0x51e260(0x1fe)](),'statusCode':0xc8,'responseBody':JSON['stringify']({'oldStatus':_0x25e76b[_0x51e260(0x290)],'newStatus':_0x253e64['status'],'paymentDetails':_0x253e64[_0x51e260(0x212)],'checkedAt':new Date()[_0x51e260(0x1f9)]()})}}),await this['sendShopWebhook'](_0x25e76b,_0x253e64[_0x51e260(0x290)]),await this['sendPaymentStatusNotification'](_0x25e76b,_0x253e64['status']),_0x253e64['status']!=='PENDING'&&(console[_0x51e260(0x205)]('üßπ\x20[CHECK]\x20Payment\x20'+_0x25e76b['id']+_0x51e260(0x25f)+_0x253e64['status']+_0x51e260(0x24f)),this['clearPaymentTimers'](_0x25e76b['id'])),console[_0x51e260(0x205)](_0x51e260(0x273)+_0x25e76b['id']+_0x51e260(0x202));}else console[_0x51e260(0x205)](_0x51e260(0x2b3)+_0x25e76b['id']+_0x51e260(0x220)+_0x253e64[_0x51e260(0x290)]+')'),this[_0x51e260(0x2ba)](_0x25e76b['id'],_0x25e76b[_0x51e260(0x275)],_0x25e76b[_0x51e260(0x290)],_0x253e64['status'],_0x51e260(0x1ba),{'statusUnchanged':!![],'paymentDetails':_0x253e64[_0x51e260(0x212)],'amount':_0x253e64[_0x51e260(0x261)],'currency':_0x253e64[_0x51e260(0x28b)],'shopId':_0x25e76b[_0x51e260(0x1fb)],'checkTimestamp':new Date()['toISOString']()});}catch(_0x2f6c01){console[_0x51e260(0x216)]('‚ùå\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20'+_0x25e76b['id']+':',_0x2f6c01),this[_0x51e260(0x2ab)](_0x25e76b['id'],_0x25e76b[_0x51e260(0x275)],_0x2f6c01,_0x51e260(0x1ba),{'paymentAmount':_0x25e76b['amount'],'paymentCurrency':_0x25e76b[_0x51e260(0x28b)],'shopId':_0x25e76b[_0x51e260(0x1fb)],'createdAt':_0x25e76b['createdAt']}),await database_1[_0x51e260(0x24a)][_0x51e260(0x242)][_0x51e260(0x1a7)]({'data':{'paymentId':_0x25e76b['id'],'shopId':_0x25e76b[_0x51e260(0x1fb)],'event':_0x51e260(0x2b6),'statusCode':0x1f4,'responseBody':JSON[_0x51e260(0x257)]({'error':_0x2f6c01 instanceof Error?_0x2f6c01[_0x51e260(0x1b0)]:_0x51e260(0x22c),'gatewayPaymentId':_0x25e76b['gatewayPaymentId'],'checkedAt':new Date()[_0x51e260(0x1f9)]()})}});}}async[a57_0x13ae73(0x1d3)](_0x18fcc8,_0x38c139){const _0x26448d=a57_0x13ae73,_0x368904=Date[_0x26448d(0x264)]();try{const _0x15384d=_0x18fcc8[_0x26448d(0x23d)],_0x524955=_0x15384d['settings'];if(!_0x524955?.[_0x26448d(0x288)]){console[_0x26448d(0x205)](_0x26448d(0x2aa)+_0x15384d['id']);return;}const _0x2e0398=_0x38c139===_0x26448d(0x27f)?_0x26448d(0x1b7):_0x38c139==='FAILED'?_0x26448d(0x230):_0x38c139===_0x26448d(0x2a6)?_0x26448d(0x230):_0x26448d(0x1cc);if(!_0x524955[_0x26448d(0x22d)]?.['includes'](_0x2e0398)){console[_0x26448d(0x205)](_0x26448d(0x1ae)+_0x2e0398+'\x20not\x20enabled\x20for\x20shop\x20'+_0x15384d['id']);return;}const _0x398ef6=(0x0,gateway_1['getGatewayIdByName'])(_0x18fcc8[_0x26448d(0x1d0)])||_0x18fcc8[_0x26448d(0x1d0)],_0xa5a0de={'event':_0x2e0398,'payment':{'id':_0x18fcc8['id'],'order_id':_0x18fcc8['orderId'],'gateway_order_id':_0x18fcc8['gatewayOrderId'],'gateway':_0x398ef6,'amount':_0x18fcc8[_0x26448d(0x261)],'currency':_0x18fcc8[_0x26448d(0x28b)],'status':_0x38c139['toLowerCase'](),'customer_email':_0x18fcc8['customerEmail'],'customer_name':_0x18fcc8[_0x26448d(0x1b9)],'created_at':_0x18fcc8[_0x26448d(0x293)],'updated_at':new Date()}},_0x5ced69=JSON[_0x26448d(0x257)](_0xa5a0de),_0x894fac=crypto_1[_0x26448d(0x24a)][_0x26448d(0x1fd)](_0x26448d(0x256),_0x18fcc8[_0x26448d(0x23d)][_0x26448d(0x1d5)])[_0x26448d(0x27b)](_0x5ced69)[_0x26448d(0x22e)](_0x26448d(0x1aa)),_0x195dd2=await fetch(_0x524955['webhookUrl'],{'method':_0x26448d(0x2a8),'headers':{'Content-Type':'application/json','User-Agent':_0x26448d(0x2a9),'X-Webhook-Signature':_0x894fac},'body':_0x5ced69}),_0x5641f3=Date['now']()-_0x368904,_0x1397a0=_0x195dd2['ok']?'Success':await _0x195dd2[_0x26448d(0x210)]();loggerService_1[_0x26448d(0x1be)][_0x26448d(0x21c)](_0x18fcc8[_0x26448d(0x1fb)],_0x524955[_0x26448d(0x288)],_0x2e0398,_0x195dd2['status'],_0x5641f3,_0xa5a0de),console[_0x26448d(0x205)](_0x26448d(0x1de)+_0x524955[_0x26448d(0x288)]+_0x26448d(0x1ec)+_0x195dd2[_0x26448d(0x290)]+'\x20('+_0x5641f3+_0x26448d(0x1d7));}catch(_0x572de6){console[_0x26448d(0x216)]('Failed\x20to\x20send\x20shop\x20webhook:',_0x572de6),loggerService_1[_0x26448d(0x1be)][_0x26448d(0x224)](_0x18fcc8[_0x26448d(0x1fb)],_0x18fcc8[_0x26448d(0x23d)]?.[_0x26448d(0x1c1)]?.[_0x26448d(0x288)]||'unknown',_0x26448d(0x1b2),_0x572de6,{});}}async['sendPaymentStatusNotification'](_0x489e94,_0x38cb42){const _0x2b90f6=a57_0x13ae73;try{const _0x4bedc8={'PENDING':_0x2b90f6(0x1f1),'PAID':'paid','FAILED':_0x2b90f6(0x254),'EXPIRED':_0x2b90f6(0x2ac)},_0x4aaf06=_0x4bedc8[_0x38cb42];if(!_0x4aaf06||_0x4aaf06==='created')return;await telegramBotService_1[_0x2b90f6(0x203)][_0x2b90f6(0x295)](_0x489e94['shopId'],_0x489e94,_0x4aaf06);}catch(_0x40afc7){console[_0x2b90f6(0x216)](_0x2b90f6(0x1a8),_0x40afc7);}}async[a57_0x13ae73(0x255)](_0x411bad){const _0x15ed59=a57_0x13ae73;console[_0x15ed59(0x205)]('üîç\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20'+_0x411bad);const _0x4ff4fa=await database_1[_0x15ed59(0x24a)]['payment'][_0x15ed59(0x29e)]({'where':{'id':_0x411bad},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x4ff4fa)throw new Error(_0x15ed59(0x1ef));if(_0x4ff4fa[_0x15ed59(0x1d0)]!==_0x15ed59(0x1c9)&&_0x4ff4fa[_0x15ed59(0x1d0)]!=='cointopay2')throw new Error(_0x15ed59(0x219));console['log'](_0x15ed59(0x2b0)+_0x4ff4fa[_0x15ed59(0x1d0)]+_0x15ed59(0x24d)+_0x411bad),await this[_0x15ed59(0x266)](_0x4ff4fa),console['log'](_0x15ed59(0x2b7)+_0x411bad);}[a57_0x13ae73(0x2a2)](){const _0x140d25=a57_0x13ae73,_0x34e368=this['globalCheckInterval']?this[_0x140d25(0x29f)]:undefined,_0x2fefbd=Array[_0x140d25(0x26b)](this['paymentTimers']['values']())[_0x140d25(0x207)](_0x3ffce6=>({'paymentId':_0x3ffce6[_0x140d25(0x1ab)],'gatewayPaymentId':_0x3ffce6[_0x140d25(0x275)],'createdAt':_0x3ffce6[_0x140d25(0x293)],'timersCount':_0x3ffce6['timers'][_0x140d25(0x208)]}));return{'isActive':!!this[_0x140d25(0x260)],'globalCheckIntervalMinutes':this[_0x140d25(0x29f)]/(0x3e8*0x3c),'expiryDays':this[_0x140d25(0x250)],'activeIndividualTimers':this[_0x140d25(0x1b3)][_0x140d25(0x2ae)],'nextGlobalCheckIn':_0x34e368,'paymentTimersDetails':_0x2fefbd};}[a57_0x13ae73(0x2b1)](_0x36531d){const _0x3321dd=a57_0x13ae73,_0x334660=this[_0x3321dd(0x1b3)][_0x3321dd(0x299)](_0x36531d);if(_0x334660)return{'hasTimers':!![],'timersCount':_0x334660[_0x3321dd(0x1f8)]['length'],'createdAt':_0x334660['createdAt'],'gatewayPaymentId':_0x334660[_0x3321dd(0x275)]};return{'hasTimers':![]};}async[a57_0x13ae73(0x270)](_0x140475,_0x19e418){const _0x204a1c=a57_0x13ae73;try{const _0x282f46=await database_1[_0x204a1c(0x24a)][_0x204a1c(0x23d)]['findUnique']({'where':{'id':_0x140475},'select':{'gatewaySettings':!![]}});if(!_0x282f46?.[_0x204a1c(0x279)])return console['log'](_0x204a1c(0x2a4)+_0x140475+_0x204a1c(0x267)),0xa;const _0x8bb87f=JSON[_0x204a1c(0x1a9)](_0x282f46['gatewaySettings']);for(const [_0x78f8e,_0x3ea5ed]of Object['entries'](_0x8bb87f)){if(_0x78f8e[_0x204a1c(0x1fe)]()===_0x19e418[_0x204a1c(0x1fe)]()){const _0x2ef220=_0x3ea5ed['commission']||0xa;return console[_0x204a1c(0x205)]('Gateway\x20'+_0x19e418+_0x204a1c(0x1e9)+_0x140475+':\x20'+_0x2ef220+'%'),_0x2ef220;}}return console[_0x204a1c(0x205)](_0x204a1c(0x282)+_0x19e418+_0x204a1c(0x26c)+_0x140475+_0x204a1c(0x1bd)),0xa;}catch(_0xc46587){return console['error'](_0x204a1c(0x221)+_0x140475+_0x204a1c(0x25c)+_0x19e418+':',_0xc46587),0xa;}}}exports[a57_0x13ae73(0x226)]=CoinToPayStatusService,exports[a57_0x13ae73(0x1c7)]=new CoinToPayStatusService();