'use strict';function a48_0xc5d3(_0xea9920,_0x494fab){_0xea9920=_0xea9920-0x123;const _0x3ae0a5=a48_0x3ae0();let _0xc5d39b=_0x3ae0a5[_0xea9920];return _0xc5d39b;}const a48_0x526462=a48_0xc5d3;function a48_0x3ae0(){const _0x4559b0=['\x20updated\x20successfully','expired','\x20has\x20no\x20gatewayPaymentId','catch',',\x20clearing\x20individual\x20timers','ðŸª™\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','gatewayOrderId','\x20seconds\x20(','paymentLinkId','logShopWebhookError','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','â°\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','checkPaymentStatus','h),\x20skipping\x20global\x20check','webhookEvents','\x20not\x20found\x20in\x20database','\x20\x20\x20-\x20Gateway:\x20','â°\x20[EXPIRY]\x20Payment\x20','ðŸ“Š\x20[CHECK]\x20CoinToPay\x20payment\x20','getServiceStats','gateway','loggerService','floor','âœ…\x20[COINTOPAY]\x20Payment\x20link\x20','stringify','shopId','findUnique','toFixed','./currencyService','COINTOPAY_STATUS_CHANGE','ðŸ§¹\x20[DEBUG]\x20Clearing\x20','\x20->\x20','No\x20specific\x20commission\x20found\x20for\x20gateway\x20','iban','âœ…\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','transactionId','\x20\x20\x20ðŸ“…\x20Time:\x20','\x20updated:\x20currentPayments=','ðŸ“Š\x20[HOURLY]\x20Payment\x20','ðŸ›‘\x20[SHUTDOWN]\x20Cleared\x20','â°\x20[GLOBAL]\x20Found\x20','application/json','\x20\x20\x20ðŸ“\x20Source:\x20','auto_expire','ðŸ’°\x20[CHECK]\x20Payment\x20','description','ðŸ§¹\x20[DEBUG]\x20Cleared\x20timer\x20#','./loggerService','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','create','paid','ms)','checkSinglePaymentById','payment.success','\x20status\x20is\x20','2113830nwAUPN','ðŸ¦\x20[CHECK]\x20Bank\x20details\x20provided:\x20','globalCheckInterval','coinToPay2Service','\x20\x20\x20ðŸ“\x20Context:','\x20status\x20unchanged\x20(','\x20\x20\x20ðŸ“Š\x20Status:\x20','from','159304SMWPWC','728146RoVVEE','startPeriodicStatusCheck',':\x20type=','get','error','payment.failed','clearPaymentTimers','âš ï¸\x20[CHECK]\x20Payment\x20','cointopay_auto_expired','\x20not\x20enabled\x20for\x20shop\x20','\x20\x20\x20Amount:\x20','\x20(age:\x20','findMany','3736626XZNeAf','âŒ\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:',',\x20status=','\x20current\x20status:\x20','ðŸª™\x20[ERROR]\x20CoinToPay\x20Error:\x20','set','\x20triggered\x20for\x20payment\x20','logShopWebhookSent','stopPeriodicStatusCheck','cointopay','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','timestamp','currencyService','\x20status\x20changed\x20to\x20','amountAfterGatewayCommissionUSDT','telegramBotService','Payment\x20not\x20found','2\x20minutes','checkPaymentById','\x20\x20\x20âŒ\x20Error:\x20','âŒ\x20[TIMER]\x20Failed\x20individual\x20check\x20#','1643349bwxUrg','CoinToPay2Service','log','ðŸª™\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','\x20in\x20shop\x20','PAID','getGatewayIdByName','ðŸ“ˆ\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','sendShopWebhook','forEach','webhook_send','setDate','\x20\x20\x20Amount\x20after\x20commission:\x20','â°\x20[GLOBAL]\x20Payment\x20','settings','amount','\x20\x20\x20Gateway\x20','webhookLog','\x20has\x20no\x20gatewayPaymentId,\x20skipping','default','toISOString','orderId','webhookUrl','EXPIRY_DAYS','shop','type','\x20found:','âœ…\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','âœ…\x20[TIMER]\x20Individual\x20check\x20#','\x20not\x20found,\x20clearing\x20timers','paymentDetails','confirmedOn','\x20commission\x20for\x20shop\x20','âŒ\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','\x20individual\x20payment\x20timers','Shop\x20webhook\x20sent\x20to\x20','now','\x20to\x20clear',',\x20using\x20default\x2010%','/status/','\x20\x20\x20-\x20paymentId:\x20','âš ï¸\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','logCoinToPayStatus',',\x20stopping\x20individual\x20checks','gatewaySettings','currency','currentPayments','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','__esModule','Webhook\x20event\x20','CoinToPayService','ðŸª™\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','sendPaymentNotification','paymentLink','Failed\x20to\x20send\x20shop\x20webhook:','schedule_created','payment','EXPIRED','\x20pending\x20CoinToPay\x20payments','âœ…\x20[CHECK]\x20Payment\x20','../types/gateway','â°\x20[DEBUG]\x20Scheduled\x20check\x20#','SINGLE','âŒ\x20[HOURLY]\x20Payment\x20','âŒ\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','../config/database','â°\x20[HOURLY]\x20Payment\x20','length','\x20for\x20payment\x20','message','cointopay_status_check_','CoinToPayStatusService','âœ…\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','\x20initial\x20timers\x20for\x20payment\x20','ðŸª™\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','âœ…\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','cointopay2','parse','ðŸ†”\x20[CHECK]\x20Transaction\x20ID:\x20','1\x20minute','paidAt','ðŸ”\x20[CHECK]\x20Checking\x20','GLOBAL_CHECK_INTERVAL_MS','bankDetails','ðŸ”\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','push','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','ðŸ“Š\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20',',\x20using\x20default\x20commission\x2010%','\x20\x20\x20-\x20Status:\x20','remitterIban','getGatewayCommission','ðŸ“ˆ\x20[COINTOPAY]\x20Payment\x20','POST','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','Unknown\x20error','status_check','text','COMPLETED','âŒ\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','Payment\x20older\x20than\x20','\x20USDT','getPaymentTimerInfo','1390220zLlObq','coinToPayStatusService','ðŸª™\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','\x20details:','includes','coinToPayService','convertToUSDT','\x20\x20\x20-\x20ShopId:\x20','âŒ\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','ðŸª™\x20[TIMER]\x20Individual\x20check\x20#','\x20\x20\x20ðŸ“\x20Details:','./telegramBotService','âœ…\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','logWhiteDomainError','gatewayCommissionRate','update','values','\x20commission:\x20','\x20\x20\x20-\x20gatewayPaymentId:\x20','ðŸª™\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','.\x20Remaining\x20active\x20timers:\x20','\x20status:\x20','5\x20minutes','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','ðŸ§¹\x20[CHECK]\x20Payment\x20','./gateways/coinToPay2Service',',\x20gateway\x20','map','ðŸ“Š\x20[CHECK]\x20Payment\x20','âœ…\x20[EXPIRY]\x20Payment\x20','\x20is\x20older\x20than\x20','paymentTimers','ðŸ”\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','customerEmail','toLowerCase','created','size','ðŸ¦\x20[CHECK]\x20Saved\x20IBAN:\x20','14DgLLFg','defineProperty','checkSinglePayment','amountUSDT','\x20expired\x20CoinToPay\x20payments','\x20to\x20','\x20is\x20too\x20new\x20(','entries','\x20marked\x20as\x20paid\x20at:\x20','189840gpWjLA','âœ…\x20[DEBUG]\x20Successfully\x20scheduled\x20','âœ…\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','getTime','âœ…\x20[HOURLY]\x20Payment\x20','PENDING','\x20is\x20valid\x20for\x20checking,\x20proceeding...','\x20days','createdAt','logCoinToPayError','âœ…\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','__importDefault','status','schedulePaymentChecks',',\x20currentPayments=','âŒ\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','timers','getDate','unknown','\x20payment\x20','delay','gatewayPaymentId','checkAllPendingPayments','ðŸ›‘\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','sendPaymentStatusNotification','\x20skipped,\x20','\x20expired'];a48_0x3ae0=function(){return _0x4559b0;};return a48_0x3ae0();}(function(_0x268a36,_0x28e883){const _0x361001=a48_0xc5d3,_0x364f15=_0x268a36();while(!![]){try{const _0x56fdcd=parseInt(_0x361001(0x1a6))/0x1+-parseInt(_0x361001(0x202))/0x2+parseInt(_0x361001(0x224))/0x3+parseInt(_0x361001(0x176))/0x4+parseInt(_0x361001(0x1f9))/0x5+-parseInt(_0x361001(0x20f))/0x6+-parseInt(_0x361001(0x19d))/0x7*(parseInt(_0x361001(0x201))/0x8);if(_0x56fdcd===_0x28e883)break;else _0x364f15['push'](_0x364f15['shift']());}catch(_0x60a41f){_0x364f15['push'](_0x364f15['shift']());}}}(a48_0x3ae0,0x757fa));var __importDefault=this&&this[a48_0x526462(0x1b1)]||function(_0x57d2f1){const _0xf89482=a48_0x526462;return _0x57d2f1&&_0x57d2f1[_0xf89482(0x13f)]?_0x57d2f1:{'default':_0x57d2f1};};Object[a48_0x526462(0x19e)](exports,a48_0x526462(0x13f),{'value':!![]}),exports[a48_0x526462(0x177)]=exports['CoinToPayStatusService']=void 0x0;const coinToPayService_1=require('./gateways/coinToPayService'),coinToPay2Service_1=require(a48_0x526462(0x190)),gateway_1=require(a48_0x526462(0x14b)),database_1=__importDefault(require(a48_0x526462(0x150))),telegramBotService_1=require(a48_0x526462(0x181)),loggerService_1=require(a48_0x526462(0x1f1)),currencyService_1=require(a48_0x526462(0x1de));class CoinToPayStatusService{constructor(){const _0x2c6c53=a48_0x526462;this['globalCheckInterval']=null,this[_0x2c6c53(0x161)]=0x3c*0x3c*0x3e8,this[_0x2c6c53(0x126)]=0x5,this[_0x2c6c53(0x196)]=new Map(),this['coinToPayService']=new coinToPayService_1[(_0x2c6c53(0x141))](),this[_0x2c6c53(0x1fc)]=new coinToPay2Service_1[(_0x2c6c53(0x225))](),console[_0x2c6c53(0x226)](_0x2c6c53(0x142));}[a48_0x526462(0x1b3)](_0x4deb40,_0x3a7762){const _0x259c4f=a48_0x526462;console[_0x259c4f(0x226)]('ðŸª™\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:'),console[_0x259c4f(0x226)](_0x259c4f(0x137)+_0x4deb40),console[_0x259c4f(0x226)](_0x259c4f(0x188)+_0x3a7762),this[_0x259c4f(0x208)](_0x4deb40);const _0x40e036=[],_0x119116=new Date(),_0x3eee72=[{'delay':0x1*0x3c*0x3e8,'description':_0x259c4f(0x15e)},{'delay':0x2*0x3c*0x3e8,'description':_0x259c4f(0x220)},{'delay':0x5*0x3c*0x3e8,'description':'5\x20minutes'},{'delay':0x5*0x3c*0x3e8,'description':_0x259c4f(0x18d)}];console[_0x259c4f(0x226)]('ðŸª™\x20[DEBUG]\x20Creating\x20'+_0x3eee72[_0x259c4f(0x152)]+_0x259c4f(0x158)+_0x4deb40);let _0x3d7ab6=0x0;_0x3eee72[_0x259c4f(0x22e)]((_0x16d80d,_0x39bff2)=>{const _0x5e290a=_0x259c4f;_0x3d7ab6+=_0x16d80d['delay'];const _0x3f5504=setTimeout(async()=>{const _0x5a8ca7=a48_0xc5d3;console[_0x5a8ca7(0x226)](_0x5a8ca7(0x17f)+(_0x39bff2+0x1)+_0x5a8ca7(0x215)+_0x4deb40+'\x20(after\x20'+_0x16d80d[_0x5a8ca7(0x1ef)]+')');try{await this[_0x5a8ca7(0x1f6)](_0x4deb40),console[_0x5a8ca7(0x226)](_0x5a8ca7(0x12b)+(_0x39bff2+0x1)+'\x20completed\x20for\x20payment\x20'+_0x4deb40);}catch(_0xc08678){console[_0x5a8ca7(0x206)](_0x5a8ca7(0x223)+(_0x39bff2+0x1)+_0x5a8ca7(0x153)+_0x4deb40+':',_0xc08678),this[_0x5a8ca7(0x1af)](_0x4deb40,_0x3a7762,_0xc08678,'status_check',{'checkNumber':_0x39bff2+0x1,'scheduledAfter':_0x16d80d[_0x5a8ca7(0x1ef)],'isIndividualCheck':!![]});}},_0x3d7ab6);_0x40e036[_0x5e290a(0x164)](_0x3f5504),console['log'](_0x5e290a(0x14c)+(_0x39bff2+0x1)+'\x20for\x20payment\x20'+_0x4deb40+'\x20in\x20'+_0x3d7ab6/0x3e8+_0x5e290a(0x1c9)+_0x16d80d[_0x5e290a(0x1ef)]+')');});const _0x2941ff=setInterval(async()=>{const _0x261910=_0x259c4f;console[_0x261910(0x226)](_0x261910(0x189)+_0x4deb40);try{const _0x4c3a4c=await database_1[_0x261910(0x238)][_0x261910(0x147)]['findUnique']({'where':{'id':_0x4deb40},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x4c3a4c){console['log'](_0x261910(0x14e)+_0x4deb40+_0x261910(0x12c)),this[_0x261910(0x208)](_0x4deb40);return;}console[_0x261910(0x226)](_0x261910(0x1e8)+_0x4deb40+_0x261910(0x212)+_0x4c3a4c[_0x261910(0x1b2)]);if(_0x4c3a4c[_0x261910(0x1b2)]!==_0x261910(0x1ab)){console[_0x261910(0x226)](_0x261910(0x1aa)+_0x4deb40+_0x261910(0x1f8)+_0x4c3a4c[_0x261910(0x1b2)]+_0x261910(0x13a)),this[_0x261910(0x208)](_0x4deb40);return;}const _0x5d614e=Math[_0x261910(0x1d8)]((Date[_0x261910(0x133)]()-_0x4c3a4c[_0x261910(0x1ae)][_0x261910(0x1a9)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x5d614e>=this[_0x261910(0x126)]){console[_0x261910(0x226)](_0x261910(0x151)+_0x4deb40+'\x20is\x20older\x20than\x20'+this[_0x261910(0x126)]+_0x261910(0x1be)),this[_0x261910(0x208)](_0x4deb40);return;}await this[_0x261910(0x1f6)](_0x4deb40),console[_0x261910(0x226)](_0x261910(0x182)+_0x4deb40);}catch(_0x322a4f){console[_0x261910(0x206)](_0x261910(0x1b5)+_0x4deb40+':',_0x322a4f),this[_0x261910(0x1af)](_0x4deb40,_0x3a7762,_0x322a4f,_0x261910(0x16f),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x40e036[_0x259c4f(0x164)](_0x2941ff),this['paymentTimers'][_0x259c4f(0x214)](_0x4deb40,{'timers':_0x40e036,'paymentId':_0x4deb40,'gatewayPaymentId':_0x3a7762,'createdAt':_0x119116}),console[_0x259c4f(0x226)](_0x259c4f(0x1a7)+_0x3eee72['length']+_0x259c4f(0x13e)+_0x4deb40),console[_0x259c4f(0x226)](_0x259c4f(0x166)+this[_0x259c4f(0x196)][_0x259c4f(0x19b)]),this[_0x259c4f(0x139)](_0x4deb40,_0x3a7762,_0x259c4f(0x1ab),_0x259c4f(0x1ab),_0x259c4f(0x16f),{'action':_0x259c4f(0x146),'scheduledChecks':_0x3eee72[_0x259c4f(0x152)],'firstCheckIn':_0x3eee72[0x0][_0x259c4f(0x1ba)]/0x3e8,'totalTimers':this[_0x259c4f(0x196)][_0x259c4f(0x19b)]});}[a48_0x526462(0x208)](_0x2e95c1){const _0x2ca108=a48_0x526462,_0x378c32=this[_0x2ca108(0x196)][_0x2ca108(0x205)](_0x2e95c1);_0x378c32?(console[_0x2ca108(0x226)](_0x2ca108(0x1e0)+_0x378c32[_0x2ca108(0x1b6)][_0x2ca108(0x152)]+'\x20timers\x20for\x20payment\x20'+_0x2e95c1),_0x378c32[_0x2ca108(0x1b6)]['forEach']((_0x37482a,_0xd6afa8)=>{const _0x18a96d=_0x2ca108;_0x37482a&&(clearTimeout(_0x37482a),clearInterval(_0x37482a),console[_0x18a96d(0x226)](_0x18a96d(0x1f0)+(_0xd6afa8+0x1)+_0x18a96d(0x153)+_0x2e95c1));}),this['paymentTimers']['delete'](_0x2e95c1),console[_0x2ca108(0x226)](_0x2ca108(0x157)+_0x2e95c1+_0x2ca108(0x18b)+this[_0x2ca108(0x196)]['size'])):console[_0x2ca108(0x226)](_0x2ca108(0x138)+_0x2e95c1+_0x2ca108(0x134));}async[a48_0x526462(0x1f6)](_0x9e1ba6){const _0x3f7d9e=a48_0x526462;console[_0x3f7d9e(0x226)](_0x3f7d9e(0x197)+_0x9e1ba6);const _0x160aa4=await database_1[_0x3f7d9e(0x238)][_0x3f7d9e(0x147)][_0x3f7d9e(0x1dc)]({'where':{'id':_0x9e1ba6},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x160aa4){console[_0x3f7d9e(0x226)]('âŒ\x20[CHECK]\x20Payment\x20'+_0x9e1ba6+_0x3f7d9e(0x1d1));return;}console[_0x3f7d9e(0x226)]('ðŸ“Š\x20[CHECK]\x20Payment\x20'+_0x9e1ba6+_0x3f7d9e(0x129)),console['log'](_0x3f7d9e(0x1d2)+_0x160aa4[_0x3f7d9e(0x1d6)]),console[_0x3f7d9e(0x226)](_0x3f7d9e(0x168)+_0x160aa4[_0x3f7d9e(0x1b2)]),console['log']('\x20\x20\x20-\x20GatewayPaymentId:\x20'+_0x160aa4[_0x3f7d9e(0x1bb)]),console[_0x3f7d9e(0x226)]('\x20\x20\x20-\x20Amount:\x20'+_0x160aa4['amount']+'\x20'+_0x160aa4[_0x3f7d9e(0x13c)]),console[_0x3f7d9e(0x226)](_0x3f7d9e(0x17d)+_0x160aa4[_0x3f7d9e(0x1db)]);if(_0x160aa4[_0x3f7d9e(0x1d6)]!==_0x3f7d9e(0x218)&&_0x160aa4[_0x3f7d9e(0x1d6)]!==_0x3f7d9e(0x15b)){console[_0x3f7d9e(0x226)]('âš ï¸\x20[CHECK]\x20Payment\x20'+_0x9e1ba6+_0x3f7d9e(0x1cc)+_0x160aa4[_0x3f7d9e(0x1d6)]+')');return;}if(_0x160aa4[_0x3f7d9e(0x1b2)]!==_0x3f7d9e(0x1ab)){console[_0x3f7d9e(0x226)](_0x3f7d9e(0x209)+_0x9e1ba6+_0x3f7d9e(0x1f8)+_0x160aa4[_0x3f7d9e(0x1b2)]+_0x3f7d9e(0x13a)),this[_0x3f7d9e(0x208)](_0x9e1ba6);return;}if(!_0x160aa4[_0x3f7d9e(0x1bb)]){console[_0x3f7d9e(0x226)]('âš ï¸\x20[CHECK]\x20Payment\x20'+_0x9e1ba6+_0x3f7d9e(0x1c4));return;}console['log'](_0x3f7d9e(0x14a)+_0x9e1ba6+_0x3f7d9e(0x1ac)),await this[_0x3f7d9e(0x19f)](_0x160aa4);}['logCoinToPayStatus'](_0x42cbc5,_0x1c1f10,_0x124742,_0x4bad10,_0x22ba9d,_0x333c57){const _0x236c2c=a48_0x526462,_0x4c5370={'type':_0x236c2c(0x1df),'paymentId':_0x42cbc5,'gatewayPaymentId':_0x1c1f10,'oldStatus':_0x124742,'newStatus':_0x4bad10,'source':_0x22ba9d,'timestamp':new Date()[_0x236c2c(0x123)](),'details':_0x333c57||{}};loggerService_1[_0x236c2c(0x1d7)][_0x236c2c(0x139)](_0x4c5370),console[_0x236c2c(0x226)]('ðŸª™\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20'+_0x42cbc5+'\x20('+_0x1c1f10+')'),console[_0x236c2c(0x226)](_0x236c2c(0x1ff)+_0x124742+_0x236c2c(0x1e1)+_0x4bad10),console[_0x236c2c(0x226)](_0x236c2c(0x1ec)+_0x22ba9d),console[_0x236c2c(0x226)](_0x236c2c(0x1e6)+_0x4c5370[_0x236c2c(0x21a)]),_0x333c57&&console[_0x236c2c(0x226)](_0x236c2c(0x180),_0x333c57);}[a48_0x526462(0x1af)](_0x44f73a,_0x215894,_0x57ed99,_0x24739e,_0x1d88c7){const _0x2295a4=a48_0x526462,_0x120a68={'type':'COINTOPAY_ERROR','paymentId':_0x44f73a,'gatewayPaymentId':_0x215894,'error':_0x57ed99 instanceof Error?{'message':_0x57ed99['message'],'stack':_0x57ed99['stack']}:_0x57ed99,'source':_0x24739e,'timestamp':new Date()[_0x2295a4(0x123)](),'context':_0x1d88c7||{}};loggerService_1[_0x2295a4(0x1d7)]['logCoinToPayError'](_0x120a68),console[_0x2295a4(0x206)](_0x2295a4(0x213)+_0x44f73a+'\x20('+_0x215894+')'),console['error'](_0x2295a4(0x222)+(_0x57ed99 instanceof Error?_0x57ed99[_0x2295a4(0x154)]:_0x57ed99)),console[_0x2295a4(0x206)](_0x2295a4(0x1ec)+_0x24739e),console[_0x2295a4(0x206)](_0x2295a4(0x1e6)+_0x120a68[_0x2295a4(0x21a)]),_0x1d88c7&&console[_0x2295a4(0x206)](_0x2295a4(0x1fd),_0x1d88c7);}[a48_0x526462(0x203)](){const _0x226ab7=a48_0x526462;console['log'](_0x226ab7(0x159)),this[_0x226ab7(0x1bc)]()[_0x226ab7(0x1c5)](_0xec4970=>{const _0x5e61ae=_0x226ab7;console[_0x5e61ae(0x206)]('âŒ\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:',_0xec4970);}),this[_0x226ab7(0x1fb)]=setInterval(async()=>{const _0x12cae6=_0x226ab7;try{console[_0x12cae6(0x226)](_0x12cae6(0x178)),await this['checkAllPendingPayments'](),console[_0x12cae6(0x226)](_0x12cae6(0x12a));}catch(_0x8d47a4){console[_0x12cae6(0x206)](_0x12cae6(0x14f),_0x8d47a4);}},this['GLOBAL_CHECK_INTERVAL_MS']),console['log']('âœ…\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)');}[a48_0x526462(0x217)](){const _0x5694a3=a48_0x526462;console['log'](_0x5694a3(0x1bd));this[_0x5694a3(0x1fb)]&&(clearInterval(this[_0x5694a3(0x1fb)]),this['globalCheckInterval']=null,console['log']('ðŸ›‘\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped'));const _0x169b06=this[_0x5694a3(0x196)]['size'];for(const [_0x2c6edd]of this[_0x5694a3(0x196)]){this[_0x5694a3(0x208)](_0x2c6edd);}console[_0x5694a3(0x226)](_0x5694a3(0x1e9)+_0x169b06+_0x5694a3(0x131));}async['checkAllPendingPayments'](){const _0xb87c78=a48_0x526462;try{console[_0xb87c78(0x226)](_0xb87c78(0x1c7));const _0x227205=await database_1[_0xb87c78(0x238)][_0xb87c78(0x147)][_0xb87c78(0x20e)]({'where':{'gateway':{'in':[_0xb87c78(0x218),_0xb87c78(0x15b)]},'status':_0xb87c78(0x1ab),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console['log']('ðŸª™\x20[GLOBAL]\x20Found\x20'+_0x227205['length']+_0xb87c78(0x149));if(_0x227205[_0xb87c78(0x152)]===0x0){console[_0xb87c78(0x226)](_0xb87c78(0x227));return;}const _0x49b9c9=await this['checkExpiredPayments'](_0x227205);console[_0xb87c78(0x226)](_0xb87c78(0x1ea)+_0x49b9c9[_0xb87c78(0x152)]+_0xb87c78(0x1a1));let _0x15e77c=0x0,_0x1743ef=0x0;for(const _0x4e7882 of _0x227205){try{if(_0x49b9c9['includes'](_0x4e7882['id'])){console[_0xb87c78(0x226)](_0xb87c78(0x232)+_0x4e7882['id']+'\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check'),_0x1743ef++;continue;}if(this[_0xb87c78(0x196)]['has'](_0x4e7882['id'])){console[_0xb87c78(0x226)](_0xb87c78(0x232)+_0x4e7882['id']+_0xb87c78(0x1f2)),_0x1743ef++;continue;}const _0xc4c72b=(Date[_0xb87c78(0x133)]()-_0x4e7882[_0xb87c78(0x1ae)][_0xb87c78(0x1a9)]())/(0x3e8*0x3c*0x3c);if(_0xc4c72b<0x1){console['log'](_0xb87c78(0x232)+_0x4e7882['id']+_0xb87c78(0x1a3)+_0xc4c72b[_0xb87c78(0x1dd)](0x1)+_0xb87c78(0x1cf)),_0x1743ef++;continue;}console[_0xb87c78(0x226)](_0xb87c78(0x163)+_0x4e7882['id']+_0xb87c78(0x20d)+_0xc4c72b['toFixed'](0x1)+'h)'),await this[_0xb87c78(0x19f)](_0x4e7882),_0x15e77c++,await new Promise(_0x10962d=>setTimeout(_0x10962d,0x7d0));}catch(_0x360df9){console[_0xb87c78(0x206)](_0xb87c78(0x17e)+_0x4e7882['id']+':',_0x360df9),this['logCoinToPayError'](_0x4e7882['id'],_0x4e7882[_0xb87c78(0x1bb)]||_0xb87c78(0x1b8),_0x360df9,_0xb87c78(0x16f),{'isGlobalCheck':!![],'paymentAmount':_0x4e7882[_0xb87c78(0x234)],'paymentCurrency':_0x4e7882['currency'],'shopId':_0x4e7882[_0xb87c78(0x1db)],'createdAt':_0x4e7882[_0xb87c78(0x1ae)]}),loggerService_1[_0xb87c78(0x1d7)][_0xb87c78(0x183)](_0xb87c78(0x218),_0xb87c78(0x136)+_0x4e7882[_0xb87c78(0x1bb)],_0x360df9);}}console['log'](_0xb87c78(0x1a8)+_0x15e77c+'\x20checked,\x20'+_0x1743ef+_0xb87c78(0x1c0)+_0x49b9c9[_0xb87c78(0x152)]+_0xb87c78(0x1c1));}catch(_0x4ccab3){console[_0xb87c78(0x206)](_0xb87c78(0x210),_0x4ccab3);}}async['checkExpiredPayments'](_0x9dc342){const _0x299c01=a48_0x526462,_0x5d0459=[],_0x3a53bd=new Date();_0x3a53bd[_0x299c01(0x230)](_0x3a53bd[_0x299c01(0x1b7)]()-this[_0x299c01(0x126)]),console[_0x299c01(0x226)](_0x299c01(0x1cd)+this['EXPIRY_DAYS']+'\x20days\x20(created\x20before\x20'+_0x3a53bd[_0x299c01(0x123)]()+')');for(const _0x3d5324 of _0x9dc342){if(_0x3d5324[_0x299c01(0x1ae)]<_0x3a53bd){console['log'](_0x299c01(0x1d3)+_0x3d5324['id']+_0x299c01(0x195)+this[_0x299c01(0x126)]+'\x20days,\x20marking\x20as\x20EXPIRED');try{this[_0x299c01(0x139)](_0x3d5324['id'],_0x3d5324[_0x299c01(0x1bb)]||_0x299c01(0x1b8),_0x299c01(0x1ab),_0x299c01(0x148),_0x299c01(0x1ed),{'reason':_0x299c01(0x173)+this[_0x299c01(0x126)]+_0x299c01(0x1ad),'createdAt':_0x3d5324['createdAt'],'daysSinceCreation':Math[_0x299c01(0x1d8)]((Date[_0x299c01(0x133)]()-_0x3d5324['createdAt'][_0x299c01(0x1a9)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x3d5324[_0x299c01(0x234)],'paymentCurrency':_0x3d5324[_0x299c01(0x13c)],'shopId':_0x3d5324[_0x299c01(0x1db)]}),await database_1[_0x299c01(0x238)][_0x299c01(0x147)][_0x299c01(0x185)]({'where':{'id':_0x3d5324['id']},'data':{'status':'EXPIRED','updatedAt':new Date()}}),await database_1[_0x299c01(0x238)][_0x299c01(0x236)][_0x299c01(0x1f3)]({'data':{'paymentId':_0x3d5324['id'],'shopId':_0x3d5324[_0x299c01(0x1db)],'event':_0x299c01(0x20a),'statusCode':0xc8,'responseBody':JSON['stringify']({'reason':_0x299c01(0x173)+this['EXPIRY_DAYS']+_0x299c01(0x1ad),'createdAt':_0x3d5324['createdAt'],'expiredAt':new Date()['toISOString'](),'daysSinceCreation':Math[_0x299c01(0x1d8)]((Date[_0x299c01(0x133)]()-_0x3d5324[_0x299c01(0x1ae)]['getTime']())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x299c01(0x22d)](_0x3d5324,_0x299c01(0x148)),await this[_0x299c01(0x1bf)](_0x3d5324,_0x299c01(0x148)),this[_0x299c01(0x208)](_0x3d5324['id']),_0x5d0459['push'](_0x3d5324['id']),console['log'](_0x299c01(0x194)+_0x3d5324['id']+'\x20marked\x20as\x20EXPIRED\x20due\x20to\x20'+this[_0x299c01(0x126)]+'-day\x20timeout');}catch(_0x49629){console['error'](_0x299c01(0x130)+_0x3d5324['id']+':',_0x49629),this[_0x299c01(0x1af)](_0x3d5324['id'],_0x3d5324[_0x299c01(0x1bb)]||_0x299c01(0x1b8),_0x49629,_0x299c01(0x1ed),{'reason':'Failed\x20to\x20mark\x20payment\x20as\x20expired','createdAt':_0x3d5324[_0x299c01(0x1ae)],'daysSinceCreation':Math[_0x299c01(0x1d8)]((Date[_0x299c01(0x133)]()-_0x3d5324[_0x299c01(0x1ae)][_0x299c01(0x1a9)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x5d0459;}async['checkSinglePayment'](_0x32e8cb){const _0x378e7a=a48_0x526462;if(!_0x32e8cb[_0x378e7a(0x1bb)]){console['log'](_0x378e7a(0x209)+_0x32e8cb['id']+_0x378e7a(0x237));return;}console['log'](_0x378e7a(0x160)+_0x32e8cb[_0x378e7a(0x1d6)]+_0x378e7a(0x1b9)+_0x32e8cb['id']+'\x20('+_0x32e8cb['gatewayPaymentId']+')');try{let _0xbccd85;_0x32e8cb['gateway']===_0x378e7a(0x15b)?(_0xbccd85=await this['coinToPay2Service'][_0x378e7a(0x1ce)](_0x32e8cb[_0x378e7a(0x1bb)]),console[_0x378e7a(0x226)]('ðŸ“Š\x20[CHECK]\x20CoinToPay2\x20payment\x20'+_0x32e8cb['id']+_0x378e7a(0x18c)+_0xbccd85[_0x378e7a(0x1b2)])):(_0xbccd85=await this[_0x378e7a(0x17b)][_0x378e7a(0x1ce)](_0x32e8cb[_0x378e7a(0x1bb)]),console[_0x378e7a(0x226)](_0x378e7a(0x1d4)+_0x32e8cb['id']+_0x378e7a(0x18c)+_0xbccd85[_0x378e7a(0x1b2)]));_0xbccd85[_0x378e7a(0x12d)]&&console[_0x378e7a(0x226)](_0x378e7a(0x193)+_0x32e8cb['id']+_0x378e7a(0x179),{'iban':_0xbccd85['paymentDetails']['iban']||'not\x20found','transactionId':_0xbccd85['paymentDetails'][_0x378e7a(0x1e5)],'createdOn':_0xbccd85[_0x378e7a(0x12d)]['createdOn'],'confirmedOn':_0xbccd85[_0x378e7a(0x12d)][_0x378e7a(0x12e)]||'not\x20confirmed'});if(_0xbccd85[_0x378e7a(0x1b2)]!==_0x32e8cb[_0x378e7a(0x1b2)]){console[_0x378e7a(0x226)]('ðŸ”„\x20[CHECK]\x20Updating\x20payment\x20'+_0x32e8cb['id']+'\x20status\x20from\x20'+_0x32e8cb[_0x378e7a(0x1b2)]+_0x378e7a(0x1a2)+_0xbccd85[_0x378e7a(0x1b2)]),this['logCoinToPayStatus'](_0x32e8cb['id'],_0x32e8cb[_0x378e7a(0x1bb)],_0x32e8cb[_0x378e7a(0x1b2)],_0xbccd85[_0x378e7a(0x1b2)],_0x378e7a(0x16f),{'paymentDetails':_0xbccd85[_0x378e7a(0x12d)],'amount':_0xbccd85[_0x378e7a(0x234)],'currency':_0xbccd85[_0x378e7a(0x13c)],'shopId':_0x32e8cb[_0x378e7a(0x1db)],'checkTimestamp':new Date()['toISOString']()});const _0x99a3ba={'status':_0xbccd85[_0x378e7a(0x1b2)],'updatedAt':new Date()};if(_0xbccd85[_0x378e7a(0x1b2)]===_0x378e7a(0x22a)&&_0x32e8cb[_0x378e7a(0x1b2)]!==_0x378e7a(0x22a)){_0x99a3ba[_0x378e7a(0x15f)]=new Date();if(!_0x32e8cb[_0x378e7a(0x1a0)]){const _0xf5948=await currencyService_1[_0x378e7a(0x21b)][_0x378e7a(0x17c)](_0x32e8cb[_0x378e7a(0x234)],_0x32e8cb['currency']);_0x99a3ba['amountUSDT']=_0xf5948;const _0x36b849=await this[_0x378e7a(0x16a)](_0x32e8cb[_0x378e7a(0x1db)],_0x32e8cb[_0x378e7a(0x1d6)]),_0x5c0128=_0xf5948*(0x1-_0x36b849/0x64);_0x99a3ba[_0x378e7a(0x21d)]=_0x5c0128,_0x99a3ba[_0x378e7a(0x184)]=_0x36b849,console[_0x378e7a(0x226)](_0x378e7a(0x1ee)+_0x32e8cb['id']+'\x20amounts\x20calculated:'),console['log'](_0x378e7a(0x20c)+_0x32e8cb[_0x378e7a(0x234)]+'\x20'+_0x32e8cb[_0x378e7a(0x13c)]+'\x20->\x20'+_0xf5948[_0x378e7a(0x1dd)](0x6)+_0x378e7a(0x174)),console[_0x378e7a(0x226)](_0x378e7a(0x235)+_0x32e8cb['gateway']+_0x378e7a(0x187)+_0x36b849+'%'),console['log'](_0x378e7a(0x231)+_0x5c0128[_0x378e7a(0x1dd)](0x6)+_0x378e7a(0x174));}console['log'](_0x378e7a(0x1ee)+_0x32e8cb['id']+_0x378e7a(0x1a5)+_0x99a3ba[_0x378e7a(0x15f)][_0x378e7a(0x123)]());}if(_0xbccd85[_0x378e7a(0x12d)]){const _0xf934a6=_0xbccd85[_0x378e7a(0x12d)];_0xf934a6[_0x378e7a(0x1e3)]&&(_0x99a3ba[_0x378e7a(0x169)]=_0xf934a6[_0x378e7a(0x1e3)],console[_0x378e7a(0x226)](_0x378e7a(0x19c)+_0xf934a6['iban'])),_0xf934a6[_0x378e7a(0x162)]&&console[_0x378e7a(0x226)](_0x378e7a(0x1fa)+_0xf934a6[_0x378e7a(0x162)]),_0xf934a6[_0x378e7a(0x1e5)]&&console[_0x378e7a(0x226)](_0x378e7a(0x15d)+_0xf934a6[_0x378e7a(0x1e5)]),_0xf934a6[_0x378e7a(0x12e)]&&console[_0x378e7a(0x226)](_0x378e7a(0x1b0)+_0xf934a6[_0x378e7a(0x12e)]);}await database_1[_0x378e7a(0x238)][_0x378e7a(0x147)][_0x378e7a(0x185)]({'where':{'id':_0x32e8cb['id']},'data':_0x99a3ba});if(_0xbccd85['status']===_0x378e7a(0x22a)&&_0x32e8cb[_0x378e7a(0x1b2)]!==_0x378e7a(0x22a)){console[_0x378e7a(0x226)](_0x378e7a(0x16b)+_0x32e8cb['id']+_0x378e7a(0x16d));const _0x1acafd=await database_1[_0x378e7a(0x238)][_0x378e7a(0x147)][_0x378e7a(0x1dc)]({'where':{'id':_0x32e8cb['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x1acafd?.[_0x378e7a(0x1ca)]&&_0x1acafd['paymentLink'])try{const _0x3e425e=_0x1acafd[_0x378e7a(0x144)];console[_0x378e7a(0x226)](_0x378e7a(0x22c)+_0x3e425e['id']+_0x378e7a(0x204)+_0x3e425e[_0x378e7a(0x128)]+_0x378e7a(0x1b4)+_0x3e425e[_0x378e7a(0x13d)]+_0x378e7a(0x211)+_0x3e425e[_0x378e7a(0x1b2)]);const _0x42e128=_0x3e425e[_0x378e7a(0x13d)]+0x1,_0xe445ad=_0x3e425e[_0x378e7a(0x128)]===_0x378e7a(0x14d)?_0x378e7a(0x171):_0x3e425e[_0x378e7a(0x1b2)];await database_1[_0x378e7a(0x238)][_0x378e7a(0x144)]['update']({'where':{'id':_0x3e425e['id']},'data':{'currentPayments':_0x42e128,'status':_0xe445ad,'updatedAt':new Date()}}),console[_0x378e7a(0x226)](_0x378e7a(0x1d9)+_0x3e425e['id']+_0x378e7a(0x1e7)+_0x3e425e[_0x378e7a(0x13d)]+_0x378e7a(0x1e1)+_0x42e128+_0x378e7a(0x211)+_0x3e425e[_0x378e7a(0x1b2)]+'\x20->\x20'+_0xe445ad);}catch(_0x4f758b){console[_0x378e7a(0x206)]('âŒ\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:',_0x4f758b);}else console[_0x378e7a(0x226)](_0x378e7a(0x16b)+_0x32e8cb['id']+_0x378e7a(0x18e));}await database_1[_0x378e7a(0x238)]['webhookLog']['create']({'data':{'paymentId':_0x32e8cb['id'],'shopId':_0x32e8cb['shopId'],'event':_0x378e7a(0x155)+_0xbccd85[_0x378e7a(0x1b2)]['toLowerCase'](),'statusCode':0xc8,'responseBody':JSON[_0x378e7a(0x1da)]({'oldStatus':_0x32e8cb[_0x378e7a(0x1b2)],'newStatus':_0xbccd85[_0x378e7a(0x1b2)],'paymentDetails':_0xbccd85[_0x378e7a(0x12d)],'checkedAt':new Date()[_0x378e7a(0x123)]()})}}),await this[_0x378e7a(0x22d)](_0x32e8cb,_0xbccd85[_0x378e7a(0x1b2)]),await this['sendPaymentStatusNotification'](_0x32e8cb,_0xbccd85[_0x378e7a(0x1b2)]),_0xbccd85[_0x378e7a(0x1b2)]!==_0x378e7a(0x1ab)&&(console[_0x378e7a(0x226)](_0x378e7a(0x18f)+_0x32e8cb['id']+_0x378e7a(0x21c)+_0xbccd85[_0x378e7a(0x1b2)]+_0x378e7a(0x1c6)),this[_0x378e7a(0x208)](_0x32e8cb['id'])),console['log'](_0x378e7a(0x14a)+_0x32e8cb['id']+_0x378e7a(0x1c2));}else console[_0x378e7a(0x226)]('ðŸ“Š\x20[CHECK]\x20Payment\x20'+_0x32e8cb['id']+_0x378e7a(0x1fe)+_0xbccd85['status']+')'),this[_0x378e7a(0x139)](_0x32e8cb['id'],_0x32e8cb[_0x378e7a(0x1bb)],_0x32e8cb[_0x378e7a(0x1b2)],_0xbccd85['status'],_0x378e7a(0x16f),{'statusUnchanged':!![],'paymentDetails':_0xbccd85[_0x378e7a(0x12d)],'amount':_0xbccd85[_0x378e7a(0x234)],'currency':_0xbccd85[_0x378e7a(0x13c)],'shopId':_0x32e8cb[_0x378e7a(0x1db)],'checkTimestamp':new Date()[_0x378e7a(0x123)]()});}catch(_0x4ed380){console[_0x378e7a(0x206)](_0x378e7a(0x172)+_0x32e8cb['id']+':',_0x4ed380),this[_0x378e7a(0x1af)](_0x32e8cb['id'],_0x32e8cb[_0x378e7a(0x1bb)],_0x4ed380,_0x378e7a(0x16f),{'paymentAmount':_0x32e8cb[_0x378e7a(0x234)],'paymentCurrency':_0x32e8cb[_0x378e7a(0x13c)],'shopId':_0x32e8cb['shopId'],'createdAt':_0x32e8cb[_0x378e7a(0x1ae)]}),await database_1[_0x378e7a(0x238)][_0x378e7a(0x236)][_0x378e7a(0x1f3)]({'data':{'paymentId':_0x32e8cb['id'],'shopId':_0x32e8cb[_0x378e7a(0x1db)],'event':'cointopay_status_check_error','statusCode':0x1f4,'responseBody':JSON[_0x378e7a(0x1da)]({'error':_0x4ed380 instanceof Error?_0x4ed380['message']:_0x378e7a(0x16e),'gatewayPaymentId':_0x32e8cb[_0x378e7a(0x1bb)],'checkedAt':new Date()[_0x378e7a(0x123)]()})}});}}async[a48_0x526462(0x22d)](_0x3c9eb9,_0x37dc47){const _0x246d31=a48_0x526462,_0x517c6d=Date['now']();try{const _0x1bbd3d=_0x3c9eb9[_0x246d31(0x127)],_0x5b2daf=_0x1bbd3d[_0x246d31(0x233)];if(!_0x5b2daf?.[_0x246d31(0x125)]){console['log'](_0x246d31(0x165)+_0x1bbd3d['id']);return;}const _0x43a7d1=_0x37dc47==='PAID'?_0x246d31(0x1f7):_0x37dc47==='FAILED'?_0x246d31(0x207):_0x37dc47===_0x246d31(0x148)?_0x246d31(0x207):'payment.pending';if(!_0x5b2daf[_0x246d31(0x1d0)]?.[_0x246d31(0x17a)](_0x43a7d1)){console[_0x246d31(0x226)](_0x246d31(0x140)+_0x43a7d1+_0x246d31(0x20b)+_0x1bbd3d['id']);return;}const _0x4c314=(0x0,gateway_1[_0x246d31(0x22b)])(_0x3c9eb9[_0x246d31(0x1d6)])||_0x3c9eb9['gateway'],_0x1d0471={'event':_0x43a7d1,'payment':{'id':_0x3c9eb9['id'],'order_id':_0x3c9eb9[_0x246d31(0x124)],'gateway_order_id':_0x3c9eb9[_0x246d31(0x1c8)],'gateway':_0x4c314,'amount':_0x3c9eb9['amount'],'currency':_0x3c9eb9[_0x246d31(0x13c)],'status':_0x37dc47['toLowerCase'](),'customer_email':_0x3c9eb9[_0x246d31(0x198)],'customer_name':_0x3c9eb9['customerName'],'created_at':_0x3c9eb9[_0x246d31(0x1ae)],'updated_at':new Date()}},_0x88b6fd=await fetch(_0x5b2daf['webhookUrl'],{'method':_0x246d31(0x16c),'headers':{'Content-Type':_0x246d31(0x1eb),'User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x246d31(0x1da)](_0x1d0471)}),_0x50e0a3=Date[_0x246d31(0x133)]()-_0x517c6d,_0x5a2c02=_0x88b6fd['ok']?'Success':await _0x88b6fd[_0x246d31(0x170)]();loggerService_1[_0x246d31(0x1d7)][_0x246d31(0x216)](_0x3c9eb9[_0x246d31(0x1db)],_0x5b2daf[_0x246d31(0x125)],_0x43a7d1,_0x88b6fd[_0x246d31(0x1b2)],_0x50e0a3,_0x1d0471),console[_0x246d31(0x226)](_0x246d31(0x132)+_0x5b2daf[_0x246d31(0x125)]+'\x20with\x20status\x20'+_0x88b6fd[_0x246d31(0x1b2)]+'\x20('+_0x50e0a3+_0x246d31(0x1f5));}catch(_0x2c6aaa){console[_0x246d31(0x206)](_0x246d31(0x145),_0x2c6aaa),loggerService_1[_0x246d31(0x1d7)][_0x246d31(0x1cb)](_0x3c9eb9[_0x246d31(0x1db)],_0x3c9eb9[_0x246d31(0x127)]?.[_0x246d31(0x233)]?.[_0x246d31(0x125)]||_0x246d31(0x1b8),_0x246d31(0x22f),_0x2c6aaa,{});}}async[a48_0x526462(0x1bf)](_0x4c57ac,_0x278bc9){const _0x4a7a65=a48_0x526462;try{const _0xa52ad3={'PENDING':_0x4a7a65(0x19a),'PAID':_0x4a7a65(0x1f4),'FAILED':'failed','EXPIRED':_0x4a7a65(0x1c3)},_0x282370=_0xa52ad3[_0x278bc9];if(!_0x282370||_0x282370===_0x4a7a65(0x19a))return;await telegramBotService_1[_0x4a7a65(0x21e)][_0x4a7a65(0x143)](_0x4c57ac['shopId'],_0x4c57ac,_0x282370);}catch(_0x27281f){console[_0x4a7a65(0x206)](_0x4a7a65(0x18a),_0x27281f);}}async[a48_0x526462(0x221)](_0x37ce76){const _0x369bcc=a48_0x526462;console[_0x369bcc(0x226)]('ðŸ”\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20'+_0x37ce76);const _0x17267a=await database_1[_0x369bcc(0x238)]['payment']['findUnique']({'where':{'id':_0x37ce76},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x17267a)throw new Error(_0x369bcc(0x21f));if(_0x17267a['gateway']!=='cointopay'&&_0x17267a[_0x369bcc(0x1d6)]!==_0x369bcc(0x15b))throw new Error(_0x369bcc(0x228));console[_0x369bcc(0x226)](_0x369bcc(0x15a)+_0x17267a[_0x369bcc(0x1d6)]+_0x369bcc(0x1b9)+_0x37ce76),await this[_0x369bcc(0x19f)](_0x17267a),console[_0x369bcc(0x226)](_0x369bcc(0x1e4)+_0x37ce76);}[a48_0x526462(0x1d5)](){const _0xd44441=a48_0x526462,_0x26afc1=this[_0xd44441(0x1fb)]?this[_0xd44441(0x161)]:undefined,_0x5f5827=Array[_0xd44441(0x200)](this[_0xd44441(0x196)][_0xd44441(0x186)]())[_0xd44441(0x192)](_0x1daffb=>({'paymentId':_0x1daffb['paymentId'],'gatewayPaymentId':_0x1daffb[_0xd44441(0x1bb)],'createdAt':_0x1daffb['createdAt'],'timersCount':_0x1daffb[_0xd44441(0x1b6)][_0xd44441(0x152)]}));return{'isActive':!!this[_0xd44441(0x1fb)],'globalCheckIntervalMinutes':this['GLOBAL_CHECK_INTERVAL_MS']/(0x3e8*0x3c),'expiryDays':this['EXPIRY_DAYS'],'activeIndividualTimers':this[_0xd44441(0x196)][_0xd44441(0x19b)],'nextGlobalCheckIn':_0x26afc1,'paymentTimersDetails':_0x5f5827};}[a48_0x526462(0x175)](_0x1eff86){const _0x59e4a5=a48_0x526462,_0x5d8e5d=this[_0x59e4a5(0x196)]['get'](_0x1eff86);if(_0x5d8e5d)return{'hasTimers':!![],'timersCount':_0x5d8e5d[_0x59e4a5(0x1b6)][_0x59e4a5(0x152)],'createdAt':_0x5d8e5d[_0x59e4a5(0x1ae)],'gatewayPaymentId':_0x5d8e5d['gatewayPaymentId']};return{'hasTimers':![]};}async[a48_0x526462(0x16a)](_0x1fe5d8,_0x3cd4e2){const _0x5dd20e=a48_0x526462;try{const _0xdad648=await database_1[_0x5dd20e(0x238)][_0x5dd20e(0x127)][_0x5dd20e(0x1dc)]({'where':{'id':_0x1fe5d8},'select':{'gatewaySettings':!![]}});if(!_0xdad648?.[_0x5dd20e(0x13b)])return console['log']('No\x20gateway\x20settings\x20found\x20for\x20shop\x20'+_0x1fe5d8+_0x5dd20e(0x167)),0xa;const _0x4449f5=JSON[_0x5dd20e(0x15c)](_0xdad648[_0x5dd20e(0x13b)]);for(const [_0x4a8405,_0x42a3de]of Object[_0x5dd20e(0x1a4)](_0x4449f5)){if(_0x4a8405[_0x5dd20e(0x199)]()===_0x3cd4e2[_0x5dd20e(0x199)]()){const _0x1704bc=_0x42a3de['commission']||0xa;return console[_0x5dd20e(0x226)]('Gateway\x20'+_0x3cd4e2+_0x5dd20e(0x12f)+_0x1fe5d8+':\x20'+_0x1704bc+'%'),_0x1704bc;}}return console[_0x5dd20e(0x226)](_0x5dd20e(0x1e2)+_0x3cd4e2+_0x5dd20e(0x229)+_0x1fe5d8+_0x5dd20e(0x135)),0xa;}catch(_0x41857f){return console['error'](_0x5dd20e(0x219)+_0x1fe5d8+_0x5dd20e(0x191)+_0x3cd4e2+':',_0x41857f),0xa;}}}exports[a48_0x526462(0x156)]=CoinToPayStatusService,exports['coinToPayStatusService']=new CoinToPayStatusService();