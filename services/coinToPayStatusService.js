'use strict';const a37_0x3c975e=a37_0x4eea;(function(_0x591fa5,_0x5daf8e){const _0x581e4b=a37_0x4eea,_0x3ce6c0=_0x591fa5();while(!![]){try{const _0x10ba51=-parseInt(_0x581e4b(0x1d6))/0x1*(parseInt(_0x581e4b(0x282))/0x2)+-parseInt(_0x581e4b(0x22f))/0x3+parseInt(_0x581e4b(0x1c1))/0x4*(-parseInt(_0x581e4b(0x1de))/0x5)+parseInt(_0x581e4b(0x1ff))/0x6+parseInt(_0x581e4b(0x214))/0x7*(parseInt(_0x581e4b(0x27f))/0x8)+-parseInt(_0x581e4b(0x273))/0x9*(-parseInt(_0x581e4b(0x24b))/0xa)+parseInt(_0x581e4b(0x239))/0xb*(parseInt(_0x581e4b(0x1b7))/0xc);if(_0x10ba51===_0x5daf8e)break;else _0x3ce6c0['push'](_0x3ce6c0['shift']());}catch(_0x48596a){_0x3ce6c0['push'](_0x3ce6c0['shift']());}}}(a37_0x5cb4,0xa6e7e));function a37_0x4eea(_0x307304,_0x4b4e48){const _0x5cb42a=a37_0x5cb4();return a37_0x4eea=function(_0x4eea8c,_0x204db8){_0x4eea8c=_0x4eea8c-0x18f;let _0x4fbb4d=_0x5cb42a[_0x4eea8c];return _0x4fbb4d;},a37_0x4eea(_0x307304,_0x4b4e48);}var __importDefault=this&&this[a37_0x3c975e(0x27a)]||function(_0x397819){return _0x397819&&_0x397819['__esModule']?_0x397819:{'default':_0x397819};};function a37_0x5cb4(){const _0x666046=['⏰\x20[EXPIRY]\x20Payment\x20','2rkDkCz','📊\x20[CHECK]\x20Payment\x20','payment.failed','not\x20confirmed','🔄\x20[CHECK]\x20Updating\x20payment\x20','from','./telegramBotService','has','Success','gatewayPaymentId','stack','timers','type','startPeriodicStatusCheck','cointopay2','paymentId','delay','Automatically\x20expired\x20after\x20','❌\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','log','logCoinToPayStatus','getPaymentTimerInfo','\x20(age:\x20','\x20\x20\x20📊\x20Status:\x20','COINTOPAY_ERROR','✅\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','status_check','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','PAID','.\x20Remaining\x20active\x20timers:\x20','floor','\x20is\x20too\x20new\x20(','\x20is\x20older\x20than\x20','shop','stopPeriodicStatusCheck','SINGLE','💰\x20[CHECK]\x20Payment\x20','✅\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','\x20payment\x20','\x20individual\x20payment\x20timers','COMPLETED','❌\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','setDate','paymentDetails','create','getTime','20820VhUAdJ','h),\x20skipping\x20global\x20check','\x20to\x20','__esModule',',\x20currentPayments=','globalCheckInterval','checkPaymentStatus','now','🪙\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','\x20days\x20without\x20payment\x20confirmation','141184aeEkbA','checkPaymentById','includes','bankDetails','POST','toFixed','checkAllPendingPayments','\x20has\x20no\x20gatewayPaymentId','push','webhookLog','customerName','toLowerCase','text','✅\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','⏰\x20[GLOBAL]\x20Found\x20','EXPIRY_DAYS','logWhiteDomainError','cointopay_auto_expired','⏰\x20[GLOBAL]\x20Payment\x20','TesSoft\x20Payment\x20System/1.0','Unknown\x20error','682073jwyVzT','webhookUrl','checkSinglePayment','defineProperty','📊\x20[CHECK]\x20CoinToPay\x20payment\x20','payment.pending','⚠️\x20[CHECK]\x20Payment\x20','adminNotes','85FjTQoe','CoinToPay2Service','🏦\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes','🧹\x20[CHECK]\x20Payment\x20','currency','coinToPay2Service','failed','sendShopWebhook','\x20timers\x20for\x20payment\x20',':\x20type=','\x20details:','sendPaymentNotification','PENDING','length','../config/database','paid','currentPayments','checkSinglePaymentById','checkExpiredPayments','-day\x20timeout','amount','\x20updated:\x20currentPayments=','transactionId','set','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','webhook_send','🔍\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','Shop\x20webhook\x20sent\x20to\x20','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','size','📈\x20[COINTOPAY]\x20Payment\x20','✅\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','🧹\x20[DEBUG]\x20Clearing\x20','7103880FFNvbH','orderId','\x20\x20\x20❌\x20Error:\x20','⏰\x20[HOURLY]\x20Payment\x20','⏰\x20[DEBUG]\x20Scheduled\x20check\x20#','payment','getDate','\x20marked\x20as\x20paid\x20at:\x20','\x20\x20\x20-\x20ShopId:\x20','unknown','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','status','settings','\x20initial\x20timers\x20for\x20payment\x20','coinToPayService','Failed\x20to\x20mark\x20payment\x20as\x20expired','EXPIRED','\x20\x20\x20📝\x20Details:','cointopay','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','\x20\x20\x20-\x20Gateway:\x20','1779757dKNekB','\x20\x20\x20📍\x20Source:\x20','findUnique','🪙\x20[GLOBAL]\x20Found\x20','default','clearPaymentTimers','update','CoinToPayStatusService','gateway','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','🆔\x20[CHECK]\x20Transaction\x20ID:\x20','timestamp','iban','\x20(after\x20','\x20in\x20','logShopWebhookSent','\x20to\x20clear',',\x20stopping\x20individual\x20checks','\x20\x20\x20📅\x20Time:\x20','findMany','🪙\x20[ERROR]\x20CoinToPay\x20Error:\x20','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','paymentLink','🔍\x20[CHECK]\x20Checking\x20','./gateways/coinToPayService','description','cointopay_status_check_','1094064nvQIWw','🛑\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','🪙\x20[TIMER]\x20Individual\x20check\x20#','not\x20found','loggerService','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','stringify','../types/gateway','FAILED','createdOn','484MEZuMy','telegramBotService','📊\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','📈\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','shopId','🪙\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','application/json','\x20\x20\x20-\x20Status:\x20','sendPaymentStatusNotification','payment.success','🪙\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','error','✅\x20[TIMER]\x20Individual\x20check\x20#','COINTOPAY_STATUS_CHANGE','\x20status\x20is\x20','✅\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','✅\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','47160FOnmnC','paymentTimers','✅\x20[DEBUG]\x20Successfully\x20scheduled\x20','\x20current\x20status:\x20','./loggerService','⏰\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','map','customerEmail','message','schedule_created','🧹\x20[DEBUG]\x20Cleared\x20timer\x20#','❌\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','\x20completed\x20for\x20payment\x20','\x20not\x20found,\x20clearing\x20timers','values','ms)','catch','🔍\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','\x20days','toISOString','🪙\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','❌\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','\x20status\x20changed\x20to\x20','🪙\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','webhookEvents','✅\x20[COINTOPAY]\x20Payment\x20link\x20','🪙\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','\x20for\x20payment\x20','logCoinToPayError','\x20pending\x20CoinToPay\x20payments','⚠️\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','\x20\x20\x20📝\x20Context:','❌\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','created',',\x20status=','2\x20minutes','GLOBAL_CHECK_INTERVAL_MS','paidAt','confirmedOn','🪙\x20[DEBUG]\x20Creating\x20','1557PsCvFH','forEach','\x20status:\x20','coinToPayStatusService','5\x20minutes','createdAt','\x20expired\x20CoinToPay\x20payments','__importDefault','\x20seconds\x20(','❌\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','Bank\x20Details:\x20','\x20status\x20from\x20','8ddUmkO','\x20days,\x20marking\x20as\x20EXPIRED'];a37_0x5cb4=function(){return _0x666046;};return a37_0x5cb4();}Object[a37_0x3c975e(0x1d9)](exports,a37_0x3c975e(0x1ba),{'value':!![]}),exports[a37_0x3c975e(0x276)]=exports[a37_0x3c975e(0x21b)]=void 0x0;const coinToPayService_1=require(a37_0x3c975e(0x22c)),coinToPay2Service_1=require('./gateways/coinToPay2Service'),gateway_1=require(a37_0x3c975e(0x236)),database_1=__importDefault(require(a37_0x3c975e(0x1ec))),telegramBotService_1=require(a37_0x3c975e(0x18f)),loggerService_1=require(a37_0x3c975e(0x24f));class CoinToPayStatusService{constructor(){const _0x42fbfe=a37_0x3c975e;this['globalCheckInterval']=null,this[_0x42fbfe(0x26f)]=0x3c*0x3c*0x3e8,this['EXPIRY_DAYS']=0x5,this[_0x42fbfe(0x24c)]=new Map(),this[_0x42fbfe(0x20d)]=new coinToPayService_1['CoinToPayService'](),this[_0x42fbfe(0x1e3)]=new coinToPay2Service_1[(_0x42fbfe(0x1df))](),console[_0x42fbfe(0x19c)](_0x42fbfe(0x1bf));}['schedulePaymentChecks'](_0x2c0f7c,_0x36e484){const _0x4710e1=a37_0x3c975e;console['log'](_0x4710e1(0x25f)),console[_0x4710e1(0x19c)]('\x20\x20\x20-\x20paymentId:\x20'+_0x2c0f7c),console[_0x4710e1(0x19c)]('\x20\x20\x20-\x20gatewayPaymentId:\x20'+_0x36e484),this[_0x4710e1(0x219)](_0x2c0f7c);const _0x45ee22=[],_0x41f25e=new Date(),_0x1692fe=[{'delay':0x1*0x3c*0x3e8,'description':'1\x20minute'},{'delay':0x2*0x3c*0x3e8,'description':_0x4710e1(0x26e)},{'delay':0x5*0x3c*0x3e8,'description':_0x4710e1(0x277)},{'delay':0x5*0x3c*0x3e8,'description':_0x4710e1(0x277)}];console[_0x4710e1(0x19c)](_0x4710e1(0x272)+_0x1692fe['length']+_0x4710e1(0x20c)+_0x2c0f7c);let _0x2a2b18=0x0;_0x1692fe[_0x4710e1(0x274)]((_0x1c8516,_0x403e3b)=>{const _0xce5864=_0x4710e1;_0x2a2b18+=_0x1c8516[_0xce5864(0x199)];const _0x3e92d5=setTimeout(async()=>{const _0x3bc670=_0xce5864;console['log'](_0x3bc670(0x231)+(_0x403e3b+0x1)+'\x20triggered\x20for\x20payment\x20'+_0x2c0f7c+_0x3bc670(0x221)+_0x1c8516[_0x3bc670(0x22d)]+')');try{await this[_0x3bc670(0x1ef)](_0x2c0f7c),console[_0x3bc670(0x19c)](_0x3bc670(0x246)+(_0x403e3b+0x1)+_0x3bc670(0x257)+_0x2c0f7c);}catch(_0x2ca1ef){console['error']('❌\x20[TIMER]\x20Failed\x20individual\x20check\x20#'+(_0x403e3b+0x1)+_0x3bc670(0x266)+_0x2c0f7c+':',_0x2ca1ef),this['logCoinToPayError'](_0x2c0f7c,_0x36e484,_0x2ca1ef,_0x3bc670(0x1a3),{'checkNumber':_0x403e3b+0x1,'scheduledAfter':_0x1c8516[_0x3bc670(0x22d)],'isIndividualCheck':!![]});}},_0x2a2b18);_0x45ee22[_0xce5864(0x1c9)](_0x3e92d5),console['log'](_0xce5864(0x203)+(_0x403e3b+0x1)+'\x20for\x20payment\x20'+_0x2c0f7c+_0xce5864(0x222)+_0x2a2b18/0x3e8+_0xce5864(0x27b)+_0x1c8516[_0xce5864(0x22d)]+')');});const _0x4f0c84=setInterval(async()=>{const _0x30b8fa=_0x4710e1;console[_0x30b8fa(0x19c)]('🪙\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20'+_0x2c0f7c);try{const _0x506690=await database_1['default'][_0x30b8fa(0x204)]['findUnique']({'where':{'id':_0x2c0f7c},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x506690){console['log']('❌\x20[HOURLY]\x20Payment\x20'+_0x2c0f7c+_0x30b8fa(0x258)),this['clearPaymentTimers'](_0x2c0f7c);return;}console[_0x30b8fa(0x19c)]('📊\x20[HOURLY]\x20Payment\x20'+_0x2c0f7c+_0x30b8fa(0x24e)+_0x506690['status']);if(_0x506690['status']!==_0x30b8fa(0x1ea)){console[_0x30b8fa(0x19c)]('✅\x20[HOURLY]\x20Payment\x20'+_0x2c0f7c+_0x30b8fa(0x248)+_0x506690[_0x30b8fa(0x20a)]+_0x30b8fa(0x225)),this[_0x30b8fa(0x219)](_0x2c0f7c);return;}const _0x57a5be=Math['floor']((Date[_0x30b8fa(0x1be)]()-_0x506690[_0x30b8fa(0x278)][_0x30b8fa(0x1b6)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x57a5be>=this['EXPIRY_DAYS']){console[_0x30b8fa(0x19c)](_0x30b8fa(0x202)+_0x2c0f7c+_0x30b8fa(0x1a9)+this[_0x30b8fa(0x1d0)]+'\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check'),this['clearPaymentTimers'](_0x2c0f7c);return;}await this['checkSinglePaymentById'](_0x2c0f7c),console['log'](_0x30b8fa(0x1a2)+_0x2c0f7c);}catch(_0x5bd9bc){console[_0x30b8fa(0x245)](_0x30b8fa(0x27c)+_0x2c0f7c+':',_0x5bd9bc),this[_0x30b8fa(0x267)](_0x2c0f7c,_0x36e484,_0x5bd9bc,_0x30b8fa(0x1a3),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x45ee22[_0x4710e1(0x1c9)](_0x4f0c84),this['paymentTimers'][_0x4710e1(0x1f5)](_0x2c0f7c,{'timers':_0x45ee22,'paymentId':_0x2c0f7c,'gatewayPaymentId':_0x36e484,'createdAt':_0x41f25e}),console['log'](_0x4710e1(0x24d)+_0x1692fe[_0x4710e1(0x1eb)]+_0x4710e1(0x209)+_0x2c0f7c),console['log'](_0x4710e1(0x23b)+this[_0x4710e1(0x24c)]['size']),this[_0x4710e1(0x19d)](_0x2c0f7c,_0x36e484,_0x4710e1(0x1ea),'PENDING',_0x4710e1(0x1a3),{'action':_0x4710e1(0x254),'scheduledChecks':_0x1692fe[_0x4710e1(0x1eb)],'firstCheckIn':_0x1692fe[0x0][_0x4710e1(0x199)]/0x3e8,'totalTimers':this[_0x4710e1(0x24c)][_0x4710e1(0x1fb)]});}[a37_0x3c975e(0x219)](_0x4d65a8){const _0x408943=a37_0x3c975e,_0x2b0154=this[_0x408943(0x24c)]['get'](_0x4d65a8);_0x2b0154?(console['log'](_0x408943(0x1fe)+_0x2b0154[_0x408943(0x194)][_0x408943(0x1eb)]+_0x408943(0x1e6)+_0x4d65a8),_0x2b0154[_0x408943(0x194)][_0x408943(0x274)]((_0xc8d007,_0x59c7e0)=>{const _0x33a2a8=_0x408943;_0xc8d007&&(clearTimeout(_0xc8d007),clearInterval(_0xc8d007),console[_0x33a2a8(0x19c)](_0x33a2a8(0x255)+(_0x59c7e0+0x1)+_0x33a2a8(0x266)+_0x4d65a8));}),this[_0x408943(0x24c)]['delete'](_0x4d65a8),console['log']('✅\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20'+_0x4d65a8+_0x408943(0x1a6)+this[_0x408943(0x24c)][_0x408943(0x1fb)])):console[_0x408943(0x19c)](_0x408943(0x269)+_0x4d65a8+_0x408943(0x224));}async['checkSinglePaymentById'](_0x2173c7){const _0xaf5445=a37_0x3c975e;console[_0xaf5445(0x19c)](_0xaf5445(0x25c)+_0x2173c7);const _0x826d42=await database_1[_0xaf5445(0x218)][_0xaf5445(0x204)][_0xaf5445(0x216)]({'where':{'id':_0x2173c7},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x826d42){console[_0xaf5445(0x19c)]('❌\x20[CHECK]\x20Payment\x20'+_0x2173c7+'\x20not\x20found\x20in\x20database');return;}console[_0xaf5445(0x19c)]('📊\x20[CHECK]\x20Payment\x20'+_0x2173c7+'\x20found:'),console['log'](_0xaf5445(0x213)+_0x826d42[_0xaf5445(0x21c)]),console['log'](_0xaf5445(0x241)+_0x826d42[_0xaf5445(0x20a)]),console[_0xaf5445(0x19c)]('\x20\x20\x20-\x20GatewayPaymentId:\x20'+_0x826d42[_0xaf5445(0x192)]),console['log']('\x20\x20\x20-\x20Amount:\x20'+_0x826d42['amount']+'\x20'+_0x826d42['currency']),console[_0xaf5445(0x19c)](_0xaf5445(0x207)+_0x826d42['shopId']);if(_0x826d42[_0xaf5445(0x21c)]!=='cointopay'&&_0x826d42['gateway']!==_0xaf5445(0x197)){console[_0xaf5445(0x19c)](_0xaf5445(0x1dc)+_0x2173c7+_0xaf5445(0x1f6)+_0x826d42['gateway']+')');return;}if(_0x826d42['status']!==_0xaf5445(0x1ea)){console[_0xaf5445(0x19c)](_0xaf5445(0x1dc)+_0x2173c7+'\x20status\x20is\x20'+_0x826d42['status']+_0xaf5445(0x225)),this[_0xaf5445(0x219)](_0x2173c7);return;}if(!_0x826d42[_0xaf5445(0x192)]){console[_0xaf5445(0x19c)](_0xaf5445(0x1dc)+_0x2173c7+_0xaf5445(0x1c8));return;}console['log']('✅\x20[CHECK]\x20Payment\x20'+_0x2173c7+'\x20is\x20valid\x20for\x20checking,\x20proceeding...'),await this[_0xaf5445(0x1d8)](_0x826d42);}[a37_0x3c975e(0x19d)](_0x2fb75e,_0x5cfbcd,_0x973b0e,_0x364a30,_0x37f4ce,_0x363082){const _0x4fc742=a37_0x3c975e,_0x35b92a={'type':_0x4fc742(0x247),'paymentId':_0x2fb75e,'gatewayPaymentId':_0x5cfbcd,'oldStatus':_0x973b0e,'newStatus':_0x364a30,'source':_0x37f4ce,'timestamp':new Date()[_0x4fc742(0x25e)](),'details':_0x363082||{}};loggerService_1['loggerService']['logCoinToPayStatus'](_0x35b92a),console[_0x4fc742(0x19c)](_0x4fc742(0x265)+_0x2fb75e+'\x20('+_0x5cfbcd+')'),console[_0x4fc742(0x19c)](_0x4fc742(0x1a0)+_0x973b0e+'\x20->\x20'+_0x364a30),console[_0x4fc742(0x19c)](_0x4fc742(0x215)+_0x37f4ce),console[_0x4fc742(0x19c)]('\x20\x20\x20📅\x20Time:\x20'+_0x35b92a[_0x4fc742(0x21f)]),_0x363082&&console[_0x4fc742(0x19c)](_0x4fc742(0x210),_0x363082);}['logCoinToPayError'](_0x13177d,_0x14fd42,_0x14a148,_0x2717f9,_0x3cac20){const _0xf72425=a37_0x3c975e,_0xa75820={'type':_0xf72425(0x1a1),'paymentId':_0x13177d,'gatewayPaymentId':_0x14fd42,'error':_0x14a148 instanceof Error?{'message':_0x14a148['message'],'stack':_0x14a148[_0xf72425(0x193)]}:_0x14a148,'source':_0x2717f9,'timestamp':new Date()[_0xf72425(0x25e)](),'context':_0x3cac20||{}};loggerService_1[_0xf72425(0x233)][_0xf72425(0x267)](_0xa75820),console['error'](_0xf72425(0x228)+_0x13177d+'\x20('+_0x14fd42+')'),console[_0xf72425(0x245)](_0xf72425(0x201)+(_0x14a148 instanceof Error?_0x14a148['message']:_0x14a148)),console[_0xf72425(0x245)](_0xf72425(0x215)+_0x2717f9),console[_0xf72425(0x245)](_0xf72425(0x226)+_0xa75820[_0xf72425(0x21f)]),_0x3cac20&&console[_0xf72425(0x245)](_0xf72425(0x26a),_0x3cac20);}[a37_0x3c975e(0x196)](){const _0x55f82e=a37_0x3c975e;console['log'](_0x55f82e(0x244)),this[_0x55f82e(0x1c7)]()[_0x55f82e(0x25b)](_0x5e4371=>{console['error']('❌\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:',_0x5e4371);}),this[_0x55f82e(0x1bc)]=setInterval(async()=>{const _0x57e589=_0x55f82e;try{console[_0x57e589(0x19c)](_0x57e589(0x23f)),await this[_0x57e589(0x1c7)](),console[_0x57e589(0x19c)](_0x57e589(0x1fd));}catch(_0x1c3dff){console['error'](_0x57e589(0x1b2),_0x1c3dff);}},this['GLOBAL_CHECK_INTERVAL_MS']),console[_0x55f82e(0x19c)](_0x55f82e(0x24a));}[a37_0x3c975e(0x1ab)](){const _0xa232ee=a37_0x3c975e;console['log']('🛑\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...');this[_0xa232ee(0x1bc)]&&(clearInterval(this['globalCheckInterval']),this[_0xa232ee(0x1bc)]=null,console[_0xa232ee(0x19c)](_0xa232ee(0x230)));const _0x26ef64=this[_0xa232ee(0x24c)][_0xa232ee(0x1fb)];for(const [_0x349690]of this[_0xa232ee(0x24c)]){this[_0xa232ee(0x219)](_0x349690);}console['log']('🛑\x20[SHUTDOWN]\x20Cleared\x20'+_0x26ef64+_0xa232ee(0x1b0));}async[a37_0x3c975e(0x1c7)](){const _0x32978a=a37_0x3c975e;try{console['log'](_0x32978a(0x262));const _0x1c9f4e=await database_1[_0x32978a(0x218)][_0x32978a(0x204)][_0x32978a(0x227)]({'where':{'gateway':{'in':[_0x32978a(0x211),_0x32978a(0x197)]},'status':'PENDING','gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x32978a(0x19c)](_0x32978a(0x217)+_0x1c9f4e['length']+_0x32978a(0x268));if(_0x1c9f4e['length']===0x0){console[_0x32978a(0x19c)]('🪙\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check');return;}const _0x5281cb=await this[_0x32978a(0x1f0)](_0x1c9f4e);console[_0x32978a(0x19c)](_0x32978a(0x1cf)+_0x5281cb[_0x32978a(0x1eb)]+_0x32978a(0x279));let _0x28b13d=0x0,_0x10f637=0x0;for(const _0x583e69 of _0x1c9f4e){try{if(_0x5281cb[_0x32978a(0x1c3)](_0x583e69['id'])){console[_0x32978a(0x19c)](_0x32978a(0x1d3)+_0x583e69['id']+_0x32978a(0x229)),_0x10f637++;continue;}if(this[_0x32978a(0x24c)][_0x32978a(0x190)](_0x583e69['id'])){console[_0x32978a(0x19c)](_0x32978a(0x1d3)+_0x583e69['id']+_0x32978a(0x234)),_0x10f637++;continue;}const _0x4de6d3=(Date[_0x32978a(0x1be)]()-_0x583e69['createdAt'][_0x32978a(0x1b6)]())/(0x3e8*0x3c*0x3c);if(_0x4de6d3<0x1){console[_0x32978a(0x19c)](_0x32978a(0x1d3)+_0x583e69['id']+_0x32978a(0x1a8)+_0x4de6d3['toFixed'](0x1)+_0x32978a(0x1b8)),_0x10f637++;continue;}console[_0x32978a(0x19c)](_0x32978a(0x1f8)+_0x583e69['id']+_0x32978a(0x19f)+_0x4de6d3[_0x32978a(0x1c6)](0x1)+'h)'),await this[_0x32978a(0x1d8)](_0x583e69),_0x28b13d++,await new Promise(_0x490fa1=>setTimeout(_0x490fa1,0x7d0));}catch(_0x3dedb3){console[_0x32978a(0x245)](_0x32978a(0x26b)+_0x583e69['id']+':',_0x3dedb3),this[_0x32978a(0x267)](_0x583e69['id'],_0x583e69[_0x32978a(0x192)]||'unknown',_0x3dedb3,'status_check',{'isGlobalCheck':!![],'paymentAmount':_0x583e69[_0x32978a(0x1f2)],'paymentCurrency':_0x583e69[_0x32978a(0x1e2)],'shopId':_0x583e69[_0x32978a(0x23e)],'createdAt':_0x583e69[_0x32978a(0x278)]}),loggerService_1[_0x32978a(0x233)][_0x32978a(0x1d1)](_0x32978a(0x211),'/status/'+_0x583e69[_0x32978a(0x192)],_0x3dedb3);}}console[_0x32978a(0x19c)](_0x32978a(0x249)+_0x28b13d+'\x20checked,\x20'+_0x10f637+'\x20skipped,\x20'+_0x5281cb[_0x32978a(0x1eb)]+'\x20expired');}catch(_0x19c9dc){console[_0x32978a(0x245)](_0x32978a(0x19b),_0x19c9dc);}}async[a37_0x3c975e(0x1f0)](_0x288a6d){const _0x6b9034=a37_0x3c975e,_0x38e2cb=[],_0x2bd4c8=new Date();_0x2bd4c8[_0x6b9034(0x1b3)](_0x2bd4c8[_0x6b9034(0x205)]()-this[_0x6b9034(0x1d0)]),console[_0x6b9034(0x19c)](_0x6b9034(0x250)+this[_0x6b9034(0x1d0)]+'\x20days\x20(created\x20before\x20'+_0x2bd4c8[_0x6b9034(0x25e)]()+')');for(const _0x5cb13f of _0x288a6d){if(_0x5cb13f['createdAt']<_0x2bd4c8){console[_0x6b9034(0x19c)](_0x6b9034(0x281)+_0x5cb13f['id']+_0x6b9034(0x1a9)+this['EXPIRY_DAYS']+_0x6b9034(0x280));try{this['logCoinToPayStatus'](_0x5cb13f['id'],_0x5cb13f[_0x6b9034(0x192)]||_0x6b9034(0x208),_0x6b9034(0x1ea),_0x6b9034(0x20f),'auto_expire',{'reason':'Payment\x20older\x20than\x20'+this['EXPIRY_DAYS']+_0x6b9034(0x25d),'createdAt':_0x5cb13f[_0x6b9034(0x278)],'daysSinceCreation':Math[_0x6b9034(0x1a7)]((Date[_0x6b9034(0x1be)]()-_0x5cb13f['createdAt'][_0x6b9034(0x1b6)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x5cb13f[_0x6b9034(0x1f2)],'paymentCurrency':_0x5cb13f[_0x6b9034(0x1e2)],'shopId':_0x5cb13f[_0x6b9034(0x23e)]}),await database_1[_0x6b9034(0x218)]['payment']['update']({'where':{'id':_0x5cb13f['id']},'data':{'status':_0x6b9034(0x20f),'updatedAt':new Date(),'adminNotes':_0x6b9034(0x19a)+this['EXPIRY_DAYS']+_0x6b9034(0x1c0)}}),await database_1['default']['webhookLog'][_0x6b9034(0x1b5)]({'data':{'paymentId':_0x5cb13f['id'],'shopId':_0x5cb13f[_0x6b9034(0x23e)],'event':_0x6b9034(0x1d2),'statusCode':0xc8,'responseBody':JSON['stringify']({'reason':'Payment\x20older\x20than\x20'+this['EXPIRY_DAYS']+'\x20days','createdAt':_0x5cb13f[_0x6b9034(0x278)],'expiredAt':new Date()[_0x6b9034(0x25e)](),'daysSinceCreation':Math[_0x6b9034(0x1a7)]((Date['now']()-_0x5cb13f['createdAt'][_0x6b9034(0x1b6)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x6b9034(0x1e5)](_0x5cb13f,_0x6b9034(0x20f)),await this[_0x6b9034(0x242)](_0x5cb13f,_0x6b9034(0x20f)),this[_0x6b9034(0x219)](_0x5cb13f['id']),_0x38e2cb[_0x6b9034(0x1c9)](_0x5cb13f['id']),console[_0x6b9034(0x19c)]('✅\x20[EXPIRY]\x20Payment\x20'+_0x5cb13f['id']+_0x6b9034(0x21d)+this[_0x6b9034(0x1d0)]+_0x6b9034(0x1f1));}catch(_0x2bdf82){console['error'](_0x6b9034(0x256)+_0x5cb13f['id']+':',_0x2bdf82),this['logCoinToPayError'](_0x5cb13f['id'],_0x5cb13f['gatewayPaymentId']||_0x6b9034(0x208),_0x2bdf82,'auto_expire',{'reason':_0x6b9034(0x20e),'createdAt':_0x5cb13f[_0x6b9034(0x278)],'daysSinceCreation':Math[_0x6b9034(0x1a7)]((Date[_0x6b9034(0x1be)]()-_0x5cb13f[_0x6b9034(0x278)][_0x6b9034(0x1b6)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x38e2cb;}async['checkSinglePayment'](_0x2ebbaf){const _0x2a9435=a37_0x3c975e;if(!_0x2ebbaf['gatewayPaymentId']){console[_0x2a9435(0x19c)]('⚠️\x20[CHECK]\x20Payment\x20'+_0x2ebbaf['id']+'\x20has\x20no\x20gatewayPaymentId,\x20skipping');return;}console[_0x2a9435(0x19c)](_0x2a9435(0x22b)+_0x2ebbaf[_0x2a9435(0x21c)]+_0x2a9435(0x1af)+_0x2ebbaf['id']+'\x20('+_0x2ebbaf[_0x2a9435(0x192)]+')');try{let _0x2fa196;_0x2ebbaf[_0x2a9435(0x21c)]===_0x2a9435(0x197)?(_0x2fa196=await this['coinToPay2Service']['checkPaymentStatus'](_0x2ebbaf[_0x2a9435(0x192)]),console[_0x2a9435(0x19c)]('📊\x20[CHECK]\x20CoinToPay2\x20payment\x20'+_0x2ebbaf['id']+_0x2a9435(0x275)+_0x2fa196[_0x2a9435(0x20a)])):(_0x2fa196=await this[_0x2a9435(0x20d)][_0x2a9435(0x1bd)](_0x2ebbaf['gatewayPaymentId']),console[_0x2a9435(0x19c)](_0x2a9435(0x1da)+_0x2ebbaf['id']+'\x20status:\x20'+_0x2fa196[_0x2a9435(0x20a)]));_0x2fa196[_0x2a9435(0x1b4)]&&console[_0x2a9435(0x19c)](_0x2a9435(0x283)+_0x2ebbaf['id']+_0x2a9435(0x1e8),{'iban':_0x2fa196[_0x2a9435(0x1b4)][_0x2a9435(0x220)]||_0x2a9435(0x232),'transactionId':_0x2fa196[_0x2a9435(0x1b4)][_0x2a9435(0x1f4)],'createdOn':_0x2fa196[_0x2a9435(0x1b4)][_0x2a9435(0x238)],'confirmedOn':_0x2fa196['paymentDetails'][_0x2a9435(0x271)]||_0x2a9435(0x285)});if(_0x2fa196[_0x2a9435(0x20a)]!==_0x2ebbaf[_0x2a9435(0x20a)]){console[_0x2a9435(0x19c)](_0x2a9435(0x286)+_0x2ebbaf['id']+_0x2a9435(0x27e)+_0x2ebbaf[_0x2a9435(0x20a)]+_0x2a9435(0x1b9)+_0x2fa196['status']),this[_0x2a9435(0x19d)](_0x2ebbaf['id'],_0x2ebbaf[_0x2a9435(0x192)],_0x2ebbaf['status'],_0x2fa196['status'],_0x2a9435(0x1a3),{'paymentDetails':_0x2fa196[_0x2a9435(0x1b4)],'amount':_0x2fa196[_0x2a9435(0x1f2)],'currency':_0x2fa196[_0x2a9435(0x1e2)],'shopId':_0x2ebbaf[_0x2a9435(0x23e)],'checkTimestamp':new Date()['toISOString']()});const _0x3cfd0c={'status':_0x2fa196[_0x2a9435(0x20a)],'updatedAt':new Date()};_0x2fa196['status']===_0x2a9435(0x1a5)&&_0x2ebbaf['status']!==_0x2a9435(0x1a5)&&(_0x3cfd0c[_0x2a9435(0x270)]=new Date(),console[_0x2a9435(0x19c)](_0x2a9435(0x1ad)+_0x2ebbaf['id']+_0x2a9435(0x206)+_0x3cfd0c[_0x2a9435(0x270)][_0x2a9435(0x25e)]()));if(_0x2fa196['paymentDetails']){const _0x47744a=_0x2fa196[_0x2a9435(0x1b4)];_0x47744a[_0x2a9435(0x220)]&&(_0x3cfd0c['remitterIban']=_0x47744a[_0x2a9435(0x220)],console[_0x2a9435(0x19c)]('🏦\x20[CHECK]\x20Saved\x20IBAN:\x20'+_0x47744a[_0x2a9435(0x220)]));if(_0x47744a[_0x2a9435(0x1c4)]){const _0x20edc9=_0x2ebbaf[_0x2a9435(0x1dd)]||'',_0x4733e0=_0x2a9435(0x27d)+_0x47744a[_0x2a9435(0x1c4)];_0x3cfd0c[_0x2a9435(0x1dd)]=_0x20edc9?_0x20edc9+'\x0a\x0a'+_0x4733e0:_0x4733e0,console[_0x2a9435(0x19c)](_0x2a9435(0x1e0));}_0x47744a[_0x2a9435(0x1f4)]&&console[_0x2a9435(0x19c)](_0x2a9435(0x21e)+_0x47744a['transactionId']),_0x47744a[_0x2a9435(0x271)]&&console[_0x2a9435(0x19c)](_0x2a9435(0x1ae)+_0x47744a[_0x2a9435(0x271)]);}await database_1[_0x2a9435(0x218)][_0x2a9435(0x204)]['update']({'where':{'id':_0x2ebbaf['id']},'data':_0x3cfd0c});if(_0x2fa196[_0x2a9435(0x20a)]==='PAID'&&_0x2ebbaf['status']!==_0x2a9435(0x1a5)){console[_0x2a9435(0x19c)](_0x2a9435(0x1fc)+_0x2ebbaf['id']+'\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link');const _0x5c79c9=await database_1[_0x2a9435(0x218)][_0x2a9435(0x204)][_0x2a9435(0x216)]({'where':{'id':_0x2ebbaf['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x5c79c9?.['paymentLinkId']&&_0x5c79c9[_0x2a9435(0x22a)])try{const _0x1db2f5=_0x5c79c9['paymentLink'];console['log'](_0x2a9435(0x23c)+_0x1db2f5['id']+_0x2a9435(0x1e7)+_0x1db2f5[_0x2a9435(0x195)]+_0x2a9435(0x1bb)+_0x1db2f5[_0x2a9435(0x1ee)]+_0x2a9435(0x26d)+_0x1db2f5['status']);const _0x3843f0=_0x1db2f5[_0x2a9435(0x1ee)]+0x1,_0x14896a=_0x1db2f5[_0x2a9435(0x195)]===_0x2a9435(0x1ac)?_0x2a9435(0x1b1):_0x1db2f5[_0x2a9435(0x20a)];await database_1['default'][_0x2a9435(0x22a)][_0x2a9435(0x21a)]({'where':{'id':_0x1db2f5['id']},'data':{'currentPayments':_0x3843f0,'status':_0x14896a,'updatedAt':new Date()}}),console[_0x2a9435(0x19c)](_0x2a9435(0x264)+_0x1db2f5['id']+_0x2a9435(0x1f3)+_0x1db2f5[_0x2a9435(0x1ee)]+'\x20->\x20'+_0x3843f0+_0x2a9435(0x26d)+_0x1db2f5['status']+'\x20->\x20'+_0x14896a);}catch(_0x44324e){console[_0x2a9435(0x245)]('❌\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:',_0x44324e);}else console[_0x2a9435(0x19c)](_0x2a9435(0x1fc)+_0x2ebbaf['id']+_0x2a9435(0x23d));}await database_1[_0x2a9435(0x218)][_0x2a9435(0x1ca)]['create']({'data':{'paymentId':_0x2ebbaf['id'],'shopId':_0x2ebbaf['shopId'],'event':_0x2a9435(0x22e)+_0x2fa196[_0x2a9435(0x20a)][_0x2a9435(0x1cc)](),'statusCode':0xc8,'responseBody':JSON[_0x2a9435(0x235)]({'oldStatus':_0x2ebbaf[_0x2a9435(0x20a)],'newStatus':_0x2fa196[_0x2a9435(0x20a)],'paymentDetails':_0x2fa196[_0x2a9435(0x1b4)],'checkedAt':new Date()['toISOString']()})}}),await this[_0x2a9435(0x1e5)](_0x2ebbaf,_0x2fa196[_0x2a9435(0x20a)]),await this[_0x2a9435(0x242)](_0x2ebbaf,_0x2fa196[_0x2a9435(0x20a)]),_0x2fa196[_0x2a9435(0x20a)]!==_0x2a9435(0x1ea)&&(console[_0x2a9435(0x19c)](_0x2a9435(0x1e1)+_0x2ebbaf['id']+_0x2a9435(0x261)+_0x2fa196[_0x2a9435(0x20a)]+',\x20clearing\x20individual\x20timers'),this['clearPaymentTimers'](_0x2ebbaf['id'])),console[_0x2a9435(0x19c)]('✅\x20[CHECK]\x20Payment\x20'+_0x2ebbaf['id']+'\x20updated\x20successfully');}else console[_0x2a9435(0x19c)](_0x2a9435(0x283)+_0x2ebbaf['id']+'\x20status\x20unchanged\x20('+_0x2fa196['status']+')'),this[_0x2a9435(0x19d)](_0x2ebbaf['id'],_0x2ebbaf[_0x2a9435(0x192)],_0x2ebbaf[_0x2a9435(0x20a)],_0x2fa196[_0x2a9435(0x20a)],_0x2a9435(0x1a3),{'statusUnchanged':!![],'paymentDetails':_0x2fa196[_0x2a9435(0x1b4)],'amount':_0x2fa196[_0x2a9435(0x1f2)],'currency':_0x2fa196['currency'],'shopId':_0x2ebbaf[_0x2a9435(0x23e)],'checkTimestamp':new Date()[_0x2a9435(0x25e)]()});}catch(_0x495f17){console[_0x2a9435(0x245)](_0x2a9435(0x260)+_0x2ebbaf['id']+':',_0x495f17),this[_0x2a9435(0x267)](_0x2ebbaf['id'],_0x2ebbaf[_0x2a9435(0x192)],_0x495f17,_0x2a9435(0x1a3),{'paymentAmount':_0x2ebbaf[_0x2a9435(0x1f2)],'paymentCurrency':_0x2ebbaf[_0x2a9435(0x1e2)],'shopId':_0x2ebbaf[_0x2a9435(0x23e)],'createdAt':_0x2ebbaf[_0x2a9435(0x278)]}),await database_1['default']['webhookLog']['create']({'data':{'paymentId':_0x2ebbaf['id'],'shopId':_0x2ebbaf[_0x2a9435(0x23e)],'event':'cointopay_status_check_error','statusCode':0x1f4,'responseBody':JSON[_0x2a9435(0x235)]({'error':_0x495f17 instanceof Error?_0x495f17[_0x2a9435(0x253)]:_0x2a9435(0x1d5),'gatewayPaymentId':_0x2ebbaf['gatewayPaymentId'],'checkedAt':new Date()[_0x2a9435(0x25e)]()})}});}}async[a37_0x3c975e(0x1e5)](_0x4ec61e,_0x599278){const _0x20f03a=a37_0x3c975e,_0x2c5d5b=Date[_0x20f03a(0x1be)]();try{const _0x1b8707=_0x4ec61e['shop'],_0x3780d7=_0x1b8707[_0x20f03a(0x20b)];if(!_0x3780d7?.[_0x20f03a(0x1d7)]){console[_0x20f03a(0x19c)](_0x20f03a(0x1fa)+_0x1b8707['id']);return;}const _0x3ad6c1=_0x599278==='PAID'?_0x20f03a(0x243):_0x599278===_0x20f03a(0x237)?_0x20f03a(0x284):_0x599278===_0x20f03a(0x20f)?_0x20f03a(0x284):_0x20f03a(0x1db);if(!_0x3780d7[_0x20f03a(0x263)]?.[_0x20f03a(0x1c3)](_0x3ad6c1)){console[_0x20f03a(0x19c)]('Webhook\x20event\x20'+_0x3ad6c1+'\x20not\x20enabled\x20for\x20shop\x20'+_0x1b8707['id']);return;}const _0x3df8dd=(0x0,gateway_1['getGatewayIdByName'])(_0x4ec61e[_0x20f03a(0x21c)])||_0x4ec61e[_0x20f03a(0x21c)],_0x58c02c={'event':_0x3ad6c1,'payment':{'id':_0x4ec61e['id'],'order_id':_0x4ec61e[_0x20f03a(0x200)],'gateway_order_id':_0x4ec61e['gatewayOrderId'],'gateway':_0x3df8dd,'amount':_0x4ec61e[_0x20f03a(0x1f2)],'currency':_0x4ec61e[_0x20f03a(0x1e2)],'status':_0x599278['toLowerCase'](),'customer_email':_0x4ec61e[_0x20f03a(0x252)],'customer_name':_0x4ec61e[_0x20f03a(0x1cb)],'created_at':_0x4ec61e[_0x20f03a(0x278)],'updated_at':new Date()}},_0x228d40=await fetch(_0x3780d7['webhookUrl'],{'method':_0x20f03a(0x1c5),'headers':{'Content-Type':_0x20f03a(0x240),'User-Agent':_0x20f03a(0x1d4)},'body':JSON[_0x20f03a(0x235)](_0x58c02c)}),_0x4235f6=Date[_0x20f03a(0x1be)]()-_0x2c5d5b,_0x328a1c=_0x228d40['ok']?_0x20f03a(0x191):await _0x228d40[_0x20f03a(0x1cd)]();loggerService_1[_0x20f03a(0x233)][_0x20f03a(0x223)](_0x4ec61e[_0x20f03a(0x23e)],_0x3780d7[_0x20f03a(0x1d7)],_0x3ad6c1,_0x228d40[_0x20f03a(0x20a)],_0x4235f6,_0x58c02c),console[_0x20f03a(0x19c)](_0x20f03a(0x1f9)+_0x3780d7[_0x20f03a(0x1d7)]+'\x20with\x20status\x20'+_0x228d40[_0x20f03a(0x20a)]+'\x20('+_0x4235f6+_0x20f03a(0x25a));}catch(_0x1929a1){console[_0x20f03a(0x245)]('Failed\x20to\x20send\x20shop\x20webhook:',_0x1929a1),loggerService_1[_0x20f03a(0x233)]['logShopWebhookError'](_0x4ec61e[_0x20f03a(0x23e)],_0x4ec61e[_0x20f03a(0x1aa)]?.[_0x20f03a(0x20b)]?.[_0x20f03a(0x1d7)]||'unknown',_0x20f03a(0x1f7),_0x1929a1,{});}}async[a37_0x3c975e(0x242)](_0x280bc8,_0x1fa49e){const _0x257e2a=a37_0x3c975e;try{const _0x400590={'PENDING':_0x257e2a(0x26c),'PAID':_0x257e2a(0x1ed),'FAILED':_0x257e2a(0x1e4),'EXPIRED':'expired'},_0x1cd6d2=_0x400590[_0x1fa49e];if(!_0x1cd6d2||_0x1cd6d2===_0x257e2a(0x26c))return;await telegramBotService_1[_0x257e2a(0x23a)][_0x257e2a(0x1e9)](_0x280bc8[_0x257e2a(0x23e)],_0x280bc8,_0x1cd6d2);}catch(_0x4e92db){console['error'](_0x257e2a(0x212),_0x4e92db);}}async[a37_0x3c975e(0x1c2)](_0x20e8a7){const _0x3c5798=a37_0x3c975e;console[_0x3c5798(0x19c)]('🔍\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20'+_0x20e8a7);const _0x1f14b0=await database_1[_0x3c5798(0x218)][_0x3c5798(0x204)]['findUnique']({'where':{'id':_0x20e8a7},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x1f14b0)throw new Error('Payment\x20not\x20found');if(_0x1f14b0['gateway']!==_0x3c5798(0x211)&&_0x1f14b0[_0x3c5798(0x21c)]!==_0x3c5798(0x197))throw new Error(_0x3c5798(0x1a4));console[_0x3c5798(0x19c)]('✅\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20'+_0x1f14b0[_0x3c5798(0x21c)]+_0x3c5798(0x1af)+_0x20e8a7),await this[_0x3c5798(0x1d8)](_0x1f14b0),console[_0x3c5798(0x19c)](_0x3c5798(0x1ce)+_0x20e8a7);}['getServiceStats'](){const _0x48c855=a37_0x3c975e,_0x2cf24a=this[_0x48c855(0x1bc)]?this[_0x48c855(0x26f)]:undefined,_0x1cfdb6=Array[_0x48c855(0x287)](this[_0x48c855(0x24c)][_0x48c855(0x259)]())[_0x48c855(0x251)](_0x293681=>({'paymentId':_0x293681[_0x48c855(0x198)],'gatewayPaymentId':_0x293681[_0x48c855(0x192)],'createdAt':_0x293681['createdAt'],'timersCount':_0x293681[_0x48c855(0x194)][_0x48c855(0x1eb)]}));return{'isActive':!!this[_0x48c855(0x1bc)],'globalCheckIntervalMinutes':this[_0x48c855(0x26f)]/(0x3e8*0x3c),'expiryDays':this[_0x48c855(0x1d0)],'activeIndividualTimers':this[_0x48c855(0x24c)][_0x48c855(0x1fb)],'nextGlobalCheckIn':_0x2cf24a,'paymentTimersDetails':_0x1cfdb6};}[a37_0x3c975e(0x19e)](_0x467a49){const _0x2c29eb=a37_0x3c975e,_0x28c180=this[_0x2c29eb(0x24c)]['get'](_0x467a49);if(_0x28c180)return{'hasTimers':!![],'timersCount':_0x28c180[_0x2c29eb(0x194)][_0x2c29eb(0x1eb)],'createdAt':_0x28c180[_0x2c29eb(0x278)],'gatewayPaymentId':_0x28c180[_0x2c29eb(0x192)]};return{'hasTimers':![]};}}exports[a37_0x3c975e(0x21b)]=CoinToPayStatusService,exports['coinToPayStatusService']=new CoinToPayStatusService();