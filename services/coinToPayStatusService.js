'use strict';const a37_0x143a23=a37_0x3216;(function(_0x1647cf,_0x567df6){const _0x1424d4=a37_0x3216,_0xf55c4f=_0x1647cf();while(!![]){try{const _0xab91f1=parseInt(_0x1424d4(0x1b2))/0x1+-parseInt(_0x1424d4(0x221))/0x2+parseInt(_0x1424d4(0x1a3))/0x3+-parseInt(_0x1424d4(0x1f6))/0x4*(-parseInt(_0x1424d4(0x1e9))/0x5)+-parseInt(_0x1424d4(0x1f7))/0x6*(parseInt(_0x1424d4(0x1ca))/0x7)+-parseInt(_0x1424d4(0x1c6))/0x8+parseInt(_0x1424d4(0x1a6))/0x9;if(_0xab91f1===_0x567df6)break;else _0xf55c4f['push'](_0xf55c4f['shift']());}catch(_0xeaf381){_0xf55c4f['push'](_0xf55c4f['shift']());}}}(a37_0x3511,0xb2f88));var __createBinding=this&&this['__createBinding']||(Object[a37_0x143a23(0x1aa)]?function(_0x333539,_0x806222,_0xae409c,_0x4a7786){const _0x110d61=a37_0x143a23;if(_0x4a7786===undefined)_0x4a7786=_0xae409c;var _0x1dd7d5=Object[_0x110d61(0x1d2)](_0x806222,_0xae409c);(!_0x1dd7d5||(_0x110d61(0x1c8)in _0x1dd7d5?!_0x806222['__esModule']:_0x1dd7d5[_0x110d61(0x1bc)]||_0x1dd7d5['configurable']))&&(_0x1dd7d5={'enumerable':!![],'get':function(){return _0x806222[_0xae409c];}}),Object[_0x110d61(0x183)](_0x333539,_0x4a7786,_0x1dd7d5);}:function(_0x268ad2,_0x181c17,_0x18def4,_0x2e80a1){if(_0x2e80a1===undefined)_0x2e80a1=_0x18def4;_0x268ad2[_0x2e80a1]=_0x181c17[_0x18def4];}),__setModuleDefault=this&&this[a37_0x143a23(0x181)]||(Object['create']?function(_0x10b2bd,_0x1e7395){const _0x4d1945=a37_0x143a23;Object[_0x4d1945(0x183)](_0x10b2bd,_0x4d1945(0x18f),{'enumerable':!![],'value':_0x1e7395});}:function(_0x481b9b,_0x387313){const _0x64e665=a37_0x143a23;_0x481b9b[_0x64e665(0x18f)]=_0x387313;}),__importStar=this&&this[a37_0x143a23(0x22b)]||(function(){var _0x1d1b01=function(_0x53e3d3){const _0x1db203=a37_0x3216;return _0x1d1b01=Object[_0x1db203(0x1b4)]||function(_0x2516d5){const _0x2b0d8d=_0x1db203;var _0x5134a1=[];for(var _0x1bc8ac in _0x2516d5)if(Object[_0x2b0d8d(0x17e)][_0x2b0d8d(0x257)][_0x2b0d8d(0x239)](_0x2516d5,_0x1bc8ac))_0x5134a1[_0x5134a1['length']]=_0x1bc8ac;return _0x5134a1;},_0x1d1b01(_0x53e3d3);};return function(_0x32af2a){const _0x19f0d4=a37_0x3216;if(_0x32af2a&&_0x32af2a[_0x19f0d4(0x1a2)])return _0x32af2a;var _0x132567={};if(_0x32af2a!=null){for(var _0x172f53=_0x1d1b01(_0x32af2a),_0x3021f5=0x0;_0x3021f5<_0x172f53[_0x19f0d4(0x241)];_0x3021f5++)if(_0x172f53[_0x3021f5]!=='default')__createBinding(_0x132567,_0x32af2a,_0x172f53[_0x3021f5]);}return __setModuleDefault(_0x132567,_0x32af2a),_0x132567;};}()),__importDefault=this&&this[a37_0x143a23(0x227)]||function(_0x32aebb){return _0x32aebb&&_0x32aebb['__esModule']?_0x32aebb:{'default':_0x32aebb};};Object[a37_0x143a23(0x183)](exports,'__esModule',{'value':!![]}),exports['coinToPayStatusService']=exports['CoinToPayStatusService']=void 0x0;const coinToPayService_1=require(a37_0x143a23(0x256)),database_1=__importDefault(require('../config/database')),telegramBotService_1=require(a37_0x143a23(0x162)),loggerService_1=require(a37_0x143a23(0x180));function a37_0x3511(){const _0x234119=['\x20triggered\x20for\x20payment\x20','toLowerCase',',\x20clearing\x20individual\x20timers','checkPaymentById','\x20\x20\x20📝\x20Context:','🔍\x20[CHECK]\x20Checking\x20CoinToPay\x20payment\x20','🪙\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','startPeriodicStatusCheck','cointopay_status_check_','delete','\x20status\x20changed\x20to\x20','customerEmail','getServiceStats','size','has','5\x20minutes','schedulePaymentChecks','⏰\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','cointopay_auto_expired','webhookUrl','\x20\x20\x20📝\x20Details:','✅\x20[CHECK]\x20Payment\x20','Payment\x20is\x20not\x20a\x20CoinToPay\x20payment','push','transactionId','webhookEvents','🪙\x20[DEBUG]\x20Creating\x20','💰\x20[CHECK]\x20Payment\x20','expired','logCoinToPayError','GLOBAL_CHECK_INTERVAL_MS','Payment\x20older\x20than\x20','📈\x20[CHECK]\x20Payment\x20link\x20counter\x20updated\x20for\x20payment\x20','❌\x20[TIMER]\x20Failed\x20individual\x20check\x20#','\x20not\x20enabled\x20for\x20shop\x20','2292874RPTCKS','payment.failed','settings','1\x20minute','coinToPayService','\x20status\x20is\x20','__importDefault','🪙\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','globalCheckInterval','Shop\x20webhook\x20sent\x20to\x20','__importStar','\x20(age:\x20','paidAt','forEach','auto_expire','\x20expired','\x20individual\x20payment\x20timers','⏰\x20[GLOBAL]\x20Payment\x20','📊\x20[CHECK]\x20Payment\x20','iban','stopPeriodicStatusCheck','ms)','sendPaymentNotification','schedule_created','call','checkSinglePaymentById','now','\x20is\x20too\x20new\x20(','\x20skipped,\x20','Success','\x20\x20\x20-\x20Amount:\x20','\x20pending\x20CoinToPay\x20payments','length','status_check','\x20to\x20','\x20\x20\x20-\x20paymentId:\x20','paymentId','gatewayPaymentId','stack','payment.pending','getPaymentTimerInfo','❌\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','\x20status\x20from\x20','description','✅\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20CoinToPay\x20payment\x20','\x20is\x20older\x20than\x20','🪙\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','\x20found:','update','toISOString','paymentDetails','❌\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','\x20marked\x20as\x20paid\x20at:\x20','./gateways/coinToPayService','hasOwnProperty','2\x20minutes','🆔\x20[CHECK]\x20Transaction\x20ID:\x20','status','cointopay_status_check_error','🪙\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','CoinToPayStatusService','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','\x20checked,\x20','./telegramBotService','webhookLog','paymentTimers','payment','loggerService','/status/','\x20\x20\x20📊\x20Status:\x20','EXPIRY_DAYS','Failed\x20to\x20mark\x20payment\x20as\x20expired','confirmedOn','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','\x20with\x20status\x20','cointopay','⏰\x20[GLOBAL]\x20Found\x20','\x20is\x20valid\x20for\x20checking,\x20proceeding...','setDate','🪙\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20',',\x20stopping\x20individual\x20checks','getTime','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','\x20current\x20status:\x20','payment.success','telegramBotService','gatewayOrderId','\x20expired\x20CoinToPay\x20payments','✅\x20[HOURLY]\x20Payment\x20','🪙\x20[TIMER]\x20Individual\x20check\x20#','\x20initial\x20timers\x20for\x20payment\x20','prototype','clearPaymentTimers','./loggerService','__setModuleDefault','🧹\x20[DEBUG]\x20Cleared\x20timer\x20#','defineProperty','.\x20Remaining\x20active\x20timers:\x20','🛑\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','\x20\x20\x20📍\x20Source:\x20','🛑\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','logCoinToPayStatus','timestamp','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','✅\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','coinToPayStatusService','✅\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','error','default','gateway','\x20is\x20not\x20a\x20CoinToPay\x20payment\x20(gateway:\x20','logShopWebhookSent','\x20not\x20found\x20in\x20database','paid','checkSinglePayment','📊\x20[HOURLY]\x20Payment\x20','✅\x20[TIMER]\x20Individual\x20check\x20#','delay','0100','from','POST','Bank\x20Details:\x20','🔍\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','🔍\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','shopId','❌\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','❌\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','__esModule','522330IRKjGk','🧹\x20[CHECK]\x20Payment\x20','Failed\x20to\x20send\x20shop\x20webhook:','16754130AkcsxN','\x20details:','currency','❌\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','create','\x20updated\x20successfully','webhook_send','\x20\x20\x20-\x20gatewayPaymentId:\x20','❌\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','🏦\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes','timers','amount','1307995SKNyug','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','getOwnPropertyNames','🔍\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','\x20days','not\x20confirmed','PAID','❌\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','sendPaymentStatusNotification','writable','❌\x20[CHECK]\x20Payment\x20','\x20\x20\x20📅\x20Time:\x20','adminNotes','⚠️\x20[CHECK]\x20Payment\x20','COINTOPAY_ERROR','checkAllPendingPayments','bankDetails','\x20\x20\x20-\x20Status:\x20','⏰\x20[HOURLY]\x20Payment\x20','1148800Yuvqak','logWhiteDomainError','get','✅\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','182hLXSFL','logShopWebhookError','getDate','\x20in\x20','🧹\x20[DEBUG]\x20Clearing\x20','Unknown\x20error','catch','🛑\x20[SHUTDOWN]\x20Cleared\x20','getOwnPropertyDescriptor','❌\x20[HOURLY]\x20Payment\x20','Payment\x20not\x20found','text','set','🪙\x20[ERROR]\x20CoinToPay\x20Error:\x20','🔄\x20[CHECK]\x20Updating\x20payment\x20','🪙\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','message','checkExpiredPayments','./paymentLinkService','not\x20found','sendShopWebhook','created','FAILED','\x20for\x20payment\x20','handleSuccessfulPayment','shop','createdAt','findUnique','-day\x20timeout','h),\x20skipping\x20global\x20check','🪙\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','45cfOpQk','\x20status:\x20','✅\x20[EXPIRY]\x20Payment\x20','EXPIRED','stringify','\x20(after\x20','PENDING','Automatically\x20expired\x20after\x20','unknown','\x20\x20\x20-\x20Gateway:\x20','floor','⏰\x20[DEBUG]\x20Scheduled\x20check\x20#','checkPaymentStatus','11344avjQub','310638qZYkGx','createdOn','then','TesSoft\x20Payment\x20System/1.0','log','failed','✅\x20[DEBUG]\x20Successfully\x20scheduled\x20'];a37_0x3511=function(){return _0x234119;};return a37_0x3511();}function a37_0x3216(_0x19d516,_0x420539){const _0x3511b8=a37_0x3511();return a37_0x3216=function(_0x3216b0,_0x30a851){_0x3216b0=_0x3216b0-0x15a;let _0x1d68a1=_0x3511b8[_0x3216b0];return _0x1d68a1;},a37_0x3216(_0x19d516,_0x420539);}class CoinToPayStatusService{constructor(){const _0x5286ce=a37_0x143a23;this['globalCheckInterval']=null,this[_0x5286ce(0x21c)]=0x3c*0x3c*0x3e8,this['EXPIRY_DAYS']=0x5,this['paymentTimers']=new Map(),this[_0x5286ce(0x225)]=new coinToPayService_1['CoinToPayService'](),console[_0x5286ce(0x1fb)]('🪙\x20CoinToPayStatusService\x20initialized');}[a37_0x143a23(0x20e)](_0x1be2a7,_0x58ad15){const _0x16e0dc=a37_0x143a23;console[_0x16e0dc(0x1fb)](_0x16e0dc(0x15e)),console['log'](_0x16e0dc(0x244)+_0x1be2a7),console[_0x16e0dc(0x1fb)](_0x16e0dc(0x1ad)+_0x58ad15),this[_0x16e0dc(0x17f)](_0x1be2a7);const _0x272364=[],_0x40fac5=new Date(),_0x31e7e0=[{'delay':0x1*0x3c*0x3e8,'description':_0x16e0dc(0x224)},{'delay':0x2*0x3c*0x3e8,'description':_0x16e0dc(0x15a)},{'delay':0x5*0x3c*0x3e8,'description':'5\x20minutes'},{'delay':0x5*0x3c*0x3e8,'description':_0x16e0dc(0x20d)}];console[_0x16e0dc(0x1fb)](_0x16e0dc(0x218)+_0x31e7e0['length']+_0x16e0dc(0x17d)+_0x1be2a7);let _0x3a41d8=0x0;_0x31e7e0[_0x16e0dc(0x22e)]((_0x3edd63,_0x245f95)=>{const _0x440975=_0x16e0dc;_0x3a41d8+=_0x3edd63[_0x440975(0x198)];const _0x29bd15=setTimeout(async()=>{const _0xc18d1a=_0x440975;console[_0xc18d1a(0x1fb)](_0xc18d1a(0x17c)+(_0x245f95+0x1)+_0xc18d1a(0x1fe)+_0x1be2a7+_0xc18d1a(0x1ee)+_0x3edd63[_0xc18d1a(0x24c)]+')');try{await this[_0xc18d1a(0x23a)](_0x1be2a7),console['log'](_0xc18d1a(0x197)+(_0x245f95+0x1)+'\x20completed\x20for\x20payment\x20'+_0x1be2a7);}catch(_0x479250){console[_0xc18d1a(0x18e)](_0xc18d1a(0x21f)+(_0x245f95+0x1)+'\x20for\x20payment\x20'+_0x1be2a7+':',_0x479250),this['logCoinToPayError'](_0x1be2a7,_0x58ad15,_0x479250,_0xc18d1a(0x242),{'checkNumber':_0x245f95+0x1,'scheduledAfter':_0x3edd63[_0xc18d1a(0x24c)],'isIndividualCheck':!![]});}},_0x3a41d8);_0x272364[_0x440975(0x215)](_0x29bd15),console['log'](_0x440975(0x1f4)+(_0x245f95+0x1)+_0x440975(0x1e1)+_0x1be2a7+_0x440975(0x1cd)+_0x3a41d8/0x3e8+'\x20seconds\x20('+_0x3edd63[_0x440975(0x24c)]+')');});const _0xe0afbd=setInterval(async()=>{const _0x4563f7=_0x16e0dc;console[_0x4563f7(0x1fb)](_0x4563f7(0x228)+_0x1be2a7);try{const _0x3375e0=await database_1['default'][_0x4563f7(0x165)]['findUnique']({'where':{'id':_0x1be2a7},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x3375e0){console[_0x4563f7(0x1fb)](_0x4563f7(0x1d3)+_0x1be2a7+'\x20not\x20found,\x20clearing\x20timers'),this['clearPaymentTimers'](_0x1be2a7);return;}console[_0x4563f7(0x1fb)](_0x4563f7(0x196)+_0x1be2a7+_0x4563f7(0x176)+_0x3375e0[_0x4563f7(0x15c)]);if(_0x3375e0[_0x4563f7(0x15c)]!=='PENDING'){console[_0x4563f7(0x1fb)](_0x4563f7(0x17b)+_0x1be2a7+_0x4563f7(0x226)+_0x3375e0[_0x4563f7(0x15c)]+_0x4563f7(0x173)),this['clearPaymentTimers'](_0x1be2a7);return;}const _0x26c704=Math[_0x4563f7(0x1f3)]((Date['now']()-_0x3375e0[_0x4563f7(0x1e4)][_0x4563f7(0x174)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x26c704>=this[_0x4563f7(0x169)]){console['log'](_0x4563f7(0x1c5)+_0x1be2a7+'\x20is\x20older\x20than\x20'+this[_0x4563f7(0x169)]+_0x4563f7(0x16c)),this['clearPaymentTimers'](_0x1be2a7);return;}await this[_0x4563f7(0x23a)](_0x1be2a7),console[_0x4563f7(0x1fb)]('✅\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20'+_0x1be2a7);}catch(_0x435805){console['error'](_0x4563f7(0x254)+_0x1be2a7+':',_0x435805),this[_0x4563f7(0x21b)](_0x1be2a7,_0x58ad15,_0x435805,_0x4563f7(0x242),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x272364[_0x16e0dc(0x215)](_0xe0afbd),this[_0x16e0dc(0x164)][_0x16e0dc(0x1d6)](_0x1be2a7,{'timers':_0x272364,'paymentId':_0x1be2a7,'gatewayPaymentId':_0x58ad15,'createdAt':_0x40fac5}),console[_0x16e0dc(0x1fb)](_0x16e0dc(0x1fd)+_0x31e7e0[_0x16e0dc(0x241)]+_0x16e0dc(0x175)+_0x1be2a7),console[_0x16e0dc(0x1fb)]('📊\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20'+this[_0x16e0dc(0x164)]['size']),this['logCoinToPayStatus'](_0x1be2a7,_0x58ad15,_0x16e0dc(0x1ef),_0x16e0dc(0x1ef),_0x16e0dc(0x242),{'action':_0x16e0dc(0x238),'scheduledChecks':_0x31e7e0[_0x16e0dc(0x241)],'firstCheckIn':_0x31e7e0[0x0][_0x16e0dc(0x198)]/0x3e8,'totalTimers':this[_0x16e0dc(0x164)][_0x16e0dc(0x20b)]});}[a37_0x143a23(0x17f)](_0x83892b){const _0x366830=a37_0x143a23,_0x5cd39b=this[_0x366830(0x164)][_0x366830(0x1c8)](_0x83892b);_0x5cd39b?(console[_0x366830(0x1fb)](_0x366830(0x1ce)+_0x5cd39b['timers'][_0x366830(0x241)]+'\x20timers\x20for\x20payment\x20'+_0x83892b),_0x5cd39b[_0x366830(0x1b0)][_0x366830(0x22e)]((_0x210d41,_0x17c93f)=>{const _0x49d8cb=_0x366830;_0x210d41&&(clearTimeout(_0x210d41),clearInterval(_0x210d41),console[_0x49d8cb(0x1fb)](_0x49d8cb(0x182)+(_0x17c93f+0x1)+_0x49d8cb(0x1e1)+_0x83892b));}),this[_0x366830(0x164)][_0x366830(0x207)](_0x83892b),console[_0x366830(0x1fb)](_0x366830(0x18d)+_0x83892b+_0x366830(0x184)+this[_0x366830(0x164)][_0x366830(0x20b)])):console[_0x366830(0x1fb)]('⚠️\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20'+_0x83892b+'\x20to\x20clear');}async[a37_0x143a23(0x23a)](_0x2a0d2){const _0xcb1630=a37_0x143a23;console[_0xcb1630(0x1fb)](_0xcb1630(0x19d)+_0x2a0d2);const _0x27ae8b=await database_1[_0xcb1630(0x18f)]['payment'][_0xcb1630(0x1e5)]({'where':{'id':_0x2a0d2},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x27ae8b){console['log'](_0xcb1630(0x1bd)+_0x2a0d2+_0xcb1630(0x193));return;}console[_0xcb1630(0x1fb)](_0xcb1630(0x233)+_0x2a0d2+_0xcb1630(0x250)),console[_0xcb1630(0x1fb)](_0xcb1630(0x1f2)+_0x27ae8b['gateway']),console['log'](_0xcb1630(0x1c4)+_0x27ae8b[_0xcb1630(0x15c)]),console[_0xcb1630(0x1fb)]('\x20\x20\x20-\x20GatewayPaymentId:\x20'+_0x27ae8b[_0xcb1630(0x246)]),console[_0xcb1630(0x1fb)](_0xcb1630(0x23f)+_0x27ae8b[_0xcb1630(0x1b1)]+'\x20'+_0x27ae8b['currency']),console[_0xcb1630(0x1fb)]('\x20\x20\x20-\x20ShopId:\x20'+_0x27ae8b['shopId']);if(_0x27ae8b[_0xcb1630(0x190)]!==_0xcb1630(0x16e)){console[_0xcb1630(0x1fb)]('⚠️\x20[CHECK]\x20Payment\x20'+_0x2a0d2+_0xcb1630(0x191)+_0x27ae8b[_0xcb1630(0x190)]+')');return;}if(_0x27ae8b[_0xcb1630(0x15c)]!==_0xcb1630(0x1ef)){console[_0xcb1630(0x1fb)](_0xcb1630(0x1c0)+_0x2a0d2+_0xcb1630(0x226)+_0x27ae8b['status']+_0xcb1630(0x173)),this['clearPaymentTimers'](_0x2a0d2);return;}if(!_0x27ae8b['gatewayPaymentId']){console[_0xcb1630(0x1fb)](_0xcb1630(0x1c0)+_0x2a0d2+'\x20has\x20no\x20gatewayPaymentId');return;}console[_0xcb1630(0x1fb)](_0xcb1630(0x213)+_0x2a0d2+_0xcb1630(0x170)),await this[_0xcb1630(0x195)](_0x27ae8b);}['logCoinToPayStatus'](_0x39c237,_0x782cbb,_0x5ec5ac,_0x22ef30,_0x193270,_0x44cf37){const _0x1988e7=a37_0x143a23,_0x5a9e95={'type':'COINTOPAY_STATUS_CHANGE','paymentId':_0x39c237,'gatewayPaymentId':_0x782cbb,'oldStatus':_0x5ec5ac,'newStatus':_0x22ef30,'source':_0x193270,'timestamp':new Date()[_0x1988e7(0x252)](),'details':_0x44cf37||{}};loggerService_1[_0x1988e7(0x166)][_0x1988e7(0x188)](_0x5a9e95),console['log'](_0x1988e7(0x172)+_0x39c237+'\x20('+_0x782cbb+')'),console[_0x1988e7(0x1fb)](_0x1988e7(0x168)+_0x5ec5ac+'\x20->\x20'+_0x22ef30),console[_0x1988e7(0x1fb)](_0x1988e7(0x186)+_0x193270),console[_0x1988e7(0x1fb)](_0x1988e7(0x1be)+_0x5a9e95[_0x1988e7(0x189)]),_0x44cf37&&console[_0x1988e7(0x1fb)](_0x1988e7(0x212),_0x44cf37);}[a37_0x143a23(0x21b)](_0x300769,_0x4b3a72,_0x44b35d,_0x1eb940,_0x55e72b){const _0x29e9e6=a37_0x143a23,_0x4e616c={'type':_0x29e9e6(0x1c1),'paymentId':_0x300769,'gatewayPaymentId':_0x4b3a72,'error':_0x44b35d instanceof Error?{'message':_0x44b35d[_0x29e9e6(0x1da)],'stack':_0x44b35d[_0x29e9e6(0x247)]}:_0x44b35d,'source':_0x1eb940,'timestamp':new Date()[_0x29e9e6(0x252)](),'context':_0x55e72b||{}};loggerService_1['loggerService']['logCoinToPayError'](_0x4e616c),console['error'](_0x29e9e6(0x1d7)+_0x300769+'\x20('+_0x4b3a72+')'),console[_0x29e9e6(0x18e)]('\x20\x20\x20❌\x20Error:\x20'+(_0x44b35d instanceof Error?_0x44b35d[_0x29e9e6(0x1da)]:_0x44b35d)),console[_0x29e9e6(0x18e)]('\x20\x20\x20📍\x20Source:\x20'+_0x1eb940),console[_0x29e9e6(0x18e)]('\x20\x20\x20📅\x20Time:\x20'+_0x4e616c['timestamp']),_0x55e72b&&console['error'](_0x29e9e6(0x202),_0x55e72b);}[a37_0x143a23(0x205)](){const _0x1a4067=a37_0x143a23;console[_0x1a4067(0x1fb)](_0x1a4067(0x24f)),this[_0x1a4067(0x1c2)]()[_0x1a4067(0x1d0)](_0xafde0b=>{const _0x3b2a6d=_0x1a4067;console[_0x3b2a6d(0x18e)](_0x3b2a6d(0x1a9),_0xafde0b);}),this[_0x1a4067(0x229)]=setInterval(async()=>{const _0x34fb15=_0x1a4067;try{console[_0x34fb15(0x1fb)](_0x34fb15(0x204)),await this['checkAllPendingPayments'](),console['log']('✅\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed');}catch(_0x195c69){console['error'](_0x34fb15(0x1b9),_0x195c69);}},this[_0x1a4067(0x21c)]),console[_0x1a4067(0x1fb)](_0x1a4067(0x18b));}[a37_0x143a23(0x235)](){const _0x534b0e=a37_0x143a23;console[_0x534b0e(0x1fb)](_0x534b0e(0x185));this[_0x534b0e(0x229)]&&(clearInterval(this[_0x534b0e(0x229)]),this[_0x534b0e(0x229)]=null,console[_0x534b0e(0x1fb)](_0x534b0e(0x187)));const _0x4fd25b=this[_0x534b0e(0x164)]['size'];for(const [_0x31349b]of this['paymentTimers']){this[_0x534b0e(0x17f)](_0x31349b);}console['log'](_0x534b0e(0x1d1)+_0x4fd25b+_0x534b0e(0x231));}async[a37_0x143a23(0x1c2)](){const _0x2b1328=a37_0x143a23;try{console[_0x2b1328(0x1fb)](_0x2b1328(0x1e8));const _0x9a3232=await database_1[_0x2b1328(0x18f)]['payment']['findMany']({'where':{'gateway':_0x2b1328(0x16e),'status':_0x2b1328(0x1ef),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console['log']('🪙\x20[GLOBAL]\x20Found\x20'+_0x9a3232[_0x2b1328(0x241)]+_0x2b1328(0x240));if(_0x9a3232[_0x2b1328(0x241)]===0x0){console['log'](_0x2b1328(0x1d9));return;}const _0x232644=await this[_0x2b1328(0x1db)](_0x9a3232);console[_0x2b1328(0x1fb)](_0x2b1328(0x16f)+_0x232644[_0x2b1328(0x241)]+_0x2b1328(0x17a));let _0xa9d5d0=0x0,_0x20d48f=0x0;for(const _0x5e5fc4 of _0x9a3232){try{if(_0x232644['includes'](_0x5e5fc4['id'])){console[_0x2b1328(0x1fb)](_0x2b1328(0x232)+_0x5e5fc4['id']+_0x2b1328(0x1ba)),_0x20d48f++;continue;}if(this[_0x2b1328(0x164)][_0x2b1328(0x20c)](_0x5e5fc4['id'])){console[_0x2b1328(0x1fb)](_0x2b1328(0x232)+_0x5e5fc4['id']+_0x2b1328(0x18a)),_0x20d48f++;continue;}const _0xa61f6b=(Date[_0x2b1328(0x23b)]()-_0x5e5fc4[_0x2b1328(0x1e4)][_0x2b1328(0x174)]())/(0x3e8*0x3c*0x3c);if(_0xa61f6b<0x1){console[_0x2b1328(0x1fb)]('⏰\x20[GLOBAL]\x20Payment\x20'+_0x5e5fc4['id']+_0x2b1328(0x23c)+_0xa61f6b['toFixed'](0x1)+_0x2b1328(0x1e7)),_0x20d48f++;continue;}console['log'](_0x2b1328(0x1b5)+_0x5e5fc4['id']+_0x2b1328(0x22c)+_0xa61f6b['toFixed'](0x1)+'h)'),await this['checkSinglePayment'](_0x5e5fc4),_0xa9d5d0++,await new Promise(_0xf6dd92=>setTimeout(_0xf6dd92,0x7d0));}catch(_0x4039b8){console['error'](_0x2b1328(0x1ae)+_0x5e5fc4['id']+':',_0x4039b8),this['logCoinToPayError'](_0x5e5fc4['id'],_0x5e5fc4[_0x2b1328(0x246)]||'unknown',_0x4039b8,_0x2b1328(0x242),{'isGlobalCheck':!![],'paymentAmount':_0x5e5fc4[_0x2b1328(0x1b1)],'paymentCurrency':_0x5e5fc4['currency'],'shopId':_0x5e5fc4['shopId'],'createdAt':_0x5e5fc4[_0x2b1328(0x1e4)]}),loggerService_1['loggerService'][_0x2b1328(0x1c7)]('cointopay',_0x2b1328(0x167)+_0x5e5fc4['gatewayPaymentId'],_0x4039b8);}}console['log'](_0x2b1328(0x1c9)+_0xa9d5d0+_0x2b1328(0x161)+_0x20d48f+_0x2b1328(0x23d)+_0x232644[_0x2b1328(0x241)]+_0x2b1328(0x230));}catch(_0x557d74){console[_0x2b1328(0x18e)](_0x2b1328(0x1a0),_0x557d74);}}async[a37_0x143a23(0x1db)](_0x574360){const _0x53c2d0=a37_0x143a23,_0x3bb732=[],_0x4ff246=new Date();_0x4ff246[_0x53c2d0(0x171)](_0x4ff246[_0x53c2d0(0x1cc)]()-this['EXPIRY_DAYS']),console[_0x53c2d0(0x1fb)](_0x53c2d0(0x20f)+this[_0x53c2d0(0x169)]+'\x20days\x20(created\x20before\x20'+_0x4ff246[_0x53c2d0(0x252)]()+')');for(const _0xfdcd6 of _0x574360){if(_0xfdcd6['createdAt']<_0x4ff246){console[_0x53c2d0(0x1fb)]('⏰\x20[EXPIRY]\x20Payment\x20'+_0xfdcd6['id']+_0x53c2d0(0x24e)+this[_0x53c2d0(0x169)]+'\x20days,\x20marking\x20as\x20EXPIRED');try{this[_0x53c2d0(0x188)](_0xfdcd6['id'],_0xfdcd6[_0x53c2d0(0x246)]||'unknown',_0x53c2d0(0x1ef),_0x53c2d0(0x1ec),'auto_expire',{'reason':_0x53c2d0(0x21d)+this[_0x53c2d0(0x169)]+_0x53c2d0(0x1b6),'createdAt':_0xfdcd6[_0x53c2d0(0x1e4)],'daysSinceCreation':Math[_0x53c2d0(0x1f3)]((Date['now']()-_0xfdcd6['createdAt']['getTime']())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0xfdcd6['amount'],'paymentCurrency':_0xfdcd6[_0x53c2d0(0x1a8)],'shopId':_0xfdcd6[_0x53c2d0(0x19f)]}),await database_1[_0x53c2d0(0x18f)][_0x53c2d0(0x165)][_0x53c2d0(0x251)]({'where':{'id':_0xfdcd6['id']},'data':{'status':_0x53c2d0(0x1ec),'updatedAt':new Date(),'adminNotes':_0x53c2d0(0x1f0)+this[_0x53c2d0(0x169)]+'\x20days\x20without\x20payment\x20confirmation'}}),await database_1[_0x53c2d0(0x18f)][_0x53c2d0(0x163)][_0x53c2d0(0x1aa)]({'data':{'paymentId':_0xfdcd6['id'],'shopId':_0xfdcd6[_0x53c2d0(0x19f)],'event':_0x53c2d0(0x210),'statusCode':0xc8,'responseBody':JSON[_0x53c2d0(0x1ed)]({'reason':_0x53c2d0(0x21d)+this['EXPIRY_DAYS']+_0x53c2d0(0x1b6),'createdAt':_0xfdcd6[_0x53c2d0(0x1e4)],'expiredAt':new Date()[_0x53c2d0(0x252)](),'daysSinceCreation':Math[_0x53c2d0(0x1f3)]((Date[_0x53c2d0(0x23b)]()-_0xfdcd6[_0x53c2d0(0x1e4)][_0x53c2d0(0x174)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x53c2d0(0x1de)](_0xfdcd6,'EXPIRED'),await this[_0x53c2d0(0x1bb)](_0xfdcd6,_0x53c2d0(0x1ec)),this[_0x53c2d0(0x17f)](_0xfdcd6['id']),_0x3bb732['push'](_0xfdcd6['id']),console[_0x53c2d0(0x1fb)](_0x53c2d0(0x1eb)+_0xfdcd6['id']+_0x53c2d0(0x1b3)+this[_0x53c2d0(0x169)]+_0x53c2d0(0x1e6));}catch(_0x36784f){console['error'](_0x53c2d0(0x1a1)+_0xfdcd6['id']+':',_0x36784f),this[_0x53c2d0(0x21b)](_0xfdcd6['id'],_0xfdcd6['gatewayPaymentId']||_0x53c2d0(0x1f1),_0x36784f,_0x53c2d0(0x22f),{'reason':_0x53c2d0(0x16a),'createdAt':_0xfdcd6[_0x53c2d0(0x1e4)],'daysSinceCreation':Math[_0x53c2d0(0x1f3)]((Date[_0x53c2d0(0x23b)]()-_0xfdcd6['createdAt'][_0x53c2d0(0x174)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x3bb732;}async['checkSinglePayment'](_0x9b7b5){const _0x20392a=a37_0x143a23;if(!_0x9b7b5[_0x20392a(0x246)]){console['log'](_0x20392a(0x1c0)+_0x9b7b5['id']+'\x20has\x20no\x20gatewayPaymentId,\x20skipping');return;}console[_0x20392a(0x1fb)](_0x20392a(0x203)+_0x9b7b5['id']+'\x20('+_0x9b7b5[_0x20392a(0x246)]+')');try{const _0x20a37f=await this['coinToPayService'][_0x20392a(0x1f5)](_0x9b7b5[_0x20392a(0x246)]);console[_0x20392a(0x1fb)](_0x20392a(0x233)+_0x9b7b5['id']+_0x20392a(0x1ea)+_0x20a37f[_0x20392a(0x15c)]);_0x20a37f[_0x20392a(0x253)]&&console[_0x20392a(0x1fb)](_0x20392a(0x233)+_0x9b7b5['id']+_0x20392a(0x1a7),{'iban':_0x20a37f[_0x20392a(0x253)][_0x20392a(0x234)]||_0x20392a(0x1dd),'transactionId':_0x20a37f[_0x20392a(0x253)][_0x20392a(0x216)],'createdOn':_0x20a37f[_0x20392a(0x253)][_0x20392a(0x1f8)],'confirmedOn':_0x20a37f['paymentDetails'][_0x20392a(0x16b)]||_0x20392a(0x1b7)});if(_0x20a37f['status']!==_0x9b7b5['status']){console[_0x20392a(0x1fb)](_0x20392a(0x1d8)+_0x9b7b5['id']+_0x20392a(0x24b)+_0x9b7b5['status']+_0x20392a(0x243)+_0x20a37f[_0x20392a(0x15c)]),this['logCoinToPayStatus'](_0x9b7b5['id'],_0x9b7b5[_0x20392a(0x246)],_0x9b7b5[_0x20392a(0x15c)],_0x20a37f[_0x20392a(0x15c)],'status_check',{'paymentDetails':_0x20a37f[_0x20392a(0x253)],'amount':_0x20a37f['amount'],'currency':_0x20a37f[_0x20392a(0x1a8)],'shopId':_0x9b7b5[_0x20392a(0x19f)],'checkTimestamp':new Date()['toISOString']()});const _0x3ebadb={'status':_0x20a37f[_0x20392a(0x15c)],'updatedAt':new Date()};_0x20a37f['status']===_0x20392a(0x1b8)&&_0x9b7b5[_0x20392a(0x15c)]!==_0x20392a(0x1b8)&&(_0x3ebadb[_0x20392a(0x22d)]=new Date(),console[_0x20392a(0x1fb)](_0x20392a(0x219)+_0x9b7b5['id']+_0x20392a(0x255)+_0x3ebadb[_0x20392a(0x22d)][_0x20392a(0x252)]()));if(_0x20a37f[_0x20392a(0x253)]){const _0x56858d=_0x20a37f[_0x20392a(0x253)];_0x56858d[_0x20392a(0x234)]&&(_0x3ebadb['remitterIban']=_0x56858d[_0x20392a(0x234)],console[_0x20392a(0x1fb)]('🏦\x20[CHECK]\x20Saved\x20IBAN:\x20'+_0x56858d['iban']));if(_0x56858d[_0x20392a(0x1c3)]){const _0x5cacc3=_0x9b7b5[_0x20392a(0x1bf)]||'',_0x34565d=_0x20392a(0x19c)+_0x56858d[_0x20392a(0x1c3)];_0x3ebadb[_0x20392a(0x1bf)]=_0x5cacc3?_0x5cacc3+'\x0a\x0a'+_0x34565d:_0x34565d,console[_0x20392a(0x1fb)](_0x20392a(0x1af));}_0x56858d['transactionId']&&console[_0x20392a(0x1fb)](_0x20392a(0x15b)+_0x56858d[_0x20392a(0x216)]),_0x56858d[_0x20392a(0x16b)]&&console[_0x20392a(0x1fb)]('✅\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20'+_0x56858d[_0x20392a(0x16b)]);}await database_1[_0x20392a(0x18f)][_0x20392a(0x165)][_0x20392a(0x251)]({'where':{'id':_0x9b7b5['id']},'data':_0x3ebadb}),await database_1[_0x20392a(0x18f)][_0x20392a(0x163)][_0x20392a(0x1aa)]({'data':{'paymentId':_0x9b7b5['id'],'shopId':_0x9b7b5[_0x20392a(0x19f)],'event':_0x20392a(0x206)+_0x20a37f[_0x20392a(0x15c)][_0x20392a(0x1ff)](),'statusCode':0xc8,'responseBody':JSON['stringify']({'oldStatus':_0x9b7b5['status'],'newStatus':_0x20a37f[_0x20392a(0x15c)],'paymentDetails':_0x20a37f[_0x20392a(0x253)],'checkedAt':new Date()[_0x20392a(0x252)]()})}}),await this['sendShopWebhook'](_0x9b7b5,_0x20a37f['status']),await this[_0x20392a(0x1bb)](_0x9b7b5,_0x20a37f[_0x20392a(0x15c)]);if(_0x20a37f[_0x20392a(0x15c)]===_0x20392a(0x1b8)&&_0x9b7b5[_0x20392a(0x15c)]!=='PAID')try{const {PaymentLinkService:_0x3ecfa0}=await Promise['resolve']()[_0x20392a(0x1f9)](()=>__importStar(require(_0x20392a(0x1dc)))),_0x45cec8=new _0x3ecfa0();await _0x45cec8[_0x20392a(0x1e2)](_0x9b7b5['id']),console[_0x20392a(0x1fb)](_0x20392a(0x21e)+_0x9b7b5['id']);}catch(_0x25a17e){console[_0x20392a(0x18e)]('❌\x20[CHECK]\x20Failed\x20to\x20update\x20payment\x20link\x20counter\x20for\x20payment\x20'+_0x9b7b5['id']+':',_0x25a17e);}_0x20a37f[_0x20392a(0x15c)]!==_0x20392a(0x1ef)&&(console[_0x20392a(0x1fb)](_0x20392a(0x1a4)+_0x9b7b5['id']+_0x20392a(0x208)+_0x20a37f[_0x20392a(0x15c)]+_0x20392a(0x200)),this[_0x20392a(0x17f)](_0x9b7b5['id'])),console[_0x20392a(0x1fb)](_0x20392a(0x213)+_0x9b7b5['id']+_0x20392a(0x1ab));}else console[_0x20392a(0x1fb)](_0x20392a(0x233)+_0x9b7b5['id']+'\x20status\x20unchanged\x20('+_0x20a37f['status']+')'),this[_0x20392a(0x188)](_0x9b7b5['id'],_0x9b7b5[_0x20392a(0x246)],_0x9b7b5[_0x20392a(0x15c)],_0x20a37f[_0x20392a(0x15c)],'status_check',{'statusUnchanged':!![],'paymentDetails':_0x20a37f['paymentDetails'],'amount':_0x20a37f['amount'],'currency':_0x20a37f['currency'],'shopId':_0x9b7b5[_0x20392a(0x19f)],'checkTimestamp':new Date()[_0x20392a(0x252)]()});}catch(_0x5b21b9){console[_0x20392a(0x18e)](_0x20392a(0x24a)+_0x9b7b5['id']+':',_0x5b21b9),this['logCoinToPayError'](_0x9b7b5['id'],_0x9b7b5['gatewayPaymentId'],_0x5b21b9,_0x20392a(0x242),{'paymentAmount':_0x9b7b5[_0x20392a(0x1b1)],'paymentCurrency':_0x9b7b5['currency'],'shopId':_0x9b7b5[_0x20392a(0x19f)],'createdAt':_0x9b7b5[_0x20392a(0x1e4)]}),await database_1['default'][_0x20392a(0x163)][_0x20392a(0x1aa)]({'data':{'paymentId':_0x9b7b5['id'],'shopId':_0x9b7b5['shopId'],'event':_0x20392a(0x15d),'statusCode':0x1f4,'responseBody':JSON[_0x20392a(0x1ed)]({'error':_0x5b21b9 instanceof Error?_0x5b21b9[_0x20392a(0x1da)]:_0x20392a(0x1cf),'gatewayPaymentId':_0x9b7b5['gatewayPaymentId'],'checkedAt':new Date()[_0x20392a(0x252)]()})}});}}async[a37_0x143a23(0x1de)](_0x11e8af,_0x29771c){const _0x7cfd3a=a37_0x143a23,_0x28e627=Date[_0x7cfd3a(0x23b)]();try{const _0x2d91e1=_0x11e8af[_0x7cfd3a(0x1e3)],_0xb5fbdc=_0x2d91e1[_0x7cfd3a(0x223)];if(!_0xb5fbdc?.[_0x7cfd3a(0x211)]){console[_0x7cfd3a(0x1fb)](_0x7cfd3a(0x160)+_0x2d91e1['id']);return;}const _0x2a34c1=_0x29771c===_0x7cfd3a(0x1b8)?_0x7cfd3a(0x177):_0x29771c===_0x7cfd3a(0x1e0)?_0x7cfd3a(0x222):_0x29771c===_0x7cfd3a(0x1ec)?_0x7cfd3a(0x222):_0x7cfd3a(0x248);if(!_0xb5fbdc[_0x7cfd3a(0x217)]?.['includes'](_0x2a34c1)){console[_0x7cfd3a(0x1fb)]('Webhook\x20event\x20'+_0x2a34c1+_0x7cfd3a(0x220)+_0x2d91e1['id']);return;}const _0x99a804={'event':_0x2a34c1,'payment':{'id':_0x11e8af['id'],'order_id':_0x11e8af['orderId'],'gateway_order_id':_0x11e8af[_0x7cfd3a(0x179)],'gateway':_0x7cfd3a(0x199),'amount':_0x11e8af[_0x7cfd3a(0x1b1)],'currency':_0x11e8af[_0x7cfd3a(0x1a8)],'status':_0x29771c[_0x7cfd3a(0x1ff)](),'customer_email':_0x11e8af[_0x7cfd3a(0x209)],'customer_name':_0x11e8af['customerName'],'created_at':_0x11e8af[_0x7cfd3a(0x1e4)],'updated_at':new Date()}},_0x100572=await fetch(_0xb5fbdc[_0x7cfd3a(0x211)],{'method':_0x7cfd3a(0x19b),'headers':{'Content-Type':'application/json','User-Agent':_0x7cfd3a(0x1fa)},'body':JSON['stringify'](_0x99a804)}),_0x1d4ab8=Date[_0x7cfd3a(0x23b)]()-_0x28e627,_0x5c6750=_0x100572['ok']?_0x7cfd3a(0x23e):await _0x100572[_0x7cfd3a(0x1d5)]();loggerService_1[_0x7cfd3a(0x166)][_0x7cfd3a(0x192)](_0x11e8af[_0x7cfd3a(0x19f)],_0xb5fbdc[_0x7cfd3a(0x211)],_0x2a34c1,_0x100572['status'],_0x1d4ab8,_0x99a804),console[_0x7cfd3a(0x1fb)](_0x7cfd3a(0x22a)+_0xb5fbdc[_0x7cfd3a(0x211)]+_0x7cfd3a(0x16d)+_0x100572['status']+'\x20('+_0x1d4ab8+_0x7cfd3a(0x236));}catch(_0x56f160){console[_0x7cfd3a(0x18e)](_0x7cfd3a(0x1a5),_0x56f160),loggerService_1['loggerService'][_0x7cfd3a(0x1cb)](_0x11e8af[_0x7cfd3a(0x19f)],_0x11e8af['shop']?.[_0x7cfd3a(0x223)]?.[_0x7cfd3a(0x211)]||'unknown',_0x7cfd3a(0x1ac),_0x56f160,{});}}async[a37_0x143a23(0x1bb)](_0x5f00d7,_0x23ac40){const _0x3a8ca0=a37_0x143a23;try{const _0x633b1f={'PENDING':_0x3a8ca0(0x1df),'PAID':_0x3a8ca0(0x194),'FAILED':_0x3a8ca0(0x1fc),'EXPIRED':_0x3a8ca0(0x21a)},_0x3af7e5=_0x633b1f[_0x23ac40];if(!_0x3af7e5||_0x3af7e5===_0x3a8ca0(0x1df))return;await telegramBotService_1[_0x3a8ca0(0x178)][_0x3a8ca0(0x237)](_0x5f00d7['shopId'],_0x5f00d7,_0x3af7e5);}catch(_0x509400){console['error']('Failed\x20to\x20send\x20Telegram\x20payment\x20notification:',_0x509400);}}async[a37_0x143a23(0x201)](_0x4383ff){const _0x58245d=a37_0x143a23;console['log'](_0x58245d(0x19e)+_0x4383ff);const _0x32913d=await database_1['default'][_0x58245d(0x165)][_0x58245d(0x1e5)]({'where':{'id':_0x4383ff},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x32913d)throw new Error(_0x58245d(0x1d4));if(_0x32913d[_0x58245d(0x190)]!=='cointopay')throw new Error(_0x58245d(0x214));console[_0x58245d(0x1fb)](_0x58245d(0x24d)+_0x4383ff),await this['checkSinglePayment'](_0x32913d),console[_0x58245d(0x1fb)]('✅\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20'+_0x4383ff);}[a37_0x143a23(0x20a)](){const _0x5ee31c=a37_0x143a23,_0x588775=this['globalCheckInterval']?this[_0x5ee31c(0x21c)]:undefined,_0x4760f6=Array[_0x5ee31c(0x19a)](this['paymentTimers']['values']())['map'](_0x576caf=>({'paymentId':_0x576caf[_0x5ee31c(0x245)],'gatewayPaymentId':_0x576caf['gatewayPaymentId'],'createdAt':_0x576caf[_0x5ee31c(0x1e4)],'timersCount':_0x576caf['timers']['length']}));return{'isActive':!!this['globalCheckInterval'],'globalCheckIntervalMinutes':this[_0x5ee31c(0x21c)]/(0x3e8*0x3c),'expiryDays':this[_0x5ee31c(0x169)],'activeIndividualTimers':this[_0x5ee31c(0x164)][_0x5ee31c(0x20b)],'nextGlobalCheckIn':_0x588775,'paymentTimersDetails':_0x4760f6};}[a37_0x143a23(0x249)](_0x5692d8){const _0x280278=a37_0x143a23,_0xd0d1b2=this[_0x280278(0x164)][_0x280278(0x1c8)](_0x5692d8);if(_0xd0d1b2)return{'hasTimers':!![],'timersCount':_0xd0d1b2['timers'][_0x280278(0x241)],'createdAt':_0xd0d1b2[_0x280278(0x1e4)],'gatewayPaymentId':_0xd0d1b2['gatewayPaymentId']};return{'hasTimers':![]};}}exports[a37_0x143a23(0x15f)]=CoinToPayStatusService,exports[a37_0x143a23(0x18c)]=new CoinToPayStatusService();