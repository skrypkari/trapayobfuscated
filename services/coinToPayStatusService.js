'use strict';const a37_0x5b580d=a37_0x36ef;(function(_0x405d54,_0x1bdc91){const _0xebb25=a37_0x36ef,_0x549445=_0x405d54();while(!![]){try{const _0x371aa1=parseInt(_0xebb25(0x28a))/0x1*(parseInt(_0xebb25(0x1e9))/0x2)+parseInt(_0xebb25(0x1b0))/0x3+parseInt(_0xebb25(0x25b))/0x4+parseInt(_0xebb25(0x1ed))/0x5*(-parseInt(_0xebb25(0x1d3))/0x6)+-parseInt(_0xebb25(0x2aa))/0x7*(parseInt(_0xebb25(0x1b5))/0x8)+parseInt(_0xebb25(0x289))/0x9+parseInt(_0xebb25(0x20e))/0xa*(-parseInt(_0xebb25(0x217))/0xb);if(_0x371aa1===_0x1bdc91)break;else _0x549445['push'](_0x549445['shift']());}catch(_0x3e316a){_0x549445['push'](_0x549445['shift']());}}}(a37_0x20d6,0xc3b0c));function a37_0x20d6(){const _0x56a83e=['createdAt','‚ùå\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','‚ùå\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','PENDING','application/json','setDate','\x20status\x20changed\x20to\x20','\x20\x20\x20-\x20Gateway:\x20','\x20\x20\x20üìù\x20Context:','PAID','delay','create','webhook_send','\x20days','stopPeriodicStatusCheck','getDate','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','üìä\x20[CHECK]\x20CoinToPay\x20payment\x20','‚úÖ\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','findUnique','45588sJzOfP','\x20individual\x20payment\x20timers','__esModule','webhookEvents','2097085qfqHYW','paidAt','forEach','üîÑ\x20[CHECK]\x20Updating\x20payment\x20','ü™ô\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','customerEmail',',\x20status=','‚úÖ\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','stringify','CoinToPayStatusService','checkAllPendingPayments','iban','globalCheckInterval','\x20(age:\x20','‚è∞\x20[GLOBAL]\x20Payment\x20','now','2\x20minutes','üõë\x20[SHUTDOWN]\x20Cleared\x20','\x20\x20\x20-\x20ShopId:\x20','transactionId','cointopay2','\x20current\x20status:\x20','\x20updated:\x20currentPayments=','ü™ô\x20[TIMER]\x20Individual\x20check\x20#','‚è∞\x20[HOURLY]\x20Payment\x20','1\x20minute','toLowerCase','\x20expired','findMany','currentPayments','\x20->\x20','sendPaymentStatusNotification','üßπ\x20[DEBUG]\x20Clearing\x20','20EvfnpA','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','timers','üìä\x20[CHECK]\x20CoinToPay2\x20payment\x20','\x20in\x20','\x20is\x20valid\x20for\x20checking,\x20proceeding...','‚úÖ\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','GLOBAL_CHECK_INTERVAL_MS','auto_expire','7161077xaQlXT','\x20found:','üìä\x20[CHECK]\x20Payment\x20','\x20with\x20status\x20','schedule_created','coinToPayStatusService','checkExpiredPayments','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','‚è∞\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','toFixed','paid','üìä\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','Failed\x20to\x20send\x20shop\x20webhook:','sendPaymentNotification','./telegramBotService','getPaymentTimerInfo','ü™ô\x20[DEBUG]\x20Creating\x20','üìà\x20[COINTOPAY]\x20Payment\x20','from','ms)','COINTOPAY_ERROR','‚è∞\x20[DEBUG]\x20Scheduled\x20check\x20#','‚ùå\x20[HOURLY]\x20Payment\x20','\x20payment\x20','message','‚úÖ\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','log','amount','map','includes','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','\x20not\x20found\x20in\x20database','push','ü™ô\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','COINTOPAY_STATUS_CHANGE','clearPaymentTimers','\x20has\x20no\x20gatewayPaymentId,\x20skipping','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','\x20checked,\x20','cointopay_auto_expired','payment.pending','../types/gateway','coinToPay2Service','‚ö†Ô∏è\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','./gateways/coinToPay2Service','\x20timers\x20for\x20payment\x20','Automatically\x20expired\x20after\x20','\x20\x20\x20-\x20GatewayPaymentId:\x20','ü™ô\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','not\x20found','shopId','not\x20confirmed','.\x20Remaining\x20active\x20timers:\x20','description','sendShopWebhook','paymentDetails','catch','error','paymentLink','adminNotes','logWhiteDomainError','\x20status\x20from\x20','\x20\x20\x20üìÖ\x20Time:\x20','checkSinglePaymentById','type','delete','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','\x20status:\x20','1365512jvUqDb','\x20days\x20(created\x20before\x20','payment','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','üîç\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','\x20expired\x20CoinToPay\x20payments','CoinToPayService','\x20status\x20is\x20','confirmedOn','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','../config/database','ü™ô\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','Bank\x20Details:\x20','ü™ô\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','startPeriodicStatusCheck','ü™ô\x20[ERROR]\x20CoinToPay\x20Error:\x20','\x20initial\x20timers\x20for\x20payment\x20','loggerService','createdOn','\x20\x20\x20-\x20paymentId:\x20','üè¶\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes','-day\x20timeout','‚ùå\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','unknown','\x20not\x20found,\x20clearing\x20timers','h),\x20skipping\x20global\x20check','timestamp','coinToPayService','size','paymentTimers','\x20\x20\x20‚ùå\x20Error:\x20','getTime','checkPaymentById','Failed\x20to\x20mark\x20payment\x20as\x20expired','toISOString','\x20to\x20','./gateways/coinToPayService','SINGLE','TesSoft\x20Payment\x20System/1.0','gatewayPaymentId','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','üîç\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','customerName','‚ùå\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','\x20has\x20no\x20gatewayPaymentId','get','10604538XaRTPn','56hMVfIt','values','__importDefault','telegramBotService','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','logCoinToPayError',',\x20clearing\x20individual\x20timers','ü™ô\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','status','‚úÖ\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','\x20days,\x20marking\x20as\x20EXPIRED','\x20\x20\x20-\x20Amount:\x20','update','\x20is\x20older\x20than\x20','\x20marked\x20as\x20paid\x20at:\x20',':\x20type=','checkSinglePayment','cointopay','logCoinToPayStatus','failed','5\x20minutes','webhookUrl','\x20completed\x20for\x20payment\x20','üîç\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','\x20for\x20payment\x20','payment.failed','üõë\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','\x20days\x20without\x20payment\x20confirmation','expired','paymentLinkId','bankDetails','3392599pXTGGt','floor','\x20\x20\x20-\x20Status:\x20','\x20details:','\x20\x20\x20üìç\x20Source:\x20','currency','3151038oMrlHe','EXPIRED',',\x20stopping\x20individual\x20checks','üí∞\x20[CHECK]\x20Payment\x20','üîç\x20[CHECK]\x20Checking\x20','8MxziAs','‚úÖ\x20[DEBUG]\x20Successfully\x20scheduled\x20','remitterIban','\x20not\x20enabled\x20for\x20shop\x20','Webhook\x20event\x20','‚ùå\x20[TIMER]\x20Failed\x20individual\x20check\x20#','has','logShopWebhookError','‚úÖ\x20[COINTOPAY]\x20Payment\x20link\x20','status_check','default','gateway','üßπ\x20[CHECK]\x20Payment\x20','COMPLETED','üõë\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','\x20\x20\x20-\x20gatewayPaymentId:\x20','‚ùå\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','EXPIRY_DAYS','‚è∞\x20[GLOBAL]\x20Found\x20','length','\x20skipped,\x20','settings','\x20pending\x20CoinToPay\x20payments','‚úÖ\x20[CHECK]\x20Payment\x20','ü™ô\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','‚ö†Ô∏è\x20[CHECK]\x20Payment\x20','./loggerService','\x20updated\x20successfully','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','getGatewayIdByName','18gqbUdv','‚úÖ\x20[HOURLY]\x20Payment\x20'];a37_0x20d6=function(){return _0x56a83e;};return a37_0x20d6();}function a37_0x36ef(_0x1e91f9,_0x43dba6){const _0x20d661=a37_0x20d6();return a37_0x36ef=function(_0x36efcf,_0x1fd8e4){_0x36efcf=_0x36efcf-0x1ab;let _0x1808db=_0x20d661[_0x36efcf];return _0x1808db;},a37_0x36ef(_0x1e91f9,_0x43dba6);}var __importDefault=this&&this[a37_0x5b580d(0x28c)]||function(_0x3ce3b9){const _0xad1de1=a37_0x5b580d;return _0x3ce3b9&&_0x3ce3b9[_0xad1de1(0x1eb)]?_0x3ce3b9:{'default':_0x3ce3b9};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a37_0x5b580d(0x21c)]=exports[a37_0x5b580d(0x1f6)]=void 0x0;const coinToPayService_1=require(a37_0x5b580d(0x27f)),coinToPay2Service_1=require(a37_0x5b580d(0x243)),gateway_1=require(a37_0x5b580d(0x240)),database_1=__importDefault(require(a37_0x5b580d(0x265))),telegramBotService_1=require(a37_0x5b580d(0x225)),loggerService_1=require(a37_0x5b580d(0x1cf));class CoinToPayStatusService{constructor(){const _0x509d50=a37_0x5b580d;this['globalCheckInterval']=null,this[_0x509d50(0x215)]=0x3c*0x3c*0x3e8,this[_0x509d50(0x1c6)]=0x5,this[_0x509d50(0x278)]=new Map(),this[_0x509d50(0x276)]=new coinToPayService_1[(_0x509d50(0x261))](),this[_0x509d50(0x241)]=new coinToPay2Service_1['CoinToPay2Service'](),console['log'](_0x509d50(0x266));}['schedulePaymentChecks'](_0x15c368,_0x45c5e8){const _0x3a2a5b=a37_0x5b580d;console[_0x3a2a5b(0x231)](_0x3a2a5b(0x238)),console['log'](_0x3a2a5b(0x26e)+_0x15c368),console['log'](_0x3a2a5b(0x1c4)+_0x45c5e8),this[_0x3a2a5b(0x23a)](_0x15c368);const _0x485aa2=[],_0x257c28=new Date(),_0x551dc1=[{'delay':0x1*0x3c*0x3e8,'description':_0x3a2a5b(0x206)},{'delay':0x2*0x3c*0x3e8,'description':_0x3a2a5b(0x1fd)},{'delay':0x5*0x3c*0x3e8,'description':_0x3a2a5b(0x29f)},{'delay':0x5*0x3c*0x3e8,'description':_0x3a2a5b(0x29f)}];console[_0x3a2a5b(0x231)](_0x3a2a5b(0x227)+_0x551dc1[_0x3a2a5b(0x1c8)]+_0x3a2a5b(0x26b)+_0x15c368);let _0x2336b6=0x0;_0x551dc1[_0x3a2a5b(0x1ef)]((_0x4b487e,_0x363bef)=>{const _0x4fb52e=_0x3a2a5b;_0x2336b6+=_0x4b487e[_0x4fb52e(0x1df)];const _0x2865f8=setTimeout(async()=>{const _0x4277cb=_0x4fb52e;console[_0x4277cb(0x231)](_0x4277cb(0x204)+(_0x363bef+0x1)+'\x20triggered\x20for\x20payment\x20'+_0x15c368+'\x20(after\x20'+_0x4b487e[_0x4277cb(0x24c)]+')');try{await this[_0x4277cb(0x256)](_0x15c368),console[_0x4277cb(0x231)]('‚úÖ\x20[TIMER]\x20Individual\x20check\x20#'+(_0x363bef+0x1)+_0x4277cb(0x2a1)+_0x15c368);}catch(_0x11b94a){console[_0x4277cb(0x250)](_0x4277cb(0x1ba)+(_0x363bef+0x1)+_0x4277cb(0x2a3)+_0x15c368+':',_0x11b94a),this[_0x4277cb(0x28f)](_0x15c368,_0x45c5e8,_0x11b94a,_0x4277cb(0x1be),{'checkNumber':_0x363bef+0x1,'scheduledAfter':_0x4b487e[_0x4277cb(0x24c)],'isIndividualCheck':!![]});}},_0x2336b6);_0x485aa2[_0x4fb52e(0x237)](_0x2865f8),console['log'](_0x4fb52e(0x22c)+(_0x363bef+0x1)+_0x4fb52e(0x2a3)+_0x15c368+_0x4fb52e(0x212)+_0x2336b6/0x3e8+'\x20seconds\x20('+_0x4b487e[_0x4fb52e(0x24c)]+')');});const _0x12ac1b=setInterval(async()=>{const _0x437496=_0x3a2a5b;console[_0x437496(0x231)](_0x437496(0x247)+_0x15c368);try{const _0x1ecd27=await database_1[_0x437496(0x1bf)][_0x437496(0x25d)][_0x437496(0x1e8)]({'where':{'id':_0x15c368},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x1ecd27){console[_0x437496(0x231)](_0x437496(0x22d)+_0x15c368+_0x437496(0x273)),this[_0x437496(0x23a)](_0x15c368);return;}console[_0x437496(0x231)]('üìä\x20[HOURLY]\x20Payment\x20'+_0x15c368+_0x437496(0x202)+_0x1ecd27[_0x437496(0x292)]);if(_0x1ecd27['status']!==_0x437496(0x1d8)){console[_0x437496(0x231)](_0x437496(0x1d4)+_0x15c368+_0x437496(0x262)+_0x1ecd27[_0x437496(0x292)]+',\x20stopping\x20individual\x20checks'),this[_0x437496(0x23a)](_0x15c368);return;}const _0x38656d=Math[_0x437496(0x1ab)]((Date['now']()-_0x1ecd27[_0x437496(0x1d5)]['getTime']())/(0x3e8*0x3c*0x3c*0x18));if(_0x38656d>=this[_0x437496(0x1c6)]){console[_0x437496(0x231)](_0x437496(0x205)+_0x15c368+'\x20is\x20older\x20than\x20'+this[_0x437496(0x1c6)]+_0x437496(0x23c)),this[_0x437496(0x23a)](_0x15c368);return;}await this[_0x437496(0x256)](_0x15c368),console['log'](_0x437496(0x293)+_0x15c368);}catch(_0x31f629){console['error'](_0x437496(0x271)+_0x15c368+':',_0x31f629),this[_0x437496(0x28f)](_0x15c368,_0x45c5e8,_0x31f629,_0x437496(0x1be),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x485aa2[_0x3a2a5b(0x237)](_0x12ac1b),this[_0x3a2a5b(0x278)]['set'](_0x15c368,{'timers':_0x485aa2,'paymentId':_0x15c368,'gatewayPaymentId':_0x45c5e8,'createdAt':_0x257c28}),console[_0x3a2a5b(0x231)](_0x3a2a5b(0x1b6)+_0x551dc1[_0x3a2a5b(0x1c8)]+'\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20'+_0x15c368),console['log'](_0x3a2a5b(0x222)+this[_0x3a2a5b(0x278)]['size']),this[_0x3a2a5b(0x29d)](_0x15c368,_0x45c5e8,_0x3a2a5b(0x1d8),_0x3a2a5b(0x1d8),_0x3a2a5b(0x1be),{'action':_0x3a2a5b(0x21b),'scheduledChecks':_0x551dc1[_0x3a2a5b(0x1c8)],'firstCheckIn':_0x551dc1[0x0][_0x3a2a5b(0x1df)]/0x3e8,'totalTimers':this[_0x3a2a5b(0x278)]['size']});}[a37_0x5b580d(0x23a)](_0x402e2a){const _0x2a5669=a37_0x5b580d,_0x13e4a9=this[_0x2a5669(0x278)][_0x2a5669(0x288)](_0x402e2a);_0x13e4a9?(console[_0x2a5669(0x231)](_0x2a5669(0x20d)+_0x13e4a9[_0x2a5669(0x210)][_0x2a5669(0x1c8)]+_0x2a5669(0x244)+_0x402e2a),_0x13e4a9[_0x2a5669(0x210)]['forEach']((_0x20072f,_0x524da2)=>{const _0x1cea1d=_0x2a5669;_0x20072f&&(clearTimeout(_0x20072f),clearInterval(_0x20072f),console['log']('üßπ\x20[DEBUG]\x20Cleared\x20timer\x20#'+(_0x524da2+0x1)+_0x1cea1d(0x2a3)+_0x402e2a));}),this[_0x2a5669(0x278)][_0x2a5669(0x258)](_0x402e2a),console[_0x2a5669(0x231)](_0x2a5669(0x1f4)+_0x402e2a+_0x2a5669(0x24b)+this[_0x2a5669(0x278)][_0x2a5669(0x277)])):console[_0x2a5669(0x231)](_0x2a5669(0x242)+_0x402e2a+'\x20to\x20clear');}async[a37_0x5b580d(0x256)](_0x29b50b){const _0x59a464=a37_0x5b580d;console[_0x59a464(0x231)](_0x59a464(0x2a2)+_0x29b50b);const _0x32419f=await database_1[_0x59a464(0x1bf)][_0x59a464(0x25d)][_0x59a464(0x1e8)]({'where':{'id':_0x29b50b},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x32419f){console[_0x59a464(0x231)]('‚ùå\x20[CHECK]\x20Payment\x20'+_0x29b50b+_0x59a464(0x236));return;}console[_0x59a464(0x231)]('üìä\x20[CHECK]\x20Payment\x20'+_0x29b50b+_0x59a464(0x218)),console['log'](_0x59a464(0x1dc)+_0x32419f['gateway']),console[_0x59a464(0x231)](_0x59a464(0x1ac)+_0x32419f[_0x59a464(0x292)]),console[_0x59a464(0x231)](_0x59a464(0x246)+_0x32419f[_0x59a464(0x282)]),console[_0x59a464(0x231)](_0x59a464(0x296)+_0x32419f[_0x59a464(0x232)]+'\x20'+_0x32419f[_0x59a464(0x1af)]),console[_0x59a464(0x231)](_0x59a464(0x1ff)+_0x32419f[_0x59a464(0x249)]);if(_0x32419f[_0x59a464(0x1c0)]!==_0x59a464(0x29c)&&_0x32419f[_0x59a464(0x1c0)]!==_0x59a464(0x201)){console[_0x59a464(0x231)]('‚ö†Ô∏è\x20[CHECK]\x20Payment\x20'+_0x29b50b+'\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20'+_0x32419f['gateway']+')');return;}if(_0x32419f[_0x59a464(0x292)]!==_0x59a464(0x1d8)){console[_0x59a464(0x231)](_0x59a464(0x1ce)+_0x29b50b+'\x20status\x20is\x20'+_0x32419f['status']+_0x59a464(0x1b2)),this['clearPaymentTimers'](_0x29b50b);return;}if(!_0x32419f[_0x59a464(0x282)]){console['log'](_0x59a464(0x1ce)+_0x29b50b+_0x59a464(0x287));return;}console[_0x59a464(0x231)]('‚úÖ\x20[CHECK]\x20Payment\x20'+_0x29b50b+_0x59a464(0x213)),await this[_0x59a464(0x29b)](_0x32419f);}[a37_0x5b580d(0x29d)](_0x1ceb79,_0x447d69,_0x8ffd92,_0x5002e6,_0x1c8ea6,_0x20c413){const _0x2f0a2e=a37_0x5b580d,_0x4d900f={'type':_0x2f0a2e(0x239),'paymentId':_0x1ceb79,'gatewayPaymentId':_0x447d69,'oldStatus':_0x8ffd92,'newStatus':_0x5002e6,'source':_0x1c8ea6,'timestamp':new Date()[_0x2f0a2e(0x27d)](),'details':_0x20c413||{}};loggerService_1[_0x2f0a2e(0x26c)][_0x2f0a2e(0x29d)](_0x4d900f),console[_0x2f0a2e(0x231)](_0x2f0a2e(0x268)+_0x1ceb79+'\x20('+_0x447d69+')'),console[_0x2f0a2e(0x231)]('\x20\x20\x20üìä\x20Status:\x20'+_0x8ffd92+'\x20->\x20'+_0x5002e6),console[_0x2f0a2e(0x231)](_0x2f0a2e(0x1ae)+_0x1c8ea6),console['log'](_0x2f0a2e(0x255)+_0x4d900f[_0x2f0a2e(0x275)]),_0x20c413&&console['log']('\x20\x20\x20üìù\x20Details:',_0x20c413);}[a37_0x5b580d(0x28f)](_0x26d01e,_0x27b6ce,_0x5ec48f,_0x2a0371,_0x2ea9ac){const _0x9b08c=a37_0x5b580d,_0x5cc582={'type':_0x9b08c(0x22b),'paymentId':_0x26d01e,'gatewayPaymentId':_0x27b6ce,'error':_0x5ec48f instanceof Error?{'message':_0x5ec48f['message'],'stack':_0x5ec48f['stack']}:_0x5ec48f,'source':_0x2a0371,'timestamp':new Date()['toISOString'](),'context':_0x2ea9ac||{}};loggerService_1[_0x9b08c(0x26c)]['logCoinToPayError'](_0x5cc582),console[_0x9b08c(0x250)](_0x9b08c(0x26a)+_0x26d01e+'\x20('+_0x27b6ce+')'),console[_0x9b08c(0x250)](_0x9b08c(0x279)+(_0x5ec48f instanceof Error?_0x5ec48f['message']:_0x5ec48f)),console[_0x9b08c(0x250)](_0x9b08c(0x1ae)+_0x2a0371),console[_0x9b08c(0x250)](_0x9b08c(0x255)+_0x5cc582[_0x9b08c(0x275)]),_0x2ea9ac&&console[_0x9b08c(0x250)](_0x9b08c(0x1dd),_0x2ea9ac);}[a37_0x5b580d(0x269)](){const _0x3dadd6=a37_0x5b580d;console[_0x3dadd6(0x231)](_0x3dadd6(0x291)),this[_0x3dadd6(0x1f7)]()[_0x3dadd6(0x24f)](_0x390faf=>{const _0x27efb1=_0x3dadd6;console['error'](_0x27efb1(0x1c5),_0x390faf);}),this[_0x3dadd6(0x1f9)]=setInterval(async()=>{const _0xe59154=_0x3dadd6;try{console[_0xe59154(0x231)](_0xe59154(0x1cd)),await this['checkAllPendingPayments'](),console[_0xe59154(0x231)]('‚úÖ\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed');}catch(_0x45ad6e){console[_0xe59154(0x250)]('‚ùå\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:',_0x45ad6e);}},this[_0x3dadd6(0x215)]),console[_0x3dadd6(0x231)](_0x3dadd6(0x214));}[a37_0x5b580d(0x1e3)](){const _0x584567=a37_0x5b580d;console['log'](_0x584567(0x2a5));this[_0x584567(0x1f9)]&&(clearInterval(this[_0x584567(0x1f9)]),this[_0x584567(0x1f9)]=null,console[_0x584567(0x231)](_0x584567(0x1c3)));const _0x364412=this[_0x584567(0x278)][_0x584567(0x277)];for(const [_0x2750e3]of this[_0x584567(0x278)]){this[_0x584567(0x23a)](_0x2750e3);}console[_0x584567(0x231)](_0x584567(0x1fe)+_0x364412+_0x584567(0x1ea));}async['checkAllPendingPayments'](){const _0x534239=a37_0x5b580d;try{console[_0x534239(0x231)](_0x534239(0x1f1));const _0x354198=await database_1[_0x534239(0x1bf)]['payment'][_0x534239(0x209)]({'where':{'gateway':{'in':[_0x534239(0x29c),_0x534239(0x201)]},'status':'PENDING','gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x534239(0x231)]('ü™ô\x20[GLOBAL]\x20Found\x20'+_0x354198[_0x534239(0x1c8)]+_0x534239(0x1cb));if(_0x354198['length']===0x0){console[_0x534239(0x231)]('ü™ô\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check');return;}const _0x75cd95=await this[_0x534239(0x21d)](_0x354198);console[_0x534239(0x231)](_0x534239(0x1c7)+_0x75cd95[_0x534239(0x1c8)]+_0x534239(0x260));let _0x3e6620=0x0,_0x408218=0x0;for(const _0x38cf14 of _0x354198){try{if(_0x75cd95[_0x534239(0x234)](_0x38cf14['id'])){console[_0x534239(0x231)](_0x534239(0x1fb)+_0x38cf14['id']+_0x534239(0x21e)),_0x408218++;continue;}if(this['paymentTimers'][_0x534239(0x1bb)](_0x38cf14['id'])){console[_0x534239(0x231)]('‚è∞\x20[GLOBAL]\x20Payment\x20'+_0x38cf14['id']+_0x534239(0x259)),_0x408218++;continue;}const _0x2692ad=(Date[_0x534239(0x1fc)]()-_0x38cf14[_0x534239(0x1d5)][_0x534239(0x27a)]())/(0x3e8*0x3c*0x3c);if(_0x2692ad<0x1){console[_0x534239(0x231)](_0x534239(0x1fb)+_0x38cf14['id']+'\x20is\x20too\x20new\x20('+_0x2692ad[_0x534239(0x220)](0x1)+_0x534239(0x274)),_0x408218++;continue;}console['log'](_0x534239(0x25f)+_0x38cf14['id']+_0x534239(0x1fa)+_0x2692ad['toFixed'](0x1)+'h)'),await this['checkSinglePayment'](_0x38cf14),_0x3e6620++,await new Promise(_0x4c3328=>setTimeout(_0x4c3328,0x7d0));}catch(_0x38dd1a){console[_0x534239(0x250)](_0x534239(0x20f)+_0x38cf14['id']+':',_0x38dd1a),this[_0x534239(0x28f)](_0x38cf14['id'],_0x38cf14[_0x534239(0x282)]||_0x534239(0x272),_0x38dd1a,_0x534239(0x1be),{'isGlobalCheck':!![],'paymentAmount':_0x38cf14[_0x534239(0x232)],'paymentCurrency':_0x38cf14[_0x534239(0x1af)],'shopId':_0x38cf14[_0x534239(0x249)],'createdAt':_0x38cf14[_0x534239(0x1d5)]}),loggerService_1['loggerService'][_0x534239(0x253)]('cointopay','/status/'+_0x38cf14[_0x534239(0x282)],_0x38dd1a);}}console[_0x534239(0x231)](_0x534239(0x1e5)+_0x3e6620+_0x534239(0x23d)+_0x408218+_0x534239(0x1c9)+_0x75cd95[_0x534239(0x1c8)]+_0x534239(0x208));}catch(_0x36eb01){console[_0x534239(0x250)](_0x534239(0x264),_0x36eb01);}}async[a37_0x5b580d(0x21d)](_0x3f33af){const _0x4aaa6d=a37_0x5b580d,_0x33d1f0=[],_0x19b69d=new Date();_0x19b69d[_0x4aaa6d(0x1da)](_0x19b69d[_0x4aaa6d(0x1e4)]()-this[_0x4aaa6d(0x1c6)]),console[_0x4aaa6d(0x231)](_0x4aaa6d(0x21f)+this['EXPIRY_DAYS']+_0x4aaa6d(0x25c)+_0x19b69d['toISOString']()+')');for(const _0x36d511 of _0x3f33af){if(_0x36d511[_0x4aaa6d(0x1d5)]<_0x19b69d){console[_0x4aaa6d(0x231)]('‚è∞\x20[EXPIRY]\x20Payment\x20'+_0x36d511['id']+_0x4aaa6d(0x298)+this['EXPIRY_DAYS']+_0x4aaa6d(0x295));try{this[_0x4aaa6d(0x29d)](_0x36d511['id'],_0x36d511['gatewayPaymentId']||'unknown',_0x4aaa6d(0x1d8),_0x4aaa6d(0x1b1),_0x4aaa6d(0x216),{'reason':'Payment\x20older\x20than\x20'+this[_0x4aaa6d(0x1c6)]+_0x4aaa6d(0x1e2),'createdAt':_0x36d511['createdAt'],'daysSinceCreation':Math[_0x4aaa6d(0x1ab)]((Date[_0x4aaa6d(0x1fc)]()-_0x36d511[_0x4aaa6d(0x1d5)]['getTime']())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x36d511['amount'],'paymentCurrency':_0x36d511[_0x4aaa6d(0x1af)],'shopId':_0x36d511[_0x4aaa6d(0x249)]}),await database_1['default'][_0x4aaa6d(0x25d)][_0x4aaa6d(0x297)]({'where':{'id':_0x36d511['id']},'data':{'status':_0x4aaa6d(0x1b1),'updatedAt':new Date(),'adminNotes':_0x4aaa6d(0x245)+this[_0x4aaa6d(0x1c6)]+_0x4aaa6d(0x2a6)}}),await database_1['default']['webhookLog'][_0x4aaa6d(0x1e0)]({'data':{'paymentId':_0x36d511['id'],'shopId':_0x36d511['shopId'],'event':_0x4aaa6d(0x23e),'statusCode':0xc8,'responseBody':JSON[_0x4aaa6d(0x1f5)]({'reason':'Payment\x20older\x20than\x20'+this['EXPIRY_DAYS']+_0x4aaa6d(0x1e2),'createdAt':_0x36d511[_0x4aaa6d(0x1d5)],'expiredAt':new Date()[_0x4aaa6d(0x27d)](),'daysSinceCreation':Math[_0x4aaa6d(0x1ab)]((Date[_0x4aaa6d(0x1fc)]()-_0x36d511[_0x4aaa6d(0x1d5)][_0x4aaa6d(0x27a)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x4aaa6d(0x24d)](_0x36d511,_0x4aaa6d(0x1b1)),await this['sendPaymentStatusNotification'](_0x36d511,_0x4aaa6d(0x1b1)),this['clearPaymentTimers'](_0x36d511['id']),_0x33d1f0[_0x4aaa6d(0x237)](_0x36d511['id']),console[_0x4aaa6d(0x231)]('‚úÖ\x20[EXPIRY]\x20Payment\x20'+_0x36d511['id']+_0x4aaa6d(0x235)+this[_0x4aaa6d(0x1c6)]+_0x4aaa6d(0x270));}catch(_0x5b5112){console['error'](_0x4aaa6d(0x1d6)+_0x36d511['id']+':',_0x5b5112),this[_0x4aaa6d(0x28f)](_0x36d511['id'],_0x36d511[_0x4aaa6d(0x282)]||_0x4aaa6d(0x272),_0x5b5112,'auto_expire',{'reason':_0x4aaa6d(0x27c),'createdAt':_0x36d511[_0x4aaa6d(0x1d5)],'daysSinceCreation':Math[_0x4aaa6d(0x1ab)]((Date[_0x4aaa6d(0x1fc)]()-_0x36d511[_0x4aaa6d(0x1d5)]['getTime']())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x33d1f0;}async[a37_0x5b580d(0x29b)](_0x51a2b5){const _0x218811=a37_0x5b580d;if(!_0x51a2b5[_0x218811(0x282)]){console[_0x218811(0x231)](_0x218811(0x1ce)+_0x51a2b5['id']+_0x218811(0x23b));return;}console[_0x218811(0x231)](_0x218811(0x1b4)+_0x51a2b5[_0x218811(0x1c0)]+_0x218811(0x22e)+_0x51a2b5['id']+'\x20('+_0x51a2b5['gatewayPaymentId']+')');try{let _0x533c43;_0x51a2b5['gateway']===_0x218811(0x201)?(_0x533c43=await this['coinToPay2Service']['checkPaymentStatus'](_0x51a2b5['gatewayPaymentId']),console[_0x218811(0x231)](_0x218811(0x211)+_0x51a2b5['id']+_0x218811(0x25a)+_0x533c43[_0x218811(0x292)])):(_0x533c43=await this[_0x218811(0x276)]['checkPaymentStatus'](_0x51a2b5[_0x218811(0x282)]),console[_0x218811(0x231)](_0x218811(0x1e6)+_0x51a2b5['id']+'\x20status:\x20'+_0x533c43[_0x218811(0x292)]));_0x533c43[_0x218811(0x24e)]&&console[_0x218811(0x231)](_0x218811(0x219)+_0x51a2b5['id']+_0x218811(0x1ad),{'iban':_0x533c43[_0x218811(0x24e)][_0x218811(0x1f8)]||_0x218811(0x248),'transactionId':_0x533c43[_0x218811(0x24e)][_0x218811(0x200)],'createdOn':_0x533c43[_0x218811(0x24e)][_0x218811(0x26d)],'confirmedOn':_0x533c43[_0x218811(0x24e)][_0x218811(0x263)]||_0x218811(0x24a)});if(_0x533c43[_0x218811(0x292)]!==_0x51a2b5[_0x218811(0x292)]){console[_0x218811(0x231)](_0x218811(0x1f0)+_0x51a2b5['id']+_0x218811(0x254)+_0x51a2b5[_0x218811(0x292)]+_0x218811(0x27e)+_0x533c43[_0x218811(0x292)]),this[_0x218811(0x29d)](_0x51a2b5['id'],_0x51a2b5[_0x218811(0x282)],_0x51a2b5['status'],_0x533c43[_0x218811(0x292)],_0x218811(0x1be),{'paymentDetails':_0x533c43[_0x218811(0x24e)],'amount':_0x533c43[_0x218811(0x232)],'currency':_0x533c43[_0x218811(0x1af)],'shopId':_0x51a2b5[_0x218811(0x249)],'checkTimestamp':new Date()[_0x218811(0x27d)]()});const _0x53b185={'status':_0x533c43[_0x218811(0x292)],'updatedAt':new Date()};_0x533c43[_0x218811(0x292)]==='PAID'&&_0x51a2b5['status']!=='PAID'&&(_0x53b185[_0x218811(0x1ee)]=new Date(),console[_0x218811(0x231)](_0x218811(0x1b3)+_0x51a2b5['id']+_0x218811(0x299)+_0x53b185[_0x218811(0x1ee)]['toISOString']()));if(_0x533c43[_0x218811(0x24e)]){const _0x5323e4=_0x533c43[_0x218811(0x24e)];_0x5323e4[_0x218811(0x1f8)]&&(_0x53b185[_0x218811(0x1b7)]=_0x5323e4['iban'],console[_0x218811(0x231)]('üè¶\x20[CHECK]\x20Saved\x20IBAN:\x20'+_0x5323e4[_0x218811(0x1f8)]));if(_0x5323e4[_0x218811(0x2a9)]){const _0x3ce6a7=_0x51a2b5[_0x218811(0x252)]||'',_0x5d050b=_0x218811(0x267)+_0x5323e4[_0x218811(0x2a9)];_0x53b185[_0x218811(0x252)]=_0x3ce6a7?_0x3ce6a7+'\x0a\x0a'+_0x5d050b:_0x5d050b,console[_0x218811(0x231)](_0x218811(0x26f));}_0x5323e4[_0x218811(0x200)]&&console[_0x218811(0x231)]('üÜî\x20[CHECK]\x20Transaction\x20ID:\x20'+_0x5323e4[_0x218811(0x200)]),_0x5323e4['confirmedOn']&&console['log']('‚úÖ\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20'+_0x5323e4['confirmedOn']);}await database_1['default'][_0x218811(0x25d)][_0x218811(0x297)]({'where':{'id':_0x51a2b5['id']},'data':_0x53b185});if(_0x533c43[_0x218811(0x292)]===_0x218811(0x1de)&&_0x51a2b5[_0x218811(0x292)]!==_0x218811(0x1de)){console['log']('üìà\x20[COINTOPAY]\x20Payment\x20'+_0x51a2b5['id']+_0x218811(0x28e));const _0xfec827=await database_1[_0x218811(0x1bf)][_0x218811(0x25d)][_0x218811(0x1e8)]({'where':{'id':_0x51a2b5['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0xfec827?.[_0x218811(0x2a8)]&&_0xfec827[_0x218811(0x251)])try{const _0x1a607f=_0xfec827[_0x218811(0x251)];console[_0x218811(0x231)]('üìà\x20[COINTOPAY]\x20Found\x20payment\x20link\x20'+_0x1a607f['id']+_0x218811(0x29a)+_0x1a607f[_0x218811(0x257)]+',\x20currentPayments='+_0x1a607f[_0x218811(0x20a)]+',\x20status='+_0x1a607f['status']);const _0x25ed82=_0x1a607f[_0x218811(0x20a)]+0x1,_0x50c1ff=_0x1a607f['type']===_0x218811(0x280)?_0x218811(0x1c2):_0x1a607f[_0x218811(0x292)];await database_1['default'][_0x218811(0x251)][_0x218811(0x297)]({'where':{'id':_0x1a607f['id']},'data':{'currentPayments':_0x25ed82,'status':_0x50c1ff,'updatedAt':new Date()}}),console[_0x218811(0x231)](_0x218811(0x1bd)+_0x1a607f['id']+_0x218811(0x203)+_0x1a607f[_0x218811(0x20a)]+_0x218811(0x20b)+_0x25ed82+_0x218811(0x1f3)+_0x1a607f[_0x218811(0x292)]+'\x20->\x20'+_0x50c1ff);}catch(_0x19062c){console[_0x218811(0x250)](_0x218811(0x1d7),_0x19062c);}else console[_0x218811(0x231)](_0x218811(0x228)+_0x51a2b5['id']+_0x218811(0x294));}await database_1[_0x218811(0x1bf)]['webhookLog'][_0x218811(0x1e0)]({'data':{'paymentId':_0x51a2b5['id'],'shopId':_0x51a2b5[_0x218811(0x249)],'event':'cointopay_status_check_'+_0x533c43['status'][_0x218811(0x207)](),'statusCode':0xc8,'responseBody':JSON[_0x218811(0x1f5)]({'oldStatus':_0x51a2b5[_0x218811(0x292)],'newStatus':_0x533c43[_0x218811(0x292)],'paymentDetails':_0x533c43[_0x218811(0x24e)],'checkedAt':new Date()[_0x218811(0x27d)]()})}}),await this[_0x218811(0x24d)](_0x51a2b5,_0x533c43[_0x218811(0x292)]),await this[_0x218811(0x20c)](_0x51a2b5,_0x533c43[_0x218811(0x292)]),_0x533c43[_0x218811(0x292)]!=='PENDING'&&(console[_0x218811(0x231)](_0x218811(0x1c1)+_0x51a2b5['id']+_0x218811(0x1db)+_0x533c43[_0x218811(0x292)]+_0x218811(0x290)),this['clearPaymentTimers'](_0x51a2b5['id'])),console[_0x218811(0x231)](_0x218811(0x1cc)+_0x51a2b5['id']+_0x218811(0x1d0));}else console[_0x218811(0x231)]('üìä\x20[CHECK]\x20Payment\x20'+_0x51a2b5['id']+'\x20status\x20unchanged\x20('+_0x533c43[_0x218811(0x292)]+')'),this['logCoinToPayStatus'](_0x51a2b5['id'],_0x51a2b5[_0x218811(0x282)],_0x51a2b5['status'],_0x533c43[_0x218811(0x292)],_0x218811(0x1be),{'statusUnchanged':!![],'paymentDetails':_0x533c43[_0x218811(0x24e)],'amount':_0x533c43[_0x218811(0x232)],'currency':_0x533c43['currency'],'shopId':_0x51a2b5[_0x218811(0x249)],'checkTimestamp':new Date()['toISOString']()});}catch(_0x419a05){console[_0x218811(0x250)](_0x218811(0x286)+_0x51a2b5['id']+':',_0x419a05),this['logCoinToPayError'](_0x51a2b5['id'],_0x51a2b5[_0x218811(0x282)],_0x419a05,_0x218811(0x1be),{'paymentAmount':_0x51a2b5[_0x218811(0x232)],'paymentCurrency':_0x51a2b5[_0x218811(0x1af)],'shopId':_0x51a2b5[_0x218811(0x249)],'createdAt':_0x51a2b5[_0x218811(0x1d5)]}),await database_1[_0x218811(0x1bf)]['webhookLog'][_0x218811(0x1e0)]({'data':{'paymentId':_0x51a2b5['id'],'shopId':_0x51a2b5[_0x218811(0x249)],'event':'cointopay_status_check_error','statusCode':0x1f4,'responseBody':JSON[_0x218811(0x1f5)]({'error':_0x419a05 instanceof Error?_0x419a05[_0x218811(0x22f)]:'Unknown\x20error','gatewayPaymentId':_0x51a2b5[_0x218811(0x282)],'checkedAt':new Date()['toISOString']()})}});}}async[a37_0x5b580d(0x24d)](_0x1ee261,_0x57764d){const _0x196816=a37_0x5b580d,_0x469762=Date[_0x196816(0x1fc)]();try{const _0x5f0bad=_0x1ee261['shop'],_0x32b284=_0x5f0bad[_0x196816(0x1ca)];if(!_0x32b284?.[_0x196816(0x2a0)]){console[_0x196816(0x231)](_0x196816(0x283)+_0x5f0bad['id']);return;}const _0xeeb5b1=_0x57764d===_0x196816(0x1de)?'payment.success':_0x57764d==='FAILED'?_0x196816(0x2a4):_0x57764d===_0x196816(0x1b1)?_0x196816(0x2a4):_0x196816(0x23f);if(!_0x32b284[_0x196816(0x1ec)]?.['includes'](_0xeeb5b1)){console[_0x196816(0x231)](_0x196816(0x1b9)+_0xeeb5b1+_0x196816(0x1b8)+_0x5f0bad['id']);return;}const _0x489d40=(0x0,gateway_1[_0x196816(0x1d2)])(_0x1ee261[_0x196816(0x1c0)])||_0x1ee261[_0x196816(0x1c0)],_0x417bf2={'event':_0xeeb5b1,'payment':{'id':_0x1ee261['id'],'order_id':_0x1ee261['orderId'],'gateway_order_id':_0x1ee261['gatewayOrderId'],'gateway':_0x489d40,'amount':_0x1ee261[_0x196816(0x232)],'currency':_0x1ee261[_0x196816(0x1af)],'status':_0x57764d['toLowerCase'](),'customer_email':_0x1ee261[_0x196816(0x1f2)],'customer_name':_0x1ee261[_0x196816(0x285)],'created_at':_0x1ee261[_0x196816(0x1d5)],'updated_at':new Date()}},_0x2a2ab6=await fetch(_0x32b284[_0x196816(0x2a0)],{'method':'POST','headers':{'Content-Type':_0x196816(0x1d9),'User-Agent':_0x196816(0x281)},'body':JSON['stringify'](_0x417bf2)}),_0x331e38=Date[_0x196816(0x1fc)]()-_0x469762,_0x11bbb3=_0x2a2ab6['ok']?'Success':await _0x2a2ab6['text']();loggerService_1[_0x196816(0x26c)]['logShopWebhookSent'](_0x1ee261[_0x196816(0x249)],_0x32b284[_0x196816(0x2a0)],_0xeeb5b1,_0x2a2ab6[_0x196816(0x292)],_0x331e38,_0x417bf2),console[_0x196816(0x231)]('Shop\x20webhook\x20sent\x20to\x20'+_0x32b284[_0x196816(0x2a0)]+_0x196816(0x21a)+_0x2a2ab6[_0x196816(0x292)]+'\x20('+_0x331e38+_0x196816(0x22a));}catch(_0x4d6938){console[_0x196816(0x250)](_0x196816(0x223),_0x4d6938),loggerService_1[_0x196816(0x26c)][_0x196816(0x1bc)](_0x1ee261[_0x196816(0x249)],_0x1ee261['shop']?.[_0x196816(0x1ca)]?.['webhookUrl']||_0x196816(0x272),_0x196816(0x1e1),_0x4d6938,{});}}async[a37_0x5b580d(0x20c)](_0x9172ab,_0xcb713a){const _0x35ecb7=a37_0x5b580d;try{const _0x11101a={'PENDING':'created','PAID':_0x35ecb7(0x221),'FAILED':_0x35ecb7(0x29e),'EXPIRED':_0x35ecb7(0x2a7)},_0x29c6bf=_0x11101a[_0xcb713a];if(!_0x29c6bf||_0x29c6bf==='created')return;await telegramBotService_1[_0x35ecb7(0x28d)][_0x35ecb7(0x224)](_0x9172ab[_0x35ecb7(0x249)],_0x9172ab,_0x29c6bf);}catch(_0xbc9ab1){console[_0x35ecb7(0x250)](_0x35ecb7(0x25e),_0xbc9ab1);}}async[a37_0x5b580d(0x27b)](_0xf5c58c){const _0x51de47=a37_0x5b580d;console['log'](_0x51de47(0x284)+_0xf5c58c);const _0x4c610e=await database_1['default'][_0x51de47(0x25d)][_0x51de47(0x1e8)]({'where':{'id':_0xf5c58c},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x4c610e)throw new Error('Payment\x20not\x20found');if(_0x4c610e[_0x51de47(0x1c0)]!==_0x51de47(0x29c)&&_0x4c610e[_0x51de47(0x1c0)]!==_0x51de47(0x201))throw new Error(_0x51de47(0x1d1));console[_0x51de47(0x231)](_0x51de47(0x230)+_0x4c610e[_0x51de47(0x1c0)]+_0x51de47(0x22e)+_0xf5c58c),await this['checkSinglePayment'](_0x4c610e),console['log'](_0x51de47(0x1e7)+_0xf5c58c);}['getServiceStats'](){const _0x59c4dc=a37_0x5b580d,_0x510904=this[_0x59c4dc(0x1f9)]?this['GLOBAL_CHECK_INTERVAL_MS']:undefined,_0x3c1e9a=Array[_0x59c4dc(0x229)](this['paymentTimers'][_0x59c4dc(0x28b)]())[_0x59c4dc(0x233)](_0x3be516=>({'paymentId':_0x3be516['paymentId'],'gatewayPaymentId':_0x3be516[_0x59c4dc(0x282)],'createdAt':_0x3be516['createdAt'],'timersCount':_0x3be516[_0x59c4dc(0x210)]['length']}));return{'isActive':!!this['globalCheckInterval'],'globalCheckIntervalMinutes':this['GLOBAL_CHECK_INTERVAL_MS']/(0x3e8*0x3c),'expiryDays':this[_0x59c4dc(0x1c6)],'activeIndividualTimers':this[_0x59c4dc(0x278)][_0x59c4dc(0x277)],'nextGlobalCheckIn':_0x510904,'paymentTimersDetails':_0x3c1e9a};}[a37_0x5b580d(0x226)](_0x536e67){const _0x56a7aa=a37_0x5b580d,_0xc8f2d1=this[_0x56a7aa(0x278)]['get'](_0x536e67);if(_0xc8f2d1)return{'hasTimers':!![],'timersCount':_0xc8f2d1[_0x56a7aa(0x210)][_0x56a7aa(0x1c8)],'createdAt':_0xc8f2d1[_0x56a7aa(0x1d5)],'gatewayPaymentId':_0xc8f2d1['gatewayPaymentId']};return{'hasTimers':![]};}}exports[a37_0x5b580d(0x1f6)]=CoinToPayStatusService,exports[a37_0x5b580d(0x21c)]=new CoinToPayStatusService();