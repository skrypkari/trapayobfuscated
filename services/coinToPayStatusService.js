'use strict';const a37_0x5570b4=a37_0x2261;(function(_0x378df1,_0x24cf3d){const _0x5665e0=a37_0x2261,_0x14316b=_0x378df1();while(!![]){try{const _0x1bc32a=parseInt(_0x5665e0(0xc6))/0x1+parseInt(_0x5665e0(0x10e))/0x2*(-parseInt(_0x5665e0(0xa6))/0x3)+parseInt(_0x5665e0(0x153))/0x4+-parseInt(_0x5665e0(0x16f))/0x5+parseInt(_0x5665e0(0x112))/0x6+parseInt(_0x5665e0(0x129))/0x7*(parseInt(_0x5665e0(0xa4))/0x8)+parseInt(_0x5665e0(0xc0))/0x9*(-parseInt(_0x5665e0(0x15e))/0xa);if(_0x1bc32a===_0x24cf3d)break;else _0x14316b['push'](_0x14316b['shift']());}catch(_0x29e812){_0x14316b['push'](_0x14316b['shift']());}}}(a37_0x4d19,0xa19d6));var __importDefault=this&&this[a37_0x5570b4(0x101)]||function(_0x22e789){const _0x56a78e=a37_0x5570b4;return _0x22e789&&_0x22e789[_0x56a78e(0x164)]?_0x22e789:{'default':_0x22e789};};function a37_0x2261(_0x1e6979,_0x1da6b5){const _0x4d1915=a37_0x4d19();return a37_0x2261=function(_0x2261c3,_0x1fe5da){_0x2261c3=_0x2261c3-0xa3;let _0x385f14=_0x4d1915[_0x2261c3];return _0x385f14;},a37_0x2261(_0x1e6979,_0x1da6b5);}Object['defineProperty'](exports,a37_0x5570b4(0x164),{'value':!![]}),exports['coinToPayStatusService']=exports[a37_0x5570b4(0xb4)]=void 0x0;function a37_0x4d19(){const _0x494977=['webhookEvents','__esModule','createdOn','‚úÖ\x20[DEBUG]\x20Successfully\x20scheduled\x20','application/json','setDate','\x20\x20\x20üìù\x20Context:','ü™ô\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','Bank\x20Details:\x20','\x20pending\x20CoinToPay\x20payments','\x20current\x20status:\x20','logCoinToPayError','1233725VAdvGP','\x20marked\x20as\x20paid\x20at:\x20','payment.success','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','findUnique','-day\x20timeout','logShopWebhookError','adminNotes','checkPaymentById','Automatically\x20expired\x20after\x20','\x20->\x20','stopPeriodicStatusCheck','cointopay',',\x20stopping\x20individual\x20checks','\x20not\x20found\x20in\x20database','\x20payment\x20','gateway','\x20status\x20unchanged\x20(','loggerService','\x20\x20\x20üìç\x20Source:\x20','Failed\x20to\x20mark\x20payment\x20as\x20expired','‚è∞\x20[DEBUG]\x20Scheduled\x20check\x20#','delay','EXPIRED','cointopay_auto_expired','COINTOPAY_ERROR','\x20status:\x20','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','ü™ô\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','\x20days','PAID','POST','\x20\x20\x20üìä\x20Status:\x20','‚è∞\x20[GLOBAL]\x20Payment\x20','5\x20minutes','gatewayOrderId','floor','values','\x20found:','GLOBAL_CHECK_INTERVAL_MS','includes','2634416ZuOddi','log','4923JMAZXI','\x20has\x20no\x20gatewayPaymentId','‚úÖ\x20[EXPIRY]\x20Payment\x20','globalCheckInterval','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','has','currency','cointopay_status_check_error','shop','üè¶\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes','\x20individual\x20payment\x20timers','\x20\x20\x20-\x20Gateway:\x20','checkSinglePayment','‚úÖ\x20[HOURLY]\x20Payment\x20','CoinToPayStatusService','logShopWebhookSent','gatewayPaymentId','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','expired','‚ùå\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','\x20is\x20older\x20than\x20','error','logCoinToPayStatus','FAILED','‚úÖ\x20[TIMER]\x20Individual\x20check\x20#','timestamp','56772ZhzdOv','created','sendPaymentStatusNotification','timers','bankDetails','./telegramBotService','296892VelKJW','\x20status\x20is\x20','\x20completed\x20for\x20payment\x20','\x20days\x20(created\x20before\x20','sendShopWebhook','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','update','createdAt','\x20not\x20enabled\x20for\x20shop\x20','üìä\x20[HOURLY]\x20Payment\x20','customerName','startPeriodicStatusCheck','\x20\x20\x20-\x20paymentId:\x20','h),\x20skipping\x20global\x20check','logWhiteDomainError','\x20for\x20payment\x20','üîç\x20[CHECK]\x20Checking\x20','schedule_created','paymentTimers','auto_expire','settings','‚è∞\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','\x20checked,\x20','üìä\x20[CHECK]\x20Payment\x20','‚ùå\x20[HOURLY]\x20Payment\x20','üìä\x20[CHECK]\x20CoinToPay2\x20payment\x20','amount','from','cointopay_status_check_','orderId','EXPIRY_DAYS','findMany','./gateways/coinToPay2Service','coinToPayStatusService','map','ü™ô\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','‚ùå\x20[CHECK]\x20Payment\x20','payment.failed','iban','Unknown\x20error','\x20\x20\x20üìù\x20Details:','not\x20confirmed','PENDING','CoinToPayService','description','paymentDetails','ü™ô\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','paidAt','üè¶\x20[CHECK]\x20Saved\x20IBAN:\x20','create','üîç\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','Webhook\x20event\x20','getGatewayIdByName','length','‚úÖ\x20[CHECK]\x20Payment\x20','üõë\x20[SHUTDOWN]\x20Cleared\x20','\x20to\x20clear','‚úÖ\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','‚ùå\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','__importDefault','not\x20found','\x20\x20\x20üìÖ\x20Time:\x20','‚è∞\x20[GLOBAL]\x20Found\x20','\x20is\x20valid\x20for\x20checking,\x20proceeding...','unknown','schedulePaymentChecks','checkAllPendingPayments','\x20updated\x20successfully','‚úÖ\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','toFixed','üîç\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','\x20expired\x20CoinToPay\x20payments','544TrKtgo','ü™ô\x20[TIMER]\x20Individual\x20check\x20#','\x20has\x20no\x20gatewayPaymentId,\x20skipping','üõë\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','2242740znUzDf','../config/database','\x20status\x20from\x20','ü™ô\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','‚ùå\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','transactionId','payment','checkPaymentStatus','CoinToPay2Service','shopId','text','delete','ü™ô\x20[DEBUG]\x20Creating\x20','‚è∞\x20[HOURLY]\x20Payment\x20','cointopay2','üÜî\x20[CHECK]\x20Transaction\x20ID:\x20','Payment\x20older\x20than\x20','1\x20minute','confirmedOn','\x20days,\x20marking\x20as\x20EXPIRED','\x20initial\x20timers\x20for\x20payment\x20','\x20(age:\x20','üîÑ\x20[CHECK]\x20Updating\x20payment\x20','28smkemQ','\x20days\x20without\x20payment\x20confirmation','sendPaymentNotification','checkExpiredPayments','\x20\x20\x20-\x20gatewayPaymentId:\x20','/status/','./loggerService','üîç\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','üßπ\x20[DEBUG]\x20Clearing\x20','ü™ô\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','size','webhookUrl','üí∞\x20[CHECK]\x20Payment\x20','‚úÖ\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','\x20is\x20too\x20new\x20(','stringify','‚è∞\x20[EXPIRY]\x20Payment\x20','status_check','\x20\x20\x20-\x20Amount:\x20','getPaymentTimerInfo','set','status','Shop\x20webhook\x20sent\x20to\x20','‚ö†Ô∏è\x20[CHECK]\x20Payment\x20','checkSinglePaymentById','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','get','ü™ô\x20[GLOBAL]\x20Found\x20','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','ms)','getTime','‚úÖ\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','\x20with\x20status\x20','clearPaymentTimers','üßπ\x20[CHECK]\x20Payment\x20','\x20\x20\x20‚ùå\x20Error:\x20','ü™ô\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','../types/gateway','toISOString','\x20details:','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','\x20in\x20','2338500AQtwIH','üìä\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','\x20expired','default',',\x20clearing\x20individual\x20timers','now','paid','./gateways/coinToPayService','webhookLog','coinToPayService','message','1930JNrpwA','‚úÖ\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','paymentId','failed','push'];a37_0x4d19=function(){return _0x494977;};return a37_0x4d19();}const coinToPayService_1=require(a37_0x5570b4(0x15a)),coinToPay2Service_1=require(a37_0x5570b4(0xe6)),gateway_1=require(a37_0x5570b4(0x14e)),database_1=__importDefault(require(a37_0x5570b4(0x113))),telegramBotService_1=require(a37_0x5570b4(0xc5)),loggerService_1=require(a37_0x5570b4(0x12f));class CoinToPayStatusService{constructor(){const _0x3f7992=a37_0x5570b4;this[_0x3f7992(0xa9)]=null,this[_0x3f7992(0x197)]=0x3c*0x3c*0x3e8,this['EXPIRY_DAYS']=0x5,this['paymentTimers']=new Map(),this['coinToPayService']=new coinToPayService_1[(_0x3f7992(0xf1))](),this['coinToPay2Service']=new coinToPay2Service_1[(_0x3f7992(0x11a))](),console[_0x3f7992(0xa5)](_0x3f7992(0x14d));}[a37_0x5570b4(0x107)](_0x106228,_0x41f356){const _0x2e36ca=a37_0x5570b4;console['log']('ü™ô\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:'),console['log'](_0x2e36ca(0xd2)+_0x106228),console['log'](_0x2e36ca(0x12d)+_0x41f356),this[_0x2e36ca(0x14a)](_0x106228);const _0x35428b=[],_0x43cf52=new Date(),_0x28aeeb=[{'delay':0x1*0x3c*0x3e8,'description':_0x2e36ca(0x123)},{'delay':0x2*0x3c*0x3e8,'description':'2\x20minutes'},{'delay':0x5*0x3c*0x3e8,'description':_0x2e36ca(0x192)},{'delay':0x5*0x3c*0x3e8,'description':'5\x20minutes'}];console[_0x2e36ca(0xa5)](_0x2e36ca(0x11e)+_0x28aeeb[_0x2e36ca(0xfb)]+_0x2e36ca(0x126)+_0x106228);let _0x5a223e=0x0;_0x28aeeb['forEach']((_0x255193,_0x59128d)=>{const _0x4a6269=_0x2e36ca;_0x5a223e+=_0x255193[_0x4a6269(0x185)];const _0x24fc58=setTimeout(async()=>{const _0x925c73=_0x4a6269;console[_0x925c73(0xa5)](_0x925c73(0x10f)+(_0x59128d+0x1)+'\x20triggered\x20for\x20payment\x20'+_0x106228+'\x20(after\x20'+_0x255193['description']+')');try{await this[_0x925c73(0x141)](_0x106228),console['log'](_0x925c73(0xbe)+(_0x59128d+0x1)+_0x925c73(0xc8)+_0x106228);}catch(_0x3077a2){console['error']('‚ùå\x20[TIMER]\x20Failed\x20individual\x20check\x20#'+(_0x59128d+0x1)+_0x925c73(0xd5)+_0x106228+':',_0x3077a2),this['logCoinToPayError'](_0x106228,_0x41f356,_0x3077a2,_0x925c73(0x13a),{'checkNumber':_0x59128d+0x1,'scheduledAfter':_0x255193['description'],'isIndividualCheck':!![]});}},_0x5a223e);_0x35428b[_0x4a6269(0x162)](_0x24fc58),console[_0x4a6269(0xa5)](_0x4a6269(0x184)+(_0x59128d+0x1)+_0x4a6269(0xd5)+_0x106228+_0x4a6269(0x152)+_0x5a223e/0x3e8+'\x20seconds\x20('+_0x255193[_0x4a6269(0xf2)]+')');});const _0xa61473=setInterval(async()=>{const _0x242d80=_0x2e36ca;console[_0x242d80(0xa5)](_0x242d80(0x115)+_0x106228);try{const _0x5ecee9=await database_1[_0x242d80(0x156)][_0x242d80(0x118)]['findUnique']({'where':{'id':_0x106228},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x5ecee9){console[_0x242d80(0xa5)](_0x242d80(0xde)+_0x106228+'\x20not\x20found,\x20clearing\x20timers'),this[_0x242d80(0x14a)](_0x106228);return;}console[_0x242d80(0xa5)](_0x242d80(0xcf)+_0x106228+_0x242d80(0x16d)+_0x5ecee9[_0x242d80(0x13e)]);if(_0x5ecee9[_0x242d80(0x13e)]!==_0x242d80(0xf0)){console[_0x242d80(0xa5)](_0x242d80(0xb3)+_0x106228+'\x20status\x20is\x20'+_0x5ecee9[_0x242d80(0x13e)]+_0x242d80(0x17c)),this[_0x242d80(0x14a)](_0x106228);return;}const _0x7d764b=Math[_0x242d80(0x194)]((Date[_0x242d80(0x158)]()-_0x5ecee9[_0x242d80(0xcd)][_0x242d80(0x147)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x7d764b>=this[_0x242d80(0xe4)]){console[_0x242d80(0xa5)](_0x242d80(0x11f)+_0x106228+'\x20is\x20older\x20than\x20'+this['EXPIRY_DAYS']+'\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check'),this['clearPaymentTimers'](_0x106228);return;}await this[_0x242d80(0x141)](_0x106228),console['log'](_0x242d80(0x15f)+_0x106228);}catch(_0x39f5e7){console[_0x242d80(0xbb)]('‚ùå\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20'+_0x106228+':',_0x39f5e7),this[_0x242d80(0x16e)](_0x106228,_0x41f356,_0x39f5e7,_0x242d80(0x13a),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x35428b[_0x2e36ca(0x162)](_0xa61473),this[_0x2e36ca(0xd8)][_0x2e36ca(0x13d)](_0x106228,{'timers':_0x35428b,'paymentId':_0x106228,'gatewayPaymentId':_0x41f356,'createdAt':_0x43cf52}),console['log'](_0x2e36ca(0x166)+_0x28aeeb[_0x2e36ca(0xfb)]+'\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20'+_0x106228),console[_0x2e36ca(0xa5)](_0x2e36ca(0x154)+this[_0x2e36ca(0xd8)][_0x2e36ca(0x133)]),this[_0x2e36ca(0xbc)](_0x106228,_0x41f356,_0x2e36ca(0xf0),_0x2e36ca(0xf0),_0x2e36ca(0x13a),{'action':_0x2e36ca(0xd7),'scheduledChecks':_0x28aeeb['length'],'firstCheckIn':_0x28aeeb[0x0]['delay']/0x3e8,'totalTimers':this[_0x2e36ca(0xd8)][_0x2e36ca(0x133)]});}['clearPaymentTimers'](_0x1d4dbf){const _0x3d2faf=a37_0x5570b4,_0x597c85=this[_0x3d2faf(0xd8)][_0x3d2faf(0x143)](_0x1d4dbf);_0x597c85?(console[_0x3d2faf(0xa5)](_0x3d2faf(0x131)+_0x597c85[_0x3d2faf(0xc3)][_0x3d2faf(0xfb)]+'\x20timers\x20for\x20payment\x20'+_0x1d4dbf),_0x597c85[_0x3d2faf(0xc3)]['forEach']((_0x6e8ea6,_0x3b6f82)=>{const _0x20c26d=_0x3d2faf;_0x6e8ea6&&(clearTimeout(_0x6e8ea6),clearInterval(_0x6e8ea6),console['log']('üßπ\x20[DEBUG]\x20Cleared\x20timer\x20#'+(_0x3b6f82+0x1)+_0x20c26d(0xd5)+_0x1d4dbf));}),this[_0x3d2faf(0xd8)][_0x3d2faf(0x11d)](_0x1d4dbf),console['log'](_0x3d2faf(0x10a)+_0x1d4dbf+'.\x20Remaining\x20active\x20timers:\x20'+this['paymentTimers'][_0x3d2faf(0x133)])):console[_0x3d2faf(0xa5)]('‚ö†Ô∏è\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20'+_0x1d4dbf+_0x3d2faf(0xfe));}async[a37_0x5570b4(0x141)](_0x48e09f){const _0x101dd2=a37_0x5570b4;console[_0x101dd2(0xa5)](_0x101dd2(0xf8)+_0x48e09f);const _0x633b28=await database_1[_0x101dd2(0x156)][_0x101dd2(0x118)]['findUnique']({'where':{'id':_0x48e09f},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x633b28){console[_0x101dd2(0xa5)](_0x101dd2(0xea)+_0x48e09f+_0x101dd2(0x17d));return;}console[_0x101dd2(0xa5)]('üìä\x20[CHECK]\x20Payment\x20'+_0x48e09f+_0x101dd2(0x196)),console[_0x101dd2(0xa5)](_0x101dd2(0xb1)+_0x633b28['gateway']),console[_0x101dd2(0xa5)]('\x20\x20\x20-\x20Status:\x20'+_0x633b28[_0x101dd2(0x13e)]),console[_0x101dd2(0xa5)]('\x20\x20\x20-\x20GatewayPaymentId:\x20'+_0x633b28[_0x101dd2(0xb6)]),console['log'](_0x101dd2(0x13b)+_0x633b28['amount']+'\x20'+_0x633b28['currency']),console[_0x101dd2(0xa5)]('\x20\x20\x20-\x20ShopId:\x20'+_0x633b28[_0x101dd2(0x11b)]);if(_0x633b28[_0x101dd2(0x17f)]!=='cointopay'&&_0x633b28[_0x101dd2(0x17f)]!=='cointopay2'){console[_0x101dd2(0xa5)](_0x101dd2(0x140)+_0x48e09f+_0x101dd2(0x172)+_0x633b28[_0x101dd2(0x17f)]+')');return;}if(_0x633b28[_0x101dd2(0x13e)]!=='PENDING'){console[_0x101dd2(0xa5)]('‚ö†Ô∏è\x20[CHECK]\x20Payment\x20'+_0x48e09f+_0x101dd2(0xc7)+_0x633b28['status']+',\x20stopping\x20individual\x20checks'),this[_0x101dd2(0x14a)](_0x48e09f);return;}if(!_0x633b28[_0x101dd2(0xb6)]){console[_0x101dd2(0xa5)](_0x101dd2(0x140)+_0x48e09f+_0x101dd2(0xa7));return;}console[_0x101dd2(0xa5)](_0x101dd2(0xfc)+_0x48e09f+_0x101dd2(0x105)),await this[_0x101dd2(0xb2)](_0x633b28);}[a37_0x5570b4(0xbc)](_0x2e72b3,_0x2367bf,_0x23e9ab,_0x3d6cf0,_0x2c44e3,_0x148f2c){const _0x23649c=a37_0x5570b4,_0x2b60a3={'type':'COINTOPAY_STATUS_CHANGE','paymentId':_0x2e72b3,'gatewayPaymentId':_0x2367bf,'oldStatus':_0x23e9ab,'newStatus':_0x3d6cf0,'source':_0x2c44e3,'timestamp':new Date()['toISOString'](),'details':_0x148f2c||{}};loggerService_1[_0x23649c(0x181)][_0x23649c(0xbc)](_0x2b60a3),console[_0x23649c(0xa5)](_0x23649c(0xe9)+_0x2e72b3+'\x20('+_0x2367bf+')'),console[_0x23649c(0xa5)](_0x23649c(0x190)+_0x23e9ab+_0x23649c(0x179)+_0x3d6cf0),console[_0x23649c(0xa5)](_0x23649c(0x182)+_0x2c44e3),console[_0x23649c(0xa5)](_0x23649c(0x103)+_0x2b60a3[_0x23649c(0xbf)]),_0x148f2c&&console['log'](_0x23649c(0xee),_0x148f2c);}[a37_0x5570b4(0x16e)](_0xf21847,_0x3f1e3a,_0x47ffc4,_0x473708,_0xa0f9b7){const _0x5d027e=a37_0x5570b4,_0x963080={'type':_0x5d027e(0x188),'paymentId':_0xf21847,'gatewayPaymentId':_0x3f1e3a,'error':_0x47ffc4 instanceof Error?{'message':_0x47ffc4[_0x5d027e(0x15d)],'stack':_0x47ffc4['stack']}:_0x47ffc4,'source':_0x473708,'timestamp':new Date()[_0x5d027e(0x14f)](),'context':_0xa0f9b7||{}};loggerService_1[_0x5d027e(0x181)][_0x5d027e(0x16e)](_0x963080),console[_0x5d027e(0xbb)]('ü™ô\x20[ERROR]\x20CoinToPay\x20Error:\x20'+_0xf21847+'\x20('+_0x3f1e3a+')'),console[_0x5d027e(0xbb)](_0x5d027e(0x14c)+(_0x47ffc4 instanceof Error?_0x47ffc4['message']:_0x47ffc4)),console['error'](_0x5d027e(0x182)+_0x473708),console[_0x5d027e(0xbb)](_0x5d027e(0x103)+_0x963080[_0x5d027e(0xbf)]),_0xa0f9b7&&console[_0x5d027e(0xbb)](_0x5d027e(0x169),_0xa0f9b7);}[a37_0x5570b4(0xd1)](){const _0xe063e3=a37_0x5570b4;console[_0xe063e3(0xa5)](_0xe063e3(0x132)),this['checkAllPendingPayments']()['catch'](_0x5dbc34=>{const _0x1f52e3=_0xe063e3;console[_0x1f52e3(0xbb)](_0x1f52e3(0x116),_0x5dbc34);}),this[_0xe063e3(0xa9)]=setInterval(async()=>{const _0x1a1618=_0xe063e3;try{console[_0x1a1618(0xa5)](_0x1a1618(0xf4)),await this['checkAllPendingPayments'](),console[_0x1a1618(0xa5)]('‚úÖ\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed');}catch(_0x42d1e1){console[_0x1a1618(0xbb)]('‚ùå\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:',_0x42d1e1);}},this[_0xe063e3(0x197)]),console[_0xe063e3(0xa5)](_0xe063e3(0xff));}[a37_0x5570b4(0x17a)](){const _0x6cbd83=a37_0x5570b4;console[_0x6cbd83(0xa5)]('üõë\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...');this[_0x6cbd83(0xa9)]&&(clearInterval(this[_0x6cbd83(0xa9)]),this[_0x6cbd83(0xa9)]=null,console['log'](_0x6cbd83(0x111)));const _0x143f53=this['paymentTimers'][_0x6cbd83(0x133)];for(const [_0x4f8da9]of this[_0x6cbd83(0xd8)]){this[_0x6cbd83(0x14a)](_0x4f8da9);}console[_0x6cbd83(0xa5)](_0x6cbd83(0xfd)+_0x143f53+_0x6cbd83(0xb0));}async[a37_0x5570b4(0x108)](){const _0x5bcb47=a37_0x5570b4;try{console[_0x5bcb47(0xa5)](_0x5bcb47(0x18c));const _0xf16361=await database_1['default'][_0x5bcb47(0x118)][_0x5bcb47(0xe5)]({'where':{'gateway':{'in':[_0x5bcb47(0x17b),'cointopay2']},'status':_0x5bcb47(0xf0),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x5bcb47(0xa5)](_0x5bcb47(0x144)+_0xf16361[_0x5bcb47(0xfb)]+_0x5bcb47(0x16c));if(_0xf16361[_0x5bcb47(0xfb)]===0x0){console['log'](_0x5bcb47(0x16a));return;}const _0x56313d=await this[_0x5bcb47(0x12c)](_0xf16361);console[_0x5bcb47(0xa5)](_0x5bcb47(0x104)+_0x56313d['length']+_0x5bcb47(0x10d));let _0x270bc1=0x0,_0x4643eb=0x0;for(const _0x3abc35 of _0xf16361){try{if(_0x56313d[_0x5bcb47(0xa3)](_0x3abc35['id'])){console[_0x5bcb47(0xa5)](_0x5bcb47(0x191)+_0x3abc35['id']+_0x5bcb47(0x18a)),_0x4643eb++;continue;}if(this[_0x5bcb47(0xd8)][_0x5bcb47(0xab)](_0x3abc35['id'])){console[_0x5bcb47(0xa5)](_0x5bcb47(0x191)+_0x3abc35['id']+_0x5bcb47(0x18b)),_0x4643eb++;continue;}const _0x1acf92=(Date['now']()-_0x3abc35[_0x5bcb47(0xcd)][_0x5bcb47(0x147)]())/(0x3e8*0x3c*0x3c);if(_0x1acf92<0x1){console['log'](_0x5bcb47(0x191)+_0x3abc35['id']+_0x5bcb47(0x137)+_0x1acf92['toFixed'](0x1)+_0x5bcb47(0xd3)),_0x4643eb++;continue;}console['log'](_0x5bcb47(0x10c)+_0x3abc35['id']+_0x5bcb47(0x127)+_0x1acf92[_0x5bcb47(0x10b)](0x1)+'h)'),await this[_0x5bcb47(0xb2)](_0x3abc35),_0x270bc1++,await new Promise(_0x3a035d=>setTimeout(_0x3a035d,0x7d0));}catch(_0xb106f6){console[_0x5bcb47(0xbb)](_0x5bcb47(0x142)+_0x3abc35['id']+':',_0xb106f6),this[_0x5bcb47(0x16e)](_0x3abc35['id'],_0x3abc35['gatewayPaymentId']||_0x5bcb47(0x106),_0xb106f6,_0x5bcb47(0x13a),{'isGlobalCheck':!![],'paymentAmount':_0x3abc35[_0x5bcb47(0xe0)],'paymentCurrency':_0x3abc35[_0x5bcb47(0xac)],'shopId':_0x3abc35[_0x5bcb47(0x11b)],'createdAt':_0x3abc35[_0x5bcb47(0xcd)]}),loggerService_1[_0x5bcb47(0x181)][_0x5bcb47(0xd4)](_0x5bcb47(0x17b),_0x5bcb47(0x12e)+_0x3abc35['gatewayPaymentId'],_0xb106f6);}}console['log'](_0x5bcb47(0xcb)+_0x270bc1+_0x5bcb47(0xdc)+_0x4643eb+'\x20skipped,\x20'+_0x56313d[_0x5bcb47(0xfb)]+_0x5bcb47(0x155));}catch(_0x4fd21d){console[_0x5bcb47(0xbb)](_0x5bcb47(0xaa),_0x4fd21d);}}async['checkExpiredPayments'](_0x3a9190){const _0x2c097e=a37_0x5570b4,_0x2b19a5=[],_0x36cf52=new Date();_0x36cf52[_0x2c097e(0x168)](_0x36cf52['getDate']()-this[_0x2c097e(0xe4)]),console['log'](_0x2c097e(0xdb)+this[_0x2c097e(0xe4)]+_0x2c097e(0xc9)+_0x36cf52['toISOString']()+')');for(const _0x322a53 of _0x3a9190){if(_0x322a53[_0x2c097e(0xcd)]<_0x36cf52){console['log'](_0x2c097e(0x139)+_0x322a53['id']+_0x2c097e(0xba)+this[_0x2c097e(0xe4)]+_0x2c097e(0x125));try{this[_0x2c097e(0xbc)](_0x322a53['id'],_0x322a53[_0x2c097e(0xb6)]||_0x2c097e(0x106),_0x2c097e(0xf0),_0x2c097e(0x186),_0x2c097e(0xd9),{'reason':_0x2c097e(0x122)+this[_0x2c097e(0xe4)]+_0x2c097e(0x18d),'createdAt':_0x322a53[_0x2c097e(0xcd)],'daysSinceCreation':Math['floor']((Date[_0x2c097e(0x158)]()-_0x322a53[_0x2c097e(0xcd)]['getTime']())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x322a53[_0x2c097e(0xe0)],'paymentCurrency':_0x322a53['currency'],'shopId':_0x322a53[_0x2c097e(0x11b)]}),await database_1[_0x2c097e(0x156)]['payment'][_0x2c097e(0xcc)]({'where':{'id':_0x322a53['id']},'data':{'status':_0x2c097e(0x186),'updatedAt':new Date(),'adminNotes':_0x2c097e(0x178)+this[_0x2c097e(0xe4)]+_0x2c097e(0x12a)}}),await database_1['default'][_0x2c097e(0x15b)][_0x2c097e(0xf7)]({'data':{'paymentId':_0x322a53['id'],'shopId':_0x322a53[_0x2c097e(0x11b)],'event':_0x2c097e(0x187),'statusCode':0xc8,'responseBody':JSON[_0x2c097e(0x138)]({'reason':_0x2c097e(0x122)+this[_0x2c097e(0xe4)]+_0x2c097e(0x18d),'createdAt':_0x322a53[_0x2c097e(0xcd)],'expiredAt':new Date()[_0x2c097e(0x14f)](),'daysSinceCreation':Math[_0x2c097e(0x194)]((Date[_0x2c097e(0x158)]()-_0x322a53[_0x2c097e(0xcd)][_0x2c097e(0x147)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x2c097e(0xca)](_0x322a53,_0x2c097e(0x186)),await this[_0x2c097e(0xc2)](_0x322a53,_0x2c097e(0x186)),this[_0x2c097e(0x14a)](_0x322a53['id']),_0x2b19a5['push'](_0x322a53['id']),console[_0x2c097e(0xa5)](_0x2c097e(0xa8)+_0x322a53['id']+_0x2c097e(0x151)+this[_0x2c097e(0xe4)]+_0x2c097e(0x174));}catch(_0x4055ce){console[_0x2c097e(0xbb)](_0x2c097e(0xb9)+_0x322a53['id']+':',_0x4055ce),this[_0x2c097e(0x16e)](_0x322a53['id'],_0x322a53[_0x2c097e(0xb6)]||_0x2c097e(0x106),_0x4055ce,_0x2c097e(0xd9),{'reason':_0x2c097e(0x183),'createdAt':_0x322a53[_0x2c097e(0xcd)],'daysSinceCreation':Math[_0x2c097e(0x194)]((Date[_0x2c097e(0x158)]()-_0x322a53[_0x2c097e(0xcd)][_0x2c097e(0x147)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x2b19a5;}async[a37_0x5570b4(0xb2)](_0xcd5298){const _0x2c25da=a37_0x5570b4;if(!_0xcd5298[_0x2c25da(0xb6)]){console[_0x2c25da(0xa5)](_0x2c25da(0x140)+_0xcd5298['id']+_0x2c25da(0x110));return;}console['log'](_0x2c25da(0xd6)+_0xcd5298[_0x2c25da(0x17f)]+_0x2c25da(0x17e)+_0xcd5298['id']+'\x20('+_0xcd5298[_0x2c25da(0xb6)]+')');try{let _0x38df95;_0xcd5298['gateway']===_0x2c25da(0x120)?(_0x38df95=await this['coinToPay2Service'][_0x2c25da(0x119)](_0xcd5298['gatewayPaymentId']),console['log'](_0x2c25da(0xdf)+_0xcd5298['id']+_0x2c25da(0x189)+_0x38df95[_0x2c25da(0x13e)])):(_0x38df95=await this[_0x2c25da(0x15c)][_0x2c25da(0x119)](_0xcd5298[_0x2c25da(0xb6)]),console['log']('üìä\x20[CHECK]\x20CoinToPay\x20payment\x20'+_0xcd5298['id']+_0x2c25da(0x189)+_0x38df95[_0x2c25da(0x13e)]));_0x38df95['paymentDetails']&&console['log'](_0x2c25da(0xdd)+_0xcd5298['id']+_0x2c25da(0x150),{'iban':_0x38df95[_0x2c25da(0xf3)]['iban']||_0x2c25da(0x102),'transactionId':_0x38df95['paymentDetails'][_0x2c25da(0x117)],'createdOn':_0x38df95['paymentDetails'][_0x2c25da(0x165)],'confirmedOn':_0x38df95['paymentDetails'][_0x2c25da(0x124)]||_0x2c25da(0xef)});if(_0x38df95[_0x2c25da(0x13e)]!==_0xcd5298[_0x2c25da(0x13e)]){console[_0x2c25da(0xa5)](_0x2c25da(0x128)+_0xcd5298['id']+_0x2c25da(0x114)+_0xcd5298[_0x2c25da(0x13e)]+'\x20to\x20'+_0x38df95[_0x2c25da(0x13e)]),this['logCoinToPayStatus'](_0xcd5298['id'],_0xcd5298[_0x2c25da(0xb6)],_0xcd5298[_0x2c25da(0x13e)],_0x38df95['status'],_0x2c25da(0x13a),{'paymentDetails':_0x38df95[_0x2c25da(0xf3)],'amount':_0x38df95[_0x2c25da(0xe0)],'currency':_0x38df95[_0x2c25da(0xac)],'shopId':_0xcd5298['shopId'],'checkTimestamp':new Date()[_0x2c25da(0x14f)]()});const _0x191cc7={'status':_0x38df95[_0x2c25da(0x13e)],'updatedAt':new Date()};_0x38df95[_0x2c25da(0x13e)]===_0x2c25da(0x18e)&&_0xcd5298['status']!=='PAID'&&(_0x191cc7['paidAt']=new Date(),console[_0x2c25da(0xa5)](_0x2c25da(0x135)+_0xcd5298['id']+_0x2c25da(0x170)+_0x191cc7[_0x2c25da(0xf5)]['toISOString']()));if(_0x38df95['paymentDetails']){const _0x4da5a5=_0x38df95[_0x2c25da(0xf3)];_0x4da5a5[_0x2c25da(0xec)]&&(_0x191cc7['remitterIban']=_0x4da5a5['iban'],console[_0x2c25da(0xa5)](_0x2c25da(0xf6)+_0x4da5a5[_0x2c25da(0xec)]));if(_0x4da5a5[_0x2c25da(0xc4)]){const _0x400ccb=_0xcd5298['adminNotes']||'',_0x21ce9d=_0x2c25da(0x16b)+_0x4da5a5[_0x2c25da(0xc4)];_0x191cc7[_0x2c25da(0x176)]=_0x400ccb?_0x400ccb+'\x0a\x0a'+_0x21ce9d:_0x21ce9d,console[_0x2c25da(0xa5)](_0x2c25da(0xaf));}_0x4da5a5[_0x2c25da(0x117)]&&console['log'](_0x2c25da(0x121)+_0x4da5a5[_0x2c25da(0x117)]),_0x4da5a5['confirmedOn']&&console[_0x2c25da(0xa5)](_0x2c25da(0x148)+_0x4da5a5[_0x2c25da(0x124)]);}await database_1[_0x2c25da(0x156)]['payment']['update']({'where':{'id':_0xcd5298['id']},'data':_0x191cc7}),await database_1[_0x2c25da(0x156)][_0x2c25da(0x15b)][_0x2c25da(0xf7)]({'data':{'paymentId':_0xcd5298['id'],'shopId':_0xcd5298[_0x2c25da(0x11b)],'event':_0x2c25da(0xe2)+_0x38df95['status']['toLowerCase'](),'statusCode':0xc8,'responseBody':JSON[_0x2c25da(0x138)]({'oldStatus':_0xcd5298['status'],'newStatus':_0x38df95['status'],'paymentDetails':_0x38df95[_0x2c25da(0xf3)],'checkedAt':new Date()[_0x2c25da(0x14f)]()})}}),await this[_0x2c25da(0xca)](_0xcd5298,_0x38df95[_0x2c25da(0x13e)]),await this['sendPaymentStatusNotification'](_0xcd5298,_0x38df95[_0x2c25da(0x13e)]),_0x38df95[_0x2c25da(0x13e)]!==_0x2c25da(0xf0)&&(console[_0x2c25da(0xa5)](_0x2c25da(0x14b)+_0xcd5298['id']+'\x20status\x20changed\x20to\x20'+_0x38df95[_0x2c25da(0x13e)]+_0x2c25da(0x157)),this[_0x2c25da(0x14a)](_0xcd5298['id'])),console[_0x2c25da(0xa5)](_0x2c25da(0xfc)+_0xcd5298['id']+_0x2c25da(0x109));}else console['log'](_0x2c25da(0xdd)+_0xcd5298['id']+_0x2c25da(0x180)+_0x38df95['status']+')'),this[_0x2c25da(0xbc)](_0xcd5298['id'],_0xcd5298[_0x2c25da(0xb6)],_0xcd5298[_0x2c25da(0x13e)],_0x38df95[_0x2c25da(0x13e)],'status_check',{'statusUnchanged':!![],'paymentDetails':_0x38df95[_0x2c25da(0xf3)],'amount':_0x38df95[_0x2c25da(0xe0)],'currency':_0x38df95[_0x2c25da(0xac)],'shopId':_0xcd5298[_0x2c25da(0x11b)],'checkTimestamp':new Date()[_0x2c25da(0x14f)]()});}catch(_0x66aa11){console[_0x2c25da(0xbb)](_0x2c25da(0x100)+_0xcd5298['id']+':',_0x66aa11),this[_0x2c25da(0x16e)](_0xcd5298['id'],_0xcd5298[_0x2c25da(0xb6)],_0x66aa11,'status_check',{'paymentAmount':_0xcd5298[_0x2c25da(0xe0)],'paymentCurrency':_0xcd5298['currency'],'shopId':_0xcd5298[_0x2c25da(0x11b)],'createdAt':_0xcd5298['createdAt']}),await database_1['default'][_0x2c25da(0x15b)]['create']({'data':{'paymentId':_0xcd5298['id'],'shopId':_0xcd5298[_0x2c25da(0x11b)],'event':_0x2c25da(0xad),'statusCode':0x1f4,'responseBody':JSON[_0x2c25da(0x138)]({'error':_0x66aa11 instanceof Error?_0x66aa11[_0x2c25da(0x15d)]:_0x2c25da(0xed),'gatewayPaymentId':_0xcd5298[_0x2c25da(0xb6)],'checkedAt':new Date()[_0x2c25da(0x14f)]()})}});}}async[a37_0x5570b4(0xca)](_0x105c22,_0x592b9e){const _0x23cbaf=a37_0x5570b4,_0x302636=Date['now']();try{const _0x5b6db1=_0x105c22[_0x23cbaf(0xae)],_0x1c8d01=_0x5b6db1[_0x23cbaf(0xda)];if(!_0x1c8d01?.[_0x23cbaf(0x134)]){console[_0x23cbaf(0xa5)](_0x23cbaf(0xb7)+_0x5b6db1['id']);return;}const _0x16074a=_0x592b9e===_0x23cbaf(0x18e)?_0x23cbaf(0x171):_0x592b9e===_0x23cbaf(0xbd)?'payment.failed':_0x592b9e===_0x23cbaf(0x186)?_0x23cbaf(0xeb):'payment.pending';if(!_0x1c8d01[_0x23cbaf(0x163)]?.['includes'](_0x16074a)){console[_0x23cbaf(0xa5)](_0x23cbaf(0xf9)+_0x16074a+_0x23cbaf(0xce)+_0x5b6db1['id']);return;}const _0x85367=(0x0,gateway_1[_0x23cbaf(0xfa)])(_0x105c22[_0x23cbaf(0x17f)])||_0x105c22[_0x23cbaf(0x17f)],_0x3f17f2={'event':_0x16074a,'payment':{'id':_0x105c22['id'],'order_id':_0x105c22[_0x23cbaf(0xe3)],'gateway_order_id':_0x105c22[_0x23cbaf(0x193)],'gateway':_0x85367,'amount':_0x105c22['amount'],'currency':_0x105c22[_0x23cbaf(0xac)],'status':_0x592b9e['toLowerCase'](),'customer_email':_0x105c22['customerEmail'],'customer_name':_0x105c22[_0x23cbaf(0xd0)],'created_at':_0x105c22[_0x23cbaf(0xcd)],'updated_at':new Date()}},_0x6fc1f=await fetch(_0x1c8d01['webhookUrl'],{'method':_0x23cbaf(0x18f),'headers':{'Content-Type':_0x23cbaf(0x167),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x23cbaf(0x138)](_0x3f17f2)}),_0x45c97e=Date[_0x23cbaf(0x158)]()-_0x302636,_0x4a2dc5=_0x6fc1f['ok']?'Success':await _0x6fc1f[_0x23cbaf(0x11c)]();loggerService_1[_0x23cbaf(0x181)][_0x23cbaf(0xb5)](_0x105c22[_0x23cbaf(0x11b)],_0x1c8d01[_0x23cbaf(0x134)],_0x16074a,_0x6fc1f[_0x23cbaf(0x13e)],_0x45c97e,_0x3f17f2),console[_0x23cbaf(0xa5)](_0x23cbaf(0x13f)+_0x1c8d01['webhookUrl']+_0x23cbaf(0x149)+_0x6fc1f[_0x23cbaf(0x13e)]+'\x20('+_0x45c97e+_0x23cbaf(0x146));}catch(_0x4122d5){console[_0x23cbaf(0xbb)]('Failed\x20to\x20send\x20shop\x20webhook:',_0x4122d5),loggerService_1[_0x23cbaf(0x181)][_0x23cbaf(0x175)](_0x105c22[_0x23cbaf(0x11b)],_0x105c22[_0x23cbaf(0xae)]?.[_0x23cbaf(0xda)]?.[_0x23cbaf(0x134)]||_0x23cbaf(0x106),'webhook_send',_0x4122d5,{});}}async['sendPaymentStatusNotification'](_0x521fb4,_0x1172ad){const _0x4fbf34=a37_0x5570b4;try{const _0x4db53d={'PENDING':_0x4fbf34(0xc1),'PAID':_0x4fbf34(0x159),'FAILED':_0x4fbf34(0x161),'EXPIRED':_0x4fbf34(0xb8)},_0x4ee08a=_0x4db53d[_0x1172ad];if(!_0x4ee08a||_0x4ee08a===_0x4fbf34(0xc1))return;await telegramBotService_1['telegramBotService'][_0x4fbf34(0x12b)](_0x521fb4['shopId'],_0x521fb4,_0x4ee08a);}catch(_0x878a77){console[_0x4fbf34(0xbb)](_0x4fbf34(0x145),_0x878a77);}}async[a37_0x5570b4(0x177)](_0x4c73eb){const _0x77132b=a37_0x5570b4;console[_0x77132b(0xa5)](_0x77132b(0x130)+_0x4c73eb);const _0x3e7cbc=await database_1[_0x77132b(0x156)]['payment'][_0x77132b(0x173)]({'where':{'id':_0x4c73eb},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x3e7cbc)throw new Error('Payment\x20not\x20found');if(_0x3e7cbc['gateway']!=='cointopay'&&_0x3e7cbc[_0x77132b(0x17f)]!==_0x77132b(0x120))throw new Error('Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment');console['log']('‚úÖ\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20'+_0x3e7cbc[_0x77132b(0x17f)]+_0x77132b(0x17e)+_0x4c73eb),await this['checkSinglePayment'](_0x3e7cbc),console[_0x77132b(0xa5)](_0x77132b(0x136)+_0x4c73eb);}['getServiceStats'](){const _0x399230=a37_0x5570b4,_0x38f753=this['globalCheckInterval']?this[_0x399230(0x197)]:undefined,_0x1edb25=Array[_0x399230(0xe1)](this[_0x399230(0xd8)][_0x399230(0x195)]())[_0x399230(0xe8)](_0x158686=>({'paymentId':_0x158686[_0x399230(0x160)],'gatewayPaymentId':_0x158686[_0x399230(0xb6)],'createdAt':_0x158686[_0x399230(0xcd)],'timersCount':_0x158686[_0x399230(0xc3)]['length']}));return{'isActive':!!this[_0x399230(0xa9)],'globalCheckIntervalMinutes':this[_0x399230(0x197)]/(0x3e8*0x3c),'expiryDays':this[_0x399230(0xe4)],'activeIndividualTimers':this['paymentTimers'][_0x399230(0x133)],'nextGlobalCheckIn':_0x38f753,'paymentTimersDetails':_0x1edb25};}[a37_0x5570b4(0x13c)](_0xddabe0){const _0x399d7f=a37_0x5570b4,_0x3cebc0=this[_0x399d7f(0xd8)][_0x399d7f(0x143)](_0xddabe0);if(_0x3cebc0)return{'hasTimers':!![],'timersCount':_0x3cebc0[_0x399d7f(0xc3)]['length'],'createdAt':_0x3cebc0[_0x399d7f(0xcd)],'gatewayPaymentId':_0x3cebc0[_0x399d7f(0xb6)]};return{'hasTimers':![]};}}exports['CoinToPayStatusService']=CoinToPayStatusService,exports[a37_0x5570b4(0xe7)]=new CoinToPayStatusService();