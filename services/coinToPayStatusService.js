'use strict';const a38_0x5ef9ab=a38_0xcf49;(function(_0xaeb5ba,_0x1ecc2c){const _0x2b80d8=a38_0xcf49,_0x3a926b=_0xaeb5ba();while(!![]){try{const _0x3e43d2=-parseInt(_0x2b80d8(0x160))/0x1*(-parseInt(_0x2b80d8(0x191))/0x2)+parseInt(_0x2b80d8(0x14a))/0x3*(parseInt(_0x2b80d8(0xff))/0x4)+parseInt(_0x2b80d8(0x19d))/0x5+-parseInt(_0x2b80d8(0x190))/0x6+parseInt(_0x2b80d8(0x176))/0x7*(parseInt(_0x2b80d8(0x1b9))/0x8)+-parseInt(_0x2b80d8(0x1db))/0x9+parseInt(_0x2b80d8(0x1a5))/0xa*(parseInt(_0x2b80d8(0x1d5))/0xb);if(_0x3e43d2===_0x1ecc2c)break;else _0x3a926b['push'](_0x3a926b['shift']());}catch(_0x21537e){_0x3a926b['push'](_0x3a926b['shift']());}}}(a38_0xf7a2,0xeadc1));var __importDefault=this&&this[a38_0x5ef9ab(0x18b)]||function(_0x6c840d){const _0x53e4f3=a38_0x5ef9ab;return _0x6c840d&&_0x6c840d[_0x53e4f3(0x12b)]?_0x6c840d:{'default':_0x6c840d};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['coinToPayStatusService']=exports['CoinToPayStatusService']=void 0x0;const coinToPayService_1=require(a38_0x5ef9ab(0x1d9)),coinToPay2Service_1=require(a38_0x5ef9ab(0x1ca)),gateway_1=require(a38_0x5ef9ab(0x14b)),database_1=__importDefault(require(a38_0x5ef9ab(0xfa))),telegramBotService_1=require(a38_0x5ef9ab(0x185)),loggerService_1=require(a38_0x5ef9ab(0x1de)),currencyService_1=require(a38_0x5ef9ab(0x1dc));class CoinToPayStatusService{constructor(){const _0x20be1d=a38_0x5ef9ab;this[_0x20be1d(0x1e1)]=null,this['GLOBAL_CHECK_INTERVAL_MS']=0x3c*0x3c*0x3e8,this['EXPIRY_DAYS']=0x5,this[_0x20be1d(0x1e4)]=new Map(),this['coinToPayService']=new coinToPayService_1[(_0x20be1d(0x1b7))](),this[_0x20be1d(0x120)]=new coinToPay2Service_1[(_0x20be1d(0x1bf))](),console[_0x20be1d(0x13f)](_0x20be1d(0x13b));}['schedulePaymentChecks'](_0x55a38a,_0x5ad474){const _0x1d4868=a38_0x5ef9ab;console[_0x1d4868(0x13f)](_0x1d4868(0x11b)),console[_0x1d4868(0x13f)](_0x1d4868(0xf1)+_0x55a38a),console[_0x1d4868(0x13f)](_0x1d4868(0x163)+_0x5ad474),this['clearPaymentTimers'](_0x55a38a);const _0x3d66b6=[],_0x59b721=new Date(),_0x490a90=[{'delay':0x1*0x3c*0x3e8,'description':_0x1d4868(0xf0)},{'delay':0x2*0x3c*0x3e8,'description':_0x1d4868(0x171)},{'delay':0x5*0x3c*0x3e8,'description':_0x1d4868(0x148)},{'delay':0x5*0x3c*0x3e8,'description':_0x1d4868(0x148)}];console[_0x1d4868(0x13f)]('🪙\x20[DEBUG]\x20Creating\x20'+_0x490a90[_0x1d4868(0x18a)]+_0x1d4868(0xfc)+_0x55a38a);let _0x32af77=0x0;_0x490a90[_0x1d4868(0x127)]((_0x3c7f1d,_0x142b03)=>{const _0x1ffe59=_0x1d4868;_0x32af77+=_0x3c7f1d[_0x1ffe59(0x16a)];const _0x14f8e7=setTimeout(async()=>{const _0x109a8a=_0x1ffe59;console['log'](_0x109a8a(0x14e)+(_0x142b03+0x1)+_0x109a8a(0x121)+_0x55a38a+_0x109a8a(0xf4)+_0x3c7f1d['description']+')');try{await this[_0x109a8a(0x149)](_0x55a38a),console['log']('✅\x20[TIMER]\x20Individual\x20check\x20#'+(_0x142b03+0x1)+_0x109a8a(0x169)+_0x55a38a);}catch(_0x96fc00){console[_0x109a8a(0x153)](_0x109a8a(0x157)+(_0x142b03+0x1)+_0x109a8a(0x15c)+_0x55a38a+':',_0x96fc00),this[_0x109a8a(0x133)](_0x55a38a,_0x5ad474,_0x96fc00,'status_check',{'checkNumber':_0x142b03+0x1,'scheduledAfter':_0x3c7f1d[_0x109a8a(0x17b)],'isIndividualCheck':!![]});}},_0x32af77);_0x3d66b6[_0x1ffe59(0x1c5)](_0x14f8e7),console[_0x1ffe59(0x13f)](_0x1ffe59(0x131)+(_0x142b03+0x1)+_0x1ffe59(0x15c)+_0x55a38a+'\x20in\x20'+_0x32af77/0x3e8+_0x1ffe59(0x1b0)+_0x3c7f1d[_0x1ffe59(0x17b)]+')');});const _0x5b4620=setInterval(async()=>{const _0x5736d5=_0x1d4868;console['log']('🪙\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20'+_0x55a38a);try{const _0x13c692=await database_1[_0x5736d5(0x13c)][_0x5736d5(0x15a)][_0x5736d5(0x10b)]({'where':{'id':_0x55a38a},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x13c692){console['log']('❌\x20[HOURLY]\x20Payment\x20'+_0x55a38a+_0x5736d5(0x199)),this[_0x5736d5(0x129)](_0x55a38a);return;}console[_0x5736d5(0x13f)]('📊\x20[HOURLY]\x20Payment\x20'+_0x55a38a+'\x20current\x20status:\x20'+_0x13c692['status']);if(_0x13c692[_0x5736d5(0x1e5)]!==_0x5736d5(0x1a0)){console[_0x5736d5(0x13f)](_0x5736d5(0x1a3)+_0x55a38a+'\x20status\x20is\x20'+_0x13c692[_0x5736d5(0x1e5)]+_0x5736d5(0x1e3)),this[_0x5736d5(0x129)](_0x55a38a);return;}const _0x1c5469=Math['floor']((Date['now']()-_0x13c692[_0x5736d5(0x179)][_0x5736d5(0x1d6)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x1c5469>=this[_0x5736d5(0xdd)]){console[_0x5736d5(0x13f)](_0x5736d5(0x181)+_0x55a38a+_0x5736d5(0x1b4)+this[_0x5736d5(0xdd)]+_0x5736d5(0xd9)),this[_0x5736d5(0x129)](_0x55a38a);return;}await this[_0x5736d5(0x149)](_0x55a38a),console[_0x5736d5(0x13f)](_0x5736d5(0x1d2)+_0x55a38a);}catch(_0x53daa2){console[_0x5736d5(0x153)]('❌\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20'+_0x55a38a+':',_0x53daa2),this[_0x5736d5(0x133)](_0x55a38a,_0x5ad474,_0x53daa2,_0x5736d5(0xea),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x3d66b6[_0x1d4868(0x1c5)](_0x5b4620),this[_0x1d4868(0x1e4)][_0x1d4868(0x1ba)](_0x55a38a,{'timers':_0x3d66b6,'paymentId':_0x55a38a,'gatewayPaymentId':_0x5ad474,'createdAt':_0x59b721}),console[_0x1d4868(0x13f)]('✅\x20[DEBUG]\x20Successfully\x20scheduled\x20'+_0x490a90[_0x1d4868(0x18a)]+_0x1d4868(0xdf)+_0x55a38a),console[_0x1d4868(0x13f)]('📊\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20'+this[_0x1d4868(0x1e4)][_0x1d4868(0x11d)]),this['logCoinToPayStatus'](_0x55a38a,_0x5ad474,_0x1d4868(0x1a0),_0x1d4868(0x1a0),_0x1d4868(0xea),{'action':_0x1d4868(0xe9),'scheduledChecks':_0x490a90[_0x1d4868(0x18a)],'firstCheckIn':_0x490a90[0x0][_0x1d4868(0x16a)]/0x3e8,'totalTimers':this[_0x1d4868(0x1e4)][_0x1d4868(0x11d)]});}[a38_0x5ef9ab(0x129)](_0x3a431b){const _0x2ec968=a38_0x5ef9ab,_0x184616=this[_0x2ec968(0x1e4)]['get'](_0x3a431b);_0x184616?(console['log'](_0x2ec968(0xe1)+_0x184616[_0x2ec968(0x17e)]['length']+'\x20timers\x20for\x20payment\x20'+_0x3a431b),_0x184616[_0x2ec968(0x17e)]['forEach']((_0x3202f4,_0x93848d)=>{const _0x58a4ea=_0x2ec968;_0x3202f4&&(clearTimeout(_0x3202f4),clearInterval(_0x3202f4),console[_0x58a4ea(0x13f)](_0x58a4ea(0x150)+(_0x93848d+0x1)+_0x58a4ea(0x15c)+_0x3a431b));}),this[_0x2ec968(0x1e4)][_0x2ec968(0x12d)](_0x3a431b),console[_0x2ec968(0x13f)]('✅\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20'+_0x3a431b+_0x2ec968(0x1c3)+this[_0x2ec968(0x1e4)][_0x2ec968(0x11d)])):console[_0x2ec968(0x13f)]('⚠️\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20'+_0x3a431b+_0x2ec968(0x1ab));}async[a38_0x5ef9ab(0x149)](_0x5e0c8c){const _0x1cbb49=a38_0x5ef9ab;console[_0x1cbb49(0x13f)]('🔍\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20'+_0x5e0c8c);const _0x5e65df=await database_1[_0x1cbb49(0x13c)][_0x1cbb49(0x15a)]['findUnique']({'where':{'id':_0x5e0c8c},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x5e65df){console[_0x1cbb49(0x13f)]('❌\x20[CHECK]\x20Payment\x20'+_0x5e0c8c+_0x1cbb49(0x16c));return;}console[_0x1cbb49(0x13f)](_0x1cbb49(0x1be)+_0x5e0c8c+'\x20found:'),console[_0x1cbb49(0x13f)](_0x1cbb49(0x170)+_0x5e65df[_0x1cbb49(0x10a)]),console[_0x1cbb49(0x13f)](_0x1cbb49(0x1c6)+_0x5e65df[_0x1cbb49(0x1e5)]),console[_0x1cbb49(0x13f)]('\x20\x20\x20-\x20GatewayPaymentId:\x20'+_0x5e65df[_0x1cbb49(0x147)]),console[_0x1cbb49(0x13f)]('\x20\x20\x20-\x20Amount:\x20'+_0x5e65df[_0x1cbb49(0x109)]+'\x20'+_0x5e65df[_0x1cbb49(0x197)]),console[_0x1cbb49(0x13f)](_0x1cbb49(0x19a)+_0x5e65df[_0x1cbb49(0x111)]);if(_0x5e65df[_0x1cbb49(0x10a)]!==_0x1cbb49(0xfe)&&_0x5e65df['gateway']!==_0x1cbb49(0x1e0)){console[_0x1cbb49(0x13f)](_0x1cbb49(0x14d)+_0x5e0c8c+'\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20'+_0x5e65df['gateway']+')');return;}if(_0x5e65df[_0x1cbb49(0x1e5)]!==_0x1cbb49(0x1a0)){console[_0x1cbb49(0x13f)](_0x1cbb49(0x14d)+_0x5e0c8c+_0x1cbb49(0x138)+_0x5e65df[_0x1cbb49(0x1e5)]+_0x1cbb49(0x1e3)),this[_0x1cbb49(0x129)](_0x5e0c8c);return;}if(!_0x5e65df['gatewayPaymentId']){console['log']('⚠️\x20[CHECK]\x20Payment\x20'+_0x5e0c8c+_0x1cbb49(0x174));return;}console[_0x1cbb49(0x13f)](_0x1cbb49(0x1dd)+_0x5e0c8c+_0x1cbb49(0x1b6)),await this[_0x1cbb49(0x104)](_0x5e65df);}['logCoinToPayStatus'](_0xc6d604,_0x20cd1c,_0x39a9ea,_0x197a9f,_0x5638e3,_0x1f05c9){const _0xa6adec=a38_0x5ef9ab,_0x39c865={'type':_0xa6adec(0x18d),'paymentId':_0xc6d604,'gatewayPaymentId':_0x20cd1c,'oldStatus':_0x39a9ea,'newStatus':_0x197a9f,'source':_0x5638e3,'timestamp':new Date()[_0xa6adec(0x16e)](),'details':_0x1f05c9||{}};loggerService_1['loggerService'][_0xa6adec(0x1c7)](_0x39c865),console[_0xa6adec(0x13f)](_0xa6adec(0x1b1)+_0xc6d604+'\x20('+_0x20cd1c+')'),console[_0xa6adec(0x13f)](_0xa6adec(0x144)+_0x39a9ea+_0xa6adec(0x16d)+_0x197a9f),console[_0xa6adec(0x13f)](_0xa6adec(0x1d7)+_0x5638e3),console['log'](_0xa6adec(0x164)+_0x39c865[_0xa6adec(0x1c8)]),_0x1f05c9&&console[_0xa6adec(0x13f)](_0xa6adec(0xf3),_0x1f05c9);}['logCoinToPayError'](_0x327c29,_0x20f07e,_0x4fcc2e,_0x31b241,_0x42f1e3){const _0x30a27c=a38_0x5ef9ab,_0x4f1fe4={'type':_0x30a27c(0x183),'paymentId':_0x327c29,'gatewayPaymentId':_0x20f07e,'error':_0x4fcc2e instanceof Error?{'message':_0x4fcc2e[_0x30a27c(0x1cd)],'stack':_0x4fcc2e[_0x30a27c(0xf5)]}:_0x4fcc2e,'source':_0x31b241,'timestamp':new Date()['toISOString'](),'context':_0x42f1e3||{}};loggerService_1['loggerService'][_0x30a27c(0x133)](_0x4f1fe4),console['error'](_0x30a27c(0xdb)+_0x327c29+'\x20('+_0x20f07e+')'),console['error'](_0x30a27c(0x115)+(_0x4fcc2e instanceof Error?_0x4fcc2e[_0x30a27c(0x1cd)]:_0x4fcc2e)),console[_0x30a27c(0x153)]('\x20\x20\x20📍\x20Source:\x20'+_0x31b241),console[_0x30a27c(0x153)](_0x30a27c(0x164)+_0x4f1fe4[_0x30a27c(0x1c8)]),_0x42f1e3&&console['error']('\x20\x20\x20📝\x20Context:',_0x42f1e3);}[a38_0x5ef9ab(0x10e)](){const _0x22415a=a38_0x5ef9ab;console['log'](_0x22415a(0x1d3)),this[_0x22415a(0x1b3)]()[_0x22415a(0x1e2)](_0x5eca76=>{const _0x17c434=_0x22415a;console[_0x17c434(0x153)](_0x17c434(0x136),_0x5eca76);}),this[_0x22415a(0x1e1)]=setInterval(async()=>{const _0xda1843=_0x22415a;try{console[_0xda1843(0x13f)](_0xda1843(0x159)),await this['checkAllPendingPayments'](),console[_0xda1843(0x13f)]('✅\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed');}catch(_0x1c5c77){console['error'](_0xda1843(0x154),_0x1c5c77);}},this[_0x22415a(0x13d)]),console[_0x22415a(0x13f)](_0x22415a(0xd8));}['stopPeriodicStatusCheck'](){const _0x1f0bf4=a38_0x5ef9ab;console[_0x1f0bf4(0x13f)](_0x1f0bf4(0x142));this[_0x1f0bf4(0x1e1)]&&(clearInterval(this[_0x1f0bf4(0x1e1)]),this['globalCheckInterval']=null,console['log'](_0x1f0bf4(0x1c0)));const _0x218212=this[_0x1f0bf4(0x1e4)][_0x1f0bf4(0x11d)];for(const [_0x382043]of this['paymentTimers']){this[_0x1f0bf4(0x129)](_0x382043);}console[_0x1f0bf4(0x13f)](_0x1f0bf4(0x19f)+_0x218212+_0x1f0bf4(0x140));}async['checkAllPendingPayments'](){const _0x3c58f2=a38_0x5ef9ab;try{console[_0x3c58f2(0x13f)](_0x3c58f2(0xe0));const _0x229d66=await database_1['default'][_0x3c58f2(0x15a)][_0x3c58f2(0x14f)]({'where':{'gateway':{'in':[_0x3c58f2(0xfe),'cointopay2']},'status':_0x3c58f2(0x1a0),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x3c58f2(0x13f)]('🪙\x20[GLOBAL]\x20Found\x20'+_0x229d66['length']+_0x3c58f2(0xec));if(_0x229d66[_0x3c58f2(0x18a)]===0x0){console['log'](_0x3c58f2(0x145));return;}const _0x236f60=await this[_0x3c58f2(0x1aa)](_0x229d66);console['log'](_0x3c58f2(0x14c)+_0x236f60['length']+'\x20expired\x20CoinToPay\x20payments');let _0x509d52=0x0,_0x390a46=0x0;for(const _0x4f204b of _0x229d66){try{if(_0x236f60[_0x3c58f2(0x193)](_0x4f204b['id'])){console['log'](_0x3c58f2(0x116)+_0x4f204b['id']+_0x3c58f2(0x16f)),_0x390a46++;continue;}if(this[_0x3c58f2(0x1e4)][_0x3c58f2(0x130)](_0x4f204b['id'])){console['log']('⏰\x20[GLOBAL]\x20Payment\x20'+_0x4f204b['id']+'\x20has\x20individual\x20timers,\x20skipping\x20global\x20check'),_0x390a46++;continue;}const _0x5f1195=(Date[_0x3c58f2(0x172)]()-_0x4f204b[_0x3c58f2(0x179)][_0x3c58f2(0x1d6)]())/(0x3e8*0x3c*0x3c);if(_0x5f1195<0x1){console[_0x3c58f2(0x13f)](_0x3c58f2(0x116)+_0x4f204b['id']+_0x3c58f2(0x184)+_0x5f1195[_0x3c58f2(0x168)](0x1)+_0x3c58f2(0xf8)),_0x390a46++;continue;}console['log'](_0x3c58f2(0x146)+_0x4f204b['id']+'\x20(age:\x20'+_0x5f1195[_0x3c58f2(0x168)](0x1)+'h)'),await this['checkSinglePayment'](_0x4f204b),_0x509d52++,await new Promise(_0x27f265=>setTimeout(_0x27f265,0x7d0));}catch(_0xa4e1ec){console[_0x3c58f2(0x153)](_0x3c58f2(0x194)+_0x4f204b['id']+':',_0xa4e1ec),this[_0x3c58f2(0x133)](_0x4f204b['id'],_0x4f204b[_0x3c58f2(0x147)]||'unknown',_0xa4e1ec,_0x3c58f2(0xea),{'isGlobalCheck':!![],'paymentAmount':_0x4f204b[_0x3c58f2(0x109)],'paymentCurrency':_0x4f204b['currency'],'shopId':_0x4f204b[_0x3c58f2(0x111)],'createdAt':_0x4f204b[_0x3c58f2(0x179)]}),loggerService_1[_0x3c58f2(0x15d)]['logWhiteDomainError'](_0x3c58f2(0xfe),_0x3c58f2(0x141)+_0x4f204b[_0x3c58f2(0x147)],_0xa4e1ec);}}console[_0x3c58f2(0x13f)]('✅\x20[GLOBAL]\x20Global\x20check\x20completed:\x20'+_0x509d52+_0x3c58f2(0xe8)+_0x390a46+_0x3c58f2(0x187)+_0x236f60[_0x3c58f2(0x18a)]+_0x3c58f2(0x119));}catch(_0x1ede9d){console[_0x3c58f2(0x153)](_0x3c58f2(0x1ac),_0x1ede9d);}}async[a38_0x5ef9ab(0x1aa)](_0x17ff7b){const _0x18957a=a38_0x5ef9ab,_0x16e829=[],_0xf20992=new Date();_0xf20992[_0x18957a(0x123)](_0xf20992[_0x18957a(0xe7)]()-this['EXPIRY_DAYS']),console['log'](_0x18957a(0xf6)+this[_0x18957a(0xdd)]+_0x18957a(0xe5)+_0xf20992[_0x18957a(0x16e)]()+')');for(const _0x47e846 of _0x17ff7b){if(_0x47e846['createdAt']<_0xf20992){console[_0x18957a(0x13f)](_0x18957a(0x165)+_0x47e846['id']+_0x18957a(0x1b4)+this[_0x18957a(0xdd)]+_0x18957a(0x178));try{this[_0x18957a(0x1c7)](_0x47e846['id'],_0x47e846[_0x18957a(0x147)]||_0x18957a(0x1cc),_0x18957a(0x1a0),'EXPIRED',_0x18957a(0x195),{'reason':_0x18957a(0x17c)+this[_0x18957a(0xdd)]+_0x18957a(0xde),'createdAt':_0x47e846['createdAt'],'daysSinceCreation':Math[_0x18957a(0xf9)]((Date['now']()-_0x47e846['createdAt'][_0x18957a(0x1d6)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x47e846['amount'],'paymentCurrency':_0x47e846[_0x18957a(0x197)],'shopId':_0x47e846[_0x18957a(0x111)]}),await database_1[_0x18957a(0x13c)][_0x18957a(0x15a)]['update']({'where':{'id':_0x47e846['id']},'data':{'status':_0x18957a(0x1ae),'updatedAt':new Date(),'adminNotes':_0x18957a(0x143)+this['EXPIRY_DAYS']+_0x18957a(0xeb)}}),await database_1[_0x18957a(0x13c)]['webhookLog'][_0x18957a(0x17a)]({'data':{'paymentId':_0x47e846['id'],'shopId':_0x47e846['shopId'],'event':_0x18957a(0x1bc),'statusCode':0xc8,'responseBody':JSON[_0x18957a(0x19b)]({'reason':_0x18957a(0x17c)+this[_0x18957a(0xdd)]+_0x18957a(0xde),'createdAt':_0x47e846[_0x18957a(0x179)],'expiredAt':new Date()['toISOString'](),'daysSinceCreation':Math[_0x18957a(0xf9)]((Date[_0x18957a(0x172)]()-_0x47e846[_0x18957a(0x179)][_0x18957a(0x1d6)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x18957a(0x1d0)](_0x47e846,_0x18957a(0x1ae)),await this[_0x18957a(0xf2)](_0x47e846,_0x18957a(0x1ae)),this[_0x18957a(0x129)](_0x47e846['id']),_0x16e829[_0x18957a(0x1c5)](_0x47e846['id']),console[_0x18957a(0x13f)](_0x18957a(0x125)+_0x47e846['id']+_0x18957a(0x188)+this['EXPIRY_DAYS']+_0x18957a(0x11f));}catch(_0x4b25f9){console[_0x18957a(0x153)](_0x18957a(0x1af)+_0x47e846['id']+':',_0x4b25f9),this['logCoinToPayError'](_0x47e846['id'],_0x47e846[_0x18957a(0x147)]||_0x18957a(0x1cc),_0x4b25f9,_0x18957a(0x195),{'reason':_0x18957a(0x118),'createdAt':_0x47e846[_0x18957a(0x179)],'daysSinceCreation':Math[_0x18957a(0xf9)]((Date[_0x18957a(0x172)]()-_0x47e846['createdAt'][_0x18957a(0x1d6)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x16e829;}async[a38_0x5ef9ab(0x104)](_0x1c66b8){const _0x4ff8f4=a38_0x5ef9ab;if(!_0x1c66b8['gatewayPaymentId']){console[_0x4ff8f4(0x13f)]('⚠️\x20[CHECK]\x20Payment\x20'+_0x1c66b8['id']+_0x4ff8f4(0x1d1));return;}console[_0x4ff8f4(0x13f)](_0x4ff8f4(0x166)+_0x1c66b8[_0x4ff8f4(0x10a)]+_0x4ff8f4(0x12e)+_0x1c66b8['id']+'\x20('+_0x1c66b8[_0x4ff8f4(0x147)]+')');try{let _0x2eadf0;_0x1c66b8[_0x4ff8f4(0x10a)]===_0x4ff8f4(0x1e0)?(_0x2eadf0=await this[_0x4ff8f4(0x120)][_0x4ff8f4(0x11c)](_0x1c66b8[_0x4ff8f4(0x147)]),console[_0x4ff8f4(0x13f)](_0x4ff8f4(0x15f)+_0x1c66b8['id']+_0x4ff8f4(0x1d4)+_0x2eadf0[_0x4ff8f4(0x1e5)])):(_0x2eadf0=await this[_0x4ff8f4(0x13e)][_0x4ff8f4(0x11c)](_0x1c66b8[_0x4ff8f4(0x147)]),console['log'](_0x4ff8f4(0x17f)+_0x1c66b8['id']+_0x4ff8f4(0x1d4)+_0x2eadf0['status']));_0x2eadf0['paymentDetails']&&console[_0x4ff8f4(0x13f)](_0x4ff8f4(0x1be)+_0x1c66b8['id']+'\x20details:',{'iban':_0x2eadf0[_0x4ff8f4(0x177)][_0x4ff8f4(0x12a)]||_0x4ff8f4(0x137),'transactionId':_0x2eadf0[_0x4ff8f4(0x177)][_0x4ff8f4(0x15e)],'createdOn':_0x2eadf0[_0x4ff8f4(0x177)][_0x4ff8f4(0x1a7)],'confirmedOn':_0x2eadf0[_0x4ff8f4(0x177)][_0x4ff8f4(0x10c)]||_0x4ff8f4(0x18f)});if(_0x2eadf0[_0x4ff8f4(0x1e5)]!==_0x1c66b8[_0x4ff8f4(0x1e5)]){console[_0x4ff8f4(0x13f)](_0x4ff8f4(0xe3)+_0x1c66b8['id']+_0x4ff8f4(0x1bd)+_0x1c66b8[_0x4ff8f4(0x1e5)]+_0x4ff8f4(0x1b5)+_0x2eadf0['status']),this[_0x4ff8f4(0x1c7)](_0x1c66b8['id'],_0x1c66b8['gatewayPaymentId'],_0x1c66b8['status'],_0x2eadf0[_0x4ff8f4(0x1e5)],_0x4ff8f4(0xea),{'paymentDetails':_0x2eadf0[_0x4ff8f4(0x177)],'amount':_0x2eadf0[_0x4ff8f4(0x109)],'currency':_0x2eadf0[_0x4ff8f4(0x197)],'shopId':_0x1c66b8['shopId'],'checkTimestamp':new Date()[_0x4ff8f4(0x16e)]()});const _0x5e3cbc={'status':_0x2eadf0[_0x4ff8f4(0x1e5)],'updatedAt':new Date()};if(_0x2eadf0['status']===_0x4ff8f4(0x126)&&_0x1c66b8[_0x4ff8f4(0x1e5)]!=='PAID'){_0x5e3cbc['paidAt']=new Date();if(!_0x1c66b8[_0x4ff8f4(0x1b8)]){const _0x248d5c=await currencyService_1['currencyService'][_0x4ff8f4(0xed)](_0x1c66b8[_0x4ff8f4(0x109)],_0x1c66b8[_0x4ff8f4(0x197)]);_0x5e3cbc[_0x4ff8f4(0x1b8)]=_0x248d5c;const _0x3b18dc=await this['getGatewayCommission'](_0x1c66b8['shopId'],_0x1c66b8[_0x4ff8f4(0x10a)]),_0x1043a7=_0x248d5c*(0x1-_0x3b18dc/0x64);_0x5e3cbc[_0x4ff8f4(0x114)]=_0x1043a7,console[_0x4ff8f4(0x13f)](_0x4ff8f4(0x1c1)+_0x1c66b8['id']+_0x4ff8f4(0x132)),console['log'](_0x4ff8f4(0x182)+_0x1c66b8[_0x4ff8f4(0x109)]+'\x20'+_0x1c66b8[_0x4ff8f4(0x197)]+_0x4ff8f4(0x16d)+_0x248d5c[_0x4ff8f4(0x168)](0x6)+_0x4ff8f4(0x122)),console[_0x4ff8f4(0x13f)](_0x4ff8f4(0xda)+_0x1c66b8[_0x4ff8f4(0x10a)]+_0x4ff8f4(0x17d)+_0x3b18dc+'%'),console[_0x4ff8f4(0x13f)]('\x20\x20\x20Amount\x20after\x20commission:\x20'+_0x1043a7[_0x4ff8f4(0x168)](0x6)+'\x20USDT');}console[_0x4ff8f4(0x13f)](_0x4ff8f4(0x1c1)+_0x1c66b8['id']+_0x4ff8f4(0x162)+_0x5e3cbc['paidAt']['toISOString']());}if(_0x2eadf0[_0x4ff8f4(0x177)]){const _0x4d087e=_0x2eadf0[_0x4ff8f4(0x177)];_0x4d087e[_0x4ff8f4(0x12a)]&&(_0x5e3cbc['remitterIban']=_0x4d087e[_0x4ff8f4(0x12a)],console[_0x4ff8f4(0x13f)](_0x4ff8f4(0x16b)+_0x4d087e[_0x4ff8f4(0x12a)]));if(_0x4d087e[_0x4ff8f4(0x1d8)]){const _0x8390e5=_0x1c66b8['adminNotes']||'',_0x4589f6=_0x4ff8f4(0x192)+_0x4d087e[_0x4ff8f4(0x1d8)];_0x5e3cbc['adminNotes']=_0x8390e5?_0x8390e5+'\x0a\x0a'+_0x4589f6:_0x4589f6,console[_0x4ff8f4(0x13f)]('🏦\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes');}_0x4d087e[_0x4ff8f4(0x15e)]&&console[_0x4ff8f4(0x13f)]('🆔\x20[CHECK]\x20Transaction\x20ID:\x20'+_0x4d087e[_0x4ff8f4(0x15e)]),_0x4d087e[_0x4ff8f4(0x10c)]&&console['log'](_0x4ff8f4(0x19c)+_0x4d087e[_0x4ff8f4(0x10c)]);}await database_1[_0x4ff8f4(0x13c)]['payment'][_0x4ff8f4(0x1a2)]({'where':{'id':_0x1c66b8['id']},'data':_0x5e3cbc});if(_0x2eadf0[_0x4ff8f4(0x1e5)]===_0x4ff8f4(0x126)&&_0x1c66b8[_0x4ff8f4(0x1e5)]!==_0x4ff8f4(0x126)){console[_0x4ff8f4(0x13f)](_0x4ff8f4(0xee)+_0x1c66b8['id']+'\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link');const _0x115c8d=await database_1[_0x4ff8f4(0x13c)][_0x4ff8f4(0x15a)]['findUnique']({'where':{'id':_0x1c66b8['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x115c8d?.[_0x4ff8f4(0x151)]&&_0x115c8d[_0x4ff8f4(0x139)])try{const _0x2dafb4=_0x115c8d[_0x4ff8f4(0x139)];console[_0x4ff8f4(0x13f)](_0x4ff8f4(0x1a1)+_0x2dafb4['id']+_0x4ff8f4(0x167)+_0x2dafb4[_0x4ff8f4(0x110)]+',\x20currentPayments='+_0x2dafb4[_0x4ff8f4(0x134)]+',\x20status='+_0x2dafb4[_0x4ff8f4(0x1e5)]);const _0x33d667=_0x2dafb4[_0x4ff8f4(0x134)]+0x1,_0x59ab05=_0x2dafb4[_0x4ff8f4(0x110)]===_0x4ff8f4(0x128)?_0x4ff8f4(0x1a4):_0x2dafb4[_0x4ff8f4(0x1e5)];await database_1[_0x4ff8f4(0x13c)][_0x4ff8f4(0x139)][_0x4ff8f4(0x1a2)]({'where':{'id':_0x2dafb4['id']},'data':{'currentPayments':_0x33d667,'status':_0x59ab05,'updatedAt':new Date()}}),console[_0x4ff8f4(0x13f)](_0x4ff8f4(0x11a)+_0x2dafb4['id']+_0x4ff8f4(0x1cf)+_0x2dafb4[_0x4ff8f4(0x134)]+_0x4ff8f4(0x16d)+_0x33d667+_0x4ff8f4(0xe4)+_0x2dafb4[_0x4ff8f4(0x1e5)]+_0x4ff8f4(0x16d)+_0x59ab05);}catch(_0x42c3da){console[_0x4ff8f4(0x153)]('❌\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:',_0x42c3da);}else console[_0x4ff8f4(0x13f)]('📈\x20[COINTOPAY]\x20Payment\x20'+_0x1c66b8['id']+'\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link');}await database_1[_0x4ff8f4(0x13c)][_0x4ff8f4(0x1a6)][_0x4ff8f4(0x17a)]({'data':{'paymentId':_0x1c66b8['id'],'shopId':_0x1c66b8[_0x4ff8f4(0x111)],'event':_0x4ff8f4(0x1df)+_0x2eadf0[_0x4ff8f4(0x1e5)][_0x4ff8f4(0x106)](),'statusCode':0xc8,'responseBody':JSON['stringify']({'oldStatus':_0x1c66b8[_0x4ff8f4(0x1e5)],'newStatus':_0x2eadf0[_0x4ff8f4(0x1e5)],'paymentDetails':_0x2eadf0[_0x4ff8f4(0x177)],'checkedAt':new Date()['toISOString']()})}}),await this[_0x4ff8f4(0x1d0)](_0x1c66b8,_0x2eadf0[_0x4ff8f4(0x1e5)]),await this['sendPaymentStatusNotification'](_0x1c66b8,_0x2eadf0[_0x4ff8f4(0x1e5)]),_0x2eadf0[_0x4ff8f4(0x1e5)]!==_0x4ff8f4(0x1a0)&&(console[_0x4ff8f4(0x13f)](_0x4ff8f4(0xef)+_0x1c66b8['id']+_0x4ff8f4(0x196)+_0x2eadf0[_0x4ff8f4(0x1e5)]+_0x4ff8f4(0x1ce)),this[_0x4ff8f4(0x129)](_0x1c66b8['id'])),console['log'](_0x4ff8f4(0x1dd)+_0x1c66b8['id']+_0x4ff8f4(0x107));}else console[_0x4ff8f4(0x13f)](_0x4ff8f4(0x1be)+_0x1c66b8['id']+_0x4ff8f4(0x1c4)+_0x2eadf0[_0x4ff8f4(0x1e5)]+')'),this[_0x4ff8f4(0x1c7)](_0x1c66b8['id'],_0x1c66b8[_0x4ff8f4(0x147)],_0x1c66b8[_0x4ff8f4(0x1e5)],_0x2eadf0[_0x4ff8f4(0x1e5)],'status_check',{'statusUnchanged':!![],'paymentDetails':_0x2eadf0[_0x4ff8f4(0x177)],'amount':_0x2eadf0['amount'],'currency':_0x2eadf0['currency'],'shopId':_0x1c66b8[_0x4ff8f4(0x111)],'checkTimestamp':new Date()['toISOString']()});}catch(_0x4131b3){console[_0x4ff8f4(0x153)](_0x4ff8f4(0x11e)+_0x1c66b8['id']+':',_0x4131b3),this[_0x4ff8f4(0x133)](_0x1c66b8['id'],_0x1c66b8['gatewayPaymentId'],_0x4131b3,_0x4ff8f4(0xea),{'paymentAmount':_0x1c66b8[_0x4ff8f4(0x109)],'paymentCurrency':_0x1c66b8[_0x4ff8f4(0x197)],'shopId':_0x1c66b8[_0x4ff8f4(0x111)],'createdAt':_0x1c66b8[_0x4ff8f4(0x179)]}),await database_1[_0x4ff8f4(0x13c)][_0x4ff8f4(0x1a6)]['create']({'data':{'paymentId':_0x1c66b8['id'],'shopId':_0x1c66b8['shopId'],'event':_0x4ff8f4(0x108),'statusCode':0x1f4,'responseBody':JSON[_0x4ff8f4(0x19b)]({'error':_0x4131b3 instanceof Error?_0x4131b3[_0x4ff8f4(0x1cd)]:'Unknown\x20error','gatewayPaymentId':_0x1c66b8[_0x4ff8f4(0x147)],'checkedAt':new Date()[_0x4ff8f4(0x16e)]()})}});}}async[a38_0x5ef9ab(0x1d0)](_0x278065,_0x4ef613){const _0x25793a=a38_0x5ef9ab,_0x72acd0=Date[_0x25793a(0x172)]();try{const _0x2372c3=_0x278065[_0x25793a(0x113)],_0x15e743=_0x2372c3[_0x25793a(0x198)];if(!_0x15e743?.[_0x25793a(0x1da)]){console[_0x25793a(0x13f)](_0x25793a(0x105)+_0x2372c3['id']);return;}const _0x334adc=_0x4ef613===_0x25793a(0x126)?_0x25793a(0x101):_0x4ef613===_0x25793a(0xe6)?_0x25793a(0x180):_0x4ef613==='EXPIRED'?_0x25793a(0x180):_0x25793a(0x19e);if(!_0x15e743[_0x25793a(0x12c)]?.[_0x25793a(0x193)](_0x334adc)){console[_0x25793a(0x13f)](_0x25793a(0x1ad)+_0x334adc+_0x25793a(0x161)+_0x2372c3['id']);return;}const _0x2115af=(0x0,gateway_1['getGatewayIdByName'])(_0x278065[_0x25793a(0x10a)])||_0x278065[_0x25793a(0x10a)],_0x537ab3={'event':_0x334adc,'payment':{'id':_0x278065['id'],'order_id':_0x278065[_0x25793a(0xf7)],'gateway_order_id':_0x278065['gatewayOrderId'],'gateway':_0x2115af,'amount':_0x278065[_0x25793a(0x109)],'currency':_0x278065[_0x25793a(0x197)],'status':_0x4ef613[_0x25793a(0x106)](),'customer_email':_0x278065['customerEmail'],'customer_name':_0x278065[_0x25793a(0xfb)],'created_at':_0x278065['createdAt'],'updated_at':new Date()}},_0x7cbcd9=await fetch(_0x15e743[_0x25793a(0x1da)],{'method':'POST','headers':{'Content-Type':_0x25793a(0xd6),'User-Agent':_0x25793a(0x135)},'body':JSON[_0x25793a(0x19b)](_0x537ab3)}),_0x39102a=Date[_0x25793a(0x172)]()-_0x72acd0,_0x404041=_0x7cbcd9['ok']?_0x25793a(0x155):await _0x7cbcd9[_0x25793a(0x1c9)]();loggerService_1['loggerService']['logShopWebhookSent'](_0x278065[_0x25793a(0x111)],_0x15e743['webhookUrl'],_0x334adc,_0x7cbcd9[_0x25793a(0x1e5)],_0x39102a,_0x537ab3),console['log'](_0x25793a(0x189)+_0x15e743[_0x25793a(0x1da)]+_0x25793a(0x100)+_0x7cbcd9[_0x25793a(0x1e5)]+'\x20('+_0x39102a+_0x25793a(0x18c));}catch(_0x610b97){console['error']('Failed\x20to\x20send\x20shop\x20webhook:',_0x610b97),loggerService_1['loggerService'][_0x25793a(0x1a9)](_0x278065[_0x25793a(0x111)],_0x278065[_0x25793a(0x113)]?.[_0x25793a(0x198)]?.[_0x25793a(0x1da)]||_0x25793a(0x1cc),_0x25793a(0x1bb),_0x610b97,{});}}async[a38_0x5ef9ab(0xf2)](_0x299215,_0x3afa36){const _0x1308df=a38_0x5ef9ab;try{const _0x4b09ab={'PENDING':_0x1308df(0x103),'PAID':_0x1308df(0x18e),'FAILED':_0x1308df(0x1c2),'EXPIRED':_0x1308df(0x175)},_0x2b82a2=_0x4b09ab[_0x3afa36];if(!_0x2b82a2||_0x2b82a2==='created')return;await telegramBotService_1['telegramBotService']['sendPaymentNotification'](_0x299215[_0x1308df(0x111)],_0x299215,_0x2b82a2);}catch(_0xff633b){console[_0x1308df(0x153)](_0x1308df(0x102),_0xff633b);}}async['checkPaymentById'](_0x1adc38){const _0x29d3e2=a38_0x5ef9ab;console[_0x29d3e2(0x13f)](_0x29d3e2(0xdc)+_0x1adc38);const _0x553dfa=await database_1[_0x29d3e2(0x13c)][_0x29d3e2(0x15a)][_0x29d3e2(0x10b)]({'where':{'id':_0x1adc38},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x553dfa)throw new Error(_0x29d3e2(0x186));if(_0x553dfa[_0x29d3e2(0x10a)]!==_0x29d3e2(0xfe)&&_0x553dfa[_0x29d3e2(0x10a)]!==_0x29d3e2(0x1e0))throw new Error(_0x29d3e2(0x13a));console[_0x29d3e2(0x13f)]('✅\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20'+_0x553dfa[_0x29d3e2(0x10a)]+'\x20payment\x20'+_0x1adc38),await this[_0x29d3e2(0x104)](_0x553dfa),console['log'](_0x29d3e2(0x15b)+_0x1adc38);}['getServiceStats'](){const _0x4a7e71=a38_0x5ef9ab,_0x2cf5a0=this['globalCheckInterval']?this[_0x4a7e71(0x13d)]:undefined,_0x5bf938=Array[_0x4a7e71(0x1cb)](this['paymentTimers'][_0x4a7e71(0x10f)]())[_0x4a7e71(0x124)](_0x7b82bf=>({'paymentId':_0x7b82bf[_0x4a7e71(0x156)],'gatewayPaymentId':_0x7b82bf[_0x4a7e71(0x147)],'createdAt':_0x7b82bf['createdAt'],'timersCount':_0x7b82bf[_0x4a7e71(0x17e)]['length']}));return{'isActive':!!this[_0x4a7e71(0x1e1)],'globalCheckIntervalMinutes':this['GLOBAL_CHECK_INTERVAL_MS']/(0x3e8*0x3c),'expiryDays':this['EXPIRY_DAYS'],'activeIndividualTimers':this[_0x4a7e71(0x1e4)][_0x4a7e71(0x11d)],'nextGlobalCheckIn':_0x2cf5a0,'paymentTimersDetails':_0x5bf938};}['getPaymentTimerInfo'](_0x3749fb){const _0x120b23=a38_0x5ef9ab,_0x278c1c=this[_0x120b23(0x1e4)][_0x120b23(0x1b2)](_0x3749fb);if(_0x278c1c)return{'hasTimers':!![],'timersCount':_0x278c1c['timers'][_0x120b23(0x18a)],'createdAt':_0x278c1c[_0x120b23(0x179)],'gatewayPaymentId':_0x278c1c[_0x120b23(0x147)]};return{'hasTimers':![]};}async[a38_0x5ef9ab(0xe2)](_0x4015e6,_0x29a4fa){const _0x1ea4ed=a38_0x5ef9ab;try{const _0x356f90=await database_1[_0x1ea4ed(0x13c)]['shop']['findUnique']({'where':{'id':_0x4015e6},'select':{'gatewaySettings':!![]}});if(!_0x356f90?.['gatewaySettings'])return console['log']('No\x20gateway\x20settings\x20found\x20for\x20shop\x20'+_0x4015e6+_0x1ea4ed(0x152)),0xa;const _0x109426=JSON['parse'](_0x356f90[_0x1ea4ed(0xd7)]);for(const [_0x1cde26,_0x22476f]of Object[_0x1ea4ed(0x12f)](_0x109426)){if(_0x1cde26[_0x1ea4ed(0x106)]()===_0x29a4fa[_0x1ea4ed(0x106)]()){const _0x14f845=_0x22476f['commission']||0xa;return console[_0x1ea4ed(0x13f)](_0x1ea4ed(0x117)+_0x29a4fa+'\x20commission\x20for\x20shop\x20'+_0x4015e6+':\x20'+_0x14f845+'%'),_0x14f845;}}return console[_0x1ea4ed(0x13f)](_0x1ea4ed(0x112)+_0x29a4fa+_0x1ea4ed(0x173)+_0x4015e6+_0x1ea4ed(0x1a8)),0xa;}catch(_0x772d84){return console[_0x1ea4ed(0x153)]('Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20'+_0x4015e6+_0x1ea4ed(0x10d)+_0x29a4fa+':',_0x772d84),0xa;}}}exports[a38_0x5ef9ab(0x158)]=CoinToPayStatusService,exports[a38_0x5ef9ab(0xfd)]=new CoinToPayStatusService();function a38_0xcf49(_0x2b69cd,_0x34b2e4){const _0xf7a268=a38_0xf7a2();return a38_0xcf49=function(_0xcf4949,_0x5520a8){_0xcf4949=_0xcf4949-0xd6;let _0x4c3f9b=_0xf7a268[_0xcf4949];return _0x4c3f9b;},a38_0xcf49(_0x2b69cd,_0x34b2e4);}function a38_0xf7a2(){const _0x2fded0=['paymentLink','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','🪙\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','default','GLOBAL_CHECK_INTERVAL_MS','coinToPayService','log','\x20individual\x20payment\x20timers','/status/','🛑\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','Automatically\x20expired\x20after\x20','\x20\x20\x20📊\x20Status:\x20','🪙\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','🔍\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','gatewayPaymentId','5\x20minutes','checkSinglePaymentById','3JTAyHY','../types/gateway','⏰\x20[GLOBAL]\x20Found\x20','⚠️\x20[CHECK]\x20Payment\x20','🪙\x20[TIMER]\x20Individual\x20check\x20#','findMany','🧹\x20[DEBUG]\x20Cleared\x20timer\x20#','paymentLinkId',',\x20using\x20default\x20commission\x2010%','error','❌\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','Success','paymentId','❌\x20[TIMER]\x20Failed\x20individual\x20check\x20#','CoinToPayStatusService','🪙\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','payment','✅\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','\x20for\x20payment\x20','loggerService','transactionId','📊\x20[CHECK]\x20CoinToPay2\x20payment\x20','1ivNXHf','\x20not\x20enabled\x20for\x20shop\x20','\x20marked\x20as\x20paid\x20at:\x20','\x20\x20\x20-\x20gatewayPaymentId:\x20','\x20\x20\x20📅\x20Time:\x20','⏰\x20[EXPIRY]\x20Payment\x20','🔍\x20[CHECK]\x20Checking\x20',':\x20type=','toFixed','\x20completed\x20for\x20payment\x20','delay','🏦\x20[CHECK]\x20Saved\x20IBAN:\x20','\x20not\x20found\x20in\x20database','\x20->\x20','toISOString','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','\x20\x20\x20-\x20Gateway:\x20','2\x20minutes','now','\x20in\x20shop\x20','\x20has\x20no\x20gatewayPaymentId','expired','266eLbYzq','paymentDetails','\x20days,\x20marking\x20as\x20EXPIRED','createdAt','create','description','Payment\x20older\x20than\x20','\x20commission:\x20','timers','📊\x20[CHECK]\x20CoinToPay\x20payment\x20','payment.failed','⏰\x20[HOURLY]\x20Payment\x20','\x20\x20\x20Amount:\x20','COINTOPAY_ERROR','\x20is\x20too\x20new\x20(','./telegramBotService','Payment\x20not\x20found','\x20skipped,\x20','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','Shop\x20webhook\x20sent\x20to\x20','length','__importDefault','ms)','COINTOPAY_STATUS_CHANGE','paid','not\x20confirmed','11264022oBciiQ','227776SrDetp','Bank\x20Details:\x20','includes','❌\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','auto_expire','\x20status\x20changed\x20to\x20','currency','settings','\x20not\x20found,\x20clearing\x20timers','\x20\x20\x20-\x20ShopId:\x20','stringify','✅\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','3715960rJBdgM','payment.pending','🛑\x20[SHUTDOWN]\x20Cleared\x20','PENDING','📈\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','update','✅\x20[HOURLY]\x20Payment\x20','COMPLETED','30ZbOjtV','webhookLog','createdOn',',\x20using\x20default\x2010%','logShopWebhookError','checkExpiredPayments','\x20to\x20clear','❌\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','Webhook\x20event\x20','EXPIRED','❌\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','\x20seconds\x20(','🪙\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','get','checkAllPendingPayments','\x20is\x20older\x20than\x20','\x20to\x20','\x20is\x20valid\x20for\x20checking,\x20proceeding...','CoinToPayService','amountUSDT','29872PBUZpO','set','webhook_send','cointopay_auto_expired','\x20status\x20from\x20','📊\x20[CHECK]\x20Payment\x20','CoinToPay2Service','🛑\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','💰\x20[CHECK]\x20Payment\x20','failed','.\x20Remaining\x20active\x20timers:\x20','\x20status\x20unchanged\x20(','push','\x20\x20\x20-\x20Status:\x20','logCoinToPayStatus','timestamp','text','./gateways/coinToPay2Service','from','unknown','message',',\x20clearing\x20individual\x20timers','\x20updated:\x20currentPayments=','sendShopWebhook','\x20has\x20no\x20gatewayPaymentId,\x20skipping','✅\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','🪙\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','\x20status:\x20','7467119qOxTnS','getTime','\x20\x20\x20📍\x20Source:\x20','bankDetails','./gateways/coinToPayService','webhookUrl','11899836hoyFpy','./currencyService','✅\x20[CHECK]\x20Payment\x20','./loggerService','cointopay_status_check_','cointopay2','globalCheckInterval','catch',',\x20stopping\x20individual\x20checks','paymentTimers','status','application/json','gatewaySettings','✅\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','\x20\x20\x20Gateway\x20','🪙\x20[ERROR]\x20CoinToPay\x20Error:\x20','🔍\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','EXPIRY_DAYS','\x20days','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','🪙\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','🧹\x20[DEBUG]\x20Clearing\x20','getGatewayCommission','🔄\x20[CHECK]\x20Updating\x20payment\x20',',\x20status=','\x20days\x20(created\x20before\x20','FAILED','getDate','\x20checked,\x20','schedule_created','status_check','\x20days\x20without\x20payment\x20confirmation','\x20pending\x20CoinToPay\x20payments','convertToUSDT','📈\x20[COINTOPAY]\x20Payment\x20','🧹\x20[CHECK]\x20Payment\x20','1\x20minute','\x20\x20\x20-\x20paymentId:\x20','sendPaymentStatusNotification','\x20\x20\x20📝\x20Details:','\x20(after\x20','stack','⏰\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','orderId','h),\x20skipping\x20global\x20check','floor','../config/database','customerName','\x20initial\x20timers\x20for\x20payment\x20','coinToPayStatusService','cointopay','4504268TAtZCl','\x20with\x20status\x20','payment.success','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','created','checkSinglePayment','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','toLowerCase','\x20updated\x20successfully','cointopay_status_check_error','amount','gateway','findUnique','confirmedOn',',\x20gateway\x20','startPeriodicStatusCheck','values','type','shopId','No\x20specific\x20commission\x20found\x20for\x20gateway\x20','shop','amountAfterGatewayCommissionUSDT','\x20\x20\x20❌\x20Error:\x20','⏰\x20[GLOBAL]\x20Payment\x20','Gateway\x20','Failed\x20to\x20mark\x20payment\x20as\x20expired','\x20expired','✅\x20[COINTOPAY]\x20Payment\x20link\x20','🪙\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','checkPaymentStatus','size','❌\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','-day\x20timeout','coinToPay2Service','\x20triggered\x20for\x20payment\x20','\x20USDT','setDate','map','✅\x20[EXPIRY]\x20Payment\x20','PAID','forEach','SINGLE','clearPaymentTimers','iban','__esModule','webhookEvents','delete','\x20payment\x20','entries','has','⏰\x20[DEBUG]\x20Scheduled\x20check\x20#','\x20amounts\x20calculated:','logCoinToPayError','currentPayments','TesSoft\x20Payment\x20System/1.0','❌\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','not\x20found','\x20status\x20is\x20'];a38_0xf7a2=function(){return _0x2fded0;};return a38_0xf7a2();}