'use strict';const a42_0x4ce0f4=a42_0x198f;(function(_0xa4cdc2,_0x34b8aa){const _0x3222c2=a42_0x198f,_0x757a5=_0xa4cdc2();while(!![]){try{const _0x44a803=parseInt(_0x3222c2(0x22e))/0x1+-parseInt(_0x3222c2(0x243))/0x2+parseInt(_0x3222c2(0x21d))/0x3+-parseInt(_0x3222c2(0x24e))/0x4*(parseInt(_0x3222c2(0x1b5))/0x5)+parseInt(_0x3222c2(0x1fe))/0x6*(parseInt(_0x3222c2(0x1c0))/0x7)+-parseInt(_0x3222c2(0x207))/0x8*(-parseInt(_0x3222c2(0x21c))/0x9)+parseInt(_0x3222c2(0x234))/0xa*(-parseInt(_0x3222c2(0x27f))/0xb);if(_0x44a803===_0x34b8aa)break;else _0x757a5['push'](_0x757a5['shift']());}catch(_0x11004c){_0x757a5['push'](_0x757a5['shift']());}}}(a42_0x22f2,0x2e028));var __importDefault=this&&this['__importDefault']||function(_0x346f23){const _0x8e7668=a42_0x198f;return _0x346f23&&_0x346f23[_0x8e7668(0x1f8)]?_0x346f23:{'default':_0x346f23};};function a42_0x22f2(){const _0x3a796b=['\x20\x20\x20📅\x20Time:\x20','get','remitterIban','paidAt','\x20in\x20','from','currentPayments','amount','Bank\x20Details:\x20','payment.success','238992upitSe','📈\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','📈\x20[COINTOPAY]\x20Payment\x20','set','currency','🔍\x20[CHECK]\x20Checking\x20','\x20status\x20from\x20','📊\x20[HOURLY]\x20Payment\x20','not\x20confirmed','\x20\x20\x20📝\x20Details:','unknown','2\x20minutes','✅\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','📊\x20[CHECK]\x20CoinToPay2\x20payment\x20','✅\x20[CHECK]\x20Payment\x20','🔍\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','../types/gateway','h),\x20skipping\x20global\x20check','toFixed','log','stack','\x20checked,\x20','🔍\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','currencyService','payment.failed','webhook_send','getServiceStats','forEach','CoinToPayService','❌\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','toLowerCase','Failed\x20to\x20send\x20shop\x20webhook:','.\x20Remaining\x20active\x20timers:\x20','⏰\x20[DEBUG]\x20Scheduled\x20check\x20#','⏰\x20[GLOBAL]\x20Found\x20','floor','\x20commission\x20for\x20shop\x20','./telegramBotService','SINGLE','length','\x20is\x20too\x20new\x20(','error','loggerService','⚠️\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','POST','\x20\x20\x20-\x20Amount:\x20','customerName','❌\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','🪙\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','11fSTDBp','\x20for\x20payment\x20','toISOString','\x20completed\x20for\x20payment\x20','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','settings','timers','Automatically\x20expired\x20after\x20','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','schedulePaymentChecks','logCoinToPayError','map','GLOBAL_CHECK_INTERVAL_MS','clearPaymentTimers','expired','checkSinglePaymentById','CoinToPayStatusService','\x20payment\x20','checkAllPendingPayments','\x20\x20\x20Amount\x20after\x20commission:\x20','\x20skipped,\x20','Payment\x20System/1.0','telegramBotService','\x20not\x20found\x20in\x20database','update','🧹\x20[DEBUG]\x20Clearing\x20','./loggerService','bankDetails','gatewayOrderId','created','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','❌\x20[CHECK]\x20Payment\x20','🆔\x20[CHECK]\x20Transaction\x20ID:\x20','\x20updated\x20successfully','⏰\x20[HOURLY]\x20Payment\x20','✅\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','\x20->\x20','Gateway\x20','cointopay2','gatewayPaymentId','values','sendPaymentStatusNotification','\x20(age:\x20','📊\x20[CHECK]\x20CoinToPay\x20payment\x20','coinToPayService','amountUSDT','🪙\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2',',\x20status=','globalCheckInterval','size','🔄\x20[CHECK]\x20Updating\x20payment\x20','\x20\x20\x20-\x20paymentId:\x20','shop','🏦\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes','\x20\x20\x20📍\x20Source:\x20','\x20\x20\x20❌\x20Error:\x20','commission','\x20\x20\x20Amount:\x20','includes','📊\x20[CHECK]\x20Payment\x20','sendPaymentNotification','❌\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','stopPeriodicStatusCheck','paid','getGatewayIdByName','30Skxmlm','\x20details:','COINTOPAY_ERROR','push','✅\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','confirmedOn','Success','Unknown\x20error','\x20expired\x20CoinToPay\x20payments','delay','paymentLinkId','7nykrPy','shopId','\x20\x20\x20📊\x20Status:\x20','transactionId','⚠️\x20[CHECK]\x20Payment\x20','now','getGatewayCommission','default','cointopay_status_check_error','\x20\x20\x20📝\x20Context:','\x20to\x20','\x20\x20\x20-\x20ShopId:\x20','\x20current\x20status:\x20','\x20USDT','message','logCoinToPayStatus','EXPIRED','application/json','5\x20minutes','gatewayCommissionRate','\x20timers\x20for\x20payment\x20','startPeriodicStatusCheck','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','\x20status\x20changed\x20to\x20','Failed\x20to\x20mark\x20payment\x20as\x20expired',',\x20currentPayments=','\x20days,\x20marking\x20as\x20EXPIRED','🛑\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','status_check','iban','✅\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','parse','cointopay_status_check_','⏰\x20[GLOBAL]\x20Payment\x20','not\x20found','./gateways/coinToPayService','\x20marked\x20as\x20paid\x20at:\x20','coinToPay2Service','\x20is\x20older\x20than\x20','create','🪙\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','description','getDate','🪙\x20[DEBUG]\x20Creating\x20','🪙\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','\x20status:\x20','❌\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','coinToPayStatusService','EXPIRY_DAYS','\x20with\x20status\x20','🪙\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','createdOn','🧹\x20[CHECK]\x20Payment\x20','customerEmail','__esModule','checkExpiredPayments','\x20has\x20no\x20gatewayPaymentId','timestamp','./gateways/coinToPay2Service','gatewaySettings','1687992PdcASy','🪙\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','has','adminNotes','webhookLog','🪙\x20[ERROR]\x20CoinToPay\x20Error:\x20','../config/database','🔍\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','webhookUrl','984wbcvPI','cointopay_auto_expired','\x20triggered\x20for\x20payment\x20','PAID',',\x20clearing\x20individual\x20timers','🪙\x20[GLOBAL]\x20Found\x20','getPaymentTimerInfo','\x20has\x20no\x20gatewayPaymentId,\x20skipping','gateway','Webhook\x20event\x20',',\x20using\x20default\x2010%','setDate','\x20initial\x20timers\x20for\x20payment\x20','CoinToPay2Service','\x20expired','\x20days\x20without\x20payment\x20confirmation','COINTOPAY_STATUS_CHANGE','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','✅\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','🛑\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','status','24480jQmnEi','415788YfEGeN','💰\x20[CHECK]\x20Payment\x20','❌\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','🪙\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','PENDING','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','No\x20specific\x20commission\x20found\x20for\x20gateway\x20',',\x20gateway\x20','getTime','text','\x20\x20\x20-\x20gatewayPaymentId:\x20','✅\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','checkPaymentStatus','payment','sendShopWebhook','delete','103097kEVEBI','🛑\x20[SHUTDOWN]\x20Cleared\x20','paymentDetails','createdAt','\x20\x20\x20-\x20Status:\x20','checkSinglePayment','2886290QAhGDT','-day\x20timeout','stringify','❌\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','paymentLink','paymentTimers','\x20in\x20shop\x20','logWhiteDomainError','\x20days','COMPLETED','payment.pending','\x20individual\x20payment\x20timers','\x20status\x20is\x20','cointopay','findMany','44024QzpltU'];a42_0x22f2=function(){return _0x3a796b;};return a42_0x22f2();}Object['defineProperty'](exports,a42_0x4ce0f4(0x1f8),{'value':!![]}),exports[a42_0x4ce0f4(0x1f1)]=exports[a42_0x4ce0f4(0x28f)]=void 0x0;const coinToPayService_1=require(a42_0x4ce0f4(0x1e4)),coinToPay2Service_1=require(a42_0x4ce0f4(0x1fc)),gateway_1=require(a42_0x4ce0f4(0x25e)),database_1=__importDefault(require(a42_0x4ce0f4(0x204))),telegramBotService_1=require(a42_0x4ce0f4(0x273)),loggerService_1=require(a42_0x4ce0f4(0x299)),currencyService_1=require('./currencyService');function a42_0x198f(_0x3b46de,_0x166014){const _0x22f211=a42_0x22f2();return a42_0x198f=function(_0x198f95,_0x499e90){_0x198f95=_0x198f95-0x1a8;let _0x1368c=_0x22f211[_0x198f95];return _0x1368c;},a42_0x198f(_0x3b46de,_0x166014);}class CoinToPayStatusService{constructor(){const _0x8e73fb=a42_0x4ce0f4;this[_0x8e73fb(0x2b0)]=null,this[_0x8e73fb(0x28b)]=0x3c*0x3c*0x3e8,this[_0x8e73fb(0x1f2)]=0x5,this[_0x8e73fb(0x239)]=new Map(),this[_0x8e73fb(0x2ac)]=new coinToPayService_1[(_0x8e73fb(0x26a))](),this[_0x8e73fb(0x1e6)]=new coinToPay2Service_1[(_0x8e73fb(0x214))](),console[_0x8e73fb(0x261)](_0x8e73fb(0x2ae));}[a42_0x4ce0f4(0x288)](_0x47a77f,_0xe1477a){const _0x5dc11e=a42_0x4ce0f4;console['log'](_0x5dc11e(0x1ff)),console['log'](_0x5dc11e(0x2b3)+_0x47a77f),console['log'](_0x5dc11e(0x227)+_0xe1477a),this[_0x5dc11e(0x28c)](_0x47a77f);const _0x29252f=[],_0x4d3bbb=new Date(),_0x4814f8=[{'delay':0x1*0x3c*0x3e8,'description':'1\x20minute'},{'delay':0x2*0x3c*0x3e8,'description':_0x5dc11e(0x259)},{'delay':0x5*0x3c*0x3e8,'description':_0x5dc11e(0x1d2)},{'delay':0x5*0x3c*0x3e8,'description':_0x5dc11e(0x1d2)}];console[_0x5dc11e(0x261)](_0x5dc11e(0x1ec)+_0x4814f8[_0x5dc11e(0x275)]+_0x5dc11e(0x213)+_0x47a77f);let _0x39945a=0x0;_0x4814f8[_0x5dc11e(0x269)]((_0x390a08,_0x1dc1f1)=>{const _0x3c5132=_0x5dc11e;_0x39945a+=_0x390a08[_0x3c5132(0x1be)];const _0x1f5d06=setTimeout(async()=>{const _0x709b84=_0x3c5132;console[_0x709b84(0x261)]('🪙\x20[TIMER]\x20Individual\x20check\x20#'+(_0x1dc1f1+0x1)+_0x709b84(0x209)+_0x47a77f+'\x20(after\x20'+_0x390a08[_0x709b84(0x1ea)]+')');try{await this['checkSinglePaymentById'](_0x47a77f),console[_0x709b84(0x261)]('✅\x20[TIMER]\x20Individual\x20check\x20#'+(_0x1dc1f1+0x1)+_0x709b84(0x282)+_0x47a77f);}catch(_0x2f7808){console['error']('❌\x20[TIMER]\x20Failed\x20individual\x20check\x20#'+(_0x1dc1f1+0x1)+_0x709b84(0x280)+_0x47a77f+':',_0x2f7808),this[_0x709b84(0x289)](_0x47a77f,_0xe1477a,_0x2f7808,_0x709b84(0x1dd),{'checkNumber':_0x1dc1f1+0x1,'scheduledAfter':_0x390a08[_0x709b84(0x1ea)],'isIndividualCheck':!![]});}},_0x39945a);_0x29252f[_0x3c5132(0x1b8)](_0x1f5d06),console['log'](_0x3c5132(0x26f)+(_0x1dc1f1+0x1)+_0x3c5132(0x280)+_0x47a77f+_0x3c5132(0x248)+_0x39945a/0x3e8+'\x20seconds\x20('+_0x390a08['description']+')');});const _0x10bd1a=setInterval(async()=>{const _0x322f9f=_0x5dc11e;console[_0x322f9f(0x261)](_0x322f9f(0x1e9)+_0x47a77f);try{const _0x248529=await database_1[_0x322f9f(0x1c7)][_0x322f9f(0x22b)]['findUnique']({'where':{'id':_0x47a77f},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x248529){console[_0x322f9f(0x261)]('❌\x20[HOURLY]\x20Payment\x20'+_0x47a77f+'\x20not\x20found,\x20clearing\x20timers'),this[_0x322f9f(0x28c)](_0x47a77f);return;}console['log'](_0x322f9f(0x255)+_0x47a77f+_0x322f9f(0x1cc)+_0x248529['status']);if(_0x248529[_0x322f9f(0x21b)]!==_0x322f9f(0x221)){console['log']('✅\x20[HOURLY]\x20Payment\x20'+_0x47a77f+_0x322f9f(0x240)+_0x248529[_0x322f9f(0x21b)]+',\x20stopping\x20individual\x20checks'),this['clearPaymentTimers'](_0x47a77f);return;}const _0x268da0=Math[_0x322f9f(0x271)]((Date[_0x322f9f(0x1c5)]()-_0x248529[_0x322f9f(0x231)][_0x322f9f(0x225)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x268da0>=this[_0x322f9f(0x1f2)]){console[_0x322f9f(0x261)](_0x322f9f(0x2a2)+_0x47a77f+'\x20is\x20older\x20than\x20'+this[_0x322f9f(0x1f2)]+_0x322f9f(0x1d6)),this[_0x322f9f(0x28c)](_0x47a77f);return;}await this[_0x322f9f(0x28e)](_0x47a77f),console[_0x322f9f(0x261)]('✅\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20'+_0x47a77f);}catch(_0x2bd710){console[_0x322f9f(0x277)]('❌\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20'+_0x47a77f+':',_0x2bd710),this[_0x322f9f(0x289)](_0x47a77f,_0xe1477a,_0x2bd710,'status_check',{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x29252f[_0x5dc11e(0x1b8)](_0x10bd1a),this['paymentTimers'][_0x5dc11e(0x251)](_0x47a77f,{'timers':_0x29252f,'paymentId':_0x47a77f,'gatewayPaymentId':_0xe1477a,'createdAt':_0x4d3bbb}),console[_0x5dc11e(0x261)]('✅\x20[DEBUG]\x20Successfully\x20scheduled\x20'+_0x4814f8['length']+_0x5dc11e(0x29d)+_0x47a77f),console['log']('📊\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20'+this[_0x5dc11e(0x239)]['size']),this[_0x5dc11e(0x1cf)](_0x47a77f,_0xe1477a,_0x5dc11e(0x221),_0x5dc11e(0x221),_0x5dc11e(0x1dd),{'action':'schedule_created','scheduledChecks':_0x4814f8[_0x5dc11e(0x275)],'firstCheckIn':_0x4814f8[0x0]['delay']/0x3e8,'totalTimers':this['paymentTimers'][_0x5dc11e(0x2b1)]});}['clearPaymentTimers'](_0x2f955a){const _0x46d3aa=a42_0x4ce0f4,_0x3dbad5=this[_0x46d3aa(0x239)][_0x46d3aa(0x245)](_0x2f955a);_0x3dbad5?(console[_0x46d3aa(0x261)](_0x46d3aa(0x298)+_0x3dbad5[_0x46d3aa(0x285)][_0x46d3aa(0x275)]+_0x46d3aa(0x1d4)+_0x2f955a),_0x3dbad5['timers'][_0x46d3aa(0x269)]((_0x2f1391,_0x10f299)=>{const _0x4383c3=_0x46d3aa;_0x2f1391&&(clearTimeout(_0x2f1391),clearInterval(_0x2f1391),console[_0x4383c3(0x261)]('🧹\x20[DEBUG]\x20Cleared\x20timer\x20#'+(_0x10f299+0x1)+_0x4383c3(0x280)+_0x2f955a));}),this[_0x46d3aa(0x239)][_0x46d3aa(0x22d)](_0x2f955a),console[_0x46d3aa(0x261)](_0x46d3aa(0x228)+_0x2f955a+_0x46d3aa(0x26e)+this[_0x46d3aa(0x239)][_0x46d3aa(0x2b1)])):console[_0x46d3aa(0x261)](_0x46d3aa(0x279)+_0x2f955a+'\x20to\x20clear');}async[a42_0x4ce0f4(0x28e)](_0x2c1cbf){const _0x4c1a74=a42_0x4ce0f4;console['log'](_0x4c1a74(0x205)+_0x2c1cbf);const _0x127e09=await database_1['default'][_0x4c1a74(0x22b)]['findUnique']({'where':{'id':_0x2c1cbf},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x127e09){console[_0x4c1a74(0x261)](_0x4c1a74(0x29f)+_0x2c1cbf+_0x4c1a74(0x296));return;}console[_0x4c1a74(0x261)](_0x4c1a74(0x1af)+_0x2c1cbf+'\x20found:'),console[_0x4c1a74(0x261)]('\x20\x20\x20-\x20Gateway:\x20'+_0x127e09[_0x4c1a74(0x20f)]),console['log'](_0x4c1a74(0x232)+_0x127e09[_0x4c1a74(0x21b)]),console[_0x4c1a74(0x261)]('\x20\x20\x20-\x20GatewayPaymentId:\x20'+_0x127e09[_0x4c1a74(0x2a7)]),console[_0x4c1a74(0x261)](_0x4c1a74(0x27b)+_0x127e09[_0x4c1a74(0x24b)]+'\x20'+_0x127e09[_0x4c1a74(0x252)]),console[_0x4c1a74(0x261)](_0x4c1a74(0x1cb)+_0x127e09['shopId']);if(_0x127e09['gateway']!==_0x4c1a74(0x241)&&_0x127e09['gateway']!==_0x4c1a74(0x2a6)){console[_0x4c1a74(0x261)](_0x4c1a74(0x1c4)+_0x2c1cbf+_0x4c1a74(0x229)+_0x127e09['gateway']+')');return;}if(_0x127e09[_0x4c1a74(0x21b)]!==_0x4c1a74(0x221)){console['log']('⚠️\x20[CHECK]\x20Payment\x20'+_0x2c1cbf+'\x20status\x20is\x20'+_0x127e09[_0x4c1a74(0x21b)]+',\x20stopping\x20individual\x20checks'),this[_0x4c1a74(0x28c)](_0x2c1cbf);return;}if(!_0x127e09[_0x4c1a74(0x2a7)]){console['log'](_0x4c1a74(0x1c4)+_0x2c1cbf+_0x4c1a74(0x1fa));return;}console[_0x4c1a74(0x261)](_0x4c1a74(0x25c)+_0x2c1cbf+'\x20is\x20valid\x20for\x20checking,\x20proceeding...'),await this['checkSinglePayment'](_0x127e09);}['logCoinToPayStatus'](_0x43925a,_0x18bd34,_0x11f1d2,_0x110650,_0x334e84,_0x1dd5d4){const _0x4d3c6d=a42_0x4ce0f4,_0x7a6f2c={'type':_0x4d3c6d(0x217),'paymentId':_0x43925a,'gatewayPaymentId':_0x18bd34,'oldStatus':_0x11f1d2,'newStatus':_0x110650,'source':_0x334e84,'timestamp':new Date()['toISOString'](),'details':_0x1dd5d4||{}};loggerService_1[_0x4d3c6d(0x278)][_0x4d3c6d(0x1cf)](_0x7a6f2c),console[_0x4d3c6d(0x261)](_0x4d3c6d(0x27e)+_0x43925a+'\x20('+_0x18bd34+')'),console[_0x4d3c6d(0x261)](_0x4d3c6d(0x1c2)+_0x11f1d2+_0x4d3c6d(0x2a4)+_0x110650),console[_0x4d3c6d(0x261)](_0x4d3c6d(0x1aa)+_0x334e84),console[_0x4d3c6d(0x261)](_0x4d3c6d(0x244)+_0x7a6f2c[_0x4d3c6d(0x1fb)]),_0x1dd5d4&&console[_0x4d3c6d(0x261)](_0x4d3c6d(0x257),_0x1dd5d4);}[a42_0x4ce0f4(0x289)](_0x3f4002,_0x421f3e,_0x367b7a,_0x2f61f2,_0x226a01){const _0x3ade1d=a42_0x4ce0f4,_0x4695c9={'type':_0x3ade1d(0x1b7),'paymentId':_0x3f4002,'gatewayPaymentId':_0x421f3e,'error':_0x367b7a instanceof Error?{'message':_0x367b7a['message'],'stack':_0x367b7a[_0x3ade1d(0x262)]}:_0x367b7a,'source':_0x2f61f2,'timestamp':new Date()[_0x3ade1d(0x281)](),'context':_0x226a01||{}};loggerService_1[_0x3ade1d(0x278)][_0x3ade1d(0x289)](_0x4695c9),console[_0x3ade1d(0x277)](_0x3ade1d(0x203)+_0x3f4002+'\x20('+_0x421f3e+')'),console[_0x3ade1d(0x277)](_0x3ade1d(0x1ab)+(_0x367b7a instanceof Error?_0x367b7a[_0x3ade1d(0x1ce)]:_0x367b7a)),console[_0x3ade1d(0x277)](_0x3ade1d(0x1aa)+_0x2f61f2),console['error'](_0x3ade1d(0x244)+_0x4695c9[_0x3ade1d(0x1fb)]),_0x226a01&&console[_0x3ade1d(0x277)](_0x3ade1d(0x1c9),_0x226a01);}[a42_0x4ce0f4(0x1d5)](){const _0x283581=a42_0x4ce0f4;console[_0x283581(0x261)]('🪙\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)'),this[_0x283581(0x291)]()['catch'](_0x12d2c7=>{const _0x1c658c=_0x283581;console[_0x1c658c(0x277)]('❌\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:',_0x12d2c7);}),this[_0x283581(0x2b0)]=setInterval(async()=>{const _0x318063=_0x283581;try{console[_0x318063(0x261)](_0x318063(0x1f4)),await this[_0x318063(0x291)](),console[_0x318063(0x261)](_0x318063(0x1df));}catch(_0x5ce9a3){console[_0x318063(0x277)](_0x318063(0x237),_0x5ce9a3);}},this['GLOBAL_CHECK_INTERVAL_MS']),console['log']('✅\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)');}[a42_0x4ce0f4(0x1b2)](){const _0x3b2893=a42_0x4ce0f4;console['log'](_0x3b2893(0x1dc));this[_0x3b2893(0x2b0)]&&(clearInterval(this[_0x3b2893(0x2b0)]),this[_0x3b2893(0x2b0)]=null,console[_0x3b2893(0x261)](_0x3b2893(0x21a)));const _0xc69b0b=this[_0x3b2893(0x239)][_0x3b2893(0x2b1)];for(const [_0x25dea8]of this['paymentTimers']){this[_0x3b2893(0x28c)](_0x25dea8);}console[_0x3b2893(0x261)](_0x3b2893(0x22f)+_0xc69b0b+_0x3b2893(0x23f));}async['checkAllPendingPayments'](){const _0x5665c3=a42_0x4ce0f4;try{console[_0x5665c3(0x261)](_0x5665c3(0x220));const _0x532468=await database_1[_0x5665c3(0x1c7)][_0x5665c3(0x22b)][_0x5665c3(0x242)]({'where':{'gateway':{'in':[_0x5665c3(0x241),_0x5665c3(0x2a6)]},'status':_0x5665c3(0x221),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x5665c3(0x261)](_0x5665c3(0x20c)+_0x532468[_0x5665c3(0x275)]+'\x20pending\x20CoinToPay\x20payments');if(_0x532468['length']===0x0){console[_0x5665c3(0x261)](_0x5665c3(0x1ed));return;}const _0x34708a=await this[_0x5665c3(0x1f9)](_0x532468);console[_0x5665c3(0x261)](_0x5665c3(0x270)+_0x34708a[_0x5665c3(0x275)]+_0x5665c3(0x1bd));let _0x5d4f35=0x0,_0x38415d=0x0;for(const _0x225de7 of _0x532468){try{if(_0x34708a[_0x5665c3(0x1ae)](_0x225de7['id'])){console[_0x5665c3(0x261)](_0x5665c3(0x1e2)+_0x225de7['id']+_0x5665c3(0x218)),_0x38415d++;continue;}if(this[_0x5665c3(0x239)][_0x5665c3(0x200)](_0x225de7['id'])){console[_0x5665c3(0x261)](_0x5665c3(0x1e2)+_0x225de7['id']+_0x5665c3(0x1ee)),_0x38415d++;continue;}const _0x38d764=(Date[_0x5665c3(0x1c5)]()-_0x225de7[_0x5665c3(0x231)]['getTime']())/(0x3e8*0x3c*0x3c);if(_0x38d764<0x1){console[_0x5665c3(0x261)](_0x5665c3(0x1e2)+_0x225de7['id']+_0x5665c3(0x276)+_0x38d764[_0x5665c3(0x260)](0x1)+_0x5665c3(0x25f)),_0x38415d++;continue;}console[_0x5665c3(0x261)](_0x5665c3(0x264)+_0x225de7['id']+_0x5665c3(0x2aa)+_0x38d764[_0x5665c3(0x260)](0x1)+'h)'),await this[_0x5665c3(0x233)](_0x225de7),_0x5d4f35++,await new Promise(_0x4cfadf=>setTimeout(_0x4cfadf,0x7d0));}catch(_0x5c4edd){console[_0x5665c3(0x277)](_0x5665c3(0x1f0)+_0x225de7['id']+':',_0x5c4edd),this[_0x5665c3(0x289)](_0x225de7['id'],_0x225de7[_0x5665c3(0x2a7)]||'unknown',_0x5c4edd,'status_check',{'isGlobalCheck':!![],'paymentAmount':_0x225de7[_0x5665c3(0x24b)],'paymentCurrency':_0x225de7['currency'],'shopId':_0x225de7[_0x5665c3(0x1c1)],'createdAt':_0x225de7[_0x5665c3(0x231)]}),loggerService_1[_0x5665c3(0x278)][_0x5665c3(0x23b)](_0x5665c3(0x241),'/status/'+_0x225de7[_0x5665c3(0x2a7)],_0x5c4edd);}}console[_0x5665c3(0x261)](_0x5665c3(0x25a)+_0x5d4f35+_0x5665c3(0x263)+_0x38415d+_0x5665c3(0x293)+_0x34708a[_0x5665c3(0x275)]+_0x5665c3(0x215));}catch(_0x41f71a){console[_0x5665c3(0x277)](_0x5665c3(0x27d),_0x41f71a);}}async[a42_0x4ce0f4(0x1f9)](_0x26df79){const _0xfee122=a42_0x4ce0f4,_0x3589ac=[],_0x2b196f=new Date();_0x2b196f[_0xfee122(0x212)](_0x2b196f[_0xfee122(0x1eb)]()-this[_0xfee122(0x1f2)]),console[_0xfee122(0x261)]('⏰\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20'+this[_0xfee122(0x1f2)]+'\x20days\x20(created\x20before\x20'+_0x2b196f[_0xfee122(0x281)]()+')');for(const _0x153d0f of _0x26df79){if(_0x153d0f['createdAt']<_0x2b196f){console[_0xfee122(0x261)]('⏰\x20[EXPIRY]\x20Payment\x20'+_0x153d0f['id']+_0xfee122(0x1e7)+this[_0xfee122(0x1f2)]+_0xfee122(0x1db));try{this['logCoinToPayStatus'](_0x153d0f['id'],_0x153d0f[_0xfee122(0x2a7)]||_0xfee122(0x258),_0xfee122(0x221),_0xfee122(0x1d0),'auto_expire',{'reason':'Payment\x20older\x20than\x20'+this['EXPIRY_DAYS']+_0xfee122(0x23c),'createdAt':_0x153d0f[_0xfee122(0x231)],'daysSinceCreation':Math[_0xfee122(0x271)]((Date[_0xfee122(0x1c5)]()-_0x153d0f['createdAt'][_0xfee122(0x225)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x153d0f[_0xfee122(0x24b)],'paymentCurrency':_0x153d0f['currency'],'shopId':_0x153d0f['shopId']}),await database_1[_0xfee122(0x1c7)][_0xfee122(0x22b)]['update']({'where':{'id':_0x153d0f['id']},'data':{'status':'EXPIRED','updatedAt':new Date(),'adminNotes':_0xfee122(0x286)+this[_0xfee122(0x1f2)]+_0xfee122(0x216)}}),await database_1[_0xfee122(0x1c7)][_0xfee122(0x202)][_0xfee122(0x1e8)]({'data':{'paymentId':_0x153d0f['id'],'shopId':_0x153d0f[_0xfee122(0x1c1)],'event':_0xfee122(0x208),'statusCode':0xc8,'responseBody':JSON[_0xfee122(0x236)]({'reason':'Payment\x20older\x20than\x20'+this[_0xfee122(0x1f2)]+_0xfee122(0x23c),'createdAt':_0x153d0f[_0xfee122(0x231)],'expiredAt':new Date()[_0xfee122(0x281)](),'daysSinceCreation':Math['floor']((Date[_0xfee122(0x1c5)]()-_0x153d0f[_0xfee122(0x231)]['getTime']())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0xfee122(0x22c)](_0x153d0f,_0xfee122(0x1d0)),await this[_0xfee122(0x2a9)](_0x153d0f,_0xfee122(0x1d0)),this[_0xfee122(0x28c)](_0x153d0f['id']),_0x3589ac['push'](_0x153d0f['id']),console[_0xfee122(0x261)]('✅\x20[EXPIRY]\x20Payment\x20'+_0x153d0f['id']+_0xfee122(0x287)+this[_0xfee122(0x1f2)]+_0xfee122(0x235));}catch(_0x8ade6e){console[_0xfee122(0x277)](_0xfee122(0x21f)+_0x153d0f['id']+':',_0x8ade6e),this[_0xfee122(0x289)](_0x153d0f['id'],_0x153d0f['gatewayPaymentId']||_0xfee122(0x258),_0x8ade6e,'auto_expire',{'reason':_0xfee122(0x1d9),'createdAt':_0x153d0f['createdAt'],'daysSinceCreation':Math[_0xfee122(0x271)]((Date['now']()-_0x153d0f[_0xfee122(0x231)][_0xfee122(0x225)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x3589ac;}async[a42_0x4ce0f4(0x233)](_0x57675a){const _0x2650bc=a42_0x4ce0f4;if(!_0x57675a[_0x2650bc(0x2a7)]){console['log'](_0x2650bc(0x1c4)+_0x57675a['id']+_0x2650bc(0x20e));return;}console[_0x2650bc(0x261)](_0x2650bc(0x253)+_0x57675a[_0x2650bc(0x20f)]+_0x2650bc(0x290)+_0x57675a['id']+'\x20('+_0x57675a[_0x2650bc(0x2a7)]+')');try{let _0x34079a;_0x57675a[_0x2650bc(0x20f)]==='cointopay2'?(_0x34079a=await this[_0x2650bc(0x1e6)][_0x2650bc(0x22a)](_0x57675a[_0x2650bc(0x2a7)]),console[_0x2650bc(0x261)](_0x2650bc(0x25b)+_0x57675a['id']+_0x2650bc(0x1ef)+_0x34079a[_0x2650bc(0x21b)])):(_0x34079a=await this[_0x2650bc(0x2ac)][_0x2650bc(0x22a)](_0x57675a[_0x2650bc(0x2a7)]),console['log'](_0x2650bc(0x2ab)+_0x57675a['id']+_0x2650bc(0x1ef)+_0x34079a[_0x2650bc(0x21b)]));_0x34079a[_0x2650bc(0x230)]&&console[_0x2650bc(0x261)](_0x2650bc(0x1af)+_0x57675a['id']+_0x2650bc(0x1b6),{'iban':_0x34079a[_0x2650bc(0x230)][_0x2650bc(0x1de)]||_0x2650bc(0x1e3),'transactionId':_0x34079a['paymentDetails'][_0x2650bc(0x1c3)],'createdOn':_0x34079a[_0x2650bc(0x230)][_0x2650bc(0x1f5)],'confirmedOn':_0x34079a['paymentDetails'][_0x2650bc(0x1ba)]||_0x2650bc(0x256)});if(_0x34079a['status']!==_0x57675a[_0x2650bc(0x21b)]){console[_0x2650bc(0x261)](_0x2650bc(0x2b2)+_0x57675a['id']+_0x2650bc(0x254)+_0x57675a['status']+_0x2650bc(0x1ca)+_0x34079a[_0x2650bc(0x21b)]),this[_0x2650bc(0x1cf)](_0x57675a['id'],_0x57675a['gatewayPaymentId'],_0x57675a[_0x2650bc(0x21b)],_0x34079a[_0x2650bc(0x21b)],_0x2650bc(0x1dd),{'paymentDetails':_0x34079a[_0x2650bc(0x230)],'amount':_0x34079a[_0x2650bc(0x24b)],'currency':_0x34079a[_0x2650bc(0x252)],'shopId':_0x57675a[_0x2650bc(0x1c1)],'checkTimestamp':new Date()[_0x2650bc(0x281)]()});const _0x5e29e1={'status':_0x34079a[_0x2650bc(0x21b)],'updatedAt':new Date()};if(_0x34079a['status']==='PAID'&&_0x57675a[_0x2650bc(0x21b)]!==_0x2650bc(0x20a)){_0x5e29e1[_0x2650bc(0x247)]=new Date();if(!_0x57675a[_0x2650bc(0x2ad)]){const _0x3d5f5a=await currencyService_1[_0x2650bc(0x265)]['convertToUSDT'](_0x57675a['amount'],_0x57675a[_0x2650bc(0x252)]);_0x5e29e1[_0x2650bc(0x2ad)]=_0x3d5f5a;const _0x34ef29=await this[_0x2650bc(0x1c6)](_0x57675a[_0x2650bc(0x1c1)],_0x57675a[_0x2650bc(0x20f)]),_0x3b3173=_0x3d5f5a*(0x1-_0x34ef29/0x64);_0x5e29e1['amountAfterGatewayCommissionUSDT']=_0x3b3173,_0x5e29e1[_0x2650bc(0x1d3)]=_0x34ef29,console['log'](_0x2650bc(0x21e)+_0x57675a['id']+'\x20amounts\x20calculated:'),console[_0x2650bc(0x261)](_0x2650bc(0x1ad)+_0x57675a[_0x2650bc(0x24b)]+'\x20'+_0x57675a[_0x2650bc(0x252)]+_0x2650bc(0x2a4)+_0x3d5f5a[_0x2650bc(0x260)](0x6)+_0x2650bc(0x1cd)),console[_0x2650bc(0x261)]('\x20\x20\x20Gateway\x20'+_0x57675a[_0x2650bc(0x20f)]+'\x20commission:\x20'+_0x34ef29+'%'),console[_0x2650bc(0x261)](_0x2650bc(0x292)+_0x3b3173['toFixed'](0x6)+_0x2650bc(0x1cd));}console['log'](_0x2650bc(0x21e)+_0x57675a['id']+_0x2650bc(0x1e5)+_0x5e29e1[_0x2650bc(0x247)][_0x2650bc(0x281)]());}if(_0x34079a['paymentDetails']){const _0x4613c4=_0x34079a[_0x2650bc(0x230)];_0x4613c4[_0x2650bc(0x1de)]&&(_0x5e29e1[_0x2650bc(0x246)]=_0x4613c4[_0x2650bc(0x1de)],console[_0x2650bc(0x261)]('🏦\x20[CHECK]\x20Saved\x20IBAN:\x20'+_0x4613c4[_0x2650bc(0x1de)]));if(_0x4613c4[_0x2650bc(0x29a)]){const _0x1fe7f8=_0x57675a['adminNotes']||'',_0x44f63c=_0x2650bc(0x24c)+_0x4613c4[_0x2650bc(0x29a)];_0x5e29e1[_0x2650bc(0x201)]=_0x1fe7f8?_0x1fe7f8+'\x0a\x0a'+_0x44f63c:_0x44f63c,console[_0x2650bc(0x261)](_0x2650bc(0x1a9));}_0x4613c4[_0x2650bc(0x1c3)]&&console[_0x2650bc(0x261)](_0x2650bc(0x2a0)+_0x4613c4[_0x2650bc(0x1c3)]),_0x4613c4['confirmedOn']&&console['log'](_0x2650bc(0x219)+_0x4613c4['confirmedOn']);}await database_1['default'][_0x2650bc(0x22b)][_0x2650bc(0x297)]({'where':{'id':_0x57675a['id']},'data':_0x5e29e1});if(_0x34079a[_0x2650bc(0x21b)]===_0x2650bc(0x20a)&&_0x57675a[_0x2650bc(0x21b)]!=='PAID'){console[_0x2650bc(0x261)]('📈\x20[COINTOPAY]\x20Payment\x20'+_0x57675a['id']+'\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link');const _0x42eefd=await database_1[_0x2650bc(0x1c7)][_0x2650bc(0x22b)]['findUnique']({'where':{'id':_0x57675a['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x42eefd?.[_0x2650bc(0x1bf)]&&_0x42eefd[_0x2650bc(0x238)])try{const _0x343251=_0x42eefd[_0x2650bc(0x238)];console['log'](_0x2650bc(0x24f)+_0x343251['id']+':\x20type='+_0x343251['type']+_0x2650bc(0x1da)+_0x343251[_0x2650bc(0x24a)]+_0x2650bc(0x2af)+_0x343251['status']);const _0x3f4953=_0x343251[_0x2650bc(0x24a)]+0x1,_0x141f8a=_0x343251['type']===_0x2650bc(0x274)?_0x2650bc(0x23d):_0x343251[_0x2650bc(0x21b)];await database_1['default']['paymentLink'][_0x2650bc(0x297)]({'where':{'id':_0x343251['id']},'data':{'currentPayments':_0x3f4953,'status':_0x141f8a,'updatedAt':new Date()}}),console['log']('✅\x20[COINTOPAY]\x20Payment\x20link\x20'+_0x343251['id']+'\x20updated:\x20currentPayments='+_0x343251[_0x2650bc(0x24a)]+'\x20->\x20'+_0x3f4953+',\x20status='+_0x343251[_0x2650bc(0x21b)]+_0x2650bc(0x2a4)+_0x141f8a);}catch(_0x212e18){console['error'](_0x2650bc(0x26b),_0x212e18);}else console[_0x2650bc(0x261)](_0x2650bc(0x250)+_0x57675a['id']+_0x2650bc(0x1d7));}await database_1['default']['webhookLog'][_0x2650bc(0x1e8)]({'data':{'paymentId':_0x57675a['id'],'shopId':_0x57675a[_0x2650bc(0x1c1)],'event':_0x2650bc(0x1e1)+_0x34079a[_0x2650bc(0x21b)][_0x2650bc(0x26c)](),'statusCode':0xc8,'responseBody':JSON[_0x2650bc(0x236)]({'oldStatus':_0x57675a[_0x2650bc(0x21b)],'newStatus':_0x34079a['status'],'paymentDetails':_0x34079a[_0x2650bc(0x230)],'checkedAt':new Date()[_0x2650bc(0x281)]()})}}),await this['sendShopWebhook'](_0x57675a,_0x34079a[_0x2650bc(0x21b)]),await this[_0x2650bc(0x2a9)](_0x57675a,_0x34079a[_0x2650bc(0x21b)]),_0x34079a['status']!==_0x2650bc(0x221)&&(console[_0x2650bc(0x261)](_0x2650bc(0x1f6)+_0x57675a['id']+_0x2650bc(0x1d8)+_0x34079a[_0x2650bc(0x21b)]+_0x2650bc(0x20b)),this[_0x2650bc(0x28c)](_0x57675a['id'])),console['log'](_0x2650bc(0x25c)+_0x57675a['id']+_0x2650bc(0x2a1));}else console['log']('📊\x20[CHECK]\x20Payment\x20'+_0x57675a['id']+'\x20status\x20unchanged\x20('+_0x34079a['status']+')'),this['logCoinToPayStatus'](_0x57675a['id'],_0x57675a[_0x2650bc(0x2a7)],_0x57675a[_0x2650bc(0x21b)],_0x34079a[_0x2650bc(0x21b)],_0x2650bc(0x1dd),{'statusUnchanged':!![],'paymentDetails':_0x34079a['paymentDetails'],'amount':_0x34079a[_0x2650bc(0x24b)],'currency':_0x34079a[_0x2650bc(0x252)],'shopId':_0x57675a['shopId'],'checkTimestamp':new Date()[_0x2650bc(0x281)]()});}catch(_0x27a9ae){console[_0x2650bc(0x277)](_0x2650bc(0x1b1)+_0x57675a['id']+':',_0x27a9ae),this[_0x2650bc(0x289)](_0x57675a['id'],_0x57675a[_0x2650bc(0x2a7)],_0x27a9ae,_0x2650bc(0x1dd),{'paymentAmount':_0x57675a[_0x2650bc(0x24b)],'paymentCurrency':_0x57675a['currency'],'shopId':_0x57675a[_0x2650bc(0x1c1)],'createdAt':_0x57675a['createdAt']}),await database_1['default'][_0x2650bc(0x202)][_0x2650bc(0x1e8)]({'data':{'paymentId':_0x57675a['id'],'shopId':_0x57675a[_0x2650bc(0x1c1)],'event':_0x2650bc(0x1c8),'statusCode':0x1f4,'responseBody':JSON['stringify']({'error':_0x27a9ae instanceof Error?_0x27a9ae[_0x2650bc(0x1ce)]:_0x2650bc(0x1bc),'gatewayPaymentId':_0x57675a['gatewayPaymentId'],'checkedAt':new Date()[_0x2650bc(0x281)]()})}});}}async['sendShopWebhook'](_0x30c00b,_0x18c578){const _0x431adb=a42_0x4ce0f4,_0x3a34af=Date[_0x431adb(0x1c5)]();try{const _0xc7693a=_0x30c00b[_0x431adb(0x1a8)],_0x1eec39=_0xc7693a[_0x431adb(0x284)];if(!_0x1eec39?.[_0x431adb(0x206)]){console['log'](_0x431adb(0x283)+_0xc7693a['id']);return;}const _0x3e8238=_0x18c578===_0x431adb(0x20a)?_0x431adb(0x24d):_0x18c578==='FAILED'?_0x431adb(0x266):_0x18c578===_0x431adb(0x1d0)?'payment.failed':_0x431adb(0x23e);if(!_0x1eec39['webhookEvents']?.[_0x431adb(0x1ae)](_0x3e8238)){console['log'](_0x431adb(0x210)+_0x3e8238+'\x20not\x20enabled\x20for\x20shop\x20'+_0xc7693a['id']);return;}const _0x3993a4=(0x0,gateway_1[_0x431adb(0x1b4)])(_0x30c00b[_0x431adb(0x20f)])||_0x30c00b[_0x431adb(0x20f)],_0x5eb6e6={'event':_0x3e8238,'payment':{'id':_0x30c00b['id'],'order_id':_0x30c00b['orderId'],'gateway_order_id':_0x30c00b[_0x431adb(0x29b)],'gateway':_0x3993a4,'amount':_0x30c00b['amount'],'currency':_0x30c00b['currency'],'status':_0x18c578[_0x431adb(0x26c)](),'customer_email':_0x30c00b[_0x431adb(0x1f7)],'customer_name':_0x30c00b[_0x431adb(0x27c)],'created_at':_0x30c00b['createdAt'],'updated_at':new Date()}},_0x14e2b4=await fetch(_0x1eec39[_0x431adb(0x206)],{'method':_0x431adb(0x27a),'headers':{'Content-Type':_0x431adb(0x1d1),'User-Agent':_0x431adb(0x294)},'body':JSON[_0x431adb(0x236)](_0x5eb6e6)}),_0x1f3acc=Date[_0x431adb(0x1c5)]()-_0x3a34af,_0x536a12=_0x14e2b4['ok']?_0x431adb(0x1bb):await _0x14e2b4[_0x431adb(0x226)]();loggerService_1['loggerService']['logShopWebhookSent'](_0x30c00b[_0x431adb(0x1c1)],_0x1eec39['webhookUrl'],_0x3e8238,_0x14e2b4['status'],_0x1f3acc,_0x5eb6e6),console['log']('Shop\x20webhook\x20sent\x20to\x20'+_0x1eec39[_0x431adb(0x206)]+_0x431adb(0x1f3)+_0x14e2b4['status']+'\x20('+_0x1f3acc+'ms)');}catch(_0x522cd4){console[_0x431adb(0x277)](_0x431adb(0x26d),_0x522cd4),loggerService_1[_0x431adb(0x278)]['logShopWebhookError'](_0x30c00b[_0x431adb(0x1c1)],_0x30c00b['shop']?.[_0x431adb(0x284)]?.['webhookUrl']||'unknown',_0x431adb(0x267),_0x522cd4,{});}}async[a42_0x4ce0f4(0x2a9)](_0xfcae27,_0x420261){const _0x35ba1f=a42_0x4ce0f4;try{const _0xa359a1={'PENDING':_0x35ba1f(0x29c),'PAID':_0x35ba1f(0x1b3),'FAILED':'failed','EXPIRED':_0x35ba1f(0x28d)},_0x5d35ad=_0xa359a1[_0x420261];if(!_0x5d35ad||_0x5d35ad===_0x35ba1f(0x29c))return;await telegramBotService_1[_0x35ba1f(0x295)][_0x35ba1f(0x1b0)](_0xfcae27['shopId'],_0xfcae27,_0x5d35ad);}catch(_0x3c2640){console[_0x35ba1f(0x277)](_0x35ba1f(0x29e),_0x3c2640);}}async['checkPaymentById'](_0x20c793){const _0x21db59=a42_0x4ce0f4;console[_0x21db59(0x261)](_0x21db59(0x25d)+_0x20c793);const _0x3a04b5=await database_1[_0x21db59(0x1c7)][_0x21db59(0x22b)]['findUnique']({'where':{'id':_0x20c793},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x3a04b5)throw new Error('Payment\x20not\x20found');if(_0x3a04b5[_0x21db59(0x20f)]!=='cointopay'&&_0x3a04b5[_0x21db59(0x20f)]!=='cointopay2')throw new Error('Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment');console[_0x21db59(0x261)](_0x21db59(0x2a3)+_0x3a04b5[_0x21db59(0x20f)]+_0x21db59(0x290)+_0x20c793),await this[_0x21db59(0x233)](_0x3a04b5),console[_0x21db59(0x261)](_0x21db59(0x1b9)+_0x20c793);}[a42_0x4ce0f4(0x268)](){const _0x2c2b8c=a42_0x4ce0f4,_0x10ff7e=this[_0x2c2b8c(0x2b0)]?this[_0x2c2b8c(0x28b)]:undefined,_0x54afb5=Array[_0x2c2b8c(0x249)](this['paymentTimers'][_0x2c2b8c(0x2a8)]())[_0x2c2b8c(0x28a)](_0x561771=>({'paymentId':_0x561771['paymentId'],'gatewayPaymentId':_0x561771[_0x2c2b8c(0x2a7)],'createdAt':_0x561771['createdAt'],'timersCount':_0x561771['timers'][_0x2c2b8c(0x275)]}));return{'isActive':!!this[_0x2c2b8c(0x2b0)],'globalCheckIntervalMinutes':this[_0x2c2b8c(0x28b)]/(0x3e8*0x3c),'expiryDays':this[_0x2c2b8c(0x1f2)],'activeIndividualTimers':this['paymentTimers'][_0x2c2b8c(0x2b1)],'nextGlobalCheckIn':_0x10ff7e,'paymentTimersDetails':_0x54afb5};}[a42_0x4ce0f4(0x20d)](_0x3c2417){const _0x3f030e=a42_0x4ce0f4,_0x3177ee=this[_0x3f030e(0x239)][_0x3f030e(0x245)](_0x3c2417);if(_0x3177ee)return{'hasTimers':!![],'timersCount':_0x3177ee[_0x3f030e(0x285)][_0x3f030e(0x275)],'createdAt':_0x3177ee[_0x3f030e(0x231)],'gatewayPaymentId':_0x3177ee[_0x3f030e(0x2a7)]};return{'hasTimers':![]};}async[a42_0x4ce0f4(0x1c6)](_0x36198b,_0x2d858e){const _0x3d08db=a42_0x4ce0f4;try{const _0x37d399=await database_1[_0x3d08db(0x1c7)][_0x3d08db(0x1a8)]['findUnique']({'where':{'id':_0x36198b},'select':{'gatewaySettings':!![]}});if(!_0x37d399?.[_0x3d08db(0x1fd)])return console[_0x3d08db(0x261)]('No\x20gateway\x20settings\x20found\x20for\x20shop\x20'+_0x36198b+',\x20using\x20default\x20commission\x2010%'),0xa;const _0x4f76b8=JSON[_0x3d08db(0x1e0)](_0x37d399[_0x3d08db(0x1fd)]);for(const [_0x2a7e63,_0x2801da]of Object['entries'](_0x4f76b8)){if(_0x2a7e63[_0x3d08db(0x26c)]()===_0x2d858e[_0x3d08db(0x26c)]()){const _0x5f2ad3=_0x2801da[_0x3d08db(0x1ac)]||0xa;return console[_0x3d08db(0x261)](_0x3d08db(0x2a5)+_0x2d858e+_0x3d08db(0x272)+_0x36198b+':\x20'+_0x5f2ad3+'%'),_0x5f2ad3;}}return console['log'](_0x3d08db(0x223)+_0x2d858e+_0x3d08db(0x23a)+_0x36198b+_0x3d08db(0x211)),0xa;}catch(_0x174f91){return console[_0x3d08db(0x277)](_0x3d08db(0x222)+_0x36198b+_0x3d08db(0x224)+_0x2d858e+':',_0x174f91),0xa;}}}exports['CoinToPayStatusService']=CoinToPayStatusService,exports[a42_0x4ce0f4(0x1f1)]=new CoinToPayStatusService();