'use strict';function a54_0x518a(){const _0x436a5b=['now','getGatewayCommission','‚ùå\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','ü™ô\x20[TIMER]\x20Individual\x20check\x20#','hex','üìä\x20[CHECK]\x20CoinToPay\x20payment\x20','6lForSm','defineProperty','‚úÖ\x20[EXPIRY]\x20Payment\x20','createdAt','POST','‚úÖ\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','COINTOPAY_STATUS_CHANGE','‚úÖ\x20[TIMER]\x20Individual\x20check\x20#','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','.\x20Remaining\x20active\x20timers:\x20','amount','\x20with\x20status\x20','description','üìä\x20[CHECK]\x20Payment\x20','FAILED','üîç\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','646224VOaFsU','gateway','üîÑ\x20[CHECK]\x20Updating\x20payment\x20','‚úÖ\x20[CHECK]\x20Payment\x20','üìä\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','ü™ô\x20[DEBUG]\x20Creating\x20','./currencyService','ü™ô\x20[GLOBAL]\x20Found\x20','\x20to\x20','clearPaymentTimers','\x20seconds\x20(','Payment\x20older\x20than\x20','\x20triggered\x20for\x20payment\x20','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','‚è∞\x20[GLOBAL]\x20Payment\x20','\x20days,\x20marking\x20as\x20EXPIRED','paymentTimers','sendPaymentNotification','checkAllPendingPayments','üè¶\x20[CHECK]\x20Bank\x20details\x20provided:\x20','‚è∞\x20[DEBUG]\x20Scheduled\x20check\x20#',',\x20using\x20default\x20commission\x2010%',',\x20gateway\x20','crypto','Unknown\x20error','toISOString','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','delay','commission','cointopay_auto_expired','./loggerService','expired','telegramBotService','ü™ô\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','\x20updated:\x20currentPayments=','catch',',\x20clearing\x20individual\x20timers','default','logWhiteDomainError','ü™ô\x20[ERROR]\x20CoinToPay\x20Error:\x20','logCoinToPayStatus','\x20->\x20','üí∞\x20[CHECK]\x20Payment\x20','checkSinglePaymentById','ü™ô\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','‚úÖ\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','webhookLog','timestamp','error','globalCheckInterval','shop','stack','h),\x20skipping\x20global\x20check','2\x20minutes','\x20status\x20changed\x20to\x20',',\x20status=','has','348SxJrSU','\x20\x20\x20-\x20gatewayPaymentId:\x20','toFixed','üßπ\x20[DEBUG]\x20Clearing\x20','\x20is\x20valid\x20for\x20checking,\x20proceeding...','\x20\x20\x20Gateway\x20','Success','created','ü™ô\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','\x20updated\x20successfully','cointopay_status_check_','üîç\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','currentPayments','\x20payment\x20','set','floor','startPeriodicStatusCheck','paymentDetails','unknown','payment','createHmac','get','gatewayCommissionRate','ü™ô\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','\x20USDT','cointopay','54jbIVlO','coinToPayStatusService','payment.failed','‚ö†Ô∏è\x20[CHECK]\x20Payment\x20','\x20timers\x20for\x20payment\x20','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','\x20marked\x20as\x20paid\x20at:\x20','log','logCoinToPayError','\x20days','payment.success','üÜî\x20[CHECK]\x20Transaction\x20ID:\x20','size','coinToPay2Service','not\x20found','‚úÖ\x20[DEBUG]\x20Successfully\x20scheduled\x20','EXPIRY_DAYS','remitterIban','‚úÖ\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','821250KBBawP','\x20skipped,\x20','\x20found:','\x20\x20\x20Amount\x20after\x20commission:\x20','create','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','5460575ZqxVHl','type','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','‚úÖ\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','\x20initial\x20timers\x20for\x20payment\x20','checkPaymentStatus','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','checkSinglePayment','PAID','gatewayOrderId','amountUSDT','\x20\x20\x20‚ùå\x20Error:\x20','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','customerName','getServiceStats','gatewayPaymentId','-day\x20timeout','\x20commission:\x20','update','\x20status:\x20','status','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','\x20\x20\x20-\x20Gateway:\x20','\x20individual\x20payment\x20timers','shopId','currencyService','‚úÖ\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','üìà\x20[COINTOPAY]\x20Payment\x20','stringify','parse','\x20details:','\x20\x20\x20üìÖ\x20Time:\x20','iban','3282RXoWdN','‚ùå\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','createdOn','getPaymentTimerInfo',',\x20using\x20default\x2010%','\x20\x20\x20üìä\x20Status:\x20','üîç\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','auto_expire','CoinToPay2Service','ü™ô\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','length','cointopay_status_check_error','‚è∞\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','‚ùå\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','ü™ô\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','‚ùå\x20[CHECK]\x20Payment\x20','Webhook\x20event\x20','setDate','orderId','üõë\x20[SHUTDOWN]\x20Cleared\x20','not\x20confirmed','message','bankDetails','timers','secretKey','\x20pending\x20CoinToPay\x20payments','\x20has\x20no\x20gatewayPaymentId','push','sendShopWebhook','\x20\x20\x20-\x20paymentId:\x20','getTime','payment.pending','\x20in\x20shop\x20','\x20\x20\x20-\x20ShopId:\x20','\x20amounts\x20calculated:','paymentId','loggerService','COMPLETED','Failed\x20to\x20send\x20shop\x20webhook:','paid','\x20current\x20status:\x20','‚ö†Ô∏è\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','üìä\x20[HOURLY]\x20Payment\x20','toLowerCase','ü™ô\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','confirmedOn','\x20\x20\x20-\x20GatewayPaymentId:\x20','sendPaymentStatusNotification','‚è∞\x20[HOURLY]\x20Payment\x20','findUnique','__esModule','\x20\x20\x20üìù\x20Details:','coinToPayService','schedulePaymentChecks','text',',\x20currentPayments=','delete','from','\x20completed\x20for\x20payment\x20','\x20\x20\x20üìç\x20Source:\x20','‚ùå\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','üîç\x20[CHECK]\x20Checking\x20',',\x20stopping\x20individual\x20checks','checkExpiredPayments','CoinToPayStatusService','logShopWebhookSent','\x20(age:\x20','customerEmail','19379AwAIFV','No\x20specific\x20commission\x20found\x20for\x20gateway\x20','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','__importDefault','üßπ\x20[CHECK]\x20Payment\x20','CoinToPayService','map','stopPeriodicStatusCheck','\x20(after\x20','32vkuuAL','14766785jXHEbL','findMany','logShopWebhookError','\x20\x20\x20üìù\x20Context:','\x20status\x20from\x20','‚ùå\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','\x20status\x20is\x20','PENDING','üìä\x20[CHECK]\x20CoinToPay2\x20payment\x20','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','settings','24557796ZcKnxN','forEach','Payment\x20not\x20found','98LUGKFo','gatewaySettings','ü™ô\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','\x20for\x20payment\x20','paymentLink','üõë\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','5\x20minutes','status_check','COINTOPAY_ERROR','\x20to\x20clear','transactionId','amountAfterGatewayCommissionUSDT','webhook_send','EXPIRED','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','\x20\x20\x20-\x20Status:\x20','webhookUrl','cointopay2','GLOBAL_CHECK_INTERVAL_MS','entries','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','includes','/status/','sha256','getGatewayIdByName','currency','\x20is\x20older\x20than\x20'];a54_0x518a=function(){return _0x436a5b;};return a54_0x518a();}const a54_0x1f0bba=a54_0x56b6;(function(_0x5f2568,_0x266aeb){const _0x2e16b7=a54_0x56b6,_0x4ab608=_0x5f2568();while(!![]){try{const _0x41a8da=parseInt(_0x2e16b7(0x17d))/0x1*(-parseInt(_0x2e16b7(0x186))/0x2)+-parseInt(_0x2e16b7(0x253))/0x3*(-parseInt(_0x2e16b7(0x1ff))/0x4)+-parseInt(_0x2e16b7(0x232))/0x5*(-parseInt(_0x2e16b7(0x1b6))/0x6)+-parseInt(_0x2e16b7(0x195))/0x7*(-parseInt(_0x2e16b7(0x1c6))/0x8)+parseInt(_0x2e16b7(0x219))/0x9*(-parseInt(_0x2e16b7(0x22c))/0xa)+parseInt(_0x2e16b7(0x187))/0xb+-parseInt(_0x2e16b7(0x192))/0xc;if(_0x41a8da===_0x266aeb)break;else _0x4ab608['push'](_0x4ab608['shift']());}catch(_0x3850ff){_0x4ab608['push'](_0x4ab608['shift']());}}}(a54_0x518a,0xc613b));function a54_0x56b6(_0x14139e,_0x17db4f){_0x14139e=_0x14139e-0x146;const _0x518a92=a54_0x518a();let _0x56b602=_0x518a92[_0x14139e];return _0x56b602;}var __importDefault=this&&this[a54_0x1f0bba(0x180)]||function(_0x1e2c3e){const _0x280389=a54_0x1f0bba;return _0x1e2c3e&&_0x1e2c3e[_0x280389(0x16b)]?_0x1e2c3e:{'default':_0x1e2c3e};};Object[a54_0x1f0bba(0x1b7)](exports,a54_0x1f0bba(0x16b),{'value':!![]}),exports[a54_0x1f0bba(0x21a)]=exports[a54_0x1f0bba(0x179)]=void 0x0;const crypto_1=__importDefault(require(a54_0x1f0bba(0x1dd))),coinToPayService_1=require('./gateways/coinToPayService'),coinToPay2Service_1=require('./gateways/coinToPay2Service'),gateway_1=require('../types/gateway'),database_1=__importDefault(require('../config/database')),telegramBotService_1=require('./telegramBotService'),loggerService_1=require(a54_0x1f0bba(0x1e4)),currencyService_1=require(a54_0x1f0bba(0x1cc));class CoinToPayStatusService{constructor(){const _0x513dd9=a54_0x1f0bba;this[_0x513dd9(0x1f7)]=null,this[_0x513dd9(0x1a7)]=0x3c*0x3c*0x3e8,this[_0x513dd9(0x229)]=0x5,this[_0x513dd9(0x1d6)]=new Map(),this[_0x513dd9(0x16d)]=new coinToPayService_1[(_0x513dd9(0x182))](),this[_0x513dd9(0x226)]=new coinToPay2Service_1[(_0x513dd9(0x25b))](),console[_0x513dd9(0x220)](_0x513dd9(0x197));}[a54_0x1f0bba(0x16e)](_0x4afad1,_0x46059d){const _0x117c67=a54_0x1f0bba;console[_0x117c67(0x220)](_0x117c67(0x165)),console[_0x117c67(0x220)](_0x117c67(0x156)+_0x4afad1),console[_0x117c67(0x220)](_0x117c67(0x200)+_0x46059d),this[_0x117c67(0x1cf)](_0x4afad1);const _0x2123a7=[],_0x4d37ca=new Date(),_0x21d0f6=[{'delay':0x1*0x3c*0x3e8,'description':'1\x20minute'},{'delay':0x2*0x3c*0x3e8,'description':_0x117c67(0x1fb)},{'delay':0x5*0x3c*0x3e8,'description':_0x117c67(0x19b)},{'delay':0x5*0x3c*0x3e8,'description':_0x117c67(0x19b)}];console['log'](_0x117c67(0x1cb)+_0x21d0f6[_0x117c67(0x25d)]+_0x117c67(0x236)+_0x4afad1);let _0x10a394=0x0;_0x21d0f6[_0x117c67(0x193)]((_0x4ecf71,_0x19249a)=>{const _0x151158=_0x117c67;_0x10a394+=_0x4ecf71[_0x151158(0x1e1)];const _0x3de4f4=setTimeout(async()=>{const _0xafd0a1=_0x151158;console[_0xafd0a1(0x220)](_0xafd0a1(0x1b3)+(_0x19249a+0x1)+_0xafd0a1(0x1d2)+_0x4afad1+_0xafd0a1(0x185)+_0x4ecf71[_0xafd0a1(0x1c2)]+')');try{await this[_0xafd0a1(0x1f1)](_0x4afad1),console['log'](_0xafd0a1(0x1bd)+(_0x19249a+0x1)+_0xafd0a1(0x173)+_0x4afad1);}catch(_0x36626f){console[_0xafd0a1(0x1f6)]('‚ùå\x20[TIMER]\x20Failed\x20individual\x20check\x20#'+(_0x19249a+0x1)+_0xafd0a1(0x198)+_0x4afad1+':',_0x36626f),this[_0xafd0a1(0x221)](_0x4afad1,_0x46059d,_0x36626f,'status_check',{'checkNumber':_0x19249a+0x1,'scheduledAfter':_0x4ecf71[_0xafd0a1(0x1c2)],'isIndividualCheck':!![]});}},_0x10a394);_0x2123a7[_0x151158(0x154)](_0x3de4f4),console[_0x151158(0x220)](_0x151158(0x1da)+(_0x19249a+0x1)+_0x151158(0x198)+_0x4afad1+'\x20in\x20'+_0x10a394/0x3e8+_0x151158(0x1d0)+_0x4ecf71[_0x151158(0x1c2)]+')');});const _0x25c00a=setInterval(async()=>{const _0x14e36a=_0x117c67;console[_0x14e36a(0x220)](_0x14e36a(0x207)+_0x4afad1);try{const _0x740956=await database_1['default'][_0x14e36a(0x212)][_0x14e36a(0x16a)]({'where':{'id':_0x4afad1},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x740956){console[_0x14e36a(0x220)]('‚ùå\x20[HOURLY]\x20Payment\x20'+_0x4afad1+'\x20not\x20found,\x20clearing\x20timers'),this[_0x14e36a(0x1cf)](_0x4afad1);return;}console[_0x14e36a(0x220)](_0x14e36a(0x163)+_0x4afad1+_0x14e36a(0x161)+_0x740956['status']);if(_0x740956[_0x14e36a(0x246)]!==_0x14e36a(0x18e)){console[_0x14e36a(0x220)]('‚úÖ\x20[HOURLY]\x20Payment\x20'+_0x4afad1+'\x20status\x20is\x20'+_0x740956[_0x14e36a(0x246)]+',\x20stopping\x20individual\x20checks'),this[_0x14e36a(0x1cf)](_0x4afad1);return;}const _0x41a540=Math[_0x14e36a(0x20e)]((Date[_0x14e36a(0x1b0)]()-_0x740956[_0x14e36a(0x1b9)]['getTime']())/(0x3e8*0x3c*0x3c*0x18));if(_0x41a540>=this[_0x14e36a(0x229)]){console[_0x14e36a(0x220)](_0x14e36a(0x169)+_0x4afad1+_0x14e36a(0x1af)+this['EXPIRY_DAYS']+_0x14e36a(0x17f)),this[_0x14e36a(0x1cf)](_0x4afad1);return;}await this[_0x14e36a(0x1f1)](_0x4afad1),console[_0x14e36a(0x220)]('‚úÖ\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20'+_0x4afad1);}catch(_0x213b6a){console[_0x14e36a(0x1f6)](_0x14e36a(0x146)+_0x4afad1+':',_0x213b6a),this['logCoinToPayError'](_0x4afad1,_0x46059d,_0x213b6a,_0x14e36a(0x19c),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x2123a7['push'](_0x25c00a),this['paymentTimers'][_0x117c67(0x20d)](_0x4afad1,{'timers':_0x2123a7,'paymentId':_0x4afad1,'gatewayPaymentId':_0x46059d,'createdAt':_0x4d37ca}),console['log'](_0x117c67(0x228)+_0x21d0f6['length']+'\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20'+_0x4afad1),console[_0x117c67(0x220)](_0x117c67(0x1ca)+this[_0x117c67(0x1d6)][_0x117c67(0x225)]),this[_0x117c67(0x1ee)](_0x4afad1,_0x46059d,_0x117c67(0x18e),'PENDING',_0x117c67(0x19c),{'action':'schedule_created','scheduledChecks':_0x21d0f6['length'],'firstCheckIn':_0x21d0f6[0x0]['delay']/0x3e8,'totalTimers':this[_0x117c67(0x1d6)][_0x117c67(0x225)]});}[a54_0x1f0bba(0x1cf)](_0x1778d1){const _0x3bc164=a54_0x1f0bba,_0x585606=this['paymentTimers'][_0x3bc164(0x214)](_0x1778d1);_0x585606?(console[_0x3bc164(0x220)](_0x3bc164(0x202)+_0x585606['timers']['length']+_0x3bc164(0x21d)+_0x1778d1),_0x585606[_0x3bc164(0x150)][_0x3bc164(0x193)]((_0x29997a,_0x470fe2)=>{const _0x140472=_0x3bc164;_0x29997a&&(clearTimeout(_0x29997a),clearInterval(_0x29997a),console[_0x140472(0x220)]('üßπ\x20[DEBUG]\x20Cleared\x20timer\x20#'+(_0x470fe2+0x1)+_0x140472(0x198)+_0x1778d1));}),this['paymentTimers'][_0x3bc164(0x171)](_0x1778d1),console[_0x3bc164(0x220)](_0x3bc164(0x1bb)+_0x1778d1+_0x3bc164(0x1bf)+this[_0x3bc164(0x1d6)][_0x3bc164(0x225)])):console['log'](_0x3bc164(0x162)+_0x1778d1+_0x3bc164(0x19e));}async[a54_0x1f0bba(0x1f1)](_0x33bca3){const _0x239670=a54_0x1f0bba;console['log'](_0x239670(0x1c5)+_0x33bca3);const _0x1b7241=await database_1[_0x239670(0x1eb)][_0x239670(0x212)]['findUnique']({'where':{'id':_0x33bca3},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x1b7241){console['log'](_0x239670(0x148)+_0x33bca3+'\x20not\x20found\x20in\x20database');return;}console['log'](_0x239670(0x1c3)+_0x33bca3+_0x239670(0x22e)),console[_0x239670(0x220)](_0x239670(0x248)+_0x1b7241[_0x239670(0x1c7)]),console[_0x239670(0x220)](_0x239670(0x1a4)+_0x1b7241['status']),console[_0x239670(0x220)](_0x239670(0x167)+_0x1b7241[_0x239670(0x241)]),console[_0x239670(0x220)]('\x20\x20\x20-\x20Amount:\x20'+_0x1b7241['amount']+'\x20'+_0x1b7241['currency']),console[_0x239670(0x220)](_0x239670(0x15a)+_0x1b7241['shopId']);if(_0x1b7241[_0x239670(0x1c7)]!=='cointopay'&&_0x1b7241[_0x239670(0x1c7)]!=='cointopay2'){console[_0x239670(0x220)](_0x239670(0x21c)+_0x33bca3+_0x239670(0x1a3)+_0x1b7241[_0x239670(0x1c7)]+')');return;}if(_0x1b7241[_0x239670(0x246)]!==_0x239670(0x18e)){console[_0x239670(0x220)](_0x239670(0x21c)+_0x33bca3+_0x239670(0x18d)+_0x1b7241[_0x239670(0x246)]+_0x239670(0x177)),this[_0x239670(0x1cf)](_0x33bca3);return;}if(!_0x1b7241[_0x239670(0x241)]){console[_0x239670(0x220)](_0x239670(0x21c)+_0x33bca3+_0x239670(0x153));return;}console['log'](_0x239670(0x1c9)+_0x33bca3+_0x239670(0x203)),await this[_0x239670(0x239)](_0x1b7241);}[a54_0x1f0bba(0x1ee)](_0x563044,_0x5c706a,_0x57861f,_0x10d167,_0x447756,_0xcc2082){const _0x428110=a54_0x1f0bba,_0x276b7d={'type':_0x428110(0x1bc),'paymentId':_0x563044,'gatewayPaymentId':_0x5c706a,'oldStatus':_0x57861f,'newStatus':_0x10d167,'source':_0x447756,'timestamp':new Date()['toISOString'](),'details':_0xcc2082||{}};loggerService_1[_0x428110(0x15d)][_0x428110(0x1ee)](_0x276b7d),console[_0x428110(0x220)](_0x428110(0x25c)+_0x563044+'\x20('+_0x5c706a+')'),console[_0x428110(0x220)](_0x428110(0x258)+_0x57861f+_0x428110(0x1ef)+_0x10d167),console[_0x428110(0x220)](_0x428110(0x174)+_0x447756),console['log'](_0x428110(0x251)+_0x276b7d[_0x428110(0x1f5)]),_0xcc2082&&console[_0x428110(0x220)](_0x428110(0x16c),_0xcc2082);}[a54_0x1f0bba(0x221)](_0x2a6714,_0x62ffde,_0x2930e0,_0x38f160,_0x4d86ec){const _0x502b6f=a54_0x1f0bba,_0x33d2c8={'type':_0x502b6f(0x19d),'paymentId':_0x2a6714,'gatewayPaymentId':_0x62ffde,'error':_0x2930e0 instanceof Error?{'message':_0x2930e0[_0x502b6f(0x14e)],'stack':_0x2930e0[_0x502b6f(0x1f9)]}:_0x2930e0,'source':_0x38f160,'timestamp':new Date()[_0x502b6f(0x1df)](),'context':_0x4d86ec||{}};loggerService_1[_0x502b6f(0x15d)][_0x502b6f(0x221)](_0x33d2c8),console[_0x502b6f(0x1f6)](_0x502b6f(0x1ed)+_0x2a6714+'\x20('+_0x62ffde+')'),console['error'](_0x502b6f(0x23d)+(_0x2930e0 instanceof Error?_0x2930e0[_0x502b6f(0x14e)]:_0x2930e0)),console[_0x502b6f(0x1f6)](_0x502b6f(0x174)+_0x38f160),console[_0x502b6f(0x1f6)]('\x20\x20\x20üìÖ\x20Time:\x20'+_0x33d2c8[_0x502b6f(0x1f5)]),_0x4d86ec&&console['error'](_0x502b6f(0x18a),_0x4d86ec);}[a54_0x1f0bba(0x20f)](){const _0x47d5f8=a54_0x1f0bba;console['log'](_0x47d5f8(0x147)),this[_0x47d5f8(0x1d8)]()[_0x47d5f8(0x1e9)](_0x2e2f0c=>{const _0x175ac0=_0x47d5f8;console[_0x175ac0(0x1f6)](_0x175ac0(0x1b2),_0x2e2f0c);}),this[_0x47d5f8(0x1f7)]=setInterval(async()=>{const _0xdba486=_0x47d5f8;try{console[_0xdba486(0x220)](_0xdba486(0x216)),await this[_0xdba486(0x1d8)](),console['log'](_0xdba486(0x238));}catch(_0x5d205c){console['error'](_0xdba486(0x254),_0x5d205c);}},this[_0x47d5f8(0x1a7)]),console[_0x47d5f8(0x220)](_0x47d5f8(0x1f3));}[a54_0x1f0bba(0x184)](){const _0x49cc90=a54_0x1f0bba;console[_0x49cc90(0x220)]('üõë\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...');this[_0x49cc90(0x1f7)]&&(clearInterval(this[_0x49cc90(0x1f7)]),this['globalCheckInterval']=null,console[_0x49cc90(0x220)](_0x49cc90(0x19a)));const _0x41cec5=this[_0x49cc90(0x1d6)][_0x49cc90(0x225)];for(const [_0x3a54dc]of this[_0x49cc90(0x1d6)]){this[_0x49cc90(0x1cf)](_0x3a54dc);}console['log'](_0x49cc90(0x14c)+_0x41cec5+_0x49cc90(0x249));}async[a54_0x1f0bba(0x1d8)](){const _0x1cad18=a54_0x1f0bba;try{console[_0x1cad18(0x220)](_0x1cad18(0x1f2));const _0x39b3cb=await database_1[_0x1cad18(0x1eb)][_0x1cad18(0x212)][_0x1cad18(0x188)]({'where':{'gateway':{'in':[_0x1cad18(0x218),_0x1cad18(0x1a6)]},'status':_0x1cad18(0x18e),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'secretKey':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x1cad18(0x220)](_0x1cad18(0x1cd)+_0x39b3cb['length']+_0x1cad18(0x152));if(_0x39b3cb[_0x1cad18(0x25d)]===0x0){console[_0x1cad18(0x220)](_0x1cad18(0x1e7));return;}const _0x2bb617=await this[_0x1cad18(0x178)](_0x39b3cb);console['log']('‚è∞\x20[GLOBAL]\x20Found\x20'+_0x2bb617[_0x1cad18(0x25d)]+'\x20expired\x20CoinToPay\x20payments');let _0xb84546=0x0,_0x380d38=0x0;for(const _0x5e1a8d of _0x39b3cb){try{if(_0x2bb617[_0x1cad18(0x1aa)](_0x5e1a8d['id'])){console[_0x1cad18(0x220)](_0x1cad18(0x1d4)+_0x5e1a8d['id']+_0x1cad18(0x1d3)),_0x380d38++;continue;}if(this[_0x1cad18(0x1d6)][_0x1cad18(0x1fe)](_0x5e1a8d['id'])){console[_0x1cad18(0x220)](_0x1cad18(0x1d4)+_0x5e1a8d['id']+_0x1cad18(0x1be)),_0x380d38++;continue;}const _0x24d7e5=(Date[_0x1cad18(0x1b0)]()-_0x5e1a8d[_0x1cad18(0x1b9)]['getTime']())/(0x3e8*0x3c*0x3c);if(_0x24d7e5<0x1){console[_0x1cad18(0x220)](_0x1cad18(0x1d4)+_0x5e1a8d['id']+'\x20is\x20too\x20new\x20('+_0x24d7e5[_0x1cad18(0x201)](0x1)+_0x1cad18(0x1fa)),_0x380d38++;continue;}console[_0x1cad18(0x220)](_0x1cad18(0x259)+_0x5e1a8d['id']+_0x1cad18(0x17b)+_0x24d7e5['toFixed'](0x1)+'h)'),await this[_0x1cad18(0x239)](_0x5e1a8d),_0xb84546++,await new Promise(_0x348696=>setTimeout(_0x348696,0x7d0));}catch(_0x1557ff){console[_0x1cad18(0x1f6)](_0x1cad18(0x23e)+_0x5e1a8d['id']+':',_0x1557ff),this[_0x1cad18(0x221)](_0x5e1a8d['id'],_0x5e1a8d['gatewayPaymentId']||'unknown',_0x1557ff,_0x1cad18(0x19c),{'isGlobalCheck':!![],'paymentAmount':_0x5e1a8d[_0x1cad18(0x1c0)],'paymentCurrency':_0x5e1a8d[_0x1cad18(0x1ae)],'shopId':_0x5e1a8d[_0x1cad18(0x24a)],'createdAt':_0x5e1a8d[_0x1cad18(0x1b9)]}),loggerService_1[_0x1cad18(0x15d)][_0x1cad18(0x1ec)](_0x1cad18(0x218),_0x1cad18(0x1ab)+_0x5e1a8d[_0x1cad18(0x241)],_0x1557ff);}}console['log'](_0x1cad18(0x1e0)+_0xb84546+'\x20checked,\x20'+_0x380d38+_0x1cad18(0x22d)+_0x2bb617[_0x1cad18(0x25d)]+'\x20expired');}catch(_0x237a2d){console[_0x1cad18(0x1f6)](_0x1cad18(0x247),_0x237a2d);}}async[a54_0x1f0bba(0x178)](_0x4486e6){const _0xae8760=a54_0x1f0bba,_0x3c4851=[],_0x4163ea=new Date();_0x4163ea[_0xae8760(0x14a)](_0x4163ea['getDate']()-this['EXPIRY_DAYS']),console[_0xae8760(0x220)](_0xae8760(0x25f)+this[_0xae8760(0x229)]+'\x20days\x20(created\x20before\x20'+_0x4163ea[_0xae8760(0x1df)]()+')');for(const _0x1e2f7b of _0x4486e6){if(_0x1e2f7b[_0xae8760(0x1b9)]<_0x4163ea){console[_0xae8760(0x220)]('‚è∞\x20[EXPIRY]\x20Payment\x20'+_0x1e2f7b['id']+_0xae8760(0x1af)+this[_0xae8760(0x229)]+_0xae8760(0x1d5));try{this[_0xae8760(0x1ee)](_0x1e2f7b['id'],_0x1e2f7b[_0xae8760(0x241)]||_0xae8760(0x211),'PENDING',_0xae8760(0x1a2),'auto_expire',{'reason':_0xae8760(0x1d1)+this[_0xae8760(0x229)]+_0xae8760(0x222),'createdAt':_0x1e2f7b['createdAt'],'daysSinceCreation':Math[_0xae8760(0x20e)]((Date[_0xae8760(0x1b0)]()-_0x1e2f7b[_0xae8760(0x1b9)][_0xae8760(0x157)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x1e2f7b[_0xae8760(0x1c0)],'paymentCurrency':_0x1e2f7b[_0xae8760(0x1ae)],'shopId':_0x1e2f7b[_0xae8760(0x24a)]}),await database_1[_0xae8760(0x1eb)][_0xae8760(0x212)][_0xae8760(0x244)]({'where':{'id':_0x1e2f7b['id']},'data':{'status':_0xae8760(0x1a2),'updatedAt':new Date()}}),await database_1[_0xae8760(0x1eb)][_0xae8760(0x1f4)]['create']({'data':{'paymentId':_0x1e2f7b['id'],'shopId':_0x1e2f7b['shopId'],'event':_0xae8760(0x1e3),'statusCode':0xc8,'responseBody':JSON['stringify']({'reason':_0xae8760(0x1d1)+this['EXPIRY_DAYS']+_0xae8760(0x222),'createdAt':_0x1e2f7b['createdAt'],'expiredAt':new Date()['toISOString'](),'daysSinceCreation':Math[_0xae8760(0x20e)]((Date[_0xae8760(0x1b0)]()-_0x1e2f7b[_0xae8760(0x1b9)][_0xae8760(0x157)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0xae8760(0x155)](_0x1e2f7b,_0xae8760(0x1a2)),await this[_0xae8760(0x168)](_0x1e2f7b,_0xae8760(0x1a2)),this[_0xae8760(0x1cf)](_0x1e2f7b['id']),_0x3c4851[_0xae8760(0x154)](_0x1e2f7b['id']),console[_0xae8760(0x220)](_0xae8760(0x1b8)+_0x1e2f7b['id']+_0xae8760(0x190)+this[_0xae8760(0x229)]+_0xae8760(0x242));}catch(_0x5c9d7b){console[_0xae8760(0x1f6)](_0xae8760(0x18c)+_0x1e2f7b['id']+':',_0x5c9d7b),this[_0xae8760(0x221)](_0x1e2f7b['id'],_0x1e2f7b[_0xae8760(0x241)]||_0xae8760(0x211),_0x5c9d7b,_0xae8760(0x25a),{'reason':'Failed\x20to\x20mark\x20payment\x20as\x20expired','createdAt':_0x1e2f7b['createdAt'],'daysSinceCreation':Math[_0xae8760(0x20e)]((Date[_0xae8760(0x1b0)]()-_0x1e2f7b[_0xae8760(0x1b9)][_0xae8760(0x157)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x3c4851;}async['checkSinglePayment'](_0x193fe){const _0x542e75=a54_0x1f0bba;if(!_0x193fe[_0x542e75(0x241)]){console[_0x542e75(0x220)](_0x542e75(0x21c)+_0x193fe['id']+'\x20has\x20no\x20gatewayPaymentId,\x20skipping');return;}console[_0x542e75(0x220)](_0x542e75(0x176)+_0x193fe[_0x542e75(0x1c7)]+_0x542e75(0x20c)+_0x193fe['id']+'\x20('+_0x193fe['gatewayPaymentId']+')');try{let _0x85b07;_0x193fe[_0x542e75(0x1c7)]==='cointopay2'?(_0x85b07=await this[_0x542e75(0x226)]['checkPaymentStatus'](_0x193fe['gatewayPaymentId']),console[_0x542e75(0x220)](_0x542e75(0x18f)+_0x193fe['id']+_0x542e75(0x245)+_0x85b07[_0x542e75(0x246)])):(_0x85b07=await this[_0x542e75(0x16d)][_0x542e75(0x237)](_0x193fe[_0x542e75(0x241)]),console['log'](_0x542e75(0x1b5)+_0x193fe['id']+_0x542e75(0x245)+_0x85b07[_0x542e75(0x246)]));_0x85b07[_0x542e75(0x210)]&&console[_0x542e75(0x220)](_0x542e75(0x1c3)+_0x193fe['id']+_0x542e75(0x250),{'iban':_0x85b07[_0x542e75(0x210)][_0x542e75(0x252)]||_0x542e75(0x227),'transactionId':_0x85b07[_0x542e75(0x210)]['transactionId'],'createdOn':_0x85b07[_0x542e75(0x210)][_0x542e75(0x255)],'confirmedOn':_0x85b07[_0x542e75(0x210)][_0x542e75(0x166)]||_0x542e75(0x14d)});if(_0x85b07['status']!==_0x193fe[_0x542e75(0x246)]){console['log'](_0x542e75(0x1c8)+_0x193fe['id']+_0x542e75(0x18b)+_0x193fe[_0x542e75(0x246)]+_0x542e75(0x1ce)+_0x85b07['status']),this[_0x542e75(0x1ee)](_0x193fe['id'],_0x193fe[_0x542e75(0x241)],_0x193fe[_0x542e75(0x246)],_0x85b07[_0x542e75(0x246)],'status_check',{'paymentDetails':_0x85b07[_0x542e75(0x210)],'amount':_0x85b07['amount'],'currency':_0x85b07[_0x542e75(0x1ae)],'shopId':_0x193fe['shopId'],'checkTimestamp':new Date()['toISOString']()});const _0xf998d4={'status':_0x85b07[_0x542e75(0x246)],'updatedAt':new Date()};if(_0x85b07[_0x542e75(0x246)]===_0x542e75(0x23a)&&_0x193fe['status']!==_0x542e75(0x23a)){_0xf998d4['paidAt']=new Date();if(!_0x193fe[_0x542e75(0x23c)]){const _0xaeccdb=await currencyService_1[_0x542e75(0x24b)]['convertToUSDT'](_0x193fe[_0x542e75(0x1c0)],_0x193fe[_0x542e75(0x1ae)]);_0xf998d4[_0x542e75(0x23c)]=_0xaeccdb;const _0xe0a557=await this[_0x542e75(0x1b1)](_0x193fe[_0x542e75(0x24a)],_0x193fe[_0x542e75(0x1c7)]),_0x1706d6=_0xaeccdb*(0x1-_0xe0a557/0x64);_0xf998d4[_0x542e75(0x1a0)]=_0x1706d6,_0xf998d4[_0x542e75(0x215)]=_0xe0a557,console[_0x542e75(0x220)](_0x542e75(0x1f0)+_0x193fe['id']+_0x542e75(0x15b)),console['log']('\x20\x20\x20Amount:\x20'+_0x193fe['amount']+'\x20'+_0x193fe[_0x542e75(0x1ae)]+_0x542e75(0x1ef)+_0xaeccdb[_0x542e75(0x201)](0x6)+_0x542e75(0x217)),console['log'](_0x542e75(0x204)+_0x193fe[_0x542e75(0x1c7)]+_0x542e75(0x243)+_0xe0a557+'%'),console[_0x542e75(0x220)](_0x542e75(0x22f)+_0x1706d6['toFixed'](0x6)+'\x20USDT');}console[_0x542e75(0x220)](_0x542e75(0x1f0)+_0x193fe['id']+_0x542e75(0x21f)+_0xf998d4['paidAt'][_0x542e75(0x1df)]());}if(_0x85b07[_0x542e75(0x210)]){const _0x3bfd8e=_0x85b07[_0x542e75(0x210)];_0x3bfd8e[_0x542e75(0x252)]&&(_0xf998d4[_0x542e75(0x22a)]=_0x3bfd8e[_0x542e75(0x252)],console[_0x542e75(0x220)]('üè¶\x20[CHECK]\x20Saved\x20IBAN:\x20'+_0x3bfd8e[_0x542e75(0x252)])),_0x3bfd8e[_0x542e75(0x14f)]&&console[_0x542e75(0x220)](_0x542e75(0x1d9)+_0x3bfd8e['bankDetails']),_0x3bfd8e[_0x542e75(0x19f)]&&console[_0x542e75(0x220)](_0x542e75(0x224)+_0x3bfd8e[_0x542e75(0x19f)]),_0x3bfd8e[_0x542e75(0x166)]&&console[_0x542e75(0x220)](_0x542e75(0x24c)+_0x3bfd8e[_0x542e75(0x166)]);}await database_1[_0x542e75(0x1eb)]['payment'][_0x542e75(0x244)]({'where':{'id':_0x193fe['id']},'data':_0xf998d4});if(_0x85b07[_0x542e75(0x246)]===_0x542e75(0x23a)&&_0x193fe[_0x542e75(0x246)]!==_0x542e75(0x23a)){console['log'](_0x542e75(0x24d)+_0x193fe['id']+_0x542e75(0x21e));const _0x510ece=await database_1[_0x542e75(0x1eb)][_0x542e75(0x212)][_0x542e75(0x16a)]({'where':{'id':_0x193fe['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x510ece?.['paymentLinkId']&&_0x510ece[_0x542e75(0x199)])try{const _0x372adf=_0x510ece['paymentLink'];console[_0x542e75(0x220)]('üìà\x20[COINTOPAY]\x20Found\x20payment\x20link\x20'+_0x372adf['id']+':\x20type='+_0x372adf[_0x542e75(0x233)]+_0x542e75(0x170)+_0x372adf[_0x542e75(0x20b)]+',\x20status='+_0x372adf[_0x542e75(0x246)]);const _0x4cddb=_0x372adf[_0x542e75(0x20b)]+0x1,_0x2f3523=_0x372adf[_0x542e75(0x233)]==='SINGLE'?_0x542e75(0x15e):_0x372adf[_0x542e75(0x246)];await database_1['default'][_0x542e75(0x199)][_0x542e75(0x244)]({'where':{'id':_0x372adf['id']},'data':{'currentPayments':_0x4cddb,'status':_0x2f3523,'updatedAt':new Date()}}),console[_0x542e75(0x220)]('‚úÖ\x20[COINTOPAY]\x20Payment\x20link\x20'+_0x372adf['id']+_0x542e75(0x1e8)+_0x372adf['currentPayments']+'\x20->\x20'+_0x4cddb+_0x542e75(0x1fd)+_0x372adf[_0x542e75(0x246)]+'\x20->\x20'+_0x2f3523);}catch(_0x2225d2){console[_0x542e75(0x1f6)](_0x542e75(0x175),_0x2225d2);}else console[_0x542e75(0x220)]('üìà\x20[COINTOPAY]\x20Payment\x20'+_0x193fe['id']+'\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link');}await database_1[_0x542e75(0x1eb)]['webhookLog']['create']({'data':{'paymentId':_0x193fe['id'],'shopId':_0x193fe[_0x542e75(0x24a)],'event':_0x542e75(0x209)+_0x85b07[_0x542e75(0x246)][_0x542e75(0x164)](),'statusCode':0xc8,'responseBody':JSON[_0x542e75(0x24e)]({'oldStatus':_0x193fe[_0x542e75(0x246)],'newStatus':_0x85b07[_0x542e75(0x246)],'paymentDetails':_0x85b07[_0x542e75(0x210)],'checkedAt':new Date()[_0x542e75(0x1df)]()})}}),await this[_0x542e75(0x155)](_0x193fe,_0x85b07[_0x542e75(0x246)]),await this['sendPaymentStatusNotification'](_0x193fe,_0x85b07[_0x542e75(0x246)]),_0x85b07[_0x542e75(0x246)]!==_0x542e75(0x18e)&&(console['log'](_0x542e75(0x181)+_0x193fe['id']+_0x542e75(0x1fc)+_0x85b07[_0x542e75(0x246)]+_0x542e75(0x1ea)),this['clearPaymentTimers'](_0x193fe['id'])),console[_0x542e75(0x220)](_0x542e75(0x1c9)+_0x193fe['id']+_0x542e75(0x208));}else console[_0x542e75(0x220)](_0x542e75(0x1c3)+_0x193fe['id']+'\x20status\x20unchanged\x20('+_0x85b07[_0x542e75(0x246)]+')'),this[_0x542e75(0x1ee)](_0x193fe['id'],_0x193fe[_0x542e75(0x241)],_0x193fe[_0x542e75(0x246)],_0x85b07['status'],_0x542e75(0x19c),{'statusUnchanged':!![],'paymentDetails':_0x85b07['paymentDetails'],'amount':_0x85b07['amount'],'currency':_0x85b07[_0x542e75(0x1ae)],'shopId':_0x193fe[_0x542e75(0x24a)],'checkTimestamp':new Date()[_0x542e75(0x1df)]()});}catch(_0x363515){console['error']('‚ùå\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20'+_0x193fe['id']+':',_0x363515),this[_0x542e75(0x221)](_0x193fe['id'],_0x193fe['gatewayPaymentId'],_0x363515,'status_check',{'paymentAmount':_0x193fe[_0x542e75(0x1c0)],'paymentCurrency':_0x193fe[_0x542e75(0x1ae)],'shopId':_0x193fe[_0x542e75(0x24a)],'createdAt':_0x193fe[_0x542e75(0x1b9)]}),await database_1[_0x542e75(0x1eb)][_0x542e75(0x1f4)][_0x542e75(0x230)]({'data':{'paymentId':_0x193fe['id'],'shopId':_0x193fe[_0x542e75(0x24a)],'event':_0x542e75(0x25e),'statusCode':0x1f4,'responseBody':JSON[_0x542e75(0x24e)]({'error':_0x363515 instanceof Error?_0x363515[_0x542e75(0x14e)]:_0x542e75(0x1de),'gatewayPaymentId':_0x193fe['gatewayPaymentId'],'checkedAt':new Date()['toISOString']()})}});}}async[a54_0x1f0bba(0x155)](_0x2bd347,_0x48a190){const _0x5c76e2=a54_0x1f0bba,_0x49e2f6=Date[_0x5c76e2(0x1b0)]();try{const _0x14e974=_0x2bd347[_0x5c76e2(0x1f8)],_0x421bab=_0x14e974[_0x5c76e2(0x191)];if(!_0x421bab?.[_0x5c76e2(0x1a5)]){console[_0x5c76e2(0x220)]('No\x20webhook\x20URL\x20configured\x20for\x20shop\x20'+_0x14e974['id']);return;}const _0x4d6b0e=_0x48a190===_0x5c76e2(0x23a)?_0x5c76e2(0x223):_0x48a190===_0x5c76e2(0x1c4)?_0x5c76e2(0x21b):_0x48a190==='EXPIRED'?_0x5c76e2(0x21b):_0x5c76e2(0x158);if(!_0x421bab['webhookEvents']?.[_0x5c76e2(0x1aa)](_0x4d6b0e)){console[_0x5c76e2(0x220)](_0x5c76e2(0x149)+_0x4d6b0e+'\x20not\x20enabled\x20for\x20shop\x20'+_0x14e974['id']);return;}const _0x35aced=(0x0,gateway_1[_0x5c76e2(0x1ad)])(_0x2bd347[_0x5c76e2(0x1c7)])||_0x2bd347[_0x5c76e2(0x1c7)],_0x4ea197={'event':_0x4d6b0e,'payment':{'id':_0x2bd347['id'],'order_id':_0x2bd347[_0x5c76e2(0x14b)],'gateway_order_id':_0x2bd347[_0x5c76e2(0x23b)],'gateway':_0x35aced,'amount':_0x2bd347[_0x5c76e2(0x1c0)],'currency':_0x2bd347['currency'],'status':_0x48a190['toLowerCase'](),'customer_email':_0x2bd347[_0x5c76e2(0x17c)],'customer_name':_0x2bd347[_0x5c76e2(0x23f)],'created_at':_0x2bd347[_0x5c76e2(0x1b9)],'updated_at':new Date()}},_0x3f4d84=JSON['stringify'](_0x4ea197),_0x59b09b=crypto_1['default'][_0x5c76e2(0x213)](_0x5c76e2(0x1ac),_0x2bd347[_0x5c76e2(0x1f8)][_0x5c76e2(0x151)])[_0x5c76e2(0x244)](_0x3f4d84)['digest'](_0x5c76e2(0x1b4)),_0x41eed5=await fetch(_0x421bab[_0x5c76e2(0x1a5)],{'method':_0x5c76e2(0x1ba),'headers':{'Content-Type':'application/json','User-Agent':'Payment\x20System/1.0','X-Webhook-Signature':_0x59b09b},'body':_0x3f4d84}),_0x3969ca=Date[_0x5c76e2(0x1b0)]()-_0x49e2f6,_0x2c044e=_0x41eed5['ok']?_0x5c76e2(0x205):await _0x41eed5[_0x5c76e2(0x16f)]();loggerService_1[_0x5c76e2(0x15d)][_0x5c76e2(0x17a)](_0x2bd347[_0x5c76e2(0x24a)],_0x421bab[_0x5c76e2(0x1a5)],_0x4d6b0e,_0x41eed5['status'],_0x3969ca,_0x4ea197),console[_0x5c76e2(0x220)]('Shop\x20webhook\x20sent\x20to\x20'+_0x421bab['webhookUrl']+_0x5c76e2(0x1c1)+_0x41eed5[_0x5c76e2(0x246)]+'\x20('+_0x3969ca+'ms)');}catch(_0x5a082a){console[_0x5c76e2(0x1f6)](_0x5c76e2(0x15f),_0x5a082a),loggerService_1[_0x5c76e2(0x15d)][_0x5c76e2(0x189)](_0x2bd347['shopId'],_0x2bd347[_0x5c76e2(0x1f8)]?.[_0x5c76e2(0x191)]?.['webhookUrl']||'unknown',_0x5c76e2(0x1a1),_0x5a082a,{});}}async[a54_0x1f0bba(0x168)](_0x329549,_0x23bef2){const _0x4806f4=a54_0x1f0bba;try{const _0x24615c={'PENDING':'created','PAID':_0x4806f4(0x160),'FAILED':'failed','EXPIRED':_0x4806f4(0x1e5)},_0x184aa9=_0x24615c[_0x23bef2];if(!_0x184aa9||_0x184aa9===_0x4806f4(0x206))return;await telegramBotService_1[_0x4806f4(0x1e6)][_0x4806f4(0x1d7)](_0x329549[_0x4806f4(0x24a)],_0x329549,_0x184aa9);}catch(_0x2e990c){console[_0x4806f4(0x1f6)]('Failed\x20to\x20send\x20Telegram\x20payment\x20notification:',_0x2e990c);}}async['checkPaymentById'](_0x16f11c){const _0x5a8d05=a54_0x1f0bba;console[_0x5a8d05(0x220)](_0x5a8d05(0x20a)+_0x16f11c);const _0x36e99a=await database_1[_0x5a8d05(0x1eb)][_0x5a8d05(0x212)][_0x5a8d05(0x16a)]({'where':{'id':_0x16f11c},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x36e99a)throw new Error(_0x5a8d05(0x194));if(_0x36e99a['gateway']!==_0x5a8d05(0x218)&&_0x36e99a[_0x5a8d05(0x1c7)]!==_0x5a8d05(0x1a6))throw new Error(_0x5a8d05(0x234));console[_0x5a8d05(0x220)](_0x5a8d05(0x235)+_0x36e99a[_0x5a8d05(0x1c7)]+_0x5a8d05(0x20c)+_0x16f11c),await this[_0x5a8d05(0x239)](_0x36e99a),console['log'](_0x5a8d05(0x22b)+_0x16f11c);}[a54_0x1f0bba(0x240)](){const _0x3dbbd8=a54_0x1f0bba,_0x238d25=this['globalCheckInterval']?this['GLOBAL_CHECK_INTERVAL_MS']:undefined,_0x3819f3=Array[_0x3dbbd8(0x172)](this[_0x3dbbd8(0x1d6)]['values']())[_0x3dbbd8(0x183)](_0x29f053=>({'paymentId':_0x29f053[_0x3dbbd8(0x15c)],'gatewayPaymentId':_0x29f053[_0x3dbbd8(0x241)],'createdAt':_0x29f053['createdAt'],'timersCount':_0x29f053[_0x3dbbd8(0x150)]['length']}));return{'isActive':!!this['globalCheckInterval'],'globalCheckIntervalMinutes':this[_0x3dbbd8(0x1a7)]/(0x3e8*0x3c),'expiryDays':this[_0x3dbbd8(0x229)],'activeIndividualTimers':this[_0x3dbbd8(0x1d6)]['size'],'nextGlobalCheckIn':_0x238d25,'paymentTimersDetails':_0x3819f3};}[a54_0x1f0bba(0x256)](_0x3b1530){const _0x11ef29=a54_0x1f0bba,_0x953bba=this['paymentTimers'][_0x11ef29(0x214)](_0x3b1530);if(_0x953bba)return{'hasTimers':!![],'timersCount':_0x953bba['timers'][_0x11ef29(0x25d)],'createdAt':_0x953bba[_0x11ef29(0x1b9)],'gatewayPaymentId':_0x953bba[_0x11ef29(0x241)]};return{'hasTimers':![]};}async['getGatewayCommission'](_0x8be685,_0x2964f2){const _0x41b953=a54_0x1f0bba;try{const _0x39b3ed=await database_1[_0x41b953(0x1eb)]['shop'][_0x41b953(0x16a)]({'where':{'id':_0x8be685},'select':{'gatewaySettings':!![]}});if(!_0x39b3ed?.[_0x41b953(0x196)])return console[_0x41b953(0x220)](_0x41b953(0x1a9)+_0x8be685+_0x41b953(0x1db)),0xa;const _0x258171=JSON[_0x41b953(0x24f)](_0x39b3ed['gatewaySettings']);for(const [_0xf380da,_0x48d46e]of Object[_0x41b953(0x1a8)](_0x258171)){if(_0xf380da['toLowerCase']()===_0x2964f2[_0x41b953(0x164)]()){const _0x35bed9=_0x48d46e[_0x41b953(0x1e2)]||0xa;return console[_0x41b953(0x220)]('Gateway\x20'+_0x2964f2+'\x20commission\x20for\x20shop\x20'+_0x8be685+':\x20'+_0x35bed9+'%'),_0x35bed9;}}return console[_0x41b953(0x220)](_0x41b953(0x17e)+_0x2964f2+_0x41b953(0x159)+_0x8be685+_0x41b953(0x257)),0xa;}catch(_0x46461c){return console[_0x41b953(0x1f6)](_0x41b953(0x231)+_0x8be685+_0x41b953(0x1dc)+_0x2964f2+':',_0x46461c),0xa;}}}exports[a54_0x1f0bba(0x179)]=CoinToPayStatusService,exports['coinToPayStatusService']=new CoinToPayStatusService();