'use strict';const a42_0x30da53=a42_0x4a95;function a42_0x4a95(_0x1f0f8e,_0x2449a0){const _0x547b90=a42_0x547b();return a42_0x4a95=function(_0x4a9531,_0xf3726e){_0x4a9531=_0x4a9531-0x102;let _0x1c7e4d=_0x547b90[_0x4a9531];return _0x1c7e4d;},a42_0x4a95(_0x1f0f8e,_0x2449a0);}(function(_0x21f882,_0x261f61){const _0x232a2d=a42_0x4a95,_0x3ee5c0=_0x21f882();while(!![]){try{const _0x257818=-parseInt(_0x232a2d(0x141))/0x1*(parseInt(_0x232a2d(0x187))/0x2)+parseInt(_0x232a2d(0x179))/0x3+parseInt(_0x232a2d(0x210))/0x4*(-parseInt(_0x232a2d(0x1b1))/0x5)+parseInt(_0x232a2d(0x20c))/0x6+-parseInt(_0x232a2d(0x1b7))/0x7+-parseInt(_0x232a2d(0x149))/0x8+parseInt(_0x232a2d(0x158))/0x9;if(_0x257818===_0x261f61)break;else _0x3ee5c0['push'](_0x3ee5c0['shift']());}catch(_0x51399f){_0x3ee5c0['push'](_0x3ee5c0['shift']());}}}(a42_0x547b,0xa277e));var __importDefault=this&&this[a42_0x30da53(0x1b0)]||function(_0xb2b55b){const _0x45a72d=a42_0x30da53;return _0xb2b55b&&_0xb2b55b[_0x45a72d(0x127)]?_0xb2b55b:{'default':_0xb2b55b};};Object[a42_0x30da53(0x15b)](exports,a42_0x30da53(0x127),{'value':!![]}),exports[a42_0x30da53(0x1e8)]=exports[a42_0x30da53(0x178)]=void 0x0;const coinToPayService_1=require('./gateways/coinToPayService'),coinToPay2Service_1=require(a42_0x30da53(0x17d)),gateway_1=require(a42_0x30da53(0x147)),database_1=__importDefault(require(a42_0x30da53(0x1ef))),telegramBotService_1=require(a42_0x30da53(0x112)),loggerService_1=require('./loggerService'),currencyService_1=require(a42_0x30da53(0x174));class CoinToPayStatusService{constructor(){const _0x5b3278=a42_0x30da53;this['globalCheckInterval']=null,this['GLOBAL_CHECK_INTERVAL_MS']=0x3c*0x3c*0x3e8,this[_0x5b3278(0x13d)]=0x5,this['paymentTimers']=new Map(),this[_0x5b3278(0x16c)]=new coinToPayService_1[(_0x5b3278(0x1f1))](),this['coinToPay2Service']=new coinToPay2Service_1['CoinToPay2Service'](),console[_0x5b3278(0x185)](_0x5b3278(0x190));}[a42_0x30da53(0x10b)](_0x4fe4bf,_0x46c903){const _0x221882=a42_0x30da53;console['log']('ü™ô\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:'),console[_0x221882(0x185)](_0x221882(0x12d)+_0x4fe4bf),console[_0x221882(0x185)](_0x221882(0x14d)+_0x46c903),this['clearPaymentTimers'](_0x4fe4bf);const _0x54e0dc=[],_0x5d7704=new Date(),_0x2b66c7=[{'delay':0x1*0x3c*0x3e8,'description':'1\x20minute'},{'delay':0x2*0x3c*0x3e8,'description':_0x221882(0x1a6)},{'delay':0x5*0x3c*0x3e8,'description':_0x221882(0x107)},{'delay':0x5*0x3c*0x3e8,'description':_0x221882(0x107)}];console[_0x221882(0x185)]('ü™ô\x20[DEBUG]\x20Creating\x20'+_0x2b66c7[_0x221882(0x118)]+_0x221882(0x19c)+_0x4fe4bf);let _0x419532=0x0;_0x2b66c7['forEach']((_0x291574,_0x936934)=>{const _0x325b59=_0x221882;_0x419532+=_0x291574[_0x325b59(0x205)];const _0x395736=setTimeout(async()=>{const _0x1acbf2=_0x325b59;console['log']('ü™ô\x20[TIMER]\x20Individual\x20check\x20#'+(_0x936934+0x1)+_0x1acbf2(0x217)+_0x4fe4bf+'\x20(after\x20'+_0x291574[_0x1acbf2(0x1b5)]+')');try{await this[_0x1acbf2(0x1ee)](_0x4fe4bf),console[_0x1acbf2(0x185)]('‚úÖ\x20[TIMER]\x20Individual\x20check\x20#'+(_0x936934+0x1)+_0x1acbf2(0x1e4)+_0x4fe4bf);}catch(_0x409b09){console[_0x1acbf2(0x171)](_0x1acbf2(0x121)+(_0x936934+0x1)+'\x20for\x20payment\x20'+_0x4fe4bf+':',_0x409b09),this[_0x1acbf2(0x180)](_0x4fe4bf,_0x46c903,_0x409b09,_0x1acbf2(0x16f),{'checkNumber':_0x936934+0x1,'scheduledAfter':_0x291574[_0x1acbf2(0x1b5)],'isIndividualCheck':!![]});}},_0x419532);_0x54e0dc[_0x325b59(0x1ec)](_0x395736),console['log'](_0x325b59(0x19e)+(_0x936934+0x1)+_0x325b59(0x148)+_0x4fe4bf+_0x325b59(0x136)+_0x419532/0x3e8+'\x20seconds\x20('+_0x291574[_0x325b59(0x1b5)]+')');});const _0x2d7267=setInterval(async()=>{const _0x3c01b2=_0x221882;console[_0x3c01b2(0x185)](_0x3c01b2(0x1f4)+_0x4fe4bf);try{const _0x54ac97=await database_1[_0x3c01b2(0x1bc)][_0x3c01b2(0x191)][_0x3c01b2(0x17b)]({'where':{'id':_0x4fe4bf},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x54ac97){console[_0x3c01b2(0x185)](_0x3c01b2(0x12b)+_0x4fe4bf+_0x3c01b2(0x17c)),this[_0x3c01b2(0x181)](_0x4fe4bf);return;}console[_0x3c01b2(0x185)](_0x3c01b2(0x184)+_0x4fe4bf+'\x20current\x20status:\x20'+_0x54ac97[_0x3c01b2(0x1d1)]);if(_0x54ac97['status']!==_0x3c01b2(0x14b)){console[_0x3c01b2(0x185)](_0x3c01b2(0x20b)+_0x4fe4bf+'\x20status\x20is\x20'+_0x54ac97[_0x3c01b2(0x1d1)]+_0x3c01b2(0x1a4)),this[_0x3c01b2(0x181)](_0x4fe4bf);return;}const _0x49a32c=Math[_0x3c01b2(0x167)]((Date[_0x3c01b2(0x13c)]()-_0x54ac97[_0x3c01b2(0x177)]['getTime']())/(0x3e8*0x3c*0x3c*0x18));if(_0x49a32c>=this['EXPIRY_DAYS']){console[_0x3c01b2(0x185)](_0x3c01b2(0x160)+_0x4fe4bf+_0x3c01b2(0x18c)+this['EXPIRY_DAYS']+_0x3c01b2(0x159)),this[_0x3c01b2(0x181)](_0x4fe4bf);return;}await this[_0x3c01b2(0x1ee)](_0x4fe4bf),console[_0x3c01b2(0x185)](_0x3c01b2(0x1e9)+_0x4fe4bf);}catch(_0x1cdf70){console[_0x3c01b2(0x171)](_0x3c01b2(0x153)+_0x4fe4bf+':',_0x1cdf70),this[_0x3c01b2(0x180)](_0x4fe4bf,_0x46c903,_0x1cdf70,_0x3c01b2(0x16f),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x54e0dc[_0x221882(0x1ec)](_0x2d7267),this[_0x221882(0x203)]['set'](_0x4fe4bf,{'timers':_0x54e0dc,'paymentId':_0x4fe4bf,'gatewayPaymentId':_0x46c903,'createdAt':_0x5d7704}),console[_0x221882(0x185)](_0x221882(0x176)+_0x2b66c7[_0x221882(0x118)]+_0x221882(0x1c0)+_0x4fe4bf),console[_0x221882(0x185)]('üìä\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20'+this[_0x221882(0x203)][_0x221882(0x15d)]),this[_0x221882(0x1c5)](_0x4fe4bf,_0x46c903,_0x221882(0x14b),_0x221882(0x14b),'status_check',{'action':_0x221882(0x20f),'scheduledChecks':_0x2b66c7[_0x221882(0x118)],'firstCheckIn':_0x2b66c7[0x0][_0x221882(0x205)]/0x3e8,'totalTimers':this['paymentTimers'][_0x221882(0x15d)]});}[a42_0x30da53(0x181)](_0x399f1f){const _0x3d65b6=a42_0x30da53,_0x32c505=this[_0x3d65b6(0x203)]['get'](_0x399f1f);_0x32c505?(console[_0x3d65b6(0x185)](_0x3d65b6(0x211)+_0x32c505[_0x3d65b6(0x1c6)]['length']+_0x3d65b6(0x165)+_0x399f1f),_0x32c505[_0x3d65b6(0x1c6)][_0x3d65b6(0x11d)]((_0x26461d,_0x364b93)=>{const _0x14bf87=_0x3d65b6;_0x26461d&&(clearTimeout(_0x26461d),clearInterval(_0x26461d),console[_0x14bf87(0x185)](_0x14bf87(0x133)+(_0x364b93+0x1)+'\x20for\x20payment\x20'+_0x399f1f));}),this['paymentTimers'][_0x3d65b6(0x1a7)](_0x399f1f),console[_0x3d65b6(0x185)](_0x3d65b6(0x212)+_0x399f1f+_0x3d65b6(0x119)+this['paymentTimers'][_0x3d65b6(0x15d)])):console[_0x3d65b6(0x185)](_0x3d65b6(0x16a)+_0x399f1f+_0x3d65b6(0x13a));}async[a42_0x30da53(0x1ee)](_0x2f34b3){const _0x344077=a42_0x30da53;console[_0x344077(0x185)]('üîç\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20'+_0x2f34b3);const _0x2a8074=await database_1['default'][_0x344077(0x191)][_0x344077(0x17b)]({'where':{'id':_0x2f34b3},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x2a8074){console[_0x344077(0x185)](_0x344077(0x172)+_0x2f34b3+_0x344077(0x14f));return;}console[_0x344077(0x185)](_0x344077(0x138)+_0x2f34b3+'\x20found:'),console[_0x344077(0x185)](_0x344077(0x1a0)+_0x2a8074[_0x344077(0x18f)]),console['log'](_0x344077(0x1cb)+_0x2a8074[_0x344077(0x1d1)]),console[_0x344077(0x185)](_0x344077(0x19b)+_0x2a8074['gatewayPaymentId']),console[_0x344077(0x185)](_0x344077(0x10d)+_0x2a8074[_0x344077(0x1e3)]+'\x20'+_0x2a8074['currency']),console[_0x344077(0x185)](_0x344077(0x1b3)+_0x2a8074[_0x344077(0x130)]);if(_0x2a8074['gateway']!==_0x344077(0x12c)&&_0x2a8074[_0x344077(0x18f)]!==_0x344077(0x113)){console[_0x344077(0x185)](_0x344077(0x1a1)+_0x2f34b3+'\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20'+_0x2a8074['gateway']+')');return;}if(_0x2a8074['status']!==_0x344077(0x14b)){console[_0x344077(0x185)](_0x344077(0x1a1)+_0x2f34b3+_0x344077(0x132)+_0x2a8074[_0x344077(0x1d1)]+_0x344077(0x1a4)),this['clearPaymentTimers'](_0x2f34b3);return;}if(!_0x2a8074['gatewayPaymentId']){console[_0x344077(0x185)](_0x344077(0x1a1)+_0x2f34b3+_0x344077(0x103));return;}console[_0x344077(0x185)](_0x344077(0x125)+_0x2f34b3+_0x344077(0x20e)),await this[_0x344077(0x1ab)](_0x2a8074);}[a42_0x30da53(0x1c5)](_0x3d2190,_0x5c901f,_0x24b608,_0x177e16,_0x374000,_0xdb892f){const _0x4e407c=a42_0x30da53,_0xceb203={'type':_0x4e407c(0x213),'paymentId':_0x3d2190,'gatewayPaymentId':_0x5c901f,'oldStatus':_0x24b608,'newStatus':_0x177e16,'source':_0x374000,'timestamp':new Date()['toISOString'](),'details':_0xdb892f||{}};loggerService_1['loggerService']['logCoinToPayStatus'](_0xceb203),console['log'](_0x4e407c(0x1df)+_0x3d2190+'\x20('+_0x5c901f+')'),console[_0x4e407c(0x185)](_0x4e407c(0x19a)+_0x24b608+_0x4e407c(0x1d3)+_0x177e16),console[_0x4e407c(0x185)](_0x4e407c(0x117)+_0x374000),console[_0x4e407c(0x185)]('\x20\x20\x20üìÖ\x20Time:\x20'+_0xceb203[_0x4e407c(0x1d6)]),_0xdb892f&&console[_0x4e407c(0x185)](_0x4e407c(0x192),_0xdb892f);}[a42_0x30da53(0x180)](_0x1a0545,_0x159519,_0x25f402,_0xdf8ad4,_0x335f0b){const _0x9fec30=a42_0x30da53,_0x42823a={'type':'COINTOPAY_ERROR','paymentId':_0x1a0545,'gatewayPaymentId':_0x159519,'error':_0x25f402 instanceof Error?{'message':_0x25f402[_0x9fec30(0x1de)],'stack':_0x25f402['stack']}:_0x25f402,'source':_0xdf8ad4,'timestamp':new Date()[_0x9fec30(0x1fa)](),'context':_0x335f0b||{}};loggerService_1[_0x9fec30(0x1d7)][_0x9fec30(0x180)](_0x42823a),console[_0x9fec30(0x171)](_0x9fec30(0x17e)+_0x1a0545+'\x20('+_0x159519+')'),console['error']('\x20\x20\x20‚ùå\x20Error:\x20'+(_0x25f402 instanceof Error?_0x25f402['message']:_0x25f402)),console[_0x9fec30(0x171)]('\x20\x20\x20üìç\x20Source:\x20'+_0xdf8ad4),console[_0x9fec30(0x171)](_0x9fec30(0x1e5)+_0x42823a[_0x9fec30(0x1d6)]),_0x335f0b&&console['error'](_0x9fec30(0x1e1),_0x335f0b);}[a42_0x30da53(0x1ed)](){const _0xe7b2d0=a42_0x30da53;console['log']('ü™ô\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)'),this['checkAllPendingPayments']()['catch'](_0x22f7d7=>{const _0xa9cf6f=a42_0x4a95;console[_0xa9cf6f(0x171)](_0xa9cf6f(0x1f7),_0x22f7d7);}),this[_0xe7b2d0(0x17f)]=setInterval(async()=>{const _0x34f0aa=_0xe7b2d0;try{console[_0x34f0aa(0x185)](_0x34f0aa(0x12e)),await this[_0x34f0aa(0x1ea)](),console['log'](_0x34f0aa(0x20a));}catch(_0x523bb6){console['error'](_0x34f0aa(0x13e),_0x523bb6);}},this[_0xe7b2d0(0x1af)]),console[_0xe7b2d0(0x185)]('‚úÖ\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)');}[a42_0x30da53(0x1ad)](){const _0x4bbb75=a42_0x30da53;console['log'](_0x4bbb75(0x218));this[_0x4bbb75(0x17f)]&&(clearInterval(this[_0x4bbb75(0x17f)]),this[_0x4bbb75(0x17f)]=null,console[_0x4bbb75(0x185)](_0x4bbb75(0x196)));const _0x16fbe4=this[_0x4bbb75(0x203)]['size'];for(const [_0x18a345]of this['paymentTimers']){this['clearPaymentTimers'](_0x18a345);}console[_0x4bbb75(0x185)](_0x4bbb75(0x1b8)+_0x16fbe4+'\x20individual\x20payment\x20timers');}async[a42_0x30da53(0x1ea)](){const _0x4053bc=a42_0x30da53;try{console[_0x4053bc(0x185)]('ü™ô\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...');const _0x40fff1=await database_1[_0x4053bc(0x1bc)]['payment'][_0x4053bc(0x216)]({'where':{'gateway':{'in':[_0x4053bc(0x12c),_0x4053bc(0x113)]},'status':_0x4053bc(0x14b),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x4053bc(0x185)](_0x4053bc(0x1f0)+_0x40fff1[_0x4053bc(0x118)]+_0x4053bc(0x14e));if(_0x40fff1[_0x4053bc(0x118)]===0x0){console['log'](_0x4053bc(0x116));return;}const _0x68c3b0=await this[_0x4053bc(0x14c)](_0x40fff1);console[_0x4053bc(0x185)]('‚è∞\x20[GLOBAL]\x20Found\x20'+_0x68c3b0[_0x4053bc(0x118)]+_0x4053bc(0x10c));let _0x948e5e=0x0,_0x54e8ec=0x0;for(const _0x3f371b of _0x40fff1){try{if(_0x68c3b0[_0x4053bc(0x15e)](_0x3f371b['id'])){console['log'](_0x4053bc(0x1c2)+_0x3f371b['id']+_0x4053bc(0x1c9)),_0x54e8ec++;continue;}if(this[_0x4053bc(0x203)][_0x4053bc(0x202)](_0x3f371b['id'])){console['log'](_0x4053bc(0x1c2)+_0x3f371b['id']+_0x4053bc(0x19d)),_0x54e8ec++;continue;}const _0x8d9af0=(Date[_0x4053bc(0x13c)]()-_0x3f371b[_0x4053bc(0x177)][_0x4053bc(0x219)]())/(0x3e8*0x3c*0x3c);if(_0x8d9af0<0x1){console[_0x4053bc(0x185)](_0x4053bc(0x1c2)+_0x3f371b['id']+_0x4053bc(0x1f6)+_0x8d9af0[_0x4053bc(0x162)](0x1)+_0x4053bc(0x18b)),_0x54e8ec++;continue;}console['log'](_0x4053bc(0x140)+_0x3f371b['id']+'\x20(age:\x20'+_0x8d9af0[_0x4053bc(0x162)](0x1)+'h)'),await this[_0x4053bc(0x1ab)](_0x3f371b),_0x948e5e++,await new Promise(_0x349fd9=>setTimeout(_0x349fd9,0x7d0));}catch(_0x9ba00c){console['error']('‚ùå\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20'+_0x3f371b['id']+':',_0x9ba00c),this['logCoinToPayError'](_0x3f371b['id'],_0x3f371b[_0x4053bc(0x1fe)]||_0x4053bc(0x207),_0x9ba00c,'status_check',{'isGlobalCheck':!![],'paymentAmount':_0x3f371b['amount'],'paymentCurrency':_0x3f371b[_0x4053bc(0x134)],'shopId':_0x3f371b['shopId'],'createdAt':_0x3f371b[_0x4053bc(0x177)]}),loggerService_1[_0x4053bc(0x1d7)][_0x4053bc(0x188)](_0x4053bc(0x12c),_0x4053bc(0x1ca)+_0x3f371b[_0x4053bc(0x1fe)],_0x9ba00c);}}console['log'](_0x4053bc(0x11a)+_0x948e5e+'\x20checked,\x20'+_0x54e8ec+_0x4053bc(0x109)+_0x68c3b0[_0x4053bc(0x118)]+_0x4053bc(0x104));}catch(_0x5db8aa){console[_0x4053bc(0x171)](_0x4053bc(0x139),_0x5db8aa);}}async[a42_0x30da53(0x14c)](_0x8624dc){const _0x5c6775=a42_0x30da53,_0x463b71=[],_0x51d267=new Date();_0x51d267['setDate'](_0x51d267[_0x5c6775(0x122)]()-this[_0x5c6775(0x13d)]),console['log']('‚è∞\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20'+this[_0x5c6775(0x13d)]+'\x20days\x20(created\x20before\x20'+_0x51d267['toISOString']()+')');for(const _0x1eb56f of _0x8624dc){if(_0x1eb56f['createdAt']<_0x51d267){console[_0x5c6775(0x185)](_0x5c6775(0x16b)+_0x1eb56f['id']+_0x5c6775(0x18c)+this[_0x5c6775(0x13d)]+_0x5c6775(0x1e7));try{this[_0x5c6775(0x1c5)](_0x1eb56f['id'],_0x1eb56f['gatewayPaymentId']||_0x5c6775(0x207),_0x5c6775(0x14b),'EXPIRED',_0x5c6775(0x120),{'reason':_0x5c6775(0x1c3)+this[_0x5c6775(0x13d)]+_0x5c6775(0x1ac),'createdAt':_0x1eb56f['createdAt'],'daysSinceCreation':Math[_0x5c6775(0x167)]((Date[_0x5c6775(0x13c)]()-_0x1eb56f['createdAt'][_0x5c6775(0x219)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x1eb56f['amount'],'paymentCurrency':_0x1eb56f[_0x5c6775(0x134)],'shopId':_0x1eb56f[_0x5c6775(0x130)]}),await database_1[_0x5c6775(0x1bc)][_0x5c6775(0x191)][_0x5c6775(0x143)]({'where':{'id':_0x1eb56f['id']},'data':{'status':_0x5c6775(0x194),'updatedAt':new Date()}}),await database_1['default'][_0x5c6775(0x146)][_0x5c6775(0x18a)]({'data':{'paymentId':_0x1eb56f['id'],'shopId':_0x1eb56f[_0x5c6775(0x130)],'event':_0x5c6775(0x1c1),'statusCode':0xc8,'responseBody':JSON[_0x5c6775(0x1eb)]({'reason':_0x5c6775(0x1c3)+this['EXPIRY_DAYS']+_0x5c6775(0x1ac),'createdAt':_0x1eb56f[_0x5c6775(0x177)],'expiredAt':new Date()['toISOString'](),'daysSinceCreation':Math['floor']((Date[_0x5c6775(0x13c)]()-_0x1eb56f[_0x5c6775(0x177)]['getTime']())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x5c6775(0x204)](_0x1eb56f,_0x5c6775(0x194)),await this[_0x5c6775(0x1e0)](_0x1eb56f,'EXPIRED'),this[_0x5c6775(0x181)](_0x1eb56f['id']),_0x463b71['push'](_0x1eb56f['id']),console[_0x5c6775(0x185)](_0x5c6775(0x1e2)+_0x1eb56f['id']+'\x20marked\x20as\x20EXPIRED\x20due\x20to\x20'+this[_0x5c6775(0x13d)]+_0x5c6775(0x1fd));}catch(_0x738230){console[_0x5c6775(0x171)](_0x5c6775(0x20d)+_0x1eb56f['id']+':',_0x738230),this[_0x5c6775(0x180)](_0x1eb56f['id'],_0x1eb56f['gatewayPaymentId']||_0x5c6775(0x207),_0x738230,_0x5c6775(0x120),{'reason':_0x5c6775(0x201),'createdAt':_0x1eb56f[_0x5c6775(0x177)],'daysSinceCreation':Math[_0x5c6775(0x167)]((Date[_0x5c6775(0x13c)]()-_0x1eb56f[_0x5c6775(0x177)][_0x5c6775(0x219)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x463b71;}async[a42_0x30da53(0x1ab)](_0x5ca41e){const _0x38ca2e=a42_0x30da53;if(!_0x5ca41e[_0x38ca2e(0x1fe)]){console[_0x38ca2e(0x185)](_0x38ca2e(0x1a1)+_0x5ca41e['id']+'\x20has\x20no\x20gatewayPaymentId,\x20skipping');return;}console['log'](_0x38ca2e(0x1f8)+_0x5ca41e[_0x38ca2e(0x18f)]+_0x38ca2e(0x137)+_0x5ca41e['id']+'\x20('+_0x5ca41e[_0x38ca2e(0x1fe)]+')');try{let _0xb8c641;_0x5ca41e[_0x38ca2e(0x18f)]==='cointopay2'?(_0xb8c641=await this['coinToPay2Service'][_0x38ca2e(0x1d4)](_0x5ca41e[_0x38ca2e(0x1fe)]),console[_0x38ca2e(0x185)](_0x38ca2e(0x1f5)+_0x5ca41e['id']+'\x20status:\x20'+_0xb8c641[_0x38ca2e(0x1d1)])):(_0xb8c641=await this['coinToPayService'][_0x38ca2e(0x1d4)](_0x5ca41e[_0x38ca2e(0x1fe)]),console['log'](_0x38ca2e(0x1f3)+_0x5ca41e['id']+_0x38ca2e(0x1a9)+_0xb8c641['status']));_0xb8c641[_0x38ca2e(0x131)]&&console[_0x38ca2e(0x185)](_0x38ca2e(0x138)+_0x5ca41e['id']+_0x38ca2e(0x11b),{'iban':_0xb8c641[_0x38ca2e(0x131)][_0x38ca2e(0x105)]||_0x38ca2e(0x206),'transactionId':_0xb8c641[_0x38ca2e(0x131)][_0x38ca2e(0x1d5)],'createdOn':_0xb8c641[_0x38ca2e(0x131)][_0x38ca2e(0x1d8)],'confirmedOn':_0xb8c641['paymentDetails']['confirmedOn']||'not\x20confirmed'});if(_0xb8c641[_0x38ca2e(0x1d1)]!==_0x5ca41e[_0x38ca2e(0x1d1)]){console['log'](_0x38ca2e(0x200)+_0x5ca41e['id']+'\x20status\x20from\x20'+_0x5ca41e[_0x38ca2e(0x1d1)]+'\x20to\x20'+_0xb8c641[_0x38ca2e(0x1d1)]),this[_0x38ca2e(0x1c5)](_0x5ca41e['id'],_0x5ca41e[_0x38ca2e(0x1fe)],_0x5ca41e[_0x38ca2e(0x1d1)],_0xb8c641[_0x38ca2e(0x1d1)],_0x38ca2e(0x16f),{'paymentDetails':_0xb8c641['paymentDetails'],'amount':_0xb8c641['amount'],'currency':_0xb8c641['currency'],'shopId':_0x5ca41e[_0x38ca2e(0x130)],'checkTimestamp':new Date()[_0x38ca2e(0x1fa)]()});const _0x483ae3={'status':_0xb8c641[_0x38ca2e(0x1d1)],'updatedAt':new Date()};if(_0xb8c641['status']===_0x38ca2e(0x10f)&&_0x5ca41e[_0x38ca2e(0x1d1)]!==_0x38ca2e(0x10f)){_0x483ae3[_0x38ca2e(0x193)]=new Date();if(!_0x5ca41e['amountUSDT']){const _0x2796b4=await currencyService_1[_0x38ca2e(0x102)][_0x38ca2e(0x154)](_0x5ca41e[_0x38ca2e(0x1e3)],_0x5ca41e['currency']);_0x483ae3[_0x38ca2e(0x12a)]=_0x2796b4;const _0x5bc2c1=await this[_0x38ca2e(0x1a2)](_0x5ca41e[_0x38ca2e(0x130)],_0x5ca41e['gateway']),_0x4e7d6a=_0x2796b4*(0x1-_0x5bc2c1/0x64);_0x483ae3[_0x38ca2e(0x16d)]=_0x4e7d6a,_0x483ae3['gatewayCommissionRate']=_0x5bc2c1,console[_0x38ca2e(0x185)](_0x38ca2e(0x15a)+_0x5ca41e['id']+_0x38ca2e(0x157)),console[_0x38ca2e(0x185)](_0x38ca2e(0x1a8)+_0x5ca41e[_0x38ca2e(0x1e3)]+'\x20'+_0x5ca41e[_0x38ca2e(0x134)]+_0x38ca2e(0x1d3)+_0x2796b4[_0x38ca2e(0x162)](0x6)+_0x38ca2e(0x175)),console[_0x38ca2e(0x185)](_0x38ca2e(0x182)+_0x5ca41e[_0x38ca2e(0x18f)]+_0x38ca2e(0x197)+_0x5bc2c1+'%'),console[_0x38ca2e(0x185)](_0x38ca2e(0x1f2)+_0x4e7d6a[_0x38ca2e(0x162)](0x6)+_0x38ca2e(0x175));}console[_0x38ca2e(0x185)]('üí∞\x20[CHECK]\x20Payment\x20'+_0x5ca41e['id']+'\x20marked\x20as\x20paid\x20at:\x20'+_0x483ae3['paidAt']['toISOString']());}if(_0xb8c641[_0x38ca2e(0x131)]){const _0x3b563f=_0xb8c641['paymentDetails'];_0x3b563f[_0x38ca2e(0x105)]&&(_0x483ae3[_0x38ca2e(0x199)]=_0x3b563f[_0x38ca2e(0x105)],console[_0x38ca2e(0x185)](_0x38ca2e(0x195)+_0x3b563f[_0x38ca2e(0x105)])),_0x3b563f[_0x38ca2e(0x161)]&&console[_0x38ca2e(0x185)](_0x38ca2e(0x173)+_0x3b563f['bankDetails']),_0x3b563f[_0x38ca2e(0x1d5)]&&console[_0x38ca2e(0x185)](_0x38ca2e(0x1ce)+_0x3b563f[_0x38ca2e(0x1d5)]),_0x3b563f[_0x38ca2e(0x1b6)]&&console['log'](_0x38ca2e(0x183)+_0x3b563f[_0x38ca2e(0x1b6)]);}await database_1[_0x38ca2e(0x1bc)][_0x38ca2e(0x191)][_0x38ca2e(0x143)]({'where':{'id':_0x5ca41e['id']},'data':_0x483ae3});if(_0xb8c641[_0x38ca2e(0x1d1)]===_0x38ca2e(0x10f)&&_0x5ca41e[_0x38ca2e(0x1d1)]!==_0x38ca2e(0x10f)){console[_0x38ca2e(0x185)]('üìà\x20[COINTOPAY]\x20Payment\x20'+_0x5ca41e['id']+_0x38ca2e(0x168));const _0x43021=await database_1[_0x38ca2e(0x1bc)][_0x38ca2e(0x191)][_0x38ca2e(0x17b)]({'where':{'id':_0x5ca41e['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x43021?.[_0x38ca2e(0x1ae)]&&_0x43021[_0x38ca2e(0x1cc)])try{const _0x1a75e9=_0x43021[_0x38ca2e(0x1cc)];console['log'](_0x38ca2e(0x208)+_0x1a75e9['id']+_0x38ca2e(0x1c8)+_0x1a75e9[_0x38ca2e(0x1e6)]+_0x38ca2e(0x1bb)+_0x1a75e9[_0x38ca2e(0x189)]+',\x20status='+_0x1a75e9[_0x38ca2e(0x1d1)]);const _0x480ea4=_0x1a75e9[_0x38ca2e(0x189)]+0x1,_0x125ad7=_0x1a75e9[_0x38ca2e(0x1e6)]===_0x38ca2e(0x155)?_0x38ca2e(0x151):_0x1a75e9[_0x38ca2e(0x1d1)];await database_1[_0x38ca2e(0x1bc)]['paymentLink'][_0x38ca2e(0x143)]({'where':{'id':_0x1a75e9['id']},'data':{'currentPayments':_0x480ea4,'status':_0x125ad7,'updatedAt':new Date()}}),console['log'](_0x38ca2e(0x156)+_0x1a75e9['id']+_0x38ca2e(0x1bf)+_0x1a75e9['currentPayments']+_0x38ca2e(0x1d3)+_0x480ea4+_0x38ca2e(0x11f)+_0x1a75e9[_0x38ca2e(0x1d1)]+_0x38ca2e(0x1d3)+_0x125ad7);}catch(_0xf62148){console[_0x38ca2e(0x171)](_0x38ca2e(0x1cd),_0xf62148);}else console['log'](_0x38ca2e(0x1ba)+_0x5ca41e['id']+_0x38ca2e(0x10e));}await database_1[_0x38ca2e(0x1bc)][_0x38ca2e(0x146)][_0x38ca2e(0x18a)]({'data':{'paymentId':_0x5ca41e['id'],'shopId':_0x5ca41e[_0x38ca2e(0x130)],'event':_0x38ca2e(0x13f)+_0xb8c641[_0x38ca2e(0x1d1)]['toLowerCase'](),'statusCode':0xc8,'responseBody':JSON[_0x38ca2e(0x1eb)]({'oldStatus':_0x5ca41e[_0x38ca2e(0x1d1)],'newStatus':_0xb8c641[_0x38ca2e(0x1d1)],'paymentDetails':_0xb8c641[_0x38ca2e(0x131)],'checkedAt':new Date()[_0x38ca2e(0x1fa)]()})}}),await this['sendShopWebhook'](_0x5ca41e,_0xb8c641[_0x38ca2e(0x1d1)]),await this['sendPaymentStatusNotification'](_0x5ca41e,_0xb8c641['status']),_0xb8c641[_0x38ca2e(0x1d1)]!=='PENDING'&&(console[_0x38ca2e(0x185)](_0x38ca2e(0x186)+_0x5ca41e['id']+_0x38ca2e(0x170)+_0xb8c641[_0x38ca2e(0x1d1)]+_0x38ca2e(0x1d2)),this[_0x38ca2e(0x181)](_0x5ca41e['id'])),console[_0x38ca2e(0x185)](_0x38ca2e(0x125)+_0x5ca41e['id']+_0x38ca2e(0x10a));}else console[_0x38ca2e(0x185)](_0x38ca2e(0x138)+_0x5ca41e['id']+'\x20status\x20unchanged\x20('+_0xb8c641['status']+')'),this[_0x38ca2e(0x1c5)](_0x5ca41e['id'],_0x5ca41e[_0x38ca2e(0x1fe)],_0x5ca41e['status'],_0xb8c641[_0x38ca2e(0x1d1)],_0x38ca2e(0x16f),{'statusUnchanged':!![],'paymentDetails':_0xb8c641[_0x38ca2e(0x131)],'amount':_0xb8c641[_0x38ca2e(0x1e3)],'currency':_0xb8c641['currency'],'shopId':_0x5ca41e[_0x38ca2e(0x130)],'checkTimestamp':new Date()[_0x38ca2e(0x1fa)]()});}catch(_0x2c9f79){console[_0x38ca2e(0x171)](_0x38ca2e(0x1bd)+_0x5ca41e['id']+':',_0x2c9f79),this['logCoinToPayError'](_0x5ca41e['id'],_0x5ca41e[_0x38ca2e(0x1fe)],_0x2c9f79,'status_check',{'paymentAmount':_0x5ca41e['amount'],'paymentCurrency':_0x5ca41e[_0x38ca2e(0x134)],'shopId':_0x5ca41e[_0x38ca2e(0x130)],'createdAt':_0x5ca41e[_0x38ca2e(0x177)]}),await database_1[_0x38ca2e(0x1bc)]['webhookLog'][_0x38ca2e(0x18a)]({'data':{'paymentId':_0x5ca41e['id'],'shopId':_0x5ca41e[_0x38ca2e(0x130)],'event':_0x38ca2e(0x13b),'statusCode':0x1f4,'responseBody':JSON[_0x38ca2e(0x1eb)]({'error':_0x2c9f79 instanceof Error?_0x2c9f79[_0x38ca2e(0x1de)]:_0x38ca2e(0x1da),'gatewayPaymentId':_0x5ca41e[_0x38ca2e(0x1fe)],'checkedAt':new Date()['toISOString']()})}});}}async[a42_0x30da53(0x204)](_0x4f04a4,_0x6be65c){const _0x2a1e7e=a42_0x30da53,_0x3296b6=Date['now']();try{const _0x29b823=_0x4f04a4[_0x2a1e7e(0x209)],_0x3d1300=_0x29b823[_0x2a1e7e(0x128)];if(!_0x3d1300?.[_0x2a1e7e(0x135)]){console[_0x2a1e7e(0x185)](_0x2a1e7e(0x14a)+_0x29b823['id']);return;}const _0x516e70=_0x6be65c===_0x2a1e7e(0x10f)?_0x2a1e7e(0x1fc):_0x6be65c===_0x2a1e7e(0x15c)?_0x2a1e7e(0x1aa):_0x6be65c===_0x2a1e7e(0x194)?_0x2a1e7e(0x1aa):_0x2a1e7e(0x111);if(!_0x3d1300[_0x2a1e7e(0x1dc)]?.[_0x2a1e7e(0x15e)](_0x516e70)){console[_0x2a1e7e(0x185)](_0x2a1e7e(0x1a5)+_0x516e70+_0x2a1e7e(0x1d9)+_0x29b823['id']);return;}const _0x95a2c3=(0x0,gateway_1[_0x2a1e7e(0x1b9)])(_0x4f04a4['gateway'])||_0x4f04a4[_0x2a1e7e(0x18f)],_0x14f107={'event':_0x516e70,'payment':{'id':_0x4f04a4['id'],'order_id':_0x4f04a4[_0x2a1e7e(0x150)],'gateway_order_id':_0x4f04a4[_0x2a1e7e(0x142)],'gateway':_0x95a2c3,'amount':_0x4f04a4[_0x2a1e7e(0x1e3)],'currency':_0x4f04a4['currency'],'status':_0x6be65c[_0x2a1e7e(0x164)](),'customer_email':_0x4f04a4[_0x2a1e7e(0x15f)],'customer_name':_0x4f04a4[_0x2a1e7e(0x129)],'created_at':_0x4f04a4[_0x2a1e7e(0x177)],'updated_at':new Date()}},_0x1a12d1=await fetch(_0x3d1300['webhookUrl'],{'method':_0x2a1e7e(0x214),'headers':{'Content-Type':_0x2a1e7e(0x1dd),'User-Agent':_0x2a1e7e(0x18d)},'body':JSON[_0x2a1e7e(0x1eb)](_0x14f107)}),_0x272d50=Date['now']()-_0x3296b6,_0x507d13=_0x1a12d1['ok']?_0x2a1e7e(0x152):await _0x1a12d1['text']();loggerService_1[_0x2a1e7e(0x1d7)][_0x2a1e7e(0x1be)](_0x4f04a4[_0x2a1e7e(0x130)],_0x3d1300[_0x2a1e7e(0x135)],_0x516e70,_0x1a12d1[_0x2a1e7e(0x1d1)],_0x272d50,_0x14f107),console[_0x2a1e7e(0x185)](_0x2a1e7e(0x126)+_0x3d1300[_0x2a1e7e(0x135)]+_0x2a1e7e(0x1c7)+_0x1a12d1[_0x2a1e7e(0x1d1)]+'\x20('+_0x272d50+_0x2a1e7e(0x1fb));}catch(_0x19055b){console[_0x2a1e7e(0x171)]('Failed\x20to\x20send\x20shop\x20webhook:',_0x19055b),loggerService_1[_0x2a1e7e(0x1d7)][_0x2a1e7e(0x1db)](_0x4f04a4[_0x2a1e7e(0x130)],_0x4f04a4['shop']?.['settings']?.[_0x2a1e7e(0x135)]||'unknown',_0x2a1e7e(0x123),_0x19055b,{});}}async['sendPaymentStatusNotification'](_0x7a5505,_0x30451d){const _0xbf6110=a42_0x30da53;try{const _0x2ec084={'PENDING':'created','PAID':_0xbf6110(0x1d0),'FAILED':_0xbf6110(0x1b2),'EXPIRED':'expired'},_0x307134=_0x2ec084[_0x30451d];if(!_0x307134||_0x307134===_0xbf6110(0x18e))return;await telegramBotService_1[_0xbf6110(0x108)][_0xbf6110(0x1f9)](_0x7a5505['shopId'],_0x7a5505,_0x307134);}catch(_0x3927a7){console[_0xbf6110(0x171)](_0xbf6110(0x17a),_0x3927a7);}}async[a42_0x30da53(0x1ff)](_0x242485){const _0x14e793=a42_0x30da53;console[_0x14e793(0x185)](_0x14e793(0x163)+_0x242485);const _0x4031ba=await database_1['default'][_0x14e793(0x191)][_0x14e793(0x17b)]({'where':{'id':_0x242485},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x4031ba)throw new Error('Payment\x20not\x20found');if(_0x4031ba[_0x14e793(0x18f)]!==_0x14e793(0x12c)&&_0x4031ba[_0x14e793(0x18f)]!==_0x14e793(0x113))throw new Error(_0x14e793(0x198));console[_0x14e793(0x185)](_0x14e793(0x11c)+_0x4031ba[_0x14e793(0x18f)]+_0x14e793(0x137)+_0x242485),await this[_0x14e793(0x1ab)](_0x4031ba),console[_0x14e793(0x185)](_0x14e793(0x114)+_0x242485);}[a42_0x30da53(0x144)](){const _0x22c272=a42_0x30da53,_0x146b29=this[_0x22c272(0x17f)]?this[_0x22c272(0x1af)]:undefined,_0x3a1207=Array[_0x22c272(0x115)](this[_0x22c272(0x203)][_0x22c272(0x19f)]())[_0x22c272(0x11e)](_0x10a65a=>({'paymentId':_0x10a65a['paymentId'],'gatewayPaymentId':_0x10a65a[_0x22c272(0x1fe)],'createdAt':_0x10a65a['createdAt'],'timersCount':_0x10a65a['timers'][_0x22c272(0x118)]}));return{'isActive':!!this[_0x22c272(0x17f)],'globalCheckIntervalMinutes':this[_0x22c272(0x1af)]/(0x3e8*0x3c),'expiryDays':this[_0x22c272(0x13d)],'activeIndividualTimers':this['paymentTimers'][_0x22c272(0x15d)],'nextGlobalCheckIn':_0x146b29,'paymentTimersDetails':_0x3a1207};}[a42_0x30da53(0x16e)](_0x1d64ad){const _0x383cf2=a42_0x30da53,_0x2dd707=this[_0x383cf2(0x203)]['get'](_0x1d64ad);if(_0x2dd707)return{'hasTimers':!![],'timersCount':_0x2dd707[_0x383cf2(0x1c6)][_0x383cf2(0x118)],'createdAt':_0x2dd707['createdAt'],'gatewayPaymentId':_0x2dd707[_0x383cf2(0x1fe)]};return{'hasTimers':![]};}async[a42_0x30da53(0x1a2)](_0xcf2ba9,_0x3daa51){const _0x3f5bd8=a42_0x30da53;try{const _0x34f430=await database_1[_0x3f5bd8(0x1bc)][_0x3f5bd8(0x209)][_0x3f5bd8(0x17b)]({'where':{'id':_0xcf2ba9},'select':{'gatewaySettings':!![]}});if(!_0x34f430?.[_0x3f5bd8(0x1b4)])return console['log'](_0x3f5bd8(0x1cf)+_0xcf2ba9+_0x3f5bd8(0x110)),0xa;const _0x379f6f=JSON[_0x3f5bd8(0x106)](_0x34f430[_0x3f5bd8(0x1b4)]);for(const [_0x5359b4,_0x3cf93b]of Object[_0x3f5bd8(0x12f)](_0x379f6f)){if(_0x5359b4[_0x3f5bd8(0x164)]()===_0x3daa51[_0x3f5bd8(0x164)]()){const _0x5857c5=_0x3cf93b[_0x3f5bd8(0x166)]||0xa;return console[_0x3f5bd8(0x185)](_0x3f5bd8(0x1a3)+_0x3daa51+_0x3f5bd8(0x215)+_0xcf2ba9+':\x20'+_0x5857c5+'%'),_0x5857c5;}}return console[_0x3f5bd8(0x185)]('No\x20specific\x20commission\x20found\x20for\x20gateway\x20'+_0x3daa51+_0x3f5bd8(0x124)+_0xcf2ba9+_0x3f5bd8(0x1c4)),0xa;}catch(_0xacc0c){return console['error'](_0x3f5bd8(0x169)+_0xcf2ba9+_0x3f5bd8(0x145)+_0x3daa51+':',_0xacc0c),0xa;}}}function a42_0x547b(){const _0x1740a8=['‚ùå\x20[CHECK]\x20Payment\x20','üè¶\x20[CHECK]\x20Bank\x20details\x20provided:\x20','./currencyService','\x20USDT','‚úÖ\x20[DEBUG]\x20Successfully\x20scheduled\x20','createdAt','CoinToPayStatusService','1627131ukswYH','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','findUnique','\x20not\x20found,\x20clearing\x20timers','./gateways/coinToPay2Service','ü™ô\x20[ERROR]\x20CoinToPay\x20Error:\x20','globalCheckInterval','logCoinToPayError','clearPaymentTimers','\x20\x20\x20Gateway\x20','‚úÖ\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','üìä\x20[HOURLY]\x20Payment\x20','log','üßπ\x20[CHECK]\x20Payment\x20','78118BgUqBA','logWhiteDomainError','currentPayments','create','h),\x20skipping\x20global\x20check','\x20is\x20older\x20than\x20','Payment\x20System/1.0','created','gateway','ü™ô\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','payment','\x20\x20\x20üìù\x20Details:','paidAt','EXPIRED','üè¶\x20[CHECK]\x20Saved\x20IBAN:\x20','üõë\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','\x20commission:\x20','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','remitterIban','\x20\x20\x20üìä\x20Status:\x20','\x20\x20\x20-\x20GatewayPaymentId:\x20','\x20initial\x20timers\x20for\x20payment\x20','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','‚è∞\x20[DEBUG]\x20Scheduled\x20check\x20#','values','\x20\x20\x20-\x20Gateway:\x20','‚ö†Ô∏è\x20[CHECK]\x20Payment\x20','getGatewayCommission','Gateway\x20',',\x20stopping\x20individual\x20checks','Webhook\x20event\x20','2\x20minutes','delete','\x20\x20\x20Amount:\x20','\x20status:\x20','payment.failed','checkSinglePayment','\x20days','stopPeriodicStatusCheck','paymentLinkId','GLOBAL_CHECK_INTERVAL_MS','__importDefault','5gsteip','failed','\x20\x20\x20-\x20ShopId:\x20','gatewaySettings','description','confirmedOn','5695683rfIZuJ','üõë\x20[SHUTDOWN]\x20Cleared\x20','getGatewayIdByName','üìà\x20[COINTOPAY]\x20Payment\x20',',\x20currentPayments=','default','‚ùå\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','logShopWebhookSent','\x20updated:\x20currentPayments=','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','cointopay_auto_expired','‚è∞\x20[GLOBAL]\x20Payment\x20','Payment\x20older\x20than\x20',',\x20using\x20default\x2010%','logCoinToPayStatus','timers','\x20with\x20status\x20',':\x20type=','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','/status/','\x20\x20\x20-\x20Status:\x20','paymentLink','‚ùå\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','üÜî\x20[CHECK]\x20Transaction\x20ID:\x20','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','paid','status',',\x20clearing\x20individual\x20timers','\x20->\x20','checkPaymentStatus','transactionId','timestamp','loggerService','createdOn','\x20not\x20enabled\x20for\x20shop\x20','Unknown\x20error','logShopWebhookError','webhookEvents','application/json','message','ü™ô\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','sendPaymentStatusNotification','\x20\x20\x20üìù\x20Context:','‚úÖ\x20[EXPIRY]\x20Payment\x20','amount','\x20completed\x20for\x20payment\x20','\x20\x20\x20üìÖ\x20Time:\x20','type','\x20days,\x20marking\x20as\x20EXPIRED','coinToPayStatusService','‚úÖ\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','checkAllPendingPayments','stringify','push','startPeriodicStatusCheck','checkSinglePaymentById','../config/database','ü™ô\x20[GLOBAL]\x20Found\x20','CoinToPayService','\x20\x20\x20Amount\x20after\x20commission:\x20','üìä\x20[CHECK]\x20CoinToPay\x20payment\x20','ü™ô\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','üìä\x20[CHECK]\x20CoinToPay2\x20payment\x20','\x20is\x20too\x20new\x20(','‚ùå\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','üîç\x20[CHECK]\x20Checking\x20','sendPaymentNotification','toISOString','ms)','payment.success','-day\x20timeout','gatewayPaymentId','checkPaymentById','üîÑ\x20[CHECK]\x20Updating\x20payment\x20','Failed\x20to\x20mark\x20payment\x20as\x20expired','has','paymentTimers','sendShopWebhook','delay','not\x20found','unknown','üìà\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','shop','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','‚úÖ\x20[HOURLY]\x20Payment\x20','3952644SdbpZh','‚ùå\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','\x20is\x20valid\x20for\x20checking,\x20proceeding...','schedule_created','335840qlebxr','üßπ\x20[DEBUG]\x20Clearing\x20','‚úÖ\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','COINTOPAY_STATUS_CHANGE','POST','\x20commission\x20for\x20shop\x20','findMany','\x20triggered\x20for\x20payment\x20','üõë\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','getTime','currencyService','\x20has\x20no\x20gatewayPaymentId','\x20expired','iban','parse','5\x20minutes','telegramBotService','\x20skipped,\x20','\x20updated\x20successfully','schedulePaymentChecks','\x20expired\x20CoinToPay\x20payments','\x20\x20\x20-\x20Amount:\x20','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','PAID',',\x20using\x20default\x20commission\x2010%','payment.pending','./telegramBotService','cointopay2','‚úÖ\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','from','ü™ô\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','\x20\x20\x20üìç\x20Source:\x20','length','.\x20Remaining\x20active\x20timers:\x20','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','\x20details:','‚úÖ\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','forEach','map',',\x20status=','auto_expire','‚ùå\x20[TIMER]\x20Failed\x20individual\x20check\x20#','getDate','webhook_send','\x20in\x20shop\x20','‚úÖ\x20[CHECK]\x20Payment\x20','Shop\x20webhook\x20sent\x20to\x20','__esModule','settings','customerName','amountUSDT','‚ùå\x20[HOURLY]\x20Payment\x20','cointopay','\x20\x20\x20-\x20paymentId:\x20','ü™ô\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','entries','shopId','paymentDetails','\x20status\x20is\x20','üßπ\x20[DEBUG]\x20Cleared\x20timer\x20#','currency','webhookUrl','\x20in\x20','\x20payment\x20','üìä\x20[CHECK]\x20Payment\x20','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','\x20to\x20clear','cointopay_status_check_error','now','EXPIRY_DAYS','‚ùå\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','cointopay_status_check_','üîç\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','13FHLkXJ','gatewayOrderId','update','getServiceStats',',\x20gateway\x20','webhookLog','../types/gateway','\x20for\x20payment\x20','4776472vhXJko','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','PENDING','checkExpiredPayments','\x20\x20\x20-\x20gatewayPaymentId:\x20','\x20pending\x20CoinToPay\x20payments','\x20not\x20found\x20in\x20database','orderId','COMPLETED','Success','‚ùå\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','convertToUSDT','SINGLE','‚úÖ\x20[COINTOPAY]\x20Payment\x20link\x20','\x20amounts\x20calculated:','13200966xjZsYX','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','üí∞\x20[CHECK]\x20Payment\x20','defineProperty','FAILED','size','includes','customerEmail','‚è∞\x20[HOURLY]\x20Payment\x20','bankDetails','toFixed','üîç\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','toLowerCase','\x20timers\x20for\x20payment\x20','commission','floor','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','‚ö†Ô∏è\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','‚è∞\x20[EXPIRY]\x20Payment\x20','coinToPayService','amountAfterGatewayCommissionUSDT','getPaymentTimerInfo','status_check','\x20status\x20changed\x20to\x20','error'];a42_0x547b=function(){return _0x1740a8;};return a42_0x547b();}exports[a42_0x30da53(0x178)]=CoinToPayStatusService,exports['coinToPayStatusService']=new CoinToPayStatusService();