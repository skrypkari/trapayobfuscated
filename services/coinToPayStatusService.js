'use strict';const a38_0x5e040b=a38_0x3adf;(function(_0x35896a,_0x3a1ef2){const _0x323a22=a38_0x3adf,_0x3ff372=_0x35896a();while(!![]){try{const _0x2ff641=parseInt(_0x323a22(0x1f4))/0x1*(parseInt(_0x323a22(0x24f))/0x2)+parseInt(_0x323a22(0x1a6))/0x3+parseInt(_0x323a22(0x1c4))/0x4*(-parseInt(_0x323a22(0x23f))/0x5)+-parseInt(_0x323a22(0x19b))/0x6*(parseInt(_0x323a22(0x286))/0x7)+parseInt(_0x323a22(0x269))/0x8+parseInt(_0x323a22(0x232))/0x9+-parseInt(_0x323a22(0x25f))/0xa*(parseInt(_0x323a22(0x1cf))/0xb);if(_0x2ff641===_0x3a1ef2)break;else _0x3ff372['push'](_0x3ff372['shift']());}catch(_0x5471c2){_0x3ff372['push'](_0x3ff372['shift']());}}}(a38_0x4a4c,0x21a39));function a38_0x4a4c(){const _0x1ad2d0=['coinToPay2Service','EXPIRED','\x20\x20\x20Amount\x20after\x20commission:\x20','.\x20Remaining\x20active\x20timers:\x20','create','\x20\x20\x20üìç\x20Source:\x20','‚ùå\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','\x20\x20\x20‚ùå\x20Error:\x20','now','paymentTimers','üõë\x20[SHUTDOWN]\x20Cleared\x20','224778zlhNwn','checkSinglePayment','\x20status\x20is\x20','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','failed','\x20payment\x20','type','paymentId','SINGLE','getServiceStats','paymentLink','248424lcNDZF','findUnique','‚ö†Ô∏è\x20[CHECK]\x20Payment\x20','\x20\x20\x20-\x20Gateway:\x20','sendShopWebhook','\x20\x20\x20-\x20paymentId:\x20','\x20in\x20shop\x20','values','bankDetails','webhook_send','‚úÖ\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','confirmedOn','./telegramBotService','‚ùå\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','./gateways/coinToPay2Service','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','‚è∞\x20[GLOBAL]\x20Found\x20','has','ü™ô\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','\x20has\x20no\x20gatewayPaymentId','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','‚ùå\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','unknown','\x20\x20\x20-\x20gatewayPaymentId:\x20','üè¶\x20[CHECK]\x20Saved\x20IBAN:\x20','set','from','\x20with\x20status\x20','\x20expired\x20CoinToPay\x20payments','checkPaymentStatus','12032hXRZWD','\x20skipped,\x20','paid','adminNotes','checkPaymentById','checkExpiredPayments','üìä\x20[CHECK]\x20CoinToPay2\x20payment\x20','Automatically\x20expired\x20after\x20','PENDING','currentPayments','map','1052029OibViP','EXPIRY_DAYS','toLowerCase','cointopay_status_check_error','\x20(after\x20','‚úÖ\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','transactionId','‚úÖ\x20[CHECK]\x20Payment\x20','checkAllPendingPayments','message','\x20updated:\x20currentPayments=','stopPeriodicStatusCheck','payment.success','\x20\x20\x20-\x20GatewayPaymentId:\x20','payment.pending','üìä\x20[CHECK]\x20Payment\x20','\x20seconds\x20(','\x20expired','üí∞\x20[CHECK]\x20Payment\x20','toFixed',',\x20stopping\x20individual\x20checks','\x20status:\x20','checkSinglePaymentById','settings','\x20current\x20status:\x20','stack','status','\x20->\x20','-day\x20timeout','COINTOPAY_STATUS_CHANGE','webhookEvents','\x20\x20\x20üìä\x20Status:\x20','text','Payment\x20not\x20found','toISOString','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','amount','61OvCmxu','Payment\x20older\x20than\x20','ü™ô\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)',',\x20clearing\x20individual\x20timers','./loggerService','logCoinToPayStatus','‚è∞\x20[HOURLY]\x20Payment\x20','gatewayPaymentId','gatewayCommissionRate','shop','\x20individual\x20payment\x20timers','description','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','CoinToPayStatusService','ü™ô\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','sendPaymentStatusNotification','\x20\x20\x20Gateway\x20','paidAt','\x20timers\x20for\x20payment\x20','created','floor','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','\x20triggered\x20for\x20payment\x20','\x20not\x20found\x20in\x20database','amountUSDT','remitterIban','‚úÖ\x20[COINTOPAY]\x20Payment\x20link\x20','\x20commission\x20for\x20shop\x20','gateway','expired','push','‚úÖ\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','\x20\x20\x20üìù\x20Details:','\x20USDT','ü™ô\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','delete','\x20days,\x20marking\x20as\x20EXPIRED','\x20pending\x20CoinToPay\x20payments',':\x20type=','size','get','ü™ô\x20[ERROR]\x20CoinToPay\x20Error:\x20','timers','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','default','logCoinToPayError','‚úÖ\x20[EXPIRY]\x20Payment\x20','paymentDetails','\x20marked\x20as\x20paid\x20at:\x20','\x20\x20\x20-\x20Amount:\x20','\x20updated\x20successfully','parse','./currencyService','length','üßπ\x20[DEBUG]\x20Cleared\x20timer\x20#','üìä\x20[HOURLY]\x20Payment\x20','commission','Failed\x20to\x20mark\x20payment\x20as\x20expired','\x20is\x20older\x20than\x20','defineProperty','‚úÖ\x20[DEBUG]\x20Successfully\x20scheduled\x20','\x20amounts\x20calculated:','2116224ALwcGw','stringify','globalCheckInterval','sendPaymentNotification','Failed\x20to\x20send\x20shop\x20webhook:','\x20days','No\x20specific\x20commission\x20found\x20for\x20gateway\x20','loggerService',',\x20status=','createdAt','TesSoft\x20Payment\x20System/1.0','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','convertToUSDT','160CCauSJ','currency','\x20\x20\x20Amount:\x20','ü™ô\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','ü™ô\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','\x20for\x20payment\x20','shopId','getGatewayIdByName','schedule_created','\x20\x20\x20-\x20Status:\x20','‚ùå\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','logShopWebhookError','\x20\x20\x20-\x20ShopId:\x20','\x20status\x20unchanged\x20(','payment','3862PmpqBL','not\x20confirmed','iban','entries','timestamp','__importDefault','ü™ô\x20[TIMER]\x20Individual\x20check\x20#','‚è∞\x20[DEBUG]\x20Scheduled\x20check\x20#','gatewayOrderId','webhookUrl','log','__esModule','ü™ô\x20[DEBUG]\x20Creating\x20','PAID','üÜî\x20[CHECK]\x20Transaction\x20ID:\x20','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','10UPSSkv','‚ùå\x20[CHECK]\x20Payment\x20','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','status_check','webhookLog','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','getDate','cointopay_status_check_',',\x20using\x20default\x2010%','/status/','949784NhKXZS','clearPaymentTimers','5\x20minutes','update',',\x20currentPayments=','auto_expire','Shop\x20webhook\x20sent\x20to\x20','h),\x20skipping\x20global\x20check','\x20status\x20from\x20','delay','üõë\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','‚úÖ\x20[HOURLY]\x20Payment\x20','forEach','getGatewayCommission','‚ùå\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','üîÑ\x20[CHECK]\x20Updating\x20payment\x20','setDate','currencyService','\x20\x20\x20üìù\x20Context:','payment.failed','gatewaySettings','Bank\x20Details:\x20','error','cointopay2','POST','‚ùå\x20[TIMER]\x20Failed\x20individual\x20check\x20#','coinToPayService','‚è∞\x20[EXPIRY]\x20Payment\x20','42LfDJLZ','GLOBAL_CHECK_INTERVAL_MS','2\x20minutes','logShopWebhookSent','\x20days\x20(created\x20before\x20','üìà\x20[COINTOPAY]\x20Payment\x20','application/json','cointopay','includes','getTime','coinToPayStatusService','schedulePaymentChecks','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','CoinToPay2Service','Webhook\x20event\x20','1\x20minute'];a38_0x4a4c=function(){return _0x1ad2d0;};return a38_0x4a4c();}var __importDefault=this&&this[a38_0x5e040b(0x254)]||function(_0x10dbb2){const _0x316e83=a38_0x5e040b;return _0x10dbb2&&_0x10dbb2[_0x316e83(0x25a)]?_0x10dbb2:{'default':_0x10dbb2};};Object[a38_0x5e040b(0x22f)](exports,a38_0x5e040b(0x25a),{'value':!![]}),exports[a38_0x5e040b(0x290)]=exports[a38_0x5e040b(0x201)]=void 0x0;function a38_0x3adf(_0x3ce41f,_0x4717bf){const _0x4a4c4d=a38_0x4a4c();return a38_0x3adf=function(_0x3adf25,_0x3c18f8){_0x3adf25=_0x3adf25-0x193;let _0x497003=_0x4a4c4d[_0x3adf25];return _0x497003;},a38_0x3adf(_0x3ce41f,_0x4717bf);}const coinToPayService_1=require('./gateways/coinToPayService'),coinToPay2Service_1=require(a38_0x5e040b(0x1b4)),gateway_1=require('../types/gateway'),database_1=__importDefault(require('../config/database')),telegramBotService_1=require(a38_0x5e040b(0x1b2)),loggerService_1=require(a38_0x5e040b(0x1f8)),currencyService_1=require(a38_0x5e040b(0x228));class CoinToPayStatusService{constructor(){const _0x56b060=a38_0x5e040b;this['globalCheckInterval']=null,this[_0x56b060(0x287)]=0x3c*0x3c*0x3e8,this[_0x56b060(0x1d0)]=0x5,this[_0x56b060(0x199)]=new Map(),this[_0x56b060(0x284)]=new coinToPayService_1['CoinToPayService'](),this['coinToPay2Service']=new coinToPay2Service_1[(_0x56b060(0x293))](),console[_0x56b060(0x259)](_0x56b060(0x202));}[a38_0x5e040b(0x291)](_0x51bb48,_0x167afe){const _0x3c3988=a38_0x5e040b;console[_0x3c3988(0x259)]('ü™ô\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:'),console[_0x3c3988(0x259)](_0x3c3988(0x1ab)+_0x51bb48),console[_0x3c3988(0x259)](_0x3c3988(0x1bd)+_0x167afe),this['clearPaymentTimers'](_0x51bb48);const _0x281a50=[],_0x37b621=new Date(),_0x192e3f=[{'delay':0x1*0x3c*0x3e8,'description':_0x3c3988(0x295)},{'delay':0x2*0x3c*0x3e8,'description':_0x3c3988(0x288)},{'delay':0x5*0x3c*0x3e8,'description':_0x3c3988(0x26b)},{'delay':0x5*0x3c*0x3e8,'description':_0x3c3988(0x26b)}];console['log'](_0x3c3988(0x25b)+_0x192e3f[_0x3c3988(0x229)]+'\x20initial\x20timers\x20for\x20payment\x20'+_0x51bb48);let _0x859e94=0x0;_0x192e3f['forEach']((_0x2bb6fb,_0x62d786)=>{const _0x8faeb3=_0x3c3988;_0x859e94+=_0x2bb6fb[_0x8faeb3(0x272)];const _0x20b5a5=setTimeout(async()=>{const _0x17679c=_0x8faeb3;console[_0x17679c(0x259)](_0x17679c(0x255)+(_0x62d786+0x1)+_0x17679c(0x20a)+_0x51bb48+_0x17679c(0x1d3)+_0x2bb6fb[_0x17679c(0x1ff)]+')');try{await this[_0x17679c(0x1e5)](_0x51bb48),console[_0x17679c(0x259)]('‚úÖ\x20[TIMER]\x20Individual\x20check\x20#'+(_0x62d786+0x1)+'\x20completed\x20for\x20payment\x20'+_0x51bb48);}catch(_0x3b0e4f){console[_0x17679c(0x280)](_0x17679c(0x283)+(_0x62d786+0x1)+_0x17679c(0x245)+_0x51bb48+':',_0x3b0e4f),this[_0x17679c(0x221)](_0x51bb48,_0x167afe,_0x3b0e4f,_0x17679c(0x262),{'checkNumber':_0x62d786+0x1,'scheduledAfter':_0x2bb6fb[_0x17679c(0x1ff)],'isIndividualCheck':!![]});}},_0x859e94);_0x281a50['push'](_0x20b5a5),console[_0x8faeb3(0x259)](_0x8faeb3(0x256)+(_0x62d786+0x1)+'\x20for\x20payment\x20'+_0x51bb48+'\x20in\x20'+_0x859e94/0x3e8+_0x8faeb3(0x1df)+_0x2bb6fb['description']+')');});const _0x129744=setInterval(async()=>{const _0x38ed91=_0x3c3988;console[_0x38ed91(0x259)]('ü™ô\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20'+_0x51bb48);try{const _0x48663d=await database_1['default'][_0x38ed91(0x24e)][_0x38ed91(0x1a7)]({'where':{'id':_0x51bb48},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x48663d){console['log']('‚ùå\x20[HOURLY]\x20Payment\x20'+_0x51bb48+'\x20not\x20found,\x20clearing\x20timers'),this[_0x38ed91(0x26a)](_0x51bb48);return;}console['log'](_0x38ed91(0x22b)+_0x51bb48+_0x38ed91(0x1e7)+_0x48663d['status']);if(_0x48663d[_0x38ed91(0x1e9)]!==_0x38ed91(0x1cc)){console[_0x38ed91(0x259)](_0x38ed91(0x275)+_0x51bb48+_0x38ed91(0x19d)+_0x48663d[_0x38ed91(0x1e9)]+_0x38ed91(0x1e3)),this[_0x38ed91(0x26a)](_0x51bb48);return;}const _0x2bd7a7=Math[_0x38ed91(0x208)]((Date[_0x38ed91(0x198)]()-_0x48663d['createdAt']['getTime']())/(0x3e8*0x3c*0x3c*0x18));if(_0x2bd7a7>=this[_0x38ed91(0x1d0)]){console[_0x38ed91(0x259)](_0x38ed91(0x1fa)+_0x51bb48+'\x20is\x20older\x20than\x20'+this['EXPIRY_DAYS']+_0x38ed91(0x19e)),this[_0x38ed91(0x26a)](_0x51bb48);return;}await this[_0x38ed91(0x1e5)](_0x51bb48),console[_0x38ed91(0x259)](_0x38ed91(0x1d4)+_0x51bb48);}catch(_0x2c5991){console[_0x38ed91(0x280)](_0x38ed91(0x24a)+_0x51bb48+':',_0x2c5991),this[_0x38ed91(0x221)](_0x51bb48,_0x167afe,_0x2c5991,'status_check',{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x281a50[_0x3c3988(0x212)](_0x129744),this[_0x3c3988(0x199)][_0x3c3988(0x1bf)](_0x51bb48,{'timers':_0x281a50,'paymentId':_0x51bb48,'gatewayPaymentId':_0x167afe,'createdAt':_0x37b621}),console[_0x3c3988(0x259)](_0x3c3988(0x230)+_0x192e3f[_0x3c3988(0x229)]+_0x3c3988(0x25e)+_0x51bb48),console[_0x3c3988(0x259)]('üìä\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20'+this[_0x3c3988(0x199)]['size']),this[_0x3c3988(0x1f9)](_0x51bb48,_0x167afe,_0x3c3988(0x1cc),_0x3c3988(0x1cc),_0x3c3988(0x262),{'action':_0x3c3988(0x248),'scheduledChecks':_0x192e3f[_0x3c3988(0x229)],'firstCheckIn':_0x192e3f[0x0][_0x3c3988(0x272)]/0x3e8,'totalTimers':this[_0x3c3988(0x199)][_0x3c3988(0x21b)]});}[a38_0x5e040b(0x26a)](_0x117d5a){const _0x1db18a=a38_0x5e040b,_0x3b95b0=this[_0x1db18a(0x199)][_0x1db18a(0x21c)](_0x117d5a);_0x3b95b0?(console[_0x1db18a(0x259)]('üßπ\x20[DEBUG]\x20Clearing\x20'+_0x3b95b0[_0x1db18a(0x21e)][_0x1db18a(0x229)]+_0x1db18a(0x206)+_0x117d5a),_0x3b95b0[_0x1db18a(0x21e)][_0x1db18a(0x276)]((_0x109e1a,_0x505086)=>{const _0x3f7b55=_0x1db18a;_0x109e1a&&(clearTimeout(_0x109e1a),clearInterval(_0x109e1a),console[_0x3f7b55(0x259)](_0x3f7b55(0x22a)+(_0x505086+0x1)+_0x3f7b55(0x245)+_0x117d5a));}),this[_0x1db18a(0x199)][_0x1db18a(0x217)](_0x117d5a),console['log']('‚úÖ\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20'+_0x117d5a+_0x1db18a(0x299)+this[_0x1db18a(0x199)][_0x1db18a(0x21b)])):console['log']('‚ö†Ô∏è\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20'+_0x117d5a+'\x20to\x20clear');}async['checkSinglePaymentById'](_0x10b304){const _0x4f9075=a38_0x5e040b;console[_0x4f9075(0x259)]('üîç\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20'+_0x10b304);const _0xa3e2ce=await database_1[_0x4f9075(0x220)]['payment'][_0x4f9075(0x1a7)]({'where':{'id':_0x10b304},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0xa3e2ce){console['log'](_0x4f9075(0x260)+_0x10b304+_0x4f9075(0x20b));return;}console[_0x4f9075(0x259)]('üìä\x20[CHECK]\x20Payment\x20'+_0x10b304+'\x20found:'),console[_0x4f9075(0x259)](_0x4f9075(0x1a9)+_0xa3e2ce['gateway']),console['log'](_0x4f9075(0x249)+_0xa3e2ce['status']),console[_0x4f9075(0x259)](_0x4f9075(0x1dc)+_0xa3e2ce[_0x4f9075(0x1fb)]),console[_0x4f9075(0x259)](_0x4f9075(0x225)+_0xa3e2ce[_0x4f9075(0x1f3)]+'\x20'+_0xa3e2ce[_0x4f9075(0x240)]),console[_0x4f9075(0x259)](_0x4f9075(0x24c)+_0xa3e2ce[_0x4f9075(0x246)]);if(_0xa3e2ce[_0x4f9075(0x210)]!==_0x4f9075(0x28d)&&_0xa3e2ce[_0x4f9075(0x210)]!==_0x4f9075(0x281)){console['log'](_0x4f9075(0x1a8)+_0x10b304+_0x4f9075(0x264)+_0xa3e2ce[_0x4f9075(0x210)]+')');return;}if(_0xa3e2ce['status']!==_0x4f9075(0x1cc)){console[_0x4f9075(0x259)](_0x4f9075(0x1a8)+_0x10b304+_0x4f9075(0x19d)+_0xa3e2ce[_0x4f9075(0x1e9)]+_0x4f9075(0x1e3)),this['clearPaymentTimers'](_0x10b304);return;}if(!_0xa3e2ce[_0x4f9075(0x1fb)]){console['log']('‚ö†Ô∏è\x20[CHECK]\x20Payment\x20'+_0x10b304+_0x4f9075(0x1b9));return;}console[_0x4f9075(0x259)](_0x4f9075(0x1d6)+_0x10b304+'\x20is\x20valid\x20for\x20checking,\x20proceeding...'),await this[_0x4f9075(0x19c)](_0xa3e2ce);}[a38_0x5e040b(0x1f9)](_0x1cf300,_0x5dba26,_0xae3d5b,_0xfa13aa,_0x4d0bb4,_0x576764){const _0x1f9f09=a38_0x5e040b,_0xa3d48={'type':_0x1f9f09(0x1ec),'paymentId':_0x1cf300,'gatewayPaymentId':_0x5dba26,'oldStatus':_0xae3d5b,'newStatus':_0xfa13aa,'source':_0x4d0bb4,'timestamp':new Date()[_0x1f9f09(0x1f1)](),'details':_0x576764||{}};loggerService_1[_0x1f9f09(0x239)][_0x1f9f09(0x1f9)](_0xa3d48),console[_0x1f9f09(0x259)](_0x1f9f09(0x244)+_0x1cf300+'\x20('+_0x5dba26+')'),console[_0x1f9f09(0x259)](_0x1f9f09(0x1ee)+_0xae3d5b+_0x1f9f09(0x1ea)+_0xfa13aa),console[_0x1f9f09(0x259)](_0x1f9f09(0x194)+_0x4d0bb4),console[_0x1f9f09(0x259)]('\x20\x20\x20üìÖ\x20Time:\x20'+_0xa3d48['timestamp']),_0x576764&&console[_0x1f9f09(0x259)](_0x1f9f09(0x214),_0x576764);}['logCoinToPayError'](_0x2c5ef9,_0x1af587,_0x4f2416,_0x5e76f7,_0x485a45){const _0x18feda=a38_0x5e040b,_0xb68ac={'type':'COINTOPAY_ERROR','paymentId':_0x2c5ef9,'gatewayPaymentId':_0x1af587,'error':_0x4f2416 instanceof Error?{'message':_0x4f2416[_0x18feda(0x1d8)],'stack':_0x4f2416[_0x18feda(0x1e8)]}:_0x4f2416,'source':_0x5e76f7,'timestamp':new Date()[_0x18feda(0x1f1)](),'context':_0x485a45||{}};loggerService_1['loggerService'][_0x18feda(0x221)](_0xb68ac),console[_0x18feda(0x280)](_0x18feda(0x21d)+_0x2c5ef9+'\x20('+_0x1af587+')'),console['error'](_0x18feda(0x197)+(_0x4f2416 instanceof Error?_0x4f2416['message']:_0x4f2416)),console['error']('\x20\x20\x20üìç\x20Source:\x20'+_0x5e76f7),console[_0x18feda(0x280)]('\x20\x20\x20üìÖ\x20Time:\x20'+_0xb68ac[_0x18feda(0x253)]),_0x485a45&&console[_0x18feda(0x280)](_0x18feda(0x27c),_0x485a45);}['startPeriodicStatusCheck'](){const _0x27fa5c=a38_0x5e040b;console[_0x27fa5c(0x259)](_0x27fa5c(0x1f6)),this[_0x27fa5c(0x1d7)]()['catch'](_0x569c5d=>{const _0x349da1=_0x27fa5c;console[_0x349da1(0x280)](_0x349da1(0x278),_0x569c5d);}),this[_0x27fa5c(0x234)]=setInterval(async()=>{const _0xdc8608=_0x27fa5c;try{console[_0xdc8608(0x259)](_0xdc8608(0x242)),await this['checkAllPendingPayments'](),console['log']('‚úÖ\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed');}catch(_0x1c0529){console[_0xdc8608(0x280)](_0xdc8608(0x1bb),_0x1c0529);}},this['GLOBAL_CHECK_INTERVAL_MS']),console[_0x27fa5c(0x259)](_0x27fa5c(0x1b0));}[a38_0x5e040b(0x1da)](){const _0x50cd56=a38_0x5e040b;console[_0x50cd56(0x259)]('üõë\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...');this[_0x50cd56(0x234)]&&(clearInterval(this['globalCheckInterval']),this[_0x50cd56(0x234)]=null,console[_0x50cd56(0x259)](_0x50cd56(0x273)));const _0x45d373=this[_0x50cd56(0x199)][_0x50cd56(0x21b)];for(const [_0x4e8242]of this[_0x50cd56(0x199)]){this[_0x50cd56(0x26a)](_0x4e8242);}console[_0x50cd56(0x259)](_0x50cd56(0x19a)+_0x45d373+_0x50cd56(0x1fe));}async['checkAllPendingPayments'](){const _0x2d9478=a38_0x5e040b;try{console[_0x2d9478(0x259)](_0x2d9478(0x1b8));const _0x5097e5=await database_1[_0x2d9478(0x220)][_0x2d9478(0x24e)]['findMany']({'where':{'gateway':{'in':['cointopay','cointopay2']},'status':'PENDING','gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x2d9478(0x259)]('ü™ô\x20[GLOBAL]\x20Found\x20'+_0x5097e5[_0x2d9478(0x229)]+_0x2d9478(0x219));if(_0x5097e5[_0x2d9478(0x229)]===0x0){console[_0x2d9478(0x259)](_0x2d9478(0x216));return;}const _0x69df35=await this['checkExpiredPayments'](_0x5097e5);console[_0x2d9478(0x259)](_0x2d9478(0x1b6)+_0x69df35[_0x2d9478(0x229)]+_0x2d9478(0x1c2));let _0x557084=0x0,_0x21848d=0x0;for(const _0x224edf of _0x5097e5){try{if(_0x69df35['includes'](_0x224edf['id'])){console['log']('‚è∞\x20[GLOBAL]\x20Payment\x20'+_0x224edf['id']+_0x2d9478(0x1f2)),_0x21848d++;continue;}if(this[_0x2d9478(0x199)][_0x2d9478(0x1b7)](_0x224edf['id'])){console[_0x2d9478(0x259)]('‚è∞\x20[GLOBAL]\x20Payment\x20'+_0x224edf['id']+_0x2d9478(0x21f)),_0x21848d++;continue;}const _0x4ffc12=(Date[_0x2d9478(0x198)]()-_0x224edf[_0x2d9478(0x23b)][_0x2d9478(0x28f)]())/(0x3e8*0x3c*0x3c);if(_0x4ffc12<0x1){console['log']('‚è∞\x20[GLOBAL]\x20Payment\x20'+_0x224edf['id']+'\x20is\x20too\x20new\x20('+_0x4ffc12[_0x2d9478(0x1e2)](0x1)+_0x2d9478(0x270)),_0x21848d++;continue;}console['log']('üîç\x20[GLOBAL]\x20Checking\x20old\x20payment\x20'+_0x224edf['id']+'\x20(age:\x20'+_0x4ffc12['toFixed'](0x1)+'h)'),await this[_0x2d9478(0x19c)](_0x224edf),_0x557084++,await new Promise(_0x3c16b3=>setTimeout(_0x3c16b3,0x7d0));}catch(_0x348238){console[_0x2d9478(0x280)](_0x2d9478(0x274)+_0x224edf['id']+':',_0x348238),this[_0x2d9478(0x221)](_0x224edf['id'],_0x224edf['gatewayPaymentId']||_0x2d9478(0x1bc),_0x348238,'status_check',{'isGlobalCheck':!![],'paymentAmount':_0x224edf[_0x2d9478(0x1f3)],'paymentCurrency':_0x224edf[_0x2d9478(0x240)],'shopId':_0x224edf[_0x2d9478(0x246)],'createdAt':_0x224edf['createdAt']}),loggerService_1[_0x2d9478(0x239)]['logWhiteDomainError'](_0x2d9478(0x28d),_0x2d9478(0x268)+_0x224edf[_0x2d9478(0x1fb)],_0x348238);}}console[_0x2d9478(0x259)](_0x2d9478(0x261)+_0x557084+'\x20checked,\x20'+_0x21848d+_0x2d9478(0x1c5)+_0x69df35[_0x2d9478(0x229)]+_0x2d9478(0x1e0));}catch(_0x291e01){console[_0x2d9478(0x280)](_0x2d9478(0x292),_0x291e01);}}async[a38_0x5e040b(0x1c9)](_0x4f6195){const _0x3ae993=a38_0x5e040b,_0x9aa5cf=[],_0x202246=new Date();_0x202246[_0x3ae993(0x27a)](_0x202246[_0x3ae993(0x265)]()-this[_0x3ae993(0x1d0)]),console[_0x3ae993(0x259)]('‚è∞\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20'+this['EXPIRY_DAYS']+_0x3ae993(0x28a)+_0x202246[_0x3ae993(0x1f1)]()+')');for(const _0x4405db of _0x4f6195){if(_0x4405db[_0x3ae993(0x23b)]<_0x202246){console[_0x3ae993(0x259)](_0x3ae993(0x285)+_0x4405db['id']+_0x3ae993(0x22e)+this[_0x3ae993(0x1d0)]+_0x3ae993(0x218));try{this[_0x3ae993(0x1f9)](_0x4405db['id'],_0x4405db[_0x3ae993(0x1fb)]||_0x3ae993(0x1bc),_0x3ae993(0x1cc),_0x3ae993(0x297),_0x3ae993(0x26e),{'reason':'Payment\x20older\x20than\x20'+this[_0x3ae993(0x1d0)]+_0x3ae993(0x237),'createdAt':_0x4405db[_0x3ae993(0x23b)],'daysSinceCreation':Math[_0x3ae993(0x208)]((Date[_0x3ae993(0x198)]()-_0x4405db[_0x3ae993(0x23b)][_0x3ae993(0x28f)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x4405db[_0x3ae993(0x1f3)],'paymentCurrency':_0x4405db['currency'],'shopId':_0x4405db['shopId']}),await database_1[_0x3ae993(0x220)][_0x3ae993(0x24e)][_0x3ae993(0x26c)]({'where':{'id':_0x4405db['id']},'data':{'status':_0x3ae993(0x297),'updatedAt':new Date(),'adminNotes':_0x3ae993(0x1cb)+this[_0x3ae993(0x1d0)]+'\x20days\x20without\x20payment\x20confirmation'}}),await database_1['default'][_0x3ae993(0x263)][_0x3ae993(0x193)]({'data':{'paymentId':_0x4405db['id'],'shopId':_0x4405db[_0x3ae993(0x246)],'event':'cointopay_auto_expired','statusCode':0xc8,'responseBody':JSON[_0x3ae993(0x233)]({'reason':_0x3ae993(0x1f5)+this[_0x3ae993(0x1d0)]+_0x3ae993(0x237),'createdAt':_0x4405db[_0x3ae993(0x23b)],'expiredAt':new Date()['toISOString'](),'daysSinceCreation':Math['floor']((Date[_0x3ae993(0x198)]()-_0x4405db['createdAt'][_0x3ae993(0x28f)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x3ae993(0x1aa)](_0x4405db,'EXPIRED'),await this[_0x3ae993(0x203)](_0x4405db,'EXPIRED'),this[_0x3ae993(0x26a)](_0x4405db['id']),_0x9aa5cf[_0x3ae993(0x212)](_0x4405db['id']),console[_0x3ae993(0x259)](_0x3ae993(0x222)+_0x4405db['id']+_0x3ae993(0x1ba)+this[_0x3ae993(0x1d0)]+_0x3ae993(0x1eb));}catch(_0x547e01){console[_0x3ae993(0x280)](_0x3ae993(0x195)+_0x4405db['id']+':',_0x547e01),this[_0x3ae993(0x221)](_0x4405db['id'],_0x4405db[_0x3ae993(0x1fb)]||_0x3ae993(0x1bc),_0x547e01,'auto_expire',{'reason':_0x3ae993(0x22d),'createdAt':_0x4405db[_0x3ae993(0x23b)],'daysSinceCreation':Math[_0x3ae993(0x208)]((Date[_0x3ae993(0x198)]()-_0x4405db['createdAt'][_0x3ae993(0x28f)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x9aa5cf;}async[a38_0x5e040b(0x19c)](_0x2d2978){const _0x4cfd24=a38_0x5e040b;if(!_0x2d2978[_0x4cfd24(0x1fb)]){console[_0x4cfd24(0x259)](_0x4cfd24(0x1a8)+_0x2d2978['id']+'\x20has\x20no\x20gatewayPaymentId,\x20skipping');return;}console[_0x4cfd24(0x259)]('üîç\x20[CHECK]\x20Checking\x20'+_0x2d2978[_0x4cfd24(0x210)]+_0x4cfd24(0x1a0)+_0x2d2978['id']+'\x20('+_0x2d2978[_0x4cfd24(0x1fb)]+')');try{let _0x30f433;_0x2d2978[_0x4cfd24(0x210)]===_0x4cfd24(0x281)?(_0x30f433=await this[_0x4cfd24(0x296)][_0x4cfd24(0x1c3)](_0x2d2978[_0x4cfd24(0x1fb)]),console[_0x4cfd24(0x259)](_0x4cfd24(0x1ca)+_0x2d2978['id']+_0x4cfd24(0x1e4)+_0x30f433[_0x4cfd24(0x1e9)])):(_0x30f433=await this[_0x4cfd24(0x284)][_0x4cfd24(0x1c3)](_0x2d2978['gatewayPaymentId']),console[_0x4cfd24(0x259)]('üìä\x20[CHECK]\x20CoinToPay\x20payment\x20'+_0x2d2978['id']+_0x4cfd24(0x1e4)+_0x30f433[_0x4cfd24(0x1e9)]));_0x30f433[_0x4cfd24(0x223)]&&console[_0x4cfd24(0x259)](_0x4cfd24(0x1de)+_0x2d2978['id']+'\x20details:',{'iban':_0x30f433[_0x4cfd24(0x223)][_0x4cfd24(0x251)]||'not\x20found','transactionId':_0x30f433[_0x4cfd24(0x223)][_0x4cfd24(0x1d5)],'createdOn':_0x30f433[_0x4cfd24(0x223)]['createdOn'],'confirmedOn':_0x30f433['paymentDetails']['confirmedOn']||_0x4cfd24(0x250)});if(_0x30f433[_0x4cfd24(0x1e9)]!==_0x2d2978[_0x4cfd24(0x1e9)]){console[_0x4cfd24(0x259)](_0x4cfd24(0x279)+_0x2d2978['id']+_0x4cfd24(0x271)+_0x2d2978[_0x4cfd24(0x1e9)]+'\x20to\x20'+_0x30f433[_0x4cfd24(0x1e9)]),this[_0x4cfd24(0x1f9)](_0x2d2978['id'],_0x2d2978['gatewayPaymentId'],_0x2d2978[_0x4cfd24(0x1e9)],_0x30f433[_0x4cfd24(0x1e9)],_0x4cfd24(0x262),{'paymentDetails':_0x30f433['paymentDetails'],'amount':_0x30f433[_0x4cfd24(0x1f3)],'currency':_0x30f433[_0x4cfd24(0x240)],'shopId':_0x2d2978[_0x4cfd24(0x246)],'checkTimestamp':new Date()[_0x4cfd24(0x1f1)]()});const _0x1b8fbf={'status':_0x30f433[_0x4cfd24(0x1e9)],'updatedAt':new Date()};if(_0x30f433[_0x4cfd24(0x1e9)]===_0x4cfd24(0x25c)&&_0x2d2978[_0x4cfd24(0x1e9)]!==_0x4cfd24(0x25c)){_0x1b8fbf['paidAt']=new Date();if(!_0x2d2978[_0x4cfd24(0x20c)]){const _0x2afb3f=await currencyService_1[_0x4cfd24(0x27b)][_0x4cfd24(0x23e)](_0x2d2978[_0x4cfd24(0x1f3)],_0x2d2978[_0x4cfd24(0x240)]);_0x1b8fbf[_0x4cfd24(0x20c)]=_0x2afb3f;const _0x2e5947=await this[_0x4cfd24(0x277)](_0x2d2978[_0x4cfd24(0x246)],_0x2d2978['gateway']),_0x41b008=_0x2afb3f*(0x1-_0x2e5947/0x64);_0x1b8fbf['amountAfterGatewayCommissionUSDT']=_0x41b008,_0x1b8fbf[_0x4cfd24(0x1fc)]=_0x2e5947,console[_0x4cfd24(0x259)]('üí∞\x20[CHECK]\x20Payment\x20'+_0x2d2978['id']+_0x4cfd24(0x231)),console[_0x4cfd24(0x259)](_0x4cfd24(0x241)+_0x2d2978[_0x4cfd24(0x1f3)]+'\x20'+_0x2d2978[_0x4cfd24(0x240)]+'\x20->\x20'+_0x2afb3f[_0x4cfd24(0x1e2)](0x6)+'\x20USDT'),console[_0x4cfd24(0x259)](_0x4cfd24(0x204)+_0x2d2978[_0x4cfd24(0x210)]+'\x20commission:\x20'+_0x2e5947+'%'),console[_0x4cfd24(0x259)](_0x4cfd24(0x298)+_0x41b008[_0x4cfd24(0x1e2)](0x6)+_0x4cfd24(0x215));}console[_0x4cfd24(0x259)](_0x4cfd24(0x1e1)+_0x2d2978['id']+_0x4cfd24(0x224)+_0x1b8fbf[_0x4cfd24(0x205)]['toISOString']());}if(_0x30f433[_0x4cfd24(0x223)]){const _0x566e12=_0x30f433[_0x4cfd24(0x223)];_0x566e12[_0x4cfd24(0x251)]&&(_0x1b8fbf[_0x4cfd24(0x20d)]=_0x566e12[_0x4cfd24(0x251)],console[_0x4cfd24(0x259)](_0x4cfd24(0x1be)+_0x566e12[_0x4cfd24(0x251)]));if(_0x566e12[_0x4cfd24(0x1ae)]){const _0x3ea8d9=_0x2d2978[_0x4cfd24(0x1c7)]||'',_0x283417=_0x4cfd24(0x27f)+_0x566e12[_0x4cfd24(0x1ae)];_0x1b8fbf[_0x4cfd24(0x1c7)]=_0x3ea8d9?_0x3ea8d9+'\x0a\x0a'+_0x283417:_0x283417,console[_0x4cfd24(0x259)]('üè¶\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes');}_0x566e12['transactionId']&&console[_0x4cfd24(0x259)](_0x4cfd24(0x25d)+_0x566e12[_0x4cfd24(0x1d5)]),_0x566e12[_0x4cfd24(0x1b1)]&&console[_0x4cfd24(0x259)](_0x4cfd24(0x213)+_0x566e12['confirmedOn']);}await database_1[_0x4cfd24(0x220)]['payment'][_0x4cfd24(0x26c)]({'where':{'id':_0x2d2978['id']},'data':_0x1b8fbf});if(_0x30f433[_0x4cfd24(0x1e9)]===_0x4cfd24(0x25c)&&_0x2d2978[_0x4cfd24(0x1e9)]!=='PAID'){console['log'](_0x4cfd24(0x28b)+_0x2d2978['id']+_0x4cfd24(0x23d));const _0x13feba=await database_1[_0x4cfd24(0x220)][_0x4cfd24(0x24e)][_0x4cfd24(0x1a7)]({'where':{'id':_0x2d2978['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x13feba?.['paymentLinkId']&&_0x13feba[_0x4cfd24(0x1a5)])try{const _0x2a5e7a=_0x13feba[_0x4cfd24(0x1a5)];console[_0x4cfd24(0x259)]('üìà\x20[COINTOPAY]\x20Found\x20payment\x20link\x20'+_0x2a5e7a['id']+_0x4cfd24(0x21a)+_0x2a5e7a[_0x4cfd24(0x1a1)]+_0x4cfd24(0x26d)+_0x2a5e7a[_0x4cfd24(0x1cd)]+',\x20status='+_0x2a5e7a[_0x4cfd24(0x1e9)]);const _0x2785b2=_0x2a5e7a[_0x4cfd24(0x1cd)]+0x1,_0x4b3997=_0x2a5e7a[_0x4cfd24(0x1a1)]===_0x4cfd24(0x1a3)?'COMPLETED':_0x2a5e7a[_0x4cfd24(0x1e9)];await database_1[_0x4cfd24(0x220)][_0x4cfd24(0x1a5)][_0x4cfd24(0x26c)]({'where':{'id':_0x2a5e7a['id']},'data':{'currentPayments':_0x2785b2,'status':_0x4b3997,'updatedAt':new Date()}}),console[_0x4cfd24(0x259)](_0x4cfd24(0x20e)+_0x2a5e7a['id']+_0x4cfd24(0x1d9)+_0x2a5e7a[_0x4cfd24(0x1cd)]+'\x20->\x20'+_0x2785b2+_0x4cfd24(0x23a)+_0x2a5e7a[_0x4cfd24(0x1e9)]+_0x4cfd24(0x1ea)+_0x4b3997);}catch(_0x38b886){console[_0x4cfd24(0x280)]('‚ùå\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:',_0x38b886);}else console[_0x4cfd24(0x259)](_0x4cfd24(0x28b)+_0x2d2978['id']+_0x4cfd24(0x243));}await database_1[_0x4cfd24(0x220)][_0x4cfd24(0x263)][_0x4cfd24(0x193)]({'data':{'paymentId':_0x2d2978['id'],'shopId':_0x2d2978[_0x4cfd24(0x246)],'event':_0x4cfd24(0x266)+_0x30f433[_0x4cfd24(0x1e9)][_0x4cfd24(0x1d1)](),'statusCode':0xc8,'responseBody':JSON['stringify']({'oldStatus':_0x2d2978[_0x4cfd24(0x1e9)],'newStatus':_0x30f433[_0x4cfd24(0x1e9)],'paymentDetails':_0x30f433['paymentDetails'],'checkedAt':new Date()[_0x4cfd24(0x1f1)]()})}}),await this['sendShopWebhook'](_0x2d2978,_0x30f433['status']),await this[_0x4cfd24(0x203)](_0x2d2978,_0x30f433[_0x4cfd24(0x1e9)]),_0x30f433[_0x4cfd24(0x1e9)]!==_0x4cfd24(0x1cc)&&(console[_0x4cfd24(0x259)]('üßπ\x20[CHECK]\x20Payment\x20'+_0x2d2978['id']+'\x20status\x20changed\x20to\x20'+_0x30f433['status']+_0x4cfd24(0x1f7)),this[_0x4cfd24(0x26a)](_0x2d2978['id'])),console[_0x4cfd24(0x259)]('‚úÖ\x20[CHECK]\x20Payment\x20'+_0x2d2978['id']+_0x4cfd24(0x226));}else console[_0x4cfd24(0x259)]('üìä\x20[CHECK]\x20Payment\x20'+_0x2d2978['id']+_0x4cfd24(0x24d)+_0x30f433[_0x4cfd24(0x1e9)]+')'),this[_0x4cfd24(0x1f9)](_0x2d2978['id'],_0x2d2978[_0x4cfd24(0x1fb)],_0x2d2978[_0x4cfd24(0x1e9)],_0x30f433[_0x4cfd24(0x1e9)],_0x4cfd24(0x262),{'statusUnchanged':!![],'paymentDetails':_0x30f433[_0x4cfd24(0x223)],'amount':_0x30f433[_0x4cfd24(0x1f3)],'currency':_0x30f433[_0x4cfd24(0x240)],'shopId':_0x2d2978[_0x4cfd24(0x246)],'checkTimestamp':new Date()[_0x4cfd24(0x1f1)]()});}catch(_0x59161c){console[_0x4cfd24(0x280)](_0x4cfd24(0x1b3)+_0x2d2978['id']+':',_0x59161c),this[_0x4cfd24(0x221)](_0x2d2978['id'],_0x2d2978[_0x4cfd24(0x1fb)],_0x59161c,'status_check',{'paymentAmount':_0x2d2978[_0x4cfd24(0x1f3)],'paymentCurrency':_0x2d2978['currency'],'shopId':_0x2d2978['shopId'],'createdAt':_0x2d2978['createdAt']}),await database_1[_0x4cfd24(0x220)]['webhookLog']['create']({'data':{'paymentId':_0x2d2978['id'],'shopId':_0x2d2978[_0x4cfd24(0x246)],'event':_0x4cfd24(0x1d2),'statusCode':0x1f4,'responseBody':JSON[_0x4cfd24(0x233)]({'error':_0x59161c instanceof Error?_0x59161c[_0x4cfd24(0x1d8)]:'Unknown\x20error','gatewayPaymentId':_0x2d2978['gatewayPaymentId'],'checkedAt':new Date()[_0x4cfd24(0x1f1)]()})}});}}async[a38_0x5e040b(0x1aa)](_0x2f0fc6,_0x309895){const _0x533e7f=a38_0x5e040b,_0x300ef0=Date[_0x533e7f(0x198)]();try{const _0x5f0278=_0x2f0fc6['shop'],_0x337d43=_0x5f0278[_0x533e7f(0x1e6)];if(!_0x337d43?.[_0x533e7f(0x258)]){console[_0x533e7f(0x259)](_0x533e7f(0x209)+_0x5f0278['id']);return;}const _0x4532f4=_0x309895==='PAID'?_0x533e7f(0x1db):_0x309895==='FAILED'?_0x533e7f(0x27d):_0x309895===_0x533e7f(0x297)?_0x533e7f(0x27d):_0x533e7f(0x1dd);if(!_0x337d43[_0x533e7f(0x1ed)]?.[_0x533e7f(0x28e)](_0x4532f4)){console[_0x533e7f(0x259)](_0x533e7f(0x294)+_0x4532f4+'\x20not\x20enabled\x20for\x20shop\x20'+_0x5f0278['id']);return;}const _0xc3edae=(0x0,gateway_1[_0x533e7f(0x247)])(_0x2f0fc6['gateway'])||_0x2f0fc6[_0x533e7f(0x210)],_0xc7a507={'event':_0x4532f4,'payment':{'id':_0x2f0fc6['id'],'order_id':_0x2f0fc6['orderId'],'gateway_order_id':_0x2f0fc6[_0x533e7f(0x257)],'gateway':_0xc3edae,'amount':_0x2f0fc6[_0x533e7f(0x1f3)],'currency':_0x2f0fc6['currency'],'status':_0x309895[_0x533e7f(0x1d1)](),'customer_email':_0x2f0fc6['customerEmail'],'customer_name':_0x2f0fc6['customerName'],'created_at':_0x2f0fc6[_0x533e7f(0x23b)],'updated_at':new Date()}},_0x339c30=await fetch(_0x337d43[_0x533e7f(0x258)],{'method':_0x533e7f(0x282),'headers':{'Content-Type':_0x533e7f(0x28c),'User-Agent':_0x533e7f(0x23c)},'body':JSON[_0x533e7f(0x233)](_0xc7a507)}),_0xb535f9=Date[_0x533e7f(0x198)]()-_0x300ef0,_0x2fe2c2=_0x339c30['ok']?'Success':await _0x339c30[_0x533e7f(0x1ef)]();loggerService_1['loggerService'][_0x533e7f(0x289)](_0x2f0fc6['shopId'],_0x337d43[_0x533e7f(0x258)],_0x4532f4,_0x339c30['status'],_0xb535f9,_0xc7a507),console[_0x533e7f(0x259)](_0x533e7f(0x26f)+_0x337d43[_0x533e7f(0x258)]+_0x533e7f(0x1c1)+_0x339c30[_0x533e7f(0x1e9)]+'\x20('+_0xb535f9+'ms)');}catch(_0x347805){console[_0x533e7f(0x280)](_0x533e7f(0x236),_0x347805),loggerService_1[_0x533e7f(0x239)][_0x533e7f(0x24b)](_0x2f0fc6['shopId'],_0x2f0fc6['shop']?.[_0x533e7f(0x1e6)]?.['webhookUrl']||_0x533e7f(0x1bc),_0x533e7f(0x1af),_0x347805,{});}}async['sendPaymentStatusNotification'](_0x123a5a,_0x212559){const _0x20db57=a38_0x5e040b;try{const _0x172e45={'PENDING':_0x20db57(0x207),'PAID':_0x20db57(0x1c6),'FAILED':_0x20db57(0x19f),'EXPIRED':_0x20db57(0x211)},_0x2730a6=_0x172e45[_0x212559];if(!_0x2730a6||_0x2730a6===_0x20db57(0x207))return;await telegramBotService_1['telegramBotService'][_0x20db57(0x235)](_0x123a5a['shopId'],_0x123a5a,_0x2730a6);}catch(_0xf6e089){console['error']('Failed\x20to\x20send\x20Telegram\x20payment\x20notification:',_0xf6e089);}}async[a38_0x5e040b(0x1c8)](_0x3ab085){const _0xae2a13=a38_0x5e040b;console[_0xae2a13(0x259)]('üîç\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20'+_0x3ab085);const _0x165da7=await database_1[_0xae2a13(0x220)][_0xae2a13(0x24e)][_0xae2a13(0x1a7)]({'where':{'id':_0x3ab085},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x165da7)throw new Error(_0xae2a13(0x1f0));if(_0x165da7[_0xae2a13(0x210)]!==_0xae2a13(0x28d)&&_0x165da7[_0xae2a13(0x210)]!==_0xae2a13(0x281))throw new Error(_0xae2a13(0x196));console[_0xae2a13(0x259)]('‚úÖ\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20'+_0x165da7[_0xae2a13(0x210)]+_0xae2a13(0x1a0)+_0x3ab085),await this[_0xae2a13(0x19c)](_0x165da7),console[_0xae2a13(0x259)]('‚úÖ\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20'+_0x3ab085);}[a38_0x5e040b(0x1a4)](){const _0x62a172=a38_0x5e040b,_0x18722d=this[_0x62a172(0x234)]?this['GLOBAL_CHECK_INTERVAL_MS']:undefined,_0x400537=Array[_0x62a172(0x1c0)](this[_0x62a172(0x199)][_0x62a172(0x1ad)]())[_0x62a172(0x1ce)](_0x30cb44=>({'paymentId':_0x30cb44[_0x62a172(0x1a2)],'gatewayPaymentId':_0x30cb44[_0x62a172(0x1fb)],'createdAt':_0x30cb44['createdAt'],'timersCount':_0x30cb44[_0x62a172(0x21e)][_0x62a172(0x229)]}));return{'isActive':!!this[_0x62a172(0x234)],'globalCheckIntervalMinutes':this['GLOBAL_CHECK_INTERVAL_MS']/(0x3e8*0x3c),'expiryDays':this[_0x62a172(0x1d0)],'activeIndividualTimers':this[_0x62a172(0x199)][_0x62a172(0x21b)],'nextGlobalCheckIn':_0x18722d,'paymentTimersDetails':_0x400537};}['getPaymentTimerInfo'](_0x3d3b4c){const _0x1641a8=a38_0x5e040b,_0x2cbcc3=this['paymentTimers'][_0x1641a8(0x21c)](_0x3d3b4c);if(_0x2cbcc3)return{'hasTimers':!![],'timersCount':_0x2cbcc3[_0x1641a8(0x21e)][_0x1641a8(0x229)],'createdAt':_0x2cbcc3[_0x1641a8(0x23b)],'gatewayPaymentId':_0x2cbcc3[_0x1641a8(0x1fb)]};return{'hasTimers':![]};}async[a38_0x5e040b(0x277)](_0x550512,_0x29aa6b){const _0x3a17f5=a38_0x5e040b;try{const _0xd15eed=await database_1[_0x3a17f5(0x220)][_0x3a17f5(0x1fd)][_0x3a17f5(0x1a7)]({'where':{'id':_0x550512},'select':{'gatewaySettings':!![]}});if(!_0xd15eed?.[_0x3a17f5(0x27e)])return console['log'](_0x3a17f5(0x200)+_0x550512+',\x20using\x20default\x20commission\x2010%'),0xa;const _0x59b294=JSON[_0x3a17f5(0x227)](_0xd15eed[_0x3a17f5(0x27e)]);for(const [_0x1f0cf9,_0x4f517f]of Object[_0x3a17f5(0x252)](_0x59b294)){if(_0x1f0cf9[_0x3a17f5(0x1d1)]()===_0x29aa6b[_0x3a17f5(0x1d1)]()){const _0x57711c=_0x4f517f[_0x3a17f5(0x22c)]||0xa;return console['log']('Gateway\x20'+_0x29aa6b+_0x3a17f5(0x20f)+_0x550512+':\x20'+_0x57711c+'%'),_0x57711c;}}return console['log'](_0x3a17f5(0x238)+_0x29aa6b+_0x3a17f5(0x1ac)+_0x550512+_0x3a17f5(0x267)),0xa;}catch(_0x2f51fd){return console['error'](_0x3a17f5(0x1b5)+_0x550512+',\x20gateway\x20'+_0x29aa6b+':',_0x2f51fd),0xa;}}}exports[a38_0x5e040b(0x201)]=CoinToPayStatusService,exports[a38_0x5e040b(0x290)]=new CoinToPayStatusService();