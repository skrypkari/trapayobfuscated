'use strict';const a48_0x56f326=a48_0x5407;(function(_0x1a389c,_0x2f51ed){const _0x4934af=a48_0x5407,_0x5da780=_0x1a389c();while(!![]){try{const _0x22578a=parseInt(_0x4934af(0x1fa))/0x1*(-parseInt(_0x4934af(0x1e1))/0x2)+-parseInt(_0x4934af(0x244))/0x3*(-parseInt(_0x4934af(0x223))/0x4)+parseInt(_0x4934af(0x2a2))/0x5*(parseInt(_0x4934af(0x1e4))/0x6)+-parseInt(_0x4934af(0x2d2))/0x7*(parseInt(_0x4934af(0x1dc))/0x8)+-parseInt(_0x4934af(0x20c))/0x9+-parseInt(_0x4934af(0x271))/0xa*(-parseInt(_0x4934af(0x1e3))/0xb)+parseInt(_0x4934af(0x1f5))/0xc;if(_0x22578a===_0x2f51ed)break;else _0x5da780['push'](_0x5da780['shift']());}catch(_0x5cb41f){_0x5da780['push'](_0x5da780['shift']());}}}(a48_0x17d3,0xed770));var __importDefault=this&&this['__importDefault']||function(_0x208848){const _0x16b6ea=a48_0x5407;return _0x208848&&_0x208848[_0x16b6ea(0x2c9)]?_0x208848:{'default':_0x208848};};Object[a48_0x56f326(0x1f6)](exports,a48_0x56f326(0x2c9),{'value':!![]}),exports[a48_0x56f326(0x287)]=exports[a48_0x56f326(0x1ea)]=void 0x0;function a48_0x17d3(){const _0x5cb658=['coinToPayStatusService','application/json','‚ö†Ô∏è\x20[CHECK]\x20Payment\x20','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','gatewaySettings','./gateways/coinToPay2Service','\x20has\x20no\x20gatewayPaymentId,\x20skipping','EXPIRED','POST','\x20days\x20(created\x20before\x20','delay','amount','status','getPaymentTimerInfo','ü™ô\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','\x20details:','stack','‚úÖ\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','‚è∞\x20[GLOBAL]\x20Found\x20','ü™ô\x20[TIMER]\x20Individual\x20check\x20#','\x20\x20\x20-\x20paymentId:\x20','\x20status\x20is\x20','\x20not\x20enabled\x20for\x20shop\x20','\x20is\x20valid\x20for\x20checking,\x20proceeding...','\x20for\x20payment\x20','entries','3715qXaJca','clearPaymentTimers','paymentLink','\x20\x20\x20-\x20Status:\x20','\x20\x20\x20üìç\x20Source:\x20','ü™ô\x20[GLOBAL]\x20Found\x20','\x20(age:\x20','‚úÖ\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','webhookUrl','checkExpiredPayments','gateway','checkPaymentStatus','sendPaymentStatusNotification','amountUSDT','‚úÖ\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','getGatewayCommission','amountAfterGatewayCommissionUSDT','delete','ms)','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','gatewayPaymentId','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','\x20expired','\x20not\x20found\x20in\x20database','now','create','coinToPay2Service','COINTOPAY_STATUS_CHANGE','Payment\x20System/1.0','üõë\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','\x20to\x20clear','‚è∞\x20[GLOBAL]\x20Payment\x20','EXPIRY_DAYS','telegramBotService','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','checkAllPendingPayments','\x20pending\x20CoinToPay\x20payments','Payment\x20older\x20than\x20','checkSinglePayment','__esModule','paymentTimers','Payment\x20not\x20found','PENDING','sendShopWebhook',',\x20using\x20default\x2010%','\x20to\x20','cointopay_auto_expired','üìà\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','28FzAjCs','.\x20Remaining\x20active\x20timers:\x20','\x20triggered\x20for\x20payment\x20','logShopWebhookSent','type','currencyService',',\x20gateway\x20','ü™ô\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','‚ùå\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','ü™ô\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','‚úÖ\x20[HOURLY]\x20Payment\x20','from','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','description','getTime','not\x20found','GLOBAL_CHECK_INTERVAL_MS','\x20\x20\x20-\x20ShopId:\x20','getDate','\x20status\x20unchanged\x20(','‚è∞\x20[DEBUG]\x20Scheduled\x20check\x20#','\x20checked,\x20','üîç\x20[CHECK]\x20Checking\x20','timers','\x20skipped,\x20',',\x20clearing\x20individual\x20timers','\x20updated:\x20currentPayments=','\x20days,\x20marking\x20as\x20EXPIRED','orderId','üÜî\x20[CHECK]\x20Transaction\x20ID:\x20','502912hXPslx','loggerService','\x20days','findUnique','\x20\x20\x20üìä\x20Status:\x20','2ikvdXt','\x20->\x20','21136522oHSXgk','3642jKdZWq','Webhook\x20event\x20','ü™ô\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','ü™ô\x20[DEBUG]\x20Creating\x20','üßπ\x20[CHECK]\x20Payment\x20','getGatewayIdByName','CoinToPayStatusService','\x20status\x20changed\x20to\x20','payment.pending','‚úÖ\x20[CHECK]\x20Payment\x20','logShopWebhookError','floor','logWhiteDomainError','Gateway\x20','toISOString','Failed\x20to\x20mark\x20payment\x20as\x20expired','\x20not\x20found,\x20clearing\x20timers','4760460iuqfiK','defineProperty','shopId','coinToPayService','cointopay_status_check_error','1110223MZdqFu','\x20\x20\x20-\x20Gateway:\x20','customerEmail','set','forEach','1\x20minute','\x20\x20\x20üìù\x20Details:','paymentId','üè¶\x20[CHECK]\x20Bank\x20details\x20provided:\x20','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','globalCheckInterval','paidAt','2\x20minutes','\x20payment\x20','\x20\x20\x20üìù\x20Context:','\x20individual\x20payment\x20timers','PAID','\x20expired\x20CoinToPay\x20payments','9867060FUidwb','created','COINTOPAY_ERROR','catch','text','startPeriodicStatusCheck','toFixed','\x20\x20\x20-\x20Amount:\x20','ü™ô\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','confirmedOn','Shop\x20webhook\x20sent\x20to\x20','\x20initial\x20timers\x20for\x20payment\x20','auto_expire','currency','SINGLE','üí∞\x20[CHECK]\x20Payment\x20','‚ùå\x20[TIMER]\x20Failed\x20individual\x20check\x20#','schedule_created','paymentLinkId','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','\x20with\x20status\x20','commission','cointopay_status_check_','33492ExjXlU','\x20amounts\x20calculated:','../config/database','\x20has\x20no\x20gatewayPaymentId','\x20\x20\x20-\x20gatewayPaymentId:\x20','/status/','\x20updated\x20successfully','‚úÖ\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','üßπ\x20[DEBUG]\x20Clearing\x20','not\x20confirmed','\x20\x20\x20Amount:\x20','‚úÖ\x20[EXPIRY]\x20Payment\x20','iban','üîç\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','\x20commission\x20for\x20shop\x20','unknown','ü™ô\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','values','message','get','üìà\x20[COINTOPAY]\x20Payment\x20','includes','‚úÖ\x20[DEBUG]\x20Successfully\x20scheduled\x20','getServiceStats','webhook_send','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','transactionId','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','createdAt','\x20timers\x20for\x20payment\x20','settings','status_check','stringify','237ioYBNO','timestamp','ü™ô\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','‚ùå\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','log','‚ùå\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','\x20marked\x20as\x20paid\x20at:\x20','\x20\x20\x20-\x20GatewayPaymentId:\x20','\x20(after\x20','‚ùå\x20[CHECK]\x20Payment\x20','checkSinglePaymentById','\x20current\x20status:\x20','üõë\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','üîç\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','error','logCoinToPayError','default','toLowerCase','\x20is\x20older\x20than\x20','payment.failed','./loggerService','currentPayments','size','\x20completed\x20for\x20payment\x20','sendPaymentNotification','./currencyService','findMany','üìä\x20[CHECK]\x20CoinToPay2\x20payment\x20','\x20is\x20too\x20new\x20(','Unknown\x20error','‚úÖ\x20[COINTOPAY]\x20Payment\x20link\x20','üßπ\x20[DEBUG]\x20Cleared\x20timer\x20#','üîç\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','\x20status:\x20','cointopay2','\x20\x20\x20üìÖ\x20Time:\x20','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','‚è∞\x20[EXPIRY]\x20Payment\x20','\x20status\x20from\x20','gatewayCommissionRate','\x20seconds\x20(','5\x20minutes','update','üìä\x20[CHECK]\x20CoinToPay\x20payment\x20','\x20\x20\x20Gateway\x20','10Yeftth','\x20\x20\x20Amount\x20after\x20commission:\x20','length','\x20found:','push','cointopay','has','\x20in\x20','customerName','üìä\x20[CHECK]\x20Payment\x20','createdOn','üè¶\x20[CHECK]\x20Saved\x20IBAN:\x20','‚ùå\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','failed','‚ùå\x20[HOURLY]\x20Payment\x20','logCoinToPayStatus','./gateways/coinToPayService','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','payment','bankDetails','webhookLog','paymentDetails'];a48_0x17d3=function(){return _0x5cb658;};return a48_0x17d3();}const coinToPayService_1=require(a48_0x56f326(0x281)),coinToPay2Service_1=require(a48_0x56f326(0x28c)),gateway_1=require('../types/gateway'),database_1=__importDefault(require(a48_0x56f326(0x225))),telegramBotService_1=require('./telegramBotService'),loggerService_1=require(a48_0x56f326(0x258)),currencyService_1=require(a48_0x56f326(0x25d));class CoinToPayStatusService{constructor(){const _0x748a47=a48_0x56f326;this['globalCheckInterval']=null,this['GLOBAL_CHECK_INTERVAL_MS']=0x3c*0x3c*0x3e8,this[_0x748a47(0x2c2)]=0x5,this[_0x748a47(0x2ca)]=new Map(),this[_0x748a47(0x1f8)]=new coinToPayService_1['CoinToPayService'](),this['coinToPay2Service']=new coinToPay2Service_1['CoinToPay2Service'](),console[_0x748a47(0x248)](_0x748a47(0x1e6));}['schedulePaymentChecks'](_0x195410,_0x472926){const _0x3b44f1=a48_0x56f326;console[_0x3b44f1(0x248)](_0x3b44f1(0x214)),console[_0x3b44f1(0x248)](_0x3b44f1(0x29c)+_0x195410),console['log'](_0x3b44f1(0x227)+_0x472926),this[_0x3b44f1(0x2a3)](_0x195410);const _0x27b416=[],_0x2809b8=new Date(),_0x543caf=[{'delay':0x1*0x3c*0x3e8,'description':_0x3b44f1(0x1ff)},{'delay':0x2*0x3c*0x3e8,'description':_0x3b44f1(0x206)},{'delay':0x5*0x3c*0x3e8,'description':_0x3b44f1(0x26d)},{'delay':0x5*0x3c*0x3e8,'description':'5\x20minutes'}];console['log'](_0x3b44f1(0x1e7)+_0x543caf[_0x3b44f1(0x273)]+_0x3b44f1(0x217)+_0x195410);let _0x21df7a=0x0;_0x543caf[_0x3b44f1(0x1fe)]((_0x186162,_0x123aef)=>{const _0x524bbc=_0x3b44f1;_0x21df7a+=_0x186162[_0x524bbc(0x291)];const _0x155cc2=setTimeout(async()=>{const _0x35a39e=_0x524bbc;console[_0x35a39e(0x248)](_0x35a39e(0x29b)+(_0x123aef+0x1)+_0x35a39e(0x2d4)+_0x195410+_0x35a39e(0x24c)+_0x186162['description']+')');try{await this[_0x35a39e(0x24e)](_0x195410),console['log']('‚úÖ\x20[TIMER]\x20Individual\x20check\x20#'+(_0x123aef+0x1)+_0x35a39e(0x25b)+_0x195410);}catch(_0x442c86){console['error'](_0x35a39e(0x21c)+(_0x123aef+0x1)+'\x20for\x20payment\x20'+_0x195410+':',_0x442c86),this[_0x35a39e(0x253)](_0x195410,_0x472926,_0x442c86,_0x35a39e(0x242),{'checkNumber':_0x123aef+0x1,'scheduledAfter':_0x186162[_0x35a39e(0x2df)],'isIndividualCheck':!![]});}},_0x21df7a);_0x27b416[_0x524bbc(0x275)](_0x155cc2),console[_0x524bbc(0x248)](_0x524bbc(0x2e6)+(_0x123aef+0x1)+'\x20for\x20payment\x20'+_0x195410+_0x524bbc(0x278)+_0x21df7a/0x3e8+_0x524bbc(0x26c)+_0x186162['description']+')');});const _0x16f82d=setInterval(async()=>{const _0x5170b4=_0x3b44f1;console[_0x5170b4(0x248)]('ü™ô\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20'+_0x195410);try{const _0x245bff=await database_1[_0x5170b4(0x254)][_0x5170b4(0x283)]['findUnique']({'where':{'id':_0x195410},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x245bff){console[_0x5170b4(0x248)](_0x5170b4(0x27f)+_0x195410+_0x5170b4(0x1f4)),this[_0x5170b4(0x2a3)](_0x195410);return;}console[_0x5170b4(0x248)]('üìä\x20[HOURLY]\x20Payment\x20'+_0x195410+_0x5170b4(0x24f)+_0x245bff['status']);if(_0x245bff[_0x5170b4(0x293)]!==_0x5170b4(0x2cc)){console[_0x5170b4(0x248)](_0x5170b4(0x2dc)+_0x195410+_0x5170b4(0x29d)+_0x245bff[_0x5170b4(0x293)]+',\x20stopping\x20individual\x20checks'),this['clearPaymentTimers'](_0x195410);return;}const _0x1b65eb=Math[_0x5170b4(0x1ef)]((Date[_0x5170b4(0x2ba)]()-_0x245bff[_0x5170b4(0x23f)][_0x5170b4(0x2e0)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x1b65eb>=this[_0x5170b4(0x2c2)]){console['log']('‚è∞\x20[HOURLY]\x20Payment\x20'+_0x195410+_0x5170b4(0x256)+this['EXPIRY_DAYS']+_0x5170b4(0x2b7)),this['clearPaymentTimers'](_0x195410);return;}await this[_0x5170b4(0x24e)](_0x195410),console['log'](_0x5170b4(0x22a)+_0x195410);}catch(_0x42ed05){console[_0x5170b4(0x252)]('‚ùå\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20'+_0x195410+':',_0x42ed05),this['logCoinToPayError'](_0x195410,_0x472926,_0x42ed05,_0x5170b4(0x242),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x27b416[_0x3b44f1(0x275)](_0x16f82d),this[_0x3b44f1(0x2ca)][_0x3b44f1(0x1fd)](_0x195410,{'timers':_0x27b416,'paymentId':_0x195410,'gatewayPaymentId':_0x472926,'createdAt':_0x2809b8}),console['log'](_0x3b44f1(0x239)+_0x543caf['length']+'\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20'+_0x195410),console[_0x3b44f1(0x248)]('üìä\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20'+this[_0x3b44f1(0x2ca)][_0x3b44f1(0x25a)]),this[_0x3b44f1(0x280)](_0x195410,_0x472926,_0x3b44f1(0x2cc),'PENDING',_0x3b44f1(0x242),{'action':_0x3b44f1(0x21d),'scheduledChecks':_0x543caf[_0x3b44f1(0x273)],'firstCheckIn':_0x543caf[0x0]['delay']/0x3e8,'totalTimers':this['paymentTimers'][_0x3b44f1(0x25a)]});}[a48_0x56f326(0x2a3)](_0x4056d9){const _0x4b8152=a48_0x56f326,_0x38727f=this[_0x4b8152(0x2ca)][_0x4b8152(0x236)](_0x4056d9);_0x38727f?(console['log'](_0x4b8152(0x22b)+_0x38727f['timers']['length']+_0x4b8152(0x240)+_0x4056d9),_0x38727f[_0x4b8152(0x2e9)][_0x4b8152(0x1fe)]((_0x288d23,_0x296546)=>{const _0x579e8e=_0x4b8152;_0x288d23&&(clearTimeout(_0x288d23),clearInterval(_0x288d23),console[_0x579e8e(0x248)](_0x579e8e(0x263)+(_0x296546+0x1)+_0x579e8e(0x2a0)+_0x4056d9));}),this['paymentTimers'][_0x4b8152(0x2b3)](_0x4056d9),console[_0x4b8152(0x248)](_0x4b8152(0x2b0)+_0x4056d9+_0x4b8152(0x2d3)+this[_0x4b8152(0x2ca)][_0x4b8152(0x25a)])):console[_0x4b8152(0x248)]('‚ö†Ô∏è\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20'+_0x4056d9+_0x4b8152(0x2c0));}async[a48_0x56f326(0x24e)](_0x2b5d07){const _0x81e9e8=a48_0x56f326;console[_0x81e9e8(0x248)](_0x81e9e8(0x230)+_0x2b5d07);const _0xae609e=await database_1[_0x81e9e8(0x254)][_0x81e9e8(0x283)]['findUnique']({'where':{'id':_0x2b5d07},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0xae609e){console[_0x81e9e8(0x248)](_0x81e9e8(0x24d)+_0x2b5d07+_0x81e9e8(0x2b9));return;}console[_0x81e9e8(0x248)](_0x81e9e8(0x27a)+_0x2b5d07+_0x81e9e8(0x274)),console['log'](_0x81e9e8(0x1fb)+_0xae609e[_0x81e9e8(0x2ac)]),console[_0x81e9e8(0x248)](_0x81e9e8(0x2a5)+_0xae609e[_0x81e9e8(0x293)]),console[_0x81e9e8(0x248)](_0x81e9e8(0x24b)+_0xae609e[_0x81e9e8(0x2b6)]),console[_0x81e9e8(0x248)](_0x81e9e8(0x213)+_0xae609e[_0x81e9e8(0x292)]+'\x20'+_0xae609e[_0x81e9e8(0x219)]),console[_0x81e9e8(0x248)](_0x81e9e8(0x2e3)+_0xae609e['shopId']);if(_0xae609e[_0x81e9e8(0x2ac)]!=='cointopay'&&_0xae609e[_0x81e9e8(0x2ac)]!=='cointopay2'){console[_0x81e9e8(0x248)]('‚ö†Ô∏è\x20[CHECK]\x20Payment\x20'+_0x2b5d07+'\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20'+_0xae609e['gateway']+')');return;}if(_0xae609e[_0x81e9e8(0x293)]!==_0x81e9e8(0x2cc)){console[_0x81e9e8(0x248)](_0x81e9e8(0x289)+_0x2b5d07+_0x81e9e8(0x29d)+_0xae609e[_0x81e9e8(0x293)]+',\x20stopping\x20individual\x20checks'),this[_0x81e9e8(0x2a3)](_0x2b5d07);return;}if(!_0xae609e[_0x81e9e8(0x2b6)]){console[_0x81e9e8(0x248)]('‚ö†Ô∏è\x20[CHECK]\x20Payment\x20'+_0x2b5d07+_0x81e9e8(0x226));return;}console[_0x81e9e8(0x248)](_0x81e9e8(0x1ed)+_0x2b5d07+_0x81e9e8(0x29f)),await this[_0x81e9e8(0x2c8)](_0xae609e);}[a48_0x56f326(0x280)](_0x518765,_0x1a979b,_0x5264ff,_0xf8c29a,_0x413499,_0x30fdbe){const _0x29a816=a48_0x56f326,_0x578ec4={'type':_0x29a816(0x2bd),'paymentId':_0x518765,'gatewayPaymentId':_0x1a979b,'oldStatus':_0x5264ff,'newStatus':_0xf8c29a,'source':_0x413499,'timestamp':new Date()[_0x29a816(0x1f2)](),'details':_0x30fdbe||{}};loggerService_1[_0x29a816(0x1dd)][_0x29a816(0x280)](_0x578ec4),console[_0x29a816(0x248)](_0x29a816(0x2d9)+_0x518765+'\x20('+_0x1a979b+')'),console[_0x29a816(0x248)](_0x29a816(0x1e0)+_0x5264ff+_0x29a816(0x1e2)+_0xf8c29a),console['log'](_0x29a816(0x2a6)+_0x413499),console['log'](_0x29a816(0x267)+_0x578ec4[_0x29a816(0x245)]),_0x30fdbe&&console[_0x29a816(0x248)](_0x29a816(0x200),_0x30fdbe);}[a48_0x56f326(0x253)](_0x15efef,_0x3f0bb9,_0x5e727a,_0x47a567,_0x405ff8){const _0x29eb4e=a48_0x56f326,_0x52c8cc={'type':_0x29eb4e(0x20e),'paymentId':_0x15efef,'gatewayPaymentId':_0x3f0bb9,'error':_0x5e727a instanceof Error?{'message':_0x5e727a['message'],'stack':_0x5e727a[_0x29eb4e(0x298)]}:_0x5e727a,'source':_0x47a567,'timestamp':new Date()[_0x29eb4e(0x1f2)](),'context':_0x405ff8||{}};loggerService_1[_0x29eb4e(0x1dd)][_0x29eb4e(0x253)](_0x52c8cc),console[_0x29eb4e(0x252)]('ü™ô\x20[ERROR]\x20CoinToPay\x20Error:\x20'+_0x15efef+'\x20('+_0x3f0bb9+')'),console[_0x29eb4e(0x252)]('\x20\x20\x20‚ùå\x20Error:\x20'+(_0x5e727a instanceof Error?_0x5e727a[_0x29eb4e(0x235)]:_0x5e727a)),console[_0x29eb4e(0x252)](_0x29eb4e(0x2a6)+_0x47a567),console[_0x29eb4e(0x252)](_0x29eb4e(0x267)+_0x52c8cc[_0x29eb4e(0x245)]),_0x405ff8&&console[_0x29eb4e(0x252)](_0x29eb4e(0x208),_0x405ff8);}[a48_0x56f326(0x211)](){const _0x341b31=a48_0x56f326;console[_0x341b31(0x248)](_0x341b31(0x295)),this[_0x341b31(0x2c5)]()[_0x341b31(0x20f)](_0x4b9721=>{const _0x14af88=_0x341b31;console[_0x14af88(0x252)](_0x14af88(0x2da),_0x4b9721);}),this['globalCheckInterval']=setInterval(async()=>{const _0x236fbb=_0x341b31;try{console['log'](_0x236fbb(0x2db)),await this[_0x236fbb(0x2c5)](),console['log'](_0x236fbb(0x282));}catch(_0x480ad6){console[_0x236fbb(0x252)](_0x236fbb(0x247),_0x480ad6);}},this['GLOBAL_CHECK_INTERVAL_MS']),console[_0x341b31(0x248)](_0x341b31(0x2a9));}['stopPeriodicStatusCheck'](){const _0xcf8b85=a48_0x56f326;console['log'](_0xcf8b85(0x2bf));this[_0xcf8b85(0x204)]&&(clearInterval(this['globalCheckInterval']),this[_0xcf8b85(0x204)]=null,console[_0xcf8b85(0x248)](_0xcf8b85(0x250)));const _0xe94eab=this['paymentTimers']['size'];for(const [_0x354c3f]of this[_0xcf8b85(0x2ca)]){this[_0xcf8b85(0x2a3)](_0x354c3f);}console[_0xcf8b85(0x248)]('üõë\x20[SHUTDOWN]\x20Cleared\x20'+_0xe94eab+_0xcf8b85(0x209));}async[a48_0x56f326(0x2c5)](){const _0x45d6ba=a48_0x56f326;try{console[_0x45d6ba(0x248)](_0x45d6ba(0x233));const _0x65d8d9=await database_1[_0x45d6ba(0x254)][_0x45d6ba(0x283)][_0x45d6ba(0x25e)]({'where':{'gateway':{'in':[_0x45d6ba(0x276),_0x45d6ba(0x266)]},'status':_0x45d6ba(0x2cc),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x45d6ba(0x248)](_0x45d6ba(0x2a7)+_0x65d8d9[_0x45d6ba(0x273)]+_0x45d6ba(0x2c6));if(_0x65d8d9[_0x45d6ba(0x273)]===0x0){console[_0x45d6ba(0x248)](_0x45d6ba(0x246));return;}const _0x24b4f8=await this[_0x45d6ba(0x2ab)](_0x65d8d9);console[_0x45d6ba(0x248)](_0x45d6ba(0x29a)+_0x24b4f8[_0x45d6ba(0x273)]+_0x45d6ba(0x20b));let _0x3bb717=0x0,_0x2eddf3=0x0;for(const _0x444195 of _0x65d8d9){try{if(_0x24b4f8[_0x45d6ba(0x238)](_0x444195['id'])){console['log'](_0x45d6ba(0x2c1)+_0x444195['id']+_0x45d6ba(0x203)),_0x2eddf3++;continue;}if(this[_0x45d6ba(0x2ca)][_0x45d6ba(0x277)](_0x444195['id'])){console['log'](_0x45d6ba(0x2c1)+_0x444195['id']+_0x45d6ba(0x23e)),_0x2eddf3++;continue;}const _0x5b5954=(Date['now']()-_0x444195[_0x45d6ba(0x23f)][_0x45d6ba(0x2e0)]())/(0x3e8*0x3c*0x3c);if(_0x5b5954<0x1){console[_0x45d6ba(0x248)](_0x45d6ba(0x2c1)+_0x444195['id']+_0x45d6ba(0x260)+_0x5b5954[_0x45d6ba(0x212)](0x1)+'h),\x20skipping\x20global\x20check'),_0x2eddf3++;continue;}console[_0x45d6ba(0x248)](_0x45d6ba(0x251)+_0x444195['id']+_0x45d6ba(0x2a8)+_0x5b5954['toFixed'](0x1)+'h)'),await this['checkSinglePayment'](_0x444195),_0x3bb717++,await new Promise(_0x64bafc=>setTimeout(_0x64bafc,0x7d0));}catch(_0x25a127){console['error'](_0x45d6ba(0x23c)+_0x444195['id']+':',_0x25a127),this['logCoinToPayError'](_0x444195['id'],_0x444195['gatewayPaymentId']||_0x45d6ba(0x232),_0x25a127,'status_check',{'isGlobalCheck':!![],'paymentAmount':_0x444195[_0x45d6ba(0x292)],'paymentCurrency':_0x444195[_0x45d6ba(0x219)],'shopId':_0x444195[_0x45d6ba(0x1f7)],'createdAt':_0x444195[_0x45d6ba(0x23f)]}),loggerService_1['loggerService'][_0x45d6ba(0x1f0)]('cointopay',_0x45d6ba(0x228)+_0x444195[_0x45d6ba(0x2b6)],_0x25a127);}}console[_0x45d6ba(0x248)](_0x45d6ba(0x28a)+_0x3bb717+_0x45d6ba(0x2e7)+_0x2eddf3+_0x45d6ba(0x1d6)+_0x24b4f8[_0x45d6ba(0x273)]+_0x45d6ba(0x2b8));}catch(_0x4436a9){console[_0x45d6ba(0x252)](_0x45d6ba(0x21f),_0x4436a9);}}async['checkExpiredPayments'](_0x15cc23){const _0x4d64b9=a48_0x56f326,_0x30c838=[],_0x114f39=new Date();_0x114f39['setDate'](_0x114f39[_0x4d64b9(0x2e4)]()-this[_0x4d64b9(0x2c2)]),console[_0x4d64b9(0x248)]('‚è∞\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20'+this[_0x4d64b9(0x2c2)]+_0x4d64b9(0x290)+_0x114f39['toISOString']()+')');for(const _0x21d765 of _0x15cc23){if(_0x21d765['createdAt']<_0x114f39){console[_0x4d64b9(0x248)](_0x4d64b9(0x269)+_0x21d765['id']+_0x4d64b9(0x256)+this['EXPIRY_DAYS']+_0x4d64b9(0x1d9));try{this[_0x4d64b9(0x280)](_0x21d765['id'],_0x21d765[_0x4d64b9(0x2b6)]||'unknown',_0x4d64b9(0x2cc),'EXPIRED','auto_expire',{'reason':_0x4d64b9(0x2c7)+this['EXPIRY_DAYS']+_0x4d64b9(0x1de),'createdAt':_0x21d765[_0x4d64b9(0x23f)],'daysSinceCreation':Math['floor']((Date['now']()-_0x21d765[_0x4d64b9(0x23f)][_0x4d64b9(0x2e0)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x21d765[_0x4d64b9(0x292)],'paymentCurrency':_0x21d765[_0x4d64b9(0x219)],'shopId':_0x21d765[_0x4d64b9(0x1f7)]}),await database_1[_0x4d64b9(0x254)]['payment'][_0x4d64b9(0x26e)]({'where':{'id':_0x21d765['id']},'data':{'status':_0x4d64b9(0x28e),'updatedAt':new Date()}}),await database_1[_0x4d64b9(0x254)][_0x4d64b9(0x285)][_0x4d64b9(0x2bb)]({'data':{'paymentId':_0x21d765['id'],'shopId':_0x21d765[_0x4d64b9(0x1f7)],'event':_0x4d64b9(0x2d0),'statusCode':0xc8,'responseBody':JSON['stringify']({'reason':_0x4d64b9(0x2c7)+this[_0x4d64b9(0x2c2)]+_0x4d64b9(0x1de),'createdAt':_0x21d765[_0x4d64b9(0x23f)],'expiredAt':new Date()[_0x4d64b9(0x1f2)](),'daysSinceCreation':Math[_0x4d64b9(0x1ef)]((Date[_0x4d64b9(0x2ba)]()-_0x21d765[_0x4d64b9(0x23f)][_0x4d64b9(0x2e0)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x4d64b9(0x2cd)](_0x21d765,_0x4d64b9(0x28e)),await this[_0x4d64b9(0x2ae)](_0x21d765,_0x4d64b9(0x28e)),this[_0x4d64b9(0x2a3)](_0x21d765['id']),_0x30c838['push'](_0x21d765['id']),console[_0x4d64b9(0x248)](_0x4d64b9(0x22e)+_0x21d765['id']+'\x20marked\x20as\x20EXPIRED\x20due\x20to\x20'+this['EXPIRY_DAYS']+'-day\x20timeout');}catch(_0x42432b){console[_0x4d64b9(0x252)](_0x4d64b9(0x249)+_0x21d765['id']+':',_0x42432b),this['logCoinToPayError'](_0x21d765['id'],_0x21d765[_0x4d64b9(0x2b6)]||_0x4d64b9(0x232),_0x42432b,_0x4d64b9(0x218),{'reason':_0x4d64b9(0x1f3),'createdAt':_0x21d765['createdAt'],'daysSinceCreation':Math[_0x4d64b9(0x1ef)]((Date[_0x4d64b9(0x2ba)]()-_0x21d765['createdAt'][_0x4d64b9(0x2e0)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x30c838;}async[a48_0x56f326(0x2c8)](_0x103f65){const _0x4e6369=a48_0x56f326;if(!_0x103f65[_0x4e6369(0x2b6)]){console[_0x4e6369(0x248)](_0x4e6369(0x289)+_0x103f65['id']+_0x4e6369(0x28d));return;}console['log'](_0x4e6369(0x2e8)+_0x103f65[_0x4e6369(0x2ac)]+_0x4e6369(0x207)+_0x103f65['id']+'\x20('+_0x103f65[_0x4e6369(0x2b6)]+')');try{let _0x255131;_0x103f65[_0x4e6369(0x2ac)]===_0x4e6369(0x266)?(_0x255131=await this[_0x4e6369(0x2bc)]['checkPaymentStatus'](_0x103f65[_0x4e6369(0x2b6)]),console[_0x4e6369(0x248)](_0x4e6369(0x25f)+_0x103f65['id']+_0x4e6369(0x265)+_0x255131[_0x4e6369(0x293)])):(_0x255131=await this[_0x4e6369(0x1f8)][_0x4e6369(0x2ad)](_0x103f65[_0x4e6369(0x2b6)]),console[_0x4e6369(0x248)](_0x4e6369(0x26f)+_0x103f65['id']+_0x4e6369(0x265)+_0x255131[_0x4e6369(0x293)]));_0x255131['paymentDetails']&&console[_0x4e6369(0x248)](_0x4e6369(0x27a)+_0x103f65['id']+_0x4e6369(0x297),{'iban':_0x255131[_0x4e6369(0x286)][_0x4e6369(0x22f)]||_0x4e6369(0x2e1),'transactionId':_0x255131[_0x4e6369(0x286)][_0x4e6369(0x23d)],'createdOn':_0x255131[_0x4e6369(0x286)][_0x4e6369(0x27b)],'confirmedOn':_0x255131[_0x4e6369(0x286)]['confirmedOn']||_0x4e6369(0x22c)});if(_0x255131['status']!==_0x103f65['status']){console['log']('üîÑ\x20[CHECK]\x20Updating\x20payment\x20'+_0x103f65['id']+_0x4e6369(0x26a)+_0x103f65[_0x4e6369(0x293)]+_0x4e6369(0x2cf)+_0x255131['status']),this[_0x4e6369(0x280)](_0x103f65['id'],_0x103f65[_0x4e6369(0x2b6)],_0x103f65['status'],_0x255131[_0x4e6369(0x293)],_0x4e6369(0x242),{'paymentDetails':_0x255131[_0x4e6369(0x286)],'amount':_0x255131[_0x4e6369(0x292)],'currency':_0x255131[_0x4e6369(0x219)],'shopId':_0x103f65[_0x4e6369(0x1f7)],'checkTimestamp':new Date()[_0x4e6369(0x1f2)]()});const _0x9111ce={'status':_0x255131[_0x4e6369(0x293)],'updatedAt':new Date()};if(_0x255131[_0x4e6369(0x293)]===_0x4e6369(0x20a)&&_0x103f65[_0x4e6369(0x293)]!==_0x4e6369(0x20a)){_0x9111ce[_0x4e6369(0x205)]=new Date();if(!_0x103f65[_0x4e6369(0x2af)]){const _0x5c03fe=await currencyService_1[_0x4e6369(0x2d7)]['convertToUSDT'](_0x103f65[_0x4e6369(0x292)],_0x103f65[_0x4e6369(0x219)]);_0x9111ce[_0x4e6369(0x2af)]=_0x5c03fe;const _0x4e5033=await this['getGatewayCommission'](_0x103f65[_0x4e6369(0x1f7)],_0x103f65[_0x4e6369(0x2ac)]),_0x1a120b=_0x5c03fe*(0x1-_0x4e5033/0x64);_0x9111ce[_0x4e6369(0x2b2)]=_0x1a120b,_0x9111ce[_0x4e6369(0x26b)]=_0x4e5033,console[_0x4e6369(0x248)]('üí∞\x20[CHECK]\x20Payment\x20'+_0x103f65['id']+_0x4e6369(0x224)),console[_0x4e6369(0x248)](_0x4e6369(0x22d)+_0x103f65['amount']+'\x20'+_0x103f65[_0x4e6369(0x219)]+'\x20->\x20'+_0x5c03fe[_0x4e6369(0x212)](0x6)+'\x20USDT'),console[_0x4e6369(0x248)](_0x4e6369(0x270)+_0x103f65['gateway']+'\x20commission:\x20'+_0x4e5033+'%'),console[_0x4e6369(0x248)](_0x4e6369(0x272)+_0x1a120b['toFixed'](0x6)+'\x20USDT');}console['log'](_0x4e6369(0x21b)+_0x103f65['id']+_0x4e6369(0x24a)+_0x9111ce['paidAt'][_0x4e6369(0x1f2)]());}if(_0x255131[_0x4e6369(0x286)]){const _0x1bac93=_0x255131['paymentDetails'];_0x1bac93[_0x4e6369(0x22f)]&&(_0x9111ce['remitterIban']=_0x1bac93['iban'],console[_0x4e6369(0x248)](_0x4e6369(0x27c)+_0x1bac93[_0x4e6369(0x22f)])),_0x1bac93[_0x4e6369(0x284)]&&console[_0x4e6369(0x248)](_0x4e6369(0x202)+_0x1bac93[_0x4e6369(0x284)]),_0x1bac93[_0x4e6369(0x23d)]&&console[_0x4e6369(0x248)](_0x4e6369(0x1db)+_0x1bac93[_0x4e6369(0x23d)]),_0x1bac93['confirmedOn']&&console['log'](_0x4e6369(0x299)+_0x1bac93[_0x4e6369(0x215)]);}await database_1[_0x4e6369(0x254)][_0x4e6369(0x283)][_0x4e6369(0x26e)]({'where':{'id':_0x103f65['id']},'data':_0x9111ce});if(_0x255131[_0x4e6369(0x293)]===_0x4e6369(0x20a)&&_0x103f65[_0x4e6369(0x293)]!==_0x4e6369(0x20a)){console[_0x4e6369(0x248)](_0x4e6369(0x237)+_0x103f65['id']+_0x4e6369(0x2de));const _0x22ab60=await database_1[_0x4e6369(0x254)][_0x4e6369(0x283)][_0x4e6369(0x1df)]({'where':{'id':_0x103f65['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x22ab60?.[_0x4e6369(0x21e)]&&_0x22ab60['paymentLink'])try{const _0xffcff6=_0x22ab60[_0x4e6369(0x2a4)];console['log'](_0x4e6369(0x2d1)+_0xffcff6['id']+':\x20type='+_0xffcff6[_0x4e6369(0x2d6)]+',\x20currentPayments='+_0xffcff6[_0x4e6369(0x259)]+',\x20status='+_0xffcff6[_0x4e6369(0x293)]);const _0x2e7705=_0xffcff6['currentPayments']+0x1,_0x5a425a=_0xffcff6['type']===_0x4e6369(0x21a)?'COMPLETED':_0xffcff6[_0x4e6369(0x293)];await database_1[_0x4e6369(0x254)][_0x4e6369(0x2a4)][_0x4e6369(0x26e)]({'where':{'id':_0xffcff6['id']},'data':{'currentPayments':_0x2e7705,'status':_0x5a425a,'updatedAt':new Date()}}),console[_0x4e6369(0x248)](_0x4e6369(0x262)+_0xffcff6['id']+_0x4e6369(0x1d8)+_0xffcff6[_0x4e6369(0x259)]+_0x4e6369(0x1e2)+_0x2e7705+',\x20status='+_0xffcff6[_0x4e6369(0x293)]+'\x20->\x20'+_0x5a425a);}catch(_0x32591f){console['error'](_0x4e6369(0x27d),_0x32591f);}else console[_0x4e6369(0x248)]('üìà\x20[COINTOPAY]\x20Payment\x20'+_0x103f65['id']+_0x4e6369(0x296));}await database_1['default'][_0x4e6369(0x285)][_0x4e6369(0x2bb)]({'data':{'paymentId':_0x103f65['id'],'shopId':_0x103f65[_0x4e6369(0x1f7)],'event':_0x4e6369(0x222)+_0x255131[_0x4e6369(0x293)]['toLowerCase'](),'statusCode':0xc8,'responseBody':JSON[_0x4e6369(0x243)]({'oldStatus':_0x103f65[_0x4e6369(0x293)],'newStatus':_0x255131[_0x4e6369(0x293)],'paymentDetails':_0x255131[_0x4e6369(0x286)],'checkedAt':new Date()[_0x4e6369(0x1f2)]()})}}),await this[_0x4e6369(0x2cd)](_0x103f65,_0x255131[_0x4e6369(0x293)]),await this[_0x4e6369(0x2ae)](_0x103f65,_0x255131['status']),_0x255131[_0x4e6369(0x293)]!=='PENDING'&&(console['log'](_0x4e6369(0x1e8)+_0x103f65['id']+_0x4e6369(0x1eb)+_0x255131[_0x4e6369(0x293)]+_0x4e6369(0x1d7)),this[_0x4e6369(0x2a3)](_0x103f65['id'])),console[_0x4e6369(0x248)](_0x4e6369(0x1ed)+_0x103f65['id']+_0x4e6369(0x229));}else console[_0x4e6369(0x248)](_0x4e6369(0x27a)+_0x103f65['id']+_0x4e6369(0x2e5)+_0x255131[_0x4e6369(0x293)]+')'),this[_0x4e6369(0x280)](_0x103f65['id'],_0x103f65['gatewayPaymentId'],_0x103f65[_0x4e6369(0x293)],_0x255131[_0x4e6369(0x293)],_0x4e6369(0x242),{'statusUnchanged':!![],'paymentDetails':_0x255131['paymentDetails'],'amount':_0x255131[_0x4e6369(0x292)],'currency':_0x255131['currency'],'shopId':_0x103f65[_0x4e6369(0x1f7)],'checkTimestamp':new Date()[_0x4e6369(0x1f2)]()});}catch(_0x61b11b){console[_0x4e6369(0x252)]('‚ùå\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20'+_0x103f65['id']+':',_0x61b11b),this[_0x4e6369(0x253)](_0x103f65['id'],_0x103f65[_0x4e6369(0x2b6)],_0x61b11b,_0x4e6369(0x242),{'paymentAmount':_0x103f65[_0x4e6369(0x292)],'paymentCurrency':_0x103f65[_0x4e6369(0x219)],'shopId':_0x103f65[_0x4e6369(0x1f7)],'createdAt':_0x103f65[_0x4e6369(0x23f)]}),await database_1[_0x4e6369(0x254)][_0x4e6369(0x285)][_0x4e6369(0x2bb)]({'data':{'paymentId':_0x103f65['id'],'shopId':_0x103f65[_0x4e6369(0x1f7)],'event':_0x4e6369(0x1f9),'statusCode':0x1f4,'responseBody':JSON[_0x4e6369(0x243)]({'error':_0x61b11b instanceof Error?_0x61b11b[_0x4e6369(0x235)]:_0x4e6369(0x261),'gatewayPaymentId':_0x103f65[_0x4e6369(0x2b6)],'checkedAt':new Date()[_0x4e6369(0x1f2)]()})}});}}async[a48_0x56f326(0x2cd)](_0x2f42c4,_0x936fd1){const _0xa6fccb=a48_0x56f326,_0x304527=Date[_0xa6fccb(0x2ba)]();try{const _0x2438c6=_0x2f42c4['shop'],_0x34c3d9=_0x2438c6[_0xa6fccb(0x241)];if(!_0x34c3d9?.[_0xa6fccb(0x2aa)]){console[_0xa6fccb(0x248)](_0xa6fccb(0x2b5)+_0x2438c6['id']);return;}const _0x269d49=_0x936fd1==='PAID'?'payment.success':_0x936fd1==='FAILED'?'payment.failed':_0x936fd1==='EXPIRED'?_0xa6fccb(0x257):_0xa6fccb(0x1ec);if(!_0x34c3d9['webhookEvents']?.[_0xa6fccb(0x238)](_0x269d49)){console['log'](_0xa6fccb(0x1e5)+_0x269d49+_0xa6fccb(0x29e)+_0x2438c6['id']);return;}const _0x346faf=(0x0,gateway_1[_0xa6fccb(0x1e9)])(_0x2f42c4['gateway'])||_0x2f42c4[_0xa6fccb(0x2ac)],_0x4974e7={'event':_0x269d49,'payment':{'id':_0x2f42c4['id'],'order_id':_0x2f42c4[_0xa6fccb(0x1da)],'gateway_order_id':_0x2f42c4['gatewayOrderId'],'gateway':_0x346faf,'amount':_0x2f42c4['amount'],'currency':_0x2f42c4[_0xa6fccb(0x219)],'status':_0x936fd1[_0xa6fccb(0x255)](),'customer_email':_0x2f42c4[_0xa6fccb(0x1fc)],'customer_name':_0x2f42c4[_0xa6fccb(0x279)],'created_at':_0x2f42c4[_0xa6fccb(0x23f)],'updated_at':new Date()}},_0x438bfc=await fetch(_0x34c3d9[_0xa6fccb(0x2aa)],{'method':_0xa6fccb(0x28f),'headers':{'Content-Type':_0xa6fccb(0x288),'User-Agent':_0xa6fccb(0x2be)},'body':JSON['stringify'](_0x4974e7)}),_0x524827=Date[_0xa6fccb(0x2ba)]()-_0x304527,_0x2b69b4=_0x438bfc['ok']?'Success':await _0x438bfc[_0xa6fccb(0x210)]();loggerService_1[_0xa6fccb(0x1dd)][_0xa6fccb(0x2d5)](_0x2f42c4['shopId'],_0x34c3d9[_0xa6fccb(0x2aa)],_0x269d49,_0x438bfc[_0xa6fccb(0x293)],_0x524827,_0x4974e7),console[_0xa6fccb(0x248)](_0xa6fccb(0x216)+_0x34c3d9[_0xa6fccb(0x2aa)]+_0xa6fccb(0x220)+_0x438bfc[_0xa6fccb(0x293)]+'\x20('+_0x524827+_0xa6fccb(0x2b4));}catch(_0xabaa7d){console[_0xa6fccb(0x252)]('Failed\x20to\x20send\x20shop\x20webhook:',_0xabaa7d),loggerService_1['loggerService'][_0xa6fccb(0x1ee)](_0x2f42c4[_0xa6fccb(0x1f7)],_0x2f42c4['shop']?.[_0xa6fccb(0x241)]?.[_0xa6fccb(0x2aa)]||_0xa6fccb(0x232),_0xa6fccb(0x23b),_0xabaa7d,{});}}async[a48_0x56f326(0x2ae)](_0x27f9db,_0x270f66){const _0x52e0a8=a48_0x56f326;try{const _0xe1cf7d={'PENDING':'created','PAID':'paid','FAILED':_0x52e0a8(0x27e),'EXPIRED':'expired'},_0x37d048=_0xe1cf7d[_0x270f66];if(!_0x37d048||_0x37d048===_0x52e0a8(0x20d))return;await telegramBotService_1[_0x52e0a8(0x2c3)][_0x52e0a8(0x25c)](_0x27f9db[_0x52e0a8(0x1f7)],_0x27f9db,_0x37d048);}catch(_0x25a9bb){console[_0x52e0a8(0x252)](_0x52e0a8(0x2c4),_0x25a9bb);}}async['checkPaymentById'](_0x2dee39){const _0x273d92=a48_0x56f326;console['log'](_0x273d92(0x264)+_0x2dee39);const _0x337d10=await database_1[_0x273d92(0x254)][_0x273d92(0x283)]['findUnique']({'where':{'id':_0x2dee39},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x337d10)throw new Error(_0x273d92(0x2cb));if(_0x337d10[_0x273d92(0x2ac)]!=='cointopay'&&_0x337d10[_0x273d92(0x2ac)]!==_0x273d92(0x266))throw new Error('Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment');console[_0x273d92(0x248)]('‚úÖ\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20'+_0x337d10['gateway']+_0x273d92(0x207)+_0x2dee39),await this[_0x273d92(0x2c8)](_0x337d10),console[_0x273d92(0x248)]('‚úÖ\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20'+_0x2dee39);}[a48_0x56f326(0x23a)](){const _0x8d6c1f=a48_0x56f326,_0x3af618=this['globalCheckInterval']?this[_0x8d6c1f(0x2e2)]:undefined,_0x162eca=Array[_0x8d6c1f(0x2dd)](this[_0x8d6c1f(0x2ca)][_0x8d6c1f(0x234)]())['map'](_0xd3401b=>({'paymentId':_0xd3401b[_0x8d6c1f(0x201)],'gatewayPaymentId':_0xd3401b[_0x8d6c1f(0x2b6)],'createdAt':_0xd3401b['createdAt'],'timersCount':_0xd3401b[_0x8d6c1f(0x2e9)][_0x8d6c1f(0x273)]}));return{'isActive':!!this['globalCheckInterval'],'globalCheckIntervalMinutes':this[_0x8d6c1f(0x2e2)]/(0x3e8*0x3c),'expiryDays':this[_0x8d6c1f(0x2c2)],'activeIndividualTimers':this[_0x8d6c1f(0x2ca)][_0x8d6c1f(0x25a)],'nextGlobalCheckIn':_0x3af618,'paymentTimersDetails':_0x162eca};}[a48_0x56f326(0x294)](_0x3b1096){const _0x29d688=a48_0x56f326,_0x1c8db1=this[_0x29d688(0x2ca)][_0x29d688(0x236)](_0x3b1096);if(_0x1c8db1)return{'hasTimers':!![],'timersCount':_0x1c8db1[_0x29d688(0x2e9)][_0x29d688(0x273)],'createdAt':_0x1c8db1[_0x29d688(0x23f)],'gatewayPaymentId':_0x1c8db1[_0x29d688(0x2b6)]};return{'hasTimers':![]};}async[a48_0x56f326(0x2b1)](_0x3ea0ce,_0x2177cf){const _0x44176c=a48_0x56f326;try{const _0x3a85f5=await database_1[_0x44176c(0x254)]['shop'][_0x44176c(0x1df)]({'where':{'id':_0x3ea0ce},'select':{'gatewaySettings':!![]}});if(!_0x3a85f5?.[_0x44176c(0x28b)])return console[_0x44176c(0x248)](_0x44176c(0x268)+_0x3ea0ce+',\x20using\x20default\x20commission\x2010%'),0xa;const _0x1523bc=JSON['parse'](_0x3a85f5[_0x44176c(0x28b)]);for(const [_0xd66b70,_0x3240bb]of Object[_0x44176c(0x2a1)](_0x1523bc)){if(_0xd66b70[_0x44176c(0x255)]()===_0x2177cf[_0x44176c(0x255)]()){const _0x281646=_0x3240bb[_0x44176c(0x221)]||0xa;return console['log'](_0x44176c(0x1f1)+_0x2177cf+_0x44176c(0x231)+_0x3ea0ce+':\x20'+_0x281646+'%'),_0x281646;}}return console['log']('No\x20specific\x20commission\x20found\x20for\x20gateway\x20'+_0x2177cf+'\x20in\x20shop\x20'+_0x3ea0ce+_0x44176c(0x2ce)),0xa;}catch(_0x5d674b){return console[_0x44176c(0x252)]('Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20'+_0x3ea0ce+_0x44176c(0x2d8)+_0x2177cf+':',_0x5d674b),0xa;}}}function a48_0x5407(_0x56a83c,_0x210225){_0x56a83c=_0x56a83c-0x1d6;const _0x17d364=a48_0x17d3();let _0x5407db=_0x17d364[_0x56a83c];return _0x5407db;}exports['CoinToPayStatusService']=CoinToPayStatusService,exports[a48_0x56f326(0x287)]=new CoinToPayStatusService();