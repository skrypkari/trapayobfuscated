'use strict';const a37_0x489f03=a37_0x435f;(function(_0x5633b6,_0x2a9c2a){const _0x3d5652=a37_0x435f,_0x5c2ec8=_0x5633b6();while(!![]){try{const _0x55cff4=parseInt(_0x3d5652(0x19d))/0x1+parseInt(_0x3d5652(0x139))/0x2+-parseInt(_0x3d5652(0x189))/0x3+-parseInt(_0x3d5652(0x1bc))/0x4*(-parseInt(_0x3d5652(0x107))/0x5)+-parseInt(_0x3d5652(0x19a))/0x6*(-parseInt(_0x3d5652(0x1cb))/0x7)+-parseInt(_0x3d5652(0x12f))/0x8*(-parseInt(_0x3d5652(0x1ba))/0x9)+-parseInt(_0x3d5652(0x18a))/0xa;if(_0x55cff4===_0x2a9c2a)break;else _0x5c2ec8['push'](_0x5c2ec8['shift']());}catch(_0x1a6f95){_0x5c2ec8['push'](_0x5c2ec8['shift']());}}}(a37_0x2511,0x8bec8));function a37_0x2511(){const _0x4a17d2=['\x20to\x20','defineProperty','🪙\x20[GLOBAL]\x20Found\x20','amount','set','checkExpiredPayments','❌\x20[TIMER]\x20Failed\x20individual\x20check\x20#','iban','settings','1774336GpeHch','\x20\x20\x20❌\x20Error:\x20','cointopay_status_check_','✅\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','\x20expired','gatewayOrderId','cointopay','Automatically\x20expired\x20after\x20','./loggerService','❌\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','coinToPayStatusService','paid','loggerService','❌\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','payment.pending','../config/database','⏰\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','✅\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','currency','checkSinglePaymentById','logShopWebhookSent','status','FAILED','orderId','✅\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20CoinToPay\x20payment\x20','get','gatewayPaymentId','✅\x20[DEBUG]\x20Successfully\x20scheduled\x20','checkPaymentStatus','❌\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','logCoinToPayStatus','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','h),\x20skipping\x20global\x20check','description','🪙\x20[ERROR]\x20CoinToPay\x20Error:\x20','has','getServiceStats','\x20timers\x20for\x20payment\x20','Webhook\x20event\x20','sendPaymentNotification','createdAt','__esModule','timers','\x20current\x20status:\x20','\x20checked,\x20','update','payment','forEach','logWhiteDomainError','Bank\x20Details:\x20','globalCheckInterval','now','✅\x20[TIMER]\x20Individual\x20check\x20#','PENDING','✅\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','\x20skipped,\x20','error','\x20to\x20clear','schedulePaymentChecks','🛑\x20[SHUTDOWN]\x20Cleared\x20','values','shopId','\x20status\x20from\x20','push','\x20for\x20payment\x20','\x20status\x20unchanged\x20(','created','✅\x20[EXPIRY]\x20Payment\x20','⚠️\x20[CHECK]\x20Payment\x20','webhookLog','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','webhookUrl',',\x20stopping\x20individual\x20checks','\x20\x20\x20📍\x20Source:\x20','Failed\x20to\x20mark\x20payment\x20as\x20expired','EXPIRY_DAYS','❌\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','🪙\x20CoinToPayStatusService\x20initialized','Unknown\x20error','clearPaymentTimers','157785eYEAlG','20650620HPVaBt','createdOn','payment.failed','🆔\x20[CHECK]\x20Transaction\x20ID:\x20',',\x20clearing\x20individual\x20timers','toISOString','\x20not\x20enabled\x20for\x20shop\x20','\x20\x20\x20-\x20Gateway:\x20','🛑\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','gateway','\x20has\x20no\x20gatewayPaymentId,\x20skipping','log','timestamp','✅\x20[CHECK]\x20Payment\x20','size','\x20days,\x20marking\x20as\x20EXPIRED','24HEJTHl','paidAt','cointopay_auto_expired','758917sSvcNl','\x20\x20\x20📊\x20Status:\x20','shop','includes','\x20\x20\x20-\x20Status:\x20','paymentTimers','\x20initial\x20timers\x20for\x20payment\x20','🏦\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes','\x20details:','Payment\x20older\x20than\x20','getPaymentTimerInfo','findUnique','catch','delay','🪙\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','\x20in\x20','Failed\x20to\x20send\x20shop\x20webhook:','webhookEvents','\x20pending\x20CoinToPay\x20payments','findMany','PAID','transactionId','create','⏰\x20[GLOBAL]\x20Payment\x20','unknown','telegramBotService','./gateways/coinToPayService','\x20status\x20is\x20','\x20\x20\x20-\x20GatewayPaymentId:\x20','72aCihZf','🔍\x20[CHECK]\x20Checking\x20CoinToPay\x20payment\x20','95596MJCASp','/status/','.\x20Remaining\x20active\x20timers:\x20','\x20days\x20without\x20payment\x20confirmation','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','2\x20minutes','remitterIban','🪙\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','ms)','__importDefault','🔍\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','\x20not\x20found,\x20clearing\x20timers','COINTOPAY_ERROR','length','946505vDlsZr','\x20\x20\x20-\x20gatewayPaymentId:\x20','paymentDetails','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','sendPaymentStatusNotification','-day\x20timeout','status_check','stringify','\x20\x20\x20📝\x20Details:','\x20seconds\x20(','✅\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','🪙\x20[TIMER]\x20Individual\x20check\x20#','\x20is\x20older\x20than\x20','🧹\x20[DEBUG]\x20Clearing\x20','📊\x20[CHECK]\x20Payment\x20','GLOBAL_CHECK_INTERVAL_MS','⏰\x20[DEBUG]\x20Scheduled\x20check\x20#','\x20(after\x20','bankDetails','\x20\x20\x20📅\x20Time:\x20','⏰\x20[EXPIRY]\x20Payment\x20','\x20found:','\x20marked\x20as\x20paid\x20at:\x20','🪙\x20[DEBUG]\x20Creating\x20','logCoinToPayError','checkPaymentById','🪙\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','❌\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','⏰\x20[GLOBAL]\x20Found\x20','✅\x20[HOURLY]\x20Payment\x20','5\x20minutes','\x20days','💰\x20[CHECK]\x20Payment\x20','checkSinglePayment','floor','CoinToPayStatusService','EXPIRED','\x20days\x20(created\x20before\x20','🛑\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','default','80rawzkf','Shop\x20webhook\x20sent\x20to\x20','not\x20found','\x20\x20\x20-\x20Amount:\x20','⚠️\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','❌\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','checkAllPendingPayments','CoinToPayService','\x20has\x20no\x20gatewayPaymentId','Success','🧹\x20[CHECK]\x20Payment\x20','\x20with\x20status\x20','paymentId','getDate','COINTOPAY_STATUS_CHANGE','\x20\x20\x20-\x20ShopId:\x20','confirmedOn','not\x20confirmed','Payment\x20is\x20not\x20a\x20CoinToPay\x20payment','expired','failed','🪙\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','\x20(age:\x20','message','❌\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','toLowerCase','logShopWebhookError','adminNotes','getTime','sendShopWebhook','Payment\x20not\x20found','auto_expire','🪙\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','startPeriodicStatusCheck','delete','🪙\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','1\x20minute','✅\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','\x20expired\x20CoinToPay\x20payments','\x20status\x20changed\x20to\x20','121456paUkHs'];a37_0x2511=function(){return _0x4a17d2;};return a37_0x2511();}var __importDefault=this&&this[a37_0x489f03(0x1c6)]||function(_0x580c82){const _0x1577c4=a37_0x489f03;return _0x580c82&&_0x580c82[_0x1577c4(0x162)]?_0x580c82:{'default':_0x580c82};};Object[a37_0x489f03(0x131)](exports,a37_0x489f03(0x162),{'value':!![]}),exports[a37_0x489f03(0x143)]=exports[a37_0x489f03(0x1ee)]=void 0x0;const coinToPayService_1=require(a37_0x489f03(0x1b7)),database_1=__importDefault(require(a37_0x489f03(0x148))),telegramBotService_1=require('./telegramBotService'),loggerService_1=require(a37_0x489f03(0x141));function a37_0x435f(_0x1a633f,_0x33150f){const _0x251114=a37_0x2511();return a37_0x435f=function(_0x435f67,_0x22517e){_0x435f67=_0x435f67-0x104;let _0x206aaa=_0x251114[_0x435f67];return _0x206aaa;},a37_0x435f(_0x1a633f,_0x33150f);}class CoinToPayStatusService{constructor(){const _0x9203d2=a37_0x489f03;this['globalCheckInterval']=null,this[_0x9203d2(0x1da)]=0x3c*0x3c*0x3e8,this[_0x9203d2(0x184)]=0x5,this[_0x9203d2(0x1a2)]=new Map(),this['coinToPayService']=new coinToPayService_1[(_0x9203d2(0x10e))](),console[_0x9203d2(0x195)](_0x9203d2(0x186));}[a37_0x489f03(0x173)](_0x44b356,_0x18d3f0){const _0x1125be=a37_0x489f03;console[_0x1125be(0x195)](_0x1125be(0x11c)),console['log']('\x20\x20\x20-\x20paymentId:\x20'+_0x44b356),console[_0x1125be(0x195)](_0x1125be(0x1cc)+_0x18d3f0),this[_0x1125be(0x188)](_0x44b356);const _0xfbb725=[],_0x4308b8=new Date(),_0x1fd332=[{'delay':0x1*0x3c*0x3e8,'description':_0x1125be(0x12b)},{'delay':0x2*0x3c*0x3e8,'description':_0x1125be(0x1c1)},{'delay':0x5*0x3c*0x3e8,'description':_0x1125be(0x1e9)},{'delay':0x5*0x3c*0x3e8,'description':_0x1125be(0x1e9)}];console[_0x1125be(0x195)](_0x1125be(0x1e2)+_0x1fd332[_0x1125be(0x1ca)]+_0x1125be(0x1a3)+_0x44b356);let _0x310844=0x0;_0x1fd332[_0x1125be(0x168)]((_0x323eeb,_0x1aea9d)=>{const _0x17f34e=_0x1125be;_0x310844+=_0x323eeb[_0x17f34e(0x1aa)];const _0x477b12=setTimeout(async()=>{const _0x1c9281=_0x17f34e;console[_0x1c9281(0x195)](_0x1c9281(0x1d6)+(_0x1aea9d+0x1)+'\x20triggered\x20for\x20payment\x20'+_0x44b356+_0x1c9281(0x1dc)+_0x323eeb[_0x1c9281(0x15a)]+')');try{await this['checkSinglePaymentById'](_0x44b356),console['log'](_0x1c9281(0x16d)+(_0x1aea9d+0x1)+'\x20completed\x20for\x20payment\x20'+_0x44b356);}catch(_0x57b9a6){console[_0x1c9281(0x171)](_0x1c9281(0x136)+(_0x1aea9d+0x1)+_0x1c9281(0x179)+_0x44b356+':',_0x57b9a6),this['logCoinToPayError'](_0x44b356,_0x18d3f0,_0x57b9a6,_0x1c9281(0x1d1),{'checkNumber':_0x1aea9d+0x1,'scheduledAfter':_0x323eeb[_0x1c9281(0x15a)],'isIndividualCheck':!![]});}},_0x310844);_0xfbb725[_0x17f34e(0x178)](_0x477b12),console[_0x17f34e(0x195)](_0x17f34e(0x1db)+(_0x1aea9d+0x1)+_0x17f34e(0x179)+_0x44b356+_0x17f34e(0x1ac)+_0x310844/0x3e8+_0x17f34e(0x1d4)+_0x323eeb['description']+')');});const _0x1b5328=setInterval(async()=>{const _0x49108c=_0x1125be;console[_0x49108c(0x195)](_0x49108c(0x127)+_0x44b356);try{const _0x2f5f99=await database_1[_0x49108c(0x106)][_0x49108c(0x167)]['findUnique']({'where':{'id':_0x44b356},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x2f5f99){console['log']('❌\x20[HOURLY]\x20Payment\x20'+_0x44b356+_0x49108c(0x1c8)),this['clearPaymentTimers'](_0x44b356);return;}console[_0x49108c(0x195)]('📊\x20[HOURLY]\x20Payment\x20'+_0x44b356+_0x49108c(0x164)+_0x2f5f99[_0x49108c(0x14e)]);if(_0x2f5f99[_0x49108c(0x14e)]!=='PENDING'){console[_0x49108c(0x195)](_0x49108c(0x1e8)+_0x44b356+'\x20status\x20is\x20'+_0x2f5f99['status']+_0x49108c(0x181)),this[_0x49108c(0x188)](_0x44b356);return;}const _0x501691=Math['floor']((Date[_0x49108c(0x16c)]()-_0x2f5f99['createdAt'][_0x49108c(0x123)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x501691>=this['EXPIRY_DAYS']){console[_0x49108c(0x195)]('⏰\x20[HOURLY]\x20Payment\x20'+_0x44b356+_0x49108c(0x1d7)+this[_0x49108c(0x184)]+_0x49108c(0x17f)),this[_0x49108c(0x188)](_0x44b356);return;}await this[_0x49108c(0x14c)](_0x44b356),console['log']('✅\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20'+_0x44b356);}catch(_0xbabedc){console['error'](_0x49108c(0x1e6)+_0x44b356+':',_0xbabedc),this['logCoinToPayError'](_0x44b356,_0x18d3f0,_0xbabedc,_0x49108c(0x1d1),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0xfbb725[_0x1125be(0x178)](_0x1b5328),this[_0x1125be(0x1a2)][_0x1125be(0x134)](_0x44b356,{'timers':_0xfbb725,'paymentId':_0x44b356,'gatewayPaymentId':_0x18d3f0,'createdAt':_0x4308b8}),console[_0x1125be(0x195)](_0x1125be(0x154)+_0x1fd332[_0x1125be(0x1ca)]+'\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20'+_0x44b356),console['log']('📊\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20'+this[_0x1125be(0x1a2)][_0x1125be(0x198)]),this[_0x1125be(0x157)](_0x44b356,_0x18d3f0,_0x1125be(0x16e),'PENDING',_0x1125be(0x1d1),{'action':'schedule_created','scheduledChecks':_0x1fd332[_0x1125be(0x1ca)],'firstCheckIn':_0x1fd332[0x0][_0x1125be(0x1aa)]/0x3e8,'totalTimers':this['paymentTimers']['size']});}[a37_0x489f03(0x188)](_0x124898){const _0x4775df=a37_0x489f03,_0x5b94a0=this['paymentTimers'][_0x4775df(0x152)](_0x124898);_0x5b94a0?(console[_0x4775df(0x195)](_0x4775df(0x1d8)+_0x5b94a0[_0x4775df(0x163)][_0x4775df(0x1ca)]+_0x4775df(0x15e)+_0x124898),_0x5b94a0['timers']['forEach']((_0x1a2a97,_0x254ed7)=>{const _0x49a148=_0x4775df;_0x1a2a97&&(clearTimeout(_0x1a2a97),clearInterval(_0x1a2a97),console[_0x49a148(0x195)]('🧹\x20[DEBUG]\x20Cleared\x20timer\x20#'+(_0x254ed7+0x1)+_0x49a148(0x179)+_0x124898));}),this[_0x4775df(0x1a2)][_0x4775df(0x129)](_0x124898),console['log'](_0x4775df(0x16f)+_0x124898+_0x4775df(0x1be)+this[_0x4775df(0x1a2)][_0x4775df(0x198)])):console[_0x4775df(0x195)](_0x4775df(0x10b)+_0x124898+_0x4775df(0x172));}async[a37_0x489f03(0x14c)](_0x10060b){const _0x57cba9=a37_0x489f03;console[_0x57cba9(0x195)](_0x57cba9(0x1c7)+_0x10060b);const _0x516153=await database_1['default'][_0x57cba9(0x167)][_0x57cba9(0x1a8)]({'where':{'id':_0x10060b},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x516153){console['log']('❌\x20[CHECK]\x20Payment\x20'+_0x10060b+'\x20not\x20found\x20in\x20database');return;}console[_0x57cba9(0x195)]('📊\x20[CHECK]\x20Payment\x20'+_0x10060b+_0x57cba9(0x1e0)),console['log'](_0x57cba9(0x191)+_0x516153[_0x57cba9(0x193)]),console['log'](_0x57cba9(0x1a1)+_0x516153[_0x57cba9(0x14e)]),console[_0x57cba9(0x195)](_0x57cba9(0x1b9)+_0x516153['gatewayPaymentId']),console[_0x57cba9(0x195)](_0x57cba9(0x10a)+_0x516153[_0x57cba9(0x133)]+'\x20'+_0x516153[_0x57cba9(0x14b)]),console[_0x57cba9(0x195)](_0x57cba9(0x116)+_0x516153[_0x57cba9(0x176)]);if(_0x516153[_0x57cba9(0x193)]!==_0x57cba9(0x13f)){console[_0x57cba9(0x195)](_0x57cba9(0x17d)+_0x10060b+'\x20is\x20not\x20a\x20CoinToPay\x20payment\x20(gateway:\x20'+_0x516153[_0x57cba9(0x193)]+')');return;}if(_0x516153['status']!==_0x57cba9(0x16e)){console[_0x57cba9(0x195)]('⚠️\x20[CHECK]\x20Payment\x20'+_0x10060b+_0x57cba9(0x1b8)+_0x516153[_0x57cba9(0x14e)]+_0x57cba9(0x181)),this[_0x57cba9(0x188)](_0x10060b);return;}if(!_0x516153[_0x57cba9(0x153)]){console[_0x57cba9(0x195)]('⚠️\x20[CHECK]\x20Payment\x20'+_0x10060b+_0x57cba9(0x10f));return;}console['log'](_0x57cba9(0x197)+_0x10060b+'\x20is\x20valid\x20for\x20checking,\x20proceeding...'),await this['checkSinglePayment'](_0x516153);}[a37_0x489f03(0x157)](_0x30a054,_0x261ba6,_0x2cd355,_0x1f61cf,_0x44191d,_0x1dc4b3){const _0x28d3be=a37_0x489f03,_0x4cf1c5={'type':_0x28d3be(0x115),'paymentId':_0x30a054,'gatewayPaymentId':_0x261ba6,'oldStatus':_0x2cd355,'newStatus':_0x1f61cf,'source':_0x44191d,'timestamp':new Date()[_0x28d3be(0x18f)](),'details':_0x1dc4b3||{}};loggerService_1[_0x28d3be(0x145)]['logCoinToPayStatus'](_0x4cf1c5),console[_0x28d3be(0x195)]('🪙\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20'+_0x30a054+'\x20('+_0x261ba6+')'),console[_0x28d3be(0x195)](_0x28d3be(0x19e)+_0x2cd355+'\x20->\x20'+_0x1f61cf),console[_0x28d3be(0x195)](_0x28d3be(0x182)+_0x44191d),console[_0x28d3be(0x195)](_0x28d3be(0x1de)+_0x4cf1c5[_0x28d3be(0x196)]),_0x1dc4b3&&console['log'](_0x28d3be(0x1d3),_0x1dc4b3);}['logCoinToPayError'](_0x211e87,_0x5e951d,_0x53f63b,_0x2a98e5,_0x1beb13){const _0x352d81=a37_0x489f03,_0x1557ad={'type':_0x352d81(0x1c9),'paymentId':_0x211e87,'gatewayPaymentId':_0x5e951d,'error':_0x53f63b instanceof Error?{'message':_0x53f63b['message'],'stack':_0x53f63b['stack']}:_0x53f63b,'source':_0x2a98e5,'timestamp':new Date()[_0x352d81(0x18f)](),'context':_0x1beb13||{}};loggerService_1[_0x352d81(0x145)][_0x352d81(0x1e3)](_0x1557ad),console['error'](_0x352d81(0x15b)+_0x211e87+'\x20('+_0x5e951d+')'),console[_0x352d81(0x171)](_0x352d81(0x13a)+(_0x53f63b instanceof Error?_0x53f63b[_0x352d81(0x11e)]:_0x53f63b)),console[_0x352d81(0x171)](_0x352d81(0x182)+_0x2a98e5),console[_0x352d81(0x171)]('\x20\x20\x20📅\x20Time:\x20'+_0x1557ad[_0x352d81(0x196)]),_0x1beb13&&console[_0x352d81(0x171)]('\x20\x20\x20📝\x20Context:',_0x1beb13);}[a37_0x489f03(0x128)](){const _0x440a59=a37_0x489f03;console['log'](_0x440a59(0x1c3)),this[_0x440a59(0x10d)]()[_0x440a59(0x1a9)](_0x1ca110=>{const _0x25c02f=_0x440a59;console[_0x25c02f(0x171)](_0x25c02f(0x185),_0x1ca110);}),this[_0x440a59(0x16b)]=setInterval(async()=>{const _0x3d80c0=_0x440a59;try{console[_0x3d80c0(0x195)](_0x3d80c0(0x1e5)),await this[_0x3d80c0(0x10d)](),console['log'](_0x3d80c0(0x13c));}catch(_0x283e4b){console[_0x3d80c0(0x171)](_0x3d80c0(0x142),_0x283e4b);}},this[_0x440a59(0x1da)]),console[_0x440a59(0x195)]('✅\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)');}['stopPeriodicStatusCheck'](){const _0x6ed3a9=a37_0x489f03;console[_0x6ed3a9(0x195)](_0x6ed3a9(0x192));this[_0x6ed3a9(0x16b)]&&(clearInterval(this[_0x6ed3a9(0x16b)]),this[_0x6ed3a9(0x16b)]=null,console[_0x6ed3a9(0x195)](_0x6ed3a9(0x105)));const _0x311cfb=this[_0x6ed3a9(0x1a2)]['size'];for(const [_0x20e598]of this['paymentTimers']){this[_0x6ed3a9(0x188)](_0x20e598);}console[_0x6ed3a9(0x195)](_0x6ed3a9(0x174)+_0x311cfb+'\x20individual\x20payment\x20timers');}async[a37_0x489f03(0x10d)](){const _0x48712f=a37_0x489f03;try{console['log'](_0x48712f(0x12a));const _0x11c4c1=await database_1['default'][_0x48712f(0x167)][_0x48712f(0x1b0)]({'where':{'gateway':_0x48712f(0x13f),'status':_0x48712f(0x16e),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x48712f(0x195)](_0x48712f(0x132)+_0x11c4c1['length']+_0x48712f(0x1af));if(_0x11c4c1[_0x48712f(0x1ca)]===0x0){console['log'](_0x48712f(0x1ab));return;}const _0x17c109=await this[_0x48712f(0x135)](_0x11c4c1);console['log'](_0x48712f(0x1e7)+_0x17c109[_0x48712f(0x1ca)]+_0x48712f(0x12d));let _0xd9ecac=0x0,_0x9934db=0x0;for(const _0x2edc8c of _0x11c4c1){try{if(_0x17c109[_0x48712f(0x1a0)](_0x2edc8c['id'])){console[_0x48712f(0x195)]('⏰\x20[GLOBAL]\x20Payment\x20'+_0x2edc8c['id']+_0x48712f(0x158)),_0x9934db++;continue;}if(this['paymentTimers'][_0x48712f(0x15c)](_0x2edc8c['id'])){console[_0x48712f(0x195)](_0x48712f(0x1b4)+_0x2edc8c['id']+_0x48712f(0x1c4)),_0x9934db++;continue;}const _0xbcf33a=(Date['now']()-_0x2edc8c[_0x48712f(0x161)][_0x48712f(0x123)]())/(0x3e8*0x3c*0x3c);if(_0xbcf33a<0x1){console[_0x48712f(0x195)]('⏰\x20[GLOBAL]\x20Payment\x20'+_0x2edc8c['id']+'\x20is\x20too\x20new\x20('+_0xbcf33a['toFixed'](0x1)+_0x48712f(0x159)),_0x9934db++;continue;}console['log']('🔍\x20[GLOBAL]\x20Checking\x20old\x20payment\x20'+_0x2edc8c['id']+_0x48712f(0x11d)+_0xbcf33a['toFixed'](0x1)+'h)'),await this['checkSinglePayment'](_0x2edc8c),_0xd9ecac++,await new Promise(_0xd92d08=>setTimeout(_0xd92d08,0x7d0));}catch(_0x51bf31){console[_0x48712f(0x171)](_0x48712f(0x146)+_0x2edc8c['id']+':',_0x51bf31),this[_0x48712f(0x1e3)](_0x2edc8c['id'],_0x2edc8c[_0x48712f(0x153)]||_0x48712f(0x1b5),_0x51bf31,_0x48712f(0x1d1),{'isGlobalCheck':!![],'paymentAmount':_0x2edc8c[_0x48712f(0x133)],'paymentCurrency':_0x2edc8c[_0x48712f(0x14b)],'shopId':_0x2edc8c[_0x48712f(0x176)],'createdAt':_0x2edc8c[_0x48712f(0x161)]}),loggerService_1['loggerService'][_0x48712f(0x169)](_0x48712f(0x13f),_0x48712f(0x1bd)+_0x2edc8c[_0x48712f(0x153)],_0x51bf31);}}console[_0x48712f(0x195)](_0x48712f(0x12c)+_0xd9ecac+_0x48712f(0x165)+_0x9934db+_0x48712f(0x170)+_0x17c109[_0x48712f(0x1ca)]+_0x48712f(0x13d));}catch(_0x3a2229){console['error'](_0x48712f(0x11f),_0x3a2229);}}async[a37_0x489f03(0x135)](_0x40dd9a){const _0x566b23=a37_0x489f03,_0x3f1aaf=[],_0x5c27bb=new Date();_0x5c27bb['setDate'](_0x5c27bb[_0x566b23(0x114)]()-this[_0x566b23(0x184)]),console[_0x566b23(0x195)](_0x566b23(0x149)+this[_0x566b23(0x184)]+_0x566b23(0x104)+_0x5c27bb['toISOString']()+')');for(const _0x4ffafc of _0x40dd9a){if(_0x4ffafc[_0x566b23(0x161)]<_0x5c27bb){console[_0x566b23(0x195)](_0x566b23(0x1df)+_0x4ffafc['id']+_0x566b23(0x1d7)+this['EXPIRY_DAYS']+_0x566b23(0x199));try{this[_0x566b23(0x157)](_0x4ffafc['id'],_0x4ffafc['gatewayPaymentId']||_0x566b23(0x1b5),_0x566b23(0x16e),_0x566b23(0x1ef),_0x566b23(0x126),{'reason':_0x566b23(0x1a6)+this[_0x566b23(0x184)]+_0x566b23(0x1ea),'createdAt':_0x4ffafc['createdAt'],'daysSinceCreation':Math['floor']((Date[_0x566b23(0x16c)]()-_0x4ffafc[_0x566b23(0x161)][_0x566b23(0x123)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x4ffafc['amount'],'paymentCurrency':_0x4ffafc[_0x566b23(0x14b)],'shopId':_0x4ffafc[_0x566b23(0x176)]}),await database_1[_0x566b23(0x106)]['payment']['update']({'where':{'id':_0x4ffafc['id']},'data':{'status':_0x566b23(0x1ef),'updatedAt':new Date(),'adminNotes':_0x566b23(0x140)+this[_0x566b23(0x184)]+_0x566b23(0x1bf)}}),await database_1['default'][_0x566b23(0x17e)][_0x566b23(0x1b3)]({'data':{'paymentId':_0x4ffafc['id'],'shopId':_0x4ffafc[_0x566b23(0x176)],'event':_0x566b23(0x19c),'statusCode':0xc8,'responseBody':JSON[_0x566b23(0x1d2)]({'reason':_0x566b23(0x1a6)+this[_0x566b23(0x184)]+_0x566b23(0x1ea),'createdAt':_0x4ffafc[_0x566b23(0x161)],'expiredAt':new Date()['toISOString'](),'daysSinceCreation':Math[_0x566b23(0x1ed)]((Date[_0x566b23(0x16c)]()-_0x4ffafc[_0x566b23(0x161)][_0x566b23(0x123)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this['sendShopWebhook'](_0x4ffafc,_0x566b23(0x1ef)),await this['sendPaymentStatusNotification'](_0x4ffafc,'EXPIRED'),this['clearPaymentTimers'](_0x4ffafc['id']),_0x3f1aaf['push'](_0x4ffafc['id']),console[_0x566b23(0x195)](_0x566b23(0x17c)+_0x4ffafc['id']+'\x20marked\x20as\x20EXPIRED\x20due\x20to\x20'+this['EXPIRY_DAYS']+_0x566b23(0x1d0));}catch(_0x3cbe28){console[_0x566b23(0x171)](_0x566b23(0x156)+_0x4ffafc['id']+':',_0x3cbe28),this[_0x566b23(0x1e3)](_0x4ffafc['id'],_0x4ffafc['gatewayPaymentId']||_0x566b23(0x1b5),_0x3cbe28,_0x566b23(0x126),{'reason':_0x566b23(0x183),'createdAt':_0x4ffafc[_0x566b23(0x161)],'daysSinceCreation':Math[_0x566b23(0x1ed)]((Date[_0x566b23(0x16c)]()-_0x4ffafc[_0x566b23(0x161)][_0x566b23(0x123)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x3f1aaf;}async[a37_0x489f03(0x1ec)](_0x289cec){const _0x250a19=a37_0x489f03;if(!_0x289cec[_0x250a19(0x153)]){console[_0x250a19(0x195)](_0x250a19(0x17d)+_0x289cec['id']+_0x250a19(0x194));return;}console[_0x250a19(0x195)](_0x250a19(0x1bb)+_0x289cec['id']+'\x20('+_0x289cec[_0x250a19(0x153)]+')');try{const _0x5ccd7e=await this['coinToPayService'][_0x250a19(0x155)](_0x289cec[_0x250a19(0x153)]);console[_0x250a19(0x195)](_0x250a19(0x1d9)+_0x289cec['id']+'\x20status:\x20'+_0x5ccd7e['status']);_0x5ccd7e[_0x250a19(0x1cd)]&&console['log']('📊\x20[CHECK]\x20Payment\x20'+_0x289cec['id']+_0x250a19(0x1a5),{'iban':_0x5ccd7e[_0x250a19(0x1cd)]['iban']||_0x250a19(0x109),'transactionId':_0x5ccd7e[_0x250a19(0x1cd)][_0x250a19(0x1b2)],'createdOn':_0x5ccd7e[_0x250a19(0x1cd)][_0x250a19(0x18b)],'confirmedOn':_0x5ccd7e[_0x250a19(0x1cd)]['confirmedOn']||_0x250a19(0x118)});if(_0x5ccd7e['status']!==_0x289cec['status']){console[_0x250a19(0x195)]('🔄\x20[CHECK]\x20Updating\x20payment\x20'+_0x289cec['id']+_0x250a19(0x177)+_0x289cec[_0x250a19(0x14e)]+_0x250a19(0x130)+_0x5ccd7e['status']),this[_0x250a19(0x157)](_0x289cec['id'],_0x289cec[_0x250a19(0x153)],_0x289cec['status'],_0x5ccd7e[_0x250a19(0x14e)],_0x250a19(0x1d1),{'paymentDetails':_0x5ccd7e[_0x250a19(0x1cd)],'amount':_0x5ccd7e[_0x250a19(0x133)],'currency':_0x5ccd7e[_0x250a19(0x14b)],'shopId':_0x289cec[_0x250a19(0x176)],'checkTimestamp':new Date()[_0x250a19(0x18f)]()});const _0xd05e={'status':_0x5ccd7e[_0x250a19(0x14e)],'updatedAt':new Date()};_0x5ccd7e['status']===_0x250a19(0x1b1)&&_0x289cec['status']!==_0x250a19(0x1b1)&&(_0xd05e[_0x250a19(0x19b)]=new Date(),console[_0x250a19(0x195)](_0x250a19(0x1eb)+_0x289cec['id']+_0x250a19(0x1e1)+_0xd05e[_0x250a19(0x19b)][_0x250a19(0x18f)]()));if(_0x5ccd7e['paymentDetails']){const _0x461f91=_0x5ccd7e[_0x250a19(0x1cd)];_0x461f91[_0x250a19(0x137)]&&(_0xd05e[_0x250a19(0x1c2)]=_0x461f91[_0x250a19(0x137)],console[_0x250a19(0x195)]('🏦\x20[CHECK]\x20Saved\x20IBAN:\x20'+_0x461f91[_0x250a19(0x137)]));if(_0x461f91[_0x250a19(0x1dd)]){const _0x1631f6=_0x289cec[_0x250a19(0x122)]||'',_0x4e7f30=_0x250a19(0x16a)+_0x461f91[_0x250a19(0x1dd)];_0xd05e['adminNotes']=_0x1631f6?_0x1631f6+'\x0a\x0a'+_0x4e7f30:_0x4e7f30,console[_0x250a19(0x195)](_0x250a19(0x1a4));}_0x461f91['transactionId']&&console[_0x250a19(0x195)](_0x250a19(0x18d)+_0x461f91[_0x250a19(0x1b2)]),_0x461f91[_0x250a19(0x117)]&&console[_0x250a19(0x195)](_0x250a19(0x14a)+_0x461f91[_0x250a19(0x117)]);}await database_1[_0x250a19(0x106)][_0x250a19(0x167)][_0x250a19(0x166)]({'where':{'id':_0x289cec['id']},'data':_0xd05e}),await database_1[_0x250a19(0x106)][_0x250a19(0x17e)][_0x250a19(0x1b3)]({'data':{'paymentId':_0x289cec['id'],'shopId':_0x289cec[_0x250a19(0x176)],'event':_0x250a19(0x13b)+_0x5ccd7e[_0x250a19(0x14e)][_0x250a19(0x120)](),'statusCode':0xc8,'responseBody':JSON[_0x250a19(0x1d2)]({'oldStatus':_0x289cec[_0x250a19(0x14e)],'newStatus':_0x5ccd7e[_0x250a19(0x14e)],'paymentDetails':_0x5ccd7e[_0x250a19(0x1cd)],'checkedAt':new Date()[_0x250a19(0x18f)]()})}}),await this[_0x250a19(0x124)](_0x289cec,_0x5ccd7e['status']),await this['sendPaymentStatusNotification'](_0x289cec,_0x5ccd7e['status']),_0x5ccd7e[_0x250a19(0x14e)]!==_0x250a19(0x16e)&&(console['log'](_0x250a19(0x111)+_0x289cec['id']+_0x250a19(0x12e)+_0x5ccd7e['status']+_0x250a19(0x18e)),this['clearPaymentTimers'](_0x289cec['id'])),console[_0x250a19(0x195)](_0x250a19(0x197)+_0x289cec['id']+'\x20updated\x20successfully');}else console[_0x250a19(0x195)](_0x250a19(0x1d9)+_0x289cec['id']+_0x250a19(0x17a)+_0x5ccd7e[_0x250a19(0x14e)]+')'),this[_0x250a19(0x157)](_0x289cec['id'],_0x289cec[_0x250a19(0x153)],_0x289cec[_0x250a19(0x14e)],_0x5ccd7e[_0x250a19(0x14e)],_0x250a19(0x1d1),{'statusUnchanged':!![],'paymentDetails':_0x5ccd7e[_0x250a19(0x1cd)],'amount':_0x5ccd7e[_0x250a19(0x133)],'currency':_0x5ccd7e['currency'],'shopId':_0x289cec[_0x250a19(0x176)],'checkTimestamp':new Date()[_0x250a19(0x18f)]()});}catch(_0x3ea76b){console[_0x250a19(0x171)](_0x250a19(0x10c)+_0x289cec['id']+':',_0x3ea76b),this[_0x250a19(0x1e3)](_0x289cec['id'],_0x289cec[_0x250a19(0x153)],_0x3ea76b,'status_check',{'paymentAmount':_0x289cec[_0x250a19(0x133)],'paymentCurrency':_0x289cec[_0x250a19(0x14b)],'shopId':_0x289cec[_0x250a19(0x176)],'createdAt':_0x289cec[_0x250a19(0x161)]}),await database_1[_0x250a19(0x106)][_0x250a19(0x17e)][_0x250a19(0x1b3)]({'data':{'paymentId':_0x289cec['id'],'shopId':_0x289cec['shopId'],'event':'cointopay_status_check_error','statusCode':0x1f4,'responseBody':JSON[_0x250a19(0x1d2)]({'error':_0x3ea76b instanceof Error?_0x3ea76b[_0x250a19(0x11e)]:_0x250a19(0x187),'gatewayPaymentId':_0x289cec[_0x250a19(0x153)],'checkedAt':new Date()[_0x250a19(0x18f)]()})}});}}async['sendShopWebhook'](_0x26b849,_0x1d5eaa){const _0x10e776=a37_0x489f03,_0x532a5d=Date[_0x10e776(0x16c)]();try{const _0x2ee50c=_0x26b849['shop'],_0x5ceae3=_0x2ee50c['settings'];if(!_0x5ceae3?.[_0x10e776(0x180)]){console[_0x10e776(0x195)](_0x10e776(0x1ce)+_0x2ee50c['id']);return;}const _0xb18090=_0x1d5eaa==='PAID'?'payment.success':_0x1d5eaa===_0x10e776(0x14f)?_0x10e776(0x18c):_0x1d5eaa===_0x10e776(0x1ef)?_0x10e776(0x18c):_0x10e776(0x147);if(!_0x5ceae3[_0x10e776(0x1ae)]?.['includes'](_0xb18090)){console['log'](_0x10e776(0x15f)+_0xb18090+_0x10e776(0x190)+_0x2ee50c['id']);return;}const _0x5b2cf3={'event':_0xb18090,'payment':{'id':_0x26b849['id'],'order_id':_0x26b849[_0x10e776(0x150)],'gateway_order_id':_0x26b849[_0x10e776(0x13e)],'gateway':'0100','amount':_0x26b849[_0x10e776(0x133)],'currency':_0x26b849[_0x10e776(0x14b)],'status':_0x1d5eaa[_0x10e776(0x120)](),'customer_email':_0x26b849['customerEmail'],'customer_name':_0x26b849['customerName'],'created_at':_0x26b849[_0x10e776(0x161)],'updated_at':new Date()}},_0x324d54=await fetch(_0x5ceae3[_0x10e776(0x180)],{'method':'POST','headers':{'Content-Type':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x10e776(0x1d2)](_0x5b2cf3)}),_0x1ccbf9=Date[_0x10e776(0x16c)]()-_0x532a5d,_0x12a090=_0x324d54['ok']?_0x10e776(0x110):await _0x324d54['text']();loggerService_1[_0x10e776(0x145)][_0x10e776(0x14d)](_0x26b849['shopId'],_0x5ceae3[_0x10e776(0x180)],_0xb18090,_0x324d54[_0x10e776(0x14e)],_0x1ccbf9,_0x5b2cf3),console[_0x10e776(0x195)](_0x10e776(0x108)+_0x5ceae3[_0x10e776(0x180)]+_0x10e776(0x112)+_0x324d54[_0x10e776(0x14e)]+'\x20('+_0x1ccbf9+_0x10e776(0x1c5));}catch(_0x1dbb39){console[_0x10e776(0x171)](_0x10e776(0x1ad),_0x1dbb39),loggerService_1[_0x10e776(0x145)][_0x10e776(0x121)](_0x26b849[_0x10e776(0x176)],_0x26b849[_0x10e776(0x19f)]?.[_0x10e776(0x138)]?.['webhookUrl']||_0x10e776(0x1b5),'webhook_send',_0x1dbb39,{});}}async[a37_0x489f03(0x1cf)](_0x2c8e9d,_0x5ceb71){const _0x29c966=a37_0x489f03;try{const _0x773394={'PENDING':_0x29c966(0x17b),'PAID':_0x29c966(0x144),'FAILED':_0x29c966(0x11b),'EXPIRED':_0x29c966(0x11a)},_0x32d87d=_0x773394[_0x5ceb71];if(!_0x32d87d||_0x32d87d===_0x29c966(0x17b))return;await telegramBotService_1[_0x29c966(0x1b6)][_0x29c966(0x160)](_0x2c8e9d[_0x29c966(0x176)],_0x2c8e9d,_0x32d87d);}catch(_0x9cd8b6){console[_0x29c966(0x171)](_0x29c966(0x1c0),_0x9cd8b6);}}async[a37_0x489f03(0x1e4)](_0x37b9f0){const _0x7296cf=a37_0x489f03;console['log']('🔍\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20'+_0x37b9f0);const _0x46dcef=await database_1[_0x7296cf(0x106)][_0x7296cf(0x167)][_0x7296cf(0x1a8)]({'where':{'id':_0x37b9f0},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x46dcef)throw new Error(_0x7296cf(0x125));if(_0x46dcef[_0x7296cf(0x193)]!==_0x7296cf(0x13f))throw new Error(_0x7296cf(0x119));console['log'](_0x7296cf(0x151)+_0x37b9f0),await this[_0x7296cf(0x1ec)](_0x46dcef),console['log'](_0x7296cf(0x1d5)+_0x37b9f0);}[a37_0x489f03(0x15d)](){const _0x56c1f7=a37_0x489f03,_0x4312fa=this[_0x56c1f7(0x16b)]?this[_0x56c1f7(0x1da)]:undefined,_0x998bd=Array['from'](this[_0x56c1f7(0x1a2)][_0x56c1f7(0x175)]())['map'](_0x12dcdf=>({'paymentId':_0x12dcdf[_0x56c1f7(0x113)],'gatewayPaymentId':_0x12dcdf['gatewayPaymentId'],'createdAt':_0x12dcdf[_0x56c1f7(0x161)],'timersCount':_0x12dcdf[_0x56c1f7(0x163)]['length']}));return{'isActive':!!this[_0x56c1f7(0x16b)],'globalCheckIntervalMinutes':this['GLOBAL_CHECK_INTERVAL_MS']/(0x3e8*0x3c),'expiryDays':this[_0x56c1f7(0x184)],'activeIndividualTimers':this[_0x56c1f7(0x1a2)][_0x56c1f7(0x198)],'nextGlobalCheckIn':_0x4312fa,'paymentTimersDetails':_0x998bd};}[a37_0x489f03(0x1a7)](_0x243825){const _0x300ee8=a37_0x489f03,_0x3554d9=this['paymentTimers'][_0x300ee8(0x152)](_0x243825);if(_0x3554d9)return{'hasTimers':!![],'timersCount':_0x3554d9[_0x300ee8(0x163)][_0x300ee8(0x1ca)],'createdAt':_0x3554d9[_0x300ee8(0x161)],'gatewayPaymentId':_0x3554d9[_0x300ee8(0x153)]};return{'hasTimers':![]};}}exports[a37_0x489f03(0x1ee)]=CoinToPayStatusService,exports['coinToPayStatusService']=new CoinToPayStatusService();