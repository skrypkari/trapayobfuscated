'use strict';const a50_0x11ced2=a50_0x28b4;(function(_0x55518f,_0x608b4){const _0x546532=a50_0x28b4,_0x464823=_0x55518f();while(!![]){try{const _0x1b13ab=-parseInt(_0x546532(0x16c))/0x1+parseInt(_0x546532(0x12a))/0x2*(-parseInt(_0x546532(0x164))/0x3)+-parseInt(_0x546532(0x19a))/0x4+-parseInt(_0x546532(0x119))/0x5*(parseInt(_0x546532(0x1a5))/0x6)+parseInt(_0x546532(0xf2))/0x7+-parseInt(_0x546532(0x100))/0x8+parseInt(_0x546532(0x103))/0x9;if(_0x1b13ab===_0x608b4)break;else _0x464823['push'](_0x464823['shift']());}catch(_0x41a406){_0x464823['push'](_0x464823['shift']());}}}(a50_0x34c3,0xc7b85));var __importDefault=this&&this[a50_0x11ced2(0xfb)]||function(_0x5dbd7b){return _0x5dbd7b&&_0x5dbd7b['__esModule']?_0x5dbd7b:{'default':_0x5dbd7b};};function a50_0x28b4(_0x7170fa,_0x115436){_0x7170fa=_0x7170fa-0xdf;const _0x34c3c8=a50_0x34c3();let _0x28b4c9=_0x34c3c8[_0x7170fa];return _0x28b4c9;}Object[a50_0x11ced2(0x18f)](exports,a50_0x11ced2(0x134),{'value':!![]}),exports['coinToPayStatusService']=exports['CoinToPayStatusService']=void 0x0;function a50_0x34c3(){const _0x2bc4d4=['\x20current\x20status:\x20','bankDetails','timers','ü™ô\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','__importDefault','‚è∞\x20[DEBUG]\x20Scheduled\x20check\x20#','ü™ô\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','default','11720624gUUXVo','\x20in\x20','delay','38363499yRsFQp','Payment\x20older\x20than\x20','findMany','amountUSDT','settings','\x20completed\x20for\x20payment\x20','üîç\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','‚è∞\x20[GLOBAL]\x20Payment\x20','‚úÖ\x20[EXPIRY]\x20Payment\x20','‚ùå\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','PAID','sendPaymentStatusNotification','ü™ô\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','ü™ô\x20[ERROR]\x20CoinToPay\x20Error:\x20','loggerService','failed','map','Unknown\x20error','./gateways/coinToPayService','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','üõë\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','amount','144940nRLtEd','get','message','‚úÖ\x20[TIMER]\x20Individual\x20check\x20#','2\x20minutes','\x20not\x20found,\x20clearing\x20timers','\x20status\x20is\x20','webhook_send','./gateways/coinToPay2Service','sendShopWebhook','schedule_created','üìà\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','\x20payment\x20','‚úÖ\x20[HOURLY]\x20Payment\x20','logCoinToPayStatus','paymentLink','entries','80042vfTWRS','./telegramBotService','üÜî\x20[CHECK]\x20Transaction\x20ID:\x20','\x20status\x20unchanged\x20(','createdAt','includes','shopId',',\x20using\x20default\x20commission\x2010%','FAILED','logWhiteDomainError','__esModule','üõë\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','amountAfterGatewayCommissionUSDT','\x20\x20\x20Gateway\x20','\x20\x20\x20-\x20Gateway:\x20','\x20is\x20too\x20new\x20(','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','stringify','\x20pending\x20CoinToPay\x20payments','\x20expired','cointopay_status_check_','gateway','checkSinglePayment','paymentDetails','üõë\x20[SHUTDOWN]\x20Cleared\x20','./currencyService','status',',\x20stopping\x20individual\x20checks','üìä\x20[HOURLY]\x20Payment\x20','\x20\x20\x20üìÖ\x20Time:\x20','\x20(age:\x20','clearPaymentTimers','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','CoinToPayStatusService','not\x20found','SINGLE','currentPayments','gatewayPaymentId','./loggerService','‚ùå\x20[TIMER]\x20Failed\x20individual\x20check\x20#','‚ö†Ô∏è\x20[CHECK]\x20Payment\x20','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','stopPeriodicStatusCheck','ms)','../types/gateway','expired','gatewayCommissionRate','webhookLog','gatewayOrderId','checkPaymentStatus','\x20\x20\x20-\x20GatewayPaymentId:\x20','\x20commission:\x20','description','COINTOPAY_ERROR',',\x20status=','\x20timers\x20for\x20payment\x20','\x20\x20\x20üìç\x20Source:\x20','51XDesgv','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','Shop\x20webhook\x20sent\x20to\x20','forEach','ü™ô\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','.\x20Remaining\x20active\x20timers:\x20','\x20to\x20','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','736514dStIVe','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','checkAllPendingPayments','‚è∞\x20[EXPIRY]\x20Payment\x20','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','\x20\x20\x20-\x20paymentId:\x20','-day\x20timeout','cointopay_auto_expired','paidAt','application/json','coinToPay2Service','length','\x20\x20\x20Amount\x20after\x20commission:\x20','\x20updated\x20successfully','‚ùå\x20[HOURLY]\x20Payment\x20','Failed\x20to\x20mark\x20payment\x20as\x20expired','floor','checkSinglePaymentById','üí∞\x20[CHECK]\x20Payment\x20','toLowerCase','has','auto_expire','\x20->\x20','ü™ô\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','ü™ô\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','status_check','\x20seconds\x20(','POST','\x20checked,\x20','‚ùå\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','\x20has\x20no\x20gatewayPaymentId','getGatewayCommission','Gateway\x20','\x20days','toFixed','defineProperty','\x20(after\x20','\x20has\x20no\x20gatewayPaymentId,\x20skipping',',\x20using\x20default\x2010%','\x20with\x20status\x20','stack','EXPIRED','Payment\x20not\x20found','../config/database','not\x20confirmed','\x20not\x20enabled\x20for\x20shop\x20','3606640FRqQeG','timestamp','‚úÖ\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','paymentTimers','currency','commission','Webhook\x20event\x20','üìä\x20[CHECK]\x20CoinToPay\x20payment\x20','customerName','delete','\x20\x20\x20‚ùå\x20Error:\x20','36CiUuON','\x20initial\x20timers\x20for\x20payment\x20','‚ùå\x20[CHECK]\x20Payment\x20','CoinToPayService','‚è∞\x20[GLOBAL]\x20Found\x20','getTime','size','PENDING','1\x20minute','logShopWebhookSent','‚è∞\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','\x20details:','\x20\x20\x20üìù\x20Details:','webhookUrl','payment','convertToUSDT','EXPIRY_DAYS','transactionId','error','‚úÖ\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','update','ü™ô\x20[TIMER]\x20Individual\x20check\x20#','checkExpiredPayments','‚ùå\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','from','\x20days\x20(created\x20before\x20','‚è∞\x20[HOURLY]\x20Payment\x20','ü™ô\x20[DEBUG]\x20Creating\x20','üßπ\x20[DEBUG]\x20Cleared\x20timer\x20#','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','logCoinToPayError','\x20is\x20older\x20than\x20','üìà\x20[COINTOPAY]\x20Payment\x20','‚ö†Ô∏è\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','\x20marked\x20as\x20paid\x20at:\x20','globalCheckInterval','üßπ\x20[CHECK]\x20Payment\x20','üìä\x20[CHECK]\x20CoinToPay2\x20payment\x20','\x20\x20\x20-\x20ShopId:\x20','log','\x20\x20\x20-\x20Status:\x20','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','cointopay2','shop','type','\x20days,\x20marking\x20as\x20EXPIRED','‚úÖ\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','getDate','schedulePaymentChecks',':\x20type=','Failed\x20to\x20send\x20shop\x20webhook:','iban','\x20status\x20changed\x20to\x20','üîÑ\x20[CHECK]\x20Updating\x20payment\x20','Success','now','\x20skipped,\x20','üìä\x20[CHECK]\x20Payment\x20','confirmedOn','h),\x20skipping\x20global\x20check',',\x20gateway\x20','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','\x20in\x20shop\x20','\x20\x20\x20üìù\x20Context:','create','\x20\x20\x20üìä\x20Status:\x20','telegramBotService','üè¶\x20[CHECK]\x20Saved\x20IBAN:\x20','‚úÖ\x20[CHECK]\x20Payment\x20','GLOBAL_CHECK_INTERVAL_MS','gatewaySettings','created','\x20for\x20payment\x20',',\x20clearing\x20individual\x20timers','set','unknown','createdOn','setDate','\x20individual\x20payment\x20timers','toISOString','ü™ô\x20[GLOBAL]\x20Found\x20','orderId','checkPaymentById','üßπ\x20[DEBUG]\x20Clearing\x20','\x20status:\x20','üîç\x20[CHECK]\x20Checking\x20','\x20updated:\x20currentPayments=','findUnique','customerEmail','paymentLinkId','\x20amounts\x20calculated:','‚úÖ\x20[DEBUG]\x20Successfully\x20scheduled\x20','payment.failed','cointopay','\x20is\x20valid\x20for\x20checking,\x20proceeding...','3590853KZRDai','parse','5\x20minutes','coinToPayService','push'];a50_0x34c3=function(){return _0x2bc4d4;};return a50_0x34c3();}const coinToPayService_1=require(a50_0x11ced2(0x115)),coinToPay2Service_1=require(a50_0x11ced2(0x121)),gateway_1=require(a50_0x11ced2(0x157)),database_1=__importDefault(require(a50_0x11ced2(0x197))),telegramBotService_1=require(a50_0x11ced2(0x12b)),loggerService_1=require(a50_0x11ced2(0x151)),currencyService_1=require(a50_0x11ced2(0x144));class CoinToPayStatusService{constructor(){const _0x3a4dc8=a50_0x11ced2;this[_0x3a4dc8(0x1c8)]=null,this[_0x3a4dc8(0x1ea)]=0x3c*0x3c*0x3e8,this[_0x3a4dc8(0x1b5)]=0x5,this[_0x3a4dc8(0x19d)]=new Map(),this['coinToPayService']=new coinToPayService_1[(_0x3a4dc8(0x1a8))](),this[_0x3a4dc8(0x176)]=new coinToPay2Service_1['CoinToPay2Service'](),console[_0x3a4dc8(0x1cc)](_0x3a4dc8(0x168));}[a50_0x11ced2(0x1d5)](_0x1dd25c,_0x245626){const _0x1befbf=a50_0x11ced2;console[_0x1befbf(0x1cc)](_0x1befbf(0x184)),console[_0x1befbf(0x1cc)](_0x1befbf(0x171)+_0x1dd25c),console['log']('\x20\x20\x20-\x20gatewayPaymentId:\x20'+_0x245626),this[_0x1befbf(0x14a)](_0x1dd25c);const _0x4d032f=[],_0x26e8f9=new Date(),_0x5c9a4c=[{'delay':0x1*0x3c*0x3e8,'description':_0x1befbf(0x1ad)},{'delay':0x2*0x3c*0x3e8,'description':_0x1befbf(0x11d)},{'delay':0x5*0x3c*0x3e8,'description':_0x1befbf(0xf4)},{'delay':0x5*0x3c*0x3e8,'description':_0x1befbf(0xf4)}];console[_0x1befbf(0x1cc)](_0x1befbf(0x1c0)+_0x5c9a4c[_0x1befbf(0x177)]+_0x1befbf(0x1a6)+_0x1dd25c);let _0x43675e=0x0;_0x5c9a4c['forEach']((_0x37e799,_0x5ba032)=>{const _0x781d34=_0x1befbf;_0x43675e+=_0x37e799['delay'];const _0x2c5d62=setTimeout(async()=>{const _0x915b1d=a50_0x28b4;console[_0x915b1d(0x1cc)](_0x915b1d(0x1ba)+(_0x5ba032+0x1)+'\x20triggered\x20for\x20payment\x20'+_0x1dd25c+_0x915b1d(0x190)+_0x37e799[_0x915b1d(0x15f)]+')');try{await this[_0x915b1d(0x17d)](_0x1dd25c),console[_0x915b1d(0x1cc)](_0x915b1d(0x11c)+(_0x5ba032+0x1)+_0x915b1d(0x108)+_0x1dd25c);}catch(_0x8f151e){console[_0x915b1d(0x1b7)](_0x915b1d(0x152)+(_0x5ba032+0x1)+_0x915b1d(0x1ed)+_0x1dd25c+':',_0x8f151e),this[_0x915b1d(0x1c3)](_0x1dd25c,_0x245626,_0x8f151e,_0x915b1d(0x185),{'checkNumber':_0x5ba032+0x1,'scheduledAfter':_0x37e799[_0x915b1d(0x15f)],'isIndividualCheck':!![]});}},_0x43675e);_0x4d032f['push'](_0x2c5d62),console[_0x781d34(0x1cc)](_0x781d34(0xfc)+(_0x5ba032+0x1)+'\x20for\x20payment\x20'+_0x1dd25c+_0x781d34(0x101)+_0x43675e/0x3e8+_0x781d34(0x186)+_0x37e799[_0x781d34(0x15f)]+')');});const _0x172e51=setInterval(async()=>{const _0x4957e6=_0x1befbf;console[_0x4957e6(0x1cc)]('ü™ô\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20'+_0x1dd25c);try{const _0x349d75=await database_1['default'][_0x4957e6(0x1b3)][_0x4957e6(0xea)]({'where':{'id':_0x1dd25c},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x349d75){console[_0x4957e6(0x1cc)](_0x4957e6(0x17a)+_0x1dd25c+_0x4957e6(0x11e)),this[_0x4957e6(0x14a)](_0x1dd25c);return;}console['log'](_0x4957e6(0x147)+_0x1dd25c+_0x4957e6(0xf7)+_0x349d75[_0x4957e6(0x145)]);if(_0x349d75[_0x4957e6(0x145)]!==_0x4957e6(0x1ac)){console[_0x4957e6(0x1cc)](_0x4957e6(0x126)+_0x1dd25c+_0x4957e6(0x11f)+_0x349d75['status']+_0x4957e6(0x146)),this['clearPaymentTimers'](_0x1dd25c);return;}const _0x2ae030=Math['floor']((Date[_0x4957e6(0x1dc)]()-_0x349d75['createdAt'][_0x4957e6(0x1aa)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x2ae030>=this[_0x4957e6(0x1b5)]){console[_0x4957e6(0x1cc)](_0x4957e6(0x1bf)+_0x1dd25c+'\x20is\x20older\x20than\x20'+this[_0x4957e6(0x1b5)]+_0x4957e6(0x1ce)),this[_0x4957e6(0x14a)](_0x1dd25c);return;}await this[_0x4957e6(0x17d)](_0x1dd25c),console[_0x4957e6(0x1cc)]('‚úÖ\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20'+_0x1dd25c);}catch(_0x4f2f39){console[_0x4957e6(0x1b7)]('‚ùå\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20'+_0x1dd25c+':',_0x4f2f39),this[_0x4957e6(0x1c3)](_0x1dd25c,_0x245626,_0x4f2f39,_0x4957e6(0x185),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x4d032f[_0x1befbf(0xf6)](_0x172e51),this['paymentTimers'][_0x1befbf(0x1ef)](_0x1dd25c,{'timers':_0x4d032f,'paymentId':_0x1dd25c,'gatewayPaymentId':_0x245626,'createdAt':_0x26e8f9}),console['log'](_0x1befbf(0xee)+_0x5c9a4c['length']+_0x1befbf(0x14b)+_0x1dd25c),console[_0x1befbf(0x1cc)]('üìä\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20'+this[_0x1befbf(0x19d)][_0x1befbf(0x1ab)]),this[_0x1befbf(0x127)](_0x1dd25c,_0x245626,'PENDING','PENDING',_0x1befbf(0x185),{'action':_0x1befbf(0x123),'scheduledChecks':_0x5c9a4c['length'],'firstCheckIn':_0x5c9a4c[0x0][_0x1befbf(0x102)]/0x3e8,'totalTimers':this[_0x1befbf(0x19d)]['size']});}[a50_0x11ced2(0x14a)](_0x2e5f6c){const _0x24e442=a50_0x11ced2,_0x1b36c2=this[_0x24e442(0x19d)]['get'](_0x2e5f6c);_0x1b36c2?(console[_0x24e442(0x1cc)](_0x24e442(0xe6)+_0x1b36c2['timers'][_0x24e442(0x177)]+_0x24e442(0x162)+_0x2e5f6c),_0x1b36c2[_0x24e442(0xf9)][_0x24e442(0x167)]((_0x357f25,_0x5bfae4)=>{const _0x49e5c7=_0x24e442;_0x357f25&&(clearTimeout(_0x357f25),clearInterval(_0x357f25),console[_0x49e5c7(0x1cc)](_0x49e5c7(0x1c1)+(_0x5bfae4+0x1)+_0x49e5c7(0x1ed)+_0x2e5f6c));}),this[_0x24e442(0x19d)][_0x24e442(0x1a3)](_0x2e5f6c),console[_0x24e442(0x1cc)](_0x24e442(0x1d3)+_0x2e5f6c+_0x24e442(0x169)+this[_0x24e442(0x19d)][_0x24e442(0x1ab)])):console['log'](_0x24e442(0x1c6)+_0x2e5f6c+'\x20to\x20clear');}async['checkSinglePaymentById'](_0x5e9b59){const _0x1ce6df=a50_0x11ced2;console[_0x1ce6df(0x1cc)]('üîç\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20'+_0x5e9b59);const _0x489a34=await database_1['default'][_0x1ce6df(0x1b3)][_0x1ce6df(0xea)]({'where':{'id':_0x5e9b59},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x489a34){console[_0x1ce6df(0x1cc)](_0x1ce6df(0x1a7)+_0x5e9b59+'\x20not\x20found\x20in\x20database');return;}console[_0x1ce6df(0x1cc)](_0x1ce6df(0x1de)+_0x5e9b59+'\x20found:'),console[_0x1ce6df(0x1cc)](_0x1ce6df(0x138)+_0x489a34[_0x1ce6df(0x140)]),console[_0x1ce6df(0x1cc)](_0x1ce6df(0x1cd)+_0x489a34['status']),console[_0x1ce6df(0x1cc)](_0x1ce6df(0x15d)+_0x489a34['gatewayPaymentId']),console[_0x1ce6df(0x1cc)]('\x20\x20\x20-\x20Amount:\x20'+_0x489a34['amount']+'\x20'+_0x489a34[_0x1ce6df(0x19e)]),console[_0x1ce6df(0x1cc)](_0x1ce6df(0x1cb)+_0x489a34[_0x1ce6df(0x130)]);if(_0x489a34[_0x1ce6df(0x140)]!=='cointopay'&&_0x489a34[_0x1ce6df(0x140)]!=='cointopay2'){console['log'](_0x1ce6df(0x153)+_0x5e9b59+_0x1ce6df(0x16b)+_0x489a34['gateway']+')');return;}if(_0x489a34[_0x1ce6df(0x145)]!==_0x1ce6df(0x1ac)){console['log'](_0x1ce6df(0x153)+_0x5e9b59+_0x1ce6df(0x11f)+_0x489a34['status']+_0x1ce6df(0x146)),this[_0x1ce6df(0x14a)](_0x5e9b59);return;}if(!_0x489a34[_0x1ce6df(0x150)]){console[_0x1ce6df(0x1cc)](_0x1ce6df(0x153)+_0x5e9b59+_0x1ce6df(0x18a));return;}console['log']('‚úÖ\x20[CHECK]\x20Payment\x20'+_0x5e9b59+_0x1ce6df(0xf1)),await this[_0x1ce6df(0x141)](_0x489a34);}[a50_0x11ced2(0x127)](_0x500677,_0x19fd65,_0x39296,_0x822514,_0xa6bb29,_0x4cf3cc){const _0x3d8c96=a50_0x11ced2,_0x78b301={'type':'COINTOPAY_STATUS_CHANGE','paymentId':_0x500677,'gatewayPaymentId':_0x19fd65,'oldStatus':_0x39296,'newStatus':_0x822514,'source':_0xa6bb29,'timestamp':new Date()[_0x3d8c96(0xe2)](),'details':_0x4cf3cc||{}};loggerService_1['loggerService']['logCoinToPayStatus'](_0x78b301),console[_0x3d8c96(0x1cc)](_0x3d8c96(0x183)+_0x500677+'\x20('+_0x19fd65+')'),console[_0x3d8c96(0x1cc)](_0x3d8c96(0x1e6)+_0x39296+_0x3d8c96(0x182)+_0x822514),console['log'](_0x3d8c96(0x163)+_0xa6bb29),console[_0x3d8c96(0x1cc)](_0x3d8c96(0x148)+_0x78b301['timestamp']),_0x4cf3cc&&console[_0x3d8c96(0x1cc)](_0x3d8c96(0x1b1),_0x4cf3cc);}[a50_0x11ced2(0x1c3)](_0x16751e,_0x9034ee,_0x5b5795,_0x66a5f7,_0x29867b){const _0x1060a0=a50_0x11ced2,_0x55704d={'type':_0x1060a0(0x160),'paymentId':_0x16751e,'gatewayPaymentId':_0x9034ee,'error':_0x5b5795 instanceof Error?{'message':_0x5b5795['message'],'stack':_0x5b5795[_0x1060a0(0x194)]}:_0x5b5795,'source':_0x66a5f7,'timestamp':new Date()[_0x1060a0(0xe2)](),'context':_0x29867b||{}};loggerService_1[_0x1060a0(0x111)][_0x1060a0(0x1c3)](_0x55704d),console['error'](_0x1060a0(0x110)+_0x16751e+'\x20('+_0x9034ee+')'),console[_0x1060a0(0x1b7)](_0x1060a0(0x1a4)+(_0x5b5795 instanceof Error?_0x5b5795[_0x1060a0(0x11b)]:_0x5b5795)),console['error'](_0x1060a0(0x163)+_0x66a5f7),console['error'](_0x1060a0(0x148)+_0x55704d[_0x1060a0(0x19b)]),_0x29867b&&console['error'](_0x1060a0(0x1e4),_0x29867b);}['startPeriodicStatusCheck'](){const _0x1ed678=a50_0x11ced2;console['log'](_0x1ed678(0xfd)),this[_0x1ed678(0x16e)]()['catch'](_0x3e64f0=>{const _0x10c8ba=_0x1ed678;console[_0x10c8ba(0x1b7)](_0x10c8ba(0x1bc),_0x3e64f0);}),this[_0x1ed678(0x1c8)]=setInterval(async()=>{const _0x23dfb2=_0x1ed678;try{console[_0x23dfb2(0x1cc)](_0x23dfb2(0xfa)),await this[_0x23dfb2(0x16e)](),console[_0x23dfb2(0x1cc)]('‚úÖ\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed');}catch(_0x399f2e){console[_0x23dfb2(0x1b7)]('‚ùå\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:',_0x399f2e);}},this[_0x1ed678(0x1ea)]),console[_0x1ed678(0x1cc)]('‚úÖ\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)');}[a50_0x11ced2(0x155)](){const _0x5ec8aa=a50_0x11ced2;console['log'](_0x5ec8aa(0x117));this[_0x5ec8aa(0x1c8)]&&(clearInterval(this[_0x5ec8aa(0x1c8)]),this[_0x5ec8aa(0x1c8)]=null,console[_0x5ec8aa(0x1cc)](_0x5ec8aa(0x135)));const _0x379732=this['paymentTimers'][_0x5ec8aa(0x1ab)];for(const [_0x1ebc3d]of this[_0x5ec8aa(0x19d)]){this[_0x5ec8aa(0x14a)](_0x1ebc3d);}console[_0x5ec8aa(0x1cc)](_0x5ec8aa(0x143)+_0x379732+_0x5ec8aa(0xe1));}async[a50_0x11ced2(0x16e)](){const _0x4ff54b=a50_0x11ced2;try{console[_0x4ff54b(0x1cc)](_0x4ff54b(0x10f));const _0x5eb46e=await database_1[_0x4ff54b(0xff)][_0x4ff54b(0x1b3)][_0x4ff54b(0x105)]({'where':{'gateway':{'in':[_0x4ff54b(0xf0),_0x4ff54b(0x1cf)]},'status':_0x4ff54b(0x1ac),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console['log'](_0x4ff54b(0xe3)+_0x5eb46e['length']+_0x4ff54b(0x13d));if(_0x5eb46e[_0x4ff54b(0x177)]===0x0){console[_0x4ff54b(0x1cc)]('ü™ô\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check');return;}const _0x1b552f=await this[_0x4ff54b(0x1bb)](_0x5eb46e);console['log'](_0x4ff54b(0x1a9)+_0x1b552f['length']+'\x20expired\x20CoinToPay\x20payments');let _0xd179e4=0x0,_0x2ef3aa=0x0;for(const _0xb5ec41 of _0x5eb46e){try{if(_0x1b552f['includes'](_0xb5ec41['id'])){console[_0x4ff54b(0x1cc)](_0x4ff54b(0x10a)+_0xb5ec41['id']+_0x4ff54b(0x1e2)),_0x2ef3aa++;continue;}if(this['paymentTimers'][_0x4ff54b(0x180)](_0xb5ec41['id'])){console[_0x4ff54b(0x1cc)]('‚è∞\x20[GLOBAL]\x20Payment\x20'+_0xb5ec41['id']+_0x4ff54b(0x1c2)),_0x2ef3aa++;continue;}const _0x23975a=(Date[_0x4ff54b(0x1dc)]()-_0xb5ec41[_0x4ff54b(0x12e)]['getTime']())/(0x3e8*0x3c*0x3c);if(_0x23975a<0x1){console[_0x4ff54b(0x1cc)]('‚è∞\x20[GLOBAL]\x20Payment\x20'+_0xb5ec41['id']+_0x4ff54b(0x139)+_0x23975a[_0x4ff54b(0x18e)](0x1)+_0x4ff54b(0x1e0)),_0x2ef3aa++;continue;}console['log']('üîç\x20[GLOBAL]\x20Checking\x20old\x20payment\x20'+_0xb5ec41['id']+_0x4ff54b(0x149)+_0x23975a['toFixed'](0x1)+'h)'),await this['checkSinglePayment'](_0xb5ec41),_0xd179e4++,await new Promise(_0x5638ed=>setTimeout(_0x5638ed,0x7d0));}catch(_0x2ed3dd){console[_0x4ff54b(0x1b7)](_0x4ff54b(0x16d)+_0xb5ec41['id']+':',_0x2ed3dd),this[_0x4ff54b(0x1c3)](_0xb5ec41['id'],_0xb5ec41[_0x4ff54b(0x150)]||_0x4ff54b(0x1f0),_0x2ed3dd,_0x4ff54b(0x185),{'isGlobalCheck':!![],'paymentAmount':_0xb5ec41[_0x4ff54b(0x118)],'paymentCurrency':_0xb5ec41[_0x4ff54b(0x19e)],'shopId':_0xb5ec41[_0x4ff54b(0x130)],'createdAt':_0xb5ec41[_0x4ff54b(0x12e)]}),loggerService_1[_0x4ff54b(0x111)][_0x4ff54b(0x133)](_0x4ff54b(0xf0),'/status/'+_0xb5ec41[_0x4ff54b(0x150)],_0x2ed3dd);}}console['log']('‚úÖ\x20[GLOBAL]\x20Global\x20check\x20completed:\x20'+_0xd179e4+_0x4ff54b(0x188)+_0x2ef3aa+_0x4ff54b(0x1dd)+_0x1b552f[_0x4ff54b(0x177)]+_0x4ff54b(0x13e));}catch(_0xe0ea54){console[_0x4ff54b(0x1b7)](_0x4ff54b(0x116),_0xe0ea54);}}async[a50_0x11ced2(0x1bb)](_0x2e4d49){const _0x5e2580=a50_0x11ced2,_0x4e420c=[],_0xd2b1d=new Date();_0xd2b1d[_0x5e2580(0xe0)](_0xd2b1d[_0x5e2580(0x1d4)]()-this[_0x5e2580(0x1b5)]),console[_0x5e2580(0x1cc)](_0x5e2580(0x1af)+this[_0x5e2580(0x1b5)]+_0x5e2580(0x1be)+_0xd2b1d[_0x5e2580(0xe2)]()+')');for(const _0x1ef425 of _0x2e4d49){if(_0x1ef425['createdAt']<_0xd2b1d){console['log'](_0x5e2580(0x16f)+_0x1ef425['id']+_0x5e2580(0x1c4)+this[_0x5e2580(0x1b5)]+_0x5e2580(0x1d2));try{this[_0x5e2580(0x127)](_0x1ef425['id'],_0x1ef425[_0x5e2580(0x150)]||_0x5e2580(0x1f0),_0x5e2580(0x1ac),_0x5e2580(0x195),_0x5e2580(0x181),{'reason':_0x5e2580(0x104)+this[_0x5e2580(0x1b5)]+'\x20days','createdAt':_0x1ef425[_0x5e2580(0x12e)],'daysSinceCreation':Math[_0x5e2580(0x17c)]((Date['now']()-_0x1ef425[_0x5e2580(0x12e)][_0x5e2580(0x1aa)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x1ef425['amount'],'paymentCurrency':_0x1ef425['currency'],'shopId':_0x1ef425[_0x5e2580(0x130)]}),await database_1[_0x5e2580(0xff)][_0x5e2580(0x1b3)][_0x5e2580(0x1b9)]({'where':{'id':_0x1ef425['id']},'data':{'status':_0x5e2580(0x195),'updatedAt':new Date()}}),await database_1[_0x5e2580(0xff)][_0x5e2580(0x15a)][_0x5e2580(0x1e5)]({'data':{'paymentId':_0x1ef425['id'],'shopId':_0x1ef425[_0x5e2580(0x130)],'event':_0x5e2580(0x173),'statusCode':0xc8,'responseBody':JSON[_0x5e2580(0x13c)]({'reason':_0x5e2580(0x104)+this[_0x5e2580(0x1b5)]+_0x5e2580(0x18d),'createdAt':_0x1ef425[_0x5e2580(0x12e)],'expiredAt':new Date()[_0x5e2580(0xe2)](),'daysSinceCreation':Math[_0x5e2580(0x17c)]((Date[_0x5e2580(0x1dc)]()-_0x1ef425['createdAt']['getTime']())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x5e2580(0x122)](_0x1ef425,_0x5e2580(0x195)),await this[_0x5e2580(0x10e)](_0x1ef425,'EXPIRED'),this[_0x5e2580(0x14a)](_0x1ef425['id']),_0x4e420c[_0x5e2580(0xf6)](_0x1ef425['id']),console[_0x5e2580(0x1cc)](_0x5e2580(0x10b)+_0x1ef425['id']+'\x20marked\x20as\x20EXPIRED\x20due\x20to\x20'+this[_0x5e2580(0x1b5)]+_0x5e2580(0x172));}catch(_0x106886){console[_0x5e2580(0x1b7)](_0x5e2580(0x189)+_0x1ef425['id']+':',_0x106886),this[_0x5e2580(0x1c3)](_0x1ef425['id'],_0x1ef425[_0x5e2580(0x150)]||_0x5e2580(0x1f0),_0x106886,'auto_expire',{'reason':_0x5e2580(0x17b),'createdAt':_0x1ef425[_0x5e2580(0x12e)],'daysSinceCreation':Math[_0x5e2580(0x17c)]((Date[_0x5e2580(0x1dc)]()-_0x1ef425[_0x5e2580(0x12e)][_0x5e2580(0x1aa)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x4e420c;}async['checkSinglePayment'](_0x47d96a){const _0x1c7e91=a50_0x11ced2;if(!_0x47d96a['gatewayPaymentId']){console[_0x1c7e91(0x1cc)]('‚ö†Ô∏è\x20[CHECK]\x20Payment\x20'+_0x47d96a['id']+_0x1c7e91(0x191));return;}console[_0x1c7e91(0x1cc)](_0x1c7e91(0xe8)+_0x47d96a[_0x1c7e91(0x140)]+_0x1c7e91(0x125)+_0x47d96a['id']+'\x20('+_0x47d96a[_0x1c7e91(0x150)]+')');try{let _0x2b5cab;_0x47d96a['gateway']===_0x1c7e91(0x1cf)?(_0x2b5cab=await this[_0x1c7e91(0x176)][_0x1c7e91(0x15c)](_0x47d96a[_0x1c7e91(0x150)]),console['log'](_0x1c7e91(0x1ca)+_0x47d96a['id']+_0x1c7e91(0xe7)+_0x2b5cab[_0x1c7e91(0x145)])):(_0x2b5cab=await this[_0x1c7e91(0xf5)]['checkPaymentStatus'](_0x47d96a['gatewayPaymentId']),console[_0x1c7e91(0x1cc)](_0x1c7e91(0x1a1)+_0x47d96a['id']+_0x1c7e91(0xe7)+_0x2b5cab['status']));_0x2b5cab[_0x1c7e91(0x142)]&&console['log']('üìä\x20[CHECK]\x20Payment\x20'+_0x47d96a['id']+_0x1c7e91(0x1b0),{'iban':_0x2b5cab['paymentDetails']['iban']||_0x1c7e91(0x14d),'transactionId':_0x2b5cab[_0x1c7e91(0x142)]['transactionId'],'createdOn':_0x2b5cab[_0x1c7e91(0x142)][_0x1c7e91(0xdf)],'confirmedOn':_0x2b5cab[_0x1c7e91(0x142)]['confirmedOn']||_0x1c7e91(0x198)});if(_0x2b5cab[_0x1c7e91(0x145)]!==_0x47d96a[_0x1c7e91(0x145)]){console[_0x1c7e91(0x1cc)](_0x1c7e91(0x1da)+_0x47d96a['id']+'\x20status\x20from\x20'+_0x47d96a['status']+_0x1c7e91(0x16a)+_0x2b5cab[_0x1c7e91(0x145)]),this[_0x1c7e91(0x127)](_0x47d96a['id'],_0x47d96a[_0x1c7e91(0x150)],_0x47d96a[_0x1c7e91(0x145)],_0x2b5cab[_0x1c7e91(0x145)],'status_check',{'paymentDetails':_0x2b5cab[_0x1c7e91(0x142)],'amount':_0x2b5cab[_0x1c7e91(0x118)],'currency':_0x2b5cab[_0x1c7e91(0x19e)],'shopId':_0x47d96a['shopId'],'checkTimestamp':new Date()[_0x1c7e91(0xe2)]()});const _0x2406ae={'status':_0x2b5cab[_0x1c7e91(0x145)],'updatedAt':new Date()};if(_0x2b5cab[_0x1c7e91(0x145)]===_0x1c7e91(0x10d)&&_0x47d96a[_0x1c7e91(0x145)]!=='PAID'){_0x2406ae[_0x1c7e91(0x174)]=new Date();if(!_0x47d96a[_0x1c7e91(0x106)]){const _0x54f2fb=await currencyService_1['currencyService'][_0x1c7e91(0x1b4)](_0x47d96a[_0x1c7e91(0x118)],_0x47d96a[_0x1c7e91(0x19e)]);_0x2406ae[_0x1c7e91(0x106)]=_0x54f2fb;const _0x3bd4c2=await this[_0x1c7e91(0x18b)](_0x47d96a[_0x1c7e91(0x130)],_0x47d96a['gateway']),_0x11058b=_0x54f2fb*(0x1-_0x3bd4c2/0x64);_0x2406ae[_0x1c7e91(0x136)]=_0x11058b,_0x2406ae[_0x1c7e91(0x159)]=_0x3bd4c2,console[_0x1c7e91(0x1cc)](_0x1c7e91(0x17e)+_0x47d96a['id']+_0x1c7e91(0xed)),console[_0x1c7e91(0x1cc)]('\x20\x20\x20Amount:\x20'+_0x47d96a[_0x1c7e91(0x118)]+'\x20'+_0x47d96a[_0x1c7e91(0x19e)]+'\x20->\x20'+_0x54f2fb[_0x1c7e91(0x18e)](0x6)+'\x20USDT'),console[_0x1c7e91(0x1cc)](_0x1c7e91(0x137)+_0x47d96a[_0x1c7e91(0x140)]+_0x1c7e91(0x15e)+_0x3bd4c2+'%'),console[_0x1c7e91(0x1cc)](_0x1c7e91(0x178)+_0x11058b[_0x1c7e91(0x18e)](0x6)+'\x20USDT');}console[_0x1c7e91(0x1cc)](_0x1c7e91(0x17e)+_0x47d96a['id']+_0x1c7e91(0x1c7)+_0x2406ae['paidAt'][_0x1c7e91(0xe2)]());}if(_0x2b5cab[_0x1c7e91(0x142)]){const _0x1612c9=_0x2b5cab[_0x1c7e91(0x142)];_0x1612c9[_0x1c7e91(0x1d8)]&&(_0x2406ae['remitterIban']=_0x1612c9[_0x1c7e91(0x1d8)],console[_0x1c7e91(0x1cc)](_0x1c7e91(0x1e8)+_0x1612c9[_0x1c7e91(0x1d8)])),_0x1612c9[_0x1c7e91(0xf8)]&&console[_0x1c7e91(0x1cc)]('üè¶\x20[CHECK]\x20Bank\x20details\x20provided:\x20'+_0x1612c9[_0x1c7e91(0xf8)]),_0x1612c9[_0x1c7e91(0x1b6)]&&console[_0x1c7e91(0x1cc)](_0x1c7e91(0x12c)+_0x1612c9['transactionId']),_0x1612c9[_0x1c7e91(0x1df)]&&console[_0x1c7e91(0x1cc)]('‚úÖ\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20'+_0x1612c9[_0x1c7e91(0x1df)]);}await database_1[_0x1c7e91(0xff)][_0x1c7e91(0x1b3)][_0x1c7e91(0x1b9)]({'where':{'id':_0x47d96a['id']},'data':_0x2406ae});if(_0x2b5cab['status']==='PAID'&&_0x47d96a[_0x1c7e91(0x145)]!==_0x1c7e91(0x10d)){console[_0x1c7e91(0x1cc)](_0x1c7e91(0x1c5)+_0x47d96a['id']+_0x1c7e91(0x170));const _0x1327a4=await database_1[_0x1c7e91(0xff)]['payment'][_0x1c7e91(0xea)]({'where':{'id':_0x47d96a['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x1327a4?.[_0x1c7e91(0xec)]&&_0x1327a4[_0x1c7e91(0x128)])try{const _0x21d116=_0x1327a4[_0x1c7e91(0x128)];console['log'](_0x1c7e91(0x124)+_0x21d116['id']+_0x1c7e91(0x1d6)+_0x21d116[_0x1c7e91(0x1d1)]+',\x20currentPayments='+_0x21d116[_0x1c7e91(0x14f)]+_0x1c7e91(0x161)+_0x21d116[_0x1c7e91(0x145)]);const _0xbef033=_0x21d116[_0x1c7e91(0x14f)]+0x1,_0x5177f5=_0x21d116[_0x1c7e91(0x1d1)]===_0x1c7e91(0x14e)?'COMPLETED':_0x21d116[_0x1c7e91(0x145)];await database_1['default'][_0x1c7e91(0x128)][_0x1c7e91(0x1b9)]({'where':{'id':_0x21d116['id']},'data':{'currentPayments':_0xbef033,'status':_0x5177f5,'updatedAt':new Date()}}),console[_0x1c7e91(0x1cc)]('‚úÖ\x20[COINTOPAY]\x20Payment\x20link\x20'+_0x21d116['id']+_0x1c7e91(0xe9)+_0x21d116[_0x1c7e91(0x14f)]+_0x1c7e91(0x182)+_0xbef033+_0x1c7e91(0x161)+_0x21d116[_0x1c7e91(0x145)]+'\x20->\x20'+_0x5177f5);}catch(_0x2cbff7){console[_0x1c7e91(0x1b7)]('‚ùå\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:',_0x2cbff7);}else console[_0x1c7e91(0x1cc)](_0x1c7e91(0x1c5)+_0x47d96a['id']+'\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link');}await database_1[_0x1c7e91(0xff)]['webhookLog']['create']({'data':{'paymentId':_0x47d96a['id'],'shopId':_0x47d96a[_0x1c7e91(0x130)],'event':_0x1c7e91(0x13f)+_0x2b5cab[_0x1c7e91(0x145)]['toLowerCase'](),'statusCode':0xc8,'responseBody':JSON[_0x1c7e91(0x13c)]({'oldStatus':_0x47d96a['status'],'newStatus':_0x2b5cab[_0x1c7e91(0x145)],'paymentDetails':_0x2b5cab[_0x1c7e91(0x142)],'checkedAt':new Date()[_0x1c7e91(0xe2)]()})}}),await this[_0x1c7e91(0x122)](_0x47d96a,_0x2b5cab['status']),await this[_0x1c7e91(0x10e)](_0x47d96a,_0x2b5cab[_0x1c7e91(0x145)]),_0x2b5cab[_0x1c7e91(0x145)]!=='PENDING'&&(console[_0x1c7e91(0x1cc)](_0x1c7e91(0x1c9)+_0x47d96a['id']+_0x1c7e91(0x1d9)+_0x2b5cab['status']+_0x1c7e91(0x1ee)),this[_0x1c7e91(0x14a)](_0x47d96a['id'])),console[_0x1c7e91(0x1cc)](_0x1c7e91(0x1e9)+_0x47d96a['id']+_0x1c7e91(0x179));}else console[_0x1c7e91(0x1cc)](_0x1c7e91(0x1de)+_0x47d96a['id']+_0x1c7e91(0x12d)+_0x2b5cab[_0x1c7e91(0x145)]+')'),this[_0x1c7e91(0x127)](_0x47d96a['id'],_0x47d96a[_0x1c7e91(0x150)],_0x47d96a['status'],_0x2b5cab[_0x1c7e91(0x145)],'status_check',{'statusUnchanged':!![],'paymentDetails':_0x2b5cab['paymentDetails'],'amount':_0x2b5cab[_0x1c7e91(0x118)],'currency':_0x2b5cab['currency'],'shopId':_0x47d96a[_0x1c7e91(0x130)],'checkTimestamp':new Date()[_0x1c7e91(0xe2)]()});}catch(_0x2507ef){console[_0x1c7e91(0x1b7)](_0x1c7e91(0x10c)+_0x47d96a['id']+':',_0x2507ef),this[_0x1c7e91(0x1c3)](_0x47d96a['id'],_0x47d96a[_0x1c7e91(0x150)],_0x2507ef,_0x1c7e91(0x185),{'paymentAmount':_0x47d96a['amount'],'paymentCurrency':_0x47d96a['currency'],'shopId':_0x47d96a['shopId'],'createdAt':_0x47d96a[_0x1c7e91(0x12e)]}),await database_1[_0x1c7e91(0xff)]['webhookLog'][_0x1c7e91(0x1e5)]({'data':{'paymentId':_0x47d96a['id'],'shopId':_0x47d96a[_0x1c7e91(0x130)],'event':'cointopay_status_check_error','statusCode':0x1f4,'responseBody':JSON[_0x1c7e91(0x13c)]({'error':_0x2507ef instanceof Error?_0x2507ef[_0x1c7e91(0x11b)]:_0x1c7e91(0x114),'gatewayPaymentId':_0x47d96a['gatewayPaymentId'],'checkedAt':new Date()[_0x1c7e91(0xe2)]()})}});}}async[a50_0x11ced2(0x122)](_0x33614a,_0x54ece3){const _0x2c0303=a50_0x11ced2,_0xee5e39=Date[_0x2c0303(0x1dc)]();try{const _0x33a37b=_0x33614a[_0x2c0303(0x1d0)],_0x58a68f=_0x33a37b[_0x2c0303(0x107)];if(!_0x58a68f?.['webhookUrl']){console[_0x2c0303(0x1cc)](_0x2c0303(0x165)+_0x33a37b['id']);return;}const _0x49c903=_0x54ece3==='PAID'?'payment.success':_0x54ece3===_0x2c0303(0x132)?_0x2c0303(0xef):_0x54ece3===_0x2c0303(0x195)?'payment.failed':'payment.pending';if(!_0x58a68f['webhookEvents']?.[_0x2c0303(0x12f)](_0x49c903)){console[_0x2c0303(0x1cc)](_0x2c0303(0x1a0)+_0x49c903+_0x2c0303(0x199)+_0x33a37b['id']);return;}const _0x107d8b=(0x0,gateway_1['getGatewayIdByName'])(_0x33614a['gateway'])||_0x33614a[_0x2c0303(0x140)],_0x210c9b={'event':_0x49c903,'payment':{'id':_0x33614a['id'],'order_id':_0x33614a[_0x2c0303(0xe4)],'gateway_order_id':_0x33614a[_0x2c0303(0x15b)],'gateway':_0x107d8b,'amount':_0x33614a['amount'],'currency':_0x33614a[_0x2c0303(0x19e)],'status':_0x54ece3[_0x2c0303(0x17f)](),'customer_email':_0x33614a[_0x2c0303(0xeb)],'customer_name':_0x33614a[_0x2c0303(0x1a2)],'created_at':_0x33614a[_0x2c0303(0x12e)],'updated_at':new Date()}},_0x2a5d0e=await fetch(_0x58a68f['webhookUrl'],{'method':_0x2c0303(0x187),'headers':{'Content-Type':_0x2c0303(0x175),'User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x2c0303(0x13c)](_0x210c9b)}),_0x31eae3=Date[_0x2c0303(0x1dc)]()-_0xee5e39,_0x209740=_0x2a5d0e['ok']?_0x2c0303(0x1db):await _0x2a5d0e['text']();loggerService_1[_0x2c0303(0x111)][_0x2c0303(0x1ae)](_0x33614a['shopId'],_0x58a68f[_0x2c0303(0x1b2)],_0x49c903,_0x2a5d0e[_0x2c0303(0x145)],_0x31eae3,_0x210c9b),console[_0x2c0303(0x1cc)](_0x2c0303(0x166)+_0x58a68f[_0x2c0303(0x1b2)]+_0x2c0303(0x193)+_0x2a5d0e['status']+'\x20('+_0x31eae3+_0x2c0303(0x156));}catch(_0x523ae9){console[_0x2c0303(0x1b7)](_0x2c0303(0x1d7),_0x523ae9),loggerService_1['loggerService']['logShopWebhookError'](_0x33614a[_0x2c0303(0x130)],_0x33614a[_0x2c0303(0x1d0)]?.[_0x2c0303(0x107)]?.[_0x2c0303(0x1b2)]||_0x2c0303(0x1f0),_0x2c0303(0x120),_0x523ae9,{});}}async[a50_0x11ced2(0x10e)](_0x2b98d7,_0x4465f8){const _0x185d82=a50_0x11ced2;try{const _0x3566f1={'PENDING':'created','PAID':'paid','FAILED':_0x185d82(0x112),'EXPIRED':_0x185d82(0x158)},_0xd39ba2=_0x3566f1[_0x4465f8];if(!_0xd39ba2||_0xd39ba2===_0x185d82(0x1ec))return;await telegramBotService_1[_0x185d82(0x1e7)]['sendPaymentNotification'](_0x2b98d7[_0x185d82(0x130)],_0x2b98d7,_0xd39ba2);}catch(_0x124371){console[_0x185d82(0x1b7)](_0x185d82(0xfe),_0x124371);}}async[a50_0x11ced2(0xe5)](_0x2d4aec){const _0x57d5c3=a50_0x11ced2;console[_0x57d5c3(0x1cc)](_0x57d5c3(0x109)+_0x2d4aec);const _0x36f870=await database_1[_0x57d5c3(0xff)][_0x57d5c3(0x1b3)][_0x57d5c3(0xea)]({'where':{'id':_0x2d4aec},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x36f870)throw new Error(_0x57d5c3(0x196));if(_0x36f870['gateway']!==_0x57d5c3(0xf0)&&_0x36f870[_0x57d5c3(0x140)]!==_0x57d5c3(0x1cf))throw new Error(_0x57d5c3(0x13b));console[_0x57d5c3(0x1cc)](_0x57d5c3(0x19c)+_0x36f870[_0x57d5c3(0x140)]+'\x20payment\x20'+_0x2d4aec),await this[_0x57d5c3(0x141)](_0x36f870),console['log'](_0x57d5c3(0x1b8)+_0x2d4aec);}['getServiceStats'](){const _0x358532=a50_0x11ced2,_0x45a405=this['globalCheckInterval']?this[_0x358532(0x1ea)]:undefined,_0x5d5e2f=Array[_0x358532(0x1bd)](this[_0x358532(0x19d)]['values']())[_0x358532(0x113)](_0x278524=>({'paymentId':_0x278524['paymentId'],'gatewayPaymentId':_0x278524['gatewayPaymentId'],'createdAt':_0x278524['createdAt'],'timersCount':_0x278524[_0x358532(0xf9)]['length']}));return{'isActive':!!this[_0x358532(0x1c8)],'globalCheckIntervalMinutes':this['GLOBAL_CHECK_INTERVAL_MS']/(0x3e8*0x3c),'expiryDays':this[_0x358532(0x1b5)],'activeIndividualTimers':this[_0x358532(0x19d)][_0x358532(0x1ab)],'nextGlobalCheckIn':_0x45a405,'paymentTimersDetails':_0x5d5e2f};}['getPaymentTimerInfo'](_0x350c8a){const _0x4ac51b=a50_0x11ced2,_0x14025a=this[_0x4ac51b(0x19d)][_0x4ac51b(0x11a)](_0x350c8a);if(_0x14025a)return{'hasTimers':!![],'timersCount':_0x14025a[_0x4ac51b(0xf9)]['length'],'createdAt':_0x14025a[_0x4ac51b(0x12e)],'gatewayPaymentId':_0x14025a['gatewayPaymentId']};return{'hasTimers':![]};}async[a50_0x11ced2(0x18b)](_0x317e02,_0xad6569){const _0x3ca149=a50_0x11ced2;try{const _0x233973=await database_1['default'][_0x3ca149(0x1d0)][_0x3ca149(0xea)]({'where':{'id':_0x317e02},'select':{'gatewaySettings':!![]}});if(!_0x233973?.[_0x3ca149(0x1eb)])return console[_0x3ca149(0x1cc)](_0x3ca149(0x13a)+_0x317e02+_0x3ca149(0x131)),0xa;const _0x27da16=JSON[_0x3ca149(0xf3)](_0x233973[_0x3ca149(0x1eb)]);for(const [_0x2302b0,_0x268928]of Object[_0x3ca149(0x129)](_0x27da16)){if(_0x2302b0['toLowerCase']()===_0xad6569['toLowerCase']()){const _0x553da2=_0x268928[_0x3ca149(0x19f)]||0xa;return console['log'](_0x3ca149(0x18c)+_0xad6569+'\x20commission\x20for\x20shop\x20'+_0x317e02+':\x20'+_0x553da2+'%'),_0x553da2;}}return console['log']('No\x20specific\x20commission\x20found\x20for\x20gateway\x20'+_0xad6569+_0x3ca149(0x1e3)+_0x317e02+_0x3ca149(0x192)),0xa;}catch(_0x25f1af){return console['error'](_0x3ca149(0x154)+_0x317e02+_0x3ca149(0x1e1)+_0xad6569+':',_0x25f1af),0xa;}}}exports[a50_0x11ced2(0x14c)]=CoinToPayStatusService,exports['coinToPayStatusService']=new CoinToPayStatusService();