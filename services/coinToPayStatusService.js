'use strict';const a52_0x561cd8=a52_0x501c;(function(_0x1e0dcf,_0x319f96){const _0x57fc02=a52_0x501c,_0x53a3a5=_0x1e0dcf();while(!![]){try{const _0x1f1d13=parseInt(_0x57fc02(0x212))/0x1*(parseInt(_0x57fc02(0x253))/0x2)+-parseInt(_0x57fc02(0x21b))/0x3*(parseInt(_0x57fc02(0x232))/0x4)+-parseInt(_0x57fc02(0x1ad))/0x5+-parseInt(_0x57fc02(0x179))/0x6+parseInt(_0x57fc02(0x1fc))/0x7+parseInt(_0x57fc02(0x258))/0x8+parseInt(_0x57fc02(0x17a))/0x9;if(_0x1f1d13===_0x319f96)break;else _0x53a3a5['push'](_0x53a3a5['shift']());}catch(_0x3893fd){_0x53a3a5['push'](_0x53a3a5['shift']());}}}(a52_0x754e,0x7feb6));var __importDefault=this&&this[a52_0x561cd8(0x165)]||function(_0x281cf5){const _0x5826b7=a52_0x561cd8;return _0x281cf5&&_0x281cf5[_0x5826b7(0x204)]?_0x281cf5:{'default':_0x281cf5};};function a52_0x754e(){const _0x3e5d36=['size','\x20\x20\x20Gateway\x20','status','set','toLowerCase','checkSinglePayment','‚ùå\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','stopPeriodicStatusCheck','logCoinToPayError','‚ö†Ô∏è\x20[CHECK]\x20Payment\x20','schedulePaymentChecks','‚ùå\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','sendPaymentStatusNotification','logShopWebhookError','./telegramBotService','delay','\x20status\x20changed\x20to\x20','orderId','üìä\x20[CHECK]\x20CoinToPay\x20payment\x20',',\x20currentPayments=','16oQjsZL','coinToPayService',',\x20stopping\x20individual\x20checks','\x20\x20\x20-\x20Status:\x20','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','Webhook\x20event\x20','\x20pending\x20CoinToPay\x20payments','amount','description','\x20status\x20is\x20','paid','\x20\x20\x20-\x20Amount:\x20','created','shop','\x20(age:\x20','telegramBotService','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','‚úÖ\x20[CHECK]\x20Payment\x20','checkPaymentStatus','\x20\x20\x20-\x20Gateway:\x20','timers','COMPLETED','\x20updated:\x20currentPayments=','‚ùå\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','cointopay_status_check_','‚ùå\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','remitterIban','1\x20minute','loggerService','webhook_send','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20',',\x20status=','gatewaySettings','2wrcHaW','checkAllPendingPayments','payment.failed','clearPaymentTimers','\x20\x20\x20-\x20ShopId:\x20','2035432UfZwjO','\x20found:','\x20\x20\x20üìä\x20Status:\x20','toISOString','findMany','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','EXPIRY_DAYS','GLOBAL_CHECK_INTERVAL_MS','\x20days,\x20marking\x20as\x20EXPIRED','setDate','CoinToPayStatusService','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','Gateway\x20','not\x20found','\x20status:\x20','push','ü™ô\x20[TIMER]\x20Individual\x20check\x20#','üßπ\x20[DEBUG]\x20Cleared\x20timer\x20#','üìä\x20[CHECK]\x20Payment\x20','bankDetails','cointopay_status_check_error','‚ùå\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','__importDefault','webhookLog','paymentTimers','\x20commission:\x20','üîç\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','üìà\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','‚ùå\x20[TIMER]\x20Failed\x20individual\x20check\x20#','log','2\x20minutes','‚ùå\x20[CHECK]\x20Payment\x20','sendPaymentNotification','transactionId','\x20to\x20clear','üßπ\x20[DEBUG]\x20Clearing\x20','üõë\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','cointopay2','status_check','\x20\x20\x20-\x20paymentId:\x20','\x20is\x20too\x20new\x20(','startPeriodicStatusCheck','3269178WIuTsP','7921854dObQXp','length','amountAfterGatewayCommissionUSDT','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','\x20days','Payment\x20System/1.0','../types/gateway','create','Shop\x20webhook\x20sent\x20to\x20','./loggerService','iban','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','SINGLE','‚è∞\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','\x20individual\x20payment\x20timers','paidAt','checkSinglePaymentById','coinToPay2Service','\x20payment\x20','‚úÖ\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','‚è∞\x20[HOURLY]\x20Payment\x20','\x20has\x20no\x20gatewayPaymentId,\x20skipping','5\x20minutes',',\x20gateway\x20','checkExpiredPayments','cointopay_auto_expired','parse','paymentDetails','‚ö†Ô∏è\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','coinToPayStatusService','./currencyService','POST','/status/','shopId','defineProperty','ü™ô\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','./gateways/coinToPay2Service','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','paymentLinkId','\x20(after\x20','../config/database','update','toFixed','‚úÖ\x20[TIMER]\x20Individual\x20check\x20#','‚úÖ\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','\x20current\x20status:\x20','./gateways/coinToPayService','\x20triggered\x20for\x20payment\x20','h),\x20skipping\x20global\x20check','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','currencyService','3202390tDOCpX',',\x20using\x20default\x20commission\x2010%','ü™ô\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','‚úÖ\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','checkPaymentById','PAID','schedule_created','not\x20confirmed','\x20\x20\x20üìç\x20Source:\x20','floor','currency','stringify','\x20in\x20','message','findUnique','currentPayments','üè¶\x20[CHECK]\x20Bank\x20details\x20provided:\x20','ms)','globalCheckInterval','cointopay','unknown','ü™ô\x20[ERROR]\x20CoinToPay\x20Error:\x20','Success','getGatewayIdByName','\x20days\x20(created\x20before\x20','\x20is\x20older\x20than\x20','\x20marked\x20as\x20paid\x20at:\x20','values','üìä\x20[HOURLY]\x20Payment\x20','expired','confirmedOn','getGatewayCommission','getDate','map','üìà\x20[COINTOPAY]\x20Payment\x20','payment.pending','\x20commission\x20for\x20shop\x20','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','logWhiteDomainError','stack','üÜî\x20[CHECK]\x20Transaction\x20ID:\x20','‚úÖ\x20[COINTOPAY]\x20Payment\x20link\x20','gatewayOrderId','createdAt','COINTOPAY_ERROR','gatewayPaymentId','error','\x20is\x20valid\x20for\x20checking,\x20proceeding...','Unknown\x20error','‚úÖ\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','\x20not\x20enabled\x20for\x20shop\x20','\x20->\x20','\x20\x20\x20Amount:\x20','\x20USDT','ü™ô\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','webhookEvents','‚úÖ\x20[EXPIRY]\x20Payment\x20','paymentId','gatewayCommissionRate','getTime','\x20not\x20found,\x20clearing\x20timers','Failed\x20to\x20mark\x20payment\x20as\x20expired','payment','includes','‚è∞\x20[DEBUG]\x20Scheduled\x20check\x20#','\x20completed\x20for\x20payment\x20','üè¶\x20[CHECK]\x20Saved\x20IBAN:\x20','\x20\x20\x20üìÖ\x20Time:\x20','üìä\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','FAILED','üîÑ\x20[CHECK]\x20Updating\x20payment\x20','\x20timers\x20for\x20payment\x20','‚è∞\x20[GLOBAL]\x20Payment\x20','ü™ô\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','‚ùå\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','auto_expire','text','forEach','COINTOPAY_STATUS_CHANGE','6620726wDpFjP','PENDING','Payment\x20older\x20than\x20','üîç\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','failed','\x20in\x20shop\x20','gateway','paymentLink','__esModule','default','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','webhookUrl','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','‚ùå\x20[HOURLY]\x20Payment\x20','convertToUSDT','now','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','\x20expired','CoinToPayService','\x20seconds\x20(','type','üí∞\x20[CHECK]\x20Payment\x20','208214ODpbzB','EXPIRED','\x20checked,\x20','sendShopWebhook','settings','üõë\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','from','timestamp','logCoinToPayStatus','434526yTfFed','\x20\x20\x20‚ùå\x20Error:\x20','ü™ô\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20'];a52_0x754e=function(){return _0x3e5d36;};return a52_0x754e();}Object[a52_0x561cd8(0x19c)](exports,'__esModule',{'value':!![]}),exports['coinToPayStatusService']=exports[a52_0x561cd8(0x159)]=void 0x0;function a52_0x501c(_0x289e15,_0x6ff3af){_0x289e15=_0x289e15-0x154;const _0x754eb=a52_0x754e();let _0x501c5=_0x754eb[_0x289e15];return _0x501c5;}const coinToPayService_1=require(a52_0x561cd8(0x1a8)),coinToPay2Service_1=require(a52_0x561cd8(0x19e)),gateway_1=require(a52_0x561cd8(0x180)),database_1=__importDefault(require(a52_0x561cd8(0x1a2))),telegramBotService_1=require(a52_0x561cd8(0x22c)),loggerService_1=require(a52_0x561cd8(0x183)),currencyService_1=require(a52_0x561cd8(0x198));class CoinToPayStatusService{constructor(){const _0x37198b=a52_0x561cd8;this[_0x37198b(0x1bf)]=null,this[_0x37198b(0x156)]=0x3c*0x3c*0x3e8,this[_0x37198b(0x155)]=0x5,this[_0x37198b(0x167)]=new Map(),this[_0x37198b(0x233)]=new coinToPayService_1[(_0x37198b(0x20e))](),this[_0x37198b(0x18b)]=new coinToPay2Service_1['CoinToPay2Service'](),console['log'](_0x37198b(0x1f6));}[a52_0x561cd8(0x228)](_0x26d0bc,_0xbc07ed){const _0x3ab442=a52_0x561cd8;console[_0x3ab442(0x16c)](_0x3ab442(0x19d)),console[_0x3ab442(0x16c)](_0x3ab442(0x176)+_0x26d0bc),console['log']('\x20\x20\x20-\x20gatewayPaymentId:\x20'+_0xbc07ed),this['clearPaymentTimers'](_0x26d0bc);const _0x2a636b=[],_0x287724=new Date(),_0x15b3a8=[{'delay':0x1*0x3c*0x3e8,'description':_0x3ab442(0x24d)},{'delay':0x2*0x3c*0x3e8,'description':_0x3ab442(0x16d)},{'delay':0x5*0x3c*0x3e8,'description':_0x3ab442(0x190)},{'delay':0x5*0x3c*0x3e8,'description':_0x3ab442(0x190)}];console[_0x3ab442(0x16c)]('ü™ô\x20[DEBUG]\x20Creating\x20'+_0x15b3a8['length']+'\x20initial\x20timers\x20for\x20payment\x20'+_0x26d0bc);let _0x365721=0x0;_0x15b3a8[_0x3ab442(0x1fa)]((_0x5344e4,_0x4fecbd)=>{const _0x457324=_0x3ab442;_0x365721+=_0x5344e4[_0x457324(0x22d)];const _0x53f577=setTimeout(async()=>{const _0x1a68a5=_0x457324;console[_0x1a68a5(0x16c)](_0x1a68a5(0x15f)+(_0x4fecbd+0x1)+_0x1a68a5(0x1a9)+_0x26d0bc+_0x1a68a5(0x1a1)+_0x5344e4[_0x1a68a5(0x23a)]+')');try{await this['checkSinglePaymentById'](_0x26d0bc),console[_0x1a68a5(0x16c)](_0x1a68a5(0x1a5)+(_0x4fecbd+0x1)+_0x1a68a5(0x1ee)+_0x26d0bc);}catch(_0x484951){console[_0x1a68a5(0x1db)](_0x1a68a5(0x16b)+(_0x4fecbd+0x1)+'\x20for\x20payment\x20'+_0x26d0bc+':',_0x484951),this[_0x1a68a5(0x226)](_0x26d0bc,_0xbc07ed,_0x484951,_0x1a68a5(0x175),{'checkNumber':_0x4fecbd+0x1,'scheduledAfter':_0x5344e4[_0x1a68a5(0x23a)],'isIndividualCheck':!![]});}},_0x365721);_0x2a636b[_0x457324(0x15e)](_0x53f577),console['log'](_0x457324(0x1ed)+(_0x4fecbd+0x1)+'\x20for\x20payment\x20'+_0x26d0bc+_0x457324(0x1b9)+_0x365721/0x3e8+_0x457324(0x20f)+_0x5344e4['description']+')');});const _0x10a56a=setInterval(async()=>{const _0x42d5ef=_0x3ab442;console[_0x42d5ef(0x16c)](_0x42d5ef(0x21d)+_0x26d0bc);try{const _0x425e51=await database_1[_0x42d5ef(0x205)]['payment'][_0x42d5ef(0x1bb)]({'where':{'id':_0x26d0bc},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x425e51){console[_0x42d5ef(0x16c)](_0x42d5ef(0x209)+_0x26d0bc+_0x42d5ef(0x1e9)),this[_0x42d5ef(0x256)](_0x26d0bc);return;}console[_0x42d5ef(0x16c)](_0x42d5ef(0x1c9)+_0x26d0bc+_0x42d5ef(0x1a7)+_0x425e51[_0x42d5ef(0x220)]);if(_0x425e51['status']!=='PENDING'){console[_0x42d5ef(0x16c)]('‚úÖ\x20[HOURLY]\x20Payment\x20'+_0x26d0bc+'\x20status\x20is\x20'+_0x425e51[_0x42d5ef(0x220)]+_0x42d5ef(0x234)),this['clearPaymentTimers'](_0x26d0bc);return;}const _0x1b5685=Math[_0x42d5ef(0x1b6)]((Date[_0x42d5ef(0x20b)]()-_0x425e51['createdAt'][_0x42d5ef(0x1e8)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x1b5685>=this[_0x42d5ef(0x155)]){console['log'](_0x42d5ef(0x18e)+_0x26d0bc+_0x42d5ef(0x1c6)+this[_0x42d5ef(0x155)]+_0x42d5ef(0x208)),this['clearPaymentTimers'](_0x26d0bc);return;}await this[_0x42d5ef(0x18a)](_0x26d0bc),console[_0x42d5ef(0x16c)](_0x42d5ef(0x1b0)+_0x26d0bc);}catch(_0x5b9680){console[_0x42d5ef(0x1db)](_0x42d5ef(0x229)+_0x26d0bc+':',_0x5b9680),this[_0x42d5ef(0x226)](_0x26d0bc,_0xbc07ed,_0x5b9680,'status_check',{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x2a636b['push'](_0x10a56a),this[_0x3ab442(0x167)][_0x3ab442(0x221)](_0x26d0bc,{'timers':_0x2a636b,'paymentId':_0x26d0bc,'gatewayPaymentId':_0xbc07ed,'createdAt':_0x287724}),console['log']('‚úÖ\x20[DEBUG]\x20Successfully\x20scheduled\x20'+_0x15b3a8[_0x3ab442(0x17b)]+_0x3ab442(0x1d2)+_0x26d0bc),console[_0x3ab442(0x16c)](_0x3ab442(0x1f1)+this[_0x3ab442(0x167)][_0x3ab442(0x21e)]),this[_0x3ab442(0x21a)](_0x26d0bc,_0xbc07ed,_0x3ab442(0x1fd),_0x3ab442(0x1fd),_0x3ab442(0x175),{'action':_0x3ab442(0x1b3),'scheduledChecks':_0x15b3a8[_0x3ab442(0x17b)],'firstCheckIn':_0x15b3a8[0x0][_0x3ab442(0x22d)]/0x3e8,'totalTimers':this[_0x3ab442(0x167)][_0x3ab442(0x21e)]});}[a52_0x561cd8(0x256)](_0x818e5a){const _0x4589dd=a52_0x561cd8,_0xd6b437=this[_0x4589dd(0x167)]['get'](_0x818e5a);_0xd6b437?(console[_0x4589dd(0x16c)](_0x4589dd(0x172)+_0xd6b437[_0x4589dd(0x246)]['length']+_0x4589dd(0x1f4)+_0x818e5a),_0xd6b437[_0x4589dd(0x246)][_0x4589dd(0x1fa)]((_0x477d74,_0x400742)=>{const _0xe45ccf=_0x4589dd;_0x477d74&&(clearTimeout(_0x477d74),clearInterval(_0x477d74),console['log'](_0xe45ccf(0x160)+(_0x400742+0x1)+'\x20for\x20payment\x20'+_0x818e5a));}),this[_0x4589dd(0x167)]['delete'](_0x818e5a),console['log']('‚úÖ\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20'+_0x818e5a+'.\x20Remaining\x20active\x20timers:\x20'+this[_0x4589dd(0x167)][_0x4589dd(0x21e)])):console[_0x4589dd(0x16c)](_0x4589dd(0x196)+_0x818e5a+_0x4589dd(0x171));}async['checkSinglePaymentById'](_0x539c71){const _0xa8ddf1=a52_0x561cd8;console['log'](_0xa8ddf1(0x169)+_0x539c71);const _0xeba64=await database_1['default'][_0xa8ddf1(0x1eb)][_0xa8ddf1(0x1bb)]({'where':{'id':_0x539c71},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0xeba64){console[_0xa8ddf1(0x16c)](_0xa8ddf1(0x16e)+_0x539c71+'\x20not\x20found\x20in\x20database');return;}console[_0xa8ddf1(0x16c)](_0xa8ddf1(0x161)+_0x539c71+_0xa8ddf1(0x259)),console[_0xa8ddf1(0x16c)](_0xa8ddf1(0x245)+_0xeba64['gateway']),console[_0xa8ddf1(0x16c)](_0xa8ddf1(0x235)+_0xeba64['status']),console[_0xa8ddf1(0x16c)]('\x20\x20\x20-\x20GatewayPaymentId:\x20'+_0xeba64[_0xa8ddf1(0x1da)]),console[_0xa8ddf1(0x16c)](_0xa8ddf1(0x23d)+_0xeba64[_0xa8ddf1(0x239)]+'\x20'+_0xeba64[_0xa8ddf1(0x1b7)]),console[_0xa8ddf1(0x16c)](_0xa8ddf1(0x257)+_0xeba64[_0xa8ddf1(0x19b)]);if(_0xeba64[_0xa8ddf1(0x202)]!=='cointopay'&&_0xeba64[_0xa8ddf1(0x202)]!=='cointopay2'){console[_0xa8ddf1(0x16c)](_0xa8ddf1(0x227)+_0x539c71+_0xa8ddf1(0x242)+_0xeba64[_0xa8ddf1(0x202)]+')');return;}if(_0xeba64['status']!=='PENDING'){console[_0xa8ddf1(0x16c)](_0xa8ddf1(0x227)+_0x539c71+_0xa8ddf1(0x23b)+_0xeba64[_0xa8ddf1(0x220)]+',\x20stopping\x20individual\x20checks'),this[_0xa8ddf1(0x256)](_0x539c71);return;}if(!_0xeba64['gatewayPaymentId']){console[_0xa8ddf1(0x16c)](_0xa8ddf1(0x227)+_0x539c71+'\x20has\x20no\x20gatewayPaymentId');return;}console[_0xa8ddf1(0x16c)](_0xa8ddf1(0x243)+_0x539c71+_0xa8ddf1(0x1dc)),await this[_0xa8ddf1(0x223)](_0xeba64);}[a52_0x561cd8(0x21a)](_0x550031,_0x55c847,_0x45a0e3,_0x40eadd,_0x53426f,_0x25912c){const _0x2d1b62=a52_0x561cd8,_0xaddb76={'type':_0x2d1b62(0x1fb),'paymentId':_0x550031,'gatewayPaymentId':_0x55c847,'oldStatus':_0x45a0e3,'newStatus':_0x40eadd,'source':_0x53426f,'timestamp':new Date()[_0x2d1b62(0x25b)](),'details':_0x25912c||{}};loggerService_1['loggerService'][_0x2d1b62(0x21a)](_0xaddb76),console[_0x2d1b62(0x16c)](_0x2d1b62(0x1e3)+_0x550031+'\x20('+_0x55c847+')'),console[_0x2d1b62(0x16c)](_0x2d1b62(0x25a)+_0x45a0e3+_0x2d1b62(0x1e0)+_0x40eadd),console['log'](_0x2d1b62(0x1b5)+_0x53426f),console['log'](_0x2d1b62(0x1f0)+_0xaddb76[_0x2d1b62(0x219)]),_0x25912c&&console[_0x2d1b62(0x16c)]('\x20\x20\x20üìù\x20Details:',_0x25912c);}[a52_0x561cd8(0x226)](_0x354211,_0x41808f,_0x571b0c,_0xe28e92,_0x25954d){const _0x404c82=a52_0x561cd8,_0x58fd3a={'type':_0x404c82(0x1d9),'paymentId':_0x354211,'gatewayPaymentId':_0x41808f,'error':_0x571b0c instanceof Error?{'message':_0x571b0c[_0x404c82(0x1ba)],'stack':_0x571b0c[_0x404c82(0x1d4)]}:_0x571b0c,'source':_0xe28e92,'timestamp':new Date()[_0x404c82(0x25b)](),'context':_0x25954d||{}};loggerService_1[_0x404c82(0x24e)][_0x404c82(0x226)](_0x58fd3a),console[_0x404c82(0x1db)](_0x404c82(0x1c2)+_0x354211+'\x20('+_0x41808f+')'),console[_0x404c82(0x1db)](_0x404c82(0x21c)+(_0x571b0c instanceof Error?_0x571b0c[_0x404c82(0x1ba)]:_0x571b0c)),console[_0x404c82(0x1db)]('\x20\x20\x20üìç\x20Source:\x20'+_0xe28e92),console[_0x404c82(0x1db)](_0x404c82(0x1f0)+_0x58fd3a['timestamp']),_0x25954d&&console[_0x404c82(0x1db)]('\x20\x20\x20üìù\x20Context:',_0x25954d);}[a52_0x561cd8(0x178)](){const _0xb1fd22=a52_0x561cd8;console[_0xb1fd22(0x16c)]('ü™ô\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)'),this[_0xb1fd22(0x254)]()['catch'](_0x216dd4=>{const _0x5213ba=_0xb1fd22;console[_0x5213ba(0x1db)](_0x5213ba(0x24b),_0x216dd4);}),this[_0xb1fd22(0x1bf)]=setInterval(async()=>{const _0x1c4431=_0xb1fd22;try{console[_0x1c4431(0x16c)]('ü™ô\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...'),await this[_0x1c4431(0x254)](),console[_0x1c4431(0x16c)](_0x1c4431(0x20c));}catch(_0x287e75){console['error'](_0x1c4431(0x249),_0x287e75);}},this[_0xb1fd22(0x156)]),console['log'](_0xb1fd22(0x1de));}[a52_0x561cd8(0x225)](){const _0x5167c7=a52_0x561cd8;console[_0x5167c7(0x16c)](_0x5167c7(0x173));this[_0x5167c7(0x1bf)]&&(clearInterval(this[_0x5167c7(0x1bf)]),this[_0x5167c7(0x1bf)]=null,console['log'](_0x5167c7(0x217)));const _0xfde078=this[_0x5167c7(0x167)]['size'];for(const [_0x36e5c6]of this['paymentTimers']){this[_0x5167c7(0x256)](_0x36e5c6);}console[_0x5167c7(0x16c)]('üõë\x20[SHUTDOWN]\x20Cleared\x20'+_0xfde078+_0x5167c7(0x188));}async['checkAllPendingPayments'](){const _0x2fb072=a52_0x561cd8;try{console['log']('ü™ô\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...');const _0x5011c0=await database_1[_0x2fb072(0x205)][_0x2fb072(0x1eb)][_0x2fb072(0x25c)]({'where':{'gateway':{'in':['cointopay','cointopay2']},'status':'PENDING','gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x2fb072(0x16c)]('ü™ô\x20[GLOBAL]\x20Found\x20'+_0x5011c0['length']+_0x2fb072(0x238));if(_0x5011c0[_0x2fb072(0x17b)]===0x0){console[_0x2fb072(0x16c)](_0x2fb072(0x1af));return;}const _0x579f84=await this[_0x2fb072(0x192)](_0x5011c0);console['log']('‚è∞\x20[GLOBAL]\x20Found\x20'+_0x579f84[_0x2fb072(0x17b)]+'\x20expired\x20CoinToPay\x20payments');let _0xc026f0=0x0,_0x733ecd=0x0;for(const _0x488f8b of _0x5011c0){try{if(_0x579f84[_0x2fb072(0x1ec)](_0x488f8b['id'])){console[_0x2fb072(0x16c)](_0x2fb072(0x1f5)+_0x488f8b['id']+_0x2fb072(0x154)),_0x733ecd++;continue;}if(this[_0x2fb072(0x167)]['has'](_0x488f8b['id'])){console['log'](_0x2fb072(0x1f5)+_0x488f8b['id']+'\x20has\x20individual\x20timers,\x20skipping\x20global\x20check'),_0x733ecd++;continue;}const _0x48edad=(Date[_0x2fb072(0x20b)]()-_0x488f8b[_0x2fb072(0x1d8)][_0x2fb072(0x1e8)]())/(0x3e8*0x3c*0x3c);if(_0x48edad<0x1){console[_0x2fb072(0x16c)](_0x2fb072(0x1f5)+_0x488f8b['id']+_0x2fb072(0x177)+_0x48edad['toFixed'](0x1)+_0x2fb072(0x1aa)),_0x733ecd++;continue;}console['log']('üîç\x20[GLOBAL]\x20Checking\x20old\x20payment\x20'+_0x488f8b['id']+_0x2fb072(0x240)+_0x48edad['toFixed'](0x1)+'h)'),await this['checkSinglePayment'](_0x488f8b),_0xc026f0++,await new Promise(_0x26f471=>setTimeout(_0x26f471,0x7d0));}catch(_0x570cbe){console[_0x2fb072(0x1db)](_0x2fb072(0x19f)+_0x488f8b['id']+':',_0x570cbe),this['logCoinToPayError'](_0x488f8b['id'],_0x488f8b['gatewayPaymentId']||_0x2fb072(0x1c1),_0x570cbe,_0x2fb072(0x175),{'isGlobalCheck':!![],'paymentAmount':_0x488f8b[_0x2fb072(0x239)],'paymentCurrency':_0x488f8b[_0x2fb072(0x1b7)],'shopId':_0x488f8b[_0x2fb072(0x19b)],'createdAt':_0x488f8b[_0x2fb072(0x1d8)]}),loggerService_1[_0x2fb072(0x24e)][_0x2fb072(0x1d3)](_0x2fb072(0x1c0),_0x2fb072(0x19a)+_0x488f8b[_0x2fb072(0x1da)],_0x570cbe);}}console[_0x2fb072(0x16c)](_0x2fb072(0x17d)+_0xc026f0+_0x2fb072(0x214)+_0x733ecd+'\x20skipped,\x20'+_0x579f84[_0x2fb072(0x17b)]+_0x2fb072(0x20d));}catch(_0x2f5151){console['error'](_0x2fb072(0x185),_0x2f5151);}}async[a52_0x561cd8(0x192)](_0x5acb5b){const _0x1a473d=a52_0x561cd8,_0x36c6bc=[],_0x18aa8f=new Date();_0x18aa8f[_0x1a473d(0x158)](_0x18aa8f[_0x1a473d(0x1cd)]()-this[_0x1a473d(0x155)]),console['log'](_0x1a473d(0x187)+this[_0x1a473d(0x155)]+_0x1a473d(0x1c5)+_0x18aa8f[_0x1a473d(0x25b)]()+')');for(const _0x1e77b3 of _0x5acb5b){if(_0x1e77b3[_0x1a473d(0x1d8)]<_0x18aa8f){console[_0x1a473d(0x16c)]('‚è∞\x20[EXPIRY]\x20Payment\x20'+_0x1e77b3['id']+_0x1a473d(0x1c6)+this[_0x1a473d(0x155)]+_0x1a473d(0x157));try{this[_0x1a473d(0x21a)](_0x1e77b3['id'],_0x1e77b3[_0x1a473d(0x1da)]||'unknown',_0x1a473d(0x1fd),_0x1a473d(0x213),_0x1a473d(0x1f8),{'reason':_0x1a473d(0x1fe)+this[_0x1a473d(0x155)]+_0x1a473d(0x17e),'createdAt':_0x1e77b3[_0x1a473d(0x1d8)],'daysSinceCreation':Math[_0x1a473d(0x1b6)]((Date[_0x1a473d(0x20b)]()-_0x1e77b3[_0x1a473d(0x1d8)]['getTime']())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x1e77b3[_0x1a473d(0x239)],'paymentCurrency':_0x1e77b3[_0x1a473d(0x1b7)],'shopId':_0x1e77b3[_0x1a473d(0x19b)]}),await database_1[_0x1a473d(0x205)]['payment'][_0x1a473d(0x1a3)]({'where':{'id':_0x1e77b3['id']},'data':{'status':_0x1a473d(0x213),'updatedAt':new Date()}}),await database_1['default']['webhookLog'][_0x1a473d(0x181)]({'data':{'paymentId':_0x1e77b3['id'],'shopId':_0x1e77b3[_0x1a473d(0x19b)],'event':_0x1a473d(0x193),'statusCode':0xc8,'responseBody':JSON['stringify']({'reason':_0x1a473d(0x1fe)+this[_0x1a473d(0x155)]+'\x20days','createdAt':_0x1e77b3['createdAt'],'expiredAt':new Date()[_0x1a473d(0x25b)](),'daysSinceCreation':Math[_0x1a473d(0x1b6)]((Date[_0x1a473d(0x20b)]()-_0x1e77b3[_0x1a473d(0x1d8)][_0x1a473d(0x1e8)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x1a473d(0x215)](_0x1e77b3,_0x1a473d(0x213)),await this[_0x1a473d(0x22a)](_0x1e77b3,_0x1a473d(0x213)),this[_0x1a473d(0x256)](_0x1e77b3['id']),_0x36c6bc[_0x1a473d(0x15e)](_0x1e77b3['id']),console[_0x1a473d(0x16c)](_0x1a473d(0x1e5)+_0x1e77b3['id']+_0x1a473d(0x206)+this['EXPIRY_DAYS']+'-day\x20timeout');}catch(_0x44d618){console['error'](_0x1a473d(0x224)+_0x1e77b3['id']+':',_0x44d618),this[_0x1a473d(0x226)](_0x1e77b3['id'],_0x1e77b3['gatewayPaymentId']||_0x1a473d(0x1c1),_0x44d618,'auto_expire',{'reason':_0x1a473d(0x1ea),'createdAt':_0x1e77b3[_0x1a473d(0x1d8)],'daysSinceCreation':Math['floor']((Date[_0x1a473d(0x20b)]()-_0x1e77b3[_0x1a473d(0x1d8)][_0x1a473d(0x1e8)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x36c6bc;}async[a52_0x561cd8(0x223)](_0x4be09e){const _0xb25dfd=a52_0x561cd8;if(!_0x4be09e[_0xb25dfd(0x1da)]){console[_0xb25dfd(0x16c)](_0xb25dfd(0x227)+_0x4be09e['id']+_0xb25dfd(0x18f));return;}console[_0xb25dfd(0x16c)]('üîç\x20[CHECK]\x20Checking\x20'+_0x4be09e[_0xb25dfd(0x202)]+_0xb25dfd(0x18c)+_0x4be09e['id']+'\x20('+_0x4be09e[_0xb25dfd(0x1da)]+')');try{let _0x4aea78;_0x4be09e[_0xb25dfd(0x202)]===_0xb25dfd(0x174)?(_0x4aea78=await this[_0xb25dfd(0x18b)][_0xb25dfd(0x244)](_0x4be09e[_0xb25dfd(0x1da)]),console[_0xb25dfd(0x16c)]('üìä\x20[CHECK]\x20CoinToPay2\x20payment\x20'+_0x4be09e['id']+'\x20status:\x20'+_0x4aea78[_0xb25dfd(0x220)])):(_0x4aea78=await this[_0xb25dfd(0x233)][_0xb25dfd(0x244)](_0x4be09e['gatewayPaymentId']),console[_0xb25dfd(0x16c)](_0xb25dfd(0x230)+_0x4be09e['id']+_0xb25dfd(0x15d)+_0x4aea78[_0xb25dfd(0x220)]));_0x4aea78[_0xb25dfd(0x195)]&&console[_0xb25dfd(0x16c)](_0xb25dfd(0x161)+_0x4be09e['id']+'\x20details:',{'iban':_0x4aea78['paymentDetails'][_0xb25dfd(0x184)]||_0xb25dfd(0x15c),'transactionId':_0x4aea78[_0xb25dfd(0x195)][_0xb25dfd(0x170)],'createdOn':_0x4aea78['paymentDetails']['createdOn'],'confirmedOn':_0x4aea78[_0xb25dfd(0x195)][_0xb25dfd(0x1cb)]||_0xb25dfd(0x1b4)});if(_0x4aea78[_0xb25dfd(0x220)]!==_0x4be09e[_0xb25dfd(0x220)]){console['log'](_0xb25dfd(0x1f3)+_0x4be09e['id']+'\x20status\x20from\x20'+_0x4be09e[_0xb25dfd(0x220)]+'\x20to\x20'+_0x4aea78[_0xb25dfd(0x220)]),this[_0xb25dfd(0x21a)](_0x4be09e['id'],_0x4be09e[_0xb25dfd(0x1da)],_0x4be09e[_0xb25dfd(0x220)],_0x4aea78[_0xb25dfd(0x220)],_0xb25dfd(0x175),{'paymentDetails':_0x4aea78[_0xb25dfd(0x195)],'amount':_0x4aea78[_0xb25dfd(0x239)],'currency':_0x4aea78[_0xb25dfd(0x1b7)],'shopId':_0x4be09e[_0xb25dfd(0x19b)],'checkTimestamp':new Date()[_0xb25dfd(0x25b)]()});const _0xa64144={'status':_0x4aea78[_0xb25dfd(0x220)],'updatedAt':new Date()};if(_0x4aea78['status']===_0xb25dfd(0x1b2)&&_0x4be09e['status']!=='PAID'){_0xa64144[_0xb25dfd(0x189)]=new Date();if(!_0x4be09e['amountUSDT']){const _0x346da9=await currencyService_1[_0xb25dfd(0x1ac)][_0xb25dfd(0x20a)](_0x4be09e[_0xb25dfd(0x239)],_0x4be09e['currency']);_0xa64144['amountUSDT']=_0x346da9;const _0x110822=await this[_0xb25dfd(0x1cc)](_0x4be09e[_0xb25dfd(0x19b)],_0x4be09e['gateway']),_0x29e542=_0x346da9*(0x1-_0x110822/0x64);_0xa64144[_0xb25dfd(0x17c)]=_0x29e542,_0xa64144[_0xb25dfd(0x1e7)]=_0x110822,console[_0xb25dfd(0x16c)](_0xb25dfd(0x211)+_0x4be09e['id']+'\x20amounts\x20calculated:'),console[_0xb25dfd(0x16c)](_0xb25dfd(0x1e1)+_0x4be09e[_0xb25dfd(0x239)]+'\x20'+_0x4be09e[_0xb25dfd(0x1b7)]+_0xb25dfd(0x1e0)+_0x346da9[_0xb25dfd(0x1a4)](0x6)+_0xb25dfd(0x1e2)),console['log'](_0xb25dfd(0x21f)+_0x4be09e[_0xb25dfd(0x202)]+_0xb25dfd(0x168)+_0x110822+'%'),console['log']('\x20\x20\x20Amount\x20after\x20commission:\x20'+_0x29e542[_0xb25dfd(0x1a4)](0x6)+_0xb25dfd(0x1e2));}console[_0xb25dfd(0x16c)]('üí∞\x20[CHECK]\x20Payment\x20'+_0x4be09e['id']+_0xb25dfd(0x1c7)+_0xa64144[_0xb25dfd(0x189)][_0xb25dfd(0x25b)]());}if(_0x4aea78[_0xb25dfd(0x195)]){const _0x57e98f=_0x4aea78[_0xb25dfd(0x195)];_0x57e98f[_0xb25dfd(0x184)]&&(_0xa64144[_0xb25dfd(0x24c)]=_0x57e98f['iban'],console[_0xb25dfd(0x16c)](_0xb25dfd(0x1ef)+_0x57e98f[_0xb25dfd(0x184)])),_0x57e98f[_0xb25dfd(0x162)]&&console[_0xb25dfd(0x16c)](_0xb25dfd(0x1bd)+_0x57e98f[_0xb25dfd(0x162)]),_0x57e98f[_0xb25dfd(0x170)]&&console[_0xb25dfd(0x16c)](_0xb25dfd(0x1d5)+_0x57e98f[_0xb25dfd(0x170)]),_0x57e98f['confirmedOn']&&console[_0xb25dfd(0x16c)](_0xb25dfd(0x18d)+_0x57e98f[_0xb25dfd(0x1cb)]);}await database_1['default'][_0xb25dfd(0x1eb)][_0xb25dfd(0x1a3)]({'where':{'id':_0x4be09e['id']},'data':_0xa64144});if(_0x4aea78[_0xb25dfd(0x220)]===_0xb25dfd(0x1b2)&&_0x4be09e[_0xb25dfd(0x220)]!==_0xb25dfd(0x1b2)){console['log'](_0xb25dfd(0x1cf)+_0x4be09e['id']+_0xb25dfd(0x1ab));const _0x4bd837=await database_1[_0xb25dfd(0x205)][_0xb25dfd(0x1eb)]['findUnique']({'where':{'id':_0x4be09e['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x4bd837?.[_0xb25dfd(0x1a0)]&&_0x4bd837['paymentLink'])try{const _0x432450=_0x4bd837['paymentLink'];console[_0xb25dfd(0x16c)](_0xb25dfd(0x16a)+_0x432450['id']+':\x20type='+_0x432450['type']+_0xb25dfd(0x231)+_0x432450[_0xb25dfd(0x1bc)]+_0xb25dfd(0x251)+_0x432450[_0xb25dfd(0x220)]);const _0x101310=_0x432450['currentPayments']+0x1,_0x4c436d=_0x432450[_0xb25dfd(0x210)]===_0xb25dfd(0x186)?_0xb25dfd(0x247):_0x432450[_0xb25dfd(0x220)];await database_1[_0xb25dfd(0x205)][_0xb25dfd(0x203)][_0xb25dfd(0x1a3)]({'where':{'id':_0x432450['id']},'data':{'currentPayments':_0x101310,'status':_0x4c436d,'updatedAt':new Date()}}),console['log'](_0xb25dfd(0x1d6)+_0x432450['id']+_0xb25dfd(0x248)+_0x432450[_0xb25dfd(0x1bc)]+_0xb25dfd(0x1e0)+_0x101310+_0xb25dfd(0x251)+_0x432450['status']+_0xb25dfd(0x1e0)+_0x4c436d);}catch(_0x20ce42){console[_0xb25dfd(0x1db)](_0xb25dfd(0x1f7),_0x20ce42);}else console['log'](_0xb25dfd(0x1cf)+_0x4be09e['id']+_0xb25dfd(0x236));}await database_1[_0xb25dfd(0x205)]['webhookLog'][_0xb25dfd(0x181)]({'data':{'paymentId':_0x4be09e['id'],'shopId':_0x4be09e['shopId'],'event':_0xb25dfd(0x24a)+_0x4aea78[_0xb25dfd(0x220)][_0xb25dfd(0x222)](),'statusCode':0xc8,'responseBody':JSON[_0xb25dfd(0x1b8)]({'oldStatus':_0x4be09e['status'],'newStatus':_0x4aea78[_0xb25dfd(0x220)],'paymentDetails':_0x4aea78[_0xb25dfd(0x195)],'checkedAt':new Date()[_0xb25dfd(0x25b)]()})}}),await this[_0xb25dfd(0x215)](_0x4be09e,_0x4aea78[_0xb25dfd(0x220)]),await this[_0xb25dfd(0x22a)](_0x4be09e,_0x4aea78[_0xb25dfd(0x220)]),_0x4aea78['status']!==_0xb25dfd(0x1fd)&&(console[_0xb25dfd(0x16c)]('üßπ\x20[CHECK]\x20Payment\x20'+_0x4be09e['id']+_0xb25dfd(0x22e)+_0x4aea78[_0xb25dfd(0x220)]+',\x20clearing\x20individual\x20timers'),this[_0xb25dfd(0x256)](_0x4be09e['id'])),console['log']('‚úÖ\x20[CHECK]\x20Payment\x20'+_0x4be09e['id']+'\x20updated\x20successfully');}else console[_0xb25dfd(0x16c)]('üìä\x20[CHECK]\x20Payment\x20'+_0x4be09e['id']+'\x20status\x20unchanged\x20('+_0x4aea78[_0xb25dfd(0x220)]+')'),this[_0xb25dfd(0x21a)](_0x4be09e['id'],_0x4be09e[_0xb25dfd(0x1da)],_0x4be09e[_0xb25dfd(0x220)],_0x4aea78[_0xb25dfd(0x220)],_0xb25dfd(0x175),{'statusUnchanged':!![],'paymentDetails':_0x4aea78['paymentDetails'],'amount':_0x4aea78[_0xb25dfd(0x239)],'currency':_0x4aea78[_0xb25dfd(0x1b7)],'shopId':_0x4be09e['shopId'],'checkTimestamp':new Date()['toISOString']()});}catch(_0x477881){console[_0xb25dfd(0x1db)](_0xb25dfd(0x164)+_0x4be09e['id']+':',_0x477881),this['logCoinToPayError'](_0x4be09e['id'],_0x4be09e[_0xb25dfd(0x1da)],_0x477881,_0xb25dfd(0x175),{'paymentAmount':_0x4be09e[_0xb25dfd(0x239)],'paymentCurrency':_0x4be09e[_0xb25dfd(0x1b7)],'shopId':_0x4be09e[_0xb25dfd(0x19b)],'createdAt':_0x4be09e[_0xb25dfd(0x1d8)]}),await database_1[_0xb25dfd(0x205)][_0xb25dfd(0x166)][_0xb25dfd(0x181)]({'data':{'paymentId':_0x4be09e['id'],'shopId':_0x4be09e[_0xb25dfd(0x19b)],'event':_0xb25dfd(0x163),'statusCode':0x1f4,'responseBody':JSON[_0xb25dfd(0x1b8)]({'error':_0x477881 instanceof Error?_0x477881[_0xb25dfd(0x1ba)]:_0xb25dfd(0x1dd),'gatewayPaymentId':_0x4be09e[_0xb25dfd(0x1da)],'checkedAt':new Date()[_0xb25dfd(0x25b)]()})}});}}async[a52_0x561cd8(0x215)](_0xa5ca3b,_0x59308f){const _0x53af64=a52_0x561cd8,_0x18d089=Date[_0x53af64(0x20b)]();try{const _0x2bf63e=_0xa5ca3b['shop'],_0x260522=_0x2bf63e[_0x53af64(0x216)];if(!_0x260522?.[_0x53af64(0x207)]){console[_0x53af64(0x16c)]('No\x20webhook\x20URL\x20configured\x20for\x20shop\x20'+_0x2bf63e['id']);return;}const _0x173b95=_0x59308f==='PAID'?'payment.success':_0x59308f===_0x53af64(0x1f2)?_0x53af64(0x255):_0x59308f===_0x53af64(0x213)?_0x53af64(0x255):_0x53af64(0x1d0);if(!_0x260522[_0x53af64(0x1e4)]?.[_0x53af64(0x1ec)](_0x173b95)){console[_0x53af64(0x16c)](_0x53af64(0x237)+_0x173b95+_0x53af64(0x1df)+_0x2bf63e['id']);return;}const _0x7ea6b0=(0x0,gateway_1[_0x53af64(0x1c4)])(_0xa5ca3b['gateway'])||_0xa5ca3b[_0x53af64(0x202)],_0x117b68={'event':_0x173b95,'payment':{'id':_0xa5ca3b['id'],'order_id':_0xa5ca3b[_0x53af64(0x22f)],'gateway_order_id':_0xa5ca3b[_0x53af64(0x1d7)],'gateway':_0x7ea6b0,'amount':_0xa5ca3b[_0x53af64(0x239)],'currency':_0xa5ca3b[_0x53af64(0x1b7)],'status':_0x59308f[_0x53af64(0x222)](),'customer_email':_0xa5ca3b['customerEmail'],'customer_name':_0xa5ca3b['customerName'],'created_at':_0xa5ca3b[_0x53af64(0x1d8)],'updated_at':new Date()}},_0x451389=await fetch(_0x260522[_0x53af64(0x207)],{'method':_0x53af64(0x199),'headers':{'Content-Type':'application/json','User-Agent':_0x53af64(0x17f)},'body':JSON['stringify'](_0x117b68)}),_0x13e7d3=Date['now']()-_0x18d089,_0x159b27=_0x451389['ok']?_0x53af64(0x1c3):await _0x451389[_0x53af64(0x1f9)]();loggerService_1[_0x53af64(0x24e)]['logShopWebhookSent'](_0xa5ca3b['shopId'],_0x260522['webhookUrl'],_0x173b95,_0x451389['status'],_0x13e7d3,_0x117b68),console[_0x53af64(0x16c)](_0x53af64(0x182)+_0x260522[_0x53af64(0x207)]+'\x20with\x20status\x20'+_0x451389[_0x53af64(0x220)]+'\x20('+_0x13e7d3+_0x53af64(0x1be));}catch(_0x3bc3ef){console[_0x53af64(0x1db)]('Failed\x20to\x20send\x20shop\x20webhook:',_0x3bc3ef),loggerService_1[_0x53af64(0x24e)][_0x53af64(0x22b)](_0xa5ca3b[_0x53af64(0x19b)],_0xa5ca3b['shop']?.[_0x53af64(0x216)]?.[_0x53af64(0x207)]||_0x53af64(0x1c1),_0x53af64(0x24f),_0x3bc3ef,{});}}async[a52_0x561cd8(0x22a)](_0x1dfb37,_0x25f880){const _0x555e2d=a52_0x561cd8;try{const _0x4f7e12={'PENDING':_0x555e2d(0x23e),'PAID':_0x555e2d(0x23c),'FAILED':_0x555e2d(0x200),'EXPIRED':_0x555e2d(0x1ca)},_0x558f26=_0x4f7e12[_0x25f880];if(!_0x558f26||_0x558f26===_0x555e2d(0x23e))return;await telegramBotService_1[_0x555e2d(0x241)][_0x555e2d(0x16f)](_0x1dfb37[_0x555e2d(0x19b)],_0x1dfb37,_0x558f26);}catch(_0x5a28da){console[_0x555e2d(0x1db)]('Failed\x20to\x20send\x20Telegram\x20payment\x20notification:',_0x5a28da);}}async[a52_0x561cd8(0x1b1)](_0x46c085){const _0x2d1cfd=a52_0x561cd8;console[_0x2d1cfd(0x16c)](_0x2d1cfd(0x1ff)+_0x46c085);const _0x597098=await database_1[_0x2d1cfd(0x205)][_0x2d1cfd(0x1eb)][_0x2d1cfd(0x1bb)]({'where':{'id':_0x46c085},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x597098)throw new Error('Payment\x20not\x20found');if(_0x597098['gateway']!=='cointopay'&&_0x597098['gateway']!==_0x2d1cfd(0x174))throw new Error('Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment');console[_0x2d1cfd(0x16c)]('‚úÖ\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20'+_0x597098[_0x2d1cfd(0x202)]+_0x2d1cfd(0x18c)+_0x46c085),await this[_0x2d1cfd(0x223)](_0x597098),console[_0x2d1cfd(0x16c)](_0x2d1cfd(0x1a6)+_0x46c085);}['getServiceStats'](){const _0x13c82d=a52_0x561cd8,_0x26d42d=this[_0x13c82d(0x1bf)]?this[_0x13c82d(0x156)]:undefined,_0x2d512c=Array[_0x13c82d(0x218)](this[_0x13c82d(0x167)][_0x13c82d(0x1c8)]())[_0x13c82d(0x1ce)](_0x2bf8d7=>({'paymentId':_0x2bf8d7[_0x13c82d(0x1e6)],'gatewayPaymentId':_0x2bf8d7[_0x13c82d(0x1da)],'createdAt':_0x2bf8d7[_0x13c82d(0x1d8)],'timersCount':_0x2bf8d7[_0x13c82d(0x246)]['length']}));return{'isActive':!!this[_0x13c82d(0x1bf)],'globalCheckIntervalMinutes':this['GLOBAL_CHECK_INTERVAL_MS']/(0x3e8*0x3c),'expiryDays':this['EXPIRY_DAYS'],'activeIndividualTimers':this[_0x13c82d(0x167)][_0x13c82d(0x21e)],'nextGlobalCheckIn':_0x26d42d,'paymentTimersDetails':_0x2d512c};}['getPaymentTimerInfo'](_0x162cd9){const _0x1606ca=a52_0x561cd8,_0x2d98e1=this[_0x1606ca(0x167)]['get'](_0x162cd9);if(_0x2d98e1)return{'hasTimers':!![],'timersCount':_0x2d98e1[_0x1606ca(0x246)][_0x1606ca(0x17b)],'createdAt':_0x2d98e1[_0x1606ca(0x1d8)],'gatewayPaymentId':_0x2d98e1['gatewayPaymentId']};return{'hasTimers':![]};}async[a52_0x561cd8(0x1cc)](_0x4a0deb,_0x4fc5a4){const _0x51d027=a52_0x561cd8;try{const _0x2e2f54=await database_1[_0x51d027(0x205)][_0x51d027(0x23f)][_0x51d027(0x1bb)]({'where':{'id':_0x4a0deb},'select':{'gatewaySettings':!![]}});if(!_0x2e2f54?.['gatewaySettings'])return console['log'](_0x51d027(0x15a)+_0x4a0deb+_0x51d027(0x1ae)),0xa;const _0x83ad1=JSON[_0x51d027(0x194)](_0x2e2f54[_0x51d027(0x252)]);for(const [_0x206f53,_0x10ff9d]of Object['entries'](_0x83ad1)){if(_0x206f53[_0x51d027(0x222)]()===_0x4fc5a4['toLowerCase']()){const _0xd2d96e=_0x10ff9d['commission']||0xa;return console['log'](_0x51d027(0x15b)+_0x4fc5a4+_0x51d027(0x1d1)+_0x4a0deb+':\x20'+_0xd2d96e+'%'),_0xd2d96e;}}return console[_0x51d027(0x16c)]('No\x20specific\x20commission\x20found\x20for\x20gateway\x20'+_0x4fc5a4+_0x51d027(0x201)+_0x4a0deb+',\x20using\x20default\x2010%'),0xa;}catch(_0x544b97){return console[_0x51d027(0x1db)](_0x51d027(0x250)+_0x4a0deb+_0x51d027(0x191)+_0x4fc5a4+':',_0x544b97),0xa;}}}exports[a52_0x561cd8(0x159)]=CoinToPayStatusService,exports[a52_0x561cd8(0x197)]=new CoinToPayStatusService();