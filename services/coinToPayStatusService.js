'use strict';const a38_0x81c47f=a38_0x4ca5;(function(_0x1aa54e,_0x443fe4){const _0xfbfec3=a38_0x4ca5,_0x3258a1=_0x1aa54e();while(!![]){try{const _0x24c5f1=parseInt(_0xfbfec3(0xc6))/0x1+parseInt(_0xfbfec3(0x12f))/0x2*(-parseInt(_0xfbfec3(0xf2))/0x3)+-parseInt(_0xfbfec3(0x12c))/0x4*(parseInt(_0xfbfec3(0x103))/0x5)+parseInt(_0xfbfec3(0x158))/0x6*(-parseInt(_0xfbfec3(0x19a))/0x7)+parseInt(_0xfbfec3(0xbc))/0x8+parseInt(_0xfbfec3(0xc9))/0x9*(parseInt(_0xfbfec3(0x111))/0xa)+-parseInt(_0xfbfec3(0xa1))/0xb*(-parseInt(_0xfbfec3(0x10f))/0xc);if(_0x24c5f1===_0x443fe4)break;else _0x3258a1['push'](_0x3258a1['shift']());}catch(_0x2534a7){_0x3258a1['push'](_0x3258a1['shift']());}}}(a38_0xe79b,0x8a238));var __importDefault=this&&this[a38_0x81c47f(0x16b)]||function(_0x20070d){const _0x3bf817=a38_0x81c47f;return _0x20070d&&_0x20070d[_0x3bf817(0x168)]?_0x20070d:{'default':_0x20070d};};Object[a38_0x81c47f(0x165)](exports,a38_0x81c47f(0x168),{'value':!![]}),exports['coinToPayStatusService']=exports[a38_0x81c47f(0xed)]=void 0x0;function a38_0x4ca5(_0x12dd30,_0x7fdd15){const _0xe79bd9=a38_0xe79b();return a38_0x4ca5=function(_0x4ca5f8,_0x489e85){_0x4ca5f8=_0x4ca5f8-0x99;let _0x4ca46e=_0xe79bd9[_0x4ca5f8];return _0x4ca46e;},a38_0x4ca5(_0x12dd30,_0x7fdd15);}const coinToPayService_1=require(a38_0x81c47f(0x126)),coinToPay2Service_1=require('./gateways/coinToPay2Service'),gateway_1=require('../types/gateway'),database_1=__importDefault(require(a38_0x81c47f(0x182))),telegramBotService_1=require(a38_0x81c47f(0x161)),loggerService_1=require(a38_0x81c47f(0xdf)),currencyService_1=require(a38_0x81c47f(0x120));class CoinToPayStatusService{constructor(){const _0x433aa2=a38_0x81c47f;this['globalCheckInterval']=null,this[_0x433aa2(0x14d)]=0x3c*0x3c*0x3e8,this[_0x433aa2(0x180)]=0x5,this[_0x433aa2(0xd4)]=new Map(),this[_0x433aa2(0xb5)]=new coinToPayService_1[(_0x433aa2(0x19e))](),this[_0x433aa2(0x171)]=new coinToPay2Service_1[(_0x433aa2(0x135))](),console[_0x433aa2(0x191)]('ü™ô\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2');}[a38_0x81c47f(0xc0)](_0x69b8a1,_0x15c300){const _0x1181ab=a38_0x81c47f;console['log'](_0x1181ab(0x138)),console['log']('\x20\x20\x20-\x20paymentId:\x20'+_0x69b8a1),console[_0x1181ab(0x191)]('\x20\x20\x20-\x20gatewayPaymentId:\x20'+_0x15c300),this['clearPaymentTimers'](_0x69b8a1);const _0x4f6e43=[],_0x3fd04a=new Date(),_0xe0f098=[{'delay':0x1*0x3c*0x3e8,'description':'1\x20minute'},{'delay':0x2*0x3c*0x3e8,'description':_0x1181ab(0x133)},{'delay':0x5*0x3c*0x3e8,'description':_0x1181ab(0xa9)},{'delay':0x5*0x3c*0x3e8,'description':_0x1181ab(0xa9)}];console['log'](_0x1181ab(0xd9)+_0xe0f098[_0x1181ab(0x9a)]+'\x20initial\x20timers\x20for\x20payment\x20'+_0x69b8a1);let _0x1c5bf2=0x0;_0xe0f098[_0x1181ab(0xc1)]((_0x298605,_0x1320c4)=>{const _0xb6fc10=_0x1181ab;_0x1c5bf2+=_0x298605[_0xb6fc10(0x141)];const _0x17a141=setTimeout(async()=>{const _0xb765f4=_0xb6fc10;console[_0xb765f4(0x191)](_0xb765f4(0x144)+(_0x1320c4+0x1)+_0xb765f4(0x14b)+_0x69b8a1+_0xb765f4(0xc3)+_0x298605[_0xb765f4(0x186)]+')');try{await this[_0xb765f4(0x1a2)](_0x69b8a1),console[_0xb765f4(0x191)](_0xb765f4(0xd2)+(_0x1320c4+0x1)+'\x20completed\x20for\x20payment\x20'+_0x69b8a1);}catch(_0x292787){console[_0xb765f4(0x134)](_0xb765f4(0xec)+(_0x1320c4+0x1)+_0xb765f4(0x198)+_0x69b8a1+':',_0x292787),this[_0xb765f4(0x187)](_0x69b8a1,_0x15c300,_0x292787,_0xb765f4(0xf3),{'checkNumber':_0x1320c4+0x1,'scheduledAfter':_0x298605['description'],'isIndividualCheck':!![]});}},_0x1c5bf2);_0x4f6e43['push'](_0x17a141),console[_0xb6fc10(0x191)]('‚è∞\x20[DEBUG]\x20Scheduled\x20check\x20#'+(_0x1320c4+0x1)+'\x20for\x20payment\x20'+_0x69b8a1+_0xb6fc10(0x121)+_0x1c5bf2/0x3e8+_0xb6fc10(0x177)+_0x298605[_0xb6fc10(0x186)]+')');});const _0x33d804=setInterval(async()=>{const _0x4c1a06=_0x1181ab;console[_0x4c1a06(0x191)]('ü™ô\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20'+_0x69b8a1);try{const _0x191ecd=await database_1[_0x4c1a06(0x116)][_0x4c1a06(0xb3)][_0x4c1a06(0xef)]({'where':{'id':_0x69b8a1},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x191ecd){console[_0x4c1a06(0x191)](_0x4c1a06(0x15c)+_0x69b8a1+_0x4c1a06(0xb7)),this['clearPaymentTimers'](_0x69b8a1);return;}console[_0x4c1a06(0x191)](_0x4c1a06(0x199)+_0x69b8a1+'\x20current\x20status:\x20'+_0x191ecd[_0x4c1a06(0x19f)]);if(_0x191ecd[_0x4c1a06(0x19f)]!==_0x4c1a06(0x110)){console['log'](_0x4c1a06(0x155)+_0x69b8a1+_0x4c1a06(0x152)+_0x191ecd[_0x4c1a06(0x19f)]+_0x4c1a06(0x107)),this[_0x4c1a06(0x175)](_0x69b8a1);return;}const _0x21dd6d=Math[_0x4c1a06(0x147)]((Date[_0x4c1a06(0x12d)]()-_0x191ecd[_0x4c1a06(0xb4)][_0x4c1a06(0xd1)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x21dd6d>=this[_0x4c1a06(0x180)]){console[_0x4c1a06(0x191)](_0x4c1a06(0x125)+_0x69b8a1+_0x4c1a06(0xd0)+this[_0x4c1a06(0x180)]+_0x4c1a06(0x172)),this[_0x4c1a06(0x175)](_0x69b8a1);return;}await this[_0x4c1a06(0x1a2)](_0x69b8a1),console[_0x4c1a06(0x191)](_0x4c1a06(0x190)+_0x69b8a1);}catch(_0x438839){console[_0x4c1a06(0x134)](_0x4c1a06(0x114)+_0x69b8a1+':',_0x438839),this[_0x4c1a06(0x187)](_0x69b8a1,_0x15c300,_0x438839,_0x4c1a06(0xf3),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x4f6e43[_0x1181ab(0x146)](_0x33d804),this[_0x1181ab(0xd4)][_0x1181ab(0xae)](_0x69b8a1,{'timers':_0x4f6e43,'paymentId':_0x69b8a1,'gatewayPaymentId':_0x15c300,'createdAt':_0x3fd04a}),console[_0x1181ab(0x191)]('‚úÖ\x20[DEBUG]\x20Successfully\x20scheduled\x20'+_0xe0f098[_0x1181ab(0x9a)]+_0x1181ab(0x129)+_0x69b8a1),console[_0x1181ab(0x191)](_0x1181ab(0x148)+this[_0x1181ab(0xd4)][_0x1181ab(0x181)]),this['logCoinToPayStatus'](_0x69b8a1,_0x15c300,_0x1181ab(0x110),_0x1181ab(0x110),_0x1181ab(0xf3),{'action':_0x1181ab(0xd6),'scheduledChecks':_0xe0f098[_0x1181ab(0x9a)],'firstCheckIn':_0xe0f098[0x0]['delay']/0x3e8,'totalTimers':this[_0x1181ab(0xd4)][_0x1181ab(0x181)]});}[a38_0x81c47f(0x175)](_0x25aa53){const _0x5cea09=a38_0x81c47f,_0x122629=this[_0x5cea09(0xd4)]['get'](_0x25aa53);_0x122629?(console[_0x5cea09(0x191)](_0x5cea09(0x142)+_0x122629['timers'][_0x5cea09(0x9a)]+_0x5cea09(0x16a)+_0x25aa53),_0x122629[_0x5cea09(0x10a)][_0x5cea09(0xc1)]((_0x388d65,_0x299e93)=>{const _0x171098=_0x5cea09;_0x388d65&&(clearTimeout(_0x388d65),clearInterval(_0x388d65),console[_0x171098(0x191)](_0x171098(0x13c)+(_0x299e93+0x1)+_0x171098(0x198)+_0x25aa53));}),this[_0x5cea09(0xd4)][_0x5cea09(0xe1)](_0x25aa53),console[_0x5cea09(0x191)]('‚úÖ\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20'+_0x25aa53+_0x5cea09(0x11f)+this[_0x5cea09(0xd4)][_0x5cea09(0x181)])):console[_0x5cea09(0x191)]('‚ö†Ô∏è\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20'+_0x25aa53+_0x5cea09(0xca));}async[a38_0x81c47f(0x1a2)](_0x18f0ea){const _0x56846d=a38_0x81c47f;console[_0x56846d(0x191)](_0x56846d(0x104)+_0x18f0ea);const _0x1e1220=await database_1[_0x56846d(0x116)][_0x56846d(0xb3)]['findUnique']({'where':{'id':_0x18f0ea},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x1e1220){console[_0x56846d(0x191)]('‚ùå\x20[CHECK]\x20Payment\x20'+_0x18f0ea+_0x56846d(0xa0));return;}console['log']('üìä\x20[CHECK]\x20Payment\x20'+_0x18f0ea+_0x56846d(0xba)),console[_0x56846d(0x191)](_0x56846d(0x1a6)+_0x1e1220[_0x56846d(0x9f)]),console[_0x56846d(0x191)](_0x56846d(0x188)+_0x1e1220[_0x56846d(0x19f)]),console[_0x56846d(0x191)](_0x56846d(0xa6)+_0x1e1220[_0x56846d(0x164)]),console[_0x56846d(0x191)]('\x20\x20\x20-\x20Amount:\x20'+_0x1e1220[_0x56846d(0x16c)]+'\x20'+_0x1e1220[_0x56846d(0x185)]),console[_0x56846d(0x191)](_0x56846d(0x1aa)+_0x1e1220[_0x56846d(0x17e)]);if(_0x1e1220[_0x56846d(0x9f)]!==_0x56846d(0xf4)&&_0x1e1220[_0x56846d(0x9f)]!==_0x56846d(0x197)){console[_0x56846d(0x191)](_0x56846d(0xcf)+_0x18f0ea+_0x56846d(0xfe)+_0x1e1220[_0x56846d(0x9f)]+')');return;}if(_0x1e1220[_0x56846d(0x19f)]!=='PENDING'){console[_0x56846d(0x191)](_0x56846d(0xcf)+_0x18f0ea+_0x56846d(0x152)+_0x1e1220[_0x56846d(0x19f)]+',\x20stopping\x20individual\x20checks'),this[_0x56846d(0x175)](_0x18f0ea);return;}if(!_0x1e1220['gatewayPaymentId']){console[_0x56846d(0x191)]('‚ö†Ô∏è\x20[CHECK]\x20Payment\x20'+_0x18f0ea+'\x20has\x20no\x20gatewayPaymentId');return;}console[_0x56846d(0x191)]('‚úÖ\x20[CHECK]\x20Payment\x20'+_0x18f0ea+_0x56846d(0xb2)),await this[_0x56846d(0x162)](_0x1e1220);}[a38_0x81c47f(0x123)](_0x1b519d,_0x3d81f8,_0x5e102f,_0x197443,_0x1b6988,_0x21856e){const _0x484eb4=a38_0x81c47f,_0x3b3d13={'type':_0x484eb4(0x1a7),'paymentId':_0x1b519d,'gatewayPaymentId':_0x3d81f8,'oldStatus':_0x5e102f,'newStatus':_0x197443,'source':_0x1b6988,'timestamp':new Date()[_0x484eb4(0x17c)](),'details':_0x21856e||{}};loggerService_1[_0x484eb4(0xea)]['logCoinToPayStatus'](_0x3b3d13),console[_0x484eb4(0x191)](_0x484eb4(0x14a)+_0x1b519d+'\x20('+_0x3d81f8+')'),console[_0x484eb4(0x191)]('\x20\x20\x20üìä\x20Status:\x20'+_0x5e102f+_0x484eb4(0xe5)+_0x197443),console[_0x484eb4(0x191)](_0x484eb4(0xc7)+_0x1b6988),console[_0x484eb4(0x191)](_0x484eb4(0x159)+_0x3b3d13['timestamp']),_0x21856e&&console['log'](_0x484eb4(0x169),_0x21856e);}['logCoinToPayError'](_0x1e5c18,_0x13bc67,_0xb6039b,_0x863ea4,_0x30fcc7){const _0x76fac7=a38_0x81c47f,_0x2218be={'type':_0x76fac7(0xce),'paymentId':_0x1e5c18,'gatewayPaymentId':_0x13bc67,'error':_0xb6039b instanceof Error?{'message':_0xb6039b[_0x76fac7(0xfd)],'stack':_0xb6039b['stack']}:_0xb6039b,'source':_0x863ea4,'timestamp':new Date()['toISOString'](),'context':_0x30fcc7||{}};loggerService_1[_0x76fac7(0xea)]['logCoinToPayError'](_0x2218be),console[_0x76fac7(0x134)](_0x76fac7(0xff)+_0x1e5c18+'\x20('+_0x13bc67+')'),console[_0x76fac7(0x134)]('\x20\x20\x20‚ùå\x20Error:\x20'+(_0xb6039b instanceof Error?_0xb6039b[_0x76fac7(0xfd)]:_0xb6039b)),console[_0x76fac7(0x134)](_0x76fac7(0xc7)+_0x863ea4),console[_0x76fac7(0x134)]('\x20\x20\x20üìÖ\x20Time:\x20'+_0x2218be[_0x76fac7(0x174)]),_0x30fcc7&&console[_0x76fac7(0x134)](_0x76fac7(0x9d),_0x30fcc7);}['startPeriodicStatusCheck'](){const _0x20ecbd=a38_0x81c47f;console[_0x20ecbd(0x191)](_0x20ecbd(0xa8)),this[_0x20ecbd(0x166)]()['catch'](_0x194f5d=>{const _0x308532=_0x20ecbd;console[_0x308532(0x134)]('‚ùå\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:',_0x194f5d);}),this['globalCheckInterval']=setInterval(async()=>{const _0xf631f3=_0x20ecbd;try{console[_0xf631f3(0x191)]('ü™ô\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...'),await this[_0xf631f3(0x166)](),console['log'](_0xf631f3(0x10c));}catch(_0x389d78){console[_0xf631f3(0x134)](_0xf631f3(0x128),_0x389d78);}},this[_0x20ecbd(0x14d)]),console[_0x20ecbd(0x191)]('‚úÖ\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)');}[a38_0x81c47f(0x183)](){const _0x3a242f=a38_0x81c47f;console[_0x3a242f(0x191)](_0x3a242f(0x1a0));this[_0x3a242f(0x15f)]&&(clearInterval(this[_0x3a242f(0x15f)]),this[_0x3a242f(0x15f)]=null,console[_0x3a242f(0x191)](_0x3a242f(0x106)));const _0x4dd0a3=this[_0x3a242f(0xd4)][_0x3a242f(0x181)];for(const [_0x4e4f5e]of this['paymentTimers']){this['clearPaymentTimers'](_0x4e4f5e);}console[_0x3a242f(0x191)](_0x3a242f(0x153)+_0x4dd0a3+'\x20individual\x20payment\x20timers');}async[a38_0x81c47f(0x166)](){const _0x4360c2=a38_0x81c47f;try{console['log'](_0x4360c2(0xdb));const _0x3b7bb9=await database_1[_0x4360c2(0x116)][_0x4360c2(0xb3)][_0x4360c2(0x156)]({'where':{'gateway':{'in':[_0x4360c2(0xf4),_0x4360c2(0x197)]},'status':_0x4360c2(0x110),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x4360c2(0x191)](_0x4360c2(0x176)+_0x3b7bb9[_0x4360c2(0x9a)]+_0x4360c2(0x149));if(_0x3b7bb9[_0x4360c2(0x9a)]===0x0){console['log'](_0x4360c2(0xad));return;}const _0x1fb011=await this[_0x4360c2(0x150)](_0x3b7bb9);console[_0x4360c2(0x191)](_0x4360c2(0x170)+_0x1fb011[_0x4360c2(0x9a)]+_0x4360c2(0x18a));let _0x1ee1cc=0x0,_0x507e4e=0x0;for(const _0x26a19d of _0x3b7bb9){try{if(_0x1fb011[_0x4360c2(0x196)](_0x26a19d['id'])){console[_0x4360c2(0x191)]('‚è∞\x20[GLOBAL]\x20Payment\x20'+_0x26a19d['id']+_0x4360c2(0x99)),_0x507e4e++;continue;}if(this['paymentTimers'][_0x4360c2(0x132)](_0x26a19d['id'])){console[_0x4360c2(0x191)](_0x4360c2(0x140)+_0x26a19d['id']+_0x4360c2(0xcd)),_0x507e4e++;continue;}const _0x113639=(Date[_0x4360c2(0x12d)]()-_0x26a19d[_0x4360c2(0xb4)][_0x4360c2(0xd1)]())/(0x3e8*0x3c*0x3c);if(_0x113639<0x1){console[_0x4360c2(0x191)](_0x4360c2(0x140)+_0x26a19d['id']+_0x4360c2(0x18b)+_0x113639['toFixed'](0x1)+'h),\x20skipping\x20global\x20check'),_0x507e4e++;continue;}console[_0x4360c2(0x191)](_0x4360c2(0xe8)+_0x26a19d['id']+'\x20(age:\x20'+_0x113639[_0x4360c2(0xbb)](0x1)+'h)'),await this[_0x4360c2(0x162)](_0x26a19d),_0x1ee1cc++,await new Promise(_0x132d0c=>setTimeout(_0x132d0c,0x7d0));}catch(_0x418e4e){console['error'](_0x4360c2(0xfa)+_0x26a19d['id']+':',_0x418e4e),this[_0x4360c2(0x187)](_0x26a19d['id'],_0x26a19d[_0x4360c2(0x164)]||_0x4360c2(0x178),_0x418e4e,_0x4360c2(0xf3),{'isGlobalCheck':!![],'paymentAmount':_0x26a19d[_0x4360c2(0x16c)],'paymentCurrency':_0x26a19d[_0x4360c2(0x185)],'shopId':_0x26a19d[_0x4360c2(0x17e)],'createdAt':_0x26a19d['createdAt']}),loggerService_1['loggerService'][_0x4360c2(0x13d)](_0x4360c2(0xf4),_0x4360c2(0x13b)+_0x26a19d[_0x4360c2(0x164)],_0x418e4e);}}console['log'](_0x4360c2(0x173)+_0x1ee1cc+'\x20checked,\x20'+_0x507e4e+_0x4360c2(0x15b)+_0x1fb011[_0x4360c2(0x9a)]+_0x4360c2(0xb6));}catch(_0x2a9a78){console[_0x4360c2(0x134)](_0x4360c2(0x118),_0x2a9a78);}}async[a38_0x81c47f(0x150)](_0x1abffd){const _0x586ec4=a38_0x81c47f,_0x1a7654=[],_0x1d9eff=new Date();_0x1d9eff[_0x586ec4(0x10b)](_0x1d9eff[_0x586ec4(0xd3)]()-this['EXPIRY_DAYS']),console[_0x586ec4(0x191)]('‚è∞\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20'+this[_0x586ec4(0x180)]+'\x20days\x20(created\x20before\x20'+_0x1d9eff[_0x586ec4(0x17c)]()+')');for(const _0x2f2649 of _0x1abffd){if(_0x2f2649[_0x586ec4(0xb4)]<_0x1d9eff){console[_0x586ec4(0x191)](_0x586ec4(0x10d)+_0x2f2649['id']+_0x586ec4(0xd0)+this[_0x586ec4(0x180)]+_0x586ec4(0xa7));try{this[_0x586ec4(0x123)](_0x2f2649['id'],_0x2f2649['gatewayPaymentId']||_0x586ec4(0x178),_0x586ec4(0x110),_0x586ec4(0x117),_0x586ec4(0xc5),{'reason':_0x586ec4(0x9b)+this[_0x586ec4(0x180)]+_0x586ec4(0xd8),'createdAt':_0x2f2649[_0x586ec4(0xb4)],'daysSinceCreation':Math[_0x586ec4(0x147)]((Date[_0x586ec4(0x12d)]()-_0x2f2649[_0x586ec4(0xb4)][_0x586ec4(0xd1)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x2f2649[_0x586ec4(0x16c)],'paymentCurrency':_0x2f2649[_0x586ec4(0x185)],'shopId':_0x2f2649[_0x586ec4(0x17e)]}),await database_1[_0x586ec4(0x116)]['payment'][_0x586ec4(0xbe)]({'where':{'id':_0x2f2649['id']},'data':{'status':'EXPIRED','updatedAt':new Date(),'adminNotes':'Automatically\x20expired\x20after\x20'+this['EXPIRY_DAYS']+_0x586ec4(0x119)}}),await database_1[_0x586ec4(0x116)][_0x586ec4(0x13e)]['create']({'data':{'paymentId':_0x2f2649['id'],'shopId':_0x2f2649[_0x586ec4(0x17e)],'event':_0x586ec4(0x12b),'statusCode':0xc8,'responseBody':JSON[_0x586ec4(0xf1)]({'reason':_0x586ec4(0x9b)+this[_0x586ec4(0x180)]+_0x586ec4(0xd8),'createdAt':_0x2f2649[_0x586ec4(0xb4)],'expiredAt':new Date()['toISOString'](),'daysSinceCreation':Math[_0x586ec4(0x147)]((Date[_0x586ec4(0x12d)]()-_0x2f2649[_0x586ec4(0xb4)][_0x586ec4(0xd1)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this['sendShopWebhook'](_0x2f2649,_0x586ec4(0x117)),await this['sendPaymentStatusNotification'](_0x2f2649,'EXPIRED'),this[_0x586ec4(0x175)](_0x2f2649['id']),_0x1a7654[_0x586ec4(0x146)](_0x2f2649['id']),console[_0x586ec4(0x191)]('‚úÖ\x20[EXPIRY]\x20Payment\x20'+_0x2f2649['id']+_0x586ec4(0xf7)+this[_0x586ec4(0x180)]+'-day\x20timeout');}catch(_0x30b50d){console[_0x586ec4(0x134)](_0x586ec4(0xb1)+_0x2f2649['id']+':',_0x30b50d),this[_0x586ec4(0x187)](_0x2f2649['id'],_0x2f2649[_0x586ec4(0x164)]||_0x586ec4(0x178),_0x30b50d,'auto_expire',{'reason':_0x586ec4(0xe4),'createdAt':_0x2f2649[_0x586ec4(0xb4)],'daysSinceCreation':Math[_0x586ec4(0x147)]((Date[_0x586ec4(0x12d)]()-_0x2f2649[_0x586ec4(0xb4)][_0x586ec4(0xd1)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x1a7654;}async['checkSinglePayment'](_0x2fa3b1){const _0x4c6924=a38_0x81c47f;if(!_0x2fa3b1['gatewayPaymentId']){console[_0x4c6924(0x191)](_0x4c6924(0xcf)+_0x2fa3b1['id']+_0x4c6924(0x16e));return;}console[_0x4c6924(0x191)](_0x4c6924(0x14f)+_0x2fa3b1['gateway']+_0x4c6924(0x14e)+_0x2fa3b1['id']+'\x20('+_0x2fa3b1['gatewayPaymentId']+')');try{let _0x4a0bcc;_0x2fa3b1['gateway']===_0x4c6924(0x197)?(_0x4a0bcc=await this[_0x4c6924(0x171)][_0x4c6924(0x19d)](_0x2fa3b1[_0x4c6924(0x164)]),console['log'](_0x4c6924(0x154)+_0x2fa3b1['id']+_0x4c6924(0xfb)+_0x4a0bcc[_0x4c6924(0x19f)])):(_0x4a0bcc=await this[_0x4c6924(0xb5)]['checkPaymentStatus'](_0x2fa3b1[_0x4c6924(0x164)]),console[_0x4c6924(0x191)](_0x4c6924(0x195)+_0x2fa3b1['id']+_0x4c6924(0xfb)+_0x4a0bcc[_0x4c6924(0x19f)]));_0x4a0bcc[_0x4c6924(0xdd)]&&console['log'](_0x4c6924(0x16d)+_0x2fa3b1['id']+_0x4c6924(0x136),{'iban':_0x4a0bcc[_0x4c6924(0xdd)][_0x4c6924(0x9c)]||_0x4c6924(0xbf),'transactionId':_0x4a0bcc[_0x4c6924(0xdd)][_0x4c6924(0x11a)],'createdOn':_0x4a0bcc[_0x4c6924(0xdd)][_0x4c6924(0x194)],'confirmedOn':_0x4a0bcc[_0x4c6924(0xdd)][_0x4c6924(0x16f)]||_0x4c6924(0x137)});if(_0x4a0bcc[_0x4c6924(0x19f)]!==_0x2fa3b1[_0x4c6924(0x19f)]){console['log'](_0x4c6924(0x145)+_0x2fa3b1['id']+_0x4c6924(0x12a)+_0x2fa3b1[_0x4c6924(0x19f)]+'\x20to\x20'+_0x4a0bcc['status']),this[_0x4c6924(0x123)](_0x2fa3b1['id'],_0x2fa3b1[_0x4c6924(0x164)],_0x2fa3b1[_0x4c6924(0x19f)],_0x4a0bcc[_0x4c6924(0x19f)],_0x4c6924(0xf3),{'paymentDetails':_0x4a0bcc[_0x4c6924(0xdd)],'amount':_0x4a0bcc[_0x4c6924(0x16c)],'currency':_0x4a0bcc[_0x4c6924(0x185)],'shopId':_0x2fa3b1[_0x4c6924(0x17e)],'checkTimestamp':new Date()[_0x4c6924(0x17c)]()});const _0x11baeb={'status':_0x4a0bcc[_0x4c6924(0x19f)],'updatedAt':new Date()};if(_0x4a0bcc[_0x4c6924(0x19f)]===_0x4c6924(0xf8)&&_0x2fa3b1[_0x4c6924(0x19f)]!==_0x4c6924(0xf8)){_0x11baeb[_0x4c6924(0x18c)]=new Date();if(!_0x2fa3b1[_0x4c6924(0x1a4)]){const _0x32ba31=await currencyService_1[_0x4c6924(0x1a3)][_0x4c6924(0x1a8)](_0x2fa3b1[_0x4c6924(0x16c)],_0x2fa3b1[_0x4c6924(0x185)]);_0x11baeb[_0x4c6924(0x1a4)]=_0x32ba31;const _0x5a1730=await this['getGatewayCommission'](_0x2fa3b1[_0x4c6924(0x17e)],_0x2fa3b1[_0x4c6924(0x9f)]),_0x2ec94c=_0x32ba31*(0x1-_0x5a1730/0x64);_0x11baeb['amountAfterGatewayCommissionUSDT']=_0x2ec94c,console[_0x4c6924(0x191)](_0x4c6924(0x14c)+_0x2fa3b1['id']+_0x4c6924(0x143)),console['log'](_0x4c6924(0x18d)+_0x2fa3b1['amount']+'\x20'+_0x2fa3b1[_0x4c6924(0x185)]+_0x4c6924(0xe5)+_0x32ba31['toFixed'](0x6)+'\x20USDT'),console[_0x4c6924(0x191)](_0x4c6924(0x131)+_0x2fa3b1[_0x4c6924(0x9f)]+_0x4c6924(0xa3)+_0x5a1730+'%'),console[_0x4c6924(0x191)](_0x4c6924(0x19b)+_0x2ec94c[_0x4c6924(0xbb)](0x6)+_0x4c6924(0x115));}console[_0x4c6924(0x191)](_0x4c6924(0x14c)+_0x2fa3b1['id']+_0x4c6924(0xb0)+_0x11baeb[_0x4c6924(0x18c)][_0x4c6924(0x17c)]());}if(_0x4a0bcc['paymentDetails']){const _0xd50236=_0x4a0bcc[_0x4c6924(0xdd)];_0xd50236[_0x4c6924(0x9c)]&&(_0x11baeb[_0x4c6924(0x15d)]=_0xd50236['iban'],console['log'](_0x4c6924(0x11e)+_0xd50236[_0x4c6924(0x9c)]));if(_0xd50236[_0x4c6924(0x163)]){const _0x312bea=_0x2fa3b1[_0x4c6924(0x10e)]||'',_0x62a577=_0x4c6924(0x130)+_0xd50236[_0x4c6924(0x163)];_0x11baeb['adminNotes']=_0x312bea?_0x312bea+'\x0a\x0a'+_0x62a577:_0x62a577,console[_0x4c6924(0x191)]('üè¶\x20[CHECK]\x20Saved\x20bank\x20details\x20to\x20admin\x20notes');}_0xd50236[_0x4c6924(0x11a)]&&console[_0x4c6924(0x191)]('üÜî\x20[CHECK]\x20Transaction\x20ID:\x20'+_0xd50236[_0x4c6924(0x11a)]),_0xd50236[_0x4c6924(0x16f)]&&console[_0x4c6924(0x191)](_0x4c6924(0xaf)+_0xd50236[_0x4c6924(0x16f)]);}await database_1['default'][_0x4c6924(0xb3)][_0x4c6924(0xbe)]({'where':{'id':_0x2fa3b1['id']},'data':_0x11baeb});if(_0x4a0bcc[_0x4c6924(0x19f)]==='PAID'&&_0x2fa3b1[_0x4c6924(0x19f)]!=='PAID'){console[_0x4c6924(0x191)](_0x4c6924(0xee)+_0x2fa3b1['id']+_0x4c6924(0x18f));const _0x20da10=await database_1['default'][_0x4c6924(0xb3)][_0x4c6924(0xef)]({'where':{'id':_0x2fa3b1['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x20da10?.[_0x4c6924(0x193)]&&_0x20da10[_0x4c6924(0xe7)])try{const _0x1f7290=_0x20da10['paymentLink'];console[_0x4c6924(0x191)](_0x4c6924(0x102)+_0x1f7290['id']+':\x20type='+_0x1f7290['type']+',\x20currentPayments='+_0x1f7290['currentPayments']+_0x4c6924(0xfc)+_0x1f7290['status']);const _0x701333=_0x1f7290[_0x4c6924(0x189)]+0x1,_0x56cc99=_0x1f7290[_0x4c6924(0xc4)]===_0x4c6924(0x17b)?_0x4c6924(0x127):_0x1f7290[_0x4c6924(0x19f)];await database_1[_0x4c6924(0x116)]['paymentLink'][_0x4c6924(0xbe)]({'where':{'id':_0x1f7290['id']},'data':{'currentPayments':_0x701333,'status':_0x56cc99,'updatedAt':new Date()}}),console[_0x4c6924(0x191)]('‚úÖ\x20[COINTOPAY]\x20Payment\x20link\x20'+_0x1f7290['id']+'\x20updated:\x20currentPayments='+_0x1f7290['currentPayments']+_0x4c6924(0xe5)+_0x701333+_0x4c6924(0xfc)+_0x1f7290[_0x4c6924(0x19f)]+_0x4c6924(0xe5)+_0x56cc99);}catch(_0x1b353f){console[_0x4c6924(0x134)](_0x4c6924(0x11b),_0x1b353f);}else console[_0x4c6924(0x191)]('üìà\x20[COINTOPAY]\x20Payment\x20'+_0x2fa3b1['id']+_0x4c6924(0xc2));}await database_1['default'][_0x4c6924(0x13e)][_0x4c6924(0x19c)]({'data':{'paymentId':_0x2fa3b1['id'],'shopId':_0x2fa3b1['shopId'],'event':'cointopay_status_check_'+_0x4a0bcc[_0x4c6924(0x19f)][_0x4c6924(0x17d)](),'statusCode':0xc8,'responseBody':JSON[_0x4c6924(0xf1)]({'oldStatus':_0x2fa3b1['status'],'newStatus':_0x4a0bcc[_0x4c6924(0x19f)],'paymentDetails':_0x4a0bcc[_0x4c6924(0xdd)],'checkedAt':new Date()['toISOString']()})}}),await this[_0x4c6924(0x1a1)](_0x2fa3b1,_0x4a0bcc[_0x4c6924(0x19f)]),await this[_0x4c6924(0xa4)](_0x2fa3b1,_0x4a0bcc[_0x4c6924(0x19f)]),_0x4a0bcc[_0x4c6924(0x19f)]!=='PENDING'&&(console['log']('üßπ\x20[CHECK]\x20Payment\x20'+_0x2fa3b1['id']+_0x4c6924(0x100)+_0x4a0bcc[_0x4c6924(0x19f)]+',\x20clearing\x20individual\x20timers'),this[_0x4c6924(0x175)](_0x2fa3b1['id'])),console['log'](_0x4c6924(0xd7)+_0x2fa3b1['id']+_0x4c6924(0xdc));}else console[_0x4c6924(0x191)]('üìä\x20[CHECK]\x20Payment\x20'+_0x2fa3b1['id']+_0x4c6924(0xe0)+_0x4a0bcc[_0x4c6924(0x19f)]+')'),this[_0x4c6924(0x123)](_0x2fa3b1['id'],_0x2fa3b1[_0x4c6924(0x164)],_0x2fa3b1['status'],_0x4a0bcc[_0x4c6924(0x19f)],'status_check',{'statusUnchanged':!![],'paymentDetails':_0x4a0bcc[_0x4c6924(0xdd)],'amount':_0x4a0bcc['amount'],'currency':_0x4a0bcc[_0x4c6924(0x185)],'shopId':_0x2fa3b1[_0x4c6924(0x17e)],'checkTimestamp':new Date()[_0x4c6924(0x17c)]()});}catch(_0x25e260){console[_0x4c6924(0x134)](_0x4c6924(0x11d)+_0x2fa3b1['id']+':',_0x25e260),this[_0x4c6924(0x187)](_0x2fa3b1['id'],_0x2fa3b1[_0x4c6924(0x164)],_0x25e260,'status_check',{'paymentAmount':_0x2fa3b1[_0x4c6924(0x16c)],'paymentCurrency':_0x2fa3b1[_0x4c6924(0x185)],'shopId':_0x2fa3b1['shopId'],'createdAt':_0x2fa3b1[_0x4c6924(0xb4)]}),await database_1['default']['webhookLog'][_0x4c6924(0x19c)]({'data':{'paymentId':_0x2fa3b1['id'],'shopId':_0x2fa3b1[_0x4c6924(0x17e)],'event':'cointopay_status_check_error','statusCode':0x1f4,'responseBody':JSON[_0x4c6924(0xf1)]({'error':_0x25e260 instanceof Error?_0x25e260['message']:'Unknown\x20error','gatewayPaymentId':_0x2fa3b1[_0x4c6924(0x164)],'checkedAt':new Date()[_0x4c6924(0x17c)]()})}});}}async[a38_0x81c47f(0x1a1)](_0x1b57a1,_0x4fc7f6){const _0x4e0935=a38_0x81c47f,_0xbd5f88=Date[_0x4e0935(0x12d)]();try{const _0x2ca192=_0x1b57a1[_0x4e0935(0xe6)],_0xf113f5=_0x2ca192[_0x4e0935(0x13a)];if(!_0xf113f5?.['webhookUrl']){console[_0x4e0935(0x191)](_0x4e0935(0x192)+_0x2ca192['id']);return;}const _0xa74732=_0x4fc7f6==='PAID'?_0x4e0935(0x18e):_0x4fc7f6===_0x4e0935(0xaa)?_0x4e0935(0x109):_0x4fc7f6===_0x4e0935(0x117)?_0x4e0935(0x109):_0x4e0935(0xbd);if(!_0xf113f5['webhookEvents']?.[_0x4e0935(0x196)](_0xa74732)){console[_0x4e0935(0x191)]('Webhook\x20event\x20'+_0xa74732+_0x4e0935(0x108)+_0x2ca192['id']);return;}const _0x5f165e=(0x0,gateway_1[_0x4e0935(0xc8)])(_0x1b57a1[_0x4e0935(0x9f)])||_0x1b57a1['gateway'],_0x51ba31={'event':_0xa74732,'payment':{'id':_0x1b57a1['id'],'order_id':_0x1b57a1['orderId'],'gateway_order_id':_0x1b57a1[_0x4e0935(0x151)],'gateway':_0x5f165e,'amount':_0x1b57a1[_0x4e0935(0x16c)],'currency':_0x1b57a1[_0x4e0935(0x185)],'status':_0x4fc7f6[_0x4e0935(0x17d)](),'customer_email':_0x1b57a1[_0x4e0935(0xe2)],'customer_name':_0x1b57a1[_0x4e0935(0xf6)],'created_at':_0x1b57a1[_0x4e0935(0xb4)],'updated_at':new Date()}},_0x21d9cc=await fetch(_0xf113f5['webhookUrl'],{'method':'POST','headers':{'Content-Type':_0x4e0935(0x139),'User-Agent':_0x4e0935(0xa5)},'body':JSON['stringify'](_0x51ba31)}),_0x4d43ba=Date['now']()-_0xbd5f88,_0x37d759=_0x21d9cc['ok']?_0x4e0935(0xab):await _0x21d9cc['text']();loggerService_1[_0x4e0935(0xea)][_0x4e0935(0x167)](_0x1b57a1[_0x4e0935(0x17e)],_0xf113f5[_0x4e0935(0x160)],_0xa74732,_0x21d9cc[_0x4e0935(0x19f)],_0x4d43ba,_0x51ba31),console[_0x4e0935(0x191)](_0x4e0935(0x15e)+_0xf113f5[_0x4e0935(0x160)]+_0x4e0935(0xac)+_0x21d9cc[_0x4e0935(0x19f)]+'\x20('+_0x4d43ba+'ms)');}catch(_0x3a8ce1){console[_0x4e0935(0x134)](_0x4e0935(0xe3),_0x3a8ce1),loggerService_1[_0x4e0935(0xea)][_0x4e0935(0xcb)](_0x1b57a1['shopId'],_0x1b57a1['shop']?.['settings']?.[_0x4e0935(0x160)]||_0x4e0935(0x178),_0x4e0935(0x12e),_0x3a8ce1,{});}}async[a38_0x81c47f(0xa4)](_0x531c8f,_0x1023e2){const _0x12678a=a38_0x81c47f;try{const _0x5202f4={'PENDING':_0x12678a(0xe9),'PAID':'paid','FAILED':_0x12678a(0x105),'EXPIRED':_0x12678a(0x122)},_0x41d429=_0x5202f4[_0x1023e2];if(!_0x41d429||_0x41d429==='created')return;await telegramBotService_1[_0x12678a(0x13f)][_0x12678a(0xd5)](_0x531c8f[_0x12678a(0x17e)],_0x531c8f,_0x41d429);}catch(_0x3e85f9){console['error'](_0x12678a(0x9e),_0x3e85f9);}}async['checkPaymentById'](_0x336609){const _0x47a5c4=a38_0x81c47f;console[_0x47a5c4(0x191)](_0x47a5c4(0x101)+_0x336609);const _0x563738=await database_1[_0x47a5c4(0x116)][_0x47a5c4(0xb3)][_0x47a5c4(0xef)]({'where':{'id':_0x336609},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x563738)throw new Error(_0x47a5c4(0xb9));if(_0x563738['gateway']!=='cointopay'&&_0x563738[_0x47a5c4(0x9f)]!==_0x47a5c4(0x197))throw new Error(_0x47a5c4(0x157));console[_0x47a5c4(0x191)](_0x47a5c4(0xcc)+_0x563738['gateway']+_0x47a5c4(0x14e)+_0x336609),await this[_0x47a5c4(0x162)](_0x563738),console['log']('‚úÖ\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20'+_0x336609);}[a38_0x81c47f(0x113)](){const _0x301fe3=a38_0x81c47f,_0x28fc95=this[_0x301fe3(0x15f)]?this[_0x301fe3(0x14d)]:undefined,_0x370eb5=Array[_0x301fe3(0x17a)](this[_0x301fe3(0xd4)][_0x301fe3(0x112)]())[_0x301fe3(0x15a)](_0x217e31=>({'paymentId':_0x217e31[_0x301fe3(0xf0)],'gatewayPaymentId':_0x217e31['gatewayPaymentId'],'createdAt':_0x217e31[_0x301fe3(0xb4)],'timersCount':_0x217e31['timers'][_0x301fe3(0x9a)]}));return{'isActive':!!this[_0x301fe3(0x15f)],'globalCheckIntervalMinutes':this[_0x301fe3(0x14d)]/(0x3e8*0x3c),'expiryDays':this[_0x301fe3(0x180)],'activeIndividualTimers':this['paymentTimers'][_0x301fe3(0x181)],'nextGlobalCheckIn':_0x28fc95,'paymentTimersDetails':_0x370eb5};}[a38_0x81c47f(0xb8)](_0x2c2940){const _0x2fa2c3=a38_0x81c47f,_0xb4a70e=this[_0x2fa2c3(0xd4)][_0x2fa2c3(0xde)](_0x2c2940);if(_0xb4a70e)return{'hasTimers':!![],'timersCount':_0xb4a70e[_0x2fa2c3(0x10a)][_0x2fa2c3(0x9a)],'createdAt':_0xb4a70e[_0x2fa2c3(0xb4)],'gatewayPaymentId':_0xb4a70e[_0x2fa2c3(0x164)]};return{'hasTimers':![]};}async[a38_0x81c47f(0xf5)](_0x2a575b,_0x3d005b){const _0x275999=a38_0x81c47f;try{const _0x44f22c=await database_1[_0x275999(0x116)][_0x275999(0xe6)][_0x275999(0xef)]({'where':{'id':_0x2a575b},'select':{'gatewaySettings':!![]}});if(!_0x44f22c?.['gatewaySettings'])return console[_0x275999(0x191)](_0x275999(0xda)+_0x2a575b+_0x275999(0x11c)),0xa;const _0x383e31=JSON['parse'](_0x44f22c[_0x275999(0xa2)]);for(const [_0x5418ad,_0x4e4771]of Object[_0x275999(0x124)](_0x383e31)){if(_0x5418ad[_0x275999(0x17d)]()===_0x3d005b[_0x275999(0x17d)]()){const _0x4f25ea=_0x4e4771['commission']||0xa;return console[_0x275999(0x191)](_0x275999(0x184)+_0x3d005b+'\x20commission\x20for\x20shop\x20'+_0x2a575b+':\x20'+_0x4f25ea+'%'),_0x4f25ea;}}return console[_0x275999(0x191)](_0x275999(0x17f)+_0x3d005b+_0x275999(0x1a9)+_0x2a575b+_0x275999(0xeb)),0xa;}catch(_0x55b48c){return console['error'](_0x275999(0xf9)+_0x2a575b+_0x275999(0x1a5)+_0x3d005b+':',_0x55b48c),0xa;}}}exports['CoinToPayStatusService']=CoinToPayStatusService,exports[a38_0x81c47f(0x179)]=new CoinToPayStatusService();function a38_0xe79b(){const _0x50d779=['logWhiteDomainError','webhookLog','telegramBotService','‚è∞\x20[GLOBAL]\x20Payment\x20','delay','üßπ\x20[DEBUG]\x20Clearing\x20','\x20amounts\x20calculated:','ü™ô\x20[TIMER]\x20Individual\x20check\x20#','üîÑ\x20[CHECK]\x20Updating\x20payment\x20','push','floor','üìä\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','\x20pending\x20CoinToPay\x20payments','ü™ô\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','\x20triggered\x20for\x20payment\x20','üí∞\x20[CHECK]\x20Payment\x20','GLOBAL_CHECK_INTERVAL_MS','\x20payment\x20','üîç\x20[CHECK]\x20Checking\x20','checkExpiredPayments','gatewayOrderId','\x20status\x20is\x20','üõë\x20[SHUTDOWN]\x20Cleared\x20','üìä\x20[CHECK]\x20CoinToPay2\x20payment\x20','‚úÖ\x20[HOURLY]\x20Payment\x20','findMany','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','9426DZETof','\x20\x20\x20üìÖ\x20Time:\x20','map','\x20skipped,\x20','‚ùå\x20[HOURLY]\x20Payment\x20','remitterIban','Shop\x20webhook\x20sent\x20to\x20','globalCheckInterval','webhookUrl','./telegramBotService','checkSinglePayment','bankDetails','gatewayPaymentId','defineProperty','checkAllPendingPayments','logShopWebhookSent','__esModule','\x20\x20\x20üìù\x20Details:','\x20timers\x20for\x20payment\x20','__importDefault','amount','üìä\x20[CHECK]\x20Payment\x20','\x20has\x20no\x20gatewayPaymentId,\x20skipping','confirmedOn','‚è∞\x20[GLOBAL]\x20Found\x20','coinToPay2Service','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','timestamp','clearPaymentTimers','ü™ô\x20[GLOBAL]\x20Found\x20','\x20seconds\x20(','unknown','coinToPayStatusService','from','SINGLE','toISOString','toLowerCase','shopId','No\x20specific\x20commission\x20found\x20for\x20gateway\x20','EXPIRY_DAYS','size','../config/database','stopPeriodicStatusCheck','Gateway\x20','currency','description','logCoinToPayError','\x20\x20\x20-\x20Status:\x20','currentPayments','\x20expired\x20CoinToPay\x20payments','\x20is\x20too\x20new\x20(','paidAt','\x20\x20\x20Amount:\x20','payment.success','\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link','‚úÖ\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','log','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','paymentLinkId','createdOn','üìä\x20[CHECK]\x20CoinToPay\x20payment\x20','includes','cointopay2','\x20for\x20payment\x20','üìä\x20[HOURLY]\x20Payment\x20','2121ZlEYQV','\x20\x20\x20Amount\x20after\x20commission:\x20','create','checkPaymentStatus','CoinToPayService','status','üõë\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','sendShopWebhook','checkSinglePaymentById','currencyService','amountUSDT',',\x20gateway\x20','\x20\x20\x20-\x20Gateway:\x20','COINTOPAY_STATUS_CHANGE','convertToUSDT','\x20in\x20shop\x20','\x20\x20\x20-\x20ShopId:\x20','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','length','Payment\x20older\x20than\x20','iban','\x20\x20\x20üìù\x20Context:','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','gateway','\x20not\x20found\x20in\x20database','14575tIrbOH','gatewaySettings','\x20commission:\x20','sendPaymentStatusNotification','TesSoft\x20Payment\x20System/1.0','\x20\x20\x20-\x20GatewayPaymentId:\x20','\x20days,\x20marking\x20as\x20EXPIRED','ü™ô\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','5\x20minutes','FAILED','Success','\x20with\x20status\x20','ü™ô\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','set','‚úÖ\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','\x20marked\x20as\x20paid\x20at:\x20','‚ùå\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','\x20is\x20valid\x20for\x20checking,\x20proceeding...','payment','createdAt','coinToPayService','\x20expired','\x20not\x20found,\x20clearing\x20timers','getPaymentTimerInfo','Payment\x20not\x20found','\x20found:','toFixed','8459432qJLncr','payment.pending','update','not\x20found','schedulePaymentChecks','forEach','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','\x20(after\x20','type','auto_expire','365981ttJHKe','\x20\x20\x20üìç\x20Source:\x20','getGatewayIdByName','31455Ductcy','\x20to\x20clear','logShopWebhookError','‚úÖ\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','COINTOPAY_ERROR','‚ö†Ô∏è\x20[CHECK]\x20Payment\x20','\x20is\x20older\x20than\x20','getTime','‚úÖ\x20[TIMER]\x20Individual\x20check\x20#','getDate','paymentTimers','sendPaymentNotification','schedule_created','‚úÖ\x20[CHECK]\x20Payment\x20','\x20days','ü™ô\x20[DEBUG]\x20Creating\x20','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','ü™ô\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','\x20updated\x20successfully','paymentDetails','get','./loggerService','\x20status\x20unchanged\x20(','delete','customerEmail','Failed\x20to\x20send\x20shop\x20webhook:','Failed\x20to\x20mark\x20payment\x20as\x20expired','\x20->\x20','shop','paymentLink','üîç\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','created','loggerService',',\x20using\x20default\x2010%','‚ùå\x20[TIMER]\x20Failed\x20individual\x20check\x20#','CoinToPayStatusService','üìà\x20[COINTOPAY]\x20Payment\x20','findUnique','paymentId','stringify','3QfKgLt','status_check','cointopay','getGatewayCommission','customerName','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','PAID','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','\x20status:\x20',',\x20status=','message','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','ü™ô\x20[ERROR]\x20CoinToPay\x20Error:\x20','\x20status\x20changed\x20to\x20','üîç\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20','üìà\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','10825TRfRjY','üîç\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','failed','üõë\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped',',\x20stopping\x20individual\x20checks','\x20not\x20enabled\x20for\x20shop\x20','payment.failed','timers','setDate','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','‚è∞\x20[EXPIRY]\x20Payment\x20','adminNotes','4908fVTdXN','PENDING','830fGFqEA','values','getServiceStats','‚ùå\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20','\x20USDT','default','EXPIRED','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','\x20days\x20without\x20payment\x20confirmation','transactionId','‚ùå\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:',',\x20using\x20default\x20commission\x2010%','‚ùå\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','üè¶\x20[CHECK]\x20Saved\x20IBAN:\x20','.\x20Remaining\x20active\x20timers:\x20','./currencyService','\x20in\x20','expired','logCoinToPayStatus','entries','‚è∞\x20[HOURLY]\x20Payment\x20','./gateways/coinToPayService','COMPLETED','‚ùå\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','\x20status\x20from\x20','cointopay_auto_expired','808BJqoCo','now','webhook_send','1552522rtwgGN','Bank\x20Details:\x20','\x20\x20\x20Gateway\x20','has','2\x20minutes','error','CoinToPay2Service','\x20details:','not\x20confirmed','ü™ô\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','application/json','settings','/status/','üßπ\x20[DEBUG]\x20Cleared\x20timer\x20#'];a38_0xe79b=function(){return _0x50d779;};return a38_0xe79b();}