'use strict';const a48_0x355361=a48_0x56cf;(function(_0x1dd57c,_0x1c289a){const _0x117114=a48_0x56cf,_0x2ac6ca=_0x1dd57c();while(!![]){try{const _0x3b24d5=-parseInt(_0x117114(0xdb))/0x1*(-parseInt(_0x117114(0x1ad))/0x2)+parseInt(_0x117114(0x106))/0x3*(parseInt(_0x117114(0x16e))/0x4)+-parseInt(_0x117114(0x13c))/0x5*(-parseInt(_0x117114(0xca))/0x6)+-parseInt(_0x117114(0x17b))/0x7+parseInt(_0x117114(0x1bc))/0x8*(-parseInt(_0x117114(0x15c))/0x9)+parseInt(_0x117114(0x1d7))/0xa+parseInt(_0x117114(0x155))/0xb*(-parseInt(_0x117114(0xce))/0xc);if(_0x3b24d5===_0x1c289a)break;else _0x2ac6ca['push'](_0x2ac6ca['shift']());}catch(_0x371198){_0x2ac6ca['push'](_0x2ac6ca['shift']());}}}(a48_0x1bea,0xc2874));function a48_0x56cf(_0x12cd53,_0x4ff390){_0x12cd53=_0x12cd53-0xc9;const _0x1bea8d=a48_0x1bea();let _0x56cfdc=_0x1bea8d[_0x12cd53];return _0x56cfdc;}var __importDefault=this&&this['__importDefault']||function(_0x3d507e){const _0x5be77b=a48_0x56cf;return _0x3d507e&&_0x3d507e[_0x5be77b(0xd3)]?_0x3d507e:{'default':_0x3d507e};};function a48_0x1bea(){const _0x5634e4=['stringify','customerEmail','‚úÖ\x20[EXPIRY]\x20Payment\x20','üìà\x20[COINTOPAY]\x20Found\x20payment\x20link\x20','FAILED','timers','amountAfterGatewayCommissionUSDT','paidAt','settings','Payment\x20System/1.0','‚úÖ\x20[DEBUG]\x20Successfully\x20scheduled\x20','ü™ô\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','currentPayments','getPaymentTimerInfo','gateway','\x20to\x20clear','\x20payment\x20','logCoinToPayStatus','üìä\x20[HOURLY]\x20Payment\x20','transactionId','./currencyService','üí∞\x20[CHECK]\x20Payment\x20','23598817ynFkmQ','‚úÖ\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','üìä\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','ü™ô\x20[GLOBAL]\x20Found\x20','push','\x20not\x20enabled\x20for\x20shop\x20','\x20completed\x20for\x20payment\x20','1236303gFtlQV','shopId','Gateway\x20','üßπ\x20[DEBUG]\x20Cleared\x20timer\x20#','map','customerName','\x20\x20\x20-\x20paymentId:\x20','logShopWebhookSent','toISOString','floor','\x20USDT',',\x20stopping\x20individual\x20checks','\x20\x20\x20-\x20gatewayPaymentId:\x20','forEach','getTime','\x20(after\x20','created','payment.success','1716yhgDpQ','‚è∞\x20[EXPIRY]\x20Payment\x20','2\x20minutes','\x20\x20\x20üìç\x20Source:\x20','\x20status\x20from\x20','../types/gateway','currencyService','‚ùå\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:','\x20days\x20(created\x20before\x20','coinToPayStatusService','iban','paymentId','Unknown\x20error','8427398rdQKIM',',\x20status=','cointopay2','unknown','./gateways/coinToPay2Service','coinToPayService','default',',\x20clearing\x20individual\x20timers','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','‚è∞\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','‚ùå\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','‚úÖ\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','‚ùå\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','\x20in\x20shop\x20','checkSinglePaymentById','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20','stack','\x20updated:\x20currentPayments=','findMany','‚ö†Ô∏è\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','webhookEvents','logCoinToPayError','createdOn','üìä\x20[CHECK]\x20Payment\x20','\x20amounts\x20calculated:','globalCheckInterval','\x20days','\x20status\x20unchanged\x20(','checkAllPendingPayments','‚è∞\x20[DEBUG]\x20Scheduled\x20check\x20#','getGatewayIdByName','‚úÖ\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','telegramBotService','webhookLog','description','\x20\x20\x20Amount:\x20','\x20\x20\x20üìù\x20Details:','coinToPay2Service','\x20marked\x20as\x20EXPIRED\x20due\x20to\x20','confirmedOn','\x20\x20\x20üìù\x20Context:','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','ü™ô\x20[ERROR]\x20CoinToPay\x20Error:\x20','\x20\x20\x20-\x20ShopId:\x20','create','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','./loggerService','setDate','\x20expired','3742RKqRoz','delay','cointopay_status_check_','üìä\x20[CHECK]\x20CoinToPay2\x20payment\x20','now',':\x20type=','type','update','PAID','paid','\x20with\x20status\x20','\x20\x20\x20‚ùå\x20Error:\x20','set','Failed\x20to\x20mark\x20payment\x20as\x20expired','status','8qgmKNc','entries','error','cointopay_status_check_error','sendPaymentNotification','loggerService','/status/','bankDetails','size','gatewayPaymentId','paymentLink','logShopWebhookError','‚ö†Ô∏è\x20[CHECK]\x20Payment\x20','\x20seconds\x20(','\x20expired\x20CoinToPay\x20payments','findUnique','cointopay','üõë\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','üîÑ\x20[CHECK]\x20Updating\x20payment\x20','üìä\x20[CHECK]\x20CoinToPay\x20payment\x20','stopPeriodicStatusCheck','POST','toLowerCase','ms)','\x20checked,\x20','logWhiteDomainError','‚úÖ\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','15792160klHYRC','‚è∞\x20[HOURLY]\x20Payment\x20','paymentDetails','convertToUSDT','4632AWJAqX','\x20\x20\x20üìÖ\x20Time:\x20','payment.pending','auto_expire','12bgbSIk','\x20for\x20payment\x20','COINTOPAY_STATUS_CHANGE','ü™ô\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','payment','__esModule','toFixed',',\x20using\x20default\x2010%','‚ùå\x20[TIMER]\x20Failed\x20individual\x20check\x20#','üõë\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','paymentTimers','‚ùå\x20[CHECK]\x20Payment\x20','\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20','751bamABi','schedulePaymentChecks','PENDING','üßπ\x20[DEBUG]\x20Clearing\x20','log','parse','\x20marked\x20as\x20paid\x20at:\x20','checkPaymentById','\x20is\x20valid\x20for\x20checking,\x20proceeding...','\x20commission\x20for\x20shop\x20','application/json','orderId','./gateways/coinToPayService','‚úÖ\x20[CHECK]\x20Payment\x20','üîç\x20[CHECK]\x20Checking\x20','commission','./telegramBotService','‚è∞\x20[GLOBAL]\x20Payment\x20','gatewayCommissionRate','\x20has\x20individual\x20timers,\x20skipping\x20global\x20check','‚úÖ\x20[HOURLY]\x20Payment\x20','\x20to\x20','COMPLETED','createdAt','h),\x20skipping\x20global\x20check','checkSinglePayment','ü™ô\x20[DEBUG]\x20Creating\x20','sendShopWebhook','status_check','\x20\x20\x20üìä\x20Status:\x20','‚ùå\x20[HOURLY]\x20Payment\x20','\x20\x20\x20-\x20Status:\x20','\x20in\x20','amount','checkPaymentStatus','\x20status:\x20','EXPIRY_DAYS','\x20is\x20older\x20than\x20','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','payment.failed','delete','defineProperty','webhookUrl','3945CUFJEy','Payment\x20older\x20than\x20','1\x20minute','message','\x20triggered\x20for\x20payment\x20','startPeriodicStatusCheck','ü™ô\x20[TIMER]\x20Individual\x20check\x20#','üè¶\x20[CHECK]\x20Bank\x20details\x20provided:\x20','../config/database','ü™ô\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','\x20(age:\x20','ü™ô\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20','includes','\x20commission:\x20','\x20status\x20changed\x20to\x20','sendPaymentStatusNotification','currency','‚úÖ\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20','\x20status\x20is\x20','get','‚úÖ\x20[COINTOPAY]\x20Payment\x20link\x20','CoinToPayService','\x20\x20\x20-\x20Amount:\x20','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','\x20has\x20no\x20gatewayPaymentId','expired','\x20initial\x20timers\x20for\x20payment\x20','\x20\x20\x20-\x20GatewayPaymentId:\x20','GLOBAL_CHECK_INTERVAL_MS','clearPaymentTimers','EXPIRED','\x20found:','5\x20minutes','Shop\x20webhook\x20sent\x20to\x20','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','Webhook\x20event\x20','ü™ô\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','Success','cointopay_auto_expired','amountUSDT','from','‚ùå\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','\x20is\x20too\x20new\x20(','\x20not\x20found,\x20clearing\x20timers','values','‚úÖ\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','\x20skipped,\x20','catch','shop','COINTOPAY_ERROR','ü™ô\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...','\x20->\x20','length','failed','4760fdaFJO','not\x20found','Payment\x20not\x20found'];a48_0x1bea=function(){return _0x5634e4;};return a48_0x1bea();}Object[a48_0x355361(0x104)](exports,'__esModule',{'value':!![]}),exports['coinToPayStatusService']=exports['CoinToPayStatusService']=void 0x0;const coinToPayService_1=require(a48_0x355361(0xe7)),coinToPay2Service_1=require(a48_0x355361(0x17f)),gateway_1=require(a48_0x355361(0x173)),database_1=__importDefault(require(a48_0x355361(0x10e))),telegramBotService_1=require(a48_0x355361(0xeb)),loggerService_1=require(a48_0x355361(0x1aa)),currencyService_1=require(a48_0x355361(0x153));class CoinToPayStatusService{constructor(){const _0xa549b7=a48_0x355361;this[_0xa549b7(0x195)]=null,this['GLOBAL_CHECK_INTERVAL_MS']=0x3c*0x3c*0x3e8,this[_0xa549b7(0xff)]=0x5,this[_0xa549b7(0xd8)]=new Map(),this[_0xa549b7(0x180)]=new coinToPayService_1[(_0xa549b7(0x11b))](),this[_0xa549b7(0x1a1)]=new coinToPay2Service_1['CoinToPay2Service'](),console[_0xa549b7(0xdf)](_0xa549b7(0x10f));}[a48_0x355361(0xdc)](_0x596dcd,_0x232ae3){const _0x1d2d06=a48_0x355361;console['log'](_0x1d2d06(0x12a)),console['log'](_0x1d2d06(0x162)+_0x596dcd),console['log'](_0x1d2d06(0x168)+_0x232ae3),this['clearPaymentTimers'](_0x596dcd);const _0x1faa45=[],_0x277861=new Date(),_0x343c37=[{'delay':0x1*0x3c*0x3e8,'description':_0x1d2d06(0x108)},{'delay':0x2*0x3c*0x3e8,'description':_0x1d2d06(0x170)},{'delay':0x5*0x3c*0x3e8,'description':_0x1d2d06(0x126)},{'delay':0x5*0x3c*0x3e8,'description':_0x1d2d06(0x126)}];console[_0x1d2d06(0xdf)](_0x1d2d06(0xf5)+_0x343c37[_0x1d2d06(0x13a)]+_0x1d2d06(0x120)+_0x596dcd);let _0x153134=0x0;_0x343c37[_0x1d2d06(0x169)]((_0xe92f74,_0xb2031)=>{const _0x4d4de7=_0x1d2d06;_0x153134+=_0xe92f74[_0x4d4de7(0x1ae)];const _0x484dd9=setTimeout(async()=>{const _0x4ebbce=_0x4d4de7;console[_0x4ebbce(0xdf)](_0x4ebbce(0x10c)+(_0xb2031+0x1)+_0x4ebbce(0x10a)+_0x596dcd+_0x4ebbce(0x16b)+_0xe92f74['description']+')');try{await this[_0x4ebbce(0x189)](_0x596dcd),console[_0x4ebbce(0xdf)]('‚úÖ\x20[TIMER]\x20Individual\x20check\x20#'+(_0xb2031+0x1)+_0x4ebbce(0x15b)+_0x596dcd);}catch(_0x7601a1){console[_0x4ebbce(0x1be)](_0x4ebbce(0xd6)+(_0xb2031+0x1)+_0x4ebbce(0xcf)+_0x596dcd+':',_0x7601a1),this[_0x4ebbce(0x191)](_0x596dcd,_0x232ae3,_0x7601a1,'status_check',{'checkNumber':_0xb2031+0x1,'scheduledAfter':_0xe92f74[_0x4ebbce(0x19e)],'isIndividualCheck':!![]});}},_0x153134);_0x1faa45[_0x4d4de7(0x159)](_0x484dd9),console['log'](_0x4d4de7(0x199)+(_0xb2031+0x1)+_0x4d4de7(0xcf)+_0x596dcd+_0x4d4de7(0xfb)+_0x153134/0x3e8+_0x4d4de7(0x1c9)+_0xe92f74[_0x4d4de7(0x19e)]+')');});const _0x3c6c4d=setInterval(async()=>{const _0x59b8f1=_0x1d2d06;console[_0x59b8f1(0xdf)](_0x59b8f1(0x111)+_0x596dcd);try{const _0x14a691=await database_1['default'][_0x59b8f1(0xd2)][_0x59b8f1(0x1cb)]({'where':{'id':_0x596dcd},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0x14a691){console[_0x59b8f1(0xdf)](_0x59b8f1(0xf9)+_0x596dcd+_0x59b8f1(0x131)),this[_0x59b8f1(0x123)](_0x596dcd);return;}console[_0x59b8f1(0xdf)](_0x59b8f1(0x151)+_0x596dcd+'\x20current\x20status:\x20'+_0x14a691[_0x59b8f1(0x1bb)]);if(_0x14a691[_0x59b8f1(0x1bb)]!==_0x59b8f1(0xdd)){console['log'](_0x59b8f1(0xef)+_0x596dcd+_0x59b8f1(0x118)+_0x14a691[_0x59b8f1(0x1bb)]+_0x59b8f1(0x167)),this[_0x59b8f1(0x123)](_0x596dcd);return;}const _0x10d44b=Math['floor']((Date[_0x59b8f1(0x1b1)]()-_0x14a691[_0x59b8f1(0xf2)][_0x59b8f1(0x16a)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x10d44b>=this['EXPIRY_DAYS']){console[_0x59b8f1(0xdf)](_0x59b8f1(0x1d8)+_0x596dcd+_0x59b8f1(0x100)+this[_0x59b8f1(0xff)]+_0x59b8f1(0x1a9)),this['clearPaymentTimers'](_0x596dcd);return;}await this['checkSinglePaymentById'](_0x596dcd),console[_0x59b8f1(0xdf)](_0x59b8f1(0x1d6)+_0x596dcd);}catch(_0x45798c){console[_0x59b8f1(0x1be)]('‚ùå\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20'+_0x596dcd+':',_0x45798c),this[_0x59b8f1(0x191)](_0x596dcd,_0x232ae3,_0x45798c,_0x59b8f1(0xf7),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x1faa45[_0x1d2d06(0x159)](_0x3c6c4d),this[_0x1d2d06(0xd8)][_0x1d2d06(0x1b9)](_0x596dcd,{'timers':_0x1faa45,'paymentId':_0x596dcd,'gatewayPaymentId':_0x232ae3,'createdAt':_0x277861}),console[_0x1d2d06(0xdf)](_0x1d2d06(0x149)+_0x343c37['length']+_0x1d2d06(0xda)+_0x596dcd),console[_0x1d2d06(0xdf)](_0x1d2d06(0x157)+this[_0x1d2d06(0xd8)][_0x1d2d06(0x1c4)]),this[_0x1d2d06(0x150)](_0x596dcd,_0x232ae3,'PENDING','PENDING','status_check',{'action':'schedule_created','scheduledChecks':_0x343c37[_0x1d2d06(0x13a)],'firstCheckIn':_0x343c37[0x0][_0x1d2d06(0x1ae)]/0x3e8,'totalTimers':this[_0x1d2d06(0xd8)][_0x1d2d06(0x1c4)]});}[a48_0x355361(0x123)](_0x2957a4){const _0xe325c6=a48_0x355361,_0xc23c5b=this['paymentTimers'][_0xe325c6(0x119)](_0x2957a4);_0xc23c5b?(console['log'](_0xe325c6(0xde)+_0xc23c5b[_0xe325c6(0x144)]['length']+'\x20timers\x20for\x20payment\x20'+_0x2957a4),_0xc23c5b[_0xe325c6(0x144)][_0xe325c6(0x169)]((_0x992b03,_0x4837f0)=>{const _0x34eb82=_0xe325c6;_0x992b03&&(clearTimeout(_0x992b03),clearInterval(_0x992b03),console[_0x34eb82(0xdf)](_0x34eb82(0x15f)+(_0x4837f0+0x1)+'\x20for\x20payment\x20'+_0x2957a4));}),this[_0xe325c6(0xd8)][_0xe325c6(0x103)](_0x2957a4),console[_0xe325c6(0xdf)](_0xe325c6(0x117)+_0x2957a4+'.\x20Remaining\x20active\x20timers:\x20'+this[_0xe325c6(0xd8)][_0xe325c6(0x1c4)])):console[_0xe325c6(0xdf)](_0xe325c6(0x18f)+_0x2957a4+_0xe325c6(0x14e));}async['checkSinglePaymentById'](_0x4dd6d6){const _0x28c0cc=a48_0x355361;console['log']('üîç\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20'+_0x4dd6d6);const _0x473ad7=await database_1['default'][_0x28c0cc(0xd2)][_0x28c0cc(0x1cb)]({'where':{'id':_0x4dd6d6},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x473ad7){console[_0x28c0cc(0xdf)](_0x28c0cc(0xd9)+_0x4dd6d6+'\x20not\x20found\x20in\x20database');return;}console['log'](_0x28c0cc(0x193)+_0x4dd6d6+_0x28c0cc(0x125)),console[_0x28c0cc(0xdf)]('\x20\x20\x20-\x20Gateway:\x20'+_0x473ad7['gateway']),console['log'](_0x28c0cc(0xfa)+_0x473ad7[_0x28c0cc(0x1bb)]),console[_0x28c0cc(0xdf)](_0x28c0cc(0x121)+_0x473ad7['gatewayPaymentId']),console[_0x28c0cc(0xdf)](_0x28c0cc(0x11c)+_0x473ad7['amount']+'\x20'+_0x473ad7[_0x28c0cc(0x116)]),console[_0x28c0cc(0xdf)](_0x28c0cc(0x1a7)+_0x473ad7['shopId']);if(_0x473ad7[_0x28c0cc(0x14d)]!==_0x28c0cc(0x1cc)&&_0x473ad7[_0x28c0cc(0x14d)]!==_0x28c0cc(0x17d)){console[_0x28c0cc(0xdf)](_0x28c0cc(0x1c8)+_0x4dd6d6+_0x28c0cc(0x183)+_0x473ad7['gateway']+')');return;}if(_0x473ad7[_0x28c0cc(0x1bb)]!==_0x28c0cc(0xdd)){console[_0x28c0cc(0xdf)]('‚ö†Ô∏è\x20[CHECK]\x20Payment\x20'+_0x4dd6d6+'\x20status\x20is\x20'+_0x473ad7['status']+',\x20stopping\x20individual\x20checks'),this[_0x28c0cc(0x123)](_0x4dd6d6);return;}if(!_0x473ad7[_0x28c0cc(0x1c5)]){console[_0x28c0cc(0xdf)]('‚ö†Ô∏è\x20[CHECK]\x20Payment\x20'+_0x4dd6d6+_0x28c0cc(0x11e));return;}console[_0x28c0cc(0xdf)]('‚úÖ\x20[CHECK]\x20Payment\x20'+_0x4dd6d6+_0x28c0cc(0xe3)),await this[_0x28c0cc(0xf4)](_0x473ad7);}[a48_0x355361(0x150)](_0x13291e,_0x54f76a,_0x521e07,_0x53be04,_0x604b9d,_0x4db407){const _0x585403=a48_0x355361,_0x546dec={'type':_0x585403(0xd0),'paymentId':_0x13291e,'gatewayPaymentId':_0x54f76a,'oldStatus':_0x521e07,'newStatus':_0x53be04,'source':_0x604b9d,'timestamp':new Date()[_0x585403(0x164)](),'details':_0x4db407||{}};loggerService_1[_0x585403(0x1c1)][_0x585403(0x150)](_0x546dec),console[_0x585403(0xdf)]('ü™ô\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20'+_0x13291e+'\x20('+_0x54f76a+')'),console[_0x585403(0xdf)](_0x585403(0xf8)+_0x521e07+_0x585403(0x139)+_0x53be04),console[_0x585403(0xdf)]('\x20\x20\x20üìç\x20Source:\x20'+_0x604b9d),console['log'](_0x585403(0xcb)+_0x546dec['timestamp']),_0x4db407&&console[_0x585403(0xdf)](_0x585403(0x1a0),_0x4db407);}[a48_0x355361(0x191)](_0x462380,_0x205581,_0xf41702,_0x3a6c4d,_0x6d20c8){const _0x1e442c=a48_0x355361,_0x4a2c10={'type':_0x1e442c(0x137),'paymentId':_0x462380,'gatewayPaymentId':_0x205581,'error':_0xf41702 instanceof Error?{'message':_0xf41702[_0x1e442c(0x109)],'stack':_0xf41702[_0x1e442c(0x18c)]}:_0xf41702,'source':_0x3a6c4d,'timestamp':new Date()[_0x1e442c(0x164)](),'context':_0x6d20c8||{}};loggerService_1[_0x1e442c(0x1c1)][_0x1e442c(0x191)](_0x4a2c10),console[_0x1e442c(0x1be)](_0x1e442c(0x1a6)+_0x462380+'\x20('+_0x205581+')'),console[_0x1e442c(0x1be)](_0x1e442c(0x1b8)+(_0xf41702 instanceof Error?_0xf41702[_0x1e442c(0x109)]:_0xf41702)),console[_0x1e442c(0x1be)](_0x1e442c(0x171)+_0x3a6c4d),console[_0x1e442c(0x1be)](_0x1e442c(0xcb)+_0x4a2c10['timestamp']),_0x6d20c8&&console[_0x1e442c(0x1be)](_0x1e442c(0x1a4),_0x6d20c8);}[a48_0x355361(0x10b)](){const _0x310127=a48_0x355361;console[_0x310127(0xdf)]('ü™ô\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)'),this[_0x310127(0x198)]()[_0x310127(0x135)](_0x36d108=>{const _0x5dd1be=_0x310127;console[_0x5dd1be(0x1be)]('‚ùå\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:',_0x36d108);}),this['globalCheckInterval']=setInterval(async()=>{const _0x2271da=_0x310127;try{console[_0x2271da(0xdf)](_0x2271da(0xd1)),await this[_0x2271da(0x198)](),console['log'](_0x2271da(0x101));}catch(_0xf2f82b){console[_0x2271da(0x1be)](_0x2271da(0x175),_0xf2f82b);}},this[_0x310127(0x122)]),console[_0x310127(0xdf)](_0x310127(0x133));}[a48_0x355361(0x1d0)](){const _0x5d2cb1=a48_0x355361;console[_0x5d2cb1(0xdf)](_0x5d2cb1(0xd7));this[_0x5d2cb1(0x195)]&&(clearInterval(this[_0x5d2cb1(0x195)]),this[_0x5d2cb1(0x195)]=null,console[_0x5d2cb1(0xdf)](_0x5d2cb1(0x1cd)));const _0x4f0279=this[_0x5d2cb1(0xd8)][_0x5d2cb1(0x1c4)];for(const [_0x99b526]of this[_0x5d2cb1(0xd8)]){this[_0x5d2cb1(0x123)](_0x99b526);}console['log']('üõë\x20[SHUTDOWN]\x20Cleared\x20'+_0x4f0279+'\x20individual\x20payment\x20timers');}async[a48_0x355361(0x198)](){const _0x17264a=a48_0x355361;try{console['log'](_0x17264a(0x138));const _0x342ac0=await database_1[_0x17264a(0x181)][_0x17264a(0xd2)][_0x17264a(0x18e)]({'where':{'gateway':{'in':[_0x17264a(0x1cc),'cointopay2']},'status':_0x17264a(0xdd),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console[_0x17264a(0xdf)](_0x17264a(0x158)+_0x342ac0['length']+'\x20pending\x20CoinToPay\x20payments');if(_0x342ac0['length']===0x0){console[_0x17264a(0xdf)](_0x17264a(0x14a));return;}const _0x720619=await this['checkExpiredPayments'](_0x342ac0);console['log']('‚è∞\x20[GLOBAL]\x20Found\x20'+_0x720619[_0x17264a(0x13a)]+_0x17264a(0x1ca));let _0x84adc5=0x0,_0x1b46e2=0x0;for(const _0x396d68 of _0x342ac0){try{if(_0x720619[_0x17264a(0x112)](_0x396d68['id'])){console['log']('‚è∞\x20[GLOBAL]\x20Payment\x20'+_0x396d68['id']+'\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check'),_0x1b46e2++;continue;}if(this[_0x17264a(0xd8)]['has'](_0x396d68['id'])){console[_0x17264a(0xdf)](_0x17264a(0xec)+_0x396d68['id']+_0x17264a(0xee)),_0x1b46e2++;continue;}const _0xab267c=(Date[_0x17264a(0x1b1)]()-_0x396d68[_0x17264a(0xf2)][_0x17264a(0x16a)]())/(0x3e8*0x3c*0x3c);if(_0xab267c<0x1){console[_0x17264a(0xdf)](_0x17264a(0xec)+_0x396d68['id']+_0x17264a(0x130)+_0xab267c[_0x17264a(0xd4)](0x1)+_0x17264a(0xf3)),_0x1b46e2++;continue;}console[_0x17264a(0xdf)]('üîç\x20[GLOBAL]\x20Checking\x20old\x20payment\x20'+_0x396d68['id']+_0x17264a(0x110)+_0xab267c[_0x17264a(0xd4)](0x1)+'h)'),await this[_0x17264a(0xf4)](_0x396d68),_0x84adc5++,await new Promise(_0x8e99ff=>setTimeout(_0x8e99ff,0x7d0));}catch(_0x5921e2){console['error']('‚ùå\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20'+_0x396d68['id']+':',_0x5921e2),this[_0x17264a(0x191)](_0x396d68['id'],_0x396d68['gatewayPaymentId']||_0x17264a(0x17e),_0x5921e2,_0x17264a(0xf7),{'isGlobalCheck':!![],'paymentAmount':_0x396d68[_0x17264a(0xfc)],'paymentCurrency':_0x396d68[_0x17264a(0x116)],'shopId':_0x396d68[_0x17264a(0x15d)],'createdAt':_0x396d68['createdAt']}),loggerService_1[_0x17264a(0x1c1)][_0x17264a(0x1d5)](_0x17264a(0x1cc),_0x17264a(0x1c2)+_0x396d68[_0x17264a(0x1c5)],_0x5921e2);}}console[_0x17264a(0xdf)](_0x17264a(0x11d)+_0x84adc5+_0x17264a(0x1d4)+_0x1b46e2+_0x17264a(0x134)+_0x720619[_0x17264a(0x13a)]+_0x17264a(0x1ac));}catch(_0x3b29a2){console[_0x17264a(0x1be)]('‚ùå\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:',_0x3b29a2);}}async['checkExpiredPayments'](_0x30ecf8){const _0xbdb2f6=a48_0x355361,_0x1b43fd=[],_0x5ae9c1=new Date();_0x5ae9c1[_0xbdb2f6(0x1ab)](_0x5ae9c1['getDate']()-this['EXPIRY_DAYS']),console[_0xbdb2f6(0xdf)](_0xbdb2f6(0x184)+this['EXPIRY_DAYS']+_0xbdb2f6(0x176)+_0x5ae9c1[_0xbdb2f6(0x164)]()+')');for(const _0x23b222 of _0x30ecf8){if(_0x23b222[_0xbdb2f6(0xf2)]<_0x5ae9c1){console[_0xbdb2f6(0xdf)](_0xbdb2f6(0x16f)+_0x23b222['id']+'\x20is\x20older\x20than\x20'+this[_0xbdb2f6(0xff)]+'\x20days,\x20marking\x20as\x20EXPIRED');try{this['logCoinToPayStatus'](_0x23b222['id'],_0x23b222[_0xbdb2f6(0x1c5)]||_0xbdb2f6(0x17e),'PENDING',_0xbdb2f6(0x124),_0xbdb2f6(0xcd),{'reason':_0xbdb2f6(0x107)+this[_0xbdb2f6(0xff)]+'\x20days','createdAt':_0x23b222[_0xbdb2f6(0xf2)],'daysSinceCreation':Math[_0xbdb2f6(0x165)]((Date[_0xbdb2f6(0x1b1)]()-_0x23b222[_0xbdb2f6(0xf2)][_0xbdb2f6(0x16a)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x23b222[_0xbdb2f6(0xfc)],'paymentCurrency':_0x23b222[_0xbdb2f6(0x116)],'shopId':_0x23b222['shopId']}),await database_1['default'][_0xbdb2f6(0xd2)][_0xbdb2f6(0x1b4)]({'where':{'id':_0x23b222['id']},'data':{'status':_0xbdb2f6(0x124),'updatedAt':new Date()}}),await database_1['default']['webhookLog']['create']({'data':{'paymentId':_0x23b222['id'],'shopId':_0x23b222[_0xbdb2f6(0x15d)],'event':_0xbdb2f6(0x12c),'statusCode':0xc8,'responseBody':JSON['stringify']({'reason':_0xbdb2f6(0x107)+this[_0xbdb2f6(0xff)]+_0xbdb2f6(0x196),'createdAt':_0x23b222[_0xbdb2f6(0xf2)],'expiredAt':new Date()['toISOString'](),'daysSinceCreation':Math[_0xbdb2f6(0x165)]((Date[_0xbdb2f6(0x1b1)]()-_0x23b222[_0xbdb2f6(0xf2)][_0xbdb2f6(0x16a)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0xbdb2f6(0xf6)](_0x23b222,_0xbdb2f6(0x124)),await this[_0xbdb2f6(0x115)](_0x23b222,_0xbdb2f6(0x124)),this['clearPaymentTimers'](_0x23b222['id']),_0x1b43fd[_0xbdb2f6(0x159)](_0x23b222['id']),console[_0xbdb2f6(0xdf)](_0xbdb2f6(0x141)+_0x23b222['id']+_0xbdb2f6(0x1a2)+this[_0xbdb2f6(0xff)]+'-day\x20timeout');}catch(_0x4a73b5){console['error'](_0xbdb2f6(0x12f)+_0x23b222['id']+':',_0x4a73b5),this[_0xbdb2f6(0x191)](_0x23b222['id'],_0x23b222[_0xbdb2f6(0x1c5)]||_0xbdb2f6(0x17e),_0x4a73b5,_0xbdb2f6(0xcd),{'reason':_0xbdb2f6(0x1ba),'createdAt':_0x23b222[_0xbdb2f6(0xf2)],'daysSinceCreation':Math[_0xbdb2f6(0x165)]((Date[_0xbdb2f6(0x1b1)]()-_0x23b222[_0xbdb2f6(0xf2)]['getTime']())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x1b43fd;}async[a48_0x355361(0xf4)](_0x28a984){const _0x45f4f1=a48_0x355361;if(!_0x28a984[_0x45f4f1(0x1c5)]){console[_0x45f4f1(0xdf)](_0x45f4f1(0x1c8)+_0x28a984['id']+'\x20has\x20no\x20gatewayPaymentId,\x20skipping');return;}console[_0x45f4f1(0xdf)](_0x45f4f1(0xe9)+_0x28a984[_0x45f4f1(0x14d)]+_0x45f4f1(0x14f)+_0x28a984['id']+'\x20('+_0x28a984[_0x45f4f1(0x1c5)]+')');try{let _0x43af52;_0x28a984[_0x45f4f1(0x14d)]==='cointopay2'?(_0x43af52=await this['coinToPay2Service'][_0x45f4f1(0xfd)](_0x28a984[_0x45f4f1(0x1c5)]),console[_0x45f4f1(0xdf)](_0x45f4f1(0x1b0)+_0x28a984['id']+_0x45f4f1(0xfe)+_0x43af52[_0x45f4f1(0x1bb)])):(_0x43af52=await this[_0x45f4f1(0x180)][_0x45f4f1(0xfd)](_0x28a984[_0x45f4f1(0x1c5)]),console[_0x45f4f1(0xdf)](_0x45f4f1(0x1cf)+_0x28a984['id']+'\x20status:\x20'+_0x43af52['status']));_0x43af52[_0x45f4f1(0x1d9)]&&console[_0x45f4f1(0xdf)](_0x45f4f1(0x193)+_0x28a984['id']+'\x20details:',{'iban':_0x43af52['paymentDetails']['iban']||_0x45f4f1(0x13d),'transactionId':_0x43af52[_0x45f4f1(0x1d9)][_0x45f4f1(0x152)],'createdOn':_0x43af52[_0x45f4f1(0x1d9)][_0x45f4f1(0x192)],'confirmedOn':_0x43af52[_0x45f4f1(0x1d9)][_0x45f4f1(0x1a3)]||'not\x20confirmed'});if(_0x43af52[_0x45f4f1(0x1bb)]!==_0x28a984[_0x45f4f1(0x1bb)]){console[_0x45f4f1(0xdf)](_0x45f4f1(0x1ce)+_0x28a984['id']+_0x45f4f1(0x172)+_0x28a984[_0x45f4f1(0x1bb)]+_0x45f4f1(0xf0)+_0x43af52[_0x45f4f1(0x1bb)]),this[_0x45f4f1(0x150)](_0x28a984['id'],_0x28a984[_0x45f4f1(0x1c5)],_0x28a984[_0x45f4f1(0x1bb)],_0x43af52['status'],_0x45f4f1(0xf7),{'paymentDetails':_0x43af52[_0x45f4f1(0x1d9)],'amount':_0x43af52[_0x45f4f1(0xfc)],'currency':_0x43af52[_0x45f4f1(0x116)],'shopId':_0x28a984['shopId'],'checkTimestamp':new Date()['toISOString']()});const _0x50e1d1={'status':_0x43af52[_0x45f4f1(0x1bb)],'updatedAt':new Date()};if(_0x43af52['status']===_0x45f4f1(0x1b5)&&_0x28a984['status']!==_0x45f4f1(0x1b5)){_0x50e1d1[_0x45f4f1(0x146)]=new Date();if(!_0x28a984[_0x45f4f1(0x12d)]){const _0x1b35f9=await currencyService_1[_0x45f4f1(0x174)][_0x45f4f1(0xc9)](_0x28a984[_0x45f4f1(0xfc)],_0x28a984[_0x45f4f1(0x116)]);_0x50e1d1[_0x45f4f1(0x12d)]=_0x1b35f9;const _0x330974=await this['getGatewayCommission'](_0x28a984[_0x45f4f1(0x15d)],_0x28a984['gateway']),_0x10f936=_0x1b35f9*(0x1-_0x330974/0x64);_0x50e1d1[_0x45f4f1(0x145)]=_0x10f936,_0x50e1d1[_0x45f4f1(0xed)]=_0x330974,console[_0x45f4f1(0xdf)](_0x45f4f1(0x154)+_0x28a984['id']+_0x45f4f1(0x194)),console['log'](_0x45f4f1(0x19f)+_0x28a984[_0x45f4f1(0xfc)]+'\x20'+_0x28a984[_0x45f4f1(0x116)]+_0x45f4f1(0x139)+_0x1b35f9[_0x45f4f1(0xd4)](0x6)+'\x20USDT'),console[_0x45f4f1(0xdf)]('\x20\x20\x20Gateway\x20'+_0x28a984[_0x45f4f1(0x14d)]+_0x45f4f1(0x113)+_0x330974+'%'),console[_0x45f4f1(0xdf)]('\x20\x20\x20Amount\x20after\x20commission:\x20'+_0x10f936[_0x45f4f1(0xd4)](0x6)+_0x45f4f1(0x166));}console[_0x45f4f1(0xdf)](_0x45f4f1(0x154)+_0x28a984['id']+_0x45f4f1(0xe1)+_0x50e1d1[_0x45f4f1(0x146)]['toISOString']());}if(_0x43af52[_0x45f4f1(0x1d9)]){const _0x40f2bd=_0x43af52[_0x45f4f1(0x1d9)];_0x40f2bd[_0x45f4f1(0x178)]&&(_0x50e1d1['remitterIban']=_0x40f2bd['iban'],console[_0x45f4f1(0xdf)]('üè¶\x20[CHECK]\x20Saved\x20IBAN:\x20'+_0x40f2bd[_0x45f4f1(0x178)])),_0x40f2bd['bankDetails']&&console[_0x45f4f1(0xdf)](_0x45f4f1(0x10d)+_0x40f2bd[_0x45f4f1(0x1c3)]),_0x40f2bd[_0x45f4f1(0x152)]&&console['log']('üÜî\x20[CHECK]\x20Transaction\x20ID:\x20'+_0x40f2bd[_0x45f4f1(0x152)]),_0x40f2bd[_0x45f4f1(0x1a3)]&&console[_0x45f4f1(0xdf)](_0x45f4f1(0x19b)+_0x40f2bd[_0x45f4f1(0x1a3)]);}await database_1[_0x45f4f1(0x181)][_0x45f4f1(0xd2)]['update']({'where':{'id':_0x28a984['id']},'data':_0x50e1d1});if(_0x43af52[_0x45f4f1(0x1bb)]===_0x45f4f1(0x1b5)&&_0x28a984[_0x45f4f1(0x1bb)]!==_0x45f4f1(0x1b5)){console[_0x45f4f1(0xdf)]('üìà\x20[COINTOPAY]\x20Payment\x20'+_0x28a984['id']+'\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link');const _0x4970bf=await database_1[_0x45f4f1(0x181)]['payment'][_0x45f4f1(0x1cb)]({'where':{'id':_0x28a984['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x4970bf?.['paymentLinkId']&&_0x4970bf['paymentLink'])try{const _0xfb9ada=_0x4970bf[_0x45f4f1(0x1c6)];console['log'](_0x45f4f1(0x142)+_0xfb9ada['id']+_0x45f4f1(0x1b2)+_0xfb9ada['type']+',\x20currentPayments='+_0xfb9ada[_0x45f4f1(0x14b)]+_0x45f4f1(0x17c)+_0xfb9ada[_0x45f4f1(0x1bb)]);const _0x103e4f=_0xfb9ada[_0x45f4f1(0x14b)]+0x1,_0x4b4894=_0xfb9ada[_0x45f4f1(0x1b3)]==='SINGLE'?_0x45f4f1(0xf1):_0xfb9ada[_0x45f4f1(0x1bb)];await database_1[_0x45f4f1(0x181)][_0x45f4f1(0x1c6)]['update']({'where':{'id':_0xfb9ada['id']},'data':{'currentPayments':_0x103e4f,'status':_0x4b4894,'updatedAt':new Date()}}),console[_0x45f4f1(0xdf)](_0x45f4f1(0x11a)+_0xfb9ada['id']+_0x45f4f1(0x18d)+_0xfb9ada[_0x45f4f1(0x14b)]+_0x45f4f1(0x139)+_0x103e4f+_0x45f4f1(0x17c)+_0xfb9ada[_0x45f4f1(0x1bb)]+'\x20->\x20'+_0x4b4894);}catch(_0x2ea9a8){console['error'](_0x45f4f1(0x185),_0x2ea9a8);}else console[_0x45f4f1(0xdf)]('üìà\x20[COINTOPAY]\x20Payment\x20'+_0x28a984['id']+'\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link');}await database_1['default'][_0x45f4f1(0x19d)]['create']({'data':{'paymentId':_0x28a984['id'],'shopId':_0x28a984['shopId'],'event':_0x45f4f1(0x1af)+_0x43af52[_0x45f4f1(0x1bb)][_0x45f4f1(0x1d2)](),'statusCode':0xc8,'responseBody':JSON[_0x45f4f1(0x13f)]({'oldStatus':_0x28a984[_0x45f4f1(0x1bb)],'newStatus':_0x43af52['status'],'paymentDetails':_0x43af52['paymentDetails'],'checkedAt':new Date()[_0x45f4f1(0x164)]()})}}),await this[_0x45f4f1(0xf6)](_0x28a984,_0x43af52['status']),await this[_0x45f4f1(0x115)](_0x28a984,_0x43af52[_0x45f4f1(0x1bb)]),_0x43af52[_0x45f4f1(0x1bb)]!==_0x45f4f1(0xdd)&&(console[_0x45f4f1(0xdf)]('üßπ\x20[CHECK]\x20Payment\x20'+_0x28a984['id']+_0x45f4f1(0x114)+_0x43af52[_0x45f4f1(0x1bb)]+_0x45f4f1(0x182)),this[_0x45f4f1(0x123)](_0x28a984['id'])),console['log'](_0x45f4f1(0xe8)+_0x28a984['id']+'\x20updated\x20successfully');}else console[_0x45f4f1(0xdf)](_0x45f4f1(0x193)+_0x28a984['id']+_0x45f4f1(0x197)+_0x43af52[_0x45f4f1(0x1bb)]+')'),this[_0x45f4f1(0x150)](_0x28a984['id'],_0x28a984[_0x45f4f1(0x1c5)],_0x28a984[_0x45f4f1(0x1bb)],_0x43af52[_0x45f4f1(0x1bb)],'status_check',{'statusUnchanged':!![],'paymentDetails':_0x43af52['paymentDetails'],'amount':_0x43af52[_0x45f4f1(0xfc)],'currency':_0x43af52[_0x45f4f1(0x116)],'shopId':_0x28a984['shopId'],'checkTimestamp':new Date()[_0x45f4f1(0x164)]()});}catch(_0x3b997b){console[_0x45f4f1(0x1be)](_0x45f4f1(0x187)+_0x28a984['id']+':',_0x3b997b),this[_0x45f4f1(0x191)](_0x28a984['id'],_0x28a984[_0x45f4f1(0x1c5)],_0x3b997b,_0x45f4f1(0xf7),{'paymentAmount':_0x28a984['amount'],'paymentCurrency':_0x28a984['currency'],'shopId':_0x28a984[_0x45f4f1(0x15d)],'createdAt':_0x28a984[_0x45f4f1(0xf2)]}),await database_1[_0x45f4f1(0x181)][_0x45f4f1(0x19d)][_0x45f4f1(0x1a8)]({'data':{'paymentId':_0x28a984['id'],'shopId':_0x28a984[_0x45f4f1(0x15d)],'event':_0x45f4f1(0x1bf),'statusCode':0x1f4,'responseBody':JSON[_0x45f4f1(0x13f)]({'error':_0x3b997b instanceof Error?_0x3b997b[_0x45f4f1(0x109)]:_0x45f4f1(0x17a),'gatewayPaymentId':_0x28a984['gatewayPaymentId'],'checkedAt':new Date()['toISOString']()})}});}}async[a48_0x355361(0xf6)](_0xcf7092,_0x522961){const _0x130f65=a48_0x355361,_0x241e49=Date['now']();try{const _0x194c4c=_0xcf7092[_0x130f65(0x136)],_0x468896=_0x194c4c[_0x130f65(0x147)];if(!_0x468896?.[_0x130f65(0x105)]){console[_0x130f65(0xdf)](_0x130f65(0x18a)+_0x194c4c['id']);return;}const _0x33c96c=_0x522961===_0x130f65(0x1b5)?_0x130f65(0x16d):_0x522961===_0x130f65(0x143)?'payment.failed':_0x522961==='EXPIRED'?_0x130f65(0x102):_0x130f65(0xcc);if(!_0x468896[_0x130f65(0x190)]?.[_0x130f65(0x112)](_0x33c96c)){console[_0x130f65(0xdf)](_0x130f65(0x129)+_0x33c96c+_0x130f65(0x15a)+_0x194c4c['id']);return;}const _0x5ed344=(0x0,gateway_1[_0x130f65(0x19a)])(_0xcf7092[_0x130f65(0x14d)])||_0xcf7092[_0x130f65(0x14d)],_0x24e685={'event':_0x33c96c,'payment':{'id':_0xcf7092['id'],'order_id':_0xcf7092[_0x130f65(0xe6)],'gateway_order_id':_0xcf7092['gatewayOrderId'],'gateway':_0x5ed344,'amount':_0xcf7092[_0x130f65(0xfc)],'currency':_0xcf7092[_0x130f65(0x116)],'status':_0x522961['toLowerCase'](),'customer_email':_0xcf7092[_0x130f65(0x140)],'customer_name':_0xcf7092[_0x130f65(0x161)],'created_at':_0xcf7092['createdAt'],'updated_at':new Date()}},_0x18d767=await fetch(_0x468896[_0x130f65(0x105)],{'method':_0x130f65(0x1d1),'headers':{'Content-Type':_0x130f65(0xe5),'User-Agent':_0x130f65(0x148)},'body':JSON[_0x130f65(0x13f)](_0x24e685)}),_0x40e95b=Date[_0x130f65(0x1b1)]()-_0x241e49,_0x39ff04=_0x18d767['ok']?_0x130f65(0x12b):await _0x18d767['text']();loggerService_1[_0x130f65(0x1c1)][_0x130f65(0x163)](_0xcf7092[_0x130f65(0x15d)],_0x468896[_0x130f65(0x105)],_0x33c96c,_0x18d767[_0x130f65(0x1bb)],_0x40e95b,_0x24e685),console['log'](_0x130f65(0x127)+_0x468896[_0x130f65(0x105)]+_0x130f65(0x1b7)+_0x18d767[_0x130f65(0x1bb)]+'\x20('+_0x40e95b+_0x130f65(0x1d3));}catch(_0x2b2cd5){console['error']('Failed\x20to\x20send\x20shop\x20webhook:',_0x2b2cd5),loggerService_1[_0x130f65(0x1c1)][_0x130f65(0x1c7)](_0xcf7092['shopId'],_0xcf7092[_0x130f65(0x136)]?.['settings']?.[_0x130f65(0x105)]||_0x130f65(0x17e),'webhook_send',_0x2b2cd5,{});}}async['sendPaymentStatusNotification'](_0x4c2391,_0x467f55){const _0x2664a5=a48_0x355361;try{const _0x52636c={'PENDING':_0x2664a5(0x16c),'PAID':_0x2664a5(0x1b6),'FAILED':_0x2664a5(0x13b),'EXPIRED':_0x2664a5(0x11f)},_0x37cbfd=_0x52636c[_0x467f55];if(!_0x37cbfd||_0x37cbfd===_0x2664a5(0x16c))return;await telegramBotService_1[_0x2664a5(0x19c)][_0x2664a5(0x1c0)](_0x4c2391[_0x2664a5(0x15d)],_0x4c2391,_0x37cbfd);}catch(_0x2e9c38){console[_0x2664a5(0x1be)](_0x2664a5(0x1a5),_0x2e9c38);}}async[a48_0x355361(0xe2)](_0x81a84b){const _0xdd7278=a48_0x355361;console[_0xdd7278(0xdf)]('üîç\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20'+_0x81a84b);const _0x254a6f=await database_1[_0xdd7278(0x181)][_0xdd7278(0xd2)][_0xdd7278(0x1cb)]({'where':{'id':_0x81a84b},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x254a6f)throw new Error(_0xdd7278(0x13e));if(_0x254a6f[_0xdd7278(0x14d)]!==_0xdd7278(0x1cc)&&_0x254a6f[_0xdd7278(0x14d)]!==_0xdd7278(0x17d))throw new Error('Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment');console[_0xdd7278(0xdf)](_0xdd7278(0x156)+_0x254a6f['gateway']+_0xdd7278(0x14f)+_0x81a84b),await this['checkSinglePayment'](_0x254a6f),console[_0xdd7278(0xdf)](_0xdd7278(0x186)+_0x81a84b);}['getServiceStats'](){const _0x420dd8=a48_0x355361,_0x535817=this[_0x420dd8(0x195)]?this['GLOBAL_CHECK_INTERVAL_MS']:undefined,_0xbbb1ff=Array[_0x420dd8(0x12e)](this['paymentTimers'][_0x420dd8(0x132)]())[_0x420dd8(0x160)](_0x5b2f3c=>({'paymentId':_0x5b2f3c[_0x420dd8(0x179)],'gatewayPaymentId':_0x5b2f3c['gatewayPaymentId'],'createdAt':_0x5b2f3c[_0x420dd8(0xf2)],'timersCount':_0x5b2f3c['timers'][_0x420dd8(0x13a)]}));return{'isActive':!!this[_0x420dd8(0x195)],'globalCheckIntervalMinutes':this[_0x420dd8(0x122)]/(0x3e8*0x3c),'expiryDays':this[_0x420dd8(0xff)],'activeIndividualTimers':this[_0x420dd8(0xd8)][_0x420dd8(0x1c4)],'nextGlobalCheckIn':_0x535817,'paymentTimersDetails':_0xbbb1ff};}[a48_0x355361(0x14c)](_0x517168){const _0x145b9c=a48_0x355361,_0xc9ae0d=this[_0x145b9c(0xd8)]['get'](_0x517168);if(_0xc9ae0d)return{'hasTimers':!![],'timersCount':_0xc9ae0d[_0x145b9c(0x144)][_0x145b9c(0x13a)],'createdAt':_0xc9ae0d[_0x145b9c(0xf2)],'gatewayPaymentId':_0xc9ae0d[_0x145b9c(0x1c5)]};return{'hasTimers':![]};}async['getGatewayCommission'](_0x13b254,_0x11febf){const _0x4bbc02=a48_0x355361;try{const _0x24f72d=await database_1[_0x4bbc02(0x181)][_0x4bbc02(0x136)][_0x4bbc02(0x1cb)]({'where':{'id':_0x13b254},'select':{'gatewaySettings':!![]}});if(!_0x24f72d?.['gatewaySettings'])return console['log'](_0x4bbc02(0x128)+_0x13b254+',\x20using\x20default\x20commission\x2010%'),0xa;const _0xe396e7=JSON[_0x4bbc02(0xe0)](_0x24f72d['gatewaySettings']);for(const [_0x40ed99,_0x543d09]of Object[_0x4bbc02(0x1bd)](_0xe396e7)){if(_0x40ed99[_0x4bbc02(0x1d2)]()===_0x11febf[_0x4bbc02(0x1d2)]()){const _0x1d71e6=_0x543d09[_0x4bbc02(0xea)]||0xa;return console[_0x4bbc02(0xdf)](_0x4bbc02(0x15e)+_0x11febf+_0x4bbc02(0xe4)+_0x13b254+':\x20'+_0x1d71e6+'%'),_0x1d71e6;}}return console['log']('No\x20specific\x20commission\x20found\x20for\x20gateway\x20'+_0x11febf+_0x4bbc02(0x188)+_0x13b254+_0x4bbc02(0xd5)),0xa;}catch(_0x274d4d){return console['error'](_0x4bbc02(0x18b)+_0x13b254+',\x20gateway\x20'+_0x11febf+':',_0x274d4d),0xa;}}}exports['CoinToPayStatusService']=CoinToPayStatusService,exports[a48_0x355361(0x177)]=new CoinToPayStatusService();