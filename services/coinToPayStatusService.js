'use strict';function a57_0x52f9(_0x5a5fab,_0x477eb9){_0x5a5fab=_0x5a5fab-0x184;const _0x3f827e=a57_0x3f82();let _0x52f96f=_0x3f827e[_0x5a5fab];return _0x52f96f;}const a57_0x387c28=a57_0x52f9;(function(_0x297ea3,_0x52a71c){const _0x154da5=a57_0x52f9,_0x244041=_0x297ea3();while(!![]){try{const _0x5c42c0=-parseInt(_0x154da5(0x253))/0x1+-parseInt(_0x154da5(0x219))/0x2+-parseInt(_0x154da5(0x1d0))/0x3*(parseInt(_0x154da5(0x290))/0x4)+-parseInt(_0x154da5(0x1ac))/0x5+-parseInt(_0x154da5(0x1e8))/0x6*(parseInt(_0x154da5(0x1d5))/0x7)+parseInt(_0x154da5(0x1dd))/0x8*(-parseInt(_0x154da5(0x1ab))/0x9)+parseInt(_0x154da5(0x284))/0xa;if(_0x5c42c0===_0x52a71c)break;else _0x244041['push'](_0x244041['shift']());}catch(_0x1f3902){_0x244041['push'](_0x244041['shift']());}}}(a57_0x3f82,0x6aff7));var __importDefault=this&&this[a57_0x387c28(0x208)]||function(_0x27ff94){return _0x27ff94&&_0x27ff94['__esModule']?_0x27ff94:{'default':_0x27ff94};};Object['defineProperty'](exports,a57_0x387c28(0x19b),{'value':!![]}),exports[a57_0x387c28(0x266)]=exports[a57_0x387c28(0x27d)]=void 0x0;const crypto_1=__importDefault(require('crypto')),coinToPayService_1=require(a57_0x387c28(0x212)),coinToPay2Service_1=require(a57_0x387c28(0x1de)),gateway_1=require(a57_0x387c28(0x225)),database_1=__importDefault(require(a57_0x387c28(0x265))),telegramBotService_1=require('./telegramBotService'),loggerService_1=require(a57_0x387c28(0x1d3)),currencyService_1=require(a57_0x387c28(0x276));function a57_0x3f82(){const _0x206cff=['gatewayPaymentId','\x20to\x20clear','\x20\x20\x20Amount:\x20','gateway','ms)','\x20pending\x20CoinToPay\x20payments','üìä\x20[CHECK]\x20CoinToPay\x20payment\x20','expired','type','convertToUSDT','‚úÖ\x20[MANUAL]\x20Manual\x20check\x20completed\x20for\x20payment\x20','ü™ô\x20[INIT]\x20Starting\x20CoinToPay\x20periodic\x20status\x20checking\x20(global\x20checks\x20every\x201\x20hour)','\x20marked\x20as\x20paid\x20at:\x20','‚ùå\x20[TIMER]\x20Failed\x20individual\x20check\x20#','\x20updated\x20successfully','üßπ\x20[CHECK]\x20Payment\x20','checkPaymentById','\x20days','COMPLETED','‚ùå\x20[COINTOPAY]\x20Failed\x20to\x20update\x20payment\x20link:','‚úÖ\x20[HOURLY]\x20Payment\x20','üßπ\x20[DEBUG]\x20Clearing\x20','\x20found:','‚ùå\x20[INIT]\x20Initial\x20CoinToPay\x20status\x20check\x20failed:','SINGLE','\x20has\x20no\x20gatewayPaymentId','\x20USDT','‚ö†Ô∏è\x20[CHECK]\x20Payment\x20','\x20initial\x20timers\x20for\x20payment\x20','\x20\x20\x20üìù\x20Details:','No\x20webhook\x20URL\x20configured\x20for\x20shop\x20','159sQncxp','\x20for\x20payment\x20','üè¶\x20[CHECK]\x20Saved\x20IBAN:\x20','./loggerService','‚è∞\x20[EXPIRY]\x20Checking\x20for\x20CoinToPay\x20payments\x20older\x20than\x20','21YvOmUs','\x20\x20\x20‚ùå\x20Error:\x20','gatewayCommissionRate','\x20\x20\x20üìä\x20Status:\x20','findUnique','webhookEvents','üìä\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','amountAfterGatewayCommissionUSDT','792QvQbtW','./gateways/coinToPay2Service','ü™ô\x20[GLOBAL]\x20Found\x20','logShopWebhookError','‚ùå\x20[HOURLY]\x20Payment\x20','payment','globalCheckInterval','values','default','floor','currency','951996aycQbs','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20check\x20CoinToPay\x20payment\x20','push','now','\x20seconds\x20(','‚ùå\x20[EXPIRY]\x20Failed\x20to\x20expire\x20payment\x20','loggerService','amountUSDT','ü™ô\x20[GLOBAL]\x20Starting\x20global\x20check\x20cycle...','map','getGatewayIdByName','‚è∞\x20[DEBUG]\x20Scheduled\x20check\x20#','ü™ô\x20[TIMER]\x20Individual\x20check\x20#','coinToPayService','üîç\x20[CHECK]\x20Checking\x20','sendPaymentNotification','timers','payment.success','commission','FAILED','\x20is\x20too\x20new\x20(','\x20\x20\x20Gateway\x20','üõë\x20[SHUTDOWN]\x20CoinToPay\x20global\x20status\x20checking\x20stopped','set','\x20\x20\x20-\x20gatewayPaymentId:\x20','clearPaymentTimers','telegramBotService','\x20(age:\x20','h),\x20skipping\x20global\x20check','\x20\x20\x20-\x20paymentId:\x20','üè¶\x20[CHECK]\x20Bank\x20details\x20provided:\x20','toFixed','__importDefault','Success','\x20in\x20','cointopay2','sendPaymentStatusNotification','\x20not\x20found\x20in\x20database','forEach','paymentDetails','sendShopWebhook','remitterIban','./gateways/coinToPayService','Payment\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment','gatewaySettings','Failed\x20to\x20send\x20Telegram\x20payment\x20notification:','message','/status/','\x20completed\x20for\x20payment\x20','165386bIuRkz','catch','currentPayments','\x20already\x20marked\x20as\x20expired,\x20skipping\x20global\x20check','üìä\x20[CHECK]\x20Payment\x20','has','delay','paid','Failed\x20to\x20send\x20shop\x20webhook:','created',',\x20stopping\x20individual\x20checks','\x20\x20\x20-\x20Status:\x20','../types/gateway','customerEmail','stopPeriodicStatusCheck','webhook_send','‚úÖ\x20[EXPIRY]\x20Payment\x20','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20cycle\x20completed','cointopay','1\x20minute','length','\x20is\x20not\x20a\x20CoinToPay/CoinToPay2\x20payment\x20(gateway:\x20','schedulePaymentChecks','paidAt','findMany','\x20payment\x20','\x20days,\x20marking\x20as\x20EXPIRED','‚úÖ\x20[TIMER]\x20Individual\x20check\x20#','status','Payment\x20older\x20than\x20','coinToPay2Service','GLOBAL_CHECK_INTERVAL_MS','getServiceStats','\x20not\x20enabled\x20for\x20shop\x20','PAID','getGatewayCommission','stack','sha256','\x20status\x20is\x20','checkExpiredPayments','‚è∞\x20[GLOBAL]\x20Payment\x20','‚úÖ\x20[CHECK]\x20Payment\x20','not\x20confirmed','status_check','payment.pending','üí∞\x20[CHECK]\x20Payment\x20','paymentTimers','createHmac','EXPIRED','bankDetails','üìà\x20[COINTOPAY]\x20Payment\x20','üîç\x20[GLOBAL]\x20Checking\x20old\x20payment\x20','stringify','‚ö†Ô∏è\x20[DEBUG]\x20No\x20timers\x20found\x20for\x20payment\x20','amount',',\x20using\x20default\x20commission\x2010%','customerName','\x20status\x20changed\x20to\x20','855167BafyOJ',',\x20status=','hex','Shop\x20webhook\x20sent\x20to\x20','\x20current\x20status:\x20','ü™ô\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:','‚è∞\x20[GLOBAL]\x20Found\x20',',\x20currentPayments=','delete','‚úÖ\x20[INIT]\x20CoinToPay\x20status\x20checking\x20service\x20started\x20(global\x20hourly\x20checks\x20+\x20individual\x20payment\x20timers)','confirmedOn','EXPIRY_DAYS','createdAt','webhookUrl','get','-day\x20timeout','checkSinglePaymentById','shop','../config/database','coinToPayStatusService','shopId','üîç\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','includes','üîÑ\x20[CHECK]\x20Updating\x20payment\x20','paymentLink','Payment\x20System/1.0','üõë\x20[SHUTDOWN]\x20Cleared\x20',',\x20using\x20default\x2010%','‚úÖ\x20[GLOBAL]\x20Global\x20check\x20completed:\x20','gatewayOrderId','description','create','paymentLinkId','log','No\x20gateway\x20settings\x20found\x20for\x20shop\x20','./currencyService','\x20is\x20older\x20than\x20','‚úÖ\x20[MANUAL]\x20Starting\x20manual\x20check\x20for\x20','\x20not\x20found,\x20clearing\x20timers','\x20commission:\x20','\x20days,\x20will\x20be\x20handled\x20by\x20global\x20expiry\x20check','getPaymentTimerInfo','CoinToPayStatusService','\x20details:','error','checkAllPendingPayments','getTime','POST','timestamp','31208520gaDyOp','\x20commission\x20for\x20shop\x20','\x20status:\x20','\x20timers\x20for\x20payment\x20','\x20\x20\x20-\x20Amount:\x20','webhookLog','checkSinglePayment','üõë\x20[SHUTDOWN]\x20Stopping\x20CoinToPay\x20status\x20checking\x20service...','‚úÖ\x20[DEBUG]\x20Successfully\x20scheduled\x20','\x20\x20\x20üìù\x20Context:','transactionId','digest','24712yRWqiI','Payment\x20not\x20found','\x20expired','toLowerCase','paymentId','‚è∞\x20[HOURLY]\x20Payment\x20','auto_expire','COINTOPAY_STATUS_CHANGE','\x20->\x20','ü™ô\x20CoinToPayStatusService\x20initialized\x20with\x20support\x20for\x20both\x20CoinToPay\x20and\x20CoinToPay2','ü™ô\x20[GLOBAL]\x20No\x20pending\x20CoinToPay\x20payments\x20to\x20check','\x20\x20\x20-\x20ShopId:\x20','‚ùå\x20[GLOBAL]\x20Failed\x20to\x20get\x20pending\x20CoinToPay\x20payments:','üßπ\x20[DEBUG]\x20Cleared\x20timer\x20#','PENDING','ü™ô\x20[ERROR]\x20CoinToPay\x20Error:\x20','size','‚ùå\x20[CHECK]\x20Failed\x20to\x20check\x20payment\x20','createdOn','‚úÖ\x20[HOURLY]\x20Hourly\x20check\x20completed\x20for\x20payment\x20','toISOString','\x20in\x20shop\x20','logCoinToPayError','logCoinToPayStatus','Webhook\x20event\x20','iban','startPeriodicStatusCheck','__esModule','\x20\x20\x20-\x20GatewayPaymentId:\x20','\x20has\x20no\x20gatewayPaymentId,\x20skipping','currencyService','\x20individual\x20payment\x20timers',',\x20clearing\x20individual\x20timers','unknown','\x20status\x20from\x20','\x20\x20\x20üìç\x20Source:\x20','‚úÖ\x20[CHECK]\x20Transaction\x20confirmed\x20on:\x20','\x20is\x20not\x20linked\x20to\x20a\x20payment\x20link','\x20is\x20valid\x20for\x20checking,\x20proceeding...','ü™ô\x20[LOG]\x20CoinToPay\x20Status\x20Change:\x20','update','logShopWebhookSent','payment.failed','8595RfPWnc','4233760xWMFYh','‚úÖ\x20[COINTOPAY]\x20Payment\x20link\x20','\x20checked,\x20','entries','settings'];a57_0x3f82=function(){return _0x206cff;};return a57_0x3f82();}class CoinToPayStatusService{constructor(){const _0x44dc95=a57_0x387c28;this[_0x44dc95(0x1e3)]=null,this[_0x44dc95(0x238)]=0x3c*0x3c*0x3e8,this[_0x44dc95(0x25e)]=0x5,this[_0x44dc95(0x247)]=new Map(),this[_0x44dc95(0x1f5)]=new coinToPayService_1['CoinToPayService'](),this[_0x44dc95(0x237)]=new coinToPay2Service_1['CoinToPay2Service'](),console['log'](_0x44dc95(0x189));}[a57_0x387c28(0x22f)](_0x2a6e23,_0xada0be){const _0x372712=a57_0x387c28;console['log'](_0x372712(0x258)),console['log'](_0x372712(0x205)+_0x2a6e23),console[_0x372712(0x274)](_0x372712(0x200)+_0xada0be),this['clearPaymentTimers'](_0x2a6e23);const _0x5995f3=[],_0x11b1d9=new Date(),_0x22b8a8=[{'delay':0x1*0x3c*0x3e8,'description':_0x372712(0x22c)},{'delay':0x2*0x3c*0x3e8,'description':'2\x20minutes'},{'delay':0x5*0x3c*0x3e8,'description':'5\x20minutes'},{'delay':0x5*0x3c*0x3e8,'description':'5\x20minutes'}];console['log']('ü™ô\x20[DEBUG]\x20Creating\x20'+_0x22b8a8[_0x372712(0x22d)]+_0x372712(0x1cd)+_0x2a6e23);let _0x55404b=0x0;_0x22b8a8['forEach']((_0x241e3d,_0x41c1c6)=>{const _0x489005=_0x372712;_0x55404b+=_0x241e3d[_0x489005(0x21f)];const _0x1d2486=setTimeout(async()=>{const _0x767f73=_0x489005;console['log'](_0x767f73(0x1f4)+(_0x41c1c6+0x1)+'\x20triggered\x20for\x20payment\x20'+_0x2a6e23+'\x20(after\x20'+_0x241e3d[_0x767f73(0x271)]+')');try{await this[_0x767f73(0x263)](_0x2a6e23),console['log'](_0x767f73(0x234)+(_0x41c1c6+0x1)+_0x767f73(0x218)+_0x2a6e23);}catch(_0x251f66){console[_0x767f73(0x27f)](_0x767f73(0x1be)+(_0x41c1c6+0x1)+_0x767f73(0x1d1)+_0x2a6e23+':',_0x251f66),this[_0x767f73(0x196)](_0x2a6e23,_0xada0be,_0x251f66,_0x767f73(0x244),{'checkNumber':_0x41c1c6+0x1,'scheduledAfter':_0x241e3d[_0x767f73(0x271)],'isIndividualCheck':!![]});}},_0x55404b);_0x5995f3[_0x489005(0x1ea)](_0x1d2486),console[_0x489005(0x274)](_0x489005(0x1f3)+(_0x41c1c6+0x1)+_0x489005(0x1d1)+_0x2a6e23+_0x489005(0x20a)+_0x55404b/0x3e8+_0x489005(0x1ec)+_0x241e3d[_0x489005(0x271)]+')');});const _0x8f6d44=setInterval(async()=>{const _0x9e00d0=_0x372712;console[_0x9e00d0(0x274)]('ü™ô\x20[HOURLY]\x20Hourly\x20check\x20triggered\x20for\x20payment\x20'+_0x2a6e23);try{const _0xd81718=await database_1['default'][_0x9e00d0(0x1e2)][_0x9e00d0(0x1d9)]({'where':{'id':_0x2a6e23},'select':{'id':!![],'status':!![],'createdAt':!![],'gatewayPaymentId':!![]}});if(!_0xd81718){console[_0x9e00d0(0x274)](_0x9e00d0(0x1e1)+_0x2a6e23+_0x9e00d0(0x279)),this['clearPaymentTimers'](_0x2a6e23);return;}console[_0x9e00d0(0x274)]('üìä\x20[HOURLY]\x20Payment\x20'+_0x2a6e23+_0x9e00d0(0x257)+_0xd81718['status']);if(_0xd81718[_0x9e00d0(0x235)]!==_0x9e00d0(0x18e)){console['log'](_0x9e00d0(0x1c5)+_0x2a6e23+_0x9e00d0(0x23f)+_0xd81718[_0x9e00d0(0x235)]+_0x9e00d0(0x223)),this[_0x9e00d0(0x201)](_0x2a6e23);return;}const _0x459246=Math['floor']((Date[_0x9e00d0(0x1eb)]()-_0xd81718[_0x9e00d0(0x25f)][_0x9e00d0(0x281)]())/(0x3e8*0x3c*0x3c*0x18));if(_0x459246>=this[_0x9e00d0(0x25e)]){console[_0x9e00d0(0x274)](_0x9e00d0(0x185)+_0x2a6e23+_0x9e00d0(0x277)+this[_0x9e00d0(0x25e)]+_0x9e00d0(0x27b)),this[_0x9e00d0(0x201)](_0x2a6e23);return;}await this[_0x9e00d0(0x263)](_0x2a6e23),console[_0x9e00d0(0x274)](_0x9e00d0(0x193)+_0x2a6e23);}catch(_0x185b74){console[_0x9e00d0(0x27f)]('‚ùå\x20[HOURLY]\x20Failed\x20hourly\x20check\x20for\x20payment\x20'+_0x2a6e23+':',_0x185b74),this[_0x9e00d0(0x196)](_0x2a6e23,_0xada0be,_0x185b74,_0x9e00d0(0x244),{'isHourlyCheck':!![],'isIndividualCheck':!![]});}},0x3c*0x3c*0x3e8);_0x5995f3['push'](_0x8f6d44),this[_0x372712(0x247)][_0x372712(0x1ff)](_0x2a6e23,{'timers':_0x5995f3,'paymentId':_0x2a6e23,'gatewayPaymentId':_0xada0be,'createdAt':_0x11b1d9}),console[_0x372712(0x274)](_0x372712(0x28c)+_0x22b8a8[_0x372712(0x22d)]+'\x20initial\x20checks\x20+\x20hourly\x20checks\x20for\x20payment\x20'+_0x2a6e23),console['log'](_0x372712(0x1db)+this[_0x372712(0x247)][_0x372712(0x190)]),this['logCoinToPayStatus'](_0x2a6e23,_0xada0be,_0x372712(0x18e),_0x372712(0x18e),_0x372712(0x244),{'action':'schedule_created','scheduledChecks':_0x22b8a8['length'],'firstCheckIn':_0x22b8a8[0x0][_0x372712(0x21f)]/0x3e8,'totalTimers':this[_0x372712(0x247)]['size']});}[a57_0x387c28(0x201)](_0x4bac2c){const _0x151ac8=a57_0x387c28,_0x37b7e6=this[_0x151ac8(0x247)][_0x151ac8(0x261)](_0x4bac2c);_0x37b7e6?(console[_0x151ac8(0x274)](_0x151ac8(0x1c6)+_0x37b7e6['timers'][_0x151ac8(0x22d)]+_0x151ac8(0x287)+_0x4bac2c),_0x37b7e6[_0x151ac8(0x1f8)][_0x151ac8(0x20e)]((_0x19eb62,_0x2c444f)=>{const _0x29cdbd=_0x151ac8;_0x19eb62&&(clearTimeout(_0x19eb62),clearInterval(_0x19eb62),console[_0x29cdbd(0x274)](_0x29cdbd(0x18d)+(_0x2c444f+0x1)+_0x29cdbd(0x1d1)+_0x4bac2c));}),this['paymentTimers'][_0x151ac8(0x25b)](_0x4bac2c),console['log']('‚úÖ\x20[DEBUG]\x20All\x20timers\x20cleared\x20for\x20payment\x20'+_0x4bac2c+'.\x20Remaining\x20active\x20timers:\x20'+this[_0x151ac8(0x247)][_0x151ac8(0x190)])):console['log'](_0x151ac8(0x24e)+_0x4bac2c+_0x151ac8(0x1b2));}async[a57_0x387c28(0x263)](_0x3afeda){const _0xc8a1f0=a57_0x387c28;console[_0xc8a1f0(0x274)](_0xc8a1f0(0x268)+_0x3afeda);const _0x12bd0d=await database_1[_0xc8a1f0(0x1e5)][_0xc8a1f0(0x1e2)]['findUnique']({'where':{'id':_0x3afeda},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x12bd0d){console[_0xc8a1f0(0x274)]('‚ùå\x20[CHECK]\x20Payment\x20'+_0x3afeda+_0xc8a1f0(0x20d));return;}console[_0xc8a1f0(0x274)](_0xc8a1f0(0x21d)+_0x3afeda+_0xc8a1f0(0x1c7)),console[_0xc8a1f0(0x274)]('\x20\x20\x20-\x20Gateway:\x20'+_0x12bd0d[_0xc8a1f0(0x1b4)]),console[_0xc8a1f0(0x274)](_0xc8a1f0(0x224)+_0x12bd0d[_0xc8a1f0(0x235)]),console[_0xc8a1f0(0x274)](_0xc8a1f0(0x19c)+_0x12bd0d[_0xc8a1f0(0x1b1)]),console[_0xc8a1f0(0x274)](_0xc8a1f0(0x288)+_0x12bd0d[_0xc8a1f0(0x24f)]+'\x20'+_0x12bd0d[_0xc8a1f0(0x1e7)]),console[_0xc8a1f0(0x274)](_0xc8a1f0(0x18b)+_0x12bd0d[_0xc8a1f0(0x267)]);if(_0x12bd0d[_0xc8a1f0(0x1b4)]!=='cointopay'&&_0x12bd0d[_0xc8a1f0(0x1b4)]!=='cointopay2'){console[_0xc8a1f0(0x274)](_0xc8a1f0(0x1cc)+_0x3afeda+_0xc8a1f0(0x22e)+_0x12bd0d[_0xc8a1f0(0x1b4)]+')');return;}if(_0x12bd0d[_0xc8a1f0(0x235)]!==_0xc8a1f0(0x18e)){console[_0xc8a1f0(0x274)](_0xc8a1f0(0x1cc)+_0x3afeda+_0xc8a1f0(0x23f)+_0x12bd0d[_0xc8a1f0(0x235)]+',\x20stopping\x20individual\x20checks'),this['clearPaymentTimers'](_0x3afeda);return;}if(!_0x12bd0d[_0xc8a1f0(0x1b1)]){console[_0xc8a1f0(0x274)](_0xc8a1f0(0x1cc)+_0x3afeda+_0xc8a1f0(0x1ca));return;}console[_0xc8a1f0(0x274)](_0xc8a1f0(0x242)+_0x3afeda+_0xc8a1f0(0x1a6)),await this[_0xc8a1f0(0x28a)](_0x12bd0d);}[a57_0x387c28(0x197)](_0x2a9467,_0x5c5e05,_0xd460d2,_0x2c3625,_0x2f26ce,_0x2eaf2e){const _0x349b42=a57_0x387c28,_0x5d7558={'type':_0x349b42(0x187),'paymentId':_0x2a9467,'gatewayPaymentId':_0x5c5e05,'oldStatus':_0xd460d2,'newStatus':_0x2c3625,'source':_0x2f26ce,'timestamp':new Date()[_0x349b42(0x194)](),'details':_0x2eaf2e||{}};loggerService_1[_0x349b42(0x1ee)]['logCoinToPayStatus'](_0x5d7558),console[_0x349b42(0x274)](_0x349b42(0x1a7)+_0x2a9467+'\x20('+_0x5c5e05+')'),console['log'](_0x349b42(0x1d8)+_0xd460d2+_0x349b42(0x188)+_0x2c3625),console[_0x349b42(0x274)](_0x349b42(0x1a3)+_0x2f26ce),console[_0x349b42(0x274)]('\x20\x20\x20üìÖ\x20Time:\x20'+_0x5d7558[_0x349b42(0x283)]),_0x2eaf2e&&console[_0x349b42(0x274)](_0x349b42(0x1ce),_0x2eaf2e);}['logCoinToPayError'](_0x47a6be,_0x3efafd,_0x2dd45b,_0x43cc77,_0x3b82f3){const _0x229029=a57_0x387c28,_0x321f96={'type':'COINTOPAY_ERROR','paymentId':_0x47a6be,'gatewayPaymentId':_0x3efafd,'error':_0x2dd45b instanceof Error?{'message':_0x2dd45b[_0x229029(0x216)],'stack':_0x2dd45b[_0x229029(0x23d)]}:_0x2dd45b,'source':_0x43cc77,'timestamp':new Date()['toISOString'](),'context':_0x3b82f3||{}};loggerService_1['loggerService'][_0x229029(0x196)](_0x321f96),console[_0x229029(0x27f)](_0x229029(0x18f)+_0x47a6be+'\x20('+_0x3efafd+')'),console[_0x229029(0x27f)](_0x229029(0x1d6)+(_0x2dd45b instanceof Error?_0x2dd45b[_0x229029(0x216)]:_0x2dd45b)),console[_0x229029(0x27f)](_0x229029(0x1a3)+_0x43cc77),console[_0x229029(0x27f)]('\x20\x20\x20üìÖ\x20Time:\x20'+_0x321f96['timestamp']),_0x3b82f3&&console[_0x229029(0x27f)](_0x229029(0x28d),_0x3b82f3);}[a57_0x387c28(0x19a)](){const _0x4000fd=a57_0x387c28;console['log'](_0x4000fd(0x1bc)),this[_0x4000fd(0x280)]()[_0x4000fd(0x21a)](_0x53cc28=>{const _0xba65d9=_0x4000fd;console[_0xba65d9(0x27f)](_0xba65d9(0x1c8),_0x53cc28);}),this['globalCheckInterval']=setInterval(async()=>{const _0x4359ae=_0x4000fd;try{console[_0x4359ae(0x274)](_0x4359ae(0x1f0)),await this[_0x4359ae(0x280)](),console[_0x4359ae(0x274)](_0x4359ae(0x22a));}catch(_0x83609d){console[_0x4359ae(0x27f)]('‚ùå\x20[GLOBAL]\x20Periodic\x20CoinToPay\x20status\x20check\x20failed:',_0x83609d);}},this[_0x4000fd(0x238)]),console[_0x4000fd(0x274)](_0x4000fd(0x25c));}[a57_0x387c28(0x227)](){const _0x35daaa=a57_0x387c28;console[_0x35daaa(0x274)](_0x35daaa(0x28b));this[_0x35daaa(0x1e3)]&&(clearInterval(this[_0x35daaa(0x1e3)]),this[_0x35daaa(0x1e3)]=null,console[_0x35daaa(0x274)](_0x35daaa(0x1fe)));const _0x559235=this[_0x35daaa(0x247)][_0x35daaa(0x190)];for(const [_0x2ad2bb]of this['paymentTimers']){this[_0x35daaa(0x201)](_0x2ad2bb);}console[_0x35daaa(0x274)](_0x35daaa(0x26d)+_0x559235+_0x35daaa(0x19f));}async[a57_0x387c28(0x280)](){const _0x23c4bd=a57_0x387c28;try{console['log']('ü™ô\x20[GLOBAL]\x20Getting\x20all\x20pending\x20CoinToPay\x20payments...');const _0x5db90c=await database_1[_0x23c4bd(0x1e5)][_0x23c4bd(0x1e2)][_0x23c4bd(0x231)]({'where':{'gateway':{'in':[_0x23c4bd(0x22b),'cointopay2']},'status':_0x23c4bd(0x18e),'gatewayPaymentId':{'not':null}},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'remitterIban':!![],'customerIp':!![],'customerUa':!![],'shop':{'select':{'id':!![],'name':!![],'secretKey':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});console['log'](_0x23c4bd(0x1df)+_0x5db90c['length']+_0x23c4bd(0x1b6));if(_0x5db90c[_0x23c4bd(0x22d)]===0x0){console['log'](_0x23c4bd(0x18a));return;}const _0x4283aa=await this[_0x23c4bd(0x240)](_0x5db90c);console[_0x23c4bd(0x274)](_0x23c4bd(0x259)+_0x4283aa['length']+'\x20expired\x20CoinToPay\x20payments');let _0x167da3=0x0,_0x286f86=0x0;for(const _0x2f7c38 of _0x5db90c){try{if(_0x4283aa[_0x23c4bd(0x269)](_0x2f7c38['id'])){console['log']('‚è∞\x20[GLOBAL]\x20Payment\x20'+_0x2f7c38['id']+_0x23c4bd(0x21c)),_0x286f86++;continue;}if(this[_0x23c4bd(0x247)][_0x23c4bd(0x21e)](_0x2f7c38['id'])){console['log'](_0x23c4bd(0x241)+_0x2f7c38['id']+'\x20has\x20individual\x20timers,\x20skipping\x20global\x20check'),_0x286f86++;continue;}const _0x13eec0=(Date['now']()-_0x2f7c38['createdAt'][_0x23c4bd(0x281)]())/(0x3e8*0x3c*0x3c);if(_0x13eec0<0x1){console[_0x23c4bd(0x274)](_0x23c4bd(0x241)+_0x2f7c38['id']+_0x23c4bd(0x1fc)+_0x13eec0['toFixed'](0x1)+_0x23c4bd(0x204)),_0x286f86++;continue;}console[_0x23c4bd(0x274)](_0x23c4bd(0x24c)+_0x2f7c38['id']+_0x23c4bd(0x203)+_0x13eec0[_0x23c4bd(0x207)](0x1)+'h)'),await this['checkSinglePayment'](_0x2f7c38),_0x167da3++,await new Promise(_0x4af598=>setTimeout(_0x4af598,0x7d0));}catch(_0x32e083){console[_0x23c4bd(0x27f)](_0x23c4bd(0x1e9)+_0x2f7c38['id']+':',_0x32e083),this[_0x23c4bd(0x196)](_0x2f7c38['id'],_0x2f7c38[_0x23c4bd(0x1b1)]||_0x23c4bd(0x1a1),_0x32e083,'status_check',{'isGlobalCheck':!![],'paymentAmount':_0x2f7c38[_0x23c4bd(0x24f)],'paymentCurrency':_0x2f7c38[_0x23c4bd(0x1e7)],'shopId':_0x2f7c38[_0x23c4bd(0x267)],'createdAt':_0x2f7c38[_0x23c4bd(0x25f)]}),loggerService_1[_0x23c4bd(0x1ee)]['logWhiteDomainError'](_0x23c4bd(0x22b),_0x23c4bd(0x217)+_0x2f7c38['gatewayPaymentId'],_0x32e083);}}console[_0x23c4bd(0x274)](_0x23c4bd(0x26f)+_0x167da3+_0x23c4bd(0x1ae)+_0x286f86+'\x20skipped,\x20'+_0x4283aa[_0x23c4bd(0x22d)]+_0x23c4bd(0x292));}catch(_0x3b2922){console['error'](_0x23c4bd(0x18c),_0x3b2922);}}async[a57_0x387c28(0x240)](_0x22c83a){const _0x49c017=a57_0x387c28,_0x2b66db=[],_0x507fa4=new Date();_0x507fa4['setDate'](_0x507fa4['getDate']()-this[_0x49c017(0x25e)]),console[_0x49c017(0x274)](_0x49c017(0x1d4)+this[_0x49c017(0x25e)]+'\x20days\x20(created\x20before\x20'+_0x507fa4[_0x49c017(0x194)]()+')');for(const _0x548508 of _0x22c83a){if(_0x548508[_0x49c017(0x25f)]<_0x507fa4){console[_0x49c017(0x274)]('‚è∞\x20[EXPIRY]\x20Payment\x20'+_0x548508['id']+_0x49c017(0x277)+this[_0x49c017(0x25e)]+_0x49c017(0x233));try{this[_0x49c017(0x197)](_0x548508['id'],_0x548508[_0x49c017(0x1b1)]||_0x49c017(0x1a1),_0x49c017(0x18e),_0x49c017(0x249),_0x49c017(0x186),{'reason':_0x49c017(0x236)+this['EXPIRY_DAYS']+_0x49c017(0x1c2),'createdAt':_0x548508[_0x49c017(0x25f)],'daysSinceCreation':Math['floor']((Date[_0x49c017(0x1eb)]()-_0x548508['createdAt'][_0x49c017(0x281)]())/(0x3e8*0x3c*0x3c*0x18)),'paymentAmount':_0x548508['amount'],'paymentCurrency':_0x548508[_0x49c017(0x1e7)],'shopId':_0x548508['shopId']}),await database_1[_0x49c017(0x1e5)]['payment'][_0x49c017(0x1a8)]({'where':{'id':_0x548508['id']},'data':{'status':_0x49c017(0x249),'updatedAt':new Date()}}),await database_1[_0x49c017(0x1e5)][_0x49c017(0x289)]['create']({'data':{'paymentId':_0x548508['id'],'shopId':_0x548508['shopId'],'event':'cointopay_auto_expired','statusCode':0xc8,'responseBody':JSON['stringify']({'reason':'Payment\x20older\x20than\x20'+this[_0x49c017(0x25e)]+_0x49c017(0x1c2),'createdAt':_0x548508['createdAt'],'expiredAt':new Date()['toISOString'](),'daysSinceCreation':Math['floor']((Date[_0x49c017(0x1eb)]()-_0x548508[_0x49c017(0x25f)][_0x49c017(0x281)]())/(0x3e8*0x3c*0x3c*0x18))})}}),await this[_0x49c017(0x210)](_0x548508,_0x49c017(0x249)),await this[_0x49c017(0x20c)](_0x548508,_0x49c017(0x249)),this[_0x49c017(0x201)](_0x548508['id']),_0x2b66db[_0x49c017(0x1ea)](_0x548508['id']),console[_0x49c017(0x274)](_0x49c017(0x229)+_0x548508['id']+'\x20marked\x20as\x20EXPIRED\x20due\x20to\x20'+this['EXPIRY_DAYS']+_0x49c017(0x262));}catch(_0x1d4689){console[_0x49c017(0x27f)](_0x49c017(0x1ed)+_0x548508['id']+':',_0x1d4689),this[_0x49c017(0x196)](_0x548508['id'],_0x548508[_0x49c017(0x1b1)]||_0x49c017(0x1a1),_0x1d4689,'auto_expire',{'reason':'Failed\x20to\x20mark\x20payment\x20as\x20expired','createdAt':_0x548508[_0x49c017(0x25f)],'daysSinceCreation':Math[_0x49c017(0x1e6)]((Date['now']()-_0x548508[_0x49c017(0x25f)][_0x49c017(0x281)]())/(0x3e8*0x3c*0x3c*0x18))});}}}return _0x2b66db;}async[a57_0x387c28(0x28a)](_0x117db2){const _0x46f377=a57_0x387c28;if(!_0x117db2['gatewayPaymentId']){console[_0x46f377(0x274)](_0x46f377(0x1cc)+_0x117db2['id']+_0x46f377(0x19d));return;}console[_0x46f377(0x274)](_0x46f377(0x1f6)+_0x117db2[_0x46f377(0x1b4)]+_0x46f377(0x232)+_0x117db2['id']+'\x20('+_0x117db2['gatewayPaymentId']+')');try{let _0x3cb101;_0x117db2[_0x46f377(0x1b4)]===_0x46f377(0x20b)?(_0x3cb101=await this[_0x46f377(0x237)]['checkPaymentStatus'](_0x117db2[_0x46f377(0x1b1)]),console[_0x46f377(0x274)]('üìä\x20[CHECK]\x20CoinToPay2\x20payment\x20'+_0x117db2['id']+_0x46f377(0x286)+_0x3cb101[_0x46f377(0x235)])):(_0x3cb101=await this[_0x46f377(0x1f5)]['checkPaymentStatus'](_0x117db2[_0x46f377(0x1b1)]),console[_0x46f377(0x274)](_0x46f377(0x1b7)+_0x117db2['id']+_0x46f377(0x286)+_0x3cb101[_0x46f377(0x235)]));_0x3cb101[_0x46f377(0x20f)]&&console[_0x46f377(0x274)](_0x46f377(0x21d)+_0x117db2['id']+_0x46f377(0x27e),{'iban':_0x3cb101[_0x46f377(0x20f)]['iban']||'not\x20found','transactionId':_0x3cb101[_0x46f377(0x20f)][_0x46f377(0x28e)],'createdOn':_0x3cb101['paymentDetails'][_0x46f377(0x192)],'confirmedOn':_0x3cb101[_0x46f377(0x20f)][_0x46f377(0x25d)]||_0x46f377(0x243)});if(_0x3cb101[_0x46f377(0x235)]!==_0x117db2[_0x46f377(0x235)]){console[_0x46f377(0x274)](_0x46f377(0x26a)+_0x117db2['id']+_0x46f377(0x1a2)+_0x117db2['status']+'\x20to\x20'+_0x3cb101[_0x46f377(0x235)]),this[_0x46f377(0x197)](_0x117db2['id'],_0x117db2[_0x46f377(0x1b1)],_0x117db2[_0x46f377(0x235)],_0x3cb101[_0x46f377(0x235)],_0x46f377(0x244),{'paymentDetails':_0x3cb101[_0x46f377(0x20f)],'amount':_0x3cb101[_0x46f377(0x24f)],'currency':_0x3cb101[_0x46f377(0x1e7)],'shopId':_0x117db2[_0x46f377(0x267)],'checkTimestamp':new Date()[_0x46f377(0x194)]()});const _0x295946={'status':_0x3cb101['status'],'updatedAt':new Date()};if(_0x3cb101[_0x46f377(0x235)]==='PAID'&&_0x117db2[_0x46f377(0x235)]!==_0x46f377(0x23b)){_0x295946[_0x46f377(0x230)]=new Date();if(!_0x117db2[_0x46f377(0x1ef)]){const _0x144cb4=await currencyService_1[_0x46f377(0x19e)][_0x46f377(0x1ba)](_0x117db2[_0x46f377(0x24f)],_0x117db2[_0x46f377(0x1e7)]);_0x295946[_0x46f377(0x1ef)]=_0x144cb4;const _0x3f0c45=await this[_0x46f377(0x23c)](_0x117db2['shopId'],_0x117db2[_0x46f377(0x1b4)]),_0x4f47a5=_0x144cb4*(0x1-_0x3f0c45/0x64);_0x295946[_0x46f377(0x1dc)]=_0x4f47a5,_0x295946[_0x46f377(0x1d7)]=_0x3f0c45,console['log'](_0x46f377(0x246)+_0x117db2['id']+'\x20amounts\x20calculated:'),console['log'](_0x46f377(0x1b3)+_0x117db2[_0x46f377(0x24f)]+'\x20'+_0x117db2['currency']+_0x46f377(0x188)+_0x144cb4['toFixed'](0x6)+'\x20USDT'),console['log'](_0x46f377(0x1fd)+_0x117db2[_0x46f377(0x1b4)]+_0x46f377(0x27a)+_0x3f0c45+'%'),console[_0x46f377(0x274)]('\x20\x20\x20Amount\x20after\x20commission:\x20'+_0x4f47a5[_0x46f377(0x207)](0x6)+_0x46f377(0x1cb));}console[_0x46f377(0x274)](_0x46f377(0x246)+_0x117db2['id']+_0x46f377(0x1bd)+_0x295946[_0x46f377(0x230)][_0x46f377(0x194)]());}if(_0x3cb101['paymentDetails']){const _0x2b3e28=_0x3cb101[_0x46f377(0x20f)];_0x2b3e28[_0x46f377(0x199)]&&(_0x295946[_0x46f377(0x211)]=_0x2b3e28[_0x46f377(0x199)],console[_0x46f377(0x274)](_0x46f377(0x1d2)+_0x2b3e28[_0x46f377(0x199)])),_0x2b3e28[_0x46f377(0x24a)]&&console['log'](_0x46f377(0x206)+_0x2b3e28[_0x46f377(0x24a)]),_0x2b3e28['transactionId']&&console[_0x46f377(0x274)]('üÜî\x20[CHECK]\x20Transaction\x20ID:\x20'+_0x2b3e28[_0x46f377(0x28e)]),_0x2b3e28[_0x46f377(0x25d)]&&console[_0x46f377(0x274)](_0x46f377(0x1a4)+_0x2b3e28[_0x46f377(0x25d)]);}await database_1['default'][_0x46f377(0x1e2)][_0x46f377(0x1a8)]({'where':{'id':_0x117db2['id']},'data':_0x295946});if(_0x3cb101[_0x46f377(0x235)]==='PAID'&&_0x117db2[_0x46f377(0x235)]!==_0x46f377(0x23b)){console[_0x46f377(0x274)](_0x46f377(0x24b)+_0x117db2['id']+'\x20became\x20PAID\x20via\x20status\x20check,\x20updating\x20payment\x20link');const _0x17d344=await database_1[_0x46f377(0x1e5)][_0x46f377(0x1e2)]['findUnique']({'where':{'id':_0x117db2['id']},'select':{'id':!![],'paymentLinkId':!![],'paymentLink':{'select':{'id':!![],'type':!![],'currentPayments':!![],'status':!![]}}}});if(_0x17d344?.[_0x46f377(0x273)]&&_0x17d344['paymentLink'])try{const _0x2b5093=_0x17d344[_0x46f377(0x26b)];console['log']('üìà\x20[COINTOPAY]\x20Found\x20payment\x20link\x20'+_0x2b5093['id']+':\x20type='+_0x2b5093[_0x46f377(0x1b9)]+_0x46f377(0x25a)+_0x2b5093[_0x46f377(0x21b)]+_0x46f377(0x254)+_0x2b5093[_0x46f377(0x235)]);const _0x5d4241=_0x2b5093[_0x46f377(0x21b)]+0x1,_0x3efeb8=_0x2b5093[_0x46f377(0x1b9)]===_0x46f377(0x1c9)?_0x46f377(0x1c3):_0x2b5093['status'];await database_1[_0x46f377(0x1e5)][_0x46f377(0x26b)][_0x46f377(0x1a8)]({'where':{'id':_0x2b5093['id']},'data':{'currentPayments':_0x5d4241,'status':_0x3efeb8,'updatedAt':new Date()}}),console[_0x46f377(0x274)](_0x46f377(0x1ad)+_0x2b5093['id']+'\x20updated:\x20currentPayments='+_0x2b5093[_0x46f377(0x21b)]+_0x46f377(0x188)+_0x5d4241+_0x46f377(0x254)+_0x2b5093[_0x46f377(0x235)]+_0x46f377(0x188)+_0x3efeb8);}catch(_0x11d795){console[_0x46f377(0x27f)](_0x46f377(0x1c4),_0x11d795);}else console[_0x46f377(0x274)](_0x46f377(0x24b)+_0x117db2['id']+_0x46f377(0x1a5));}await database_1[_0x46f377(0x1e5)][_0x46f377(0x289)][_0x46f377(0x272)]({'data':{'paymentId':_0x117db2['id'],'shopId':_0x117db2[_0x46f377(0x267)],'event':'cointopay_status_check_'+_0x3cb101['status']['toLowerCase'](),'statusCode':0xc8,'responseBody':JSON[_0x46f377(0x24d)]({'oldStatus':_0x117db2[_0x46f377(0x235)],'newStatus':_0x3cb101[_0x46f377(0x235)],'paymentDetails':_0x3cb101[_0x46f377(0x20f)],'checkedAt':new Date()['toISOString']()})}}),await this[_0x46f377(0x210)](_0x117db2,_0x3cb101[_0x46f377(0x235)]),await this[_0x46f377(0x20c)](_0x117db2,_0x3cb101[_0x46f377(0x235)]),_0x3cb101[_0x46f377(0x235)]!==_0x46f377(0x18e)&&(console[_0x46f377(0x274)](_0x46f377(0x1c0)+_0x117db2['id']+_0x46f377(0x252)+_0x3cb101[_0x46f377(0x235)]+_0x46f377(0x1a0)),this[_0x46f377(0x201)](_0x117db2['id'])),console[_0x46f377(0x274)](_0x46f377(0x242)+_0x117db2['id']+_0x46f377(0x1bf));}else console['log'](_0x46f377(0x21d)+_0x117db2['id']+'\x20status\x20unchanged\x20('+_0x3cb101[_0x46f377(0x235)]+')'),this['logCoinToPayStatus'](_0x117db2['id'],_0x117db2['gatewayPaymentId'],_0x117db2[_0x46f377(0x235)],_0x3cb101[_0x46f377(0x235)],'status_check',{'statusUnchanged':!![],'paymentDetails':_0x3cb101[_0x46f377(0x20f)],'amount':_0x3cb101[_0x46f377(0x24f)],'currency':_0x3cb101[_0x46f377(0x1e7)],'shopId':_0x117db2['shopId'],'checkTimestamp':new Date()['toISOString']()});}catch(_0x1891e3){console[_0x46f377(0x27f)](_0x46f377(0x191)+_0x117db2['id']+':',_0x1891e3),this[_0x46f377(0x196)](_0x117db2['id'],_0x117db2[_0x46f377(0x1b1)],_0x1891e3,_0x46f377(0x244),{'paymentAmount':_0x117db2[_0x46f377(0x24f)],'paymentCurrency':_0x117db2['currency'],'shopId':_0x117db2[_0x46f377(0x267)],'createdAt':_0x117db2['createdAt']}),await database_1[_0x46f377(0x1e5)]['webhookLog'][_0x46f377(0x272)]({'data':{'paymentId':_0x117db2['id'],'shopId':_0x117db2[_0x46f377(0x267)],'event':'cointopay_status_check_error','statusCode':0x1f4,'responseBody':JSON[_0x46f377(0x24d)]({'error':_0x1891e3 instanceof Error?_0x1891e3[_0x46f377(0x216)]:'Unknown\x20error','gatewayPaymentId':_0x117db2[_0x46f377(0x1b1)],'checkedAt':new Date()[_0x46f377(0x194)]()})}});}}async[a57_0x387c28(0x210)](_0x4efe9e,_0x513e69){const _0x525d70=a57_0x387c28,_0x248aa6=Date[_0x525d70(0x1eb)]();try{const _0x5798f1=_0x4efe9e[_0x525d70(0x264)],_0x432dee=_0x5798f1[_0x525d70(0x1b0)];if(!_0x432dee?.[_0x525d70(0x260)]){console['log'](_0x525d70(0x1cf)+_0x5798f1['id']);return;}const _0x5b0cbc=_0x513e69===_0x525d70(0x23b)?_0x525d70(0x1f9):_0x513e69===_0x525d70(0x1fb)?_0x525d70(0x1aa):_0x513e69===_0x525d70(0x249)?'payment.failed':_0x525d70(0x245);if(!_0x432dee[_0x525d70(0x1da)]?.['includes'](_0x5b0cbc)){console[_0x525d70(0x274)](_0x525d70(0x198)+_0x5b0cbc+_0x525d70(0x23a)+_0x5798f1['id']);return;}const _0x59fed7=(0x0,gateway_1[_0x525d70(0x1f2)])(_0x4efe9e[_0x525d70(0x1b4)])||_0x4efe9e[_0x525d70(0x1b4)],_0x4e1630={'event':_0x5b0cbc,'payment':{'id':_0x4efe9e['id'],'order_id':_0x4efe9e['orderId'],'gateway_order_id':_0x4efe9e[_0x525d70(0x270)],'gateway':_0x59fed7,'amount':_0x4efe9e['amount'],'currency':_0x4efe9e['currency'],'status':_0x513e69[_0x525d70(0x293)](),'customer_email':_0x4efe9e[_0x525d70(0x226)],'customer_name':_0x4efe9e[_0x525d70(0x251)],'created_at':_0x4efe9e['createdAt'],'updated_at':new Date()}},_0x38e0c4=JSON[_0x525d70(0x24d)](_0x4e1630),_0x266104=crypto_1['default'][_0x525d70(0x248)](_0x525d70(0x23e),_0x4efe9e[_0x525d70(0x264)]['secretKey'])[_0x525d70(0x1a8)](_0x38e0c4)[_0x525d70(0x28f)](_0x525d70(0x255)),_0x155197=await fetch(_0x432dee[_0x525d70(0x260)],{'method':_0x525d70(0x282),'headers':{'Content-Type':'application/json','User-Agent':_0x525d70(0x26c),'X-Webhook-Signature':_0x266104},'body':_0x38e0c4}),_0x3c4fab=Date[_0x525d70(0x1eb)]()-_0x248aa6,_0x2f11cc=_0x155197['ok']?_0x525d70(0x209):await _0x155197['text']();loggerService_1['loggerService'][_0x525d70(0x1a9)](_0x4efe9e[_0x525d70(0x267)],_0x432dee[_0x525d70(0x260)],_0x5b0cbc,_0x155197[_0x525d70(0x235)],_0x3c4fab,_0x4e1630),console[_0x525d70(0x274)](_0x525d70(0x256)+_0x432dee[_0x525d70(0x260)]+'\x20with\x20status\x20'+_0x155197[_0x525d70(0x235)]+'\x20('+_0x3c4fab+_0x525d70(0x1b5));}catch(_0x2a96b9){console['error'](_0x525d70(0x221),_0x2a96b9),loggerService_1[_0x525d70(0x1ee)][_0x525d70(0x1e0)](_0x4efe9e[_0x525d70(0x267)],_0x4efe9e[_0x525d70(0x264)]?.[_0x525d70(0x1b0)]?.[_0x525d70(0x260)]||'unknown',_0x525d70(0x228),_0x2a96b9,{});}}async[a57_0x387c28(0x20c)](_0x29de83,_0x3c4429){const _0x376e19=a57_0x387c28;try{const _0x27f63a={'PENDING':_0x376e19(0x222),'PAID':_0x376e19(0x220),'FAILED':'failed','EXPIRED':_0x376e19(0x1b8)},_0x51b594=_0x27f63a[_0x3c4429];if(!_0x51b594||_0x51b594===_0x376e19(0x222))return;await telegramBotService_1[_0x376e19(0x202)][_0x376e19(0x1f7)](_0x29de83['shopId'],_0x29de83,_0x51b594);}catch(_0x1ac62d){console[_0x376e19(0x27f)](_0x376e19(0x215),_0x1ac62d);}}async[a57_0x387c28(0x1c1)](_0x4bcffa){const _0x68c502=a57_0x387c28;console[_0x68c502(0x274)]('üîç\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment:\x20'+_0x4bcffa);const _0x5d1813=await database_1[_0x68c502(0x1e5)][_0x68c502(0x1e2)]['findUnique']({'where':{'id':_0x4bcffa},'include':{'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x5d1813)throw new Error(_0x68c502(0x291));if(_0x5d1813[_0x68c502(0x1b4)]!==_0x68c502(0x22b)&&_0x5d1813[_0x68c502(0x1b4)]!==_0x68c502(0x20b))throw new Error(_0x68c502(0x213));console[_0x68c502(0x274)](_0x68c502(0x278)+_0x5d1813['gateway']+_0x68c502(0x232)+_0x4bcffa),await this[_0x68c502(0x28a)](_0x5d1813),console[_0x68c502(0x274)](_0x68c502(0x1bb)+_0x4bcffa);}[a57_0x387c28(0x239)](){const _0x3a6dbf=a57_0x387c28,_0x2e2b7a=this[_0x3a6dbf(0x1e3)]?this[_0x3a6dbf(0x238)]:undefined,_0x481a25=Array['from'](this[_0x3a6dbf(0x247)][_0x3a6dbf(0x1e4)]())[_0x3a6dbf(0x1f1)](_0x17c33f=>({'paymentId':_0x17c33f[_0x3a6dbf(0x184)],'gatewayPaymentId':_0x17c33f[_0x3a6dbf(0x1b1)],'createdAt':_0x17c33f[_0x3a6dbf(0x25f)],'timersCount':_0x17c33f[_0x3a6dbf(0x1f8)][_0x3a6dbf(0x22d)]}));return{'isActive':!!this['globalCheckInterval'],'globalCheckIntervalMinutes':this[_0x3a6dbf(0x238)]/(0x3e8*0x3c),'expiryDays':this[_0x3a6dbf(0x25e)],'activeIndividualTimers':this['paymentTimers'][_0x3a6dbf(0x190)],'nextGlobalCheckIn':_0x2e2b7a,'paymentTimersDetails':_0x481a25};}[a57_0x387c28(0x27c)](_0x3132f7){const _0x50dbbd=a57_0x387c28,_0x3072cc=this[_0x50dbbd(0x247)][_0x50dbbd(0x261)](_0x3132f7);if(_0x3072cc)return{'hasTimers':!![],'timersCount':_0x3072cc[_0x50dbbd(0x1f8)][_0x50dbbd(0x22d)],'createdAt':_0x3072cc[_0x50dbbd(0x25f)],'gatewayPaymentId':_0x3072cc[_0x50dbbd(0x1b1)]};return{'hasTimers':![]};}async[a57_0x387c28(0x23c)](_0x145306,_0x5225ab){const _0x4259f8=a57_0x387c28;try{const _0x2f6349=await database_1['default'][_0x4259f8(0x264)]['findUnique']({'where':{'id':_0x145306},'select':{'gatewaySettings':!![]}});if(!_0x2f6349?.[_0x4259f8(0x214)])return console[_0x4259f8(0x274)](_0x4259f8(0x275)+_0x145306+_0x4259f8(0x250)),0xa;const _0x252b69=JSON['parse'](_0x2f6349[_0x4259f8(0x214)]);for(const [_0x2fb504,_0x41ac12]of Object[_0x4259f8(0x1af)](_0x252b69)){if(_0x2fb504[_0x4259f8(0x293)]()===_0x5225ab[_0x4259f8(0x293)]()){const _0x528b8a=_0x41ac12[_0x4259f8(0x1fa)]||0xa;return console[_0x4259f8(0x274)]('Gateway\x20'+_0x5225ab+_0x4259f8(0x285)+_0x145306+':\x20'+_0x528b8a+'%'),_0x528b8a;}}return console[_0x4259f8(0x274)]('No\x20specific\x20commission\x20found\x20for\x20gateway\x20'+_0x5225ab+_0x4259f8(0x195)+_0x145306+_0x4259f8(0x26e)),0xa;}catch(_0x3e7e01){return console[_0x4259f8(0x27f)]('Error\x20getting\x20gateway\x20commission\x20for\x20shop\x20'+_0x145306+',\x20gateway\x20'+_0x5225ab+':',_0x3e7e01),0xa;}}}exports[a57_0x387c28(0x27d)]=CoinToPayStatusService,exports[a57_0x387c28(0x266)]=new CoinToPayStatusService();