'use strict';function a83_0x4de5(_0x31df88,_0x29ff41){_0x31df88=_0x31df88-0x1ad;const _0x4ed7db=a83_0x4ed7();let _0x4de593=_0x4ed7db[_0x31df88];return _0x4de593;}const a83_0x5b1f3a=a83_0x4de5;(function(_0x2919dd,_0x1240c8){const _0x161aef=a83_0x4de5,_0x4d666b=_0x2919dd();while(!![]){try{const _0xdb040b=parseInt(_0x161aef(0x1c8))/0x1*(parseInt(_0x161aef(0x1d5))/0x2)+parseInt(_0x161aef(0x1b8))/0x3*(-parseInt(_0x161aef(0x1b2))/0x4)+parseInt(_0x161aef(0x1c2))/0x5+parseInt(_0x161aef(0x1dc))/0x6*(-parseInt(_0x161aef(0x1c0))/0x7)+-parseInt(_0x161aef(0x1c3))/0x8*(parseInt(_0x161aef(0x1d6))/0x9)+parseInt(_0x161aef(0x1c6))/0xa+parseInt(_0x161aef(0x1ae))/0xb*(parseInt(_0x161aef(0x1b7))/0xc);if(_0xdb040b===_0x1240c8)break;else _0x4d666b['push'](_0x4d666b['shift']());}catch(_0xcbd88e){_0x4d666b['push'](_0x4d666b['shift']());}}}(a83_0x4ed7,0x92a8f));var __importDefault=this&&this[a83_0x5b1f3a(0x1d7)]||function(_0x1837e0){const _0x4d6d21=a83_0x5b1f3a;return _0x1837e0&&_0x1837e0[_0x4d6d21(0x1b9)]?_0x1837e0:{'default':_0x1837e0};};Object[a83_0x5b1f3a(0x1cf)](exports,a83_0x5b1f3a(0x1b9),{'value':!![]}),exports['prePaymentService']=exports[a83_0x5b1f3a(0x1bf)]=void 0x0;function a83_0x4ed7(){const _0x1cac08=['customerIp','findUnique','now','16cNtOQC','generateUniqueShortCode','sourceCurrency','prePayment','customerEmail','5172goJxOG','10227JIbgmv','__esModule','currency','https://app.trapay.uk','status','pendingUrl','failUrl','PrePaymentService','7kdmyFs','getPrePaymentByCode','5936040OKKxHr','3496TOIRjO','country','default','2525330HBpOqZ','successUrl','273yLAOfz','confirmPrePayment','CONFIRMED','customAlphabet','shopId','prePaymentService','network','defineProperty','expiresAt','../config/database','language','/p/','EXPIRED','738cDvaLF','15777OcDgNx','__importDefault','orderId','create','PENDING','gateway','1314654QXUywC','Pre-payment\x20has\x20expired','amount','customerName','1507uvrvkK'];a83_0x4ed7=function(){return _0x1cac08;};return a83_0x4ed7();}const database_1=__importDefault(require(a83_0x5b1f3a(0x1d1))),nanoid_1=require('nanoid'),nanoid=(0x0,nanoid_1[a83_0x5b1f3a(0x1cb)])('abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789',0x8);class PrePaymentService{async['createPrePayment'](_0x11ca02){const _0x29b5ba=a83_0x5b1f3a,_0x47b5a2=await this[_0x29b5ba(0x1b3)](),_0x23a7ca=new Date(Date[_0x29b5ba(0x1b1)]()+0x1e*0x3c*0x3e8),_0x3396d4=await database_1['default'][_0x29b5ba(0x1b5)][_0x29b5ba(0x1d9)]({'data':{'shortCode':_0x47b5a2,'shopId':_0x11ca02[_0x29b5ba(0x1cc)],'gateway':_0x11ca02[_0x29b5ba(0x1db)],'amount':_0x11ca02[_0x29b5ba(0x1de)],'currency':_0x11ca02[_0x29b5ba(0x1ba)],'sourceCurrency':_0x11ca02[_0x29b5ba(0x1b4)],'network':_0x11ca02['network'],'orderId':_0x11ca02['orderId'],'country':_0x11ca02[_0x29b5ba(0x1c4)],'language':_0x11ca02[_0x29b5ba(0x1d2)],'successUrl':_0x11ca02['successUrl'],'failUrl':_0x11ca02[_0x29b5ba(0x1be)],'pendingUrl':_0x11ca02[_0x29b5ba(0x1bd)],'expiresAt':_0x23a7ca,'status':_0x29b5ba(0x1da)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),_0x5e35a6=process.env.FRONTEND_URL||_0x29b5ba(0x1bb),_0x2da169=_0x5e35a6+_0x29b5ba(0x1d3)+_0x47b5a2;return{'prePaymentId':_0x3396d4['id'],'shortCode':_0x3396d4['shortCode'],'proxyUrl':_0x2da169,'expiresAt':_0x3396d4[_0x29b5ba(0x1d0)]};}async[a83_0x5b1f3a(0x1c1)](_0x152cd1){const _0x1d1f83=a83_0x5b1f3a,_0x54cfa9=await database_1[_0x1d1f83(0x1c5)]['prePayment'][_0x1d1f83(0x1b0)]({'where':{'shortCode':_0x152cd1},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x54cfa9)throw new Error('Pre-payment\x20not\x20found');if(_0x54cfa9[_0x1d1f83(0x1bc)]!==_0x1d1f83(0x1da))throw new Error('Pre-payment\x20is\x20no\x20longer\x20available');if(new Date()>_0x54cfa9[_0x1d1f83(0x1d0)]){await database_1['default'][_0x1d1f83(0x1b5)]['update']({'where':{'id':_0x54cfa9['id']},'data':{'status':_0x1d1f83(0x1d4)}});throw new Error(_0x1d1f83(0x1dd));}return _0x54cfa9;}async[a83_0x5b1f3a(0x1c9)](_0x4cd0b4,_0x421c90){const _0x2bf2be=a83_0x5b1f3a,_0x132710=await this[_0x2bf2be(0x1c1)](_0x4cd0b4);return await database_1['default'][_0x2bf2be(0x1b5)]['update']({'where':{'id':_0x132710['id']},'data':{'customerEmail':_0x421c90[_0x2bf2be(0x1b6)],'customerName':_0x421c90['customerName'],'status':_0x2bf2be(0x1ca),'confirmedAt':new Date()}}),{'prePaymentId':_0x132710['id'],'customerEmail':_0x421c90[_0x2bf2be(0x1b6)],'customerName':_0x421c90[_0x2bf2be(0x1ad)],'customerIp':_0x421c90[_0x2bf2be(0x1af)],'customerCountry':_0x421c90['customerCountry'],'shopId':_0x132710[_0x2bf2be(0x1cc)],'gateway':_0x132710[_0x2bf2be(0x1db)],'amount':_0x132710[_0x2bf2be(0x1de)],'currency':_0x132710[_0x2bf2be(0x1ba)],'sourceCurrency':_0x132710[_0x2bf2be(0x1b4)],'network':_0x132710[_0x2bf2be(0x1ce)],'orderId':_0x132710[_0x2bf2be(0x1d8)],'country':_0x132710[_0x2bf2be(0x1c4)],'language':_0x132710[_0x2bf2be(0x1d2)],'successUrl':_0x132710[_0x2bf2be(0x1c7)],'failUrl':_0x132710[_0x2bf2be(0x1be)],'pendingUrl':_0x132710['pendingUrl']};}async['generateUniqueShortCode'](){const _0x18fd6a=a83_0x5b1f3a;let _0xd0e999=0x0;const _0x1e95da=0xa;while(_0xd0e999<_0x1e95da){const _0xc9dd8b=nanoid(),_0x331d50=await database_1[_0x18fd6a(0x1c5)][_0x18fd6a(0x1b5)][_0x18fd6a(0x1b0)]({'where':{'shortCode':_0xc9dd8b}});if(!_0x331d50)return _0xc9dd8b;_0xd0e999++;}throw new Error('Failed\x20to\x20generate\x20unique\x20short\x20code');}}exports[a83_0x5b1f3a(0x1bf)]=PrePaymentService,exports[a83_0x5b1f3a(0x1cd)]=new PrePaymentService();