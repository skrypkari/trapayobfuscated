'use strict';const a51_0x207463=a51_0x1cd0;(function(_0x1233b2,_0x525bfa){const _0x17ae0f=a51_0x1cd0,_0x20d394=_0x1233b2();while(!![]){try{const _0x33ccc5=-parseInt(_0x17ae0f(0x18e))/0x1+-parseInt(_0x17ae0f(0x1f1))/0x2*(-parseInt(_0x17ae0f(0x218))/0x3)+-parseInt(_0x17ae0f(0x1c5))/0x4+parseInt(_0x17ae0f(0x1ed))/0x5+-parseInt(_0x17ae0f(0x1db))/0x6*(parseInt(_0x17ae0f(0x193))/0x7)+parseInt(_0x17ae0f(0x1dc))/0x8+parseInt(_0x17ae0f(0x1f8))/0x9*(-parseInt(_0x17ae0f(0x1bf))/0xa);if(_0x33ccc5===_0x525bfa)break;else _0x20d394['push'](_0x20d394['shift']());}catch(_0x56bfa0){_0x20d394['push'](_0x20d394['shift']());}}}(a51_0x330a,0xc055b));var __createBinding=this&&this[a51_0x207463(0x19e)]||(Object[a51_0x207463(0x1e4)]?function(_0x2a6e72,_0x1bb45a,_0x331642,_0x1976c8){const _0x4eb6f7=a51_0x207463;if(_0x1976c8===undefined)_0x1976c8=_0x331642;var _0x5c21b9=Object[_0x4eb6f7(0x1e2)](_0x1bb45a,_0x331642);(!_0x5c21b9||(_0x4eb6f7(0x1e1)in _0x5c21b9?!_0x1bb45a['__esModule']:_0x5c21b9[_0x4eb6f7(0x1c7)]||_0x5c21b9[_0x4eb6f7(0x1e0)]))&&(_0x5c21b9={'enumerable':!![],'get':function(){return _0x1bb45a[_0x331642];}}),Object['defineProperty'](_0x2a6e72,_0x1976c8,_0x5c21b9);}:function(_0x575764,_0xbd9921,_0x1cf80c,_0x5d153d){if(_0x5d153d===undefined)_0x5d153d=_0x1cf80c;_0x575764[_0x5d153d]=_0xbd9921[_0x1cf80c];}),__setModuleDefault=this&&this[a51_0x207463(0x1ef)]||(Object[a51_0x207463(0x1e4)]?function(_0x5a6aaa,_0x1d2255){const _0x34e31c=a51_0x207463;Object[_0x34e31c(0x209)](_0x5a6aaa,_0x34e31c(0x1aa),{'enumerable':!![],'value':_0x1d2255});}:function(_0xcee3f7,_0x4f254c){_0xcee3f7['default']=_0x4f254c;}),__importStar=this&&this[a51_0x207463(0x1c4)]||(function(){var _0xf01f69=function(_0x30babe){const _0x171f30=a51_0x1cd0;return _0xf01f69=Object[_0x171f30(0x204)]||function(_0xa1e149){const _0x44a264=_0x171f30;var _0x2b55b0=[];for(var _0xeb6ed2 in _0xa1e149)if(Object[_0x44a264(0x18f)][_0x44a264(0x20e)][_0x44a264(0x210)](_0xa1e149,_0xeb6ed2))_0x2b55b0[_0x2b55b0[_0x44a264(0x20d)]]=_0xeb6ed2;return _0x2b55b0;},_0xf01f69(_0x30babe);};return function(_0xcb727f){const _0x40672e=a51_0x1cd0;if(_0xcb727f&&_0xcb727f[_0x40672e(0x1f6)])return _0xcb727f;var _0x14915d={};if(_0xcb727f!=null){for(var _0x4a98cb=_0xf01f69(_0xcb727f),_0x567803=0x0;_0x567803<_0x4a98cb[_0x40672e(0x20d)];_0x567803++)if(_0x4a98cb[_0x567803]!==_0x40672e(0x1aa))__createBinding(_0x14915d,_0xcb727f,_0x4a98cb[_0x567803]);}return __setModuleDefault(_0x14915d,_0xcb727f),_0x14915d;};}()),__importDefault=this&&this[a51_0x207463(0x203)]||function(_0x2b0cc4){const _0x1bcd78=a51_0x207463;return _0x2b0cc4&&_0x2b0cc4[_0x1bcd78(0x1f6)]?_0x2b0cc4:{'default':_0x2b0cc4};};function a51_0x1cd0(_0x1540c9,_0x4a5553){const _0x330a49=a51_0x330a();return a51_0x1cd0=function(_0x1cd0ca,_0x1be5d3){_0x1cd0ca=_0x1cd0ca-0x18e;let _0x4cfe20=_0x330a49[_0x1cd0ca];return _0x4cfe20;},a51_0x1cd0(_0x1540c9,_0x4a5553);}Object[a51_0x207463(0x209)](exports,a51_0x207463(0x1f6),{'value':!![]}),exports['rapydStatusService']=exports[a51_0x207463(0x1e7)]=void 0x0;function a51_0x330a(){const _0x477166=['amount','clearPaymentTimers','parse','‚ùå\x20[CHECK]\x20Failed\x20to\x20update\x20payment\x20link\x20counter\x20for\x20payment\x20','set','delete','30\x20minutes','‚úÖ\x20[CHECK]\x20Payment\x20','üìä\x20[RAPYD_STATUS]\x20Payment\x20status\x20update:','transactionId','70dPvZHB','log','‚ùå\x20[WEBHOOK]\x20Failed\x20to\x20send\x20webhook\x20for\x20payment\x20','toISOString','logRapydStatus','__importStar','3307152iWoqCS','\x20is\x20not\x20a\x20Rapyd\x20payment\x20(gateway:\x20','writable','shutdown','loggerService','shop','\x20to\x20','\x20updated\x20successfully','./gateways/rapydService','includes','\x20‚Üí\x20','logRapydError','\x20is\x20valid\x20for\x20checking,\x20proceeding...','üîï\x20[WEBHOOK]\x20Event\x20','\x20\x20\x20-\x20ShopId:\x20','findUnique','checkSinglePayment','paymentId','\x20has\x20no\x20gatewayPaymentId,\x20skipping','failureMessage','paidAt','üßπ\x20[SHUTDOWN]\x20Cleared\x20timers\x20for\x20payment\x20','5922SwGkJw','10376432iKqOKL','üîÑ\x20[CHECK]\x20Updating\x20payment\x20','toLowerCase','‚úÖ\x20[WEBHOOK]\x20Webhook\x20payload\x20prepared\x20for\x20shop\x20','configurable','get','getOwnPropertyDescriptor','‚ùå\x20[TELEGRAM]\x20Failed\x20to\x20send\x20notification\x20for\x20payment\x20','create','\x20\x20\x20-\x20paymentId:\x20','error','RapydStatusService','currency','../config/database','settings','getServiceStats','\x20found:','7817590yMeVjP','logWhiteDomainError','__setModuleDefault','shopId','266792LVbkEl','\x20\x20\x20-\x20Gateway:\x20','rapydService','rapyd_status_check_','PAID','__esModule','\x20marked\x20as\x20paid\x20at:\x20','1694151EeZReC','Failure:\x20',',\x20stopping\x20checks','gateway','reduce','push','‚ùå\x20[CHECK]\x20Error\x20checking\x20payment\x20','gatewayPaymentId','status_check',',\x20clearing\x20timers','payment','__importDefault','getOwnPropertyNames','üí∞\x20[CHECK]\x20Payment\x20','PENDING','\x20\x20\x20-\x20gatewayPaymentId:\x20',',\x20timers\x20cleared','defineProperty','60\x20minutes','logWhiteDomainRequest','createdAt','length','hasOwnProperty','paymentMethodType','call','‚ùå\x20[30MIN]\x20Failed\x20first\x20check\x20for\x20payment\x20','\x20not\x20enabled\x20for\x20shop\x20','üîç\x20[CHECK]\x20Starting\x20check\x20for\x20payment\x20ID:\x20','‚úÖ\x20[DEBUG]\x20Successfully\x20scheduled\x202\x20checks\x20for\x20payment\x20','üì°\x20[WEBHOOK]\x20Sending\x20','./loggerService','‚úÖ\x20[CHECK]\x20Payment\x20confirmed\x20at:\x20','12KMgDqA','‚ùå\x20[CHECK]\x20Payment\x20','schedulePaymentChecks','payment.','‚ö†Ô∏è\x20[CHECK]\x20Payment\x20','status','‚úÖ\x20[SHUTDOWN]\x20RapydStatusService\x20stopped','\x20status\x20is\x20','\x20has\x20no\x20gatewayPaymentId','\x20\x20\x20-\x20Amount:\x20','105585JZUdih','prototype','\x20status\x20unchanged\x20(','final_check','‚úÖ\x20[DEBUG]\x20Cleared\x20timers\x20for\x20payment\x20','2527UnKkDq','checkSinglePaymentById','not\x20paid','No\x20active\x20timers\x20for\x20this\x20payment','message','\x20status:\x20','üõë\x20[SHUTDOWN]\x20Stopping\x20RapydStatusService...','\x20timers\x20for\x20payment\x20','\x20details:','checkPaymentStatus','/status-service','__createBinding','\x20\x20\x20-\x20Status:\x20','\x20active\x20timers','adminNotes','forEach','paymentTimers','webhookEvents','timers','rapydStatusService','values','schedule_created','sendShopWebhook','default','rapyd','size','üìä\x20[DEBUG]\x20Total\x20active\x20payment\x20timers:\x20','üìä\x20[CHECK]\x20Payment\x20','üîç\x20[CHECK]\x20Checking\x20Rapyd\x20payment\x20','üÜî\x20[CHECK]\x20Transaction\x20ID:\x20','paymentDetails','resolve','webhookUrl','sendPaymentStatusNotification'];a51_0x330a=function(){return _0x477166;};return a51_0x330a();}const rapydService_1=require(a51_0x207463(0x1cd)),database_1=__importDefault(require(a51_0x207463(0x1e9))),loggerService_1=require(a51_0x207463(0x216));class RapydStatusService{constructor(){const _0x2f720f=a51_0x207463;this['paymentTimers']=new Map(),this[_0x2f720f(0x1f3)]=new rapydService_1['RapydService'](),console['log']('üåê\x20RapydStatusService\x20initialized');}[a51_0x207463(0x21a)](_0x4c5e1f,_0x53776d){const _0x389804=a51_0x207463;console['log']('üåê\x20[DEBUG]\x20schedulePaymentChecks\x20called\x20with:'),console[_0x389804(0x1c0)](_0x389804(0x1e5)+_0x4c5e1f),console['log'](_0x389804(0x207)+_0x53776d),this[_0x389804(0x1b6)](_0x4c5e1f);const _0x485e57=[],_0x2ad5cc=new Date(),_0x36d35e=setTimeout(async()=>{const _0x300241=_0x389804;try{console[_0x300241(0x1c0)]('üåê\x20[30MIN]\x20Starting\x20first\x20check\x20for\x20payment\x20'+_0x4c5e1f),await this[_0x300241(0x194)](_0x4c5e1f);}catch(_0x3b07e3){console[_0x300241(0x1e6)](_0x300241(0x211)+_0x4c5e1f+':',_0x3b07e3),this[_0x300241(0x1d0)](_0x4c5e1f,_0x53776d,_0x3b07e3,'first_check');}},0x1e*0x3c*0x3e8);_0x485e57[_0x389804(0x1fd)](_0x36d35e);const _0x1864af=setTimeout(async()=>{const _0x5d2ac1=_0x389804;try{console[_0x5d2ac1(0x1c0)]('üåê\x20[60MIN]\x20Starting\x20final\x20check\x20for\x20payment\x20'+_0x4c5e1f),await this[_0x5d2ac1(0x194)](_0x4c5e1f),this['clearPaymentTimers'](_0x4c5e1f),console['log']('üåê\x20[60MIN]\x20Final\x20check\x20completed\x20for\x20payment\x20'+_0x4c5e1f+_0x5d2ac1(0x208));}catch(_0x87743e){console[_0x5d2ac1(0x1e6)]('‚ùå\x20[60MIN]\x20Failed\x20final\x20check\x20for\x20payment\x20'+_0x4c5e1f+':',_0x87743e),this[_0x5d2ac1(0x1d0)](_0x4c5e1f,_0x53776d,_0x87743e,_0x5d2ac1(0x191)),this['clearPaymentTimers'](_0x4c5e1f);}},0x3c*0x3c*0x3e8);_0x485e57[_0x389804(0x1fd)](_0x1864af),this[_0x389804(0x1a3)][_0x389804(0x1b9)](_0x4c5e1f,{'timers':_0x485e57,'paymentId':_0x4c5e1f,'gatewayPaymentId':_0x53776d,'createdAt':_0x2ad5cc}),console[_0x389804(0x1c0)](_0x389804(0x214)+_0x4c5e1f+'\x20(30min,\x2060min)'),console[_0x389804(0x1c0)](_0x389804(0x1ad)+this[_0x389804(0x1a3)]['size']),this['logRapydStatus'](_0x4c5e1f,_0x53776d,_0x389804(0x206),_0x389804(0x206),_0x389804(0x1a8),{'checks_scheduled':0x2,'first_check_in':_0x389804(0x1bb),'final_check_in':_0x389804(0x20a),'created_at':_0x2ad5cc['toISOString']()});}[a51_0x207463(0x1b6)](_0x5aaf8c){const _0x206ef6=a51_0x207463,_0xf1250c=this['paymentTimers'][_0x206ef6(0x1e1)](_0x5aaf8c);_0xf1250c&&(console[_0x206ef6(0x1c0)]('üßπ\x20[DEBUG]\x20Clearing\x20'+_0xf1250c['timers'][_0x206ef6(0x20d)]+_0x206ef6(0x19a)+_0x5aaf8c),_0xf1250c[_0x206ef6(0x1a5)]['forEach'](_0x581eca=>clearTimeout(_0x581eca)),this[_0x206ef6(0x1a3)][_0x206ef6(0x1ba)](_0x5aaf8c),console[_0x206ef6(0x1c0)](_0x206ef6(0x192)+_0x5aaf8c));}async['checkPaymentById'](_0x57d558){const _0x239a4d=a51_0x207463;console[_0x239a4d(0x1c0)]('üåê\x20[MANUAL]\x20Manual\x20check\x20requested\x20for\x20payment\x20'+_0x57d558),await this[_0x239a4d(0x194)](_0x57d558);}async[a51_0x207463(0x194)](_0x58bb64){const _0x44f858=a51_0x207463;console['log'](_0x44f858(0x213)+_0x58bb64);const _0x5b7477=await database_1[_0x44f858(0x1aa)][_0x44f858(0x202)][_0x44f858(0x1d4)]({'where':{'id':_0x58bb64},'select':{'id':!![],'gatewayPaymentId':!![],'amount':!![],'currency':!![],'status':!![],'shopId':!![],'createdAt':!![],'gateway':!![],'shop':{'select':{'id':!![],'name':!![],'settings':{'select':{'webhookUrl':!![],'webhookEvents':!![]}}}}}});if(!_0x5b7477){console['log'](_0x44f858(0x219)+_0x58bb64+'\x20not\x20found\x20in\x20database');return;}console[_0x44f858(0x1c0)](_0x44f858(0x1ae)+_0x58bb64+_0x44f858(0x1ec)),console['log'](_0x44f858(0x1f2)+_0x5b7477[_0x44f858(0x1fb)]),console[_0x44f858(0x1c0)](_0x44f858(0x19f)+_0x5b7477['status']),console[_0x44f858(0x1c0)]('\x20\x20\x20-\x20GatewayPaymentId:\x20'+_0x5b7477[_0x44f858(0x1ff)]),console[_0x44f858(0x1c0)](_0x44f858(0x221)+_0x5b7477[_0x44f858(0x1b5)]+'\x20'+_0x5b7477[_0x44f858(0x1e8)]),console['log'](_0x44f858(0x1d3)+_0x5b7477['shopId']);if(_0x5b7477[_0x44f858(0x1fb)]!==_0x44f858(0x1ab)){console[_0x44f858(0x1c0)](_0x44f858(0x21c)+_0x58bb64+_0x44f858(0x1c6)+_0x5b7477[_0x44f858(0x1fb)]+')');return;}if(_0x5b7477['status']!==_0x44f858(0x206)){console[_0x44f858(0x1c0)]('‚ö†Ô∏è\x20[CHECK]\x20Payment\x20'+_0x58bb64+_0x44f858(0x21f)+_0x5b7477[_0x44f858(0x21d)]+_0x44f858(0x1fa)),this[_0x44f858(0x1b6)](_0x58bb64);return;}if(!_0x5b7477[_0x44f858(0x1ff)]){console[_0x44f858(0x1c0)](_0x44f858(0x21c)+_0x58bb64+_0x44f858(0x220));return;}console[_0x44f858(0x1c0)](_0x44f858(0x1bc)+_0x58bb64+_0x44f858(0x1d1)),await this[_0x44f858(0x1d5)](_0x5b7477);}async[a51_0x207463(0x1d5)](_0x3199b4){const _0x2331a9=a51_0x207463;if(!_0x3199b4[_0x2331a9(0x1ff)]){console['log'](_0x2331a9(0x21c)+_0x3199b4['id']+_0x2331a9(0x1d7));return;}console[_0x2331a9(0x1c0)](_0x2331a9(0x1af)+_0x3199b4['id']+'\x20('+_0x3199b4[_0x2331a9(0x1ff)]+')');try{const _0x55d0e4=await this[_0x2331a9(0x1f3)][_0x2331a9(0x19c)](_0x3199b4[_0x2331a9(0x1ff)]);console[_0x2331a9(0x1c0)]('üìä\x20[CHECK]\x20Payment\x20'+_0x3199b4['id']+_0x2331a9(0x198)+_0x55d0e4[_0x2331a9(0x21d)]);_0x55d0e4['paymentDetails']&&console[_0x2331a9(0x1c0)](_0x2331a9(0x1ae)+_0x3199b4['id']+_0x2331a9(0x19b),{'transactionId':_0x55d0e4[_0x2331a9(0x1b1)][_0x2331a9(0x1be)],'paymentMethod':_0x55d0e4[_0x2331a9(0x1b1)][_0x2331a9(0x20f)],'createdAt':_0x55d0e4['paymentDetails'][_0x2331a9(0x20c)],'paidAt':_0x55d0e4['paymentDetails'][_0x2331a9(0x1d9)]||_0x2331a9(0x195)});if(_0x55d0e4[_0x2331a9(0x21d)]!==_0x3199b4[_0x2331a9(0x21d)]){console[_0x2331a9(0x1c0)](_0x2331a9(0x1dd)+_0x3199b4['id']+'\x20status\x20from\x20'+_0x3199b4[_0x2331a9(0x21d)]+_0x2331a9(0x1cb)+_0x55d0e4[_0x2331a9(0x21d)]),this[_0x2331a9(0x1c3)](_0x3199b4['id'],_0x3199b4['gatewayPaymentId'],_0x3199b4[_0x2331a9(0x21d)],_0x55d0e4[_0x2331a9(0x21d)],_0x2331a9(0x200),{'paymentDetails':_0x55d0e4[_0x2331a9(0x1b1)],'amount':_0x55d0e4[_0x2331a9(0x1b5)],'currency':_0x55d0e4['currency'],'shopId':_0x3199b4[_0x2331a9(0x1f0)],'checkTimestamp':new Date()[_0x2331a9(0x1c2)]()});const _0xfc15ea={'status':_0x55d0e4['status'],'updatedAt':new Date()};_0x55d0e4[_0x2331a9(0x21d)]==='PAID'&&_0x3199b4[_0x2331a9(0x21d)]!==_0x2331a9(0x1f5)&&(_0xfc15ea[_0x2331a9(0x1d9)]=new Date(),console[_0x2331a9(0x1c0)](_0x2331a9(0x205)+_0x3199b4['id']+_0x2331a9(0x1f7)+_0xfc15ea[_0x2331a9(0x1d9)][_0x2331a9(0x1c2)]()));if(_0x55d0e4['paymentDetails']){const _0x1a4ee4=_0x55d0e4[_0x2331a9(0x1b1)];_0x1a4ee4[_0x2331a9(0x1be)]&&console[_0x2331a9(0x1c0)](_0x2331a9(0x1b0)+_0x1a4ee4[_0x2331a9(0x1be)]);if(_0x1a4ee4[_0x2331a9(0x1d8)]){const _0x2a7a36=_0x3199b4[_0x2331a9(0x1a1)]||'',_0x3ff38f=_0x2331a9(0x1f9)+_0x1a4ee4['failureMessage'];_0xfc15ea[_0x2331a9(0x1a1)]=_0x2a7a36?_0x2a7a36+'\x0a\x0a'+_0x3ff38f:_0x3ff38f,console['log']('‚ùå\x20[CHECK]\x20Saved\x20failure\x20message\x20to\x20admin\x20notes:\x20'+_0x1a4ee4[_0x2331a9(0x1d8)]);}_0x1a4ee4['paidAt']&&console[_0x2331a9(0x1c0)](_0x2331a9(0x217)+new Date(_0x1a4ee4[_0x2331a9(0x1d9)]*0x3e8)[_0x2331a9(0x1c2)]());}await database_1[_0x2331a9(0x1aa)][_0x2331a9(0x202)]['update']({'where':{'id':_0x3199b4['id']},'data':_0xfc15ea}),await database_1['default']['webhookLog']['create']({'data':{'paymentId':_0x3199b4['id'],'shopId':_0x3199b4[_0x2331a9(0x1f0)],'event':_0x2331a9(0x1f4)+_0x55d0e4['status'][_0x2331a9(0x1de)](),'statusCode':0xc8,'responseBody':JSON['stringify']({'oldStatus':_0x3199b4[_0x2331a9(0x21d)],'newStatus':_0x55d0e4[_0x2331a9(0x21d)],'paymentDetails':_0x55d0e4[_0x2331a9(0x1b1)],'checkedAt':new Date()[_0x2331a9(0x1c2)]()})}}),await this[_0x2331a9(0x1a9)](_0x3199b4,_0x55d0e4['status']),await this[_0x2331a9(0x1b4)](_0x3199b4,_0x55d0e4[_0x2331a9(0x21d)]);if(_0x55d0e4[_0x2331a9(0x21d)]===_0x2331a9(0x1f5)&&_0x3199b4[_0x2331a9(0x21d)]!==_0x2331a9(0x1f5))try{const {PaymentLinkService:_0x59c8f7}=await Promise[_0x2331a9(0x1b2)]()['then'](()=>__importStar(require('./paymentLinkService'))),_0x281f25=new _0x59c8f7();await _0x281f25['handleSuccessfulPayment'](_0x3199b4['id']),console[_0x2331a9(0x1c0)]('üìà\x20[CHECK]\x20Payment\x20link\x20counter\x20updated\x20for\x20payment\x20'+_0x3199b4['id']);}catch(_0x398644){console[_0x2331a9(0x1e6)](_0x2331a9(0x1b8)+_0x3199b4['id']+':',_0x398644);}_0x55d0e4[_0x2331a9(0x21d)]!==_0x2331a9(0x206)&&(console[_0x2331a9(0x1c0)]('üßπ\x20[CHECK]\x20Payment\x20'+_0x3199b4['id']+'\x20status\x20changed\x20to\x20'+_0x55d0e4[_0x2331a9(0x21d)]+_0x2331a9(0x201)),this['clearPaymentTimers'](_0x3199b4['id'])),console[_0x2331a9(0x1c0)](_0x2331a9(0x1bc)+_0x3199b4['id']+_0x2331a9(0x1cc));}else console[_0x2331a9(0x1c0)](_0x2331a9(0x1ae)+_0x3199b4['id']+_0x2331a9(0x190)+_0x55d0e4[_0x2331a9(0x21d)]+')'),this[_0x2331a9(0x1c3)](_0x3199b4['id'],_0x3199b4[_0x2331a9(0x1ff)],_0x3199b4[_0x2331a9(0x21d)],_0x55d0e4[_0x2331a9(0x21d)],'status_check_no_change',{'paymentDetails':_0x55d0e4[_0x2331a9(0x1b1)],'amount':_0x55d0e4[_0x2331a9(0x1b5)],'currency':_0x55d0e4['currency'],'shopId':_0x3199b4[_0x2331a9(0x1f0)],'checkTimestamp':new Date()['toISOString']()});}catch(_0x112798){console[_0x2331a9(0x1e6)](_0x2331a9(0x1fe)+_0x3199b4['id']+':',_0x112798),this[_0x2331a9(0x1d0)](_0x3199b4['id'],_0x3199b4[_0x2331a9(0x1ff)],_0x112798,_0x2331a9(0x200),{'shopId':_0x3199b4['shopId'],'amount':_0x3199b4[_0x2331a9(0x1b5)],'currency':_0x3199b4['currency'],'checkTimestamp':new Date()[_0x2331a9(0x1c2)]()});}}async[a51_0x207463(0x1a9)](_0xe1ca6d,_0x1dcc37){const _0x14f8c4=a51_0x207463;if(!_0xe1ca6d[_0x14f8c4(0x1ca)]?.[_0x14f8c4(0x1ea)]?.[_0x14f8c4(0x1b3)]||!_0xe1ca6d[_0x14f8c4(0x1ca)]?.['settings']?.[_0x14f8c4(0x1a4)]){console[_0x14f8c4(0x1c0)]('üîï\x20[WEBHOOK]\x20No\x20webhook\x20configured\x20for\x20shop\x20'+_0xe1ca6d[_0x14f8c4(0x1f0)]);return;}try{const _0x45c7fb=JSON[_0x14f8c4(0x1b7)](_0xe1ca6d[_0x14f8c4(0x1ca)][_0x14f8c4(0x1ea)]['webhookEvents']),_0x58a3ae=_0x14f8c4(0x21b)+_0x1dcc37[_0x14f8c4(0x1de)]();if(!_0x45c7fb[_0x14f8c4(0x1ce)](_0x58a3ae)){console[_0x14f8c4(0x1c0)](_0x14f8c4(0x1d2)+_0x58a3ae+_0x14f8c4(0x212)+_0xe1ca6d[_0x14f8c4(0x1f0)]);return;}console[_0x14f8c4(0x1c0)](_0x14f8c4(0x215)+_0x58a3ae+'\x20webhook\x20to\x20'+_0xe1ca6d[_0x14f8c4(0x1ca)][_0x14f8c4(0x1ea)][_0x14f8c4(0x1b3)]);const _0x5423b2={'event':_0x58a3ae,'payment':{'id':_0xe1ca6d['id'],'status':_0x1dcc37,'amount':_0xe1ca6d[_0x14f8c4(0x1b5)],'currency':_0xe1ca6d['currency'],'gateway':_0xe1ca6d[_0x14f8c4(0x1fb)],'gatewayPaymentId':_0xe1ca6d['gatewayPaymentId'],'createdAt':_0xe1ca6d['createdAt'],'updatedAt':new Date()}};console[_0x14f8c4(0x1c0)](_0x14f8c4(0x1df)+_0xe1ca6d[_0x14f8c4(0x1f0)]);}catch(_0x5ce891){console[_0x14f8c4(0x1e6)](_0x14f8c4(0x1c1)+_0xe1ca6d['id']+':',_0x5ce891);}}async['sendPaymentStatusNotification'](_0x319cc1,_0x3ec5ae){const _0x172ddc=a51_0x207463;try{console[_0x172ddc(0x1c0)]('üì±\x20[TELEGRAM]\x20Payment\x20'+_0x319cc1['id']+'\x20status\x20changed:\x20'+_0x319cc1['status']+_0x172ddc(0x1cf)+_0x3ec5ae);}catch(_0x414fb7){console[_0x172ddc(0x1e6)](_0x172ddc(0x1e3)+_0x319cc1['id']+':',_0x414fb7);}}[a51_0x207463(0x1c3)](_0x5cb9b8,_0x25b65a,_0x24d73d,_0x6c6440,_0x3cdc60,_0x208222){const _0x119dc1=a51_0x207463,_0x194b45={'paymentId':_0x5cb9b8,'gatewayPaymentId':_0x25b65a,'oldStatus':_0x24d73d,'newStatus':_0x6c6440,'action':_0x3cdc60,'timestamp':new Date()['toISOString'](),..._0x208222};console[_0x119dc1(0x1c0)](_0x119dc1(0x1bd),_0x194b45),loggerService_1[_0x119dc1(0x1c9)][_0x119dc1(0x20b)]('rapyd',_0x119dc1(0x19d),'STATUS_UPDATE',_0x194b45);}['logRapydError'](_0x2e0417,_0x37cae3,_0x510551,_0x29f832,_0x22213a){const _0x6c979b=a51_0x207463,_0x4c83a4={'paymentId':_0x2e0417,'gatewayPaymentId':_0x37cae3,'action':_0x29f832,'error':_0x510551 instanceof Error?_0x510551[_0x6c979b(0x197)]:String(_0x510551),'timestamp':new Date()['toISOString'](),..._0x22213a};console['error']('‚ùå\x20[RAPYD_ERROR]\x20Payment\x20error:',_0x4c83a4),loggerService_1[_0x6c979b(0x1c9)][_0x6c979b(0x1ee)](_0x6c979b(0x1ab),_0x6c979b(0x19d),_0x29f832+':\x20'+_0x4c83a4[_0x6c979b(0x1e6)]);}['getPaymentTimerInfo'](_0x3b92a9){const _0x1ffb73=a51_0x207463,_0x555951=this['paymentTimers'][_0x1ffb73(0x1e1)](_0x3b92a9);if(!_0x555951)return{'hasTimers':![],'message':_0x1ffb73(0x196)};return{'hasTimers':!![],'paymentId':_0x555951[_0x1ffb73(0x1d6)],'gatewayPaymentId':_0x555951[_0x1ffb73(0x1ff)],'createdAt':_0x555951[_0x1ffb73(0x20c)],'activeTimers':_0x555951['timers'][_0x1ffb73(0x20d)],'message':_0x555951[_0x1ffb73(0x1a5)][_0x1ffb73(0x20d)]+_0x1ffb73(0x1a0)};}[a51_0x207463(0x1eb)](){const _0x3b66fe=a51_0x207463;return{'activeTimers':this['paymentTimers'][_0x3b66fe(0x1ac)],'totalChecksScheduled':Array['from'](this['paymentTimers'][_0x3b66fe(0x1a7)]())[_0x3b66fe(0x1fc)]((_0x543cb4,_0x3f33a5)=>_0x543cb4+_0x3f33a5[_0x3b66fe(0x1a5)][_0x3b66fe(0x20d)],0x0)};}[a51_0x207463(0x1c8)](){const _0x590943=a51_0x207463;console[_0x590943(0x1c0)](_0x590943(0x199));for(const [_0x11dcfc,_0x39dfee]of this[_0x590943(0x1a3)]){_0x39dfee['timers'][_0x590943(0x1a2)](_0x15495b=>clearTimeout(_0x15495b)),console[_0x590943(0x1c0)](_0x590943(0x1da)+_0x11dcfc);}this[_0x590943(0x1a3)]['clear'](),console[_0x590943(0x1c0)](_0x590943(0x21e));}}exports[a51_0x207463(0x1e7)]=RapydStatusService,exports[a51_0x207463(0x1a6)]=new RapydStatusService();