'use strict';const a35_0x5a3038=a35_0x702d;(function(_0x4a3e83,_0x39a57e){const _0x433988=a35_0x702d,_0x41d13a=_0x4a3e83();while(!![]){try{const _0x258f50=parseInt(_0x433988(0x15d))/0x1+-parseInt(_0x433988(0xc7))/0x2*(-parseInt(_0x433988(0x136))/0x3)+-parseInt(_0x433988(0x178))/0x4+-parseInt(_0x433988(0xc4))/0x5*(-parseInt(_0x433988(0x115))/0x6)+parseInt(_0x433988(0x174))/0x7*(parseInt(_0x433988(0x161))/0x8)+-parseInt(_0x433988(0x14c))/0x9+-parseInt(_0x433988(0xd6))/0xa;if(_0x258f50===_0x39a57e)break;else _0x41d13a['push'](_0x41d13a['shift']());}catch(_0x60457b){_0x41d13a['push'](_0x41d13a['shift']());}}}(a35_0x4889,0x8c7f1));var __importDefault=this&&this['__importDefault']||function(_0x2aa3f1){const _0x317473=a35_0x702d;return _0x2aa3f1&&_0x2aa3f1[_0x317473(0x10f)]?_0x2aa3f1:{'default':_0x2aa3f1};};Object[a35_0x5a3038(0x155)](exports,a35_0x5a3038(0x10f),{'value':!![]}),exports['AdminService']=void 0x0;const database_1=__importDefault(require(a35_0x5a3038(0x12a))),bcryptjs_1=__importDefault(require(a35_0x5a3038(0xeb))),crypto_1=__importDefault(require(a35_0x5a3038(0x11e))),currencyService_1=require('./currencyService');function a35_0x4889(){const _0x1935f0=['Noda','Telegram\x20username\x20already\x20exists','password','paymentGateways','shopUrl','oldestPaymentDate','\x20USDT\x20total','getAllUsers','hex','payout','merchantEarnings','filter','updateCustomerData','sk_','SUSPENDED','getAllPayouts','merchantUrl','toUpperCase','amountUSDT','\x20\x20\x20üìÖ\x20This\x20month:\x20','\x20\x20\x20üë§\x20Merchant\x20earnings:\x20','whiteUrl','suspendUser','__esModule','amountAfterCommissionUSDT','shop','customerName','gateways','telegram','6baBDPk','custom','insensitive','delete','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','currencyService','localeCompare','name','length','crypto','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','period','error','telegramId','üìä\x20Getting\x20merchant\x20statistics\x20with\x20filters:','90d','chargebackAmount','desc','pendingUrl','currency','shopId','../config/database','date','gatewayEarnings','createdAt','gatewaySettings','CoinToPay','totalPayments','split','status','getSystemStatistics','toISOString','gatewayOrderId','3LwYnSg','CHARGEBACK','paidAt','getMerchantsAwaitingPayout','toLowerCase','parse','totalTurnover','findUnique','commissionUSDT','\x20paid\x20payments','ceil','externalPaymentUrl','getPayoutStats','test_gateway','KLYME\x20DE','PAID','\x20to\x20','createUser','KLYME\x20GB','lte','üìä\x20Merchant\x20statistics\x20calculated:','\x20USDT\x20(before\x20commission)','9306054eSgzRV','reduce','getMonth','publicKey','log','\x20->\x20','findMany','totalCommissionRate','hash','defineProperty','includes','periodFrom','usdcPolygonWallet','\x20USDT\x20(after\x20commission)','week','paymentsCount','updatedAt','784378QQYdkf','‚úÖ\x20Payment\x20','getMerchantStatistics','turnover','538264wHrjMD','\x20\x20\x20üåç\x20Country:\x20','usdtPolygonWallet','deletePayout','ACTIVE','toString','Payment\x20not\x20found','\x20paid\x20payments\x20for\x20analysis','usdtTrcWallet','thisMonth','updatePaymentStatus','\x20USDT)','set','map','activateUser','failureMessage','statusChangedBy','commission','Error\x20processing\x20payment\x20','7PmlSQE','\x20\x20\x20üí∞\x20Total\x20turnover:\x20','\x20\x20\x20üíµ\x20Available\x20balance:\x20','\x20for\x20shop\x20','749576WRDoYe','AdminService','totalAmountUSDT','Rapyd','periodTo','totalAmountAfterCommissionUSDT','statusChangedAt','\x20merchants,\x20','convertToUSDT','üí∞\x20Found\x20','paidOutUSDT','randomBytes','sort','customerCountry','default','createPayout','30d','merchantPaid','amount','üìä\x20Calculating\x20payout\x20statistics...','customerUa','gatewayBreakdown','5729090PHMLLD','not\x20set','\x20payments\x20awaiting\x20payout','1480552ZeZgHR','gateway','getTime','averageCommissionRate','gte','username','fullName','forEach','customerIp','awaitingPayout','wallets','Shop\x20not\x20found','successUrl','payment','\x20\x20\x20üìä\x20Total\x20payments:\x20','9408820aWxOTO','averageCheckUSDT','üìÖ\x20Period:\x20','\x20\x20\x20üè™\x20Gateway\x20earnings:\x20','slice','dateFrom','count','\x20USDT\x20(pending\x20payout)','create','stringify','getGatewayDisplayName','usdtErcWallet','COMPLETED','values','orderId','network','toFixed','update','\x20USDT\x20(paid\x20to\x20merchants)','notes','failUrl','bcryptjs','getPaymentById','all','merchantEarningsUSDT','availableBalance','adminNotes','txid','round','turnoverUSDT','getPayoutById','updateUser','üîÑ\x20Updating\x20customer\x20data\x20for\x20payment\x20','customerEmail'];a35_0x4889=function(){return _0x1935f0;};return a35_0x4889();}function a35_0x702d(_0x4a6759,_0x9ee319){const _0x48899a=a35_0x4889();return a35_0x702d=function(_0x702d87,_0x5e4b23){_0x702d87=_0x702d87-0xbf;let _0x4016e2=_0x48899a[_0x702d87];return _0x4016e2;},a35_0x702d(_0x4a6759,_0x9ee319);}class AdminService{async[a35_0x5a3038(0x142)](){const _0x172160=a35_0x5a3038;console[_0x172160(0x150)](_0x172160(0xc1));const _0x1380db=await database_1[_0x172160(0x186)]['payment'][_0x172160(0x152)]({'where':{'status':_0x172160(0x145),'paidAt':{'not':null}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'merchantPaid':!![],'paidAt':!![],'createdAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console['log'](_0x172160(0x181)+_0x1380db['length']+_0x172160(0x13f));let _0x4957aa=0x0,_0x43f7f2=0x0,_0x599340=0x0;for(const _0x1634ff of _0x1380db){try{const _0x5342fc=await currencyService_1[_0x172160(0x11a)][_0x172160(0x180)](_0x1634ff[_0x172160(0xc0)],_0x1634ff['currency']);let _0xbc0f87={};if(_0x1634ff[_0x172160(0x111)][_0x172160(0x12e)])try{_0xbc0f87=JSON[_0x172160(0x13b)](_0x1634ff['shop'][_0x172160(0x12e)]);}catch(_0x4bcd74){console[_0x172160(0x121)]('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x1634ff['shopId']+':',_0x4bcd74);}const _0x48a930=_0xbc0f87[_0x172160(0x172)]||0xa,_0x57ca97=_0x5342fc*(0x1-_0x48a930/0x64);_0x1634ff[_0x172160(0xbf)]?(_0x4957aa+=_0x57ca97,console[_0x172160(0x150)](_0x172160(0x15e)+_0x1634ff['id']+':\x20'+_0x57ca97[_0x172160(0xe6)](0x2)+'\x20USDT\x20(paid\x20out)')):(_0x43f7f2+=_0x57ca97,_0x599340+=_0x5342fc,console['log']('‚è≥\x20Payment\x20'+_0x1634ff['id']+':\x20'+_0x57ca97[_0x172160(0xe6)](0x2)+_0x172160(0xdd)));}catch(_0x275d83){console[_0x172160(0x121)](_0x172160(0x173)+_0x1634ff['id']+':',_0x275d83);}}const _0x4f33e0=new Date(),_0x3ce0c2=new Date(_0x4f33e0['getFullYear'](),_0x4f33e0[_0x172160(0x14e)](),0x1),_0xb95b73=new Date(_0x4f33e0['getFullYear'](),_0x4f33e0[_0x172160(0x14e)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x2c45f3=await database_1['default'][_0x172160(0x101)]['findMany']({'where':{'createdAt':{'gte':_0x3ce0c2,'lte':_0xb95b73},'status':_0x172160(0xe2)},'select':{'amount':!![]}}),_0x26e333=_0x2c45f3[_0x172160(0x14d)]((_0x30e68e,_0x3be84a)=>_0x30e68e+_0x3be84a['amount'],0x0),_0x2bf16b={'totalPayout':Math['round'](_0x4957aa*0x64)/0x64,'awaitingPayout':Math[_0x172160(0xf2)](_0x43f7f2*0x64)/0x64,'thisMonth':Math[_0x172160(0xf2)](_0x26e333*0x64)/0x64,'availableBalance':Math['round'](_0x599340*0x64)/0x64};return console['log']('üìä\x20Payout\x20statistics\x20calculated:'),console[_0x172160(0x150)]('\x20\x20\x20üí∞\x20Total\x20payout:\x20'+_0x2bf16b['totalPayout']+_0x172160(0xe8)),console[_0x172160(0x150)](_0x172160(0x11f)+_0x2bf16b[_0x172160(0xd0)]+_0x172160(0x159)),console[_0x172160(0x150)](_0x172160(0x176)+_0x2bf16b[_0x172160(0xef)]+_0x172160(0x14b)),console[_0x172160(0x150)](_0x172160(0x10b)+_0x2bf16b[_0x172160(0x16a)]+'\x20USDT'),_0x2bf16b;}async[a35_0x5a3038(0x104)](_0x170137,_0x3ef1b6){const _0x42ad58=a35_0x5a3038;console['log'](_0x42ad58(0xf6)+_0x170137+':',_0x3ef1b6);const _0x868246=await database_1[_0x42ad58(0x186)][_0x42ad58(0xd4)][_0x42ad58(0x13d)]({'where':{'id':_0x170137},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x868246)throw new Error(_0x42ad58(0x167));const _0x2b12a8={};_0x3ef1b6[_0x42ad58(0x185)]!==undefined&&(_0x2b12a8[_0x42ad58(0x185)]=_0x3ef1b6[_0x42ad58(0x185)]||null);_0x3ef1b6['customerIp']!==undefined&&(_0x2b12a8[_0x42ad58(0xcf)]=_0x3ef1b6[_0x42ad58(0xcf)]||null);_0x3ef1b6[_0x42ad58(0xc2)]!==undefined&&(_0x2b12a8[_0x42ad58(0xc2)]=_0x3ef1b6[_0x42ad58(0xc2)]||null);const _0xc1b6ef=await database_1[_0x42ad58(0x186)][_0x42ad58(0xd4)]['update']({'where':{'id':_0x170137},'data':{..._0x2b12a8,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x42ad58(0x150)]('‚úÖ\x20Customer\x20data\x20updated\x20for\x20payment\x20'+_0x170137),console[_0x42ad58(0x150)](_0x42ad58(0x162)+_0x868246['customerCountry']+'\x20->\x20'+_0xc1b6ef[_0x42ad58(0x185)]),console[_0x42ad58(0x150)]('\x20\x20\x20üåê\x20IP:\x20'+_0x868246[_0x42ad58(0xcf)]+_0x42ad58(0x151)+_0xc1b6ef[_0x42ad58(0xcf)]),console[_0x42ad58(0x150)]('\x20\x20\x20üñ•Ô∏è\x20User\x20Agent:\x20'+(_0x868246[_0x42ad58(0xc2)]?_0x42ad58(0x16d):_0x42ad58(0xc5))+_0x42ad58(0x151)+(_0xc1b6ef[_0x42ad58(0xc2)]?_0x42ad58(0x16d):_0x42ad58(0xc5))),_0xc1b6ef;}async[a35_0x5a3038(0x133)](_0xb54bc7){const _0x5aaac3=a35_0x5a3038,_0x419ae6=new Date();let _0x5d9029;switch(_0xb54bc7){case'7d':_0x5d9029=new Date(_0x419ae6[_0x5aaac3(0xc9)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x5aaac3(0x188):_0x5d9029=new Date(_0x419ae6[_0x5aaac3(0xc9)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x5aaac3(0x124):_0x5d9029=new Date(_0x419ae6['getTime']()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x5d9029=new Date(_0x419ae6[_0x5aaac3(0xc9)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x119c76,_0x4e63d9,_0x5a2b73,_0x5cab47,_0x5d3f97,_0x274099]=await Promise[_0x5aaac3(0xed)]([database_1[_0x5aaac3(0x186)][_0x5aaac3(0x111)][_0x5aaac3(0xdc)](),database_1[_0x5aaac3(0x186)][_0x5aaac3(0x111)][_0x5aaac3(0xdc)]({'where':{'status':'ACTIVE'}}),database_1[_0x5aaac3(0x186)]['payment'][_0x5aaac3(0xdc)]({'where':{'createdAt':{'gte':_0x5d9029},'gateway':{'not':'test_gateway'}}}),database_1[_0x5aaac3(0x186)][_0x5aaac3(0xd4)][_0x5aaac3(0xdc)]({'where':{'status':_0x5aaac3(0x145),'createdAt':{'gte':_0x5d9029},'gateway':{'not':_0x5aaac3(0x143)}}}),database_1['default'][_0x5aaac3(0xd4)][_0x5aaac3(0x152)]({'where':{'status':'PAID','createdAt':{'gte':_0x5d9029},'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![]}}),database_1[_0x5aaac3(0x186)][_0x5aaac3(0xd4)][_0x5aaac3(0x152)]({'where':{'gateway':{'not':_0x5aaac3(0x143)}},'take':0xa,'orderBy':{'createdAt':_0x5aaac3(0x126)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}})]);let _0x4760d0=0x0;for(const _0x28bc23 of _0x5d3f97){const _0x369309=await currencyService_1[_0x5aaac3(0x11a)][_0x5aaac3(0x180)](_0x28bc23[_0x5aaac3(0xc0)],_0x28bc23[_0x5aaac3(0x128)]);_0x4760d0+=_0x369309;}const _0x7e0ef7=_0x5a2b73>0x0?_0x5cab47/_0x5a2b73*0x64:0x0;return{'totalShops':_0x119c76,'activeShops':_0x4e63d9,'totalPayments':_0x5a2b73,'successfulPayments':_0x5cab47,'totalRevenue':Math['round'](_0x4760d0*0x64)/0x64,'conversionRate':Math['round'](_0x7e0ef7*0x64)/0x64,'recentPayments':_0x274099['map'](_0x3ccf23=>({'id':_0x3ccf23['id'],'amount':_0x3ccf23[_0x5aaac3(0xc0)],'currency':_0x3ccf23['currency'],'status':_0x3ccf23[_0x5aaac3(0x132)],'gateway':_0x3ccf23['gateway'],'shop':_0x3ccf23[_0x5aaac3(0x111)],'createdAt':_0x3ccf23[_0x5aaac3(0x12d)]}))};}async[a35_0x5a3038(0x15f)](_0x348451){const _0x2ed8c7=a35_0x5a3038;console[_0x2ed8c7(0x150)](_0x2ed8c7(0x123),_0x348451);let _0xaf193d,_0x567c84=new Date();if(_0x348451[_0x2ed8c7(0x120)]===_0x2ed8c7(0x116)&&_0x348451[_0x2ed8c7(0xdb)]&&_0x348451['dateTo'])_0xaf193d=new Date(_0x348451['dateFrom']),_0x567c84=new Date(_0x348451['dateTo']);else{const _0x419848=new Date();switch(_0x348451['period']){case _0x2ed8c7(0x15a):_0xaf193d=new Date(_0x419848['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'month':_0xaf193d=new Date(_0x419848[_0x2ed8c7(0xc9)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'year':_0xaf193d=new Date(_0x419848[_0x2ed8c7(0xc9)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x2ed8c7(0xed):default:_0xaf193d=new Date('2020-01-01');break;}}console[_0x2ed8c7(0x150)](_0x2ed8c7(0xd8)+_0xaf193d['toISOString']()+_0x2ed8c7(0x146)+_0x567c84[_0x2ed8c7(0x134)]());const _0x90d9af={'status':_0x2ed8c7(0x145),'gateway':{'not':_0x2ed8c7(0x143)},'paidAt':{'gte':_0xaf193d,'lte':_0x567c84}};_0x348451[_0x2ed8c7(0x129)]&&(_0x90d9af[_0x2ed8c7(0x129)]=_0x348451[_0x2ed8c7(0x129)]);const _0x7ac87c=await database_1['default'][_0x2ed8c7(0xd4)]['findMany']({'where':_0x90d9af,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console['log'](_0x2ed8c7(0x181)+_0x7ac87c['length']+_0x2ed8c7(0x168));let _0x44fcec=0x0,_0x2ed3e2=0x0,_0xb9ba92=0x0;const _0xe5ab7f={},_0x275151={},_0x19d631={};for(const _0x133aa0 of _0x7ac87c){try{const _0xf0ecfd=await currencyService_1[_0x2ed8c7(0x11a)]['convertToUSDT'](_0x133aa0[_0x2ed8c7(0xc0)],_0x133aa0[_0x2ed8c7(0x128)]);let _0x588dd1={};if(_0x133aa0[_0x2ed8c7(0x111)][_0x2ed8c7(0x12e)])try{_0x588dd1=JSON['parse'](_0x133aa0['shop']['gatewaySettings']);}catch(_0x384bac){console[_0x2ed8c7(0x121)](_0x2ed8c7(0x119)+_0x133aa0[_0x2ed8c7(0x129)]+':',_0x384bac);}const _0x13387e=_0x588dd1[_0x2ed8c7(0x172)]||0xa,_0x578bc1=_0xf0ecfd*(_0x13387e/0x64),_0x5873ab=_0xf0ecfd-_0x578bc1;_0x44fcec+=_0xf0ecfd,_0x2ed3e2+=_0x5873ab,_0xb9ba92+=_0x578bc1;!_0xe5ab7f[_0x133aa0[_0x2ed8c7(0xc8)]]&&(_0xe5ab7f[_0x133aa0[_0x2ed8c7(0xc8)]]={'gateway':_0x133aa0[_0x2ed8c7(0xc8)],'gatewayDisplayName':this[_0x2ed8c7(0xe0)](_0x133aa0[_0x2ed8c7(0xc8)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0xe5ab7f[_0x133aa0['gateway']][_0x2ed8c7(0x15b)]++,_0xe5ab7f[_0x133aa0['gateway']][_0x2ed8c7(0xf3)]+=_0xf0ecfd,_0xe5ab7f[_0x133aa0['gateway']]['commissionUSDT']+=_0x578bc1,_0xe5ab7f[_0x133aa0[_0x2ed8c7(0xc8)]][_0x2ed8c7(0xee)]+=_0x5873ab,_0xe5ab7f[_0x133aa0['gateway']][_0x2ed8c7(0x153)]+=_0x13387e;!_0x348451[_0x2ed8c7(0x129)]&&(!_0x275151[_0x133aa0[_0x2ed8c7(0x129)]]&&(_0x275151[_0x133aa0[_0x2ed8c7(0x129)]]={'shopId':_0x133aa0[_0x2ed8c7(0x129)],'shopName':_0x133aa0['shop'][_0x2ed8c7(0x11c)],'shopUsername':_0x133aa0['shop'][_0x2ed8c7(0xcc)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x275151[_0x133aa0[_0x2ed8c7(0x129)]][_0x2ed8c7(0x15b)]++,_0x275151[_0x133aa0[_0x2ed8c7(0x129)]][_0x2ed8c7(0xf3)]+=_0xf0ecfd,_0x275151[_0x133aa0['shopId']][_0x2ed8c7(0x13e)]+=_0x578bc1,_0x275151[_0x133aa0[_0x2ed8c7(0x129)]][_0x2ed8c7(0xee)]+=_0x5873ab);const _0x12786c=_0x133aa0[_0x2ed8c7(0x138)][_0x2ed8c7(0x134)]()[_0x2ed8c7(0x131)]('T')[0x0];!_0x19d631[_0x12786c]&&(_0x19d631[_0x12786c]={'date':_0x12786c,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x19d631[_0x12786c]['turnover']+=_0xf0ecfd,_0x19d631[_0x12786c][_0x2ed8c7(0x102)]+=_0x5873ab,_0x19d631[_0x12786c]['gatewayEarnings']+=_0x578bc1,_0x19d631[_0x12786c][_0x2ed8c7(0x15b)]++;}catch(_0x25adfb){console[_0x2ed8c7(0x121)](_0x2ed8c7(0x173)+_0x133aa0['id']+':',_0x25adfb);}}Object['values'](_0xe5ab7f)[_0x2ed8c7(0xce)](_0x6dc035=>{const _0x2d9373=_0x2ed8c7;_0x6dc035[_0x2d9373(0xca)]=_0x6dc035['paymentsCount']>0x0?_0x6dc035[_0x2d9373(0x153)]/_0x6dc035[_0x2d9373(0x15b)]:0x0,delete _0x6dc035[_0x2d9373(0x153)];}),Object[_0x2ed8c7(0xe3)](_0x275151)[_0x2ed8c7(0xce)](_0x5b5a00=>{const _0x5985ea=_0x2ed8c7;_0x5b5a00[_0x5985ea(0xd7)]=_0x5b5a00['paymentsCount']>0x0?_0x5b5a00[_0x5985ea(0xf3)]/_0x5b5a00[_0x5985ea(0x15b)]:0x0;});let _0x5b8331=0x0;if(_0x348451[_0x2ed8c7(0x129)]){const _0x2945b5=await database_1['default'][_0x2ed8c7(0x101)][_0x2ed8c7(0x152)]({'where':{'shopId':_0x348451[_0x2ed8c7(0x129)],'status':_0x2ed8c7(0xe2),'createdAt':{'gte':_0xaf193d,'lte':_0x567c84}},'select':{'amount':!![]}});_0x5b8331=_0x2945b5[_0x2ed8c7(0x14d)]((_0x5d1268,_0x3f9790)=>_0x5d1268+_0x3f9790['amount'],0x0);}const _0xa4243f=_0x7ac87c[_0x2ed8c7(0x11d)],_0xf6bdef=_0x7ac87c['length'],_0x11cfd7=_0xa4243f>0x0?_0x44fcec/_0xa4243f:0x0,_0x3c9137=0x64,_0x28e58a=Math[_0x2ed8c7(0x140)]((_0x567c84[_0x2ed8c7(0xc9)]()-_0xaf193d[_0x2ed8c7(0xc9)]())/(0x3e8*0x3c*0x3c*0x18)),_0xfb6e41={'totalTurnover':Math['round'](_0x44fcec*0x64)/0x64,'merchantEarnings':Math[_0x2ed8c7(0xf2)](_0x2ed3e2*0x64)/0x64,'gatewayEarnings':Math[_0x2ed8c7(0xf2)](_0xb9ba92*0x64)/0x64,'totalPaidOut':Math['round'](_0x5b8331*0x64)/0x64,'averageCheck':Math['round'](_0x11cfd7*0x64)/0x64,'totalPayments':_0xa4243f,'successfulPayments':_0xf6bdef,'conversionRate':_0x3c9137,'gatewayBreakdown':Object[_0x2ed8c7(0xe3)](_0xe5ab7f)[_0x2ed8c7(0x16e)](_0x35c41b=>({..._0x35c41b,'turnoverUSDT':Math[_0x2ed8c7(0xf2)](_0x35c41b[_0x2ed8c7(0xf3)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x35c41b[_0x2ed8c7(0x13e)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x2ed8c7(0xf2)](_0x35c41b['merchantEarningsUSDT']*0x64)/0x64,'averageCommissionRate':Math['round'](_0x35c41b[_0x2ed8c7(0xca)]*0x64)/0x64})),'merchantBreakdown':_0x348451[_0x2ed8c7(0x129)]?undefined:Object[_0x2ed8c7(0xe3)](_0x275151)[_0x2ed8c7(0x16e)](_0x41893d=>({..._0x41893d,'turnoverUSDT':Math[_0x2ed8c7(0xf2)](_0x41893d['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x2ed8c7(0xf2)](_0x41893d['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x2ed8c7(0xf2)](_0x41893d['merchantEarningsUSDT']*0x64)/0x64,'paidOutUSDT':Math['round'](_0x41893d[_0x2ed8c7(0x182)]*0x64)/0x64,'averageCheckUSDT':Math[_0x2ed8c7(0xf2)](_0x41893d[_0x2ed8c7(0xd7)]*0x64)/0x64})),'dailyData':Object['values'](_0x19d631)['map'](_0x3be44a=>({..._0x3be44a,'turnover':Math[_0x2ed8c7(0xf2)](_0x3be44a[_0x2ed8c7(0x160)]*0x64)/0x64,'merchantEarnings':Math[_0x2ed8c7(0xf2)](_0x3be44a[_0x2ed8c7(0x102)]*0x64)/0x64,'gatewayEarnings':Math[_0x2ed8c7(0xf2)](_0x3be44a['gatewayEarnings']*0x64)/0x64}))[_0x2ed8c7(0x184)]((_0x4bd0db,_0x1fa608)=>_0x4bd0db[_0x2ed8c7(0x12b)][_0x2ed8c7(0x11b)](_0x1fa608['date'])),'periodInfo':{'from':_0xaf193d,'to':_0x567c84,'periodType':_0x348451[_0x2ed8c7(0x120)]||'custom','daysCount':_0x28e58a}};return console[_0x2ed8c7(0x150)](_0x2ed8c7(0x14a)),console[_0x2ed8c7(0x150)](_0x2ed8c7(0x175)+_0xfb6e41[_0x2ed8c7(0x13c)]+'\x20USDT'),console[_0x2ed8c7(0x150)](_0x2ed8c7(0x10c)+_0xfb6e41[_0x2ed8c7(0x102)]+'\x20USDT'),console[_0x2ed8c7(0x150)](_0x2ed8c7(0xd9)+_0xfb6e41[_0x2ed8c7(0x12c)]+'\x20USDT'),console[_0x2ed8c7(0x150)](_0x2ed8c7(0xd5)+_0xfb6e41[_0x2ed8c7(0x130)]),_0xfb6e41;}[a35_0x5a3038(0xe0)](_0x17de09){const _0x17e47c=a35_0x5a3038,_0x244b0e={'plisio':'Plisio','rapyd':_0x17e47c(0x17b),'noda':_0x17e47c(0xf8),'cointopay':_0x17e47c(0x12f),'klyme_eu':'KLYME\x20EU','klyme_gb':_0x17e47c(0x148),'klyme_de':_0x17e47c(0x144)};return _0x244b0e[_0x17de09]||_0x17de09;}async[a35_0x5a3038(0x139)](_0x44ebdc){const _0x214ade=a35_0x5a3038,{page:_0x17a877,limit:_0x490329,minAmount:_0x2ea637,search:_0x4640b7}=_0x44ebdc,_0x579660=(_0x17a877-0x1)*_0x490329;console['log']('üìä\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:',_0x44ebdc);const _0x4a773e=await database_1['default']['payment'][_0x214ade(0x152)]({'where':{'status':_0x214ade(0x145),'merchantPaid':![],'paidAt':{'not':null}},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'gatewaySettings':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}});console[_0x214ade(0x150)](_0x214ade(0x181)+_0x4a773e[_0x214ade(0x11d)]+_0x214ade(0xc6));const _0x1121ce={};for(const _0x27be8e of _0x4a773e){const _0x280bae=_0x27be8e[_0x214ade(0x129)];!_0x1121ce[_0x280bae]&&(_0x1121ce[_0x280bae]={'id':_0x27be8e['shop']['id'],'fullName':_0x27be8e[_0x214ade(0x111)][_0x214ade(0x11c)],'username':_0x27be8e[_0x214ade(0x111)][_0x214ade(0xcc)],'telegramId':_0x27be8e[_0x214ade(0x111)][_0x214ade(0x114)],'merchantUrl':_0x27be8e[_0x214ade(0x111)][_0x214ade(0xfc)],'wallets':{'usdtPolygonWallet':_0x27be8e['shop'][_0x214ade(0x163)],'usdtTrcWallet':_0x27be8e[_0x214ade(0x111)][_0x214ade(0x169)],'usdtErcWallet':_0x27be8e[_0x214ade(0x111)][_0x214ade(0xe1)],'usdcPolygonWallet':_0x27be8e[_0x214ade(0x111)][_0x214ade(0x158)]},'totalAmountUSDT':0x0,'totalAmountAfterCommissionUSDT':0x0,'paymentsCount':0x0,'oldestPaymentDate':_0x27be8e[_0x214ade(0x138)],'gatewayBreakdown':{},'gatewaySettings':_0x27be8e['shop'][_0x214ade(0x12e)]});try{const _0x5b66da=await currencyService_1[_0x214ade(0x11a)][_0x214ade(0x180)](_0x27be8e[_0x214ade(0xc0)],_0x27be8e[_0x214ade(0x128)]);let _0x1040f5={};if(_0x27be8e[_0x214ade(0x111)][_0x214ade(0x12e)])try{_0x1040f5=JSON[_0x214ade(0x13b)](_0x27be8e[_0x214ade(0x111)][_0x214ade(0x12e)]);}catch(_0x30448e){console[_0x214ade(0x121)](_0x214ade(0x119)+_0x280bae+':',_0x30448e);}const _0x4b36d8=_0x1040f5[_0x214ade(0x172)]||0xa,_0x49cc1d=_0x5b66da*(0x1-_0x4b36d8/0x64);_0x1121ce[_0x280bae]['totalAmountUSDT']+=_0x5b66da,_0x1121ce[_0x280bae]['totalAmountAfterCommissionUSDT']+=_0x49cc1d,_0x1121ce[_0x280bae][_0x214ade(0x15b)]++,_0x27be8e[_0x214ade(0x138)]<_0x1121ce[_0x280bae][_0x214ade(0xfd)]&&(_0x1121ce[_0x280bae][_0x214ade(0xfd)]=_0x27be8e[_0x214ade(0x138)]),!_0x1121ce[_0x280bae][_0x214ade(0xc3)][_0x27be8e[_0x214ade(0xc8)]]&&(_0x1121ce[_0x280bae][_0x214ade(0xc3)][_0x27be8e[_0x214ade(0xc8)]]={'gateway':_0x27be8e[_0x214ade(0xc8)],'count':0x0,'amountUSDT':0x0,'amountAfterCommissionUSDT':0x0,'commission':_0x4b36d8}),_0x1121ce[_0x280bae][_0x214ade(0xc3)][_0x27be8e['gateway']][_0x214ade(0xdc)]++,_0x1121ce[_0x280bae][_0x214ade(0xc3)][_0x27be8e['gateway']][_0x214ade(0x10a)]+=_0x5b66da,_0x1121ce[_0x280bae]['gatewayBreakdown'][_0x27be8e[_0x214ade(0xc8)]][_0x214ade(0x110)]+=_0x49cc1d;}catch(_0x4609ac){console[_0x214ade(0x121)](_0x214ade(0x173)+_0x27be8e['id']+':',_0x4609ac);}}let _0x243341=Object[_0x214ade(0xe3)](_0x1121ce)[_0x214ade(0x16e)](_0x23e09a=>({..._0x23e09a,'totalAmountUSDT':Math['round'](_0x23e09a['totalAmountUSDT']*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x214ade(0xf2)](_0x23e09a[_0x214ade(0x17d)]*0x64)/0x64,'gatewayBreakdown':Object[_0x214ade(0xe3)](_0x23e09a[_0x214ade(0xc3)])[_0x214ade(0x16e)](_0x3965a8=>({..._0x3965a8,'amountUSDT':Math[_0x214ade(0xf2)](_0x3965a8[_0x214ade(0x10a)]*0x64)/0x64,'amountAfterCommissionUSDT':Math['round'](_0x3965a8[_0x214ade(0x110)]*0x64)/0x64}))}));_0x2ea637&&(_0x243341=_0x243341[_0x214ade(0x103)](_0x27fe67=>_0x27fe67['totalAmountAfterCommissionUSDT']>=_0x2ea637));if(_0x4640b7){const _0x4f0a9c=_0x4640b7[_0x214ade(0x13a)]();_0x243341=_0x243341[_0x214ade(0x103)](_0x155cb0=>_0x155cb0[_0x214ade(0xcd)][_0x214ade(0x13a)]()[_0x214ade(0x156)](_0x4f0a9c)||_0x155cb0['username'][_0x214ade(0x13a)]()[_0x214ade(0x156)](_0x4f0a9c));}_0x243341[_0x214ade(0x184)]((_0x1048c3,_0x3c7cc4)=>_0x3c7cc4['totalAmountAfterCommissionUSDT']-_0x1048c3[_0x214ade(0x17d)]);const _0x33f186=_0x243341[_0x214ade(0x11d)],_0x54c15f=_0x243341[_0x214ade(0xda)](_0x579660,_0x579660+_0x490329),_0x2aaa8a=_0x243341[_0x214ade(0x14d)]((_0xfe8f07,_0x55226f)=>_0xfe8f07+_0x55226f[_0x214ade(0x17a)],0x0),_0x5edffb=_0x243341[_0x214ade(0x14d)]((_0x38b057,_0xf51fd0)=>_0x38b057+_0xf51fd0[_0x214ade(0x17d)],0x0);return console['log']('üìä\x20Merchants\x20awaiting\x20payout:\x20'+_0x33f186+_0x214ade(0x17f)+Math[_0x214ade(0xf2)](_0x5edffb*0x64)/0x64+_0x214ade(0xfe)),{'merchants':_0x54c15f,'pagination':{'page':_0x17a877,'limit':_0x490329,'total':_0x33f186,'totalPages':Math[_0x214ade(0x140)](_0x33f186/_0x490329)},'summary':{'totalMerchants':_0x33f186,'totalAmountUSDT':Math[_0x214ade(0xf2)](_0x2aaa8a*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x5edffb*0x64)/0x64}};}async[a35_0x5a3038(0x187)](_0x562a2e){const _0x1c9e1e=a35_0x5a3038,{shopId:_0x4e577d,amount:_0x9094e0,network:_0x3d69f7,notes:_0x5073f2,periodFrom:_0x1d85ea,periodTo:_0x9cf08}=_0x562a2e,_0x55f7c5=await database_1[_0x1c9e1e(0x186)][_0x1c9e1e(0x111)]['findUnique']({'where':{'id':_0x4e577d},'select':{'id':!![],'name':!![],'username':!![]}});if(!_0x55f7c5)throw new Error(_0x1c9e1e(0xd2));const _0x510022=await database_1[_0x1c9e1e(0x186)][_0x1c9e1e(0x101)][_0x1c9e1e(0xde)]({'data':{'shopId':_0x4e577d,'amount':_0x9094e0,'network':_0x3d69f7,'status':_0x1c9e1e(0xe2),'notes':_0x5073f2,'periodFrom':_0x1d85ea?new Date(_0x1d85ea):null,'periodTo':_0x9cf08?new Date(_0x9cf08):null,'createdAt':new Date(),'paidAt':new Date()}});return console[_0x1c9e1e(0x150)]('‚úÖ\x20Payout\x20created:\x20'+_0x510022['id']+_0x1c9e1e(0x177)+_0x55f7c5['username']+'\x20('+_0x9094e0+_0x1c9e1e(0x16c)),{'id':_0x510022['id'],'shopId':_0x510022[_0x1c9e1e(0x129)],'shopName':_0x55f7c5[_0x1c9e1e(0x11c)],'shopUsername':_0x55f7c5[_0x1c9e1e(0xcc)],'amount':_0x510022[_0x1c9e1e(0xc0)],'network':_0x510022[_0x1c9e1e(0xe5)],'status':_0x510022['status'],'txid':_0x510022['txid'],'notes':_0x510022['notes'],'periodFrom':_0x510022[_0x1c9e1e(0x157)],'periodTo':_0x510022[_0x1c9e1e(0x17c)],'createdAt':_0x510022[_0x1c9e1e(0x12d)],'paidAt':_0x510022[_0x1c9e1e(0x138)]};}async[a35_0x5a3038(0x107)](_0x39fdef){const _0x35b625=a35_0x5a3038,{page:_0x3febab,limit:_0x3bdeea,shopId:_0x55bb88,network:_0x2845fb,dateFrom:_0x3879c6,dateTo:_0x3f50a9,search:_0x33331a}=_0x39fdef,_0x1080c5=(_0x3febab-0x1)*_0x3bdeea,_0x3ccdd1={};_0x55bb88&&(_0x3ccdd1[_0x35b625(0x129)]=_0x55bb88);_0x2845fb&&(_0x3ccdd1['network']=_0x2845fb);(_0x3879c6||_0x3f50a9)&&(_0x3ccdd1['createdAt']={},_0x3879c6&&(_0x3ccdd1['createdAt']['gte']=new Date(_0x3879c6)),_0x3f50a9&&(_0x3ccdd1['createdAt'][_0x35b625(0x149)]=new Date(_0x3f50a9)));_0x33331a&&(_0x3ccdd1['OR']=[{'shop':{'name':{'contains':_0x33331a,'mode':_0x35b625(0x117)}}},{'shop':{'username':{'contains':_0x33331a,'mode':_0x35b625(0x117)}}},{'notes':{'contains':_0x33331a,'mode':_0x35b625(0x117)}}]);const [_0x5b29e6,_0x40f9bc]=await Promise[_0x35b625(0xed)]([database_1['default'][_0x35b625(0x101)]['findMany']({'where':_0x3ccdd1,'skip':_0x1080c5,'take':_0x3bdeea,'orderBy':{'createdAt':_0x35b625(0x126)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x35b625(0x186)][_0x35b625(0x101)][_0x35b625(0xdc)]({'where':_0x3ccdd1})]);return{'payouts':_0x5b29e6[_0x35b625(0x16e)](_0x3bff2a=>({'id':_0x3bff2a['id'],'shopId':_0x3bff2a[_0x35b625(0x129)],'shopName':_0x3bff2a[_0x35b625(0x111)]['name'],'shopUsername':_0x3bff2a[_0x35b625(0x111)][_0x35b625(0xcc)],'amount':_0x3bff2a[_0x35b625(0xc0)],'network':_0x3bff2a[_0x35b625(0xe5)],'status':_0x3bff2a[_0x35b625(0x132)],'txid':_0x3bff2a[_0x35b625(0xf1)],'notes':_0x3bff2a[_0x35b625(0xe9)],'periodFrom':_0x3bff2a[_0x35b625(0x157)],'periodTo':_0x3bff2a[_0x35b625(0x17c)],'createdAt':_0x3bff2a[_0x35b625(0x12d)],'paidAt':_0x3bff2a[_0x35b625(0x138)]})),'pagination':{'page':_0x3febab,'limit':_0x3bdeea,'total':_0x40f9bc,'totalPages':Math[_0x35b625(0x140)](_0x40f9bc/_0x3bdeea)}};}async[a35_0x5a3038(0xf4)](_0x50d7c0){const _0x472b5b=a35_0x5a3038,_0x22efc7=await database_1['default'][_0x472b5b(0x101)][_0x472b5b(0x13d)]({'where':{'id':_0x50d7c0},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x22efc7)return null;return{'id':_0x22efc7['id'],'shopId':_0x22efc7[_0x472b5b(0x129)],'shopName':_0x22efc7[_0x472b5b(0x111)]['name'],'shopUsername':_0x22efc7[_0x472b5b(0x111)][_0x472b5b(0xcc)],'amount':_0x22efc7[_0x472b5b(0xc0)],'network':_0x22efc7['network'],'status':_0x22efc7[_0x472b5b(0x132)],'txid':_0x22efc7['txid'],'notes':_0x22efc7[_0x472b5b(0xe9)],'periodFrom':_0x22efc7[_0x472b5b(0x157)],'periodTo':_0x22efc7[_0x472b5b(0x17c)],'createdAt':_0x22efc7['createdAt'],'paidAt':_0x22efc7[_0x472b5b(0x138)]};}async[a35_0x5a3038(0x164)](_0x3d9a43){const _0x5473bc=a35_0x5a3038;await database_1[_0x5473bc(0x186)][_0x5473bc(0x101)][_0x5473bc(0x118)]({'where':{'id':_0x3d9a43}});}async['getAllPayments'](_0xcd9fc1){const _0x566595=a35_0x5a3038,{page:_0x1e306a,limit:_0x46c124,status:_0x181892,gateway:_0x14604e,shopId:_0x488d4c,dateFrom:_0x315dbf,dateTo:_0x5f3538,search:_0x3e1b9e}=_0xcd9fc1,_0x1a1d40=(_0x1e306a-0x1)*_0x46c124,_0x15769e={};_0x181892&&(_0x15769e['status']=_0x181892[_0x566595(0x109)]());_0x14604e&&(_0x15769e['gateway']=_0x14604e[_0x566595(0x13a)]());_0x15769e[_0x566595(0xc8)]=_0x15769e[_0x566595(0xc8)]?_0x15769e[_0x566595(0xc8)]:{'not':_0x566595(0x143)};if(typeof _0x15769e[_0x566595(0xc8)]==='string'&&_0x15769e[_0x566595(0xc8)]!=='test_gateway'){}else{if(typeof _0x15769e['gateway']==='string'&&_0x15769e[_0x566595(0xc8)]==='test_gateway'){}else _0x15769e['gateway']={'not':'test_gateway'};}_0x488d4c&&(_0x15769e[_0x566595(0x129)]=_0x488d4c);(_0x315dbf||_0x5f3538)&&(_0x15769e[_0x566595(0x12d)]={},_0x315dbf&&(_0x15769e[_0x566595(0x12d)][_0x566595(0xcb)]=new Date(_0x315dbf)),_0x5f3538&&(_0x15769e[_0x566595(0x12d)][_0x566595(0x149)]=new Date(_0x5f3538)));_0x3e1b9e&&(_0x15769e['OR']=[{'orderId':{'contains':_0x3e1b9e,'mode':_0x566595(0x117)}},{'gatewayOrderId':{'contains':_0x3e1b9e,'mode':_0x566595(0x117)}},{'customerEmail':{'contains':_0x3e1b9e,'mode':_0x566595(0x117)}},{'shop':{'name':{'contains':_0x3e1b9e,'mode':_0x566595(0x117)}}},{'shop':{'username':{'contains':_0x3e1b9e,'mode':_0x566595(0x117)}}}]);const [_0x1699d2,_0x5a41e7]=await Promise[_0x566595(0xed)]([database_1[_0x566595(0x186)][_0x566595(0xd4)]['findMany']({'where':_0x15769e,'skip':_0x1a1d40,'take':_0x46c124,'orderBy':{'createdAt':_0x566595(0x126)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x566595(0x186)][_0x566595(0xd4)][_0x566595(0xdc)]({'where':_0x15769e})]);return{'payments':_0x1699d2[_0x566595(0x16e)](_0x45cdb4=>({'id':_0x45cdb4['id'],'shopId':_0x45cdb4['shopId'],'gateway':_0x45cdb4['gateway'],'amount':_0x45cdb4[_0x566595(0xc0)],'currency':_0x45cdb4[_0x566595(0x128)],'status':_0x45cdb4[_0x566595(0x132)],'orderId':_0x45cdb4[_0x566595(0xe4)],'gatewayOrderId':_0x45cdb4['gatewayOrderId'],'customerEmail':_0x45cdb4[_0x566595(0xf7)],'customerName':_0x45cdb4[_0x566595(0x112)],'customerCountry':_0x45cdb4[_0x566595(0x185)],'customerIp':_0x45cdb4[_0x566595(0xcf)],'customerUa':_0x45cdb4[_0x566595(0xc2)],'failureMessage':_0x45cdb4[_0x566595(0x170)],'createdAt':_0x45cdb4[_0x566595(0x12d)],'updatedAt':_0x45cdb4[_0x566595(0x15c)],'shop':_0x45cdb4['shop']})),'pagination':{'page':_0x1e306a,'limit':_0x46c124,'total':_0x5a41e7,'totalPages':Math['ceil'](_0x5a41e7/_0x46c124)}};}async[a35_0x5a3038(0xec)](_0x250dfc){const _0x15b8e4=a35_0x5a3038,_0x180470=await database_1[_0x15b8e4(0x186)][_0x15b8e4(0xd4)][_0x15b8e4(0x13d)]({'where':{'id':_0x250dfc},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x180470)return null;return{'id':_0x180470['id'],'shopId':_0x180470[_0x15b8e4(0x129)],'gateway':_0x180470[_0x15b8e4(0xc8)],'amount':_0x180470['amount'],'currency':_0x180470[_0x15b8e4(0x128)],'status':_0x180470[_0x15b8e4(0x132)],'orderId':_0x180470[_0x15b8e4(0xe4)],'gatewayOrderId':_0x180470['gatewayOrderId'],'customerEmail':_0x180470[_0x15b8e4(0xf7)],'customerName':_0x180470[_0x15b8e4(0x112)],'customerCountry':_0x180470['customerCountry'],'customerIp':_0x180470[_0x15b8e4(0xcf)],'customerUa':_0x180470[_0x15b8e4(0xc2)],'failureMessage':_0x180470[_0x15b8e4(0x170)],'externalPaymentUrl':_0x180470[_0x15b8e4(0x141)],'successUrl':_0x180470[_0x15b8e4(0xd3)],'failUrl':_0x180470[_0x15b8e4(0xea)],'pendingUrl':_0x180470[_0x15b8e4(0x127)],'whiteUrl':_0x180470[_0x15b8e4(0x10d)],'createdAt':_0x180470[_0x15b8e4(0x12d)],'updatedAt':_0x180470[_0x15b8e4(0x15c)],'shop':_0x180470[_0x15b8e4(0x111)]};}async[a35_0x5a3038(0x16b)](_0x495eac,_0x8c0cb7,_0x5e065d,_0x3b6229){const _0x18baf9=a35_0x5a3038,_0x424fbb={'status':_0x8c0cb7[_0x18baf9(0x109)](),'updatedAt':new Date(),'statusChangedBy':'admin','statusChangedAt':new Date()};_0x5e065d&&(_0x424fbb[_0x18baf9(0xf0)]=_0x5e065d);_0x8c0cb7['toUpperCase']()===_0x18baf9(0x137)&&_0x3b6229&&(_0x424fbb[_0x18baf9(0x125)]=_0x3b6229);_0x8c0cb7[_0x18baf9(0x109)]()===_0x18baf9(0x145)&&(_0x424fbb['paidAt']=new Date());const _0xadc143=await database_1['default'][_0x18baf9(0xd4)][_0x18baf9(0xe7)]({'where':{'id':_0x495eac},'data':_0x424fbb,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return{'id':_0xadc143['id'],'shopId':_0xadc143[_0x18baf9(0x129)],'gateway':_0xadc143[_0x18baf9(0xc8)],'amount':_0xadc143['amount'],'currency':_0xadc143['currency'],'status':_0xadc143['status'],'orderId':_0xadc143['orderId'],'gatewayOrderId':_0xadc143[_0x18baf9(0x135)],'customerEmail':_0xadc143['customerEmail'],'customerName':_0xadc143[_0x18baf9(0x112)],'customerCountry':_0xadc143['customerCountry'],'customerIp':_0xadc143[_0x18baf9(0xcf)],'customerUa':_0xadc143[_0x18baf9(0xc2)],'failureMessage':_0xadc143[_0x18baf9(0x170)],'adminNotes':_0xadc143[_0x18baf9(0xf0)],'chargebackAmount':_0xadc143['chargebackAmount'],'statusChangedBy':_0xadc143[_0x18baf9(0x171)],'statusChangedAt':_0xadc143[_0x18baf9(0x17e)],'createdAt':_0xadc143[_0x18baf9(0x12d)],'updatedAt':_0xadc143[_0x18baf9(0x15c)],'shop':_0xadc143[_0x18baf9(0x111)]};}async[a35_0x5a3038(0xf5)](_0x31aea6,_0x4060c2){const _0x240d92=a35_0x5a3038,_0x100992={..._0x4060c2};_0x4060c2[_0x240d92(0xfa)]&&(_0x100992[_0x240d92(0xfa)]=await bcryptjs_1[_0x240d92(0x186)][_0x240d92(0x154)](_0x4060c2[_0x240d92(0xfa)],0xc));_0x4060c2[_0x240d92(0xcd)]&&(_0x100992['name']=_0x4060c2['fullName'],delete _0x100992[_0x240d92(0xcd)]);_0x4060c2[_0x240d92(0x122)]&&(_0x100992['telegram']=_0x4060c2[_0x240d92(0x122)],delete _0x100992[_0x240d92(0x122)]);_0x4060c2[_0x240d92(0x108)]&&(_0x100992[_0x240d92(0xfc)]=_0x4060c2[_0x240d92(0x108)],delete _0x100992['merchantUrl']);_0x4060c2[_0x240d92(0x113)]&&(_0x100992[_0x240d92(0xfb)]=JSON['stringify'](_0x4060c2['gateways']),delete _0x100992['gateways']);_0x4060c2[_0x240d92(0x12e)]&&(_0x100992[_0x240d92(0x12e)]=JSON[_0x240d92(0xdf)](_0x4060c2[_0x240d92(0x12e)]),delete _0x100992['gatewaySettings']);_0x4060c2['wallets']&&(_0x4060c2[_0x240d92(0xd1)][_0x240d92(0x163)]!==undefined&&(_0x100992[_0x240d92(0x163)]=_0x4060c2['wallets'][_0x240d92(0x163)]||null),_0x4060c2[_0x240d92(0xd1)]['usdtTrcWallet']!==undefined&&(_0x100992[_0x240d92(0x169)]=_0x4060c2[_0x240d92(0xd1)][_0x240d92(0x169)]||null),_0x4060c2[_0x240d92(0xd1)]['usdtErcWallet']!==undefined&&(_0x100992[_0x240d92(0xe1)]=_0x4060c2[_0x240d92(0xd1)][_0x240d92(0xe1)]||null),_0x4060c2[_0x240d92(0xd1)][_0x240d92(0x158)]!==undefined&&(_0x100992['usdcPolygonWallet']=_0x4060c2[_0x240d92(0xd1)][_0x240d92(0x158)]||null),delete _0x100992[_0x240d92(0xd1)]);const _0x5ca21b=await database_1[_0x240d92(0x186)][_0x240d92(0x111)][_0x240d92(0xe7)]({'where':{'id':_0x31aea6},'data':_0x100992,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x5ca21b['id'],'fullName':_0x5ca21b[_0x240d92(0x11c)],'username':_0x5ca21b[_0x240d92(0xcc)],'telegramId':_0x5ca21b[_0x240d92(0x114)],'merchantUrl':_0x5ca21b[_0x240d92(0xfc)],'gateways':_0x5ca21b[_0x240d92(0xfb)]?JSON[_0x240d92(0x13b)](_0x5ca21b[_0x240d92(0xfb)]):null,'gatewaySettings':_0x5ca21b[_0x240d92(0x12e)]?JSON['parse'](_0x5ca21b[_0x240d92(0x12e)]):null,'publicKey':_0x5ca21b[_0x240d92(0x14f)],'wallets':{'usdtPolygonWallet':_0x5ca21b['usdtPolygonWallet'],'usdtTrcWallet':_0x5ca21b[_0x240d92(0x169)],'usdtErcWallet':_0x5ca21b[_0x240d92(0xe1)],'usdcPolygonWallet':_0x5ca21b[_0x240d92(0x158)]},'status':_0x5ca21b['status'],'createdAt':_0x5ca21b[_0x240d92(0x12d)]};}async[a35_0x5a3038(0x10e)](_0x45235d){const _0x36b1ae=a35_0x5a3038,_0x21d2bf=await database_1[_0x36b1ae(0x186)]['shop'][_0x36b1ae(0xe7)]({'where':{'id':_0x45235d},'data':{'status':_0x36b1ae(0x106)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x21d2bf['id'],'fullName':_0x21d2bf[_0x36b1ae(0x11c)],'username':_0x21d2bf[_0x36b1ae(0xcc)],'telegramId':_0x21d2bf[_0x36b1ae(0x114)],'merchantUrl':_0x21d2bf[_0x36b1ae(0xfc)],'gateways':_0x21d2bf['paymentGateways']?JSON['parse'](_0x21d2bf['paymentGateways']):null,'gatewaySettings':_0x21d2bf[_0x36b1ae(0x12e)]?JSON[_0x36b1ae(0x13b)](_0x21d2bf['gatewaySettings']):null,'publicKey':_0x21d2bf['publicKey'],'wallets':{'usdtPolygonWallet':_0x21d2bf['usdtPolygonWallet'],'usdtTrcWallet':_0x21d2bf[_0x36b1ae(0x169)],'usdtErcWallet':_0x21d2bf['usdtErcWallet'],'usdcPolygonWallet':_0x21d2bf[_0x36b1ae(0x158)]},'status':_0x21d2bf['status'],'createdAt':_0x21d2bf['createdAt']};}async[a35_0x5a3038(0x16f)](_0x4a1e94){const _0x4e2863=a35_0x5a3038,_0xdd12c9=await database_1[_0x4e2863(0x186)][_0x4e2863(0x111)][_0x4e2863(0xe7)]({'where':{'id':_0x4a1e94},'data':{'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0xdd12c9['id'],'fullName':_0xdd12c9[_0x4e2863(0x11c)],'username':_0xdd12c9[_0x4e2863(0xcc)],'telegramId':_0xdd12c9[_0x4e2863(0x114)],'merchantUrl':_0xdd12c9[_0x4e2863(0xfc)],'gateways':_0xdd12c9[_0x4e2863(0xfb)]?JSON[_0x4e2863(0x13b)](_0xdd12c9[_0x4e2863(0xfb)]):null,'gatewaySettings':_0xdd12c9[_0x4e2863(0x12e)]?JSON[_0x4e2863(0x13b)](_0xdd12c9['gatewaySettings']):null,'publicKey':_0xdd12c9[_0x4e2863(0x14f)],'wallets':{'usdtPolygonWallet':_0xdd12c9[_0x4e2863(0x163)],'usdtTrcWallet':_0xdd12c9[_0x4e2863(0x169)],'usdtErcWallet':_0xdd12c9[_0x4e2863(0xe1)],'usdcPolygonWallet':_0xdd12c9[_0x4e2863(0x158)]},'status':_0xdd12c9['status'],'createdAt':_0xdd12c9[_0x4e2863(0x12d)]};}async[a35_0x5a3038(0xff)](_0x38d5c5){const _0x169d3f=a35_0x5a3038,{page:_0x25b11a,limit:_0x3b8ef0,status:_0x3f2cf9}=_0x38d5c5,_0xb99d6b=(_0x25b11a-0x1)*_0x3b8ef0,_0x3485cf={};_0x3f2cf9&&(_0x3485cf['status']=_0x3f2cf9['toUpperCase']());const [_0x5abcc9,_0x146e78]=await Promise['all']([database_1[_0x169d3f(0x186)]['shop'][_0x169d3f(0x152)]({'where':_0x3485cf,'skip':_0xb99d6b,'take':_0x3b8ef0,'orderBy':{'createdAt':_0x169d3f(0x126)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1['default']['shop']['count']({'where':_0x3485cf})]);return{'users':_0x5abcc9[_0x169d3f(0x16e)](_0x2bbf5c=>({'id':_0x2bbf5c['id'],'fullName':_0x2bbf5c[_0x169d3f(0x11c)],'username':_0x2bbf5c[_0x169d3f(0xcc)],'telegramId':_0x2bbf5c[_0x169d3f(0x114)],'merchantUrl':_0x2bbf5c[_0x169d3f(0xfc)],'gateways':_0x2bbf5c[_0x169d3f(0xfb)]?JSON[_0x169d3f(0x13b)](_0x2bbf5c[_0x169d3f(0xfb)]):null,'gatewaySettings':_0x2bbf5c[_0x169d3f(0x12e)]?JSON[_0x169d3f(0x13b)](_0x2bbf5c[_0x169d3f(0x12e)]):null,'publicKey':_0x2bbf5c[_0x169d3f(0x14f)],'wallets':{'usdtPolygonWallet':_0x2bbf5c[_0x169d3f(0x163)],'usdtTrcWallet':_0x2bbf5c[_0x169d3f(0x169)],'usdtErcWallet':_0x2bbf5c[_0x169d3f(0xe1)],'usdcPolygonWallet':_0x2bbf5c[_0x169d3f(0x158)]},'status':_0x2bbf5c[_0x169d3f(0x132)],'createdAt':_0x2bbf5c[_0x169d3f(0x12d)]})),'pagination':{'page':_0x25b11a,'limit':_0x3b8ef0,'total':_0x146e78,'totalPages':Math['ceil'](_0x146e78/_0x3b8ef0)}};}async['getUserById'](_0x31e2da){const _0xcde984=a35_0x5a3038,_0x618cfb=await database_1[_0xcde984(0x186)][_0xcde984(0x111)][_0xcde984(0x13d)]({'where':{'id':_0x31e2da},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x618cfb)return null;return{'id':_0x618cfb['id'],'fullName':_0x618cfb[_0xcde984(0x11c)],'username':_0x618cfb['username'],'telegramId':_0x618cfb[_0xcde984(0x114)],'merchantUrl':_0x618cfb[_0xcde984(0xfc)],'gateways':_0x618cfb['paymentGateways']?JSON['parse'](_0x618cfb['paymentGateways']):null,'gatewaySettings':_0x618cfb['gatewaySettings']?JSON[_0xcde984(0x13b)](_0x618cfb[_0xcde984(0x12e)]):null,'publicKey':_0x618cfb[_0xcde984(0x14f)],'wallets':{'usdtPolygonWallet':_0x618cfb[_0xcde984(0x163)],'usdtTrcWallet':_0x618cfb[_0xcde984(0x169)],'usdtErcWallet':_0x618cfb[_0xcde984(0xe1)],'usdcPolygonWallet':_0x618cfb[_0xcde984(0x158)]},'status':_0x618cfb[_0xcde984(0x132)],'createdAt':_0x618cfb[_0xcde984(0x12d)]};}async[a35_0x5a3038(0x147)](_0x1aafe4){const _0x1bd39e=a35_0x5a3038,{fullName:_0x34d692,username:_0x1c53f9,password:_0x43aa7b,telegramId:_0xef80c4,merchantUrl:_0x53c0ff,gateways:_0x2ad210,gatewaySettings:_0xb879d2,wallets:_0x1b6d36}=_0x1aafe4,_0x1fe4ce=await database_1[_0x1bd39e(0x186)]['shop'][_0x1bd39e(0x13d)]({'where':{'username':_0x1c53f9}});if(_0x1fe4ce)throw new Error('Username\x20already\x20exists');if(_0xef80c4){const _0x561da3=await database_1['default'][_0x1bd39e(0x111)][_0x1bd39e(0x13d)]({'where':{'telegram':_0xef80c4}});if(_0x561da3)throw new Error(_0x1bd39e(0xf9));}const _0x5cd598=await bcryptjs_1[_0x1bd39e(0x186)]['hash'](_0x43aa7b,0xc),_0x38eb61='pk_'+crypto_1[_0x1bd39e(0x186)][_0x1bd39e(0x183)](0x20)[_0x1bd39e(0x166)](_0x1bd39e(0x100)),_0x1176f3=_0x1bd39e(0x105)+crypto_1[_0x1bd39e(0x186)][_0x1bd39e(0x183)](0x20)[_0x1bd39e(0x166)]('hex'),_0x2c061f=await database_1[_0x1bd39e(0x186)][_0x1bd39e(0x111)][_0x1bd39e(0xde)]({'data':{'name':_0x34d692,'username':_0x1c53f9,'password':_0x5cd598,'telegram':_0xef80c4,'shopUrl':_0x53c0ff,'paymentGateways':_0x2ad210?JSON[_0x1bd39e(0xdf)](_0x2ad210):null,'gatewaySettings':_0xb879d2?JSON[_0x1bd39e(0xdf)](_0xb879d2):null,'usdtPolygonWallet':_0x1b6d36?.[_0x1bd39e(0x163)]||null,'usdtTrcWallet':_0x1b6d36?.['usdtTrcWallet']||null,'usdtErcWallet':_0x1b6d36?.[_0x1bd39e(0xe1)]||null,'usdcPolygonWallet':_0x1b6d36?.[_0x1bd39e(0x158)]||null,'publicKey':_0x38eb61,'secretKey':_0x1176f3,'status':_0x1bd39e(0x165)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2c061f['id'],'fullName':_0x2c061f[_0x1bd39e(0x11c)],'username':_0x2c061f[_0x1bd39e(0xcc)],'telegramId':_0x2c061f['telegram'],'merchantUrl':_0x2c061f[_0x1bd39e(0xfc)],'gateways':_0x2c061f[_0x1bd39e(0xfb)]?JSON[_0x1bd39e(0x13b)](_0x2c061f[_0x1bd39e(0xfb)]):null,'gatewaySettings':_0x2c061f['gatewaySettings']?JSON[_0x1bd39e(0x13b)](_0x2c061f[_0x1bd39e(0x12e)]):null,'publicKey':_0x2c061f[_0x1bd39e(0x14f)],'wallets':{'usdtPolygonWallet':_0x2c061f['usdtPolygonWallet'],'usdtTrcWallet':_0x2c061f[_0x1bd39e(0x169)],'usdtErcWallet':_0x2c061f[_0x1bd39e(0xe1)],'usdcPolygonWallet':_0x2c061f['usdcPolygonWallet']},'status':_0x2c061f['status'],'createdAt':_0x2c061f[_0x1bd39e(0x12d)]};}async['deleteUser'](_0x2c9148){const _0x2659d4=a35_0x5a3038;await database_1[_0x2659d4(0x186)][_0x2659d4(0x111)][_0x2659d4(0x118)]({'where':{'id':_0x2c9148}});}}exports[a35_0x5a3038(0x179)]=AdminService;