'use strict';function a35_0x1f5a(){const _0x1c9914=['16oZgELf','üìã\x20Getting\x20merchants\x20selection\x20list...','rapyd','paidOutUSDT','defineProperty','\x20\x20\x20üîç\x20Raw\x20balance\x20sum:\x20','not\x20specified','\x20USDT\x20(actual\x20balances)','Test\x20Gateway','27697YrWgil','txid','usdtPolygonWallet','\x20active\x20merchants\x20for\x20selection','totalAmountUSDT','dateFrom','\x20\x20\x20Payout\x20amount:\x20','_count','update','amountAfterCommissionUSDT','üìä\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','totalPaidOut','\x20USDT\x20(-','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','getFullYear','\x20USDT\x20(gross\x20revenue)','NONEXISTENT_GATEWAY_FILTER','cointopay','erc20','./currencyService','telegram','customerUa',',\x20successful:\x20','2020-01-01','whiteUrl','customerIp','totalPayments','CHARGEBACK','getAllUsers','\x20\x20\x20üìä\x20Commission\x20difference:\x20','423612Pkesuk','externalPaymentUrl','log','\x20\x20\x20üí∞\x20Total\x20payments\x20turnover:\x20','\x20USDT,\x20Requested:\x20','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','30d','\x20\x20\x20Gateway:\x20','dailyRevenue','\x20\x20\x20Merchant\x20gets:\x20','\x20to\x20','averageCheckUSDT','currency','lte','network','join','totalPayout','\x20became\x20PAID:','üìä\x20Available\x20gateways\x20in\x20database:','availableBalance','adminNotes','üìä\x20Total\x20payments\x20(including\x20failed):\x20','\x27\x20to\x20name\x20\x27','üîÑ\x20Gateway\x20mapping\x20(get):','\x20->\x20','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','üîÑ\x20Converted\x20gateway\x20ID\x20\x27','\x20USDT','createdAt','pk_','KLYME\x20EU','notes','totalAmountAfterCommissionUSDT','orderId','thisMonth','Shop\x20not\x20found','bcryptjs','merchantEarnings','mastercard','2129910kqTpVI','periodFrom','getGatewayDisplayName','$transaction','payout','set','length','findUnique','currencyService','suspendUser','default','updatedAt','Payment\x20not\x20found','\x20USDT\x20(after\x20payouts)','hex','üí∞\x20Current\x20shop\x20balance:\x20','\x20USDT\x20(without\x20commission)','name','\x20balance\x20updated:','Insufficient\x20balance.\x20Available:\x20','_sum','üí±\x20Currency\x20filter\x20applied:\x20','reduce','\x20USDT\x20(after\x20','\x20\x20\x20Merchant\x20loses:\x20','week','gateways','stringify','\x20\x20\x20Transaction\x20hash:\x20','gatewayEarnings','averageCommissionRate','amountUSDT','klyme_eu','ceil','üîÑ\x20Admin\x20updating\x20payment\x20','üìÖ\x20Period\x20\x27all\x27:\x20Using\x20start\x20date\x20from\x20first\x20payment:\x20','groupBy','getSystemStatistics','findMany','getDate','üí∞\x20Found\x20','\x20paid\x20payments\x20for\x20analysis','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','üîç\x20Using\x20gateway\x20\x27','commissionUSDT','custom','üìä\x20Sorting\x20payments\x20by\x20','insensitive','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','period','password','CoinToPay','__esModule','test_gateway','9mdlWYJ','count','findFirst','delete','getMerchantsAwaitingPayout','\x20USDT\x20(+','‚úÖ\x20Using\x20gateway\x20filter:\x20\x27','commission','get','../config/database','paymentsCount','randomBytes','status','gateway','5aQGApV','toFixed','\x20\x20\x20üñ•Ô∏è\x20User\x20Agent:\x20','customerCountry','cointopay2','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','\x27\x20->\x20ID\x20\x27','split','deletePayout','merchantUrl','üí∞\x20Shop\x20','create','\x20status:\x20','periodTo','üìã\x20Found\x20','awaitingPayout','\x20in\x20','convertToUSDT','\x20\x20\x20Added\x20to\x20balance:\x20+','customerEmail','some','\x20\x20\x20Full\x20amount:\x20','\x27\x20(from\x20\x27','klyme_de','COMPLETED','customerName','date','successUrl','round','month','failureMessage','55713TPfHzj','createPayout','parse','deleteUser','üìä\x20Calculating\x20payout\x20statistics...','\x20merchants\x20with\x20positive\x20balance','turnoverUSDT','ACTIVE','dateTo','pendingUrl','toUpperCase','967673MlZqTu','\x20\x20\x20üè™\x20Gateway\x20earnings:\x20','updateCustomerData','updatePaymentStatus','\x20\x20\x20üí∏\x20Total\x20payouts\x20(all\x20time):\x20','asc','publicKey',',\x20Commission:\x20',':\x20commission\x20=\x20','Plisio','setDate','Noda','not\x20set','1073985rDfQGp','summary','getAllPayments','getGatewayInternalName','%\x20commission)','getMerchantsSelection','chargebackAmount','hash','values','usdtTrcWallet','plisio','\x20\x20\x20‚úÖ\x20Total\x20available\x20for\x20payout:\x20','514806fmOEnX','KLYME\x20DE','\x20USDT)','statusChangedBy','amount','updateUser','Open\x20Banking\x202','toString','üí∞\x20Payment\x20','getPayoutById','üîÑ\x20Updating\x20customer\x20data\x20for\x20payment\x20','\x20USDT\x20from\x20balance','push','getGatewayNameById','üí∏\x20CHARGEBACK:\x20Merchant\x20amount\x20already\x20deducted\x20from\x20balance','Username\x20already\x20exists','üí≥\x20Payout\x20wallet\x20for\x20','üìä\x20Merchant\x20statistics\x20calculated:','AdminService','paymentGateways','\x20payments)','getTime','\x20\x20\x20üí∞\x20Total\x20payout:\x20','\x20USDT\x20(','getPayoutStats','balance','üìä\x20Final\x20WHERE\x20conditions:','usdtErcWallet','\x20for\x20shop\x20','üí∞\x20[PAYOUT]\x20Merchant\x20','getMonth','\x20\x20\x20üíµ\x20Available\x20balance:\x20','paidAt','wallets','\x20\x20\x20üí∞\x20Total\x20turnover:\x20','Telegram\x20username\x20already\x20exists','‚úÖ\x20Payout\x20created:\x20','\x20USDT\x20(theoretical\x20net)','\x20balance\x20updated:\x20','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','\x20\x20\x20üåç\x20Country:\x20','desc','crypto','üìä\x20Payout\x20statistics\x20calculated:','sk_','\x20\x20\x20Balance:\x20','\x20USDT\x20(with\x20commission\x20deducted)','all','\x20\x20\x20üìÖ\x20This\x20month:\x20','shopId','usdcPolygonWallet','includes','localeCompare','trc20','getUserById','error','sort','\x27\x20->\x20name\x20\x27','üí∞\x20Creating\x20payout\x20for\x20shop\x20','gatewaySettings','gatewayOrderId','totalCommissionRate','payment','gte','6QFiLcc','\x20merchants','map','\x20\x20\x20üìä\x20Total\x20payments:\x20','90d','turnover','shopUrl','\x20\x20\x20üí≥\x20Total\x20payments:\x20','shop','\x20\x20\x20üîç\x20Calculated\x20after\x20commission:\x20','PAID','forEach','fullName','entries','username','merchantEarningsUSDT','üìä\x20Getting\x20payments\x20with\x20filters:','noda','aggregate','\x20\x20\x20Total\x20paid\x20out:\x20','generateDailyStatistics','toISOString','\x20\x20\x20ÔøΩ\x20Total\x20payments\x20turnover:\x20','revenue','toLowerCase','SUSPENDED','\x20\x20\x20üåê\x20IP:\x20','telegramId'];a35_0x1f5a=function(){return _0x1c9914;};return a35_0x1f5a();}function a35_0x5bfe(_0x431907,_0x351e5d){const _0x1f5acd=a35_0x1f5a();return a35_0x5bfe=function(_0x5bfe3d,_0xdc0342){_0x5bfe3d=_0x5bfe3d-0x14b;let _0x169658=_0x1f5acd[_0x5bfe3d];return _0x169658;},a35_0x5bfe(_0x431907,_0x351e5d);}const a35_0x4ed3ea=a35_0x5bfe;(function(_0xcfbe82,_0xd9094f){const _0x36a0ed=a35_0x5bfe,_0x5988f9=_0xcfbe82();while(!![]){try{const _0x29a381=parseInt(_0x36a0ed(0x224))/0x1*(parseInt(_0x36a0ed(0x1ff))/0x2)+-parseInt(_0x36a0ed(0x19b))/0x3+parseInt(_0x36a0ed(0x242))/0x4*(-parseInt(_0x36a0ed(0x17c))/0x5)+parseInt(_0x36a0ed(0x1bf))/0x6+-parseInt(_0x36a0ed(0x1a6))/0x7*(-parseInt(_0x36a0ed(0x21b))/0x8)+-parseInt(_0x36a0ed(0x16e))/0x9*(parseInt(_0x36a0ed(0x269))/0xa)+parseInt(_0x36a0ed(0x1b3))/0xb;if(_0x29a381===_0xd9094f)break;else _0x5988f9['push'](_0x5988f9['shift']());}catch(_0x5bf498){_0x5988f9['push'](_0x5988f9['shift']());}}}(a35_0x1f5a,0x322e4));var __importDefault=this&&this['__importDefault']||function(_0x3e338c){const _0x35e5eb=a35_0x5bfe;return _0x3e338c&&_0x3e338c[_0x35e5eb(0x16c)]?_0x3e338c:{'default':_0x3e338c};};Object[a35_0x4ed3ea(0x21f)](exports,a35_0x4ed3ea(0x16c),{'value':!![]}),exports[a35_0x4ed3ea(0x1d1)]=void 0x0;const database_1=__importDefault(require(a35_0x4ed3ea(0x177))),bcryptjs_1=__importDefault(require(a35_0x4ed3ea(0x266))),crypto_1=__importDefault(require(a35_0x4ed3ea(0x1e9))),currencyService_1=require(a35_0x4ed3ea(0x237)),gateway_1=require('../types/gateway');class AdminService{async[a35_0x4ed3ea(0x1d7)](){const _0x58face=a35_0x4ed3ea;console[_0x58face(0x244)](_0x58face(0x19f));const _0x140c49=await database_1['default'][_0x58face(0x207)][_0x58face(0x211)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x58face(0x1a2)}}),_0x257d6a=await this[_0x58face(0x172)]({'page':0x1,'limit':0x3e8}),_0x474212=await database_1[_0x58face(0x273)][_0x58face(0x1fd)][_0x58face(0x16f)]({'where':{'status':'PAID','gateway':{'not':_0x58face(0x16d)}}}),_0xc95008=new Date(),_0x334f18=new Date(_0xc95008['getFullYear'](),_0xc95008[_0x58face(0x1dd)](),0x1),_0x2732ee=new Date(_0xc95008[_0x58face(0x232)](),_0xc95008['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x5b2280=await database_1['default'][_0x58face(0x26d)][_0x58face(0x211)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x334f18,'lte':_0x2732ee},'status':_0x58face(0x194)}}),_0x102170=_0x140c49[_0x58face(0x14c)]['totalPaidOut']||0x0,_0x4050a5=_0x257d6a[_0x58face(0x1b4)][_0x58face(0x262)],_0x2b8425=_0x5b2280[_0x58face(0x14c)]['amount']||0x0,_0x2f35a5={'totalPayout':Math[_0x58face(0x198)](_0x102170*0x64)/0x64,'awaitingPayout':Math[_0x58face(0x198)](_0x4050a5*0x64)/0x64,'thisMonth':Math[_0x58face(0x198)](_0x2b8425*0x64)/0x64,'availableBalance':Math[_0x58face(0x198)](_0x4050a5*0x64)/0x64,'totalPayments':_0x474212};return console[_0x58face(0x244)](_0x58face(0x1ea)),console[_0x58face(0x244)](_0x58face(0x1d5)+_0x2f35a5[_0x58face(0x252)]+'\x20USDT\x20(total\x20paid\x20to\x20merchants)'),console[_0x58face(0x244)](_0x58face(0x162)+_0x2f35a5[_0x58face(0x18b)]+_0x58face(0x1ed)),console[_0x58face(0x244)](_0x58face(0x1de)+_0x2f35a5[_0x58face(0x255)]+'\x20USDT\x20(same\x20as\x20awaiting)'),console[_0x58face(0x244)](_0x58face(0x1ef)+_0x2f35a5[_0x58face(0x264)]+_0x58face(0x25d)),console['log'](_0x58face(0x206)+_0x2f35a5['totalPayments']+'\x20PAID\x20payments'),console['log'](_0x58face(0x220)+(_0x140c49[_0x58face(0x14c)][_0x58face(0x1d8)]||0x0)[_0x58face(0x17d)](0x2)+_0x58face(0x279)),console[_0x58face(0x244)](_0x58face(0x241)+((_0x140c49['_sum'][_0x58face(0x1d8)]||0x0)-_0x4050a5)[_0x58face(0x17d)](0x2)+_0x58face(0x25d)),_0x2f35a5;}async[a35_0x4ed3ea(0x1a8)](_0x4a0b02,_0x27acf3){const _0x45ae94=a35_0x4ed3ea;console[_0x45ae94(0x244)](_0x45ae94(0x1c9)+_0x4a0b02+':',_0x27acf3);const _0x377b57=await database_1[_0x45ae94(0x273)][_0x45ae94(0x1fd)][_0x45ae94(0x270)]({'where':{'id':_0x4a0b02},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x377b57)throw new Error(_0x45ae94(0x275));const _0x4fc0ed={};_0x27acf3[_0x45ae94(0x17f)]!==undefined&&(_0x4fc0ed[_0x45ae94(0x17f)]=_0x27acf3[_0x45ae94(0x17f)]||null);_0x27acf3['customerIp']!==undefined&&(_0x4fc0ed[_0x45ae94(0x23d)]=_0x27acf3[_0x45ae94(0x23d)]||null);_0x27acf3[_0x45ae94(0x239)]!==undefined&&(_0x4fc0ed[_0x45ae94(0x239)]=_0x27acf3[_0x45ae94(0x239)]||null);const _0x48168b=await database_1[_0x45ae94(0x273)][_0x45ae94(0x1fd)][_0x45ae94(0x22c)]({'where':{'id':_0x4a0b02},'data':{..._0x4fc0ed,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x45ae94(0x244)]('‚úÖ\x20Customer\x20data\x20updated\x20for\x20payment\x20'+_0x4a0b02),console['log'](_0x45ae94(0x1e7)+_0x377b57[_0x45ae94(0x17f)]+_0x45ae94(0x25a)+_0x48168b[_0x45ae94(0x17f)]),console[_0x45ae94(0x244)](_0x45ae94(0x219)+_0x377b57[_0x45ae94(0x23d)]+_0x45ae94(0x25a)+_0x48168b[_0x45ae94(0x23d)]),console[_0x45ae94(0x244)](_0x45ae94(0x17e)+(_0x377b57[_0x45ae94(0x239)]?_0x45ae94(0x26e):_0x45ae94(0x1b2))+_0x45ae94(0x25a)+(_0x48168b[_0x45ae94(0x239)]?'set':_0x45ae94(0x1b2))),_0x48168b;}async[a35_0x4ed3ea(0x15d)](_0x1912c7){const _0x466133=a35_0x4ed3ea,_0x5c12f8=new Date();let _0x141141;switch(_0x1912c7){case'7d':_0x141141=new Date(_0x5c12f8[_0x466133(0x1d4)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x466133(0x248):_0x141141=new Date(_0x5c12f8['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x466133(0x203):_0x141141=new Date(_0x5c12f8[_0x466133(0x1d4)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x466133(0x1ee):const _0x48dcf5=await database_1['default'][_0x466133(0x1fd)][_0x466133(0x170)]({'where':{'gateway':{'not':_0x466133(0x16d)}},'orderBy':{'createdAt':_0x466133(0x1ab)},'select':{'createdAt':!![]}});_0x141141=_0x48dcf5?_0x48dcf5[_0x466133(0x25e)]:new Date(_0x466133(0x23b)),console['log'](_0x466133(0x15b)+_0x141141[_0x466133(0x214)]());break;default:_0x141141=new Date(_0x5c12f8[_0x466133(0x1d4)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x56b05e,_0xc6d9a3,_0x1d39f4,_0x56e459,_0x537f29,_0x8b1d9c,_0x3c8a10]=await Promise[_0x466133(0x1ee)]([database_1[_0x466133(0x273)][_0x466133(0x207)][_0x466133(0x16f)](),database_1[_0x466133(0x273)][_0x466133(0x207)][_0x466133(0x16f)]({'where':{'status':_0x466133(0x1a2)}}),database_1['default'][_0x466133(0x1fd)]['count']({'where':{'createdAt':{'gte':_0x141141},'gateway':{'not':_0x466133(0x16d)}}}),database_1[_0x466133(0x273)]['payment'][_0x466133(0x16f)]({'where':{'status':_0x466133(0x209),'createdAt':{'gte':_0x141141},'gateway':{'not':'test_gateway'}}}),database_1['default'][_0x466133(0x1fd)][_0x466133(0x15e)]({'where':{'status':_0x466133(0x209),'createdAt':{'gte':_0x141141},'gateway':{'not':_0x466133(0x16d)}},'select':{'amount':!![],'currency':!![]}}),database_1[_0x466133(0x273)]['payment']['findMany']({'where':{'gateway':{'not':_0x466133(0x16d)}},'take':0xa,'orderBy':{'createdAt':_0x466133(0x1e8)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x466133(0x273)][_0x466133(0x1fd)][_0x466133(0x15e)]({'where':{'createdAt':{'gte':_0x141141},'gateway':{'not':_0x466133(0x16d)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x89c38b=0x0;for(const _0x4962c8 of _0x537f29){const _0x459ea4=await currencyService_1['currencyService']['convertToUSDT'](_0x4962c8[_0x466133(0x1c3)],_0x4962c8[_0x466133(0x24e)]);_0x89c38b+=_0x459ea4;}const _0x2c8198=this[_0x466133(0x213)](_0x3c8a10,_0x141141,_0x5c12f8),_0x12f013=_0x1d39f4>0x0?_0x56e459/_0x1d39f4*0x64:0x0;return{'totalShops':_0x56b05e,'activeShops':_0xc6d9a3,'totalPayments':_0x1d39f4,'successfulPayments':_0x56e459,'totalRevenue':Math[_0x466133(0x198)](_0x89c38b*0x64)/0x64,'conversionRate':Math[_0x466133(0x198)](_0x12f013*0x64)/0x64,'dailyRevenue':_0x2c8198[_0x466133(0x24a)],'dailyPayments':_0x2c8198['dailyPayments'],'recentPayments':_0x8b1d9c[_0x466133(0x201)](_0x553dbd=>({'id':_0x553dbd['id'],'amount':_0x553dbd['amount'],'currency':_0x553dbd[_0x466133(0x24e)],'status':_0x553dbd[_0x466133(0x17a)],'gateway':_0x553dbd['gateway'],'shop':_0x553dbd[_0x466133(0x207)],'createdAt':_0x553dbd[_0x466133(0x25e)]}))};}async['getMerchantStatistics'](_0x334250){const _0x241a3b=a35_0x4ed3ea;console['log']('üìä\x20Getting\x20merchant\x20statistics\x20with\x20filters:',_0x334250);let _0x8d0b99,_0x3353e6=new Date();if(_0x334250[_0x241a3b(0x169)]===_0x241a3b(0x165)&&_0x334250['dateFrom']&&_0x334250[_0x241a3b(0x1a3)])_0x8d0b99=new Date(_0x334250[_0x241a3b(0x229)]),_0x3353e6=new Date(_0x334250[_0x241a3b(0x1a3)]);else{const _0x32e059=new Date();switch(_0x334250[_0x241a3b(0x169)]){case _0x241a3b(0x151):_0x8d0b99=new Date(_0x32e059[_0x241a3b(0x1d4)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x241a3b(0x199):_0x8d0b99=new Date(_0x32e059['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'year':_0x8d0b99=new Date(_0x32e059[_0x241a3b(0x1d4)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case'all':default:_0x8d0b99=new Date(_0x241a3b(0x23b));break;}}console['log']('üìÖ\x20Period:\x20'+_0x8d0b99[_0x241a3b(0x214)]()+_0x241a3b(0x24c)+_0x3353e6['toISOString']());const _0x1348af={'status':_0x241a3b(0x209),'gateway':{'not':_0x241a3b(0x16d)},'paidAt':{'gte':_0x8d0b99,'lte':_0x3353e6}};_0x334250[_0x241a3b(0x1f0)]&&(_0x1348af['shopId']=_0x334250[_0x241a3b(0x1f0)]);const _0x17dbe7=await database_1[_0x241a3b(0x273)][_0x241a3b(0x1fd)][_0x241a3b(0x15e)]({'where':_0x1348af,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x241a3b(0x244)](_0x241a3b(0x160)+_0x17dbe7[_0x241a3b(0x26f)]+_0x241a3b(0x161));const _0x21da63={'gateway':{'not':_0x241a3b(0x16d)},'createdAt':{'gte':_0x8d0b99,'lte':_0x3353e6}};_0x334250[_0x241a3b(0x1f0)]&&(_0x21da63['shopId']=_0x334250[_0x241a3b(0x1f0)]);const _0x469d23=await database_1[_0x241a3b(0x273)]['payment'][_0x241a3b(0x16f)]({'where':_0x21da63});console[_0x241a3b(0x244)](_0x241a3b(0x257)+_0x469d23+_0x241a3b(0x23a)+_0x17dbe7['length']);let _0x3148b3=0x0,_0x41f4e5=0x0,_0xeda97=0x0;const _0x5bcb67={},_0x3f0ea4={},_0x3bc52f={};for(const _0x4d40cb of _0x17dbe7){try{const _0x182dd1=await currencyService_1[_0x241a3b(0x271)][_0x241a3b(0x18d)](_0x4d40cb[_0x241a3b(0x1c3)],_0x4d40cb[_0x241a3b(0x24e)]);let _0x3980d5={};if(_0x4d40cb[_0x241a3b(0x207)]['gatewaySettings'])try{_0x3980d5=JSON[_0x241a3b(0x19d)](_0x4d40cb[_0x241a3b(0x207)][_0x241a3b(0x1fa)]);}catch(_0x6e1634){console['error'](_0x241a3b(0x181)+_0x4d40cb[_0x241a3b(0x1f0)]+':',_0x6e1634);}let _0x3161d6={},_0x1bdf47=0xa;for(const [_0x444164,_0x5844d1]of Object['entries'](_0x3980d5)){if(_0x444164[_0x241a3b(0x217)]()===_0x4d40cb[_0x241a3b(0x17b)][_0x241a3b(0x217)]()){_0x3161d6=_0x5844d1,_0x1bdf47=_0x5844d1[_0x241a3b(0x175)]||0xa;break;}}const _0x2229ee=_0x182dd1*(_0x1bdf47/0x64),_0x397010=_0x182dd1-_0x2229ee;_0x3148b3+=_0x182dd1,_0x41f4e5+=_0x397010,_0xeda97+=_0x2229ee;!_0x5bcb67[_0x4d40cb['gateway']]&&(_0x5bcb67[_0x4d40cb[_0x241a3b(0x17b)]]={'gateway':_0x4d40cb[_0x241a3b(0x17b)],'gatewayDisplayName':this[_0x241a3b(0x26b)](_0x4d40cb[_0x241a3b(0x17b)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x5bcb67[_0x4d40cb[_0x241a3b(0x17b)]][_0x241a3b(0x178)]++,_0x5bcb67[_0x4d40cb['gateway']][_0x241a3b(0x1a1)]+=_0x182dd1,_0x5bcb67[_0x4d40cb[_0x241a3b(0x17b)]][_0x241a3b(0x164)]+=_0x2229ee,_0x5bcb67[_0x4d40cb[_0x241a3b(0x17b)]][_0x241a3b(0x20e)]+=_0x397010,_0x5bcb67[_0x4d40cb['gateway']][_0x241a3b(0x1fc)]+=_0x1bdf47;!_0x334250[_0x241a3b(0x1f0)]&&(!_0x3f0ea4[_0x4d40cb['shopId']]&&(_0x3f0ea4[_0x4d40cb[_0x241a3b(0x1f0)]]={'shopId':_0x4d40cb[_0x241a3b(0x1f0)],'shopName':_0x4d40cb[_0x241a3b(0x207)][_0x241a3b(0x27a)],'shopUsername':_0x4d40cb['shop']['username'],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x3f0ea4[_0x4d40cb[_0x241a3b(0x1f0)]]['paymentsCount']++,_0x3f0ea4[_0x4d40cb['shopId']][_0x241a3b(0x1a1)]+=_0x182dd1,_0x3f0ea4[_0x4d40cb['shopId']][_0x241a3b(0x164)]+=_0x2229ee,_0x3f0ea4[_0x4d40cb[_0x241a3b(0x1f0)]][_0x241a3b(0x20e)]+=_0x397010);const _0x3fda52=_0x4d40cb['paidAt'][_0x241a3b(0x214)]()[_0x241a3b(0x183)]('T')[0x0];!_0x3bc52f[_0x3fda52]&&(_0x3bc52f[_0x3fda52]={'date':_0x3fda52,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x3bc52f[_0x3fda52][_0x241a3b(0x204)]+=_0x182dd1,_0x3bc52f[_0x3fda52]['merchantEarnings']+=_0x397010,_0x3bc52f[_0x3fda52][_0x241a3b(0x155)]+=_0x2229ee,_0x3bc52f[_0x3fda52][_0x241a3b(0x178)]++;}catch(_0xe6e7bb){console[_0x241a3b(0x1f6)]('Error\x20processing\x20payment\x20'+_0x4d40cb['id']+':',_0xe6e7bb);}}Object[_0x241a3b(0x1bb)](_0x5bcb67)[_0x241a3b(0x20a)](_0x1c7833=>{const _0x22ffda=_0x241a3b;_0x1c7833[_0x22ffda(0x156)]=_0x1c7833['paymentsCount']>0x0?_0x1c7833[_0x22ffda(0x1fc)]/_0x1c7833[_0x22ffda(0x178)]:0x0,delete _0x1c7833[_0x22ffda(0x1fc)];}),Object['values'](_0x3f0ea4)[_0x241a3b(0x20a)](_0x4bb421=>{const _0x1f75fe=_0x241a3b;_0x4bb421[_0x1f75fe(0x24d)]=_0x4bb421[_0x1f75fe(0x178)]>0x0?_0x4bb421[_0x1f75fe(0x1a1)]/_0x4bb421[_0x1f75fe(0x178)]:0x0;});let _0x4cd114=0x0;if(_0x334250[_0x241a3b(0x1f0)]){const _0x20858f=await database_1['default'][_0x241a3b(0x26d)]['findMany']({'where':{'shopId':_0x334250[_0x241a3b(0x1f0)],'status':_0x241a3b(0x194),'createdAt':{'gte':_0x8d0b99,'lte':_0x3353e6}},'select':{'amount':!![]}});_0x4cd114=_0x20858f[_0x241a3b(0x14e)]((_0x1b6dad,_0x26c3d3)=>_0x1b6dad+_0x26c3d3[_0x241a3b(0x1c3)],0x0);}const _0x32589e=_0x469d23,_0x356acc=_0x17dbe7[_0x241a3b(0x26f)],_0x5cb019=_0x356acc>0x0?_0x3148b3/_0x356acc:0x0,_0x3cfa2e=_0x32589e>0x0?Math[_0x241a3b(0x198)](_0x356acc/_0x32589e*0x2710)/0x64:0x0,_0x431510=Math[_0x241a3b(0x159)]((_0x3353e6[_0x241a3b(0x1d4)]()-_0x8d0b99[_0x241a3b(0x1d4)]())/(0x3e8*0x3c*0x3c*0x18)),_0x323995={'totalTurnover':Math[_0x241a3b(0x198)](_0x3148b3*0x64)/0x64,'merchantEarnings':Math[_0x241a3b(0x198)](_0x41f4e5*0x64)/0x64,'gatewayEarnings':Math['round'](_0xeda97*0x64)/0x64,'totalPaidOut':Math[_0x241a3b(0x198)](_0x4cd114*0x64)/0x64,'averageCheck':Math[_0x241a3b(0x198)](_0x5cb019*0x64)/0x64,'totalPayments':_0x32589e,'successfulPayments':_0x356acc,'conversionRate':_0x3cfa2e,'gatewayBreakdown':Object[_0x241a3b(0x1bb)](_0x5bcb67)[_0x241a3b(0x201)](_0x64e859=>({..._0x64e859,'turnoverUSDT':Math[_0x241a3b(0x198)](_0x64e859[_0x241a3b(0x1a1)]*0x64)/0x64,'commissionUSDT':Math[_0x241a3b(0x198)](_0x64e859[_0x241a3b(0x164)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x241a3b(0x198)](_0x64e859['merchantEarningsUSDT']*0x64)/0x64,'averageCommissionRate':Math[_0x241a3b(0x198)](_0x64e859[_0x241a3b(0x156)]*0x64)/0x64})),'merchantBreakdown':_0x334250[_0x241a3b(0x1f0)]?undefined:Object[_0x241a3b(0x1bb)](_0x3f0ea4)[_0x241a3b(0x201)](_0x231fb4=>({..._0x231fb4,'turnoverUSDT':Math['round'](_0x231fb4[_0x241a3b(0x1a1)]*0x64)/0x64,'commissionUSDT':Math[_0x241a3b(0x198)](_0x231fb4[_0x241a3b(0x164)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x241a3b(0x198)](_0x231fb4['merchantEarningsUSDT']*0x64)/0x64,'paidOutUSDT':Math[_0x241a3b(0x198)](_0x231fb4[_0x241a3b(0x21e)]*0x64)/0x64,'averageCheckUSDT':Math[_0x241a3b(0x198)](_0x231fb4[_0x241a3b(0x24d)]*0x64)/0x64})),'dailyData':Object[_0x241a3b(0x1bb)](_0x3bc52f)[_0x241a3b(0x201)](_0x4eb038=>({..._0x4eb038,'turnover':Math[_0x241a3b(0x198)](_0x4eb038[_0x241a3b(0x204)]*0x64)/0x64,'merchantEarnings':Math[_0x241a3b(0x198)](_0x4eb038[_0x241a3b(0x267)]*0x64)/0x64,'gatewayEarnings':Math[_0x241a3b(0x198)](_0x4eb038['gatewayEarnings']*0x64)/0x64}))[_0x241a3b(0x1f7)]((_0x48f100,_0x12b8dc)=>_0x48f100[_0x241a3b(0x196)][_0x241a3b(0x1f3)](_0x12b8dc['date'])),'periodInfo':{'from':_0x8d0b99,'to':_0x3353e6,'periodType':_0x334250['period']||_0x241a3b(0x165),'daysCount':_0x431510}};return console[_0x241a3b(0x244)](_0x241a3b(0x1d0)),console[_0x241a3b(0x244)](_0x241a3b(0x1e1)+_0x323995['totalTurnover']+_0x241a3b(0x25d)),console[_0x241a3b(0x244)]('\x20\x20\x20üë§\x20Merchant\x20earnings:\x20'+_0x323995[_0x241a3b(0x267)]+_0x241a3b(0x25d)),console['log'](_0x241a3b(0x1a7)+_0x323995[_0x241a3b(0x155)]+_0x241a3b(0x25d)),console[_0x241a3b(0x244)](_0x241a3b(0x202)+_0x323995[_0x241a3b(0x23e)]),_0x323995;}async[a35_0x4ed3ea(0x1b8)](){const _0x3bb2c1=a35_0x4ed3ea;console[_0x3bb2c1(0x244)](_0x3bb2c1(0x21c));const _0x247c50=await database_1[_0x3bb2c1(0x273)][_0x3bb2c1(0x207)][_0x3bb2c1(0x15e)]({'where':{'status':_0x3bb2c1(0x1a2)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x3bb2c1(0x1ab)}});return console[_0x3bb2c1(0x244)](_0x3bb2c1(0x18a)+_0x247c50[_0x3bb2c1(0x26f)]+_0x3bb2c1(0x227)),_0x247c50['map'](_0x597f5b=>({'id':_0x597f5b['id'],'username':_0x597f5b[_0x3bb2c1(0x20d)],'name':_0x597f5b[_0x3bb2c1(0x27a)]}));}[a35_0x4ed3ea(0x26b)](_0x1ebcab){const _0x1cf92e=a35_0x4ed3ea,_0x4f1378={'test_gateway':_0x1cf92e(0x223),'plisio':_0x1cf92e(0x1af),'rapyd':'Rapyd','noda':_0x1cf92e(0x1b1),'cointopay':_0x1cf92e(0x16b),'cointopay2':_0x1cf92e(0x1c5),'klyme_eu':_0x1cf92e(0x260),'klyme_gb':'KLYME\x20GB','klyme_de':_0x1cf92e(0x1c0),'mastercard':'MasterCard'};return _0x4f1378[_0x1ebcab]||_0x1ebcab;}['getGatewayInternalName'](_0x40f977){const _0x559a2b=a35_0x4ed3ea,_0x3bdf65={'Test\x20Gateway':_0x559a2b(0x16d),'Plisio':_0x559a2b(0x1bd),'Rapyd':_0x559a2b(0x21d),'Noda':_0x559a2b(0x210),'CoinToPay':_0x559a2b(0x235),'CoinToPay2':_0x559a2b(0x180),'KLYME\x20EU':_0x559a2b(0x158),'KLYME\x20GB':'klyme_gb','KLYME\x20DE':_0x559a2b(0x193),'MasterCard':_0x559a2b(0x268)};return _0x3bdf65[_0x40f977]||_0x40f977[_0x559a2b(0x217)]();}async[a35_0x4ed3ea(0x172)](_0x132cb1){const _0x37fb13=a35_0x4ed3ea,{page:_0x4a02ef,limit:_0x365f2c,minAmount:_0x1df97e,search:_0x5b6ed2}=_0x132cb1,_0x1884eb=(_0x4a02ef-0x1)*_0x365f2c;console[_0x37fb13(0x244)](_0x37fb13(0x22e),_0x132cb1);const _0x719b7d={'balance':{'gt':0x0},'status':_0x37fb13(0x1a2)};_0x1df97e&&(_0x719b7d[_0x37fb13(0x1d8)][_0x37fb13(0x1fe)]=_0x1df97e);_0x5b6ed2&&(_0x719b7d['OR']=[{'name':{'contains':_0x5b6ed2,'mode':_0x37fb13(0x167)}},{'username':{'contains':_0x5b6ed2,'mode':_0x37fb13(0x167)}}]);const [_0x199256,_0x4a8760]=await Promise[_0x37fb13(0x1ee)]([database_1[_0x37fb13(0x273)][_0x37fb13(0x207)][_0x37fb13(0x15e)]({'where':_0x719b7d,'skip':_0x1884eb,'take':_0x365f2c,'orderBy':{'balance':_0x37fb13(0x1e8)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1[_0x37fb13(0x273)]['shop'][_0x37fb13(0x16f)]({'where':_0x719b7d})]);console[_0x37fb13(0x244)]('üí∞\x20Found\x20'+_0x199256[_0x37fb13(0x26f)]+_0x37fb13(0x1a0));const _0x2276de=await Promise[_0x37fb13(0x1ee)](_0x199256[_0x37fb13(0x201)](async _0x299d50=>{const _0x46f88c=_0x37fb13,[_0x4ab192,_0x45d45c,_0x290b3c]=await Promise[_0x46f88c(0x1ee)]([database_1[_0x46f88c(0x273)]['payment']['count']({'where':{'shopId':_0x299d50['id'],'status':'PAID','gateway':{'not':_0x46f88c(0x16d)}}}),database_1[_0x46f88c(0x273)][_0x46f88c(0x1fd)][_0x46f88c(0x170)]({'where':{'shopId':_0x299d50['id'],'status':_0x46f88c(0x209),'gateway':{'not':_0x46f88c(0x16d)}},'orderBy':{'paidAt':'asc'},'select':{'paidAt':!![]}}),database_1['default'][_0x46f88c(0x1fd)][_0x46f88c(0x15c)]({'by':[_0x46f88c(0x17b)],'where':{'shopId':_0x299d50['id'],'status':_0x46f88c(0x209),'gateway':{'not':_0x46f88c(0x16d)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x17163e=new Date(),_0x40dcff=new Date(_0x17163e[_0x46f88c(0x232)](),_0x17163e['getMonth'](),0x1),_0x567e90=new Date(_0x17163e[_0x46f88c(0x232)](),_0x17163e['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x92b9c6,_0x33018e]=await Promise[_0x46f88c(0x1ee)]([database_1['default'][_0x46f88c(0x26d)][_0x46f88c(0x211)]({'_sum':{'amount':!![]},'where':{'shopId':_0x299d50['id'],'status':_0x46f88c(0x194)}}),database_1[_0x46f88c(0x273)][_0x46f88c(0x26d)][_0x46f88c(0x211)]({'_sum':{'amount':!![]},'where':{'shopId':_0x299d50['id'],'status':_0x46f88c(0x194),'createdAt':{'gte':_0x40dcff,'lte':_0x567e90}}})]),_0x2b1d26=_0x92b9c6[_0x46f88c(0x14c)][_0x46f88c(0x1c3)]||0x0,_0x55791e=_0x33018e['_sum'][_0x46f88c(0x1c3)]||0x0,_0x1a9560=await Promise[_0x46f88c(0x1ee)](_0x290b3c['map'](async _0x2fedf8=>{const _0x186eda=_0x46f88c;let _0x16dfe2=0xa;if(_0x299d50[_0x186eda(0x1fa)])try{const _0x57329c=JSON[_0x186eda(0x19d)](_0x299d50[_0x186eda(0x1fa)]);for(const [_0x2a9dc7,_0x42c8f5]of Object['entries'](_0x57329c)){if(_0x2a9dc7['toLowerCase']()===_0x2fedf8[_0x186eda(0x17b)][_0x186eda(0x217)]()){_0x16dfe2=_0x42c8f5[_0x186eda(0x175)]||0xa,console[_0x186eda(0x244)]('üí∞\x20[PAYOUT]\x20Gateway\x20'+_0x2fedf8[_0x186eda(0x17b)]+_0x186eda(0x1db)+_0x299d50['id']+_0x186eda(0x1ae)+_0x16dfe2+'%');break;}}}catch(_0x5f3af1){console[_0x186eda(0x1f6)]('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x299d50['id']+':',_0x5f3af1);}const _0x4a0671=_0x2fedf8[_0x186eda(0x14c)][_0x186eda(0x157)]||0x0,_0x3c6510=_0x4a0671*(0x1-_0x16dfe2/0x64);return{'gateway':_0x2fedf8[_0x186eda(0x17b)],'count':_0x2fedf8[_0x186eda(0x22b)]['id'],'amountUSDT':Math[_0x186eda(0x198)](_0x4a0671*0x64)/0x64,'amountAfterCommissionUSDT':Math['round'](_0x3c6510*0x64)/0x64,'commission':_0x16dfe2};})),_0x418ca6=_0x1a9560[_0x46f88c(0x14e)]((_0x304a84,_0x33bc32)=>_0x304a84+_0x33bc32[_0x46f88c(0x157)],0x0),_0x322090=_0x299d50[_0x46f88c(0x1d8)];return console[_0x46f88c(0x244)](_0x46f88c(0x1dc)+_0x299d50[_0x46f88c(0x20d)]+':'),console['log'](_0x46f88c(0x215)+_0x418ca6['toFixed'](0x2)+_0x46f88c(0x233)),console['log'](_0x46f88c(0x208)+_0x1a9560[_0x46f88c(0x14e)]((_0x1c9566,_0x19d608)=>_0x1c9566+_0x19d608[_0x46f88c(0x22d)],0x0)['toFixed'](0x2)+_0x46f88c(0x1e4)),console[_0x46f88c(0x244)]('\x20\x20\x20‚úÖ\x20Actual\x20available\x20balance:\x20'+_0x322090['toFixed'](0x2)+_0x46f88c(0x276)),{'id':_0x299d50['id'],'fullName':_0x299d50[_0x46f88c(0x27a)],'username':_0x299d50[_0x46f88c(0x20d)],'telegramId':_0x299d50[_0x46f88c(0x238)],'merchantUrl':_0x299d50['shopUrl'],'wallets':{'usdtPolygonWallet':_0x299d50[_0x46f88c(0x226)],'usdtTrcWallet':_0x299d50[_0x46f88c(0x1bc)],'usdtErcWallet':_0x299d50[_0x46f88c(0x1da)],'usdcPolygonWallet':_0x299d50['usdcPolygonWallet']},'totalAmountUSDT':Math[_0x46f88c(0x198)](_0x418ca6*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x46f88c(0x198)](_0x322090*0x64)/0x64,'totalPayout':Math['round'](_0x2b1d26*0x64)/0x64,'thisMonth':Math['round'](_0x55791e*0x64)/0x64,'paymentsCount':_0x4ab192,'oldestPaymentDate':_0x45d45c?.[_0x46f88c(0x1df)]||_0x299d50[_0x46f88c(0x25e)],'gatewayBreakdown':_0x1a9560};})),_0xbea8ec=_0x2276de[_0x37fb13(0x14e)]((_0x15a8a7,_0x4aff30)=>_0x15a8a7+_0x4aff30[_0x37fb13(0x228)],0x0),_0x4e51a0=_0x2276de[_0x37fb13(0x14e)]((_0x29e546,_0x3fe7a6)=>_0x29e546+_0x3fe7a6[_0x37fb13(0x262)],0x0),_0x2e33ee=_0x2276de[_0x37fb13(0x14e)]((_0x1f1a5c,_0x626f21)=>_0x1f1a5c+_0x626f21[_0x37fb13(0x252)],0x0),_0x28b6c7=_0x2276de[_0x37fb13(0x14e)]((_0x2866a0,_0x481dbd)=>_0x2866a0+_0x481dbd['thisMonth'],0x0);return console['log']('üìä\x20Merchants\x20awaiting\x20payout:\x20'+_0x4a8760+_0x37fb13(0x200)),console[_0x37fb13(0x244)](_0x37fb13(0x245)+Math['round'](_0xbea8ec*0x64)/0x64+_0x37fb13(0x233)),console['log'](_0x37fb13(0x1be)+Math[_0x37fb13(0x198)](_0x4e51a0*0x64)/0x64+_0x37fb13(0x222)),console[_0x37fb13(0x244)](_0x37fb13(0x1aa)+Math[_0x37fb13(0x198)](_0x2e33ee*0x64)/0x64+_0x37fb13(0x25d)),console[_0x37fb13(0x244)]('\x20\x20\x20üìÖ\x20Total\x20payouts\x20(this\x20month):\x20'+Math[_0x37fb13(0x198)](_0x28b6c7*0x64)/0x64+_0x37fb13(0x25d)),{'merchants':_0x2276de,'pagination':{'page':_0x4a02ef,'limit':_0x365f2c,'total':_0x4a8760,'totalPages':Math[_0x37fb13(0x159)](_0x4a8760/_0x365f2c)},'summary':{'totalMerchants':_0x4a8760,'totalAmountUSDT':Math[_0x37fb13(0x198)](_0xbea8ec*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x37fb13(0x198)](_0x4e51a0*0x64)/0x64,'totalPayout':Math[_0x37fb13(0x198)](_0x2e33ee*0x64)/0x64,'thisMonth':Math[_0x37fb13(0x198)](_0x28b6c7*0x64)/0x64}};}async[a35_0x4ed3ea(0x19c)](_0x255204){const _0x455853=a35_0x4ed3ea,{shopId:_0x2ab73b,amount:_0x198061,network:_0x132939,wallet:_0x307e5e,notes:_0x4fe4bd,txid:_0x5f3364,periodFrom:_0x6f3b45,periodTo:_0x571f97}=_0x255204,_0x22f30c=await database_1[_0x455853(0x273)][_0x455853(0x26c)](async _0x4ea945=>{const _0x268e87=_0x455853,_0x5c432a=await _0x4ea945['shop']['findUnique']({'where':{'id':_0x2ab73b},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x5c432a)throw new Error(_0x268e87(0x265));console[_0x268e87(0x244)](_0x268e87(0x1f9)+_0x5c432a[_0x268e87(0x20d)]+':'),console['log']('\x20\x20\x20Current\x20balance:\x20'+_0x5c432a[_0x268e87(0x1d8)]['toFixed'](0x6)+'\x20USDT'),console[_0x268e87(0x244)](_0x268e87(0x22a)+_0x198061[_0x268e87(0x17d)](0x6)+'\x20USDT'),console['log']('\x20\x20\x20Current\x20total\x20paid\x20out:\x20'+_0x5c432a[_0x268e87(0x22f)][_0x268e87(0x17d)](0x6)+'\x20USDT');if(_0x5f3364)console[_0x268e87(0x244)](_0x268e87(0x154)+_0x5f3364);if(_0x5c432a['balance']<_0x198061)throw new Error(_0x268e87(0x14b)+_0x5c432a[_0x268e87(0x1d8)][_0x268e87(0x17d)](0x6)+_0x268e87(0x246)+_0x198061['toFixed'](0x6)+_0x268e87(0x25d));let _0x3c9115=_0x307e5e;if(!_0x3c9115){const _0x404648=await _0x4ea945[_0x268e87(0x207)][_0x268e87(0x270)]({'where':{'id':_0x2ab73b},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x404648)switch(_0x132939){case'polygon':_0x3c9115=_0x404648[_0x268e87(0x226)]||undefined;break;case _0x268e87(0x1f4):_0x3c9115=_0x404648[_0x268e87(0x1bc)]||undefined;break;case _0x268e87(0x236):_0x3c9115=_0x404648[_0x268e87(0x1da)]||undefined;break;case'polygon_usdc':_0x3c9115=_0x404648['usdcPolygonWallet']||undefined;break;}}console['log'](_0x268e87(0x1cf)+_0x132939+':\x20'+(_0x3c9115||_0x268e87(0x221)));const _0x4677d6=await _0x4ea945[_0x268e87(0x26d)][_0x268e87(0x187)]({'data':{'shopId':_0x2ab73b,'amount':_0x198061,'network':_0x132939,'status':_0x268e87(0x194),'txid':_0x5f3364,'notes':_0x4fe4bd,'periodFrom':_0x6f3b45?new Date(_0x6f3b45):null,'periodTo':_0x571f97?new Date(_0x571f97):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x5df7d8=_0x5c432a['balance']-_0x198061,_0x181d47=_0x5c432a[_0x268e87(0x22f)]+_0x198061;return await _0x4ea945['shop']['update']({'where':{'id':_0x2ab73b},'data':{'balance':_0x5df7d8,'totalPaidOut':_0x181d47}}),console[_0x268e87(0x244)](_0x268e87(0x186)+_0x5c432a[_0x268e87(0x20d)]+_0x268e87(0x27b)),console[_0x268e87(0x244)](_0x268e87(0x1ec)+_0x5c432a['balance'][_0x268e87(0x17d)](0x6)+_0x268e87(0x25a)+_0x5df7d8['toFixed'](0x6)+_0x268e87(0x230)+_0x198061['toFixed'](0x6)+')'),console['log'](_0x268e87(0x212)+_0x5c432a[_0x268e87(0x22f)][_0x268e87(0x17d)](0x6)+_0x268e87(0x25a)+_0x181d47[_0x268e87(0x17d)](0x6)+_0x268e87(0x173)+_0x198061['toFixed'](0x6)+')'),{'payout':_0x4677d6,'shop':_0x5c432a};});return console['log'](_0x455853(0x1e3)+_0x22f30c[_0x455853(0x26d)]['id']+_0x455853(0x1db)+_0x22f30c[_0x455853(0x207)]['username']+'\x20('+_0x198061+_0x455853(0x1c1)),{'id':_0x22f30c[_0x455853(0x26d)]['id'],'shopId':_0x22f30c[_0x455853(0x26d)][_0x455853(0x1f0)],'shopName':_0x22f30c['shop'][_0x455853(0x27a)],'shopUsername':_0x22f30c[_0x455853(0x207)][_0x455853(0x20d)],'amount':_0x22f30c[_0x455853(0x26d)]['amount'],'network':_0x22f30c[_0x455853(0x26d)][_0x455853(0x250)],'status':_0x22f30c[_0x455853(0x26d)][_0x455853(0x17a)],'txid':_0x22f30c[_0x455853(0x26d)][_0x455853(0x225)],'notes':_0x22f30c['payout'][_0x455853(0x261)],'periodFrom':_0x22f30c[_0x455853(0x26d)]['periodFrom'],'periodTo':_0x22f30c['payout'][_0x455853(0x189)],'createdAt':_0x22f30c[_0x455853(0x26d)][_0x455853(0x25e)],'paidAt':_0x22f30c[_0x455853(0x26d)][_0x455853(0x1df)]};}async['getAllPayouts'](_0x495119){const _0xbb3073=a35_0x4ed3ea,{page:_0x54d33b,limit:_0x261c2d,shopId:_0x2d7e93,network:_0x5be38b,dateFrom:_0x2f8385,dateTo:_0x18db90,search:_0x2a5374}=_0x495119,_0x35ae98=(_0x54d33b-0x1)*_0x261c2d,_0x2de3f4={};_0x2d7e93&&(_0x2de3f4[_0xbb3073(0x1f0)]=_0x2d7e93);_0x5be38b&&(_0x2de3f4[_0xbb3073(0x250)]=_0x5be38b);(_0x2f8385||_0x18db90)&&(_0x2de3f4[_0xbb3073(0x25e)]={},_0x2f8385&&(_0x2de3f4['createdAt']['gte']=new Date(_0x2f8385)),_0x18db90&&(_0x2de3f4[_0xbb3073(0x25e)][_0xbb3073(0x24f)]=new Date(_0x18db90)));_0x2a5374&&(_0x2de3f4['OR']=[{'shop':{'name':{'contains':_0x2a5374,'mode':_0xbb3073(0x167)}}},{'shop':{'username':{'contains':_0x2a5374,'mode':'insensitive'}}},{'notes':{'contains':_0x2a5374,'mode':_0xbb3073(0x167)}}]);const [_0x42f694,_0x30a4f6]=await Promise[_0xbb3073(0x1ee)]([database_1[_0xbb3073(0x273)][_0xbb3073(0x26d)]['findMany']({'where':_0x2de3f4,'skip':_0x35ae98,'take':_0x261c2d,'orderBy':{'createdAt':_0xbb3073(0x1e8)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0xbb3073(0x273)][_0xbb3073(0x26d)]['count']({'where':_0x2de3f4})]);return{'payouts':_0x42f694[_0xbb3073(0x201)](_0x4bd1c2=>({'id':_0x4bd1c2['id'],'shopId':_0x4bd1c2[_0xbb3073(0x1f0)],'shopName':_0x4bd1c2[_0xbb3073(0x207)][_0xbb3073(0x27a)],'shopUsername':_0x4bd1c2[_0xbb3073(0x207)][_0xbb3073(0x20d)],'amount':_0x4bd1c2[_0xbb3073(0x1c3)],'network':_0x4bd1c2[_0xbb3073(0x250)],'status':_0x4bd1c2[_0xbb3073(0x17a)],'txid':_0x4bd1c2[_0xbb3073(0x225)],'notes':_0x4bd1c2[_0xbb3073(0x261)],'periodFrom':_0x4bd1c2[_0xbb3073(0x26a)],'periodTo':_0x4bd1c2[_0xbb3073(0x189)],'createdAt':_0x4bd1c2[_0xbb3073(0x25e)],'paidAt':_0x4bd1c2[_0xbb3073(0x1df)]})),'pagination':{'page':_0x54d33b,'limit':_0x261c2d,'total':_0x30a4f6,'totalPages':Math[_0xbb3073(0x159)](_0x30a4f6/_0x261c2d)}};}async[a35_0x4ed3ea(0x1c8)](_0x4f59ef){const _0x436902=a35_0x4ed3ea,_0x439018=await database_1[_0x436902(0x273)][_0x436902(0x26d)]['findUnique']({'where':{'id':_0x4f59ef},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x439018)return null;return{'id':_0x439018['id'],'shopId':_0x439018[_0x436902(0x1f0)],'shopName':_0x439018[_0x436902(0x207)][_0x436902(0x27a)],'shopUsername':_0x439018[_0x436902(0x207)][_0x436902(0x20d)],'amount':_0x439018[_0x436902(0x1c3)],'network':_0x439018['network'],'status':_0x439018[_0x436902(0x17a)],'txid':_0x439018[_0x436902(0x225)],'notes':_0x439018[_0x436902(0x261)],'periodFrom':_0x439018[_0x436902(0x26a)],'periodTo':_0x439018[_0x436902(0x189)],'createdAt':_0x439018[_0x436902(0x25e)],'paidAt':_0x439018['paidAt']};}async[a35_0x4ed3ea(0x184)](_0x3660b8){const _0x5dfcb7=a35_0x4ed3ea;await database_1[_0x5dfcb7(0x273)][_0x5dfcb7(0x26d)][_0x5dfcb7(0x171)]({'where':{'id':_0x3660b8}});}async[a35_0x4ed3ea(0x1b5)](_0x59e462){const _0x16e230=a35_0x4ed3ea,{page:_0x298c89,limit:_0x11b92e,status:_0x113298,gateway:_0x1dbcad,shopId:_0x34771d,dateFrom:_0x4587dc,dateTo:_0x375167,search:_0x5bd31a,currency:_0x3a6541,sortBy:_0x54240a,sortOrder:_0x186d0d}=_0x59e462,_0x48c8e7=(_0x298c89-0x1)*_0x11b92e;console[_0x16e230(0x244)](_0x16e230(0x20f),_0x59e462);const _0x2a50c6=await database_1['default']['payment']['groupBy']({'by':[_0x16e230(0x17b)],'_count':{'gateway':!![]}});console[_0x16e230(0x244)](_0x16e230(0x254),_0x2a50c6[_0x16e230(0x201)](_0xafb312=>_0xafb312['gateway']+'\x20('+_0xafb312[_0x16e230(0x22b)]['gateway']+_0x16e230(0x1d3)));if(_0x1dbcad){const _0xd46e96=_0x2a50c6[_0x16e230(0x190)](_0x35e461=>_0x35e461[_0x16e230(0x17b)][_0x16e230(0x217)]()===_0x1dbcad[_0x16e230(0x217)]());!_0xd46e96&&_0x1dbcad['toLowerCase']()!==_0x16e230(0x16d)&&console[_0x16e230(0x244)]('‚ö†Ô∏è\x20Requested\x20gateway\x20\x27'+_0x1dbcad+'\x27\x20not\x20found.\x20Available\x20gateways:\x20'+_0x2a50c6['map'](_0x3a652d=>_0x3a652d[_0x16e230(0x17b)])[_0x16e230(0x251)](',\x20'));}const _0x3ce365={};_0x113298&&(_0x3ce365[_0x16e230(0x17a)]=_0x113298[_0x16e230(0x1a5)]());if(!_0x1dbcad)_0x3ce365[_0x16e230(0x17b)]={'not':_0x16e230(0x16d)};else{if(_0x1dbcad&&(_0x1dbcad[_0x16e230(0x217)]()===_0x16e230(0x16d)||_0x1dbcad==='0000'))_0x3ce365[_0x16e230(0x17b)]=_0x16e230(0x16d);else{let _0x48ea97=_0x1dbcad;const _0x50bf8e=(0x0,gateway_1[_0x16e230(0x1cc)])(_0x1dbcad);if(_0x50bf8e)_0x48ea97=_0x50bf8e,console[_0x16e230(0x244)](_0x16e230(0x25c)+_0x1dbcad+_0x16e230(0x258)+_0x48ea97+'\x27');else{const _0x292a94=(0x0,gateway_1['getGatewayIdByName'])(_0x1dbcad);if(_0x292a94){const _0x1405dc=(0x0,gateway_1['getGatewayNameById'])(_0x292a94);_0x1405dc&&(_0x48ea97=_0x1405dc,console['log']('üîÑ\x20Converted\x20gateway\x20name\x20\x27'+_0x1dbcad+_0x16e230(0x182)+_0x292a94+_0x16e230(0x1f8)+_0x48ea97+'\x27'));}else console[_0x16e230(0x244)](_0x16e230(0x163)+_0x1dbcad+_0x16e230(0x168));}const _0x2fe74b=await database_1['default'][_0x16e230(0x1fd)][_0x16e230(0x16f)]({'where':{'gateway':_0x48ea97[_0x16e230(0x217)]()},'take':0x1});_0x2fe74b===0x0?(console['log']('‚ö†Ô∏è\x20Gateway\x20\x27'+_0x48ea97+'\x27\x20(from\x20\x27'+_0x1dbcad+_0x16e230(0x247)),_0x3ce365[_0x16e230(0x17b)]=_0x16e230(0x234)):(_0x3ce365['gateway']=_0x48ea97[_0x16e230(0x217)](),console[_0x16e230(0x244)](_0x16e230(0x174)+_0x48ea97+_0x16e230(0x192)+_0x1dbcad+'\x27)'));}}console['log']('üìä\x20Gateway\x20filter\x20applied:',_0x3ce365[_0x16e230(0x17b)]);_0x34771d&&(_0x3ce365[_0x16e230(0x1f0)]=_0x34771d);_0x3a6541&&(_0x3ce365[_0x16e230(0x24e)]=_0x3a6541[_0x16e230(0x1a5)](),console['log'](_0x16e230(0x14d)+_0x3a6541['toUpperCase']()));(_0x4587dc||_0x375167)&&(_0x3ce365[_0x16e230(0x25e)]={},_0x4587dc&&(_0x3ce365[_0x16e230(0x25e)]['gte']=new Date(_0x4587dc)),_0x375167&&(_0x3ce365[_0x16e230(0x25e)]['lte']=new Date(_0x375167)));_0x5bd31a&&(_0x3ce365['OR']=[{'id':{'contains':_0x5bd31a,'mode':_0x16e230(0x167)}},{'orderId':{'contains':_0x5bd31a,'mode':_0x16e230(0x167)}},{'gatewayOrderId':{'contains':_0x5bd31a,'mode':'insensitive'}},{'customerEmail':{'contains':_0x5bd31a,'mode':_0x16e230(0x167)}},{'shop':{'name':{'contains':_0x5bd31a,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x5bd31a,'mode':'insensitive'}}}]);console['log'](_0x16e230(0x1d9),JSON['stringify'](_0x3ce365,null,0x2));let _0x2456b0={'createdAt':_0x16e230(0x1e8)};if(_0x54240a){const _0x16c7e9=[_0x16e230(0x1c3),_0x16e230(0x25e),'updatedAt','status',_0x16e230(0x17b),'currency'],_0x1477a2=[_0x16e230(0x1ab),_0x16e230(0x1e8)];if(_0x16c7e9[_0x16e230(0x1f2)](_0x54240a)){const _0x42d76e=_0x1477a2['includes'](_0x186d0d)?_0x186d0d:_0x16e230(0x1e8);_0x2456b0={[_0x54240a]:_0x42d76e},console[_0x16e230(0x244)](_0x16e230(0x166)+_0x54240a+_0x16e230(0x18c)+_0x42d76e+'\x20order');}}const [_0x2c00c9,_0x5f3395]=await Promise[_0x16e230(0x1ee)]([database_1[_0x16e230(0x273)]['payment'][_0x16e230(0x15e)]({'where':_0x3ce365,'skip':_0x48c8e7,'take':_0x11b92e,'orderBy':_0x2456b0,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x16e230(0x1fd)]['count']({'where':_0x3ce365})]);return{'payments':_0x2c00c9,'pagination':{'page':_0x298c89,'limit':_0x11b92e,'total':_0x5f3395,'totalPages':Math['ceil'](_0x5f3395/_0x11b92e)}};}async['getPaymentById'](_0x5d6fdd){const _0x18af4=a35_0x4ed3ea,_0x2a07bf=await database_1[_0x18af4(0x273)][_0x18af4(0x1fd)]['findUnique']({'where':{'id':_0x5d6fdd},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x2a07bf)return null;return{'id':_0x2a07bf['id'],'shopId':_0x2a07bf[_0x18af4(0x1f0)],'gateway':_0x2a07bf['gateway'],'amount':_0x2a07bf[_0x18af4(0x1c3)],'currency':_0x2a07bf[_0x18af4(0x24e)],'status':_0x2a07bf[_0x18af4(0x17a)],'orderId':_0x2a07bf[_0x18af4(0x263)],'gatewayOrderId':_0x2a07bf[_0x18af4(0x1fb)],'customerEmail':_0x2a07bf[_0x18af4(0x18f)],'customerName':_0x2a07bf[_0x18af4(0x195)],'customerCountry':_0x2a07bf[_0x18af4(0x17f)],'customerIp':_0x2a07bf[_0x18af4(0x23d)],'customerUa':_0x2a07bf[_0x18af4(0x239)],'failureMessage':_0x2a07bf['failureMessage'],'externalPaymentUrl':_0x2a07bf[_0x18af4(0x243)],'successUrl':_0x2a07bf[_0x18af4(0x197)],'failUrl':_0x2a07bf['failUrl'],'pendingUrl':_0x2a07bf[_0x18af4(0x1a4)],'whiteUrl':_0x2a07bf[_0x18af4(0x23c)],'createdAt':_0x2a07bf[_0x18af4(0x25e)],'updatedAt':_0x2a07bf[_0x18af4(0x274)],'shop':_0x2a07bf[_0x18af4(0x207)]};}async[a35_0x4ed3ea(0x1a9)](_0x347eab,_0x67e295,_0x2e53af,_0xe6b06b){const _0xeba2d5=a35_0x4ed3ea,_0x24451d=await database_1['default'][_0xeba2d5(0x26c)](async _0x4f8bdf=>{const _0x483cf2=_0xeba2d5,_0x1f5cb0=await _0x4f8bdf[_0x483cf2(0x1fd)]['findUnique']({'where':{'id':_0x347eab},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x1f5cb0)throw new Error('Payment\x20not\x20found');const _0x303754=_0x1f5cb0['status'],_0x18b142=_0x67e295[_0x483cf2(0x1a5)]();console[_0x483cf2(0x244)](_0x483cf2(0x15a)+_0x347eab+_0x483cf2(0x188)+_0x303754+_0x483cf2(0x25a)+_0x18b142),console['log'](_0x483cf2(0x278)+_0x1f5cb0[_0x483cf2(0x207)][_0x483cf2(0x1d8)]+_0x483cf2(0x25d));const _0x29b181={'status':_0x18b142,'updatedAt':new Date(),'statusChangedBy':'admin','statusChangedAt':new Date()};_0x2e53af&&(_0x29b181[_0x483cf2(0x256)]=_0x2e53af);_0x18b142===_0x483cf2(0x23f)&&_0xe6b06b&&(_0x29b181['chargebackAmount']=_0xe6b06b);let _0x149948=0x0,_0x1d1836=_0x1f5cb0[_0x483cf2(0x207)][_0x483cf2(0x1d8)];if(_0x18b142===_0x483cf2(0x209)&&_0x303754!=='PAID'){_0x29b181[_0x483cf2(0x1df)]=new Date();const _0x10406a=await currencyService_1[_0x483cf2(0x271)][_0x483cf2(0x18d)](_0x1f5cb0['amount'],_0x1f5cb0[_0x483cf2(0x24e)]);_0x29b181[_0x483cf2(0x157)]=_0x10406a;let _0x5099ac=0xa;const _0x1f7ee4=await _0x4f8bdf[_0x483cf2(0x207)]['findUnique']({'where':{'id':_0x1f5cb0[_0x483cf2(0x1f0)]},'select':{'gatewaySettings':!![]}});if(_0x1f7ee4?.[_0x483cf2(0x1fa)])try{const _0x60f164=JSON['parse'](_0x1f7ee4[_0x483cf2(0x1fa)]);for(const [_0x5d12aa,_0x48c1b2]of Object[_0x483cf2(0x20c)](_0x60f164)){if(_0x5d12aa['toLowerCase']()===_0x1f5cb0[_0x483cf2(0x17b)][_0x483cf2(0x217)]()){_0x5099ac=_0x48c1b2[_0x483cf2(0x175)]||0xa;break;}}}catch(_0x35f924){console[_0x483cf2(0x1f6)](_0x483cf2(0x231)+_0x347eab+':',_0x35f924);}const _0x39b472=_0x10406a*(0x1-_0x5099ac/0x64);_0x149948=_0x39b472,_0x1d1836+=_0x39b472,console['log'](_0x483cf2(0x1c7)+_0x347eab+_0x483cf2(0x253)),console[_0x483cf2(0x244)](_0x483cf2(0x191)+_0x10406a[_0x483cf2(0x17d)](0x6)+'\x20USDT'),console[_0x483cf2(0x244)](_0x483cf2(0x249)+_0x1f5cb0[_0x483cf2(0x17b)]+',\x20Commission:\x20'+_0x5099ac+'%'),console['log'](_0x483cf2(0x24b)+_0x39b472[_0x483cf2(0x17d)](0x6)+_0x483cf2(0x14f)+_0x5099ac+_0x483cf2(0x1b7)),console['log'](_0x483cf2(0x18e)+_0x39b472[_0x483cf2(0x17d)](0x6)+_0x483cf2(0x25d));}else{if(_0x303754===_0x483cf2(0x209)&&_0x18b142!=='PAID'){if(_0x1f5cb0[_0x483cf2(0x157)]){let _0x2e2b50=0xa;const _0x305d87=await _0x4f8bdf['shop']['findUnique']({'where':{'id':_0x1f5cb0[_0x483cf2(0x1f0)]},'select':{'gatewaySettings':!![]}});if(_0x305d87?.[_0x483cf2(0x1fa)])try{const _0x50d4dd=JSON[_0x483cf2(0x19d)](_0x305d87[_0x483cf2(0x1fa)]);for(const [_0x2a6935,_0x30f459]of Object['entries'](_0x50d4dd)){if(_0x2a6935[_0x483cf2(0x217)]()===_0x1f5cb0[_0x483cf2(0x17b)][_0x483cf2(0x217)]()){_0x2e2b50=_0x30f459[_0x483cf2(0x175)]||0xa;break;}}}catch(_0x30eebc){console[_0x483cf2(0x1f6)](_0x483cf2(0x231)+_0x347eab+':',_0x30eebc);}const _0x4e47da=_0x1f5cb0[_0x483cf2(0x157)]*(0x1-_0x2e2b50/0x64);_0x149948=-_0x4e47da,_0x1d1836-=_0x4e47da,_0x29b181[_0x483cf2(0x157)]=null,console[_0x483cf2(0x244)]('üí∞\x20Payment\x20'+_0x347eab+'\x20no\x20longer\x20PAID:'),console['log']('\x20\x20\x20Full\x20amount:\x20'+_0x1f5cb0[_0x483cf2(0x157)][_0x483cf2(0x17d)](0x6)+_0x483cf2(0x25d)),console[_0x483cf2(0x244)]('\x20\x20\x20Gateway:\x20'+_0x1f5cb0[_0x483cf2(0x17b)]+_0x483cf2(0x1ad)+_0x2e2b50+'%'),console['log'](_0x483cf2(0x150)+_0x4e47da[_0x483cf2(0x17d)](0x6)+_0x483cf2(0x14f)+_0x2e2b50+'%\x20commission)'),console[_0x483cf2(0x244)](_0x483cf2(0x1e6)+_0x4e47da[_0x483cf2(0x17d)](0x6)+'\x20USDT');}}}_0x18b142===_0x483cf2(0x23f)&&(_0x303754===_0x483cf2(0x209)&&_0x1f5cb0[_0x483cf2(0x157)]&&console['log'](_0x483cf2(0x1cd)),_0xe6b06b&&_0xe6b06b>0x0&&(_0x149948-=_0xe6b06b,_0x1d1836-=_0xe6b06b,console['log']('üí∏\x20CHARGEBACK\x20penalty:\x20-'+_0xe6b06b[_0x483cf2(0x17d)](0x6)+_0x483cf2(0x1ca))));_0x18b142==='REFUND'&&_0x303754===_0x483cf2(0x209)&&console[_0x483cf2(0x244)]('üîÑ\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance');const _0x34338c=await _0x4f8bdf[_0x483cf2(0x1fd)][_0x483cf2(0x22c)]({'where':{'id':_0x347eab},'data':_0x29b181,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x149948!==0x0&&(await _0x4f8bdf[_0x483cf2(0x207)]['update']({'where':{'id':_0x1f5cb0['shopId']},'data':{'balance':_0x1d1836}}),console[_0x483cf2(0x244)](_0x483cf2(0x186)+_0x1f5cb0[_0x483cf2(0x1f0)]+_0x483cf2(0x1e5)+_0x1f5cb0[_0x483cf2(0x207)][_0x483cf2(0x1d8)][_0x483cf2(0x17d)](0x6)+'\x20->\x20'+_0x1d1836['toFixed'](0x6)+_0x483cf2(0x1d6)+(_0x149948>0x0?'+':'')+_0x149948[_0x483cf2(0x17d)](0x6)+')')),_0x34338c;});return{'id':_0x24451d['id'],'shopId':_0x24451d[_0xeba2d5(0x1f0)],'gateway':_0x24451d[_0xeba2d5(0x17b)],'amount':_0x24451d[_0xeba2d5(0x1c3)],'currency':_0x24451d[_0xeba2d5(0x24e)],'status':_0x24451d[_0xeba2d5(0x17a)],'orderId':_0x24451d[_0xeba2d5(0x263)],'gatewayOrderId':_0x24451d[_0xeba2d5(0x1fb)],'customerEmail':_0x24451d['customerEmail'],'customerName':_0x24451d[_0xeba2d5(0x195)],'customerCountry':_0x24451d[_0xeba2d5(0x17f)],'customerIp':_0x24451d[_0xeba2d5(0x23d)],'customerUa':_0x24451d[_0xeba2d5(0x239)],'failureMessage':_0x24451d[_0xeba2d5(0x19a)],'adminNotes':_0x24451d[_0xeba2d5(0x256)],'chargebackAmount':_0x24451d[_0xeba2d5(0x1b9)],'statusChangedBy':_0x24451d[_0xeba2d5(0x1c2)],'statusChangedAt':_0x24451d['statusChangedAt'],'createdAt':_0x24451d[_0xeba2d5(0x25e)],'updatedAt':_0x24451d['updatedAt'],'shop':_0x24451d['shop']};}async[a35_0x4ed3ea(0x1c4)](_0x27c056,_0x40fad7){const _0x17b9ce=a35_0x4ed3ea,_0x1dad17={..._0x40fad7};_0x40fad7[_0x17b9ce(0x16a)]&&(_0x1dad17['password']=await bcryptjs_1[_0x17b9ce(0x273)]['hash'](_0x40fad7[_0x17b9ce(0x16a)],0xc));_0x40fad7[_0x17b9ce(0x20b)]&&(_0x1dad17[_0x17b9ce(0x27a)]=_0x40fad7[_0x17b9ce(0x20b)],delete _0x1dad17[_0x17b9ce(0x20b)]);_0x40fad7[_0x17b9ce(0x21a)]&&(_0x1dad17[_0x17b9ce(0x238)]=_0x40fad7[_0x17b9ce(0x21a)],delete _0x1dad17[_0x17b9ce(0x21a)]);_0x40fad7[_0x17b9ce(0x185)]&&(_0x1dad17['shopUrl']=_0x40fad7['merchantUrl'],delete _0x1dad17['merchantUrl']);if(_0x40fad7[_0x17b9ce(0x152)]){const _0x2dc933=_0x40fad7[_0x17b9ce(0x152)][_0x17b9ce(0x201)](_0x5647e6=>this['getGatewayInternalName'](_0x5647e6));console['log']('üîÑ\x20Gateway\x20mapping:',_0x40fad7[_0x17b9ce(0x152)],'->',_0x2dc933),_0x1dad17['paymentGateways']=JSON[_0x17b9ce(0x153)](_0x2dc933),delete _0x1dad17['gateways'];}_0x40fad7['gatewaySettings']&&(_0x1dad17[_0x17b9ce(0x1fa)]=JSON[_0x17b9ce(0x153)](_0x40fad7[_0x17b9ce(0x1fa)]),delete _0x1dad17[_0x17b9ce(0x1fa)]);_0x40fad7['wallets']&&(_0x40fad7['wallets']['usdtPolygonWallet']!==undefined&&(_0x1dad17[_0x17b9ce(0x226)]=_0x40fad7[_0x17b9ce(0x1e0)]['usdtPolygonWallet']||null),_0x40fad7['wallets'][_0x17b9ce(0x1bc)]!==undefined&&(_0x1dad17[_0x17b9ce(0x1bc)]=_0x40fad7[_0x17b9ce(0x1e0)][_0x17b9ce(0x1bc)]||null),_0x40fad7['wallets'][_0x17b9ce(0x1da)]!==undefined&&(_0x1dad17[_0x17b9ce(0x1da)]=_0x40fad7[_0x17b9ce(0x1e0)][_0x17b9ce(0x1da)]||null),_0x40fad7['wallets'][_0x17b9ce(0x1f1)]!==undefined&&(_0x1dad17[_0x17b9ce(0x1f1)]=_0x40fad7[_0x17b9ce(0x1e0)]['usdcPolygonWallet']||null),delete _0x1dad17[_0x17b9ce(0x1e0)]);const _0x175627=await database_1[_0x17b9ce(0x273)][_0x17b9ce(0x207)][_0x17b9ce(0x22c)]({'where':{'id':_0x27c056},'data':_0x1dad17,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x175627['id'],'fullName':_0x175627['name'],'username':_0x175627[_0x17b9ce(0x20d)],'telegramId':_0x175627[_0x17b9ce(0x238)],'merchantUrl':_0x175627[_0x17b9ce(0x205)],'gateways':_0x175627[_0x17b9ce(0x1d2)]?JSON[_0x17b9ce(0x19d)](_0x175627[_0x17b9ce(0x1d2)]):null,'gatewaySettings':_0x175627[_0x17b9ce(0x1fa)]?JSON[_0x17b9ce(0x19d)](_0x175627[_0x17b9ce(0x1fa)]):null,'publicKey':_0x175627[_0x17b9ce(0x1ac)],'wallets':{'usdtPolygonWallet':_0x175627['usdtPolygonWallet'],'usdtTrcWallet':_0x175627[_0x17b9ce(0x1bc)],'usdtErcWallet':_0x175627[_0x17b9ce(0x1da)],'usdcPolygonWallet':_0x175627[_0x17b9ce(0x1f1)]},'status':_0x175627['status'],'createdAt':_0x175627[_0x17b9ce(0x25e)]};}async[a35_0x4ed3ea(0x272)](_0x12a593){const _0xfad683=a35_0x4ed3ea,_0x2788d4=await database_1[_0xfad683(0x273)][_0xfad683(0x207)]['update']({'where':{'id':_0x12a593},'data':{'status':_0xfad683(0x218)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2788d4['id'],'fullName':_0x2788d4[_0xfad683(0x27a)],'username':_0x2788d4[_0xfad683(0x20d)],'telegramId':_0x2788d4[_0xfad683(0x238)],'merchantUrl':_0x2788d4[_0xfad683(0x205)],'gateways':_0x2788d4['paymentGateways']?JSON[_0xfad683(0x19d)](_0x2788d4[_0xfad683(0x1d2)]):null,'gatewaySettings':_0x2788d4[_0xfad683(0x1fa)]?JSON[_0xfad683(0x19d)](_0x2788d4[_0xfad683(0x1fa)]):null,'publicKey':_0x2788d4['publicKey'],'wallets':{'usdtPolygonWallet':_0x2788d4[_0xfad683(0x226)],'usdtTrcWallet':_0x2788d4['usdtTrcWallet'],'usdtErcWallet':_0x2788d4[_0xfad683(0x1da)],'usdcPolygonWallet':_0x2788d4[_0xfad683(0x1f1)]},'status':_0x2788d4['status'],'createdAt':_0x2788d4['createdAt']};}async['activateUser'](_0xc32c59){const _0x382617=a35_0x4ed3ea,_0x56cbef=await database_1[_0x382617(0x273)][_0x382617(0x207)]['update']({'where':{'id':_0xc32c59},'data':{'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x56cbef['id'],'fullName':_0x56cbef[_0x382617(0x27a)],'username':_0x56cbef[_0x382617(0x20d)],'telegramId':_0x56cbef[_0x382617(0x238)],'merchantUrl':_0x56cbef['shopUrl'],'gateways':_0x56cbef[_0x382617(0x1d2)]?JSON[_0x382617(0x19d)](_0x56cbef[_0x382617(0x1d2)]):null,'gatewaySettings':_0x56cbef[_0x382617(0x1fa)]?JSON[_0x382617(0x19d)](_0x56cbef[_0x382617(0x1fa)]):null,'publicKey':_0x56cbef[_0x382617(0x1ac)],'wallets':{'usdtPolygonWallet':_0x56cbef[_0x382617(0x226)],'usdtTrcWallet':_0x56cbef[_0x382617(0x1bc)],'usdtErcWallet':_0x56cbef[_0x382617(0x1da)],'usdcPolygonWallet':_0x56cbef[_0x382617(0x1f1)]},'status':_0x56cbef[_0x382617(0x17a)],'createdAt':_0x56cbef[_0x382617(0x25e)]};}async[a35_0x4ed3ea(0x240)](_0x32a78d){const _0x28a1fb=a35_0x4ed3ea,{page:_0x40e402,limit:_0x2ed949,status:_0x4f8bb9}=_0x32a78d,_0x1e271e=(_0x40e402-0x1)*_0x2ed949,_0x514cf0={};_0x4f8bb9&&(_0x514cf0[_0x28a1fb(0x17a)]=_0x4f8bb9[_0x28a1fb(0x1a5)]());const [_0x5457e7,_0x42c3ab]=await Promise[_0x28a1fb(0x1ee)]([database_1[_0x28a1fb(0x273)][_0x28a1fb(0x207)][_0x28a1fb(0x15e)]({'where':_0x514cf0,'skip':_0x1e271e,'take':_0x2ed949,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x28a1fb(0x273)][_0x28a1fb(0x207)][_0x28a1fb(0x16f)]({'where':_0x514cf0})]);return{'users':_0x5457e7[_0x28a1fb(0x201)](_0x31c1c8=>{const _0x32bc8f=_0x28a1fb,_0x4ae571=_0x31c1c8['paymentGateways']?JSON[_0x32bc8f(0x19d)](_0x31c1c8[_0x32bc8f(0x1d2)]):null,_0x16eb7f=_0x4ae571?_0x4ae571[_0x32bc8f(0x201)](_0x3405ce=>this['getGatewayDisplayName'](_0x3405ce)):null;return{'id':_0x31c1c8['id'],'fullName':_0x31c1c8[_0x32bc8f(0x27a)],'username':_0x31c1c8[_0x32bc8f(0x20d)],'telegramId':_0x31c1c8[_0x32bc8f(0x238)],'merchantUrl':_0x31c1c8[_0x32bc8f(0x205)],'gateways':_0x16eb7f,'gatewaySettings':_0x31c1c8[_0x32bc8f(0x1fa)]?JSON[_0x32bc8f(0x19d)](_0x31c1c8['gatewaySettings']):null,'publicKey':_0x31c1c8[_0x32bc8f(0x1ac)],'wallets':{'usdtPolygonWallet':_0x31c1c8[_0x32bc8f(0x226)],'usdtTrcWallet':_0x31c1c8[_0x32bc8f(0x1bc)],'usdtErcWallet':_0x31c1c8[_0x32bc8f(0x1da)],'usdcPolygonWallet':_0x31c1c8[_0x32bc8f(0x1f1)]},'status':_0x31c1c8[_0x32bc8f(0x17a)],'createdAt':_0x31c1c8[_0x32bc8f(0x25e)]};}),'pagination':{'page':_0x40e402,'limit':_0x2ed949,'total':_0x42c3ab,'totalPages':Math[_0x28a1fb(0x159)](_0x42c3ab/_0x2ed949)}};}async[a35_0x4ed3ea(0x1f5)](_0x58d314){const _0x2e15cb=a35_0x4ed3ea,_0x3800de=await database_1[_0x2e15cb(0x273)][_0x2e15cb(0x207)][_0x2e15cb(0x270)]({'where':{'id':_0x58d314},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x3800de)return null;const _0x2b6f37=_0x3800de[_0x2e15cb(0x1d2)]?JSON[_0x2e15cb(0x19d)](_0x3800de[_0x2e15cb(0x1d2)]):null,_0x56130e=_0x2b6f37?_0x2b6f37[_0x2e15cb(0x201)](_0x5653c9=>this['getGatewayDisplayName'](_0x5653c9)):null;return _0x2b6f37&&_0x56130e&&console[_0x2e15cb(0x244)](_0x2e15cb(0x259),_0x2b6f37,'->',_0x56130e),{'id':_0x3800de['id'],'fullName':_0x3800de[_0x2e15cb(0x27a)],'username':_0x3800de[_0x2e15cb(0x20d)],'telegramId':_0x3800de[_0x2e15cb(0x238)],'merchantUrl':_0x3800de[_0x2e15cb(0x205)],'gateways':_0x56130e,'gatewaySettings':_0x3800de[_0x2e15cb(0x1fa)]?JSON[_0x2e15cb(0x19d)](_0x3800de[_0x2e15cb(0x1fa)]):null,'publicKey':_0x3800de[_0x2e15cb(0x1ac)],'wallets':{'usdtPolygonWallet':_0x3800de[_0x2e15cb(0x226)],'usdtTrcWallet':_0x3800de[_0x2e15cb(0x1bc)],'usdtErcWallet':_0x3800de[_0x2e15cb(0x1da)],'usdcPolygonWallet':_0x3800de[_0x2e15cb(0x1f1)]},'status':_0x3800de[_0x2e15cb(0x17a)],'createdAt':_0x3800de['createdAt']};}async['createUser'](_0x17e5a2){const _0x20c5c6=a35_0x4ed3ea,{fullName:_0x1c426c,username:_0x3a0831,password:_0x338c1c,telegramId:_0x51fd11,merchantUrl:_0x1d0dea,gateways:_0x5e23c6,gatewaySettings:_0x34ab7c,wallets:_0x3cd379}=_0x17e5a2,_0x2bf508=await database_1[_0x20c5c6(0x273)][_0x20c5c6(0x207)]['findUnique']({'where':{'username':_0x3a0831}});if(_0x2bf508)throw new Error(_0x20c5c6(0x1ce));if(_0x51fd11){const _0x562303=await database_1[_0x20c5c6(0x273)][_0x20c5c6(0x207)][_0x20c5c6(0x270)]({'where':{'telegram':_0x51fd11}});if(_0x562303)throw new Error(_0x20c5c6(0x1e2));}const _0x4bf845=await bcryptjs_1[_0x20c5c6(0x273)][_0x20c5c6(0x1ba)](_0x338c1c,0xc),_0x42e858=_0x20c5c6(0x25f)+crypto_1[_0x20c5c6(0x273)][_0x20c5c6(0x179)](0x20)[_0x20c5c6(0x1c6)](_0x20c5c6(0x277)),_0x51989e=_0x20c5c6(0x1eb)+crypto_1[_0x20c5c6(0x273)][_0x20c5c6(0x179)](0x20)['toString'](_0x20c5c6(0x277)),_0x5a80f8=_0x5e23c6?_0x5e23c6[_0x20c5c6(0x201)](_0x5a0aec=>this[_0x20c5c6(0x1b6)](_0x5a0aec)):null;_0x5e23c6&&_0x5a80f8&&console[_0x20c5c6(0x244)]('üîÑ\x20Gateway\x20mapping\x20(create):',_0x5e23c6,'->',_0x5a80f8);const _0x250e43=await database_1[_0x20c5c6(0x273)]['shop'][_0x20c5c6(0x187)]({'data':{'name':_0x1c426c,'username':_0x3a0831,'password':_0x4bf845,'telegram':_0x51fd11,'shopUrl':_0x1d0dea,'paymentGateways':_0x5a80f8?JSON[_0x20c5c6(0x153)](_0x5a80f8):null,'gatewaySettings':_0x34ab7c?JSON[_0x20c5c6(0x153)](_0x34ab7c):null,'usdtPolygonWallet':_0x3cd379?.['usdtPolygonWallet']||null,'usdtTrcWallet':_0x3cd379?.[_0x20c5c6(0x1bc)]||null,'usdtErcWallet':_0x3cd379?.['usdtErcWallet']||null,'usdcPolygonWallet':_0x3cd379?.['usdcPolygonWallet']||null,'publicKey':_0x42e858,'secretKey':_0x51989e,'status':_0x20c5c6(0x1a2)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x250e43['id'],'fullName':_0x250e43[_0x20c5c6(0x27a)],'username':_0x250e43[_0x20c5c6(0x20d)],'telegramId':_0x250e43[_0x20c5c6(0x238)],'merchantUrl':_0x250e43[_0x20c5c6(0x205)],'gateways':_0x250e43[_0x20c5c6(0x1d2)]?JSON[_0x20c5c6(0x19d)](_0x250e43[_0x20c5c6(0x1d2)]):null,'gatewaySettings':_0x250e43[_0x20c5c6(0x1fa)]?JSON['parse'](_0x250e43[_0x20c5c6(0x1fa)]):null,'publicKey':_0x250e43[_0x20c5c6(0x1ac)],'wallets':{'usdtPolygonWallet':_0x250e43['usdtPolygonWallet'],'usdtTrcWallet':_0x250e43[_0x20c5c6(0x1bc)],'usdtErcWallet':_0x250e43[_0x20c5c6(0x1da)],'usdcPolygonWallet':_0x250e43[_0x20c5c6(0x1f1)]},'status':_0x250e43[_0x20c5c6(0x17a)],'createdAt':_0x250e43[_0x20c5c6(0x25e)]};}async[a35_0x4ed3ea(0x19e)](_0x3295d5){const _0x46cf27=a35_0x4ed3ea;await database_1[_0x46cf27(0x273)][_0x46cf27(0x207)][_0x46cf27(0x171)]({'where':{'id':_0x3295d5}});}[a35_0x4ed3ea(0x213)](_0x1e2af1,_0x5bc79f,_0x475ead){const _0x5c9ec5=a35_0x4ed3ea,_0x5d954a=new Map(),_0x168481=new Date(_0x5bc79f);while(_0x168481<=_0x475ead){const _0x203a9b=_0x168481[_0x5c9ec5(0x214)]()[_0x5c9ec5(0x183)]('T')[0x0];_0x5d954a[_0x5c9ec5(0x26e)](_0x203a9b,{'revenue':0x0,'count':0x0}),_0x168481[_0x5c9ec5(0x1b0)](_0x168481[_0x5c9ec5(0x15f)]()+0x1);}for(const _0x198992 of _0x1e2af1){const _0x2574f6=_0x198992[_0x5c9ec5(0x25e)]['toISOString']()[_0x5c9ec5(0x183)]('T')[0x0],_0x2a9922=_0x5d954a[_0x5c9ec5(0x176)](_0x2574f6);_0x2a9922&&(_0x2a9922['count']+=0x1,_0x198992[_0x5c9ec5(0x17a)]===_0x5c9ec5(0x209)&&(_0x198992[_0x5c9ec5(0x157)]?_0x2a9922[_0x5c9ec5(0x216)]+=_0x198992[_0x5c9ec5(0x157)]:console['log']('‚ö†Ô∏è\x20Payment\x20'+_0x198992['id']+_0x5c9ec5(0x25b))));}const _0x51e023=[],_0x1d9f68=[];for(const [_0xf295f5,_0x27246a]of _0x5d954a){_0x51e023['push']({'date':_0xf295f5,'amount':Math['round'](_0x27246a[_0x5c9ec5(0x216)]*0x64)/0x64}),_0x1d9f68[_0x5c9ec5(0x1cb)]({'date':_0xf295f5,'count':_0x27246a[_0x5c9ec5(0x16f)]});}return{'dailyRevenue':_0x51e023,'dailyPayments':_0x1d9f68};}}exports['AdminService']=AdminService;