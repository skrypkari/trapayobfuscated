'use strict';const a53_0xc54d14=a53_0x326a;function a53_0x326a(_0x3e7c1e,_0x2f6001){_0x3e7c1e=_0x3e7c1e-0x68;const _0x261980=a53_0x2619();let _0x326a29=_0x261980[_0x3e7c1e];return _0x326a29;}(function(_0x2ae436,_0x2b494b){const _0x5167d1=a53_0x326a,_0x112cc7=_0x2ae436();while(!![]){try{const _0x14a441=-parseInt(_0x5167d1(0x13f))/0x1*(-parseInt(_0x5167d1(0x17e))/0x2)+-parseInt(_0x5167d1(0x216))/0x3+-parseInt(_0x5167d1(0x127))/0x4+-parseInt(_0x5167d1(0xea))/0x5*(-parseInt(_0x5167d1(0x1db))/0x6)+parseInt(_0x5167d1(0x19b))/0x7+-parseInt(_0x5167d1(0x1c5))/0x8*(-parseInt(_0x5167d1(0x85))/0x9)+parseInt(_0x5167d1(0x110))/0xa;if(_0x14a441===_0x2b494b)break;else _0x112cc7['push'](_0x112cc7['shift']());}catch(_0x521258){_0x112cc7['push'](_0x112cc7['shift']());}}}(a53_0x2619,0x88aa2));var __createBinding=this&&this[a53_0xc54d14(0xb2)]||(Object['create']?function(_0x707062,_0x551375,_0x3d0128,_0xc7a2c9){const _0x1f5e34=a53_0xc54d14;if(_0xc7a2c9===undefined)_0xc7a2c9=_0x3d0128;var _0x1de8ca=Object[_0x1f5e34(0x1aa)](_0x551375,_0x3d0128);(!_0x1de8ca||(_0x1f5e34(0x199)in _0x1de8ca?!_0x551375[_0x1f5e34(0x148)]:_0x1de8ca[_0x1f5e34(0x201)]||_0x1de8ca[_0x1f5e34(0x18c)]))&&(_0x1de8ca={'enumerable':!![],'get':function(){return _0x551375[_0x3d0128];}}),Object[_0x1f5e34(0x205)](_0x707062,_0xc7a2c9,_0x1de8ca);}:function(_0x540c44,_0x19d0cf,_0x5129fc,_0x533107){if(_0x533107===undefined)_0x533107=_0x5129fc;_0x540c44[_0x533107]=_0x19d0cf[_0x5129fc];}),__setModuleDefault=this&&this[a53_0xc54d14(0x87)]||(Object[a53_0xc54d14(0x222)]?function(_0x3167d9,_0x3acde3){const _0x35e232=a53_0xc54d14;Object[_0x35e232(0x205)](_0x3167d9,_0x35e232(0x207),{'enumerable':!![],'value':_0x3acde3});}:function(_0x4d22e8,_0x23b645){const _0x4b2f75=a53_0xc54d14;_0x4d22e8[_0x4b2f75(0x207)]=_0x23b645;}),__importStar=this&&this[a53_0xc54d14(0xce)]||(function(){var _0x1c1f11=function(_0x29cf5f){const _0x331c23=a53_0x326a;return _0x1c1f11=Object[_0x331c23(0x1b5)]||function(_0x230294){const _0xcc5e91=_0x331c23;var _0x19da6a=[];for(var _0xdcb29f in _0x230294)if(Object[_0xcc5e91(0x1e5)][_0xcc5e91(0x1ba)][_0xcc5e91(0x184)](_0x230294,_0xdcb29f))_0x19da6a[_0x19da6a[_0xcc5e91(0x1c8)]]=_0xdcb29f;return _0x19da6a;},_0x1c1f11(_0x29cf5f);};return function(_0x206485){const _0x529652=a53_0x326a;if(_0x206485&&_0x206485[_0x529652(0x148)])return _0x206485;var _0x1eb540={};if(_0x206485!=null){for(var _0x338bbf=_0x1c1f11(_0x206485),_0x108348=0x0;_0x108348<_0x338bbf[_0x529652(0x1c8)];_0x108348++)if(_0x338bbf[_0x108348]!==_0x529652(0x207))__createBinding(_0x1eb540,_0x206485,_0x338bbf[_0x108348]);}return __setModuleDefault(_0x1eb540,_0x206485),_0x1eb540;};}()),__importDefault=this&&this[a53_0xc54d14(0x75)]||function(_0x596897){const _0x21eef7=a53_0xc54d14;return _0x596897&&_0x596897[_0x21eef7(0x148)]?_0x596897:{'default':_0x596897};};Object[a53_0xc54d14(0x205)](exports,a53_0xc54d14(0x148),{'value':!![]}),exports['AdminService']=void 0x0;function a53_0x2619(){const _0x80d804=['890991JVdGJm','paidAt','__setModuleDefault','\x20\x20\x20Transaction\x20hash:\x20','asc','period','this_month','\x20order','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','Error\x20processing\x20payment\x20','\x20USDT\x20(same\x20as\x20awaiting)','createPayout','lte','rapyd','amountUSDT','\x20merchants','randomBytes','stringify','amountAfterGatewayCommissionUSDT','shop','setUTCDate','\x20\x20\x20ðŸ’¸\x20Total\x20payouts:\x20','ðŸ”„\x20Converted\x20gateway\x20ID\x20\x27','ðŸ“…\x20Date\x20to\x20filter:\x20','reduce','Rapyd','awaitingPayout','merchantUrl3','\x20to\x20','has','disableAdmin2FA','\x27\x20->\x20ID\x20\x27','totalAmountAfterCommissionUSDT','custom_','periodTo','log','findUnique','\x20\x20\x20ðŸŒ\x20IP:\x20','ðŸ”„\x20Updating\x20customer\x20data\x20for\x20payment\x20','notes','paymentsCount','ðŸ”\x20Admin\x20password\x20changed\x20successfully','telegram','\x20backup\x20codes','toString','__createBinding','ðŸ”§\x20[','ðŸ“Š\x20Statistics\x20date\x20range:\x20','pk_','all','values','gateways','warn','\x20USDT\x20(after\x20','_count','\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...','customerEmail','whiteUrl','ðŸŽ¯\x20[','getFullYear','availableBalance',',\x20userId:\x20',',\x20Commission:\x20','\x20\x20\x20ðŸª\x20Gateway\x20earnings:\x20','speakeasy','\x20in\x20','getUTCFullYear','existsSync','\x20USDT,\x20Required:\x20','\x20payments)','ðŸ”‘\x20Generated\x20','getMerchantsAwaitingPayout','\x20\x20\x20Balance:\x20','__importStar','\x20USDT\x20for\x20payment\x20','ðŸ”„\x20Gateway\x20mapping:','\x20\x20\x20âœ…\x20Actual\x20available\x20balance:\x20','disable2FA','ðŸ”\x20Selected\x20polygon_usdc\x20wallet:\x20','failureMessage','chargebackAmount','password','\x20PAID\x20payments','failUrl','ðŸ“Š\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','getGatewayIdByName','\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)','ðŸ’³\x20Final\x20payout\x20wallet\x20for\x20','setupAdmin2FA','shopUrl4','setup2FA','ðŸŽ¯\x20updateUser\x20called\x20with\x20ID:\x20','Telegram\x20username\x20already\x20exists','verify','last_week','MyXSpend','\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)','path','ðŸ”\x20Balance\x20check\x20details:','ðŸ“Š\x20Available\x20gateways\x20in\x20database:','\x20with\x20payout\x20history','188690tSpwuF','passwordHash','ðŸ’°\x20Found\x20','âœ…\x20Deposited\x20',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:',',\x20successful:\x20','error','replace','\x20\x20\x20Available\x20(number):\x20','\x20paid\x20payments\x20for\x20gateway\x20','Payment\x20not\x20found','\x20\x20\x20Merchant\x20gets:\x20','Merchant\x20not\x20found','ðŸ”„\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','ðŸ“Š\x20Sorting\x20payments\x20by\x20','customerName','gatewaySettings','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','Sepa','getUTCDay','\x20\x20\x20ðŸ’µ\x20Available\x20balance:\x20','publicKey','wallets','ðŸ”„\x20Admin\x20updating\x20payment\x20','customerCountry','.env','payout','\x20\x20\x20ðŸ¤”\x20Difference:\x20','getMonth','USDT','twoFactorSecret','ðŸ”\x202FA\x20enabled\x20for\x20shop:\x20','getPaymentById','ÐÐµ\x20ÑƒÐºÐ°Ð·Ð°Ð½','USDC','averageCommissionRate','findMany','shopUrl','7172400rDqDzs','\x20\x20\x20ðŸ“…\x20Total\x20payouts\x20(this\x20month):\x20','totalAmountUSDT','month','totalPayout','ðŸ”\x20Selected\x20trc20\x20wallet:\x20','../types/gateway','groupBy','getPayoutById','deletePayout','usdcPolygonWallet','insensitive','\x20USDT\x20(','round','findFirst','customerUa','telegramUsers','\x20\x20\x20Payout\x20amount:\x20','polygon_usdc','ðŸ’°\x20Shop\x20','\x20USDT\x20(already\x20paid\x20out)','adminNotes','ðŸ“Š\x20Gateway\x20filter\x20applied:','922808ERFMjq','Noda','\x20\x20\x20Full\x20amount:\x20','\x20\x20\x20Gateway:\x20','./telegramBotService','commission','\x20USDT','âš ï¸\x20Gateway\x20\x27','ðŸ“…\x20Period:\x20','test_gateway','ðŸ”\x20[','merchantEarnings','payment','\x20became\x20PAID:','floor','\x20\x20\x20Current\x20balance:\x20','join','\x20\x20\x20ðŸ”\x20Calculated\x20after\x20commission:\x20','\x27\x20->\x20name\x20\x27','\x20USDC\x20to\x20merchant\x20','then','successUrl','CoinToPay2','backupCodes','995trziYX','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','merchantUrl4','set','klyme_de','usdtTrcWallet','ADMIN_2FA_ENABLED=true','updatedAt','../config/config','__esModule','externalPaymentUrl','\x20updated\x20successfully','turnover','filter','noda','MasterCard','getTime','âœ…\x20Customer\x20data\x20updated\x20for\x20payment\x20','Amer','merchantEarningsUSDT','merchantId','âœ…\x20Payout\x20','cointopay2','%\x20from\x20','ðŸ“Š\x20Getting\x20merchant\x20statistics\x20with\x20filters:','startsWith','push','toUpperCase','COMPLETED','getPayoutReports','Deposit','otpauth_url','totalPaidOut','UTC','Interac','activateUser','generateDailyStatistics','InstaXchange','base32','parse','sort','ðŸ“Š\x20Getting\x20payments\x20with\x20filters:','ðŸ’±\x20Currency\x20filter\x20applied:\x20','balance','hash','AdminService','shopUrl2','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','âœ…\x20Balance\x20check\x20passed\x20(with\x20tolerance)','klyme_eu','ACTIVE','hex','\x20merchants\x20with\x20rounded\x20balance\x20!=\x200.00\x20(excluding\x20balances\x20that\x20round\x20to\x200.00)','splice','periodFrom','totalTurnover','Plisio','\x20balance\x20updated:','\x20\x20\x20ðŸ’¸\x20Total\x20payouts\x20(all\x20time):\x20','ðŸ”\x20Using\x20gateway\x20\x27','\x20\x20\x20Total\x20paid\x20out:\x20','usdcErcWallet','\x20status:\x20','730ytXoZz','\x20has\x20zero\x20or\x20null\x20merchant\x20amount,\x20skipping...','_sum','\x20\x20\x20Shop\x20totalPaidOut:\x20','Visa/MasterCard','ðŸ“Š\x20Calculated\x20commission\x20rate\x20for\x20payment\x20','call','ðŸ“…\x20Date\x20from\x20filter:\x20','setHours','KLYME\x20GB','CoinToPay','bcryptjs','config','lastMonth','configurable','../config/database','getDate','qrcode','polygon','ADMIN_2FA_ENABLED=','AmPay\x20TRY','CRYPTO','includes',',\x20chargebacks:\x20','$transaction','username','ADMIN_2FA_SECRET=','get','ðŸ“Š\x20Statistics\x20PAID\x20payments\x20count:\x20','828926GVXGeb','TrapaPay\x20Admin\x20(','aggregate','\x20balance\x20updated:\x20','usdtErcWallet','ðŸ”\x20Shop\x20wallets:','ðŸ”\x202FA\x20disabled\x20for\x20shop:\x20','ðŸ”\x20Selected\x20erc20_usdc\x20wallet:\x20','\x20\x20\x20ï¿½\x20Total\x20paid\x20out:\x20','ðŸ“Š\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','Insufficient\x20balance\x20for\x20amount\x20increase.\x20Available:\x20','getUTCMonth','entries','\x27\x20(from\x20\x27','\x20\x20\x20Tolerance:\x20','getOwnPropertyDescriptor','getMerchantsSelection','update','2FA\x20is\x20already\x20enabled','\x20\x20\x20Current\x20network:\x20','ðŸ”\x20Creating\x20payout\x20with\x20data:','ðŸ’¸\x20CHARGEBACK\x20penalty\x20ONLY:\x20-','count','sk_','updateUser','ðŸ“‹\x20Found\x20','getOwnPropertyNames','min','OnRamp','âš ï¸\x20Payment\x20','trim','hasOwnProperty','ðŸ’°\x20Payment\x20amount\x20is\x20NOT\x20deducted\x20(chargeback\x20penalty\x20only)','getSettingsByGatewayId','yesterday','getShopWallets','fullName','pendingUrl','ðŸ“Š\x20Getting\x20payout\x20reports\x20with\x20filters:','mastercard','toLowerCase','merchantUsername','8QEVBdy','\x20\x20\x20ðŸ’°\x20Total\x20payout:\x20','updatePayout','length','ðŸ“…\x20Payout\x20date\x20to\x20filter:\x20','admin','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','ru-RU','ðŸ”„\x20Gateway\x20mapping\x20(get):','EXPIRED','customerIp','desc','createUser','PENDING','shopId','commissionUSDT','toDataURL','2020-01-01','ðŸ’¸\x20CHARGEBACK:\x20Processing\x20penalty-only\x20deduction','dateTo','setDate','\x20\x20\x20ðŸ‘¤\x20Merchant\x20earnings:\x20','42guVdYw','shopUrl3',',\x20refunds:\x20','\x20\x20\x20Amount\x20decreased\x20by\x20','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','ADMIN_BACKUP_CODES=','\x20-\x20','ðŸ’°\x20Payment\x20','ðŸ’°\x20Updating\x20payout\x20','merchantName','prototype','ðŸ“…\x20Payout\x20date\x20from\x20filter:\x20','split','\x20for\x20shop\x20','toLocaleDateString','2FA\x20token\x20is\x20required','paymentGateways','ðŸ”Œ\x20Gateway:\x20','gatewayEarnings','thisMonth','txid','klyme_gb','erc20_usdc','\x20\x20\x20ðŸ’³\x20Total\x20payments:\x20','network','getAllUsers','resolve','CHARGEBACK','depositBalance','SUSPENDED','custom','wallet','âœ…\x20Payout\x20created:\x20','getGatewayDisplayName','REFUND','convertToUSDT','totalAmount','dateFrom','writable','ðŸ”\x20Admin\x202FA\x20enabled','\x20USDT\x20-\x20will\x20deduct\x20from\x20balance','delete','defineProperty','\x20merchants\x20for\x20selection','default','Current\x20password\x20is\x20incorrect','\x20->\x20','\x20USDT,\x20Requested:\x20','averageCheckUSDT','not\x20set','totalPayments','cwd','currency','getMerchantStatistics','\x20\x20\x20âœ…\x20Total\x20net\x20balances:\x20','week','\x20paid\x20payments\x20for\x20analysis','ADMIN_2FA_ENABLED=false','twoFactorEnabled','2314554CSglun','name','TrapaPay\x20Admin','revenue','Shop\x20not\x20found','ADMIN_PASSWORD_HASH=','today','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','\x20\x20\x20ðŸ–¥ï¸\x20User\x20Agent:\x20','âš ï¸\x20Requested\x20gateway\x20\x27','\x20\x20\x20ï¿½ðŸ“Š\x20Total\x20payments:\x20','gatewayCommissionRate','create','all_time','%\x20commission)','amount','ceil','amountAfterCommissionUSDT','trc20','\x27\x20not\x20found.\x20Available\x20gateways:\x20','Invalid\x202FA\x20token\x20or\x20backup\x20code','turnoverUSDT','paidOutUSDT','getGatewayInternalName','enable2FA','getGatewayNameById','Username\x20already\x20exists','abs','totalCommissionRate','AmPay','âš ï¸\x20CHARGEBACK\x20without\x20penalty\x20amount\x20-\x20no\x20balance\x20change','âœ…\x20Payout\x20created\x20in\x20DB:','\x20\x20\x20Merchant\x20loses:\x20','merchantUrl2','ðŸ“Š\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','not\x20provided','some','totp','createdAt',']\x20Gateway\x20settings\x20before\x20saving:','PAID','ðŸ”\x20Admin\x202FA\x20disabled','status','merchantUrl','ðŸ’°\x20[PAYOUT]\x20Gateway\x20','getUTCDate','writeFileSync',']\x20Gateway\x20settings\x20JSON\x20string:','ðŸ“Š\x20Statistics\x20WHERE\x20conditions:','map','TrapaPay','\x20\x20\x20ï¿½\x20Total\x20payments\x20turnover:\x20','utf8','gateway','ðŸ”\x20No\x20wallet\x20provided,\x20looking\x20up\x20from\x20shop\x20settings...','generateSecret','getPayoutStats','\x20\x20\x20Current\x20amount:\x20','generateBackupCodes','__importDefault','toISOString','gte','SquirrelPay','gatewayOrderId','ðŸ“Š\x20Payout\x20statistics\x20calculated:','forEach','usdtPolygonWallet','localeCompare','ðŸ’°\x20Creating\x20payout\x20for\x20shop\x20','toFixed','readFileSync','telegramId','not\x20specified','\x20USDT,\x20Difference:\x20',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update'];a53_0x2619=function(){return _0x80d804;};return a53_0x2619();}const database_1=__importDefault(require(a53_0xc54d14(0x18d))),bcryptjs_1=__importDefault(require(a53_0xc54d14(0x189))),crypto_1=__importDefault(require('crypto')),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a53_0xc54d14(0xe6))),speakeasy_1=__importDefault(require(a53_0xc54d14(0xc5))),qrcode_1=__importDefault(require(a53_0xc54d14(0x18f))),config_1=require(a53_0xc54d14(0x147)),currencyService_1=require('./currencyService'),telegramBotService_1=require(a53_0xc54d14(0x12b)),gateway_1=require(a53_0xc54d14(0x116));class AdminService{async[a53_0xc54d14(0x72)](){const _0x42e368=a53_0xc54d14;console[_0x42e368(0xa8)]('ðŸ“Š\x20Calculating\x20payout\x20statistics...');const _0x30ce07=await database_1[_0x42e368(0x207)][_0x42e368(0x98)][_0x42e368(0x19d)]({'_sum':{'balance':!![],'totalPaidOut':!![]}}),_0x912583=await database_1['default']['payment'][_0x42e368(0x1b1)]({'where':{'status':_0x42e368(0x23e),'gateway':{'not':'test_gateway'}}}),_0x2af0bb=new Date(),_0x587914=new Date(_0x2af0bb['getFullYear'](),_0x2af0bb['getMonth'](),0x1),_0x539000=new Date(_0x2af0bb[_0x42e368(0xc0)](),_0x2af0bb[_0x42e368(0x106)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x51f49a=await database_1[_0x42e368(0x207)]['payout'][_0x42e368(0x19d)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x587914,'lte':_0x539000},'status':_0x42e368(0x15b)}}),_0x5700f5=_0x30ce07[_0x42e368(0x180)][_0x42e368(0x15f)]||0x0,_0x1431b6=_0x30ce07[_0x42e368(0x180)][_0x42e368(0x16a)]||0x0,_0x3a747e=_0x51f49a[_0x42e368(0x180)]['amount']||0x0,_0x313d75={'totalPayout':Math[_0x42e368(0x11d)](_0x5700f5*0x64)/0x64,'awaitingPayout':Math[_0x42e368(0x11d)](_0x1431b6*0x64)/0x64,'thisMonth':Math[_0x42e368(0x11d)](_0x3a747e*0x64)/0x64,'availableBalance':Math['round'](_0x1431b6*0x64)/0x64,'totalPayments':_0x912583};return console[_0x42e368(0xa8)](_0x42e368(0x7a)),console['log'](_0x42e368(0x1c6)+_0x313d75[_0x42e368(0x114)]+'\x20USDT\x20(total\x20paid\x20to\x20merchants)'),console['log']('\x20\x20\x20â³\x20Awaiting\x20payout:\x20'+_0x313d75[_0x42e368(0x9f)]+_0x42e368(0xdb)),console[_0x42e368(0xa8)](_0x42e368(0xfe)+_0x313d75[_0x42e368(0xc1)]+_0x42e368(0x8f)),console[_0x42e368(0xa8)]('\x20\x20\x20ðŸ“…\x20This\x20month:\x20'+_0x313d75[_0x42e368(0x1ee)]+_0x42e368(0x12d)),console[_0x42e368(0xa8)](_0x42e368(0x1f2)+_0x313d75[_0x42e368(0x20d)]+_0x42e368(0xd7)),_0x313d75;}async['updateCustomerData'](_0x481638,_0x20d7f2){const _0x3e5a2c=a53_0xc54d14;console[_0x3e5a2c(0xa8)](_0x3e5a2c(0xab)+_0x481638+':',_0x20d7f2);const _0x5d5700=await database_1['default'][_0x3e5a2c(0x133)][_0x3e5a2c(0xa9)]({'where':{'id':_0x481638},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x5d5700)throw new Error(_0x3e5a2c(0xf4));const _0x1efc79={};_0x20d7f2[_0x3e5a2c(0x102)]!==undefined&&(_0x1efc79['customerCountry']=_0x20d7f2[_0x3e5a2c(0x102)]||null);_0x20d7f2['customerIp']!==undefined&&(_0x1efc79[_0x3e5a2c(0x1cf)]=_0x20d7f2[_0x3e5a2c(0x1cf)]||null);_0x20d7f2[_0x3e5a2c(0x11f)]!==undefined&&(_0x1efc79['customerUa']=_0x20d7f2[_0x3e5a2c(0x11f)]||null);const _0xb09647=await database_1[_0x3e5a2c(0x207)][_0x3e5a2c(0x133)][_0x3e5a2c(0x1ac)]({'where':{'id':_0x481638},'data':{..._0x1efc79,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x3e5a2c(0xa8)](_0x3e5a2c(0x150)+_0x481638),console[_0x3e5a2c(0xa8)]('\x20\x20\x20ðŸŒ\x20Country:\x20'+_0x5d5700[_0x3e5a2c(0x102)]+_0x3e5a2c(0x209)+_0xb09647[_0x3e5a2c(0x102)]),console[_0x3e5a2c(0xa8)](_0x3e5a2c(0xaa)+_0x5d5700[_0x3e5a2c(0x1cf)]+_0x3e5a2c(0x209)+_0xb09647['customerIp']),console[_0x3e5a2c(0xa8)](_0x3e5a2c(0x21e)+(_0x5d5700[_0x3e5a2c(0x11f)]?_0x3e5a2c(0x142):'not\x20set')+_0x3e5a2c(0x209)+(_0xb09647[_0x3e5a2c(0x11f)]?_0x3e5a2c(0x142):_0x3e5a2c(0x20c))),_0xb09647;}async['getSystemStatistics'](_0x4278e4,_0x32f574){const _0xd8e5aa=a53_0xc54d14,_0x4ee9fd=_0x32f574?new Date(_0x32f574):new Date();let _0x5d0124,_0x463a67;if(_0x4278e4['startsWith'](_0xd8e5aa(0xa6))){const _0x4321a5=_0x4278e4[_0xd8e5aa(0xf1)](_0xd8e5aa(0xa6),'')['split']('_');if(_0x4321a5[_0xd8e5aa(0x1c8)]===0x2){const _0x3e9d4e=new Date(_0x4321a5[0x0]),_0x5c26f8=new Date(_0x4321a5[0x1]);_0x5d0124=new Date(Date['UTC'](_0x3e9d4e[_0xd8e5aa(0xc7)](),_0x3e9d4e[_0xd8e5aa(0x1a6)](),_0x3e9d4e[_0xd8e5aa(0x243)](),0x0,0x0,0x0,0x0)),_0x463a67=new Date(Date[_0xd8e5aa(0x160)](_0x5c26f8['getUTCFullYear'](),_0x5c26f8[_0xd8e5aa(0x1a6)](),_0x5c26f8[_0xd8e5aa(0x243)](),0x17,0x3b,0x3b,0x3e7));}else{const _0x4d69ad=new Date(Date[_0xd8e5aa(0x160)](_0x4ee9fd[_0xd8e5aa(0xc7)](),_0x4ee9fd[_0xd8e5aa(0x1a6)](),_0x4ee9fd[_0xd8e5aa(0x243)]()-0x1e));_0x5d0124=new Date(Date[_0xd8e5aa(0x160)](_0x4d69ad[_0xd8e5aa(0xc7)](),_0x4d69ad[_0xd8e5aa(0x1a6)](),_0x4d69ad[_0xd8e5aa(0x243)](),0x0,0x0,0x0,0x0)),_0x463a67=new Date(Date[_0xd8e5aa(0x160)](_0x4ee9fd[_0xd8e5aa(0xc7)](),_0x4ee9fd[_0xd8e5aa(0x1a6)](),_0x4ee9fd[_0xd8e5aa(0x243)](),0x17,0x3b,0x3b,0x3e7));}}else{switch(_0x4278e4[_0xd8e5aa(0x1c3)]()){case _0xd8e5aa(0x21c):_0x5d0124=new Date(Date[_0xd8e5aa(0x160)](_0x4ee9fd[_0xd8e5aa(0xc7)](),_0x4ee9fd[_0xd8e5aa(0x1a6)](),_0x4ee9fd[_0xd8e5aa(0x243)](),0x0,0x0,0x0,0x0)),_0x463a67=new Date(Date[_0xd8e5aa(0x160)](_0x4ee9fd[_0xd8e5aa(0xc7)](),_0x4ee9fd[_0xd8e5aa(0x1a6)](),_0x4ee9fd['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case _0xd8e5aa(0x1bd):const _0x1744e6=new Date(_0x4ee9fd);_0x1744e6[_0xd8e5aa(0x99)](_0x1744e6[_0xd8e5aa(0x243)]()-0x1),_0x5d0124=new Date(Date[_0xd8e5aa(0x160)](_0x1744e6['getUTCFullYear'](),_0x1744e6[_0xd8e5aa(0x1a6)](),_0x1744e6[_0xd8e5aa(0x243)](),0x0,0x0,0x0,0x0)),_0x463a67=new Date(Date[_0xd8e5aa(0x160)](_0x1744e6[_0xd8e5aa(0xc7)](),_0x1744e6[_0xd8e5aa(0x1a6)](),_0x1744e6[_0xd8e5aa(0x243)](),0x17,0x3b,0x3b,0x3e7));break;case'this_week':const _0x20fc75=_0x4ee9fd[_0xd8e5aa(0xfd)](),_0x45fea5=_0x20fc75===0x0?-0x6:0x1-_0x20fc75,_0x2f4ea3=_0x4ee9fd[_0xd8e5aa(0x243)]()+_0x45fea5;_0x5d0124=new Date(Date['UTC'](_0x4ee9fd[_0xd8e5aa(0xc7)](),_0x4ee9fd['getUTCMonth'](),_0x2f4ea3,0x0,0x0,0x0,0x0)),_0x463a67=new Date(Date['UTC'](_0x4ee9fd[_0xd8e5aa(0xc7)](),_0x4ee9fd[_0xd8e5aa(0x1a6)](),_0x4ee9fd[_0xd8e5aa(0x243)](),0x17,0x3b,0x3b,0x3e7));break;case _0xd8e5aa(0xe3):const _0x2d3236=new Date(Date[_0xd8e5aa(0x160)](_0x4ee9fd[_0xd8e5aa(0xc7)](),_0x4ee9fd[_0xd8e5aa(0x1a6)](),_0x4ee9fd[_0xd8e5aa(0x243)]()-0x7)),_0x301205=_0x2d3236[_0xd8e5aa(0xfd)](),_0x4e1d2c=_0x301205===0x0?-0x6:0x1-_0x301205,_0x3bced2=_0x2d3236['getUTCDate']()+_0x4e1d2c;_0x5d0124=new Date(Date[_0xd8e5aa(0x160)](_0x2d3236[_0xd8e5aa(0xc7)](),_0x2d3236['getUTCMonth'](),_0x3bced2,0x0,0x0,0x0,0x0)),_0x463a67=new Date(Date[_0xd8e5aa(0x160)](_0x2d3236[_0xd8e5aa(0xc7)](),_0x2d3236['getUTCMonth'](),_0x3bced2+0x6,0x17,0x3b,0x3b,0x3e7));break;case _0xd8e5aa(0x8b):_0x5d0124=new Date(Date[_0xd8e5aa(0x160)](_0x4ee9fd[_0xd8e5aa(0xc7)](),_0x4ee9fd[_0xd8e5aa(0x1a6)](),0x1,0x0,0x0,0x0,0x0)),_0x463a67=new Date(Date[_0xd8e5aa(0x160)](_0x4ee9fd['getUTCFullYear'](),_0x4ee9fd[_0xd8e5aa(0x1a6)](),_0x4ee9fd['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case'last_month':_0x5d0124=new Date(Date['UTC'](_0x4ee9fd[_0xd8e5aa(0xc7)](),_0x4ee9fd['getUTCMonth']()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x463a67=new Date(Date['UTC'](_0x4ee9fd[_0xd8e5aa(0xc7)](),_0x4ee9fd[_0xd8e5aa(0x1a6)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case _0xd8e5aa(0x223):_0x5d0124=new Date(Date['UTC'](0x7e9,0x5,0xe,0x0,0x0,0x0,0x0)),_0x463a67=new Date(Date['UTC'](_0x4ee9fd[_0xd8e5aa(0xc7)](),_0x4ee9fd[_0xd8e5aa(0x1a6)](),_0x4ee9fd[_0xd8e5aa(0x243)](),0x17,0x3b,0x3b,0x3e7));break;default:_0x5d0124=new Date(_0x4ee9fd[_0xd8e5aa(0x14f)]()-0x1e*0x18*0x3c*0x3c*0x3e8);const _0x30e174=new Date(Date[_0xd8e5aa(0x160)](_0x4ee9fd[_0xd8e5aa(0xc7)](),_0x4ee9fd[_0xd8e5aa(0x1a6)](),_0x4ee9fd[_0xd8e5aa(0x243)]()-0x1e));_0x5d0124=new Date(Date[_0xd8e5aa(0x160)](_0x30e174[_0xd8e5aa(0xc7)](),_0x30e174[_0xd8e5aa(0x1a6)](),_0x30e174[_0xd8e5aa(0x243)](),0x0,0x0,0x0,0x0)),_0x463a67=new Date(Date[_0xd8e5aa(0x160)](_0x4ee9fd[_0xd8e5aa(0xc7)](),_0x4ee9fd[_0xd8e5aa(0x1a6)](),_0x4ee9fd[_0xd8e5aa(0x243)](),0x17,0x3b,0x3b,0x3e7));}const _0x5d008a={'gte':_0x5d0124,'lte':_0x463a67};console['log'](_0xd8e5aa(0xb4)+_0x5d0124['toISOString']()+_0xd8e5aa(0xa1)+_0x463a67[_0xd8e5aa(0x76)]());const [_0x38ead4,_0x30f735,_0x4489b2,_0x27397a,_0x474493,_0x448f19,_0x555581,_0x124024,_0x9e008c]=await Promise[_0xd8e5aa(0xb6)]([database_1[_0xd8e5aa(0x207)][_0xd8e5aa(0x98)][_0xd8e5aa(0x1b1)](),database_1[_0xd8e5aa(0x207)][_0xd8e5aa(0x98)][_0xd8e5aa(0x1b1)]({'where':{'status':_0xd8e5aa(0x171)}}),database_1['default'][_0xd8e5aa(0x133)][_0xd8e5aa(0x1b1)]({'where':{'status':'PAID','createdAt':_0x5d008a,'gateway':{'not':_0xd8e5aa(0x130)}}}),database_1['default'][_0xd8e5aa(0x133)][_0xd8e5aa(0x1b1)]({'where':{'status':_0xd8e5aa(0x1f6),'createdAt':_0x5d008a,'gateway':{'not':'test_gateway'}}}),database_1['default'][_0xd8e5aa(0x133)][_0xd8e5aa(0x1b1)]({'where':{'status':_0xd8e5aa(0x1fd),'createdAt':_0x5d008a,'gateway':{'not':'test_gateway'}}}),database_1[_0xd8e5aa(0x207)]['payment'][_0xd8e5aa(0x10e)]({'where':{'status':_0xd8e5aa(0x23e),'createdAt':_0x5d008a,'gateway':{'not':_0xd8e5aa(0x130)}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gateway':!![]}}),database_1[_0xd8e5aa(0x207)][_0xd8e5aa(0x133)]['findMany']({'where':{'gateway':{'not':_0xd8e5aa(0x130)}},'take':0xa,'orderBy':{'createdAt':_0xd8e5aa(0x1d0)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0xd8e5aa(0x207)][_0xd8e5aa(0x133)][_0xd8e5aa(0x10e)]({'where':{'createdAt':_0x5d008a,'gateway':{'not':_0xd8e5aa(0x130)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0xd8e5aa(0x207)]['payment']['findMany']({'where':{'status':_0xd8e5aa(0x23e),'gateway':{'not':'test_gateway'}},'select':{'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gateway':!![]}})]);console[_0xd8e5aa(0xa8)](_0xd8e5aa(0x19a)+_0x4489b2);let _0x102d18=0x0,_0x2ec59d=0x0;for(const _0x42dc97 of _0x448f19){const _0x2314b9=_0x42dc97[_0xd8e5aa(0x93)]||0x0;_0x102d18+=_0x2314b9;if(_0x42dc97[_0xd8e5aa(0x97)]&&_0x42dc97[_0xd8e5aa(0x93)]){const _0x3d2dc1=_0x42dc97[_0xd8e5aa(0x93)]-_0x42dc97[_0xd8e5aa(0x97)];_0x2ec59d+=_0x3d2dc1;}}const {gatewaySettingsService:_0x10cc47}=await Promise[_0xd8e5aa(0x1f5)]()['then'](()=>__importStar(require('./gatewaySettingsService'))),{getGatewayIdByName:_0x299af7}=await Promise[_0xd8e5aa(0x1f5)]()[_0xd8e5aa(0x13b)](()=>__importStar(require('../types/gateway')));let _0x322211=0x0;for(const _0x4e5171 of _0x448f19){const _0x4b27dd=_0x299af7(_0x4e5171['gateway']);if(_0x4b27dd){const _0x17a4b2=_0x10cc47['getSettingsByGatewayId'](_0x4b27dd),_0x5b224c=_0x17a4b2?.['gatewayCommission']||0x0,_0x575cfe=_0x4e5171['amountUSDT']||0x0,_0x3781bf=_0x575cfe*(_0x5b224c/0x64);_0x322211+=_0x3781bf;}}_0x2ec59d-=_0x322211;let _0x1b326c=0x0,_0x56ede6=0x0;for(const _0x155293 of _0x9e008c){if(_0x155293[_0xd8e5aa(0x97)]&&_0x155293[_0xd8e5aa(0x93)]){const _0x100bdc=_0x155293['amountUSDT']-_0x155293[_0xd8e5aa(0x97)];_0x1b326c+=_0x100bdc;}const _0x34bc23=_0x299af7(_0x155293[_0xd8e5aa(0x6f)]);if(_0x34bc23){const _0x596bea=_0x10cc47[_0xd8e5aa(0x1bc)](_0x34bc23),_0x21499c=_0x596bea?.['gatewayCommission']||0x0,_0x1d8d48=_0x155293[_0xd8e5aa(0x93)]||0x0,_0x7f6dbe=_0x1d8d48*(_0x21499c/0x64);_0x56ede6+=_0x7f6dbe;}}_0x1b326c-=_0x56ede6;const _0x3d7cbb=_0x4489b2>0x0?_0x102d18/_0x4489b2:0x0,_0x567b47=this['generateDailyStatistics'](_0x124024,_0x5d0124,_0x463a67),_0x21315f=await database_1[_0xd8e5aa(0x207)]['payment'][_0xd8e5aa(0x1b1)]({'where':{'createdAt':_0x5d008a,'gateway':{'not':_0xd8e5aa(0x130)},'status':{'notIn':[_0xd8e5aa(0x1d2),_0xd8e5aa(0x1ce)]}}}),_0x33baa3=_0x21315f>0x0?_0x4489b2/_0x21315f*0x64:0x0;return{'totalShops':_0x38ead4,'activeShops':_0x30f735,'totalPayments':_0x21315f,'successfulPayments':_0x4489b2,'totalAttempts':_0x21315f,'chargebacks':_0x27397a,'refunds':_0x474493,'totalRevenue':Math['round'](_0x102d18*0x64)/0x64,'trapayEarnings':Math[_0xd8e5aa(0x11d)](_0x2ec59d*0x64)/0x64,'trapayEarningsAllTime':Math[_0xd8e5aa(0x11d)](_0x1b326c*0x64)/0x64,'averagePaymentAmount':Math['round'](_0x3d7cbb*0x64)/0x64,'conversionRate':Math[_0xd8e5aa(0x11d)](_0x33baa3*0x64)/0x64,'dailyRevenue':_0x567b47['dailyRevenue'],'dailyPayments':_0x567b47['dailyPayments'],'recentPayments':_0x555581[_0xd8e5aa(0x6b)](_0x314481=>({'id':_0x314481['id'],'amount':_0x314481[_0xd8e5aa(0x225)],'currency':_0x314481['currency'],'status':_0x314481[_0xd8e5aa(0x240)],'gateway':_0x314481[_0xd8e5aa(0x6f)],'shop':_0x314481[_0xd8e5aa(0x98)],'createdAt':_0x314481[_0xd8e5aa(0x23c)]}))};}}async[a53_0xc54d14(0x210)](_0x980a7c){const _0x115a55=a53_0xc54d14;console[_0x115a55(0xa8)](_0x115a55(0x157),_0x980a7c);let _0x327430,_0x224003=new Date();if(_0x980a7c[_0x115a55(0x8a)]===_0x115a55(0x1f9)&&_0x980a7c[_0x115a55(0x200)]&&_0x980a7c['dateTo']){const _0x1239a2=new Date(_0x980a7c[_0x115a55(0x200)]),_0x25b39a=new Date(_0x980a7c[_0x115a55(0x1d8)]);_0x327430=new Date(Date[_0x115a55(0x160)](_0x1239a2[_0x115a55(0xc7)](),_0x1239a2[_0x115a55(0x1a6)](),_0x1239a2[_0x115a55(0x243)](),0x0,0x0,0x0,0x0)),_0x224003=new Date(Date[_0x115a55(0x160)](_0x25b39a[_0x115a55(0xc7)](),_0x25b39a[_0x115a55(0x1a6)](),_0x25b39a['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}else{const _0x4527c3=new Date();switch(_0x980a7c['period']){case _0x115a55(0x212):_0x327430=new Date(_0x4527c3['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8),_0x327430[_0x115a55(0x186)](0x0,0x0,0x0,0x0),_0x224003[_0x115a55(0x186)](0x17,0x3b,0x3b,0x3e7);break;case _0x115a55(0x113):_0x327430=new Date(Date[_0x115a55(0x160)](_0x4527c3[_0x115a55(0xc7)](),_0x4527c3[_0x115a55(0x1a6)](),0x1,0x0,0x0,0x0,0x0)),_0x224003=new Date(Date['UTC'](_0x4527c3[_0x115a55(0xc7)](),_0x4527c3['getUTCMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x115a55(0x18b):_0x327430=new Date(Date[_0x115a55(0x160)](_0x4527c3[_0x115a55(0xc7)](),_0x4527c3[_0x115a55(0x1a6)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x224003=new Date(Date['UTC'](_0x4527c3[_0x115a55(0xc7)](),_0x4527c3[_0x115a55(0x1a6)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case'year':_0x327430=new Date(_0x4527c3[_0x115a55(0x14f)]()-0x16d*0x18*0x3c*0x3c*0x3e8),_0x327430['setHours'](0x0,0x0,0x0,0x0),_0x224003[_0x115a55(0x186)](0x17,0x3b,0x3b,0x3e7);break;case _0x115a55(0xb6):default:_0x327430=new Date(_0x115a55(0x1d6)),_0x327430[_0x115a55(0x186)](0x0,0x0,0x0,0x0),_0x224003[_0x115a55(0x186)](0x17,0x3b,0x3b,0x3e7);break;}}console[_0x115a55(0xa8)]('ðŸ“…\x20Period:\x20'+_0x327430[_0x115a55(0x76)]()+_0x115a55(0xa1)+_0x224003[_0x115a55(0x76)]());const _0x261b76={'status':_0x115a55(0x23e),'gateway':{'not':_0x115a55(0x130)},'createdAt':{'gte':_0x327430,'lte':_0x224003}};_0x980a7c['shopId']&&(_0x261b76['shopId']=_0x980a7c[_0x115a55(0x1d3)]);const _0xc04113=await database_1[_0x115a55(0x207)][_0x115a55(0x133)][_0x115a55(0x10e)]({'where':_0x261b76,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x115a55(0xa8)](_0x115a55(0xec)+_0xc04113[_0x115a55(0x1c8)]+_0x115a55(0x213));const _0x27f303={'gateway':{'not':'test_gateway'},'status':{'notIn':[_0x115a55(0x1d2),'EXPIRED']},'createdAt':{'gte':_0x327430,'lte':_0x224003}};_0x980a7c[_0x115a55(0x1d3)]&&(_0x27f303['shopId']=_0x980a7c[_0x115a55(0x1d3)]);const _0x36dc89=await database_1['default']['payment'][_0x115a55(0x1b1)]({'where':_0x27f303}),_0x10e4e7={..._0x27f303,'status':_0x115a55(0x1f6)},_0x16236d={..._0x27f303,'status':'REFUND'},[_0x5d09a6,_0x2ff9a7]=await Promise['all']([database_1[_0x115a55(0x207)][_0x115a55(0x133)][_0x115a55(0x1b1)]({'where':_0x10e4e7}),database_1['default']['payment'][_0x115a55(0x1b1)]({'where':_0x16236d})]);console['log']('ðŸ“Š\x20Total\x20payments\x20(including\x20failed):\x20'+_0x36dc89+_0x115a55(0xef)+_0xc04113[_0x115a55(0x1c8)]+_0x115a55(0x195)+_0x5d09a6+_0x115a55(0x1dd)+_0x2ff9a7);let _0x394938=0x0,_0x239f8d=0x0,_0x167615=0x0;const _0x3e6f04={},_0x2b3eb4={},_0x42f61d={},_0x3f21aa=new Date(_0x327430);while(_0x3f21aa<=_0x224003){const _0x148010=_0x3f21aa[_0x115a55(0x76)]()[_0x115a55(0x1e7)]('T')[0x0];_0x42f61d[_0x148010]={'date':_0x148010,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0},_0x3f21aa[_0x115a55(0x99)](_0x3f21aa[_0x115a55(0x243)]()+0x1);}for(const _0x21964e of _0xc04113){try{const _0xf3f41b=_0x21964e[_0x115a55(0x93)]||0x0;if(_0xf3f41b<=0x0){console[_0x115a55(0xb9)](_0x115a55(0x1b8)+_0x21964e['id']+_0x115a55(0xbc));continue;}let _0x3da941,_0x347eb4;if(_0x21964e[_0x115a55(0x97)]!==null&&_0x21964e[_0x115a55(0x97)]!==undefined)_0x3da941=_0x21964e[_0x115a55(0x97)],_0x347eb4=_0xf3f41b-_0x3da941,console['log']('ðŸ“Š\x20Using\x20saved\x20values\x20for\x20payment\x20'+_0x21964e['id']+':\x20'+_0xf3f41b[_0x115a55(0x7f)](0x6)+'\x20USDT,\x20merchant:\x20'+_0x3da941[_0x115a55(0x7f)](0x6)+_0x115a55(0x12d));else{let _0x37207c={};if(_0x21964e[_0x115a55(0x98)]['gatewaySettings'])try{_0x37207c=JSON[_0x115a55(0x166)](_0x21964e[_0x115a55(0x98)][_0x115a55(0xfa)]);}catch(_0x2d0a10){console[_0x115a55(0xf0)]('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x21964e['shopId']+':',_0x2d0a10);}let _0x5316fe=0x2d;for(const [_0x5112e1,_0x17f48c]of Object[_0x115a55(0x1a7)](_0x37207c)){if(_0x5112e1[_0x115a55(0x1c3)]()===_0x21964e['gateway'][_0x115a55(0x1c3)]()){_0x5316fe=_0x17f48c[_0x115a55(0x12c)]||0x2d;break;}}_0x347eb4=_0xf3f41b*(_0x5316fe/0x64),_0x3da941=_0xf3f41b-_0x347eb4,console[_0x115a55(0xa8)](_0x115a55(0x1a4)+_0x21964e['id']+':\x20'+_0x5316fe+_0x115a55(0x156)+_0xf3f41b[_0x115a55(0x7f)](0x6)+_0x115a55(0x12d));}_0x394938+=_0xf3f41b,_0x239f8d+=_0x3da941,_0x167615+=_0x347eb4;let _0x36a3da;_0x21964e[_0x115a55(0x221)]!==null&&_0x21964e[_0x115a55(0x221)]!==undefined?(_0x36a3da=_0x21964e[_0x115a55(0x221)],console[_0x115a55(0xa8)]('ðŸ“Š\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20'+_0x21964e['id']+':\x20'+_0x36a3da+'%')):(_0x36a3da=_0xf3f41b>0x0?_0x347eb4/_0xf3f41b*0x64:0x0,console[_0x115a55(0xa8)](_0x115a55(0x183)+_0x21964e['id']+':\x20'+_0x36a3da[_0x115a55(0x7f)](0x2)+'%'));!_0x3e6f04[_0x21964e[_0x115a55(0x6f)]]&&(_0x3e6f04[_0x21964e[_0x115a55(0x6f)]]={'gateway':_0x21964e[_0x115a55(0x6f)],'gatewayDisplayName':this[_0x115a55(0x1fc)](_0x21964e[_0x115a55(0x6f)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x3e6f04[_0x21964e['gateway']][_0x115a55(0xad)]++,_0x3e6f04[_0x21964e['gateway']][_0x115a55(0x22b)]+=_0xf3f41b,_0x3e6f04[_0x21964e[_0x115a55(0x6f)]][_0x115a55(0x1d4)]+=_0x347eb4,_0x3e6f04[_0x21964e[_0x115a55(0x6f)]][_0x115a55(0x152)]+=_0x3da941,_0x3e6f04[_0x21964e[_0x115a55(0x6f)]][_0x115a55(0x232)]+=_0x36a3da;!_0x980a7c[_0x115a55(0x1d3)]&&(!_0x2b3eb4[_0x21964e['shopId']]&&(_0x2b3eb4[_0x21964e[_0x115a55(0x1d3)]]={'shopId':_0x21964e[_0x115a55(0x1d3)],'shopName':_0x21964e['shop'][_0x115a55(0x217)],'shopUsername':_0x21964e[_0x115a55(0x98)]['username'],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x2b3eb4[_0x21964e['shopId']][_0x115a55(0xad)]++,_0x2b3eb4[_0x21964e['shopId']][_0x115a55(0x22b)]+=_0xf3f41b,_0x2b3eb4[_0x21964e[_0x115a55(0x1d3)]][_0x115a55(0x1d4)]+=_0x347eb4,_0x2b3eb4[_0x21964e[_0x115a55(0x1d3)]][_0x115a55(0x152)]+=_0x3da941);const _0x1c5a6c=_0x21964e['paidAt'][_0x115a55(0x76)]()[_0x115a55(0x1e7)]('T')[0x0];_0x42f61d[_0x1c5a6c]&&(_0x42f61d[_0x1c5a6c][_0x115a55(0x14b)]+=_0xf3f41b,_0x42f61d[_0x1c5a6c]['merchantEarnings']+=_0x3da941,_0x42f61d[_0x1c5a6c][_0x115a55(0x1ed)]+=_0x347eb4,_0x42f61d[_0x1c5a6c][_0x115a55(0xad)]++);}catch(_0x414446){console[_0x115a55(0xf0)](_0x115a55(0x8e)+_0x21964e['id']+':',_0x414446);}}Object[_0x115a55(0xb7)](_0x3e6f04)[_0x115a55(0x7b)](_0x19dc87=>{const _0x4d27b6=_0x115a55;_0x19dc87[_0x4d27b6(0x10d)]=_0x19dc87[_0x4d27b6(0xad)]>0x0?_0x19dc87[_0x4d27b6(0x232)]/_0x19dc87[_0x4d27b6(0xad)]:0x0,delete _0x19dc87[_0x4d27b6(0x232)];}),Object[_0x115a55(0xb7)](_0x2b3eb4)[_0x115a55(0x7b)](_0x155abf=>{const _0x59f865=_0x115a55;_0x155abf['averageCheckUSDT']=_0x155abf[_0x59f865(0xad)]>0x0?_0x155abf[_0x59f865(0x22b)]/_0x155abf[_0x59f865(0xad)]:0x0;});let _0x5cb981=0x0,_0x6b0c3a=0x0;if(_0x980a7c[_0x115a55(0x1d3)]){const _0x232a19=await database_1[_0x115a55(0x207)]['payout'][_0x115a55(0x10e)]({'where':{'shopId':_0x980a7c[_0x115a55(0x1d3)],'status':_0x115a55(0x15b),'createdAt':{'gte':_0x327430,'lte':_0x224003}},'select':{'amount':!![]}});_0x5cb981=_0x232a19[_0x115a55(0x9d)]((_0x14a035,_0x8acac7)=>_0x14a035+_0x8acac7[_0x115a55(0x225)],0x0);const _0x49367b=await database_1[_0x115a55(0x207)]['payout'][_0x115a55(0x10e)]({'where':{'shopId':_0x980a7c[_0x115a55(0x1d3)],'status':_0x115a55(0x1d2),'createdAt':{'gte':_0x327430,'lte':_0x224003}},'select':{'amount':!![]}});_0x6b0c3a=_0x49367b[_0x115a55(0x9d)]((_0x29effa,_0x41e90f)=>_0x29effa+_0x41e90f[_0x115a55(0x225)],0x0);}const _0x4f1061=_0x36dc89,_0x1cd351=_0xc04113[_0x115a55(0x1c8)],_0x2fe45b=_0x1cd351>0x0?_0x394938/_0x1cd351:0x0,_0x199296=_0x4f1061>0x0?Math['round'](_0x1cd351/_0x4f1061*0x2710)/0x64:0x0,_0x28dc83=Math[_0x115a55(0x226)]((_0x224003[_0x115a55(0x14f)]()-_0x327430['getTime']())/(0x3e8*0x3c*0x3c*0x18)),_0x483860={'totalTurnover':Math['round'](_0x394938*0x64)/0x64,'merchantEarnings':Math[_0x115a55(0x11d)](_0x239f8d*0x64)/0x64,'gatewayEarnings':Math['round'](_0x167615*0x64)/0x64,'totalPaidOut':Math[_0x115a55(0x11d)](_0x5cb981*0x64)/0x64,'pendingPayout':Math[_0x115a55(0x11d)](_0x6b0c3a*0x64)/0x64,'averageCheck':Math[_0x115a55(0x11d)](_0x2fe45b*0x64)/0x64,'totalPayments':_0x4f1061,'successfulPayments':_0x1cd351,'conversionRate':_0x199296,'chargebacks':_0x5d09a6,'refunds':_0x2ff9a7,'gatewayBreakdown':Object[_0x115a55(0xb7)](_0x3e6f04)[_0x115a55(0x6b)](_0x17adb4=>({..._0x17adb4,'turnoverUSDT':Math[_0x115a55(0x11d)](_0x17adb4[_0x115a55(0x22b)]*0x64)/0x64,'commissionUSDT':Math[_0x115a55(0x11d)](_0x17adb4[_0x115a55(0x1d4)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x17adb4[_0x115a55(0x152)]*0x64)/0x64,'averageCommissionRate':Math[_0x115a55(0x11d)](_0x17adb4['averageCommissionRate']*0x64)/0x64})),'merchantBreakdown':_0x980a7c[_0x115a55(0x1d3)]?undefined:Object['values'](_0x2b3eb4)[_0x115a55(0x6b)](_0x672513=>({..._0x672513,'turnoverUSDT':Math[_0x115a55(0x11d)](_0x672513[_0x115a55(0x22b)]*0x64)/0x64,'commissionUSDT':Math[_0x115a55(0x11d)](_0x672513[_0x115a55(0x1d4)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x672513[_0x115a55(0x152)]*0x64)/0x64,'paidOutUSDT':Math[_0x115a55(0x11d)](_0x672513[_0x115a55(0x22c)]*0x64)/0x64,'averageCheckUSDT':Math[_0x115a55(0x11d)](_0x672513[_0x115a55(0x20b)]*0x64)/0x64})),'dailyData':Object[_0x115a55(0xb7)](_0x42f61d)[_0x115a55(0x6b)](_0x4a52d2=>({..._0x4a52d2,'turnover':Math[_0x115a55(0x11d)](_0x4a52d2['turnover']*0x64)/0x64,'merchantEarnings':Math[_0x115a55(0x11d)](_0x4a52d2[_0x115a55(0x132)]*0x64)/0x64,'gatewayEarnings':Math[_0x115a55(0x11d)](_0x4a52d2['gatewayEarnings']*0x64)/0x64}))[_0x115a55(0x167)]((_0x50e9fd,_0x463762)=>_0x50e9fd['date'][_0x115a55(0x7d)](_0x463762['date'])),'periodInfo':{'from':_0x327430,'to':_0x224003,'periodType':_0x980a7c['period']||_0x115a55(0x1f9),'daysCount':_0x28dc83}};return console['log']('ðŸ“Š\x20Merchant\x20statistics\x20calculated:'),console[_0x115a55(0xa8)]('\x20\x20\x20ðŸ’°\x20Total\x20turnover:\x20'+_0x483860[_0x115a55(0x176)]+_0x115a55(0x12d)),console[_0x115a55(0xa8)](_0x115a55(0x1da)+_0x483860[_0x115a55(0x132)]+_0x115a55(0x12d)),console[_0x115a55(0xa8)](_0x115a55(0xc4)+_0x483860[_0x115a55(0x1ed)]+_0x115a55(0x12d)),console[_0x115a55(0xa8)](_0x115a55(0x1a3)+_0x483860[_0x115a55(0x15f)]+_0x115a55(0x12d)),console['log']('\x20\x20\x20â³\x20Pending\x20payout:\x20'+_0x483860['pendingPayout']+'\x20USDT'),console[_0x115a55(0xa8)](_0x115a55(0x220)+_0x483860[_0x115a55(0x20d)]),_0x483860;}async[a53_0xc54d14(0x1ab)](_0x20fa5b){const _0x179d89=a53_0xc54d14;console[_0x179d89(0xa8)]('ðŸ“‹\x20Getting\x20merchants\x20selection\x20list...',{'hasPayoutHistory':_0x20fa5b});let _0x21bdac={};_0x20fa5b&&(_0x21bdac['payouts']={'some':{}});const _0x10c0dc=await database_1['default']['shop'][_0x179d89(0x10e)]({'where':_0x21bdac,'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':'asc'}});return console[_0x179d89(0xa8)](_0x179d89(0x1b4)+_0x10c0dc[_0x179d89(0x1c8)]+_0x179d89(0x206)+(_0x20fa5b?_0x179d89(0xe9):'')),_0x10c0dc[_0x179d89(0x6b)](_0x22a40b=>({'id':_0x22a40b['id'],'username':_0x22a40b['username'],'name':_0x22a40b['name']}));}[a53_0xc54d14(0x1fc)](_0x229ef3){const _0x3f95f0=a53_0xc54d14,_0x220ab7={'test_gateway':'Test\x20Gateway','plisio':_0x3f95f0(0x177),'rapyd':_0x3f95f0(0x9e),'noda':_0x3f95f0(0x128),'cointopay':_0x3f95f0(0x188),'cointopay2':_0x3f95f0(0x13d),'klyme_eu':'KLYME\x20EU','klyme_gb':_0x3f95f0(0x187),'klyme_de':'KLYME\x20DE','mastercard':_0x3f95f0(0x14e),'visa/mastercard':_0x3f95f0(0x182),'amer':_0x3f95f0(0x151),'myxspend':_0x3f95f0(0xe4),'ampay':_0x3f95f0(0x233),'ampay_try':_0x3f95f0(0x192),'sepa':_0x3f95f0(0xfc),'interac':_0x3f95f0(0x161),'onramp':_0x3f95f0(0x1b7),'squirrelpay':_0x3f95f0(0x78),'maxpara':'MaxPara','instaxchange':_0x3f95f0(0x164),'oxapay':'OxaPay'};return _0x220ab7[_0x229ef3]||_0x229ef3;}[a53_0xc54d14(0x22d)](_0x32e335){const _0x10be94=a53_0xc54d14,_0x25e276={'Test\x20Gateway':_0x10be94(0x130),'Plisio':'plisio','Rapyd':_0x10be94(0x92),'Noda':_0x10be94(0x14d),'CoinToPay':'cointopay','CoinToPay2':_0x10be94(0x155),'KLYME\x20EU':_0x10be94(0x170),'KLYME\x20GB':_0x10be94(0x1f0),'KLYME\x20DE':_0x10be94(0x143),'MasterCard':_0x10be94(0x1c2)};return _0x25e276[_0x32e335]||_0x32e335[_0x10be94(0x1c3)]();}async[a53_0xc54d14(0xcc)](_0x15641f){const _0x1f9cc5=a53_0xc54d14,{page:_0x193741,limit:_0x3eb0e1,minAmount:_0x264a10,search:_0x5e6f48}=_0x15641f;console[_0x1f9cc5(0xa8)](_0x1f9cc5(0x238),_0x15641f);let _0x119afd={};_0x5e6f48&&(_0x119afd[_0x1f9cc5(0x217)]={'contains':_0x5e6f48,'mode':_0x1f9cc5(0x11b)});const _0x40ba24=await database_1[_0x1f9cc5(0x207)][_0x1f9cc5(0x98)][_0x1f9cc5(0x10e)]({'where':_0x119afd,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),_0x41a427=_0x40ba24[_0x1f9cc5(0x14c)](_0x4dc438=>{const _0x20e7ac=Math['floor'](_0x4dc438['balance']*0x64)/0x64;if(_0x264a10&&_0x20e7ac<_0x264a10)return![];return _0x20e7ac!==0x0;});_0x41a427['sort']((_0x3639a7,_0xa98388)=>_0xa98388[_0x1f9cc5(0x16a)]-_0x3639a7['balance']);const _0xf08d44=_0x41a427[_0x1f9cc5(0x1c8)],_0x31c71a=(_0x193741-0x1)*_0x3eb0e1,_0x45d8c6=_0x41a427['slice'](_0x31c71a,_0x31c71a+_0x3eb0e1);console[_0x1f9cc5(0xa8)](_0x1f9cc5(0xec)+_0x45d8c6['length']+_0x1f9cc5(0x173));const _0x20c77d=await Promise[_0x1f9cc5(0xb6)](_0x45d8c6[_0x1f9cc5(0x6b)](async _0x376639=>{const _0x5d6362=_0x1f9cc5,[_0x1ddcd4,_0x49ac8f,_0x3a9874]=await Promise['all']([database_1[_0x5d6362(0x207)][_0x5d6362(0x133)][_0x5d6362(0x1b1)]({'where':{'shopId':_0x376639['id'],'status':_0x5d6362(0x23e),'gateway':{'not':'test_gateway'}}}),database_1[_0x5d6362(0x207)][_0x5d6362(0x133)][_0x5d6362(0x11e)]({'where':{'shopId':_0x376639['id'],'status':'PAID','gateway':{'not':_0x5d6362(0x130)}},'orderBy':{'paidAt':_0x5d6362(0x89)},'select':{'paidAt':!![]}}),database_1[_0x5d6362(0x207)][_0x5d6362(0x133)][_0x5d6362(0x117)]({'by':[_0x5d6362(0x6f)],'where':{'shopId':_0x376639['id'],'status':_0x5d6362(0x23e),'gateway':{'not':_0x5d6362(0x130)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x42462d=new Date(),_0x492fc6=new Date(_0x42462d[_0x5d6362(0xc0)](),_0x42462d[_0x5d6362(0x106)](),0x1),_0x4c2c7a=new Date(_0x42462d[_0x5d6362(0xc0)](),_0x42462d[_0x5d6362(0x106)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0xdd6da9,_0x587be4]=await Promise[_0x5d6362(0xb6)]([database_1['default'][_0x5d6362(0x104)][_0x5d6362(0x19d)]({'_sum':{'amount':!![]},'where':{'shopId':_0x376639['id'],'status':_0x5d6362(0x15b)}}),database_1['default'][_0x5d6362(0x104)][_0x5d6362(0x19d)]({'_sum':{'amount':!![]},'where':{'shopId':_0x376639['id'],'status':_0x5d6362(0x15b),'createdAt':{'gte':_0x492fc6,'lte':_0x4c2c7a}}})]),_0x35c6e4=_0xdd6da9[_0x5d6362(0x180)][_0x5d6362(0x225)]||0x0,_0x51a22a=_0x587be4['_sum']['amount']||0x0,_0x54755d=await Promise[_0x5d6362(0xb6)](_0x3a9874[_0x5d6362(0x6b)](async _0x3f8e80=>{const _0x1a6bf3=_0x5d6362,_0x1f24cf=await database_1[_0x1a6bf3(0x207)][_0x1a6bf3(0x133)][_0x1a6bf3(0x10e)]({'where':{'shopId':_0x376639['id'],'status':'PAID','gateway':_0x3f8e80[_0x1a6bf3(0x6f)]},'select':{'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![]}});let _0x2ee574=0x2d;if(_0x376639[_0x1a6bf3(0xfa)])try{const _0x43390c=JSON[_0x1a6bf3(0x166)](_0x376639[_0x1a6bf3(0xfa)]);for(const [_0x21eb6b,_0x416908]of Object['entries'](_0x43390c)){if(_0x21eb6b[_0x1a6bf3(0x1c3)]()===_0x3f8e80[_0x1a6bf3(0x6f)][_0x1a6bf3(0x1c3)]()){_0x2ee574=_0x416908[_0x1a6bf3(0x12c)]||0xa,console[_0x1a6bf3(0xa8)](_0x1a6bf3(0x242)+_0x3f8e80[_0x1a6bf3(0x6f)]+_0x1a6bf3(0x1e8)+_0x376639['id']+':\x20commission\x20=\x20'+_0x2ee574+'%');break;}}}catch(_0x17cbee){console[_0x1a6bf3(0xf0)](_0x1a6bf3(0x8d)+_0x376639['id']+':',_0x17cbee);}const _0x2a0fc1=_0x3f8e80[_0x1a6bf3(0x180)]?.[_0x1a6bf3(0x93)]||0x0;let _0x2f498d=0x0;for(const _0x2936ba of _0x1f24cf){if(_0x2936ba[_0x1a6bf3(0x97)]!==null&&_0x2936ba[_0x1a6bf3(0x97)]!==undefined)_0x2f498d+=_0x2936ba[_0x1a6bf3(0x97)];else{const _0xc5d8ad=_0x2936ba[_0x1a6bf3(0x93)]||0x0;_0x2f498d+=_0xc5d8ad*(0x1-_0x2ee574/0x64);}}return{'gateway':_0x3f8e80['gateway'],'count':_0x3f8e80['_count']?.['id']||0x0,'amountUSDT':Math[_0x1a6bf3(0x11d)](_0x2a0fc1*0x64)/0x64,'amountAfterCommissionUSDT':Math['round'](_0x2f498d*0x64)/0x64,'commission':_0x2ee574};})),_0x468fd9=_0x54755d['reduce']((_0x21dee2,_0x5c068e)=>_0x21dee2+_0x5c068e[_0x5d6362(0x93)],0x0),_0x43bc91=_0x54755d[_0x5d6362(0x9d)]((_0x1ff029,_0x32a7a5)=>_0x1ff029+_0x32a7a5[_0x5d6362(0x227)],0x0),_0x48d096=_0x376639[_0x5d6362(0x16a)];return console[_0x5d6362(0xa8)]('ðŸ’°\x20[PAYOUT]\x20Merchant\x20'+_0x376639[_0x5d6362(0x197)]+':'),console[_0x5d6362(0xa8)](_0x5d6362(0x6d)+_0x468fd9[_0x5d6362(0x7f)](0x2)+'\x20USDT\x20(gross\x20revenue)'),console[_0x5d6362(0xa8)](_0x5d6362(0x138)+_0x43bc91[_0x5d6362(0x7f)](0x2)+'\x20USDT\x20(theoretical\x20net)'),console[_0x5d6362(0xa8)](_0x5d6362(0xd1)+_0x48d096['toFixed'](0x2)+'\x20USDT\x20(current\x20balance\x20in\x20DB)'),console[_0x5d6362(0xa8)](_0x5d6362(0x9a)+_0x35c6e4[_0x5d6362(0x7f)](0x2)+_0x5d6362(0x124)),console[_0x5d6362(0xa8)](_0x5d6362(0x105)+(_0x43bc91-_0x35c6e4-_0x48d096)[_0x5d6362(0x7f)](0x2)+_0x5d6362(0xe5)),{'id':_0x376639['id'],'fullName':_0x376639[_0x5d6362(0x217)],'username':_0x376639['username'],'telegramId':_0x376639[_0x5d6362(0xaf)],'merchantUrl':_0x376639[_0x5d6362(0x10f)],'wallets':{'usdtPolygonWallet':_0x376639[_0x5d6362(0x7c)],'usdtTrcWallet':_0x376639[_0x5d6362(0x144)],'usdtErcWallet':_0x376639[_0x5d6362(0x19f)],'usdcPolygonWallet':_0x376639[_0x5d6362(0x11a)],'usdcErcWallet':_0x376639[_0x5d6362(0x17c)]},'totalAmountUSDT':Math[_0x5d6362(0x11d)](_0x468fd9*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x5d6362(0x11d)](_0x43bc91*0x64)/0x64,'currentBalance':Math[_0x5d6362(0x135)](_0x48d096*0x64)/0x64,'totalPayout':Math[_0x5d6362(0x11d)](_0x35c6e4*0x64)/0x64,'thisMonth':Math['round'](_0x51a22a*0x64)/0x64,'paymentsCount':_0x1ddcd4,'oldestPaymentDate':_0x49ac8f?.[_0x5d6362(0x86)]||_0x376639['createdAt'],'gatewayBreakdown':_0x54755d};})),_0x170e69=_0x20c77d['reduce']((_0x268b1a,_0x1fa785)=>_0x268b1a+_0x1fa785[_0x1f9cc5(0x112)],0x0),_0x3354dc=_0x20c77d[_0x1f9cc5(0x9d)]((_0x1ab1eb,_0x9057d9)=>_0x1ab1eb+_0x9057d9[_0x1f9cc5(0xa5)],0x0),_0x35d2ef=_0x20c77d[_0x1f9cc5(0x9d)]((_0x5ebd9b,_0x5a0992)=>_0x5ebd9b+_0x5a0992['totalPayout'],0x0),_0x57fa6e=_0x20c77d[_0x1f9cc5(0x9d)]((_0x47554d,_0x8d8cc2)=>_0x47554d+_0x8d8cc2[_0x1f9cc5(0x1ee)],0x0);return console[_0x1f9cc5(0xa8)]('ðŸ“Š\x20Merchants\x20with\x20rounded\x20balance\x20!=\x200.00:\x20'+_0xf08d44+_0x1f9cc5(0x94)),console[_0x1f9cc5(0xa8)]('\x20\x20\x20ðŸ’°\x20Total\x20payments\x20turnover:\x20'+Math[_0x1f9cc5(0x11d)](_0x170e69*0x64)/0x64+'\x20USDT\x20(gross\x20revenue)'),console[_0x1f9cc5(0xa8)](_0x1f9cc5(0x211)+Math[_0x1f9cc5(0x11d)](_0x3354dc*0x64)/0x64+'\x20USDT\x20(rounded\x20to\x202\x20decimal\x20places)'),console[_0x1f9cc5(0xa8)](_0x1f9cc5(0x179)+Math[_0x1f9cc5(0x11d)](_0x35d2ef*0x64)/0x64+_0x1f9cc5(0x12d)),console['log'](_0x1f9cc5(0x111)+Math[_0x1f9cc5(0x11d)](_0x57fa6e*0x64)/0x64+_0x1f9cc5(0x12d)),{'merchants':_0x20c77d,'pagination':{'page':_0x193741,'limit':_0x3eb0e1,'total':_0xf08d44,'totalPages':Math[_0x1f9cc5(0x226)](_0xf08d44/_0x3eb0e1)},'summary':{'totalMerchants':_0xf08d44,'totalAmountUSDT':Math[_0x1f9cc5(0x11d)](_0x170e69*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x1f9cc5(0x11d)](_0x3354dc*0x64)/0x64,'totalPayout':Math[_0x1f9cc5(0x11d)](_0x35d2ef*0x64)/0x64,'thisMonth':Math[_0x1f9cc5(0x11d)](_0x57fa6e*0x64)/0x64}};}async[a53_0xc54d14(0x90)](_0x3a44c9){const _0x48d408=a53_0xc54d14,{shopId:_0x2ab582,amount:_0x5e19c6,network:_0x3c234d,wallet:_0x52932f,notes:_0x3b1450,txid:_0x4571fb,periodFrom:_0x1fdc84,periodTo:_0x332cd6}=_0x3a44c9,_0x1dc8e4=await database_1[_0x48d408(0x207)][_0x48d408(0x196)](async _0x4c5362=>{const _0x163fc5=_0x48d408,_0x4bff48=await _0x4c5362[_0x163fc5(0x98)][_0x163fc5(0xa9)]({'where':{'id':_0x2ab582},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x4bff48)throw new Error('Shop\x20not\x20found');console[_0x163fc5(0xa8)](_0x163fc5(0x7e)+_0x4bff48[_0x163fc5(0x197)]+':'),console[_0x163fc5(0xa8)](_0x163fc5(0x136)+_0x4bff48[_0x163fc5(0x16a)][_0x163fc5(0x7f)](0x6)+_0x163fc5(0x12d)),console[_0x163fc5(0xa8)](_0x163fc5(0x121)+_0x5e19c6['toFixed'](0x6)+_0x163fc5(0x12d)),console['log'](_0x163fc5(0x1cb)+_0x4bff48[_0x163fc5(0x15f)][_0x163fc5(0x7f)](0x6)+_0x163fc5(0x12d));if(_0x4571fb)console[_0x163fc5(0xa8)](_0x163fc5(0x88)+_0x4571fb);const _0x4a7ff4=0.000001,_0x1c8b9a=Number(_0x4bff48['balance']),_0x57479f=Number(_0x5e19c6);console[_0x163fc5(0xa8)](_0x163fc5(0xe7)),console['log']('\x20\x20\x20Available\x20(raw):\x20'+_0x4bff48['balance']),console[_0x163fc5(0xa8)](_0x163fc5(0xf2)+_0x1c8b9a),console[_0x163fc5(0xa8)]('\x20\x20\x20Requested\x20(number):\x20'+_0x57479f),console['log']('\x20\x20\x20Difference:\x20'+(_0x1c8b9a-_0x57479f)),console['log'](_0x163fc5(0x1a9)+_0x4a7ff4);if(_0x1c8b9a<_0x57479f-_0x4a7ff4)throw new Error('Insufficient\x20balance.\x20Available:\x20'+_0x1c8b9a['toFixed'](0x6)+_0x163fc5(0x20a)+_0x57479f[_0x163fc5(0x7f)](0x6)+_0x163fc5(0x83)+(_0x1c8b9a-_0x57479f)['toFixed'](0x8)+_0x163fc5(0x12d));console[_0x163fc5(0xa8)](_0x163fc5(0x16f));const _0x30c478=Math[_0x163fc5(0x1b6)](_0x1c8b9a,_0x57479f);let _0x40f718=_0x52932f;console[_0x163fc5(0xa8)]('ðŸ”\x20Initial\x20wallet\x20from\x20request:\x20'+(_0x52932f||_0x163fc5(0x239)));if(!_0x40f718){console['log'](_0x163fc5(0x70));const _0x531067=await _0x4c5362[_0x163fc5(0x98)]['findUnique']({'where':{'id':_0x2ab582},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});console['log'](_0x163fc5(0x1a0),_0x531067);if(_0x531067)switch(_0x3c234d){case _0x163fc5(0x190):_0x40f718=_0x531067[_0x163fc5(0x7c)]||undefined,console[_0x163fc5(0xa8)]('ðŸ”\x20Selected\x20polygon\x20wallet:\x20'+_0x40f718);break;case _0x163fc5(0x228):_0x40f718=_0x531067[_0x163fc5(0x144)]||undefined,console[_0x163fc5(0xa8)](_0x163fc5(0x115)+_0x40f718);break;case'erc20':_0x40f718=_0x531067[_0x163fc5(0x19f)]||undefined,console[_0x163fc5(0xa8)]('ðŸ”\x20Selected\x20erc20\x20wallet:\x20'+_0x40f718);break;case _0x163fc5(0x122):_0x40f718=_0x531067['usdcPolygonWallet']||undefined,console[_0x163fc5(0xa8)](_0x163fc5(0xd3)+_0x40f718);break;case _0x163fc5(0x1f1):_0x40f718=_0x531067[_0x163fc5(0x17c)]||undefined,console[_0x163fc5(0xa8)](_0x163fc5(0x1a2)+_0x40f718);break;}}else console[_0x163fc5(0xa8)]('âœ…\x20Using\x20wallet\x20from\x20request:\x20'+_0x40f718);console[_0x163fc5(0xa8)](_0x163fc5(0xdc)+_0x3c234d+':\x20'+(_0x40f718||_0x163fc5(0x82))),console['log'](_0x163fc5(0x1af),{'shopId':_0x2ab582,'amount':_0x30c478,'network':_0x3c234d,'wallet':_0x40f718,'status':_0x163fc5(0x15b),'txid':_0x4571fb,'notes':_0x3b1450,'periodFrom':_0x1fdc84?new Date(_0x1fdc84):null,'periodTo':_0x332cd6?new Date(_0x332cd6):null});const _0x5427d6=await _0x4c5362['payout'][_0x163fc5(0x222)]({'data':{'shopId':_0x2ab582,'amount':_0x30c478,'network':_0x3c234d,'wallet':_0x40f718,'status':_0x163fc5(0x15b),'txid':_0x4571fb,'notes':_0x3b1450,'periodFrom':_0x1fdc84?new Date(_0x1fdc84):null,'periodTo':_0x332cd6?new Date(_0x332cd6):null,'createdAt':new Date(),'paidAt':new Date()}});console[_0x163fc5(0xa8)](_0x163fc5(0x235),{'id':_0x5427d6['id'],'wallet':_0x5427d6[_0x163fc5(0x1fa)],'network':_0x5427d6[_0x163fc5(0x1f3)],'amount':_0x5427d6[_0x163fc5(0x225)]});const _0x383153=_0x1c8b9a-_0x30c478,_0x3cdf24=Number(_0x4bff48[_0x163fc5(0x15f)])+_0x30c478;return await _0x4c5362['shop'][_0x163fc5(0x1ac)]({'where':{'id':_0x2ab582},'data':{'balance':_0x383153,'totalPaidOut':_0x3cdf24}}),console[_0x163fc5(0xa8)]('ðŸ’°\x20Shop\x20'+_0x4bff48[_0x163fc5(0x197)]+'\x20balance\x20updated:'),console['log'](_0x163fc5(0xcd)+_0x1c8b9a[_0x163fc5(0x7f)](0x6)+_0x163fc5(0x209)+_0x383153[_0x163fc5(0x7f)](0x6)+'\x20USDT\x20(-'+_0x30c478[_0x163fc5(0x7f)](0x6)+')'),console['log'](_0x163fc5(0x17b)+_0x4bff48[_0x163fc5(0x15f)]['toFixed'](0x6)+_0x163fc5(0x209)+_0x3cdf24[_0x163fc5(0x7f)](0x6)+'\x20USDT\x20(+'+_0x30c478[_0x163fc5(0x7f)](0x6)+')'),console[_0x163fc5(0xa8)]('\x20\x20\x20Final\x20payout\x20amount\x20used:\x20'+_0x30c478[_0x163fc5(0x7f)](0x6)+_0x163fc5(0x12d)),{'payout':_0x5427d6,'shop':_0x4bff48};});console[_0x48d408(0xa8)](_0x48d408(0x1fb)+_0x1dc8e4['payout']['id']+_0x48d408(0x1e8)+_0x1dc8e4['shop'][_0x48d408(0x197)]+'\x20('+_0x1dc8e4['payout'][_0x48d408(0x225)][_0x48d408(0x7f)](0x6)+'\x20USDT)');try{let _0x1b6c31=_0x48d408(0x10b);if(_0x1dc8e4[_0x48d408(0x104)]['periodFrom']&&_0x1dc8e4['payout']['periodTo']){const _0x1032d5=new Date(_0x1dc8e4['payout']['periodFrom'])[_0x48d408(0x1e9)](_0x48d408(0x1cc)),_0x37365c=new Date(_0x1dc8e4[_0x48d408(0x104)][_0x48d408(0xa7)])[_0x48d408(0x1e9)](_0x48d408(0x1cc));_0x1b6c31=_0x1032d5+_0x48d408(0x1e1)+_0x37365c;}await telegramBotService_1['telegramBotService']['sendPayoutNotification'](_0x1dc8e4[_0x48d408(0x104)][_0x48d408(0x1d3)],{'id':_0x1dc8e4[_0x48d408(0x104)]['id'],'amount':_0x1dc8e4[_0x48d408(0x104)][_0x48d408(0x225)],'network':_0x1dc8e4[_0x48d408(0x104)][_0x48d408(0x1f3)],'wallet':_0x1dc8e4['payout'][_0x48d408(0x1fa)],'period':_0x1b6c31,'createdAt':_0x1dc8e4[_0x48d408(0x104)][_0x48d408(0x23c)],'txid':_0x1dc8e4[_0x48d408(0x104)][_0x48d408(0x1ef)]}),console[_0x48d408(0xa8)]('ðŸ“±\x20Telegram\x20notification\x20sent\x20for\x20payout\x20'+_0x1dc8e4[_0x48d408(0x104)]['id']);}catch(_0x5f16b2){console[_0x48d408(0xf0)]('âŒ\x20Failed\x20to\x20send\x20Telegram\x20notification\x20for\x20payout\x20'+_0x1dc8e4[_0x48d408(0x104)]['id']+':',_0x5f16b2);}return{'id':_0x1dc8e4[_0x48d408(0x104)]['id'],'shopId':_0x1dc8e4[_0x48d408(0x104)][_0x48d408(0x1d3)],'shopName':_0x1dc8e4[_0x48d408(0x98)][_0x48d408(0x217)],'shopUsername':_0x1dc8e4[_0x48d408(0x98)][_0x48d408(0x197)],'amount':_0x1dc8e4[_0x48d408(0x104)]['amount'],'network':_0x1dc8e4[_0x48d408(0x104)][_0x48d408(0x1f3)],'wallet':_0x1dc8e4[_0x48d408(0x104)][_0x48d408(0x1fa)],'status':_0x1dc8e4[_0x48d408(0x104)][_0x48d408(0x240)],'txid':_0x1dc8e4['payout'][_0x48d408(0x1ef)],'notes':_0x1dc8e4[_0x48d408(0x104)][_0x48d408(0xac)],'periodFrom':_0x1dc8e4[_0x48d408(0x104)][_0x48d408(0x175)],'periodTo':_0x1dc8e4[_0x48d408(0x104)][_0x48d408(0xa7)],'createdAt':_0x1dc8e4[_0x48d408(0x104)]['createdAt'],'paidAt':_0x1dc8e4[_0x48d408(0x104)][_0x48d408(0x86)]};}async['getAllPayouts'](_0x4c8d82){const _0x1fd514=a53_0xc54d14,{page:_0x368f36,limit:_0x389fc6,shopId:_0x19cac9,network:_0x2e6b95,dateFrom:_0x422fcb,dateTo:_0x760b83,search:_0x17a974}=_0x4c8d82,_0x57c3a1=(_0x368f36-0x1)*_0x389fc6,_0x128dc3={};_0x19cac9&&(_0x128dc3[_0x1fd514(0x1d3)]=_0x19cac9);_0x2e6b95&&(_0x128dc3[_0x1fd514(0x1f3)]=_0x2e6b95);if(_0x422fcb||_0x760b83){_0x128dc3[_0x1fd514(0x23c)]={};if(_0x422fcb){const _0x2913d3=new Date(_0x422fcb);_0x2913d3[_0x1fd514(0x186)](0x0,0x0,0x0,0x1),_0x128dc3[_0x1fd514(0x23c)][_0x1fd514(0x77)]=_0x2913d3,console[_0x1fd514(0xa8)](_0x1fd514(0x1e6)+_0x2913d3[_0x1fd514(0x76)]());}if(_0x760b83){const _0x6396a9=new Date(_0x760b83);_0x6396a9[_0x1fd514(0x186)](0x17,0x3b,0x3b,0x3e7),_0x128dc3['createdAt'][_0x1fd514(0x91)]=_0x6396a9,console[_0x1fd514(0xa8)](_0x1fd514(0x1c9)+_0x6396a9[_0x1fd514(0x76)]());}}_0x17a974&&(_0x128dc3['OR']=[{'shop':{'name':{'contains':_0x17a974,'mode':_0x1fd514(0x11b)}}},{'shop':{'username':{'contains':_0x17a974,'mode':_0x1fd514(0x11b)}}},{'notes':{'contains':_0x17a974,'mode':_0x1fd514(0x11b)}}]);const [_0x190c86,_0x1a07c4]=await Promise[_0x1fd514(0xb6)]([database_1[_0x1fd514(0x207)][_0x1fd514(0x104)][_0x1fd514(0x10e)]({'where':_0x128dc3,'skip':_0x57c3a1,'take':_0x389fc6,'orderBy':{'createdAt':_0x1fd514(0x1d0)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'wallet':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x1fd514(0x207)]['payout'][_0x1fd514(0x1b1)]({'where':_0x128dc3})]);return{'payouts':_0x190c86['map'](_0x198758=>({'id':_0x198758['id'],'shopId':_0x198758['shopId'],'shopName':_0x198758[_0x1fd514(0x98)][_0x1fd514(0x217)],'shopUsername':_0x198758['shop'][_0x1fd514(0x197)],'amount':_0x198758[_0x1fd514(0x225)],'network':_0x198758[_0x1fd514(0x1f3)],'wallet':_0x198758[_0x1fd514(0x1fa)],'status':_0x198758[_0x1fd514(0x240)],'txid':_0x198758['txid'],'notes':_0x198758[_0x1fd514(0xac)],'periodFrom':_0x198758[_0x1fd514(0x175)],'periodTo':_0x198758[_0x1fd514(0xa7)],'createdAt':_0x198758[_0x1fd514(0x23c)],'paidAt':_0x198758['paidAt']})),'pagination':{'page':_0x368f36,'limit':_0x389fc6,'total':_0x1a07c4,'totalPages':Math[_0x1fd514(0x226)](_0x1a07c4/_0x389fc6)}};}async[a53_0xc54d14(0x118)](_0x55c846){const _0x41762a=a53_0xc54d14,_0x4f03db=await database_1[_0x41762a(0x207)][_0x41762a(0x104)][_0x41762a(0xa9)]({'where':{'id':_0x55c846},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x4f03db)return null;return{'id':_0x4f03db['id'],'shopId':_0x4f03db['shopId'],'shopName':_0x4f03db[_0x41762a(0x98)][_0x41762a(0x217)],'shopUsername':_0x4f03db['shop']['username'],'amount':_0x4f03db[_0x41762a(0x225)],'network':_0x4f03db[_0x41762a(0x1f3)],'wallet':_0x4f03db[_0x41762a(0x1fa)],'status':_0x4f03db[_0x41762a(0x240)],'txid':_0x4f03db[_0x41762a(0x1ef)],'notes':_0x4f03db[_0x41762a(0xac)],'periodFrom':_0x4f03db['periodFrom'],'periodTo':_0x4f03db[_0x41762a(0xa7)],'createdAt':_0x4f03db[_0x41762a(0x23c)],'paidAt':_0x4f03db[_0x41762a(0x86)]};}async[a53_0xc54d14(0x119)](_0x449fd9){const _0x2176c8=a53_0xc54d14;await database_1[_0x2176c8(0x207)]['payout']['delete']({'where':{'id':_0x449fd9}});}async[a53_0xc54d14(0x1c7)](_0x8bf4d8,_0x3fc22c){const _0x2343d6=a53_0xc54d14,_0x4c08df=await database_1[_0x2343d6(0x207)]['$transaction'](async _0x116a00=>{const _0x393ec1=_0x2343d6,_0x2feec0=await _0x116a00[_0x393ec1(0x104)]['findUnique']({'where':{'id':_0x8bf4d8},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}}}});if(!_0x2feec0)throw new Error('Payout\x20not\x20found');console[_0x393ec1(0xa8)](_0x393ec1(0x1e3)+_0x8bf4d8+'\x20for\x20shop\x20'+_0x2feec0[_0x393ec1(0x98)][_0x393ec1(0x197)]+':'),console[_0x393ec1(0xa8)](_0x393ec1(0x73)+_0x2feec0[_0x393ec1(0x225)][_0x393ec1(0x7f)](0x6)+_0x393ec1(0x12d)),console[_0x393ec1(0xa8)](_0x393ec1(0x1ae)+_0x2feec0[_0x393ec1(0x1f3)]),console[_0x393ec1(0xa8)]('\x20\x20\x20Shop\x20balance:\x20'+_0x2feec0[_0x393ec1(0x98)][_0x393ec1(0x16a)][_0x393ec1(0x7f)](0x6)+_0x393ec1(0x12d)),console[_0x393ec1(0xa8)](_0x393ec1(0x181)+_0x2feec0[_0x393ec1(0x98)][_0x393ec1(0x15f)][_0x393ec1(0x7f)](0x6)+_0x393ec1(0x12d));let _0x643bf9=0x0;if(_0x3fc22c[_0x393ec1(0x225)]!==undefined){const _0x3cdc76=Number(_0x2feec0[_0x393ec1(0x225)]),_0x4e1084=Number(_0x3fc22c[_0x393ec1(0x225)]);_0x643bf9=_0x4e1084-_0x3cdc76,console[_0x393ec1(0xa8)]('\x20\x20\x20New\x20amount:\x20'+_0x4e1084[_0x393ec1(0x7f)](0x6)+_0x393ec1(0x12d)),console[_0x393ec1(0xa8)]('\x20\x20\x20Amount\x20difference:\x20'+_0x643bf9[_0x393ec1(0x7f)](0x6)+'\x20USDT');if(_0x643bf9<0x0)console['log'](_0x393ec1(0x1de)+Math[_0x393ec1(0x231)](_0x643bf9)[_0x393ec1(0x7f)](0x6)+'\x20USDT\x20-\x20will\x20return\x20to\x20balance');else{if(_0x643bf9>0x0){const _0x44b7d5=Number(_0x2feec0[_0x393ec1(0x98)]['balance']);console[_0x393ec1(0xa8)]('\x20\x20\x20Amount\x20increased\x20by\x20'+_0x643bf9[_0x393ec1(0x7f)](0x6)+_0x393ec1(0x203));if(_0x44b7d5<_0x643bf9)throw new Error(_0x393ec1(0x1a5)+_0x44b7d5[_0x393ec1(0x7f)](0x6)+_0x393ec1(0xc9)+_0x643bf9[_0x393ec1(0x7f)](0x6)+'\x20USDT');}}}const _0x2a6df1={};if(_0x3fc22c[_0x393ec1(0x225)]!==undefined)_0x2a6df1[_0x393ec1(0x225)]=_0x3fc22c[_0x393ec1(0x225)];if(_0x3fc22c[_0x393ec1(0x1f3)]!==undefined)_0x2a6df1['network']=_0x3fc22c[_0x393ec1(0x1f3)];if(_0x3fc22c[_0x393ec1(0x1fa)]!==undefined)_0x2a6df1[_0x393ec1(0x1fa)]=_0x3fc22c[_0x393ec1(0x1fa)]||null;if(_0x3fc22c[_0x393ec1(0xac)]!==undefined)_0x2a6df1[_0x393ec1(0xac)]=_0x3fc22c[_0x393ec1(0xac)]||null;if(_0x3fc22c[_0x393ec1(0x1ef)]!==undefined)_0x2a6df1['txid']=_0x3fc22c[_0x393ec1(0x1ef)]||null;if(_0x3fc22c[_0x393ec1(0x175)]!==undefined)_0x2a6df1[_0x393ec1(0x175)]=_0x3fc22c[_0x393ec1(0x175)]?new Date(_0x3fc22c['periodFrom']):null;if(_0x3fc22c[_0x393ec1(0xa7)]!==undefined)_0x2a6df1[_0x393ec1(0xa7)]=_0x3fc22c[_0x393ec1(0xa7)]?new Date(_0x3fc22c[_0x393ec1(0xa7)]):null;const _0x1e34dc=await _0x116a00[_0x393ec1(0x104)]['update']({'where':{'id':_0x8bf4d8},'data':_0x2a6df1,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(_0x643bf9!==0x0){const _0x3ed94c=Number(_0x2feec0[_0x393ec1(0x98)]['balance']),_0x1dfcc3=Number(_0x2feec0['shop'][_0x393ec1(0x15f)]),_0x3f7138=_0x3ed94c-_0x643bf9,_0x28f7b9=_0x1dfcc3+_0x643bf9;await _0x116a00['shop'][_0x393ec1(0x1ac)]({'where':{'id':_0x2feec0[_0x393ec1(0x1d3)]},'data':{'balance':_0x3f7138,'totalPaidOut':_0x28f7b9}}),console[_0x393ec1(0xa8)]('ðŸ’°\x20Shop\x20'+_0x2feec0['shop'][_0x393ec1(0x197)]+_0x393ec1(0x178)),console[_0x393ec1(0xa8)](_0x393ec1(0xcd)+_0x3ed94c[_0x393ec1(0x7f)](0x6)+_0x393ec1(0x209)+_0x3f7138[_0x393ec1(0x7f)](0x6)+_0x393ec1(0x12d)),console[_0x393ec1(0xa8)](_0x393ec1(0x17b)+_0x1dfcc3[_0x393ec1(0x7f)](0x6)+'\x20->\x20'+_0x28f7b9[_0x393ec1(0x7f)](0x6)+'\x20USDT');}return console['log'](_0x393ec1(0x154)+_0x8bf4d8+_0x393ec1(0x14a)),_0x1e34dc;});return{'id':_0x4c08df['id'],'shopId':_0x4c08df['shopId'],'shopName':_0x4c08df[_0x2343d6(0x98)][_0x2343d6(0x217)],'shopUsername':_0x4c08df[_0x2343d6(0x98)][_0x2343d6(0x197)],'amount':Number(_0x4c08df[_0x2343d6(0x225)]),'network':_0x4c08df[_0x2343d6(0x1f3)],'wallet':_0x4c08df['wallet'],'status':_0x4c08df[_0x2343d6(0x240)],'txid':_0x4c08df[_0x2343d6(0x1ef)],'notes':_0x4c08df[_0x2343d6(0xac)],'periodFrom':_0x4c08df[_0x2343d6(0x175)],'periodTo':_0x4c08df[_0x2343d6(0xa7)],'createdAt':_0x4c08df[_0x2343d6(0x23c)],'paidAt':_0x4c08df['paidAt']};}async['getAllPayments'](_0x1ecfb2){const _0x718b1d=a53_0xc54d14,{page:_0x360953,limit:_0x1be512,status:_0x119cc4,gateway:_0x1fec05,shopId:_0x15585d,dateFrom:_0x2b4957,dateTo:_0x5194f7,search:_0x1d618c,currency:_0x3b0970,sortBy:_0x5c74df,sortOrder:_0x1a70f7}=_0x1ecfb2,_0x34536b=(_0x360953-0x1)*_0x1be512;console[_0x718b1d(0xa8)](_0x718b1d(0x168),_0x1ecfb2);const _0x430f14=await database_1[_0x718b1d(0x207)][_0x718b1d(0x133)][_0x718b1d(0x117)]({'by':[_0x718b1d(0x6f)],'_count':{'gateway':!![]}});console[_0x718b1d(0xa8)](_0x718b1d(0xe8),_0x430f14[_0x718b1d(0x6b)](_0x383b46=>_0x383b46['gateway']+'\x20('+_0x383b46['_count'][_0x718b1d(0x6f)]+_0x718b1d(0xca)));if(_0x1fec05){const _0x2a7bd6=_0x430f14[_0x718b1d(0x23a)](_0x40c108=>_0x40c108[_0x718b1d(0x6f)]['toLowerCase']()===_0x1fec05[_0x718b1d(0x1c3)]());!_0x2a7bd6&&_0x1fec05[_0x718b1d(0x1c3)]()!==_0x718b1d(0x130)&&console['log'](_0x718b1d(0x21f)+_0x1fec05+_0x718b1d(0x229)+_0x430f14[_0x718b1d(0x6b)](_0x10a294=>_0x10a294[_0x718b1d(0x6f)])['join'](',\x20'));}const _0x50693e={};_0x119cc4&&(_0x50693e['status']=_0x119cc4[_0x718b1d(0x15a)]());if(!_0x1fec05)_0x50693e[_0x718b1d(0x6f)]={'not':_0x718b1d(0x130)};else{if(_0x1fec05&&(_0x1fec05[_0x718b1d(0x1c3)]()===_0x718b1d(0x130)||_0x1fec05==='0000'))_0x50693e[_0x718b1d(0x6f)]=_0x718b1d(0x130);else{let _0x45358f=_0x1fec05;const _0x3eec8f=(0x0,gateway_1['getGatewayNameById'])(_0x1fec05);if(_0x3eec8f)_0x45358f=_0x3eec8f,console['log'](_0x718b1d(0x9b)+_0x1fec05+'\x27\x20to\x20name\x20\x27'+_0x45358f+'\x27');else{const _0x46533b=(0x0,gateway_1[_0x718b1d(0xda)])(_0x1fec05);if(_0x46533b){const _0x250fb3=(0x0,gateway_1[_0x718b1d(0x22f)])(_0x46533b);_0x250fb3&&(_0x45358f=_0x250fb3,console['log']('ðŸ”„\x20Converted\x20gateway\x20name\x20\x27'+_0x1fec05+_0x718b1d(0xa4)+_0x46533b+_0x718b1d(0x139)+_0x45358f+'\x27'));}else console[_0x718b1d(0xa8)](_0x718b1d(0x17a)+_0x1fec05+_0x718b1d(0x140));}const _0x1e0435=await database_1[_0x718b1d(0x207)][_0x718b1d(0x133)]['count']({'where':{'gateway':_0x45358f[_0x718b1d(0x1c3)]()},'take':0x1});_0x1e0435===0x0?(console['log'](_0x718b1d(0x12e)+_0x45358f+'\x27\x20(from\x20\x27'+_0x1fec05+'\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result'),_0x50693e['gateway']='NONEXISTENT_GATEWAY_FILTER'):(_0x50693e['gateway']=_0x45358f[_0x718b1d(0x1c3)](),console[_0x718b1d(0xa8)]('âœ…\x20Using\x20gateway\x20filter:\x20\x27'+_0x45358f+_0x718b1d(0x1a8)+_0x1fec05+'\x27)'));}}console[_0x718b1d(0xa8)](_0x718b1d(0x126),_0x50693e['gateway']);_0x15585d&&(_0x50693e[_0x718b1d(0x1d3)]=_0x15585d);_0x3b0970&&(_0x50693e[_0x718b1d(0x20f)]=_0x3b0970[_0x718b1d(0x15a)](),console[_0x718b1d(0xa8)](_0x718b1d(0x169)+_0x3b0970[_0x718b1d(0x15a)]()));if(_0x2b4957||_0x5194f7){_0x50693e[_0x718b1d(0x23c)]={};if(_0x2b4957){const _0x5bfe96=new Date(_0x2b4957),_0x433f8a=new Date(Date[_0x718b1d(0x160)](_0x5bfe96[_0x718b1d(0xc7)](),_0x5bfe96[_0x718b1d(0x1a6)](),_0x5bfe96[_0x718b1d(0x243)](),0x0,0x0,0x0,0x0));_0x50693e[_0x718b1d(0x23c)][_0x718b1d(0x77)]=_0x433f8a,console[_0x718b1d(0xa8)](_0x718b1d(0x185)+_0x433f8a[_0x718b1d(0x76)]());}if(_0x5194f7){const _0x290df1=new Date(_0x5194f7),_0x51e331=new Date(Date['UTC'](_0x290df1[_0x718b1d(0xc7)](),_0x290df1[_0x718b1d(0x1a6)](),_0x290df1[_0x718b1d(0x243)](),0x17,0x3b,0x3b,0x3e7));_0x50693e['createdAt'][_0x718b1d(0x91)]=_0x51e331,console[_0x718b1d(0xa8)](_0x718b1d(0x9c)+_0x51e331[_0x718b1d(0x76)]());}}_0x1d618c&&(_0x50693e['OR']=[{'id':{'contains':_0x1d618c,'mode':'insensitive'}},{'orderId':{'contains':_0x1d618c,'mode':_0x718b1d(0x11b)}},{'gatewayOrderId':{'contains':_0x1d618c,'mode':_0x718b1d(0x11b)}},{'customerEmail':{'contains':_0x1d618c,'mode':_0x718b1d(0x11b)}},{'shop':{'name':{'contains':_0x1d618c,'mode':_0x718b1d(0x11b)}}},{'shop':{'username':{'contains':_0x1d618c,'mode':'insensitive'}}}]);console['log']('ðŸ“Š\x20Final\x20WHERE\x20conditions:',JSON['stringify'](_0x50693e,null,0x2));const _0xc35146=await database_1['default']['payment'][_0x718b1d(0x1b1)]({'where':_0x50693e});console['log']('ðŸ”\x20Total\x20payments\x20matching\x20filters:\x20'+_0xc35146);let _0x29d5f3={'createdAt':'desc'};if(_0x5c74df){const _0x308253=[_0x718b1d(0x225),_0x718b1d(0x23c),_0x718b1d(0x146),'status','gateway',_0x718b1d(0x20f)],_0x2c07db=[_0x718b1d(0x89),_0x718b1d(0x1d0)];if(_0x308253['includes'](_0x5c74df)){const _0x58eb81=_0x2c07db[_0x718b1d(0x194)](_0x1a70f7)?_0x1a70f7:_0x718b1d(0x1d0);_0x29d5f3={[_0x5c74df]:_0x58eb81},console[_0x718b1d(0xa8)](_0x718b1d(0xf8)+_0x5c74df+_0x718b1d(0xc6)+_0x58eb81+_0x718b1d(0x8c));}}const [_0xc8f116,_0x27402b]=await Promise['all']([database_1[_0x718b1d(0x207)][_0x718b1d(0x133)][_0x718b1d(0x10e)]({'where':_0x50693e,'skip':_0x34536b,'take':_0x1be512,'orderBy':_0x29d5f3,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x718b1d(0x207)][_0x718b1d(0x133)][_0x718b1d(0x1b1)]({'where':_0x50693e})]);let _0x8dade8,_0x4f9dbb;if(_0x2b4957){const _0xcca181=new Date(_0x2b4957);_0x8dade8=new Date(Date[_0x718b1d(0x160)](_0xcca181['getUTCFullYear'](),_0xcca181['getUTCMonth'](),_0xcca181[_0x718b1d(0x243)](),0x0,0x0,0x0,0x0));}else{const _0x2cebb7=new Date();_0x8dade8=new Date(Date['UTC'](_0x2cebb7[_0x718b1d(0xc7)](),_0x2cebb7[_0x718b1d(0x1a6)](),_0x2cebb7['getUTCDate'](),0x0,0x0,0x0,0x0));}if(_0x5194f7){const _0x443c19=new Date(_0x5194f7);_0x4f9dbb=new Date(Date[_0x718b1d(0x160)](_0x443c19[_0x718b1d(0xc7)](),_0x443c19[_0x718b1d(0x1a6)](),_0x443c19[_0x718b1d(0x243)](),0x17,0x3b,0x3b,0x3e7));}else{if(_0x2b4957){const _0x4463bf=new Date(_0x2b4957);_0x4f9dbb=new Date(Date[_0x718b1d(0x160)](_0x4463bf['getUTCFullYear'](),_0x4463bf[_0x718b1d(0x1a6)](),_0x4463bf[_0x718b1d(0x243)](),0x17,0x3b,0x3b,0x3e7));}else{const _0x2ac957=new Date();_0x4f9dbb=new Date(Date[_0x718b1d(0x160)](_0x2ac957[_0x718b1d(0xc7)](),_0x2ac957[_0x718b1d(0x1a6)](),_0x2ac957['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}}const _0xd4e78d={};{const _0xa41147={'status':_0x119cc4?_0x119cc4[_0x718b1d(0x15a)]():_0x718b1d(0x23e),'createdAt':{'gte':_0x8dade8,'lte':_0x4f9dbb}};_0x1fec05?_0xa41147[_0x718b1d(0x6f)]=_0x50693e['gateway']:_0xa41147[_0x718b1d(0x6f)]={'not':_0x718b1d(0x130)};_0x15585d&&(_0xa41147['shopId']=_0x15585d);_0x3b0970&&(_0xa41147[_0x718b1d(0x20f)]=_0x3b0970['toUpperCase']());console[_0x718b1d(0xa8)](_0x718b1d(0x6a),JSON['stringify'](_0xa41147,null,0x2));const _0x4a819b=await database_1[_0x718b1d(0x207)][_0x718b1d(0x133)][_0x718b1d(0x10e)]({'where':_0xa41147,'select':{'amountUSDT':!![],'currency':!![],'amount':!![]}});let _0x3115a1=0x0;_0x4a819b[_0x718b1d(0x7b)](_0xe0ff16=>{const _0x1a073e=_0x718b1d;_0xe0ff16[_0x1a073e(0x93)]&&(_0x3115a1+=_0xe0ff16[_0x1a073e(0x93)]);if(_0xe0ff16[_0x1a073e(0x20f)]){const _0x5db998=_0xe0ff16[_0x1a073e(0x20f)]['toUpperCase']();!_0xd4e78d[_0x5db998]&&(_0xd4e78d[_0x5db998]=0x0),_0xd4e78d[_0x5db998]+=_0xe0ff16[_0x1a073e(0x225)];}}),_0x3115a1>0x0&&(_0xd4e78d[_0x718b1d(0x107)]=_0x3115a1);}return{'payments':_0xc8f116,'pagination':{'page':_0x360953,'limit':_0x1be512,'total':_0x27402b,'totalPages':Math[_0x718b1d(0x226)](_0x27402b/_0x1be512)},'statistics':_0xd4e78d};}async[a53_0xc54d14(0x10a)](_0x21e3a1){const _0x4714a0=a53_0xc54d14,_0x2cf413=await database_1[_0x4714a0(0x207)][_0x4714a0(0x133)][_0x4714a0(0xa9)]({'where':{'id':_0x21e3a1},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x2cf413)return null;return{'id':_0x2cf413['id'],'shopId':_0x2cf413[_0x4714a0(0x1d3)],'gateway':_0x2cf413[_0x4714a0(0x6f)],'amount':_0x2cf413[_0x4714a0(0x225)],'currency':_0x2cf413[_0x4714a0(0x20f)],'status':_0x2cf413[_0x4714a0(0x240)],'orderId':_0x2cf413['orderId'],'gatewayOrderId':_0x2cf413[_0x4714a0(0x79)],'customerEmail':_0x2cf413[_0x4714a0(0xbd)],'customerName':_0x2cf413[_0x4714a0(0xf9)],'customerCountry':_0x2cf413[_0x4714a0(0x102)],'customerIp':_0x2cf413['customerIp'],'customerUa':_0x2cf413['customerUa'],'failureMessage':_0x2cf413[_0x4714a0(0xd4)],'externalPaymentUrl':_0x2cf413[_0x4714a0(0x149)],'successUrl':_0x2cf413[_0x4714a0(0x13c)],'failUrl':_0x2cf413[_0x4714a0(0xd8)],'pendingUrl':_0x2cf413[_0x4714a0(0x1c0)],'whiteUrl':_0x2cf413[_0x4714a0(0xbe)],'createdAt':_0x2cf413['createdAt'],'updatedAt':_0x2cf413[_0x4714a0(0x146)],'shop':_0x2cf413[_0x4714a0(0x98)]};}async['updatePaymentStatus'](_0x30b601,_0x213836,_0x47ebdc,_0x5233f3){const _0x1c4874=a53_0xc54d14,_0x1b01f9=await database_1[_0x1c4874(0x207)][_0x1c4874(0x196)](async _0x1ac994=>{const _0x316b84=_0x1c4874,_0x1e8dd2=await _0x1ac994[_0x316b84(0x133)]['findUnique']({'where':{'id':_0x30b601},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x1e8dd2)throw new Error(_0x316b84(0xf4));const _0x15352a=_0x1e8dd2[_0x316b84(0x240)],_0x40946a=_0x213836['toUpperCase']();console[_0x316b84(0xa8)](_0x316b84(0x101)+_0x30b601+_0x316b84(0x17d)+_0x15352a+_0x316b84(0x209)+_0x40946a),console[_0x316b84(0xa8)]('ðŸ’°\x20Current\x20shop\x20balance:\x20'+_0x1e8dd2[_0x316b84(0x98)]['balance']+_0x316b84(0x12d));const _0x3933a4={'status':_0x40946a,'updatedAt':new Date(),'statusChangedBy':'admin','statusChangedAt':new Date()};_0x47ebdc&&(_0x3933a4[_0x316b84(0x125)]=_0x47ebdc);_0x40946a===_0x316b84(0x1f6)&&_0x5233f3&&(_0x3933a4[_0x316b84(0xd5)]=_0x5233f3);let _0x1d8b27=0x0,_0x2ca48d=_0x1e8dd2[_0x316b84(0x98)][_0x316b84(0x16a)];if(_0x40946a==='PAID'&&_0x15352a!==_0x316b84(0x23e)){_0x3933a4[_0x316b84(0x86)]=new Date();const _0x1fbde7=await currencyService_1['currencyService'][_0x316b84(0x1fe)](_0x1e8dd2['amount'],_0x1e8dd2[_0x316b84(0x20f)]);_0x3933a4[_0x316b84(0x93)]=_0x1fbde7;let _0x1d1a6f=0x2d;const _0x55b861=await _0x1ac994[_0x316b84(0x98)][_0x316b84(0xa9)]({'where':{'id':_0x1e8dd2['shopId']},'select':{'gatewaySettings':!![]}});if(_0x55b861?.[_0x316b84(0xfa)])try{const _0xd0f46f=JSON[_0x316b84(0x166)](_0x55b861[_0x316b84(0xfa)]);for(const [_0x153cbb,_0x20d829]of Object[_0x316b84(0x1a7)](_0xd0f46f)){if(_0x153cbb[_0x316b84(0x1c3)]()===_0x1e8dd2[_0x316b84(0x6f)][_0x316b84(0x1c3)]()){_0x1d1a6f=_0x20d829[_0x316b84(0x12c)]||0xa;break;}}}catch(_0x37d2bd){console[_0x316b84(0xf0)]('Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20'+_0x30b601+':',_0x37d2bd);}let _0x109a33;_0x1e8dd2[_0x316b84(0x97)]!==null&&_0x1e8dd2['amountAfterGatewayCommissionUSDT']!==undefined?(_0x109a33=_0x1e8dd2['amountAfterGatewayCommissionUSDT'],console[_0x316b84(0xa8)]('ðŸ“Š\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20'+_0x109a33[_0x316b84(0x7f)](0x6)+_0x316b84(0xcf)+_0x30b601)):(_0x109a33=_0x1fbde7*(0x1-_0x1d1a6f/0x64),console['log'](_0x316b84(0xd9)+_0x30b601+':\x20'+_0x1d1a6f+'%\x20from\x20'+_0x1fbde7['toFixed'](0x6)+_0x316b84(0x12d)),_0x3933a4[_0x316b84(0x97)]=_0x109a33,_0x3933a4[_0x316b84(0x221)]=_0x1d1a6f),_0x1d8b27=_0x109a33,_0x2ca48d+=_0x109a33,console[_0x316b84(0xa8)](_0x316b84(0x1e2)+_0x30b601+_0x316b84(0x134)),console[_0x316b84(0xa8)](_0x316b84(0x129)+_0x1fbde7[_0x316b84(0x7f)](0x6)+_0x316b84(0x12d)),console[_0x316b84(0xa8)](_0x316b84(0x12a)+_0x1e8dd2['gateway']+_0x316b84(0xc3)+_0x1d1a6f+'%'),console[_0x316b84(0xa8)](_0x316b84(0xf5)+_0x109a33[_0x316b84(0x7f)](0x6)+_0x316b84(0xba)+_0x1d1a6f+_0x316b84(0x224)),console['log']('\x20\x20\x20Added\x20to\x20balance:\x20+'+_0x109a33['toFixed'](0x6)+_0x316b84(0x12d));}else{if(_0x15352a===_0x316b84(0x23e)&&_0x40946a!==_0x316b84(0x23e)&&_0x40946a!==_0x316b84(0x1f6)){if(_0x1e8dd2[_0x316b84(0x93)]){let _0x195c51=0x2d;const _0x3599e9=await _0x1ac994[_0x316b84(0x98)][_0x316b84(0xa9)]({'where':{'id':_0x1e8dd2[_0x316b84(0x1d3)]},'select':{'gatewaySettings':!![]}});if(_0x3599e9?.[_0x316b84(0xfa)])try{const _0x434ad9=JSON[_0x316b84(0x166)](_0x3599e9[_0x316b84(0xfa)]);for(const [_0x3dcd1d,_0x2a5349]of Object[_0x316b84(0x1a7)](_0x434ad9)){if(_0x3dcd1d[_0x316b84(0x1c3)]()===_0x1e8dd2[_0x316b84(0x6f)]['toLowerCase']()){_0x195c51=_0x2a5349['commission']||0xa;break;}}}catch(_0x254028){console[_0x316b84(0xf0)](_0x316b84(0x21d)+_0x30b601+':',_0x254028);}const _0x194c0b=_0x1e8dd2[_0x316b84(0x93)]*(0x1-_0x195c51/0x64);_0x1d8b27=-_0x194c0b,_0x2ca48d-=_0x194c0b,console[_0x316b84(0xa8)](_0x316b84(0x129)+_0x1e8dd2[_0x316b84(0x93)][_0x316b84(0x7f)](0x6)+_0x316b84(0x12d)),console[_0x316b84(0xa8)]('\x20\x20\x20Gateway:\x20'+_0x1e8dd2[_0x316b84(0x6f)]+_0x316b84(0xc3)+_0x195c51+'%'),console[_0x316b84(0xa8)](_0x316b84(0x236)+_0x194c0b[_0x316b84(0x7f)](0x6)+_0x316b84(0xba)+_0x195c51+_0x316b84(0x224)),console[_0x316b84(0xa8)](_0x316b84(0xfb)+_0x194c0b['toFixed'](0x6)+_0x316b84(0x12d));}}}_0x40946a===_0x316b84(0x1f6)&&(console[_0x316b84(0xa8)](_0x316b84(0x1d7)),_0x5233f3&&_0x5233f3>0x0?(_0x1d8b27=-_0x5233f3,_0x2ca48d-=_0x5233f3,console[_0x316b84(0xa8)](_0x316b84(0x1b0)+_0x5233f3[_0x316b84(0x7f)](0x6)+'\x20USDT\x20from\x20balance'),console[_0x316b84(0xa8)](_0x316b84(0x1bb))):console[_0x316b84(0xa8)](_0x316b84(0x234)),_0x3933a4[_0x316b84(0xd5)]=_0x5233f3||0x0);_0x40946a===_0x316b84(0x1fd)&&_0x15352a===_0x316b84(0x23e)&&console['log'](_0x316b84(0xf7));const _0x49c708=await _0x1ac994[_0x316b84(0x133)][_0x316b84(0x1ac)]({'where':{'id':_0x30b601},'data':_0x3933a4,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x1d8b27!==0x0&&(await _0x1ac994[_0x316b84(0x98)]['update']({'where':{'id':_0x1e8dd2[_0x316b84(0x1d3)]},'data':{'balance':_0x2ca48d}}),console[_0x316b84(0xa8)](_0x316b84(0x123)+_0x1e8dd2['shopId']+_0x316b84(0x19e)+_0x1e8dd2[_0x316b84(0x98)][_0x316b84(0x16a)][_0x316b84(0x7f)](0x6)+_0x316b84(0x209)+_0x2ca48d[_0x316b84(0x7f)](0x6)+_0x316b84(0x11c)+(_0x1d8b27>0x0?'+':'')+_0x1d8b27[_0x316b84(0x7f)](0x6)+')')),_0x49c708;});return{'id':_0x1b01f9['id'],'shopId':_0x1b01f9['shopId'],'gateway':_0x1b01f9[_0x1c4874(0x6f)],'amount':_0x1b01f9['amount'],'currency':_0x1b01f9[_0x1c4874(0x20f)],'status':_0x1b01f9[_0x1c4874(0x240)],'orderId':_0x1b01f9['orderId'],'gatewayOrderId':_0x1b01f9[_0x1c4874(0x79)],'customerEmail':_0x1b01f9[_0x1c4874(0xbd)],'customerName':_0x1b01f9[_0x1c4874(0xf9)],'customerCountry':_0x1b01f9[_0x1c4874(0x102)],'customerIp':_0x1b01f9['customerIp'],'customerUa':_0x1b01f9[_0x1c4874(0x11f)],'failureMessage':_0x1b01f9[_0x1c4874(0xd4)],'adminNotes':_0x1b01f9[_0x1c4874(0x125)],'chargebackAmount':_0x1b01f9[_0x1c4874(0xd5)],'statusChangedBy':_0x1b01f9['statusChangedBy'],'statusChangedAt':_0x1b01f9['statusChangedAt'],'createdAt':_0x1b01f9[_0x1c4874(0x23c)],'updatedAt':_0x1b01f9[_0x1c4874(0x146)],'shop':_0x1b01f9[_0x1c4874(0x98)]};}async[a53_0xc54d14(0x1b3)](_0x45b1c1,_0x26afa4){const _0x3c4f2a=a53_0xc54d14,_0x298513=Math['random']()[_0x3c4f2a(0xb1)](0x24)['substr'](0x2,0x9);console[_0x3c4f2a(0xa8)](_0x3c4f2a(0xe0)+_0x298513+_0x3c4f2a(0xc2)+_0x45b1c1);const _0x2f57d5={..._0x26afa4};_0x26afa4['password']&&_0x26afa4[_0x3c4f2a(0xd6)][_0x3c4f2a(0x1b9)]()!==''?(console[_0x3c4f2a(0xa8)](_0x3c4f2a(0x131)+_0x298513+']\x20Updating\x20password\x20for\x20user\x20'+_0x45b1c1),_0x2f57d5[_0x3c4f2a(0xd6)]=await bcryptjs_1[_0x3c4f2a(0x207)]['hash'](_0x26afa4[_0x3c4f2a(0xd6)],0xc)):(console[_0x3c4f2a(0xa8)](_0x3c4f2a(0x131)+_0x298513+_0x3c4f2a(0x84)),delete _0x2f57d5[_0x3c4f2a(0xd6)]);_0x26afa4[_0x3c4f2a(0x1bf)]&&(_0x2f57d5[_0x3c4f2a(0x217)]=_0x26afa4[_0x3c4f2a(0x1bf)],delete _0x2f57d5['fullName']);_0x26afa4['telegramId']&&(_0x2f57d5['telegram']=_0x26afa4[_0x3c4f2a(0x81)],delete _0x2f57d5[_0x3c4f2a(0x81)]);_0x26afa4['merchantUrl']!==undefined&&(_0x2f57d5[_0x3c4f2a(0x10f)]=_0x26afa4[_0x3c4f2a(0x241)]||null,delete _0x2f57d5['merchantUrl']);_0x26afa4[_0x3c4f2a(0x237)]!==undefined&&(_0x2f57d5[_0x3c4f2a(0x16d)]=_0x26afa4[_0x3c4f2a(0x237)]||null,delete _0x2f57d5[_0x3c4f2a(0x237)]);_0x26afa4[_0x3c4f2a(0xa0)]!==undefined&&(_0x2f57d5[_0x3c4f2a(0x1dc)]=_0x26afa4['merchantUrl3']||null,delete _0x2f57d5[_0x3c4f2a(0xa0)]);_0x26afa4[_0x3c4f2a(0x141)]!==undefined&&(_0x2f57d5[_0x3c4f2a(0xde)]=_0x26afa4[_0x3c4f2a(0x141)]||null,delete _0x2f57d5['merchantUrl4']);if(_0x26afa4[_0x3c4f2a(0xb8)]){const _0x46332c=_0x26afa4[_0x3c4f2a(0xb8)][_0x3c4f2a(0x6b)](_0xd60b3b=>this[_0x3c4f2a(0x22d)](_0xd60b3b));console[_0x3c4f2a(0xa8)](_0x3c4f2a(0xd0),_0x26afa4['gateways'],'->',_0x46332c),_0x2f57d5[_0x3c4f2a(0x1eb)]=JSON[_0x3c4f2a(0x96)](_0x46332c),delete _0x2f57d5['gateways'];}_0x26afa4[_0x3c4f2a(0xfa)]&&(console['log'](_0x3c4f2a(0xb3)+_0x298513+_0x3c4f2a(0x23d),_0x26afa4['gatewaySettings']),_0x2f57d5[_0x3c4f2a(0xfa)]=JSON[_0x3c4f2a(0x96)](_0x26afa4[_0x3c4f2a(0xfa)]),console[_0x3c4f2a(0xa8)](_0x3c4f2a(0xb3)+_0x298513+_0x3c4f2a(0x69),_0x2f57d5['gatewaySettings']));_0x26afa4[_0x3c4f2a(0x100)]&&(_0x26afa4[_0x3c4f2a(0x100)]['usdtPolygonWallet']!==undefined&&(_0x2f57d5[_0x3c4f2a(0x7c)]=_0x26afa4[_0x3c4f2a(0x100)][_0x3c4f2a(0x7c)]||null),_0x26afa4[_0x3c4f2a(0x100)][_0x3c4f2a(0x144)]!==undefined&&(_0x2f57d5['usdtTrcWallet']=_0x26afa4[_0x3c4f2a(0x100)][_0x3c4f2a(0x144)]||null),_0x26afa4[_0x3c4f2a(0x100)][_0x3c4f2a(0x19f)]!==undefined&&(_0x2f57d5[_0x3c4f2a(0x19f)]=_0x26afa4[_0x3c4f2a(0x100)][_0x3c4f2a(0x19f)]||null),_0x26afa4[_0x3c4f2a(0x100)]['usdcPolygonWallet']!==undefined&&(_0x2f57d5[_0x3c4f2a(0x11a)]=_0x26afa4[_0x3c4f2a(0x100)]['usdcPolygonWallet']||null),delete _0x2f57d5[_0x3c4f2a(0x100)]);const _0x1e46af=await database_1[_0x3c4f2a(0x207)][_0x3c4f2a(0x98)][_0x3c4f2a(0x1ac)]({'where':{'id':_0x45b1c1},'data':_0x2f57d5,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'shopUrl2':!![],'shopUrl3':!![],'shopUrl4':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console['log'](_0x3c4f2a(0xbf)+_0x298513+_0x3c4f2a(0xee),_0x1e46af[_0x3c4f2a(0xfa)]),{'id':_0x1e46af['id'],'fullName':_0x1e46af[_0x3c4f2a(0x217)],'username':_0x1e46af['username'],'telegramId':_0x1e46af[_0x3c4f2a(0xaf)],'merchantUrl':_0x1e46af['shopUrl'],'merchantUrl2':_0x1e46af['shopUrl2'],'merchantUrl3':_0x1e46af[_0x3c4f2a(0x1dc)],'merchantUrl4':_0x1e46af[_0x3c4f2a(0xde)],'gateways':_0x1e46af['paymentGateways']?JSON[_0x3c4f2a(0x166)](_0x1e46af[_0x3c4f2a(0x1eb)]):null,'gatewaySettings':_0x1e46af[_0x3c4f2a(0xfa)]?JSON[_0x3c4f2a(0x166)](_0x1e46af[_0x3c4f2a(0xfa)]):null,'publicKey':_0x1e46af[_0x3c4f2a(0xff)],'wallets':{'usdtPolygonWallet':_0x1e46af[_0x3c4f2a(0x7c)],'usdtTrcWallet':_0x1e46af['usdtTrcWallet'],'usdtErcWallet':_0x1e46af[_0x3c4f2a(0x19f)],'usdcPolygonWallet':_0x1e46af[_0x3c4f2a(0x11a)]},'status':_0x1e46af[_0x3c4f2a(0x240)],'createdAt':_0x1e46af['createdAt']};}async['suspendUser'](_0x5cbb6e){const _0x40f67e=a53_0xc54d14,_0x583c71=await database_1[_0x40f67e(0x207)]['shop'][_0x40f67e(0x1ac)]({'where':{'id':_0x5cbb6e},'data':{'status':_0x40f67e(0x1f8)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'shopUrl2':!![],'shopUrl3':!![],'shopUrl4':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x583c71['id'],'fullName':_0x583c71[_0x40f67e(0x217)],'username':_0x583c71['username'],'telegramId':_0x583c71[_0x40f67e(0xaf)],'merchantUrl':_0x583c71['shopUrl'],'merchantUrl2':_0x583c71['shopUrl2'],'merchantUrl3':_0x583c71[_0x40f67e(0x1dc)],'merchantUrl4':_0x583c71['shopUrl4'],'gateways':_0x583c71['paymentGateways']?JSON['parse'](_0x583c71['paymentGateways']):null,'gatewaySettings':_0x583c71[_0x40f67e(0xfa)]?JSON[_0x40f67e(0x166)](_0x583c71[_0x40f67e(0xfa)]):null,'publicKey':_0x583c71['publicKey'],'wallets':{'usdtPolygonWallet':_0x583c71[_0x40f67e(0x7c)],'usdtTrcWallet':_0x583c71['usdtTrcWallet'],'usdtErcWallet':_0x583c71[_0x40f67e(0x19f)],'usdcPolygonWallet':_0x583c71[_0x40f67e(0x11a)]},'status':_0x583c71[_0x40f67e(0x240)],'createdAt':_0x583c71[_0x40f67e(0x23c)]};}async[a53_0xc54d14(0x162)](_0x1556d1){const _0x4600b1=a53_0xc54d14,_0x50afdd=await database_1[_0x4600b1(0x207)][_0x4600b1(0x98)]['update']({'where':{'id':_0x1556d1},'data':{'status':_0x4600b1(0x171)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'shopUrl2':!![],'shopUrl3':!![],'shopUrl4':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x50afdd['id'],'fullName':_0x50afdd['name'],'username':_0x50afdd[_0x4600b1(0x197)],'telegramId':_0x50afdd[_0x4600b1(0xaf)],'merchantUrl':_0x50afdd[_0x4600b1(0x10f)],'merchantUrl2':_0x50afdd['shopUrl2'],'merchantUrl3':_0x50afdd[_0x4600b1(0x1dc)],'merchantUrl4':_0x50afdd[_0x4600b1(0xde)],'gateways':_0x50afdd[_0x4600b1(0x1eb)]?JSON['parse'](_0x50afdd['paymentGateways']):null,'gatewaySettings':_0x50afdd[_0x4600b1(0xfa)]?JSON[_0x4600b1(0x166)](_0x50afdd[_0x4600b1(0xfa)]):null,'publicKey':_0x50afdd[_0x4600b1(0xff)],'wallets':{'usdtPolygonWallet':_0x50afdd[_0x4600b1(0x7c)],'usdtTrcWallet':_0x50afdd['usdtTrcWallet'],'usdtErcWallet':_0x50afdd['usdtErcWallet'],'usdcPolygonWallet':_0x50afdd[_0x4600b1(0x11a)]},'status':_0x50afdd[_0x4600b1(0x240)],'createdAt':_0x50afdd[_0x4600b1(0x23c)]};}async[a53_0xc54d14(0x1f4)](_0x4df235){const _0x6e7728=a53_0xc54d14,{page:_0x286d27,limit:_0x2e1ee9,status:_0x8eab75,search:_0x1950d6}=_0x4df235,_0x2a5f16=(_0x286d27-0x1)*_0x2e1ee9,_0x39e616={};_0x8eab75&&(_0x39e616[_0x6e7728(0x240)]=_0x8eab75[_0x6e7728(0x15a)]());_0x1950d6&&(_0x39e616['OR']=[{'name':{'contains':_0x1950d6,'mode':_0x6e7728(0x11b)}},{'username':{'contains':_0x1950d6,'mode':_0x6e7728(0x11b)}},{'telegram':{'contains':_0x1950d6,'mode':'insensitive'}},{'shopUrl':{'contains':_0x1950d6,'mode':_0x6e7728(0x11b)}}]);const [_0x1abdb6,_0x42da53]=await Promise[_0x6e7728(0xb6)]([database_1['default'][_0x6e7728(0x98)][_0x6e7728(0x10e)]({'where':_0x39e616,'skip':_0x2a5f16,'take':_0x2e1ee9,'orderBy':{'createdAt':_0x6e7728(0x1d0)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'shopUrl2':!![],'shopUrl3':!![],'shopUrl4':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'twoFactorEnabled':!![],'createdAt':!![],'lastLoginAt':!![],'_count':{'select':{'telegramUsers':!![]}}}}),database_1[_0x6e7728(0x207)][_0x6e7728(0x98)][_0x6e7728(0x1b1)]({'where':_0x39e616})]);return{'users':_0x1abdb6[_0x6e7728(0x6b)](_0x5214a7=>{const _0x4a652d=_0x6e7728,_0x5e75dc=_0x5214a7[_0x4a652d(0x1eb)]?JSON[_0x4a652d(0x166)](_0x5214a7[_0x4a652d(0x1eb)]):null,_0x3eedc9=_0x5e75dc?_0x5e75dc[_0x4a652d(0x6b)](_0x595992=>this[_0x4a652d(0x1fc)](_0x595992)):null;return{'id':_0x5214a7['id'],'fullName':_0x5214a7[_0x4a652d(0x217)],'username':_0x5214a7[_0x4a652d(0x197)],'telegramId':_0x5214a7[_0x4a652d(0xaf)],'merchantUrl':_0x5214a7[_0x4a652d(0x10f)],'merchantUrl2':_0x5214a7['shopUrl2'],'merchantUrl3':_0x5214a7['shopUrl3'],'merchantUrl4':_0x5214a7[_0x4a652d(0xde)],'gateways':_0x3eedc9,'gatewaySettings':_0x5214a7[_0x4a652d(0xfa)]?JSON[_0x4a652d(0x166)](_0x5214a7[_0x4a652d(0xfa)]):null,'publicKey':_0x5214a7[_0x4a652d(0xff)],'wallets':{'usdtPolygonWallet':_0x5214a7[_0x4a652d(0x7c)],'usdtTrcWallet':_0x5214a7[_0x4a652d(0x144)],'usdtErcWallet':_0x5214a7[_0x4a652d(0x19f)],'usdcPolygonWallet':_0x5214a7[_0x4a652d(0x11a)],'usdcErcWallet':_0x5214a7[_0x4a652d(0x17c)]},'status':_0x5214a7[_0x4a652d(0x240)],'twoFactorEnabled':_0x5214a7[_0x4a652d(0x215)]||![],'telegramUsersCount':_0x5214a7[_0x4a652d(0xbb)][_0x4a652d(0x120)],'createdAt':_0x5214a7[_0x4a652d(0x23c)],'lastLoginAt':_0x5214a7['lastLoginAt']};}),'pagination':{'page':_0x286d27,'limit':_0x2e1ee9,'total':_0x42da53,'totalPages':Math[_0x6e7728(0x226)](_0x42da53/_0x2e1ee9)}};}async['getUserById'](_0x2fc593){const _0x3ef172=a53_0xc54d14,_0x268913=await database_1['default'][_0x3ef172(0x98)]['findUnique']({'where':{'id':_0x2fc593},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'shopUrl2':!![],'shopUrl3':!![],'shopUrl4':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x268913)return null;const _0x5e0d97=_0x268913[_0x3ef172(0x1eb)]?JSON[_0x3ef172(0x166)](_0x268913['paymentGateways']):null,_0x8351b8=_0x5e0d97?_0x5e0d97['map'](_0x481054=>this['getGatewayDisplayName'](_0x481054)):null;return _0x5e0d97&&_0x8351b8&&console[_0x3ef172(0xa8)](_0x3ef172(0x1cd),_0x5e0d97,'->',_0x8351b8),{'id':_0x268913['id'],'fullName':_0x268913['name'],'username':_0x268913['username'],'telegramId':_0x268913[_0x3ef172(0xaf)],'merchantUrl':_0x268913[_0x3ef172(0x10f)],'merchantUrl2':_0x268913['shopUrl2'],'merchantUrl3':_0x268913[_0x3ef172(0x1dc)],'merchantUrl4':_0x268913[_0x3ef172(0xde)],'gateways':_0x8351b8,'gatewaySettings':_0x268913[_0x3ef172(0xfa)]?JSON[_0x3ef172(0x166)](_0x268913[_0x3ef172(0xfa)]):null,'publicKey':_0x268913[_0x3ef172(0xff)],'wallets':{'usdtPolygonWallet':_0x268913[_0x3ef172(0x7c)],'usdtTrcWallet':_0x268913['usdtTrcWallet'],'usdtErcWallet':_0x268913['usdtErcWallet'],'usdcPolygonWallet':_0x268913[_0x3ef172(0x11a)],'usdcErcWallet':_0x268913[_0x3ef172(0x17c)]},'status':_0x268913[_0x3ef172(0x240)],'createdAt':_0x268913['createdAt']};}async[a53_0xc54d14(0x1d1)](_0x3be90b){const _0x5cec19=a53_0xc54d14,{fullName:_0x18bf58,username:_0x59048e,password:_0x57645f,telegramId:_0x38bc9a,merchantUrl:_0x33335e,gateways:_0xac8aa9,gatewaySettings:_0xc59caa,wallets:_0x4f6d3c}=_0x3be90b,_0x4f0170=await database_1[_0x5cec19(0x207)][_0x5cec19(0x98)]['findUnique']({'where':{'username':_0x59048e}});if(_0x4f0170)throw new Error(_0x5cec19(0x230));if(_0x38bc9a){const _0x182afb=await database_1[_0x5cec19(0x207)][_0x5cec19(0x98)][_0x5cec19(0xa9)]({'where':{'telegram':_0x38bc9a}});if(_0x182afb)throw new Error(_0x5cec19(0xe1));}const _0x28dabb=await bcryptjs_1['default']['hash'](_0x57645f,0xc),_0x50c05c=_0x5cec19(0xb5)+crypto_1[_0x5cec19(0x207)]['randomBytes'](0x20)[_0x5cec19(0xb1)](_0x5cec19(0x172)),_0x1156df=_0x5cec19(0x1b2)+crypto_1['default']['randomBytes'](0x20)[_0x5cec19(0xb1)](_0x5cec19(0x172)),_0x24cea3=_0xac8aa9?_0xac8aa9[_0x5cec19(0x6b)](_0x3c8dae=>this[_0x5cec19(0x22d)](_0x3c8dae)):null;_0xac8aa9&&_0x24cea3&&console[_0x5cec19(0xa8)]('ðŸ”„\x20Gateway\x20mapping\x20(create):',_0xac8aa9,'->',_0x24cea3);const _0x44efd5=await database_1[_0x5cec19(0x207)][_0x5cec19(0x98)]['create']({'data':{'name':_0x18bf58,'username':_0x59048e,'password':_0x28dabb,'telegram':_0x38bc9a,'shopUrl':_0x33335e,'shopUrl2':_0x3be90b[_0x5cec19(0x237)]||null,'shopUrl3':_0x3be90b[_0x5cec19(0xa0)]||null,'shopUrl4':_0x3be90b[_0x5cec19(0x141)]||null,'paymentGateways':_0x24cea3?JSON['stringify'](_0x24cea3):null,'gatewaySettings':_0xc59caa?JSON[_0x5cec19(0x96)](_0xc59caa):null,'usdtPolygonWallet':_0x4f6d3c?.[_0x5cec19(0x7c)]||null,'usdtTrcWallet':_0x4f6d3c?.['usdtTrcWallet']||null,'usdtErcWallet':_0x4f6d3c?.[_0x5cec19(0x19f)]||null,'usdcPolygonWallet':_0x4f6d3c?.[_0x5cec19(0x11a)]||null,'publicKey':_0x50c05c,'secretKey':_0x1156df,'status':_0x5cec19(0x171)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'shopUrl2':!![],'shopUrl3':!![],'shopUrl4':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x44efd5['id'],'fullName':_0x44efd5[_0x5cec19(0x217)],'username':_0x44efd5['username'],'telegramId':_0x44efd5[_0x5cec19(0xaf)],'merchantUrl':_0x44efd5['shopUrl'],'merchantUrl2':_0x44efd5[_0x5cec19(0x16d)],'merchantUrl3':_0x44efd5['shopUrl3'],'merchantUrl4':_0x44efd5['shopUrl4'],'gateways':_0x44efd5[_0x5cec19(0x1eb)]?JSON[_0x5cec19(0x166)](_0x44efd5[_0x5cec19(0x1eb)]):null,'gatewaySettings':_0x44efd5[_0x5cec19(0xfa)]?JSON[_0x5cec19(0x166)](_0x44efd5[_0x5cec19(0xfa)]):null,'publicKey':_0x44efd5['publicKey'],'wallets':{'usdtPolygonWallet':_0x44efd5[_0x5cec19(0x7c)],'usdtTrcWallet':_0x44efd5[_0x5cec19(0x144)],'usdtErcWallet':_0x44efd5[_0x5cec19(0x19f)],'usdcPolygonWallet':_0x44efd5['usdcPolygonWallet']},'status':_0x44efd5[_0x5cec19(0x240)],'createdAt':_0x44efd5[_0x5cec19(0x23c)]};}async['deleteUser'](_0x1aa0f6,_0x318528){const _0x51c132=a53_0xc54d14;if(config_1[_0x51c132(0x18a)][_0x51c132(0x1ca)][_0x51c132(0x215)]){if(!_0x318528)throw new Error(_0x51c132(0x1ea));const _0x397419=speakeasy_1['default']['totp'][_0x51c132(0xe2)]({'secret':config_1[_0x51c132(0x18a)][_0x51c132(0x1ca)]['twoFactorSecret'],'encoding':_0x51c132(0x165),'token':_0x318528,'window':0x2});if(!_0x397419){let _0x54ab36=![];if(config_1[_0x51c132(0x18a)][_0x51c132(0x1ca)]['backupCodes']){const _0x3e83fa=JSON[_0x51c132(0x166)](config_1[_0x51c132(0x18a)][_0x51c132(0x1ca)]['backupCodes']);for(let _0x103f8d=0x0;_0x103f8d<_0x3e83fa[_0x51c132(0x1c8)];_0x103f8d++){const _0x4f2d7f=await bcryptjs_1[_0x51c132(0x207)]['compare'](_0x318528,_0x3e83fa[_0x103f8d]);if(_0x4f2d7f){_0x54ab36=!![],_0x3e83fa[_0x51c132(0x174)](_0x103f8d,0x1),config_1[_0x51c132(0x18a)][_0x51c132(0x1ca)][_0x51c132(0x13e)]=JSON[_0x51c132(0x96)](_0x3e83fa);const _0x278294=path_1['default'][_0x51c132(0x137)](process[_0x51c132(0x20e)](),_0x51c132(0x103));if(fs_1[_0x51c132(0x207)][_0x51c132(0xc8)](_0x278294)){let _0x5a9119=fs_1[_0x51c132(0x207)]['readFileSync'](_0x278294,_0x51c132(0x6e));const _0xd50308=_0x5a9119[_0x51c132(0x1e7)]('\x0a');for(let _0x1b3185=0x0;_0x1b3185<_0xd50308[_0x51c132(0x1c8)];_0x1b3185++){if(_0xd50308[_0x1b3185]['startsWith']('ADMIN_BACKUP_CODES=')){_0xd50308[_0x1b3185]='ADMIN_BACKUP_CODES='+JSON['stringify'](_0x3e83fa);break;}}fs_1['default'][_0x51c132(0x68)](_0x278294,_0xd50308[_0x51c132(0x137)]('\x0a'),_0x51c132(0x6e));}break;}}}if(!_0x54ab36)throw new Error(_0x51c132(0x22a));}}await database_1['default'][_0x51c132(0x98)][_0x51c132(0x204)]({'where':{'id':_0x1aa0f6}});}async[a53_0xc54d14(0x1be)](_0x45697e){const _0x2596e1=a53_0xc54d14,_0x2c6f78=await database_1['default'][_0x2596e1(0x98)][_0x2596e1(0xa9)]({'where':{'id':_0x45697e},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});if(!_0x2c6f78)throw new Error(_0x2596e1(0x21a));return{'usdtPolygonWallet':_0x2c6f78[_0x2596e1(0x7c)],'usdtTrcWallet':_0x2c6f78['usdtTrcWallet'],'usdtErcWallet':_0x2c6f78[_0x2596e1(0x19f)],'usdcPolygonWallet':_0x2c6f78[_0x2596e1(0x11a)],'usdcErcWallet':_0x2c6f78['usdcErcWallet']};}[a53_0xc54d14(0x74)](_0x552967=0x8){const _0x2de6c5=a53_0xc54d14,_0x18529c=[];for(let _0x41e4a6=0x0;_0x41e4a6<_0x552967;_0x41e4a6++){const _0x4bc5de=crypto_1[_0x2de6c5(0x207)][_0x2de6c5(0x95)](0x4)[_0x2de6c5(0xb1)](_0x2de6c5(0x172))['toUpperCase']();_0x18529c['push'](_0x4bc5de);}return _0x18529c;}async[a53_0xc54d14(0xdf)](_0xfbe6c2){const _0xc43f69=a53_0xc54d14,_0x2182f0=await database_1[_0xc43f69(0x207)][_0xc43f69(0x98)][_0xc43f69(0xa9)]({'where':{'id':_0xfbe6c2},'select':{'id':!![],'name':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x2182f0)throw new Error(_0xc43f69(0x21a));const _0x347d72=speakeasy_1[_0xc43f69(0x207)][_0xc43f69(0x71)]({'name':'TrapaPay\x20('+_0x2182f0['username']+')','issuer':_0xc43f69(0x6c),'length':0x20}),_0x15d829=await qrcode_1[_0xc43f69(0x207)][_0xc43f69(0x1d5)](_0x347d72[_0xc43f69(0x15e)]),_0x117871=this['generateBackupCodes'](0x8),_0x154382=await Promise['all'](_0x117871[_0xc43f69(0x6b)](_0x3e617=>bcryptjs_1['default'][_0xc43f69(0x16b)](_0x3e617,0xa)));return await database_1['default']['shop']['update']({'where':{'id':_0xfbe6c2},'data':{'twoFactorSecret':_0x347d72['base32'],'backupCodes':JSON[_0xc43f69(0x96)](_0x154382)}}),console[_0xc43f69(0xa8)]('ðŸ”\x202FA\x20setup\x20initiated\x20for\x20shop:\x20'+_0x2182f0[_0xc43f69(0x197)]),console[_0xc43f69(0xa8)](_0xc43f69(0xcb)+_0x117871['length']+_0xc43f69(0xb0)),{'secret':_0x347d72['base32'],'qrCode':_0x15d829,'manualEntryKey':_0x347d72[_0xc43f69(0x165)],'backupCodes':_0x117871};}async[a53_0xc54d14(0x22e)](_0x46e29c,_0x566e2c){const _0x5d30c6=a53_0xc54d14,_0x51d2c2=await database_1[_0x5d30c6(0x207)][_0x5d30c6(0x98)][_0x5d30c6(0xa9)]({'where':{'id':_0x46e29c},'select':{'id':!![],'username':!![],'twoFactorSecret':!![],'twoFactorEnabled':!![]}});if(!_0x51d2c2)throw new Error(_0x5d30c6(0x21a));if(!_0x51d2c2[_0x5d30c6(0x108)])throw new Error('2FA\x20not\x20set\x20up.\x20Please\x20call\x20setup\x20endpoint\x20first');if(_0x51d2c2[_0x5d30c6(0x215)])throw new Error(_0x5d30c6(0x1ad));const _0xd278c4=speakeasy_1[_0x5d30c6(0x207)][_0x5d30c6(0x23b)][_0x5d30c6(0xe2)]({'secret':_0x51d2c2[_0x5d30c6(0x108)],'encoding':_0x5d30c6(0x165),'token':_0x566e2c,'window':0x2});if(!_0xd278c4)throw new Error('Invalid\x202FA\x20token');return await database_1[_0x5d30c6(0x207)][_0x5d30c6(0x98)]['update']({'where':{'id':_0x46e29c},'data':{'twoFactorEnabled':!![]}}),console[_0x5d30c6(0xa8)](_0x5d30c6(0x109)+_0x51d2c2[_0x5d30c6(0x197)]),{'enabled':!![]};}async[a53_0xc54d14(0xd2)](_0x1d17e1){const _0x3e9622=a53_0xc54d14,_0x47012a=await database_1['default'][_0x3e9622(0x98)]['findUnique']({'where':{'id':_0x1d17e1},'select':{'id':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x47012a)throw new Error(_0x3e9622(0x21a));await database_1[_0x3e9622(0x207)][_0x3e9622(0x98)][_0x3e9622(0x1ac)]({'where':{'id':_0x1d17e1},'data':{'twoFactorEnabled':![],'twoFactorSecret':null,'backupCodes':null}}),console[_0x3e9622(0xa8)](_0x3e9622(0x1a1)+_0x47012a['username']);}async['changeAdminPassword'](_0x58787c,_0x6d50a2,_0x1e5dfa,_0x1a00e1){const _0x57e205=a53_0xc54d14;if(_0x6d50a2!==_0x1e5dfa)throw new Error(_0x57e205(0x1df));if(_0x6d50a2[_0x57e205(0x1c8)]<0x6)throw new Error(_0x57e205(0x16e));const _0x5355ef=await bcryptjs_1[_0x57e205(0x207)]['compare'](_0x58787c,config_1[_0x57e205(0x18a)]['admin'][_0x57e205(0xeb)]);if(!_0x5355ef)throw new Error(_0x57e205(0x208));if(config_1[_0x57e205(0x18a)][_0x57e205(0x1ca)][_0x57e205(0x215)]){if(!_0x1a00e1)throw new Error(_0x57e205(0x1ea));const _0x4a2def=speakeasy_1[_0x57e205(0x207)][_0x57e205(0x23b)][_0x57e205(0xe2)]({'secret':config_1[_0x57e205(0x18a)]['admin'][_0x57e205(0x108)],'encoding':_0x57e205(0x165),'token':_0x1a00e1,'window':0x2});if(!_0x4a2def){let _0x3f7b04=![];if(config_1['config'][_0x57e205(0x1ca)]['backupCodes']){const _0x5db769=JSON[_0x57e205(0x166)](config_1[_0x57e205(0x18a)][_0x57e205(0x1ca)]['backupCodes']);for(let _0x923955=0x0;_0x923955<_0x5db769[_0x57e205(0x1c8)];_0x923955++){const _0x5b0be9=await bcryptjs_1[_0x57e205(0x207)]['compare'](_0x1a00e1,_0x5db769[_0x923955]);if(_0x5b0be9){_0x3f7b04=!![],_0x5db769['splice'](_0x923955,0x1),config_1['config'][_0x57e205(0x1ca)][_0x57e205(0x13e)]=JSON[_0x57e205(0x96)](_0x5db769);const _0x4fe45c=path_1['default'][_0x57e205(0x137)](process[_0x57e205(0x20e)](),_0x57e205(0x103));if(fs_1[_0x57e205(0x207)][_0x57e205(0xc8)](_0x4fe45c)){let _0x3e221f=fs_1[_0x57e205(0x207)][_0x57e205(0x80)](_0x4fe45c,_0x57e205(0x6e));const _0xde1ee8=_0x3e221f[_0x57e205(0x1e7)]('\x0a');for(let _0x2effe3=0x0;_0x2effe3<_0xde1ee8[_0x57e205(0x1c8)];_0x2effe3++){if(_0xde1ee8[_0x2effe3][_0x57e205(0x158)](_0x57e205(0x1e0))){_0xde1ee8[_0x2effe3]='ADMIN_BACKUP_CODES='+JSON['stringify'](_0x5db769);break;}}fs_1['default'][_0x57e205(0x68)](_0x4fe45c,_0xde1ee8[_0x57e205(0x137)]('\x0a'),_0x57e205(0x6e));}break;}}}if(!_0x3f7b04)throw new Error(_0x57e205(0x22a));}}const _0x1f2e34=await bcryptjs_1[_0x57e205(0x207)][_0x57e205(0x16b)](_0x6d50a2,0xc);config_1[_0x57e205(0x18a)][_0x57e205(0x1ca)]['passwordHash']=_0x1f2e34;const _0x2c2ff3=path_1[_0x57e205(0x207)]['join'](process[_0x57e205(0x20e)](),_0x57e205(0x103));let _0x470dd7='';if(fs_1[_0x57e205(0x207)][_0x57e205(0xc8)](_0x2c2ff3)){_0x470dd7=fs_1[_0x57e205(0x207)][_0x57e205(0x80)](_0x2c2ff3,'utf8');const _0x1cd399=_0x470dd7[_0x57e205(0x1e7)]('\x0a');let _0x1e5a80=![];for(let _0x1fef44=0x0;_0x1fef44<_0x1cd399[_0x57e205(0x1c8)];_0x1fef44++){if(_0x1cd399[_0x1fef44][_0x57e205(0x158)](_0x57e205(0x21b))){_0x1cd399[_0x1fef44]=_0x57e205(0x21b)+_0x1f2e34,_0x1e5a80=!![];break;}}!_0x1e5a80&&_0x1cd399[_0x57e205(0x159)](_0x57e205(0x21b)+_0x1f2e34),_0x470dd7=_0x1cd399['join']('\x0a'),fs_1['default'][_0x57e205(0x68)](_0x2c2ff3,_0x470dd7,_0x57e205(0x6e));}console['log'](_0x57e205(0xae));}async['get2FASettings'](){const _0x47d701=a53_0xc54d14;let _0x3a30ca=0x0;if(config_1[_0x47d701(0x18a)][_0x47d701(0x1ca)][_0x47d701(0x13e)])try{const _0x2c3ba3=JSON[_0x47d701(0x166)](config_1[_0x47d701(0x18a)][_0x47d701(0x1ca)][_0x47d701(0x13e)]);_0x3a30ca=_0x2c3ba3[_0x47d701(0x1c8)];}catch(_0x47f17e){console[_0x47d701(0xf0)]('Error\x20parsing\x20backup\x20codes:',_0x47f17e);}return{'twoFactorEnabled':config_1[_0x47d701(0x18a)][_0x47d701(0x1ca)][_0x47d701(0x215)],'backupCodesCount':_0x3a30ca};}async[a53_0xc54d14(0xdd)](){const _0x634507=a53_0xc54d14,_0x4b9e3a=speakeasy_1[_0x634507(0x207)][_0x634507(0x71)]({'name':_0x634507(0x19c)+config_1['config'][_0x634507(0x1ca)][_0x634507(0x197)]+')','issuer':_0x634507(0x218),'length':0x20}),_0x452ddb=await qrcode_1[_0x634507(0x207)][_0x634507(0x1d5)](_0x4b9e3a[_0x634507(0x15e)]),_0x167c4c=[];for(let _0x2535fe=0x0;_0x2535fe<0x8;_0x2535fe++){const _0xab5ad2=crypto_1[_0x634507(0x207)][_0x634507(0x95)](0x4)['toString'](_0x634507(0x172))[_0x634507(0x15a)]();_0x167c4c[_0x634507(0x159)](_0xab5ad2);}const _0x28d59f=await Promise[_0x634507(0xb6)](_0x167c4c[_0x634507(0x6b)](_0x326880=>bcryptjs_1[_0x634507(0x207)]['hash'](_0x326880,0xa)));config_1[_0x634507(0x18a)][_0x634507(0x1ca)][_0x634507(0x108)]=_0x4b9e3a[_0x634507(0x165)],config_1[_0x634507(0x18a)][_0x634507(0x1ca)][_0x634507(0x13e)]=JSON[_0x634507(0x96)](_0x28d59f);const _0x4d72b5=path_1[_0x634507(0x207)][_0x634507(0x137)](process['cwd'](),_0x634507(0x103));if(fs_1[_0x634507(0x207)]['existsSync'](_0x4d72b5)){let _0x5da002=fs_1[_0x634507(0x207)][_0x634507(0x80)](_0x4d72b5,_0x634507(0x6e));const _0x4f749c=_0x5da002['split']('\x0a');let _0x2d15a7=![],_0x7b6bdb=![];for(let _0x277c7b=0x0;_0x277c7b<_0x4f749c[_0x634507(0x1c8)];_0x277c7b++){_0x4f749c[_0x277c7b][_0x634507(0x158)](_0x634507(0x198))&&(_0x4f749c[_0x277c7b]='ADMIN_2FA_SECRET='+_0x4b9e3a['base32'],_0x2d15a7=!![]),_0x4f749c[_0x277c7b][_0x634507(0x158)](_0x634507(0x1e0))&&(_0x4f749c[_0x277c7b]=_0x634507(0x1e0)+JSON[_0x634507(0x96)](_0x28d59f),_0x7b6bdb=!![]);}if(!_0x2d15a7)_0x4f749c[_0x634507(0x159)](_0x634507(0x198)+_0x4b9e3a[_0x634507(0x165)]);if(!_0x7b6bdb)_0x4f749c[_0x634507(0x159)](_0x634507(0x1e0)+JSON[_0x634507(0x96)](_0x28d59f));fs_1[_0x634507(0x207)][_0x634507(0x68)](_0x4d72b5,_0x4f749c[_0x634507(0x137)]('\x0a'),_0x634507(0x6e));}return console[_0x634507(0xa8)]('ðŸ”\x20Admin\x202FA\x20setup\x20initiated'),console[_0x634507(0xa8)](_0x634507(0xcb)+_0x167c4c[_0x634507(0x1c8)]+_0x634507(0xb0)),{'secret':_0x4b9e3a[_0x634507(0x165)],'qrCode':_0x452ddb,'manualEntryKey':_0x4b9e3a[_0x634507(0x165)],'backupCodes':_0x167c4c};}async['enableAdmin2FA'](_0x2017d2){const _0x20f2cf=a53_0xc54d14;if(!config_1[_0x20f2cf(0x18a)]['admin']['twoFactorSecret'])throw new Error('2FA\x20not\x20set\x20up.\x20Please\x20call\x20setup\x20endpoint\x20first');if(config_1[_0x20f2cf(0x18a)][_0x20f2cf(0x1ca)][_0x20f2cf(0x215)])throw new Error('2FA\x20is\x20already\x20enabled');const _0xdb084b=speakeasy_1['default'][_0x20f2cf(0x23b)][_0x20f2cf(0xe2)]({'secret':config_1[_0x20f2cf(0x18a)][_0x20f2cf(0x1ca)][_0x20f2cf(0x108)],'encoding':_0x20f2cf(0x165),'token':_0x2017d2,'window':0x2});if(!_0xdb084b)throw new Error('Invalid\x202FA\x20token');config_1['config'][_0x20f2cf(0x1ca)][_0x20f2cf(0x215)]=!![];const _0x4898fa=path_1['default'][_0x20f2cf(0x137)](process['cwd'](),'.env');if(fs_1[_0x20f2cf(0x207)]['existsSync'](_0x4898fa)){let _0x59f33b=fs_1[_0x20f2cf(0x207)][_0x20f2cf(0x80)](_0x4898fa,_0x20f2cf(0x6e));const _0x494d1b=_0x59f33b[_0x20f2cf(0x1e7)]('\x0a');let _0x5317cb=![];for(let _0x3c4cd6=0x0;_0x3c4cd6<_0x494d1b[_0x20f2cf(0x1c8)];_0x3c4cd6++){if(_0x494d1b[_0x3c4cd6][_0x20f2cf(0x158)](_0x20f2cf(0x191))){_0x494d1b[_0x3c4cd6]=_0x20f2cf(0x145),_0x5317cb=!![];break;}}if(!_0x5317cb)_0x494d1b[_0x20f2cf(0x159)]('ADMIN_2FA_ENABLED=true');fs_1['default'][_0x20f2cf(0x68)](_0x4898fa,_0x494d1b[_0x20f2cf(0x137)]('\x0a'),'utf8');}return console[_0x20f2cf(0xa8)](_0x20f2cf(0x202)),{'enabled':!![]};}async[a53_0xc54d14(0xa3)](){const _0x1c5a29=a53_0xc54d14;config_1[_0x1c5a29(0x18a)][_0x1c5a29(0x1ca)][_0x1c5a29(0x215)]=![],config_1['config'][_0x1c5a29(0x1ca)][_0x1c5a29(0x108)]='',config_1[_0x1c5a29(0x18a)][_0x1c5a29(0x1ca)][_0x1c5a29(0x13e)]='';const _0xa367a3=path_1[_0x1c5a29(0x207)][_0x1c5a29(0x137)](process[_0x1c5a29(0x20e)](),_0x1c5a29(0x103));if(fs_1[_0x1c5a29(0x207)]['existsSync'](_0xa367a3)){let _0x2b771b=fs_1[_0x1c5a29(0x207)]['readFileSync'](_0xa367a3,_0x1c5a29(0x6e));const _0xe6d0d8=_0x2b771b[_0x1c5a29(0x1e7)]('\x0a');for(let _0x3b7246=0x0;_0x3b7246<_0xe6d0d8[_0x1c5a29(0x1c8)];_0x3b7246++){_0xe6d0d8[_0x3b7246]['startsWith']('ADMIN_2FA_ENABLED=')&&(_0xe6d0d8[_0x3b7246]=_0x1c5a29(0x214)),_0xe6d0d8[_0x3b7246][_0x1c5a29(0x158)](_0x1c5a29(0x198))&&(_0xe6d0d8[_0x3b7246]=_0x1c5a29(0x198)),_0xe6d0d8[_0x3b7246]['startsWith'](_0x1c5a29(0x1e0))&&(_0xe6d0d8[_0x3b7246]=_0x1c5a29(0x1e0));}fs_1['default'][_0x1c5a29(0x68)](_0xa367a3,_0xe6d0d8[_0x1c5a29(0x137)]('\x0a'),_0x1c5a29(0x6e));}console['log'](_0x1c5a29(0x23f));}[a53_0xc54d14(0x163)](_0x4c7282,_0x23ac42,_0x42ceab){const _0x4dfe9f=a53_0xc54d14,_0x5c4a1d=new Map(),_0x3e8e0d=new Date(_0x23ac42);while(_0x3e8e0d<=_0x42ceab){const _0x288144=_0x3e8e0d['toISOString']()[_0x4dfe9f(0x1e7)]('T')[0x0];_0x5c4a1d['set'](_0x288144,{'revenue':0x0,'count':0x0}),_0x3e8e0d[_0x4dfe9f(0x1d9)](_0x3e8e0d[_0x4dfe9f(0x18e)]()+0x1);}for(const _0x28a725 of _0x4c7282){const _0x28b64d=_0x28a725[_0x4dfe9f(0x23c)][_0x4dfe9f(0x76)]()[_0x4dfe9f(0x1e7)]('T')[0x0],_0x3926ee=_0x5c4a1d[_0x4dfe9f(0x199)](_0x28b64d);_0x3926ee&&(_0x3926ee[_0x4dfe9f(0x1b1)]+=0x1,_0x28a725[_0x4dfe9f(0x240)]===_0x4dfe9f(0x23e)&&(_0x28a725[_0x4dfe9f(0x93)]?_0x3926ee[_0x4dfe9f(0x219)]+=_0x28a725['amountUSDT']:console[_0x4dfe9f(0xa8)](_0x4dfe9f(0x1b8)+_0x28a725['id']+'\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion')));}const _0x367280=[],_0x55e4f6=[];for(const [_0x447ea7,_0x319271]of _0x5c4a1d){_0x367280['push']({'date':_0x447ea7,'amount':Math[_0x4dfe9f(0x11d)](_0x319271['revenue']*0x64)/0x64}),_0x55e4f6[_0x4dfe9f(0x159)]({'date':_0x447ea7,'count':_0x319271['count']});}return{'dailyRevenue':_0x367280,'dailyPayments':_0x55e4f6};}async[a53_0xc54d14(0x15c)](_0x356275){const _0x216755=a53_0xc54d14;console[_0x216755(0xa8)](_0x216755(0x1c1),_0x356275);const _0x4b6897=new Date(_0x356275[_0x216755(0x175)]),_0x2c0566=new Date(_0x356275[_0x216755(0xa7)]),_0x2f9a03=new Date(Date[_0x216755(0x160)](_0x4b6897['getUTCFullYear'](),_0x4b6897[_0x216755(0x1a6)](),_0x4b6897[_0x216755(0x243)](),0x0,0x0,0x0,0x0)),_0x153f74=new Date(Date[_0x216755(0x160)](_0x2c0566['getUTCFullYear'](),_0x2c0566['getUTCMonth'](),_0x2c0566[_0x216755(0x243)](),0x17,0x3b,0x3b,0x3e7));console[_0x216755(0xa8)](_0x216755(0x12f)+_0x2f9a03['toISOString']()+_0x216755(0xa1)+_0x153f74[_0x216755(0x76)]()),console['log'](_0x216755(0x1ec)+_0x356275['gateway']);const _0xeab97c=await database_1['default'][_0x216755(0x133)][_0x216755(0x10e)]({'where':{'status':_0x216755(0x23e),'gateway':_0x356275[_0x216755(0x6f)]['toLowerCase'](),'createdAt':{'gte':_0x2f9a03,'lte':_0x153f74}},'select':{'id':!![],'shopId':!![],'amountAfterGatewayCommissionUSDT':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console[_0x216755(0xa8)]('ðŸ’°\x20Found\x20'+_0xeab97c[_0x216755(0x1c8)]+_0x216755(0xf3)+_0x356275[_0x216755(0x6f)]);const _0x17a238=new Map();for(const _0x5040dc of _0xeab97c){const _0x2e43bc=_0x5040dc['amountAfterGatewayCommissionUSDT']||0x0;if(_0x2e43bc<=0x0){console[_0x216755(0xb9)](_0x216755(0x1b8)+_0x5040dc['id']+_0x216755(0x17f));continue;}if(_0x17a238[_0x216755(0xa2)](_0x5040dc[_0x216755(0x1d3)])){const _0x1867d5=_0x17a238[_0x216755(0x199)](_0x5040dc[_0x216755(0x1d3)]);_0x1867d5[_0x216755(0x1ff)]+=_0x2e43bc;}else _0x17a238[_0x216755(0x142)](_0x5040dc[_0x216755(0x1d3)],{'merchantId':_0x5040dc['shop']['id'],'merchantName':_0x5040dc['shop']['name'],'merchantUsername':_0x5040dc[_0x216755(0x98)][_0x216755(0x197)],'totalAmount':_0x2e43bc});}const _0xcd7c28=Array['from'](_0x17a238[_0x216755(0xb7)]())[_0x216755(0x6b)](_0x366528=>({'merchantId':_0x366528[_0x216755(0x153)],'merchantName':_0x366528[_0x216755(0x1e4)],'merchantUsername':_0x366528[_0x216755(0x1c4)],'gateway':_0x356275[_0x216755(0x6f)],'periodFrom':_0x356275[_0x216755(0x175)],'periodTo':_0x356275['periodTo'],'totalAmount':Math[_0x216755(0x11d)](_0x366528[_0x216755(0x1ff)]*0x64)/0x64}));return _0xcd7c28[_0x216755(0x167)]((_0x4478af,_0x4de4c3)=>_0x4de4c3[_0x216755(0x1ff)]-_0x4478af['totalAmount']),console[_0x216755(0xa8)]('ðŸ“Š\x20Generated\x20reports\x20for\x20'+_0xcd7c28['length']+_0x216755(0x94)),_0xcd7c28;}async[a53_0xc54d14(0x1f7)](_0x26c45b,_0x4b3305,_0x4aef79){const _0x4865ec=a53_0xc54d14,_0x57d9f8=await database_1[_0x4865ec(0x207)][_0x4865ec(0x98)][_0x4865ec(0xa9)]({'where':{'id':_0x26c45b}});if(!_0x57d9f8)throw new Error(_0x4865ec(0xf6));await database_1[_0x4865ec(0x207)][_0x4865ec(0x196)](async _0x158fe3=>{const _0x5990a8=_0x4865ec;await _0x158fe3[_0x5990a8(0x133)][_0x5990a8(0x222)]({'data':{'shopId':_0x57d9f8['id'],'amount':_0x4b3305,'amountUSDT':_0x4b3305,'amountAfterGatewayCommissionUSDT':_0x4b3305,'sourceCurrency':_0x5990a8(0x10c),'currency':_0x5990a8(0x10c),'status':_0x5990a8(0x23e),'gateway':_0x5990a8(0x15d),'customerName':_0x57d9f8[_0x5990a8(0x197)],'customerEmail':'@'+_0x57d9f8[_0x5990a8(0xaf)],'paymentMethod':_0x5990a8(0x193),'adminNotes':_0x4aef79||null,'successUrl':'-','failUrl':'-','paidAt':new Date()}}),await _0x158fe3[_0x5990a8(0x98)][_0x5990a8(0x1ac)]({'where':{'id':_0x57d9f8['id']},'data':{'balance':{'increment':_0x4b3305}}});}),console['log'](_0x4865ec(0xed)+_0x4b3305+_0x4865ec(0x13a)+_0x57d9f8[_0x4865ec(0x197)]);}}exports[a53_0xc54d14(0x16c)]=AdminService;