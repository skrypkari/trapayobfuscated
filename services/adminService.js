'use strict';const a46_0x1559bb=a46_0x5412;(function(_0x4e1102,_0x4a6888){const _0x525ae6=a46_0x5412,_0x21aa11=_0x4e1102();while(!![]){try{const _0x258c03=parseInt(_0x525ae6(0x26d))/0x1*(-parseInt(_0x525ae6(0x24e))/0x2)+-parseInt(_0x525ae6(0x196))/0x3+parseInt(_0x525ae6(0x14d))/0x4+parseInt(_0x525ae6(0x1b8))/0x5*(-parseInt(_0x525ae6(0x1c0))/0x6)+parseInt(_0x525ae6(0x271))/0x7*(-parseInt(_0x525ae6(0x11f))/0x8)+parseInt(_0x525ae6(0x128))/0x9*(parseInt(_0x525ae6(0x187))/0xa)+parseInt(_0x525ae6(0x17f))/0xb*(parseInt(_0x525ae6(0x208))/0xc);if(_0x258c03===_0x4a6888)break;else _0x21aa11['push'](_0x21aa11['shift']());}catch(_0x237687){_0x21aa11['push'](_0x21aa11['shift']());}}}(a46_0x1dd8,0x74ecd));var __importDefault=this&&this[a46_0x1559bb(0x1c7)]||function(_0x12831c){const _0x165818=a46_0x1559bb;return _0x12831c&&_0x12831c[_0x165818(0x27e)]?_0x12831c:{'default':_0x12831c};};function a46_0x5412(_0x54e8e5,_0xdc2d22){_0x54e8e5=_0x54e8e5-0x10f;const _0x1dd8dc=a46_0x1dd8();let _0x5412ba=_0x1dd8dc[_0x54e8e5];return _0x5412ba;}Object['defineProperty'](exports,a46_0x1559bb(0x27e),{'value':!![]}),exports[a46_0x1559bb(0x14f)]=void 0x0;const database_1=__importDefault(require('../config/database')),bcryptjs_1=__importDefault(require(a46_0x1559bb(0x26e))),crypto_1=__importDefault(require('crypto')),currencyService_1=require(a46_0x1559bb(0x151)),telegramBotService_1=require(a46_0x1559bb(0x162)),gateway_1=require(a46_0x1559bb(0x1cd));class AdminService{async[a46_0x1559bb(0x256)](){const _0x1082fd=a46_0x1559bb;console[_0x1082fd(0x264)](_0x1082fd(0x118));const _0x437ed4=await database_1[_0x1082fd(0x137)][_0x1082fd(0x21e)][_0x1082fd(0x1ed)]({'_sum':{'balance':!![],'totalPaidOut':!![]}}),_0x39033c=await database_1[_0x1082fd(0x137)][_0x1082fd(0x239)]['count']({'where':{'status':_0x1082fd(0x20a),'gateway':{'not':'test_gateway'}}}),_0x125aab=new Date(),_0x3a018e=new Date(_0x125aab['getFullYear'](),_0x125aab[_0x1082fd(0x19d)](),0x1),_0x1f23f5=new Date(_0x125aab['getFullYear'](),_0x125aab['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x877315=await database_1[_0x1082fd(0x137)][_0x1082fd(0x199)][_0x1082fd(0x1ed)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x3a018e,'lte':_0x1f23f5},'status':_0x1082fd(0x273)}}),_0x14a182=_0x437ed4[_0x1082fd(0x1dd)]['totalPaidOut']||0x0,_0x1b9557=_0x437ed4[_0x1082fd(0x1dd)][_0x1082fd(0x1a9)]||0x0,_0x27f2c9=_0x877315[_0x1082fd(0x1dd)][_0x1082fd(0x1d1)]||0x0,_0x5264ab={'totalPayout':Math[_0x1082fd(0x1d3)](_0x14a182*0x64)/0x64,'awaitingPayout':Math['round'](_0x1b9557*0x64)/0x64,'thisMonth':Math[_0x1082fd(0x1d3)](_0x27f2c9*0x64)/0x64,'availableBalance':Math['round'](_0x1b9557*0x64)/0x64,'totalPayments':_0x39033c};return console[_0x1082fd(0x264)](_0x1082fd(0x152)),console[_0x1082fd(0x264)](_0x1082fd(0x1bd)+_0x5264ab[_0x1082fd(0x258)]+'\x20USDT\x20(total\x20paid\x20to\x20merchants)'),console[_0x1082fd(0x264)](_0x1082fd(0x11e)+_0x5264ab['awaitingPayout']+_0x1082fd(0x209)),console['log'](_0x1082fd(0x18e)+_0x5264ab[_0x1082fd(0x1e2)]+_0x1082fd(0x222)),console['log'](_0x1082fd(0x278)+_0x5264ab['thisMonth']+'\x20USDT'),console[_0x1082fd(0x264)](_0x1082fd(0x1d9)+_0x5264ab[_0x1082fd(0x255)]+_0x1082fd(0x1c9)),_0x5264ab;}async[a46_0x1559bb(0x182)](_0xaf9727,_0x378153){const _0x1eb435=a46_0x1559bb;console[_0x1eb435(0x264)](_0x1eb435(0x112)+_0xaf9727+':',_0x378153);const _0x26fa14=await database_1[_0x1eb435(0x137)][_0x1eb435(0x239)]['findUnique']({'where':{'id':_0xaf9727},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x26fa14)throw new Error(_0x1eb435(0x1d5));const _0x2ab5cf={};_0x378153[_0x1eb435(0x16e)]!==undefined&&(_0x2ab5cf[_0x1eb435(0x16e)]=_0x378153[_0x1eb435(0x16e)]||null);_0x378153[_0x1eb435(0x1c5)]!==undefined&&(_0x2ab5cf[_0x1eb435(0x1c5)]=_0x378153[_0x1eb435(0x1c5)]||null);_0x378153[_0x1eb435(0x1a1)]!==undefined&&(_0x2ab5cf[_0x1eb435(0x1a1)]=_0x378153['customerUa']||null);const _0x5ef5e1=await database_1[_0x1eb435(0x137)][_0x1eb435(0x239)][_0x1eb435(0x1f2)]({'where':{'id':_0xaf9727},'data':{..._0x2ab5cf,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console['log'](_0x1eb435(0x212)+_0xaf9727),console[_0x1eb435(0x264)](_0x1eb435(0x245)+_0x26fa14[_0x1eb435(0x16e)]+_0x1eb435(0x19a)+_0x5ef5e1[_0x1eb435(0x16e)]),console['log'](_0x1eb435(0x171)+_0x26fa14[_0x1eb435(0x1c5)]+_0x1eb435(0x19a)+_0x5ef5e1[_0x1eb435(0x1c5)]),console['log'](_0x1eb435(0x1f9)+(_0x26fa14['customerUa']?_0x1eb435(0x1f6):_0x1eb435(0x148))+'\x20->\x20'+(_0x5ef5e1[_0x1eb435(0x1a1)]?_0x1eb435(0x1f6):'not\x20set')),_0x5ef5e1;}async[a46_0x1559bb(0x21c)](_0x3cab5e,_0x383b00){const _0x2ccadb=a46_0x1559bb,_0x45dcb6=_0x383b00?new Date(_0x383b00):new Date();let _0xd10344,_0x849de0;if(_0x3cab5e[_0x2ccadb(0x1df)](_0x2ccadb(0x121))){const _0xfa9076=_0x3cab5e[_0x2ccadb(0x24d)](_0x2ccadb(0x121),'')[_0x2ccadb(0x23d)]('_');_0xfa9076[_0x2ccadb(0x13c)]===0x2?(_0xd10344=new Date(_0xfa9076[0x0]),_0xd10344[_0x2ccadb(0x1d0)](0x0,0x0,0x0,0x0),_0x849de0=new Date(_0xfa9076[0x1]),_0x849de0[_0x2ccadb(0x1d0)](0x17,0x3b,0x3b,0x3e7)):(_0xd10344=new Date(_0x45dcb6[_0x2ccadb(0x221)]()-0x1e*0x18*0x3c*0x3c*0x3e8),_0xd10344[_0x2ccadb(0x1d0)](0x0,0x0,0x0,0x0),_0x849de0=new Date(),_0x849de0[_0x2ccadb(0x1d0)](0x17,0x3b,0x3b,0x3e7));}else switch(_0x3cab5e[_0x2ccadb(0x263)]()){case _0x2ccadb(0x1f3):_0xd10344=new Date(_0x45dcb6[_0x2ccadb(0x25b)](),_0x45dcb6[_0x2ccadb(0x19d)](),_0x45dcb6['getDate'](),0x0,0x0,0x0,0x0),_0x849de0=new Date(_0x45dcb6['getFullYear'](),_0x45dcb6[_0x2ccadb(0x19d)](),_0x45dcb6[_0x2ccadb(0x12c)](),0x17,0x3b,0x3b,0x3e7);break;case _0x2ccadb(0x275):const _0x577f49=new Date(_0x45dcb6);_0x577f49[_0x2ccadb(0x163)](_0x577f49[_0x2ccadb(0x12c)]()-0x1),_0xd10344=new Date(_0x577f49[_0x2ccadb(0x25b)](),_0x577f49[_0x2ccadb(0x19d)](),_0x577f49[_0x2ccadb(0x12c)](),0x0,0x0,0x0,0x0),_0x849de0=new Date(_0x577f49['getFullYear'](),_0x577f49[_0x2ccadb(0x19d)](),_0x577f49[_0x2ccadb(0x12c)](),0x17,0x3b,0x3b,0x3e7);break;case _0x2ccadb(0x132):const _0xfca11f=_0x45dcb6[_0x2ccadb(0x25e)](),_0x5788ff=_0xfca11f===0x0?-0x6:0x1-_0xfca11f;_0xd10344=new Date(_0x45dcb6),_0xd10344[_0x2ccadb(0x163)](_0x45dcb6[_0x2ccadb(0x12c)]()+_0x5788ff),_0xd10344[_0x2ccadb(0x1d0)](0x0,0x0,0x0,0x0),_0x849de0=new Date(_0x45dcb6[_0x2ccadb(0x25b)](),_0x45dcb6['getMonth'](),_0x45dcb6[_0x2ccadb(0x12c)](),0x17,0x3b,0x3b,0x3e7);break;case'last_week':const _0x4221d6=new Date(_0x45dcb6);_0x4221d6[_0x2ccadb(0x163)](_0x45dcb6['getDate']()-0x7);const _0x559eb4=_0x4221d6['getDay'](),_0x226059=_0x559eb4===0x0?-0x6:0x1-_0x559eb4;_0xd10344=new Date(_0x4221d6),_0xd10344[_0x2ccadb(0x163)](_0x4221d6[_0x2ccadb(0x12c)]()+_0x226059),_0xd10344['setHours'](0x0,0x0,0x0,0x0),_0x849de0=new Date(_0xd10344),_0x849de0[_0x2ccadb(0x163)](_0xd10344[_0x2ccadb(0x12c)]()+0x6),_0x849de0[_0x2ccadb(0x1d0)](0x17,0x3b,0x3b,0x3e7);break;case'this_month':_0xd10344=new Date(_0x45dcb6[_0x2ccadb(0x25b)](),_0x45dcb6[_0x2ccadb(0x19d)](),0x1,0x0,0x0,0x0,0x0),_0x849de0=new Date(_0x45dcb6[_0x2ccadb(0x25b)](),_0x45dcb6[_0x2ccadb(0x19d)](),_0x45dcb6['getDate'](),0x17,0x3b,0x3b,0x3e7);break;case _0x2ccadb(0x26c):_0xd10344=new Date(_0x45dcb6[_0x2ccadb(0x25b)](),_0x45dcb6['getMonth']()-0x1,0x1,0x0,0x0,0x0,0x0),_0x849de0=new Date(_0x45dcb6['getFullYear'](),_0x45dcb6[_0x2ccadb(0x19d)](),0x0,0x17,0x3b,0x3b,0x3e7);break;default:_0xd10344=new Date(_0x45dcb6['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8),_0xd10344[_0x2ccadb(0x1d0)](0x0,0x0,0x0,0x0),_0x849de0=new Date(_0x45dcb6[_0x2ccadb(0x25b)](),_0x45dcb6[_0x2ccadb(0x19d)](),_0x45dcb6[_0x2ccadb(0x12c)](),0x17,0x3b,0x3b,0x3e7);}const _0x90fc7d={'gte':_0xd10344,'lte':_0x849de0},[_0x4975b2,_0x3b866a,_0x3f6f02,_0xf6e372,_0x254ff8,_0x35c0ae,_0x1aa5c8,_0x35b6b4]=await Promise['all']([database_1['default'][_0x2ccadb(0x21e)][_0x2ccadb(0x157)](),database_1[_0x2ccadb(0x137)][_0x2ccadb(0x21e)]['count']({'where':{'status':_0x2ccadb(0x1e8)}}),database_1['default']['payment']['count']({'where':{'status':_0x2ccadb(0x20a),'createdAt':_0x90fc7d,'gateway':{'not':_0x2ccadb(0x216)}}}),database_1[_0x2ccadb(0x137)][_0x2ccadb(0x239)][_0x2ccadb(0x157)]({'where':{'status':'CHARGEBACK','createdAt':_0x90fc7d,'gateway':{'not':_0x2ccadb(0x216)}}}),database_1[_0x2ccadb(0x137)][_0x2ccadb(0x239)][_0x2ccadb(0x157)]({'where':{'status':_0x2ccadb(0x1b7),'createdAt':_0x90fc7d,'gateway':{'not':_0x2ccadb(0x216)}}}),database_1[_0x2ccadb(0x137)][_0x2ccadb(0x239)][_0x2ccadb(0x158)]({'where':{'status':_0x2ccadb(0x20a),'createdAt':_0x90fc7d,'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x2ccadb(0x137)][_0x2ccadb(0x239)][_0x2ccadb(0x158)]({'where':{'gateway':{'not':_0x2ccadb(0x216)}},'take':0xa,'orderBy':{'createdAt':_0x2ccadb(0x250)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x2ccadb(0x137)][_0x2ccadb(0x239)][_0x2ccadb(0x158)]({'where':{'createdAt':_0x90fc7d,'gateway':{'not':_0x2ccadb(0x216)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0xdb5b1d=0x0,_0x11ec4f=0x0;for(const _0x3eb8ac of _0x35c0ae){const _0x3b6a91=_0x3eb8ac[_0x2ccadb(0x1ab)]||0x0;_0xdb5b1d+=_0x3b6a91;if(_0x3eb8ac[_0x2ccadb(0x136)]&&_0x3eb8ac[_0x2ccadb(0x1ab)]){const _0x26ee70=_0x3eb8ac[_0x2ccadb(0x1ab)]-_0x3eb8ac[_0x2ccadb(0x136)];_0x11ec4f+=_0x26ee70;}}const _0x473b27=_0x3f6f02>0x0?_0xdb5b1d/_0x3f6f02:0x0,_0x1661d1=this[_0x2ccadb(0x1fe)](_0x35b6b4,_0xd10344,_0x849de0),_0x972065=await database_1['default'][_0x2ccadb(0x239)][_0x2ccadb(0x157)]({'where':{'createdAt':_0x90fc7d,'gateway':{'not':_0x2ccadb(0x216)},'status':{'not':_0x2ccadb(0x228)}}}),_0xedbefc=_0x972065>0x0?_0x3f6f02/_0x972065*0x64:0x0;return{'totalShops':_0x4975b2,'activeShops':_0x3b866a,'totalPayments':_0x972065,'successfulPayments':_0x3f6f02,'totalAttempts':_0x972065,'chargebacks':_0xf6e372,'refunds':_0x254ff8,'totalRevenue':Math[_0x2ccadb(0x1d3)](_0xdb5b1d*0x64)/0x64,'trapayEarnings':Math[_0x2ccadb(0x1d3)](_0x11ec4f*0x64)/0x64,'averagePaymentAmount':Math[_0x2ccadb(0x1d3)](_0x473b27*0x64)/0x64,'conversionRate':Math[_0x2ccadb(0x1d3)](_0xedbefc*0x64)/0x64,'dailyRevenue':_0x1661d1[_0x2ccadb(0x19f)],'dailyPayments':_0x1661d1['dailyPayments'],'recentPayments':_0x1aa5c8['map'](_0x386471=>({'id':_0x386471['id'],'amount':_0x386471['amount'],'currency':_0x386471['currency'],'status':_0x386471[_0x2ccadb(0x16a)],'gateway':_0x386471['gateway'],'shop':_0x386471['shop'],'createdAt':_0x386471[_0x2ccadb(0x197)]}))};}async['getMerchantStatistics'](_0x52649c){const _0x533597=a46_0x1559bb;console[_0x533597(0x264)](_0x533597(0x192),_0x52649c);let _0x44824f,_0xa0dd17=new Date();if(_0x52649c[_0x533597(0x15f)]===_0x533597(0x26b)&&_0x52649c[_0x533597(0x1ca)]&&_0x52649c[_0x533597(0x225)])_0x44824f=new Date(_0x52649c[_0x533597(0x1ca)]),_0xa0dd17=new Date(_0x52649c[_0x533597(0x225)]),_0x44824f[_0x533597(0x1d0)](0x0,0x0,0x0,0x0),_0xa0dd17[_0x533597(0x1d0)](0x17,0x3b,0x3b,0x3e7);else{const _0x5625b0=new Date();switch(_0x52649c[_0x533597(0x15f)]){case _0x533597(0x12e):_0x44824f=new Date(_0x5625b0[_0x533597(0x221)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x533597(0x14b):_0x44824f=new Date(_0x5625b0[_0x533597(0x221)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x533597(0x17e):_0x44824f=new Date(_0x5625b0[_0x533597(0x221)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case'all':default:_0x44824f=new Date('2020-01-01');break;}_0x44824f[_0x533597(0x1d0)](0x0,0x0,0x0,0x0),_0xa0dd17[_0x533597(0x1d0)](0x17,0x3b,0x3b,0x3e7);}console[_0x533597(0x264)]('ðŸ“…\x20Period:\x20'+_0x44824f[_0x533597(0x13e)]()+'\x20to\x20'+_0xa0dd17[_0x533597(0x13e)]());const _0x4000e3={'status':_0x533597(0x20a),'gateway':{'not':'test_gateway'},'paidAt':{'gte':_0x44824f,'lte':_0xa0dd17}};_0x52649c[_0x533597(0x16d)]&&(_0x4000e3[_0x533597(0x16d)]=_0x52649c[_0x533597(0x16d)]);const _0x3d9815=await database_1[_0x533597(0x137)][_0x533597(0x239)]['findMany']({'where':_0x4000e3,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x533597(0x264)]('ðŸ’°\x20Found\x20'+_0x3d9815['length']+'\x20paid\x20payments\x20for\x20analysis');const _0x314613={'gateway':{'not':'test_gateway'},'status':{'not':_0x533597(0x228)},'createdAt':{'gte':_0x44824f,'lte':_0xa0dd17}};_0x52649c['shopId']&&(_0x314613[_0x533597(0x16d)]=_0x52649c[_0x533597(0x16d)]);const _0x30d8ca=await database_1[_0x533597(0x137)][_0x533597(0x239)][_0x533597(0x157)]({'where':_0x314613}),_0x13f10f={..._0x314613,'status':_0x533597(0x25f)},_0x525a38={..._0x314613,'status':_0x533597(0x1b7)},[_0x9d67eb,_0x55872c]=await Promise['all']([database_1['default'][_0x533597(0x239)][_0x533597(0x157)]({'where':_0x13f10f}),database_1['default'][_0x533597(0x239)][_0x533597(0x157)]({'where':_0x525a38})]);console[_0x533597(0x264)](_0x533597(0x23f)+_0x30d8ca+',\x20successful:\x20'+_0x3d9815[_0x533597(0x13c)]+_0x533597(0x119)+_0x9d67eb+_0x533597(0x254)+_0x55872c);let _0x456c15=0x0,_0x2643f6=0x0,_0x3e4c22=0x0;const _0x4e64ae={},_0xfe37e7={},_0x2f32cb={};for(const _0xb6cfb1 of _0x3d9815){try{const _0x1bdd71=_0xb6cfb1[_0x533597(0x1ab)]||0x0;if(_0x1bdd71<=0x0){console[_0x533597(0x27b)](_0x533597(0x1fb)+_0xb6cfb1['id']+'\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...');continue;}let _0x20cfaf,_0x2997a6;if(_0xb6cfb1['amountAfterGatewayCommissionUSDT']!==null&&_0xb6cfb1[_0x533597(0x136)]!==undefined)_0x20cfaf=_0xb6cfb1[_0x533597(0x136)],_0x2997a6=_0x1bdd71-_0x20cfaf,console['log'](_0x533597(0x20b)+_0xb6cfb1['id']+':\x20'+_0x1bdd71[_0x533597(0x213)](0x6)+_0x533597(0x110)+_0x20cfaf[_0x533597(0x213)](0x6)+_0x533597(0x1eb));else{let _0x5536fe={};if(_0xb6cfb1['shop'][_0x533597(0x175)])try{_0x5536fe=JSON[_0x533597(0x1ac)](_0xb6cfb1[_0x533597(0x21e)][_0x533597(0x175)]);}catch(_0x229739){console['error'](_0x533597(0x1c2)+_0xb6cfb1[_0x533597(0x16d)]+':',_0x229739);}let _0x4ca707=0x2d;for(const [_0x58ca5c,_0xad002c]of Object[_0x533597(0x10f)](_0x5536fe)){if(_0x58ca5c[_0x533597(0x263)]()===_0xb6cfb1['gateway'][_0x533597(0x263)]()){_0x4ca707=_0xad002c[_0x533597(0x1cf)]||0x2d;break;}}_0x2997a6=_0x1bdd71*(_0x4ca707/0x64),_0x20cfaf=_0x1bdd71-_0x2997a6,console['log'](_0x533597(0x260)+_0xb6cfb1['id']+':\x20'+_0x4ca707+_0x533597(0x23a)+_0x1bdd71[_0x533597(0x213)](0x6)+_0x533597(0x1eb));}_0x456c15+=_0x1bdd71,_0x2643f6+=_0x20cfaf,_0x3e4c22+=_0x2997a6;let _0xdea548;_0xb6cfb1[_0x533597(0x20c)]!==null&&_0xb6cfb1[_0x533597(0x20c)]!==undefined?(_0xdea548=_0xb6cfb1[_0x533597(0x20c)],console[_0x533597(0x264)](_0x533597(0x24b)+_0xb6cfb1['id']+':\x20'+_0xdea548+'%')):(_0xdea548=_0x1bdd71>0x0?_0x2997a6/_0x1bdd71*0x64:0x0,console[_0x533597(0x264)](_0x533597(0x240)+_0xb6cfb1['id']+':\x20'+_0xdea548[_0x533597(0x213)](0x2)+'%'));!_0x4e64ae[_0xb6cfb1[_0x533597(0x246)]]&&(_0x4e64ae[_0xb6cfb1[_0x533597(0x246)]]={'gateway':_0xb6cfb1[_0x533597(0x246)],'gatewayDisplayName':this['getGatewayDisplayName'](_0xb6cfb1[_0x533597(0x246)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x4e64ae[_0xb6cfb1[_0x533597(0x246)]]['paymentsCount']++,_0x4e64ae[_0xb6cfb1[_0x533597(0x246)]][_0x533597(0x1e1)]+=_0x1bdd71,_0x4e64ae[_0xb6cfb1[_0x533597(0x246)]][_0x533597(0x27f)]+=_0x2997a6,_0x4e64ae[_0xb6cfb1[_0x533597(0x246)]][_0x533597(0x15d)]+=_0x20cfaf,_0x4e64ae[_0xb6cfb1[_0x533597(0x246)]][_0x533597(0x116)]+=_0xdea548;!_0x52649c[_0x533597(0x16d)]&&(!_0xfe37e7[_0xb6cfb1[_0x533597(0x16d)]]&&(_0xfe37e7[_0xb6cfb1['shopId']]={'shopId':_0xb6cfb1['shopId'],'shopName':_0xb6cfb1[_0x533597(0x21e)][_0x533597(0x18b)],'shopUsername':_0xb6cfb1['shop']['username'],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0xfe37e7[_0xb6cfb1[_0x533597(0x16d)]][_0x533597(0x1cb)]++,_0xfe37e7[_0xb6cfb1['shopId']][_0x533597(0x1e1)]+=_0x1bdd71,_0xfe37e7[_0xb6cfb1[_0x533597(0x16d)]][_0x533597(0x27f)]+=_0x2997a6,_0xfe37e7[_0xb6cfb1[_0x533597(0x16d)]][_0x533597(0x15d)]+=_0x20cfaf);const _0x456768=_0xb6cfb1['paidAt']['toISOString']()[_0x533597(0x23d)]('T')[0x0];!_0x2f32cb[_0x456768]&&(_0x2f32cb[_0x456768]={'date':_0x456768,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x2f32cb[_0x456768][_0x533597(0x201)]+=_0x1bdd71,_0x2f32cb[_0x456768][_0x533597(0x1d4)]+=_0x20cfaf,_0x2f32cb[_0x456768][_0x533597(0x1b2)]+=_0x2997a6,_0x2f32cb[_0x456768][_0x533597(0x1cb)]++;}catch(_0x2343df){console[_0x533597(0x1b5)]('Error\x20processing\x20payment\x20'+_0xb6cfb1['id']+':',_0x2343df);}}Object[_0x533597(0x13d)](_0x4e64ae)['forEach'](_0x13eb7d=>{const _0x3dac97=_0x533597;_0x13eb7d[_0x3dac97(0x20d)]=_0x13eb7d[_0x3dac97(0x1cb)]>0x0?_0x13eb7d[_0x3dac97(0x116)]/_0x13eb7d[_0x3dac97(0x1cb)]:0x0,delete _0x13eb7d[_0x3dac97(0x116)];}),Object[_0x533597(0x13d)](_0xfe37e7)[_0x533597(0x173)](_0x11c3ea=>{const _0x533f4d=_0x533597;_0x11c3ea[_0x533f4d(0x149)]=_0x11c3ea[_0x533f4d(0x1cb)]>0x0?_0x11c3ea['turnoverUSDT']/_0x11c3ea[_0x533f4d(0x1cb)]:0x0;});let _0x12da2a=0x0,_0x48db6d=0x0;if(_0x52649c[_0x533597(0x16d)]){const _0x202f54=await database_1[_0x533597(0x137)][_0x533597(0x199)][_0x533597(0x158)]({'where':{'shopId':_0x52649c['shopId'],'status':'COMPLETED','createdAt':{'gte':_0x44824f,'lte':_0xa0dd17}},'select':{'amount':!![]}});_0x12da2a=_0x202f54[_0x533597(0x274)]((_0x272510,_0x14bbde)=>_0x272510+_0x14bbde[_0x533597(0x1d1)],0x0);const _0x386ea0=await database_1['default'][_0x533597(0x199)][_0x533597(0x158)]({'where':{'shopId':_0x52649c[_0x533597(0x16d)],'status':_0x533597(0x228),'createdAt':{'gte':_0x44824f,'lte':_0xa0dd17}},'select':{'amount':!![]}});_0x48db6d=_0x386ea0[_0x533597(0x274)]((_0x1f3a12,_0x5d998e)=>_0x1f3a12+_0x5d998e[_0x533597(0x1d1)],0x0);}const _0x2d1907=_0x30d8ca,_0x1c2e83=_0x3d9815[_0x533597(0x13c)],_0xceca31=_0x1c2e83>0x0?_0x456c15/_0x1c2e83:0x0,_0x546980=_0x2d1907>0x0?Math[_0x533597(0x1d3)](_0x1c2e83/_0x2d1907*0x2710)/0x64:0x0,_0x20bc05=Math[_0x533597(0x207)]((_0xa0dd17[_0x533597(0x221)]()-_0x44824f[_0x533597(0x221)]())/(0x3e8*0x3c*0x3c*0x18)),_0x31d975={'totalTurnover':Math['round'](_0x456c15*0x64)/0x64,'merchantEarnings':Math[_0x533597(0x1d3)](_0x2643f6*0x64)/0x64,'gatewayEarnings':Math[_0x533597(0x1d3)](_0x3e4c22*0x64)/0x64,'totalPaidOut':Math[_0x533597(0x1d3)](_0x12da2a*0x64)/0x64,'pendingPayout':Math[_0x533597(0x1d3)](_0x48db6d*0x64)/0x64,'averageCheck':Math[_0x533597(0x1d3)](_0xceca31*0x64)/0x64,'totalPayments':_0x2d1907,'successfulPayments':_0x1c2e83,'conversionRate':_0x546980,'chargebacks':_0x9d67eb,'refunds':_0x55872c,'gatewayBreakdown':Object['values'](_0x4e64ae)['map'](_0x3c6525=>({..._0x3c6525,'turnoverUSDT':Math[_0x533597(0x1d3)](_0x3c6525[_0x533597(0x1e1)]*0x64)/0x64,'commissionUSDT':Math[_0x533597(0x1d3)](_0x3c6525[_0x533597(0x27f)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x533597(0x1d3)](_0x3c6525[_0x533597(0x15d)]*0x64)/0x64,'averageCommissionRate':Math['round'](_0x3c6525[_0x533597(0x20d)]*0x64)/0x64})),'merchantBreakdown':_0x52649c[_0x533597(0x16d)]?undefined:Object[_0x533597(0x13d)](_0xfe37e7)[_0x533597(0x185)](_0x3c7767=>({..._0x3c7767,'turnoverUSDT':Math['round'](_0x3c7767['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math['round'](_0x3c7767[_0x533597(0x27f)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x3c7767[_0x533597(0x15d)]*0x64)/0x64,'paidOutUSDT':Math[_0x533597(0x1d3)](_0x3c7767['paidOutUSDT']*0x64)/0x64,'averageCheckUSDT':Math[_0x533597(0x1d3)](_0x3c7767[_0x533597(0x149)]*0x64)/0x64})),'dailyData':Object['values'](_0x2f32cb)['map'](_0x1289b1=>({..._0x1289b1,'turnover':Math[_0x533597(0x1d3)](_0x1289b1['turnover']*0x64)/0x64,'merchantEarnings':Math[_0x533597(0x1d3)](_0x1289b1[_0x533597(0x1d4)]*0x64)/0x64,'gatewayEarnings':Math['round'](_0x1289b1['gatewayEarnings']*0x64)/0x64}))[_0x533597(0x130)]((_0x598640,_0x36e89f)=>_0x598640['date'][_0x533597(0x25a)](_0x36e89f['date'])),'periodInfo':{'from':_0x44824f,'to':_0xa0dd17,'periodType':_0x52649c[_0x533597(0x15f)]||'custom','daysCount':_0x20bc05}};return console['log']('ðŸ“Š\x20Merchant\x20statistics\x20calculated:'),console[_0x533597(0x264)](_0x533597(0x1b9)+_0x31d975[_0x533597(0x226)]+_0x533597(0x1eb)),console[_0x533597(0x264)](_0x533597(0x21d)+_0x31d975[_0x533597(0x1d4)]+'\x20USDT'),console[_0x533597(0x264)](_0x533597(0x1a4)+_0x31d975[_0x533597(0x1b2)]+_0x533597(0x1eb)),console[_0x533597(0x264)](_0x533597(0x114)+_0x31d975[_0x533597(0x227)]+_0x533597(0x1eb)),console[_0x533597(0x264)](_0x533597(0x220)+_0x31d975[_0x533597(0x252)]+_0x533597(0x1eb)),console[_0x533597(0x264)](_0x533597(0x170)+_0x31d975['totalPayments']),_0x31d975;}async['getMerchantsSelection'](_0xf1322){const _0x492fb9=a46_0x1559bb;console[_0x492fb9(0x264)](_0x492fb9(0x16f),{'hasPayoutHistory':_0xf1322});let _0x1afc41={};_0xf1322&&(_0x1afc41[_0x492fb9(0x1a8)]={'some':{}});const _0x557221=await database_1[_0x492fb9(0x137)][_0x492fb9(0x21e)][_0x492fb9(0x158)]({'where':_0x1afc41,'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x492fb9(0x214)}});return console[_0x492fb9(0x264)](_0x492fb9(0x172)+_0x557221[_0x492fb9(0x13c)]+_0x492fb9(0x156)+(_0xf1322?_0x492fb9(0x17a):'')),_0x557221['map'](_0x43c928=>({'id':_0x43c928['id'],'username':_0x43c928[_0x492fb9(0x1e0)],'name':_0x43c928[_0x492fb9(0x18b)]}));}[a46_0x1559bb(0x166)](_0x5d9c79){const _0x2e5739=a46_0x1559bb,_0x20f9e8={'test_gateway':'Test\x20Gateway','plisio':_0x2e5739(0x111),'rapyd':'Rapyd','noda':'Noda','cointopay':_0x2e5739(0x20e),'cointopay2':_0x2e5739(0x22b),'klyme_eu':'KLYME\x20EU','klyme_gb':_0x2e5739(0x144),'klyme_de':'KLYME\x20DE','mastercard':_0x2e5739(0x25c)};return _0x20f9e8[_0x5d9c79]||_0x5d9c79;}[a46_0x1559bb(0x15a)](_0x1174f9){const _0x277b75=a46_0x1559bb,_0x32c5a8={'Test\x20Gateway':_0x277b75(0x216),'Plisio':_0x277b75(0x211),'Rapyd':_0x277b75(0x1f7),'Noda':'noda','CoinToPay':_0x277b75(0x164),'CoinToPay2':_0x277b75(0x154),'KLYME\x20EU':'klyme_eu','KLYME\x20GB':_0x277b75(0x27c),'KLYME\x20DE':_0x277b75(0x190),'MasterCard':_0x277b75(0x1ef)};return _0x32c5a8[_0x1174f9]||_0x1174f9[_0x277b75(0x263)]();}async[a46_0x1559bb(0x1bf)](_0x49ed41){const _0x17d162=a46_0x1559bb,{page:_0x42cd62,limit:_0x2e30c8,minAmount:_0x334d77,search:_0x4cc8bb}=_0x49ed41;console[_0x17d162(0x264)](_0x17d162(0x24f),_0x49ed41);let _0x3c9bf3={};_0x4cc8bb&&(_0x3c9bf3[_0x17d162(0x18b)]={'contains':_0x4cc8bb,'mode':_0x17d162(0x14e)});const _0x2d6d14=await database_1[_0x17d162(0x137)]['shop'][_0x17d162(0x158)]({'where':_0x3c9bf3,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),_0x6baf28=_0x2d6d14[_0x17d162(0x18f)](_0x434692=>{const _0xe293fd=_0x17d162,_0x42c190=Math[_0xe293fd(0x242)](_0x434692['balance']*0x64)/0x64;if(_0x334d77&&_0x42c190<_0x334d77)return![];return _0x42c190!==0x0;});_0x6baf28[_0x17d162(0x130)]((_0x1f87ac,_0x574805)=>_0x574805[_0x17d162(0x1a9)]-_0x1f87ac[_0x17d162(0x1a9)]);const _0x46fd99=_0x6baf28['length'],_0x5b5c25=(_0x42cd62-0x1)*_0x2e30c8,_0x4b9117=_0x6baf28[_0x17d162(0x25d)](_0x5b5c25,_0x5b5c25+_0x2e30c8);console['log'](_0x17d162(0x1bc)+_0x4b9117['length']+_0x17d162(0x276));const _0x1fcd1d=await Promise[_0x17d162(0x23c)](_0x4b9117[_0x17d162(0x185)](async _0x4b006b=>{const _0x363cf5=_0x17d162,[_0x181b5a,_0x214ad9,_0x5dd712]=await Promise[_0x363cf5(0x23c)]([database_1[_0x363cf5(0x137)][_0x363cf5(0x239)][_0x363cf5(0x157)]({'where':{'shopId':_0x4b006b['id'],'status':_0x363cf5(0x20a),'gateway':{'not':_0x363cf5(0x216)}}}),database_1['default'][_0x363cf5(0x239)][_0x363cf5(0x248)]({'where':{'shopId':_0x4b006b['id'],'status':_0x363cf5(0x20a),'gateway':{'not':_0x363cf5(0x216)}},'orderBy':{'paidAt':_0x363cf5(0x214)},'select':{'paidAt':!![]}}),database_1[_0x363cf5(0x137)]['payment'][_0x363cf5(0x1c3)]({'by':[_0x363cf5(0x246)],'where':{'shopId':_0x4b006b['id'],'status':_0x363cf5(0x20a),'gateway':{'not':_0x363cf5(0x216)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x26bfe6=new Date(),_0x468cb4=new Date(_0x26bfe6[_0x363cf5(0x25b)](),_0x26bfe6['getMonth'](),0x1),_0x1eff4a=new Date(_0x26bfe6[_0x363cf5(0x25b)](),_0x26bfe6[_0x363cf5(0x19d)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x94a55b,_0x35334f]=await Promise[_0x363cf5(0x23c)]([database_1['default'][_0x363cf5(0x199)]['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x4b006b['id'],'status':_0x363cf5(0x273)}}),database_1[_0x363cf5(0x137)][_0x363cf5(0x199)][_0x363cf5(0x1ed)]({'_sum':{'amount':!![]},'where':{'shopId':_0x4b006b['id'],'status':_0x363cf5(0x273),'createdAt':{'gte':_0x468cb4,'lte':_0x1eff4a}}})]),_0x24efd7=_0x94a55b[_0x363cf5(0x1dd)][_0x363cf5(0x1d1)]||0x0,_0x13108d=_0x35334f['_sum']['amount']||0x0,_0x5ba3f8=await Promise['all'](_0x5dd712['map'](async _0xd4a7a=>{const _0x14ecfb=_0x363cf5;let _0x4a60b3=0x2d;if(_0x4b006b[_0x14ecfb(0x175)])try{const _0x464661=JSON['parse'](_0x4b006b[_0x14ecfb(0x175)]);for(const [_0x4ff6a0,_0x11f092]of Object[_0x14ecfb(0x10f)](_0x464661)){if(_0x4ff6a0[_0x14ecfb(0x263)]()===_0xd4a7a[_0x14ecfb(0x246)][_0x14ecfb(0x263)]()){_0x4a60b3=_0x11f092[_0x14ecfb(0x1cf)]||0xa,console[_0x14ecfb(0x264)]('ðŸ’°\x20[PAYOUT]\x20Gateway\x20'+_0xd4a7a['gateway']+'\x20for\x20shop\x20'+_0x4b006b['id']+_0x14ecfb(0x19b)+_0x4a60b3+'%');break;}}}catch(_0x4b9b02){console[_0x14ecfb(0x1b5)](_0x14ecfb(0x1c2)+_0x4b006b['id']+':',_0x4b9b02);}const _0x52425b=_0xd4a7a[_0x14ecfb(0x1dd)]?.[_0x14ecfb(0x1ab)]||0x0,_0x552fa1=_0x52425b*(0x1-_0x4a60b3/0x64);return{'gateway':_0xd4a7a[_0x14ecfb(0x246)],'count':_0xd4a7a[_0x14ecfb(0x266)]?.['id']||0x0,'amountUSDT':Math[_0x14ecfb(0x1d3)](_0x52425b*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x14ecfb(0x1d3)](_0x552fa1*0x64)/0x64,'commission':_0x4a60b3};})),_0x321aae=_0x5ba3f8[_0x363cf5(0x274)]((_0x2def48,_0x59b260)=>_0x2def48+_0x59b260[_0x363cf5(0x1ab)],0x0),_0x47f7ee=_0x5ba3f8['reduce']((_0x48335f,_0x2c9112)=>_0x48335f+_0x2c9112[_0x363cf5(0x224)],0x0),_0x2e13ba=_0x4b006b[_0x363cf5(0x1a9)];return console[_0x363cf5(0x264)](_0x363cf5(0x1cc)+_0x4b006b[_0x363cf5(0x1e0)]+':'),console['log'](_0x363cf5(0x18a)+_0x321aae['toFixed'](0x2)+'\x20USDT\x20(gross\x20revenue)'),console[_0x363cf5(0x264)](_0x363cf5(0x1ba)+_0x47f7ee[_0x363cf5(0x213)](0x2)+_0x363cf5(0x18d)),console['log']('\x20\x20\x20âœ…\x20Actual\x20available\x20balance:\x20'+_0x2e13ba[_0x363cf5(0x213)](0x2)+_0x363cf5(0x1a7)),console[_0x363cf5(0x264)](_0x363cf5(0x1f8)+_0x24efd7[_0x363cf5(0x213)](0x2)+_0x363cf5(0x179)),console[_0x363cf5(0x264)](_0x363cf5(0x145)+(_0x47f7ee-_0x24efd7-_0x2e13ba)[_0x363cf5(0x213)](0x2)+_0x363cf5(0x272)),{'id':_0x4b006b['id'],'fullName':_0x4b006b['name'],'username':_0x4b006b[_0x363cf5(0x1e0)],'telegramId':_0x4b006b[_0x363cf5(0x188)],'merchantUrl':_0x4b006b[_0x363cf5(0x12b)],'wallets':{'usdtPolygonWallet':_0x4b006b[_0x363cf5(0x241)],'usdtTrcWallet':_0x4b006b[_0x363cf5(0x1fc)],'usdtErcWallet':_0x4b006b[_0x363cf5(0x1c8)],'usdcPolygonWallet':_0x4b006b[_0x363cf5(0x159)],'usdcErcWallet':_0x4b006b['usdcErcWallet']},'totalAmountUSDT':Math[_0x363cf5(0x1d3)](_0x321aae*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x363cf5(0x1d3)](_0x47f7ee*0x64)/0x64,'currentBalance':Math[_0x363cf5(0x242)](_0x2e13ba*0x64)/0x64,'totalPayout':Math[_0x363cf5(0x1d3)](_0x24efd7*0x64)/0x64,'thisMonth':Math[_0x363cf5(0x1d3)](_0x13108d*0x64)/0x64,'paymentsCount':_0x181b5a,'oldestPaymentDate':_0x214ad9?.[_0x363cf5(0x153)]||_0x4b006b[_0x363cf5(0x197)],'gatewayBreakdown':_0x5ba3f8};})),_0x432826=_0x1fcd1d[_0x17d162(0x274)]((_0x61da07,_0xbc61e9)=>_0x61da07+_0xbc61e9[_0x17d162(0x19c)],0x0),_0x12d6ac=_0x1fcd1d[_0x17d162(0x274)]((_0x420a01,_0x182fd3)=>_0x420a01+_0x182fd3['totalAmountAfterCommissionUSDT'],0x0),_0x4750eb=_0x1fcd1d['reduce']((_0x206314,_0x8024e)=>_0x206314+_0x8024e[_0x17d162(0x258)],0x0),_0x50d608=_0x1fcd1d[_0x17d162(0x274)]((_0xeae81,_0xcabbec)=>_0xeae81+_0xcabbec[_0x17d162(0x17c)],0x0);return console[_0x17d162(0x264)](_0x17d162(0x18c)+_0x46fd99+_0x17d162(0x204)),console[_0x17d162(0x264)](_0x17d162(0x122)+Math[_0x17d162(0x1d3)](_0x432826*0x64)/0x64+_0x17d162(0x181)),console[_0x17d162(0x264)](_0x17d162(0x279)+Math[_0x17d162(0x1d3)](_0x12d6ac*0x64)/0x64+_0x17d162(0x265)),console[_0x17d162(0x264)](_0x17d162(0x138)+Math[_0x17d162(0x1d3)](_0x4750eb*0x64)/0x64+_0x17d162(0x1eb)),console[_0x17d162(0x264)](_0x17d162(0x231)+Math['round'](_0x50d608*0x64)/0x64+_0x17d162(0x1eb)),{'merchants':_0x1fcd1d,'pagination':{'page':_0x42cd62,'limit':_0x2e30c8,'total':_0x46fd99,'totalPages':Math['ceil'](_0x46fd99/_0x2e30c8)},'summary':{'totalMerchants':_0x46fd99,'totalAmountUSDT':Math['round'](_0x432826*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x17d162(0x1d3)](_0x12d6ac*0x64)/0x64,'totalPayout':Math[_0x17d162(0x1d3)](_0x4750eb*0x64)/0x64,'thisMonth':Math[_0x17d162(0x1d3)](_0x50d608*0x64)/0x64}};}async[a46_0x1559bb(0x150)](_0x386989){const _0x31d2e6=a46_0x1559bb,{shopId:_0x582db1,amount:_0x5853d0,network:_0x48fcbc,wallet:_0x15d930,notes:_0x1ffdfa,txid:_0x257ccc,periodFrom:_0x5020dc,periodTo:_0xf5a4f0}=_0x386989,_0x37b5f7=await database_1[_0x31d2e6(0x137)]['$transaction'](async _0x38cb94=>{const _0x27d69c=_0x31d2e6,_0x56bcc6=await _0x38cb94[_0x27d69c(0x21e)]['findUnique']({'where':{'id':_0x582db1},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x56bcc6)throw new Error('Shop\x20not\x20found');console['log'](_0x27d69c(0x269)+_0x56bcc6[_0x27d69c(0x1e0)]+':'),console[_0x27d69c(0x264)](_0x27d69c(0x13a)+_0x56bcc6[_0x27d69c(0x1a9)][_0x27d69c(0x213)](0x6)+_0x27d69c(0x1eb)),console[_0x27d69c(0x264)](_0x27d69c(0x176)+_0x5853d0[_0x27d69c(0x213)](0x6)+'\x20USDT'),console[_0x27d69c(0x264)](_0x27d69c(0x1f1)+_0x56bcc6[_0x27d69c(0x227)][_0x27d69c(0x213)](0x6)+_0x27d69c(0x1eb));if(_0x257ccc)console['log']('\x20\x20\x20Transaction\x20hash:\x20'+_0x257ccc);const _0x20d720=0.000001,_0x56cd98=Number(_0x56bcc6['balance']),_0x1bd69d=Number(_0x5853d0);console[_0x27d69c(0x264)](_0x27d69c(0x249)),console[_0x27d69c(0x264)](_0x27d69c(0x11a)+_0x56bcc6[_0x27d69c(0x1a9)]),console[_0x27d69c(0x264)]('\x20\x20\x20Available\x20(number):\x20'+_0x56cd98),console['log'](_0x27d69c(0x189)+_0x1bd69d),console[_0x27d69c(0x264)](_0x27d69c(0x180)+(_0x56cd98-_0x1bd69d)),console[_0x27d69c(0x264)]('\x20\x20\x20Tolerance:\x20'+_0x20d720);if(_0x56cd98<_0x1bd69d-_0x20d720)throw new Error(_0x27d69c(0x1d8)+_0x56cd98[_0x27d69c(0x213)](0x6)+'\x20USDT,\x20Requested:\x20'+_0x1bd69d[_0x27d69c(0x213)](0x6)+_0x27d69c(0x206)+(_0x56cd98-_0x1bd69d)[_0x27d69c(0x213)](0x8)+'\x20USDT');console['log'](_0x27d69c(0x127));const _0x8dc345=Math[_0x27d69c(0x238)](_0x56cd98,_0x1bd69d);let _0x4d9ef6=_0x15d930;console[_0x27d69c(0x264)]('ðŸ”\x20Initial\x20wallet\x20from\x20request:\x20'+(_0x15d930||_0x27d69c(0x1be)));if(!_0x4d9ef6){console[_0x27d69c(0x264)]('ðŸ”\x20No\x20wallet\x20provided,\x20looking\x20up\x20from\x20shop\x20settings...');const _0x186bb5=await _0x38cb94['shop'][_0x27d69c(0x26f)]({'where':{'id':_0x582db1},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});console[_0x27d69c(0x264)](_0x27d69c(0x17b),_0x186bb5);if(_0x186bb5)switch(_0x48fcbc){case _0x27d69c(0x124):_0x4d9ef6=_0x186bb5['usdtPolygonWallet']||undefined,console['log'](_0x27d69c(0x270)+_0x4d9ef6);break;case'trc20':_0x4d9ef6=_0x186bb5['usdtTrcWallet']||undefined,console[_0x27d69c(0x264)]('ðŸ”\x20Selected\x20trc20\x20wallet:\x20'+_0x4d9ef6);break;case _0x27d69c(0x131):_0x4d9ef6=_0x186bb5[_0x27d69c(0x1c8)]||undefined,console[_0x27d69c(0x264)](_0x27d69c(0x1de)+_0x4d9ef6);break;case _0x27d69c(0x1b0):_0x4d9ef6=_0x186bb5['usdcPolygonWallet']||undefined,console[_0x27d69c(0x264)](_0x27d69c(0x1f5)+_0x4d9ef6);break;case _0x27d69c(0x1ae):_0x4d9ef6=_0x186bb5[_0x27d69c(0x1ce)]||undefined,console['log'](_0x27d69c(0x135)+_0x4d9ef6);break;}}else console[_0x27d69c(0x264)](_0x27d69c(0x21b)+_0x4d9ef6);console[_0x27d69c(0x264)](_0x27d69c(0x24a)+_0x48fcbc+':\x20'+(_0x4d9ef6||_0x27d69c(0x26a))),console[_0x27d69c(0x264)](_0x27d69c(0x244),{'shopId':_0x582db1,'amount':_0x8dc345,'network':_0x48fcbc,'wallet':_0x4d9ef6,'status':'COMPLETED','txid':_0x257ccc,'notes':_0x1ffdfa,'periodFrom':_0x5020dc?new Date(_0x5020dc):null,'periodTo':_0xf5a4f0?new Date(_0xf5a4f0):null});const _0x2bfba0=await _0x38cb94['payout'][_0x27d69c(0x19e)]({'data':{'shopId':_0x582db1,'amount':_0x8dc345,'network':_0x48fcbc,'wallet':_0x4d9ef6,'status':'COMPLETED','txid':_0x257ccc,'notes':_0x1ffdfa,'periodFrom':_0x5020dc?new Date(_0x5020dc):null,'periodTo':_0xf5a4f0?new Date(_0xf5a4f0):null,'createdAt':new Date(),'paidAt':new Date()}});console[_0x27d69c(0x264)](_0x27d69c(0x219),{'id':_0x2bfba0['id'],'wallet':_0x2bfba0['wallet'],'network':_0x2bfba0[_0x27d69c(0x233)],'amount':_0x2bfba0[_0x27d69c(0x1d1)]});const _0x371453=_0x56cd98-_0x8dc345,_0x56dd9e=Number(_0x56bcc6[_0x27d69c(0x227)])+_0x8dc345;return await _0x38cb94[_0x27d69c(0x21e)][_0x27d69c(0x1f2)]({'where':{'id':_0x582db1},'data':{'balance':_0x371453,'totalPaidOut':_0x56dd9e}}),console[_0x27d69c(0x264)]('ðŸ’°\x20Shop\x20'+_0x56bcc6[_0x27d69c(0x1e0)]+_0x27d69c(0x22a)),console[_0x27d69c(0x264)](_0x27d69c(0x11b)+_0x56cd98[_0x27d69c(0x213)](0x6)+_0x27d69c(0x19a)+_0x371453[_0x27d69c(0x213)](0x6)+_0x27d69c(0x253)+_0x8dc345[_0x27d69c(0x213)](0x6)+')'),console[_0x27d69c(0x264)]('\x20\x20\x20Total\x20paid\x20out:\x20'+_0x56bcc6[_0x27d69c(0x227)][_0x27d69c(0x213)](0x6)+_0x27d69c(0x19a)+_0x56dd9e['toFixed'](0x6)+_0x27d69c(0x125)+_0x8dc345[_0x27d69c(0x213)](0x6)+')'),console[_0x27d69c(0x264)](_0x27d69c(0x161)+_0x8dc345[_0x27d69c(0x213)](0x6)+'\x20USDT'),{'payout':_0x2bfba0,'shop':_0x56bcc6};});console[_0x31d2e6(0x264)](_0x31d2e6(0x1a5)+_0x37b5f7['payout']['id']+_0x31d2e6(0x277)+_0x37b5f7[_0x31d2e6(0x21e)][_0x31d2e6(0x1e0)]+'\x20('+_0x37b5f7[_0x31d2e6(0x199)][_0x31d2e6(0x1d1)][_0x31d2e6(0x213)](0x6)+_0x31d2e6(0x113));try{let _0x231dc3='ÐÐµ\x20ÑƒÐºÐ°Ð·Ð°Ð½';if(_0x37b5f7[_0x31d2e6(0x199)][_0x31d2e6(0x186)]&&_0x37b5f7[_0x31d2e6(0x199)][_0x31d2e6(0x191)]){const _0x7b3184=new Date(_0x37b5f7[_0x31d2e6(0x199)][_0x31d2e6(0x186)])['toLocaleDateString']('ru-RU'),_0x29a17b=new Date(_0x37b5f7['payout']['periodTo'])[_0x31d2e6(0x200)](_0x31d2e6(0x22e));_0x231dc3=_0x7b3184+_0x31d2e6(0x217)+_0x29a17b;}await telegramBotService_1[_0x31d2e6(0x168)][_0x31d2e6(0x11c)](_0x37b5f7[_0x31d2e6(0x199)][_0x31d2e6(0x16d)],{'id':_0x37b5f7[_0x31d2e6(0x199)]['id'],'amount':_0x37b5f7[_0x31d2e6(0x199)][_0x31d2e6(0x1d1)],'network':_0x37b5f7[_0x31d2e6(0x199)][_0x31d2e6(0x233)],'wallet':_0x37b5f7[_0x31d2e6(0x199)]['wallet'],'period':_0x231dc3,'createdAt':_0x37b5f7[_0x31d2e6(0x199)][_0x31d2e6(0x197)],'txid':_0x37b5f7[_0x31d2e6(0x199)]['txid']}),console['log']('ðŸ“±\x20Telegram\x20notification\x20sent\x20for\x20payout\x20'+_0x37b5f7['payout']['id']);}catch(_0x474fb3){console[_0x31d2e6(0x1b5)]('âŒ\x20Failed\x20to\x20send\x20Telegram\x20notification\x20for\x20payout\x20'+_0x37b5f7[_0x31d2e6(0x199)]['id']+':',_0x474fb3);}return{'id':_0x37b5f7[_0x31d2e6(0x199)]['id'],'shopId':_0x37b5f7[_0x31d2e6(0x199)][_0x31d2e6(0x16d)],'shopName':_0x37b5f7[_0x31d2e6(0x21e)][_0x31d2e6(0x18b)],'shopUsername':_0x37b5f7[_0x31d2e6(0x21e)][_0x31d2e6(0x1e0)],'amount':_0x37b5f7['payout'][_0x31d2e6(0x1d1)],'network':_0x37b5f7[_0x31d2e6(0x199)]['network'],'wallet':_0x37b5f7[_0x31d2e6(0x199)][_0x31d2e6(0x174)],'status':_0x37b5f7[_0x31d2e6(0x199)][_0x31d2e6(0x16a)],'txid':_0x37b5f7['payout'][_0x31d2e6(0x1ec)],'notes':_0x37b5f7[_0x31d2e6(0x199)][_0x31d2e6(0x27a)],'periodFrom':_0x37b5f7[_0x31d2e6(0x199)]['periodFrom'],'periodTo':_0x37b5f7[_0x31d2e6(0x199)]['periodTo'],'createdAt':_0x37b5f7[_0x31d2e6(0x199)][_0x31d2e6(0x197)],'paidAt':_0x37b5f7[_0x31d2e6(0x199)][_0x31d2e6(0x153)]};}async[a46_0x1559bb(0x177)](_0x1f8b88){const _0x2afe9d=a46_0x1559bb,{page:_0x34ddb2,limit:_0x342081,shopId:_0x40e3d0,network:_0x8ab707,dateFrom:_0x460d40,dateTo:_0x45d98d,search:_0x1b8fd0}=_0x1f8b88,_0x4c253f=(_0x34ddb2-0x1)*_0x342081,_0x5ede1b={};_0x40e3d0&&(_0x5ede1b[_0x2afe9d(0x16d)]=_0x40e3d0);_0x8ab707&&(_0x5ede1b[_0x2afe9d(0x233)]=_0x8ab707);if(_0x460d40||_0x45d98d){_0x5ede1b['createdAt']={};if(_0x460d40){const _0x1bb332=new Date(_0x460d40);_0x1bb332[_0x2afe9d(0x1d0)](0x0,0x0,0x0,0x1),_0x5ede1b[_0x2afe9d(0x197)][_0x2afe9d(0x1bb)]=_0x1bb332,console[_0x2afe9d(0x264)](_0x2afe9d(0x178)+_0x1bb332[_0x2afe9d(0x13e)]());}if(_0x45d98d){const _0x45e522=new Date(_0x45d98d);_0x45e522['setHours'](0x17,0x3b,0x3b,0x3e7),_0x5ede1b[_0x2afe9d(0x197)]['lte']=_0x45e522,console[_0x2afe9d(0x264)]('ðŸ“…\x20Payout\x20date\x20to\x20filter:\x20'+_0x45e522[_0x2afe9d(0x13e)]());}}_0x1b8fd0&&(_0x5ede1b['OR']=[{'shop':{'name':{'contains':_0x1b8fd0,'mode':_0x2afe9d(0x14e)}}},{'shop':{'username':{'contains':_0x1b8fd0,'mode':_0x2afe9d(0x14e)}}},{'notes':{'contains':_0x1b8fd0,'mode':_0x2afe9d(0x14e)}}]);const [_0xe62cfb,_0x17c563]=await Promise['all']([database_1[_0x2afe9d(0x137)]['payout'][_0x2afe9d(0x158)]({'where':_0x5ede1b,'skip':_0x4c253f,'take':_0x342081,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'wallet':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x2afe9d(0x137)]['payout'][_0x2afe9d(0x157)]({'where':_0x5ede1b})]);return{'payouts':_0xe62cfb[_0x2afe9d(0x185)](_0x26b9c1=>({'id':_0x26b9c1['id'],'shopId':_0x26b9c1[_0x2afe9d(0x16d)],'shopName':_0x26b9c1[_0x2afe9d(0x21e)][_0x2afe9d(0x18b)],'shopUsername':_0x26b9c1[_0x2afe9d(0x21e)][_0x2afe9d(0x1e0)],'amount':_0x26b9c1['amount'],'network':_0x26b9c1[_0x2afe9d(0x233)],'wallet':_0x26b9c1[_0x2afe9d(0x174)],'status':_0x26b9c1[_0x2afe9d(0x16a)],'txid':_0x26b9c1[_0x2afe9d(0x1ec)],'notes':_0x26b9c1[_0x2afe9d(0x27a)],'periodFrom':_0x26b9c1[_0x2afe9d(0x186)],'periodTo':_0x26b9c1['periodTo'],'createdAt':_0x26b9c1[_0x2afe9d(0x197)],'paidAt':_0x26b9c1['paidAt']})),'pagination':{'page':_0x34ddb2,'limit':_0x342081,'total':_0x17c563,'totalPages':Math['ceil'](_0x17c563/_0x342081)}};}async['getPayoutById'](_0x530e4f){const _0x55ccb9=a46_0x1559bb,_0x572ee8=await database_1[_0x55ccb9(0x137)][_0x55ccb9(0x199)][_0x55ccb9(0x26f)]({'where':{'id':_0x530e4f},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x572ee8)return null;return{'id':_0x572ee8['id'],'shopId':_0x572ee8[_0x55ccb9(0x16d)],'shopName':_0x572ee8[_0x55ccb9(0x21e)][_0x55ccb9(0x18b)],'shopUsername':_0x572ee8[_0x55ccb9(0x21e)][_0x55ccb9(0x1e0)],'amount':_0x572ee8[_0x55ccb9(0x1d1)],'network':_0x572ee8[_0x55ccb9(0x233)],'wallet':_0x572ee8[_0x55ccb9(0x174)],'status':_0x572ee8[_0x55ccb9(0x16a)],'txid':_0x572ee8['txid'],'notes':_0x572ee8[_0x55ccb9(0x27a)],'periodFrom':_0x572ee8['periodFrom'],'periodTo':_0x572ee8[_0x55ccb9(0x191)],'createdAt':_0x572ee8['createdAt'],'paidAt':_0x572ee8['paidAt']};}async[a46_0x1559bb(0x120)](_0x39e3c9){const _0x230178=a46_0x1559bb;await database_1[_0x230178(0x137)][_0x230178(0x199)][_0x230178(0x24c)]({'where':{'id':_0x39e3c9}});}async[a46_0x1559bb(0x1e6)](_0x43b89c){const _0x3a9038=a46_0x1559bb,{page:_0x5a524e,limit:_0x101d2b,status:_0x741a59,gateway:_0x4beff7,shopId:_0x23e44d,dateFrom:_0x424626,dateTo:_0x132011,search:_0x8cc7cd,currency:_0x169fc0,sortBy:_0x2e9ed8,sortOrder:_0x1b5f76}=_0x43b89c,_0x334e07=(_0x5a524e-0x1)*_0x101d2b;console[_0x3a9038(0x264)](_0x3a9038(0x257),_0x43b89c);const _0x3d9129=await database_1[_0x3a9038(0x137)][_0x3a9038(0x239)][_0x3a9038(0x1c3)]({'by':[_0x3a9038(0x246)],'_count':{'gateway':!![]}});console[_0x3a9038(0x264)]('ðŸ“Š\x20Available\x20gateways\x20in\x20database:',_0x3d9129[_0x3a9038(0x185)](_0x3d82e5=>_0x3d82e5[_0x3a9038(0x246)]+'\x20('+_0x3d82e5[_0x3a9038(0x266)][_0x3a9038(0x246)]+'\x20payments)'));if(_0x4beff7){const _0x5869a=_0x3d9129['some'](_0x485d86=>_0x485d86[_0x3a9038(0x246)][_0x3a9038(0x263)]()===_0x4beff7[_0x3a9038(0x263)]());!_0x5869a&&_0x4beff7['toLowerCase']()!==_0x3a9038(0x216)&&console[_0x3a9038(0x264)](_0x3a9038(0x139)+_0x4beff7+'\x27\x20not\x20found.\x20Available\x20gateways:\x20'+_0x3d9129['map'](_0x2a2a23=>_0x2a2a23[_0x3a9038(0x246)])[_0x3a9038(0x23b)](',\x20'));}const _0x24ef2e={};_0x741a59&&(_0x24ef2e[_0x3a9038(0x16a)]=_0x741a59['toUpperCase']());if(!_0x4beff7)_0x24ef2e[_0x3a9038(0x246)]={'not':_0x3a9038(0x216)};else{if(_0x4beff7&&(_0x4beff7[_0x3a9038(0x263)]()===_0x3a9038(0x216)||_0x4beff7==='0000'))_0x24ef2e[_0x3a9038(0x246)]='test_gateway';else{let _0x53b2f8=_0x4beff7;const _0x2e96ff=(0x0,gateway_1[_0x3a9038(0x12a)])(_0x4beff7);if(_0x2e96ff)_0x53b2f8=_0x2e96ff,console[_0x3a9038(0x264)](_0x3a9038(0x1a0)+_0x4beff7+_0x3a9038(0x1c1)+_0x53b2f8+'\x27');else{const _0x5bcb5b=(0x0,gateway_1[_0x3a9038(0x262)])(_0x4beff7);if(_0x5bcb5b){const _0x23b0b6=(0x0,gateway_1[_0x3a9038(0x12a)])(_0x5bcb5b);_0x23b0b6&&(_0x53b2f8=_0x23b0b6,console[_0x3a9038(0x264)]('ðŸ”„\x20Converted\x20gateway\x20name\x20\x27'+_0x4beff7+_0x3a9038(0x16c)+_0x5bcb5b+_0x3a9038(0x243)+_0x53b2f8+'\x27'));}else console[_0x3a9038(0x264)](_0x3a9038(0x1fd)+_0x4beff7+_0x3a9038(0x1fa));}const _0x274dae=await database_1['default'][_0x3a9038(0x239)]['count']({'where':{'gateway':_0x53b2f8[_0x3a9038(0x263)]()},'take':0x1});_0x274dae===0x0?(console[_0x3a9038(0x264)]('âš ï¸\x20Gateway\x20\x27'+_0x53b2f8+_0x3a9038(0x1f4)+_0x4beff7+_0x3a9038(0x1da)),_0x24ef2e[_0x3a9038(0x246)]='NONEXISTENT_GATEWAY_FILTER'):(_0x24ef2e[_0x3a9038(0x246)]=_0x53b2f8[_0x3a9038(0x263)](),console[_0x3a9038(0x264)](_0x3a9038(0x1e5)+_0x53b2f8+_0x3a9038(0x1f4)+_0x4beff7+'\x27)'));}}console[_0x3a9038(0x264)]('ðŸ“Š\x20Gateway\x20filter\x20applied:',_0x24ef2e['gateway']);_0x23e44d&&(_0x24ef2e[_0x3a9038(0x16d)]=_0x23e44d);_0x169fc0&&(_0x24ef2e[_0x3a9038(0x236)]=_0x169fc0[_0x3a9038(0x129)](),console[_0x3a9038(0x264)](_0x3a9038(0x202)+_0x169fc0[_0x3a9038(0x129)]()));if(_0x424626||_0x132011){_0x24ef2e[_0x3a9038(0x197)]={};if(_0x424626){const _0x1e5004=new Date(_0x424626);_0x1e5004[_0x3a9038(0x1d0)](0x0,0x0,0x0,0x1),_0x24ef2e['createdAt'][_0x3a9038(0x1bb)]=_0x1e5004,console[_0x3a9038(0x264)](_0x3a9038(0x261)+_0x1e5004[_0x3a9038(0x13e)]());}if(_0x132011){const _0x1009c8=new Date(_0x132011);_0x1009c8[_0x3a9038(0x1d0)](0x17,0x3b,0x3b,0x3e7),_0x24ef2e[_0x3a9038(0x197)]['lte']=_0x1009c8,console[_0x3a9038(0x264)]('ðŸ“…\x20Date\x20to\x20filter:\x20'+_0x1009c8[_0x3a9038(0x13e)]());}}_0x8cc7cd&&(_0x24ef2e['OR']=[{'id':{'contains':_0x8cc7cd,'mode':_0x3a9038(0x14e)}},{'orderId':{'contains':_0x8cc7cd,'mode':_0x3a9038(0x14e)}},{'gatewayOrderId':{'contains':_0x8cc7cd,'mode':_0x3a9038(0x14e)}},{'customerEmail':{'contains':_0x8cc7cd,'mode':_0x3a9038(0x14e)}},{'shop':{'name':{'contains':_0x8cc7cd,'mode':_0x3a9038(0x14e)}}},{'shop':{'username':{'contains':_0x8cc7cd,'mode':_0x3a9038(0x14e)}}}]);console['log'](_0x3a9038(0x142),JSON[_0x3a9038(0x184)](_0x24ef2e,null,0x2));let _0xc79de2={'createdAt':_0x3a9038(0x250)};if(_0x2e9ed8){const _0x3d2e00=[_0x3a9038(0x1d1),_0x3a9038(0x197),_0x3a9038(0x210),_0x3a9038(0x16a),_0x3a9038(0x246),_0x3a9038(0x236)],_0x54bdfa=[_0x3a9038(0x214),_0x3a9038(0x250)];if(_0x3d2e00[_0x3a9038(0x146)](_0x2e9ed8)){const _0x2029e3=_0x54bdfa['includes'](_0x1b5f76)?_0x1b5f76:_0x3a9038(0x250);_0xc79de2={[_0x2e9ed8]:_0x2029e3},console[_0x3a9038(0x264)](_0x3a9038(0x126)+_0x2e9ed8+'\x20in\x20'+_0x2029e3+_0x3a9038(0x1d7));}}const [_0x47dfaf,_0x518bd1]=await Promise['all']([database_1['default'][_0x3a9038(0x239)]['findMany']({'where':_0x24ef2e,'skip':_0x334e07,'take':_0x101d2b,'orderBy':_0xc79de2,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x3a9038(0x137)][_0x3a9038(0x239)]['count']({'where':_0x24ef2e})]);return{'payments':_0x47dfaf,'pagination':{'page':_0x5a524e,'limit':_0x101d2b,'total':_0x518bd1,'totalPages':Math[_0x3a9038(0x207)](_0x518bd1/_0x101d2b)}};}async[a46_0x1559bb(0x1b1)](_0x1316cd){const _0x8c6fb=a46_0x1559bb,_0x422694=await database_1[_0x8c6fb(0x137)][_0x8c6fb(0x239)][_0x8c6fb(0x26f)]({'where':{'id':_0x1316cd},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x422694)return null;return{'id':_0x422694['id'],'shopId':_0x422694[_0x8c6fb(0x16d)],'gateway':_0x422694[_0x8c6fb(0x246)],'amount':_0x422694[_0x8c6fb(0x1d1)],'currency':_0x422694[_0x8c6fb(0x236)],'status':_0x422694[_0x8c6fb(0x16a)],'orderId':_0x422694[_0x8c6fb(0x20f)],'gatewayOrderId':_0x422694[_0x8c6fb(0x21a)],'customerEmail':_0x422694['customerEmail'],'customerName':_0x422694[_0x8c6fb(0x251)],'customerCountry':_0x422694[_0x8c6fb(0x16e)],'customerIp':_0x422694[_0x8c6fb(0x1c5)],'customerUa':_0x422694['customerUa'],'failureMessage':_0x422694[_0x8c6fb(0x123)],'externalPaymentUrl':_0x422694[_0x8c6fb(0x1a3)],'successUrl':_0x422694['successUrl'],'failUrl':_0x422694[_0x8c6fb(0x229)],'pendingUrl':_0x422694[_0x8c6fb(0x1ad)],'whiteUrl':_0x422694[_0x8c6fb(0x218)],'createdAt':_0x422694[_0x8c6fb(0x197)],'updatedAt':_0x422694[_0x8c6fb(0x210)],'shop':_0x422694[_0x8c6fb(0x21e)]};}async['updatePaymentStatus'](_0x4ea184,_0x11d8e9,_0x1a7403,_0x4d9eca){const _0x29338c=a46_0x1559bb,_0x42db1b=await database_1['default'][_0x29338c(0x27d)](async _0x39f3d7=>{const _0x914d93=_0x29338c,_0x16f43f=await _0x39f3d7['payment']['findUnique']({'where':{'id':_0x4ea184},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x16f43f)throw new Error(_0x914d93(0x1d5));const _0x33ffc5=_0x16f43f[_0x914d93(0x16a)],_0x52c3e0=_0x11d8e9[_0x914d93(0x129)]();console['log'](_0x914d93(0x15b)+_0x4ea184+_0x914d93(0x1b3)+_0x33ffc5+_0x914d93(0x19a)+_0x52c3e0),console[_0x914d93(0x264)](_0x914d93(0x14a)+_0x16f43f[_0x914d93(0x21e)][_0x914d93(0x1a9)]+_0x914d93(0x1eb));const _0x109b38={'status':_0x52c3e0,'updatedAt':new Date(),'statusChangedBy':'admin','statusChangedAt':new Date()};_0x1a7403&&(_0x109b38[_0x914d93(0x169)]=_0x1a7403);_0x52c3e0===_0x914d93(0x25f)&&_0x4d9eca&&(_0x109b38[_0x914d93(0x143)]=_0x4d9eca);let _0x5988d6=0x0,_0xaedd3c=_0x16f43f[_0x914d93(0x21e)][_0x914d93(0x1a9)];if(_0x52c3e0===_0x914d93(0x20a)&&_0x33ffc5!==_0x914d93(0x20a)){_0x109b38['paidAt']=new Date();const _0x449a06=await currencyService_1[_0x914d93(0x15c)][_0x914d93(0x198)](_0x16f43f[_0x914d93(0x1d1)],_0x16f43f[_0x914d93(0x236)]);_0x109b38[_0x914d93(0x1ab)]=_0x449a06;let _0x3014b0=0x2d;const _0x46ae2d=await _0x39f3d7[_0x914d93(0x21e)][_0x914d93(0x26f)]({'where':{'id':_0x16f43f[_0x914d93(0x16d)]},'select':{'gatewaySettings':!![]}});if(_0x46ae2d?.[_0x914d93(0x175)])try{const _0x15a74d=JSON[_0x914d93(0x1ac)](_0x46ae2d['gatewaySettings']);for(const [_0x1d3df0,_0x6a48ea]of Object['entries'](_0x15a74d)){if(_0x1d3df0[_0x914d93(0x263)]()===_0x16f43f[_0x914d93(0x246)][_0x914d93(0x263)]()){_0x3014b0=_0x6a48ea['commission']||0xa;break;}}}catch(_0x3a9c27){console[_0x914d93(0x1b5)](_0x914d93(0x1aa)+_0x4ea184+':',_0x3a9c27);}let _0x3a6fce;_0x16f43f[_0x914d93(0x136)]!==null&&_0x16f43f[_0x914d93(0x136)]!==undefined?(_0x3a6fce=_0x16f43f[_0x914d93(0x136)],console[_0x914d93(0x264)]('ðŸ“Š\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20'+_0x3a6fce[_0x914d93(0x213)](0x6)+_0x914d93(0x17d)+_0x4ea184)):(_0x3a6fce=_0x449a06*(0x1-_0x3014b0/0x64),console[_0x914d93(0x264)](_0x914d93(0x1e9)+_0x4ea184+':\x20'+_0x3014b0+_0x914d93(0x23a)+_0x449a06[_0x914d93(0x213)](0x6)+_0x914d93(0x1eb)),_0x109b38['amountAfterGatewayCommissionUSDT']=_0x3a6fce,_0x109b38[_0x914d93(0x20c)]=_0x3014b0),_0x5988d6=_0x3a6fce,_0xaedd3c+=_0x3a6fce,console[_0x914d93(0x264)]('ðŸ’°\x20Payment\x20'+_0x4ea184+_0x914d93(0x11d)),console[_0x914d93(0x264)]('\x20\x20\x20Full\x20amount:\x20'+_0x449a06[_0x914d93(0x213)](0x6)+_0x914d93(0x1eb)),console[_0x914d93(0x264)](_0x914d93(0x235)+_0x16f43f['gateway']+_0x914d93(0x1e4)+_0x3014b0+'%'),console[_0x914d93(0x264)](_0x914d93(0x1f0)+_0x3a6fce[_0x914d93(0x213)](0x6)+_0x914d93(0x22c)+_0x3014b0+'%\x20commission)'),console[_0x914d93(0x264)]('\x20\x20\x20Added\x20to\x20balance:\x20+'+_0x3a6fce[_0x914d93(0x213)](0x6)+'\x20USDT');}else{if(_0x33ffc5==='PAID'&&_0x52c3e0!==_0x914d93(0x20a)&&_0x52c3e0!==_0x914d93(0x25f)){if(_0x16f43f[_0x914d93(0x1ab)]){let _0x428c04=0x2d;const _0x2f3962=await _0x39f3d7[_0x914d93(0x21e)][_0x914d93(0x26f)]({'where':{'id':_0x16f43f['shopId']},'select':{'gatewaySettings':!![]}});if(_0x2f3962?.[_0x914d93(0x175)])try{const _0x3f8201=JSON[_0x914d93(0x1ac)](_0x2f3962[_0x914d93(0x175)]);for(const [_0x3e383b,_0x1947b7]of Object[_0x914d93(0x10f)](_0x3f8201)){if(_0x3e383b[_0x914d93(0x263)]()===_0x16f43f[_0x914d93(0x246)][_0x914d93(0x263)]()){_0x428c04=_0x1947b7[_0x914d93(0x1cf)]||0xa;break;}}}catch(_0x11fd20){console[_0x914d93(0x1b5)](_0x914d93(0x1aa)+_0x4ea184+':',_0x11fd20);}const _0x45b8de=_0x16f43f[_0x914d93(0x1ab)]*(0x1-_0x428c04/0x64);_0x5988d6=-_0x45b8de,_0xaedd3c-=_0x45b8de,console[_0x914d93(0x264)]('\x20\x20\x20Full\x20amount:\x20'+_0x16f43f[_0x914d93(0x1ab)][_0x914d93(0x213)](0x6)+_0x914d93(0x1eb)),console[_0x914d93(0x264)](_0x914d93(0x235)+_0x16f43f[_0x914d93(0x246)]+_0x914d93(0x1e4)+_0x428c04+'%'),console[_0x914d93(0x264)](_0x914d93(0x1c4)+_0x45b8de[_0x914d93(0x213)](0x6)+_0x914d93(0x22c)+_0x428c04+_0x914d93(0x232)),console[_0x914d93(0x264)](_0x914d93(0x12f)+_0x45b8de[_0x914d93(0x213)](0x6)+_0x914d93(0x1eb));}}}_0x52c3e0===_0x914d93(0x25f)&&(console[_0x914d93(0x264)](_0x914d93(0x165)),_0x4d9eca&&_0x4d9eca>0x0?(_0x5988d6=-_0x4d9eca,_0xaedd3c-=_0x4d9eca,console[_0x914d93(0x264)](_0x914d93(0x1dc)+_0x4d9eca[_0x914d93(0x213)](0x6)+_0x914d93(0x237)),console['log']('ðŸ’°\x20Payment\x20amount\x20is\x20NOT\x20deducted\x20(chargeback\x20penalty\x20only)')):console['log'](_0x914d93(0x167)),_0x109b38[_0x914d93(0x143)]=_0x4d9eca||0x0);_0x52c3e0===_0x914d93(0x1b7)&&_0x33ffc5===_0x914d93(0x20a)&&console[_0x914d93(0x264)]('ðŸ”„\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance');const _0x42aa2f=await _0x39f3d7['payment']['update']({'where':{'id':_0x4ea184},'data':_0x109b38,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x5988d6!==0x0&&(await _0x39f3d7[_0x914d93(0x21e)]['update']({'where':{'id':_0x16f43f[_0x914d93(0x16d)]},'data':{'balance':_0xaedd3c}}),console[_0x914d93(0x264)](_0x914d93(0x234)+_0x16f43f[_0x914d93(0x16d)]+_0x914d93(0x267)+_0x16f43f[_0x914d93(0x21e)]['balance'][_0x914d93(0x213)](0x6)+_0x914d93(0x19a)+_0xaedd3c['toFixed'](0x6)+_0x914d93(0x1db)+(_0x5988d6>0x0?'+':'')+_0x5988d6[_0x914d93(0x213)](0x6)+')')),_0x42aa2f;});return{'id':_0x42db1b['id'],'shopId':_0x42db1b[_0x29338c(0x16d)],'gateway':_0x42db1b[_0x29338c(0x246)],'amount':_0x42db1b['amount'],'currency':_0x42db1b['currency'],'status':_0x42db1b[_0x29338c(0x16a)],'orderId':_0x42db1b[_0x29338c(0x20f)],'gatewayOrderId':_0x42db1b[_0x29338c(0x21a)],'customerEmail':_0x42db1b[_0x29338c(0x230)],'customerName':_0x42db1b[_0x29338c(0x251)],'customerCountry':_0x42db1b['customerCountry'],'customerIp':_0x42db1b['customerIp'],'customerUa':_0x42db1b['customerUa'],'failureMessage':_0x42db1b['failureMessage'],'adminNotes':_0x42db1b[_0x29338c(0x169)],'chargebackAmount':_0x42db1b[_0x29338c(0x143)],'statusChangedBy':_0x42db1b[_0x29338c(0x16b)],'statusChangedAt':_0x42db1b[_0x29338c(0x1e7)],'createdAt':_0x42db1b['createdAt'],'updatedAt':_0x42db1b[_0x29338c(0x210)],'shop':_0x42db1b['shop']};}async[a46_0x1559bb(0x1e3)](_0x2ea273,_0x3a3702){const _0x21eed3=a46_0x1559bb,_0x1e5a44=Math[_0x21eed3(0x115)]()[_0x21eed3(0x268)](0x24)[_0x21eed3(0x215)](0x2,0x9);console[_0x21eed3(0x264)](_0x21eed3(0x140)+_0x1e5a44+_0x21eed3(0x205)+_0x2ea273);const _0x3211f9={..._0x3a3702};_0x3a3702[_0x21eed3(0x194)]&&_0x3a3702[_0x21eed3(0x194)][_0x21eed3(0x23e)]()!==''?(console[_0x21eed3(0x264)](_0x21eed3(0x1a6)+_0x1e5a44+_0x21eed3(0x1b6)+_0x2ea273),_0x3211f9[_0x21eed3(0x194)]=await bcryptjs_1[_0x21eed3(0x137)]['hash'](_0x3a3702[_0x21eed3(0x194)],0xc)):(console[_0x21eed3(0x264)](_0x21eed3(0x1a6)+_0x1e5a44+_0x21eed3(0x1af)),delete _0x3211f9[_0x21eed3(0x194)]);_0x3a3702['fullName']&&(_0x3211f9[_0x21eed3(0x18b)]=_0x3a3702[_0x21eed3(0x203)],delete _0x3211f9[_0x21eed3(0x203)]);_0x3a3702[_0x21eed3(0x147)]&&(_0x3211f9['telegram']=_0x3a3702[_0x21eed3(0x147)],delete _0x3211f9['telegramId']);_0x3a3702['merchantUrl']&&(_0x3211f9[_0x21eed3(0x12b)]=_0x3a3702[_0x21eed3(0x14c)],delete _0x3211f9[_0x21eed3(0x14c)]);if(_0x3a3702[_0x21eed3(0x183)]){const _0x5b1abe=_0x3a3702['gateways'][_0x21eed3(0x185)](_0x54559d=>this[_0x21eed3(0x15a)](_0x54559d));console[_0x21eed3(0x264)]('ðŸ”„\x20Gateway\x20mapping:',_0x3a3702['gateways'],'->',_0x5b1abe),_0x3211f9[_0x21eed3(0x117)]=JSON[_0x21eed3(0x184)](_0x5b1abe),delete _0x3211f9['gateways'];}_0x3a3702[_0x21eed3(0x175)]&&(console[_0x21eed3(0x264)]('ðŸ”§\x20['+_0x1e5a44+_0x21eed3(0x15e),_0x3a3702[_0x21eed3(0x175)]),_0x3211f9[_0x21eed3(0x175)]=JSON['stringify'](_0x3a3702['gatewaySettings']),console[_0x21eed3(0x264)](_0x21eed3(0x155)+_0x1e5a44+_0x21eed3(0x195),_0x3211f9[_0x21eed3(0x175)]));_0x3a3702[_0x21eed3(0x1b4)]&&(_0x3a3702['wallets'][_0x21eed3(0x241)]!==undefined&&(_0x3211f9['usdtPolygonWallet']=_0x3a3702[_0x21eed3(0x1b4)]['usdtPolygonWallet']||null),_0x3a3702[_0x21eed3(0x1b4)]['usdtTrcWallet']!==undefined&&(_0x3211f9[_0x21eed3(0x1fc)]=_0x3a3702[_0x21eed3(0x1b4)]['usdtTrcWallet']||null),_0x3a3702[_0x21eed3(0x1b4)]['usdtErcWallet']!==undefined&&(_0x3211f9[_0x21eed3(0x1c8)]=_0x3a3702[_0x21eed3(0x1b4)][_0x21eed3(0x1c8)]||null),_0x3a3702['wallets']['usdcPolygonWallet']!==undefined&&(_0x3211f9['usdcPolygonWallet']=_0x3a3702[_0x21eed3(0x1b4)]['usdcPolygonWallet']||null),delete _0x3211f9[_0x21eed3(0x1b4)]);const _0x294754=await database_1['default'][_0x21eed3(0x21e)][_0x21eed3(0x1f2)]({'where':{'id':_0x2ea273},'data':_0x3211f9,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0x21eed3(0x264)](_0x21eed3(0x193)+_0x1e5a44+_0x21eed3(0x12d),_0x294754['gatewaySettings']),{'id':_0x294754['id'],'fullName':_0x294754[_0x21eed3(0x18b)],'username':_0x294754[_0x21eed3(0x1e0)],'telegramId':_0x294754['telegram'],'merchantUrl':_0x294754[_0x21eed3(0x12b)],'gateways':_0x294754[_0x21eed3(0x117)]?JSON[_0x21eed3(0x1ac)](_0x294754[_0x21eed3(0x117)]):null,'gatewaySettings':_0x294754[_0x21eed3(0x175)]?JSON[_0x21eed3(0x1ac)](_0x294754[_0x21eed3(0x175)]):null,'publicKey':_0x294754['publicKey'],'wallets':{'usdtPolygonWallet':_0x294754[_0x21eed3(0x241)],'usdtTrcWallet':_0x294754[_0x21eed3(0x1fc)],'usdtErcWallet':_0x294754[_0x21eed3(0x1c8)],'usdcPolygonWallet':_0x294754[_0x21eed3(0x159)]},'status':_0x294754[_0x21eed3(0x16a)],'createdAt':_0x294754[_0x21eed3(0x197)]};}async[a46_0x1559bb(0x141)](_0x1401d3){const _0x1bcc12=a46_0x1559bb,_0x5e3a69=await database_1[_0x1bcc12(0x137)][_0x1bcc12(0x21e)][_0x1bcc12(0x1f2)]({'where':{'id':_0x1401d3},'data':{'status':_0x1bcc12(0x1c6)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x5e3a69['id'],'fullName':_0x5e3a69[_0x1bcc12(0x18b)],'username':_0x5e3a69[_0x1bcc12(0x1e0)],'telegramId':_0x5e3a69[_0x1bcc12(0x188)],'merchantUrl':_0x5e3a69['shopUrl'],'gateways':_0x5e3a69[_0x1bcc12(0x117)]?JSON[_0x1bcc12(0x1ac)](_0x5e3a69['paymentGateways']):null,'gatewaySettings':_0x5e3a69[_0x1bcc12(0x175)]?JSON[_0x1bcc12(0x1ac)](_0x5e3a69[_0x1bcc12(0x175)]):null,'publicKey':_0x5e3a69[_0x1bcc12(0x134)],'wallets':{'usdtPolygonWallet':_0x5e3a69['usdtPolygonWallet'],'usdtTrcWallet':_0x5e3a69[_0x1bcc12(0x1fc)],'usdtErcWallet':_0x5e3a69[_0x1bcc12(0x1c8)],'usdcPolygonWallet':_0x5e3a69[_0x1bcc12(0x159)]},'status':_0x5e3a69['status'],'createdAt':_0x5e3a69[_0x1bcc12(0x197)]};}async[a46_0x1559bb(0x21f)](_0x34112e){const _0x6de1d=a46_0x1559bb,_0xb4353e=await database_1[_0x6de1d(0x137)][_0x6de1d(0x21e)]['update']({'where':{'id':_0x34112e},'data':{'status':_0x6de1d(0x1e8)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0xb4353e['id'],'fullName':_0xb4353e[_0x6de1d(0x18b)],'username':_0xb4353e[_0x6de1d(0x1e0)],'telegramId':_0xb4353e[_0x6de1d(0x188)],'merchantUrl':_0xb4353e['shopUrl'],'gateways':_0xb4353e['paymentGateways']?JSON[_0x6de1d(0x1ac)](_0xb4353e[_0x6de1d(0x117)]):null,'gatewaySettings':_0xb4353e[_0x6de1d(0x175)]?JSON['parse'](_0xb4353e[_0x6de1d(0x175)]):null,'publicKey':_0xb4353e[_0x6de1d(0x134)],'wallets':{'usdtPolygonWallet':_0xb4353e[_0x6de1d(0x241)],'usdtTrcWallet':_0xb4353e['usdtTrcWallet'],'usdtErcWallet':_0xb4353e[_0x6de1d(0x1c8)],'usdcPolygonWallet':_0xb4353e[_0x6de1d(0x159)]},'status':_0xb4353e[_0x6de1d(0x16a)],'createdAt':_0xb4353e[_0x6de1d(0x197)]};}async[a46_0x1559bb(0x13f)](_0x3d031a){const _0x31eb5d=a46_0x1559bb,{page:_0x347253,limit:_0x487c60,status:_0x48381a}=_0x3d031a,_0x131436=(_0x347253-0x1)*_0x487c60,_0x2cc522={};_0x48381a&&(_0x2cc522[_0x31eb5d(0x16a)]=_0x48381a[_0x31eb5d(0x129)]());const [_0x24b708,_0x2b3823]=await Promise[_0x31eb5d(0x23c)]([database_1['default'][_0x31eb5d(0x21e)][_0x31eb5d(0x158)]({'where':_0x2cc522,'skip':_0x131436,'take':_0x487c60,'orderBy':{'createdAt':_0x31eb5d(0x250)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x31eb5d(0x137)][_0x31eb5d(0x21e)]['count']({'where':_0x2cc522})]);return{'users':_0x24b708['map'](_0x2189f9=>{const _0x4ed7e0=_0x31eb5d,_0xc4e5f4=_0x2189f9[_0x4ed7e0(0x117)]?JSON[_0x4ed7e0(0x1ac)](_0x2189f9[_0x4ed7e0(0x117)]):null,_0x178ab=_0xc4e5f4?_0xc4e5f4[_0x4ed7e0(0x185)](_0x2fba8b=>this[_0x4ed7e0(0x166)](_0x2fba8b)):null;return{'id':_0x2189f9['id'],'fullName':_0x2189f9[_0x4ed7e0(0x18b)],'username':_0x2189f9[_0x4ed7e0(0x1e0)],'telegramId':_0x2189f9[_0x4ed7e0(0x188)],'merchantUrl':_0x2189f9[_0x4ed7e0(0x12b)],'gateways':_0x178ab,'gatewaySettings':_0x2189f9[_0x4ed7e0(0x175)]?JSON[_0x4ed7e0(0x1ac)](_0x2189f9[_0x4ed7e0(0x175)]):null,'publicKey':_0x2189f9[_0x4ed7e0(0x134)],'wallets':{'usdtPolygonWallet':_0x2189f9[_0x4ed7e0(0x241)],'usdtTrcWallet':_0x2189f9[_0x4ed7e0(0x1fc)],'usdtErcWallet':_0x2189f9[_0x4ed7e0(0x1c8)],'usdcPolygonWallet':_0x2189f9[_0x4ed7e0(0x159)]},'status':_0x2189f9[_0x4ed7e0(0x16a)],'createdAt':_0x2189f9['createdAt']};}),'pagination':{'page':_0x347253,'limit':_0x487c60,'total':_0x2b3823,'totalPages':Math[_0x31eb5d(0x207)](_0x2b3823/_0x487c60)}};}async[a46_0x1559bb(0x1d2)](_0xe600db){const _0x3d4160=a46_0x1559bb,_0x2c517d=await database_1[_0x3d4160(0x137)]['shop'][_0x3d4160(0x26f)]({'where':{'id':_0xe600db},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x2c517d)return null;const _0x55547e=_0x2c517d[_0x3d4160(0x117)]?JSON['parse'](_0x2c517d[_0x3d4160(0x117)]):null,_0x3d2102=_0x55547e?_0x55547e[_0x3d4160(0x185)](_0x2f7dac=>this[_0x3d4160(0x166)](_0x2f7dac)):null;return _0x55547e&&_0x3d2102&&console['log'](_0x3d4160(0x247),_0x55547e,'->',_0x3d2102),{'id':_0x2c517d['id'],'fullName':_0x2c517d[_0x3d4160(0x18b)],'username':_0x2c517d[_0x3d4160(0x1e0)],'telegramId':_0x2c517d['telegram'],'merchantUrl':_0x2c517d[_0x3d4160(0x12b)],'gateways':_0x3d2102,'gatewaySettings':_0x2c517d[_0x3d4160(0x175)]?JSON[_0x3d4160(0x1ac)](_0x2c517d[_0x3d4160(0x175)]):null,'publicKey':_0x2c517d[_0x3d4160(0x134)],'wallets':{'usdtPolygonWallet':_0x2c517d[_0x3d4160(0x241)],'usdtTrcWallet':_0x2c517d[_0x3d4160(0x1fc)],'usdtErcWallet':_0x2c517d[_0x3d4160(0x1c8)],'usdcPolygonWallet':_0x2c517d[_0x3d4160(0x159)]},'status':_0x2c517d[_0x3d4160(0x16a)],'createdAt':_0x2c517d['createdAt']};}async['createUser'](_0xfc0cd1){const _0x3dde63=a46_0x1559bb,{fullName:_0x3c24b7,username:_0x508ee8,password:_0x43e383,telegramId:_0x4e6d46,merchantUrl:_0x137cbf,gateways:_0xed1d60,gatewaySettings:_0x5963e3,wallets:_0x478ab5}=_0xfc0cd1,_0x57ce97=await database_1[_0x3dde63(0x137)][_0x3dde63(0x21e)][_0x3dde63(0x26f)]({'where':{'username':_0x508ee8}});if(_0x57ce97)throw new Error('Username\x20already\x20exists');if(_0x4e6d46){const _0x2bd268=await database_1[_0x3dde63(0x137)][_0x3dde63(0x21e)][_0x3dde63(0x26f)]({'where':{'telegram':_0x4e6d46}});if(_0x2bd268)throw new Error(_0x3dde63(0x1ea));}const _0x1d2d9e=await bcryptjs_1[_0x3dde63(0x137)][_0x3dde63(0x223)](_0x43e383,0xc),_0x3a3ffe=_0x3dde63(0x133)+crypto_1[_0x3dde63(0x137)][_0x3dde63(0x22f)](0x20)[_0x3dde63(0x268)](_0x3dde63(0x259)),_0x3d6394=_0x3dde63(0x1ff)+crypto_1[_0x3dde63(0x137)]['randomBytes'](0x20)[_0x3dde63(0x268)](_0x3dde63(0x259)),_0x44b790=_0xed1d60?_0xed1d60['map'](_0xa0770=>this[_0x3dde63(0x15a)](_0xa0770)):null;_0xed1d60&&_0x44b790&&console['log'](_0x3dde63(0x1a2),_0xed1d60,'->',_0x44b790);const _0x23793c=await database_1['default'][_0x3dde63(0x21e)][_0x3dde63(0x19e)]({'data':{'name':_0x3c24b7,'username':_0x508ee8,'password':_0x1d2d9e,'telegram':_0x4e6d46,'shopUrl':_0x137cbf,'paymentGateways':_0x44b790?JSON[_0x3dde63(0x184)](_0x44b790):null,'gatewaySettings':_0x5963e3?JSON[_0x3dde63(0x184)](_0x5963e3):null,'usdtPolygonWallet':_0x478ab5?.[_0x3dde63(0x241)]||null,'usdtTrcWallet':_0x478ab5?.[_0x3dde63(0x1fc)]||null,'usdtErcWallet':_0x478ab5?.[_0x3dde63(0x1c8)]||null,'usdcPolygonWallet':_0x478ab5?.[_0x3dde63(0x159)]||null,'publicKey':_0x3a3ffe,'secretKey':_0x3d6394,'status':_0x3dde63(0x1e8)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x23793c['id'],'fullName':_0x23793c[_0x3dde63(0x18b)],'username':_0x23793c[_0x3dde63(0x1e0)],'telegramId':_0x23793c[_0x3dde63(0x188)],'merchantUrl':_0x23793c[_0x3dde63(0x12b)],'gateways':_0x23793c[_0x3dde63(0x117)]?JSON['parse'](_0x23793c[_0x3dde63(0x117)]):null,'gatewaySettings':_0x23793c[_0x3dde63(0x175)]?JSON[_0x3dde63(0x1ac)](_0x23793c[_0x3dde63(0x175)]):null,'publicKey':_0x23793c[_0x3dde63(0x134)],'wallets':{'usdtPolygonWallet':_0x23793c[_0x3dde63(0x241)],'usdtTrcWallet':_0x23793c[_0x3dde63(0x1fc)],'usdtErcWallet':_0x23793c[_0x3dde63(0x1c8)],'usdcPolygonWallet':_0x23793c[_0x3dde63(0x159)]},'status':_0x23793c[_0x3dde63(0x16a)],'createdAt':_0x23793c[_0x3dde63(0x197)]};}async[a46_0x1559bb(0x1ee)](_0x2fe4f3){const _0x42b4b9=a46_0x1559bb;await database_1[_0x42b4b9(0x137)][_0x42b4b9(0x21e)]['delete']({'where':{'id':_0x2fe4f3}});}['generateDailyStatistics'](_0x1f0824,_0x4809c2,_0xaf6631){const _0x251d01=a46_0x1559bb,_0x3302e1=new Map(),_0x39a820=new Date(_0x4809c2);while(_0x39a820<=_0xaf6631){const _0x4b7dca=_0x39a820[_0x251d01(0x13e)]()[_0x251d01(0x23d)]('T')[0x0];_0x3302e1[_0x251d01(0x1f6)](_0x4b7dca,{'revenue':0x0,'count':0x0}),_0x39a820[_0x251d01(0x163)](_0x39a820[_0x251d01(0x12c)]()+0x1);}for(const _0x16c14a of _0x1f0824){const _0xaff62b=_0x16c14a[_0x251d01(0x197)]['toISOString']()[_0x251d01(0x23d)]('T')[0x0],_0x15cad7=_0x3302e1[_0x251d01(0x160)](_0xaff62b);_0x15cad7&&(_0x15cad7[_0x251d01(0x157)]+=0x1,_0x16c14a[_0x251d01(0x16a)]==='PAID'&&(_0x16c14a['amountUSDT']?_0x15cad7[_0x251d01(0x1d6)]+=_0x16c14a[_0x251d01(0x1ab)]:console['log'](_0x251d01(0x1fb)+_0x16c14a['id']+_0x251d01(0x13b))));}const _0x2bba74=[],_0x36db64=[];for(const [_0x555ce5,_0x37e591]of _0x3302e1){_0x2bba74[_0x251d01(0x22d)]({'date':_0x555ce5,'amount':Math[_0x251d01(0x1d3)](_0x37e591[_0x251d01(0x1d6)]*0x64)/0x64}),_0x36db64[_0x251d01(0x22d)]({'date':_0x555ce5,'count':_0x37e591[_0x251d01(0x157)]});}return{'dailyRevenue':_0x2bba74,'dailyPayments':_0x36db64};}}function a46_0x1dd8(){const _0x5f2a03=['paymentGateways','ðŸ“Š\x20Calculating\x20payout\x20statistics...',',\x20chargebacks:\x20','\x20\x20\x20Available\x20(raw):\x20','\x20\x20\x20Balance:\x20','sendPayoutNotification','\x20became\x20PAID:','\x20\x20\x20â³\x20Awaiting\x20payout:\x20','2085312ZIuNsO','deletePayout','custom_','\x20\x20\x20ðŸ’°\x20Total\x20payments\x20turnover:\x20','failureMessage','polygon','\x20USDT\x20(+','ðŸ“Š\x20Sorting\x20payments\x20by\x20','âœ…\x20Balance\x20check\x20passed\x20(with\x20tolerance)','714429pCKQPM','toUpperCase','getGatewayNameById','shopUrl','getDate',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','week','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','sort','erc20','this_week','pk_','publicKey','ðŸ”\x20Selected\x20erc20_usdc\x20wallet:\x20','amountAfterGatewayCommissionUSDT','default','\x20\x20\x20ðŸ’¸\x20Total\x20payouts\x20(all\x20time):\x20','âš ï¸\x20Requested\x20gateway\x20\x27','\x20\x20\x20Current\x20balance:\x20','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','length','values','toISOString','getAllUsers','ðŸŽ¯\x20updateUser\x20called\x20with\x20ID:\x20','suspendUser','ðŸ“Š\x20Final\x20WHERE\x20conditions:','chargebackAmount','KLYME\x20GB','\x20\x20\x20ðŸ¤”\x20Difference:\x20','includes','telegramId','not\x20set','averageCheckUSDT','ðŸ’°\x20Current\x20shop\x20balance:\x20','month','merchantUrl','2549684XCkqoc','insensitive','AdminService','createPayout','./currencyService','ðŸ“Š\x20Payout\x20statistics\x20calculated:','paidAt','cointopay2','ðŸ”§\x20[','\x20merchants\x20for\x20selection','count','findMany','usdcPolygonWallet','getGatewayInternalName','ðŸ”„\x20Admin\x20updating\x20payment\x20','currencyService','merchantEarningsUSDT',']\x20Gateway\x20settings\x20before\x20saving:','period','get','\x20\x20\x20Final\x20payout\x20amount\x20used:\x20','./telegramBotService','setDate','cointopay','ðŸ’¸\x20CHARGEBACK:\x20Processing\x20penalty-only\x20deduction','getGatewayDisplayName','âš ï¸\x20CHARGEBACK\x20without\x20penalty\x20amount\x20-\x20no\x20balance\x20change','telegramBotService','adminNotes','status','statusChangedBy','\x27\x20->\x20ID\x20\x27','shopId','customerCountry','ðŸ“‹\x20Getting\x20merchants\x20selection\x20list...','\x20\x20\x20ï¿½ðŸ“Š\x20Total\x20payments:\x20','\x20\x20\x20ðŸŒ\x20IP:\x20','ðŸ“‹\x20Found\x20','forEach','wallet','gatewaySettings','\x20\x20\x20Payout\x20amount:\x20','getAllPayouts','ðŸ“…\x20Payout\x20date\x20from\x20filter:\x20','\x20USDT\x20(already\x20paid\x20out)','\x20with\x20payout\x20history','ðŸ”\x20Shop\x20wallets:','thisMonth','\x20USDT\x20for\x20payment\x20','year','11VVXzwi','\x20\x20\x20Difference:\x20','\x20USDT\x20(gross\x20revenue)','updateCustomerData','gateways','stringify','map','periodFrom','20BLiRPh','telegram','\x20\x20\x20Requested\x20(number):\x20','\x20\x20\x20ï¿½\x20Total\x20payments\x20turnover:\x20','name','ðŸ“Š\x20Merchants\x20with\x20rounded\x20balance\x20!=\x200.00:\x20','\x20USDT\x20(theoretical\x20net)','\x20\x20\x20ðŸ’µ\x20Available\x20balance:\x20','filter','klyme_de','periodTo','ðŸ“Š\x20Getting\x20merchant\x20statistics\x20with\x20filters:','ðŸŽ¯\x20[','password',']\x20Gateway\x20settings\x20JSON\x20string:','1639875jBXTfh','createdAt','convertToUSDT','payout','\x20->\x20',':\x20commission\x20=\x20','totalAmountUSDT','getMonth','create','dailyRevenue','ðŸ”„\x20Converted\x20gateway\x20ID\x20\x27','customerUa','ðŸ”„\x20Gateway\x20mapping\x20(create):','externalPaymentUrl','\x20\x20\x20ðŸª\x20Gateway\x20earnings:\x20','âœ…\x20Payout\x20created:\x20','ðŸ”\x20[','\x20USDT\x20(current\x20balance\x20in\x20DB)','payouts','balance','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','amountUSDT','parse','pendingUrl','erc20_usdc',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','polygon_usdc','getPaymentById','gatewayEarnings','\x20status:\x20','wallets','error',']\x20Updating\x20password\x20for\x20user\x20','REFUND','5GxzFov','\x20\x20\x20ðŸ’°\x20Total\x20turnover:\x20','\x20\x20\x20ðŸ”\x20Calculated\x20after\x20commission:\x20','gte','ðŸ’°\x20Found\x20','\x20\x20\x20ðŸ’°\x20Total\x20payout:\x20','not\x20provided','getMerchantsAwaitingPayout','5114022pHJMAH','\x27\x20to\x20name\x20\x27','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','groupBy','\x20\x20\x20Merchant\x20loses:\x20','customerIp','SUSPENDED','__importDefault','usdtErcWallet','\x20PAID\x20payments','dateFrom','paymentsCount','ðŸ’°\x20[PAYOUT]\x20Merchant\x20','../types/gateway','usdcErcWallet','commission','setHours','amount','getUserById','round','merchantEarnings','Payment\x20not\x20found','revenue','\x20order','Insufficient\x20balance.\x20Available:\x20','\x20\x20\x20ðŸ’³\x20Total\x20payments:\x20','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','\x20USDT\x20(','ðŸ’¸\x20CHARGEBACK\x20penalty\x20ONLY:\x20-','_sum','ðŸ”\x20Selected\x20erc20\x20wallet:\x20','startsWith','username','turnoverUSDT','availableBalance','updateUser',',\x20Commission:\x20','âœ…\x20Using\x20gateway\x20filter:\x20\x27','getAllPayments','statusChangedAt','ACTIVE','ðŸ“Š\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','Telegram\x20username\x20already\x20exists','\x20USDT','txid','aggregate','deleteUser','mastercard','\x20\x20\x20Merchant\x20gets:\x20','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','update','today','\x27\x20(from\x20\x27','ðŸ”\x20Selected\x20polygon_usdc\x20wallet:\x20','set','rapyd','\x20\x20\x20ðŸ’¸\x20Total\x20payouts:\x20','\x20\x20\x20ðŸ–¥ï¸\x20User\x20Agent:\x20','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','âš ï¸\x20Payment\x20','usdtTrcWallet','ðŸ”\x20Using\x20gateway\x20\x27','generateDailyStatistics','sk_','toLocaleDateString','turnover','ðŸ’±\x20Currency\x20filter\x20applied:\x20','fullName','\x20merchants',',\x20userId:\x20','\x20USDT,\x20Difference:\x20','ceil','21776412NhDDZx','\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)','PAID','ðŸ“Š\x20Using\x20saved\x20values\x20for\x20payment\x20','gatewayCommissionRate','averageCommissionRate','CoinToPay','orderId','updatedAt','plisio','âœ…\x20Customer\x20data\x20updated\x20for\x20payment\x20','toFixed','asc','substr','test_gateway','\x20-\x20','whiteUrl','âœ…\x20Payout\x20created\x20in\x20DB:','gatewayOrderId','âœ…\x20Using\x20wallet\x20from\x20request:\x20','getSystemStatistics','\x20\x20\x20ðŸ‘¤\x20Merchant\x20earnings:\x20','shop','activateUser','\x20\x20\x20â³\x20Pending\x20payout:\x20','getTime','\x20USDT\x20(same\x20as\x20awaiting)','hash','amountAfterCommissionUSDT','dateTo','totalTurnover','totalPaidOut','PENDING','failUrl','\x20balance\x20updated:','Open\x20Banking\x202','\x20USDT\x20(after\x20','push','ru-RU','randomBytes','customerEmail','\x20\x20\x20ðŸ“…\x20Total\x20payouts\x20(this\x20month):\x20','%\x20commission)','network','ðŸ’°\x20Shop\x20','\x20\x20\x20Gateway:\x20','currency','\x20USDT\x20from\x20balance','min','payment','%\x20from\x20','join','all','split','trim','ðŸ“Š\x20Total\x20payments\x20(including\x20failed):\x20','ðŸ“Š\x20Calculated\x20commission\x20rate\x20for\x20payment\x20','usdtPolygonWallet','floor','\x27\x20->\x20name\x20\x27','ðŸ”\x20Creating\x20payout\x20with\x20data:','\x20\x20\x20ðŸŒ\x20Country:\x20','gateway','ðŸ”„\x20Gateway\x20mapping\x20(get):','findFirst','ðŸ”\x20Balance\x20check\x20details:','ðŸ’³\x20Final\x20payout\x20wallet\x20for\x20','ðŸ“Š\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20','delete','replace','944666pWriFn','ðŸ“Š\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','desc','customerName','pendingPayout','\x20USDT\x20(-',',\x20refunds:\x20','totalPayments','getPayoutStats','ðŸ“Š\x20Getting\x20payments\x20with\x20filters:','totalPayout','hex','localeCompare','getFullYear','MasterCard','slice','getDay','CHARGEBACK','ðŸ“Š\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','ðŸ“…\x20Date\x20from\x20filter:\x20','getGatewayIdByName','toLowerCase','log','\x20USDT\x20(rounded\x20to\x202\x20decimal\x20places)','_count','\x20balance\x20updated:\x20','toString','ðŸ’°\x20Creating\x20payout\x20for\x20shop\x20','not\x20specified','custom','last_month','1TSrgiy','bcryptjs','findUnique','ðŸ”\x20Selected\x20polygon\x20wallet:\x20','7purSMn','\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)','COMPLETED','reduce','yesterday','\x20merchants\x20with\x20rounded\x20balance\x20!=\x200.00\x20(excluding\x20balances\x20that\x20round\x20to\x200.00)','\x20for\x20shop\x20','\x20\x20\x20ðŸ“…\x20This\x20month:\x20','\x20\x20\x20âœ…\x20Total\x20net\x20balances:\x20','notes','warn','klyme_gb','$transaction','__esModule','commissionUSDT','entries','\x20USDT,\x20merchant:\x20','Plisio','ðŸ”„\x20Updating\x20customer\x20data\x20for\x20payment\x20','\x20USDT)','\x20\x20\x20ï¿½\x20Total\x20paid\x20out:\x20','random','totalCommissionRate'];a46_0x1dd8=function(){return _0x5f2a03;};return a46_0x1dd8();}exports['AdminService']=AdminService;