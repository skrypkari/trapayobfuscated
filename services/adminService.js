'use strict';function a40_0x202a(_0xe5b974,_0x587d29){const _0x31a1e9=a40_0x31a1();return a40_0x202a=function(_0x202a0c,_0x1b109a){_0x202a0c=_0x202a0c-0x1b4;let _0x41b8e3=_0x31a1e9[_0x202a0c];return _0x41b8e3;},a40_0x202a(_0xe5b974,_0x587d29);}const a40_0x5b1af8=a40_0x202a;(function(_0x28508b,_0x3fba57){const _0x3a65c4=a40_0x202a,_0x5e48a2=_0x28508b();while(!![]){try{const _0x544f34=-parseInt(_0x3a65c4(0x2d5))/0x1*(parseInt(_0x3a65c4(0x210))/0x2)+parseInt(_0x3a65c4(0x1e5))/0x3+-parseInt(_0x3a65c4(0x224))/0x4+-parseInt(_0x3a65c4(0x2a0))/0x5*(-parseInt(_0x3a65c4(0x259))/0x6)+-parseInt(_0x3a65c4(0x2c1))/0x7+parseInt(_0x3a65c4(0x2d2))/0x8*(-parseInt(_0x3a65c4(0x22d))/0x9)+parseInt(_0x3a65c4(0x30e))/0xa;if(_0x544f34===_0x3fba57)break;else _0x5e48a2['push'](_0x5e48a2['shift']());}catch(_0x2a9d38){_0x5e48a2['push'](_0x5e48a2['shift']());}}}(a40_0x31a1,0x7d94c));function a40_0x31a1(){const _0x5aa093=['1097136spgeSx','customerIp','getGatewayIdByName','\x20\x20\x20✅\x20Actual\x20available\x20balance:\x20','dateFrom','toFixed','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','getPaymentById','findUnique','🔧\x20[','🔄\x20Admin\x20updating\x20payment\x20','💰\x20Shop\x20','klyme_de','🔄\x20Gateway\x20mapping\x20(get):','🔍\x20Initial\x20wallet\x20from\x20request:\x20','⚠️\x20Payment\x20','\x20to\x20','./currencyService','wallets','shopUrl','all','%\x20commission)','updateUser','test_gateway','✅\x20Using\x20gateway\x20filter:\x20\x27','📅\x20Payout\x20date\x20from\x20filter:\x20','period','\x20\x20\x20Difference:\x20','crypto','NONEXISTENT_GATEWAY_FILTER','📅\x20Payout\x20date\x20to\x20filter:\x20','shopId','🎯\x20[','📋\x20Found\x20','CHARGEBACK','round','thisMonth','username','ceil','currencyService','amount','\x20\x20\x20Current\x20balance:\x20','map','1370FDYbot','fullName','getGatewayDisplayName','📊\x20Merchant\x20statistics\x20calculated:','\x20payments)','%\x20from\x20','\x20for\x20shop\x20','error','toUpperCase','\x27\x20not\x20found.\x20Available\x20gateways:\x20','periodTo','\x20\x20\x20Total\x20paid\x20out:\x20','createPayout','\x20active\x20merchants\x20for\x20selection','not\x20specified','getMonth','telegram','push','turnover','$transaction','714320DQpaez','updateCustomerData','createUser','log',']\x20Gateway\x20settings\x20before\x20saving:','year','paymentGateways','payout','\x20\x20\x20Added\x20to\x20balance:\x20+','18apKxAr','\x20USDT)','shop','random','\x20order','KLYME\x20GB','\x20\x20\x20Tolerance:\x20','hex','🔍\x20Shop\x20wallets:','\x20USDT\x20(current\x20balance\x20in\x20DB)','🔐\x20[','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','Shop\x20not\x20found',',\x20Commission:\x20','averageCommissionRate','📅\x20Period:\x20','\x20\x20\x20�\x20Total\x20paid\x20out:\x20','count','suspendUser','groupBy','findMany','gatewayOrderId','🔍\x20Balance\x20check\x20details:','parse','📊\x20Calculated\x20commission\x20rate\x20for\x20payment\x20','usdtPolygonWallet','totalCommissionRate','📊\x20Using\x20saved\x20values\x20for\x20payment\x20','\x20USDT\x20(already\x20paid\x20out)','adminNotes','stringify','customerName','default','plisio','\x20\x20\x20💰\x20Total\x20payments\x20turnover:\x20','gte','\x27\x20->\x20name\x20\x27','dailyRevenue','toString','\x20\x20\x20🌍\x20Country:\x20','🔄\x20Converted\x20gateway\x20ID\x20\x27','getGatewayNameById','deletePayout','\x27\x20to\x20name\x20\x27','679134KpBCAX','0000','2020-01-01','\x20merchants\x20with\x20rounded\x20balance\x20!=\x200.00\x20(excluding\x20balances\x20that\x20round\x20to\x200.00)','amountAfterGatewayCommissionUSDT','\x20\x20\x20Merchant\x20gets:\x20','statusChangedAt','💰\x20Current\x20shop\x20balance:\x20','\x20USDT','\x20with\x20payout\x20history','\x20USDT\x20(gross\x20revenue)','90d','\x20USDT\x20(after\x20','values','getGatewayInternalName','turnoverUSDT','publicKey','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','Rapyd','\x20USDT\x20(+','externalPaymentUrl','lte','\x20USDT\x20(same\x20as\x20awaiting)','createdAt','month','entries','cointopay','KLYME\x20EU','customerUa','\x20USDT\x20(-','status','gatewaySettings','updatedAt','generateDailyStatistics',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','date','usdtTrcWallet','currency','trim','🎯\x20updateUser\x20called\x20with\x20ID:\x20','chargebackAmount','\x20\x20\x20💰\x20Total\x20turnover:\x20','admin','SUSPENDED','⚠️\x20Requested\x20gateway\x20\x27','💸\x20CHARGEBACK:\x20Processing\x20penalty-only\x20deduction','\x20USDT\x20(rounded\x20to\x202\x20decimal\x20places)','gateway','insensitive','includes','dailyPayments','getAllPayouts','🔍\x20Selected\x20erc20_usdc\x20wallet:\x20','🔍\x20Using\x20gateway\x20\x27','length','\x20\x20\x20�\x20Total\x20payments\x20turnover:\x20','paymentsCount','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','\x20\x20\x20✅\x20Total\x20net\x20balances:\x20','localeCompare','not\x20set','gatewayCommissionRate','balance','dateTo','some','totalPayout','\x20\x20\x20Full\x20amount:\x20','\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)','\x20USDT\x20(','getPayoutStats','updatePaymentStatus','15IPBnwo','toISOString','MasterCard','PENDING','🔍\x20No\x20wallet\x20provided,\x20looking\x20up\x20from\x20shop\x20settings...','week','totalAmountAfterCommissionUSDT','trc20','Test\x20Gateway','successUrl','paidOutUSDT','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','cointopay2','aggregate','statusChangedBy','📋\x20Getting\x20merchants\x20selection\x20list...','\x20USDT\x20(total\x20paid\x20to\x20merchants)','payment','\x20\x20\x20Requested\x20(number):\x20','totalPayments','totalPaidOut','\x20merchants','gateways','asc','availableBalance','getDate','notes','\x20paid\x20payments\x20for\x20analysis','🔍\x20Selected\x20polygon_usdc\x20wallet:\x20','getFullYear','Noda','📊\x20Available\x20gateways\x20in\x20database:','💰\x20Creating\x20payout\x20for\x20shop\x20','4897627yhDjJT','totalTurnover','password','amountAfterCommissionUSDT','revenue','\x20\x20\x20Gateway:\x20','customerCountry','merchantEarnings','\x20\x20\x20💵\x20Available\x20balance:\x20','\x20status:\x20','toLowerCase',']\x20Gateway\x20settings\x20JSON\x20string:','\x20USDT\x20(theoretical\x20net)','awaitingPayout','\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...','commissionUSDT','📅\x20Date\x20to\x20filter:\x20','2574904hdQvyl','network','getTime','114ncNKbZ','getAllPayments','telegramId','erc20_usdc','📊\x20Sorting\x20payments\x20by\x20','🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','amountUSDT','\x20\x20\x20💳\x20Total\x20payments:\x20','COMPLETED','\x20\x20\x20🔍\x20Calculated\x20after\x20commission:\x20','Payment\x20not\x20found','KLYME\x20DE','join','\x20\x20\x20📅\x20This\x20month:\x20','CoinToPay','\x20\x20\x20Available\x20(number):\x20','\x20USDT,\x20merchant:\x20','whiteUrl','📅\x20Date\x20from\x20filter:\x20','usdcErcWallet','\x20\x20\x20🖥️\x20User\x20Agent:\x20','not\x20provided','📊\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','📊\x20Gateway\x20filter\x20applied:','Plisio','\x20USDT,\x20Requested:\x20','usdcPolygonWallet','\x27\x20(from\x20\x27','sort','\x20\x20\x20💸\x20Total\x20payouts\x20(all\x20time):\x20','PAID','substr','_count','⚠️\x20Gateway\x20\x27','💰\x20Payment\x20amount\x20is\x20NOT\x20deducted\x20(chargeback\x20penalty\x20only)','findFirst','\x20USDT\x20for\x20payment\x20',',\x20successful:\x20','💳\x20Final\x20payout\x20wallet\x20for\x20','klyme_eu','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','usdtErcWallet','🔄\x20Gateway\x20mapping:','Username\x20already\x20exists','setHours','ACTIVE','totalAmountUSDT','deleteUser','commission','yesterday','\x20\x20\x20Available\x20(raw):\x20','merchantUrl','delete','custom','💰\x20Found\x20','getPayoutById','txid','14091580ggnHbt',':\x20commission\x20=\x20','\x20->\x20','\x27\x20->\x20ID\x20\x27','setDate','pendingUrl','averageCheckUSDT','⚠️\x20CHARGEBACK\x20without\x20penalty\x20amount\x20-\x20no\x20balance\x20change','create','getMerchantsAwaitingPayout','Open\x20Banking\x202','✅\x20Balance\x20check\x20passed\x20(with\x20tolerance)','klyme_gb','sk_','customerEmail','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','polygon','periodFrom','\x20\x20\x20💸\x20Total\x20payouts:\x20','__esModule','\x20\x20\x20Final\x20payout\x20amount\x20used:\x20','\x20USDT\x20from\x20balance','convertToUSDT','📊\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','name','_sum','📊\x20Final\x20WHERE\x20conditions:','\x20\x20\x20Balance:\x20','merchantEarningsUSDT','slice',']\x20Updating\x20password\x20for\x20user\x20','paidAt','\x20\x20\x20⏳\x20Pending\x20payout:\x20','hash','set','failureMessage','🔄\x20Gateway\x20mapping\x20(create):','💰\x20[PAYOUT]\x20Gateway\x20','Insufficient\x20balance.\x20Available:\x20','getAllUsers',',\x20userId:\x20','wallet','split','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','📊\x20Calculating\x20payout\x20statistics...','AdminService','📊\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','orderId','Telegram\x20username\x20already\x20exists','update',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','📊\x20Payout\x20statistics\x20calculated:','forEach','gatewayEarnings','defineProperty','📊\x20Merchants\x20with\x20rounded\x20balance\x20!=\x200.00:\x20','reduce','\x20\x20\x20🌐\x20IP:\x20','desc','\x20\x20\x20Payout\x20amount:\x20'];a40_0x31a1=function(){return _0x5aa093;};return a40_0x31a1();}var __importDefault=this&&this['__importDefault']||function(_0x2dcdca){const _0x59c865=a40_0x202a;return _0x2dcdca&&_0x2dcdca[_0x59c865(0x1bc)]?_0x2dcdca:{'default':_0x2dcdca};};Object[a40_0x5b1af8(0x1df)](exports,a40_0x5b1af8(0x1bc),{'value':!![]}),exports[a40_0x5b1af8(0x1d6)]=void 0x0;const database_1=__importDefault(require('../config/database')),bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a40_0x5b1af8(0x201))),currencyService_1=require(a40_0x5b1af8(0x1f6)),gateway_1=require('../types/gateway');class AdminService{async[a40_0x5b1af8(0x29e)](){const _0x13f206=a40_0x5b1af8;console[_0x13f206(0x227)](_0x13f206(0x1d5));const _0x505953=await database_1[_0x13f206(0x24d)][_0x13f206(0x22f)][_0x13f206(0x2ad)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x13f206(0x302)}}),_0x1bc414=await database_1[_0x13f206(0x24d)][_0x13f206(0x2b1)][_0x13f206(0x23e)]({'where':{'status':_0x13f206(0x2f3),'gateway':{'not':_0x13f206(0x1fc)}}}),_0x11604e=new Date(),_0x9e39e6=new Date(_0x11604e[_0x13f206(0x2bd)](),_0x11604e[_0x13f206(0x21f)](),0x1),_0x3e82e9=new Date(_0x11604e[_0x13f206(0x2bd)](),_0x11604e[_0x13f206(0x21f)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x257e5f=await database_1[_0x13f206(0x24d)]['payout']['aggregate']({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x9e39e6,'lte':_0x3e82e9},'status':'COMPLETED'}}),_0x38b4bc=_0x505953[_0x13f206(0x1c2)][_0x13f206(0x2b4)]||0x0,_0x1bebcf=_0x505953[_0x13f206(0x1c2)][_0x13f206(0x297)]||0x0,_0x48a494=_0x257e5f[_0x13f206(0x1c2)][_0x13f206(0x20d)]||0x0,_0x4b6ccc={'totalPayout':Math[_0x13f206(0x208)](_0x38b4bc*0x64)/0x64,'awaitingPayout':Math[_0x13f206(0x208)](_0x1bebcf*0x64)/0x64,'thisMonth':Math[_0x13f206(0x208)](_0x48a494*0x64)/0x64,'availableBalance':Math[_0x13f206(0x208)](_0x1bebcf*0x64)/0x64,'totalPayments':_0x1bc414};return console[_0x13f206(0x227)](_0x13f206(0x1dc)),console[_0x13f206(0x227)]('\x20\x20\x20💰\x20Total\x20payout:\x20'+_0x4b6ccc[_0x13f206(0x29a)]+_0x13f206(0x2b0)),console[_0x13f206(0x227)]('\x20\x20\x20⏳\x20Awaiting\x20payout:\x20'+_0x4b6ccc[_0x13f206(0x2ce)]+'\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)'),console[_0x13f206(0x227)](_0x13f206(0x2c9)+_0x4b6ccc[_0x13f206(0x2b8)]+_0x13f206(0x26f)),console[_0x13f206(0x227)](_0x13f206(0x2e2)+_0x4b6ccc[_0x13f206(0x209)]+_0x13f206(0x261)),console[_0x13f206(0x227)](_0x13f206(0x2dc)+_0x4b6ccc['totalPayments']+'\x20PAID\x20payments'),_0x4b6ccc;}async[a40_0x5b1af8(0x225)](_0x5914f3,_0x359273){const _0x2afe07=a40_0x5b1af8;console['log'](_0x2afe07(0x26a)+_0x5914f3+':',_0x359273);const _0x1fea00=await database_1[_0x2afe07(0x24d)][_0x2afe07(0x2b1)]['findUnique']({'where':{'id':_0x5914f3},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x1fea00)throw new Error('Payment\x20not\x20found');const _0x3d6336={};_0x359273[_0x2afe07(0x2c7)]!==undefined&&(_0x3d6336['customerCountry']=_0x359273[_0x2afe07(0x2c7)]||null);_0x359273[_0x2afe07(0x1e6)]!==undefined&&(_0x3d6336[_0x2afe07(0x1e6)]=_0x359273[_0x2afe07(0x1e6)]||null);_0x359273[_0x2afe07(0x275)]!==undefined&&(_0x3d6336[_0x2afe07(0x275)]=_0x359273[_0x2afe07(0x275)]||null);const _0x31b959=await database_1['default'][_0x2afe07(0x2b1)][_0x2afe07(0x1da)]({'where':{'id':_0x5914f3},'data':{..._0x3d6336,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x2afe07(0x227)]('✅\x20Customer\x20data\x20updated\x20for\x20payment\x20'+_0x5914f3),console[_0x2afe07(0x227)](_0x2afe07(0x254)+_0x1fea00['customerCountry']+_0x2afe07(0x310)+_0x31b959['customerCountry']),console[_0x2afe07(0x227)](_0x2afe07(0x1e2)+_0x1fea00[_0x2afe07(0x1e6)]+_0x2afe07(0x310)+_0x31b959['customerIp']),console[_0x2afe07(0x227)](_0x2afe07(0x2e9)+(_0x1fea00[_0x2afe07(0x275)]?'set':_0x2afe07(0x295))+_0x2afe07(0x310)+(_0x31b959[_0x2afe07(0x275)]?_0x2afe07(0x1cb):_0x2afe07(0x295))),_0x31b959;}async['getSystemStatistics'](_0x4c9bc4){const _0x323c1f=a40_0x5b1af8,_0x2c9380=new Date();let _0xd79a84;switch(_0x4c9bc4[_0x323c1f(0x2cb)]()){case'day':_0xd79a84=new Date(_0x2c9380[_0x323c1f(0x2bd)](),_0x2c9380[_0x323c1f(0x21f)](),_0x2c9380['getDate'](),0x0,0x0,0x0,0x0);break;case _0x323c1f(0x306):const _0x474496=new Date(_0x2c9380);_0x474496['setDate'](_0x474496[_0x323c1f(0x2b9)]()-0x1),_0xd79a84=new Date(_0x474496[_0x323c1f(0x2bd)](),_0x474496['getMonth'](),_0x474496[_0x323c1f(0x2b9)](),0x0,0x0,0x0,0x0);break;case'7d':_0xd79a84=new Date(_0x2c9380[_0x323c1f(0x2d4)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0xd79a84=new Date(_0x2c9380[_0x323c1f(0x2d4)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x323c1f(0x264):_0xd79a84=new Date(_0x2c9380[_0x323c1f(0x2d4)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x323c1f(0x1f9):const _0x17cbb0=await database_1[_0x323c1f(0x24d)][_0x323c1f(0x2b1)]['findFirst']({'where':{'gateway':{'not':'test_gateway'}},'orderBy':{'createdAt':'asc'},'select':{'createdAt':!![]}});_0xd79a84=_0x17cbb0?_0x17cbb0[_0x323c1f(0x270)]:new Date(_0x323c1f(0x25b));break;default:_0xd79a84=new Date(_0x2c9380['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}_0xd79a84[_0x323c1f(0x301)](0x0,0x0,0x0,0x0);let _0x3a440a;if(_0x4c9bc4[_0x323c1f(0x2cb)]()==='yesterday'){const _0x20e789=new Date(_0x2c9380);_0x20e789['setDate'](_0x20e789['getDate']()-0x1),_0x3a440a=new Date(_0x20e789[_0x323c1f(0x2bd)](),_0x20e789[_0x323c1f(0x21f)](),_0x20e789[_0x323c1f(0x2b9)](),0x17,0x3b,0x3b,0x3e7);}const _0x2b4f34={'gte':_0xd79a84};_0x3a440a&&(_0x2b4f34[_0x323c1f(0x26e)]=_0x3a440a);const [_0x3dee6c,_0xfa4128,_0x315992,_0x209ff0,_0x2ef0f9,_0x5299f8]=await Promise[_0x323c1f(0x1f9)]([database_1[_0x323c1f(0x24d)][_0x323c1f(0x22f)]['count'](),database_1[_0x323c1f(0x24d)][_0x323c1f(0x22f)][_0x323c1f(0x23e)]({'where':{'status':_0x323c1f(0x302)}}),database_1[_0x323c1f(0x24d)]['payment'][_0x323c1f(0x23e)]({'where':{'status':'PAID','createdAt':_0x2b4f34,'gateway':{'not':_0x323c1f(0x1fc)}}}),database_1[_0x323c1f(0x24d)][_0x323c1f(0x2b1)]['findMany']({'where':{'status':_0x323c1f(0x2f3),'createdAt':_0x2b4f34,'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x323c1f(0x24d)]['payment'][_0x323c1f(0x241)]({'where':{'gateway':{'not':'test_gateway'}},'take':0xa,'orderBy':{'createdAt':_0x323c1f(0x1e3)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x323c1f(0x24d)][_0x323c1f(0x2b1)][_0x323c1f(0x241)]({'where':{'createdAt':_0x2b4f34,'gateway':{'not':_0x323c1f(0x1fc)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0xb2e424=0x0,_0x7724de=0x0;for(const _0x3211b3 of _0x209ff0){const _0x3402cb=await currencyService_1['currencyService']['convertToUSDT'](_0x3211b3[_0x323c1f(0x20d)],_0x3211b3[_0x323c1f(0x27e)]);_0xb2e424+=_0x3402cb;if(_0x3211b3[_0x323c1f(0x25d)]){const _0x3b24e1=await currencyService_1[_0x323c1f(0x20c)][_0x323c1f(0x1bf)](_0x3211b3[_0x323c1f(0x20d)],_0x3211b3[_0x323c1f(0x27e)]),_0x3055e0=_0x3211b3[_0x323c1f(0x25d)],_0x46571b=_0x3b24e1-_0x3055e0;_0x7724de+=_0x46571b;}}const _0x58a8e0=_0x315992>0x0?_0xb2e424/_0x315992:0x0,_0x3e652e=this[_0x323c1f(0x27a)](_0x5299f8,_0xd79a84,_0x3a440a||_0x2c9380),_0x41fde3=await database_1[_0x323c1f(0x24d)][_0x323c1f(0x2b1)][_0x323c1f(0x23e)]({'where':{'createdAt':_0x2b4f34,'gateway':{'not':_0x323c1f(0x1fc)}}}),_0x33fcc3=_0x41fde3>0x0?_0x315992/_0x41fde3*0x64:0x0;return{'totalShops':_0x3dee6c,'activeShops':_0xfa4128,'totalPayments':_0x315992,'successfulPayments':_0x315992,'totalAttempts':_0x41fde3,'totalRevenue':Math['round'](_0xb2e424*0x64)/0x64,'trapayEarnings':Math[_0x323c1f(0x208)](_0x7724de*0x64)/0x64,'averagePaymentAmount':Math['round'](_0x58a8e0*0x64)/0x64,'conversionRate':Math[_0x323c1f(0x208)](_0x33fcc3*0x64)/0x64,'dailyRevenue':_0x3e652e[_0x323c1f(0x252)],'dailyPayments':_0x3e652e[_0x323c1f(0x28b)],'recentPayments':_0x2ef0f9[_0x323c1f(0x20f)](_0x44da96=>({'id':_0x44da96['id'],'amount':_0x44da96[_0x323c1f(0x20d)],'currency':_0x44da96['currency'],'status':_0x44da96[_0x323c1f(0x277)],'gateway':_0x44da96['gateway'],'shop':_0x44da96[_0x323c1f(0x22f)],'createdAt':_0x44da96[_0x323c1f(0x270)]}))};}async['getMerchantStatistics'](_0x9677ec){const _0x465235=a40_0x5b1af8;console[_0x465235(0x227)](_0x465235(0x292),_0x9677ec);let _0x488ec2,_0x507826=new Date();if(_0x9677ec[_0x465235(0x1ff)]===_0x465235(0x30a)&&_0x9677ec[_0x465235(0x1e9)]&&_0x9677ec[_0x465235(0x298)])_0x488ec2=new Date(_0x9677ec[_0x465235(0x1e9)]),_0x507826=new Date(_0x9677ec[_0x465235(0x298)]),_0x488ec2['setHours'](0x0,0x0,0x0,0x0),_0x507826[_0x465235(0x301)](0x17,0x3b,0x3b,0x3e7);else{const _0x4d5da3=new Date();switch(_0x9677ec['period']){case _0x465235(0x2a5):_0x488ec2=new Date(_0x4d5da3[_0x465235(0x2d4)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x465235(0x271):_0x488ec2=new Date(_0x4d5da3[_0x465235(0x2d4)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x465235(0x229):_0x488ec2=new Date(_0x4d5da3['getTime']()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x465235(0x1f9):default:_0x488ec2=new Date(_0x465235(0x25b));break;}_0x488ec2[_0x465235(0x301)](0x0,0x0,0x0,0x0),_0x507826[_0x465235(0x301)](0x17,0x3b,0x3b,0x3e7);}console[_0x465235(0x227)](_0x465235(0x23c)+_0x488ec2[_0x465235(0x2a1)]()+_0x465235(0x1f5)+_0x507826[_0x465235(0x2a1)]());const _0x5fa9ca={'status':_0x465235(0x2f3),'gateway':{'not':_0x465235(0x1fc)},'paidAt':{'gte':_0x488ec2,'lte':_0x507826}};_0x9677ec[_0x465235(0x204)]&&(_0x5fa9ca[_0x465235(0x204)]=_0x9677ec[_0x465235(0x204)]);const _0x381af5=await database_1[_0x465235(0x24d)]['payment'][_0x465235(0x241)]({'where':_0x5fa9ca,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x465235(0x227)](_0x465235(0x30b)+_0x381af5[_0x465235(0x28f)]+_0x465235(0x2bb));const _0x44a802={'gateway':{'not':_0x465235(0x1fc)},'createdAt':{'gte':_0x488ec2,'lte':_0x507826}};_0x9677ec[_0x465235(0x204)]&&(_0x44a802[_0x465235(0x204)]=_0x9677ec['shopId']);const _0x4d9c91=await database_1[_0x465235(0x24d)]['payment']['count']({'where':_0x44a802});console[_0x465235(0x227)]('📊\x20Total\x20payments\x20(including\x20failed):\x20'+_0x4d9c91+_0x465235(0x2fa)+_0x381af5[_0x465235(0x28f)]);let _0x246153=0x0,_0x561a98=0x0,_0x2ab32d=0x0;const _0x14815e={},_0x281808={},_0x852678={};for(const _0x45e7f6 of _0x381af5){try{const _0x3bb5c8=_0x45e7f6[_0x465235(0x2db)]||0x0;if(_0x3bb5c8<=0x0){console['warn'](_0x465235(0x1f4)+_0x45e7f6['id']+_0x465235(0x2cf));continue;}let _0x439223,_0x47ab64;if(_0x45e7f6[_0x465235(0x25d)]!==null&&_0x45e7f6[_0x465235(0x25d)]!==undefined)_0x439223=_0x45e7f6['amountAfterGatewayCommissionUSDT'],_0x47ab64=_0x3bb5c8-_0x439223,console['log'](_0x465235(0x248)+_0x45e7f6['id']+':\x20'+_0x3bb5c8[_0x465235(0x1ea)](0x6)+_0x465235(0x2e5)+_0x439223['toFixed'](0x6)+'\x20USDT');else{let _0x28db64={};if(_0x45e7f6[_0x465235(0x22f)][_0x465235(0x278)])try{_0x28db64=JSON[_0x465235(0x244)](_0x45e7f6[_0x465235(0x22f)][_0x465235(0x278)]);}catch(_0x5c210f){console[_0x465235(0x217)]('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x45e7f6[_0x465235(0x204)]+':',_0x5c210f);}let _0x518106=0x2d;for(const [_0x10ea58,_0xbee0a0]of Object[_0x465235(0x272)](_0x28db64)){if(_0x10ea58[_0x465235(0x2cb)]()===_0x45e7f6[_0x465235(0x288)][_0x465235(0x2cb)]()){_0x518106=_0xbee0a0[_0x465235(0x305)]||0x2d;break;}}_0x47ab64=_0x3bb5c8*(_0x518106/0x64),_0x439223=_0x3bb5c8-_0x47ab64,console[_0x465235(0x227)](_0x465235(0x1d7)+_0x45e7f6['id']+':\x20'+_0x518106+_0x465235(0x215)+_0x3bb5c8[_0x465235(0x1ea)](0x6)+_0x465235(0x261));}_0x246153+=_0x3bb5c8,_0x561a98+=_0x439223,_0x2ab32d+=_0x47ab64;let _0x11e214;_0x45e7f6[_0x465235(0x296)]!==null&&_0x45e7f6[_0x465235(0x296)]!==undefined?(_0x11e214=_0x45e7f6['gatewayCommissionRate'],console['log']('📊\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20'+_0x45e7f6['id']+':\x20'+_0x11e214+'%')):(_0x11e214=_0x3bb5c8>0x0?_0x47ab64/_0x3bb5c8*0x64:0x0,console[_0x465235(0x227)](_0x465235(0x245)+_0x45e7f6['id']+':\x20'+_0x11e214[_0x465235(0x1ea)](0x2)+'%'));!_0x14815e[_0x45e7f6[_0x465235(0x288)]]&&(_0x14815e[_0x45e7f6[_0x465235(0x288)]]={'gateway':_0x45e7f6[_0x465235(0x288)],'gatewayDisplayName':this['getGatewayDisplayName'](_0x45e7f6[_0x465235(0x288)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x14815e[_0x45e7f6['gateway']][_0x465235(0x291)]++,_0x14815e[_0x45e7f6[_0x465235(0x288)]][_0x465235(0x268)]+=_0x3bb5c8,_0x14815e[_0x45e7f6['gateway']][_0x465235(0x2d0)]+=_0x47ab64,_0x14815e[_0x45e7f6['gateway']][_0x465235(0x1c5)]+=_0x439223,_0x14815e[_0x45e7f6['gateway']][_0x465235(0x247)]+=_0x11e214;!_0x9677ec[_0x465235(0x204)]&&(!_0x281808[_0x45e7f6[_0x465235(0x204)]]&&(_0x281808[_0x45e7f6[_0x465235(0x204)]]={'shopId':_0x45e7f6[_0x465235(0x204)],'shopName':_0x45e7f6[_0x465235(0x22f)][_0x465235(0x1c1)],'shopUsername':_0x45e7f6[_0x465235(0x22f)][_0x465235(0x20a)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x281808[_0x45e7f6[_0x465235(0x204)]]['paymentsCount']++,_0x281808[_0x45e7f6[_0x465235(0x204)]][_0x465235(0x268)]+=_0x3bb5c8,_0x281808[_0x45e7f6[_0x465235(0x204)]]['commissionUSDT']+=_0x47ab64,_0x281808[_0x45e7f6[_0x465235(0x204)]][_0x465235(0x1c5)]+=_0x439223);const _0x2d5988=_0x45e7f6[_0x465235(0x1c8)][_0x465235(0x2a1)]()[_0x465235(0x1d3)]('T')[0x0];!_0x852678[_0x2d5988]&&(_0x852678[_0x2d5988]={'date':_0x2d5988,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x852678[_0x2d5988][_0x465235(0x222)]+=_0x3bb5c8,_0x852678[_0x2d5988][_0x465235(0x2c8)]+=_0x439223,_0x852678[_0x2d5988][_0x465235(0x1de)]+=_0x47ab64,_0x852678[_0x2d5988][_0x465235(0x291)]++;}catch(_0x57db3f){console[_0x465235(0x217)]('Error\x20processing\x20payment\x20'+_0x45e7f6['id']+':',_0x57db3f);}}Object[_0x465235(0x266)](_0x14815e)[_0x465235(0x1dd)](_0x3a1746=>{const _0x4b9501=_0x465235;_0x3a1746[_0x4b9501(0x23b)]=_0x3a1746['paymentsCount']>0x0?_0x3a1746[_0x4b9501(0x247)]/_0x3a1746['paymentsCount']:0x0,delete _0x3a1746[_0x4b9501(0x247)];}),Object[_0x465235(0x266)](_0x281808)[_0x465235(0x1dd)](_0x1063d8=>{const _0x5e0511=_0x465235;_0x1063d8[_0x5e0511(0x314)]=_0x1063d8[_0x5e0511(0x291)]>0x0?_0x1063d8[_0x5e0511(0x268)]/_0x1063d8[_0x5e0511(0x291)]:0x0;});let _0x3a9a04=0x0,_0x287a25=0x0;if(_0x9677ec[_0x465235(0x204)]){const _0x1e7ee1=await database_1['default']['payout'][_0x465235(0x241)]({'where':{'shopId':_0x9677ec['shopId'],'status':'COMPLETED','createdAt':{'gte':_0x488ec2,'lte':_0x507826}},'select':{'amount':!![]}});_0x3a9a04=_0x1e7ee1[_0x465235(0x1e1)]((_0x8985af,_0x5afd46)=>_0x8985af+_0x5afd46[_0x465235(0x20d)],0x0);const _0x4eb170=await database_1[_0x465235(0x24d)][_0x465235(0x22b)][_0x465235(0x241)]({'where':{'shopId':_0x9677ec['shopId'],'status':_0x465235(0x2a3),'createdAt':{'gte':_0x488ec2,'lte':_0x507826}},'select':{'amount':!![]}});_0x287a25=_0x4eb170[_0x465235(0x1e1)]((_0x4e1d9f,_0x1ac550)=>_0x4e1d9f+_0x1ac550[_0x465235(0x20d)],0x0);}const _0x58ff5b=_0x4d9c91,_0x4f04e7=_0x381af5['length'],_0x500629=_0x4f04e7>0x0?_0x246153/_0x4f04e7:0x0,_0x17dc8c=_0x58ff5b>0x0?Math[_0x465235(0x208)](_0x4f04e7/_0x58ff5b*0x2710)/0x64:0x0,_0x5bd7bb=Math[_0x465235(0x20b)]((_0x507826[_0x465235(0x2d4)]()-_0x488ec2[_0x465235(0x2d4)]())/(0x3e8*0x3c*0x3c*0x18)),_0x392b2c={'totalTurnover':Math[_0x465235(0x208)](_0x246153*0x64)/0x64,'merchantEarnings':Math[_0x465235(0x208)](_0x561a98*0x64)/0x64,'gatewayEarnings':Math[_0x465235(0x208)](_0x2ab32d*0x64)/0x64,'totalPaidOut':Math[_0x465235(0x208)](_0x3a9a04*0x64)/0x64,'pendingPayout':Math['round'](_0x287a25*0x64)/0x64,'averageCheck':Math['round'](_0x500629*0x64)/0x64,'totalPayments':_0x58ff5b,'successfulPayments':_0x4f04e7,'conversionRate':_0x17dc8c,'gatewayBreakdown':Object[_0x465235(0x266)](_0x14815e)[_0x465235(0x20f)](_0x233a1c=>({..._0x233a1c,'turnoverUSDT':Math[_0x465235(0x208)](_0x233a1c[_0x465235(0x268)]*0x64)/0x64,'commissionUSDT':Math[_0x465235(0x208)](_0x233a1c['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x465235(0x208)](_0x233a1c[_0x465235(0x1c5)]*0x64)/0x64,'averageCommissionRate':Math[_0x465235(0x208)](_0x233a1c[_0x465235(0x23b)]*0x64)/0x64})),'merchantBreakdown':_0x9677ec[_0x465235(0x204)]?undefined:Object['values'](_0x281808)[_0x465235(0x20f)](_0x36580b=>({..._0x36580b,'turnoverUSDT':Math[_0x465235(0x208)](_0x36580b['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x465235(0x208)](_0x36580b[_0x465235(0x2d0)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x465235(0x208)](_0x36580b[_0x465235(0x1c5)]*0x64)/0x64,'paidOutUSDT':Math[_0x465235(0x208)](_0x36580b[_0x465235(0x2aa)]*0x64)/0x64,'averageCheckUSDT':Math[_0x465235(0x208)](_0x36580b['averageCheckUSDT']*0x64)/0x64})),'dailyData':Object[_0x465235(0x266)](_0x852678)[_0x465235(0x20f)](_0x3a2aff=>({..._0x3a2aff,'turnover':Math[_0x465235(0x208)](_0x3a2aff[_0x465235(0x222)]*0x64)/0x64,'merchantEarnings':Math[_0x465235(0x208)](_0x3a2aff[_0x465235(0x2c8)]*0x64)/0x64,'gatewayEarnings':Math[_0x465235(0x208)](_0x3a2aff[_0x465235(0x1de)]*0x64)/0x64}))['sort']((_0x3399e8,_0x237d8f)=>_0x3399e8[_0x465235(0x27c)][_0x465235(0x294)](_0x237d8f[_0x465235(0x27c)])),'periodInfo':{'from':_0x488ec2,'to':_0x507826,'periodType':_0x9677ec['period']||'custom','daysCount':_0x5bd7bb}};return console[_0x465235(0x227)](_0x465235(0x213)),console['log'](_0x465235(0x282)+_0x392b2c[_0x465235(0x2c2)]+_0x465235(0x261)),console['log'](_0x465235(0x238)+_0x392b2c[_0x465235(0x2c8)]+_0x465235(0x261)),console[_0x465235(0x227)](_0x465235(0x1b8)+_0x392b2c[_0x465235(0x1de)]+_0x465235(0x261)),console[_0x465235(0x227)](_0x465235(0x23d)+_0x392b2c[_0x465235(0x2b4)]+_0x465235(0x261)),console['log'](_0x465235(0x1c9)+_0x392b2c['pendingPayout']+_0x465235(0x261)),console[_0x465235(0x227)]('\x20\x20\x20�📊\x20Total\x20payments:\x20'+_0x392b2c[_0x465235(0x2b3)]),_0x392b2c;}async['getMerchantsSelection'](_0x4aac57){const _0x359df9=a40_0x5b1af8;console[_0x359df9(0x227)](_0x359df9(0x2af),{'hasPayoutHistory':_0x4aac57});let _0x13cadf={'status':_0x359df9(0x302)};_0x4aac57&&(_0x13cadf['payouts']={'some':{}});const _0x21cb4c=await database_1[_0x359df9(0x24d)][_0x359df9(0x22f)]['findMany']({'where':_0x13cadf,'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':'asc'}});return console[_0x359df9(0x227)](_0x359df9(0x206)+_0x21cb4c['length']+_0x359df9(0x21d)+(_0x4aac57?_0x359df9(0x262):'')),_0x21cb4c[_0x359df9(0x20f)](_0x206f92=>({'id':_0x206f92['id'],'username':_0x206f92['username'],'name':_0x206f92[_0x359df9(0x1c1)]}));}[a40_0x5b1af8(0x212)](_0x59e54e){const _0x3ba561=a40_0x5b1af8,_0x1e1943={'test_gateway':_0x3ba561(0x2a8),'plisio':_0x3ba561(0x2ed),'rapyd':_0x3ba561(0x26b),'noda':_0x3ba561(0x2be),'cointopay':_0x3ba561(0x2e3),'cointopay2':_0x3ba561(0x318),'klyme_eu':_0x3ba561(0x274),'klyme_gb':_0x3ba561(0x232),'klyme_de':_0x3ba561(0x2e0),'mastercard':_0x3ba561(0x2a2)};return _0x1e1943[_0x59e54e]||_0x59e54e;}[a40_0x5b1af8(0x267)](_0x439f4d){const _0x46ebd5=a40_0x5b1af8,_0x4e0fcb={'Test\x20Gateway':_0x46ebd5(0x1fc),'Plisio':_0x46ebd5(0x24e),'Rapyd':'rapyd','Noda':'noda','CoinToPay':_0x46ebd5(0x273),'CoinToPay2':_0x46ebd5(0x2ac),'KLYME\x20EU':_0x46ebd5(0x2fc),'KLYME\x20GB':_0x46ebd5(0x1b4),'KLYME\x20DE':_0x46ebd5(0x1f1),'MasterCard':'mastercard'};return _0x4e0fcb[_0x439f4d]||_0x439f4d[_0x46ebd5(0x2cb)]();}async[a40_0x5b1af8(0x317)](_0x2fc975){const _0x22d52a=a40_0x5b1af8,{page:_0x1391a3,limit:_0x4b75e7,minAmount:_0x34bcda,search:_0x32a7d9}=_0x2fc975;console[_0x22d52a(0x227)](_0x22d52a(0x2fd),_0x2fc975);let _0x318c3a={'status':_0x22d52a(0x302)};_0x32a7d9&&(_0x318c3a[_0x22d52a(0x1c1)]={'contains':_0x32a7d9,'mode':_0x22d52a(0x289)});const _0xf883b2=await database_1[_0x22d52a(0x24d)][_0x22d52a(0x22f)][_0x22d52a(0x241)]({'where':_0x318c3a,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),_0x34cb04=_0xf883b2['filter'](_0x42ef99=>{const _0x51cf23=_0x22d52a,_0x175296=Math[_0x51cf23(0x208)](_0x42ef99[_0x51cf23(0x297)]*0x64)/0x64;if(_0x34bcda&&_0x175296<_0x34bcda)return![];return _0x175296!==0x0;});_0x34cb04[_0x22d52a(0x2f1)]((_0x253441,_0x46f660)=>_0x46f660['balance']-_0x253441[_0x22d52a(0x297)]);const _0xeab9f8=_0x34cb04[_0x22d52a(0x28f)],_0xbf9e7f=(_0x1391a3-0x1)*_0x4b75e7,_0x8f30a0=_0x34cb04[_0x22d52a(0x1c6)](_0xbf9e7f,_0xbf9e7f+_0x4b75e7);console['log'](_0x22d52a(0x30b)+_0x8f30a0[_0x22d52a(0x28f)]+_0x22d52a(0x25c));const _0x1c76fc=await Promise[_0x22d52a(0x1f9)](_0x8f30a0[_0x22d52a(0x20f)](async _0xfebcc6=>{const _0x5d33fd=_0x22d52a,[_0x33d090,_0x3905d1,_0x5242bf]=await Promise['all']([database_1['default'][_0x5d33fd(0x2b1)]['count']({'where':{'shopId':_0xfebcc6['id'],'status':_0x5d33fd(0x2f3),'gateway':{'not':_0x5d33fd(0x1fc)}}}),database_1[_0x5d33fd(0x24d)][_0x5d33fd(0x2b1)][_0x5d33fd(0x2f8)]({'where':{'shopId':_0xfebcc6['id'],'status':'PAID','gateway':{'not':_0x5d33fd(0x1fc)}},'orderBy':{'paidAt':_0x5d33fd(0x2b7)},'select':{'paidAt':!![]}}),database_1['default'][_0x5d33fd(0x2b1)][_0x5d33fd(0x240)]({'by':[_0x5d33fd(0x288)],'where':{'shopId':_0xfebcc6['id'],'status':_0x5d33fd(0x2f3),'gateway':{'not':'test_gateway'}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x1437a5=new Date(),_0x9c726=new Date(_0x1437a5[_0x5d33fd(0x2bd)](),_0x1437a5[_0x5d33fd(0x21f)](),0x1),_0x296dfb=new Date(_0x1437a5['getFullYear'](),_0x1437a5[_0x5d33fd(0x21f)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x5bb673,_0x151c49]=await Promise[_0x5d33fd(0x1f9)]([database_1[_0x5d33fd(0x24d)][_0x5d33fd(0x22b)]['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0xfebcc6['id'],'status':'COMPLETED'}}),database_1[_0x5d33fd(0x24d)][_0x5d33fd(0x22b)][_0x5d33fd(0x2ad)]({'_sum':{'amount':!![]},'where':{'shopId':_0xfebcc6['id'],'status':_0x5d33fd(0x2dd),'createdAt':{'gte':_0x9c726,'lte':_0x296dfb}}})]),_0xbf69ec=_0x5bb673[_0x5d33fd(0x1c2)][_0x5d33fd(0x20d)]||0x0,_0xe9e645=_0x151c49[_0x5d33fd(0x1c2)][_0x5d33fd(0x20d)]||0x0,_0x30d764=await Promise[_0x5d33fd(0x1f9)](_0x5242bf['map'](async _0x1652fd=>{const _0x5ef92e=_0x5d33fd;let _0x565bfe=0x2d;if(_0xfebcc6['gatewaySettings'])try{const _0x1aae23=JSON[_0x5ef92e(0x244)](_0xfebcc6[_0x5ef92e(0x278)]);for(const [_0x48be5b,_0x21b8a7]of Object['entries'](_0x1aae23)){if(_0x48be5b['toLowerCase']()===_0x1652fd[_0x5ef92e(0x288)][_0x5ef92e(0x2cb)]()){_0x565bfe=_0x21b8a7[_0x5ef92e(0x305)]||0xa,console[_0x5ef92e(0x227)](_0x5ef92e(0x1ce)+_0x1652fd['gateway']+'\x20for\x20shop\x20'+_0xfebcc6['id']+_0x5ef92e(0x30f)+_0x565bfe+'%');break;}}}catch(_0x315a32){console['error']('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0xfebcc6['id']+':',_0x315a32);}const _0xa459b6=_0x1652fd[_0x5ef92e(0x1c2)]?.[_0x5ef92e(0x2db)]||0x0,_0x42e435=_0xa459b6*(0x1-_0x565bfe/0x64);return{'gateway':_0x1652fd[_0x5ef92e(0x288)],'count':_0x1652fd['_count']?.['id']||0x0,'amountUSDT':Math[_0x5ef92e(0x208)](_0xa459b6*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x5ef92e(0x208)](_0x42e435*0x64)/0x64,'commission':_0x565bfe};})),_0x3d6d12=_0x30d764[_0x5d33fd(0x1e1)]((_0x3f0072,_0x1b46cb)=>_0x3f0072+_0x1b46cb[_0x5d33fd(0x2db)],0x0),_0x17a8cf=_0x30d764[_0x5d33fd(0x1e1)]((_0x3289c6,_0x561a11)=>_0x3289c6+_0x561a11[_0x5d33fd(0x2c4)],0x0),_0x454e6f=_0xfebcc6[_0x5d33fd(0x297)];return console['log']('💰\x20[PAYOUT]\x20Merchant\x20'+_0xfebcc6[_0x5d33fd(0x20a)]+':'),console['log'](_0x5d33fd(0x290)+_0x3d6d12[_0x5d33fd(0x1ea)](0x2)+_0x5d33fd(0x263)),console['log'](_0x5d33fd(0x2de)+_0x17a8cf[_0x5d33fd(0x1ea)](0x2)+_0x5d33fd(0x2cd)),console[_0x5d33fd(0x227)](_0x5d33fd(0x1e8)+_0x454e6f[_0x5d33fd(0x1ea)](0x2)+_0x5d33fd(0x236)),console[_0x5d33fd(0x227)](_0x5d33fd(0x1bb)+_0xbf69ec['toFixed'](0x2)+_0x5d33fd(0x249)),console['log']('\x20\x20\x20🤔\x20Difference:\x20'+(_0x17a8cf-_0xbf69ec-_0x454e6f)['toFixed'](0x2)+_0x5d33fd(0x29c)),{'id':_0xfebcc6['id'],'fullName':_0xfebcc6[_0x5d33fd(0x1c1)],'username':_0xfebcc6[_0x5d33fd(0x20a)],'telegramId':_0xfebcc6[_0x5d33fd(0x220)],'merchantUrl':_0xfebcc6[_0x5d33fd(0x1f8)],'wallets':{'usdtPolygonWallet':_0xfebcc6[_0x5d33fd(0x246)],'usdtTrcWallet':_0xfebcc6[_0x5d33fd(0x27d)],'usdtErcWallet':_0xfebcc6[_0x5d33fd(0x2fe)],'usdcPolygonWallet':_0xfebcc6[_0x5d33fd(0x2ef)],'usdcErcWallet':_0xfebcc6['usdcErcWallet']},'totalAmountUSDT':Math[_0x5d33fd(0x208)](_0x3d6d12*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x17a8cf*0x64)/0x64,'currentBalance':Math['round'](_0x454e6f*0x64)/0x64,'totalPayout':Math[_0x5d33fd(0x208)](_0xbf69ec*0x64)/0x64,'thisMonth':Math[_0x5d33fd(0x208)](_0xe9e645*0x64)/0x64,'paymentsCount':_0x33d090,'oldestPaymentDate':_0x3905d1?.[_0x5d33fd(0x1c8)]||_0xfebcc6[_0x5d33fd(0x270)],'gatewayBreakdown':_0x30d764};})),_0x14de69=_0x1c76fc['reduce']((_0x40c9a2,_0x18aab5)=>_0x40c9a2+_0x18aab5[_0x22d52a(0x303)],0x0),_0x4daf44=_0x1c76fc[_0x22d52a(0x1e1)]((_0x38ae0,_0x12ce9f)=>_0x38ae0+_0x12ce9f[_0x22d52a(0x2a6)],0x0),_0x2097c3=_0x1c76fc[_0x22d52a(0x1e1)]((_0x41ed66,_0x3ba446)=>_0x41ed66+_0x3ba446[_0x22d52a(0x29a)],0x0),_0x32dab6=_0x1c76fc['reduce']((_0x198ffe,_0x23f357)=>_0x198ffe+_0x23f357[_0x22d52a(0x209)],0x0);return console[_0x22d52a(0x227)](_0x22d52a(0x1e0)+_0xeab9f8+_0x22d52a(0x2b5)),console[_0x22d52a(0x227)](_0x22d52a(0x24f)+Math[_0x22d52a(0x208)](_0x14de69*0x64)/0x64+'\x20USDT\x20(gross\x20revenue)'),console[_0x22d52a(0x227)](_0x22d52a(0x293)+Math['round'](_0x4daf44*0x64)/0x64+_0x22d52a(0x287)),console['log'](_0x22d52a(0x2f2)+Math['round'](_0x2097c3*0x64)/0x64+_0x22d52a(0x261)),console['log']('\x20\x20\x20📅\x20Total\x20payouts\x20(this\x20month):\x20'+Math[_0x22d52a(0x208)](_0x32dab6*0x64)/0x64+'\x20USDT'),{'merchants':_0x1c76fc,'pagination':{'page':_0x1391a3,'limit':_0x4b75e7,'total':_0xeab9f8,'totalPages':Math['ceil'](_0xeab9f8/_0x4b75e7)},'summary':{'totalMerchants':_0xeab9f8,'totalAmountUSDT':Math['round'](_0x14de69*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x4daf44*0x64)/0x64,'totalPayout':Math[_0x22d52a(0x208)](_0x2097c3*0x64)/0x64,'thisMonth':Math[_0x22d52a(0x208)](_0x32dab6*0x64)/0x64}};}async[a40_0x5b1af8(0x21c)](_0x20f87f){const _0x1ff790=a40_0x5b1af8,{shopId:_0x15df32,amount:_0x10f3fd,network:_0x331e12,wallet:_0x2b8c71,notes:_0x1d0314,txid:_0x90f249,periodFrom:_0x250d59,periodTo:_0x1c4926}=_0x20f87f,_0x5df823=await database_1[_0x1ff790(0x24d)][_0x1ff790(0x223)](async _0x412c13=>{const _0x325f3b=_0x1ff790,_0x334213=await _0x412c13[_0x325f3b(0x22f)]['findUnique']({'where':{'id':_0x15df32},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x334213)throw new Error(_0x325f3b(0x239));console['log'](_0x325f3b(0x2c0)+_0x334213[_0x325f3b(0x20a)]+':'),console[_0x325f3b(0x227)](_0x325f3b(0x20e)+_0x334213[_0x325f3b(0x297)][_0x325f3b(0x1ea)](0x6)+_0x325f3b(0x261)),console[_0x325f3b(0x227)](_0x325f3b(0x1e4)+_0x10f3fd[_0x325f3b(0x1ea)](0x6)+_0x325f3b(0x261)),console['log']('\x20\x20\x20Current\x20total\x20paid\x20out:\x20'+_0x334213[_0x325f3b(0x2b4)][_0x325f3b(0x1ea)](0x6)+_0x325f3b(0x261));if(_0x90f249)console[_0x325f3b(0x227)]('\x20\x20\x20Transaction\x20hash:\x20'+_0x90f249);const _0x2d1400=0.000001,_0x5c7c7d=Number(_0x334213[_0x325f3b(0x297)]),_0x1f9fbf=Number(_0x10f3fd);console[_0x325f3b(0x227)](_0x325f3b(0x243)),console[_0x325f3b(0x227)](_0x325f3b(0x307)+_0x334213[_0x325f3b(0x297)]),console[_0x325f3b(0x227)](_0x325f3b(0x2e4)+_0x5c7c7d),console[_0x325f3b(0x227)](_0x325f3b(0x2b2)+_0x1f9fbf),console[_0x325f3b(0x227)](_0x325f3b(0x200)+(_0x5c7c7d-_0x1f9fbf)),console[_0x325f3b(0x227)](_0x325f3b(0x233)+_0x2d1400);if(_0x5c7c7d<_0x1f9fbf-_0x2d1400)throw new Error(_0x325f3b(0x1cf)+_0x5c7c7d[_0x325f3b(0x1ea)](0x6)+_0x325f3b(0x2ee)+_0x1f9fbf[_0x325f3b(0x1ea)](0x6)+'\x20USDT,\x20Difference:\x20'+(_0x5c7c7d-_0x1f9fbf)[_0x325f3b(0x1ea)](0x8)+'\x20USDT');console[_0x325f3b(0x227)](_0x325f3b(0x319));const _0x36c72d=Math['min'](_0x5c7c7d,_0x1f9fbf);let _0x37cffd=_0x2b8c71;console[_0x325f3b(0x227)](_0x325f3b(0x1f3)+(_0x2b8c71||_0x325f3b(0x2ea)));if(!_0x37cffd){console[_0x325f3b(0x227)](_0x325f3b(0x2a4));const _0x9ab4e1=await _0x412c13[_0x325f3b(0x22f)][_0x325f3b(0x1ed)]({'where':{'id':_0x15df32},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});console['log'](_0x325f3b(0x235),_0x9ab4e1);if(_0x9ab4e1)switch(_0x331e12){case _0x325f3b(0x1b9):_0x37cffd=_0x9ab4e1['usdtPolygonWallet']||undefined,console['log']('🔍\x20Selected\x20polygon\x20wallet:\x20'+_0x37cffd);break;case _0x325f3b(0x2a7):_0x37cffd=_0x9ab4e1[_0x325f3b(0x27d)]||undefined,console[_0x325f3b(0x227)]('🔍\x20Selected\x20trc20\x20wallet:\x20'+_0x37cffd);break;case'erc20':_0x37cffd=_0x9ab4e1[_0x325f3b(0x2fe)]||undefined,console[_0x325f3b(0x227)]('🔍\x20Selected\x20erc20\x20wallet:\x20'+_0x37cffd);break;case'polygon_usdc':_0x37cffd=_0x9ab4e1[_0x325f3b(0x2ef)]||undefined,console['log'](_0x325f3b(0x2bc)+_0x37cffd);break;case _0x325f3b(0x2d8):_0x37cffd=_0x9ab4e1[_0x325f3b(0x2e8)]||undefined,console[_0x325f3b(0x227)](_0x325f3b(0x28d)+_0x37cffd);break;}}else console[_0x325f3b(0x227)]('✅\x20Using\x20wallet\x20from\x20request:\x20'+_0x37cffd);console[_0x325f3b(0x227)](_0x325f3b(0x2fb)+_0x331e12+':\x20'+(_0x37cffd||_0x325f3b(0x21e))),console[_0x325f3b(0x227)]('🔍\x20Creating\x20payout\x20with\x20data:',{'shopId':_0x15df32,'amount':_0x36c72d,'network':_0x331e12,'wallet':_0x37cffd,'status':_0x325f3b(0x2dd),'txid':_0x90f249,'notes':_0x1d0314,'periodFrom':_0x250d59?new Date(_0x250d59):null,'periodTo':_0x1c4926?new Date(_0x1c4926):null});const _0x4510e4=await _0x412c13['payout'][_0x325f3b(0x316)]({'data':{'shopId':_0x15df32,'amount':_0x36c72d,'network':_0x331e12,'wallet':_0x37cffd,'status':'COMPLETED','txid':_0x90f249,'notes':_0x1d0314,'periodFrom':_0x250d59?new Date(_0x250d59):null,'periodTo':_0x1c4926?new Date(_0x1c4926):null,'createdAt':new Date(),'paidAt':new Date()}});console[_0x325f3b(0x227)]('✅\x20Payout\x20created\x20in\x20DB:',{'id':_0x4510e4['id'],'wallet':_0x4510e4['wallet'],'network':_0x4510e4[_0x325f3b(0x2d3)],'amount':_0x4510e4['amount']});const _0x340175=_0x5c7c7d-_0x36c72d,_0x25c84a=Number(_0x334213['totalPaidOut'])+_0x36c72d;return await _0x412c13[_0x325f3b(0x22f)]['update']({'where':{'id':_0x15df32},'data':{'balance':_0x340175,'totalPaidOut':_0x25c84a}}),console['log'](_0x325f3b(0x1f0)+_0x334213[_0x325f3b(0x20a)]+'\x20balance\x20updated:'),console[_0x325f3b(0x227)](_0x325f3b(0x1c4)+_0x5c7c7d[_0x325f3b(0x1ea)](0x6)+_0x325f3b(0x310)+_0x340175[_0x325f3b(0x1ea)](0x6)+_0x325f3b(0x276)+_0x36c72d[_0x325f3b(0x1ea)](0x6)+')'),console[_0x325f3b(0x227)](_0x325f3b(0x21b)+_0x334213['totalPaidOut'][_0x325f3b(0x1ea)](0x6)+_0x325f3b(0x310)+_0x25c84a[_0x325f3b(0x1ea)](0x6)+_0x325f3b(0x26c)+_0x36c72d['toFixed'](0x6)+')'),console[_0x325f3b(0x227)](_0x325f3b(0x1bd)+_0x36c72d[_0x325f3b(0x1ea)](0x6)+_0x325f3b(0x261)),{'payout':_0x4510e4,'shop':_0x334213};});return console[_0x1ff790(0x227)]('✅\x20Payout\x20created:\x20'+_0x5df823[_0x1ff790(0x22b)]['id']+_0x1ff790(0x216)+_0x5df823[_0x1ff790(0x22f)]['username']+'\x20('+_0x5df823[_0x1ff790(0x22b)][_0x1ff790(0x20d)][_0x1ff790(0x1ea)](0x6)+_0x1ff790(0x22e)),{'id':_0x5df823['payout']['id'],'shopId':_0x5df823[_0x1ff790(0x22b)][_0x1ff790(0x204)],'shopName':_0x5df823[_0x1ff790(0x22f)][_0x1ff790(0x1c1)],'shopUsername':_0x5df823[_0x1ff790(0x22f)][_0x1ff790(0x20a)],'amount':_0x5df823['payout'][_0x1ff790(0x20d)],'network':_0x5df823['payout'][_0x1ff790(0x2d3)],'wallet':_0x5df823['payout'][_0x1ff790(0x1d2)],'status':_0x5df823[_0x1ff790(0x22b)][_0x1ff790(0x277)],'txid':_0x5df823[_0x1ff790(0x22b)][_0x1ff790(0x30d)],'notes':_0x5df823['payout'][_0x1ff790(0x2ba)],'periodFrom':_0x5df823['payout'][_0x1ff790(0x1ba)],'periodTo':_0x5df823['payout'][_0x1ff790(0x21a)],'createdAt':_0x5df823[_0x1ff790(0x22b)]['createdAt'],'paidAt':_0x5df823[_0x1ff790(0x22b)][_0x1ff790(0x1c8)]};}async[a40_0x5b1af8(0x28c)](_0x29ebd3){const _0x2e5a6e=a40_0x5b1af8,{page:_0x297ab9,limit:_0x4619a7,shopId:_0x113875,network:_0xbeed29,dateFrom:_0x5dd788,dateTo:_0x48730a,search:_0x592212}=_0x29ebd3,_0x5a5f57=(_0x297ab9-0x1)*_0x4619a7,_0x227622={};_0x113875&&(_0x227622[_0x2e5a6e(0x204)]=_0x113875);_0xbeed29&&(_0x227622[_0x2e5a6e(0x2d3)]=_0xbeed29);if(_0x5dd788||_0x48730a){_0x227622[_0x2e5a6e(0x270)]={};if(_0x5dd788){const _0x5d771a=new Date(_0x5dd788);_0x5d771a[_0x2e5a6e(0x301)](0x0,0x0,0x0,0x1),_0x227622[_0x2e5a6e(0x270)][_0x2e5a6e(0x250)]=_0x5d771a,console[_0x2e5a6e(0x227)](_0x2e5a6e(0x1fe)+_0x5d771a[_0x2e5a6e(0x2a1)]());}if(_0x48730a){const _0xa60263=new Date(_0x48730a);_0xa60263[_0x2e5a6e(0x301)](0x17,0x3b,0x3b,0x3e7),_0x227622[_0x2e5a6e(0x270)]['lte']=_0xa60263,console['log'](_0x2e5a6e(0x203)+_0xa60263[_0x2e5a6e(0x2a1)]());}}_0x592212&&(_0x227622['OR']=[{'shop':{'name':{'contains':_0x592212,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x592212,'mode':'insensitive'}}},{'notes':{'contains':_0x592212,'mode':_0x2e5a6e(0x289)}}]);const [_0x1b207b,_0x133b3e]=await Promise[_0x2e5a6e(0x1f9)]([database_1['default'][_0x2e5a6e(0x22b)][_0x2e5a6e(0x241)]({'where':_0x227622,'skip':_0x5a5f57,'take':_0x4619a7,'orderBy':{'createdAt':_0x2e5a6e(0x1e3)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'wallet':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x2e5a6e(0x22b)][_0x2e5a6e(0x23e)]({'where':_0x227622})]);return{'payouts':_0x1b207b['map'](_0x26f1ad=>({'id':_0x26f1ad['id'],'shopId':_0x26f1ad[_0x2e5a6e(0x204)],'shopName':_0x26f1ad[_0x2e5a6e(0x22f)][_0x2e5a6e(0x1c1)],'shopUsername':_0x26f1ad['shop'][_0x2e5a6e(0x20a)],'amount':_0x26f1ad[_0x2e5a6e(0x20d)],'network':_0x26f1ad[_0x2e5a6e(0x2d3)],'wallet':_0x26f1ad[_0x2e5a6e(0x1d2)],'status':_0x26f1ad[_0x2e5a6e(0x277)],'txid':_0x26f1ad[_0x2e5a6e(0x30d)],'notes':_0x26f1ad['notes'],'periodFrom':_0x26f1ad[_0x2e5a6e(0x1ba)],'periodTo':_0x26f1ad[_0x2e5a6e(0x21a)],'createdAt':_0x26f1ad['createdAt'],'paidAt':_0x26f1ad[_0x2e5a6e(0x1c8)]})),'pagination':{'page':_0x297ab9,'limit':_0x4619a7,'total':_0x133b3e,'totalPages':Math[_0x2e5a6e(0x20b)](_0x133b3e/_0x4619a7)}};}async[a40_0x5b1af8(0x30c)](_0x5e195c){const _0x299bdf=a40_0x5b1af8,_0x145450=await database_1[_0x299bdf(0x24d)]['payout'][_0x299bdf(0x1ed)]({'where':{'id':_0x5e195c},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x145450)return null;return{'id':_0x145450['id'],'shopId':_0x145450['shopId'],'shopName':_0x145450[_0x299bdf(0x22f)][_0x299bdf(0x1c1)],'shopUsername':_0x145450['shop'][_0x299bdf(0x20a)],'amount':_0x145450[_0x299bdf(0x20d)],'network':_0x145450[_0x299bdf(0x2d3)],'wallet':_0x145450['wallet'],'status':_0x145450[_0x299bdf(0x277)],'txid':_0x145450['txid'],'notes':_0x145450[_0x299bdf(0x2ba)],'periodFrom':_0x145450[_0x299bdf(0x1ba)],'periodTo':_0x145450[_0x299bdf(0x21a)],'createdAt':_0x145450[_0x299bdf(0x270)],'paidAt':_0x145450[_0x299bdf(0x1c8)]};}async[a40_0x5b1af8(0x257)](_0x1d2a5c){const _0x555d8a=a40_0x5b1af8;await database_1[_0x555d8a(0x24d)][_0x555d8a(0x22b)][_0x555d8a(0x309)]({'where':{'id':_0x1d2a5c}});}async[a40_0x5b1af8(0x2d6)](_0x285709){const _0x2872b1=a40_0x5b1af8,{page:_0x403e07,limit:_0x548c29,status:_0x490e76,gateway:_0x126201,shopId:_0x366d31,dateFrom:_0x18ec88,dateTo:_0x1c9dd6,search:_0x2b9b73,currency:_0xad38b,sortBy:_0x185fa9,sortOrder:_0x323057}=_0x285709,_0x7dc863=(_0x403e07-0x1)*_0x548c29;console[_0x2872b1(0x227)]('📊\x20Getting\x20payments\x20with\x20filters:',_0x285709);const _0x540508=await database_1[_0x2872b1(0x24d)][_0x2872b1(0x2b1)][_0x2872b1(0x240)]({'by':[_0x2872b1(0x288)],'_count':{'gateway':!![]}});console[_0x2872b1(0x227)](_0x2872b1(0x2bf),_0x540508[_0x2872b1(0x20f)](_0x391799=>_0x391799[_0x2872b1(0x288)]+'\x20('+_0x391799[_0x2872b1(0x2f5)][_0x2872b1(0x288)]+_0x2872b1(0x214)));if(_0x126201){const _0x6d0b7e=_0x540508[_0x2872b1(0x299)](_0x19b425=>_0x19b425[_0x2872b1(0x288)]['toLowerCase']()===_0x126201[_0x2872b1(0x2cb)]());!_0x6d0b7e&&_0x126201[_0x2872b1(0x2cb)]()!==_0x2872b1(0x1fc)&&console[_0x2872b1(0x227)](_0x2872b1(0x285)+_0x126201+_0x2872b1(0x219)+_0x540508[_0x2872b1(0x20f)](_0x58fce0=>_0x58fce0[_0x2872b1(0x288)])[_0x2872b1(0x2e1)](',\x20'));}const _0xf537af={};_0x490e76&&(_0xf537af[_0x2872b1(0x277)]=_0x490e76['toUpperCase']());if(!_0x126201)_0xf537af[_0x2872b1(0x288)]={'not':_0x2872b1(0x1fc)};else{if(_0x126201&&(_0x126201[_0x2872b1(0x2cb)]()==='test_gateway'||_0x126201===_0x2872b1(0x25a)))_0xf537af[_0x2872b1(0x288)]='test_gateway';else{let _0x4c3619=_0x126201;const _0x3ba79b=(0x0,gateway_1[_0x2872b1(0x256)])(_0x126201);if(_0x3ba79b)_0x4c3619=_0x3ba79b,console['log'](_0x2872b1(0x255)+_0x126201+_0x2872b1(0x258)+_0x4c3619+'\x27');else{const _0x1fb790=(0x0,gateway_1[_0x2872b1(0x1e7)])(_0x126201);if(_0x1fb790){const _0x725d4=(0x0,gateway_1[_0x2872b1(0x256)])(_0x1fb790);_0x725d4&&(_0x4c3619=_0x725d4,console['log']('🔄\x20Converted\x20gateway\x20name\x20\x27'+_0x126201+_0x2872b1(0x311)+_0x1fb790+_0x2872b1(0x251)+_0x4c3619+'\x27'));}else console['log'](_0x2872b1(0x28e)+_0x126201+_0x2872b1(0x2ab));}const _0x203a25=await database_1['default'][_0x2872b1(0x2b1)]['count']({'where':{'gateway':_0x4c3619[_0x2872b1(0x2cb)]()},'take':0x1});_0x203a25===0x0?(console['log'](_0x2872b1(0x2f6)+_0x4c3619+'\x27\x20(from\x20\x27'+_0x126201+'\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result'),_0xf537af['gateway']=_0x2872b1(0x202)):(_0xf537af['gateway']=_0x4c3619[_0x2872b1(0x2cb)](),console['log'](_0x2872b1(0x1fd)+_0x4c3619+_0x2872b1(0x2f0)+_0x126201+'\x27)'));}}console['log'](_0x2872b1(0x2ec),_0xf537af['gateway']);_0x366d31&&(_0xf537af[_0x2872b1(0x204)]=_0x366d31);_0xad38b&&(_0xf537af['currency']=_0xad38b[_0x2872b1(0x218)](),console['log']('💱\x20Currency\x20filter\x20applied:\x20'+_0xad38b[_0x2872b1(0x218)]()));if(_0x18ec88||_0x1c9dd6){_0xf537af[_0x2872b1(0x270)]={};if(_0x18ec88){const _0x121929=new Date(_0x18ec88);_0x121929['setHours'](0x0,0x0,0x0,0x1),_0xf537af[_0x2872b1(0x270)]['gte']=_0x121929,console['log'](_0x2872b1(0x2e7)+_0x121929[_0x2872b1(0x2a1)]());}if(_0x1c9dd6){const _0x399184=new Date(_0x1c9dd6);_0x399184[_0x2872b1(0x301)](0x17,0x3b,0x3b,0x3e7),_0xf537af[_0x2872b1(0x270)][_0x2872b1(0x26e)]=_0x399184,console['log'](_0x2872b1(0x2d1)+_0x399184[_0x2872b1(0x2a1)]());}}_0x2b9b73&&(_0xf537af['OR']=[{'id':{'contains':_0x2b9b73,'mode':'insensitive'}},{'orderId':{'contains':_0x2b9b73,'mode':_0x2872b1(0x289)}},{'gatewayOrderId':{'contains':_0x2b9b73,'mode':_0x2872b1(0x289)}},{'customerEmail':{'contains':_0x2b9b73,'mode':_0x2872b1(0x289)}},{'shop':{'name':{'contains':_0x2b9b73,'mode':_0x2872b1(0x289)}}},{'shop':{'username':{'contains':_0x2b9b73,'mode':_0x2872b1(0x289)}}}]);console[_0x2872b1(0x227)](_0x2872b1(0x1c3),JSON['stringify'](_0xf537af,null,0x2));let _0x7264b9={'createdAt':_0x2872b1(0x1e3)};if(_0x185fa9){const _0x32c0ba=[_0x2872b1(0x20d),_0x2872b1(0x270),_0x2872b1(0x279),'status',_0x2872b1(0x288),_0x2872b1(0x27e)],_0x4ffadb=[_0x2872b1(0x2b7),_0x2872b1(0x1e3)];if(_0x32c0ba[_0x2872b1(0x28a)](_0x185fa9)){const _0x510f39=_0x4ffadb[_0x2872b1(0x28a)](_0x323057)?_0x323057:'desc';_0x7264b9={[_0x185fa9]:_0x510f39},console['log'](_0x2872b1(0x2d9)+_0x185fa9+'\x20in\x20'+_0x510f39+_0x2872b1(0x231));}}const [_0x44b545,_0x5ad79d]=await Promise[_0x2872b1(0x1f9)]([database_1[_0x2872b1(0x24d)][_0x2872b1(0x2b1)][_0x2872b1(0x241)]({'where':_0xf537af,'skip':_0x7dc863,'take':_0x548c29,'orderBy':_0x7264b9,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x2872b1(0x2b1)][_0x2872b1(0x23e)]({'where':_0xf537af})]);return{'payments':_0x44b545,'pagination':{'page':_0x403e07,'limit':_0x548c29,'total':_0x5ad79d,'totalPages':Math[_0x2872b1(0x20b)](_0x5ad79d/_0x548c29)}};}async[a40_0x5b1af8(0x1ec)](_0x43dcd2){const _0x36f216=a40_0x5b1af8,_0x26a140=await database_1['default'][_0x36f216(0x2b1)][_0x36f216(0x1ed)]({'where':{'id':_0x43dcd2},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x26a140)return null;return{'id':_0x26a140['id'],'shopId':_0x26a140[_0x36f216(0x204)],'gateway':_0x26a140['gateway'],'amount':_0x26a140[_0x36f216(0x20d)],'currency':_0x26a140[_0x36f216(0x27e)],'status':_0x26a140['status'],'orderId':_0x26a140[_0x36f216(0x1d8)],'gatewayOrderId':_0x26a140[_0x36f216(0x242)],'customerEmail':_0x26a140[_0x36f216(0x1b6)],'customerName':_0x26a140[_0x36f216(0x24c)],'customerCountry':_0x26a140['customerCountry'],'customerIp':_0x26a140[_0x36f216(0x1e6)],'customerUa':_0x26a140[_0x36f216(0x275)],'failureMessage':_0x26a140[_0x36f216(0x1cc)],'externalPaymentUrl':_0x26a140[_0x36f216(0x26d)],'successUrl':_0x26a140[_0x36f216(0x2a9)],'failUrl':_0x26a140['failUrl'],'pendingUrl':_0x26a140[_0x36f216(0x313)],'whiteUrl':_0x26a140[_0x36f216(0x2e6)],'createdAt':_0x26a140[_0x36f216(0x270)],'updatedAt':_0x26a140[_0x36f216(0x279)],'shop':_0x26a140[_0x36f216(0x22f)]};}async[a40_0x5b1af8(0x29f)](_0xa23e37,_0x3e81e9,_0x3ec7b5,_0x526068){const _0x50e9bc=a40_0x5b1af8,_0x1fbdb2=await database_1['default'][_0x50e9bc(0x223)](async _0x161264=>{const _0x52f63f=_0x50e9bc,_0xfdb3e0=await _0x161264[_0x52f63f(0x2b1)][_0x52f63f(0x1ed)]({'where':{'id':_0xa23e37},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0xfdb3e0)throw new Error(_0x52f63f(0x2df));const _0x3d8b01=_0xfdb3e0['status'],_0x1261eb=_0x3e81e9['toUpperCase']();console[_0x52f63f(0x227)](_0x52f63f(0x1ef)+_0xa23e37+_0x52f63f(0x2ca)+_0x3d8b01+_0x52f63f(0x310)+_0x1261eb),console[_0x52f63f(0x227)](_0x52f63f(0x260)+_0xfdb3e0[_0x52f63f(0x22f)]['balance']+_0x52f63f(0x261));const _0x150203={'status':_0x1261eb,'updatedAt':new Date(),'statusChangedBy':_0x52f63f(0x283),'statusChangedAt':new Date()};_0x3ec7b5&&(_0x150203[_0x52f63f(0x24a)]=_0x3ec7b5);_0x1261eb===_0x52f63f(0x207)&&_0x526068&&(_0x150203[_0x52f63f(0x281)]=_0x526068);let _0x422d51=0x0,_0x388cd3=_0xfdb3e0['shop'][_0x52f63f(0x297)];if(_0x1261eb===_0x52f63f(0x2f3)&&_0x3d8b01!==_0x52f63f(0x2f3)){_0x150203[_0x52f63f(0x1c8)]=new Date();const _0x300d7d=await currencyService_1[_0x52f63f(0x20c)][_0x52f63f(0x1bf)](_0xfdb3e0[_0x52f63f(0x20d)],_0xfdb3e0[_0x52f63f(0x27e)]);_0x150203[_0x52f63f(0x2db)]=_0x300d7d;let _0x2bd53c=0x2d;const _0xa4efbb=await _0x161264[_0x52f63f(0x22f)][_0x52f63f(0x1ed)]({'where':{'id':_0xfdb3e0[_0x52f63f(0x204)]},'select':{'gatewaySettings':!![]}});if(_0xa4efbb?.[_0x52f63f(0x278)])try{const _0x3c17df=JSON[_0x52f63f(0x244)](_0xa4efbb[_0x52f63f(0x278)]);for(const [_0x4adcec,_0x3a5010]of Object[_0x52f63f(0x272)](_0x3c17df)){if(_0x4adcec[_0x52f63f(0x2cb)]()===_0xfdb3e0['gateway'][_0x52f63f(0x2cb)]()){_0x2bd53c=_0x3a5010[_0x52f63f(0x305)]||0xa;break;}}}catch(_0x2ad3a1){console[_0x52f63f(0x217)](_0x52f63f(0x1d4)+_0xa23e37+':',_0x2ad3a1);}let _0x2b144d;_0xfdb3e0['amountAfterGatewayCommissionUSDT']!==null&&_0xfdb3e0[_0x52f63f(0x25d)]!==undefined?(_0x2b144d=_0xfdb3e0[_0x52f63f(0x25d)],console[_0x52f63f(0x227)](_0x52f63f(0x2eb)+_0x2b144d[_0x52f63f(0x1ea)](0x6)+_0x52f63f(0x2f9)+_0xa23e37)):(_0x2b144d=_0x300d7d*(0x1-_0x2bd53c/0x64),console[_0x52f63f(0x227)](_0x52f63f(0x1c0)+_0xa23e37+':\x20'+_0x2bd53c+_0x52f63f(0x215)+_0x300d7d[_0x52f63f(0x1ea)](0x6)+'\x20USDT'),_0x150203[_0x52f63f(0x25d)]=_0x2b144d,_0x150203[_0x52f63f(0x296)]=_0x2bd53c),_0x422d51=_0x2b144d,_0x388cd3+=_0x2b144d,console[_0x52f63f(0x227)]('💰\x20Payment\x20'+_0xa23e37+'\x20became\x20PAID:'),console[_0x52f63f(0x227)](_0x52f63f(0x29b)+_0x300d7d[_0x52f63f(0x1ea)](0x6)+_0x52f63f(0x261)),console[_0x52f63f(0x227)](_0x52f63f(0x2c6)+_0xfdb3e0[_0x52f63f(0x288)]+_0x52f63f(0x23a)+_0x2bd53c+'%'),console[_0x52f63f(0x227)](_0x52f63f(0x25e)+_0x2b144d[_0x52f63f(0x1ea)](0x6)+'\x20USDT\x20(after\x20'+_0x2bd53c+'%\x20commission)'),console[_0x52f63f(0x227)](_0x52f63f(0x22c)+_0x2b144d[_0x52f63f(0x1ea)](0x6)+'\x20USDT');}else{if(_0x3d8b01==='PAID'&&_0x1261eb!==_0x52f63f(0x2f3)&&_0x1261eb!==_0x52f63f(0x207)){if(_0xfdb3e0['amountUSDT']){let _0x17a631=0x2d;const _0x13b761=await _0x161264[_0x52f63f(0x22f)][_0x52f63f(0x1ed)]({'where':{'id':_0xfdb3e0[_0x52f63f(0x204)]},'select':{'gatewaySettings':!![]}});if(_0x13b761?.['gatewaySettings'])try{const _0x280a79=JSON[_0x52f63f(0x244)](_0x13b761[_0x52f63f(0x278)]);for(const [_0x1900f4,_0x45a2b3]of Object[_0x52f63f(0x272)](_0x280a79)){if(_0x1900f4[_0x52f63f(0x2cb)]()===_0xfdb3e0[_0x52f63f(0x288)][_0x52f63f(0x2cb)]()){_0x17a631=_0x45a2b3[_0x52f63f(0x305)]||0xa;break;}}}catch(_0x1b87be){console['error'](_0x52f63f(0x1d4)+_0xa23e37+':',_0x1b87be);}const _0x449c79=_0xfdb3e0[_0x52f63f(0x2db)]*(0x1-_0x17a631/0x64);_0x422d51=-_0x449c79,_0x388cd3-=_0x449c79,console['log'](_0x52f63f(0x29b)+_0xfdb3e0[_0x52f63f(0x2db)][_0x52f63f(0x1ea)](0x6)+_0x52f63f(0x261)),console[_0x52f63f(0x227)](_0x52f63f(0x2c6)+_0xfdb3e0[_0x52f63f(0x288)]+_0x52f63f(0x23a)+_0x17a631+'%'),console['log']('\x20\x20\x20Merchant\x20loses:\x20'+_0x449c79[_0x52f63f(0x1ea)](0x6)+_0x52f63f(0x265)+_0x17a631+_0x52f63f(0x1fa)),console['log'](_0x52f63f(0x1b7)+_0x449c79[_0x52f63f(0x1ea)](0x6)+_0x52f63f(0x261));}}}_0x1261eb===_0x52f63f(0x207)&&(console[_0x52f63f(0x227)](_0x52f63f(0x286)),_0x526068&&_0x526068>0x0?(_0x422d51=-_0x526068,_0x388cd3-=_0x526068,console[_0x52f63f(0x227)]('💸\x20CHARGEBACK\x20penalty\x20ONLY:\x20-'+_0x526068[_0x52f63f(0x1ea)](0x6)+_0x52f63f(0x1be)),console[_0x52f63f(0x227)](_0x52f63f(0x2f7))):console['log'](_0x52f63f(0x315)),_0x150203[_0x52f63f(0x281)]=_0x526068||0x0);_0x1261eb==='REFUND'&&_0x3d8b01===_0x52f63f(0x2f3)&&console[_0x52f63f(0x227)](_0x52f63f(0x2da));const _0x37a077=await _0x161264[_0x52f63f(0x2b1)]['update']({'where':{'id':_0xa23e37},'data':_0x150203,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x422d51!==0x0&&(await _0x161264['shop'][_0x52f63f(0x1da)]({'where':{'id':_0xfdb3e0[_0x52f63f(0x204)]},'data':{'balance':_0x388cd3}}),console[_0x52f63f(0x227)](_0x52f63f(0x1f0)+_0xfdb3e0[_0x52f63f(0x204)]+'\x20balance\x20updated:\x20'+_0xfdb3e0[_0x52f63f(0x22f)][_0x52f63f(0x297)][_0x52f63f(0x1ea)](0x6)+_0x52f63f(0x310)+_0x388cd3[_0x52f63f(0x1ea)](0x6)+_0x52f63f(0x29d)+(_0x422d51>0x0?'+':'')+_0x422d51['toFixed'](0x6)+')')),_0x37a077;});return{'id':_0x1fbdb2['id'],'shopId':_0x1fbdb2['shopId'],'gateway':_0x1fbdb2[_0x50e9bc(0x288)],'amount':_0x1fbdb2[_0x50e9bc(0x20d)],'currency':_0x1fbdb2[_0x50e9bc(0x27e)],'status':_0x1fbdb2[_0x50e9bc(0x277)],'orderId':_0x1fbdb2['orderId'],'gatewayOrderId':_0x1fbdb2[_0x50e9bc(0x242)],'customerEmail':_0x1fbdb2[_0x50e9bc(0x1b6)],'customerName':_0x1fbdb2[_0x50e9bc(0x24c)],'customerCountry':_0x1fbdb2[_0x50e9bc(0x2c7)],'customerIp':_0x1fbdb2['customerIp'],'customerUa':_0x1fbdb2[_0x50e9bc(0x275)],'failureMessage':_0x1fbdb2['failureMessage'],'adminNotes':_0x1fbdb2[_0x50e9bc(0x24a)],'chargebackAmount':_0x1fbdb2[_0x50e9bc(0x281)],'statusChangedBy':_0x1fbdb2[_0x50e9bc(0x2ae)],'statusChangedAt':_0x1fbdb2[_0x50e9bc(0x25f)],'createdAt':_0x1fbdb2[_0x50e9bc(0x270)],'updatedAt':_0x1fbdb2['updatedAt'],'shop':_0x1fbdb2[_0x50e9bc(0x22f)]};}async[a40_0x5b1af8(0x1fb)](_0xeb62c6,_0x41e873){const _0x40f687=a40_0x5b1af8,_0x2d888c=Math[_0x40f687(0x230)]()['toString'](0x24)[_0x40f687(0x2f4)](0x2,0x9);console['log'](_0x40f687(0x280)+_0x2d888c+_0x40f687(0x1d1)+_0xeb62c6);const _0x2c50fd={..._0x41e873};_0x41e873[_0x40f687(0x2c3)]&&_0x41e873[_0x40f687(0x2c3)][_0x40f687(0x27f)]()!==''?(console[_0x40f687(0x227)](_0x40f687(0x237)+_0x2d888c+_0x40f687(0x1c7)+_0xeb62c6),_0x2c50fd['password']=await bcryptjs_1[_0x40f687(0x24d)][_0x40f687(0x1ca)](_0x41e873[_0x40f687(0x2c3)],0xc)):(console['log'](_0x40f687(0x237)+_0x2d888c+_0x40f687(0x1db)),delete _0x2c50fd[_0x40f687(0x2c3)]);_0x41e873['fullName']&&(_0x2c50fd['name']=_0x41e873[_0x40f687(0x211)],delete _0x2c50fd[_0x40f687(0x211)]);_0x41e873[_0x40f687(0x2d7)]&&(_0x2c50fd[_0x40f687(0x220)]=_0x41e873[_0x40f687(0x2d7)],delete _0x2c50fd[_0x40f687(0x2d7)]);_0x41e873[_0x40f687(0x308)]&&(_0x2c50fd[_0x40f687(0x1f8)]=_0x41e873[_0x40f687(0x308)],delete _0x2c50fd['merchantUrl']);if(_0x41e873[_0x40f687(0x2b6)]){const _0x20c47b=_0x41e873['gateways']['map'](_0x56da8c=>this['getGatewayInternalName'](_0x56da8c));console[_0x40f687(0x227)](_0x40f687(0x2ff),_0x41e873[_0x40f687(0x2b6)],'->',_0x20c47b),_0x2c50fd['paymentGateways']=JSON[_0x40f687(0x24b)](_0x20c47b),delete _0x2c50fd[_0x40f687(0x2b6)];}_0x41e873[_0x40f687(0x278)]&&(console[_0x40f687(0x227)](_0x40f687(0x1ee)+_0x2d888c+_0x40f687(0x228),_0x41e873[_0x40f687(0x278)]),_0x2c50fd[_0x40f687(0x278)]=JSON['stringify'](_0x41e873[_0x40f687(0x278)]),console[_0x40f687(0x227)](_0x40f687(0x1ee)+_0x2d888c+_0x40f687(0x2cc),_0x2c50fd[_0x40f687(0x278)]));_0x41e873[_0x40f687(0x1f7)]&&(_0x41e873['wallets'][_0x40f687(0x246)]!==undefined&&(_0x2c50fd[_0x40f687(0x246)]=_0x41e873[_0x40f687(0x1f7)]['usdtPolygonWallet']||null),_0x41e873[_0x40f687(0x1f7)][_0x40f687(0x27d)]!==undefined&&(_0x2c50fd[_0x40f687(0x27d)]=_0x41e873[_0x40f687(0x1f7)][_0x40f687(0x27d)]||null),_0x41e873[_0x40f687(0x1f7)][_0x40f687(0x2fe)]!==undefined&&(_0x2c50fd['usdtErcWallet']=_0x41e873['wallets']['usdtErcWallet']||null),_0x41e873['wallets']['usdcPolygonWallet']!==undefined&&(_0x2c50fd[_0x40f687(0x2ef)]=_0x41e873[_0x40f687(0x1f7)]['usdcPolygonWallet']||null),delete _0x2c50fd['wallets']);const _0x23d20a=await database_1[_0x40f687(0x24d)][_0x40f687(0x22f)][_0x40f687(0x1da)]({'where':{'id':_0xeb62c6},'data':_0x2c50fd,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0x40f687(0x227)](_0x40f687(0x205)+_0x2d888c+_0x40f687(0x27b),_0x23d20a['gatewaySettings']),{'id':_0x23d20a['id'],'fullName':_0x23d20a[_0x40f687(0x1c1)],'username':_0x23d20a[_0x40f687(0x20a)],'telegramId':_0x23d20a['telegram'],'merchantUrl':_0x23d20a[_0x40f687(0x1f8)],'gateways':_0x23d20a[_0x40f687(0x22a)]?JSON[_0x40f687(0x244)](_0x23d20a['paymentGateways']):null,'gatewaySettings':_0x23d20a['gatewaySettings']?JSON['parse'](_0x23d20a[_0x40f687(0x278)]):null,'publicKey':_0x23d20a['publicKey'],'wallets':{'usdtPolygonWallet':_0x23d20a[_0x40f687(0x246)],'usdtTrcWallet':_0x23d20a[_0x40f687(0x27d)],'usdtErcWallet':_0x23d20a[_0x40f687(0x2fe)],'usdcPolygonWallet':_0x23d20a[_0x40f687(0x2ef)]},'status':_0x23d20a[_0x40f687(0x277)],'createdAt':_0x23d20a['createdAt']};}async[a40_0x5b1af8(0x23f)](_0x1dd43c){const _0x445ebf=a40_0x5b1af8,_0x16c4ee=await database_1['default'][_0x445ebf(0x22f)][_0x445ebf(0x1da)]({'where':{'id':_0x1dd43c},'data':{'status':_0x445ebf(0x284)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x16c4ee['id'],'fullName':_0x16c4ee[_0x445ebf(0x1c1)],'username':_0x16c4ee[_0x445ebf(0x20a)],'telegramId':_0x16c4ee[_0x445ebf(0x220)],'merchantUrl':_0x16c4ee[_0x445ebf(0x1f8)],'gateways':_0x16c4ee[_0x445ebf(0x22a)]?JSON[_0x445ebf(0x244)](_0x16c4ee[_0x445ebf(0x22a)]):null,'gatewaySettings':_0x16c4ee[_0x445ebf(0x278)]?JSON[_0x445ebf(0x244)](_0x16c4ee[_0x445ebf(0x278)]):null,'publicKey':_0x16c4ee[_0x445ebf(0x269)],'wallets':{'usdtPolygonWallet':_0x16c4ee[_0x445ebf(0x246)],'usdtTrcWallet':_0x16c4ee[_0x445ebf(0x27d)],'usdtErcWallet':_0x16c4ee[_0x445ebf(0x2fe)],'usdcPolygonWallet':_0x16c4ee[_0x445ebf(0x2ef)]},'status':_0x16c4ee['status'],'createdAt':_0x16c4ee[_0x445ebf(0x270)]};}async['activateUser'](_0x4e5b33){const _0x285fb1=a40_0x5b1af8,_0x23dbcc=await database_1[_0x285fb1(0x24d)]['shop'][_0x285fb1(0x1da)]({'where':{'id':_0x4e5b33},'data':{'status':_0x285fb1(0x302)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x23dbcc['id'],'fullName':_0x23dbcc[_0x285fb1(0x1c1)],'username':_0x23dbcc['username'],'telegramId':_0x23dbcc[_0x285fb1(0x220)],'merchantUrl':_0x23dbcc[_0x285fb1(0x1f8)],'gateways':_0x23dbcc['paymentGateways']?JSON[_0x285fb1(0x244)](_0x23dbcc['paymentGateways']):null,'gatewaySettings':_0x23dbcc[_0x285fb1(0x278)]?JSON[_0x285fb1(0x244)](_0x23dbcc['gatewaySettings']):null,'publicKey':_0x23dbcc[_0x285fb1(0x269)],'wallets':{'usdtPolygonWallet':_0x23dbcc[_0x285fb1(0x246)],'usdtTrcWallet':_0x23dbcc[_0x285fb1(0x27d)],'usdtErcWallet':_0x23dbcc[_0x285fb1(0x2fe)],'usdcPolygonWallet':_0x23dbcc['usdcPolygonWallet']},'status':_0x23dbcc['status'],'createdAt':_0x23dbcc[_0x285fb1(0x270)]};}async[a40_0x5b1af8(0x1d0)](_0x44c3e2){const _0x28ef71=a40_0x5b1af8,{page:_0x114e3b,limit:_0x13558d,status:_0x4ee949}=_0x44c3e2,_0x3e0d24=(_0x114e3b-0x1)*_0x13558d,_0x5e97e5={};_0x4ee949&&(_0x5e97e5['status']=_0x4ee949[_0x28ef71(0x218)]());const [_0x52f285,_0x55ee14]=await Promise[_0x28ef71(0x1f9)]([database_1['default'][_0x28ef71(0x22f)][_0x28ef71(0x241)]({'where':_0x5e97e5,'skip':_0x3e0d24,'take':_0x13558d,'orderBy':{'createdAt':_0x28ef71(0x1e3)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x28ef71(0x24d)][_0x28ef71(0x22f)]['count']({'where':_0x5e97e5})]);return{'users':_0x52f285[_0x28ef71(0x20f)](_0x19e026=>{const _0x304c2b=_0x28ef71,_0x98c39a=_0x19e026[_0x304c2b(0x22a)]?JSON[_0x304c2b(0x244)](_0x19e026[_0x304c2b(0x22a)]):null,_0x202621=_0x98c39a?_0x98c39a[_0x304c2b(0x20f)](_0x45c10c=>this[_0x304c2b(0x212)](_0x45c10c)):null;return{'id':_0x19e026['id'],'fullName':_0x19e026[_0x304c2b(0x1c1)],'username':_0x19e026['username'],'telegramId':_0x19e026[_0x304c2b(0x220)],'merchantUrl':_0x19e026[_0x304c2b(0x1f8)],'gateways':_0x202621,'gatewaySettings':_0x19e026[_0x304c2b(0x278)]?JSON[_0x304c2b(0x244)](_0x19e026['gatewaySettings']):null,'publicKey':_0x19e026[_0x304c2b(0x269)],'wallets':{'usdtPolygonWallet':_0x19e026[_0x304c2b(0x246)],'usdtTrcWallet':_0x19e026[_0x304c2b(0x27d)],'usdtErcWallet':_0x19e026[_0x304c2b(0x2fe)],'usdcPolygonWallet':_0x19e026[_0x304c2b(0x2ef)]},'status':_0x19e026[_0x304c2b(0x277)],'createdAt':_0x19e026['createdAt']};}),'pagination':{'page':_0x114e3b,'limit':_0x13558d,'total':_0x55ee14,'totalPages':Math[_0x28ef71(0x20b)](_0x55ee14/_0x13558d)}};}async['getUserById'](_0x3aad28){const _0x42b9c2=a40_0x5b1af8,_0x3ec109=await database_1[_0x42b9c2(0x24d)][_0x42b9c2(0x22f)][_0x42b9c2(0x1ed)]({'where':{'id':_0x3aad28},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x3ec109)return null;const _0x1c7d1f=_0x3ec109[_0x42b9c2(0x22a)]?JSON[_0x42b9c2(0x244)](_0x3ec109[_0x42b9c2(0x22a)]):null,_0x84cf46=_0x1c7d1f?_0x1c7d1f[_0x42b9c2(0x20f)](_0x4a310f=>this[_0x42b9c2(0x212)](_0x4a310f)):null;return _0x1c7d1f&&_0x84cf46&&console[_0x42b9c2(0x227)](_0x42b9c2(0x1f2),_0x1c7d1f,'->',_0x84cf46),{'id':_0x3ec109['id'],'fullName':_0x3ec109[_0x42b9c2(0x1c1)],'username':_0x3ec109['username'],'telegramId':_0x3ec109['telegram'],'merchantUrl':_0x3ec109[_0x42b9c2(0x1f8)],'gateways':_0x84cf46,'gatewaySettings':_0x3ec109[_0x42b9c2(0x278)]?JSON['parse'](_0x3ec109[_0x42b9c2(0x278)]):null,'publicKey':_0x3ec109[_0x42b9c2(0x269)],'wallets':{'usdtPolygonWallet':_0x3ec109[_0x42b9c2(0x246)],'usdtTrcWallet':_0x3ec109[_0x42b9c2(0x27d)],'usdtErcWallet':_0x3ec109[_0x42b9c2(0x2fe)],'usdcPolygonWallet':_0x3ec109[_0x42b9c2(0x2ef)]},'status':_0x3ec109['status'],'createdAt':_0x3ec109['createdAt']};}async[a40_0x5b1af8(0x226)](_0x204227){const _0x1c09c8=a40_0x5b1af8,{fullName:_0x55aae4,username:_0x15393c,password:_0x2f43e7,telegramId:_0x1c40c7,merchantUrl:_0x3470f2,gateways:_0x18bf61,gatewaySettings:_0x537481,wallets:_0x2ba7d3}=_0x204227,_0x3ac08d=await database_1['default'][_0x1c09c8(0x22f)][_0x1c09c8(0x1ed)]({'where':{'username':_0x15393c}});if(_0x3ac08d)throw new Error(_0x1c09c8(0x300));if(_0x1c40c7){const _0x1251ca=await database_1[_0x1c09c8(0x24d)]['shop'][_0x1c09c8(0x1ed)]({'where':{'telegram':_0x1c40c7}});if(_0x1251ca)throw new Error(_0x1c09c8(0x1d9));}const _0x41abb4=await bcryptjs_1['default'][_0x1c09c8(0x1ca)](_0x2f43e7,0xc),_0x55adce='pk_'+crypto_1[_0x1c09c8(0x24d)]['randomBytes'](0x20)['toString'](_0x1c09c8(0x234)),_0x13add0=_0x1c09c8(0x1b5)+crypto_1[_0x1c09c8(0x24d)]['randomBytes'](0x20)[_0x1c09c8(0x253)](_0x1c09c8(0x234)),_0x42efd7=_0x18bf61?_0x18bf61[_0x1c09c8(0x20f)](_0x241e08=>this[_0x1c09c8(0x267)](_0x241e08)):null;_0x18bf61&&_0x42efd7&&console[_0x1c09c8(0x227)](_0x1c09c8(0x1cd),_0x18bf61,'->',_0x42efd7);const _0x4792ca=await database_1['default'][_0x1c09c8(0x22f)][_0x1c09c8(0x316)]({'data':{'name':_0x55aae4,'username':_0x15393c,'password':_0x41abb4,'telegram':_0x1c40c7,'shopUrl':_0x3470f2,'paymentGateways':_0x42efd7?JSON[_0x1c09c8(0x24b)](_0x42efd7):null,'gatewaySettings':_0x537481?JSON[_0x1c09c8(0x24b)](_0x537481):null,'usdtPolygonWallet':_0x2ba7d3?.['usdtPolygonWallet']||null,'usdtTrcWallet':_0x2ba7d3?.[_0x1c09c8(0x27d)]||null,'usdtErcWallet':_0x2ba7d3?.['usdtErcWallet']||null,'usdcPolygonWallet':_0x2ba7d3?.[_0x1c09c8(0x2ef)]||null,'publicKey':_0x55adce,'secretKey':_0x13add0,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4792ca['id'],'fullName':_0x4792ca[_0x1c09c8(0x1c1)],'username':_0x4792ca[_0x1c09c8(0x20a)],'telegramId':_0x4792ca[_0x1c09c8(0x220)],'merchantUrl':_0x4792ca[_0x1c09c8(0x1f8)],'gateways':_0x4792ca[_0x1c09c8(0x22a)]?JSON[_0x1c09c8(0x244)](_0x4792ca[_0x1c09c8(0x22a)]):null,'gatewaySettings':_0x4792ca[_0x1c09c8(0x278)]?JSON[_0x1c09c8(0x244)](_0x4792ca[_0x1c09c8(0x278)]):null,'publicKey':_0x4792ca[_0x1c09c8(0x269)],'wallets':{'usdtPolygonWallet':_0x4792ca[_0x1c09c8(0x246)],'usdtTrcWallet':_0x4792ca[_0x1c09c8(0x27d)],'usdtErcWallet':_0x4792ca[_0x1c09c8(0x2fe)],'usdcPolygonWallet':_0x4792ca['usdcPolygonWallet']},'status':_0x4792ca['status'],'createdAt':_0x4792ca[_0x1c09c8(0x270)]};}async[a40_0x5b1af8(0x304)](_0x9b1017){const _0x1e23d3=a40_0x5b1af8;await database_1[_0x1e23d3(0x24d)][_0x1e23d3(0x22f)][_0x1e23d3(0x309)]({'where':{'id':_0x9b1017}});}[a40_0x5b1af8(0x27a)](_0x314c87,_0xd6ec49,_0x1f7929){const _0x2f00de=a40_0x5b1af8,_0x3dfe4b=new Map(),_0xf47bcb=new Date(_0xd6ec49);while(_0xf47bcb<=_0x1f7929){const _0x11e9d6=_0xf47bcb[_0x2f00de(0x2a1)]()[_0x2f00de(0x1d3)]('T')[0x0];_0x3dfe4b[_0x2f00de(0x1cb)](_0x11e9d6,{'revenue':0x0,'count':0x0}),_0xf47bcb[_0x2f00de(0x312)](_0xf47bcb[_0x2f00de(0x2b9)]()+0x1);}for(const _0x1dda85 of _0x314c87){const _0x45bf90=_0x1dda85['createdAt'][_0x2f00de(0x2a1)]()[_0x2f00de(0x1d3)]('T')[0x0],_0x544d85=_0x3dfe4b['get'](_0x45bf90);_0x544d85&&(_0x544d85['count']+=0x1,_0x1dda85['status']==='PAID'&&(_0x1dda85[_0x2f00de(0x2db)]?_0x544d85[_0x2f00de(0x2c5)]+=_0x1dda85[_0x2f00de(0x2db)]:console['log']('⚠️\x20Payment\x20'+_0x1dda85['id']+_0x2f00de(0x1eb))));}const _0x1eabfb=[],_0x57a4da=[];for(const [_0x356ba3,_0x21095c]of _0x3dfe4b){_0x1eabfb[_0x2f00de(0x221)]({'date':_0x356ba3,'amount':Math[_0x2f00de(0x208)](_0x21095c['revenue']*0x64)/0x64}),_0x57a4da[_0x2f00de(0x221)]({'date':_0x356ba3,'count':_0x21095c[_0x2f00de(0x23e)]});}return{'dailyRevenue':_0x1eabfb,'dailyPayments':_0x57a4da};}}exports[a40_0x5b1af8(0x1d6)]=AdminService;