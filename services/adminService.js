'use strict';const a36_0x37cd06=a36_0xa4a1;(function(_0x5c628b,_0x2e2fc4){const _0x2565ff=a36_0xa4a1,_0x2d63c6=_0x5c628b();while(!![]){try{const _0x5bc4c3=parseInt(_0x2565ff(0x237))/0x1+parseInt(_0x2565ff(0x23c))/0x2+-parseInt(_0x2565ff(0x201))/0x3+-parseInt(_0x2565ff(0x203))/0x4*(parseInt(_0x2565ff(0x21c))/0x5)+-parseInt(_0x2565ff(0x20f))/0x6*(parseInt(_0x2565ff(0x17f))/0x7)+parseInt(_0x2565ff(0x204))/0x8*(parseInt(_0x2565ff(0x120))/0x9)+parseInt(_0x2565ff(0x14a))/0xa;if(_0x5bc4c3===_0x2e2fc4)break;else _0x2d63c6['push'](_0x2d63c6['shift']());}catch(_0x3f3c1c){_0x2d63c6['push'](_0x2d63c6['shift']());}}}(a36_0x1826,0x51dc0));function a36_0xa4a1(_0x243f1e,_0x2866e6){const _0x1826b6=a36_0x1826();return a36_0xa4a1=function(_0xa4a188,_0x71b24a){_0xa4a188=_0xa4a188-0x105;let _0xf732f4=_0x1826b6[_0xa4a188];return _0xf732f4;},a36_0xa4a1(_0x243f1e,_0x2866e6);}var __importDefault=this&&this['__importDefault']||function(_0x1e6697){const _0x3bf398=a36_0xa4a1;return _0x1e6697&&_0x1e6697[_0x3bf398(0x214)]?_0x1e6697:{'default':_0x1e6697};};Object[a36_0x37cd06(0x164)](exports,a36_0x37cd06(0x214),{'value':!![]}),exports[a36_0x37cd06(0x22f)]=void 0x0;function a36_0x1826(){const _0x419310=['PAID','gatewayCommissionRate','ACTIVE','revenue','payment','usdtTrcWallet','🔄\x20Gateway\x20mapping:','\x20USDT\x20(after\x20','Shop\x20not\x20found','status','shopId','updatePaymentStatus','network','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','../config/database','availableBalance','amount','periodTo','toFixed','dailyRevenue','\x20USDT\x20(actual\x20balances)','updateCustomerData','getGatewayInternalName','includes','paymentGateways','\x20USDT','\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)','getSystemStatistics','chargebackAmount','📊\x20Total\x20payments\x20(including\x20failed):\x20','error','\x20\x20\x20✅\x20Total\x20available\x20for\x20payout:\x20','sort','🔐\x20[','telegram','SUSPENDED','2020-01-01','\x20\x20\x20🖥️\x20User\x20Agent:\x20','\x20no\x20longer\x20PAID:','default','🔧\x20[','length','💱\x20Currency\x20filter\x20applied:\x20','shopUrl','custom','dateFrom','groupBy','gatewaySettings','\x20USDT\x20(','📊\x20Using\x20saved\x20values\x20for\x20payment\x20','count','ceil','failUrl','username','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','plisio','hex','📋\x20Found\x20','setHours','📊\x20Final\x20WHERE\x20conditions:','413124izppKy','\x20USDT\x20from\x20balance','5468zHEXxL','2792MlwVpC','⚠️\x20Requested\x20gateway\x20\x27','yesterday','notes','thisMonth','\x20USDT\x20(already\x20paid\x20out)','map','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','\x20USDT\x20(theoretical\x20net)','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:',':\x20commission\x20=\x20','1056qPYuLx',']\x20Gateway\x20settings\x20JSON\x20string:','periodFrom','Noda','\x20->\x20','__esModule','gatewayOrderId','publicKey','gateway','Plisio','totalCommissionRate','turnover','pk_','625kEuZtm','log','name','\x20USDT\x20(-','\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)','forEach','successUrl','🔄\x20Admin\x20updating\x20payment\x20','klyme_gb','\x20\x20\x20💰\x20Total\x20payments\x20turnover:\x20','_count','hash','all','\x20\x20\x20🤔\x20Difference:\x20','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','totalPayments','COMPLETED','telegramId','get','AdminService','merchantUrl','🔄\x20Converted\x20gateway\x20name\x20\x27','\x27\x20not\x20found.\x20Available\x20gateways:\x20','\x20\x20\x20✅\x20Actual\x20available\x20balance:\x20','usdtErcWallet','📊\x20Merchants\x20awaiting\x20payout:\x20','\x20USDT\x20for\x20payment\x20','413615fJMJlN','%\x20commission)','📊\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','amountUSDT','\x20\x20\x20🌍\x20Country:\x20','327374waZUAU','trc20','✅\x20Using\x20gateway\x20filter:\x20\x27','stringify','🔄\x20Gateway\x20mapping\x20(create):','getAllPayouts','🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','day','amountAfterGatewayCommissionUSDT','polygon','\x20\x20\x20💳\x20Total\x20payments:\x20','totalPaidOut','dailyPayments','test_gateway','Rapyd','not\x20set','📅\x20Period:\x20','createdAt','\x20USDT\x20(+','NONEXISTENT_GATEWAY_FILTER','getDate','KLYME\x20DE','paidAt','\x20USDT,\x20merchant:\x20','MasterCard','values','CHARGEBACK','🔍\x20Using\x20gateway\x20\x27','aggregate','toString','getAllUsers','\x20USDT\x20(same\x20as\x20awaiting)','getTime','%\x20from\x20','setDate','3348wGRCIE','\x20\x20\x20�📊\x20Total\x20payments:\x20','findMany','merchantEarnings','currencyService','Username\x20already\x20exists','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','🔄\x20Converted\x20gateway\x20ID\x20\x27','getGatewayIdByName','gateways','REFUND','whiteUrl','\x20for\x20shop\x20','\x20\x20\x20Added\x20to\x20balance:\x20+','_sum','getGatewayDisplayName','randomBytes','reduce','averageCheckUSDT','findFirst','updatedAt','totalAmountUSDT','\x20\x20\x20💵\x20Available\x20balance:\x20','suspendUser','fullName','update','\x20USDT)','PENDING','period','📊\x20Calculating\x20payout\x20statistics...','💰\x20Creating\x20payout\x20for\x20shop\x20','\x20\x20\x20Payout\x20amount:\x20','some','noda','balance','admin','getMerchantsAwaitingPayout','🎯\x20[','\x20order','../types/gateway','year','insensitive','3825570sxYTYb','join','txid','\x20\x20\x20📅\x20Total\x20payouts\x20(this\x20month):\x20','getPaymentById','desc','📊\x20Available\x20gateways\x20in\x20database:','\x20\x20\x20🔍\x20Calculated\x20after\x20commission:\x20','getGatewayNameById','\x20\x20\x20Balance:\x20','gte','customerCountry','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','\x20\x20\x20⏳\x20Pending\x20payout:\x20','wallets','erc20','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','pendingUrl','💰\x20Found\x20','dateTo','statusChangedAt','set','\x20merchants','cointopay','Error\x20processing\x20payment\x20','split','defineProperty','round','\x20\x20\x20🌐\x20IP:\x20','📋\x20Getting\x20merchants\x20selection\x20list...','createPayout','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','customerName','password','Payment\x20not\x20found','customerEmail','KLYME\x20EU','\x20\x20\x20Merchant\x20loses:\x20',',\x20userId:\x20','localeCompare','totalAmountAfterCommissionUSDT','toISOString','merchantEarningsUSDT','parse','getFullYear','delete','awaitingPayout',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','toUpperCase','deletePayout','CoinToPay','klyme_eu','findUnique','17731PuROZb','lte','KLYME\x20GB','\x20in\x20','📊\x20Calculated\x20commission\x20rate\x20for\x20payment\x20','\x20balance\x20updated:\x20','usdcPolygonWallet','getAllPayments','\x20to\x20','customerUa','failureMessage','cointopay2','orderId','commissionUSDT','\x20USDT\x20(total\x20paid\x20to\x20merchants)','currency','createUser','\x20USDT\x20(current\x20balance\x20in\x20DB)','usdtPolygonWallet','\x20\x20\x20💰\x20Total\x20payout:\x20','📊\x20Gateway\x20filter\x20applied:','toLowerCase','totalTurnover','averageCommissionRate','💸\x20CHARGEBACK:\x20Merchant\x20amount\x20already\x20deducted\x20from\x20balance','\x20USDT\x20(gross\x20revenue)','🔄\x20Gateway\x20mapping\x20(get):','\x27\x20->\x20ID\x20\x27','Telegram\x20username\x20already\x20exists','shop','📊\x20Merchant\x20statistics\x20calculated:','asc','\x27\x20(from\x20\x27','📊\x20Payout\x20statistics\x20calculated:','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','substr','📊\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','\x27\x20->\x20name\x20\x27','💰\x20Payment\x20','turnoverUSDT','Open\x20Banking\x202','gatewayEarnings','rapyd','polygon_usdc','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','paymentsCount','convertToUSDT','generateDailyStatistics','$transaction','customerIp','month','activateUser','getMonth','entries','\x20\x20\x20Current\x20balance:\x20','\x20\x20\x20Total\x20paid\x20out:\x20','not\x20specified','adminNotes','getUserById','📊\x20Getting\x20payments\x20with\x20filters:','commission',',\x20successful:\x20','📊\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20','amountAfterCommissionUSDT','date','90d','💰\x20Shop\x20','payout',',\x20Commission:\x20','\x20payments)'];a36_0x1826=function(){return _0x419310;};return a36_0x1826();}const database_1=__importDefault(require(a36_0x37cd06(0x1d3))),bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require('crypto')),currencyService_1=require('./currencyService'),gateway_1=require(a36_0x37cd06(0x147));class AdminService{async['getPayoutStats'](){const _0x16c422=a36_0x37cd06;console[_0x16c422(0x21d)](_0x16c422(0x13d));const _0x4bba16=await database_1[_0x16c422(0x1ec)][_0x16c422(0x19c)]['aggregate']({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':'ACTIVE'}}),_0x27a823=await database_1[_0x16c422(0x1ec)]['payment']['count']({'where':{'status':_0x16c422(0x1c5),'gateway':{'not':_0x16c422(0x10a)}}}),_0x114163=new Date(),_0x986b5=new Date(_0x114163['getFullYear'](),_0x114163[_0x16c422(0x1b3)](),0x1),_0x322a60=new Date(_0x114163[_0x16c422(0x176)](),_0x114163[_0x16c422(0x1b3)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x4faec3=await database_1[_0x16c422(0x1ec)][_0x16c422(0x1c2)][_0x16c422(0x119)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x986b5,'lte':_0x322a60},'status':'COMPLETED'}}),_0x182a1c=_0x4bba16[_0x16c422(0x12e)][_0x16c422(0x108)]||0x0,_0x24b487=_0x4bba16['_sum'][_0x16c422(0x142)]||0x0,_0x1d89db=_0x4faec3['_sum'][_0x16c422(0x1d5)]||0x0,_0x4cdaa5={'totalPayout':Math[_0x16c422(0x165)](_0x182a1c*0x64)/0x64,'awaitingPayout':Math['round'](_0x24b487*0x64)/0x64,'thisMonth':Math[_0x16c422(0x165)](_0x1d89db*0x64)/0x64,'availableBalance':Math[_0x16c422(0x165)](_0x24b487*0x64)/0x64,'totalPayments':_0x27a823};return console['log'](_0x16c422(0x1a0)),console[_0x16c422(0x21d)](_0x16c422(0x192)+_0x4cdaa5['totalPayout']+_0x16c422(0x18d)),console[_0x16c422(0x21d)]('\x20\x20\x20⏳\x20Awaiting\x20payout:\x20'+_0x4cdaa5[_0x16c422(0x178)]+_0x16c422(0x1df)),console[_0x16c422(0x21d)](_0x16c422(0x136)+_0x4cdaa5[_0x16c422(0x1d4)]+_0x16c422(0x11c)),console[_0x16c422(0x21d)]('\x20\x20\x20📅\x20This\x20month:\x20'+_0x4cdaa5[_0x16c422(0x208)]+_0x16c422(0x1de)),console[_0x16c422(0x21d)](_0x16c422(0x107)+_0x4cdaa5[_0x16c422(0x22b)]+'\x20PAID\x20payments'),_0x4cdaa5;}async[a36_0x37cd06(0x1da)](_0x197a6c,_0x227a4f){const _0x4933cc=a36_0x37cd06;console[_0x4933cc(0x21d)](_0x4933cc(0x1ab)+_0x197a6c+':',_0x227a4f);const _0x20ae3b=await database_1[_0x4933cc(0x1ec)]['payment'][_0x4933cc(0x17e)]({'where':{'id':_0x197a6c},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x20ae3b)throw new Error(_0x4933cc(0x16c));const _0x19e428={};_0x227a4f[_0x4933cc(0x155)]!==undefined&&(_0x19e428[_0x4933cc(0x155)]=_0x227a4f[_0x4933cc(0x155)]||null);_0x227a4f[_0x4933cc(0x1b0)]!==undefined&&(_0x19e428[_0x4933cc(0x1b0)]=_0x227a4f[_0x4933cc(0x1b0)]||null);_0x227a4f[_0x4933cc(0x188)]!==undefined&&(_0x19e428[_0x4933cc(0x188)]=_0x227a4f[_0x4933cc(0x188)]||null);const _0x548a09=await database_1[_0x4933cc(0x1ec)][_0x4933cc(0x1c9)][_0x4933cc(0x139)]({'where':{'id':_0x197a6c},'data':{..._0x19e428,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x4933cc(0x21d)](_0x4933cc(0x1a1)+_0x197a6c),console[_0x4933cc(0x21d)](_0x4933cc(0x23b)+_0x20ae3b['customerCountry']+_0x4933cc(0x213)+_0x548a09[_0x4933cc(0x155)]),console[_0x4933cc(0x21d)](_0x4933cc(0x166)+_0x20ae3b[_0x4933cc(0x1b0)]+_0x4933cc(0x213)+_0x548a09[_0x4933cc(0x1b0)]),console[_0x4933cc(0x21d)](_0x4933cc(0x1ea)+(_0x20ae3b[_0x4933cc(0x188)]?_0x4933cc(0x15f):_0x4933cc(0x10c))+'\x20->\x20'+(_0x548a09[_0x4933cc(0x188)]?_0x4933cc(0x15f):_0x4933cc(0x10c))),_0x548a09;}async[a36_0x37cd06(0x1e0)](_0x30f364){const _0x2d95fa=a36_0x37cd06,_0x4480be=new Date();let _0x5837cf;switch(_0x30f364[_0x2d95fa(0x194)]()){case _0x2d95fa(0x243):_0x5837cf=new Date(_0x4480be[_0x2d95fa(0x176)](),_0x4480be[_0x2d95fa(0x1b3)](),_0x4480be[_0x2d95fa(0x111)](),0x0,0x0,0x0,0x0);break;case _0x2d95fa(0x206):const _0x3482a2=new Date(_0x4480be);_0x3482a2['setDate'](_0x3482a2['getDate']()-0x1),_0x5837cf=new Date(_0x3482a2[_0x2d95fa(0x176)](),_0x3482a2[_0x2d95fa(0x1b3)](),_0x3482a2[_0x2d95fa(0x111)](),0x0,0x0,0x0,0x0);break;case'7d':_0x5837cf=new Date(_0x4480be[_0x2d95fa(0x11d)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x5837cf=new Date(_0x4480be['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x2d95fa(0x1c0):_0x5837cf=new Date(_0x4480be[_0x2d95fa(0x11d)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case'all':const _0x45e581=await database_1[_0x2d95fa(0x1ec)][_0x2d95fa(0x1c9)]['findFirst']({'where':{'gateway':{'not':_0x2d95fa(0x10a)}},'orderBy':{'createdAt':_0x2d95fa(0x19e)},'select':{'createdAt':!![]}});_0x5837cf=_0x45e581?_0x45e581['createdAt']:new Date(_0x2d95fa(0x1e9));break;default:_0x5837cf=new Date(_0x4480be[_0x2d95fa(0x11d)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}_0x5837cf['setHours'](0x0,0x0,0x0,0x0);let _0x4e189e;if(_0x30f364[_0x2d95fa(0x194)]()===_0x2d95fa(0x206)){const _0x1d6f65=new Date(_0x4480be);_0x1d6f65[_0x2d95fa(0x11f)](_0x1d6f65[_0x2d95fa(0x111)]()-0x1),_0x4e189e=new Date(_0x1d6f65[_0x2d95fa(0x176)](),_0x1d6f65[_0x2d95fa(0x1b3)](),_0x1d6f65[_0x2d95fa(0x111)](),0x17,0x3b,0x3b,0x3e7);}const _0x16fa4a={'gte':_0x5837cf};_0x4e189e&&(_0x16fa4a[_0x2d95fa(0x180)]=_0x4e189e);const [_0x332157,_0xb8b910,_0x1cc160,_0xc5c3b4,_0x419a39,_0x29ab32]=await Promise['all']([database_1[_0x2d95fa(0x1ec)][_0x2d95fa(0x19c)][_0x2d95fa(0x1f7)](),database_1['default']['shop']['count']({'where':{'status':'ACTIVE'}}),database_1[_0x2d95fa(0x1ec)][_0x2d95fa(0x1c9)][_0x2d95fa(0x1f7)]({'where':{'status':_0x2d95fa(0x1c5),'createdAt':_0x16fa4a,'gateway':{'not':_0x2d95fa(0x10a)}}}),database_1[_0x2d95fa(0x1ec)][_0x2d95fa(0x1c9)]['findMany']({'where':{'status':_0x2d95fa(0x1c5),'createdAt':_0x16fa4a,'gateway':{'not':_0x2d95fa(0x10a)}},'select':{'amount':!![],'currency':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x2d95fa(0x1ec)][_0x2d95fa(0x1c9)][_0x2d95fa(0x122)]({'where':{'gateway':{'not':_0x2d95fa(0x10a)}},'take':0xa,'orderBy':{'createdAt':_0x2d95fa(0x14f)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x2d95fa(0x1ec)][_0x2d95fa(0x1c9)][_0x2d95fa(0x122)]({'where':{'createdAt':_0x16fa4a,'gateway':{'not':_0x2d95fa(0x10a)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x5bd88a=0x0,_0x3b740e=0x0;for(const _0x2167e1 of _0xc5c3b4){const _0x42bf59=await currencyService_1[_0x2d95fa(0x124)][_0x2d95fa(0x1ad)](_0x2167e1[_0x2d95fa(0x1d5)],_0x2167e1[_0x2d95fa(0x18e)]);_0x5bd88a+=_0x42bf59;if(_0x2167e1[_0x2d95fa(0x105)]){const _0x403abf=await currencyService_1[_0x2d95fa(0x124)][_0x2d95fa(0x1ad)](_0x2167e1['amount'],_0x2167e1[_0x2d95fa(0x18e)]),_0x188567=_0x2167e1[_0x2d95fa(0x105)],_0x726273=_0x403abf-_0x188567;_0x3b740e+=_0x726273;}}const _0x4f90c3=_0x1cc160>0x0?_0x5bd88a/_0x1cc160:0x0,_0x4daece=this[_0x2d95fa(0x1ae)](_0x29ab32,_0x5837cf,_0x4e189e||_0x4480be),_0x5de708=await database_1['default'][_0x2d95fa(0x1c9)][_0x2d95fa(0x1f7)]({'where':{'createdAt':_0x16fa4a,'gateway':{'not':_0x2d95fa(0x10a)}}}),_0x458eff=_0x5de708>0x0?_0x1cc160/_0x5de708*0x64:0x0;return{'totalShops':_0x332157,'activeShops':_0xb8b910,'totalPayments':_0x1cc160,'successfulPayments':_0x1cc160,'totalAttempts':_0x5de708,'totalRevenue':Math[_0x2d95fa(0x165)](_0x5bd88a*0x64)/0x64,'trapayEarnings':Math[_0x2d95fa(0x165)](_0x3b740e*0x64)/0x64,'averagePaymentAmount':Math[_0x2d95fa(0x165)](_0x4f90c3*0x64)/0x64,'conversionRate':Math['round'](_0x458eff*0x64)/0x64,'dailyRevenue':_0x4daece[_0x2d95fa(0x1d8)],'dailyPayments':_0x4daece[_0x2d95fa(0x109)],'recentPayments':_0x419a39['map'](_0x2c477c=>({'id':_0x2c477c['id'],'amount':_0x2c477c[_0x2d95fa(0x1d5)],'currency':_0x2c477c['currency'],'status':_0x2c477c['status'],'gateway':_0x2c477c[_0x2d95fa(0x217)],'shop':_0x2c477c[_0x2d95fa(0x19c)],'createdAt':_0x2c477c[_0x2d95fa(0x10e)]}))};}async['getMerchantStatistics'](_0x4ee31a){const _0x545879=a36_0x37cd06;console[_0x545879(0x21d)](_0x545879(0x20d),_0x4ee31a);let _0x18c158,_0x13ffd8=new Date();if(_0x4ee31a['period']===_0x545879(0x1f1)&&_0x4ee31a[_0x545879(0x1f2)]&&_0x4ee31a['dateTo'])_0x18c158=new Date(_0x4ee31a[_0x545879(0x1f2)]),_0x13ffd8=new Date(_0x4ee31a[_0x545879(0x15d)]),_0x18c158[_0x545879(0x1ff)](0x0,0x0,0x0,0x0),_0x13ffd8[_0x545879(0x1ff)](0x17,0x3b,0x3b,0x3e7);else{const _0x228bfa=new Date();switch(_0x4ee31a[_0x545879(0x13c)]){case'week':_0x18c158=new Date(_0x228bfa[_0x545879(0x11d)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x545879(0x1b1):_0x18c158=new Date(_0x228bfa[_0x545879(0x11d)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x545879(0x148):_0x18c158=new Date(_0x228bfa[_0x545879(0x11d)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x545879(0x228):default:_0x18c158=new Date(_0x545879(0x1e9));break;}_0x18c158[_0x545879(0x1ff)](0x0,0x0,0x0,0x0),_0x13ffd8[_0x545879(0x1ff)](0x17,0x3b,0x3b,0x3e7);}console['log'](_0x545879(0x10d)+_0x18c158[_0x545879(0x173)]()+_0x545879(0x187)+_0x13ffd8[_0x545879(0x173)]());const _0x4d4b40={'status':'PAID','gateway':{'not':_0x545879(0x10a)},'paidAt':{'gte':_0x18c158,'lte':_0x13ffd8}};_0x4ee31a[_0x545879(0x1cf)]&&(_0x4d4b40['shopId']=_0x4ee31a[_0x545879(0x1cf)]);const _0x4d9d1c=await database_1[_0x545879(0x1ec)][_0x545879(0x1c9)][_0x545879(0x122)]({'where':_0x4d4b40,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x545879(0x21d)](_0x545879(0x15c)+_0x4d9d1c[_0x545879(0x1ee)]+'\x20paid\x20payments\x20for\x20analysis');const _0x3df0aa={'gateway':{'not':'test_gateway'},'createdAt':{'gte':_0x18c158,'lte':_0x13ffd8}};_0x4ee31a[_0x545879(0x1cf)]&&(_0x3df0aa[_0x545879(0x1cf)]=_0x4ee31a[_0x545879(0x1cf)]);const _0xf92a76=await database_1[_0x545879(0x1ec)][_0x545879(0x1c9)][_0x545879(0x1f7)]({'where':_0x3df0aa});console[_0x545879(0x21d)](_0x545879(0x1e2)+_0xf92a76+_0x545879(0x1bc)+_0x4d9d1c[_0x545879(0x1ee)]);let _0x305bae=0x0,_0x24bee1=0x0,_0x2c4940=0x0;const _0x10a3bc={},_0x100530={},_0xad2a3b={};for(const _0x5e4b29 of _0x4d9d1c){try{const _0x4c955d=_0x5e4b29[_0x545879(0x23a)]||0x0;if(_0x4c955d<=0x0){console['warn']('⚠️\x20Payment\x20'+_0x5e4b29['id']+'\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...');continue;}let _0x891846,_0xd12bbb;if(_0x5e4b29[_0x545879(0x105)]!==null&&_0x5e4b29[_0x545879(0x105)]!==undefined)_0x891846=_0x5e4b29[_0x545879(0x105)],_0xd12bbb=_0x4c955d-_0x891846,console['log'](_0x545879(0x1f6)+_0x5e4b29['id']+':\x20'+_0x4c955d[_0x545879(0x1d7)](0x6)+_0x545879(0x114)+_0x891846[_0x545879(0x1d7)](0x6)+_0x545879(0x1de));else{let _0x53b1e4={};if(_0x5e4b29['shop']['gatewaySettings'])try{_0x53b1e4=JSON[_0x545879(0x175)](_0x5e4b29[_0x545879(0x19c)][_0x545879(0x1f4)]);}catch(_0x5d17b3){console[_0x545879(0x1e3)](_0x545879(0x15a)+_0x5e4b29[_0x545879(0x1cf)]+':',_0x5d17b3);}let _0x207029=0x2d;for(const [_0x1d7c9d,_0x191a70]of Object['entries'](_0x53b1e4)){if(_0x1d7c9d[_0x545879(0x194)]()===_0x5e4b29[_0x545879(0x217)][_0x545879(0x194)]()){_0x207029=_0x191a70[_0x545879(0x1bb)]||0x2d;break;}}_0xd12bbb=_0x4c955d*(_0x207029/0x64),_0x891846=_0x4c955d-_0xd12bbb,console[_0x545879(0x21d)](_0x545879(0x239)+_0x5e4b29['id']+':\x20'+_0x207029+_0x545879(0x11e)+_0x4c955d[_0x545879(0x1d7)](0x6)+'\x20USDT');}_0x305bae+=_0x4c955d,_0x24bee1+=_0x891846,_0x2c4940+=_0xd12bbb;let _0x5c0da5;_0x5e4b29['gatewayCommissionRate']!==null&&_0x5e4b29[_0x545879(0x1c6)]!==undefined?(_0x5c0da5=_0x5e4b29[_0x545879(0x1c6)],console[_0x545879(0x21d)](_0x545879(0x1bd)+_0x5e4b29['id']+':\x20'+_0x5c0da5+'%')):(_0x5c0da5=_0x4c955d>0x0?_0xd12bbb/_0x4c955d*0x64:0x0,console[_0x545879(0x21d)](_0x545879(0x183)+_0x5e4b29['id']+':\x20'+_0x5c0da5[_0x545879(0x1d7)](0x2)+'%'));!_0x10a3bc[_0x5e4b29[_0x545879(0x217)]]&&(_0x10a3bc[_0x5e4b29[_0x545879(0x217)]]={'gateway':_0x5e4b29['gateway'],'gatewayDisplayName':this[_0x545879(0x12f)](_0x5e4b29[_0x545879(0x217)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x10a3bc[_0x5e4b29[_0x545879(0x217)]]['paymentsCount']++,_0x10a3bc[_0x5e4b29[_0x545879(0x217)]]['turnoverUSDT']+=_0x4c955d,_0x10a3bc[_0x5e4b29[_0x545879(0x217)]]['commissionUSDT']+=_0xd12bbb,_0x10a3bc[_0x5e4b29[_0x545879(0x217)]]['merchantEarningsUSDT']+=_0x891846,_0x10a3bc[_0x5e4b29[_0x545879(0x217)]][_0x545879(0x219)]+=_0x5c0da5;!_0x4ee31a[_0x545879(0x1cf)]&&(!_0x100530[_0x5e4b29[_0x545879(0x1cf)]]&&(_0x100530[_0x5e4b29['shopId']]={'shopId':_0x5e4b29[_0x545879(0x1cf)],'shopName':_0x5e4b29['shop']['name'],'shopUsername':_0x5e4b29[_0x545879(0x19c)][_0x545879(0x1fa)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x100530[_0x5e4b29[_0x545879(0x1cf)]][_0x545879(0x1ac)]++,_0x100530[_0x5e4b29['shopId']]['turnoverUSDT']+=_0x4c955d,_0x100530[_0x5e4b29[_0x545879(0x1cf)]]['commissionUSDT']+=_0xd12bbb,_0x100530[_0x5e4b29['shopId']][_0x545879(0x174)]+=_0x891846);const _0x42e9d1=_0x5e4b29[_0x545879(0x113)][_0x545879(0x173)]()[_0x545879(0x163)]('T')[0x0];!_0xad2a3b[_0x42e9d1]&&(_0xad2a3b[_0x42e9d1]={'date':_0x42e9d1,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0xad2a3b[_0x42e9d1][_0x545879(0x21a)]+=_0x4c955d,_0xad2a3b[_0x42e9d1][_0x545879(0x123)]+=_0x891846,_0xad2a3b[_0x42e9d1]['gatewayEarnings']+=_0xd12bbb,_0xad2a3b[_0x42e9d1][_0x545879(0x1ac)]++;}catch(_0x2ecb53){console[_0x545879(0x1e3)](_0x545879(0x162)+_0x5e4b29['id']+':',_0x2ecb53);}}Object['values'](_0x10a3bc)['forEach'](_0x54b5e0=>{const _0x36640c=_0x545879;_0x54b5e0[_0x36640c(0x196)]=_0x54b5e0[_0x36640c(0x1ac)]>0x0?_0x54b5e0[_0x36640c(0x219)]/_0x54b5e0[_0x36640c(0x1ac)]:0x0,delete _0x54b5e0['totalCommissionRate'];}),Object[_0x545879(0x116)](_0x100530)[_0x545879(0x221)](_0x377874=>{const _0x158269=_0x545879;_0x377874[_0x158269(0x132)]=_0x377874[_0x158269(0x1ac)]>0x0?_0x377874[_0x158269(0x1a6)]/_0x377874['paymentsCount']:0x0;});let _0x3d7043=0x0,_0x24632c=0x0;if(_0x4ee31a['shopId']){const _0x19d98b=await database_1[_0x545879(0x1ec)][_0x545879(0x1c2)][_0x545879(0x122)]({'where':{'shopId':_0x4ee31a[_0x545879(0x1cf)],'status':_0x545879(0x22c),'createdAt':{'gte':_0x18c158,'lte':_0x13ffd8}},'select':{'amount':!![]}});_0x3d7043=_0x19d98b[_0x545879(0x131)]((_0x300c02,_0x1aec63)=>_0x300c02+_0x1aec63[_0x545879(0x1d5)],0x0);const _0x5b2e7a=await database_1['default'][_0x545879(0x1c2)][_0x545879(0x122)]({'where':{'shopId':_0x4ee31a[_0x545879(0x1cf)],'status':_0x545879(0x13b),'createdAt':{'gte':_0x18c158,'lte':_0x13ffd8}},'select':{'amount':!![]}});_0x24632c=_0x5b2e7a[_0x545879(0x131)]((_0x469d13,_0x24b42d)=>_0x469d13+_0x24b42d[_0x545879(0x1d5)],0x0);}const _0x43bd11=_0xf92a76,_0x2be7da=_0x4d9d1c[_0x545879(0x1ee)],_0x2875c4=_0x2be7da>0x0?_0x305bae/_0x2be7da:0x0,_0x186a75=_0x43bd11>0x0?Math[_0x545879(0x165)](_0x2be7da/_0x43bd11*0x2710)/0x64:0x0,_0x4d2724=Math[_0x545879(0x1f8)]((_0x13ffd8['getTime']()-_0x18c158[_0x545879(0x11d)]())/(0x3e8*0x3c*0x3c*0x18)),_0x53f92f={'totalTurnover':Math[_0x545879(0x165)](_0x305bae*0x64)/0x64,'merchantEarnings':Math[_0x545879(0x165)](_0x24bee1*0x64)/0x64,'gatewayEarnings':Math[_0x545879(0x165)](_0x2c4940*0x64)/0x64,'totalPaidOut':Math[_0x545879(0x165)](_0x3d7043*0x64)/0x64,'pendingPayout':Math[_0x545879(0x165)](_0x24632c*0x64)/0x64,'averageCheck':Math[_0x545879(0x165)](_0x2875c4*0x64)/0x64,'totalPayments':_0x43bd11,'successfulPayments':_0x2be7da,'conversionRate':_0x186a75,'gatewayBreakdown':Object[_0x545879(0x116)](_0x10a3bc)['map'](_0x292eda=>({..._0x292eda,'turnoverUSDT':Math['round'](_0x292eda[_0x545879(0x1a6)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x292eda[_0x545879(0x18c)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x545879(0x165)](_0x292eda[_0x545879(0x174)]*0x64)/0x64,'averageCommissionRate':Math[_0x545879(0x165)](_0x292eda[_0x545879(0x196)]*0x64)/0x64})),'merchantBreakdown':_0x4ee31a['shopId']?undefined:Object[_0x545879(0x116)](_0x100530)[_0x545879(0x20a)](_0x1bf6c7=>({..._0x1bf6c7,'turnoverUSDT':Math[_0x545879(0x165)](_0x1bf6c7[_0x545879(0x1a6)]*0x64)/0x64,'commissionUSDT':Math[_0x545879(0x165)](_0x1bf6c7[_0x545879(0x18c)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x545879(0x165)](_0x1bf6c7['merchantEarningsUSDT']*0x64)/0x64,'paidOutUSDT':Math[_0x545879(0x165)](_0x1bf6c7['paidOutUSDT']*0x64)/0x64,'averageCheckUSDT':Math[_0x545879(0x165)](_0x1bf6c7[_0x545879(0x132)]*0x64)/0x64})),'dailyData':Object[_0x545879(0x116)](_0xad2a3b)['map'](_0x4b36ce=>({..._0x4b36ce,'turnover':Math['round'](_0x4b36ce[_0x545879(0x21a)]*0x64)/0x64,'merchantEarnings':Math[_0x545879(0x165)](_0x4b36ce['merchantEarnings']*0x64)/0x64,'gatewayEarnings':Math[_0x545879(0x165)](_0x4b36ce[_0x545879(0x1a8)]*0x64)/0x64}))[_0x545879(0x1e5)]((_0x2c6d86,_0x3f89f8)=>_0x2c6d86['date'][_0x545879(0x171)](_0x3f89f8[_0x545879(0x1bf)])),'periodInfo':{'from':_0x18c158,'to':_0x13ffd8,'periodType':_0x4ee31a[_0x545879(0x13c)]||'custom','daysCount':_0x4d2724}};return console[_0x545879(0x21d)](_0x545879(0x19d)),console['log']('\x20\x20\x20💰\x20Total\x20turnover:\x20'+_0x53f92f[_0x545879(0x195)]+'\x20USDT'),console[_0x545879(0x21d)]('\x20\x20\x20👤\x20Merchant\x20earnings:\x20'+_0x53f92f[_0x545879(0x123)]+'\x20USDT'),console['log'](_0x545879(0x20b)+_0x53f92f[_0x545879(0x1a8)]+'\x20USDT'),console['log']('\x20\x20\x20�\x20Total\x20paid\x20out:\x20'+_0x53f92f['totalPaidOut']+_0x545879(0x1de)),console[_0x545879(0x21d)](_0x545879(0x157)+_0x53f92f['pendingPayout']+_0x545879(0x1de)),console['log'](_0x545879(0x121)+_0x53f92f[_0x545879(0x22b)]),_0x53f92f;}async['getMerchantsSelection'](){const _0x17066a=a36_0x37cd06;console[_0x17066a(0x21d)](_0x17066a(0x167));const _0x560603=await database_1[_0x17066a(0x1ec)][_0x17066a(0x19c)][_0x17066a(0x122)]({'where':{'status':_0x17066a(0x1c7)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x17066a(0x19e)}});return console[_0x17066a(0x21d)](_0x17066a(0x1fe)+_0x560603['length']+'\x20active\x20merchants\x20for\x20selection'),_0x560603[_0x17066a(0x20a)](_0x38310f=>({'id':_0x38310f['id'],'username':_0x38310f[_0x17066a(0x1fa)],'name':_0x38310f['name']}));}[a36_0x37cd06(0x12f)](_0x218956){const _0x2a694b=a36_0x37cd06,_0x4abfc2={'test_gateway':'Test\x20Gateway','plisio':_0x2a694b(0x218),'rapyd':_0x2a694b(0x10b),'noda':_0x2a694b(0x212),'cointopay':_0x2a694b(0x17c),'cointopay2':_0x2a694b(0x1a7),'klyme_eu':_0x2a694b(0x16e),'klyme_gb':_0x2a694b(0x181),'klyme_de':_0x2a694b(0x112),'mastercard':_0x2a694b(0x115)};return _0x4abfc2[_0x218956]||_0x218956;}[a36_0x37cd06(0x1db)](_0x41ff7e){const _0x17ebce=a36_0x37cd06,_0x571f8b={'Test\x20Gateway':_0x17ebce(0x10a),'Plisio':_0x17ebce(0x1fc),'Rapyd':_0x17ebce(0x1a9),'Noda':_0x17ebce(0x141),'CoinToPay':_0x17ebce(0x161),'CoinToPay2':_0x17ebce(0x18a),'KLYME\x20EU':_0x17ebce(0x17d),'KLYME\x20GB':_0x17ebce(0x224),'KLYME\x20DE':'klyme_de','MasterCard':'mastercard'};return _0x571f8b[_0x41ff7e]||_0x41ff7e[_0x17ebce(0x194)]();}async[a36_0x37cd06(0x144)](_0x56754d){const _0x2b69fb=a36_0x37cd06,{page:_0x1db456,limit:_0x39f46f,minAmount:_0xb82453,search:_0x56dccf}=_0x56754d,_0x16d657=(_0x1db456-0x1)*_0x39f46f;console[_0x2b69fb(0x21d)](_0x2b69fb(0x22a),_0x56754d);const _0x5531b1={'balance':{'gt':0x0},'status':_0x2b69fb(0x1c7)};_0xb82453&&(_0x5531b1[_0x2b69fb(0x142)][_0x2b69fb(0x154)]=_0xb82453);_0x56dccf&&(_0x5531b1[_0x2b69fb(0x21e)]={'contains':_0x56dccf,'mode':'insensitive'});const [_0x1578a4,_0x3f97ff]=await Promise['all']([database_1[_0x2b69fb(0x1ec)][_0x2b69fb(0x19c)][_0x2b69fb(0x122)]({'where':_0x5531b1,'skip':_0x16d657,'take':_0x39f46f,'orderBy':{'balance':_0x2b69fb(0x14f)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1['default'][_0x2b69fb(0x19c)][_0x2b69fb(0x1f7)]({'where':_0x5531b1})]);console[_0x2b69fb(0x21d)](_0x2b69fb(0x15c)+_0x1578a4[_0x2b69fb(0x1ee)]+'\x20merchants\x20with\x20positive\x20balance');const _0x1d75a6=await Promise[_0x2b69fb(0x228)](_0x1578a4[_0x2b69fb(0x20a)](async _0x25a253=>{const _0x15e7a8=_0x2b69fb,[_0x1da5a6,_0x40292b,_0x4c8ea1]=await Promise['all']([database_1['default'][_0x15e7a8(0x1c9)][_0x15e7a8(0x1f7)]({'where':{'shopId':_0x25a253['id'],'status':'PAID','gateway':{'not':'test_gateway'}}}),database_1[_0x15e7a8(0x1ec)][_0x15e7a8(0x1c9)][_0x15e7a8(0x133)]({'where':{'shopId':_0x25a253['id'],'status':_0x15e7a8(0x1c5),'gateway':{'not':_0x15e7a8(0x10a)}},'orderBy':{'paidAt':'asc'},'select':{'paidAt':!![]}}),database_1[_0x15e7a8(0x1ec)]['payment']['groupBy']({'by':['gateway'],'where':{'shopId':_0x25a253['id'],'status':'PAID','gateway':{'not':_0x15e7a8(0x10a)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x4fd6e6=new Date(),_0x50818b=new Date(_0x4fd6e6[_0x15e7a8(0x176)](),_0x4fd6e6[_0x15e7a8(0x1b3)](),0x1),_0x7186f1=new Date(_0x4fd6e6[_0x15e7a8(0x176)](),_0x4fd6e6[_0x15e7a8(0x1b3)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x1b22c2,_0x45251f]=await Promise['all']([database_1[_0x15e7a8(0x1ec)][_0x15e7a8(0x1c2)][_0x15e7a8(0x119)]({'_sum':{'amount':!![]},'where':{'shopId':_0x25a253['id'],'status':_0x15e7a8(0x22c)}}),database_1[_0x15e7a8(0x1ec)]['payout'][_0x15e7a8(0x119)]({'_sum':{'amount':!![]},'where':{'shopId':_0x25a253['id'],'status':_0x15e7a8(0x22c),'createdAt':{'gte':_0x50818b,'lte':_0x7186f1}}})]),_0x150702=_0x1b22c2[_0x15e7a8(0x12e)]['amount']||0x0,_0x1aee19=_0x45251f['_sum'][_0x15e7a8(0x1d5)]||0x0,_0x35d526=await Promise[_0x15e7a8(0x228)](_0x4c8ea1['map'](async _0x5ba9b0=>{const _0x412106=_0x15e7a8;let _0x4b14c0=0x2d;if(_0x25a253['gatewaySettings'])try{const _0x429889=JSON['parse'](_0x25a253[_0x412106(0x1f4)]);for(const [_0x29dd42,_0x1a00b8]of Object[_0x412106(0x1b4)](_0x429889)){if(_0x29dd42[_0x412106(0x194)]()===_0x5ba9b0[_0x412106(0x217)][_0x412106(0x194)]()){_0x4b14c0=_0x1a00b8[_0x412106(0x1bb)]||0xa,console['log']('💰\x20[PAYOUT]\x20Gateway\x20'+_0x5ba9b0[_0x412106(0x217)]+'\x20for\x20shop\x20'+_0x25a253['id']+_0x412106(0x20e)+_0x4b14c0+'%');break;}}}catch(_0x1b1f77){console[_0x412106(0x1e3)]('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x25a253['id']+':',_0x1b1f77);}const _0x54a044=_0x5ba9b0['_sum']?.[_0x412106(0x23a)]||0x0,_0x2c8c0c=_0x54a044*(0x1-_0x4b14c0/0x64);return{'gateway':_0x5ba9b0[_0x412106(0x217)],'count':_0x5ba9b0[_0x412106(0x226)]?.['id']||0x0,'amountUSDT':Math[_0x412106(0x165)](_0x54a044*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x412106(0x165)](_0x2c8c0c*0x64)/0x64,'commission':_0x4b14c0};})),_0x287ed7=_0x35d526[_0x15e7a8(0x131)]((_0x375785,_0x4ebcd4)=>_0x375785+_0x4ebcd4[_0x15e7a8(0x23a)],0x0),_0x55d87f=_0x35d526[_0x15e7a8(0x131)]((_0x4d83fd,_0x2e4241)=>_0x4d83fd+_0x2e4241[_0x15e7a8(0x1be)],0x0),_0x4ea259=_0x25a253[_0x15e7a8(0x142)];return console[_0x15e7a8(0x21d)]('💰\x20[PAYOUT]\x20Merchant\x20'+_0x25a253[_0x15e7a8(0x1fa)]+':'),console[_0x15e7a8(0x21d)]('\x20\x20\x20�\x20Total\x20payments\x20turnover:\x20'+_0x287ed7[_0x15e7a8(0x1d7)](0x2)+_0x15e7a8(0x198)),console['log'](_0x15e7a8(0x151)+_0x55d87f[_0x15e7a8(0x1d7)](0x2)+_0x15e7a8(0x20c)),console[_0x15e7a8(0x21d)](_0x15e7a8(0x233)+_0x4ea259[_0x15e7a8(0x1d7)](0x2)+_0x15e7a8(0x190)),console[_0x15e7a8(0x21d)]('\x20\x20\x20💸\x20Total\x20payouts:\x20'+_0x150702[_0x15e7a8(0x1d7)](0x2)+_0x15e7a8(0x209)),console['log'](_0x15e7a8(0x229)+(_0x55d87f-_0x150702-_0x4ea259)[_0x15e7a8(0x1d7)](0x2)+_0x15e7a8(0x220)),{'id':_0x25a253['id'],'fullName':_0x25a253[_0x15e7a8(0x21e)],'username':_0x25a253[_0x15e7a8(0x1fa)],'telegramId':_0x25a253[_0x15e7a8(0x1e7)],'merchantUrl':_0x25a253['shopUrl'],'wallets':{'usdtPolygonWallet':_0x25a253[_0x15e7a8(0x191)],'usdtTrcWallet':_0x25a253['usdtTrcWallet'],'usdtErcWallet':_0x25a253[_0x15e7a8(0x234)],'usdcPolygonWallet':_0x25a253[_0x15e7a8(0x185)]},'totalAmountUSDT':Math[_0x15e7a8(0x165)](_0x287ed7*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x55d87f*0x64)/0x64,'currentBalance':Math[_0x15e7a8(0x165)](_0x4ea259*0x64)/0x64,'totalPayout':Math[_0x15e7a8(0x165)](_0x150702*0x64)/0x64,'thisMonth':Math[_0x15e7a8(0x165)](_0x1aee19*0x64)/0x64,'paymentsCount':_0x1da5a6,'oldestPaymentDate':_0x40292b?.[_0x15e7a8(0x113)]||_0x25a253[_0x15e7a8(0x10e)],'gatewayBreakdown':_0x35d526};})),_0x15b36d=_0x1d75a6[_0x2b69fb(0x131)]((_0x705608,_0x3214c2)=>_0x705608+_0x3214c2[_0x2b69fb(0x135)],0x0),_0x4565ef=_0x1d75a6['reduce']((_0x4925ac,_0x3d338e)=>_0x4925ac+_0x3d338e[_0x2b69fb(0x172)],0x0),_0x1522ad=_0x1d75a6[_0x2b69fb(0x131)]((_0x13dbfe,_0x1ead92)=>_0x13dbfe+_0x1ead92['totalPayout'],0x0),_0x56b462=_0x1d75a6[_0x2b69fb(0x131)]((_0x5146db,_0x126062)=>_0x5146db+_0x126062[_0x2b69fb(0x208)],0x0);return console['log'](_0x2b69fb(0x235)+_0x3f97ff+_0x2b69fb(0x160)),console[_0x2b69fb(0x21d)](_0x2b69fb(0x225)+Math[_0x2b69fb(0x165)](_0x15b36d*0x64)/0x64+_0x2b69fb(0x198)),console[_0x2b69fb(0x21d)](_0x2b69fb(0x1e4)+Math['round'](_0x4565ef*0x64)/0x64+_0x2b69fb(0x1d9)),console[_0x2b69fb(0x21d)]('\x20\x20\x20💸\x20Total\x20payouts\x20(all\x20time):\x20'+Math['round'](_0x1522ad*0x64)/0x64+_0x2b69fb(0x1de)),console[_0x2b69fb(0x21d)](_0x2b69fb(0x14d)+Math[_0x2b69fb(0x165)](_0x56b462*0x64)/0x64+'\x20USDT'),{'merchants':_0x1d75a6,'pagination':{'page':_0x1db456,'limit':_0x39f46f,'total':_0x3f97ff,'totalPages':Math['ceil'](_0x3f97ff/_0x39f46f)},'summary':{'totalMerchants':_0x3f97ff,'totalAmountUSDT':Math[_0x2b69fb(0x165)](_0x15b36d*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x2b69fb(0x165)](_0x4565ef*0x64)/0x64,'totalPayout':Math[_0x2b69fb(0x165)](_0x1522ad*0x64)/0x64,'thisMonth':Math[_0x2b69fb(0x165)](_0x56b462*0x64)/0x64}};}async[a36_0x37cd06(0x168)](_0x578d67){const _0x5e4597=a36_0x37cd06,{shopId:_0x5de4b8,amount:_0xfda872,network:_0x1e6982,wallet:_0x15aa1e,notes:_0x4666e0,txid:_0x537b3f,periodFrom:_0x4cebbf,periodTo:_0x29fccc}=_0x578d67,_0x413d27=await database_1['default'][_0x5e4597(0x1af)](async _0x4adca7=>{const _0x1e5c5c=_0x5e4597,_0x1ca882=await _0x4adca7[_0x1e5c5c(0x19c)][_0x1e5c5c(0x17e)]({'where':{'id':_0x5de4b8},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x1ca882)throw new Error(_0x1e5c5c(0x1cd));console[_0x1e5c5c(0x21d)](_0x1e5c5c(0x13e)+_0x1ca882[_0x1e5c5c(0x1fa)]+':'),console[_0x1e5c5c(0x21d)](_0x1e5c5c(0x1b5)+_0x1ca882[_0x1e5c5c(0x142)][_0x1e5c5c(0x1d7)](0x6)+'\x20USDT'),console[_0x1e5c5c(0x21d)](_0x1e5c5c(0x13f)+_0xfda872['toFixed'](0x6)+'\x20USDT'),console[_0x1e5c5c(0x21d)]('\x20\x20\x20Current\x20total\x20paid\x20out:\x20'+_0x1ca882['totalPaidOut'][_0x1e5c5c(0x1d7)](0x6)+_0x1e5c5c(0x1de));if(_0x537b3f)console[_0x1e5c5c(0x21d)]('\x20\x20\x20Transaction\x20hash:\x20'+_0x537b3f);if(_0x1ca882[_0x1e5c5c(0x142)]<_0xfda872)throw new Error('Insufficient\x20balance.\x20Available:\x20'+_0x1ca882[_0x1e5c5c(0x142)][_0x1e5c5c(0x1d7)](0x6)+'\x20USDT,\x20Requested:\x20'+_0xfda872['toFixed'](0x6)+_0x1e5c5c(0x1de));let _0x22a48f=_0x15aa1e;if(!_0x22a48f){const _0x324568=await _0x4adca7[_0x1e5c5c(0x19c)]['findUnique']({'where':{'id':_0x5de4b8},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x324568)switch(_0x1e6982){case _0x1e5c5c(0x106):_0x22a48f=_0x324568[_0x1e5c5c(0x191)]||undefined;break;case _0x1e5c5c(0x23d):_0x22a48f=_0x324568[_0x1e5c5c(0x1ca)]||undefined;break;case _0x1e5c5c(0x159):_0x22a48f=_0x324568['usdtErcWallet']||undefined;break;case _0x1e5c5c(0x1aa):_0x22a48f=_0x324568[_0x1e5c5c(0x185)]||undefined;break;}}console[_0x1e5c5c(0x21d)]('💳\x20Payout\x20wallet\x20for\x20'+_0x1e6982+':\x20'+(_0x22a48f||_0x1e5c5c(0x1b7)));const _0x26090f=await _0x4adca7[_0x1e5c5c(0x1c2)]['create']({'data':{'shopId':_0x5de4b8,'amount':_0xfda872,'network':_0x1e6982,'status':_0x1e5c5c(0x22c),'txid':_0x537b3f,'notes':_0x4666e0,'periodFrom':_0x4cebbf?new Date(_0x4cebbf):null,'periodTo':_0x29fccc?new Date(_0x29fccc):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x3030ff=_0x1ca882[_0x1e5c5c(0x142)]-_0xfda872,_0x284345=_0x1ca882[_0x1e5c5c(0x108)]+_0xfda872;return await _0x4adca7[_0x1e5c5c(0x19c)][_0x1e5c5c(0x139)]({'where':{'id':_0x5de4b8},'data':{'balance':_0x3030ff,'totalPaidOut':_0x284345}}),console[_0x1e5c5c(0x21d)](_0x1e5c5c(0x1c1)+_0x1ca882[_0x1e5c5c(0x1fa)]+'\x20balance\x20updated:'),console[_0x1e5c5c(0x21d)](_0x1e5c5c(0x153)+_0x1ca882[_0x1e5c5c(0x142)][_0x1e5c5c(0x1d7)](0x6)+_0x1e5c5c(0x213)+_0x3030ff['toFixed'](0x6)+_0x1e5c5c(0x21f)+_0xfda872[_0x1e5c5c(0x1d7)](0x6)+')'),console[_0x1e5c5c(0x21d)](_0x1e5c5c(0x1b6)+_0x1ca882[_0x1e5c5c(0x108)][_0x1e5c5c(0x1d7)](0x6)+_0x1e5c5c(0x213)+_0x284345[_0x1e5c5c(0x1d7)](0x6)+_0x1e5c5c(0x10f)+_0xfda872[_0x1e5c5c(0x1d7)](0x6)+')'),{'payout':_0x26090f,'shop':_0x1ca882};});return console[_0x5e4597(0x21d)]('✅\x20Payout\x20created:\x20'+_0x413d27['payout']['id']+_0x5e4597(0x12c)+_0x413d27[_0x5e4597(0x19c)][_0x5e4597(0x1fa)]+'\x20('+_0xfda872+_0x5e4597(0x13a)),{'id':_0x413d27[_0x5e4597(0x1c2)]['id'],'shopId':_0x413d27[_0x5e4597(0x1c2)][_0x5e4597(0x1cf)],'shopName':_0x413d27[_0x5e4597(0x19c)]['name'],'shopUsername':_0x413d27[_0x5e4597(0x19c)]['username'],'amount':_0x413d27['payout']['amount'],'network':_0x413d27[_0x5e4597(0x1c2)][_0x5e4597(0x1d1)],'status':_0x413d27[_0x5e4597(0x1c2)]['status'],'txid':_0x413d27['payout'][_0x5e4597(0x14c)],'notes':_0x413d27['payout']['notes'],'periodFrom':_0x413d27[_0x5e4597(0x1c2)][_0x5e4597(0x211)],'periodTo':_0x413d27[_0x5e4597(0x1c2)][_0x5e4597(0x1d6)],'createdAt':_0x413d27[_0x5e4597(0x1c2)][_0x5e4597(0x10e)],'paidAt':_0x413d27['payout'][_0x5e4597(0x113)]};}async[a36_0x37cd06(0x241)](_0x337d28){const _0x37f5f9=a36_0x37cd06,{page:_0x19794b,limit:_0x39ba7f,shopId:_0x10cc6f,network:_0xd713e4,dateFrom:_0x542fcf,dateTo:_0x240fc2,search:_0x5f1104}=_0x337d28,_0x19ef72=(_0x19794b-0x1)*_0x39ba7f,_0x545972={};_0x10cc6f&&(_0x545972[_0x37f5f9(0x1cf)]=_0x10cc6f);_0xd713e4&&(_0x545972['network']=_0xd713e4);(_0x542fcf||_0x240fc2)&&(_0x545972[_0x37f5f9(0x10e)]={},_0x542fcf&&(_0x545972[_0x37f5f9(0x10e)][_0x37f5f9(0x154)]=new Date(_0x542fcf)),_0x240fc2&&(_0x545972[_0x37f5f9(0x10e)][_0x37f5f9(0x180)]=new Date(_0x240fc2)));_0x5f1104&&(_0x545972['OR']=[{'shop':{'name':{'contains':_0x5f1104,'mode':_0x37f5f9(0x149)}}},{'shop':{'username':{'contains':_0x5f1104,'mode':_0x37f5f9(0x149)}}},{'notes':{'contains':_0x5f1104,'mode':_0x37f5f9(0x149)}}]);const [_0x131381,_0x322967]=await Promise[_0x37f5f9(0x228)]([database_1[_0x37f5f9(0x1ec)]['payout'][_0x37f5f9(0x122)]({'where':_0x545972,'skip':_0x19ef72,'take':_0x39ba7f,'orderBy':{'createdAt':_0x37f5f9(0x14f)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x37f5f9(0x1ec)][_0x37f5f9(0x1c2)][_0x37f5f9(0x1f7)]({'where':_0x545972})]);return{'payouts':_0x131381[_0x37f5f9(0x20a)](_0x1e9cfd=>({'id':_0x1e9cfd['id'],'shopId':_0x1e9cfd[_0x37f5f9(0x1cf)],'shopName':_0x1e9cfd[_0x37f5f9(0x19c)][_0x37f5f9(0x21e)],'shopUsername':_0x1e9cfd[_0x37f5f9(0x19c)][_0x37f5f9(0x1fa)],'amount':_0x1e9cfd[_0x37f5f9(0x1d5)],'network':_0x1e9cfd['network'],'status':_0x1e9cfd[_0x37f5f9(0x1ce)],'txid':_0x1e9cfd[_0x37f5f9(0x14c)],'notes':_0x1e9cfd[_0x37f5f9(0x207)],'periodFrom':_0x1e9cfd[_0x37f5f9(0x211)],'periodTo':_0x1e9cfd[_0x37f5f9(0x1d6)],'createdAt':_0x1e9cfd[_0x37f5f9(0x10e)],'paidAt':_0x1e9cfd['paidAt']})),'pagination':{'page':_0x19794b,'limit':_0x39ba7f,'total':_0x322967,'totalPages':Math['ceil'](_0x322967/_0x39ba7f)}};}async['getPayoutById'](_0x40dcc2){const _0x2965a8=a36_0x37cd06,_0x26f083=await database_1['default']['payout'][_0x2965a8(0x17e)]({'where':{'id':_0x40dcc2},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x26f083)return null;return{'id':_0x26f083['id'],'shopId':_0x26f083[_0x2965a8(0x1cf)],'shopName':_0x26f083[_0x2965a8(0x19c)][_0x2965a8(0x21e)],'shopUsername':_0x26f083['shop'][_0x2965a8(0x1fa)],'amount':_0x26f083[_0x2965a8(0x1d5)],'network':_0x26f083[_0x2965a8(0x1d1)],'status':_0x26f083[_0x2965a8(0x1ce)],'txid':_0x26f083[_0x2965a8(0x14c)],'notes':_0x26f083['notes'],'periodFrom':_0x26f083[_0x2965a8(0x211)],'periodTo':_0x26f083[_0x2965a8(0x1d6)],'createdAt':_0x26f083['createdAt'],'paidAt':_0x26f083[_0x2965a8(0x113)]};}async[a36_0x37cd06(0x17b)](_0x27309d){const _0x52542d=a36_0x37cd06;await database_1[_0x52542d(0x1ec)][_0x52542d(0x1c2)][_0x52542d(0x177)]({'where':{'id':_0x27309d}});}async[a36_0x37cd06(0x186)](_0x553a44){const _0x301a86=a36_0x37cd06,{page:_0x2a9612,limit:_0x36ad87,status:_0x51a6b8,gateway:_0x45aa10,shopId:_0x595e05,dateFrom:_0x4644d6,dateTo:_0x5ca649,search:_0x30c71f,currency:_0x30a452,sortBy:_0x500eab,sortOrder:_0x50dd14}=_0x553a44,_0x3b4b32=(_0x2a9612-0x1)*_0x36ad87;console[_0x301a86(0x21d)](_0x301a86(0x1ba),_0x553a44);const _0x595425=await database_1[_0x301a86(0x1ec)][_0x301a86(0x1c9)][_0x301a86(0x1f3)]({'by':[_0x301a86(0x217)],'_count':{'gateway':!![]}});console[_0x301a86(0x21d)](_0x301a86(0x150),_0x595425[_0x301a86(0x20a)](_0x4308e4=>_0x4308e4['gateway']+'\x20('+_0x4308e4[_0x301a86(0x226)][_0x301a86(0x217)]+_0x301a86(0x1c4)));if(_0x45aa10){const _0x4560aa=_0x595425[_0x301a86(0x140)](_0xc6af45=>_0xc6af45[_0x301a86(0x217)][_0x301a86(0x194)]()===_0x45aa10[_0x301a86(0x194)]());!_0x4560aa&&_0x45aa10[_0x301a86(0x194)]()!==_0x301a86(0x10a)&&console[_0x301a86(0x21d)](_0x301a86(0x205)+_0x45aa10+_0x301a86(0x232)+_0x595425[_0x301a86(0x20a)](_0x351afb=>_0x351afb[_0x301a86(0x217)])[_0x301a86(0x14b)](',\x20'));}const _0x1f7f25={};_0x51a6b8&&(_0x1f7f25[_0x301a86(0x1ce)]=_0x51a6b8[_0x301a86(0x17a)]());if(!_0x45aa10)_0x1f7f25[_0x301a86(0x217)]={'not':_0x301a86(0x10a)};else{if(_0x45aa10&&(_0x45aa10[_0x301a86(0x194)]()===_0x301a86(0x10a)||_0x45aa10==='0000'))_0x1f7f25[_0x301a86(0x217)]=_0x301a86(0x10a);else{let _0x34cd8c=_0x45aa10;const _0x515778=(0x0,gateway_1[_0x301a86(0x152)])(_0x45aa10);if(_0x515778)_0x34cd8c=_0x515778,console[_0x301a86(0x21d)](_0x301a86(0x127)+_0x45aa10+'\x27\x20to\x20name\x20\x27'+_0x34cd8c+'\x27');else{const _0x206bb2=(0x0,gateway_1[_0x301a86(0x128)])(_0x45aa10);if(_0x206bb2){const _0x50bc5d=(0x0,gateway_1[_0x301a86(0x152)])(_0x206bb2);_0x50bc5d&&(_0x34cd8c=_0x50bc5d,console[_0x301a86(0x21d)](_0x301a86(0x231)+_0x45aa10+_0x301a86(0x19a)+_0x206bb2+_0x301a86(0x1a4)+_0x34cd8c+'\x27'));}else console[_0x301a86(0x21d)](_0x301a86(0x118)+_0x45aa10+_0x301a86(0x169));}const _0x914e14=await database_1[_0x301a86(0x1ec)][_0x301a86(0x1c9)][_0x301a86(0x1f7)]({'where':{'gateway':_0x34cd8c[_0x301a86(0x194)]()},'take':0x1});_0x914e14===0x0?(console[_0x301a86(0x21d)]('⚠️\x20Gateway\x20\x27'+_0x34cd8c+_0x301a86(0x19f)+_0x45aa10+_0x301a86(0x1fb)),_0x1f7f25[_0x301a86(0x217)]=_0x301a86(0x110)):(_0x1f7f25[_0x301a86(0x217)]=_0x34cd8c['toLowerCase'](),console[_0x301a86(0x21d)](_0x301a86(0x23e)+_0x34cd8c+'\x27\x20(from\x20\x27'+_0x45aa10+'\x27)'));}}console[_0x301a86(0x21d)](_0x301a86(0x193),_0x1f7f25[_0x301a86(0x217)]);_0x595e05&&(_0x1f7f25[_0x301a86(0x1cf)]=_0x595e05);_0x30a452&&(_0x1f7f25['currency']=_0x30a452[_0x301a86(0x17a)](),console[_0x301a86(0x21d)](_0x301a86(0x1ef)+_0x30a452['toUpperCase']()));(_0x4644d6||_0x5ca649)&&(_0x1f7f25['createdAt']={},_0x4644d6&&(_0x1f7f25[_0x301a86(0x10e)][_0x301a86(0x154)]=new Date(_0x4644d6)),_0x5ca649&&(_0x1f7f25[_0x301a86(0x10e)]['lte']=new Date(_0x5ca649)));_0x30c71f&&(_0x1f7f25['OR']=[{'id':{'contains':_0x30c71f,'mode':_0x301a86(0x149)}},{'orderId':{'contains':_0x30c71f,'mode':_0x301a86(0x149)}},{'gatewayOrderId':{'contains':_0x30c71f,'mode':_0x301a86(0x149)}},{'customerEmail':{'contains':_0x30c71f,'mode':'insensitive'}},{'shop':{'name':{'contains':_0x30c71f,'mode':_0x301a86(0x149)}}},{'shop':{'username':{'contains':_0x30c71f,'mode':_0x301a86(0x149)}}}]);console[_0x301a86(0x21d)](_0x301a86(0x200),JSON[_0x301a86(0x23f)](_0x1f7f25,null,0x2));let _0x44935a={'createdAt':_0x301a86(0x14f)};if(_0x500eab){const _0x2dc139=[_0x301a86(0x1d5),'createdAt',_0x301a86(0x134),_0x301a86(0x1ce),_0x301a86(0x217),_0x301a86(0x18e)],_0x515f22=[_0x301a86(0x19e),_0x301a86(0x14f)];if(_0x2dc139['includes'](_0x500eab)){const _0x5ba593=_0x515f22[_0x301a86(0x1dc)](_0x50dd14)?_0x50dd14:_0x301a86(0x14f);_0x44935a={[_0x500eab]:_0x5ba593},console[_0x301a86(0x21d)]('📊\x20Sorting\x20payments\x20by\x20'+_0x500eab+_0x301a86(0x182)+_0x5ba593+_0x301a86(0x146));}}const [_0x312bbc,_0xaa9139]=await Promise['all']([database_1[_0x301a86(0x1ec)][_0x301a86(0x1c9)][_0x301a86(0x122)]({'where':_0x1f7f25,'skip':_0x3b4b32,'take':_0x36ad87,'orderBy':_0x44935a,'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x301a86(0x1c9)]['count']({'where':_0x1f7f25})]);return{'payments':_0x312bbc,'pagination':{'page':_0x2a9612,'limit':_0x36ad87,'total':_0xaa9139,'totalPages':Math['ceil'](_0xaa9139/_0x36ad87)}};}async[a36_0x37cd06(0x14e)](_0x2f9a1f){const _0x4332f1=a36_0x37cd06,_0x469dc3=await database_1[_0x4332f1(0x1ec)]['payment'][_0x4332f1(0x17e)]({'where':{'id':_0x2f9a1f},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x469dc3)return null;return{'id':_0x469dc3['id'],'shopId':_0x469dc3[_0x4332f1(0x1cf)],'gateway':_0x469dc3[_0x4332f1(0x217)],'amount':_0x469dc3[_0x4332f1(0x1d5)],'currency':_0x469dc3['currency'],'status':_0x469dc3[_0x4332f1(0x1ce)],'orderId':_0x469dc3[_0x4332f1(0x18b)],'gatewayOrderId':_0x469dc3[_0x4332f1(0x215)],'customerEmail':_0x469dc3[_0x4332f1(0x16d)],'customerName':_0x469dc3[_0x4332f1(0x16a)],'customerCountry':_0x469dc3[_0x4332f1(0x155)],'customerIp':_0x469dc3[_0x4332f1(0x1b0)],'customerUa':_0x469dc3[_0x4332f1(0x188)],'failureMessage':_0x469dc3[_0x4332f1(0x189)],'externalPaymentUrl':_0x469dc3['externalPaymentUrl'],'successUrl':_0x469dc3[_0x4332f1(0x222)],'failUrl':_0x469dc3[_0x4332f1(0x1f9)],'pendingUrl':_0x469dc3[_0x4332f1(0x15b)],'whiteUrl':_0x469dc3[_0x4332f1(0x12b)],'createdAt':_0x469dc3['createdAt'],'updatedAt':_0x469dc3['updatedAt'],'shop':_0x469dc3[_0x4332f1(0x19c)]};}async[a36_0x37cd06(0x1d0)](_0xd58fd5,_0x512b7a,_0x3badab,_0x1de436){const _0x234206=a36_0x37cd06,_0x4206da=await database_1['default']['$transaction'](async _0x25598d=>{const _0x21bd0e=a36_0xa4a1,_0x3edffc=await _0x25598d[_0x21bd0e(0x1c9)][_0x21bd0e(0x17e)]({'where':{'id':_0xd58fd5},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x3edffc)throw new Error(_0x21bd0e(0x16c));const _0x103263=_0x3edffc[_0x21bd0e(0x1ce)],_0x2878f8=_0x512b7a['toUpperCase']();console['log'](_0x21bd0e(0x223)+_0xd58fd5+'\x20status:\x20'+_0x103263+_0x21bd0e(0x213)+_0x2878f8),console[_0x21bd0e(0x21d)]('💰\x20Current\x20shop\x20balance:\x20'+_0x3edffc['shop'][_0x21bd0e(0x142)]+_0x21bd0e(0x1de));const _0x354155={'status':_0x2878f8,'updatedAt':new Date(),'statusChangedBy':_0x21bd0e(0x143),'statusChangedAt':new Date()};_0x3badab&&(_0x354155['adminNotes']=_0x3badab);_0x2878f8===_0x21bd0e(0x117)&&_0x1de436&&(_0x354155[_0x21bd0e(0x1e1)]=_0x1de436);let _0x55e542=0x0,_0x5b1e12=_0x3edffc[_0x21bd0e(0x19c)][_0x21bd0e(0x142)];if(_0x2878f8===_0x21bd0e(0x1c5)&&_0x103263!=='PAID'){_0x354155[_0x21bd0e(0x113)]=new Date();const _0x7f5516=await currencyService_1[_0x21bd0e(0x124)][_0x21bd0e(0x1ad)](_0x3edffc[_0x21bd0e(0x1d5)],_0x3edffc[_0x21bd0e(0x18e)]);_0x354155[_0x21bd0e(0x23a)]=_0x7f5516;let _0x5258aa=0x2d;const _0x5e596d=await _0x25598d[_0x21bd0e(0x19c)][_0x21bd0e(0x17e)]({'where':{'id':_0x3edffc[_0x21bd0e(0x1cf)]},'select':{'gatewaySettings':!![]}});if(_0x5e596d?.[_0x21bd0e(0x1f4)])try{const _0x223a2a=JSON[_0x21bd0e(0x175)](_0x5e596d[_0x21bd0e(0x1f4)]);for(const [_0x106bd3,_0x148580]of Object[_0x21bd0e(0x1b4)](_0x223a2a)){if(_0x106bd3[_0x21bd0e(0x194)]()===_0x3edffc[_0x21bd0e(0x217)][_0x21bd0e(0x194)]()){_0x5258aa=_0x148580[_0x21bd0e(0x1bb)]||0xa;break;}}}catch(_0x1eedfe){console[_0x21bd0e(0x1e3)](_0x21bd0e(0x1d2)+_0xd58fd5+':',_0x1eedfe);}let _0x86e8a2;_0x3edffc['amountAfterGatewayCommissionUSDT']!==null&&_0x3edffc[_0x21bd0e(0x105)]!==undefined?(_0x86e8a2=_0x3edffc['amountAfterGatewayCommissionUSDT'],console[_0x21bd0e(0x21d)](_0x21bd0e(0x1a3)+_0x86e8a2[_0x21bd0e(0x1d7)](0x6)+_0x21bd0e(0x236)+_0xd58fd5)):(_0x86e8a2=_0x7f5516*(0x1-_0x5258aa/0x64),console['log']('📊\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20'+_0xd58fd5+':\x20'+_0x5258aa+_0x21bd0e(0x11e)+_0x7f5516['toFixed'](0x6)+'\x20USDT'),_0x354155[_0x21bd0e(0x105)]=_0x86e8a2,_0x354155['gatewayCommissionRate']=_0x5258aa),_0x55e542=_0x86e8a2,_0x5b1e12+=_0x86e8a2,console[_0x21bd0e(0x21d)](_0x21bd0e(0x1a5)+_0xd58fd5+'\x20became\x20PAID:'),console[_0x21bd0e(0x21d)]('\x20\x20\x20Full\x20amount:\x20'+_0x7f5516[_0x21bd0e(0x1d7)](0x6)+_0x21bd0e(0x1de)),console['log']('\x20\x20\x20Gateway:\x20'+_0x3edffc[_0x21bd0e(0x217)]+',\x20Commission:\x20'+_0x5258aa+'%'),console['log']('\x20\x20\x20Merchant\x20gets:\x20'+_0x86e8a2['toFixed'](0x6)+_0x21bd0e(0x1cc)+_0x5258aa+_0x21bd0e(0x238)),console[_0x21bd0e(0x21d)](_0x21bd0e(0x12d)+_0x86e8a2[_0x21bd0e(0x1d7)](0x6)+_0x21bd0e(0x1de));}else{if(_0x103263===_0x21bd0e(0x1c5)&&_0x2878f8!==_0x21bd0e(0x1c5)){if(_0x3edffc[_0x21bd0e(0x23a)]){let _0x24fcf5=0x2d;const _0x5c661d=await _0x25598d[_0x21bd0e(0x19c)][_0x21bd0e(0x17e)]({'where':{'id':_0x3edffc[_0x21bd0e(0x1cf)]},'select':{'gatewaySettings':!![]}});if(_0x5c661d?.[_0x21bd0e(0x1f4)])try{const _0x2989ef=JSON[_0x21bd0e(0x175)](_0x5c661d[_0x21bd0e(0x1f4)]);for(const [_0x515ec0,_0x56e55a]of Object[_0x21bd0e(0x1b4)](_0x2989ef)){if(_0x515ec0[_0x21bd0e(0x194)]()===_0x3edffc[_0x21bd0e(0x217)]['toLowerCase']()){_0x24fcf5=_0x56e55a['commission']||0xa;break;}}}catch(_0x5204a1){console[_0x21bd0e(0x1e3)](_0x21bd0e(0x1d2)+_0xd58fd5+':',_0x5204a1);}const _0x14bcc5=_0x3edffc['amountUSDT']*(0x1-_0x24fcf5/0x64);_0x55e542=-_0x14bcc5,_0x5b1e12-=_0x14bcc5,_0x354155[_0x21bd0e(0x23a)]=null,_0x354155[_0x21bd0e(0x105)]=null,console[_0x21bd0e(0x21d)](_0x21bd0e(0x1a5)+_0xd58fd5+_0x21bd0e(0x1eb)),console[_0x21bd0e(0x21d)]('\x20\x20\x20Full\x20amount:\x20'+_0x3edffc[_0x21bd0e(0x23a)][_0x21bd0e(0x1d7)](0x6)+_0x21bd0e(0x1de)),console[_0x21bd0e(0x21d)]('\x20\x20\x20Gateway:\x20'+_0x3edffc[_0x21bd0e(0x217)]+_0x21bd0e(0x1c3)+_0x24fcf5+'%'),console[_0x21bd0e(0x21d)](_0x21bd0e(0x16f)+_0x14bcc5[_0x21bd0e(0x1d7)](0x6)+_0x21bd0e(0x1cc)+_0x24fcf5+_0x21bd0e(0x238)),console[_0x21bd0e(0x21d)](_0x21bd0e(0x126)+_0x14bcc5[_0x21bd0e(0x1d7)](0x6)+_0x21bd0e(0x1de));}}}_0x2878f8===_0x21bd0e(0x117)&&(_0x103263==='PAID'&&_0x3edffc['amountUSDT']&&console['log'](_0x21bd0e(0x197)),_0x1de436&&_0x1de436>0x0&&(_0x55e542-=_0x1de436,_0x5b1e12-=_0x1de436,console[_0x21bd0e(0x21d)]('💸\x20CHARGEBACK\x20penalty:\x20-'+_0x1de436[_0x21bd0e(0x1d7)](0x6)+_0x21bd0e(0x202))));_0x2878f8===_0x21bd0e(0x12a)&&_0x103263===_0x21bd0e(0x1c5)&&console[_0x21bd0e(0x21d)](_0x21bd0e(0x242));const _0x93ce9a=await _0x25598d[_0x21bd0e(0x1c9)][_0x21bd0e(0x139)]({'where':{'id':_0xd58fd5},'data':_0x354155,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x55e542!==0x0&&(await _0x25598d[_0x21bd0e(0x19c)][_0x21bd0e(0x139)]({'where':{'id':_0x3edffc[_0x21bd0e(0x1cf)]},'data':{'balance':_0x5b1e12}}),console[_0x21bd0e(0x21d)](_0x21bd0e(0x1c1)+_0x3edffc[_0x21bd0e(0x1cf)]+_0x21bd0e(0x184)+_0x3edffc[_0x21bd0e(0x19c)]['balance'][_0x21bd0e(0x1d7)](0x6)+_0x21bd0e(0x213)+_0x5b1e12[_0x21bd0e(0x1d7)](0x6)+_0x21bd0e(0x1f5)+(_0x55e542>0x0?'+':'')+_0x55e542[_0x21bd0e(0x1d7)](0x6)+')')),_0x93ce9a;});return{'id':_0x4206da['id'],'shopId':_0x4206da[_0x234206(0x1cf)],'gateway':_0x4206da[_0x234206(0x217)],'amount':_0x4206da[_0x234206(0x1d5)],'currency':_0x4206da[_0x234206(0x18e)],'status':_0x4206da[_0x234206(0x1ce)],'orderId':_0x4206da[_0x234206(0x18b)],'gatewayOrderId':_0x4206da[_0x234206(0x215)],'customerEmail':_0x4206da['customerEmail'],'customerName':_0x4206da[_0x234206(0x16a)],'customerCountry':_0x4206da[_0x234206(0x155)],'customerIp':_0x4206da[_0x234206(0x1b0)],'customerUa':_0x4206da[_0x234206(0x188)],'failureMessage':_0x4206da[_0x234206(0x189)],'adminNotes':_0x4206da[_0x234206(0x1b8)],'chargebackAmount':_0x4206da['chargebackAmount'],'statusChangedBy':_0x4206da['statusChangedBy'],'statusChangedAt':_0x4206da[_0x234206(0x15e)],'createdAt':_0x4206da['createdAt'],'updatedAt':_0x4206da[_0x234206(0x134)],'shop':_0x4206da[_0x234206(0x19c)]};}async['updateUser'](_0x2c95bb,_0x5f4f53){const _0xb23906=a36_0x37cd06,_0x4f4796=Math['random']()['toString'](0x24)[_0xb23906(0x1a2)](0x2,0x9);console[_0xb23906(0x21d)]('🎯\x20updateUser\x20called\x20with\x20ID:\x20'+_0x4f4796+_0xb23906(0x170)+_0x2c95bb);const _0x37f3c6={..._0x5f4f53};_0x5f4f53[_0xb23906(0x16b)]&&_0x5f4f53[_0xb23906(0x16b)]['trim']()!==''?(console['log'](_0xb23906(0x1e6)+_0x4f4796+']\x20Updating\x20password\x20for\x20user\x20'+_0x2c95bb),_0x37f3c6[_0xb23906(0x16b)]=await bcryptjs_1[_0xb23906(0x1ec)][_0xb23906(0x227)](_0x5f4f53[_0xb23906(0x16b)],0xc)):(console['log'](_0xb23906(0x1e6)+_0x4f4796+_0xb23906(0x179)),delete _0x37f3c6[_0xb23906(0x16b)]);_0x5f4f53[_0xb23906(0x138)]&&(_0x37f3c6['name']=_0x5f4f53[_0xb23906(0x138)],delete _0x37f3c6[_0xb23906(0x138)]);_0x5f4f53[_0xb23906(0x22d)]&&(_0x37f3c6[_0xb23906(0x1e7)]=_0x5f4f53[_0xb23906(0x22d)],delete _0x37f3c6['telegramId']);_0x5f4f53[_0xb23906(0x230)]&&(_0x37f3c6[_0xb23906(0x1f0)]=_0x5f4f53[_0xb23906(0x230)],delete _0x37f3c6[_0xb23906(0x230)]);if(_0x5f4f53['gateways']){const _0x3ad84b=_0x5f4f53[_0xb23906(0x129)][_0xb23906(0x20a)](_0x61b148=>this[_0xb23906(0x1db)](_0x61b148));console[_0xb23906(0x21d)](_0xb23906(0x1cb),_0x5f4f53[_0xb23906(0x129)],'->',_0x3ad84b),_0x37f3c6[_0xb23906(0x1dd)]=JSON[_0xb23906(0x23f)](_0x3ad84b),delete _0x37f3c6['gateways'];}_0x5f4f53[_0xb23906(0x1f4)]&&(console[_0xb23906(0x21d)](_0xb23906(0x1ed)+_0x4f4796+']\x20Gateway\x20settings\x20before\x20saving:',_0x5f4f53[_0xb23906(0x1f4)]),_0x37f3c6[_0xb23906(0x1f4)]=JSON[_0xb23906(0x23f)](_0x5f4f53['gatewaySettings']),console[_0xb23906(0x21d)](_0xb23906(0x1ed)+_0x4f4796+_0xb23906(0x210),_0x37f3c6[_0xb23906(0x1f4)]));_0x5f4f53['wallets']&&(_0x5f4f53[_0xb23906(0x158)][_0xb23906(0x191)]!==undefined&&(_0x37f3c6[_0xb23906(0x191)]=_0x5f4f53[_0xb23906(0x158)][_0xb23906(0x191)]||null),_0x5f4f53[_0xb23906(0x158)][_0xb23906(0x1ca)]!==undefined&&(_0x37f3c6[_0xb23906(0x1ca)]=_0x5f4f53[_0xb23906(0x158)][_0xb23906(0x1ca)]||null),_0x5f4f53[_0xb23906(0x158)][_0xb23906(0x234)]!==undefined&&(_0x37f3c6[_0xb23906(0x234)]=_0x5f4f53['wallets'][_0xb23906(0x234)]||null),_0x5f4f53[_0xb23906(0x158)][_0xb23906(0x185)]!==undefined&&(_0x37f3c6[_0xb23906(0x185)]=_0x5f4f53[_0xb23906(0x158)]['usdcPolygonWallet']||null),delete _0x37f3c6[_0xb23906(0x158)]);const _0x2a2ea7=await database_1[_0xb23906(0x1ec)][_0xb23906(0x19c)][_0xb23906(0x139)]({'where':{'id':_0x2c95bb},'data':_0x37f3c6,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console['log'](_0xb23906(0x145)+_0x4f4796+']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:',_0x2a2ea7[_0xb23906(0x1f4)]),{'id':_0x2a2ea7['id'],'fullName':_0x2a2ea7[_0xb23906(0x21e)],'username':_0x2a2ea7[_0xb23906(0x1fa)],'telegramId':_0x2a2ea7[_0xb23906(0x1e7)],'merchantUrl':_0x2a2ea7[_0xb23906(0x1f0)],'gateways':_0x2a2ea7[_0xb23906(0x1dd)]?JSON['parse'](_0x2a2ea7[_0xb23906(0x1dd)]):null,'gatewaySettings':_0x2a2ea7[_0xb23906(0x1f4)]?JSON['parse'](_0x2a2ea7[_0xb23906(0x1f4)]):null,'publicKey':_0x2a2ea7[_0xb23906(0x216)],'wallets':{'usdtPolygonWallet':_0x2a2ea7[_0xb23906(0x191)],'usdtTrcWallet':_0x2a2ea7[_0xb23906(0x1ca)],'usdtErcWallet':_0x2a2ea7[_0xb23906(0x234)],'usdcPolygonWallet':_0x2a2ea7[_0xb23906(0x185)]},'status':_0x2a2ea7['status'],'createdAt':_0x2a2ea7[_0xb23906(0x10e)]};}async[a36_0x37cd06(0x137)](_0x32a8a1){const _0x3ec4b9=a36_0x37cd06,_0x1bb814=await database_1[_0x3ec4b9(0x1ec)][_0x3ec4b9(0x19c)][_0x3ec4b9(0x139)]({'where':{'id':_0x32a8a1},'data':{'status':_0x3ec4b9(0x1e8)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x1bb814['id'],'fullName':_0x1bb814[_0x3ec4b9(0x21e)],'username':_0x1bb814['username'],'telegramId':_0x1bb814['telegram'],'merchantUrl':_0x1bb814[_0x3ec4b9(0x1f0)],'gateways':_0x1bb814[_0x3ec4b9(0x1dd)]?JSON[_0x3ec4b9(0x175)](_0x1bb814[_0x3ec4b9(0x1dd)]):null,'gatewaySettings':_0x1bb814['gatewaySettings']?JSON['parse'](_0x1bb814[_0x3ec4b9(0x1f4)]):null,'publicKey':_0x1bb814[_0x3ec4b9(0x216)],'wallets':{'usdtPolygonWallet':_0x1bb814['usdtPolygonWallet'],'usdtTrcWallet':_0x1bb814[_0x3ec4b9(0x1ca)],'usdtErcWallet':_0x1bb814[_0x3ec4b9(0x234)],'usdcPolygonWallet':_0x1bb814[_0x3ec4b9(0x185)]},'status':_0x1bb814['status'],'createdAt':_0x1bb814[_0x3ec4b9(0x10e)]};}async[a36_0x37cd06(0x1b2)](_0x33af9b){const _0x48d07c=a36_0x37cd06,_0x6fae46=await database_1['default'][_0x48d07c(0x19c)][_0x48d07c(0x139)]({'where':{'id':_0x33af9b},'data':{'status':_0x48d07c(0x1c7)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x6fae46['id'],'fullName':_0x6fae46[_0x48d07c(0x21e)],'username':_0x6fae46[_0x48d07c(0x1fa)],'telegramId':_0x6fae46[_0x48d07c(0x1e7)],'merchantUrl':_0x6fae46[_0x48d07c(0x1f0)],'gateways':_0x6fae46[_0x48d07c(0x1dd)]?JSON[_0x48d07c(0x175)](_0x6fae46[_0x48d07c(0x1dd)]):null,'gatewaySettings':_0x6fae46['gatewaySettings']?JSON[_0x48d07c(0x175)](_0x6fae46[_0x48d07c(0x1f4)]):null,'publicKey':_0x6fae46['publicKey'],'wallets':{'usdtPolygonWallet':_0x6fae46[_0x48d07c(0x191)],'usdtTrcWallet':_0x6fae46[_0x48d07c(0x1ca)],'usdtErcWallet':_0x6fae46[_0x48d07c(0x234)],'usdcPolygonWallet':_0x6fae46[_0x48d07c(0x185)]},'status':_0x6fae46[_0x48d07c(0x1ce)],'createdAt':_0x6fae46[_0x48d07c(0x10e)]};}async[a36_0x37cd06(0x11b)](_0x3dc5da){const _0x7e2cf4=a36_0x37cd06,{page:_0xee1989,limit:_0x485e80,status:_0xffdf81}=_0x3dc5da,_0x31a8da=(_0xee1989-0x1)*_0x485e80,_0x1e65d5={};_0xffdf81&&(_0x1e65d5[_0x7e2cf4(0x1ce)]=_0xffdf81[_0x7e2cf4(0x17a)]());const [_0x2376d5,_0x3cbb89]=await Promise[_0x7e2cf4(0x228)]([database_1[_0x7e2cf4(0x1ec)][_0x7e2cf4(0x19c)]['findMany']({'where':_0x1e65d5,'skip':_0x31a8da,'take':_0x485e80,'orderBy':{'createdAt':_0x7e2cf4(0x14f)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x7e2cf4(0x1ec)][_0x7e2cf4(0x19c)]['count']({'where':_0x1e65d5})]);return{'users':_0x2376d5[_0x7e2cf4(0x20a)](_0x49d2b8=>{const _0x51d1d3=_0x7e2cf4,_0x5329c8=_0x49d2b8['paymentGateways']?JSON['parse'](_0x49d2b8[_0x51d1d3(0x1dd)]):null,_0x288f5e=_0x5329c8?_0x5329c8[_0x51d1d3(0x20a)](_0x5739e6=>this[_0x51d1d3(0x12f)](_0x5739e6)):null;return{'id':_0x49d2b8['id'],'fullName':_0x49d2b8[_0x51d1d3(0x21e)],'username':_0x49d2b8[_0x51d1d3(0x1fa)],'telegramId':_0x49d2b8[_0x51d1d3(0x1e7)],'merchantUrl':_0x49d2b8['shopUrl'],'gateways':_0x288f5e,'gatewaySettings':_0x49d2b8[_0x51d1d3(0x1f4)]?JSON[_0x51d1d3(0x175)](_0x49d2b8[_0x51d1d3(0x1f4)]):null,'publicKey':_0x49d2b8[_0x51d1d3(0x216)],'wallets':{'usdtPolygonWallet':_0x49d2b8[_0x51d1d3(0x191)],'usdtTrcWallet':_0x49d2b8[_0x51d1d3(0x1ca)],'usdtErcWallet':_0x49d2b8[_0x51d1d3(0x234)],'usdcPolygonWallet':_0x49d2b8[_0x51d1d3(0x185)]},'status':_0x49d2b8[_0x51d1d3(0x1ce)],'createdAt':_0x49d2b8['createdAt']};}),'pagination':{'page':_0xee1989,'limit':_0x485e80,'total':_0x3cbb89,'totalPages':Math['ceil'](_0x3cbb89/_0x485e80)}};}async[a36_0x37cd06(0x1b9)](_0x3155e1){const _0x2b517a=a36_0x37cd06,_0x43382f=await database_1[_0x2b517a(0x1ec)][_0x2b517a(0x19c)][_0x2b517a(0x17e)]({'where':{'id':_0x3155e1},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x43382f)return null;const _0x4697f4=_0x43382f[_0x2b517a(0x1dd)]?JSON['parse'](_0x43382f[_0x2b517a(0x1dd)]):null,_0x578a50=_0x4697f4?_0x4697f4[_0x2b517a(0x20a)](_0x4c9bbd=>this[_0x2b517a(0x12f)](_0x4c9bbd)):null;return _0x4697f4&&_0x578a50&&console['log'](_0x2b517a(0x199),_0x4697f4,'->',_0x578a50),{'id':_0x43382f['id'],'fullName':_0x43382f['name'],'username':_0x43382f[_0x2b517a(0x1fa)],'telegramId':_0x43382f['telegram'],'merchantUrl':_0x43382f[_0x2b517a(0x1f0)],'gateways':_0x578a50,'gatewaySettings':_0x43382f[_0x2b517a(0x1f4)]?JSON[_0x2b517a(0x175)](_0x43382f[_0x2b517a(0x1f4)]):null,'publicKey':_0x43382f[_0x2b517a(0x216)],'wallets':{'usdtPolygonWallet':_0x43382f[_0x2b517a(0x191)],'usdtTrcWallet':_0x43382f[_0x2b517a(0x1ca)],'usdtErcWallet':_0x43382f[_0x2b517a(0x234)],'usdcPolygonWallet':_0x43382f['usdcPolygonWallet']},'status':_0x43382f['status'],'createdAt':_0x43382f[_0x2b517a(0x10e)]};}async[a36_0x37cd06(0x18f)](_0x4b6555){const _0x3e2886=a36_0x37cd06,{fullName:_0x35f4d9,username:_0x31b6d6,password:_0x101e9b,telegramId:_0x1123b3,merchantUrl:_0x3c1fc1,gateways:_0x546c5b,gatewaySettings:_0x13bc0a,wallets:_0x2ce296}=_0x4b6555,_0x30a276=await database_1[_0x3e2886(0x1ec)][_0x3e2886(0x19c)][_0x3e2886(0x17e)]({'where':{'username':_0x31b6d6}});if(_0x30a276)throw new Error(_0x3e2886(0x125));if(_0x1123b3){const _0x3218bc=await database_1['default'][_0x3e2886(0x19c)][_0x3e2886(0x17e)]({'where':{'telegram':_0x1123b3}});if(_0x3218bc)throw new Error(_0x3e2886(0x19b));}const _0x2aff47=await bcryptjs_1[_0x3e2886(0x1ec)]['hash'](_0x101e9b,0xc),_0x4dcb6d=_0x3e2886(0x21b)+crypto_1[_0x3e2886(0x1ec)][_0x3e2886(0x130)](0x20)[_0x3e2886(0x11a)](_0x3e2886(0x1fd)),_0x4fc7ef='sk_'+crypto_1['default']['randomBytes'](0x20)[_0x3e2886(0x11a)](_0x3e2886(0x1fd)),_0x171a10=_0x546c5b?_0x546c5b[_0x3e2886(0x20a)](_0x1affa6=>this[_0x3e2886(0x1db)](_0x1affa6)):null;_0x546c5b&&_0x171a10&&console[_0x3e2886(0x21d)](_0x3e2886(0x240),_0x546c5b,'->',_0x171a10);const _0x34685b=await database_1['default'][_0x3e2886(0x19c)]['create']({'data':{'name':_0x35f4d9,'username':_0x31b6d6,'password':_0x2aff47,'telegram':_0x1123b3,'shopUrl':_0x3c1fc1,'paymentGateways':_0x171a10?JSON[_0x3e2886(0x23f)](_0x171a10):null,'gatewaySettings':_0x13bc0a?JSON[_0x3e2886(0x23f)](_0x13bc0a):null,'usdtPolygonWallet':_0x2ce296?.[_0x3e2886(0x191)]||null,'usdtTrcWallet':_0x2ce296?.[_0x3e2886(0x1ca)]||null,'usdtErcWallet':_0x2ce296?.[_0x3e2886(0x234)]||null,'usdcPolygonWallet':_0x2ce296?.[_0x3e2886(0x185)]||null,'publicKey':_0x4dcb6d,'secretKey':_0x4fc7ef,'status':_0x3e2886(0x1c7)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x34685b['id'],'fullName':_0x34685b[_0x3e2886(0x21e)],'username':_0x34685b[_0x3e2886(0x1fa)],'telegramId':_0x34685b[_0x3e2886(0x1e7)],'merchantUrl':_0x34685b[_0x3e2886(0x1f0)],'gateways':_0x34685b[_0x3e2886(0x1dd)]?JSON[_0x3e2886(0x175)](_0x34685b[_0x3e2886(0x1dd)]):null,'gatewaySettings':_0x34685b[_0x3e2886(0x1f4)]?JSON['parse'](_0x34685b[_0x3e2886(0x1f4)]):null,'publicKey':_0x34685b[_0x3e2886(0x216)],'wallets':{'usdtPolygonWallet':_0x34685b['usdtPolygonWallet'],'usdtTrcWallet':_0x34685b[_0x3e2886(0x1ca)],'usdtErcWallet':_0x34685b['usdtErcWallet'],'usdcPolygonWallet':_0x34685b['usdcPolygonWallet']},'status':_0x34685b[_0x3e2886(0x1ce)],'createdAt':_0x34685b['createdAt']};}async['deleteUser'](_0x3a62bc){const _0xdd205a=a36_0x37cd06;await database_1[_0xdd205a(0x1ec)][_0xdd205a(0x19c)]['delete']({'where':{'id':_0x3a62bc}});}[a36_0x37cd06(0x1ae)](_0x4e1e6b,_0x1b48c9,_0xc87230){const _0x12b1ec=a36_0x37cd06,_0x22f43b=new Map(),_0x41b978=new Date(_0x1b48c9);while(_0x41b978<=_0xc87230){const _0x21efde=_0x41b978[_0x12b1ec(0x173)]()['split']('T')[0x0];_0x22f43b[_0x12b1ec(0x15f)](_0x21efde,{'revenue':0x0,'count':0x0}),_0x41b978[_0x12b1ec(0x11f)](_0x41b978[_0x12b1ec(0x111)]()+0x1);}for(const _0x4944db of _0x4e1e6b){const _0x3dced2=_0x4944db[_0x12b1ec(0x10e)][_0x12b1ec(0x173)]()[_0x12b1ec(0x163)]('T')[0x0],_0x20491c=_0x22f43b[_0x12b1ec(0x22e)](_0x3dced2);_0x20491c&&(_0x20491c[_0x12b1ec(0x1f7)]+=0x1,_0x4944db[_0x12b1ec(0x1ce)]==='PAID'&&(_0x4944db[_0x12b1ec(0x23a)]?_0x20491c[_0x12b1ec(0x1c8)]+=_0x4944db[_0x12b1ec(0x23a)]:console['log']('⚠️\x20Payment\x20'+_0x4944db['id']+_0x12b1ec(0x156))));}const _0x57cc12=[],_0xf4bb62=[];for(const [_0xf5e11f,_0x513b18]of _0x22f43b){_0x57cc12['push']({'date':_0xf5e11f,'amount':Math['round'](_0x513b18[_0x12b1ec(0x1c8)]*0x64)/0x64}),_0xf4bb62['push']({'date':_0xf5e11f,'count':_0x513b18[_0x12b1ec(0x1f7)]});}return{'dailyRevenue':_0x57cc12,'dailyPayments':_0xf4bb62};}}exports[a36_0x37cd06(0x22f)]=AdminService;