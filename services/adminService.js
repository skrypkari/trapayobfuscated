'use strict';const a33_0x13a4cd=a33_0x1b57;(function(_0x587fb5,_0x4d0433){const _0x388eda=a33_0x1b57,_0x162246=_0x587fb5();while(!![]){try{const _0x5451b6=parseInt(_0x388eda(0x1fe))/0x1*(-parseInt(_0x388eda(0x247))/0x2)+parseInt(_0x388eda(0x227))/0x3+parseInt(_0x388eda(0x1d9))/0x4*(parseInt(_0x388eda(0x1c2))/0x5)+parseInt(_0x388eda(0x1fd))/0x6+parseInt(_0x388eda(0x208))/0x7+parseInt(_0x388eda(0x236))/0x8*(-parseInt(_0x388eda(0x1b2))/0x9)+-parseInt(_0x388eda(0x24f))/0xa*(parseInt(_0x388eda(0x23b))/0xb);if(_0x5451b6===_0x4d0433)break;else _0x162246['push'](_0x162246['shift']());}catch(_0x5a5a31){_0x162246['push'](_0x162246['shift']());}}}(a33_0x5c91,0x726e0));function a33_0x1b57(_0x21134a,_0x5e61df){const _0x5c9164=a33_0x5c91();return a33_0x1b57=function(_0x1b5793,_0x2959b9){_0x1b5793=_0x1b5793-0x17d;let _0x53a2ac=_0x5c9164[_0x1b5793];return _0x53a2ac;},a33_0x1b57(_0x21134a,_0x5e61df);}var __importDefault=this&&this[a33_0x13a4cd(0x1d0)]||function(_0x34974f){const _0x3a0b62=a33_0x13a4cd;return _0x34974f&&_0x34974f[_0x3a0b62(0x209)]?_0x34974f:{'default':_0x34974f};};Object[a33_0x13a4cd(0x18c)](exports,a33_0x13a4cd(0x209),{'value':!![]}),exports[a33_0x13a4cd(0x1c8)]=void 0x0;const database_1=__importDefault(require(a33_0x13a4cd(0x22c))),currencyService_1=require(a33_0x13a4cd(0x1ec)),userService_1=require('./userService'),telegramBotService_1=require(a33_0x13a4cd(0x193)),gateway_1=require(a33_0x13a4cd(0x21a));function a33_0x5c91(){const _0x23908f=['commission','updateMany','\x20payments\x20as\x20paid\x20out','charAt','gateway','usdtErcWallet','90d','✅\x20Activating\x20user:\x20','chargebackAmount','💳\x20Total\x20payments:\x20','User\x20is\x20already\x20active','defineProperty','✅\x20Found\x20payout:\x20','💸\x20Chargeback\x20amount:\x20','\x20USDT\x20(включая\x20штрафы\x20chargeback)','convertToUSDT','✅\x20Payout\x20statistics\x20calculated:','updatedAt','./telegramBotService','totalPayout','usdtPolygonWallet','error','Chargeback\x20amount\x20is\x20required\x20and\x20must\x20be\x20positive\x20(amount\x20in\x20USDT)','shop','gatewaySettings','currencyService','amountAfterCommissionUSDT','payment','\x20USDT\x20via\x20','\x20total','\x20suspended\x20successfully','\x20days)','push','reduce','userService','count','generateDateRange','map','customerEmail','split','\x20eligible\x20PAID\x20payments\x20for\x20payout\x20analysis','entries','\x20payouts\x20out\x20of\x20','totalAmountAfterCommissionUSDT','sendPayoutNotification','create','length','isValidGatewayId','getUserById','90kXwzJe','set','payments','cardLast4','👥\x20Total\x20users:\x20','findUnique','getPayoutById','update','\x20days','createdAt','remitterName','insensitive','activateUser','toISOString','expiresAt','statusChangedAt','40MkpeIB','\x20USDT','\x20status\x20to:\x20','getSystemStatistics','CHARGEBACK','ACTIVE','AdminService','paidAt','💸\x20Chargeback\x20penalty:\x20','🗑️\x20Deleting\x20payout:\x20','📅\x20This\x20Month:\x20','usdtTrcWallet','completed','calculateEffectiveAmount','__importDefault','amountUSDT','stringify','round','totalAmountUSDT','amount','❌\x20Payout\x20not\x20found:\x20','\x20USDT\x20after\x20commission)','availableBalance','53960SSadDo','getAllUsers','📊\x20Calculating\x20admin\x20payout\x20statistics...','adminNotes','name','Payment\x20not\x20found','🔄\x20Admin\x20updating\x20payment\x20','usage','Payout\x20not\x20found','📋\x20Getting\x20payouts\x20with\x20filters:','txid','webhookLog','📋\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','getTime','abs','SUSPENDED','status','paymentGateways','notes','./currencyService','markPaymentsAsPaidOut','getGatewaySettings','🏪\x20Found\x20','getMerchantsAwaitingPayout','getFullYear','🔄\x20Marking\x20payments\x20as\x20paid\x20out\x20for\x20shop\x20','username','toFixed','remitterIban','gatewayPaymentId','shopUrl','desc','admin_status_update',',\x20amount:\x20','default','parse','2178060wLVcpo','3zKWjuy','suspendUser','telegram','all','PENDING','\x20to\x20','createUser','✅\x20Admin\x20statistics\x20generated\x20successfully','getAllPayments','gatewayOrderId','6254010cPlxiH','__esModule','⏳\x20Awaiting\x20Payout:\x20','bankId','📋\x20Getting\x20users\x20with\x20filters:','PAID','toLowerCase','💰\x20Total\x20amount:\x20','shopId','getAllPayouts','includes','paymentMethod','\x20USDT\x20(','isEligibleForPayout','publicKey','orderId','💰\x20Found\x20','✅\x20Payment\x20','../types/gateway','✅\x20User\x20','customerName','getMonth','delete','User\x20is\x20already\x20suspended','\x20USDT\x20(will\x20be\x20deducted\x20from\x20merchant\x20balance)','sourceCurrency','✅\x20Found\x20payment:\x20','gte','externalPaymentUrl','updateUser','REFUND','1457307OIuOtP','💸\x20Creating\x20payout\x20for\x20shop\x20','getPaymentById','currency','💰\x20Available\x20Balance:\x20','../config/database','payout','from','📊\x20Generating\x20admin\x20statistics\x20for\x20period:\x20','payoutDelay','ceil','slice','log','findMany','📊\x20Daily\x20revenue\x20entries:\x20','50576svJWBJ','getPeriodDays','sort','User\x20not\x20found','Shop\x20is\x20not\x20active','11966515tTGDLw','getGatewayNameById','statusChangedBy','date','📈\x20Average\x20payment:\x20','toUpperCase','Shop\x20not\x20found','🔍\x20Getting\x20payout\x20by\x20ID:\x20','setDate','30d','admin','get','153560TntLaJ','\x20merchants\x20with\x20eligible\x20PAID\x20payments','asc','getDate','Invalid\x20status.\x20Valid\x20statuses:\x20','📊\x20Found\x20','calculateAmountAfterCommission','Failed\x20to\x20send\x20Telegram\x20payout\x20notification:','10BLBEhL','size','\x20activated\x20successfully','updatePaymentStatus','💵\x20Total\x20revenue:\x20','has','lte','deleteUser','network'];a33_0x5c91=function(){return _0x23908f;};return a33_0x5c91();}class AdminService{constructor(){const _0xac243e=a33_0x13a4cd;this[_0xac243e(0x1a3)]=new userService_1['UserService']();}[a33_0x13a4cd(0x237)](_0x565141){const _0x30d336=a33_0x13a4cd;switch(_0x565141){case'7d':return 0x7;case _0x30d336(0x244):return 0x1e;case _0x30d336(0x187):return 0x5a;case'1y':return 0x16d;default:return 0x1e;}}[a33_0x13a4cd(0x1a5)](_0x4e9b91,_0x507d57){const _0x4bae58=a33_0x13a4cd,_0x5dfc7d=[],_0x44b34c=new Date(_0x4e9b91);while(_0x44b34c<=_0x507d57){_0x5dfc7d[_0x4bae58(0x1a1)](_0x44b34c[_0x4bae58(0x1bf)]()[_0x4bae58(0x1a8)]('T')[0x0]),_0x44b34c[_0x4bae58(0x243)](_0x44b34c[_0x4bae58(0x24a)]()+0x1);}return _0x5dfc7d;}[a33_0x13a4cd(0x1ee)](_0x396667,_0x20559c){const _0x189ec6=a33_0x13a4cd;if(!_0x396667['gatewaySettings'])return{'commission':0x0,'payoutDelay':0x0};try{const _0x291280=JSON['parse'](_0x396667['gatewaySettings']),_0xf7ee0b=_0x20559c[_0x189ec6(0x184)](0x0)['toUpperCase']()+_0x20559c[_0x189ec6(0x232)](0x1)[_0x189ec6(0x20e)]();if(_0x291280&&_0x291280[_0xf7ee0b])return{'commission':_0x291280[_0xf7ee0b]['commission']||0x0,'payoutDelay':_0x291280[_0xf7ee0b][_0x189ec6(0x230)]||0x0};}catch(_0x1dba98){console[_0x189ec6(0x196)]('Error\x20parsing\x20gateway\x20settings:',_0x1dba98);}return{'commission':0x0,'payoutDelay':0x0};}[a33_0x13a4cd(0x215)](_0x1743c8){const _0x1a3f85=a33_0x13a4cd;if(_0x1743c8[_0x1a3f85(0x1e9)]!==_0x1a3f85(0x20d)||_0x1743c8['merchantPaid']||!_0x1743c8[_0x1a3f85(0x1c9)])return![];const _0x356a71=this[_0x1a3f85(0x1ee)](_0x1743c8[_0x1a3f85(0x198)],_0x1743c8[_0x1a3f85(0x185)]),_0x272f27=_0x356a71[_0x1a3f85(0x230)]*0x18*0x3c*0x3c*0x3e8,_0x222194=new Date(_0x1743c8[_0x1a3f85(0x1c9)][_0x1a3f85(0x1e6)]()+_0x272f27);return new Date()>_0x222194;}['calculateAmountAfterCommission'](_0x39342b,_0x120ed4){return _0x39342b*(0x1-_0x120ed4/0x64);}[a33_0x13a4cd(0x1cf)](_0x348535){const _0x919dd3=a33_0x13a4cd;switch(_0x348535[_0x919dd3(0x1e9)]){case'PAID':return _0x348535[_0x919dd3(0x1d5)];case _0x919dd3(0x1c6):return-(_0x348535[_0x919dd3(0x189)]||0x0);case _0x919dd3(0x226):return 0x0;default:return 0x0;}}async['createPayout'](_0x312b96){const _0x5d2794=a33_0x13a4cd,{shopId:_0x4cb73f,amount:_0x5fdc99,network:_0x54bc89,notes:_0x5c2bb5}=_0x312b96;console[_0x5d2794(0x233)](_0x5d2794(0x228)+_0x4cb73f+':\x20'+_0x5fdc99+_0x5d2794(0x19d)+_0x54bc89);const _0x582e40=await database_1[_0x5d2794(0x1fb)][_0x5d2794(0x198)]['findUnique']({'where':{'id':_0x4cb73f},'select':{'id':!![],'name':!![],'username':!![],'status':!![]}});if(!_0x582e40)throw new Error(_0x5d2794(0x241));if(_0x582e40[_0x5d2794(0x1e9)]!==_0x5d2794(0x1c7))throw new Error(_0x5d2794(0x23a));const _0x3e1d15=await database_1[_0x5d2794(0x1fb)][_0x5d2794(0x22d)][_0x5d2794(0x1ae)]({'data':{'shopId':_0x4cb73f,'amount':_0x5fdc99,'network':_0x54bc89,'status':'COMPLETED','notes':_0x5c2bb5||null,'paidAt':new Date()},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});await this[_0x5d2794(0x1ed)](_0x4cb73f,_0x5fdc99);try{await telegramBotService_1['telegramBotService'][_0x5d2794(0x1ad)](_0x4cb73f,_0x3e1d15,_0x5d2794(0x1ce));}catch(_0x4a390f){console[_0x5d2794(0x196)](_0x5d2794(0x24e),_0x4a390f);}return console['log']('✅\x20Payout\x20created\x20successfully:\x20'+_0x3e1d15['id']),{'id':_0x3e1d15['id'],'shopId':_0x3e1d15['shopId'],'shopName':_0x3e1d15['shop']['name'],'shopUsername':_0x3e1d15['shop'][_0x5d2794(0x1f3)],'amount':_0x3e1d15['amount'],'network':_0x3e1d15[_0x5d2794(0x180)],'status':_0x3e1d15[_0x5d2794(0x1e9)],'txid':_0x3e1d15[_0x5d2794(0x1e3)],'notes':_0x3e1d15[_0x5d2794(0x1eb)],'createdAt':_0x3e1d15[_0x5d2794(0x1bb)],'paidAt':_0x3e1d15[_0x5d2794(0x1c9)]};}async[a33_0x13a4cd(0x1ed)](_0x41ccc6,_0x249edf){const _0x290aad=a33_0x13a4cd;console['log'](_0x290aad(0x1f2)+_0x41ccc6+_0x290aad(0x1fa)+_0x249edf+_0x290aad(0x1c3));const _0x4a729d=await database_1[_0x290aad(0x1fb)][_0x290aad(0x19c)][_0x290aad(0x234)]({'where':{'shopId':_0x41ccc6,'status':'PAID','merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'shop':{'select':{'gatewaySettings':!![]}}},'orderBy':{'paidAt':_0x290aad(0x249)}});let _0x77cc53=_0x249edf;const _0x505721=[];for(const _0xea63e3 of _0x4a729d){const _0x30b730={..._0xea63e3,'status':'PAID','merchantPaid':![],'shop':{'gatewaySettings':_0xea63e3[_0x290aad(0x198)][_0x290aad(0x199)]}};if(!this[_0x290aad(0x215)](_0x30b730))continue;const _0x4486ee=await currencyService_1[_0x290aad(0x19a)][_0x290aad(0x190)](_0xea63e3[_0x290aad(0x1d5)],_0xea63e3[_0x290aad(0x22a)]),_0x1a7310=this[_0x290aad(0x1ee)](_0xea63e3[_0x290aad(0x198)],_0xea63e3[_0x290aad(0x185)]),_0x11cd52=this['calculateAmountAfterCommission'](_0x4486ee,_0x1a7310['commission']);if(_0x11cd52<=_0x77cc53){_0x505721['push'](_0xea63e3['id']),_0x77cc53-=_0x11cd52;if(_0x77cc53<=0.01)break;}}_0x505721[_0x290aad(0x1af)]>0x0&&(await database_1['default'][_0x290aad(0x19c)][_0x290aad(0x182)]({'where':{'id':{'in':_0x505721}},'data':{'merchantPaid':!![]}}),console[_0x290aad(0x233)]('✅\x20Marked\x20'+_0x505721[_0x290aad(0x1af)]+_0x290aad(0x183)));}async[a33_0x13a4cd(0x211)](_0x12b381){const _0xbb57=a33_0x13a4cd,{page:_0x4f5377,limit:_0x2a5819,shopId:_0x20375c,network:_0xe9e81e,dateFrom:_0x3256bf,dateTo:_0x112d39,search:_0x19b121}=_0x12b381,_0x40bf39=(_0x4f5377-0x1)*_0x2a5819;console[_0xbb57(0x233)](_0xbb57(0x1e2),_0x12b381);const _0x284dcc={};_0x20375c&&(_0x284dcc[_0xbb57(0x210)]=_0x20375c);_0xe9e81e&&(_0x284dcc[_0xbb57(0x180)]=_0xe9e81e);(_0x3256bf||_0x112d39)&&(_0x284dcc[_0xbb57(0x1bb)]={},_0x3256bf&&(_0x284dcc['createdAt'][_0xbb57(0x223)]=new Date(_0x3256bf)),_0x112d39&&(_0x284dcc[_0xbb57(0x1bb)][_0xbb57(0x17e)]=new Date(_0x112d39)));_0x19b121&&(_0x284dcc['OR']=[{'txid':{'contains':_0x19b121,'mode':_0xbb57(0x1bd)}},{'notes':{'contains':_0x19b121,'mode':_0xbb57(0x1bd)}},{'shop':{'name':{'contains':_0x19b121,'mode':_0xbb57(0x1bd)}}},{'shop':{'username':{'contains':_0x19b121,'mode':'insensitive'}}}]);const [_0x4d79bd,_0x53582b]=await Promise['all']([database_1[_0xbb57(0x1fb)]['payout'][_0xbb57(0x234)]({'where':_0x284dcc,'skip':_0x40bf39,'take':_0x2a5819,'orderBy':{'createdAt':_0xbb57(0x1f8)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0xbb57(0x22d)][_0xbb57(0x1a4)]({'where':_0x284dcc})]);console[_0xbb57(0x233)](_0xbb57(0x24c)+_0x4d79bd['length']+_0xbb57(0x1ab)+_0x53582b+_0xbb57(0x19e));const _0x24075=_0x4d79bd[_0xbb57(0x1a6)](_0x3ee173=>({'id':_0x3ee173['id'],'shopId':_0x3ee173[_0xbb57(0x210)],'shopName':_0x3ee173['shop'][_0xbb57(0x1dd)],'shopUsername':_0x3ee173[_0xbb57(0x198)][_0xbb57(0x1f3)],'amount':_0x3ee173['amount'],'network':_0x3ee173[_0xbb57(0x180)],'status':_0x3ee173[_0xbb57(0x1e9)],'txid':_0x3ee173[_0xbb57(0x1e3)],'notes':_0x3ee173[_0xbb57(0x1eb)],'createdAt':_0x3ee173['createdAt'],'paidAt':_0x3ee173[_0xbb57(0x1c9)]}));return{'payouts':_0x24075,'pagination':{'page':_0x4f5377,'limit':_0x2a5819,'total':_0x53582b,'totalPages':Math[_0xbb57(0x231)](_0x53582b/_0x2a5819)}};}async[a33_0x13a4cd(0x1b8)](_0x25c987){const _0x4b5d03=a33_0x13a4cd;console[_0x4b5d03(0x233)](_0x4b5d03(0x242)+_0x25c987);const _0x536874=await database_1['default']['payout']['findUnique']({'where':{'id':_0x25c987},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x536874)return console[_0x4b5d03(0x233)](_0x4b5d03(0x1d6)+_0x25c987),null;return console['log'](_0x4b5d03(0x18d)+_0x536874[_0x4b5d03(0x1d5)]+_0x4b5d03(0x19d)+_0x536874['network']),{'id':_0x536874['id'],'shopId':_0x536874['shopId'],'shopName':_0x536874[_0x4b5d03(0x198)][_0x4b5d03(0x1dd)],'shopUsername':_0x536874['shop'][_0x4b5d03(0x1f3)],'amount':_0x536874[_0x4b5d03(0x1d5)],'network':_0x536874['network'],'status':_0x536874[_0x4b5d03(0x1e9)],'txid':_0x536874[_0x4b5d03(0x1e3)],'notes':_0x536874['notes'],'createdAt':_0x536874['createdAt'],'paidAt':_0x536874[_0x4b5d03(0x1c9)]};}async['deletePayout'](_0xb7903){const _0x49e5ce=a33_0x13a4cd;console['log'](_0x49e5ce(0x1cb)+_0xb7903);const _0x30180a=await database_1[_0x49e5ce(0x1fb)]['payout'][_0x49e5ce(0x1b7)]({'where':{'id':_0xb7903},'select':{'id':!![],'shopId':!![],'amount':!![]}});if(!_0x30180a)throw new Error(_0x49e5ce(0x1e1));await database_1[_0x49e5ce(0x1fb)][_0x49e5ce(0x22d)][_0x49e5ce(0x21e)]({'where':{'id':_0xb7903}}),console[_0x49e5ce(0x233)]('✅\x20Payout\x20'+_0xb7903+'\x20deleted\x20successfully');}async[a33_0x13a4cd(0x1f0)](_0x1d83b1){const _0x4469d2=a33_0x13a4cd,{page:_0x4cf6cc,limit:_0x2678f0,minAmount:_0x26e445,search:_0x5b8985}=_0x1d83b1;console['log'](_0x4469d2(0x1e5),_0x1d83b1);const _0x2b2a13=await database_1[_0x4469d2(0x1fb)]['payment']['findMany']({'where':{'status':_0x4469d2(0x20d),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'createdAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'gatewaySettings':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}});console[_0x4469d2(0x233)](_0x4469d2(0x218)+_0x2b2a13[_0x4469d2(0x1af)]+_0x4469d2(0x1a9));const _0x3e6915=new Map();for(const _0x3fb896 of _0x2b2a13){const _0x95b7f4={..._0x3fb896,'status':_0x4469d2(0x20d),'merchantPaid':![],'shop':{'gatewaySettings':_0x3fb896['shop'][_0x4469d2(0x199)]}},_0x1721e8=this['isEligibleForPayout'](_0x95b7f4);if(!_0x1721e8)continue;const _0x3a3faf=await currencyService_1[_0x4469d2(0x19a)][_0x4469d2(0x190)](_0x3fb896[_0x4469d2(0x1d5)],_0x3fb896[_0x4469d2(0x22a)]),_0x39e52e=this[_0x4469d2(0x1ee)](_0x3fb896[_0x4469d2(0x198)],_0x3fb896[_0x4469d2(0x185)]),_0x441bea=this[_0x4469d2(0x24d)](_0x3a3faf,_0x39e52e[_0x4469d2(0x181)]),_0x25c0f3=_0x3fb896['shopId'];!_0x3e6915[_0x4469d2(0x17d)](_0x25c0f3)&&_0x3e6915[_0x4469d2(0x1b3)](_0x25c0f3,{'shop':_0x3fb896['shop'],'payments':[]}),_0x3e6915[_0x4469d2(0x246)](_0x25c0f3)[_0x4469d2(0x1b4)][_0x4469d2(0x1a1)]({'id':_0x3fb896['id'],'amount':_0x3fb896[_0x4469d2(0x1d5)],'currency':_0x3fb896[_0x4469d2(0x22a)],'gateway':_0x3fb896[_0x4469d2(0x185)],'paidAt':_0x3fb896[_0x4469d2(0x1c9)],'createdAt':_0x3fb896[_0x4469d2(0x1bb)],'amountUSDT':_0x3a3faf,'commission':_0x39e52e[_0x4469d2(0x181)],'amountAfterCommissionUSDT':_0x441bea,'isEligible':!![]});}console['log'](_0x4469d2(0x1ef)+_0x3e6915[_0x4469d2(0x250)]+_0x4469d2(0x248));const _0x4ca5bd=[];for(const [_0x4c5aee,_0x35429d]of _0x3e6915){const {shop:_0xfc7ac3,payments:_0x106815}=_0x35429d,_0x193773=_0x106815[_0x4469d2(0x1a2)]((_0x41d40b,_0x392fa7)=>_0x41d40b+_0x392fa7[_0x4469d2(0x1d1)],0x0),_0x442b9d=_0x106815[_0x4469d2(0x1a2)]((_0x4a5562,_0x3301ef)=>_0x4a5562+_0x3301ef[_0x4469d2(0x19b)],0x0);if(_0x26e445&&_0x442b9d<_0x26e445)continue;if(_0x5b8985){const _0x128ad5=_0x5b8985[_0x4469d2(0x20e)](),_0x415c63=_0xfc7ac3[_0x4469d2(0x1dd)][_0x4469d2(0x20e)]()[_0x4469d2(0x212)](_0x128ad5)||_0xfc7ac3['username']['toLowerCase']()[_0x4469d2(0x212)](_0x128ad5)||_0xfc7ac3[_0x4469d2(0x200)]&&_0xfc7ac3[_0x4469d2(0x200)][_0x4469d2(0x20e)]()[_0x4469d2(0x212)](_0x128ad5);if(!_0x415c63)continue;}const _0x226ee2=new Map();for(const _0x1d5234 of _0x106815){const _0x271e5b=_0x1d5234[_0x4469d2(0x185)];!_0x226ee2['has'](_0x271e5b)&&_0x226ee2['set'](_0x271e5b,{'count':0x0,'amountUSDT':0x0,'amountAfterCommissionUSDT':0x0,'commission':_0x1d5234[_0x4469d2(0x181)]});const _0x19ca62=_0x226ee2[_0x4469d2(0x246)](_0x271e5b);_0x19ca62['count']++,_0x19ca62['amountUSDT']+=_0x1d5234[_0x4469d2(0x1d1)],_0x19ca62[_0x4469d2(0x19b)]+=_0x1d5234[_0x4469d2(0x19b)];}const _0xa2621b=Array[_0x4469d2(0x22e)](_0x226ee2[_0x4469d2(0x1aa)]())[_0x4469d2(0x1a6)](([_0x25ddb4,_0xa4a578])=>({'gateway':_0x25ddb4['charAt'](0x0)[_0x4469d2(0x240)]()+_0x25ddb4[_0x4469d2(0x232)](0x1),'count':_0xa4a578[_0x4469d2(0x1a4)],'amountUSDT':Math[_0x4469d2(0x1d3)](_0xa4a578[_0x4469d2(0x1d1)]*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x4469d2(0x1d3)](_0xa4a578[_0x4469d2(0x19b)]*0x64)/0x64,'commission':_0xa4a578['commission']})),_0x316441=_0x106815[_0x4469d2(0x1a2)]((_0x3262d7,_0x527551)=>{const _0x66b89d=_0x4469d2;return _0x527551[_0x66b89d(0x1c9)]<_0x3262d7?_0x527551[_0x66b89d(0x1c9)]:_0x3262d7;},_0x106815[0x0][_0x4469d2(0x1c9)]);_0x4ca5bd[_0x4469d2(0x1a1)]({'id':_0xfc7ac3['id'],'fullName':_0xfc7ac3[_0x4469d2(0x1dd)],'username':_0xfc7ac3[_0x4469d2(0x1f3)],'telegramId':_0xfc7ac3['telegram'],'merchantUrl':_0xfc7ac3['shopUrl'],'wallets':{'usdtPolygonWallet':_0xfc7ac3[_0x4469d2(0x195)],'usdtTrcWallet':_0xfc7ac3[_0x4469d2(0x1cd)],'usdtErcWallet':_0xfc7ac3['usdtErcWallet'],'usdcPolygonWallet':_0xfc7ac3['usdcPolygonWallet']},'totalAmountUSDT':Math[_0x4469d2(0x1d3)](_0x193773*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x4469d2(0x1d3)](_0x442b9d*0x64)/0x64,'paymentsCount':_0x106815[_0x4469d2(0x1af)],'oldestPaymentDate':_0x316441,'gatewayBreakdown':_0xa2621b});}_0x4ca5bd[_0x4469d2(0x238)]((_0x5b4095,_0x30bb7b)=>_0x30bb7b[_0x4469d2(0x1ac)]-_0x5b4095['totalAmountAfterCommissionUSDT']);const _0x158517=_0x4ca5bd[_0x4469d2(0x1af)],_0x5c85ee=_0x4ca5bd['reduce']((_0x473211,_0x48a565)=>_0x473211+_0x48a565[_0x4469d2(0x1d4)],0x0),_0x7e6299=_0x4ca5bd[_0x4469d2(0x1a2)]((_0x31a1f7,_0x56691e)=>_0x31a1f7+_0x56691e[_0x4469d2(0x1ac)],0x0),_0x85f62a=(_0x4cf6cc-0x1)*_0x2678f0,_0x1a76f7=_0x4ca5bd[_0x4469d2(0x232)](_0x85f62a,_0x85f62a+_0x2678f0);return console[_0x4469d2(0x233)]('✅\x20Returning\x20'+_0x1a76f7[_0x4469d2(0x1af)]+'\x20merchants\x20out\x20of\x20'+_0x158517+_0x4469d2(0x19e)),console[_0x4469d2(0x233)](_0x4469d2(0x20f)+_0x5c85ee[_0x4469d2(0x1f4)](0x2)+_0x4469d2(0x214)+_0x7e6299[_0x4469d2(0x1f4)](0x2)+_0x4469d2(0x1d7)),{'merchants':_0x1a76f7,'pagination':{'page':_0x4cf6cc,'limit':_0x2678f0,'total':_0x158517,'totalPages':Math[_0x4469d2(0x231)](_0x158517/_0x2678f0)},'summary':{'totalMerchants':_0x158517,'totalAmountUSDT':Math['round'](_0x5c85ee*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x4469d2(0x1d3)](_0x7e6299*0x64)/0x64}};}async['getPayoutStats'](){const _0x54b83b=a33_0x13a4cd;console['log'](_0x54b83b(0x1db));const _0x399bd=await database_1[_0x54b83b(0x1fb)]['payment'][_0x54b83b(0x234)]({'where':{'status':{'in':[_0x54b83b(0x20d),_0x54b83b(0x226),_0x54b83b(0x1c6)]}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'status':!![],'gateway':!![],'paidAt':!![],'merchantPaid':!![],'createdAt':!![],'chargebackAmount':!![],'shop':{'select':{'gatewaySettings':!![]}}}});console['log'](_0x54b83b(0x218)+_0x399bd['length']+'\x20payments\x20for\x20analysis\x20(PAID/REFUND/CHARGEBACK)');const _0x4cc34b=new Date(),_0x56ce75=new Date(_0x4cc34b[_0x54b83b(0x1f1)](),_0x4cc34b[_0x54b83b(0x21d)](),0x1),_0x1e680c=new Date(_0x4cc34b['getFullYear'](),_0x4cc34b['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7);let _0x2f52f4=0x0,_0x28dcd5=0x0,_0x9b447d=0x0,_0x51a466=0x0;for(const _0x2a8967 of _0x399bd){const _0x3e2c53=this[_0x54b83b(0x1cf)](_0x2a8967);if(_0x3e2c53===0x0)continue;let _0x4f77c7,_0x425c29;if(_0x2a8967[_0x54b83b(0x1e9)]===_0x54b83b(0x1c6))_0x4f77c7=Math[_0x54b83b(0x1e7)](_0x3e2c53),_0x425c29=-_0x4f77c7;else{_0x4f77c7=await currencyService_1[_0x54b83b(0x19a)][_0x54b83b(0x190)](_0x2a8967[_0x54b83b(0x1d5)],_0x2a8967[_0x54b83b(0x22a)]);const _0x431cc7=this[_0x54b83b(0x1ee)](_0x2a8967[_0x54b83b(0x198)],_0x2a8967[_0x54b83b(0x185)]);_0x425c29=this[_0x54b83b(0x24d)](_0x4f77c7,_0x431cc7[_0x54b83b(0x181)]);}_0x2a8967['merchantPaid']&&(_0x2f52f4+=_0x425c29,_0x2a8967[_0x54b83b(0x1c9)]&&_0x2a8967[_0x54b83b(0x1c9)]>=_0x56ce75&&_0x2a8967[_0x54b83b(0x1c9)]<=_0x1e680c&&(_0x9b447d+=_0x425c29)),_0x2a8967['status']===_0x54b83b(0x20d)&&this[_0x54b83b(0x215)](_0x2a8967)&&(_0x28dcd5+=_0x425c29,_0x51a466+=_0x4f77c7);}const _0x374593={'totalPayout':Math[_0x54b83b(0x1d3)](_0x2f52f4*0x64)/0x64,'awaitingPayout':Math['round'](_0x28dcd5*0x64)/0x64,'thisMonth':Math[_0x54b83b(0x1d3)](_0x9b447d*0x64)/0x64,'availableBalance':Math[_0x54b83b(0x1d3)](_0x51a466*0x64)/0x64};return console[_0x54b83b(0x233)](_0x54b83b(0x191)),console[_0x54b83b(0x233)]('💸\x20Total\x20Payout:\x20'+_0x374593[_0x54b83b(0x194)]+_0x54b83b(0x18f)),console[_0x54b83b(0x233)](_0x54b83b(0x20a)+_0x374593['awaitingPayout']+'\x20USDT\x20(только\x20PAID\x20платежи)'),console[_0x54b83b(0x233)](_0x54b83b(0x1cc)+_0x374593['thisMonth']+'\x20USDT'),console[_0x54b83b(0x233)](_0x54b83b(0x22b)+_0x374593[_0x54b83b(0x1d8)]+_0x54b83b(0x1c3)),_0x374593;}async[a33_0x13a4cd(0x1c5)](_0x208a68){const _0x178038=a33_0x13a4cd,_0x847e0d=this[_0x178038(0x237)](_0x208a68),_0x1ee3d5=new Date();_0x1ee3d5[_0x178038(0x243)](_0x1ee3d5[_0x178038(0x24a)]()-_0x847e0d),console[_0x178038(0x233)](_0x178038(0x22f)+_0x208a68+'\x20('+_0x847e0d+_0x178038(0x1a0));const _0x1808d1=await database_1[_0x178038(0x1fb)][_0x178038(0x198)][_0x178038(0x1a4)]({'where':{'status':_0x178038(0x1c7)}}),_0x1f79da=await database_1[_0x178038(0x1fb)][_0x178038(0x19c)][_0x178038(0x1a4)](),_0x586856=await database_1[_0x178038(0x1fb)][_0x178038(0x19c)][_0x178038(0x234)]({'where':{'status':{'in':['PAID',_0x178038(0x226),_0x178038(0x1c6)]}},'select':{'amount':!![],'currency':!![],'status':!![],'chargebackAmount':!![],'createdAt':!![]}});console[_0x178038(0x233)](_0x178038(0x218)+_0x586856['length']+'\x20payments\x20for\x20revenue\x20calculation\x20(PAID/REFUND/CHARGEBACK)');const _0x3fd6e8=await Promise[_0x178038(0x201)](_0x586856[_0x178038(0x1a6)](async _0x348e91=>{const _0x27dd96=_0x178038,_0x112497=this[_0x27dd96(0x1cf)](_0x348e91);if(_0x112497===0x0)return{'amount':0x0,'createdAt':_0x348e91[_0x27dd96(0x1bb)]};let _0x37c6f9;return _0x348e91['status']===_0x27dd96(0x1c6)?_0x37c6f9=-Math[_0x27dd96(0x1e7)](_0x112497):_0x37c6f9=await currencyService_1[_0x27dd96(0x19a)][_0x27dd96(0x190)](_0x348e91[_0x27dd96(0x1d5)],_0x348e91['currency']),{'amount':_0x37c6f9,'createdAt':_0x348e91[_0x27dd96(0x1bb)]};})),_0x220180=_0x3fd6e8[_0x178038(0x1a2)]((_0x140bac,_0x36a55d)=>_0x140bac+_0x36a55d[_0x178038(0x1d5)],0x0),_0x2d4712=_0x1f79da>0x0?_0x220180/_0x1f79da:0x0;console[_0x178038(0x233)](_0x178038(0x253)+_0x220180[_0x178038(0x1f4)](0x2)+_0x178038(0x18f)),console[_0x178038(0x233)](_0x178038(0x23f)+_0x2d4712[_0x178038(0x1f4)](0x2)+_0x178038(0x1c3));const _0x138b78=await database_1[_0x178038(0x1fb)]['$queryRaw']`
      SELECT 
        DATE(created_at) as date,
        array_agg(
          json_build_object(
            'amount', amount,
            'currency', currency,
            'status', status,
            'chargeback_amount', chargeback_amount
          )
        ) as payments
      FROM payments 
      WHERE created_at >= ${_0x1ee3d5}
        AND status IN ('PAID', 'REFUND', 'CHARGEBACK')
      GROUP BY DATE(created_at)
      ORDER BY date ASC
    `;console[_0x178038(0x233)]('📅\x20Processing\x20daily\x20stats\x20for\x20'+_0x138b78['length']+_0x178038(0x1ba));const _0x8e2cd7=await Promise['all'](_0x138b78[_0x178038(0x1a6)](async _0x4c7a80=>{const _0x583cee=_0x178038,_0x598785=await Promise[_0x583cee(0x201)](_0x4c7a80[_0x583cee(0x1b4)][_0x583cee(0x1a6)](async _0x292fc9=>{const _0xbae66c=_0x583cee,_0xafd08d=this[_0xbae66c(0x1cf)](_0x292fc9);if(_0xafd08d===0x0)return 0x0;return _0x292fc9[_0xbae66c(0x1e9)]==='CHARGEBACK'?-Math[_0xbae66c(0x1e7)](_0xafd08d):await currencyService_1[_0xbae66c(0x19a)][_0xbae66c(0x190)](_0x292fc9[_0xbae66c(0x1d5)],_0x292fc9[_0xbae66c(0x22a)]);})),_0x5b3021=_0x598785[_0x583cee(0x1a2)]((_0x1088e3,_0x51529b)=>_0x1088e3+_0x51529b,0x0);return{'date':_0x4c7a80[_0x583cee(0x23e)]['toISOString']()[_0x583cee(0x1a8)]('T')[0x0],'amount':_0x5b3021};})),_0xdb12d2=this[_0x178038(0x1a5)](_0x1ee3d5,new Date()),_0x1274a6=new Map(_0x8e2cd7[_0x178038(0x1a6)](_0x1b2934=>[_0x1b2934[_0x178038(0x23e)],_0x1b2934[_0x178038(0x1d5)]])),_0x2550f6=_0xdb12d2[_0x178038(0x1a6)](_0x425fcb=>({'date':_0x425fcb,'amount':_0x1274a6['get'](_0x425fcb)||0x0}));return console['log'](_0x178038(0x205)),console['log'](_0x178038(0x1b6)+_0x1808d1),console[_0x178038(0x233)](_0x178038(0x18a)+_0x1f79da),console[_0x178038(0x233)](_0x178038(0x235)+_0x2550f6['length']),{'totalRevenue':Math[_0x178038(0x1d3)](_0x220180*0x64)/0x64,'totalUsers':_0x1808d1,'totalPayments':_0x1f79da,'averagePayment':Math[_0x178038(0x1d3)](_0x2d4712*0x64)/0x64,'dailyRevenue':_0x2550f6};}async[a33_0x13a4cd(0x206)](_0x634fc0){const _0x4e035e=a33_0x13a4cd,{page:_0x3438ca,limit:_0x53feb1,status:_0x227318,gateway:_0x7f1194,shopId:_0xb018a,dateFrom:_0x4a5d7d,dateTo:_0x3f19a6,search:_0xdaa131}=_0x634fc0,_0x596263=(_0x3438ca-0x1)*_0x53feb1;console[_0x4e035e(0x233)]('📋\x20Getting\x20payments\x20with\x20filters:',_0x634fc0);const _0x4f61e3={};_0x227318&&(_0x4f61e3[_0x4e035e(0x1e9)]=_0x227318['toUpperCase']());if(_0x7f1194){if((0x0,gateway_1[_0x4e035e(0x1b0)])(_0x7f1194)){const _0x1c53b8=(0x0,gateway_1[_0x4e035e(0x23c)])(_0x7f1194);_0x1c53b8&&(_0x4f61e3[_0x4e035e(0x185)]=_0x1c53b8);}else _0x4f61e3['gateway']=_0x7f1194[_0x4e035e(0x20e)]();}_0xb018a&&(_0x4f61e3[_0x4e035e(0x210)]=_0xb018a);(_0x4a5d7d||_0x3f19a6)&&(_0x4f61e3[_0x4e035e(0x1bb)]={},_0x4a5d7d&&(_0x4f61e3['createdAt'][_0x4e035e(0x223)]=new Date(_0x4a5d7d)),_0x3f19a6&&(_0x4f61e3[_0x4e035e(0x1bb)]['lte']=new Date(_0x3f19a6)));_0xdaa131&&(_0x4f61e3['OR']=[{'orderId':{'contains':_0xdaa131,'mode':_0x4e035e(0x1bd)}},{'gatewayOrderId':{'contains':_0xdaa131,'mode':_0x4e035e(0x1bd)}},{'gatewayPaymentId':{'contains':_0xdaa131,'mode':_0x4e035e(0x1bd)}},{'customerEmail':{'contains':_0xdaa131,'mode':'insensitive'}},{'customerName':{'contains':_0xdaa131,'mode':'insensitive'}},{'shop':{'name':{'contains':_0xdaa131,'mode':_0x4e035e(0x1bd)}}},{'shop':{'username':{'contains':_0xdaa131,'mode':_0x4e035e(0x1bd)}}}]);const [_0x33de0e,_0x23e5e3]=await Promise[_0x4e035e(0x201)]([database_1['default'][_0x4e035e(0x19c)][_0x4e035e(0x234)]({'where':_0x4f61e3,'skip':_0x596263,'take':_0x53feb1,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x4e035e(0x1fb)]['payment'][_0x4e035e(0x1a4)]({'where':_0x4f61e3})]);console['log']('📊\x20Found\x20'+_0x33de0e[_0x4e035e(0x1af)]+'\x20payments\x20out\x20of\x20'+_0x23e5e3+_0x4e035e(0x19e));const _0x5a48b6=_0x33de0e[_0x4e035e(0x1a6)](_0x1eb950=>({'id':_0x1eb950['id'],'shopId':_0x1eb950[_0x4e035e(0x210)],'shopName':_0x1eb950['shop'][_0x4e035e(0x1dd)],'shopUsername':_0x1eb950[_0x4e035e(0x198)][_0x4e035e(0x1f3)],'gateway':_0x1eb950[_0x4e035e(0x185)],'orderId':_0x1eb950[_0x4e035e(0x217)],'gatewayOrderId':_0x1eb950[_0x4e035e(0x207)],'amount':_0x1eb950[_0x4e035e(0x1d5)],'currency':_0x1eb950[_0x4e035e(0x22a)],'sourceCurrency':_0x1eb950[_0x4e035e(0x221)],'status':_0x1eb950['status'],'usage':_0x1eb950[_0x4e035e(0x1e0)],'externalPaymentUrl':_0x1eb950[_0x4e035e(0x224)],'gatewayPaymentId':_0x1eb950[_0x4e035e(0x1f6)],'customerEmail':_0x1eb950[_0x4e035e(0x1a7)],'customerName':_0x1eb950[_0x4e035e(0x21c)],'cardLast4':_0x1eb950[_0x4e035e(0x1b5)],'paymentMethod':_0x1eb950[_0x4e035e(0x213)],'bankId':_0x1eb950[_0x4e035e(0x20b)],'remitterIban':_0x1eb950[_0x4e035e(0x1f5)],'remitterName':_0x1eb950[_0x4e035e(0x1bc)],'chargebackAmount':_0x1eb950[_0x4e035e(0x189)],'adminNotes':_0x1eb950[_0x4e035e(0x1dc)],'statusChangedBy':_0x1eb950[_0x4e035e(0x23d)],'statusChangedAt':_0x1eb950[_0x4e035e(0x1c1)],'createdAt':_0x1eb950[_0x4e035e(0x1bb)],'updatedAt':_0x1eb950[_0x4e035e(0x192)],'expiresAt':_0x1eb950[_0x4e035e(0x1c0)]}));return{'payments':_0x5a48b6,'pagination':{'page':_0x3438ca,'limit':_0x53feb1,'total':_0x23e5e3,'totalPages':Math['ceil'](_0x23e5e3/_0x53feb1)}};}async[a33_0x13a4cd(0x229)](_0x41c502){const _0x5f88b7=a33_0x13a4cd;console[_0x5f88b7(0x233)]('🔍\x20Getting\x20payment\x20by\x20ID:\x20'+_0x41c502);const _0xd18fcd=await database_1['default'][_0x5f88b7(0x19c)][_0x5f88b7(0x1b7)]({'where':{'id':_0x41c502},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}},'webhookLogs':{'orderBy':{'createdAt':_0x5f88b7(0x1f8)},'take':0xa,'select':{'id':!![],'event':!![],'statusCode':!![],'retryCount':!![],'createdAt':!![]}}}});if(!_0xd18fcd)return console[_0x5f88b7(0x233)]('❌\x20Payment\x20not\x20found:\x20'+_0x41c502),null;return console[_0x5f88b7(0x233)](_0x5f88b7(0x222)+_0xd18fcd[_0x5f88b7(0x217)]+'\x20('+_0xd18fcd[_0x5f88b7(0x1e9)]+')'),{'id':_0xd18fcd['id'],'shopId':_0xd18fcd[_0x5f88b7(0x210)],'shopName':_0xd18fcd[_0x5f88b7(0x198)][_0x5f88b7(0x1dd)],'shopUsername':_0xd18fcd[_0x5f88b7(0x198)]['username'],'gateway':_0xd18fcd[_0x5f88b7(0x185)],'orderId':_0xd18fcd[_0x5f88b7(0x217)],'gatewayOrderId':_0xd18fcd[_0x5f88b7(0x207)],'amount':_0xd18fcd[_0x5f88b7(0x1d5)],'currency':_0xd18fcd[_0x5f88b7(0x22a)],'sourceCurrency':_0xd18fcd[_0x5f88b7(0x221)],'status':_0xd18fcd[_0x5f88b7(0x1e9)],'usage':_0xd18fcd[_0x5f88b7(0x1e0)],'externalPaymentUrl':_0xd18fcd[_0x5f88b7(0x224)],'gatewayPaymentId':_0xd18fcd[_0x5f88b7(0x1f6)],'customerEmail':_0xd18fcd[_0x5f88b7(0x1a7)],'customerName':_0xd18fcd[_0x5f88b7(0x21c)],'cardLast4':_0xd18fcd[_0x5f88b7(0x1b5)],'paymentMethod':_0xd18fcd[_0x5f88b7(0x213)],'bankId':_0xd18fcd[_0x5f88b7(0x20b)],'remitterIban':_0xd18fcd[_0x5f88b7(0x1f5)],'remitterName':_0xd18fcd[_0x5f88b7(0x1bc)],'chargebackAmount':_0xd18fcd[_0x5f88b7(0x189)],'adminNotes':_0xd18fcd[_0x5f88b7(0x1dc)],'statusChangedBy':_0xd18fcd[_0x5f88b7(0x23d)],'statusChangedAt':_0xd18fcd[_0x5f88b7(0x1c1)],'createdAt':_0xd18fcd[_0x5f88b7(0x1bb)],'updatedAt':_0xd18fcd['updatedAt'],'expiresAt':_0xd18fcd[_0x5f88b7(0x1c0)],'webhookLogs':_0xd18fcd['webhookLogs']};}async[a33_0x13a4cd(0x252)](_0x3d2b07,_0x112da6,_0x15a570,_0x53800f){const _0x50c9a9=a33_0x13a4cd;console[_0x50c9a9(0x233)](_0x50c9a9(0x1df)+_0x3d2b07+_0x50c9a9(0x1c4)+_0x112da6);const _0x5e84ef=[_0x50c9a9(0x202),'PAID','EXPIRED','FAILED',_0x50c9a9(0x226),'CHARGEBACK'];if(!_0x5e84ef[_0x50c9a9(0x212)](_0x112da6[_0x50c9a9(0x240)]()))throw new Error(_0x50c9a9(0x24b)+_0x5e84ef['join'](',\x20'));const _0x41eab4=await database_1[_0x50c9a9(0x1fb)][_0x50c9a9(0x19c)]['findUnique']({'where':{'id':_0x3d2b07},'select':{'id':!![],'status':!![],'orderId':!![]}});if(!_0x41eab4)throw new Error(_0x50c9a9(0x1de));if(_0x112da6['toUpperCase']()===_0x50c9a9(0x1c6)){if(!_0x53800f||_0x53800f<=0x0)throw new Error(_0x50c9a9(0x197));console['log'](_0x50c9a9(0x18e)+_0x53800f+'\x20USDT\x20(penalty\x20amount)');}const _0x4cf78b={'status':_0x112da6[_0x50c9a9(0x240)](),'updatedAt':new Date(),'statusChangedBy':'admin','statusChangedAt':new Date()};_0x15a570&&(_0x4cf78b[_0x50c9a9(0x1dc)]=_0x15a570);_0x112da6[_0x50c9a9(0x240)]()===_0x50c9a9(0x1c6)&&_0x53800f&&(_0x4cf78b[_0x50c9a9(0x189)]=_0x53800f);const _0x47d5e5=await database_1[_0x50c9a9(0x1fb)][_0x50c9a9(0x19c)][_0x50c9a9(0x1b9)]({'where':{'id':_0x3d2b07},'data':_0x4cf78b,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});return await database_1[_0x50c9a9(0x1fb)][_0x50c9a9(0x1e4)]['create']({'data':{'paymentId':_0x3d2b07,'shopId':_0x47d5e5[_0x50c9a9(0x210)],'event':_0x50c9a9(0x1f9),'statusCode':0xc8,'responseBody':JSON[_0x50c9a9(0x1d2)]({'oldStatus':_0x41eab4['status'],'newStatus':_0x112da6[_0x50c9a9(0x240)](),'notes':_0x15a570||null,'chargebackAmount':_0x53800f||null,'updatedBy':_0x50c9a9(0x245),'timestamp':new Date()[_0x50c9a9(0x1bf)]()})}}),console[_0x50c9a9(0x233)](_0x50c9a9(0x219)+_0x41eab4['orderId']+'\x20status\x20updated\x20from\x20'+_0x41eab4[_0x50c9a9(0x1e9)]+_0x50c9a9(0x203)+_0x112da6[_0x50c9a9(0x240)]()),_0x112da6['toUpperCase']()==='CHARGEBACK'&&console[_0x50c9a9(0x233)](_0x50c9a9(0x1ca)+_0x53800f+_0x50c9a9(0x220)),{'id':_0x47d5e5['id'],'shopId':_0x47d5e5[_0x50c9a9(0x210)],'shopName':_0x47d5e5[_0x50c9a9(0x198)][_0x50c9a9(0x1dd)],'shopUsername':_0x47d5e5[_0x50c9a9(0x198)][_0x50c9a9(0x1f3)],'gateway':_0x47d5e5[_0x50c9a9(0x185)],'orderId':_0x47d5e5['orderId'],'gatewayOrderId':_0x47d5e5['gatewayOrderId'],'amount':_0x47d5e5[_0x50c9a9(0x1d5)],'currency':_0x47d5e5[_0x50c9a9(0x22a)],'sourceCurrency':_0x47d5e5[_0x50c9a9(0x221)],'status':_0x47d5e5[_0x50c9a9(0x1e9)],'usage':_0x47d5e5[_0x50c9a9(0x1e0)],'externalPaymentUrl':_0x47d5e5[_0x50c9a9(0x224)],'gatewayPaymentId':_0x47d5e5['gatewayPaymentId'],'customerEmail':_0x47d5e5['customerEmail'],'customerName':_0x47d5e5['customerName'],'cardLast4':_0x47d5e5['cardLast4'],'paymentMethod':_0x47d5e5['paymentMethod'],'bankId':_0x47d5e5[_0x50c9a9(0x20b)],'remitterIban':_0x47d5e5[_0x50c9a9(0x1f5)],'remitterName':_0x47d5e5[_0x50c9a9(0x1bc)],'chargebackAmount':_0x47d5e5['chargebackAmount'],'adminNotes':_0x47d5e5['adminNotes'],'statusChangedBy':_0x47d5e5[_0x50c9a9(0x23d)],'statusChangedAt':_0x47d5e5[_0x50c9a9(0x1c1)],'createdAt':_0x47d5e5[_0x50c9a9(0x1bb)],'updatedAt':_0x47d5e5['updatedAt'],'expiresAt':_0x47d5e5[_0x50c9a9(0x1c0)]};}async[a33_0x13a4cd(0x1da)](_0x3d3866){const _0x250717=a33_0x13a4cd,{page:_0x2df1ac,limit:_0x28366f,status:_0x13e520}=_0x3d3866,_0x1ab798=(_0x2df1ac-0x1)*_0x28366f,_0x4c76c2={};_0x13e520&&(_0x4c76c2[_0x250717(0x1e9)]=_0x13e520[_0x250717(0x240)]());console['log'](_0x250717(0x20c),{'page':_0x2df1ac,'limit':_0x28366f,'status':_0x13e520,'where':_0x4c76c2});const [_0x353985,_0xde5e6b]=await Promise[_0x250717(0x201)]([database_1[_0x250717(0x1fb)][_0x250717(0x198)][_0x250717(0x234)]({'where':_0x4c76c2,'skip':_0x1ab798,'take':_0x28366f,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x250717(0x1f8)}}),database_1[_0x250717(0x1fb)]['shop']['count']({'where':_0x4c76c2})]);console[_0x250717(0x233)](_0x250717(0x24c)+_0x353985[_0x250717(0x1af)]+'\x20users\x20out\x20of\x20'+_0xde5e6b+'\x20total');const _0x4be390=_0x353985[_0x250717(0x1a6)](_0x4a3cda=>({'id':_0x4a3cda['id'],'fullName':_0x4a3cda[_0x250717(0x1dd)],'username':_0x4a3cda[_0x250717(0x1f3)],'telegramId':_0x4a3cda[_0x250717(0x200)],'merchantUrl':_0x4a3cda[_0x250717(0x1f7)],'gateways':_0x4a3cda['paymentGateways']?JSON['parse'](_0x4a3cda[_0x250717(0x1ea)]):null,'gatewaySettings':_0x4a3cda['gatewaySettings']?JSON[_0x250717(0x1fc)](_0x4a3cda['gatewaySettings']):null,'publicKey':_0x4a3cda[_0x250717(0x216)],'wallets':{'usdtPolygonWallet':_0x4a3cda[_0x250717(0x195)],'usdtTrcWallet':_0x4a3cda[_0x250717(0x1cd)],'usdtErcWallet':_0x4a3cda[_0x250717(0x186)],'usdcPolygonWallet':_0x4a3cda['usdcPolygonWallet']},'status':_0x4a3cda[_0x250717(0x1e9)],'createdAt':_0x4a3cda[_0x250717(0x1bb)]}));return{'users':_0x4be390,'pagination':{'page':_0x2df1ac,'limit':_0x28366f,'total':_0xde5e6b,'totalPages':Math[_0x250717(0x231)](_0xde5e6b/_0x28366f)}};}async['getUserById'](_0x4e77a0){const _0xacd559=a33_0x13a4cd;return await this['userService'][_0xacd559(0x1b1)](_0x4e77a0);}async['createUser'](_0x1bc782){const _0x3e3c65=a33_0x13a4cd;return await this['userService'][_0x3e3c65(0x204)](_0x1bc782);}async[a33_0x13a4cd(0x225)](_0x233861,_0x2aba36){const _0xcca338=a33_0x13a4cd;return await this[_0xcca338(0x1a3)]['updateUser'](_0x233861,_0x2aba36);}async[a33_0x13a4cd(0x17f)](_0x4f9c8c){const _0x8e4152=a33_0x13a4cd;return await this['userService'][_0x8e4152(0x17f)](_0x4f9c8c);}async[a33_0x13a4cd(0x1ff)](_0x3de651){const _0x614852=a33_0x13a4cd;console['log']('🚫\x20Suspending\x20user:\x20'+_0x3de651);const _0x2d469f=await database_1[_0x614852(0x1fb)][_0x614852(0x198)][_0x614852(0x1b7)]({'where':{'id':_0x3de651},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x2d469f)throw new Error(_0x614852(0x239));if(_0x2d469f[_0x614852(0x1e9)]===_0x614852(0x1e8))throw new Error(_0x614852(0x21f));const _0x4762eb=await this['userService'][_0x614852(0x225)](_0x3de651,{'status':'SUSPENDED'});return console[_0x614852(0x233)]('✅\x20User\x20'+_0x2d469f['username']+_0x614852(0x19f)),_0x4762eb;}async[a33_0x13a4cd(0x1be)](_0x4ca305){const _0x7768cb=a33_0x13a4cd;console[_0x7768cb(0x233)](_0x7768cb(0x188)+_0x4ca305);const _0x135580=await database_1['default']['shop'][_0x7768cb(0x1b7)]({'where':{'id':_0x4ca305},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x135580)throw new Error(_0x7768cb(0x239));if(_0x135580[_0x7768cb(0x1e9)]===_0x7768cb(0x1c7))throw new Error(_0x7768cb(0x18b));const _0x19f9a3=await this[_0x7768cb(0x1a3)][_0x7768cb(0x225)](_0x4ca305,{'status':_0x7768cb(0x1c7)});return console[_0x7768cb(0x233)](_0x7768cb(0x21b)+_0x135580[_0x7768cb(0x1f3)]+_0x7768cb(0x251)),_0x19f9a3;}}exports['AdminService']=AdminService;