'use strict';const a35_0x59b92e=a35_0x23b6;function a35_0x23b6(_0x1703ca,_0x1e3a73){const _0x53a42f=a35_0x53a4();return a35_0x23b6=function(_0x23b612,_0x1ccf1c){_0x23b612=_0x23b612-0x1c7;let _0x8c8c79=_0x53a42f[_0x23b612];return _0x8c8c79;},a35_0x23b6(_0x1703ca,_0x1e3a73);}(function(_0x31b0f7,_0x17eaaf){const _0x41079e=a35_0x23b6,_0x3d459b=_0x31b0f7();while(!![]){try{const _0x286f26=parseInt(_0x41079e(0x25c))/0x1+-parseInt(_0x41079e(0x270))/0x2*(-parseInt(_0x41079e(0x216))/0x3)+parseInt(_0x41079e(0x241))/0x4+-parseInt(_0x41079e(0x1f6))/0x5*(-parseInt(_0x41079e(0x20b))/0x6)+parseInt(_0x41079e(0x1cc))/0x7*(-parseInt(_0x41079e(0x1ff))/0x8)+-parseInt(_0x41079e(0x1c7))/0x9*(parseInt(_0x41079e(0x260))/0xa)+parseInt(_0x41079e(0x218))/0xb;if(_0x286f26===_0x17eaaf)break;else _0x3d459b['push'](_0x3d459b['shift']());}catch(_0x21fcd1){_0x3d459b['push'](_0x3d459b['shift']());}}}(a35_0x53a4,0x858d4));var __importDefault=this&&this[a35_0x59b92e(0x261)]||function(_0x35912a){const _0x489b58=a35_0x59b92e;return _0x35912a&&_0x35912a[_0x489b58(0x1ce)]?_0x35912a:{'default':_0x35912a};};Object[a35_0x59b92e(0x1fb)](exports,a35_0x59b92e(0x1ce),{'value':!![]}),exports[a35_0x59b92e(0x225)]=void 0x0;function a35_0x53a4(){const _0x48691e=['crypto','__esModule','üìä\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','\x20\x20\x20Payout\x20amount:\x20','amountUSDT','gatewayOrderId','notes','findFirst','stringify','üí∞\x20Shop\x20','\x20paid\x20payments\x20for\x20analysis','publicKey','getGatewayDisplayName','values','\x20balance\x20updated:','customerUa','payment','gatewaySettings','all','\x20\x20\x20üë§\x20Merchant\x20earnings:\x20','\x20became\x20PAID:\x20+','delete','merchantEarnings','admin','date','averageCheckUSDT','paidOutUSDT','\x20merchants\x20with\x20positive\x20balance','create','wallets','getPaymentById','pendingUrl','\x20balance\x20updated:\x20','gateways','updatePaymentStatus','Noda','getFullYear','\x20\x20\x20Total\x20paid\x20out:\x20','payout','./currencyService','getTime','65VztYXv','username','createPayout','üí∞\x20Creating\x20payout\x20for\x20shop\x20','statusChangedBy','defineProperty','\x20no\x20longer\x20PAID:\x20-','adminNotes','suspendUser','326824KryWJm','fullName','commissionUSDT','totalTurnover','ceil','üîÑ\x20Updating\x20customer\x20data\x20for\x20payment\x20','merchantUrl','üí∏\x20CHARGEBACK\x20penalty:\x20-','customerEmail','toISOString','telegram','\x20\x20\x20Current\x20balance:\x20','29634SgWSQG','thisMonth','customerCountry','Plisio','../config/database','gateway','paymentGateways','activateUser','üîÑ\x20Admin\x20updating\x20payment\x20','2020-01-01','commission','282yCsdzV','status','6104153DltUzd','üìä\x20Payout\x20statistics\x20calculated:','üìä\x20Merchant\x20statistics\x20calculated:','failureMessage','round','usdcPolygonWallet','network','Shop\x20not\x20found','gte','failUrl','KLYME\x20EU','PAID','$transaction','AdminService','externalPaymentUrl','\x20\x20\x20üìÖ\x20This\x20month:\x20','\x20\x20\x20üí∞\x20Total\x20turnover:\x20','toString','KLYME\x20GB','üí∞\x20Current\x20shop\x20balance:\x20','90d','period','\x20\x20\x20üåç\x20Country:\x20','Username\x20already\x20exists','\x20USDT\x20(total\x20paid\x20to\x20merchants)','updateUser','shopId','string','desc','totalCommissionRate','\x20status:\x20','shopUrl','set','log','parse','dateFrom','SUSPENDED','hex','üí∞\x20Payment\x20','_sum','\x20USDT\x20to\x20balance','2563144vlivvm','week','ACTIVE','updatedAt','üìä\x20Merchants\x20awaiting\x20payout:\x20','\x20for\x20shop\x20','getMerchantStatistics','getUserById','turnoverUSDT','paymentsCount','map','name','findUnique','pk_','\x20->\x20','getPayoutById','getPayoutStats','getMonth','\x20USDT\x20total','awaitingPayout','\x20USDT\x20(','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','telegramId','convertToUSDT','currency','\x20USDT,\x20Requested:\x20','randomBytes','566965LyrMEU','COMPLETED','groupBy','createUser','9260tMjtVs','__importDefault','insensitive','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','\x20merchants,\x20','\x20USDT','length','\x20\x20\x20Balance:\x20','averageCommissionRate','createdAt','30d','aggregate','hash','periodFrom','_count','\x20\x20\x20üí∞\x20Total\x20payout:\x20','15182duOCLa','gatewayEarnings','üí∞\x20Found\x20','lte','successUrl','password','usdtErcWallet','chargebackAmount','amount','findMany','statusChangedAt','currencyService','Payment\x20not\x20found','default','totalPayout','test_gateway','usdtPolygonWallet','üîÑ\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','‚úÖ\x20Customer\x20data\x20updated\x20for\x20payment\x20','turnover','bcryptjs','\x20USDT)','customerName','month','error','Test\x20Gateway','üìÖ\x20Period:\x20','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','reduce','dateTo','CHARGEBACK','KLYME\x20DE','totalPayments','sk_','üìä\x20Getting\x20merchant\x20statistics\x20with\x20filters:','customerIp','totalPaidOut','localeCompare','custom','usdtTrcWallet','balance','Insufficient\x20balance.\x20Available:\x20','orderId','shop','\x20USDT\x20from\x20balance','getSystemStatistics','whiteUrl','paidAt','\x20USDT\x20(-','count','getMerchantsAwaitingPayout','txid','\x20\x20\x20üè™\x20Gateway\x20earnings:\x20','\x20\x20\x20üåê\x20IP:\x20','REFUND','periodTo','toUpperCase','merchantEarningsUSDT','getAllPayouts','10242lfoCxF','toFixed','update','updateCustomerData','\x20to\x20','161ubLTTx'];a35_0x53a4=function(){return _0x48691e;};return a35_0x53a4();}const database_1=__importDefault(require(a35_0x59b92e(0x20f))),bcryptjs_1=__importDefault(require(a35_0x59b92e(0x284))),crypto_1=__importDefault(require(a35_0x59b92e(0x1cd))),currencyService_1=require(a35_0x59b92e(0x1f4));class AdminService{async[a35_0x59b92e(0x251)](){const _0x1f8946=a35_0x59b92e;console[_0x1f8946(0x239)]('üìä\x20Calculating\x20payout\x20statistics...');const _0x1c3395=await database_1[_0x1f8946(0x27d)][_0x1f8946(0x29b)][_0x1f8946(0x26b)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x1f8946(0x243)}}),_0x1352a=new Date(),_0x45826a=new Date(_0x1352a[_0x1f8946(0x1f1)](),_0x1352a[_0x1f8946(0x252)](),0x1),_0x599b48=new Date(_0x1352a['getFullYear'](),_0x1352a['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x45ff83=await database_1[_0x1f8946(0x27d)][_0x1f8946(0x1f3)]['aggregate']({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x45826a,'lte':_0x599b48},'status':'COMPLETED'}}),_0x4c6397=_0x1c3395[_0x1f8946(0x23f)]['totalPaidOut']||0x0,_0x41914d=_0x1c3395[_0x1f8946(0x23f)][_0x1f8946(0x298)]||0x0,_0x9501e4=_0x45ff83['_sum'][_0x1f8946(0x278)]||0x0,_0x101d8e={'totalPayout':Math['round'](_0x4c6397*0x64)/0x64,'awaitingPayout':Math['round'](_0x41914d*0x64)/0x64,'thisMonth':Math[_0x1f8946(0x21c)](_0x9501e4*0x64)/0x64,'availableBalance':Math['round'](_0x41914d*0x64)/0x64};return console['log'](_0x1f8946(0x219)),console['log'](_0x1f8946(0x26f)+_0x101d8e[_0x1f8946(0x27e)]+_0x1f8946(0x230)),console['log'](_0x1f8946(0x263)+_0x101d8e[_0x1f8946(0x254)]+'\x20USDT\x20(total\x20merchant\x20balances)'),console['log']('\x20\x20\x20üíµ\x20Available\x20balance:\x20'+_0x101d8e['availableBalance']+'\x20USDT\x20(same\x20as\x20awaiting)'),console[_0x1f8946(0x239)](_0x1f8946(0x227)+_0x101d8e[_0x1f8946(0x20c)]+'\x20USDT'),_0x101d8e;}async[a35_0x59b92e(0x1ca)](_0x470f20,_0x12808e){const _0x5638c6=a35_0x59b92e;console[_0x5638c6(0x239)](_0x5638c6(0x204)+_0x470f20+':',_0x12808e);const _0x4a97ba=await database_1[_0x5638c6(0x27d)][_0x5638c6(0x1dd)][_0x5638c6(0x24d)]({'where':{'id':_0x470f20},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x4a97ba)throw new Error(_0x5638c6(0x27c));const _0x464c6f={};_0x12808e[_0x5638c6(0x20d)]!==undefined&&(_0x464c6f[_0x5638c6(0x20d)]=_0x12808e[_0x5638c6(0x20d)]||null);_0x12808e[_0x5638c6(0x293)]!==undefined&&(_0x464c6f[_0x5638c6(0x293)]=_0x12808e['customerIp']||null);_0x12808e[_0x5638c6(0x1dc)]!==undefined&&(_0x464c6f['customerUa']=_0x12808e[_0x5638c6(0x1dc)]||null);const _0x468d73=await database_1[_0x5638c6(0x27d)]['payment'][_0x5638c6(0x1c9)]({'where':{'id':_0x470f20},'data':{..._0x464c6f,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console['log'](_0x5638c6(0x282)+_0x470f20),console['log'](_0x5638c6(0x22e)+_0x4a97ba[_0x5638c6(0x20d)]+_0x5638c6(0x24f)+_0x468d73[_0x5638c6(0x20d)]),console[_0x5638c6(0x239)](_0x5638c6(0x2a5)+_0x4a97ba['customerIp']+_0x5638c6(0x24f)+_0x468d73[_0x5638c6(0x293)]),console[_0x5638c6(0x239)]('\x20\x20\x20üñ•Ô∏è\x20User\x20Agent:\x20'+(_0x4a97ba['customerUa']?_0x5638c6(0x238):'not\x20set')+_0x5638c6(0x24f)+(_0x468d73[_0x5638c6(0x1dc)]?_0x5638c6(0x238):'not\x20set')),_0x468d73;}async[a35_0x59b92e(0x29d)](_0x41caa8){const _0x39dcd2=a35_0x59b92e,_0x3f6a47=new Date();let _0x785a11;switch(_0x41caa8){case'7d':_0x785a11=new Date(_0x3f6a47[_0x39dcd2(0x1f5)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x39dcd2(0x26a):_0x785a11=new Date(_0x3f6a47[_0x39dcd2(0x1f5)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x39dcd2(0x22c):_0x785a11=new Date(_0x3f6a47[_0x39dcd2(0x1f5)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x785a11=new Date(_0x3f6a47[_0x39dcd2(0x1f5)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x30f67b,_0x610653,_0x173e39,_0x5d8a47,_0x25078d,_0x444c14]=await Promise[_0x39dcd2(0x1df)]([database_1[_0x39dcd2(0x27d)]['shop']['count'](),database_1[_0x39dcd2(0x27d)]['shop']['count']({'where':{'status':_0x39dcd2(0x243)}}),database_1[_0x39dcd2(0x27d)][_0x39dcd2(0x1dd)][_0x39dcd2(0x2a1)]({'where':{'createdAt':{'gte':_0x785a11},'gateway':{'not':_0x39dcd2(0x27f)}}}),database_1[_0x39dcd2(0x27d)][_0x39dcd2(0x1dd)][_0x39dcd2(0x2a1)]({'where':{'status':_0x39dcd2(0x223),'createdAt':{'gte':_0x785a11},'gateway':{'not':_0x39dcd2(0x27f)}}}),database_1[_0x39dcd2(0x27d)][_0x39dcd2(0x1dd)]['findMany']({'where':{'status':'PAID','createdAt':{'gte':_0x785a11},'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![]}}),database_1[_0x39dcd2(0x27d)][_0x39dcd2(0x1dd)][_0x39dcd2(0x279)]({'where':{'gateway':{'not':'test_gateway'}},'take':0xa,'orderBy':{'createdAt':_0x39dcd2(0x234)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}})]);let _0x43b1db=0x0;for(const _0x313d8a of _0x25078d){const _0x36da7f=await currencyService_1['currencyService'][_0x39dcd2(0x258)](_0x313d8a[_0x39dcd2(0x278)],_0x313d8a[_0x39dcd2(0x259)]);_0x43b1db+=_0x36da7f;}const _0x1760cc=_0x173e39>0x0?_0x5d8a47/_0x173e39*0x64:0x0;return{'totalShops':_0x30f67b,'activeShops':_0x610653,'totalPayments':_0x173e39,'successfulPayments':_0x5d8a47,'totalRevenue':Math['round'](_0x43b1db*0x64)/0x64,'conversionRate':Math[_0x39dcd2(0x21c)](_0x1760cc*0x64)/0x64,'recentPayments':_0x444c14[_0x39dcd2(0x24b)](_0xfb322=>({'id':_0xfb322['id'],'amount':_0xfb322[_0x39dcd2(0x278)],'currency':_0xfb322[_0x39dcd2(0x259)],'status':_0xfb322['status'],'gateway':_0xfb322[_0x39dcd2(0x210)],'shop':_0xfb322[_0x39dcd2(0x29b)],'createdAt':_0xfb322[_0x39dcd2(0x269)]}))};}async[a35_0x59b92e(0x247)](_0x4628cf){const _0x1ff3e7=a35_0x59b92e;console[_0x1ff3e7(0x239)](_0x1ff3e7(0x292),_0x4628cf);let _0xe640f4,_0x213475=new Date();if(_0x4628cf['period']===_0x1ff3e7(0x296)&&_0x4628cf[_0x1ff3e7(0x23b)]&&_0x4628cf[_0x1ff3e7(0x28d)])_0xe640f4=new Date(_0x4628cf[_0x1ff3e7(0x23b)]),_0x213475=new Date(_0x4628cf[_0x1ff3e7(0x28d)]);else{const _0x479402=new Date();switch(_0x4628cf[_0x1ff3e7(0x22d)]){case _0x1ff3e7(0x242):_0xe640f4=new Date(_0x479402['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x1ff3e7(0x287):_0xe640f4=new Date(_0x479402[_0x1ff3e7(0x1f5)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'year':_0xe640f4=new Date(_0x479402['getTime']()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case'all':default:_0xe640f4=new Date(_0x1ff3e7(0x214));break;}}console[_0x1ff3e7(0x239)](_0x1ff3e7(0x28a)+_0xe640f4[_0x1ff3e7(0x208)]()+_0x1ff3e7(0x1cb)+_0x213475[_0x1ff3e7(0x208)]());const _0x198145={'status':_0x1ff3e7(0x223),'gateway':{'not':_0x1ff3e7(0x27f)},'paidAt':{'gte':_0xe640f4,'lte':_0x213475}};_0x4628cf['shopId']&&(_0x198145[_0x1ff3e7(0x232)]=_0x4628cf[_0x1ff3e7(0x232)]);const _0x15f621=await database_1[_0x1ff3e7(0x27d)]['payment'][_0x1ff3e7(0x279)]({'where':_0x198145,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console['log'](_0x1ff3e7(0x272)+_0x15f621[_0x1ff3e7(0x266)]+_0x1ff3e7(0x1d7));let _0x4126e5=0x0,_0x2fc2b4=0x0,_0x213250=0x0;const _0x44dbc1={},_0x3e7bc1={},_0x19325b={};for(const _0x5942e9 of _0x15f621){try{const _0x1eace7=await currencyService_1[_0x1ff3e7(0x27b)][_0x1ff3e7(0x258)](_0x5942e9[_0x1ff3e7(0x278)],_0x5942e9['currency']);let _0x2c1141={};if(_0x5942e9[_0x1ff3e7(0x29b)]['gatewaySettings'])try{_0x2c1141=JSON[_0x1ff3e7(0x23a)](_0x5942e9[_0x1ff3e7(0x29b)][_0x1ff3e7(0x1de)]);}catch(_0x2ce596){console[_0x1ff3e7(0x288)](_0x1ff3e7(0x28b)+_0x5942e9['shopId']+':',_0x2ce596);}const _0x332d14=_0x2c1141[_0x1ff3e7(0x215)]||0xa,_0xe07dea=_0x1eace7*(_0x332d14/0x64),_0x4d7be7=_0x1eace7-_0xe07dea;_0x4126e5+=_0x1eace7,_0x2fc2b4+=_0x4d7be7,_0x213250+=_0xe07dea;!_0x44dbc1[_0x5942e9[_0x1ff3e7(0x210)]]&&(_0x44dbc1[_0x5942e9[_0x1ff3e7(0x210)]]={'gateway':_0x5942e9[_0x1ff3e7(0x210)],'gatewayDisplayName':this[_0x1ff3e7(0x1d9)](_0x5942e9[_0x1ff3e7(0x210)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x44dbc1[_0x5942e9[_0x1ff3e7(0x210)]][_0x1ff3e7(0x24a)]++,_0x44dbc1[_0x5942e9['gateway']][_0x1ff3e7(0x249)]+=_0x1eace7,_0x44dbc1[_0x5942e9[_0x1ff3e7(0x210)]][_0x1ff3e7(0x201)]+=_0xe07dea,_0x44dbc1[_0x5942e9[_0x1ff3e7(0x210)]]['merchantEarningsUSDT']+=_0x4d7be7,_0x44dbc1[_0x5942e9[_0x1ff3e7(0x210)]][_0x1ff3e7(0x235)]+=_0x332d14;!_0x4628cf[_0x1ff3e7(0x232)]&&(!_0x3e7bc1[_0x5942e9[_0x1ff3e7(0x232)]]&&(_0x3e7bc1[_0x5942e9[_0x1ff3e7(0x232)]]={'shopId':_0x5942e9[_0x1ff3e7(0x232)],'shopName':_0x5942e9[_0x1ff3e7(0x29b)]['name'],'shopUsername':_0x5942e9[_0x1ff3e7(0x29b)]['username'],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x3e7bc1[_0x5942e9[_0x1ff3e7(0x232)]]['paymentsCount']++,_0x3e7bc1[_0x5942e9[_0x1ff3e7(0x232)]][_0x1ff3e7(0x249)]+=_0x1eace7,_0x3e7bc1[_0x5942e9[_0x1ff3e7(0x232)]][_0x1ff3e7(0x201)]+=_0xe07dea,_0x3e7bc1[_0x5942e9[_0x1ff3e7(0x232)]][_0x1ff3e7(0x2a9)]+=_0x4d7be7);const _0x4e9121=_0x5942e9[_0x1ff3e7(0x29f)]['toISOString']()['split']('T')[0x0];!_0x19325b[_0x4e9121]&&(_0x19325b[_0x4e9121]={'date':_0x4e9121,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x19325b[_0x4e9121][_0x1ff3e7(0x283)]+=_0x1eace7,_0x19325b[_0x4e9121][_0x1ff3e7(0x1e3)]+=_0x4d7be7,_0x19325b[_0x4e9121][_0x1ff3e7(0x271)]+=_0xe07dea,_0x19325b[_0x4e9121][_0x1ff3e7(0x24a)]++;}catch(_0x2db5b6){console[_0x1ff3e7(0x288)]('Error\x20processing\x20payment\x20'+_0x5942e9['id']+':',_0x2db5b6);}}Object['values'](_0x44dbc1)['forEach'](_0x5eb6c8=>{const _0x501395=_0x1ff3e7;_0x5eb6c8[_0x501395(0x268)]=_0x5eb6c8[_0x501395(0x24a)]>0x0?_0x5eb6c8['totalCommissionRate']/_0x5eb6c8['paymentsCount']:0x0,delete _0x5eb6c8['totalCommissionRate'];}),Object['values'](_0x3e7bc1)['forEach'](_0x4014bb=>{const _0x40cc22=_0x1ff3e7;_0x4014bb['averageCheckUSDT']=_0x4014bb['paymentsCount']>0x0?_0x4014bb['turnoverUSDT']/_0x4014bb[_0x40cc22(0x24a)]:0x0;});let _0x28aa93=0x0;if(_0x4628cf[_0x1ff3e7(0x232)]){const _0x1dcd73=await database_1[_0x1ff3e7(0x27d)][_0x1ff3e7(0x1f3)][_0x1ff3e7(0x279)]({'where':{'shopId':_0x4628cf[_0x1ff3e7(0x232)],'status':_0x1ff3e7(0x25d),'createdAt':{'gte':_0xe640f4,'lte':_0x213475}},'select':{'amount':!![]}});_0x28aa93=_0x1dcd73[_0x1ff3e7(0x28c)]((_0x42cd46,_0x42213c)=>_0x42cd46+_0x42213c[_0x1ff3e7(0x278)],0x0);}const _0x2cf0fe=_0x15f621['length'],_0x433c57=_0x15f621[_0x1ff3e7(0x266)],_0x50de50=_0x2cf0fe>0x0?_0x4126e5/_0x2cf0fe:0x0,_0x1e8406=0x64,_0x481882=Math[_0x1ff3e7(0x203)]((_0x213475[_0x1ff3e7(0x1f5)]()-_0xe640f4[_0x1ff3e7(0x1f5)]())/(0x3e8*0x3c*0x3c*0x18)),_0x39f82c={'totalTurnover':Math[_0x1ff3e7(0x21c)](_0x4126e5*0x64)/0x64,'merchantEarnings':Math[_0x1ff3e7(0x21c)](_0x2fc2b4*0x64)/0x64,'gatewayEarnings':Math['round'](_0x213250*0x64)/0x64,'totalPaidOut':Math[_0x1ff3e7(0x21c)](_0x28aa93*0x64)/0x64,'averageCheck':Math[_0x1ff3e7(0x21c)](_0x50de50*0x64)/0x64,'totalPayments':_0x2cf0fe,'successfulPayments':_0x433c57,'conversionRate':_0x1e8406,'gatewayBreakdown':Object[_0x1ff3e7(0x1da)](_0x44dbc1)['map'](_0x516a52=>({..._0x516a52,'turnoverUSDT':Math[_0x1ff3e7(0x21c)](_0x516a52[_0x1ff3e7(0x249)]*0x64)/0x64,'commissionUSDT':Math[_0x1ff3e7(0x21c)](_0x516a52[_0x1ff3e7(0x201)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x1ff3e7(0x21c)](_0x516a52[_0x1ff3e7(0x2a9)]*0x64)/0x64,'averageCommissionRate':Math['round'](_0x516a52[_0x1ff3e7(0x268)]*0x64)/0x64})),'merchantBreakdown':_0x4628cf['shopId']?undefined:Object['values'](_0x3e7bc1)[_0x1ff3e7(0x24b)](_0x54f1e7=>({..._0x54f1e7,'turnoverUSDT':Math[_0x1ff3e7(0x21c)](_0x54f1e7[_0x1ff3e7(0x249)]*0x64)/0x64,'commissionUSDT':Math[_0x1ff3e7(0x21c)](_0x54f1e7[_0x1ff3e7(0x201)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x1ff3e7(0x21c)](_0x54f1e7[_0x1ff3e7(0x2a9)]*0x64)/0x64,'paidOutUSDT':Math['round'](_0x54f1e7[_0x1ff3e7(0x1e7)]*0x64)/0x64,'averageCheckUSDT':Math[_0x1ff3e7(0x21c)](_0x54f1e7[_0x1ff3e7(0x1e6)]*0x64)/0x64})),'dailyData':Object[_0x1ff3e7(0x1da)](_0x19325b)[_0x1ff3e7(0x24b)](_0x21c1ab=>({..._0x21c1ab,'turnover':Math[_0x1ff3e7(0x21c)](_0x21c1ab[_0x1ff3e7(0x283)]*0x64)/0x64,'merchantEarnings':Math[_0x1ff3e7(0x21c)](_0x21c1ab[_0x1ff3e7(0x1e3)]*0x64)/0x64,'gatewayEarnings':Math[_0x1ff3e7(0x21c)](_0x21c1ab[_0x1ff3e7(0x271)]*0x64)/0x64}))['sort']((_0x1e6355,_0x397326)=>_0x1e6355[_0x1ff3e7(0x1e5)][_0x1ff3e7(0x295)](_0x397326[_0x1ff3e7(0x1e5)])),'periodInfo':{'from':_0xe640f4,'to':_0x213475,'periodType':_0x4628cf[_0x1ff3e7(0x22d)]||_0x1ff3e7(0x296),'daysCount':_0x481882}};return console['log'](_0x1ff3e7(0x21a)),console[_0x1ff3e7(0x239)](_0x1ff3e7(0x228)+_0x39f82c[_0x1ff3e7(0x202)]+_0x1ff3e7(0x265)),console['log'](_0x1ff3e7(0x1e0)+_0x39f82c[_0x1ff3e7(0x1e3)]+_0x1ff3e7(0x265)),console['log'](_0x1ff3e7(0x2a4)+_0x39f82c['gatewayEarnings']+_0x1ff3e7(0x265)),console[_0x1ff3e7(0x239)]('\x20\x20\x20üìä\x20Total\x20payments:\x20'+_0x39f82c[_0x1ff3e7(0x290)]),_0x39f82c;}[a35_0x59b92e(0x1d9)](_0x1d7f08){const _0x1973ea=a35_0x59b92e,_0x11808c={'test_gateway':_0x1973ea(0x289),'plisio':_0x1973ea(0x20e),'rapyd':'Rapyd','noda':_0x1973ea(0x1f0),'cointopay':'CoinToPay','klyme_eu':_0x1973ea(0x222),'klyme_gb':_0x1973ea(0x22a),'klyme_de':_0x1973ea(0x28f)};return _0x11808c[_0x1d7f08]||_0x1d7f08;}async[a35_0x59b92e(0x2a2)](_0x5b5307){const _0x3c20d6=a35_0x59b92e,{page:_0x376bb9,limit:_0xf6a77e,minAmount:_0x46e718,search:_0x322e08}=_0x5b5307,_0x6db745=(_0x376bb9-0x1)*_0xf6a77e;console[_0x3c20d6(0x239)](_0x3c20d6(0x1cf),_0x5b5307);const _0x2aa6bd={'balance':{'gt':0x0},'status':_0x3c20d6(0x243)};_0x46e718&&(_0x2aa6bd['balance'][_0x3c20d6(0x220)]=_0x46e718);_0x322e08&&(_0x2aa6bd['OR']=[{'name':{'contains':_0x322e08,'mode':_0x3c20d6(0x262)}},{'username':{'contains':_0x322e08,'mode':_0x3c20d6(0x262)}}]);const [_0x4b6c21,_0xee0d6a]=await Promise[_0x3c20d6(0x1df)]([database_1[_0x3c20d6(0x27d)][_0x3c20d6(0x29b)][_0x3c20d6(0x279)]({'where':_0x2aa6bd,'skip':_0x6db745,'take':_0xf6a77e,'orderBy':{'balance':_0x3c20d6(0x234)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'createdAt':!![]}}),database_1[_0x3c20d6(0x27d)][_0x3c20d6(0x29b)]['count']({'where':_0x2aa6bd})]);console[_0x3c20d6(0x239)](_0x3c20d6(0x272)+_0x4b6c21[_0x3c20d6(0x266)]+_0x3c20d6(0x1e8));const _0x204671=await Promise[_0x3c20d6(0x1df)](_0x4b6c21[_0x3c20d6(0x24b)](async _0x42fa85=>{const _0x544912=_0x3c20d6,[_0x573e48,_0x1fe769,_0xd579f5]=await Promise[_0x544912(0x1df)]([database_1[_0x544912(0x27d)]['payment']['count']({'where':{'shopId':_0x42fa85['id'],'status':_0x544912(0x223),'amountUSDT':{'not':null}}}),database_1[_0x544912(0x27d)][_0x544912(0x1dd)][_0x544912(0x1d4)]({'where':{'shopId':_0x42fa85['id'],'status':_0x544912(0x223),'amountUSDT':{'not':null}},'orderBy':{'paidAt':'asc'},'select':{'paidAt':!![]}}),database_1[_0x544912(0x27d)][_0x544912(0x1dd)][_0x544912(0x25e)]({'by':[_0x544912(0x210)],'where':{'shopId':_0x42fa85['id'],'status':_0x544912(0x223),'amountUSDT':{'not':null}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x433577=_0xd579f5['map'](_0x170fc8=>({'gateway':_0x170fc8['gateway'],'count':_0x170fc8[_0x544912(0x26e)]['id'],'amountUSDT':_0x170fc8[_0x544912(0x23f)][_0x544912(0x1d1)]||0x0,'amountAfterCommissionUSDT':_0x170fc8['_sum'][_0x544912(0x1d1)]||0x0,'commission':0x0}));return{'id':_0x42fa85['id'],'fullName':_0x42fa85[_0x544912(0x24c)],'username':_0x42fa85[_0x544912(0x1f7)],'telegramId':_0x42fa85['telegram'],'merchantUrl':_0x42fa85[_0x544912(0x237)],'wallets':{'usdtPolygonWallet':_0x42fa85[_0x544912(0x280)],'usdtTrcWallet':_0x42fa85[_0x544912(0x297)],'usdtErcWallet':_0x42fa85[_0x544912(0x276)],'usdcPolygonWallet':_0x42fa85['usdcPolygonWallet']},'totalAmountUSDT':_0x42fa85[_0x544912(0x298)],'totalAmountAfterCommissionUSDT':_0x42fa85[_0x544912(0x298)],'paymentsCount':_0x573e48,'oldestPaymentDate':_0x1fe769?.[_0x544912(0x29f)]||_0x42fa85[_0x544912(0x269)],'gatewayBreakdown':_0x433577};})),_0x3aa1e1=_0x4b6c21['reduce']((_0x104113,_0x1d0fe2)=>_0x104113+_0x1d0fe2[_0x3c20d6(0x298)],0x0),_0x3da3c5=_0x3aa1e1;return console[_0x3c20d6(0x239)](_0x3c20d6(0x245)+_0xee0d6a+_0x3c20d6(0x264)+Math[_0x3c20d6(0x21c)](_0x3da3c5*0x64)/0x64+_0x3c20d6(0x253)),{'merchants':_0x204671,'pagination':{'page':_0x376bb9,'limit':_0xf6a77e,'total':_0xee0d6a,'totalPages':Math[_0x3c20d6(0x203)](_0xee0d6a/_0xf6a77e)},'summary':{'totalMerchants':_0xee0d6a,'totalAmountUSDT':Math['round'](_0x3aa1e1*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x3c20d6(0x21c)](_0x3da3c5*0x64)/0x64}};}async[a35_0x59b92e(0x1f8)](_0x3fd19f){const _0xb9db94=a35_0x59b92e,{shopId:_0x44d2a4,amount:_0x3559c8,network:_0x5bb38e,notes:_0x2ab093,periodFrom:_0x551d21,periodTo:_0x5b7a1b}=_0x3fd19f,_0x200686=await database_1[_0xb9db94(0x27d)][_0xb9db94(0x224)](async _0x20af9c=>{const _0x150392=_0xb9db94,_0x401bb6=await _0x20af9c['shop']['findUnique']({'where':{'id':_0x44d2a4},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x401bb6)throw new Error(_0x150392(0x21f));console['log'](_0x150392(0x1f9)+_0x401bb6[_0x150392(0x1f7)]+':'),console[_0x150392(0x239)](_0x150392(0x20a)+_0x401bb6[_0x150392(0x298)][_0x150392(0x1c8)](0x6)+_0x150392(0x265)),console['log'](_0x150392(0x1d0)+_0x3559c8[_0x150392(0x1c8)](0x6)+_0x150392(0x265)),console[_0x150392(0x239)](_0x150392(0x256)+_0x401bb6['totalPaidOut'][_0x150392(0x1c8)](0x6)+_0x150392(0x265));if(_0x401bb6[_0x150392(0x298)]<_0x3559c8)throw new Error(_0x150392(0x299)+_0x401bb6[_0x150392(0x298)]['toFixed'](0x6)+_0x150392(0x25a)+_0x3559c8[_0x150392(0x1c8)](0x6)+_0x150392(0x265));const _0x535f61=await _0x20af9c['payout'][_0x150392(0x1e9)]({'data':{'shopId':_0x44d2a4,'amount':_0x3559c8,'network':_0x5bb38e,'status':_0x150392(0x25d),'notes':_0x2ab093,'periodFrom':_0x551d21?new Date(_0x551d21):null,'periodTo':_0x5b7a1b?new Date(_0x5b7a1b):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x1bf0d5=_0x401bb6[_0x150392(0x298)]-_0x3559c8,_0x2a7e07=_0x401bb6[_0x150392(0x294)]+_0x3559c8;return await _0x20af9c[_0x150392(0x29b)]['update']({'where':{'id':_0x44d2a4},'data':{'balance':_0x1bf0d5,'totalPaidOut':_0x2a7e07}}),console[_0x150392(0x239)](_0x150392(0x1d6)+_0x401bb6['username']+_0x150392(0x1db)),console[_0x150392(0x239)](_0x150392(0x267)+_0x401bb6[_0x150392(0x298)][_0x150392(0x1c8)](0x6)+_0x150392(0x24f)+_0x1bf0d5['toFixed'](0x6)+_0x150392(0x2a0)+_0x3559c8[_0x150392(0x1c8)](0x6)+')'),console[_0x150392(0x239)](_0x150392(0x1f2)+_0x401bb6[_0x150392(0x294)][_0x150392(0x1c8)](0x6)+_0x150392(0x24f)+_0x2a7e07[_0x150392(0x1c8)](0x6)+'\x20USDT\x20(+'+_0x3559c8[_0x150392(0x1c8)](0x6)+')'),{'payout':_0x535f61,'shop':_0x401bb6};});return console[_0xb9db94(0x239)]('‚úÖ\x20Payout\x20created:\x20'+_0x200686[_0xb9db94(0x1f3)]['id']+_0xb9db94(0x246)+_0x200686[_0xb9db94(0x29b)]['username']+'\x20('+_0x3559c8+_0xb9db94(0x285)),{'id':_0x200686[_0xb9db94(0x1f3)]['id'],'shopId':_0x200686[_0xb9db94(0x1f3)][_0xb9db94(0x232)],'shopName':_0x200686[_0xb9db94(0x29b)][_0xb9db94(0x24c)],'shopUsername':_0x200686['shop'][_0xb9db94(0x1f7)],'amount':_0x200686['payout'][_0xb9db94(0x278)],'network':_0x200686[_0xb9db94(0x1f3)][_0xb9db94(0x21e)],'status':_0x200686[_0xb9db94(0x1f3)][_0xb9db94(0x217)],'txid':_0x200686[_0xb9db94(0x1f3)][_0xb9db94(0x2a3)],'notes':_0x200686[_0xb9db94(0x1f3)][_0xb9db94(0x1d3)],'periodFrom':_0x200686['payout'][_0xb9db94(0x26d)],'periodTo':_0x200686['payout'][_0xb9db94(0x2a7)],'createdAt':_0x200686[_0xb9db94(0x1f3)][_0xb9db94(0x269)],'paidAt':_0x200686[_0xb9db94(0x1f3)][_0xb9db94(0x29f)]};}async[a35_0x59b92e(0x2aa)](_0x2c9558){const _0x2ff6c2=a35_0x59b92e,{page:_0x47955c,limit:_0x54086b,shopId:_0x3e12c4,network:_0xbdb851,dateFrom:_0x18a318,dateTo:_0x1cf334,search:_0xedc04b}=_0x2c9558,_0x168e09=(_0x47955c-0x1)*_0x54086b,_0x1801dc={};_0x3e12c4&&(_0x1801dc[_0x2ff6c2(0x232)]=_0x3e12c4);_0xbdb851&&(_0x1801dc['network']=_0xbdb851);(_0x18a318||_0x1cf334)&&(_0x1801dc[_0x2ff6c2(0x269)]={},_0x18a318&&(_0x1801dc['createdAt'][_0x2ff6c2(0x220)]=new Date(_0x18a318)),_0x1cf334&&(_0x1801dc['createdAt']['lte']=new Date(_0x1cf334)));_0xedc04b&&(_0x1801dc['OR']=[{'shop':{'name':{'contains':_0xedc04b,'mode':_0x2ff6c2(0x262)}}},{'shop':{'username':{'contains':_0xedc04b,'mode':'insensitive'}}},{'notes':{'contains':_0xedc04b,'mode':_0x2ff6c2(0x262)}}]);const [_0xd5e8c7,_0x3602fe]=await Promise[_0x2ff6c2(0x1df)]([database_1['default']['payout'][_0x2ff6c2(0x279)]({'where':_0x1801dc,'skip':_0x168e09,'take':_0x54086b,'orderBy':{'createdAt':_0x2ff6c2(0x234)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x2ff6c2(0x1f3)][_0x2ff6c2(0x2a1)]({'where':_0x1801dc})]);return{'payouts':_0xd5e8c7['map'](_0x5acb2c=>({'id':_0x5acb2c['id'],'shopId':_0x5acb2c[_0x2ff6c2(0x232)],'shopName':_0x5acb2c[_0x2ff6c2(0x29b)]['name'],'shopUsername':_0x5acb2c['shop'][_0x2ff6c2(0x1f7)],'amount':_0x5acb2c[_0x2ff6c2(0x278)],'network':_0x5acb2c[_0x2ff6c2(0x21e)],'status':_0x5acb2c[_0x2ff6c2(0x217)],'txid':_0x5acb2c['txid'],'notes':_0x5acb2c[_0x2ff6c2(0x1d3)],'periodFrom':_0x5acb2c['periodFrom'],'periodTo':_0x5acb2c['periodTo'],'createdAt':_0x5acb2c[_0x2ff6c2(0x269)],'paidAt':_0x5acb2c[_0x2ff6c2(0x29f)]})),'pagination':{'page':_0x47955c,'limit':_0x54086b,'total':_0x3602fe,'totalPages':Math['ceil'](_0x3602fe/_0x54086b)}};}async[a35_0x59b92e(0x250)](_0xf8e649){const _0x59cb20=a35_0x59b92e,_0x3dc681=await database_1['default'][_0x59cb20(0x1f3)]['findUnique']({'where':{'id':_0xf8e649},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x3dc681)return null;return{'id':_0x3dc681['id'],'shopId':_0x3dc681[_0x59cb20(0x232)],'shopName':_0x3dc681['shop'][_0x59cb20(0x24c)],'shopUsername':_0x3dc681[_0x59cb20(0x29b)][_0x59cb20(0x1f7)],'amount':_0x3dc681['amount'],'network':_0x3dc681[_0x59cb20(0x21e)],'status':_0x3dc681[_0x59cb20(0x217)],'txid':_0x3dc681[_0x59cb20(0x2a3)],'notes':_0x3dc681[_0x59cb20(0x1d3)],'periodFrom':_0x3dc681[_0x59cb20(0x26d)],'periodTo':_0x3dc681['periodTo'],'createdAt':_0x3dc681[_0x59cb20(0x269)],'paidAt':_0x3dc681[_0x59cb20(0x29f)]};}async['deletePayout'](_0x3f2acd){const _0x8d9f5a=a35_0x59b92e;await database_1[_0x8d9f5a(0x27d)][_0x8d9f5a(0x1f3)][_0x8d9f5a(0x1e2)]({'where':{'id':_0x3f2acd}});}async['getAllPayments'](_0x21471f){const _0x402f60=a35_0x59b92e,{page:_0x3ab469,limit:_0x408ae5,status:_0x5eab38,gateway:_0x1c526b,shopId:_0x450ceb,dateFrom:_0x18c3d0,dateTo:_0xadcfb4,search:_0x327ea8}=_0x21471f,_0x5b2391=(_0x3ab469-0x1)*_0x408ae5,_0x1e5cd1={};_0x5eab38&&(_0x1e5cd1[_0x402f60(0x217)]=_0x5eab38['toUpperCase']());_0x1c526b&&(_0x1e5cd1['gateway']=_0x1c526b['toLowerCase']());_0x1e5cd1[_0x402f60(0x210)]=_0x1e5cd1[_0x402f60(0x210)]?_0x1e5cd1[_0x402f60(0x210)]:{'not':'test_gateway'};if(typeof _0x1e5cd1['gateway']==='string'&&_0x1e5cd1[_0x402f60(0x210)]!==_0x402f60(0x27f)){}else{if(typeof _0x1e5cd1['gateway']===_0x402f60(0x233)&&_0x1e5cd1['gateway']===_0x402f60(0x27f)){}else _0x1e5cd1[_0x402f60(0x210)]={'not':_0x402f60(0x27f)};}_0x450ceb&&(_0x1e5cd1[_0x402f60(0x232)]=_0x450ceb);(_0x18c3d0||_0xadcfb4)&&(_0x1e5cd1[_0x402f60(0x269)]={},_0x18c3d0&&(_0x1e5cd1[_0x402f60(0x269)][_0x402f60(0x220)]=new Date(_0x18c3d0)),_0xadcfb4&&(_0x1e5cd1[_0x402f60(0x269)][_0x402f60(0x273)]=new Date(_0xadcfb4)));_0x327ea8&&(_0x1e5cd1['OR']=[{'orderId':{'contains':_0x327ea8,'mode':_0x402f60(0x262)}},{'gatewayOrderId':{'contains':_0x327ea8,'mode':_0x402f60(0x262)}},{'customerEmail':{'contains':_0x327ea8,'mode':_0x402f60(0x262)}},{'shop':{'name':{'contains':_0x327ea8,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x327ea8,'mode':'insensitive'}}}]);const [_0x4fe843,_0x1d9c0a]=await Promise[_0x402f60(0x1df)]([database_1[_0x402f60(0x27d)][_0x402f60(0x1dd)][_0x402f60(0x279)]({'where':_0x1e5cd1,'skip':_0x5b2391,'take':_0x408ae5,'orderBy':{'createdAt':_0x402f60(0x234)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x402f60(0x27d)][_0x402f60(0x1dd)][_0x402f60(0x2a1)]({'where':_0x1e5cd1})]);return{'payments':_0x4fe843[_0x402f60(0x24b)](_0xcac523=>({'id':_0xcac523['id'],'shopId':_0xcac523[_0x402f60(0x232)],'gateway':_0xcac523[_0x402f60(0x210)],'amount':_0xcac523[_0x402f60(0x278)],'currency':_0xcac523[_0x402f60(0x259)],'status':_0xcac523[_0x402f60(0x217)],'orderId':_0xcac523['orderId'],'gatewayOrderId':_0xcac523[_0x402f60(0x1d2)],'customerEmail':_0xcac523['customerEmail'],'customerName':_0xcac523['customerName'],'customerCountry':_0xcac523[_0x402f60(0x20d)],'customerIp':_0xcac523[_0x402f60(0x293)],'customerUa':_0xcac523['customerUa'],'failureMessage':_0xcac523[_0x402f60(0x21b)],'createdAt':_0xcac523[_0x402f60(0x269)],'updatedAt':_0xcac523[_0x402f60(0x244)],'shop':_0xcac523[_0x402f60(0x29b)]})),'pagination':{'page':_0x3ab469,'limit':_0x408ae5,'total':_0x1d9c0a,'totalPages':Math[_0x402f60(0x203)](_0x1d9c0a/_0x408ae5)}};}async[a35_0x59b92e(0x1eb)](_0x2b6147){const _0x305baf=a35_0x59b92e,_0x5642c3=await database_1[_0x305baf(0x27d)][_0x305baf(0x1dd)]['findUnique']({'where':{'id':_0x2b6147},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x5642c3)return null;return{'id':_0x5642c3['id'],'shopId':_0x5642c3[_0x305baf(0x232)],'gateway':_0x5642c3[_0x305baf(0x210)],'amount':_0x5642c3[_0x305baf(0x278)],'currency':_0x5642c3[_0x305baf(0x259)],'status':_0x5642c3[_0x305baf(0x217)],'orderId':_0x5642c3[_0x305baf(0x29a)],'gatewayOrderId':_0x5642c3['gatewayOrderId'],'customerEmail':_0x5642c3[_0x305baf(0x207)],'customerName':_0x5642c3['customerName'],'customerCountry':_0x5642c3[_0x305baf(0x20d)],'customerIp':_0x5642c3[_0x305baf(0x293)],'customerUa':_0x5642c3['customerUa'],'failureMessage':_0x5642c3[_0x305baf(0x21b)],'externalPaymentUrl':_0x5642c3[_0x305baf(0x226)],'successUrl':_0x5642c3[_0x305baf(0x274)],'failUrl':_0x5642c3[_0x305baf(0x221)],'pendingUrl':_0x5642c3[_0x305baf(0x1ec)],'whiteUrl':_0x5642c3[_0x305baf(0x29e)],'createdAt':_0x5642c3[_0x305baf(0x269)],'updatedAt':_0x5642c3[_0x305baf(0x244)],'shop':_0x5642c3[_0x305baf(0x29b)]};}async[a35_0x59b92e(0x1ef)](_0x2c273b,_0x1cd88a,_0x536cbe,_0x3832f7){const _0x241f90=a35_0x59b92e,_0x2f292d=await database_1[_0x241f90(0x27d)][_0x241f90(0x224)](async _0x21190b=>{const _0x57873e=_0x241f90,_0x2593d7=await _0x21190b[_0x57873e(0x1dd)]['findUnique']({'where':{'id':_0x2c273b},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x2593d7)throw new Error(_0x57873e(0x27c));const _0x4de51c=_0x2593d7[_0x57873e(0x217)],_0xaa9f94=_0x1cd88a[_0x57873e(0x2a8)]();console[_0x57873e(0x239)](_0x57873e(0x213)+_0x2c273b+_0x57873e(0x236)+_0x4de51c+'\x20->\x20'+_0xaa9f94),console[_0x57873e(0x239)](_0x57873e(0x22b)+_0x2593d7[_0x57873e(0x29b)][_0x57873e(0x298)]+_0x57873e(0x265));const _0x3bb7b9={'status':_0xaa9f94,'updatedAt':new Date(),'statusChangedBy':_0x57873e(0x1e4),'statusChangedAt':new Date()};_0x536cbe&&(_0x3bb7b9[_0x57873e(0x1fd)]=_0x536cbe);_0xaa9f94===_0x57873e(0x28e)&&_0x3832f7&&(_0x3bb7b9[_0x57873e(0x277)]=_0x3832f7);let _0x1c8278=0x0,_0x2f23e6=_0x2593d7['shop'][_0x57873e(0x298)];if(_0xaa9f94==='PAID'&&_0x4de51c!==_0x57873e(0x223)){_0x3bb7b9[_0x57873e(0x29f)]=new Date();const _0x1e579c=await currencyService_1[_0x57873e(0x27b)][_0x57873e(0x258)](_0x2593d7[_0x57873e(0x278)],_0x2593d7['currency']);_0x3bb7b9['amountUSDT']=_0x1e579c,_0x1c8278=_0x1e579c,_0x2f23e6+=_0x1e579c,console['log'](_0x57873e(0x23e)+_0x2c273b+_0x57873e(0x1e1)+_0x1e579c[_0x57873e(0x1c8)](0x6)+_0x57873e(0x240));}else _0x4de51c===_0x57873e(0x223)&&_0xaa9f94!=='PAID'&&(_0x2593d7[_0x57873e(0x1d1)]&&(_0x1c8278=-_0x2593d7[_0x57873e(0x1d1)],_0x2f23e6-=_0x2593d7[_0x57873e(0x1d1)],_0x3bb7b9[_0x57873e(0x1d1)]=null,console[_0x57873e(0x239)](_0x57873e(0x23e)+_0x2c273b+_0x57873e(0x1fc)+_0x2593d7[_0x57873e(0x1d1)][_0x57873e(0x1c8)](0x6)+_0x57873e(0x29c))));if(_0xaa9f94===_0x57873e(0x28e)){if(_0x4de51c===_0x57873e(0x223)&&_0x2593d7['amountUSDT']){}_0x3832f7&&_0x3832f7>0x0&&(_0x1c8278-=_0x3832f7,_0x2f23e6-=_0x3832f7,console[_0x57873e(0x239)](_0x57873e(0x206)+_0x3832f7[_0x57873e(0x1c8)](0x6)+_0x57873e(0x29c)));}_0xaa9f94===_0x57873e(0x2a6)&&_0x4de51c==='PAID'&&console[_0x57873e(0x239)](_0x57873e(0x281));const _0x3959fd=await _0x21190b[_0x57873e(0x1dd)][_0x57873e(0x1c9)]({'where':{'id':_0x2c273b},'data':_0x3bb7b9,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x1c8278!==0x0&&(await _0x21190b['shop']['update']({'where':{'id':_0x2593d7[_0x57873e(0x232)]},'data':{'balance':_0x2f23e6}}),console[_0x57873e(0x239)](_0x57873e(0x1d6)+_0x2593d7[_0x57873e(0x232)]+_0x57873e(0x1ed)+_0x2593d7[_0x57873e(0x29b)][_0x57873e(0x298)][_0x57873e(0x1c8)](0x6)+_0x57873e(0x24f)+_0x2f23e6[_0x57873e(0x1c8)](0x6)+_0x57873e(0x255)+(_0x1c8278>0x0?'+':'')+_0x1c8278[_0x57873e(0x1c8)](0x6)+')')),_0x3959fd;});return{'id':_0x2f292d['id'],'shopId':_0x2f292d['shopId'],'gateway':_0x2f292d['gateway'],'amount':_0x2f292d[_0x241f90(0x278)],'currency':_0x2f292d[_0x241f90(0x259)],'status':_0x2f292d[_0x241f90(0x217)],'orderId':_0x2f292d['orderId'],'gatewayOrderId':_0x2f292d['gatewayOrderId'],'customerEmail':_0x2f292d[_0x241f90(0x207)],'customerName':_0x2f292d[_0x241f90(0x286)],'customerCountry':_0x2f292d[_0x241f90(0x20d)],'customerIp':_0x2f292d[_0x241f90(0x293)],'customerUa':_0x2f292d[_0x241f90(0x1dc)],'failureMessage':_0x2f292d['failureMessage'],'adminNotes':_0x2f292d[_0x241f90(0x1fd)],'chargebackAmount':_0x2f292d[_0x241f90(0x277)],'statusChangedBy':_0x2f292d[_0x241f90(0x1fa)],'statusChangedAt':_0x2f292d[_0x241f90(0x27a)],'createdAt':_0x2f292d[_0x241f90(0x269)],'updatedAt':_0x2f292d[_0x241f90(0x244)],'shop':_0x2f292d[_0x241f90(0x29b)]};}async[a35_0x59b92e(0x231)](_0x401cc7,_0x1fe3c1){const _0x59a376=a35_0x59b92e,_0x21ac22={..._0x1fe3c1};_0x1fe3c1['password']&&(_0x21ac22[_0x59a376(0x275)]=await bcryptjs_1['default'][_0x59a376(0x26c)](_0x1fe3c1[_0x59a376(0x275)],0xc));_0x1fe3c1[_0x59a376(0x200)]&&(_0x21ac22['name']=_0x1fe3c1[_0x59a376(0x200)],delete _0x21ac22[_0x59a376(0x200)]);_0x1fe3c1[_0x59a376(0x257)]&&(_0x21ac22[_0x59a376(0x209)]=_0x1fe3c1[_0x59a376(0x257)],delete _0x21ac22[_0x59a376(0x257)]);_0x1fe3c1[_0x59a376(0x205)]&&(_0x21ac22[_0x59a376(0x237)]=_0x1fe3c1[_0x59a376(0x205)],delete _0x21ac22[_0x59a376(0x205)]);_0x1fe3c1[_0x59a376(0x1ee)]&&(_0x21ac22[_0x59a376(0x211)]=JSON[_0x59a376(0x1d5)](_0x1fe3c1['gateways']),delete _0x21ac22[_0x59a376(0x1ee)]);_0x1fe3c1[_0x59a376(0x1de)]&&(_0x21ac22[_0x59a376(0x1de)]=JSON[_0x59a376(0x1d5)](_0x1fe3c1[_0x59a376(0x1de)]),delete _0x21ac22[_0x59a376(0x1de)]);_0x1fe3c1[_0x59a376(0x1ea)]&&(_0x1fe3c1[_0x59a376(0x1ea)]['usdtPolygonWallet']!==undefined&&(_0x21ac22[_0x59a376(0x280)]=_0x1fe3c1[_0x59a376(0x1ea)][_0x59a376(0x280)]||null),_0x1fe3c1[_0x59a376(0x1ea)][_0x59a376(0x297)]!==undefined&&(_0x21ac22[_0x59a376(0x297)]=_0x1fe3c1[_0x59a376(0x1ea)][_0x59a376(0x297)]||null),_0x1fe3c1[_0x59a376(0x1ea)][_0x59a376(0x276)]!==undefined&&(_0x21ac22[_0x59a376(0x276)]=_0x1fe3c1[_0x59a376(0x1ea)]['usdtErcWallet']||null),_0x1fe3c1[_0x59a376(0x1ea)][_0x59a376(0x21d)]!==undefined&&(_0x21ac22[_0x59a376(0x21d)]=_0x1fe3c1['wallets']['usdcPolygonWallet']||null),delete _0x21ac22[_0x59a376(0x1ea)]);const _0x5e68e4=await database_1[_0x59a376(0x27d)]['shop'][_0x59a376(0x1c9)]({'where':{'id':_0x401cc7},'data':_0x21ac22,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x5e68e4['id'],'fullName':_0x5e68e4[_0x59a376(0x24c)],'username':_0x5e68e4[_0x59a376(0x1f7)],'telegramId':_0x5e68e4['telegram'],'merchantUrl':_0x5e68e4[_0x59a376(0x237)],'gateways':_0x5e68e4['paymentGateways']?JSON[_0x59a376(0x23a)](_0x5e68e4['paymentGateways']):null,'gatewaySettings':_0x5e68e4[_0x59a376(0x1de)]?JSON[_0x59a376(0x23a)](_0x5e68e4['gatewaySettings']):null,'publicKey':_0x5e68e4[_0x59a376(0x1d8)],'wallets':{'usdtPolygonWallet':_0x5e68e4[_0x59a376(0x280)],'usdtTrcWallet':_0x5e68e4[_0x59a376(0x297)],'usdtErcWallet':_0x5e68e4['usdtErcWallet'],'usdcPolygonWallet':_0x5e68e4[_0x59a376(0x21d)]},'status':_0x5e68e4[_0x59a376(0x217)],'createdAt':_0x5e68e4[_0x59a376(0x269)]};}async[a35_0x59b92e(0x1fe)](_0x35a6fc){const _0x13f5f5=a35_0x59b92e,_0x5cc565=await database_1[_0x13f5f5(0x27d)]['shop'][_0x13f5f5(0x1c9)]({'where':{'id':_0x35a6fc},'data':{'status':_0x13f5f5(0x23c)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x5cc565['id'],'fullName':_0x5cc565[_0x13f5f5(0x24c)],'username':_0x5cc565[_0x13f5f5(0x1f7)],'telegramId':_0x5cc565[_0x13f5f5(0x209)],'merchantUrl':_0x5cc565[_0x13f5f5(0x237)],'gateways':_0x5cc565[_0x13f5f5(0x211)]?JSON['parse'](_0x5cc565[_0x13f5f5(0x211)]):null,'gatewaySettings':_0x5cc565[_0x13f5f5(0x1de)]?JSON[_0x13f5f5(0x23a)](_0x5cc565[_0x13f5f5(0x1de)]):null,'publicKey':_0x5cc565[_0x13f5f5(0x1d8)],'wallets':{'usdtPolygonWallet':_0x5cc565['usdtPolygonWallet'],'usdtTrcWallet':_0x5cc565[_0x13f5f5(0x297)],'usdtErcWallet':_0x5cc565[_0x13f5f5(0x276)],'usdcPolygonWallet':_0x5cc565[_0x13f5f5(0x21d)]},'status':_0x5cc565[_0x13f5f5(0x217)],'createdAt':_0x5cc565['createdAt']};}async[a35_0x59b92e(0x212)](_0x4146a5){const _0x36dae2=a35_0x59b92e,_0x5adbe4=await database_1[_0x36dae2(0x27d)][_0x36dae2(0x29b)]['update']({'where':{'id':_0x4146a5},'data':{'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x5adbe4['id'],'fullName':_0x5adbe4['name'],'username':_0x5adbe4[_0x36dae2(0x1f7)],'telegramId':_0x5adbe4[_0x36dae2(0x209)],'merchantUrl':_0x5adbe4[_0x36dae2(0x237)],'gateways':_0x5adbe4[_0x36dae2(0x211)]?JSON[_0x36dae2(0x23a)](_0x5adbe4['paymentGateways']):null,'gatewaySettings':_0x5adbe4['gatewaySettings']?JSON[_0x36dae2(0x23a)](_0x5adbe4[_0x36dae2(0x1de)]):null,'publicKey':_0x5adbe4['publicKey'],'wallets':{'usdtPolygonWallet':_0x5adbe4[_0x36dae2(0x280)],'usdtTrcWallet':_0x5adbe4[_0x36dae2(0x297)],'usdtErcWallet':_0x5adbe4[_0x36dae2(0x276)],'usdcPolygonWallet':_0x5adbe4['usdcPolygonWallet']},'status':_0x5adbe4['status'],'createdAt':_0x5adbe4[_0x36dae2(0x269)]};}async['getAllUsers'](_0x469147){const _0x111025=a35_0x59b92e,{page:_0x3c9b46,limit:_0x3a28aa,status:_0x1f731b}=_0x469147,_0x43de37=(_0x3c9b46-0x1)*_0x3a28aa,_0x1e233a={};_0x1f731b&&(_0x1e233a[_0x111025(0x217)]=_0x1f731b[_0x111025(0x2a8)]());const [_0x95d33c,_0x203855]=await Promise[_0x111025(0x1df)]([database_1[_0x111025(0x27d)][_0x111025(0x29b)][_0x111025(0x279)]({'where':_0x1e233a,'skip':_0x43de37,'take':_0x3a28aa,'orderBy':{'createdAt':_0x111025(0x234)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1['default']['shop'][_0x111025(0x2a1)]({'where':_0x1e233a})]);return{'users':_0x95d33c['map'](_0x5186e0=>({'id':_0x5186e0['id'],'fullName':_0x5186e0[_0x111025(0x24c)],'username':_0x5186e0[_0x111025(0x1f7)],'telegramId':_0x5186e0['telegram'],'merchantUrl':_0x5186e0[_0x111025(0x237)],'gateways':_0x5186e0[_0x111025(0x211)]?JSON[_0x111025(0x23a)](_0x5186e0[_0x111025(0x211)]):null,'gatewaySettings':_0x5186e0[_0x111025(0x1de)]?JSON[_0x111025(0x23a)](_0x5186e0[_0x111025(0x1de)]):null,'publicKey':_0x5186e0[_0x111025(0x1d8)],'wallets':{'usdtPolygonWallet':_0x5186e0[_0x111025(0x280)],'usdtTrcWallet':_0x5186e0[_0x111025(0x297)],'usdtErcWallet':_0x5186e0[_0x111025(0x276)],'usdcPolygonWallet':_0x5186e0[_0x111025(0x21d)]},'status':_0x5186e0[_0x111025(0x217)],'createdAt':_0x5186e0[_0x111025(0x269)]})),'pagination':{'page':_0x3c9b46,'limit':_0x3a28aa,'total':_0x203855,'totalPages':Math[_0x111025(0x203)](_0x203855/_0x3a28aa)}};}async[a35_0x59b92e(0x248)](_0x167e7f){const _0x17e5d0=a35_0x59b92e,_0x3b2f62=await database_1['default'][_0x17e5d0(0x29b)][_0x17e5d0(0x24d)]({'where':{'id':_0x167e7f},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x3b2f62)return null;return{'id':_0x3b2f62['id'],'fullName':_0x3b2f62[_0x17e5d0(0x24c)],'username':_0x3b2f62[_0x17e5d0(0x1f7)],'telegramId':_0x3b2f62[_0x17e5d0(0x209)],'merchantUrl':_0x3b2f62[_0x17e5d0(0x237)],'gateways':_0x3b2f62[_0x17e5d0(0x211)]?JSON[_0x17e5d0(0x23a)](_0x3b2f62[_0x17e5d0(0x211)]):null,'gatewaySettings':_0x3b2f62[_0x17e5d0(0x1de)]?JSON['parse'](_0x3b2f62[_0x17e5d0(0x1de)]):null,'publicKey':_0x3b2f62['publicKey'],'wallets':{'usdtPolygonWallet':_0x3b2f62[_0x17e5d0(0x280)],'usdtTrcWallet':_0x3b2f62[_0x17e5d0(0x297)],'usdtErcWallet':_0x3b2f62[_0x17e5d0(0x276)],'usdcPolygonWallet':_0x3b2f62[_0x17e5d0(0x21d)]},'status':_0x3b2f62[_0x17e5d0(0x217)],'createdAt':_0x3b2f62['createdAt']};}async[a35_0x59b92e(0x25f)](_0x31d648){const _0x1112c3=a35_0x59b92e,{fullName:_0x2b02c0,username:_0x2523cd,password:_0x525ead,telegramId:_0x312d2d,merchantUrl:_0x1f8b53,gateways:_0x223608,gatewaySettings:_0x546988,wallets:_0x310bac}=_0x31d648,_0x10e0c6=await database_1[_0x1112c3(0x27d)]['shop']['findUnique']({'where':{'username':_0x2523cd}});if(_0x10e0c6)throw new Error(_0x1112c3(0x22f));if(_0x312d2d){const _0x225ff1=await database_1['default']['shop'][_0x1112c3(0x24d)]({'where':{'telegram':_0x312d2d}});if(_0x225ff1)throw new Error('Telegram\x20username\x20already\x20exists');}const _0x44a149=await bcryptjs_1[_0x1112c3(0x27d)]['hash'](_0x525ead,0xc),_0x44ec4d=_0x1112c3(0x24e)+crypto_1[_0x1112c3(0x27d)][_0x1112c3(0x25b)](0x20)[_0x1112c3(0x229)](_0x1112c3(0x23d)),_0x5b8ef4=_0x1112c3(0x291)+crypto_1[_0x1112c3(0x27d)][_0x1112c3(0x25b)](0x20)[_0x1112c3(0x229)]('hex'),_0x349110=await database_1[_0x1112c3(0x27d)][_0x1112c3(0x29b)]['create']({'data':{'name':_0x2b02c0,'username':_0x2523cd,'password':_0x44a149,'telegram':_0x312d2d,'shopUrl':_0x1f8b53,'paymentGateways':_0x223608?JSON[_0x1112c3(0x1d5)](_0x223608):null,'gatewaySettings':_0x546988?JSON[_0x1112c3(0x1d5)](_0x546988):null,'usdtPolygonWallet':_0x310bac?.[_0x1112c3(0x280)]||null,'usdtTrcWallet':_0x310bac?.[_0x1112c3(0x297)]||null,'usdtErcWallet':_0x310bac?.[_0x1112c3(0x276)]||null,'usdcPolygonWallet':_0x310bac?.[_0x1112c3(0x21d)]||null,'publicKey':_0x44ec4d,'secretKey':_0x5b8ef4,'status':_0x1112c3(0x243)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x349110['id'],'fullName':_0x349110[_0x1112c3(0x24c)],'username':_0x349110[_0x1112c3(0x1f7)],'telegramId':_0x349110[_0x1112c3(0x209)],'merchantUrl':_0x349110['shopUrl'],'gateways':_0x349110[_0x1112c3(0x211)]?JSON[_0x1112c3(0x23a)](_0x349110['paymentGateways']):null,'gatewaySettings':_0x349110[_0x1112c3(0x1de)]?JSON[_0x1112c3(0x23a)](_0x349110[_0x1112c3(0x1de)]):null,'publicKey':_0x349110['publicKey'],'wallets':{'usdtPolygonWallet':_0x349110[_0x1112c3(0x280)],'usdtTrcWallet':_0x349110[_0x1112c3(0x297)],'usdtErcWallet':_0x349110[_0x1112c3(0x276)],'usdcPolygonWallet':_0x349110[_0x1112c3(0x21d)]},'status':_0x349110[_0x1112c3(0x217)],'createdAt':_0x349110[_0x1112c3(0x269)]};}async['deleteUser'](_0x1327b0){const _0xf7d909=a35_0x59b92e;await database_1[_0xf7d909(0x27d)][_0xf7d909(0x29b)][_0xf7d909(0x1e2)]({'where':{'id':_0x1327b0}});}}exports[a35_0x59b92e(0x225)]=AdminService;