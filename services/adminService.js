'use strict';function a35_0x118b(){const _0x5692b0=['\x27\x20->\x20name\x20\x27','year','📊\x20Available\x20gateways\x20in\x20database:','\x20USDT\x20(without\x20commission)','\x20became\x20PAID:','paymentsCount','\x27\x20->\x20ID\x20\x27','\x20USDT\x20(after\x20','sk_','\x20\x20\x20Added\x20to\x20balance:\x20+','name','\x20balance\x20updated:\x20','3068856kygSyl','🔄\x20Admin\x20updating\x20payment\x20','forEach','includes','dateTo','💸\x20CHARGEBACK:\x20Merchant\x20amount\x20already\x20deducted\x20from\x20balance','ceil','polygon','erc20','_count','$transaction','test_gateway','getDate','1003185TqzGfq','awaitingPayout','custom','\x20active\x20merchants\x20for\x20selection','getSystemStatistics','totalPaidOut','paymentGateways','generateDailyStatistics','not\x20set','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','failUrl','pendingUrl','_sum','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','🔄\x20Converted\x20gateway\x20ID\x20\x27','createUser','\x20\x20\x20�\x20Total\x20payments\x20turnover:\x20','\x20\x20\x20📅\x20Total\x20payouts\x20(this\x20month):\x20','gateway','adminNotes','\x20\x20\x20💰\x20Total\x20payout:\x20','\x20USDT\x20(','all','averageCheckUSDT','💱\x20Currency\x20filter\x20applied:\x20','\x27\x20not\x20found.\x20Available\x20gateways:\x20','\x20\x20\x20🌍\x20Country:\x20','239067fwBJPY','CHARGEBACK','default','updatePaymentStatus','updateCustomerData','\x20USDT,\x20Requested:\x20','\x20USDT\x20(same\x20as\x20awaiting)','totalTurnover','getMerchantStatistics','paidAt','10702076afvHvQ','updateUser','\x20PAID\x20payments','../config/database','gatewayEarnings','./currencyService','Payment\x20not\x20found','💰\x20[PAYOUT]\x20Gateway\x20','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','\x20\x20\x20Gateway:\x20','toUpperCase','\x20\x20\x20💵\x20Available\x20balance:\x20','getGatewayDisplayName','merchantUrl','revenue','gte','turnoverUSDT','📊\x20Payout\x20statistics\x20calculated:','⚠️\x20Requested\x20gateway\x20\x27','sort','get','getMerchantsSelection','\x20USDT\x20(gross\x20revenue)','\x20->\x20','reduce','24fOWuMd','findUnique','update','Rapyd','round','count','commissionUSDT','totalAmountAfterCommissionUSDT','\x20\x20\x20Balance:\x20','password','summary','admin','dateFrom','stringify','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','ACTIVE','🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','createdAt','customerName','notes','\x20\x20\x20💸\x20Total\x20payouts\x20(all\x20time):\x20','PAID','📊\x20Merchants\x20awaiting\x20payout:\x20','wallets','polygon_usdc','\x20\x20\x20✅\x20Actual\x20available\x20balance:\x20','usdtErcWallet','publicKey','not\x20specified','getMonth','periodTo','\x20USDT\x20(with\x20commission\x20deducted)','defineProperty','55306240SrWNvW','\x20status:\x20','setDate','📊\x20Getting\x20payments\x20with\x20filters:','availableBalance','\x20\x20\x20💰\x20Total\x20payments\x20turnover:\x20','4316184BtClzB','thisMonth','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','payout','toFixed','\x20paid\x20payments\x20for\x20analysis','CoinToPay','telegram','averageCommissionRate','shopId','2020-01-01','balance','payment','log','usdtPolygonWallet','Shop\x20not\x20found','KLYME\x20EU','Username\x20already\x20exists','gateways','\x20\x20\x20🖥️\x20User\x20Agent:\x20','\x20\x20\x20Payout\x20amount:\x20','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','usdcPolygonWallet','currency','\x20merchants\x20with\x20positive\x20balance','getPayoutStats','⚠️\x20Gateway\x20\x27','convertToUSDT','split','periodFrom','telegramId','lte','length','📅\x20Period\x20\x27all\x27:\x20Using\x20start\x20date\x20from\x20first\x20payment:\x20','entries','📋\x20Getting\x20merchants\x20selection\x20list...','KLYME\x20DE','findMany','\x20to\x20','trc20','🔍\x20Using\x20gateway\x20\x27','getTime','shop','externalPaymentUrl','turnover','customerUa','groupBy','\x20\x20\x20📊\x20Total\x20payments:\x20','\x20USDT\x20(total\x20paid\x20to\x20merchants)','💸\x20CHARGEBACK\x20penalty:\x20-','crypto','bcryptjs','toString','__esModule','amountAfterCommissionUSDT','insensitive','date','\x20for\x20shop\x20','\x20\x20\x20Merchant\x20loses:\x20','merchantEarnings','💰\x20[PAYOUT]\x20Merchant\x20','amount','map','\x20USDT','create','\x20\x20\x20📊\x20Commission\x20difference:\x20','username','customerIp','\x27\x20(from\x20\x27','totalPayments','\x20\x20\x20Full\x20amount:\x20','commission','push','\x20USDT\x20from\x20balance','\x20USDT\x20(after\x20payouts)','activateUser','\x27\x20to\x20name\x20\x27','Noda','totalPayout','values','toISOString','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','✅\x20Using\x20gateway\x20filter:\x20\x27','customerCountry','dailyPayments','90d','Telegram\x20username\x20already\x20exists','✅\x20Payout\x20created:\x20',',\x20Commission:\x20','period','desc','suspendUser','updatedAt','getFullYear','0000','\x20\x20\x20🌐\x20IP:\x20','customerEmail','amountUSDT','\x20order','orderId','parse','1361456eLxHpS','\x20\x20\x20Merchant\x20gets:\x20','status','💰\x20Found\x20','NONEXISTENT_GATEWAY_FILTER','txid','💳\x20Payout\x20wallet\x20for\x20','getMerchantsAwaitingPayout','paidOutUSDT','AdminService','getGatewayNameById','KLYME\x20GB','some','network','toLowerCase','\x20\x20\x20💳\x20Total\x20payments:\x20','asc','successUrl','shopUrl','456QmMVCq','hex','2amtoOi','usdtTrcWallet','set','📋\x20Found\x20','error','currencyService','hash','totalAmountUSDT','📊\x20Gateway\x20filter\x20applied:','aggregate','30d','COMPLETED','💰\x20Payment\x20','Error\x20processing\x20payment\x20','randomBytes','Test\x20Gateway','💰\x20Shop\x20','Insufficient\x20balance.\x20Available:\x20','deletePayout','merchantEarningsUSDT','💰\x20Current\x20shop\x20balance:\x20','fullName','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','\x20\x20\x20📅\x20This\x20month:\x20','chargebackAmount','📊\x20Sorting\x20payments\x20by\x20','deleteUser','getGatewayIdByName','📊\x20Final\x20WHERE\x20conditions:','totalCommissionRate','whiteUrl','gatewaySettings'];a35_0x118b=function(){return _0x5692b0;};return a35_0x118b();}const a35_0x5e08cb=a35_0x82cf;(function(_0x5259a3,_0x363247){const _0x3dda04=a35_0x82cf,_0x39f40a=_0x5259a3();while(!![]){try{const _0xe7df67=parseInt(_0x3dda04(0x1d6))/0x1*(-parseInt(_0x3dda04(0x1c1))/0x2)+parseInt(_0x3dda04(0x15c))/0x3+-parseInt(_0x3dda04(0x134))/0x4*(parseInt(_0x3dda04(0xf6))/0x5)+-parseInt(_0x3dda04(0x202))/0x6+-parseInt(_0x3dda04(0x11b))/0x7+-parseInt(_0x3dda04(0x1d4))/0x8*(parseInt(_0x3dda04(0x111))/0x9)+parseInt(_0x3dda04(0x156))/0xa;if(_0xe7df67===_0x363247)break;else _0x39f40a['push'](_0x39f40a['shift']());}catch(_0x28d611){_0x39f40a['push'](_0x39f40a['shift']());}}}(a35_0x118b,0xcf6e7));var __importDefault=this&&this['__importDefault']||function(_0x3a808){const _0x437c6d=a35_0x82cf;return _0x3a808&&_0x3a808[_0x437c6d(0x191)]?_0x3a808:{'default':_0x3a808};};Object[a35_0x5e08cb(0x155)](exports,a35_0x5e08cb(0x191),{'value':!![]}),exports[a35_0x5e08cb(0x1ca)]=void 0x0;const database_1=__importDefault(require(a35_0x5e08cb(0x11e))),bcryptjs_1=__importDefault(require(a35_0x5e08cb(0x18f))),crypto_1=__importDefault(require(a35_0x5e08cb(0x18e))),currencyService_1=require(a35_0x5e08cb(0x120)),gateway_1=require('../types/gateway');function a35_0x82cf(_0x2f1a39,_0x245594){const _0x118b5b=a35_0x118b();return a35_0x82cf=function(_0x82cf12,_0x515bdf){_0x82cf12=_0x82cf12-0xf4;let _0x41e251=_0x118b5b[_0x82cf12];return _0x41e251;},a35_0x82cf(_0x2f1a39,_0x245594);}class AdminService{async[a35_0x5e08cb(0x175)](){const _0x2f525b=a35_0x5e08cb;console[_0x2f525b(0x169)]('📊\x20Calculating\x20payout\x20statistics...');const _0x223b60=await database_1[_0x2f525b(0x113)]['shop'][_0x2f525b(0x1df)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x2f525b(0x143)}}),_0x36585b=await this[_0x2f525b(0x1c8)]({'page':0x1,'limit':0x3e8}),_0x251d44=await database_1[_0x2f525b(0x113)][_0x2f525b(0x168)][_0x2f525b(0x139)]({'where':{'status':_0x2f525b(0x14a),'gateway':{'not':_0x2f525b(0xf4)}}}),_0x3447e8=new Date(),_0x2a7f1f=new Date(_0x3447e8[_0x2f525b(0x1b9)](),_0x3447e8[_0x2f525b(0x152)](),0x1),_0x132cc6=new Date(_0x3447e8[_0x2f525b(0x1b9)](),_0x3447e8[_0x2f525b(0x152)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x2f5463=await database_1['default'][_0x2f525b(0x15f)][_0x2f525b(0x1df)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x2a7f1f,'lte':_0x132cc6},'status':_0x2f525b(0x1e1)}}),_0x340fd0=_0x223b60[_0x2f525b(0x102)][_0x2f525b(0xfb)]||0x0,_0x4e59b6=_0x36585b[_0x2f525b(0x13e)][_0x2f525b(0x13b)],_0x52d15a=_0x2f5463[_0x2f525b(0x102)][_0x2f525b(0x199)]||0x0,_0x5c15d3={'totalPayout':Math[_0x2f525b(0x138)](_0x340fd0*0x64)/0x64,'awaitingPayout':Math[_0x2f525b(0x138)](_0x4e59b6*0x64)/0x64,'thisMonth':Math[_0x2f525b(0x138)](_0x52d15a*0x64)/0x64,'availableBalance':Math[_0x2f525b(0x138)](_0x4e59b6*0x64)/0x64,'totalPayments':_0x251d44};return console[_0x2f525b(0x169)](_0x2f525b(0x12c)),console[_0x2f525b(0x169)](_0x2f525b(0x10a)+_0x5c15d3['totalPayout']+_0x2f525b(0x18c)),console['log'](_0x2f525b(0xff)+_0x5c15d3[_0x2f525b(0xf7)]+_0x2f525b(0x154)),console[_0x2f525b(0x169)](_0x2f525b(0x126)+_0x5c15d3[_0x2f525b(0x15a)]+_0x2f525b(0x117)),console[_0x2f525b(0x169)](_0x2f525b(0x1ed)+_0x5c15d3[_0x2f525b(0x15d)]+'\x20USDT'),console['log'](_0x2f525b(0x1d0)+_0x5c15d3['totalPayments']+_0x2f525b(0x11d)),console[_0x2f525b(0x169)]('\x20\x20\x20🔍\x20Raw\x20balance\x20sum:\x20'+(_0x223b60[_0x2f525b(0x102)][_0x2f525b(0x167)]||0x0)[_0x2f525b(0x160)](0x2)+_0x2f525b(0x1f9)),console['log'](_0x2f525b(0x19d)+((_0x223b60[_0x2f525b(0x102)]['balance']||0x0)-_0x4e59b6)[_0x2f525b(0x160)](0x2)+_0x2f525b(0x19b)),_0x5c15d3;}async[a35_0x5e08cb(0x115)](_0x321fdc,_0x4ccfcd){const _0x350eb5=a35_0x5e08cb;console['log']('🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20'+_0x321fdc+':',_0x4ccfcd);const _0x49d163=await database_1[_0x350eb5(0x113)][_0x350eb5(0x168)][_0x350eb5(0x135)]({'where':{'id':_0x321fdc},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x49d163)throw new Error(_0x350eb5(0x121));const _0x4a722a={};_0x4ccfcd['customerCountry']!==undefined&&(_0x4a722a[_0x350eb5(0x1af)]=_0x4ccfcd[_0x350eb5(0x1af)]||null);_0x4ccfcd[_0x350eb5(0x19f)]!==undefined&&(_0x4a722a['customerIp']=_0x4ccfcd['customerIp']||null);_0x4ccfcd['customerUa']!==undefined&&(_0x4a722a['customerUa']=_0x4ccfcd[_0x350eb5(0x189)]||null);const _0x1674ee=await database_1['default']['payment']['update']({'where':{'id':_0x321fdc},'data':{..._0x4a722a,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console['log'](_0x350eb5(0x15e)+_0x321fdc),console[_0x350eb5(0x169)](_0x350eb5(0x110)+_0x49d163[_0x350eb5(0x1af)]+_0x350eb5(0x132)+_0x1674ee[_0x350eb5(0x1af)]),console[_0x350eb5(0x169)](_0x350eb5(0x1bb)+_0x49d163[_0x350eb5(0x19f)]+_0x350eb5(0x132)+_0x1674ee[_0x350eb5(0x19f)]),console[_0x350eb5(0x169)](_0x350eb5(0x16f)+(_0x49d163[_0x350eb5(0x189)]?_0x350eb5(0x1d8):_0x350eb5(0xfe))+_0x350eb5(0x132)+(_0x1674ee['customerUa']?_0x350eb5(0x1d8):_0x350eb5(0xfe))),_0x1674ee;}async[a35_0x5e08cb(0xfa)](_0x1c8f6d){const _0x4923f6=a35_0x5e08cb,_0x1212c7=new Date();let _0x3c698a;switch(_0x1c8f6d){case'7d':_0x3c698a=new Date(_0x1212c7['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x4923f6(0x1e0):_0x3c698a=new Date(_0x1212c7['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x4923f6(0x1b1):_0x3c698a=new Date(_0x1212c7['getTime']()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x4923f6(0x10c):const _0x8035f=await database_1[_0x4923f6(0x113)][_0x4923f6(0x168)]['findFirst']({'where':{'gateway':{'not':_0x4923f6(0xf4)}},'orderBy':{'createdAt':_0x4923f6(0x1d1)},'select':{'createdAt':!![]}});_0x3c698a=_0x8035f?_0x8035f[_0x4923f6(0x146)]:new Date(_0x4923f6(0x166)),console[_0x4923f6(0x169)](_0x4923f6(0x17d)+_0x3c698a[_0x4923f6(0x1ac)]());break;default:_0x3c698a=new Date(_0x1212c7[_0x4923f6(0x185)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x5979dd,_0x1bc858,_0x4630eb,_0x2d2fc8,_0x197aa1,_0x462b5e,_0x2ef04f]=await Promise[_0x4923f6(0x10c)]([database_1['default']['shop']['count'](),database_1[_0x4923f6(0x113)][_0x4923f6(0x186)][_0x4923f6(0x139)]({'where':{'status':_0x4923f6(0x143)}}),database_1[_0x4923f6(0x113)][_0x4923f6(0x168)]['count']({'where':{'createdAt':{'gte':_0x3c698a},'gateway':{'not':_0x4923f6(0xf4)}}}),database_1[_0x4923f6(0x113)]['payment'][_0x4923f6(0x139)]({'where':{'status':'PAID','createdAt':{'gte':_0x3c698a},'gateway':{'not':_0x4923f6(0xf4)}}}),database_1[_0x4923f6(0x113)][_0x4923f6(0x168)]['findMany']({'where':{'status':_0x4923f6(0x14a),'createdAt':{'gte':_0x3c698a},'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![]}}),database_1[_0x4923f6(0x113)][_0x4923f6(0x168)][_0x4923f6(0x181)]({'where':{'gateway':{'not':'test_gateway'}},'take':0xa,'orderBy':{'createdAt':_0x4923f6(0x1b6)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x4923f6(0x113)][_0x4923f6(0x168)]['findMany']({'where':{'createdAt':{'gte':_0x3c698a},'gateway':{'not':_0x4923f6(0xf4)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x202e8c=0x0;for(const _0x339445 of _0x197aa1){const _0x252f02=await currencyService_1[_0x4923f6(0x1db)][_0x4923f6(0x177)](_0x339445[_0x4923f6(0x199)],_0x339445[_0x4923f6(0x173)]);_0x202e8c+=_0x252f02;}const _0xd56e73=this['generateDailyStatistics'](_0x2ef04f,_0x3c698a,_0x1212c7),_0xeffc34=_0x4630eb>0x0?_0x2d2fc8/_0x4630eb*0x64:0x0;return{'totalShops':_0x5979dd,'activeShops':_0x1bc858,'totalPayments':_0x4630eb,'successfulPayments':_0x2d2fc8,'totalRevenue':Math[_0x4923f6(0x138)](_0x202e8c*0x64)/0x64,'conversionRate':Math['round'](_0xeffc34*0x64)/0x64,'dailyRevenue':_0xd56e73['dailyRevenue'],'dailyPayments':_0xd56e73[_0x4923f6(0x1b0)],'recentPayments':_0x462b5e[_0x4923f6(0x19a)](_0xe36df=>({'id':_0xe36df['id'],'amount':_0xe36df[_0x4923f6(0x199)],'currency':_0xe36df[_0x4923f6(0x173)],'status':_0xe36df[_0x4923f6(0x1c3)],'gateway':_0xe36df[_0x4923f6(0x108)],'shop':_0xe36df[_0x4923f6(0x186)],'createdAt':_0xe36df[_0x4923f6(0x146)]}))};}async[a35_0x5e08cb(0x119)](_0x4d1aca){const _0x44d525=a35_0x5e08cb;console[_0x44d525(0x169)]('📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:',_0x4d1aca);let _0x1406b7,_0x4656bd=new Date();if(_0x4d1aca[_0x44d525(0x1b5)]===_0x44d525(0xf8)&&_0x4d1aca[_0x44d525(0x140)]&&_0x4d1aca[_0x44d525(0x206)])_0x1406b7=new Date(_0x4d1aca['dateFrom']),_0x4656bd=new Date(_0x4d1aca[_0x44d525(0x206)]);else{const _0x5d0bc3=new Date();switch(_0x4d1aca[_0x44d525(0x1b5)]){case'week':_0x1406b7=new Date(_0x5d0bc3[_0x44d525(0x185)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'month':_0x1406b7=new Date(_0x5d0bc3[_0x44d525(0x185)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x44d525(0x1f7):_0x1406b7=new Date(_0x5d0bc3[_0x44d525(0x185)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x44d525(0x10c):default:_0x1406b7=new Date('2020-01-01');break;}}console[_0x44d525(0x169)]('📅\x20Period:\x20'+_0x1406b7[_0x44d525(0x1ac)]()+_0x44d525(0x182)+_0x4656bd[_0x44d525(0x1ac)]());const _0x31691b={'status':_0x44d525(0x14a),'gateway':{'not':'test_gateway'},'paidAt':{'gte':_0x1406b7,'lte':_0x4656bd}};_0x4d1aca['shopId']&&(_0x31691b[_0x44d525(0x165)]=_0x4d1aca[_0x44d525(0x165)]);const _0x27a22c=await database_1[_0x44d525(0x113)]['payment']['findMany']({'where':_0x31691b,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x44d525(0x169)](_0x44d525(0x1c4)+_0x27a22c[_0x44d525(0x17c)]+_0x44d525(0x161));const _0x344146={'gateway':{'not':_0x44d525(0xf4)},'createdAt':{'gte':_0x1406b7,'lte':_0x4656bd}};_0x4d1aca[_0x44d525(0x165)]&&(_0x344146['shopId']=_0x4d1aca['shopId']);const _0x5cb646=await database_1[_0x44d525(0x113)][_0x44d525(0x168)]['count']({'where':_0x344146});console[_0x44d525(0x169)]('📊\x20Total\x20payments\x20(including\x20failed):\x20'+_0x5cb646+',\x20successful:\x20'+_0x27a22c[_0x44d525(0x17c)]);let _0x12e130=0x0,_0x33ff54=0x0,_0x1bd789=0x0;const _0x370a13={},_0x28d1b7={},_0x52a55b={};for(const _0x42b0cd of _0x27a22c){try{const _0x3e9990=await currencyService_1['currencyService'][_0x44d525(0x177)](_0x42b0cd[_0x44d525(0x199)],_0x42b0cd[_0x44d525(0x173)]);let _0x50a20c={};if(_0x42b0cd[_0x44d525(0x186)]['gatewaySettings'])try{_0x50a20c=JSON['parse'](_0x42b0cd[_0x44d525(0x186)][_0x44d525(0x1f5)]);}catch(_0x5648b0){console['error']('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x42b0cd[_0x44d525(0x165)]+':',_0x5648b0);}let _0x52d911={},_0xf8cd84=0xa;for(const [_0x15f5d5,_0x1f94bb]of Object[_0x44d525(0x17e)](_0x50a20c)){if(_0x15f5d5[_0x44d525(0x1cf)]()===_0x42b0cd['gateway']['toLowerCase']()){_0x52d911=_0x1f94bb,_0xf8cd84=_0x1f94bb['commission']||0xa;break;}}const _0x3d60f0=_0x3e9990*(_0xf8cd84/0x64),_0x4c5fa4=_0x3e9990-_0x3d60f0;_0x12e130+=_0x3e9990,_0x33ff54+=_0x4c5fa4,_0x1bd789+=_0x3d60f0;!_0x370a13[_0x42b0cd[_0x44d525(0x108)]]&&(_0x370a13[_0x42b0cd['gateway']]={'gateway':_0x42b0cd[_0x44d525(0x108)],'gatewayDisplayName':this[_0x44d525(0x127)](_0x42b0cd[_0x44d525(0x108)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x370a13[_0x42b0cd[_0x44d525(0x108)]][_0x44d525(0x1fb)]++,_0x370a13[_0x42b0cd['gateway']][_0x44d525(0x12b)]+=_0x3e9990,_0x370a13[_0x42b0cd[_0x44d525(0x108)]][_0x44d525(0x13a)]+=_0x3d60f0,_0x370a13[_0x42b0cd[_0x44d525(0x108)]][_0x44d525(0x1e9)]+=_0x4c5fa4,_0x370a13[_0x42b0cd[_0x44d525(0x108)]][_0x44d525(0x1f3)]+=_0xf8cd84;!_0x4d1aca[_0x44d525(0x165)]&&(!_0x28d1b7[_0x42b0cd[_0x44d525(0x165)]]&&(_0x28d1b7[_0x42b0cd[_0x44d525(0x165)]]={'shopId':_0x42b0cd[_0x44d525(0x165)],'shopName':_0x42b0cd[_0x44d525(0x186)][_0x44d525(0x200)],'shopUsername':_0x42b0cd[_0x44d525(0x186)][_0x44d525(0x19e)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x28d1b7[_0x42b0cd[_0x44d525(0x165)]][_0x44d525(0x1fb)]++,_0x28d1b7[_0x42b0cd['shopId']][_0x44d525(0x12b)]+=_0x3e9990,_0x28d1b7[_0x42b0cd['shopId']]['commissionUSDT']+=_0x3d60f0,_0x28d1b7[_0x42b0cd[_0x44d525(0x165)]]['merchantEarningsUSDT']+=_0x4c5fa4);const _0x1f63e1=_0x42b0cd[_0x44d525(0x11a)][_0x44d525(0x1ac)]()[_0x44d525(0x178)]('T')[0x0];!_0x52a55b[_0x1f63e1]&&(_0x52a55b[_0x1f63e1]={'date':_0x1f63e1,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x52a55b[_0x1f63e1][_0x44d525(0x188)]+=_0x3e9990,_0x52a55b[_0x1f63e1][_0x44d525(0x197)]+=_0x4c5fa4,_0x52a55b[_0x1f63e1]['gatewayEarnings']+=_0x3d60f0,_0x52a55b[_0x1f63e1][_0x44d525(0x1fb)]++;}catch(_0x599a78){console['error'](_0x44d525(0x1e3)+_0x42b0cd['id']+':',_0x599a78);}}Object['values'](_0x370a13)['forEach'](_0x75c4f7=>{const _0x5d8e0a=_0x44d525;_0x75c4f7[_0x5d8e0a(0x164)]=_0x75c4f7[_0x5d8e0a(0x1fb)]>0x0?_0x75c4f7[_0x5d8e0a(0x1f3)]/_0x75c4f7[_0x5d8e0a(0x1fb)]:0x0,delete _0x75c4f7[_0x5d8e0a(0x1f3)];}),Object[_0x44d525(0x1ab)](_0x28d1b7)[_0x44d525(0x204)](_0x182956=>{const _0x104601=_0x44d525;_0x182956[_0x104601(0x10d)]=_0x182956[_0x104601(0x1fb)]>0x0?_0x182956[_0x104601(0x12b)]/_0x182956[_0x104601(0x1fb)]:0x0;});let _0x218327=0x0;if(_0x4d1aca['shopId']){const _0x4cc239=await database_1['default']['payout'][_0x44d525(0x181)]({'where':{'shopId':_0x4d1aca[_0x44d525(0x165)],'status':_0x44d525(0x1e1),'createdAt':{'gte':_0x1406b7,'lte':_0x4656bd}},'select':{'amount':!![]}});_0x218327=_0x4cc239[_0x44d525(0x133)]((_0x28580a,_0x48bcd9)=>_0x28580a+_0x48bcd9['amount'],0x0);}const _0x54e9ab=_0x5cb646,_0x2a73b5=_0x27a22c[_0x44d525(0x17c)],_0x9c8dde=_0x2a73b5>0x0?_0x12e130/_0x2a73b5:0x0,_0xab2b14=_0x54e9ab>0x0?Math[_0x44d525(0x138)](_0x2a73b5/_0x54e9ab*0x2710)/0x64:0x0,_0x3094e7=Math['ceil']((_0x4656bd[_0x44d525(0x185)]()-_0x1406b7[_0x44d525(0x185)]())/(0x3e8*0x3c*0x3c*0x18)),_0x2e2dc0={'totalTurnover':Math['round'](_0x12e130*0x64)/0x64,'merchantEarnings':Math[_0x44d525(0x138)](_0x33ff54*0x64)/0x64,'gatewayEarnings':Math['round'](_0x1bd789*0x64)/0x64,'totalPaidOut':Math[_0x44d525(0x138)](_0x218327*0x64)/0x64,'averageCheck':Math[_0x44d525(0x138)](_0x9c8dde*0x64)/0x64,'totalPayments':_0x54e9ab,'successfulPayments':_0x2a73b5,'conversionRate':_0xab2b14,'gatewayBreakdown':Object[_0x44d525(0x1ab)](_0x370a13)['map'](_0x513f13=>({..._0x513f13,'turnoverUSDT':Math[_0x44d525(0x138)](_0x513f13['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x44d525(0x138)](_0x513f13[_0x44d525(0x13a)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x513f13[_0x44d525(0x1e9)]*0x64)/0x64,'averageCommissionRate':Math[_0x44d525(0x138)](_0x513f13[_0x44d525(0x164)]*0x64)/0x64})),'merchantBreakdown':_0x4d1aca[_0x44d525(0x165)]?undefined:Object['values'](_0x28d1b7)[_0x44d525(0x19a)](_0x3cfd50=>({..._0x3cfd50,'turnoverUSDT':Math[_0x44d525(0x138)](_0x3cfd50[_0x44d525(0x12b)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x3cfd50['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x44d525(0x138)](_0x3cfd50[_0x44d525(0x1e9)]*0x64)/0x64,'paidOutUSDT':Math[_0x44d525(0x138)](_0x3cfd50[_0x44d525(0x1c9)]*0x64)/0x64,'averageCheckUSDT':Math[_0x44d525(0x138)](_0x3cfd50[_0x44d525(0x10d)]*0x64)/0x64})),'dailyData':Object['values'](_0x52a55b)[_0x44d525(0x19a)](_0x34725b=>({..._0x34725b,'turnover':Math['round'](_0x34725b[_0x44d525(0x188)]*0x64)/0x64,'merchantEarnings':Math[_0x44d525(0x138)](_0x34725b[_0x44d525(0x197)]*0x64)/0x64,'gatewayEarnings':Math['round'](_0x34725b['gatewayEarnings']*0x64)/0x64}))[_0x44d525(0x12e)]((_0x38bf38,_0x18ac7d)=>_0x38bf38['date']['localeCompare'](_0x18ac7d[_0x44d525(0x194)])),'periodInfo':{'from':_0x1406b7,'to':_0x4656bd,'periodType':_0x4d1aca[_0x44d525(0x1b5)]||_0x44d525(0xf8),'daysCount':_0x3094e7}};return console[_0x44d525(0x169)]('📊\x20Merchant\x20statistics\x20calculated:'),console['log']('\x20\x20\x20💰\x20Total\x20turnover:\x20'+_0x2e2dc0[_0x44d525(0x118)]+_0x44d525(0x19b)),console[_0x44d525(0x169)](_0x44d525(0x1ad)+_0x2e2dc0['merchantEarnings']+_0x44d525(0x19b)),console[_0x44d525(0x169)](_0x44d525(0x123)+_0x2e2dc0[_0x44d525(0x11f)]+_0x44d525(0x19b)),console[_0x44d525(0x169)](_0x44d525(0x18b)+_0x2e2dc0[_0x44d525(0x1a1)]),_0x2e2dc0;}async[a35_0x5e08cb(0x130)](){const _0x2a1fda=a35_0x5e08cb;console[_0x2a1fda(0x169)](_0x2a1fda(0x17f));const _0x2bf923=await database_1[_0x2a1fda(0x113)][_0x2a1fda(0x186)][_0x2a1fda(0x181)]({'where':{'status':_0x2a1fda(0x143)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x2a1fda(0x1d1)}});return console['log'](_0x2a1fda(0x1d9)+_0x2bf923[_0x2a1fda(0x17c)]+_0x2a1fda(0xf9)),_0x2bf923[_0x2a1fda(0x19a)](_0x3ff7f3=>({'id':_0x3ff7f3['id'],'username':_0x3ff7f3[_0x2a1fda(0x19e)],'name':_0x3ff7f3[_0x2a1fda(0x200)]}));}[a35_0x5e08cb(0x127)](_0x39fbcd){const _0x2b95cb=a35_0x5e08cb,_0x4cc3b2={'test_gateway':_0x2b95cb(0x1e5),'plisio':'Plisio','rapyd':_0x2b95cb(0x137),'noda':_0x2b95cb(0x1a9),'cointopay':_0x2b95cb(0x162),'klyme_eu':_0x2b95cb(0x16c),'klyme_gb':_0x2b95cb(0x1cc),'klyme_de':_0x2b95cb(0x180)};return _0x4cc3b2[_0x39fbcd]||_0x39fbcd;}async[a35_0x5e08cb(0x1c8)](_0x22e639){const _0x4c82e7=a35_0x5e08cb,{page:_0x559df8,limit:_0x1328bf,minAmount:_0x4570a9,search:_0x9518ab}=_0x22e639,_0x54b1f7=(_0x559df8-0x1)*_0x1328bf;console['log'](_0x4c82e7(0x171),_0x22e639);const _0x3dc55d={'balance':{'gt':0x0},'status':_0x4c82e7(0x143)};_0x4570a9&&(_0x3dc55d[_0x4c82e7(0x167)][_0x4c82e7(0x12a)]=_0x4570a9);_0x9518ab&&(_0x3dc55d['OR']=[{'name':{'contains':_0x9518ab,'mode':'insensitive'}},{'username':{'contains':_0x9518ab,'mode':_0x4c82e7(0x193)}}]);const [_0x2107d4,_0x35c83d]=await Promise[_0x4c82e7(0x10c)]([database_1[_0x4c82e7(0x113)][_0x4c82e7(0x186)][_0x4c82e7(0x181)]({'where':_0x3dc55d,'skip':_0x54b1f7,'take':_0x1328bf,'orderBy':{'balance':_0x4c82e7(0x1b6)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1['default']['shop'][_0x4c82e7(0x139)]({'where':_0x3dc55d})]);console[_0x4c82e7(0x169)]('💰\x20Found\x20'+_0x2107d4[_0x4c82e7(0x17c)]+_0x4c82e7(0x174));const _0x47ab28=await Promise['all'](_0x2107d4[_0x4c82e7(0x19a)](async _0x2bc683=>{const _0xa3cdf1=_0x4c82e7,[_0x52f773,_0xcfc4b7,_0x38ac02]=await Promise[_0xa3cdf1(0x10c)]([database_1[_0xa3cdf1(0x113)][_0xa3cdf1(0x168)][_0xa3cdf1(0x139)]({'where':{'shopId':_0x2bc683['id'],'status':'PAID','gateway':{'not':_0xa3cdf1(0xf4)}}}),database_1[_0xa3cdf1(0x113)][_0xa3cdf1(0x168)]['findFirst']({'where':{'shopId':_0x2bc683['id'],'status':_0xa3cdf1(0x14a),'gateway':{'not':'test_gateway'}},'orderBy':{'paidAt':'asc'},'select':{'paidAt':!![]}}),database_1[_0xa3cdf1(0x113)][_0xa3cdf1(0x168)][_0xa3cdf1(0x18a)]({'by':[_0xa3cdf1(0x108)],'where':{'shopId':_0x2bc683['id'],'status':'PAID','gateway':{'not':_0xa3cdf1(0xf4)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x2398aa=new Date(),_0x4bc23e=new Date(_0x2398aa[_0xa3cdf1(0x1b9)](),_0x2398aa[_0xa3cdf1(0x152)](),0x1),_0x337330=new Date(_0x2398aa[_0xa3cdf1(0x1b9)](),_0x2398aa[_0xa3cdf1(0x152)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x121cd0,_0x2bcca9]=await Promise[_0xa3cdf1(0x10c)]([database_1[_0xa3cdf1(0x113)][_0xa3cdf1(0x15f)]['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x2bc683['id'],'status':_0xa3cdf1(0x1e1)}}),database_1[_0xa3cdf1(0x113)][_0xa3cdf1(0x15f)][_0xa3cdf1(0x1df)]({'_sum':{'amount':!![]},'where':{'shopId':_0x2bc683['id'],'status':_0xa3cdf1(0x1e1),'createdAt':{'gte':_0x4bc23e,'lte':_0x337330}}})]),_0x2bd962=_0x121cd0[_0xa3cdf1(0x102)][_0xa3cdf1(0x199)]||0x0,_0x5e6fab=_0x2bcca9[_0xa3cdf1(0x102)][_0xa3cdf1(0x199)]||0x0,_0x2e4c44=await Promise[_0xa3cdf1(0x10c)](_0x38ac02['map'](async _0x102ad5=>{const _0x2f8bd6=_0xa3cdf1;let _0x17b689=0xa;if(_0x2bc683[_0x2f8bd6(0x1f5)])try{const _0x11fb6e=JSON[_0x2f8bd6(0x1c0)](_0x2bc683[_0x2f8bd6(0x1f5)]);for(const [_0xa5e038,_0x5574a9]of Object[_0x2f8bd6(0x17e)](_0x11fb6e)){if(_0xa5e038[_0x2f8bd6(0x1cf)]()===_0x102ad5['gateway'][_0x2f8bd6(0x1cf)]()){_0x17b689=_0x5574a9[_0x2f8bd6(0x1a3)]||0xa,console[_0x2f8bd6(0x169)](_0x2f8bd6(0x122)+_0x102ad5[_0x2f8bd6(0x108)]+_0x2f8bd6(0x195)+_0x2bc683['id']+':\x20commission\x20=\x20'+_0x17b689+'%');break;}}}catch(_0x22f32c){console['error']('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x2bc683['id']+':',_0x22f32c);}const _0x27e50e=_0x102ad5[_0x2f8bd6(0x102)][_0x2f8bd6(0x1bd)]||0x0,_0x36e3d7=_0x27e50e*(0x1-_0x17b689/0x64);return{'gateway':_0x102ad5[_0x2f8bd6(0x108)],'count':_0x102ad5['_count']['id'],'amountUSDT':Math[_0x2f8bd6(0x138)](_0x27e50e*0x64)/0x64,'amountAfterCommissionUSDT':Math['round'](_0x36e3d7*0x64)/0x64,'commission':_0x17b689};})),_0x24bdf4=_0x2e4c44['reduce']((_0x3aab5a,_0xd82a16)=>_0x3aab5a+_0xd82a16[_0xa3cdf1(0x1bd)],0x0),_0x159df0=_0x2bc683[_0xa3cdf1(0x167)];return console[_0xa3cdf1(0x169)](_0xa3cdf1(0x198)+_0x2bc683[_0xa3cdf1(0x19e)]+':'),console[_0xa3cdf1(0x169)](_0xa3cdf1(0x106)+_0x24bdf4[_0xa3cdf1(0x160)](0x2)+_0xa3cdf1(0x131)),console[_0xa3cdf1(0x169)]('\x20\x20\x20🔍\x20Calculated\x20after\x20commission:\x20'+_0x2e4c44[_0xa3cdf1(0x133)]((_0x36f157,_0x365bb1)=>_0x36f157+_0x365bb1[_0xa3cdf1(0x192)],0x0)[_0xa3cdf1(0x160)](0x2)+'\x20USDT\x20(theoretical\x20net)'),console[_0xa3cdf1(0x169)](_0xa3cdf1(0x14e)+_0x159df0[_0xa3cdf1(0x160)](0x2)+_0xa3cdf1(0x1a6)),{'id':_0x2bc683['id'],'fullName':_0x2bc683[_0xa3cdf1(0x200)],'username':_0x2bc683[_0xa3cdf1(0x19e)],'telegramId':_0x2bc683[_0xa3cdf1(0x163)],'merchantUrl':_0x2bc683[_0xa3cdf1(0x1d3)],'wallets':{'usdtPolygonWallet':_0x2bc683[_0xa3cdf1(0x16a)],'usdtTrcWallet':_0x2bc683[_0xa3cdf1(0x1d7)],'usdtErcWallet':_0x2bc683['usdtErcWallet'],'usdcPolygonWallet':_0x2bc683['usdcPolygonWallet']},'totalAmountUSDT':Math[_0xa3cdf1(0x138)](_0x24bdf4*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0xa3cdf1(0x138)](_0x159df0*0x64)/0x64,'totalPayout':Math[_0xa3cdf1(0x138)](_0x2bd962*0x64)/0x64,'thisMonth':Math[_0xa3cdf1(0x138)](_0x5e6fab*0x64)/0x64,'paymentsCount':_0x52f773,'oldestPaymentDate':_0xcfc4b7?.[_0xa3cdf1(0x11a)]||_0x2bc683[_0xa3cdf1(0x146)],'gatewayBreakdown':_0x2e4c44};})),_0x2ebd02=_0x47ab28['reduce']((_0x5a71f7,_0x5f54e0)=>_0x5a71f7+_0x5f54e0[_0x4c82e7(0x1dd)],0x0),_0x3f90fd=_0x47ab28[_0x4c82e7(0x133)]((_0x5512ad,_0xe2254a)=>_0x5512ad+_0xe2254a[_0x4c82e7(0x13b)],0x0),_0x173106=_0x47ab28[_0x4c82e7(0x133)]((_0x582c72,_0x37b8a1)=>_0x582c72+_0x37b8a1[_0x4c82e7(0x1aa)],0x0),_0x420e90=_0x47ab28['reduce']((_0x5b489f,_0x132095)=>_0x5b489f+_0x132095[_0x4c82e7(0x15d)],0x0);return console[_0x4c82e7(0x169)](_0x4c82e7(0x14b)+_0x35c83d+'\x20merchants'),console[_0x4c82e7(0x169)](_0x4c82e7(0x15b)+Math[_0x4c82e7(0x138)](_0x2ebd02*0x64)/0x64+_0x4c82e7(0x131)),console['log']('\x20\x20\x20✅\x20Total\x20available\x20for\x20payout:\x20'+Math['round'](_0x3f90fd*0x64)/0x64+'\x20USDT\x20(actual\x20balances)'),console[_0x4c82e7(0x169)](_0x4c82e7(0x149)+Math[_0x4c82e7(0x138)](_0x173106*0x64)/0x64+_0x4c82e7(0x19b)),console[_0x4c82e7(0x169)](_0x4c82e7(0x107)+Math[_0x4c82e7(0x138)](_0x420e90*0x64)/0x64+_0x4c82e7(0x19b)),{'merchants':_0x47ab28,'pagination':{'page':_0x559df8,'limit':_0x1328bf,'total':_0x35c83d,'totalPages':Math[_0x4c82e7(0x208)](_0x35c83d/_0x1328bf)},'summary':{'totalMerchants':_0x35c83d,'totalAmountUSDT':Math[_0x4c82e7(0x138)](_0x2ebd02*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x4c82e7(0x138)](_0x3f90fd*0x64)/0x64,'totalPayout':Math[_0x4c82e7(0x138)](_0x173106*0x64)/0x64,'thisMonth':Math[_0x4c82e7(0x138)](_0x420e90*0x64)/0x64}};}async['createPayout'](_0xad90b9){const _0x1fcda1=a35_0x5e08cb,{shopId:_0x26a2e0,amount:_0x3d1a16,network:_0x1d81d9,wallet:_0x905018,notes:_0x4840d1,txid:_0x5693ec,periodFrom:_0x552352,periodTo:_0xd1cecc}=_0xad90b9,_0x3a3114=await database_1['default'][_0x1fcda1(0x20c)](async _0x1211c6=>{const _0x567cf9=_0x1fcda1,_0x1b4b62=await _0x1211c6[_0x567cf9(0x186)][_0x567cf9(0x135)]({'where':{'id':_0x26a2e0},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x1b4b62)throw new Error(_0x567cf9(0x16b));console[_0x567cf9(0x169)]('💰\x20Creating\x20payout\x20for\x20shop\x20'+_0x1b4b62['username']+':'),console[_0x567cf9(0x169)]('\x20\x20\x20Current\x20balance:\x20'+_0x1b4b62[_0x567cf9(0x167)][_0x567cf9(0x160)](0x6)+'\x20USDT'),console[_0x567cf9(0x169)](_0x567cf9(0x170)+_0x3d1a16[_0x567cf9(0x160)](0x6)+_0x567cf9(0x19b)),console[_0x567cf9(0x169)](_0x567cf9(0x142)+_0x1b4b62['totalPaidOut']['toFixed'](0x6)+_0x567cf9(0x19b));if(_0x5693ec)console[_0x567cf9(0x169)]('\x20\x20\x20Transaction\x20hash:\x20'+_0x5693ec);if(_0x1b4b62[_0x567cf9(0x167)]<_0x3d1a16)throw new Error(_0x567cf9(0x1e7)+_0x1b4b62[_0x567cf9(0x167)][_0x567cf9(0x160)](0x6)+_0x567cf9(0x116)+_0x3d1a16['toFixed'](0x6)+_0x567cf9(0x19b));let _0x58ac49=_0x905018;if(!_0x58ac49){const _0x21aef4=await _0x1211c6[_0x567cf9(0x186)]['findUnique']({'where':{'id':_0x26a2e0},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x21aef4)switch(_0x1d81d9){case _0x567cf9(0x209):_0x58ac49=_0x21aef4[_0x567cf9(0x16a)]||undefined;break;case _0x567cf9(0x183):_0x58ac49=_0x21aef4[_0x567cf9(0x1d7)]||undefined;break;case _0x567cf9(0x20a):_0x58ac49=_0x21aef4['usdtErcWallet']||undefined;break;case _0x567cf9(0x14d):_0x58ac49=_0x21aef4['usdcPolygonWallet']||undefined;break;}}console[_0x567cf9(0x169)](_0x567cf9(0x1c7)+_0x1d81d9+':\x20'+(_0x58ac49||_0x567cf9(0x151)));const _0x1da6b4=await _0x1211c6[_0x567cf9(0x15f)][_0x567cf9(0x19c)]({'data':{'shopId':_0x26a2e0,'amount':_0x3d1a16,'network':_0x1d81d9,'status':_0x567cf9(0x1e1),'txid':_0x5693ec,'notes':_0x4840d1,'periodFrom':_0x552352?new Date(_0x552352):null,'periodTo':_0xd1cecc?new Date(_0xd1cecc):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x28e8f6=_0x1b4b62[_0x567cf9(0x167)]-_0x3d1a16,_0x5be00f=_0x1b4b62['totalPaidOut']+_0x3d1a16;return await _0x1211c6[_0x567cf9(0x186)][_0x567cf9(0x136)]({'where':{'id':_0x26a2e0},'data':{'balance':_0x28e8f6,'totalPaidOut':_0x5be00f}}),console[_0x567cf9(0x169)](_0x567cf9(0x1e6)+_0x1b4b62[_0x567cf9(0x19e)]+'\x20balance\x20updated:'),console[_0x567cf9(0x169)](_0x567cf9(0x13c)+_0x1b4b62['balance'][_0x567cf9(0x160)](0x6)+_0x567cf9(0x132)+_0x28e8f6[_0x567cf9(0x160)](0x6)+'\x20USDT\x20(-'+_0x3d1a16[_0x567cf9(0x160)](0x6)+')'),console['log']('\x20\x20\x20Total\x20paid\x20out:\x20'+_0x1b4b62[_0x567cf9(0xfb)][_0x567cf9(0x160)](0x6)+_0x567cf9(0x132)+_0x5be00f[_0x567cf9(0x160)](0x6)+'\x20USDT\x20(+'+_0x3d1a16['toFixed'](0x6)+')'),{'payout':_0x1da6b4,'shop':_0x1b4b62};});return console[_0x1fcda1(0x169)](_0x1fcda1(0x1b3)+_0x3a3114['payout']['id']+_0x1fcda1(0x195)+_0x3a3114['shop'][_0x1fcda1(0x19e)]+'\x20('+_0x3d1a16+'\x20USDT)'),{'id':_0x3a3114[_0x1fcda1(0x15f)]['id'],'shopId':_0x3a3114[_0x1fcda1(0x15f)][_0x1fcda1(0x165)],'shopName':_0x3a3114['shop']['name'],'shopUsername':_0x3a3114[_0x1fcda1(0x186)][_0x1fcda1(0x19e)],'amount':_0x3a3114['payout'][_0x1fcda1(0x199)],'network':_0x3a3114['payout'][_0x1fcda1(0x1ce)],'status':_0x3a3114[_0x1fcda1(0x15f)]['status'],'txid':_0x3a3114['payout']['txid'],'notes':_0x3a3114[_0x1fcda1(0x15f)]['notes'],'periodFrom':_0x3a3114[_0x1fcda1(0x15f)][_0x1fcda1(0x179)],'periodTo':_0x3a3114['payout']['periodTo'],'createdAt':_0x3a3114[_0x1fcda1(0x15f)][_0x1fcda1(0x146)],'paidAt':_0x3a3114[_0x1fcda1(0x15f)][_0x1fcda1(0x11a)]};}async['getAllPayouts'](_0x239680){const _0x504ea5=a35_0x5e08cb,{page:_0x18b413,limit:_0x4ea958,shopId:_0x46e8a0,network:_0x356267,dateFrom:_0x559321,dateTo:_0x554e49,search:_0x27f55a}=_0x239680,_0x51e9ec=(_0x18b413-0x1)*_0x4ea958,_0x1c91ed={};_0x46e8a0&&(_0x1c91ed[_0x504ea5(0x165)]=_0x46e8a0);_0x356267&&(_0x1c91ed[_0x504ea5(0x1ce)]=_0x356267);(_0x559321||_0x554e49)&&(_0x1c91ed['createdAt']={},_0x559321&&(_0x1c91ed[_0x504ea5(0x146)][_0x504ea5(0x12a)]=new Date(_0x559321)),_0x554e49&&(_0x1c91ed['createdAt'][_0x504ea5(0x17b)]=new Date(_0x554e49)));_0x27f55a&&(_0x1c91ed['OR']=[{'shop':{'name':{'contains':_0x27f55a,'mode':_0x504ea5(0x193)}}},{'shop':{'username':{'contains':_0x27f55a,'mode':_0x504ea5(0x193)}}},{'notes':{'contains':_0x27f55a,'mode':'insensitive'}}]);const [_0x21e8a8,_0x388329]=await Promise[_0x504ea5(0x10c)]([database_1['default']['payout']['findMany']({'where':_0x1c91ed,'skip':_0x51e9ec,'take':_0x4ea958,'orderBy':{'createdAt':_0x504ea5(0x1b6)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x504ea5(0x113)][_0x504ea5(0x15f)][_0x504ea5(0x139)]({'where':_0x1c91ed})]);return{'payouts':_0x21e8a8['map'](_0x19b4be=>({'id':_0x19b4be['id'],'shopId':_0x19b4be[_0x504ea5(0x165)],'shopName':_0x19b4be[_0x504ea5(0x186)]['name'],'shopUsername':_0x19b4be[_0x504ea5(0x186)]['username'],'amount':_0x19b4be['amount'],'network':_0x19b4be[_0x504ea5(0x1ce)],'status':_0x19b4be[_0x504ea5(0x1c3)],'txid':_0x19b4be[_0x504ea5(0x1c6)],'notes':_0x19b4be[_0x504ea5(0x148)],'periodFrom':_0x19b4be['periodFrom'],'periodTo':_0x19b4be[_0x504ea5(0x153)],'createdAt':_0x19b4be[_0x504ea5(0x146)],'paidAt':_0x19b4be['paidAt']})),'pagination':{'page':_0x18b413,'limit':_0x4ea958,'total':_0x388329,'totalPages':Math[_0x504ea5(0x208)](_0x388329/_0x4ea958)}};}async['getPayoutById'](_0x2e36d2){const _0x20fe0a=a35_0x5e08cb,_0x4ebb17=await database_1[_0x20fe0a(0x113)][_0x20fe0a(0x15f)][_0x20fe0a(0x135)]({'where':{'id':_0x2e36d2},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x4ebb17)return null;return{'id':_0x4ebb17['id'],'shopId':_0x4ebb17[_0x20fe0a(0x165)],'shopName':_0x4ebb17[_0x20fe0a(0x186)][_0x20fe0a(0x200)],'shopUsername':_0x4ebb17['shop']['username'],'amount':_0x4ebb17[_0x20fe0a(0x199)],'network':_0x4ebb17[_0x20fe0a(0x1ce)],'status':_0x4ebb17[_0x20fe0a(0x1c3)],'txid':_0x4ebb17[_0x20fe0a(0x1c6)],'notes':_0x4ebb17[_0x20fe0a(0x148)],'periodFrom':_0x4ebb17[_0x20fe0a(0x179)],'periodTo':_0x4ebb17[_0x20fe0a(0x153)],'createdAt':_0x4ebb17[_0x20fe0a(0x146)],'paidAt':_0x4ebb17[_0x20fe0a(0x11a)]};}async[a35_0x5e08cb(0x1e8)](_0x494f5){const _0x5d3ab1=a35_0x5e08cb;await database_1[_0x5d3ab1(0x113)]['payout']['delete']({'where':{'id':_0x494f5}});}async['getAllPayments'](_0x118093){const _0x754873=a35_0x5e08cb,{page:_0x5e444c,limit:_0x370513,status:_0x500fb6,gateway:_0x7e5dad,shopId:_0xae44bb,dateFrom:_0x2d63f4,dateTo:_0x579a74,search:_0x3f96f0,currency:_0x50d08f,sortBy:_0x47be76,sortOrder:_0x45d798}=_0x118093,_0x480340=(_0x5e444c-0x1)*_0x370513;console['log'](_0x754873(0x159),_0x118093);const _0x271ad1=await database_1['default']['payment']['groupBy']({'by':['gateway'],'_count':{'gateway':!![]}});console[_0x754873(0x169)](_0x754873(0x1f8),_0x271ad1['map'](_0x690f16=>_0x690f16['gateway']+'\x20('+_0x690f16[_0x754873(0x20b)][_0x754873(0x108)]+'\x20payments)'));if(_0x7e5dad){const _0xb33ad9=_0x271ad1[_0x754873(0x1cd)](_0x3401ec=>_0x3401ec[_0x754873(0x108)][_0x754873(0x1cf)]()===_0x7e5dad[_0x754873(0x1cf)]());!_0xb33ad9&&_0x7e5dad['toLowerCase']()!==_0x754873(0xf4)&&console[_0x754873(0x169)](_0x754873(0x12d)+_0x7e5dad+_0x754873(0x10f)+_0x271ad1[_0x754873(0x19a)](_0x29c462=>_0x29c462[_0x754873(0x108)])['join'](',\x20'));}const _0x1abd71={};_0x500fb6&&(_0x1abd71[_0x754873(0x1c3)]=_0x500fb6['toUpperCase']());if(!_0x7e5dad)_0x1abd71[_0x754873(0x108)]={'not':_0x754873(0xf4)};else{if(_0x7e5dad&&(_0x7e5dad[_0x754873(0x1cf)]()===_0x754873(0xf4)||_0x7e5dad===_0x754873(0x1ba)))_0x1abd71[_0x754873(0x108)]=_0x754873(0xf4);else{let _0x4cd192=_0x7e5dad;const _0x32286e=(0x0,gateway_1[_0x754873(0x1cb)])(_0x7e5dad);if(_0x32286e)_0x4cd192=_0x32286e,console[_0x754873(0x169)](_0x754873(0x104)+_0x7e5dad+_0x754873(0x1a8)+_0x4cd192+'\x27');else{const _0x34a0f9=(0x0,gateway_1[_0x754873(0x1f1)])(_0x7e5dad);if(_0x34a0f9){const _0x547980=(0x0,gateway_1[_0x754873(0x1cb)])(_0x34a0f9);_0x547980&&(_0x4cd192=_0x547980,console[_0x754873(0x169)]('🔄\x20Converted\x20gateway\x20name\x20\x27'+_0x7e5dad+_0x754873(0x1fc)+_0x34a0f9+_0x754873(0x1f6)+_0x4cd192+'\x27'));}else console['log'](_0x754873(0x184)+_0x7e5dad+'\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)');}const _0x3dbb02=await database_1[_0x754873(0x113)][_0x754873(0x168)][_0x754873(0x139)]({'where':{'gateway':_0x4cd192[_0x754873(0x1cf)]()},'take':0x1});_0x3dbb02===0x0?(console[_0x754873(0x169)](_0x754873(0x176)+_0x4cd192+_0x754873(0x1a0)+_0x7e5dad+_0x754873(0x1ec)),_0x1abd71[_0x754873(0x108)]=_0x754873(0x1c5)):(_0x1abd71['gateway']=_0x4cd192[_0x754873(0x1cf)](),console[_0x754873(0x169)](_0x754873(0x1ae)+_0x4cd192+_0x754873(0x1a0)+_0x7e5dad+'\x27)'));}}console[_0x754873(0x169)](_0x754873(0x1de),_0x1abd71['gateway']);_0xae44bb&&(_0x1abd71['shopId']=_0xae44bb);_0x50d08f&&(_0x1abd71[_0x754873(0x173)]=_0x50d08f[_0x754873(0x125)](),console[_0x754873(0x169)](_0x754873(0x10e)+_0x50d08f[_0x754873(0x125)]()));(_0x2d63f4||_0x579a74)&&(_0x1abd71[_0x754873(0x146)]={},_0x2d63f4&&(_0x1abd71[_0x754873(0x146)][_0x754873(0x12a)]=new Date(_0x2d63f4)),_0x579a74&&(_0x1abd71[_0x754873(0x146)]['lte']=new Date(_0x579a74)));_0x3f96f0&&(_0x1abd71['OR']=[{'id':{'contains':_0x3f96f0,'mode':_0x754873(0x193)}},{'orderId':{'contains':_0x3f96f0,'mode':_0x754873(0x193)}},{'gatewayOrderId':{'contains':_0x3f96f0,'mode':'insensitive'}},{'customerEmail':{'contains':_0x3f96f0,'mode':_0x754873(0x193)}},{'shop':{'name':{'contains':_0x3f96f0,'mode':_0x754873(0x193)}}},{'shop':{'username':{'contains':_0x3f96f0,'mode':'insensitive'}}}]);console['log'](_0x754873(0x1f2),JSON[_0x754873(0x141)](_0x1abd71,null,0x2));let _0x372714={'createdAt':_0x754873(0x1b6)};if(_0x47be76){const _0x5b5fc8=[_0x754873(0x199),_0x754873(0x146),'updatedAt',_0x754873(0x1c3),_0x754873(0x108),_0x754873(0x173)],_0x46204f=[_0x754873(0x1d1),_0x754873(0x1b6)];if(_0x5b5fc8[_0x754873(0x205)](_0x47be76)){const _0x550ed5=_0x46204f[_0x754873(0x205)](_0x45d798)?_0x45d798:_0x754873(0x1b6);_0x372714={[_0x47be76]:_0x550ed5},console[_0x754873(0x169)](_0x754873(0x1ef)+_0x47be76+'\x20in\x20'+_0x550ed5+_0x754873(0x1be));}}const [_0x19a6af,_0x5d8c87]=await Promise['all']([database_1[_0x754873(0x113)][_0x754873(0x168)][_0x754873(0x181)]({'where':_0x1abd71,'skip':_0x480340,'take':_0x370513,'orderBy':_0x372714,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x754873(0x113)][_0x754873(0x168)]['count']({'where':_0x1abd71})]);return{'payments':_0x19a6af,'pagination':{'page':_0x5e444c,'limit':_0x370513,'total':_0x5d8c87,'totalPages':Math[_0x754873(0x208)](_0x5d8c87/_0x370513)}};}async['getPaymentById'](_0x111083){const _0x95279b=a35_0x5e08cb,_0x3647fa=await database_1['default']['payment'][_0x95279b(0x135)]({'where':{'id':_0x111083},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x3647fa)return null;return{'id':_0x3647fa['id'],'shopId':_0x3647fa[_0x95279b(0x165)],'gateway':_0x3647fa[_0x95279b(0x108)],'amount':_0x3647fa[_0x95279b(0x199)],'currency':_0x3647fa[_0x95279b(0x173)],'status':_0x3647fa['status'],'orderId':_0x3647fa[_0x95279b(0x1bf)],'gatewayOrderId':_0x3647fa['gatewayOrderId'],'customerEmail':_0x3647fa[_0x95279b(0x1bc)],'customerName':_0x3647fa[_0x95279b(0x147)],'customerCountry':_0x3647fa[_0x95279b(0x1af)],'customerIp':_0x3647fa[_0x95279b(0x19f)],'customerUa':_0x3647fa[_0x95279b(0x189)],'failureMessage':_0x3647fa['failureMessage'],'externalPaymentUrl':_0x3647fa[_0x95279b(0x187)],'successUrl':_0x3647fa[_0x95279b(0x1d2)],'failUrl':_0x3647fa[_0x95279b(0x100)],'pendingUrl':_0x3647fa[_0x95279b(0x101)],'whiteUrl':_0x3647fa[_0x95279b(0x1f4)],'createdAt':_0x3647fa[_0x95279b(0x146)],'updatedAt':_0x3647fa['updatedAt'],'shop':_0x3647fa['shop']};}async[a35_0x5e08cb(0x114)](_0x1ee949,_0x2f9816,_0x10bd45,_0x2baaa4){const _0x48c468=a35_0x5e08cb,_0x3a4b03=await database_1[_0x48c468(0x113)][_0x48c468(0x20c)](async _0x52259f=>{const _0x547930=_0x48c468,_0x399f28=await _0x52259f[_0x547930(0x168)][_0x547930(0x135)]({'where':{'id':_0x1ee949},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x399f28)throw new Error(_0x547930(0x121));const _0x44f84b=_0x399f28[_0x547930(0x1c3)],_0x326ec7=_0x2f9816[_0x547930(0x125)]();console[_0x547930(0x169)](_0x547930(0x203)+_0x1ee949+_0x547930(0x157)+_0x44f84b+_0x547930(0x132)+_0x326ec7),console[_0x547930(0x169)](_0x547930(0x1ea)+_0x399f28[_0x547930(0x186)]['balance']+_0x547930(0x19b));const _0x4cdfda={'status':_0x326ec7,'updatedAt':new Date(),'statusChangedBy':_0x547930(0x13f),'statusChangedAt':new Date()};_0x10bd45&&(_0x4cdfda['adminNotes']=_0x10bd45);_0x326ec7===_0x547930(0x112)&&_0x2baaa4&&(_0x4cdfda[_0x547930(0x1ee)]=_0x2baaa4);let _0x1453a2=0x0,_0x10fcab=_0x399f28[_0x547930(0x186)][_0x547930(0x167)];if(_0x326ec7===_0x547930(0x14a)&&_0x44f84b!==_0x547930(0x14a)){_0x4cdfda[_0x547930(0x11a)]=new Date();const _0x50aa9a=await currencyService_1[_0x547930(0x1db)]['convertToUSDT'](_0x399f28[_0x547930(0x199)],_0x399f28[_0x547930(0x173)]);_0x4cdfda['amountUSDT']=_0x50aa9a;let _0x3af195=0xa;const _0x558bee=await _0x52259f[_0x547930(0x186)][_0x547930(0x135)]({'where':{'id':_0x399f28[_0x547930(0x165)]},'select':{'gatewaySettings':!![]}});if(_0x558bee?.['gatewaySettings'])try{const _0x4b0665=JSON['parse'](_0x558bee['gatewaySettings']);for(const [_0x771d25,_0x11dec5]of Object[_0x547930(0x17e)](_0x4b0665)){if(_0x771d25[_0x547930(0x1cf)]()===_0x399f28['gateway']['toLowerCase']()){_0x3af195=_0x11dec5['commission']||0xa;break;}}}catch(_0x12ac4d){console[_0x547930(0x1da)](_0x547930(0x103)+_0x1ee949+':',_0x12ac4d);}const _0x58c800=_0x50aa9a*(0x1-_0x3af195/0x64);_0x1453a2=_0x58c800,_0x10fcab+=_0x58c800,console[_0x547930(0x169)](_0x547930(0x1e2)+_0x1ee949+_0x547930(0x1fa)),console['log']('\x20\x20\x20Full\x20amount:\x20'+_0x50aa9a[_0x547930(0x160)](0x6)+'\x20USDT'),console[_0x547930(0x169)](_0x547930(0x124)+_0x399f28[_0x547930(0x108)]+_0x547930(0x1b4)+_0x3af195+'%'),console[_0x547930(0x169)](_0x547930(0x1c2)+_0x58c800[_0x547930(0x160)](0x6)+_0x547930(0x1fd)+_0x3af195+'%\x20commission)'),console[_0x547930(0x169)](_0x547930(0x1ff)+_0x58c800['toFixed'](0x6)+_0x547930(0x19b));}else{if(_0x44f84b===_0x547930(0x14a)&&_0x326ec7!==_0x547930(0x14a)){if(_0x399f28[_0x547930(0x1bd)]){let _0x899595=0xa;const _0x5ba834=await _0x52259f[_0x547930(0x186)][_0x547930(0x135)]({'where':{'id':_0x399f28['shopId']},'select':{'gatewaySettings':!![]}});if(_0x5ba834?.[_0x547930(0x1f5)])try{const _0x2ae233=JSON[_0x547930(0x1c0)](_0x5ba834['gatewaySettings']);for(const [_0x2f2745,_0x4b62d8]of Object[_0x547930(0x17e)](_0x2ae233)){if(_0x2f2745[_0x547930(0x1cf)]()===_0x399f28[_0x547930(0x108)]['toLowerCase']()){_0x899595=_0x4b62d8[_0x547930(0x1a3)]||0xa;break;}}}catch(_0x344476){console[_0x547930(0x1da)](_0x547930(0x103)+_0x1ee949+':',_0x344476);}const _0x534e69=_0x399f28[_0x547930(0x1bd)]*(0x1-_0x899595/0x64);_0x1453a2=-_0x534e69,_0x10fcab-=_0x534e69,_0x4cdfda[_0x547930(0x1bd)]=null,console['log'](_0x547930(0x1e2)+_0x1ee949+'\x20no\x20longer\x20PAID:'),console[_0x547930(0x169)](_0x547930(0x1a2)+_0x399f28[_0x547930(0x1bd)]['toFixed'](0x6)+'\x20USDT'),console[_0x547930(0x169)](_0x547930(0x124)+_0x399f28[_0x547930(0x108)]+_0x547930(0x1b4)+_0x899595+'%'),console[_0x547930(0x169)](_0x547930(0x196)+_0x534e69[_0x547930(0x160)](0x6)+'\x20USDT\x20(after\x20'+_0x899595+'%\x20commission)'),console['log']('\x20\x20\x20Subtracted\x20from\x20balance:\x20-'+_0x534e69[_0x547930(0x160)](0x6)+_0x547930(0x19b));}}}_0x326ec7===_0x547930(0x112)&&(_0x44f84b===_0x547930(0x14a)&&_0x399f28['amountUSDT']&&console[_0x547930(0x169)](_0x547930(0x207)),_0x2baaa4&&_0x2baaa4>0x0&&(_0x1453a2-=_0x2baaa4,_0x10fcab-=_0x2baaa4,console[_0x547930(0x169)](_0x547930(0x18d)+_0x2baaa4['toFixed'](0x6)+_0x547930(0x1a5))));_0x326ec7==='REFUND'&&_0x44f84b===_0x547930(0x14a)&&console['log'](_0x547930(0x144));const _0x345fac=await _0x52259f['payment'][_0x547930(0x136)]({'where':{'id':_0x1ee949},'data':_0x4cdfda,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x1453a2!==0x0&&(await _0x52259f[_0x547930(0x186)]['update']({'where':{'id':_0x399f28['shopId']},'data':{'balance':_0x10fcab}}),console[_0x547930(0x169)]('💰\x20Shop\x20'+_0x399f28[_0x547930(0x165)]+_0x547930(0x201)+_0x399f28['shop']['balance']['toFixed'](0x6)+'\x20->\x20'+_0x10fcab[_0x547930(0x160)](0x6)+_0x547930(0x10b)+(_0x1453a2>0x0?'+':'')+_0x1453a2[_0x547930(0x160)](0x6)+')')),_0x345fac;});return{'id':_0x3a4b03['id'],'shopId':_0x3a4b03[_0x48c468(0x165)],'gateway':_0x3a4b03[_0x48c468(0x108)],'amount':_0x3a4b03['amount'],'currency':_0x3a4b03[_0x48c468(0x173)],'status':_0x3a4b03[_0x48c468(0x1c3)],'orderId':_0x3a4b03[_0x48c468(0x1bf)],'gatewayOrderId':_0x3a4b03['gatewayOrderId'],'customerEmail':_0x3a4b03[_0x48c468(0x1bc)],'customerName':_0x3a4b03[_0x48c468(0x147)],'customerCountry':_0x3a4b03['customerCountry'],'customerIp':_0x3a4b03[_0x48c468(0x19f)],'customerUa':_0x3a4b03[_0x48c468(0x189)],'failureMessage':_0x3a4b03['failureMessage'],'adminNotes':_0x3a4b03[_0x48c468(0x109)],'chargebackAmount':_0x3a4b03['chargebackAmount'],'statusChangedBy':_0x3a4b03['statusChangedBy'],'statusChangedAt':_0x3a4b03['statusChangedAt'],'createdAt':_0x3a4b03[_0x48c468(0x146)],'updatedAt':_0x3a4b03[_0x48c468(0x1b8)],'shop':_0x3a4b03[_0x48c468(0x186)]};}async[a35_0x5e08cb(0x11c)](_0x4d98f3,_0x4ddbfc){const _0x1fdd8a=a35_0x5e08cb,_0x571e75={..._0x4ddbfc};_0x4ddbfc[_0x1fdd8a(0x13d)]&&(_0x571e75[_0x1fdd8a(0x13d)]=await bcryptjs_1['default']['hash'](_0x4ddbfc[_0x1fdd8a(0x13d)],0xc));_0x4ddbfc[_0x1fdd8a(0x1eb)]&&(_0x571e75[_0x1fdd8a(0x200)]=_0x4ddbfc[_0x1fdd8a(0x1eb)],delete _0x571e75[_0x1fdd8a(0x1eb)]);_0x4ddbfc[_0x1fdd8a(0x17a)]&&(_0x571e75[_0x1fdd8a(0x163)]=_0x4ddbfc[_0x1fdd8a(0x17a)],delete _0x571e75[_0x1fdd8a(0x17a)]);_0x4ddbfc[_0x1fdd8a(0x128)]&&(_0x571e75[_0x1fdd8a(0x1d3)]=_0x4ddbfc[_0x1fdd8a(0x128)],delete _0x571e75['merchantUrl']);_0x4ddbfc['gateways']&&(_0x571e75['paymentGateways']=JSON[_0x1fdd8a(0x141)](_0x4ddbfc[_0x1fdd8a(0x16e)]),delete _0x571e75[_0x1fdd8a(0x16e)]);_0x4ddbfc[_0x1fdd8a(0x1f5)]&&(_0x571e75[_0x1fdd8a(0x1f5)]=JSON['stringify'](_0x4ddbfc[_0x1fdd8a(0x1f5)]),delete _0x571e75['gatewaySettings']);_0x4ddbfc[_0x1fdd8a(0x14c)]&&(_0x4ddbfc[_0x1fdd8a(0x14c)][_0x1fdd8a(0x16a)]!==undefined&&(_0x571e75[_0x1fdd8a(0x16a)]=_0x4ddbfc['wallets']['usdtPolygonWallet']||null),_0x4ddbfc[_0x1fdd8a(0x14c)][_0x1fdd8a(0x1d7)]!==undefined&&(_0x571e75[_0x1fdd8a(0x1d7)]=_0x4ddbfc['wallets']['usdtTrcWallet']||null),_0x4ddbfc[_0x1fdd8a(0x14c)][_0x1fdd8a(0x14f)]!==undefined&&(_0x571e75[_0x1fdd8a(0x14f)]=_0x4ddbfc[_0x1fdd8a(0x14c)][_0x1fdd8a(0x14f)]||null),_0x4ddbfc[_0x1fdd8a(0x14c)]['usdcPolygonWallet']!==undefined&&(_0x571e75['usdcPolygonWallet']=_0x4ddbfc['wallets'][_0x1fdd8a(0x172)]||null),delete _0x571e75[_0x1fdd8a(0x14c)]);const _0x5a91de=await database_1[_0x1fdd8a(0x113)]['shop'][_0x1fdd8a(0x136)]({'where':{'id':_0x4d98f3},'data':_0x571e75,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x5a91de['id'],'fullName':_0x5a91de[_0x1fdd8a(0x200)],'username':_0x5a91de[_0x1fdd8a(0x19e)],'telegramId':_0x5a91de[_0x1fdd8a(0x163)],'merchantUrl':_0x5a91de[_0x1fdd8a(0x1d3)],'gateways':_0x5a91de['paymentGateways']?JSON[_0x1fdd8a(0x1c0)](_0x5a91de[_0x1fdd8a(0xfc)]):null,'gatewaySettings':_0x5a91de[_0x1fdd8a(0x1f5)]?JSON[_0x1fdd8a(0x1c0)](_0x5a91de[_0x1fdd8a(0x1f5)]):null,'publicKey':_0x5a91de[_0x1fdd8a(0x150)],'wallets':{'usdtPolygonWallet':_0x5a91de['usdtPolygonWallet'],'usdtTrcWallet':_0x5a91de[_0x1fdd8a(0x1d7)],'usdtErcWallet':_0x5a91de[_0x1fdd8a(0x14f)],'usdcPolygonWallet':_0x5a91de[_0x1fdd8a(0x172)]},'status':_0x5a91de[_0x1fdd8a(0x1c3)],'createdAt':_0x5a91de['createdAt']};}async[a35_0x5e08cb(0x1b7)](_0xd01c0b){const _0x23fbd1=a35_0x5e08cb,_0x9991dd=await database_1['default']['shop']['update']({'where':{'id':_0xd01c0b},'data':{'status':'SUSPENDED'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x9991dd['id'],'fullName':_0x9991dd['name'],'username':_0x9991dd[_0x23fbd1(0x19e)],'telegramId':_0x9991dd['telegram'],'merchantUrl':_0x9991dd[_0x23fbd1(0x1d3)],'gateways':_0x9991dd[_0x23fbd1(0xfc)]?JSON[_0x23fbd1(0x1c0)](_0x9991dd[_0x23fbd1(0xfc)]):null,'gatewaySettings':_0x9991dd[_0x23fbd1(0x1f5)]?JSON[_0x23fbd1(0x1c0)](_0x9991dd['gatewaySettings']):null,'publicKey':_0x9991dd['publicKey'],'wallets':{'usdtPolygonWallet':_0x9991dd[_0x23fbd1(0x16a)],'usdtTrcWallet':_0x9991dd[_0x23fbd1(0x1d7)],'usdtErcWallet':_0x9991dd[_0x23fbd1(0x14f)],'usdcPolygonWallet':_0x9991dd[_0x23fbd1(0x172)]},'status':_0x9991dd[_0x23fbd1(0x1c3)],'createdAt':_0x9991dd[_0x23fbd1(0x146)]};}async[a35_0x5e08cb(0x1a7)](_0x40c9aa){const _0x2ded46=a35_0x5e08cb,_0x4f8173=await database_1['default']['shop'][_0x2ded46(0x136)]({'where':{'id':_0x40c9aa},'data':{'status':_0x2ded46(0x143)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4f8173['id'],'fullName':_0x4f8173[_0x2ded46(0x200)],'username':_0x4f8173[_0x2ded46(0x19e)],'telegramId':_0x4f8173[_0x2ded46(0x163)],'merchantUrl':_0x4f8173['shopUrl'],'gateways':_0x4f8173['paymentGateways']?JSON[_0x2ded46(0x1c0)](_0x4f8173[_0x2ded46(0xfc)]):null,'gatewaySettings':_0x4f8173[_0x2ded46(0x1f5)]?JSON[_0x2ded46(0x1c0)](_0x4f8173[_0x2ded46(0x1f5)]):null,'publicKey':_0x4f8173[_0x2ded46(0x150)],'wallets':{'usdtPolygonWallet':_0x4f8173['usdtPolygonWallet'],'usdtTrcWallet':_0x4f8173['usdtTrcWallet'],'usdtErcWallet':_0x4f8173[_0x2ded46(0x14f)],'usdcPolygonWallet':_0x4f8173[_0x2ded46(0x172)]},'status':_0x4f8173['status'],'createdAt':_0x4f8173[_0x2ded46(0x146)]};}async['getAllUsers'](_0x1e021e){const _0x33ab6c=a35_0x5e08cb,{page:_0x5d3458,limit:_0x3920c6,status:_0x2a5a0f}=_0x1e021e,_0x586df7=(_0x5d3458-0x1)*_0x3920c6,_0x5b7a8d={};_0x2a5a0f&&(_0x5b7a8d[_0x33ab6c(0x1c3)]=_0x2a5a0f[_0x33ab6c(0x125)]());const [_0x3a984b,_0x48662a]=await Promise['all']([database_1[_0x33ab6c(0x113)][_0x33ab6c(0x186)][_0x33ab6c(0x181)]({'where':_0x5b7a8d,'skip':_0x586df7,'take':_0x3920c6,'orderBy':{'createdAt':_0x33ab6c(0x1b6)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x33ab6c(0x113)][_0x33ab6c(0x186)][_0x33ab6c(0x139)]({'where':_0x5b7a8d})]);return{'users':_0x3a984b['map'](_0x4a4015=>({'id':_0x4a4015['id'],'fullName':_0x4a4015[_0x33ab6c(0x200)],'username':_0x4a4015[_0x33ab6c(0x19e)],'telegramId':_0x4a4015[_0x33ab6c(0x163)],'merchantUrl':_0x4a4015[_0x33ab6c(0x1d3)],'gateways':_0x4a4015[_0x33ab6c(0xfc)]?JSON[_0x33ab6c(0x1c0)](_0x4a4015[_0x33ab6c(0xfc)]):null,'gatewaySettings':_0x4a4015['gatewaySettings']?JSON[_0x33ab6c(0x1c0)](_0x4a4015[_0x33ab6c(0x1f5)]):null,'publicKey':_0x4a4015[_0x33ab6c(0x150)],'wallets':{'usdtPolygonWallet':_0x4a4015['usdtPolygonWallet'],'usdtTrcWallet':_0x4a4015[_0x33ab6c(0x1d7)],'usdtErcWallet':_0x4a4015[_0x33ab6c(0x14f)],'usdcPolygonWallet':_0x4a4015[_0x33ab6c(0x172)]},'status':_0x4a4015[_0x33ab6c(0x1c3)],'createdAt':_0x4a4015['createdAt']})),'pagination':{'page':_0x5d3458,'limit':_0x3920c6,'total':_0x48662a,'totalPages':Math['ceil'](_0x48662a/_0x3920c6)}};}async['getUserById'](_0x4b0195){const _0x172a55=a35_0x5e08cb,_0xefd375=await database_1[_0x172a55(0x113)]['shop'][_0x172a55(0x135)]({'where':{'id':_0x4b0195},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0xefd375)return null;return{'id':_0xefd375['id'],'fullName':_0xefd375[_0x172a55(0x200)],'username':_0xefd375['username'],'telegramId':_0xefd375['telegram'],'merchantUrl':_0xefd375[_0x172a55(0x1d3)],'gateways':_0xefd375[_0x172a55(0xfc)]?JSON['parse'](_0xefd375[_0x172a55(0xfc)]):null,'gatewaySettings':_0xefd375[_0x172a55(0x1f5)]?JSON[_0x172a55(0x1c0)](_0xefd375[_0x172a55(0x1f5)]):null,'publicKey':_0xefd375[_0x172a55(0x150)],'wallets':{'usdtPolygonWallet':_0xefd375[_0x172a55(0x16a)],'usdtTrcWallet':_0xefd375[_0x172a55(0x1d7)],'usdtErcWallet':_0xefd375['usdtErcWallet'],'usdcPolygonWallet':_0xefd375['usdcPolygonWallet']},'status':_0xefd375[_0x172a55(0x1c3)],'createdAt':_0xefd375[_0x172a55(0x146)]};}async[a35_0x5e08cb(0x105)](_0xeddc03){const _0xad2907=a35_0x5e08cb,{fullName:_0x4c2423,username:_0x15bbf2,password:_0x45a6d6,telegramId:_0x3e9314,merchantUrl:_0x4a9efe,gateways:_0x45f072,gatewaySettings:_0x48ad15,wallets:_0x38991c}=_0xeddc03,_0x33f53f=await database_1[_0xad2907(0x113)][_0xad2907(0x186)]['findUnique']({'where':{'username':_0x15bbf2}});if(_0x33f53f)throw new Error(_0xad2907(0x16d));if(_0x3e9314){const _0x2149bf=await database_1[_0xad2907(0x113)][_0xad2907(0x186)][_0xad2907(0x135)]({'where':{'telegram':_0x3e9314}});if(_0x2149bf)throw new Error(_0xad2907(0x1b2));}const _0x31ccf2=await bcryptjs_1[_0xad2907(0x113)][_0xad2907(0x1dc)](_0x45a6d6,0xc),_0x2252a3='pk_'+crypto_1[_0xad2907(0x113)][_0xad2907(0x1e4)](0x20)[_0xad2907(0x190)]('hex'),_0xf6869e=_0xad2907(0x1fe)+crypto_1[_0xad2907(0x113)][_0xad2907(0x1e4)](0x20)[_0xad2907(0x190)](_0xad2907(0x1d5)),_0x23c446=await database_1[_0xad2907(0x113)][_0xad2907(0x186)][_0xad2907(0x19c)]({'data':{'name':_0x4c2423,'username':_0x15bbf2,'password':_0x31ccf2,'telegram':_0x3e9314,'shopUrl':_0x4a9efe,'paymentGateways':_0x45f072?JSON[_0xad2907(0x141)](_0x45f072):null,'gatewaySettings':_0x48ad15?JSON['stringify'](_0x48ad15):null,'usdtPolygonWallet':_0x38991c?.[_0xad2907(0x16a)]||null,'usdtTrcWallet':_0x38991c?.[_0xad2907(0x1d7)]||null,'usdtErcWallet':_0x38991c?.['usdtErcWallet']||null,'usdcPolygonWallet':_0x38991c?.[_0xad2907(0x172)]||null,'publicKey':_0x2252a3,'secretKey':_0xf6869e,'status':_0xad2907(0x143)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x23c446['id'],'fullName':_0x23c446['name'],'username':_0x23c446[_0xad2907(0x19e)],'telegramId':_0x23c446[_0xad2907(0x163)],'merchantUrl':_0x23c446[_0xad2907(0x1d3)],'gateways':_0x23c446[_0xad2907(0xfc)]?JSON[_0xad2907(0x1c0)](_0x23c446[_0xad2907(0xfc)]):null,'gatewaySettings':_0x23c446[_0xad2907(0x1f5)]?JSON['parse'](_0x23c446[_0xad2907(0x1f5)]):null,'publicKey':_0x23c446[_0xad2907(0x150)],'wallets':{'usdtPolygonWallet':_0x23c446[_0xad2907(0x16a)],'usdtTrcWallet':_0x23c446['usdtTrcWallet'],'usdtErcWallet':_0x23c446[_0xad2907(0x14f)],'usdcPolygonWallet':_0x23c446['usdcPolygonWallet']},'status':_0x23c446[_0xad2907(0x1c3)],'createdAt':_0x23c446[_0xad2907(0x146)]};}async[a35_0x5e08cb(0x1f0)](_0x26d398){const _0x3cd5d6=a35_0x5e08cb;await database_1[_0x3cd5d6(0x113)]['shop']['delete']({'where':{'id':_0x26d398}});}[a35_0x5e08cb(0xfd)](_0x4aaa40,_0x2db304,_0x214e92){const _0x801c8a=a35_0x5e08cb,_0x4abe28=new Map(),_0x4256b9=new Date(_0x2db304);while(_0x4256b9<=_0x214e92){const _0x38d6ed=_0x4256b9[_0x801c8a(0x1ac)]()['split']('T')[0x0];_0x4abe28['set'](_0x38d6ed,{'revenue':0x0,'count':0x0}),_0x4256b9[_0x801c8a(0x158)](_0x4256b9[_0x801c8a(0xf5)]()+0x1);}for(const _0x28baaf of _0x4aaa40){const _0x153d7f=_0x28baaf[_0x801c8a(0x146)][_0x801c8a(0x1ac)]()['split']('T')[0x0],_0x4e01d0=_0x4abe28[_0x801c8a(0x12f)](_0x153d7f);_0x4e01d0&&(_0x4e01d0[_0x801c8a(0x139)]+=0x1,_0x28baaf[_0x801c8a(0x1c3)]==='PAID'&&(_0x28baaf[_0x801c8a(0x1bd)]?_0x4e01d0[_0x801c8a(0x129)]+=_0x28baaf[_0x801c8a(0x1bd)]:console[_0x801c8a(0x169)]('⚠️\x20Payment\x20'+_0x28baaf['id']+_0x801c8a(0x145))));}const _0x24e098=[],_0x1f980c=[];for(const [_0x22e5cd,_0xe4919e]of _0x4abe28){_0x24e098['push']({'date':_0x22e5cd,'amount':Math['round'](_0xe4919e[_0x801c8a(0x129)]*0x64)/0x64}),_0x1f980c[_0x801c8a(0x1a4)]({'date':_0x22e5cd,'count':_0xe4919e['count']});}return{'dailyRevenue':_0x24e098,'dailyPayments':_0x1f980c};}}exports['AdminService']=AdminService;