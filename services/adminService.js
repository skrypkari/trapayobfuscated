'use strict';function a36_0x56a5(_0xa9f85e,_0x8a051c){const _0x3fcffc=a36_0x3fcf();return a36_0x56a5=function(_0x56a5c2,_0x400553){_0x56a5c2=_0x56a5c2-0x85;let _0x54db83=_0x3fcffc[_0x56a5c2];return _0x54db83;},a36_0x56a5(_0xa9f85e,_0x8a051c);}const a36_0x2767ca=a36_0x56a5;(function(_0x505fcc,_0x198fbf){const _0x4f53d8=a36_0x56a5,_0x2b5cdc=_0x505fcc();while(!![]){try{const _0x352fc4=parseInt(_0x4f53d8(0x160))/0x1+-parseInt(_0x4f53d8(0xe7))/0x2+parseInt(_0x4f53d8(0x151))/0x3*(parseInt(_0x4f53d8(0xb0))/0x4)+-parseInt(_0x4f53d8(0x1c5))/0x5+-parseInt(_0x4f53d8(0xa0))/0x6*(parseInt(_0x4f53d8(0x8f))/0x7)+-parseInt(_0x4f53d8(0x176))/0x8*(parseInt(_0x4f53d8(0xf0))/0x9)+parseInt(_0x4f53d8(0x1b6))/0xa;if(_0x352fc4===_0x198fbf)break;else _0x2b5cdc['push'](_0x2b5cdc['shift']());}catch(_0x4842e3){_0x2b5cdc['push'](_0x2b5cdc['shift']());}}}(a36_0x3fcf,0xe942e));function a36_0x3fcf(){const _0x50233e=['findUnique','getGatewayInternalName','getGatewayNameById','⚠️\x20Requested\x20gateway\x20\x27','📊\x20Merchant\x20statistics\x20calculated:','✅\x20Payout\x20created:\x20','insensitive','%\x20from\x20','dailyPayments','🔐\x20[','totalPayout','updatedAt','amountUSDT','paidAt','\x20\x20\x20Current\x20balance:\x20','\x20payments)','getGatewayIdByName','\x20PAID\x20payments','generateDailyStatistics','\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...','10907528wJLZvS','telegramId','setDate','amountAfterCommissionUSDT','📋\x20Getting\x20merchants\x20selection\x20list...','📅\x20Period:\x20','failureMessage','customerUa','all','totalPayments','\x20\x20\x20✅\x20Actual\x20available\x20balance:\x20','📊\x20Final\x20WHERE\x20conditions:','gatewayOrderId','../types/gateway','ceil','Rapyd','periodFrom','totalAmountAfterCommissionUSDT','getPayoutStats','pendingUrl','commissionUSDT','customerEmail','SUSPENDED','🎯\x20updateUser\x20called\x20with\x20ID:\x20','map','month','error','\x20USDT','💳\x20Payout\x20wallet\x20for\x20','balance','📊\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20','\x20\x20\x20🔍\x20Raw\x20balance\x20sum:\x20','orderId','gatewaySettings','totalTurnover','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','deletePayout','\x20in\x20','__esModule','⚠️\x20Gateway\x20\x27','not\x20specified','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','⚠️\x20Payment\x20','convertToUSDT','crypto','\x20order','💰\x20Payment\x20','trc20','push','getMerchantsAwaitingPayout','ACTIVE','gateway','\x20USDT\x20(','username',']\x20Updating\x20password\x20for\x20user\x20','day','week','\x20status:\x20','\x20\x20\x20💸\x20Total\x20payouts:\x20','CoinToPay','get','customerName','gateways','merchantUrl','40556040DFrOCY','chargebackAmount','\x20balance\x20updated:','values','lte','join','\x20balance\x20updated:\x20','parse','some','\x20\x20\x20🖥️\x20User\x20Agent:\x20','asc','toISOString','💰\x20[PAYOUT]\x20Merchant\x20','Payment\x20not\x20found','round','5526505WtKgms','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','setHours','includes','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','Insufficient\x20balance.\x20Available:\x20','updatePaymentStatus','toFixed','toUpperCase','\x20\x20\x20Balance:\x20','pk_','name','📋\x20Found\x20','commission','Telegram\x20username\x20already\x20exists','\x20USDT\x20(-','delete','\x20active\x20merchants\x20for\x20selection','🔧\x20[','MasterCard','randomBytes','7NWVrvM','dateFrom','periodTo','getAllPayments','REFUND','date','averageCommissionRate','erc20','2020-01-01','network','30d','yesterday','\x20became\x20PAID:','totalPaidOut','plisio','customerIp','shopUrl','3935070QgPBXk','payment','\x20\x20\x20💰\x20Total\x20payments\x20turnover:\x20','\x20->\x20','\x20USDT)','fullName','getAllPayouts','📊\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','noda','NONEXISTENT_GATEWAY_FILTER','\x20USDT\x20for\x20payment\x20','shop','dateTo','cointopay2','createUser','🔍\x20Using\x20gateway\x20\x27','52hKVSyA','status','_sum','AdminService','\x20for\x20shop\x20','paidOutUSDT','\x20USDT\x20(same\x20as\x20awaiting)','getMerchantStatistics','toLowerCase','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','\x20USDT\x20(after\x20','availableBalance','usdtErcWallet','merchantEarningsUSDT','📊\x20Total\x20payments\x20(including\x20failed):\x20','trim','COMPLETED','\x20merchants\x20with\x20positive\x20balance','adminNotes','klyme_eu','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','🔄\x20Converted\x20gateway\x20name\x20\x27','getUserById','turnoverUSDT','year','merchantEarnings','\x20\x20\x20Merchant\x20gets:\x20','getFullYear','💸\x20CHARGEBACK\x20penalty:\x20-','failUrl','createPayout','count','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','getGatewayDisplayName','findMany','revenue','update','\x20USDT\x20(without\x20commission)','awaitingPayout','🎯\x20[','averageCheckUSDT','Open\x20Banking\x202','\x20\x20\x20🌍\x20Country:\x20','gatewayCommissionRate','notes','warn','\x20\x20\x20Total\x20paid\x20out:\x20','admin','summary','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','paymentGateways','toString','📊\x20Calculating\x20payout\x20statistics...','\x20paid\x20payments\x20for\x20analysis','findFirst','827996QZQGbD',':\x20commission\x20=\x20','klyme_de','%\x20commission)','\x20\x20\x20Merchant\x20loses:\x20','getPayoutById','hash','reduce','usdtPolygonWallet','9TIyYpb','createdAt','getPaymentById','\x20\x20\x20💸\x20Total\x20payouts\x20(all\x20time):\x20','\x20\x20\x20Full\x20amount:\x20','statusChangedAt','getTime','90d','period','log','aggregate','payout','polygon','amount','📊\x20Using\x20saved\x20values\x20for\x20payment\x20','gte','shopId','_count','random','\x20\x20\x20Gateway:\x20','\x20\x20\x20Subtracted\x20from\x20balance:\x20-',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','statusChangedBy','usdtTrcWallet','sort','Username\x20already\x20exists','\x20\x20\x20📅\x20This\x20month:\x20','updateUser','entries','paymentsCount','💰\x20[PAYOUT]\x20Gateway\x20','password','Plisio','KLYME\x20EU',',\x20successful:\x20','Test\x20Gateway','rapyd','default','getSystemStatistics','./currencyService','custom','bcryptjs','customerCountry','🔄\x20Converted\x20gateway\x20ID\x20\x27','currency','thisMonth','\x20\x20\x20💳\x20Total\x20payments:\x20','stringify','polygon_usdc','txid','💰\x20Creating\x20payout\x20for\x20shop\x20','\x20USDT\x20(+','KLYME\x20DE','publicKey','split',']\x20Gateway\x20settings\x20JSON\x20string:','🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','test_gateway','Error\x20processing\x20payment\x20','externalPaymentUrl','\x20\x20\x20🤔\x20Difference:\x20',',\x20userId:\x20','totalCommissionRate','getMonth','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','create','desc','groupBy','\x20USDT,\x20merchant:\x20','💰\x20Shop\x20','💰\x20Current\x20shop\x20balance:\x20','getDate','\x20\x20\x20�📊\x20Total\x20payments:\x20','💰\x20Found\x20','\x20USDT\x20(actual\x20balances)','\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)','\x20\x20\x20💵\x20Available\x20balance:\x20','not\x20set','PAID','currencyService','\x20\x20\x20🔍\x20Calculated\x20after\x20commission:\x20','📊\x20Merchants\x20awaiting\x20payout:\x20','totalAmountUSDT','🔄\x20Gateway\x20mapping\x20(get):','localeCompare','$transaction','\x20USDT\x20from\x20balance','\x20\x20\x20Added\x20to\x20balance:\x20+','0000','\x27\x20(from\x20\x27','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','successUrl','set','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','length','deleteUser','65748qEKKcd','📊\x20Gateway\x20filter\x20applied:','wallets','\x20\x20\x20🌐\x20IP:\x20','usdcPolygonWallet','\x27\x20not\x20found.\x20Available\x20gateways:\x20','Noda','turnover','hex','amountAfterGatewayCommissionUSDT','gatewayEarnings','../config/database','getMerchantsSelection','klyme_gb','\x20USDT\x20(theoretical\x20net)','153511WYOVgs','telegram'];a36_0x3fcf=function(){return _0x50233e;};return a36_0x3fcf();}var __importDefault=this&&this['__importDefault']||function(_0x1ce57b){const _0x5272e8=a36_0x56a5;return _0x1ce57b&&_0x1ce57b[_0x5272e8(0x19c)]?_0x1ce57b:{'default':_0x1ce57b};};Object['defineProperty'](exports,a36_0x2767ca(0x19c),{'value':!![]}),exports['AdminService']=void 0x0;const database_1=__importDefault(require(a36_0x2767ca(0x15c))),bcryptjs_1=__importDefault(require(a36_0x2767ca(0x119))),crypto_1=__importDefault(require(a36_0x2767ca(0x1a2))),currencyService_1=require(a36_0x2767ca(0x117)),gateway_1=require(a36_0x2767ca(0x183));class AdminService{async[a36_0x2767ca(0x188)](){const _0x255f47=a36_0x2767ca;console['log'](_0x255f47(0xe4));const _0x4643c6=await database_1['default']['shop']['aggregate']({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x255f47(0x1a8)}}),_0x31793d=await this[_0x255f47(0x1a7)]({'page':0x1,'limit':0x3e8}),_0x4473eb=await database_1[_0x255f47(0x115)]['payment'][_0x255f47(0xcf)]({'where':{'status':_0x255f47(0x13e),'gateway':{'not':_0x255f47(0x129)}}}),_0x5ce39a=new Date(),_0x8673b8=new Date(_0x5ce39a[_0x255f47(0xcb)](),_0x5ce39a[_0x255f47(0x12f)](),0x1),_0x5371f6=new Date(_0x5ce39a[_0x255f47(0xcb)](),_0x5ce39a[_0x255f47(0x12f)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x28d04c=await database_1[_0x255f47(0x115)][_0x255f47(0xfb)][_0x255f47(0xfa)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x8673b8,'lte':_0x5371f6},'status':'COMPLETED'}}),_0x7436df=_0x4643c6['_sum'][_0x255f47(0x9c)]||0x0,_0x33e7a9=_0x31793d[_0x255f47(0xe0)][_0x255f47(0x187)],_0x56fa1a=_0x28d04c[_0x255f47(0xb2)][_0x255f47(0xfd)]||0x0,_0x29cf34={'totalPayout':Math[_0x255f47(0x1c4)](_0x7436df*0x64)/0x64,'awaitingPayout':Math[_0x255f47(0x1c4)](_0x33e7a9*0x64)/0x64,'thisMonth':Math[_0x255f47(0x1c4)](_0x56fa1a*0x64)/0x64,'availableBalance':Math[_0x255f47(0x1c4)](_0x33e7a9*0x64)/0x64,'totalPayments':_0x4473eb};return console['log']('📊\x20Payout\x20statistics\x20calculated:'),console['log']('\x20\x20\x20💰\x20Total\x20payout:\x20'+_0x29cf34[_0x255f47(0x16c)]+'\x20USDT\x20(total\x20paid\x20to\x20merchants)'),console['log'](_0x255f47(0x1c6)+_0x29cf34[_0x255f47(0xd6)]+'\x20USDT\x20(with\x20commission\x20deducted)'),console[_0x255f47(0xf9)](_0x255f47(0x13c)+_0x29cf34[_0x255f47(0xbb)]+_0x255f47(0xb6)),console[_0x255f47(0xf9)](_0x255f47(0x10a)+_0x29cf34[_0x255f47(0x11d)]+_0x255f47(0x191)),console[_0x255f47(0xf9)](_0x255f47(0x11e)+_0x29cf34[_0x255f47(0x17f)]+_0x255f47(0x173)),console[_0x255f47(0xf9)](_0x255f47(0x195)+(_0x4643c6['_sum'][_0x255f47(0x193)]||0x0)[_0x255f47(0x1cc)](0x2)+_0x255f47(0xd5)),console[_0x255f47(0xf9)]('\x20\x20\x20📊\x20Commission\x20difference:\x20'+((_0x4643c6[_0x255f47(0xb2)]['balance']||0x0)-_0x33e7a9)[_0x255f47(0x1cc)](0x2)+_0x255f47(0x191)),_0x29cf34;}async['updateCustomerData'](_0x49c523,_0x31d3bd){const _0x2602b4=a36_0x2767ca;console[_0x2602b4(0xf9)]('🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20'+_0x49c523+':',_0x31d3bd);const _0x1b4679=await database_1[_0x2602b4(0x115)]['payment'][_0x2602b4(0x162)]({'where':{'id':_0x49c523},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x1b4679)throw new Error(_0x2602b4(0x1c3));const _0x4e0629={};_0x31d3bd[_0x2602b4(0x11a)]!==undefined&&(_0x4e0629['customerCountry']=_0x31d3bd['customerCountry']||null);_0x31d3bd[_0x2602b4(0x9e)]!==undefined&&(_0x4e0629[_0x2602b4(0x9e)]=_0x31d3bd[_0x2602b4(0x9e)]||null);_0x31d3bd[_0x2602b4(0x17d)]!==undefined&&(_0x4e0629[_0x2602b4(0x17d)]=_0x31d3bd[_0x2602b4(0x17d)]||null);const _0x2126a9=await database_1[_0x2602b4(0x115)][_0x2602b4(0xa1)]['update']({'where':{'id':_0x49c523},'data':{..._0x4e0629,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x2602b4(0xf9)](_0x2602b4(0xb9)+_0x49c523),console[_0x2602b4(0xf9)](_0x2602b4(0xda)+_0x1b4679[_0x2602b4(0x11a)]+_0x2602b4(0xa3)+_0x2126a9['customerCountry']),console[_0x2602b4(0xf9)](_0x2602b4(0x154)+_0x1b4679[_0x2602b4(0x9e)]+'\x20->\x20'+_0x2126a9[_0x2602b4(0x9e)]),console[_0x2602b4(0xf9)](_0x2602b4(0x1bf)+(_0x1b4679[_0x2602b4(0x17d)]?_0x2602b4(0x14d):_0x2602b4(0x13d))+_0x2602b4(0xa3)+(_0x2126a9[_0x2602b4(0x17d)]?_0x2602b4(0x14d):_0x2602b4(0x13d))),_0x2126a9;}async[a36_0x2767ca(0x116)](_0x168cfd){const _0x24f3bd=a36_0x2767ca,_0x59a20d=new Date();let _0x7a4c8f;switch(_0x168cfd[_0x24f3bd(0xb8)]()){case _0x24f3bd(0x1ad):_0x7a4c8f=new Date(_0x59a20d[_0x24f3bd(0xcb)](),_0x59a20d[_0x24f3bd(0x12f)](),_0x59a20d[_0x24f3bd(0x137)](),0x0,0x0,0x0,0x0);break;case _0x24f3bd(0x9a):const _0x46a24a=new Date(_0x59a20d);_0x46a24a['setDate'](_0x46a24a[_0x24f3bd(0x137)]()-0x1),_0x7a4c8f=new Date(_0x46a24a[_0x24f3bd(0xcb)](),_0x46a24a[_0x24f3bd(0x12f)](),_0x46a24a[_0x24f3bd(0x137)](),0x0,0x0,0x0,0x0);break;case'7d':_0x7a4c8f=new Date(_0x59a20d[_0x24f3bd(0xf6)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x24f3bd(0x99):_0x7a4c8f=new Date(_0x59a20d[_0x24f3bd(0xf6)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x24f3bd(0xf7):_0x7a4c8f=new Date(_0x59a20d[_0x24f3bd(0xf6)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x24f3bd(0x17e):const _0x24ca8e=await database_1[_0x24f3bd(0x115)][_0x24f3bd(0xa1)][_0x24f3bd(0xe6)]({'where':{'gateway':{'not':_0x24f3bd(0x129)}},'orderBy':{'createdAt':'asc'},'select':{'createdAt':!![]}});_0x7a4c8f=_0x24ca8e?_0x24ca8e['createdAt']:new Date(_0x24f3bd(0x97));break;default:_0x7a4c8f=new Date(_0x59a20d[_0x24f3bd(0xf6)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}_0x7a4c8f[_0x24f3bd(0x1c7)](0x0,0x0,0x0,0x0);let _0x2d4ce4;if(_0x168cfd[_0x24f3bd(0xb8)]()==='yesterday'){const _0x28f31b=new Date(_0x59a20d);_0x28f31b[_0x24f3bd(0x178)](_0x28f31b['getDate']()-0x1),_0x2d4ce4=new Date(_0x28f31b[_0x24f3bd(0xcb)](),_0x28f31b['getMonth'](),_0x28f31b['getDate'](),0x17,0x3b,0x3b,0x3e7);}const _0x4522f3={'gte':_0x7a4c8f};_0x2d4ce4&&(_0x4522f3[_0x24f3bd(0x1ba)]=_0x2d4ce4);const [_0x56b301,_0x944a81,_0x352145,_0x5c3728,_0x1d9cd9,_0x2f7da0]=await Promise[_0x24f3bd(0x17e)]([database_1[_0x24f3bd(0x115)][_0x24f3bd(0xab)][_0x24f3bd(0xcf)](),database_1[_0x24f3bd(0x115)]['shop'][_0x24f3bd(0xcf)]({'where':{'status':_0x24f3bd(0x1a8)}}),database_1[_0x24f3bd(0x115)][_0x24f3bd(0xa1)][_0x24f3bd(0xcf)]({'where':{'status':_0x24f3bd(0x13e),'createdAt':_0x4522f3,'gateway':{'not':_0x24f3bd(0x129)}}}),database_1[_0x24f3bd(0x115)][_0x24f3bd(0xa1)][_0x24f3bd(0xd2)]({'where':{'status':_0x24f3bd(0x13e),'createdAt':_0x4522f3,'gateway':{'not':_0x24f3bd(0x129)}},'select':{'amount':!![],'currency':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x24f3bd(0x115)]['payment']['findMany']({'where':{'gateway':{'not':_0x24f3bd(0x129)}},'take':0xa,'orderBy':{'createdAt':_0x24f3bd(0x132)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x24f3bd(0x115)][_0x24f3bd(0xa1)][_0x24f3bd(0xd2)]({'where':{'createdAt':_0x4522f3,'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x4f5972=0x0,_0x32f911=0x0;for(const _0x5030e9 of _0x5c3728){const _0x1a2fb6=await currencyService_1[_0x24f3bd(0x13f)][_0x24f3bd(0x1a1)](_0x5030e9[_0x24f3bd(0xfd)],_0x5030e9[_0x24f3bd(0x11c)]);_0x4f5972+=_0x1a2fb6;if(_0x5030e9[_0x24f3bd(0x15a)]){const _0x382db4=await currencyService_1['currencyService'][_0x24f3bd(0x1a1)](_0x5030e9[_0x24f3bd(0xfd)],_0x5030e9['currency']),_0x22606c=_0x5030e9[_0x24f3bd(0x15a)],_0x5be472=_0x382db4-_0x22606c;_0x32f911+=_0x5be472;}}const _0x553038=_0x352145>0x0?_0x4f5972/_0x352145:0x0,_0x27fdcf=this['generateDailyStatistics'](_0x2f7da0,_0x7a4c8f,_0x2d4ce4||_0x59a20d),_0x31d207=await database_1[_0x24f3bd(0x115)][_0x24f3bd(0xa1)][_0x24f3bd(0xcf)]({'where':{'createdAt':_0x4522f3,'gateway':{'not':_0x24f3bd(0x129)}}}),_0x55c59f=_0x31d207>0x0?_0x352145/_0x31d207*0x64:0x0;return{'totalShops':_0x56b301,'activeShops':_0x944a81,'totalPayments':_0x352145,'successfulPayments':_0x352145,'totalAttempts':_0x31d207,'totalRevenue':Math[_0x24f3bd(0x1c4)](_0x4f5972*0x64)/0x64,'trapayEarnings':Math['round'](_0x32f911*0x64)/0x64,'averagePaymentAmount':Math[_0x24f3bd(0x1c4)](_0x553038*0x64)/0x64,'conversionRate':Math[_0x24f3bd(0x1c4)](_0x55c59f*0x64)/0x64,'dailyRevenue':_0x27fdcf['dailyRevenue'],'dailyPayments':_0x27fdcf[_0x24f3bd(0x16a)],'recentPayments':_0x1d9cd9['map'](_0x292422=>({'id':_0x292422['id'],'amount':_0x292422['amount'],'currency':_0x292422[_0x24f3bd(0x11c)],'status':_0x292422['status'],'gateway':_0x292422[_0x24f3bd(0x1a9)],'shop':_0x292422[_0x24f3bd(0xab)],'createdAt':_0x292422[_0x24f3bd(0xf1)]}))};}async[a36_0x2767ca(0xb7)](_0xd347b4){const _0x119a01=a36_0x2767ca;console[_0x119a01(0xf9)](_0x119a01(0xc4),_0xd347b4);let _0x35a706,_0x3da3ac=new Date();if(_0xd347b4[_0x119a01(0xf8)]==='custom'&&_0xd347b4[_0x119a01(0x90)]&&_0xd347b4[_0x119a01(0xac)])_0x35a706=new Date(_0xd347b4[_0x119a01(0x90)]),_0x3da3ac=new Date(_0xd347b4[_0x119a01(0xac)]),_0x35a706[_0x119a01(0x1c7)](0x0,0x0,0x0,0x0),_0x3da3ac[_0x119a01(0x1c7)](0x17,0x3b,0x3b,0x3e7);else{const _0x4b9cea=new Date();switch(_0xd347b4[_0x119a01(0xf8)]){case _0x119a01(0x1ae):_0x35a706=new Date(_0x4b9cea['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x119a01(0x18f):_0x35a706=new Date(_0x4b9cea[_0x119a01(0xf6)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x119a01(0xc8):_0x35a706=new Date(_0x4b9cea[_0x119a01(0xf6)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case'all':default:_0x35a706=new Date(_0x119a01(0x97));break;}_0x35a706[_0x119a01(0x1c7)](0x0,0x0,0x0,0x0),_0x3da3ac[_0x119a01(0x1c7)](0x17,0x3b,0x3b,0x3e7);}console[_0x119a01(0xf9)](_0x119a01(0x17b)+_0x35a706['toISOString']()+'\x20to\x20'+_0x3da3ac[_0x119a01(0x1c1)]());const _0x2e7ecc={'status':_0x119a01(0x13e),'gateway':{'not':_0x119a01(0x129)},'paidAt':{'gte':_0x35a706,'lte':_0x3da3ac}};_0xd347b4[_0x119a01(0x100)]&&(_0x2e7ecc[_0x119a01(0x100)]=_0xd347b4['shopId']);const _0x41623f=await database_1[_0x119a01(0x115)][_0x119a01(0xa1)][_0x119a01(0xd2)]({'where':_0x2e7ecc,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x119a01(0xf9)](_0x119a01(0x139)+_0x41623f[_0x119a01(0x14f)]+_0x119a01(0xe5));const _0x15b836={'gateway':{'not':_0x119a01(0x129)},'createdAt':{'gte':_0x35a706,'lte':_0x3da3ac}};_0xd347b4[_0x119a01(0x100)]&&(_0x15b836['shopId']=_0xd347b4[_0x119a01(0x100)]);const _0x12de28=await database_1[_0x119a01(0x115)][_0x119a01(0xa1)]['count']({'where':_0x15b836});console[_0x119a01(0xf9)](_0x119a01(0xbe)+_0x12de28+_0x119a01(0x112)+_0x41623f[_0x119a01(0x14f)]);let _0x331073=0x0,_0x5bedf5=0x0,_0x62753=0x0;const _0x2a21a9={},_0x27bb9d={},_0x47d221={};for(const _0x52037a of _0x41623f){try{const _0x346e04=_0x52037a[_0x119a01(0x16e)]||0x0;if(_0x346e04<=0x0){console[_0x119a01(0xdd)](_0x119a01(0x1a0)+_0x52037a['id']+_0x119a01(0x175));continue;}let _0x32717,_0x30bcdc;if(_0x52037a['amountAfterGatewayCommissionUSDT']!==null&&_0x52037a['amountAfterGatewayCommissionUSDT']!==undefined)_0x32717=_0x52037a[_0x119a01(0x15a)],_0x30bcdc=_0x346e04-_0x32717,console[_0x119a01(0xf9)](_0x119a01(0xfe)+_0x52037a['id']+':\x20'+_0x346e04[_0x119a01(0x1cc)](0x6)+_0x119a01(0x134)+_0x32717[_0x119a01(0x1cc)](0x6)+_0x119a01(0x191));else{let _0xca55c5={};if(_0x52037a[_0x119a01(0xab)][_0x119a01(0x197)])try{_0xca55c5=JSON[_0x119a01(0x1bd)](_0x52037a[_0x119a01(0xab)][_0x119a01(0x197)]);}catch(_0x4c0981){console['error']('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x52037a['shopId']+':',_0x4c0981);}let _0x559cb4=0x2d;for(const [_0xf7e105,_0x2eea24]of Object[_0x119a01(0x10c)](_0xca55c5)){if(_0xf7e105[_0x119a01(0xb8)]()===_0x52037a['gateway'][_0x119a01(0xb8)]()){_0x559cb4=_0x2eea24['commission']||0x2d;break;}}_0x30bcdc=_0x346e04*(_0x559cb4/0x64),_0x32717=_0x346e04-_0x30bcdc,console[_0x119a01(0xf9)](_0x119a01(0xa7)+_0x52037a['id']+':\x20'+_0x559cb4+_0x119a01(0x169)+_0x346e04['toFixed'](0x6)+_0x119a01(0x191));}_0x331073+=_0x346e04,_0x5bedf5+=_0x32717,_0x62753+=_0x30bcdc;let _0x277677;_0x52037a[_0x119a01(0xdb)]!==null&&_0x52037a[_0x119a01(0xdb)]!==undefined?(_0x277677=_0x52037a['gatewayCommissionRate'],console[_0x119a01(0xf9)](_0x119a01(0x194)+_0x52037a['id']+':\x20'+_0x277677+'%')):(_0x277677=_0x346e04>0x0?_0x30bcdc/_0x346e04*0x64:0x0,console[_0x119a01(0xf9)]('📊\x20Calculated\x20commission\x20rate\x20for\x20payment\x20'+_0x52037a['id']+':\x20'+_0x277677[_0x119a01(0x1cc)](0x2)+'%'));!_0x2a21a9[_0x52037a[_0x119a01(0x1a9)]]&&(_0x2a21a9[_0x52037a[_0x119a01(0x1a9)]]={'gateway':_0x52037a[_0x119a01(0x1a9)],'gatewayDisplayName':this[_0x119a01(0xd1)](_0x52037a[_0x119a01(0x1a9)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x2a21a9[_0x52037a['gateway']][_0x119a01(0x10d)]++,_0x2a21a9[_0x52037a[_0x119a01(0x1a9)]][_0x119a01(0xc7)]+=_0x346e04,_0x2a21a9[_0x52037a[_0x119a01(0x1a9)]]['commissionUSDT']+=_0x30bcdc,_0x2a21a9[_0x52037a['gateway']]['merchantEarningsUSDT']+=_0x32717,_0x2a21a9[_0x52037a[_0x119a01(0x1a9)]][_0x119a01(0x12e)]+=_0x277677;!_0xd347b4[_0x119a01(0x100)]&&(!_0x27bb9d[_0x52037a['shopId']]&&(_0x27bb9d[_0x52037a[_0x119a01(0x100)]]={'shopId':_0x52037a[_0x119a01(0x100)],'shopName':_0x52037a[_0x119a01(0xab)][_0x119a01(0x85)],'shopUsername':_0x52037a[_0x119a01(0xab)][_0x119a01(0x1ab)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x27bb9d[_0x52037a['shopId']][_0x119a01(0x10d)]++,_0x27bb9d[_0x52037a['shopId']]['turnoverUSDT']+=_0x346e04,_0x27bb9d[_0x52037a[_0x119a01(0x100)]][_0x119a01(0x18a)]+=_0x30bcdc,_0x27bb9d[_0x52037a[_0x119a01(0x100)]][_0x119a01(0xbd)]+=_0x32717);const _0x3b1c37=_0x52037a[_0x119a01(0x16f)][_0x119a01(0x1c1)]()['split']('T')[0x0];!_0x47d221[_0x3b1c37]&&(_0x47d221[_0x3b1c37]={'date':_0x3b1c37,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x47d221[_0x3b1c37][_0x119a01(0x158)]+=_0x346e04,_0x47d221[_0x3b1c37][_0x119a01(0xc9)]+=_0x32717,_0x47d221[_0x3b1c37][_0x119a01(0x15b)]+=_0x30bcdc,_0x47d221[_0x3b1c37]['paymentsCount']++;}catch(_0xe433a1){console[_0x119a01(0x190)](_0x119a01(0x12a)+_0x52037a['id']+':',_0xe433a1);}}Object[_0x119a01(0x1b9)](_0x2a21a9)['forEach'](_0x5b744d=>{const _0x2e04a0=_0x119a01;_0x5b744d['averageCommissionRate']=_0x5b744d[_0x2e04a0(0x10d)]>0x0?_0x5b744d[_0x2e04a0(0x12e)]/_0x5b744d[_0x2e04a0(0x10d)]:0x0,delete _0x5b744d[_0x2e04a0(0x12e)];}),Object[_0x119a01(0x1b9)](_0x27bb9d)['forEach'](_0x5f2b8c=>{const _0x26d7d7=_0x119a01;_0x5f2b8c[_0x26d7d7(0xd8)]=_0x5f2b8c[_0x26d7d7(0x10d)]>0x0?_0x5f2b8c[_0x26d7d7(0xc7)]/_0x5f2b8c[_0x26d7d7(0x10d)]:0x0;});let _0x36d407=0x0,_0x18e9f3=0x0;if(_0xd347b4[_0x119a01(0x100)]){const _0x7ed8b9=await database_1['default']['payout']['findMany']({'where':{'shopId':_0xd347b4['shopId'],'status':_0x119a01(0xc0),'createdAt':{'gte':_0x35a706,'lte':_0x3da3ac}},'select':{'amount':!![]}});_0x36d407=_0x7ed8b9[_0x119a01(0xee)]((_0x20e7c8,_0x1e9eca)=>_0x20e7c8+_0x1e9eca[_0x119a01(0xfd)],0x0);const _0x1ec720=await database_1[_0x119a01(0x115)][_0x119a01(0xfb)][_0x119a01(0xd2)]({'where':{'shopId':_0xd347b4[_0x119a01(0x100)],'status':'PENDING','createdAt':{'gte':_0x35a706,'lte':_0x3da3ac}},'select':{'amount':!![]}});_0x18e9f3=_0x1ec720[_0x119a01(0xee)]((_0x302494,_0x215171)=>_0x302494+_0x215171['amount'],0x0);}const _0x514063=_0x12de28,_0x520f1d=_0x41623f[_0x119a01(0x14f)],_0x1c6869=_0x520f1d>0x0?_0x331073/_0x520f1d:0x0,_0x238027=_0x514063>0x0?Math['round'](_0x520f1d/_0x514063*0x2710)/0x64:0x0,_0x127f79=Math[_0x119a01(0x184)]((_0x3da3ac[_0x119a01(0xf6)]()-_0x35a706[_0x119a01(0xf6)]())/(0x3e8*0x3c*0x3c*0x18)),_0x52fd06={'totalTurnover':Math[_0x119a01(0x1c4)](_0x331073*0x64)/0x64,'merchantEarnings':Math[_0x119a01(0x1c4)](_0x5bedf5*0x64)/0x64,'gatewayEarnings':Math[_0x119a01(0x1c4)](_0x62753*0x64)/0x64,'totalPaidOut':Math['round'](_0x36d407*0x64)/0x64,'pendingPayout':Math['round'](_0x18e9f3*0x64)/0x64,'averageCheck':Math[_0x119a01(0x1c4)](_0x1c6869*0x64)/0x64,'totalPayments':_0x514063,'successfulPayments':_0x520f1d,'conversionRate':_0x238027,'gatewayBreakdown':Object[_0x119a01(0x1b9)](_0x2a21a9)[_0x119a01(0x18e)](_0x2dcc0a=>({..._0x2dcc0a,'turnoverUSDT':Math[_0x119a01(0x1c4)](_0x2dcc0a['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x119a01(0x1c4)](_0x2dcc0a[_0x119a01(0x18a)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x119a01(0x1c4)](_0x2dcc0a['merchantEarningsUSDT']*0x64)/0x64,'averageCommissionRate':Math[_0x119a01(0x1c4)](_0x2dcc0a[_0x119a01(0x95)]*0x64)/0x64})),'merchantBreakdown':_0xd347b4[_0x119a01(0x100)]?undefined:Object[_0x119a01(0x1b9)](_0x27bb9d)['map'](_0x545f14=>({..._0x545f14,'turnoverUSDT':Math['round'](_0x545f14[_0x119a01(0xc7)]*0x64)/0x64,'commissionUSDT':Math[_0x119a01(0x1c4)](_0x545f14[_0x119a01(0x18a)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x119a01(0x1c4)](_0x545f14['merchantEarningsUSDT']*0x64)/0x64,'paidOutUSDT':Math[_0x119a01(0x1c4)](_0x545f14[_0x119a01(0xb5)]*0x64)/0x64,'averageCheckUSDT':Math['round'](_0x545f14[_0x119a01(0xd8)]*0x64)/0x64})),'dailyData':Object[_0x119a01(0x1b9)](_0x47d221)[_0x119a01(0x18e)](_0x386c63=>({..._0x386c63,'turnover':Math[_0x119a01(0x1c4)](_0x386c63[_0x119a01(0x158)]*0x64)/0x64,'merchantEarnings':Math[_0x119a01(0x1c4)](_0x386c63[_0x119a01(0xc9)]*0x64)/0x64,'gatewayEarnings':Math[_0x119a01(0x1c4)](_0x386c63['gatewayEarnings']*0x64)/0x64}))[_0x119a01(0x108)]((_0x770854,_0x3186c6)=>_0x770854[_0x119a01(0x94)][_0x119a01(0x144)](_0x3186c6['date'])),'periodInfo':{'from':_0x35a706,'to':_0x3da3ac,'periodType':_0xd347b4[_0x119a01(0xf8)]||_0x119a01(0x118),'daysCount':_0x127f79}};return console[_0x119a01(0xf9)](_0x119a01(0x166)),console[_0x119a01(0xf9)]('\x20\x20\x20💰\x20Total\x20turnover:\x20'+_0x52fd06[_0x119a01(0x198)]+_0x119a01(0x191)),console['log'](_0x119a01(0x19f)+_0x52fd06[_0x119a01(0xc9)]+_0x119a01(0x191)),console[_0x119a01(0xf9)](_0x119a01(0xd0)+_0x52fd06['gatewayEarnings']+'\x20USDT'),console[_0x119a01(0xf9)]('\x20\x20\x20�\x20Total\x20paid\x20out:\x20'+_0x52fd06[_0x119a01(0x9c)]+_0x119a01(0x191)),console[_0x119a01(0xf9)]('\x20\x20\x20⏳\x20Pending\x20payout:\x20'+_0x52fd06['pendingPayout']+'\x20USDT'),console[_0x119a01(0xf9)](_0x119a01(0x138)+_0x52fd06[_0x119a01(0x17f)]),_0x52fd06;}async[a36_0x2767ca(0x15d)](){const _0x5bf8d1=a36_0x2767ca;console['log'](_0x5bf8d1(0x17a));const _0x5e00fa=await database_1[_0x5bf8d1(0x115)][_0x5bf8d1(0xab)]['findMany']({'where':{'status':_0x5bf8d1(0x1a8)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x5bf8d1(0x1c0)}});return console['log'](_0x5bf8d1(0x86)+_0x5e00fa[_0x5bf8d1(0x14f)]+_0x5bf8d1(0x8b)),_0x5e00fa[_0x5bf8d1(0x18e)](_0xbad0d=>({'id':_0xbad0d['id'],'username':_0xbad0d[_0x5bf8d1(0x1ab)],'name':_0xbad0d['name']}));}[a36_0x2767ca(0xd1)](_0x197567){const _0x57aeab=a36_0x2767ca,_0x2ac120={'test_gateway':_0x57aeab(0x113),'plisio':_0x57aeab(0x110),'rapyd':_0x57aeab(0x185),'noda':_0x57aeab(0x157),'cointopay':_0x57aeab(0x1b1),'cointopay2':_0x57aeab(0xd9),'klyme_eu':_0x57aeab(0x111),'klyme_gb':'KLYME\x20GB','klyme_de':_0x57aeab(0x124),'mastercard':_0x57aeab(0x8d)};return _0x2ac120[_0x197567]||_0x197567;}['getGatewayInternalName'](_0x2702d9){const _0x550dcd=a36_0x2767ca,_0x23007e={'Test\x20Gateway':_0x550dcd(0x129),'Plisio':_0x550dcd(0x9d),'Rapyd':_0x550dcd(0x114),'Noda':_0x550dcd(0xa8),'CoinToPay':'cointopay','CoinToPay2':_0x550dcd(0xad),'KLYME\x20EU':_0x550dcd(0xc3),'KLYME\x20GB':_0x550dcd(0x15e),'KLYME\x20DE':_0x550dcd(0xe9),'MasterCard':'mastercard'};return _0x23007e[_0x2702d9]||_0x2702d9[_0x550dcd(0xb8)]();}async[a36_0x2767ca(0x1a7)](_0x32f6bb){const _0x17afba=a36_0x2767ca,{page:_0x1ea307,limit:_0x21cee6,minAmount:_0x330731,search:_0x5a0f4a}=_0x32f6bb,_0x5a8997=(_0x1ea307-0x1)*_0x21cee6;console[_0x17afba(0xf9)](_0x17afba(0x14a),_0x32f6bb);const _0x172515={'balance':{'gt':0x0},'status':_0x17afba(0x1a8)};_0x330731&&(_0x172515[_0x17afba(0x193)][_0x17afba(0xff)]=_0x330731);_0x5a0f4a&&(_0x172515[_0x17afba(0x85)]={'contains':_0x5a0f4a,'mode':_0x17afba(0x168)});const [_0x1329e8,_0x1782b4]=await Promise[_0x17afba(0x17e)]([database_1['default'][_0x17afba(0xab)][_0x17afba(0xd2)]({'where':_0x172515,'skip':_0x5a8997,'take':_0x21cee6,'orderBy':{'balance':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1[_0x17afba(0x115)][_0x17afba(0xab)][_0x17afba(0xcf)]({'where':_0x172515})]);console[_0x17afba(0xf9)](_0x17afba(0x139)+_0x1329e8[_0x17afba(0x14f)]+_0x17afba(0xc1));const _0x54f079=await Promise['all'](_0x1329e8['map'](async _0x20c65c=>{const _0x3a8318=_0x17afba,[_0x5ee4d2,_0x36dd19,_0x30c02b]=await Promise[_0x3a8318(0x17e)]([database_1['default'][_0x3a8318(0xa1)][_0x3a8318(0xcf)]({'where':{'shopId':_0x20c65c['id'],'status':'PAID','gateway':{'not':_0x3a8318(0x129)}}}),database_1['default'][_0x3a8318(0xa1)]['findFirst']({'where':{'shopId':_0x20c65c['id'],'status':_0x3a8318(0x13e),'gateway':{'not':_0x3a8318(0x129)}},'orderBy':{'paidAt':'asc'},'select':{'paidAt':!![]}}),database_1[_0x3a8318(0x115)][_0x3a8318(0xa1)][_0x3a8318(0x133)]({'by':['gateway'],'where':{'shopId':_0x20c65c['id'],'status':_0x3a8318(0x13e),'gateway':{'not':_0x3a8318(0x129)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x1ce5a3=new Date(),_0x1ae014=new Date(_0x1ce5a3[_0x3a8318(0xcb)](),_0x1ce5a3[_0x3a8318(0x12f)](),0x1),_0x1ebca0=new Date(_0x1ce5a3[_0x3a8318(0xcb)](),_0x1ce5a3[_0x3a8318(0x12f)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x468969,_0x136510]=await Promise[_0x3a8318(0x17e)]([database_1[_0x3a8318(0x115)][_0x3a8318(0xfb)][_0x3a8318(0xfa)]({'_sum':{'amount':!![]},'where':{'shopId':_0x20c65c['id'],'status':'COMPLETED'}}),database_1[_0x3a8318(0x115)]['payout'][_0x3a8318(0xfa)]({'_sum':{'amount':!![]},'where':{'shopId':_0x20c65c['id'],'status':_0x3a8318(0xc0),'createdAt':{'gte':_0x1ae014,'lte':_0x1ebca0}}})]),_0x55b804=_0x468969['_sum'][_0x3a8318(0xfd)]||0x0,_0x34bb42=_0x136510[_0x3a8318(0xb2)][_0x3a8318(0xfd)]||0x0,_0x424791=await Promise['all'](_0x30c02b[_0x3a8318(0x18e)](async _0x4691ad=>{const _0x224b23=_0x3a8318;let _0x26e8f5=0x2d;if(_0x20c65c[_0x224b23(0x197)])try{const _0x25d7ae=JSON[_0x224b23(0x1bd)](_0x20c65c[_0x224b23(0x197)]);for(const [_0x2a0606,_0x58775b]of Object[_0x224b23(0x10c)](_0x25d7ae)){if(_0x2a0606[_0x224b23(0xb8)]()===_0x4691ad[_0x224b23(0x1a9)][_0x224b23(0xb8)]()){_0x26e8f5=_0x58775b[_0x224b23(0x87)]||0xa,console[_0x224b23(0xf9)](_0x224b23(0x10e)+_0x4691ad[_0x224b23(0x1a9)]+_0x224b23(0xb4)+_0x20c65c['id']+_0x224b23(0xe8)+_0x26e8f5+'%');break;}}}catch(_0x33c617){console[_0x224b23(0x190)](_0x224b23(0xe1)+_0x20c65c['id']+':',_0x33c617);}const _0x4e5155=_0x4691ad[_0x224b23(0xb2)]?.[_0x224b23(0x16e)]||0x0,_0x3356cd=_0x4e5155*(0x1-_0x26e8f5/0x64);return{'gateway':_0x4691ad[_0x224b23(0x1a9)],'count':_0x4691ad['_count']?.['id']||0x0,'amountUSDT':Math['round'](_0x4e5155*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x224b23(0x1c4)](_0x3356cd*0x64)/0x64,'commission':_0x26e8f5};})),_0xbec4ee=_0x424791[_0x3a8318(0xee)]((_0x2ce03f,_0x2ca1bf)=>_0x2ce03f+_0x2ca1bf['amountUSDT'],0x0),_0x2a41b6=_0x424791['reduce']((_0xa0becb,_0x56c3c3)=>_0xa0becb+_0x56c3c3[_0x3a8318(0x179)],0x0),_0x5139b5=_0x20c65c[_0x3a8318(0x193)];return console[_0x3a8318(0xf9)](_0x3a8318(0x1c2)+_0x20c65c[_0x3a8318(0x1ab)]+':'),console['log']('\x20\x20\x20�\x20Total\x20payments\x20turnover:\x20'+_0xbec4ee[_0x3a8318(0x1cc)](0x2)+'\x20USDT\x20(gross\x20revenue)'),console[_0x3a8318(0xf9)](_0x3a8318(0x140)+_0x2a41b6[_0x3a8318(0x1cc)](0x2)+_0x3a8318(0x15f)),console[_0x3a8318(0xf9)](_0x3a8318(0x180)+_0x5139b5[_0x3a8318(0x1cc)](0x2)+'\x20USDT\x20(current\x20balance\x20in\x20DB)'),console[_0x3a8318(0xf9)](_0x3a8318(0x1b0)+_0x55b804[_0x3a8318(0x1cc)](0x2)+'\x20USDT\x20(already\x20paid\x20out)'),console[_0x3a8318(0xf9)](_0x3a8318(0x12c)+(_0x2a41b6-_0x55b804-_0x5139b5)[_0x3a8318(0x1cc)](0x2)+_0x3a8318(0x13b)),{'id':_0x20c65c['id'],'fullName':_0x20c65c['name'],'username':_0x20c65c['username'],'telegramId':_0x20c65c[_0x3a8318(0x161)],'merchantUrl':_0x20c65c['shopUrl'],'wallets':{'usdtPolygonWallet':_0x20c65c[_0x3a8318(0xef)],'usdtTrcWallet':_0x20c65c[_0x3a8318(0x107)],'usdtErcWallet':_0x20c65c['usdtErcWallet'],'usdcPolygonWallet':_0x20c65c[_0x3a8318(0x155)]},'totalAmountUSDT':Math[_0x3a8318(0x1c4)](_0xbec4ee*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x3a8318(0x1c4)](_0x424791['reduce']((_0x30a853,_0x196ee8)=>_0x30a853+_0x196ee8[_0x3a8318(0x179)],0x0)*0x64)/0x64,'currentBalance':Math[_0x3a8318(0x1c4)](_0x5139b5*0x64)/0x64,'totalPayout':Math['round'](_0x55b804*0x64)/0x64,'thisMonth':Math['round'](_0x34bb42*0x64)/0x64,'paymentsCount':_0x5ee4d2,'oldestPaymentDate':_0x36dd19?.['paidAt']||_0x20c65c[_0x3a8318(0xf1)],'gatewayBreakdown':_0x424791};})),_0xc122ca=_0x54f079[_0x17afba(0xee)]((_0x83aa35,_0x241024)=>_0x83aa35+_0x241024[_0x17afba(0x142)],0x0),_0x1d8264=_0x54f079[_0x17afba(0xee)]((_0x447bcd,_0x4224d7)=>_0x447bcd+_0x4224d7[_0x17afba(0x187)],0x0),_0x166756=_0x54f079[_0x17afba(0xee)]((_0x272977,_0x571feb)=>_0x272977+_0x571feb[_0x17afba(0x16c)],0x0),_0x2c9262=_0x54f079[_0x17afba(0xee)]((_0x5d6f49,_0x580ea5)=>_0x5d6f49+_0x580ea5[_0x17afba(0x11d)],0x0);return console[_0x17afba(0xf9)](_0x17afba(0x141)+_0x1782b4+'\x20merchants'),console[_0x17afba(0xf9)](_0x17afba(0xa2)+Math[_0x17afba(0x1c4)](_0xc122ca*0x64)/0x64+'\x20USDT\x20(gross\x20revenue)'),console[_0x17afba(0xf9)]('\x20\x20\x20✅\x20Total\x20available\x20for\x20payout:\x20'+Math[_0x17afba(0x1c4)](_0x1d8264*0x64)/0x64+_0x17afba(0x13a)),console[_0x17afba(0xf9)](_0x17afba(0xf3)+Math[_0x17afba(0x1c4)](_0x166756*0x64)/0x64+_0x17afba(0x191)),console['log']('\x20\x20\x20📅\x20Total\x20payouts\x20(this\x20month):\x20'+Math[_0x17afba(0x1c4)](_0x2c9262*0x64)/0x64+_0x17afba(0x191)),{'merchants':_0x54f079,'pagination':{'page':_0x1ea307,'limit':_0x21cee6,'total':_0x1782b4,'totalPages':Math['ceil'](_0x1782b4/_0x21cee6)},'summary':{'totalMerchants':_0x1782b4,'totalAmountUSDT':Math[_0x17afba(0x1c4)](_0xc122ca*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x1d8264*0x64)/0x64,'totalPayout':Math['round'](_0x166756*0x64)/0x64,'thisMonth':Math[_0x17afba(0x1c4)](_0x2c9262*0x64)/0x64}};}async[a36_0x2767ca(0xce)](_0x1ddbd5){const _0x45ec94=a36_0x2767ca,{shopId:_0x50163c,amount:_0x45b535,network:_0x433b9e,wallet:_0x2aa9f2,notes:_0x2e59bf,txid:_0x10916d,periodFrom:_0x56316e,periodTo:_0x397bed}=_0x1ddbd5,_0x35bc7a=await database_1[_0x45ec94(0x115)][_0x45ec94(0x145)](async _0x57a3f9=>{const _0x327684=_0x45ec94,_0xfa7f6a=await _0x57a3f9[_0x327684(0xab)][_0x327684(0x162)]({'where':{'id':_0x50163c},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0xfa7f6a)throw new Error('Shop\x20not\x20found');console[_0x327684(0xf9)](_0x327684(0x122)+_0xfa7f6a[_0x327684(0x1ab)]+':'),console[_0x327684(0xf9)](_0x327684(0x170)+_0xfa7f6a[_0x327684(0x193)][_0x327684(0x1cc)](0x6)+_0x327684(0x191)),console[_0x327684(0xf9)]('\x20\x20\x20Payout\x20amount:\x20'+_0x45b535[_0x327684(0x1cc)](0x6)+'\x20USDT'),console['log'](_0x327684(0x14e)+_0xfa7f6a['totalPaidOut'][_0x327684(0x1cc)](0x6)+_0x327684(0x191));if(_0x10916d)console[_0x327684(0xf9)]('\x20\x20\x20Transaction\x20hash:\x20'+_0x10916d);if(_0xfa7f6a[_0x327684(0x193)]<_0x45b535)throw new Error(_0x327684(0x1ca)+_0xfa7f6a['balance']['toFixed'](0x6)+'\x20USDT,\x20Requested:\x20'+_0x45b535[_0x327684(0x1cc)](0x6)+_0x327684(0x191));let _0x424b67=_0x2aa9f2;if(!_0x424b67){const _0x3bb79d=await _0x57a3f9[_0x327684(0xab)]['findUnique']({'where':{'id':_0x50163c},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x3bb79d)switch(_0x433b9e){case _0x327684(0xfc):_0x424b67=_0x3bb79d[_0x327684(0xef)]||undefined;break;case _0x327684(0x1a5):_0x424b67=_0x3bb79d[_0x327684(0x107)]||undefined;break;case _0x327684(0x96):_0x424b67=_0x3bb79d['usdtErcWallet']||undefined;break;case _0x327684(0x120):_0x424b67=_0x3bb79d[_0x327684(0x155)]||undefined;break;}}console[_0x327684(0xf9)](_0x327684(0x192)+_0x433b9e+':\x20'+(_0x424b67||_0x327684(0x19e)));const _0x5e8e2c=await _0x57a3f9[_0x327684(0xfb)][_0x327684(0x131)]({'data':{'shopId':_0x50163c,'amount':_0x45b535,'network':_0x433b9e,'status':_0x327684(0xc0),'txid':_0x10916d,'notes':_0x2e59bf,'periodFrom':_0x56316e?new Date(_0x56316e):null,'periodTo':_0x397bed?new Date(_0x397bed):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x4c91e9=_0xfa7f6a[_0x327684(0x193)]-_0x45b535,_0x2eddc4=_0xfa7f6a[_0x327684(0x9c)]+_0x45b535;return await _0x57a3f9[_0x327684(0xab)]['update']({'where':{'id':_0x50163c},'data':{'balance':_0x4c91e9,'totalPaidOut':_0x2eddc4}}),console['log'](_0x327684(0x135)+_0xfa7f6a['username']+_0x327684(0x1b8)),console[_0x327684(0xf9)](_0x327684(0x1ce)+_0xfa7f6a[_0x327684(0x193)]['toFixed'](0x6)+_0x327684(0xa3)+_0x4c91e9[_0x327684(0x1cc)](0x6)+_0x327684(0x89)+_0x45b535['toFixed'](0x6)+')'),console[_0x327684(0xf9)](_0x327684(0xde)+_0xfa7f6a[_0x327684(0x9c)][_0x327684(0x1cc)](0x6)+'\x20->\x20'+_0x2eddc4[_0x327684(0x1cc)](0x6)+_0x327684(0x123)+_0x45b535[_0x327684(0x1cc)](0x6)+')'),{'payout':_0x5e8e2c,'shop':_0xfa7f6a};});return console[_0x45ec94(0xf9)](_0x45ec94(0x167)+_0x35bc7a['payout']['id']+'\x20for\x20shop\x20'+_0x35bc7a[_0x45ec94(0xab)]['username']+'\x20('+_0x45b535+_0x45ec94(0xa4)),{'id':_0x35bc7a['payout']['id'],'shopId':_0x35bc7a[_0x45ec94(0xfb)][_0x45ec94(0x100)],'shopName':_0x35bc7a[_0x45ec94(0xab)]['name'],'shopUsername':_0x35bc7a[_0x45ec94(0xab)][_0x45ec94(0x1ab)],'amount':_0x35bc7a[_0x45ec94(0xfb)][_0x45ec94(0xfd)],'network':_0x35bc7a[_0x45ec94(0xfb)]['network'],'status':_0x35bc7a[_0x45ec94(0xfb)][_0x45ec94(0xb1)],'txid':_0x35bc7a[_0x45ec94(0xfb)]['txid'],'notes':_0x35bc7a[_0x45ec94(0xfb)][_0x45ec94(0xdc)],'periodFrom':_0x35bc7a[_0x45ec94(0xfb)][_0x45ec94(0x186)],'periodTo':_0x35bc7a['payout'][_0x45ec94(0x91)],'createdAt':_0x35bc7a[_0x45ec94(0xfb)]['createdAt'],'paidAt':_0x35bc7a[_0x45ec94(0xfb)][_0x45ec94(0x16f)]};}async[a36_0x2767ca(0xa6)](_0x577770){const _0x581436=a36_0x2767ca,{page:_0x57df27,limit:_0x5d1399,shopId:_0x3e6264,network:_0x119528,dateFrom:_0x5e915d,dateTo:_0x3d2f52,search:_0x26fc84}=_0x577770,_0x1614be=(_0x57df27-0x1)*_0x5d1399,_0x25cba7={};_0x3e6264&&(_0x25cba7[_0x581436(0x100)]=_0x3e6264);_0x119528&&(_0x25cba7['network']=_0x119528);(_0x5e915d||_0x3d2f52)&&(_0x25cba7[_0x581436(0xf1)]={},_0x5e915d&&(_0x25cba7[_0x581436(0xf1)]['gte']=new Date(_0x5e915d)),_0x3d2f52&&(_0x25cba7[_0x581436(0xf1)][_0x581436(0x1ba)]=new Date(_0x3d2f52)));_0x26fc84&&(_0x25cba7['OR']=[{'shop':{'name':{'contains':_0x26fc84,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x26fc84,'mode':_0x581436(0x168)}}},{'notes':{'contains':_0x26fc84,'mode':_0x581436(0x168)}}]);const [_0x23ae50,_0x509375]=await Promise[_0x581436(0x17e)]([database_1[_0x581436(0x115)]['payout'][_0x581436(0xd2)]({'where':_0x25cba7,'skip':_0x1614be,'take':_0x5d1399,'orderBy':{'createdAt':_0x581436(0x132)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x581436(0xfb)][_0x581436(0xcf)]({'where':_0x25cba7})]);return{'payouts':_0x23ae50['map'](_0x754bbc=>({'id':_0x754bbc['id'],'shopId':_0x754bbc['shopId'],'shopName':_0x754bbc[_0x581436(0xab)][_0x581436(0x85)],'shopUsername':_0x754bbc[_0x581436(0xab)]['username'],'amount':_0x754bbc['amount'],'network':_0x754bbc[_0x581436(0x98)],'status':_0x754bbc[_0x581436(0xb1)],'txid':_0x754bbc[_0x581436(0x121)],'notes':_0x754bbc[_0x581436(0xdc)],'periodFrom':_0x754bbc[_0x581436(0x186)],'periodTo':_0x754bbc[_0x581436(0x91)],'createdAt':_0x754bbc[_0x581436(0xf1)],'paidAt':_0x754bbc[_0x581436(0x16f)]})),'pagination':{'page':_0x57df27,'limit':_0x5d1399,'total':_0x509375,'totalPages':Math[_0x581436(0x184)](_0x509375/_0x5d1399)}};}async[a36_0x2767ca(0xec)](_0x52b24f){const _0x5c135c=a36_0x2767ca,_0x55ca26=await database_1[_0x5c135c(0x115)][_0x5c135c(0xfb)][_0x5c135c(0x162)]({'where':{'id':_0x52b24f},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x55ca26)return null;return{'id':_0x55ca26['id'],'shopId':_0x55ca26[_0x5c135c(0x100)],'shopName':_0x55ca26[_0x5c135c(0xab)][_0x5c135c(0x85)],'shopUsername':_0x55ca26[_0x5c135c(0xab)][_0x5c135c(0x1ab)],'amount':_0x55ca26[_0x5c135c(0xfd)],'network':_0x55ca26[_0x5c135c(0x98)],'status':_0x55ca26[_0x5c135c(0xb1)],'txid':_0x55ca26['txid'],'notes':_0x55ca26[_0x5c135c(0xdc)],'periodFrom':_0x55ca26['periodFrom'],'periodTo':_0x55ca26[_0x5c135c(0x91)],'createdAt':_0x55ca26[_0x5c135c(0xf1)],'paidAt':_0x55ca26['paidAt']};}async[a36_0x2767ca(0x19a)](_0x214adc){const _0xfaa996=a36_0x2767ca;await database_1[_0xfaa996(0x115)]['payout'][_0xfaa996(0x8a)]({'where':{'id':_0x214adc}});}async[a36_0x2767ca(0x92)](_0x1fd11a){const _0x4d76d9=a36_0x2767ca,{page:_0x35fe63,limit:_0x21f895,status:_0x344a1c,gateway:_0x2780ac,shopId:_0x2d8f77,dateFrom:_0x325fe1,dateTo:_0x5e3edb,search:_0xa43d19,currency:_0x251e24,sortBy:_0x207c27,sortOrder:_0x42cf83}=_0x1fd11a,_0x15220d=(_0x35fe63-0x1)*_0x21f895;console['log']('📊\x20Getting\x20payments\x20with\x20filters:',_0x1fd11a);const _0x15e00a=await database_1[_0x4d76d9(0x115)][_0x4d76d9(0xa1)][_0x4d76d9(0x133)]({'by':['gateway'],'_count':{'gateway':!![]}});console[_0x4d76d9(0xf9)]('📊\x20Available\x20gateways\x20in\x20database:',_0x15e00a[_0x4d76d9(0x18e)](_0x3d7027=>_0x3d7027['gateway']+'\x20('+_0x3d7027[_0x4d76d9(0x101)][_0x4d76d9(0x1a9)]+_0x4d76d9(0x171)));if(_0x2780ac){const _0x3bc9e5=_0x15e00a[_0x4d76d9(0x1be)](_0x3c408b=>_0x3c408b['gateway'][_0x4d76d9(0xb8)]()===_0x2780ac[_0x4d76d9(0xb8)]());!_0x3bc9e5&&_0x2780ac[_0x4d76d9(0xb8)]()!==_0x4d76d9(0x129)&&console['log'](_0x4d76d9(0x165)+_0x2780ac+_0x4d76d9(0x156)+_0x15e00a['map'](_0x502c59=>_0x502c59[_0x4d76d9(0x1a9)])[_0x4d76d9(0x1bb)](',\x20'));}const _0x58c9d8={};_0x344a1c&&(_0x58c9d8['status']=_0x344a1c[_0x4d76d9(0x1cd)]());if(!_0x2780ac)_0x58c9d8[_0x4d76d9(0x1a9)]={'not':_0x4d76d9(0x129)};else{if(_0x2780ac&&(_0x2780ac[_0x4d76d9(0xb8)]()==='test_gateway'||_0x2780ac===_0x4d76d9(0x148)))_0x58c9d8[_0x4d76d9(0x1a9)]=_0x4d76d9(0x129);else{let _0x48fdae=_0x2780ac;const _0x382745=(0x0,gateway_1[_0x4d76d9(0x164)])(_0x2780ac);if(_0x382745)_0x48fdae=_0x382745,console['log'](_0x4d76d9(0x11b)+_0x2780ac+'\x27\x20to\x20name\x20\x27'+_0x48fdae+'\x27');else{const _0x803240=(0x0,gateway_1[_0x4d76d9(0x172)])(_0x2780ac);if(_0x803240){const _0x51b14c=(0x0,gateway_1[_0x4d76d9(0x164)])(_0x803240);_0x51b14c&&(_0x48fdae=_0x51b14c,console['log'](_0x4d76d9(0xc5)+_0x2780ac+'\x27\x20->\x20ID\x20\x27'+_0x803240+'\x27\x20->\x20name\x20\x27'+_0x48fdae+'\x27'));}else console[_0x4d76d9(0xf9)](_0x4d76d9(0xaf)+_0x2780ac+_0x4d76d9(0x130));}const _0x17a704=await database_1['default'][_0x4d76d9(0xa1)][_0x4d76d9(0xcf)]({'where':{'gateway':_0x48fdae[_0x4d76d9(0xb8)]()},'take':0x1});_0x17a704===0x0?(console[_0x4d76d9(0xf9)](_0x4d76d9(0x19d)+_0x48fdae+_0x4d76d9(0x149)+_0x2780ac+_0x4d76d9(0x1c9)),_0x58c9d8[_0x4d76d9(0x1a9)]=_0x4d76d9(0xa9)):(_0x58c9d8['gateway']=_0x48fdae[_0x4d76d9(0xb8)](),console[_0x4d76d9(0xf9)]('✅\x20Using\x20gateway\x20filter:\x20\x27'+_0x48fdae+_0x4d76d9(0x149)+_0x2780ac+'\x27)'));}}console[_0x4d76d9(0xf9)](_0x4d76d9(0x152),_0x58c9d8[_0x4d76d9(0x1a9)]);_0x2d8f77&&(_0x58c9d8[_0x4d76d9(0x100)]=_0x2d8f77);_0x251e24&&(_0x58c9d8[_0x4d76d9(0x11c)]=_0x251e24[_0x4d76d9(0x1cd)](),console[_0x4d76d9(0xf9)]('💱\x20Currency\x20filter\x20applied:\x20'+_0x251e24['toUpperCase']()));(_0x325fe1||_0x5e3edb)&&(_0x58c9d8[_0x4d76d9(0xf1)]={},_0x325fe1&&(_0x58c9d8[_0x4d76d9(0xf1)][_0x4d76d9(0xff)]=new Date(_0x325fe1)),_0x5e3edb&&(_0x58c9d8['createdAt'][_0x4d76d9(0x1ba)]=new Date(_0x5e3edb)));_0xa43d19&&(_0x58c9d8['OR']=[{'id':{'contains':_0xa43d19,'mode':_0x4d76d9(0x168)}},{'orderId':{'contains':_0xa43d19,'mode':_0x4d76d9(0x168)}},{'gatewayOrderId':{'contains':_0xa43d19,'mode':_0x4d76d9(0x168)}},{'customerEmail':{'contains':_0xa43d19,'mode':_0x4d76d9(0x168)}},{'shop':{'name':{'contains':_0xa43d19,'mode':_0x4d76d9(0x168)}}},{'shop':{'username':{'contains':_0xa43d19,'mode':'insensitive'}}}]);console[_0x4d76d9(0xf9)](_0x4d76d9(0x181),JSON[_0x4d76d9(0x11f)](_0x58c9d8,null,0x2));let _0x34c188={'createdAt':_0x4d76d9(0x132)};if(_0x207c27){const _0x1422f4=[_0x4d76d9(0xfd),'createdAt',_0x4d76d9(0x16d),'status',_0x4d76d9(0x1a9),_0x4d76d9(0x11c)],_0x3a935f=[_0x4d76d9(0x1c0),_0x4d76d9(0x132)];if(_0x1422f4[_0x4d76d9(0x1c8)](_0x207c27)){const _0x496ffd=_0x3a935f[_0x4d76d9(0x1c8)](_0x42cf83)?_0x42cf83:_0x4d76d9(0x132);_0x34c188={[_0x207c27]:_0x496ffd},console[_0x4d76d9(0xf9)]('📊\x20Sorting\x20payments\x20by\x20'+_0x207c27+_0x4d76d9(0x19b)+_0x496ffd+_0x4d76d9(0x1a3));}}const [_0x150f9e,_0xf95fa9]=await Promise[_0x4d76d9(0x17e)]([database_1['default']['payment'][_0x4d76d9(0xd2)]({'where':_0x58c9d8,'skip':_0x15220d,'take':_0x21f895,'orderBy':_0x34c188,'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x4d76d9(0x115)][_0x4d76d9(0xa1)]['count']({'where':_0x58c9d8})]);return{'payments':_0x150f9e,'pagination':{'page':_0x35fe63,'limit':_0x21f895,'total':_0xf95fa9,'totalPages':Math[_0x4d76d9(0x184)](_0xf95fa9/_0x21f895)}};}async[a36_0x2767ca(0xf2)](_0x56618c){const _0x108979=a36_0x2767ca,_0x508d40=await database_1[_0x108979(0x115)]['payment'][_0x108979(0x162)]({'where':{'id':_0x56618c},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x508d40)return null;return{'id':_0x508d40['id'],'shopId':_0x508d40['shopId'],'gateway':_0x508d40[_0x108979(0x1a9)],'amount':_0x508d40[_0x108979(0xfd)],'currency':_0x508d40['currency'],'status':_0x508d40['status'],'orderId':_0x508d40[_0x108979(0x196)],'gatewayOrderId':_0x508d40[_0x108979(0x182)],'customerEmail':_0x508d40['customerEmail'],'customerName':_0x508d40[_0x108979(0x1b3)],'customerCountry':_0x508d40['customerCountry'],'customerIp':_0x508d40['customerIp'],'customerUa':_0x508d40[_0x108979(0x17d)],'failureMessage':_0x508d40[_0x108979(0x17c)],'externalPaymentUrl':_0x508d40[_0x108979(0x12b)],'successUrl':_0x508d40[_0x108979(0x14c)],'failUrl':_0x508d40[_0x108979(0xcd)],'pendingUrl':_0x508d40[_0x108979(0x189)],'whiteUrl':_0x508d40['whiteUrl'],'createdAt':_0x508d40[_0x108979(0xf1)],'updatedAt':_0x508d40['updatedAt'],'shop':_0x508d40['shop']};}async[a36_0x2767ca(0x1cb)](_0x4d3aa6,_0x25edd9,_0x24bd20,_0x3feee0){const _0x421685=a36_0x2767ca,_0x4e4f61=await database_1[_0x421685(0x115)][_0x421685(0x145)](async _0x2e018d=>{const _0xf61d9e=_0x421685,_0x594def=await _0x2e018d[_0xf61d9e(0xa1)]['findUnique']({'where':{'id':_0x4d3aa6},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x594def)throw new Error(_0xf61d9e(0x1c3));const _0x18b113=_0x594def[_0xf61d9e(0xb1)],_0x573f01=_0x25edd9['toUpperCase']();console[_0xf61d9e(0xf9)]('🔄\x20Admin\x20updating\x20payment\x20'+_0x4d3aa6+_0xf61d9e(0x1af)+_0x18b113+_0xf61d9e(0xa3)+_0x573f01),console[_0xf61d9e(0xf9)](_0xf61d9e(0x136)+_0x594def['shop'][_0xf61d9e(0x193)]+_0xf61d9e(0x191));const _0x440e1f={'status':_0x573f01,'updatedAt':new Date(),'statusChangedBy':_0xf61d9e(0xdf),'statusChangedAt':new Date()};_0x24bd20&&(_0x440e1f[_0xf61d9e(0xc2)]=_0x24bd20);_0x573f01==='CHARGEBACK'&&_0x3feee0&&(_0x440e1f[_0xf61d9e(0x1b7)]=_0x3feee0);let _0x2d5878=0x0,_0x49e39f=_0x594def['shop'][_0xf61d9e(0x193)];if(_0x573f01===_0xf61d9e(0x13e)&&_0x18b113!==_0xf61d9e(0x13e)){_0x440e1f[_0xf61d9e(0x16f)]=new Date();const _0x3da5a0=await currencyService_1[_0xf61d9e(0x13f)]['convertToUSDT'](_0x594def[_0xf61d9e(0xfd)],_0x594def[_0xf61d9e(0x11c)]);_0x440e1f[_0xf61d9e(0x16e)]=_0x3da5a0;let _0x56a12a=0x2d;const _0x508e1a=await _0x2e018d[_0xf61d9e(0xab)]['findUnique']({'where':{'id':_0x594def[_0xf61d9e(0x100)]},'select':{'gatewaySettings':!![]}});if(_0x508e1a?.[_0xf61d9e(0x197)])try{const _0x3ed2ce=JSON[_0xf61d9e(0x1bd)](_0x508e1a[_0xf61d9e(0x197)]);for(const [_0x21c0cf,_0x9b4de1]of Object[_0xf61d9e(0x10c)](_0x3ed2ce)){if(_0x21c0cf[_0xf61d9e(0xb8)]()===_0x594def[_0xf61d9e(0x1a9)][_0xf61d9e(0xb8)]()){_0x56a12a=_0x9b4de1[_0xf61d9e(0x87)]||0xa;break;}}}catch(_0x585b25){console['error'](_0xf61d9e(0x199)+_0x4d3aa6+':',_0x585b25);}let _0x61f436;_0x594def[_0xf61d9e(0x15a)]!==null&&_0x594def[_0xf61d9e(0x15a)]!==undefined?(_0x61f436=_0x594def[_0xf61d9e(0x15a)],console[_0xf61d9e(0xf9)]('📊\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20'+_0x61f436['toFixed'](0x6)+_0xf61d9e(0xaa)+_0x4d3aa6)):(_0x61f436=_0x3da5a0*(0x1-_0x56a12a/0x64),console[_0xf61d9e(0xf9)]('📊\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20'+_0x4d3aa6+':\x20'+_0x56a12a+_0xf61d9e(0x169)+_0x3da5a0[_0xf61d9e(0x1cc)](0x6)+'\x20USDT'),_0x440e1f[_0xf61d9e(0x15a)]=_0x61f436,_0x440e1f[_0xf61d9e(0xdb)]=_0x56a12a),_0x2d5878=_0x61f436,_0x49e39f+=_0x61f436,console[_0xf61d9e(0xf9)](_0xf61d9e(0x1a4)+_0x4d3aa6+_0xf61d9e(0x9b)),console['log'](_0xf61d9e(0xf4)+_0x3da5a0[_0xf61d9e(0x1cc)](0x6)+_0xf61d9e(0x191)),console[_0xf61d9e(0xf9)](_0xf61d9e(0x103)+_0x594def[_0xf61d9e(0x1a9)]+',\x20Commission:\x20'+_0x56a12a+'%'),console['log'](_0xf61d9e(0xca)+_0x61f436[_0xf61d9e(0x1cc)](0x6)+_0xf61d9e(0xba)+_0x56a12a+_0xf61d9e(0xea)),console[_0xf61d9e(0xf9)](_0xf61d9e(0x147)+_0x61f436[_0xf61d9e(0x1cc)](0x6)+_0xf61d9e(0x191));}else{if(_0x18b113===_0xf61d9e(0x13e)&&_0x573f01!==_0xf61d9e(0x13e)){if(_0x594def[_0xf61d9e(0x16e)]){let _0x128d28=0x2d;const _0x7471f0=await _0x2e018d[_0xf61d9e(0xab)][_0xf61d9e(0x162)]({'where':{'id':_0x594def[_0xf61d9e(0x100)]},'select':{'gatewaySettings':!![]}});if(_0x7471f0?.[_0xf61d9e(0x197)])try{const _0x29e6a8=JSON['parse'](_0x7471f0[_0xf61d9e(0x197)]);for(const [_0x16c44e,_0x140db5]of Object[_0xf61d9e(0x10c)](_0x29e6a8)){if(_0x16c44e[_0xf61d9e(0xb8)]()===_0x594def[_0xf61d9e(0x1a9)][_0xf61d9e(0xb8)]()){_0x128d28=_0x140db5[_0xf61d9e(0x87)]||0xa;break;}}}catch(_0x54ac8d){console[_0xf61d9e(0x190)](_0xf61d9e(0x199)+_0x4d3aa6+':',_0x54ac8d);}const _0x21cc1d=_0x594def[_0xf61d9e(0x16e)]*(0x1-_0x128d28/0x64);_0x2d5878=-_0x21cc1d,_0x49e39f-=_0x21cc1d,_0x440e1f['amountUSDT']=null,_0x440e1f[_0xf61d9e(0x15a)]=null,console[_0xf61d9e(0xf9)](_0xf61d9e(0x1a4)+_0x4d3aa6+'\x20no\x20longer\x20PAID:'),console[_0xf61d9e(0xf9)]('\x20\x20\x20Full\x20amount:\x20'+_0x594def['amountUSDT']['toFixed'](0x6)+_0xf61d9e(0x191)),console['log'](_0xf61d9e(0x103)+_0x594def[_0xf61d9e(0x1a9)]+',\x20Commission:\x20'+_0x128d28+'%'),console[_0xf61d9e(0xf9)](_0xf61d9e(0xeb)+_0x21cc1d[_0xf61d9e(0x1cc)](0x6)+_0xf61d9e(0xba)+_0x128d28+_0xf61d9e(0xea)),console['log'](_0xf61d9e(0x104)+_0x21cc1d[_0xf61d9e(0x1cc)](0x6)+_0xf61d9e(0x191));}}}_0x573f01==='CHARGEBACK'&&(_0x18b113===_0xf61d9e(0x13e)&&_0x594def['amountUSDT']&&console['log']('💸\x20CHARGEBACK:\x20Merchant\x20amount\x20already\x20deducted\x20from\x20balance'),_0x3feee0&&_0x3feee0>0x0&&(_0x2d5878-=_0x3feee0,_0x49e39f-=_0x3feee0,console['log'](_0xf61d9e(0xcc)+_0x3feee0['toFixed'](0x6)+_0xf61d9e(0x146))));_0x573f01===_0xf61d9e(0x93)&&_0x18b113==='PAID'&&console['log'](_0xf61d9e(0x128));const _0x1f2fee=await _0x2e018d[_0xf61d9e(0xa1)]['update']({'where':{'id':_0x4d3aa6},'data':_0x440e1f,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x2d5878!==0x0&&(await _0x2e018d[_0xf61d9e(0xab)]['update']({'where':{'id':_0x594def[_0xf61d9e(0x100)]},'data':{'balance':_0x49e39f}}),console[_0xf61d9e(0xf9)](_0xf61d9e(0x135)+_0x594def[_0xf61d9e(0x100)]+_0xf61d9e(0x1bc)+_0x594def[_0xf61d9e(0xab)][_0xf61d9e(0x193)][_0xf61d9e(0x1cc)](0x6)+_0xf61d9e(0xa3)+_0x49e39f[_0xf61d9e(0x1cc)](0x6)+_0xf61d9e(0x1aa)+(_0x2d5878>0x0?'+':'')+_0x2d5878[_0xf61d9e(0x1cc)](0x6)+')')),_0x1f2fee;});return{'id':_0x4e4f61['id'],'shopId':_0x4e4f61['shopId'],'gateway':_0x4e4f61[_0x421685(0x1a9)],'amount':_0x4e4f61[_0x421685(0xfd)],'currency':_0x4e4f61[_0x421685(0x11c)],'status':_0x4e4f61['status'],'orderId':_0x4e4f61['orderId'],'gatewayOrderId':_0x4e4f61[_0x421685(0x182)],'customerEmail':_0x4e4f61[_0x421685(0x18b)],'customerName':_0x4e4f61['customerName'],'customerCountry':_0x4e4f61[_0x421685(0x11a)],'customerIp':_0x4e4f61[_0x421685(0x9e)],'customerUa':_0x4e4f61['customerUa'],'failureMessage':_0x4e4f61[_0x421685(0x17c)],'adminNotes':_0x4e4f61[_0x421685(0xc2)],'chargebackAmount':_0x4e4f61[_0x421685(0x1b7)],'statusChangedBy':_0x4e4f61[_0x421685(0x106)],'statusChangedAt':_0x4e4f61[_0x421685(0xf5)],'createdAt':_0x4e4f61[_0x421685(0xf1)],'updatedAt':_0x4e4f61['updatedAt'],'shop':_0x4e4f61[_0x421685(0xab)]};}async[a36_0x2767ca(0x10b)](_0x372f25,_0x3a86ec){const _0x1c1520=a36_0x2767ca,_0x556bf5=Math[_0x1c1520(0x102)]()[_0x1c1520(0xe3)](0x24)['substr'](0x2,0x9);console[_0x1c1520(0xf9)](_0x1c1520(0x18d)+_0x556bf5+_0x1c1520(0x12d)+_0x372f25);const _0x1cc4c2={..._0x3a86ec};_0x3a86ec[_0x1c1520(0x10f)]&&_0x3a86ec['password'][_0x1c1520(0xbf)]()!==''?(console[_0x1c1520(0xf9)](_0x1c1520(0x16b)+_0x556bf5+_0x1c1520(0x1ac)+_0x372f25),_0x1cc4c2[_0x1c1520(0x10f)]=await bcryptjs_1[_0x1c1520(0x115)][_0x1c1520(0xed)](_0x3a86ec['password'],0xc)):(console[_0x1c1520(0xf9)](_0x1c1520(0x16b)+_0x556bf5+']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update'),delete _0x1cc4c2[_0x1c1520(0x10f)]);_0x3a86ec[_0x1c1520(0xa5)]&&(_0x1cc4c2[_0x1c1520(0x85)]=_0x3a86ec['fullName'],delete _0x1cc4c2[_0x1c1520(0xa5)]);_0x3a86ec[_0x1c1520(0x177)]&&(_0x1cc4c2[_0x1c1520(0x161)]=_0x3a86ec[_0x1c1520(0x177)],delete _0x1cc4c2['telegramId']);_0x3a86ec[_0x1c1520(0x1b5)]&&(_0x1cc4c2[_0x1c1520(0x9f)]=_0x3a86ec[_0x1c1520(0x1b5)],delete _0x1cc4c2['merchantUrl']);if(_0x3a86ec[_0x1c1520(0x1b4)]){const _0x29a132=_0x3a86ec[_0x1c1520(0x1b4)][_0x1c1520(0x18e)](_0x25f414=>this[_0x1c1520(0x163)](_0x25f414));console[_0x1c1520(0xf9)]('🔄\x20Gateway\x20mapping:',_0x3a86ec[_0x1c1520(0x1b4)],'->',_0x29a132),_0x1cc4c2['paymentGateways']=JSON[_0x1c1520(0x11f)](_0x29a132),delete _0x1cc4c2['gateways'];}_0x3a86ec[_0x1c1520(0x197)]&&(console['log'](_0x1c1520(0x8c)+_0x556bf5+']\x20Gateway\x20settings\x20before\x20saving:',_0x3a86ec[_0x1c1520(0x197)]),_0x1cc4c2[_0x1c1520(0x197)]=JSON[_0x1c1520(0x11f)](_0x3a86ec[_0x1c1520(0x197)]),console[_0x1c1520(0xf9)](_0x1c1520(0x8c)+_0x556bf5+_0x1c1520(0x127),_0x1cc4c2['gatewaySettings']));_0x3a86ec['wallets']&&(_0x3a86ec[_0x1c1520(0x153)]['usdtPolygonWallet']!==undefined&&(_0x1cc4c2[_0x1c1520(0xef)]=_0x3a86ec[_0x1c1520(0x153)]['usdtPolygonWallet']||null),_0x3a86ec['wallets'][_0x1c1520(0x107)]!==undefined&&(_0x1cc4c2[_0x1c1520(0x107)]=_0x3a86ec[_0x1c1520(0x153)][_0x1c1520(0x107)]||null),_0x3a86ec['wallets'][_0x1c1520(0xbc)]!==undefined&&(_0x1cc4c2[_0x1c1520(0xbc)]=_0x3a86ec[_0x1c1520(0x153)][_0x1c1520(0xbc)]||null),_0x3a86ec[_0x1c1520(0x153)][_0x1c1520(0x155)]!==undefined&&(_0x1cc4c2['usdcPolygonWallet']=_0x3a86ec[_0x1c1520(0x153)][_0x1c1520(0x155)]||null),delete _0x1cc4c2[_0x1c1520(0x153)]);const _0x4c08b2=await database_1['default']['shop'][_0x1c1520(0xd4)]({'where':{'id':_0x372f25},'data':_0x1cc4c2,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0x1c1520(0xf9)](_0x1c1520(0xd7)+_0x556bf5+_0x1c1520(0x105),_0x4c08b2['gatewaySettings']),{'id':_0x4c08b2['id'],'fullName':_0x4c08b2[_0x1c1520(0x85)],'username':_0x4c08b2['username'],'telegramId':_0x4c08b2[_0x1c1520(0x161)],'merchantUrl':_0x4c08b2['shopUrl'],'gateways':_0x4c08b2[_0x1c1520(0xe2)]?JSON['parse'](_0x4c08b2['paymentGateways']):null,'gatewaySettings':_0x4c08b2[_0x1c1520(0x197)]?JSON[_0x1c1520(0x1bd)](_0x4c08b2[_0x1c1520(0x197)]):null,'publicKey':_0x4c08b2['publicKey'],'wallets':{'usdtPolygonWallet':_0x4c08b2[_0x1c1520(0xef)],'usdtTrcWallet':_0x4c08b2['usdtTrcWallet'],'usdtErcWallet':_0x4c08b2[_0x1c1520(0xbc)],'usdcPolygonWallet':_0x4c08b2[_0x1c1520(0x155)]},'status':_0x4c08b2[_0x1c1520(0xb1)],'createdAt':_0x4c08b2[_0x1c1520(0xf1)]};}async['suspendUser'](_0x221a8d){const _0x5cfa3b=a36_0x2767ca,_0x2a0951=await database_1['default'][_0x5cfa3b(0xab)]['update']({'where':{'id':_0x221a8d},'data':{'status':_0x5cfa3b(0x18c)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2a0951['id'],'fullName':_0x2a0951['name'],'username':_0x2a0951['username'],'telegramId':_0x2a0951[_0x5cfa3b(0x161)],'merchantUrl':_0x2a0951[_0x5cfa3b(0x9f)],'gateways':_0x2a0951['paymentGateways']?JSON['parse'](_0x2a0951[_0x5cfa3b(0xe2)]):null,'gatewaySettings':_0x2a0951[_0x5cfa3b(0x197)]?JSON[_0x5cfa3b(0x1bd)](_0x2a0951[_0x5cfa3b(0x197)]):null,'publicKey':_0x2a0951['publicKey'],'wallets':{'usdtPolygonWallet':_0x2a0951[_0x5cfa3b(0xef)],'usdtTrcWallet':_0x2a0951[_0x5cfa3b(0x107)],'usdtErcWallet':_0x2a0951['usdtErcWallet'],'usdcPolygonWallet':_0x2a0951[_0x5cfa3b(0x155)]},'status':_0x2a0951['status'],'createdAt':_0x2a0951[_0x5cfa3b(0xf1)]};}async['activateUser'](_0x59f116){const _0x1f4d2f=a36_0x2767ca,_0x38f31c=await database_1[_0x1f4d2f(0x115)]['shop'][_0x1f4d2f(0xd4)]({'where':{'id':_0x59f116},'data':{'status':_0x1f4d2f(0x1a8)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x38f31c['id'],'fullName':_0x38f31c['name'],'username':_0x38f31c[_0x1f4d2f(0x1ab)],'telegramId':_0x38f31c['telegram'],'merchantUrl':_0x38f31c[_0x1f4d2f(0x9f)],'gateways':_0x38f31c[_0x1f4d2f(0xe2)]?JSON[_0x1f4d2f(0x1bd)](_0x38f31c[_0x1f4d2f(0xe2)]):null,'gatewaySettings':_0x38f31c['gatewaySettings']?JSON[_0x1f4d2f(0x1bd)](_0x38f31c[_0x1f4d2f(0x197)]):null,'publicKey':_0x38f31c[_0x1f4d2f(0x125)],'wallets':{'usdtPolygonWallet':_0x38f31c['usdtPolygonWallet'],'usdtTrcWallet':_0x38f31c['usdtTrcWallet'],'usdtErcWallet':_0x38f31c[_0x1f4d2f(0xbc)],'usdcPolygonWallet':_0x38f31c[_0x1f4d2f(0x155)]},'status':_0x38f31c[_0x1f4d2f(0xb1)],'createdAt':_0x38f31c[_0x1f4d2f(0xf1)]};}async['getAllUsers'](_0x1cc023){const _0x6648f=a36_0x2767ca,{page:_0x53f843,limit:_0x4ae57b,status:_0xf45c0e}=_0x1cc023,_0x99048f=(_0x53f843-0x1)*_0x4ae57b,_0x5766c4={};_0xf45c0e&&(_0x5766c4[_0x6648f(0xb1)]=_0xf45c0e[_0x6648f(0x1cd)]());const [_0x404809,_0x2b4585]=await Promise[_0x6648f(0x17e)]([database_1['default']['shop']['findMany']({'where':_0x5766c4,'skip':_0x99048f,'take':_0x4ae57b,'orderBy':{'createdAt':_0x6648f(0x132)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x6648f(0x115)][_0x6648f(0xab)][_0x6648f(0xcf)]({'where':_0x5766c4})]);return{'users':_0x404809[_0x6648f(0x18e)](_0x1e2cd8=>{const _0x2a5e35=_0x6648f,_0x433a16=_0x1e2cd8[_0x2a5e35(0xe2)]?JSON[_0x2a5e35(0x1bd)](_0x1e2cd8[_0x2a5e35(0xe2)]):null,_0x2bf991=_0x433a16?_0x433a16[_0x2a5e35(0x18e)](_0x559937=>this[_0x2a5e35(0xd1)](_0x559937)):null;return{'id':_0x1e2cd8['id'],'fullName':_0x1e2cd8[_0x2a5e35(0x85)],'username':_0x1e2cd8[_0x2a5e35(0x1ab)],'telegramId':_0x1e2cd8[_0x2a5e35(0x161)],'merchantUrl':_0x1e2cd8[_0x2a5e35(0x9f)],'gateways':_0x2bf991,'gatewaySettings':_0x1e2cd8['gatewaySettings']?JSON[_0x2a5e35(0x1bd)](_0x1e2cd8[_0x2a5e35(0x197)]):null,'publicKey':_0x1e2cd8[_0x2a5e35(0x125)],'wallets':{'usdtPolygonWallet':_0x1e2cd8[_0x2a5e35(0xef)],'usdtTrcWallet':_0x1e2cd8[_0x2a5e35(0x107)],'usdtErcWallet':_0x1e2cd8[_0x2a5e35(0xbc)],'usdcPolygonWallet':_0x1e2cd8[_0x2a5e35(0x155)]},'status':_0x1e2cd8['status'],'createdAt':_0x1e2cd8['createdAt']};}),'pagination':{'page':_0x53f843,'limit':_0x4ae57b,'total':_0x2b4585,'totalPages':Math[_0x6648f(0x184)](_0x2b4585/_0x4ae57b)}};}async[a36_0x2767ca(0xc6)](_0x2cf2d4){const _0x5de1b7=a36_0x2767ca,_0x190608=await database_1[_0x5de1b7(0x115)]['shop'][_0x5de1b7(0x162)]({'where':{'id':_0x2cf2d4},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x190608)return null;const _0x1b72c4=_0x190608[_0x5de1b7(0xe2)]?JSON[_0x5de1b7(0x1bd)](_0x190608['paymentGateways']):null,_0x22b44e=_0x1b72c4?_0x1b72c4[_0x5de1b7(0x18e)](_0x127847=>this[_0x5de1b7(0xd1)](_0x127847)):null;return _0x1b72c4&&_0x22b44e&&console['log'](_0x5de1b7(0x143),_0x1b72c4,'->',_0x22b44e),{'id':_0x190608['id'],'fullName':_0x190608[_0x5de1b7(0x85)],'username':_0x190608['username'],'telegramId':_0x190608[_0x5de1b7(0x161)],'merchantUrl':_0x190608[_0x5de1b7(0x9f)],'gateways':_0x22b44e,'gatewaySettings':_0x190608[_0x5de1b7(0x197)]?JSON[_0x5de1b7(0x1bd)](_0x190608[_0x5de1b7(0x197)]):null,'publicKey':_0x190608['publicKey'],'wallets':{'usdtPolygonWallet':_0x190608['usdtPolygonWallet'],'usdtTrcWallet':_0x190608[_0x5de1b7(0x107)],'usdtErcWallet':_0x190608[_0x5de1b7(0xbc)],'usdcPolygonWallet':_0x190608[_0x5de1b7(0x155)]},'status':_0x190608['status'],'createdAt':_0x190608[_0x5de1b7(0xf1)]};}async[a36_0x2767ca(0xae)](_0x82d64f){const _0xe6c6be=a36_0x2767ca,{fullName:_0x2e21d6,username:_0x5df6fc,password:_0xf51621,telegramId:_0x2e1e2c,merchantUrl:_0x5c3e6f,gateways:_0x21468c,gatewaySettings:_0xe3b1eb,wallets:_0x46e90f}=_0x82d64f,_0x20a1b3=await database_1[_0xe6c6be(0x115)][_0xe6c6be(0xab)]['findUnique']({'where':{'username':_0x5df6fc}});if(_0x20a1b3)throw new Error(_0xe6c6be(0x109));if(_0x2e1e2c){const _0x2fd3b0=await database_1['default'][_0xe6c6be(0xab)][_0xe6c6be(0x162)]({'where':{'telegram':_0x2e1e2c}});if(_0x2fd3b0)throw new Error(_0xe6c6be(0x88));}const _0x3df83b=await bcryptjs_1[_0xe6c6be(0x115)][_0xe6c6be(0xed)](_0xf51621,0xc),_0x58b1c4=_0xe6c6be(0x1cf)+crypto_1['default'][_0xe6c6be(0x8e)](0x20)[_0xe6c6be(0xe3)](_0xe6c6be(0x159)),_0x4be2eb='sk_'+crypto_1[_0xe6c6be(0x115)][_0xe6c6be(0x8e)](0x20)[_0xe6c6be(0xe3)](_0xe6c6be(0x159)),_0x5a48ab=_0x21468c?_0x21468c[_0xe6c6be(0x18e)](_0x362684=>this[_0xe6c6be(0x163)](_0x362684)):null;_0x21468c&&_0x5a48ab&&console[_0xe6c6be(0xf9)]('🔄\x20Gateway\x20mapping\x20(create):',_0x21468c,'->',_0x5a48ab);const _0x4b9236=await database_1[_0xe6c6be(0x115)][_0xe6c6be(0xab)][_0xe6c6be(0x131)]({'data':{'name':_0x2e21d6,'username':_0x5df6fc,'password':_0x3df83b,'telegram':_0x2e1e2c,'shopUrl':_0x5c3e6f,'paymentGateways':_0x5a48ab?JSON[_0xe6c6be(0x11f)](_0x5a48ab):null,'gatewaySettings':_0xe3b1eb?JSON[_0xe6c6be(0x11f)](_0xe3b1eb):null,'usdtPolygonWallet':_0x46e90f?.[_0xe6c6be(0xef)]||null,'usdtTrcWallet':_0x46e90f?.[_0xe6c6be(0x107)]||null,'usdtErcWallet':_0x46e90f?.['usdtErcWallet']||null,'usdcPolygonWallet':_0x46e90f?.[_0xe6c6be(0x155)]||null,'publicKey':_0x58b1c4,'secretKey':_0x4be2eb,'status':_0xe6c6be(0x1a8)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4b9236['id'],'fullName':_0x4b9236[_0xe6c6be(0x85)],'username':_0x4b9236[_0xe6c6be(0x1ab)],'telegramId':_0x4b9236[_0xe6c6be(0x161)],'merchantUrl':_0x4b9236[_0xe6c6be(0x9f)],'gateways':_0x4b9236[_0xe6c6be(0xe2)]?JSON[_0xe6c6be(0x1bd)](_0x4b9236['paymentGateways']):null,'gatewaySettings':_0x4b9236[_0xe6c6be(0x197)]?JSON[_0xe6c6be(0x1bd)](_0x4b9236[_0xe6c6be(0x197)]):null,'publicKey':_0x4b9236['publicKey'],'wallets':{'usdtPolygonWallet':_0x4b9236['usdtPolygonWallet'],'usdtTrcWallet':_0x4b9236[_0xe6c6be(0x107)],'usdtErcWallet':_0x4b9236[_0xe6c6be(0xbc)],'usdcPolygonWallet':_0x4b9236[_0xe6c6be(0x155)]},'status':_0x4b9236[_0xe6c6be(0xb1)],'createdAt':_0x4b9236[_0xe6c6be(0xf1)]};}async[a36_0x2767ca(0x150)](_0x5b5f80){const _0x580cac=a36_0x2767ca;await database_1[_0x580cac(0x115)][_0x580cac(0xab)]['delete']({'where':{'id':_0x5b5f80}});}[a36_0x2767ca(0x174)](_0x1f13ca,_0xd6eaa1,_0x2f70bd){const _0x4c79de=a36_0x2767ca,_0x2b3251=new Map(),_0x8ee5f5=new Date(_0xd6eaa1);while(_0x8ee5f5<=_0x2f70bd){const _0x5bf6ba=_0x8ee5f5[_0x4c79de(0x1c1)]()['split']('T')[0x0];_0x2b3251[_0x4c79de(0x14d)](_0x5bf6ba,{'revenue':0x0,'count':0x0}),_0x8ee5f5['setDate'](_0x8ee5f5[_0x4c79de(0x137)]()+0x1);}for(const _0x4e6910 of _0x1f13ca){const _0x411bf6=_0x4e6910[_0x4c79de(0xf1)][_0x4c79de(0x1c1)]()[_0x4c79de(0x126)]('T')[0x0],_0x4821bc=_0x2b3251[_0x4c79de(0x1b2)](_0x411bf6);_0x4821bc&&(_0x4821bc['count']+=0x1,_0x4e6910[_0x4c79de(0xb1)]==='PAID'&&(_0x4e6910[_0x4c79de(0x16e)]?_0x4821bc[_0x4c79de(0xd3)]+=_0x4e6910[_0x4c79de(0x16e)]:console[_0x4c79de(0xf9)](_0x4c79de(0x1a0)+_0x4e6910['id']+_0x4c79de(0x14b))));}const _0x35b0ef=[],_0x4a6c3c=[];for(const [_0x249ce0,_0x47b975]of _0x2b3251){_0x35b0ef[_0x4c79de(0x1a6)]({'date':_0x249ce0,'amount':Math[_0x4c79de(0x1c4)](_0x47b975[_0x4c79de(0xd3)]*0x64)/0x64}),_0x4a6c3c[_0x4c79de(0x1a6)]({'date':_0x249ce0,'count':_0x47b975[_0x4c79de(0xcf)]});}return{'dailyRevenue':_0x35b0ef,'dailyPayments':_0x4a6c3c};}}exports[a36_0x2767ca(0xb3)]=AdminService;