'use strict';const a35_0x58e255=a35_0x5ace;(function(_0x26807e,_0xc5fc4c){const _0x252f05=a35_0x5ace,_0x905543=_0x26807e();while(!![]){try{const _0x38a467=-parseInt(_0x252f05(0x1ef))/0x1*(parseInt(_0x252f05(0x1d0))/0x2)+parseInt(_0x252f05(0x11b))/0x3+parseInt(_0x252f05(0x16f))/0x4+-parseInt(_0x252f05(0x1c2))/0x5*(parseInt(_0x252f05(0x14a))/0x6)+parseInt(_0x252f05(0x162))/0x7*(-parseInt(_0x252f05(0x146))/0x8)+parseInt(_0x252f05(0x119))/0x9*(parseInt(_0x252f05(0x1a8))/0xa)+parseInt(_0x252f05(0x1c4))/0xb;if(_0x38a467===_0xc5fc4c)break;else _0x905543['push'](_0x905543['shift']());}catch(_0x4d7527){_0x905543['push'](_0x905543['shift']());}}}(a35_0x3267,0x7b9f4));function a35_0x5ace(_0xf03754,_0x37f4d1){const _0x3267ae=a35_0x3267();return a35_0x5ace=function(_0x5ace21,_0x1ce667){_0x5ace21=_0x5ace21-0x10f;let _0x3860ad=_0x3267ae[_0x5ace21];return _0x3860ad;},a35_0x5ace(_0xf03754,_0x37f4d1);}var __importDefault=this&&this[a35_0x58e255(0x1af)]||function(_0x4d43b7){const _0x4b8c23=a35_0x58e255;return _0x4d43b7&&_0x4d43b7[_0x4b8c23(0x189)]?_0x4d43b7:{'default':_0x4d43b7};};Object[a35_0x58e255(0x18c)](exports,a35_0x58e255(0x189),{'value':!![]}),exports[a35_0x58e255(0x121)]=void 0x0;const database_1=__importDefault(require(a35_0x58e255(0x14f))),bcryptjs_1=__importDefault(require(a35_0x58e255(0x202))),crypto_1=__importDefault(require(a35_0x58e255(0x14e))),currencyService_1=require(a35_0x58e255(0x196)),gateway_1=require(a35_0x58e255(0x14c));function a35_0x3267(){const _0x3c713a=['availableBalance','../types/gateway','amountUSDT','crypto','../config/database','fullName','split','orderId','0000','toString','username','hex','KLYME\x20EU','\x20status:\x20','totalPayments','payout','set','customerIp','updatedAt','dailyPayments','\x20USDT\x20(total\x20paid\x20to\x20merchants)','password',',\x20successful:\x20','336pWfFKN','totalCommissionRate','averageCommissionRate','\x20became\x20PAID:\x20+','shopId','getFullYear','polygon_usdc','not\x20specified','üí∞\x20Shop\x20','üí∞\x20Current\x20shop\x20balance:\x20','\x20paid\x20payments\x20for\x20analysis','toUpperCase','PAID','292616CDTEvw','revenue','createUser','txid','admin','Noda','all','network','customerCountry','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','‚úÖ\x20Customer\x20data\x20updated\x20for\x20payment\x20','whiteUrl','\x20\x20\x20Payout\x20amount:\x20','\x20USDT\x20total','getPayoutById','\x27\x20not\x20found.\x20Available\x20gateways:\x20','createPayout','\x20\x20\x20üè™\x20Gateway\x20earnings:\x20','some','deleteUser','gateways','\x27\x20to\x20name\x20\x27','paymentGateways','test_gateway','merchantEarnings','customerEmail','__esModule','\x27\x20->\x20name\x20\x27','getAllPayouts','defineProperty','update','get','usdtPolygonWallet','week','\x20\x20\x20üë§\x20Merchant\x20earnings:\x20','updatePaymentStatus','paymentsCount','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','‚úÖ\x20Using\x20gateway\x20filter:\x20\x27','./currencyService','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','stringify','wallet','Rapyd','periodFrom','delete','averageCheckUSDT','convertToUSDT','2020-01-01','üí±\x20Currency\x20filter\x20applied:\x20','getAllUsers','toFixed','failureMessage','usdcPolygonWallet','parse','chargebackAmount','entries','7089190BuqDSv','REFUND','üìä\x20Getting\x20merchant\x20statistics\x20with\x20filters:','toISOString','\x20\x20\x20Transaction\x20hash:\x20','gte','üîç\x20Using\x20gateway\x20\x27','__importDefault','currencyService','Payment\x20not\x20found','\x20payments)','üìä\x20Payout\x20statistics\x20calculated:','localeCompare','üìä\x20Total\x20payments\x20(including\x20failed):\x20','publicKey','SUSPENDED','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','findMany','KLYME\x20GB','getMonth','periodTo','updateUser','turnover','create','paidAt','telegram','5PVIlGx','üîÑ\x20Converted\x20gateway\x20name\x20\x27','13009755yHaxqX','hash','üí≥\x20Payout\x20wallet\x20for\x20','dateTo','üí∞\x20Creating\x20payout\x20for\x20shop\x20','_count',':\x20commission\x20=\x20','default','getUserById','forEach','\x20merchants,\x20','$transaction','1586346eUorxP','KLYME\x20DE','statusChangedBy','thisMonth','ACTIVE','not\x20set','getTime','ceil','successUrl','findUnique','suspendUser','amountAfterCommissionUSDT','length','generateDailyStatistics','totalTurnover','getPaymentById','\x20no\x20longer\x20PAID:\x20-','\x20for\x20shop\x20','üìä\x20Gateway\x20filter\x20applied:','log','month','custom','merchantEarningsUSDT','shopUrl','Insufficient\x20balance.\x20Available:\x20','getPayoutStats','\x27\x20->\x20ID\x20\x27','gatewayOrderId','üí∞\x20Payment\x20','randomBytes','balance','1ZaQPWp','gatewaySettings','updateCustomerData','year','sort','üîÑ\x20Admin\x20updating\x20payment\x20','commissionUSDT','includes','üìä\x20Sorting\x20payments\x20by\x20','COMPLETED','üí∞\x20Found\x20','\x20USDT\x20from\x20balance','üí∞\x20[PAYOUT]\x20Gateway\x20','Username\x20already\x20exists','adminNotes','\x20\x20\x20üí∞\x20Total\x20turnover:\x20','activateUser','\x20order','totalPaidOut','bcryptjs','lte','dateFrom','üìä\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','getMerchantsSelection','üîÑ\x20Converted\x20gateway\x20ID\x20\x27','gatewayEarnings','externalPaymentUrl','üìä\x20Final\x20WHERE\x20conditions:','\x27\x20(from\x20\x27','payment','\x20active\x20merchants\x20for\x20selection','üí∏\x20CHARGEBACK\x20penalty:\x20-','findFirst','\x20\x20\x20üåç\x20Country:\x20','customerUa','Error\x20processing\x20payment\x20','usdtErcWallet','getGatewayNameById','\x20\x20\x20üåê\x20IP:\x20','\x20->\x20','period','groupBy','failUrl','_sum','\x20\x20\x20üí∞\x20Total\x20payout:\x20','üìä\x20Merchants\x20awaiting\x20payout:\x20','usdtTrcWallet','toLowerCase','push','name','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','date','insensitive','customerName','dailyRevenue','setDate','merchantUrl','9lfRzuz','pk_','1392063SegXom','\x20\x20\x20Current\x20balance:\x20','üìÖ\x20Period:\x20','createdAt','values','wallets','AdminService','amount','map','\x20balance\x20updated:\x20','awaitingPayout','turnoverUSDT','Telegram\x20username\x20already\x20exists','paidOutUSDT','desc','getSystemStatistics','CHARGEBACK','getGatewayDisplayName','getMerchantsAwaitingPayout','‚ö†Ô∏è\x20Gateway\x20\x27','\x20USDT\x20to\x20balance','\x20USDT\x20(same\x20as\x20awaiting)','currency','\x20in\x20','telegramId','statusChangedAt','join','üìã\x20Getting\x20merchants\x20selection\x20list...','round','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','NONEXISTENT_GATEWAY_FILTER','error','commission','getGatewayIdByName','totalAmountUSDT','reduce','shop','asc','gateway','erc20','90d','\x20USDT','\x20\x20\x20Balance:\x20','72024TkabHB','getDate','status','count','4182756mCEpxO'];a35_0x3267=function(){return _0x3c713a;};return a35_0x3267();}class AdminService{async[a35_0x58e255(0x1e9)](){const _0x183d13=a35_0x58e255;console['log']('üìä\x20Calculating\x20payout\x20statistics...');const _0x1407d1=await database_1[_0x183d13(0x1cb)]['shop']['aggregate']({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':'ACTIVE'}}),_0x95a986=new Date(),_0x112d3a=new Date(_0x95a986['getFullYear'](),_0x95a986[_0x183d13(0x1bb)](),0x1),_0x32f9d3=new Date(_0x95a986[_0x183d13(0x167)](),_0x95a986[_0x183d13(0x1bb)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x32155c=await database_1['default'][_0x183d13(0x15a)]['aggregate']({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x112d3a,'lte':_0x32f9d3},'status':_0x183d13(0x1f8)}}),_0x5f0314=_0x1407d1[_0x183d13(0x21a)][_0x183d13(0x201)]||0x0,_0x31eb31=_0x1407d1[_0x183d13(0x21a)]['balance']||0x0,_0x1288b3=_0x32155c[_0x183d13(0x21a)]['amount']||0x0,_0xe1845d={'totalPayout':Math[_0x183d13(0x137)](_0x5f0314*0x64)/0x64,'awaitingPayout':Math[_0x183d13(0x137)](_0x31eb31*0x64)/0x64,'thisMonth':Math[_0x183d13(0x137)](_0x1288b3*0x64)/0x64,'availableBalance':Math[_0x183d13(0x137)](_0x31eb31*0x64)/0x64};return console['log'](_0x183d13(0x1b3)),console[_0x183d13(0x1e3)](_0x183d13(0x21b)+_0xe1845d['totalPayout']+_0x183d13(0x15f)),console['log'](_0x183d13(0x178)+_0xe1845d[_0x183d13(0x125)]+'\x20USDT\x20(total\x20merchant\x20balances)'),console[_0x183d13(0x1e3)]('\x20\x20\x20üíµ\x20Available\x20balance:\x20'+_0xe1845d[_0x183d13(0x14b)]+_0x183d13(0x130)),console[_0x183d13(0x1e3)]('\x20\x20\x20üìÖ\x20This\x20month:\x20'+_0xe1845d[_0x183d13(0x1d3)]+_0x183d13(0x144)),_0xe1845d;}async[a35_0x58e255(0x1f1)](_0x24cc3e,_0x4b4775){const _0x2e549d=a35_0x58e255;console[_0x2e549d(0x1e3)]('üîÑ\x20Updating\x20customer\x20data\x20for\x20payment\x20'+_0x24cc3e+':',_0x4b4775);const _0x3f5f58=await database_1[_0x2e549d(0x1cb)][_0x2e549d(0x20c)][_0x2e549d(0x1d9)]({'where':{'id':_0x24cc3e},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x3f5f58)throw new Error(_0x2e549d(0x1b1));const _0x5f4241={};_0x4b4775[_0x2e549d(0x177)]!==undefined&&(_0x5f4241[_0x2e549d(0x177)]=_0x4b4775['customerCountry']||null);_0x4b4775[_0x2e549d(0x15c)]!==undefined&&(_0x5f4241[_0x2e549d(0x15c)]=_0x4b4775[_0x2e549d(0x15c)]||null);_0x4b4775['customerUa']!==undefined&&(_0x5f4241[_0x2e549d(0x211)]=_0x4b4775[_0x2e549d(0x211)]||null);const _0x3f6466=await database_1[_0x2e549d(0x1cb)][_0x2e549d(0x20c)][_0x2e549d(0x18d)]({'where':{'id':_0x24cc3e},'data':{..._0x5f4241,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x2e549d(0x1e3)](_0x2e549d(0x179)+_0x24cc3e),console[_0x2e549d(0x1e3)](_0x2e549d(0x210)+_0x3f5f58[_0x2e549d(0x177)]+'\x20->\x20'+_0x3f6466[_0x2e549d(0x177)]),console['log'](_0x2e549d(0x215)+_0x3f5f58['customerIp']+_0x2e549d(0x216)+_0x3f6466[_0x2e549d(0x15c)]),console[_0x2e549d(0x1e3)]('\x20\x20\x20üñ•Ô∏è\x20User\x20Agent:\x20'+(_0x3f5f58[_0x2e549d(0x211)]?_0x2e549d(0x15b):_0x2e549d(0x1d5))+_0x2e549d(0x216)+(_0x3f6466[_0x2e549d(0x211)]?_0x2e549d(0x15b):_0x2e549d(0x1d5))),_0x3f6466;}async[a35_0x58e255(0x12a)](_0x358085){const _0x20fdd4=a35_0x58e255,_0x4cf6c6=new Date();let _0x238128;switch(_0x358085){case'7d':_0x238128=new Date(_0x4cf6c6[_0x20fdd4(0x1d6)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x238128=new Date(_0x4cf6c6[_0x20fdd4(0x1d6)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x20fdd4(0x143):_0x238128=new Date(_0x4cf6c6[_0x20fdd4(0x1d6)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x238128=new Date(_0x4cf6c6[_0x20fdd4(0x1d6)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x155659,_0x3471da,_0x9f4b40,_0x2f5669,_0x24af1d,_0x2eb6f9,_0x4bb42c]=await Promise['all']([database_1[_0x20fdd4(0x1cb)]['shop'][_0x20fdd4(0x149)](),database_1['default'][_0x20fdd4(0x13f)][_0x20fdd4(0x149)]({'where':{'status':_0x20fdd4(0x1d4)}}),database_1[_0x20fdd4(0x1cb)][_0x20fdd4(0x20c)][_0x20fdd4(0x149)]({'where':{'createdAt':{'gte':_0x238128},'gateway':{'not':_0x20fdd4(0x186)}}}),database_1[_0x20fdd4(0x1cb)][_0x20fdd4(0x20c)][_0x20fdd4(0x149)]({'where':{'status':'PAID','createdAt':{'gte':_0x238128},'gateway':{'not':_0x20fdd4(0x186)}}}),database_1[_0x20fdd4(0x1cb)][_0x20fdd4(0x20c)][_0x20fdd4(0x1b9)]({'where':{'status':_0x20fdd4(0x16e),'createdAt':{'gte':_0x238128},'gateway':{'not':_0x20fdd4(0x186)}},'select':{'amount':!![],'currency':!![]}}),database_1[_0x20fdd4(0x1cb)]['payment']['findMany']({'where':{'gateway':{'not':'test_gateway'}},'take':0xa,'orderBy':{'createdAt':_0x20fdd4(0x129)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x20fdd4(0x20c)]['findMany']({'where':{'createdAt':{'gte':_0x238128},'gateway':{'not':_0x20fdd4(0x186)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x95b701=0x0;for(const _0xa0f164 of _0x24af1d){const _0xfcd151=await currencyService_1[_0x20fdd4(0x1b0)][_0x20fdd4(0x19e)](_0xa0f164[_0x20fdd4(0x122)],_0xa0f164[_0x20fdd4(0x131)]);_0x95b701+=_0xfcd151;}const _0x524307=this[_0x20fdd4(0x1dd)](_0x4bb42c,_0x238128,_0x4cf6c6),_0x4de1be=_0x9f4b40>0x0?_0x2f5669/_0x9f4b40*0x64:0x0;return{'totalShops':_0x155659,'activeShops':_0x3471da,'totalPayments':_0x9f4b40,'successfulPayments':_0x2f5669,'totalRevenue':Math[_0x20fdd4(0x137)](_0x95b701*0x64)/0x64,'conversionRate':Math[_0x20fdd4(0x137)](_0x4de1be*0x64)/0x64,'dailyRevenue':_0x524307[_0x20fdd4(0x116)],'dailyPayments':_0x524307[_0x20fdd4(0x15e)],'recentPayments':_0x2eb6f9[_0x20fdd4(0x123)](_0x22d7cd=>({'id':_0x22d7cd['id'],'amount':_0x22d7cd[_0x20fdd4(0x122)],'currency':_0x22d7cd[_0x20fdd4(0x131)],'status':_0x22d7cd[_0x20fdd4(0x148)],'gateway':_0x22d7cd['gateway'],'shop':_0x22d7cd[_0x20fdd4(0x13f)],'createdAt':_0x22d7cd[_0x20fdd4(0x11e)]}))};}async['getMerchantStatistics'](_0x541777){const _0x178d41=a35_0x58e255;console[_0x178d41(0x1e3)](_0x178d41(0x1aa),_0x541777);let _0x41b1e9,_0x59a10c=new Date();if(_0x541777[_0x178d41(0x217)]===_0x178d41(0x1e5)&&_0x541777[_0x178d41(0x204)]&&_0x541777['dateTo'])_0x41b1e9=new Date(_0x541777[_0x178d41(0x204)]),_0x59a10c=new Date(_0x541777[_0x178d41(0x1c7)]);else{const _0x25781e=new Date();switch(_0x541777[_0x178d41(0x217)]){case _0x178d41(0x190):_0x41b1e9=new Date(_0x25781e[_0x178d41(0x1d6)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x178d41(0x1e4):_0x41b1e9=new Date(_0x25781e[_0x178d41(0x1d6)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x178d41(0x1f2):_0x41b1e9=new Date(_0x25781e['getTime']()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x178d41(0x175):default:_0x41b1e9=new Date(_0x178d41(0x19f));break;}}console['log'](_0x178d41(0x11d)+_0x41b1e9[_0x178d41(0x1ab)]()+'\x20to\x20'+_0x59a10c[_0x178d41(0x1ab)]());const _0xd4f623={'status':_0x178d41(0x16e),'gateway':{'not':_0x178d41(0x186)},'paidAt':{'gte':_0x41b1e9,'lte':_0x59a10c}};_0x541777[_0x178d41(0x166)]&&(_0xd4f623['shopId']=_0x541777[_0x178d41(0x166)]);const _0x3e7c16=await database_1[_0x178d41(0x1cb)][_0x178d41(0x20c)]['findMany']({'where':_0xd4f623,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x178d41(0x1e3)](_0x178d41(0x1f9)+_0x3e7c16['length']+_0x178d41(0x16c));const _0x35553e={'gateway':{'not':'test_gateway'},'createdAt':{'gte':_0x41b1e9,'lte':_0x59a10c}};_0x541777[_0x178d41(0x166)]&&(_0x35553e[_0x178d41(0x166)]=_0x541777[_0x178d41(0x166)]);const _0x3914bb=await database_1[_0x178d41(0x1cb)][_0x178d41(0x20c)][_0x178d41(0x149)]({'where':_0x35553e});console['log'](_0x178d41(0x1b5)+_0x3914bb+_0x178d41(0x161)+_0x3e7c16[_0x178d41(0x1dc)]);let _0x12373c=0x0,_0x358ca0=0x0,_0x3183e8=0x0;const _0x4936fb={},_0x1631cc={},_0x35a11b={};for(const _0x40f656 of _0x3e7c16){try{const _0x57bb24=await currencyService_1[_0x178d41(0x1b0)]['convertToUSDT'](_0x40f656[_0x178d41(0x122)],_0x40f656[_0x178d41(0x131)]);let _0xdd323e={};if(_0x40f656[_0x178d41(0x13f)][_0x178d41(0x1f0)])try{_0xdd323e=JSON[_0x178d41(0x1a5)](_0x40f656['shop'][_0x178d41(0x1f0)]);}catch(_0x5a72af){console[_0x178d41(0x13a)](_0x178d41(0x138)+_0x40f656[_0x178d41(0x166)]+':',_0x5a72af);}let _0x30304a={},_0xd8a11e=0xa;for(const [_0x1d18e2,_0x338d10]of Object[_0x178d41(0x1a7)](_0xdd323e)){if(_0x1d18e2[_0x178d41(0x10f)]()===_0x40f656[_0x178d41(0x141)][_0x178d41(0x10f)]()){_0x30304a=_0x338d10,_0xd8a11e=_0x338d10[_0x178d41(0x13b)]||0xa;break;}}const _0x4ff988=_0x57bb24*(_0xd8a11e/0x64),_0x5c0f9e=_0x57bb24-_0x4ff988;_0x12373c+=_0x57bb24,_0x358ca0+=_0x5c0f9e,_0x3183e8+=_0x4ff988;!_0x4936fb[_0x40f656[_0x178d41(0x141)]]&&(_0x4936fb[_0x40f656['gateway']]={'gateway':_0x40f656['gateway'],'gatewayDisplayName':this['getGatewayDisplayName'](_0x40f656['gateway']),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x4936fb[_0x40f656['gateway']][_0x178d41(0x193)]++,_0x4936fb[_0x40f656[_0x178d41(0x141)]][_0x178d41(0x126)]+=_0x57bb24,_0x4936fb[_0x40f656['gateway']][_0x178d41(0x1f5)]+=_0x4ff988,_0x4936fb[_0x40f656['gateway']][_0x178d41(0x1e6)]+=_0x5c0f9e,_0x4936fb[_0x40f656['gateway']][_0x178d41(0x163)]+=_0xd8a11e;!_0x541777[_0x178d41(0x166)]&&(!_0x1631cc[_0x40f656[_0x178d41(0x166)]]&&(_0x1631cc[_0x40f656[_0x178d41(0x166)]]={'shopId':_0x40f656['shopId'],'shopName':_0x40f656[_0x178d41(0x13f)][_0x178d41(0x111)],'shopUsername':_0x40f656[_0x178d41(0x13f)][_0x178d41(0x155)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x1631cc[_0x40f656['shopId']][_0x178d41(0x193)]++,_0x1631cc[_0x40f656['shopId']]['turnoverUSDT']+=_0x57bb24,_0x1631cc[_0x40f656[_0x178d41(0x166)]][_0x178d41(0x1f5)]+=_0x4ff988,_0x1631cc[_0x40f656[_0x178d41(0x166)]]['merchantEarningsUSDT']+=_0x5c0f9e);const _0x47ce6b=_0x40f656[_0x178d41(0x1c0)][_0x178d41(0x1ab)]()[_0x178d41(0x151)]('T')[0x0];!_0x35a11b[_0x47ce6b]&&(_0x35a11b[_0x47ce6b]={'date':_0x47ce6b,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x35a11b[_0x47ce6b][_0x178d41(0x1be)]+=_0x57bb24,_0x35a11b[_0x47ce6b][_0x178d41(0x187)]+=_0x5c0f9e,_0x35a11b[_0x47ce6b][_0x178d41(0x208)]+=_0x4ff988,_0x35a11b[_0x47ce6b]['paymentsCount']++;}catch(_0x2afa4f){console[_0x178d41(0x13a)](_0x178d41(0x212)+_0x40f656['id']+':',_0x2afa4f);}}Object[_0x178d41(0x11f)](_0x4936fb)[_0x178d41(0x1cd)](_0xe6dc7c=>{const _0x222cd8=_0x178d41;_0xe6dc7c[_0x222cd8(0x164)]=_0xe6dc7c[_0x222cd8(0x193)]>0x0?_0xe6dc7c['totalCommissionRate']/_0xe6dc7c[_0x222cd8(0x193)]:0x0,delete _0xe6dc7c[_0x222cd8(0x163)];}),Object['values'](_0x1631cc)[_0x178d41(0x1cd)](_0x55e358=>{const _0x399137=_0x178d41;_0x55e358[_0x399137(0x19d)]=_0x55e358[_0x399137(0x193)]>0x0?_0x55e358['turnoverUSDT']/_0x55e358[_0x399137(0x193)]:0x0;});let _0x6857d0=0x0;if(_0x541777['shopId']){const _0x28b661=await database_1[_0x178d41(0x1cb)][_0x178d41(0x15a)][_0x178d41(0x1b9)]({'where':{'shopId':_0x541777[_0x178d41(0x166)],'status':'COMPLETED','createdAt':{'gte':_0x41b1e9,'lte':_0x59a10c}},'select':{'amount':!![]}});_0x6857d0=_0x28b661['reduce']((_0xed706,_0x3a804c)=>_0xed706+_0x3a804c[_0x178d41(0x122)],0x0);}const _0x509515=_0x3914bb,_0x53971c=_0x3e7c16[_0x178d41(0x1dc)],_0x4ffb6f=_0x53971c>0x0?_0x12373c/_0x53971c:0x0,_0x774261=_0x509515>0x0?Math[_0x178d41(0x137)](_0x53971c/_0x509515*0x2710)/0x64:0x0,_0xe76866=Math[_0x178d41(0x1d7)]((_0x59a10c[_0x178d41(0x1d6)]()-_0x41b1e9['getTime']())/(0x3e8*0x3c*0x3c*0x18)),_0x26cca7={'totalTurnover':Math[_0x178d41(0x137)](_0x12373c*0x64)/0x64,'merchantEarnings':Math[_0x178d41(0x137)](_0x358ca0*0x64)/0x64,'gatewayEarnings':Math[_0x178d41(0x137)](_0x3183e8*0x64)/0x64,'totalPaidOut':Math[_0x178d41(0x137)](_0x6857d0*0x64)/0x64,'averageCheck':Math['round'](_0x4ffb6f*0x64)/0x64,'totalPayments':_0x509515,'successfulPayments':_0x53971c,'conversionRate':_0x774261,'gatewayBreakdown':Object[_0x178d41(0x11f)](_0x4936fb)[_0x178d41(0x123)](_0x215c19=>({..._0x215c19,'turnoverUSDT':Math[_0x178d41(0x137)](_0x215c19[_0x178d41(0x126)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x215c19[_0x178d41(0x1f5)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x178d41(0x137)](_0x215c19[_0x178d41(0x1e6)]*0x64)/0x64,'averageCommissionRate':Math['round'](_0x215c19[_0x178d41(0x164)]*0x64)/0x64})),'merchantBreakdown':_0x541777['shopId']?undefined:Object[_0x178d41(0x11f)](_0x1631cc)[_0x178d41(0x123)](_0x1119e6=>({..._0x1119e6,'turnoverUSDT':Math[_0x178d41(0x137)](_0x1119e6[_0x178d41(0x126)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x1119e6[_0x178d41(0x1f5)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x178d41(0x137)](_0x1119e6[_0x178d41(0x1e6)]*0x64)/0x64,'paidOutUSDT':Math[_0x178d41(0x137)](_0x1119e6[_0x178d41(0x128)]*0x64)/0x64,'averageCheckUSDT':Math[_0x178d41(0x137)](_0x1119e6[_0x178d41(0x19d)]*0x64)/0x64})),'dailyData':Object[_0x178d41(0x11f)](_0x35a11b)[_0x178d41(0x123)](_0x574370=>({..._0x574370,'turnover':Math[_0x178d41(0x137)](_0x574370[_0x178d41(0x1be)]*0x64)/0x64,'merchantEarnings':Math[_0x178d41(0x137)](_0x574370[_0x178d41(0x187)]*0x64)/0x64,'gatewayEarnings':Math[_0x178d41(0x137)](_0x574370[_0x178d41(0x208)]*0x64)/0x64}))[_0x178d41(0x1f3)]((_0x585cdb,_0x2253ef)=>_0x585cdb[_0x178d41(0x113)][_0x178d41(0x1b4)](_0x2253ef['date'])),'periodInfo':{'from':_0x41b1e9,'to':_0x59a10c,'periodType':_0x541777[_0x178d41(0x217)]||_0x178d41(0x1e5),'daysCount':_0xe76866}};return console[_0x178d41(0x1e3)]('üìä\x20Merchant\x20statistics\x20calculated:'),console[_0x178d41(0x1e3)](_0x178d41(0x1fe)+_0x26cca7[_0x178d41(0x1de)]+_0x178d41(0x144)),console['log'](_0x178d41(0x191)+_0x26cca7[_0x178d41(0x187)]+_0x178d41(0x144)),console['log'](_0x178d41(0x180)+_0x26cca7[_0x178d41(0x208)]+_0x178d41(0x144)),console[_0x178d41(0x1e3)]('\x20\x20\x20üìä\x20Total\x20payments:\x20'+_0x26cca7[_0x178d41(0x159)]),_0x26cca7;}async[a35_0x58e255(0x206)](){const _0x8248a9=a35_0x58e255;console[_0x8248a9(0x1e3)](_0x8248a9(0x136));const _0x3b3038=await database_1[_0x8248a9(0x1cb)]['shop']['findMany']({'where':{'status':_0x8248a9(0x1d4)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x8248a9(0x140)}});return console[_0x8248a9(0x1e3)]('üìã\x20Found\x20'+_0x3b3038[_0x8248a9(0x1dc)]+_0x8248a9(0x20d)),_0x3b3038[_0x8248a9(0x123)](_0x33d20a=>({'id':_0x33d20a['id'],'username':_0x33d20a[_0x8248a9(0x155)],'name':_0x33d20a[_0x8248a9(0x111)]}));}[a35_0x58e255(0x12c)](_0x1f75b1){const _0x4223a8=a35_0x58e255,_0x15e8fa={'test_gateway':'Test\x20Gateway','plisio':'Plisio','rapyd':_0x4223a8(0x19a),'noda':_0x4223a8(0x174),'cointopay':'CoinToPay','klyme_eu':_0x4223a8(0x157),'klyme_gb':_0x4223a8(0x1ba),'klyme_de':_0x4223a8(0x1d1)};return _0x15e8fa[_0x1f75b1]||_0x1f75b1;}async[a35_0x58e255(0x12d)](_0x24d30c){const _0x5db03f=a35_0x58e255,{page:_0x117705,limit:_0x3b73f7,minAmount:_0x5d3b9b,search:_0x62dea6}=_0x24d30c,_0x1cd4de=(_0x117705-0x1)*_0x3b73f7;console[_0x5db03f(0x1e3)](_0x5db03f(0x205),_0x24d30c);const _0x5a0c35={'balance':{'gt':0x0},'status':'ACTIVE'};_0x5d3b9b&&(_0x5a0c35[_0x5db03f(0x1ee)][_0x5db03f(0x1ad)]=_0x5d3b9b);_0x62dea6&&(_0x5a0c35['OR']=[{'name':{'contains':_0x62dea6,'mode':_0x5db03f(0x114)}},{'username':{'contains':_0x62dea6,'mode':_0x5db03f(0x114)}}]);const [_0x11f3d2,_0x457d86]=await Promise[_0x5db03f(0x175)]([database_1['default']['shop'][_0x5db03f(0x1b9)]({'where':_0x5a0c35,'skip':_0x1cd4de,'take':_0x3b73f7,'orderBy':{'balance':_0x5db03f(0x129)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1['default'][_0x5db03f(0x13f)]['count']({'where':_0x5a0c35})]);console['log']('üí∞\x20Found\x20'+_0x11f3d2[_0x5db03f(0x1dc)]+'\x20merchants\x20with\x20positive\x20balance');const _0x7024da=await Promise[_0x5db03f(0x175)](_0x11f3d2[_0x5db03f(0x123)](async _0x331045=>{const _0x2fcab9=_0x5db03f,[_0x942f74,_0x1123c0,_0x1117a8]=await Promise[_0x2fcab9(0x175)]([database_1[_0x2fcab9(0x1cb)][_0x2fcab9(0x20c)][_0x2fcab9(0x149)]({'where':{'shopId':_0x331045['id'],'status':'PAID','amountUSDT':{'not':null}}}),database_1[_0x2fcab9(0x1cb)]['payment'][_0x2fcab9(0x20f)]({'where':{'shopId':_0x331045['id'],'status':_0x2fcab9(0x16e),'amountUSDT':{'not':null}},'orderBy':{'paidAt':_0x2fcab9(0x140)},'select':{'paidAt':!![]}}),database_1[_0x2fcab9(0x1cb)][_0x2fcab9(0x20c)][_0x2fcab9(0x218)]({'by':[_0x2fcab9(0x141)],'where':{'shopId':_0x331045['id'],'status':_0x2fcab9(0x16e),'amountUSDT':{'not':null}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x491ded=await Promise[_0x2fcab9(0x175)](_0x1117a8[_0x2fcab9(0x123)](async _0xd02076=>{const _0x36790f=_0x2fcab9;let _0x20dff9=0xa;if(_0x331045[_0x36790f(0x1f0)])try{const _0x17713a=JSON[_0x36790f(0x1a5)](_0x331045[_0x36790f(0x1f0)]);for(const [_0x101171,_0x5c9410]of Object[_0x36790f(0x1a7)](_0x17713a)){if(_0x101171[_0x36790f(0x10f)]()===_0xd02076[_0x36790f(0x141)]['toLowerCase']()){_0x20dff9=_0x5c9410[_0x36790f(0x13b)]||0xa,console['log'](_0x36790f(0x1fb)+_0xd02076[_0x36790f(0x141)]+_0x36790f(0x1e1)+_0x331045['id']+_0x36790f(0x1ca)+_0x20dff9+'%');break;}}}catch(_0x141c37){console['error']('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x331045['id']+':',_0x141c37);}const _0x473452=_0xd02076[_0x36790f(0x21a)][_0x36790f(0x14d)]||0x0,_0x3728b4=_0x473452*(0x1-_0x20dff9/0x64);return{'gateway':_0xd02076[_0x36790f(0x141)],'count':_0xd02076[_0x36790f(0x1c9)]['id'],'amountUSDT':Math[_0x36790f(0x137)](_0x473452*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x36790f(0x137)](_0x3728b4*0x64)/0x64,'commission':_0x20dff9};})),_0xba0891=_0x491ded[_0x2fcab9(0x13e)]((_0x484cfb,_0x417639)=>_0x484cfb+_0x417639[_0x2fcab9(0x14d)],0x0),_0x49528f=_0x491ded[_0x2fcab9(0x13e)]((_0x54c588,_0x48581c)=>_0x54c588+_0x48581c[_0x2fcab9(0x1db)],0x0);return{'id':_0x331045['id'],'fullName':_0x331045[_0x2fcab9(0x111)],'username':_0x331045[_0x2fcab9(0x155)],'telegramId':_0x331045[_0x2fcab9(0x1c1)],'merchantUrl':_0x331045['shopUrl'],'wallets':{'usdtPolygonWallet':_0x331045['usdtPolygonWallet'],'usdtTrcWallet':_0x331045[_0x2fcab9(0x21d)],'usdtErcWallet':_0x331045[_0x2fcab9(0x213)],'usdcPolygonWallet':_0x331045['usdcPolygonWallet']},'totalAmountUSDT':Math[_0x2fcab9(0x137)](_0xba0891*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x2fcab9(0x137)](_0x49528f*0x64)/0x64,'paymentsCount':_0x942f74,'oldestPaymentDate':_0x1123c0?.[_0x2fcab9(0x1c0)]||_0x331045[_0x2fcab9(0x11e)],'gatewayBreakdown':_0x491ded};})),_0xda8373=_0x7024da['reduce']((_0x37c49c,_0x228a8a)=>_0x37c49c+_0x228a8a[_0x5db03f(0x13d)],0x0),_0xb52741=_0x7024da[_0x5db03f(0x13e)]((_0x493e67,_0x1e3869)=>_0x493e67+_0x1e3869['totalAmountAfterCommissionUSDT'],0x0);return console['log'](_0x5db03f(0x21c)+_0x457d86+_0x5db03f(0x1ce)+Math[_0x5db03f(0x137)](_0xb52741*0x64)/0x64+_0x5db03f(0x17c)),{'merchants':_0x7024da,'pagination':{'page':_0x117705,'limit':_0x3b73f7,'total':_0x457d86,'totalPages':Math[_0x5db03f(0x1d7)](_0x457d86/_0x3b73f7)},'summary':{'totalMerchants':_0x457d86,'totalAmountUSDT':Math[_0x5db03f(0x137)](_0xda8373*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x5db03f(0x137)](_0xb52741*0x64)/0x64}};}async[a35_0x58e255(0x17f)](_0x421df0){const _0x954b85=a35_0x58e255,{shopId:_0x42f8c6,amount:_0x43e31e,network:_0x2fee5e,wallet:_0x36e7f8,notes:_0x16bd0f,txid:_0x513a02,periodFrom:_0x2f5c4b,periodTo:_0x35d170}=_0x421df0,_0x5b75b2=await database_1[_0x954b85(0x1cb)]['$transaction'](async _0x8e7efd=>{const _0xa233ad=_0x954b85,_0x5cc7e1=await _0x8e7efd[_0xa233ad(0x13f)][_0xa233ad(0x1d9)]({'where':{'id':_0x42f8c6},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x5cc7e1)throw new Error('Shop\x20not\x20found');console[_0xa233ad(0x1e3)](_0xa233ad(0x1c8)+_0x5cc7e1['username']+':'),console[_0xa233ad(0x1e3)](_0xa233ad(0x11c)+_0x5cc7e1[_0xa233ad(0x1ee)][_0xa233ad(0x1a2)](0x6)+_0xa233ad(0x144)),console[_0xa233ad(0x1e3)](_0xa233ad(0x17b)+_0x43e31e[_0xa233ad(0x1a2)](0x6)+'\x20USDT'),console[_0xa233ad(0x1e3)](_0xa233ad(0x194)+_0x5cc7e1[_0xa233ad(0x201)][_0xa233ad(0x1a2)](0x6)+_0xa233ad(0x144));if(_0x513a02)console['log'](_0xa233ad(0x1ac)+_0x513a02);if(_0x5cc7e1[_0xa233ad(0x1ee)]<_0x43e31e)throw new Error(_0xa233ad(0x1e8)+_0x5cc7e1[_0xa233ad(0x1ee)][_0xa233ad(0x1a2)](0x6)+'\x20USDT,\x20Requested:\x20'+_0x43e31e[_0xa233ad(0x1a2)](0x6)+_0xa233ad(0x144));let _0x397887=_0x36e7f8;if(!_0x397887){const _0xa75c18=await _0x8e7efd[_0xa233ad(0x13f)][_0xa233ad(0x1d9)]({'where':{'id':_0x42f8c6},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0xa75c18)switch(_0x2fee5e){case'polygon':_0x397887=_0xa75c18[_0xa233ad(0x18f)]||undefined;break;case'trc20':_0x397887=_0xa75c18[_0xa233ad(0x21d)]||undefined;break;case _0xa233ad(0x142):_0x397887=_0xa75c18[_0xa233ad(0x213)]||undefined;break;case _0xa233ad(0x168):_0x397887=_0xa75c18[_0xa233ad(0x1a4)]||undefined;break;}}console[_0xa233ad(0x1e3)](_0xa233ad(0x1c6)+_0x2fee5e+':\x20'+(_0x397887||_0xa233ad(0x169)));const _0x36e67c=await _0x8e7efd[_0xa233ad(0x15a)][_0xa233ad(0x1bf)]({'data':{'shopId':_0x42f8c6,'amount':_0x43e31e,'network':_0x2fee5e,'status':_0xa233ad(0x1f8),'txid':_0x513a02,'notes':_0x16bd0f,'periodFrom':_0x2f5c4b?new Date(_0x2f5c4b):null,'periodTo':_0x35d170?new Date(_0x35d170):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x2a4960=_0x5cc7e1[_0xa233ad(0x1ee)]-_0x43e31e,_0x517a7c=_0x5cc7e1['totalPaidOut']+_0x43e31e;return await _0x8e7efd[_0xa233ad(0x13f)][_0xa233ad(0x18d)]({'where':{'id':_0x42f8c6},'data':{'balance':_0x2a4960,'totalPaidOut':_0x517a7c}}),console[_0xa233ad(0x1e3)](_0xa233ad(0x16a)+_0x5cc7e1['username']+'\x20balance\x20updated:'),console[_0xa233ad(0x1e3)](_0xa233ad(0x145)+_0x5cc7e1[_0xa233ad(0x1ee)][_0xa233ad(0x1a2)](0x6)+_0xa233ad(0x216)+_0x2a4960[_0xa233ad(0x1a2)](0x6)+'\x20USDT\x20(-'+_0x43e31e[_0xa233ad(0x1a2)](0x6)+')'),console[_0xa233ad(0x1e3)]('\x20\x20\x20Total\x20paid\x20out:\x20'+_0x5cc7e1[_0xa233ad(0x201)]['toFixed'](0x6)+_0xa233ad(0x216)+_0x517a7c[_0xa233ad(0x1a2)](0x6)+'\x20USDT\x20(+'+_0x43e31e[_0xa233ad(0x1a2)](0x6)+')'),{'payout':_0x36e67c,'shop':_0x5cc7e1};});return console['log']('‚úÖ\x20Payout\x20created:\x20'+_0x5b75b2[_0x954b85(0x15a)]['id']+_0x954b85(0x1e1)+_0x5b75b2[_0x954b85(0x13f)][_0x954b85(0x155)]+'\x20('+_0x43e31e+'\x20USDT)'),{'id':_0x5b75b2['payout']['id'],'shopId':_0x5b75b2[_0x954b85(0x15a)][_0x954b85(0x166)],'shopName':_0x5b75b2[_0x954b85(0x13f)][_0x954b85(0x111)],'shopUsername':_0x5b75b2[_0x954b85(0x13f)]['username'],'amount':_0x5b75b2[_0x954b85(0x15a)][_0x954b85(0x122)],'network':_0x5b75b2[_0x954b85(0x15a)][_0x954b85(0x176)],'status':_0x5b75b2[_0x954b85(0x15a)][_0x954b85(0x148)],'txid':_0x5b75b2[_0x954b85(0x15a)][_0x954b85(0x172)],'notes':_0x5b75b2[_0x954b85(0x15a)]['notes'],'periodFrom':_0x5b75b2['payout'][_0x954b85(0x19b)],'periodTo':_0x5b75b2[_0x954b85(0x15a)][_0x954b85(0x1bc)],'createdAt':_0x5b75b2[_0x954b85(0x15a)][_0x954b85(0x11e)],'paidAt':_0x5b75b2['payout'][_0x954b85(0x1c0)]};}async[a35_0x58e255(0x18b)](_0x4176ba){const _0x3b23d4=a35_0x58e255,{page:_0x139e29,limit:_0x2fd579,shopId:_0x5acb5d,network:_0x2e7b56,dateFrom:_0x13da82,dateTo:_0x31f5cb,search:_0x472799}=_0x4176ba,_0x5889a3=(_0x139e29-0x1)*_0x2fd579,_0x5aecd0={};_0x5acb5d&&(_0x5aecd0[_0x3b23d4(0x166)]=_0x5acb5d);_0x2e7b56&&(_0x5aecd0[_0x3b23d4(0x176)]=_0x2e7b56);(_0x13da82||_0x31f5cb)&&(_0x5aecd0[_0x3b23d4(0x11e)]={},_0x13da82&&(_0x5aecd0[_0x3b23d4(0x11e)][_0x3b23d4(0x1ad)]=new Date(_0x13da82)),_0x31f5cb&&(_0x5aecd0[_0x3b23d4(0x11e)][_0x3b23d4(0x203)]=new Date(_0x31f5cb)));_0x472799&&(_0x5aecd0['OR']=[{'shop':{'name':{'contains':_0x472799,'mode':_0x3b23d4(0x114)}}},{'shop':{'username':{'contains':_0x472799,'mode':_0x3b23d4(0x114)}}},{'notes':{'contains':_0x472799,'mode':_0x3b23d4(0x114)}}]);const [_0x50b6b3,_0x28e649]=await Promise['all']([database_1[_0x3b23d4(0x1cb)]['payout'][_0x3b23d4(0x1b9)]({'where':_0x5aecd0,'skip':_0x5889a3,'take':_0x2fd579,'orderBy':{'createdAt':_0x3b23d4(0x129)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'wallet':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x3b23d4(0x1cb)][_0x3b23d4(0x15a)][_0x3b23d4(0x149)]({'where':_0x5aecd0})]);return{'payouts':_0x50b6b3[_0x3b23d4(0x123)](_0x3c5463=>({'id':_0x3c5463['id'],'shopId':_0x3c5463[_0x3b23d4(0x166)],'shopName':_0x3c5463[_0x3b23d4(0x13f)][_0x3b23d4(0x111)],'shopUsername':_0x3c5463[_0x3b23d4(0x13f)][_0x3b23d4(0x155)],'amount':_0x3c5463['amount'],'network':_0x3c5463[_0x3b23d4(0x176)],'wallet':_0x3c5463[_0x3b23d4(0x199)],'status':_0x3c5463['status'],'txid':_0x3c5463[_0x3b23d4(0x172)],'notes':_0x3c5463['notes'],'periodFrom':_0x3c5463[_0x3b23d4(0x19b)],'periodTo':_0x3c5463[_0x3b23d4(0x1bc)],'createdAt':_0x3c5463[_0x3b23d4(0x11e)],'paidAt':_0x3c5463[_0x3b23d4(0x1c0)]})),'pagination':{'page':_0x139e29,'limit':_0x2fd579,'total':_0x28e649,'totalPages':Math[_0x3b23d4(0x1d7)](_0x28e649/_0x2fd579)}};}async[a35_0x58e255(0x17d)](_0x57be72){const _0x1d2d61=a35_0x58e255,_0x5932b0=await database_1['default'][_0x1d2d61(0x15a)][_0x1d2d61(0x1d9)]({'where':{'id':_0x57be72},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x5932b0)return null;return{'id':_0x5932b0['id'],'shopId':_0x5932b0[_0x1d2d61(0x166)],'shopName':_0x5932b0['shop'][_0x1d2d61(0x111)],'shopUsername':_0x5932b0[_0x1d2d61(0x13f)][_0x1d2d61(0x155)],'amount':_0x5932b0[_0x1d2d61(0x122)],'network':_0x5932b0['network'],'status':_0x5932b0[_0x1d2d61(0x148)],'txid':_0x5932b0['txid'],'notes':_0x5932b0['notes'],'periodFrom':_0x5932b0[_0x1d2d61(0x19b)],'periodTo':_0x5932b0[_0x1d2d61(0x1bc)],'createdAt':_0x5932b0[_0x1d2d61(0x11e)],'paidAt':_0x5932b0[_0x1d2d61(0x1c0)]};}async['deletePayout'](_0x2424cf){const _0x49aedb=a35_0x58e255;await database_1[_0x49aedb(0x1cb)][_0x49aedb(0x15a)]['delete']({'where':{'id':_0x2424cf}});}async['getAllPayments'](_0x5326f3){const _0x36fba2=a35_0x58e255,{page:_0x291c71,limit:_0x2121fd,status:_0x5db7b5,gateway:_0x36617b,shopId:_0x3ee573,dateFrom:_0x5eb6c1,dateTo:_0x2d082e,search:_0x24638a,currency:_0x4eaad9,sortBy:_0x58e233,sortOrder:_0x5ae1be}=_0x5326f3,_0x527799=(_0x291c71-0x1)*_0x2121fd;console[_0x36fba2(0x1e3)]('üìä\x20Getting\x20payments\x20with\x20filters:',_0x5326f3);const _0x46dc0a=await database_1[_0x36fba2(0x1cb)][_0x36fba2(0x20c)]['groupBy']({'by':[_0x36fba2(0x141)],'_count':{'gateway':!![]}});console[_0x36fba2(0x1e3)]('üìä\x20Available\x20gateways\x20in\x20database:',_0x46dc0a['map'](_0x22813d=>_0x22813d['gateway']+'\x20('+_0x22813d[_0x36fba2(0x1c9)]['gateway']+_0x36fba2(0x1b2)));if(_0x36617b){const _0x1b675c=_0x46dc0a[_0x36fba2(0x181)](_0x43334d=>_0x43334d[_0x36fba2(0x141)][_0x36fba2(0x10f)]()===_0x36617b['toLowerCase']());!_0x1b675c&&_0x36617b[_0x36fba2(0x10f)]()!==_0x36fba2(0x186)&&console[_0x36fba2(0x1e3)]('‚ö†Ô∏è\x20Requested\x20gateway\x20\x27'+_0x36617b+_0x36fba2(0x17e)+_0x46dc0a['map'](_0x117a36=>_0x117a36[_0x36fba2(0x141)])[_0x36fba2(0x135)](',\x20'));}const _0x533406={};_0x5db7b5&&(_0x533406[_0x36fba2(0x148)]=_0x5db7b5['toUpperCase']());if(!_0x36617b)_0x533406[_0x36fba2(0x141)]={'not':_0x36fba2(0x186)};else{if(_0x36617b&&(_0x36617b['toLowerCase']()==='test_gateway'||_0x36617b===_0x36fba2(0x153)))_0x533406['gateway']='test_gateway';else{let _0x5edefc=_0x36617b;const _0x2f4277=(0x0,gateway_1[_0x36fba2(0x214)])(_0x36617b);if(_0x2f4277)_0x5edefc=_0x2f4277,console['log'](_0x36fba2(0x207)+_0x36617b+_0x36fba2(0x184)+_0x5edefc+'\x27');else{const _0x5e3fb7=(0x0,gateway_1[_0x36fba2(0x13c)])(_0x36617b);if(_0x5e3fb7){const _0x4c1389=(0x0,gateway_1[_0x36fba2(0x214)])(_0x5e3fb7);_0x4c1389&&(_0x5edefc=_0x4c1389,console[_0x36fba2(0x1e3)](_0x36fba2(0x1c3)+_0x36617b+_0x36fba2(0x1ea)+_0x5e3fb7+_0x36fba2(0x18a)+_0x5edefc+'\x27'));}else console['log'](_0x36fba2(0x1ae)+_0x36617b+_0x36fba2(0x197));}const _0xa7ba98=await database_1[_0x36fba2(0x1cb)][_0x36fba2(0x20c)]['count']({'where':{'gateway':_0x5edefc['toLowerCase']()},'take':0x1});_0xa7ba98===0x0?(console[_0x36fba2(0x1e3)](_0x36fba2(0x12e)+_0x5edefc+'\x27\x20(from\x20\x27'+_0x36617b+_0x36fba2(0x112)),_0x533406[_0x36fba2(0x141)]=_0x36fba2(0x139)):(_0x533406[_0x36fba2(0x141)]=_0x5edefc[_0x36fba2(0x10f)](),console[_0x36fba2(0x1e3)](_0x36fba2(0x195)+_0x5edefc+_0x36fba2(0x20b)+_0x36617b+'\x27)'));}}console['log'](_0x36fba2(0x1e2),_0x533406[_0x36fba2(0x141)]);_0x3ee573&&(_0x533406[_0x36fba2(0x166)]=_0x3ee573);_0x4eaad9&&(_0x533406[_0x36fba2(0x131)]=_0x4eaad9['toUpperCase'](),console[_0x36fba2(0x1e3)](_0x36fba2(0x1a0)+_0x4eaad9[_0x36fba2(0x16d)]()));(_0x5eb6c1||_0x2d082e)&&(_0x533406[_0x36fba2(0x11e)]={},_0x5eb6c1&&(_0x533406['createdAt'][_0x36fba2(0x1ad)]=new Date(_0x5eb6c1)),_0x2d082e&&(_0x533406[_0x36fba2(0x11e)][_0x36fba2(0x203)]=new Date(_0x2d082e)));_0x24638a&&(_0x533406['OR']=[{'orderId':{'contains':_0x24638a,'mode':_0x36fba2(0x114)}},{'gatewayOrderId':{'contains':_0x24638a,'mode':_0x36fba2(0x114)}},{'customerEmail':{'contains':_0x24638a,'mode':_0x36fba2(0x114)}},{'shop':{'name':{'contains':_0x24638a,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x24638a,'mode':_0x36fba2(0x114)}}}]);console[_0x36fba2(0x1e3)](_0x36fba2(0x20a),JSON[_0x36fba2(0x198)](_0x533406,null,0x2));let _0x132504={'createdAt':_0x36fba2(0x129)};if(_0x58e233){const _0x22dce0=[_0x36fba2(0x122),_0x36fba2(0x11e),_0x36fba2(0x15d),_0x36fba2(0x148),_0x36fba2(0x141),_0x36fba2(0x131)],_0x538ea3=['asc',_0x36fba2(0x129)];if(_0x22dce0[_0x36fba2(0x1f6)](_0x58e233)){const _0x55a9f5=_0x538ea3[_0x36fba2(0x1f6)](_0x5ae1be)?_0x5ae1be:_0x36fba2(0x129);_0x132504={[_0x58e233]:_0x55a9f5},console[_0x36fba2(0x1e3)](_0x36fba2(0x1f7)+_0x58e233+_0x36fba2(0x132)+_0x55a9f5+_0x36fba2(0x200));}}const [_0x4c2fbc,_0x575114]=await Promise[_0x36fba2(0x175)]([database_1['default'][_0x36fba2(0x20c)][_0x36fba2(0x1b9)]({'where':_0x533406,'skip':_0x527799,'take':_0x2121fd,'orderBy':_0x132504,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x36fba2(0x1cb)][_0x36fba2(0x20c)][_0x36fba2(0x149)]({'where':_0x533406})]);return{'payments':_0x4c2fbc[_0x36fba2(0x123)](_0x2d680b=>({'id':_0x2d680b['id'],'shopId':_0x2d680b[_0x36fba2(0x166)],'gateway':_0x2d680b[_0x36fba2(0x141)],'amount':_0x2d680b[_0x36fba2(0x122)],'currency':_0x2d680b['currency'],'status':_0x2d680b[_0x36fba2(0x148)],'orderId':_0x2d680b['orderId'],'gatewayOrderId':_0x2d680b[_0x36fba2(0x1eb)],'customerEmail':_0x2d680b['customerEmail'],'customerName':_0x2d680b[_0x36fba2(0x115)],'customerCountry':_0x2d680b[_0x36fba2(0x177)],'customerIp':_0x2d680b[_0x36fba2(0x15c)],'customerUa':_0x2d680b[_0x36fba2(0x211)],'failureMessage':_0x2d680b[_0x36fba2(0x1a3)],'createdAt':_0x2d680b['createdAt'],'updatedAt':_0x2d680b[_0x36fba2(0x15d)],'shop':_0x2d680b[_0x36fba2(0x13f)]})),'pagination':{'page':_0x291c71,'limit':_0x2121fd,'total':_0x575114,'totalPages':Math[_0x36fba2(0x1d7)](_0x575114/_0x2121fd)}};}async[a35_0x58e255(0x1df)](_0x2ee48c){const _0x5c8f30=a35_0x58e255,_0x5574ff=await database_1['default'][_0x5c8f30(0x20c)][_0x5c8f30(0x1d9)]({'where':{'id':_0x2ee48c},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x5574ff)return null;return{'id':_0x5574ff['id'],'shopId':_0x5574ff[_0x5c8f30(0x166)],'gateway':_0x5574ff[_0x5c8f30(0x141)],'amount':_0x5574ff[_0x5c8f30(0x122)],'currency':_0x5574ff[_0x5c8f30(0x131)],'status':_0x5574ff[_0x5c8f30(0x148)],'orderId':_0x5574ff['orderId'],'gatewayOrderId':_0x5574ff[_0x5c8f30(0x1eb)],'customerEmail':_0x5574ff[_0x5c8f30(0x188)],'customerName':_0x5574ff[_0x5c8f30(0x115)],'customerCountry':_0x5574ff['customerCountry'],'customerIp':_0x5574ff['customerIp'],'customerUa':_0x5574ff['customerUa'],'failureMessage':_0x5574ff['failureMessage'],'externalPaymentUrl':_0x5574ff[_0x5c8f30(0x209)],'successUrl':_0x5574ff[_0x5c8f30(0x1d8)],'failUrl':_0x5574ff[_0x5c8f30(0x219)],'pendingUrl':_0x5574ff['pendingUrl'],'whiteUrl':_0x5574ff[_0x5c8f30(0x17a)],'createdAt':_0x5574ff[_0x5c8f30(0x11e)],'updatedAt':_0x5574ff['updatedAt'],'shop':_0x5574ff[_0x5c8f30(0x13f)]};}async[a35_0x58e255(0x192)](_0x21da96,_0x34cfc8,_0x45f465,_0x4b8a32){const _0x3bf2ed=a35_0x58e255,_0x401476=await database_1['default'][_0x3bf2ed(0x1cf)](async _0x44f62a=>{const _0x252f12=_0x3bf2ed,_0x28ef0a=await _0x44f62a[_0x252f12(0x20c)][_0x252f12(0x1d9)]({'where':{'id':_0x21da96},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x28ef0a)throw new Error(_0x252f12(0x1b1));const _0x4f3162=_0x28ef0a[_0x252f12(0x148)],_0x605f28=_0x34cfc8[_0x252f12(0x16d)]();console[_0x252f12(0x1e3)](_0x252f12(0x1f4)+_0x21da96+_0x252f12(0x158)+_0x4f3162+_0x252f12(0x216)+_0x605f28),console[_0x252f12(0x1e3)](_0x252f12(0x16b)+_0x28ef0a[_0x252f12(0x13f)][_0x252f12(0x1ee)]+_0x252f12(0x144));const _0x13982e={'status':_0x605f28,'updatedAt':new Date(),'statusChangedBy':_0x252f12(0x173),'statusChangedAt':new Date()};_0x45f465&&(_0x13982e[_0x252f12(0x1fd)]=_0x45f465);_0x605f28===_0x252f12(0x12b)&&_0x4b8a32&&(_0x13982e[_0x252f12(0x1a6)]=_0x4b8a32);let _0xf06dd4=0x0,_0x3d248b=_0x28ef0a[_0x252f12(0x13f)][_0x252f12(0x1ee)];if(_0x605f28==='PAID'&&_0x4f3162!==_0x252f12(0x16e)){_0x13982e[_0x252f12(0x1c0)]=new Date();const _0x10b3b4=await currencyService_1[_0x252f12(0x1b0)]['convertToUSDT'](_0x28ef0a[_0x252f12(0x122)],_0x28ef0a[_0x252f12(0x131)]);_0x13982e['amountUSDT']=_0x10b3b4,_0xf06dd4=_0x10b3b4,_0x3d248b+=_0x10b3b4,console['log'](_0x252f12(0x1ec)+_0x21da96+_0x252f12(0x165)+_0x10b3b4['toFixed'](0x6)+_0x252f12(0x12f));}else _0x4f3162==='PAID'&&_0x605f28!=='PAID'&&(_0x28ef0a['amountUSDT']&&(_0xf06dd4=-_0x28ef0a[_0x252f12(0x14d)],_0x3d248b-=_0x28ef0a[_0x252f12(0x14d)],_0x13982e['amountUSDT']=null,console[_0x252f12(0x1e3)](_0x252f12(0x1ec)+_0x21da96+_0x252f12(0x1e0)+_0x28ef0a['amountUSDT']['toFixed'](0x6)+_0x252f12(0x1fa))));if(_0x605f28===_0x252f12(0x12b)){if(_0x4f3162===_0x252f12(0x16e)&&_0x28ef0a[_0x252f12(0x14d)]){}_0x4b8a32&&_0x4b8a32>0x0&&(_0xf06dd4-=_0x4b8a32,_0x3d248b-=_0x4b8a32,console[_0x252f12(0x1e3)](_0x252f12(0x20e)+_0x4b8a32[_0x252f12(0x1a2)](0x6)+_0x252f12(0x1fa)));}_0x605f28===_0x252f12(0x1a9)&&_0x4f3162===_0x252f12(0x16e)&&console['log']('üîÑ\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance');const _0x2764b7=await _0x44f62a[_0x252f12(0x20c)][_0x252f12(0x18d)]({'where':{'id':_0x21da96},'data':_0x13982e,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0xf06dd4!==0x0&&(await _0x44f62a['shop'][_0x252f12(0x18d)]({'where':{'id':_0x28ef0a[_0x252f12(0x166)]},'data':{'balance':_0x3d248b}}),console[_0x252f12(0x1e3)]('üí∞\x20Shop\x20'+_0x28ef0a[_0x252f12(0x166)]+_0x252f12(0x124)+_0x28ef0a[_0x252f12(0x13f)][_0x252f12(0x1ee)][_0x252f12(0x1a2)](0x6)+_0x252f12(0x216)+_0x3d248b[_0x252f12(0x1a2)](0x6)+'\x20USDT\x20('+(_0xf06dd4>0x0?'+':'')+_0xf06dd4[_0x252f12(0x1a2)](0x6)+')')),_0x2764b7;});return{'id':_0x401476['id'],'shopId':_0x401476[_0x3bf2ed(0x166)],'gateway':_0x401476[_0x3bf2ed(0x141)],'amount':_0x401476[_0x3bf2ed(0x122)],'currency':_0x401476[_0x3bf2ed(0x131)],'status':_0x401476[_0x3bf2ed(0x148)],'orderId':_0x401476[_0x3bf2ed(0x152)],'gatewayOrderId':_0x401476[_0x3bf2ed(0x1eb)],'customerEmail':_0x401476[_0x3bf2ed(0x188)],'customerName':_0x401476[_0x3bf2ed(0x115)],'customerCountry':_0x401476[_0x3bf2ed(0x177)],'customerIp':_0x401476['customerIp'],'customerUa':_0x401476[_0x3bf2ed(0x211)],'failureMessage':_0x401476['failureMessage'],'adminNotes':_0x401476[_0x3bf2ed(0x1fd)],'chargebackAmount':_0x401476[_0x3bf2ed(0x1a6)],'statusChangedBy':_0x401476[_0x3bf2ed(0x1d2)],'statusChangedAt':_0x401476[_0x3bf2ed(0x134)],'createdAt':_0x401476[_0x3bf2ed(0x11e)],'updatedAt':_0x401476[_0x3bf2ed(0x15d)],'shop':_0x401476[_0x3bf2ed(0x13f)]};}async[a35_0x58e255(0x1bd)](_0x2c006e,_0x22b202){const _0x505dd9=a35_0x58e255,_0x373976={..._0x22b202};_0x22b202[_0x505dd9(0x160)]&&(_0x373976[_0x505dd9(0x160)]=await bcryptjs_1['default'][_0x505dd9(0x1c5)](_0x22b202[_0x505dd9(0x160)],0xc));_0x22b202['fullName']&&(_0x373976[_0x505dd9(0x111)]=_0x22b202[_0x505dd9(0x150)],delete _0x373976[_0x505dd9(0x150)]);_0x22b202['telegramId']&&(_0x373976['telegram']=_0x22b202[_0x505dd9(0x133)],delete _0x373976[_0x505dd9(0x133)]);_0x22b202['merchantUrl']&&(_0x373976[_0x505dd9(0x1e7)]=_0x22b202[_0x505dd9(0x118)],delete _0x373976[_0x505dd9(0x118)]);_0x22b202['gateways']&&(_0x373976[_0x505dd9(0x185)]=JSON[_0x505dd9(0x198)](_0x22b202[_0x505dd9(0x183)]),delete _0x373976[_0x505dd9(0x183)]);_0x22b202[_0x505dd9(0x1f0)]&&(_0x373976[_0x505dd9(0x1f0)]=JSON[_0x505dd9(0x198)](_0x22b202['gatewaySettings']),delete _0x373976[_0x505dd9(0x1f0)]);_0x22b202[_0x505dd9(0x120)]&&(_0x22b202[_0x505dd9(0x120)][_0x505dd9(0x18f)]!==undefined&&(_0x373976[_0x505dd9(0x18f)]=_0x22b202[_0x505dd9(0x120)][_0x505dd9(0x18f)]||null),_0x22b202[_0x505dd9(0x120)][_0x505dd9(0x21d)]!==undefined&&(_0x373976[_0x505dd9(0x21d)]=_0x22b202[_0x505dd9(0x120)][_0x505dd9(0x21d)]||null),_0x22b202[_0x505dd9(0x120)][_0x505dd9(0x213)]!==undefined&&(_0x373976[_0x505dd9(0x213)]=_0x22b202[_0x505dd9(0x120)][_0x505dd9(0x213)]||null),_0x22b202[_0x505dd9(0x120)]['usdcPolygonWallet']!==undefined&&(_0x373976[_0x505dd9(0x1a4)]=_0x22b202[_0x505dd9(0x120)][_0x505dd9(0x1a4)]||null),delete _0x373976['wallets']);const _0x482b55=await database_1[_0x505dd9(0x1cb)]['shop'][_0x505dd9(0x18d)]({'where':{'id':_0x2c006e},'data':_0x373976,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x482b55['id'],'fullName':_0x482b55['name'],'username':_0x482b55[_0x505dd9(0x155)],'telegramId':_0x482b55['telegram'],'merchantUrl':_0x482b55['shopUrl'],'gateways':_0x482b55['paymentGateways']?JSON[_0x505dd9(0x1a5)](_0x482b55['paymentGateways']):null,'gatewaySettings':_0x482b55['gatewaySettings']?JSON[_0x505dd9(0x1a5)](_0x482b55['gatewaySettings']):null,'publicKey':_0x482b55[_0x505dd9(0x1b6)],'wallets':{'usdtPolygonWallet':_0x482b55[_0x505dd9(0x18f)],'usdtTrcWallet':_0x482b55['usdtTrcWallet'],'usdtErcWallet':_0x482b55[_0x505dd9(0x213)],'usdcPolygonWallet':_0x482b55[_0x505dd9(0x1a4)]},'status':_0x482b55[_0x505dd9(0x148)],'createdAt':_0x482b55[_0x505dd9(0x11e)]};}async[a35_0x58e255(0x1da)](_0x224ed2){const _0x39c989=a35_0x58e255,_0x2f6177=await database_1['default'][_0x39c989(0x13f)]['update']({'where':{'id':_0x224ed2},'data':{'status':_0x39c989(0x1b7)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2f6177['id'],'fullName':_0x2f6177[_0x39c989(0x111)],'username':_0x2f6177[_0x39c989(0x155)],'telegramId':_0x2f6177[_0x39c989(0x1c1)],'merchantUrl':_0x2f6177[_0x39c989(0x1e7)],'gateways':_0x2f6177[_0x39c989(0x185)]?JSON[_0x39c989(0x1a5)](_0x2f6177[_0x39c989(0x185)]):null,'gatewaySettings':_0x2f6177['gatewaySettings']?JSON[_0x39c989(0x1a5)](_0x2f6177['gatewaySettings']):null,'publicKey':_0x2f6177[_0x39c989(0x1b6)],'wallets':{'usdtPolygonWallet':_0x2f6177[_0x39c989(0x18f)],'usdtTrcWallet':_0x2f6177['usdtTrcWallet'],'usdtErcWallet':_0x2f6177[_0x39c989(0x213)],'usdcPolygonWallet':_0x2f6177[_0x39c989(0x1a4)]},'status':_0x2f6177[_0x39c989(0x148)],'createdAt':_0x2f6177[_0x39c989(0x11e)]};}async[a35_0x58e255(0x1ff)](_0x29e9d8){const _0xe46b0f=a35_0x58e255,_0x538332=await database_1[_0xe46b0f(0x1cb)][_0xe46b0f(0x13f)][_0xe46b0f(0x18d)]({'where':{'id':_0x29e9d8},'data':{'status':_0xe46b0f(0x1d4)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x538332['id'],'fullName':_0x538332[_0xe46b0f(0x111)],'username':_0x538332[_0xe46b0f(0x155)],'telegramId':_0x538332[_0xe46b0f(0x1c1)],'merchantUrl':_0x538332[_0xe46b0f(0x1e7)],'gateways':_0x538332[_0xe46b0f(0x185)]?JSON['parse'](_0x538332[_0xe46b0f(0x185)]):null,'gatewaySettings':_0x538332[_0xe46b0f(0x1f0)]?JSON['parse'](_0x538332[_0xe46b0f(0x1f0)]):null,'publicKey':_0x538332[_0xe46b0f(0x1b6)],'wallets':{'usdtPolygonWallet':_0x538332[_0xe46b0f(0x18f)],'usdtTrcWallet':_0x538332[_0xe46b0f(0x21d)],'usdtErcWallet':_0x538332['usdtErcWallet'],'usdcPolygonWallet':_0x538332[_0xe46b0f(0x1a4)]},'status':_0x538332[_0xe46b0f(0x148)],'createdAt':_0x538332[_0xe46b0f(0x11e)]};}async[a35_0x58e255(0x1a1)](_0x3c98d8){const _0xa93bb5=a35_0x58e255,{page:_0x4d4447,limit:_0x5cc976,status:_0x1059ba}=_0x3c98d8,_0x87aca3=(_0x4d4447-0x1)*_0x5cc976,_0x4957a5={};_0x1059ba&&(_0x4957a5['status']=_0x1059ba[_0xa93bb5(0x16d)]());const [_0x494f4d,_0x4256e0]=await Promise[_0xa93bb5(0x175)]([database_1[_0xa93bb5(0x1cb)]['shop']['findMany']({'where':_0x4957a5,'skip':_0x87aca3,'take':_0x5cc976,'orderBy':{'createdAt':_0xa93bb5(0x129)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1['default'][_0xa93bb5(0x13f)][_0xa93bb5(0x149)]({'where':_0x4957a5})]);return{'users':_0x494f4d[_0xa93bb5(0x123)](_0x533f46=>({'id':_0x533f46['id'],'fullName':_0x533f46[_0xa93bb5(0x111)],'username':_0x533f46[_0xa93bb5(0x155)],'telegramId':_0x533f46[_0xa93bb5(0x1c1)],'merchantUrl':_0x533f46['shopUrl'],'gateways':_0x533f46[_0xa93bb5(0x185)]?JSON[_0xa93bb5(0x1a5)](_0x533f46[_0xa93bb5(0x185)]):null,'gatewaySettings':_0x533f46[_0xa93bb5(0x1f0)]?JSON['parse'](_0x533f46[_0xa93bb5(0x1f0)]):null,'publicKey':_0x533f46[_0xa93bb5(0x1b6)],'wallets':{'usdtPolygonWallet':_0x533f46[_0xa93bb5(0x18f)],'usdtTrcWallet':_0x533f46[_0xa93bb5(0x21d)],'usdtErcWallet':_0x533f46[_0xa93bb5(0x213)],'usdcPolygonWallet':_0x533f46[_0xa93bb5(0x1a4)]},'status':_0x533f46[_0xa93bb5(0x148)],'createdAt':_0x533f46[_0xa93bb5(0x11e)]})),'pagination':{'page':_0x4d4447,'limit':_0x5cc976,'total':_0x4256e0,'totalPages':Math[_0xa93bb5(0x1d7)](_0x4256e0/_0x5cc976)}};}async[a35_0x58e255(0x1cc)](_0x185299){const _0x212e99=a35_0x58e255,_0x33a878=await database_1[_0x212e99(0x1cb)]['shop'][_0x212e99(0x1d9)]({'where':{'id':_0x185299},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x33a878)return null;return{'id':_0x33a878['id'],'fullName':_0x33a878[_0x212e99(0x111)],'username':_0x33a878[_0x212e99(0x155)],'telegramId':_0x33a878[_0x212e99(0x1c1)],'merchantUrl':_0x33a878[_0x212e99(0x1e7)],'gateways':_0x33a878[_0x212e99(0x185)]?JSON['parse'](_0x33a878[_0x212e99(0x185)]):null,'gatewaySettings':_0x33a878[_0x212e99(0x1f0)]?JSON['parse'](_0x33a878[_0x212e99(0x1f0)]):null,'publicKey':_0x33a878[_0x212e99(0x1b6)],'wallets':{'usdtPolygonWallet':_0x33a878['usdtPolygonWallet'],'usdtTrcWallet':_0x33a878[_0x212e99(0x21d)],'usdtErcWallet':_0x33a878[_0x212e99(0x213)],'usdcPolygonWallet':_0x33a878[_0x212e99(0x1a4)]},'status':_0x33a878['status'],'createdAt':_0x33a878[_0x212e99(0x11e)]};}async[a35_0x58e255(0x171)](_0x321161){const _0x34afd9=a35_0x58e255,{fullName:_0x25884d,username:_0x5b5cce,password:_0x390258,telegramId:_0x46fc33,merchantUrl:_0x50b605,gateways:_0x534756,gatewaySettings:_0x56b795,wallets:_0x3f3e12}=_0x321161,_0x1cad1f=await database_1['default'][_0x34afd9(0x13f)][_0x34afd9(0x1d9)]({'where':{'username':_0x5b5cce}});if(_0x1cad1f)throw new Error(_0x34afd9(0x1fc));if(_0x46fc33){const _0x7e170b=await database_1[_0x34afd9(0x1cb)]['shop'][_0x34afd9(0x1d9)]({'where':{'telegram':_0x46fc33}});if(_0x7e170b)throw new Error(_0x34afd9(0x127));}const _0x47fd5b=await bcryptjs_1[_0x34afd9(0x1cb)][_0x34afd9(0x1c5)](_0x390258,0xc),_0x4ef250=_0x34afd9(0x11a)+crypto_1[_0x34afd9(0x1cb)][_0x34afd9(0x1ed)](0x20)[_0x34afd9(0x154)](_0x34afd9(0x156)),_0x39fdc0='sk_'+crypto_1['default'][_0x34afd9(0x1ed)](0x20)['toString']('hex'),_0x2bb365=await database_1[_0x34afd9(0x1cb)]['shop'][_0x34afd9(0x1bf)]({'data':{'name':_0x25884d,'username':_0x5b5cce,'password':_0x47fd5b,'telegram':_0x46fc33,'shopUrl':_0x50b605,'paymentGateways':_0x534756?JSON['stringify'](_0x534756):null,'gatewaySettings':_0x56b795?JSON[_0x34afd9(0x198)](_0x56b795):null,'usdtPolygonWallet':_0x3f3e12?.[_0x34afd9(0x18f)]||null,'usdtTrcWallet':_0x3f3e12?.[_0x34afd9(0x21d)]||null,'usdtErcWallet':_0x3f3e12?.[_0x34afd9(0x213)]||null,'usdcPolygonWallet':_0x3f3e12?.[_0x34afd9(0x1a4)]||null,'publicKey':_0x4ef250,'secretKey':_0x39fdc0,'status':_0x34afd9(0x1d4)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2bb365['id'],'fullName':_0x2bb365[_0x34afd9(0x111)],'username':_0x2bb365['username'],'telegramId':_0x2bb365[_0x34afd9(0x1c1)],'merchantUrl':_0x2bb365[_0x34afd9(0x1e7)],'gateways':_0x2bb365['paymentGateways']?JSON['parse'](_0x2bb365[_0x34afd9(0x185)]):null,'gatewaySettings':_0x2bb365[_0x34afd9(0x1f0)]?JSON['parse'](_0x2bb365[_0x34afd9(0x1f0)]):null,'publicKey':_0x2bb365[_0x34afd9(0x1b6)],'wallets':{'usdtPolygonWallet':_0x2bb365['usdtPolygonWallet'],'usdtTrcWallet':_0x2bb365[_0x34afd9(0x21d)],'usdtErcWallet':_0x2bb365[_0x34afd9(0x213)],'usdcPolygonWallet':_0x2bb365['usdcPolygonWallet']},'status':_0x2bb365[_0x34afd9(0x148)],'createdAt':_0x2bb365[_0x34afd9(0x11e)]};}async[a35_0x58e255(0x182)](_0x56e991){const _0x45f833=a35_0x58e255;await database_1['default']['shop'][_0x45f833(0x19c)]({'where':{'id':_0x56e991}});}['generateDailyStatistics'](_0x5f932e,_0x4bd5ec,_0xc2de5c){const _0x52fe3e=a35_0x58e255,_0x429dce=new Map(),_0x217f3f=new Date(_0x4bd5ec);while(_0x217f3f<=_0xc2de5c){const _0x272418=_0x217f3f[_0x52fe3e(0x1ab)]()[_0x52fe3e(0x151)]('T')[0x0];_0x429dce[_0x52fe3e(0x15b)](_0x272418,{'revenue':0x0,'count':0x0}),_0x217f3f[_0x52fe3e(0x117)](_0x217f3f[_0x52fe3e(0x147)]()+0x1);}for(const _0x2fd84a of _0x5f932e){const _0x1c7213=_0x2fd84a[_0x52fe3e(0x11e)][_0x52fe3e(0x1ab)]()[_0x52fe3e(0x151)]('T')[0x0],_0x4cb2bc=_0x429dce[_0x52fe3e(0x18e)](_0x1c7213);_0x4cb2bc&&(_0x4cb2bc[_0x52fe3e(0x149)]+=0x1,_0x2fd84a['status']===_0x52fe3e(0x16e)&&(_0x2fd84a['amountUSDT']?_0x4cb2bc[_0x52fe3e(0x170)]+=_0x2fd84a[_0x52fe3e(0x14d)]:console['log']('‚ö†Ô∏è\x20Payment\x20'+_0x2fd84a['id']+_0x52fe3e(0x1b8))));}const _0x30d169=[],_0x37d9f7=[];for(const [_0x4ebb89,_0x2e1606]of _0x429dce){_0x30d169[_0x52fe3e(0x110)]({'date':_0x4ebb89,'amount':Math[_0x52fe3e(0x137)](_0x2e1606[_0x52fe3e(0x170)]*0x64)/0x64}),_0x37d9f7[_0x52fe3e(0x110)]({'date':_0x4ebb89,'count':_0x2e1606['count']});}return{'dailyRevenue':_0x30d169,'dailyPayments':_0x37d9f7};}}exports[a35_0x58e255(0x121)]=AdminService;