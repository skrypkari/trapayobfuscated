'use strict';const a35_0x55df78=a35_0x7e42;(function(_0x37a739,_0x3012bb){const _0x194662=a35_0x7e42,_0x2be2bb=_0x37a739();while(!![]){try{const _0x3b1528=-parseInt(_0x194662(0x192))/0x1*(parseInt(_0x194662(0x1ea))/0x2)+-parseInt(_0x194662(0x27b))/0x3*(parseInt(_0x194662(0x1fe))/0x4)+parseInt(_0x194662(0x21f))/0x5*(parseInt(_0x194662(0x1ba))/0x6)+-parseInt(_0x194662(0x289))/0x7+-parseInt(_0x194662(0x278))/0x8+-parseInt(_0x194662(0x28b))/0x9*(parseInt(_0x194662(0x223))/0xa)+parseInt(_0x194662(0x230))/0xb;if(_0x3b1528===_0x3012bb)break;else _0x2be2bb['push'](_0x2be2bb['shift']());}catch(_0x4f501e){_0x2be2bb['push'](_0x2be2bb['shift']());}}}(a35_0x3fee,0x52c86));function a35_0x3fee(){const _0x29d8bb=['payment','amountUSDT','usdtTrcWallet','__esModule','adminNotes','🔍\x20Using\x20gateway\x20\x27','⚠️\x20Gateway\x20\x27','pk_','availableBalance','statusChangedBy','\x20\x20\x20Gateway:\x20','📊\x20Sorting\x20payments\x20by\x20','turnoverUSDT','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','usdtPolygonWallet','toString','1570WqILgi','\x20\x20\x20💳\x20Total\x20payments:\x20','amount','telegram','6756130JkvhCm','__importDefault','totalAmountAfterCommissionUSDT','getTime','polygon_usdc','gte','asc',',\x20Commission:\x20','totalPaidOut','orderId','\x20USDT','lte','\x20\x20\x20💵\x20Available\x20balance:\x20','18285828oanbhl','\x20status:\x20','round','\x20balance\x20updated:\x20','CoinToPay','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','averageCommissionRate','averageCheckUSDT','Shop\x20not\x20found','gatewaySettings','\x20to\x20','hex','log','\x20balance\x20updated:','error','failureMessage','customerEmail','split','aggregate','\x20\x20\x20📊\x20Commission\x20difference:\x20','REFUND','sort','Noda','CHARGEBACK','not\x20specified','\x20->\x20','customerCountry','\x20\x20\x20Current\x20balance:\x20','\x27\x20not\x20found.\x20Available\x20gateways:\x20','activateUser','findMany','turnover','merchantUrl','\x20USDT\x20(-','getGatewayDisplayName','thisMonth','\x20\x20\x20🔍\x20Calculated\x20after\x20commission:\x20','test_gateway','create','toUpperCase','totalPayout','2020-01-01','wallets','totalCommissionRate','NONEXISTENT_GATEWAY_FILTER','period','\x20USDT)','\x20\x20\x20Balance:\x20','\x20\x20\x20Transaction\x20hash:\x20','merchantEarningsUSDT','\x20\x20\x20💰\x20Total\x20turnover:\x20','commission','deleteUser','\x20order','\x20paid\x20payments\x20for\x20analysis','plisio','paidOutUSDT','txid','rapyd','name','amountAfterCommissionUSDT','toISOString',':\x20commission\x20=\x20','failUrl','COMPLETED','\x20no\x20longer\x20PAID:','\x20\x20\x20Added\x20to\x20balance:\x20+','💳\x20Payout\x20wallet\x20for\x20','\x20\x20\x20🌍\x20Country:\x20','localeCompare','sk_','$transaction','2237496MaHyop','password','getGatewayNameById','129726DAuIzQ','getFullYear','count','stringify','createdAt','payout','customerIp','📊\x20Getting\x20payments\x20with\x20filters:','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','\x27\x20(from\x20\x27','join','\x20\x20\x20📅\x20Total\x20payouts\x20(this\x20month):\x20','fullName','KLYME\x20EU','4487294cwgkGa','📊\x20Payout\x20statistics\x20calculated:','9DOcGic','dailyPayments','all','updatePaymentStatus','📊\x20Gateway\x20filter\x20applied:','Test\x20Gateway','publicKey','findUnique','length','getMonth','\x20USDT\x20from\x20balance','\x20USDT\x20(+','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','erc20','AdminService','pendingUrl','\x27\x20to\x20name\x20\x27','getGatewayInternalName','shop','Open\x20Banking\x202','\x20\x20\x20🌐\x20IP:\x20','getAllPayouts','\x20USDT\x20(actual\x20balances)','_sum','default','🔄\x20Gateway\x20mapping\x20(create):','\x20USDT\x20(gross\x20revenue)','totalPayments','convertToUSDT','randomBytes','📋\x20Getting\x20merchants\x20selection\x20list...','\x20\x20\x20✅\x20Total\x20available\x20for\x20payout:\x20','getPayoutStats','💰\x20Payment\x20','username','\x20USDT\x20(','_count','KLYME\x20GB','parse','hash','%\x20commission)','paymentGateways','shopUrl','💱\x20Currency\x20filter\x20applied:\x20','98570wADVTS','entries','paidAt','\x20USDT,\x20Requested:\x20','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','\x20\x20\x20💰\x20Total\x20payments\x20turnover:\x20','📋\x20Found\x20','statusChangedAt','getUserById','shopId','getPayoutById','generateDailyStatistics','📊\x20Final\x20WHERE\x20conditions:','custom','ceil','💰\x20[PAYOUT]\x20Gateway\x20','merchantEarnings','chargebackAmount','balance','periodTo','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','customerName','currency','getMerchantStatistics','Rapyd','delete','\x20\x20\x20�\x20Total\x20payments\x20turnover:\x20','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','\x20active\x20merchants\x20for\x20selection','\x27\x20->\x20name\x20\x27','../config/database','./currencyService','status','update','telegramId','💰\x20Found\x20','gatewayOrderId','📊\x20Total\x20payments\x20(including\x20failed):\x20','polygon','ACTIVE','8754MVIcmO','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','periodFrom','\x20\x20\x20Merchant\x20loses:\x20','date','month','Payment\x20not\x20found','getGatewayIdByName','getMerchantsAwaitingPayout','insensitive','noda','\x20\x20\x20Total\x20paid\x20out:\x20','values','\x20USDT\x20(total\x20paid\x20to\x20merchants)','dateFrom','gatewayEarnings','PAID','\x20USDT\x20(same\x20as\x20awaiting)','klyme_de','totalAmountUSDT','\x20\x20\x20📊\x20Total\x20payments:\x20','updatedAt','deletePayout','getAllPayments','💰\x20[PAYOUT]\x20Merchant\x20','reduce','commissionUSDT','currencyService','cointopay','\x20USDT\x20(after\x20payouts)','gateways','notes','set','trc20','push','toLowerCase','cointopay2','paymentsCount','usdtErcWallet','mastercard','\x20\x20\x20Full\x20amount:\x20','toFixed','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','\x20\x20\x20🖥️\x20User\x20Agent:\x20','forEach','admin','\x20USDT\x20(theoretical\x20net)','\x20\x20\x20💰\x20Total\x20payout:\x20','2ZwgKhD','\x20\x20\x20🔍\x20Raw\x20balance\x20sum:\x20','📊\x20Merchants\x20awaiting\x20payout:\x20','map','updateCustomerData','network','usdcPolygonWallet','getAllUsers','gateway','../types/gateway','klyme_eu','SUSPENDED','✅\x20Using\x20gateway\x20filter:\x20\x27','30d','successUrl','\x20USDT\x20(after\x20','desc','💸\x20CHARGEBACK\x20penalty:\x20-','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','\x20merchants','8RERsqM','Telegram\x20username\x20already\x20exists','Insufficient\x20balance.\x20Available:\x20','🔄\x20Converted\x20gateway\x20name\x20\x27','createPayout','getPaymentById','💰\x20Shop\x20','defineProperty','includes','90d','dateTo','some','\x20merchants\x20with\x20positive\x20balance','Username\x20already\x20exists','customerUa','groupBy','🔄\x20Admin\x20updating\x20payment\x20'];a35_0x3fee=function(){return _0x29d8bb;};return a35_0x3fee();}var __importDefault=this&&this[a35_0x55df78(0x224)]||function(_0x2a4e9b){const _0x3f6e6d=a35_0x55df78;return _0x2a4e9b&&_0x2a4e9b[_0x3f6e6d(0x212)]?_0x2a4e9b:{'default':_0x2a4e9b};};Object[a35_0x55df78(0x205)](exports,a35_0x55df78(0x212),{'value':!![]}),exports[a35_0x55df78(0x299)]=void 0x0;function a35_0x7e42(_0x193d9b,_0x359a26){const _0x3feedd=a35_0x3fee();return a35_0x7e42=function(_0x7e42be,_0x592403){_0x7e42be=_0x7e42be-0x177;let _0x65671b=_0x3feedd[_0x7e42be];return _0x65671b;},a35_0x7e42(_0x193d9b,_0x359a26);}const database_1=__importDefault(require(a35_0x55df78(0x1b0))),bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require('crypto')),currencyService_1=require(a35_0x55df78(0x1b1)),gateway_1=require(a35_0x55df78(0x1f3));class AdminService{async[a35_0x55df78(0x186)](){const _0x367236=a35_0x55df78;console['log']('📊\x20Calculating\x20payout\x20statistics...');const _0x56ec50=await database_1['default'][_0x367236(0x178)][_0x367236(0x242)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x367236(0x1b9)}}),_0x446cf3=await this[_0x367236(0x1c2)]({'page':0x1,'limit':0x3e8}),_0x91fa3=await database_1[_0x367236(0x17e)][_0x367236(0x20f)]['count']({'where':{'status':_0x367236(0x1ca),'gateway':{'not':'test_gateway'}}}),_0x15d4e6=new Date(),_0x5d1289=new Date(_0x15d4e6[_0x367236(0x27c)](),_0x15d4e6[_0x367236(0x294)](),0x1),_0x50dc4e=new Date(_0x15d4e6[_0x367236(0x27c)](),_0x15d4e6[_0x367236(0x294)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x440360=await database_1[_0x367236(0x17e)][_0x367236(0x280)][_0x367236(0x242)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x5d1289,'lte':_0x50dc4e},'status':_0x367236(0x270)}}),_0x273fc2=_0x56ec50[_0x367236(0x17d)]['totalPaidOut']||0x0,_0x2f182e=_0x446cf3['summary'][_0x367236(0x225)],_0xbb193f=_0x440360['_sum']['amount']||0x0,_0x3b1ead={'totalPayout':Math[_0x367236(0x232)](_0x273fc2*0x64)/0x64,'awaitingPayout':Math[_0x367236(0x232)](_0x2f182e*0x64)/0x64,'thisMonth':Math[_0x367236(0x232)](_0xbb193f*0x64)/0x64,'availableBalance':Math[_0x367236(0x232)](_0x2f182e*0x64)/0x64,'totalPayments':_0x91fa3};return console[_0x367236(0x23c)](_0x367236(0x28a)),console['log'](_0x367236(0x1e9)+_0x3b1ead[_0x367236(0x258)]+_0x367236(0x1c7)),console[_0x367236(0x23c)]('\x20\x20\x20⏳\x20Awaiting\x20payout:\x20'+_0x3b1ead['awaitingPayout']+'\x20USDT\x20(with\x20commission\x20deducted)'),console[_0x367236(0x23c)](_0x367236(0x22f)+_0x3b1ead[_0x367236(0x217)]+_0x367236(0x1cb)),console['log']('\x20\x20\x20📅\x20This\x20month:\x20'+_0x3b1ead[_0x367236(0x253)]+_0x367236(0x22d)),console['log'](_0x367236(0x220)+_0x3b1ead[_0x367236(0x181)]+'\x20PAID\x20payments'),console[_0x367236(0x23c)](_0x367236(0x1eb)+(_0x56ec50[_0x367236(0x17d)][_0x367236(0x1a4)]||0x0)[_0x367236(0x1e3)](0x2)+'\x20USDT\x20(without\x20commission)'),console[_0x367236(0x23c)](_0x367236(0x243)+((_0x56ec50['_sum'][_0x367236(0x1a4)]||0x0)-_0x2f182e)[_0x367236(0x1e3)](0x2)+_0x367236(0x22d)),_0x3b1ead;}async[a35_0x55df78(0x1ee)](_0x150203,_0x27773f){const _0x582f5e=a35_0x55df78;console['log'](_0x582f5e(0x1fc)+_0x150203+':',_0x27773f);const _0xf11ad8=await database_1['default'][_0x582f5e(0x20f)][_0x582f5e(0x292)]({'where':{'id':_0x150203},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0xf11ad8)throw new Error(_0x582f5e(0x1c0));const _0x31be9={};_0x27773f[_0x582f5e(0x24a)]!==undefined&&(_0x31be9[_0x582f5e(0x24a)]=_0x27773f[_0x582f5e(0x24a)]||null);_0x27773f[_0x582f5e(0x281)]!==undefined&&(_0x31be9['customerIp']=_0x27773f[_0x582f5e(0x281)]||null);_0x27773f['customerUa']!==undefined&&(_0x31be9[_0x582f5e(0x20c)]=_0x27773f[_0x582f5e(0x20c)]||null);const _0x12d36a=await database_1[_0x582f5e(0x17e)][_0x582f5e(0x20f)]['update']({'where':{'id':_0x150203},'data':{..._0x31be9,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x582f5e(0x23c)](_0x582f5e(0x283)+_0x150203),console['log'](_0x582f5e(0x274)+_0xf11ad8[_0x582f5e(0x24a)]+'\x20->\x20'+_0x12d36a[_0x582f5e(0x24a)]),console[_0x582f5e(0x23c)](_0x582f5e(0x17a)+_0xf11ad8[_0x582f5e(0x281)]+_0x582f5e(0x249)+_0x12d36a[_0x582f5e(0x281)]),console[_0x582f5e(0x23c)](_0x582f5e(0x1e5)+(_0xf11ad8['customerUa']?_0x582f5e(0x1da):'not\x20set')+_0x582f5e(0x249)+(_0x12d36a[_0x582f5e(0x20c)]?_0x582f5e(0x1da):'not\x20set')),_0x12d36a;}async['getSystemStatistics'](_0x218dcd){const _0xfe9b65=a35_0x55df78,_0x341caa=new Date();let _0x4e2c5e;switch(_0x218dcd){case'7d':_0x4e2c5e=new Date(_0x341caa[_0xfe9b65(0x226)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0xfe9b65(0x1f7):_0x4e2c5e=new Date(_0x341caa[_0xfe9b65(0x226)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0xfe9b65(0x207):_0x4e2c5e=new Date(_0x341caa[_0xfe9b65(0x226)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0xfe9b65(0x28d):const _0x170eaa=await database_1[_0xfe9b65(0x17e)]['payment']['findFirst']({'where':{'gateway':{'not':_0xfe9b65(0x255)}},'orderBy':{'createdAt':_0xfe9b65(0x229)},'select':{'createdAt':!![]}});_0x4e2c5e=_0x170eaa?_0x170eaa['createdAt']:new Date(_0xfe9b65(0x259)),console[_0xfe9b65(0x23c)]('📅\x20Period\x20\x27all\x27:\x20Using\x20start\x20date\x20from\x20first\x20payment:\x20'+_0x4e2c5e['toISOString']());break;default:_0x4e2c5e=new Date(_0x341caa['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x4c8d85,_0x3a9065,_0x17e9d9,_0x5b2336,_0x1ccb15,_0x45315d,_0x45b394]=await Promise[_0xfe9b65(0x28d)]([database_1[_0xfe9b65(0x17e)][_0xfe9b65(0x178)][_0xfe9b65(0x27d)](),database_1[_0xfe9b65(0x17e)]['shop'][_0xfe9b65(0x27d)]({'where':{'status':_0xfe9b65(0x1b9)}}),database_1['default']['payment'][_0xfe9b65(0x27d)]({'where':{'createdAt':{'gte':_0x4e2c5e},'gateway':{'not':'test_gateway'}}}),database_1[_0xfe9b65(0x17e)]['payment'][_0xfe9b65(0x27d)]({'where':{'status':_0xfe9b65(0x1ca),'createdAt':{'gte':_0x4e2c5e},'gateway':{'not':'test_gateway'}}}),database_1['default']['payment'][_0xfe9b65(0x24e)]({'where':{'status':_0xfe9b65(0x1ca),'createdAt':{'gte':_0x4e2c5e},'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![]}}),database_1[_0xfe9b65(0x17e)][_0xfe9b65(0x20f)][_0xfe9b65(0x24e)]({'where':{'gateway':{'not':_0xfe9b65(0x255)}},'take':0xa,'orderBy':{'createdAt':_0xfe9b65(0x1fa)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0xfe9b65(0x17e)][_0xfe9b65(0x20f)][_0xfe9b65(0x24e)]({'where':{'createdAt':{'gte':_0x4e2c5e},'gateway':{'not':_0xfe9b65(0x255)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x56c73e=0x0;for(const _0x5c70d6 of _0x1ccb15){const _0x214f93=await currencyService_1[_0xfe9b65(0x1d5)]['convertToUSDT'](_0x5c70d6[_0xfe9b65(0x221)],_0x5c70d6['currency']);_0x56c73e+=_0x214f93;}const _0x22d6d3=this[_0xfe9b65(0x19d)](_0x45b394,_0x4e2c5e,_0x341caa),_0x14c3d3=_0x17e9d9>0x0?_0x5b2336/_0x17e9d9*0x64:0x0;return{'totalShops':_0x4c8d85,'activeShops':_0x3a9065,'totalPayments':_0x17e9d9,'successfulPayments':_0x5b2336,'totalRevenue':Math[_0xfe9b65(0x232)](_0x56c73e*0x64)/0x64,'conversionRate':Math['round'](_0x14c3d3*0x64)/0x64,'dailyRevenue':_0x22d6d3['dailyRevenue'],'dailyPayments':_0x22d6d3[_0xfe9b65(0x28c)],'recentPayments':_0x45315d[_0xfe9b65(0x1ed)](_0x10f4f3=>({'id':_0x10f4f3['id'],'amount':_0x10f4f3[_0xfe9b65(0x221)],'currency':_0x10f4f3[_0xfe9b65(0x1a8)],'status':_0x10f4f3[_0xfe9b65(0x1b2)],'gateway':_0x10f4f3['gateway'],'shop':_0x10f4f3[_0xfe9b65(0x178)],'createdAt':_0x10f4f3[_0xfe9b65(0x27f)]}))};}async[a35_0x55df78(0x1a9)](_0x2eae86){const _0x306743=a35_0x55df78;console['log'](_0x306743(0x21c),_0x2eae86);let _0x2c989d,_0x200621=new Date();if(_0x2eae86['period']===_0x306743(0x19f)&&_0x2eae86[_0x306743(0x1c8)]&&_0x2eae86['dateTo'])_0x2c989d=new Date(_0x2eae86[_0x306743(0x1c8)]),_0x200621=new Date(_0x2eae86[_0x306743(0x208)]);else{const _0x365a10=new Date();switch(_0x2eae86['period']){case'week':_0x2c989d=new Date(_0x365a10[_0x306743(0x226)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x306743(0x1bf):_0x2c989d=new Date(_0x365a10['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'year':_0x2c989d=new Date(_0x365a10[_0x306743(0x226)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x306743(0x28d):default:_0x2c989d=new Date(_0x306743(0x259));break;}}console['log']('📅\x20Period:\x20'+_0x2c989d[_0x306743(0x26d)]()+_0x306743(0x23a)+_0x200621['toISOString']());const _0x3c8674={'status':_0x306743(0x1ca),'gateway':{'not':'test_gateway'},'paidAt':{'gte':_0x2c989d,'lte':_0x200621}};_0x2eae86[_0x306743(0x19b)]&&(_0x3c8674[_0x306743(0x19b)]=_0x2eae86['shopId']);const _0x35b672=await database_1[_0x306743(0x17e)][_0x306743(0x20f)][_0x306743(0x24e)]({'where':_0x3c8674,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x306743(0x23c)](_0x306743(0x1b5)+_0x35b672['length']+_0x306743(0x266));const _0x3066e0={'gateway':{'not':_0x306743(0x255)},'createdAt':{'gte':_0x2c989d,'lte':_0x200621}};_0x2eae86[_0x306743(0x19b)]&&(_0x3066e0[_0x306743(0x19b)]=_0x2eae86[_0x306743(0x19b)]);const _0x2bc158=await database_1[_0x306743(0x17e)][_0x306743(0x20f)]['count']({'where':_0x3066e0});console[_0x306743(0x23c)](_0x306743(0x1b7)+_0x2bc158+',\x20successful:\x20'+_0x35b672[_0x306743(0x293)]);let _0x16be0d=0x0,_0x2c3372=0x0,_0x5511d9=0x0;const _0x5a28f4={},_0x2080f2={},_0x1598b4={};for(const _0xc24a2e of _0x35b672){try{const _0x3afcd6=await currencyService_1[_0x306743(0x1d5)][_0x306743(0x182)](_0xc24a2e[_0x306743(0x221)],_0xc24a2e[_0x306743(0x1a8)]);let _0x4a3075={};if(_0xc24a2e[_0x306743(0x178)][_0x306743(0x239)])try{_0x4a3075=JSON[_0x306743(0x18c)](_0xc24a2e[_0x306743(0x178)]['gatewaySettings']);}catch(_0x2d3c4d){console[_0x306743(0x23e)](_0x306743(0x1ad)+_0xc24a2e[_0x306743(0x19b)]+':',_0x2d3c4d);}let _0xb4aeb7={},_0x15e519=0xa;for(const [_0xaaaac1,_0x77d5e7]of Object['entries'](_0x4a3075)){if(_0xaaaac1[_0x306743(0x1dd)]()===_0xc24a2e[_0x306743(0x1f2)][_0x306743(0x1dd)]()){_0xb4aeb7=_0x77d5e7,_0x15e519=_0x77d5e7[_0x306743(0x263)]||0xa;break;}}const _0x14b6b4=_0x3afcd6*(_0x15e519/0x64),_0x865500=_0x3afcd6-_0x14b6b4;_0x16be0d+=_0x3afcd6,_0x2c3372+=_0x865500,_0x5511d9+=_0x14b6b4;!_0x5a28f4[_0xc24a2e[_0x306743(0x1f2)]]&&(_0x5a28f4[_0xc24a2e[_0x306743(0x1f2)]]={'gateway':_0xc24a2e[_0x306743(0x1f2)],'gatewayDisplayName':this[_0x306743(0x252)](_0xc24a2e[_0x306743(0x1f2)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x5a28f4[_0xc24a2e[_0x306743(0x1f2)]][_0x306743(0x1df)]++,_0x5a28f4[_0xc24a2e[_0x306743(0x1f2)]][_0x306743(0x21b)]+=_0x3afcd6,_0x5a28f4[_0xc24a2e[_0x306743(0x1f2)]][_0x306743(0x1d4)]+=_0x14b6b4,_0x5a28f4[_0xc24a2e[_0x306743(0x1f2)]][_0x306743(0x261)]+=_0x865500,_0x5a28f4[_0xc24a2e['gateway']][_0x306743(0x25b)]+=_0x15e519;!_0x2eae86[_0x306743(0x19b)]&&(!_0x2080f2[_0xc24a2e[_0x306743(0x19b)]]&&(_0x2080f2[_0xc24a2e[_0x306743(0x19b)]]={'shopId':_0xc24a2e[_0x306743(0x19b)],'shopName':_0xc24a2e['shop'][_0x306743(0x26b)],'shopUsername':_0xc24a2e['shop']['username'],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x2080f2[_0xc24a2e[_0x306743(0x19b)]]['paymentsCount']++,_0x2080f2[_0xc24a2e[_0x306743(0x19b)]][_0x306743(0x21b)]+=_0x3afcd6,_0x2080f2[_0xc24a2e['shopId']][_0x306743(0x1d4)]+=_0x14b6b4,_0x2080f2[_0xc24a2e[_0x306743(0x19b)]]['merchantEarningsUSDT']+=_0x865500);const _0x43c2f9=_0xc24a2e[_0x306743(0x194)]['toISOString']()[_0x306743(0x241)]('T')[0x0];!_0x1598b4[_0x43c2f9]&&(_0x1598b4[_0x43c2f9]={'date':_0x43c2f9,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x1598b4[_0x43c2f9][_0x306743(0x24f)]+=_0x3afcd6,_0x1598b4[_0x43c2f9][_0x306743(0x1a2)]+=_0x865500,_0x1598b4[_0x43c2f9][_0x306743(0x1c9)]+=_0x14b6b4,_0x1598b4[_0x43c2f9][_0x306743(0x1df)]++;}catch(_0xd3b1f6){console[_0x306743(0x23e)]('Error\x20processing\x20payment\x20'+_0xc24a2e['id']+':',_0xd3b1f6);}}Object[_0x306743(0x1c6)](_0x5a28f4)[_0x306743(0x1e6)](_0x1f6bb7=>{const _0x2463bf=_0x306743;_0x1f6bb7[_0x2463bf(0x236)]=_0x1f6bb7[_0x2463bf(0x1df)]>0x0?_0x1f6bb7['totalCommissionRate']/_0x1f6bb7[_0x2463bf(0x1df)]:0x0,delete _0x1f6bb7[_0x2463bf(0x25b)];}),Object[_0x306743(0x1c6)](_0x2080f2)['forEach'](_0x25b700=>{const _0x41cf3a=_0x306743;_0x25b700[_0x41cf3a(0x237)]=_0x25b700[_0x41cf3a(0x1df)]>0x0?_0x25b700['turnoverUSDT']/_0x25b700[_0x41cf3a(0x1df)]:0x0;});let _0x13db91=0x0;if(_0x2eae86[_0x306743(0x19b)]){const _0x444021=await database_1[_0x306743(0x17e)]['payout'][_0x306743(0x24e)]({'where':{'shopId':_0x2eae86[_0x306743(0x19b)],'status':_0x306743(0x270),'createdAt':{'gte':_0x2c989d,'lte':_0x200621}},'select':{'amount':!![]}});_0x13db91=_0x444021[_0x306743(0x1d3)]((_0x508649,_0x3eef2a)=>_0x508649+_0x3eef2a[_0x306743(0x221)],0x0);}const _0x2d875f=_0x2bc158,_0x1d5062=_0x35b672['length'],_0x5258af=_0x1d5062>0x0?_0x16be0d/_0x1d5062:0x0,_0x140328=_0x2d875f>0x0?Math[_0x306743(0x232)](_0x1d5062/_0x2d875f*0x2710)/0x64:0x0,_0x52dbf1=Math[_0x306743(0x1a0)]((_0x200621[_0x306743(0x226)]()-_0x2c989d[_0x306743(0x226)]())/(0x3e8*0x3c*0x3c*0x18)),_0x33d0eb={'totalTurnover':Math[_0x306743(0x232)](_0x16be0d*0x64)/0x64,'merchantEarnings':Math['round'](_0x2c3372*0x64)/0x64,'gatewayEarnings':Math[_0x306743(0x232)](_0x5511d9*0x64)/0x64,'totalPaidOut':Math[_0x306743(0x232)](_0x13db91*0x64)/0x64,'averageCheck':Math['round'](_0x5258af*0x64)/0x64,'totalPayments':_0x2d875f,'successfulPayments':_0x1d5062,'conversionRate':_0x140328,'gatewayBreakdown':Object[_0x306743(0x1c6)](_0x5a28f4)['map'](_0x43d90c=>({..._0x43d90c,'turnoverUSDT':Math[_0x306743(0x232)](_0x43d90c['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x306743(0x232)](_0x43d90c['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x306743(0x232)](_0x43d90c[_0x306743(0x261)]*0x64)/0x64,'averageCommissionRate':Math[_0x306743(0x232)](_0x43d90c['averageCommissionRate']*0x64)/0x64})),'merchantBreakdown':_0x2eae86['shopId']?undefined:Object[_0x306743(0x1c6)](_0x2080f2)['map'](_0x46d482=>({..._0x46d482,'turnoverUSDT':Math['round'](_0x46d482[_0x306743(0x21b)]*0x64)/0x64,'commissionUSDT':Math[_0x306743(0x232)](_0x46d482['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x46d482[_0x306743(0x261)]*0x64)/0x64,'paidOutUSDT':Math[_0x306743(0x232)](_0x46d482[_0x306743(0x268)]*0x64)/0x64,'averageCheckUSDT':Math['round'](_0x46d482[_0x306743(0x237)]*0x64)/0x64})),'dailyData':Object[_0x306743(0x1c6)](_0x1598b4)[_0x306743(0x1ed)](_0x261b44=>({..._0x261b44,'turnover':Math[_0x306743(0x232)](_0x261b44[_0x306743(0x24f)]*0x64)/0x64,'merchantEarnings':Math[_0x306743(0x232)](_0x261b44[_0x306743(0x1a2)]*0x64)/0x64,'gatewayEarnings':Math[_0x306743(0x232)](_0x261b44[_0x306743(0x1c9)]*0x64)/0x64}))[_0x306743(0x245)]((_0x2e21f9,_0x42842f)=>_0x2e21f9[_0x306743(0x1be)][_0x306743(0x275)](_0x42842f['date'])),'periodInfo':{'from':_0x2c989d,'to':_0x200621,'periodType':_0x2eae86[_0x306743(0x25d)]||_0x306743(0x19f),'daysCount':_0x52dbf1}};return console[_0x306743(0x23c)]('📊\x20Merchant\x20statistics\x20calculated:'),console[_0x306743(0x23c)](_0x306743(0x262)+_0x33d0eb['totalTurnover']+_0x306743(0x22d)),console[_0x306743(0x23c)](_0x306743(0x1e4)+_0x33d0eb[_0x306743(0x1a2)]+_0x306743(0x22d)),console[_0x306743(0x23c)]('\x20\x20\x20🏪\x20Gateway\x20earnings:\x20'+_0x33d0eb[_0x306743(0x1c9)]+_0x306743(0x22d)),console[_0x306743(0x23c)](_0x306743(0x1ce)+_0x33d0eb[_0x306743(0x181)]),_0x33d0eb;}async['getMerchantsSelection'](){const _0x232ee3=a35_0x55df78;console['log'](_0x232ee3(0x184));const _0x40b2bb=await database_1[_0x232ee3(0x17e)][_0x232ee3(0x178)][_0x232ee3(0x24e)]({'where':{'status':_0x232ee3(0x1b9)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x232ee3(0x229)}});return console[_0x232ee3(0x23c)](_0x232ee3(0x198)+_0x40b2bb[_0x232ee3(0x293)]+_0x232ee3(0x1ae)),_0x40b2bb[_0x232ee3(0x1ed)](_0x1cd02d=>({'id':_0x1cd02d['id'],'username':_0x1cd02d['username'],'name':_0x1cd02d[_0x232ee3(0x26b)]}));}['getGatewayDisplayName'](_0x136e34){const _0x2c9292=a35_0x55df78,_0x1d5afb={'test_gateway':_0x2c9292(0x290),'plisio':'Plisio','rapyd':_0x2c9292(0x1aa),'noda':_0x2c9292(0x246),'cointopay':_0x2c9292(0x234),'cointopay2':_0x2c9292(0x179),'klyme_eu':_0x2c9292(0x288),'klyme_gb':_0x2c9292(0x18b),'klyme_de':'KLYME\x20DE','mastercard':'MasterCard'};return _0x1d5afb[_0x136e34]||_0x136e34;}[a35_0x55df78(0x177)](_0x59c6e6){const _0x5afa63=a35_0x55df78,_0x3381c0={'Test\x20Gateway':_0x5afa63(0x255),'Plisio':_0x5afa63(0x267),'Rapyd':_0x5afa63(0x26a),'Noda':_0x5afa63(0x1c4),'CoinToPay':_0x5afa63(0x1d6),'Open\x20Banking\x202':_0x5afa63(0x1de),'KLYME\x20EU':_0x5afa63(0x1f4),'KLYME\x20GB':'klyme_gb','KLYME\x20DE':_0x5afa63(0x1cc),'MasterCard':_0x5afa63(0x1e1)};return _0x3381c0[_0x59c6e6]||_0x59c6e6[_0x5afa63(0x1dd)]();}async[a35_0x55df78(0x1c2)](_0x539da3){const _0x19e01a=a35_0x55df78,{page:_0x4a686a,limit:_0x4765c9,minAmount:_0x5af775,search:_0x6a5fa2}=_0x539da3,_0x1d4da1=(_0x4a686a-0x1)*_0x4765c9;console[_0x19e01a(0x23c)](_0x19e01a(0x196),_0x539da3);const _0x565a71={'balance':{'gt':0x0},'status':'ACTIVE'};_0x5af775&&(_0x565a71[_0x19e01a(0x1a4)][_0x19e01a(0x228)]=_0x5af775);_0x6a5fa2&&(_0x565a71['OR']=[{'name':{'contains':_0x6a5fa2,'mode':_0x19e01a(0x1c3)}},{'username':{'contains':_0x6a5fa2,'mode':_0x19e01a(0x1c3)}}]);const [_0x5a1fec,_0x6546f7]=await Promise[_0x19e01a(0x28d)]([database_1[_0x19e01a(0x17e)][_0x19e01a(0x178)][_0x19e01a(0x24e)]({'where':_0x565a71,'skip':_0x1d4da1,'take':_0x4765c9,'orderBy':{'balance':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1['default'][_0x19e01a(0x178)][_0x19e01a(0x27d)]({'where':_0x565a71})]);console[_0x19e01a(0x23c)](_0x19e01a(0x1b5)+_0x5a1fec[_0x19e01a(0x293)]+_0x19e01a(0x20a));const _0x2534fc=await Promise[_0x19e01a(0x28d)](_0x5a1fec[_0x19e01a(0x1ed)](async _0x2b29cf=>{const _0x2dd2f5=_0x19e01a,[_0x37eba4,_0x251ae1,_0x45af49]=await Promise[_0x2dd2f5(0x28d)]([database_1[_0x2dd2f5(0x17e)][_0x2dd2f5(0x20f)][_0x2dd2f5(0x27d)]({'where':{'shopId':_0x2b29cf['id'],'status':'PAID','gateway':{'not':_0x2dd2f5(0x255)}}}),database_1['default']['payment']['findFirst']({'where':{'shopId':_0x2b29cf['id'],'status':_0x2dd2f5(0x1ca),'gateway':{'not':_0x2dd2f5(0x255)}},'orderBy':{'paidAt':'asc'},'select':{'paidAt':!![]}}),database_1[_0x2dd2f5(0x17e)]['payment'][_0x2dd2f5(0x20d)]({'by':[_0x2dd2f5(0x1f2)],'where':{'shopId':_0x2b29cf['id'],'status':_0x2dd2f5(0x1ca),'gateway':{'not':_0x2dd2f5(0x255)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x4b5b2f=new Date(),_0x13a6de=new Date(_0x4b5b2f[_0x2dd2f5(0x27c)](),_0x4b5b2f['getMonth'](),0x1),_0x407d5f=new Date(_0x4b5b2f[_0x2dd2f5(0x27c)](),_0x4b5b2f[_0x2dd2f5(0x294)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x109a5a,_0x453a5e]=await Promise[_0x2dd2f5(0x28d)]([database_1[_0x2dd2f5(0x17e)][_0x2dd2f5(0x280)][_0x2dd2f5(0x242)]({'_sum':{'amount':!![]},'where':{'shopId':_0x2b29cf['id'],'status':_0x2dd2f5(0x270)}}),database_1[_0x2dd2f5(0x17e)][_0x2dd2f5(0x280)]['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x2b29cf['id'],'status':_0x2dd2f5(0x270),'createdAt':{'gte':_0x13a6de,'lte':_0x407d5f}}})]),_0x4256c7=_0x109a5a[_0x2dd2f5(0x17d)][_0x2dd2f5(0x221)]||0x0,_0x19253f=_0x453a5e[_0x2dd2f5(0x17d)]['amount']||0x0,_0x382ddd=await Promise['all'](_0x45af49['map'](async _0x5d9b96=>{const _0x4f0e5b=_0x2dd2f5;let _0x325f48=0xa;if(_0x2b29cf[_0x4f0e5b(0x239)])try{const _0x29f209=JSON[_0x4f0e5b(0x18c)](_0x2b29cf[_0x4f0e5b(0x239)]);for(const [_0x56a9f3,_0x562173]of Object['entries'](_0x29f209)){if(_0x56a9f3[_0x4f0e5b(0x1dd)]()===_0x5d9b96[_0x4f0e5b(0x1f2)][_0x4f0e5b(0x1dd)]()){_0x325f48=_0x562173[_0x4f0e5b(0x263)]||0xa,console[_0x4f0e5b(0x23c)](_0x4f0e5b(0x1a1)+_0x5d9b96[_0x4f0e5b(0x1f2)]+'\x20for\x20shop\x20'+_0x2b29cf['id']+_0x4f0e5b(0x26e)+_0x325f48+'%');break;}}}catch(_0x5a546b){console[_0x4f0e5b(0x23e)]('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x2b29cf['id']+':',_0x5a546b);}const _0x1b88bf=_0x5d9b96['_sum'][_0x4f0e5b(0x210)]||0x0,_0x7f47a5=_0x1b88bf*(0x1-_0x325f48/0x64);return{'gateway':_0x5d9b96[_0x4f0e5b(0x1f2)],'count':_0x5d9b96[_0x4f0e5b(0x18a)]['id'],'amountUSDT':Math[_0x4f0e5b(0x232)](_0x1b88bf*0x64)/0x64,'amountAfterCommissionUSDT':Math['round'](_0x7f47a5*0x64)/0x64,'commission':_0x325f48};})),_0x42ffa1=_0x382ddd[_0x2dd2f5(0x1d3)]((_0xd983ff,_0x228df9)=>_0xd983ff+_0x228df9[_0x2dd2f5(0x210)],0x0),_0x26dce0=_0x2b29cf[_0x2dd2f5(0x1a4)];return console[_0x2dd2f5(0x23c)](_0x2dd2f5(0x1d2)+_0x2b29cf[_0x2dd2f5(0x188)]+':'),console['log'](_0x2dd2f5(0x1ac)+_0x42ffa1['toFixed'](0x2)+_0x2dd2f5(0x180)),console['log'](_0x2dd2f5(0x254)+_0x382ddd[_0x2dd2f5(0x1d3)]((_0x2849b8,_0x18d851)=>_0x2849b8+_0x18d851[_0x2dd2f5(0x26c)],0x0)[_0x2dd2f5(0x1e3)](0x2)+_0x2dd2f5(0x1e8)),console[_0x2dd2f5(0x23c)]('\x20\x20\x20✅\x20Actual\x20available\x20balance:\x20'+_0x26dce0['toFixed'](0x2)+_0x2dd2f5(0x1d7)),{'id':_0x2b29cf['id'],'fullName':_0x2b29cf[_0x2dd2f5(0x26b)],'username':_0x2b29cf[_0x2dd2f5(0x188)],'telegramId':_0x2b29cf[_0x2dd2f5(0x222)],'merchantUrl':_0x2b29cf[_0x2dd2f5(0x190)],'wallets':{'usdtPolygonWallet':_0x2b29cf['usdtPolygonWallet'],'usdtTrcWallet':_0x2b29cf['usdtTrcWallet'],'usdtErcWallet':_0x2b29cf[_0x2dd2f5(0x1e0)],'usdcPolygonWallet':_0x2b29cf[_0x2dd2f5(0x1f0)]},'totalAmountUSDT':Math[_0x2dd2f5(0x232)](_0x42ffa1*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x2dd2f5(0x232)](_0x26dce0*0x64)/0x64,'totalPayout':Math[_0x2dd2f5(0x232)](_0x4256c7*0x64)/0x64,'thisMonth':Math['round'](_0x19253f*0x64)/0x64,'paymentsCount':_0x37eba4,'oldestPaymentDate':_0x251ae1?.[_0x2dd2f5(0x194)]||_0x2b29cf[_0x2dd2f5(0x27f)],'gatewayBreakdown':_0x382ddd};})),_0x581deb=_0x2534fc[_0x19e01a(0x1d3)]((_0x1d2a0e,_0x5d449f)=>_0x1d2a0e+_0x5d449f[_0x19e01a(0x1cd)],0x0),_0x3c092d=_0x2534fc['reduce']((_0x256826,_0x3e3160)=>_0x256826+_0x3e3160['totalAmountAfterCommissionUSDT'],0x0),_0x586766=_0x2534fc['reduce']((_0x4d85ca,_0x28ae5a)=>_0x4d85ca+_0x28ae5a[_0x19e01a(0x258)],0x0),_0x3e5ff0=_0x2534fc[_0x19e01a(0x1d3)]((_0x5ac66f,_0x341ec5)=>_0x5ac66f+_0x341ec5[_0x19e01a(0x253)],0x0);return console[_0x19e01a(0x23c)](_0x19e01a(0x1ec)+_0x6546f7+_0x19e01a(0x1fd)),console[_0x19e01a(0x23c)](_0x19e01a(0x197)+Math[_0x19e01a(0x232)](_0x581deb*0x64)/0x64+'\x20USDT\x20(gross\x20revenue)'),console['log'](_0x19e01a(0x185)+Math['round'](_0x3c092d*0x64)/0x64+_0x19e01a(0x17c)),console[_0x19e01a(0x23c)]('\x20\x20\x20💸\x20Total\x20payouts\x20(all\x20time):\x20'+Math[_0x19e01a(0x232)](_0x586766*0x64)/0x64+_0x19e01a(0x22d)),console[_0x19e01a(0x23c)](_0x19e01a(0x286)+Math[_0x19e01a(0x232)](_0x3e5ff0*0x64)/0x64+_0x19e01a(0x22d)),{'merchants':_0x2534fc,'pagination':{'page':_0x4a686a,'limit':_0x4765c9,'total':_0x6546f7,'totalPages':Math[_0x19e01a(0x1a0)](_0x6546f7/_0x4765c9)},'summary':{'totalMerchants':_0x6546f7,'totalAmountUSDT':Math[_0x19e01a(0x232)](_0x581deb*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x3c092d*0x64)/0x64,'totalPayout':Math[_0x19e01a(0x232)](_0x586766*0x64)/0x64,'thisMonth':Math[_0x19e01a(0x232)](_0x3e5ff0*0x64)/0x64}};}async[a35_0x55df78(0x202)](_0x3d7ba5){const _0x4e8bdc=a35_0x55df78,{shopId:_0x12a230,amount:_0x449500,network:_0x263947,wallet:_0x17fa6e,notes:_0x11df81,txid:_0x6653f8,periodFrom:_0x53562a,periodTo:_0x15198b}=_0x3d7ba5,_0x5ddd67=await database_1[_0x4e8bdc(0x17e)][_0x4e8bdc(0x277)](async _0xabda5e=>{const _0x5d0b41=_0x4e8bdc,_0x5e9814=await _0xabda5e[_0x5d0b41(0x178)]['findUnique']({'where':{'id':_0x12a230},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x5e9814)throw new Error(_0x5d0b41(0x238));console['log']('💰\x20Creating\x20payout\x20for\x20shop\x20'+_0x5e9814[_0x5d0b41(0x188)]+':'),console[_0x5d0b41(0x23c)](_0x5d0b41(0x24b)+_0x5e9814[_0x5d0b41(0x1a4)]['toFixed'](0x6)+_0x5d0b41(0x22d)),console['log']('\x20\x20\x20Payout\x20amount:\x20'+_0x449500[_0x5d0b41(0x1e3)](0x6)+_0x5d0b41(0x22d)),console['log'](_0x5d0b41(0x1bb)+_0x5e9814['totalPaidOut'][_0x5d0b41(0x1e3)](0x6)+'\x20USDT');if(_0x6653f8)console[_0x5d0b41(0x23c)](_0x5d0b41(0x260)+_0x6653f8);if(_0x5e9814[_0x5d0b41(0x1a4)]<_0x449500)throw new Error(_0x5d0b41(0x200)+_0x5e9814['balance'][_0x5d0b41(0x1e3)](0x6)+_0x5d0b41(0x195)+_0x449500[_0x5d0b41(0x1e3)](0x6)+_0x5d0b41(0x22d));let _0x3c403d=_0x17fa6e;if(!_0x3c403d){const _0x386d25=await _0xabda5e['shop'][_0x5d0b41(0x292)]({'where':{'id':_0x12a230},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x386d25)switch(_0x263947){case _0x5d0b41(0x1b8):_0x3c403d=_0x386d25[_0x5d0b41(0x21d)]||undefined;break;case _0x5d0b41(0x1db):_0x3c403d=_0x386d25[_0x5d0b41(0x211)]||undefined;break;case _0x5d0b41(0x298):_0x3c403d=_0x386d25[_0x5d0b41(0x1e0)]||undefined;break;case _0x5d0b41(0x227):_0x3c403d=_0x386d25[_0x5d0b41(0x1f0)]||undefined;break;}}console[_0x5d0b41(0x23c)](_0x5d0b41(0x273)+_0x263947+':\x20'+(_0x3c403d||_0x5d0b41(0x248)));const _0x5d3056=await _0xabda5e[_0x5d0b41(0x280)][_0x5d0b41(0x256)]({'data':{'shopId':_0x12a230,'amount':_0x449500,'network':_0x263947,'status':_0x5d0b41(0x270),'txid':_0x6653f8,'notes':_0x11df81,'periodFrom':_0x53562a?new Date(_0x53562a):null,'periodTo':_0x15198b?new Date(_0x15198b):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x2617e1=_0x5e9814[_0x5d0b41(0x1a4)]-_0x449500,_0x434bd5=_0x5e9814[_0x5d0b41(0x22b)]+_0x449500;return await _0xabda5e[_0x5d0b41(0x178)][_0x5d0b41(0x1b3)]({'where':{'id':_0x12a230},'data':{'balance':_0x2617e1,'totalPaidOut':_0x434bd5}}),console[_0x5d0b41(0x23c)](_0x5d0b41(0x204)+_0x5e9814[_0x5d0b41(0x188)]+_0x5d0b41(0x23d)),console['log'](_0x5d0b41(0x25f)+_0x5e9814[_0x5d0b41(0x1a4)]['toFixed'](0x6)+_0x5d0b41(0x249)+_0x2617e1[_0x5d0b41(0x1e3)](0x6)+_0x5d0b41(0x251)+_0x449500[_0x5d0b41(0x1e3)](0x6)+')'),console[_0x5d0b41(0x23c)](_0x5d0b41(0x1c5)+_0x5e9814[_0x5d0b41(0x22b)][_0x5d0b41(0x1e3)](0x6)+'\x20->\x20'+_0x434bd5[_0x5d0b41(0x1e3)](0x6)+_0x5d0b41(0x296)+_0x449500[_0x5d0b41(0x1e3)](0x6)+')'),{'payout':_0x5d3056,'shop':_0x5e9814};});return console['log']('✅\x20Payout\x20created:\x20'+_0x5ddd67['payout']['id']+'\x20for\x20shop\x20'+_0x5ddd67[_0x4e8bdc(0x178)][_0x4e8bdc(0x188)]+'\x20('+_0x449500+_0x4e8bdc(0x25e)),{'id':_0x5ddd67[_0x4e8bdc(0x280)]['id'],'shopId':_0x5ddd67['payout']['shopId'],'shopName':_0x5ddd67['shop']['name'],'shopUsername':_0x5ddd67[_0x4e8bdc(0x178)][_0x4e8bdc(0x188)],'amount':_0x5ddd67[_0x4e8bdc(0x280)][_0x4e8bdc(0x221)],'network':_0x5ddd67[_0x4e8bdc(0x280)]['network'],'status':_0x5ddd67['payout']['status'],'txid':_0x5ddd67[_0x4e8bdc(0x280)][_0x4e8bdc(0x269)],'notes':_0x5ddd67[_0x4e8bdc(0x280)][_0x4e8bdc(0x1d9)],'periodFrom':_0x5ddd67[_0x4e8bdc(0x280)][_0x4e8bdc(0x1bc)],'periodTo':_0x5ddd67[_0x4e8bdc(0x280)][_0x4e8bdc(0x1a5)],'createdAt':_0x5ddd67[_0x4e8bdc(0x280)]['createdAt'],'paidAt':_0x5ddd67[_0x4e8bdc(0x280)][_0x4e8bdc(0x194)]};}async[a35_0x55df78(0x17b)](_0x20ad6e){const _0x580f2c=a35_0x55df78,{page:_0x2fa4aa,limit:_0x46d449,shopId:_0x8e37a3,network:_0xe85eb3,dateFrom:_0x42aaf6,dateTo:_0x5dedb8,search:_0x51858c}=_0x20ad6e,_0xc33964=(_0x2fa4aa-0x1)*_0x46d449,_0x750ac8={};_0x8e37a3&&(_0x750ac8['shopId']=_0x8e37a3);_0xe85eb3&&(_0x750ac8[_0x580f2c(0x1ef)]=_0xe85eb3);(_0x42aaf6||_0x5dedb8)&&(_0x750ac8[_0x580f2c(0x27f)]={},_0x42aaf6&&(_0x750ac8[_0x580f2c(0x27f)][_0x580f2c(0x228)]=new Date(_0x42aaf6)),_0x5dedb8&&(_0x750ac8[_0x580f2c(0x27f)][_0x580f2c(0x22e)]=new Date(_0x5dedb8)));_0x51858c&&(_0x750ac8['OR']=[{'shop':{'name':{'contains':_0x51858c,'mode':_0x580f2c(0x1c3)}}},{'shop':{'username':{'contains':_0x51858c,'mode':_0x580f2c(0x1c3)}}},{'notes':{'contains':_0x51858c,'mode':_0x580f2c(0x1c3)}}]);const [_0x16fc58,_0x3cf78b]=await Promise[_0x580f2c(0x28d)]([database_1['default'][_0x580f2c(0x280)]['findMany']({'where':_0x750ac8,'skip':_0xc33964,'take':_0x46d449,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x580f2c(0x17e)][_0x580f2c(0x280)]['count']({'where':_0x750ac8})]);return{'payouts':_0x16fc58[_0x580f2c(0x1ed)](_0x2cad34=>({'id':_0x2cad34['id'],'shopId':_0x2cad34[_0x580f2c(0x19b)],'shopName':_0x2cad34['shop'][_0x580f2c(0x26b)],'shopUsername':_0x2cad34['shop'][_0x580f2c(0x188)],'amount':_0x2cad34[_0x580f2c(0x221)],'network':_0x2cad34['network'],'status':_0x2cad34['status'],'txid':_0x2cad34[_0x580f2c(0x269)],'notes':_0x2cad34[_0x580f2c(0x1d9)],'periodFrom':_0x2cad34[_0x580f2c(0x1bc)],'periodTo':_0x2cad34[_0x580f2c(0x1a5)],'createdAt':_0x2cad34[_0x580f2c(0x27f)],'paidAt':_0x2cad34[_0x580f2c(0x194)]})),'pagination':{'page':_0x2fa4aa,'limit':_0x46d449,'total':_0x3cf78b,'totalPages':Math['ceil'](_0x3cf78b/_0x46d449)}};}async[a35_0x55df78(0x19c)](_0x2d654f){const _0x5b2578=a35_0x55df78,_0x3157c5=await database_1[_0x5b2578(0x17e)][_0x5b2578(0x280)][_0x5b2578(0x292)]({'where':{'id':_0x2d654f},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x3157c5)return null;return{'id':_0x3157c5['id'],'shopId':_0x3157c5[_0x5b2578(0x19b)],'shopName':_0x3157c5['shop'][_0x5b2578(0x26b)],'shopUsername':_0x3157c5[_0x5b2578(0x178)][_0x5b2578(0x188)],'amount':_0x3157c5['amount'],'network':_0x3157c5[_0x5b2578(0x1ef)],'status':_0x3157c5[_0x5b2578(0x1b2)],'txid':_0x3157c5[_0x5b2578(0x269)],'notes':_0x3157c5[_0x5b2578(0x1d9)],'periodFrom':_0x3157c5[_0x5b2578(0x1bc)],'periodTo':_0x3157c5['periodTo'],'createdAt':_0x3157c5[_0x5b2578(0x27f)],'paidAt':_0x3157c5['paidAt']};}async[a35_0x55df78(0x1d0)](_0x12e1df){const _0x3bf7ee=a35_0x55df78;await database_1[_0x3bf7ee(0x17e)][_0x3bf7ee(0x280)][_0x3bf7ee(0x1ab)]({'where':{'id':_0x12e1df}});}async[a35_0x55df78(0x1d1)](_0x255e76){const _0x291eba=a35_0x55df78,{page:_0x16b845,limit:_0x4c7241,status:_0x4b6d4a,gateway:_0x4890b6,shopId:_0x4a9446,dateFrom:_0x346f03,dateTo:_0x424263,search:_0x2c00f9,currency:_0x542d17,sortBy:_0x4ebf02,sortOrder:_0x2e3212}=_0x255e76,_0x42b7f3=(_0x16b845-0x1)*_0x4c7241;console['log'](_0x291eba(0x282),_0x255e76);const _0xb29c0c=await database_1[_0x291eba(0x17e)][_0x291eba(0x20f)][_0x291eba(0x20d)]({'by':[_0x291eba(0x1f2)],'_count':{'gateway':!![]}});console['log']('📊\x20Available\x20gateways\x20in\x20database:',_0xb29c0c['map'](_0x6bed38=>_0x6bed38[_0x291eba(0x1f2)]+'\x20('+_0x6bed38[_0x291eba(0x18a)][_0x291eba(0x1f2)]+'\x20payments)'));if(_0x4890b6){const _0x3c02d2=_0xb29c0c[_0x291eba(0x209)](_0x3c82ee=>_0x3c82ee[_0x291eba(0x1f2)][_0x291eba(0x1dd)]()===_0x4890b6['toLowerCase']());!_0x3c02d2&&_0x4890b6[_0x291eba(0x1dd)]()!==_0x291eba(0x255)&&console[_0x291eba(0x23c)]('⚠️\x20Requested\x20gateway\x20\x27'+_0x4890b6+_0x291eba(0x24c)+_0xb29c0c[_0x291eba(0x1ed)](_0x4abea7=>_0x4abea7[_0x291eba(0x1f2)])[_0x291eba(0x285)](',\x20'));}const _0x1808b5={};_0x4b6d4a&&(_0x1808b5[_0x291eba(0x1b2)]=_0x4b6d4a['toUpperCase']());if(!_0x4890b6)_0x1808b5[_0x291eba(0x1f2)]={'not':_0x291eba(0x255)};else{if(_0x4890b6&&(_0x4890b6['toLowerCase']()===_0x291eba(0x255)||_0x4890b6==='0000'))_0x1808b5[_0x291eba(0x1f2)]='test_gateway';else{let _0x3cbaeb=_0x4890b6;const _0x138bc3=(0x0,gateway_1[_0x291eba(0x27a)])(_0x4890b6);if(_0x138bc3)_0x3cbaeb=_0x138bc3,console['log']('🔄\x20Converted\x20gateway\x20ID\x20\x27'+_0x4890b6+_0x291eba(0x29b)+_0x3cbaeb+'\x27');else{const _0x90d56a=(0x0,gateway_1[_0x291eba(0x1c1)])(_0x4890b6);if(_0x90d56a){const _0x28ec08=(0x0,gateway_1['getGatewayNameById'])(_0x90d56a);_0x28ec08&&(_0x3cbaeb=_0x28ec08,console[_0x291eba(0x23c)](_0x291eba(0x201)+_0x4890b6+'\x27\x20->\x20ID\x20\x27'+_0x90d56a+_0x291eba(0x1af)+_0x3cbaeb+'\x27'));}else console[_0x291eba(0x23c)](_0x291eba(0x214)+_0x4890b6+'\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)');}const _0x3d9735=await database_1['default'][_0x291eba(0x20f)]['count']({'where':{'gateway':_0x3cbaeb[_0x291eba(0x1dd)]()},'take':0x1});_0x3d9735===0x0?(console['log'](_0x291eba(0x215)+_0x3cbaeb+_0x291eba(0x284)+_0x4890b6+_0x291eba(0x1a6)),_0x1808b5[_0x291eba(0x1f2)]=_0x291eba(0x25c)):(_0x1808b5[_0x291eba(0x1f2)]=_0x3cbaeb[_0x291eba(0x1dd)](),console[_0x291eba(0x23c)](_0x291eba(0x1f6)+_0x3cbaeb+_0x291eba(0x284)+_0x4890b6+'\x27)'));}}console['log'](_0x291eba(0x28f),_0x1808b5[_0x291eba(0x1f2)]);_0x4a9446&&(_0x1808b5[_0x291eba(0x19b)]=_0x4a9446);_0x542d17&&(_0x1808b5[_0x291eba(0x1a8)]=_0x542d17[_0x291eba(0x257)](),console[_0x291eba(0x23c)](_0x291eba(0x191)+_0x542d17[_0x291eba(0x257)]()));(_0x346f03||_0x424263)&&(_0x1808b5[_0x291eba(0x27f)]={},_0x346f03&&(_0x1808b5[_0x291eba(0x27f)][_0x291eba(0x228)]=new Date(_0x346f03)),_0x424263&&(_0x1808b5[_0x291eba(0x27f)]['lte']=new Date(_0x424263)));_0x2c00f9&&(_0x1808b5['OR']=[{'id':{'contains':_0x2c00f9,'mode':_0x291eba(0x1c3)}},{'orderId':{'contains':_0x2c00f9,'mode':_0x291eba(0x1c3)}},{'gatewayOrderId':{'contains':_0x2c00f9,'mode':_0x291eba(0x1c3)}},{'customerEmail':{'contains':_0x2c00f9,'mode':_0x291eba(0x1c3)}},{'shop':{'name':{'contains':_0x2c00f9,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x2c00f9,'mode':'insensitive'}}}]);console[_0x291eba(0x23c)](_0x291eba(0x19e),JSON[_0x291eba(0x27e)](_0x1808b5,null,0x2));let _0x3f7cf2={'createdAt':'desc'};if(_0x4ebf02){const _0x40be20=['amount','createdAt',_0x291eba(0x1cf),_0x291eba(0x1b2),_0x291eba(0x1f2),'currency'],_0x5d4de9=[_0x291eba(0x229),'desc'];if(_0x40be20[_0x291eba(0x206)](_0x4ebf02)){const _0x2a7ed1=_0x5d4de9[_0x291eba(0x206)](_0x2e3212)?_0x2e3212:'desc';_0x3f7cf2={[_0x4ebf02]:_0x2a7ed1},console[_0x291eba(0x23c)](_0x291eba(0x21a)+_0x4ebf02+'\x20in\x20'+_0x2a7ed1+_0x291eba(0x265));}}const [_0x1c0cd3,_0x3d77fb]=await Promise['all']([database_1[_0x291eba(0x17e)][_0x291eba(0x20f)]['findMany']({'where':_0x1808b5,'skip':_0x42b7f3,'take':_0x4c7241,'orderBy':_0x3f7cf2,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default']['payment'][_0x291eba(0x27d)]({'where':_0x1808b5})]);return{'payments':_0x1c0cd3,'pagination':{'page':_0x16b845,'limit':_0x4c7241,'total':_0x3d77fb,'totalPages':Math[_0x291eba(0x1a0)](_0x3d77fb/_0x4c7241)}};}async[a35_0x55df78(0x203)](_0x2fd366){const _0x22c24f=a35_0x55df78,_0x14241a=await database_1[_0x22c24f(0x17e)][_0x22c24f(0x20f)]['findUnique']({'where':{'id':_0x2fd366},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x14241a)return null;return{'id':_0x14241a['id'],'shopId':_0x14241a[_0x22c24f(0x19b)],'gateway':_0x14241a[_0x22c24f(0x1f2)],'amount':_0x14241a[_0x22c24f(0x221)],'currency':_0x14241a[_0x22c24f(0x1a8)],'status':_0x14241a[_0x22c24f(0x1b2)],'orderId':_0x14241a[_0x22c24f(0x22c)],'gatewayOrderId':_0x14241a[_0x22c24f(0x1b6)],'customerEmail':_0x14241a[_0x22c24f(0x240)],'customerName':_0x14241a['customerName'],'customerCountry':_0x14241a[_0x22c24f(0x24a)],'customerIp':_0x14241a[_0x22c24f(0x281)],'customerUa':_0x14241a[_0x22c24f(0x20c)],'failureMessage':_0x14241a[_0x22c24f(0x23f)],'externalPaymentUrl':_0x14241a['externalPaymentUrl'],'successUrl':_0x14241a[_0x22c24f(0x1f8)],'failUrl':_0x14241a[_0x22c24f(0x26f)],'pendingUrl':_0x14241a[_0x22c24f(0x29a)],'whiteUrl':_0x14241a['whiteUrl'],'createdAt':_0x14241a['createdAt'],'updatedAt':_0x14241a[_0x22c24f(0x1cf)],'shop':_0x14241a['shop']};}async[a35_0x55df78(0x28e)](_0xa9a126,_0x4d32ab,_0x448cec,_0x293089){const _0x52759c=a35_0x55df78,_0x508bc6=await database_1[_0x52759c(0x17e)]['$transaction'](async _0x2c9641=>{const _0x111ba5=_0x52759c,_0x2b54e7=await _0x2c9641[_0x111ba5(0x20f)][_0x111ba5(0x292)]({'where':{'id':_0xa9a126},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x2b54e7)throw new Error(_0x111ba5(0x1c0));const _0x5bd57f=_0x2b54e7[_0x111ba5(0x1b2)],_0x4f9bb0=_0x4d32ab['toUpperCase']();console['log'](_0x111ba5(0x20e)+_0xa9a126+_0x111ba5(0x231)+_0x5bd57f+_0x111ba5(0x249)+_0x4f9bb0),console[_0x111ba5(0x23c)]('💰\x20Current\x20shop\x20balance:\x20'+_0x2b54e7[_0x111ba5(0x178)][_0x111ba5(0x1a4)]+_0x111ba5(0x22d));const _0x3cbc5a={'status':_0x4f9bb0,'updatedAt':new Date(),'statusChangedBy':_0x111ba5(0x1e7),'statusChangedAt':new Date()};_0x448cec&&(_0x3cbc5a['adminNotes']=_0x448cec);_0x4f9bb0===_0x111ba5(0x247)&&_0x293089&&(_0x3cbc5a[_0x111ba5(0x1a3)]=_0x293089);let _0x43c8e1=0x0,_0x1ab68a=_0x2b54e7[_0x111ba5(0x178)][_0x111ba5(0x1a4)];if(_0x4f9bb0===_0x111ba5(0x1ca)&&_0x5bd57f!==_0x111ba5(0x1ca)){_0x3cbc5a[_0x111ba5(0x194)]=new Date();const _0x5f4187=await currencyService_1[_0x111ba5(0x1d5)][_0x111ba5(0x182)](_0x2b54e7[_0x111ba5(0x221)],_0x2b54e7[_0x111ba5(0x1a8)]);_0x3cbc5a['amountUSDT']=_0x5f4187;let _0x5dd5b4=0xa;const _0x1e85f6=await _0x2c9641[_0x111ba5(0x178)][_0x111ba5(0x292)]({'where':{'id':_0x2b54e7[_0x111ba5(0x19b)]},'select':{'gatewaySettings':!![]}});if(_0x1e85f6?.[_0x111ba5(0x239)])try{const _0x4fa276=JSON['parse'](_0x1e85f6[_0x111ba5(0x239)]);for(const [_0x478c8e,_0x30b60e]of Object[_0x111ba5(0x193)](_0x4fa276)){if(_0x478c8e[_0x111ba5(0x1dd)]()===_0x2b54e7[_0x111ba5(0x1f2)][_0x111ba5(0x1dd)]()){_0x5dd5b4=_0x30b60e[_0x111ba5(0x263)]||0xa;break;}}}catch(_0x4753e6){console[_0x111ba5(0x23e)](_0x111ba5(0x235)+_0xa9a126+':',_0x4753e6);}const _0x5e9c18=_0x5f4187*(0x1-_0x5dd5b4/0x64);_0x43c8e1=_0x5e9c18,_0x1ab68a+=_0x5e9c18,console[_0x111ba5(0x23c)](_0x111ba5(0x187)+_0xa9a126+'\x20became\x20PAID:'),console[_0x111ba5(0x23c)]('\x20\x20\x20Full\x20amount:\x20'+_0x5f4187[_0x111ba5(0x1e3)](0x6)+'\x20USDT'),console[_0x111ba5(0x23c)](_0x111ba5(0x219)+_0x2b54e7[_0x111ba5(0x1f2)]+_0x111ba5(0x22a)+_0x5dd5b4+'%'),console[_0x111ba5(0x23c)]('\x20\x20\x20Merchant\x20gets:\x20'+_0x5e9c18[_0x111ba5(0x1e3)](0x6)+'\x20USDT\x20(after\x20'+_0x5dd5b4+_0x111ba5(0x18e)),console[_0x111ba5(0x23c)](_0x111ba5(0x272)+_0x5e9c18[_0x111ba5(0x1e3)](0x6)+_0x111ba5(0x22d));}else{if(_0x5bd57f===_0x111ba5(0x1ca)&&_0x4f9bb0!=='PAID'){if(_0x2b54e7[_0x111ba5(0x210)]){let _0x6c5d4d=0xa;const _0x5acd60=await _0x2c9641['shop']['findUnique']({'where':{'id':_0x2b54e7['shopId']},'select':{'gatewaySettings':!![]}});if(_0x5acd60?.[_0x111ba5(0x239)])try{const _0x34fa62=JSON[_0x111ba5(0x18c)](_0x5acd60[_0x111ba5(0x239)]);for(const [_0x18893c,_0x5b692b]of Object[_0x111ba5(0x193)](_0x34fa62)){if(_0x18893c[_0x111ba5(0x1dd)]()===_0x2b54e7[_0x111ba5(0x1f2)][_0x111ba5(0x1dd)]()){_0x6c5d4d=_0x5b692b[_0x111ba5(0x263)]||0xa;break;}}}catch(_0x43daad){console[_0x111ba5(0x23e)](_0x111ba5(0x235)+_0xa9a126+':',_0x43daad);}const _0x1e76e9=_0x2b54e7[_0x111ba5(0x210)]*(0x1-_0x6c5d4d/0x64);_0x43c8e1=-_0x1e76e9,_0x1ab68a-=_0x1e76e9,_0x3cbc5a['amountUSDT']=null,console[_0x111ba5(0x23c)]('💰\x20Payment\x20'+_0xa9a126+_0x111ba5(0x271)),console['log'](_0x111ba5(0x1e2)+_0x2b54e7[_0x111ba5(0x210)][_0x111ba5(0x1e3)](0x6)+_0x111ba5(0x22d)),console[_0x111ba5(0x23c)](_0x111ba5(0x219)+_0x2b54e7[_0x111ba5(0x1f2)]+',\x20Commission:\x20'+_0x6c5d4d+'%'),console['log'](_0x111ba5(0x1bd)+_0x1e76e9[_0x111ba5(0x1e3)](0x6)+_0x111ba5(0x1f9)+_0x6c5d4d+_0x111ba5(0x18e)),console[_0x111ba5(0x23c)](_0x111ba5(0x297)+_0x1e76e9[_0x111ba5(0x1e3)](0x6)+_0x111ba5(0x22d));}}}_0x4f9bb0===_0x111ba5(0x247)&&(_0x5bd57f==='PAID'&&_0x2b54e7[_0x111ba5(0x210)]&&console[_0x111ba5(0x23c)]('💸\x20CHARGEBACK:\x20Merchant\x20amount\x20already\x20deducted\x20from\x20balance'),_0x293089&&_0x293089>0x0&&(_0x43c8e1-=_0x293089,_0x1ab68a-=_0x293089,console[_0x111ba5(0x23c)](_0x111ba5(0x1fb)+_0x293089[_0x111ba5(0x1e3)](0x6)+_0x111ba5(0x295))));_0x4f9bb0===_0x111ba5(0x244)&&_0x5bd57f===_0x111ba5(0x1ca)&&console['log']('🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance');const _0x400c05=await _0x2c9641['payment'][_0x111ba5(0x1b3)]({'where':{'id':_0xa9a126},'data':_0x3cbc5a,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x43c8e1!==0x0&&(await _0x2c9641[_0x111ba5(0x178)][_0x111ba5(0x1b3)]({'where':{'id':_0x2b54e7['shopId']},'data':{'balance':_0x1ab68a}}),console['log'](_0x111ba5(0x204)+_0x2b54e7[_0x111ba5(0x19b)]+_0x111ba5(0x233)+_0x2b54e7[_0x111ba5(0x178)][_0x111ba5(0x1a4)][_0x111ba5(0x1e3)](0x6)+'\x20->\x20'+_0x1ab68a['toFixed'](0x6)+_0x111ba5(0x189)+(_0x43c8e1>0x0?'+':'')+_0x43c8e1[_0x111ba5(0x1e3)](0x6)+')')),_0x400c05;});return{'id':_0x508bc6['id'],'shopId':_0x508bc6[_0x52759c(0x19b)],'gateway':_0x508bc6[_0x52759c(0x1f2)],'amount':_0x508bc6[_0x52759c(0x221)],'currency':_0x508bc6[_0x52759c(0x1a8)],'status':_0x508bc6[_0x52759c(0x1b2)],'orderId':_0x508bc6[_0x52759c(0x22c)],'gatewayOrderId':_0x508bc6[_0x52759c(0x1b6)],'customerEmail':_0x508bc6[_0x52759c(0x240)],'customerName':_0x508bc6[_0x52759c(0x1a7)],'customerCountry':_0x508bc6['customerCountry'],'customerIp':_0x508bc6[_0x52759c(0x281)],'customerUa':_0x508bc6[_0x52759c(0x20c)],'failureMessage':_0x508bc6[_0x52759c(0x23f)],'adminNotes':_0x508bc6[_0x52759c(0x213)],'chargebackAmount':_0x508bc6['chargebackAmount'],'statusChangedBy':_0x508bc6[_0x52759c(0x218)],'statusChangedAt':_0x508bc6[_0x52759c(0x199)],'createdAt':_0x508bc6['createdAt'],'updatedAt':_0x508bc6[_0x52759c(0x1cf)],'shop':_0x508bc6['shop']};}async['updateUser'](_0x564175,_0x4bf6c1){const _0x22c882=a35_0x55df78,_0x29f858={..._0x4bf6c1};_0x4bf6c1[_0x22c882(0x279)]&&(_0x29f858[_0x22c882(0x279)]=await bcryptjs_1['default'][_0x22c882(0x18d)](_0x4bf6c1[_0x22c882(0x279)],0xc));_0x4bf6c1[_0x22c882(0x287)]&&(_0x29f858[_0x22c882(0x26b)]=_0x4bf6c1['fullName'],delete _0x29f858[_0x22c882(0x287)]);_0x4bf6c1[_0x22c882(0x1b4)]&&(_0x29f858[_0x22c882(0x222)]=_0x4bf6c1[_0x22c882(0x1b4)],delete _0x29f858[_0x22c882(0x1b4)]);_0x4bf6c1['merchantUrl']&&(_0x29f858[_0x22c882(0x190)]=_0x4bf6c1[_0x22c882(0x250)],delete _0x29f858[_0x22c882(0x250)]);if(_0x4bf6c1['gateways']){const _0xc290b2=_0x4bf6c1[_0x22c882(0x1d8)][_0x22c882(0x1ed)](_0x465c35=>this[_0x22c882(0x177)](_0x465c35));console[_0x22c882(0x23c)]('🔄\x20Gateway\x20mapping:',_0x4bf6c1[_0x22c882(0x1d8)],'->',_0xc290b2),_0x29f858[_0x22c882(0x18f)]=JSON['stringify'](_0xc290b2),delete _0x29f858[_0x22c882(0x1d8)];}_0x4bf6c1[_0x22c882(0x239)]&&(_0x29f858[_0x22c882(0x239)]=JSON[_0x22c882(0x27e)](_0x4bf6c1[_0x22c882(0x239)]),delete _0x29f858[_0x22c882(0x239)]);_0x4bf6c1[_0x22c882(0x25a)]&&(_0x4bf6c1[_0x22c882(0x25a)]['usdtPolygonWallet']!==undefined&&(_0x29f858[_0x22c882(0x21d)]=_0x4bf6c1[_0x22c882(0x25a)][_0x22c882(0x21d)]||null),_0x4bf6c1[_0x22c882(0x25a)][_0x22c882(0x211)]!==undefined&&(_0x29f858[_0x22c882(0x211)]=_0x4bf6c1[_0x22c882(0x25a)]['usdtTrcWallet']||null),_0x4bf6c1['wallets'][_0x22c882(0x1e0)]!==undefined&&(_0x29f858[_0x22c882(0x1e0)]=_0x4bf6c1[_0x22c882(0x25a)][_0x22c882(0x1e0)]||null),_0x4bf6c1[_0x22c882(0x25a)][_0x22c882(0x1f0)]!==undefined&&(_0x29f858['usdcPolygonWallet']=_0x4bf6c1[_0x22c882(0x25a)][_0x22c882(0x1f0)]||null),delete _0x29f858['wallets']);const _0x290429=await database_1[_0x22c882(0x17e)][_0x22c882(0x178)][_0x22c882(0x1b3)]({'where':{'id':_0x564175},'data':_0x29f858,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x290429['id'],'fullName':_0x290429['name'],'username':_0x290429[_0x22c882(0x188)],'telegramId':_0x290429[_0x22c882(0x222)],'merchantUrl':_0x290429['shopUrl'],'gateways':_0x290429[_0x22c882(0x18f)]?JSON['parse'](_0x290429[_0x22c882(0x18f)]):null,'gatewaySettings':_0x290429[_0x22c882(0x239)]?JSON[_0x22c882(0x18c)](_0x290429[_0x22c882(0x239)]):null,'publicKey':_0x290429[_0x22c882(0x291)],'wallets':{'usdtPolygonWallet':_0x290429[_0x22c882(0x21d)],'usdtTrcWallet':_0x290429[_0x22c882(0x211)],'usdtErcWallet':_0x290429[_0x22c882(0x1e0)],'usdcPolygonWallet':_0x290429[_0x22c882(0x1f0)]},'status':_0x290429['status'],'createdAt':_0x290429[_0x22c882(0x27f)]};}async['suspendUser'](_0x46ef96){const _0x4c7e72=a35_0x55df78,_0x81c424=await database_1['default'][_0x4c7e72(0x178)][_0x4c7e72(0x1b3)]({'where':{'id':_0x46ef96},'data':{'status':_0x4c7e72(0x1f5)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x81c424['id'],'fullName':_0x81c424['name'],'username':_0x81c424[_0x4c7e72(0x188)],'telegramId':_0x81c424[_0x4c7e72(0x222)],'merchantUrl':_0x81c424['shopUrl'],'gateways':_0x81c424[_0x4c7e72(0x18f)]?JSON[_0x4c7e72(0x18c)](_0x81c424[_0x4c7e72(0x18f)]):null,'gatewaySettings':_0x81c424[_0x4c7e72(0x239)]?JSON[_0x4c7e72(0x18c)](_0x81c424['gatewaySettings']):null,'publicKey':_0x81c424[_0x4c7e72(0x291)],'wallets':{'usdtPolygonWallet':_0x81c424['usdtPolygonWallet'],'usdtTrcWallet':_0x81c424[_0x4c7e72(0x211)],'usdtErcWallet':_0x81c424[_0x4c7e72(0x1e0)],'usdcPolygonWallet':_0x81c424[_0x4c7e72(0x1f0)]},'status':_0x81c424[_0x4c7e72(0x1b2)],'createdAt':_0x81c424[_0x4c7e72(0x27f)]};}async[a35_0x55df78(0x24d)](_0x38dd30){const _0x36d2b1=a35_0x55df78,_0x4a8473=await database_1['default'][_0x36d2b1(0x178)]['update']({'where':{'id':_0x38dd30},'data':{'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4a8473['id'],'fullName':_0x4a8473['name'],'username':_0x4a8473[_0x36d2b1(0x188)],'telegramId':_0x4a8473[_0x36d2b1(0x222)],'merchantUrl':_0x4a8473[_0x36d2b1(0x190)],'gateways':_0x4a8473[_0x36d2b1(0x18f)]?JSON['parse'](_0x4a8473[_0x36d2b1(0x18f)]):null,'gatewaySettings':_0x4a8473[_0x36d2b1(0x239)]?JSON['parse'](_0x4a8473['gatewaySettings']):null,'publicKey':_0x4a8473[_0x36d2b1(0x291)],'wallets':{'usdtPolygonWallet':_0x4a8473['usdtPolygonWallet'],'usdtTrcWallet':_0x4a8473[_0x36d2b1(0x211)],'usdtErcWallet':_0x4a8473[_0x36d2b1(0x1e0)],'usdcPolygonWallet':_0x4a8473[_0x36d2b1(0x1f0)]},'status':_0x4a8473['status'],'createdAt':_0x4a8473[_0x36d2b1(0x27f)]};}async[a35_0x55df78(0x1f1)](_0x2ed47d){const _0x3e578e=a35_0x55df78,{page:_0x4cf5b3,limit:_0x2728a7,status:_0x376d11}=_0x2ed47d,_0x455ad3=(_0x4cf5b3-0x1)*_0x2728a7,_0x13e2c8={};_0x376d11&&(_0x13e2c8[_0x3e578e(0x1b2)]=_0x376d11['toUpperCase']());const [_0x3afcaa,_0x227b95]=await Promise[_0x3e578e(0x28d)]([database_1[_0x3e578e(0x17e)][_0x3e578e(0x178)]['findMany']({'where':_0x13e2c8,'skip':_0x455ad3,'take':_0x2728a7,'orderBy':{'createdAt':_0x3e578e(0x1fa)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1['default']['shop'][_0x3e578e(0x27d)]({'where':_0x13e2c8})]);return{'users':_0x3afcaa[_0x3e578e(0x1ed)](_0x204220=>{const _0x44cd0a=_0x3e578e,_0x4a158b=_0x204220[_0x44cd0a(0x18f)]?JSON[_0x44cd0a(0x18c)](_0x204220[_0x44cd0a(0x18f)]):null,_0x3efe9a=_0x4a158b?_0x4a158b['map'](_0x487df6=>this['getGatewayDisplayName'](_0x487df6)):null;return{'id':_0x204220['id'],'fullName':_0x204220[_0x44cd0a(0x26b)],'username':_0x204220['username'],'telegramId':_0x204220[_0x44cd0a(0x222)],'merchantUrl':_0x204220[_0x44cd0a(0x190)],'gateways':_0x3efe9a,'gatewaySettings':_0x204220[_0x44cd0a(0x239)]?JSON[_0x44cd0a(0x18c)](_0x204220[_0x44cd0a(0x239)]):null,'publicKey':_0x204220[_0x44cd0a(0x291)],'wallets':{'usdtPolygonWallet':_0x204220[_0x44cd0a(0x21d)],'usdtTrcWallet':_0x204220[_0x44cd0a(0x211)],'usdtErcWallet':_0x204220[_0x44cd0a(0x1e0)],'usdcPolygonWallet':_0x204220[_0x44cd0a(0x1f0)]},'status':_0x204220[_0x44cd0a(0x1b2)],'createdAt':_0x204220[_0x44cd0a(0x27f)]};}),'pagination':{'page':_0x4cf5b3,'limit':_0x2728a7,'total':_0x227b95,'totalPages':Math['ceil'](_0x227b95/_0x2728a7)}};}async[a35_0x55df78(0x19a)](_0x152c44){const _0x6f31fb=a35_0x55df78,_0x219081=await database_1[_0x6f31fb(0x17e)]['shop'][_0x6f31fb(0x292)]({'where':{'id':_0x152c44},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x219081)return null;const _0x488ea7=_0x219081[_0x6f31fb(0x18f)]?JSON[_0x6f31fb(0x18c)](_0x219081[_0x6f31fb(0x18f)]):null,_0x20d1e6=_0x488ea7?_0x488ea7[_0x6f31fb(0x1ed)](_0x229e4c=>this[_0x6f31fb(0x252)](_0x229e4c)):null;return _0x488ea7&&_0x20d1e6&&console[_0x6f31fb(0x23c)]('🔄\x20Gateway\x20mapping\x20(get):',_0x488ea7,'->',_0x20d1e6),{'id':_0x219081['id'],'fullName':_0x219081[_0x6f31fb(0x26b)],'username':_0x219081[_0x6f31fb(0x188)],'telegramId':_0x219081[_0x6f31fb(0x222)],'merchantUrl':_0x219081[_0x6f31fb(0x190)],'gateways':_0x20d1e6,'gatewaySettings':_0x219081['gatewaySettings']?JSON[_0x6f31fb(0x18c)](_0x219081[_0x6f31fb(0x239)]):null,'publicKey':_0x219081[_0x6f31fb(0x291)],'wallets':{'usdtPolygonWallet':_0x219081[_0x6f31fb(0x21d)],'usdtTrcWallet':_0x219081['usdtTrcWallet'],'usdtErcWallet':_0x219081['usdtErcWallet'],'usdcPolygonWallet':_0x219081[_0x6f31fb(0x1f0)]},'status':_0x219081['status'],'createdAt':_0x219081[_0x6f31fb(0x27f)]};}async['createUser'](_0xdd2828){const _0x3fc6af=a35_0x55df78,{fullName:_0x2f295c,username:_0x26b07d,password:_0x3b9fad,telegramId:_0x484ccd,merchantUrl:_0x127634,gateways:_0x22104d,gatewaySettings:_0xbb394b,wallets:_0x3d623b}=_0xdd2828,_0x471c8c=await database_1['default'][_0x3fc6af(0x178)]['findUnique']({'where':{'username':_0x26b07d}});if(_0x471c8c)throw new Error(_0x3fc6af(0x20b));if(_0x484ccd){const _0x1dda0f=await database_1['default'][_0x3fc6af(0x178)]['findUnique']({'where':{'telegram':_0x484ccd}});if(_0x1dda0f)throw new Error(_0x3fc6af(0x1ff));}const _0x5b6ac7=await bcryptjs_1[_0x3fc6af(0x17e)][_0x3fc6af(0x18d)](_0x3b9fad,0xc),_0x4c5f90=_0x3fc6af(0x216)+crypto_1[_0x3fc6af(0x17e)][_0x3fc6af(0x183)](0x20)[_0x3fc6af(0x21e)](_0x3fc6af(0x23b)),_0x293b4d=_0x3fc6af(0x276)+crypto_1[_0x3fc6af(0x17e)]['randomBytes'](0x20)['toString'](_0x3fc6af(0x23b)),_0x443461=_0x22104d?_0x22104d[_0x3fc6af(0x1ed)](_0x10c116=>this[_0x3fc6af(0x177)](_0x10c116)):null;_0x22104d&&_0x443461&&console[_0x3fc6af(0x23c)](_0x3fc6af(0x17f),_0x22104d,'->',_0x443461);const _0x3acaf5=await database_1[_0x3fc6af(0x17e)][_0x3fc6af(0x178)]['create']({'data':{'name':_0x2f295c,'username':_0x26b07d,'password':_0x5b6ac7,'telegram':_0x484ccd,'shopUrl':_0x127634,'paymentGateways':_0x443461?JSON[_0x3fc6af(0x27e)](_0x443461):null,'gatewaySettings':_0xbb394b?JSON[_0x3fc6af(0x27e)](_0xbb394b):null,'usdtPolygonWallet':_0x3d623b?.['usdtPolygonWallet']||null,'usdtTrcWallet':_0x3d623b?.[_0x3fc6af(0x211)]||null,'usdtErcWallet':_0x3d623b?.[_0x3fc6af(0x1e0)]||null,'usdcPolygonWallet':_0x3d623b?.[_0x3fc6af(0x1f0)]||null,'publicKey':_0x4c5f90,'secretKey':_0x293b4d,'status':_0x3fc6af(0x1b9)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x3acaf5['id'],'fullName':_0x3acaf5[_0x3fc6af(0x26b)],'username':_0x3acaf5[_0x3fc6af(0x188)],'telegramId':_0x3acaf5['telegram'],'merchantUrl':_0x3acaf5['shopUrl'],'gateways':_0x3acaf5[_0x3fc6af(0x18f)]?JSON[_0x3fc6af(0x18c)](_0x3acaf5['paymentGateways']):null,'gatewaySettings':_0x3acaf5[_0x3fc6af(0x239)]?JSON[_0x3fc6af(0x18c)](_0x3acaf5[_0x3fc6af(0x239)]):null,'publicKey':_0x3acaf5[_0x3fc6af(0x291)],'wallets':{'usdtPolygonWallet':_0x3acaf5[_0x3fc6af(0x21d)],'usdtTrcWallet':_0x3acaf5[_0x3fc6af(0x211)],'usdtErcWallet':_0x3acaf5[_0x3fc6af(0x1e0)],'usdcPolygonWallet':_0x3acaf5['usdcPolygonWallet']},'status':_0x3acaf5['status'],'createdAt':_0x3acaf5[_0x3fc6af(0x27f)]};}async[a35_0x55df78(0x264)](_0x77597b){const _0x5b4865=a35_0x55df78;await database_1[_0x5b4865(0x17e)]['shop'][_0x5b4865(0x1ab)]({'where':{'id':_0x77597b}});}['generateDailyStatistics'](_0x3c42ac,_0x55650a,_0x8c004){const _0x4894bf=a35_0x55df78,_0x4c9603=new Map(),_0x4b133d=new Date(_0x55650a);while(_0x4b133d<=_0x8c004){const _0x268ef7=_0x4b133d['toISOString']()['split']('T')[0x0];_0x4c9603['set'](_0x268ef7,{'revenue':0x0,'count':0x0}),_0x4b133d['setDate'](_0x4b133d['getDate']()+0x1);}for(const _0x164877 of _0x3c42ac){const _0x45aec1=_0x164877[_0x4894bf(0x27f)][_0x4894bf(0x26d)]()[_0x4894bf(0x241)]('T')[0x0],_0x51204b=_0x4c9603['get'](_0x45aec1);_0x51204b&&(_0x51204b[_0x4894bf(0x27d)]+=0x1,_0x164877[_0x4894bf(0x1b2)]===_0x4894bf(0x1ca)&&(_0x164877[_0x4894bf(0x210)]?_0x51204b['revenue']+=_0x164877['amountUSDT']:console[_0x4894bf(0x23c)]('⚠️\x20Payment\x20'+_0x164877['id']+'\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion')));}const _0x3cb7ec=[],_0x265281=[];for(const [_0x3523eb,_0x285e78]of _0x4c9603){_0x3cb7ec['push']({'date':_0x3523eb,'amount':Math[_0x4894bf(0x232)](_0x285e78['revenue']*0x64)/0x64}),_0x265281[_0x4894bf(0x1dc)]({'date':_0x3523eb,'count':_0x285e78[_0x4894bf(0x27d)]});}return{'dailyRevenue':_0x3cb7ec,'dailyPayments':_0x265281};}}exports['AdminService']=AdminService;