'use strict';const a53_0x1c3813=a53_0x3537;(function(_0x145a3d,_0x298888){const _0x30b6b6=a53_0x3537,_0x29c554=_0x145a3d();while(!![]){try{const _0x5a2a54=-parseInt(_0x30b6b6(0x22e))/0x1+parseInt(_0x30b6b6(0xfd))/0x2*(parseInt(_0x30b6b6(0x112))/0x3)+-parseInt(_0x30b6b6(0x263))/0x4*(-parseInt(_0x30b6b6(0x17c))/0x5)+parseInt(_0x30b6b6(0x18a))/0x6*(parseInt(_0x30b6b6(0x1e3))/0x7)+parseInt(_0x30b6b6(0x206))/0x8*(parseInt(_0x30b6b6(0x1f8))/0x9)+-parseInt(_0x30b6b6(0x233))/0xa+parseInt(_0x30b6b6(0x232))/0xb*(parseInt(_0x30b6b6(0x106))/0xc);if(_0x5a2a54===_0x298888)break;else _0x29c554['push'](_0x29c554['shift']());}catch(_0x5068d9){_0x29c554['push'](_0x29c554['shift']());}}}(a53_0xdddd,0x62b76));var __importDefault=this&&this['__importDefault']||function(_0x2af22d){const _0x1bbcc1=a53_0x3537;return _0x2af22d&&_0x2af22d[_0x1bbcc1(0x12e)]?_0x2af22d:{'default':_0x2af22d};};Object['defineProperty'](exports,a53_0x1c3813(0x12e),{'value':!![]}),exports[a53_0x1c3813(0x150)]=void 0x0;const database_1=__importDefault(require(a53_0x1c3813(0x2b6))),bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require('crypto')),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a53_0x1c3813(0x1c2))),speakeasy_1=__importDefault(require(a53_0x1c3813(0x1ed))),qrcode_1=__importDefault(require(a53_0x1c3813(0x158))),config_1=require(a53_0x1c3813(0x23f)),currencyService_1=require(a53_0x1c3813(0x1d8)),telegramBotService_1=require('./telegramBotService'),gateway_1=require(a53_0x1c3813(0x175));function a53_0xdddd(){const _0x312049=['length','totalAmount','_count','.env','\x20USDT\x20(theoretical\x20net)','twoFactorSecret','toString','USDT','amountAfterGatewayCommissionUSDT','revenue','warn','TrapaPay\x20Admin','Shop\x20not\x20found','ðŸ”„\x20Gateway\x20mapping\x20(get):','currency','getDate','admin','whiteUrl','lastLoginAt','ðŸŽ¯\x20[','filter','getSystemStatistics','activateUser','ðŸ“Š\x20Merchants\x20with\x20rounded\x20balance\x20!=\x200.00:\x20','thisMonth','Username\x20already\x20exists','reduce','Deposit','\x20\x20\x20Full\x20amount:\x20','Insufficient\x20balance\x20for\x20amount\x20increase.\x20Available:\x20','724328WDpBLM','USDC','\x20USDT\x20-\x20will\x20deduct\x20from\x20balance','AmPay','253RjDZLC','3123370lbYsZs','telegram','âœ…\x20Deposited\x20',',\x20chargebacks:\x20','custom','AmPay\x20TRY','\x20\x20\x20Total\x20paid\x20out:\x20','compare','SUSPENDED','getPayoutReports','\x20USDC\x20to\x20merchant\x20','today','../config/config','ðŸ”\x20Creating\x20payout\x20with\x20data:','getTime',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','ðŸ”\x20Selected\x20trc20\x20wallet:\x20','ðŸ’¸\x20CHARGEBACK\x20penalty\x20ONLY:\x20-','getAllPayments','\x20\x20\x20ðŸ¤”\x20Difference:\x20','cwd','ðŸ“Š\x20Getting\x20merchant\x20statistics\x20with\x20filters:','\x20\x20\x20ðŸ’¸\x20Total\x20payouts:\x20','this_month','usdtPolygonWallet','Error\x20processing\x20payment\x20','âœ…\x20Payout\x20created\x20in\x20DB:','totalPayments','ðŸ”\x20[','ðŸ’±\x20Currency\x20filter\x20applied:\x20','shopUrl','turnoverUSDT','\x20\x20\x20ðŸŒ\x20IP:\x20','commissionUSDT','getUTCMonth','\x20\x20\x20Final\x20payout\x20amount\x20used:\x20','getGatewayDisplayName','EXPIRED','ðŸ”§\x20[','toLocaleDateString','ÐÐµ\x20ÑƒÐºÐ°Ð·Ð°Ð½','gatewaySettings','dateFrom','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','delete','asc','merchantUrl','getUTCDate','1710508qFvKiB','\x20\x20\x20Shop\x20balance:\x20','statusChangedBy','month','\x20\x20\x20Tolerance:\x20','\x20->\x20','period','failUrl','utf8','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','updatedAt','OnRamp','setHours','ðŸ“Š\x20Available\x20gateways\x20in\x20database:','\x20USDT\x20(-','%\x20commission)','turnover','ðŸ“Š\x20Statistics\x20WHERE\x20conditions:','paidAt','\x20USDT\x20(already\x20paid\x20out)','toFixed','ðŸ”„\x20Gateway\x20mapping\x20(create):','rapyd','2FA\x20token\x20is\x20required','publicKey','updateCustomerData','amountAfterCommissionUSDT','dailyPayments','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','Telegram\x20username\x20already\x20exists','\x20\x20\x20ï¿½\x20Total\x20paid\x20out:\x20','floor','ðŸ’¸\x20CHARGEBACK:\x20Processing\x20penalty-only\x20deduction','ADMIN_BACKUP_CODES=','customerUa','createdAt','yesterday','\x20\x20\x20Amount\x20difference:\x20','\x20USDT\x20from\x20balance',']\x20Gateway\x20settings\x20JSON\x20string:','Invalid\x202FA\x20token\x20or\x20backup\x20code','\x20with\x20payout\x20history','KLYME\x20GB','COMPLETED','erc20_usdc','ðŸ”\x20Admin\x20password\x20changed\x20successfully','paidOutUSDT','\x20\x20\x20Current\x20amount:\x20','getMonth','paymentGateways','network','deleteUser','\x20\x20\x20ðŸ‘¤\x20Merchant\x20earnings:\x20','Payout\x20not\x20found','TrapaPay\x20Admin\x20(','gatewayEarnings','ðŸ“Š\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','parse','not\x20specified','Test\x20Gateway','usdtTrcWallet','otpauth_url','changeAdminPassword','\x20\x20\x20ï¿½ðŸ“Š\x20Total\x20payments:\x20','ðŸ”\x20Selected\x20erc20\x20wallet:\x20','totalTurnover','âœ…\x20Using\x20gateway\x20filter:\x20\x27','adminNotes','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','\x20\x20\x20Shop\x20totalPaidOut:\x20','ADMIN_2FA_ENABLED=','ðŸ”„\x20Converted\x20gateway\x20ID\x20\x27','\x20\x20\x20â³\x20Pending\x20payout:\x20','\x20USDT\x20(rounded\x20to\x202\x20decimal\x20places)','findFirst','username','\x20\x20\x20ï¿½\x20Total\x20payments\x20turnover:\x20','gatewayOrderId','ADMIN_2FA_ENABLED=false','\x27\x20to\x20name\x20\x27','Current\x20password\x20is\x20incorrect','min','generateDailyStatistics','../config/database','ðŸ“‹\x20Found\x20','ðŸ”\x20Admin\x202FA\x20enabled','TrapaPay\x20(','\x20\x20\x20ðŸ’°\x20Total\x20payments\x20turnover:\x20','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','ðŸ”\x20Selected\x20polygon_usdc\x20wallet:\x20','ðŸ’°\x20Payment\x20amount\x20is\x20NOT\x20deducted\x20(chargeback\x20penalty\x20only)','\x20\x20\x20Available\x20(raw):\x20','failureMessage','\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...','0000','telegramUsers','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion',',\x20refunds:\x20','âœ…\x20Payout\x20','\x20\x20\x20Current\x20network:\x20','getGatewayNameById','ðŸ“Š\x20Total\x20payments\x20(including\x20failed):\x20','getAllUsers','ðŸ“Š\x20Merchant\x20statistics\x20calculated:','findMany','ðŸ“Š\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','dailyRevenue','ðŸ”\x20Balance\x20check\x20details:','cointopay','setupAdmin2FA','10884ajVlcN','\x27\x20(from\x20\x27','balance','writeFileSync','CoinToPay','\x20merchants','2FA\x20is\x20already\x20enabled','createPayout','getFullYear','98292LtoAZu','Visa/MasterCard','PENDING','chargebackAmount','shop','availableBalance','insensitive','ðŸŽ¯\x20updateUser\x20called\x20with\x20ID:\x20','this_week','2FA\x20not\x20set\x20up.\x20Please\x20call\x20setup\x20endpoint\x20first','custom_','twoFactorEnabled','15OYPOaY','âœ…\x20Balance\x20check\x20passed\x20(with\x20tolerance)','ceil','CHARGEBACK','getMerchantsSelection','disable2FA','\x20status:\x20','setDate','includes','localeCompare',',\x20successful:\x20','\x20USDT','\x20\x20\x20Gateway:\x20','plisio','customerCountry','update','\x20\x20\x20ðŸ“…\x20Total\x20payouts\x20(this\x20month):\x20','CoinToPay2','values','\x20\x20\x20ðŸ’°\x20Total\x20turnover:\x20','\x20balance\x20updated:','ðŸ”\x20Shop\x20wallets:',']\x20Updating\x20password\x20for\x20user\x20','ðŸ“Š\x20Getting\x20payout\x20reports\x20with\x20filters:','fullName','totp','\x20USDT\x20(','ðŸ”\x20No\x20wallet\x20provided,\x20looking\x20up\x20from\x20shop\x20settings...','__esModule','shopId','not\x20set','ADMIN_2FA_ENABLED=true','\x20\x20\x20âœ…\x20Actual\x20available\x20balance:\x20','deletePayout','Invalid\x202FA\x20token','has','config','\x20\x20\x20ðŸ’³\x20Total\x20payments:\x20','SquirrelPay','abs','sk_','get2FASettings','Insufficient\x20balance.\x20Available:\x20','updateUser','ðŸ“…\x20Period:\x20','getUTCFullYear','ADMIN_2FA_SECRET=','createUser','ðŸ“Š\x20Calculated\x20commission\x20rate\x20for\x20payment\x20','merchantEarningsUSDT','Amer','ðŸ“…\x20Date\x20from\x20filter:\x20','ðŸ“…\x20Payout\x20date\x20to\x20filter:\x20','trim','hex','ðŸ“Š\x20Final\x20WHERE\x20conditions:','name','ðŸ’°\x20Updating\x20payout\x20','ðŸ“±\x20Telegram\x20notification\x20sent\x20for\x20payout\x20','verify','\x20merchants\x20with\x20rounded\x20balance\x20!=\x200.00\x20(excluding\x20balances\x20that\x20round\x20to\x200.00)','\x20to\x20','AdminService','setUTCDate','\x20USDT\x20(+','ðŸ“Š\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','awaitingPayout','log','last_week','payout','qrcode','ru-RU','\x20USDT\x20(after\x20','\x20in\x20','ðŸ”\x20Admin\x202FA\x20disabled','mastercard','\x20backup\x20codes','gatewayCommissionRate','randomBytes','ðŸ“…\x20Payout\x20date\x20from\x20filter:\x20','gateways','\x20PAID\x20payments','map','stringify','\x20\x20\x20ðŸª\x20Gateway\x20earnings:\x20','Sepa','ðŸ“Š\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20','usdcErcWallet','updatePayout','\x20paid\x20payments\x20for\x20gateway\x20','findUnique','commission','ðŸ”\x202FA\x20disabled\x20for\x20shop:\x20','TrapaPay','ðŸ“Š\x20Getting\x20payments\x20with\x20filters:','amountUSDT','toDataURL','wallets','\x20USDT,\x20Requested:\x20','../types/gateway','backupCodes','ðŸ”\x20Admin\x202FA\x20setup\x20initiated','REFUND','test_gateway','forEach','$transaction','5DfGzuY','ðŸ’°\x20Shop\x20','customerEmail','âŒ\x20Failed\x20to\x20send\x20Telegram\x20notification\x20for\x20payout\x20','suspendUser','ðŸ”„\x20Admin\x20updating\x20payment\x20','NONEXISTENT_GATEWAY_FILTER','telegramId','Payment\x20not\x20found','\x20\x20\x20ðŸ’µ\x20Available\x20balance:\x20','ðŸ“Š\x20Statistics\x20date\x20range:\x20','passwordHash','join','payment','33114QmoxSw','averageCheckUSDT','\x20\x20\x20New\x20amount:\x20','toLowerCase','convertToUSDT','disableAdmin2FA','existsSync','status','toISOString','customerIp','updatePaymentStatus','\x20\x20\x20ðŸ’¸\x20Total\x20payouts\x20(all\x20time):\x20','totalPayout','ðŸ’°\x20[PAYOUT]\x20Merchant\x20','\x20\x20\x20Transaction\x20hash:\x20','usdtErcWallet','ðŸ’³\x20Final\x20payout\x20wallet\x20for\x20','payouts','\x20\x20\x20Merchant\x20gets:\x20','\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)','\x20\x20\x20Balance:\x20','startsWith','_sum','\x20USDT,\x20merchant:\x20','txid','CRYPTO','klyme_eu','hash','%\x20from\x20','\x20USDT\x20(gross\x20revenue)','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','âš ï¸\x20Payment\x20','\x27\x20not\x20found.\x20Available\x20gateways:\x20','ðŸ’°\x20Found\x20','ðŸ“Š\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','enable2FA','totalAmountAfterCommissionUSDT','getUserById','paymentsCount','all','ðŸ“Š\x20Statistics\x20PAID\x20payments\x20count:\x20',',\x20Commission:\x20','generateBackupCodes','ðŸ“…\x20Date\x20to\x20filter:\x20','ðŸ”\x202FA\x20setup\x20initiated\x20for\x20shop:\x20','\x27\x20->\x20ID\x20\x27','split','entries','password','round','\x20\x20\x20ðŸ”\x20Calculated\x20after\x20commission:\x20','gte','ðŸ’°\x20Creating\x20payout\x20for\x20shop\x20','error','ðŸ”„\x20Gateway\x20mapping:',':\x20commission\x20=\x20','path','count','\x20\x20\x20Current\x20balance:\x20','\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)','ðŸ“‹\x20Getting\x20merchants\x20selection\x20list...','week','gateway','periodTo','klyme_gb','totalPaidOut','âš ï¸\x20Requested\x20gateway\x20\x27','\x20\x20\x20Added\x20to\x20balance:\x20+','\x20USDT\x20(same\x20as\x20awaiting)','ADMIN_PASSWORD_HASH=','periodFrom','merchantId','Interac','wallet','default','base32','customerName','Noda','./currencyService','desc','ðŸ”\x20Selected\x20erc20_usdc\x20wallet:\x20','PAID','aggregate','getGatewayInternalName','ðŸ”„\x20Converted\x20gateway\x20name\x20\x27',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','âœ…\x20Payout\x20created:\x20','erc20','UTC','777tHSzIK','set','polygon_usdc','date','pk_','readFileSync','sort','lte','totalCommissionRate','averageCommissionRate','speakeasy','amount','not\x20provided','\x20for\x20shop\x20','ðŸ“Š\x20Payout\x20statistics\x20calculated:','push','\x27\x20->\x20name\x20\x27','\x20became\x20PAID:','\x20merchants\x20for\x20selection',']\x20Gateway\x20settings\x20before\x20saving:','lastMonth','11736ZjjoXt','splice','\x20\x20\x20ðŸ–¥ï¸\x20User\x20Agent:\x20','usdcPolygonWallet','MasterCard','getMerchantStatistics','ðŸ’°\x20[PAYOUT]\x20Gateway\x20','ðŸ“Š\x20Using\x20saved\x20values\x20for\x20payment\x20','getUTCDay','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','ACTIVE','get','getAllPayouts','merchantEarnings','1136HkegeD','create','ðŸ”„\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','\x20\x20\x20Merchant\x20loses:\x20','\x20payments)','notes','merchantUsername','âš ï¸\x20CHARGEBACK\x20without\x20penalty\x20amount\x20-\x20no\x20balance\x20change','all_time','toUpperCase'];a53_0xdddd=function(){return _0x312049;};return a53_0xdddd();}function a53_0x3537(_0x1b7c99,_0x592192){_0x1b7c99=_0x1b7c99-0xeb;const _0xdddd3b=a53_0xdddd();let _0x35373a=_0xdddd3b[_0x1b7c99];return _0x35373a;}class AdminService{async['getPayoutStats'](){const _0x46ea65=a53_0x1c3813;console[_0x46ea65(0x155)]('ðŸ“Š\x20Calculating\x20payout\x20statistics...');const _0x390b15=await database_1[_0x46ea65(0x1d4)]['shop'][_0x46ea65(0x1dc)]({'_sum':{'balance':!![],'totalPaidOut':!![]}}),_0xc2a2b=await database_1[_0x46ea65(0x1d4)][_0x46ea65(0x189)][_0x46ea65(0x1c3)]({'where':{'status':'PAID','gateway':{'not':_0x46ea65(0x179)}}}),_0x22e8da=new Date(),_0x186ca0=new Date(_0x22e8da[_0x46ea65(0x105)](),_0x22e8da[_0x46ea65(0x293)](),0x1),_0x3466c2=new Date(_0x22e8da[_0x46ea65(0x105)](),_0x22e8da['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0xda906c=await database_1[_0x46ea65(0x1d4)]['payout'][_0x46ea65(0x1dc)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x186ca0,'lte':_0x3466c2},'status':_0x46ea65(0x28e)}}),_0x4bce26=_0x390b15[_0x46ea65(0x1a0)][_0x46ea65(0x1cb)]||0x0,_0x4e55a2=_0x390b15[_0x46ea65(0x1a0)]['balance']||0x0,_0x422b55=_0xda906c[_0x46ea65(0x1a0)]['amount']||0x0,_0x26134f={'totalPayout':Math[_0x46ea65(0x1bb)](_0x4bce26*0x64)/0x64,'awaitingPayout':Math[_0x46ea65(0x1bb)](_0x4e55a2*0x64)/0x64,'thisMonth':Math[_0x46ea65(0x1bb)](_0x422b55*0x64)/0x64,'availableBalance':Math['round'](_0x4e55a2*0x64)/0x64,'totalPayments':_0xc2a2b};return console[_0x46ea65(0x155)](_0x46ea65(0x1f1)),console[_0x46ea65(0x155)]('\x20\x20\x20ðŸ’°\x20Total\x20payout:\x20'+_0x26134f[_0x46ea65(0x196)]+'\x20USDT\x20(total\x20paid\x20to\x20merchants)'),console[_0x46ea65(0x155)]('\x20\x20\x20â³\x20Awaiting\x20payout:\x20'+_0x26134f[_0x46ea65(0x154)]+_0x46ea65(0x1c5)),console[_0x46ea65(0x155)](_0x46ea65(0x185)+_0x26134f[_0x46ea65(0x10b)]+_0x46ea65(0x1ce)),console[_0x46ea65(0x155)]('\x20\x20\x20ðŸ“…\x20This\x20month:\x20'+_0x26134f[_0x46ea65(0x228)]+'\x20USDT'),console['log'](_0x46ea65(0x137)+_0x26134f[_0x46ea65(0x24e)]+_0x46ea65(0x163)),_0x26134f;}async[a53_0x1c3813(0x27c)](_0x3e02e3,_0x15f642){const _0x254cac=a53_0x1c3813;console[_0x254cac(0x155)]('ðŸ”„\x20Updating\x20customer\x20data\x20for\x20payment\x20'+_0x3e02e3+':',_0x15f642);const _0x50d00a=await database_1[_0x254cac(0x1d4)][_0x254cac(0x189)][_0x254cac(0x16c)]({'where':{'id':_0x3e02e3},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x50d00a)throw new Error('Payment\x20not\x20found');const _0x4ffa02={};_0x15f642[_0x254cac(0x120)]!==undefined&&(_0x4ffa02[_0x254cac(0x120)]=_0x15f642['customerCountry']||null);_0x15f642[_0x254cac(0x193)]!==undefined&&(_0x4ffa02[_0x254cac(0x193)]=_0x15f642['customerIp']||null);_0x15f642[_0x254cac(0x285)]!==undefined&&(_0x4ffa02[_0x254cac(0x285)]=_0x15f642['customerUa']||null);const _0xf5ca0e=await database_1[_0x254cac(0x1d4)][_0x254cac(0x189)][_0x254cac(0x121)]({'where':{'id':_0x3e02e3},'data':{..._0x4ffa02,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console['log']('âœ…\x20Customer\x20data\x20updated\x20for\x20payment\x20'+_0x3e02e3),console[_0x254cac(0x155)]('\x20\x20\x20ðŸŒ\x20Country:\x20'+_0x50d00a[_0x254cac(0x120)]+'\x20->\x20'+_0xf5ca0e['customerCountry']),console['log'](_0x254cac(0x253)+_0x50d00a['customerIp']+_0x254cac(0x268)+_0xf5ca0e[_0x254cac(0x193)]),console[_0x254cac(0x155)](_0x254cac(0x1fa)+(_0x50d00a[_0x254cac(0x285)]?_0x254cac(0x1e4):'not\x20set')+_0x254cac(0x268)+(_0xf5ca0e[_0x254cac(0x285)]?_0x254cac(0x1e4):_0x254cac(0x130))),_0xf5ca0e;}async[a53_0x1c3813(0x225)](_0x53f08c,_0x2cc4b7){const _0xe0a006=a53_0x1c3813,_0x3c9c43=_0x2cc4b7?new Date(_0x2cc4b7):new Date();let _0x1f4f52,_0x2102e7;if(_0x53f08c[_0xe0a006(0x19f)](_0xe0a006(0x110))){const _0x472270=_0x53f08c['replace'](_0xe0a006(0x110),'')[_0xe0a006(0x1b8)]('_');if(_0x472270['length']===0x2){const _0x1f0089=new Date(_0x472270[0x0]),_0x52c16b=new Date(_0x472270[0x1]);_0x1f4f52=new Date(Date[_0xe0a006(0x1e2)](_0x1f0089[_0xe0a006(0x13f)](),_0x1f0089[_0xe0a006(0x255)](),_0x1f0089[_0xe0a006(0x262)](),0x0,0x0,0x0,0x0)),_0x2102e7=new Date(Date[_0xe0a006(0x1e2)](_0x52c16b[_0xe0a006(0x13f)](),_0x52c16b[_0xe0a006(0x255)](),_0x52c16b[_0xe0a006(0x262)](),0x17,0x3b,0x3b,0x3e7));}else{const _0x556150=new Date(Date[_0xe0a006(0x1e2)](_0x3c9c43[_0xe0a006(0x13f)](),_0x3c9c43[_0xe0a006(0x255)](),_0x3c9c43[_0xe0a006(0x262)]()-0x1e));_0x1f4f52=new Date(Date[_0xe0a006(0x1e2)](_0x556150[_0xe0a006(0x13f)](),_0x556150[_0xe0a006(0x255)](),_0x556150[_0xe0a006(0x262)](),0x0,0x0,0x0,0x0)),_0x2102e7=new Date(Date[_0xe0a006(0x1e2)](_0x3c9c43['getUTCFullYear'](),_0x3c9c43['getUTCMonth'](),_0x3c9c43[_0xe0a006(0x262)](),0x17,0x3b,0x3b,0x3e7));}}else{switch(_0x53f08c[_0xe0a006(0x18d)]()){case _0xe0a006(0x23e):_0x1f4f52=new Date(Date[_0xe0a006(0x1e2)](_0x3c9c43['getUTCFullYear'](),_0x3c9c43[_0xe0a006(0x255)](),_0x3c9c43['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x2102e7=new Date(Date['UTC'](_0x3c9c43[_0xe0a006(0x13f)](),_0x3c9c43[_0xe0a006(0x255)](),_0x3c9c43['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case _0xe0a006(0x287):const _0x288bc4=new Date(_0x3c9c43);_0x288bc4[_0xe0a006(0x151)](_0x288bc4[_0xe0a006(0x262)]()-0x1),_0x1f4f52=new Date(Date[_0xe0a006(0x1e2)](_0x288bc4[_0xe0a006(0x13f)](),_0x288bc4['getUTCMonth'](),_0x288bc4[_0xe0a006(0x262)](),0x0,0x0,0x0,0x0)),_0x2102e7=new Date(Date['UTC'](_0x288bc4['getUTCFullYear'](),_0x288bc4[_0xe0a006(0x255)](),_0x288bc4[_0xe0a006(0x262)](),0x17,0x3b,0x3b,0x3e7));break;case _0xe0a006(0x10e):const _0xd39569=_0x3c9c43[_0xe0a006(0x200)](),_0x1fff3d=_0xd39569===0x0?-0x6:0x1-_0xd39569,_0x1413ed=_0x3c9c43[_0xe0a006(0x262)]()+_0x1fff3d;_0x1f4f52=new Date(Date[_0xe0a006(0x1e2)](_0x3c9c43['getUTCFullYear'](),_0x3c9c43[_0xe0a006(0x255)](),_0x1413ed,0x0,0x0,0x0,0x0)),_0x2102e7=new Date(Date['UTC'](_0x3c9c43[_0xe0a006(0x13f)](),_0x3c9c43[_0xe0a006(0x255)](),_0x3c9c43[_0xe0a006(0x262)](),0x17,0x3b,0x3b,0x3e7));break;case _0xe0a006(0x156):const _0x543580=new Date(Date[_0xe0a006(0x1e2)](_0x3c9c43[_0xe0a006(0x13f)](),_0x3c9c43[_0xe0a006(0x255)](),_0x3c9c43[_0xe0a006(0x262)]()-0x7)),_0x340a02=_0x543580['getUTCDay'](),_0x28f145=_0x340a02===0x0?-0x6:0x1-_0x340a02,_0x19d699=_0x543580['getUTCDate']()+_0x28f145;_0x1f4f52=new Date(Date[_0xe0a006(0x1e2)](_0x543580[_0xe0a006(0x13f)](),_0x543580[_0xe0a006(0x255)](),_0x19d699,0x0,0x0,0x0,0x0)),_0x2102e7=new Date(Date[_0xe0a006(0x1e2)](_0x543580[_0xe0a006(0x13f)](),_0x543580[_0xe0a006(0x255)](),_0x19d699+0x6,0x17,0x3b,0x3b,0x3e7));break;case _0xe0a006(0x24a):_0x1f4f52=new Date(Date['UTC'](_0x3c9c43[_0xe0a006(0x13f)](),_0x3c9c43['getUTCMonth'](),0x1,0x0,0x0,0x0,0x0)),_0x2102e7=new Date(Date[_0xe0a006(0x1e2)](_0x3c9c43[_0xe0a006(0x13f)](),_0x3c9c43['getUTCMonth'](),_0x3c9c43[_0xe0a006(0x262)](),0x17,0x3b,0x3b,0x3e7));break;case'last_month':_0x1f4f52=new Date(Date[_0xe0a006(0x1e2)](_0x3c9c43['getUTCFullYear'](),_0x3c9c43[_0xe0a006(0x255)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x2102e7=new Date(Date[_0xe0a006(0x1e2)](_0x3c9c43[_0xe0a006(0x13f)](),_0x3c9c43[_0xe0a006(0x255)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case _0xe0a006(0x20e):_0x1f4f52=new Date(Date['UTC'](0x7e9,0x5,0xe,0x0,0x0,0x0,0x0)),_0x2102e7=new Date(Date[_0xe0a006(0x1e2)](_0x3c9c43[_0xe0a006(0x13f)](),_0x3c9c43['getUTCMonth'](),_0x3c9c43['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;default:_0x1f4f52=new Date(_0x3c9c43[_0xe0a006(0x241)]()-0x1e*0x18*0x3c*0x3c*0x3e8);const _0x347858=new Date(Date[_0xe0a006(0x1e2)](_0x3c9c43[_0xe0a006(0x13f)](),_0x3c9c43['getUTCMonth'](),_0x3c9c43[_0xe0a006(0x262)]()-0x1e));_0x1f4f52=new Date(Date[_0xe0a006(0x1e2)](_0x347858[_0xe0a006(0x13f)](),_0x347858[_0xe0a006(0x255)](),_0x347858['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x2102e7=new Date(Date[_0xe0a006(0x1e2)](_0x3c9c43['getUTCFullYear'](),_0x3c9c43[_0xe0a006(0x255)](),_0x3c9c43[_0xe0a006(0x262)](),0x17,0x3b,0x3b,0x3e7));}const _0x547e84={'gte':_0x1f4f52,'lte':_0x2102e7};console['log'](_0xe0a006(0x186)+_0x1f4f52[_0xe0a006(0x192)]()+_0xe0a006(0x14f)+_0x2102e7[_0xe0a006(0x192)]());const [_0x182e77,_0x4ba452,_0xeaee81,_0xf14a8f,_0x5ac871,_0x1e507d,_0x5dfc35,_0x530831,_0x142bc4]=await Promise[_0xe0a006(0x1b1)]([database_1[_0xe0a006(0x1d4)][_0xe0a006(0x10a)]['count'](),database_1[_0xe0a006(0x1d4)][_0xe0a006(0x10a)][_0xe0a006(0x1c3)]({'where':{'status':'ACTIVE'}}),database_1[_0xe0a006(0x1d4)][_0xe0a006(0x189)]['count']({'where':{'status':_0xe0a006(0x1db),'createdAt':_0x547e84,'gateway':{'not':_0xe0a006(0x179)}}}),database_1[_0xe0a006(0x1d4)][_0xe0a006(0x189)]['count']({'where':{'status':_0xe0a006(0x115),'createdAt':_0x547e84,'gateway':{'not':_0xe0a006(0x179)}}}),database_1[_0xe0a006(0x1d4)][_0xe0a006(0x189)]['count']({'where':{'status':_0xe0a006(0x178),'createdAt':_0x547e84,'gateway':{'not':_0xe0a006(0x179)}}}),database_1[_0xe0a006(0x1d4)][_0xe0a006(0x189)][_0xe0a006(0xf7)]({'where':{'status':_0xe0a006(0x1db),'createdAt':_0x547e84,'gateway':{'not':_0xe0a006(0x179)}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0xe0a006(0x1d4)][_0xe0a006(0x189)]['findMany']({'where':{'gateway':{'not':_0xe0a006(0x179)}},'take':0xa,'orderBy':{'createdAt':_0xe0a006(0x1d9)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0xe0a006(0x1d4)][_0xe0a006(0x189)][_0xe0a006(0xf7)]({'where':{'createdAt':_0x547e84,'gateway':{'not':_0xe0a006(0x179)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0xe0a006(0x1d4)][_0xe0a006(0x189)][_0xe0a006(0xf7)]({'where':{'status':_0xe0a006(0x1db),'gateway':{'not':'test_gateway'}},'select':{'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![]}})]);console[_0xe0a006(0x155)](_0xe0a006(0x1b2)+_0xeaee81);let _0x44dd93=0x0,_0x135f3b=0x0;for(const _0x38ca77 of _0x1e507d){const _0x43d4d9=_0x38ca77[_0xe0a006(0x171)]||0x0;_0x44dd93+=_0x43d4d9;if(_0x38ca77[_0xe0a006(0x218)]&&_0x38ca77['amountUSDT']){const _0x1686ca=_0x38ca77[_0xe0a006(0x171)]-_0x38ca77[_0xe0a006(0x218)];_0x135f3b+=_0x1686ca;}}let _0x39af93=0x0;for(const _0x312a1d of _0x142bc4){if(_0x312a1d[_0xe0a006(0x218)]&&_0x312a1d[_0xe0a006(0x171)]){const _0x255c0f=_0x312a1d[_0xe0a006(0x171)]-_0x312a1d[_0xe0a006(0x218)];_0x39af93+=_0x255c0f;}}const _0x2f0ef7=_0xeaee81>0x0?_0x44dd93/_0xeaee81:0x0,_0x138c9c=this[_0xe0a006(0x2b5)](_0x530831,_0x1f4f52,_0x2102e7),_0x2f3e18=await database_1[_0xe0a006(0x1d4)][_0xe0a006(0x189)][_0xe0a006(0x1c3)]({'where':{'createdAt':_0x547e84,'gateway':{'not':'test_gateway'},'status':{'notIn':[_0xe0a006(0x108),_0xe0a006(0x258)]}}}),_0x412b04=_0x2f3e18>0x0?_0xeaee81/_0x2f3e18*0x64:0x0;return{'totalShops':_0x182e77,'activeShops':_0x4ba452,'totalPayments':_0x2f3e18,'successfulPayments':_0xeaee81,'totalAttempts':_0x2f3e18,'chargebacks':_0xf14a8f,'refunds':_0x5ac871,'totalRevenue':Math[_0xe0a006(0x1bb)](_0x44dd93*0x64)/0x64,'trapayEarnings':Math[_0xe0a006(0x1bb)](_0x135f3b*0x64)/0x64,'trapayEarningsAllTime':Math[_0xe0a006(0x1bb)](_0x39af93*0x64)/0x64,'averagePaymentAmount':Math[_0xe0a006(0x1bb)](_0x2f0ef7*0x64)/0x64,'conversionRate':Math[_0xe0a006(0x1bb)](_0x412b04*0x64)/0x64,'dailyRevenue':_0x138c9c[_0xe0a006(0xf9)],'dailyPayments':_0x138c9c[_0xe0a006(0x27e)],'recentPayments':_0x5dfc35['map'](_0x41615f=>({'id':_0x41615f['id'],'amount':_0x41615f[_0xe0a006(0x1ee)],'currency':_0x41615f[_0xe0a006(0x21e)],'status':_0x41615f['status'],'gateway':_0x41615f[_0xe0a006(0x1c8)],'shop':_0x41615f['shop'],'createdAt':_0x41615f[_0xe0a006(0x286)]}))};}}async[a53_0x1c3813(0x1fd)](_0xdc23e1){const _0x17da66=a53_0x1c3813;console[_0x17da66(0x155)](_0x17da66(0x248),_0xdc23e1);let _0x18d4a4,_0x38f641=new Date();if(_0xdc23e1['period']===_0x17da66(0x237)&&_0xdc23e1[_0x17da66(0x25d)]&&_0xdc23e1['dateTo']){const _0x573c0e=new Date(_0xdc23e1['dateFrom']),_0x5ebdf6=new Date(_0xdc23e1['dateTo']);_0x18d4a4=new Date(Date[_0x17da66(0x1e2)](_0x573c0e[_0x17da66(0x13f)](),_0x573c0e[_0x17da66(0x255)](),_0x573c0e[_0x17da66(0x262)](),0x0,0x0,0x0,0x0)),_0x38f641=new Date(Date[_0x17da66(0x1e2)](_0x5ebdf6[_0x17da66(0x13f)](),_0x5ebdf6[_0x17da66(0x255)](),_0x5ebdf6[_0x17da66(0x262)](),0x17,0x3b,0x3b,0x3e7));}else{const _0x160ecd=new Date();switch(_0xdc23e1[_0x17da66(0x269)]){case _0x17da66(0x1c7):_0x18d4a4=new Date(_0x160ecd['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8),_0x18d4a4[_0x17da66(0x26f)](0x0,0x0,0x0,0x0),_0x38f641['setHours'](0x17,0x3b,0x3b,0x3e7);break;case _0x17da66(0x266):_0x18d4a4=new Date(Date[_0x17da66(0x1e2)](_0x160ecd['getUTCFullYear'](),_0x160ecd['getUTCMonth'](),0x1,0x0,0x0,0x0,0x0)),_0x38f641=new Date(Date[_0x17da66(0x1e2)](_0x160ecd['getUTCFullYear'](),_0x160ecd[_0x17da66(0x255)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x17da66(0x1f7):_0x18d4a4=new Date(Date[_0x17da66(0x1e2)](_0x160ecd[_0x17da66(0x13f)](),_0x160ecd[_0x17da66(0x255)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x38f641=new Date(Date['UTC'](_0x160ecd[_0x17da66(0x13f)](),_0x160ecd[_0x17da66(0x255)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case'year':_0x18d4a4=new Date(_0x160ecd[_0x17da66(0x241)]()-0x16d*0x18*0x3c*0x3c*0x3e8),_0x18d4a4[_0x17da66(0x26f)](0x0,0x0,0x0,0x0),_0x38f641['setHours'](0x17,0x3b,0x3b,0x3e7);break;case _0x17da66(0x1b1):default:_0x18d4a4=new Date('2020-01-01'),_0x18d4a4[_0x17da66(0x26f)](0x0,0x0,0x0,0x0),_0x38f641[_0x17da66(0x26f)](0x17,0x3b,0x3b,0x3e7);break;}}console['log'](_0x17da66(0x13e)+_0x18d4a4['toISOString']()+_0x17da66(0x14f)+_0x38f641[_0x17da66(0x192)]());const _0x4bbfb2={'status':_0x17da66(0x1db),'gateway':{'not':_0x17da66(0x179)},'createdAt':{'gte':_0x18d4a4,'lte':_0x38f641}};_0xdc23e1[_0x17da66(0x12f)]&&(_0x4bbfb2[_0x17da66(0x12f)]=_0xdc23e1[_0x17da66(0x12f)]);const _0x37e3a0=await database_1[_0x17da66(0x1d4)][_0x17da66(0x189)][_0x17da66(0xf7)]({'where':_0x4bbfb2,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x17da66(0x155)](_0x17da66(0x1ab)+_0x37e3a0[_0x17da66(0x210)]+'\x20paid\x20payments\x20for\x20analysis');const _0x23618c={'gateway':{'not':_0x17da66(0x179)},'status':{'notIn':[_0x17da66(0x108),_0x17da66(0x258)]},'createdAt':{'gte':_0x18d4a4,'lte':_0x38f641}};_0xdc23e1[_0x17da66(0x12f)]&&(_0x23618c[_0x17da66(0x12f)]=_0xdc23e1[_0x17da66(0x12f)]);const _0x457d89=await database_1[_0x17da66(0x1d4)][_0x17da66(0x189)][_0x17da66(0x1c3)]({'where':_0x23618c}),_0x5da527={..._0x23618c,'status':_0x17da66(0x115)},_0x114ba3={..._0x23618c,'status':'REFUND'},[_0x366fea,_0x3a87ad]=await Promise[_0x17da66(0x1b1)]([database_1[_0x17da66(0x1d4)][_0x17da66(0x189)][_0x17da66(0x1c3)]({'where':_0x5da527}),database_1['default'][_0x17da66(0x189)]['count']({'where':_0x114ba3})]);console[_0x17da66(0x155)](_0x17da66(0xf4)+_0x457d89+_0x17da66(0x11c)+_0x37e3a0[_0x17da66(0x210)]+_0x17da66(0x236)+_0x366fea+_0x17da66(0xf0)+_0x3a87ad);let _0x46d7bb=0x0,_0x38e898=0x0,_0x20a7dc=0x0;const _0x292a23={},_0x5e9816={},_0x3712cc={},_0x486751=new Date(_0x18d4a4);while(_0x486751<=_0x38f641){const _0xf6da88=_0x486751[_0x17da66(0x192)]()[_0x17da66(0x1b8)]('T')[0x0];_0x3712cc[_0xf6da88]={'date':_0xf6da88,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0},_0x486751[_0x17da66(0x151)](_0x486751[_0x17da66(0x262)]()+0x1);}for(const _0x537f7c of _0x37e3a0){try{const _0x136057=_0x537f7c['amountUSDT']||0x0;if(_0x136057<=0x0){console[_0x17da66(0x21a)](_0x17da66(0x1a9)+_0x537f7c['id']+_0x17da66(0xec));continue;}let _0x136e0d,_0x5c3fba;if(_0x537f7c[_0x17da66(0x218)]!==null&&_0x537f7c[_0x17da66(0x218)]!==undefined)_0x136e0d=_0x537f7c[_0x17da66(0x218)],_0x5c3fba=_0x136057-_0x136e0d,console[_0x17da66(0x155)](_0x17da66(0x1ff)+_0x537f7c['id']+':\x20'+_0x136057[_0x17da66(0x277)](0x6)+_0x17da66(0x1a1)+_0x136e0d[_0x17da66(0x277)](0x6)+_0x17da66(0x11d));else{let _0x5acf4b={};if(_0x537f7c['shop'][_0x17da66(0x25c)])try{_0x5acf4b=JSON[_0x17da66(0x29c)](_0x537f7c[_0x17da66(0x10a)][_0x17da66(0x25c)]);}catch(_0x98bb82){console[_0x17da66(0x1bf)]('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x537f7c[_0x17da66(0x12f)]+':',_0x98bb82);}let _0x40b6a8=0x2d;for(const [_0x3624f8,_0x3a0abb]of Object[_0x17da66(0x1b9)](_0x5acf4b)){if(_0x3624f8['toLowerCase']()===_0x537f7c[_0x17da66(0x1c8)][_0x17da66(0x18d)]()){_0x40b6a8=_0x3a0abb[_0x17da66(0x16d)]||0x2d;break;}}_0x5c3fba=_0x136057*(_0x40b6a8/0x64),_0x136e0d=_0x136057-_0x5c3fba,console['log'](_0x17da66(0x153)+_0x537f7c['id']+':\x20'+_0x40b6a8+_0x17da66(0x1a6)+_0x136057['toFixed'](0x6)+_0x17da66(0x11d));}_0x46d7bb+=_0x136057,_0x38e898+=_0x136e0d,_0x20a7dc+=_0x5c3fba;let _0x26dab8;_0x537f7c[_0x17da66(0x15f)]!==null&&_0x537f7c[_0x17da66(0x15f)]!==undefined?(_0x26dab8=_0x537f7c[_0x17da66(0x15f)],console[_0x17da66(0x155)](_0x17da66(0x168)+_0x537f7c['id']+':\x20'+_0x26dab8+'%')):(_0x26dab8=_0x136057>0x0?_0x5c3fba/_0x136057*0x64:0x0,console[_0x17da66(0x155)](_0x17da66(0x142)+_0x537f7c['id']+':\x20'+_0x26dab8[_0x17da66(0x277)](0x2)+'%'));!_0x292a23[_0x537f7c[_0x17da66(0x1c8)]]&&(_0x292a23[_0x537f7c[_0x17da66(0x1c8)]]={'gateway':_0x537f7c[_0x17da66(0x1c8)],'gatewayDisplayName':this[_0x17da66(0x257)](_0x537f7c[_0x17da66(0x1c8)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x292a23[_0x537f7c[_0x17da66(0x1c8)]][_0x17da66(0x1b0)]++,_0x292a23[_0x537f7c[_0x17da66(0x1c8)]][_0x17da66(0x252)]+=_0x136057,_0x292a23[_0x537f7c['gateway']][_0x17da66(0x254)]+=_0x5c3fba,_0x292a23[_0x537f7c['gateway']][_0x17da66(0x143)]+=_0x136e0d,_0x292a23[_0x537f7c['gateway']][_0x17da66(0x1eb)]+=_0x26dab8;!_0xdc23e1[_0x17da66(0x12f)]&&(!_0x5e9816[_0x537f7c['shopId']]&&(_0x5e9816[_0x537f7c[_0x17da66(0x12f)]]={'shopId':_0x537f7c[_0x17da66(0x12f)],'shopName':_0x537f7c['shop']['name'],'shopUsername':_0x537f7c[_0x17da66(0x10a)]['username'],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x5e9816[_0x537f7c[_0x17da66(0x12f)]][_0x17da66(0x1b0)]++,_0x5e9816[_0x537f7c[_0x17da66(0x12f)]]['turnoverUSDT']+=_0x136057,_0x5e9816[_0x537f7c[_0x17da66(0x12f)]][_0x17da66(0x254)]+=_0x5c3fba,_0x5e9816[_0x537f7c[_0x17da66(0x12f)]][_0x17da66(0x143)]+=_0x136e0d);const _0x5f15a8=_0x537f7c[_0x17da66(0x275)]['toISOString']()['split']('T')[0x0];_0x3712cc[_0x5f15a8]&&(_0x3712cc[_0x5f15a8][_0x17da66(0x273)]+=_0x136057,_0x3712cc[_0x5f15a8][_0x17da66(0x205)]+=_0x136e0d,_0x3712cc[_0x5f15a8]['gatewayEarnings']+=_0x5c3fba,_0x3712cc[_0x5f15a8][_0x17da66(0x1b0)]++);}catch(_0x3ee5e4){console[_0x17da66(0x1bf)](_0x17da66(0x24c)+_0x537f7c['id']+':',_0x3ee5e4);}}Object[_0x17da66(0x124)](_0x292a23)[_0x17da66(0x17a)](_0x4ca525=>{const _0x295d8f=_0x17da66;_0x4ca525[_0x295d8f(0x1ec)]=_0x4ca525[_0x295d8f(0x1b0)]>0x0?_0x4ca525[_0x295d8f(0x1eb)]/_0x4ca525[_0x295d8f(0x1b0)]:0x0,delete _0x4ca525[_0x295d8f(0x1eb)];}),Object[_0x17da66(0x124)](_0x5e9816)[_0x17da66(0x17a)](_0x573044=>{const _0x9a69b7=_0x17da66;_0x573044[_0x9a69b7(0x18b)]=_0x573044['paymentsCount']>0x0?_0x573044[_0x9a69b7(0x252)]/_0x573044[_0x9a69b7(0x1b0)]:0x0;});let _0x20e683=0x0,_0x32626d=0x0;if(_0xdc23e1[_0x17da66(0x12f)]){const _0x23c455=await database_1[_0x17da66(0x1d4)][_0x17da66(0x157)][_0x17da66(0xf7)]({'where':{'shopId':_0xdc23e1[_0x17da66(0x12f)],'status':_0x17da66(0x28e),'createdAt':{'gte':_0x18d4a4,'lte':_0x38f641}},'select':{'amount':!![]}});_0x20e683=_0x23c455[_0x17da66(0x22a)]((_0x752037,_0x154811)=>_0x752037+_0x154811[_0x17da66(0x1ee)],0x0);const _0x420ad9=await database_1[_0x17da66(0x1d4)][_0x17da66(0x157)]['findMany']({'where':{'shopId':_0xdc23e1['shopId'],'status':_0x17da66(0x108),'createdAt':{'gte':_0x18d4a4,'lte':_0x38f641}},'select':{'amount':!![]}});_0x32626d=_0x420ad9[_0x17da66(0x22a)]((_0x525aec,_0x33c24f)=>_0x525aec+_0x33c24f[_0x17da66(0x1ee)],0x0);}const _0x3c68d0=_0x457d89,_0x7880d9=_0x37e3a0['length'],_0x493722=_0x7880d9>0x0?_0x46d7bb/_0x7880d9:0x0,_0x4de699=_0x3c68d0>0x0?Math[_0x17da66(0x1bb)](_0x7880d9/_0x3c68d0*0x2710)/0x64:0x0,_0x4131e5=Math['ceil']((_0x38f641['getTime']()-_0x18d4a4['getTime']())/(0x3e8*0x3c*0x3c*0x18)),_0x10f7f1={'totalTurnover':Math['round'](_0x46d7bb*0x64)/0x64,'merchantEarnings':Math[_0x17da66(0x1bb)](_0x38e898*0x64)/0x64,'gatewayEarnings':Math[_0x17da66(0x1bb)](_0x20a7dc*0x64)/0x64,'totalPaidOut':Math['round'](_0x20e683*0x64)/0x64,'pendingPayout':Math[_0x17da66(0x1bb)](_0x32626d*0x64)/0x64,'averageCheck':Math['round'](_0x493722*0x64)/0x64,'totalPayments':_0x3c68d0,'successfulPayments':_0x7880d9,'conversionRate':_0x4de699,'chargebacks':_0x366fea,'refunds':_0x3a87ad,'gatewayBreakdown':Object[_0x17da66(0x124)](_0x292a23)[_0x17da66(0x164)](_0x1bbb56=>({..._0x1bbb56,'turnoverUSDT':Math[_0x17da66(0x1bb)](_0x1bbb56[_0x17da66(0x252)]*0x64)/0x64,'commissionUSDT':Math[_0x17da66(0x1bb)](_0x1bbb56['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x17da66(0x1bb)](_0x1bbb56['merchantEarningsUSDT']*0x64)/0x64,'averageCommissionRate':Math['round'](_0x1bbb56['averageCommissionRate']*0x64)/0x64})),'merchantBreakdown':_0xdc23e1[_0x17da66(0x12f)]?undefined:Object[_0x17da66(0x124)](_0x5e9816)['map'](_0x54d16c=>({..._0x54d16c,'turnoverUSDT':Math[_0x17da66(0x1bb)](_0x54d16c[_0x17da66(0x252)]*0x64)/0x64,'commissionUSDT':Math[_0x17da66(0x1bb)](_0x54d16c[_0x17da66(0x254)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x17da66(0x1bb)](_0x54d16c[_0x17da66(0x143)]*0x64)/0x64,'paidOutUSDT':Math['round'](_0x54d16c[_0x17da66(0x291)]*0x64)/0x64,'averageCheckUSDT':Math[_0x17da66(0x1bb)](_0x54d16c[_0x17da66(0x18b)]*0x64)/0x64})),'dailyData':Object['values'](_0x3712cc)[_0x17da66(0x164)](_0x5d0d30=>({..._0x5d0d30,'turnover':Math['round'](_0x5d0d30[_0x17da66(0x273)]*0x64)/0x64,'merchantEarnings':Math[_0x17da66(0x1bb)](_0x5d0d30[_0x17da66(0x205)]*0x64)/0x64,'gatewayEarnings':Math[_0x17da66(0x1bb)](_0x5d0d30[_0x17da66(0x29a)]*0x64)/0x64}))[_0x17da66(0x1e9)]((_0x2ff57f,_0x5d9a3e)=>_0x2ff57f[_0x17da66(0x1e6)][_0x17da66(0x11b)](_0x5d9a3e[_0x17da66(0x1e6)])),'periodInfo':{'from':_0x18d4a4,'to':_0x38f641,'periodType':_0xdc23e1['period']||_0x17da66(0x237),'daysCount':_0x4131e5}};return console[_0x17da66(0x155)](_0x17da66(0xf6)),console[_0x17da66(0x155)](_0x17da66(0x125)+_0x10f7f1[_0x17da66(0x2a4)]+'\x20USDT'),console['log'](_0x17da66(0x297)+_0x10f7f1['merchantEarnings']+_0x17da66(0x11d)),console[_0x17da66(0x155)](_0x17da66(0x166)+_0x10f7f1['gatewayEarnings']+_0x17da66(0x11d)),console[_0x17da66(0x155)](_0x17da66(0x281)+_0x10f7f1['totalPaidOut']+_0x17da66(0x11d)),console[_0x17da66(0x155)](_0x17da66(0x2ab)+_0x10f7f1['pendingPayout']+_0x17da66(0x11d)),console[_0x17da66(0x155)](_0x17da66(0x2a2)+_0x10f7f1['totalPayments']),_0x10f7f1;}async[a53_0x1c3813(0x116)](_0x41e6e9){const _0x40a399=a53_0x1c3813;console[_0x40a399(0x155)](_0x40a399(0x1c6),{'hasPayoutHistory':_0x41e6e9});let _0x54a95d={};_0x41e6e9&&(_0x54a95d[_0x40a399(0x19b)]={'some':{}});const _0x440cd4=await database_1[_0x40a399(0x1d4)][_0x40a399(0x10a)][_0x40a399(0xf7)]({'where':_0x54a95d,'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':'asc'}});return console['log'](_0x40a399(0x2b7)+_0x440cd4[_0x40a399(0x210)]+_0x40a399(0x1f5)+(_0x41e6e9?_0x40a399(0x28c):'')),_0x440cd4[_0x40a399(0x164)](_0x2c75f9=>({'id':_0x2c75f9['id'],'username':_0x2c75f9['username'],'name':_0x2c75f9[_0x40a399(0x14a)]}));}['getGatewayDisplayName'](_0x3e4e04){const _0x4e12bc=a53_0x1c3813,_0x1f07eb={'test_gateway':_0x4e12bc(0x29e),'plisio':'Plisio','rapyd':'Rapyd','noda':_0x4e12bc(0x1d7),'cointopay':_0x4e12bc(0x101),'cointopay2':_0x4e12bc(0x123),'klyme_eu':'KLYME\x20EU','klyme_gb':_0x4e12bc(0x28d),'klyme_de':'KLYME\x20DE','mastercard':_0x4e12bc(0x1fc),'visa/mastercard':_0x4e12bc(0x107),'amer':_0x4e12bc(0x144),'myxspend':'MyXSpend','ampay':_0x4e12bc(0x231),'ampay_try':_0x4e12bc(0x238),'sepa':_0x4e12bc(0x167),'interac':_0x4e12bc(0x1d2),'onramp':_0x4e12bc(0x26e),'squirrelpay':_0x4e12bc(0x138),'maxpara':'MaxPara','instaxchange':'InstaXchange','oxapay':'OxaPay'};return _0x1f07eb[_0x3e4e04]||_0x3e4e04;}[a53_0x1c3813(0x1dd)](_0x478ad5){const _0x39f1a6=a53_0x1c3813,_0x150346={'Test\x20Gateway':_0x39f1a6(0x179),'Plisio':_0x39f1a6(0x11f),'Rapyd':_0x39f1a6(0x279),'Noda':'noda','CoinToPay':_0x39f1a6(0xfb),'CoinToPay2':'cointopay2','KLYME\x20EU':_0x39f1a6(0x1a4),'KLYME\x20GB':_0x39f1a6(0x1ca),'KLYME\x20DE':'klyme_de','MasterCard':_0x39f1a6(0x15d)};return _0x150346[_0x478ad5]||_0x478ad5[_0x39f1a6(0x18d)]();}async['getMerchantsAwaitingPayout'](_0x21affd){const _0x4a013d=a53_0x1c3813,{page:_0x3cd17d,limit:_0xbcb027,minAmount:_0x37d117,search:_0x3fcd86}=_0x21affd;console[_0x4a013d(0x155)](_0x4a013d(0xf8),_0x21affd);let _0x107947={};_0x3fcd86&&(_0x107947[_0x4a013d(0x14a)]={'contains':_0x3fcd86,'mode':'insensitive'});const _0x503735=await database_1['default'][_0x4a013d(0x10a)][_0x4a013d(0xf7)]({'where':_0x107947,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),_0x4e2e31=_0x503735[_0x4a013d(0x224)](_0x40e60e=>{const _0x874393=_0x4a013d,_0x3b6a07=Math[_0x874393(0x282)](_0x40e60e[_0x874393(0xff)]*0x64)/0x64;if(_0x37d117&&_0x3b6a07<_0x37d117)return![];return _0x3b6a07!==0x0;});_0x4e2e31['sort']((_0x24caee,_0x10e691)=>_0x10e691[_0x4a013d(0xff)]-_0x24caee['balance']);const _0x4232ee=_0x4e2e31[_0x4a013d(0x210)],_0x41bc3d=(_0x3cd17d-0x1)*_0xbcb027,_0x590cc7=_0x4e2e31['slice'](_0x41bc3d,_0x41bc3d+_0xbcb027);console[_0x4a013d(0x155)](_0x4a013d(0x1ab)+_0x590cc7['length']+_0x4a013d(0x14e));const _0x552e5b=await Promise[_0x4a013d(0x1b1)](_0x590cc7[_0x4a013d(0x164)](async _0x339ead=>{const _0x54e133=_0x4a013d,[_0x346179,_0x1d2e45,_0x1c723d]=await Promise['all']([database_1[_0x54e133(0x1d4)]['payment'][_0x54e133(0x1c3)]({'where':{'shopId':_0x339ead['id'],'status':_0x54e133(0x1db),'gateway':{'not':_0x54e133(0x179)}}}),database_1[_0x54e133(0x1d4)][_0x54e133(0x189)][_0x54e133(0x2ad)]({'where':{'shopId':_0x339ead['id'],'status':_0x54e133(0x1db),'gateway':{'not':_0x54e133(0x179)}},'orderBy':{'paidAt':'asc'},'select':{'paidAt':!![]}}),database_1[_0x54e133(0x1d4)][_0x54e133(0x189)]['groupBy']({'by':[_0x54e133(0x1c8)],'where':{'shopId':_0x339ead['id'],'status':_0x54e133(0x1db),'gateway':{'not':_0x54e133(0x179)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x33082c=new Date(),_0x1a8f52=new Date(_0x33082c[_0x54e133(0x105)](),_0x33082c[_0x54e133(0x293)](),0x1),_0x21dac0=new Date(_0x33082c[_0x54e133(0x105)](),_0x33082c[_0x54e133(0x293)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x55d775,_0x4951f9]=await Promise['all']([database_1['default'][_0x54e133(0x157)][_0x54e133(0x1dc)]({'_sum':{'amount':!![]},'where':{'shopId':_0x339ead['id'],'status':_0x54e133(0x28e)}}),database_1[_0x54e133(0x1d4)][_0x54e133(0x157)][_0x54e133(0x1dc)]({'_sum':{'amount':!![]},'where':{'shopId':_0x339ead['id'],'status':_0x54e133(0x28e),'createdAt':{'gte':_0x1a8f52,'lte':_0x21dac0}}})]),_0x1150ce=_0x55d775['_sum'][_0x54e133(0x1ee)]||0x0,_0x5b7bf9=_0x4951f9[_0x54e133(0x1a0)]['amount']||0x0,_0xe2c776=await Promise[_0x54e133(0x1b1)](_0x1c723d[_0x54e133(0x164)](async _0xe571a4=>{const _0x185c23=_0x54e133,_0x8f87bc=await database_1['default'][_0x185c23(0x189)]['findMany']({'where':{'shopId':_0x339ead['id'],'status':_0x185c23(0x1db),'gateway':_0xe571a4[_0x185c23(0x1c8)]},'select':{'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![]}});let _0x2fc20d=0x2d;if(_0x339ead['gatewaySettings'])try{const _0x3d2325=JSON['parse'](_0x339ead[_0x185c23(0x25c)]);for(const [_0x5b8307,_0x303ada]of Object[_0x185c23(0x1b9)](_0x3d2325)){if(_0x5b8307[_0x185c23(0x18d)]()===_0xe571a4[_0x185c23(0x1c8)][_0x185c23(0x18d)]()){_0x2fc20d=_0x303ada['commission']||0xa,console['log'](_0x185c23(0x1fe)+_0xe571a4[_0x185c23(0x1c8)]+_0x185c23(0x1f0)+_0x339ead['id']+_0x185c23(0x1c1)+_0x2fc20d+'%');break;}}}catch(_0x121766){console['error'](_0x185c23(0x27f)+_0x339ead['id']+':',_0x121766);}const _0xe217a2=_0xe571a4['_sum']?.['amountUSDT']||0x0;let _0x461c42=0x0;for(const _0x5949a5 of _0x8f87bc){if(_0x5949a5[_0x185c23(0x218)]!==null&&_0x5949a5['amountAfterGatewayCommissionUSDT']!==undefined)_0x461c42+=_0x5949a5[_0x185c23(0x218)];else{const _0xab1365=_0x5949a5['amountUSDT']||0x0;_0x461c42+=_0xab1365*(0x1-_0x2fc20d/0x64);}}return{'gateway':_0xe571a4[_0x185c23(0x1c8)],'count':_0xe571a4[_0x185c23(0x212)]?.['id']||0x0,'amountUSDT':Math[_0x185c23(0x1bb)](_0xe217a2*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x185c23(0x1bb)](_0x461c42*0x64)/0x64,'commission':_0x2fc20d};})),_0x4c1d7e=_0xe2c776[_0x54e133(0x22a)]((_0x331ce0,_0x44e225)=>_0x331ce0+_0x44e225[_0x54e133(0x171)],0x0),_0x220c47=_0xe2c776[_0x54e133(0x22a)]((_0x4b2bc0,_0x2111cc)=>_0x4b2bc0+_0x2111cc[_0x54e133(0x27d)],0x0),_0x599222=_0x339ead[_0x54e133(0xff)];return console[_0x54e133(0x155)](_0x54e133(0x197)+_0x339ead[_0x54e133(0x2ae)]+':'),console['log'](_0x54e133(0x2af)+_0x4c1d7e[_0x54e133(0x277)](0x2)+'\x20USDT\x20(gross\x20revenue)'),console[_0x54e133(0x155)](_0x54e133(0x1bc)+_0x220c47[_0x54e133(0x277)](0x2)+_0x54e133(0x214)),console[_0x54e133(0x155)](_0x54e133(0x132)+_0x599222[_0x54e133(0x277)](0x2)+'\x20USDT\x20(current\x20balance\x20in\x20DB)'),console[_0x54e133(0x155)](_0x54e133(0x249)+_0x1150ce[_0x54e133(0x277)](0x2)+_0x54e133(0x276)),console[_0x54e133(0x155)](_0x54e133(0x246)+(_0x220c47-_0x1150ce-_0x599222)[_0x54e133(0x277)](0x2)+_0x54e133(0x19d)),{'id':_0x339ead['id'],'fullName':_0x339ead[_0x54e133(0x14a)],'username':_0x339ead[_0x54e133(0x2ae)],'telegramId':_0x339ead[_0x54e133(0x234)],'merchantUrl':_0x339ead[_0x54e133(0x251)],'wallets':{'usdtPolygonWallet':_0x339ead[_0x54e133(0x24b)],'usdtTrcWallet':_0x339ead['usdtTrcWallet'],'usdtErcWallet':_0x339ead[_0x54e133(0x199)],'usdcPolygonWallet':_0x339ead['usdcPolygonWallet'],'usdcErcWallet':_0x339ead[_0x54e133(0x169)]},'totalAmountUSDT':Math[_0x54e133(0x1bb)](_0x4c1d7e*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x54e133(0x1bb)](_0x220c47*0x64)/0x64,'currentBalance':Math[_0x54e133(0x282)](_0x599222*0x64)/0x64,'totalPayout':Math[_0x54e133(0x1bb)](_0x1150ce*0x64)/0x64,'thisMonth':Math[_0x54e133(0x1bb)](_0x5b7bf9*0x64)/0x64,'paymentsCount':_0x346179,'oldestPaymentDate':_0x1d2e45?.[_0x54e133(0x275)]||_0x339ead[_0x54e133(0x286)],'gatewayBreakdown':_0xe2c776};})),_0x8e1277=_0x552e5b[_0x4a013d(0x22a)]((_0x49569b,_0x55dad4)=>_0x49569b+_0x55dad4['totalAmountUSDT'],0x0),_0x19d7b5=_0x552e5b[_0x4a013d(0x22a)]((_0x96a33e,_0x47938a)=>_0x96a33e+_0x47938a[_0x4a013d(0x1ae)],0x0),_0x103aa1=_0x552e5b[_0x4a013d(0x22a)]((_0x459d18,_0x311faa)=>_0x459d18+_0x311faa[_0x4a013d(0x196)],0x0),_0x2d0892=_0x552e5b[_0x4a013d(0x22a)]((_0x3aff59,_0x237340)=>_0x3aff59+_0x237340[_0x4a013d(0x228)],0x0);return console['log'](_0x4a013d(0x227)+_0x4232ee+_0x4a013d(0x102)),console['log'](_0x4a013d(0x2ba)+Math['round'](_0x8e1277*0x64)/0x64+_0x4a013d(0x1a7)),console[_0x4a013d(0x155)]('\x20\x20\x20âœ…\x20Total\x20net\x20balances:\x20'+Math[_0x4a013d(0x1bb)](_0x19d7b5*0x64)/0x64+_0x4a013d(0x2ac)),console['log'](_0x4a013d(0x195)+Math[_0x4a013d(0x1bb)](_0x103aa1*0x64)/0x64+_0x4a013d(0x11d)),console['log'](_0x4a013d(0x122)+Math[_0x4a013d(0x1bb)](_0x2d0892*0x64)/0x64+_0x4a013d(0x11d)),{'merchants':_0x552e5b,'pagination':{'page':_0x3cd17d,'limit':_0xbcb027,'total':_0x4232ee,'totalPages':Math[_0x4a013d(0x114)](_0x4232ee/_0xbcb027)},'summary':{'totalMerchants':_0x4232ee,'totalAmountUSDT':Math['round'](_0x8e1277*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x4a013d(0x1bb)](_0x19d7b5*0x64)/0x64,'totalPayout':Math[_0x4a013d(0x1bb)](_0x103aa1*0x64)/0x64,'thisMonth':Math['round'](_0x2d0892*0x64)/0x64}};}async[a53_0x1c3813(0x104)](_0x475fc8){const _0x43a98a=a53_0x1c3813,{shopId:_0x48e773,amount:_0x1ba5f5,network:_0x224fd3,wallet:_0xfe3d86,notes:_0x37e68a,txid:_0x4f81a0,periodFrom:_0x46e25c,periodTo:_0x31eb54}=_0x475fc8,_0x583014=await database_1['default'][_0x43a98a(0x17b)](async _0x7a40cf=>{const _0xd24bdc=_0x43a98a,_0xfda815=await _0x7a40cf[_0xd24bdc(0x10a)][_0xd24bdc(0x16c)]({'where':{'id':_0x48e773},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0xfda815)throw new Error(_0xd24bdc(0x21c));console['log'](_0xd24bdc(0x1be)+_0xfda815[_0xd24bdc(0x2ae)]+':'),console[_0xd24bdc(0x155)](_0xd24bdc(0x1c4)+_0xfda815['balance'][_0xd24bdc(0x277)](0x6)+_0xd24bdc(0x11d)),console[_0xd24bdc(0x155)]('\x20\x20\x20Payout\x20amount:\x20'+_0x1ba5f5[_0xd24bdc(0x277)](0x6)+_0xd24bdc(0x11d)),console[_0xd24bdc(0x155)](_0xd24bdc(0x1a8)+_0xfda815['totalPaidOut'][_0xd24bdc(0x277)](0x6)+_0xd24bdc(0x11d));if(_0x4f81a0)console['log'](_0xd24bdc(0x198)+_0x4f81a0);const _0x3065c2=0.000001,_0x2a2689=Number(_0xfda815[_0xd24bdc(0xff)]),_0x5a9808=Number(_0x1ba5f5);console[_0xd24bdc(0x155)](_0xd24bdc(0xfa)),console['log'](_0xd24bdc(0x2be)+_0xfda815[_0xd24bdc(0xff)]),console[_0xd24bdc(0x155)]('\x20\x20\x20Available\x20(number):\x20'+_0x2a2689),console[_0xd24bdc(0x155)]('\x20\x20\x20Requested\x20(number):\x20'+_0x5a9808),console[_0xd24bdc(0x155)]('\x20\x20\x20Difference:\x20'+(_0x2a2689-_0x5a9808)),console[_0xd24bdc(0x155)](_0xd24bdc(0x267)+_0x3065c2);if(_0x2a2689<_0x5a9808-_0x3065c2)throw new Error(_0xd24bdc(0x13c)+_0x2a2689['toFixed'](0x6)+_0xd24bdc(0x174)+_0x5a9808[_0xd24bdc(0x277)](0x6)+'\x20USDT,\x20Difference:\x20'+(_0x2a2689-_0x5a9808)['toFixed'](0x8)+_0xd24bdc(0x11d));console[_0xd24bdc(0x155)](_0xd24bdc(0x113));const _0x55426d=Math[_0xd24bdc(0x2b4)](_0x2a2689,_0x5a9808);let _0xa6b035=_0xfe3d86;console[_0xd24bdc(0x155)]('ðŸ”\x20Initial\x20wallet\x20from\x20request:\x20'+(_0xfe3d86||_0xd24bdc(0x1ef)));if(!_0xa6b035){console[_0xd24bdc(0x155)](_0xd24bdc(0x12d));const _0x4728dd=await _0x7a40cf['shop']['findUnique']({'where':{'id':_0x48e773},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});console[_0xd24bdc(0x155)](_0xd24bdc(0x127),_0x4728dd);if(_0x4728dd)switch(_0x224fd3){case'polygon':_0xa6b035=_0x4728dd[_0xd24bdc(0x24b)]||undefined,console[_0xd24bdc(0x155)]('ðŸ”\x20Selected\x20polygon\x20wallet:\x20'+_0xa6b035);break;case'trc20':_0xa6b035=_0x4728dd[_0xd24bdc(0x29f)]||undefined,console[_0xd24bdc(0x155)](_0xd24bdc(0x243)+_0xa6b035);break;case _0xd24bdc(0x1e1):_0xa6b035=_0x4728dd[_0xd24bdc(0x199)]||undefined,console['log'](_0xd24bdc(0x2a3)+_0xa6b035);break;case _0xd24bdc(0x1e5):_0xa6b035=_0x4728dd[_0xd24bdc(0x1fb)]||undefined,console[_0xd24bdc(0x155)](_0xd24bdc(0x2bc)+_0xa6b035);break;case _0xd24bdc(0x28f):_0xa6b035=_0x4728dd[_0xd24bdc(0x169)]||undefined,console[_0xd24bdc(0x155)](_0xd24bdc(0x1da)+_0xa6b035);break;}}else console[_0xd24bdc(0x155)]('âœ…\x20Using\x20wallet\x20from\x20request:\x20'+_0xa6b035);console[_0xd24bdc(0x155)](_0xd24bdc(0x19a)+_0x224fd3+':\x20'+(_0xa6b035||_0xd24bdc(0x29d))),console['log'](_0xd24bdc(0x240),{'shopId':_0x48e773,'amount':_0x55426d,'network':_0x224fd3,'wallet':_0xa6b035,'status':'COMPLETED','txid':_0x4f81a0,'notes':_0x37e68a,'periodFrom':_0x46e25c?new Date(_0x46e25c):null,'periodTo':_0x31eb54?new Date(_0x31eb54):null});const _0x3ea3b0=await _0x7a40cf[_0xd24bdc(0x157)][_0xd24bdc(0x207)]({'data':{'shopId':_0x48e773,'amount':_0x55426d,'network':_0x224fd3,'wallet':_0xa6b035,'status':_0xd24bdc(0x28e),'txid':_0x4f81a0,'notes':_0x37e68a,'periodFrom':_0x46e25c?new Date(_0x46e25c):null,'periodTo':_0x31eb54?new Date(_0x31eb54):null,'createdAt':new Date(),'paidAt':new Date()}});console[_0xd24bdc(0x155)](_0xd24bdc(0x24d),{'id':_0x3ea3b0['id'],'wallet':_0x3ea3b0['wallet'],'network':_0x3ea3b0[_0xd24bdc(0x295)],'amount':_0x3ea3b0[_0xd24bdc(0x1ee)]});const _0x54bdfe=_0x2a2689-_0x55426d,_0x248aa3=Number(_0xfda815[_0xd24bdc(0x1cb)])+_0x55426d;return await _0x7a40cf[_0xd24bdc(0x10a)]['update']({'where':{'id':_0x48e773},'data':{'balance':_0x54bdfe,'totalPaidOut':_0x248aa3}}),console[_0xd24bdc(0x155)]('ðŸ’°\x20Shop\x20'+_0xfda815[_0xd24bdc(0x2ae)]+_0xd24bdc(0x126)),console[_0xd24bdc(0x155)](_0xd24bdc(0x19e)+_0x2a2689[_0xd24bdc(0x277)](0x6)+_0xd24bdc(0x268)+_0x54bdfe[_0xd24bdc(0x277)](0x6)+_0xd24bdc(0x271)+_0x55426d[_0xd24bdc(0x277)](0x6)+')'),console['log'](_0xd24bdc(0x239)+_0xfda815[_0xd24bdc(0x1cb)]['toFixed'](0x6)+_0xd24bdc(0x268)+_0x248aa3['toFixed'](0x6)+_0xd24bdc(0x152)+_0x55426d['toFixed'](0x6)+')'),console['log'](_0xd24bdc(0x256)+_0x55426d[_0xd24bdc(0x277)](0x6)+_0xd24bdc(0x11d)),{'payout':_0x3ea3b0,'shop':_0xfda815};});console[_0x43a98a(0x155)](_0x43a98a(0x1e0)+_0x583014[_0x43a98a(0x157)]['id']+'\x20for\x20shop\x20'+_0x583014[_0x43a98a(0x10a)]['username']+'\x20('+_0x583014[_0x43a98a(0x157)][_0x43a98a(0x1ee)][_0x43a98a(0x277)](0x6)+'\x20USDT)');try{let _0x54f899=_0x43a98a(0x25b);if(_0x583014[_0x43a98a(0x157)]['periodFrom']&&_0x583014[_0x43a98a(0x157)][_0x43a98a(0x1c9)]){const _0x38428b=new Date(_0x583014[_0x43a98a(0x157)][_0x43a98a(0x1d0)])['toLocaleDateString'](_0x43a98a(0x159)),_0x17e80e=new Date(_0x583014[_0x43a98a(0x157)][_0x43a98a(0x1c9)])[_0x43a98a(0x25a)](_0x43a98a(0x159));_0x54f899=_0x38428b+'\x20-\x20'+_0x17e80e;}await telegramBotService_1['telegramBotService']['sendPayoutNotification'](_0x583014[_0x43a98a(0x157)][_0x43a98a(0x12f)],{'id':_0x583014[_0x43a98a(0x157)]['id'],'amount':_0x583014[_0x43a98a(0x157)]['amount'],'network':_0x583014['payout']['network'],'wallet':_0x583014[_0x43a98a(0x157)]['wallet'],'period':_0x54f899,'createdAt':_0x583014[_0x43a98a(0x157)][_0x43a98a(0x286)],'txid':_0x583014['payout'][_0x43a98a(0x1a2)]}),console[_0x43a98a(0x155)](_0x43a98a(0x14c)+_0x583014[_0x43a98a(0x157)]['id']);}catch(_0x395881){console['error'](_0x43a98a(0x17f)+_0x583014[_0x43a98a(0x157)]['id']+':',_0x395881);}return{'id':_0x583014[_0x43a98a(0x157)]['id'],'shopId':_0x583014[_0x43a98a(0x157)]['shopId'],'shopName':_0x583014[_0x43a98a(0x10a)][_0x43a98a(0x14a)],'shopUsername':_0x583014[_0x43a98a(0x10a)]['username'],'amount':_0x583014['payout']['amount'],'network':_0x583014[_0x43a98a(0x157)][_0x43a98a(0x295)],'wallet':_0x583014[_0x43a98a(0x157)][_0x43a98a(0x1d3)],'status':_0x583014['payout'][_0x43a98a(0x191)],'txid':_0x583014[_0x43a98a(0x157)][_0x43a98a(0x1a2)],'notes':_0x583014[_0x43a98a(0x157)][_0x43a98a(0x20b)],'periodFrom':_0x583014[_0x43a98a(0x157)][_0x43a98a(0x1d0)],'periodTo':_0x583014['payout'][_0x43a98a(0x1c9)],'createdAt':_0x583014[_0x43a98a(0x157)][_0x43a98a(0x286)],'paidAt':_0x583014[_0x43a98a(0x157)][_0x43a98a(0x275)]};}async[a53_0x1c3813(0x204)](_0x1e076b){const _0x396356=a53_0x1c3813,{page:_0x1e9e47,limit:_0x26954d,shopId:_0x4f752e,network:_0x4865eb,dateFrom:_0x34c039,dateTo:_0x399069,search:_0x20f6f6}=_0x1e076b,_0x4c1591=(_0x1e9e47-0x1)*_0x26954d,_0x3167bf={};_0x4f752e&&(_0x3167bf[_0x396356(0x12f)]=_0x4f752e);_0x4865eb&&(_0x3167bf['network']=_0x4865eb);if(_0x34c039||_0x399069){_0x3167bf[_0x396356(0x286)]={};if(_0x34c039){const _0x5cfa91=new Date(_0x34c039);_0x5cfa91[_0x396356(0x26f)](0x0,0x0,0x0,0x1),_0x3167bf[_0x396356(0x286)][_0x396356(0x1bd)]=_0x5cfa91,console[_0x396356(0x155)](_0x396356(0x161)+_0x5cfa91[_0x396356(0x192)]());}if(_0x399069){const _0x3534de=new Date(_0x399069);_0x3534de[_0x396356(0x26f)](0x17,0x3b,0x3b,0x3e7),_0x3167bf[_0x396356(0x286)][_0x396356(0x1ea)]=_0x3534de,console[_0x396356(0x155)](_0x396356(0x146)+_0x3534de[_0x396356(0x192)]());}}_0x20f6f6&&(_0x3167bf['OR']=[{'shop':{'name':{'contains':_0x20f6f6,'mode':_0x396356(0x10c)}}},{'shop':{'username':{'contains':_0x20f6f6,'mode':'insensitive'}}},{'notes':{'contains':_0x20f6f6,'mode':'insensitive'}}]);const [_0x1e6c63,_0x539133]=await Promise[_0x396356(0x1b1)]([database_1['default']['payout']['findMany']({'where':_0x3167bf,'skip':_0x4c1591,'take':_0x26954d,'orderBy':{'createdAt':_0x396356(0x1d9)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'wallet':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x396356(0x1d4)]['payout'][_0x396356(0x1c3)]({'where':_0x3167bf})]);return{'payouts':_0x1e6c63['map'](_0x17612b=>({'id':_0x17612b['id'],'shopId':_0x17612b[_0x396356(0x12f)],'shopName':_0x17612b['shop'][_0x396356(0x14a)],'shopUsername':_0x17612b[_0x396356(0x10a)]['username'],'amount':_0x17612b[_0x396356(0x1ee)],'network':_0x17612b['network'],'wallet':_0x17612b[_0x396356(0x1d3)],'status':_0x17612b[_0x396356(0x191)],'txid':_0x17612b[_0x396356(0x1a2)],'notes':_0x17612b[_0x396356(0x20b)],'periodFrom':_0x17612b[_0x396356(0x1d0)],'periodTo':_0x17612b['periodTo'],'createdAt':_0x17612b[_0x396356(0x286)],'paidAt':_0x17612b[_0x396356(0x275)]})),'pagination':{'page':_0x1e9e47,'limit':_0x26954d,'total':_0x539133,'totalPages':Math[_0x396356(0x114)](_0x539133/_0x26954d)}};}async['getPayoutById'](_0x1866bb){const _0x150c71=a53_0x1c3813,_0x1bf294=await database_1[_0x150c71(0x1d4)]['payout']['findUnique']({'where':{'id':_0x1866bb},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x1bf294)return null;return{'id':_0x1bf294['id'],'shopId':_0x1bf294['shopId'],'shopName':_0x1bf294[_0x150c71(0x10a)][_0x150c71(0x14a)],'shopUsername':_0x1bf294[_0x150c71(0x10a)]['username'],'amount':_0x1bf294['amount'],'network':_0x1bf294[_0x150c71(0x295)],'wallet':_0x1bf294[_0x150c71(0x1d3)],'status':_0x1bf294[_0x150c71(0x191)],'txid':_0x1bf294[_0x150c71(0x1a2)],'notes':_0x1bf294['notes'],'periodFrom':_0x1bf294[_0x150c71(0x1d0)],'periodTo':_0x1bf294['periodTo'],'createdAt':_0x1bf294[_0x150c71(0x286)],'paidAt':_0x1bf294[_0x150c71(0x275)]};}async[a53_0x1c3813(0x133)](_0x38ee82){const _0x5f5d72=a53_0x1c3813;await database_1[_0x5f5d72(0x1d4)][_0x5f5d72(0x157)][_0x5f5d72(0x25f)]({'where':{'id':_0x38ee82}});}async[a53_0x1c3813(0x16a)](_0x5186ac,_0x7fd2a3){const _0x5b3a72=a53_0x1c3813,_0x4c5966=await database_1[_0x5b3a72(0x1d4)][_0x5b3a72(0x17b)](async _0xa37ccf=>{const _0x4d0e83=_0x5b3a72,_0x1eb792=await _0xa37ccf[_0x4d0e83(0x157)][_0x4d0e83(0x16c)]({'where':{'id':_0x5186ac},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}}}});if(!_0x1eb792)throw new Error(_0x4d0e83(0x298));console[_0x4d0e83(0x155)](_0x4d0e83(0x14b)+_0x5186ac+_0x4d0e83(0x1f0)+_0x1eb792['shop'][_0x4d0e83(0x2ae)]+':'),console[_0x4d0e83(0x155)](_0x4d0e83(0x292)+_0x1eb792[_0x4d0e83(0x1ee)][_0x4d0e83(0x277)](0x6)+_0x4d0e83(0x11d)),console[_0x4d0e83(0x155)](_0x4d0e83(0xf2)+_0x1eb792[_0x4d0e83(0x295)]),console[_0x4d0e83(0x155)](_0x4d0e83(0x264)+_0x1eb792['shop'][_0x4d0e83(0xff)]['toFixed'](0x6)+_0x4d0e83(0x11d)),console['log'](_0x4d0e83(0x2a8)+_0x1eb792['shop'][_0x4d0e83(0x1cb)][_0x4d0e83(0x277)](0x6)+_0x4d0e83(0x11d));let _0xe786af=0x0;if(_0x7fd2a3[_0x4d0e83(0x1ee)]!==undefined){const _0x4fe03c=Number(_0x1eb792['amount']),_0x2ef387=Number(_0x7fd2a3[_0x4d0e83(0x1ee)]);_0xe786af=_0x2ef387-_0x4fe03c,console[_0x4d0e83(0x155)](_0x4d0e83(0x18c)+_0x2ef387['toFixed'](0x6)+_0x4d0e83(0x11d)),console['log'](_0x4d0e83(0x288)+_0xe786af[_0x4d0e83(0x277)](0x6)+_0x4d0e83(0x11d));if(_0xe786af<0x0)console['log']('\x20\x20\x20Amount\x20decreased\x20by\x20'+Math[_0x4d0e83(0x139)](_0xe786af)['toFixed'](0x6)+'\x20USDT\x20-\x20will\x20return\x20to\x20balance');else{if(_0xe786af>0x0){const _0x1b8023=Number(_0x1eb792[_0x4d0e83(0x10a)][_0x4d0e83(0xff)]);console[_0x4d0e83(0x155)]('\x20\x20\x20Amount\x20increased\x20by\x20'+_0xe786af[_0x4d0e83(0x277)](0x6)+_0x4d0e83(0x230));if(_0x1b8023<_0xe786af)throw new Error(_0x4d0e83(0x22d)+_0x1b8023[_0x4d0e83(0x277)](0x6)+'\x20USDT,\x20Required:\x20'+_0xe786af[_0x4d0e83(0x277)](0x6)+_0x4d0e83(0x11d));}}}const _0x4f3493={};if(_0x7fd2a3[_0x4d0e83(0x1ee)]!==undefined)_0x4f3493[_0x4d0e83(0x1ee)]=_0x7fd2a3['amount'];if(_0x7fd2a3[_0x4d0e83(0x295)]!==undefined)_0x4f3493[_0x4d0e83(0x295)]=_0x7fd2a3[_0x4d0e83(0x295)];if(_0x7fd2a3['wallet']!==undefined)_0x4f3493[_0x4d0e83(0x1d3)]=_0x7fd2a3['wallet']||null;if(_0x7fd2a3[_0x4d0e83(0x20b)]!==undefined)_0x4f3493[_0x4d0e83(0x20b)]=_0x7fd2a3['notes']||null;if(_0x7fd2a3[_0x4d0e83(0x1a2)]!==undefined)_0x4f3493[_0x4d0e83(0x1a2)]=_0x7fd2a3[_0x4d0e83(0x1a2)]||null;if(_0x7fd2a3[_0x4d0e83(0x1d0)]!==undefined)_0x4f3493['periodFrom']=_0x7fd2a3[_0x4d0e83(0x1d0)]?new Date(_0x7fd2a3[_0x4d0e83(0x1d0)]):null;if(_0x7fd2a3['periodTo']!==undefined)_0x4f3493[_0x4d0e83(0x1c9)]=_0x7fd2a3[_0x4d0e83(0x1c9)]?new Date(_0x7fd2a3[_0x4d0e83(0x1c9)]):null;const _0x529de3=await _0xa37ccf[_0x4d0e83(0x157)]['update']({'where':{'id':_0x5186ac},'data':_0x4f3493,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(_0xe786af!==0x0){const _0x7b29d4=Number(_0x1eb792[_0x4d0e83(0x10a)][_0x4d0e83(0xff)]),_0x2076ea=Number(_0x1eb792['shop']['totalPaidOut']),_0x3f2fd4=_0x7b29d4-_0xe786af,_0x401bef=_0x2076ea+_0xe786af;await _0xa37ccf[_0x4d0e83(0x10a)][_0x4d0e83(0x121)]({'where':{'id':_0x1eb792['shopId']},'data':{'balance':_0x3f2fd4,'totalPaidOut':_0x401bef}}),console[_0x4d0e83(0x155)](_0x4d0e83(0x17d)+_0x1eb792[_0x4d0e83(0x10a)]['username']+'\x20balance\x20updated:'),console[_0x4d0e83(0x155)](_0x4d0e83(0x19e)+_0x7b29d4[_0x4d0e83(0x277)](0x6)+_0x4d0e83(0x268)+_0x3f2fd4[_0x4d0e83(0x277)](0x6)+'\x20USDT'),console['log']('\x20\x20\x20Total\x20paid\x20out:\x20'+_0x2076ea[_0x4d0e83(0x277)](0x6)+_0x4d0e83(0x268)+_0x401bef[_0x4d0e83(0x277)](0x6)+_0x4d0e83(0x11d));}return console[_0x4d0e83(0x155)](_0x4d0e83(0xf1)+_0x5186ac+'\x20updated\x20successfully'),_0x529de3;});return{'id':_0x4c5966['id'],'shopId':_0x4c5966[_0x5b3a72(0x12f)],'shopName':_0x4c5966[_0x5b3a72(0x10a)]['name'],'shopUsername':_0x4c5966[_0x5b3a72(0x10a)][_0x5b3a72(0x2ae)],'amount':Number(_0x4c5966[_0x5b3a72(0x1ee)]),'network':_0x4c5966[_0x5b3a72(0x295)],'wallet':_0x4c5966[_0x5b3a72(0x1d3)],'status':_0x4c5966['status'],'txid':_0x4c5966['txid'],'notes':_0x4c5966[_0x5b3a72(0x20b)],'periodFrom':_0x4c5966[_0x5b3a72(0x1d0)],'periodTo':_0x4c5966[_0x5b3a72(0x1c9)],'createdAt':_0x4c5966[_0x5b3a72(0x286)],'paidAt':_0x4c5966['paidAt']};}async[a53_0x1c3813(0x245)](_0xf6df96){const _0x1add73=a53_0x1c3813,{page:_0x45bedb,limit:_0x2aa9aa,status:_0x146de0,gateway:_0x38487f,shopId:_0x131b7c,dateFrom:_0xa42cbb,dateTo:_0x4c14f7,search:_0x65225,currency:_0x4d2522,sortBy:_0x21575b,sortOrder:_0x445efb}=_0xf6df96,_0x519b00=(_0x45bedb-0x1)*_0x2aa9aa;console['log'](_0x1add73(0x170),_0xf6df96);const _0x4cdb5a=await database_1[_0x1add73(0x1d4)]['payment']['groupBy']({'by':[_0x1add73(0x1c8)],'_count':{'gateway':!![]}});console[_0x1add73(0x155)](_0x1add73(0x270),_0x4cdb5a[_0x1add73(0x164)](_0x30720c=>_0x30720c[_0x1add73(0x1c8)]+'\x20('+_0x30720c['_count'][_0x1add73(0x1c8)]+_0x1add73(0x20a)));if(_0x38487f){const _0x231932=_0x4cdb5a['some'](_0x49550c=>_0x49550c[_0x1add73(0x1c8)][_0x1add73(0x18d)]()===_0x38487f[_0x1add73(0x18d)]());!_0x231932&&_0x38487f[_0x1add73(0x18d)]()!=='test_gateway'&&console['log'](_0x1add73(0x1cc)+_0x38487f+_0x1add73(0x1aa)+_0x4cdb5a['map'](_0x37ab59=>_0x37ab59[_0x1add73(0x1c8)])[_0x1add73(0x188)](',\x20'));}const _0x118f93={};_0x146de0&&(_0x118f93[_0x1add73(0x191)]=_0x146de0[_0x1add73(0x20f)]());if(!_0x38487f)_0x118f93['gateway']={'not':_0x1add73(0x179)};else{if(_0x38487f&&(_0x38487f['toLowerCase']()==='test_gateway'||_0x38487f===_0x1add73(0xed)))_0x118f93[_0x1add73(0x1c8)]=_0x1add73(0x179);else{let _0x559466=_0x38487f;const _0x3c2401=(0x0,gateway_1[_0x1add73(0xf3)])(_0x38487f);if(_0x3c2401)_0x559466=_0x3c2401,console[_0x1add73(0x155)](_0x1add73(0x2aa)+_0x38487f+_0x1add73(0x2b2)+_0x559466+'\x27');else{const _0x1aaabd=(0x0,gateway_1['getGatewayIdByName'])(_0x38487f);if(_0x1aaabd){const _0x58ea0f=(0x0,gateway_1[_0x1add73(0xf3)])(_0x1aaabd);_0x58ea0f&&(_0x559466=_0x58ea0f,console['log'](_0x1add73(0x1de)+_0x38487f+_0x1add73(0x1b7)+_0x1aaabd+_0x1add73(0x1f3)+_0x559466+'\x27'));}else console['log']('ðŸ”\x20Using\x20gateway\x20\x27'+_0x38487f+_0x1add73(0x2bb));}const _0x45cc6e=await database_1[_0x1add73(0x1d4)][_0x1add73(0x189)][_0x1add73(0x1c3)]({'where':{'gateway':_0x559466[_0x1add73(0x18d)]()},'take':0x1});_0x45cc6e===0x0?(console['log']('âš ï¸\x20Gateway\x20\x27'+_0x559466+_0x1add73(0xfe)+_0x38487f+_0x1add73(0x201)),_0x118f93['gateway']=_0x1add73(0x182)):(_0x118f93[_0x1add73(0x1c8)]=_0x559466[_0x1add73(0x18d)](),console[_0x1add73(0x155)](_0x1add73(0x2a5)+_0x559466+_0x1add73(0xfe)+_0x38487f+'\x27)'));}}console[_0x1add73(0x155)]('ðŸ“Š\x20Gateway\x20filter\x20applied:',_0x118f93['gateway']);_0x131b7c&&(_0x118f93[_0x1add73(0x12f)]=_0x131b7c);_0x4d2522&&(_0x118f93[_0x1add73(0x21e)]=_0x4d2522[_0x1add73(0x20f)](),console[_0x1add73(0x155)](_0x1add73(0x250)+_0x4d2522[_0x1add73(0x20f)]()));if(_0xa42cbb||_0x4c14f7){_0x118f93[_0x1add73(0x286)]={};if(_0xa42cbb){const _0x56e6c6=new Date(_0xa42cbb),_0x50246a=new Date(Date[_0x1add73(0x1e2)](_0x56e6c6[_0x1add73(0x13f)](),_0x56e6c6[_0x1add73(0x255)](),_0x56e6c6[_0x1add73(0x262)](),0x0,0x0,0x0,0x0));_0x118f93[_0x1add73(0x286)][_0x1add73(0x1bd)]=_0x50246a,console['log'](_0x1add73(0x145)+_0x50246a[_0x1add73(0x192)]());}if(_0x4c14f7){const _0x576a10=new Date(_0x4c14f7),_0x20e2e4=new Date(Date[_0x1add73(0x1e2)](_0x576a10[_0x1add73(0x13f)](),_0x576a10[_0x1add73(0x255)](),_0x576a10[_0x1add73(0x262)](),0x17,0x3b,0x3b,0x3e7));_0x118f93[_0x1add73(0x286)][_0x1add73(0x1ea)]=_0x20e2e4,console[_0x1add73(0x155)](_0x1add73(0x1b5)+_0x20e2e4[_0x1add73(0x192)]());}}_0x65225&&(_0x118f93['OR']=[{'id':{'contains':_0x65225,'mode':'insensitive'}},{'orderId':{'contains':_0x65225,'mode':_0x1add73(0x10c)}},{'gatewayOrderId':{'contains':_0x65225,'mode':_0x1add73(0x10c)}},{'customerEmail':{'contains':_0x65225,'mode':_0x1add73(0x10c)}},{'shop':{'name':{'contains':_0x65225,'mode':_0x1add73(0x10c)}}},{'shop':{'username':{'contains':_0x65225,'mode':_0x1add73(0x10c)}}}]);console[_0x1add73(0x155)](_0x1add73(0x149),JSON[_0x1add73(0x165)](_0x118f93,null,0x2));const _0x1ce9f4=await database_1[_0x1add73(0x1d4)][_0x1add73(0x189)][_0x1add73(0x1c3)]({'where':_0x118f93});console[_0x1add73(0x155)]('ðŸ”\x20Total\x20payments\x20matching\x20filters:\x20'+_0x1ce9f4);let _0x2c3ef3={'createdAt':'desc'};if(_0x21575b){const _0x581df3=[_0x1add73(0x1ee),_0x1add73(0x286),_0x1add73(0x26d),_0x1add73(0x191),_0x1add73(0x1c8),'currency'],_0x504888=[_0x1add73(0x260),_0x1add73(0x1d9)];if(_0x581df3[_0x1add73(0x11a)](_0x21575b)){const _0x56b913=_0x504888[_0x1add73(0x11a)](_0x445efb)?_0x445efb:'desc';_0x2c3ef3={[_0x21575b]:_0x56b913},console[_0x1add73(0x155)]('ðŸ“Š\x20Sorting\x20payments\x20by\x20'+_0x21575b+_0x1add73(0x15b)+_0x56b913+'\x20order');}}const [_0x2ff207,_0x5d2128]=await Promise['all']([database_1[_0x1add73(0x1d4)][_0x1add73(0x189)]['findMany']({'where':_0x118f93,'skip':_0x519b00,'take':_0x2aa9aa,'orderBy':_0x2c3ef3,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x1add73(0x1d4)][_0x1add73(0x189)]['count']({'where':_0x118f93})]);let _0x2df541,_0x2441c5;if(_0xa42cbb){const _0x2d6600=new Date(_0xa42cbb);_0x2df541=new Date(Date[_0x1add73(0x1e2)](_0x2d6600[_0x1add73(0x13f)](),_0x2d6600['getUTCMonth'](),_0x2d6600[_0x1add73(0x262)](),0x0,0x0,0x0,0x0));}else{const _0x1a42e9=new Date();_0x2df541=new Date(Date[_0x1add73(0x1e2)](_0x1a42e9[_0x1add73(0x13f)](),_0x1a42e9[_0x1add73(0x255)](),_0x1a42e9[_0x1add73(0x262)](),0x0,0x0,0x0,0x0));}if(_0x4c14f7){const _0x2c0271=new Date(_0x4c14f7);_0x2441c5=new Date(Date['UTC'](_0x2c0271[_0x1add73(0x13f)](),_0x2c0271[_0x1add73(0x255)](),_0x2c0271['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}else{if(_0xa42cbb){const _0x2e8ac7=new Date(_0xa42cbb);_0x2441c5=new Date(Date[_0x1add73(0x1e2)](_0x2e8ac7[_0x1add73(0x13f)](),_0x2e8ac7[_0x1add73(0x255)](),_0x2e8ac7[_0x1add73(0x262)](),0x17,0x3b,0x3b,0x3e7));}else{const _0x1ee5a7=new Date();_0x2441c5=new Date(Date[_0x1add73(0x1e2)](_0x1ee5a7[_0x1add73(0x13f)](),_0x1ee5a7[_0x1add73(0x255)](),_0x1ee5a7[_0x1add73(0x262)](),0x17,0x3b,0x3b,0x3e7));}}const _0x364f66={};{const _0x4d446e={'status':_0x146de0?_0x146de0[_0x1add73(0x20f)]():'PAID','createdAt':{'gte':_0x2df541,'lte':_0x2441c5}};_0x38487f?_0x4d446e[_0x1add73(0x1c8)]=_0x118f93['gateway']:_0x4d446e[_0x1add73(0x1c8)]={'not':'test_gateway'};_0x131b7c&&(_0x4d446e[_0x1add73(0x12f)]=_0x131b7c);_0x4d2522&&(_0x4d446e[_0x1add73(0x21e)]=_0x4d2522[_0x1add73(0x20f)]());console[_0x1add73(0x155)](_0x1add73(0x274),JSON[_0x1add73(0x165)](_0x4d446e,null,0x2));const _0x328f52=await database_1['default'][_0x1add73(0x189)][_0x1add73(0xf7)]({'where':_0x4d446e,'select':{'amountUSDT':!![],'currency':!![],'amount':!![]}});let _0x247b17=0x0;_0x328f52[_0x1add73(0x17a)](_0xc19ffa=>{const _0x3318ef=_0x1add73;_0xc19ffa[_0x3318ef(0x171)]&&(_0x247b17+=_0xc19ffa['amountUSDT']);if(_0xc19ffa[_0x3318ef(0x21e)]){const _0x5cc19d=_0xc19ffa[_0x3318ef(0x21e)][_0x3318ef(0x20f)]();!_0x364f66[_0x5cc19d]&&(_0x364f66[_0x5cc19d]=0x0),_0x364f66[_0x5cc19d]+=_0xc19ffa[_0x3318ef(0x1ee)];}}),_0x247b17>0x0&&(_0x364f66[_0x1add73(0x217)]=_0x247b17);}return{'payments':_0x2ff207,'pagination':{'page':_0x45bedb,'limit':_0x2aa9aa,'total':_0x5d2128,'totalPages':Math[_0x1add73(0x114)](_0x5d2128/_0x2aa9aa)},'statistics':_0x364f66};}async['getPaymentById'](_0x43a7d1){const _0x1eb65c=a53_0x1c3813,_0x2f0404=await database_1[_0x1eb65c(0x1d4)][_0x1eb65c(0x189)][_0x1eb65c(0x16c)]({'where':{'id':_0x43a7d1},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x2f0404)return null;return{'id':_0x2f0404['id'],'shopId':_0x2f0404[_0x1eb65c(0x12f)],'gateway':_0x2f0404[_0x1eb65c(0x1c8)],'amount':_0x2f0404['amount'],'currency':_0x2f0404[_0x1eb65c(0x21e)],'status':_0x2f0404[_0x1eb65c(0x191)],'orderId':_0x2f0404['orderId'],'gatewayOrderId':_0x2f0404[_0x1eb65c(0x2b0)],'customerEmail':_0x2f0404[_0x1eb65c(0x17e)],'customerName':_0x2f0404[_0x1eb65c(0x1d6)],'customerCountry':_0x2f0404[_0x1eb65c(0x120)],'customerIp':_0x2f0404[_0x1eb65c(0x193)],'customerUa':_0x2f0404[_0x1eb65c(0x285)],'failureMessage':_0x2f0404[_0x1eb65c(0xeb)],'externalPaymentUrl':_0x2f0404['externalPaymentUrl'],'successUrl':_0x2f0404['successUrl'],'failUrl':_0x2f0404[_0x1eb65c(0x26a)],'pendingUrl':_0x2f0404['pendingUrl'],'whiteUrl':_0x2f0404[_0x1eb65c(0x221)],'createdAt':_0x2f0404['createdAt'],'updatedAt':_0x2f0404['updatedAt'],'shop':_0x2f0404['shop']};}async[a53_0x1c3813(0x194)](_0x5ab544,_0x544349,_0x15e8de,_0x51973c){const _0x2472e0=a53_0x1c3813,_0x204976=await database_1[_0x2472e0(0x1d4)][_0x2472e0(0x17b)](async _0x1ec8f0=>{const _0x54ace1=_0x2472e0,_0x510ae0=await _0x1ec8f0[_0x54ace1(0x189)][_0x54ace1(0x16c)]({'where':{'id':_0x5ab544},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x510ae0)throw new Error(_0x54ace1(0x184));const _0x1c2172=_0x510ae0[_0x54ace1(0x191)],_0x13cd33=_0x544349[_0x54ace1(0x20f)]();console[_0x54ace1(0x155)](_0x54ace1(0x181)+_0x5ab544+_0x54ace1(0x118)+_0x1c2172+_0x54ace1(0x268)+_0x13cd33),console[_0x54ace1(0x155)]('ðŸ’°\x20Current\x20shop\x20balance:\x20'+_0x510ae0[_0x54ace1(0x10a)]['balance']+'\x20USDT');const _0x45126e={'status':_0x13cd33,'updatedAt':new Date(),'statusChangedBy':_0x54ace1(0x220),'statusChangedAt':new Date()};_0x15e8de&&(_0x45126e[_0x54ace1(0x2a6)]=_0x15e8de);_0x13cd33===_0x54ace1(0x115)&&_0x51973c&&(_0x45126e[_0x54ace1(0x109)]=_0x51973c);let _0x42a858=0x0,_0x4b3f2d=_0x510ae0[_0x54ace1(0x10a)][_0x54ace1(0xff)];if(_0x13cd33===_0x54ace1(0x1db)&&_0x1c2172!=='PAID'){_0x45126e[_0x54ace1(0x275)]=new Date();const _0x351d4f=await currencyService_1['currencyService'][_0x54ace1(0x18e)](_0x510ae0[_0x54ace1(0x1ee)],_0x510ae0[_0x54ace1(0x21e)]);_0x45126e[_0x54ace1(0x171)]=_0x351d4f;let _0x30f529=0x2d;const _0x37216b=await _0x1ec8f0[_0x54ace1(0x10a)]['findUnique']({'where':{'id':_0x510ae0['shopId']},'select':{'gatewaySettings':!![]}});if(_0x37216b?.[_0x54ace1(0x25c)])try{const _0x3408c6=JSON[_0x54ace1(0x29c)](_0x37216b[_0x54ace1(0x25c)]);for(const [_0x61280f,_0x6d881c]of Object[_0x54ace1(0x1b9)](_0x3408c6)){if(_0x61280f['toLowerCase']()===_0x510ae0[_0x54ace1(0x1c8)][_0x54ace1(0x18d)]()){_0x30f529=_0x6d881c[_0x54ace1(0x16d)]||0xa;break;}}}catch(_0x4ea4be){console[_0x54ace1(0x1bf)](_0x54ace1(0x26c)+_0x5ab544+':',_0x4ea4be);}let _0x4372aa;_0x510ae0[_0x54ace1(0x218)]!==null&&_0x510ae0['amountAfterGatewayCommissionUSDT']!==undefined?(_0x4372aa=_0x510ae0[_0x54ace1(0x218)],console[_0x54ace1(0x155)](_0x54ace1(0x29b)+_0x4372aa['toFixed'](0x6)+'\x20USDT\x20for\x20payment\x20'+_0x5ab544)):(_0x4372aa=_0x351d4f*(0x1-_0x30f529/0x64),console[_0x54ace1(0x155)](_0x54ace1(0x1ac)+_0x5ab544+':\x20'+_0x30f529+'%\x20from\x20'+_0x351d4f[_0x54ace1(0x277)](0x6)+_0x54ace1(0x11d)),_0x45126e[_0x54ace1(0x218)]=_0x4372aa,_0x45126e[_0x54ace1(0x15f)]=_0x30f529),_0x42a858=_0x4372aa,_0x4b3f2d+=_0x4372aa,console[_0x54ace1(0x155)]('ðŸ’°\x20Payment\x20'+_0x5ab544+_0x54ace1(0x1f4)),console['log'](_0x54ace1(0x22c)+_0x351d4f[_0x54ace1(0x277)](0x6)+_0x54ace1(0x11d)),console[_0x54ace1(0x155)](_0x54ace1(0x11e)+_0x510ae0[_0x54ace1(0x1c8)]+_0x54ace1(0x1b3)+_0x30f529+'%'),console[_0x54ace1(0x155)](_0x54ace1(0x19c)+_0x4372aa[_0x54ace1(0x277)](0x6)+_0x54ace1(0x15a)+_0x30f529+'%\x20commission)'),console[_0x54ace1(0x155)](_0x54ace1(0x1cd)+_0x4372aa['toFixed'](0x6)+_0x54ace1(0x11d));}else{if(_0x1c2172==='PAID'&&_0x13cd33!==_0x54ace1(0x1db)&&_0x13cd33!==_0x54ace1(0x115)){if(_0x510ae0['amountUSDT']){let _0x2776c2=0x2d;const _0x3d3171=await _0x1ec8f0[_0x54ace1(0x10a)]['findUnique']({'where':{'id':_0x510ae0[_0x54ace1(0x12f)]},'select':{'gatewaySettings':!![]}});if(_0x3d3171?.[_0x54ace1(0x25c)])try{const _0x4e5611=JSON[_0x54ace1(0x29c)](_0x3d3171['gatewaySettings']);for(const [_0x1bcdd3,_0x4c4e4f]of Object[_0x54ace1(0x1b9)](_0x4e5611)){if(_0x1bcdd3['toLowerCase']()===_0x510ae0[_0x54ace1(0x1c8)][_0x54ace1(0x18d)]()){_0x2776c2=_0x4c4e4f[_0x54ace1(0x16d)]||0xa;break;}}}catch(_0x4a1c69){console[_0x54ace1(0x1bf)](_0x54ace1(0x26c)+_0x5ab544+':',_0x4a1c69);}const _0x4efa64=_0x510ae0[_0x54ace1(0x171)]*(0x1-_0x2776c2/0x64);_0x42a858=-_0x4efa64,_0x4b3f2d-=_0x4efa64,console[_0x54ace1(0x155)]('\x20\x20\x20Full\x20amount:\x20'+_0x510ae0[_0x54ace1(0x171)]['toFixed'](0x6)+_0x54ace1(0x11d)),console[_0x54ace1(0x155)]('\x20\x20\x20Gateway:\x20'+_0x510ae0[_0x54ace1(0x1c8)]+_0x54ace1(0x1b3)+_0x2776c2+'%'),console[_0x54ace1(0x155)](_0x54ace1(0x209)+_0x4efa64[_0x54ace1(0x277)](0x6)+_0x54ace1(0x15a)+_0x2776c2+_0x54ace1(0x272)),console[_0x54ace1(0x155)](_0x54ace1(0x25e)+_0x4efa64[_0x54ace1(0x277)](0x6)+_0x54ace1(0x11d));}}}_0x13cd33===_0x54ace1(0x115)&&(console['log'](_0x54ace1(0x283)),_0x51973c&&_0x51973c>0x0?(_0x42a858=-_0x51973c,_0x4b3f2d-=_0x51973c,console[_0x54ace1(0x155)](_0x54ace1(0x244)+_0x51973c[_0x54ace1(0x277)](0x6)+_0x54ace1(0x289)),console[_0x54ace1(0x155)](_0x54ace1(0x2bd))):console['log'](_0x54ace1(0x20d)),_0x45126e[_0x54ace1(0x109)]=_0x51973c||0x0);_0x13cd33===_0x54ace1(0x178)&&_0x1c2172===_0x54ace1(0x1db)&&console[_0x54ace1(0x155)](_0x54ace1(0x208));const _0x478c68=await _0x1ec8f0[_0x54ace1(0x189)][_0x54ace1(0x121)]({'where':{'id':_0x5ab544},'data':_0x45126e,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x42a858!==0x0&&(await _0x1ec8f0['shop'][_0x54ace1(0x121)]({'where':{'id':_0x510ae0['shopId']},'data':{'balance':_0x4b3f2d}}),console['log'](_0x54ace1(0x17d)+_0x510ae0[_0x54ace1(0x12f)]+'\x20balance\x20updated:\x20'+_0x510ae0[_0x54ace1(0x10a)][_0x54ace1(0xff)][_0x54ace1(0x277)](0x6)+'\x20->\x20'+_0x4b3f2d[_0x54ace1(0x277)](0x6)+_0x54ace1(0x12c)+(_0x42a858>0x0?'+':'')+_0x42a858[_0x54ace1(0x277)](0x6)+')')),_0x478c68;});return{'id':_0x204976['id'],'shopId':_0x204976[_0x2472e0(0x12f)],'gateway':_0x204976['gateway'],'amount':_0x204976[_0x2472e0(0x1ee)],'currency':_0x204976[_0x2472e0(0x21e)],'status':_0x204976[_0x2472e0(0x191)],'orderId':_0x204976['orderId'],'gatewayOrderId':_0x204976[_0x2472e0(0x2b0)],'customerEmail':_0x204976['customerEmail'],'customerName':_0x204976[_0x2472e0(0x1d6)],'customerCountry':_0x204976['customerCountry'],'customerIp':_0x204976[_0x2472e0(0x193)],'customerUa':_0x204976[_0x2472e0(0x285)],'failureMessage':_0x204976['failureMessage'],'adminNotes':_0x204976[_0x2472e0(0x2a6)],'chargebackAmount':_0x204976[_0x2472e0(0x109)],'statusChangedBy':_0x204976[_0x2472e0(0x265)],'statusChangedAt':_0x204976['statusChangedAt'],'createdAt':_0x204976['createdAt'],'updatedAt':_0x204976['updatedAt'],'shop':_0x204976[_0x2472e0(0x10a)]};}async[a53_0x1c3813(0x13d)](_0xc6d558,_0x41071a){const _0x1a3f0a=a53_0x1c3813,_0x340a14=Math['random']()[_0x1a3f0a(0x216)](0x24)['substr'](0x2,0x9);console[_0x1a3f0a(0x155)](_0x1a3f0a(0x10d)+_0x340a14+',\x20userId:\x20'+_0xc6d558);const _0x344d83={..._0x41071a};_0x41071a[_0x1a3f0a(0x1ba)]&&_0x41071a[_0x1a3f0a(0x1ba)][_0x1a3f0a(0x147)]()!==''?(console[_0x1a3f0a(0x155)](_0x1a3f0a(0x24f)+_0x340a14+_0x1a3f0a(0x128)+_0xc6d558),_0x344d83[_0x1a3f0a(0x1ba)]=await bcryptjs_1['default'][_0x1a3f0a(0x1a5)](_0x41071a[_0x1a3f0a(0x1ba)],0xc)):(console[_0x1a3f0a(0x155)](_0x1a3f0a(0x24f)+_0x340a14+_0x1a3f0a(0x242)),delete _0x344d83[_0x1a3f0a(0x1ba)]);_0x41071a[_0x1a3f0a(0x12a)]&&(_0x344d83[_0x1a3f0a(0x14a)]=_0x41071a['fullName'],delete _0x344d83[_0x1a3f0a(0x12a)]);_0x41071a[_0x1a3f0a(0x183)]&&(_0x344d83[_0x1a3f0a(0x234)]=_0x41071a['telegramId'],delete _0x344d83[_0x1a3f0a(0x183)]);_0x41071a[_0x1a3f0a(0x261)]&&(_0x344d83['shopUrl']=_0x41071a[_0x1a3f0a(0x261)],delete _0x344d83[_0x1a3f0a(0x261)]);if(_0x41071a[_0x1a3f0a(0x162)]){const _0x1dbc1e=_0x41071a[_0x1a3f0a(0x162)][_0x1a3f0a(0x164)](_0x4b411c=>this['getGatewayInternalName'](_0x4b411c));console[_0x1a3f0a(0x155)](_0x1a3f0a(0x1c0),_0x41071a[_0x1a3f0a(0x162)],'->',_0x1dbc1e),_0x344d83[_0x1a3f0a(0x294)]=JSON[_0x1a3f0a(0x165)](_0x1dbc1e),delete _0x344d83[_0x1a3f0a(0x162)];}_0x41071a[_0x1a3f0a(0x25c)]&&(console[_0x1a3f0a(0x155)](_0x1a3f0a(0x259)+_0x340a14+_0x1a3f0a(0x1f6),_0x41071a[_0x1a3f0a(0x25c)]),_0x344d83[_0x1a3f0a(0x25c)]=JSON[_0x1a3f0a(0x165)](_0x41071a[_0x1a3f0a(0x25c)]),console[_0x1a3f0a(0x155)](_0x1a3f0a(0x259)+_0x340a14+_0x1a3f0a(0x28a),_0x344d83[_0x1a3f0a(0x25c)]));_0x41071a[_0x1a3f0a(0x173)]&&(_0x41071a[_0x1a3f0a(0x173)][_0x1a3f0a(0x24b)]!==undefined&&(_0x344d83[_0x1a3f0a(0x24b)]=_0x41071a[_0x1a3f0a(0x173)][_0x1a3f0a(0x24b)]||null),_0x41071a[_0x1a3f0a(0x173)][_0x1a3f0a(0x29f)]!==undefined&&(_0x344d83[_0x1a3f0a(0x29f)]=_0x41071a[_0x1a3f0a(0x173)][_0x1a3f0a(0x29f)]||null),_0x41071a[_0x1a3f0a(0x173)][_0x1a3f0a(0x199)]!==undefined&&(_0x344d83[_0x1a3f0a(0x199)]=_0x41071a[_0x1a3f0a(0x173)][_0x1a3f0a(0x199)]||null),_0x41071a[_0x1a3f0a(0x173)][_0x1a3f0a(0x1fb)]!==undefined&&(_0x344d83[_0x1a3f0a(0x1fb)]=_0x41071a[_0x1a3f0a(0x173)]['usdcPolygonWallet']||null),delete _0x344d83['wallets']);const _0x27628e=await database_1[_0x1a3f0a(0x1d4)][_0x1a3f0a(0x10a)][_0x1a3f0a(0x121)]({'where':{'id':_0xc6d558},'data':_0x344d83,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0x1a3f0a(0x155)](_0x1a3f0a(0x223)+_0x340a14+_0x1a3f0a(0x1df),_0x27628e[_0x1a3f0a(0x25c)]),{'id':_0x27628e['id'],'fullName':_0x27628e['name'],'username':_0x27628e[_0x1a3f0a(0x2ae)],'telegramId':_0x27628e[_0x1a3f0a(0x234)],'merchantUrl':_0x27628e[_0x1a3f0a(0x251)],'gateways':_0x27628e[_0x1a3f0a(0x294)]?JSON['parse'](_0x27628e[_0x1a3f0a(0x294)]):null,'gatewaySettings':_0x27628e[_0x1a3f0a(0x25c)]?JSON[_0x1a3f0a(0x29c)](_0x27628e[_0x1a3f0a(0x25c)]):null,'publicKey':_0x27628e[_0x1a3f0a(0x27b)],'wallets':{'usdtPolygonWallet':_0x27628e['usdtPolygonWallet'],'usdtTrcWallet':_0x27628e['usdtTrcWallet'],'usdtErcWallet':_0x27628e[_0x1a3f0a(0x199)],'usdcPolygonWallet':_0x27628e[_0x1a3f0a(0x1fb)]},'status':_0x27628e[_0x1a3f0a(0x191)],'createdAt':_0x27628e['createdAt']};}async[a53_0x1c3813(0x180)](_0x5d12bf){const _0x5af5bf=a53_0x1c3813,_0x147f74=await database_1['default'][_0x5af5bf(0x10a)][_0x5af5bf(0x121)]({'where':{'id':_0x5d12bf},'data':{'status':_0x5af5bf(0x23b)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x147f74['id'],'fullName':_0x147f74[_0x5af5bf(0x14a)],'username':_0x147f74[_0x5af5bf(0x2ae)],'telegramId':_0x147f74[_0x5af5bf(0x234)],'merchantUrl':_0x147f74[_0x5af5bf(0x251)],'gateways':_0x147f74[_0x5af5bf(0x294)]?JSON['parse'](_0x147f74['paymentGateways']):null,'gatewaySettings':_0x147f74[_0x5af5bf(0x25c)]?JSON[_0x5af5bf(0x29c)](_0x147f74[_0x5af5bf(0x25c)]):null,'publicKey':_0x147f74['publicKey'],'wallets':{'usdtPolygonWallet':_0x147f74['usdtPolygonWallet'],'usdtTrcWallet':_0x147f74[_0x5af5bf(0x29f)],'usdtErcWallet':_0x147f74[_0x5af5bf(0x199)],'usdcPolygonWallet':_0x147f74[_0x5af5bf(0x1fb)]},'status':_0x147f74[_0x5af5bf(0x191)],'createdAt':_0x147f74[_0x5af5bf(0x286)]};}async[a53_0x1c3813(0x226)](_0x17a0f6){const _0x172d0e=a53_0x1c3813,_0x1343d5=await database_1['default']['shop'][_0x172d0e(0x121)]({'where':{'id':_0x17a0f6},'data':{'status':_0x172d0e(0x202)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x1343d5['id'],'fullName':_0x1343d5[_0x172d0e(0x14a)],'username':_0x1343d5[_0x172d0e(0x2ae)],'telegramId':_0x1343d5[_0x172d0e(0x234)],'merchantUrl':_0x1343d5[_0x172d0e(0x251)],'gateways':_0x1343d5[_0x172d0e(0x294)]?JSON[_0x172d0e(0x29c)](_0x1343d5[_0x172d0e(0x294)]):null,'gatewaySettings':_0x1343d5['gatewaySettings']?JSON[_0x172d0e(0x29c)](_0x1343d5[_0x172d0e(0x25c)]):null,'publicKey':_0x1343d5[_0x172d0e(0x27b)],'wallets':{'usdtPolygonWallet':_0x1343d5[_0x172d0e(0x24b)],'usdtTrcWallet':_0x1343d5['usdtTrcWallet'],'usdtErcWallet':_0x1343d5[_0x172d0e(0x199)],'usdcPolygonWallet':_0x1343d5[_0x172d0e(0x1fb)]},'status':_0x1343d5[_0x172d0e(0x191)],'createdAt':_0x1343d5[_0x172d0e(0x286)]};}async[a53_0x1c3813(0xf5)](_0x4e3aab){const _0x39f5d6=a53_0x1c3813,{page:_0x4e8f91,limit:_0x2ab6b4,status:_0x3db908,search:_0x10add4}=_0x4e3aab,_0x344350=(_0x4e8f91-0x1)*_0x2ab6b4,_0xf20fda={};_0x3db908&&(_0xf20fda[_0x39f5d6(0x191)]=_0x3db908[_0x39f5d6(0x20f)]());_0x10add4&&(_0xf20fda['OR']=[{'name':{'contains':_0x10add4,'mode':_0x39f5d6(0x10c)}},{'username':{'contains':_0x10add4,'mode':'insensitive'}},{'telegram':{'contains':_0x10add4,'mode':'insensitive'}},{'shopUrl':{'contains':_0x10add4,'mode':_0x39f5d6(0x10c)}}]);const [_0x10dbd6,_0x32e02f]=await Promise['all']([database_1[_0x39f5d6(0x1d4)][_0x39f5d6(0x10a)][_0x39f5d6(0xf7)]({'where':_0xf20fda,'skip':_0x344350,'take':_0x2ab6b4,'orderBy':{'createdAt':_0x39f5d6(0x1d9)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'twoFactorEnabled':!![],'createdAt':!![],'lastLoginAt':!![],'_count':{'select':{'telegramUsers':!![]}}}}),database_1['default'][_0x39f5d6(0x10a)][_0x39f5d6(0x1c3)]({'where':_0xf20fda})]);return{'users':_0x10dbd6[_0x39f5d6(0x164)](_0x29f578=>{const _0x17c12d=_0x39f5d6,_0x4a807e=_0x29f578['paymentGateways']?JSON['parse'](_0x29f578[_0x17c12d(0x294)]):null,_0x422f81=_0x4a807e?_0x4a807e[_0x17c12d(0x164)](_0x340b08=>this[_0x17c12d(0x257)](_0x340b08)):null;return{'id':_0x29f578['id'],'fullName':_0x29f578[_0x17c12d(0x14a)],'username':_0x29f578[_0x17c12d(0x2ae)],'telegramId':_0x29f578[_0x17c12d(0x234)],'merchantUrl':_0x29f578['shopUrl'],'gateways':_0x422f81,'gatewaySettings':_0x29f578[_0x17c12d(0x25c)]?JSON[_0x17c12d(0x29c)](_0x29f578[_0x17c12d(0x25c)]):null,'publicKey':_0x29f578[_0x17c12d(0x27b)],'wallets':{'usdtPolygonWallet':_0x29f578[_0x17c12d(0x24b)],'usdtTrcWallet':_0x29f578[_0x17c12d(0x29f)],'usdtErcWallet':_0x29f578[_0x17c12d(0x199)],'usdcPolygonWallet':_0x29f578[_0x17c12d(0x1fb)],'usdcErcWallet':_0x29f578[_0x17c12d(0x169)]},'status':_0x29f578[_0x17c12d(0x191)],'twoFactorEnabled':_0x29f578[_0x17c12d(0x111)]||![],'telegramUsersCount':_0x29f578['_count'][_0x17c12d(0xee)],'createdAt':_0x29f578['createdAt'],'lastLoginAt':_0x29f578[_0x17c12d(0x222)]};}),'pagination':{'page':_0x4e8f91,'limit':_0x2ab6b4,'total':_0x32e02f,'totalPages':Math[_0x39f5d6(0x114)](_0x32e02f/_0x2ab6b4)}};}async[a53_0x1c3813(0x1af)](_0x2b61eb){const _0x3e2619=a53_0x1c3813,_0x2444a1=await database_1['default'][_0x3e2619(0x10a)]['findUnique']({'where':{'id':_0x2b61eb},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x2444a1)return null;const _0x66c0e0=_0x2444a1[_0x3e2619(0x294)]?JSON[_0x3e2619(0x29c)](_0x2444a1['paymentGateways']):null,_0x59e68b=_0x66c0e0?_0x66c0e0[_0x3e2619(0x164)](_0x55cdb2=>this['getGatewayDisplayName'](_0x55cdb2)):null;return _0x66c0e0&&_0x59e68b&&console[_0x3e2619(0x155)](_0x3e2619(0x21d),_0x66c0e0,'->',_0x59e68b),{'id':_0x2444a1['id'],'fullName':_0x2444a1[_0x3e2619(0x14a)],'username':_0x2444a1[_0x3e2619(0x2ae)],'telegramId':_0x2444a1[_0x3e2619(0x234)],'merchantUrl':_0x2444a1[_0x3e2619(0x251)],'gateways':_0x59e68b,'gatewaySettings':_0x2444a1['gatewaySettings']?JSON[_0x3e2619(0x29c)](_0x2444a1[_0x3e2619(0x25c)]):null,'publicKey':_0x2444a1[_0x3e2619(0x27b)],'wallets':{'usdtPolygonWallet':_0x2444a1['usdtPolygonWallet'],'usdtTrcWallet':_0x2444a1['usdtTrcWallet'],'usdtErcWallet':_0x2444a1[_0x3e2619(0x199)],'usdcPolygonWallet':_0x2444a1[_0x3e2619(0x1fb)],'usdcErcWallet':_0x2444a1[_0x3e2619(0x169)]},'status':_0x2444a1[_0x3e2619(0x191)],'createdAt':_0x2444a1[_0x3e2619(0x286)]};}async[a53_0x1c3813(0x141)](_0x4386e8){const _0x5a9fa0=a53_0x1c3813,{fullName:_0x313667,username:_0x40787a,password:_0x37ab6a,telegramId:_0x455dd3,merchantUrl:_0x33819f,gateways:_0x2896ed,gatewaySettings:_0x49a573,wallets:_0x2c232a}=_0x4386e8,_0x372033=await database_1[_0x5a9fa0(0x1d4)]['shop'][_0x5a9fa0(0x16c)]({'where':{'username':_0x40787a}});if(_0x372033)throw new Error(_0x5a9fa0(0x229));if(_0x455dd3){const _0x455c6d=await database_1[_0x5a9fa0(0x1d4)][_0x5a9fa0(0x10a)][_0x5a9fa0(0x16c)]({'where':{'telegram':_0x455dd3}});if(_0x455c6d)throw new Error(_0x5a9fa0(0x280));}const _0x498d5b=await bcryptjs_1[_0x5a9fa0(0x1d4)]['hash'](_0x37ab6a,0xc),_0x5c40d1=_0x5a9fa0(0x1e7)+crypto_1[_0x5a9fa0(0x1d4)][_0x5a9fa0(0x160)](0x20)[_0x5a9fa0(0x216)]('hex'),_0x13b2ab=_0x5a9fa0(0x13a)+crypto_1[_0x5a9fa0(0x1d4)][_0x5a9fa0(0x160)](0x20)[_0x5a9fa0(0x216)](_0x5a9fa0(0x148)),_0x5afb57=_0x2896ed?_0x2896ed['map'](_0x2ff903=>this[_0x5a9fa0(0x1dd)](_0x2ff903)):null;_0x2896ed&&_0x5afb57&&console[_0x5a9fa0(0x155)](_0x5a9fa0(0x278),_0x2896ed,'->',_0x5afb57);const _0x400e39=await database_1['default'][_0x5a9fa0(0x10a)]['create']({'data':{'name':_0x313667,'username':_0x40787a,'password':_0x498d5b,'telegram':_0x455dd3,'shopUrl':_0x33819f,'paymentGateways':_0x5afb57?JSON[_0x5a9fa0(0x165)](_0x5afb57):null,'gatewaySettings':_0x49a573?JSON[_0x5a9fa0(0x165)](_0x49a573):null,'usdtPolygonWallet':_0x2c232a?.[_0x5a9fa0(0x24b)]||null,'usdtTrcWallet':_0x2c232a?.[_0x5a9fa0(0x29f)]||null,'usdtErcWallet':_0x2c232a?.[_0x5a9fa0(0x199)]||null,'usdcPolygonWallet':_0x2c232a?.[_0x5a9fa0(0x1fb)]||null,'publicKey':_0x5c40d1,'secretKey':_0x13b2ab,'status':_0x5a9fa0(0x202)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x400e39['id'],'fullName':_0x400e39[_0x5a9fa0(0x14a)],'username':_0x400e39[_0x5a9fa0(0x2ae)],'telegramId':_0x400e39[_0x5a9fa0(0x234)],'merchantUrl':_0x400e39['shopUrl'],'gateways':_0x400e39[_0x5a9fa0(0x294)]?JSON[_0x5a9fa0(0x29c)](_0x400e39[_0x5a9fa0(0x294)]):null,'gatewaySettings':_0x400e39[_0x5a9fa0(0x25c)]?JSON[_0x5a9fa0(0x29c)](_0x400e39[_0x5a9fa0(0x25c)]):null,'publicKey':_0x400e39[_0x5a9fa0(0x27b)],'wallets':{'usdtPolygonWallet':_0x400e39[_0x5a9fa0(0x24b)],'usdtTrcWallet':_0x400e39[_0x5a9fa0(0x29f)],'usdtErcWallet':_0x400e39[_0x5a9fa0(0x199)],'usdcPolygonWallet':_0x400e39[_0x5a9fa0(0x1fb)]},'status':_0x400e39[_0x5a9fa0(0x191)],'createdAt':_0x400e39[_0x5a9fa0(0x286)]};}async[a53_0x1c3813(0x296)](_0x2e3476,_0x70ddb4){const _0x2fd282=a53_0x1c3813;if(config_1[_0x2fd282(0x136)][_0x2fd282(0x220)][_0x2fd282(0x111)]){if(!_0x70ddb4)throw new Error(_0x2fd282(0x27a));const _0xe49964=speakeasy_1[_0x2fd282(0x1d4)][_0x2fd282(0x12b)]['verify']({'secret':config_1['config'][_0x2fd282(0x220)][_0x2fd282(0x215)],'encoding':_0x2fd282(0x1d5),'token':_0x70ddb4,'window':0x2});if(!_0xe49964){let _0x109741=![];if(config_1[_0x2fd282(0x136)][_0x2fd282(0x220)][_0x2fd282(0x176)]){const _0x43c2c4=JSON[_0x2fd282(0x29c)](config_1[_0x2fd282(0x136)][_0x2fd282(0x220)][_0x2fd282(0x176)]);for(let _0x19f1ea=0x0;_0x19f1ea<_0x43c2c4[_0x2fd282(0x210)];_0x19f1ea++){const _0x3566c5=await bcryptjs_1['default'][_0x2fd282(0x23a)](_0x70ddb4,_0x43c2c4[_0x19f1ea]);if(_0x3566c5){_0x109741=!![],_0x43c2c4[_0x2fd282(0x1f9)](_0x19f1ea,0x1),config_1[_0x2fd282(0x136)][_0x2fd282(0x220)]['backupCodes']=JSON[_0x2fd282(0x165)](_0x43c2c4);const _0x577146=path_1[_0x2fd282(0x1d4)][_0x2fd282(0x188)](process[_0x2fd282(0x247)](),_0x2fd282(0x213));if(fs_1[_0x2fd282(0x1d4)][_0x2fd282(0x190)](_0x577146)){let _0x4637e6=fs_1[_0x2fd282(0x1d4)][_0x2fd282(0x1e8)](_0x577146,_0x2fd282(0x26b));const _0x1ff1d2=_0x4637e6[_0x2fd282(0x1b8)]('\x0a');for(let _0x4fa8cb=0x0;_0x4fa8cb<_0x1ff1d2[_0x2fd282(0x210)];_0x4fa8cb++){if(_0x1ff1d2[_0x4fa8cb][_0x2fd282(0x19f)](_0x2fd282(0x284))){_0x1ff1d2[_0x4fa8cb]=_0x2fd282(0x284)+JSON[_0x2fd282(0x165)](_0x43c2c4);break;}}fs_1[_0x2fd282(0x1d4)]['writeFileSync'](_0x577146,_0x1ff1d2[_0x2fd282(0x188)]('\x0a'),_0x2fd282(0x26b));}break;}}}if(!_0x109741)throw new Error(_0x2fd282(0x28b));}}await database_1[_0x2fd282(0x1d4)]['shop'][_0x2fd282(0x25f)]({'where':{'id':_0x2e3476}});}async['getShopWallets'](_0x4d4eaa){const _0x475cfa=a53_0x1c3813,_0x42e076=await database_1[_0x475cfa(0x1d4)][_0x475cfa(0x10a)][_0x475cfa(0x16c)]({'where':{'id':_0x4d4eaa},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});if(!_0x42e076)throw new Error(_0x475cfa(0x21c));return{'usdtPolygonWallet':_0x42e076[_0x475cfa(0x24b)],'usdtTrcWallet':_0x42e076[_0x475cfa(0x29f)],'usdtErcWallet':_0x42e076['usdtErcWallet'],'usdcPolygonWallet':_0x42e076[_0x475cfa(0x1fb)],'usdcErcWallet':_0x42e076[_0x475cfa(0x169)]};}[a53_0x1c3813(0x1b4)](_0x214ced=0x8){const _0x5e42a9=a53_0x1c3813,_0x1346d0=[];for(let _0x3f41de=0x0;_0x3f41de<_0x214ced;_0x3f41de++){const _0x4bd0ac=crypto_1[_0x5e42a9(0x1d4)][_0x5e42a9(0x160)](0x4)[_0x5e42a9(0x216)](_0x5e42a9(0x148))[_0x5e42a9(0x20f)]();_0x1346d0[_0x5e42a9(0x1f2)](_0x4bd0ac);}return _0x1346d0;}async['setup2FA'](_0xaacb6a){const _0x4c4211=a53_0x1c3813,_0x433fcf=await database_1['default'][_0x4c4211(0x10a)][_0x4c4211(0x16c)]({'where':{'id':_0xaacb6a},'select':{'id':!![],'name':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x433fcf)throw new Error('Shop\x20not\x20found');const _0x5b9677=speakeasy_1[_0x4c4211(0x1d4)]['generateSecret']({'name':_0x4c4211(0x2b9)+_0x433fcf[_0x4c4211(0x2ae)]+')','issuer':_0x4c4211(0x16f),'length':0x20}),_0x41e9d0=await qrcode_1['default'][_0x4c4211(0x172)](_0x5b9677['otpauth_url']),_0x1f80c4=this['generateBackupCodes'](0x8),_0x4aeee2=await Promise['all'](_0x1f80c4[_0x4c4211(0x164)](_0x36fe18=>bcryptjs_1['default'][_0x4c4211(0x1a5)](_0x36fe18,0xa)));return await database_1[_0x4c4211(0x1d4)][_0x4c4211(0x10a)][_0x4c4211(0x121)]({'where':{'id':_0xaacb6a},'data':{'twoFactorSecret':_0x5b9677['base32'],'backupCodes':JSON[_0x4c4211(0x165)](_0x4aeee2)}}),console[_0x4c4211(0x155)](_0x4c4211(0x1b6)+_0x433fcf[_0x4c4211(0x2ae)]),console[_0x4c4211(0x155)]('ðŸ”‘\x20Generated\x20'+_0x1f80c4[_0x4c4211(0x210)]+'\x20backup\x20codes'),{'secret':_0x5b9677[_0x4c4211(0x1d5)],'qrCode':_0x41e9d0,'manualEntryKey':_0x5b9677['base32'],'backupCodes':_0x1f80c4};}async[a53_0x1c3813(0x1ad)](_0x50fe9a,_0x36de51){const _0x4fc463=a53_0x1c3813,_0x31860a=await database_1[_0x4fc463(0x1d4)][_0x4fc463(0x10a)]['findUnique']({'where':{'id':_0x50fe9a},'select':{'id':!![],'username':!![],'twoFactorSecret':!![],'twoFactorEnabled':!![]}});if(!_0x31860a)throw new Error(_0x4fc463(0x21c));if(!_0x31860a[_0x4fc463(0x215)])throw new Error(_0x4fc463(0x10f));if(_0x31860a[_0x4fc463(0x111)])throw new Error('2FA\x20is\x20already\x20enabled');const _0x4785c4=speakeasy_1[_0x4fc463(0x1d4)][_0x4fc463(0x12b)][_0x4fc463(0x14d)]({'secret':_0x31860a[_0x4fc463(0x215)],'encoding':'base32','token':_0x36de51,'window':0x2});if(!_0x4785c4)throw new Error(_0x4fc463(0x134));return await database_1['default'][_0x4fc463(0x10a)][_0x4fc463(0x121)]({'where':{'id':_0x50fe9a},'data':{'twoFactorEnabled':!![]}}),console[_0x4fc463(0x155)]('ðŸ”\x202FA\x20enabled\x20for\x20shop:\x20'+_0x31860a[_0x4fc463(0x2ae)]),{'enabled':!![]};}async[a53_0x1c3813(0x117)](_0x3072bc){const _0x34a878=a53_0x1c3813,_0x2debfb=await database_1[_0x34a878(0x1d4)][_0x34a878(0x10a)][_0x34a878(0x16c)]({'where':{'id':_0x3072bc},'select':{'id':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x2debfb)throw new Error('Shop\x20not\x20found');await database_1[_0x34a878(0x1d4)]['shop'][_0x34a878(0x121)]({'where':{'id':_0x3072bc},'data':{'twoFactorEnabled':![],'twoFactorSecret':null,'backupCodes':null}}),console[_0x34a878(0x155)](_0x34a878(0x16e)+_0x2debfb[_0x34a878(0x2ae)]);}async[a53_0x1c3813(0x2a1)](_0x4370c3,_0x26f5b1,_0x206a0b,_0x3f4f2e){const _0x1b3907=a53_0x1c3813;if(_0x26f5b1!==_0x206a0b)throw new Error(_0x1b3907(0x2a7));if(_0x26f5b1[_0x1b3907(0x210)]<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x2a18f8=await bcryptjs_1[_0x1b3907(0x1d4)][_0x1b3907(0x23a)](_0x4370c3,config_1[_0x1b3907(0x136)][_0x1b3907(0x220)][_0x1b3907(0x187)]);if(!_0x2a18f8)throw new Error(_0x1b3907(0x2b3));if(config_1[_0x1b3907(0x136)][_0x1b3907(0x220)][_0x1b3907(0x111)]){if(!_0x3f4f2e)throw new Error('2FA\x20token\x20is\x20required');const _0x160c25=speakeasy_1[_0x1b3907(0x1d4)][_0x1b3907(0x12b)][_0x1b3907(0x14d)]({'secret':config_1['config'][_0x1b3907(0x220)][_0x1b3907(0x215)],'encoding':'base32','token':_0x3f4f2e,'window':0x2});if(!_0x160c25){let _0xc00946=![];if(config_1[_0x1b3907(0x136)][_0x1b3907(0x220)][_0x1b3907(0x176)]){const _0xead20d=JSON[_0x1b3907(0x29c)](config_1[_0x1b3907(0x136)][_0x1b3907(0x220)][_0x1b3907(0x176)]);for(let _0x267be5=0x0;_0x267be5<_0xead20d[_0x1b3907(0x210)];_0x267be5++){const _0x12c4fb=await bcryptjs_1['default'][_0x1b3907(0x23a)](_0x3f4f2e,_0xead20d[_0x267be5]);if(_0x12c4fb){_0xc00946=!![],_0xead20d[_0x1b3907(0x1f9)](_0x267be5,0x1),config_1[_0x1b3907(0x136)]['admin'][_0x1b3907(0x176)]=JSON['stringify'](_0xead20d);const _0x2e6909=path_1['default'][_0x1b3907(0x188)](process[_0x1b3907(0x247)](),_0x1b3907(0x213));if(fs_1[_0x1b3907(0x1d4)][_0x1b3907(0x190)](_0x2e6909)){let _0x4e5848=fs_1['default'][_0x1b3907(0x1e8)](_0x2e6909,'utf8');const _0x2fbd2b=_0x4e5848[_0x1b3907(0x1b8)]('\x0a');for(let _0x688693=0x0;_0x688693<_0x2fbd2b[_0x1b3907(0x210)];_0x688693++){if(_0x2fbd2b[_0x688693]['startsWith'](_0x1b3907(0x284))){_0x2fbd2b[_0x688693]='ADMIN_BACKUP_CODES='+JSON[_0x1b3907(0x165)](_0xead20d);break;}}fs_1[_0x1b3907(0x1d4)]['writeFileSync'](_0x2e6909,_0x2fbd2b['join']('\x0a'),_0x1b3907(0x26b));}break;}}}if(!_0xc00946)throw new Error(_0x1b3907(0x28b));}}const _0x3310da=await bcryptjs_1['default'][_0x1b3907(0x1a5)](_0x26f5b1,0xc);config_1[_0x1b3907(0x136)][_0x1b3907(0x220)][_0x1b3907(0x187)]=_0x3310da;const _0x13db5a=path_1['default']['join'](process['cwd'](),_0x1b3907(0x213));let _0x4440f4='';if(fs_1[_0x1b3907(0x1d4)][_0x1b3907(0x190)](_0x13db5a)){_0x4440f4=fs_1['default'][_0x1b3907(0x1e8)](_0x13db5a,'utf8');const _0x34ac13=_0x4440f4[_0x1b3907(0x1b8)]('\x0a');let _0x328a3a=![];for(let _0x335bad=0x0;_0x335bad<_0x34ac13['length'];_0x335bad++){if(_0x34ac13[_0x335bad][_0x1b3907(0x19f)](_0x1b3907(0x1cf))){_0x34ac13[_0x335bad]=_0x1b3907(0x1cf)+_0x3310da,_0x328a3a=!![];break;}}!_0x328a3a&&_0x34ac13[_0x1b3907(0x1f2)](_0x1b3907(0x1cf)+_0x3310da),_0x4440f4=_0x34ac13[_0x1b3907(0x188)]('\x0a'),fs_1[_0x1b3907(0x1d4)][_0x1b3907(0x100)](_0x13db5a,_0x4440f4,_0x1b3907(0x26b));}console[_0x1b3907(0x155)](_0x1b3907(0x290));}async[a53_0x1c3813(0x13b)](){const _0x5686fc=a53_0x1c3813;let _0x2b4dac=0x0;if(config_1[_0x5686fc(0x136)][_0x5686fc(0x220)]['backupCodes'])try{const _0x3c9a5f=JSON[_0x5686fc(0x29c)](config_1[_0x5686fc(0x136)][_0x5686fc(0x220)][_0x5686fc(0x176)]);_0x2b4dac=_0x3c9a5f[_0x5686fc(0x210)];}catch(_0x45e381){console[_0x5686fc(0x1bf)]('Error\x20parsing\x20backup\x20codes:',_0x45e381);}return{'twoFactorEnabled':config_1[_0x5686fc(0x136)][_0x5686fc(0x220)]['twoFactorEnabled'],'backupCodesCount':_0x2b4dac};}async[a53_0x1c3813(0xfc)](){const _0x21eb5e=a53_0x1c3813,_0x426053=speakeasy_1[_0x21eb5e(0x1d4)]['generateSecret']({'name':_0x21eb5e(0x299)+config_1[_0x21eb5e(0x136)]['admin'][_0x21eb5e(0x2ae)]+')','issuer':_0x21eb5e(0x21b),'length':0x20}),_0x468538=await qrcode_1[_0x21eb5e(0x1d4)][_0x21eb5e(0x172)](_0x426053[_0x21eb5e(0x2a0)]),_0x4bb7ef=[];for(let _0x144c93=0x0;_0x144c93<0x8;_0x144c93++){const _0x56ded1=crypto_1['default'][_0x21eb5e(0x160)](0x4)[_0x21eb5e(0x216)](_0x21eb5e(0x148))[_0x21eb5e(0x20f)]();_0x4bb7ef[_0x21eb5e(0x1f2)](_0x56ded1);}const _0xdf83cd=await Promise[_0x21eb5e(0x1b1)](_0x4bb7ef[_0x21eb5e(0x164)](_0x42a7b4=>bcryptjs_1[_0x21eb5e(0x1d4)][_0x21eb5e(0x1a5)](_0x42a7b4,0xa)));config_1['config'][_0x21eb5e(0x220)][_0x21eb5e(0x215)]=_0x426053[_0x21eb5e(0x1d5)],config_1[_0x21eb5e(0x136)][_0x21eb5e(0x220)][_0x21eb5e(0x176)]=JSON[_0x21eb5e(0x165)](_0xdf83cd);const _0x40a1e1=path_1[_0x21eb5e(0x1d4)][_0x21eb5e(0x188)](process['cwd'](),_0x21eb5e(0x213));if(fs_1[_0x21eb5e(0x1d4)]['existsSync'](_0x40a1e1)){let _0x49322f=fs_1['default']['readFileSync'](_0x40a1e1,'utf8');const _0xa690b8=_0x49322f[_0x21eb5e(0x1b8)]('\x0a');let _0x442712=![],_0x2bb98d=![];for(let _0x5500fb=0x0;_0x5500fb<_0xa690b8['length'];_0x5500fb++){_0xa690b8[_0x5500fb][_0x21eb5e(0x19f)](_0x21eb5e(0x140))&&(_0xa690b8[_0x5500fb]=_0x21eb5e(0x140)+_0x426053[_0x21eb5e(0x1d5)],_0x442712=!![]),_0xa690b8[_0x5500fb]['startsWith']('ADMIN_BACKUP_CODES=')&&(_0xa690b8[_0x5500fb]=_0x21eb5e(0x284)+JSON[_0x21eb5e(0x165)](_0xdf83cd),_0x2bb98d=!![]);}if(!_0x442712)_0xa690b8[_0x21eb5e(0x1f2)](_0x21eb5e(0x140)+_0x426053[_0x21eb5e(0x1d5)]);if(!_0x2bb98d)_0xa690b8[_0x21eb5e(0x1f2)]('ADMIN_BACKUP_CODES='+JSON['stringify'](_0xdf83cd));fs_1[_0x21eb5e(0x1d4)]['writeFileSync'](_0x40a1e1,_0xa690b8['join']('\x0a'),_0x21eb5e(0x26b));}return console[_0x21eb5e(0x155)](_0x21eb5e(0x177)),console[_0x21eb5e(0x155)]('ðŸ”‘\x20Generated\x20'+_0x4bb7ef[_0x21eb5e(0x210)]+_0x21eb5e(0x15e)),{'secret':_0x426053['base32'],'qrCode':_0x468538,'manualEntryKey':_0x426053[_0x21eb5e(0x1d5)],'backupCodes':_0x4bb7ef};}async['enableAdmin2FA'](_0xbf96bf){const _0x314e81=a53_0x1c3813;if(!config_1[_0x314e81(0x136)][_0x314e81(0x220)]['twoFactorSecret'])throw new Error(_0x314e81(0x10f));if(config_1[_0x314e81(0x136)][_0x314e81(0x220)][_0x314e81(0x111)])throw new Error(_0x314e81(0x103));const _0x15553c=speakeasy_1['default'][_0x314e81(0x12b)][_0x314e81(0x14d)]({'secret':config_1[_0x314e81(0x136)][_0x314e81(0x220)][_0x314e81(0x215)],'encoding':_0x314e81(0x1d5),'token':_0xbf96bf,'window':0x2});if(!_0x15553c)throw new Error(_0x314e81(0x134));config_1[_0x314e81(0x136)][_0x314e81(0x220)]['twoFactorEnabled']=!![];const _0x3eaac7=path_1[_0x314e81(0x1d4)][_0x314e81(0x188)](process[_0x314e81(0x247)](),_0x314e81(0x213));if(fs_1[_0x314e81(0x1d4)][_0x314e81(0x190)](_0x3eaac7)){let _0x45011b=fs_1[_0x314e81(0x1d4)][_0x314e81(0x1e8)](_0x3eaac7,'utf8');const _0x242059=_0x45011b[_0x314e81(0x1b8)]('\x0a');let _0x2e90bc=![];for(let _0x27b662=0x0;_0x27b662<_0x242059[_0x314e81(0x210)];_0x27b662++){if(_0x242059[_0x27b662][_0x314e81(0x19f)](_0x314e81(0x2a9))){_0x242059[_0x27b662]='ADMIN_2FA_ENABLED=true',_0x2e90bc=!![];break;}}if(!_0x2e90bc)_0x242059[_0x314e81(0x1f2)](_0x314e81(0x131));fs_1[_0x314e81(0x1d4)][_0x314e81(0x100)](_0x3eaac7,_0x242059[_0x314e81(0x188)]('\x0a'),_0x314e81(0x26b));}return console['log'](_0x314e81(0x2b8)),{'enabled':!![]};}async[a53_0x1c3813(0x18f)](){const _0x21b5a0=a53_0x1c3813;config_1[_0x21b5a0(0x136)][_0x21b5a0(0x220)]['twoFactorEnabled']=![],config_1[_0x21b5a0(0x136)]['admin'][_0x21b5a0(0x215)]='',config_1[_0x21b5a0(0x136)][_0x21b5a0(0x220)][_0x21b5a0(0x176)]='';const _0x8d4391=path_1[_0x21b5a0(0x1d4)][_0x21b5a0(0x188)](process[_0x21b5a0(0x247)](),_0x21b5a0(0x213));if(fs_1[_0x21b5a0(0x1d4)][_0x21b5a0(0x190)](_0x8d4391)){let _0x5b9469=fs_1[_0x21b5a0(0x1d4)][_0x21b5a0(0x1e8)](_0x8d4391,_0x21b5a0(0x26b));const _0x1eb1b4=_0x5b9469[_0x21b5a0(0x1b8)]('\x0a');for(let _0x1642a5=0x0;_0x1642a5<_0x1eb1b4[_0x21b5a0(0x210)];_0x1642a5++){_0x1eb1b4[_0x1642a5][_0x21b5a0(0x19f)](_0x21b5a0(0x2a9))&&(_0x1eb1b4[_0x1642a5]=_0x21b5a0(0x2b1)),_0x1eb1b4[_0x1642a5][_0x21b5a0(0x19f)](_0x21b5a0(0x140))&&(_0x1eb1b4[_0x1642a5]=_0x21b5a0(0x140)),_0x1eb1b4[_0x1642a5][_0x21b5a0(0x19f)](_0x21b5a0(0x284))&&(_0x1eb1b4[_0x1642a5]=_0x21b5a0(0x284));}fs_1[_0x21b5a0(0x1d4)]['writeFileSync'](_0x8d4391,_0x1eb1b4['join']('\x0a'),'utf8');}console['log'](_0x21b5a0(0x15c));}[a53_0x1c3813(0x2b5)](_0x1c199c,_0xd7a7fc,_0xf45d0){const _0x10d634=a53_0x1c3813,_0x252e9a=new Map(),_0x2dbdd6=new Date(_0xd7a7fc);while(_0x2dbdd6<=_0xf45d0){const _0x3eca08=_0x2dbdd6[_0x10d634(0x192)]()[_0x10d634(0x1b8)]('T')[0x0];_0x252e9a[_0x10d634(0x1e4)](_0x3eca08,{'revenue':0x0,'count':0x0}),_0x2dbdd6[_0x10d634(0x119)](_0x2dbdd6[_0x10d634(0x21f)]()+0x1);}for(const _0x2a99ce of _0x1c199c){const _0x564a40=_0x2a99ce['createdAt'][_0x10d634(0x192)]()[_0x10d634(0x1b8)]('T')[0x0],_0x23593a=_0x252e9a[_0x10d634(0x203)](_0x564a40);_0x23593a&&(_0x23593a[_0x10d634(0x1c3)]+=0x1,_0x2a99ce[_0x10d634(0x191)]===_0x10d634(0x1db)&&(_0x2a99ce[_0x10d634(0x171)]?_0x23593a[_0x10d634(0x219)]+=_0x2a99ce[_0x10d634(0x171)]:console[_0x10d634(0x155)]('âš ï¸\x20Payment\x20'+_0x2a99ce['id']+_0x10d634(0xef))));}const _0x308e7e=[],_0x25194f=[];for(const [_0x2c5b38,_0x930287]of _0x252e9a){_0x308e7e['push']({'date':_0x2c5b38,'amount':Math[_0x10d634(0x1bb)](_0x930287[_0x10d634(0x219)]*0x64)/0x64}),_0x25194f['push']({'date':_0x2c5b38,'count':_0x930287['count']});}return{'dailyRevenue':_0x308e7e,'dailyPayments':_0x25194f};}async[a53_0x1c3813(0x23c)](_0x23d721){const _0x705a81=a53_0x1c3813;console[_0x705a81(0x155)](_0x705a81(0x129),_0x23d721);const _0x5a0f70=new Date(_0x23d721[_0x705a81(0x1d0)]),_0x12cd78=new Date(_0x23d721[_0x705a81(0x1c9)]),_0x323e77=new Date(Date[_0x705a81(0x1e2)](_0x5a0f70['getUTCFullYear'](),_0x5a0f70[_0x705a81(0x255)](),_0x5a0f70['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x1219d7=new Date(Date['UTC'](_0x12cd78[_0x705a81(0x13f)](),_0x12cd78['getUTCMonth'](),_0x12cd78['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));console[_0x705a81(0x155)](_0x705a81(0x13e)+_0x323e77[_0x705a81(0x192)]()+'\x20to\x20'+_0x1219d7['toISOString']()),console[_0x705a81(0x155)]('ðŸ”Œ\x20Gateway:\x20'+_0x23d721['gateway']);const _0x40a92f=await database_1[_0x705a81(0x1d4)][_0x705a81(0x189)][_0x705a81(0xf7)]({'where':{'status':_0x705a81(0x1db),'gateway':_0x23d721[_0x705a81(0x1c8)][_0x705a81(0x18d)](),'createdAt':{'gte':_0x323e77,'lte':_0x1219d7}},'select':{'id':!![],'shopId':!![],'amountAfterGatewayCommissionUSDT':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console[_0x705a81(0x155)]('ðŸ’°\x20Found\x20'+_0x40a92f[_0x705a81(0x210)]+_0x705a81(0x16b)+_0x23d721['gateway']);const _0x12cf93=new Map();for(const _0x155d30 of _0x40a92f){const _0x58a9fa=_0x155d30['amountAfterGatewayCommissionUSDT']||0x0;if(_0x58a9fa<=0x0){console[_0x705a81(0x21a)](_0x705a81(0x1a9)+_0x155d30['id']+'\x20has\x20zero\x20or\x20null\x20merchant\x20amount,\x20skipping...');continue;}if(_0x12cf93[_0x705a81(0x135)](_0x155d30[_0x705a81(0x12f)])){const _0xbbcd78=_0x12cf93['get'](_0x155d30[_0x705a81(0x12f)]);_0xbbcd78[_0x705a81(0x211)]+=_0x58a9fa;}else _0x12cf93[_0x705a81(0x1e4)](_0x155d30[_0x705a81(0x12f)],{'merchantId':_0x155d30[_0x705a81(0x10a)]['id'],'merchantName':_0x155d30[_0x705a81(0x10a)]['name'],'merchantUsername':_0x155d30['shop']['username'],'totalAmount':_0x58a9fa});}const _0x165a5a=Array['from'](_0x12cf93[_0x705a81(0x124)]())[_0x705a81(0x164)](_0x38b139=>({'merchantId':_0x38b139[_0x705a81(0x1d1)],'merchantName':_0x38b139['merchantName'],'merchantUsername':_0x38b139[_0x705a81(0x20c)],'gateway':_0x23d721[_0x705a81(0x1c8)],'periodFrom':_0x23d721[_0x705a81(0x1d0)],'periodTo':_0x23d721['periodTo'],'totalAmount':Math[_0x705a81(0x1bb)](_0x38b139[_0x705a81(0x211)]*0x64)/0x64}));return _0x165a5a[_0x705a81(0x1e9)]((_0x4917c2,_0x5bc4b1)=>_0x5bc4b1[_0x705a81(0x211)]-_0x4917c2['totalAmount']),console['log']('ðŸ“Š\x20Generated\x20reports\x20for\x20'+_0x165a5a[_0x705a81(0x210)]+_0x705a81(0x102)),_0x165a5a;}async['depositBalance'](_0x421fc0,_0x47de16,_0x5a5218){const _0xd82e51=a53_0x1c3813,_0xd99978=await database_1[_0xd82e51(0x1d4)][_0xd82e51(0x10a)][_0xd82e51(0x16c)]({'where':{'id':_0x421fc0}});if(!_0xd99978)throw new Error('Merchant\x20not\x20found');await database_1[_0xd82e51(0x1d4)]['$transaction'](async _0x4b52aa=>{const _0x4505b2=_0xd82e51;await _0x4b52aa['payment'][_0x4505b2(0x207)]({'data':{'shopId':_0xd99978['id'],'amount':_0x47de16,'amountUSDT':_0x47de16,'amountAfterGatewayCommissionUSDT':_0x47de16,'sourceCurrency':_0x4505b2(0x22f),'currency':_0x4505b2(0x22f),'status':_0x4505b2(0x1db),'gateway':_0x4505b2(0x22b),'customerName':_0xd99978[_0x4505b2(0x2ae)],'customerEmail':'@'+_0xd99978[_0x4505b2(0x234)],'paymentMethod':_0x4505b2(0x1a3),'adminNotes':_0x5a5218||null,'successUrl':'-','failUrl':'-','paidAt':new Date()}}),await _0x4b52aa[_0x4505b2(0x10a)][_0x4505b2(0x121)]({'where':{'id':_0xd99978['id']},'data':{'balance':{'increment':_0x47de16}}});}),console[_0xd82e51(0x155)](_0xd82e51(0x235)+_0x47de16+_0xd82e51(0x23d)+_0xd99978['username']);}}exports[a53_0x1c3813(0x150)]=AdminService;