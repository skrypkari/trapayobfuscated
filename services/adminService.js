'use strict';const a48_0x3818f7=a48_0x42f0;(function(_0x4a9e55,_0x2105d1){const _0x12b73d=a48_0x42f0,_0x5c20b9=_0x4a9e55();while(!![]){try{const _0x46a3e9=parseInt(_0x12b73d(0x2d3))/0x1*(-parseInt(_0x12b73d(0x2b0))/0x2)+-parseInt(_0x12b73d(0x1e2))/0x3+parseInt(_0x12b73d(0x1f6))/0x4+-parseInt(_0x12b73d(0x327))/0x5*(-parseInt(_0x12b73d(0x2cc))/0x6)+parseInt(_0x12b73d(0x1ec))/0x7*(parseInt(_0x12b73d(0x1ef))/0x8)+-parseInt(_0x12b73d(0x34b))/0x9*(-parseInt(_0x12b73d(0x242))/0xa)+-parseInt(_0x12b73d(0x184))/0xb*(parseInt(_0x12b73d(0x331))/0xc);if(_0x46a3e9===_0x2105d1)break;else _0x5c20b9['push'](_0x5c20b9['shift']());}catch(_0x505133){_0x5c20b9['push'](_0x5c20b9['shift']());}}}(a48_0x347e,0x9400e));function a48_0x347e(){const _0x5412f3=['üí∞\x20Payment\x20amount\x20is\x20NOT\x20deducted\x20(chargeback\x20penalty\x20only)','totalCommissionRate','getUTCFullYear','2FA\x20is\x20already\x20enabled','toLocaleDateString','verify','üìä\x20Total\x20payments\x20(including\x20failed):\x20','‚ö†Ô∏è\x20Gateway\x20\x27','üîÑ\x20Converted\x20gateway\x20name\x20\x27','\x27\x20to\x20name\x20\x27','üí∞\x20Creating\x20payout\x20for\x20shop\x20','KLYME\x20DE','\x20\x20\x20Current\x20network:\x20','toLowerCase','‚úÖ\x20Balance\x20check\x20passed\x20(with\x20tolerance)','split','./currencyService','getGatewayNameById','ADMIN_2FA_ENABLED=','\x20\x20\x20Requested\x20(number):\x20','‚ö†Ô∏è\x20Payment\x20','üí∞\x20Shop\x20','üìä\x20Calculated\x20commission\x20rate\x20for\x20payment\x20','totalAmountUSDT','dailyPayments','üîç\x20Initial\x20wallet\x20from\x20request:\x20','revenue','abs','splice','polygon','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','getFullYear','\x20USDT\x20(','backupCodes','usdcPolygonWallet','\x27\x20not\x20found.\x20Available\x20gateways:\x20','\x20\x20\x20Final\x20payout\x20amount\x20used:\x20','insensitive','üìÖ\x20Date\x20from\x20filter:\x20','generateBackupCodes','\x20\x20\x20‚úÖ\x20Actual\x20available\x20balance:\x20','name','\x20USDT\x20from\x20balance','../config/config','crypto','averageCommissionRate','\x20\x20\x20üë§\x20Merchant\x20earnings:\x20','this_month','\x20\x20\x20Merchant\x20loses:\x20','generateSecret','634390BcptSA','PENDING','üîç\x20Selected\x20trc20\x20wallet:\x20','commissionUSDT','passwordHash','üí∞\x20[PAYOUT]\x20Gateway\x20','ADMIN_BACKUP_CODES=','trc20','setHours','Insufficient\x20balance\x20for\x20amount\x20increase.\x20Available:\x20','updateCustomerData','payout','totalPayments','disable2FA','statusChangedAt','üìä\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','qrcode','amountAfterCommissionUSDT','üéØ\x20updateUser\x20called\x20with\x20ID:\x20','\x20\x20\x20Balance:\x20','reduce','../types/gateway','getTime','randomBytes','min','getUTCMonth','getAllPayouts','\x20merchants','round','defineProperty','MasterCard','writeFileSync','deleteUser','../config/database','üîç\x20Selected\x20polygon_usdc\x20wallet:\x20','getMonth','groupBy','telegramBotService','NONEXISTENT_GATEWAY_FILTER','pendingPayout','shopId','üîê\x202FA\x20disabled\x20for\x20shop:\x20','\x20USDT\x20(after\x20','üìä\x20Payout\x20statistics\x20calculated:','\x20merchants\x20for\x20selection','\x20\x20\x20Gateway:\x20','KLYME\x20GB','hex','üîß\x20[','üí±\x20Currency\x20filter\x20applied:\x20','wallets','\x20USDT\x20(rounded\x20to\x202\x20decimal\x20places)','password','REFUND','üîê\x20[','getPayoutById','ACTIVE','amount','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','__esModule','getPayoutStats','erc20','push','utf8','amountUSDT','\x20became\x20PAID:','\x20\x20\x20üí∞\x20Total\x20payout:\x20','\x20\x20\x20üñ•Ô∏è\x20User\x20Agent:\x20','\x20\x20\x20ÔøΩüìä\x20Total\x20payments:\x20','Shop\x20not\x20found','lte','cointopay','\x20\x20\x20Amount\x20difference:\x20','%\x20commission)','customerUa','yesterday','set',']\x20Updating\x20password\x20for\x20user\x20','values','replace','floor','currencyService','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','totalTurnover','updatedAt','join','amountAfterGatewayCommissionUSDT','SquirrelPay','ADMIN_2FA_SECRET=','\x20\x20\x20Amount\x20decreased\x20by\x20','\x20\x20\x20Amount\x20increased\x20by\x20','Visa/MasterCard','publicKey','not\x20provided','pk_','üìä\x20Using\x20saved\x20values\x20for\x20payment\x20','üîÑ\x20Gateway\x20mapping\x20(get):','\x20\x20\x20‚è≥\x20Pending\x20payout:\x20','\x20\x20\x20üåç\x20Country:\x20','üîç\x20Using\x20gateway\x20\x27','\x20USDT\x20(already\x20paid\x20out)','üìä\x20Calculating\x20payout\x20statistics...','shopUrl','\x20\x20\x20üíµ\x20Available\x20balance:\x20','customerCountry','turnover','error','\x20\x20\x20Tolerance:\x20','üìä\x20Statistics\x20date\x20range:\x20','\x20USDT\x20(same\x20as\x20awaiting)','688654sBbvZt','findUnique','\x20\x20\x20Current\x20amount:\x20','Invalid\x202FA\x20token','telegramId','\x20balance\x20updated:','orderId','getMerchantStatistics','year','includes','Noda','PAID','gatewayOrderId',',\x20chargebacks:\x20','getSystemStatistics',',\x20userId:\x20','existsSync','\x20\x20\x20üí≥\x20Total\x20payments:\x20','üîç\x20Balance\x20check\x20details:','üîç\x20Selected\x20erc20_usdc\x20wallet:\x20','\x20\x20\x20New\x20amount:\x20',',\x20Commission:\x20','log','merchantEarningsUSDT','getUTCDate','chargebackAmount','gateway','currency','85218kSDHbD','\x20\x20\x20Difference:\x20','path','\x20backup\x20codes','parse','toUpperCase','‚úÖ\x20Customer\x20data\x20updated\x20for\x20payment\x20','1UvtmhE','\x20\x20\x20Transaction\x20hash:\x20','payouts','telegram','%\x20from\x20','get','Error\x20processing\x20payment\x20','\x20->\x20','readFileSync','getMerchantsAwaitingPayout','\x20\x20\x20Available\x20(raw):\x20','üéØ\x20[','custom','aggregate','UTC','üìä\x20Merchants\x20with\x20rounded\x20balance\x20!=\x200.00:\x20','üìÖ\x20Period:\x20','üí∞\x20Found\x20','rapyd','ru-RU','shop','\x20paid\x20payments\x20for\x20analysis','username','date','twoFactorSecret','lastMonth','not\x20set','KLYME\x20EU','üì±\x20Telegram\x20notification\x20sent\x20for\x20payout\x20','cwd','üìä\x20Gateway\x20filter\x20applied:','\x20with\x20payout\x20history','activateUser','payment','üîç\x20Total\x20payments\x20matching\x20filters:\x20','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','sk_','ADMIN_2FA_ENABLED=true','TrapaPay\x20Admin','periodFrom','Telegram\x20username\x20already\x20exists','sendPayoutNotification','txid','getAllUsers','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','pendingUrl','\x20USDT\x20(gross\x20revenue)','last_week','\x20\x20\x20Shop\x20totalPaidOut:\x20','üí≥\x20Final\x20payout\x20wallet\x20for\x20','suspendUser','Amer','üîê\x20Admin\x202FA\x20setup\x20initiated','üí∞\x20[PAYOUT]\x20Merchant\x20','\x20USDT\x20-\x20will\x20deduct\x20from\x20balance','balance','generateDailyStatistics','\x20for\x20shop\x20','noda','trim','config','get2FASettings','‚úÖ\x20Payout\x20','localeCompare','some','customerEmail','2FA\x20not\x20set\x20up.\x20Please\x20call\x20setup\x20endpoint\x20first','üîÑ\x20Admin\x20updating\x20payment\x20','COMPLETED','üîê\x20Admin\x20password\x20changed\x20successfully','setup2FA','\x20updated\x20successfully','üîë\x20Generated\x20','\x27\x20(from\x20\x27','usdtErcWallet','setDate','totalAmountAfterCommissionUSDT','OnRamp','convertToUSDT','.env','üîê\x20Admin\x202FA\x20enabled','createUser','\x27\x20->\x20name\x20\x27','week','65htHzwG','$transaction','network','paymentGateways','üìã\x20Getting\x20merchants\x20selection\x20list...','commission','\x20USDT,\x20Difference:\x20','\x20\x20\x20üåê\x20IP:\x20','entries','last_month','67944BeofLq','klyme_de','‚úÖ\x20Payout\x20created:\x20','\x20\x20\x20Merchant\x20gets:\x20','üí∞\x20Current\x20shop\x20balance:\x20','üîÑ\x20Updating\x20customer\x20data\x20for\x20payment\x20','dateTo','paymentsCount','TrapaPay\x20Admin\x20(','twoFactorEnabled','klyme_gb','2020-01-01','warn','üìä\x20Getting\x20payments\x20with\x20filters:','custom_','‚úÖ\x20Payout\x20created\x20in\x20DB:','Test\x20Gateway','statusChangedBy','0000','\x20payments)','üí∏\x20CHARGEBACK:\x20Processing\x20penalty-only\x20deduction','\x20USDT\x20-\x20will\x20return\x20to\x20balance','averageCheckUSDT','Invalid\x202FA\x20token\x20or\x20backup\x20code',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','totp','45TJQlIf','ADMIN_PASSWORD_HASH=','AdminService','\x20status:\x20','merchantEarnings','usdtTrcWallet','substr','compare','gatewayEarnings','‚úÖ\x20Using\x20wallet\x20from\x20request:\x20','429SgfiCB','asc','CHARGEBACK','toISOString','\x20\x20\x20Available\x20(number):\x20','Payment\x20not\x20found','EXPIRED',',\x20refunds:\x20','\x20\x20\x20Full\x20amount:\x20','\x20USDT,\x20Requested:\x20','_sum','\x20\x20\x20üìÖ\x20This\x20month:\x20','wallet','count','desc','AmPay\x20TRY','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','CoinToPay','\x20USDT)','\x20\x20\x20ÔøΩ\x20Total\x20payments\x20turnover:\x20','gateways','totalPaidOut','totalPayout',']\x20Gateway\x20settings\x20before\x20saving:','erc20_usdc','üìä\x20Final\x20WHERE\x20conditions:','hash','status','OxaPay','failUrl','üí∏\x20CHARGEBACK\x20penalty\x20ONLY:\x20-','test_gateway','slice','üîê\x202FA\x20setup\x20initiated\x20for\x20shop:\x20','\x20USDT','üí∞\x20Payment\x20','CoinToPay2','deletePayout','\x20USDT\x20(theoretical\x20net)','polygon_usdc','delete','gatewaySettings','findFirst','default','AmPay','gatewayCommissionRate','\x20\x20\x20Shop\x20balance:\x20','whiteUrl','ADMIN_2FA_ENABLED=false',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','customerName','toString','üìä\x20Statistics\x20PAID\x20payments\x20count:\x20','\x20\x20\x20Total\x20paid\x20out:\x20','all','üìÖ\x20Payout\x20date\x20from\x20filter:\x20','updatePayout','getGatewayDisplayName','2FA\x20token\x20is\x20required','sort','getGatewayIdByName',',\x20successful:\x20','usdtPolygonWallet','\x20PAID\x20payments','__importDefault','MyXSpend','\x20USDT\x20(-','paidAt','üìä\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','\x20\x20\x20ÔøΩ\x20Total\x20paid\x20out:\x20','base32','Insufficient\x20balance.\x20Available:\x20','today','üîÑ\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','getGatewayInternalName','_count','awaitingPayout','\x20USDT\x20(+','\x20\x20\x20ü§î\x20Difference:\x20','toDataURL','usdcErcWallet','\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...','period','length','üîÑ\x20Converted\x20gateway\x20ID\x20\x27','map','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','üîç\x20Creating\x20payout\x20with\x20data:','dateFrom','üìã\x20Found\x20','startsWith','updateUser','failureMessage','mastercard','1854150FHtjOo','fullName','createdAt','gte','getAllPayments','\x20in\x20','\x20USDT\x20(total\x20paid\x20to\x20merchants)','ceil','speakeasy','update','7IIOihC','stringify','externalPaymentUrl','5449832oOVwgL','\x20\x20\x20üìÖ\x20Total\x20payouts\x20(this\x20month):\x20','setUTCDate','toFixed','admin','turnoverUSDT','TrapaPay\x20(','2425416CDmovJ','–ù–µ\x20—É–∫–∞–∑–∞–Ω','create','updatePaymentStatus','üìä\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','dailyRevenue','\x20USDT\x20(current\x20balance\x20in\x20DB)','üìä\x20Sorting\x20payments\x20by\x20','findMany','otpauth_url','customerIp','cointopay2','all_time','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','bcryptjs','\x20\x20\x20Payout\x20amount:\x20','\x20-\x20','üîç\x20Selected\x20polygon\x20wallet:\x20','month','üìÖ\x20Date\x20to\x20filter:\x20','enableAdmin2FA','forEach','thisMonth','periodTo','\x20to\x20','notes'];a48_0x347e=function(){return _0x5412f3;};return a48_0x347e();}function a48_0x42f0(_0x1e6d9b,_0x349c34){_0x1e6d9b=_0x1e6d9b-0x17f;const _0x347e1a=a48_0x347e();let _0x42f00f=_0x347e1a[_0x1e6d9b];return _0x42f00f;}var __importDefault=this&&this[a48_0x3818f7(0x1c4)]||function(_0x50f054){return _0x50f054&&_0x50f054['__esModule']?_0x50f054:{'default':_0x50f054};};Object[a48_0x3818f7(0x25f)](exports,a48_0x3818f7(0x27d),{'value':!![]}),exports['AdminService']=void 0x0;const database_1=__importDefault(require(a48_0x3818f7(0x263))),bcryptjs_1=__importDefault(require(a48_0x3818f7(0x204))),crypto_1=__importDefault(require(a48_0x3818f7(0x23c))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a48_0x3818f7(0x2ce))),speakeasy_1=__importDefault(require(a48_0x3818f7(0x1ea))),qrcode_1=__importDefault(require(a48_0x3818f7(0x252))),config_1=require(a48_0x3818f7(0x23b)),currencyService_1=require(a48_0x3818f7(0x220)),telegramBotService_1=require('./telegramBotService'),gateway_1=require(a48_0x3818f7(0x257));class AdminService{async[a48_0x3818f7(0x27e)](){const _0x3c41ff=a48_0x3818f7;console[_0x3c41ff(0x2c6)](_0x3c41ff(0x2a7));const _0x3ad3fc=await database_1['default'][_0x3c41ff(0x2e7)][_0x3c41ff(0x2e0)]({'_sum':{'balance':!![],'totalPaidOut':!![]}}),_0x376a48=await database_1[_0x3c41ff(0x1af)][_0x3c41ff(0x2f4)][_0x3c41ff(0x191)]({'where':{'status':_0x3c41ff(0x2bb),'gateway':{'not':_0x3c41ff(0x1a3)}}}),_0x3b6dbe=new Date(),_0x5897f9=new Date(_0x3b6dbe[_0x3c41ff(0x22f)](),_0x3b6dbe['getMonth'](),0x1),_0x34c315=new Date(_0x3b6dbe[_0x3c41ff(0x22f)](),_0x3b6dbe[_0x3c41ff(0x265)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x3e16aa=await database_1[_0x3c41ff(0x1af)][_0x3c41ff(0x24d)][_0x3c41ff(0x2e0)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x5897f9,'lte':_0x34c315},'status':_0x3c41ff(0x317)}}),_0x39a600=_0x3ad3fc[_0x3c41ff(0x18e)][_0x3c41ff(0x199)]||0x0,_0x87d75b=_0x3ad3fc['_sum'][_0x3c41ff(0x30a)]||0x0,_0x2aa1b=_0x3e16aa[_0x3c41ff(0x18e)]['amount']||0x0,_0x1dce7f={'totalPayout':Math['round'](_0x39a600*0x64)/0x64,'awaitingPayout':Math[_0x3c41ff(0x25e)](_0x87d75b*0x64)/0x64,'thisMonth':Math[_0x3c41ff(0x25e)](_0x2aa1b*0x64)/0x64,'availableBalance':Math[_0x3c41ff(0x25e)](_0x87d75b*0x64)/0x64,'totalPayments':_0x376a48};return console[_0x3c41ff(0x2c6)](_0x3c41ff(0x26d)),console[_0x3c41ff(0x2c6)](_0x3c41ff(0x284)+_0x1dce7f[_0x3c41ff(0x19a)]+_0x3c41ff(0x1e8)),console['log']('\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20'+_0x1dce7f[_0x3c41ff(0x1d0)]+'\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)'),console[_0x3c41ff(0x2c6)](_0x3c41ff(0x2a9)+_0x1dce7f['availableBalance']+_0x3c41ff(0x2af)),console[_0x3c41ff(0x2c6)](_0x3c41ff(0x18f)+_0x1dce7f['thisMonth']+_0x3c41ff(0x1a6)),console[_0x3c41ff(0x2c6)](_0x3c41ff(0x2c1)+_0x1dce7f[_0x3c41ff(0x24e)]+_0x3c41ff(0x1c3)),_0x1dce7f;}async[a48_0x3818f7(0x24c)](_0x14fa2b,_0x52436d){const _0x26b467=a48_0x3818f7;console['log'](_0x26b467(0x336)+_0x14fa2b+':',_0x52436d);const _0x112ce1=await database_1['default']['payment'][_0x26b467(0x2b1)]({'where':{'id':_0x14fa2b},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x112ce1)throw new Error(_0x26b467(0x189));const _0x5e00d9={};_0x52436d[_0x26b467(0x2aa)]!==undefined&&(_0x5e00d9[_0x26b467(0x2aa)]=_0x52436d[_0x26b467(0x2aa)]||null);_0x52436d['customerIp']!==undefined&&(_0x5e00d9[_0x26b467(0x200)]=_0x52436d[_0x26b467(0x200)]||null);_0x52436d[_0x26b467(0x28c)]!==undefined&&(_0x5e00d9[_0x26b467(0x28c)]=_0x52436d[_0x26b467(0x28c)]||null);const _0x5e29ee=await database_1['default'][_0x26b467(0x2f4)][_0x26b467(0x1eb)]({'where':{'id':_0x14fa2b},'data':{..._0x5e00d9,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x26b467(0x2c6)](_0x26b467(0x2d2)+_0x14fa2b),console['log'](_0x26b467(0x2a4)+_0x112ce1[_0x26b467(0x2aa)]+_0x26b467(0x2da)+_0x5e29ee['customerCountry']),console[_0x26b467(0x2c6)](_0x26b467(0x32e)+_0x112ce1['customerIp']+'\x20->\x20'+_0x5e29ee[_0x26b467(0x200)]),console['log'](_0x26b467(0x285)+(_0x112ce1[_0x26b467(0x28c)]?_0x26b467(0x28e):_0x26b467(0x2ed))+_0x26b467(0x2da)+(_0x5e29ee[_0x26b467(0x28c)]?_0x26b467(0x28e):_0x26b467(0x2ed))),_0x5e29ee;}async[a48_0x3818f7(0x2be)](_0x12733a,_0x51df98){const _0x434ecb=a48_0x3818f7,_0x138568=_0x51df98?new Date(_0x51df98):new Date();let _0x1c57af,_0xb68bb1;if(_0x12733a[_0x434ecb(0x1de)](_0x434ecb(0x33f))){const _0x5c13a6=_0x12733a[_0x434ecb(0x291)](_0x434ecb(0x33f),'')[_0x434ecb(0x21f)]('_');if(_0x5c13a6[_0x434ecb(0x1d7)]===0x2){const _0x7e6632=new Date(_0x5c13a6[0x0]),_0x26ed9e=new Date(_0x5c13a6[0x1]);_0x1c57af=new Date(Date[_0x434ecb(0x2e1)](_0x7e6632['getUTCFullYear'](),_0x7e6632['getUTCMonth'](),_0x7e6632[_0x434ecb(0x2c8)](),0x0,0x0,0x0,0x0)),_0xb68bb1=new Date(Date[_0x434ecb(0x2e1)](_0x26ed9e[_0x434ecb(0x212)](),_0x26ed9e['getUTCMonth'](),_0x26ed9e[_0x434ecb(0x2c8)](),0x17,0x3b,0x3b,0x3e7));}else{const _0x1318b8=new Date(Date[_0x434ecb(0x2e1)](_0x138568[_0x434ecb(0x212)](),_0x138568[_0x434ecb(0x25b)](),_0x138568['getUTCDate']()-0x1e));_0x1c57af=new Date(Date[_0x434ecb(0x2e1)](_0x1318b8[_0x434ecb(0x212)](),_0x1318b8[_0x434ecb(0x25b)](),_0x1318b8[_0x434ecb(0x2c8)](),0x0,0x0,0x0,0x0)),_0xb68bb1=new Date(Date['UTC'](_0x138568['getUTCFullYear'](),_0x138568[_0x434ecb(0x25b)](),_0x138568[_0x434ecb(0x2c8)](),0x17,0x3b,0x3b,0x3e7));}}else{switch(_0x12733a['toLowerCase']()){case _0x434ecb(0x1cc):_0x1c57af=new Date(Date[_0x434ecb(0x2e1)](_0x138568['getUTCFullYear'](),_0x138568[_0x434ecb(0x25b)](),_0x138568[_0x434ecb(0x2c8)](),0x0,0x0,0x0,0x0)),_0xb68bb1=new Date(Date[_0x434ecb(0x2e1)](_0x138568[_0x434ecb(0x212)](),_0x138568[_0x434ecb(0x25b)](),_0x138568[_0x434ecb(0x2c8)](),0x17,0x3b,0x3b,0x3e7));break;case _0x434ecb(0x28d):const _0x1f7006=new Date(_0x138568);_0x1f7006[_0x434ecb(0x1f1)](_0x1f7006['getUTCDate']()-0x1),_0x1c57af=new Date(Date[_0x434ecb(0x2e1)](_0x1f7006['getUTCFullYear'](),_0x1f7006[_0x434ecb(0x25b)](),_0x1f7006[_0x434ecb(0x2c8)](),0x0,0x0,0x0,0x0)),_0xb68bb1=new Date(Date[_0x434ecb(0x2e1)](_0x1f7006[_0x434ecb(0x212)](),_0x1f7006[_0x434ecb(0x25b)](),_0x1f7006[_0x434ecb(0x2c8)](),0x17,0x3b,0x3b,0x3e7));break;case'this_week':const _0x453a48=_0x138568['getUTCDay'](),_0x385db5=_0x453a48===0x0?-0x6:0x1-_0x453a48,_0xf6abc=_0x138568[_0x434ecb(0x2c8)]()+_0x385db5;_0x1c57af=new Date(Date['UTC'](_0x138568[_0x434ecb(0x212)](),_0x138568['getUTCMonth'](),_0xf6abc,0x0,0x0,0x0,0x0)),_0xb68bb1=new Date(Date['UTC'](_0x138568[_0x434ecb(0x212)](),_0x138568[_0x434ecb(0x25b)](),_0x138568['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case _0x434ecb(0x302):const _0x587045=new Date(Date['UTC'](_0x138568[_0x434ecb(0x212)](),_0x138568[_0x434ecb(0x25b)](),_0x138568[_0x434ecb(0x2c8)]()-0x7)),_0x49a01e=_0x587045['getUTCDay'](),_0x3388a1=_0x49a01e===0x0?-0x6:0x1-_0x49a01e,_0x29b1af=_0x587045[_0x434ecb(0x2c8)]()+_0x3388a1;_0x1c57af=new Date(Date[_0x434ecb(0x2e1)](_0x587045[_0x434ecb(0x212)](),_0x587045['getUTCMonth'](),_0x29b1af,0x0,0x0,0x0,0x0)),_0xb68bb1=new Date(Date[_0x434ecb(0x2e1)](_0x587045['getUTCFullYear'](),_0x587045[_0x434ecb(0x25b)](),_0x29b1af+0x6,0x17,0x3b,0x3b,0x3e7));break;case _0x434ecb(0x23f):_0x1c57af=new Date(Date['UTC'](_0x138568['getUTCFullYear'](),_0x138568[_0x434ecb(0x25b)](),0x1,0x0,0x0,0x0,0x0)),_0xb68bb1=new Date(Date[_0x434ecb(0x2e1)](_0x138568[_0x434ecb(0x212)](),_0x138568[_0x434ecb(0x25b)](),_0x138568[_0x434ecb(0x2c8)](),0x17,0x3b,0x3b,0x3e7));break;case _0x434ecb(0x330):_0x1c57af=new Date(Date[_0x434ecb(0x2e1)](_0x138568[_0x434ecb(0x212)](),_0x138568['getUTCMonth']()-0x1,0x1,0x0,0x0,0x0,0x0)),_0xb68bb1=new Date(Date[_0x434ecb(0x2e1)](_0x138568[_0x434ecb(0x212)](),_0x138568['getUTCMonth'](),0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x434ecb(0x202):_0x1c57af=new Date(Date['UTC'](0x7e9,0x5,0xe,0x0,0x0,0x0,0x0)),_0xb68bb1=new Date(Date['UTC'](_0x138568[_0x434ecb(0x212)](),_0x138568[_0x434ecb(0x25b)](),_0x138568['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;default:_0x1c57af=new Date(_0x138568['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);const _0x208b67=new Date(Date['UTC'](_0x138568[_0x434ecb(0x212)](),_0x138568[_0x434ecb(0x25b)](),_0x138568[_0x434ecb(0x2c8)]()-0x1e));_0x1c57af=new Date(Date[_0x434ecb(0x2e1)](_0x208b67[_0x434ecb(0x212)](),_0x208b67[_0x434ecb(0x25b)](),_0x208b67[_0x434ecb(0x2c8)](),0x0,0x0,0x0,0x0)),_0xb68bb1=new Date(Date[_0x434ecb(0x2e1)](_0x138568['getUTCFullYear'](),_0x138568[_0x434ecb(0x25b)](),_0x138568[_0x434ecb(0x2c8)](),0x17,0x3b,0x3b,0x3e7));}const _0x39e9a1={'gte':_0x1c57af,'lte':_0xb68bb1};console['log'](_0x434ecb(0x2ae)+_0x1c57af['toISOString']()+_0x434ecb(0x20e)+_0xb68bb1[_0x434ecb(0x187)]());const [_0x4c6d85,_0xa7923e,_0x3d6510,_0x310bec,_0x5286d6,_0xc5dd65,_0x569661,_0x23ef3c,_0x5d390c]=await Promise[_0x434ecb(0x1ba)]([database_1[_0x434ecb(0x1af)][_0x434ecb(0x2e7)]['count'](),database_1[_0x434ecb(0x1af)][_0x434ecb(0x2e7)][_0x434ecb(0x191)]({'where':{'status':'ACTIVE'}}),database_1[_0x434ecb(0x1af)][_0x434ecb(0x2f4)][_0x434ecb(0x191)]({'where':{'status':_0x434ecb(0x2bb),'createdAt':_0x39e9a1,'gateway':{'not':_0x434ecb(0x1a3)}}}),database_1[_0x434ecb(0x1af)]['payment']['count']({'where':{'status':_0x434ecb(0x186),'createdAt':_0x39e9a1,'gateway':{'not':_0x434ecb(0x1a3)}}}),database_1[_0x434ecb(0x1af)]['payment'][_0x434ecb(0x191)]({'where':{'status':_0x434ecb(0x277),'createdAt':_0x39e9a1,'gateway':{'not':_0x434ecb(0x1a3)}}}),database_1[_0x434ecb(0x1af)][_0x434ecb(0x2f4)][_0x434ecb(0x1fe)]({'where':{'status':_0x434ecb(0x2bb),'createdAt':_0x39e9a1,'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x434ecb(0x1af)][_0x434ecb(0x2f4)][_0x434ecb(0x1fe)]({'where':{'gateway':{'not':_0x434ecb(0x1a3)}},'take':0xa,'orderBy':{'createdAt':_0x434ecb(0x192)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x434ecb(0x1af)]['payment'][_0x434ecb(0x1fe)]({'where':{'createdAt':_0x39e9a1,'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1['default'][_0x434ecb(0x2f4)]['findMany']({'where':{'status':'PAID','gateway':{'not':'test_gateway'}},'select':{'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![]}})]);console[_0x434ecb(0x2c6)](_0x434ecb(0x1b8)+_0x3d6510);let _0x40b81d=0x0,_0x2120d2=0x0;for(const _0x5d2658 of _0xc5dd65){const _0x430746=_0x5d2658[_0x434ecb(0x282)]||0x0;_0x40b81d+=_0x430746;if(_0x5d2658[_0x434ecb(0x298)]&&_0x5d2658[_0x434ecb(0x282)]){const _0x557c8d=_0x5d2658['amountUSDT']-_0x5d2658['amountAfterGatewayCommissionUSDT'];_0x2120d2+=_0x557c8d;}}let _0x2a9fdf=0x0;for(const _0x9d9d9f of _0x5d390c){if(_0x9d9d9f[_0x434ecb(0x298)]&&_0x9d9d9f['amountUSDT']){const _0x3419f6=_0x9d9d9f[_0x434ecb(0x282)]-_0x9d9d9f[_0x434ecb(0x298)];_0x2a9fdf+=_0x3419f6;}}const _0x5749c1=_0x3d6510>0x0?_0x40b81d/_0x3d6510:0x0,_0x241361=this[_0x434ecb(0x30b)](_0x23ef3c,_0x1c57af,_0xb68bb1),_0x6d377c=await database_1['default'][_0x434ecb(0x2f4)]['count']({'where':{'createdAt':_0x39e9a1,'gateway':{'not':'test_gateway'},'status':{'notIn':[_0x434ecb(0x243),_0x434ecb(0x18a)]}}}),_0x107f3f=_0x6d377c>0x0?_0x3d6510/_0x6d377c*0x64:0x0;return{'totalShops':_0x4c6d85,'activeShops':_0xa7923e,'totalPayments':_0x6d377c,'successfulPayments':_0x3d6510,'totalAttempts':_0x6d377c,'chargebacks':_0x310bec,'refunds':_0x5286d6,'totalRevenue':Math[_0x434ecb(0x25e)](_0x40b81d*0x64)/0x64,'trapayEarnings':Math['round'](_0x2120d2*0x64)/0x64,'trapayEarningsAllTime':Math['round'](_0x2a9fdf*0x64)/0x64,'averagePaymentAmount':Math[_0x434ecb(0x25e)](_0x5749c1*0x64)/0x64,'conversionRate':Math[_0x434ecb(0x25e)](_0x107f3f*0x64)/0x64,'dailyRevenue':_0x241361[_0x434ecb(0x1fb)],'dailyPayments':_0x241361[_0x434ecb(0x228)],'recentPayments':_0x569661[_0x434ecb(0x1d9)](_0x36392b=>({'id':_0x36392b['id'],'amount':_0x36392b[_0x434ecb(0x27b)],'currency':_0x36392b['currency'],'status':_0x36392b['status'],'gateway':_0x36392b['gateway'],'shop':_0x36392b[_0x434ecb(0x2e7)],'createdAt':_0x36392b[_0x434ecb(0x1e4)]}))};}}async[a48_0x3818f7(0x2b7)](_0x1939b7){const _0x2e69d1=a48_0x3818f7;console[_0x2e69d1(0x2c6)]('üìä\x20Getting\x20merchant\x20statistics\x20with\x20filters:',_0x1939b7);let _0x20d645,_0x316a8c=new Date();if(_0x1939b7[_0x2e69d1(0x1d6)]===_0x2e69d1(0x2df)&&_0x1939b7[_0x2e69d1(0x1dc)]&&_0x1939b7['dateTo']){const _0x32e2e0=new Date(_0x1939b7['dateFrom']),_0x20d6a0=new Date(_0x1939b7[_0x2e69d1(0x337)]);_0x20d645=new Date(Date[_0x2e69d1(0x2e1)](_0x32e2e0['getUTCFullYear'](),_0x32e2e0['getUTCMonth'](),_0x32e2e0['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x316a8c=new Date(Date[_0x2e69d1(0x2e1)](_0x20d6a0[_0x2e69d1(0x212)](),_0x20d6a0[_0x2e69d1(0x25b)](),_0x20d6a0[_0x2e69d1(0x2c8)](),0x17,0x3b,0x3b,0x3e7));}else{const _0x4dd004=new Date();switch(_0x1939b7[_0x2e69d1(0x1d6)]){case _0x2e69d1(0x326):_0x20d645=new Date(_0x4dd004[_0x2e69d1(0x258)]()-0x7*0x18*0x3c*0x3c*0x3e8),_0x20d645[_0x2e69d1(0x24a)](0x0,0x0,0x0,0x0),_0x316a8c[_0x2e69d1(0x24a)](0x17,0x3b,0x3b,0x3e7);break;case _0x2e69d1(0x208):_0x20d645=new Date(Date[_0x2e69d1(0x2e1)](_0x4dd004['getUTCFullYear'](),_0x4dd004[_0x2e69d1(0x25b)](),0x1,0x0,0x0,0x0,0x0)),_0x316a8c=new Date(Date[_0x2e69d1(0x2e1)](_0x4dd004['getUTCFullYear'](),_0x4dd004['getUTCMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x2e69d1(0x2ec):_0x20d645=new Date(Date[_0x2e69d1(0x2e1)](_0x4dd004[_0x2e69d1(0x212)](),_0x4dd004[_0x2e69d1(0x25b)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x316a8c=new Date(Date['UTC'](_0x4dd004['getUTCFullYear'](),_0x4dd004[_0x2e69d1(0x25b)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x2e69d1(0x2b8):_0x20d645=new Date(_0x4dd004[_0x2e69d1(0x258)]()-0x16d*0x18*0x3c*0x3c*0x3e8),_0x20d645[_0x2e69d1(0x24a)](0x0,0x0,0x0,0x0),_0x316a8c[_0x2e69d1(0x24a)](0x17,0x3b,0x3b,0x3e7);break;case _0x2e69d1(0x1ba):default:_0x20d645=new Date(_0x2e69d1(0x33c)),_0x20d645[_0x2e69d1(0x24a)](0x0,0x0,0x0,0x0),_0x316a8c[_0x2e69d1(0x24a)](0x17,0x3b,0x3b,0x3e7);break;}}console[_0x2e69d1(0x2c6)](_0x2e69d1(0x2e3)+_0x20d645[_0x2e69d1(0x187)]()+_0x2e69d1(0x20e)+_0x316a8c[_0x2e69d1(0x187)]());const _0x4eecb7={'status':_0x2e69d1(0x2bb),'gateway':{'not':_0x2e69d1(0x1a3)},'createdAt':{'gte':_0x20d645,'lte':_0x316a8c}};_0x1939b7['shopId']&&(_0x4eecb7[_0x2e69d1(0x26a)]=_0x1939b7[_0x2e69d1(0x26a)]);const _0x5c8bb5=await database_1[_0x2e69d1(0x1af)][_0x2e69d1(0x2f4)][_0x2e69d1(0x1fe)]({'where':_0x4eecb7,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console['log'](_0x2e69d1(0x2e4)+_0x5c8bb5['length']+_0x2e69d1(0x2e8));const _0xcb5665={'gateway':{'not':_0x2e69d1(0x1a3)},'status':{'notIn':[_0x2e69d1(0x243),_0x2e69d1(0x18a)]},'createdAt':{'gte':_0x20d645,'lte':_0x316a8c}};_0x1939b7[_0x2e69d1(0x26a)]&&(_0xcb5665['shopId']=_0x1939b7[_0x2e69d1(0x26a)]);const _0x428979=await database_1[_0x2e69d1(0x1af)][_0x2e69d1(0x2f4)][_0x2e69d1(0x191)]({'where':_0xcb5665}),_0x3cfde6={..._0xcb5665,'status':_0x2e69d1(0x186)},_0x1512a4={..._0xcb5665,'status':_0x2e69d1(0x277)},[_0x55a3b1,_0x205f89]=await Promise['all']([database_1[_0x2e69d1(0x1af)][_0x2e69d1(0x2f4)]['count']({'where':_0x3cfde6}),database_1[_0x2e69d1(0x1af)][_0x2e69d1(0x2f4)]['count']({'where':_0x1512a4})]);console['log'](_0x2e69d1(0x216)+_0x428979+_0x2e69d1(0x1c1)+_0x5c8bb5['length']+_0x2e69d1(0x2bd)+_0x55a3b1+_0x2e69d1(0x18b)+_0x205f89);let _0x1383d7=0x0,_0xe0802a=0x0,_0x194c4b=0x0;const _0x3bf127={},_0x14c23e={},_0x30818c={},_0xc00b3d=new Date(_0x20d645);while(_0xc00b3d<=_0x316a8c){const _0x5c568c=_0xc00b3d[_0x2e69d1(0x187)]()[_0x2e69d1(0x21f)]('T')[0x0];_0x30818c[_0x5c568c]={'date':_0x5c568c,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0},_0xc00b3d['setUTCDate'](_0xc00b3d[_0x2e69d1(0x2c8)]()+0x1);}for(const _0x414ab4 of _0x5c8bb5){try{const _0x37e5e7=_0x414ab4[_0x2e69d1(0x282)]||0x0;if(_0x37e5e7<=0x0){console[_0x2e69d1(0x33d)](_0x2e69d1(0x224)+_0x414ab4['id']+_0x2e69d1(0x1d5));continue;}let _0x40b8a8,_0x2f83c7;if(_0x414ab4[_0x2e69d1(0x298)]!==null&&_0x414ab4['amountAfterGatewayCommissionUSDT']!==undefined)_0x40b8a8=_0x414ab4[_0x2e69d1(0x298)],_0x2f83c7=_0x37e5e7-_0x40b8a8,console[_0x2e69d1(0x2c6)](_0x2e69d1(0x2a1)+_0x414ab4['id']+':\x20'+_0x37e5e7[_0x2e69d1(0x1f2)](0x6)+'\x20USDT,\x20merchant:\x20'+_0x40b8a8[_0x2e69d1(0x1f2)](0x6)+_0x2e69d1(0x1a6));else{let _0x2a48d4={};if(_0x414ab4['shop'][_0x2e69d1(0x1ad)])try{_0x2a48d4=JSON[_0x2e69d1(0x2d0)](_0x414ab4[_0x2e69d1(0x2e7)][_0x2e69d1(0x1ad)]);}catch(_0x3ed7bf){console[_0x2e69d1(0x2ac)](_0x2e69d1(0x27c)+_0x414ab4[_0x2e69d1(0x26a)]+':',_0x3ed7bf);}let _0x1db25b=0x2d;for(const [_0x26dec5,_0x442bf9]of Object[_0x2e69d1(0x32f)](_0x2a48d4)){if(_0x26dec5['toLowerCase']()===_0x414ab4[_0x2e69d1(0x2ca)][_0x2e69d1(0x21d)]()){_0x1db25b=_0x442bf9[_0x2e69d1(0x32c)]||0x2d;break;}}_0x2f83c7=_0x37e5e7*(_0x1db25b/0x64),_0x40b8a8=_0x37e5e7-_0x2f83c7,console[_0x2e69d1(0x2c6)]('üìä\x20Calculating\x20commission\x20manually\x20for\x20payment\x20'+_0x414ab4['id']+':\x20'+_0x1db25b+_0x2e69d1(0x2d7)+_0x37e5e7[_0x2e69d1(0x1f2)](0x6)+'\x20USDT');}_0x1383d7+=_0x37e5e7,_0xe0802a+=_0x40b8a8,_0x194c4b+=_0x2f83c7;let _0x579967;_0x414ab4[_0x2e69d1(0x1b1)]!==null&&_0x414ab4[_0x2e69d1(0x1b1)]!==undefined?(_0x579967=_0x414ab4[_0x2e69d1(0x1b1)],console[_0x2e69d1(0x2c6)]('üìä\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20'+_0x414ab4['id']+':\x20'+_0x579967+'%')):(_0x579967=_0x37e5e7>0x0?_0x2f83c7/_0x37e5e7*0x64:0x0,console['log'](_0x2e69d1(0x226)+_0x414ab4['id']+':\x20'+_0x579967[_0x2e69d1(0x1f2)](0x2)+'%'));!_0x3bf127[_0x414ab4[_0x2e69d1(0x2ca)]]&&(_0x3bf127[_0x414ab4['gateway']]={'gateway':_0x414ab4[_0x2e69d1(0x2ca)],'gatewayDisplayName':this[_0x2e69d1(0x1bd)](_0x414ab4['gateway']),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x3bf127[_0x414ab4[_0x2e69d1(0x2ca)]][_0x2e69d1(0x338)]++,_0x3bf127[_0x414ab4[_0x2e69d1(0x2ca)]][_0x2e69d1(0x1f4)]+=_0x37e5e7,_0x3bf127[_0x414ab4[_0x2e69d1(0x2ca)]]['commissionUSDT']+=_0x2f83c7,_0x3bf127[_0x414ab4[_0x2e69d1(0x2ca)]][_0x2e69d1(0x2c7)]+=_0x40b8a8,_0x3bf127[_0x414ab4[_0x2e69d1(0x2ca)]][_0x2e69d1(0x211)]+=_0x579967;!_0x1939b7[_0x2e69d1(0x26a)]&&(!_0x14c23e[_0x414ab4[_0x2e69d1(0x26a)]]&&(_0x14c23e[_0x414ab4[_0x2e69d1(0x26a)]]={'shopId':_0x414ab4['shopId'],'shopName':_0x414ab4[_0x2e69d1(0x2e7)][_0x2e69d1(0x239)],'shopUsername':_0x414ab4[_0x2e69d1(0x2e7)]['username'],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x14c23e[_0x414ab4['shopId']][_0x2e69d1(0x338)]++,_0x14c23e[_0x414ab4[_0x2e69d1(0x26a)]][_0x2e69d1(0x1f4)]+=_0x37e5e7,_0x14c23e[_0x414ab4[_0x2e69d1(0x26a)]][_0x2e69d1(0x245)]+=_0x2f83c7,_0x14c23e[_0x414ab4[_0x2e69d1(0x26a)]][_0x2e69d1(0x2c7)]+=_0x40b8a8);const _0x1e697c=_0x414ab4['paidAt'][_0x2e69d1(0x187)]()[_0x2e69d1(0x21f)]('T')[0x0];_0x30818c[_0x1e697c]&&(_0x30818c[_0x1e697c][_0x2e69d1(0x2ab)]+=_0x37e5e7,_0x30818c[_0x1e697c][_0x2e69d1(0x34f)]+=_0x40b8a8,_0x30818c[_0x1e697c][_0x2e69d1(0x182)]+=_0x2f83c7,_0x30818c[_0x1e697c][_0x2e69d1(0x338)]++);}catch(_0x2fcdae){console[_0x2e69d1(0x2ac)](_0x2e69d1(0x2d9)+_0x414ab4['id']+':',_0x2fcdae);}}Object[_0x2e69d1(0x290)](_0x3bf127)['forEach'](_0x30dd4a=>{const _0x582a18=_0x2e69d1;_0x30dd4a[_0x582a18(0x23d)]=_0x30dd4a[_0x582a18(0x338)]>0x0?_0x30dd4a[_0x582a18(0x211)]/_0x30dd4a['paymentsCount']:0x0,delete _0x30dd4a['totalCommissionRate'];}),Object[_0x2e69d1(0x290)](_0x14c23e)[_0x2e69d1(0x20b)](_0x38eb14=>{const _0x495e5a=_0x2e69d1;_0x38eb14['averageCheckUSDT']=_0x38eb14[_0x495e5a(0x338)]>0x0?_0x38eb14['turnoverUSDT']/_0x38eb14[_0x495e5a(0x338)]:0x0;});let _0x1a0f3a=0x0,_0x3f8db5=0x0;if(_0x1939b7[_0x2e69d1(0x26a)]){const _0x27fc81=await database_1['default'][_0x2e69d1(0x24d)][_0x2e69d1(0x1fe)]({'where':{'shopId':_0x1939b7[_0x2e69d1(0x26a)],'status':_0x2e69d1(0x317),'createdAt':{'gte':_0x20d645,'lte':_0x316a8c}},'select':{'amount':!![]}});_0x1a0f3a=_0x27fc81[_0x2e69d1(0x256)]((_0x53c700,_0x5b5202)=>_0x53c700+_0x5b5202[_0x2e69d1(0x27b)],0x0);const _0x383376=await database_1['default'][_0x2e69d1(0x24d)][_0x2e69d1(0x1fe)]({'where':{'shopId':_0x1939b7[_0x2e69d1(0x26a)],'status':'PENDING','createdAt':{'gte':_0x20d645,'lte':_0x316a8c}},'select':{'amount':!![]}});_0x3f8db5=_0x383376[_0x2e69d1(0x256)]((_0x407441,_0x91725b)=>_0x407441+_0x91725b[_0x2e69d1(0x27b)],0x0);}const _0x272afc=_0x428979,_0x2bebd5=_0x5c8bb5[_0x2e69d1(0x1d7)],_0xb8e6c1=_0x2bebd5>0x0?_0x1383d7/_0x2bebd5:0x0,_0x2eb3f1=_0x272afc>0x0?Math[_0x2e69d1(0x25e)](_0x2bebd5/_0x272afc*0x2710)/0x64:0x0,_0x2acd92=Math['ceil']((_0x316a8c[_0x2e69d1(0x258)]()-_0x20d645[_0x2e69d1(0x258)]())/(0x3e8*0x3c*0x3c*0x18)),_0x5f43f7={'totalTurnover':Math[_0x2e69d1(0x25e)](_0x1383d7*0x64)/0x64,'merchantEarnings':Math[_0x2e69d1(0x25e)](_0xe0802a*0x64)/0x64,'gatewayEarnings':Math[_0x2e69d1(0x25e)](_0x194c4b*0x64)/0x64,'totalPaidOut':Math[_0x2e69d1(0x25e)](_0x1a0f3a*0x64)/0x64,'pendingPayout':Math[_0x2e69d1(0x25e)](_0x3f8db5*0x64)/0x64,'averageCheck':Math[_0x2e69d1(0x25e)](_0xb8e6c1*0x64)/0x64,'totalPayments':_0x272afc,'successfulPayments':_0x2bebd5,'conversionRate':_0x2eb3f1,'chargebacks':_0x55a3b1,'refunds':_0x205f89,'gatewayBreakdown':Object['values'](_0x3bf127)[_0x2e69d1(0x1d9)](_0x36f751=>({..._0x36f751,'turnoverUSDT':Math[_0x2e69d1(0x25e)](_0x36f751['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x2e69d1(0x25e)](_0x36f751[_0x2e69d1(0x245)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x36f751[_0x2e69d1(0x2c7)]*0x64)/0x64,'averageCommissionRate':Math[_0x2e69d1(0x25e)](_0x36f751[_0x2e69d1(0x23d)]*0x64)/0x64})),'merchantBreakdown':_0x1939b7['shopId']?undefined:Object['values'](_0x14c23e)[_0x2e69d1(0x1d9)](_0x24d7bb=>({..._0x24d7bb,'turnoverUSDT':Math[_0x2e69d1(0x25e)](_0x24d7bb['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x2e69d1(0x25e)](_0x24d7bb['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x2e69d1(0x25e)](_0x24d7bb[_0x2e69d1(0x2c7)]*0x64)/0x64,'paidOutUSDT':Math['round'](_0x24d7bb['paidOutUSDT']*0x64)/0x64,'averageCheckUSDT':Math[_0x2e69d1(0x25e)](_0x24d7bb[_0x2e69d1(0x347)]*0x64)/0x64})),'dailyData':Object[_0x2e69d1(0x290)](_0x30818c)[_0x2e69d1(0x1d9)](_0xd59c89=>({..._0xd59c89,'turnover':Math['round'](_0xd59c89[_0x2e69d1(0x2ab)]*0x64)/0x64,'merchantEarnings':Math['round'](_0xd59c89[_0x2e69d1(0x34f)]*0x64)/0x64,'gatewayEarnings':Math[_0x2e69d1(0x25e)](_0xd59c89['gatewayEarnings']*0x64)/0x64}))[_0x2e69d1(0x1bf)]((_0x2c0116,_0x526263)=>_0x2c0116[_0x2e69d1(0x2ea)][_0x2e69d1(0x312)](_0x526263[_0x2e69d1(0x2ea)])),'periodInfo':{'from':_0x20d645,'to':_0x316a8c,'periodType':_0x1939b7['period']||_0x2e69d1(0x2df),'daysCount':_0x2acd92}};return console[_0x2e69d1(0x2c6)]('üìä\x20Merchant\x20statistics\x20calculated:'),console[_0x2e69d1(0x2c6)]('\x20\x20\x20üí∞\x20Total\x20turnover:\x20'+_0x5f43f7[_0x2e69d1(0x295)]+'\x20USDT'),console[_0x2e69d1(0x2c6)](_0x2e69d1(0x23e)+_0x5f43f7[_0x2e69d1(0x34f)]+'\x20USDT'),console[_0x2e69d1(0x2c6)]('\x20\x20\x20üè™\x20Gateway\x20earnings:\x20'+_0x5f43f7[_0x2e69d1(0x182)]+_0x2e69d1(0x1a6)),console[_0x2e69d1(0x2c6)](_0x2e69d1(0x1c9)+_0x5f43f7[_0x2e69d1(0x199)]+'\x20USDT'),console[_0x2e69d1(0x2c6)](_0x2e69d1(0x2a3)+_0x5f43f7[_0x2e69d1(0x269)]+_0x2e69d1(0x1a6)),console['log'](_0x2e69d1(0x286)+_0x5f43f7[_0x2e69d1(0x24e)]),_0x5f43f7;}async['getMerchantsSelection'](_0x5c9aaa){const _0x12d68=a48_0x3818f7;console[_0x12d68(0x2c6)](_0x12d68(0x32b),{'hasPayoutHistory':_0x5c9aaa});let _0x16c96c={};_0x5c9aaa&&(_0x16c96c[_0x12d68(0x2d5)]={'some':{}});const _0x109cf8=await database_1[_0x12d68(0x1af)][_0x12d68(0x2e7)][_0x12d68(0x1fe)]({'where':_0x16c96c,'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x12d68(0x185)}});return console[_0x12d68(0x2c6)](_0x12d68(0x1dd)+_0x109cf8[_0x12d68(0x1d7)]+_0x12d68(0x26e)+(_0x5c9aaa?_0x12d68(0x2f2):'')),_0x109cf8['map'](_0x2b4d6a=>({'id':_0x2b4d6a['id'],'username':_0x2b4d6a[_0x12d68(0x2e9)],'name':_0x2b4d6a[_0x12d68(0x239)]}));}['getGatewayDisplayName'](_0xe9fc9e){const _0x2dac63=a48_0x3818f7,_0x5311a7={'test_gateway':_0x2dac63(0x341),'plisio':'Plisio','rapyd':'Rapyd','noda':_0x2dac63(0x2ba),'cointopay':_0x2dac63(0x195),'cointopay2':_0x2dac63(0x1a8),'klyme_eu':_0x2dac63(0x2ee),'klyme_gb':_0x2dac63(0x270),'klyme_de':_0x2dac63(0x21b),'mastercard':_0x2dac63(0x260),'visa/mastercard':_0x2dac63(0x29d),'amer':_0x2dac63(0x306),'myxspend':_0x2dac63(0x1c5),'ampay':_0x2dac63(0x1b0),'ampay_try':_0x2dac63(0x193),'sepa':'Sepa','interac':'Interac','onramp':_0x2dac63(0x320),'squirrelpay':_0x2dac63(0x299),'maxpara':'MaxPara','instaxchange':'InstaXchange','oxapay':_0x2dac63(0x1a0)};return _0x5311a7[_0xe9fc9e]||_0xe9fc9e;}[a48_0x3818f7(0x1ce)](_0x1c081d){const _0x50c841=a48_0x3818f7,_0x3d7793={'Test\x20Gateway':_0x50c841(0x1a3),'Plisio':'plisio','Rapyd':_0x50c841(0x2e5),'Noda':_0x50c841(0x30d),'CoinToPay':_0x50c841(0x289),'CoinToPay2':_0x50c841(0x201),'KLYME\x20EU':'klyme_eu','KLYME\x20GB':_0x50c841(0x33b),'KLYME\x20DE':_0x50c841(0x332),'MasterCard':_0x50c841(0x1e1)};return _0x3d7793[_0x1c081d]||_0x1c081d[_0x50c841(0x21d)]();}async[a48_0x3818f7(0x2dc)](_0xed950f){const _0x36c097=a48_0x3818f7,{page:_0x421003,limit:_0x341c4c,minAmount:_0x59c321,search:_0x2c2c1c}=_0xed950f;console[_0x36c097(0x2c6)](_0x36c097(0x1fa),_0xed950f);let _0x52fb46={};_0x2c2c1c&&(_0x52fb46[_0x36c097(0x239)]={'contains':_0x2c2c1c,'mode':_0x36c097(0x235)});const _0x48e104=await database_1['default'][_0x36c097(0x2e7)][_0x36c097(0x1fe)]({'where':_0x52fb46,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),_0x5047c4=_0x48e104['filter'](_0xe9dc61=>{const _0x5551b3=Math['floor'](_0xe9dc61['balance']*0x64)/0x64;if(_0x59c321&&_0x5551b3<_0x59c321)return![];return _0x5551b3!==0x0;});_0x5047c4[_0x36c097(0x1bf)]((_0xa5f080,_0x78e9cc)=>_0x78e9cc[_0x36c097(0x30a)]-_0xa5f080[_0x36c097(0x30a)]);const _0x169390=_0x5047c4['length'],_0x4058ed=(_0x421003-0x1)*_0x341c4c,_0x1ee746=_0x5047c4[_0x36c097(0x1a4)](_0x4058ed,_0x4058ed+_0x341c4c);console[_0x36c097(0x2c6)]('üí∞\x20Found\x20'+_0x1ee746[_0x36c097(0x1d7)]+'\x20merchants\x20with\x20rounded\x20balance\x20!=\x200.00\x20(excluding\x20balances\x20that\x20round\x20to\x200.00)');const _0x546542=await Promise[_0x36c097(0x1ba)](_0x1ee746[_0x36c097(0x1d9)](async _0x474527=>{const _0x253fdf=_0x36c097,[_0x3a8fb1,_0x527a14,_0x26abfe]=await Promise[_0x253fdf(0x1ba)]([database_1[_0x253fdf(0x1af)][_0x253fdf(0x2f4)][_0x253fdf(0x191)]({'where':{'shopId':_0x474527['id'],'status':_0x253fdf(0x2bb),'gateway':{'not':_0x253fdf(0x1a3)}}}),database_1[_0x253fdf(0x1af)]['payment'][_0x253fdf(0x1ae)]({'where':{'shopId':_0x474527['id'],'status':_0x253fdf(0x2bb),'gateway':{'not':_0x253fdf(0x1a3)}},'orderBy':{'paidAt':'asc'},'select':{'paidAt':!![]}}),database_1[_0x253fdf(0x1af)][_0x253fdf(0x2f4)][_0x253fdf(0x266)]({'by':['gateway'],'where':{'shopId':_0x474527['id'],'status':_0x253fdf(0x2bb),'gateway':{'not':'test_gateway'}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x5306f2=new Date(),_0x11a323=new Date(_0x5306f2[_0x253fdf(0x22f)](),_0x5306f2['getMonth'](),0x1),_0x47ed16=new Date(_0x5306f2['getFullYear'](),_0x5306f2[_0x253fdf(0x265)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x2e6755,_0x4b1387]=await Promise[_0x253fdf(0x1ba)]([database_1['default']['payout'][_0x253fdf(0x2e0)]({'_sum':{'amount':!![]},'where':{'shopId':_0x474527['id'],'status':_0x253fdf(0x317)}}),database_1['default'][_0x253fdf(0x24d)][_0x253fdf(0x2e0)]({'_sum':{'amount':!![]},'where':{'shopId':_0x474527['id'],'status':_0x253fdf(0x317),'createdAt':{'gte':_0x11a323,'lte':_0x47ed16}}})]),_0xc3f47a=_0x2e6755['_sum']['amount']||0x0,_0x387f25=_0x4b1387[_0x253fdf(0x18e)][_0x253fdf(0x27b)]||0x0,_0x5deb42=await Promise[_0x253fdf(0x1ba)](_0x26abfe[_0x253fdf(0x1d9)](async _0x32593e=>{const _0x3f3da6=_0x253fdf;let _0x368c7e=0x2d;if(_0x474527[_0x3f3da6(0x1ad)])try{const _0x31cf4f=JSON[_0x3f3da6(0x2d0)](_0x474527['gatewaySettings']);for(const [_0x379a01,_0x152fc2]of Object[_0x3f3da6(0x32f)](_0x31cf4f)){if(_0x379a01['toLowerCase']()===_0x32593e[_0x3f3da6(0x2ca)]['toLowerCase']()){_0x368c7e=_0x152fc2[_0x3f3da6(0x32c)]||0xa,console['log'](_0x3f3da6(0x247)+_0x32593e[_0x3f3da6(0x2ca)]+'\x20for\x20shop\x20'+_0x474527['id']+':\x20commission\x20=\x20'+_0x368c7e+'%');break;}}}catch(_0x2911d8){console[_0x3f3da6(0x2ac)]('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x474527['id']+':',_0x2911d8);}const _0x17ac6c=_0x32593e[_0x3f3da6(0x18e)]?.[_0x3f3da6(0x282)]||0x0,_0xdd71b9=_0x17ac6c*(0x1-_0x368c7e/0x64);return{'gateway':_0x32593e['gateway'],'count':_0x32593e[_0x3f3da6(0x1cf)]?.['id']||0x0,'amountUSDT':Math[_0x3f3da6(0x25e)](_0x17ac6c*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x3f3da6(0x25e)](_0xdd71b9*0x64)/0x64,'commission':_0x368c7e};})),_0x1feb74=_0x5deb42[_0x253fdf(0x256)]((_0x5728ff,_0x5c16df)=>_0x5728ff+_0x5c16df[_0x253fdf(0x282)],0x0),_0x1046a1=_0x5deb42[_0x253fdf(0x256)]((_0x5d72bc,_0x1c360c)=>_0x5d72bc+_0x1c360c[_0x253fdf(0x253)],0x0),_0x581e47=_0x474527[_0x253fdf(0x30a)];return console[_0x253fdf(0x2c6)](_0x253fdf(0x308)+_0x474527[_0x253fdf(0x2e9)]+':'),console[_0x253fdf(0x2c6)](_0x253fdf(0x197)+_0x1feb74['toFixed'](0x2)+'\x20USDT\x20(gross\x20revenue)'),console[_0x253fdf(0x2c6)]('\x20\x20\x20üîç\x20Calculated\x20after\x20commission:\x20'+_0x1046a1[_0x253fdf(0x1f2)](0x2)+_0x253fdf(0x1aa)),console[_0x253fdf(0x2c6)](_0x253fdf(0x238)+_0x581e47[_0x253fdf(0x1f2)](0x2)+_0x253fdf(0x1fc)),console[_0x253fdf(0x2c6)]('\x20\x20\x20üí∏\x20Total\x20payouts:\x20'+_0xc3f47a[_0x253fdf(0x1f2)](0x2)+_0x253fdf(0x2a6)),console[_0x253fdf(0x2c6)](_0x253fdf(0x1d2)+(_0x1046a1-_0xc3f47a-_0x581e47)[_0x253fdf(0x1f2)](0x2)+'\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)'),{'id':_0x474527['id'],'fullName':_0x474527[_0x253fdf(0x239)],'username':_0x474527[_0x253fdf(0x2e9)],'telegramId':_0x474527[_0x253fdf(0x2d6)],'merchantUrl':_0x474527[_0x253fdf(0x2a8)],'wallets':{'usdtPolygonWallet':_0x474527[_0x253fdf(0x1c2)],'usdtTrcWallet':_0x474527[_0x253fdf(0x17f)],'usdtErcWallet':_0x474527[_0x253fdf(0x31d)],'usdcPolygonWallet':_0x474527[_0x253fdf(0x232)],'usdcErcWallet':_0x474527['usdcErcWallet']},'totalAmountUSDT':Math['round'](_0x1feb74*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x1046a1*0x64)/0x64,'currentBalance':Math[_0x253fdf(0x292)](_0x581e47*0x64)/0x64,'totalPayout':Math[_0x253fdf(0x25e)](_0xc3f47a*0x64)/0x64,'thisMonth':Math['round'](_0x387f25*0x64)/0x64,'paymentsCount':_0x3a8fb1,'oldestPaymentDate':_0x527a14?.[_0x253fdf(0x1c7)]||_0x474527['createdAt'],'gatewayBreakdown':_0x5deb42};})),_0x2c282e=_0x546542['reduce']((_0x10f718,_0x1a4e3c)=>_0x10f718+_0x1a4e3c[_0x36c097(0x227)],0x0),_0x30bc00=_0x546542[_0x36c097(0x256)]((_0x4a822f,_0x95284d)=>_0x4a822f+_0x95284d[_0x36c097(0x31f)],0x0),_0x4d5cbc=_0x546542[_0x36c097(0x256)]((_0x6ab0ef,_0x68e389)=>_0x6ab0ef+_0x68e389['totalPayout'],0x0),_0x4a32e3=_0x546542[_0x36c097(0x256)]((_0x150c2f,_0x3cdc34)=>_0x150c2f+_0x3cdc34[_0x36c097(0x20c)],0x0);return console[_0x36c097(0x2c6)](_0x36c097(0x2e2)+_0x169390+_0x36c097(0x25d)),console['log']('\x20\x20\x20üí∞\x20Total\x20payments\x20turnover:\x20'+Math['round'](_0x2c282e*0x64)/0x64+_0x36c097(0x301)),console[_0x36c097(0x2c6)]('\x20\x20\x20‚úÖ\x20Total\x20net\x20balances:\x20'+Math[_0x36c097(0x25e)](_0x30bc00*0x64)/0x64+_0x36c097(0x275)),console[_0x36c097(0x2c6)]('\x20\x20\x20üí∏\x20Total\x20payouts\x20(all\x20time):\x20'+Math['round'](_0x4d5cbc*0x64)/0x64+_0x36c097(0x1a6)),console[_0x36c097(0x2c6)](_0x36c097(0x1f0)+Math[_0x36c097(0x25e)](_0x4a32e3*0x64)/0x64+'\x20USDT'),{'merchants':_0x546542,'pagination':{'page':_0x421003,'limit':_0x341c4c,'total':_0x169390,'totalPages':Math['ceil'](_0x169390/_0x341c4c)},'summary':{'totalMerchants':_0x169390,'totalAmountUSDT':Math['round'](_0x2c282e*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x36c097(0x25e)](_0x30bc00*0x64)/0x64,'totalPayout':Math[_0x36c097(0x25e)](_0x4d5cbc*0x64)/0x64,'thisMonth':Math[_0x36c097(0x25e)](_0x4a32e3*0x64)/0x64}};}async['createPayout'](_0x541ab4){const _0x12b69f=a48_0x3818f7,{shopId:_0x1ba885,amount:_0x5f2154,network:_0x258fd1,wallet:_0x49a3ef,notes:_0x26f4d6,txid:_0x9652ed,periodFrom:_0x1f177e,periodTo:_0x4088cd}=_0x541ab4,_0xf60e84=await database_1['default'][_0x12b69f(0x328)](async _0x4242bd=>{const _0x159f8f=_0x12b69f,_0x562359=await _0x4242bd[_0x159f8f(0x2e7)][_0x159f8f(0x2b1)]({'where':{'id':_0x1ba885},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x562359)throw new Error('Shop\x20not\x20found');console['log'](_0x159f8f(0x21a)+_0x562359[_0x159f8f(0x2e9)]+':'),console[_0x159f8f(0x2c6)]('\x20\x20\x20Current\x20balance:\x20'+_0x562359[_0x159f8f(0x30a)]['toFixed'](0x6)+_0x159f8f(0x1a6)),console[_0x159f8f(0x2c6)](_0x159f8f(0x205)+_0x5f2154[_0x159f8f(0x1f2)](0x6)+_0x159f8f(0x1a6)),console[_0x159f8f(0x2c6)](_0x159f8f(0x1da)+_0x562359[_0x159f8f(0x199)][_0x159f8f(0x1f2)](0x6)+_0x159f8f(0x1a6));if(_0x9652ed)console[_0x159f8f(0x2c6)](_0x159f8f(0x2d4)+_0x9652ed);const _0x1ec733=0.000001,_0x1c31a0=Number(_0x562359[_0x159f8f(0x30a)]),_0x432aba=Number(_0x5f2154);console[_0x159f8f(0x2c6)](_0x159f8f(0x2c2)),console[_0x159f8f(0x2c6)](_0x159f8f(0x2dd)+_0x562359[_0x159f8f(0x30a)]),console[_0x159f8f(0x2c6)](_0x159f8f(0x188)+_0x1c31a0),console[_0x159f8f(0x2c6)](_0x159f8f(0x223)+_0x432aba),console['log'](_0x159f8f(0x2cd)+(_0x1c31a0-_0x432aba)),console[_0x159f8f(0x2c6)](_0x159f8f(0x2ad)+_0x1ec733);if(_0x1c31a0<_0x432aba-_0x1ec733)throw new Error(_0x159f8f(0x1cb)+_0x1c31a0[_0x159f8f(0x1f2)](0x6)+_0x159f8f(0x18d)+_0x432aba[_0x159f8f(0x1f2)](0x6)+_0x159f8f(0x32d)+(_0x1c31a0-_0x432aba)[_0x159f8f(0x1f2)](0x8)+_0x159f8f(0x1a6));console['log'](_0x159f8f(0x21e));const _0x34f295=Math[_0x159f8f(0x25a)](_0x1c31a0,_0x432aba);let _0x53c4b1=_0x49a3ef;console['log'](_0x159f8f(0x229)+(_0x49a3ef||_0x159f8f(0x29f)));if(!_0x53c4b1){console[_0x159f8f(0x2c6)]('üîç\x20No\x20wallet\x20provided,\x20looking\x20up\x20from\x20shop\x20settings...');const _0x586c63=await _0x4242bd[_0x159f8f(0x2e7)][_0x159f8f(0x2b1)]({'where':{'id':_0x1ba885},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});console[_0x159f8f(0x2c6)]('üîç\x20Shop\x20wallets:',_0x586c63);if(_0x586c63)switch(_0x258fd1){case _0x159f8f(0x22d):_0x53c4b1=_0x586c63[_0x159f8f(0x1c2)]||undefined,console[_0x159f8f(0x2c6)](_0x159f8f(0x207)+_0x53c4b1);break;case _0x159f8f(0x249):_0x53c4b1=_0x586c63[_0x159f8f(0x17f)]||undefined,console[_0x159f8f(0x2c6)](_0x159f8f(0x244)+_0x53c4b1);break;case _0x159f8f(0x27f):_0x53c4b1=_0x586c63[_0x159f8f(0x31d)]||undefined,console[_0x159f8f(0x2c6)]('üîç\x20Selected\x20erc20\x20wallet:\x20'+_0x53c4b1);break;case _0x159f8f(0x1ab):_0x53c4b1=_0x586c63[_0x159f8f(0x232)]||undefined,console['log'](_0x159f8f(0x264)+_0x53c4b1);break;case _0x159f8f(0x19c):_0x53c4b1=_0x586c63[_0x159f8f(0x1d4)]||undefined,console[_0x159f8f(0x2c6)](_0x159f8f(0x2c3)+_0x53c4b1);break;}}else console[_0x159f8f(0x2c6)](_0x159f8f(0x183)+_0x53c4b1);console['log'](_0x159f8f(0x304)+_0x258fd1+':\x20'+(_0x53c4b1||'not\x20specified')),console['log'](_0x159f8f(0x1db),{'shopId':_0x1ba885,'amount':_0x34f295,'network':_0x258fd1,'wallet':_0x53c4b1,'status':_0x159f8f(0x317),'txid':_0x9652ed,'notes':_0x26f4d6,'periodFrom':_0x1f177e?new Date(_0x1f177e):null,'periodTo':_0x4088cd?new Date(_0x4088cd):null});const _0x5a812a=await _0x4242bd[_0x159f8f(0x24d)][_0x159f8f(0x1f8)]({'data':{'shopId':_0x1ba885,'amount':_0x34f295,'network':_0x258fd1,'wallet':_0x53c4b1,'status':_0x159f8f(0x317),'txid':_0x9652ed,'notes':_0x26f4d6,'periodFrom':_0x1f177e?new Date(_0x1f177e):null,'periodTo':_0x4088cd?new Date(_0x4088cd):null,'createdAt':new Date(),'paidAt':new Date()}});console[_0x159f8f(0x2c6)](_0x159f8f(0x340),{'id':_0x5a812a['id'],'wallet':_0x5a812a[_0x159f8f(0x190)],'network':_0x5a812a['network'],'amount':_0x5a812a[_0x159f8f(0x27b)]});const _0x3e6ab0=_0x1c31a0-_0x34f295,_0x1e826f=Number(_0x562359[_0x159f8f(0x199)])+_0x34f295;return await _0x4242bd[_0x159f8f(0x2e7)][_0x159f8f(0x1eb)]({'where':{'id':_0x1ba885},'data':{'balance':_0x3e6ab0,'totalPaidOut':_0x1e826f}}),console[_0x159f8f(0x2c6)]('üí∞\x20Shop\x20'+_0x562359[_0x159f8f(0x2e9)]+_0x159f8f(0x2b5)),console[_0x159f8f(0x2c6)](_0x159f8f(0x255)+_0x1c31a0[_0x159f8f(0x1f2)](0x6)+'\x20->\x20'+_0x3e6ab0[_0x159f8f(0x1f2)](0x6)+_0x159f8f(0x1c6)+_0x34f295[_0x159f8f(0x1f2)](0x6)+')'),console[_0x159f8f(0x2c6)](_0x159f8f(0x1b9)+_0x562359['totalPaidOut'][_0x159f8f(0x1f2)](0x6)+_0x159f8f(0x2da)+_0x1e826f[_0x159f8f(0x1f2)](0x6)+_0x159f8f(0x1d1)+_0x34f295['toFixed'](0x6)+')'),console[_0x159f8f(0x2c6)](_0x159f8f(0x234)+_0x34f295[_0x159f8f(0x1f2)](0x6)+'\x20USDT'),{'payout':_0x5a812a,'shop':_0x562359};});console[_0x12b69f(0x2c6)](_0x12b69f(0x333)+_0xf60e84['payout']['id']+_0x12b69f(0x30c)+_0xf60e84[_0x12b69f(0x2e7)][_0x12b69f(0x2e9)]+'\x20('+_0xf60e84[_0x12b69f(0x24d)][_0x12b69f(0x27b)][_0x12b69f(0x1f2)](0x6)+_0x12b69f(0x196));try{let _0x398118=_0x12b69f(0x1f7);if(_0xf60e84[_0x12b69f(0x24d)][_0x12b69f(0x2fa)]&&_0xf60e84['payout'][_0x12b69f(0x20d)]){const _0x211140=new Date(_0xf60e84[_0x12b69f(0x24d)][_0x12b69f(0x2fa)])[_0x12b69f(0x214)](_0x12b69f(0x2e6)),_0x1621ad=new Date(_0xf60e84['payout'][_0x12b69f(0x20d)])[_0x12b69f(0x214)](_0x12b69f(0x2e6));_0x398118=_0x211140+_0x12b69f(0x206)+_0x1621ad;}await telegramBotService_1[_0x12b69f(0x267)][_0x12b69f(0x2fc)](_0xf60e84[_0x12b69f(0x24d)][_0x12b69f(0x26a)],{'id':_0xf60e84[_0x12b69f(0x24d)]['id'],'amount':_0xf60e84['payout'][_0x12b69f(0x27b)],'network':_0xf60e84[_0x12b69f(0x24d)][_0x12b69f(0x329)],'wallet':_0xf60e84[_0x12b69f(0x24d)]['wallet'],'period':_0x398118,'createdAt':_0xf60e84[_0x12b69f(0x24d)]['createdAt'],'txid':_0xf60e84[_0x12b69f(0x24d)]['txid']}),console[_0x12b69f(0x2c6)](_0x12b69f(0x2ef)+_0xf60e84[_0x12b69f(0x24d)]['id']);}catch(_0x3a6038){console['error']('‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notification\x20for\x20payout\x20'+_0xf60e84['payout']['id']+':',_0x3a6038);}return{'id':_0xf60e84[_0x12b69f(0x24d)]['id'],'shopId':_0xf60e84[_0x12b69f(0x24d)][_0x12b69f(0x26a)],'shopName':_0xf60e84[_0x12b69f(0x2e7)][_0x12b69f(0x239)],'shopUsername':_0xf60e84[_0x12b69f(0x2e7)][_0x12b69f(0x2e9)],'amount':_0xf60e84['payout'][_0x12b69f(0x27b)],'network':_0xf60e84['payout']['network'],'wallet':_0xf60e84[_0x12b69f(0x24d)][_0x12b69f(0x190)],'status':_0xf60e84['payout']['status'],'txid':_0xf60e84[_0x12b69f(0x24d)][_0x12b69f(0x2fd)],'notes':_0xf60e84['payout']['notes'],'periodFrom':_0xf60e84[_0x12b69f(0x24d)][_0x12b69f(0x2fa)],'periodTo':_0xf60e84[_0x12b69f(0x24d)][_0x12b69f(0x20d)],'createdAt':_0xf60e84[_0x12b69f(0x24d)][_0x12b69f(0x1e4)],'paidAt':_0xf60e84[_0x12b69f(0x24d)]['paidAt']};}async[a48_0x3818f7(0x25c)](_0x447d59){const _0x370e01=a48_0x3818f7,{page:_0x23a5e7,limit:_0x47916b,shopId:_0x54d79f,network:_0x1b2c21,dateFrom:_0x54e667,dateTo:_0x4fb3f7,search:_0x1a4b4e}=_0x447d59,_0x5459e0=(_0x23a5e7-0x1)*_0x47916b,_0x3b5ba6={};_0x54d79f&&(_0x3b5ba6[_0x370e01(0x26a)]=_0x54d79f);_0x1b2c21&&(_0x3b5ba6['network']=_0x1b2c21);if(_0x54e667||_0x4fb3f7){_0x3b5ba6[_0x370e01(0x1e4)]={};if(_0x54e667){const _0x390ed1=new Date(_0x54e667);_0x390ed1[_0x370e01(0x24a)](0x0,0x0,0x0,0x1),_0x3b5ba6[_0x370e01(0x1e4)][_0x370e01(0x1e5)]=_0x390ed1,console[_0x370e01(0x2c6)](_0x370e01(0x1bb)+_0x390ed1[_0x370e01(0x187)]());}if(_0x4fb3f7){const _0x516d1d=new Date(_0x4fb3f7);_0x516d1d['setHours'](0x17,0x3b,0x3b,0x3e7),_0x3b5ba6[_0x370e01(0x1e4)][_0x370e01(0x288)]=_0x516d1d,console[_0x370e01(0x2c6)]('üìÖ\x20Payout\x20date\x20to\x20filter:\x20'+_0x516d1d[_0x370e01(0x187)]());}}_0x1a4b4e&&(_0x3b5ba6['OR']=[{'shop':{'name':{'contains':_0x1a4b4e,'mode':_0x370e01(0x235)}}},{'shop':{'username':{'contains':_0x1a4b4e,'mode':'insensitive'}}},{'notes':{'contains':_0x1a4b4e,'mode':_0x370e01(0x235)}}]);const [_0x144c33,_0xc6496d]=await Promise[_0x370e01(0x1ba)]([database_1['default'][_0x370e01(0x24d)]['findMany']({'where':_0x3b5ba6,'skip':_0x5459e0,'take':_0x47916b,'orderBy':{'createdAt':_0x370e01(0x192)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'wallet':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default']['payout'][_0x370e01(0x191)]({'where':_0x3b5ba6})]);return{'payouts':_0x144c33[_0x370e01(0x1d9)](_0xf9a4a8=>({'id':_0xf9a4a8['id'],'shopId':_0xf9a4a8[_0x370e01(0x26a)],'shopName':_0xf9a4a8[_0x370e01(0x2e7)][_0x370e01(0x239)],'shopUsername':_0xf9a4a8[_0x370e01(0x2e7)][_0x370e01(0x2e9)],'amount':_0xf9a4a8['amount'],'network':_0xf9a4a8[_0x370e01(0x329)],'wallet':_0xf9a4a8[_0x370e01(0x190)],'status':_0xf9a4a8['status'],'txid':_0xf9a4a8[_0x370e01(0x2fd)],'notes':_0xf9a4a8['notes'],'periodFrom':_0xf9a4a8[_0x370e01(0x2fa)],'periodTo':_0xf9a4a8['periodTo'],'createdAt':_0xf9a4a8[_0x370e01(0x1e4)],'paidAt':_0xf9a4a8[_0x370e01(0x1c7)]})),'pagination':{'page':_0x23a5e7,'limit':_0x47916b,'total':_0xc6496d,'totalPages':Math[_0x370e01(0x1e9)](_0xc6496d/_0x47916b)}};}async[a48_0x3818f7(0x279)](_0x29f629){const _0x5e1ac7=a48_0x3818f7,_0x293a62=await database_1[_0x5e1ac7(0x1af)]['payout'][_0x5e1ac7(0x2b1)]({'where':{'id':_0x29f629},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x293a62)return null;return{'id':_0x293a62['id'],'shopId':_0x293a62[_0x5e1ac7(0x26a)],'shopName':_0x293a62[_0x5e1ac7(0x2e7)][_0x5e1ac7(0x239)],'shopUsername':_0x293a62['shop'][_0x5e1ac7(0x2e9)],'amount':_0x293a62[_0x5e1ac7(0x27b)],'network':_0x293a62[_0x5e1ac7(0x329)],'wallet':_0x293a62[_0x5e1ac7(0x190)],'status':_0x293a62[_0x5e1ac7(0x19f)],'txid':_0x293a62[_0x5e1ac7(0x2fd)],'notes':_0x293a62[_0x5e1ac7(0x20f)],'periodFrom':_0x293a62[_0x5e1ac7(0x2fa)],'periodTo':_0x293a62['periodTo'],'createdAt':_0x293a62[_0x5e1ac7(0x1e4)],'paidAt':_0x293a62[_0x5e1ac7(0x1c7)]};}async[a48_0x3818f7(0x1a9)](_0x1394f9){const _0xd6fe3d=a48_0x3818f7;await database_1[_0xd6fe3d(0x1af)][_0xd6fe3d(0x24d)][_0xd6fe3d(0x1ac)]({'where':{'id':_0x1394f9}});}async[a48_0x3818f7(0x1bc)](_0x5222d1,_0x27f1ae){const _0x448a90=a48_0x3818f7,_0x44a5ad=await database_1[_0x448a90(0x1af)][_0x448a90(0x328)](async _0x29cd38=>{const _0x2079cd=_0x448a90,_0x5eda8b=await _0x29cd38[_0x2079cd(0x24d)][_0x2079cd(0x2b1)]({'where':{'id':_0x5222d1},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}}}});if(!_0x5eda8b)throw new Error('Payout\x20not\x20found');console[_0x2079cd(0x2c6)]('üí∞\x20Updating\x20payout\x20'+_0x5222d1+_0x2079cd(0x30c)+_0x5eda8b[_0x2079cd(0x2e7)][_0x2079cd(0x2e9)]+':'),console[_0x2079cd(0x2c6)](_0x2079cd(0x2b2)+_0x5eda8b['amount'][_0x2079cd(0x1f2)](0x6)+'\x20USDT'),console[_0x2079cd(0x2c6)](_0x2079cd(0x21c)+_0x5eda8b[_0x2079cd(0x329)]),console[_0x2079cd(0x2c6)](_0x2079cd(0x1b2)+_0x5eda8b['shop']['balance']['toFixed'](0x6)+_0x2079cd(0x1a6)),console[_0x2079cd(0x2c6)](_0x2079cd(0x303)+_0x5eda8b[_0x2079cd(0x2e7)]['totalPaidOut']['toFixed'](0x6)+'\x20USDT');let _0x5f1e88=0x0;if(_0x27f1ae[_0x2079cd(0x27b)]!==undefined){const _0x42eb1c=Number(_0x5eda8b[_0x2079cd(0x27b)]),_0xd166c2=Number(_0x27f1ae['amount']);_0x5f1e88=_0xd166c2-_0x42eb1c,console[_0x2079cd(0x2c6)](_0x2079cd(0x2c4)+_0xd166c2[_0x2079cd(0x1f2)](0x6)+_0x2079cd(0x1a6)),console[_0x2079cd(0x2c6)](_0x2079cd(0x28a)+_0x5f1e88[_0x2079cd(0x1f2)](0x6)+_0x2079cd(0x1a6));if(_0x5f1e88<0x0)console[_0x2079cd(0x2c6)](_0x2079cd(0x29b)+Math[_0x2079cd(0x22b)](_0x5f1e88)[_0x2079cd(0x1f2)](0x6)+_0x2079cd(0x346));else{if(_0x5f1e88>0x0){const _0x443e00=Number(_0x5eda8b['shop'][_0x2079cd(0x30a)]);console[_0x2079cd(0x2c6)](_0x2079cd(0x29c)+_0x5f1e88[_0x2079cd(0x1f2)](0x6)+_0x2079cd(0x309));if(_0x443e00<_0x5f1e88)throw new Error(_0x2079cd(0x24b)+_0x443e00[_0x2079cd(0x1f2)](0x6)+'\x20USDT,\x20Required:\x20'+_0x5f1e88[_0x2079cd(0x1f2)](0x6)+'\x20USDT');}}}const _0x34e5c5={};if(_0x27f1ae[_0x2079cd(0x27b)]!==undefined)_0x34e5c5[_0x2079cd(0x27b)]=_0x27f1ae['amount'];if(_0x27f1ae[_0x2079cd(0x329)]!==undefined)_0x34e5c5['network']=_0x27f1ae[_0x2079cd(0x329)];if(_0x27f1ae[_0x2079cd(0x190)]!==undefined)_0x34e5c5[_0x2079cd(0x190)]=_0x27f1ae['wallet']||null;if(_0x27f1ae[_0x2079cd(0x20f)]!==undefined)_0x34e5c5[_0x2079cd(0x20f)]=_0x27f1ae[_0x2079cd(0x20f)]||null;if(_0x27f1ae[_0x2079cd(0x2fd)]!==undefined)_0x34e5c5[_0x2079cd(0x2fd)]=_0x27f1ae[_0x2079cd(0x2fd)]||null;if(_0x27f1ae[_0x2079cd(0x2fa)]!==undefined)_0x34e5c5[_0x2079cd(0x2fa)]=_0x27f1ae[_0x2079cd(0x2fa)]?new Date(_0x27f1ae[_0x2079cd(0x2fa)]):null;if(_0x27f1ae[_0x2079cd(0x20d)]!==undefined)_0x34e5c5[_0x2079cd(0x20d)]=_0x27f1ae[_0x2079cd(0x20d)]?new Date(_0x27f1ae[_0x2079cd(0x20d)]):null;const _0x4f7e61=await _0x29cd38[_0x2079cd(0x24d)][_0x2079cd(0x1eb)]({'where':{'id':_0x5222d1},'data':_0x34e5c5,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(_0x5f1e88!==0x0){const _0x2652b0=Number(_0x5eda8b['shop']['balance']),_0xec22bd=Number(_0x5eda8b[_0x2079cd(0x2e7)]['totalPaidOut']),_0xeeb484=_0x2652b0-_0x5f1e88,_0x811d83=_0xec22bd+_0x5f1e88;await _0x29cd38[_0x2079cd(0x2e7)][_0x2079cd(0x1eb)]({'where':{'id':_0x5eda8b[_0x2079cd(0x26a)]},'data':{'balance':_0xeeb484,'totalPaidOut':_0x811d83}}),console[_0x2079cd(0x2c6)](_0x2079cd(0x225)+_0x5eda8b[_0x2079cd(0x2e7)][_0x2079cd(0x2e9)]+'\x20balance\x20updated:'),console[_0x2079cd(0x2c6)](_0x2079cd(0x255)+_0x2652b0[_0x2079cd(0x1f2)](0x6)+_0x2079cd(0x2da)+_0xeeb484[_0x2079cd(0x1f2)](0x6)+'\x20USDT'),console[_0x2079cd(0x2c6)]('\x20\x20\x20Total\x20paid\x20out:\x20'+_0xec22bd[_0x2079cd(0x1f2)](0x6)+_0x2079cd(0x2da)+_0x811d83['toFixed'](0x6)+_0x2079cd(0x1a6));}return console['log'](_0x2079cd(0x311)+_0x5222d1+_0x2079cd(0x31a)),_0x4f7e61;});return{'id':_0x44a5ad['id'],'shopId':_0x44a5ad['shopId'],'shopName':_0x44a5ad['shop'][_0x448a90(0x239)],'shopUsername':_0x44a5ad[_0x448a90(0x2e7)][_0x448a90(0x2e9)],'amount':Number(_0x44a5ad[_0x448a90(0x27b)]),'network':_0x44a5ad[_0x448a90(0x329)],'wallet':_0x44a5ad['wallet'],'status':_0x44a5ad[_0x448a90(0x19f)],'txid':_0x44a5ad[_0x448a90(0x2fd)],'notes':_0x44a5ad['notes'],'periodFrom':_0x44a5ad[_0x448a90(0x2fa)],'periodTo':_0x44a5ad['periodTo'],'createdAt':_0x44a5ad[_0x448a90(0x1e4)],'paidAt':_0x44a5ad[_0x448a90(0x1c7)]};}async[a48_0x3818f7(0x1e6)](_0x4c801e){const _0x2d11d0=a48_0x3818f7,{page:_0x345306,limit:_0x6e1d8a,status:_0x7d0dc8,gateway:_0x397b1f,shopId:_0x494808,dateFrom:_0x3ca6a9,dateTo:_0x4dd113,search:_0x175926,currency:_0x587d43,sortBy:_0x2389c5,sortOrder:_0x1f2806}=_0x4c801e,_0x5c8114=(_0x345306-0x1)*_0x6e1d8a;console[_0x2d11d0(0x2c6)](_0x2d11d0(0x33e),_0x4c801e);const _0x11da2b=await database_1[_0x2d11d0(0x1af)][_0x2d11d0(0x2f4)]['groupBy']({'by':['gateway'],'_count':{'gateway':!![]}});console['log']('üìä\x20Available\x20gateways\x20in\x20database:',_0x11da2b[_0x2d11d0(0x1d9)](_0x5696c1=>_0x5696c1[_0x2d11d0(0x2ca)]+'\x20('+_0x5696c1[_0x2d11d0(0x1cf)][_0x2d11d0(0x2ca)]+_0x2d11d0(0x344)));if(_0x397b1f){const _0x134463=_0x11da2b[_0x2d11d0(0x313)](_0xd0e6f8=>_0xd0e6f8[_0x2d11d0(0x2ca)][_0x2d11d0(0x21d)]()===_0x397b1f[_0x2d11d0(0x21d)]());!_0x134463&&_0x397b1f['toLowerCase']()!==_0x2d11d0(0x1a3)&&console[_0x2d11d0(0x2c6)]('‚ö†Ô∏è\x20Requested\x20gateway\x20\x27'+_0x397b1f+_0x2d11d0(0x233)+_0x11da2b[_0x2d11d0(0x1d9)](_0x3a7023=>_0x3a7023[_0x2d11d0(0x2ca)])[_0x2d11d0(0x297)](',\x20'));}const _0x5ab2ce={};_0x7d0dc8&&(_0x5ab2ce['status']=_0x7d0dc8[_0x2d11d0(0x2d1)]());if(!_0x397b1f)_0x5ab2ce['gateway']={'not':'test_gateway'};else{if(_0x397b1f&&(_0x397b1f[_0x2d11d0(0x21d)]()==='test_gateway'||_0x397b1f===_0x2d11d0(0x343)))_0x5ab2ce['gateway']=_0x2d11d0(0x1a3);else{let _0x3b5339=_0x397b1f;const _0x16c97e=(0x0,gateway_1['getGatewayNameById'])(_0x397b1f);if(_0x16c97e)_0x3b5339=_0x16c97e,console['log'](_0x2d11d0(0x1d8)+_0x397b1f+_0x2d11d0(0x219)+_0x3b5339+'\x27');else{const _0x1fea5a=(0x0,gateway_1[_0x2d11d0(0x1c0)])(_0x397b1f);if(_0x1fea5a){const _0x4b1ce9=(0x0,gateway_1[_0x2d11d0(0x221)])(_0x1fea5a);_0x4b1ce9&&(_0x3b5339=_0x4b1ce9,console['log'](_0x2d11d0(0x218)+_0x397b1f+'\x27\x20->\x20ID\x20\x27'+_0x1fea5a+_0x2d11d0(0x325)+_0x3b5339+'\x27'));}else console[_0x2d11d0(0x2c6)](_0x2d11d0(0x2a5)+_0x397b1f+_0x2d11d0(0x2ff));}const _0x548d37=await database_1['default'][_0x2d11d0(0x2f4)][_0x2d11d0(0x191)]({'where':{'gateway':_0x3b5339['toLowerCase']()},'take':0x1});_0x548d37===0x0?(console[_0x2d11d0(0x2c6)](_0x2d11d0(0x217)+_0x3b5339+_0x2d11d0(0x31c)+_0x397b1f+_0x2d11d0(0x2f6)),_0x5ab2ce[_0x2d11d0(0x2ca)]=_0x2d11d0(0x268)):(_0x5ab2ce[_0x2d11d0(0x2ca)]=_0x3b5339['toLowerCase'](),console[_0x2d11d0(0x2c6)]('‚úÖ\x20Using\x20gateway\x20filter:\x20\x27'+_0x3b5339+_0x2d11d0(0x31c)+_0x397b1f+'\x27)'));}}console[_0x2d11d0(0x2c6)](_0x2d11d0(0x2f1),_0x5ab2ce['gateway']);_0x494808&&(_0x5ab2ce[_0x2d11d0(0x26a)]=_0x494808);_0x587d43&&(_0x5ab2ce[_0x2d11d0(0x2cb)]=_0x587d43[_0x2d11d0(0x2d1)](),console[_0x2d11d0(0x2c6)](_0x2d11d0(0x273)+_0x587d43[_0x2d11d0(0x2d1)]()));if(_0x3ca6a9||_0x4dd113){_0x5ab2ce[_0x2d11d0(0x1e4)]={};if(_0x3ca6a9){const _0x29e83f=new Date(_0x3ca6a9),_0x4d3679=new Date(Date[_0x2d11d0(0x2e1)](_0x29e83f[_0x2d11d0(0x212)](),_0x29e83f[_0x2d11d0(0x25b)](),_0x29e83f['getUTCDate'](),0x0,0x0,0x0,0x0));_0x5ab2ce[_0x2d11d0(0x1e4)]['gte']=_0x4d3679,console[_0x2d11d0(0x2c6)](_0x2d11d0(0x236)+_0x4d3679[_0x2d11d0(0x187)]());}if(_0x4dd113){const _0x42df90=new Date(_0x4dd113),_0x12380c=new Date(Date[_0x2d11d0(0x2e1)](_0x42df90[_0x2d11d0(0x212)](),_0x42df90[_0x2d11d0(0x25b)](),_0x42df90[_0x2d11d0(0x2c8)](),0x17,0x3b,0x3b,0x3e7));_0x5ab2ce[_0x2d11d0(0x1e4)][_0x2d11d0(0x288)]=_0x12380c,console[_0x2d11d0(0x2c6)](_0x2d11d0(0x209)+_0x12380c[_0x2d11d0(0x187)]());}}_0x175926&&(_0x5ab2ce['OR']=[{'id':{'contains':_0x175926,'mode':_0x2d11d0(0x235)}},{'orderId':{'contains':_0x175926,'mode':_0x2d11d0(0x235)}},{'gatewayOrderId':{'contains':_0x175926,'mode':_0x2d11d0(0x235)}},{'customerEmail':{'contains':_0x175926,'mode':_0x2d11d0(0x235)}},{'shop':{'name':{'contains':_0x175926,'mode':_0x2d11d0(0x235)}}},{'shop':{'username':{'contains':_0x175926,'mode':'insensitive'}}}]);console[_0x2d11d0(0x2c6)](_0x2d11d0(0x19d),JSON[_0x2d11d0(0x1ed)](_0x5ab2ce,null,0x2));const _0xd7b206=await database_1['default'][_0x2d11d0(0x2f4)]['count']({'where':_0x5ab2ce});console[_0x2d11d0(0x2c6)](_0x2d11d0(0x2f5)+_0xd7b206);let _0x1d0fc1={'createdAt':_0x2d11d0(0x192)};if(_0x2389c5){const _0x7bb54a=[_0x2d11d0(0x27b),'createdAt',_0x2d11d0(0x296),_0x2d11d0(0x19f),_0x2d11d0(0x2ca),_0x2d11d0(0x2cb)],_0x34e757=['asc',_0x2d11d0(0x192)];if(_0x7bb54a[_0x2d11d0(0x2b9)](_0x2389c5)){const _0x362bf7=_0x34e757[_0x2d11d0(0x2b9)](_0x1f2806)?_0x1f2806:_0x2d11d0(0x192);_0x1d0fc1={[_0x2389c5]:_0x362bf7},console[_0x2d11d0(0x2c6)](_0x2d11d0(0x1fd)+_0x2389c5+_0x2d11d0(0x1e7)+_0x362bf7+'\x20order');}}const [_0x482c37,_0x148136]=await Promise[_0x2d11d0(0x1ba)]([database_1[_0x2d11d0(0x1af)]['payment'][_0x2d11d0(0x1fe)]({'where':_0x5ab2ce,'skip':_0x5c8114,'take':_0x6e1d8a,'orderBy':_0x1d0fc1,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x2d11d0(0x2f4)][_0x2d11d0(0x191)]({'where':_0x5ab2ce})]);let _0x1ef765,_0x5bac3d;if(_0x3ca6a9){const _0x1e41fc=new Date(_0x3ca6a9);_0x1ef765=new Date(Date[_0x2d11d0(0x2e1)](_0x1e41fc[_0x2d11d0(0x212)](),_0x1e41fc[_0x2d11d0(0x25b)](),_0x1e41fc[_0x2d11d0(0x2c8)](),0x0,0x0,0x0,0x0));}else{const _0x564be9=new Date();_0x1ef765=new Date(Date['UTC'](_0x564be9[_0x2d11d0(0x212)](),_0x564be9[_0x2d11d0(0x25b)](),_0x564be9[_0x2d11d0(0x2c8)](),0x0,0x0,0x0,0x0));}if(_0x4dd113){const _0x5c4830=new Date(_0x4dd113);_0x5bac3d=new Date(Date[_0x2d11d0(0x2e1)](_0x5c4830[_0x2d11d0(0x212)](),_0x5c4830['getUTCMonth'](),_0x5c4830['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}else{if(_0x3ca6a9){const _0x3d064d=new Date(_0x3ca6a9);_0x5bac3d=new Date(Date[_0x2d11d0(0x2e1)](_0x3d064d[_0x2d11d0(0x212)](),_0x3d064d[_0x2d11d0(0x25b)](),_0x3d064d[_0x2d11d0(0x2c8)](),0x17,0x3b,0x3b,0x3e7));}else{const _0x1ba2f6=new Date();_0x5bac3d=new Date(Date[_0x2d11d0(0x2e1)](_0x1ba2f6['getUTCFullYear'](),_0x1ba2f6[_0x2d11d0(0x25b)](),_0x1ba2f6[_0x2d11d0(0x2c8)](),0x17,0x3b,0x3b,0x3e7));}}const _0x56f3e6={'status':_0x2d11d0(0x2bb),'createdAt':{'gte':_0x1ef765,'lte':_0x5bac3d}};_0x397b1f?_0x56f3e6[_0x2d11d0(0x2ca)]=_0x5ab2ce[_0x2d11d0(0x2ca)]:_0x56f3e6[_0x2d11d0(0x2ca)]={'not':_0x2d11d0(0x1a3)};_0x494808&&(_0x56f3e6[_0x2d11d0(0x26a)]=_0x494808);_0x587d43&&(_0x56f3e6['currency']=_0x587d43['toUpperCase']());console[_0x2d11d0(0x2c6)]('üìä\x20Statistics\x20WHERE\x20conditions:',JSON[_0x2d11d0(0x1ed)](_0x56f3e6,null,0x2));const _0x4edf2e=await database_1[_0x2d11d0(0x1af)][_0x2d11d0(0x2f4)][_0x2d11d0(0x1fe)]({'where':_0x56f3e6,'select':{'amountUSDT':!![],'currency':!![],'amount':!![]}}),_0x1a2c30={};let _0x4a1747=0x0;return _0x4edf2e[_0x2d11d0(0x20b)](_0x2a9dab=>{const _0x1513e4=_0x2d11d0;_0x2a9dab['amountUSDT']&&(_0x4a1747+=_0x2a9dab['amountUSDT']);if(_0x2a9dab[_0x1513e4(0x2cb)]){const _0x398863=_0x2a9dab[_0x1513e4(0x2cb)]['toUpperCase']();!_0x1a2c30[_0x398863]&&(_0x1a2c30[_0x398863]=0x0),_0x1a2c30[_0x398863]+=_0x2a9dab[_0x1513e4(0x27b)];}}),_0x4a1747>0x0&&(_0x1a2c30['USDT']=_0x4a1747),{'payments':_0x482c37,'pagination':{'page':_0x345306,'limit':_0x6e1d8a,'total':_0x148136,'totalPages':Math[_0x2d11d0(0x1e9)](_0x148136/_0x6e1d8a)},'statistics':_0x1a2c30};}async['getPaymentById'](_0x52e710){const _0x2276ab=a48_0x3818f7,_0x56074e=await database_1[_0x2276ab(0x1af)][_0x2276ab(0x2f4)][_0x2276ab(0x2b1)]({'where':{'id':_0x52e710},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x56074e)return null;return{'id':_0x56074e['id'],'shopId':_0x56074e[_0x2276ab(0x26a)],'gateway':_0x56074e[_0x2276ab(0x2ca)],'amount':_0x56074e[_0x2276ab(0x27b)],'currency':_0x56074e['currency'],'status':_0x56074e[_0x2276ab(0x19f)],'orderId':_0x56074e[_0x2276ab(0x2b6)],'gatewayOrderId':_0x56074e[_0x2276ab(0x2bc)],'customerEmail':_0x56074e[_0x2276ab(0x314)],'customerName':_0x56074e[_0x2276ab(0x1b6)],'customerCountry':_0x56074e[_0x2276ab(0x2aa)],'customerIp':_0x56074e[_0x2276ab(0x200)],'customerUa':_0x56074e['customerUa'],'failureMessage':_0x56074e[_0x2276ab(0x1e0)],'externalPaymentUrl':_0x56074e[_0x2276ab(0x1ee)],'successUrl':_0x56074e['successUrl'],'failUrl':_0x56074e[_0x2276ab(0x1a1)],'pendingUrl':_0x56074e[_0x2276ab(0x300)],'whiteUrl':_0x56074e[_0x2276ab(0x1b3)],'createdAt':_0x56074e[_0x2276ab(0x1e4)],'updatedAt':_0x56074e[_0x2276ab(0x296)],'shop':_0x56074e[_0x2276ab(0x2e7)]};}async[a48_0x3818f7(0x1f9)](_0x1b0657,_0x57c0f7,_0x39f930,_0x560b25){const _0x561043=a48_0x3818f7,_0x158f69=await database_1[_0x561043(0x1af)][_0x561043(0x328)](async _0x124213=>{const _0x394de1=_0x561043,_0x1e77a4=await _0x124213['payment']['findUnique']({'where':{'id':_0x1b0657},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x1e77a4)throw new Error('Payment\x20not\x20found');const _0x4a1399=_0x1e77a4[_0x394de1(0x19f)],_0x4b5bd3=_0x57c0f7['toUpperCase']();console[_0x394de1(0x2c6)](_0x394de1(0x316)+_0x1b0657+_0x394de1(0x34e)+_0x4a1399+_0x394de1(0x2da)+_0x4b5bd3),console[_0x394de1(0x2c6)](_0x394de1(0x335)+_0x1e77a4[_0x394de1(0x2e7)][_0x394de1(0x30a)]+_0x394de1(0x1a6));const _0x408f38={'status':_0x4b5bd3,'updatedAt':new Date(),'statusChangedBy':_0x394de1(0x1f3),'statusChangedAt':new Date()};_0x39f930&&(_0x408f38['adminNotes']=_0x39f930);_0x4b5bd3===_0x394de1(0x186)&&_0x560b25&&(_0x408f38['chargebackAmount']=_0x560b25);let _0xbcd9cb=0x0,_0x3e1a61=_0x1e77a4[_0x394de1(0x2e7)]['balance'];if(_0x4b5bd3===_0x394de1(0x2bb)&&_0x4a1399!==_0x394de1(0x2bb)){_0x408f38['paidAt']=new Date();const _0x5a5637=await currencyService_1[_0x394de1(0x293)][_0x394de1(0x321)](_0x1e77a4[_0x394de1(0x27b)],_0x1e77a4[_0x394de1(0x2cb)]);_0x408f38[_0x394de1(0x282)]=_0x5a5637;let _0x5ceb57=0x2d;const _0x513f2b=await _0x124213[_0x394de1(0x2e7)][_0x394de1(0x2b1)]({'where':{'id':_0x1e77a4[_0x394de1(0x26a)]},'select':{'gatewaySettings':!![]}});if(_0x513f2b?.[_0x394de1(0x1ad)])try{const _0x1f5885=JSON[_0x394de1(0x2d0)](_0x513f2b[_0x394de1(0x1ad)]);for(const [_0x14b855,_0x4b3ef3]of Object['entries'](_0x1f5885)){if(_0x14b855[_0x394de1(0x21d)]()===_0x1e77a4[_0x394de1(0x2ca)][_0x394de1(0x21d)]()){_0x5ceb57=_0x4b3ef3[_0x394de1(0x32c)]||0xa;break;}}}catch(_0x3c0e5b){console[_0x394de1(0x2ac)]('Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20'+_0x1b0657+':',_0x3c0e5b);}let _0x4de625;_0x1e77a4[_0x394de1(0x298)]!==null&&_0x1e77a4[_0x394de1(0x298)]!==undefined?(_0x4de625=_0x1e77a4[_0x394de1(0x298)],console[_0x394de1(0x2c6)](_0x394de1(0x251)+_0x4de625[_0x394de1(0x1f2)](0x6)+'\x20USDT\x20for\x20payment\x20'+_0x1b0657)):(_0x4de625=_0x5a5637*(0x1-_0x5ceb57/0x64),console[_0x394de1(0x2c6)](_0x394de1(0x1c8)+_0x1b0657+':\x20'+_0x5ceb57+_0x394de1(0x2d7)+_0x5a5637[_0x394de1(0x1f2)](0x6)+'\x20USDT'),_0x408f38[_0x394de1(0x298)]=_0x4de625,_0x408f38['gatewayCommissionRate']=_0x5ceb57),_0xbcd9cb=_0x4de625,_0x3e1a61+=_0x4de625,console[_0x394de1(0x2c6)](_0x394de1(0x1a7)+_0x1b0657+_0x394de1(0x283)),console[_0x394de1(0x2c6)](_0x394de1(0x18c)+_0x5a5637[_0x394de1(0x1f2)](0x6)+_0x394de1(0x1a6)),console[_0x394de1(0x2c6)](_0x394de1(0x26f)+_0x1e77a4[_0x394de1(0x2ca)]+_0x394de1(0x2c5)+_0x5ceb57+'%'),console[_0x394de1(0x2c6)](_0x394de1(0x334)+_0x4de625[_0x394de1(0x1f2)](0x6)+'\x20USDT\x20(after\x20'+_0x5ceb57+'%\x20commission)'),console[_0x394de1(0x2c6)]('\x20\x20\x20Added\x20to\x20balance:\x20+'+_0x4de625[_0x394de1(0x1f2)](0x6)+_0x394de1(0x1a6));}else{if(_0x4a1399===_0x394de1(0x2bb)&&_0x4b5bd3!==_0x394de1(0x2bb)&&_0x4b5bd3!=='CHARGEBACK'){if(_0x1e77a4[_0x394de1(0x282)]){let _0x32214d=0x2d;const _0x2836a7=await _0x124213[_0x394de1(0x2e7)]['findUnique']({'where':{'id':_0x1e77a4[_0x394de1(0x26a)]},'select':{'gatewaySettings':!![]}});if(_0x2836a7?.[_0x394de1(0x1ad)])try{const _0x3f5277=JSON['parse'](_0x2836a7[_0x394de1(0x1ad)]);for(const [_0x168de5,_0x1c77bd]of Object[_0x394de1(0x32f)](_0x3f5277)){if(_0x168de5[_0x394de1(0x21d)]()===_0x1e77a4['gateway'][_0x394de1(0x21d)]()){_0x32214d=_0x1c77bd[_0x394de1(0x32c)]||0xa;break;}}}catch(_0x3913a3){console[_0x394de1(0x2ac)]('Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20'+_0x1b0657+':',_0x3913a3);}const _0x1ad582=_0x1e77a4[_0x394de1(0x282)]*(0x1-_0x32214d/0x64);_0xbcd9cb=-_0x1ad582,_0x3e1a61-=_0x1ad582,console[_0x394de1(0x2c6)](_0x394de1(0x18c)+_0x1e77a4[_0x394de1(0x282)][_0x394de1(0x1f2)](0x6)+_0x394de1(0x1a6)),console['log'](_0x394de1(0x26f)+_0x1e77a4['gateway']+_0x394de1(0x2c5)+_0x32214d+'%'),console[_0x394de1(0x2c6)](_0x394de1(0x240)+_0x1ad582[_0x394de1(0x1f2)](0x6)+_0x394de1(0x26c)+_0x32214d+_0x394de1(0x28b)),console[_0x394de1(0x2c6)](_0x394de1(0x294)+_0x1ad582['toFixed'](0x6)+_0x394de1(0x1a6));}}}_0x4b5bd3===_0x394de1(0x186)&&(console[_0x394de1(0x2c6)](_0x394de1(0x345)),_0x560b25&&_0x560b25>0x0?(_0xbcd9cb=-_0x560b25,_0x3e1a61-=_0x560b25,console[_0x394de1(0x2c6)](_0x394de1(0x1a2)+_0x560b25[_0x394de1(0x1f2)](0x6)+_0x394de1(0x23a)),console[_0x394de1(0x2c6)](_0x394de1(0x210))):console[_0x394de1(0x2c6)]('‚ö†Ô∏è\x20CHARGEBACK\x20without\x20penalty\x20amount\x20-\x20no\x20balance\x20change'),_0x408f38[_0x394de1(0x2c9)]=_0x560b25||0x0);_0x4b5bd3===_0x394de1(0x277)&&_0x4a1399==='PAID'&&console[_0x394de1(0x2c6)](_0x394de1(0x1cd));const _0x37753f=await _0x124213[_0x394de1(0x2f4)][_0x394de1(0x1eb)]({'where':{'id':_0x1b0657},'data':_0x408f38,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0xbcd9cb!==0x0&&(await _0x124213[_0x394de1(0x2e7)][_0x394de1(0x1eb)]({'where':{'id':_0x1e77a4[_0x394de1(0x26a)]},'data':{'balance':_0x3e1a61}}),console[_0x394de1(0x2c6)]('üí∞\x20Shop\x20'+_0x1e77a4['shopId']+'\x20balance\x20updated:\x20'+_0x1e77a4[_0x394de1(0x2e7)][_0x394de1(0x30a)]['toFixed'](0x6)+_0x394de1(0x2da)+_0x3e1a61['toFixed'](0x6)+_0x394de1(0x230)+(_0xbcd9cb>0x0?'+':'')+_0xbcd9cb[_0x394de1(0x1f2)](0x6)+')')),_0x37753f;});return{'id':_0x158f69['id'],'shopId':_0x158f69[_0x561043(0x26a)],'gateway':_0x158f69[_0x561043(0x2ca)],'amount':_0x158f69[_0x561043(0x27b)],'currency':_0x158f69[_0x561043(0x2cb)],'status':_0x158f69['status'],'orderId':_0x158f69['orderId'],'gatewayOrderId':_0x158f69['gatewayOrderId'],'customerEmail':_0x158f69[_0x561043(0x314)],'customerName':_0x158f69[_0x561043(0x1b6)],'customerCountry':_0x158f69[_0x561043(0x2aa)],'customerIp':_0x158f69['customerIp'],'customerUa':_0x158f69[_0x561043(0x28c)],'failureMessage':_0x158f69[_0x561043(0x1e0)],'adminNotes':_0x158f69['adminNotes'],'chargebackAmount':_0x158f69['chargebackAmount'],'statusChangedBy':_0x158f69[_0x561043(0x342)],'statusChangedAt':_0x158f69[_0x561043(0x250)],'createdAt':_0x158f69['createdAt'],'updatedAt':_0x158f69[_0x561043(0x296)],'shop':_0x158f69[_0x561043(0x2e7)]};}async[a48_0x3818f7(0x1df)](_0x3b0215,_0x44e79f){const _0x1f40d0=a48_0x3818f7,_0x29e23d=Math['random']()[_0x1f40d0(0x1b7)](0x24)[_0x1f40d0(0x180)](0x2,0x9);console[_0x1f40d0(0x2c6)](_0x1f40d0(0x254)+_0x29e23d+_0x1f40d0(0x2bf)+_0x3b0215);const _0x3f29e3={..._0x44e79f};_0x44e79f[_0x1f40d0(0x276)]&&_0x44e79f[_0x1f40d0(0x276)][_0x1f40d0(0x30e)]()!==''?(console[_0x1f40d0(0x2c6)]('üîê\x20['+_0x29e23d+_0x1f40d0(0x28f)+_0x3b0215),_0x3f29e3['password']=await bcryptjs_1['default'][_0x1f40d0(0x19e)](_0x44e79f[_0x1f40d0(0x276)],0xc)):(console[_0x1f40d0(0x2c6)](_0x1f40d0(0x278)+_0x29e23d+_0x1f40d0(0x349)),delete _0x3f29e3[_0x1f40d0(0x276)]);_0x44e79f[_0x1f40d0(0x1e3)]&&(_0x3f29e3['name']=_0x44e79f[_0x1f40d0(0x1e3)],delete _0x3f29e3['fullName']);_0x44e79f['telegramId']&&(_0x3f29e3[_0x1f40d0(0x2d6)]=_0x44e79f[_0x1f40d0(0x2b4)],delete _0x3f29e3['telegramId']);_0x44e79f['merchantUrl']&&(_0x3f29e3[_0x1f40d0(0x2a8)]=_0x44e79f['merchantUrl'],delete _0x3f29e3['merchantUrl']);if(_0x44e79f[_0x1f40d0(0x198)]){const _0x274aed=_0x44e79f[_0x1f40d0(0x198)][_0x1f40d0(0x1d9)](_0x289c46=>this['getGatewayInternalName'](_0x289c46));console[_0x1f40d0(0x2c6)]('üîÑ\x20Gateway\x20mapping:',_0x44e79f[_0x1f40d0(0x198)],'->',_0x274aed),_0x3f29e3['paymentGateways']=JSON['stringify'](_0x274aed),delete _0x3f29e3[_0x1f40d0(0x198)];}_0x44e79f[_0x1f40d0(0x1ad)]&&(console[_0x1f40d0(0x2c6)](_0x1f40d0(0x272)+_0x29e23d+_0x1f40d0(0x19b),_0x44e79f[_0x1f40d0(0x1ad)]),_0x3f29e3[_0x1f40d0(0x1ad)]=JSON[_0x1f40d0(0x1ed)](_0x44e79f['gatewaySettings']),console[_0x1f40d0(0x2c6)](_0x1f40d0(0x272)+_0x29e23d+']\x20Gateway\x20settings\x20JSON\x20string:',_0x3f29e3[_0x1f40d0(0x1ad)]));_0x44e79f[_0x1f40d0(0x274)]&&(_0x44e79f[_0x1f40d0(0x274)][_0x1f40d0(0x1c2)]!==undefined&&(_0x3f29e3[_0x1f40d0(0x1c2)]=_0x44e79f[_0x1f40d0(0x274)][_0x1f40d0(0x1c2)]||null),_0x44e79f[_0x1f40d0(0x274)][_0x1f40d0(0x17f)]!==undefined&&(_0x3f29e3[_0x1f40d0(0x17f)]=_0x44e79f['wallets'][_0x1f40d0(0x17f)]||null),_0x44e79f[_0x1f40d0(0x274)]['usdtErcWallet']!==undefined&&(_0x3f29e3[_0x1f40d0(0x31d)]=_0x44e79f[_0x1f40d0(0x274)][_0x1f40d0(0x31d)]||null),_0x44e79f[_0x1f40d0(0x274)][_0x1f40d0(0x232)]!==undefined&&(_0x3f29e3[_0x1f40d0(0x232)]=_0x44e79f[_0x1f40d0(0x274)][_0x1f40d0(0x232)]||null),delete _0x3f29e3[_0x1f40d0(0x274)]);const _0x23c44e=await database_1['default'][_0x1f40d0(0x2e7)][_0x1f40d0(0x1eb)]({'where':{'id':_0x3b0215},'data':_0x3f29e3,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0x1f40d0(0x2c6)](_0x1f40d0(0x2de)+_0x29e23d+_0x1f40d0(0x1b5),_0x23c44e[_0x1f40d0(0x1ad)]),{'id':_0x23c44e['id'],'fullName':_0x23c44e[_0x1f40d0(0x239)],'username':_0x23c44e[_0x1f40d0(0x2e9)],'telegramId':_0x23c44e[_0x1f40d0(0x2d6)],'merchantUrl':_0x23c44e[_0x1f40d0(0x2a8)],'gateways':_0x23c44e[_0x1f40d0(0x32a)]?JSON[_0x1f40d0(0x2d0)](_0x23c44e['paymentGateways']):null,'gatewaySettings':_0x23c44e[_0x1f40d0(0x1ad)]?JSON[_0x1f40d0(0x2d0)](_0x23c44e[_0x1f40d0(0x1ad)]):null,'publicKey':_0x23c44e[_0x1f40d0(0x29e)],'wallets':{'usdtPolygonWallet':_0x23c44e[_0x1f40d0(0x1c2)],'usdtTrcWallet':_0x23c44e[_0x1f40d0(0x17f)],'usdtErcWallet':_0x23c44e[_0x1f40d0(0x31d)],'usdcPolygonWallet':_0x23c44e[_0x1f40d0(0x232)]},'status':_0x23c44e[_0x1f40d0(0x19f)],'createdAt':_0x23c44e[_0x1f40d0(0x1e4)]};}async[a48_0x3818f7(0x305)](_0x14336e){const _0x47eb5c=a48_0x3818f7,_0x583dee=await database_1['default'][_0x47eb5c(0x2e7)][_0x47eb5c(0x1eb)]({'where':{'id':_0x14336e},'data':{'status':'SUSPENDED'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x583dee['id'],'fullName':_0x583dee[_0x47eb5c(0x239)],'username':_0x583dee['username'],'telegramId':_0x583dee['telegram'],'merchantUrl':_0x583dee[_0x47eb5c(0x2a8)],'gateways':_0x583dee['paymentGateways']?JSON['parse'](_0x583dee[_0x47eb5c(0x32a)]):null,'gatewaySettings':_0x583dee['gatewaySettings']?JSON[_0x47eb5c(0x2d0)](_0x583dee[_0x47eb5c(0x1ad)]):null,'publicKey':_0x583dee[_0x47eb5c(0x29e)],'wallets':{'usdtPolygonWallet':_0x583dee['usdtPolygonWallet'],'usdtTrcWallet':_0x583dee[_0x47eb5c(0x17f)],'usdtErcWallet':_0x583dee[_0x47eb5c(0x31d)],'usdcPolygonWallet':_0x583dee['usdcPolygonWallet']},'status':_0x583dee[_0x47eb5c(0x19f)],'createdAt':_0x583dee[_0x47eb5c(0x1e4)]};}async[a48_0x3818f7(0x2f3)](_0x9099d2){const _0x4cf879=a48_0x3818f7,_0x218527=await database_1[_0x4cf879(0x1af)][_0x4cf879(0x2e7)]['update']({'where':{'id':_0x9099d2},'data':{'status':_0x4cf879(0x27a)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x218527['id'],'fullName':_0x218527[_0x4cf879(0x239)],'username':_0x218527[_0x4cf879(0x2e9)],'telegramId':_0x218527[_0x4cf879(0x2d6)],'merchantUrl':_0x218527[_0x4cf879(0x2a8)],'gateways':_0x218527[_0x4cf879(0x32a)]?JSON[_0x4cf879(0x2d0)](_0x218527[_0x4cf879(0x32a)]):null,'gatewaySettings':_0x218527[_0x4cf879(0x1ad)]?JSON['parse'](_0x218527[_0x4cf879(0x1ad)]):null,'publicKey':_0x218527[_0x4cf879(0x29e)],'wallets':{'usdtPolygonWallet':_0x218527[_0x4cf879(0x1c2)],'usdtTrcWallet':_0x218527['usdtTrcWallet'],'usdtErcWallet':_0x218527[_0x4cf879(0x31d)],'usdcPolygonWallet':_0x218527['usdcPolygonWallet']},'status':_0x218527[_0x4cf879(0x19f)],'createdAt':_0x218527['createdAt']};}async[a48_0x3818f7(0x2fe)](_0x39cb25){const _0x12dcae=a48_0x3818f7,{page:_0x51ac3b,limit:_0x1d3abd,status:_0x33be74,search:_0x3ba21d}=_0x39cb25,_0x452f84=(_0x51ac3b-0x1)*_0x1d3abd,_0x455133={};_0x33be74&&(_0x455133[_0x12dcae(0x19f)]=_0x33be74['toUpperCase']());_0x3ba21d&&(_0x455133['OR']=[{'name':{'contains':_0x3ba21d,'mode':_0x12dcae(0x235)}},{'username':{'contains':_0x3ba21d,'mode':_0x12dcae(0x235)}},{'telegram':{'contains':_0x3ba21d,'mode':_0x12dcae(0x235)}},{'shopUrl':{'contains':_0x3ba21d,'mode':_0x12dcae(0x235)}}]);const [_0x42560d,_0x33adac]=await Promise[_0x12dcae(0x1ba)]([database_1['default'][_0x12dcae(0x2e7)][_0x12dcae(0x1fe)]({'where':_0x455133,'skip':_0x452f84,'take':_0x1d3abd,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'twoFactorEnabled':!![],'createdAt':!![],'_count':{'select':{'telegramUsers':!![]}}}}),database_1['default'][_0x12dcae(0x2e7)][_0x12dcae(0x191)]({'where':_0x455133})]);return{'users':_0x42560d[_0x12dcae(0x1d9)](_0x3e53df=>{const _0x1ae358=_0x12dcae,_0x216930=_0x3e53df[_0x1ae358(0x32a)]?JSON[_0x1ae358(0x2d0)](_0x3e53df[_0x1ae358(0x32a)]):null,_0x30fad9=_0x216930?_0x216930['map'](_0x10f743=>this['getGatewayDisplayName'](_0x10f743)):null;return{'id':_0x3e53df['id'],'fullName':_0x3e53df['name'],'username':_0x3e53df['username'],'telegramId':_0x3e53df[_0x1ae358(0x2d6)],'merchantUrl':_0x3e53df[_0x1ae358(0x2a8)],'gateways':_0x30fad9,'gatewaySettings':_0x3e53df['gatewaySettings']?JSON[_0x1ae358(0x2d0)](_0x3e53df[_0x1ae358(0x1ad)]):null,'publicKey':_0x3e53df[_0x1ae358(0x29e)],'wallets':{'usdtPolygonWallet':_0x3e53df[_0x1ae358(0x1c2)],'usdtTrcWallet':_0x3e53df['usdtTrcWallet'],'usdtErcWallet':_0x3e53df['usdtErcWallet'],'usdcPolygonWallet':_0x3e53df[_0x1ae358(0x232)],'usdcErcWallet':_0x3e53df['usdcErcWallet']},'status':_0x3e53df[_0x1ae358(0x19f)],'twoFactorEnabled':_0x3e53df[_0x1ae358(0x33a)]||![],'telegramUsersCount':_0x3e53df[_0x1ae358(0x1cf)]['telegramUsers'],'createdAt':_0x3e53df['createdAt']};}),'pagination':{'page':_0x51ac3b,'limit':_0x1d3abd,'total':_0x33adac,'totalPages':Math['ceil'](_0x33adac/_0x1d3abd)}};}async['getUserById'](_0x4f38c3){const _0x2d3875=a48_0x3818f7,_0x237529=await database_1[_0x2d3875(0x1af)][_0x2d3875(0x2e7)][_0x2d3875(0x2b1)]({'where':{'id':_0x4f38c3},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x237529)return null;const _0x1212ef=_0x237529['paymentGateways']?JSON[_0x2d3875(0x2d0)](_0x237529['paymentGateways']):null,_0x432592=_0x1212ef?_0x1212ef[_0x2d3875(0x1d9)](_0x5f30f8=>this[_0x2d3875(0x1bd)](_0x5f30f8)):null;return _0x1212ef&&_0x432592&&console[_0x2d3875(0x2c6)](_0x2d3875(0x2a2),_0x1212ef,'->',_0x432592),{'id':_0x237529['id'],'fullName':_0x237529['name'],'username':_0x237529[_0x2d3875(0x2e9)],'telegramId':_0x237529[_0x2d3875(0x2d6)],'merchantUrl':_0x237529[_0x2d3875(0x2a8)],'gateways':_0x432592,'gatewaySettings':_0x237529['gatewaySettings']?JSON['parse'](_0x237529[_0x2d3875(0x1ad)]):null,'publicKey':_0x237529[_0x2d3875(0x29e)],'wallets':{'usdtPolygonWallet':_0x237529[_0x2d3875(0x1c2)],'usdtTrcWallet':_0x237529[_0x2d3875(0x17f)],'usdtErcWallet':_0x237529[_0x2d3875(0x31d)],'usdcPolygonWallet':_0x237529[_0x2d3875(0x232)],'usdcErcWallet':_0x237529[_0x2d3875(0x1d4)]},'status':_0x237529[_0x2d3875(0x19f)],'createdAt':_0x237529['createdAt']};}async[a48_0x3818f7(0x324)](_0x4a3c70){const _0x51ae1d=a48_0x3818f7,{fullName:_0x4cc0a5,username:_0x56200e,password:_0x406d22,telegramId:_0x269c42,merchantUrl:_0x3d27ef,gateways:_0x3d9633,gatewaySettings:_0x3f7198,wallets:_0x6f7403}=_0x4a3c70,_0x2f3d56=await database_1[_0x51ae1d(0x1af)][_0x51ae1d(0x2e7)]['findUnique']({'where':{'username':_0x56200e}});if(_0x2f3d56)throw new Error('Username\x20already\x20exists');if(_0x269c42){const _0x12805e=await database_1[_0x51ae1d(0x1af)][_0x51ae1d(0x2e7)][_0x51ae1d(0x2b1)]({'where':{'telegram':_0x269c42}});if(_0x12805e)throw new Error(_0x51ae1d(0x2fb));}const _0x221746=await bcryptjs_1[_0x51ae1d(0x1af)][_0x51ae1d(0x19e)](_0x406d22,0xc),_0x465ae=_0x51ae1d(0x2a0)+crypto_1['default'][_0x51ae1d(0x259)](0x20)[_0x51ae1d(0x1b7)](_0x51ae1d(0x271)),_0x27b67c=_0x51ae1d(0x2f7)+crypto_1[_0x51ae1d(0x1af)][_0x51ae1d(0x259)](0x20)[_0x51ae1d(0x1b7)](_0x51ae1d(0x271)),_0x1376de=_0x3d9633?_0x3d9633[_0x51ae1d(0x1d9)](_0x3de495=>this[_0x51ae1d(0x1ce)](_0x3de495)):null;_0x3d9633&&_0x1376de&&console['log']('üîÑ\x20Gateway\x20mapping\x20(create):',_0x3d9633,'->',_0x1376de);const _0x44cf6e=await database_1[_0x51ae1d(0x1af)][_0x51ae1d(0x2e7)][_0x51ae1d(0x1f8)]({'data':{'name':_0x4cc0a5,'username':_0x56200e,'password':_0x221746,'telegram':_0x269c42,'shopUrl':_0x3d27ef,'paymentGateways':_0x1376de?JSON[_0x51ae1d(0x1ed)](_0x1376de):null,'gatewaySettings':_0x3f7198?JSON[_0x51ae1d(0x1ed)](_0x3f7198):null,'usdtPolygonWallet':_0x6f7403?.['usdtPolygonWallet']||null,'usdtTrcWallet':_0x6f7403?.[_0x51ae1d(0x17f)]||null,'usdtErcWallet':_0x6f7403?.[_0x51ae1d(0x31d)]||null,'usdcPolygonWallet':_0x6f7403?.[_0x51ae1d(0x232)]||null,'publicKey':_0x465ae,'secretKey':_0x27b67c,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x44cf6e['id'],'fullName':_0x44cf6e[_0x51ae1d(0x239)],'username':_0x44cf6e[_0x51ae1d(0x2e9)],'telegramId':_0x44cf6e['telegram'],'merchantUrl':_0x44cf6e[_0x51ae1d(0x2a8)],'gateways':_0x44cf6e[_0x51ae1d(0x32a)]?JSON['parse'](_0x44cf6e[_0x51ae1d(0x32a)]):null,'gatewaySettings':_0x44cf6e['gatewaySettings']?JSON[_0x51ae1d(0x2d0)](_0x44cf6e[_0x51ae1d(0x1ad)]):null,'publicKey':_0x44cf6e[_0x51ae1d(0x29e)],'wallets':{'usdtPolygonWallet':_0x44cf6e[_0x51ae1d(0x1c2)],'usdtTrcWallet':_0x44cf6e[_0x51ae1d(0x17f)],'usdtErcWallet':_0x44cf6e[_0x51ae1d(0x31d)],'usdcPolygonWallet':_0x44cf6e[_0x51ae1d(0x232)]},'status':_0x44cf6e['status'],'createdAt':_0x44cf6e['createdAt']};}async[a48_0x3818f7(0x262)](_0x355727,_0x4d3535){const _0x4d2bf4=a48_0x3818f7;if(config_1[_0x4d2bf4(0x30f)][_0x4d2bf4(0x1f3)][_0x4d2bf4(0x33a)]){if(!_0x4d3535)throw new Error(_0x4d2bf4(0x1be));const _0x419564=speakeasy_1[_0x4d2bf4(0x1af)][_0x4d2bf4(0x34a)][_0x4d2bf4(0x215)]({'secret':config_1[_0x4d2bf4(0x30f)]['admin'][_0x4d2bf4(0x2eb)],'encoding':_0x4d2bf4(0x1ca),'token':_0x4d3535,'window':0x2});if(!_0x419564){let _0x2be576=![];if(config_1[_0x4d2bf4(0x30f)][_0x4d2bf4(0x1f3)][_0x4d2bf4(0x231)]){const _0x31e68b=JSON[_0x4d2bf4(0x2d0)](config_1[_0x4d2bf4(0x30f)][_0x4d2bf4(0x1f3)][_0x4d2bf4(0x231)]);for(let _0x2a64b5=0x0;_0x2a64b5<_0x31e68b[_0x4d2bf4(0x1d7)];_0x2a64b5++){const _0x43b9e7=await bcryptjs_1[_0x4d2bf4(0x1af)]['compare'](_0x4d3535,_0x31e68b[_0x2a64b5]);if(_0x43b9e7){_0x2be576=!![],_0x31e68b[_0x4d2bf4(0x22c)](_0x2a64b5,0x1),config_1[_0x4d2bf4(0x30f)][_0x4d2bf4(0x1f3)][_0x4d2bf4(0x231)]=JSON[_0x4d2bf4(0x1ed)](_0x31e68b);const _0x135690=path_1[_0x4d2bf4(0x1af)][_0x4d2bf4(0x297)](process[_0x4d2bf4(0x2f0)](),_0x4d2bf4(0x322));if(fs_1['default'][_0x4d2bf4(0x2c0)](_0x135690)){let _0x8867ad=fs_1[_0x4d2bf4(0x1af)]['readFileSync'](_0x135690,'utf8');const _0x3f38d0=_0x8867ad[_0x4d2bf4(0x21f)]('\x0a');for(let _0x3c477e=0x0;_0x3c477e<_0x3f38d0[_0x4d2bf4(0x1d7)];_0x3c477e++){if(_0x3f38d0[_0x3c477e][_0x4d2bf4(0x1de)](_0x4d2bf4(0x248))){_0x3f38d0[_0x3c477e]='ADMIN_BACKUP_CODES='+JSON[_0x4d2bf4(0x1ed)](_0x31e68b);break;}}fs_1[_0x4d2bf4(0x1af)][_0x4d2bf4(0x261)](_0x135690,_0x3f38d0[_0x4d2bf4(0x297)]('\x0a'),_0x4d2bf4(0x281));}break;}}}if(!_0x2be576)throw new Error('Invalid\x202FA\x20token\x20or\x20backup\x20code');}}await database_1['default']['shop'][_0x4d2bf4(0x1ac)]({'where':{'id':_0x355727}});}async['getShopWallets'](_0x1f33c5){const _0x45f3c3=a48_0x3818f7,_0x48d49b=await database_1[_0x45f3c3(0x1af)]['shop'][_0x45f3c3(0x2b1)]({'where':{'id':_0x1f33c5},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});if(!_0x48d49b)throw new Error(_0x45f3c3(0x287));return{'usdtPolygonWallet':_0x48d49b[_0x45f3c3(0x1c2)],'usdtTrcWallet':_0x48d49b[_0x45f3c3(0x17f)],'usdtErcWallet':_0x48d49b[_0x45f3c3(0x31d)],'usdcPolygonWallet':_0x48d49b[_0x45f3c3(0x232)],'usdcErcWallet':_0x48d49b[_0x45f3c3(0x1d4)]};}[a48_0x3818f7(0x237)](_0x45c599=0x8){const _0x9b9082=a48_0x3818f7,_0x14b65f=[];for(let _0x2dfc20=0x0;_0x2dfc20<_0x45c599;_0x2dfc20++){const _0x54fd5a=crypto_1[_0x9b9082(0x1af)]['randomBytes'](0x4)[_0x9b9082(0x1b7)](_0x9b9082(0x271))[_0x9b9082(0x2d1)]();_0x14b65f[_0x9b9082(0x280)](_0x54fd5a);}return _0x14b65f;}async[a48_0x3818f7(0x319)](_0x1267f4){const _0x546ea1=a48_0x3818f7,_0x31e1e6=await database_1[_0x546ea1(0x1af)][_0x546ea1(0x2e7)][_0x546ea1(0x2b1)]({'where':{'id':_0x1267f4},'select':{'id':!![],'name':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x31e1e6)throw new Error(_0x546ea1(0x287));const _0x1c750e=speakeasy_1[_0x546ea1(0x1af)][_0x546ea1(0x241)]({'name':_0x546ea1(0x1f5)+_0x31e1e6[_0x546ea1(0x2e9)]+')','issuer':'TrapaPay','length':0x20}),_0x5a19c7=await qrcode_1[_0x546ea1(0x1af)]['toDataURL'](_0x1c750e[_0x546ea1(0x1ff)]),_0x5719c5=this['generateBackupCodes'](0x8),_0x503452=await Promise['all'](_0x5719c5[_0x546ea1(0x1d9)](_0xad4ca7=>bcryptjs_1[_0x546ea1(0x1af)][_0x546ea1(0x19e)](_0xad4ca7,0xa)));return await database_1[_0x546ea1(0x1af)][_0x546ea1(0x2e7)]['update']({'where':{'id':_0x1267f4},'data':{'twoFactorSecret':_0x1c750e[_0x546ea1(0x1ca)],'backupCodes':JSON[_0x546ea1(0x1ed)](_0x503452)}}),console[_0x546ea1(0x2c6)](_0x546ea1(0x1a5)+_0x31e1e6[_0x546ea1(0x2e9)]),console[_0x546ea1(0x2c6)](_0x546ea1(0x31b)+_0x5719c5['length']+_0x546ea1(0x2cf)),{'secret':_0x1c750e['base32'],'qrCode':_0x5a19c7,'manualEntryKey':_0x1c750e[_0x546ea1(0x1ca)],'backupCodes':_0x5719c5};}async['enable2FA'](_0x15b877,_0x5e8758){const _0x5bbe30=a48_0x3818f7,_0x481a38=await database_1[_0x5bbe30(0x1af)][_0x5bbe30(0x2e7)]['findUnique']({'where':{'id':_0x15b877},'select':{'id':!![],'username':!![],'twoFactorSecret':!![],'twoFactorEnabled':!![]}});if(!_0x481a38)throw new Error(_0x5bbe30(0x287));if(!_0x481a38['twoFactorSecret'])throw new Error('2FA\x20not\x20set\x20up.\x20Please\x20call\x20setup\x20endpoint\x20first');if(_0x481a38[_0x5bbe30(0x33a)])throw new Error(_0x5bbe30(0x213));const _0x5670f0=speakeasy_1['default'][_0x5bbe30(0x34a)]['verify']({'secret':_0x481a38[_0x5bbe30(0x2eb)],'encoding':_0x5bbe30(0x1ca),'token':_0x5e8758,'window':0x2});if(!_0x5670f0)throw new Error(_0x5bbe30(0x2b3));return await database_1['default']['shop'][_0x5bbe30(0x1eb)]({'where':{'id':_0x15b877},'data':{'twoFactorEnabled':!![]}}),console[_0x5bbe30(0x2c6)]('üîê\x202FA\x20enabled\x20for\x20shop:\x20'+_0x481a38[_0x5bbe30(0x2e9)]),{'enabled':!![]};}async[a48_0x3818f7(0x24f)](_0x25f4b0){const _0x10b14d=a48_0x3818f7,_0x361a89=await database_1[_0x10b14d(0x1af)][_0x10b14d(0x2e7)]['findUnique']({'where':{'id':_0x25f4b0},'select':{'id':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x361a89)throw new Error(_0x10b14d(0x287));await database_1[_0x10b14d(0x1af)]['shop'][_0x10b14d(0x1eb)]({'where':{'id':_0x25f4b0},'data':{'twoFactorEnabled':![],'twoFactorSecret':null,'backupCodes':null}}),console[_0x10b14d(0x2c6)](_0x10b14d(0x26b)+_0x361a89[_0x10b14d(0x2e9)]);}async['changeAdminPassword'](_0x5f55a2,_0x3be30,_0x28fdaa,_0x5f2043){const _0x132adf=a48_0x3818f7;if(_0x3be30!==_0x28fdaa)throw new Error(_0x132adf(0x203));if(_0x3be30[_0x132adf(0x1d7)]<0x6)throw new Error(_0x132adf(0x194));const _0x57ee9f=await bcryptjs_1[_0x132adf(0x1af)][_0x132adf(0x181)](_0x5f55a2,config_1[_0x132adf(0x30f)]['admin'][_0x132adf(0x246)]);if(!_0x57ee9f)throw new Error('Current\x20password\x20is\x20incorrect');if(config_1[_0x132adf(0x30f)][_0x132adf(0x1f3)][_0x132adf(0x33a)]){if(!_0x5f2043)throw new Error('2FA\x20token\x20is\x20required');const _0x1aa340=speakeasy_1[_0x132adf(0x1af)][_0x132adf(0x34a)][_0x132adf(0x215)]({'secret':config_1[_0x132adf(0x30f)]['admin'][_0x132adf(0x2eb)],'encoding':_0x132adf(0x1ca),'token':_0x5f2043,'window':0x2});if(!_0x1aa340){let _0x3044f1=![];if(config_1[_0x132adf(0x30f)][_0x132adf(0x1f3)]['backupCodes']){const _0x13a161=JSON['parse'](config_1[_0x132adf(0x30f)][_0x132adf(0x1f3)][_0x132adf(0x231)]);for(let _0x432eb8=0x0;_0x432eb8<_0x13a161[_0x132adf(0x1d7)];_0x432eb8++){const _0x522ca2=await bcryptjs_1['default'][_0x132adf(0x181)](_0x5f2043,_0x13a161[_0x432eb8]);if(_0x522ca2){_0x3044f1=!![],_0x13a161[_0x132adf(0x22c)](_0x432eb8,0x1),config_1[_0x132adf(0x30f)][_0x132adf(0x1f3)][_0x132adf(0x231)]=JSON['stringify'](_0x13a161);const _0x2d0bb8=path_1[_0x132adf(0x1af)][_0x132adf(0x297)](process[_0x132adf(0x2f0)](),'.env');if(fs_1[_0x132adf(0x1af)]['existsSync'](_0x2d0bb8)){let _0x16e4d8=fs_1['default'][_0x132adf(0x2db)](_0x2d0bb8,_0x132adf(0x281));const _0xefeee9=_0x16e4d8[_0x132adf(0x21f)]('\x0a');for(let _0x4da2b2=0x0;_0x4da2b2<_0xefeee9[_0x132adf(0x1d7)];_0x4da2b2++){if(_0xefeee9[_0x4da2b2]['startsWith'](_0x132adf(0x248))){_0xefeee9[_0x4da2b2]=_0x132adf(0x248)+JSON[_0x132adf(0x1ed)](_0x13a161);break;}}fs_1['default'][_0x132adf(0x261)](_0x2d0bb8,_0xefeee9[_0x132adf(0x297)]('\x0a'),_0x132adf(0x281));}break;}}}if(!_0x3044f1)throw new Error(_0x132adf(0x348));}}const _0x103c6f=await bcryptjs_1[_0x132adf(0x1af)][_0x132adf(0x19e)](_0x3be30,0xc);config_1[_0x132adf(0x30f)][_0x132adf(0x1f3)][_0x132adf(0x246)]=_0x103c6f;const _0x2fc25a=path_1['default'][_0x132adf(0x297)](process[_0x132adf(0x2f0)](),_0x132adf(0x322));let _0x28e2aa='';if(fs_1[_0x132adf(0x1af)][_0x132adf(0x2c0)](_0x2fc25a)){_0x28e2aa=fs_1[_0x132adf(0x1af)][_0x132adf(0x2db)](_0x2fc25a,_0x132adf(0x281));const _0x13b442=_0x28e2aa['split']('\x0a');let _0x276f92=![];for(let _0x1b5df4=0x0;_0x1b5df4<_0x13b442['length'];_0x1b5df4++){if(_0x13b442[_0x1b5df4][_0x132adf(0x1de)](_0x132adf(0x34c))){_0x13b442[_0x1b5df4]=_0x132adf(0x34c)+_0x103c6f,_0x276f92=!![];break;}}!_0x276f92&&_0x13b442[_0x132adf(0x280)](_0x132adf(0x34c)+_0x103c6f),_0x28e2aa=_0x13b442[_0x132adf(0x297)]('\x0a'),fs_1[_0x132adf(0x1af)][_0x132adf(0x261)](_0x2fc25a,_0x28e2aa,_0x132adf(0x281));}console[_0x132adf(0x2c6)](_0x132adf(0x318));}async[a48_0x3818f7(0x310)](){const _0x2f2a01=a48_0x3818f7;let _0x3e1e2d=0x0;if(config_1['config']['admin'][_0x2f2a01(0x231)])try{const _0x5b9b30=JSON[_0x2f2a01(0x2d0)](config_1[_0x2f2a01(0x30f)][_0x2f2a01(0x1f3)][_0x2f2a01(0x231)]);_0x3e1e2d=_0x5b9b30[_0x2f2a01(0x1d7)];}catch(_0x20e92f){console['error']('Error\x20parsing\x20backup\x20codes:',_0x20e92f);}return{'twoFactorEnabled':config_1['config'][_0x2f2a01(0x1f3)][_0x2f2a01(0x33a)],'backupCodesCount':_0x3e1e2d};}async['setupAdmin2FA'](){const _0x41658d=a48_0x3818f7,_0x2b28a9=speakeasy_1[_0x41658d(0x1af)]['generateSecret']({'name':_0x41658d(0x339)+config_1[_0x41658d(0x30f)][_0x41658d(0x1f3)]['username']+')','issuer':_0x41658d(0x2f9),'length':0x20}),_0x5bd8dc=await qrcode_1[_0x41658d(0x1af)][_0x41658d(0x1d3)](_0x2b28a9['otpauth_url']),_0x27da83=[];for(let _0x4ff712=0x0;_0x4ff712<0x8;_0x4ff712++){const _0x1acc1a=crypto_1[_0x41658d(0x1af)][_0x41658d(0x259)](0x4)[_0x41658d(0x1b7)](_0x41658d(0x271))[_0x41658d(0x2d1)]();_0x27da83[_0x41658d(0x280)](_0x1acc1a);}const _0x4fcb63=await Promise['all'](_0x27da83[_0x41658d(0x1d9)](_0xcce89f=>bcryptjs_1['default'][_0x41658d(0x19e)](_0xcce89f,0xa)));config_1[_0x41658d(0x30f)][_0x41658d(0x1f3)]['twoFactorSecret']=_0x2b28a9[_0x41658d(0x1ca)],config_1['config'][_0x41658d(0x1f3)][_0x41658d(0x231)]=JSON[_0x41658d(0x1ed)](_0x4fcb63);const _0x307650=path_1[_0x41658d(0x1af)][_0x41658d(0x297)](process['cwd'](),_0x41658d(0x322));if(fs_1[_0x41658d(0x1af)]['existsSync'](_0x307650)){let _0x4177c7=fs_1[_0x41658d(0x1af)][_0x41658d(0x2db)](_0x307650,_0x41658d(0x281));const _0x58c139=_0x4177c7['split']('\x0a');let _0xf74646=![],_0x35b1f6=![];for(let _0x48ce71=0x0;_0x48ce71<_0x58c139[_0x41658d(0x1d7)];_0x48ce71++){_0x58c139[_0x48ce71][_0x41658d(0x1de)]('ADMIN_2FA_SECRET=')&&(_0x58c139[_0x48ce71]=_0x41658d(0x29a)+_0x2b28a9[_0x41658d(0x1ca)],_0xf74646=!![]),_0x58c139[_0x48ce71][_0x41658d(0x1de)](_0x41658d(0x248))&&(_0x58c139[_0x48ce71]=_0x41658d(0x248)+JSON[_0x41658d(0x1ed)](_0x4fcb63),_0x35b1f6=!![]);}if(!_0xf74646)_0x58c139['push']('ADMIN_2FA_SECRET='+_0x2b28a9[_0x41658d(0x1ca)]);if(!_0x35b1f6)_0x58c139[_0x41658d(0x280)](_0x41658d(0x248)+JSON['stringify'](_0x4fcb63));fs_1[_0x41658d(0x1af)][_0x41658d(0x261)](_0x307650,_0x58c139[_0x41658d(0x297)]('\x0a'),_0x41658d(0x281));}return console['log'](_0x41658d(0x307)),console['log'](_0x41658d(0x31b)+_0x27da83[_0x41658d(0x1d7)]+_0x41658d(0x2cf)),{'secret':_0x2b28a9['base32'],'qrCode':_0x5bd8dc,'manualEntryKey':_0x2b28a9['base32'],'backupCodes':_0x27da83};}async[a48_0x3818f7(0x20a)](_0x27e330){const _0xf69845=a48_0x3818f7;if(!config_1['config'][_0xf69845(0x1f3)][_0xf69845(0x2eb)])throw new Error(_0xf69845(0x315));if(config_1[_0xf69845(0x30f)][_0xf69845(0x1f3)][_0xf69845(0x33a)])throw new Error(_0xf69845(0x213));const _0x5a8576=speakeasy_1[_0xf69845(0x1af)]['totp'][_0xf69845(0x215)]({'secret':config_1['config'][_0xf69845(0x1f3)][_0xf69845(0x2eb)],'encoding':_0xf69845(0x1ca),'token':_0x27e330,'window':0x2});if(!_0x5a8576)throw new Error('Invalid\x202FA\x20token');config_1[_0xf69845(0x30f)][_0xf69845(0x1f3)][_0xf69845(0x33a)]=!![];const _0x43f380=path_1[_0xf69845(0x1af)][_0xf69845(0x297)](process[_0xf69845(0x2f0)](),_0xf69845(0x322));if(fs_1['default']['existsSync'](_0x43f380)){let _0x1b8cbe=fs_1[_0xf69845(0x1af)][_0xf69845(0x2db)](_0x43f380,_0xf69845(0x281));const _0x2cb50d=_0x1b8cbe[_0xf69845(0x21f)]('\x0a');let _0x221c57=![];for(let _0xcdcbd3=0x0;_0xcdcbd3<_0x2cb50d['length'];_0xcdcbd3++){if(_0x2cb50d[_0xcdcbd3][_0xf69845(0x1de)](_0xf69845(0x222))){_0x2cb50d[_0xcdcbd3]=_0xf69845(0x2f8),_0x221c57=!![];break;}}if(!_0x221c57)_0x2cb50d[_0xf69845(0x280)](_0xf69845(0x2f8));fs_1['default']['writeFileSync'](_0x43f380,_0x2cb50d[_0xf69845(0x297)]('\x0a'),_0xf69845(0x281));}return console[_0xf69845(0x2c6)](_0xf69845(0x323)),{'enabled':!![]};}async['disableAdmin2FA'](){const _0x5e8453=a48_0x3818f7;config_1[_0x5e8453(0x30f)][_0x5e8453(0x1f3)][_0x5e8453(0x33a)]=![],config_1[_0x5e8453(0x30f)][_0x5e8453(0x1f3)][_0x5e8453(0x2eb)]='',config_1[_0x5e8453(0x30f)]['admin'][_0x5e8453(0x231)]='';const _0x5ed369=path_1['default'][_0x5e8453(0x297)](process[_0x5e8453(0x2f0)](),_0x5e8453(0x322));if(fs_1[_0x5e8453(0x1af)][_0x5e8453(0x2c0)](_0x5ed369)){let _0x1971d2=fs_1['default'][_0x5e8453(0x2db)](_0x5ed369,'utf8');const _0x560921=_0x1971d2['split']('\x0a');for(let _0x12a035=0x0;_0x12a035<_0x560921[_0x5e8453(0x1d7)];_0x12a035++){_0x560921[_0x12a035]['startsWith'](_0x5e8453(0x222))&&(_0x560921[_0x12a035]=_0x5e8453(0x1b4)),_0x560921[_0x12a035][_0x5e8453(0x1de)]('ADMIN_2FA_SECRET=')&&(_0x560921[_0x12a035]=_0x5e8453(0x29a)),_0x560921[_0x12a035][_0x5e8453(0x1de)](_0x5e8453(0x248))&&(_0x560921[_0x12a035]='ADMIN_BACKUP_CODES=');}fs_1['default'][_0x5e8453(0x261)](_0x5ed369,_0x560921[_0x5e8453(0x297)]('\x0a'),_0x5e8453(0x281));}console[_0x5e8453(0x2c6)]('üîê\x20Admin\x202FA\x20disabled');}[a48_0x3818f7(0x30b)](_0x2ea1d6,_0x1b1825,_0x422f50){const _0x1f9dd5=a48_0x3818f7,_0xa0cf55=new Map(),_0x2d6951=new Date(_0x1b1825);while(_0x2d6951<=_0x422f50){const _0x37b61b=_0x2d6951[_0x1f9dd5(0x187)]()[_0x1f9dd5(0x21f)]('T')[0x0];_0xa0cf55[_0x1f9dd5(0x28e)](_0x37b61b,{'revenue':0x0,'count':0x0}),_0x2d6951[_0x1f9dd5(0x31e)](_0x2d6951['getDate']()+0x1);}for(const _0x442c01 of _0x2ea1d6){const _0x5d822c=_0x442c01[_0x1f9dd5(0x1e4)][_0x1f9dd5(0x187)]()[_0x1f9dd5(0x21f)]('T')[0x0],_0x4caaaa=_0xa0cf55[_0x1f9dd5(0x2d8)](_0x5d822c);_0x4caaaa&&(_0x4caaaa[_0x1f9dd5(0x191)]+=0x1,_0x442c01['status']==='PAID'&&(_0x442c01['amountUSDT']?_0x4caaaa['revenue']+=_0x442c01[_0x1f9dd5(0x282)]:console[_0x1f9dd5(0x2c6)](_0x1f9dd5(0x224)+_0x442c01['id']+_0x1f9dd5(0x22e))));}const _0x514e0f=[],_0x469cc3=[];for(const [_0x171ea6,_0x30325e]of _0xa0cf55){_0x514e0f[_0x1f9dd5(0x280)]({'date':_0x171ea6,'amount':Math['round'](_0x30325e[_0x1f9dd5(0x22a)]*0x64)/0x64}),_0x469cc3[_0x1f9dd5(0x280)]({'date':_0x171ea6,'count':_0x30325e['count']});}return{'dailyRevenue':_0x514e0f,'dailyPayments':_0x469cc3};}}exports[a48_0x3818f7(0x34d)]=AdminService;