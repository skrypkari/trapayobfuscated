'use strict';const a35_0x25ac54=a35_0x25c5;(function(_0x39e771,_0x2544b6){const _0x15c3b8=a35_0x25c5,_0x374928=_0x39e771();while(!![]){try{const _0x5b1932=-parseInt(_0x15c3b8(0x1da))/0x1*(-parseInt(_0x15c3b8(0x20e))/0x2)+parseInt(_0x15c3b8(0x1c3))/0x3+-parseInt(_0x15c3b8(0x1ed))/0x4+-parseInt(_0x15c3b8(0x203))/0x5*(parseInt(_0x15c3b8(0x216))/0x6)+parseInt(_0x15c3b8(0x206))/0x7*(-parseInt(_0x15c3b8(0x1ff))/0x8)+-parseInt(_0x15c3b8(0x21e))/0x9+parseInt(_0x15c3b8(0x225))/0xa;if(_0x5b1932===_0x2544b6)break;else _0x374928['push'](_0x374928['shift']());}catch(_0x3dde19){_0x374928['push'](_0x374928['shift']());}}}(a35_0x2b79,0xc0cd5));function a35_0x25c5(_0x1df3c7,_0x22d7c6){const _0x2b7975=a35_0x2b79();return a35_0x25c5=function(_0x25c5ea,_0x356b92){_0x25c5ea=_0x25c5ea-0x19e;let _0x3600b9=_0x2b7975[_0x25c5ea];return _0x3600b9;},a35_0x25c5(_0x1df3c7,_0x22d7c6);}var __importDefault=this&&this[a35_0x25ac54(0x1c9)]||function(_0x18c401){return _0x18c401&&_0x18c401['__esModule']?_0x18c401:{'default':_0x18c401};};Object[a35_0x25ac54(0x22f)](exports,'__esModule',{'value':!![]}),exports[a35_0x25ac54(0x274)]=void 0x0;function a35_0x2b79(){const _0x49f7de=['activateUser','4913316BsSKoh','publicKey','📊\x20Sorting\x20payments\x20by\x20','pk_','payout','periodTo','values','24749520IwHjOO','\x27\x20to\x20name\x20\x27','customerCountry','customerEmail','_sum','map','summary','./currencyService','\x20USDT','\x27\x20->\x20name\x20\x27','defineProperty','COMPLETED','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','totalTurnover','create','totalPayout','dateFrom','getMerchantStatistics','\x20in\x20','usdtErcWallet','merchantEarningsUSDT','totalCommissionRate','thisMonth','📊\x20Merchants\x20awaiting\x20payout:\x20','sort','shopUrl','admin','usdcPolygonWallet','📊\x20Total\x20payments\x20(including\x20failed):\x20','entries','\x20\x20\x20📊\x20Commission\x20difference:\x20','polygon_usdc','date','count','\x20USDT\x20(without\x20commission)','getGatewayNameById','\x20\x20\x20Current\x20balance:\x20','findUnique','getGatewayDisplayName','\x20USDT\x20total','dailyPayments','dateTo','groupBy','username','📋\x20Found\x20','\x20\x20\x20📅\x20This\x20month:\x20','paymentGateways','desc','revenue','totalPaidOut','✅\x20Using\x20gateway\x20filter:\x20\x27','all','test_gateway','currencyService','NONEXISTENT_GATEWAY_FILTER','txid','Rapyd','not\x20set','error','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','getMerchantsSelection','CHARGEBACK','\x20USDT\x20(-','amountAfterCommissionUSDT','name','amountUSDT','💰\x20Payment\x20','commission','periodFrom','fullName','gatewaySettings','createdAt','\x20\x20\x20Transaction\x20hash:\x20','\x20USDT\x20(+','polygon','📅\x20Period\x20\x27all\x27:\x20Using\x20start\x20date\x20from\x20first\x20payment:\x20','toUpperCase','\x20became\x20PAID:\x20+','2020-01-01','AdminService','stringify','paidAt','network','commissionUSDT','\x20USDT\x20to\x20balance','averageCommissionRate','trc20','\x20order','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','statusChangedBy','localeCompare','getUserById','usdtPolygonWallet','dailyRevenue','chargebackAmount','forEach','gateway','\x20for\x20shop\x20','💳\x20Payout\x20wallet\x20for\x20','gatewayOrderId','statusChangedAt','amount','crypto','payment','\x20balance\x20updated:\x20','successUrl','\x20paid\x20payments\x20for\x20analysis','push','period','turnoverUSDT','getMonth','\x20USDT,\x20Requested:\x20','insensitive','getPayoutStats','\x20status:\x20','customerUa','\x20->\x20','hash','findFirst','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','log','gte','orderId','set','join',',\x20successful:\x20','parse','length','\x20payments)','Noda','PAID','ACTIVE','\x27\x20->\x20ID\x20\x27',':\x20commission\x20=\x20','wallets','balance','getMerchantsAwaitingPayout','toLowerCase','\x20\x20\x20💰\x20Total\x20turnover:\x20','Username\x20already\x20exists','\x20\x20\x20Balance:\x20','Payment\x20not\x20found','adminNotes','$transaction','shop','default','asc','convertToUSDT','toISOString','Plisio','createPayout','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','🔍\x20Using\x20gateway\x20\x27','⚠️\x20Gateway\x20\x27','\x20\x20\x20💵\x20Available\x20balance:\x20','\x20USDT\x20(total\x20paid\x20to\x20merchants)','📅\x20Period:\x20','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','week','\x20\x20\x20🌐\x20IP:\x20','status','ceil','customerName','\x20USDT\x20(','usdtTrcWallet','90d','470511pbrZPw','totalPayments','getAllPayouts','getFullYear','🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','deleteUser','__importDefault','createUser','📊\x20Available\x20gateways\x20in\x20database:','failureMessage','hex','✅\x20Payout\x20created:\x20','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','findMany','includes','🔄\x20Admin\x20updating\x20payment\x20','wallet','SUSPENDED','setDate','generateDailyStatistics','getPayoutById','gatewayEarnings','getSystemStatistics','529951GTjZvk','getDate','⚠️\x20Payment\x20','some','pendingUrl','aggregate','reduce','💰\x20[PAYOUT]\x20Gateway\x20','update','averageCheckUSDT','randomBytes','turnover','notes','telegramId','\x20to\x20','password','\x20balance\x20updated:','\x27\x20(from\x20\x27','💰\x20Shop\x20','2767648fIVQsL','merchantUrl','getPaymentById','💱\x20Currency\x20filter\x20applied:\x20','CoinToPay','toString','\x20USDT\x20(same\x20as\x20awaiting)','customerIp','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','erc20','\x20merchants\x20with\x20positive\x20balance','paymentsCount','toFixed','\x20\x20\x20Payout\x20amount:\x20','delete','updatePaymentStatus','💰\x20Found\x20','updatedAt','2041264LWPGUB','round','split','Telegram\x20username\x20already\x20exists','5uBVOxP','currency','telegram','7GWjJei','sk_','💸\x20CHARGEBACK\x20penalty:\x20-','KLYME\x20GB','\x20USDT\x20(with\x20commission\x20deducted)','gateways','getTime','getGatewayIdByName','2DwiqpX','lte','shopId','whiteUrl','custom','availableBalance','🔄\x20Converted\x20gateway\x20ID\x20\x27','🔄\x20Converted\x20gateway\x20name\x20\x27','5274174yMKgPz','📊\x20Getting\x20payments\x20with\x20filters:','year','_count','getAllUsers','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','Shop\x20not\x20found'];a35_0x2b79=function(){return _0x49f7de;};return a35_0x2b79();}const database_1=__importDefault(require('../config/database')),bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a35_0x25ac54(0x28b))),currencyService_1=require(a35_0x25ac54(0x22c)),gateway_1=require('../types/gateway');class AdminService{async[a35_0x25ac54(0x296)](){const _0x14412f=a35_0x25ac54;console[_0x14412f(0x29d)]('📊\x20Calculating\x20payout\x20statistics...');const _0x3a8e32=await database_1[_0x14412f(0x1ae)]['shop'][_0x14412f(0x1df)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':'ACTIVE'}}),_0x4e4179=await this[_0x14412f(0x1a5)]({'page':0x1,'limit':0x3e8}),_0x1f3da4=new Date(),_0x3c8475=new Date(_0x1f3da4[_0x14412f(0x1c6)](),_0x1f3da4['getMonth'](),0x1),_0x56944d=new Date(_0x1f3da4[_0x14412f(0x1c6)](),_0x1f3da4[_0x14412f(0x293)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x4a8d7d=await database_1[_0x14412f(0x1ae)][_0x14412f(0x222)][_0x14412f(0x1df)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x3c8475,'lte':_0x56944d},'status':_0x14412f(0x230)}}),_0x270141=_0x3a8e32[_0x14412f(0x229)][_0x14412f(0x256)]||0x0,_0x2412b3=_0x4e4179[_0x14412f(0x22b)]['totalAmountAfterCommissionUSDT'],_0x4fa32f=_0x4a8d7d[_0x14412f(0x229)]['amount']||0x0,_0x1ca25d={'totalPayout':Math['round'](_0x270141*0x64)/0x64,'awaitingPayout':Math[_0x14412f(0x200)](_0x2412b3*0x64)/0x64,'thisMonth':Math[_0x14412f(0x200)](_0x4fa32f*0x64)/0x64,'availableBalance':Math[_0x14412f(0x200)](_0x2412b3*0x64)/0x64};return console[_0x14412f(0x29d)]('📊\x20Payout\x20statistics\x20calculated:'),console[_0x14412f(0x29d)]('\x20\x20\x20💰\x20Total\x20payout:\x20'+_0x1ca25d[_0x14412f(0x234)]+_0x14412f(0x1b8)),console['log'](_0x14412f(0x1f5)+_0x1ca25d['awaitingPayout']+_0x14412f(0x20a)),console[_0x14412f(0x29d)](_0x14412f(0x1b7)+_0x1ca25d[_0x14412f(0x213)]+_0x14412f(0x1f3)),console[_0x14412f(0x29d)](_0x14412f(0x252)+_0x1ca25d[_0x14412f(0x23b)]+_0x14412f(0x22d)),console[_0x14412f(0x29d)]('\x20\x20\x20🔍\x20Raw\x20balance\x20sum:\x20'+(_0x3a8e32[_0x14412f(0x229)][_0x14412f(0x1a4)]||0x0)[_0x14412f(0x1f9)](0x2)+_0x14412f(0x247)),console['log'](_0x14412f(0x243)+((_0x3a8e32[_0x14412f(0x229)][_0x14412f(0x1a4)]||0x0)-_0x2412b3)[_0x14412f(0x1f9)](0x2)+_0x14412f(0x22d)),_0x1ca25d;}async['updateCustomerData'](_0x7a9e44,_0x3767ac){const _0xe6769d=a35_0x25ac54;console['log'](_0xe6769d(0x231)+_0x7a9e44+':',_0x3767ac);const _0x2deb4f=await database_1[_0xe6769d(0x1ae)]['payment'][_0xe6769d(0x24a)]({'where':{'id':_0x7a9e44},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x2deb4f)throw new Error(_0xe6769d(0x1aa));const _0x2793d7={};_0x3767ac[_0xe6769d(0x227)]!==undefined&&(_0x2793d7['customerCountry']=_0x3767ac[_0xe6769d(0x227)]||null);_0x3767ac[_0xe6769d(0x1f4)]!==undefined&&(_0x2793d7['customerIp']=_0x3767ac[_0xe6769d(0x1f4)]||null);_0x3767ac[_0xe6769d(0x298)]!==undefined&&(_0x2793d7[_0xe6769d(0x298)]=_0x3767ac[_0xe6769d(0x298)]||null);const _0x482c36=await database_1[_0xe6769d(0x1ae)]['payment'][_0xe6769d(0x1e2)]({'where':{'id':_0x7a9e44},'data':{..._0x2793d7,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0xe6769d(0x29d)](_0xe6769d(0x27d)+_0x7a9e44),console[_0xe6769d(0x29d)]('\x20\x20\x20🌍\x20Country:\x20'+_0x2deb4f[_0xe6769d(0x227)]+'\x20->\x20'+_0x482c36[_0xe6769d(0x227)]),console[_0xe6769d(0x29d)](_0xe6769d(0x1bc)+_0x2deb4f['customerIp']+'\x20->\x20'+_0x482c36['customerIp']),console[_0xe6769d(0x29d)]('\x20\x20\x20🖥️\x20User\x20Agent:\x20'+(_0x2deb4f['customerUa']?_0xe6769d(0x2a0):'not\x20set')+_0xe6769d(0x299)+(_0x482c36['customerUa']?'set':_0xe6769d(0x25e))),_0x482c36;}async[a35_0x25ac54(0x1d9)](_0x3aebe6){const _0x49c271=a35_0x25ac54,_0x562c78=new Date();let _0x4cd9a4;switch(_0x3aebe6){case'7d':_0x4cd9a4=new Date(_0x562c78[_0x49c271(0x20c)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x4cd9a4=new Date(_0x562c78['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x49c271(0x1c2):_0x4cd9a4=new Date(_0x562c78[_0x49c271(0x20c)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case'all':const _0xe1cad1=await database_1['default'][_0x49c271(0x28c)][_0x49c271(0x29b)]({'where':{'gateway':{'not':_0x49c271(0x259)}},'orderBy':{'createdAt':_0x49c271(0x1af)},'select':{'createdAt':!![]}});_0x4cd9a4=_0xe1cad1?_0xe1cad1[_0x49c271(0x26c)]:new Date('2020-01-01'),console[_0x49c271(0x29d)](_0x49c271(0x270)+_0x4cd9a4[_0x49c271(0x1b1)]());break;default:_0x4cd9a4=new Date(_0x562c78[_0x49c271(0x20c)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x1f7f45,_0x10cc9e,_0x42c9d0,_0x38dc3a,_0x4a3718,_0x5399a2,_0x566753]=await Promise[_0x49c271(0x258)]([database_1[_0x49c271(0x1ae)]['shop']['count'](),database_1[_0x49c271(0x1ae)][_0x49c271(0x1ad)]['count']({'where':{'status':_0x49c271(0x1a0)}}),database_1[_0x49c271(0x1ae)]['payment'][_0x49c271(0x246)]({'where':{'createdAt':{'gte':_0x4cd9a4},'gateway':{'not':'test_gateway'}}}),database_1[_0x49c271(0x1ae)][_0x49c271(0x28c)][_0x49c271(0x246)]({'where':{'status':_0x49c271(0x19f),'createdAt':{'gte':_0x4cd9a4},'gateway':{'not':'test_gateway'}}}),database_1[_0x49c271(0x1ae)][_0x49c271(0x28c)]['findMany']({'where':{'status':_0x49c271(0x19f),'createdAt':{'gte':_0x4cd9a4},'gateway':{'not':_0x49c271(0x259)}},'select':{'amount':!![],'currency':!![]}}),database_1['default'][_0x49c271(0x28c)][_0x49c271(0x1d0)]({'where':{'gateway':{'not':_0x49c271(0x259)}},'take':0xa,'orderBy':{'createdAt':_0x49c271(0x254)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x49c271(0x1ae)][_0x49c271(0x28c)]['findMany']({'where':{'createdAt':{'gte':_0x4cd9a4},'gateway':{'not':_0x49c271(0x259)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x5400f5=0x0;for(const _0x2ff0ff of _0x4a3718){const _0xee8bf3=await currencyService_1[_0x49c271(0x25a)][_0x49c271(0x1b0)](_0x2ff0ff[_0x49c271(0x28a)],_0x2ff0ff['currency']);_0x5400f5+=_0xee8bf3;}const _0x46cd4e=this[_0x49c271(0x1d6)](_0x566753,_0x4cd9a4,_0x562c78),_0x3d6cf9=_0x42c9d0>0x0?_0x38dc3a/_0x42c9d0*0x64:0x0;return{'totalShops':_0x1f7f45,'activeShops':_0x10cc9e,'totalPayments':_0x42c9d0,'successfulPayments':_0x38dc3a,'totalRevenue':Math[_0x49c271(0x200)](_0x5400f5*0x64)/0x64,'conversionRate':Math['round'](_0x3d6cf9*0x64)/0x64,'dailyRevenue':_0x46cd4e[_0x49c271(0x282)],'dailyPayments':_0x46cd4e[_0x49c271(0x24d)],'recentPayments':_0x5399a2['map'](_0x15bd13=>({'id':_0x15bd13['id'],'amount':_0x15bd13['amount'],'currency':_0x15bd13[_0x49c271(0x204)],'status':_0x15bd13[_0x49c271(0x1bd)],'gateway':_0x15bd13[_0x49c271(0x285)],'shop':_0x15bd13[_0x49c271(0x1ad)],'createdAt':_0x15bd13[_0x49c271(0x26c)]}))};}async[a35_0x25ac54(0x236)](_0x3c139f){const _0x52d078=a35_0x25ac54;console['log']('📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:',_0x3c139f);let _0xc859e8,_0xc39d6a=new Date();if(_0x3c139f[_0x52d078(0x291)]==='custom'&&_0x3c139f['dateFrom']&&_0x3c139f[_0x52d078(0x24e)])_0xc859e8=new Date(_0x3c139f[_0x52d078(0x235)]),_0xc39d6a=new Date(_0x3c139f[_0x52d078(0x24e)]);else{const _0x3b34a7=new Date();switch(_0x3c139f[_0x52d078(0x291)]){case _0x52d078(0x1bb):_0xc859e8=new Date(_0x3b34a7['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'month':_0xc859e8=new Date(_0x3b34a7[_0x52d078(0x20c)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x52d078(0x218):_0xc859e8=new Date(_0x3b34a7[_0x52d078(0x20c)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x52d078(0x258):default:_0xc859e8=new Date(_0x52d078(0x273));break;}}console['log'](_0x52d078(0x1b9)+_0xc859e8['toISOString']()+_0x52d078(0x1e8)+_0xc39d6a[_0x52d078(0x1b1)]());const _0x3d17b1={'status':_0x52d078(0x19f),'gateway':{'not':_0x52d078(0x259)},'paidAt':{'gte':_0xc859e8,'lte':_0xc39d6a}};_0x3c139f[_0x52d078(0x210)]&&(_0x3d17b1[_0x52d078(0x210)]=_0x3c139f[_0x52d078(0x210)]);const _0x3acec9=await database_1[_0x52d078(0x1ae)]['payment'][_0x52d078(0x1d0)]({'where':_0x3d17b1,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x52d078(0x29d)]('💰\x20Found\x20'+_0x3acec9[_0x52d078(0x2a4)]+_0x52d078(0x28f));const _0x3a560b={'gateway':{'not':_0x52d078(0x259)},'createdAt':{'gte':_0xc859e8,'lte':_0xc39d6a}};_0x3c139f[_0x52d078(0x210)]&&(_0x3a560b[_0x52d078(0x210)]=_0x3c139f[_0x52d078(0x210)]);const _0x45efd1=await database_1[_0x52d078(0x1ae)][_0x52d078(0x28c)][_0x52d078(0x246)]({'where':_0x3a560b});console[_0x52d078(0x29d)](_0x52d078(0x241)+_0x45efd1+_0x52d078(0x2a2)+_0x3acec9[_0x52d078(0x2a4)]);let _0xc3fcb7=0x0,_0xb9060=0x0,_0xc71f10=0x0;const _0x1480cc={},_0xf6967e={},_0xcf4229={};for(const _0x192ca8 of _0x3acec9){try{const _0x27a213=await currencyService_1[_0x52d078(0x25a)][_0x52d078(0x1b0)](_0x192ca8[_0x52d078(0x28a)],_0x192ca8[_0x52d078(0x204)]);let _0x3b22e5={};if(_0x192ca8[_0x52d078(0x1ad)][_0x52d078(0x26b)])try{_0x3b22e5=JSON[_0x52d078(0x2a3)](_0x192ca8[_0x52d078(0x1ad)][_0x52d078(0x26b)]);}catch(_0x5bbf24){console[_0x52d078(0x25f)](_0x52d078(0x1ba)+_0x192ca8['shopId']+':',_0x5bbf24);}let _0x1a8287={},_0x3712c9=0xa;for(const [_0x5c0529,_0x2b4a3f]of Object[_0x52d078(0x242)](_0x3b22e5)){if(_0x5c0529[_0x52d078(0x1a6)]()===_0x192ca8['gateway'][_0x52d078(0x1a6)]()){_0x1a8287=_0x2b4a3f,_0x3712c9=_0x2b4a3f[_0x52d078(0x268)]||0xa;break;}}const _0x592dca=_0x27a213*(_0x3712c9/0x64),_0x41a8a6=_0x27a213-_0x592dca;_0xc3fcb7+=_0x27a213,_0xb9060+=_0x41a8a6,_0xc71f10+=_0x592dca;!_0x1480cc[_0x192ca8[_0x52d078(0x285)]]&&(_0x1480cc[_0x192ca8[_0x52d078(0x285)]]={'gateway':_0x192ca8[_0x52d078(0x285)],'gatewayDisplayName':this[_0x52d078(0x24b)](_0x192ca8[_0x52d078(0x285)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x1480cc[_0x192ca8[_0x52d078(0x285)]][_0x52d078(0x1f8)]++,_0x1480cc[_0x192ca8[_0x52d078(0x285)]][_0x52d078(0x292)]+=_0x27a213,_0x1480cc[_0x192ca8[_0x52d078(0x285)]][_0x52d078(0x278)]+=_0x592dca,_0x1480cc[_0x192ca8['gateway']]['merchantEarningsUSDT']+=_0x41a8a6,_0x1480cc[_0x192ca8[_0x52d078(0x285)]]['totalCommissionRate']+=_0x3712c9;!_0x3c139f[_0x52d078(0x210)]&&(!_0xf6967e[_0x192ca8['shopId']]&&(_0xf6967e[_0x192ca8[_0x52d078(0x210)]]={'shopId':_0x192ca8['shopId'],'shopName':_0x192ca8[_0x52d078(0x1ad)]['name'],'shopUsername':_0x192ca8[_0x52d078(0x1ad)][_0x52d078(0x250)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0xf6967e[_0x192ca8['shopId']][_0x52d078(0x1f8)]++,_0xf6967e[_0x192ca8['shopId']][_0x52d078(0x292)]+=_0x27a213,_0xf6967e[_0x192ca8['shopId']][_0x52d078(0x278)]+=_0x592dca,_0xf6967e[_0x192ca8[_0x52d078(0x210)]]['merchantEarningsUSDT']+=_0x41a8a6);const _0x31df44=_0x192ca8[_0x52d078(0x276)][_0x52d078(0x1b1)]()['split']('T')[0x0];!_0xcf4229[_0x31df44]&&(_0xcf4229[_0x31df44]={'date':_0x31df44,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0xcf4229[_0x31df44][_0x52d078(0x1e5)]+=_0x27a213,_0xcf4229[_0x31df44]['merchantEarnings']+=_0x41a8a6,_0xcf4229[_0x31df44]['gatewayEarnings']+=_0x592dca,_0xcf4229[_0x31df44][_0x52d078(0x1f8)]++;}catch(_0x3d5d48){console[_0x52d078(0x25f)]('Error\x20processing\x20payment\x20'+_0x192ca8['id']+':',_0x3d5d48);}}Object[_0x52d078(0x224)](_0x1480cc)['forEach'](_0x2c2f59=>{const _0x558b7a=_0x52d078;_0x2c2f59['averageCommissionRate']=_0x2c2f59[_0x558b7a(0x1f8)]>0x0?_0x2c2f59['totalCommissionRate']/_0x2c2f59[_0x558b7a(0x1f8)]:0x0,delete _0x2c2f59[_0x558b7a(0x23a)];}),Object[_0x52d078(0x224)](_0xf6967e)[_0x52d078(0x284)](_0x1b5893=>{const _0x5a1bb9=_0x52d078;_0x1b5893[_0x5a1bb9(0x1e3)]=_0x1b5893[_0x5a1bb9(0x1f8)]>0x0?_0x1b5893['turnoverUSDT']/_0x1b5893[_0x5a1bb9(0x1f8)]:0x0;});let _0x141145=0x0;if(_0x3c139f[_0x52d078(0x210)]){const _0x242927=await database_1[_0x52d078(0x1ae)][_0x52d078(0x222)][_0x52d078(0x1d0)]({'where':{'shopId':_0x3c139f[_0x52d078(0x210)],'status':_0x52d078(0x230),'createdAt':{'gte':_0xc859e8,'lte':_0xc39d6a}},'select':{'amount':!![]}});_0x141145=_0x242927[_0x52d078(0x1e0)]((_0x19359e,_0x221394)=>_0x19359e+_0x221394['amount'],0x0);}const _0x16582a=_0x45efd1,_0x282b45=_0x3acec9[_0x52d078(0x2a4)],_0x340adf=_0x282b45>0x0?_0xc3fcb7/_0x282b45:0x0,_0x43cc08=_0x16582a>0x0?Math[_0x52d078(0x200)](_0x282b45/_0x16582a*0x2710)/0x64:0x0,_0x371c0f=Math[_0x52d078(0x1be)]((_0xc39d6a[_0x52d078(0x20c)]()-_0xc859e8[_0x52d078(0x20c)]())/(0x3e8*0x3c*0x3c*0x18)),_0x2c7e30={'totalTurnover':Math['round'](_0xc3fcb7*0x64)/0x64,'merchantEarnings':Math[_0x52d078(0x200)](_0xb9060*0x64)/0x64,'gatewayEarnings':Math[_0x52d078(0x200)](_0xc71f10*0x64)/0x64,'totalPaidOut':Math['round'](_0x141145*0x64)/0x64,'averageCheck':Math[_0x52d078(0x200)](_0x340adf*0x64)/0x64,'totalPayments':_0x16582a,'successfulPayments':_0x282b45,'conversionRate':_0x43cc08,'gatewayBreakdown':Object[_0x52d078(0x224)](_0x1480cc)[_0x52d078(0x22a)](_0x4cf56a=>({..._0x4cf56a,'turnoverUSDT':Math[_0x52d078(0x200)](_0x4cf56a['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math['round'](_0x4cf56a[_0x52d078(0x278)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x4cf56a[_0x52d078(0x239)]*0x64)/0x64,'averageCommissionRate':Math['round'](_0x4cf56a[_0x52d078(0x27a)]*0x64)/0x64})),'merchantBreakdown':_0x3c139f[_0x52d078(0x210)]?undefined:Object[_0x52d078(0x224)](_0xf6967e)['map'](_0x3b5269=>({..._0x3b5269,'turnoverUSDT':Math[_0x52d078(0x200)](_0x3b5269['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math['round'](_0x3b5269['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x52d078(0x200)](_0x3b5269[_0x52d078(0x239)]*0x64)/0x64,'paidOutUSDT':Math[_0x52d078(0x200)](_0x3b5269['paidOutUSDT']*0x64)/0x64,'averageCheckUSDT':Math['round'](_0x3b5269[_0x52d078(0x1e3)]*0x64)/0x64})),'dailyData':Object['values'](_0xcf4229)[_0x52d078(0x22a)](_0x54b1b6=>({..._0x54b1b6,'turnover':Math[_0x52d078(0x200)](_0x54b1b6[_0x52d078(0x1e5)]*0x64)/0x64,'merchantEarnings':Math[_0x52d078(0x200)](_0x54b1b6['merchantEarnings']*0x64)/0x64,'gatewayEarnings':Math['round'](_0x54b1b6[_0x52d078(0x1d8)]*0x64)/0x64}))[_0x52d078(0x23d)]((_0x55aa5b,_0x44fc68)=>_0x55aa5b[_0x52d078(0x245)][_0x52d078(0x27f)](_0x44fc68[_0x52d078(0x245)])),'periodInfo':{'from':_0xc859e8,'to':_0xc39d6a,'periodType':_0x3c139f['period']||_0x52d078(0x212),'daysCount':_0x371c0f}};return console[_0x52d078(0x29d)]('📊\x20Merchant\x20statistics\x20calculated:'),console[_0x52d078(0x29d)](_0x52d078(0x1a7)+_0x2c7e30[_0x52d078(0x232)]+_0x52d078(0x22d)),console[_0x52d078(0x29d)](_0x52d078(0x1cf)+_0x2c7e30['merchantEarnings']+_0x52d078(0x22d)),console[_0x52d078(0x29d)](_0x52d078(0x1b4)+_0x2c7e30[_0x52d078(0x1d8)]+_0x52d078(0x22d)),console[_0x52d078(0x29d)]('\x20\x20\x20📊\x20Total\x20payments:\x20'+_0x2c7e30[_0x52d078(0x1c4)]),_0x2c7e30;}async[a35_0x25ac54(0x261)](){const _0x4eeade=a35_0x25ac54;console[_0x4eeade(0x29d)]('📋\x20Getting\x20merchants\x20selection\x20list...');const _0xecd7fa=await database_1[_0x4eeade(0x1ae)]['shop']['findMany']({'where':{'status':_0x4eeade(0x1a0)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':'asc'}});return console[_0x4eeade(0x29d)](_0x4eeade(0x251)+_0xecd7fa[_0x4eeade(0x2a4)]+'\x20active\x20merchants\x20for\x20selection'),_0xecd7fa[_0x4eeade(0x22a)](_0xa61d5c=>({'id':_0xa61d5c['id'],'username':_0xa61d5c[_0x4eeade(0x250)],'name':_0xa61d5c[_0x4eeade(0x265)]}));}[a35_0x25ac54(0x24b)](_0x4b120e){const _0x11fbd4=a35_0x25ac54,_0x5ce8b2={'test_gateway':'Test\x20Gateway','plisio':_0x11fbd4(0x1b2),'rapyd':_0x11fbd4(0x25d),'noda':_0x11fbd4(0x19e),'cointopay':_0x11fbd4(0x1f1),'klyme_eu':'KLYME\x20EU','klyme_gb':_0x11fbd4(0x209),'klyme_de':'KLYME\x20DE'};return _0x5ce8b2[_0x4b120e]||_0x4b120e;}async[a35_0x25ac54(0x1a5)](_0x34c6e9){const _0x2c45d0=a35_0x25ac54,{page:_0x455508,limit:_0x262ac3,minAmount:_0x2569b8,search:_0x8ec897}=_0x34c6e9,_0x877587=(_0x455508-0x1)*_0x262ac3;console[_0x2c45d0(0x29d)](_0x2c45d0(0x21b),_0x34c6e9);const _0x2cc2ac={'balance':{'gt':0x0},'status':_0x2c45d0(0x1a0)};_0x2569b8&&(_0x2cc2ac[_0x2c45d0(0x1a4)]['gte']=_0x2569b8);_0x8ec897&&(_0x2cc2ac['OR']=[{'name':{'contains':_0x8ec897,'mode':'insensitive'}},{'username':{'contains':_0x8ec897,'mode':'insensitive'}}]);const [_0x46465e,_0x16d360]=await Promise[_0x2c45d0(0x258)]([database_1[_0x2c45d0(0x1ae)][_0x2c45d0(0x1ad)][_0x2c45d0(0x1d0)]({'where':_0x2cc2ac,'skip':_0x877587,'take':_0x262ac3,'orderBy':{'balance':_0x2c45d0(0x254)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1[_0x2c45d0(0x1ae)][_0x2c45d0(0x1ad)][_0x2c45d0(0x246)]({'where':_0x2cc2ac})]);console['log'](_0x2c45d0(0x1fd)+_0x46465e[_0x2c45d0(0x2a4)]+_0x2c45d0(0x1f7));const _0x4d0bb8=await Promise[_0x2c45d0(0x258)](_0x46465e[_0x2c45d0(0x22a)](async _0x528f17=>{const _0x1b327d=_0x2c45d0,[_0xd1496b,_0x28b504,_0x41e224]=await Promise[_0x1b327d(0x258)]([database_1[_0x1b327d(0x1ae)]['payment'][_0x1b327d(0x246)]({'where':{'shopId':_0x528f17['id'],'status':'PAID','amountUSDT':{'not':null}}}),database_1['default']['payment']['findFirst']({'where':{'shopId':_0x528f17['id'],'status':_0x1b327d(0x19f),'amountUSDT':{'not':null}},'orderBy':{'paidAt':'asc'},'select':{'paidAt':!![]}}),database_1[_0x1b327d(0x1ae)][_0x1b327d(0x28c)][_0x1b327d(0x24f)]({'by':[_0x1b327d(0x285)],'where':{'shopId':_0x528f17['id'],'status':'PAID','amountUSDT':{'not':null}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x480613=await Promise[_0x1b327d(0x258)](_0x41e224['map'](async _0x4ff2f3=>{const _0x53b3e3=_0x1b327d;let _0x54fbf2=0xa;if(_0x528f17['gatewaySettings'])try{const _0x1dd315=JSON[_0x53b3e3(0x2a3)](_0x528f17[_0x53b3e3(0x26b)]);for(const [_0x1a6e6f,_0x24ed59]of Object[_0x53b3e3(0x242)](_0x1dd315)){if(_0x1a6e6f[_0x53b3e3(0x1a6)]()===_0x4ff2f3[_0x53b3e3(0x285)][_0x53b3e3(0x1a6)]()){_0x54fbf2=_0x24ed59[_0x53b3e3(0x268)]||0xa,console['log'](_0x53b3e3(0x1e1)+_0x4ff2f3['gateway']+'\x20for\x20shop\x20'+_0x528f17['id']+_0x53b3e3(0x1a2)+_0x54fbf2+'%');break;}}}catch(_0x2075d4){console['error'](_0x53b3e3(0x1ba)+_0x528f17['id']+':',_0x2075d4);}const _0xe94079=_0x4ff2f3[_0x53b3e3(0x229)][_0x53b3e3(0x266)]||0x0,_0x5739e3=_0xe94079*(0x1-_0x54fbf2/0x64);return{'gateway':_0x4ff2f3[_0x53b3e3(0x285)],'count':_0x4ff2f3[_0x53b3e3(0x219)]['id'],'amountUSDT':Math[_0x53b3e3(0x200)](_0xe94079*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x53b3e3(0x200)](_0x5739e3*0x64)/0x64,'commission':_0x54fbf2};})),_0x4e1640=_0x480613['reduce']((_0x3847b8,_0x58e52c)=>_0x3847b8+_0x58e52c[_0x1b327d(0x266)],0x0),_0x2fe594=_0x480613['reduce']((_0x4af1ca,_0x241ece)=>_0x4af1ca+_0x241ece[_0x1b327d(0x264)],0x0);return{'id':_0x528f17['id'],'fullName':_0x528f17['name'],'username':_0x528f17[_0x1b327d(0x250)],'telegramId':_0x528f17['telegram'],'merchantUrl':_0x528f17['shopUrl'],'wallets':{'usdtPolygonWallet':_0x528f17[_0x1b327d(0x281)],'usdtTrcWallet':_0x528f17[_0x1b327d(0x1c1)],'usdtErcWallet':_0x528f17[_0x1b327d(0x238)],'usdcPolygonWallet':_0x528f17[_0x1b327d(0x240)]},'totalAmountUSDT':Math['round'](_0x4e1640*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x2fe594*0x64)/0x64,'paymentsCount':_0xd1496b,'oldestPaymentDate':_0x28b504?.['paidAt']||_0x528f17[_0x1b327d(0x26c)],'gatewayBreakdown':_0x480613};})),_0x391a40=_0x4d0bb8[_0x2c45d0(0x1e0)]((_0x262168,_0x40678e)=>_0x262168+_0x40678e['totalAmountUSDT'],0x0),_0x342006=_0x4d0bb8[_0x2c45d0(0x1e0)]((_0x44921b,_0x18f263)=>_0x44921b+_0x18f263['totalAmountAfterCommissionUSDT'],0x0);return console[_0x2c45d0(0x29d)](_0x2c45d0(0x23c)+_0x16d360+'\x20merchants,\x20'+Math['round'](_0x342006*0x64)/0x64+_0x2c45d0(0x24c)),{'merchants':_0x4d0bb8,'pagination':{'page':_0x455508,'limit':_0x262ac3,'total':_0x16d360,'totalPages':Math['ceil'](_0x16d360/_0x262ac3)},'summary':{'totalMerchants':_0x16d360,'totalAmountUSDT':Math[_0x2c45d0(0x200)](_0x391a40*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x2c45d0(0x200)](_0x342006*0x64)/0x64}};}async[a35_0x25ac54(0x1b3)](_0x6407a1){const _0x2af82b=a35_0x25ac54,{shopId:_0x3f6731,amount:_0x11f214,network:_0x30594c,wallet:_0x1e0c1e,notes:_0x8587e,txid:_0x13a787,periodFrom:_0x285364,periodTo:_0x38bffa}=_0x6407a1,_0x2b1340=await database_1[_0x2af82b(0x1ae)]['$transaction'](async _0x45c398=>{const _0x564512=_0x2af82b,_0x57fea6=await _0x45c398[_0x564512(0x1ad)][_0x564512(0x24a)]({'where':{'id':_0x3f6731},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x57fea6)throw new Error(_0x564512(0x21c));console[_0x564512(0x29d)]('💰\x20Creating\x20payout\x20for\x20shop\x20'+_0x57fea6[_0x564512(0x250)]+':'),console[_0x564512(0x29d)](_0x564512(0x249)+_0x57fea6[_0x564512(0x1a4)][_0x564512(0x1f9)](0x6)+_0x564512(0x22d)),console['log'](_0x564512(0x1fa)+_0x11f214['toFixed'](0x6)+_0x564512(0x22d)),console[_0x564512(0x29d)](_0x564512(0x29c)+_0x57fea6[_0x564512(0x256)]['toFixed'](0x6)+_0x564512(0x22d));if(_0x13a787)console[_0x564512(0x29d)](_0x564512(0x26d)+_0x13a787);if(_0x57fea6[_0x564512(0x1a4)]<_0x11f214)throw new Error('Insufficient\x20balance.\x20Available:\x20'+_0x57fea6[_0x564512(0x1a4)][_0x564512(0x1f9)](0x6)+_0x564512(0x294)+_0x11f214[_0x564512(0x1f9)](0x6)+_0x564512(0x22d));let _0x1a1ec9=_0x1e0c1e;if(!_0x1a1ec9){const _0xbc4755=await _0x45c398['shop']['findUnique']({'where':{'id':_0x3f6731},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0xbc4755)switch(_0x30594c){case _0x564512(0x26f):_0x1a1ec9=_0xbc4755[_0x564512(0x281)]||undefined;break;case _0x564512(0x27b):_0x1a1ec9=_0xbc4755[_0x564512(0x1c1)]||undefined;break;case _0x564512(0x1f6):_0x1a1ec9=_0xbc4755[_0x564512(0x238)]||undefined;break;case _0x564512(0x244):_0x1a1ec9=_0xbc4755[_0x564512(0x240)]||undefined;break;}}console[_0x564512(0x29d)](_0x564512(0x287)+_0x30594c+':\x20'+(_0x1a1ec9||'not\x20specified'));const _0x5e283b=await _0x45c398[_0x564512(0x222)]['create']({'data':{'shopId':_0x3f6731,'amount':_0x11f214,'network':_0x30594c,'status':_0x564512(0x230),'txid':_0x13a787,'notes':_0x8587e,'periodFrom':_0x285364?new Date(_0x285364):null,'periodTo':_0x38bffa?new Date(_0x38bffa):null,'createdAt':new Date(),'paidAt':new Date()}}),_0xeecd5=_0x57fea6[_0x564512(0x1a4)]-_0x11f214,_0x54eb07=_0x57fea6[_0x564512(0x256)]+_0x11f214;return await _0x45c398[_0x564512(0x1ad)][_0x564512(0x1e2)]({'where':{'id':_0x3f6731},'data':{'balance':_0xeecd5,'totalPaidOut':_0x54eb07}}),console['log']('💰\x20Shop\x20'+_0x57fea6['username']+_0x564512(0x1ea)),console['log'](_0x564512(0x1a9)+_0x57fea6[_0x564512(0x1a4)][_0x564512(0x1f9)](0x6)+_0x564512(0x299)+_0xeecd5[_0x564512(0x1f9)](0x6)+_0x564512(0x263)+_0x11f214[_0x564512(0x1f9)](0x6)+')'),console[_0x564512(0x29d)]('\x20\x20\x20Total\x20paid\x20out:\x20'+_0x57fea6[_0x564512(0x256)][_0x564512(0x1f9)](0x6)+'\x20->\x20'+_0x54eb07[_0x564512(0x1f9)](0x6)+_0x564512(0x26e)+_0x11f214[_0x564512(0x1f9)](0x6)+')'),{'payout':_0x5e283b,'shop':_0x57fea6};});return console[_0x2af82b(0x29d)](_0x2af82b(0x1ce)+_0x2b1340[_0x2af82b(0x222)]['id']+_0x2af82b(0x286)+_0x2b1340[_0x2af82b(0x1ad)][_0x2af82b(0x250)]+'\x20('+_0x11f214+'\x20USDT)'),{'id':_0x2b1340[_0x2af82b(0x222)]['id'],'shopId':_0x2b1340[_0x2af82b(0x222)][_0x2af82b(0x210)],'shopName':_0x2b1340['shop'][_0x2af82b(0x265)],'shopUsername':_0x2b1340[_0x2af82b(0x1ad)]['username'],'amount':_0x2b1340[_0x2af82b(0x222)][_0x2af82b(0x28a)],'network':_0x2b1340['payout']['network'],'status':_0x2b1340[_0x2af82b(0x222)][_0x2af82b(0x1bd)],'txid':_0x2b1340[_0x2af82b(0x222)][_0x2af82b(0x25c)],'notes':_0x2b1340[_0x2af82b(0x222)]['notes'],'periodFrom':_0x2b1340[_0x2af82b(0x222)][_0x2af82b(0x269)],'periodTo':_0x2b1340[_0x2af82b(0x222)][_0x2af82b(0x223)],'createdAt':_0x2b1340[_0x2af82b(0x222)]['createdAt'],'paidAt':_0x2b1340[_0x2af82b(0x222)]['paidAt']};}async[a35_0x25ac54(0x1c5)](_0x27490e){const _0x31c5d6=a35_0x25ac54,{page:_0x2dc63f,limit:_0x38ff9d,shopId:_0x5d112b,network:_0x4e957c,dateFrom:_0x3a3e55,dateTo:_0x1f1e54,search:_0x9b3170}=_0x27490e,_0x4dd6a1=(_0x2dc63f-0x1)*_0x38ff9d,_0x17ee96={};_0x5d112b&&(_0x17ee96[_0x31c5d6(0x210)]=_0x5d112b);_0x4e957c&&(_0x17ee96['network']=_0x4e957c);(_0x3a3e55||_0x1f1e54)&&(_0x17ee96[_0x31c5d6(0x26c)]={},_0x3a3e55&&(_0x17ee96[_0x31c5d6(0x26c)][_0x31c5d6(0x29e)]=new Date(_0x3a3e55)),_0x1f1e54&&(_0x17ee96[_0x31c5d6(0x26c)][_0x31c5d6(0x20f)]=new Date(_0x1f1e54)));_0x9b3170&&(_0x17ee96['OR']=[{'shop':{'name':{'contains':_0x9b3170,'mode':_0x31c5d6(0x295)}}},{'shop':{'username':{'contains':_0x9b3170,'mode':_0x31c5d6(0x295)}}},{'notes':{'contains':_0x9b3170,'mode':_0x31c5d6(0x295)}}]);const [_0x42548a,_0x563529]=await Promise['all']([database_1[_0x31c5d6(0x1ae)][_0x31c5d6(0x222)][_0x31c5d6(0x1d0)]({'where':_0x17ee96,'skip':_0x4dd6a1,'take':_0x38ff9d,'orderBy':{'createdAt':_0x31c5d6(0x254)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'wallet':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x31c5d6(0x1ae)]['payout'][_0x31c5d6(0x246)]({'where':_0x17ee96})]);return{'payouts':_0x42548a[_0x31c5d6(0x22a)](_0x4ee40b=>({'id':_0x4ee40b['id'],'shopId':_0x4ee40b['shopId'],'shopName':_0x4ee40b['shop'][_0x31c5d6(0x265)],'shopUsername':_0x4ee40b['shop'][_0x31c5d6(0x250)],'amount':_0x4ee40b[_0x31c5d6(0x28a)],'network':_0x4ee40b[_0x31c5d6(0x277)],'wallet':_0x4ee40b[_0x31c5d6(0x1d3)],'status':_0x4ee40b[_0x31c5d6(0x1bd)],'txid':_0x4ee40b[_0x31c5d6(0x25c)],'notes':_0x4ee40b[_0x31c5d6(0x1e6)],'periodFrom':_0x4ee40b[_0x31c5d6(0x269)],'periodTo':_0x4ee40b[_0x31c5d6(0x223)],'createdAt':_0x4ee40b[_0x31c5d6(0x26c)],'paidAt':_0x4ee40b[_0x31c5d6(0x276)]})),'pagination':{'page':_0x2dc63f,'limit':_0x38ff9d,'total':_0x563529,'totalPages':Math[_0x31c5d6(0x1be)](_0x563529/_0x38ff9d)}};}async[a35_0x25ac54(0x1d7)](_0x3d5062){const _0x130740=a35_0x25ac54,_0x5774e9=await database_1[_0x130740(0x1ae)][_0x130740(0x222)][_0x130740(0x24a)]({'where':{'id':_0x3d5062},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x5774e9)return null;return{'id':_0x5774e9['id'],'shopId':_0x5774e9[_0x130740(0x210)],'shopName':_0x5774e9[_0x130740(0x1ad)]['name'],'shopUsername':_0x5774e9[_0x130740(0x1ad)][_0x130740(0x250)],'amount':_0x5774e9['amount'],'network':_0x5774e9['network'],'status':_0x5774e9[_0x130740(0x1bd)],'txid':_0x5774e9[_0x130740(0x25c)],'notes':_0x5774e9[_0x130740(0x1e6)],'periodFrom':_0x5774e9[_0x130740(0x269)],'periodTo':_0x5774e9[_0x130740(0x223)],'createdAt':_0x5774e9['createdAt'],'paidAt':_0x5774e9[_0x130740(0x276)]};}async['deletePayout'](_0x5d21ff){const _0x7d3f45=a35_0x25ac54;await database_1[_0x7d3f45(0x1ae)]['payout'][_0x7d3f45(0x1fb)]({'where':{'id':_0x5d21ff}});}async['getAllPayments'](_0x15b505){const _0x4b1736=a35_0x25ac54,{page:_0x245537,limit:_0x2da03a,status:_0x35cfd7,gateway:_0x24ddfe,shopId:_0x2d8709,dateFrom:_0x45b774,dateTo:_0x13054c,search:_0xad127a,currency:_0x20ae3f,sortBy:_0x2d8340,sortOrder:_0x2e0230}=_0x15b505,_0x1d0e6f=(_0x245537-0x1)*_0x2da03a;console['log'](_0x4b1736(0x217),_0x15b505);const _0x349cdd=await database_1['default'][_0x4b1736(0x28c)][_0x4b1736(0x24f)]({'by':[_0x4b1736(0x285)],'_count':{'gateway':!![]}});console[_0x4b1736(0x29d)](_0x4b1736(0x1cb),_0x349cdd['map'](_0x141eb1=>_0x141eb1[_0x4b1736(0x285)]+'\x20('+_0x141eb1[_0x4b1736(0x219)][_0x4b1736(0x285)]+_0x4b1736(0x2a5)));if(_0x24ddfe){const _0x4e0282=_0x349cdd[_0x4b1736(0x1dd)](_0x53e500=>_0x53e500[_0x4b1736(0x285)][_0x4b1736(0x1a6)]()===_0x24ddfe[_0x4b1736(0x1a6)]());!_0x4e0282&&_0x24ddfe[_0x4b1736(0x1a6)]()!==_0x4b1736(0x259)&&console[_0x4b1736(0x29d)]('⚠️\x20Requested\x20gateway\x20\x27'+_0x24ddfe+'\x27\x20not\x20found.\x20Available\x20gateways:\x20'+_0x349cdd[_0x4b1736(0x22a)](_0x34814a=>_0x34814a[_0x4b1736(0x285)])[_0x4b1736(0x2a1)](',\x20'));}const _0x463b96={};_0x35cfd7&&(_0x463b96['status']=_0x35cfd7[_0x4b1736(0x271)]());if(!_0x24ddfe)_0x463b96[_0x4b1736(0x285)]={'not':_0x4b1736(0x259)};else{if(_0x24ddfe&&(_0x24ddfe['toLowerCase']()===_0x4b1736(0x259)||_0x24ddfe==='0000'))_0x463b96[_0x4b1736(0x285)]=_0x4b1736(0x259);else{let _0x5e75dd=_0x24ddfe;const _0x408485=(0x0,gateway_1[_0x4b1736(0x248)])(_0x24ddfe);if(_0x408485)_0x5e75dd=_0x408485,console[_0x4b1736(0x29d)](_0x4b1736(0x214)+_0x24ddfe+_0x4b1736(0x226)+_0x5e75dd+'\x27');else{const _0x112158=(0x0,gateway_1[_0x4b1736(0x20d)])(_0x24ddfe);if(_0x112158){const _0x818a25=(0x0,gateway_1[_0x4b1736(0x248)])(_0x112158);_0x818a25&&(_0x5e75dd=_0x818a25,console[_0x4b1736(0x29d)](_0x4b1736(0x215)+_0x24ddfe+_0x4b1736(0x1a1)+_0x112158+_0x4b1736(0x22e)+_0x5e75dd+'\x27'));}else console['log'](_0x4b1736(0x1b5)+_0x24ddfe+_0x4b1736(0x260));}const _0x4c85d4=await database_1['default'][_0x4b1736(0x28c)][_0x4b1736(0x246)]({'where':{'gateway':_0x5e75dd[_0x4b1736(0x1a6)]()},'take':0x1});_0x4c85d4===0x0?(console[_0x4b1736(0x29d)](_0x4b1736(0x1b6)+_0x5e75dd+_0x4b1736(0x1eb)+_0x24ddfe+'\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result'),_0x463b96[_0x4b1736(0x285)]=_0x4b1736(0x25b)):(_0x463b96[_0x4b1736(0x285)]=_0x5e75dd[_0x4b1736(0x1a6)](),console[_0x4b1736(0x29d)](_0x4b1736(0x257)+_0x5e75dd+_0x4b1736(0x1eb)+_0x24ddfe+'\x27)'));}}console[_0x4b1736(0x29d)]('📊\x20Gateway\x20filter\x20applied:',_0x463b96[_0x4b1736(0x285)]);_0x2d8709&&(_0x463b96[_0x4b1736(0x210)]=_0x2d8709);_0x20ae3f&&(_0x463b96[_0x4b1736(0x204)]=_0x20ae3f[_0x4b1736(0x271)](),console['log'](_0x4b1736(0x1f0)+_0x20ae3f[_0x4b1736(0x271)]()));(_0x45b774||_0x13054c)&&(_0x463b96[_0x4b1736(0x26c)]={},_0x45b774&&(_0x463b96[_0x4b1736(0x26c)][_0x4b1736(0x29e)]=new Date(_0x45b774)),_0x13054c&&(_0x463b96[_0x4b1736(0x26c)][_0x4b1736(0x20f)]=new Date(_0x13054c)));_0xad127a&&(_0x463b96['OR']=[{'id':{'contains':_0xad127a,'mode':_0x4b1736(0x295)}},{'orderId':{'contains':_0xad127a,'mode':_0x4b1736(0x295)}},{'gatewayOrderId':{'contains':_0xad127a,'mode':_0x4b1736(0x295)}},{'customerEmail':{'contains':_0xad127a,'mode':'insensitive'}},{'shop':{'name':{'contains':_0xad127a,'mode':_0x4b1736(0x295)}}},{'shop':{'username':{'contains':_0xad127a,'mode':_0x4b1736(0x295)}}}]);console['log']('📊\x20Final\x20WHERE\x20conditions:',JSON['stringify'](_0x463b96,null,0x2));let _0x203c93={'createdAt':_0x4b1736(0x254)};if(_0x2d8340){const _0x5a75a8=[_0x4b1736(0x28a),_0x4b1736(0x26c),'updatedAt',_0x4b1736(0x1bd),_0x4b1736(0x285),_0x4b1736(0x204)],_0x29b5da=[_0x4b1736(0x1af),_0x4b1736(0x254)];if(_0x5a75a8['includes'](_0x2d8340)){const _0x15ff11=_0x29b5da[_0x4b1736(0x1d1)](_0x2e0230)?_0x2e0230:_0x4b1736(0x254);_0x203c93={[_0x2d8340]:_0x15ff11},console[_0x4b1736(0x29d)](_0x4b1736(0x220)+_0x2d8340+_0x4b1736(0x237)+_0x15ff11+_0x4b1736(0x27c));}}const [_0x27eced,_0x30c5c3]=await Promise[_0x4b1736(0x258)]([database_1[_0x4b1736(0x1ae)][_0x4b1736(0x28c)]['findMany']({'where':_0x463b96,'skip':_0x1d0e6f,'take':_0x2da03a,'orderBy':_0x203c93,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x4b1736(0x1ae)][_0x4b1736(0x28c)][_0x4b1736(0x246)]({'where':_0x463b96})]);return{'payments':_0x27eced[_0x4b1736(0x22a)](_0x235383=>({'id':_0x235383['id'],'shopId':_0x235383[_0x4b1736(0x210)],'gateway':_0x235383[_0x4b1736(0x285)],'amount':_0x235383[_0x4b1736(0x28a)],'currency':_0x235383[_0x4b1736(0x204)],'status':_0x235383['status'],'orderId':_0x235383[_0x4b1736(0x29f)],'gatewayOrderId':_0x235383[_0x4b1736(0x288)],'customerEmail':_0x235383[_0x4b1736(0x228)],'customerName':_0x235383[_0x4b1736(0x1bf)],'customerCountry':_0x235383[_0x4b1736(0x227)],'customerIp':_0x235383[_0x4b1736(0x1f4)],'customerUa':_0x235383[_0x4b1736(0x298)],'failureMessage':_0x235383[_0x4b1736(0x1cc)],'createdAt':_0x235383[_0x4b1736(0x26c)],'updatedAt':_0x235383['updatedAt'],'shop':_0x235383['shop']})),'pagination':{'page':_0x245537,'limit':_0x2da03a,'total':_0x30c5c3,'totalPages':Math[_0x4b1736(0x1be)](_0x30c5c3/_0x2da03a)}};}async[a35_0x25ac54(0x1ef)](_0x4b7642){const _0x351628=a35_0x25ac54,_0x1fcc79=await database_1[_0x351628(0x1ae)]['payment'][_0x351628(0x24a)]({'where':{'id':_0x4b7642},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x1fcc79)return null;return{'id':_0x1fcc79['id'],'shopId':_0x1fcc79[_0x351628(0x210)],'gateway':_0x1fcc79['gateway'],'amount':_0x1fcc79[_0x351628(0x28a)],'currency':_0x1fcc79[_0x351628(0x204)],'status':_0x1fcc79[_0x351628(0x1bd)],'orderId':_0x1fcc79[_0x351628(0x29f)],'gatewayOrderId':_0x1fcc79['gatewayOrderId'],'customerEmail':_0x1fcc79[_0x351628(0x228)],'customerName':_0x1fcc79[_0x351628(0x1bf)],'customerCountry':_0x1fcc79[_0x351628(0x227)],'customerIp':_0x1fcc79[_0x351628(0x1f4)],'customerUa':_0x1fcc79['customerUa'],'failureMessage':_0x1fcc79[_0x351628(0x1cc)],'externalPaymentUrl':_0x1fcc79['externalPaymentUrl'],'successUrl':_0x1fcc79[_0x351628(0x28e)],'failUrl':_0x1fcc79['failUrl'],'pendingUrl':_0x1fcc79[_0x351628(0x1de)],'whiteUrl':_0x1fcc79[_0x351628(0x211)],'createdAt':_0x1fcc79[_0x351628(0x26c)],'updatedAt':_0x1fcc79[_0x351628(0x1fe)],'shop':_0x1fcc79['shop']};}async[a35_0x25ac54(0x1fc)](_0x5dbead,_0x292d3d,_0x39fc47,_0x13cd21){const _0x25eb99=a35_0x25ac54,_0x3d4150=await database_1[_0x25eb99(0x1ae)][_0x25eb99(0x1ac)](async _0x14e060=>{const _0x37a616=_0x25eb99,_0x388b86=await _0x14e060[_0x37a616(0x28c)][_0x37a616(0x24a)]({'where':{'id':_0x5dbead},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x388b86)throw new Error(_0x37a616(0x1aa));const _0xd7bae7=_0x388b86[_0x37a616(0x1bd)],_0x9f338a=_0x292d3d[_0x37a616(0x271)]();console[_0x37a616(0x29d)](_0x37a616(0x1d2)+_0x5dbead+_0x37a616(0x297)+_0xd7bae7+_0x37a616(0x299)+_0x9f338a),console['log']('💰\x20Current\x20shop\x20balance:\x20'+_0x388b86[_0x37a616(0x1ad)][_0x37a616(0x1a4)]+_0x37a616(0x22d));const _0x5e8fa8={'status':_0x9f338a,'updatedAt':new Date(),'statusChangedBy':_0x37a616(0x23f),'statusChangedAt':new Date()};_0x39fc47&&(_0x5e8fa8[_0x37a616(0x1ab)]=_0x39fc47);_0x9f338a===_0x37a616(0x262)&&_0x13cd21&&(_0x5e8fa8[_0x37a616(0x283)]=_0x13cd21);let _0x165ff6=0x0,_0x15b2f7=_0x388b86[_0x37a616(0x1ad)][_0x37a616(0x1a4)];if(_0x9f338a===_0x37a616(0x19f)&&_0xd7bae7!==_0x37a616(0x19f)){_0x5e8fa8[_0x37a616(0x276)]=new Date();const _0x2f0df8=await currencyService_1[_0x37a616(0x25a)]['convertToUSDT'](_0x388b86[_0x37a616(0x28a)],_0x388b86[_0x37a616(0x204)]);_0x5e8fa8['amountUSDT']=_0x2f0df8,_0x165ff6=_0x2f0df8,_0x15b2f7+=_0x2f0df8,console[_0x37a616(0x29d)](_0x37a616(0x267)+_0x5dbead+_0x37a616(0x272)+_0x2f0df8[_0x37a616(0x1f9)](0x6)+_0x37a616(0x279));}else _0xd7bae7==='PAID'&&_0x9f338a!==_0x37a616(0x19f)&&(_0x388b86[_0x37a616(0x266)]&&(_0x165ff6=-_0x388b86[_0x37a616(0x266)],_0x15b2f7-=_0x388b86[_0x37a616(0x266)],_0x5e8fa8[_0x37a616(0x266)]=null,console['log'](_0x37a616(0x267)+_0x5dbead+'\x20no\x20longer\x20PAID:\x20-'+_0x388b86[_0x37a616(0x266)][_0x37a616(0x1f9)](0x6)+'\x20USDT\x20from\x20balance')));if(_0x9f338a==='CHARGEBACK'){if(_0xd7bae7===_0x37a616(0x19f)&&_0x388b86[_0x37a616(0x266)]){}_0x13cd21&&_0x13cd21>0x0&&(_0x165ff6-=_0x13cd21,_0x15b2f7-=_0x13cd21,console[_0x37a616(0x29d)](_0x37a616(0x208)+_0x13cd21[_0x37a616(0x1f9)](0x6)+'\x20USDT\x20from\x20balance'));}_0x9f338a==='REFUND'&&_0xd7bae7===_0x37a616(0x19f)&&console[_0x37a616(0x29d)](_0x37a616(0x1c7));const _0x4a28a6=await _0x14e060['payment'][_0x37a616(0x1e2)]({'where':{'id':_0x5dbead},'data':_0x5e8fa8,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x165ff6!==0x0&&(await _0x14e060[_0x37a616(0x1ad)][_0x37a616(0x1e2)]({'where':{'id':_0x388b86[_0x37a616(0x210)]},'data':{'balance':_0x15b2f7}}),console[_0x37a616(0x29d)](_0x37a616(0x1ec)+_0x388b86[_0x37a616(0x210)]+_0x37a616(0x28d)+_0x388b86['shop'][_0x37a616(0x1a4)][_0x37a616(0x1f9)](0x6)+_0x37a616(0x299)+_0x15b2f7[_0x37a616(0x1f9)](0x6)+_0x37a616(0x1c0)+(_0x165ff6>0x0?'+':'')+_0x165ff6[_0x37a616(0x1f9)](0x6)+')')),_0x4a28a6;});return{'id':_0x3d4150['id'],'shopId':_0x3d4150['shopId'],'gateway':_0x3d4150['gateway'],'amount':_0x3d4150[_0x25eb99(0x28a)],'currency':_0x3d4150['currency'],'status':_0x3d4150['status'],'orderId':_0x3d4150[_0x25eb99(0x29f)],'gatewayOrderId':_0x3d4150[_0x25eb99(0x288)],'customerEmail':_0x3d4150[_0x25eb99(0x228)],'customerName':_0x3d4150[_0x25eb99(0x1bf)],'customerCountry':_0x3d4150['customerCountry'],'customerIp':_0x3d4150[_0x25eb99(0x1f4)],'customerUa':_0x3d4150[_0x25eb99(0x298)],'failureMessage':_0x3d4150[_0x25eb99(0x1cc)],'adminNotes':_0x3d4150[_0x25eb99(0x1ab)],'chargebackAmount':_0x3d4150[_0x25eb99(0x283)],'statusChangedBy':_0x3d4150[_0x25eb99(0x27e)],'statusChangedAt':_0x3d4150[_0x25eb99(0x289)],'createdAt':_0x3d4150['createdAt'],'updatedAt':_0x3d4150['updatedAt'],'shop':_0x3d4150[_0x25eb99(0x1ad)]};}async['updateUser'](_0xbd3f20,_0x1af2c6){const _0x572763=a35_0x25ac54,_0x2d5b18={..._0x1af2c6};_0x1af2c6[_0x572763(0x1e9)]&&(_0x2d5b18[_0x572763(0x1e9)]=await bcryptjs_1[_0x572763(0x1ae)][_0x572763(0x29a)](_0x1af2c6['password'],0xc));_0x1af2c6['fullName']&&(_0x2d5b18[_0x572763(0x265)]=_0x1af2c6[_0x572763(0x26a)],delete _0x2d5b18[_0x572763(0x26a)]);_0x1af2c6['telegramId']&&(_0x2d5b18[_0x572763(0x205)]=_0x1af2c6[_0x572763(0x1e7)],delete _0x2d5b18[_0x572763(0x1e7)]);_0x1af2c6[_0x572763(0x1ee)]&&(_0x2d5b18[_0x572763(0x23e)]=_0x1af2c6[_0x572763(0x1ee)],delete _0x2d5b18['merchantUrl']);_0x1af2c6[_0x572763(0x20b)]&&(_0x2d5b18[_0x572763(0x253)]=JSON['stringify'](_0x1af2c6[_0x572763(0x20b)]),delete _0x2d5b18[_0x572763(0x20b)]);_0x1af2c6['gatewaySettings']&&(_0x2d5b18[_0x572763(0x26b)]=JSON['stringify'](_0x1af2c6[_0x572763(0x26b)]),delete _0x2d5b18[_0x572763(0x26b)]);_0x1af2c6['wallets']&&(_0x1af2c6['wallets'][_0x572763(0x281)]!==undefined&&(_0x2d5b18['usdtPolygonWallet']=_0x1af2c6[_0x572763(0x1a3)]['usdtPolygonWallet']||null),_0x1af2c6[_0x572763(0x1a3)]['usdtTrcWallet']!==undefined&&(_0x2d5b18[_0x572763(0x1c1)]=_0x1af2c6['wallets'][_0x572763(0x1c1)]||null),_0x1af2c6[_0x572763(0x1a3)][_0x572763(0x238)]!==undefined&&(_0x2d5b18[_0x572763(0x238)]=_0x1af2c6[_0x572763(0x1a3)][_0x572763(0x238)]||null),_0x1af2c6['wallets'][_0x572763(0x240)]!==undefined&&(_0x2d5b18[_0x572763(0x240)]=_0x1af2c6[_0x572763(0x1a3)][_0x572763(0x240)]||null),delete _0x2d5b18['wallets']);const _0x108252=await database_1['default'][_0x572763(0x1ad)][_0x572763(0x1e2)]({'where':{'id':_0xbd3f20},'data':_0x2d5b18,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x108252['id'],'fullName':_0x108252[_0x572763(0x265)],'username':_0x108252[_0x572763(0x250)],'telegramId':_0x108252[_0x572763(0x205)],'merchantUrl':_0x108252[_0x572763(0x23e)],'gateways':_0x108252['paymentGateways']?JSON[_0x572763(0x2a3)](_0x108252[_0x572763(0x253)]):null,'gatewaySettings':_0x108252[_0x572763(0x26b)]?JSON[_0x572763(0x2a3)](_0x108252[_0x572763(0x26b)]):null,'publicKey':_0x108252[_0x572763(0x21f)],'wallets':{'usdtPolygonWallet':_0x108252[_0x572763(0x281)],'usdtTrcWallet':_0x108252[_0x572763(0x1c1)],'usdtErcWallet':_0x108252[_0x572763(0x238)],'usdcPolygonWallet':_0x108252[_0x572763(0x240)]},'status':_0x108252[_0x572763(0x1bd)],'createdAt':_0x108252[_0x572763(0x26c)]};}async['suspendUser'](_0x15279e){const _0x1aa87b=a35_0x25ac54,_0x592068=await database_1[_0x1aa87b(0x1ae)][_0x1aa87b(0x1ad)][_0x1aa87b(0x1e2)]({'where':{'id':_0x15279e},'data':{'status':_0x1aa87b(0x1d4)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x592068['id'],'fullName':_0x592068[_0x1aa87b(0x265)],'username':_0x592068['username'],'telegramId':_0x592068[_0x1aa87b(0x205)],'merchantUrl':_0x592068[_0x1aa87b(0x23e)],'gateways':_0x592068[_0x1aa87b(0x253)]?JSON[_0x1aa87b(0x2a3)](_0x592068[_0x1aa87b(0x253)]):null,'gatewaySettings':_0x592068[_0x1aa87b(0x26b)]?JSON[_0x1aa87b(0x2a3)](_0x592068['gatewaySettings']):null,'publicKey':_0x592068[_0x1aa87b(0x21f)],'wallets':{'usdtPolygonWallet':_0x592068[_0x1aa87b(0x281)],'usdtTrcWallet':_0x592068['usdtTrcWallet'],'usdtErcWallet':_0x592068[_0x1aa87b(0x238)],'usdcPolygonWallet':_0x592068[_0x1aa87b(0x240)]},'status':_0x592068[_0x1aa87b(0x1bd)],'createdAt':_0x592068[_0x1aa87b(0x26c)]};}async[a35_0x25ac54(0x21d)](_0x3b6280){const _0x4a28c4=a35_0x25ac54,_0x7b5e5a=await database_1['default'][_0x4a28c4(0x1ad)][_0x4a28c4(0x1e2)]({'where':{'id':_0x3b6280},'data':{'status':_0x4a28c4(0x1a0)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x7b5e5a['id'],'fullName':_0x7b5e5a[_0x4a28c4(0x265)],'username':_0x7b5e5a[_0x4a28c4(0x250)],'telegramId':_0x7b5e5a['telegram'],'merchantUrl':_0x7b5e5a[_0x4a28c4(0x23e)],'gateways':_0x7b5e5a[_0x4a28c4(0x253)]?JSON[_0x4a28c4(0x2a3)](_0x7b5e5a[_0x4a28c4(0x253)]):null,'gatewaySettings':_0x7b5e5a[_0x4a28c4(0x26b)]?JSON[_0x4a28c4(0x2a3)](_0x7b5e5a[_0x4a28c4(0x26b)]):null,'publicKey':_0x7b5e5a[_0x4a28c4(0x21f)],'wallets':{'usdtPolygonWallet':_0x7b5e5a[_0x4a28c4(0x281)],'usdtTrcWallet':_0x7b5e5a[_0x4a28c4(0x1c1)],'usdtErcWallet':_0x7b5e5a[_0x4a28c4(0x238)],'usdcPolygonWallet':_0x7b5e5a['usdcPolygonWallet']},'status':_0x7b5e5a[_0x4a28c4(0x1bd)],'createdAt':_0x7b5e5a[_0x4a28c4(0x26c)]};}async[a35_0x25ac54(0x21a)](_0x44fefd){const _0x5757db=a35_0x25ac54,{page:_0x20ede2,limit:_0x545d41,status:_0xb24bfb}=_0x44fefd,_0x4ea7a4=(_0x20ede2-0x1)*_0x545d41,_0x413277={};_0xb24bfb&&(_0x413277[_0x5757db(0x1bd)]=_0xb24bfb[_0x5757db(0x271)]());const [_0x66d668,_0x213987]=await Promise[_0x5757db(0x258)]([database_1['default'][_0x5757db(0x1ad)][_0x5757db(0x1d0)]({'where':_0x413277,'skip':_0x4ea7a4,'take':_0x545d41,'orderBy':{'createdAt':_0x5757db(0x254)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x5757db(0x1ae)][_0x5757db(0x1ad)][_0x5757db(0x246)]({'where':_0x413277})]);return{'users':_0x66d668[_0x5757db(0x22a)](_0xab2007=>({'id':_0xab2007['id'],'fullName':_0xab2007['name'],'username':_0xab2007[_0x5757db(0x250)],'telegramId':_0xab2007[_0x5757db(0x205)],'merchantUrl':_0xab2007['shopUrl'],'gateways':_0xab2007['paymentGateways']?JSON[_0x5757db(0x2a3)](_0xab2007['paymentGateways']):null,'gatewaySettings':_0xab2007[_0x5757db(0x26b)]?JSON[_0x5757db(0x2a3)](_0xab2007[_0x5757db(0x26b)]):null,'publicKey':_0xab2007['publicKey'],'wallets':{'usdtPolygonWallet':_0xab2007[_0x5757db(0x281)],'usdtTrcWallet':_0xab2007[_0x5757db(0x1c1)],'usdtErcWallet':_0xab2007[_0x5757db(0x238)],'usdcPolygonWallet':_0xab2007[_0x5757db(0x240)]},'status':_0xab2007[_0x5757db(0x1bd)],'createdAt':_0xab2007['createdAt']})),'pagination':{'page':_0x20ede2,'limit':_0x545d41,'total':_0x213987,'totalPages':Math['ceil'](_0x213987/_0x545d41)}};}async[a35_0x25ac54(0x280)](_0x8b229b){const _0x1668b0=a35_0x25ac54,_0x3c47e3=await database_1[_0x1668b0(0x1ae)][_0x1668b0(0x1ad)][_0x1668b0(0x24a)]({'where':{'id':_0x8b229b},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x3c47e3)return null;return{'id':_0x3c47e3['id'],'fullName':_0x3c47e3[_0x1668b0(0x265)],'username':_0x3c47e3[_0x1668b0(0x250)],'telegramId':_0x3c47e3[_0x1668b0(0x205)],'merchantUrl':_0x3c47e3[_0x1668b0(0x23e)],'gateways':_0x3c47e3['paymentGateways']?JSON[_0x1668b0(0x2a3)](_0x3c47e3['paymentGateways']):null,'gatewaySettings':_0x3c47e3[_0x1668b0(0x26b)]?JSON[_0x1668b0(0x2a3)](_0x3c47e3[_0x1668b0(0x26b)]):null,'publicKey':_0x3c47e3['publicKey'],'wallets':{'usdtPolygonWallet':_0x3c47e3['usdtPolygonWallet'],'usdtTrcWallet':_0x3c47e3[_0x1668b0(0x1c1)],'usdtErcWallet':_0x3c47e3[_0x1668b0(0x238)],'usdcPolygonWallet':_0x3c47e3[_0x1668b0(0x240)]},'status':_0x3c47e3[_0x1668b0(0x1bd)],'createdAt':_0x3c47e3[_0x1668b0(0x26c)]};}async[a35_0x25ac54(0x1ca)](_0x320e40){const _0x511260=a35_0x25ac54,{fullName:_0x3fc2c9,username:_0x1dbc3c,password:_0xa4798d,telegramId:_0x58a0bc,merchantUrl:_0x352211,gateways:_0x4e30d1,gatewaySettings:_0x15c598,wallets:_0x2d3991}=_0x320e40,_0x3ccebb=await database_1[_0x511260(0x1ae)][_0x511260(0x1ad)]['findUnique']({'where':{'username':_0x1dbc3c}});if(_0x3ccebb)throw new Error(_0x511260(0x1a8));if(_0x58a0bc){const _0x5f52a6=await database_1[_0x511260(0x1ae)][_0x511260(0x1ad)][_0x511260(0x24a)]({'where':{'telegram':_0x58a0bc}});if(_0x5f52a6)throw new Error(_0x511260(0x202));}const _0x37655f=await bcryptjs_1['default'][_0x511260(0x29a)](_0xa4798d,0xc),_0x3b8acb=_0x511260(0x221)+crypto_1[_0x511260(0x1ae)][_0x511260(0x1e4)](0x20)['toString'](_0x511260(0x1cd)),_0x163291=_0x511260(0x207)+crypto_1[_0x511260(0x1ae)][_0x511260(0x1e4)](0x20)[_0x511260(0x1f2)](_0x511260(0x1cd)),_0x83c2ab=await database_1['default']['shop'][_0x511260(0x233)]({'data':{'name':_0x3fc2c9,'username':_0x1dbc3c,'password':_0x37655f,'telegram':_0x58a0bc,'shopUrl':_0x352211,'paymentGateways':_0x4e30d1?JSON['stringify'](_0x4e30d1):null,'gatewaySettings':_0x15c598?JSON[_0x511260(0x275)](_0x15c598):null,'usdtPolygonWallet':_0x2d3991?.[_0x511260(0x281)]||null,'usdtTrcWallet':_0x2d3991?.['usdtTrcWallet']||null,'usdtErcWallet':_0x2d3991?.[_0x511260(0x238)]||null,'usdcPolygonWallet':_0x2d3991?.[_0x511260(0x240)]||null,'publicKey':_0x3b8acb,'secretKey':_0x163291,'status':_0x511260(0x1a0)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x83c2ab['id'],'fullName':_0x83c2ab['name'],'username':_0x83c2ab[_0x511260(0x250)],'telegramId':_0x83c2ab['telegram'],'merchantUrl':_0x83c2ab['shopUrl'],'gateways':_0x83c2ab[_0x511260(0x253)]?JSON[_0x511260(0x2a3)](_0x83c2ab[_0x511260(0x253)]):null,'gatewaySettings':_0x83c2ab['gatewaySettings']?JSON[_0x511260(0x2a3)](_0x83c2ab[_0x511260(0x26b)]):null,'publicKey':_0x83c2ab['publicKey'],'wallets':{'usdtPolygonWallet':_0x83c2ab[_0x511260(0x281)],'usdtTrcWallet':_0x83c2ab['usdtTrcWallet'],'usdtErcWallet':_0x83c2ab[_0x511260(0x238)],'usdcPolygonWallet':_0x83c2ab['usdcPolygonWallet']},'status':_0x83c2ab[_0x511260(0x1bd)],'createdAt':_0x83c2ab[_0x511260(0x26c)]};}async[a35_0x25ac54(0x1c8)](_0x2d794d){const _0x528edc=a35_0x25ac54;await database_1[_0x528edc(0x1ae)][_0x528edc(0x1ad)][_0x528edc(0x1fb)]({'where':{'id':_0x2d794d}});}[a35_0x25ac54(0x1d6)](_0x370ec8,_0x19b083,_0x43a44b){const _0x36ad29=a35_0x25ac54,_0x49fdc5=new Map(),_0x2214a0=new Date(_0x19b083);while(_0x2214a0<=_0x43a44b){const _0xdea067=_0x2214a0[_0x36ad29(0x1b1)]()[_0x36ad29(0x201)]('T')[0x0];_0x49fdc5[_0x36ad29(0x2a0)](_0xdea067,{'revenue':0x0,'count':0x0}),_0x2214a0[_0x36ad29(0x1d5)](_0x2214a0[_0x36ad29(0x1db)]()+0x1);}for(const _0x47c85d of _0x370ec8){const _0x7d5a0e=_0x47c85d['createdAt'][_0x36ad29(0x1b1)]()[_0x36ad29(0x201)]('T')[0x0],_0x5f2ec2=_0x49fdc5['get'](_0x7d5a0e);_0x5f2ec2&&(_0x5f2ec2['count']+=0x1,_0x47c85d[_0x36ad29(0x1bd)]===_0x36ad29(0x19f)&&(_0x47c85d['amountUSDT']?_0x5f2ec2[_0x36ad29(0x255)]+=_0x47c85d[_0x36ad29(0x266)]:console[_0x36ad29(0x29d)](_0x36ad29(0x1dc)+_0x47c85d['id']+'\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion')));}const _0x1a3ee0=[],_0x4c3116=[];for(const [_0x2b533f,_0x14fc3e]of _0x49fdc5){_0x1a3ee0[_0x36ad29(0x290)]({'date':_0x2b533f,'amount':Math['round'](_0x14fc3e[_0x36ad29(0x255)]*0x64)/0x64}),_0x4c3116['push']({'date':_0x2b533f,'count':_0x14fc3e['count']});}return{'dailyRevenue':_0x1a3ee0,'dailyPayments':_0x4c3116};}}exports['AdminService']=AdminService;