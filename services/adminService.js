'use strict';const a40_0x3127cc=a40_0x2794;function a40_0x2794(_0xe14f14,_0x1096ec){const _0x1b9db0=a40_0x1b9d();return a40_0x2794=function(_0x279442,_0x1b9e45){_0x279442=_0x279442-0x98;let _0x5d8df7=_0x1b9db0[_0x279442];return _0x5d8df7;},a40_0x2794(_0xe14f14,_0x1096ec);}(function(_0x46c2b5,_0x308900){const _0x4434af=a40_0x2794,_0x1431ff=_0x46c2b5();while(!![]){try{const _0x1502ea=-parseInt(_0x4434af(0x1ac))/0x1+-parseInt(_0x4434af(0x14e))/0x2+-parseInt(_0x4434af(0x102))/0x3*(parseInt(_0x4434af(0xd3))/0x4)+-parseInt(_0x4434af(0x1bb))/0x5+-parseInt(_0x4434af(0x12d))/0x6*(-parseInt(_0x4434af(0x11a))/0x7)+-parseInt(_0x4434af(0x138))/0x8*(-parseInt(_0x4434af(0x192))/0x9)+parseInt(_0x4434af(0x163))/0xa;if(_0x1502ea===_0x308900)break;else _0x1431ff['push'](_0x1431ff['shift']());}catch(_0x504b1b){_0x1431ff['push'](_0x1431ff['shift']());}}}(a40_0x1b9d,0x44f48));function a40_0x1b9d(){const _0x3a980a=['shop',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','üîÑ\x20Admin\x20updating\x20payment\x20','‚ö†Ô∏è\x20Gateway\x20\x27','currency','\x20\x20\x20üè™\x20Gateway\x20earnings:\x20','payment','\x20\x20\x20üåç\x20Country:\x20','\x20\x20\x20‚è≥\x20Pending\x20payout:\x20','üìä\x20Getting\x20merchant\x20statistics\x20with\x20filters:','sk_','\x27\x20->\x20ID\x20\x27','test_gateway','dailyPayments','admin','15547nDKOhI','thisMonth','awaitingPayout','‚úÖ\x20Customer\x20data\x20updated\x20for\x20payment\x20','\x20\x20\x20ü§î\x20Difference:\x20','commissionUSDT','name','\x20PAID\x20payments','statusChangedBy','\x20\x20\x20Available\x20(number):\x20','updatedAt','password','dateFrom','totalAmountAfterCommissionUSDT','fullName','push','count','all','üîÑ\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','1362PmHqMW','getMerchantStatistics','polygon','gatewayOrderId','length','\x20USDT','üìä\x20Payout\x20statistics\x20calculated:','‚úÖ\x20Balance\x20check\x20passed\x20(with\x20tolerance)','revenue','totalPayout',']\x20Gateway\x20settings\x20before\x20saving:','424624rqbVte','customerIp','üìä\x20Gateway\x20filter\x20applied:','externalPaymentUrl','map','createPayout','./currencyService','\x27\x20(from\x20\x27','ACTIVE','dailyRevenue','customerEmail','üí∞\x20[PAYOUT]\x20Gateway\x20','setHours',']\x20Updating\x20password\x20for\x20user\x20','\x20\x20\x20Total\x20paid\x20out:\x20','values','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','üîÑ\x20Converted\x20gateway\x20ID\x20\x27','hex','üìä\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','rapyd','pendingPayout','138110UNqlzt','default','periodFrom','\x20USDT\x20(gross\x20revenue)','üìä\x20Sorting\x20payments\x20by\x20','averageCommissionRate','createdAt','pk_','üìä\x20Calculating\x20payout\x20statistics...','Open\x20Banking\x202','COMPLETED','üéØ\x20[','getAllPayments','\x20\x20\x20Balance:\x20','‚úÖ\x20Payout\x20created:\x20',']\x20Gateway\x20settings\x20JSON\x20string:','lte','toString','\x20USDT\x20(theoretical\x20net)','CoinToPay','periodTo','3206260fFoTkI','getDate','klyme_de','\x20\x20\x20üí∏\x20Total\x20payouts\x20(all\x20time):\x20','pendingUrl',',\x20successful:\x20','\x20for\x20shop\x20','\x20paid\x20payments\x20for\x20analysis','üîÑ\x20Gateway\x20mapping:','CHARGEBACK','‚úÖ\x20Using\x20gateway\x20filter:\x20\x27','getMerchantsAwaitingPayout','\x20\x20\x20Transaction\x20hash:\x20','paidOutUSDT','\x27\x20to\x20name\x20\x27','‚ö†Ô∏è\x20CHARGEBACK\x20without\x20penalty\x20amount\x20-\x20no\x20balance\x20change','failureMessage','orderId','gateway','%\x20from\x20','gte','üìä\x20Total\x20payments\x20(including\x20failed):\x20','üí∞\x20Creating\x20payout\x20for\x20shop\x20','\x20payments)','status','hash','currencyService','\x20\x20\x20üí∞\x20Total\x20payments\x20turnover:\x20','üìä\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20','üîß\x20[','payout','\x20USDT\x20(actual\x20balances)','successUrl','getUserById','\x20\x20\x20üîç\x20Calculated\x20after\x20commission:\x20','toISOString','getGatewayNameById','year','chargebackAmount','turnoverUSDT','\x20\x20\x20üñ•Ô∏è\x20User\x20Agent:\x20','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','activateUser','totalAmountUSDT','reduce','mastercard','Error\x20processing\x20payment\x20','90VmMCer','2020-01-01','__esModule','toLowerCase',',\x20userId:\x20','erc20','delete','\x20\x20\x20üí≥\x20Total\x20payments:\x20','üí∞\x20[PAYOUT]\x20Merchant\x20','cointopay2','\x20status:\x20','username','groupBy','totalPayments','publicKey','round','asc','findFirst','customerCountry','adminNotes','30d','crypto','convertToUSDT','‚ö†Ô∏è\x20Requested\x20gateway\x20\x27','gatewaySettings','amountAfterGatewayCommissionUSDT','178137BNLcJX','usdcPolygonWallet','\x20\x20\x20Added\x20to\x20balance:\x20+','month','aggregate','\x20USDT,\x20Requested:\x20','amountAfterCommissionUSDT','balance','shopUrl','gateways','turnover','paymentGateways','amount','totalPaidOut','üìä\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','2503685wuZwVd','totalCommissionRate','\x20\x20\x20Gateway:\x20','klyme_eu','setDate','wallets','week','telegramId','usdtPolygonWallet','klyme_gb','log','\x20to\x20','createUser','üìã\x20Getting\x20merchants\x20selection\x20list...','averageCheckUSDT','suspendUser','findUnique','\x20\x20\x20Merchant\x20loses:\x20','\x20\x20\x20üìÖ\x20This\x20month:\x20','updateCustomerData','üí∞\x20Payment\x20amount\x20is\x20NOT\x20deducted\x20(chargeback\x20penalty\x20only)','üí∏\x20CHARGEBACK:\x20Processing\x20penalty-only\x20deduction','telegram','\x20USDT\x20(total\x20paid\x20to\x20merchants)','\x20\x20\x20Full\x20amount:\x20','usdcErcWallet','üîê\x20[','txid','\x20\x20\x20üíµ\x20Available\x20balance:\x20','network','%\x20commission)','\x20\x20\x20Requested\x20(number):\x20','getFullYear','getMonth','notes','paymentsCount','\x20\x20\x20ÔøΩ\x20Total\x20paid\x20out:\x20','customerName','getAllPayouts','randomBytes','updateUser','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','\x20\x20\x20‚úÖ\x20Total\x20available\x20for\x20payout:\x20','warn','\x20\x20\x20üë§\x20Merchant\x20earnings:\x20','custom','substr','merchantEarnings','\x20USDT\x20(already\x20paid\x20out)','\x20USDT\x20from\x20balance','includes','get','\x20USDT)','error','merchantEarningsUSDT','SUSPENDED','noda','forEach','üí∞\x20Current\x20shop\x20balance:\x20','_count','üí∞\x20Payment\x20','PAID','\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)','bcryptjs','set','Noda','KLYME\x20EU','\x20\x20\x20Current\x20balance:\x20','‚ö†Ô∏è\x20Payment\x20','polygon_usdc','some','customerUa','findMany','\x20USDT\x20for\x20payment\x20','stringify','MasterCard','paidAt','usdtErcWallet','toFixed','getGatewayDisplayName',':\x20commission\x20=\x20','join','plisio','\x20USDT\x20(-','usdtTrcWallet','trim','\x20\x20\x20üí∞\x20Total\x20turnover:\x20','split','\x20USDT\x20(after\x20','toUpperCase','getTime','\x20USDT,\x20merchant:\x20','Payment\x20not\x20found','period','\x20USDT,\x20Difference:\x20','\x20balance\x20updated:\x20',',\x20Commission:\x20','ceil','KLYME\x20GB','\x27\x20not\x20found.\x20Available\x20gateways:\x20','statusChangedAt','8ffrvrL','üìä\x20Getting\x20payments\x20with\x20filters:','üîÑ\x20Gateway\x20mapping\x20(create):','üîç\x20Using\x20gateway\x20\x27','day','gatewayEarnings','Plisio','update','üí∞\x20Shop\x20','shopId','AdminService','getPayoutById','\x20order','parse','not\x20specified','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','sort','\x20USDT\x20(same\x20as\x20awaiting)','\x20\x20\x20Available\x20(raw):\x20','getGatewayInternalName','getMerchantsSelection','entries','desc','\x20\x20\x20Tolerance:\x20','üîÑ\x20Gateway\x20mapping\x20(get):','\x20merchants\x20with\x20positive\x20balance','cointopay','getPayoutStats','dateTo','commission','random','_sum','amountUSDT','not\x20set','create','date','Insufficient\x20balance.\x20Available:\x20','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','insensitive','gatewayCommissionRate','\x20\x20\x20ÔøΩ\x20Total\x20payments\x20turnover:\x20','üìä\x20Available\x20gateways\x20in\x20database:','üîÑ\x20Updating\x20customer\x20data\x20for\x20payment\x20','\x20\x20\x20üí∞\x20Total\x20payout:\x20','\x20->\x20','\x20active\x20merchants\x20for\x20selection','üîç\x20Balance\x20check\x20details:','487806EtqGIS','../types/gateway','$transaction','üîÑ\x20Converted\x20gateway\x20name\x20\x27','Username\x20already\x20exists','Test\x20Gateway','\x20became\x20PAID:','Telegram\x20username\x20already\x20exists','90d'];a40_0x1b9d=function(){return _0x3a980a;};return a40_0x1b9d();}var __importDefault=this&&this['__importDefault']||function(_0x44cd1b){const _0x136acb=a40_0x2794;return _0x44cd1b&&_0x44cd1b[_0x136acb(0x194)]?_0x44cd1b:{'default':_0x44cd1b};};Object['defineProperty'](exports,a40_0x3127cc(0x194),{'value':!![]}),exports[a40_0x3127cc(0xdd)]=void 0x0;const database_1=__importDefault(require('../config/database')),bcryptjs_1=__importDefault(require(a40_0x3127cc(0xad))),crypto_1=__importDefault(require(a40_0x3127cc(0x1a7))),currencyService_1=require(a40_0x3127cc(0x13e)),gateway_1=require(a40_0x3127cc(0x103));class AdminService{async[a40_0x3127cc(0xee)](){const _0x24557b=a40_0x3127cc;console[_0x24557b(0x1c5)](_0x24557b(0x156));const _0x4cf007=await database_1[_0x24557b(0x14f)][_0x24557b(0x10b)]['aggregate']({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x24557b(0x140)}}),_0x43514e=await database_1[_0x24557b(0x14f)][_0x24557b(0x111)]['count']({'where':{'status':_0x24557b(0xab),'gateway':{'not':'test_gateway'}}}),_0x1588a5=new Date(),_0x2a9fcb=new Date(_0x1588a5[_0x24557b(0x1db)](),_0x1588a5[_0x24557b(0x1dc)](),0x1),_0x26f794=new Date(_0x1588a5[_0x24557b(0x1db)](),_0x1588a5[_0x24557b(0x1dc)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x2be0ec=await database_1['default'][_0x24557b(0x181)][_0x24557b(0x1b0)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x2a9fcb,'lte':_0x26f794},'status':_0x24557b(0x158)}}),_0x41e8b9=_0x4cf007[_0x24557b(0xf2)][_0x24557b(0x1b9)]||0x0,_0x5b6005=_0x4cf007['_sum'][_0x24557b(0x1b3)]||0x0,_0x40a142=_0x2be0ec[_0x24557b(0xf2)]['amount']||0x0,_0x3f663f={'totalPayout':Math[_0x24557b(0x1a1)](_0x41e8b9*0x64)/0x64,'awaitingPayout':Math['round'](_0x5b6005*0x64)/0x64,'thisMonth':Math['round'](_0x40a142*0x64)/0x64,'availableBalance':Math[_0x24557b(0x1a1)](_0x5b6005*0x64)/0x64,'totalPayments':_0x43514e};return console['log'](_0x24557b(0x133)),console[_0x24557b(0x1c5)](_0x24557b(0xfe)+_0x3f663f[_0x24557b(0x136)]+_0x24557b(0x1d2)),console[_0x24557b(0x1c5)](_0x24557b(0x148)+_0x3f663f[_0x24557b(0x11c)]+'\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)'),console[_0x24557b(0x1c5)](_0x24557b(0x1d7)+_0x3f663f['availableBalance']+_0x24557b(0xe4)),console[_0x24557b(0x1c5)](_0x24557b(0x1cd)+_0x3f663f['thisMonth']+_0x24557b(0x132)),console[_0x24557b(0x1c5)](_0x24557b(0x199)+_0x3f663f['totalPayments']+_0x24557b(0x121)),_0x3f663f;}async[a40_0x3127cc(0x1ce)](_0x543d56,_0x3f9c1b){const _0x4a6e96=a40_0x3127cc;console[_0x4a6e96(0x1c5)](_0x4a6e96(0xfd)+_0x543d56+':',_0x3f9c1b);const _0x1db234=await database_1[_0x4a6e96(0x14f)][_0x4a6e96(0x111)][_0x4a6e96(0x1cb)]({'where':{'id':_0x543d56},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x1db234)throw new Error(_0x4a6e96(0xca));const _0x15445f={};_0x3f9c1b[_0x4a6e96(0x1a4)]!==undefined&&(_0x15445f['customerCountry']=_0x3f9c1b['customerCountry']||null);_0x3f9c1b[_0x4a6e96(0x139)]!==undefined&&(_0x15445f['customerIp']=_0x3f9c1b[_0x4a6e96(0x139)]||null);_0x3f9c1b[_0x4a6e96(0xb5)]!==undefined&&(_0x15445f[_0x4a6e96(0xb5)]=_0x3f9c1b[_0x4a6e96(0xb5)]||null);const _0xa73612=await database_1[_0x4a6e96(0x14f)][_0x4a6e96(0x111)][_0x4a6e96(0xda)]({'where':{'id':_0x543d56},'data':{..._0x15445f,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x4a6e96(0x1c5)](_0x4a6e96(0x11d)+_0x543d56),console[_0x4a6e96(0x1c5)](_0x4a6e96(0x112)+_0x1db234['customerCountry']+_0x4a6e96(0xff)+_0xa73612[_0x4a6e96(0x1a4)]),console[_0x4a6e96(0x1c5)]('\x20\x20\x20üåê\x20IP:\x20'+_0x1db234[_0x4a6e96(0x139)]+'\x20->\x20'+_0xa73612['customerIp']),console[_0x4a6e96(0x1c5)](_0x4a6e96(0x18b)+(_0x1db234[_0x4a6e96(0xb5)]?_0x4a6e96(0xae):_0x4a6e96(0xf4))+_0x4a6e96(0xff)+(_0xa73612[_0x4a6e96(0xb5)]?'set':_0x4a6e96(0xf4))),_0xa73612;}async['getSystemStatistics'](_0x19dcf0){const _0x2d133c=a40_0x3127cc,_0x5c06eb=new Date();let _0x3c372d;switch(_0x19dcf0[_0x2d133c(0x195)]()){case _0x2d133c(0xd7):_0x3c372d=new Date(_0x5c06eb[_0x2d133c(0x1db)](),_0x5c06eb['getMonth'](),_0x5c06eb[_0x2d133c(0x164)](),0x0,0x0,0x0,0x0);break;case'yesterday':const _0x42813c=new Date(_0x5c06eb);_0x42813c[_0x2d133c(0x1bf)](_0x42813c[_0x2d133c(0x164)]()-0x1),_0x3c372d=new Date(_0x42813c['getFullYear'](),_0x42813c['getMonth'](),_0x42813c[_0x2d133c(0x164)](),0x0,0x0,0x0,0x0);break;case'7d':_0x3c372d=new Date(_0x5c06eb['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x2d133c(0x1a6):_0x3c372d=new Date(_0x5c06eb[_0x2d133c(0xc8)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x2d133c(0x10a):_0x3c372d=new Date(_0x5c06eb['getTime']()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x2d133c(0x12b):const _0x4bb6c5=await database_1[_0x2d133c(0x14f)][_0x2d133c(0x111)][_0x2d133c(0x1a3)]({'where':{'gateway':{'not':_0x2d133c(0x117)}},'orderBy':{'createdAt':_0x2d133c(0x1a2)},'select':{'createdAt':!![]}});_0x3c372d=_0x4bb6c5?_0x4bb6c5[_0x2d133c(0x154)]:new Date(_0x2d133c(0x193));break;default:_0x3c372d=new Date(_0x5c06eb[_0x2d133c(0xc8)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}_0x3c372d[_0x2d133c(0x144)](0x0,0x0,0x0,0x0);let _0x47f5a5;if(_0x19dcf0['toLowerCase']()==='yesterday'){const _0x11b88b=new Date(_0x5c06eb);_0x11b88b['setDate'](_0x11b88b[_0x2d133c(0x164)]()-0x1),_0x47f5a5=new Date(_0x11b88b[_0x2d133c(0x1db)](),_0x11b88b[_0x2d133c(0x1dc)](),_0x11b88b['getDate'](),0x17,0x3b,0x3b,0x3e7);}const _0x252dc1={'gte':_0x3c372d};_0x47f5a5&&(_0x252dc1['lte']=_0x47f5a5);const [_0x6ff8f7,_0x511f4c,_0x12a197,_0x380a47,_0x57a581,_0x137760]=await Promise['all']([database_1[_0x2d133c(0x14f)][_0x2d133c(0x10b)][_0x2d133c(0x12a)](),database_1[_0x2d133c(0x14f)][_0x2d133c(0x10b)][_0x2d133c(0x12a)]({'where':{'status':'ACTIVE'}}),database_1['default'][_0x2d133c(0x111)][_0x2d133c(0x12a)]({'where':{'status':_0x2d133c(0xab),'createdAt':_0x252dc1,'gateway':{'not':'test_gateway'}}}),database_1[_0x2d133c(0x14f)]['payment'][_0x2d133c(0xb6)]({'where':{'status':_0x2d133c(0xab),'createdAt':_0x252dc1,'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1['default'][_0x2d133c(0x111)]['findMany']({'where':{'gateway':{'not':'test_gateway'}},'take':0xa,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x2d133c(0x111)][_0x2d133c(0xb6)]({'where':{'createdAt':_0x252dc1,'gateway':{'not':_0x2d133c(0x117)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x2962aa=0x0,_0x4611fd=0x0;for(const _0x315566 of _0x380a47){const _0x570c0e=await currencyService_1[_0x2d133c(0x17d)]['convertToUSDT'](_0x315566[_0x2d133c(0x1b8)],_0x315566[_0x2d133c(0x10f)]);_0x2962aa+=_0x570c0e;if(_0x315566['amountAfterGatewayCommissionUSDT']){const _0x4639df=await currencyService_1[_0x2d133c(0x17d)][_0x2d133c(0x1a8)](_0x315566[_0x2d133c(0x1b8)],_0x315566['currency']),_0x2705a8=_0x315566[_0x2d133c(0x1ab)],_0x1b5b6b=_0x4639df-_0x2705a8;_0x4611fd+=_0x1b5b6b;}}const _0x264634=_0x12a197>0x0?_0x2962aa/_0x12a197:0x0,_0x6cd9ce=this['generateDailyStatistics'](_0x137760,_0x3c372d,_0x47f5a5||_0x5c06eb),_0x8823af=await database_1[_0x2d133c(0x14f)][_0x2d133c(0x111)][_0x2d133c(0x12a)]({'where':{'createdAt':_0x252dc1,'gateway':{'not':_0x2d133c(0x117)}}}),_0x37c336=_0x8823af>0x0?_0x12a197/_0x8823af*0x64:0x0;return{'totalShops':_0x6ff8f7,'activeShops':_0x511f4c,'totalPayments':_0x12a197,'successfulPayments':_0x12a197,'totalAttempts':_0x8823af,'totalRevenue':Math[_0x2d133c(0x1a1)](_0x2962aa*0x64)/0x64,'trapayEarnings':Math[_0x2d133c(0x1a1)](_0x4611fd*0x64)/0x64,'averagePaymentAmount':Math[_0x2d133c(0x1a1)](_0x264634*0x64)/0x64,'conversionRate':Math[_0x2d133c(0x1a1)](_0x37c336*0x64)/0x64,'dailyRevenue':_0x6cd9ce[_0x2d133c(0x141)],'dailyPayments':_0x6cd9ce[_0x2d133c(0x118)],'recentPayments':_0x57a581['map'](_0x16527f=>({'id':_0x16527f['id'],'amount':_0x16527f[_0x2d133c(0x1b8)],'currency':_0x16527f[_0x2d133c(0x10f)],'status':_0x16527f[_0x2d133c(0x17b)],'gateway':_0x16527f['gateway'],'shop':_0x16527f[_0x2d133c(0x10b)],'createdAt':_0x16527f[_0x2d133c(0x154)]}))};}async[a40_0x3127cc(0x12e)](_0x5af7b0){const _0x393881=a40_0x3127cc;console['log'](_0x393881(0x114),_0x5af7b0);let _0xf8ca64,_0x3457cb=new Date();if(_0x5af7b0['period']===_0x393881(0x9b)&&_0x5af7b0[_0x393881(0x126)]&&_0x5af7b0[_0x393881(0xef)])_0xf8ca64=new Date(_0x5af7b0[_0x393881(0x126)]),_0x3457cb=new Date(_0x5af7b0[_0x393881(0xef)]),_0xf8ca64[_0x393881(0x144)](0x0,0x0,0x0,0x0),_0x3457cb[_0x393881(0x144)](0x17,0x3b,0x3b,0x3e7);else{const _0x4a91c2=new Date();switch(_0x5af7b0[_0x393881(0xcb)]){case _0x393881(0x1c1):_0xf8ca64=new Date(_0x4a91c2[_0x393881(0xc8)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x393881(0x1af):_0xf8ca64=new Date(_0x4a91c2[_0x393881(0xc8)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x393881(0x188):_0xf8ca64=new Date(_0x4a91c2[_0x393881(0xc8)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x393881(0x12b):default:_0xf8ca64=new Date('2020-01-01');break;}_0xf8ca64[_0x393881(0x144)](0x0,0x0,0x0,0x0),_0x3457cb[_0x393881(0x144)](0x17,0x3b,0x3b,0x3e7);}console[_0x393881(0x1c5)]('üìÖ\x20Period:\x20'+_0xf8ca64[_0x393881(0x186)]()+_0x393881(0x1c6)+_0x3457cb[_0x393881(0x186)]());const _0x5d24ee={'status':_0x393881(0xab),'gateway':{'not':_0x393881(0x117)},'paidAt':{'gte':_0xf8ca64,'lte':_0x3457cb}};_0x5af7b0[_0x393881(0xdc)]&&(_0x5d24ee[_0x393881(0xdc)]=_0x5af7b0[_0x393881(0xdc)]);const _0x1bedfd=await database_1[_0x393881(0x14f)]['payment'][_0x393881(0xb6)]({'where':_0x5d24ee,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x393881(0x1c5)]('üí∞\x20Found\x20'+_0x1bedfd[_0x393881(0x131)]+_0x393881(0x16a));const _0x18ad7f={'gateway':{'not':_0x393881(0x117)},'createdAt':{'gte':_0xf8ca64,'lte':_0x3457cb}};_0x5af7b0[_0x393881(0xdc)]&&(_0x18ad7f[_0x393881(0xdc)]=_0x5af7b0[_0x393881(0xdc)]);const _0x6df753=await database_1['default'][_0x393881(0x111)][_0x393881(0x12a)]({'where':_0x18ad7f});console[_0x393881(0x1c5)](_0x393881(0x178)+_0x6df753+_0x393881(0x168)+_0x1bedfd[_0x393881(0x131)]);let _0x2cc10e=0x0,_0x594fbb=0x0,_0x3cb02b=0x0;const _0x395aae={},_0x351671={},_0x1a8f9a={};for(const _0x469e03 of _0x1bedfd){try{const _0x3f6d39=_0x469e03[_0x393881(0xf3)]||0x0;if(_0x3f6d39<=0x0){console[_0x393881(0x99)](_0x393881(0xb2)+_0x469e03['id']+'\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...');continue;}let _0x2fd4ab,_0x4f2c59;if(_0x469e03['amountAfterGatewayCommissionUSDT']!==null&&_0x469e03[_0x393881(0x1ab)]!==undefined)_0x2fd4ab=_0x469e03['amountAfterGatewayCommissionUSDT'],_0x4f2c59=_0x3f6d39-_0x2fd4ab,console[_0x393881(0x1c5)]('üìä\x20Using\x20saved\x20values\x20for\x20payment\x20'+_0x469e03['id']+':\x20'+_0x3f6d39[_0x393881(0xbc)](0x6)+_0x393881(0xc9)+_0x2fd4ab[_0x393881(0xbc)](0x6)+_0x393881(0x132));else{let _0x64b344={};if(_0x469e03[_0x393881(0x10b)]['gatewaySettings'])try{_0x64b344=JSON[_0x393881(0xe0)](_0x469e03[_0x393881(0x10b)][_0x393881(0x1aa)]);}catch(_0x4cda50){console[_0x393881(0xa3)](_0x393881(0xf8)+_0x469e03[_0x393881(0xdc)]+':',_0x4cda50);}let _0x313910=0x2d;for(const [_0x3a1599,_0x84e594]of Object['entries'](_0x64b344)){if(_0x3a1599[_0x393881(0x195)]()===_0x469e03[_0x393881(0x175)][_0x393881(0x195)]()){_0x313910=_0x84e594[_0x393881(0xf0)]||0x2d;break;}}_0x4f2c59=_0x3f6d39*(_0x313910/0x64),_0x2fd4ab=_0x3f6d39-_0x4f2c59,console[_0x393881(0x1c5)](_0x393881(0x14b)+_0x469e03['id']+':\x20'+_0x313910+_0x393881(0x176)+_0x3f6d39[_0x393881(0xbc)](0x6)+_0x393881(0x132));}_0x2cc10e+=_0x3f6d39,_0x594fbb+=_0x2fd4ab,_0x3cb02b+=_0x4f2c59;let _0x2e6c43;_0x469e03[_0x393881(0xfa)]!==null&&_0x469e03[_0x393881(0xfa)]!==undefined?(_0x2e6c43=_0x469e03[_0x393881(0xfa)],console[_0x393881(0x1c5)](_0x393881(0x17f)+_0x469e03['id']+':\x20'+_0x2e6c43+'%')):(_0x2e6c43=_0x3f6d39>0x0?_0x4f2c59/_0x3f6d39*0x64:0x0,console[_0x393881(0x1c5)]('üìä\x20Calculated\x20commission\x20rate\x20for\x20payment\x20'+_0x469e03['id']+':\x20'+_0x2e6c43[_0x393881(0xbc)](0x2)+'%'));!_0x395aae[_0x469e03['gateway']]&&(_0x395aae[_0x469e03[_0x393881(0x175)]]={'gateway':_0x469e03['gateway'],'gatewayDisplayName':this[_0x393881(0xbd)](_0x469e03['gateway']),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x395aae[_0x469e03[_0x393881(0x175)]][_0x393881(0x1de)]++,_0x395aae[_0x469e03[_0x393881(0x175)]][_0x393881(0x18a)]+=_0x3f6d39,_0x395aae[_0x469e03['gateway']][_0x393881(0x11f)]+=_0x4f2c59,_0x395aae[_0x469e03['gateway']]['merchantEarningsUSDT']+=_0x2fd4ab,_0x395aae[_0x469e03['gateway']]['totalCommissionRate']+=_0x2e6c43;!_0x5af7b0[_0x393881(0xdc)]&&(!_0x351671[_0x469e03[_0x393881(0xdc)]]&&(_0x351671[_0x469e03['shopId']]={'shopId':_0x469e03[_0x393881(0xdc)],'shopName':_0x469e03[_0x393881(0x10b)][_0x393881(0x120)],'shopUsername':_0x469e03[_0x393881(0x10b)][_0x393881(0x19d)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x351671[_0x469e03[_0x393881(0xdc)]]['paymentsCount']++,_0x351671[_0x469e03[_0x393881(0xdc)]][_0x393881(0x18a)]+=_0x3f6d39,_0x351671[_0x469e03[_0x393881(0xdc)]][_0x393881(0x11f)]+=_0x4f2c59,_0x351671[_0x469e03[_0x393881(0xdc)]][_0x393881(0xa4)]+=_0x2fd4ab);const _0x41cd4e=_0x469e03[_0x393881(0xba)]['toISOString']()[_0x393881(0xc5)]('T')[0x0];!_0x1a8f9a[_0x41cd4e]&&(_0x1a8f9a[_0x41cd4e]={'date':_0x41cd4e,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x1a8f9a[_0x41cd4e][_0x393881(0x1b6)]+=_0x3f6d39,_0x1a8f9a[_0x41cd4e][_0x393881(0x9d)]+=_0x2fd4ab,_0x1a8f9a[_0x41cd4e][_0x393881(0xd8)]+=_0x4f2c59,_0x1a8f9a[_0x41cd4e][_0x393881(0x1de)]++;}catch(_0x381666){console[_0x393881(0xa3)](_0x393881(0x191)+_0x469e03['id']+':',_0x381666);}}Object[_0x393881(0x147)](_0x395aae)[_0x393881(0xa7)](_0x4df7f0=>{const _0x4f7052=_0x393881;_0x4df7f0[_0x4f7052(0x153)]=_0x4df7f0[_0x4f7052(0x1de)]>0x0?_0x4df7f0['totalCommissionRate']/_0x4df7f0[_0x4f7052(0x1de)]:0x0,delete _0x4df7f0[_0x4f7052(0x1bc)];}),Object[_0x393881(0x147)](_0x351671)[_0x393881(0xa7)](_0x1f7298=>{const _0x5cb4c7=_0x393881;_0x1f7298[_0x5cb4c7(0x1c9)]=_0x1f7298['paymentsCount']>0x0?_0x1f7298['turnoverUSDT']/_0x1f7298[_0x5cb4c7(0x1de)]:0x0;});let _0x55a2f1=0x0,_0x336b4f=0x0;if(_0x5af7b0['shopId']){const _0x219059=await database_1[_0x393881(0x14f)][_0x393881(0x181)]['findMany']({'where':{'shopId':_0x5af7b0[_0x393881(0xdc)],'status':_0x393881(0x158),'createdAt':{'gte':_0xf8ca64,'lte':_0x3457cb}},'select':{'amount':!![]}});_0x55a2f1=_0x219059[_0x393881(0x18f)]((_0x3c396c,_0x4e0f18)=>_0x3c396c+_0x4e0f18[_0x393881(0x1b8)],0x0);const _0x2076fc=await database_1[_0x393881(0x14f)]['payout']['findMany']({'where':{'shopId':_0x5af7b0['shopId'],'status':'PENDING','createdAt':{'gte':_0xf8ca64,'lte':_0x3457cb}},'select':{'amount':!![]}});_0x336b4f=_0x2076fc[_0x393881(0x18f)]((_0x6d8fba,_0x3d1089)=>_0x6d8fba+_0x3d1089[_0x393881(0x1b8)],0x0);}const _0x3fb649=_0x6df753,_0x461801=_0x1bedfd[_0x393881(0x131)],_0x555d20=_0x461801>0x0?_0x2cc10e/_0x461801:0x0,_0x5c5aed=_0x3fb649>0x0?Math[_0x393881(0x1a1)](_0x461801/_0x3fb649*0x2710)/0x64:0x0,_0x483318=Math[_0x393881(0xcf)]((_0x3457cb[_0x393881(0xc8)]()-_0xf8ca64[_0x393881(0xc8)]())/(0x3e8*0x3c*0x3c*0x18)),_0x3114bd={'totalTurnover':Math[_0x393881(0x1a1)](_0x2cc10e*0x64)/0x64,'merchantEarnings':Math[_0x393881(0x1a1)](_0x594fbb*0x64)/0x64,'gatewayEarnings':Math[_0x393881(0x1a1)](_0x3cb02b*0x64)/0x64,'totalPaidOut':Math[_0x393881(0x1a1)](_0x55a2f1*0x64)/0x64,'pendingPayout':Math[_0x393881(0x1a1)](_0x336b4f*0x64)/0x64,'averageCheck':Math[_0x393881(0x1a1)](_0x555d20*0x64)/0x64,'totalPayments':_0x3fb649,'successfulPayments':_0x461801,'conversionRate':_0x5c5aed,'gatewayBreakdown':Object['values'](_0x395aae)[_0x393881(0x13c)](_0x5a23e3=>({..._0x5a23e3,'turnoverUSDT':Math[_0x393881(0x1a1)](_0x5a23e3[_0x393881(0x18a)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x5a23e3[_0x393881(0x11f)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x393881(0x1a1)](_0x5a23e3[_0x393881(0xa4)]*0x64)/0x64,'averageCommissionRate':Math[_0x393881(0x1a1)](_0x5a23e3[_0x393881(0x153)]*0x64)/0x64})),'merchantBreakdown':_0x5af7b0[_0x393881(0xdc)]?undefined:Object[_0x393881(0x147)](_0x351671)[_0x393881(0x13c)](_0x5bb9f4=>({..._0x5bb9f4,'turnoverUSDT':Math[_0x393881(0x1a1)](_0x5bb9f4['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x393881(0x1a1)](_0x5bb9f4[_0x393881(0x11f)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x393881(0x1a1)](_0x5bb9f4[_0x393881(0xa4)]*0x64)/0x64,'paidOutUSDT':Math['round'](_0x5bb9f4[_0x393881(0x170)]*0x64)/0x64,'averageCheckUSDT':Math[_0x393881(0x1a1)](_0x5bb9f4[_0x393881(0x1c9)]*0x64)/0x64})),'dailyData':Object['values'](_0x1a8f9a)[_0x393881(0x13c)](_0x12ec85=>({..._0x12ec85,'turnover':Math['round'](_0x12ec85['turnover']*0x64)/0x64,'merchantEarnings':Math[_0x393881(0x1a1)](_0x12ec85['merchantEarnings']*0x64)/0x64,'gatewayEarnings':Math[_0x393881(0x1a1)](_0x12ec85['gatewayEarnings']*0x64)/0x64}))[_0x393881(0xe3)]((_0x2617d8,_0x51ed3b)=>_0x2617d8[_0x393881(0xf6)]['localeCompare'](_0x51ed3b['date'])),'periodInfo':{'from':_0xf8ca64,'to':_0x3457cb,'periodType':_0x5af7b0[_0x393881(0xcb)]||_0x393881(0x9b),'daysCount':_0x483318}};return console['log']('üìä\x20Merchant\x20statistics\x20calculated:'),console['log'](_0x393881(0xc4)+_0x3114bd['totalTurnover']+'\x20USDT'),console['log'](_0x393881(0x9a)+_0x3114bd[_0x393881(0x9d)]+_0x393881(0x132)),console[_0x393881(0x1c5)](_0x393881(0x110)+_0x3114bd['gatewayEarnings']+'\x20USDT'),console['log'](_0x393881(0x1df)+_0x3114bd['totalPaidOut']+_0x393881(0x132)),console[_0x393881(0x1c5)](_0x393881(0x113)+_0x3114bd[_0x393881(0x14d)]+_0x393881(0x132)),console[_0x393881(0x1c5)]('\x20\x20\x20ÔøΩüìä\x20Total\x20payments:\x20'+_0x3114bd[_0x393881(0x19f)]),_0x3114bd;}async[a40_0x3127cc(0xe7)](){const _0xd51520=a40_0x3127cc;console[_0xd51520(0x1c5)](_0xd51520(0x1c8));const _0x4fa177=await database_1[_0xd51520(0x14f)]['shop'][_0xd51520(0xb6)]({'where':{'status':'ACTIVE'},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0xd51520(0x1a2)}});return console['log']('üìã\x20Found\x20'+_0x4fa177[_0xd51520(0x131)]+_0xd51520(0x100)),_0x4fa177[_0xd51520(0x13c)](_0x520c7f=>({'id':_0x520c7f['id'],'username':_0x520c7f[_0xd51520(0x19d)],'name':_0x520c7f[_0xd51520(0x120)]}));}[a40_0x3127cc(0xbd)](_0x4c97a1){const _0x2adcfe=a40_0x3127cc,_0x321b05={'test_gateway':_0x2adcfe(0x107),'plisio':_0x2adcfe(0xd9),'rapyd':'Rapyd','noda':_0x2adcfe(0xaf),'cointopay':_0x2adcfe(0x161),'cointopay2':_0x2adcfe(0x157),'klyme_eu':_0x2adcfe(0xb0),'klyme_gb':_0x2adcfe(0xd0),'klyme_de':'KLYME\x20DE','mastercard':_0x2adcfe(0xb9)};return _0x321b05[_0x4c97a1]||_0x4c97a1;}['getGatewayInternalName'](_0x9c5c42){const _0x284349=a40_0x3127cc,_0x5b31a8={'Test\x20Gateway':_0x284349(0x117),'Plisio':_0x284349(0xc0),'Rapyd':_0x284349(0x14c),'Noda':_0x284349(0xa6),'CoinToPay':_0x284349(0xed),'CoinToPay2':_0x284349(0x19b),'KLYME\x20EU':_0x284349(0x1be),'KLYME\x20GB':_0x284349(0x1c4),'KLYME\x20DE':_0x284349(0x165),'MasterCard':_0x284349(0x190)};return _0x5b31a8[_0x9c5c42]||_0x9c5c42[_0x284349(0x195)]();}async[a40_0x3127cc(0x16e)](_0x58cafd){const _0x3e80ce=a40_0x3127cc,{page:_0x1d7035,limit:_0x43bf71,minAmount:_0x55bdf3,search:_0x3bea7b}=_0x58cafd,_0x47a9e2=(_0x1d7035-0x1)*_0x43bf71;console[_0x3e80ce(0x1c5)]('üìä\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:',_0x58cafd);const _0x3ef19c={'balance':{'gt':0x0},'status':_0x3e80ce(0x140)};_0x55bdf3&&(_0x3ef19c[_0x3e80ce(0x1b3)][_0x3e80ce(0x177)]=_0x55bdf3);_0x3bea7b&&(_0x3ef19c[_0x3e80ce(0x120)]={'contains':_0x3bea7b,'mode':_0x3e80ce(0xf9)});const [_0x126299,_0x54ad0e]=await Promise[_0x3e80ce(0x12b)]([database_1[_0x3e80ce(0x14f)]['shop']['findMany']({'where':_0x3ef19c,'skip':_0x47a9e2,'take':_0x43bf71,'orderBy':{'balance':_0x3e80ce(0xe9)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1['default']['shop'][_0x3e80ce(0x12a)]({'where':_0x3ef19c})]);console[_0x3e80ce(0x1c5)]('üí∞\x20Found\x20'+_0x126299[_0x3e80ce(0x131)]+_0x3e80ce(0xec));const _0x4f54d2=await Promise[_0x3e80ce(0x12b)](_0x126299[_0x3e80ce(0x13c)](async _0x2935e0=>{const _0x13d8a4=_0x3e80ce,[_0x4f0781,_0x229cf7,_0xc1adf]=await Promise['all']([database_1[_0x13d8a4(0x14f)][_0x13d8a4(0x111)][_0x13d8a4(0x12a)]({'where':{'shopId':_0x2935e0['id'],'status':'PAID','gateway':{'not':_0x13d8a4(0x117)}}}),database_1[_0x13d8a4(0x14f)][_0x13d8a4(0x111)][_0x13d8a4(0x1a3)]({'where':{'shopId':_0x2935e0['id'],'status':'PAID','gateway':{'not':_0x13d8a4(0x117)}},'orderBy':{'paidAt':'asc'},'select':{'paidAt':!![]}}),database_1[_0x13d8a4(0x14f)][_0x13d8a4(0x111)][_0x13d8a4(0x19e)]({'by':[_0x13d8a4(0x175)],'where':{'shopId':_0x2935e0['id'],'status':_0x13d8a4(0xab),'gateway':{'not':_0x13d8a4(0x117)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x3b879d=new Date(),_0x5c1d64=new Date(_0x3b879d[_0x13d8a4(0x1db)](),_0x3b879d['getMonth'](),0x1),_0x4f4f4a=new Date(_0x3b879d[_0x13d8a4(0x1db)](),_0x3b879d[_0x13d8a4(0x1dc)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x28bd48,_0x47c59d]=await Promise[_0x13d8a4(0x12b)]([database_1[_0x13d8a4(0x14f)][_0x13d8a4(0x181)][_0x13d8a4(0x1b0)]({'_sum':{'amount':!![]},'where':{'shopId':_0x2935e0['id'],'status':_0x13d8a4(0x158)}}),database_1[_0x13d8a4(0x14f)][_0x13d8a4(0x181)][_0x13d8a4(0x1b0)]({'_sum':{'amount':!![]},'where':{'shopId':_0x2935e0['id'],'status':_0x13d8a4(0x158),'createdAt':{'gte':_0x5c1d64,'lte':_0x4f4f4a}}})]),_0x27e11b=_0x28bd48[_0x13d8a4(0xf2)][_0x13d8a4(0x1b8)]||0x0,_0x438948=_0x47c59d[_0x13d8a4(0xf2)]['amount']||0x0,_0x52f23a=await Promise[_0x13d8a4(0x12b)](_0xc1adf[_0x13d8a4(0x13c)](async _0x15db2f=>{const _0x50185d=_0x13d8a4;let _0x406f78=0x2d;if(_0x2935e0[_0x50185d(0x1aa)])try{const _0x4762fa=JSON[_0x50185d(0xe0)](_0x2935e0['gatewaySettings']);for(const [_0x44689b,_0x32a283]of Object[_0x50185d(0xe8)](_0x4762fa)){if(_0x44689b[_0x50185d(0x195)]()===_0x15db2f['gateway']['toLowerCase']()){_0x406f78=_0x32a283[_0x50185d(0xf0)]||0xa,console[_0x50185d(0x1c5)](_0x50185d(0x143)+_0x15db2f[_0x50185d(0x175)]+_0x50185d(0x169)+_0x2935e0['id']+_0x50185d(0xbe)+_0x406f78+'%');break;}}}catch(_0x278eaf){console[_0x50185d(0xa3)](_0x50185d(0xf8)+_0x2935e0['id']+':',_0x278eaf);}const _0x3b34db=_0x15db2f[_0x50185d(0xf2)]?.[_0x50185d(0xf3)]||0x0,_0x321ec7=_0x3b34db*(0x1-_0x406f78/0x64);return{'gateway':_0x15db2f['gateway'],'count':_0x15db2f['_count']?.['id']||0x0,'amountUSDT':Math[_0x50185d(0x1a1)](_0x3b34db*0x64)/0x64,'amountAfterCommissionUSDT':Math['round'](_0x321ec7*0x64)/0x64,'commission':_0x406f78};})),_0x25d57c=_0x52f23a['reduce']((_0x1ad301,_0x577c00)=>_0x1ad301+_0x577c00['amountUSDT'],0x0),_0x372c29=_0x52f23a[_0x13d8a4(0x18f)]((_0x467585,_0x58131b)=>_0x467585+_0x58131b[_0x13d8a4(0x1b2)],0x0),_0x21adeb=_0x2935e0['balance'];return console['log'](_0x13d8a4(0x19a)+_0x2935e0['username']+':'),console[_0x13d8a4(0x1c5)](_0x13d8a4(0xfb)+_0x25d57c[_0x13d8a4(0xbc)](0x2)+_0x13d8a4(0x151)),console['log'](_0x13d8a4(0x185)+_0x372c29[_0x13d8a4(0xbc)](0x2)+_0x13d8a4(0x160)),console[_0x13d8a4(0x1c5)]('\x20\x20\x20‚úÖ\x20Actual\x20available\x20balance:\x20'+_0x21adeb[_0x13d8a4(0xbc)](0x2)+'\x20USDT\x20(current\x20balance\x20in\x20DB)'),console['log']('\x20\x20\x20üí∏\x20Total\x20payouts:\x20'+_0x27e11b[_0x13d8a4(0xbc)](0x2)+_0x13d8a4(0x9e)),console['log'](_0x13d8a4(0x11e)+(_0x372c29-_0x27e11b-_0x21adeb)[_0x13d8a4(0xbc)](0x2)+_0x13d8a4(0xac)),{'id':_0x2935e0['id'],'fullName':_0x2935e0[_0x13d8a4(0x120)],'username':_0x2935e0[_0x13d8a4(0x19d)],'telegramId':_0x2935e0[_0x13d8a4(0x1d1)],'merchantUrl':_0x2935e0['shopUrl'],'wallets':{'usdtPolygonWallet':_0x2935e0['usdtPolygonWallet'],'usdtTrcWallet':_0x2935e0[_0x13d8a4(0xc2)],'usdtErcWallet':_0x2935e0[_0x13d8a4(0xbb)],'usdcPolygonWallet':_0x2935e0[_0x13d8a4(0x1ad)],'usdcErcWallet':_0x2935e0['usdcErcWallet']},'totalAmountUSDT':Math[_0x13d8a4(0x1a1)](_0x25d57c*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x13d8a4(0x1a1)](_0x372c29*0x64)/0x64,'currentBalance':Math[_0x13d8a4(0x1a1)](_0x21adeb*0x64)/0x64,'totalPayout':Math[_0x13d8a4(0x1a1)](_0x27e11b*0x64)/0x64,'thisMonth':Math[_0x13d8a4(0x1a1)](_0x438948*0x64)/0x64,'paymentsCount':_0x4f0781,'oldestPaymentDate':_0x229cf7?.['paidAt']||_0x2935e0[_0x13d8a4(0x154)],'gatewayBreakdown':_0x52f23a};})),_0x5b28d4=_0x4f54d2[_0x3e80ce(0x18f)]((_0xa9d355,_0x4b50c5)=>_0xa9d355+_0x4b50c5[_0x3e80ce(0x18e)],0x0),_0xcb0aa8=_0x4f54d2[_0x3e80ce(0x18f)]((_0x2c2821,_0x49befc)=>_0x2c2821+_0x49befc[_0x3e80ce(0x127)],0x0),_0x472274=_0x4f54d2['reduce']((_0x3e0a0b,_0x3e6440)=>_0x3e0a0b+_0x3e6440[_0x3e80ce(0x136)],0x0),_0x598dac=_0x4f54d2[_0x3e80ce(0x18f)]((_0x19bf44,_0x264835)=>_0x19bf44+_0x264835[_0x3e80ce(0x11b)],0x0);return console['log']('üìä\x20Merchants\x20awaiting\x20payout:\x20'+_0x54ad0e+'\x20merchants'),console[_0x3e80ce(0x1c5)](_0x3e80ce(0x17e)+Math[_0x3e80ce(0x1a1)](_0x5b28d4*0x64)/0x64+_0x3e80ce(0x151)),console[_0x3e80ce(0x1c5)](_0x3e80ce(0x98)+Math[_0x3e80ce(0x1a1)](_0xcb0aa8*0x64)/0x64+_0x3e80ce(0x182)),console[_0x3e80ce(0x1c5)](_0x3e80ce(0x166)+Math[_0x3e80ce(0x1a1)](_0x472274*0x64)/0x64+_0x3e80ce(0x132)),console[_0x3e80ce(0x1c5)]('\x20\x20\x20üìÖ\x20Total\x20payouts\x20(this\x20month):\x20'+Math[_0x3e80ce(0x1a1)](_0x598dac*0x64)/0x64+_0x3e80ce(0x132)),{'merchants':_0x4f54d2,'pagination':{'page':_0x1d7035,'limit':_0x43bf71,'total':_0x54ad0e,'totalPages':Math[_0x3e80ce(0xcf)](_0x54ad0e/_0x43bf71)},'summary':{'totalMerchants':_0x54ad0e,'totalAmountUSDT':Math[_0x3e80ce(0x1a1)](_0x5b28d4*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x3e80ce(0x1a1)](_0xcb0aa8*0x64)/0x64,'totalPayout':Math['round'](_0x472274*0x64)/0x64,'thisMonth':Math[_0x3e80ce(0x1a1)](_0x598dac*0x64)/0x64}};}async[a40_0x3127cc(0x13d)](_0x38c271){const _0x108bd0=a40_0x3127cc,{shopId:_0x3582f9,amount:_0x4bc6c8,network:_0x4e1fe9,wallet:_0x1228c4,notes:_0x34f3de,txid:_0x288bc8,periodFrom:_0x5b481b,periodTo:_0x3a374c}=_0x38c271,_0x40e1f1=await database_1[_0x108bd0(0x14f)][_0x108bd0(0x104)](async _0x39cafa=>{const _0x3f5858=_0x108bd0,_0x3a8f20=await _0x39cafa[_0x3f5858(0x10b)][_0x3f5858(0x1cb)]({'where':{'id':_0x3582f9},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x3a8f20)throw new Error('Shop\x20not\x20found');console[_0x3f5858(0x1c5)](_0x3f5858(0x179)+_0x3a8f20[_0x3f5858(0x19d)]+':'),console[_0x3f5858(0x1c5)](_0x3f5858(0xb1)+_0x3a8f20[_0x3f5858(0x1b3)][_0x3f5858(0xbc)](0x6)+'\x20USDT'),console[_0x3f5858(0x1c5)]('\x20\x20\x20Payout\x20amount:\x20'+_0x4bc6c8[_0x3f5858(0xbc)](0x6)+_0x3f5858(0x132)),console['log'](_0x3f5858(0xe2)+_0x3a8f20['totalPaidOut'][_0x3f5858(0xbc)](0x6)+'\x20USDT');if(_0x288bc8)console[_0x3f5858(0x1c5)](_0x3f5858(0x16f)+_0x288bc8);const _0x74d196=0.000001,_0x191de1=Number(_0x3a8f20[_0x3f5858(0x1b3)]),_0x5a9fe1=Number(_0x4bc6c8);console['log'](_0x3f5858(0x101)),console[_0x3f5858(0x1c5)](_0x3f5858(0xe5)+_0x3a8f20[_0x3f5858(0x1b3)]),console[_0x3f5858(0x1c5)](_0x3f5858(0x123)+_0x191de1),console[_0x3f5858(0x1c5)](_0x3f5858(0x1da)+_0x5a9fe1),console[_0x3f5858(0x1c5)]('\x20\x20\x20Difference:\x20'+(_0x191de1-_0x5a9fe1)),console['log'](_0x3f5858(0xea)+_0x74d196);if(_0x191de1<_0x5a9fe1-_0x74d196)throw new Error(_0x3f5858(0xf7)+_0x191de1[_0x3f5858(0xbc)](0x6)+_0x3f5858(0x1b1)+_0x5a9fe1['toFixed'](0x6)+_0x3f5858(0xcc)+(_0x191de1-_0x5a9fe1)[_0x3f5858(0xbc)](0x8)+_0x3f5858(0x132));console[_0x3f5858(0x1c5)](_0x3f5858(0x134));const _0xc2464c=Math['min'](_0x191de1,_0x5a9fe1);let _0x3d63f2=_0x1228c4;if(!_0x3d63f2){const _0x3ec9be=await _0x39cafa[_0x3f5858(0x10b)][_0x3f5858(0x1cb)]({'where':{'id':_0x3582f9},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});if(_0x3ec9be)switch(_0x4e1fe9){case _0x3f5858(0x12f):_0x3d63f2=_0x3ec9be['usdtPolygonWallet']||undefined;break;case'trc20':_0x3d63f2=_0x3ec9be[_0x3f5858(0xc2)]||undefined;break;case _0x3f5858(0x197):_0x3d63f2=_0x3ec9be[_0x3f5858(0xbb)]||undefined;break;case _0x3f5858(0xb3):_0x3d63f2=_0x3ec9be[_0x3f5858(0x1ad)]||undefined;break;case'erc20_usdc':_0x3d63f2=_0x3ec9be[_0x3f5858(0x1d4)]||undefined;break;}}console[_0x3f5858(0x1c5)]('üí≥\x20Payout\x20wallet\x20for\x20'+_0x4e1fe9+':\x20'+(_0x3d63f2||_0x3f5858(0xe1)));const _0x4cab64=await _0x39cafa[_0x3f5858(0x181)][_0x3f5858(0xf5)]({'data':{'shopId':_0x3582f9,'amount':_0xc2464c,'network':_0x4e1fe9,'status':_0x3f5858(0x158),'txid':_0x288bc8,'notes':_0x34f3de,'periodFrom':_0x5b481b?new Date(_0x5b481b):null,'periodTo':_0x3a374c?new Date(_0x3a374c):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x21175f=_0x191de1-_0xc2464c,_0x2cada0=Number(_0x3a8f20[_0x3f5858(0x1b9)])+_0xc2464c;return await _0x39cafa[_0x3f5858(0x10b)][_0x3f5858(0xda)]({'where':{'id':_0x3582f9},'data':{'balance':_0x21175f,'totalPaidOut':_0x2cada0}}),console['log'](_0x3f5858(0xdb)+_0x3a8f20[_0x3f5858(0x19d)]+'\x20balance\x20updated:'),console[_0x3f5858(0x1c5)](_0x3f5858(0x15b)+_0x191de1[_0x3f5858(0xbc)](0x6)+_0x3f5858(0xff)+_0x21175f[_0x3f5858(0xbc)](0x6)+_0x3f5858(0xc1)+_0xc2464c[_0x3f5858(0xbc)](0x6)+')'),console['log'](_0x3f5858(0x146)+_0x3a8f20[_0x3f5858(0x1b9)][_0x3f5858(0xbc)](0x6)+_0x3f5858(0xff)+_0x2cada0['toFixed'](0x6)+'\x20USDT\x20(+'+_0xc2464c[_0x3f5858(0xbc)](0x6)+')'),console['log']('\x20\x20\x20Final\x20payout\x20amount\x20used:\x20'+_0xc2464c[_0x3f5858(0xbc)](0x6)+_0x3f5858(0x132)),{'payout':_0x4cab64,'shop':_0x3a8f20};});return console['log'](_0x108bd0(0x15c)+_0x40e1f1['payout']['id']+'\x20for\x20shop\x20'+_0x40e1f1[_0x108bd0(0x10b)][_0x108bd0(0x19d)]+'\x20('+_0x40e1f1['payout'][_0x108bd0(0x1b8)][_0x108bd0(0xbc)](0x6)+_0x108bd0(0xa2)),{'id':_0x40e1f1[_0x108bd0(0x181)]['id'],'shopId':_0x40e1f1[_0x108bd0(0x181)][_0x108bd0(0xdc)],'shopName':_0x40e1f1[_0x108bd0(0x10b)]['name'],'shopUsername':_0x40e1f1[_0x108bd0(0x10b)]['username'],'amount':_0x40e1f1[_0x108bd0(0x181)][_0x108bd0(0x1b8)],'network':_0x40e1f1[_0x108bd0(0x181)][_0x108bd0(0x1d8)],'status':_0x40e1f1[_0x108bd0(0x181)][_0x108bd0(0x17b)],'txid':_0x40e1f1['payout'][_0x108bd0(0x1d6)],'notes':_0x40e1f1[_0x108bd0(0x181)][_0x108bd0(0x1dd)],'periodFrom':_0x40e1f1[_0x108bd0(0x181)][_0x108bd0(0x150)],'periodTo':_0x40e1f1[_0x108bd0(0x181)]['periodTo'],'createdAt':_0x40e1f1[_0x108bd0(0x181)][_0x108bd0(0x154)],'paidAt':_0x40e1f1[_0x108bd0(0x181)][_0x108bd0(0xba)]};}async[a40_0x3127cc(0x1e1)](_0x393a87){const _0x2d50b6=a40_0x3127cc,{page:_0x212793,limit:_0x29896a,shopId:_0x5e78c6,network:_0x190340,dateFrom:_0x4d7941,dateTo:_0x1686aa,search:_0xb76bd8}=_0x393a87,_0x334cb4=(_0x212793-0x1)*_0x29896a,_0x142e2f={};_0x5e78c6&&(_0x142e2f[_0x2d50b6(0xdc)]=_0x5e78c6);_0x190340&&(_0x142e2f[_0x2d50b6(0x1d8)]=_0x190340);(_0x4d7941||_0x1686aa)&&(_0x142e2f[_0x2d50b6(0x154)]={},_0x4d7941&&(_0x142e2f[_0x2d50b6(0x154)][_0x2d50b6(0x177)]=new Date(_0x4d7941)),_0x1686aa&&(_0x142e2f[_0x2d50b6(0x154)][_0x2d50b6(0x15e)]=new Date(_0x1686aa)));_0xb76bd8&&(_0x142e2f['OR']=[{'shop':{'name':{'contains':_0xb76bd8,'mode':_0x2d50b6(0xf9)}}},{'shop':{'username':{'contains':_0xb76bd8,'mode':'insensitive'}}},{'notes':{'contains':_0xb76bd8,'mode':'insensitive'}}]);const [_0x2119c0,_0x146bb4]=await Promise[_0x2d50b6(0x12b)]([database_1[_0x2d50b6(0x14f)][_0x2d50b6(0x181)][_0x2d50b6(0xb6)]({'where':_0x142e2f,'skip':_0x334cb4,'take':_0x29896a,'orderBy':{'createdAt':_0x2d50b6(0xe9)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x2d50b6(0x14f)]['payout'][_0x2d50b6(0x12a)]({'where':_0x142e2f})]);return{'payouts':_0x2119c0[_0x2d50b6(0x13c)](_0x5cd18f=>({'id':_0x5cd18f['id'],'shopId':_0x5cd18f[_0x2d50b6(0xdc)],'shopName':_0x5cd18f[_0x2d50b6(0x10b)][_0x2d50b6(0x120)],'shopUsername':_0x5cd18f['shop'][_0x2d50b6(0x19d)],'amount':_0x5cd18f[_0x2d50b6(0x1b8)],'network':_0x5cd18f['network'],'status':_0x5cd18f[_0x2d50b6(0x17b)],'txid':_0x5cd18f[_0x2d50b6(0x1d6)],'notes':_0x5cd18f['notes'],'periodFrom':_0x5cd18f[_0x2d50b6(0x150)],'periodTo':_0x5cd18f['periodTo'],'createdAt':_0x5cd18f[_0x2d50b6(0x154)],'paidAt':_0x5cd18f[_0x2d50b6(0xba)]})),'pagination':{'page':_0x212793,'limit':_0x29896a,'total':_0x146bb4,'totalPages':Math[_0x2d50b6(0xcf)](_0x146bb4/_0x29896a)}};}async[a40_0x3127cc(0xde)](_0x15a20c){const _0x144e47=a40_0x3127cc,_0x34df9d=await database_1[_0x144e47(0x14f)]['payout']['findUnique']({'where':{'id':_0x15a20c},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x34df9d)return null;return{'id':_0x34df9d['id'],'shopId':_0x34df9d[_0x144e47(0xdc)],'shopName':_0x34df9d[_0x144e47(0x10b)][_0x144e47(0x120)],'shopUsername':_0x34df9d[_0x144e47(0x10b)][_0x144e47(0x19d)],'amount':_0x34df9d['amount'],'network':_0x34df9d[_0x144e47(0x1d8)],'status':_0x34df9d[_0x144e47(0x17b)],'txid':_0x34df9d[_0x144e47(0x1d6)],'notes':_0x34df9d[_0x144e47(0x1dd)],'periodFrom':_0x34df9d['periodFrom'],'periodTo':_0x34df9d[_0x144e47(0x162)],'createdAt':_0x34df9d[_0x144e47(0x154)],'paidAt':_0x34df9d[_0x144e47(0xba)]};}async['deletePayout'](_0x3d6f4b){const _0xec3152=a40_0x3127cc;await database_1['default'][_0xec3152(0x181)][_0xec3152(0x198)]({'where':{'id':_0x3d6f4b}});}async[a40_0x3127cc(0x15a)](_0x158cd1){const _0xf7f799=a40_0x3127cc,{page:_0x36ddb3,limit:_0x198f21,status:_0x4cbea0,gateway:_0x17764b,shopId:_0x29dacf,dateFrom:_0x5e01b9,dateTo:_0x4cfe6c,search:_0x439236,currency:_0x570278,sortBy:_0x48a03b,sortOrder:_0x1e8c25}=_0x158cd1,_0x434571=(_0x36ddb3-0x1)*_0x198f21;console[_0xf7f799(0x1c5)](_0xf7f799(0xd4),_0x158cd1);const _0x56f2e0=await database_1[_0xf7f799(0x14f)][_0xf7f799(0x111)][_0xf7f799(0x19e)]({'by':['gateway'],'_count':{'gateway':!![]}});console[_0xf7f799(0x1c5)](_0xf7f799(0xfc),_0x56f2e0[_0xf7f799(0x13c)](_0x456984=>_0x456984[_0xf7f799(0x175)]+'\x20('+_0x456984[_0xf7f799(0xa9)][_0xf7f799(0x175)]+_0xf7f799(0x17a)));if(_0x17764b){const _0x51df94=_0x56f2e0[_0xf7f799(0xb4)](_0x3c9446=>_0x3c9446[_0xf7f799(0x175)][_0xf7f799(0x195)]()===_0x17764b[_0xf7f799(0x195)]());!_0x51df94&&_0x17764b[_0xf7f799(0x195)]()!==_0xf7f799(0x117)&&console['log'](_0xf7f799(0x1a9)+_0x17764b+_0xf7f799(0xd1)+_0x56f2e0[_0xf7f799(0x13c)](_0x4863c8=>_0x4863c8['gateway'])[_0xf7f799(0xbf)](',\x20'));}const _0x2ce27c={};_0x4cbea0&&(_0x2ce27c[_0xf7f799(0x17b)]=_0x4cbea0['toUpperCase']());if(!_0x17764b)_0x2ce27c['gateway']={'not':_0xf7f799(0x117)};else{if(_0x17764b&&(_0x17764b['toLowerCase']()===_0xf7f799(0x117)||_0x17764b==='0000'))_0x2ce27c[_0xf7f799(0x175)]=_0xf7f799(0x117);else{let _0xc4dd57=_0x17764b;const _0x5098a5=(0x0,gateway_1[_0xf7f799(0x187)])(_0x17764b);if(_0x5098a5)_0xc4dd57=_0x5098a5,console[_0xf7f799(0x1c5)](_0xf7f799(0x149)+_0x17764b+_0xf7f799(0x171)+_0xc4dd57+'\x27');else{const _0x52a945=(0x0,gateway_1['getGatewayIdByName'])(_0x17764b);if(_0x52a945){const _0x9f9bdb=(0x0,gateway_1['getGatewayNameById'])(_0x52a945);_0x9f9bdb&&(_0xc4dd57=_0x9f9bdb,console[_0xf7f799(0x1c5)](_0xf7f799(0x105)+_0x17764b+_0xf7f799(0x116)+_0x52a945+'\x27\x20->\x20name\x20\x27'+_0xc4dd57+'\x27'));}else console[_0xf7f799(0x1c5)](_0xf7f799(0xd6)+_0x17764b+'\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)');}const _0x2b67f5=await database_1[_0xf7f799(0x14f)][_0xf7f799(0x111)][_0xf7f799(0x12a)]({'where':{'gateway':_0xc4dd57[_0xf7f799(0x195)]()},'take':0x1});_0x2b67f5===0x0?(console[_0xf7f799(0x1c5)](_0xf7f799(0x10e)+_0xc4dd57+_0xf7f799(0x13f)+_0x17764b+_0xf7f799(0x18c)),_0x2ce27c[_0xf7f799(0x175)]='NONEXISTENT_GATEWAY_FILTER'):(_0x2ce27c[_0xf7f799(0x175)]=_0xc4dd57[_0xf7f799(0x195)](),console[_0xf7f799(0x1c5)](_0xf7f799(0x16d)+_0xc4dd57+_0xf7f799(0x13f)+_0x17764b+'\x27)'));}}console[_0xf7f799(0x1c5)](_0xf7f799(0x13a),_0x2ce27c[_0xf7f799(0x175)]);_0x29dacf&&(_0x2ce27c[_0xf7f799(0xdc)]=_0x29dacf);_0x570278&&(_0x2ce27c[_0xf7f799(0x10f)]=_0x570278[_0xf7f799(0xc7)](),console[_0xf7f799(0x1c5)]('üí±\x20Currency\x20filter\x20applied:\x20'+_0x570278[_0xf7f799(0xc7)]()));(_0x5e01b9||_0x4cfe6c)&&(_0x2ce27c[_0xf7f799(0x154)]={},_0x5e01b9&&(_0x2ce27c[_0xf7f799(0x154)][_0xf7f799(0x177)]=new Date(_0x5e01b9)),_0x4cfe6c&&(_0x2ce27c['createdAt'][_0xf7f799(0x15e)]=new Date(_0x4cfe6c)));_0x439236&&(_0x2ce27c['OR']=[{'id':{'contains':_0x439236,'mode':_0xf7f799(0xf9)}},{'orderId':{'contains':_0x439236,'mode':_0xf7f799(0xf9)}},{'gatewayOrderId':{'contains':_0x439236,'mode':_0xf7f799(0xf9)}},{'customerEmail':{'contains':_0x439236,'mode':_0xf7f799(0xf9)}},{'shop':{'name':{'contains':_0x439236,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x439236,'mode':_0xf7f799(0xf9)}}}]);console[_0xf7f799(0x1c5)]('üìä\x20Final\x20WHERE\x20conditions:',JSON[_0xf7f799(0xb8)](_0x2ce27c,null,0x2));let _0x1df660={'createdAt':_0xf7f799(0xe9)};if(_0x48a03b){const _0x4e3c76=[_0xf7f799(0x1b8),_0xf7f799(0x154),_0xf7f799(0x124),_0xf7f799(0x17b),_0xf7f799(0x175),_0xf7f799(0x10f)],_0x2dcb9b=[_0xf7f799(0x1a2),_0xf7f799(0xe9)];if(_0x4e3c76['includes'](_0x48a03b)){const _0x54b123=_0x2dcb9b[_0xf7f799(0xa0)](_0x1e8c25)?_0x1e8c25:'desc';_0x1df660={[_0x48a03b]:_0x54b123},console[_0xf7f799(0x1c5)](_0xf7f799(0x152)+_0x48a03b+'\x20in\x20'+_0x54b123+_0xf7f799(0xdf));}}const [_0x35b67b,_0xf02002]=await Promise[_0xf7f799(0x12b)]([database_1[_0xf7f799(0x14f)][_0xf7f799(0x111)][_0xf7f799(0xb6)]({'where':_0x2ce27c,'skip':_0x434571,'take':_0x198f21,'orderBy':_0x1df660,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0xf7f799(0x14f)]['payment'][_0xf7f799(0x12a)]({'where':_0x2ce27c})]);return{'payments':_0x35b67b,'pagination':{'page':_0x36ddb3,'limit':_0x198f21,'total':_0xf02002,'totalPages':Math[_0xf7f799(0xcf)](_0xf02002/_0x198f21)}};}async['getPaymentById'](_0x43eae9){const _0x3f301f=a40_0x3127cc,_0x366075=await database_1['default']['payment']['findUnique']({'where':{'id':_0x43eae9},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x366075)return null;return{'id':_0x366075['id'],'shopId':_0x366075[_0x3f301f(0xdc)],'gateway':_0x366075[_0x3f301f(0x175)],'amount':_0x366075['amount'],'currency':_0x366075[_0x3f301f(0x10f)],'status':_0x366075[_0x3f301f(0x17b)],'orderId':_0x366075[_0x3f301f(0x174)],'gatewayOrderId':_0x366075[_0x3f301f(0x130)],'customerEmail':_0x366075[_0x3f301f(0x142)],'customerName':_0x366075['customerName'],'customerCountry':_0x366075['customerCountry'],'customerIp':_0x366075[_0x3f301f(0x139)],'customerUa':_0x366075[_0x3f301f(0xb5)],'failureMessage':_0x366075[_0x3f301f(0x173)],'externalPaymentUrl':_0x366075[_0x3f301f(0x13b)],'successUrl':_0x366075[_0x3f301f(0x183)],'failUrl':_0x366075['failUrl'],'pendingUrl':_0x366075[_0x3f301f(0x167)],'whiteUrl':_0x366075['whiteUrl'],'createdAt':_0x366075['createdAt'],'updatedAt':_0x366075[_0x3f301f(0x124)],'shop':_0x366075[_0x3f301f(0x10b)]};}async['updatePaymentStatus'](_0x4ef702,_0x482052,_0x57377a,_0x57103d){const _0xf209a3=a40_0x3127cc,_0x545a47=await database_1[_0xf209a3(0x14f)][_0xf209a3(0x104)](async _0x4a227d=>{const _0x36d662=_0xf209a3,_0x270737=await _0x4a227d['payment'][_0x36d662(0x1cb)]({'where':{'id':_0x4ef702},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x270737)throw new Error('Payment\x20not\x20found');const _0x35f563=_0x270737[_0x36d662(0x17b)],_0x3f64eb=_0x482052['toUpperCase']();console[_0x36d662(0x1c5)](_0x36d662(0x10d)+_0x4ef702+_0x36d662(0x19c)+_0x35f563+_0x36d662(0xff)+_0x3f64eb),console[_0x36d662(0x1c5)](_0x36d662(0xa8)+_0x270737['shop'][_0x36d662(0x1b3)]+_0x36d662(0x132));const _0x4fd42a={'status':_0x3f64eb,'updatedAt':new Date(),'statusChangedBy':_0x36d662(0x119),'statusChangedAt':new Date()};_0x57377a&&(_0x4fd42a[_0x36d662(0x1a5)]=_0x57377a);_0x3f64eb===_0x36d662(0x16c)&&_0x57103d&&(_0x4fd42a[_0x36d662(0x189)]=_0x57103d);let _0xfbf164=0x0,_0x7adcc5=_0x270737[_0x36d662(0x10b)]['balance'];if(_0x3f64eb===_0x36d662(0xab)&&_0x35f563!==_0x36d662(0xab)){_0x4fd42a['paidAt']=new Date();const _0xe5e04e=await currencyService_1[_0x36d662(0x17d)][_0x36d662(0x1a8)](_0x270737[_0x36d662(0x1b8)],_0x270737['currency']);_0x4fd42a[_0x36d662(0xf3)]=_0xe5e04e;let _0x12109c=0x2d;const _0xd5f27b=await _0x4a227d['shop'][_0x36d662(0x1cb)]({'where':{'id':_0x270737[_0x36d662(0xdc)]},'select':{'gatewaySettings':!![]}});if(_0xd5f27b?.[_0x36d662(0x1aa)])try{const _0x398210=JSON['parse'](_0xd5f27b[_0x36d662(0x1aa)]);for(const [_0x5f1a9a,_0x57575c]of Object[_0x36d662(0xe8)](_0x398210)){if(_0x5f1a9a[_0x36d662(0x195)]()===_0x270737[_0x36d662(0x175)][_0x36d662(0x195)]()){_0x12109c=_0x57575c['commission']||0xa;break;}}}catch(_0x21bff1){console['error'](_0x36d662(0x1e4)+_0x4ef702+':',_0x21bff1);}let _0x1e3f13;_0x270737['amountAfterGatewayCommissionUSDT']!==null&&_0x270737['amountAfterGatewayCommissionUSDT']!==undefined?(_0x1e3f13=_0x270737['amountAfterGatewayCommissionUSDT'],console[_0x36d662(0x1c5)](_0x36d662(0x1ba)+_0x1e3f13[_0x36d662(0xbc)](0x6)+_0x36d662(0xb7)+_0x4ef702)):(_0x1e3f13=_0xe5e04e*(0x1-_0x12109c/0x64),console['log']('üìä\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20'+_0x4ef702+':\x20'+_0x12109c+_0x36d662(0x176)+_0xe5e04e[_0x36d662(0xbc)](0x6)+_0x36d662(0x132)),_0x4fd42a[_0x36d662(0x1ab)]=_0x1e3f13,_0x4fd42a[_0x36d662(0xfa)]=_0x12109c),_0xfbf164=_0x1e3f13,_0x7adcc5+=_0x1e3f13,console[_0x36d662(0x1c5)](_0x36d662(0xaa)+_0x4ef702+_0x36d662(0x108)),console[_0x36d662(0x1c5)](_0x36d662(0x1d3)+_0xe5e04e[_0x36d662(0xbc)](0x6)+_0x36d662(0x132)),console[_0x36d662(0x1c5)](_0x36d662(0x1bd)+_0x270737[_0x36d662(0x175)]+_0x36d662(0xce)+_0x12109c+'%'),console[_0x36d662(0x1c5)]('\x20\x20\x20Merchant\x20gets:\x20'+_0x1e3f13['toFixed'](0x6)+_0x36d662(0xc6)+_0x12109c+_0x36d662(0x1d9)),console[_0x36d662(0x1c5)](_0x36d662(0x1ae)+_0x1e3f13['toFixed'](0x6)+_0x36d662(0x132));}else{if(_0x35f563===_0x36d662(0xab)&&_0x3f64eb!==_0x36d662(0xab)&&_0x3f64eb!==_0x36d662(0x16c)){if(_0x270737[_0x36d662(0xf3)]){let _0x40aa3f=0x2d;const _0x3701dd=await _0x4a227d[_0x36d662(0x10b)][_0x36d662(0x1cb)]({'where':{'id':_0x270737[_0x36d662(0xdc)]},'select':{'gatewaySettings':!![]}});if(_0x3701dd?.[_0x36d662(0x1aa)])try{const _0x5243fe=JSON['parse'](_0x3701dd[_0x36d662(0x1aa)]);for(const [_0x3a09cd,_0x330c4f]of Object['entries'](_0x5243fe)){if(_0x3a09cd[_0x36d662(0x195)]()===_0x270737[_0x36d662(0x175)][_0x36d662(0x195)]()){_0x40aa3f=_0x330c4f[_0x36d662(0xf0)]||0xa;break;}}}catch(_0x413258){console[_0x36d662(0xa3)]('Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20'+_0x4ef702+':',_0x413258);}const _0x51d91e=_0x270737[_0x36d662(0xf3)]*(0x1-_0x40aa3f/0x64);_0xfbf164=-_0x51d91e,_0x7adcc5-=_0x51d91e,console[_0x36d662(0x1c5)](_0x36d662(0x1d3)+_0x270737[_0x36d662(0xf3)][_0x36d662(0xbc)](0x6)+_0x36d662(0x132)),console[_0x36d662(0x1c5)]('\x20\x20\x20Gateway:\x20'+_0x270737[_0x36d662(0x175)]+_0x36d662(0xce)+_0x40aa3f+'%'),console[_0x36d662(0x1c5)](_0x36d662(0x1cc)+_0x51d91e[_0x36d662(0xbc)](0x6)+_0x36d662(0xc6)+_0x40aa3f+'%\x20commission)'),console['log']('\x20\x20\x20Subtracted\x20from\x20balance:\x20-'+_0x51d91e[_0x36d662(0xbc)](0x6)+_0x36d662(0x132));}}}_0x3f64eb===_0x36d662(0x16c)&&(console['log'](_0x36d662(0x1d0)),_0x57103d&&_0x57103d>0x0?(_0xfbf164=-_0x57103d,_0x7adcc5-=_0x57103d,console[_0x36d662(0x1c5)]('üí∏\x20CHARGEBACK\x20penalty\x20ONLY:\x20-'+_0x57103d['toFixed'](0x6)+_0x36d662(0x9f)),console[_0x36d662(0x1c5)](_0x36d662(0x1cf))):console[_0x36d662(0x1c5)](_0x36d662(0x172)),_0x4fd42a[_0x36d662(0x189)]=_0x57103d||0x0);_0x3f64eb==='REFUND'&&_0x35f563==='PAID'&&console[_0x36d662(0x1c5)](_0x36d662(0x12c));const _0x51cb01=await _0x4a227d[_0x36d662(0x111)][_0x36d662(0xda)]({'where':{'id':_0x4ef702},'data':_0x4fd42a,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0xfbf164!==0x0&&(await _0x4a227d[_0x36d662(0x10b)][_0x36d662(0xda)]({'where':{'id':_0x270737[_0x36d662(0xdc)]},'data':{'balance':_0x7adcc5}}),console[_0x36d662(0x1c5)](_0x36d662(0xdb)+_0x270737[_0x36d662(0xdc)]+_0x36d662(0xcd)+_0x270737[_0x36d662(0x10b)][_0x36d662(0x1b3)]['toFixed'](0x6)+_0x36d662(0xff)+_0x7adcc5['toFixed'](0x6)+'\x20USDT\x20('+(_0xfbf164>0x0?'+':'')+_0xfbf164[_0x36d662(0xbc)](0x6)+')')),_0x51cb01;});return{'id':_0x545a47['id'],'shopId':_0x545a47[_0xf209a3(0xdc)],'gateway':_0x545a47['gateway'],'amount':_0x545a47[_0xf209a3(0x1b8)],'currency':_0x545a47['currency'],'status':_0x545a47['status'],'orderId':_0x545a47[_0xf209a3(0x174)],'gatewayOrderId':_0x545a47[_0xf209a3(0x130)],'customerEmail':_0x545a47[_0xf209a3(0x142)],'customerName':_0x545a47[_0xf209a3(0x1e0)],'customerCountry':_0x545a47[_0xf209a3(0x1a4)],'customerIp':_0x545a47[_0xf209a3(0x139)],'customerUa':_0x545a47[_0xf209a3(0xb5)],'failureMessage':_0x545a47[_0xf209a3(0x173)],'adminNotes':_0x545a47[_0xf209a3(0x1a5)],'chargebackAmount':_0x545a47['chargebackAmount'],'statusChangedBy':_0x545a47[_0xf209a3(0x122)],'statusChangedAt':_0x545a47[_0xf209a3(0xd2)],'createdAt':_0x545a47[_0xf209a3(0x154)],'updatedAt':_0x545a47[_0xf209a3(0x124)],'shop':_0x545a47['shop']};}async[a40_0x3127cc(0x1e3)](_0x2670c1,_0x15aaad){const _0xfc9c36=a40_0x3127cc,_0x38cd13=Math[_0xfc9c36(0xf1)]()['toString'](0x24)[_0xfc9c36(0x9c)](0x2,0x9);console[_0xfc9c36(0x1c5)]('üéØ\x20updateUser\x20called\x20with\x20ID:\x20'+_0x38cd13+_0xfc9c36(0x196)+_0x2670c1);const _0x432b4a={..._0x15aaad};_0x15aaad[_0xfc9c36(0x125)]&&_0x15aaad['password'][_0xfc9c36(0xc3)]()!==''?(console[_0xfc9c36(0x1c5)](_0xfc9c36(0x1d5)+_0x38cd13+_0xfc9c36(0x145)+_0x2670c1),_0x432b4a[_0xfc9c36(0x125)]=await bcryptjs_1[_0xfc9c36(0x14f)][_0xfc9c36(0x17c)](_0x15aaad[_0xfc9c36(0x125)],0xc)):(console[_0xfc9c36(0x1c5)]('üîê\x20['+_0x38cd13+_0xfc9c36(0x10c)),delete _0x432b4a[_0xfc9c36(0x125)]);_0x15aaad[_0xfc9c36(0x128)]&&(_0x432b4a[_0xfc9c36(0x120)]=_0x15aaad[_0xfc9c36(0x128)],delete _0x432b4a[_0xfc9c36(0x128)]);_0x15aaad[_0xfc9c36(0x1c2)]&&(_0x432b4a[_0xfc9c36(0x1d1)]=_0x15aaad[_0xfc9c36(0x1c2)],delete _0x432b4a[_0xfc9c36(0x1c2)]);_0x15aaad['merchantUrl']&&(_0x432b4a[_0xfc9c36(0x1b4)]=_0x15aaad['merchantUrl'],delete _0x432b4a['merchantUrl']);if(_0x15aaad[_0xfc9c36(0x1b5)]){const _0x3d09c7=_0x15aaad['gateways'][_0xfc9c36(0x13c)](_0x194b85=>this[_0xfc9c36(0xe6)](_0x194b85));console[_0xfc9c36(0x1c5)](_0xfc9c36(0x16b),_0x15aaad[_0xfc9c36(0x1b5)],'->',_0x3d09c7),_0x432b4a[_0xfc9c36(0x1b7)]=JSON[_0xfc9c36(0xb8)](_0x3d09c7),delete _0x432b4a[_0xfc9c36(0x1b5)];}_0x15aaad[_0xfc9c36(0x1aa)]&&(console[_0xfc9c36(0x1c5)](_0xfc9c36(0x180)+_0x38cd13+_0xfc9c36(0x137),_0x15aaad[_0xfc9c36(0x1aa)]),_0x432b4a[_0xfc9c36(0x1aa)]=JSON[_0xfc9c36(0xb8)](_0x15aaad[_0xfc9c36(0x1aa)]),console[_0xfc9c36(0x1c5)](_0xfc9c36(0x180)+_0x38cd13+_0xfc9c36(0x15d),_0x432b4a[_0xfc9c36(0x1aa)]));_0x15aaad[_0xfc9c36(0x1c0)]&&(_0x15aaad[_0xfc9c36(0x1c0)][_0xfc9c36(0x1c3)]!==undefined&&(_0x432b4a[_0xfc9c36(0x1c3)]=_0x15aaad['wallets'][_0xfc9c36(0x1c3)]||null),_0x15aaad[_0xfc9c36(0x1c0)][_0xfc9c36(0xc2)]!==undefined&&(_0x432b4a[_0xfc9c36(0xc2)]=_0x15aaad[_0xfc9c36(0x1c0)]['usdtTrcWallet']||null),_0x15aaad[_0xfc9c36(0x1c0)]['usdtErcWallet']!==undefined&&(_0x432b4a[_0xfc9c36(0xbb)]=_0x15aaad[_0xfc9c36(0x1c0)][_0xfc9c36(0xbb)]||null),_0x15aaad['wallets'][_0xfc9c36(0x1ad)]!==undefined&&(_0x432b4a[_0xfc9c36(0x1ad)]=_0x15aaad[_0xfc9c36(0x1c0)][_0xfc9c36(0x1ad)]||null),delete _0x432b4a['wallets']);const _0x4af9f0=await database_1[_0xfc9c36(0x14f)][_0xfc9c36(0x10b)][_0xfc9c36(0xda)]({'where':{'id':_0x2670c1},'data':_0x432b4a,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0xfc9c36(0x1c5)](_0xfc9c36(0x159)+_0x38cd13+']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:',_0x4af9f0[_0xfc9c36(0x1aa)]),{'id':_0x4af9f0['id'],'fullName':_0x4af9f0[_0xfc9c36(0x120)],'username':_0x4af9f0[_0xfc9c36(0x19d)],'telegramId':_0x4af9f0['telegram'],'merchantUrl':_0x4af9f0['shopUrl'],'gateways':_0x4af9f0[_0xfc9c36(0x1b7)]?JSON[_0xfc9c36(0xe0)](_0x4af9f0[_0xfc9c36(0x1b7)]):null,'gatewaySettings':_0x4af9f0[_0xfc9c36(0x1aa)]?JSON['parse'](_0x4af9f0[_0xfc9c36(0x1aa)]):null,'publicKey':_0x4af9f0['publicKey'],'wallets':{'usdtPolygonWallet':_0x4af9f0[_0xfc9c36(0x1c3)],'usdtTrcWallet':_0x4af9f0[_0xfc9c36(0xc2)],'usdtErcWallet':_0x4af9f0['usdtErcWallet'],'usdcPolygonWallet':_0x4af9f0['usdcPolygonWallet']},'status':_0x4af9f0[_0xfc9c36(0x17b)],'createdAt':_0x4af9f0[_0xfc9c36(0x154)]};}async[a40_0x3127cc(0x1ca)](_0x5ba191){const _0x4011a7=a40_0x3127cc,_0x19ca16=await database_1[_0x4011a7(0x14f)]['shop'][_0x4011a7(0xda)]({'where':{'id':_0x5ba191},'data':{'status':_0x4011a7(0xa5)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x19ca16['id'],'fullName':_0x19ca16[_0x4011a7(0x120)],'username':_0x19ca16[_0x4011a7(0x19d)],'telegramId':_0x19ca16[_0x4011a7(0x1d1)],'merchantUrl':_0x19ca16[_0x4011a7(0x1b4)],'gateways':_0x19ca16[_0x4011a7(0x1b7)]?JSON[_0x4011a7(0xe0)](_0x19ca16[_0x4011a7(0x1b7)]):null,'gatewaySettings':_0x19ca16[_0x4011a7(0x1aa)]?JSON[_0x4011a7(0xe0)](_0x19ca16[_0x4011a7(0x1aa)]):null,'publicKey':_0x19ca16[_0x4011a7(0x1a0)],'wallets':{'usdtPolygonWallet':_0x19ca16[_0x4011a7(0x1c3)],'usdtTrcWallet':_0x19ca16['usdtTrcWallet'],'usdtErcWallet':_0x19ca16['usdtErcWallet'],'usdcPolygonWallet':_0x19ca16[_0x4011a7(0x1ad)]},'status':_0x19ca16[_0x4011a7(0x17b)],'createdAt':_0x19ca16[_0x4011a7(0x154)]};}async[a40_0x3127cc(0x18d)](_0x6552e2){const _0xc8802d=a40_0x3127cc,_0x2f9f72=await database_1[_0xc8802d(0x14f)]['shop'][_0xc8802d(0xda)]({'where':{'id':_0x6552e2},'data':{'status':_0xc8802d(0x140)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2f9f72['id'],'fullName':_0x2f9f72['name'],'username':_0x2f9f72[_0xc8802d(0x19d)],'telegramId':_0x2f9f72[_0xc8802d(0x1d1)],'merchantUrl':_0x2f9f72[_0xc8802d(0x1b4)],'gateways':_0x2f9f72[_0xc8802d(0x1b7)]?JSON[_0xc8802d(0xe0)](_0x2f9f72[_0xc8802d(0x1b7)]):null,'gatewaySettings':_0x2f9f72[_0xc8802d(0x1aa)]?JSON['parse'](_0x2f9f72['gatewaySettings']):null,'publicKey':_0x2f9f72[_0xc8802d(0x1a0)],'wallets':{'usdtPolygonWallet':_0x2f9f72[_0xc8802d(0x1c3)],'usdtTrcWallet':_0x2f9f72[_0xc8802d(0xc2)],'usdtErcWallet':_0x2f9f72[_0xc8802d(0xbb)],'usdcPolygonWallet':_0x2f9f72['usdcPolygonWallet']},'status':_0x2f9f72[_0xc8802d(0x17b)],'createdAt':_0x2f9f72[_0xc8802d(0x154)]};}async['getAllUsers'](_0x3cfbac){const _0x4c1fac=a40_0x3127cc,{page:_0x402b51,limit:_0x59f2b3,status:_0xe1ba1f}=_0x3cfbac,_0x8b6005=(_0x402b51-0x1)*_0x59f2b3,_0xf59794={};_0xe1ba1f&&(_0xf59794[_0x4c1fac(0x17b)]=_0xe1ba1f[_0x4c1fac(0xc7)]());const [_0x241a9e,_0x22baab]=await Promise[_0x4c1fac(0x12b)]([database_1[_0x4c1fac(0x14f)][_0x4c1fac(0x10b)]['findMany']({'where':_0xf59794,'skip':_0x8b6005,'take':_0x59f2b3,'orderBy':{'createdAt':_0x4c1fac(0xe9)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x4c1fac(0x14f)][_0x4c1fac(0x10b)][_0x4c1fac(0x12a)]({'where':_0xf59794})]);return{'users':_0x241a9e[_0x4c1fac(0x13c)](_0x536690=>{const _0x1588d9=_0x4c1fac,_0x40d99d=_0x536690['paymentGateways']?JSON[_0x1588d9(0xe0)](_0x536690[_0x1588d9(0x1b7)]):null,_0x406b27=_0x40d99d?_0x40d99d['map'](_0x2da724=>this[_0x1588d9(0xbd)](_0x2da724)):null;return{'id':_0x536690['id'],'fullName':_0x536690[_0x1588d9(0x120)],'username':_0x536690[_0x1588d9(0x19d)],'telegramId':_0x536690[_0x1588d9(0x1d1)],'merchantUrl':_0x536690['shopUrl'],'gateways':_0x406b27,'gatewaySettings':_0x536690[_0x1588d9(0x1aa)]?JSON[_0x1588d9(0xe0)](_0x536690[_0x1588d9(0x1aa)]):null,'publicKey':_0x536690[_0x1588d9(0x1a0)],'wallets':{'usdtPolygonWallet':_0x536690[_0x1588d9(0x1c3)],'usdtTrcWallet':_0x536690[_0x1588d9(0xc2)],'usdtErcWallet':_0x536690[_0x1588d9(0xbb)],'usdcPolygonWallet':_0x536690['usdcPolygonWallet']},'status':_0x536690['status'],'createdAt':_0x536690[_0x1588d9(0x154)]};}),'pagination':{'page':_0x402b51,'limit':_0x59f2b3,'total':_0x22baab,'totalPages':Math[_0x4c1fac(0xcf)](_0x22baab/_0x59f2b3)}};}async[a40_0x3127cc(0x184)](_0x14de7c){const _0x5ea1f3=a40_0x3127cc,_0x532d4f=await database_1[_0x5ea1f3(0x14f)][_0x5ea1f3(0x10b)][_0x5ea1f3(0x1cb)]({'where':{'id':_0x14de7c},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x532d4f)return null;const _0x5a1c06=_0x532d4f['paymentGateways']?JSON[_0x5ea1f3(0xe0)](_0x532d4f['paymentGateways']):null,_0x20b233=_0x5a1c06?_0x5a1c06[_0x5ea1f3(0x13c)](_0x365647=>this[_0x5ea1f3(0xbd)](_0x365647)):null;return _0x5a1c06&&_0x20b233&&console[_0x5ea1f3(0x1c5)](_0x5ea1f3(0xeb),_0x5a1c06,'->',_0x20b233),{'id':_0x532d4f['id'],'fullName':_0x532d4f[_0x5ea1f3(0x120)],'username':_0x532d4f[_0x5ea1f3(0x19d)],'telegramId':_0x532d4f[_0x5ea1f3(0x1d1)],'merchantUrl':_0x532d4f['shopUrl'],'gateways':_0x20b233,'gatewaySettings':_0x532d4f['gatewaySettings']?JSON['parse'](_0x532d4f[_0x5ea1f3(0x1aa)]):null,'publicKey':_0x532d4f[_0x5ea1f3(0x1a0)],'wallets':{'usdtPolygonWallet':_0x532d4f[_0x5ea1f3(0x1c3)],'usdtTrcWallet':_0x532d4f[_0x5ea1f3(0xc2)],'usdtErcWallet':_0x532d4f[_0x5ea1f3(0xbb)],'usdcPolygonWallet':_0x532d4f[_0x5ea1f3(0x1ad)]},'status':_0x532d4f[_0x5ea1f3(0x17b)],'createdAt':_0x532d4f['createdAt']};}async[a40_0x3127cc(0x1c7)](_0x5e1853){const _0x5c72cc=a40_0x3127cc,{fullName:_0x1aadf8,username:_0x2183e0,password:_0x1d1387,telegramId:_0x10070b,merchantUrl:_0x5019a1,gateways:_0x351865,gatewaySettings:_0x5370d5,wallets:_0x13b889}=_0x5e1853,_0x20d086=await database_1[_0x5c72cc(0x14f)][_0x5c72cc(0x10b)][_0x5c72cc(0x1cb)]({'where':{'username':_0x2183e0}});if(_0x20d086)throw new Error(_0x5c72cc(0x106));if(_0x10070b){const _0x2f0375=await database_1['default'][_0x5c72cc(0x10b)][_0x5c72cc(0x1cb)]({'where':{'telegram':_0x10070b}});if(_0x2f0375)throw new Error(_0x5c72cc(0x109));}const _0x5504cf=await bcryptjs_1[_0x5c72cc(0x14f)][_0x5c72cc(0x17c)](_0x1d1387,0xc),_0x5281f2=_0x5c72cc(0x155)+crypto_1[_0x5c72cc(0x14f)][_0x5c72cc(0x1e2)](0x20)[_0x5c72cc(0x15f)](_0x5c72cc(0x14a)),_0x33896f=_0x5c72cc(0x115)+crypto_1['default'][_0x5c72cc(0x1e2)](0x20)[_0x5c72cc(0x15f)](_0x5c72cc(0x14a)),_0x35b275=_0x351865?_0x351865['map'](_0x42abf3=>this[_0x5c72cc(0xe6)](_0x42abf3)):null;_0x351865&&_0x35b275&&console['log'](_0x5c72cc(0xd5),_0x351865,'->',_0x35b275);const _0x43cf04=await database_1['default'][_0x5c72cc(0x10b)][_0x5c72cc(0xf5)]({'data':{'name':_0x1aadf8,'username':_0x2183e0,'password':_0x5504cf,'telegram':_0x10070b,'shopUrl':_0x5019a1,'paymentGateways':_0x35b275?JSON['stringify'](_0x35b275):null,'gatewaySettings':_0x5370d5?JSON[_0x5c72cc(0xb8)](_0x5370d5):null,'usdtPolygonWallet':_0x13b889?.[_0x5c72cc(0x1c3)]||null,'usdtTrcWallet':_0x13b889?.[_0x5c72cc(0xc2)]||null,'usdtErcWallet':_0x13b889?.['usdtErcWallet']||null,'usdcPolygonWallet':_0x13b889?.[_0x5c72cc(0x1ad)]||null,'publicKey':_0x5281f2,'secretKey':_0x33896f,'status':_0x5c72cc(0x140)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x43cf04['id'],'fullName':_0x43cf04['name'],'username':_0x43cf04[_0x5c72cc(0x19d)],'telegramId':_0x43cf04[_0x5c72cc(0x1d1)],'merchantUrl':_0x43cf04['shopUrl'],'gateways':_0x43cf04[_0x5c72cc(0x1b7)]?JSON[_0x5c72cc(0xe0)](_0x43cf04[_0x5c72cc(0x1b7)]):null,'gatewaySettings':_0x43cf04[_0x5c72cc(0x1aa)]?JSON[_0x5c72cc(0xe0)](_0x43cf04[_0x5c72cc(0x1aa)]):null,'publicKey':_0x43cf04['publicKey'],'wallets':{'usdtPolygonWallet':_0x43cf04[_0x5c72cc(0x1c3)],'usdtTrcWallet':_0x43cf04[_0x5c72cc(0xc2)],'usdtErcWallet':_0x43cf04['usdtErcWallet'],'usdcPolygonWallet':_0x43cf04['usdcPolygonWallet']},'status':_0x43cf04[_0x5c72cc(0x17b)],'createdAt':_0x43cf04['createdAt']};}async['deleteUser'](_0x2a0b97){const _0x4ef21e=a40_0x3127cc;await database_1[_0x4ef21e(0x14f)]['shop']['delete']({'where':{'id':_0x2a0b97}});}['generateDailyStatistics'](_0x341739,_0x45f5bb,_0x49485d){const _0x24642b=a40_0x3127cc,_0x59d46c=new Map(),_0x3f7890=new Date(_0x45f5bb);while(_0x3f7890<=_0x49485d){const _0x313941=_0x3f7890[_0x24642b(0x186)]()[_0x24642b(0xc5)]('T')[0x0];_0x59d46c['set'](_0x313941,{'revenue':0x0,'count':0x0}),_0x3f7890['setDate'](_0x3f7890['getDate']()+0x1);}for(const _0x2123c1 of _0x341739){const _0x4f1e59=_0x2123c1[_0x24642b(0x154)]['toISOString']()[_0x24642b(0xc5)]('T')[0x0],_0x2758a9=_0x59d46c[_0x24642b(0xa1)](_0x4f1e59);_0x2758a9&&(_0x2758a9[_0x24642b(0x12a)]+=0x1,_0x2123c1[_0x24642b(0x17b)]===_0x24642b(0xab)&&(_0x2123c1[_0x24642b(0xf3)]?_0x2758a9[_0x24642b(0x135)]+=_0x2123c1[_0x24642b(0xf3)]:console[_0x24642b(0x1c5)](_0x24642b(0xb2)+_0x2123c1['id']+'\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion')));}const _0x12f958=[],_0x24d680=[];for(const [_0x4569a3,_0x2010ad]of _0x59d46c){_0x12f958[_0x24642b(0x129)]({'date':_0x4569a3,'amount':Math[_0x24642b(0x1a1)](_0x2010ad['revenue']*0x64)/0x64}),_0x24d680[_0x24642b(0x129)]({'date':_0x4569a3,'count':_0x2010ad[_0x24642b(0x12a)]});}return{'dailyRevenue':_0x12f958,'dailyPayments':_0x24d680};}}exports['AdminService']=AdminService;