'use strict';const a35_0x2c445d=a35_0x194e;(function(_0x4d724f,_0x305537){const _0x138606=a35_0x194e,_0x199048=_0x4d724f();while(!![]){try{const _0x86bf60=-parseInt(_0x138606(0x111))/0x1*(-parseInt(_0x138606(0x122))/0x2)+-parseInt(_0x138606(0x167))/0x3*(parseInt(_0x138606(0xe0))/0x4)+-parseInt(_0x138606(0x15c))/0x5+-parseInt(_0x138606(0x13e))/0x6+-parseInt(_0x138606(0x148))/0x7+parseInt(_0x138606(0x17b))/0x8*(-parseInt(_0x138606(0xd0))/0x9)+parseInt(_0x138606(0x127))/0xa;if(_0x86bf60===_0x305537)break;else _0x199048['push'](_0x199048['shift']());}catch(_0xc66a95){_0x199048['push'](_0x199048['shift']());}}}(a35_0x274f,0xa6f78));function a35_0x194e(_0x201dba,_0x3aaf21){const _0x274f8e=a35_0x274f();return a35_0x194e=function(_0x194e21,_0x3d2547){_0x194e21=_0x194e21-0xaf;let _0x2f2491=_0x274f8e[_0x194e21];return _0x2f2491;},a35_0x194e(_0x201dba,_0x3aaf21);}var __importDefault=this&&this[a35_0x2c445d(0x176)]||function(_0x75e90d){const _0x15ee2a=a35_0x2c445d;return _0x75e90d&&_0x75e90d[_0x15ee2a(0x175)]?_0x75e90d:{'default':_0x75e90d};};Object['defineProperty'](exports,a35_0x2c445d(0x175),{'value':!![]}),exports[a35_0x2c445d(0x139)]=void 0x0;const database_1=__importDefault(require(a35_0x2c445d(0xda))),bcryptjs_1=__importDefault(require(a35_0x2c445d(0x133))),crypto_1=__importDefault(require(a35_0x2c445d(0x107))),currencyService_1=require(a35_0x2c445d(0xc4));function a35_0x274f(){const _0x3e477c=['toLowerCase','\x20USDT)','4882800pDWnyt','üí∞\x20Found\x20','90d','\x20\x20\x20üñ•Ô∏è\x20User\x20Agent:\x20','failUrl','split','activateUser','randomBytes','periodTo','adminNotes','9429728FJIVxJ','string','\x20USDT\x20(+','payout','groupBy','forEach','Plisio','Payment\x20not\x20found','balance','\x20\x20\x20üë§\x20Merchant\x20earnings:\x20','currency','year','currencyService','paidOutUSDT','date','totalCommissionRate','üí∞\x20Shop\x20','usdcPolygonWallet','REFUND','ACTIVE','2909745jJUGMU','totalPayout','üí∞\x20Creating\x20payout\x20for\x20shop\x20','paymentsCount','dateFrom','wallets','availableBalance','customerEmail','createUser','error','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','9687nrItVd','\x20for\x20shop\x20','gatewaySettings','Shop\x20not\x20found','name','\x20\x20\x20Balance:\x20','Insufficient\x20balance.\x20Available:\x20','reduce','successUrl','turnover','\x20USDT\x20(same\x20as\x20awaiting)','\x20\x20\x20Payout\x20amount:\x20','suspendUser','\x20became\x20PAID:\x20+','__esModule','__importDefault','pk_','notes','insensitive','whiteUrl','335504wfILTO','üîÑ\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','\x20\x20\x20Total\x20paid\x20out:\x20','2020-01-01','getFullYear','\x20->\x20','gatewayOrderId','period','findUnique','30d','getSystemStatistics','\x20\x20\x20üí∞\x20Total\x20payout:\x20','shopId','all','getAllPayouts','usdtTrcWallet','hex','updatePaymentStatus','\x20balance\x20updated:\x20','gateway','getAllUsers','statusChangedBy','map','üìÖ\x20Period:\x20','periodFrom','dateTo','status','not\x20set','CoinToPay','network','averageCommissionRate','amountUSDT','üìä\x20Merchants\x20awaiting\x20payout:\x20','payment','customerIp','Rapyd','createdAt','./currencyService','\x20USDT\x20(total\x20merchant\x20balances)','getUserById','üîÑ\x20Admin\x20updating\x20payment\x20','pendingUrl','$transaction','merchantEarningsUSDT','telegramId','parse','lte','password','üí∞\x20Payment\x20','18aKkxLh','chargebackAmount','convertToUSDT','getPaymentById','\x20\x20\x20üåê\x20IP:\x20','test_gateway','toString','Username\x20already\x20exists','gte','ceil','../config/database','\x20\x20\x20üíµ\x20Available\x20balance:\x20','averageCheckUSDT','toFixed','commissionUSDT','shop','600MvtxKE','update','paidAt','admin','updatedAt','round','getMonth','stringify','customerCountry','gateways','aggregate','orderId','customerName','publicKey','üîÑ\x20Updating\x20customer\x20data\x20for\x20payment\x20','count','getAllPayments','Error\x20processing\x20payment\x20','deleteUser','Noda','getMerchantStatistics','shopUrl','\x20\x20\x20üåç\x20Country:\x20','\x20\x20\x20Current\x20balance:\x20','localeCompare','\x20USDT\x20(-','amount','_sum','default','getMerchantsAwaitingPayout','hash','failureMessage','\x20\x20\x20Transaction\x20hash:\x20','gatewayEarnings','merchantUrl','\x20USDT\x20to\x20balance','username','length','KLYME\x20GB','crypto','\x20\x20\x20üìä\x20Total\x20payments:\x20','COMPLETED','\x20no\x20longer\x20PAID:\x20-','usdtErcWallet','toISOString','sk_','totalPaidOut','values','üìä\x20Getting\x20merchant\x20statistics\x20with\x20filters:','23207HVbYJc','findFirst','telegram','usdtPolygonWallet','toUpperCase','create','getGatewayDisplayName','awaitingPayout','log','\x20\x20\x20üè™\x20Gateway\x20earnings:\x20','getTime','PAID','customerUa','deletePayout','desc','commission','CHARGEBACK','12IuNdhU','turnoverUSDT','paymentGateways','\x20\x20\x20üí∞\x20Total\x20turnover:\x20','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','38557330ZiLBqk','üìä\x20Calculating\x20payout\x20statistics...','sort','\x20USDT','\x20balance\x20updated:','\x20merchants,\x20','Test\x20Gateway','totalPayments','fullName','totalTurnover','\x20USDT\x20(total\x20paid\x20to\x20merchants)','\x20status:\x20','bcryptjs','üìä\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','month','set','_count','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','AdminService','findMany','merchantEarnings'];a35_0x274f=function(){return _0x3e477c;};return a35_0x274f();}class AdminService{async['getPayoutStats'](){const _0x32fc7e=a35_0x2c445d;console['log'](_0x32fc7e(0x128));const _0x121f80=await database_1[_0x32fc7e(0xfc)][_0x32fc7e(0xdf)][_0x32fc7e(0xea)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x32fc7e(0x15b)}}),_0x17e19b=new Date(),_0x2c4e71=new Date(_0x17e19b[_0x32fc7e(0x17f)](),_0x17e19b[_0x32fc7e(0xe6)](),0x1),_0x2a37fc=new Date(_0x17e19b[_0x32fc7e(0x17f)](),_0x17e19b['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x58eff5=await database_1[_0x32fc7e(0xfc)]['payout']['aggregate']({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x2c4e71,'lte':_0x2a37fc},'status':'COMPLETED'}}),_0x304937=_0x121f80[_0x32fc7e(0xfb)][_0x32fc7e(0x10e)]||0x0,_0x4b4f1c=_0x121f80['_sum'][_0x32fc7e(0x150)]||0x0,_0x1d59d8=_0x58eff5[_0x32fc7e(0xfb)]['amount']||0x0,_0x102974={'totalPayout':Math[_0x32fc7e(0xe5)](_0x304937*0x64)/0x64,'awaitingPayout':Math[_0x32fc7e(0xe5)](_0x4b4f1c*0x64)/0x64,'thisMonth':Math['round'](_0x1d59d8*0x64)/0x64,'availableBalance':Math[_0x32fc7e(0xe5)](_0x4b4f1c*0x64)/0x64};return console[_0x32fc7e(0x119)]('üìä\x20Payout\x20statistics\x20calculated:'),console[_0x32fc7e(0x119)](_0x32fc7e(0x186)+_0x102974[_0x32fc7e(0x15d)]+_0x32fc7e(0x131)),console[_0x32fc7e(0x119)](_0x32fc7e(0x126)+_0x102974[_0x32fc7e(0x118)]+_0x32fc7e(0xc5)),console[_0x32fc7e(0x119)](_0x32fc7e(0xdb)+_0x102974[_0x32fc7e(0x162)]+_0x32fc7e(0x171)),console['log']('\x20\x20\x20üìÖ\x20This\x20month:\x20'+_0x102974['thisMonth']+_0x32fc7e(0x12a)),_0x102974;}async['updateCustomerData'](_0x3e8715,_0x2fe9b3){const _0x3d982b=a35_0x2c445d;console['log'](_0x3d982b(0xee)+_0x3e8715+':',_0x2fe9b3);const _0x36dc42=await database_1[_0x3d982b(0xfc)][_0x3d982b(0xc0)][_0x3d982b(0x183)]({'where':{'id':_0x3e8715},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x36dc42)throw new Error(_0x3d982b(0x14f));const _0x3cc190={};_0x2fe9b3[_0x3d982b(0xe8)]!==undefined&&(_0x3cc190[_0x3d982b(0xe8)]=_0x2fe9b3[_0x3d982b(0xe8)]||null);_0x2fe9b3['customerIp']!==undefined&&(_0x3cc190['customerIp']=_0x2fe9b3[_0x3d982b(0xc1)]||null);_0x2fe9b3['customerUa']!==undefined&&(_0x3cc190['customerUa']=_0x2fe9b3[_0x3d982b(0x11d)]||null);const _0x3eceb9=await database_1[_0x3d982b(0xfc)][_0x3d982b(0xc0)][_0x3d982b(0xe1)]({'where':{'id':_0x3e8715},'data':{..._0x3cc190,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x3d982b(0x119)]('‚úÖ\x20Customer\x20data\x20updated\x20for\x20payment\x20'+_0x3e8715),console[_0x3d982b(0x119)](_0x3d982b(0xf6)+_0x36dc42['customerCountry']+_0x3d982b(0x180)+_0x3eceb9[_0x3d982b(0xe8)]),console[_0x3d982b(0x119)](_0x3d982b(0xd4)+_0x36dc42['customerIp']+_0x3d982b(0x180)+_0x3eceb9[_0x3d982b(0xc1)]),console[_0x3d982b(0x119)](_0x3d982b(0x141)+(_0x36dc42[_0x3d982b(0x11d)]?_0x3d982b(0x136):_0x3d982b(0xba))+_0x3d982b(0x180)+(_0x3eceb9[_0x3d982b(0x11d)]?_0x3d982b(0x136):'not\x20set')),_0x3eceb9;}async[a35_0x2c445d(0x185)](_0x5f465d){const _0x26eb8a=a35_0x2c445d,_0x203bbf=new Date();let _0x5a867c;switch(_0x5f465d){case'7d':_0x5a867c=new Date(_0x203bbf['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x26eb8a(0x184):_0x5a867c=new Date(_0x203bbf[_0x26eb8a(0x11b)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x26eb8a(0x140):_0x5a867c=new Date(_0x203bbf[_0x26eb8a(0x11b)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x5a867c=new Date(_0x203bbf['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x494a94,_0x3c8838,_0x44f18b,_0x567a84,_0x1dafd1,_0x588960]=await Promise[_0x26eb8a(0x188)]([database_1[_0x26eb8a(0xfc)]['shop'][_0x26eb8a(0xef)](),database_1[_0x26eb8a(0xfc)][_0x26eb8a(0xdf)][_0x26eb8a(0xef)]({'where':{'status':_0x26eb8a(0x15b)}}),database_1[_0x26eb8a(0xfc)][_0x26eb8a(0xc0)]['count']({'where':{'createdAt':{'gte':_0x5a867c},'gateway':{'not':'test_gateway'}}}),database_1[_0x26eb8a(0xfc)][_0x26eb8a(0xc0)][_0x26eb8a(0xef)]({'where':{'status':_0x26eb8a(0x11c),'createdAt':{'gte':_0x5a867c},'gateway':{'not':_0x26eb8a(0xd5)}}}),database_1['default'][_0x26eb8a(0xc0)][_0x26eb8a(0x13a)]({'where':{'status':_0x26eb8a(0x11c),'createdAt':{'gte':_0x5a867c},'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![]}}),database_1[_0x26eb8a(0xfc)][_0x26eb8a(0xc0)][_0x26eb8a(0x13a)]({'where':{'gateway':{'not':_0x26eb8a(0xd5)}},'take':0xa,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}})]);let _0x34403e=0x0;for(const _0x522e27 of _0x1dafd1){const _0xc646dd=await currencyService_1['currencyService'][_0x26eb8a(0xd2)](_0x522e27['amount'],_0x522e27[_0x26eb8a(0x152)]);_0x34403e+=_0xc646dd;}const _0x2836cf=_0x44f18b>0x0?_0x567a84/_0x44f18b*0x64:0x0;return{'totalShops':_0x494a94,'activeShops':_0x3c8838,'totalPayments':_0x44f18b,'successfulPayments':_0x567a84,'totalRevenue':Math[_0x26eb8a(0xe5)](_0x34403e*0x64)/0x64,'conversionRate':Math[_0x26eb8a(0xe5)](_0x2836cf*0x64)/0x64,'recentPayments':_0x588960[_0x26eb8a(0xb5)](_0x5cb798=>({'id':_0x5cb798['id'],'amount':_0x5cb798[_0x26eb8a(0xfa)],'currency':_0x5cb798[_0x26eb8a(0x152)],'status':_0x5cb798[_0x26eb8a(0xb9)],'gateway':_0x5cb798[_0x26eb8a(0xb2)],'shop':_0x5cb798['shop'],'createdAt':_0x5cb798['createdAt']}))};}async[a35_0x2c445d(0xf4)](_0x364248){const _0x33805d=a35_0x2c445d;console['log'](_0x33805d(0x110),_0x364248);let _0x3cd25f,_0x4ed3b5=new Date();if(_0x364248[_0x33805d(0x182)]==='custom'&&_0x364248[_0x33805d(0x160)]&&_0x364248[_0x33805d(0xb8)])_0x3cd25f=new Date(_0x364248['dateFrom']),_0x4ed3b5=new Date(_0x364248['dateTo']);else{const _0xb1b7dc=new Date();switch(_0x364248[_0x33805d(0x182)]){case'week':_0x3cd25f=new Date(_0xb1b7dc[_0x33805d(0x11b)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x33805d(0x135):_0x3cd25f=new Date(_0xb1b7dc[_0x33805d(0x11b)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x33805d(0x153):_0x3cd25f=new Date(_0xb1b7dc['getTime']()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x33805d(0x188):default:_0x3cd25f=new Date(_0x33805d(0x17e));break;}}console[_0x33805d(0x119)](_0x33805d(0xb6)+_0x3cd25f['toISOString']()+'\x20to\x20'+_0x4ed3b5[_0x33805d(0x10c)]());const _0x3a0936={'status':_0x33805d(0x11c),'gateway':{'not':_0x33805d(0xd5)},'paidAt':{'gte':_0x3cd25f,'lte':_0x4ed3b5}};_0x364248[_0x33805d(0x187)]&&(_0x3a0936[_0x33805d(0x187)]=_0x364248[_0x33805d(0x187)]);const _0xc4140b=await database_1[_0x33805d(0xfc)]['payment'][_0x33805d(0x13a)]({'where':_0x3a0936,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x33805d(0x119)](_0x33805d(0x13f)+_0xc4140b[_0x33805d(0x105)]+'\x20paid\x20payments\x20for\x20analysis');let _0x404c54=0x0,_0x2ed43d=0x0,_0x42d402=0x0;const _0x35d842={},_0xad4db={},_0x5a1759={};for(const _0x493488 of _0xc4140b){try{const _0x17724a=await currencyService_1['currencyService'][_0x33805d(0xd2)](_0x493488[_0x33805d(0xfa)],_0x493488[_0x33805d(0x152)]);let _0x2d273b={};if(_0x493488[_0x33805d(0xdf)]['gatewaySettings'])try{_0x2d273b=JSON[_0x33805d(0xcc)](_0x493488['shop'][_0x33805d(0x169)]);}catch(_0x12bf60){console[_0x33805d(0x165)](_0x33805d(0x138)+_0x493488[_0x33805d(0x187)]+':',_0x12bf60);}const _0x2b5a6a=_0x2d273b[_0x33805d(0x120)]||0xa,_0x7d6550=_0x17724a*(_0x2b5a6a/0x64),_0xb367ba=_0x17724a-_0x7d6550;_0x404c54+=_0x17724a,_0x2ed43d+=_0xb367ba,_0x42d402+=_0x7d6550;!_0x35d842[_0x493488[_0x33805d(0xb2)]]&&(_0x35d842[_0x493488[_0x33805d(0xb2)]]={'gateway':_0x493488['gateway'],'gatewayDisplayName':this['getGatewayDisplayName'](_0x493488[_0x33805d(0xb2)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x35d842[_0x493488[_0x33805d(0xb2)]][_0x33805d(0x15f)]++,_0x35d842[_0x493488[_0x33805d(0xb2)]][_0x33805d(0x123)]+=_0x17724a,_0x35d842[_0x493488[_0x33805d(0xb2)]][_0x33805d(0xde)]+=_0x7d6550,_0x35d842[_0x493488['gateway']]['merchantEarningsUSDT']+=_0xb367ba,_0x35d842[_0x493488['gateway']]['totalCommissionRate']+=_0x2b5a6a;!_0x364248[_0x33805d(0x187)]&&(!_0xad4db[_0x493488[_0x33805d(0x187)]]&&(_0xad4db[_0x493488[_0x33805d(0x187)]]={'shopId':_0x493488['shopId'],'shopName':_0x493488['shop'][_0x33805d(0x16b)],'shopUsername':_0x493488[_0x33805d(0xdf)]['username'],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0xad4db[_0x493488[_0x33805d(0x187)]][_0x33805d(0x15f)]++,_0xad4db[_0x493488[_0x33805d(0x187)]][_0x33805d(0x123)]+=_0x17724a,_0xad4db[_0x493488[_0x33805d(0x187)]][_0x33805d(0xde)]+=_0x7d6550,_0xad4db[_0x493488[_0x33805d(0x187)]][_0x33805d(0xca)]+=_0xb367ba);const _0x574605=_0x493488['paidAt'][_0x33805d(0x10c)]()[_0x33805d(0x143)]('T')[0x0];!_0x5a1759[_0x574605]&&(_0x5a1759[_0x574605]={'date':_0x574605,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x5a1759[_0x574605][_0x33805d(0x170)]+=_0x17724a,_0x5a1759[_0x574605]['merchantEarnings']+=_0xb367ba,_0x5a1759[_0x574605]['gatewayEarnings']+=_0x7d6550,_0x5a1759[_0x574605][_0x33805d(0x15f)]++;}catch(_0x3fd2b3){console[_0x33805d(0x165)](_0x33805d(0xf1)+_0x493488['id']+':',_0x3fd2b3);}}Object[_0x33805d(0x10f)](_0x35d842)['forEach'](_0x3963d7=>{const _0x2cdcf6=_0x33805d;_0x3963d7['averageCommissionRate']=_0x3963d7['paymentsCount']>0x0?_0x3963d7[_0x2cdcf6(0x157)]/_0x3963d7[_0x2cdcf6(0x15f)]:0x0,delete _0x3963d7['totalCommissionRate'];}),Object[_0x33805d(0x10f)](_0xad4db)[_0x33805d(0x14d)](_0x5176ac=>{const _0x183982=_0x33805d;_0x5176ac[_0x183982(0xdc)]=_0x5176ac[_0x183982(0x15f)]>0x0?_0x5176ac['turnoverUSDT']/_0x5176ac[_0x183982(0x15f)]:0x0;});let _0x3e9ece=0x0;if(_0x364248['shopId']){const _0x1e10cc=await database_1[_0x33805d(0xfc)][_0x33805d(0x14b)][_0x33805d(0x13a)]({'where':{'shopId':_0x364248['shopId'],'status':_0x33805d(0x109),'createdAt':{'gte':_0x3cd25f,'lte':_0x4ed3b5}},'select':{'amount':!![]}});_0x3e9ece=_0x1e10cc[_0x33805d(0x16e)]((_0x5a1f93,_0x4a646d)=>_0x5a1f93+_0x4a646d[_0x33805d(0xfa)],0x0);}const _0x4e2033=_0xc4140b[_0x33805d(0x105)],_0x4523ed=_0xc4140b['length'],_0x26f0d7=_0x4e2033>0x0?_0x404c54/_0x4e2033:0x0,_0x4f07cd=0x64,_0x11480e=Math[_0x33805d(0xd9)]((_0x4ed3b5[_0x33805d(0x11b)]()-_0x3cd25f[_0x33805d(0x11b)]())/(0x3e8*0x3c*0x3c*0x18)),_0x6075fb={'totalTurnover':Math[_0x33805d(0xe5)](_0x404c54*0x64)/0x64,'merchantEarnings':Math[_0x33805d(0xe5)](_0x2ed43d*0x64)/0x64,'gatewayEarnings':Math[_0x33805d(0xe5)](_0x42d402*0x64)/0x64,'totalPaidOut':Math[_0x33805d(0xe5)](_0x3e9ece*0x64)/0x64,'averageCheck':Math[_0x33805d(0xe5)](_0x26f0d7*0x64)/0x64,'totalPayments':_0x4e2033,'successfulPayments':_0x4523ed,'conversionRate':_0x4f07cd,'gatewayBreakdown':Object[_0x33805d(0x10f)](_0x35d842)[_0x33805d(0xb5)](_0x4f8e7b=>({..._0x4f8e7b,'turnoverUSDT':Math[_0x33805d(0xe5)](_0x4f8e7b[_0x33805d(0x123)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x4f8e7b['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x33805d(0xe5)](_0x4f8e7b[_0x33805d(0xca)]*0x64)/0x64,'averageCommissionRate':Math[_0x33805d(0xe5)](_0x4f8e7b[_0x33805d(0xbd)]*0x64)/0x64})),'merchantBreakdown':_0x364248[_0x33805d(0x187)]?undefined:Object[_0x33805d(0x10f)](_0xad4db)[_0x33805d(0xb5)](_0x38d9ca=>({..._0x38d9ca,'turnoverUSDT':Math[_0x33805d(0xe5)](_0x38d9ca[_0x33805d(0x123)]*0x64)/0x64,'commissionUSDT':Math[_0x33805d(0xe5)](_0x38d9ca['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x33805d(0xe5)](_0x38d9ca['merchantEarningsUSDT']*0x64)/0x64,'paidOutUSDT':Math['round'](_0x38d9ca[_0x33805d(0x155)]*0x64)/0x64,'averageCheckUSDT':Math[_0x33805d(0xe5)](_0x38d9ca[_0x33805d(0xdc)]*0x64)/0x64})),'dailyData':Object['values'](_0x5a1759)[_0x33805d(0xb5)](_0x487a32=>({..._0x487a32,'turnover':Math[_0x33805d(0xe5)](_0x487a32['turnover']*0x64)/0x64,'merchantEarnings':Math[_0x33805d(0xe5)](_0x487a32['merchantEarnings']*0x64)/0x64,'gatewayEarnings':Math[_0x33805d(0xe5)](_0x487a32[_0x33805d(0x101)]*0x64)/0x64}))[_0x33805d(0x129)]((_0xf6c9d1,_0x39016d)=>_0xf6c9d1[_0x33805d(0x156)][_0x33805d(0xf8)](_0x39016d[_0x33805d(0x156)])),'periodInfo':{'from':_0x3cd25f,'to':_0x4ed3b5,'periodType':_0x364248[_0x33805d(0x182)]||'custom','daysCount':_0x11480e}};return console[_0x33805d(0x119)]('üìä\x20Merchant\x20statistics\x20calculated:'),console['log'](_0x33805d(0x125)+_0x6075fb[_0x33805d(0x130)]+_0x33805d(0x12a)),console[_0x33805d(0x119)](_0x33805d(0x151)+_0x6075fb[_0x33805d(0x13b)]+_0x33805d(0x12a)),console[_0x33805d(0x119)](_0x33805d(0x11a)+_0x6075fb[_0x33805d(0x101)]+'\x20USDT'),console[_0x33805d(0x119)](_0x33805d(0x108)+_0x6075fb[_0x33805d(0x12e)]),_0x6075fb;}[a35_0x2c445d(0x117)](_0x3b5f8f){const _0x249a9d=a35_0x2c445d,_0x3b2f09={'test_gateway':_0x249a9d(0x12d),'plisio':_0x249a9d(0x14e),'rapyd':_0x249a9d(0xc2),'noda':_0x249a9d(0xf3),'cointopay':_0x249a9d(0xbb),'klyme_eu':'KLYME\x20EU','klyme_gb':_0x249a9d(0x106),'klyme_de':'KLYME\x20DE'};return _0x3b2f09[_0x3b5f8f]||_0x3b5f8f;}async[a35_0x2c445d(0xfd)](_0x14f89c){const _0x250809=a35_0x2c445d,{page:_0x162c07,limit:_0x5c9a9c,minAmount:_0xa973da,search:_0x3cea2c}=_0x14f89c,_0x178ee1=(_0x162c07-0x1)*_0x5c9a9c;console[_0x250809(0x119)](_0x250809(0x134),_0x14f89c);const _0x2088de={'balance':{'gt':0x0},'status':_0x250809(0x15b)};_0xa973da&&(_0x2088de[_0x250809(0x150)][_0x250809(0xd8)]=_0xa973da);_0x3cea2c&&(_0x2088de['OR']=[{'name':{'contains':_0x3cea2c,'mode':_0x250809(0x179)}},{'username':{'contains':_0x3cea2c,'mode':'insensitive'}}]);const [_0x7a5a8f,_0x4b66ad]=await Promise['all']([database_1['default'][_0x250809(0xdf)][_0x250809(0x13a)]({'where':_0x2088de,'skip':_0x178ee1,'take':_0x5c9a9c,'orderBy':{'balance':_0x250809(0x11f)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'createdAt':!![]}}),database_1[_0x250809(0xfc)][_0x250809(0xdf)][_0x250809(0xef)]({'where':_0x2088de})]);console['log'](_0x250809(0x13f)+_0x7a5a8f[_0x250809(0x105)]+'\x20merchants\x20with\x20positive\x20balance');const _0x529008=await Promise[_0x250809(0x188)](_0x7a5a8f[_0x250809(0xb5)](async _0x5a9be3=>{const _0x16c093=_0x250809,[_0x20ab96,_0xad4a38,_0x3faff9]=await Promise[_0x16c093(0x188)]([database_1[_0x16c093(0xfc)][_0x16c093(0xc0)][_0x16c093(0xef)]({'where':{'shopId':_0x5a9be3['id'],'status':'PAID','amountUSDT':{'not':null}}}),database_1['default'][_0x16c093(0xc0)][_0x16c093(0x112)]({'where':{'shopId':_0x5a9be3['id'],'status':_0x16c093(0x11c),'amountUSDT':{'not':null}},'orderBy':{'paidAt':'asc'},'select':{'paidAt':!![]}}),database_1[_0x16c093(0xfc)][_0x16c093(0xc0)][_0x16c093(0x14c)]({'by':[_0x16c093(0xb2)],'where':{'shopId':_0x5a9be3['id'],'status':_0x16c093(0x11c),'amountUSDT':{'not':null}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x30de70=_0x3faff9[_0x16c093(0xb5)](_0x15c8c5=>({'gateway':_0x15c8c5[_0x16c093(0xb2)],'count':_0x15c8c5[_0x16c093(0x137)]['id'],'amountUSDT':_0x15c8c5[_0x16c093(0xfb)][_0x16c093(0xbe)]||0x0,'amountAfterCommissionUSDT':_0x15c8c5[_0x16c093(0xfb)][_0x16c093(0xbe)]||0x0,'commission':0x0}));return{'id':_0x5a9be3['id'],'fullName':_0x5a9be3['name'],'username':_0x5a9be3[_0x16c093(0x104)],'telegramId':_0x5a9be3[_0x16c093(0x113)],'merchantUrl':_0x5a9be3[_0x16c093(0xf5)],'wallets':{'usdtPolygonWallet':_0x5a9be3[_0x16c093(0x114)],'usdtTrcWallet':_0x5a9be3[_0x16c093(0x18a)],'usdtErcWallet':_0x5a9be3[_0x16c093(0x10b)],'usdcPolygonWallet':_0x5a9be3['usdcPolygonWallet']},'totalAmountUSDT':_0x5a9be3[_0x16c093(0x150)],'totalAmountAfterCommissionUSDT':_0x5a9be3['balance'],'paymentsCount':_0x20ab96,'oldestPaymentDate':_0xad4a38?.['paidAt']||_0x5a9be3[_0x16c093(0xc3)],'gatewayBreakdown':_0x30de70};})),_0x1a26ba=_0x7a5a8f[_0x250809(0x16e)]((_0x2e6b3f,_0x172f7e)=>_0x2e6b3f+_0x172f7e['balance'],0x0),_0x59a21d=_0x1a26ba;return console[_0x250809(0x119)](_0x250809(0xbf)+_0x4b66ad+_0x250809(0x12c)+Math[_0x250809(0xe5)](_0x59a21d*0x64)/0x64+'\x20USDT\x20total'),{'merchants':_0x529008,'pagination':{'page':_0x162c07,'limit':_0x5c9a9c,'total':_0x4b66ad,'totalPages':Math[_0x250809(0xd9)](_0x4b66ad/_0x5c9a9c)},'summary':{'totalMerchants':_0x4b66ad,'totalAmountUSDT':Math[_0x250809(0xe5)](_0x1a26ba*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x250809(0xe5)](_0x59a21d*0x64)/0x64}};}async['createPayout'](_0x4e0aff){const _0x1b3b16=a35_0x2c445d,{shopId:_0x194046,amount:_0x221633,network:_0x4cd8a4,notes:_0x3d430f,txid:_0x193c0c,periodFrom:_0x4aed7d,periodTo:_0x4f4844}=_0x4e0aff,_0x879983=await database_1[_0x1b3b16(0xfc)][_0x1b3b16(0xc9)](async _0x73c8ce=>{const _0x2e9a5b=_0x1b3b16,_0x69bb26=await _0x73c8ce[_0x2e9a5b(0xdf)][_0x2e9a5b(0x183)]({'where':{'id':_0x194046},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x69bb26)throw new Error(_0x2e9a5b(0x16a));console[_0x2e9a5b(0x119)](_0x2e9a5b(0x15e)+_0x69bb26['username']+':'),console[_0x2e9a5b(0x119)](_0x2e9a5b(0xf7)+_0x69bb26[_0x2e9a5b(0x150)][_0x2e9a5b(0xdd)](0x6)+_0x2e9a5b(0x12a)),console[_0x2e9a5b(0x119)](_0x2e9a5b(0x172)+_0x221633['toFixed'](0x6)+_0x2e9a5b(0x12a)),console[_0x2e9a5b(0x119)](_0x2e9a5b(0x166)+_0x69bb26[_0x2e9a5b(0x10e)][_0x2e9a5b(0xdd)](0x6)+_0x2e9a5b(0x12a));if(_0x193c0c)console[_0x2e9a5b(0x119)](_0x2e9a5b(0x100)+_0x193c0c);if(_0x69bb26[_0x2e9a5b(0x150)]<_0x221633)throw new Error(_0x2e9a5b(0x16d)+_0x69bb26[_0x2e9a5b(0x150)][_0x2e9a5b(0xdd)](0x6)+'\x20USDT,\x20Requested:\x20'+_0x221633['toFixed'](0x6)+_0x2e9a5b(0x12a));const _0x2b9d8d=await _0x73c8ce[_0x2e9a5b(0x14b)]['create']({'data':{'shopId':_0x194046,'amount':_0x221633,'network':_0x4cd8a4,'status':_0x2e9a5b(0x109),'txid':_0x193c0c,'notes':_0x3d430f,'periodFrom':_0x4aed7d?new Date(_0x4aed7d):null,'periodTo':_0x4f4844?new Date(_0x4f4844):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x3b33fb=_0x69bb26[_0x2e9a5b(0x150)]-_0x221633,_0x53814b=_0x69bb26[_0x2e9a5b(0x10e)]+_0x221633;return await _0x73c8ce['shop']['update']({'where':{'id':_0x194046},'data':{'balance':_0x3b33fb,'totalPaidOut':_0x53814b}}),console[_0x2e9a5b(0x119)](_0x2e9a5b(0x158)+_0x69bb26[_0x2e9a5b(0x104)]+_0x2e9a5b(0x12b)),console[_0x2e9a5b(0x119)](_0x2e9a5b(0x16c)+_0x69bb26[_0x2e9a5b(0x150)][_0x2e9a5b(0xdd)](0x6)+'\x20->\x20'+_0x3b33fb['toFixed'](0x6)+_0x2e9a5b(0xf9)+_0x221633['toFixed'](0x6)+')'),console[_0x2e9a5b(0x119)](_0x2e9a5b(0x17d)+_0x69bb26[_0x2e9a5b(0x10e)]['toFixed'](0x6)+_0x2e9a5b(0x180)+_0x53814b[_0x2e9a5b(0xdd)](0x6)+_0x2e9a5b(0x14a)+_0x221633[_0x2e9a5b(0xdd)](0x6)+')'),{'payout':_0x2b9d8d,'shop':_0x69bb26};});return console[_0x1b3b16(0x119)]('‚úÖ\x20Payout\x20created:\x20'+_0x879983['payout']['id']+_0x1b3b16(0x168)+_0x879983[_0x1b3b16(0xdf)][_0x1b3b16(0x104)]+'\x20('+_0x221633+_0x1b3b16(0x13d)),{'id':_0x879983[_0x1b3b16(0x14b)]['id'],'shopId':_0x879983[_0x1b3b16(0x14b)]['shopId'],'shopName':_0x879983[_0x1b3b16(0xdf)][_0x1b3b16(0x16b)],'shopUsername':_0x879983['shop'][_0x1b3b16(0x104)],'amount':_0x879983[_0x1b3b16(0x14b)]['amount'],'network':_0x879983[_0x1b3b16(0x14b)][_0x1b3b16(0xbc)],'status':_0x879983[_0x1b3b16(0x14b)][_0x1b3b16(0xb9)],'txid':_0x879983[_0x1b3b16(0x14b)]['txid'],'notes':_0x879983['payout']['notes'],'periodFrom':_0x879983[_0x1b3b16(0x14b)]['periodFrom'],'periodTo':_0x879983[_0x1b3b16(0x14b)][_0x1b3b16(0x146)],'createdAt':_0x879983['payout'][_0x1b3b16(0xc3)],'paidAt':_0x879983[_0x1b3b16(0x14b)][_0x1b3b16(0xe2)]};}async[a35_0x2c445d(0x189)](_0xf7e57c){const _0x4cf4e2=a35_0x2c445d,{page:_0x5ad500,limit:_0x661d48,shopId:_0x411e93,network:_0x384fa8,dateFrom:_0x4859cd,dateTo:_0x4e1d9b,search:_0x54fdb9}=_0xf7e57c,_0x4faee1=(_0x5ad500-0x1)*_0x661d48,_0x2bebc6={};_0x411e93&&(_0x2bebc6[_0x4cf4e2(0x187)]=_0x411e93);_0x384fa8&&(_0x2bebc6['network']=_0x384fa8);(_0x4859cd||_0x4e1d9b)&&(_0x2bebc6[_0x4cf4e2(0xc3)]={},_0x4859cd&&(_0x2bebc6['createdAt']['gte']=new Date(_0x4859cd)),_0x4e1d9b&&(_0x2bebc6['createdAt'][_0x4cf4e2(0xcd)]=new Date(_0x4e1d9b)));_0x54fdb9&&(_0x2bebc6['OR']=[{'shop':{'name':{'contains':_0x54fdb9,'mode':_0x4cf4e2(0x179)}}},{'shop':{'username':{'contains':_0x54fdb9,'mode':'insensitive'}}},{'notes':{'contains':_0x54fdb9,'mode':'insensitive'}}]);const [_0x5012e3,_0x4021ef]=await Promise[_0x4cf4e2(0x188)]([database_1[_0x4cf4e2(0xfc)][_0x4cf4e2(0x14b)]['findMany']({'where':_0x2bebc6,'skip':_0x4faee1,'take':_0x661d48,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x4cf4e2(0x14b)][_0x4cf4e2(0xef)]({'where':_0x2bebc6})]);return{'payouts':_0x5012e3[_0x4cf4e2(0xb5)](_0x8c02b2=>({'id':_0x8c02b2['id'],'shopId':_0x8c02b2[_0x4cf4e2(0x187)],'shopName':_0x8c02b2['shop'][_0x4cf4e2(0x16b)],'shopUsername':_0x8c02b2[_0x4cf4e2(0xdf)][_0x4cf4e2(0x104)],'amount':_0x8c02b2[_0x4cf4e2(0xfa)],'network':_0x8c02b2['network'],'status':_0x8c02b2[_0x4cf4e2(0xb9)],'txid':_0x8c02b2['txid'],'notes':_0x8c02b2[_0x4cf4e2(0x178)],'periodFrom':_0x8c02b2[_0x4cf4e2(0xb7)],'periodTo':_0x8c02b2[_0x4cf4e2(0x146)],'createdAt':_0x8c02b2[_0x4cf4e2(0xc3)],'paidAt':_0x8c02b2[_0x4cf4e2(0xe2)]})),'pagination':{'page':_0x5ad500,'limit':_0x661d48,'total':_0x4021ef,'totalPages':Math['ceil'](_0x4021ef/_0x661d48)}};}async['getPayoutById'](_0x3d776){const _0x240d1e=a35_0x2c445d,_0xf17f75=await database_1[_0x240d1e(0xfc)][_0x240d1e(0x14b)][_0x240d1e(0x183)]({'where':{'id':_0x3d776},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0xf17f75)return null;return{'id':_0xf17f75['id'],'shopId':_0xf17f75[_0x240d1e(0x187)],'shopName':_0xf17f75[_0x240d1e(0xdf)]['name'],'shopUsername':_0xf17f75['shop'][_0x240d1e(0x104)],'amount':_0xf17f75[_0x240d1e(0xfa)],'network':_0xf17f75['network'],'status':_0xf17f75[_0x240d1e(0xb9)],'txid':_0xf17f75['txid'],'notes':_0xf17f75['notes'],'periodFrom':_0xf17f75[_0x240d1e(0xb7)],'periodTo':_0xf17f75[_0x240d1e(0x146)],'createdAt':_0xf17f75[_0x240d1e(0xc3)],'paidAt':_0xf17f75['paidAt']};}async[a35_0x2c445d(0x11e)](_0x4f73be){const _0xa7f9cf=a35_0x2c445d;await database_1[_0xa7f9cf(0xfc)][_0xa7f9cf(0x14b)]['delete']({'where':{'id':_0x4f73be}});}async[a35_0x2c445d(0xf0)](_0x3b21bb){const _0xbb9fbc=a35_0x2c445d,{page:_0x5813b5,limit:_0x17fdc5,status:_0x16cf46,gateway:_0xa52d6f,shopId:_0x44a407,dateFrom:_0x2e27cf,dateTo:_0x48911d,search:_0x3a2778}=_0x3b21bb,_0x1c7504=(_0x5813b5-0x1)*_0x17fdc5,_0x3a862a={};_0x16cf46&&(_0x3a862a[_0xbb9fbc(0xb9)]=_0x16cf46[_0xbb9fbc(0x115)]());_0xa52d6f&&(_0x3a862a[_0xbb9fbc(0xb2)]=_0xa52d6f[_0xbb9fbc(0x13c)]());_0x3a862a[_0xbb9fbc(0xb2)]=_0x3a862a[_0xbb9fbc(0xb2)]?_0x3a862a[_0xbb9fbc(0xb2)]:{'not':_0xbb9fbc(0xd5)};if(typeof _0x3a862a[_0xbb9fbc(0xb2)]==='string'&&_0x3a862a['gateway']!==_0xbb9fbc(0xd5)){}else{if(typeof _0x3a862a['gateway']===_0xbb9fbc(0x149)&&_0x3a862a[_0xbb9fbc(0xb2)]===_0xbb9fbc(0xd5)){}else _0x3a862a[_0xbb9fbc(0xb2)]={'not':_0xbb9fbc(0xd5)};}_0x44a407&&(_0x3a862a['shopId']=_0x44a407);(_0x2e27cf||_0x48911d)&&(_0x3a862a['createdAt']={},_0x2e27cf&&(_0x3a862a[_0xbb9fbc(0xc3)][_0xbb9fbc(0xd8)]=new Date(_0x2e27cf)),_0x48911d&&(_0x3a862a['createdAt']['lte']=new Date(_0x48911d)));_0x3a2778&&(_0x3a862a['OR']=[{'orderId':{'contains':_0x3a2778,'mode':_0xbb9fbc(0x179)}},{'gatewayOrderId':{'contains':_0x3a2778,'mode':_0xbb9fbc(0x179)}},{'customerEmail':{'contains':_0x3a2778,'mode':'insensitive'}},{'shop':{'name':{'contains':_0x3a2778,'mode':_0xbb9fbc(0x179)}}},{'shop':{'username':{'contains':_0x3a2778,'mode':_0xbb9fbc(0x179)}}}]);const [_0x305ca2,_0x135984]=await Promise['all']([database_1[_0xbb9fbc(0xfc)][_0xbb9fbc(0xc0)][_0xbb9fbc(0x13a)]({'where':_0x3a862a,'skip':_0x1c7504,'take':_0x17fdc5,'orderBy':{'createdAt':_0xbb9fbc(0x11f)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0xbb9fbc(0xfc)][_0xbb9fbc(0xc0)][_0xbb9fbc(0xef)]({'where':_0x3a862a})]);return{'payments':_0x305ca2[_0xbb9fbc(0xb5)](_0x3a7113=>({'id':_0x3a7113['id'],'shopId':_0x3a7113[_0xbb9fbc(0x187)],'gateway':_0x3a7113['gateway'],'amount':_0x3a7113['amount'],'currency':_0x3a7113[_0xbb9fbc(0x152)],'status':_0x3a7113[_0xbb9fbc(0xb9)],'orderId':_0x3a7113[_0xbb9fbc(0xeb)],'gatewayOrderId':_0x3a7113[_0xbb9fbc(0x181)],'customerEmail':_0x3a7113[_0xbb9fbc(0x163)],'customerName':_0x3a7113[_0xbb9fbc(0xec)],'customerCountry':_0x3a7113[_0xbb9fbc(0xe8)],'customerIp':_0x3a7113['customerIp'],'customerUa':_0x3a7113[_0xbb9fbc(0x11d)],'failureMessage':_0x3a7113[_0xbb9fbc(0xff)],'createdAt':_0x3a7113[_0xbb9fbc(0xc3)],'updatedAt':_0x3a7113[_0xbb9fbc(0xe4)],'shop':_0x3a7113[_0xbb9fbc(0xdf)]})),'pagination':{'page':_0x5813b5,'limit':_0x17fdc5,'total':_0x135984,'totalPages':Math[_0xbb9fbc(0xd9)](_0x135984/_0x17fdc5)}};}async[a35_0x2c445d(0xd3)](_0x4b4773){const _0x139155=a35_0x2c445d,_0x3bf5c0=await database_1[_0x139155(0xfc)][_0x139155(0xc0)][_0x139155(0x183)]({'where':{'id':_0x4b4773},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x3bf5c0)return null;return{'id':_0x3bf5c0['id'],'shopId':_0x3bf5c0[_0x139155(0x187)],'gateway':_0x3bf5c0[_0x139155(0xb2)],'amount':_0x3bf5c0[_0x139155(0xfa)],'currency':_0x3bf5c0[_0x139155(0x152)],'status':_0x3bf5c0['status'],'orderId':_0x3bf5c0[_0x139155(0xeb)],'gatewayOrderId':_0x3bf5c0['gatewayOrderId'],'customerEmail':_0x3bf5c0['customerEmail'],'customerName':_0x3bf5c0['customerName'],'customerCountry':_0x3bf5c0[_0x139155(0xe8)],'customerIp':_0x3bf5c0[_0x139155(0xc1)],'customerUa':_0x3bf5c0['customerUa'],'failureMessage':_0x3bf5c0[_0x139155(0xff)],'externalPaymentUrl':_0x3bf5c0['externalPaymentUrl'],'successUrl':_0x3bf5c0[_0x139155(0x16f)],'failUrl':_0x3bf5c0[_0x139155(0x142)],'pendingUrl':_0x3bf5c0[_0x139155(0xc8)],'whiteUrl':_0x3bf5c0[_0x139155(0x17a)],'createdAt':_0x3bf5c0[_0x139155(0xc3)],'updatedAt':_0x3bf5c0[_0x139155(0xe4)],'shop':_0x3bf5c0[_0x139155(0xdf)]};}async[a35_0x2c445d(0xb0)](_0x50f90c,_0x2ccfd1,_0x3d7525,_0xcd9934){const _0x37d987=a35_0x2c445d,_0x169e1c=await database_1[_0x37d987(0xfc)][_0x37d987(0xc9)](async _0xab82dc=>{const _0x2c84ad=_0x37d987,_0x171215=await _0xab82dc[_0x2c84ad(0xc0)][_0x2c84ad(0x183)]({'where':{'id':_0x50f90c},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x171215)throw new Error('Payment\x20not\x20found');const _0x563185=_0x171215[_0x2c84ad(0xb9)],_0x45238e=_0x2ccfd1['toUpperCase']();console[_0x2c84ad(0x119)](_0x2c84ad(0xc7)+_0x50f90c+_0x2c84ad(0x132)+_0x563185+_0x2c84ad(0x180)+_0x45238e),console[_0x2c84ad(0x119)]('üí∞\x20Current\x20shop\x20balance:\x20'+_0x171215[_0x2c84ad(0xdf)]['balance']+'\x20USDT');const _0x2e4118={'status':_0x45238e,'updatedAt':new Date(),'statusChangedBy':_0x2c84ad(0xe3),'statusChangedAt':new Date()};_0x3d7525&&(_0x2e4118[_0x2c84ad(0x147)]=_0x3d7525);_0x45238e===_0x2c84ad(0x121)&&_0xcd9934&&(_0x2e4118[_0x2c84ad(0xd1)]=_0xcd9934);let _0x16087f=0x0,_0x3644f0=_0x171215[_0x2c84ad(0xdf)][_0x2c84ad(0x150)];if(_0x45238e===_0x2c84ad(0x11c)&&_0x563185!==_0x2c84ad(0x11c)){_0x2e4118[_0x2c84ad(0xe2)]=new Date();const _0x4c6196=await currencyService_1[_0x2c84ad(0x154)][_0x2c84ad(0xd2)](_0x171215['amount'],_0x171215['currency']);_0x2e4118['amountUSDT']=_0x4c6196,_0x16087f=_0x4c6196,_0x3644f0+=_0x4c6196,console[_0x2c84ad(0x119)](_0x2c84ad(0xcf)+_0x50f90c+_0x2c84ad(0x174)+_0x4c6196[_0x2c84ad(0xdd)](0x6)+_0x2c84ad(0x103));}else _0x563185===_0x2c84ad(0x11c)&&_0x45238e!==_0x2c84ad(0x11c)&&(_0x171215[_0x2c84ad(0xbe)]&&(_0x16087f=-_0x171215[_0x2c84ad(0xbe)],_0x3644f0-=_0x171215['amountUSDT'],_0x2e4118[_0x2c84ad(0xbe)]=null,console[_0x2c84ad(0x119)](_0x2c84ad(0xcf)+_0x50f90c+_0x2c84ad(0x10a)+_0x171215[_0x2c84ad(0xbe)][_0x2c84ad(0xdd)](0x6)+'\x20USDT\x20from\x20balance')));if(_0x45238e===_0x2c84ad(0x121)){if(_0x563185==='PAID'&&_0x171215['amountUSDT']){}_0xcd9934&&_0xcd9934>0x0&&(_0x16087f-=_0xcd9934,_0x3644f0-=_0xcd9934,console[_0x2c84ad(0x119)]('üí∏\x20CHARGEBACK\x20penalty:\x20-'+_0xcd9934['toFixed'](0x6)+'\x20USDT\x20from\x20balance'));}_0x45238e===_0x2c84ad(0x15a)&&_0x563185===_0x2c84ad(0x11c)&&console[_0x2c84ad(0x119)](_0x2c84ad(0x17c));const _0x10d8d6=await _0xab82dc['payment'][_0x2c84ad(0xe1)]({'where':{'id':_0x50f90c},'data':_0x2e4118,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x16087f!==0x0&&(await _0xab82dc[_0x2c84ad(0xdf)][_0x2c84ad(0xe1)]({'where':{'id':_0x171215[_0x2c84ad(0x187)]},'data':{'balance':_0x3644f0}}),console['log']('üí∞\x20Shop\x20'+_0x171215[_0x2c84ad(0x187)]+_0x2c84ad(0xb1)+_0x171215[_0x2c84ad(0xdf)]['balance']['toFixed'](0x6)+_0x2c84ad(0x180)+_0x3644f0[_0x2c84ad(0xdd)](0x6)+'\x20USDT\x20('+(_0x16087f>0x0?'+':'')+_0x16087f[_0x2c84ad(0xdd)](0x6)+')')),_0x10d8d6;});return{'id':_0x169e1c['id'],'shopId':_0x169e1c[_0x37d987(0x187)],'gateway':_0x169e1c[_0x37d987(0xb2)],'amount':_0x169e1c[_0x37d987(0xfa)],'currency':_0x169e1c[_0x37d987(0x152)],'status':_0x169e1c[_0x37d987(0xb9)],'orderId':_0x169e1c['orderId'],'gatewayOrderId':_0x169e1c[_0x37d987(0x181)],'customerEmail':_0x169e1c['customerEmail'],'customerName':_0x169e1c['customerName'],'customerCountry':_0x169e1c[_0x37d987(0xe8)],'customerIp':_0x169e1c[_0x37d987(0xc1)],'customerUa':_0x169e1c[_0x37d987(0x11d)],'failureMessage':_0x169e1c[_0x37d987(0xff)],'adminNotes':_0x169e1c[_0x37d987(0x147)],'chargebackAmount':_0x169e1c[_0x37d987(0xd1)],'statusChangedBy':_0x169e1c[_0x37d987(0xb4)],'statusChangedAt':_0x169e1c['statusChangedAt'],'createdAt':_0x169e1c['createdAt'],'updatedAt':_0x169e1c[_0x37d987(0xe4)],'shop':_0x169e1c[_0x37d987(0xdf)]};}async['updateUser'](_0x4f1c08,_0x327941){const _0x40a775=a35_0x2c445d,_0x4060d2={..._0x327941};_0x327941[_0x40a775(0xce)]&&(_0x4060d2[_0x40a775(0xce)]=await bcryptjs_1['default'][_0x40a775(0xfe)](_0x327941[_0x40a775(0xce)],0xc));_0x327941[_0x40a775(0x12f)]&&(_0x4060d2['name']=_0x327941['fullName'],delete _0x4060d2['fullName']);_0x327941[_0x40a775(0xcb)]&&(_0x4060d2[_0x40a775(0x113)]=_0x327941[_0x40a775(0xcb)],delete _0x4060d2[_0x40a775(0xcb)]);_0x327941[_0x40a775(0x102)]&&(_0x4060d2[_0x40a775(0xf5)]=_0x327941['merchantUrl'],delete _0x4060d2[_0x40a775(0x102)]);_0x327941['gateways']&&(_0x4060d2[_0x40a775(0x124)]=JSON['stringify'](_0x327941[_0x40a775(0xe9)]),delete _0x4060d2['gateways']);_0x327941[_0x40a775(0x169)]&&(_0x4060d2[_0x40a775(0x169)]=JSON[_0x40a775(0xe7)](_0x327941[_0x40a775(0x169)]),delete _0x4060d2[_0x40a775(0x169)]);_0x327941[_0x40a775(0x161)]&&(_0x327941[_0x40a775(0x161)][_0x40a775(0x114)]!==undefined&&(_0x4060d2[_0x40a775(0x114)]=_0x327941[_0x40a775(0x161)][_0x40a775(0x114)]||null),_0x327941[_0x40a775(0x161)][_0x40a775(0x18a)]!==undefined&&(_0x4060d2['usdtTrcWallet']=_0x327941[_0x40a775(0x161)][_0x40a775(0x18a)]||null),_0x327941[_0x40a775(0x161)]['usdtErcWallet']!==undefined&&(_0x4060d2[_0x40a775(0x10b)]=_0x327941['wallets'][_0x40a775(0x10b)]||null),_0x327941[_0x40a775(0x161)][_0x40a775(0x159)]!==undefined&&(_0x4060d2[_0x40a775(0x159)]=_0x327941['wallets'][_0x40a775(0x159)]||null),delete _0x4060d2['wallets']);const _0x4be65c=await database_1[_0x40a775(0xfc)][_0x40a775(0xdf)][_0x40a775(0xe1)]({'where':{'id':_0x4f1c08},'data':_0x4060d2,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4be65c['id'],'fullName':_0x4be65c[_0x40a775(0x16b)],'username':_0x4be65c[_0x40a775(0x104)],'telegramId':_0x4be65c[_0x40a775(0x113)],'merchantUrl':_0x4be65c[_0x40a775(0xf5)],'gateways':_0x4be65c[_0x40a775(0x124)]?JSON[_0x40a775(0xcc)](_0x4be65c[_0x40a775(0x124)]):null,'gatewaySettings':_0x4be65c[_0x40a775(0x169)]?JSON['parse'](_0x4be65c[_0x40a775(0x169)]):null,'publicKey':_0x4be65c[_0x40a775(0xed)],'wallets':{'usdtPolygonWallet':_0x4be65c['usdtPolygonWallet'],'usdtTrcWallet':_0x4be65c['usdtTrcWallet'],'usdtErcWallet':_0x4be65c[_0x40a775(0x10b)],'usdcPolygonWallet':_0x4be65c[_0x40a775(0x159)]},'status':_0x4be65c[_0x40a775(0xb9)],'createdAt':_0x4be65c[_0x40a775(0xc3)]};}async[a35_0x2c445d(0x173)](_0x364017){const _0x1fcbc6=a35_0x2c445d,_0x4a402a=await database_1[_0x1fcbc6(0xfc)]['shop']['update']({'where':{'id':_0x364017},'data':{'status':'SUSPENDED'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4a402a['id'],'fullName':_0x4a402a[_0x1fcbc6(0x16b)],'username':_0x4a402a[_0x1fcbc6(0x104)],'telegramId':_0x4a402a[_0x1fcbc6(0x113)],'merchantUrl':_0x4a402a['shopUrl'],'gateways':_0x4a402a[_0x1fcbc6(0x124)]?JSON[_0x1fcbc6(0xcc)](_0x4a402a['paymentGateways']):null,'gatewaySettings':_0x4a402a[_0x1fcbc6(0x169)]?JSON[_0x1fcbc6(0xcc)](_0x4a402a[_0x1fcbc6(0x169)]):null,'publicKey':_0x4a402a[_0x1fcbc6(0xed)],'wallets':{'usdtPolygonWallet':_0x4a402a[_0x1fcbc6(0x114)],'usdtTrcWallet':_0x4a402a[_0x1fcbc6(0x18a)],'usdtErcWallet':_0x4a402a[_0x1fcbc6(0x10b)],'usdcPolygonWallet':_0x4a402a[_0x1fcbc6(0x159)]},'status':_0x4a402a['status'],'createdAt':_0x4a402a[_0x1fcbc6(0xc3)]};}async[a35_0x2c445d(0x144)](_0x112959){const _0xd7e000=a35_0x2c445d,_0x56cdcb=await database_1[_0xd7e000(0xfc)]['shop']['update']({'where':{'id':_0x112959},'data':{'status':_0xd7e000(0x15b)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x56cdcb['id'],'fullName':_0x56cdcb[_0xd7e000(0x16b)],'username':_0x56cdcb[_0xd7e000(0x104)],'telegramId':_0x56cdcb[_0xd7e000(0x113)],'merchantUrl':_0x56cdcb[_0xd7e000(0xf5)],'gateways':_0x56cdcb['paymentGateways']?JSON[_0xd7e000(0xcc)](_0x56cdcb[_0xd7e000(0x124)]):null,'gatewaySettings':_0x56cdcb[_0xd7e000(0x169)]?JSON[_0xd7e000(0xcc)](_0x56cdcb[_0xd7e000(0x169)]):null,'publicKey':_0x56cdcb[_0xd7e000(0xed)],'wallets':{'usdtPolygonWallet':_0x56cdcb[_0xd7e000(0x114)],'usdtTrcWallet':_0x56cdcb[_0xd7e000(0x18a)],'usdtErcWallet':_0x56cdcb[_0xd7e000(0x10b)],'usdcPolygonWallet':_0x56cdcb['usdcPolygonWallet']},'status':_0x56cdcb[_0xd7e000(0xb9)],'createdAt':_0x56cdcb['createdAt']};}async[a35_0x2c445d(0xb3)](_0x2f7ec9){const _0x10a72a=a35_0x2c445d,{page:_0x5cef69,limit:_0x1d8e0d,status:_0x3777df}=_0x2f7ec9,_0x2064c7=(_0x5cef69-0x1)*_0x1d8e0d,_0x53182b={};_0x3777df&&(_0x53182b[_0x10a72a(0xb9)]=_0x3777df[_0x10a72a(0x115)]());const [_0x1c440f,_0x1b464a]=await Promise[_0x10a72a(0x188)]([database_1[_0x10a72a(0xfc)][_0x10a72a(0xdf)]['findMany']({'where':_0x53182b,'skip':_0x2064c7,'take':_0x1d8e0d,'orderBy':{'createdAt':_0x10a72a(0x11f)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x10a72a(0xfc)]['shop'][_0x10a72a(0xef)]({'where':_0x53182b})]);return{'users':_0x1c440f['map'](_0x23b717=>({'id':_0x23b717['id'],'fullName':_0x23b717[_0x10a72a(0x16b)],'username':_0x23b717['username'],'telegramId':_0x23b717[_0x10a72a(0x113)],'merchantUrl':_0x23b717['shopUrl'],'gateways':_0x23b717[_0x10a72a(0x124)]?JSON['parse'](_0x23b717[_0x10a72a(0x124)]):null,'gatewaySettings':_0x23b717[_0x10a72a(0x169)]?JSON[_0x10a72a(0xcc)](_0x23b717[_0x10a72a(0x169)]):null,'publicKey':_0x23b717[_0x10a72a(0xed)],'wallets':{'usdtPolygonWallet':_0x23b717[_0x10a72a(0x114)],'usdtTrcWallet':_0x23b717[_0x10a72a(0x18a)],'usdtErcWallet':_0x23b717[_0x10a72a(0x10b)],'usdcPolygonWallet':_0x23b717[_0x10a72a(0x159)]},'status':_0x23b717[_0x10a72a(0xb9)],'createdAt':_0x23b717[_0x10a72a(0xc3)]})),'pagination':{'page':_0x5cef69,'limit':_0x1d8e0d,'total':_0x1b464a,'totalPages':Math[_0x10a72a(0xd9)](_0x1b464a/_0x1d8e0d)}};}async[a35_0x2c445d(0xc6)](_0x22b6b4){const _0xeeaa5e=a35_0x2c445d,_0x1c96a1=await database_1['default'][_0xeeaa5e(0xdf)][_0xeeaa5e(0x183)]({'where':{'id':_0x22b6b4},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x1c96a1)return null;return{'id':_0x1c96a1['id'],'fullName':_0x1c96a1[_0xeeaa5e(0x16b)],'username':_0x1c96a1[_0xeeaa5e(0x104)],'telegramId':_0x1c96a1[_0xeeaa5e(0x113)],'merchantUrl':_0x1c96a1[_0xeeaa5e(0xf5)],'gateways':_0x1c96a1[_0xeeaa5e(0x124)]?JSON[_0xeeaa5e(0xcc)](_0x1c96a1[_0xeeaa5e(0x124)]):null,'gatewaySettings':_0x1c96a1[_0xeeaa5e(0x169)]?JSON[_0xeeaa5e(0xcc)](_0x1c96a1[_0xeeaa5e(0x169)]):null,'publicKey':_0x1c96a1[_0xeeaa5e(0xed)],'wallets':{'usdtPolygonWallet':_0x1c96a1[_0xeeaa5e(0x114)],'usdtTrcWallet':_0x1c96a1[_0xeeaa5e(0x18a)],'usdtErcWallet':_0x1c96a1[_0xeeaa5e(0x10b)],'usdcPolygonWallet':_0x1c96a1['usdcPolygonWallet']},'status':_0x1c96a1[_0xeeaa5e(0xb9)],'createdAt':_0x1c96a1[_0xeeaa5e(0xc3)]};}async[a35_0x2c445d(0x164)](_0x98fa4e){const _0x2d026d=a35_0x2c445d,{fullName:_0x1d766d,username:_0x3d5d3a,password:_0x32c157,telegramId:_0x18d933,merchantUrl:_0x2e693e,gateways:_0x4a85c4,gatewaySettings:_0x1c022f,wallets:_0x503c6c}=_0x98fa4e,_0x39daf6=await database_1[_0x2d026d(0xfc)][_0x2d026d(0xdf)][_0x2d026d(0x183)]({'where':{'username':_0x3d5d3a}});if(_0x39daf6)throw new Error(_0x2d026d(0xd7));if(_0x18d933){const _0x28d86c=await database_1[_0x2d026d(0xfc)][_0x2d026d(0xdf)][_0x2d026d(0x183)]({'where':{'telegram':_0x18d933}});if(_0x28d86c)throw new Error('Telegram\x20username\x20already\x20exists');}const _0x11388a=await bcryptjs_1[_0x2d026d(0xfc)][_0x2d026d(0xfe)](_0x32c157,0xc),_0x83f9a8=_0x2d026d(0x177)+crypto_1[_0x2d026d(0xfc)][_0x2d026d(0x145)](0x20)[_0x2d026d(0xd6)](_0x2d026d(0xaf)),_0x5d7386=_0x2d026d(0x10d)+crypto_1[_0x2d026d(0xfc)][_0x2d026d(0x145)](0x20)[_0x2d026d(0xd6)](_0x2d026d(0xaf)),_0x46510d=await database_1['default'][_0x2d026d(0xdf)][_0x2d026d(0x116)]({'data':{'name':_0x1d766d,'username':_0x3d5d3a,'password':_0x11388a,'telegram':_0x18d933,'shopUrl':_0x2e693e,'paymentGateways':_0x4a85c4?JSON[_0x2d026d(0xe7)](_0x4a85c4):null,'gatewaySettings':_0x1c022f?JSON[_0x2d026d(0xe7)](_0x1c022f):null,'usdtPolygonWallet':_0x503c6c?.[_0x2d026d(0x114)]||null,'usdtTrcWallet':_0x503c6c?.['usdtTrcWallet']||null,'usdtErcWallet':_0x503c6c?.[_0x2d026d(0x10b)]||null,'usdcPolygonWallet':_0x503c6c?.[_0x2d026d(0x159)]||null,'publicKey':_0x83f9a8,'secretKey':_0x5d7386,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x46510d['id'],'fullName':_0x46510d[_0x2d026d(0x16b)],'username':_0x46510d[_0x2d026d(0x104)],'telegramId':_0x46510d[_0x2d026d(0x113)],'merchantUrl':_0x46510d['shopUrl'],'gateways':_0x46510d[_0x2d026d(0x124)]?JSON['parse'](_0x46510d[_0x2d026d(0x124)]):null,'gatewaySettings':_0x46510d[_0x2d026d(0x169)]?JSON[_0x2d026d(0xcc)](_0x46510d[_0x2d026d(0x169)]):null,'publicKey':_0x46510d[_0x2d026d(0xed)],'wallets':{'usdtPolygonWallet':_0x46510d[_0x2d026d(0x114)],'usdtTrcWallet':_0x46510d['usdtTrcWallet'],'usdtErcWallet':_0x46510d['usdtErcWallet'],'usdcPolygonWallet':_0x46510d[_0x2d026d(0x159)]},'status':_0x46510d['status'],'createdAt':_0x46510d[_0x2d026d(0xc3)]};}async[a35_0x2c445d(0xf2)](_0x351d8b){const _0x2d08e9=a35_0x2c445d;await database_1['default'][_0x2d08e9(0xdf)]['delete']({'where':{'id':_0x351d8b}});}}exports[a35_0x2c445d(0x139)]=AdminService;