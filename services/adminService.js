'use strict';const a40_0x298144=a40_0x5c2a;(function(_0x992320,_0x142539){const _0x4b74c3=a40_0x5c2a,_0x177af0=_0x992320();while(!![]){try{const _0x369d19=-parseInt(_0x4b74c3(0x1f6))/0x1*(parseInt(_0x4b74c3(0x1cc))/0x2)+parseInt(_0x4b74c3(0x183))/0x3*(-parseInt(_0x4b74c3(0x1d5))/0x4)+-parseInt(_0x4b74c3(0x10b))/0x5+parseInt(_0x4b74c3(0x12d))/0x6*(parseInt(_0x4b74c3(0x194))/0x7)+parseInt(_0x4b74c3(0xed))/0x8*(parseInt(_0x4b74c3(0x18f))/0x9)+parseInt(_0x4b74c3(0x14a))/0xa+parseInt(_0x4b74c3(0x174))/0xb;if(_0x369d19===_0x142539)break;else _0x177af0['push'](_0x177af0['shift']());}catch(_0xfca8fc){_0x177af0['push'](_0x177af0['shift']());}}}(a40_0x333c,0x4c642));var __importDefault=this&&this[a40_0x298144(0x163)]||function(_0x5bb1aa){const _0xa14545=a40_0x298144;return _0x5bb1aa&&_0x5bb1aa[_0xa14545(0x116)]?_0x5bb1aa:{'default':_0x5bb1aa};};Object[a40_0x298144(0x16f)](exports,'__esModule',{'value':!![]}),exports[a40_0x298144(0x1e4)]=void 0x0;function a40_0x333c(){const _0x358cdf=['plisio','mastercard','\x20\x20\x20Payout\x20amount:\x20','stringify','aggregate','toISOString','usdcPolygonWallet','map','paidAt','asc','📊\x20Calculating\x20payout\x20statistics...','date','⚠️\x20CHARGEBACK\x20without\x20penalty\x20amount\x20-\x20no\x20balance\x20change','./currencyService','error','polygon','gateways','📊\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20','includes','amountAfterGatewayCommissionUSDT','usdtPolygonWallet','📊\x20Merchants\x20with\x20rounded\x20balance\x20!=\x200.00:\x20',':\x20commission\x20=\x20','\x20became\x20PAID:','\x20USDT\x20(already\x20paid\x20out)','bcryptjs',']\x20Gateway\x20settings\x20JSON\x20string:','password','255144oRfXQw','🎯\x20[','✅\x20Balance\x20check\x20passed\x20(with\x20tolerance)','Open\x20Banking\x202','gatewaySettings','getMerchantsAwaitingPayout','paymentGateways','\x20\x20\x20Merchant\x20gets:\x20','chargebackAmount','✅\x20Using\x20gateway\x20filter:\x20\x27','week','%\x20from\x20','\x27\x20to\x20name\x20\x27','cointopay2','currencyService','dailyPayments','updatedAt','%\x20commission)','totalAmountUSDT','customerCountry','values','findMany','not\x20set','usdcErcWallet','\x20\x20\x20Tolerance:\x20','totalPayments','klyme_gb','Payment\x20not\x20found','\x20\x20\x20Total\x20paid\x20out:\x20','COMPLETED','719970UJNKtj','getPayoutById','\x20\x20\x20Available\x20(number):\x20','length','ACTIVE','failureMessage','🔄\x20Converted\x20gateway\x20name\x20\x27','💰\x20Current\x20shop\x20balance:\x20','pendingUrl','all','\x20USDT\x20(-','__esModule','\x20USDT','KLYME\x20EU','lte','amountUSDT','customerEmail','erc20','commissionUSDT','amountAfterCommissionUSDT','../types/gateway','\x20\x20\x20💰\x20Total\x20payout:\x20','whiteUrl','availableBalance','📊\x20Gateway\x20filter\x20applied:','💰\x20Payment\x20','createdAt','\x20USDT\x20for\x20payment\x20','\x20\x20\x20Current\x20balance:\x20','trim','\x20for\x20shop\x20','\x20\x20\x20Final\x20payout\x20amount\x20used:\x20','\x20\x20\x20Requested\x20(number):\x20','\x20\x20\x20Added\x20to\x20balance:\x20+','66oyMOik','revenue','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','getMonth','merchantUrl','createUser','count',',\x20userId:\x20','filter','join','round','../config/database','🎯\x20updateUser\x20called\x20with\x20ID:\x20','commission','\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)','periodFrom','merchantEarningsUSDT',',\x20successful:\x20','cointopay','currency','\x20\x20\x20Transaction\x20hash:\x20','shopUrl','\x20\x20\x20💵\x20Available\x20balance:\x20','set','payment','CHARGEBACK','\x20\x20\x20�\x20Total\x20paid\x20out:\x20','status','478930lwXJGM','default','username','push','\x20USDT\x20(after\x20','split','payout','\x20\x20\x20Merchant\x20loses:\x20','period','ceil','\x20\x20\x20💸\x20Total\x20payouts\x20(all\x20time):\x20','📊\x20Calculated\x20commission\x20rate\x20for\x20payment\x20','\x20active\x20merchants\x20for\x20selection','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','📅\x20Period:\x20','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','📊\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','reduce','PENDING','noda','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','turnover','activateUser','getSystemStatistics','2020-01-01','__importDefault','💰\x20Found\x20','randomBytes','0000','averageCommissionRate','📊\x20Merchant\x20statistics\x20calculated:','\x20\x20\x20🔍\x20Calculated\x20after\x20commission:\x20','publicKey','turnoverUSDT','\x20\x20\x20Difference:\x20',']\x20Gateway\x20settings\x20before\x20saving:','⚠️\x20Gateway\x20\x27','defineProperty','dateFrom','amount','toString','💰\x20[PAYOUT]\x20Merchant\x20','3929860qePbFv','admin','90d','shop','test_gateway','parse','toUpperCase','yesterday','getTime','\x20USDT,\x20merchant:\x20','balance','log','Noda','🔄\x20Gateway\x20mapping\x20(get):','\x20\x20\x20✅\x20Actual\x20available\x20balance:\x20','88395dLUOCB','klyme_eu','\x20merchants','localeCompare','PAID','getPaymentById','getAllPayments','orderId','Plisio','📊\x20Total\x20payments\x20(including\x20failed):\x20','$transaction','warn','171UnOXeS','hex','toFixed','📊\x20Using\x20saved\x20values\x20for\x20payment\x20','📋\x20Found\x20','93191nAyqTU','\x20in\x20','setDate','🔄\x20Gateway\x20mapping:','usdtErcWallet','30d','create','toLowerCase','💳\x20Payout\x20wallet\x20for\x20','\x20payments)','🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','findFirst','telegram','\x20status:\x20','pk_','REFUND','_count','insensitive','\x20\x20\x20⏳\x20Pending\x20payout:\x20','📊\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','klyme_de','gatewayEarnings','✅\x20Payout\x20created:\x20','adminNotes','getFullYear','getMerchantsSelection','convertToUSDT','wallets','notes','totalPaidOut','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','getUserById','totalCommissionRate','\x20USDT\x20(rounded\x20to\x202\x20decimal\x20places)','network','rapyd','\x20PAID\x20payments','groupBy','shopId','update','dailyRevenue','getAllUsers','setHours','📊\x20Available\x20gateways\x20in\x20database:','some','gte','averageCheckUSDT','name','getGatewayInternalName','💰\x20Shop\x20','sort','\x20\x20\x20🤔\x20Difference:\x20','customerUa','💰\x20Creating\x20payout\x20for\x20shop\x20','\x20->\x20','KLYME\x20DE','753112kBSbDx','\x20USDT\x20(current\x20balance\x20in\x20DB)','totalPayout','merchantEarnings','gatewayOrderId','txid','successUrl',',\x20Commission:\x20','dateTo','44PzdbUv','📊\x20Payout\x20statistics\x20calculated:','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','gateway','externalPaymentUrl','_sum',']\x20Updating\x20password\x20for\x20user\x20','desc','getGatewayNameById','generateDailyStatistics','random','usdtTrcWallet','\x20\x20\x20�\x20Total\x20payments\x20turnover:\x20','not\x20specified','\x20merchants\x20with\x20rounded\x20balance\x20!=\x200.00\x20(excluding\x20balances\x20that\x20round\x20to\x200.00)','AdminService','🔄\x20Converted\x20gateway\x20ID\x20\x27','📊\x20Final\x20WHERE\x20conditions:','failUrl','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','Rapyd','📊\x20Getting\x20payments\x20with\x20filters:','getPayoutStats','getMerchantStatistics','customerName','📊\x20Sorting\x20payments\x20by\x20','slice','totalAmountAfterCommissionUSDT','periodTo','\x20USDT\x20(total\x20paid\x20to\x20merchants)','hash','💰\x20Payment\x20amount\x20is\x20NOT\x20deducted\x20(chargeback\x20penalty\x20only)','1wKXRgf','telegramId','trc20','💸\x20CHARGEBACK\x20penalty\x20ONLY:\x20-','🔄\x20Gateway\x20mapping\x20(create):','custom','sk_',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','findUnique','⚠️\x20Requested\x20gateway\x20\x27','getGatewayDisplayName','\x20\x20\x20�📊\x20Total\x20payments:\x20','Shop\x20not\x20found','entries','\x27\x20(from\x20\x27','\x20\x20\x20💰\x20Total\x20payments\x20turnover:\x20','\x20USDT\x20(gross\x20revenue)','fullName','\x20order','gatewayCommissionRate','🔍\x20Using\x20gateway\x20\x27','\x20\x20\x20🖥️\x20User\x20Agent:\x20','month','🔐\x20[','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','pendingPayout','paymentsCount','statusChangedAt','delete','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','💰\x20[PAYOUT]\x20Gateway\x20','⚠️\x20Payment\x20','\x20USDT,\x20Difference:\x20','\x20balance\x20updated:','thisMonth',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','customerIp','\x20balance\x20updated:\x20','\x20\x20\x20📅\x20This\x20month:\x20','substr','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','forEach','\x20\x20\x20Balance:\x20','\x20\x20\x20💰\x20Total\x20turnover:\x20','getDate','\x27\x20->\x20ID\x20\x27','\x20USDT,\x20Requested:\x20','\x20\x20\x20Gateway:\x20','\x20\x20\x20💳\x20Total\x20payments:\x20','\x20USDT\x20from\x20balance'];a40_0x333c=function(){return _0x358cdf;};return a40_0x333c();}const database_1=__importDefault(require(a40_0x298144(0x139))),bcryptjs_1=__importDefault(require(a40_0x298144(0xea))),crypto_1=__importDefault(require('crypto')),currencyService_1=require(a40_0x298144(0xde)),gateway_1=require(a40_0x298144(0x11f));function a40_0x5c2a(_0x17c87b,_0x2a6394){const _0x333c64=a40_0x333c();return a40_0x5c2a=function(_0x5c2a8b,_0x15ec27){_0x5c2a8b=_0x5c2a8b-0xcc;let _0x3439aa=_0x333c64[_0x5c2a8b];return _0x3439aa;},a40_0x5c2a(_0x17c87b,_0x2a6394);}class AdminService{async[a40_0x298144(0x1ec)](){const _0x4c8062=a40_0x298144;console[_0x4c8062(0x17f)](_0x4c8062(0xdb));const _0x41fe47=await database_1[_0x4c8062(0x14b)][_0x4c8062(0x177)][_0x4c8062(0xd5)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':'ACTIVE'}}),_0x4a7ee4=await database_1[_0x4c8062(0x14b)][_0x4c8062(0x146)][_0x4c8062(0x134)]({'where':{'status':'PAID','gateway':{'not':_0x4c8062(0x178)}}}),_0x2fcdc6=new Date(),_0x233fbb=new Date(_0x2fcdc6[_0x4c8062(0x1ac)](),_0x2fcdc6[_0x4c8062(0x131)](),0x1),_0x473a51=new Date(_0x2fcdc6[_0x4c8062(0x1ac)](),_0x2fcdc6[_0x4c8062(0x131)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x13e13b=await database_1[_0x4c8062(0x14b)]['payout'][_0x4c8062(0xd5)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x233fbb,'lte':_0x473a51},'status':'COMPLETED'}}),_0x3e44f9=_0x41fe47[_0x4c8062(0x1da)]['totalPaidOut']||0x0,_0x3bc76d=_0x41fe47[_0x4c8062(0x1da)][_0x4c8062(0x17e)]||0x0,_0x154424=_0x13e13b[_0x4c8062(0x1da)][_0x4c8062(0x171)]||0x0,_0x50bd08={'totalPayout':Math[_0x4c8062(0x138)](_0x3e44f9*0x64)/0x64,'awaitingPayout':Math[_0x4c8062(0x138)](_0x3bc76d*0x64)/0x64,'thisMonth':Math['round'](_0x154424*0x64)/0x64,'availableBalance':Math[_0x4c8062(0x138)](_0x3bc76d*0x64)/0x64,'totalPayments':_0x4a7ee4};return console[_0x4c8062(0x17f)](_0x4c8062(0x1d6)),console['log'](_0x4c8062(0x120)+_0x50bd08['totalPayout']+_0x4c8062(0x1f3)),console[_0x4c8062(0x17f)](_0x4c8062(0x130)+_0x50bd08['awaitingPayout']+_0x4c8062(0x13c)),console[_0x4c8062(0x17f)](_0x4c8062(0x144)+_0x50bd08[_0x4c8062(0x122)]+'\x20USDT\x20(same\x20as\x20awaiting)'),console['log'](_0x4c8062(0x21c)+_0x50bd08['thisMonth']+'\x20USDT'),console[_0x4c8062(0x17f)](_0x4c8062(0xcf)+_0x50bd08[_0x4c8062(0x106)]+_0x4c8062(0x1b8)),_0x50bd08;}async['updateCustomerData'](_0x412b0d,_0x30534a){const _0x17b642=a40_0x298144;console['log'](_0x17b642(0x21e)+_0x412b0d+':',_0x30534a);const _0x50e252=await database_1[_0x17b642(0x14b)][_0x17b642(0x146)][_0x17b642(0x1fe)]({'where':{'id':_0x412b0d},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x50e252)throw new Error(_0x17b642(0x108));const _0x2b775d={};_0x30534a[_0x17b642(0x100)]!==undefined&&(_0x2b775d[_0x17b642(0x100)]=_0x30534a['customerCountry']||null);_0x30534a[_0x17b642(0x21a)]!==undefined&&(_0x2b775d[_0x17b642(0x21a)]=_0x30534a[_0x17b642(0x21a)]||null);_0x30534a[_0x17b642(0x1c8)]!==undefined&&(_0x2b775d[_0x17b642(0x1c8)]=_0x30534a[_0x17b642(0x1c8)]||null);const _0x5f1a05=await database_1[_0x17b642(0x14b)]['payment']['update']({'where':{'id':_0x412b0d},'data':{..._0x2b775d,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console['log'](_0x17b642(0x157)+_0x412b0d),console['log']('\x20\x20\x20🌍\x20Country:\x20'+_0x50e252[_0x17b642(0x100)]+_0x17b642(0x1ca)+_0x5f1a05['customerCountry']),console[_0x17b642(0x17f)]('\x20\x20\x20🌐\x20IP:\x20'+_0x50e252[_0x17b642(0x21a)]+_0x17b642(0x1ca)+_0x5f1a05['customerIp']),console[_0x17b642(0x17f)](_0x17b642(0x20b)+(_0x50e252[_0x17b642(0x1c8)]?'set':_0x17b642(0x103))+_0x17b642(0x1ca)+(_0x5f1a05[_0x17b642(0x1c8)]?_0x17b642(0x145):'not\x20set')),_0x5f1a05;}async[a40_0x298144(0x161)](_0x3f3d96){const _0x30e287=a40_0x298144,_0x267b90=new Date();let _0x8fd8c0;switch(_0x3f3d96[_0x30e287(0x19b)]()){case'day':_0x8fd8c0=new Date(_0x267b90['getFullYear'](),_0x267b90['getMonth'](),_0x267b90[_0x30e287(0x222)](),0x0,0x0,0x0,0x0);break;case'yesterday':const _0x52e28b=new Date(_0x267b90);_0x52e28b[_0x30e287(0x196)](_0x52e28b[_0x30e287(0x222)]()-0x1),_0x8fd8c0=new Date(_0x52e28b[_0x30e287(0x1ac)](),_0x52e28b[_0x30e287(0x131)](),_0x52e28b[_0x30e287(0x222)](),0x0,0x0,0x0,0x0);break;case'7d':_0x8fd8c0=new Date(_0x267b90['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x30e287(0x199):_0x8fd8c0=new Date(_0x267b90[_0x30e287(0x17c)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x30e287(0x176):_0x8fd8c0=new Date(_0x267b90['getTime']()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x30e287(0x114):const _0x23ed81=await database_1[_0x30e287(0x14b)][_0x30e287(0x146)][_0x30e287(0x19f)]({'where':{'gateway':{'not':'test_gateway'}},'orderBy':{'createdAt':_0x30e287(0xda)},'select':{'createdAt':!![]}});_0x8fd8c0=_0x23ed81?_0x23ed81[_0x30e287(0x125)]:new Date(_0x30e287(0x162));break;default:_0x8fd8c0=new Date(_0x267b90['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}_0x8fd8c0[_0x30e287(0x1be)](0x0,0x0,0x0,0x0);let _0x404868;if(_0x3f3d96['toLowerCase']()===_0x30e287(0x17b)){const _0x13c6df=new Date(_0x267b90);_0x13c6df[_0x30e287(0x196)](_0x13c6df[_0x30e287(0x222)]()-0x1),_0x404868=new Date(_0x13c6df['getFullYear'](),_0x13c6df['getMonth'](),_0x13c6df[_0x30e287(0x222)](),0x17,0x3b,0x3b,0x3e7);}const _0x4c24c3={'gte':_0x8fd8c0};_0x404868&&(_0x4c24c3['lte']=_0x404868);const [_0x2de9cf,_0x347b7b,_0x19a8bc,_0x23d329,_0x43c2d4,_0x300a66]=await Promise['all']([database_1[_0x30e287(0x14b)]['shop'][_0x30e287(0x134)](),database_1['default'][_0x30e287(0x177)]['count']({'where':{'status':'ACTIVE'}}),database_1[_0x30e287(0x14b)][_0x30e287(0x146)]['count']({'where':{'status':'PAID','createdAt':_0x4c24c3,'gateway':{'not':'test_gateway'}}}),database_1['default'][_0x30e287(0x146)][_0x30e287(0x102)]({'where':{'status':_0x30e287(0x187),'createdAt':_0x4c24c3,'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x30e287(0x14b)]['payment'][_0x30e287(0x102)]({'where':{'gateway':{'not':_0x30e287(0x178)}},'take':0xa,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x30e287(0x14b)][_0x30e287(0x146)][_0x30e287(0x102)]({'where':{'createdAt':_0x4c24c3,'gateway':{'not':_0x30e287(0x178)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x4fdee7=0x0,_0x2cac27=0x0;for(const _0x104ffe of _0x23d329){const _0xf29373=await currencyService_1['currencyService'][_0x30e287(0x1ae)](_0x104ffe['amount'],_0x104ffe[_0x30e287(0x141)]);_0x4fdee7+=_0xf29373;if(_0x104ffe[_0x30e287(0xe4)]){const _0x1b978c=await currencyService_1['currencyService']['convertToUSDT'](_0x104ffe[_0x30e287(0x171)],_0x104ffe['currency']),_0x28c534=_0x104ffe[_0x30e287(0xe4)],_0x3910b7=_0x1b978c-_0x28c534;_0x2cac27+=_0x3910b7;}}const _0x94cc22=_0x19a8bc>0x0?_0x4fdee7/_0x19a8bc:0x0,_0x4d8772=this[_0x30e287(0x1de)](_0x300a66,_0x8fd8c0,_0x404868||_0x267b90),_0x157c6e=await database_1[_0x30e287(0x14b)][_0x30e287(0x146)][_0x30e287(0x134)]({'where':{'createdAt':_0x4c24c3,'gateway':{'not':'test_gateway'}}}),_0x2e2b43=_0x157c6e>0x0?_0x19a8bc/_0x157c6e*0x64:0x0;return{'totalShops':_0x2de9cf,'activeShops':_0x347b7b,'totalPayments':_0x19a8bc,'successfulPayments':_0x19a8bc,'totalAttempts':_0x157c6e,'totalRevenue':Math[_0x30e287(0x138)](_0x4fdee7*0x64)/0x64,'trapayEarnings':Math[_0x30e287(0x138)](_0x2cac27*0x64)/0x64,'averagePaymentAmount':Math[_0x30e287(0x138)](_0x94cc22*0x64)/0x64,'conversionRate':Math[_0x30e287(0x138)](_0x2e2b43*0x64)/0x64,'dailyRevenue':_0x4d8772[_0x30e287(0x1bc)],'dailyPayments':_0x4d8772[_0x30e287(0xfc)],'recentPayments':_0x43c2d4['map'](_0x2c9be1=>({'id':_0x2c9be1['id'],'amount':_0x2c9be1['amount'],'currency':_0x2c9be1[_0x30e287(0x141)],'status':_0x2c9be1['status'],'gateway':_0x2c9be1['gateway'],'shop':_0x2c9be1[_0x30e287(0x177)],'createdAt':_0x2c9be1[_0x30e287(0x125)]}))};}async[a40_0x298144(0x1ed)](_0x1b95ac){const _0x53f474=a40_0x298144;console['log']('📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:',_0x1b95ac);let _0x2f8051,_0x254624=new Date();if(_0x1b95ac[_0x53f474(0x152)]===_0x53f474(0x1fb)&&_0x1b95ac[_0x53f474(0x170)]&&_0x1b95ac[_0x53f474(0x1d4)])_0x2f8051=new Date(_0x1b95ac[_0x53f474(0x170)]),_0x254624=new Date(_0x1b95ac['dateTo']),_0x2f8051[_0x53f474(0x1be)](0x0,0x0,0x0,0x0),_0x254624['setHours'](0x17,0x3b,0x3b,0x3e7);else{const _0x3039ec=new Date();switch(_0x1b95ac[_0x53f474(0x152)]){case _0x53f474(0xf7):_0x2f8051=new Date(_0x3039ec[_0x53f474(0x17c)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x53f474(0x20c):_0x2f8051=new Date(_0x3039ec[_0x53f474(0x17c)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'year':_0x2f8051=new Date(_0x3039ec['getTime']()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x53f474(0x114):default:_0x2f8051=new Date(_0x53f474(0x162));break;}_0x2f8051[_0x53f474(0x1be)](0x0,0x0,0x0,0x0),_0x254624[_0x53f474(0x1be)](0x17,0x3b,0x3b,0x3e7);}console[_0x53f474(0x17f)](_0x53f474(0x158)+_0x2f8051[_0x53f474(0xd6)]()+'\x20to\x20'+_0x254624['toISOString']());const _0x428c47={'status':_0x53f474(0x187),'gateway':{'not':_0x53f474(0x178)},'paidAt':{'gte':_0x2f8051,'lte':_0x254624}};_0x1b95ac[_0x53f474(0x1ba)]&&(_0x428c47[_0x53f474(0x1ba)]=_0x1b95ac[_0x53f474(0x1ba)]);const _0x38bdd9=await database_1[_0x53f474(0x14b)][_0x53f474(0x146)]['findMany']({'where':_0x428c47,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x53f474(0x17f)](_0x53f474(0x164)+_0x38bdd9[_0x53f474(0x10e)]+'\x20paid\x20payments\x20for\x20analysis');const _0x45a5e9={'gateway':{'not':_0x53f474(0x178)},'createdAt':{'gte':_0x2f8051,'lte':_0x254624}};_0x1b95ac[_0x53f474(0x1ba)]&&(_0x45a5e9[_0x53f474(0x1ba)]=_0x1b95ac[_0x53f474(0x1ba)]);const _0x497087=await database_1[_0x53f474(0x14b)]['payment'][_0x53f474(0x134)]({'where':_0x45a5e9});console[_0x53f474(0x17f)](_0x53f474(0x18c)+_0x497087+_0x53f474(0x13f)+_0x38bdd9[_0x53f474(0x10e)]);let _0x30dfe1=0x0,_0x5b46fc=0x0,_0x259def=0x0;const _0x1e4369={},_0x1875bd={},_0x1fd24d={};for(const _0x171944 of _0x38bdd9){try{const _0x52f287=_0x171944[_0x53f474(0x11a)]||0x0;if(_0x52f287<=0x0){console[_0x53f474(0x18e)]('⚠️\x20Payment\x20'+_0x171944['id']+'\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...');continue;}let _0x3579d8,_0x8a50db;if(_0x171944['amountAfterGatewayCommissionUSDT']!==null&&_0x171944['amountAfterGatewayCommissionUSDT']!==undefined)_0x3579d8=_0x171944[_0x53f474(0xe4)],_0x8a50db=_0x52f287-_0x3579d8,console[_0x53f474(0x17f)](_0x53f474(0x192)+_0x171944['id']+':\x20'+_0x52f287[_0x53f474(0x191)](0x6)+_0x53f474(0x17d)+_0x3579d8[_0x53f474(0x191)](0x6)+_0x53f474(0x117));else{let _0x56c946={};if(_0x171944[_0x53f474(0x177)][_0x53f474(0xf1)])try{_0x56c946=JSON[_0x53f474(0x179)](_0x171944[_0x53f474(0x177)]['gatewaySettings']);}catch(_0x383659){console['error']('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x171944[_0x53f474(0x1ba)]+':',_0x383659);}let _0x493324=0x2d;for(const [_0xbaf6b,_0x510900]of Object[_0x53f474(0x203)](_0x56c946)){if(_0xbaf6b[_0x53f474(0x19b)]()===_0x171944[_0x53f474(0x1d8)][_0x53f474(0x19b)]()){_0x493324=_0x510900[_0x53f474(0x13b)]||0x2d;break;}}_0x8a50db=_0x52f287*(_0x493324/0x64),_0x3579d8=_0x52f287-_0x8a50db,console['log'](_0x53f474(0x1a7)+_0x171944['id']+':\x20'+_0x493324+_0x53f474(0xf8)+_0x52f287[_0x53f474(0x191)](0x6)+_0x53f474(0x117));}_0x30dfe1+=_0x52f287,_0x5b46fc+=_0x3579d8,_0x259def+=_0x8a50db;let _0x4528f8;_0x171944['gatewayCommissionRate']!==null&&_0x171944[_0x53f474(0x209)]!==undefined?(_0x4528f8=_0x171944[_0x53f474(0x209)],console[_0x53f474(0x17f)](_0x53f474(0xe2)+_0x171944['id']+':\x20'+_0x4528f8+'%')):(_0x4528f8=_0x52f287>0x0?_0x8a50db/_0x52f287*0x64:0x0,console[_0x53f474(0x17f)](_0x53f474(0x155)+_0x171944['id']+':\x20'+_0x4528f8[_0x53f474(0x191)](0x2)+'%'));!_0x1e4369[_0x171944[_0x53f474(0x1d8)]]&&(_0x1e4369[_0x171944[_0x53f474(0x1d8)]]={'gateway':_0x171944[_0x53f474(0x1d8)],'gatewayDisplayName':this[_0x53f474(0x200)](_0x171944[_0x53f474(0x1d8)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x1e4369[_0x171944[_0x53f474(0x1d8)]][_0x53f474(0x210)]++,_0x1e4369[_0x171944[_0x53f474(0x1d8)]][_0x53f474(0x16b)]+=_0x52f287,_0x1e4369[_0x171944[_0x53f474(0x1d8)]][_0x53f474(0x11d)]+=_0x8a50db,_0x1e4369[_0x171944[_0x53f474(0x1d8)]][_0x53f474(0x13e)]+=_0x3579d8,_0x1e4369[_0x171944['gateway']][_0x53f474(0x1b4)]+=_0x4528f8;!_0x1b95ac[_0x53f474(0x1ba)]&&(!_0x1875bd[_0x171944[_0x53f474(0x1ba)]]&&(_0x1875bd[_0x171944['shopId']]={'shopId':_0x171944[_0x53f474(0x1ba)],'shopName':_0x171944[_0x53f474(0x177)]['name'],'shopUsername':_0x171944['shop'][_0x53f474(0x14c)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x1875bd[_0x171944['shopId']][_0x53f474(0x210)]++,_0x1875bd[_0x171944[_0x53f474(0x1ba)]][_0x53f474(0x16b)]+=_0x52f287,_0x1875bd[_0x171944[_0x53f474(0x1ba)]][_0x53f474(0x11d)]+=_0x8a50db,_0x1875bd[_0x171944[_0x53f474(0x1ba)]][_0x53f474(0x13e)]+=_0x3579d8);const _0x2534d3=_0x171944['paidAt']['toISOString']()[_0x53f474(0x14f)]('T')[0x0];!_0x1fd24d[_0x2534d3]&&(_0x1fd24d[_0x2534d3]={'date':_0x2534d3,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x1fd24d[_0x2534d3][_0x53f474(0x15f)]+=_0x52f287,_0x1fd24d[_0x2534d3][_0x53f474(0x1cf)]+=_0x3579d8,_0x1fd24d[_0x2534d3]['gatewayEarnings']+=_0x8a50db,_0x1fd24d[_0x2534d3]['paymentsCount']++;}catch(_0x474097){console['error']('Error\x20processing\x20payment\x20'+_0x171944['id']+':',_0x474097);}}Object[_0x53f474(0x101)](_0x1e4369)[_0x53f474(0x21f)](_0x461f43=>{const _0x36f7f6=_0x53f474;_0x461f43['averageCommissionRate']=_0x461f43[_0x36f7f6(0x210)]>0x0?_0x461f43['totalCommissionRate']/_0x461f43[_0x36f7f6(0x210)]:0x0,delete _0x461f43[_0x36f7f6(0x1b4)];}),Object[_0x53f474(0x101)](_0x1875bd)[_0x53f474(0x21f)](_0xdd82fd=>{const _0x4a0e86=_0x53f474;_0xdd82fd['averageCheckUSDT']=_0xdd82fd[_0x4a0e86(0x210)]>0x0?_0xdd82fd[_0x4a0e86(0x16b)]/_0xdd82fd[_0x4a0e86(0x210)]:0x0;});let _0x39514a=0x0,_0x1a993e=0x0;if(_0x1b95ac[_0x53f474(0x1ba)]){const _0x4ffa27=await database_1['default'][_0x53f474(0x150)]['findMany']({'where':{'shopId':_0x1b95ac[_0x53f474(0x1ba)],'status':_0x53f474(0x10a),'createdAt':{'gte':_0x2f8051,'lte':_0x254624}},'select':{'amount':!![]}});_0x39514a=_0x4ffa27[_0x53f474(0x15b)]((_0x1d7457,_0x478920)=>_0x1d7457+_0x478920['amount'],0x0);const _0x2bbc3a=await database_1['default'][_0x53f474(0x150)]['findMany']({'where':{'shopId':_0x1b95ac[_0x53f474(0x1ba)],'status':_0x53f474(0x15c),'createdAt':{'gte':_0x2f8051,'lte':_0x254624}},'select':{'amount':!![]}});_0x1a993e=_0x2bbc3a[_0x53f474(0x15b)]((_0xecd489,_0xf5e8b9)=>_0xecd489+_0xf5e8b9[_0x53f474(0x171)],0x0);}const _0x59e431=_0x497087,_0x541dce=_0x38bdd9[_0x53f474(0x10e)],_0x579191=_0x541dce>0x0?_0x30dfe1/_0x541dce:0x0,_0x1e3fb6=_0x59e431>0x0?Math[_0x53f474(0x138)](_0x541dce/_0x59e431*0x2710)/0x64:0x0,_0x3394fe=Math['ceil']((_0x254624[_0x53f474(0x17c)]()-_0x2f8051[_0x53f474(0x17c)]())/(0x3e8*0x3c*0x3c*0x18)),_0x3d58eb={'totalTurnover':Math[_0x53f474(0x138)](_0x30dfe1*0x64)/0x64,'merchantEarnings':Math[_0x53f474(0x138)](_0x5b46fc*0x64)/0x64,'gatewayEarnings':Math['round'](_0x259def*0x64)/0x64,'totalPaidOut':Math[_0x53f474(0x138)](_0x39514a*0x64)/0x64,'pendingPayout':Math['round'](_0x1a993e*0x64)/0x64,'averageCheck':Math[_0x53f474(0x138)](_0x579191*0x64)/0x64,'totalPayments':_0x59e431,'successfulPayments':_0x541dce,'conversionRate':_0x1e3fb6,'gatewayBreakdown':Object[_0x53f474(0x101)](_0x1e4369)[_0x53f474(0xd8)](_0x578d3f=>({..._0x578d3f,'turnoverUSDT':Math[_0x53f474(0x138)](_0x578d3f[_0x53f474(0x16b)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x578d3f[_0x53f474(0x11d)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x53f474(0x138)](_0x578d3f[_0x53f474(0x13e)]*0x64)/0x64,'averageCommissionRate':Math[_0x53f474(0x138)](_0x578d3f[_0x53f474(0x167)]*0x64)/0x64})),'merchantBreakdown':_0x1b95ac[_0x53f474(0x1ba)]?undefined:Object[_0x53f474(0x101)](_0x1875bd)[_0x53f474(0xd8)](_0x3b55b7=>({..._0x3b55b7,'turnoverUSDT':Math[_0x53f474(0x138)](_0x3b55b7[_0x53f474(0x16b)]*0x64)/0x64,'commissionUSDT':Math[_0x53f474(0x138)](_0x3b55b7[_0x53f474(0x11d)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x53f474(0x138)](_0x3b55b7['merchantEarningsUSDT']*0x64)/0x64,'paidOutUSDT':Math['round'](_0x3b55b7['paidOutUSDT']*0x64)/0x64,'averageCheckUSDT':Math[_0x53f474(0x138)](_0x3b55b7[_0x53f474(0x1c2)]*0x64)/0x64})),'dailyData':Object['values'](_0x1fd24d)[_0x53f474(0xd8)](_0x4b9636=>({..._0x4b9636,'turnover':Math[_0x53f474(0x138)](_0x4b9636[_0x53f474(0x15f)]*0x64)/0x64,'merchantEarnings':Math[_0x53f474(0x138)](_0x4b9636[_0x53f474(0x1cf)]*0x64)/0x64,'gatewayEarnings':Math['round'](_0x4b9636[_0x53f474(0x1a9)]*0x64)/0x64}))[_0x53f474(0x1c6)]((_0x4be176,_0x2b005a)=>_0x4be176[_0x53f474(0xdc)][_0x53f474(0x186)](_0x2b005a[_0x53f474(0xdc)])),'periodInfo':{'from':_0x2f8051,'to':_0x254624,'periodType':_0x1b95ac['period']||_0x53f474(0x1fb),'daysCount':_0x3394fe}};return console[_0x53f474(0x17f)](_0x53f474(0x168)),console[_0x53f474(0x17f)](_0x53f474(0x221)+_0x3d58eb['totalTurnover']+'\x20USDT'),console[_0x53f474(0x17f)](_0x53f474(0x159)+_0x3d58eb[_0x53f474(0x1cf)]+_0x53f474(0x117)),console[_0x53f474(0x17f)](_0x53f474(0x1e9)+_0x3d58eb[_0x53f474(0x1a9)]+'\x20USDT'),console[_0x53f474(0x17f)](_0x53f474(0x148)+_0x3d58eb[_0x53f474(0x1b1)]+_0x53f474(0x117)),console[_0x53f474(0x17f)](_0x53f474(0x1a6)+_0x3d58eb[_0x53f474(0x20f)]+_0x53f474(0x117)),console[_0x53f474(0x17f)](_0x53f474(0x201)+_0x3d58eb['totalPayments']),_0x3d58eb;}async[a40_0x298144(0x1ad)](){const _0x21dd2a=a40_0x298144;console[_0x21dd2a(0x17f)]('📋\x20Getting\x20merchants\x20selection\x20list...');const _0x5b3c5a=await database_1[_0x21dd2a(0x14b)][_0x21dd2a(0x177)]['findMany']({'where':{'status':_0x21dd2a(0x10f)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x21dd2a(0xda)}});return console['log'](_0x21dd2a(0x193)+_0x5b3c5a[_0x21dd2a(0x10e)]+_0x21dd2a(0x156)),_0x5b3c5a[_0x21dd2a(0xd8)](_0x278000=>({'id':_0x278000['id'],'username':_0x278000[_0x21dd2a(0x14c)],'name':_0x278000['name']}));}['getGatewayDisplayName'](_0xa01df1){const _0x1c1cd6=a40_0x298144,_0x4c0a3e={'test_gateway':'Test\x20Gateway','plisio':_0x1c1cd6(0x18b),'rapyd':_0x1c1cd6(0x1ea),'noda':_0x1c1cd6(0x180),'cointopay':'CoinToPay','cointopay2':_0x1c1cd6(0xf0),'klyme_eu':_0x1c1cd6(0x118),'klyme_gb':'KLYME\x20GB','klyme_de':_0x1c1cd6(0x1cb),'mastercard':'MasterCard'};return _0x4c0a3e[_0xa01df1]||_0xa01df1;}['getGatewayInternalName'](_0x25cc90){const _0xd0bf87=a40_0x298144,_0x76cc76={'Test\x20Gateway':_0xd0bf87(0x178),'Plisio':_0xd0bf87(0xd1),'Rapyd':_0xd0bf87(0x1b7),'Noda':_0xd0bf87(0x15d),'CoinToPay':_0xd0bf87(0x140),'CoinToPay2':_0xd0bf87(0xfa),'KLYME\x20EU':_0xd0bf87(0x184),'KLYME\x20GB':_0xd0bf87(0x107),'KLYME\x20DE':_0xd0bf87(0x1a8),'MasterCard':_0xd0bf87(0xd2)};return _0x76cc76[_0x25cc90]||_0x25cc90[_0xd0bf87(0x19b)]();}async[a40_0x298144(0xf2)](_0x56c3a9){const _0x312f83=a40_0x298144,{page:_0x20754d,limit:_0x3d88d5,minAmount:_0x5bd160,search:_0x3eb611}=_0x56c3a9;console[_0x312f83(0x17f)](_0x312f83(0x15e),_0x56c3a9);let _0x5bb669={'status':'ACTIVE'};_0x3eb611&&(_0x5bb669[_0x312f83(0x1c3)]={'contains':_0x3eb611,'mode':_0x312f83(0x1a5)});const _0x48742e=await database_1['default'][_0x312f83(0x177)][_0x312f83(0x102)]({'where':_0x5bb669,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),_0x10ca27=_0x48742e[_0x312f83(0x136)](_0x11dea8=>{const _0x3678a4=_0x312f83,_0x19a72f=Math[_0x3678a4(0x138)](_0x11dea8[_0x3678a4(0x17e)]*0x64)/0x64;if(_0x5bd160&&_0x19a72f<_0x5bd160)return![];return _0x19a72f!==0x0;});_0x10ca27['sort']((_0x19e323,_0x34c94f)=>_0x34c94f[_0x312f83(0x17e)]-_0x19e323['balance']);const _0x225b8c=_0x10ca27['length'],_0x12b6af=(_0x20754d-0x1)*_0x3d88d5,_0x1278bd=_0x10ca27[_0x312f83(0x1f0)](_0x12b6af,_0x12b6af+_0x3d88d5);console[_0x312f83(0x17f)]('💰\x20Found\x20'+_0x1278bd['length']+_0x312f83(0x1e3));const _0x3cb7e7=await Promise[_0x312f83(0x114)](_0x1278bd['map'](async _0x125a9c=>{const _0x45ba38=_0x312f83,[_0x4aae93,_0x1b6471,_0x13609a]=await Promise['all']([database_1['default'][_0x45ba38(0x146)][_0x45ba38(0x134)]({'where':{'shopId':_0x125a9c['id'],'status':_0x45ba38(0x187),'gateway':{'not':'test_gateway'}}}),database_1[_0x45ba38(0x14b)][_0x45ba38(0x146)][_0x45ba38(0x19f)]({'where':{'shopId':_0x125a9c['id'],'status':_0x45ba38(0x187),'gateway':{'not':_0x45ba38(0x178)}},'orderBy':{'paidAt':_0x45ba38(0xda)},'select':{'paidAt':!![]}}),database_1[_0x45ba38(0x14b)][_0x45ba38(0x146)][_0x45ba38(0x1b9)]({'by':['gateway'],'where':{'shopId':_0x125a9c['id'],'status':_0x45ba38(0x187),'gateway':{'not':_0x45ba38(0x178)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x64f19d=new Date(),_0x41e824=new Date(_0x64f19d[_0x45ba38(0x1ac)](),_0x64f19d[_0x45ba38(0x131)](),0x1),_0x865d42=new Date(_0x64f19d['getFullYear'](),_0x64f19d[_0x45ba38(0x131)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x61b46e,_0x66cedf]=await Promise['all']([database_1['default']['payout']['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x125a9c['id'],'status':'COMPLETED'}}),database_1['default'][_0x45ba38(0x150)][_0x45ba38(0xd5)]({'_sum':{'amount':!![]},'where':{'shopId':_0x125a9c['id'],'status':_0x45ba38(0x10a),'createdAt':{'gte':_0x41e824,'lte':_0x865d42}}})]),_0xb3d80a=_0x61b46e[_0x45ba38(0x1da)]['amount']||0x0,_0x528ee4=_0x66cedf[_0x45ba38(0x1da)][_0x45ba38(0x171)]||0x0,_0x124fc8=await Promise['all'](_0x13609a[_0x45ba38(0xd8)](async _0x2cd181=>{const _0x5402bb=_0x45ba38;let _0x3ae8b2=0x2d;if(_0x125a9c[_0x5402bb(0xf1)])try{const _0x5450e1=JSON[_0x5402bb(0x179)](_0x125a9c[_0x5402bb(0xf1)]);for(const [_0x34a5d1,_0x4c563b]of Object[_0x5402bb(0x203)](_0x5450e1)){if(_0x34a5d1[_0x5402bb(0x19b)]()===_0x2cd181['gateway']['toLowerCase']()){_0x3ae8b2=_0x4c563b[_0x5402bb(0x13b)]||0xa,console[_0x5402bb(0x17f)](_0x5402bb(0x214)+_0x2cd181[_0x5402bb(0x1d8)]+'\x20for\x20shop\x20'+_0x125a9c['id']+_0x5402bb(0xe7)+_0x3ae8b2+'%');break;}}}catch(_0x5d1dd9){console[_0x5402bb(0xdf)](_0x5402bb(0x213)+_0x125a9c['id']+':',_0x5d1dd9);}const _0x2dde90=_0x2cd181[_0x5402bb(0x1da)]?.['amountUSDT']||0x0,_0x552ba1=_0x2dde90*(0x1-_0x3ae8b2/0x64);return{'gateway':_0x2cd181['gateway'],'count':_0x2cd181[_0x5402bb(0x1a4)]?.['id']||0x0,'amountUSDT':Math[_0x5402bb(0x138)](_0x2dde90*0x64)/0x64,'amountAfterCommissionUSDT':Math['round'](_0x552ba1*0x64)/0x64,'commission':_0x3ae8b2};})),_0x5a2b74=_0x124fc8[_0x45ba38(0x15b)]((_0x32d855,_0x14adcd)=>_0x32d855+_0x14adcd[_0x45ba38(0x11a)],0x0),_0x3b75e0=_0x124fc8[_0x45ba38(0x15b)]((_0x106333,_0x4d2cf3)=>_0x106333+_0x4d2cf3[_0x45ba38(0x11e)],0x0),_0x157ab5=_0x125a9c[_0x45ba38(0x17e)];return console[_0x45ba38(0x17f)](_0x45ba38(0x173)+_0x125a9c[_0x45ba38(0x14c)]+':'),console[_0x45ba38(0x17f)](_0x45ba38(0x1e1)+_0x5a2b74[_0x45ba38(0x191)](0x2)+_0x45ba38(0x206)),console[_0x45ba38(0x17f)](_0x45ba38(0x169)+_0x3b75e0['toFixed'](0x2)+'\x20USDT\x20(theoretical\x20net)'),console[_0x45ba38(0x17f)](_0x45ba38(0x182)+_0x157ab5['toFixed'](0x2)+_0x45ba38(0x1cd)),console[_0x45ba38(0x17f)]('\x20\x20\x20💸\x20Total\x20payouts:\x20'+_0xb3d80a[_0x45ba38(0x191)](0x2)+_0x45ba38(0xe9)),console[_0x45ba38(0x17f)](_0x45ba38(0x1c7)+(_0x3b75e0-_0xb3d80a-_0x157ab5)['toFixed'](0x2)+'\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)'),{'id':_0x125a9c['id'],'fullName':_0x125a9c['name'],'username':_0x125a9c[_0x45ba38(0x14c)],'telegramId':_0x125a9c['telegram'],'merchantUrl':_0x125a9c[_0x45ba38(0x143)],'wallets':{'usdtPolygonWallet':_0x125a9c[_0x45ba38(0xe5)],'usdtTrcWallet':_0x125a9c[_0x45ba38(0x1e0)],'usdtErcWallet':_0x125a9c[_0x45ba38(0x198)],'usdcPolygonWallet':_0x125a9c[_0x45ba38(0xd7)],'usdcErcWallet':_0x125a9c[_0x45ba38(0x104)]},'totalAmountUSDT':Math[_0x45ba38(0x138)](_0x5a2b74*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x45ba38(0x138)](_0x3b75e0*0x64)/0x64,'currentBalance':Math['round'](_0x157ab5*0x64)/0x64,'totalPayout':Math[_0x45ba38(0x138)](_0xb3d80a*0x64)/0x64,'thisMonth':Math[_0x45ba38(0x138)](_0x528ee4*0x64)/0x64,'paymentsCount':_0x4aae93,'oldestPaymentDate':_0x1b6471?.[_0x45ba38(0xd9)]||_0x125a9c[_0x45ba38(0x125)],'gatewayBreakdown':_0x124fc8};})),_0x40d53b=_0x3cb7e7[_0x312f83(0x15b)]((_0x3a6ae5,_0x285df1)=>_0x3a6ae5+_0x285df1[_0x312f83(0xff)],0x0),_0x5eb383=_0x3cb7e7[_0x312f83(0x15b)]((_0x3b3188,_0x14adb4)=>_0x3b3188+_0x14adb4[_0x312f83(0x1f1)],0x0),_0x267ed9=_0x3cb7e7[_0x312f83(0x15b)]((_0x50b862,_0x220a0e)=>_0x50b862+_0x220a0e[_0x312f83(0x1ce)],0x0),_0x967eed=_0x3cb7e7['reduce']((_0x2c57e3,_0x1a13c1)=>_0x2c57e3+_0x1a13c1[_0x312f83(0x218)],0x0);return console['log'](_0x312f83(0xe6)+_0x225b8c+_0x312f83(0x185)),console[_0x312f83(0x17f)](_0x312f83(0x205)+Math['round'](_0x40d53b*0x64)/0x64+'\x20USDT\x20(gross\x20revenue)'),console[_0x312f83(0x17f)]('\x20\x20\x20✅\x20Total\x20net\x20balances:\x20'+Math[_0x312f83(0x138)](_0x5eb383*0x64)/0x64+_0x312f83(0x1b5)),console[_0x312f83(0x17f)](_0x312f83(0x154)+Math[_0x312f83(0x138)](_0x267ed9*0x64)/0x64+_0x312f83(0x117)),console[_0x312f83(0x17f)]('\x20\x20\x20📅\x20Total\x20payouts\x20(this\x20month):\x20'+Math[_0x312f83(0x138)](_0x967eed*0x64)/0x64+_0x312f83(0x117)),{'merchants':_0x3cb7e7,'pagination':{'page':_0x20754d,'limit':_0x3d88d5,'total':_0x225b8c,'totalPages':Math['ceil'](_0x225b8c/_0x3d88d5)},'summary':{'totalMerchants':_0x225b8c,'totalAmountUSDT':Math[_0x312f83(0x138)](_0x40d53b*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x5eb383*0x64)/0x64,'totalPayout':Math[_0x312f83(0x138)](_0x267ed9*0x64)/0x64,'thisMonth':Math[_0x312f83(0x138)](_0x967eed*0x64)/0x64}};}async['createPayout'](_0x458df8){const _0x335fdf=a40_0x298144,{shopId:_0x2ba0de,amount:_0x265095,network:_0x458a76,wallet:_0x5264da,notes:_0x543c3f,txid:_0x32ed18,periodFrom:_0x3eec97,periodTo:_0xb65783}=_0x458df8,_0x2b554d=await database_1[_0x335fdf(0x14b)][_0x335fdf(0x18d)](async _0x5c9f2d=>{const _0x22ba0d=_0x335fdf,_0x3bcb16=await _0x5c9f2d[_0x22ba0d(0x177)][_0x22ba0d(0x1fe)]({'where':{'id':_0x2ba0de},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x3bcb16)throw new Error(_0x22ba0d(0x202));console['log'](_0x22ba0d(0x1c9)+_0x3bcb16[_0x22ba0d(0x14c)]+':'),console[_0x22ba0d(0x17f)](_0x22ba0d(0x127)+_0x3bcb16['balance'][_0x22ba0d(0x191)](0x6)+_0x22ba0d(0x117)),console[_0x22ba0d(0x17f)](_0x22ba0d(0xd3)+_0x265095[_0x22ba0d(0x191)](0x6)+'\x20USDT'),console[_0x22ba0d(0x17f)]('\x20\x20\x20Current\x20total\x20paid\x20out:\x20'+_0x3bcb16[_0x22ba0d(0x1b1)][_0x22ba0d(0x191)](0x6)+_0x22ba0d(0x117));if(_0x32ed18)console[_0x22ba0d(0x17f)](_0x22ba0d(0x142)+_0x32ed18);const _0x2b6098=0.000001,_0x1f31c8=Number(_0x3bcb16[_0x22ba0d(0x17e)]),_0x557e63=Number(_0x265095);console[_0x22ba0d(0x17f)]('🔍\x20Balance\x20check\x20details:'),console['log']('\x20\x20\x20Available\x20(raw):\x20'+_0x3bcb16[_0x22ba0d(0x17e)]),console[_0x22ba0d(0x17f)](_0x22ba0d(0x10d)+_0x1f31c8),console[_0x22ba0d(0x17f)](_0x22ba0d(0x12b)+_0x557e63),console['log'](_0x22ba0d(0x16c)+(_0x1f31c8-_0x557e63)),console[_0x22ba0d(0x17f)](_0x22ba0d(0x105)+_0x2b6098);if(_0x1f31c8<_0x557e63-_0x2b6098)throw new Error('Insufficient\x20balance.\x20Available:\x20'+_0x1f31c8['toFixed'](0x6)+_0x22ba0d(0xcd)+_0x557e63[_0x22ba0d(0x191)](0x6)+_0x22ba0d(0x216)+(_0x1f31c8-_0x557e63)['toFixed'](0x8)+_0x22ba0d(0x117));console['log'](_0x22ba0d(0xef));const _0x97c7ed=Math['min'](_0x1f31c8,_0x557e63);let _0x265c5c=_0x5264da;if(!_0x265c5c){const _0x3bd2ae=await _0x5c9f2d['shop'][_0x22ba0d(0x1fe)]({'where':{'id':_0x2ba0de},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});if(_0x3bd2ae)switch(_0x458a76){case _0x22ba0d(0xe0):_0x265c5c=_0x3bd2ae[_0x22ba0d(0xe5)]||undefined;break;case _0x22ba0d(0x1f8):_0x265c5c=_0x3bd2ae[_0x22ba0d(0x1e0)]||undefined;break;case _0x22ba0d(0x11c):_0x265c5c=_0x3bd2ae['usdtErcWallet']||undefined;break;case'polygon_usdc':_0x265c5c=_0x3bd2ae['usdcPolygonWallet']||undefined;break;case'erc20_usdc':_0x265c5c=_0x3bd2ae[_0x22ba0d(0x104)]||undefined;break;}}console[_0x22ba0d(0x17f)](_0x22ba0d(0x19c)+_0x458a76+':\x20'+(_0x265c5c||_0x22ba0d(0x1e2)));const _0x364c2a=await _0x5c9f2d['payout'][_0x22ba0d(0x19a)]({'data':{'shopId':_0x2ba0de,'amount':_0x97c7ed,'network':_0x458a76,'status':_0x22ba0d(0x10a),'txid':_0x32ed18,'notes':_0x543c3f,'periodFrom':_0x3eec97?new Date(_0x3eec97):null,'periodTo':_0xb65783?new Date(_0xb65783):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x13db02=_0x1f31c8-_0x97c7ed,_0x27fde2=Number(_0x3bcb16['totalPaidOut'])+_0x97c7ed;return await _0x5c9f2d[_0x22ba0d(0x177)][_0x22ba0d(0x1bb)]({'where':{'id':_0x2ba0de},'data':{'balance':_0x13db02,'totalPaidOut':_0x27fde2}}),console[_0x22ba0d(0x17f)](_0x22ba0d(0x1c5)+_0x3bcb16[_0x22ba0d(0x14c)]+_0x22ba0d(0x217)),console[_0x22ba0d(0x17f)](_0x22ba0d(0x220)+_0x1f31c8[_0x22ba0d(0x191)](0x6)+_0x22ba0d(0x1ca)+_0x13db02[_0x22ba0d(0x191)](0x6)+_0x22ba0d(0x115)+_0x97c7ed[_0x22ba0d(0x191)](0x6)+')'),console[_0x22ba0d(0x17f)](_0x22ba0d(0x109)+_0x3bcb16[_0x22ba0d(0x1b1)][_0x22ba0d(0x191)](0x6)+_0x22ba0d(0x1ca)+_0x27fde2[_0x22ba0d(0x191)](0x6)+'\x20USDT\x20(+'+_0x97c7ed[_0x22ba0d(0x191)](0x6)+')'),console['log'](_0x22ba0d(0x12a)+_0x97c7ed[_0x22ba0d(0x191)](0x6)+'\x20USDT'),{'payout':_0x364c2a,'shop':_0x3bcb16};});return console['log'](_0x335fdf(0x1aa)+_0x2b554d['payout']['id']+_0x335fdf(0x129)+_0x2b554d[_0x335fdf(0x177)][_0x335fdf(0x14c)]+'\x20('+_0x2b554d[_0x335fdf(0x150)][_0x335fdf(0x171)][_0x335fdf(0x191)](0x6)+'\x20USDT)'),{'id':_0x2b554d[_0x335fdf(0x150)]['id'],'shopId':_0x2b554d[_0x335fdf(0x150)][_0x335fdf(0x1ba)],'shopName':_0x2b554d[_0x335fdf(0x177)]['name'],'shopUsername':_0x2b554d[_0x335fdf(0x177)][_0x335fdf(0x14c)],'amount':_0x2b554d[_0x335fdf(0x150)]['amount'],'network':_0x2b554d['payout']['network'],'status':_0x2b554d[_0x335fdf(0x150)][_0x335fdf(0x149)],'txid':_0x2b554d[_0x335fdf(0x150)]['txid'],'notes':_0x2b554d[_0x335fdf(0x150)][_0x335fdf(0x1b0)],'periodFrom':_0x2b554d[_0x335fdf(0x150)]['periodFrom'],'periodTo':_0x2b554d['payout'][_0x335fdf(0x1f2)],'createdAt':_0x2b554d[_0x335fdf(0x150)][_0x335fdf(0x125)],'paidAt':_0x2b554d['payout'][_0x335fdf(0xd9)]};}async['getAllPayouts'](_0x483b2b){const _0x252e23=a40_0x298144,{page:_0x23cf09,limit:_0x2b2ef6,shopId:_0x21af52,network:_0x3d6f81,dateFrom:_0x15124b,dateTo:_0x4c8d2e,search:_0x5b3f25}=_0x483b2b,_0x3b6f0c=(_0x23cf09-0x1)*_0x2b2ef6,_0x532cdb={};_0x21af52&&(_0x532cdb[_0x252e23(0x1ba)]=_0x21af52);_0x3d6f81&&(_0x532cdb[_0x252e23(0x1b6)]=_0x3d6f81);(_0x15124b||_0x4c8d2e)&&(_0x532cdb[_0x252e23(0x125)]={},_0x15124b&&(_0x532cdb[_0x252e23(0x125)]['gte']=new Date(_0x15124b)),_0x4c8d2e&&(_0x532cdb[_0x252e23(0x125)][_0x252e23(0x119)]=new Date(_0x4c8d2e)));_0x5b3f25&&(_0x532cdb['OR']=[{'shop':{'name':{'contains':_0x5b3f25,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x5b3f25,'mode':'insensitive'}}},{'notes':{'contains':_0x5b3f25,'mode':_0x252e23(0x1a5)}}]);const [_0x102e5b,_0x17889f]=await Promise['all']([database_1[_0x252e23(0x14b)][_0x252e23(0x150)][_0x252e23(0x102)]({'where':_0x532cdb,'skip':_0x3b6f0c,'take':_0x2b2ef6,'orderBy':{'createdAt':_0x252e23(0x1dc)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'wallet':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x252e23(0x14b)][_0x252e23(0x150)][_0x252e23(0x134)]({'where':_0x532cdb})]);return{'payouts':_0x102e5b[_0x252e23(0xd8)](_0x5bd10c=>({'id':_0x5bd10c['id'],'shopId':_0x5bd10c[_0x252e23(0x1ba)],'shopName':_0x5bd10c[_0x252e23(0x177)][_0x252e23(0x1c3)],'shopUsername':_0x5bd10c['shop']['username'],'amount':_0x5bd10c[_0x252e23(0x171)],'network':_0x5bd10c['network'],'wallet':_0x5bd10c['wallet'],'status':_0x5bd10c[_0x252e23(0x149)],'txid':_0x5bd10c[_0x252e23(0x1d1)],'notes':_0x5bd10c['notes'],'periodFrom':_0x5bd10c[_0x252e23(0x13d)],'periodTo':_0x5bd10c[_0x252e23(0x1f2)],'createdAt':_0x5bd10c[_0x252e23(0x125)],'paidAt':_0x5bd10c['paidAt']})),'pagination':{'page':_0x23cf09,'limit':_0x2b2ef6,'total':_0x17889f,'totalPages':Math[_0x252e23(0x153)](_0x17889f/_0x2b2ef6)}};}async[a40_0x298144(0x10c)](_0x3ed893){const _0x4e9e19=a40_0x298144,_0x369de4=await database_1[_0x4e9e19(0x14b)]['payout']['findUnique']({'where':{'id':_0x3ed893},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x369de4)return null;return{'id':_0x369de4['id'],'shopId':_0x369de4['shopId'],'shopName':_0x369de4['shop'][_0x4e9e19(0x1c3)],'shopUsername':_0x369de4[_0x4e9e19(0x177)][_0x4e9e19(0x14c)],'amount':_0x369de4[_0x4e9e19(0x171)],'network':_0x369de4[_0x4e9e19(0x1b6)],'status':_0x369de4[_0x4e9e19(0x149)],'txid':_0x369de4[_0x4e9e19(0x1d1)],'notes':_0x369de4[_0x4e9e19(0x1b0)],'periodFrom':_0x369de4[_0x4e9e19(0x13d)],'periodTo':_0x369de4[_0x4e9e19(0x1f2)],'createdAt':_0x369de4['createdAt'],'paidAt':_0x369de4[_0x4e9e19(0xd9)]};}async['deletePayout'](_0x1f125f){const _0x257a32=a40_0x298144;await database_1[_0x257a32(0x14b)][_0x257a32(0x150)][_0x257a32(0x212)]({'where':{'id':_0x1f125f}});}async[a40_0x298144(0x189)](_0x402df7){const _0x54d03a=a40_0x298144,{page:_0x31052a,limit:_0x1295bc,status:_0x5f2202,gateway:_0xb815cd,shopId:_0x4efda0,dateFrom:_0x173ffe,dateTo:_0x24fc35,search:_0x8ccff0,currency:_0x2f8645,sortBy:_0x22e009,sortOrder:_0x1bd654}=_0x402df7,_0x29ca7e=(_0x31052a-0x1)*_0x1295bc;console[_0x54d03a(0x17f)](_0x54d03a(0x1eb),_0x402df7);const _0x326585=await database_1['default'][_0x54d03a(0x146)]['groupBy']({'by':['gateway'],'_count':{'gateway':!![]}});console[_0x54d03a(0x17f)](_0x54d03a(0x1bf),_0x326585['map'](_0x2372cc=>_0x2372cc[_0x54d03a(0x1d8)]+'\x20('+_0x2372cc[_0x54d03a(0x1a4)]['gateway']+_0x54d03a(0x19d)));if(_0xb815cd){const _0x11c247=_0x326585[_0x54d03a(0x1c0)](_0x20cc77=>_0x20cc77[_0x54d03a(0x1d8)][_0x54d03a(0x19b)]()===_0xb815cd[_0x54d03a(0x19b)]());!_0x11c247&&_0xb815cd['toLowerCase']()!=='test_gateway'&&console[_0x54d03a(0x17f)](_0x54d03a(0x1ff)+_0xb815cd+'\x27\x20not\x20found.\x20Available\x20gateways:\x20'+_0x326585[_0x54d03a(0xd8)](_0x48db73=>_0x48db73[_0x54d03a(0x1d8)])[_0x54d03a(0x137)](',\x20'));}const _0x417f4d={};_0x5f2202&&(_0x417f4d[_0x54d03a(0x149)]=_0x5f2202[_0x54d03a(0x17a)]());if(!_0xb815cd)_0x417f4d[_0x54d03a(0x1d8)]={'not':'test_gateway'};else{if(_0xb815cd&&(_0xb815cd[_0x54d03a(0x19b)]()===_0x54d03a(0x178)||_0xb815cd===_0x54d03a(0x166)))_0x417f4d[_0x54d03a(0x1d8)]='test_gateway';else{let _0x51f21e=_0xb815cd;const _0x5f380b=(0x0,gateway_1['getGatewayNameById'])(_0xb815cd);if(_0x5f380b)_0x51f21e=_0x5f380b,console['log'](_0x54d03a(0x1e5)+_0xb815cd+_0x54d03a(0xf9)+_0x51f21e+'\x27');else{const _0x4a9059=(0x0,gateway_1['getGatewayIdByName'])(_0xb815cd);if(_0x4a9059){const _0x18b35b=(0x0,gateway_1[_0x54d03a(0x1dd)])(_0x4a9059);_0x18b35b&&(_0x51f21e=_0x18b35b,console[_0x54d03a(0x17f)](_0x54d03a(0x111)+_0xb815cd+_0x54d03a(0xcc)+_0x4a9059+'\x27\x20->\x20name\x20\x27'+_0x51f21e+'\x27'));}else console[_0x54d03a(0x17f)](_0x54d03a(0x20a)+_0xb815cd+_0x54d03a(0x1e8));}const _0x1a28d2=await database_1['default'][_0x54d03a(0x146)][_0x54d03a(0x134)]({'where':{'gateway':_0x51f21e[_0x54d03a(0x19b)]()},'take':0x1});_0x1a28d2===0x0?(console['log'](_0x54d03a(0x16e)+_0x51f21e+'\x27\x20(from\x20\x27'+_0xb815cd+_0x54d03a(0x12f)),_0x417f4d[_0x54d03a(0x1d8)]='NONEXISTENT_GATEWAY_FILTER'):(_0x417f4d[_0x54d03a(0x1d8)]=_0x51f21e[_0x54d03a(0x19b)](),console[_0x54d03a(0x17f)](_0x54d03a(0xf6)+_0x51f21e+_0x54d03a(0x204)+_0xb815cd+'\x27)'));}}console['log'](_0x54d03a(0x123),_0x417f4d['gateway']);_0x4efda0&&(_0x417f4d[_0x54d03a(0x1ba)]=_0x4efda0);_0x2f8645&&(_0x417f4d[_0x54d03a(0x141)]=_0x2f8645[_0x54d03a(0x17a)](),console[_0x54d03a(0x17f)]('💱\x20Currency\x20filter\x20applied:\x20'+_0x2f8645[_0x54d03a(0x17a)]()));(_0x173ffe||_0x24fc35)&&(_0x417f4d[_0x54d03a(0x125)]={},_0x173ffe&&(_0x417f4d[_0x54d03a(0x125)][_0x54d03a(0x1c1)]=new Date(_0x173ffe)),_0x24fc35&&(_0x417f4d[_0x54d03a(0x125)]['lte']=new Date(_0x24fc35)));_0x8ccff0&&(_0x417f4d['OR']=[{'id':{'contains':_0x8ccff0,'mode':_0x54d03a(0x1a5)}},{'orderId':{'contains':_0x8ccff0,'mode':_0x54d03a(0x1a5)}},{'gatewayOrderId':{'contains':_0x8ccff0,'mode':'insensitive'}},{'customerEmail':{'contains':_0x8ccff0,'mode':'insensitive'}},{'shop':{'name':{'contains':_0x8ccff0,'mode':_0x54d03a(0x1a5)}}},{'shop':{'username':{'contains':_0x8ccff0,'mode':_0x54d03a(0x1a5)}}}]);console[_0x54d03a(0x17f)](_0x54d03a(0x1e6),JSON['stringify'](_0x417f4d,null,0x2));let _0x5b2b51={'createdAt':'desc'};if(_0x22e009){const _0xba5f4c=[_0x54d03a(0x171),_0x54d03a(0x125),'updatedAt',_0x54d03a(0x149),_0x54d03a(0x1d8),'currency'],_0x13bb7c=[_0x54d03a(0xda),_0x54d03a(0x1dc)];if(_0xba5f4c['includes'](_0x22e009)){const _0x28bd27=_0x13bb7c[_0x54d03a(0xe3)](_0x1bd654)?_0x1bd654:_0x54d03a(0x1dc);_0x5b2b51={[_0x22e009]:_0x28bd27},console[_0x54d03a(0x17f)](_0x54d03a(0x1ef)+_0x22e009+_0x54d03a(0x195)+_0x28bd27+_0x54d03a(0x208));}}const [_0x55b5c0,_0x25ebc3]=await Promise[_0x54d03a(0x114)]([database_1[_0x54d03a(0x14b)][_0x54d03a(0x146)][_0x54d03a(0x102)]({'where':_0x417f4d,'skip':_0x29ca7e,'take':_0x1295bc,'orderBy':_0x5b2b51,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x54d03a(0x14b)]['payment'][_0x54d03a(0x134)]({'where':_0x417f4d})]);return{'payments':_0x55b5c0,'pagination':{'page':_0x31052a,'limit':_0x1295bc,'total':_0x25ebc3,'totalPages':Math[_0x54d03a(0x153)](_0x25ebc3/_0x1295bc)}};}async[a40_0x298144(0x188)](_0x56dd9c){const _0x2d1a4c=a40_0x298144,_0x46c0b7=await database_1['default']['payment'][_0x2d1a4c(0x1fe)]({'where':{'id':_0x56dd9c},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x46c0b7)return null;return{'id':_0x46c0b7['id'],'shopId':_0x46c0b7[_0x2d1a4c(0x1ba)],'gateway':_0x46c0b7[_0x2d1a4c(0x1d8)],'amount':_0x46c0b7[_0x2d1a4c(0x171)],'currency':_0x46c0b7[_0x2d1a4c(0x141)],'status':_0x46c0b7['status'],'orderId':_0x46c0b7[_0x2d1a4c(0x18a)],'gatewayOrderId':_0x46c0b7[_0x2d1a4c(0x1d0)],'customerEmail':_0x46c0b7[_0x2d1a4c(0x11b)],'customerName':_0x46c0b7[_0x2d1a4c(0x1ee)],'customerCountry':_0x46c0b7[_0x2d1a4c(0x100)],'customerIp':_0x46c0b7[_0x2d1a4c(0x21a)],'customerUa':_0x46c0b7[_0x2d1a4c(0x1c8)],'failureMessage':_0x46c0b7['failureMessage'],'externalPaymentUrl':_0x46c0b7[_0x2d1a4c(0x1d9)],'successUrl':_0x46c0b7[_0x2d1a4c(0x1d2)],'failUrl':_0x46c0b7[_0x2d1a4c(0x1e7)],'pendingUrl':_0x46c0b7[_0x2d1a4c(0x113)],'whiteUrl':_0x46c0b7[_0x2d1a4c(0x121)],'createdAt':_0x46c0b7[_0x2d1a4c(0x125)],'updatedAt':_0x46c0b7[_0x2d1a4c(0xfd)],'shop':_0x46c0b7[_0x2d1a4c(0x177)]};}async['updatePaymentStatus'](_0x32f441,_0x284a9d,_0x1ffb1c,_0x5c60eb){const _0x54797e=a40_0x298144,_0x52d672=await database_1[_0x54797e(0x14b)]['$transaction'](async _0x440208=>{const _0x16b181=_0x54797e,_0x14e3ba=await _0x440208[_0x16b181(0x146)]['findUnique']({'where':{'id':_0x32f441},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x14e3ba)throw new Error('Payment\x20not\x20found');const _0x236967=_0x14e3ba['status'],_0x34f5c7=_0x284a9d[_0x16b181(0x17a)]();console['log']('🔄\x20Admin\x20updating\x20payment\x20'+_0x32f441+_0x16b181(0x1a1)+_0x236967+_0x16b181(0x1ca)+_0x34f5c7),console[_0x16b181(0x17f)](_0x16b181(0x112)+_0x14e3ba[_0x16b181(0x177)][_0x16b181(0x17e)]+_0x16b181(0x117));const _0x4c167a={'status':_0x34f5c7,'updatedAt':new Date(),'statusChangedBy':_0x16b181(0x175),'statusChangedAt':new Date()};_0x1ffb1c&&(_0x4c167a[_0x16b181(0x1ab)]=_0x1ffb1c);_0x34f5c7===_0x16b181(0x147)&&_0x5c60eb&&(_0x4c167a[_0x16b181(0xf5)]=_0x5c60eb);let _0x2734ac=0x0,_0x271258=_0x14e3ba[_0x16b181(0x177)]['balance'];if(_0x34f5c7==='PAID'&&_0x236967!=='PAID'){_0x4c167a[_0x16b181(0xd9)]=new Date();const _0x18304b=await currencyService_1[_0x16b181(0xfb)][_0x16b181(0x1ae)](_0x14e3ba['amount'],_0x14e3ba[_0x16b181(0x141)]);_0x4c167a[_0x16b181(0x11a)]=_0x18304b;let _0x21856e=0x2d;const _0x4e0798=await _0x440208[_0x16b181(0x177)][_0x16b181(0x1fe)]({'where':{'id':_0x14e3ba[_0x16b181(0x1ba)]},'select':{'gatewaySettings':!![]}});if(_0x4e0798?.[_0x16b181(0xf1)])try{const _0x4ba29f=JSON[_0x16b181(0x179)](_0x4e0798['gatewaySettings']);for(const [_0xb3c288,_0x45cbc8]of Object[_0x16b181(0x203)](_0x4ba29f)){if(_0xb3c288[_0x16b181(0x19b)]()===_0x14e3ba[_0x16b181(0x1d8)]['toLowerCase']()){_0x21856e=_0x45cbc8[_0x16b181(0x13b)]||0xa;break;}}}catch(_0x518148){console[_0x16b181(0xdf)]('Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20'+_0x32f441+':',_0x518148);}let _0xabaec4;_0x14e3ba[_0x16b181(0xe4)]!==null&&_0x14e3ba[_0x16b181(0xe4)]!==undefined?(_0xabaec4=_0x14e3ba[_0x16b181(0xe4)],console[_0x16b181(0x17f)]('📊\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20'+_0xabaec4[_0x16b181(0x191)](0x6)+_0x16b181(0x126)+_0x32f441)):(_0xabaec4=_0x18304b*(0x1-_0x21856e/0x64),console['log'](_0x16b181(0x15a)+_0x32f441+':\x20'+_0x21856e+'%\x20from\x20'+_0x18304b['toFixed'](0x6)+_0x16b181(0x117)),_0x4c167a[_0x16b181(0xe4)]=_0xabaec4,_0x4c167a[_0x16b181(0x209)]=_0x21856e),_0x2734ac=_0xabaec4,_0x271258+=_0xabaec4,console[_0x16b181(0x17f)](_0x16b181(0x124)+_0x32f441+_0x16b181(0xe8)),console[_0x16b181(0x17f)]('\x20\x20\x20Full\x20amount:\x20'+_0x18304b['toFixed'](0x6)+_0x16b181(0x117)),console[_0x16b181(0x17f)](_0x16b181(0xce)+_0x14e3ba[_0x16b181(0x1d8)]+_0x16b181(0x1d3)+_0x21856e+'%'),console[_0x16b181(0x17f)](_0x16b181(0xf4)+_0xabaec4[_0x16b181(0x191)](0x6)+_0x16b181(0x14e)+_0x21856e+_0x16b181(0xfe)),console[_0x16b181(0x17f)](_0x16b181(0x12c)+_0xabaec4[_0x16b181(0x191)](0x6)+_0x16b181(0x117));}else{if(_0x236967===_0x16b181(0x187)&&_0x34f5c7!==_0x16b181(0x187)&&_0x34f5c7!==_0x16b181(0x147)){if(_0x14e3ba[_0x16b181(0x11a)]){let _0x146a7d=0x2d;const _0x66295=await _0x440208[_0x16b181(0x177)][_0x16b181(0x1fe)]({'where':{'id':_0x14e3ba[_0x16b181(0x1ba)]},'select':{'gatewaySettings':!![]}});if(_0x66295?.[_0x16b181(0xf1)])try{const _0x49afb1=JSON[_0x16b181(0x179)](_0x66295[_0x16b181(0xf1)]);for(const [_0x385aee,_0x219623]of Object[_0x16b181(0x203)](_0x49afb1)){if(_0x385aee[_0x16b181(0x19b)]()===_0x14e3ba[_0x16b181(0x1d8)][_0x16b181(0x19b)]()){_0x146a7d=_0x219623[_0x16b181(0x13b)]||0xa;break;}}}catch(_0x437cc6){console[_0x16b181(0xdf)](_0x16b181(0x1d7)+_0x32f441+':',_0x437cc6);}const _0x2cbfee=_0x14e3ba[_0x16b181(0x11a)]*(0x1-_0x146a7d/0x64);_0x2734ac=-_0x2cbfee,_0x271258-=_0x2cbfee,console[_0x16b181(0x17f)]('\x20\x20\x20Full\x20amount:\x20'+_0x14e3ba['amountUSDT'][_0x16b181(0x191)](0x6)+_0x16b181(0x117)),console[_0x16b181(0x17f)](_0x16b181(0xce)+_0x14e3ba[_0x16b181(0x1d8)]+_0x16b181(0x1d3)+_0x146a7d+'%'),console[_0x16b181(0x17f)](_0x16b181(0x151)+_0x2cbfee['toFixed'](0x6)+_0x16b181(0x14e)+_0x146a7d+'%\x20commission)'),console[_0x16b181(0x17f)](_0x16b181(0x1b2)+_0x2cbfee[_0x16b181(0x191)](0x6)+_0x16b181(0x117));}}}_0x34f5c7===_0x16b181(0x147)&&(console[_0x16b181(0x17f)]('💸\x20CHARGEBACK:\x20Processing\x20penalty-only\x20deduction'),_0x5c60eb&&_0x5c60eb>0x0?(_0x2734ac=-_0x5c60eb,_0x271258-=_0x5c60eb,console[_0x16b181(0x17f)](_0x16b181(0x1f9)+_0x5c60eb[_0x16b181(0x191)](0x6)+_0x16b181(0xd0)),console['log'](_0x16b181(0x1f5))):console['log'](_0x16b181(0xdd)),_0x4c167a['chargebackAmount']=_0x5c60eb||0x0);_0x34f5c7===_0x16b181(0x1a3)&&_0x236967===_0x16b181(0x187)&&console['log'](_0x16b181(0x19e));const _0xb153fa=await _0x440208[_0x16b181(0x146)][_0x16b181(0x1bb)]({'where':{'id':_0x32f441},'data':_0x4c167a,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x2734ac!==0x0&&(await _0x440208[_0x16b181(0x177)][_0x16b181(0x1bb)]({'where':{'id':_0x14e3ba[_0x16b181(0x1ba)]},'data':{'balance':_0x271258}}),console['log']('💰\x20Shop\x20'+_0x14e3ba[_0x16b181(0x1ba)]+_0x16b181(0x21b)+_0x14e3ba[_0x16b181(0x177)]['balance'][_0x16b181(0x191)](0x6)+_0x16b181(0x1ca)+_0x271258[_0x16b181(0x191)](0x6)+'\x20USDT\x20('+(_0x2734ac>0x0?'+':'')+_0x2734ac[_0x16b181(0x191)](0x6)+')')),_0xb153fa;});return{'id':_0x52d672['id'],'shopId':_0x52d672[_0x54797e(0x1ba)],'gateway':_0x52d672[_0x54797e(0x1d8)],'amount':_0x52d672[_0x54797e(0x171)],'currency':_0x52d672[_0x54797e(0x141)],'status':_0x52d672[_0x54797e(0x149)],'orderId':_0x52d672[_0x54797e(0x18a)],'gatewayOrderId':_0x52d672[_0x54797e(0x1d0)],'customerEmail':_0x52d672[_0x54797e(0x11b)],'customerName':_0x52d672[_0x54797e(0x1ee)],'customerCountry':_0x52d672[_0x54797e(0x100)],'customerIp':_0x52d672[_0x54797e(0x21a)],'customerUa':_0x52d672['customerUa'],'failureMessage':_0x52d672[_0x54797e(0x110)],'adminNotes':_0x52d672[_0x54797e(0x1ab)],'chargebackAmount':_0x52d672[_0x54797e(0xf5)],'statusChangedBy':_0x52d672['statusChangedBy'],'statusChangedAt':_0x52d672[_0x54797e(0x211)],'createdAt':_0x52d672[_0x54797e(0x125)],'updatedAt':_0x52d672['updatedAt'],'shop':_0x52d672[_0x54797e(0x177)]};}async['updateUser'](_0x698723,_0x571e44){const _0x165f44=a40_0x298144,_0x46476e=Math[_0x165f44(0x1df)]()[_0x165f44(0x172)](0x24)[_0x165f44(0x21d)](0x2,0x9);console[_0x165f44(0x17f)](_0x165f44(0x13a)+_0x46476e+_0x165f44(0x135)+_0x698723);const _0x4c9199={..._0x571e44};_0x571e44['password']&&_0x571e44[_0x165f44(0xec)][_0x165f44(0x128)]()!==''?(console['log'](_0x165f44(0x20d)+_0x46476e+_0x165f44(0x1db)+_0x698723),_0x4c9199[_0x165f44(0xec)]=await bcryptjs_1['default'][_0x165f44(0x1f4)](_0x571e44[_0x165f44(0xec)],0xc)):(console[_0x165f44(0x17f)]('🔐\x20['+_0x46476e+_0x165f44(0x219)),delete _0x4c9199[_0x165f44(0xec)]);_0x571e44[_0x165f44(0x207)]&&(_0x4c9199[_0x165f44(0x1c3)]=_0x571e44['fullName'],delete _0x4c9199['fullName']);_0x571e44['telegramId']&&(_0x4c9199[_0x165f44(0x1a0)]=_0x571e44['telegramId'],delete _0x4c9199[_0x165f44(0x1f7)]);_0x571e44[_0x165f44(0x132)]&&(_0x4c9199[_0x165f44(0x143)]=_0x571e44[_0x165f44(0x132)],delete _0x4c9199['merchantUrl']);if(_0x571e44[_0x165f44(0xe1)]){const _0x3420c2=_0x571e44[_0x165f44(0xe1)][_0x165f44(0xd8)](_0x58ceae=>this[_0x165f44(0x1c4)](_0x58ceae));console[_0x165f44(0x17f)](_0x165f44(0x197),_0x571e44['gateways'],'->',_0x3420c2),_0x4c9199[_0x165f44(0xf3)]=JSON[_0x165f44(0xd4)](_0x3420c2),delete _0x4c9199[_0x165f44(0xe1)];}_0x571e44[_0x165f44(0xf1)]&&(console[_0x165f44(0x17f)]('🔧\x20['+_0x46476e+_0x165f44(0x16d),_0x571e44[_0x165f44(0xf1)]),_0x4c9199[_0x165f44(0xf1)]=JSON['stringify'](_0x571e44[_0x165f44(0xf1)]),console[_0x165f44(0x17f)]('🔧\x20['+_0x46476e+_0x165f44(0xeb),_0x4c9199[_0x165f44(0xf1)]));_0x571e44[_0x165f44(0x1af)]&&(_0x571e44[_0x165f44(0x1af)][_0x165f44(0xe5)]!==undefined&&(_0x4c9199[_0x165f44(0xe5)]=_0x571e44['wallets'][_0x165f44(0xe5)]||null),_0x571e44[_0x165f44(0x1af)][_0x165f44(0x1e0)]!==undefined&&(_0x4c9199[_0x165f44(0x1e0)]=_0x571e44['wallets']['usdtTrcWallet']||null),_0x571e44[_0x165f44(0x1af)]['usdtErcWallet']!==undefined&&(_0x4c9199[_0x165f44(0x198)]=_0x571e44[_0x165f44(0x1af)][_0x165f44(0x198)]||null),_0x571e44[_0x165f44(0x1af)][_0x165f44(0xd7)]!==undefined&&(_0x4c9199[_0x165f44(0xd7)]=_0x571e44[_0x165f44(0x1af)]['usdcPolygonWallet']||null),delete _0x4c9199[_0x165f44(0x1af)]);const _0x13157c=await database_1['default'][_0x165f44(0x177)]['update']({'where':{'id':_0x698723},'data':_0x4c9199,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0x165f44(0x17f)](_0x165f44(0xee)+_0x46476e+_0x165f44(0x1fd),_0x13157c['gatewaySettings']),{'id':_0x13157c['id'],'fullName':_0x13157c['name'],'username':_0x13157c[_0x165f44(0x14c)],'telegramId':_0x13157c['telegram'],'merchantUrl':_0x13157c[_0x165f44(0x143)],'gateways':_0x13157c['paymentGateways']?JSON['parse'](_0x13157c[_0x165f44(0xf3)]):null,'gatewaySettings':_0x13157c['gatewaySettings']?JSON[_0x165f44(0x179)](_0x13157c[_0x165f44(0xf1)]):null,'publicKey':_0x13157c[_0x165f44(0x16a)],'wallets':{'usdtPolygonWallet':_0x13157c[_0x165f44(0xe5)],'usdtTrcWallet':_0x13157c[_0x165f44(0x1e0)],'usdtErcWallet':_0x13157c['usdtErcWallet'],'usdcPolygonWallet':_0x13157c[_0x165f44(0xd7)]},'status':_0x13157c['status'],'createdAt':_0x13157c[_0x165f44(0x125)]};}async['suspendUser'](_0x4e3050){const _0x245b26=a40_0x298144,_0x507b7b=await database_1[_0x245b26(0x14b)][_0x245b26(0x177)]['update']({'where':{'id':_0x4e3050},'data':{'status':'SUSPENDED'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x507b7b['id'],'fullName':_0x507b7b[_0x245b26(0x1c3)],'username':_0x507b7b['username'],'telegramId':_0x507b7b[_0x245b26(0x1a0)],'merchantUrl':_0x507b7b[_0x245b26(0x143)],'gateways':_0x507b7b[_0x245b26(0xf3)]?JSON[_0x245b26(0x179)](_0x507b7b[_0x245b26(0xf3)]):null,'gatewaySettings':_0x507b7b[_0x245b26(0xf1)]?JSON[_0x245b26(0x179)](_0x507b7b[_0x245b26(0xf1)]):null,'publicKey':_0x507b7b[_0x245b26(0x16a)],'wallets':{'usdtPolygonWallet':_0x507b7b[_0x245b26(0xe5)],'usdtTrcWallet':_0x507b7b[_0x245b26(0x1e0)],'usdtErcWallet':_0x507b7b['usdtErcWallet'],'usdcPolygonWallet':_0x507b7b[_0x245b26(0xd7)]},'status':_0x507b7b[_0x245b26(0x149)],'createdAt':_0x507b7b['createdAt']};}async[a40_0x298144(0x160)](_0x1c8d91){const _0x327ee8=a40_0x298144,_0x3a7a8b=await database_1[_0x327ee8(0x14b)][_0x327ee8(0x177)]['update']({'where':{'id':_0x1c8d91},'data':{'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x3a7a8b['id'],'fullName':_0x3a7a8b['name'],'username':_0x3a7a8b[_0x327ee8(0x14c)],'telegramId':_0x3a7a8b[_0x327ee8(0x1a0)],'merchantUrl':_0x3a7a8b['shopUrl'],'gateways':_0x3a7a8b[_0x327ee8(0xf3)]?JSON[_0x327ee8(0x179)](_0x3a7a8b['paymentGateways']):null,'gatewaySettings':_0x3a7a8b[_0x327ee8(0xf1)]?JSON['parse'](_0x3a7a8b[_0x327ee8(0xf1)]):null,'publicKey':_0x3a7a8b['publicKey'],'wallets':{'usdtPolygonWallet':_0x3a7a8b['usdtPolygonWallet'],'usdtTrcWallet':_0x3a7a8b['usdtTrcWallet'],'usdtErcWallet':_0x3a7a8b['usdtErcWallet'],'usdcPolygonWallet':_0x3a7a8b[_0x327ee8(0xd7)]},'status':_0x3a7a8b[_0x327ee8(0x149)],'createdAt':_0x3a7a8b[_0x327ee8(0x125)]};}async[a40_0x298144(0x1bd)](_0x1ee707){const _0x139bc8=a40_0x298144,{page:_0x5d6cb4,limit:_0x72fd91,status:_0x2d00ea}=_0x1ee707,_0x266c50=(_0x5d6cb4-0x1)*_0x72fd91,_0xb0a0b9={};_0x2d00ea&&(_0xb0a0b9['status']=_0x2d00ea[_0x139bc8(0x17a)]());const [_0x1d2665,_0x47bb29]=await Promise['all']([database_1['default'][_0x139bc8(0x177)][_0x139bc8(0x102)]({'where':_0xb0a0b9,'skip':_0x266c50,'take':_0x72fd91,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1['default'][_0x139bc8(0x177)][_0x139bc8(0x134)]({'where':_0xb0a0b9})]);return{'users':_0x1d2665['map'](_0x551687=>{const _0x2494db=_0x139bc8,_0x2a3324=_0x551687[_0x2494db(0xf3)]?JSON[_0x2494db(0x179)](_0x551687[_0x2494db(0xf3)]):null,_0x514cd1=_0x2a3324?_0x2a3324[_0x2494db(0xd8)](_0x1d2c2f=>this[_0x2494db(0x200)](_0x1d2c2f)):null;return{'id':_0x551687['id'],'fullName':_0x551687[_0x2494db(0x1c3)],'username':_0x551687[_0x2494db(0x14c)],'telegramId':_0x551687[_0x2494db(0x1a0)],'merchantUrl':_0x551687[_0x2494db(0x143)],'gateways':_0x514cd1,'gatewaySettings':_0x551687[_0x2494db(0xf1)]?JSON['parse'](_0x551687[_0x2494db(0xf1)]):null,'publicKey':_0x551687[_0x2494db(0x16a)],'wallets':{'usdtPolygonWallet':_0x551687[_0x2494db(0xe5)],'usdtTrcWallet':_0x551687[_0x2494db(0x1e0)],'usdtErcWallet':_0x551687['usdtErcWallet'],'usdcPolygonWallet':_0x551687['usdcPolygonWallet']},'status':_0x551687[_0x2494db(0x149)],'createdAt':_0x551687[_0x2494db(0x125)]};}),'pagination':{'page':_0x5d6cb4,'limit':_0x72fd91,'total':_0x47bb29,'totalPages':Math['ceil'](_0x47bb29/_0x72fd91)}};}async[a40_0x298144(0x1b3)](_0x2f6883){const _0x260d40=a40_0x298144,_0x2dc4ca=await database_1[_0x260d40(0x14b)][_0x260d40(0x177)][_0x260d40(0x1fe)]({'where':{'id':_0x2f6883},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x2dc4ca)return null;const _0x5162b7=_0x2dc4ca[_0x260d40(0xf3)]?JSON[_0x260d40(0x179)](_0x2dc4ca[_0x260d40(0xf3)]):null,_0x3f3c37=_0x5162b7?_0x5162b7[_0x260d40(0xd8)](_0x366e21=>this[_0x260d40(0x200)](_0x366e21)):null;return _0x5162b7&&_0x3f3c37&&console[_0x260d40(0x17f)](_0x260d40(0x181),_0x5162b7,'->',_0x3f3c37),{'id':_0x2dc4ca['id'],'fullName':_0x2dc4ca['name'],'username':_0x2dc4ca[_0x260d40(0x14c)],'telegramId':_0x2dc4ca[_0x260d40(0x1a0)],'merchantUrl':_0x2dc4ca[_0x260d40(0x143)],'gateways':_0x3f3c37,'gatewaySettings':_0x2dc4ca['gatewaySettings']?JSON['parse'](_0x2dc4ca[_0x260d40(0xf1)]):null,'publicKey':_0x2dc4ca['publicKey'],'wallets':{'usdtPolygonWallet':_0x2dc4ca[_0x260d40(0xe5)],'usdtTrcWallet':_0x2dc4ca[_0x260d40(0x1e0)],'usdtErcWallet':_0x2dc4ca['usdtErcWallet'],'usdcPolygonWallet':_0x2dc4ca[_0x260d40(0xd7)]},'status':_0x2dc4ca['status'],'createdAt':_0x2dc4ca['createdAt']};}async[a40_0x298144(0x133)](_0x3bf323){const _0x52de56=a40_0x298144,{fullName:_0x14011b,username:_0x4c420a,password:_0x48d052,telegramId:_0x40c814,merchantUrl:_0x4a5829,gateways:_0x2503f0,gatewaySettings:_0x1389fb,wallets:_0x3fbabf}=_0x3bf323,_0x227fc1=await database_1[_0x52de56(0x14b)][_0x52de56(0x177)][_0x52de56(0x1fe)]({'where':{'username':_0x4c420a}});if(_0x227fc1)throw new Error('Username\x20already\x20exists');if(_0x40c814){const _0x30614=await database_1['default'][_0x52de56(0x177)]['findUnique']({'where':{'telegram':_0x40c814}});if(_0x30614)throw new Error('Telegram\x20username\x20already\x20exists');}const _0x55a909=await bcryptjs_1['default'][_0x52de56(0x1f4)](_0x48d052,0xc),_0x1872de=_0x52de56(0x1a2)+crypto_1[_0x52de56(0x14b)][_0x52de56(0x165)](0x20)[_0x52de56(0x172)](_0x52de56(0x190)),_0x25eb21=_0x52de56(0x1fc)+crypto_1['default'][_0x52de56(0x165)](0x20)['toString']('hex'),_0x1c90d4=_0x2503f0?_0x2503f0[_0x52de56(0xd8)](_0x2ec474=>this[_0x52de56(0x1c4)](_0x2ec474)):null;_0x2503f0&&_0x1c90d4&&console['log'](_0x52de56(0x1fa),_0x2503f0,'->',_0x1c90d4);const _0xde1040=await database_1[_0x52de56(0x14b)][_0x52de56(0x177)][_0x52de56(0x19a)]({'data':{'name':_0x14011b,'username':_0x4c420a,'password':_0x55a909,'telegram':_0x40c814,'shopUrl':_0x4a5829,'paymentGateways':_0x1c90d4?JSON[_0x52de56(0xd4)](_0x1c90d4):null,'gatewaySettings':_0x1389fb?JSON['stringify'](_0x1389fb):null,'usdtPolygonWallet':_0x3fbabf?.[_0x52de56(0xe5)]||null,'usdtTrcWallet':_0x3fbabf?.[_0x52de56(0x1e0)]||null,'usdtErcWallet':_0x3fbabf?.['usdtErcWallet']||null,'usdcPolygonWallet':_0x3fbabf?.[_0x52de56(0xd7)]||null,'publicKey':_0x1872de,'secretKey':_0x25eb21,'status':_0x52de56(0x10f)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0xde1040['id'],'fullName':_0xde1040[_0x52de56(0x1c3)],'username':_0xde1040[_0x52de56(0x14c)],'telegramId':_0xde1040[_0x52de56(0x1a0)],'merchantUrl':_0xde1040[_0x52de56(0x143)],'gateways':_0xde1040['paymentGateways']?JSON[_0x52de56(0x179)](_0xde1040[_0x52de56(0xf3)]):null,'gatewaySettings':_0xde1040[_0x52de56(0xf1)]?JSON[_0x52de56(0x179)](_0xde1040[_0x52de56(0xf1)]):null,'publicKey':_0xde1040['publicKey'],'wallets':{'usdtPolygonWallet':_0xde1040[_0x52de56(0xe5)],'usdtTrcWallet':_0xde1040[_0x52de56(0x1e0)],'usdtErcWallet':_0xde1040[_0x52de56(0x198)],'usdcPolygonWallet':_0xde1040[_0x52de56(0xd7)]},'status':_0xde1040['status'],'createdAt':_0xde1040[_0x52de56(0x125)]};}async['deleteUser'](_0x534193){const _0x4351f9=a40_0x298144;await database_1[_0x4351f9(0x14b)]['shop'][_0x4351f9(0x212)]({'where':{'id':_0x534193}});}[a40_0x298144(0x1de)](_0x4096ec,_0xc61f19,_0x4733c8){const _0x1cf332=a40_0x298144,_0x5a3954=new Map(),_0x826878=new Date(_0xc61f19);while(_0x826878<=_0x4733c8){const _0x4727c4=_0x826878['toISOString']()['split']('T')[0x0];_0x5a3954[_0x1cf332(0x145)](_0x4727c4,{'revenue':0x0,'count':0x0}),_0x826878['setDate'](_0x826878[_0x1cf332(0x222)]()+0x1);}for(const _0x48ad56 of _0x4096ec){const _0x58597f=_0x48ad56[_0x1cf332(0x125)][_0x1cf332(0xd6)]()[_0x1cf332(0x14f)]('T')[0x0],_0x5ec0a5=_0x5a3954['get'](_0x58597f);_0x5ec0a5&&(_0x5ec0a5[_0x1cf332(0x134)]+=0x1,_0x48ad56[_0x1cf332(0x149)]===_0x1cf332(0x187)&&(_0x48ad56[_0x1cf332(0x11a)]?_0x5ec0a5[_0x1cf332(0x12e)]+=_0x48ad56['amountUSDT']:console['log'](_0x1cf332(0x215)+_0x48ad56['id']+_0x1cf332(0x20e))));}const _0x43ad0e=[],_0x15d89c=[];for(const [_0x1f8248,_0x581f35]of _0x5a3954){_0x43ad0e[_0x1cf332(0x14d)]({'date':_0x1f8248,'amount':Math[_0x1cf332(0x138)](_0x581f35[_0x1cf332(0x12e)]*0x64)/0x64}),_0x15d89c[_0x1cf332(0x14d)]({'date':_0x1f8248,'count':_0x581f35[_0x1cf332(0x134)]});}return{'dailyRevenue':_0x43ad0e,'dailyPayments':_0x15d89c};}}exports['AdminService']=AdminService;