'use strict';function a35_0x23a6(){const _0x4633ff=['null','_count','reduce','parse','createdAt','totalCommissionRate','\x20payments\x20for\x20daily\x20statistics','orderId','findMany','\x20USDT\x20(+','Rapyd','defineProperty','\x20\x20\x20🖥️\x20User\x20Agent:\x20','randomBytes','successUrl','\x20commission\x20analysis:','not\x20found','averageCheckUSDT','COMPLETED','warn','balance','Noda','shopUrl','2020-01-01','includes','hash','network','KLYME\x20GB','getFullYear','awaitingPayout','Error\x20processing\x20payment\x20','📊\x20[DAILY]\x20Total\x20revenue\x20processed:\x20','CoinToPay','\x20USDT\x20to\x20balance','AdminService','conversionRate','revenue','chargebackAmount','default','📊\x20Merchant\x20statistics\x20calculated:','paymentMethod','ACTIVE','Test\x20Gateway','findUnique','txUrls','admin','getPayoutById','CHARGEBACK','getTime','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','\x20\x20\x20Total\x20payments:\x20','Payment\x20not\x20found','paymentsCount','gatewayEarnings','📊\x20Shop\x20info\x20for\x20','periodTo','toFixed','name','customerEmail','8733648MfIUsS','round','8046665uDdZqA','merchantEarnings','customerIp','📊\x20Total\x20payments\x20(all\x20statuses):\x20','paidAt','getMonth','toISOString','groupBy','\x20\x20\x20Name:\x20','createUser','🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','\x20no\x20longer\x20PAID:\x20-','pendingUrl','activateUser','find','toUpperCase','15746661GPdncs','\x20USDT\x20for\x20','SUSPENDED','customerUa','sort','\x20\x20\x20Total\x20paid\x20out:\x20','updatePaymentStatus','status','failUrl','totalPayments','usdtTrcWallet','remitterIban','shopId','all','adminNotes','\x20\x20\x20💰\x20Total\x20payout:\x20','\x20USDT\x20(-','usdtPolygonWallet','aggregate','totalTurnover','\x20merchants\x20with\x20positive\x20balance','deleteUser','bcryptjs','\x20\x20\x20Balance:\x20','updateCustomerData','payment','\x20\x20\x20Gateway\x20key\x20found:\x20','127158pSjUdA','commissionUSDT','findFirst','paidOutUSDT','lte','\x20USDT\x20from\x20balance','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','hex','\x20USDT\x20total','pk_','turnoverUSDT','totalPaidOut','KLYME\x20EU','📊\x20Payment\x20','set','cardLast4','💰\x20Found\x20','usdcPolygonWallet','gateway','sk_','📊\x20[ADMIN]\x20Status\x20breakdown:','customerName','currencyService','🔄\x20Admin\x20updating\x20payment\x20','Plisio','length','dateFrom','\x20(direct\x20amountUSDT)','__esModule','⚠️\x20[DAILY]\x20Failed\x20to\x20convert\x20','REFUND','delete','90d','INACTIVE','📊\x20[ADMIN]\x20Period:\x20','\x20\x20\x20Conversion\x20rate:\x20','updatedAt','amount','📊\x20Conversion\x20rate\x20calculation:','Insufficient\x20balance.\x20Available:\x20','\x20to\x20','getAllUsers','\x20USDT\x20(same\x20as\x20awaiting)','commission','update','getMerchantStatistics','\x20USDT,\x20Requested:\x20','publicKey','toString','txid','log','fullName','remitterName','💰\x20Payment\x20','availableBalance','\x20USDT\x20(','gateways','$transaction','1724QCIMqH','externalPaymentUrl','getAllPayouts','dateTo','getMerchantsAwaitingPayout','telegram','\x20status:\x20','string','getGatewayDisplayName','updateUser','count','30d','\x20\x20\x20Shop:\x20','split','totalPayout','desc','password','currency','amountUSDT','✅\x20Payout\x20created:\x20','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','\x20->\x20','paymentGateways','\x20\x20\x20📊\x20Total\x20payments:\x20','getMerchantsSelection','\x20USDT','forEach','\x20merchants,\x20','PAID','\x20\x20\x20Username:\x20','\x20\x20\x20🌐\x20IP:\x20','merchantUrl','statusChangedAt','📅\x20Period:\x20','\x20USDT)','telegramId','crypto','\x20balance\x20updated:','getAllPayments','gte','\x20total','period','deletePayout','\x20\x20\x20🌍\x20Country:\x20','setDate','_sum','gatewaySettings','../config/database','values','create','custom','generateDailyStatistics','wallets','notes','turnover','\x20PAID\x20payments\x20out\x20of\x20','\x20\x20\x20Current\x20balance:\x20','5929548eAzznV','averageCommissionRate','\x20\x20\x20💵\x20Available\x20balance:\x20','\x20for\x20payment\x20on\x20','getUserById','test_gateway','\x20\x20\x20Failed\x20to\x20parse\x20gatewaySettings:\x20','\x20USDT\x20for\x20payment\x20on\x20','__importDefault','payout','ceil','\x20became\x20PAID:\x20+','convertToUSDT','usdtErcWallet','1576572XSwvUq','bankId','\x20\x20\x20Parsed\x20gatewaySettings:','📊\x20Payout\x20statistics\x20calculated:','💰\x20[DAILY]\x20Added\x20','map','successfulPayments','stringify','date','periodFrom','customerCountry','shop','\x20USDT\x20(total\x20merchant\x20balances)','toLowerCase','623TlrsPn','📊\x20Calculating\x20payout\x20statistics...','not\x20set','gatewayOrderId','keys','asc','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','whiteUrl','insensitive','get','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','push','\x20\x20\x20✅\x20Successful\x20payments:\x20','./currencyService','Username\x20already\x20exists','merchantEarningsUSDT','\x20\x20\x20📈\x20Conversion\x20rate:\x20','716mlgDSJ','username','failureMessage','💰\x20Shop\x20','\x20\x20\x20Raw\x20gatewaySettings:\x20'];a35_0x23a6=function(){return _0x4633ff;};return a35_0x23a6();}const a35_0x1d8a18=a35_0x4591;(function(_0x82b73a,_0x4ec2ba){const _0x485d4c=a35_0x4591,_0x340cd5=_0x82b73a();while(!![]){try{const _0x332225=parseInt(_0x485d4c(0x132))/0x1*(-parseInt(_0x485d4c(0xcc))/0x2)+-parseInt(_0x485d4c(0x113))/0x3+parseInt(_0x485d4c(0x105))/0x4+parseInt(_0x485d4c(0x174))/0x5+parseInt(_0x485d4c(0x92))/0x6*(parseInt(_0x485d4c(0x121))/0x7)+-parseInt(_0x485d4c(0x172))/0x8+-parseInt(_0x485d4c(0x184))/0x9;if(_0x332225===_0x4ec2ba)break;else _0x340cd5['push'](_0x340cd5['shift']());}catch(_0x4a692f){_0x340cd5['push'](_0x340cd5['shift']());}}}(a35_0x23a6,0xf2a36));function a35_0x4591(_0x36455d,_0x39a21f){const _0x23a648=a35_0x23a6();return a35_0x4591=function(_0x459167,_0x5c4a22){_0x459167=_0x459167-0x8c;let _0xced83d=_0x23a648[_0x459167];return _0xced83d;},a35_0x4591(_0x36455d,_0x39a21f);}var __importDefault=this&&this[a35_0x1d8a18(0x10d)]||function(_0x8ed5d6){const _0x28111b=a35_0x1d8a18;return _0x8ed5d6&&_0x8ed5d6[_0x28111b(0xae)]?_0x8ed5d6:{'default':_0x8ed5d6};};Object[a35_0x1d8a18(0x142)](exports,a35_0x1d8a18(0xae),{'value':!![]}),exports[a35_0x1d8a18(0x159)]=void 0x0;const database_1=__importDefault(require(a35_0x1d8a18(0xfb))),bcryptjs_1=__importDefault(require(a35_0x1d8a18(0x8d))),crypto_1=__importDefault(require(a35_0x1d8a18(0xf0))),currencyService_1=require(a35_0x1d8a18(0x12e));class AdminService{async['getPayoutStats'](){const _0x4b4ea9=a35_0x1d8a18;console[_0x4b4ea9(0xc4)](_0x4b4ea9(0x122));const _0x318cd1=await database_1['default'][_0x4b4ea9(0x11e)][_0x4b4ea9(0x196)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x4b4ea9(0x160)}}),_0x40bf8f=new Date(),_0x43151a=new Date(_0x40bf8f[_0x4b4ea9(0x153)](),_0x40bf8f[_0x4b4ea9(0x179)](),0x1),_0x50bae9=new Date(_0x40bf8f[_0x4b4ea9(0x153)](),_0x40bf8f[_0x4b4ea9(0x179)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x2505ad=await database_1[_0x4b4ea9(0x15d)][_0x4b4ea9(0x10e)][_0x4b4ea9(0x196)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x43151a,'lte':_0x50bae9},'status':_0x4b4ea9(0x149)}}),_0x17ba97=_0x318cd1['_sum'][_0x4b4ea9(0x9d)]||0x0,_0x1de3a0=_0x318cd1[_0x4b4ea9(0xf9)][_0x4b4ea9(0x14b)]||0x0,_0x10ab70=_0x2505ad[_0x4b4ea9(0xf9)][_0x4b4ea9(0xb7)]||0x0,_0x2b03d4={'totalPayout':Math['round'](_0x17ba97*0x64)/0x64,'awaitingPayout':Math['round'](_0x1de3a0*0x64)/0x64,'thisMonth':Math[_0x4b4ea9(0x173)](_0x10ab70*0x64)/0x64,'availableBalance':Math[_0x4b4ea9(0x173)](_0x1de3a0*0x64)/0x64};return console[_0x4b4ea9(0xc4)](_0x4b4ea9(0x116)),console['log'](_0x4b4ea9(0x193)+_0x2b03d4[_0x4b4ea9(0xda)]+'\x20USDT\x20(total\x20paid\x20to\x20merchants)'),console['log']('\x20\x20\x20⏳\x20Awaiting\x20payout:\x20'+_0x2b03d4[_0x4b4ea9(0x154)]+_0x4b4ea9(0x11f)),console['log'](_0x4b4ea9(0x107)+_0x2b03d4[_0x4b4ea9(0xc8)]+_0x4b4ea9(0xbc)),console[_0x4b4ea9(0xc4)]('\x20\x20\x20📅\x20This\x20month:\x20'+_0x2b03d4['thisMonth']+_0x4b4ea9(0xe5)),_0x2b03d4;}async[a35_0x1d8a18(0x8f)](_0x5890f2,_0x2049b1){const _0x525ca4=a35_0x1d8a18;console['log'](_0x525ca4(0x127)+_0x5890f2+':',_0x2049b1);const _0x51d653=await database_1[_0x525ca4(0x15d)]['payment'][_0x525ca4(0x162)]({'where':{'id':_0x5890f2},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x51d653)throw new Error('Payment\x20not\x20found');const _0x326e5f={};_0x2049b1[_0x525ca4(0x11d)]!==undefined&&(_0x326e5f[_0x525ca4(0x11d)]=_0x2049b1['customerCountry']||null);_0x2049b1['customerIp']!==undefined&&(_0x326e5f[_0x525ca4(0x176)]=_0x2049b1[_0x525ca4(0x176)]||null);_0x2049b1[_0x525ca4(0x187)]!==undefined&&(_0x326e5f['customerUa']=_0x2049b1[_0x525ca4(0x187)]||null);const _0x15e590=await database_1[_0x525ca4(0x15d)][_0x525ca4(0x90)][_0x525ca4(0xbe)]({'where':{'id':_0x5890f2},'data':{..._0x326e5f,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x525ca4(0xc4)](_0x525ca4(0x168)+_0x5890f2),console[_0x525ca4(0xc4)](_0x525ca4(0xf7)+_0x51d653[_0x525ca4(0x11d)]+_0x525ca4(0xe1)+_0x15e590[_0x525ca4(0x11d)]),console['log'](_0x525ca4(0xea)+_0x51d653[_0x525ca4(0x176)]+_0x525ca4(0xe1)+_0x15e590[_0x525ca4(0x176)]),console['log'](_0x525ca4(0x143)+(_0x51d653[_0x525ca4(0x187)]?_0x525ca4(0xa0):_0x525ca4(0x123))+'\x20->\x20'+(_0x15e590[_0x525ca4(0x187)]?_0x525ca4(0xa0):_0x525ca4(0x123))),_0x15e590;}async['getSystemStatistics'](_0x24c24c){const _0x50e6f7=a35_0x1d8a18,_0x271ffa=new Date();let _0x4d89fb;switch(_0x24c24c){case'7d':_0x4d89fb=new Date(_0x271ffa[_0x50e6f7(0x167)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x50e6f7(0xd7):_0x4d89fb=new Date(_0x271ffa[_0x50e6f7(0x167)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x50e6f7(0xb2):_0x4d89fb=new Date(_0x271ffa[_0x50e6f7(0x167)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x4d89fb=new Date(_0x271ffa[_0x50e6f7(0x167)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x1e6ddb,_0x3062f3,_0x574669,_0x403a0a,_0xff04ea,_0x29eb84,_0xa7c887]=await Promise[_0x50e6f7(0x191)]([database_1[_0x50e6f7(0x15d)][_0x50e6f7(0x11e)][_0x50e6f7(0xd6)](),database_1['default']['shop'][_0x50e6f7(0xd6)]({'where':{'status':_0x50e6f7(0x160)}}),database_1[_0x50e6f7(0x15d)]['payment'][_0x50e6f7(0xd6)]({'where':{'createdAt':{'gte':_0x4d89fb},'gateway':{'not':_0x50e6f7(0x10a)}}}),database_1[_0x50e6f7(0x15d)][_0x50e6f7(0x90)][_0x50e6f7(0xd6)]({'where':{'status':'PAID','createdAt':{'gte':_0x4d89fb},'gateway':{'not':'test_gateway'}}}),database_1[_0x50e6f7(0x15d)][_0x50e6f7(0x90)][_0x50e6f7(0x13f)]({'where':{'status':_0x50e6f7(0xe8),'createdAt':{'gte':_0x4d89fb},'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1['default'][_0x50e6f7(0x90)]['findMany']({'where':{'gateway':{'not':_0x50e6f7(0x10a)}},'take':0xa,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x50e6f7(0x15d)][_0x50e6f7(0x90)]['findMany']({'where':{'createdAt':{'gte':_0x4d89fb},'gateway':{'not':_0x50e6f7(0x10a)}},'select':{'status':!![],'amountUSDT':!![],'amount':!![],'currency':!![],'createdAt':!![]},'orderBy':{'createdAt':'asc'}})]);let _0x1ddb27=0x0;for(const _0x450024 of _0xff04ea){if(_0x450024[_0x50e6f7(0xde)])_0x1ddb27+=_0x450024['amountUSDT'];else{const _0x49a73e=await currencyService_1['currencyService'][_0x50e6f7(0x111)](_0x450024[_0x50e6f7(0xb7)],_0x450024[_0x50e6f7(0xdd)]);_0x1ddb27+=_0x49a73e;}}console[_0x50e6f7(0xc4)]('📊\x20[ADMIN]\x20Processing\x20'+_0xa7c887[_0x50e6f7(0xab)]+_0x50e6f7(0x13d)),console[_0x50e6f7(0xc4)](_0x50e6f7(0xb4)+_0x4d89fb[_0x50e6f7(0x17a)]()['split']('T')[0x0]+_0x50e6f7(0xba)+_0x271ffa[_0x50e6f7(0x17a)]()[_0x50e6f7(0xd9)]('T')[0x0]);const _0x3d0ab1=_0xa7c887[_0x50e6f7(0x139)]((_0x1cb0f8,_0xd80aa6)=>{const _0x4312d1=_0x50e6f7;return _0x1cb0f8[_0xd80aa6[_0x4312d1(0x18b)]]=(_0x1cb0f8[_0xd80aa6[_0x4312d1(0x18b)]]||0x0)+0x1,_0x1cb0f8;},{});console[_0x50e6f7(0xc4)](_0x50e6f7(0xa6),_0x3d0ab1);const _0x550a34=await this[_0x50e6f7(0xff)](_0xa7c887,_0x4d89fb,_0x271ffa),_0x493cb0=_0x574669>0x0?_0x403a0a/_0x574669*0x64:0x0;return{'totalShops':_0x1e6ddb,'activeShops':_0x3062f3,'totalPayments':_0x574669,'successfulPayments':_0x403a0a,'totalRevenue':Math[_0x50e6f7(0x173)](_0x1ddb27*0x64)/0x64,'conversionRate':Math[_0x50e6f7(0x173)](_0x493cb0*0x64)/0x64,'dailyRevenue':_0x550a34['dailyRevenue'],'dailyPayments':_0x550a34['dailyPayments'],'recentPayments':_0x29eb84[_0x50e6f7(0x118)](_0x58e7fa=>({'id':_0x58e7fa['id'],'amount':_0x58e7fa[_0x50e6f7(0xb7)],'currency':_0x58e7fa['currency'],'status':_0x58e7fa[_0x50e6f7(0x18b)],'gateway':_0x58e7fa[_0x50e6f7(0xa4)],'shop':_0x58e7fa[_0x50e6f7(0x11e)],'createdAt':_0x58e7fa[_0x50e6f7(0x13b)]}))};}async[a35_0x1d8a18(0xff)](_0x4a1aa5,_0x139c03,_0x58b511){const _0x245a0b=a35_0x1d8a18,_0x253cf0=new Map(),_0x434337=new Date(_0x139c03);while(_0x434337<=_0x58b511){const _0x361155=_0x434337[_0x245a0b(0x17a)]()[_0x245a0b(0xd9)]('T')[0x0];_0x253cf0['set'](_0x361155,{'revenue':0x0,'count':0x0}),_0x434337[_0x245a0b(0xf8)](_0x434337['getDate']()+0x1);}let _0x255169=0x0,_0x15eeeb=0x0;for(const _0x104157 of _0x4a1aa5){const _0x4eda1b=_0x104157[_0x245a0b(0x13b)][_0x245a0b(0x17a)]()[_0x245a0b(0xd9)]('T')[0x0],_0xe41928=_0x253cf0[_0x245a0b(0x12a)](_0x4eda1b);if(_0xe41928){_0xe41928[_0x245a0b(0xd6)]+=0x1;if(_0x104157[_0x245a0b(0x18b)]==='PAID'){_0x255169++;if(_0x104157[_0x245a0b(0xde)])_0xe41928[_0x245a0b(0x15b)]+=_0x104157['amountUSDT'],_0x15eeeb+=_0x104157[_0x245a0b(0xde)],console[_0x245a0b(0xc4)](_0x245a0b(0x117)+_0x104157[_0x245a0b(0xde)]+_0x245a0b(0x185)+_0x4eda1b+_0x245a0b(0xad));else try{const _0x347ad0=await currencyService_1['currencyService']['convertToUSDT'](_0x104157[_0x245a0b(0xb7)],_0x104157['currency']);_0xe41928[_0x245a0b(0x15b)]+=_0x347ad0,_0x15eeeb+=_0x347ad0,console[_0x245a0b(0xc4)]('💱\x20[DAILY]\x20Converted\x20'+_0x104157[_0x245a0b(0xb7)]+'\x20'+_0x104157[_0x245a0b(0xdd)]+_0x245a0b(0xba)+_0x347ad0+_0x245a0b(0x10c)+_0x4eda1b);}catch(_0x39ea91){console[_0x245a0b(0x14a)](_0x245a0b(0xaf)+_0x104157[_0x245a0b(0xb7)]+'\x20'+_0x104157[_0x245a0b(0xdd)]+_0x245a0b(0x108)+_0x4eda1b+':',_0x39ea91);}}}}console['log']('📊\x20[DAILY]\x20Processed\x20'+_0x255169+_0x245a0b(0x103)+_0x4a1aa5[_0x245a0b(0xab)]+_0x245a0b(0xf4)),console[_0x245a0b(0xc4)](_0x245a0b(0x156)+_0x15eeeb+_0x245a0b(0xe5));const _0xfd2084=[],_0x58ec4a=[];for(const [_0x5a5401,_0xbb7332]of _0x253cf0){_0xfd2084[_0x245a0b(0x12c)]({'date':_0x5a5401,'amount':Math[_0x245a0b(0x173)](_0xbb7332[_0x245a0b(0x15b)]*0x64)/0x64}),_0x58ec4a[_0x245a0b(0x12c)]({'date':_0x5a5401,'count':_0xbb7332[_0x245a0b(0xd6)]});}return{'dailyRevenue':_0xfd2084,'dailyPayments':_0x58ec4a};}async[a35_0x1d8a18(0xbf)](_0x1788fe){const _0x266caa=a35_0x1d8a18;console[_0x266caa(0xc4)](_0x266caa(0x98),_0x1788fe);let _0x3c4d0f,_0x2b0f6c=new Date();if(_0x1788fe['period']===_0x266caa(0xfe)&&_0x1788fe[_0x266caa(0xac)]&&_0x1788fe[_0x266caa(0xcf)])_0x3c4d0f=new Date(_0x1788fe[_0x266caa(0xac)]),_0x2b0f6c=new Date(_0x1788fe[_0x266caa(0xcf)]);else{const _0x3123f2=new Date();switch(_0x1788fe['period']){case'week':_0x3c4d0f=new Date(_0x3123f2[_0x266caa(0x167)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'month':_0x3c4d0f=new Date(_0x3123f2[_0x266caa(0x167)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'year':_0x3c4d0f=new Date(_0x3123f2[_0x266caa(0x167)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x266caa(0x191):default:_0x3c4d0f=new Date(_0x266caa(0x14e));break;}}console[_0x266caa(0xc4)](_0x266caa(0xed)+_0x3c4d0f['toISOString']()+_0x266caa(0xba)+_0x2b0f6c[_0x266caa(0x17a)]());if(_0x1788fe[_0x266caa(0x190)]){const _0x205bd7=await database_1[_0x266caa(0x15d)][_0x266caa(0x11e)]['findUnique']({'where':{'id':_0x1788fe[_0x266caa(0x190)]},'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}});console[_0x266caa(0xc4)](_0x266caa(0x16d)+_0x1788fe[_0x266caa(0x190)]+':'),console[_0x266caa(0xc4)](_0x266caa(0x17c)+_0x205bd7?.[_0x266caa(0x170)]),console[_0x266caa(0xc4)](_0x266caa(0xe9)+_0x205bd7?.[_0x266caa(0x133)]),console[_0x266caa(0xc4)]('\x20\x20\x20Raw\x20gatewaySettings:\x20'+(_0x205bd7?.[_0x266caa(0xfa)]||_0x266caa(0x137)));if(_0x205bd7?.[_0x266caa(0xfa)])try{const _0x4de0e1=JSON[_0x266caa(0x13a)](_0x205bd7[_0x266caa(0xfa)]);console[_0x266caa(0xc4)](_0x266caa(0x115),_0x4de0e1),console[_0x266caa(0xc4)]('\x20\x20\x20Commission\x20from\x20shop\x20settings:\x20'+(_0x4de0e1['commission']||_0x266caa(0x147)));}catch(_0x4286dd){console[_0x266caa(0xc4)](_0x266caa(0x10b)+_0x4286dd);}}const _0x57e0a5={'status':_0x266caa(0xe8),'gateway':{'not':'test_gateway'},'paidAt':{'gte':_0x3c4d0f,'lte':_0x2b0f6c}};_0x1788fe[_0x266caa(0x190)]&&(_0x57e0a5[_0x266caa(0x190)]=_0x1788fe[_0x266caa(0x190)]);const _0x2331b9=await database_1[_0x266caa(0x15d)][_0x266caa(0x90)]['findMany']({'where':_0x57e0a5,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console['log'](_0x266caa(0xa2)+_0x2331b9[_0x266caa(0xab)]+'\x20paid\x20payments\x20for\x20analysis');const _0x2d1eb2={'gateway':{'not':_0x266caa(0x10a)},'createdAt':{'gte':_0x3c4d0f,'lte':_0x2b0f6c}};_0x1788fe['shopId']&&(_0x2d1eb2['shopId']=_0x1788fe[_0x266caa(0x190)]);const _0x675d0=await database_1[_0x266caa(0x15d)][_0x266caa(0x90)]['count']({'where':_0x2d1eb2});console[_0x266caa(0xc4)](_0x266caa(0x177)+_0x675d0),console[_0x266caa(0xc4)]('✅\x20Successful\x20payments:\x20'+_0x2331b9[_0x266caa(0xab)]);let _0x3adedf=0x0,_0x57c6ef=0x0,_0x3c96bd=0x0;const _0x12f3ec={},_0x25ca86={},_0x54f00c={};for(const _0x1b3cdd of _0x2331b9){try{const _0x335a5b=await currencyService_1['currencyService']['convertToUSDT'](_0x1b3cdd[_0x266caa(0xb7)],_0x1b3cdd[_0x266caa(0xdd)]);let _0x14cf7c={};if(_0x1b3cdd[_0x266caa(0x11e)][_0x266caa(0xfa)])try{_0x14cf7c=JSON[_0x266caa(0x13a)](_0x1b3cdd['shop'][_0x266caa(0xfa)]);}catch(_0x17d486){console['error']('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x1b3cdd[_0x266caa(0x190)]+':',_0x17d486);}let _0x4b4986=0xa;const _0x79df29=Object[_0x266caa(0x125)](_0x14cf7c)[_0x266caa(0x182)](_0x4139ca=>_0x4139ca[_0x266caa(0x120)]()===_0x1b3cdd[_0x266caa(0xa4)][_0x266caa(0x120)]());_0x79df29&&_0x14cf7c[_0x79df29]&&_0x14cf7c[_0x79df29][_0x266caa(0xbd)]&&(_0x4b4986=_0x14cf7c[_0x79df29]['commission']);console[_0x266caa(0xc4)](_0x266caa(0x9f)+_0x1b3cdd['id']+_0x266caa(0x146)),console[_0x266caa(0xc4)](_0x266caa(0xd8)+_0x1b3cdd['shop'][_0x266caa(0x170)]+'\x20('+_0x1b3cdd[_0x266caa(0x190)]+')'),console[_0x266caa(0xc4)]('\x20\x20\x20Gateway:\x20'+_0x1b3cdd[_0x266caa(0xa4)]),console[_0x266caa(0xc4)](_0x266caa(0x136)+(_0x1b3cdd['shop'][_0x266caa(0xfa)]||_0x266caa(0x137))),console[_0x266caa(0xc4)](_0x266caa(0x115),_0x14cf7c),console[_0x266caa(0xc4)](_0x266caa(0x91)+(_0x79df29||'not\x20found')),console['log']('\x20\x20\x20Commission\x20from\x20settings:\x20'+(_0x79df29&&_0x14cf7c[_0x79df29]?_0x14cf7c[_0x79df29][_0x266caa(0xbd)]:_0x266caa(0x147))),console[_0x266caa(0xc4)]('\x20\x20\x20Final\x20commission\x20used:\x20'+_0x4b4986+'%');const _0x4b8df4=_0x335a5b*(_0x4b4986/0x64),_0x1e3f99=_0x335a5b-_0x4b8df4;_0x3adedf+=_0x335a5b,_0x57c6ef+=_0x1e3f99,_0x3c96bd+=_0x4b8df4;!_0x12f3ec[_0x1b3cdd['gateway']]&&(_0x12f3ec[_0x1b3cdd[_0x266caa(0xa4)]]={'gateway':_0x1b3cdd[_0x266caa(0xa4)],'gatewayDisplayName':this[_0x266caa(0xd4)](_0x1b3cdd[_0x266caa(0xa4)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x12f3ec[_0x1b3cdd[_0x266caa(0xa4)]][_0x266caa(0x16b)]++,_0x12f3ec[_0x1b3cdd[_0x266caa(0xa4)]][_0x266caa(0x9c)]+=_0x335a5b,_0x12f3ec[_0x1b3cdd[_0x266caa(0xa4)]][_0x266caa(0x93)]+=_0x4b8df4,_0x12f3ec[_0x1b3cdd[_0x266caa(0xa4)]][_0x266caa(0x130)]+=_0x1e3f99,_0x12f3ec[_0x1b3cdd[_0x266caa(0xa4)]][_0x266caa(0x13c)]+=_0x4b4986;!_0x1788fe[_0x266caa(0x190)]&&(!_0x25ca86[_0x1b3cdd['shopId']]&&(_0x25ca86[_0x1b3cdd[_0x266caa(0x190)]]={'shopId':_0x1b3cdd[_0x266caa(0x190)],'shopName':_0x1b3cdd[_0x266caa(0x11e)][_0x266caa(0x170)],'shopUsername':_0x1b3cdd['shop'][_0x266caa(0x133)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x25ca86[_0x1b3cdd[_0x266caa(0x190)]][_0x266caa(0x16b)]++,_0x25ca86[_0x1b3cdd[_0x266caa(0x190)]][_0x266caa(0x9c)]+=_0x335a5b,_0x25ca86[_0x1b3cdd[_0x266caa(0x190)]][_0x266caa(0x93)]+=_0x4b8df4,_0x25ca86[_0x1b3cdd[_0x266caa(0x190)]]['merchantEarningsUSDT']+=_0x1e3f99);const _0x1d4866=_0x1b3cdd[_0x266caa(0x178)][_0x266caa(0x17a)]()[_0x266caa(0xd9)]('T')[0x0];!_0x54f00c[_0x1d4866]&&(_0x54f00c[_0x1d4866]={'date':_0x1d4866,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x54f00c[_0x1d4866][_0x266caa(0x102)]+=_0x335a5b,_0x54f00c[_0x1d4866][_0x266caa(0x175)]+=_0x1e3f99,_0x54f00c[_0x1d4866][_0x266caa(0x16c)]+=_0x4b8df4,_0x54f00c[_0x1d4866][_0x266caa(0x16b)]++;}catch(_0x39e2ad){console['error'](_0x266caa(0x155)+_0x1b3cdd['id']+':',_0x39e2ad);}}Object[_0x266caa(0xfc)](_0x12f3ec)[_0x266caa(0xe6)](_0x1f38ac=>{const _0x516842=_0x266caa;_0x1f38ac[_0x516842(0x106)]=_0x1f38ac['paymentsCount']>0x0?_0x1f38ac[_0x516842(0x13c)]/_0x1f38ac[_0x516842(0x16b)]:0x0,delete _0x1f38ac[_0x516842(0x13c)];}),Object[_0x266caa(0xfc)](_0x25ca86)['forEach'](_0x278125=>{const _0x17d455=_0x266caa;_0x278125[_0x17d455(0x148)]=_0x278125[_0x17d455(0x16b)]>0x0?_0x278125[_0x17d455(0x9c)]/_0x278125[_0x17d455(0x16b)]:0x0;});let _0x5da667=0x0;if(_0x1788fe[_0x266caa(0x190)]){const _0x18e3e8=await database_1['default'][_0x266caa(0x10e)][_0x266caa(0x13f)]({'where':{'shopId':_0x1788fe['shopId'],'status':_0x266caa(0x149),'createdAt':{'gte':_0x3c4d0f,'lte':_0x2b0f6c}},'select':{'amount':!![]}});_0x5da667=_0x18e3e8[_0x266caa(0x139)]((_0x42a156,_0x5afe86)=>_0x42a156+_0x5afe86['amount'],0x0);}const _0x295cec=_0x675d0,_0x5d3e69=_0x2331b9[_0x266caa(0xab)],_0x527248=_0x5d3e69>0x0?_0x3adedf/_0x5d3e69:0x0,_0x15ecf5=_0x295cec>0x0?_0x5d3e69/_0x295cec*0x64:0x0;console[_0x266caa(0xc4)](_0x266caa(0xb8)),console[_0x266caa(0xc4)](_0x266caa(0x169)+_0x295cec),console['log']('\x20\x20\x20Successful\x20payments:\x20'+_0x5d3e69),console[_0x266caa(0xc4)](_0x266caa(0xb5)+_0x15ecf5[_0x266caa(0x16f)](0x2)+'%');const _0x5482c1=Math[_0x266caa(0x10f)]((_0x2b0f6c['getTime']()-_0x3c4d0f['getTime']())/(0x3e8*0x3c*0x3c*0x18)),_0x4d59ca={'totalTurnover':Math[_0x266caa(0x173)](_0x3adedf*0x64)/0x64,'merchantEarnings':Math[_0x266caa(0x173)](_0x57c6ef*0x64)/0x64,'gatewayEarnings':Math[_0x266caa(0x173)](_0x3c96bd*0x64)/0x64,'totalPaidOut':Math['round'](_0x5da667*0x64)/0x64,'averageCheck':Math[_0x266caa(0x173)](_0x527248*0x64)/0x64,'totalPayments':_0x295cec,'successfulPayments':_0x5d3e69,'conversionRate':Math[_0x266caa(0x173)](_0x15ecf5*0x64)/0x64,'gatewayBreakdown':Object[_0x266caa(0xfc)](_0x12f3ec)['map'](_0x3f196f=>({..._0x3f196f,'turnoverUSDT':Math[_0x266caa(0x173)](_0x3f196f['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math['round'](_0x3f196f[_0x266caa(0x93)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x266caa(0x173)](_0x3f196f[_0x266caa(0x130)]*0x64)/0x64,'averageCommissionRate':Math[_0x266caa(0x173)](_0x3f196f[_0x266caa(0x106)]*0x64)/0x64})),'merchantBreakdown':_0x1788fe[_0x266caa(0x190)]?undefined:Object['values'](_0x25ca86)[_0x266caa(0x118)](_0x3f15b8=>({..._0x3f15b8,'turnoverUSDT':Math['round'](_0x3f15b8[_0x266caa(0x9c)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x3f15b8[_0x266caa(0x93)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x266caa(0x173)](_0x3f15b8[_0x266caa(0x130)]*0x64)/0x64,'paidOutUSDT':Math[_0x266caa(0x173)](_0x3f15b8[_0x266caa(0x95)]*0x64)/0x64,'averageCheckUSDT':Math[_0x266caa(0x173)](_0x3f15b8['averageCheckUSDT']*0x64)/0x64})),'dailyData':Object[_0x266caa(0xfc)](_0x54f00c)[_0x266caa(0x118)](_0x172d37=>({..._0x172d37,'turnover':Math[_0x266caa(0x173)](_0x172d37['turnover']*0x64)/0x64,'merchantEarnings':Math[_0x266caa(0x173)](_0x172d37['merchantEarnings']*0x64)/0x64,'gatewayEarnings':Math[_0x266caa(0x173)](_0x172d37[_0x266caa(0x16c)]*0x64)/0x64}))[_0x266caa(0x188)]((_0x54d450,_0x38bc3a)=>_0x54d450['date']['localeCompare'](_0x38bc3a[_0x266caa(0x11b)])),'periodInfo':{'from':_0x3c4d0f,'to':_0x2b0f6c,'periodType':_0x1788fe[_0x266caa(0xf5)]||_0x266caa(0xfe),'daysCount':_0x5482c1}};return console['log'](_0x266caa(0x15e)),console[_0x266caa(0xc4)]('\x20\x20\x20💰\x20Total\x20turnover:\x20'+_0x4d59ca[_0x266caa(0x197)]+'\x20USDT'),console[_0x266caa(0xc4)]('\x20\x20\x20👤\x20Merchant\x20earnings:\x20'+_0x4d59ca[_0x266caa(0x175)]+_0x266caa(0xe5)),console[_0x266caa(0xc4)]('\x20\x20\x20🏪\x20Gateway\x20earnings:\x20'+_0x4d59ca[_0x266caa(0x16c)]+_0x266caa(0xe5)),console['log'](_0x266caa(0xe3)+_0x4d59ca[_0x266caa(0x18d)]),console[_0x266caa(0xc4)](_0x266caa(0x12d)+_0x4d59ca[_0x266caa(0x119)]),console['log'](_0x266caa(0x131)+_0x4d59ca[_0x266caa(0x15a)]+'%'),_0x4d59ca;}[a35_0x1d8a18(0xd4)](_0x323890){const _0x1cc775=a35_0x1d8a18,_0x16a6c8={'test_gateway':_0x1cc775(0x161),'plisio':_0x1cc775(0xaa),'rapyd':_0x1cc775(0x141),'noda':_0x1cc775(0x14c),'cointopay':_0x1cc775(0x157),'mastercard':'Amer\x20Master','klyme_eu':_0x1cc775(0x9e),'klyme_gb':_0x1cc775(0x152),'klyme_de':'KLYME\x20DE'};return _0x16a6c8[_0x323890]||_0x323890;}async[a35_0x1d8a18(0xd0)](_0x5dec97){const _0xf675f8=a35_0x1d8a18,{page:_0x1e4a4b,limit:_0x33faa7,minAmount:_0x54d172,search:_0x5cd51d}=_0x5dec97,_0x119be8=(_0x1e4a4b-0x1)*_0x33faa7;console[_0xf675f8(0xc4)](_0xf675f8(0x12b),_0x5dec97);const _0x332a4a={'balance':{'gt':0x0},'status':_0xf675f8(0x160)};_0x54d172&&(_0x332a4a[_0xf675f8(0x14b)][_0xf675f8(0xf3)]=_0x54d172);_0x5cd51d&&(_0x332a4a['OR']=[{'name':{'contains':_0x5cd51d,'mode':_0xf675f8(0x129)}},{'username':{'contains':_0x5cd51d,'mode':'insensitive'}}]);const [_0x3ff5ba,_0x4cbfdb]=await Promise[_0xf675f8(0x191)]([database_1[_0xf675f8(0x15d)][_0xf675f8(0x11e)][_0xf675f8(0x13f)]({'where':_0x332a4a,'skip':_0x119be8,'take':_0x33faa7,'orderBy':{'balance':_0xf675f8(0xdb)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'createdAt':!![]}}),database_1['default'][_0xf675f8(0x11e)][_0xf675f8(0xd6)]({'where':_0x332a4a})]);console['log'](_0xf675f8(0xa2)+_0x3ff5ba[_0xf675f8(0xab)]+_0xf675f8(0x198));const _0x26e7f2=await Promise[_0xf675f8(0x191)](_0x3ff5ba[_0xf675f8(0x118)](async _0x1c0e1a=>{const _0x3066bf=_0xf675f8,[_0x53942e,_0x33c0d9,_0x1239a1]=await Promise[_0x3066bf(0x191)]([database_1['default'][_0x3066bf(0x90)]['count']({'where':{'shopId':_0x1c0e1a['id'],'status':'PAID','amountUSDT':{'not':null}}}),database_1[_0x3066bf(0x15d)]['payment'][_0x3066bf(0x94)]({'where':{'shopId':_0x1c0e1a['id'],'status':_0x3066bf(0xe8),'amountUSDT':{'not':null}},'orderBy':{'paidAt':_0x3066bf(0x126)},'select':{'paidAt':!![]}}),database_1['default'][_0x3066bf(0x90)][_0x3066bf(0x17b)]({'by':[_0x3066bf(0xa4)],'where':{'shopId':_0x1c0e1a['id'],'status':_0x3066bf(0xe8),'amountUSDT':{'not':null}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x137763=_0x1239a1[_0x3066bf(0x118)](_0x10fc34=>({'gateway':_0x10fc34[_0x3066bf(0xa4)],'count':_0x10fc34[_0x3066bf(0x138)]['id'],'amountUSDT':_0x10fc34[_0x3066bf(0xf9)][_0x3066bf(0xde)]||0x0,'amountAfterCommissionUSDT':_0x10fc34['_sum'][_0x3066bf(0xde)]||0x0,'commission':0x0}));return{'id':_0x1c0e1a['id'],'fullName':_0x1c0e1a[_0x3066bf(0x170)],'username':_0x1c0e1a[_0x3066bf(0x133)],'telegramId':_0x1c0e1a[_0x3066bf(0xd1)],'merchantUrl':_0x1c0e1a['shopUrl'],'wallets':{'usdtPolygonWallet':_0x1c0e1a[_0x3066bf(0x195)],'usdtTrcWallet':_0x1c0e1a[_0x3066bf(0x18e)],'usdtErcWallet':_0x1c0e1a[_0x3066bf(0x112)],'usdcPolygonWallet':_0x1c0e1a[_0x3066bf(0xa3)]},'totalAmountUSDT':_0x1c0e1a[_0x3066bf(0x14b)],'totalAmountAfterCommissionUSDT':_0x1c0e1a[_0x3066bf(0x14b)],'paymentsCount':_0x53942e,'oldestPaymentDate':_0x33c0d9?.[_0x3066bf(0x178)]||_0x1c0e1a[_0x3066bf(0x13b)],'gatewayBreakdown':_0x137763};})),_0x5a5e31=_0x3ff5ba[_0xf675f8(0x139)]((_0x4909ff,_0xd52411)=>_0x4909ff+_0xd52411[_0xf675f8(0x14b)],0x0),_0x4ccaa2=_0x5a5e31;return console['log']('📊\x20Merchants\x20awaiting\x20payout:\x20'+_0x4cbfdb+_0xf675f8(0xe7)+Math[_0xf675f8(0x173)](_0x4ccaa2*0x64)/0x64+_0xf675f8(0x9a)),{'merchants':_0x26e7f2,'pagination':{'page':_0x1e4a4b,'limit':_0x33faa7,'total':_0x4cbfdb,'totalPages':Math['ceil'](_0x4cbfdb/_0x33faa7)},'summary':{'totalMerchants':_0x4cbfdb,'totalAmountUSDT':Math[_0xf675f8(0x173)](_0x5a5e31*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0xf675f8(0x173)](_0x4ccaa2*0x64)/0x64}};}async['createPayout'](_0x31cf99){const _0x49d3a7=a35_0x1d8a18,{shopId:_0x4a708a,amount:_0x2d3a80,network:_0x4cb2a5,notes:_0xfde7f7,periodFrom:_0x369bf0,periodTo:_0x439521}=_0x31cf99,_0x212276=await database_1[_0x49d3a7(0x15d)][_0x49d3a7(0xcb)](async _0x46e29f=>{const _0x4a92df=_0x49d3a7,_0x36d227=await _0x46e29f[_0x4a92df(0x11e)]['findUnique']({'where':{'id':_0x4a708a},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x36d227)throw new Error('Shop\x20not\x20found');console[_0x4a92df(0xc4)]('💰\x20Creating\x20payout\x20for\x20shop\x20'+_0x36d227[_0x4a92df(0x133)]+':'),console[_0x4a92df(0xc4)](_0x4a92df(0x104)+_0x36d227[_0x4a92df(0x14b)]['toFixed'](0x6)+_0x4a92df(0xe5)),console['log']('\x20\x20\x20Payout\x20amount:\x20'+_0x2d3a80[_0x4a92df(0x16f)](0x6)+_0x4a92df(0xe5)),console[_0x4a92df(0xc4)](_0x4a92df(0xe0)+_0x36d227[_0x4a92df(0x9d)][_0x4a92df(0x16f)](0x6)+'\x20USDT');if(_0x36d227[_0x4a92df(0x14b)]<_0x2d3a80)throw new Error(_0x4a92df(0xb9)+_0x36d227[_0x4a92df(0x14b)][_0x4a92df(0x16f)](0x6)+_0x4a92df(0xc0)+_0x2d3a80[_0x4a92df(0x16f)](0x6)+_0x4a92df(0xe5));const _0x32e3fc=await _0x46e29f['payout']['create']({'data':{'shopId':_0x4a708a,'amount':_0x2d3a80,'network':_0x4cb2a5,'status':'COMPLETED','notes':_0xfde7f7,'periodFrom':_0x369bf0?new Date(_0x369bf0):null,'periodTo':_0x439521?new Date(_0x439521):null,'createdAt':new Date(),'paidAt':new Date()}}),_0xb12717=_0x36d227[_0x4a92df(0x14b)]-_0x2d3a80,_0xe05f22=_0x36d227['totalPaidOut']+_0x2d3a80;return await _0x46e29f[_0x4a92df(0x11e)][_0x4a92df(0xbe)]({'where':{'id':_0x4a708a},'data':{'balance':_0xb12717,'totalPaidOut':_0xe05f22}}),console['log'](_0x4a92df(0x135)+_0x36d227[_0x4a92df(0x133)]+_0x4a92df(0xf1)),console['log'](_0x4a92df(0x8e)+_0x36d227['balance'][_0x4a92df(0x16f)](0x6)+_0x4a92df(0xe1)+_0xb12717['toFixed'](0x6)+_0x4a92df(0x194)+_0x2d3a80['toFixed'](0x6)+')'),console['log'](_0x4a92df(0x189)+_0x36d227[_0x4a92df(0x9d)][_0x4a92df(0x16f)](0x6)+_0x4a92df(0xe1)+_0xe05f22[_0x4a92df(0x16f)](0x6)+_0x4a92df(0x140)+_0x2d3a80['toFixed'](0x6)+')'),{'payout':_0x32e3fc,'shop':_0x36d227};});return console['log'](_0x49d3a7(0xdf)+_0x212276[_0x49d3a7(0x10e)]['id']+'\x20for\x20shop\x20'+_0x212276[_0x49d3a7(0x11e)][_0x49d3a7(0x133)]+'\x20('+_0x2d3a80+_0x49d3a7(0xee)),{'id':_0x212276[_0x49d3a7(0x10e)]['id'],'shopId':_0x212276[_0x49d3a7(0x10e)][_0x49d3a7(0x190)],'shopName':_0x212276[_0x49d3a7(0x11e)]['name'],'shopUsername':_0x212276['shop'][_0x49d3a7(0x133)],'amount':_0x212276[_0x49d3a7(0x10e)][_0x49d3a7(0xb7)],'network':_0x212276[_0x49d3a7(0x10e)][_0x49d3a7(0x151)],'status':_0x212276['payout']['status'],'txid':_0x212276['payout'][_0x49d3a7(0xc3)],'notes':_0x212276[_0x49d3a7(0x10e)][_0x49d3a7(0x101)],'periodFrom':_0x212276[_0x49d3a7(0x10e)][_0x49d3a7(0x11c)],'periodTo':_0x212276[_0x49d3a7(0x10e)][_0x49d3a7(0x16e)],'createdAt':_0x212276[_0x49d3a7(0x10e)][_0x49d3a7(0x13b)],'paidAt':_0x212276[_0x49d3a7(0x10e)]['paidAt']};}async[a35_0x1d8a18(0xce)](_0x2c6147){const _0x4d485c=a35_0x1d8a18,{page:_0x4a65f5,limit:_0x508e15,shopId:_0xa2d5dd,network:_0x1a98b7,dateFrom:_0x2857e6,dateTo:_0x57cc90,search:_0x58ce6a}=_0x2c6147,_0x4daa76=(_0x4a65f5-0x1)*_0x508e15,_0x5b545b={};_0xa2d5dd&&(_0x5b545b[_0x4d485c(0x190)]=_0xa2d5dd);_0x1a98b7&&(_0x5b545b['network']=_0x1a98b7);(_0x2857e6||_0x57cc90)&&(_0x5b545b[_0x4d485c(0x13b)]={},_0x2857e6&&(_0x5b545b[_0x4d485c(0x13b)][_0x4d485c(0xf3)]=new Date(_0x2857e6)),_0x57cc90&&(_0x5b545b['createdAt']['lte']=new Date(_0x57cc90)));_0x58ce6a&&(_0x5b545b['OR']=[{'shop':{'name':{'contains':_0x58ce6a,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x58ce6a,'mode':_0x4d485c(0x129)}}},{'notes':{'contains':_0x58ce6a,'mode':_0x4d485c(0x129)}}]);const [_0x4131ee,_0x214fdc]=await Promise[_0x4d485c(0x191)]([database_1['default'][_0x4d485c(0x10e)][_0x4d485c(0x13f)]({'where':_0x5b545b,'skip':_0x4daa76,'take':_0x508e15,'orderBy':{'createdAt':_0x4d485c(0xdb)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x4d485c(0x10e)][_0x4d485c(0xd6)]({'where':_0x5b545b})]);return{'payouts':_0x4131ee[_0x4d485c(0x118)](_0x5b4028=>({'id':_0x5b4028['id'],'shopId':_0x5b4028[_0x4d485c(0x190)],'shopName':_0x5b4028[_0x4d485c(0x11e)][_0x4d485c(0x170)],'shopUsername':_0x5b4028[_0x4d485c(0x11e)][_0x4d485c(0x133)],'amount':_0x5b4028['amount'],'network':_0x5b4028[_0x4d485c(0x151)],'status':_0x5b4028[_0x4d485c(0x18b)],'txid':_0x5b4028[_0x4d485c(0xc3)],'notes':_0x5b4028[_0x4d485c(0x101)],'periodFrom':_0x5b4028[_0x4d485c(0x11c)],'periodTo':_0x5b4028[_0x4d485c(0x16e)],'createdAt':_0x5b4028['createdAt'],'paidAt':_0x5b4028[_0x4d485c(0x178)]})),'pagination':{'page':_0x4a65f5,'limit':_0x508e15,'total':_0x214fdc,'totalPages':Math[_0x4d485c(0x10f)](_0x214fdc/_0x508e15)}};}async[a35_0x1d8a18(0x165)](_0x4cfb27){const _0x459b54=a35_0x1d8a18,_0x3f1df9=await database_1[_0x459b54(0x15d)][_0x459b54(0x10e)]['findUnique']({'where':{'id':_0x4cfb27},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x3f1df9)return null;return{'id':_0x3f1df9['id'],'shopId':_0x3f1df9[_0x459b54(0x190)],'shopName':_0x3f1df9[_0x459b54(0x11e)][_0x459b54(0x170)],'shopUsername':_0x3f1df9['shop']['username'],'amount':_0x3f1df9[_0x459b54(0xb7)],'network':_0x3f1df9[_0x459b54(0x151)],'status':_0x3f1df9[_0x459b54(0x18b)],'txid':_0x3f1df9[_0x459b54(0xc3)],'notes':_0x3f1df9[_0x459b54(0x101)],'periodFrom':_0x3f1df9[_0x459b54(0x11c)],'periodTo':_0x3f1df9[_0x459b54(0x16e)],'createdAt':_0x3f1df9[_0x459b54(0x13b)],'paidAt':_0x3f1df9['paidAt']};}async[a35_0x1d8a18(0xf6)](_0x1e940a){const _0x18ebc9=a35_0x1d8a18;await database_1[_0x18ebc9(0x15d)][_0x18ebc9(0x10e)][_0x18ebc9(0xb1)]({'where':{'id':_0x1e940a}});}async[a35_0x1d8a18(0xf2)](_0x337786){const _0x27543f=a35_0x1d8a18,{page:_0x3c28de,limit:_0x1cbd9f,status:_0x4e8a17,gateway:_0x24b933,shopId:_0x230d4a,dateFrom:_0x32a7ee,dateTo:_0x3876cc,search:_0x3dba6f}=_0x337786,_0x3e2f30=(_0x3c28de-0x1)*_0x1cbd9f,_0x283435={};_0x4e8a17&&(_0x283435[_0x27543f(0x18b)]=_0x4e8a17[_0x27543f(0x183)]());_0x24b933&&(_0x283435[_0x27543f(0xa4)]=_0x24b933[_0x27543f(0x120)]());_0x283435['gateway']=_0x283435['gateway']?_0x283435[_0x27543f(0xa4)]:{'not':_0x27543f(0x10a)};if(typeof _0x283435[_0x27543f(0xa4)]===_0x27543f(0xd3)&&_0x283435[_0x27543f(0xa4)]!==_0x27543f(0x10a)){}else{if(typeof _0x283435[_0x27543f(0xa4)]===_0x27543f(0xd3)&&_0x283435['gateway']==='test_gateway'){}else _0x283435[_0x27543f(0xa4)]={'not':_0x27543f(0x10a)};}_0x230d4a&&(_0x283435[_0x27543f(0x190)]=_0x230d4a);(_0x32a7ee||_0x3876cc)&&(_0x283435['createdAt']={},_0x32a7ee&&(_0x283435[_0x27543f(0x13b)][_0x27543f(0xf3)]=new Date(_0x32a7ee)),_0x3876cc&&(_0x283435[_0x27543f(0x13b)][_0x27543f(0x96)]=new Date(_0x3876cc)));_0x3dba6f&&(_0x283435['OR']=[{'orderId':{'contains':_0x3dba6f,'mode':_0x27543f(0x129)}},{'gatewayOrderId':{'contains':_0x3dba6f,'mode':_0x27543f(0x129)}},{'customerEmail':{'contains':_0x3dba6f,'mode':_0x27543f(0x129)}},{'shop':{'name':{'contains':_0x3dba6f,'mode':_0x27543f(0x129)}}},{'shop':{'username':{'contains':_0x3dba6f,'mode':_0x27543f(0x129)}}}]);const [_0x3bf02a,_0x1aa51a]=await Promise['all']([database_1['default']['payment'][_0x27543f(0x13f)]({'where':_0x283435,'skip':_0x3e2f30,'take':_0x1cbd9f,'orderBy':{'createdAt':_0x27543f(0xdb)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x27543f(0x15d)][_0x27543f(0x90)][_0x27543f(0xd6)]({'where':_0x283435})]);return{'payments':_0x3bf02a[_0x27543f(0x118)](_0x3c5290=>({'id':_0x3c5290['id'],'shopId':_0x3c5290[_0x27543f(0x190)],'gateway':this[_0x27543f(0xd4)](_0x3c5290[_0x27543f(0xa4)]),'gatewayTechnical':_0x3c5290[_0x27543f(0xa4)],'amount':_0x3c5290[_0x27543f(0xb7)],'currency':_0x3c5290['currency'],'status':_0x3c5290[_0x27543f(0x18b)],'orderId':_0x3c5290['orderId'],'gatewayOrderId':_0x3c5290['gatewayOrderId'],'customerEmail':_0x3c5290[_0x27543f(0x171)],'customerName':_0x3c5290[_0x27543f(0xa7)],'customerCountry':_0x3c5290[_0x27543f(0x11d)],'customerIp':_0x3c5290[_0x27543f(0x176)],'customerUa':_0x3c5290['customerUa'],'failureMessage':_0x3c5290[_0x27543f(0x134)],'cardLast4':_0x3c5290[_0x27543f(0xa1)],'paymentMethod':_0x3c5290[_0x27543f(0x15f)],'bankId':_0x3c5290[_0x27543f(0x114)],'remitterIban':_0x3c5290['remitterIban'],'remitterName':_0x3c5290['remitterName'],'txUrls':_0x3c5290[_0x27543f(0x163)],'createdAt':_0x3c5290[_0x27543f(0x13b)],'updatedAt':_0x3c5290[_0x27543f(0xb6)],'shop':_0x3c5290[_0x27543f(0x11e)]})),'pagination':{'page':_0x3c28de,'limit':_0x1cbd9f,'total':_0x1aa51a,'totalPages':Math[_0x27543f(0x10f)](_0x1aa51a/_0x1cbd9f)}};}async['getPaymentById'](_0x3f6994){const _0x369d42=a35_0x1d8a18,_0x21b6b0=await database_1['default'][_0x369d42(0x90)][_0x369d42(0x162)]({'where':{'id':_0x3f6994},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x21b6b0)return null;return{'id':_0x21b6b0['id'],'shopId':_0x21b6b0[_0x369d42(0x190)],'gateway':this['getGatewayDisplayName'](_0x21b6b0[_0x369d42(0xa4)]),'gatewayTechnical':_0x21b6b0['gateway'],'amount':_0x21b6b0[_0x369d42(0xb7)],'currency':_0x21b6b0[_0x369d42(0xdd)],'status':_0x21b6b0[_0x369d42(0x18b)],'orderId':_0x21b6b0[_0x369d42(0x13e)],'gatewayOrderId':_0x21b6b0[_0x369d42(0x124)],'customerEmail':_0x21b6b0[_0x369d42(0x171)],'customerName':_0x21b6b0[_0x369d42(0xa7)],'customerCountry':_0x21b6b0[_0x369d42(0x11d)],'customerIp':_0x21b6b0['customerIp'],'customerUa':_0x21b6b0[_0x369d42(0x187)],'failureMessage':_0x21b6b0[_0x369d42(0x134)],'externalPaymentUrl':_0x21b6b0[_0x369d42(0xcd)],'successUrl':_0x21b6b0[_0x369d42(0x145)],'failUrl':_0x21b6b0[_0x369d42(0x18c)],'pendingUrl':_0x21b6b0[_0x369d42(0x180)],'whiteUrl':_0x21b6b0[_0x369d42(0x128)],'cardLast4':_0x21b6b0[_0x369d42(0xa1)],'paymentMethod':_0x21b6b0[_0x369d42(0x15f)],'bankId':_0x21b6b0[_0x369d42(0x114)],'remitterIban':_0x21b6b0[_0x369d42(0x18f)],'remitterName':_0x21b6b0[_0x369d42(0xc6)],'txUrls':_0x21b6b0['txUrls'],'createdAt':_0x21b6b0[_0x369d42(0x13b)],'updatedAt':_0x21b6b0[_0x369d42(0xb6)],'shop':_0x21b6b0[_0x369d42(0x11e)]};}async[a35_0x1d8a18(0x18a)](_0xbc2ea,_0xa4e8d0,_0x423287,_0x195a5f){const _0x3c2c90=a35_0x1d8a18,_0x18b844=await database_1[_0x3c2c90(0x15d)][_0x3c2c90(0xcb)](async _0x23906e=>{const _0x268eee=_0x3c2c90,_0x2cbfe6=await _0x23906e[_0x268eee(0x90)][_0x268eee(0x162)]({'where':{'id':_0xbc2ea},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x2cbfe6)throw new Error(_0x268eee(0x16a));const _0xcf81fb=_0x2cbfe6[_0x268eee(0x18b)],_0x53c75b=_0xa4e8d0[_0x268eee(0x183)]();console['log'](_0x268eee(0xa9)+_0xbc2ea+_0x268eee(0xd2)+_0xcf81fb+_0x268eee(0xe1)+_0x53c75b),console[_0x268eee(0xc4)]('💰\x20Current\x20shop\x20balance:\x20'+_0x2cbfe6['shop']['balance']+_0x268eee(0xe5));const _0x2e5140={'status':_0x53c75b,'updatedAt':new Date(),'statusChangedBy':_0x268eee(0x164),'statusChangedAt':new Date()};_0x423287&&(_0x2e5140[_0x268eee(0x192)]=_0x423287);_0x53c75b===_0x268eee(0x166)&&_0x195a5f&&(_0x2e5140['chargebackAmount']=_0x195a5f);let _0x124e22=0x0,_0x1eb829=_0x2cbfe6[_0x268eee(0x11e)][_0x268eee(0x14b)];if(_0x53c75b===_0x268eee(0xe8)&&_0xcf81fb!==_0x268eee(0xe8)){_0x2e5140['paidAt']=new Date();const _0xb8a603=await currencyService_1[_0x268eee(0xa8)][_0x268eee(0x111)](_0x2cbfe6[_0x268eee(0xb7)],_0x2cbfe6[_0x268eee(0xdd)]);_0x2e5140['amountUSDT']=_0xb8a603,_0x124e22=_0xb8a603,_0x1eb829+=_0xb8a603,console[_0x268eee(0xc4)](_0x268eee(0xc7)+_0xbc2ea+_0x268eee(0x110)+_0xb8a603[_0x268eee(0x16f)](0x6)+_0x268eee(0x158));}else _0xcf81fb===_0x268eee(0xe8)&&_0x53c75b!==_0x268eee(0xe8)&&(_0x2cbfe6[_0x268eee(0xde)]&&(_0x124e22=-_0x2cbfe6[_0x268eee(0xde)],_0x1eb829-=_0x2cbfe6[_0x268eee(0xde)],_0x2e5140[_0x268eee(0xde)]=null,console['log'](_0x268eee(0xc7)+_0xbc2ea+_0x268eee(0x17f)+_0x2cbfe6[_0x268eee(0xde)][_0x268eee(0x16f)](0x6)+_0x268eee(0x97))));if(_0x53c75b===_0x268eee(0x166)){if(_0xcf81fb==='PAID'&&_0x2cbfe6[_0x268eee(0xde)]){}_0x195a5f&&_0x195a5f>0x0&&(_0x124e22-=_0x195a5f,_0x1eb829-=_0x195a5f,console['log']('💸\x20CHARGEBACK\x20penalty:\x20-'+_0x195a5f['toFixed'](0x6)+_0x268eee(0x97)));}_0x53c75b===_0x268eee(0xb0)&&_0xcf81fb==='PAID'&&console['log'](_0x268eee(0x17e));const _0x414c41=await _0x23906e[_0x268eee(0x90)]['update']({'where':{'id':_0xbc2ea},'data':_0x2e5140,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x124e22!==0x0&&(await _0x23906e[_0x268eee(0x11e)]['update']({'where':{'id':_0x2cbfe6[_0x268eee(0x190)]},'data':{'balance':_0x1eb829}}),console[_0x268eee(0xc4)](_0x268eee(0x135)+_0x2cbfe6[_0x268eee(0x190)]+'\x20balance\x20updated:\x20'+_0x2cbfe6[_0x268eee(0x11e)]['balance'][_0x268eee(0x16f)](0x6)+_0x268eee(0xe1)+_0x1eb829['toFixed'](0x6)+_0x268eee(0xc9)+(_0x124e22>0x0?'+':'')+_0x124e22[_0x268eee(0x16f)](0x6)+')')),_0x414c41;});return{'id':_0x18b844['id'],'shopId':_0x18b844[_0x3c2c90(0x190)],'gateway':_0x18b844[_0x3c2c90(0xa4)],'amount':_0x18b844[_0x3c2c90(0xb7)],'currency':_0x18b844[_0x3c2c90(0xdd)],'status':_0x18b844['status'],'orderId':_0x18b844[_0x3c2c90(0x13e)],'gatewayOrderId':_0x18b844[_0x3c2c90(0x124)],'customerEmail':_0x18b844[_0x3c2c90(0x171)],'customerName':_0x18b844['customerName'],'customerCountry':_0x18b844[_0x3c2c90(0x11d)],'customerIp':_0x18b844[_0x3c2c90(0x176)],'customerUa':_0x18b844[_0x3c2c90(0x187)],'failureMessage':_0x18b844[_0x3c2c90(0x134)],'adminNotes':_0x18b844[_0x3c2c90(0x192)],'chargebackAmount':_0x18b844[_0x3c2c90(0x15c)],'statusChangedBy':_0x18b844['statusChangedBy'],'statusChangedAt':_0x18b844[_0x3c2c90(0xec)],'createdAt':_0x18b844[_0x3c2c90(0x13b)],'updatedAt':_0x18b844[_0x3c2c90(0xb6)],'shop':_0x18b844[_0x3c2c90(0x11e)]};}async[a35_0x1d8a18(0xd5)](_0x241093,_0x31a768){const _0x4399c=a35_0x1d8a18,_0x440169={..._0x31a768};_0x31a768['password']&&(_0x440169[_0x4399c(0xdc)]=await bcryptjs_1[_0x4399c(0x15d)][_0x4399c(0x150)](_0x31a768[_0x4399c(0xdc)],0xc));_0x31a768[_0x4399c(0xc5)]&&(_0x440169[_0x4399c(0x170)]=_0x31a768[_0x4399c(0xc5)],delete _0x440169[_0x4399c(0xc5)]);_0x31a768['telegramId']&&(_0x440169[_0x4399c(0xd1)]=_0x31a768[_0x4399c(0xef)],delete _0x440169[_0x4399c(0xef)]);_0x31a768[_0x4399c(0xeb)]&&(_0x440169[_0x4399c(0x14d)]=_0x31a768[_0x4399c(0xeb)],delete _0x440169['merchantUrl']);_0x31a768[_0x4399c(0xca)]&&(_0x440169[_0x4399c(0xe2)]=JSON['stringify'](_0x31a768['gateways']),delete _0x440169[_0x4399c(0xca)]);_0x31a768[_0x4399c(0xfa)]&&(_0x440169[_0x4399c(0xfa)]=JSON[_0x4399c(0x11a)](_0x31a768['gatewaySettings']));_0x31a768[_0x4399c(0x100)]&&(_0x31a768['wallets'][_0x4399c(0x195)]!==undefined&&(_0x440169[_0x4399c(0x195)]=_0x31a768[_0x4399c(0x100)]['usdtPolygonWallet']||null),_0x31a768[_0x4399c(0x100)]['usdtTrcWallet']!==undefined&&(_0x440169['usdtTrcWallet']=_0x31a768[_0x4399c(0x100)]['usdtTrcWallet']||null),_0x31a768[_0x4399c(0x100)]['usdtErcWallet']!==undefined&&(_0x440169[_0x4399c(0x112)]=_0x31a768['wallets'][_0x4399c(0x112)]||null),_0x31a768['wallets']['usdcPolygonWallet']!==undefined&&(_0x440169[_0x4399c(0xa3)]=_0x31a768[_0x4399c(0x100)][_0x4399c(0xa3)]||null),delete _0x440169['wallets']);const _0x533c99=await database_1[_0x4399c(0x15d)][_0x4399c(0x11e)]['update']({'where':{'id':_0x241093},'data':_0x440169,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x533c99['id'],'fullName':_0x533c99[_0x4399c(0x170)],'username':_0x533c99[_0x4399c(0x133)],'telegramId':_0x533c99[_0x4399c(0xd1)],'merchantUrl':_0x533c99[_0x4399c(0x14d)],'gateways':_0x533c99[_0x4399c(0xe2)]?JSON[_0x4399c(0x13a)](_0x533c99['paymentGateways']):null,'gatewaySettings':_0x533c99[_0x4399c(0xfa)]?JSON['parse'](_0x533c99[_0x4399c(0xfa)]):null,'publicKey':_0x533c99[_0x4399c(0xc1)],'wallets':{'usdtPolygonWallet':_0x533c99[_0x4399c(0x195)],'usdtTrcWallet':_0x533c99[_0x4399c(0x18e)],'usdtErcWallet':_0x533c99[_0x4399c(0x112)],'usdcPolygonWallet':_0x533c99[_0x4399c(0xa3)]},'status':_0x533c99[_0x4399c(0x18b)],'createdAt':_0x533c99[_0x4399c(0x13b)]};}async['suspendUser'](_0xf2766e){const _0x2c8831=a35_0x1d8a18,_0x2b848c=await database_1[_0x2c8831(0x15d)][_0x2c8831(0x11e)]['update']({'where':{'id':_0xf2766e},'data':{'status':_0x2c8831(0x186)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2b848c['id'],'fullName':_0x2b848c[_0x2c8831(0x170)],'username':_0x2b848c[_0x2c8831(0x133)],'telegramId':_0x2b848c[_0x2c8831(0xd1)],'merchantUrl':_0x2b848c[_0x2c8831(0x14d)],'gateways':_0x2b848c['paymentGateways']?JSON[_0x2c8831(0x13a)](_0x2b848c['paymentGateways']):null,'gatewaySettings':_0x2b848c['gatewaySettings']?JSON[_0x2c8831(0x13a)](_0x2b848c['gatewaySettings']):null,'publicKey':_0x2b848c[_0x2c8831(0xc1)],'wallets':{'usdtPolygonWallet':_0x2b848c['usdtPolygonWallet'],'usdtTrcWallet':_0x2b848c[_0x2c8831(0x18e)],'usdtErcWallet':_0x2b848c['usdtErcWallet'],'usdcPolygonWallet':_0x2b848c[_0x2c8831(0xa3)]},'status':_0x2b848c['status'],'createdAt':_0x2b848c[_0x2c8831(0x13b)]};}async[a35_0x1d8a18(0x181)](_0x521db7){const _0x1d5815=a35_0x1d8a18,_0x6082c5=await database_1[_0x1d5815(0x15d)][_0x1d5815(0x11e)]['update']({'where':{'id':_0x521db7},'data':{'status':_0x1d5815(0x160)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x6082c5['id'],'fullName':_0x6082c5[_0x1d5815(0x170)],'username':_0x6082c5[_0x1d5815(0x133)],'telegramId':_0x6082c5['telegram'],'merchantUrl':_0x6082c5[_0x1d5815(0x14d)],'gateways':_0x6082c5[_0x1d5815(0xe2)]?JSON['parse'](_0x6082c5['paymentGateways']):null,'gatewaySettings':_0x6082c5['gatewaySettings']?JSON['parse'](_0x6082c5[_0x1d5815(0xfa)]):null,'publicKey':_0x6082c5['publicKey'],'wallets':{'usdtPolygonWallet':_0x6082c5[_0x1d5815(0x195)],'usdtTrcWallet':_0x6082c5[_0x1d5815(0x18e)],'usdtErcWallet':_0x6082c5[_0x1d5815(0x112)],'usdcPolygonWallet':_0x6082c5[_0x1d5815(0xa3)]},'status':_0x6082c5[_0x1d5815(0x18b)],'createdAt':_0x6082c5[_0x1d5815(0x13b)]};}async[a35_0x1d8a18(0xbb)](_0x3a16c1){const _0xb56d7e=a35_0x1d8a18,{page:_0x5438e9,limit:_0xa98fa9,status:_0x5395bc}=_0x3a16c1,_0x1ccd3d=(_0x5438e9-0x1)*_0xa98fa9,_0x333b0f={};_0x5395bc&&(_0x333b0f[_0xb56d7e(0x18b)]=_0x5395bc[_0xb56d7e(0x183)]());const [_0x4b5133,_0x43bf9d]=await Promise[_0xb56d7e(0x191)]([database_1['default'][_0xb56d7e(0x11e)]['findMany']({'where':_0x333b0f,'skip':_0x1ccd3d,'take':_0xa98fa9,'orderBy':{'createdAt':_0xb56d7e(0xdb)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0xb56d7e(0x15d)]['shop'][_0xb56d7e(0xd6)]({'where':_0x333b0f})]);return{'users':_0x4b5133[_0xb56d7e(0x118)](_0x1ed014=>({'id':_0x1ed014['id'],'fullName':_0x1ed014[_0xb56d7e(0x170)],'username':_0x1ed014[_0xb56d7e(0x133)],'telegramId':_0x1ed014[_0xb56d7e(0xd1)],'merchantUrl':_0x1ed014[_0xb56d7e(0x14d)],'gateways':_0x1ed014[_0xb56d7e(0xe2)]?JSON[_0xb56d7e(0x13a)](_0x1ed014['paymentGateways']):null,'gatewaySettings':_0x1ed014['gatewaySettings']?JSON['parse'](_0x1ed014[_0xb56d7e(0xfa)]):null,'publicKey':_0x1ed014['publicKey'],'wallets':{'usdtPolygonWallet':_0x1ed014[_0xb56d7e(0x195)],'usdtTrcWallet':_0x1ed014['usdtTrcWallet'],'usdtErcWallet':_0x1ed014[_0xb56d7e(0x112)],'usdcPolygonWallet':_0x1ed014[_0xb56d7e(0xa3)]},'status':_0x1ed014[_0xb56d7e(0x18b)],'createdAt':_0x1ed014['createdAt']})),'pagination':{'page':_0x5438e9,'limit':_0xa98fa9,'total':_0x43bf9d,'totalPages':Math[_0xb56d7e(0x10f)](_0x43bf9d/_0xa98fa9)}};}async[a35_0x1d8a18(0x109)](_0x3cd45){const _0x36efd2=a35_0x1d8a18,_0x3cbd62=await database_1['default']['shop'][_0x36efd2(0x162)]({'where':{'id':_0x3cd45},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x3cbd62)return null;return{'id':_0x3cbd62['id'],'fullName':_0x3cbd62[_0x36efd2(0x170)],'username':_0x3cbd62[_0x36efd2(0x133)],'telegramId':_0x3cbd62[_0x36efd2(0xd1)],'merchantUrl':_0x3cbd62[_0x36efd2(0x14d)],'gateways':_0x3cbd62[_0x36efd2(0xe2)]?JSON[_0x36efd2(0x13a)](_0x3cbd62[_0x36efd2(0xe2)]):null,'gatewaySettings':_0x3cbd62['gatewaySettings']?JSON[_0x36efd2(0x13a)](_0x3cbd62['gatewaySettings']):null,'publicKey':_0x3cbd62[_0x36efd2(0xc1)],'wallets':{'usdtPolygonWallet':_0x3cbd62['usdtPolygonWallet'],'usdtTrcWallet':_0x3cbd62[_0x36efd2(0x18e)],'usdtErcWallet':_0x3cbd62[_0x36efd2(0x112)],'usdcPolygonWallet':_0x3cbd62[_0x36efd2(0xa3)]},'status':_0x3cbd62[_0x36efd2(0x18b)],'createdAt':_0x3cbd62['createdAt']};}async[a35_0x1d8a18(0x17d)](_0x1315af){const _0x311bb8=a35_0x1d8a18,{fullName:_0x41cd82,username:_0x2882e5,password:_0x170405,telegramId:_0x5abc7c,merchantUrl:_0x45735c,gateways:_0x216c68,gatewaySettings:_0x143901,wallets:_0x4634b9}=_0x1315af,_0x32762b=await database_1['default'][_0x311bb8(0x11e)][_0x311bb8(0x162)]({'where':{'username':_0x2882e5}});if(_0x32762b)throw new Error(_0x311bb8(0x12f));if(_0x5abc7c){const _0x4bb191=await database_1[_0x311bb8(0x15d)][_0x311bb8(0x11e)][_0x311bb8(0x162)]({'where':{'telegram':_0x5abc7c}});if(_0x4bb191)throw new Error('Telegram\x20username\x20already\x20exists');}const _0xa6e355=await bcryptjs_1[_0x311bb8(0x15d)][_0x311bb8(0x150)](_0x170405,0xc),_0x242593=_0x311bb8(0x9b)+crypto_1['default']['randomBytes'](0x20)[_0x311bb8(0xc2)](_0x311bb8(0x99)),_0x2d208d=_0x311bb8(0xa5)+crypto_1[_0x311bb8(0x15d)][_0x311bb8(0x144)](0x20)[_0x311bb8(0xc2)](_0x311bb8(0x99)),_0x5b762d=await database_1[_0x311bb8(0x15d)][_0x311bb8(0x11e)][_0x311bb8(0xfd)]({'data':{'name':_0x41cd82,'username':_0x2882e5,'password':_0xa6e355,'telegram':_0x5abc7c,'shopUrl':_0x45735c,'paymentGateways':_0x216c68?JSON['stringify'](_0x216c68):null,'gatewaySettings':_0x143901?JSON[_0x311bb8(0x11a)](_0x143901):null,'usdtPolygonWallet':_0x4634b9?.[_0x311bb8(0x195)]||null,'usdtTrcWallet':_0x4634b9?.['usdtTrcWallet']||null,'usdtErcWallet':_0x4634b9?.[_0x311bb8(0x112)]||null,'usdcPolygonWallet':_0x4634b9?.['usdcPolygonWallet']||null,'publicKey':_0x242593,'secretKey':_0x2d208d,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x5b762d['id'],'fullName':_0x5b762d[_0x311bb8(0x170)],'username':_0x5b762d[_0x311bb8(0x133)],'telegramId':_0x5b762d[_0x311bb8(0xd1)],'merchantUrl':_0x5b762d[_0x311bb8(0x14d)],'gateways':_0x5b762d['paymentGateways']?JSON['parse'](_0x5b762d[_0x311bb8(0xe2)]):null,'gatewaySettings':_0x5b762d[_0x311bb8(0xfa)]?JSON['parse'](_0x5b762d[_0x311bb8(0xfa)]):null,'publicKey':_0x5b762d[_0x311bb8(0xc1)],'wallets':{'usdtPolygonWallet':_0x5b762d[_0x311bb8(0x195)],'usdtTrcWallet':_0x5b762d[_0x311bb8(0x18e)],'usdtErcWallet':_0x5b762d[_0x311bb8(0x112)],'usdcPolygonWallet':_0x5b762d['usdcPolygonWallet']},'status':_0x5b762d['status'],'createdAt':_0x5b762d['createdAt']};}async[a35_0x1d8a18(0x8c)](_0x53f64b){const _0xf4ede6=a35_0x1d8a18;await database_1[_0xf4ede6(0x15d)]['shop']['delete']({'where':{'id':_0x53f64b}});}async[a35_0x1d8a18(0xe4)](_0x18c3a6){const _0x2856b3=a35_0x1d8a18,_0x1d428a={};_0x18c3a6&&['ACTIVE',_0x2856b3(0xb3),_0x2856b3(0x186)][_0x2856b3(0x14f)](_0x18c3a6['toUpperCase']())&&(_0x1d428a['status']=_0x18c3a6[_0x2856b3(0x183)]());const _0x1171a5=await database_1['default']['shop'][_0x2856b3(0x13f)]({'where':_0x1d428a,'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x2856b3(0x126)}});return _0x1171a5;}}exports[a35_0x1d8a18(0x159)]=AdminService;