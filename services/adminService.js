'use strict';const a35_0xf3374=a35_0xdc5c;(function(_0x2b6656,_0x2d3d79){const _0x1ffa66=a35_0xdc5c,_0x3b1cab=_0x2b6656();while(!![]){try{const _0x2d39c1=parseInt(_0x1ffa66(0x198))/0x1*(-parseInt(_0x1ffa66(0x240))/0x2)+-parseInt(_0x1ffa66(0x15f))/0x3+-parseInt(_0x1ffa66(0x200))/0x4+-parseInt(_0x1ffa66(0x179))/0x5+parseInt(_0x1ffa66(0x1c8))/0x6+parseInt(_0x1ffa66(0x167))/0x7*(-parseInt(_0x1ffa66(0x23c))/0x8)+parseInt(_0x1ffa66(0x21b))/0x9;if(_0x2d39c1===_0x2d3d79)break;else _0x3b1cab['push'](_0x3b1cab['shift']());}catch(_0x22ee01){_0x3b1cab['push'](_0x3b1cab['shift']());}}}(a35_0x1b73,0x98399));var __importDefault=this&&this[a35_0xf3374(0x1b4)]||function(_0x458d9e){const _0x14bdfb=a35_0xf3374;return _0x458d9e&&_0x458d9e[_0x14bdfb(0x1db)]?_0x458d9e:{'default':_0x458d9e};};function a35_0xdc5c(_0x53b9a4,_0x470341){const _0x1b738e=a35_0x1b73();return a35_0xdc5c=function(_0xdc5c4d,_0x3df435){_0xdc5c4d=_0xdc5c4d-0x144;let _0x42749d=_0x1b738e[_0xdc5c4d];return _0x42749d;},a35_0xdc5c(_0x53b9a4,_0x470341);}Object[a35_0xf3374(0x186)](exports,a35_0xf3374(0x1db),{'value':!![]}),exports[a35_0xf3374(0x189)]=void 0x0;const database_1=__importDefault(require(a35_0xf3374(0x163))),bcryptjs_1=__importDefault(require(a35_0xf3374(0x187))),crypto_1=__importDefault(require('crypto')),currencyService_1=require(a35_0xf3374(0x235));function a35_0x1b73(){const _0x23d6c5=['üí∞\x20Payment\x20','getGatewayDisplayName','PAID','\x20\x20\x20Balance:\x20','adminNotes','üìä\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','\x20\x20\x20Successful\x20payments:\x20','date','shopUrl','all','1BwRTof','Insufficient\x20balance.\x20Available:\x20','status','\x20\x20\x20üí∞\x20Total\x20turnover:\x20','üí∞\x20Creating\x20payout\x20for\x20shop\x20','_count','get','üí∞\x20[DAILY]\x20Added\x20','getTime','customerCountry','paymentGateways','Username\x20already\x20exists','averageCommissionRate','gateway','\x20balance\x20updated:\x20','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','commissionUSDT','periodFrom','toISOString','Error\x20processing\x20payment\x20','COMPLETED','üí∞\x20Shop\x20','totalPaidOut','ACTIVE','findUnique','\x20USDT\x20(total\x20paid\x20to\x20merchants)','getFullYear','generateDailyStatistics','__importDefault','\x20->\x20','\x20to\x20','merchantUrl','updateCustomerData','\x20\x20\x20üìä\x20Total\x20payments:\x20','\x20merchants,\x20','findMany','split','groupBy','\x20total','paymentsCount','üí∞\x20Found\x20','üìä\x20Calculating\x20payout\x20statistics...','period','customerName','\x20\x20\x20Failed\x20to\x20parse\x20gatewaySettings:\x20','set','create','getDate','3935070zSuSHF','getAllPayouts','commission','totalPayout','Shop\x20not\x20found','paidOutUSDT','\x20\x20\x20‚úÖ\x20Successful\x20payments:\x20','dateFrom','üìä\x20Payout\x20statistics\x20calculated:','\x20USDT\x20(-','values','gatewayEarnings','Noda','\x20\x20\x20Total\x20payments:\x20','üîÑ\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','admin','dailyRevenue','\x20USDT\x20for\x20payment\x20on\x20','Test\x20Gateway','__esModule','Rapyd','\x20for\x20shop\x20','\x20for\x20payment\x20on\x20','getMerchantsAwaitingPayout','string','password','thisMonth','getSystemStatistics','year','txid','test_gateway','getUserById','getMerchantStatistics','\x20balance\x20updated:','2020-01-01','\x20USDT\x20total','\x20USDT\x20(same\x20as\x20awaiting)','\x20\x20\x20üìÖ\x20This\x20month:\x20','üìÖ\x20Period:\x20','Plisio','KLYME\x20GB','\x20USDT\x20to\x20balance','warn','sort','toString','\x20USDT\x20(+','custom','telegramId','turnover','toLowerCase','findFirst','getMerchantsSelection','updatePaymentStatus','merchantEarnings','not\x20set','setDate','957908egzvoB','customerEmail','null','desc','push','shopId','gateways','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','customerUa','customerIp','round','getPayoutById','awaitingPayout','üìä\x20Total\x20payments\x20(all\x20statuses):\x20','90d','shop','\x20\x20\x20Name:\x20','notes','successfulPayments','parse','gatewayOrderId','activateUser','delete','\x20\x20\x20üñ•Ô∏è\x20User\x20Agent:\x20','hash','üí±\x20[DAILY]\x20Converted\x20','periodTo','26202456xupTOP','30d','balance','publicKey','CoinToPay','üí∞\x20Current\x20shop\x20balance:\x20','CHARGEBACK','\x20PAID\x20payments\x20out\x20of\x20','successUrl','\x20\x20\x20Username:\x20','gte','KLYME\x20EU','includes','fullName','network','üìä\x20Getting\x20merchant\x20statistics\x20with\x20filters:','forEach','externalPaymentUrl','\x20\x20\x20Total\x20paid\x20out:\x20','ceil','update','üìä\x20[DAILY]\x20Processed\x20','\x20USDT\x20from\x20balance','paidAt','\x20became\x20PAID:\x20+','sk_','./currencyService','lte','\x20\x20\x20Parsed\x20gatewaySettings:','aggregate','randomBytes','_sum','totalPayments','648896dDcleT','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','whiteUrl','updatedAt','1807226sdHmhq','‚úÖ\x20Customer\x20data\x20updated\x20for\x20payment\x20','amountUSDT','gatewaySettings','amount','orderId','currencyService','\x20status:\x20','REFUND','convertToUSDT','map','username','\x20USDT\x20for\x20','length','\x20\x20\x20üåê\x20IP:\x20','not\x20found','updateUser','üìä\x20Payment\x20','revenue','\x20no\x20longer\x20PAID:\x20-','stringify','createPayout','payment','SUSPENDED','name','üìä\x20[ADMIN]\x20Status\x20breakdown:','reduce','createdAt','\x20commission\x20analysis:','telegram','deleteUser','toUpperCase','üìä\x20[ADMIN]\x20Period:\x20','error','\x20\x20\x20Conversion\x20rate:\x20','üîÑ\x20Updating\x20customer\x20data\x20for\x20payment\x20','usdtTrcWallet','insensitive','1159629vMGSsu','getMonth','üìä\x20Merchants\x20awaiting\x20payout:\x20','chargebackAmount','../config/database','payout','asc','availableBalance','49NSuZhp','\x20\x20\x20Commission\x20from\x20settings:\x20','\x20USDT','usdcPolygonWallet','currency','failureMessage','totalCommissionRate','Telegram\x20username\x20already\x20exists','count','usdtErcWallet','üìä\x20Merchant\x20statistics\x20calculated:','\x20\x20\x20Payout\x20amount:\x20','‚ö†Ô∏è\x20[DAILY]\x20Failed\x20to\x20convert\x20','getPaymentById','log','deletePayout','turnoverUSDT','week','4231495uDtGew','\x20\x20\x20üí∞\x20Total\x20payout:\x20','\x20USDT\x20(','\x20(direct\x20amountUSDT)','\x20\x20\x20Current\x20balance:\x20','merchantEarningsUSDT','hex','‚úÖ\x20Payout\x20created:\x20','getAllUsers','\x20payments\x20for\x20daily\x20statistics','month','default','wallets','defineProperty','bcryptjs','totalTurnover','AdminService','dateTo','Payment\x20not\x20found','usdtPolygonWallet','toFixed'];a35_0x1b73=function(){return _0x23d6c5;};return a35_0x1b73();}class AdminService{async['getPayoutStats'](){const _0x9a2dcb=a35_0xf3374;console[_0x9a2dcb(0x175)](_0x9a2dcb(0x1c1));const _0x4fa49a=await database_1['default'][_0x9a2dcb(0x20f)][_0x9a2dcb(0x238)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x9a2dcb(0x1af)}}),_0x11763b=new Date(),_0x27ae77=new Date(_0x11763b[_0x9a2dcb(0x1b2)](),_0x11763b['getMonth'](),0x1),_0x36cfda=new Date(_0x11763b[_0x9a2dcb(0x1b2)](),_0x11763b[_0x9a2dcb(0x160)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x1502a9=await database_1[_0x9a2dcb(0x184)][_0x9a2dcb(0x164)][_0x9a2dcb(0x238)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x27ae77,'lte':_0x36cfda},'status':'COMPLETED'}}),_0x49188b=_0x4fa49a[_0x9a2dcb(0x23a)][_0x9a2dcb(0x1ae)]||0x0,_0x395b5a=_0x4fa49a[_0x9a2dcb(0x23a)][_0x9a2dcb(0x21d)]||0x0,_0x46df50=_0x1502a9[_0x9a2dcb(0x23a)][_0x9a2dcb(0x244)]||0x0,_0x1a3d32={'totalPayout':Math[_0x9a2dcb(0x20a)](_0x49188b*0x64)/0x64,'awaitingPayout':Math[_0x9a2dcb(0x20a)](_0x395b5a*0x64)/0x64,'thisMonth':Math[_0x9a2dcb(0x20a)](_0x46df50*0x64)/0x64,'availableBalance':Math[_0x9a2dcb(0x20a)](_0x395b5a*0x64)/0x64};return console['log'](_0x9a2dcb(0x1d0)),console[_0x9a2dcb(0x175)](_0x9a2dcb(0x17a)+_0x1a3d32[_0x9a2dcb(0x1cb)]+_0x9a2dcb(0x1b1)),console[_0x9a2dcb(0x175)](_0x9a2dcb(0x1a7)+_0x1a3d32[_0x9a2dcb(0x20c)]+'\x20USDT\x20(total\x20merchant\x20balances)'),console['log']('\x20\x20\x20üíµ\x20Available\x20balance:\x20'+_0x1a3d32[_0x9a2dcb(0x166)]+_0x9a2dcb(0x1ec)),console[_0x9a2dcb(0x175)](_0x9a2dcb(0x1ed)+_0x1a3d32[_0x9a2dcb(0x1e2)]+_0x9a2dcb(0x169)),_0x1a3d32;}async[a35_0xf3374(0x1b8)](_0x53f495,_0x43273d){const _0x24441e=a35_0xf3374;console[_0x24441e(0x175)](_0x24441e(0x15c)+_0x53f495+':',_0x43273d);const _0x465c14=await database_1['default'][_0x24441e(0x14f)]['findUnique']({'where':{'id':_0x53f495},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x465c14)throw new Error('Payment\x20not\x20found');const _0x5a796c={};_0x43273d['customerCountry']!==undefined&&(_0x5a796c[_0x24441e(0x1a1)]=_0x43273d[_0x24441e(0x1a1)]||null);_0x43273d['customerIp']!==undefined&&(_0x5a796c[_0x24441e(0x209)]=_0x43273d[_0x24441e(0x209)]||null);_0x43273d[_0x24441e(0x208)]!==undefined&&(_0x5a796c[_0x24441e(0x208)]=_0x43273d[_0x24441e(0x208)]||null);const _0x210ff1=await database_1[_0x24441e(0x184)][_0x24441e(0x14f)]['update']({'where':{'id':_0x53f495},'data':{..._0x5a796c,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x24441e(0x175)](_0x24441e(0x241)+_0x53f495),console['log']('\x20\x20\x20üåç\x20Country:\x20'+_0x465c14['customerCountry']+_0x24441e(0x1b5)+_0x210ff1[_0x24441e(0x1a1)]),console['log'](_0x24441e(0x147)+_0x465c14[_0x24441e(0x209)]+_0x24441e(0x1b5)+_0x210ff1[_0x24441e(0x209)]),console[_0x24441e(0x175)](_0x24441e(0x217)+(_0x465c14[_0x24441e(0x208)]?_0x24441e(0x1c5):_0x24441e(0x1fe))+_0x24441e(0x1b5)+(_0x210ff1['customerUa']?_0x24441e(0x1c5):_0x24441e(0x1fe))),_0x210ff1;}async[a35_0xf3374(0x1e3)](_0x3bc5e0){const _0x5e55c2=a35_0xf3374,_0x30d653=new Date();let _0xcfb231;switch(_0x3bc5e0){case'7d':_0xcfb231=new Date(_0x30d653[_0x5e55c2(0x1a0)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x5e55c2(0x21c):_0xcfb231=new Date(_0x30d653[_0x5e55c2(0x1a0)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x5e55c2(0x20e):_0xcfb231=new Date(_0x30d653[_0x5e55c2(0x1a0)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0xcfb231=new Date(_0x30d653[_0x5e55c2(0x1a0)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x95b48f,_0x463ece,_0x3aeb76,_0x20910c,_0xf73302,_0x493ea9,_0x2d6a25]=await Promise[_0x5e55c2(0x197)]([database_1['default'][_0x5e55c2(0x20f)][_0x5e55c2(0x16f)](),database_1[_0x5e55c2(0x184)][_0x5e55c2(0x20f)][_0x5e55c2(0x16f)]({'where':{'status':_0x5e55c2(0x1af)}}),database_1['default']['payment']['count']({'where':{'createdAt':{'gte':_0xcfb231},'gateway':{'not':_0x5e55c2(0x1e6)}}}),database_1[_0x5e55c2(0x184)][_0x5e55c2(0x14f)]['count']({'where':{'status':_0x5e55c2(0x190),'createdAt':{'gte':_0xcfb231},'gateway':{'not':'test_gateway'}}}),database_1[_0x5e55c2(0x184)][_0x5e55c2(0x14f)][_0x5e55c2(0x1bb)]({'where':{'status':_0x5e55c2(0x190),'createdAt':{'gte':_0xcfb231},'gateway':{'not':_0x5e55c2(0x1e6)}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x5e55c2(0x184)][_0x5e55c2(0x14f)]['findMany']({'where':{'gateway':{'not':'test_gateway'}},'take':0xa,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x5e55c2(0x14f)][_0x5e55c2(0x1bb)]({'where':{'createdAt':{'gte':_0xcfb231},'gateway':{'not':_0x5e55c2(0x1e6)}},'select':{'status':!![],'amountUSDT':!![],'amount':!![],'currency':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x5e55c2(0x165)}})]);let _0x3ff5c6=0x0;for(const _0x5d2b83 of _0xf73302){if(_0x5d2b83[_0x5e55c2(0x242)])_0x3ff5c6+=_0x5d2b83[_0x5e55c2(0x242)];else{const _0x3354b6=await currencyService_1['currencyService'][_0x5e55c2(0x249)](_0x5d2b83['amount'],_0x5d2b83[_0x5e55c2(0x16b)]);_0x3ff5c6+=_0x3354b6;}}console[_0x5e55c2(0x175)]('üìä\x20[ADMIN]\x20Processing\x20'+_0x2d6a25[_0x5e55c2(0x146)]+_0x5e55c2(0x182)),console['log'](_0x5e55c2(0x159)+_0xcfb231[_0x5e55c2(0x1aa)]()[_0x5e55c2(0x1bc)]('T')[0x0]+_0x5e55c2(0x1b6)+_0x30d653['toISOString']()[_0x5e55c2(0x1bc)]('T')[0x0]);const _0x110c11=_0x2d6a25[_0x5e55c2(0x153)]((_0x1792f3,_0x39d891)=>{const _0x210871=_0x5e55c2;return _0x1792f3[_0x39d891[_0x210871(0x19a)]]=(_0x1792f3[_0x39d891[_0x210871(0x19a)]]||0x0)+0x1,_0x1792f3;},{});console['log'](_0x5e55c2(0x152),_0x110c11);const _0x304c28=await this[_0x5e55c2(0x1b3)](_0x2d6a25,_0xcfb231,_0x30d653),_0x18745a=_0x3aeb76>0x0?_0x20910c/_0x3aeb76*0x64:0x0;return{'totalShops':_0x95b48f,'activeShops':_0x463ece,'totalPayments':_0x3aeb76,'successfulPayments':_0x20910c,'totalRevenue':Math[_0x5e55c2(0x20a)](_0x3ff5c6*0x64)/0x64,'conversionRate':Math[_0x5e55c2(0x20a)](_0x18745a*0x64)/0x64,'dailyRevenue':_0x304c28[_0x5e55c2(0x1d8)],'dailyPayments':_0x304c28['dailyPayments'],'recentPayments':_0x493ea9[_0x5e55c2(0x24a)](_0x54d738=>({'id':_0x54d738['id'],'amount':_0x54d738['amount'],'currency':_0x54d738[_0x5e55c2(0x16b)],'status':_0x54d738[_0x5e55c2(0x19a)],'gateway':_0x54d738[_0x5e55c2(0x1a5)],'shop':_0x54d738[_0x5e55c2(0x20f)],'createdAt':_0x54d738['createdAt']}))};}async['generateDailyStatistics'](_0x32aded,_0x117e37,_0x248840){const _0x2fdb23=a35_0xf3374,_0x4c7622=new Map(),_0x38db15=new Date(_0x117e37);while(_0x38db15<=_0x248840){const _0x5eba3d=_0x38db15['toISOString']()[_0x2fdb23(0x1bc)]('T')[0x0];_0x4c7622[_0x2fdb23(0x1c5)](_0x5eba3d,{'revenue':0x0,'count':0x0}),_0x38db15[_0x2fdb23(0x1ff)](_0x38db15[_0x2fdb23(0x1c7)]()+0x1);}let _0x427c35=0x0,_0x4a29ef=0x0;for(const _0x12516c of _0x32aded){const _0x17052a=_0x12516c[_0x2fdb23(0x154)][_0x2fdb23(0x1aa)]()[_0x2fdb23(0x1bc)]('T')[0x0],_0x13e123=_0x4c7622[_0x2fdb23(0x19e)](_0x17052a);if(_0x13e123){_0x13e123['count']+=0x1;if(_0x12516c[_0x2fdb23(0x19a)]==='PAID'){_0x427c35++;if(_0x12516c[_0x2fdb23(0x242)])_0x13e123[_0x2fdb23(0x14b)]+=_0x12516c['amountUSDT'],_0x4a29ef+=_0x12516c[_0x2fdb23(0x242)],console[_0x2fdb23(0x175)](_0x2fdb23(0x19f)+_0x12516c[_0x2fdb23(0x242)]+_0x2fdb23(0x145)+_0x17052a+_0x2fdb23(0x17c));else try{const _0x2adf36=await currencyService_1[_0x2fdb23(0x246)]['convertToUSDT'](_0x12516c['amount'],_0x12516c[_0x2fdb23(0x16b)]);_0x13e123[_0x2fdb23(0x14b)]+=_0x2adf36,_0x4a29ef+=_0x2adf36,console[_0x2fdb23(0x175)](_0x2fdb23(0x219)+_0x12516c['amount']+'\x20'+_0x12516c[_0x2fdb23(0x16b)]+'\x20to\x20'+_0x2adf36+_0x2fdb23(0x1d9)+_0x17052a);}catch(_0x16eff7){console[_0x2fdb23(0x1f2)](_0x2fdb23(0x173)+_0x12516c[_0x2fdb23(0x244)]+'\x20'+_0x12516c['currency']+_0x2fdb23(0x1de)+_0x17052a+':',_0x16eff7);}}}}console[_0x2fdb23(0x175)](_0x2fdb23(0x230)+_0x427c35+_0x2fdb23(0x222)+_0x32aded[_0x2fdb23(0x146)]+_0x2fdb23(0x1be)),console[_0x2fdb23(0x175)]('üìä\x20[DAILY]\x20Total\x20revenue\x20processed:\x20'+_0x4a29ef+_0x2fdb23(0x169));const _0x53b59e=[],_0x254799=[];for(const [_0x9866a2,_0x593361]of _0x4c7622){_0x53b59e[_0x2fdb23(0x204)]({'date':_0x9866a2,'amount':Math['round'](_0x593361[_0x2fdb23(0x14b)]*0x64)/0x64}),_0x254799[_0x2fdb23(0x204)]({'date':_0x9866a2,'count':_0x593361[_0x2fdb23(0x16f)]});}return{'dailyRevenue':_0x53b59e,'dailyPayments':_0x254799};}async[a35_0xf3374(0x1e8)](_0x4f5763){const _0x56d33c=a35_0xf3374;console[_0x56d33c(0x175)](_0x56d33c(0x22a),_0x4f5763);let _0x3b5211,_0x32db24=new Date();if(_0x4f5763[_0x56d33c(0x1c2)]===_0x56d33c(0x1f6)&&_0x4f5763[_0x56d33c(0x1cf)]&&_0x4f5763['dateTo'])_0x3b5211=new Date(_0x4f5763['dateFrom']),_0x32db24=new Date(_0x4f5763[_0x56d33c(0x18a)]);else{const _0x329185=new Date();switch(_0x4f5763[_0x56d33c(0x1c2)]){case _0x56d33c(0x178):_0x3b5211=new Date(_0x329185[_0x56d33c(0x1a0)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x56d33c(0x183):_0x3b5211=new Date(_0x329185[_0x56d33c(0x1a0)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x56d33c(0x1e4):_0x3b5211=new Date(_0x329185[_0x56d33c(0x1a0)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case'all':default:_0x3b5211=new Date(_0x56d33c(0x1ea));break;}}console[_0x56d33c(0x175)](_0x56d33c(0x1ee)+_0x3b5211[_0x56d33c(0x1aa)]()+_0x56d33c(0x1b6)+_0x32db24[_0x56d33c(0x1aa)]());if(_0x4f5763[_0x56d33c(0x205)]){const _0x5ed94d=await database_1[_0x56d33c(0x184)][_0x56d33c(0x20f)][_0x56d33c(0x1b0)]({'where':{'id':_0x4f5763[_0x56d33c(0x205)]},'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}});console[_0x56d33c(0x175)]('üìä\x20Shop\x20info\x20for\x20'+_0x4f5763[_0x56d33c(0x205)]+':'),console[_0x56d33c(0x175)](_0x56d33c(0x210)+_0x5ed94d?.['name']),console[_0x56d33c(0x175)](_0x56d33c(0x224)+_0x5ed94d?.[_0x56d33c(0x144)]),console['log']('\x20\x20\x20Raw\x20gatewaySettings:\x20'+(_0x5ed94d?.[_0x56d33c(0x243)]||_0x56d33c(0x202)));if(_0x5ed94d?.[_0x56d33c(0x243)])try{const _0x33314a=JSON[_0x56d33c(0x213)](_0x5ed94d[_0x56d33c(0x243)]);console['log'](_0x56d33c(0x237),_0x33314a),console[_0x56d33c(0x175)]('\x20\x20\x20Commission\x20from\x20shop\x20settings:\x20'+(_0x33314a[_0x56d33c(0x1ca)]||'not\x20found'));}catch(_0x27489e){console[_0x56d33c(0x175)](_0x56d33c(0x1c4)+_0x27489e);}}const _0x1d7a41={'status':_0x56d33c(0x190),'gateway':{'not':_0x56d33c(0x1e6)},'paidAt':{'gte':_0x3b5211,'lte':_0x32db24}};_0x4f5763[_0x56d33c(0x205)]&&(_0x1d7a41['shopId']=_0x4f5763[_0x56d33c(0x205)]);const _0xbe7f3c=await database_1[_0x56d33c(0x184)][_0x56d33c(0x14f)][_0x56d33c(0x1bb)]({'where':_0x1d7a41,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console['log'](_0x56d33c(0x1c0)+_0xbe7f3c[_0x56d33c(0x146)]+'\x20paid\x20payments\x20for\x20analysis');const _0x3d5aae={'gateway':{'not':'test_gateway'},'createdAt':{'gte':_0x3b5211,'lte':_0x32db24}};_0x4f5763[_0x56d33c(0x205)]&&(_0x3d5aae['shopId']=_0x4f5763[_0x56d33c(0x205)]);const _0x4d1f44=await database_1[_0x56d33c(0x184)][_0x56d33c(0x14f)][_0x56d33c(0x16f)]({'where':_0x3d5aae});console[_0x56d33c(0x175)](_0x56d33c(0x20d)+_0x4d1f44),console['log']('‚úÖ\x20Successful\x20payments:\x20'+_0xbe7f3c[_0x56d33c(0x146)]);let _0x123f73=0x0,_0x4c7004=0x0,_0x51d662=0x0;const _0x17fac8={},_0x3d17ec={},_0x2f8675={};for(const _0x21031a of _0xbe7f3c){try{const _0x5de0cc=await currencyService_1[_0x56d33c(0x246)][_0x56d33c(0x249)](_0x21031a['amount'],_0x21031a['currency']);let _0x2f4649={};if(_0x21031a[_0x56d33c(0x20f)][_0x56d33c(0x243)])try{_0x2f4649=JSON['parse'](_0x21031a[_0x56d33c(0x20f)][_0x56d33c(0x243)]);}catch(_0x554f4c){console[_0x56d33c(0x15a)](_0x56d33c(0x207)+_0x21031a[_0x56d33c(0x205)]+':',_0x554f4c);}const _0x561f07=_0x2f4649[_0x56d33c(0x1ca)]||0xa;console[_0x56d33c(0x175)](_0x56d33c(0x14a)+_0x21031a['id']+_0x56d33c(0x155)),console[_0x56d33c(0x175)]('\x20\x20\x20Shop:\x20'+_0x21031a[_0x56d33c(0x20f)][_0x56d33c(0x151)]+'\x20('+_0x21031a[_0x56d33c(0x205)]+')'),console[_0x56d33c(0x175)]('\x20\x20\x20Gateway:\x20'+_0x21031a['gateway']),console[_0x56d33c(0x175)]('\x20\x20\x20Raw\x20gatewaySettings:\x20'+(_0x21031a[_0x56d33c(0x20f)][_0x56d33c(0x243)]||_0x56d33c(0x202))),console['log']('\x20\x20\x20Parsed\x20gatewaySettings:',_0x2f4649),console[_0x56d33c(0x175)](_0x56d33c(0x168)+(_0x2f4649[_0x56d33c(0x1ca)]||_0x56d33c(0x148))),console[_0x56d33c(0x175)]('\x20\x20\x20Final\x20commission\x20used:\x20'+_0x561f07+'%');const _0x5baf83=_0x5de0cc*(_0x561f07/0x64),_0xbc683c=_0x5de0cc-_0x5baf83;_0x123f73+=_0x5de0cc,_0x4c7004+=_0xbc683c,_0x51d662+=_0x5baf83;!_0x17fac8[_0x21031a[_0x56d33c(0x1a5)]]&&(_0x17fac8[_0x21031a[_0x56d33c(0x1a5)]]={'gateway':_0x21031a[_0x56d33c(0x1a5)],'gatewayDisplayName':this[_0x56d33c(0x18f)](_0x21031a[_0x56d33c(0x1a5)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x17fac8[_0x21031a[_0x56d33c(0x1a5)]][_0x56d33c(0x1bf)]++,_0x17fac8[_0x21031a['gateway']][_0x56d33c(0x177)]+=_0x5de0cc,_0x17fac8[_0x21031a[_0x56d33c(0x1a5)]]['commissionUSDT']+=_0x5baf83,_0x17fac8[_0x21031a['gateway']]['merchantEarningsUSDT']+=_0xbc683c,_0x17fac8[_0x21031a['gateway']][_0x56d33c(0x16d)]+=_0x561f07;!_0x4f5763[_0x56d33c(0x205)]&&(!_0x3d17ec[_0x21031a[_0x56d33c(0x205)]]&&(_0x3d17ec[_0x21031a[_0x56d33c(0x205)]]={'shopId':_0x21031a[_0x56d33c(0x205)],'shopName':_0x21031a['shop'][_0x56d33c(0x151)],'shopUsername':_0x21031a[_0x56d33c(0x20f)]['username'],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x3d17ec[_0x21031a[_0x56d33c(0x205)]][_0x56d33c(0x1bf)]++,_0x3d17ec[_0x21031a[_0x56d33c(0x205)]][_0x56d33c(0x177)]+=_0x5de0cc,_0x3d17ec[_0x21031a[_0x56d33c(0x205)]][_0x56d33c(0x1a8)]+=_0x5baf83,_0x3d17ec[_0x21031a[_0x56d33c(0x205)]]['merchantEarningsUSDT']+=_0xbc683c);const _0x4bb4d1=_0x21031a['paidAt'][_0x56d33c(0x1aa)]()[_0x56d33c(0x1bc)]('T')[0x0];!_0x2f8675[_0x4bb4d1]&&(_0x2f8675[_0x4bb4d1]={'date':_0x4bb4d1,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x2f8675[_0x4bb4d1][_0x56d33c(0x1f8)]+=_0x5de0cc,_0x2f8675[_0x4bb4d1][_0x56d33c(0x1fd)]+=_0xbc683c,_0x2f8675[_0x4bb4d1]['gatewayEarnings']+=_0x5baf83,_0x2f8675[_0x4bb4d1][_0x56d33c(0x1bf)]++;}catch(_0x550f90){console[_0x56d33c(0x15a)](_0x56d33c(0x1ab)+_0x21031a['id']+':',_0x550f90);}}Object[_0x56d33c(0x1d2)](_0x17fac8)[_0x56d33c(0x22b)](_0x1b106b=>{const _0x41d8a0=_0x56d33c;_0x1b106b[_0x41d8a0(0x1a4)]=_0x1b106b[_0x41d8a0(0x1bf)]>0x0?_0x1b106b[_0x41d8a0(0x16d)]/_0x1b106b[_0x41d8a0(0x1bf)]:0x0,delete _0x1b106b[_0x41d8a0(0x16d)];}),Object[_0x56d33c(0x1d2)](_0x3d17ec)[_0x56d33c(0x22b)](_0x2e0ce6=>{const _0x190253=_0x56d33c;_0x2e0ce6['averageCheckUSDT']=_0x2e0ce6[_0x190253(0x1bf)]>0x0?_0x2e0ce6['turnoverUSDT']/_0x2e0ce6[_0x190253(0x1bf)]:0x0;});let _0x4d372a=0x0;if(_0x4f5763[_0x56d33c(0x205)]){const _0x371a07=await database_1[_0x56d33c(0x184)][_0x56d33c(0x164)][_0x56d33c(0x1bb)]({'where':{'shopId':_0x4f5763[_0x56d33c(0x205)],'status':_0x56d33c(0x1ac),'createdAt':{'gte':_0x3b5211,'lte':_0x32db24}},'select':{'amount':!![]}});_0x4d372a=_0x371a07['reduce']((_0xf08748,_0x374e75)=>_0xf08748+_0x374e75[_0x56d33c(0x244)],0x0);}const _0x2cbe2e=_0x4d1f44,_0x24ba14=_0xbe7f3c[_0x56d33c(0x146)],_0x495acc=_0x24ba14>0x0?_0x123f73/_0x24ba14:0x0,_0x1c9a02=_0x2cbe2e>0x0?_0x24ba14/_0x2cbe2e*0x64:0x0;console['log']('üìä\x20Conversion\x20rate\x20calculation:'),console[_0x56d33c(0x175)](_0x56d33c(0x1d5)+_0x2cbe2e),console[_0x56d33c(0x175)](_0x56d33c(0x194)+_0x24ba14),console[_0x56d33c(0x175)](_0x56d33c(0x15b)+_0x1c9a02['toFixed'](0x2)+'%');const _0x48acad=Math[_0x56d33c(0x22e)]((_0x32db24[_0x56d33c(0x1a0)]()-_0x3b5211[_0x56d33c(0x1a0)]())/(0x3e8*0x3c*0x3c*0x18)),_0x154306={'totalTurnover':Math[_0x56d33c(0x20a)](_0x123f73*0x64)/0x64,'merchantEarnings':Math[_0x56d33c(0x20a)](_0x4c7004*0x64)/0x64,'gatewayEarnings':Math[_0x56d33c(0x20a)](_0x51d662*0x64)/0x64,'totalPaidOut':Math['round'](_0x4d372a*0x64)/0x64,'averageCheck':Math[_0x56d33c(0x20a)](_0x495acc*0x64)/0x64,'totalPayments':_0x2cbe2e,'successfulPayments':_0x24ba14,'conversionRate':Math[_0x56d33c(0x20a)](_0x1c9a02*0x64)/0x64,'gatewayBreakdown':Object[_0x56d33c(0x1d2)](_0x17fac8)[_0x56d33c(0x24a)](_0x432698=>({..._0x432698,'turnoverUSDT':Math[_0x56d33c(0x20a)](_0x432698[_0x56d33c(0x177)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x432698[_0x56d33c(0x1a8)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x56d33c(0x20a)](_0x432698[_0x56d33c(0x17e)]*0x64)/0x64,'averageCommissionRate':Math['round'](_0x432698[_0x56d33c(0x1a4)]*0x64)/0x64})),'merchantBreakdown':_0x4f5763[_0x56d33c(0x205)]?undefined:Object[_0x56d33c(0x1d2)](_0x3d17ec)[_0x56d33c(0x24a)](_0x9694ea=>({..._0x9694ea,'turnoverUSDT':Math[_0x56d33c(0x20a)](_0x9694ea[_0x56d33c(0x177)]*0x64)/0x64,'commissionUSDT':Math[_0x56d33c(0x20a)](_0x9694ea[_0x56d33c(0x1a8)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x56d33c(0x20a)](_0x9694ea[_0x56d33c(0x17e)]*0x64)/0x64,'paidOutUSDT':Math['round'](_0x9694ea[_0x56d33c(0x1cd)]*0x64)/0x64,'averageCheckUSDT':Math[_0x56d33c(0x20a)](_0x9694ea['averageCheckUSDT']*0x64)/0x64})),'dailyData':Object[_0x56d33c(0x1d2)](_0x2f8675)[_0x56d33c(0x24a)](_0x1e113f=>({..._0x1e113f,'turnover':Math[_0x56d33c(0x20a)](_0x1e113f[_0x56d33c(0x1f8)]*0x64)/0x64,'merchantEarnings':Math[_0x56d33c(0x20a)](_0x1e113f[_0x56d33c(0x1fd)]*0x64)/0x64,'gatewayEarnings':Math['round'](_0x1e113f[_0x56d33c(0x1d3)]*0x64)/0x64}))[_0x56d33c(0x1f3)]((_0x5e935a,_0xd1d17b)=>_0x5e935a[_0x56d33c(0x195)]['localeCompare'](_0xd1d17b[_0x56d33c(0x195)])),'periodInfo':{'from':_0x3b5211,'to':_0x32db24,'periodType':_0x4f5763[_0x56d33c(0x1c2)]||_0x56d33c(0x1f6),'daysCount':_0x48acad}};return console[_0x56d33c(0x175)](_0x56d33c(0x171)),console[_0x56d33c(0x175)](_0x56d33c(0x19b)+_0x154306[_0x56d33c(0x188)]+_0x56d33c(0x169)),console[_0x56d33c(0x175)]('\x20\x20\x20üë§\x20Merchant\x20earnings:\x20'+_0x154306[_0x56d33c(0x1fd)]+_0x56d33c(0x169)),console[_0x56d33c(0x175)]('\x20\x20\x20üè™\x20Gateway\x20earnings:\x20'+_0x154306[_0x56d33c(0x1d3)]+'\x20USDT'),console[_0x56d33c(0x175)](_0x56d33c(0x1b9)+_0x154306[_0x56d33c(0x23b)]),console[_0x56d33c(0x175)](_0x56d33c(0x1ce)+_0x154306[_0x56d33c(0x212)]),console[_0x56d33c(0x175)]('\x20\x20\x20üìà\x20Conversion\x20rate:\x20'+_0x154306['conversionRate']+'%'),_0x154306;}[a35_0xf3374(0x18f)](_0x40ddeb){const _0x1e4fa1=a35_0xf3374,_0x29fb96={'test_gateway':_0x1e4fa1(0x1da),'plisio':_0x1e4fa1(0x1ef),'rapyd':_0x1e4fa1(0x1dc),'noda':_0x1e4fa1(0x1d4),'cointopay':_0x1e4fa1(0x21f),'klyme_eu':_0x1e4fa1(0x226),'klyme_gb':_0x1e4fa1(0x1f0),'klyme_de':'KLYME\x20DE'};return _0x29fb96[_0x40ddeb]||_0x40ddeb;}async[a35_0xf3374(0x1df)](_0x33ce7c){const _0x184791=a35_0xf3374,{page:_0x16c5cd,limit:_0x227000,minAmount:_0x4985cd,search:_0x5df5ca}=_0x33ce7c,_0x1cb1cb=(_0x16c5cd-0x1)*_0x227000;console[_0x184791(0x175)](_0x184791(0x193),_0x33ce7c);const _0x47732e={'balance':{'gt':0x0},'status':'ACTIVE'};_0x4985cd&&(_0x47732e[_0x184791(0x21d)][_0x184791(0x225)]=_0x4985cd);_0x5df5ca&&(_0x47732e['OR']=[{'name':{'contains':_0x5df5ca,'mode':'insensitive'}},{'username':{'contains':_0x5df5ca,'mode':_0x184791(0x15e)}}]);const [_0x5c0d6d,_0x15cdca]=await Promise[_0x184791(0x197)]([database_1[_0x184791(0x184)][_0x184791(0x20f)][_0x184791(0x1bb)]({'where':_0x47732e,'skip':_0x1cb1cb,'take':_0x227000,'orderBy':{'balance':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'createdAt':!![]}}),database_1[_0x184791(0x184)][_0x184791(0x20f)]['count']({'where':_0x47732e})]);console[_0x184791(0x175)]('üí∞\x20Found\x20'+_0x5c0d6d[_0x184791(0x146)]+'\x20merchants\x20with\x20positive\x20balance');const _0x39962f=await Promise[_0x184791(0x197)](_0x5c0d6d[_0x184791(0x24a)](async _0x3583b1=>{const _0xa7bba6=_0x184791,[_0xeaed51,_0x3e5ba5,_0x186f2c]=await Promise[_0xa7bba6(0x197)]([database_1[_0xa7bba6(0x184)]['payment'][_0xa7bba6(0x16f)]({'where':{'shopId':_0x3583b1['id'],'status':_0xa7bba6(0x190),'amountUSDT':{'not':null}}}),database_1[_0xa7bba6(0x184)][_0xa7bba6(0x14f)][_0xa7bba6(0x1fa)]({'where':{'shopId':_0x3583b1['id'],'status':_0xa7bba6(0x190),'amountUSDT':{'not':null}},'orderBy':{'paidAt':_0xa7bba6(0x165)},'select':{'paidAt':!![]}}),database_1['default']['payment'][_0xa7bba6(0x1bd)]({'by':['gateway'],'where':{'shopId':_0x3583b1['id'],'status':_0xa7bba6(0x190),'amountUSDT':{'not':null}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x3703b0=_0x186f2c['map'](_0x4b234f=>({'gateway':_0x4b234f[_0xa7bba6(0x1a5)],'count':_0x4b234f[_0xa7bba6(0x19d)]['id'],'amountUSDT':_0x4b234f[_0xa7bba6(0x23a)][_0xa7bba6(0x242)]||0x0,'amountAfterCommissionUSDT':_0x4b234f['_sum'][_0xa7bba6(0x242)]||0x0,'commission':0x0}));return{'id':_0x3583b1['id'],'fullName':_0x3583b1[_0xa7bba6(0x151)],'username':_0x3583b1['username'],'telegramId':_0x3583b1['telegram'],'merchantUrl':_0x3583b1[_0xa7bba6(0x196)],'wallets':{'usdtPolygonWallet':_0x3583b1[_0xa7bba6(0x18c)],'usdtTrcWallet':_0x3583b1['usdtTrcWallet'],'usdtErcWallet':_0x3583b1[_0xa7bba6(0x170)],'usdcPolygonWallet':_0x3583b1[_0xa7bba6(0x16a)]},'totalAmountUSDT':_0x3583b1['balance'],'totalAmountAfterCommissionUSDT':_0x3583b1[_0xa7bba6(0x21d)],'paymentsCount':_0xeaed51,'oldestPaymentDate':_0x3e5ba5?.[_0xa7bba6(0x232)]||_0x3583b1[_0xa7bba6(0x154)],'gatewayBreakdown':_0x3703b0};})),_0x59fac0=_0x5c0d6d['reduce']((_0x42761d,_0x29061f)=>_0x42761d+_0x29061f[_0x184791(0x21d)],0x0),_0x1944e4=_0x59fac0;return console[_0x184791(0x175)](_0x184791(0x161)+_0x15cdca+_0x184791(0x1ba)+Math['round'](_0x1944e4*0x64)/0x64+_0x184791(0x1eb)),{'merchants':_0x39962f,'pagination':{'page':_0x16c5cd,'limit':_0x227000,'total':_0x15cdca,'totalPages':Math[_0x184791(0x22e)](_0x15cdca/_0x227000)},'summary':{'totalMerchants':_0x15cdca,'totalAmountUSDT':Math['round'](_0x59fac0*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x184791(0x20a)](_0x1944e4*0x64)/0x64}};}async[a35_0xf3374(0x14e)](_0x59a671){const _0xbde0b6=a35_0xf3374,{shopId:_0x1751fd,amount:_0x54859c,network:_0x56b912,notes:_0x3cceac,periodFrom:_0x506f55,periodTo:_0x5b22a4}=_0x59a671,_0x346914=await database_1[_0xbde0b6(0x184)]['$transaction'](async _0x22305e=>{const _0x25f889=_0xbde0b6,_0x1a6351=await _0x22305e[_0x25f889(0x20f)]['findUnique']({'where':{'id':_0x1751fd},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x1a6351)throw new Error(_0x25f889(0x1cc));console[_0x25f889(0x175)](_0x25f889(0x19c)+_0x1a6351[_0x25f889(0x144)]+':'),console['log'](_0x25f889(0x17d)+_0x1a6351[_0x25f889(0x21d)][_0x25f889(0x18d)](0x6)+_0x25f889(0x169)),console['log'](_0x25f889(0x172)+_0x54859c[_0x25f889(0x18d)](0x6)+_0x25f889(0x169)),console[_0x25f889(0x175)](_0x25f889(0x23d)+_0x1a6351[_0x25f889(0x1ae)]['toFixed'](0x6)+_0x25f889(0x169));if(_0x1a6351['balance']<_0x54859c)throw new Error(_0x25f889(0x199)+_0x1a6351[_0x25f889(0x21d)][_0x25f889(0x18d)](0x6)+'\x20USDT,\x20Requested:\x20'+_0x54859c[_0x25f889(0x18d)](0x6)+_0x25f889(0x169));const _0xf90b51=await _0x22305e[_0x25f889(0x164)]['create']({'data':{'shopId':_0x1751fd,'amount':_0x54859c,'network':_0x56b912,'status':_0x25f889(0x1ac),'notes':_0x3cceac,'periodFrom':_0x506f55?new Date(_0x506f55):null,'periodTo':_0x5b22a4?new Date(_0x5b22a4):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x192e20=_0x1a6351[_0x25f889(0x21d)]-_0x54859c,_0x1f8ac0=_0x1a6351['totalPaidOut']+_0x54859c;return await _0x22305e[_0x25f889(0x20f)][_0x25f889(0x22f)]({'where':{'id':_0x1751fd},'data':{'balance':_0x192e20,'totalPaidOut':_0x1f8ac0}}),console[_0x25f889(0x175)](_0x25f889(0x1ad)+_0x1a6351[_0x25f889(0x144)]+_0x25f889(0x1e9)),console['log'](_0x25f889(0x191)+_0x1a6351[_0x25f889(0x21d)]['toFixed'](0x6)+'\x20->\x20'+_0x192e20['toFixed'](0x6)+_0x25f889(0x1d1)+_0x54859c[_0x25f889(0x18d)](0x6)+')'),console[_0x25f889(0x175)](_0x25f889(0x22d)+_0x1a6351['totalPaidOut']['toFixed'](0x6)+'\x20->\x20'+_0x1f8ac0[_0x25f889(0x18d)](0x6)+_0x25f889(0x1f5)+_0x54859c[_0x25f889(0x18d)](0x6)+')'),{'payout':_0xf90b51,'shop':_0x1a6351};});return console[_0xbde0b6(0x175)](_0xbde0b6(0x180)+_0x346914[_0xbde0b6(0x164)]['id']+_0xbde0b6(0x1dd)+_0x346914[_0xbde0b6(0x20f)][_0xbde0b6(0x144)]+'\x20('+_0x54859c+'\x20USDT)'),{'id':_0x346914[_0xbde0b6(0x164)]['id'],'shopId':_0x346914['payout'][_0xbde0b6(0x205)],'shopName':_0x346914['shop'][_0xbde0b6(0x151)],'shopUsername':_0x346914[_0xbde0b6(0x20f)][_0xbde0b6(0x144)],'amount':_0x346914[_0xbde0b6(0x164)]['amount'],'network':_0x346914['payout']['network'],'status':_0x346914[_0xbde0b6(0x164)][_0xbde0b6(0x19a)],'txid':_0x346914[_0xbde0b6(0x164)][_0xbde0b6(0x1e5)],'notes':_0x346914['payout'][_0xbde0b6(0x211)],'periodFrom':_0x346914[_0xbde0b6(0x164)][_0xbde0b6(0x1a9)],'periodTo':_0x346914[_0xbde0b6(0x164)][_0xbde0b6(0x21a)],'createdAt':_0x346914[_0xbde0b6(0x164)][_0xbde0b6(0x154)],'paidAt':_0x346914[_0xbde0b6(0x164)]['paidAt']};}async[a35_0xf3374(0x1c9)](_0x58acef){const _0x456307=a35_0xf3374,{page:_0x19722b,limit:_0x13c223,shopId:_0x59fbda,network:_0x160804,dateFrom:_0x4ce9c3,dateTo:_0x655d1,search:_0x23e618}=_0x58acef,_0x11485b=(_0x19722b-0x1)*_0x13c223,_0x69be4b={};_0x59fbda&&(_0x69be4b[_0x456307(0x205)]=_0x59fbda);_0x160804&&(_0x69be4b[_0x456307(0x229)]=_0x160804);(_0x4ce9c3||_0x655d1)&&(_0x69be4b[_0x456307(0x154)]={},_0x4ce9c3&&(_0x69be4b['createdAt'][_0x456307(0x225)]=new Date(_0x4ce9c3)),_0x655d1&&(_0x69be4b['createdAt'][_0x456307(0x236)]=new Date(_0x655d1)));_0x23e618&&(_0x69be4b['OR']=[{'shop':{'name':{'contains':_0x23e618,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x23e618,'mode':'insensitive'}}},{'notes':{'contains':_0x23e618,'mode':_0x456307(0x15e)}}]);const [_0x4a1d94,_0x42b252]=await Promise[_0x456307(0x197)]([database_1[_0x456307(0x184)][_0x456307(0x164)]['findMany']({'where':_0x69be4b,'skip':_0x11485b,'take':_0x13c223,'orderBy':{'createdAt':_0x456307(0x203)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x456307(0x184)]['payout'][_0x456307(0x16f)]({'where':_0x69be4b})]);return{'payouts':_0x4a1d94[_0x456307(0x24a)](_0x5dfd64=>({'id':_0x5dfd64['id'],'shopId':_0x5dfd64['shopId'],'shopName':_0x5dfd64[_0x456307(0x20f)][_0x456307(0x151)],'shopUsername':_0x5dfd64[_0x456307(0x20f)]['username'],'amount':_0x5dfd64[_0x456307(0x244)],'network':_0x5dfd64['network'],'status':_0x5dfd64[_0x456307(0x19a)],'txid':_0x5dfd64[_0x456307(0x1e5)],'notes':_0x5dfd64[_0x456307(0x211)],'periodFrom':_0x5dfd64['periodFrom'],'periodTo':_0x5dfd64['periodTo'],'createdAt':_0x5dfd64[_0x456307(0x154)],'paidAt':_0x5dfd64['paidAt']})),'pagination':{'page':_0x19722b,'limit':_0x13c223,'total':_0x42b252,'totalPages':Math['ceil'](_0x42b252/_0x13c223)}};}async[a35_0xf3374(0x20b)](_0x5df64e){const _0x3404c5=a35_0xf3374,_0x4d3684=await database_1[_0x3404c5(0x184)][_0x3404c5(0x164)][_0x3404c5(0x1b0)]({'where':{'id':_0x5df64e},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x4d3684)return null;return{'id':_0x4d3684['id'],'shopId':_0x4d3684['shopId'],'shopName':_0x4d3684[_0x3404c5(0x20f)]['name'],'shopUsername':_0x4d3684['shop'][_0x3404c5(0x144)],'amount':_0x4d3684['amount'],'network':_0x4d3684[_0x3404c5(0x229)],'status':_0x4d3684[_0x3404c5(0x19a)],'txid':_0x4d3684[_0x3404c5(0x1e5)],'notes':_0x4d3684['notes'],'periodFrom':_0x4d3684[_0x3404c5(0x1a9)],'periodTo':_0x4d3684[_0x3404c5(0x21a)],'createdAt':_0x4d3684[_0x3404c5(0x154)],'paidAt':_0x4d3684[_0x3404c5(0x232)]};}async[a35_0xf3374(0x176)](_0x361250){const _0x398a8f=a35_0xf3374;await database_1[_0x398a8f(0x184)][_0x398a8f(0x164)]['delete']({'where':{'id':_0x361250}});}async['getAllPayments'](_0x64cca0){const _0x1055d5=a35_0xf3374,{page:_0x5ca4ed,limit:_0x33bc50,status:_0x51ea0e,gateway:_0x34f657,shopId:_0x5e5d33,dateFrom:_0xc88cf7,dateTo:_0x41f78f,search:_0x4ea472}=_0x64cca0,_0x194d43=(_0x5ca4ed-0x1)*_0x33bc50,_0x34480f={};_0x51ea0e&&(_0x34480f['status']=_0x51ea0e[_0x1055d5(0x158)]());_0x34f657&&(_0x34480f[_0x1055d5(0x1a5)]=_0x34f657[_0x1055d5(0x1f9)]());_0x34480f[_0x1055d5(0x1a5)]=_0x34480f[_0x1055d5(0x1a5)]?_0x34480f[_0x1055d5(0x1a5)]:{'not':'test_gateway'};if(typeof _0x34480f[_0x1055d5(0x1a5)]===_0x1055d5(0x1e0)&&_0x34480f[_0x1055d5(0x1a5)]!=='test_gateway'){}else{if(typeof _0x34480f[_0x1055d5(0x1a5)]===_0x1055d5(0x1e0)&&_0x34480f[_0x1055d5(0x1a5)]===_0x1055d5(0x1e6)){}else _0x34480f['gateway']={'not':_0x1055d5(0x1e6)};}_0x5e5d33&&(_0x34480f[_0x1055d5(0x205)]=_0x5e5d33);(_0xc88cf7||_0x41f78f)&&(_0x34480f['createdAt']={},_0xc88cf7&&(_0x34480f[_0x1055d5(0x154)][_0x1055d5(0x225)]=new Date(_0xc88cf7)),_0x41f78f&&(_0x34480f[_0x1055d5(0x154)]['lte']=new Date(_0x41f78f)));_0x4ea472&&(_0x34480f['OR']=[{'orderId':{'contains':_0x4ea472,'mode':_0x1055d5(0x15e)}},{'gatewayOrderId':{'contains':_0x4ea472,'mode':_0x1055d5(0x15e)}},{'customerEmail':{'contains':_0x4ea472,'mode':_0x1055d5(0x15e)}},{'shop':{'name':{'contains':_0x4ea472,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x4ea472,'mode':'insensitive'}}}]);const [_0xb15fad,_0x21b764]=await Promise[_0x1055d5(0x197)]([database_1[_0x1055d5(0x184)]['payment']['findMany']({'where':_0x34480f,'skip':_0x194d43,'take':_0x33bc50,'orderBy':{'createdAt':_0x1055d5(0x203)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x1055d5(0x184)][_0x1055d5(0x14f)][_0x1055d5(0x16f)]({'where':_0x34480f})]);return{'payments':_0xb15fad[_0x1055d5(0x24a)](_0x33d589=>({'id':_0x33d589['id'],'shopId':_0x33d589['shopId'],'gateway':_0x33d589[_0x1055d5(0x1a5)],'amount':_0x33d589[_0x1055d5(0x244)],'currency':_0x33d589[_0x1055d5(0x16b)],'status':_0x33d589[_0x1055d5(0x19a)],'orderId':_0x33d589[_0x1055d5(0x245)],'gatewayOrderId':_0x33d589[_0x1055d5(0x214)],'customerEmail':_0x33d589[_0x1055d5(0x201)],'customerName':_0x33d589[_0x1055d5(0x1c3)],'customerCountry':_0x33d589[_0x1055d5(0x1a1)],'customerIp':_0x33d589[_0x1055d5(0x209)],'customerUa':_0x33d589['customerUa'],'failureMessage':_0x33d589['failureMessage'],'createdAt':_0x33d589['createdAt'],'updatedAt':_0x33d589[_0x1055d5(0x23f)],'shop':_0x33d589['shop']})),'pagination':{'page':_0x5ca4ed,'limit':_0x33bc50,'total':_0x21b764,'totalPages':Math[_0x1055d5(0x22e)](_0x21b764/_0x33bc50)}};}async[a35_0xf3374(0x174)](_0x297eaf){const _0x356b9c=a35_0xf3374,_0x56627b=await database_1[_0x356b9c(0x184)][_0x356b9c(0x14f)][_0x356b9c(0x1b0)]({'where':{'id':_0x297eaf},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x56627b)return null;return{'id':_0x56627b['id'],'shopId':_0x56627b[_0x356b9c(0x205)],'gateway':_0x56627b['gateway'],'amount':_0x56627b[_0x356b9c(0x244)],'currency':_0x56627b['currency'],'status':_0x56627b[_0x356b9c(0x19a)],'orderId':_0x56627b['orderId'],'gatewayOrderId':_0x56627b['gatewayOrderId'],'customerEmail':_0x56627b[_0x356b9c(0x201)],'customerName':_0x56627b['customerName'],'customerCountry':_0x56627b[_0x356b9c(0x1a1)],'customerIp':_0x56627b['customerIp'],'customerUa':_0x56627b[_0x356b9c(0x208)],'failureMessage':_0x56627b[_0x356b9c(0x16c)],'externalPaymentUrl':_0x56627b[_0x356b9c(0x22c)],'successUrl':_0x56627b[_0x356b9c(0x223)],'failUrl':_0x56627b['failUrl'],'pendingUrl':_0x56627b['pendingUrl'],'whiteUrl':_0x56627b[_0x356b9c(0x23e)],'createdAt':_0x56627b[_0x356b9c(0x154)],'updatedAt':_0x56627b['updatedAt'],'shop':_0x56627b[_0x356b9c(0x20f)]};}async[a35_0xf3374(0x1fc)](_0x28c87c,_0x5a475c,_0x3fa653,_0x5dd75b){const _0x436999=a35_0xf3374,_0x23a0ed=await database_1[_0x436999(0x184)]['$transaction'](async _0x6aad7e=>{const _0x20a216=_0x436999,_0x34afa4=await _0x6aad7e[_0x20a216(0x14f)][_0x20a216(0x1b0)]({'where':{'id':_0x28c87c},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x34afa4)throw new Error(_0x20a216(0x18b));const _0x65455=_0x34afa4[_0x20a216(0x19a)],_0x2e8235=_0x5a475c[_0x20a216(0x158)]();console[_0x20a216(0x175)]('üîÑ\x20Admin\x20updating\x20payment\x20'+_0x28c87c+_0x20a216(0x247)+_0x65455+_0x20a216(0x1b5)+_0x2e8235),console[_0x20a216(0x175)](_0x20a216(0x220)+_0x34afa4['shop'][_0x20a216(0x21d)]+_0x20a216(0x169));const _0x1f8197={'status':_0x2e8235,'updatedAt':new Date(),'statusChangedBy':_0x20a216(0x1d7),'statusChangedAt':new Date()};_0x3fa653&&(_0x1f8197[_0x20a216(0x192)]=_0x3fa653);_0x2e8235===_0x20a216(0x221)&&_0x5dd75b&&(_0x1f8197['chargebackAmount']=_0x5dd75b);let _0x21ecfb=0x0,_0x1e8e14=_0x34afa4[_0x20a216(0x20f)][_0x20a216(0x21d)];if(_0x2e8235===_0x20a216(0x190)&&_0x65455!=='PAID'){_0x1f8197[_0x20a216(0x232)]=new Date();const _0x33af96=await currencyService_1[_0x20a216(0x246)][_0x20a216(0x249)](_0x34afa4['amount'],_0x34afa4[_0x20a216(0x16b)]);_0x1f8197[_0x20a216(0x242)]=_0x33af96,_0x21ecfb=_0x33af96,_0x1e8e14+=_0x33af96,console['log'](_0x20a216(0x18e)+_0x28c87c+_0x20a216(0x233)+_0x33af96[_0x20a216(0x18d)](0x6)+_0x20a216(0x1f1));}else _0x65455===_0x20a216(0x190)&&_0x2e8235!=='PAID'&&(_0x34afa4[_0x20a216(0x242)]&&(_0x21ecfb=-_0x34afa4[_0x20a216(0x242)],_0x1e8e14-=_0x34afa4[_0x20a216(0x242)],_0x1f8197[_0x20a216(0x242)]=null,console[_0x20a216(0x175)](_0x20a216(0x18e)+_0x28c87c+_0x20a216(0x14c)+_0x34afa4['amountUSDT'][_0x20a216(0x18d)](0x6)+_0x20a216(0x231))));if(_0x2e8235===_0x20a216(0x221)){if(_0x65455==='PAID'&&_0x34afa4['amountUSDT']){}_0x5dd75b&&_0x5dd75b>0x0&&(_0x21ecfb-=_0x5dd75b,_0x1e8e14-=_0x5dd75b,console['log']('üí∏\x20CHARGEBACK\x20penalty:\x20-'+_0x5dd75b[_0x20a216(0x18d)](0x6)+'\x20USDT\x20from\x20balance'));}_0x2e8235===_0x20a216(0x248)&&_0x65455===_0x20a216(0x190)&&console[_0x20a216(0x175)](_0x20a216(0x1d6));const _0x4adde6=await _0x6aad7e[_0x20a216(0x14f)][_0x20a216(0x22f)]({'where':{'id':_0x28c87c},'data':_0x1f8197,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x21ecfb!==0x0&&(await _0x6aad7e[_0x20a216(0x20f)][_0x20a216(0x22f)]({'where':{'id':_0x34afa4[_0x20a216(0x205)]},'data':{'balance':_0x1e8e14}}),console['log']('üí∞\x20Shop\x20'+_0x34afa4['shopId']+_0x20a216(0x1a6)+_0x34afa4[_0x20a216(0x20f)][_0x20a216(0x21d)][_0x20a216(0x18d)](0x6)+_0x20a216(0x1b5)+_0x1e8e14[_0x20a216(0x18d)](0x6)+_0x20a216(0x17b)+(_0x21ecfb>0x0?'+':'')+_0x21ecfb[_0x20a216(0x18d)](0x6)+')')),_0x4adde6;});return{'id':_0x23a0ed['id'],'shopId':_0x23a0ed[_0x436999(0x205)],'gateway':_0x23a0ed['gateway'],'amount':_0x23a0ed[_0x436999(0x244)],'currency':_0x23a0ed['currency'],'status':_0x23a0ed[_0x436999(0x19a)],'orderId':_0x23a0ed[_0x436999(0x245)],'gatewayOrderId':_0x23a0ed[_0x436999(0x214)],'customerEmail':_0x23a0ed[_0x436999(0x201)],'customerName':_0x23a0ed[_0x436999(0x1c3)],'customerCountry':_0x23a0ed[_0x436999(0x1a1)],'customerIp':_0x23a0ed[_0x436999(0x209)],'customerUa':_0x23a0ed[_0x436999(0x208)],'failureMessage':_0x23a0ed[_0x436999(0x16c)],'adminNotes':_0x23a0ed[_0x436999(0x192)],'chargebackAmount':_0x23a0ed[_0x436999(0x162)],'statusChangedBy':_0x23a0ed['statusChangedBy'],'statusChangedAt':_0x23a0ed['statusChangedAt'],'createdAt':_0x23a0ed[_0x436999(0x154)],'updatedAt':_0x23a0ed['updatedAt'],'shop':_0x23a0ed[_0x436999(0x20f)]};}async[a35_0xf3374(0x149)](_0x5f51ef,_0x5bdd90){const _0x3a6602=a35_0xf3374,_0x1f883a={..._0x5bdd90};_0x5bdd90['password']&&(_0x1f883a[_0x3a6602(0x1e1)]=await bcryptjs_1[_0x3a6602(0x184)]['hash'](_0x5bdd90[_0x3a6602(0x1e1)],0xc));_0x5bdd90[_0x3a6602(0x228)]&&(_0x1f883a[_0x3a6602(0x151)]=_0x5bdd90[_0x3a6602(0x228)],delete _0x1f883a['fullName']);_0x5bdd90['telegramId']&&(_0x1f883a['telegram']=_0x5bdd90[_0x3a6602(0x1f7)],delete _0x1f883a[_0x3a6602(0x1f7)]);_0x5bdd90['merchantUrl']&&(_0x1f883a['shopUrl']=_0x5bdd90[_0x3a6602(0x1b7)],delete _0x1f883a[_0x3a6602(0x1b7)]);_0x5bdd90['gateways']&&(_0x1f883a[_0x3a6602(0x1a2)]=JSON[_0x3a6602(0x14d)](_0x5bdd90['gateways']),delete _0x1f883a[_0x3a6602(0x206)]);_0x5bdd90[_0x3a6602(0x243)]&&(_0x1f883a[_0x3a6602(0x243)]=JSON[_0x3a6602(0x14d)](_0x5bdd90[_0x3a6602(0x243)]),delete _0x1f883a[_0x3a6602(0x243)]);_0x5bdd90[_0x3a6602(0x185)]&&(_0x5bdd90['wallets'][_0x3a6602(0x18c)]!==undefined&&(_0x1f883a['usdtPolygonWallet']=_0x5bdd90['wallets'][_0x3a6602(0x18c)]||null),_0x5bdd90[_0x3a6602(0x185)][_0x3a6602(0x15d)]!==undefined&&(_0x1f883a[_0x3a6602(0x15d)]=_0x5bdd90[_0x3a6602(0x185)]['usdtTrcWallet']||null),_0x5bdd90[_0x3a6602(0x185)][_0x3a6602(0x170)]!==undefined&&(_0x1f883a[_0x3a6602(0x170)]=_0x5bdd90[_0x3a6602(0x185)][_0x3a6602(0x170)]||null),_0x5bdd90[_0x3a6602(0x185)][_0x3a6602(0x16a)]!==undefined&&(_0x1f883a[_0x3a6602(0x16a)]=_0x5bdd90['wallets']['usdcPolygonWallet']||null),delete _0x1f883a[_0x3a6602(0x185)]);const _0x399fa5=await database_1[_0x3a6602(0x184)][_0x3a6602(0x20f)][_0x3a6602(0x22f)]({'where':{'id':_0x5f51ef},'data':_0x1f883a,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x399fa5['id'],'fullName':_0x399fa5[_0x3a6602(0x151)],'username':_0x399fa5[_0x3a6602(0x144)],'telegramId':_0x399fa5[_0x3a6602(0x156)],'merchantUrl':_0x399fa5[_0x3a6602(0x196)],'gateways':_0x399fa5[_0x3a6602(0x1a2)]?JSON[_0x3a6602(0x213)](_0x399fa5[_0x3a6602(0x1a2)]):null,'gatewaySettings':_0x399fa5[_0x3a6602(0x243)]?JSON[_0x3a6602(0x213)](_0x399fa5[_0x3a6602(0x243)]):null,'publicKey':_0x399fa5[_0x3a6602(0x21e)],'wallets':{'usdtPolygonWallet':_0x399fa5[_0x3a6602(0x18c)],'usdtTrcWallet':_0x399fa5[_0x3a6602(0x15d)],'usdtErcWallet':_0x399fa5['usdtErcWallet'],'usdcPolygonWallet':_0x399fa5[_0x3a6602(0x16a)]},'status':_0x399fa5[_0x3a6602(0x19a)],'createdAt':_0x399fa5[_0x3a6602(0x154)]};}async['suspendUser'](_0x573b55){const _0x58a7ab=a35_0xf3374,_0x5d7205=await database_1[_0x58a7ab(0x184)]['shop']['update']({'where':{'id':_0x573b55},'data':{'status':_0x58a7ab(0x150)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x5d7205['id'],'fullName':_0x5d7205[_0x58a7ab(0x151)],'username':_0x5d7205[_0x58a7ab(0x144)],'telegramId':_0x5d7205[_0x58a7ab(0x156)],'merchantUrl':_0x5d7205[_0x58a7ab(0x196)],'gateways':_0x5d7205['paymentGateways']?JSON[_0x58a7ab(0x213)](_0x5d7205[_0x58a7ab(0x1a2)]):null,'gatewaySettings':_0x5d7205[_0x58a7ab(0x243)]?JSON[_0x58a7ab(0x213)](_0x5d7205[_0x58a7ab(0x243)]):null,'publicKey':_0x5d7205['publicKey'],'wallets':{'usdtPolygonWallet':_0x5d7205[_0x58a7ab(0x18c)],'usdtTrcWallet':_0x5d7205[_0x58a7ab(0x15d)],'usdtErcWallet':_0x5d7205[_0x58a7ab(0x170)],'usdcPolygonWallet':_0x5d7205[_0x58a7ab(0x16a)]},'status':_0x5d7205[_0x58a7ab(0x19a)],'createdAt':_0x5d7205[_0x58a7ab(0x154)]};}async[a35_0xf3374(0x215)](_0x14ac2f){const _0x1ca1f4=a35_0xf3374,_0x1a3de2=await database_1[_0x1ca1f4(0x184)][_0x1ca1f4(0x20f)][_0x1ca1f4(0x22f)]({'where':{'id':_0x14ac2f},'data':{'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x1a3de2['id'],'fullName':_0x1a3de2[_0x1ca1f4(0x151)],'username':_0x1a3de2[_0x1ca1f4(0x144)],'telegramId':_0x1a3de2[_0x1ca1f4(0x156)],'merchantUrl':_0x1a3de2['shopUrl'],'gateways':_0x1a3de2[_0x1ca1f4(0x1a2)]?JSON[_0x1ca1f4(0x213)](_0x1a3de2[_0x1ca1f4(0x1a2)]):null,'gatewaySettings':_0x1a3de2['gatewaySettings']?JSON[_0x1ca1f4(0x213)](_0x1a3de2[_0x1ca1f4(0x243)]):null,'publicKey':_0x1a3de2[_0x1ca1f4(0x21e)],'wallets':{'usdtPolygonWallet':_0x1a3de2[_0x1ca1f4(0x18c)],'usdtTrcWallet':_0x1a3de2[_0x1ca1f4(0x15d)],'usdtErcWallet':_0x1a3de2[_0x1ca1f4(0x170)],'usdcPolygonWallet':_0x1a3de2[_0x1ca1f4(0x16a)]},'status':_0x1a3de2['status'],'createdAt':_0x1a3de2[_0x1ca1f4(0x154)]};}async[a35_0xf3374(0x181)](_0x54ebc9){const _0x500522=a35_0xf3374,{page:_0x4de734,limit:_0x3c3a11,status:_0x5eac4f}=_0x54ebc9,_0x534e0b=(_0x4de734-0x1)*_0x3c3a11,_0x45c70a={};_0x5eac4f&&(_0x45c70a[_0x500522(0x19a)]=_0x5eac4f[_0x500522(0x158)]());const [_0x21ea74,_0x4ab553]=await Promise[_0x500522(0x197)]([database_1['default']['shop'][_0x500522(0x1bb)]({'where':_0x45c70a,'skip':_0x534e0b,'take':_0x3c3a11,'orderBy':{'createdAt':_0x500522(0x203)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x500522(0x184)][_0x500522(0x20f)]['count']({'where':_0x45c70a})]);return{'users':_0x21ea74[_0x500522(0x24a)](_0x2bcdc3=>({'id':_0x2bcdc3['id'],'fullName':_0x2bcdc3[_0x500522(0x151)],'username':_0x2bcdc3[_0x500522(0x144)],'telegramId':_0x2bcdc3[_0x500522(0x156)],'merchantUrl':_0x2bcdc3[_0x500522(0x196)],'gateways':_0x2bcdc3[_0x500522(0x1a2)]?JSON['parse'](_0x2bcdc3[_0x500522(0x1a2)]):null,'gatewaySettings':_0x2bcdc3['gatewaySettings']?JSON['parse'](_0x2bcdc3[_0x500522(0x243)]):null,'publicKey':_0x2bcdc3[_0x500522(0x21e)],'wallets':{'usdtPolygonWallet':_0x2bcdc3[_0x500522(0x18c)],'usdtTrcWallet':_0x2bcdc3[_0x500522(0x15d)],'usdtErcWallet':_0x2bcdc3[_0x500522(0x170)],'usdcPolygonWallet':_0x2bcdc3[_0x500522(0x16a)]},'status':_0x2bcdc3[_0x500522(0x19a)],'createdAt':_0x2bcdc3[_0x500522(0x154)]})),'pagination':{'page':_0x4de734,'limit':_0x3c3a11,'total':_0x4ab553,'totalPages':Math[_0x500522(0x22e)](_0x4ab553/_0x3c3a11)}};}async[a35_0xf3374(0x1e7)](_0x39e8b8){const _0x24502d=a35_0xf3374,_0x2d6108=await database_1[_0x24502d(0x184)][_0x24502d(0x20f)][_0x24502d(0x1b0)]({'where':{'id':_0x39e8b8},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x2d6108)return null;return{'id':_0x2d6108['id'],'fullName':_0x2d6108[_0x24502d(0x151)],'username':_0x2d6108[_0x24502d(0x144)],'telegramId':_0x2d6108['telegram'],'merchantUrl':_0x2d6108[_0x24502d(0x196)],'gateways':_0x2d6108[_0x24502d(0x1a2)]?JSON[_0x24502d(0x213)](_0x2d6108['paymentGateways']):null,'gatewaySettings':_0x2d6108[_0x24502d(0x243)]?JSON[_0x24502d(0x213)](_0x2d6108['gatewaySettings']):null,'publicKey':_0x2d6108[_0x24502d(0x21e)],'wallets':{'usdtPolygonWallet':_0x2d6108[_0x24502d(0x18c)],'usdtTrcWallet':_0x2d6108[_0x24502d(0x15d)],'usdtErcWallet':_0x2d6108['usdtErcWallet'],'usdcPolygonWallet':_0x2d6108[_0x24502d(0x16a)]},'status':_0x2d6108[_0x24502d(0x19a)],'createdAt':_0x2d6108[_0x24502d(0x154)]};}async['createUser'](_0x1540cf){const _0x32776d=a35_0xf3374,{fullName:_0x3402dd,username:_0x28e6ae,password:_0x4f9ddf,telegramId:_0x23e91a,merchantUrl:_0x2edadf,gateways:_0x23aad9,gatewaySettings:_0x5a8e1f,wallets:_0x1a9356}=_0x1540cf,_0x3c3d49=await database_1[_0x32776d(0x184)][_0x32776d(0x20f)][_0x32776d(0x1b0)]({'where':{'username':_0x28e6ae}});if(_0x3c3d49)throw new Error(_0x32776d(0x1a3));if(_0x23e91a){const _0x30f855=await database_1['default'][_0x32776d(0x20f)][_0x32776d(0x1b0)]({'where':{'telegram':_0x23e91a}});if(_0x30f855)throw new Error(_0x32776d(0x16e));}const _0x4f925a=await bcryptjs_1[_0x32776d(0x184)][_0x32776d(0x218)](_0x4f9ddf,0xc),_0x4470e0='pk_'+crypto_1[_0x32776d(0x184)][_0x32776d(0x239)](0x20)[_0x32776d(0x1f4)](_0x32776d(0x17f)),_0x368a53=_0x32776d(0x234)+crypto_1['default'][_0x32776d(0x239)](0x20)[_0x32776d(0x1f4)](_0x32776d(0x17f)),_0x1198af=await database_1[_0x32776d(0x184)][_0x32776d(0x20f)][_0x32776d(0x1c6)]({'data':{'name':_0x3402dd,'username':_0x28e6ae,'password':_0x4f925a,'telegram':_0x23e91a,'shopUrl':_0x2edadf,'paymentGateways':_0x23aad9?JSON['stringify'](_0x23aad9):null,'gatewaySettings':_0x5a8e1f?JSON[_0x32776d(0x14d)](_0x5a8e1f):null,'usdtPolygonWallet':_0x1a9356?.[_0x32776d(0x18c)]||null,'usdtTrcWallet':_0x1a9356?.[_0x32776d(0x15d)]||null,'usdtErcWallet':_0x1a9356?.[_0x32776d(0x170)]||null,'usdcPolygonWallet':_0x1a9356?.[_0x32776d(0x16a)]||null,'publicKey':_0x4470e0,'secretKey':_0x368a53,'status':_0x32776d(0x1af)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x1198af['id'],'fullName':_0x1198af[_0x32776d(0x151)],'username':_0x1198af[_0x32776d(0x144)],'telegramId':_0x1198af[_0x32776d(0x156)],'merchantUrl':_0x1198af['shopUrl'],'gateways':_0x1198af[_0x32776d(0x1a2)]?JSON['parse'](_0x1198af[_0x32776d(0x1a2)]):null,'gatewaySettings':_0x1198af['gatewaySettings']?JSON['parse'](_0x1198af[_0x32776d(0x243)]):null,'publicKey':_0x1198af[_0x32776d(0x21e)],'wallets':{'usdtPolygonWallet':_0x1198af[_0x32776d(0x18c)],'usdtTrcWallet':_0x1198af[_0x32776d(0x15d)],'usdtErcWallet':_0x1198af[_0x32776d(0x170)],'usdcPolygonWallet':_0x1198af['usdcPolygonWallet']},'status':_0x1198af['status'],'createdAt':_0x1198af['createdAt']};}async[a35_0xf3374(0x157)](_0x2dc02a){const _0x4c860a=a35_0xf3374;await database_1[_0x4c860a(0x184)][_0x4c860a(0x20f)][_0x4c860a(0x216)]({'where':{'id':_0x2dc02a}});}async[a35_0xf3374(0x1fb)](_0x21b67f){const _0x67e80e=a35_0xf3374,_0x111e04={};_0x21b67f&&[_0x67e80e(0x1af),'INACTIVE',_0x67e80e(0x150)][_0x67e80e(0x227)](_0x21b67f[_0x67e80e(0x158)]())&&(_0x111e04[_0x67e80e(0x19a)]=_0x21b67f[_0x67e80e(0x158)]());const _0x2b4902=await database_1[_0x67e80e(0x184)]['shop'][_0x67e80e(0x1bb)]({'where':_0x111e04,'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x67e80e(0x165)}});return _0x2b4902;}}exports[a35_0xf3374(0x189)]=AdminService;