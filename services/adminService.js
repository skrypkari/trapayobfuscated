'use strict';const a33_0x3109ad=a33_0x44dd;(function(_0x55ed28,_0x32fe8b){const _0x4c3797=a33_0x44dd,_0x52833e=_0x55ed28();while(!![]){try{const _0x13e37f=-parseInt(_0x4c3797(0x223))/0x1*(-parseInt(_0x4c3797(0x169))/0x2)+-parseInt(_0x4c3797(0x183))/0x3+-parseInt(_0x4c3797(0x210))/0x4*(-parseInt(_0x4c3797(0x1d1))/0x5)+parseInt(_0x4c3797(0x17b))/0x6*(parseInt(_0x4c3797(0x17e))/0x7)+-parseInt(_0x4c3797(0x1a0))/0x8*(parseInt(_0x4c3797(0x156))/0x9)+parseInt(_0x4c3797(0x1d4))/0xa*(-parseInt(_0x4c3797(0x1fb))/0xb)+-parseInt(_0x4c3797(0x155))/0xc;if(_0x13e37f===_0x32fe8b)break;else _0x52833e['push'](_0x52833e['shift']());}catch(_0x3edd3a){_0x52833e['push'](_0x52833e['shift']());}}}(a33_0x3430,0xc160e));var __importDefault=this&&this[a33_0x3109ad(0x179)]||function(_0x46c796){const _0x480256=a33_0x3109ad;return _0x46c796&&_0x46c796[_0x480256(0x191)]?_0x46c796:{'default':_0x46c796};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a33_0x3109ad(0x1bc)]=void 0x0;const database_1=__importDefault(require(a33_0x3109ad(0x1b6))),currencyService_1=require('./currencyService'),userService_1=require(a33_0x3109ad(0x19f)),telegramBotService_1=require(a33_0x3109ad(0x1f3)),gateway_1=require(a33_0x3109ad(0x1a2));class AdminService{constructor(){const _0x11e81b=a33_0x3109ad;this[_0x11e81b(0x184)]=new userService_1[(_0x11e81b(0x1a5))]();}[a33_0x3109ad(0x15f)](_0x52a161){const _0x7ab049=a33_0x3109ad;switch(_0x52a161){case'7d':return 0x7;case _0x7ab049(0x190):return 0x1e;case _0x7ab049(0x18e):return 0x5a;case'1y':return 0x16d;default:return 0x1e;}}[a33_0x3109ad(0x1d7)](_0x1ebe33,_0x167ec6){const _0x262002=a33_0x3109ad,_0x406b86=[],_0x38e4e4=new Date(_0x1ebe33);while(_0x38e4e4<=_0x167ec6){_0x406b86['push'](_0x38e4e4[_0x262002(0x1c6)]()[_0x262002(0x171)]('T')[0x0]),_0x38e4e4[_0x262002(0x16f)](_0x38e4e4['getDate']()+0x1);}return _0x406b86;}[a33_0x3109ad(0x182)](_0x366ef1,_0x29c12d){const _0x45650c=a33_0x3109ad;if(!_0x366ef1[_0x45650c(0x199)])return{'commission':0x0,'payoutDelay':0x0};try{const _0x52fffc=JSON['parse'](_0x366ef1[_0x45650c(0x199)]),_0x23083b=_0x29c12d[_0x45650c(0x192)](0x0)[_0x45650c(0x168)]()+_0x29c12d[_0x45650c(0x185)](0x1)[_0x45650c(0x1f2)]();if(_0x52fffc&&_0x52fffc[_0x23083b])return{'commission':_0x52fffc[_0x23083b][_0x45650c(0x20d)]||0x0,'payoutDelay':_0x52fffc[_0x23083b][_0x45650c(0x170)]||0x0};}catch(_0x40ca86){console[_0x45650c(0x173)](_0x45650c(0x1c4),_0x40ca86);}return{'commission':0x0,'payoutDelay':0x0};}['isEligibleForPayout'](_0x57cd75){const _0x5c402b=a33_0x3109ad;if(_0x57cd75[_0x5c402b(0x1f5)]!==_0x5c402b(0x1a6)||_0x57cd75[_0x5c402b(0x1eb)]||!_0x57cd75[_0x5c402b(0x20e)])return![];const _0x5f3eae=this[_0x5c402b(0x182)](_0x57cd75['shop'],_0x57cd75[_0x5c402b(0x1de)]),_0x357a93=_0x5f3eae[_0x5c402b(0x170)]*0x18*0x3c*0x3c*0x3e8,_0x54caa4=new Date(_0x57cd75['paidAt'][_0x5c402b(0x177)]()+_0x357a93);return new Date()>_0x54caa4;}['calculateAmountAfterCommission'](_0x1429c7,_0x1d47df){return _0x1429c7*(0x1-_0x1d47df/0x64);}[a33_0x3109ad(0x212)](_0x54cf7b){const _0x35bf32=a33_0x3109ad;switch(_0x54cf7b[_0x35bf32(0x1f5)]){case _0x35bf32(0x1a6):return _0x54cf7b['amount'];case'CHARGEBACK':return-(_0x54cf7b[_0x35bf32(0x1a3)]||0x0);case'REFUND':return 0x0;default:return 0x0;}}async['createPayout'](_0x1bdd81){const _0x4af39b=a33_0x3109ad,{shopId:_0x36bd26,amount:_0x54885a,network:_0x25a626,notes:_0x677544}=_0x1bdd81;console[_0x4af39b(0x201)](_0x4af39b(0x217)+_0x36bd26+':\x20'+_0x54885a+_0x4af39b(0x1c3)+_0x25a626);const _0x31ca0e=await database_1[_0x4af39b(0x1e9)]['shop'][_0x4af39b(0x186)]({'where':{'id':_0x36bd26},'select':{'id':!![],'name':!![],'username':!![],'status':!![]}});if(!_0x31ca0e)throw new Error(_0x4af39b(0x221));if(_0x31ca0e[_0x4af39b(0x1f5)]!==_0x4af39b(0x215))throw new Error(_0x4af39b(0x203));const _0x3aae02=await database_1[_0x4af39b(0x1e9)][_0x4af39b(0x1aa)][_0x4af39b(0x19b)]({'data':{'shopId':_0x36bd26,'amount':_0x54885a,'network':_0x25a626,'status':_0x4af39b(0x1a9),'notes':_0x677544||null,'paidAt':new Date()},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});await this['markPaymentsAsPaidOut'](_0x36bd26,_0x54885a);try{await telegramBotService_1[_0x4af39b(0x19d)][_0x4af39b(0x1b4)](_0x36bd26,_0x3aae02,_0x4af39b(0x216));}catch(_0x49125a){console[_0x4af39b(0x173)](_0x4af39b(0x20a),_0x49125a);}return console['log']('‚úÖ\x20Payout\x20created\x20successfully:\x20'+_0x3aae02['id']),{'id':_0x3aae02['id'],'shopId':_0x3aae02[_0x4af39b(0x19e)],'shopName':_0x3aae02[_0x4af39b(0x162)][_0x4af39b(0x1f4)],'shopUsername':_0x3aae02[_0x4af39b(0x162)][_0x4af39b(0x1c0)],'amount':_0x3aae02[_0x4af39b(0x219)],'network':_0x3aae02[_0x4af39b(0x1d0)],'status':_0x3aae02[_0x4af39b(0x1f5)],'txid':_0x3aae02[_0x4af39b(0x19a)],'notes':_0x3aae02[_0x4af39b(0x209)],'createdAt':_0x3aae02[_0x4af39b(0x1a1)],'paidAt':_0x3aae02['paidAt']};}async[a33_0x3109ad(0x1e1)](_0x164ee8,_0x23b7a6){const _0x52db00=a33_0x3109ad;console['log'](_0x52db00(0x1bd)+_0x164ee8+_0x52db00(0x175)+_0x23b7a6+_0x52db00(0x1fd));const _0x2626bc=await database_1[_0x52db00(0x1e9)][_0x52db00(0x1c7)]['findMany']({'where':{'shopId':_0x164ee8,'status':'PAID','merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'shop':{'select':{'gatewaySettings':!![]}}},'orderBy':{'paidAt':'asc'}});let _0x20a8e6=_0x23b7a6;const _0x50f56f=[];for(const _0x3e8c3a of _0x2626bc){const _0x23a612={..._0x3e8c3a,'status':_0x52db00(0x1a6),'merchantPaid':![],'shop':{'gatewaySettings':_0x3e8c3a['shop'][_0x52db00(0x199)]}};if(!this[_0x52db00(0x1f9)](_0x23a612))continue;const _0x4a55af=await currencyService_1['currencyService'][_0x52db00(0x18f)](_0x3e8c3a[_0x52db00(0x219)],_0x3e8c3a[_0x52db00(0x193)]),_0xb07cc6=this[_0x52db00(0x182)](_0x3e8c3a['shop'],_0x3e8c3a[_0x52db00(0x1de)]),_0x4d6809=this[_0x52db00(0x196)](_0x4a55af,_0xb07cc6[_0x52db00(0x20d)]);if(_0x4d6809<=_0x20a8e6){_0x50f56f[_0x52db00(0x1e0)](_0x3e8c3a['id']),_0x20a8e6-=_0x4d6809;if(_0x20a8e6<=0.01)break;}}_0x50f56f[_0x52db00(0x21a)]>0x0&&(await database_1['default']['payment'][_0x52db00(0x1ce)]({'where':{'id':{'in':_0x50f56f}},'data':{'merchantPaid':!![]}}),console[_0x52db00(0x201)](_0x52db00(0x18b)+_0x50f56f[_0x52db00(0x21a)]+_0x52db00(0x1b1)));}async[a33_0x3109ad(0x1f1)](_0x4690b2){const _0x3e1606=a33_0x3109ad,{page:_0x203462,limit:_0x2d67d0,shopId:_0xc9aba9,network:_0x5f22dd,dateFrom:_0x28704e,dateTo:_0x581ba0,search:_0x586854}=_0x4690b2,_0x552f61=(_0x203462-0x1)*_0x2d67d0;console[_0x3e1606(0x201)](_0x3e1606(0x1c2),_0x4690b2);const _0x1a5007={};_0xc9aba9&&(_0x1a5007[_0x3e1606(0x19e)]=_0xc9aba9);_0x5f22dd&&(_0x1a5007[_0x3e1606(0x1d0)]=_0x5f22dd);(_0x28704e||_0x581ba0)&&(_0x1a5007[_0x3e1606(0x1a1)]={},_0x28704e&&(_0x1a5007[_0x3e1606(0x1a1)][_0x3e1606(0x1e2)]=new Date(_0x28704e)),_0x581ba0&&(_0x1a5007[_0x3e1606(0x1a1)][_0x3e1606(0x226)]=new Date(_0x581ba0)));_0x586854&&(_0x1a5007['OR']=[{'txid':{'contains':_0x586854,'mode':_0x3e1606(0x1d2)}},{'notes':{'contains':_0x586854,'mode':_0x3e1606(0x1d2)}},{'shop':{'name':{'contains':_0x586854,'mode':_0x3e1606(0x1d2)}}},{'shop':{'username':{'contains':_0x586854,'mode':_0x3e1606(0x1d2)}}}]);const [_0x3b8d44,_0x35b175]=await Promise[_0x3e1606(0x22b)]([database_1[_0x3e1606(0x1e9)][_0x3e1606(0x1aa)][_0x3e1606(0x214)]({'where':_0x1a5007,'skip':_0x552f61,'take':_0x2d67d0,'orderBy':{'createdAt':_0x3e1606(0x1d9)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x3e1606(0x1e9)][_0x3e1606(0x1aa)]['count']({'where':_0x1a5007})]);console[_0x3e1606(0x201)]('üìä\x20Found\x20'+_0x3b8d44[_0x3e1606(0x21a)]+'\x20payouts\x20out\x20of\x20'+_0x35b175+_0x3e1606(0x1ad));const _0x26ab88=_0x3b8d44[_0x3e1606(0x218)](_0x11a8f1=>({'id':_0x11a8f1['id'],'shopId':_0x11a8f1['shopId'],'shopName':_0x11a8f1[_0x3e1606(0x162)][_0x3e1606(0x1f4)],'shopUsername':_0x11a8f1[_0x3e1606(0x162)][_0x3e1606(0x1c0)],'amount':_0x11a8f1[_0x3e1606(0x219)],'network':_0x11a8f1[_0x3e1606(0x1d0)],'status':_0x11a8f1['status'],'txid':_0x11a8f1[_0x3e1606(0x19a)],'notes':_0x11a8f1[_0x3e1606(0x209)],'createdAt':_0x11a8f1[_0x3e1606(0x1a1)],'paidAt':_0x11a8f1['paidAt']}));return{'payouts':_0x26ab88,'pagination':{'page':_0x203462,'limit':_0x2d67d0,'total':_0x35b175,'totalPages':Math[_0x3e1606(0x1e8)](_0x35b175/_0x2d67d0)}};}async[a33_0x3109ad(0x163)](_0x557c4d){const _0x12eb4c=a33_0x3109ad;console['log'](_0x12eb4c(0x1f0)+_0x557c4d);const _0x5868d3=await database_1['default'][_0x12eb4c(0x1aa)][_0x12eb4c(0x186)]({'where':{'id':_0x557c4d},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x5868d3)return console[_0x12eb4c(0x201)]('‚ùå\x20Payout\x20not\x20found:\x20'+_0x557c4d),null;return console[_0x12eb4c(0x201)]('‚úÖ\x20Found\x20payout:\x20'+_0x5868d3[_0x12eb4c(0x219)]+_0x12eb4c(0x1c3)+_0x5868d3[_0x12eb4c(0x1d0)]),{'id':_0x5868d3['id'],'shopId':_0x5868d3[_0x12eb4c(0x19e)],'shopName':_0x5868d3[_0x12eb4c(0x162)][_0x12eb4c(0x1f4)],'shopUsername':_0x5868d3[_0x12eb4c(0x162)][_0x12eb4c(0x1c0)],'amount':_0x5868d3[_0x12eb4c(0x219)],'network':_0x5868d3[_0x12eb4c(0x1d0)],'status':_0x5868d3['status'],'txid':_0x5868d3[_0x12eb4c(0x19a)],'notes':_0x5868d3[_0x12eb4c(0x209)],'createdAt':_0x5868d3[_0x12eb4c(0x1a1)],'paidAt':_0x5868d3[_0x12eb4c(0x20e)]};}async[a33_0x3109ad(0x1ae)](_0x3b5c12){const _0x28b1a6=a33_0x3109ad;console[_0x28b1a6(0x201)](_0x28b1a6(0x200)+_0x3b5c12);const _0x3348c0=await database_1['default'][_0x28b1a6(0x1aa)][_0x28b1a6(0x186)]({'where':{'id':_0x3b5c12},'select':{'id':!![],'shopId':!![],'amount':!![]}});if(!_0x3348c0)throw new Error(_0x28b1a6(0x165));await database_1[_0x28b1a6(0x1e9)][_0x28b1a6(0x1aa)][_0x28b1a6(0x15a)]({'where':{'id':_0x3b5c12}}),console[_0x28b1a6(0x201)](_0x28b1a6(0x1e7)+_0x3b5c12+'\x20deleted\x20successfully');}async[a33_0x3109ad(0x1f7)](_0x56fd40){const _0x17aaed=a33_0x3109ad,{page:_0x831c99,limit:_0x41ce2d,minAmount:_0x3d1887,search:_0x5e4deb}=_0x56fd40;console[_0x17aaed(0x201)]('üìã\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:',_0x56fd40);const _0x33cf4f=await database_1[_0x17aaed(0x1e9)][_0x17aaed(0x1c7)][_0x17aaed(0x214)]({'where':{'status':_0x17aaed(0x1a6),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'createdAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'gatewaySettings':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}});console['log']('üí∞\x20Found\x20'+_0x33cf4f[_0x17aaed(0x21a)]+'\x20eligible\x20PAID\x20payments\x20for\x20payout\x20analysis');const _0x494644=new Map();for(const _0x30befc of _0x33cf4f){const _0x10b546={..._0x30befc,'status':_0x17aaed(0x1a6),'merchantPaid':![],'shop':{'gatewaySettings':_0x30befc[_0x17aaed(0x162)]['gatewaySettings']}},_0x302d67=this['isEligibleForPayout'](_0x10b546);if(!_0x302d67)continue;const _0x307e4c=await currencyService_1[_0x17aaed(0x172)][_0x17aaed(0x18f)](_0x30befc[_0x17aaed(0x219)],_0x30befc[_0x17aaed(0x193)]),_0x3ee2f1=this['getGatewaySettings'](_0x30befc[_0x17aaed(0x162)],_0x30befc['gateway']),_0xdc37b1=this[_0x17aaed(0x196)](_0x307e4c,_0x3ee2f1['commission']),_0x59a557=_0x30befc[_0x17aaed(0x19e)];!_0x494644['has'](_0x59a557)&&_0x494644[_0x17aaed(0x1df)](_0x59a557,{'shop':_0x30befc[_0x17aaed(0x162)],'payments':[]}),_0x494644[_0x17aaed(0x229)](_0x59a557)['payments']['push']({'id':_0x30befc['id'],'amount':_0x30befc['amount'],'currency':_0x30befc['currency'],'gateway':_0x30befc['gateway'],'paidAt':_0x30befc[_0x17aaed(0x20e)],'createdAt':_0x30befc[_0x17aaed(0x1a1)],'amountUSDT':_0x307e4c,'commission':_0x3ee2f1[_0x17aaed(0x20d)],'amountAfterCommissionUSDT':_0xdc37b1,'isEligible':!![]});}console['log']('üè™\x20Found\x20'+_0x494644[_0x17aaed(0x166)]+'\x20merchants\x20with\x20eligible\x20PAID\x20payments');const _0x208e16=[];for(const [_0x5c5075,_0x58c150]of _0x494644){const {shop:_0x3eedd2,payments:_0x1bc0f8}=_0x58c150,_0x270767=_0x1bc0f8[_0x17aaed(0x17d)]((_0x12c344,_0x461f0a)=>_0x12c344+_0x461f0a[_0x17aaed(0x206)],0x0),_0x3d8d6b=_0x1bc0f8[_0x17aaed(0x17d)]((_0x187f1a,_0x97a911)=>_0x187f1a+_0x97a911[_0x17aaed(0x1f6)],0x0);if(_0x3d1887&&_0x3d8d6b<_0x3d1887)continue;if(_0x5e4deb){const _0x31dbb1=_0x5e4deb[_0x17aaed(0x1f2)](),_0x2e2916=_0x3eedd2[_0x17aaed(0x1f4)][_0x17aaed(0x1f2)]()['includes'](_0x31dbb1)||_0x3eedd2[_0x17aaed(0x1c0)][_0x17aaed(0x1f2)]()[_0x17aaed(0x1db)](_0x31dbb1)||_0x3eedd2[_0x17aaed(0x20b)]&&_0x3eedd2[_0x17aaed(0x20b)][_0x17aaed(0x1f2)]()[_0x17aaed(0x1db)](_0x31dbb1);if(!_0x2e2916)continue;}const _0x391835=new Map();for(const _0x254652 of _0x1bc0f8){const _0x4e0bf4=_0x254652[_0x17aaed(0x1de)];!_0x391835['has'](_0x4e0bf4)&&_0x391835[_0x17aaed(0x1df)](_0x4e0bf4,{'count':0x0,'amountUSDT':0x0,'amountAfterCommissionUSDT':0x0,'commission':_0x254652['commission']});const _0x53c56=_0x391835[_0x17aaed(0x229)](_0x4e0bf4);_0x53c56['count']++,_0x53c56[_0x17aaed(0x206)]+=_0x254652[_0x17aaed(0x206)],_0x53c56[_0x17aaed(0x1f6)]+=_0x254652[_0x17aaed(0x1f6)];}const _0x217ebd=Array[_0x17aaed(0x18d)](_0x391835[_0x17aaed(0x1e5)]())['map'](([_0x32f82e,_0x11f83e])=>({'gateway':_0x32f82e[_0x17aaed(0x192)](0x0)['toUpperCase']()+_0x32f82e[_0x17aaed(0x185)](0x1),'count':_0x11f83e[_0x17aaed(0x15e)],'amountUSDT':Math[_0x17aaed(0x1dc)](_0x11f83e[_0x17aaed(0x206)]*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x17aaed(0x1dc)](_0x11f83e[_0x17aaed(0x1f6)]*0x64)/0x64,'commission':_0x11f83e[_0x17aaed(0x20d)]})),_0x438e46=_0x1bc0f8[_0x17aaed(0x17d)]((_0xdd23e3,_0x1c1682)=>{const _0x3a4ad1=_0x17aaed;return _0x1c1682[_0x3a4ad1(0x20e)]<_0xdd23e3?_0x1c1682[_0x3a4ad1(0x20e)]:_0xdd23e3;},_0x1bc0f8[0x0]['paidAt']);_0x208e16[_0x17aaed(0x1e0)]({'id':_0x3eedd2['id'],'fullName':_0x3eedd2[_0x17aaed(0x1f4)],'username':_0x3eedd2[_0x17aaed(0x1c0)],'telegramId':_0x3eedd2['telegram'],'merchantUrl':_0x3eedd2['shopUrl'],'wallets':{'usdtPolygonWallet':_0x3eedd2[_0x17aaed(0x22a)],'usdtTrcWallet':_0x3eedd2['usdtTrcWallet'],'usdtErcWallet':_0x3eedd2[_0x17aaed(0x227)],'usdcPolygonWallet':_0x3eedd2[_0x17aaed(0x1cd)]},'totalAmountUSDT':Math[_0x17aaed(0x1dc)](_0x270767*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x17aaed(0x1dc)](_0x3d8d6b*0x64)/0x64,'paymentsCount':_0x1bc0f8[_0x17aaed(0x21a)],'oldestPaymentDate':_0x438e46,'gatewayBreakdown':_0x217ebd});}_0x208e16[_0x17aaed(0x16d)]((_0x273c1d,_0x117ed7)=>_0x117ed7['totalAmountAfterCommissionUSDT']-_0x273c1d['totalAmountAfterCommissionUSDT']);const _0x275877=_0x208e16['length'],_0x589113=_0x208e16[_0x17aaed(0x17d)]((_0x145df8,_0x5f0a9c)=>_0x145df8+_0x5f0a9c[_0x17aaed(0x18c)],0x0),_0x7ff9de=_0x208e16['reduce']((_0x41326f,_0x197fb7)=>_0x41326f+_0x197fb7[_0x17aaed(0x224)],0x0),_0x5e294c=(_0x831c99-0x1)*_0x41ce2d,_0x48254f=_0x208e16[_0x17aaed(0x185)](_0x5e294c,_0x5e294c+_0x41ce2d);return console[_0x17aaed(0x201)]('‚úÖ\x20Returning\x20'+_0x48254f[_0x17aaed(0x21a)]+_0x17aaed(0x205)+_0x275877+'\x20total'),console[_0x17aaed(0x201)](_0x17aaed(0x16b)+_0x589113[_0x17aaed(0x21f)](0x2)+_0x17aaed(0x164)+_0x7ff9de[_0x17aaed(0x21f)](0x2)+'\x20USDT\x20after\x20commission)'),{'merchants':_0x48254f,'pagination':{'page':_0x831c99,'limit':_0x41ce2d,'total':_0x275877,'totalPages':Math[_0x17aaed(0x1e8)](_0x275877/_0x41ce2d)},'summary':{'totalMerchants':_0x275877,'totalAmountUSDT':Math[_0x17aaed(0x1dc)](_0x589113*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x17aaed(0x1dc)](_0x7ff9de*0x64)/0x64}};}async[a33_0x3109ad(0x1bf)](){const _0x1593f7=a33_0x3109ad;console[_0x1593f7(0x201)](_0x1593f7(0x1b9));const _0x474f4e=await database_1[_0x1593f7(0x1e9)][_0x1593f7(0x1c7)][_0x1593f7(0x214)]({'where':{'status':{'in':[_0x1593f7(0x1a6),_0x1593f7(0x1ba),_0x1593f7(0x1b2)]}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'status':!![],'gateway':!![],'paidAt':!![],'merchantPaid':!![],'createdAt':!![],'chargebackAmount':!![],'shop':{'select':{'gatewaySettings':!![]}}}});console[_0x1593f7(0x201)](_0x1593f7(0x202)+_0x474f4e[_0x1593f7(0x21a)]+_0x1593f7(0x15c));const _0x498761=new Date(),_0x269847=new Date(_0x498761[_0x1593f7(0x1cc)](),_0x498761[_0x1593f7(0x1ea)](),0x1),_0x1be9a5=new Date(_0x498761[_0x1593f7(0x1cc)](),_0x498761['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7);let _0x45a5c2=0x0,_0x5ad3c4=0x0,_0xb57dae=0x0,_0x46bc9b=0x0;for(const _0x377cb2 of _0x474f4e){const _0x52956a=this['calculateEffectiveAmount'](_0x377cb2);if(_0x52956a===0x0)continue;let _0x5048b4,_0x4cf387;if(_0x377cb2[_0x1593f7(0x1f5)]===_0x1593f7(0x1b2))_0x5048b4=Math[_0x1593f7(0x1fa)](_0x52956a),_0x4cf387=-_0x5048b4;else{_0x5048b4=await currencyService_1[_0x1593f7(0x172)][_0x1593f7(0x18f)](_0x377cb2['amount'],_0x377cb2[_0x1593f7(0x193)]);const _0x2d6f57=this['getGatewaySettings'](_0x377cb2[_0x1593f7(0x162)],_0x377cb2[_0x1593f7(0x1de)]);_0x4cf387=this[_0x1593f7(0x196)](_0x5048b4,_0x2d6f57['commission']);}_0x377cb2['merchantPaid']&&(_0x45a5c2+=_0x4cf387,_0x377cb2['paidAt']&&_0x377cb2[_0x1593f7(0x20e)]>=_0x269847&&_0x377cb2[_0x1593f7(0x20e)]<=_0x1be9a5&&(_0xb57dae+=_0x4cf387)),_0x377cb2[_0x1593f7(0x1f5)]===_0x1593f7(0x1a6)&&this['isEligibleForPayout'](_0x377cb2)&&(_0x5ad3c4+=_0x4cf387,_0x46bc9b+=_0x5048b4);}const _0x514e28={'totalPayout':Math['round'](_0x45a5c2*0x64)/0x64,'awaitingPayout':Math[_0x1593f7(0x1dc)](_0x5ad3c4*0x64)/0x64,'thisMonth':Math[_0x1593f7(0x1dc)](_0xb57dae*0x64)/0x64,'availableBalance':Math[_0x1593f7(0x1dc)](_0x46bc9b*0x64)/0x64};return console[_0x1593f7(0x201)](_0x1593f7(0x154)),console[_0x1593f7(0x201)](_0x1593f7(0x174)+_0x514e28[_0x1593f7(0x1da)]+_0x1593f7(0x207)),console[_0x1593f7(0x201)]('‚è≥\x20Awaiting\x20Payout:\x20'+_0x514e28[_0x1593f7(0x19c)]+_0x1593f7(0x1d5)),console[_0x1593f7(0x201)](_0x1593f7(0x189)+_0x514e28[_0x1593f7(0x20f)]+_0x1593f7(0x1fd)),console[_0x1593f7(0x201)]('üí∞\x20Available\x20Balance:\x20'+_0x514e28[_0x1593f7(0x1c1)]+_0x1593f7(0x1fd)),_0x514e28;}async[a33_0x3109ad(0x197)](_0x21368f){const _0x13488a=a33_0x3109ad,_0xd53584=this[_0x13488a(0x15f)](_0x21368f),_0x13f7ef=new Date();_0x13f7ef[_0x13488a(0x16f)](_0x13f7ef[_0x13488a(0x1e6)]()-_0xd53584),console[_0x13488a(0x201)](_0x13488a(0x220)+_0x21368f+'\x20('+_0xd53584+_0x13488a(0x1d3));const _0x524d90=await database_1[_0x13488a(0x1e9)][_0x13488a(0x162)][_0x13488a(0x15e)]({'where':{'status':_0x13488a(0x215)}}),_0x127e8f=await database_1[_0x13488a(0x1e9)][_0x13488a(0x1c7)][_0x13488a(0x15e)](),_0x4a3e55=await database_1['default']['payment'][_0x13488a(0x214)]({'where':{'status':{'in':[_0x13488a(0x1a6),'REFUND',_0x13488a(0x1b2)]}},'select':{'amount':!![],'currency':!![],'status':!![],'chargebackAmount':!![],'createdAt':!![]}});console['log'](_0x13488a(0x202)+_0x4a3e55[_0x13488a(0x21a)]+_0x13488a(0x1b0));const _0xcde234=await Promise[_0x13488a(0x22b)](_0x4a3e55[_0x13488a(0x218)](async _0x8d5cbd=>{const _0x30dc4e=_0x13488a,_0x196fd0=this[_0x30dc4e(0x212)](_0x8d5cbd);if(_0x196fd0===0x0)return{'amount':0x0,'createdAt':_0x8d5cbd[_0x30dc4e(0x1a1)]};let _0xe79fee;return _0x8d5cbd[_0x30dc4e(0x1f5)]==='CHARGEBACK'?_0xe79fee=-Math['abs'](_0x196fd0):_0xe79fee=await currencyService_1[_0x30dc4e(0x172)][_0x30dc4e(0x18f)](_0x8d5cbd['amount'],_0x8d5cbd['currency']),{'amount':_0xe79fee,'createdAt':_0x8d5cbd['createdAt']};})),_0x352602=_0xcde234[_0x13488a(0x17d)]((_0x1f4bee,_0x4ec0e2)=>_0x1f4bee+_0x4ec0e2[_0x13488a(0x219)],0x0),_0x2f5493=_0x127e8f>0x0?_0x352602/_0x127e8f:0x0;console[_0x13488a(0x201)](_0x13488a(0x18a)+_0x352602[_0x13488a(0x21f)](0x2)+_0x13488a(0x207)),console[_0x13488a(0x201)]('üìà\x20Average\x20payment:\x20'+_0x2f5493[_0x13488a(0x21f)](0x2)+_0x13488a(0x1fd));const _0x183969=await database_1[_0x13488a(0x1e9)][_0x13488a(0x15b)]`
      SELECT 
        DATE(created_at) as date,
        array_agg(
          json_build_object(
            'amount', amount,
            'currency', currency,
            'status', status,
            'chargeback_amount', chargeback_amount
          )
        ) as payments
      FROM payments 
      WHERE created_at >= ${_0x13f7ef}
        AND status IN ('PAID', 'REFUND', 'CHARGEBACK')
      GROUP BY DATE(created_at)
      ORDER BY date ASC
    `;console[_0x13488a(0x201)]('üìÖ\x20Processing\x20daily\x20stats\x20for\x20'+_0x183969[_0x13488a(0x21a)]+_0x13488a(0x204));const _0x105c74=await Promise[_0x13488a(0x22b)](_0x183969['map'](async _0x26e7bf=>{const _0x8e4887=_0x13488a,_0x98f45e=await Promise[_0x8e4887(0x22b)](_0x26e7bf['payments'][_0x8e4887(0x218)](async _0x20f4b3=>{const _0xa07e89=_0x8e4887,_0x22db2c=this[_0xa07e89(0x212)](_0x20f4b3);if(_0x22db2c===0x0)return 0x0;return _0x20f4b3[_0xa07e89(0x1f5)]===_0xa07e89(0x1b2)?-Math['abs'](_0x22db2c):await currencyService_1[_0xa07e89(0x172)][_0xa07e89(0x18f)](_0x20f4b3[_0xa07e89(0x219)],_0x20f4b3['currency']);})),_0x5a09ca=_0x98f45e[_0x8e4887(0x17d)]((_0x2d78a8,_0x4d5f96)=>_0x2d78a8+_0x4d5f96,0x0);return{'date':_0x26e7bf[_0x8e4887(0x1b7)][_0x8e4887(0x1c6)]()[_0x8e4887(0x171)]('T')[0x0],'amount':_0x5a09ca};})),_0x275c6b=this[_0x13488a(0x1d7)](_0x13f7ef,new Date()),_0x4b4e0e=new Map(_0x105c74[_0x13488a(0x218)](_0x202f40=>[_0x202f40[_0x13488a(0x1b7)],_0x202f40[_0x13488a(0x219)]])),_0x2d1bfd=_0x275c6b['map'](_0x2d84b7=>({'date':_0x2d84b7,'amount':_0x4b4e0e['get'](_0x2d84b7)||0x0}));return console['log'](_0x13488a(0x180)),console[_0x13488a(0x201)](_0x13488a(0x1cf)+_0x524d90),console[_0x13488a(0x201)]('üí≥\x20Total\x20payments:\x20'+_0x127e8f),console['log'](_0x13488a(0x1ef)+_0x2d1bfd[_0x13488a(0x21a)]),{'totalRevenue':Math[_0x13488a(0x1dc)](_0x352602*0x64)/0x64,'totalUsers':_0x524d90,'totalPayments':_0x127e8f,'averagePayment':Math['round'](_0x2f5493*0x64)/0x64,'dailyRevenue':_0x2d1bfd};}async['getAllPayments'](_0x5a9f1a){const _0x6bd4a5=a33_0x3109ad,{page:_0x1ef4be,limit:_0x3f388d,status:_0x4b8e26,gateway:_0x330dfe,shopId:_0x461eda,dateFrom:_0x49cabe,dateTo:_0x262cf3,search:_0x2330a4}=_0x5a9f1a,_0x4cd5af=(_0x1ef4be-0x1)*_0x3f388d;console[_0x6bd4a5(0x201)](_0x6bd4a5(0x16c),_0x5a9f1a);const _0x14cb73={};_0x4b8e26&&(_0x14cb73[_0x6bd4a5(0x1f5)]=_0x4b8e26[_0x6bd4a5(0x168)]());if(_0x330dfe){if((0x0,gateway_1['isValidGatewayId'])(_0x330dfe)){const _0x534350=(0x0,gateway_1[_0x6bd4a5(0x1e3)])(_0x330dfe);_0x534350&&(_0x14cb73[_0x6bd4a5(0x1de)]=_0x534350);}else _0x14cb73[_0x6bd4a5(0x1de)]=_0x330dfe[_0x6bd4a5(0x1f2)]();}_0x461eda&&(_0x14cb73[_0x6bd4a5(0x19e)]=_0x461eda);(_0x49cabe||_0x262cf3)&&(_0x14cb73[_0x6bd4a5(0x1a1)]={},_0x49cabe&&(_0x14cb73['createdAt'][_0x6bd4a5(0x1e2)]=new Date(_0x49cabe)),_0x262cf3&&(_0x14cb73[_0x6bd4a5(0x1a1)][_0x6bd4a5(0x226)]=new Date(_0x262cf3)));_0x2330a4&&(_0x14cb73['OR']=[{'orderId':{'contains':_0x2330a4,'mode':_0x6bd4a5(0x1d2)}},{'gatewayOrderId':{'contains':_0x2330a4,'mode':_0x6bd4a5(0x1d2)}},{'gatewayPaymentId':{'contains':_0x2330a4,'mode':_0x6bd4a5(0x1d2)}},{'customerEmail':{'contains':_0x2330a4,'mode':'insensitive'}},{'customerName':{'contains':_0x2330a4,'mode':_0x6bd4a5(0x1d2)}},{'shop':{'name':{'contains':_0x2330a4,'mode':_0x6bd4a5(0x1d2)}}},{'shop':{'username':{'contains':_0x2330a4,'mode':_0x6bd4a5(0x1d2)}}}]);const [_0x1cffbd,_0x2d7617]=await Promise[_0x6bd4a5(0x22b)]([database_1['default'][_0x6bd4a5(0x1c7)]['findMany']({'where':_0x14cb73,'skip':_0x4cd5af,'take':_0x3f388d,'orderBy':{'createdAt':_0x6bd4a5(0x1d9)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default']['payment']['count']({'where':_0x14cb73})]);console[_0x6bd4a5(0x201)](_0x6bd4a5(0x211)+_0x1cffbd['length']+_0x6bd4a5(0x157)+_0x2d7617+'\x20total');const _0x51d091=_0x1cffbd['map'](_0x20bfa0=>({'id':_0x20bfa0['id'],'shopId':_0x20bfa0[_0x6bd4a5(0x19e)],'shopName':_0x20bfa0[_0x6bd4a5(0x162)][_0x6bd4a5(0x1f4)],'shopUsername':_0x20bfa0[_0x6bd4a5(0x162)][_0x6bd4a5(0x1c0)],'gateway':_0x20bfa0[_0x6bd4a5(0x1de)],'orderId':_0x20bfa0['orderId'],'gatewayOrderId':_0x20bfa0[_0x6bd4a5(0x194)],'amount':_0x20bfa0[_0x6bd4a5(0x219)],'currency':_0x20bfa0[_0x6bd4a5(0x193)],'sourceCurrency':_0x20bfa0[_0x6bd4a5(0x21b)],'status':_0x20bfa0['status'],'usage':_0x20bfa0[_0x6bd4a5(0x1c8)],'externalPaymentUrl':_0x20bfa0[_0x6bd4a5(0x1bb)],'gatewayPaymentId':_0x20bfa0[_0x6bd4a5(0x1be)],'customerEmail':_0x20bfa0[_0x6bd4a5(0x222)],'customerName':_0x20bfa0[_0x6bd4a5(0x16e)],'cardLast4':_0x20bfa0[_0x6bd4a5(0x21c)],'paymentMethod':_0x20bfa0[_0x6bd4a5(0x1ed)],'bankId':_0x20bfa0[_0x6bd4a5(0x1fe)],'remitterIban':_0x20bfa0['remitterIban'],'remitterName':_0x20bfa0['remitterName'],'chargebackAmount':_0x20bfa0[_0x6bd4a5(0x1a3)],'adminNotes':_0x20bfa0['adminNotes'],'statusChangedBy':_0x20bfa0[_0x6bd4a5(0x161)],'statusChangedAt':_0x20bfa0[_0x6bd4a5(0x16a)],'createdAt':_0x20bfa0[_0x6bd4a5(0x1a1)],'updatedAt':_0x20bfa0[_0x6bd4a5(0x228)],'expiresAt':_0x20bfa0[_0x6bd4a5(0x181)]}));return{'payments':_0x51d091,'pagination':{'page':_0x1ef4be,'limit':_0x3f388d,'total':_0x2d7617,'totalPages':Math[_0x6bd4a5(0x1e8)](_0x2d7617/_0x3f388d)}};}async[a33_0x3109ad(0x1ec)](_0x52940c){const _0x2dc39f=a33_0x3109ad;console['log'](_0x2dc39f(0x1ee)+_0x52940c);const _0x2b2515=await database_1[_0x2dc39f(0x1e9)][_0x2dc39f(0x1c7)][_0x2dc39f(0x186)]({'where':{'id':_0x52940c},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}},'webhookLogs':{'orderBy':{'createdAt':_0x2dc39f(0x1d9)},'take':0xa,'select':{'id':!![],'event':!![],'statusCode':!![],'retryCount':!![],'createdAt':!![]}}}});if(!_0x2b2515)return console['log'](_0x2dc39f(0x1c5)+_0x52940c),null;return console[_0x2dc39f(0x201)](_0x2dc39f(0x225)+_0x2b2515[_0x2dc39f(0x213)]+'\x20('+_0x2b2515[_0x2dc39f(0x1f5)]+')'),{'id':_0x2b2515['id'],'shopId':_0x2b2515['shopId'],'shopName':_0x2b2515[_0x2dc39f(0x162)][_0x2dc39f(0x1f4)],'shopUsername':_0x2b2515[_0x2dc39f(0x162)][_0x2dc39f(0x1c0)],'gateway':_0x2b2515[_0x2dc39f(0x1de)],'orderId':_0x2b2515[_0x2dc39f(0x213)],'gatewayOrderId':_0x2b2515[_0x2dc39f(0x194)],'amount':_0x2b2515['amount'],'currency':_0x2b2515[_0x2dc39f(0x193)],'sourceCurrency':_0x2b2515[_0x2dc39f(0x21b)],'status':_0x2b2515[_0x2dc39f(0x1f5)],'usage':_0x2b2515[_0x2dc39f(0x1c8)],'externalPaymentUrl':_0x2b2515[_0x2dc39f(0x1bb)],'gatewayPaymentId':_0x2b2515[_0x2dc39f(0x1be)],'customerEmail':_0x2b2515['customerEmail'],'customerName':_0x2b2515['customerName'],'cardLast4':_0x2b2515[_0x2dc39f(0x21c)],'paymentMethod':_0x2b2515[_0x2dc39f(0x1ed)],'bankId':_0x2b2515['bankId'],'remitterIban':_0x2b2515[_0x2dc39f(0x15d)],'remitterName':_0x2b2515[_0x2dc39f(0x21d)],'chargebackAmount':_0x2b2515[_0x2dc39f(0x1a3)],'adminNotes':_0x2b2515[_0x2dc39f(0x1a4)],'statusChangedBy':_0x2b2515[_0x2dc39f(0x161)],'statusChangedAt':_0x2b2515[_0x2dc39f(0x16a)],'createdAt':_0x2b2515[_0x2dc39f(0x1a1)],'updatedAt':_0x2b2515[_0x2dc39f(0x228)],'expiresAt':_0x2b2515[_0x2dc39f(0x181)],'webhookLogs':_0x2b2515[_0x2dc39f(0x1ca)]};}async['updatePaymentStatus'](_0x33b542,_0x39236f,_0x3c2266,_0x5dd6a0){const _0xa3c58e=a33_0x3109ad;console[_0xa3c58e(0x201)](_0xa3c58e(0x176)+_0x33b542+_0xa3c58e(0x1b5)+_0x39236f);const _0x2d680b=['PENDING',_0xa3c58e(0x21e),'PAID',_0xa3c58e(0x17c),'FAILED',_0xa3c58e(0x1ba),_0xa3c58e(0x1b2)];if(!_0x2d680b[_0xa3c58e(0x1db)](_0x39236f['toUpperCase']()))throw new Error('Invalid\x20status.\x20Valid\x20statuses:\x20'+_0x2d680b['join'](',\x20'));const _0x3be9c2=await database_1[_0xa3c58e(0x1e9)]['payment']['findUnique']({'where':{'id':_0x33b542},'select':{'id':!![],'status':!![],'orderId':!![]}});if(!_0x3be9c2)throw new Error(_0xa3c58e(0x1c9));if(_0x39236f[_0xa3c58e(0x168)]()===_0xa3c58e(0x1b2)){if(!_0x5dd6a0||_0x5dd6a0<=0x0)throw new Error(_0xa3c58e(0x159));console[_0xa3c58e(0x201)](_0xa3c58e(0x1a8)+_0x5dd6a0+_0xa3c58e(0x17f));}const _0x334929={'status':_0x39236f[_0xa3c58e(0x168)](),'updatedAt':new Date()};_0x3c2266&&(_0x334929[_0xa3c58e(0x1a4)]=_0x3c2266);_0x39236f[_0xa3c58e(0x168)]()==='CHARGEBACK'&&_0x5dd6a0&&(_0x334929[_0xa3c58e(0x1a3)]=_0x5dd6a0);const _0x11315a=await database_1[_0xa3c58e(0x1e9)][_0xa3c58e(0x1c7)][_0xa3c58e(0x1ff)]({'where':{'id':_0x33b542},'data':_0x334929,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});return await database_1[_0xa3c58e(0x1e9)]['webhookLog'][_0xa3c58e(0x19b)]({'data':{'paymentId':_0x33b542,'shopId':_0x11315a[_0xa3c58e(0x19e)],'event':'status_update','statusCode':0xc8,'responseBody':JSON['stringify']({'oldStatus':_0x3be9c2['status'],'newStatus':_0x39236f['toUpperCase'](),'notes':_0x3c2266||null,'chargebackAmount':_0x5dd6a0||null,'timestamp':new Date()['toISOString']()})}}),console[_0xa3c58e(0x201)]('‚úÖ\x20Payment\x20'+_0x3be9c2[_0xa3c58e(0x213)]+_0xa3c58e(0x1a7)+_0x3be9c2[_0xa3c58e(0x1f5)]+_0xa3c58e(0x1af)+_0x39236f['toUpperCase']()),_0x39236f[_0xa3c58e(0x168)]()===_0xa3c58e(0x1b2)&&console['log'](_0xa3c58e(0x1b8)+_0x5dd6a0+_0xa3c58e(0x187)),{'id':_0x11315a['id'],'shopId':_0x11315a['shopId'],'shopName':_0x11315a[_0xa3c58e(0x162)][_0xa3c58e(0x1f4)],'shopUsername':_0x11315a[_0xa3c58e(0x162)]['username'],'gateway':_0x11315a[_0xa3c58e(0x1de)],'orderId':_0x11315a['orderId'],'gatewayOrderId':_0x11315a[_0xa3c58e(0x194)],'amount':_0x11315a[_0xa3c58e(0x219)],'currency':_0x11315a[_0xa3c58e(0x193)],'sourceCurrency':_0x11315a['sourceCurrency'],'status':_0x11315a[_0xa3c58e(0x1f5)],'usage':_0x11315a[_0xa3c58e(0x1c8)],'externalPaymentUrl':_0x11315a[_0xa3c58e(0x1bb)],'gatewayPaymentId':_0x11315a['gatewayPaymentId'],'customerEmail':_0x11315a[_0xa3c58e(0x222)],'customerName':_0x11315a[_0xa3c58e(0x16e)],'cardLast4':_0x11315a['cardLast4'],'paymentMethod':_0x11315a[_0xa3c58e(0x1ed)],'bankId':_0x11315a[_0xa3c58e(0x1fe)],'remitterIban':_0x11315a[_0xa3c58e(0x15d)],'remitterName':_0x11315a[_0xa3c58e(0x21d)],'chargebackAmount':_0x11315a[_0xa3c58e(0x1a3)],'adminNotes':_0x11315a[_0xa3c58e(0x1a4)],'statusChangedBy':_0x11315a['statusChangedBy'],'statusChangedAt':_0x11315a[_0xa3c58e(0x16a)],'createdAt':_0x11315a[_0xa3c58e(0x1a1)],'updatedAt':_0x11315a['updatedAt'],'expiresAt':_0x11315a[_0xa3c58e(0x181)]};}async['getAllUsers'](_0x271013){const _0x1594da=a33_0x3109ad,{page:_0x6b8307,limit:_0x33b856,status:_0x38cf5c}=_0x271013,_0x3592c4=(_0x6b8307-0x1)*_0x33b856,_0x1e37f4={};_0x38cf5c&&(_0x1e37f4[_0x1594da(0x1f5)]=_0x38cf5c[_0x1594da(0x168)]());console['log'](_0x1594da(0x1b3),{'page':_0x6b8307,'limit':_0x33b856,'status':_0x38cf5c,'where':_0x1e37f4});const [_0x163219,_0x48eca4]=await Promise[_0x1594da(0x22b)]([database_1[_0x1594da(0x1e9)][_0x1594da(0x162)][_0x1594da(0x214)]({'where':_0x1e37f4,'skip':_0x3592c4,'take':_0x33b856,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x1594da(0x1d9)}}),database_1['default'][_0x1594da(0x162)][_0x1594da(0x15e)]({'where':_0x1e37f4})]);console[_0x1594da(0x201)](_0x1594da(0x211)+_0x163219[_0x1594da(0x21a)]+_0x1594da(0x22c)+_0x48eca4+_0x1594da(0x1ad));const _0x72413a=_0x163219[_0x1594da(0x218)](_0x34e883=>({'id':_0x34e883['id'],'fullName':_0x34e883['name'],'username':_0x34e883[_0x1594da(0x1c0)],'telegramId':_0x34e883[_0x1594da(0x20b)],'merchantUrl':_0x34e883[_0x1594da(0x1d8)],'gateways':_0x34e883['paymentGateways']?JSON[_0x1594da(0x195)](_0x34e883[_0x1594da(0x1cb)]):null,'gatewaySettings':_0x34e883[_0x1594da(0x199)]?JSON[_0x1594da(0x195)](_0x34e883['gatewaySettings']):null,'publicKey':_0x34e883[_0x1594da(0x1d6)],'wallets':{'usdtPolygonWallet':_0x34e883['usdtPolygonWallet'],'usdtTrcWallet':_0x34e883[_0x1594da(0x1f8)],'usdtErcWallet':_0x34e883[_0x1594da(0x227)],'usdcPolygonWallet':_0x34e883[_0x1594da(0x1cd)]},'status':_0x34e883['status'],'createdAt':_0x34e883[_0x1594da(0x1a1)]}));return{'users':_0x72413a,'pagination':{'page':_0x6b8307,'limit':_0x33b856,'total':_0x48eca4,'totalPages':Math['ceil'](_0x48eca4/_0x33b856)}};}async[a33_0x3109ad(0x17a)](_0x10c3f2){const _0x28248b=a33_0x3109ad;return await this[_0x28248b(0x184)]['getUserById'](_0x10c3f2);}async[a33_0x3109ad(0x1fc)](_0x3c141b){return await this['userService']['createUser'](_0x3c141b);}async['updateUser'](_0x42aecf,_0x5b62f6){const _0x414e62=a33_0x3109ad;return await this['userService'][_0x414e62(0x1ab)](_0x42aecf,_0x5b62f6);}async[a33_0x3109ad(0x208)](_0x40d0af){const _0xcf0c23=a33_0x3109ad;return await this[_0xcf0c23(0x184)][_0xcf0c23(0x208)](_0x40d0af);}async[a33_0x3109ad(0x158)](_0x562cca){const _0x3bb03d=a33_0x3109ad;console[_0x3bb03d(0x201)](_0x3bb03d(0x178)+_0x562cca);const _0x2f1d82=await database_1[_0x3bb03d(0x1e9)][_0x3bb03d(0x162)]['findUnique']({'where':{'id':_0x562cca},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x2f1d82)throw new Error('User\x20not\x20found');if(_0x2f1d82[_0x3bb03d(0x1f5)]===_0x3bb03d(0x167))throw new Error('User\x20is\x20already\x20suspended');const _0x348799=await this[_0x3bb03d(0x184)]['updateUser'](_0x562cca,{'status':_0x3bb03d(0x167)});return console[_0x3bb03d(0x201)]('‚úÖ\x20User\x20'+_0x2f1d82[_0x3bb03d(0x1c0)]+_0x3bb03d(0x160)),_0x348799;}async[a33_0x3109ad(0x1ac)](_0x265adc){const _0x467c2c=a33_0x3109ad;console['log'](_0x467c2c(0x198)+_0x265adc);const _0x5274e6=await database_1[_0x467c2c(0x1e9)][_0x467c2c(0x162)]['findUnique']({'where':{'id':_0x265adc},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x5274e6)throw new Error(_0x467c2c(0x1e4));if(_0x5274e6[_0x467c2c(0x1f5)]===_0x467c2c(0x215))throw new Error(_0x467c2c(0x1dd));const _0x3b763c=await this['userService'][_0x467c2c(0x1ab)](_0x265adc,{'status':'ACTIVE'});return console[_0x467c2c(0x201)](_0x467c2c(0x188)+_0x5274e6[_0x467c2c(0x1c0)]+_0x467c2c(0x20c)),_0x3b763c;}}function a33_0x3430(){const _0x4cda15=['error','üí∏\x20Total\x20Payout:\x20',',\x20amount:\x20','üîÑ\x20Updating\x20payment\x20','getTime','üö´\x20Suspending\x20user:\x20','__importDefault','getUserById','4842NzfWVv','EXPIRED','reduce','10941HUFzgO','\x20USDT\x20(penalty\x20amount)','‚úÖ\x20Admin\x20statistics\x20generated\x20successfully','expiresAt','getGatewaySettings','679509XFVcJZ','userService','slice','findUnique','\x20USDT\x20(will\x20be\x20deducted\x20from\x20merchant\x20balance)','‚úÖ\x20User\x20','üìÖ\x20This\x20Month:\x20','üíµ\x20Total\x20revenue:\x20','‚úÖ\x20Marked\x20','totalAmountUSDT','from','90d','convertToUSDT','30d','__esModule','charAt','currency','gatewayOrderId','parse','calculateAmountAfterCommission','getSystemStatistics','‚úÖ\x20Activating\x20user:\x20','gatewaySettings','txid','create','awaitingPayout','telegramBotService','shopId','./userService','1483440mDSHBf','createdAt','../types/gateway','chargebackAmount','adminNotes','UserService','PAID','\x20status\x20updated\x20from\x20','üí∏\x20Chargeback\x20amount:\x20','COMPLETED','payout','updateUser','activateUser','\x20total','deletePayout','\x20to\x20','\x20payments\x20for\x20revenue\x20calculation\x20(PAID/REFUND/CHARGEBACK)','\x20payments\x20as\x20paid\x20out','CHARGEBACK','üìã\x20Getting\x20users\x20with\x20filters:','sendPayoutNotification','\x20status\x20to:\x20','../config/database','date','üí∏\x20Chargeback\x20penalty:\x20','üìä\x20Calculating\x20admin\x20payout\x20statistics...','REFUND','externalPaymentUrl','AdminService','üîÑ\x20Marking\x20payments\x20as\x20paid\x20out\x20for\x20shop\x20','gatewayPaymentId','getPayoutStats','username','availableBalance','üìã\x20Getting\x20payouts\x20with\x20filters:','\x20USDT\x20via\x20','Error\x20parsing\x20gateway\x20settings:','‚ùå\x20Payment\x20not\x20found:\x20','toISOString','payment','usage','Payment\x20not\x20found','webhookLogs','paymentGateways','getFullYear','usdcPolygonWallet','updateMany','üë•\x20Total\x20users:\x20','network','961515JBKwwU','insensitive','\x20days)','100EXCpOM','\x20USDT\x20(—Ç–æ–ª—å–∫–æ\x20PAID\x20–ø–ª–∞—Ç–µ–∂–∏)','publicKey','generateDateRange','shopUrl','desc','totalPayout','includes','round','User\x20is\x20already\x20active','gateway','set','push','markPaymentsAsPaidOut','gte','getGatewayNameById','User\x20not\x20found','entries','getDate','‚úÖ\x20Payout\x20','ceil','default','getMonth','merchantPaid','getPaymentById','paymentMethod','üîç\x20Getting\x20payment\x20by\x20ID:\x20','üìä\x20Daily\x20revenue\x20entries:\x20','üîç\x20Getting\x20payout\x20by\x20ID:\x20','getAllPayouts','toLowerCase','./telegramBotService','name','status','amountAfterCommissionUSDT','getMerchantsAwaitingPayout','usdtTrcWallet','isEligibleForPayout','abs','1677863wZuiXa','createUser','\x20USDT','bankId','update','üóëÔ∏è\x20Deleting\x20payout:\x20','log','üí∞\x20Found\x20','Shop\x20is\x20not\x20active','\x20days','\x20merchants\x20out\x20of\x20','amountUSDT','\x20USDT\x20(–≤–∫–ª—é—á–∞—è\x20—à—Ç—Ä–∞—Ñ—ã\x20chargeback)','deleteUser','notes','Failed\x20to\x20send\x20Telegram\x20payout\x20notification:','telegram','\x20activated\x20successfully','commission','paidAt','thisMonth','12ejVFOf','üìä\x20Found\x20','calculateEffectiveAmount','orderId','findMany','ACTIVE','completed','üí∏\x20Creating\x20payout\x20for\x20shop\x20','map','amount','length','sourceCurrency','cardLast4','remitterName','PROCESSING','toFixed','üìä\x20Generating\x20admin\x20statistics\x20for\x20period:\x20','Shop\x20not\x20found','customerEmail','1FwFdqp','totalAmountAfterCommissionUSDT','‚úÖ\x20Found\x20payment:\x20','lte','usdtErcWallet','updatedAt','get','usdtPolygonWallet','all','\x20users\x20out\x20of\x20','‚úÖ\x20Payout\x20statistics\x20calculated:','4978164PpUMNp','9GQTbPs','\x20payments\x20out\x20of\x20','suspendUser','Chargeback\x20amount\x20is\x20required\x20and\x20must\x20be\x20positive\x20(amount\x20in\x20USDT)','delete','$queryRaw','\x20payments\x20for\x20analysis\x20(PAID/REFUND/CHARGEBACK)','remitterIban','count','getPeriodDays','\x20suspended\x20successfully','statusChangedBy','shop','getPayoutById','\x20USDT\x20(','Payout\x20not\x20found','size','SUSPENDED','toUpperCase','2611876jnmHpq','statusChangedAt','üí∞\x20Total\x20amount:\x20','üìã\x20Getting\x20payments\x20with\x20filters:','sort','customerName','setDate','payoutDelay','split','currencyService'];a33_0x3430=function(){return _0x4cda15;};return a33_0x3430();}function a33_0x44dd(_0xc2b4aa,_0xb804e0){const _0x3430f4=a33_0x3430();return a33_0x44dd=function(_0x44dd24,_0x3b9961){_0x44dd24=_0x44dd24-0x154;let _0x24a7f2=_0x3430f4[_0x44dd24];return _0x24a7f2;},a33_0x44dd(_0xc2b4aa,_0xb804e0);}exports[a33_0x3109ad(0x1bc)]=AdminService;