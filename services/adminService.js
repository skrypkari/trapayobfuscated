'use strict';const a35_0x4e8a9b=a35_0x367c;(function(_0xa553f,_0x26dd32){const _0x20e9be=a35_0x367c,_0x5f3cbc=_0xa553f();while(!![]){try{const _0x485b2b=-parseInt(_0x20e9be(0x1cd))/0x1*(parseInt(_0x20e9be(0x1c7))/0x2)+-parseInt(_0x20e9be(0x14f))/0x3+parseInt(_0x20e9be(0x1c0))/0x4+parseInt(_0x20e9be(0x11c))/0x5*(-parseInt(_0x20e9be(0x244))/0x6)+-parseInt(_0x20e9be(0x125))/0x7*(-parseInt(_0x20e9be(0x141))/0x8)+-parseInt(_0x20e9be(0x20f))/0x9+parseInt(_0x20e9be(0x202))/0xa;if(_0x485b2b===_0x26dd32)break;else _0x5f3cbc['push'](_0x5f3cbc['shift']());}catch(_0x360259){_0x5f3cbc['push'](_0x5f3cbc['shift']());}}}(a35_0x438d,0x90b31));function a35_0x367c(_0x2ab9ea,_0x5853f2){const _0x438d2f=a35_0x438d();return a35_0x367c=function(_0x367cf3,_0xbb117f){_0x367cf3=_0x367cf3-0x117;let _0x4577f0=_0x438d2f[_0x367cf3];return _0x4577f0;},a35_0x367c(_0x2ab9ea,_0x5853f2);}var __importDefault=this&&this[a35_0x4e8a9b(0x1fe)]||function(_0x51fe7b){const _0x11db3b=a35_0x4e8a9b;return _0x51fe7b&&_0x51fe7b[_0x11db3b(0x15b)]?_0x51fe7b:{'default':_0x51fe7b};};Object[a35_0x4e8a9b(0x1d6)](exports,'__esModule',{'value':!![]}),exports[a35_0x4e8a9b(0x213)]=void 0x0;function a35_0x438d(){const _0x36f3df=['✅\x20Payout\x20created:\x20','currency','2171098gDvbJl','not\x20specified','KLYME\x20EU','averageCommissionRate',',\x20Commission:\x20','availableBalance','1iHSXtV','customerEmail','delete','\x20USDT\x20(','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','💰\x20Shop\x20','\x20\x20\x20📊\x20Commission\x20difference:\x20','customerName','\x20\x20\x20📊\x20Total\x20payments:\x20','defineProperty','paidAt','publicKey','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','getTime','periodTo','getFullYear','🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','payout','📊\x20Merchants\x20awaiting\x20payout:\x20','\x20\x20\x20Payout\x20amount:\x20','join','setDate','log','getGatewayInternalName','\x27\x20->\x20name\x20\x27','hex','getMerchantStatistics','🔄\x20Admin\x20updating\x20payment\x20',',\x20successful:\x20','some','\x20\x20\x20Merchant\x20loses:\x20','round','📊\x20Total\x20payments\x20(including\x20failed):\x20','failureMessage','Rapyd','getPayoutStats','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','\x20USDT\x20from\x20balance','turnover','shopId','amountUSDT','\x20\x20\x20�\x20Total\x20payments\x20turnover:\x20','\x20USDT','💰\x20Payment\x20','password','forEach','length','__importDefault','set','CHARGEBACK','deletePayout','15215820gHUwLa','\x20to\x20','gateways','ACTIVE','\x20balance\x20updated:\x20','error','merchantEarningsUSDT','week','🔄\x20Gateway\x20mapping:','thisMonth','insensitive','gatewayOrderId','📊\x20Merchant\x20statistics\x20calculated:','975303QzGsIe','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','create','AdminService','cointopay2','externalPaymentUrl','getMerchantsAwaitingPayout','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','Error\x20processing\x20payment\x20','balance','💱\x20Currency\x20filter\x20applied:\x20','getMerchantsSelection','🔄\x20Converted\x20gateway\x20name\x20\x27','📊\x20Getting\x20payments\x20with\x20filters:','mastercard','gatewaySettings','plisio','📊\x20Available\x20gateways\x20in\x20database:','\x20\x20\x20💵\x20Available\x20balance:\x20','currencyService','\x20\x20\x20🌍\x20Country:\x20','name','Noda','%\x20commission)','🔄\x20Converted\x20gateway\x20ID\x20\x27','KLYME\x20DE','status','polygon_usdc','✅\x20Using\x20gateway\x20filter:\x20\x27','COMPLETED','getGatewayIdByName','periodFrom','ceil','_sum','📅\x20Period:\x20','klyme_gb','toUpperCase','\x20\x20\x20Gateway:\x20','getUserById','\x20USDT\x20(after\x20','network','\x20no\x20longer\x20PAID:','\x20for\x20shop\x20','totalPayout','activateUser','totalAmountAfterCommissionUSDT','klyme_de','getGatewayDisplayName','polygon','\x20\x20\x20Merchant\x20gets:\x20','totalCommissionRate','shop','8844AAQcEK','\x20\x20\x20🌐\x20IP:\x20','gte','entries','merchantUrl','count','amount','findUnique','toLowerCase','\x20in\x20','test_gateway','usdtErcWallet','\x20\x20\x20Added\x20to\x20balance:\x20+','gatewayEarnings','getMonth','\x20USDT\x20(+','updateUser','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','commission','170nwhJRh','\x20USDT\x20(after\x20payouts)','30d','getGatewayNameById','\x20\x20\x20🔍\x20Calculated\x20after\x20commission:\x20','erc20','NONEXISTENT_GATEWAY_FILTER','period','\x27\x20->\x20ID\x20\x27','28vJliWS','toString','customerCountry','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','update','getPayoutById','dailyPayments','paidOutUSDT','createPayout','generateDailyStatistics','💸\x20CHARGEBACK\x20penalty:\x20-','telegram','\x20\x20\x20Full\x20amount:\x20','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','\x20\x20\x20✅\x20Actual\x20available\x20balance:\x20','dailyRevenue','customerUa','findMany','customerIp','\x20\x20\x20📅\x20This\x20month:\x20','asc','updatePaymentStatus','💰\x20Current\x20shop\x20balance:\x20','stringify','chargebackAmount','../config/database','updatedAt','default','636784ynJIsP','SUSPENDED','totalTurnover','getSystemStatistics','2020-01-01','adminNotes','\x20USDT)','awaitingPayout','groupBy','telegramId','paymentsCount','Test\x20Gateway','Plisio','includes','70815jobKWK','turnoverUSDT','wallets','map','usdtTrcWallet','paymentGateways','sort','convertToUSDT','💰\x20Creating\x20payout\x20for\x20shop\x20','💳\x20Payout\x20wallet\x20for\x20','\x27\x20not\x20found.\x20Available\x20gateways:\x20','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','__esModule','fullName','\x20USDT\x20(theoretical\x20net)','username','totalPaidOut','trc20','hash','averageCheckUSDT','revenue','get','\x20payments)','toISOString','shopUrl','🔄\x20Gateway\x20mapping\x20(get):','🔍\x20Using\x20gateway\x20\x27','Payment\x20not\x20found','📊\x20Sorting\x20payments\x20by\x20','year','MasterCard','$transaction','\x27\x20to\x20name\x20\x27','usdcPolygonWallet','amountAfterCommissionUSDT','randomBytes','aggregate','totalPayments','getPaymentById','💰\x20[PAYOUT]\x20Merchant\x20','⚠️\x20Gateway\x20\x27','💰\x20[PAYOUT]\x20Gateway\x20','all','\x20USDT\x20(-','📋\x20Getting\x20merchants\x20selection\x20list...','txid','deleteUser','date','📅\x20Period\x20\x27all\x27:\x20Using\x20start\x20date\x20from\x20first\x20payment:\x20','\x20\x20\x20Balance:\x20','\x20merchants','⚠️\x20Requested\x20gateway\x20\x27','statusChangedAt','Insufficient\x20balance.\x20Available:\x20','\x27\x20(from\x20\x27','_count','Open\x20Banking\x202','updateCustomerData','\x20USDT,\x20Requested:\x20','parse','month','findFirst','📊\x20Gateway\x20filter\x20applied:','admin','\x20\x20\x20Current\x20balance:\x20','commissionUSDT','getDate','successUrl','payment','rapyd','💰\x20Found\x20','Shop\x20not\x20found','../types/gateway','KLYME\x20GB','\x20\x20\x20📅\x20Total\x20payouts\x20(this\x20month):\x20','PAID','bcryptjs','dateTo','\x20\x20\x20💰\x20Total\x20turnover:\x20','dateFrom','split','merchantEarnings','\x20\x20\x20💸\x20Total\x20payouts\x20(all\x20time):\x20','\x20->\x20','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','values','📋\x20Found\x20','\x20\x20\x20🖥️\x20User\x20Agent:\x20','failUrl','\x20USDT\x20(with\x20commission\x20deducted)','\x20merchants\x20with\x20positive\x20balance','push','💸\x20CHARGEBACK:\x20Merchant\x20amount\x20already\x20deducted\x20from\x20balance','\x20\x20\x20💰\x20Total\x20payments\x20turnover:\x20','notes','getAllPayouts','createdAt','REFUND','\x20USDT\x20(gross\x20revenue)','usdtPolygonWallet','noda','\x20\x20\x20💳\x20Total\x20payments:\x20','\x20\x20\x20Total\x20paid\x20out:\x20','pk_','not\x20set','desc','\x20active\x20merchants\x20for\x20selection','CoinToPay','⚠️\x20Payment\x20','\x20\x20\x20🔍\x20Raw\x20balance\x20sum:\x20','\x20\x20\x20✅\x20Total\x20available\x20for\x20payout:\x20','gateway','\x20order','81408ugoetD','klyme_eu','toFixed','./currencyService','reduce'];a35_0x438d=function(){return _0x36f3df;};return a35_0x438d();}const database_1=__importDefault(require(a35_0x4e8a9b(0x13e))),bcryptjs_1=__importDefault(require(a35_0x4e8a9b(0x19b))),crypto_1=__importDefault(require('crypto')),currencyService_1=require(a35_0x4e8a9b(0x1c3)),gateway_1=require(a35_0x4e8a9b(0x197));class AdminService{async[a35_0x4e8a9b(0x1f1)](){const _0x2ea393=a35_0x4e8a9b;console['log']('📊\x20Calculating\x20payout\x20statistics...');const _0x5ca0d9=await database_1[_0x2ea393(0x140)][_0x2ea393(0x243)][_0x2ea393(0x173)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x2ea393(0x205)}}),_0x497baf=await this[_0x2ea393(0x216)]({'page':0x1,'limit':0x3e8}),_0x2edf09=await database_1[_0x2ea393(0x140)]['payment'][_0x2ea393(0x249)]({'where':{'status':_0x2ea393(0x19a),'gateway':{'not':'test_gateway'}}}),_0x528d97=new Date(),_0x570136=new Date(_0x528d97[_0x2ea393(0x1dc)](),_0x528d97[_0x2ea393(0x117)](),0x1),_0x148822=new Date(_0x528d97[_0x2ea393(0x1dc)](),_0x528d97['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x55f32a=await database_1[_0x2ea393(0x140)][_0x2ea393(0x1df)][_0x2ea393(0x173)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x570136,'lte':_0x148822},'status':'COMPLETED'}}),_0x537776=_0x5ca0d9[_0x2ea393(0x231)][_0x2ea393(0x15f)]||0x0,_0x1da5de=_0x497baf['summary']['totalAmountAfterCommissionUSDT'],_0x562389=_0x55f32a[_0x2ea393(0x231)][_0x2ea393(0x24a)]||0x0,_0x73a037={'totalPayout':Math[_0x2ea393(0x1ed)](_0x537776*0x64)/0x64,'awaitingPayout':Math['round'](_0x1da5de*0x64)/0x64,'thisMonth':Math[_0x2ea393(0x1ed)](_0x562389*0x64)/0x64,'availableBalance':Math['round'](_0x1da5de*0x64)/0x64,'totalPayments':_0x2edf09};return console[_0x2ea393(0x1e4)]('📊\x20Payout\x20statistics\x20calculated:'),console[_0x2ea393(0x1e4)]('\x20\x20\x20💰\x20Total\x20payout:\x20'+_0x73a037['totalPayout']+'\x20USDT\x20(total\x20paid\x20to\x20merchants)'),console['log'](_0x2ea393(0x132)+_0x73a037[_0x2ea393(0x148)]+_0x2ea393(0x1a8)),console[_0x2ea393(0x1e4)](_0x2ea393(0x222)+_0x73a037[_0x2ea393(0x1cc)]+'\x20USDT\x20(same\x20as\x20awaiting)'),console[_0x2ea393(0x1e4)](_0x2ea393(0x138)+_0x73a037[_0x2ea393(0x20b)]+_0x2ea393(0x1f9)),console['log'](_0x2ea393(0x1b4)+_0x73a037[_0x2ea393(0x174)]+'\x20PAID\x20payments'),console[_0x2ea393(0x1e4)](_0x2ea393(0x1bc)+(_0x5ca0d9[_0x2ea393(0x231)][_0x2ea393(0x219)]||0x0)[_0x2ea393(0x1c2)](0x2)+'\x20USDT\x20(without\x20commission)'),console['log'](_0x2ea393(0x1d3)+((_0x5ca0d9[_0x2ea393(0x231)][_0x2ea393(0x219)]||0x0)-_0x1da5de)[_0x2ea393(0x1c2)](0x2)+_0x2ea393(0x1f9)),_0x73a037;}async[a35_0x4e8a9b(0x188)](_0x457572,_0x5ee399){const _0x5b02eb=a35_0x4e8a9b;console[_0x5b02eb(0x1e4)](_0x5b02eb(0x1f3)+_0x457572+':',_0x5ee399);const _0x43a999=await database_1['default'][_0x5b02eb(0x193)][_0x5b02eb(0x24b)]({'where':{'id':_0x457572},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x43a999)throw new Error(_0x5b02eb(0x16a));const _0xbd28de={};_0x5ee399['customerCountry']!==undefined&&(_0xbd28de[_0x5b02eb(0x127)]=_0x5ee399[_0x5b02eb(0x127)]||null);_0x5ee399[_0x5b02eb(0x137)]!==undefined&&(_0xbd28de[_0x5b02eb(0x137)]=_0x5ee399[_0x5b02eb(0x137)]||null);_0x5ee399[_0x5b02eb(0x135)]!==undefined&&(_0xbd28de[_0x5b02eb(0x135)]=_0x5ee399[_0x5b02eb(0x135)]||null);const _0x4139f7=await database_1['default'][_0x5b02eb(0x193)]['update']({'where':{'id':_0x457572},'data':{..._0xbd28de,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x5b02eb(0x1e4)](_0x5b02eb(0x1f2)+_0x457572),console['log'](_0x5b02eb(0x224)+_0x43a999[_0x5b02eb(0x127)]+_0x5b02eb(0x1a2)+_0x4139f7[_0x5b02eb(0x127)]),console['log'](_0x5b02eb(0x245)+_0x43a999[_0x5b02eb(0x137)]+_0x5b02eb(0x1a2)+_0x4139f7[_0x5b02eb(0x137)]),console[_0x5b02eb(0x1e4)](_0x5b02eb(0x1a6)+(_0x43a999[_0x5b02eb(0x135)]?_0x5b02eb(0x1ff):_0x5b02eb(0x1b7))+_0x5b02eb(0x1a2)+(_0x4139f7[_0x5b02eb(0x135)]?'set':'not\x20set')),_0x4139f7;}async[a35_0x4e8a9b(0x144)](_0x6375c){const _0x4cad7a=a35_0x4e8a9b,_0x433c1c=new Date();let _0x2085f2;switch(_0x6375c){case'7d':_0x2085f2=new Date(_0x433c1c[_0x4cad7a(0x1da)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x4cad7a(0x11e):_0x2085f2=new Date(_0x433c1c[_0x4cad7a(0x1da)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'90d':_0x2085f2=new Date(_0x433c1c[_0x4cad7a(0x1da)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x4cad7a(0x179):const _0x33891d=await database_1[_0x4cad7a(0x140)]['payment']['findFirst']({'where':{'gateway':{'not':'test_gateway'}},'orderBy':{'createdAt':_0x4cad7a(0x139)},'select':{'createdAt':!![]}});_0x2085f2=_0x33891d?_0x33891d['createdAt']:new Date('2020-01-01'),console[_0x4cad7a(0x1e4)](_0x4cad7a(0x17f)+_0x2085f2[_0x4cad7a(0x166)]());break;default:_0x2085f2=new Date(_0x433c1c[_0x4cad7a(0x1da)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x2584d5,_0x5b7271,_0x4fffe4,_0x5b5344,_0x1e990b,_0x26e845,_0x54d745]=await Promise['all']([database_1[_0x4cad7a(0x140)][_0x4cad7a(0x243)][_0x4cad7a(0x249)](),database_1[_0x4cad7a(0x140)][_0x4cad7a(0x243)][_0x4cad7a(0x249)]({'where':{'status':_0x4cad7a(0x205)}}),database_1[_0x4cad7a(0x140)][_0x4cad7a(0x193)][_0x4cad7a(0x249)]({'where':{'createdAt':{'gte':_0x2085f2},'gateway':{'not':_0x4cad7a(0x24e)}}}),database_1[_0x4cad7a(0x140)]['payment'][_0x4cad7a(0x249)]({'where':{'status':_0x4cad7a(0x19a),'createdAt':{'gte':_0x2085f2},'gateway':{'not':'test_gateway'}}}),database_1[_0x4cad7a(0x140)][_0x4cad7a(0x193)][_0x4cad7a(0x136)]({'where':{'status':_0x4cad7a(0x19a),'createdAt':{'gte':_0x2085f2},'gateway':{'not':_0x4cad7a(0x24e)}},'select':{'amount':!![],'currency':!![]}}),database_1[_0x4cad7a(0x140)]['payment']['findMany']({'where':{'gateway':{'not':_0x4cad7a(0x24e)}},'take':0xa,'orderBy':{'createdAt':_0x4cad7a(0x1b8)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x4cad7a(0x140)][_0x4cad7a(0x193)][_0x4cad7a(0x136)]({'where':{'createdAt':{'gte':_0x2085f2},'gateway':{'not':_0x4cad7a(0x24e)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x19d9cb=0x0;for(const _0x2824c9 of _0x1e990b){const _0x380861=await currencyService_1[_0x4cad7a(0x223)][_0x4cad7a(0x156)](_0x2824c9[_0x4cad7a(0x24a)],_0x2824c9[_0x4cad7a(0x1c6)]);_0x19d9cb+=_0x380861;}const _0x528346=this[_0x4cad7a(0x12e)](_0x54d745,_0x2085f2,_0x433c1c),_0x3a1664=_0x4fffe4>0x0?_0x5b5344/_0x4fffe4*0x64:0x0;return{'totalShops':_0x2584d5,'activeShops':_0x5b7271,'totalPayments':_0x4fffe4,'successfulPayments':_0x5b5344,'totalRevenue':Math[_0x4cad7a(0x1ed)](_0x19d9cb*0x64)/0x64,'conversionRate':Math[_0x4cad7a(0x1ed)](_0x3a1664*0x64)/0x64,'dailyRevenue':_0x528346[_0x4cad7a(0x134)],'dailyPayments':_0x528346[_0x4cad7a(0x12b)],'recentPayments':_0x26e845['map'](_0x22c4b9=>({'id':_0x22c4b9['id'],'amount':_0x22c4b9[_0x4cad7a(0x24a)],'currency':_0x22c4b9[_0x4cad7a(0x1c6)],'status':_0x22c4b9[_0x4cad7a(0x22a)],'gateway':_0x22c4b9[_0x4cad7a(0x1be)],'shop':_0x22c4b9[_0x4cad7a(0x243)],'createdAt':_0x22c4b9[_0x4cad7a(0x1af)]}))};}async[a35_0x4e8a9b(0x1e8)](_0x4bfc3c){const _0x5e74d2=a35_0x4e8a9b;console[_0x5e74d2(0x1e4)](_0x5e74d2(0x1a3),_0x4bfc3c);let _0x1e309d,_0x2e12b7=new Date();if(_0x4bfc3c[_0x5e74d2(0x123)]==='custom'&&_0x4bfc3c[_0x5e74d2(0x19e)]&&_0x4bfc3c[_0x5e74d2(0x19c)])_0x1e309d=new Date(_0x4bfc3c[_0x5e74d2(0x19e)]),_0x2e12b7=new Date(_0x4bfc3c[_0x5e74d2(0x19c)]);else{const _0x3cc784=new Date();switch(_0x4bfc3c[_0x5e74d2(0x123)]){case _0x5e74d2(0x209):_0x1e309d=new Date(_0x3cc784[_0x5e74d2(0x1da)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x5e74d2(0x18b):_0x1e309d=new Date(_0x3cc784['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x5e74d2(0x16c):_0x1e309d=new Date(_0x3cc784[_0x5e74d2(0x1da)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x5e74d2(0x179):default:_0x1e309d=new Date(_0x5e74d2(0x145));break;}}console[_0x5e74d2(0x1e4)](_0x5e74d2(0x232)+_0x1e309d[_0x5e74d2(0x166)]()+_0x5e74d2(0x203)+_0x2e12b7[_0x5e74d2(0x166)]());const _0xc64a49={'status':_0x5e74d2(0x19a),'gateway':{'not':'test_gateway'},'paidAt':{'gte':_0x1e309d,'lte':_0x2e12b7}};_0x4bfc3c[_0x5e74d2(0x1f6)]&&(_0xc64a49['shopId']=_0x4bfc3c[_0x5e74d2(0x1f6)]);const _0x264622=await database_1['default'][_0x5e74d2(0x193)][_0x5e74d2(0x136)]({'where':_0xc64a49,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x5e74d2(0x1e4)](_0x5e74d2(0x195)+_0x264622[_0x5e74d2(0x1fd)]+'\x20paid\x20payments\x20for\x20analysis');const _0x48481a={'gateway':{'not':_0x5e74d2(0x24e)},'createdAt':{'gte':_0x1e309d,'lte':_0x2e12b7}};_0x4bfc3c[_0x5e74d2(0x1f6)]&&(_0x48481a[_0x5e74d2(0x1f6)]=_0x4bfc3c[_0x5e74d2(0x1f6)]);const _0x1c5224=await database_1['default'][_0x5e74d2(0x193)][_0x5e74d2(0x249)]({'where':_0x48481a});console[_0x5e74d2(0x1e4)](_0x5e74d2(0x1ee)+_0x1c5224+_0x5e74d2(0x1ea)+_0x264622[_0x5e74d2(0x1fd)]);let _0xd95c6d=0x0,_0x19a074=0x0,_0x48a37d=0x0;const _0x4e6746={},_0x1770fa={},_0x67714b={};for(const _0x6a634f of _0x264622){try{const _0x54ace8=await currencyService_1[_0x5e74d2(0x223)][_0x5e74d2(0x156)](_0x6a634f[_0x5e74d2(0x24a)],_0x6a634f['currency']);let _0x478b68={};if(_0x6a634f[_0x5e74d2(0x243)][_0x5e74d2(0x21f)])try{_0x478b68=JSON[_0x5e74d2(0x18a)](_0x6a634f[_0x5e74d2(0x243)][_0x5e74d2(0x21f)]);}catch(_0x1df28e){console[_0x5e74d2(0x207)](_0x5e74d2(0x11a)+_0x6a634f[_0x5e74d2(0x1f6)]+':',_0x1df28e);}let _0x5576d4={},_0x599b74=0xa;for(const [_0x5c9070,_0x325447]of Object['entries'](_0x478b68)){if(_0x5c9070[_0x5e74d2(0x24c)]()===_0x6a634f['gateway'][_0x5e74d2(0x24c)]()){_0x5576d4=_0x325447,_0x599b74=_0x325447['commission']||0xa;break;}}const _0x5cce6b=_0x54ace8*(_0x599b74/0x64),_0x262d9d=_0x54ace8-_0x5cce6b;_0xd95c6d+=_0x54ace8,_0x19a074+=_0x262d9d,_0x48a37d+=_0x5cce6b;!_0x4e6746[_0x6a634f[_0x5e74d2(0x1be)]]&&(_0x4e6746[_0x6a634f[_0x5e74d2(0x1be)]]={'gateway':_0x6a634f[_0x5e74d2(0x1be)],'gatewayDisplayName':this[_0x5e74d2(0x23f)](_0x6a634f[_0x5e74d2(0x1be)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x4e6746[_0x6a634f[_0x5e74d2(0x1be)]]['paymentsCount']++,_0x4e6746[_0x6a634f[_0x5e74d2(0x1be)]][_0x5e74d2(0x150)]+=_0x54ace8,_0x4e6746[_0x6a634f['gateway']]['commissionUSDT']+=_0x5cce6b,_0x4e6746[_0x6a634f['gateway']]['merchantEarningsUSDT']+=_0x262d9d,_0x4e6746[_0x6a634f['gateway']][_0x5e74d2(0x242)]+=_0x599b74;!_0x4bfc3c['shopId']&&(!_0x1770fa[_0x6a634f[_0x5e74d2(0x1f6)]]&&(_0x1770fa[_0x6a634f['shopId']]={'shopId':_0x6a634f[_0x5e74d2(0x1f6)],'shopName':_0x6a634f[_0x5e74d2(0x243)][_0x5e74d2(0x225)],'shopUsername':_0x6a634f[_0x5e74d2(0x243)][_0x5e74d2(0x15e)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x1770fa[_0x6a634f[_0x5e74d2(0x1f6)]][_0x5e74d2(0x14b)]++,_0x1770fa[_0x6a634f['shopId']][_0x5e74d2(0x150)]+=_0x54ace8,_0x1770fa[_0x6a634f[_0x5e74d2(0x1f6)]][_0x5e74d2(0x190)]+=_0x5cce6b,_0x1770fa[_0x6a634f[_0x5e74d2(0x1f6)]][_0x5e74d2(0x208)]+=_0x262d9d);const _0x1e2a92=_0x6a634f[_0x5e74d2(0x1d7)]['toISOString']()[_0x5e74d2(0x19f)]('T')[0x0];!_0x67714b[_0x1e2a92]&&(_0x67714b[_0x1e2a92]={'date':_0x1e2a92,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x67714b[_0x1e2a92]['turnover']+=_0x54ace8,_0x67714b[_0x1e2a92][_0x5e74d2(0x1a0)]+=_0x262d9d,_0x67714b[_0x1e2a92][_0x5e74d2(0x251)]+=_0x5cce6b,_0x67714b[_0x1e2a92][_0x5e74d2(0x14b)]++;}catch(_0x394dd9){console['error'](_0x5e74d2(0x218)+_0x6a634f['id']+':',_0x394dd9);}}Object[_0x5e74d2(0x1a4)](_0x4e6746)['forEach'](_0x485ee2=>{const _0x25514e=_0x5e74d2;_0x485ee2[_0x25514e(0x1ca)]=_0x485ee2['paymentsCount']>0x0?_0x485ee2['totalCommissionRate']/_0x485ee2[_0x25514e(0x14b)]:0x0,delete _0x485ee2[_0x25514e(0x242)];}),Object[_0x5e74d2(0x1a4)](_0x1770fa)[_0x5e74d2(0x1fc)](_0x28bc2d=>{const _0x4679a2=_0x5e74d2;_0x28bc2d['averageCheckUSDT']=_0x28bc2d[_0x4679a2(0x14b)]>0x0?_0x28bc2d[_0x4679a2(0x150)]/_0x28bc2d['paymentsCount']:0x0;});let _0x5089de=0x0;if(_0x4bfc3c[_0x5e74d2(0x1f6)]){const _0x473494=await database_1[_0x5e74d2(0x140)][_0x5e74d2(0x1df)]['findMany']({'where':{'shopId':_0x4bfc3c[_0x5e74d2(0x1f6)],'status':_0x5e74d2(0x22d),'createdAt':{'gte':_0x1e309d,'lte':_0x2e12b7}},'select':{'amount':!![]}});_0x5089de=_0x473494[_0x5e74d2(0x1c4)]((_0x404ae2,_0x5ce37b)=>_0x404ae2+_0x5ce37b[_0x5e74d2(0x24a)],0x0);}const _0x3569ae=_0x1c5224,_0x3a978e=_0x264622[_0x5e74d2(0x1fd)],_0x5ed2f9=_0x3a978e>0x0?_0xd95c6d/_0x3a978e:0x0,_0x42a778=_0x3569ae>0x0?Math[_0x5e74d2(0x1ed)](_0x3a978e/_0x3569ae*0x2710)/0x64:0x0,_0x2e56ea=Math[_0x5e74d2(0x230)]((_0x2e12b7['getTime']()-_0x1e309d['getTime']())/(0x3e8*0x3c*0x3c*0x18)),_0x245596={'totalTurnover':Math['round'](_0xd95c6d*0x64)/0x64,'merchantEarnings':Math['round'](_0x19a074*0x64)/0x64,'gatewayEarnings':Math['round'](_0x48a37d*0x64)/0x64,'totalPaidOut':Math['round'](_0x5089de*0x64)/0x64,'averageCheck':Math[_0x5e74d2(0x1ed)](_0x5ed2f9*0x64)/0x64,'totalPayments':_0x3569ae,'successfulPayments':_0x3a978e,'conversionRate':_0x42a778,'gatewayBreakdown':Object[_0x5e74d2(0x1a4)](_0x4e6746)['map'](_0xf7dac3=>({..._0xf7dac3,'turnoverUSDT':Math['round'](_0xf7dac3[_0x5e74d2(0x150)]*0x64)/0x64,'commissionUSDT':Math[_0x5e74d2(0x1ed)](_0xf7dac3[_0x5e74d2(0x190)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0xf7dac3[_0x5e74d2(0x208)]*0x64)/0x64,'averageCommissionRate':Math['round'](_0xf7dac3[_0x5e74d2(0x1ca)]*0x64)/0x64})),'merchantBreakdown':_0x4bfc3c[_0x5e74d2(0x1f6)]?undefined:Object[_0x5e74d2(0x1a4)](_0x1770fa)[_0x5e74d2(0x152)](_0x35aaa2=>({..._0x35aaa2,'turnoverUSDT':Math[_0x5e74d2(0x1ed)](_0x35aaa2['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math['round'](_0x35aaa2[_0x5e74d2(0x190)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x5e74d2(0x1ed)](_0x35aaa2[_0x5e74d2(0x208)]*0x64)/0x64,'paidOutUSDT':Math[_0x5e74d2(0x1ed)](_0x35aaa2[_0x5e74d2(0x12c)]*0x64)/0x64,'averageCheckUSDT':Math['round'](_0x35aaa2[_0x5e74d2(0x162)]*0x64)/0x64})),'dailyData':Object[_0x5e74d2(0x1a4)](_0x67714b)['map'](_0x1731e6=>({..._0x1731e6,'turnover':Math[_0x5e74d2(0x1ed)](_0x1731e6[_0x5e74d2(0x1f5)]*0x64)/0x64,'merchantEarnings':Math[_0x5e74d2(0x1ed)](_0x1731e6[_0x5e74d2(0x1a0)]*0x64)/0x64,'gatewayEarnings':Math[_0x5e74d2(0x1ed)](_0x1731e6[_0x5e74d2(0x251)]*0x64)/0x64}))[_0x5e74d2(0x155)]((_0x3661b2,_0x26640f)=>_0x3661b2[_0x5e74d2(0x17e)]['localeCompare'](_0x26640f[_0x5e74d2(0x17e)])),'periodInfo':{'from':_0x1e309d,'to':_0x2e12b7,'periodType':_0x4bfc3c[_0x5e74d2(0x123)]||'custom','daysCount':_0x2e56ea}};return console[_0x5e74d2(0x1e4)](_0x5e74d2(0x20e)),console[_0x5e74d2(0x1e4)](_0x5e74d2(0x19d)+_0x245596[_0x5e74d2(0x143)]+_0x5e74d2(0x1f9)),console[_0x5e74d2(0x1e4)](_0x5e74d2(0x211)+_0x245596['merchantEarnings']+_0x5e74d2(0x1f9)),console[_0x5e74d2(0x1e4)](_0x5e74d2(0x15a)+_0x245596[_0x5e74d2(0x251)]+_0x5e74d2(0x1f9)),console[_0x5e74d2(0x1e4)](_0x5e74d2(0x1d5)+_0x245596[_0x5e74d2(0x174)]),_0x245596;}async[a35_0x4e8a9b(0x21b)](){const _0x526419=a35_0x4e8a9b;console[_0x526419(0x1e4)](_0x526419(0x17b));const _0x241752=await database_1[_0x526419(0x140)]['shop'][_0x526419(0x136)]({'where':{'status':_0x526419(0x205)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x526419(0x139)}});return console[_0x526419(0x1e4)](_0x526419(0x1a5)+_0x241752['length']+_0x526419(0x1b9)),_0x241752[_0x526419(0x152)](_0x5025cb=>({'id':_0x5025cb['id'],'username':_0x5025cb[_0x526419(0x15e)],'name':_0x5025cb['name']}));}['getGatewayDisplayName'](_0x36dfc9){const _0x4178e1=a35_0x4e8a9b,_0x3a9201={'test_gateway':_0x4178e1(0x14c),'plisio':_0x4178e1(0x14d),'rapyd':_0x4178e1(0x1f0),'noda':_0x4178e1(0x226),'cointopay':_0x4178e1(0x1ba),'cointopay2':_0x4178e1(0x187),'klyme_eu':_0x4178e1(0x1c9),'klyme_gb':_0x4178e1(0x198),'klyme_de':_0x4178e1(0x229),'mastercard':_0x4178e1(0x16d)};return _0x3a9201[_0x36dfc9]||_0x36dfc9;}[a35_0x4e8a9b(0x1e5)](_0xbcc8ca){const _0x3b07d9=a35_0x4e8a9b,_0x14581c={'Test\x20Gateway':_0x3b07d9(0x24e),'Plisio':_0x3b07d9(0x220),'Rapyd':_0x3b07d9(0x194),'Noda':_0x3b07d9(0x1b3),'CoinToPay':'cointopay','CoinToPay2':_0x3b07d9(0x214),'KLYME\x20EU':_0x3b07d9(0x1c1),'KLYME\x20GB':_0x3b07d9(0x233),'KLYME\x20DE':_0x3b07d9(0x23e),'MasterCard':_0x3b07d9(0x21e)};return _0x14581c[_0xbcc8ca]||_0xbcc8ca['toLowerCase']();}async[a35_0x4e8a9b(0x216)](_0x518694){const _0x13fd1d=a35_0x4e8a9b,{page:_0x124d62,limit:_0x532d99,minAmount:_0x43c40d,search:_0x3d6d69}=_0x518694,_0xc1d120=(_0x124d62-0x1)*_0x532d99;console[_0x13fd1d(0x1e4)](_0x13fd1d(0x1d9),_0x518694);const _0x5b5c71={'balance':{'gt':0x0},'status':_0x13fd1d(0x205)};_0x43c40d&&(_0x5b5c71[_0x13fd1d(0x219)]['gte']=_0x43c40d);_0x3d6d69&&(_0x5b5c71['OR']=[{'name':{'contains':_0x3d6d69,'mode':_0x13fd1d(0x20c)}},{'username':{'contains':_0x3d6d69,'mode':'insensitive'}}]);const [_0x1b30cf,_0x22c823]=await Promise[_0x13fd1d(0x179)]([database_1[_0x13fd1d(0x140)][_0x13fd1d(0x243)]['findMany']({'where':_0x5b5c71,'skip':_0xc1d120,'take':_0x532d99,'orderBy':{'balance':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1['default'][_0x13fd1d(0x243)][_0x13fd1d(0x249)]({'where':_0x5b5c71})]);console[_0x13fd1d(0x1e4)](_0x13fd1d(0x195)+_0x1b30cf[_0x13fd1d(0x1fd)]+_0x13fd1d(0x1a9));const _0x46c83d=await Promise[_0x13fd1d(0x179)](_0x1b30cf[_0x13fd1d(0x152)](async _0x36710a=>{const _0x179c74=_0x13fd1d,[_0x49d3d5,_0x5c09ca,_0x1f8695]=await Promise[_0x179c74(0x179)]([database_1[_0x179c74(0x140)]['payment'][_0x179c74(0x249)]({'where':{'shopId':_0x36710a['id'],'status':_0x179c74(0x19a),'gateway':{'not':_0x179c74(0x24e)}}}),database_1[_0x179c74(0x140)][_0x179c74(0x193)][_0x179c74(0x18c)]({'where':{'shopId':_0x36710a['id'],'status':_0x179c74(0x19a),'gateway':{'not':'test_gateway'}},'orderBy':{'paidAt':_0x179c74(0x139)},'select':{'paidAt':!![]}}),database_1[_0x179c74(0x140)][_0x179c74(0x193)][_0x179c74(0x149)]({'by':[_0x179c74(0x1be)],'where':{'shopId':_0x36710a['id'],'status':_0x179c74(0x19a),'gateway':{'not':_0x179c74(0x24e)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x2c3790=new Date(),_0x4fc332=new Date(_0x2c3790[_0x179c74(0x1dc)](),_0x2c3790['getMonth'](),0x1),_0x2ef6ea=new Date(_0x2c3790[_0x179c74(0x1dc)](),_0x2c3790[_0x179c74(0x117)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0xf59609,_0x2c4cf0]=await Promise['all']([database_1[_0x179c74(0x140)]['payout'][_0x179c74(0x173)]({'_sum':{'amount':!![]},'where':{'shopId':_0x36710a['id'],'status':_0x179c74(0x22d)}}),database_1[_0x179c74(0x140)]['payout']['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x36710a['id'],'status':_0x179c74(0x22d),'createdAt':{'gte':_0x4fc332,'lte':_0x2ef6ea}}})]),_0x381a44=_0xf59609['_sum'][_0x179c74(0x24a)]||0x0,_0x1829c6=_0x2c4cf0[_0x179c74(0x231)][_0x179c74(0x24a)]||0x0,_0x1926a9=await Promise[_0x179c74(0x179)](_0x1f8695['map'](async _0x99e5d1=>{const _0x85549a=_0x179c74;let _0x3cfcfe=0xa;if(_0x36710a[_0x85549a(0x21f)])try{const _0x404c59=JSON[_0x85549a(0x18a)](_0x36710a[_0x85549a(0x21f)]);for(const [_0x3c15a6,_0x459e5e]of Object['entries'](_0x404c59)){if(_0x3c15a6[_0x85549a(0x24c)]()===_0x99e5d1[_0x85549a(0x1be)][_0x85549a(0x24c)]()){_0x3cfcfe=_0x459e5e[_0x85549a(0x11b)]||0xa,console['log'](_0x85549a(0x178)+_0x99e5d1['gateway']+_0x85549a(0x23a)+_0x36710a['id']+':\x20commission\x20=\x20'+_0x3cfcfe+'%');break;}}}catch(_0x591ddf){console[_0x85549a(0x207)](_0x85549a(0x11a)+_0x36710a['id']+':',_0x591ddf);}const _0x42e1e6=_0x99e5d1['_sum'][_0x85549a(0x1f7)]||0x0,_0x130f6f=_0x42e1e6*(0x1-_0x3cfcfe/0x64);return{'gateway':_0x99e5d1['gateway'],'count':_0x99e5d1['_count']['id'],'amountUSDT':Math[_0x85549a(0x1ed)](_0x42e1e6*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x85549a(0x1ed)](_0x130f6f*0x64)/0x64,'commission':_0x3cfcfe};})),_0x54f8ff=_0x1926a9[_0x179c74(0x1c4)]((_0x2abccd,_0x56b6ef)=>_0x2abccd+_0x56b6ef[_0x179c74(0x1f7)],0x0),_0x248fef=_0x36710a[_0x179c74(0x219)];return console['log'](_0x179c74(0x176)+_0x36710a[_0x179c74(0x15e)]+':'),console[_0x179c74(0x1e4)](_0x179c74(0x1f8)+_0x54f8ff[_0x179c74(0x1c2)](0x2)+_0x179c74(0x1b1)),console[_0x179c74(0x1e4)](_0x179c74(0x120)+_0x1926a9[_0x179c74(0x1c4)]((_0x423898,_0x5b1114)=>_0x423898+_0x5b1114[_0x179c74(0x171)],0x0)[_0x179c74(0x1c2)](0x2)+_0x179c74(0x15d)),console[_0x179c74(0x1e4)](_0x179c74(0x133)+_0x248fef['toFixed'](0x2)+_0x179c74(0x11d)),{'id':_0x36710a['id'],'fullName':_0x36710a[_0x179c74(0x225)],'username':_0x36710a['username'],'telegramId':_0x36710a['telegram'],'merchantUrl':_0x36710a[_0x179c74(0x167)],'wallets':{'usdtPolygonWallet':_0x36710a['usdtPolygonWallet'],'usdtTrcWallet':_0x36710a[_0x179c74(0x153)],'usdtErcWallet':_0x36710a[_0x179c74(0x24f)],'usdcPolygonWallet':_0x36710a[_0x179c74(0x170)]},'totalAmountUSDT':Math['round'](_0x54f8ff*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x179c74(0x1ed)](_0x248fef*0x64)/0x64,'totalPayout':Math[_0x179c74(0x1ed)](_0x381a44*0x64)/0x64,'thisMonth':Math[_0x179c74(0x1ed)](_0x1829c6*0x64)/0x64,'paymentsCount':_0x49d3d5,'oldestPaymentDate':_0x5c09ca?.[_0x179c74(0x1d7)]||_0x36710a[_0x179c74(0x1af)],'gatewayBreakdown':_0x1926a9};})),_0x1f2243=_0x46c83d['reduce']((_0x50b076,_0x306c14)=>_0x50b076+_0x306c14['totalAmountUSDT'],0x0),_0x3ea0d6=_0x46c83d[_0x13fd1d(0x1c4)]((_0x4f520b,_0x2da5d8)=>_0x4f520b+_0x2da5d8[_0x13fd1d(0x23d)],0x0),_0x57c3e6=_0x46c83d[_0x13fd1d(0x1c4)]((_0x6baf15,_0x459463)=>_0x6baf15+_0x459463[_0x13fd1d(0x23b)],0x0),_0x265e9d=_0x46c83d[_0x13fd1d(0x1c4)]((_0x1f8086,_0x565415)=>_0x1f8086+_0x565415['thisMonth'],0x0);return console[_0x13fd1d(0x1e4)](_0x13fd1d(0x1e0)+_0x22c823+_0x13fd1d(0x181)),console[_0x13fd1d(0x1e4)](_0x13fd1d(0x1ac)+Math['round'](_0x1f2243*0x64)/0x64+_0x13fd1d(0x1b1)),console[_0x13fd1d(0x1e4)](_0x13fd1d(0x1bd)+Math['round'](_0x3ea0d6*0x64)/0x64+'\x20USDT\x20(actual\x20balances)'),console['log'](_0x13fd1d(0x1a1)+Math[_0x13fd1d(0x1ed)](_0x57c3e6*0x64)/0x64+_0x13fd1d(0x1f9)),console[_0x13fd1d(0x1e4)](_0x13fd1d(0x199)+Math[_0x13fd1d(0x1ed)](_0x265e9d*0x64)/0x64+_0x13fd1d(0x1f9)),{'merchants':_0x46c83d,'pagination':{'page':_0x124d62,'limit':_0x532d99,'total':_0x22c823,'totalPages':Math['ceil'](_0x22c823/_0x532d99)},'summary':{'totalMerchants':_0x22c823,'totalAmountUSDT':Math['round'](_0x1f2243*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x3ea0d6*0x64)/0x64,'totalPayout':Math[_0x13fd1d(0x1ed)](_0x57c3e6*0x64)/0x64,'thisMonth':Math[_0x13fd1d(0x1ed)](_0x265e9d*0x64)/0x64}};}async[a35_0x4e8a9b(0x12d)](_0x292a59){const _0x14cb03=a35_0x4e8a9b,{shopId:_0x37a916,amount:_0x2595cc,network:_0x333bc8,wallet:_0x1f2ebe,notes:_0xe13693,txid:_0x186d2f,periodFrom:_0x39e641,periodTo:_0x2a0b70}=_0x292a59,_0x1a2766=await database_1[_0x14cb03(0x140)][_0x14cb03(0x16e)](async _0x29ece6=>{const _0x137dfd=_0x14cb03,_0x46c8cd=await _0x29ece6['shop'][_0x137dfd(0x24b)]({'where':{'id':_0x37a916},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x46c8cd)throw new Error(_0x137dfd(0x196));console['log'](_0x137dfd(0x157)+_0x46c8cd['username']+':'),console[_0x137dfd(0x1e4)](_0x137dfd(0x18f)+_0x46c8cd[_0x137dfd(0x219)][_0x137dfd(0x1c2)](0x6)+_0x137dfd(0x1f9)),console[_0x137dfd(0x1e4)](_0x137dfd(0x1e1)+_0x2595cc[_0x137dfd(0x1c2)](0x6)+'\x20USDT'),console[_0x137dfd(0x1e4)](_0x137dfd(0x217)+_0x46c8cd[_0x137dfd(0x15f)]['toFixed'](0x6)+_0x137dfd(0x1f9));if(_0x186d2f)console[_0x137dfd(0x1e4)]('\x20\x20\x20Transaction\x20hash:\x20'+_0x186d2f);if(_0x46c8cd[_0x137dfd(0x219)]<_0x2595cc)throw new Error(_0x137dfd(0x184)+_0x46c8cd[_0x137dfd(0x219)]['toFixed'](0x6)+_0x137dfd(0x189)+_0x2595cc[_0x137dfd(0x1c2)](0x6)+'\x20USDT');let _0x5c2fb3=_0x1f2ebe;if(!_0x5c2fb3){const _0x5244ee=await _0x29ece6[_0x137dfd(0x243)]['findUnique']({'where':{'id':_0x37a916},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x5244ee)switch(_0x333bc8){case _0x137dfd(0x240):_0x5c2fb3=_0x5244ee[_0x137dfd(0x1b2)]||undefined;break;case _0x137dfd(0x160):_0x5c2fb3=_0x5244ee[_0x137dfd(0x153)]||undefined;break;case _0x137dfd(0x121):_0x5c2fb3=_0x5244ee['usdtErcWallet']||undefined;break;case _0x137dfd(0x22b):_0x5c2fb3=_0x5244ee[_0x137dfd(0x170)]||undefined;break;}}console[_0x137dfd(0x1e4)](_0x137dfd(0x158)+_0x333bc8+':\x20'+(_0x5c2fb3||_0x137dfd(0x1c8)));const _0x5a4d4c=await _0x29ece6[_0x137dfd(0x1df)][_0x137dfd(0x212)]({'data':{'shopId':_0x37a916,'amount':_0x2595cc,'network':_0x333bc8,'status':'COMPLETED','txid':_0x186d2f,'notes':_0xe13693,'periodFrom':_0x39e641?new Date(_0x39e641):null,'periodTo':_0x2a0b70?new Date(_0x2a0b70):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x497472=_0x46c8cd[_0x137dfd(0x219)]-_0x2595cc,_0x2549ad=_0x46c8cd[_0x137dfd(0x15f)]+_0x2595cc;return await _0x29ece6[_0x137dfd(0x243)][_0x137dfd(0x129)]({'where':{'id':_0x37a916},'data':{'balance':_0x497472,'totalPaidOut':_0x2549ad}}),console[_0x137dfd(0x1e4)](_0x137dfd(0x1d2)+_0x46c8cd['username']+'\x20balance\x20updated:'),console[_0x137dfd(0x1e4)](_0x137dfd(0x180)+_0x46c8cd[_0x137dfd(0x219)][_0x137dfd(0x1c2)](0x6)+_0x137dfd(0x1a2)+_0x497472[_0x137dfd(0x1c2)](0x6)+_0x137dfd(0x17a)+_0x2595cc[_0x137dfd(0x1c2)](0x6)+')'),console[_0x137dfd(0x1e4)](_0x137dfd(0x1b5)+_0x46c8cd['totalPaidOut']['toFixed'](0x6)+'\x20->\x20'+_0x2549ad[_0x137dfd(0x1c2)](0x6)+_0x137dfd(0x118)+_0x2595cc['toFixed'](0x6)+')'),{'payout':_0x5a4d4c,'shop':_0x46c8cd};});return console['log'](_0x14cb03(0x1c5)+_0x1a2766[_0x14cb03(0x1df)]['id']+_0x14cb03(0x23a)+_0x1a2766['shop'][_0x14cb03(0x15e)]+'\x20('+_0x2595cc+_0x14cb03(0x147)),{'id':_0x1a2766[_0x14cb03(0x1df)]['id'],'shopId':_0x1a2766[_0x14cb03(0x1df)][_0x14cb03(0x1f6)],'shopName':_0x1a2766[_0x14cb03(0x243)][_0x14cb03(0x225)],'shopUsername':_0x1a2766[_0x14cb03(0x243)][_0x14cb03(0x15e)],'amount':_0x1a2766['payout'][_0x14cb03(0x24a)],'network':_0x1a2766[_0x14cb03(0x1df)][_0x14cb03(0x238)],'status':_0x1a2766[_0x14cb03(0x1df)]['status'],'txid':_0x1a2766[_0x14cb03(0x1df)][_0x14cb03(0x17c)],'notes':_0x1a2766[_0x14cb03(0x1df)][_0x14cb03(0x1ad)],'periodFrom':_0x1a2766[_0x14cb03(0x1df)]['periodFrom'],'periodTo':_0x1a2766[_0x14cb03(0x1df)][_0x14cb03(0x1db)],'createdAt':_0x1a2766[_0x14cb03(0x1df)][_0x14cb03(0x1af)],'paidAt':_0x1a2766[_0x14cb03(0x1df)][_0x14cb03(0x1d7)]};}async[a35_0x4e8a9b(0x1ae)](_0x5f2d20){const _0x311545=a35_0x4e8a9b,{page:_0x544c85,limit:_0x3917fb,shopId:_0x4c17ae,network:_0x18d4d8,dateFrom:_0xff7bbf,dateTo:_0x3404ff,search:_0x27148c}=_0x5f2d20,_0x4ffa7e=(_0x544c85-0x1)*_0x3917fb,_0x84f71d={};_0x4c17ae&&(_0x84f71d['shopId']=_0x4c17ae);_0x18d4d8&&(_0x84f71d['network']=_0x18d4d8);(_0xff7bbf||_0x3404ff)&&(_0x84f71d['createdAt']={},_0xff7bbf&&(_0x84f71d[_0x311545(0x1af)][_0x311545(0x246)]=new Date(_0xff7bbf)),_0x3404ff&&(_0x84f71d[_0x311545(0x1af)]['lte']=new Date(_0x3404ff)));_0x27148c&&(_0x84f71d['OR']=[{'shop':{'name':{'contains':_0x27148c,'mode':_0x311545(0x20c)}}},{'shop':{'username':{'contains':_0x27148c,'mode':_0x311545(0x20c)}}},{'notes':{'contains':_0x27148c,'mode':_0x311545(0x20c)}}]);const [_0x130449,_0x5c9f18]=await Promise[_0x311545(0x179)]([database_1[_0x311545(0x140)][_0x311545(0x1df)]['findMany']({'where':_0x84f71d,'skip':_0x4ffa7e,'take':_0x3917fb,'orderBy':{'createdAt':_0x311545(0x1b8)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x311545(0x140)][_0x311545(0x1df)][_0x311545(0x249)]({'where':_0x84f71d})]);return{'payouts':_0x130449[_0x311545(0x152)](_0x2b0d91=>({'id':_0x2b0d91['id'],'shopId':_0x2b0d91[_0x311545(0x1f6)],'shopName':_0x2b0d91[_0x311545(0x243)]['name'],'shopUsername':_0x2b0d91['shop'][_0x311545(0x15e)],'amount':_0x2b0d91[_0x311545(0x24a)],'network':_0x2b0d91[_0x311545(0x238)],'status':_0x2b0d91['status'],'txid':_0x2b0d91[_0x311545(0x17c)],'notes':_0x2b0d91[_0x311545(0x1ad)],'periodFrom':_0x2b0d91[_0x311545(0x22f)],'periodTo':_0x2b0d91[_0x311545(0x1db)],'createdAt':_0x2b0d91[_0x311545(0x1af)],'paidAt':_0x2b0d91[_0x311545(0x1d7)]})),'pagination':{'page':_0x544c85,'limit':_0x3917fb,'total':_0x5c9f18,'totalPages':Math[_0x311545(0x230)](_0x5c9f18/_0x3917fb)}};}async[a35_0x4e8a9b(0x12a)](_0x16c324){const _0x32d08d=a35_0x4e8a9b,_0x2d984d=await database_1[_0x32d08d(0x140)][_0x32d08d(0x1df)][_0x32d08d(0x24b)]({'where':{'id':_0x16c324},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x2d984d)return null;return{'id':_0x2d984d['id'],'shopId':_0x2d984d[_0x32d08d(0x1f6)],'shopName':_0x2d984d[_0x32d08d(0x243)][_0x32d08d(0x225)],'shopUsername':_0x2d984d[_0x32d08d(0x243)][_0x32d08d(0x15e)],'amount':_0x2d984d[_0x32d08d(0x24a)],'network':_0x2d984d['network'],'status':_0x2d984d['status'],'txid':_0x2d984d[_0x32d08d(0x17c)],'notes':_0x2d984d['notes'],'periodFrom':_0x2d984d[_0x32d08d(0x22f)],'periodTo':_0x2d984d[_0x32d08d(0x1db)],'createdAt':_0x2d984d[_0x32d08d(0x1af)],'paidAt':_0x2d984d[_0x32d08d(0x1d7)]};}async[a35_0x4e8a9b(0x201)](_0x2c6c26){const _0x1fa188=a35_0x4e8a9b;await database_1[_0x1fa188(0x140)][_0x1fa188(0x1df)]['delete']({'where':{'id':_0x2c6c26}});}async['getAllPayments'](_0x77c096){const _0x239988=a35_0x4e8a9b,{page:_0x2c8a35,limit:_0x51891d,status:_0x119314,gateway:_0x3e0f18,shopId:_0x10c954,dateFrom:_0x6ed32a,dateTo:_0x58c784,search:_0x3e5146,currency:_0x315485,sortBy:_0x4c36c7,sortOrder:_0x382105}=_0x77c096,_0x2cad7f=(_0x2c8a35-0x1)*_0x51891d;console['log'](_0x239988(0x21d),_0x77c096);const _0x148a0c=await database_1[_0x239988(0x140)][_0x239988(0x193)][_0x239988(0x149)]({'by':[_0x239988(0x1be)],'_count':{'gateway':!![]}});console[_0x239988(0x1e4)](_0x239988(0x221),_0x148a0c['map'](_0x4b5129=>_0x4b5129[_0x239988(0x1be)]+'\x20('+_0x4b5129[_0x239988(0x186)][_0x239988(0x1be)]+_0x239988(0x165)));if(_0x3e0f18){const _0x202511=_0x148a0c[_0x239988(0x1eb)](_0x4dfccc=>_0x4dfccc[_0x239988(0x1be)]['toLowerCase']()===_0x3e0f18['toLowerCase']());!_0x202511&&_0x3e0f18[_0x239988(0x24c)]()!==_0x239988(0x24e)&&console[_0x239988(0x1e4)](_0x239988(0x182)+_0x3e0f18+_0x239988(0x159)+_0x148a0c['map'](_0x4e2263=>_0x4e2263[_0x239988(0x1be)])[_0x239988(0x1e2)](',\x20'));}const _0x8d62ad={};_0x119314&&(_0x8d62ad[_0x239988(0x22a)]=_0x119314[_0x239988(0x234)]());if(!_0x3e0f18)_0x8d62ad['gateway']={'not':_0x239988(0x24e)};else{if(_0x3e0f18&&(_0x3e0f18['toLowerCase']()===_0x239988(0x24e)||_0x3e0f18==='0000'))_0x8d62ad['gateway']='test_gateway';else{let _0x4210f4=_0x3e0f18;const _0x597585=(0x0,gateway_1[_0x239988(0x11f)])(_0x3e0f18);if(_0x597585)_0x4210f4=_0x597585,console[_0x239988(0x1e4)](_0x239988(0x228)+_0x3e0f18+_0x239988(0x16f)+_0x4210f4+'\x27');else{const _0x1eb648=(0x0,gateway_1[_0x239988(0x22e)])(_0x3e0f18);if(_0x1eb648){const _0x544669=(0x0,gateway_1['getGatewayNameById'])(_0x1eb648);_0x544669&&(_0x4210f4=_0x544669,console['log'](_0x239988(0x21c)+_0x3e0f18+_0x239988(0x124)+_0x1eb648+_0x239988(0x1e6)+_0x4210f4+'\x27'));}else console['log'](_0x239988(0x169)+_0x3e0f18+'\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)');}const _0x3c8dbb=await database_1[_0x239988(0x140)][_0x239988(0x193)][_0x239988(0x249)]({'where':{'gateway':_0x4210f4[_0x239988(0x24c)]()},'take':0x1});_0x3c8dbb===0x0?(console[_0x239988(0x1e4)](_0x239988(0x177)+_0x4210f4+_0x239988(0x185)+_0x3e0f18+_0x239988(0x210)),_0x8d62ad[_0x239988(0x1be)]=_0x239988(0x122)):(_0x8d62ad[_0x239988(0x1be)]=_0x4210f4[_0x239988(0x24c)](),console['log'](_0x239988(0x22c)+_0x4210f4+_0x239988(0x185)+_0x3e0f18+'\x27)'));}}console[_0x239988(0x1e4)](_0x239988(0x18d),_0x8d62ad['gateway']);_0x10c954&&(_0x8d62ad[_0x239988(0x1f6)]=_0x10c954);_0x315485&&(_0x8d62ad[_0x239988(0x1c6)]=_0x315485[_0x239988(0x234)](),console[_0x239988(0x1e4)](_0x239988(0x21a)+_0x315485[_0x239988(0x234)]()));(_0x6ed32a||_0x58c784)&&(_0x8d62ad[_0x239988(0x1af)]={},_0x6ed32a&&(_0x8d62ad[_0x239988(0x1af)][_0x239988(0x246)]=new Date(_0x6ed32a)),_0x58c784&&(_0x8d62ad[_0x239988(0x1af)]['lte']=new Date(_0x58c784)));_0x3e5146&&(_0x8d62ad['OR']=[{'id':{'contains':_0x3e5146,'mode':_0x239988(0x20c)}},{'orderId':{'contains':_0x3e5146,'mode':_0x239988(0x20c)}},{'gatewayOrderId':{'contains':_0x3e5146,'mode':_0x239988(0x20c)}},{'customerEmail':{'contains':_0x3e5146,'mode':_0x239988(0x20c)}},{'shop':{'name':{'contains':_0x3e5146,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x3e5146,'mode':_0x239988(0x20c)}}}]);console[_0x239988(0x1e4)]('📊\x20Final\x20WHERE\x20conditions:',JSON[_0x239988(0x13c)](_0x8d62ad,null,0x2));let _0x498644={'createdAt':_0x239988(0x1b8)};if(_0x4c36c7){const _0x5656ea=['amount',_0x239988(0x1af),_0x239988(0x13f),_0x239988(0x22a),'gateway',_0x239988(0x1c6)],_0x3dad4c=['asc',_0x239988(0x1b8)];if(_0x5656ea['includes'](_0x4c36c7)){const _0x30d3ea=_0x3dad4c[_0x239988(0x14e)](_0x382105)?_0x382105:_0x239988(0x1b8);_0x498644={[_0x4c36c7]:_0x30d3ea},console[_0x239988(0x1e4)](_0x239988(0x16b)+_0x4c36c7+_0x239988(0x24d)+_0x30d3ea+_0x239988(0x1bf));}}const [_0x154d4a,_0x30cc6b]=await Promise[_0x239988(0x179)]([database_1['default']['payment']['findMany']({'where':_0x8d62ad,'skip':_0x2cad7f,'take':_0x51891d,'orderBy':_0x498644,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x239988(0x140)][_0x239988(0x193)][_0x239988(0x249)]({'where':_0x8d62ad})]);return{'payments':_0x154d4a,'pagination':{'page':_0x2c8a35,'limit':_0x51891d,'total':_0x30cc6b,'totalPages':Math[_0x239988(0x230)](_0x30cc6b/_0x51891d)}};}async[a35_0x4e8a9b(0x175)](_0x2fcd25){const _0x1ad2a3=a35_0x4e8a9b,_0x8cb57e=await database_1[_0x1ad2a3(0x140)][_0x1ad2a3(0x193)][_0x1ad2a3(0x24b)]({'where':{'id':_0x2fcd25},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x8cb57e)return null;return{'id':_0x8cb57e['id'],'shopId':_0x8cb57e['shopId'],'gateway':_0x8cb57e[_0x1ad2a3(0x1be)],'amount':_0x8cb57e[_0x1ad2a3(0x24a)],'currency':_0x8cb57e[_0x1ad2a3(0x1c6)],'status':_0x8cb57e[_0x1ad2a3(0x22a)],'orderId':_0x8cb57e['orderId'],'gatewayOrderId':_0x8cb57e['gatewayOrderId'],'customerEmail':_0x8cb57e[_0x1ad2a3(0x1ce)],'customerName':_0x8cb57e['customerName'],'customerCountry':_0x8cb57e[_0x1ad2a3(0x127)],'customerIp':_0x8cb57e[_0x1ad2a3(0x137)],'customerUa':_0x8cb57e[_0x1ad2a3(0x135)],'failureMessage':_0x8cb57e['failureMessage'],'externalPaymentUrl':_0x8cb57e[_0x1ad2a3(0x215)],'successUrl':_0x8cb57e[_0x1ad2a3(0x192)],'failUrl':_0x8cb57e[_0x1ad2a3(0x1a7)],'pendingUrl':_0x8cb57e['pendingUrl'],'whiteUrl':_0x8cb57e['whiteUrl'],'createdAt':_0x8cb57e[_0x1ad2a3(0x1af)],'updatedAt':_0x8cb57e['updatedAt'],'shop':_0x8cb57e[_0x1ad2a3(0x243)]};}async[a35_0x4e8a9b(0x13a)](_0x46832b,_0x125c64,_0x2dcbc9,_0x4893e3){const _0x25c3fe=a35_0x4e8a9b,_0x20e2cc=await database_1[_0x25c3fe(0x140)][_0x25c3fe(0x16e)](async _0x157ebf=>{const _0x218fd2=_0x25c3fe,_0xf0c40a=await _0x157ebf[_0x218fd2(0x193)][_0x218fd2(0x24b)]({'where':{'id':_0x46832b},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0xf0c40a)throw new Error(_0x218fd2(0x16a));const _0x294f58=_0xf0c40a[_0x218fd2(0x22a)],_0x262f95=_0x125c64[_0x218fd2(0x234)]();console[_0x218fd2(0x1e4)](_0x218fd2(0x1e9)+_0x46832b+'\x20status:\x20'+_0x294f58+_0x218fd2(0x1a2)+_0x262f95),console[_0x218fd2(0x1e4)](_0x218fd2(0x13b)+_0xf0c40a[_0x218fd2(0x243)]['balance']+_0x218fd2(0x1f9));const _0x1a9ffd={'status':_0x262f95,'updatedAt':new Date(),'statusChangedBy':_0x218fd2(0x18e),'statusChangedAt':new Date()};_0x2dcbc9&&(_0x1a9ffd['adminNotes']=_0x2dcbc9);_0x262f95===_0x218fd2(0x200)&&_0x4893e3&&(_0x1a9ffd['chargebackAmount']=_0x4893e3);let _0x4bd81d=0x0,_0x107fbb=_0xf0c40a['shop'][_0x218fd2(0x219)];if(_0x262f95===_0x218fd2(0x19a)&&_0x294f58!==_0x218fd2(0x19a)){_0x1a9ffd[_0x218fd2(0x1d7)]=new Date();const _0x39080e=await currencyService_1[_0x218fd2(0x223)][_0x218fd2(0x156)](_0xf0c40a['amount'],_0xf0c40a[_0x218fd2(0x1c6)]);_0x1a9ffd[_0x218fd2(0x1f7)]=_0x39080e;let _0x5efcbe=0xa;const _0x444f7b=await _0x157ebf[_0x218fd2(0x243)][_0x218fd2(0x24b)]({'where':{'id':_0xf0c40a[_0x218fd2(0x1f6)]},'select':{'gatewaySettings':!![]}});if(_0x444f7b?.[_0x218fd2(0x21f)])try{const _0x2d1511=JSON[_0x218fd2(0x18a)](_0x444f7b[_0x218fd2(0x21f)]);for(const [_0xac432e,_0x1c1212]of Object[_0x218fd2(0x247)](_0x2d1511)){if(_0xac432e[_0x218fd2(0x24c)]()===_0xf0c40a[_0x218fd2(0x1be)][_0x218fd2(0x24c)]()){_0x5efcbe=_0x1c1212[_0x218fd2(0x11b)]||0xa;break;}}}catch(_0x13700c){console['error'](_0x218fd2(0x128)+_0x46832b+':',_0x13700c);}const _0xceef3a=_0x39080e*(0x1-_0x5efcbe/0x64);_0x4bd81d=_0xceef3a,_0x107fbb+=_0xceef3a,console[_0x218fd2(0x1e4)](_0x218fd2(0x1fa)+_0x46832b+'\x20became\x20PAID:'),console[_0x218fd2(0x1e4)](_0x218fd2(0x131)+_0x39080e[_0x218fd2(0x1c2)](0x6)+_0x218fd2(0x1f9)),console[_0x218fd2(0x1e4)](_0x218fd2(0x235)+_0xf0c40a[_0x218fd2(0x1be)]+_0x218fd2(0x1cb)+_0x5efcbe+'%'),console[_0x218fd2(0x1e4)](_0x218fd2(0x241)+_0xceef3a[_0x218fd2(0x1c2)](0x6)+_0x218fd2(0x237)+_0x5efcbe+_0x218fd2(0x227)),console[_0x218fd2(0x1e4)](_0x218fd2(0x250)+_0xceef3a[_0x218fd2(0x1c2)](0x6)+_0x218fd2(0x1f9));}else{if(_0x294f58==='PAID'&&_0x262f95!==_0x218fd2(0x19a)){if(_0xf0c40a[_0x218fd2(0x1f7)]){let _0x5cfae7=0xa;const _0x11fbfe=await _0x157ebf[_0x218fd2(0x243)][_0x218fd2(0x24b)]({'where':{'id':_0xf0c40a[_0x218fd2(0x1f6)]},'select':{'gatewaySettings':!![]}});if(_0x11fbfe?.[_0x218fd2(0x21f)])try{const _0x1c60be=JSON['parse'](_0x11fbfe[_0x218fd2(0x21f)]);for(const [_0xc19896,_0x5a5e7d]of Object[_0x218fd2(0x247)](_0x1c60be)){if(_0xc19896['toLowerCase']()===_0xf0c40a['gateway'][_0x218fd2(0x24c)]()){_0x5cfae7=_0x5a5e7d[_0x218fd2(0x11b)]||0xa;break;}}}catch(_0x182d5b){console[_0x218fd2(0x207)](_0x218fd2(0x128)+_0x46832b+':',_0x182d5b);}const _0x3939ec=_0xf0c40a['amountUSDT']*(0x1-_0x5cfae7/0x64);_0x4bd81d=-_0x3939ec,_0x107fbb-=_0x3939ec,_0x1a9ffd[_0x218fd2(0x1f7)]=null,console[_0x218fd2(0x1e4)]('💰\x20Payment\x20'+_0x46832b+_0x218fd2(0x239)),console[_0x218fd2(0x1e4)](_0x218fd2(0x131)+_0xf0c40a[_0x218fd2(0x1f7)]['toFixed'](0x6)+_0x218fd2(0x1f9)),console[_0x218fd2(0x1e4)](_0x218fd2(0x235)+_0xf0c40a[_0x218fd2(0x1be)]+_0x218fd2(0x1cb)+_0x5cfae7+'%'),console[_0x218fd2(0x1e4)](_0x218fd2(0x1ec)+_0x3939ec[_0x218fd2(0x1c2)](0x6)+'\x20USDT\x20(after\x20'+_0x5cfae7+_0x218fd2(0x227)),console[_0x218fd2(0x1e4)](_0x218fd2(0x1d1)+_0x3939ec[_0x218fd2(0x1c2)](0x6)+'\x20USDT');}}}_0x262f95===_0x218fd2(0x200)&&(_0x294f58===_0x218fd2(0x19a)&&_0xf0c40a[_0x218fd2(0x1f7)]&&console[_0x218fd2(0x1e4)](_0x218fd2(0x1ab)),_0x4893e3&&_0x4893e3>0x0&&(_0x4bd81d-=_0x4893e3,_0x107fbb-=_0x4893e3,console[_0x218fd2(0x1e4)](_0x218fd2(0x12f)+_0x4893e3['toFixed'](0x6)+_0x218fd2(0x1f4))));_0x262f95===_0x218fd2(0x1b0)&&_0x294f58===_0x218fd2(0x19a)&&console[_0x218fd2(0x1e4)](_0x218fd2(0x1dd));const _0x2e6f81=await _0x157ebf['payment']['update']({'where':{'id':_0x46832b},'data':_0x1a9ffd,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x4bd81d!==0x0&&(await _0x157ebf['shop'][_0x218fd2(0x129)]({'where':{'id':_0xf0c40a[_0x218fd2(0x1f6)]},'data':{'balance':_0x107fbb}}),console[_0x218fd2(0x1e4)]('💰\x20Shop\x20'+_0xf0c40a['shopId']+_0x218fd2(0x206)+_0xf0c40a[_0x218fd2(0x243)][_0x218fd2(0x219)]['toFixed'](0x6)+_0x218fd2(0x1a2)+_0x107fbb[_0x218fd2(0x1c2)](0x6)+_0x218fd2(0x1d0)+(_0x4bd81d>0x0?'+':'')+_0x4bd81d['toFixed'](0x6)+')')),_0x2e6f81;});return{'id':_0x20e2cc['id'],'shopId':_0x20e2cc[_0x25c3fe(0x1f6)],'gateway':_0x20e2cc['gateway'],'amount':_0x20e2cc[_0x25c3fe(0x24a)],'currency':_0x20e2cc[_0x25c3fe(0x1c6)],'status':_0x20e2cc['status'],'orderId':_0x20e2cc['orderId'],'gatewayOrderId':_0x20e2cc[_0x25c3fe(0x20d)],'customerEmail':_0x20e2cc[_0x25c3fe(0x1ce)],'customerName':_0x20e2cc[_0x25c3fe(0x1d4)],'customerCountry':_0x20e2cc[_0x25c3fe(0x127)],'customerIp':_0x20e2cc[_0x25c3fe(0x137)],'customerUa':_0x20e2cc[_0x25c3fe(0x135)],'failureMessage':_0x20e2cc[_0x25c3fe(0x1ef)],'adminNotes':_0x20e2cc[_0x25c3fe(0x146)],'chargebackAmount':_0x20e2cc[_0x25c3fe(0x13d)],'statusChangedBy':_0x20e2cc['statusChangedBy'],'statusChangedAt':_0x20e2cc[_0x25c3fe(0x183)],'createdAt':_0x20e2cc['createdAt'],'updatedAt':_0x20e2cc[_0x25c3fe(0x13f)],'shop':_0x20e2cc[_0x25c3fe(0x243)]};}async[a35_0x4e8a9b(0x119)](_0x3bcc0e,_0x250897){const _0x4bb20a=a35_0x4e8a9b,_0x10560c={..._0x250897};_0x250897[_0x4bb20a(0x1fb)]&&(_0x10560c['password']=await bcryptjs_1[_0x4bb20a(0x140)][_0x4bb20a(0x161)](_0x250897[_0x4bb20a(0x1fb)],0xc));_0x250897[_0x4bb20a(0x15c)]&&(_0x10560c[_0x4bb20a(0x225)]=_0x250897[_0x4bb20a(0x15c)],delete _0x10560c[_0x4bb20a(0x15c)]);_0x250897['telegramId']&&(_0x10560c[_0x4bb20a(0x130)]=_0x250897[_0x4bb20a(0x14a)],delete _0x10560c[_0x4bb20a(0x14a)]);_0x250897[_0x4bb20a(0x248)]&&(_0x10560c['shopUrl']=_0x250897[_0x4bb20a(0x248)],delete _0x10560c[_0x4bb20a(0x248)]);if(_0x250897[_0x4bb20a(0x204)]){const _0xaab933=_0x250897[_0x4bb20a(0x204)][_0x4bb20a(0x152)](_0x4ddb8f=>this[_0x4bb20a(0x1e5)](_0x4ddb8f));console[_0x4bb20a(0x1e4)](_0x4bb20a(0x20a),_0x250897[_0x4bb20a(0x204)],'->',_0xaab933),_0x10560c[_0x4bb20a(0x154)]=JSON[_0x4bb20a(0x13c)](_0xaab933),delete _0x10560c['gateways'];}_0x250897['gatewaySettings']&&(_0x10560c['gatewaySettings']=JSON[_0x4bb20a(0x13c)](_0x250897['gatewaySettings']),delete _0x10560c[_0x4bb20a(0x21f)]);_0x250897[_0x4bb20a(0x151)]&&(_0x250897['wallets'][_0x4bb20a(0x1b2)]!==undefined&&(_0x10560c[_0x4bb20a(0x1b2)]=_0x250897[_0x4bb20a(0x151)]['usdtPolygonWallet']||null),_0x250897[_0x4bb20a(0x151)]['usdtTrcWallet']!==undefined&&(_0x10560c[_0x4bb20a(0x153)]=_0x250897[_0x4bb20a(0x151)][_0x4bb20a(0x153)]||null),_0x250897[_0x4bb20a(0x151)][_0x4bb20a(0x24f)]!==undefined&&(_0x10560c[_0x4bb20a(0x24f)]=_0x250897[_0x4bb20a(0x151)][_0x4bb20a(0x24f)]||null),_0x250897[_0x4bb20a(0x151)][_0x4bb20a(0x170)]!==undefined&&(_0x10560c[_0x4bb20a(0x170)]=_0x250897[_0x4bb20a(0x151)]['usdcPolygonWallet']||null),delete _0x10560c['wallets']);const _0x348ff1=await database_1['default']['shop'][_0x4bb20a(0x129)]({'where':{'id':_0x3bcc0e},'data':_0x10560c,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x348ff1['id'],'fullName':_0x348ff1['name'],'username':_0x348ff1[_0x4bb20a(0x15e)],'telegramId':_0x348ff1[_0x4bb20a(0x130)],'merchantUrl':_0x348ff1['shopUrl'],'gateways':_0x348ff1['paymentGateways']?JSON[_0x4bb20a(0x18a)](_0x348ff1[_0x4bb20a(0x154)]):null,'gatewaySettings':_0x348ff1[_0x4bb20a(0x21f)]?JSON[_0x4bb20a(0x18a)](_0x348ff1[_0x4bb20a(0x21f)]):null,'publicKey':_0x348ff1['publicKey'],'wallets':{'usdtPolygonWallet':_0x348ff1[_0x4bb20a(0x1b2)],'usdtTrcWallet':_0x348ff1[_0x4bb20a(0x153)],'usdtErcWallet':_0x348ff1[_0x4bb20a(0x24f)],'usdcPolygonWallet':_0x348ff1[_0x4bb20a(0x170)]},'status':_0x348ff1[_0x4bb20a(0x22a)],'createdAt':_0x348ff1['createdAt']};}async['suspendUser'](_0x1e339f){const _0x2e3542=a35_0x4e8a9b,_0x431faf=await database_1[_0x2e3542(0x140)][_0x2e3542(0x243)][_0x2e3542(0x129)]({'where':{'id':_0x1e339f},'data':{'status':_0x2e3542(0x142)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x431faf['id'],'fullName':_0x431faf['name'],'username':_0x431faf['username'],'telegramId':_0x431faf['telegram'],'merchantUrl':_0x431faf['shopUrl'],'gateways':_0x431faf[_0x2e3542(0x154)]?JSON['parse'](_0x431faf[_0x2e3542(0x154)]):null,'gatewaySettings':_0x431faf[_0x2e3542(0x21f)]?JSON[_0x2e3542(0x18a)](_0x431faf[_0x2e3542(0x21f)]):null,'publicKey':_0x431faf[_0x2e3542(0x1d8)],'wallets':{'usdtPolygonWallet':_0x431faf[_0x2e3542(0x1b2)],'usdtTrcWallet':_0x431faf[_0x2e3542(0x153)],'usdtErcWallet':_0x431faf['usdtErcWallet'],'usdcPolygonWallet':_0x431faf[_0x2e3542(0x170)]},'status':_0x431faf[_0x2e3542(0x22a)],'createdAt':_0x431faf[_0x2e3542(0x1af)]};}async[a35_0x4e8a9b(0x23c)](_0x59ad73){const _0x10f80d=a35_0x4e8a9b,_0x1cf236=await database_1[_0x10f80d(0x140)][_0x10f80d(0x243)]['update']({'where':{'id':_0x59ad73},'data':{'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x1cf236['id'],'fullName':_0x1cf236['name'],'username':_0x1cf236['username'],'telegramId':_0x1cf236[_0x10f80d(0x130)],'merchantUrl':_0x1cf236['shopUrl'],'gateways':_0x1cf236[_0x10f80d(0x154)]?JSON['parse'](_0x1cf236[_0x10f80d(0x154)]):null,'gatewaySettings':_0x1cf236[_0x10f80d(0x21f)]?JSON[_0x10f80d(0x18a)](_0x1cf236['gatewaySettings']):null,'publicKey':_0x1cf236['publicKey'],'wallets':{'usdtPolygonWallet':_0x1cf236[_0x10f80d(0x1b2)],'usdtTrcWallet':_0x1cf236[_0x10f80d(0x153)],'usdtErcWallet':_0x1cf236[_0x10f80d(0x24f)],'usdcPolygonWallet':_0x1cf236[_0x10f80d(0x170)]},'status':_0x1cf236['status'],'createdAt':_0x1cf236[_0x10f80d(0x1af)]};}async['getAllUsers'](_0x31d091){const _0x479057=a35_0x4e8a9b,{page:_0x37e754,limit:_0x44002e,status:_0x439dd3}=_0x31d091,_0xed84e6=(_0x37e754-0x1)*_0x44002e,_0x2d412f={};_0x439dd3&&(_0x2d412f['status']=_0x439dd3[_0x479057(0x234)]());const [_0x354836,_0x14190b]=await Promise[_0x479057(0x179)]([database_1[_0x479057(0x140)][_0x479057(0x243)][_0x479057(0x136)]({'where':_0x2d412f,'skip':_0xed84e6,'take':_0x44002e,'orderBy':{'createdAt':_0x479057(0x1b8)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x479057(0x140)][_0x479057(0x243)][_0x479057(0x249)]({'where':_0x2d412f})]);return{'users':_0x354836[_0x479057(0x152)](_0x4a3579=>{const _0x4f50ac=_0x479057,_0x1d1642=_0x4a3579[_0x4f50ac(0x154)]?JSON[_0x4f50ac(0x18a)](_0x4a3579[_0x4f50ac(0x154)]):null,_0xd478f5=_0x1d1642?_0x1d1642[_0x4f50ac(0x152)](_0x4ba5cc=>this[_0x4f50ac(0x23f)](_0x4ba5cc)):null;return{'id':_0x4a3579['id'],'fullName':_0x4a3579[_0x4f50ac(0x225)],'username':_0x4a3579[_0x4f50ac(0x15e)],'telegramId':_0x4a3579['telegram'],'merchantUrl':_0x4a3579[_0x4f50ac(0x167)],'gateways':_0xd478f5,'gatewaySettings':_0x4a3579['gatewaySettings']?JSON['parse'](_0x4a3579[_0x4f50ac(0x21f)]):null,'publicKey':_0x4a3579[_0x4f50ac(0x1d8)],'wallets':{'usdtPolygonWallet':_0x4a3579[_0x4f50ac(0x1b2)],'usdtTrcWallet':_0x4a3579[_0x4f50ac(0x153)],'usdtErcWallet':_0x4a3579[_0x4f50ac(0x24f)],'usdcPolygonWallet':_0x4a3579[_0x4f50ac(0x170)]},'status':_0x4a3579[_0x4f50ac(0x22a)],'createdAt':_0x4a3579[_0x4f50ac(0x1af)]};}),'pagination':{'page':_0x37e754,'limit':_0x44002e,'total':_0x14190b,'totalPages':Math[_0x479057(0x230)](_0x14190b/_0x44002e)}};}async[a35_0x4e8a9b(0x236)](_0x1da180){const _0x36df01=a35_0x4e8a9b,_0x13766f=await database_1['default']['shop'][_0x36df01(0x24b)]({'where':{'id':_0x1da180},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x13766f)return null;const _0x3f59d4=_0x13766f['paymentGateways']?JSON[_0x36df01(0x18a)](_0x13766f[_0x36df01(0x154)]):null,_0x44cfb7=_0x3f59d4?_0x3f59d4[_0x36df01(0x152)](_0x13adee=>this['getGatewayDisplayName'](_0x13adee)):null;return _0x3f59d4&&_0x44cfb7&&console[_0x36df01(0x1e4)](_0x36df01(0x168),_0x3f59d4,'->',_0x44cfb7),{'id':_0x13766f['id'],'fullName':_0x13766f['name'],'username':_0x13766f['username'],'telegramId':_0x13766f[_0x36df01(0x130)],'merchantUrl':_0x13766f[_0x36df01(0x167)],'gateways':_0x44cfb7,'gatewaySettings':_0x13766f[_0x36df01(0x21f)]?JSON[_0x36df01(0x18a)](_0x13766f[_0x36df01(0x21f)]):null,'publicKey':_0x13766f['publicKey'],'wallets':{'usdtPolygonWallet':_0x13766f['usdtPolygonWallet'],'usdtTrcWallet':_0x13766f[_0x36df01(0x153)],'usdtErcWallet':_0x13766f['usdtErcWallet'],'usdcPolygonWallet':_0x13766f[_0x36df01(0x170)]},'status':_0x13766f[_0x36df01(0x22a)],'createdAt':_0x13766f[_0x36df01(0x1af)]};}async['createUser'](_0x349834){const _0x179a01=a35_0x4e8a9b,{fullName:_0x4e2905,username:_0x3dd8a6,password:_0x58bcfc,telegramId:_0x4d5db0,merchantUrl:_0x234e8d,gateways:_0x483a96,gatewaySettings:_0x33e166,wallets:_0x45b166}=_0x349834,_0x14fa0f=await database_1[_0x179a01(0x140)][_0x179a01(0x243)]['findUnique']({'where':{'username':_0x3dd8a6}});if(_0x14fa0f)throw new Error('Username\x20already\x20exists');if(_0x4d5db0){const _0x9df332=await database_1[_0x179a01(0x140)][_0x179a01(0x243)]['findUnique']({'where':{'telegram':_0x4d5db0}});if(_0x9df332)throw new Error('Telegram\x20username\x20already\x20exists');}const _0x339e58=await bcryptjs_1[_0x179a01(0x140)][_0x179a01(0x161)](_0x58bcfc,0xc),_0x20d8dd=_0x179a01(0x1b6)+crypto_1['default'][_0x179a01(0x172)](0x20)[_0x179a01(0x126)](_0x179a01(0x1e7)),_0x542864='sk_'+crypto_1[_0x179a01(0x140)][_0x179a01(0x172)](0x20)[_0x179a01(0x126)](_0x179a01(0x1e7)),_0x2dc6d5=_0x483a96?_0x483a96[_0x179a01(0x152)](_0x501936=>this[_0x179a01(0x1e5)](_0x501936)):null;_0x483a96&&_0x2dc6d5&&console['log']('🔄\x20Gateway\x20mapping\x20(create):',_0x483a96,'->',_0x2dc6d5);const _0x3c57e2=await database_1[_0x179a01(0x140)]['shop']['create']({'data':{'name':_0x4e2905,'username':_0x3dd8a6,'password':_0x339e58,'telegram':_0x4d5db0,'shopUrl':_0x234e8d,'paymentGateways':_0x2dc6d5?JSON['stringify'](_0x2dc6d5):null,'gatewaySettings':_0x33e166?JSON[_0x179a01(0x13c)](_0x33e166):null,'usdtPolygonWallet':_0x45b166?.[_0x179a01(0x1b2)]||null,'usdtTrcWallet':_0x45b166?.['usdtTrcWallet']||null,'usdtErcWallet':_0x45b166?.[_0x179a01(0x24f)]||null,'usdcPolygonWallet':_0x45b166?.['usdcPolygonWallet']||null,'publicKey':_0x20d8dd,'secretKey':_0x542864,'status':_0x179a01(0x205)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x3c57e2['id'],'fullName':_0x3c57e2[_0x179a01(0x225)],'username':_0x3c57e2[_0x179a01(0x15e)],'telegramId':_0x3c57e2[_0x179a01(0x130)],'merchantUrl':_0x3c57e2[_0x179a01(0x167)],'gateways':_0x3c57e2['paymentGateways']?JSON[_0x179a01(0x18a)](_0x3c57e2[_0x179a01(0x154)]):null,'gatewaySettings':_0x3c57e2[_0x179a01(0x21f)]?JSON['parse'](_0x3c57e2[_0x179a01(0x21f)]):null,'publicKey':_0x3c57e2[_0x179a01(0x1d8)],'wallets':{'usdtPolygonWallet':_0x3c57e2['usdtPolygonWallet'],'usdtTrcWallet':_0x3c57e2[_0x179a01(0x153)],'usdtErcWallet':_0x3c57e2['usdtErcWallet'],'usdcPolygonWallet':_0x3c57e2[_0x179a01(0x170)]},'status':_0x3c57e2[_0x179a01(0x22a)],'createdAt':_0x3c57e2[_0x179a01(0x1af)]};}async[a35_0x4e8a9b(0x17d)](_0x13eb68){const _0x2ddf0a=a35_0x4e8a9b;await database_1['default'][_0x2ddf0a(0x243)][_0x2ddf0a(0x1cf)]({'where':{'id':_0x13eb68}});}[a35_0x4e8a9b(0x12e)](_0x42edab,_0x3d673c,_0x5db1a0){const _0x1cc0f2=a35_0x4e8a9b,_0x3808f6=new Map(),_0x3f1fb9=new Date(_0x3d673c);while(_0x3f1fb9<=_0x5db1a0){const _0x2cbdc8=_0x3f1fb9[_0x1cc0f2(0x166)]()['split']('T')[0x0];_0x3808f6[_0x1cc0f2(0x1ff)](_0x2cbdc8,{'revenue':0x0,'count':0x0}),_0x3f1fb9[_0x1cc0f2(0x1e3)](_0x3f1fb9[_0x1cc0f2(0x191)]()+0x1);}for(const _0x3fdf02 of _0x42edab){const _0x38750d=_0x3fdf02['createdAt'][_0x1cc0f2(0x166)]()[_0x1cc0f2(0x19f)]('T')[0x0],_0x473608=_0x3808f6[_0x1cc0f2(0x164)](_0x38750d);_0x473608&&(_0x473608[_0x1cc0f2(0x249)]+=0x1,_0x3fdf02['status']===_0x1cc0f2(0x19a)&&(_0x3fdf02[_0x1cc0f2(0x1f7)]?_0x473608[_0x1cc0f2(0x163)]+=_0x3fdf02[_0x1cc0f2(0x1f7)]:console['log'](_0x1cc0f2(0x1bb)+_0x3fdf02['id']+_0x1cc0f2(0x1de))));}const _0x79c52b=[],_0x1bc676=[];for(const [_0x4ad127,_0x3a1c20]of _0x3808f6){_0x79c52b[_0x1cc0f2(0x1aa)]({'date':_0x4ad127,'amount':Math[_0x1cc0f2(0x1ed)](_0x3a1c20[_0x1cc0f2(0x163)]*0x64)/0x64}),_0x1bc676['push']({'date':_0x4ad127,'count':_0x3a1c20[_0x1cc0f2(0x249)]});}return{'dailyRevenue':_0x79c52b,'dailyPayments':_0x1bc676};}}exports[a35_0x4e8a9b(0x213)]=AdminService;