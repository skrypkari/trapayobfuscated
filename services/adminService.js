'use strict';const a48_0x2aeaec=a48_0x23c6;(function(_0x587927,_0x55802b){const _0xa7981c=a48_0x23c6,_0x27246e=_0x587927();while(!![]){try{const _0x10a997=-parseInt(_0xa7981c(0x202))/0x1+-parseInt(_0xa7981c(0x20e))/0x2+parseInt(_0xa7981c(0x214))/0x3*(parseInt(_0xa7981c(0x28a))/0x4)+-parseInt(_0xa7981c(0x2e7))/0x5*(-parseInt(_0xa7981c(0x314))/0x6)+parseInt(_0xa7981c(0x2d9))/0x7+-parseInt(_0xa7981c(0x1d5))/0x8*(-parseInt(_0xa7981c(0x24d))/0x9)+-parseInt(_0xa7981c(0x2ed))/0xa;if(_0x10a997===_0x55802b)break;else _0x27246e['push'](_0x27246e['shift']());}catch(_0x4440bc){_0x27246e['push'](_0x27246e['shift']());}}}(a48_0x1bd0,0xf1375));var __importDefault=this&&this[a48_0x2aeaec(0x1ed)]||function(_0x391d0c){const _0x2a8603=a48_0x2aeaec;return _0x391d0c&&_0x391d0c[_0x2a8603(0x2f7)]?_0x391d0c:{'default':_0x391d0c};};function a48_0x23c6(_0x408a54,_0xf0e519){_0x408a54=_0x408a54-0x191;const _0x1bd055=a48_0x1bd0();let _0x23c635=_0x1bd055[_0x408a54];return _0x23c635;}Object[a48_0x2aeaec(0x1a7)](exports,'__esModule',{'value':!![]}),exports[a48_0x2aeaec(0x1fe)]=void 0x0;const database_1=__importDefault(require(a48_0x2aeaec(0x20c))),bcryptjs_1=__importDefault(require(a48_0x2aeaec(0x2ac))),crypto_1=__importDefault(require(a48_0x2aeaec(0x2b9))),speakeasy_1=__importDefault(require(a48_0x2aeaec(0x1e6))),qrcode_1=__importDefault(require(a48_0x2aeaec(0x31d))),currencyService_1=require(a48_0x2aeaec(0x220)),telegramBotService_1=require(a48_0x2aeaec(0x1fd)),gateway_1=require('../types/gateway');function a48_0x1bd0(){const _0x27f131=['usdcPolygonWallet','%\x20commission)','create','toLowerCase','ÐÐµ\x20ÑƒÐºÐ°Ð·Ð°Ð½','asc','getAllPayouts','statusChangedBy','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','ðŸ”\x20Selected\x20erc20_usdc\x20wallet:\x20','ðŸ”„\x20Gateway\x20mapping\x20(get):','awaitingPayout','\x20-\x20','getFullYear','\x20\x20\x20ðŸŒ\x20IP:\x20','usdtTrcWallet','ðŸ“Š\x20Statistics\x20PAID\x20payments\x20count:\x20','\x20USDT\x20(+','\x20USDT\x20(theoretical\x20net)','convertToUSDT','polygon',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','\x20\x20\x20ðŸ’°\x20Total\x20turnover:\x20','MaxPara','rapyd','stringify','findMany','generateBackupCodes','status','length','cointopay','createPayout','fullName',']\x20Updating\x20password\x20for\x20user\x20','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','OnRamp','ðŸ”\x202FA\x20setup\x20initiated\x20for\x20shop:\x20','\x20\x20\x20Shop\x20balance:\x20','\x20\x20\x20Balance:\x20','ðŸ”\x20Using\x20gateway\x20\x27','amount','ðŸ”\x20Initial\x20wallet\x20from\x20request:\x20','totalPaidOut','\x20\x20\x20ðŸ’³\x20Total\x20payments:\x20','ðŸ”\x20Shop\x20wallets:','72TiqgfT','commission','error','Invalid\x202FA\x20token','\x20\x20\x20ðŸ”\x20Calculated\x20after\x20commission:\x20','ðŸ”„\x20Updating\x20customer\x20data\x20for\x20payment\x20','reduce','NONEXISTENT_GATEWAY_FILTER','get','ðŸ”„\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','ðŸŽ¯\x20[','\x20for\x20shop\x20','push','some','\x20->\x20','ðŸ’±\x20Currency\x20filter\x20applied:\x20','\x20\x20\x20ðŸ‘¤\x20Merchant\x20earnings:\x20','merchantEarningsUSDT','\x20USDT,\x20Required:\x20','insensitive','2FA\x20is\x20already\x20enabled','ðŸ’°\x20Shop\x20','ðŸ“…\x20Payout\x20date\x20from\x20filter:\x20','default','createdAt','ðŸ”\x20Selected\x20trc20\x20wallet:\x20',',\x20userId:\x20','setup2FA','getPayoutById','getUTCMonth','ðŸ“…\x20Date\x20to\x20filter:\x20','twoFactorSecret','lastMonth','ðŸ’°\x20Current\x20shop\x20balance:\x20','bcryptjs','payout','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','telegramBotService','whiteUrl','ðŸ’³\x20Final\x20payout\x20wallet\x20for\x20','forEach','year','\x27\x20->\x20name\x20\x27','periodTo','\x20USDT\x20(after\x20','ru-RU','\x20\x20\x20Requested\x20(number):\x20','crypto','\x20USDT)','\x20order','notes','\x20balance\x20updated:\x20','ðŸ“Š\x20Getting\x20payments\x20with\x20filters:','last_month','ðŸ“…\x20Date\x20from\x20filter:\x20','verify','ACTIVE','ðŸ“Š\x20Total\x20payments\x20(including\x20failed):\x20','ðŸ“Š\x20Gateway\x20filter\x20applied:','floor','getMerchantsAwaitingPayout','today','getGatewayDisplayName','\x20USDT\x20-\x20will\x20return\x20to\x20balance',':\x20commission\x20=\x20','set','amountAfterGatewayCommissionUSDT','totalTurnover','abs','COMPLETED','toFixed','\x20became\x20PAID:','activateUser','toLocaleDateString','paymentGateways','klyme_eu','random','MyXSpend','hex','8378818DFXhhF','klyme_de','payouts','\x20USDT,\x20merchant:\x20','password','getPayoutStats','currency','shopUrl','totalPayments','filter','thisMonth','substr','trim','amountAfterCommissionUSDT','10ULgLbv','dateFrom','randomBytes','\x20backup\x20codes','ðŸ”„\x20Converted\x20gateway\x20ID\x20\x27','%\x20from\x20','10402660SJpucy','gatewayEarnings','\x20\x20\x20Total\x20paid\x20out:\x20','ðŸ“Š\x20Statistics\x20date\x20range:\x20','turnover','\x20\x20\x20Final\x20payout\x20amount\x20used:\x20','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','base32','balance','getGatewayInternalName','__esModule','test_gateway','telegram','ðŸ“Š\x20Payout\x20statistics\x20calculated:','getMerchantsSelection','AmPay\x20TRY','updateUser','periodFrom','totalCommissionRate','âœ…\x20Payout\x20created:\x20','\x20\x20\x20ï¿½\x20Total\x20paid\x20out:\x20','map','paymentsCount','ðŸ’°\x20Creating\x20payout\x20for\x20shop\x20','\x20\x20\x20Available\x20(number):\x20','ðŸ”\x20No\x20wallet\x20provided,\x20looking\x20up\x20from\x20shop\x20settings...','\x20merchants\x20with\x20rounded\x20balance\x20!=\x200.00\x20(excluding\x20balances\x20that\x20round\x20to\x200.00)','otpauth_url','count','ðŸ”\x20Creating\x20payout\x20with\x20data:','\x20\x20\x20Current\x20amount:\x20','ðŸ”\x20Total\x20payments\x20matching\x20filters:\x20','\x20USDT,\x20Difference:\x20','customerName','getUserById','\x20\x20\x20ðŸ’°\x20Total\x20payments\x20turnover:\x20','replace','deletePayout','toISOString','2230314NxWZwa','\x20\x20\x20ðŸ’°\x20Total\x20payout:\x20','deleteUser','\x20updated\x20successfully','ðŸ“Š\x20Using\x20saved\x20values\x20for\x20payment\x20','Payment\x20not\x20found','ðŸ’°\x20[PAYOUT]\x20Merchant\x20','setUTCDate','âœ…\x20Customer\x20data\x20updated\x20for\x20payment\x20','qrcode','\x20\x20\x20Merchant\x20gets:\x20','\x20USDT\x20(gross\x20revenue)','aggregate','adminNotes','getSystemStatistics','log','customerCountry','findUnique','min','round','ðŸ’°\x20Payment\x20amount\x20is\x20NOT\x20deducted\x20(chargeback\x20penalty\x20only)','shopId','ðŸ”‘\x20Generated\x20','getUTCDate','lte','generateDailyStatistics','Error\x20processing\x20payment\x20','ðŸ”\x20Balance\x20check\x20details:','\x20USDT,\x20Requested:\x20','failureMessage','customerUa','PAID','âœ…\x20Using\x20wallet\x20from\x20request:\x20','getShopWallets','toString','KLYME\x20DE','CHARGEBACK','not\x20specified','totalAmountUSDT','all','ðŸ’¸\x20CHARGEBACK:\x20Processing\x20penalty-only\x20deduction','\x20\x20\x20ðŸ’¸\x20Total\x20payouts\x20(all\x20time):\x20','yesterday','currencyService',']\x20Gateway\x20settings\x20before\x20saving:','\x20\x20\x20ðŸ’¸\x20Total\x20payouts:\x20','last_week','defineProperty',',\x20successful:\x20','ðŸ”§\x20[','\x27\x20not\x20found.\x20Available\x20gateways:\x20','not\x20set','\x20\x20\x20Full\x20amount:\x20','gte','\x20\x20\x20Added\x20to\x20balance:\x20+','groupBy','âš ï¸\x20Payment\x20','totalPayout','gateway','startsWith','merchantUrl','usdtErcWallet','mastercard','ðŸ“…\x20Payout\x20date\x20to\x20filter:\x20','cointopay2','ðŸ“Š\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','orderId','0000','getMerchantStatistics','\x20USDT\x20(already\x20paid\x20out)','SquirrelPay','twoFactorEnabled','âš ï¸\x20Requested\x20gateway\x20\x27','Insufficient\x20balance.\x20Available:\x20','commissionUSDT','âœ…\x20Balance\x20check\x20passed\x20(with\x20tolerance)','\x20\x20\x20ðŸ’µ\x20Available\x20balance:\x20','\x20\x20\x20ðŸª\x20Gateway\x20earnings:\x20','Username\x20already\x20exists','getUTCDay','\x20USDT\x20(current\x20balance\x20in\x20DB)','ðŸ“Š\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','ðŸ’°\x20Payment\x20','\x20\x20\x20Current\x20network:\x20','ðŸ”„\x20Gateway\x20mapping:','sendPayoutNotification','\x20\x20\x20Gateway:\x20','getUTCFullYear','OxaPay','PENDING','SUSPENDED','ðŸ“Š\x20Merchants\x20with\x20rounded\x20balance\x20!=\x200.00:\x20','ðŸ”\x20Selected\x20polygon_usdc\x20wallet:\x20','490392VsDLHQ','name','gatewaySettings','\x20\x20\x20Payout\x20amount:\x20','ðŸ“Š\x20Sorting\x20payments\x20by\x20','2020-01-01','username','publicKey','entries','getTime','ðŸ”\x20Selected\x20erc20\x20wallet:\x20','ðŸ’°\x20Updating\x20payout\x20','desc','getAllPayments','\x20\x20\x20ðŸŒ\x20Country:\x20','ðŸ“‹\x20Found\x20','\x20\x20\x20Available\x20(raw):\x20','speakeasy','getMonth','update','\x20USDT\x20(total\x20paid\x20to\x20merchants)','hash','shop','ðŸ”\x202FA\x20enabled\x20for\x20shop:\x20','__importDefault','Shop\x20not\x20found','delete','payment','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','Visa/MasterCard','Interac','\x20\x20\x20ðŸ“…\x20This\x20month:\x20','\x20\x20\x20ï¿½\x20Total\x20payments\x20turnover:\x20','updatedAt','ðŸ“Š\x20Calculating\x20payout\x20statistics...','ðŸ”\x20Selected\x20polygon\x20wallet:\x20',',\x20Commission:\x20','turnoverUSDT','dailyPayments','TrapaPay','./telegramBotService','AdminService','txid','toUpperCase','totalAmountAfterCommissionUSDT','143495VDcCiS','ðŸ”„\x20Gateway\x20mapping\x20(create):','UTC','noda','month','merchantEarnings','paidAt','pendingPayout','\x20with\x20payout\x20history','\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)','../config/database','updatePayout','415174ZECJGM','wallets','averageCheckUSDT','ðŸ“±\x20Telegram\x20notification\x20sent\x20for\x20payout\x20','values','\x20\x20\x20ðŸ¤”\x20Difference:\x20','1644zLIDqk','week','_count','date','customerIp','amountUSDT','âœ…\x20Using\x20gateway\x20filter:\x20\x27','gateways','dateTo','\x20\x20\x20ðŸ“…\x20Total\x20payouts\x20(this\x20month):\x20','\x20\x20\x20Shop\x20totalPaidOut:\x20','\x20USDT\x20from\x20balance','./currencyService','toDataURL','wallet','findFirst','ðŸ“Š\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','\x20\x20\x20Difference:\x20','customerEmail','erc20','\x20USDT','network','split','disable2FA','parse','Noda','\x20\x20\x20âœ…\x20Total\x20net\x20balances:\x20','TrapaPay\x20(','erc20_usdc','ðŸ’°\x20Found\x20','ðŸ“Š\x20Final\x20WHERE\x20conditions:','\x20\x20\x20Subtracted\x20from\x20balance:\x20-',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','gatewayCommissionRate','KLYME\x20EU','custom_','EXPIRED','revenue','ðŸ“Š\x20Statistics\x20WHERE\x20conditions:','Rapyd','chargebackAmount','REFUND','plisio','_sum','\x20\x20\x20Current\x20balance:\x20','polygon_usdc','\x20USDT\x20-\x20will\x20deduct\x20from\x20balance','usdcErcWallet','$transaction','ceil','generateSecret','setHours','getAllUsers','custom','\x27\x20->\x20ID\x20\x27','period','âŒ\x20Failed\x20to\x20send\x20Telegram\x20notification\x20for\x20payout\x20','63WTbtTG','\x20\x20\x20âœ…\x20Actual\x20available\x20balance:\x20','updateCustomerData','\x27\x20(from\x20\x27','telegramId','includes','averageCommissionRate','Sepa','getGatewayNameById','successUrl','usdtPolygonWallet','\x20\x20\x20Tolerance:\x20','sk_','\x20\x20\x20ï¿½ðŸ“Š\x20Total\x20payments:\x20','\x20\x20\x20Transaction\x20hash:\x20','\x20USDT\x20for\x20payment\x20'];a48_0x1bd0=function(){return _0x27f131;};return a48_0x1bd0();}class AdminService{async[a48_0x2aeaec(0x2de)](){const _0x2eb935=a48_0x2aeaec;console[_0x2eb935(0x323)](_0x2eb935(0x1f7));const _0x3a0a4f=await database_1[_0x2eb935(0x2a1)]['shop'][_0x2eb935(0x320)]({'_sum':{'balance':!![],'totalPaidOut':!![]}}),_0x5e7df7=await database_1[_0x2eb935(0x2a1)][_0x2eb935(0x1f0)][_0x2eb935(0x309)]({'where':{'status':_0x2eb935(0x197),'gateway':{'not':_0x2eb935(0x2f8)}}}),_0x3a34fb=new Date(),_0x219675=new Date(_0x3a34fb[_0x2eb935(0x26a)](),_0x3a34fb['getMonth'](),0x1),_0x4c4e8e=new Date(_0x3a34fb[_0x2eb935(0x26a)](),_0x3a34fb[_0x2eb935(0x1e7)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x42bbdc=await database_1[_0x2eb935(0x2a1)]['payout'][_0x2eb935(0x320)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x219675,'lte':_0x4c4e8e},'status':'COMPLETED'}}),_0x299231=_0x3a0a4f[_0x2eb935(0x23f)][_0x2eb935(0x287)]||0x0,_0x3f5917=_0x3a0a4f['_sum'][_0x2eb935(0x2f5)]||0x0,_0x2d2154=_0x42bbdc[_0x2eb935(0x23f)][_0x2eb935(0x285)]||0x0,_0x502937={'totalPayout':Math[_0x2eb935(0x327)](_0x299231*0x64)/0x64,'awaitingPayout':Math[_0x2eb935(0x327)](_0x3f5917*0x64)/0x64,'thisMonth':Math['round'](_0x2d2154*0x64)/0x64,'availableBalance':Math[_0x2eb935(0x327)](_0x3f5917*0x64)/0x64,'totalPayments':_0x5e7df7};return console['log'](_0x2eb935(0x2fa)),console[_0x2eb935(0x323)](_0x2eb935(0x315)+_0x502937[_0x2eb935(0x1b1)]+_0x2eb935(0x1e9)),console[_0x2eb935(0x323)]('\x20\x20\x20â³\x20Awaiting\x20payout:\x20'+_0x502937[_0x2eb935(0x268)]+'\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)'),console[_0x2eb935(0x323)](_0x2eb935(0x1c4)+_0x502937['availableBalance']+'\x20USDT\x20(same\x20as\x20awaiting)'),console['log'](_0x2eb935(0x1f4)+_0x502937[_0x2eb935(0x2e3)]+_0x2eb935(0x228)),console[_0x2eb935(0x323)](_0x2eb935(0x288)+_0x502937['totalPayments']+'\x20PAID\x20payments'),_0x502937;}async[a48_0x2aeaec(0x24f)](_0xeeb75b,_0x2a8739){const _0x46a69a=a48_0x2aeaec;console['log'](_0x46a69a(0x28f)+_0xeeb75b+':',_0x2a8739);const _0x278806=await database_1[_0x46a69a(0x2a1)]['payment'][_0x46a69a(0x325)]({'where':{'id':_0xeeb75b},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x278806)throw new Error('Payment\x20not\x20found');const _0x5c3ab8={};_0x2a8739[_0x46a69a(0x324)]!==undefined&&(_0x5c3ab8[_0x46a69a(0x324)]=_0x2a8739[_0x46a69a(0x324)]||null);_0x2a8739[_0x46a69a(0x218)]!==undefined&&(_0x5c3ab8[_0x46a69a(0x218)]=_0x2a8739[_0x46a69a(0x218)]||null);_0x2a8739['customerUa']!==undefined&&(_0x5c3ab8[_0x46a69a(0x196)]=_0x2a8739[_0x46a69a(0x196)]||null);const _0x58c983=await database_1['default'][_0x46a69a(0x1f0)][_0x46a69a(0x1e8)]({'where':{'id':_0xeeb75b},'data':{..._0x5c3ab8,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console['log'](_0x46a69a(0x31c)+_0xeeb75b),console[_0x46a69a(0x323)](_0x46a69a(0x1e3)+_0x278806['customerCountry']+_0x46a69a(0x298)+_0x58c983['customerCountry']),console['log'](_0x46a69a(0x26b)+_0x278806['customerIp']+_0x46a69a(0x298)+_0x58c983[_0x46a69a(0x218)]),console[_0x46a69a(0x323)]('\x20\x20\x20ðŸ–¥ï¸\x20User\x20Agent:\x20'+(_0x278806['customerUa']?_0x46a69a(0x2cb):_0x46a69a(0x1ab))+_0x46a69a(0x298)+(_0x58c983[_0x46a69a(0x196)]?_0x46a69a(0x2cb):_0x46a69a(0x1ab))),_0x58c983;}async[a48_0x2aeaec(0x322)](_0x4a8348,_0x158118){const _0x1e45f5=a48_0x2aeaec,_0x4d7a49=_0x158118?new Date(_0x158118):new Date();let _0xc9fe5f,_0x5bf673;if(_0x4a8348[_0x1e45f5(0x1b3)](_0x1e45f5(0x237))){const _0x6c499f=_0x4a8348[_0x1e45f5(0x311)](_0x1e45f5(0x237),'')[_0x1e45f5(0x22a)]('_');if(_0x6c499f['length']===0x2){const _0x1c6957=new Date(_0x6c499f[0x0]),_0x38f6e8=new Date(_0x6c499f[0x1]);_0xc9fe5f=new Date(Date[_0x1e45f5(0x204)](_0x1c6957[_0x1e45f5(0x1cf)](),_0x1c6957[_0x1e45f5(0x2a7)](),_0x1c6957[_0x1e45f5(0x32b)](),0x0,0x0,0x0,0x0)),_0x5bf673=new Date(Date['UTC'](_0x38f6e8['getUTCFullYear'](),_0x38f6e8[_0x1e45f5(0x2a7)](),_0x38f6e8[_0x1e45f5(0x32b)](),0x17,0x3b,0x3b,0x3e7));}else{const _0x45e0f1=new Date(Date[_0x1e45f5(0x204)](_0x4d7a49['getUTCFullYear'](),_0x4d7a49[_0x1e45f5(0x2a7)](),_0x4d7a49['getUTCDate']()-0x1e));_0xc9fe5f=new Date(Date[_0x1e45f5(0x204)](_0x45e0f1[_0x1e45f5(0x1cf)](),_0x45e0f1[_0x1e45f5(0x2a7)](),_0x45e0f1[_0x1e45f5(0x32b)](),0x0,0x0,0x0,0x0)),_0x5bf673=new Date(Date[_0x1e45f5(0x204)](_0x4d7a49['getUTCFullYear'](),_0x4d7a49['getUTCMonth'](),_0x4d7a49[_0x1e45f5(0x32b)](),0x17,0x3b,0x3b,0x3e7));}}else{switch(_0x4a8348[_0x1e45f5(0x260)]()){case _0x1e45f5(0x2c7):_0xc9fe5f=new Date(Date[_0x1e45f5(0x204)](_0x4d7a49[_0x1e45f5(0x1cf)](),_0x4d7a49[_0x1e45f5(0x2a7)](),_0x4d7a49['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x5bf673=new Date(Date[_0x1e45f5(0x204)](_0x4d7a49['getUTCFullYear'](),_0x4d7a49[_0x1e45f5(0x2a7)](),_0x4d7a49['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case _0x1e45f5(0x1a2):const _0x185b56=new Date(_0x4d7a49);_0x185b56[_0x1e45f5(0x31b)](_0x185b56['getUTCDate']()-0x1),_0xc9fe5f=new Date(Date['UTC'](_0x185b56[_0x1e45f5(0x1cf)](),_0x185b56[_0x1e45f5(0x2a7)](),_0x185b56['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x5bf673=new Date(Date[_0x1e45f5(0x204)](_0x185b56[_0x1e45f5(0x1cf)](),_0x185b56[_0x1e45f5(0x2a7)](),_0x185b56[_0x1e45f5(0x32b)](),0x17,0x3b,0x3b,0x3e7));break;case'this_week':const _0x1d4a7=_0x4d7a49[_0x1e45f5(0x1c7)](),_0x2d072c=_0x1d4a7===0x0?-0x6:0x1-_0x1d4a7,_0x56d4bd=_0x4d7a49[_0x1e45f5(0x32b)]()+_0x2d072c;_0xc9fe5f=new Date(Date['UTC'](_0x4d7a49['getUTCFullYear'](),_0x4d7a49[_0x1e45f5(0x2a7)](),_0x56d4bd,0x0,0x0,0x0,0x0)),_0x5bf673=new Date(Date[_0x1e45f5(0x204)](_0x4d7a49['getUTCFullYear'](),_0x4d7a49['getUTCMonth'](),_0x4d7a49[_0x1e45f5(0x32b)](),0x17,0x3b,0x3b,0x3e7));break;case _0x1e45f5(0x1a6):const _0x543f9d=new Date(Date[_0x1e45f5(0x204)](_0x4d7a49[_0x1e45f5(0x1cf)](),_0x4d7a49['getUTCMonth'](),_0x4d7a49[_0x1e45f5(0x32b)]()-0x7)),_0x5bc380=_0x543f9d[_0x1e45f5(0x1c7)](),_0x5ddfa2=_0x5bc380===0x0?-0x6:0x1-_0x5bc380,_0x52adce=_0x543f9d[_0x1e45f5(0x32b)]()+_0x5ddfa2;_0xc9fe5f=new Date(Date['UTC'](_0x543f9d['getUTCFullYear'](),_0x543f9d[_0x1e45f5(0x2a7)](),_0x52adce,0x0,0x0,0x0,0x0)),_0x5bf673=new Date(Date[_0x1e45f5(0x204)](_0x543f9d[_0x1e45f5(0x1cf)](),_0x543f9d[_0x1e45f5(0x2a7)](),_0x52adce+0x6,0x17,0x3b,0x3b,0x3e7));break;case'this_month':_0xc9fe5f=new Date(Date[_0x1e45f5(0x204)](_0x4d7a49[_0x1e45f5(0x1cf)](),_0x4d7a49[_0x1e45f5(0x2a7)](),0x1,0x0,0x0,0x0,0x0)),_0x5bf673=new Date(Date[_0x1e45f5(0x204)](_0x4d7a49[_0x1e45f5(0x1cf)](),_0x4d7a49[_0x1e45f5(0x2a7)](),_0x4d7a49['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case _0x1e45f5(0x2bf):_0xc9fe5f=new Date(Date['UTC'](_0x4d7a49[_0x1e45f5(0x1cf)](),_0x4d7a49[_0x1e45f5(0x2a7)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x5bf673=new Date(Date['UTC'](_0x4d7a49[_0x1e45f5(0x1cf)](),_0x4d7a49[_0x1e45f5(0x2a7)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case'all_time':_0xc9fe5f=new Date(Date[_0x1e45f5(0x204)](0x7e9,0x5,0xe,0x0,0x0,0x0,0x0)),_0x5bf673=new Date(Date[_0x1e45f5(0x204)](_0x4d7a49[_0x1e45f5(0x1cf)](),_0x4d7a49['getUTCMonth'](),_0x4d7a49[_0x1e45f5(0x32b)](),0x17,0x3b,0x3b,0x3e7));break;default:_0xc9fe5f=new Date(_0x4d7a49[_0x1e45f5(0x1de)]()-0x1e*0x18*0x3c*0x3c*0x3e8);const _0x311e2c=new Date(Date[_0x1e45f5(0x204)](_0x4d7a49[_0x1e45f5(0x1cf)](),_0x4d7a49[_0x1e45f5(0x2a7)](),_0x4d7a49[_0x1e45f5(0x32b)]()-0x1e));_0xc9fe5f=new Date(Date[_0x1e45f5(0x204)](_0x311e2c['getUTCFullYear'](),_0x311e2c[_0x1e45f5(0x2a7)](),_0x311e2c['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x5bf673=new Date(Date[_0x1e45f5(0x204)](_0x4d7a49[_0x1e45f5(0x1cf)](),_0x4d7a49['getUTCMonth'](),_0x4d7a49[_0x1e45f5(0x32b)](),0x17,0x3b,0x3b,0x3e7));}const _0x49183d={'gte':_0xc9fe5f,'lte':_0x5bf673};console[_0x1e45f5(0x323)](_0x1e45f5(0x2f0)+_0xc9fe5f[_0x1e45f5(0x313)]()+'\x20to\x20'+_0x5bf673['toISOString']());const [_0x44aa6d,_0xacc169,_0x332d28,_0x281e96,_0x108621,_0x359bd1,_0x8744f1,_0x9eb572,_0x581671]=await Promise['all']([database_1['default'][_0x1e45f5(0x1eb)][_0x1e45f5(0x309)](),database_1[_0x1e45f5(0x2a1)][_0x1e45f5(0x1eb)][_0x1e45f5(0x309)]({'where':{'status':_0x1e45f5(0x2c2)}}),database_1[_0x1e45f5(0x2a1)][_0x1e45f5(0x1f0)][_0x1e45f5(0x309)]({'where':{'status':_0x1e45f5(0x197),'createdAt':_0x49183d,'gateway':{'not':_0x1e45f5(0x2f8)}}}),database_1[_0x1e45f5(0x2a1)]['payment'][_0x1e45f5(0x309)]({'where':{'status':_0x1e45f5(0x19c),'createdAt':_0x49183d,'gateway':{'not':_0x1e45f5(0x2f8)}}}),database_1[_0x1e45f5(0x2a1)][_0x1e45f5(0x1f0)][_0x1e45f5(0x309)]({'where':{'status':_0x1e45f5(0x23d),'createdAt':_0x49183d,'gateway':{'not':'test_gateway'}}}),database_1['default']['payment'][_0x1e45f5(0x277)]({'where':{'status':_0x1e45f5(0x197),'createdAt':_0x49183d,'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1['default'][_0x1e45f5(0x1f0)]['findMany']({'where':{'gateway':{'not':_0x1e45f5(0x2f8)}},'take':0xa,'orderBy':{'createdAt':_0x1e45f5(0x1e1)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x1e45f5(0x2a1)][_0x1e45f5(0x1f0)]['findMany']({'where':{'createdAt':_0x49183d,'gateway':{'not':_0x1e45f5(0x2f8)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x1e45f5(0x2a1)][_0x1e45f5(0x1f0)][_0x1e45f5(0x277)]({'where':{'status':'PAID','gateway':{'not':_0x1e45f5(0x2f8)}},'select':{'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![]}})]);console[_0x1e45f5(0x323)](_0x1e45f5(0x26d)+_0x332d28);let _0x3a309e=0x0,_0x28c71b=0x0;for(const _0x321fb3 of _0x359bd1){const _0x536c97=_0x321fb3[_0x1e45f5(0x219)]||0x0;_0x3a309e+=_0x536c97;if(_0x321fb3[_0x1e45f5(0x2cc)]&&_0x321fb3[_0x1e45f5(0x219)]){const _0x1d01c1=_0x321fb3[_0x1e45f5(0x219)]-_0x321fb3['amountAfterGatewayCommissionUSDT'];_0x28c71b+=_0x1d01c1;}}let _0x414a07=0x0;for(const _0x273705 of _0x581671){if(_0x273705[_0x1e45f5(0x2cc)]&&_0x273705['amountUSDT']){const _0x340d3b=_0x273705[_0x1e45f5(0x219)]-_0x273705['amountAfterGatewayCommissionUSDT'];_0x414a07+=_0x340d3b;}}const _0x324467=_0x332d28>0x0?_0x3a309e/_0x332d28:0x0,_0x4cd0a8=this[_0x1e45f5(0x191)](_0x9eb572,_0xc9fe5f,_0x5bf673),_0x1c4815=await database_1[_0x1e45f5(0x2a1)][_0x1e45f5(0x1f0)][_0x1e45f5(0x309)]({'where':{'createdAt':_0x49183d,'gateway':{'not':_0x1e45f5(0x2f8)},'status':{'notIn':['PENDING',_0x1e45f5(0x238)]}}}),_0x4f1fb2=_0x1c4815>0x0?_0x332d28/_0x1c4815*0x64:0x0;return{'totalShops':_0x44aa6d,'activeShops':_0xacc169,'totalPayments':_0x1c4815,'successfulPayments':_0x332d28,'totalAttempts':_0x1c4815,'chargebacks':_0x281e96,'refunds':_0x108621,'totalRevenue':Math[_0x1e45f5(0x327)](_0x3a309e*0x64)/0x64,'trapayEarnings':Math[_0x1e45f5(0x327)](_0x28c71b*0x64)/0x64,'trapayEarningsAllTime':Math[_0x1e45f5(0x327)](_0x414a07*0x64)/0x64,'averagePaymentAmount':Math[_0x1e45f5(0x327)](_0x324467*0x64)/0x64,'conversionRate':Math[_0x1e45f5(0x327)](_0x4f1fb2*0x64)/0x64,'dailyRevenue':_0x4cd0a8['dailyRevenue'],'dailyPayments':_0x4cd0a8[_0x1e45f5(0x1fb)],'recentPayments':_0x8744f1[_0x1e45f5(0x302)](_0x35082d=>({'id':_0x35082d['id'],'amount':_0x35082d['amount'],'currency':_0x35082d[_0x1e45f5(0x2df)],'status':_0x35082d[_0x1e45f5(0x279)],'gateway':_0x35082d[_0x1e45f5(0x1b2)],'shop':_0x35082d[_0x1e45f5(0x1eb)],'createdAt':_0x35082d[_0x1e45f5(0x2a2)]}))};}}async[a48_0x2aeaec(0x1bc)](_0x27a059){const _0x46bddc=a48_0x2aeaec;console[_0x46bddc(0x323)]('ðŸ“Š\x20Getting\x20merchant\x20statistics\x20with\x20filters:',_0x27a059);let _0x529733,_0x4bb33d=new Date();if(_0x27a059['period']===_0x46bddc(0x249)&&_0x27a059['dateFrom']&&_0x27a059[_0x46bddc(0x21c)]){const _0x44be0a=new Date(_0x27a059[_0x46bddc(0x2e8)]),_0x41720f=new Date(_0x27a059['dateTo']);_0x529733=new Date(Date[_0x46bddc(0x204)](_0x44be0a['getUTCFullYear'](),_0x44be0a[_0x46bddc(0x2a7)](),_0x44be0a[_0x46bddc(0x32b)](),0x0,0x0,0x0,0x0)),_0x4bb33d=new Date(Date[_0x46bddc(0x204)](_0x41720f['getUTCFullYear'](),_0x41720f['getUTCMonth'](),_0x41720f[_0x46bddc(0x32b)](),0x17,0x3b,0x3b,0x3e7));}else{const _0x44acdf=new Date();switch(_0x27a059['period']){case _0x46bddc(0x215):_0x529733=new Date(_0x44acdf[_0x46bddc(0x1de)]()-0x7*0x18*0x3c*0x3c*0x3e8),_0x529733[_0x46bddc(0x247)](0x0,0x0,0x0,0x0),_0x4bb33d[_0x46bddc(0x247)](0x17,0x3b,0x3b,0x3e7);break;case _0x46bddc(0x206):_0x529733=new Date(Date['UTC'](_0x44acdf[_0x46bddc(0x1cf)](),_0x44acdf[_0x46bddc(0x2a7)](),0x1,0x0,0x0,0x0,0x0)),_0x4bb33d=new Date(Date[_0x46bddc(0x204)](_0x44acdf['getUTCFullYear'](),_0x44acdf[_0x46bddc(0x2a7)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x46bddc(0x2aa):_0x529733=new Date(Date[_0x46bddc(0x204)](_0x44acdf['getUTCFullYear'](),_0x44acdf[_0x46bddc(0x2a7)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x4bb33d=new Date(Date[_0x46bddc(0x204)](_0x44acdf[_0x46bddc(0x1cf)](),_0x44acdf[_0x46bddc(0x2a7)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x46bddc(0x2b3):_0x529733=new Date(_0x44acdf[_0x46bddc(0x1de)]()-0x16d*0x18*0x3c*0x3c*0x3e8),_0x529733[_0x46bddc(0x247)](0x0,0x0,0x0,0x0),_0x4bb33d[_0x46bddc(0x247)](0x17,0x3b,0x3b,0x3e7);break;case _0x46bddc(0x19f):default:_0x529733=new Date(_0x46bddc(0x1da)),_0x529733[_0x46bddc(0x247)](0x0,0x0,0x0,0x0),_0x4bb33d[_0x46bddc(0x247)](0x17,0x3b,0x3b,0x3e7);break;}}console[_0x46bddc(0x323)]('ðŸ“…\x20Period:\x20'+_0x529733[_0x46bddc(0x313)]()+'\x20to\x20'+_0x4bb33d[_0x46bddc(0x313)]());const _0x32cc8b={'status':_0x46bddc(0x197),'gateway':{'not':'test_gateway'},'createdAt':{'gte':_0x529733,'lte':_0x4bb33d}};_0x27a059[_0x46bddc(0x329)]&&(_0x32cc8b[_0x46bddc(0x329)]=_0x27a059[_0x46bddc(0x329)]);const _0x468206=await database_1['default'][_0x46bddc(0x1f0)][_0x46bddc(0x277)]({'where':_0x32cc8b,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x46bddc(0x323)]('ðŸ’°\x20Found\x20'+_0x468206['length']+'\x20paid\x20payments\x20for\x20analysis');const _0x47df7d={'gateway':{'not':_0x46bddc(0x2f8)},'status':{'notIn':[_0x46bddc(0x1d1),_0x46bddc(0x238)]},'createdAt':{'gte':_0x529733,'lte':_0x4bb33d}};_0x27a059[_0x46bddc(0x329)]&&(_0x47df7d[_0x46bddc(0x329)]=_0x27a059[_0x46bddc(0x329)]);const _0x53cd56=await database_1['default'][_0x46bddc(0x1f0)][_0x46bddc(0x309)]({'where':_0x47df7d}),_0x31e18c={..._0x47df7d,'status':'CHARGEBACK'},_0x52620a={..._0x47df7d,'status':_0x46bddc(0x23d)},[_0x1e7db3,_0x4b8fb0]=await Promise[_0x46bddc(0x19f)]([database_1[_0x46bddc(0x2a1)]['payment'][_0x46bddc(0x309)]({'where':_0x31e18c}),database_1[_0x46bddc(0x2a1)][_0x46bddc(0x1f0)][_0x46bddc(0x309)]({'where':_0x52620a})]);console['log'](_0x46bddc(0x2c3)+_0x53cd56+_0x46bddc(0x1a8)+_0x468206[_0x46bddc(0x27a)]+',\x20chargebacks:\x20'+_0x1e7db3+',\x20refunds:\x20'+_0x4b8fb0);let _0x119af6=0x0,_0x4498e3=0x0,_0xff3516=0x0;const _0x31d4e6={},_0x44328a={},_0x40d88b={},_0x1c8ef0=new Date(_0x529733);while(_0x1c8ef0<=_0x4bb33d){const _0x13c370=_0x1c8ef0[_0x46bddc(0x313)]()[_0x46bddc(0x22a)]('T')[0x0];_0x40d88b[_0x13c370]={'date':_0x13c370,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0},_0x1c8ef0['setUTCDate'](_0x1c8ef0[_0x46bddc(0x32b)]()+0x1);}for(const _0x12cada of _0x468206){try{const _0x202367=_0x12cada['amountUSDT']||0x0;if(_0x202367<=0x0){console['warn'](_0x46bddc(0x1b0)+_0x12cada['id']+'\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...');continue;}let _0x555b84,_0xb884d5;if(_0x12cada[_0x46bddc(0x2cc)]!==null&&_0x12cada['amountAfterGatewayCommissionUSDT']!==undefined)_0x555b84=_0x12cada['amountAfterGatewayCommissionUSDT'],_0xb884d5=_0x202367-_0x555b84,console[_0x46bddc(0x323)](_0x46bddc(0x318)+_0x12cada['id']+':\x20'+_0x202367[_0x46bddc(0x2d0)](0x6)+_0x46bddc(0x2dc)+_0x555b84['toFixed'](0x6)+_0x46bddc(0x228));else{let _0x56de56={};if(_0x12cada[_0x46bddc(0x1eb)][_0x46bddc(0x1d7)])try{_0x56de56=JSON[_0x46bddc(0x22c)](_0x12cada[_0x46bddc(0x1eb)][_0x46bddc(0x1d7)]);}catch(_0x43de01){console[_0x46bddc(0x28c)](_0x46bddc(0x265)+_0x12cada[_0x46bddc(0x329)]+':',_0x43de01);}let _0x170255=0x2d;for(const [_0x560389,_0x10e04d]of Object['entries'](_0x56de56)){if(_0x560389[_0x46bddc(0x260)]()===_0x12cada[_0x46bddc(0x1b2)]['toLowerCase']()){_0x170255=_0x10e04d[_0x46bddc(0x28b)]||0x2d;break;}}_0xb884d5=_0x202367*(_0x170255/0x64),_0x555b84=_0x202367-_0xb884d5,console[_0x46bddc(0x323)](_0x46bddc(0x1c9)+_0x12cada['id']+':\x20'+_0x170255+_0x46bddc(0x2ec)+_0x202367[_0x46bddc(0x2d0)](0x6)+_0x46bddc(0x228));}_0x119af6+=_0x202367,_0x4498e3+=_0x555b84,_0xff3516+=_0xb884d5;let _0x2ca96f;_0x12cada[_0x46bddc(0x235)]!==null&&_0x12cada[_0x46bddc(0x235)]!==undefined?(_0x2ca96f=_0x12cada[_0x46bddc(0x235)],console[_0x46bddc(0x323)]('ðŸ“Š\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20'+_0x12cada['id']+':\x20'+_0x2ca96f+'%')):(_0x2ca96f=_0x202367>0x0?_0xb884d5/_0x202367*0x64:0x0,console[_0x46bddc(0x323)]('ðŸ“Š\x20Calculated\x20commission\x20rate\x20for\x20payment\x20'+_0x12cada['id']+':\x20'+_0x2ca96f[_0x46bddc(0x2d0)](0x2)+'%'));!_0x31d4e6[_0x12cada['gateway']]&&(_0x31d4e6[_0x12cada[_0x46bddc(0x1b2)]]={'gateway':_0x12cada[_0x46bddc(0x1b2)],'gatewayDisplayName':this['getGatewayDisplayName'](_0x12cada[_0x46bddc(0x1b2)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x31d4e6[_0x12cada[_0x46bddc(0x1b2)]][_0x46bddc(0x303)]++,_0x31d4e6[_0x12cada[_0x46bddc(0x1b2)]][_0x46bddc(0x1fa)]+=_0x202367,_0x31d4e6[_0x12cada['gateway']][_0x46bddc(0x1c2)]+=_0xb884d5,_0x31d4e6[_0x12cada[_0x46bddc(0x1b2)]]['merchantEarningsUSDT']+=_0x555b84,_0x31d4e6[_0x12cada[_0x46bddc(0x1b2)]][_0x46bddc(0x2ff)]+=_0x2ca96f;!_0x27a059[_0x46bddc(0x329)]&&(!_0x44328a[_0x12cada[_0x46bddc(0x329)]]&&(_0x44328a[_0x12cada[_0x46bddc(0x329)]]={'shopId':_0x12cada[_0x46bddc(0x329)],'shopName':_0x12cada[_0x46bddc(0x1eb)][_0x46bddc(0x1d6)],'shopUsername':_0x12cada['shop'][_0x46bddc(0x1db)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x44328a[_0x12cada[_0x46bddc(0x329)]]['paymentsCount']++,_0x44328a[_0x12cada[_0x46bddc(0x329)]][_0x46bddc(0x1fa)]+=_0x202367,_0x44328a[_0x12cada[_0x46bddc(0x329)]][_0x46bddc(0x1c2)]+=_0xb884d5,_0x44328a[_0x12cada[_0x46bddc(0x329)]][_0x46bddc(0x29b)]+=_0x555b84);const _0x4df275=_0x12cada[_0x46bddc(0x208)][_0x46bddc(0x313)]()[_0x46bddc(0x22a)]('T')[0x0];_0x40d88b[_0x4df275]&&(_0x40d88b[_0x4df275][_0x46bddc(0x2f1)]+=_0x202367,_0x40d88b[_0x4df275][_0x46bddc(0x207)]+=_0x555b84,_0x40d88b[_0x4df275][_0x46bddc(0x2ee)]+=_0xb884d5,_0x40d88b[_0x4df275][_0x46bddc(0x303)]++);}catch(_0x5b32b6){console[_0x46bddc(0x28c)](_0x46bddc(0x192)+_0x12cada['id']+':',_0x5b32b6);}}Object[_0x46bddc(0x212)](_0x31d4e6)[_0x46bddc(0x2b2)](_0x46a66e=>{const _0x38d9ff=_0x46bddc;_0x46a66e['averageCommissionRate']=_0x46a66e[_0x38d9ff(0x303)]>0x0?_0x46a66e['totalCommissionRate']/_0x46a66e['paymentsCount']:0x0,delete _0x46a66e[_0x38d9ff(0x2ff)];}),Object['values'](_0x44328a)[_0x46bddc(0x2b2)](_0x1b6e53=>{const _0x573e22=_0x46bddc;_0x1b6e53[_0x573e22(0x210)]=_0x1b6e53[_0x573e22(0x303)]>0x0?_0x1b6e53[_0x573e22(0x1fa)]/_0x1b6e53['paymentsCount']:0x0;});let _0x11cc6e=0x0,_0x5b95af=0x0;if(_0x27a059[_0x46bddc(0x329)]){const _0xc086c3=await database_1['default']['payout']['findMany']({'where':{'shopId':_0x27a059['shopId'],'status':_0x46bddc(0x2cf),'createdAt':{'gte':_0x529733,'lte':_0x4bb33d}},'select':{'amount':!![]}});_0x11cc6e=_0xc086c3[_0x46bddc(0x290)]((_0x395818,_0x3662f9)=>_0x395818+_0x3662f9[_0x46bddc(0x285)],0x0);const _0x2c7b96=await database_1[_0x46bddc(0x2a1)][_0x46bddc(0x2ad)]['findMany']({'where':{'shopId':_0x27a059['shopId'],'status':_0x46bddc(0x1d1),'createdAt':{'gte':_0x529733,'lte':_0x4bb33d}},'select':{'amount':!![]}});_0x5b95af=_0x2c7b96[_0x46bddc(0x290)]((_0x4b4e6e,_0xe5e4a3)=>_0x4b4e6e+_0xe5e4a3['amount'],0x0);}const _0x3fdb64=_0x53cd56,_0x899373=_0x468206['length'],_0x3af259=_0x899373>0x0?_0x119af6/_0x899373:0x0,_0x3d0fdd=_0x3fdb64>0x0?Math[_0x46bddc(0x327)](_0x899373/_0x3fdb64*0x2710)/0x64:0x0,_0x3f96fb=Math[_0x46bddc(0x245)]((_0x4bb33d[_0x46bddc(0x1de)]()-_0x529733[_0x46bddc(0x1de)]())/(0x3e8*0x3c*0x3c*0x18)),_0x44fb60={'totalTurnover':Math[_0x46bddc(0x327)](_0x119af6*0x64)/0x64,'merchantEarnings':Math[_0x46bddc(0x327)](_0x4498e3*0x64)/0x64,'gatewayEarnings':Math[_0x46bddc(0x327)](_0xff3516*0x64)/0x64,'totalPaidOut':Math[_0x46bddc(0x327)](_0x11cc6e*0x64)/0x64,'pendingPayout':Math[_0x46bddc(0x327)](_0x5b95af*0x64)/0x64,'averageCheck':Math[_0x46bddc(0x327)](_0x3af259*0x64)/0x64,'totalPayments':_0x3fdb64,'successfulPayments':_0x899373,'conversionRate':_0x3d0fdd,'chargebacks':_0x1e7db3,'refunds':_0x4b8fb0,'gatewayBreakdown':Object[_0x46bddc(0x212)](_0x31d4e6)[_0x46bddc(0x302)](_0x1bae99=>({..._0x1bae99,'turnoverUSDT':Math[_0x46bddc(0x327)](_0x1bae99['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x46bddc(0x327)](_0x1bae99['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x1bae99[_0x46bddc(0x29b)]*0x64)/0x64,'averageCommissionRate':Math[_0x46bddc(0x327)](_0x1bae99[_0x46bddc(0x253)]*0x64)/0x64})),'merchantBreakdown':_0x27a059[_0x46bddc(0x329)]?undefined:Object['values'](_0x44328a)[_0x46bddc(0x302)](_0x52d4b1=>({..._0x52d4b1,'turnoverUSDT':Math[_0x46bddc(0x327)](_0x52d4b1[_0x46bddc(0x1fa)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x52d4b1[_0x46bddc(0x1c2)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x46bddc(0x327)](_0x52d4b1[_0x46bddc(0x29b)]*0x64)/0x64,'paidOutUSDT':Math['round'](_0x52d4b1['paidOutUSDT']*0x64)/0x64,'averageCheckUSDT':Math[_0x46bddc(0x327)](_0x52d4b1[_0x46bddc(0x210)]*0x64)/0x64})),'dailyData':Object[_0x46bddc(0x212)](_0x40d88b)['map'](_0x16a488=>({..._0x16a488,'turnover':Math[_0x46bddc(0x327)](_0x16a488[_0x46bddc(0x2f1)]*0x64)/0x64,'merchantEarnings':Math['round'](_0x16a488[_0x46bddc(0x207)]*0x64)/0x64,'gatewayEarnings':Math[_0x46bddc(0x327)](_0x16a488[_0x46bddc(0x2ee)]*0x64)/0x64}))['sort']((_0x6a5671,_0x87e6b1)=>_0x6a5671[_0x46bddc(0x217)]['localeCompare'](_0x87e6b1[_0x46bddc(0x217)])),'periodInfo':{'from':_0x529733,'to':_0x4bb33d,'periodType':_0x27a059[_0x46bddc(0x24b)]||_0x46bddc(0x249),'daysCount':_0x3f96fb}};return console[_0x46bddc(0x323)]('ðŸ“Š\x20Merchant\x20statistics\x20calculated:'),console[_0x46bddc(0x323)](_0x46bddc(0x273)+_0x44fb60[_0x46bddc(0x2cd)]+'\x20USDT'),console[_0x46bddc(0x323)](_0x46bddc(0x29a)+_0x44fb60[_0x46bddc(0x207)]+_0x46bddc(0x228)),console[_0x46bddc(0x323)](_0x46bddc(0x1c5)+_0x44fb60[_0x46bddc(0x2ee)]+_0x46bddc(0x228)),console['log'](_0x46bddc(0x301)+_0x44fb60['totalPaidOut']+_0x46bddc(0x228)),console[_0x46bddc(0x323)]('\x20\x20\x20â³\x20Pending\x20payout:\x20'+_0x44fb60[_0x46bddc(0x209)]+_0x46bddc(0x228)),console[_0x46bddc(0x323)](_0x46bddc(0x25a)+_0x44fb60[_0x46bddc(0x2e1)]),_0x44fb60;}async[a48_0x2aeaec(0x2fb)](_0x37502f){const _0x3ee327=a48_0x2aeaec;console[_0x3ee327(0x323)]('ðŸ“‹\x20Getting\x20merchants\x20selection\x20list...',{'hasPayoutHistory':_0x37502f});let _0x491f02={};_0x37502f&&(_0x491f02[_0x3ee327(0x2db)]={'some':{}});const _0x39ec9e=await database_1[_0x3ee327(0x2a1)][_0x3ee327(0x1eb)][_0x3ee327(0x277)]({'where':_0x491f02,'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':'asc'}});return console['log'](_0x3ee327(0x1e4)+_0x39ec9e[_0x3ee327(0x27a)]+'\x20merchants\x20for\x20selection'+(_0x37502f?_0x3ee327(0x20a):'')),_0x39ec9e['map'](_0x4a99ca=>({'id':_0x4a99ca['id'],'username':_0x4a99ca['username'],'name':_0x4a99ca[_0x3ee327(0x1d6)]}));}[a48_0x2aeaec(0x2c8)](_0x3a8eca){const _0x5e96a9=a48_0x2aeaec,_0x36b4d4={'test_gateway':'Test\x20Gateway','plisio':'Plisio','rapyd':_0x5e96a9(0x23b),'noda':_0x5e96a9(0x22d),'cointopay':'CoinToPay','cointopay2':'CoinToPay2','klyme_eu':_0x5e96a9(0x236),'klyme_gb':'KLYME\x20GB','klyme_de':_0x5e96a9(0x19b),'mastercard':'MasterCard','visa/mastercard':_0x5e96a9(0x1f2),'amer':'Amer','myxspend':_0x5e96a9(0x2d7),'ampay':'AmPay','ampay_try':_0x5e96a9(0x2fc),'sepa':_0x5e96a9(0x254),'interac':_0x5e96a9(0x1f3),'onramp':_0x5e96a9(0x280),'squirrelpay':_0x5e96a9(0x1be),'maxpara':_0x5e96a9(0x274),'instaxchange':'InstaXchange','oxapay':_0x5e96a9(0x1d0)};return _0x36b4d4[_0x3a8eca]||_0x3a8eca;}['getGatewayInternalName'](_0x210b23){const _0x16862d=a48_0x2aeaec,_0x522822={'Test\x20Gateway':_0x16862d(0x2f8),'Plisio':_0x16862d(0x23e),'Rapyd':_0x16862d(0x275),'Noda':_0x16862d(0x205),'CoinToPay':_0x16862d(0x27b),'CoinToPay2':_0x16862d(0x1b8),'KLYME\x20EU':_0x16862d(0x2d5),'KLYME\x20GB':'klyme_gb','KLYME\x20DE':_0x16862d(0x2da),'MasterCard':_0x16862d(0x1b6)};return _0x522822[_0x210b23]||_0x210b23['toLowerCase']();}async[a48_0x2aeaec(0x2c6)](_0x40de05){const _0x563555=a48_0x2aeaec,{page:_0x4e4ab9,limit:_0x185d07,minAmount:_0x21792e,search:_0x23dc0d}=_0x40de05;console[_0x563555(0x323)](_0x563555(0x1b9),_0x40de05);let _0x4db9fe={};_0x23dc0d&&(_0x4db9fe[_0x563555(0x1d6)]={'contains':_0x23dc0d,'mode':_0x563555(0x29d)});const _0x237ccf=await database_1[_0x563555(0x2a1)]['shop'][_0x563555(0x277)]({'where':_0x4db9fe,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),_0x5b98ed=_0x237ccf[_0x563555(0x2e2)](_0x614f57=>{const _0x1b1bdc=_0x563555,_0x5f4de8=Math['floor'](_0x614f57[_0x1b1bdc(0x2f5)]*0x64)/0x64;if(_0x21792e&&_0x5f4de8<_0x21792e)return![];return _0x5f4de8!==0x0;});_0x5b98ed['sort']((_0x219554,_0x478322)=>_0x478322[_0x563555(0x2f5)]-_0x219554['balance']);const _0xbc0d19=_0x5b98ed[_0x563555(0x27a)],_0x2a278a=(_0x4e4ab9-0x1)*_0x185d07,_0x50afde=_0x5b98ed['slice'](_0x2a278a,_0x2a278a+_0x185d07);console[_0x563555(0x323)](_0x563555(0x231)+_0x50afde[_0x563555(0x27a)]+_0x563555(0x307));const _0x28048d=await Promise[_0x563555(0x19f)](_0x50afde['map'](async _0x5de1c7=>{const _0x1e2b99=_0x563555,[_0x4f314d,_0x421546,_0x1b2bdd]=await Promise[_0x1e2b99(0x19f)]([database_1['default'][_0x1e2b99(0x1f0)][_0x1e2b99(0x309)]({'where':{'shopId':_0x5de1c7['id'],'status':_0x1e2b99(0x197),'gateway':{'not':_0x1e2b99(0x2f8)}}}),database_1[_0x1e2b99(0x2a1)][_0x1e2b99(0x1f0)][_0x1e2b99(0x223)]({'where':{'shopId':_0x5de1c7['id'],'status':_0x1e2b99(0x197),'gateway':{'not':'test_gateway'}},'orderBy':{'paidAt':'asc'},'select':{'paidAt':!![]}}),database_1['default']['payment']['groupBy']({'by':['gateway'],'where':{'shopId':_0x5de1c7['id'],'status':'PAID','gateway':{'not':_0x1e2b99(0x2f8)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0xdf0844=new Date(),_0x1fbbb6=new Date(_0xdf0844[_0x1e2b99(0x26a)](),_0xdf0844[_0x1e2b99(0x1e7)](),0x1),_0x4bb9d7=new Date(_0xdf0844[_0x1e2b99(0x26a)](),_0xdf0844[_0x1e2b99(0x1e7)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x29fc2b,_0x1341ab]=await Promise['all']([database_1['default'][_0x1e2b99(0x2ad)][_0x1e2b99(0x320)]({'_sum':{'amount':!![]},'where':{'shopId':_0x5de1c7['id'],'status':_0x1e2b99(0x2cf)}}),database_1[_0x1e2b99(0x2a1)]['payout'][_0x1e2b99(0x320)]({'_sum':{'amount':!![]},'where':{'shopId':_0x5de1c7['id'],'status':_0x1e2b99(0x2cf),'createdAt':{'gte':_0x1fbbb6,'lte':_0x4bb9d7}}})]),_0x9faeb0=_0x29fc2b[_0x1e2b99(0x23f)][_0x1e2b99(0x285)]||0x0,_0x3e3c00=_0x1341ab['_sum']['amount']||0x0,_0x5b151a=await Promise[_0x1e2b99(0x19f)](_0x1b2bdd[_0x1e2b99(0x302)](async _0x4dae45=>{const _0x3c0a53=_0x1e2b99;let _0x2a43c9=0x2d;if(_0x5de1c7[_0x3c0a53(0x1d7)])try{const _0x8afc1c=JSON['parse'](_0x5de1c7[_0x3c0a53(0x1d7)]);for(const [_0xda8289,_0x5c4369]of Object[_0x3c0a53(0x1dd)](_0x8afc1c)){if(_0xda8289['toLowerCase']()===_0x4dae45[_0x3c0a53(0x1b2)][_0x3c0a53(0x260)]()){_0x2a43c9=_0x5c4369[_0x3c0a53(0x28b)]||0xa,console[_0x3c0a53(0x323)]('ðŸ’°\x20[PAYOUT]\x20Gateway\x20'+_0x4dae45[_0x3c0a53(0x1b2)]+_0x3c0a53(0x295)+_0x5de1c7['id']+_0x3c0a53(0x2ca)+_0x2a43c9+'%');break;}}}catch(_0x34431a){console[_0x3c0a53(0x28c)]('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x5de1c7['id']+':',_0x34431a);}const _0x42c18b=_0x4dae45['_sum']?.[_0x3c0a53(0x219)]||0x0,_0x5195b0=_0x42c18b*(0x1-_0x2a43c9/0x64);return{'gateway':_0x4dae45[_0x3c0a53(0x1b2)],'count':_0x4dae45[_0x3c0a53(0x216)]?.['id']||0x0,'amountUSDT':Math[_0x3c0a53(0x327)](_0x42c18b*0x64)/0x64,'amountAfterCommissionUSDT':Math['round'](_0x5195b0*0x64)/0x64,'commission':_0x2a43c9};})),_0x5a5c93=_0x5b151a[_0x1e2b99(0x290)]((_0x28d85f,_0x18d1c2)=>_0x28d85f+_0x18d1c2[_0x1e2b99(0x219)],0x0),_0xae8d47=_0x5b151a[_0x1e2b99(0x290)]((_0x54dbcb,_0x2f68e6)=>_0x54dbcb+_0x2f68e6[_0x1e2b99(0x2e6)],0x0),_0x1fa5cc=_0x5de1c7['balance'];return console[_0x1e2b99(0x323)](_0x1e2b99(0x31a)+_0x5de1c7[_0x1e2b99(0x1db)]+':'),console[_0x1e2b99(0x323)](_0x1e2b99(0x1f5)+_0x5a5c93['toFixed'](0x2)+_0x1e2b99(0x31f)),console[_0x1e2b99(0x323)](_0x1e2b99(0x28e)+_0xae8d47[_0x1e2b99(0x2d0)](0x2)+_0x1e2b99(0x26f)),console[_0x1e2b99(0x323)](_0x1e2b99(0x24e)+_0x1fa5cc[_0x1e2b99(0x2d0)](0x2)+_0x1e2b99(0x1c8)),console[_0x1e2b99(0x323)](_0x1e2b99(0x1a5)+_0x9faeb0[_0x1e2b99(0x2d0)](0x2)+_0x1e2b99(0x1bd)),console[_0x1e2b99(0x323)](_0x1e2b99(0x213)+(_0xae8d47-_0x9faeb0-_0x1fa5cc)[_0x1e2b99(0x2d0)](0x2)+_0x1e2b99(0x20b)),{'id':_0x5de1c7['id'],'fullName':_0x5de1c7[_0x1e2b99(0x1d6)],'username':_0x5de1c7[_0x1e2b99(0x1db)],'telegramId':_0x5de1c7[_0x1e2b99(0x2f9)],'merchantUrl':_0x5de1c7[_0x1e2b99(0x2e0)],'wallets':{'usdtPolygonWallet':_0x5de1c7['usdtPolygonWallet'],'usdtTrcWallet':_0x5de1c7[_0x1e2b99(0x26c)],'usdtErcWallet':_0x5de1c7['usdtErcWallet'],'usdcPolygonWallet':_0x5de1c7[_0x1e2b99(0x25d)],'usdcErcWallet':_0x5de1c7[_0x1e2b99(0x243)]},'totalAmountUSDT':Math[_0x1e2b99(0x327)](_0x5a5c93*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x1e2b99(0x327)](_0xae8d47*0x64)/0x64,'currentBalance':Math[_0x1e2b99(0x2c5)](_0x1fa5cc*0x64)/0x64,'totalPayout':Math['round'](_0x9faeb0*0x64)/0x64,'thisMonth':Math[_0x1e2b99(0x327)](_0x3e3c00*0x64)/0x64,'paymentsCount':_0x4f314d,'oldestPaymentDate':_0x421546?.[_0x1e2b99(0x208)]||_0x5de1c7[_0x1e2b99(0x2a2)],'gatewayBreakdown':_0x5b151a};})),_0x3ea837=_0x28048d[_0x563555(0x290)]((_0x1fc935,_0x27875d)=>_0x1fc935+_0x27875d[_0x563555(0x19e)],0x0),_0x58ab43=_0x28048d[_0x563555(0x290)]((_0x1a5e5e,_0x116d00)=>_0x1a5e5e+_0x116d00[_0x563555(0x201)],0x0),_0x53efd9=_0x28048d[_0x563555(0x290)]((_0x3618be,_0x54a8ac)=>_0x3618be+_0x54a8ac[_0x563555(0x1b1)],0x0),_0x5f0fd4=_0x28048d['reduce']((_0x1e95b4,_0x2fc123)=>_0x1e95b4+_0x2fc123['thisMonth'],0x0);return console['log'](_0x563555(0x1d3)+_0xbc0d19+'\x20merchants'),console[_0x563555(0x323)](_0x563555(0x310)+Math[_0x563555(0x327)](_0x3ea837*0x64)/0x64+_0x563555(0x31f)),console['log'](_0x563555(0x22e)+Math['round'](_0x58ab43*0x64)/0x64+'\x20USDT\x20(rounded\x20to\x202\x20decimal\x20places)'),console[_0x563555(0x323)](_0x563555(0x1a1)+Math['round'](_0x53efd9*0x64)/0x64+_0x563555(0x228)),console[_0x563555(0x323)](_0x563555(0x21d)+Math[_0x563555(0x327)](_0x5f0fd4*0x64)/0x64+_0x563555(0x228)),{'merchants':_0x28048d,'pagination':{'page':_0x4e4ab9,'limit':_0x185d07,'total':_0xbc0d19,'totalPages':Math['ceil'](_0xbc0d19/_0x185d07)},'summary':{'totalMerchants':_0xbc0d19,'totalAmountUSDT':Math[_0x563555(0x327)](_0x3ea837*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x563555(0x327)](_0x58ab43*0x64)/0x64,'totalPayout':Math[_0x563555(0x327)](_0x53efd9*0x64)/0x64,'thisMonth':Math[_0x563555(0x327)](_0x5f0fd4*0x64)/0x64}};}async[a48_0x2aeaec(0x27c)](_0xd4eb87){const _0x31a1e6=a48_0x2aeaec,{shopId:_0x28496a,amount:_0x455488,network:_0x4f5e70,wallet:_0x35f6d9,notes:_0x5d5514,txid:_0x3364be,periodFrom:_0x417fb0,periodTo:_0x2ca8b5}=_0xd4eb87,_0x1bcdbf=await database_1['default']['$transaction'](async _0x3be39d=>{const _0x20ac79=a48_0x23c6,_0x2769e0=await _0x3be39d[_0x20ac79(0x1eb)]['findUnique']({'where':{'id':_0x28496a},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x2769e0)throw new Error(_0x20ac79(0x1ee));console[_0x20ac79(0x323)](_0x20ac79(0x304)+_0x2769e0[_0x20ac79(0x1db)]+':'),console['log'](_0x20ac79(0x240)+_0x2769e0[_0x20ac79(0x2f5)][_0x20ac79(0x2d0)](0x6)+_0x20ac79(0x228)),console[_0x20ac79(0x323)](_0x20ac79(0x1d8)+_0x455488[_0x20ac79(0x2d0)](0x6)+_0x20ac79(0x228)),console[_0x20ac79(0x323)](_0x20ac79(0x2ae)+_0x2769e0[_0x20ac79(0x287)][_0x20ac79(0x2d0)](0x6)+'\x20USDT');if(_0x3364be)console[_0x20ac79(0x323)](_0x20ac79(0x25b)+_0x3364be);const _0x1c428e=0.000001,_0x15c33e=Number(_0x2769e0[_0x20ac79(0x2f5)]),_0x263abd=Number(_0x455488);console[_0x20ac79(0x323)](_0x20ac79(0x193)),console[_0x20ac79(0x323)](_0x20ac79(0x1e5)+_0x2769e0[_0x20ac79(0x2f5)]),console[_0x20ac79(0x323)](_0x20ac79(0x305)+_0x15c33e),console[_0x20ac79(0x323)](_0x20ac79(0x2b8)+_0x263abd),console[_0x20ac79(0x323)](_0x20ac79(0x225)+(_0x15c33e-_0x263abd)),console[_0x20ac79(0x323)](_0x20ac79(0x258)+_0x1c428e);if(_0x15c33e<_0x263abd-_0x1c428e)throw new Error(_0x20ac79(0x1c1)+_0x15c33e[_0x20ac79(0x2d0)](0x6)+_0x20ac79(0x194)+_0x263abd[_0x20ac79(0x2d0)](0x6)+_0x20ac79(0x30d)+(_0x15c33e-_0x263abd)[_0x20ac79(0x2d0)](0x8)+_0x20ac79(0x228));console[_0x20ac79(0x323)](_0x20ac79(0x1c3));const _0x47767a=Math[_0x20ac79(0x326)](_0x15c33e,_0x263abd);let _0x32451c=_0x35f6d9;console[_0x20ac79(0x323)](_0x20ac79(0x286)+(_0x35f6d9||'not\x20provided'));if(!_0x32451c){console[_0x20ac79(0x323)](_0x20ac79(0x306));const _0x2ce047=await _0x3be39d[_0x20ac79(0x1eb)][_0x20ac79(0x325)]({'where':{'id':_0x28496a},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});console[_0x20ac79(0x323)](_0x20ac79(0x289),_0x2ce047);if(_0x2ce047)switch(_0x4f5e70){case _0x20ac79(0x271):_0x32451c=_0x2ce047[_0x20ac79(0x257)]||undefined,console[_0x20ac79(0x323)](_0x20ac79(0x1f8)+_0x32451c);break;case'trc20':_0x32451c=_0x2ce047[_0x20ac79(0x26c)]||undefined,console[_0x20ac79(0x323)](_0x20ac79(0x2a3)+_0x32451c);break;case _0x20ac79(0x227):_0x32451c=_0x2ce047[_0x20ac79(0x1b5)]||undefined,console[_0x20ac79(0x323)](_0x20ac79(0x1df)+_0x32451c);break;case _0x20ac79(0x241):_0x32451c=_0x2ce047[_0x20ac79(0x25d)]||undefined,console[_0x20ac79(0x323)](_0x20ac79(0x1d4)+_0x32451c);break;case _0x20ac79(0x230):_0x32451c=_0x2ce047['usdcErcWallet']||undefined,console[_0x20ac79(0x323)](_0x20ac79(0x266)+_0x32451c);break;}}else console[_0x20ac79(0x323)](_0x20ac79(0x198)+_0x32451c);console['log'](_0x20ac79(0x2b1)+_0x4f5e70+':\x20'+(_0x32451c||_0x20ac79(0x19d))),console['log'](_0x20ac79(0x30a),{'shopId':_0x28496a,'amount':_0x47767a,'network':_0x4f5e70,'wallet':_0x32451c,'status':'COMPLETED','txid':_0x3364be,'notes':_0x5d5514,'periodFrom':_0x417fb0?new Date(_0x417fb0):null,'periodTo':_0x2ca8b5?new Date(_0x2ca8b5):null});const _0x2c20da=await _0x3be39d[_0x20ac79(0x2ad)][_0x20ac79(0x25f)]({'data':{'shopId':_0x28496a,'amount':_0x47767a,'network':_0x4f5e70,'wallet':_0x32451c,'status':'COMPLETED','txid':_0x3364be,'notes':_0x5d5514,'periodFrom':_0x417fb0?new Date(_0x417fb0):null,'periodTo':_0x2ca8b5?new Date(_0x2ca8b5):null,'createdAt':new Date(),'paidAt':new Date()}});console[_0x20ac79(0x323)]('âœ…\x20Payout\x20created\x20in\x20DB:',{'id':_0x2c20da['id'],'wallet':_0x2c20da[_0x20ac79(0x222)],'network':_0x2c20da[_0x20ac79(0x229)],'amount':_0x2c20da['amount']});const _0x17b50f=_0x15c33e-_0x47767a,_0x5bb206=Number(_0x2769e0[_0x20ac79(0x287)])+_0x47767a;return await _0x3be39d['shop']['update']({'where':{'id':_0x28496a},'data':{'balance':_0x17b50f,'totalPaidOut':_0x5bb206}}),console[_0x20ac79(0x323)](_0x20ac79(0x29f)+_0x2769e0['username']+'\x20balance\x20updated:'),console[_0x20ac79(0x323)]('\x20\x20\x20Balance:\x20'+_0x15c33e[_0x20ac79(0x2d0)](0x6)+_0x20ac79(0x298)+_0x17b50f[_0x20ac79(0x2d0)](0x6)+'\x20USDT\x20(-'+_0x47767a[_0x20ac79(0x2d0)](0x6)+')'),console['log'](_0x20ac79(0x2ef)+_0x2769e0[_0x20ac79(0x287)][_0x20ac79(0x2d0)](0x6)+_0x20ac79(0x298)+_0x5bb206[_0x20ac79(0x2d0)](0x6)+_0x20ac79(0x26e)+_0x47767a['toFixed'](0x6)+')'),console[_0x20ac79(0x323)](_0x20ac79(0x2f2)+_0x47767a[_0x20ac79(0x2d0)](0x6)+_0x20ac79(0x228)),{'payout':_0x2c20da,'shop':_0x2769e0};});console[_0x31a1e6(0x323)](_0x31a1e6(0x300)+_0x1bcdbf[_0x31a1e6(0x2ad)]['id']+_0x31a1e6(0x295)+_0x1bcdbf[_0x31a1e6(0x1eb)][_0x31a1e6(0x1db)]+'\x20('+_0x1bcdbf['payout']['amount'][_0x31a1e6(0x2d0)](0x6)+_0x31a1e6(0x2ba));try{let _0x5ec98b=_0x31a1e6(0x261);if(_0x1bcdbf[_0x31a1e6(0x2ad)][_0x31a1e6(0x2fe)]&&_0x1bcdbf[_0x31a1e6(0x2ad)][_0x31a1e6(0x2b5)]){const _0x2f7e22=new Date(_0x1bcdbf['payout'][_0x31a1e6(0x2fe)])[_0x31a1e6(0x2d3)](_0x31a1e6(0x2b7)),_0x752b8d=new Date(_0x1bcdbf[_0x31a1e6(0x2ad)]['periodTo'])[_0x31a1e6(0x2d3)](_0x31a1e6(0x2b7));_0x5ec98b=_0x2f7e22+_0x31a1e6(0x269)+_0x752b8d;}await telegramBotService_1[_0x31a1e6(0x2af)][_0x31a1e6(0x1cd)](_0x1bcdbf[_0x31a1e6(0x2ad)][_0x31a1e6(0x329)],{'id':_0x1bcdbf[_0x31a1e6(0x2ad)]['id'],'amount':_0x1bcdbf[_0x31a1e6(0x2ad)][_0x31a1e6(0x285)],'network':_0x1bcdbf[_0x31a1e6(0x2ad)][_0x31a1e6(0x229)],'wallet':_0x1bcdbf[_0x31a1e6(0x2ad)][_0x31a1e6(0x222)],'period':_0x5ec98b,'createdAt':_0x1bcdbf[_0x31a1e6(0x2ad)][_0x31a1e6(0x2a2)],'txid':_0x1bcdbf[_0x31a1e6(0x2ad)][_0x31a1e6(0x1ff)]}),console[_0x31a1e6(0x323)](_0x31a1e6(0x211)+_0x1bcdbf['payout']['id']);}catch(_0x499307){console[_0x31a1e6(0x28c)](_0x31a1e6(0x24c)+_0x1bcdbf['payout']['id']+':',_0x499307);}return{'id':_0x1bcdbf[_0x31a1e6(0x2ad)]['id'],'shopId':_0x1bcdbf[_0x31a1e6(0x2ad)]['shopId'],'shopName':_0x1bcdbf[_0x31a1e6(0x1eb)][_0x31a1e6(0x1d6)],'shopUsername':_0x1bcdbf[_0x31a1e6(0x1eb)][_0x31a1e6(0x1db)],'amount':_0x1bcdbf[_0x31a1e6(0x2ad)][_0x31a1e6(0x285)],'network':_0x1bcdbf[_0x31a1e6(0x2ad)][_0x31a1e6(0x229)],'wallet':_0x1bcdbf[_0x31a1e6(0x2ad)][_0x31a1e6(0x222)],'status':_0x1bcdbf[_0x31a1e6(0x2ad)][_0x31a1e6(0x279)],'txid':_0x1bcdbf['payout'][_0x31a1e6(0x1ff)],'notes':_0x1bcdbf[_0x31a1e6(0x2ad)]['notes'],'periodFrom':_0x1bcdbf['payout']['periodFrom'],'periodTo':_0x1bcdbf[_0x31a1e6(0x2ad)][_0x31a1e6(0x2b5)],'createdAt':_0x1bcdbf[_0x31a1e6(0x2ad)][_0x31a1e6(0x2a2)],'paidAt':_0x1bcdbf['payout'][_0x31a1e6(0x208)]};}async[a48_0x2aeaec(0x263)](_0x35dbff){const _0x192c64=a48_0x2aeaec,{page:_0x362fef,limit:_0x38556b,shopId:_0x286c97,network:_0x295382,dateFrom:_0x3ad1d9,dateTo:_0x374f46,search:_0x3d21b6}=_0x35dbff,_0x2701e5=(_0x362fef-0x1)*_0x38556b,_0x549caf={};_0x286c97&&(_0x549caf[_0x192c64(0x329)]=_0x286c97);_0x295382&&(_0x549caf[_0x192c64(0x229)]=_0x295382);if(_0x3ad1d9||_0x374f46){_0x549caf[_0x192c64(0x2a2)]={};if(_0x3ad1d9){const _0xaef619=new Date(_0x3ad1d9);_0xaef619[_0x192c64(0x247)](0x0,0x0,0x0,0x1),_0x549caf['createdAt'][_0x192c64(0x1ad)]=_0xaef619,console['log'](_0x192c64(0x2a0)+_0xaef619[_0x192c64(0x313)]());}if(_0x374f46){const _0x248deb=new Date(_0x374f46);_0x248deb[_0x192c64(0x247)](0x17,0x3b,0x3b,0x3e7),_0x549caf[_0x192c64(0x2a2)]['lte']=_0x248deb,console[_0x192c64(0x323)](_0x192c64(0x1b7)+_0x248deb[_0x192c64(0x313)]());}}_0x3d21b6&&(_0x549caf['OR']=[{'shop':{'name':{'contains':_0x3d21b6,'mode':_0x192c64(0x29d)}}},{'shop':{'username':{'contains':_0x3d21b6,'mode':_0x192c64(0x29d)}}},{'notes':{'contains':_0x3d21b6,'mode':'insensitive'}}]);const [_0x1227b7,_0xad9720]=await Promise[_0x192c64(0x19f)]([database_1['default'][_0x192c64(0x2ad)]['findMany']({'where':_0x549caf,'skip':_0x2701e5,'take':_0x38556b,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'wallet':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x192c64(0x2a1)][_0x192c64(0x2ad)][_0x192c64(0x309)]({'where':_0x549caf})]);return{'payouts':_0x1227b7[_0x192c64(0x302)](_0x4ac5a6=>({'id':_0x4ac5a6['id'],'shopId':_0x4ac5a6['shopId'],'shopName':_0x4ac5a6[_0x192c64(0x1eb)][_0x192c64(0x1d6)],'shopUsername':_0x4ac5a6['shop'][_0x192c64(0x1db)],'amount':_0x4ac5a6[_0x192c64(0x285)],'network':_0x4ac5a6[_0x192c64(0x229)],'wallet':_0x4ac5a6[_0x192c64(0x222)],'status':_0x4ac5a6[_0x192c64(0x279)],'txid':_0x4ac5a6[_0x192c64(0x1ff)],'notes':_0x4ac5a6[_0x192c64(0x2bc)],'periodFrom':_0x4ac5a6[_0x192c64(0x2fe)],'periodTo':_0x4ac5a6['periodTo'],'createdAt':_0x4ac5a6[_0x192c64(0x2a2)],'paidAt':_0x4ac5a6[_0x192c64(0x208)]})),'pagination':{'page':_0x362fef,'limit':_0x38556b,'total':_0xad9720,'totalPages':Math['ceil'](_0xad9720/_0x38556b)}};}async[a48_0x2aeaec(0x2a6)](_0xddb5e9){const _0x3ae762=a48_0x2aeaec,_0x36ab2b=await database_1['default']['payout'][_0x3ae762(0x325)]({'where':{'id':_0xddb5e9},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x36ab2b)return null;return{'id':_0x36ab2b['id'],'shopId':_0x36ab2b[_0x3ae762(0x329)],'shopName':_0x36ab2b[_0x3ae762(0x1eb)][_0x3ae762(0x1d6)],'shopUsername':_0x36ab2b[_0x3ae762(0x1eb)][_0x3ae762(0x1db)],'amount':_0x36ab2b[_0x3ae762(0x285)],'network':_0x36ab2b['network'],'wallet':_0x36ab2b[_0x3ae762(0x222)],'status':_0x36ab2b['status'],'txid':_0x36ab2b['txid'],'notes':_0x36ab2b['notes'],'periodFrom':_0x36ab2b['periodFrom'],'periodTo':_0x36ab2b[_0x3ae762(0x2b5)],'createdAt':_0x36ab2b[_0x3ae762(0x2a2)],'paidAt':_0x36ab2b['paidAt']};}async[a48_0x2aeaec(0x312)](_0x14cda1){const _0x5ed517=a48_0x2aeaec;await database_1[_0x5ed517(0x2a1)][_0x5ed517(0x2ad)][_0x5ed517(0x1ef)]({'where':{'id':_0x14cda1}});}async[a48_0x2aeaec(0x20d)](_0x30494d,_0x320619){const _0x405ccf=a48_0x2aeaec,_0x4f606a=await database_1[_0x405ccf(0x2a1)][_0x405ccf(0x244)](async _0x28bdf1=>{const _0x1475bf=_0x405ccf,_0x2f16a1=await _0x28bdf1[_0x1475bf(0x2ad)][_0x1475bf(0x325)]({'where':{'id':_0x30494d},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}}}});if(!_0x2f16a1)throw new Error('Payout\x20not\x20found');console[_0x1475bf(0x323)](_0x1475bf(0x1e0)+_0x30494d+_0x1475bf(0x295)+_0x2f16a1['shop'][_0x1475bf(0x1db)]+':'),console['log'](_0x1475bf(0x30b)+_0x2f16a1[_0x1475bf(0x285)]['toFixed'](0x6)+_0x1475bf(0x228)),console[_0x1475bf(0x323)](_0x1475bf(0x1cb)+_0x2f16a1[_0x1475bf(0x229)]),console[_0x1475bf(0x323)](_0x1475bf(0x282)+_0x2f16a1[_0x1475bf(0x1eb)][_0x1475bf(0x2f5)][_0x1475bf(0x2d0)](0x6)+_0x1475bf(0x228)),console[_0x1475bf(0x323)](_0x1475bf(0x21e)+_0x2f16a1[_0x1475bf(0x1eb)][_0x1475bf(0x287)][_0x1475bf(0x2d0)](0x6)+'\x20USDT');let _0x4ca509=0x0;if(_0x320619[_0x1475bf(0x285)]!==undefined){const _0x5607ce=Number(_0x2f16a1[_0x1475bf(0x285)]),_0x248ab1=Number(_0x320619['amount']);_0x4ca509=_0x248ab1-_0x5607ce,console[_0x1475bf(0x323)]('\x20\x20\x20New\x20amount:\x20'+_0x248ab1['toFixed'](0x6)+_0x1475bf(0x228)),console[_0x1475bf(0x323)]('\x20\x20\x20Amount\x20difference:\x20'+_0x4ca509[_0x1475bf(0x2d0)](0x6)+_0x1475bf(0x228));if(_0x4ca509<0x0)console[_0x1475bf(0x323)]('\x20\x20\x20Amount\x20decreased\x20by\x20'+Math[_0x1475bf(0x2ce)](_0x4ca509)[_0x1475bf(0x2d0)](0x6)+_0x1475bf(0x2c9));else{if(_0x4ca509>0x0){const _0x3c546e=Number(_0x2f16a1[_0x1475bf(0x1eb)][_0x1475bf(0x2f5)]);console[_0x1475bf(0x323)]('\x20\x20\x20Amount\x20increased\x20by\x20'+_0x4ca509[_0x1475bf(0x2d0)](0x6)+_0x1475bf(0x242));if(_0x3c546e<_0x4ca509)throw new Error('Insufficient\x20balance\x20for\x20amount\x20increase.\x20Available:\x20'+_0x3c546e[_0x1475bf(0x2d0)](0x6)+_0x1475bf(0x29c)+_0x4ca509[_0x1475bf(0x2d0)](0x6)+_0x1475bf(0x228));}}}const _0x1b6924={};if(_0x320619[_0x1475bf(0x285)]!==undefined)_0x1b6924['amount']=_0x320619['amount'];if(_0x320619[_0x1475bf(0x229)]!==undefined)_0x1b6924[_0x1475bf(0x229)]=_0x320619[_0x1475bf(0x229)];if(_0x320619[_0x1475bf(0x222)]!==undefined)_0x1b6924[_0x1475bf(0x222)]=_0x320619[_0x1475bf(0x222)]||null;if(_0x320619[_0x1475bf(0x2bc)]!==undefined)_0x1b6924[_0x1475bf(0x2bc)]=_0x320619[_0x1475bf(0x2bc)]||null;if(_0x320619[_0x1475bf(0x1ff)]!==undefined)_0x1b6924[_0x1475bf(0x1ff)]=_0x320619[_0x1475bf(0x1ff)]||null;if(_0x320619[_0x1475bf(0x2fe)]!==undefined)_0x1b6924[_0x1475bf(0x2fe)]=_0x320619[_0x1475bf(0x2fe)]?new Date(_0x320619[_0x1475bf(0x2fe)]):null;if(_0x320619[_0x1475bf(0x2b5)]!==undefined)_0x1b6924[_0x1475bf(0x2b5)]=_0x320619[_0x1475bf(0x2b5)]?new Date(_0x320619[_0x1475bf(0x2b5)]):null;const _0x1eebf7=await _0x28bdf1[_0x1475bf(0x2ad)][_0x1475bf(0x1e8)]({'where':{'id':_0x30494d},'data':_0x1b6924,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(_0x4ca509!==0x0){const _0x3ff7dc=Number(_0x2f16a1[_0x1475bf(0x1eb)]['balance']),_0x516697=Number(_0x2f16a1[_0x1475bf(0x1eb)]['totalPaidOut']),_0x4b9710=_0x3ff7dc-_0x4ca509,_0x3d5b5a=_0x516697+_0x4ca509;await _0x28bdf1['shop'][_0x1475bf(0x1e8)]({'where':{'id':_0x2f16a1[_0x1475bf(0x329)]},'data':{'balance':_0x4b9710,'totalPaidOut':_0x3d5b5a}}),console['log'](_0x1475bf(0x29f)+_0x2f16a1[_0x1475bf(0x1eb)]['username']+'\x20balance\x20updated:'),console[_0x1475bf(0x323)](_0x1475bf(0x283)+_0x3ff7dc[_0x1475bf(0x2d0)](0x6)+_0x1475bf(0x298)+_0x4b9710[_0x1475bf(0x2d0)](0x6)+_0x1475bf(0x228)),console[_0x1475bf(0x323)]('\x20\x20\x20Total\x20paid\x20out:\x20'+_0x516697['toFixed'](0x6)+_0x1475bf(0x298)+_0x3d5b5a[_0x1475bf(0x2d0)](0x6)+_0x1475bf(0x228));}return console[_0x1475bf(0x323)]('âœ…\x20Payout\x20'+_0x30494d+_0x1475bf(0x317)),_0x1eebf7;});return{'id':_0x4f606a['id'],'shopId':_0x4f606a['shopId'],'shopName':_0x4f606a[_0x405ccf(0x1eb)][_0x405ccf(0x1d6)],'shopUsername':_0x4f606a[_0x405ccf(0x1eb)][_0x405ccf(0x1db)],'amount':Number(_0x4f606a[_0x405ccf(0x285)]),'network':_0x4f606a[_0x405ccf(0x229)],'wallet':_0x4f606a['wallet'],'status':_0x4f606a['status'],'txid':_0x4f606a['txid'],'notes':_0x4f606a[_0x405ccf(0x2bc)],'periodFrom':_0x4f606a[_0x405ccf(0x2fe)],'periodTo':_0x4f606a[_0x405ccf(0x2b5)],'createdAt':_0x4f606a[_0x405ccf(0x2a2)],'paidAt':_0x4f606a['paidAt']};}async[a48_0x2aeaec(0x1e2)](_0x4a2a61){const _0x3cd379=a48_0x2aeaec,{page:_0x3efcf2,limit:_0x39f783,status:_0x377c42,gateway:_0x5063f1,shopId:_0x367f32,dateFrom:_0x9a2f4e,dateTo:_0x4e0467,search:_0x306718,currency:_0x1a7afe,sortBy:_0x54828e,sortOrder:_0x1ca67a}=_0x4a2a61,_0x27dddd=(_0x3efcf2-0x1)*_0x39f783;console['log'](_0x3cd379(0x2be),_0x4a2a61);const _0x2a73ae=await database_1[_0x3cd379(0x2a1)][_0x3cd379(0x1f0)][_0x3cd379(0x1af)]({'by':[_0x3cd379(0x1b2)],'_count':{'gateway':!![]}});console[_0x3cd379(0x323)]('ðŸ“Š\x20Available\x20gateways\x20in\x20database:',_0x2a73ae[_0x3cd379(0x302)](_0x1b5b24=>_0x1b5b24[_0x3cd379(0x1b2)]+'\x20('+_0x1b5b24[_0x3cd379(0x216)][_0x3cd379(0x1b2)]+'\x20payments)'));if(_0x5063f1){const _0x2367ad=_0x2a73ae[_0x3cd379(0x297)](_0x3fe412=>_0x3fe412[_0x3cd379(0x1b2)][_0x3cd379(0x260)]()===_0x5063f1[_0x3cd379(0x260)]());!_0x2367ad&&_0x5063f1['toLowerCase']()!==_0x3cd379(0x2f8)&&console[_0x3cd379(0x323)](_0x3cd379(0x1c0)+_0x5063f1+_0x3cd379(0x1aa)+_0x2a73ae[_0x3cd379(0x302)](_0x554387=>_0x554387[_0x3cd379(0x1b2)])['join'](',\x20'));}const _0x2e01bd={};_0x377c42&&(_0x2e01bd[_0x3cd379(0x279)]=_0x377c42[_0x3cd379(0x200)]());if(!_0x5063f1)_0x2e01bd[_0x3cd379(0x1b2)]={'not':_0x3cd379(0x2f8)};else{if(_0x5063f1&&(_0x5063f1[_0x3cd379(0x260)]()===_0x3cd379(0x2f8)||_0x5063f1===_0x3cd379(0x1bb)))_0x2e01bd[_0x3cd379(0x1b2)]=_0x3cd379(0x2f8);else{let _0x3a5ab1=_0x5063f1;const _0x8d7a52=(0x0,gateway_1[_0x3cd379(0x255)])(_0x5063f1);if(_0x8d7a52)_0x3a5ab1=_0x8d7a52,console[_0x3cd379(0x323)](_0x3cd379(0x2eb)+_0x5063f1+'\x27\x20to\x20name\x20\x27'+_0x3a5ab1+'\x27');else{const _0x5f1ab1=(0x0,gateway_1['getGatewayIdByName'])(_0x5063f1);if(_0x5f1ab1){const _0x28ee7c=(0x0,gateway_1['getGatewayNameById'])(_0x5f1ab1);_0x28ee7c&&(_0x3a5ab1=_0x28ee7c,console[_0x3cd379(0x323)]('ðŸ”„\x20Converted\x20gateway\x20name\x20\x27'+_0x5063f1+_0x3cd379(0x24a)+_0x5f1ab1+_0x3cd379(0x2b4)+_0x3a5ab1+'\x27'));}else console[_0x3cd379(0x323)](_0x3cd379(0x284)+_0x5063f1+_0x3cd379(0x1f1));}const _0x393b6b=await database_1[_0x3cd379(0x2a1)]['payment'][_0x3cd379(0x309)]({'where':{'gateway':_0x3a5ab1[_0x3cd379(0x260)]()},'take':0x1});_0x393b6b===0x0?(console[_0x3cd379(0x323)]('âš ï¸\x20Gateway\x20\x27'+_0x3a5ab1+'\x27\x20(from\x20\x27'+_0x5063f1+_0x3cd379(0x2f3)),_0x2e01bd[_0x3cd379(0x1b2)]=_0x3cd379(0x291)):(_0x2e01bd[_0x3cd379(0x1b2)]=_0x3a5ab1[_0x3cd379(0x260)](),console[_0x3cd379(0x323)](_0x3cd379(0x21a)+_0x3a5ab1+_0x3cd379(0x250)+_0x5063f1+'\x27)'));}}console[_0x3cd379(0x323)](_0x3cd379(0x2c4),_0x2e01bd[_0x3cd379(0x1b2)]);_0x367f32&&(_0x2e01bd[_0x3cd379(0x329)]=_0x367f32);_0x1a7afe&&(_0x2e01bd[_0x3cd379(0x2df)]=_0x1a7afe[_0x3cd379(0x200)](),console[_0x3cd379(0x323)](_0x3cd379(0x299)+_0x1a7afe['toUpperCase']()));if(_0x9a2f4e||_0x4e0467){_0x2e01bd[_0x3cd379(0x2a2)]={};if(_0x9a2f4e){const _0x320eab=new Date(_0x9a2f4e),_0x406b57=new Date(Date['UTC'](_0x320eab[_0x3cd379(0x1cf)](),_0x320eab['getUTCMonth'](),_0x320eab[_0x3cd379(0x32b)](),0x0,0x0,0x0,0x0));_0x2e01bd[_0x3cd379(0x2a2)][_0x3cd379(0x1ad)]=_0x406b57,console[_0x3cd379(0x323)](_0x3cd379(0x2c0)+_0x406b57[_0x3cd379(0x313)]());}if(_0x4e0467){const _0x525121=new Date(_0x4e0467),_0x242ef4=new Date(Date[_0x3cd379(0x204)](_0x525121[_0x3cd379(0x1cf)](),_0x525121[_0x3cd379(0x2a7)](),_0x525121['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));_0x2e01bd[_0x3cd379(0x2a2)][_0x3cd379(0x32c)]=_0x242ef4,console[_0x3cd379(0x323)](_0x3cd379(0x2a8)+_0x242ef4['toISOString']());}}_0x306718&&(_0x2e01bd['OR']=[{'id':{'contains':_0x306718,'mode':'insensitive'}},{'orderId':{'contains':_0x306718,'mode':_0x3cd379(0x29d)}},{'gatewayOrderId':{'contains':_0x306718,'mode':'insensitive'}},{'customerEmail':{'contains':_0x306718,'mode':_0x3cd379(0x29d)}},{'shop':{'name':{'contains':_0x306718,'mode':_0x3cd379(0x29d)}}},{'shop':{'username':{'contains':_0x306718,'mode':_0x3cd379(0x29d)}}}]);console[_0x3cd379(0x323)](_0x3cd379(0x232),JSON[_0x3cd379(0x276)](_0x2e01bd,null,0x2));const _0x24100d=await database_1[_0x3cd379(0x2a1)][_0x3cd379(0x1f0)][_0x3cd379(0x309)]({'where':_0x2e01bd});console[_0x3cd379(0x323)](_0x3cd379(0x30c)+_0x24100d);let _0x29904e={'createdAt':'desc'};if(_0x54828e){const _0x54e73c=[_0x3cd379(0x285),_0x3cd379(0x2a2),_0x3cd379(0x1f6),_0x3cd379(0x279),_0x3cd379(0x1b2),'currency'],_0xb08a2f=[_0x3cd379(0x262),_0x3cd379(0x1e1)];if(_0x54e73c[_0x3cd379(0x252)](_0x54828e)){const _0x1f7978=_0xb08a2f[_0x3cd379(0x252)](_0x1ca67a)?_0x1ca67a:_0x3cd379(0x1e1);_0x29904e={[_0x54828e]:_0x1f7978},console[_0x3cd379(0x323)](_0x3cd379(0x1d9)+_0x54828e+'\x20in\x20'+_0x1f7978+_0x3cd379(0x2bb));}}const [_0x154a67,_0x1b9c1c]=await Promise[_0x3cd379(0x19f)]([database_1['default'][_0x3cd379(0x1f0)]['findMany']({'where':_0x2e01bd,'skip':_0x27dddd,'take':_0x39f783,'orderBy':_0x29904e,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x3cd379(0x2a1)]['payment'][_0x3cd379(0x309)]({'where':_0x2e01bd})]);let _0x472f86,_0x396456;if(_0x9a2f4e){const _0x3810e2=new Date(_0x9a2f4e);_0x472f86=new Date(Date[_0x3cd379(0x204)](_0x3810e2[_0x3cd379(0x1cf)](),_0x3810e2[_0x3cd379(0x2a7)](),_0x3810e2['getUTCDate'](),0x0,0x0,0x0,0x0));}else{const _0x4d0e0b=new Date();_0x472f86=new Date(Date[_0x3cd379(0x204)](_0x4d0e0b['getUTCFullYear'](),_0x4d0e0b[_0x3cd379(0x2a7)](),_0x4d0e0b[_0x3cd379(0x32b)](),0x0,0x0,0x0,0x0));}if(_0x4e0467){const _0x1def5b=new Date(_0x4e0467);_0x396456=new Date(Date['UTC'](_0x1def5b['getUTCFullYear'](),_0x1def5b[_0x3cd379(0x2a7)](),_0x1def5b[_0x3cd379(0x32b)](),0x17,0x3b,0x3b,0x3e7));}else{if(_0x9a2f4e){const _0x4106ca=new Date(_0x9a2f4e);_0x396456=new Date(Date[_0x3cd379(0x204)](_0x4106ca['getUTCFullYear'](),_0x4106ca[_0x3cd379(0x2a7)](),_0x4106ca['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}else{const _0x22bce9=new Date();_0x396456=new Date(Date[_0x3cd379(0x204)](_0x22bce9[_0x3cd379(0x1cf)](),_0x22bce9[_0x3cd379(0x2a7)](),_0x22bce9[_0x3cd379(0x32b)](),0x17,0x3b,0x3b,0x3e7));}}const _0xe18a4a={'status':'PAID','createdAt':{'gte':_0x472f86,'lte':_0x396456}};_0x5063f1?_0xe18a4a[_0x3cd379(0x1b2)]=_0x2e01bd['gateway']:_0xe18a4a[_0x3cd379(0x1b2)]={'not':_0x3cd379(0x2f8)};_0x367f32&&(_0xe18a4a['shopId']=_0x367f32);_0x1a7afe&&(_0xe18a4a[_0x3cd379(0x2df)]=_0x1a7afe['toUpperCase']());console['log'](_0x3cd379(0x23a),JSON[_0x3cd379(0x276)](_0xe18a4a,null,0x2));const _0x5e0ae4=await database_1['default'][_0x3cd379(0x1f0)][_0x3cd379(0x277)]({'where':_0xe18a4a,'select':{'amountUSDT':!![],'currency':!![],'amount':!![]}}),_0x54e0ff={};let _0x2c2d75=0x0;return _0x5e0ae4['forEach'](_0x47da43=>{const _0x174f8e=_0x3cd379;_0x47da43[_0x174f8e(0x219)]&&(_0x2c2d75+=_0x47da43[_0x174f8e(0x219)]);if(_0x47da43[_0x174f8e(0x2df)]){const _0x19e02b=_0x47da43[_0x174f8e(0x2df)][_0x174f8e(0x200)]();!_0x54e0ff[_0x19e02b]&&(_0x54e0ff[_0x19e02b]=0x0),_0x54e0ff[_0x19e02b]+=_0x47da43['amount'];}}),_0x2c2d75>0x0&&(_0x54e0ff['USDT']=_0x2c2d75),{'payments':_0x154a67,'pagination':{'page':_0x3efcf2,'limit':_0x39f783,'total':_0x1b9c1c,'totalPages':Math[_0x3cd379(0x245)](_0x1b9c1c/_0x39f783)},'statistics':_0x54e0ff};}async['getPaymentById'](_0x531097){const _0x505dea=a48_0x2aeaec,_0x2be7d1=await database_1['default'][_0x505dea(0x1f0)]['findUnique']({'where':{'id':_0x531097},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x2be7d1)return null;return{'id':_0x2be7d1['id'],'shopId':_0x2be7d1[_0x505dea(0x329)],'gateway':_0x2be7d1[_0x505dea(0x1b2)],'amount':_0x2be7d1[_0x505dea(0x285)],'currency':_0x2be7d1[_0x505dea(0x2df)],'status':_0x2be7d1['status'],'orderId':_0x2be7d1['orderId'],'gatewayOrderId':_0x2be7d1['gatewayOrderId'],'customerEmail':_0x2be7d1[_0x505dea(0x226)],'customerName':_0x2be7d1[_0x505dea(0x30e)],'customerCountry':_0x2be7d1[_0x505dea(0x324)],'customerIp':_0x2be7d1['customerIp'],'customerUa':_0x2be7d1['customerUa'],'failureMessage':_0x2be7d1[_0x505dea(0x195)],'externalPaymentUrl':_0x2be7d1['externalPaymentUrl'],'successUrl':_0x2be7d1[_0x505dea(0x256)],'failUrl':_0x2be7d1['failUrl'],'pendingUrl':_0x2be7d1['pendingUrl'],'whiteUrl':_0x2be7d1[_0x505dea(0x2b0)],'createdAt':_0x2be7d1[_0x505dea(0x2a2)],'updatedAt':_0x2be7d1['updatedAt'],'shop':_0x2be7d1['shop']};}async['updatePaymentStatus'](_0x595f9e,_0x2963db,_0x576c68,_0x1ef373){const _0x189e4d=a48_0x2aeaec,_0x3d2de2=await database_1[_0x189e4d(0x2a1)][_0x189e4d(0x244)](async _0x1b64d6=>{const _0x2a94bb=_0x189e4d,_0x4370e9=await _0x1b64d6['payment'][_0x2a94bb(0x325)]({'where':{'id':_0x595f9e},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x4370e9)throw new Error(_0x2a94bb(0x319));const _0x2e3c23=_0x4370e9[_0x2a94bb(0x279)],_0x3b5611=_0x2963db[_0x2a94bb(0x200)]();console[_0x2a94bb(0x323)]('ðŸ”„\x20Admin\x20updating\x20payment\x20'+_0x595f9e+'\x20status:\x20'+_0x2e3c23+'\x20->\x20'+_0x3b5611),console[_0x2a94bb(0x323)](_0x2a94bb(0x2ab)+_0x4370e9[_0x2a94bb(0x1eb)]['balance']+_0x2a94bb(0x228));const _0x1b0753={'status':_0x3b5611,'updatedAt':new Date(),'statusChangedBy':'admin','statusChangedAt':new Date()};_0x576c68&&(_0x1b0753[_0x2a94bb(0x321)]=_0x576c68);_0x3b5611===_0x2a94bb(0x19c)&&_0x1ef373&&(_0x1b0753[_0x2a94bb(0x23c)]=_0x1ef373);let _0x1dc8ca=0x0,_0x3c36ee=_0x4370e9[_0x2a94bb(0x1eb)][_0x2a94bb(0x2f5)];if(_0x3b5611===_0x2a94bb(0x197)&&_0x2e3c23!==_0x2a94bb(0x197)){_0x1b0753[_0x2a94bb(0x208)]=new Date();const _0x348366=await currencyService_1[_0x2a94bb(0x1a3)][_0x2a94bb(0x270)](_0x4370e9[_0x2a94bb(0x285)],_0x4370e9['currency']);_0x1b0753[_0x2a94bb(0x219)]=_0x348366;let _0x479180=0x2d;const _0x4aafe3=await _0x1b64d6['shop'][_0x2a94bb(0x325)]({'where':{'id':_0x4370e9[_0x2a94bb(0x329)]},'select':{'gatewaySettings':!![]}});if(_0x4aafe3?.[_0x2a94bb(0x1d7)])try{const _0x13c854=JSON[_0x2a94bb(0x22c)](_0x4aafe3[_0x2a94bb(0x1d7)]);for(const [_0xab1eb1,_0x573194]of Object['entries'](_0x13c854)){if(_0xab1eb1[_0x2a94bb(0x260)]()===_0x4370e9['gateway']['toLowerCase']()){_0x479180=_0x573194['commission']||0xa;break;}}}catch(_0x35409c){console[_0x2a94bb(0x28c)]('Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20'+_0x595f9e+':',_0x35409c);}let _0x33f982;_0x4370e9[_0x2a94bb(0x2cc)]!==null&&_0x4370e9[_0x2a94bb(0x2cc)]!==undefined?(_0x33f982=_0x4370e9[_0x2a94bb(0x2cc)],console[_0x2a94bb(0x323)]('ðŸ“Š\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20'+_0x33f982[_0x2a94bb(0x2d0)](0x6)+_0x2a94bb(0x25c)+_0x595f9e)):(_0x33f982=_0x348366*(0x1-_0x479180/0x64),console[_0x2a94bb(0x323)](_0x2a94bb(0x224)+_0x595f9e+':\x20'+_0x479180+'%\x20from\x20'+_0x348366[_0x2a94bb(0x2d0)](0x6)+_0x2a94bb(0x228)),_0x1b0753['amountAfterGatewayCommissionUSDT']=_0x33f982,_0x1b0753['gatewayCommissionRate']=_0x479180),_0x1dc8ca=_0x33f982,_0x3c36ee+=_0x33f982,console['log'](_0x2a94bb(0x1ca)+_0x595f9e+_0x2a94bb(0x2d1)),console[_0x2a94bb(0x323)](_0x2a94bb(0x1ac)+_0x348366[_0x2a94bb(0x2d0)](0x6)+_0x2a94bb(0x228)),console['log'](_0x2a94bb(0x1ce)+_0x4370e9[_0x2a94bb(0x1b2)]+_0x2a94bb(0x1f9)+_0x479180+'%'),console[_0x2a94bb(0x323)](_0x2a94bb(0x31e)+_0x33f982[_0x2a94bb(0x2d0)](0x6)+_0x2a94bb(0x2b6)+_0x479180+'%\x20commission)'),console[_0x2a94bb(0x323)](_0x2a94bb(0x1ae)+_0x33f982['toFixed'](0x6)+'\x20USDT');}else{if(_0x2e3c23===_0x2a94bb(0x197)&&_0x3b5611!==_0x2a94bb(0x197)&&_0x3b5611!=='CHARGEBACK'){if(_0x4370e9[_0x2a94bb(0x219)]){let _0x2bc0f0=0x2d;const _0x220c99=await _0x1b64d6[_0x2a94bb(0x1eb)][_0x2a94bb(0x325)]({'where':{'id':_0x4370e9[_0x2a94bb(0x329)]},'select':{'gatewaySettings':!![]}});if(_0x220c99?.[_0x2a94bb(0x1d7)])try{const _0x184c96=JSON['parse'](_0x220c99['gatewaySettings']);for(const [_0x4c9170,_0x40017e]of Object[_0x2a94bb(0x1dd)](_0x184c96)){if(_0x4c9170[_0x2a94bb(0x260)]()===_0x4370e9['gateway'][_0x2a94bb(0x260)]()){_0x2bc0f0=_0x40017e[_0x2a94bb(0x28b)]||0xa;break;}}}catch(_0x3f7066){console[_0x2a94bb(0x28c)]('Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20'+_0x595f9e+':',_0x3f7066);}const _0x4893ea=_0x4370e9[_0x2a94bb(0x219)]*(0x1-_0x2bc0f0/0x64);_0x1dc8ca=-_0x4893ea,_0x3c36ee-=_0x4893ea,console[_0x2a94bb(0x323)](_0x2a94bb(0x1ac)+_0x4370e9[_0x2a94bb(0x219)]['toFixed'](0x6)+'\x20USDT'),console[_0x2a94bb(0x323)](_0x2a94bb(0x1ce)+_0x4370e9[_0x2a94bb(0x1b2)]+',\x20Commission:\x20'+_0x2bc0f0+'%'),console[_0x2a94bb(0x323)]('\x20\x20\x20Merchant\x20loses:\x20'+_0x4893ea[_0x2a94bb(0x2d0)](0x6)+'\x20USDT\x20(after\x20'+_0x2bc0f0+_0x2a94bb(0x25e)),console[_0x2a94bb(0x323)](_0x2a94bb(0x233)+_0x4893ea[_0x2a94bb(0x2d0)](0x6)+_0x2a94bb(0x228));}}}_0x3b5611===_0x2a94bb(0x19c)&&(console[_0x2a94bb(0x323)](_0x2a94bb(0x1a0)),_0x1ef373&&_0x1ef373>0x0?(_0x1dc8ca=-_0x1ef373,_0x3c36ee-=_0x1ef373,console['log']('ðŸ’¸\x20CHARGEBACK\x20penalty\x20ONLY:\x20-'+_0x1ef373[_0x2a94bb(0x2d0)](0x6)+_0x2a94bb(0x21f)),console[_0x2a94bb(0x323)](_0x2a94bb(0x328))):console[_0x2a94bb(0x323)]('âš ï¸\x20CHARGEBACK\x20without\x20penalty\x20amount\x20-\x20no\x20balance\x20change'),_0x1b0753[_0x2a94bb(0x23c)]=_0x1ef373||0x0);_0x3b5611==='REFUND'&&_0x2e3c23===_0x2a94bb(0x197)&&console[_0x2a94bb(0x323)](_0x2a94bb(0x293));const _0x52c28c=await _0x1b64d6[_0x2a94bb(0x1f0)]['update']({'where':{'id':_0x595f9e},'data':_0x1b0753,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x1dc8ca!==0x0&&(await _0x1b64d6[_0x2a94bb(0x1eb)][_0x2a94bb(0x1e8)]({'where':{'id':_0x4370e9[_0x2a94bb(0x329)]},'data':{'balance':_0x3c36ee}}),console[_0x2a94bb(0x323)](_0x2a94bb(0x29f)+_0x4370e9[_0x2a94bb(0x329)]+_0x2a94bb(0x2bd)+_0x4370e9[_0x2a94bb(0x1eb)]['balance'][_0x2a94bb(0x2d0)](0x6)+'\x20->\x20'+_0x3c36ee[_0x2a94bb(0x2d0)](0x6)+'\x20USDT\x20('+(_0x1dc8ca>0x0?'+':'')+_0x1dc8ca[_0x2a94bb(0x2d0)](0x6)+')')),_0x52c28c;});return{'id':_0x3d2de2['id'],'shopId':_0x3d2de2['shopId'],'gateway':_0x3d2de2['gateway'],'amount':_0x3d2de2[_0x189e4d(0x285)],'currency':_0x3d2de2['currency'],'status':_0x3d2de2[_0x189e4d(0x279)],'orderId':_0x3d2de2[_0x189e4d(0x1ba)],'gatewayOrderId':_0x3d2de2['gatewayOrderId'],'customerEmail':_0x3d2de2[_0x189e4d(0x226)],'customerName':_0x3d2de2[_0x189e4d(0x30e)],'customerCountry':_0x3d2de2['customerCountry'],'customerIp':_0x3d2de2[_0x189e4d(0x218)],'customerUa':_0x3d2de2['customerUa'],'failureMessage':_0x3d2de2[_0x189e4d(0x195)],'adminNotes':_0x3d2de2[_0x189e4d(0x321)],'chargebackAmount':_0x3d2de2[_0x189e4d(0x23c)],'statusChangedBy':_0x3d2de2[_0x189e4d(0x264)],'statusChangedAt':_0x3d2de2['statusChangedAt'],'createdAt':_0x3d2de2[_0x189e4d(0x2a2)],'updatedAt':_0x3d2de2[_0x189e4d(0x1f6)],'shop':_0x3d2de2['shop']};}async[a48_0x2aeaec(0x2fd)](_0x1d1808,_0x109f4a){const _0x58f0f5=a48_0x2aeaec,_0x3484a6=Math[_0x58f0f5(0x2d6)]()[_0x58f0f5(0x19a)](0x24)[_0x58f0f5(0x2e4)](0x2,0x9);console['log']('ðŸŽ¯\x20updateUser\x20called\x20with\x20ID:\x20'+_0x3484a6+_0x58f0f5(0x2a4)+_0x1d1808);const _0x19489a={..._0x109f4a};_0x109f4a[_0x58f0f5(0x2dd)]&&_0x109f4a[_0x58f0f5(0x2dd)][_0x58f0f5(0x2e5)]()!==''?(console[_0x58f0f5(0x323)]('ðŸ”\x20['+_0x3484a6+_0x58f0f5(0x27e)+_0x1d1808),_0x19489a[_0x58f0f5(0x2dd)]=await bcryptjs_1['default'][_0x58f0f5(0x1ea)](_0x109f4a['password'],0xc)):(console['log']('ðŸ”\x20['+_0x3484a6+_0x58f0f5(0x272)),delete _0x19489a['password']);_0x109f4a[_0x58f0f5(0x27d)]&&(_0x19489a[_0x58f0f5(0x1d6)]=_0x109f4a[_0x58f0f5(0x27d)],delete _0x19489a[_0x58f0f5(0x27d)]);_0x109f4a[_0x58f0f5(0x251)]&&(_0x19489a[_0x58f0f5(0x2f9)]=_0x109f4a[_0x58f0f5(0x251)],delete _0x19489a['telegramId']);_0x109f4a['merchantUrl']&&(_0x19489a[_0x58f0f5(0x2e0)]=_0x109f4a[_0x58f0f5(0x1b4)],delete _0x19489a['merchantUrl']);if(_0x109f4a['gateways']){const _0xd2e3f6=_0x109f4a[_0x58f0f5(0x21b)]['map'](_0x5e2335=>this[_0x58f0f5(0x2f6)](_0x5e2335));console[_0x58f0f5(0x323)](_0x58f0f5(0x1cc),_0x109f4a[_0x58f0f5(0x21b)],'->',_0xd2e3f6),_0x19489a[_0x58f0f5(0x2d4)]=JSON[_0x58f0f5(0x276)](_0xd2e3f6),delete _0x19489a[_0x58f0f5(0x21b)];}_0x109f4a['gatewaySettings']&&(console[_0x58f0f5(0x323)]('ðŸ”§\x20['+_0x3484a6+_0x58f0f5(0x1a4),_0x109f4a['gatewaySettings']),_0x19489a[_0x58f0f5(0x1d7)]=JSON[_0x58f0f5(0x276)](_0x109f4a[_0x58f0f5(0x1d7)]),console[_0x58f0f5(0x323)](_0x58f0f5(0x1a9)+_0x3484a6+']\x20Gateway\x20settings\x20JSON\x20string:',_0x19489a[_0x58f0f5(0x1d7)]));_0x109f4a[_0x58f0f5(0x20f)]&&(_0x109f4a['wallets']['usdtPolygonWallet']!==undefined&&(_0x19489a[_0x58f0f5(0x257)]=_0x109f4a[_0x58f0f5(0x20f)][_0x58f0f5(0x257)]||null),_0x109f4a['wallets']['usdtTrcWallet']!==undefined&&(_0x19489a['usdtTrcWallet']=_0x109f4a['wallets'][_0x58f0f5(0x26c)]||null),_0x109f4a[_0x58f0f5(0x20f)][_0x58f0f5(0x1b5)]!==undefined&&(_0x19489a[_0x58f0f5(0x1b5)]=_0x109f4a['wallets'][_0x58f0f5(0x1b5)]||null),_0x109f4a[_0x58f0f5(0x20f)][_0x58f0f5(0x25d)]!==undefined&&(_0x19489a[_0x58f0f5(0x25d)]=_0x109f4a[_0x58f0f5(0x20f)][_0x58f0f5(0x25d)]||null),delete _0x19489a['wallets']);const _0x341fe6=await database_1[_0x58f0f5(0x2a1)]['shop'][_0x58f0f5(0x1e8)]({'where':{'id':_0x1d1808},'data':_0x19489a,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0x58f0f5(0x323)](_0x58f0f5(0x294)+_0x3484a6+_0x58f0f5(0x234),_0x341fe6['gatewaySettings']),{'id':_0x341fe6['id'],'fullName':_0x341fe6[_0x58f0f5(0x1d6)],'username':_0x341fe6['username'],'telegramId':_0x341fe6[_0x58f0f5(0x2f9)],'merchantUrl':_0x341fe6[_0x58f0f5(0x2e0)],'gateways':_0x341fe6[_0x58f0f5(0x2d4)]?JSON[_0x58f0f5(0x22c)](_0x341fe6['paymentGateways']):null,'gatewaySettings':_0x341fe6[_0x58f0f5(0x1d7)]?JSON[_0x58f0f5(0x22c)](_0x341fe6[_0x58f0f5(0x1d7)]):null,'publicKey':_0x341fe6[_0x58f0f5(0x1dc)],'wallets':{'usdtPolygonWallet':_0x341fe6[_0x58f0f5(0x257)],'usdtTrcWallet':_0x341fe6[_0x58f0f5(0x26c)],'usdtErcWallet':_0x341fe6[_0x58f0f5(0x1b5)],'usdcPolygonWallet':_0x341fe6[_0x58f0f5(0x25d)]},'status':_0x341fe6[_0x58f0f5(0x279)],'createdAt':_0x341fe6[_0x58f0f5(0x2a2)]};}async['suspendUser'](_0x208a9d){const _0x3ea8b4=a48_0x2aeaec,_0x5d6258=await database_1[_0x3ea8b4(0x2a1)][_0x3ea8b4(0x1eb)]['update']({'where':{'id':_0x208a9d},'data':{'status':_0x3ea8b4(0x1d2)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x5d6258['id'],'fullName':_0x5d6258[_0x3ea8b4(0x1d6)],'username':_0x5d6258[_0x3ea8b4(0x1db)],'telegramId':_0x5d6258['telegram'],'merchantUrl':_0x5d6258[_0x3ea8b4(0x2e0)],'gateways':_0x5d6258[_0x3ea8b4(0x2d4)]?JSON[_0x3ea8b4(0x22c)](_0x5d6258[_0x3ea8b4(0x2d4)]):null,'gatewaySettings':_0x5d6258['gatewaySettings']?JSON[_0x3ea8b4(0x22c)](_0x5d6258[_0x3ea8b4(0x1d7)]):null,'publicKey':_0x5d6258['publicKey'],'wallets':{'usdtPolygonWallet':_0x5d6258[_0x3ea8b4(0x257)],'usdtTrcWallet':_0x5d6258[_0x3ea8b4(0x26c)],'usdtErcWallet':_0x5d6258['usdtErcWallet'],'usdcPolygonWallet':_0x5d6258[_0x3ea8b4(0x25d)]},'status':_0x5d6258[_0x3ea8b4(0x279)],'createdAt':_0x5d6258[_0x3ea8b4(0x2a2)]};}async[a48_0x2aeaec(0x2d2)](_0x38df29){const _0x18360c=a48_0x2aeaec,_0x3efc9d=await database_1[_0x18360c(0x2a1)][_0x18360c(0x1eb)][_0x18360c(0x1e8)]({'where':{'id':_0x38df29},'data':{'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x3efc9d['id'],'fullName':_0x3efc9d['name'],'username':_0x3efc9d[_0x18360c(0x1db)],'telegramId':_0x3efc9d['telegram'],'merchantUrl':_0x3efc9d['shopUrl'],'gateways':_0x3efc9d[_0x18360c(0x2d4)]?JSON[_0x18360c(0x22c)](_0x3efc9d[_0x18360c(0x2d4)]):null,'gatewaySettings':_0x3efc9d[_0x18360c(0x1d7)]?JSON[_0x18360c(0x22c)](_0x3efc9d[_0x18360c(0x1d7)]):null,'publicKey':_0x3efc9d[_0x18360c(0x1dc)],'wallets':{'usdtPolygonWallet':_0x3efc9d[_0x18360c(0x257)],'usdtTrcWallet':_0x3efc9d[_0x18360c(0x26c)],'usdtErcWallet':_0x3efc9d[_0x18360c(0x1b5)],'usdcPolygonWallet':_0x3efc9d['usdcPolygonWallet']},'status':_0x3efc9d['status'],'createdAt':_0x3efc9d[_0x18360c(0x2a2)]};}async[a48_0x2aeaec(0x248)](_0xa0ccef){const _0x490019=a48_0x2aeaec,{page:_0x270166,limit:_0x223177,status:_0x513d21}=_0xa0ccef,_0x512083=(_0x270166-0x1)*_0x223177,_0x23a7dd={};_0x513d21&&(_0x23a7dd[_0x490019(0x279)]=_0x513d21[_0x490019(0x200)]());const [_0x9f149c,_0x5e757a]=await Promise['all']([database_1[_0x490019(0x2a1)]['shop'][_0x490019(0x277)]({'where':_0x23a7dd,'skip':_0x512083,'take':_0x223177,'orderBy':{'createdAt':_0x490019(0x1e1)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'twoFactorEnabled':!![],'createdAt':!![]}}),database_1[_0x490019(0x2a1)][_0x490019(0x1eb)][_0x490019(0x309)]({'where':_0x23a7dd})]);return{'users':_0x9f149c[_0x490019(0x302)](_0x24c3f7=>{const _0x2831e7=_0x490019,_0x704718=_0x24c3f7[_0x2831e7(0x2d4)]?JSON[_0x2831e7(0x22c)](_0x24c3f7[_0x2831e7(0x2d4)]):null,_0x40d75e=_0x704718?_0x704718[_0x2831e7(0x302)](_0x2eea17=>this[_0x2831e7(0x2c8)](_0x2eea17)):null;return{'id':_0x24c3f7['id'],'fullName':_0x24c3f7[_0x2831e7(0x1d6)],'username':_0x24c3f7['username'],'telegramId':_0x24c3f7[_0x2831e7(0x2f9)],'merchantUrl':_0x24c3f7['shopUrl'],'gateways':_0x40d75e,'gatewaySettings':_0x24c3f7[_0x2831e7(0x1d7)]?JSON[_0x2831e7(0x22c)](_0x24c3f7[_0x2831e7(0x1d7)]):null,'publicKey':_0x24c3f7[_0x2831e7(0x1dc)],'wallets':{'usdtPolygonWallet':_0x24c3f7[_0x2831e7(0x257)],'usdtTrcWallet':_0x24c3f7[_0x2831e7(0x26c)],'usdtErcWallet':_0x24c3f7[_0x2831e7(0x1b5)],'usdcPolygonWallet':_0x24c3f7[_0x2831e7(0x25d)],'usdcErcWallet':_0x24c3f7['usdcErcWallet']},'status':_0x24c3f7[_0x2831e7(0x279)],'twoFactorEnabled':_0x24c3f7[_0x2831e7(0x1bf)]||![],'createdAt':_0x24c3f7[_0x2831e7(0x2a2)]};}),'pagination':{'page':_0x270166,'limit':_0x223177,'total':_0x5e757a,'totalPages':Math[_0x490019(0x245)](_0x5e757a/_0x223177)}};}async[a48_0x2aeaec(0x30f)](_0x193693){const _0x19d12b=a48_0x2aeaec,_0x24a529=await database_1['default'][_0x19d12b(0x1eb)][_0x19d12b(0x325)]({'where':{'id':_0x193693},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x24a529)return null;const _0x35f461=_0x24a529[_0x19d12b(0x2d4)]?JSON[_0x19d12b(0x22c)](_0x24a529[_0x19d12b(0x2d4)]):null,_0x25ccd7=_0x35f461?_0x35f461['map'](_0x4e3609=>this[_0x19d12b(0x2c8)](_0x4e3609)):null;return _0x35f461&&_0x25ccd7&&console[_0x19d12b(0x323)](_0x19d12b(0x267),_0x35f461,'->',_0x25ccd7),{'id':_0x24a529['id'],'fullName':_0x24a529[_0x19d12b(0x1d6)],'username':_0x24a529['username'],'telegramId':_0x24a529[_0x19d12b(0x2f9)],'merchantUrl':_0x24a529[_0x19d12b(0x2e0)],'gateways':_0x25ccd7,'gatewaySettings':_0x24a529['gatewaySettings']?JSON[_0x19d12b(0x22c)](_0x24a529[_0x19d12b(0x1d7)]):null,'publicKey':_0x24a529['publicKey'],'wallets':{'usdtPolygonWallet':_0x24a529['usdtPolygonWallet'],'usdtTrcWallet':_0x24a529[_0x19d12b(0x26c)],'usdtErcWallet':_0x24a529[_0x19d12b(0x1b5)],'usdcPolygonWallet':_0x24a529[_0x19d12b(0x25d)],'usdcErcWallet':_0x24a529[_0x19d12b(0x243)]},'status':_0x24a529[_0x19d12b(0x279)],'createdAt':_0x24a529[_0x19d12b(0x2a2)]};}async['createUser'](_0x1fb168){const _0x50ee72=a48_0x2aeaec,{fullName:_0x3b56ad,username:_0x948c59,password:_0x4fa8dd,telegramId:_0x2225fe,merchantUrl:_0x5044e6,gateways:_0x3b08d6,gatewaySettings:_0x53d4e2,wallets:_0x10fdb4}=_0x1fb168,_0x3bd2d0=await database_1[_0x50ee72(0x2a1)][_0x50ee72(0x1eb)][_0x50ee72(0x325)]({'where':{'username':_0x948c59}});if(_0x3bd2d0)throw new Error(_0x50ee72(0x1c6));if(_0x2225fe){const _0x2aee68=await database_1[_0x50ee72(0x2a1)][_0x50ee72(0x1eb)][_0x50ee72(0x325)]({'where':{'telegram':_0x2225fe}});if(_0x2aee68)throw new Error('Telegram\x20username\x20already\x20exists');}const _0x362208=await bcryptjs_1['default']['hash'](_0x4fa8dd,0xc),_0x945dc7='pk_'+crypto_1[_0x50ee72(0x2a1)][_0x50ee72(0x2e9)](0x20)[_0x50ee72(0x19a)](_0x50ee72(0x2d8)),_0x1711fb=_0x50ee72(0x259)+crypto_1[_0x50ee72(0x2a1)][_0x50ee72(0x2e9)](0x20)[_0x50ee72(0x19a)](_0x50ee72(0x2d8)),_0x3784c4=_0x3b08d6?_0x3b08d6[_0x50ee72(0x302)](_0x23c9ac=>this['getGatewayInternalName'](_0x23c9ac)):null;_0x3b08d6&&_0x3784c4&&console['log'](_0x50ee72(0x203),_0x3b08d6,'->',_0x3784c4);const _0x115c09=await database_1[_0x50ee72(0x2a1)]['shop']['create']({'data':{'name':_0x3b56ad,'username':_0x948c59,'password':_0x362208,'telegram':_0x2225fe,'shopUrl':_0x5044e6,'paymentGateways':_0x3784c4?JSON[_0x50ee72(0x276)](_0x3784c4):null,'gatewaySettings':_0x53d4e2?JSON[_0x50ee72(0x276)](_0x53d4e2):null,'usdtPolygonWallet':_0x10fdb4?.[_0x50ee72(0x257)]||null,'usdtTrcWallet':_0x10fdb4?.[_0x50ee72(0x26c)]||null,'usdtErcWallet':_0x10fdb4?.['usdtErcWallet']||null,'usdcPolygonWallet':_0x10fdb4?.['usdcPolygonWallet']||null,'publicKey':_0x945dc7,'secretKey':_0x1711fb,'status':_0x50ee72(0x2c2)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x115c09['id'],'fullName':_0x115c09[_0x50ee72(0x1d6)],'username':_0x115c09[_0x50ee72(0x1db)],'telegramId':_0x115c09[_0x50ee72(0x2f9)],'merchantUrl':_0x115c09['shopUrl'],'gateways':_0x115c09['paymentGateways']?JSON[_0x50ee72(0x22c)](_0x115c09['paymentGateways']):null,'gatewaySettings':_0x115c09['gatewaySettings']?JSON[_0x50ee72(0x22c)](_0x115c09['gatewaySettings']):null,'publicKey':_0x115c09[_0x50ee72(0x1dc)],'wallets':{'usdtPolygonWallet':_0x115c09[_0x50ee72(0x257)],'usdtTrcWallet':_0x115c09['usdtTrcWallet'],'usdtErcWallet':_0x115c09['usdtErcWallet'],'usdcPolygonWallet':_0x115c09[_0x50ee72(0x25d)]},'status':_0x115c09[_0x50ee72(0x279)],'createdAt':_0x115c09[_0x50ee72(0x2a2)]};}async[a48_0x2aeaec(0x316)](_0x5dff96){const _0x46d8a1=a48_0x2aeaec;await database_1[_0x46d8a1(0x2a1)]['shop'][_0x46d8a1(0x1ef)]({'where':{'id':_0x5dff96}});}async[a48_0x2aeaec(0x199)](_0x4e1ee3){const _0x3a4298=a48_0x2aeaec,_0x324618=await database_1['default']['shop']['findUnique']({'where':{'id':_0x4e1ee3},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});if(!_0x324618)throw new Error('Shop\x20not\x20found');return{'usdtPolygonWallet':_0x324618['usdtPolygonWallet'],'usdtTrcWallet':_0x324618[_0x3a4298(0x26c)],'usdtErcWallet':_0x324618['usdtErcWallet'],'usdcPolygonWallet':_0x324618[_0x3a4298(0x25d)],'usdcErcWallet':_0x324618[_0x3a4298(0x243)]};}[a48_0x2aeaec(0x278)](_0x5b1b12=0x8){const _0x142f62=a48_0x2aeaec,_0x58c6ec=[];for(let _0x997b9=0x0;_0x997b9<_0x5b1b12;_0x997b9++){const _0x4594ec=crypto_1[_0x142f62(0x2a1)]['randomBytes'](0x4)[_0x142f62(0x19a)](_0x142f62(0x2d8))['toUpperCase']();_0x58c6ec[_0x142f62(0x296)](_0x4594ec);}return _0x58c6ec;}async[a48_0x2aeaec(0x2a5)](_0x2622f4){const _0x26b875=a48_0x2aeaec,_0x35fa3b=await database_1['default']['shop'][_0x26b875(0x325)]({'where':{'id':_0x2622f4},'select':{'id':!![],'name':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x35fa3b)throw new Error(_0x26b875(0x1ee));const _0x222472=speakeasy_1['default'][_0x26b875(0x246)]({'name':_0x26b875(0x22f)+_0x35fa3b[_0x26b875(0x1db)]+')','issuer':_0x26b875(0x1fc),'length':0x20}),_0x328568=await qrcode_1[_0x26b875(0x2a1)][_0x26b875(0x221)](_0x222472[_0x26b875(0x308)]),_0xd2c50c=this['generateBackupCodes'](0x8),_0x4904ea=await Promise[_0x26b875(0x19f)](_0xd2c50c[_0x26b875(0x302)](_0x38364c=>bcryptjs_1[_0x26b875(0x2a1)][_0x26b875(0x1ea)](_0x38364c,0xa)));return await database_1[_0x26b875(0x2a1)][_0x26b875(0x1eb)]['update']({'where':{'id':_0x2622f4},'data':{'twoFactorSecret':_0x222472[_0x26b875(0x2f4)],'backupCodes':JSON[_0x26b875(0x276)](_0x4904ea)}}),console['log'](_0x26b875(0x281)+_0x35fa3b['username']),console[_0x26b875(0x323)](_0x26b875(0x32a)+_0xd2c50c[_0x26b875(0x27a)]+_0x26b875(0x2ea)),{'secret':_0x222472[_0x26b875(0x2f4)],'qrCode':_0x328568,'manualEntryKey':_0x222472[_0x26b875(0x2f4)],'backupCodes':_0xd2c50c};}async['enable2FA'](_0x27c708,_0x5021d1){const _0x45f7b2=a48_0x2aeaec,_0x3959cc=await database_1[_0x45f7b2(0x2a1)]['shop'][_0x45f7b2(0x325)]({'where':{'id':_0x27c708},'select':{'id':!![],'username':!![],'twoFactorSecret':!![],'twoFactorEnabled':!![]}});if(!_0x3959cc)throw new Error(_0x45f7b2(0x1ee));if(!_0x3959cc['twoFactorSecret'])throw new Error('2FA\x20not\x20set\x20up.\x20Please\x20call\x20setup\x20endpoint\x20first');if(_0x3959cc[_0x45f7b2(0x1bf)])throw new Error(_0x45f7b2(0x29e));const _0x52ae12=speakeasy_1[_0x45f7b2(0x2a1)]['totp'][_0x45f7b2(0x2c1)]({'secret':_0x3959cc[_0x45f7b2(0x2a9)],'encoding':'base32','token':_0x5021d1,'window':0x2});if(!_0x52ae12)throw new Error(_0x45f7b2(0x28d));return await database_1[_0x45f7b2(0x2a1)][_0x45f7b2(0x1eb)][_0x45f7b2(0x1e8)]({'where':{'id':_0x27c708},'data':{'twoFactorEnabled':!![]}}),console[_0x45f7b2(0x323)](_0x45f7b2(0x1ec)+_0x3959cc[_0x45f7b2(0x1db)]),{'enabled':!![]};}async[a48_0x2aeaec(0x22b)](_0x311bc3){const _0x19d7ce=a48_0x2aeaec,_0x77ab21=await database_1[_0x19d7ce(0x2a1)][_0x19d7ce(0x1eb)]['findUnique']({'where':{'id':_0x311bc3},'select':{'id':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x77ab21)throw new Error(_0x19d7ce(0x1ee));await database_1['default'][_0x19d7ce(0x1eb)]['update']({'where':{'id':_0x311bc3},'data':{'twoFactorEnabled':![],'twoFactorSecret':null,'backupCodes':null}}),console[_0x19d7ce(0x323)]('ðŸ”\x202FA\x20disabled\x20for\x20shop:\x20'+_0x77ab21['username']);}[a48_0x2aeaec(0x191)](_0xeb3b9b,_0x12769f,_0x269a72){const _0x294838=a48_0x2aeaec,_0x4dbfc2=new Map(),_0x3c4fac=new Date(_0x12769f);while(_0x3c4fac<=_0x269a72){const _0x1cbfdf=_0x3c4fac[_0x294838(0x313)]()['split']('T')[0x0];_0x4dbfc2['set'](_0x1cbfdf,{'revenue':0x0,'count':0x0}),_0x3c4fac['setDate'](_0x3c4fac['getDate']()+0x1);}for(const _0xff2804 of _0xeb3b9b){const _0x30d14c=_0xff2804[_0x294838(0x2a2)][_0x294838(0x313)]()[_0x294838(0x22a)]('T')[0x0],_0x382778=_0x4dbfc2[_0x294838(0x292)](_0x30d14c);_0x382778&&(_0x382778[_0x294838(0x309)]+=0x1,_0xff2804[_0x294838(0x279)]===_0x294838(0x197)&&(_0xff2804['amountUSDT']?_0x382778[_0x294838(0x239)]+=_0xff2804[_0x294838(0x219)]:console[_0x294838(0x323)]('âš ï¸\x20Payment\x20'+_0xff2804['id']+_0x294838(0x27f))));}const _0xa52abf=[],_0x574159=[];for(const [_0x272f97,_0x39d43e]of _0x4dbfc2){_0xa52abf[_0x294838(0x296)]({'date':_0x272f97,'amount':Math[_0x294838(0x327)](_0x39d43e['revenue']*0x64)/0x64}),_0x574159[_0x294838(0x296)]({'date':_0x272f97,'count':_0x39d43e[_0x294838(0x309)]});}return{'dailyRevenue':_0xa52abf,'dailyPayments':_0x574159};}}exports['AdminService']=AdminService;