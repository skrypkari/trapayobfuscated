'use strict';const a33_0x448e3f=a33_0xe77b;(function(_0x1dde1c,_0x5c2c35){const _0x2130a4=a33_0xe77b,_0x25e3be=_0x1dde1c();while(!![]){try{const _0x4bf416=parseInt(_0x2130a4(0x2b4))/0x1*(parseInt(_0x2130a4(0x2a2))/0x2)+parseInt(_0x2130a4(0x253))/0x3+-parseInt(_0x2130a4(0x1ef))/0x4*(parseInt(_0x2130a4(0x2a8))/0x5)+-parseInt(_0x2130a4(0x22c))/0x6*(-parseInt(_0x2130a4(0x21a))/0x7)+-parseInt(_0x2130a4(0x299))/0x8+parseInt(_0x2130a4(0x23f))/0x9+-parseInt(_0x2130a4(0x225))/0xa;if(_0x4bf416===_0x5c2c35)break;else _0x25e3be['push'](_0x25e3be['shift']());}catch(_0x3b8888){_0x25e3be['push'](_0x25e3be['shift']());}}}(a33_0x490f,0x4d5eb));var __importDefault=this&&this['__importDefault']||function(_0x13f57f){const _0x4f55ae=a33_0xe77b;return _0x13f57f&&_0x13f57f[_0x4f55ae(0x203)]?_0x13f57f:{'default':_0x13f57f};};Object['defineProperty'](exports,a33_0x448e3f(0x203),{'value':!![]}),exports['AdminService']=void 0x0;const database_1=__importDefault(require(a33_0x448e3f(0x214))),currencyService_1=require(a33_0x448e3f(0x202)),userService_1=require(a33_0x448e3f(0x2a7)),telegramBotService_1=require('./telegramBotService'),gateway_1=require(a33_0x448e3f(0x2b6));class AdminService{constructor(){const _0x399f06=a33_0x448e3f;this[_0x399f06(0x276)]=new userService_1['UserService']();}['getPeriodDays'](_0x67bf7c){const _0x27a7e7=a33_0x448e3f;switch(_0x67bf7c){case'7d':return 0x7;case _0x27a7e7(0x20d):return 0x1e;case _0x27a7e7(0x2bf):return 0x5a;case'1y':return 0x16d;default:return 0x1e;}}['generateDateRange'](_0x1a4d3c,_0x21d70f){const _0x5b285d=a33_0x448e3f,_0x54f023=[],_0x21a204=new Date(_0x1a4d3c);while(_0x21a204<=_0x21d70f){_0x54f023[_0x5b285d(0x2bd)](_0x21a204['toISOString']()[_0x5b285d(0x294)]('T')[0x0]),_0x21a204[_0x5b285d(0x24a)](_0x21a204['getDate']()+0x1);}return _0x54f023;}[a33_0x448e3f(0x1fa)](_0x383b40,_0x43b7a0){const _0x8b8fb4=a33_0x448e3f;if(!_0x383b40[_0x8b8fb4(0x268)])return{'commission':0x0,'payoutDelay':0x0};try{const _0x225524=JSON['parse'](_0x383b40[_0x8b8fb4(0x268)]),_0xe30aaa=_0x43b7a0[_0x8b8fb4(0x242)](0x0)[_0x8b8fb4(0x206)]()+_0x43b7a0[_0x8b8fb4(0x218)](0x1)[_0x8b8fb4(0x1f5)]();if(_0x225524&&_0x225524[_0xe30aaa])return{'commission':_0x225524[_0xe30aaa][_0x8b8fb4(0x2af)]||0x0,'payoutDelay':_0x225524[_0xe30aaa]['payoutDelay']||0x0};}catch(_0x5a2f85){console[_0x8b8fb4(0x2ba)]('Error\x20parsing\x20gateway\x20settings:',_0x5a2f85);}return{'commission':0x0,'payoutDelay':0x0};}['isEligibleForPayout'](_0x98bd72){const _0x136825=a33_0x448e3f;if(_0x98bd72[_0x136825(0x26e)]!==_0x136825(0x288)||_0x98bd72[_0x136825(0x1f8)]||!_0x98bd72[_0x136825(0x1e6)])return![];const _0x3002d9=this[_0x136825(0x1fa)](_0x98bd72[_0x136825(0x1e4)],_0x98bd72[_0x136825(0x23e)]),_0x13b433=_0x3002d9[_0x136825(0x1f4)]*0x18*0x3c*0x3c*0x3e8,_0x15d6bc=new Date(_0x98bd72['paidAt'][_0x136825(0x2b5)]()+_0x13b433);return new Date()>_0x15d6bc;}[a33_0x448e3f(0x24e)](_0x4a7e25,_0x1eec1a){return _0x4a7e25*(0x1-_0x1eec1a/0x64);}['calculateEffectiveAmount'](_0x493f4c){const _0x5115fb=a33_0x448e3f;switch(_0x493f4c[_0x5115fb(0x26e)]){case _0x5115fb(0x288):return _0x493f4c['amount'];case'CHARGEBACK':return-(_0x493f4c[_0x5115fb(0x1e7)]||0x0);case _0x5115fb(0x1fd):return 0x0;default:return 0x0;}}async[a33_0x448e3f(0x1e8)](_0x257c33){const _0xaea334=a33_0x448e3f,{shopId:_0x59a084,amount:_0x11f9c1,network:_0xe6be0f,notes:_0x238133}=_0x257c33;console[_0xaea334(0x2c1)](_0xaea334(0x229)+_0x59a084+':\x20'+_0x11f9c1+'\x20USDT\x20via\x20'+_0xe6be0f);const _0x502d5c=await database_1['default'][_0xaea334(0x1e4)][_0xaea334(0x22e)]({'where':{'id':_0x59a084},'select':{'id':!![],'name':!![],'username':!![],'status':!![]}});if(!_0x502d5c)throw new Error(_0xaea334(0x285));if(_0x502d5c[_0xaea334(0x26e)]!==_0xaea334(0x25d))throw new Error(_0xaea334(0x236));const _0x2ee48b=await database_1[_0xaea334(0x29f)][_0xaea334(0x24d)]['create']({'data':{'shopId':_0x59a084,'amount':_0x11f9c1,'network':_0xe6be0f,'status':_0xaea334(0x1fc),'notes':_0x238133||null,'paidAt':new Date()},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});await this[_0xaea334(0x282)](_0x59a084,_0x11f9c1);try{await telegramBotService_1[_0xaea334(0x243)][_0xaea334(0x1f9)](_0x59a084,_0x2ee48b,_0xaea334(0x270));}catch(_0x56fc10){console['error'](_0xaea334(0x290),_0x56fc10);}return console['log'](_0xaea334(0x279)+_0x2ee48b['id']),{'id':_0x2ee48b['id'],'shopId':_0x2ee48b['shopId'],'shopName':_0x2ee48b['shop'][_0xaea334(0x231)],'shopUsername':_0x2ee48b[_0xaea334(0x1e4)][_0xaea334(0x1f0)],'amount':_0x2ee48b[_0xaea334(0x239)],'network':_0x2ee48b[_0xaea334(0x20a)],'status':_0x2ee48b[_0xaea334(0x26e)],'txid':_0x2ee48b[_0xaea334(0x247)],'notes':_0x2ee48b['notes'],'createdAt':_0x2ee48b[_0xaea334(0x29d)],'paidAt':_0x2ee48b['paidAt']};}async[a33_0x448e3f(0x282)](_0x3e0c07,_0x5a3db9){const _0x51d20b=a33_0x448e3f;console['log'](_0x51d20b(0x26d)+_0x3e0c07+_0x51d20b(0x204)+_0x5a3db9+'\x20USDT');const _0x2f5b30=await database_1[_0x51d20b(0x29f)]['payment'][_0x51d20b(0x2bb)]({'where':{'shopId':_0x3e0c07,'status':_0x51d20b(0x288),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'shop':{'select':{'gatewaySettings':!![]}}},'orderBy':{'paidAt':_0x51d20b(0x28a)}});let _0x5af873=_0x5a3db9;const _0x2b0a45=[];for(const _0x700377 of _0x2f5b30){const _0x501d99={..._0x700377,'status':_0x51d20b(0x288),'merchantPaid':![],'shop':{'gatewaySettings':_0x700377['shop']['gatewaySettings']}};if(!this[_0x51d20b(0x205)](_0x501d99))continue;const _0x16f82c=await currencyService_1[_0x51d20b(0x255)][_0x51d20b(0x217)](_0x700377['amount'],_0x700377['currency']),_0x318db8=this[_0x51d20b(0x1fa)](_0x700377[_0x51d20b(0x1e4)],_0x700377['gateway']),_0x1ad673=this['calculateAmountAfterCommission'](_0x16f82c,_0x318db8['commission']);if(_0x1ad673<=_0x5af873){_0x2b0a45[_0x51d20b(0x2bd)](_0x700377['id']),_0x5af873-=_0x1ad673;if(_0x5af873<=0.01)break;}}_0x2b0a45[_0x51d20b(0x25a)]>0x0&&(await database_1[_0x51d20b(0x29f)]['payment'][_0x51d20b(0x29b)]({'where':{'id':{'in':_0x2b0a45}},'data':{'merchantPaid':!![]}}),console[_0x51d20b(0x2c1)](_0x51d20b(0x2c0)+_0x2b0a45[_0x51d20b(0x25a)]+_0x51d20b(0x296)));}async[a33_0x448e3f(0x260)](_0x5dc8b3){const _0xeda05a=a33_0x448e3f,{page:_0x18bd59,limit:_0x4e4694,shopId:_0x209753,network:_0x4192e9,dateFrom:_0x23b385,dateTo:_0x227b78,search:_0x1127c8}=_0x5dc8b3,_0x158604=(_0x18bd59-0x1)*_0x4e4694;console[_0xeda05a(0x2c1)](_0xeda05a(0x29a),_0x5dc8b3);const _0x5b6089={};_0x209753&&(_0x5b6089['shopId']=_0x209753);_0x4192e9&&(_0x5b6089[_0xeda05a(0x20a)]=_0x4192e9);(_0x23b385||_0x227b78)&&(_0x5b6089[_0xeda05a(0x29d)]={},_0x23b385&&(_0x5b6089[_0xeda05a(0x29d)][_0xeda05a(0x235)]=new Date(_0x23b385)),_0x227b78&&(_0x5b6089[_0xeda05a(0x29d)][_0xeda05a(0x2a3)]=new Date(_0x227b78)));_0x1127c8&&(_0x5b6089['OR']=[{'txid':{'contains':_0x1127c8,'mode':_0xeda05a(0x22f)}},{'notes':{'contains':_0x1127c8,'mode':_0xeda05a(0x22f)}},{'shop':{'name':{'contains':_0x1127c8,'mode':_0xeda05a(0x22f)}}},{'shop':{'username':{'contains':_0x1127c8,'mode':'insensitive'}}}]);const [_0x38e269,_0x4b01b9]=await Promise[_0xeda05a(0x1f6)]([database_1[_0xeda05a(0x29f)][_0xeda05a(0x24d)][_0xeda05a(0x2bb)]({'where':_0x5b6089,'skip':_0x158604,'take':_0x4e4694,'orderBy':{'createdAt':_0xeda05a(0x221)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0xeda05a(0x29f)][_0xeda05a(0x24d)][_0xeda05a(0x2a6)]({'where':_0x5b6089})]);console['log'](_0xeda05a(0x216)+_0x38e269[_0xeda05a(0x25a)]+_0xeda05a(0x28f)+_0x4b01b9+_0xeda05a(0x2b1));const _0x1746ba=_0x38e269[_0xeda05a(0x280)](_0x41cf5b=>({'id':_0x41cf5b['id'],'shopId':_0x41cf5b[_0xeda05a(0x227)],'shopName':_0x41cf5b['shop'][_0xeda05a(0x231)],'shopUsername':_0x41cf5b[_0xeda05a(0x1e4)][_0xeda05a(0x1f0)],'amount':_0x41cf5b[_0xeda05a(0x239)],'network':_0x41cf5b[_0xeda05a(0x20a)],'status':_0x41cf5b['status'],'txid':_0x41cf5b[_0xeda05a(0x247)],'notes':_0x41cf5b[_0xeda05a(0x233)],'createdAt':_0x41cf5b[_0xeda05a(0x29d)],'paidAt':_0x41cf5b[_0xeda05a(0x1e6)]}));return{'payouts':_0x1746ba,'pagination':{'page':_0x18bd59,'limit':_0x4e4694,'total':_0x4b01b9,'totalPages':Math[_0xeda05a(0x278)](_0x4b01b9/_0x4e4694)}};}async['getPayoutById'](_0x2bacc2){const _0x8af34b=a33_0x448e3f;console['log'](_0x8af34b(0x257)+_0x2bacc2);const _0x54d312=await database_1[_0x8af34b(0x29f)][_0x8af34b(0x24d)]['findUnique']({'where':{'id':_0x2bacc2},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x54d312)return console['log'](_0x8af34b(0x20e)+_0x2bacc2),null;return console[_0x8af34b(0x2c1)]('✅\x20Found\x20payout:\x20'+_0x54d312[_0x8af34b(0x239)]+_0x8af34b(0x201)+_0x54d312[_0x8af34b(0x20a)]),{'id':_0x54d312['id'],'shopId':_0x54d312[_0x8af34b(0x227)],'shopName':_0x54d312[_0x8af34b(0x1e4)]['name'],'shopUsername':_0x54d312['shop'][_0x8af34b(0x1f0)],'amount':_0x54d312[_0x8af34b(0x239)],'network':_0x54d312['network'],'status':_0x54d312[_0x8af34b(0x26e)],'txid':_0x54d312['txid'],'notes':_0x54d312[_0x8af34b(0x233)],'createdAt':_0x54d312['createdAt'],'paidAt':_0x54d312['paidAt']};}async[a33_0x448e3f(0x259)](_0x32145f){const _0x187daa=a33_0x448e3f;console[_0x187daa(0x2c1)](_0x187daa(0x21c)+_0x32145f);const _0x21f136=await database_1[_0x187daa(0x29f)][_0x187daa(0x24d)][_0x187daa(0x22e)]({'where':{'id':_0x32145f},'select':{'id':!![],'shopId':!![],'amount':!![]}});if(!_0x21f136)throw new Error(_0x187daa(0x25c));await database_1[_0x187daa(0x29f)]['payout'][_0x187daa(0x23a)]({'where':{'id':_0x32145f}}),console['log'](_0x187daa(0x26f)+_0x32145f+_0x187daa(0x25b));}async['getMerchantsAwaitingPayout'](_0x4900ce){const _0x48a675=a33_0x448e3f,{page:_0x200220,limit:_0x14d830,minAmount:_0x2f7dd7,search:_0x2321bc}=_0x4900ce;console[_0x48a675(0x2c1)]('📋\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:',_0x4900ce);const _0x2b17be=await database_1[_0x48a675(0x29f)][_0x48a675(0x256)]['findMany']({'where':{'status':_0x48a675(0x288),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'createdAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'gatewaySettings':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}});console[_0x48a675(0x2c1)]('💰\x20Found\x20'+_0x2b17be[_0x48a675(0x25a)]+'\x20eligible\x20PAID\x20payments\x20for\x20payout\x20analysis');const _0x365d6b=new Map();for(const _0x4c0eec of _0x2b17be){const _0x5aeab0={..._0x4c0eec,'status':_0x48a675(0x288),'merchantPaid':![],'shop':{'gatewaySettings':_0x4c0eec['shop']['gatewaySettings']}},_0x4964a7=this['isEligibleForPayout'](_0x5aeab0);if(!_0x4964a7)continue;const _0x46c4ec=await currencyService_1['currencyService'][_0x48a675(0x217)](_0x4c0eec[_0x48a675(0x239)],_0x4c0eec[_0x48a675(0x23d)]),_0x3c1529=this['getGatewaySettings'](_0x4c0eec[_0x48a675(0x1e4)],_0x4c0eec[_0x48a675(0x23e)]),_0x1b18f3=this[_0x48a675(0x24e)](_0x46c4ec,_0x3c1529[_0x48a675(0x2af)]),_0x538d4d=_0x4c0eec['shopId'];!_0x365d6b['has'](_0x538d4d)&&_0x365d6b[_0x48a675(0x2b3)](_0x538d4d,{'shop':_0x4c0eec[_0x48a675(0x1e4)],'payments':[]}),_0x365d6b[_0x48a675(0x254)](_0x538d4d)[_0x48a675(0x226)]['push']({'id':_0x4c0eec['id'],'amount':_0x4c0eec[_0x48a675(0x239)],'currency':_0x4c0eec[_0x48a675(0x23d)],'gateway':_0x4c0eec[_0x48a675(0x23e)],'paidAt':_0x4c0eec[_0x48a675(0x1e6)],'createdAt':_0x4c0eec[_0x48a675(0x29d)],'amountUSDT':_0x46c4ec,'commission':_0x3c1529[_0x48a675(0x2af)],'amountAfterCommissionUSDT':_0x1b18f3,'isEligible':!![]});}console[_0x48a675(0x2c1)](_0x48a675(0x25f)+_0x365d6b[_0x48a675(0x232)]+_0x48a675(0x24f));const _0x3b576a=[];for(const [_0x429d34,_0x30d880]of _0x365d6b){const {shop:_0x48509d,payments:_0x28250c}=_0x30d880,_0x3078ff=_0x28250c[_0x48a675(0x29e)]((_0x2ae188,_0x35badf)=>_0x2ae188+_0x35badf['amountUSDT'],0x0),_0x1a9a44=_0x28250c[_0x48a675(0x29e)]((_0x4fc2d4,_0x3b6fd1)=>_0x4fc2d4+_0x3b6fd1['amountAfterCommissionUSDT'],0x0);if(_0x2f7dd7&&_0x1a9a44<_0x2f7dd7)continue;if(_0x2321bc){const _0x396a70=_0x2321bc['toLowerCase'](),_0x4b23df=_0x48509d['name'][_0x48a675(0x1f5)]()[_0x48a675(0x28d)](_0x396a70)||_0x48509d[_0x48a675(0x1f0)][_0x48a675(0x1f5)]()[_0x48a675(0x28d)](_0x396a70)||_0x48509d['telegram']&&_0x48509d[_0x48a675(0x21e)][_0x48a675(0x1f5)]()[_0x48a675(0x28d)](_0x396a70);if(!_0x4b23df)continue;}const _0x5376e4=new Map();for(const _0x17c2bb of _0x28250c){const _0x3db08d=_0x17c2bb[_0x48a675(0x23e)];!_0x5376e4[_0x48a675(0x266)](_0x3db08d)&&_0x5376e4[_0x48a675(0x2b3)](_0x3db08d,{'count':0x0,'amountUSDT':0x0,'amountAfterCommissionUSDT':0x0,'commission':_0x17c2bb[_0x48a675(0x2af)]});const _0x332447=_0x5376e4['get'](_0x3db08d);_0x332447['count']++,_0x332447[_0x48a675(0x2b2)]+=_0x17c2bb['amountUSDT'],_0x332447[_0x48a675(0x271)]+=_0x17c2bb[_0x48a675(0x271)];}const _0x453691=Array[_0x48a675(0x252)](_0x5376e4[_0x48a675(0x250)]())[_0x48a675(0x280)](([_0x9e9e3f,_0x1c5401])=>({'gateway':_0x9e9e3f[_0x48a675(0x242)](0x0)[_0x48a675(0x206)]()+_0x9e9e3f[_0x48a675(0x218)](0x1),'count':_0x1c5401[_0x48a675(0x2a6)],'amountUSDT':Math['round'](_0x1c5401[_0x48a675(0x2b2)]*0x64)/0x64,'amountAfterCommissionUSDT':Math['round'](_0x1c5401[_0x48a675(0x271)]*0x64)/0x64,'commission':_0x1c5401[_0x48a675(0x2af)]})),_0x454ce1=_0x28250c[_0x48a675(0x29e)]((_0x207db4,_0x355890)=>{return _0x355890['paidAt']<_0x207db4?_0x355890['paidAt']:_0x207db4;},_0x28250c[0x0]['paidAt']);_0x3b576a['push']({'id':_0x48509d['id'],'fullName':_0x48509d['name'],'username':_0x48509d[_0x48a675(0x1f0)],'telegramId':_0x48509d['telegram'],'merchantUrl':_0x48509d[_0x48a675(0x1f1)],'wallets':{'usdtPolygonWallet':_0x48509d[_0x48a675(0x21b)],'usdtTrcWallet':_0x48509d[_0x48a675(0x23b)],'usdtErcWallet':_0x48509d[_0x48a675(0x21d)],'usdcPolygonWallet':_0x48509d[_0x48a675(0x241)]},'totalAmountUSDT':Math[_0x48a675(0x22d)](_0x3078ff*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x1a9a44*0x64)/0x64,'paymentsCount':_0x28250c[_0x48a675(0x25a)],'oldestPaymentDate':_0x454ce1,'gatewayBreakdown':_0x453691});}_0x3b576a[_0x48a675(0x265)]((_0x1a030e,_0x3e169f)=>_0x3e169f[_0x48a675(0x277)]-_0x1a030e[_0x48a675(0x277)]);const _0x509715=_0x3b576a[_0x48a675(0x25a)],_0x52ea3e=_0x3b576a['reduce']((_0x981b01,_0xf8672a)=>_0x981b01+_0xf8672a[_0x48a675(0x291)],0x0),_0x4495e0=_0x3b576a[_0x48a675(0x29e)]((_0x837b76,_0x2d48cb)=>_0x837b76+_0x2d48cb[_0x48a675(0x277)],0x0),_0x1b9a58=(_0x200220-0x1)*_0x14d830,_0x3f6b78=_0x3b576a[_0x48a675(0x218)](_0x1b9a58,_0x1b9a58+_0x14d830);return console[_0x48a675(0x2c1)](_0x48a675(0x269)+_0x3f6b78['length']+_0x48a675(0x223)+_0x509715+_0x48a675(0x2b1)),console['log'](_0x48a675(0x295)+_0x52ea3e['toFixed'](0x2)+_0x48a675(0x21f)+_0x4495e0[_0x48a675(0x2a5)](0x2)+_0x48a675(0x2a0)),{'merchants':_0x3f6b78,'pagination':{'page':_0x200220,'limit':_0x14d830,'total':_0x509715,'totalPages':Math['ceil'](_0x509715/_0x14d830)},'summary':{'totalMerchants':_0x509715,'totalAmountUSDT':Math[_0x48a675(0x22d)](_0x52ea3e*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x48a675(0x22d)](_0x4495e0*0x64)/0x64}};}async[a33_0x448e3f(0x20c)](){const _0x1deda7=a33_0x448e3f;console['log'](_0x1deda7(0x27f));const _0x53acfc=await database_1['default'][_0x1deda7(0x256)][_0x1deda7(0x2bb)]({'where':{'status':{'in':['PAID',_0x1deda7(0x1fd),_0x1deda7(0x2bc)]}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'status':!![],'gateway':!![],'paidAt':!![],'merchantPaid':!![],'createdAt':!![],'chargebackAmount':!![],'shop':{'select':{'gatewaySettings':!![]}}}});console[_0x1deda7(0x2c1)](_0x1deda7(0x261)+_0x53acfc['length']+'\x20payments\x20for\x20analysis\x20(PAID/REFUND/CHARGEBACK)');const _0x1e6387=new Date(),_0x558b2c=new Date(_0x1e6387[_0x1deda7(0x26a)](),_0x1e6387['getMonth'](),0x1),_0x44fd09=new Date(_0x1e6387['getFullYear'](),_0x1e6387[_0x1deda7(0x275)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7);let _0x546b6c=0x0,_0x1eb1a7=0x0,_0x2b9e21=0x0,_0x551282=0x0;for(const _0x2a0674 of _0x53acfc){const _0x4e7a7a=this[_0x1deda7(0x2aa)](_0x2a0674);if(_0x4e7a7a===0x0)continue;let _0x448c80,_0x37fc94;if(_0x2a0674[_0x1deda7(0x26e)]===_0x1deda7(0x2bc))_0x448c80=Math[_0x1deda7(0x25e)](_0x4e7a7a),_0x37fc94=-_0x448c80;else{_0x448c80=await currencyService_1[_0x1deda7(0x255)][_0x1deda7(0x217)](_0x2a0674['amount'],_0x2a0674[_0x1deda7(0x23d)]);const _0x1892bc=this[_0x1deda7(0x1fa)](_0x2a0674[_0x1deda7(0x1e4)],_0x2a0674[_0x1deda7(0x23e)]);_0x37fc94=this['calculateAmountAfterCommission'](_0x448c80,_0x1892bc[_0x1deda7(0x2af)]);}_0x2a0674[_0x1deda7(0x1f8)]&&(_0x546b6c+=_0x37fc94,_0x2a0674[_0x1deda7(0x1e6)]&&_0x2a0674[_0x1deda7(0x1e6)]>=_0x558b2c&&_0x2a0674['paidAt']<=_0x44fd09&&(_0x2b9e21+=_0x37fc94)),_0x2a0674[_0x1deda7(0x26e)]==='PAID'&&this[_0x1deda7(0x205)](_0x2a0674)&&(_0x1eb1a7+=_0x37fc94,_0x551282+=_0x448c80);}const _0x6ffcbe={'totalPayout':Math[_0x1deda7(0x22d)](_0x546b6c*0x64)/0x64,'awaitingPayout':Math['round'](_0x1eb1a7*0x64)/0x64,'thisMonth':Math[_0x1deda7(0x22d)](_0x2b9e21*0x64)/0x64,'availableBalance':Math['round'](_0x551282*0x64)/0x64};return console[_0x1deda7(0x2c1)](_0x1deda7(0x27e)),console[_0x1deda7(0x2c1)](_0x1deda7(0x26c)+_0x6ffcbe[_0x1deda7(0x273)]+_0x1deda7(0x281)),console['log'](_0x1deda7(0x2b7)+_0x6ffcbe[_0x1deda7(0x1f3)]+_0x1deda7(0x1e3)),console[_0x1deda7(0x2c1)](_0x1deda7(0x2be)+_0x6ffcbe[_0x1deda7(0x209)]+_0x1deda7(0x248)),console[_0x1deda7(0x2c1)](_0x1deda7(0x1e9)+_0x6ffcbe[_0x1deda7(0x1ee)]+_0x1deda7(0x248)),_0x6ffcbe;}async[a33_0x448e3f(0x22b)](_0x565127){const _0x1db605=a33_0x448e3f,_0x409d87=this[_0x1db605(0x237)](_0x565127),_0x1ce815=new Date();_0x1ce815[_0x1db605(0x24a)](_0x1ce815[_0x1db605(0x224)]()-_0x409d87),console[_0x1db605(0x2c1)](_0x1db605(0x27b)+_0x565127+'\x20('+_0x409d87+_0x1db605(0x287));const _0xfaaa4b=await database_1[_0x1db605(0x29f)][_0x1db605(0x1e4)][_0x1db605(0x2a6)]({'where':{'status':_0x1db605(0x25d)}}),_0x37230e=await database_1[_0x1db605(0x29f)][_0x1db605(0x256)][_0x1db605(0x2a6)](),_0x5db623=await database_1[_0x1db605(0x29f)]['payment'][_0x1db605(0x2bb)]({'where':{'status':{'in':[_0x1db605(0x288),_0x1db605(0x1fd),'CHARGEBACK']}},'select':{'amount':!![],'currency':!![],'status':!![],'chargebackAmount':!![],'createdAt':!![]}});console[_0x1db605(0x2c1)](_0x1db605(0x261)+_0x5db623[_0x1db605(0x25a)]+_0x1db605(0x286));const _0x2e1071=await Promise['all'](_0x5db623['map'](async _0x338ac2=>{const _0x1253b4=_0x1db605,_0x1ed11c=this[_0x1253b4(0x2aa)](_0x338ac2);if(_0x1ed11c===0x0)return{'amount':0x0,'createdAt':_0x338ac2['createdAt']};let _0x3a7d7b;return _0x338ac2[_0x1253b4(0x26e)]===_0x1253b4(0x2bc)?_0x3a7d7b=-Math[_0x1253b4(0x25e)](_0x1ed11c):_0x3a7d7b=await currencyService_1['currencyService'][_0x1253b4(0x217)](_0x338ac2[_0x1253b4(0x239)],_0x338ac2[_0x1253b4(0x23d)]),{'amount':_0x3a7d7b,'createdAt':_0x338ac2[_0x1253b4(0x29d)]};})),_0x18f589=_0x2e1071[_0x1db605(0x29e)]((_0x3befc2,_0x5414df)=>_0x3befc2+_0x5414df[_0x1db605(0x239)],0x0),_0x154c5c=_0x37230e>0x0?_0x18f589/_0x37230e:0x0;console[_0x1db605(0x2c1)]('💵\x20Total\x20revenue:\x20'+_0x18f589['toFixed'](0x2)+'\x20USDT\x20(включая\x20штрафы\x20chargeback)'),console['log'](_0x1db605(0x2b0)+_0x154c5c['toFixed'](0x2)+_0x1db605(0x248));const _0x254025=await database_1[_0x1db605(0x29f)]['$queryRaw']`
      SELECT 
        DATE(created_at) as date,
        array_agg(
          json_build_object(
            'amount', amount,
            'currency', currency,
            'status', status,
            'chargeback_amount', chargeback_amount
          )
        ) as payments
      FROM payments 
      WHERE created_at >= ${_0x1ce815}
        AND status IN ('PAID', 'REFUND', 'CHARGEBACK')
      GROUP BY DATE(created_at)
      ORDER BY date ASC
    `;console[_0x1db605(0x2c1)](_0x1db605(0x211)+_0x254025[_0x1db605(0x25a)]+_0x1db605(0x289));const _0x199288=await Promise[_0x1db605(0x1f6)](_0x254025[_0x1db605(0x280)](async _0x2e2eaa=>{const _0x47f935=_0x1db605,_0x1db863=await Promise[_0x47f935(0x1f6)](_0x2e2eaa[_0x47f935(0x226)][_0x47f935(0x280)](async _0xb930a5=>{const _0x585de3=_0x47f935,_0x45ee2=this[_0x585de3(0x2aa)](_0xb930a5);if(_0x45ee2===0x0)return 0x0;return _0xb930a5['status']===_0x585de3(0x2bc)?-Math[_0x585de3(0x25e)](_0x45ee2):await currencyService_1[_0x585de3(0x255)][_0x585de3(0x217)](_0xb930a5[_0x585de3(0x239)],_0xb930a5[_0x585de3(0x23d)]);})),_0x5a2f2f=_0x1db863[_0x47f935(0x29e)]((_0x51a138,_0x13e318)=>_0x51a138+_0x13e318,0x0);return{'date':_0x2e2eaa[_0x47f935(0x222)][_0x47f935(0x246)]()[_0x47f935(0x294)]('T')[0x0],'amount':_0x5a2f2f};})),_0x27dcfe=this[_0x1db605(0x213)](_0x1ce815,new Date()),_0x5e12b0=new Map(_0x199288[_0x1db605(0x280)](_0x2518ad=>[_0x2518ad['date'],_0x2518ad['amount']])),_0x57aba8=_0x27dcfe[_0x1db605(0x280)](_0x117f13=>({'date':_0x117f13,'amount':_0x5e12b0['get'](_0x117f13)||0x0}));return console[_0x1db605(0x2c1)](_0x1db605(0x220)),console['log']('👥\x20Total\x20users:\x20'+_0xfaaa4b),console['log'](_0x1db605(0x219)+_0x37230e),console['log'](_0x1db605(0x297)+_0x57aba8['length']),{'totalRevenue':Math[_0x1db605(0x22d)](_0x18f589*0x64)/0x64,'totalUsers':_0xfaaa4b,'totalPayments':_0x37230e,'averagePayment':Math[_0x1db605(0x22d)](_0x154c5c*0x64)/0x64,'dailyRevenue':_0x57aba8};}async[a33_0x448e3f(0x298)](_0x41c468){const _0x152d08=a33_0x448e3f,{page:_0x27aadf,limit:_0x3ade19,status:_0x3dbd23,gateway:_0x2eb76a,shopId:_0x5b8323,dateFrom:_0xc419e,dateTo:_0x4b8284,search:_0x5364be}=_0x41c468,_0x2ffcf1=(_0x27aadf-0x1)*_0x3ade19;console[_0x152d08(0x2c1)](_0x152d08(0x29c),_0x41c468);const _0x5d0aab={};_0x3dbd23&&(_0x5d0aab['status']=_0x3dbd23[_0x152d08(0x206)]());if(_0x2eb76a){if((0x0,gateway_1[_0x152d08(0x28c)])(_0x2eb76a)){const _0x1fd3f2=(0x0,gateway_1[_0x152d08(0x2c2)])(_0x2eb76a);_0x1fd3f2&&(_0x5d0aab[_0x152d08(0x23e)]=_0x1fd3f2);}else _0x5d0aab['gateway']=_0x2eb76a['toLowerCase']();}_0x5b8323&&(_0x5d0aab[_0x152d08(0x227)]=_0x5b8323);(_0xc419e||_0x4b8284)&&(_0x5d0aab[_0x152d08(0x29d)]={},_0xc419e&&(_0x5d0aab[_0x152d08(0x29d)][_0x152d08(0x235)]=new Date(_0xc419e)),_0x4b8284&&(_0x5d0aab[_0x152d08(0x29d)][_0x152d08(0x2a3)]=new Date(_0x4b8284)));_0x5364be&&(_0x5d0aab['OR']=[{'orderId':{'contains':_0x5364be,'mode':_0x152d08(0x22f)}},{'gatewayOrderId':{'contains':_0x5364be,'mode':_0x152d08(0x22f)}},{'gatewayPaymentId':{'contains':_0x5364be,'mode':_0x152d08(0x22f)}},{'customerEmail':{'contains':_0x5364be,'mode':_0x152d08(0x22f)}},{'customerName':{'contains':_0x5364be,'mode':_0x152d08(0x22f)}},{'shop':{'name':{'contains':_0x5364be,'mode':_0x152d08(0x22f)}}},{'shop':{'username':{'contains':_0x5364be,'mode':_0x152d08(0x22f)}}}]);const [_0x228f76,_0x4a11d9]=await Promise[_0x152d08(0x1f6)]([database_1['default'][_0x152d08(0x256)][_0x152d08(0x2bb)]({'where':_0x5d0aab,'skip':_0x2ffcf1,'take':_0x3ade19,'orderBy':{'createdAt':_0x152d08(0x221)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default'][_0x152d08(0x256)][_0x152d08(0x2a6)]({'where':_0x5d0aab})]);console[_0x152d08(0x2c1)](_0x152d08(0x216)+_0x228f76['length']+'\x20payments\x20out\x20of\x20'+_0x4a11d9+_0x152d08(0x2b1));const _0x35086f=_0x228f76[_0x152d08(0x280)](_0x3b8467=>({'id':_0x3b8467['id'],'shopId':_0x3b8467['shopId'],'shopName':_0x3b8467[_0x152d08(0x1e4)]['name'],'shopUsername':_0x3b8467[_0x152d08(0x1e4)][_0x152d08(0x1f0)],'gateway':_0x3b8467[_0x152d08(0x23e)],'orderId':_0x3b8467[_0x152d08(0x23c)],'gatewayOrderId':_0x3b8467[_0x152d08(0x263)],'amount':_0x3b8467[_0x152d08(0x239)],'currency':_0x3b8467[_0x152d08(0x23d)],'sourceCurrency':_0x3b8467['sourceCurrency'],'status':_0x3b8467[_0x152d08(0x26e)],'usage':_0x3b8467[_0x152d08(0x2ac)],'externalPaymentUrl':_0x3b8467['externalPaymentUrl'],'gatewayPaymentId':_0x3b8467[_0x152d08(0x1f2)],'customerEmail':_0x3b8467['customerEmail'],'customerName':_0x3b8467[_0x152d08(0x208)],'cardLast4':_0x3b8467[_0x152d08(0x1ed)],'paymentMethod':_0x3b8467[_0x152d08(0x28b)],'bankId':_0x3b8467[_0x152d08(0x27d)],'remitterIban':_0x3b8467[_0x152d08(0x210)],'remitterName':_0x3b8467[_0x152d08(0x283)],'chargebackAmount':_0x3b8467[_0x152d08(0x1e7)],'adminNotes':_0x3b8467[_0x152d08(0x1e5)],'statusChangedBy':_0x3b8467[_0x152d08(0x1ec)],'statusChangedAt':_0x3b8467[_0x152d08(0x2b9)],'createdAt':_0x3b8467[_0x152d08(0x29d)],'updatedAt':_0x3b8467[_0x152d08(0x24c)],'expiresAt':_0x3b8467[_0x152d08(0x262)]}));return{'payments':_0x35086f,'pagination':{'page':_0x27aadf,'limit':_0x3ade19,'total':_0x4a11d9,'totalPages':Math['ceil'](_0x4a11d9/_0x3ade19)}};}async[a33_0x448e3f(0x264)](_0x2c2107){const _0x5085e4=a33_0x448e3f;console[_0x5085e4(0x2c1)](_0x5085e4(0x2ae)+_0x2c2107);const _0x2ba6ce=await database_1['default'][_0x5085e4(0x256)][_0x5085e4(0x22e)]({'where':{'id':_0x2c2107},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}},'webhookLogs':{'orderBy':{'createdAt':_0x5085e4(0x221)},'take':0xa,'select':{'id':!![],'event':!![],'statusCode':!![],'retryCount':!![],'createdAt':!![]}}}});if(!_0x2ba6ce)return console['log'](_0x5085e4(0x1f7)+_0x2c2107),null;return console[_0x5085e4(0x2c1)]('✅\x20Found\x20payment:\x20'+_0x2ba6ce[_0x5085e4(0x23c)]+'\x20('+_0x2ba6ce[_0x5085e4(0x26e)]+')'),{'id':_0x2ba6ce['id'],'shopId':_0x2ba6ce[_0x5085e4(0x227)],'shopName':_0x2ba6ce[_0x5085e4(0x1e4)]['name'],'shopUsername':_0x2ba6ce[_0x5085e4(0x1e4)]['username'],'gateway':_0x2ba6ce[_0x5085e4(0x23e)],'orderId':_0x2ba6ce[_0x5085e4(0x23c)],'gatewayOrderId':_0x2ba6ce[_0x5085e4(0x263)],'amount':_0x2ba6ce[_0x5085e4(0x239)],'currency':_0x2ba6ce[_0x5085e4(0x23d)],'sourceCurrency':_0x2ba6ce[_0x5085e4(0x27c)],'status':_0x2ba6ce['status'],'usage':_0x2ba6ce[_0x5085e4(0x2ac)],'externalPaymentUrl':_0x2ba6ce['externalPaymentUrl'],'gatewayPaymentId':_0x2ba6ce[_0x5085e4(0x1f2)],'customerEmail':_0x2ba6ce[_0x5085e4(0x238)],'customerName':_0x2ba6ce[_0x5085e4(0x208)],'cardLast4':_0x2ba6ce['cardLast4'],'paymentMethod':_0x2ba6ce[_0x5085e4(0x28b)],'bankId':_0x2ba6ce['bankId'],'remitterIban':_0x2ba6ce[_0x5085e4(0x210)],'remitterName':_0x2ba6ce[_0x5085e4(0x283)],'chargebackAmount':_0x2ba6ce[_0x5085e4(0x1e7)],'adminNotes':_0x2ba6ce[_0x5085e4(0x1e5)],'statusChangedBy':_0x2ba6ce[_0x5085e4(0x1ec)],'statusChangedAt':_0x2ba6ce[_0x5085e4(0x2b9)],'createdAt':_0x2ba6ce[_0x5085e4(0x29d)],'updatedAt':_0x2ba6ce[_0x5085e4(0x24c)],'expiresAt':_0x2ba6ce[_0x5085e4(0x262)],'webhookLogs':_0x2ba6ce[_0x5085e4(0x2a4)]};}async['updatePaymentStatus'](_0x5e3fdd,_0xe8774e,_0x3b8926,_0x5d56af){const _0x1c9a2b=a33_0x448e3f;console[_0x1c9a2b(0x2c1)](_0x1c9a2b(0x207)+_0x5e3fdd+_0x1c9a2b(0x1fe)+_0xe8774e);const _0xf0be50=['PENDING',_0x1c9a2b(0x258),_0x1c9a2b(0x288),_0x1c9a2b(0x267),_0x1c9a2b(0x230),_0x1c9a2b(0x1fd),_0x1c9a2b(0x2bc)];if(!_0xf0be50['includes'](_0xe8774e['toUpperCase']()))throw new Error(_0x1c9a2b(0x2a1)+_0xf0be50[_0x1c9a2b(0x2c3)](',\x20'));const _0x2f9087=await database_1[_0x1c9a2b(0x29f)][_0x1c9a2b(0x256)][_0x1c9a2b(0x22e)]({'where':{'id':_0x5e3fdd},'select':{'id':!![],'status':!![],'orderId':!![]}});if(!_0x2f9087)throw new Error(_0x1c9a2b(0x284));if(_0xe8774e['toUpperCase']()===_0x1c9a2b(0x2bc)){if(!_0x5d56af||_0x5d56af<=0x0)throw new Error(_0x1c9a2b(0x1eb));console[_0x1c9a2b(0x2c1)](_0x1c9a2b(0x1ea)+_0x5d56af+_0x1c9a2b(0x212));}const _0x2e03f9={'status':_0xe8774e[_0x1c9a2b(0x206)](),'updatedAt':new Date()};_0x3b8926&&(_0x2e03f9['adminNotes']=_0x3b8926);_0xe8774e[_0x1c9a2b(0x206)]()===_0x1c9a2b(0x2bc)&&_0x5d56af&&(_0x2e03f9[_0x1c9a2b(0x1e7)]=_0x5d56af);const _0xe43d87=await database_1[_0x1c9a2b(0x29f)][_0x1c9a2b(0x256)][_0x1c9a2b(0x28e)]({'where':{'id':_0x5e3fdd},'data':_0x2e03f9,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});return await database_1['default'][_0x1c9a2b(0x293)]['create']({'data':{'paymentId':_0x5e3fdd,'shopId':_0xe43d87[_0x1c9a2b(0x227)],'event':_0x1c9a2b(0x200),'statusCode':0xc8,'responseBody':JSON[_0x1c9a2b(0x228)]({'oldStatus':_0x2f9087['status'],'newStatus':_0xe8774e['toUpperCase'](),'notes':_0x3b8926||null,'chargebackAmount':_0x5d56af||null,'timestamp':new Date()[_0x1c9a2b(0x246)]()})}}),console[_0x1c9a2b(0x2c1)](_0x1c9a2b(0x1ff)+_0x2f9087[_0x1c9a2b(0x23c)]+_0x1c9a2b(0x2a9)+_0x2f9087[_0x1c9a2b(0x26e)]+_0x1c9a2b(0x244)+_0xe8774e[_0x1c9a2b(0x206)]()),_0xe8774e['toUpperCase']()===_0x1c9a2b(0x2bc)&&console[_0x1c9a2b(0x2c1)](_0x1c9a2b(0x27a)+_0x5d56af+_0x1c9a2b(0x249)),{'id':_0xe43d87['id'],'shopId':_0xe43d87[_0x1c9a2b(0x227)],'shopName':_0xe43d87['shop'][_0x1c9a2b(0x231)],'shopUsername':_0xe43d87[_0x1c9a2b(0x1e4)][_0x1c9a2b(0x1f0)],'gateway':_0xe43d87[_0x1c9a2b(0x23e)],'orderId':_0xe43d87['orderId'],'gatewayOrderId':_0xe43d87['gatewayOrderId'],'amount':_0xe43d87[_0x1c9a2b(0x239)],'currency':_0xe43d87[_0x1c9a2b(0x23d)],'sourceCurrency':_0xe43d87[_0x1c9a2b(0x27c)],'status':_0xe43d87[_0x1c9a2b(0x26e)],'usage':_0xe43d87['usage'],'externalPaymentUrl':_0xe43d87[_0x1c9a2b(0x24b)],'gatewayPaymentId':_0xe43d87[_0x1c9a2b(0x1f2)],'customerEmail':_0xe43d87[_0x1c9a2b(0x238)],'customerName':_0xe43d87[_0x1c9a2b(0x208)],'cardLast4':_0xe43d87[_0x1c9a2b(0x1ed)],'paymentMethod':_0xe43d87[_0x1c9a2b(0x28b)],'bankId':_0xe43d87[_0x1c9a2b(0x27d)],'remitterIban':_0xe43d87[_0x1c9a2b(0x210)],'remitterName':_0xe43d87[_0x1c9a2b(0x283)],'chargebackAmount':_0xe43d87[_0x1c9a2b(0x1e7)],'adminNotes':_0xe43d87['adminNotes'],'statusChangedBy':_0xe43d87['statusChangedBy'],'statusChangedAt':_0xe43d87['statusChangedAt'],'createdAt':_0xe43d87[_0x1c9a2b(0x29d)],'updatedAt':_0xe43d87[_0x1c9a2b(0x24c)],'expiresAt':_0xe43d87['expiresAt']};}async['getAllUsers'](_0x67baeb){const _0x2f3c41=a33_0x448e3f,{page:_0x3d9e91,limit:_0x27b0d4,status:_0x1d2f24}=_0x67baeb,_0x571f05=(_0x3d9e91-0x1)*_0x27b0d4,_0x4578b3={};_0x1d2f24&&(_0x4578b3[_0x2f3c41(0x26e)]=_0x1d2f24[_0x2f3c41(0x206)]());console[_0x2f3c41(0x2c1)]('📋\x20Getting\x20users\x20with\x20filters:',{'page':_0x3d9e91,'limit':_0x27b0d4,'status':_0x1d2f24,'where':_0x4578b3});const [_0x43fd9b,_0x41c027]=await Promise[_0x2f3c41(0x1f6)]([database_1[_0x2f3c41(0x29f)][_0x2f3c41(0x1e4)][_0x2f3c41(0x2bb)]({'where':_0x4578b3,'skip':_0x571f05,'take':_0x27b0d4,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x2f3c41(0x221)}}),database_1['default']['shop'][_0x2f3c41(0x2a6)]({'where':_0x4578b3})]);console[_0x2f3c41(0x2c1)](_0x2f3c41(0x216)+_0x43fd9b[_0x2f3c41(0x25a)]+_0x2f3c41(0x20f)+_0x41c027+_0x2f3c41(0x2b1));const _0xaf384=_0x43fd9b[_0x2f3c41(0x280)](_0x134f7c=>({'id':_0x134f7c['id'],'fullName':_0x134f7c[_0x2f3c41(0x231)],'username':_0x134f7c[_0x2f3c41(0x1f0)],'telegramId':_0x134f7c[_0x2f3c41(0x21e)],'merchantUrl':_0x134f7c[_0x2f3c41(0x1f1)],'gateways':_0x134f7c[_0x2f3c41(0x2ab)]?JSON[_0x2f3c41(0x292)](_0x134f7c[_0x2f3c41(0x2ab)]):null,'gatewaySettings':_0x134f7c[_0x2f3c41(0x268)]?JSON[_0x2f3c41(0x292)](_0x134f7c[_0x2f3c41(0x268)]):null,'publicKey':_0x134f7c[_0x2f3c41(0x2ad)],'wallets':{'usdtPolygonWallet':_0x134f7c[_0x2f3c41(0x21b)],'usdtTrcWallet':_0x134f7c['usdtTrcWallet'],'usdtErcWallet':_0x134f7c[_0x2f3c41(0x21d)],'usdcPolygonWallet':_0x134f7c[_0x2f3c41(0x241)]},'status':_0x134f7c[_0x2f3c41(0x26e)],'createdAt':_0x134f7c[_0x2f3c41(0x29d)]}));return{'users':_0xaf384,'pagination':{'page':_0x3d9e91,'limit':_0x27b0d4,'total':_0x41c027,'totalPages':Math[_0x2f3c41(0x278)](_0x41c027/_0x27b0d4)}};}async[a33_0x448e3f(0x245)](_0x33dffd){const _0x5da4ef=a33_0x448e3f;return await this[_0x5da4ef(0x276)][_0x5da4ef(0x245)](_0x33dffd);}async[a33_0x448e3f(0x234)](_0x4a42c8){const _0xca4a8a=a33_0x448e3f;return await this[_0xca4a8a(0x276)][_0xca4a8a(0x234)](_0x4a42c8);}async[a33_0x448e3f(0x1fb)](_0x57da73,_0x71667d){const _0x4a966b=a33_0x448e3f;return await this[_0x4a966b(0x276)][_0x4a966b(0x1fb)](_0x57da73,_0x71667d);}async[a33_0x448e3f(0x215)](_0x3ee2e6){const _0x3778b1=a33_0x448e3f;return await this[_0x3778b1(0x276)][_0x3778b1(0x215)](_0x3ee2e6);}async[a33_0x448e3f(0x240)](_0x271e94){const _0x5dbf9d=a33_0x448e3f;console[_0x5dbf9d(0x2c1)]('🚫\x20Suspending\x20user:\x20'+_0x271e94);const _0x3981cc=await database_1[_0x5dbf9d(0x29f)][_0x5dbf9d(0x1e4)]['findUnique']({'where':{'id':_0x271e94},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x3981cc)throw new Error('User\x20not\x20found');if(_0x3981cc['status']===_0x5dbf9d(0x274))throw new Error('User\x20is\x20already\x20suspended');const _0x549a6c=await this[_0x5dbf9d(0x276)][_0x5dbf9d(0x1fb)](_0x271e94,{'status':'SUSPENDED'});return console[_0x5dbf9d(0x2c1)]('✅\x20User\x20'+_0x3981cc['username']+_0x5dbf9d(0x2b8)),_0x549a6c;}async[a33_0x448e3f(0x20b)](_0x5008ad){const _0x45ae89=a33_0x448e3f;console[_0x45ae89(0x2c1)](_0x45ae89(0x251)+_0x5008ad);const _0x43010e=await database_1['default'][_0x45ae89(0x1e4)]['findUnique']({'where':{'id':_0x5008ad},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x43010e)throw new Error(_0x45ae89(0x22a));if(_0x43010e[_0x45ae89(0x26e)]===_0x45ae89(0x25d))throw new Error('User\x20is\x20already\x20active');const _0x2adf31=await this['userService'][_0x45ae89(0x1fb)](_0x5008ad,{'status':_0x45ae89(0x25d)});return console['log'](_0x45ae89(0x26b)+_0x43010e[_0x45ae89(0x1f0)]+_0x45ae89(0x272)),_0x2adf31;}}function a33_0xe77b(_0x4e9fb4,_0x5420f8){const _0x490ff8=a33_0x490f();return a33_0xe77b=function(_0xe77ba1,_0x5349e1){_0xe77ba1=_0xe77ba1-0x1e3;let _0x2d74ee=_0x490ff8[_0xe77ba1];return _0x2d74ee;},a33_0xe77b(_0x4e9fb4,_0x5420f8);}exports['AdminService']=AdminService;function a33_0x490f(){const _0x189dd3=['📊\x20Found\x20','convertToUSDT','slice','💳\x20Total\x20payments:\x20','7TlpTEP','usdtPolygonWallet','🗑️\x20Deleting\x20payout:\x20','usdtErcWallet','telegram','\x20USDT\x20(','✅\x20Admin\x20statistics\x20generated\x20successfully','desc','date','\x20merchants\x20out\x20of\x20','getDate','5978290PMGFqF','payments','shopId','stringify','💸\x20Creating\x20payout\x20for\x20shop\x20','User\x20not\x20found','getSystemStatistics','3610434ZWhxgx','round','findUnique','insensitive','FAILED','name','size','notes','createUser','gte','Shop\x20is\x20not\x20active','getPeriodDays','customerEmail','amount','delete','usdtTrcWallet','orderId','currency','gateway','2502135UVuhlk','suspendUser','usdcPolygonWallet','charAt','telegramBotService','\x20to\x20','getUserById','toISOString','txid','\x20USDT','\x20USDT\x20(will\x20be\x20deducted\x20from\x20merchant\x20balance)','setDate','externalPaymentUrl','updatedAt','payout','calculateAmountAfterCommission','\x20merchants\x20with\x20eligible\x20PAID\x20payments','entries','✅\x20Activating\x20user:\x20','from','1573992mNsKmu','get','currencyService','payment','🔍\x20Getting\x20payout\x20by\x20ID:\x20','PROCESSING','deletePayout','length','\x20deleted\x20successfully','Payout\x20not\x20found','ACTIVE','abs','🏪\x20Found\x20','getAllPayouts','💰\x20Found\x20','expiresAt','gatewayOrderId','getPaymentById','sort','has','EXPIRED','gatewaySettings','✅\x20Returning\x20','getFullYear','✅\x20User\x20','💸\x20Total\x20Payout:\x20','🔄\x20Marking\x20payments\x20as\x20paid\x20out\x20for\x20shop\x20','status','✅\x20Payout\x20','completed','amountAfterCommissionUSDT','\x20activated\x20successfully','totalPayout','SUSPENDED','getMonth','userService','totalAmountAfterCommissionUSDT','ceil','✅\x20Payout\x20created\x20successfully:\x20','💸\x20Chargeback\x20penalty:\x20','📊\x20Generating\x20admin\x20statistics\x20for\x20period:\x20','sourceCurrency','bankId','✅\x20Payout\x20statistics\x20calculated:','📊\x20Calculating\x20admin\x20payout\x20statistics...','map','\x20USDT\x20(включая\x20штрафы\x20chargeback)','markPaymentsAsPaidOut','remitterName','Payment\x20not\x20found','Shop\x20not\x20found','\x20payments\x20for\x20revenue\x20calculation\x20(PAID/REFUND/CHARGEBACK)','\x20days)','PAID','\x20days','asc','paymentMethod','isValidGatewayId','includes','update','\x20payouts\x20out\x20of\x20','Failed\x20to\x20send\x20Telegram\x20payout\x20notification:','totalAmountUSDT','parse','webhookLog','split','💰\x20Total\x20amount:\x20','\x20payments\x20as\x20paid\x20out','📊\x20Daily\x20revenue\x20entries:\x20','getAllPayments','1726040UzzlWa','📋\x20Getting\x20payouts\x20with\x20filters:','updateMany','📋\x20Getting\x20payments\x20with\x20filters:','createdAt','reduce','default','\x20USDT\x20after\x20commission)','Invalid\x20status.\x20Valid\x20statuses:\x20','140134KZzgtG','lte','webhookLogs','toFixed','count','./userService','2770975YttINL','\x20status\x20updated\x20from\x20','calculateEffectiveAmount','paymentGateways','usage','publicKey','🔍\x20Getting\x20payment\x20by\x20ID:\x20','commission','📈\x20Average\x20payment:\x20','\x20total','amountUSDT','set','4jSAXGR','getTime','../types/gateway','⏳\x20Awaiting\x20Payout:\x20','\x20suspended\x20successfully','statusChangedAt','error','findMany','CHARGEBACK','push','📅\x20This\x20Month:\x20','90d','✅\x20Marked\x20','log','getGatewayNameById','join','\x20USDT\x20(только\x20PAID\x20платежи)','shop','adminNotes','paidAt','chargebackAmount','createPayout','💰\x20Available\x20Balance:\x20','💸\x20Chargeback\x20amount:\x20','Chargeback\x20amount\x20is\x20required\x20and\x20must\x20be\x20positive\x20(amount\x20in\x20USDT)','statusChangedBy','cardLast4','availableBalance','4ZGQQBf','username','shopUrl','gatewayPaymentId','awaitingPayout','payoutDelay','toLowerCase','all','❌\x20Payment\x20not\x20found:\x20','merchantPaid','sendPayoutNotification','getGatewaySettings','updateUser','COMPLETED','REFUND','\x20status\x20to:\x20','✅\x20Payment\x20','status_update','\x20USDT\x20via\x20','./currencyService','__esModule',',\x20amount:\x20','isEligibleForPayout','toUpperCase','🔄\x20Updating\x20payment\x20','customerName','thisMonth','network','activateUser','getPayoutStats','30d','❌\x20Payout\x20not\x20found:\x20','\x20users\x20out\x20of\x20','remitterIban','📅\x20Processing\x20daily\x20stats\x20for\x20','\x20USDT\x20(penalty\x20amount)','generateDateRange','../config/database','deleteUser'];a33_0x490f=function(){return _0x189dd3;};return a33_0x490f();}