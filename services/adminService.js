'use strict';const a46_0x36f641=a46_0x4b21;function a46_0x4e20(){const _0x4040bf=['asc','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','../config/database','all','ðŸ”„\x20Converted\x20gateway\x20ID\x20\x27','5WETFQl','getMerchantsAwaitingPayout','ðŸ“…\x20Date\x20from\x20filter:\x20','%\x20commission)','PENDING','ðŸ“Š\x20Merchants\x20with\x20rounded\x20balance\x20!=\x200.00:\x20','_sum','not\x20set','createUser','ceil','./currencyService','hex','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','\x20balance\x20updated:\x20','ðŸ“Š\x20Sorting\x20payments\x20by\x20','telegramId','name','2020-01-01','\x20status:\x20','notes','commission','\x20\x20\x20ðŸ’°\x20Total\x20payments\x20turnover:\x20','replace','gatewayEarnings','date','shopId','\x27\x20->\x20ID\x20\x27','ðŸ”„\x20Gateway\x20mapping\x20(get):','admin','getUTCDate','createdAt','Test\x20Gateway','polygon_usdc','sendPayoutNotification','cointopay2','\x20\x20\x20Full\x20amount:\x20','\x20\x20\x20Final\x20payout\x20amount\x20used:\x20','totalAmountAfterCommissionUSDT','availableBalance','values','orderId','whiteUrl','count','Username\x20already\x20exists','toLocaleDateString','setDate','ðŸ“Š\x20Available\x20gateways\x20in\x20database:','externalPaymentUrl','insensitive','polygon','\x20USDT\x20(already\x20paid\x20out)','\x20to\x20','Insufficient\x20balance.\x20Available:\x20','CoinToPay','klyme_de','ðŸ“Š\x20Calculating\x20payout\x20statistics...',',\x20userId:\x20','delete','usdcPolygonWallet','dailyPayments','groupBy','\x20\x20\x20ðŸ–¥ï¸\x20User\x20Agent:\x20','toFixed','paymentsCount','\x20USDT','yesterday','getGatewayDisplayName','\x20->\x20','NONEXISTENT_GATEWAY_FILTER','\x20USDT\x20(after\x20','startsWith','_count',']\x20Updating\x20password\x20for\x20user\x20','thisMonth','ðŸ“‹\x20Getting\x20merchants\x20selection\x20list...','pendingPayout','\x20\x20\x20ï¿½\x20Total\x20paid\x20out:\x20','periodTo','floor','getPayoutStats','âœ…\x20Payout\x20created\x20in\x20DB:','\x20\x20\x20Current\x20balance:\x20',',\x20chargebacks:\x20','trim','\x20\x20\x20ðŸŒ\x20IP:\x20','payment','toISOString','\x20with\x20payout\x20history','shop','substr','\x20\x20\x20Merchant\x20loses:\x20','currencyService','getGatewayNameById','stringify','1RVSPSp','ðŸ’°\x20Found\x20','getAllPayments','197460ptiPQa','\x20USDT\x20(same\x20as\x20awaiting)','\x20order','\x20\x20\x20ðŸ“…\x20Total\x20payouts\x20(this\x20month):\x20','toString','usdcErcWallet','amountAfterCommissionUSDT','ðŸ”\x20Selected\x20erc20\x20wallet:\x20','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','month','ðŸ“Š\x20Payout\x20statistics\x20calculated:','\x20\x20\x20ðŸ¤”\x20Difference:\x20','findMany','paidAt','getFullYear','findUnique',',\x20refunds:\x20','commissionUSDT','âœ…\x20Using\x20gateway\x20filter:\x20\x27','merchantEarningsUSDT','suspendUser','amountAfterGatewayCommissionUSDT','turnover','âš ï¸\x20CHARGEBACK\x20without\x20penalty\x20amount\x20-\x20no\x20balance\x20change','MasterCard','ðŸ’°\x20Current\x20shop\x20balance:\x20',',\x20successful:\x20','desc','\x27\x20(from\x20\x27','ðŸ’¸\x20CHARGEBACK:\x20Processing\x20penalty-only\x20deduction','paymentGateways','Rapyd','ðŸ”\x20[','ACTIVE','ÐÐµ\x20ÑƒÐºÐ°Ð·Ð°Ð½','generateDailyStatistics','forEach','\x20\x20\x20ðŸ”\x20Calculated\x20after\x20commission:\x20','\x20\x20\x20ðŸ’³\x20Total\x20payments:\x20','ðŸ”\x20Selected\x20trc20\x20wallet:\x20','ðŸ“Š\x20Total\x20payments\x20(including\x20failed):\x20','balance','5738780pHQREP','\x20-\x20','ðŸ’°\x20[PAYOUT]\x20Merchant\x20','split','usdtPolygonWallet','EXPIRED','updatePaymentStatus','chargebackAmount','\x20\x20\x20Total\x20paid\x20out:\x20','ðŸ”\x20Selected\x20polygon\x20wallet:\x20','slice','sort','ðŸ’°\x20Payment\x20amount\x20is\x20NOT\x20deducted\x20(chargeback\x20penalty\x20only)','ðŸŽ¯\x20[','amount','activateUser','test_gateway','customerIp','length','updatedAt','toUpperCase','getGatewayInternalName','\x20USDT\x20(+','map','âš ï¸\x20Payment\x20','merchantEarnings','gatewayOrderId','statusChangedAt','payout','getMonth','some','currency','period','last_week','customerName','set','status','\x20\x20\x20Gateway:\x20','erc20_usdc','localeCompare','ðŸ’°\x20Shop\x20','getSystemStatistics',']\x20Gateway\x20settings\x20before\x20saving:',',\x20Commission:\x20','bcryptjs','\x20for\x20shop\x20','wallet','aggregate','ðŸŽ¯\x20updateUser\x20called\x20with\x20ID:\x20','rapyd','customerCountry','customerUa','not\x20specified','turnoverUSDT','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','averageCheckUSDT','update','password','ðŸ’°\x20Creating\x20payout\x20for\x20shop\x20','\x27\x20not\x20found.\x20Available\x20gateways:\x20','\x27\x20to\x20name\x20\x27','setHours','296OiiZqV','getUTCFullYear','\x20\x20\x20ðŸª\x20Gateway\x20earnings:\x20','year','PAID','wallets','totalPaidOut','ru-RU','failUrl','\x20\x20\x20Transaction\x20hash:\x20','dateTo','totalCommissionRate','AdminService','1159186bZBDHa','all_time','gatewaySettings','parse','amountUSDT','getPayoutById','round','getDate','gateways','\x20\x20\x20Balance:\x20','__importDefault','pendingUrl','ðŸ“Š\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','paidOutUSDT','ðŸ“Š\x20Gateway\x20filter\x20applied:','ðŸ”\x20No\x20wallet\x20provided,\x20looking\x20up\x20from\x20shop\x20settings...','ðŸ”„\x20Converted\x20gateway\x20name\x20\x27','reduce','âœ…\x20Using\x20wallet\x20from\x20request:\x20','ðŸ“Š\x20Merchant\x20statistics\x20calculated:','\x20\x20\x20Added\x20to\x20balance:\x20+','periodFrom','log','totalPayout','shopUrl','random','toLowerCase','\x20\x20\x20ï¿½ðŸ“Š\x20Total\x20payments:\x20','customerEmail','create','noda','53037LZZRFJ','$transaction','gte','../types/gateway','1506068xwYMKh','adminNotes','ðŸ“Š\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','ðŸ’°\x20[PAYOUT]\x20Gateway\x20','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','hash','txid','setUTCDate','\x20\x20\x20Difference:\x20','lte','%\x20from\x20','âŒ\x20Failed\x20to\x20send\x20Telegram\x20notification\x20for\x20payout\x20','failureMessage','ðŸ“Š\x20Using\x20saved\x20values\x20for\x20payment\x20','gateway','fullName','REFUND','Plisio','ðŸ”\x20Selected\x20polygon_usdc\x20wallet:\x20','default','ðŸ“Š\x20Getting\x20merchant\x20statistics\x20with\x20filters:','crypto','min','updateCustomerData','getUTCDay','this_week','custom_','findFirst','Payment\x20not\x20found','randomBytes','ðŸ”\x20Initial\x20wallet\x20from\x20request:\x20','\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)','\x20USDT)','getTime','revenue','ðŸ”„\x20Gateway\x20mapping\x20(create):','getUserById','ðŸ“…\x20Payout\x20date\x20to\x20filter:\x20','ðŸ”\x20Creating\x20payout\x20with\x20data:','âœ…\x20Payout\x20created:\x20','\x20\x20\x20ðŸ’¸\x20Total\x20payouts:\x20','ðŸ“Š\x20Calculated\x20commission\x20rate\x20for\x20payment\x20','usdtTrcWallet','COMPLETED','\x20\x20\x20ðŸ’°\x20Total\x20turnover:\x20','week','username','totalAmountUSDT','getMerchantsSelection','payouts','\x20\x20\x20Requested\x20(number):\x20','today','0000','ðŸ”„\x20Gateway\x20mapping:','trc20','Error\x20processing\x20payment\x20',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','getAllPayouts','\x20USDT\x20for\x20payment\x20','convertToUSDT',']\x20Gateway\x20settings\x20JSON\x20string:','getPaymentById','dateFrom','__esModule','\x20USDT\x20(gross\x20revenue)','klyme_gb','entries','totalPayments','\x20USDT\x20(total\x20paid\x20to\x20merchants)','\x20merchants\x20with\x20rounded\x20balance\x20!=\x200.00\x20(excluding\x20balances\x20that\x20round\x20to\x200.00)','telegramBotService','CHARGEBACK','telegram','publicKey',':\x20commission\x20=\x20','ðŸ“Š\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','\x20USDT\x20(theoretical\x20net)','gatewayCommissionRate','dailyRevenue','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','createPayout','ðŸ’±\x20Currency\x20filter\x20applied:\x20','mastercard','network','\x20\x20\x20Tolerance:\x20','totalTurnover','ðŸ“Š\x20Final\x20WHERE\x20conditions:','getUTCMonth','./telegramBotService','794422KreSzK','averageCommissionRate','not\x20provided','error','Telegram\x20username\x20already\x20exists','custom','usdtErcWallet','\x20\x20\x20ðŸŒ\x20Country:\x20','warn','ðŸ’¸\x20CHARGEBACK\x20penalty\x20ONLY:\x20-','ðŸ”\x20Balance\x20check\x20details:','erc20','getMerchantStatistics','push','\x20\x20\x20âœ…\x20Total\x20net\x20balances:\x20','1999368BHMBUX','merchantUrl','ðŸ“Š\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20','ðŸ“Š\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','ðŸ“…\x20Period:\x20','KLYME\x20GB','klyme_eu','UTC'];a46_0x4e20=function(){return _0x4040bf;};return a46_0x4e20();}(function(_0x1513d7,_0x1f04ea){const _0x747859=a46_0x4b21,_0x2caf45=_0x1513d7();while(!![]){try{const _0xafdafd=-parseInt(_0x747859(0x2f7))/0x1*(-parseInt(_0x747859(0x27d))/0x2)+parseInt(_0x747859(0x2fa))/0x3+parseInt(_0x747859(0x224))/0x4*(parseInt(_0x747859(0x299))/0x5)+parseInt(_0x747859(0x28c))/0x6+-parseInt(_0x747859(0x201))/0x7+-parseInt(_0x747859(0x1f4))/0x8*(parseInt(_0x747859(0x220))/0x9)+-parseInt(_0x747859(0x1b6))/0xa;if(_0xafdafd===_0x1f04ea)break;else _0x2caf45['push'](_0x2caf45['shift']());}catch(_0xb66320){_0x2caf45['push'](_0x2caf45['shift']());}}}(a46_0x4e20,0x348db));var __importDefault=this&&this[a46_0x36f641(0x20b)]||function(_0x343e38){const _0x3c70d7=a46_0x36f641;return _0x343e38&&_0x343e38[_0x3c70d7(0x263)]?_0x343e38:{'default':_0x343e38};};Object['defineProperty'](exports,a46_0x36f641(0x263),{'value':!![]}),exports[a46_0x36f641(0x200)]=void 0x0;const database_1=__importDefault(require(a46_0x36f641(0x296))),bcryptjs_1=__importDefault(require(a46_0x36f641(0x1e2))),crypto_1=__importDefault(require(a46_0x36f641(0x239))),currencyService_1=require(a46_0x36f641(0x2a3)),telegramBotService_1=require(a46_0x36f641(0x27c)),gateway_1=require(a46_0x36f641(0x223));function a46_0x4b21(_0x90da36,_0x1e53e0){_0x90da36=_0x90da36-0x199;const _0x4e2005=a46_0x4e20();let _0x4b212c=_0x4e2005[_0x90da36];return _0x4b212c;}class AdminService{async[a46_0x36f641(0x2e8)](){const _0x19cd4d=a46_0x36f641;console[_0x19cd4d(0x217)](_0x19cd4d(0x2d0));const _0x537845=await database_1['default'][_0x19cd4d(0x2f1)][_0x19cd4d(0x1e5)]({'_sum':{'balance':!![],'totalPaidOut':!![]}}),_0x5d345c=await database_1[_0x19cd4d(0x237)][_0x19cd4d(0x2ee)][_0x19cd4d(0x2c3)]({'where':{'status':'PAID','gateway':{'not':_0x19cd4d(0x1c6)}}}),_0x4f23ff=new Date(),_0x4e8064=new Date(_0x4f23ff[_0x19cd4d(0x19a)](),_0x4f23ff[_0x19cd4d(0x1d3)](),0x1),_0x43ff38=new Date(_0x4f23ff[_0x19cd4d(0x19a)](),_0x4f23ff[_0x19cd4d(0x1d3)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x2a7212=await database_1[_0x19cd4d(0x237)][_0x19cd4d(0x1d2)][_0x19cd4d(0x1e5)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x4e8064,'lte':_0x43ff38},'status':'COMPLETED'}}),_0x1950b6=_0x537845[_0x19cd4d(0x29f)][_0x19cd4d(0x1fa)]||0x0,_0x1c28db=_0x537845[_0x19cd4d(0x29f)][_0x19cd4d(0x1b5)]||0x0,_0x2a7fea=_0x2a7212[_0x19cd4d(0x29f)][_0x19cd4d(0x1c4)]||0x0,_0x3b7fe8={'totalPayout':Math[_0x19cd4d(0x207)](_0x1950b6*0x64)/0x64,'awaitingPayout':Math[_0x19cd4d(0x207)](_0x1c28db*0x64)/0x64,'thisMonth':Math['round'](_0x2a7fea*0x64)/0x64,'availableBalance':Math[_0x19cd4d(0x207)](_0x1c28db*0x64)/0x64,'totalPayments':_0x5d345c};return console['log'](_0x19cd4d(0x304)),console['log']('\x20\x20\x20ðŸ’°\x20Total\x20payout:\x20'+_0x3b7fe8[_0x19cd4d(0x218)]+_0x19cd4d(0x268)),console[_0x19cd4d(0x217)]('\x20\x20\x20â³\x20Awaiting\x20payout:\x20'+_0x3b7fe8['awaitingPayout']+_0x19cd4d(0x243)),console['log']('\x20\x20\x20ðŸ’µ\x20Available\x20balance:\x20'+_0x3b7fe8[_0x19cd4d(0x2bf)]+_0x19cd4d(0x2fb)),console['log']('\x20\x20\x20ðŸ“…\x20This\x20month:\x20'+_0x3b7fe8['thisMonth']+_0x19cd4d(0x2d9)),console[_0x19cd4d(0x217)](_0x19cd4d(0x1b2)+_0x3b7fe8[_0x19cd4d(0x267)]+'\x20PAID\x20payments'),_0x3b7fe8;}async[a46_0x36f641(0x23b)](_0x5f3c99,_0x79acb5){const _0x4ed373=a46_0x36f641;console[_0x4ed373(0x217)]('ðŸ”„\x20Updating\x20customer\x20data\x20for\x20payment\x20'+_0x5f3c99+':',_0x79acb5);const _0x313b52=await database_1[_0x4ed373(0x237)][_0x4ed373(0x2ee)][_0x4ed373(0x19b)]({'where':{'id':_0x5f3c99},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x313b52)throw new Error(_0x4ed373(0x240));const _0x5dacf3={};_0x79acb5[_0x4ed373(0x1e8)]!==undefined&&(_0x5dacf3[_0x4ed373(0x1e8)]=_0x79acb5['customerCountry']||null);_0x79acb5['customerIp']!==undefined&&(_0x5dacf3[_0x4ed373(0x1c7)]=_0x79acb5[_0x4ed373(0x1c7)]||null);_0x79acb5[_0x4ed373(0x1e9)]!==undefined&&(_0x5dacf3[_0x4ed373(0x1e9)]=_0x79acb5[_0x4ed373(0x1e9)]||null);const _0x418285=await database_1[_0x4ed373(0x237)][_0x4ed373(0x2ee)][_0x4ed373(0x1ee)]({'where':{'id':_0x5f3c99},'data':{..._0x5dacf3,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console['log']('âœ…\x20Customer\x20data\x20updated\x20for\x20payment\x20'+_0x5f3c99),console['log'](_0x4ed373(0x284)+_0x313b52[_0x4ed373(0x1e8)]+_0x4ed373(0x2dc)+_0x418285[_0x4ed373(0x1e8)]),console['log'](_0x4ed373(0x2ed)+_0x313b52[_0x4ed373(0x1c7)]+_0x4ed373(0x2dc)+_0x418285['customerIp']),console[_0x4ed373(0x217)](_0x4ed373(0x2d6)+(_0x313b52[_0x4ed373(0x1e9)]?_0x4ed373(0x1d9):_0x4ed373(0x2a0))+_0x4ed373(0x2dc)+(_0x418285[_0x4ed373(0x1e9)]?'set':_0x4ed373(0x2a0))),_0x418285;}async[a46_0x36f641(0x1df)](_0x435e1c,_0x55744c){const _0x594d84=a46_0x36f641,_0x540d65=_0x55744c?new Date(_0x55744c):new Date();let _0x22b3e5,_0x1f048e;if(_0x435e1c[_0x594d84(0x2df)](_0x594d84(0x23e))){const _0x1c68bb=_0x435e1c[_0x594d84(0x2af)]('custom_','')[_0x594d84(0x1b9)]('_');_0x1c68bb[_0x594d84(0x1c8)]===0x2?(_0x22b3e5=new Date(_0x1c68bb[0x0]),_0x22b3e5[_0x594d84(0x1f3)](0x0,0x0,0x0,0x0),_0x1f048e=new Date(_0x1c68bb[0x1]),_0x1f048e[_0x594d84(0x1f3)](0x17,0x3b,0x3b,0x3e7)):(_0x22b3e5=new Date(_0x540d65['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8),_0x22b3e5[_0x594d84(0x1f3)](0x0,0x0,0x0,0x0),_0x1f048e=new Date(),_0x1f048e[_0x594d84(0x1f3)](0x17,0x3b,0x3b,0x3e7));}else switch(_0x435e1c[_0x594d84(0x21b)]()){case _0x594d84(0x257):_0x22b3e5=new Date(Date['UTC'](_0x540d65['getUTCFullYear'](),_0x540d65[_0x594d84(0x27b)](),_0x540d65['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x1f048e=new Date(Date[_0x594d84(0x293)](_0x540d65['getUTCFullYear'](),_0x540d65[_0x594d84(0x27b)](),_0x540d65[_0x594d84(0x2b6)](),0x17,0x3b,0x3b,0x3e7));break;case _0x594d84(0x2da):const _0x40210d=new Date(_0x540d65);_0x40210d[_0x594d84(0x22b)](_0x40210d[_0x594d84(0x2b6)]()-0x1),_0x22b3e5=new Date(Date[_0x594d84(0x293)](_0x40210d[_0x594d84(0x1f5)](),_0x40210d[_0x594d84(0x27b)](),_0x40210d[_0x594d84(0x2b6)](),0x0,0x0,0x0,0x0)),_0x1f048e=new Date(Date[_0x594d84(0x293)](_0x40210d['getUTCFullYear'](),_0x40210d['getUTCMonth'](),_0x40210d[_0x594d84(0x2b6)](),0x17,0x3b,0x3b,0x3e7));break;case _0x594d84(0x23d):const _0x2a1843=_0x540d65[_0x594d84(0x23c)](),_0x3e52e6=_0x2a1843===0x0?-0x6:0x1-_0x2a1843,_0x3aaca0=_0x540d65['getUTCDate']()+_0x3e52e6;_0x22b3e5=new Date(Date[_0x594d84(0x293)](_0x540d65[_0x594d84(0x1f5)](),_0x540d65[_0x594d84(0x27b)](),_0x3aaca0,0x0,0x0,0x0,0x0)),_0x1f048e=new Date(Date['UTC'](_0x540d65[_0x594d84(0x1f5)](),_0x540d65['getUTCMonth'](),_0x540d65['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case _0x594d84(0x1d7):const _0x5ed610=new Date(Date[_0x594d84(0x293)](_0x540d65['getUTCFullYear'](),_0x540d65['getUTCMonth'](),_0x540d65[_0x594d84(0x2b6)]()-0x7)),_0x3acf22=_0x5ed610[_0x594d84(0x23c)](),_0x2f799b=_0x3acf22===0x0?-0x6:0x1-_0x3acf22,_0x27fb31=_0x5ed610[_0x594d84(0x2b6)]()+_0x2f799b;_0x22b3e5=new Date(Date[_0x594d84(0x293)](_0x5ed610[_0x594d84(0x1f5)](),_0x5ed610['getUTCMonth'](),_0x27fb31,0x0,0x0,0x0,0x0)),_0x1f048e=new Date(Date[_0x594d84(0x293)](_0x5ed610[_0x594d84(0x1f5)](),_0x5ed610['getUTCMonth'](),_0x27fb31+0x6,0x17,0x3b,0x3b,0x3e7));break;case'this_month':_0x22b3e5=new Date(Date['UTC'](_0x540d65[_0x594d84(0x1f5)](),_0x540d65[_0x594d84(0x27b)](),0x1,0x0,0x0,0x0,0x0)),_0x1f048e=new Date(Date[_0x594d84(0x293)](_0x540d65[_0x594d84(0x1f5)](),_0x540d65[_0x594d84(0x27b)](),_0x540d65[_0x594d84(0x2b6)](),0x17,0x3b,0x3b,0x3e7));break;case'last_month':_0x22b3e5=new Date(Date[_0x594d84(0x293)](_0x540d65['getUTCFullYear'](),_0x540d65[_0x594d84(0x27b)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x1f048e=new Date(Date[_0x594d84(0x293)](_0x540d65['getUTCFullYear'](),_0x540d65['getUTCMonth'](),0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x594d84(0x202):_0x22b3e5=new Date(Date['UTC'](0x7e9,0x5,0xe,0x0,0x0,0x0,0x0)),_0x1f048e=new Date(Date['UTC'](_0x540d65['getUTCFullYear'](),_0x540d65['getUTCMonth'](),_0x540d65['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;default:_0x22b3e5=new Date(_0x540d65[_0x594d84(0x245)]()-0x1e*0x18*0x3c*0x3c*0x3e8),_0x22b3e5['setHours'](0x0,0x0,0x0,0x0),_0x1f048e=new Date(_0x540d65[_0x594d84(0x19a)](),_0x540d65[_0x594d84(0x1d3)](),_0x540d65['getDate'](),0x17,0x3b,0x3b,0x3e7);}const _0x3a467d={'gte':_0x22b3e5,'lte':_0x1f048e},[_0x1bd6e7,_0x286326,_0x28bb41,_0x3acda7,_0x3565a6,_0x6d1c7f,_0x2099bf,_0x3832d4]=await Promise['all']([database_1['default'][_0x594d84(0x2f1)][_0x594d84(0x2c3)](),database_1[_0x594d84(0x237)][_0x594d84(0x2f1)][_0x594d84(0x2c3)]({'where':{'status':_0x594d84(0x1ad)}}),database_1[_0x594d84(0x237)][_0x594d84(0x2ee)]['count']({'where':{'status':_0x594d84(0x1f8),'createdAt':_0x3a467d,'gateway':{'not':_0x594d84(0x1c6)}}}),database_1[_0x594d84(0x237)]['payment']['count']({'where':{'status':'CHARGEBACK','createdAt':_0x3a467d,'gateway':{'not':_0x594d84(0x1c6)}}}),database_1[_0x594d84(0x237)][_0x594d84(0x2ee)]['count']({'where':{'status':_0x594d84(0x234),'createdAt':_0x3a467d,'gateway':{'not':'test_gateway'}}}),database_1[_0x594d84(0x237)]['payment'][_0x594d84(0x306)]({'where':{'status':'PAID','createdAt':_0x3a467d,'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x594d84(0x237)]['payment'][_0x594d84(0x306)]({'where':{'gateway':{'not':'test_gateway'}},'take':0xa,'orderBy':{'createdAt':_0x594d84(0x1a7)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x594d84(0x237)][_0x594d84(0x2ee)]['findMany']({'where':{'createdAt':_0x3a467d,'gateway':{'not':_0x594d84(0x1c6)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x13c2a1=0x0,_0x569b38=0x0;for(const _0x29dbab of _0x6d1c7f){const _0x4e1fb8=_0x29dbab[_0x594d84(0x205)]||0x0;_0x13c2a1+=_0x4e1fb8;if(_0x29dbab[_0x594d84(0x1a1)]&&_0x29dbab[_0x594d84(0x205)]){const _0x14265e=_0x29dbab['amountUSDT']-_0x29dbab['amountAfterGatewayCommissionUSDT'];_0x569b38+=_0x14265e;}}const _0x2cbbbe=_0x28bb41>0x0?_0x13c2a1/_0x28bb41:0x0,_0x494b26=this['generateDailyStatistics'](_0x3832d4,_0x22b3e5,_0x1f048e),_0x2c898a=await database_1[_0x594d84(0x237)]['payment']['count']({'where':{'createdAt':_0x3a467d,'gateway':{'not':_0x594d84(0x1c6)},'status':{'notIn':['PENDING',_0x594d84(0x1bb)]}}}),_0x386ce4=_0x2c898a>0x0?_0x28bb41/_0x2c898a*0x64:0x0;return{'totalShops':_0x1bd6e7,'activeShops':_0x286326,'totalPayments':_0x2c898a,'successfulPayments':_0x28bb41,'totalAttempts':_0x2c898a,'chargebacks':_0x3acda7,'refunds':_0x3565a6,'totalRevenue':Math[_0x594d84(0x207)](_0x13c2a1*0x64)/0x64,'trapayEarnings':Math[_0x594d84(0x207)](_0x569b38*0x64)/0x64,'averagePaymentAmount':Math['round'](_0x2cbbbe*0x64)/0x64,'conversionRate':Math[_0x594d84(0x207)](_0x386ce4*0x64)/0x64,'dailyRevenue':_0x494b26[_0x594d84(0x272)],'dailyPayments':_0x494b26[_0x594d84(0x2d4)],'recentPayments':_0x2099bf[_0x594d84(0x1cd)](_0x570d61=>({'id':_0x570d61['id'],'amount':_0x570d61[_0x594d84(0x1c4)],'currency':_0x570d61[_0x594d84(0x1d5)],'status':_0x570d61['status'],'gateway':_0x570d61[_0x594d84(0x232)],'shop':_0x570d61[_0x594d84(0x2f1)],'createdAt':_0x570d61[_0x594d84(0x2b7)]}))};}async[a46_0x36f641(0x289)](_0x49443f){const _0x1b4e60=a46_0x36f641;console[_0x1b4e60(0x217)](_0x1b4e60(0x238),_0x49443f);let _0xbd5f42,_0x12bb3d=new Date();if(_0x49443f[_0x1b4e60(0x1d6)]===_0x1b4e60(0x282)&&_0x49443f[_0x1b4e60(0x262)]&&_0x49443f[_0x1b4e60(0x1fe)])_0xbd5f42=new Date(_0x49443f[_0x1b4e60(0x262)]),_0x12bb3d=new Date(_0x49443f[_0x1b4e60(0x1fe)]),_0xbd5f42[_0x1b4e60(0x1f3)](0x0,0x0,0x0,0x0),_0x12bb3d[_0x1b4e60(0x1f3)](0x17,0x3b,0x3b,0x3e7);else{const _0x66a2e9=new Date();switch(_0x49443f[_0x1b4e60(0x1d6)]){case _0x1b4e60(0x251):_0xbd5f42=new Date(_0x66a2e9['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x1b4e60(0x303):_0xbd5f42=new Date(_0x66a2e9[_0x1b4e60(0x245)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x1b4e60(0x1f7):_0xbd5f42=new Date(_0x66a2e9[_0x1b4e60(0x245)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x1b4e60(0x297):default:_0xbd5f42=new Date(_0x1b4e60(0x2aa));break;}_0xbd5f42[_0x1b4e60(0x1f3)](0x0,0x0,0x0,0x0),_0x12bb3d[_0x1b4e60(0x1f3)](0x17,0x3b,0x3b,0x3e7);}console[_0x1b4e60(0x217)](_0x1b4e60(0x290)+_0xbd5f42[_0x1b4e60(0x2ef)]()+_0x1b4e60(0x2cc)+_0x12bb3d[_0x1b4e60(0x2ef)]());const _0x1b8881={'status':_0x1b4e60(0x1f8),'gateway':{'not':'test_gateway'},'paidAt':{'gte':_0xbd5f42,'lte':_0x12bb3d}};_0x49443f['shopId']&&(_0x1b8881[_0x1b4e60(0x2b2)]=_0x49443f[_0x1b4e60(0x2b2)]);const _0x4370d1=await database_1[_0x1b4e60(0x237)][_0x1b4e60(0x2ee)]['findMany']({'where':_0x1b8881,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console['log']('ðŸ’°\x20Found\x20'+_0x4370d1['length']+'\x20paid\x20payments\x20for\x20analysis');const _0xa66123={'gateway':{'not':'test_gateway'},'status':{'notIn':[_0x1b4e60(0x29d),_0x1b4e60(0x1bb)]},'createdAt':{'gte':_0xbd5f42,'lte':_0x12bb3d}};_0x49443f['shopId']&&(_0xa66123[_0x1b4e60(0x2b2)]=_0x49443f[_0x1b4e60(0x2b2)]);const _0x1fabb3=await database_1['default']['payment'][_0x1b4e60(0x2c3)]({'where':_0xa66123}),_0x47d842={..._0xa66123,'status':_0x1b4e60(0x26b)},_0xde96e6={..._0xa66123,'status':_0x1b4e60(0x234)},[_0xa52ac1,_0x2ef001]=await Promise[_0x1b4e60(0x297)]([database_1[_0x1b4e60(0x237)][_0x1b4e60(0x2ee)][_0x1b4e60(0x2c3)]({'where':_0x47d842}),database_1[_0x1b4e60(0x237)][_0x1b4e60(0x2ee)][_0x1b4e60(0x2c3)]({'where':_0xde96e6})]);console[_0x1b4e60(0x217)](_0x1b4e60(0x1b4)+_0x1fabb3+_0x1b4e60(0x1a6)+_0x4370d1[_0x1b4e60(0x1c8)]+_0x1b4e60(0x2eb)+_0xa52ac1+_0x1b4e60(0x19c)+_0x2ef001);let _0x2019c1=0x0,_0x9527a4=0x0,_0x5c98ab=0x0;const _0x28ebe9={},_0x23b96f={},_0x25934c={};for(const _0x45f607 of _0x4370d1){try{const _0x3bb860=_0x45f607[_0x1b4e60(0x205)]||0x0;if(_0x3bb860<=0x0){console[_0x1b4e60(0x285)](_0x1b4e60(0x1ce)+_0x45f607['id']+'\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...');continue;}let _0x1ae351,_0x543792;if(_0x45f607[_0x1b4e60(0x1a1)]!==null&&_0x45f607[_0x1b4e60(0x1a1)]!==undefined)_0x1ae351=_0x45f607[_0x1b4e60(0x1a1)],_0x543792=_0x3bb860-_0x1ae351,console[_0x1b4e60(0x217)](_0x1b4e60(0x231)+_0x45f607['id']+':\x20'+_0x3bb860[_0x1b4e60(0x2d7)](0x6)+'\x20USDT,\x20merchant:\x20'+_0x1ae351[_0x1b4e60(0x2d7)](0x6)+_0x1b4e60(0x2d9));else{let _0x593a01={};if(_0x45f607[_0x1b4e60(0x2f1)][_0x1b4e60(0x203)])try{_0x593a01=JSON[_0x1b4e60(0x204)](_0x45f607['shop'][_0x1b4e60(0x203)]);}catch(_0x5e5542){console['error'](_0x1b4e60(0x228)+_0x45f607[_0x1b4e60(0x2b2)]+':',_0x5e5542);}let _0x286fed=0x2d;for(const [_0x427c07,_0x53e355]of Object[_0x1b4e60(0x266)](_0x593a01)){if(_0x427c07[_0x1b4e60(0x21b)]()===_0x45f607[_0x1b4e60(0x232)]['toLowerCase']()){_0x286fed=_0x53e355[_0x1b4e60(0x2ad)]||0x2d;break;}}_0x543792=_0x3bb860*(_0x286fed/0x64),_0x1ae351=_0x3bb860-_0x543792,console[_0x1b4e60(0x217)](_0x1b4e60(0x26f)+_0x45f607['id']+':\x20'+_0x286fed+_0x1b4e60(0x22e)+_0x3bb860[_0x1b4e60(0x2d7)](0x6)+_0x1b4e60(0x2d9));}_0x2019c1+=_0x3bb860,_0x9527a4+=_0x1ae351,_0x5c98ab+=_0x543792;let _0x3d602b;_0x45f607[_0x1b4e60(0x271)]!==null&&_0x45f607[_0x1b4e60(0x271)]!==undefined?(_0x3d602b=_0x45f607[_0x1b4e60(0x271)],console[_0x1b4e60(0x217)](_0x1b4e60(0x28e)+_0x45f607['id']+':\x20'+_0x3d602b+'%')):(_0x3d602b=_0x3bb860>0x0?_0x543792/_0x3bb860*0x64:0x0,console[_0x1b4e60(0x217)](_0x1b4e60(0x24d)+_0x45f607['id']+':\x20'+_0x3d602b[_0x1b4e60(0x2d7)](0x2)+'%'));!_0x28ebe9[_0x45f607[_0x1b4e60(0x232)]]&&(_0x28ebe9[_0x45f607[_0x1b4e60(0x232)]]={'gateway':_0x45f607[_0x1b4e60(0x232)],'gatewayDisplayName':this['getGatewayDisplayName'](_0x45f607['gateway']),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x28ebe9[_0x45f607[_0x1b4e60(0x232)]][_0x1b4e60(0x2d8)]++,_0x28ebe9[_0x45f607[_0x1b4e60(0x232)]][_0x1b4e60(0x1eb)]+=_0x3bb860,_0x28ebe9[_0x45f607[_0x1b4e60(0x232)]][_0x1b4e60(0x19d)]+=_0x543792,_0x28ebe9[_0x45f607[_0x1b4e60(0x232)]]['merchantEarningsUSDT']+=_0x1ae351,_0x28ebe9[_0x45f607[_0x1b4e60(0x232)]][_0x1b4e60(0x1ff)]+=_0x3d602b;!_0x49443f[_0x1b4e60(0x2b2)]&&(!_0x23b96f[_0x45f607[_0x1b4e60(0x2b2)]]&&(_0x23b96f[_0x45f607[_0x1b4e60(0x2b2)]]={'shopId':_0x45f607['shopId'],'shopName':_0x45f607['shop'][_0x1b4e60(0x2a9)],'shopUsername':_0x45f607[_0x1b4e60(0x2f1)][_0x1b4e60(0x252)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x23b96f[_0x45f607[_0x1b4e60(0x2b2)]][_0x1b4e60(0x2d8)]++,_0x23b96f[_0x45f607[_0x1b4e60(0x2b2)]][_0x1b4e60(0x1eb)]+=_0x3bb860,_0x23b96f[_0x45f607['shopId']]['commissionUSDT']+=_0x543792,_0x23b96f[_0x45f607['shopId']][_0x1b4e60(0x19f)]+=_0x1ae351);const _0x269569=_0x45f607['paidAt'][_0x1b4e60(0x2ef)]()[_0x1b4e60(0x1b9)]('T')[0x0];!_0x25934c[_0x269569]&&(_0x25934c[_0x269569]={'date':_0x269569,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x25934c[_0x269569]['turnover']+=_0x3bb860,_0x25934c[_0x269569][_0x1b4e60(0x1cf)]+=_0x1ae351,_0x25934c[_0x269569]['gatewayEarnings']+=_0x543792,_0x25934c[_0x269569][_0x1b4e60(0x2d8)]++;}catch(_0xa2732c){console[_0x1b4e60(0x280)](_0x1b4e60(0x25b)+_0x45f607['id']+':',_0xa2732c);}}Object['values'](_0x28ebe9)['forEach'](_0x2602e0=>{const _0xdea47a=_0x1b4e60;_0x2602e0[_0xdea47a(0x27e)]=_0x2602e0[_0xdea47a(0x2d8)]>0x0?_0x2602e0[_0xdea47a(0x1ff)]/_0x2602e0[_0xdea47a(0x2d8)]:0x0,delete _0x2602e0[_0xdea47a(0x1ff)];}),Object[_0x1b4e60(0x2c0)](_0x23b96f)[_0x1b4e60(0x1b0)](_0x1d9034=>{const _0x42a5d9=_0x1b4e60;_0x1d9034[_0x42a5d9(0x1ed)]=_0x1d9034[_0x42a5d9(0x2d8)]>0x0?_0x1d9034[_0x42a5d9(0x1eb)]/_0x1d9034[_0x42a5d9(0x2d8)]:0x0;});let _0x222acf=0x0,_0x458fb3=0x0;if(_0x49443f[_0x1b4e60(0x2b2)]){const _0x28537f=await database_1[_0x1b4e60(0x237)]['payout'][_0x1b4e60(0x306)]({'where':{'shopId':_0x49443f[_0x1b4e60(0x2b2)],'status':_0x1b4e60(0x24f),'createdAt':{'gte':_0xbd5f42,'lte':_0x12bb3d}},'select':{'amount':!![]}});_0x222acf=_0x28537f[_0x1b4e60(0x212)]((_0x358c8f,_0x47d34e)=>_0x358c8f+_0x47d34e[_0x1b4e60(0x1c4)],0x0);const _0x454a12=await database_1['default'][_0x1b4e60(0x1d2)][_0x1b4e60(0x306)]({'where':{'shopId':_0x49443f[_0x1b4e60(0x2b2)],'status':_0x1b4e60(0x29d),'createdAt':{'gte':_0xbd5f42,'lte':_0x12bb3d}},'select':{'amount':!![]}});_0x458fb3=_0x454a12[_0x1b4e60(0x212)]((_0xdb1444,_0xd37e54)=>_0xdb1444+_0xd37e54['amount'],0x0);}const _0x1a0c09=_0x1fabb3,_0x4d1a14=_0x4370d1[_0x1b4e60(0x1c8)],_0x234258=_0x4d1a14>0x0?_0x2019c1/_0x4d1a14:0x0,_0x4fb5c5=_0x1a0c09>0x0?Math[_0x1b4e60(0x207)](_0x4d1a14/_0x1a0c09*0x2710)/0x64:0x0,_0x239d66=Math['ceil']((_0x12bb3d['getTime']()-_0xbd5f42[_0x1b4e60(0x245)]())/(0x3e8*0x3c*0x3c*0x18)),_0x4f859f={'totalTurnover':Math['round'](_0x2019c1*0x64)/0x64,'merchantEarnings':Math[_0x1b4e60(0x207)](_0x9527a4*0x64)/0x64,'gatewayEarnings':Math['round'](_0x5c98ab*0x64)/0x64,'totalPaidOut':Math['round'](_0x222acf*0x64)/0x64,'pendingPayout':Math[_0x1b4e60(0x207)](_0x458fb3*0x64)/0x64,'averageCheck':Math['round'](_0x234258*0x64)/0x64,'totalPayments':_0x1a0c09,'successfulPayments':_0x4d1a14,'conversionRate':_0x4fb5c5,'chargebacks':_0xa52ac1,'refunds':_0x2ef001,'gatewayBreakdown':Object[_0x1b4e60(0x2c0)](_0x28ebe9)[_0x1b4e60(0x1cd)](_0x36659c=>({..._0x36659c,'turnoverUSDT':Math[_0x1b4e60(0x207)](_0x36659c['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x1b4e60(0x207)](_0x36659c[_0x1b4e60(0x19d)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x1b4e60(0x207)](_0x36659c[_0x1b4e60(0x19f)]*0x64)/0x64,'averageCommissionRate':Math[_0x1b4e60(0x207)](_0x36659c[_0x1b4e60(0x27e)]*0x64)/0x64})),'merchantBreakdown':_0x49443f[_0x1b4e60(0x2b2)]?undefined:Object['values'](_0x23b96f)[_0x1b4e60(0x1cd)](_0x26e36e=>({..._0x26e36e,'turnoverUSDT':Math[_0x1b4e60(0x207)](_0x26e36e['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x1b4e60(0x207)](_0x26e36e[_0x1b4e60(0x19d)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x1b4e60(0x207)](_0x26e36e[_0x1b4e60(0x19f)]*0x64)/0x64,'paidOutUSDT':Math[_0x1b4e60(0x207)](_0x26e36e[_0x1b4e60(0x20e)]*0x64)/0x64,'averageCheckUSDT':Math['round'](_0x26e36e[_0x1b4e60(0x1ed)]*0x64)/0x64})),'dailyData':Object[_0x1b4e60(0x2c0)](_0x25934c)[_0x1b4e60(0x1cd)](_0x35cc7c=>({..._0x35cc7c,'turnover':Math[_0x1b4e60(0x207)](_0x35cc7c[_0x1b4e60(0x1a2)]*0x64)/0x64,'merchantEarnings':Math[_0x1b4e60(0x207)](_0x35cc7c[_0x1b4e60(0x1cf)]*0x64)/0x64,'gatewayEarnings':Math[_0x1b4e60(0x207)](_0x35cc7c[_0x1b4e60(0x2b0)]*0x64)/0x64}))[_0x1b4e60(0x1c1)]((_0x32b584,_0x4de4ab)=>_0x32b584[_0x1b4e60(0x2b1)][_0x1b4e60(0x1dd)](_0x4de4ab[_0x1b4e60(0x2b1)])),'periodInfo':{'from':_0xbd5f42,'to':_0x12bb3d,'periodType':_0x49443f[_0x1b4e60(0x1d6)]||_0x1b4e60(0x282),'daysCount':_0x239d66}};return console[_0x1b4e60(0x217)](_0x1b4e60(0x214)),console['log'](_0x1b4e60(0x250)+_0x4f859f[_0x1b4e60(0x279)]+_0x1b4e60(0x2d9)),console[_0x1b4e60(0x217)]('\x20\x20\x20ðŸ‘¤\x20Merchant\x20earnings:\x20'+_0x4f859f[_0x1b4e60(0x1cf)]+_0x1b4e60(0x2d9)),console[_0x1b4e60(0x217)](_0x1b4e60(0x1f6)+_0x4f859f[_0x1b4e60(0x2b0)]+'\x20USDT'),console[_0x1b4e60(0x217)](_0x1b4e60(0x2e5)+_0x4f859f[_0x1b4e60(0x1fa)]+_0x1b4e60(0x2d9)),console['log']('\x20\x20\x20â³\x20Pending\x20payout:\x20'+_0x4f859f[_0x1b4e60(0x2e4)]+_0x1b4e60(0x2d9)),console['log'](_0x1b4e60(0x21c)+_0x4f859f['totalPayments']),_0x4f859f;}async[a46_0x36f641(0x254)](_0x33770a){const _0x26822f=a46_0x36f641;console[_0x26822f(0x217)](_0x26822f(0x2e3),{'hasPayoutHistory':_0x33770a});let _0x18ff9d={};_0x33770a&&(_0x18ff9d[_0x26822f(0x255)]={'some':{}});const _0x554f29=await database_1[_0x26822f(0x237)][_0x26822f(0x2f1)][_0x26822f(0x306)]({'where':_0x18ff9d,'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x26822f(0x294)}});return console[_0x26822f(0x217)]('ðŸ“‹\x20Found\x20'+_0x554f29[_0x26822f(0x1c8)]+'\x20merchants\x20for\x20selection'+(_0x33770a?_0x26822f(0x2f0):'')),_0x554f29[_0x26822f(0x1cd)](_0x3e2135=>({'id':_0x3e2135['id'],'username':_0x3e2135['username'],'name':_0x3e2135[_0x26822f(0x2a9)]}));}[a46_0x36f641(0x2db)](_0x283ddc){const _0x3d9c96=a46_0x36f641,_0x5d1a0c={'test_gateway':_0x3d9c96(0x2b8),'plisio':_0x3d9c96(0x235),'rapyd':_0x3d9c96(0x1ab),'noda':'Noda','cointopay':_0x3d9c96(0x2ce),'cointopay2':'Open\x20Banking\x202','klyme_eu':'KLYME\x20EU','klyme_gb':_0x3d9c96(0x291),'klyme_de':'KLYME\x20DE','mastercard':_0x3d9c96(0x1a4)};return _0x5d1a0c[_0x283ddc]||_0x283ddc;}[a46_0x36f641(0x1cb)](_0x49583c){const _0xc51e33=a46_0x36f641,_0x370861={'Test\x20Gateway':_0xc51e33(0x1c6),'Plisio':'plisio','Rapyd':_0xc51e33(0x1e7),'Noda':_0xc51e33(0x21f),'CoinToPay':'cointopay','CoinToPay2':_0xc51e33(0x2bb),'KLYME\x20EU':_0xc51e33(0x292),'KLYME\x20GB':_0xc51e33(0x265),'KLYME\x20DE':_0xc51e33(0x2cf),'MasterCard':_0xc51e33(0x276)};return _0x370861[_0x49583c]||_0x49583c[_0xc51e33(0x21b)]();}async[a46_0x36f641(0x29a)](_0xb02f86){const _0x2d3973=a46_0x36f641,{page:_0x17e894,limit:_0x31ca38,minAmount:_0x2bae92,search:_0x118c1c}=_0xb02f86;console['log'](_0x2d3973(0x20d),_0xb02f86);let _0x2faaa5={};_0x118c1c&&(_0x2faaa5['name']={'contains':_0x118c1c,'mode':_0x2d3973(0x2c9)});const _0x6e010a=await database_1['default']['shop']['findMany']({'where':_0x2faaa5,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),_0x42695d=_0x6e010a['filter'](_0x5d1c60=>{const _0x1e84dd=_0x2d3973,_0x14303e=Math['floor'](_0x5d1c60[_0x1e84dd(0x1b5)]*0x64)/0x64;if(_0x2bae92&&_0x14303e<_0x2bae92)return![];return _0x14303e!==0x0;});_0x42695d[_0x2d3973(0x1c1)]((_0x3d94f3,_0x5f2266)=>_0x5f2266[_0x2d3973(0x1b5)]-_0x3d94f3['balance']);const _0x3b0846=_0x42695d[_0x2d3973(0x1c8)],_0x4108a0=(_0x17e894-0x1)*_0x31ca38,_0x342cd8=_0x42695d[_0x2d3973(0x1c0)](_0x4108a0,_0x4108a0+_0x31ca38);console[_0x2d3973(0x217)](_0x2d3973(0x2f8)+_0x342cd8[_0x2d3973(0x1c8)]+_0x2d3973(0x269));const _0xc71bae=await Promise[_0x2d3973(0x297)](_0x342cd8[_0x2d3973(0x1cd)](async _0x11ec77=>{const _0x5a9768=_0x2d3973,[_0x2709f5,_0x196641,_0x2374fe]=await Promise[_0x5a9768(0x297)]([database_1[_0x5a9768(0x237)][_0x5a9768(0x2ee)]['count']({'where':{'shopId':_0x11ec77['id'],'status':_0x5a9768(0x1f8),'gateway':{'not':'test_gateway'}}}),database_1[_0x5a9768(0x237)][_0x5a9768(0x2ee)][_0x5a9768(0x23f)]({'where':{'shopId':_0x11ec77['id'],'status':_0x5a9768(0x1f8),'gateway':{'not':'test_gateway'}},'orderBy':{'paidAt':_0x5a9768(0x294)},'select':{'paidAt':!![]}}),database_1[_0x5a9768(0x237)][_0x5a9768(0x2ee)][_0x5a9768(0x2d5)]({'by':[_0x5a9768(0x232)],'where':{'shopId':_0x11ec77['id'],'status':'PAID','gateway':{'not':_0x5a9768(0x1c6)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x4f5aa7=new Date(),_0x56bb80=new Date(_0x4f5aa7[_0x5a9768(0x19a)](),_0x4f5aa7[_0x5a9768(0x1d3)](),0x1),_0xb54133=new Date(_0x4f5aa7[_0x5a9768(0x19a)](),_0x4f5aa7[_0x5a9768(0x1d3)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x416d52,_0x1e71cf]=await Promise['all']([database_1[_0x5a9768(0x237)]['payout'][_0x5a9768(0x1e5)]({'_sum':{'amount':!![]},'where':{'shopId':_0x11ec77['id'],'status':'COMPLETED'}}),database_1[_0x5a9768(0x237)]['payout'][_0x5a9768(0x1e5)]({'_sum':{'amount':!![]},'where':{'shopId':_0x11ec77['id'],'status':_0x5a9768(0x24f),'createdAt':{'gte':_0x56bb80,'lte':_0xb54133}}})]),_0x2e9eb5=_0x416d52[_0x5a9768(0x29f)][_0x5a9768(0x1c4)]||0x0,_0xfb7ebf=_0x1e71cf[_0x5a9768(0x29f)]['amount']||0x0,_0x3b4f15=await Promise[_0x5a9768(0x297)](_0x2374fe['map'](async _0x10d425=>{const _0x2759fc=_0x5a9768;let _0x552872=0x2d;if(_0x11ec77['gatewaySettings'])try{const _0x48c9a2=JSON[_0x2759fc(0x204)](_0x11ec77[_0x2759fc(0x203)]);for(const [_0x4b3f25,_0x5c54c9]of Object[_0x2759fc(0x266)](_0x48c9a2)){if(_0x4b3f25['toLowerCase']()===_0x10d425[_0x2759fc(0x232)][_0x2759fc(0x21b)]()){_0x552872=_0x5c54c9[_0x2759fc(0x2ad)]||0xa,console[_0x2759fc(0x217)](_0x2759fc(0x227)+_0x10d425[_0x2759fc(0x232)]+_0x2759fc(0x1e3)+_0x11ec77['id']+_0x2759fc(0x26e)+_0x552872+'%');break;}}}catch(_0x117b65){console['error'](_0x2759fc(0x228)+_0x11ec77['id']+':',_0x117b65);}const _0x2c017b=_0x10d425[_0x2759fc(0x29f)]?.[_0x2759fc(0x205)]||0x0,_0x49571e=_0x2c017b*(0x1-_0x552872/0x64);return{'gateway':_0x10d425[_0x2759fc(0x232)],'count':_0x10d425[_0x2759fc(0x2e0)]?.['id']||0x0,'amountUSDT':Math[_0x2759fc(0x207)](_0x2c017b*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x2759fc(0x207)](_0x49571e*0x64)/0x64,'commission':_0x552872};})),_0x55590d=_0x3b4f15[_0x5a9768(0x212)]((_0x5f45fa,_0xc70293)=>_0x5f45fa+_0xc70293[_0x5a9768(0x205)],0x0),_0x51e252=_0x3b4f15[_0x5a9768(0x212)]((_0x3b934d,_0x947374)=>_0x3b934d+_0x947374[_0x5a9768(0x300)],0x0),_0x512b72=_0x11ec77[_0x5a9768(0x1b5)];return console[_0x5a9768(0x217)](_0x5a9768(0x1b8)+_0x11ec77[_0x5a9768(0x252)]+':'),console[_0x5a9768(0x217)]('\x20\x20\x20ï¿½\x20Total\x20payments\x20turnover:\x20'+_0x55590d['toFixed'](0x2)+_0x5a9768(0x264)),console['log'](_0x5a9768(0x1b1)+_0x51e252[_0x5a9768(0x2d7)](0x2)+_0x5a9768(0x270)),console[_0x5a9768(0x217)]('\x20\x20\x20âœ…\x20Actual\x20available\x20balance:\x20'+_0x512b72[_0x5a9768(0x2d7)](0x2)+'\x20USDT\x20(current\x20balance\x20in\x20DB)'),console[_0x5a9768(0x217)](_0x5a9768(0x24c)+_0x2e9eb5[_0x5a9768(0x2d7)](0x2)+_0x5a9768(0x2cb)),console[_0x5a9768(0x217)](_0x5a9768(0x305)+(_0x51e252-_0x2e9eb5-_0x512b72)[_0x5a9768(0x2d7)](0x2)+'\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)'),{'id':_0x11ec77['id'],'fullName':_0x11ec77[_0x5a9768(0x2a9)],'username':_0x11ec77['username'],'telegramId':_0x11ec77['telegram'],'merchantUrl':_0x11ec77[_0x5a9768(0x219)],'wallets':{'usdtPolygonWallet':_0x11ec77[_0x5a9768(0x1ba)],'usdtTrcWallet':_0x11ec77[_0x5a9768(0x24e)],'usdtErcWallet':_0x11ec77[_0x5a9768(0x283)],'usdcPolygonWallet':_0x11ec77[_0x5a9768(0x2d3)],'usdcErcWallet':_0x11ec77[_0x5a9768(0x2ff)]},'totalAmountUSDT':Math[_0x5a9768(0x207)](_0x55590d*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x51e252*0x64)/0x64,'currentBalance':Math[_0x5a9768(0x2e7)](_0x512b72*0x64)/0x64,'totalPayout':Math['round'](_0x2e9eb5*0x64)/0x64,'thisMonth':Math['round'](_0xfb7ebf*0x64)/0x64,'paymentsCount':_0x2709f5,'oldestPaymentDate':_0x196641?.[_0x5a9768(0x199)]||_0x11ec77[_0x5a9768(0x2b7)],'gatewayBreakdown':_0x3b4f15};})),_0x33321e=_0xc71bae[_0x2d3973(0x212)]((_0x2a2ceb,_0x38270f)=>_0x2a2ceb+_0x38270f[_0x2d3973(0x253)],0x0),_0x2e2b9f=_0xc71bae[_0x2d3973(0x212)]((_0x15586e,_0x42633e)=>_0x15586e+_0x42633e[_0x2d3973(0x2be)],0x0),_0x5dd3b7=_0xc71bae[_0x2d3973(0x212)]((_0x30b1ae,_0x491725)=>_0x30b1ae+_0x491725[_0x2d3973(0x218)],0x0),_0x270846=_0xc71bae[_0x2d3973(0x212)]((_0x3b67f4,_0x32b67f)=>_0x3b67f4+_0x32b67f[_0x2d3973(0x2e2)],0x0);return console[_0x2d3973(0x217)](_0x2d3973(0x29e)+_0x3b0846+'\x20merchants'),console['log'](_0x2d3973(0x2ae)+Math[_0x2d3973(0x207)](_0x33321e*0x64)/0x64+_0x2d3973(0x264)),console['log'](_0x2d3973(0x28b)+Math[_0x2d3973(0x207)](_0x2e2b9f*0x64)/0x64+'\x20USDT\x20(rounded\x20to\x202\x20decimal\x20places)'),console[_0x2d3973(0x217)]('\x20\x20\x20ðŸ’¸\x20Total\x20payouts\x20(all\x20time):\x20'+Math[_0x2d3973(0x207)](_0x5dd3b7*0x64)/0x64+_0x2d3973(0x2d9)),console[_0x2d3973(0x217)](_0x2d3973(0x2fd)+Math[_0x2d3973(0x207)](_0x270846*0x64)/0x64+_0x2d3973(0x2d9)),{'merchants':_0xc71bae,'pagination':{'page':_0x17e894,'limit':_0x31ca38,'total':_0x3b0846,'totalPages':Math[_0x2d3973(0x2a2)](_0x3b0846/_0x31ca38)},'summary':{'totalMerchants':_0x3b0846,'totalAmountUSDT':Math[_0x2d3973(0x207)](_0x33321e*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x2d3973(0x207)](_0x2e2b9f*0x64)/0x64,'totalPayout':Math[_0x2d3973(0x207)](_0x5dd3b7*0x64)/0x64,'thisMonth':Math[_0x2d3973(0x207)](_0x270846*0x64)/0x64}};}async[a46_0x36f641(0x274)](_0x195318){const _0x276a88=a46_0x36f641,{shopId:_0x4c3e31,amount:_0x119382,network:_0x369587,wallet:_0x5aeea7,notes:_0x3be5bf,txid:_0x3a5697,periodFrom:_0xcd6f32,periodTo:_0x4be948}=_0x195318,_0x255aaa=await database_1['default'][_0x276a88(0x221)](async _0x296fd1=>{const _0x4c551c=_0x276a88,_0x46328d=await _0x296fd1['shop']['findUnique']({'where':{'id':_0x4c3e31},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x46328d)throw new Error('Shop\x20not\x20found');console[_0x4c551c(0x217)](_0x4c551c(0x1f0)+_0x46328d['username']+':'),console[_0x4c551c(0x217)](_0x4c551c(0x2ea)+_0x46328d['balance'][_0x4c551c(0x2d7)](0x6)+_0x4c551c(0x2d9)),console[_0x4c551c(0x217)]('\x20\x20\x20Payout\x20amount:\x20'+_0x119382[_0x4c551c(0x2d7)](0x6)+_0x4c551c(0x2d9)),console[_0x4c551c(0x217)](_0x4c551c(0x273)+_0x46328d[_0x4c551c(0x1fa)][_0x4c551c(0x2d7)](0x6)+_0x4c551c(0x2d9));if(_0x3a5697)console[_0x4c551c(0x217)](_0x4c551c(0x1fd)+_0x3a5697);const _0x4c7a29=0.000001,_0x1cd9cb=Number(_0x46328d['balance']),_0x5b4d3a=Number(_0x119382);console['log'](_0x4c551c(0x287)),console[_0x4c551c(0x217)]('\x20\x20\x20Available\x20(raw):\x20'+_0x46328d[_0x4c551c(0x1b5)]),console[_0x4c551c(0x217)]('\x20\x20\x20Available\x20(number):\x20'+_0x1cd9cb),console[_0x4c551c(0x217)](_0x4c551c(0x256)+_0x5b4d3a),console[_0x4c551c(0x217)](_0x4c551c(0x22c)+(_0x1cd9cb-_0x5b4d3a)),console[_0x4c551c(0x217)](_0x4c551c(0x278)+_0x4c7a29);if(_0x1cd9cb<_0x5b4d3a-_0x4c7a29)throw new Error(_0x4c551c(0x2cd)+_0x1cd9cb[_0x4c551c(0x2d7)](0x6)+'\x20USDT,\x20Requested:\x20'+_0x5b4d3a[_0x4c551c(0x2d7)](0x6)+'\x20USDT,\x20Difference:\x20'+(_0x1cd9cb-_0x5b4d3a)[_0x4c551c(0x2d7)](0x8)+_0x4c551c(0x2d9));console['log']('âœ…\x20Balance\x20check\x20passed\x20(with\x20tolerance)');const _0x511538=Math[_0x4c551c(0x23a)](_0x1cd9cb,_0x5b4d3a);let _0x35c6bb=_0x5aeea7;console['log'](_0x4c551c(0x242)+(_0x5aeea7||_0x4c551c(0x27f)));if(!_0x35c6bb){console[_0x4c551c(0x217)](_0x4c551c(0x210));const _0x34864e=await _0x296fd1['shop']['findUnique']({'where':{'id':_0x4c3e31},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});console['log']('ðŸ”\x20Shop\x20wallets:',_0x34864e);if(_0x34864e)switch(_0x369587){case _0x4c551c(0x2ca):_0x35c6bb=_0x34864e[_0x4c551c(0x1ba)]||undefined,console['log'](_0x4c551c(0x1bf)+_0x35c6bb);break;case _0x4c551c(0x25a):_0x35c6bb=_0x34864e[_0x4c551c(0x24e)]||undefined,console[_0x4c551c(0x217)](_0x4c551c(0x1b3)+_0x35c6bb);break;case _0x4c551c(0x288):_0x35c6bb=_0x34864e['usdtErcWallet']||undefined,console['log'](_0x4c551c(0x301)+_0x35c6bb);break;case _0x4c551c(0x2b9):_0x35c6bb=_0x34864e[_0x4c551c(0x2d3)]||undefined,console['log'](_0x4c551c(0x236)+_0x35c6bb);break;case _0x4c551c(0x1dc):_0x35c6bb=_0x34864e[_0x4c551c(0x2ff)]||undefined,console[_0x4c551c(0x217)]('ðŸ”\x20Selected\x20erc20_usdc\x20wallet:\x20'+_0x35c6bb);break;}}else console[_0x4c551c(0x217)](_0x4c551c(0x213)+_0x35c6bb);console[_0x4c551c(0x217)]('ðŸ’³\x20Final\x20payout\x20wallet\x20for\x20'+_0x369587+':\x20'+(_0x35c6bb||_0x4c551c(0x1ea))),console[_0x4c551c(0x217)](_0x4c551c(0x24a),{'shopId':_0x4c3e31,'amount':_0x511538,'network':_0x369587,'wallet':_0x35c6bb,'status':'COMPLETED','txid':_0x3a5697,'notes':_0x3be5bf,'periodFrom':_0xcd6f32?new Date(_0xcd6f32):null,'periodTo':_0x4be948?new Date(_0x4be948):null});const _0x526939=await _0x296fd1['payout']['create']({'data':{'shopId':_0x4c3e31,'amount':_0x511538,'network':_0x369587,'wallet':_0x35c6bb,'status':'COMPLETED','txid':_0x3a5697,'notes':_0x3be5bf,'periodFrom':_0xcd6f32?new Date(_0xcd6f32):null,'periodTo':_0x4be948?new Date(_0x4be948):null,'createdAt':new Date(),'paidAt':new Date()}});console['log'](_0x4c551c(0x2e9),{'id':_0x526939['id'],'wallet':_0x526939[_0x4c551c(0x1e4)],'network':_0x526939[_0x4c551c(0x277)],'amount':_0x526939['amount']});const _0x4b69af=_0x1cd9cb-_0x511538,_0x2ee541=Number(_0x46328d[_0x4c551c(0x1fa)])+_0x511538;return await _0x296fd1[_0x4c551c(0x2f1)][_0x4c551c(0x1ee)]({'where':{'id':_0x4c3e31},'data':{'balance':_0x4b69af,'totalPaidOut':_0x2ee541}}),console[_0x4c551c(0x217)](_0x4c551c(0x1de)+_0x46328d[_0x4c551c(0x252)]+'\x20balance\x20updated:'),console['log'](_0x4c551c(0x20a)+_0x1cd9cb[_0x4c551c(0x2d7)](0x6)+'\x20->\x20'+_0x4b69af[_0x4c551c(0x2d7)](0x6)+'\x20USDT\x20(-'+_0x511538['toFixed'](0x6)+')'),console['log'](_0x4c551c(0x1be)+_0x46328d[_0x4c551c(0x1fa)][_0x4c551c(0x2d7)](0x6)+_0x4c551c(0x2dc)+_0x2ee541['toFixed'](0x6)+_0x4c551c(0x1cc)+_0x511538[_0x4c551c(0x2d7)](0x6)+')'),console['log'](_0x4c551c(0x2bd)+_0x511538[_0x4c551c(0x2d7)](0x6)+'\x20USDT'),{'payout':_0x526939,'shop':_0x46328d};});console['log'](_0x276a88(0x24b)+_0x255aaa[_0x276a88(0x1d2)]['id']+_0x276a88(0x1e3)+_0x255aaa[_0x276a88(0x2f1)][_0x276a88(0x252)]+'\x20('+_0x255aaa['payout'][_0x276a88(0x1c4)][_0x276a88(0x2d7)](0x6)+_0x276a88(0x244));try{let _0x5045bb=_0x276a88(0x1ae);if(_0x255aaa[_0x276a88(0x1d2)][_0x276a88(0x216)]&&_0x255aaa[_0x276a88(0x1d2)][_0x276a88(0x2e6)]){const _0xa4d5a2=new Date(_0x255aaa[_0x276a88(0x1d2)][_0x276a88(0x216)])['toLocaleDateString'](_0x276a88(0x1fb)),_0x1a3fa8=new Date(_0x255aaa[_0x276a88(0x1d2)][_0x276a88(0x2e6)])[_0x276a88(0x2c5)]('ru-RU');_0x5045bb=_0xa4d5a2+_0x276a88(0x1b7)+_0x1a3fa8;}await telegramBotService_1[_0x276a88(0x26a)][_0x276a88(0x2ba)](_0x255aaa[_0x276a88(0x1d2)][_0x276a88(0x2b2)],{'id':_0x255aaa[_0x276a88(0x1d2)]['id'],'amount':_0x255aaa['payout'][_0x276a88(0x1c4)],'network':_0x255aaa['payout']['network'],'wallet':_0x255aaa[_0x276a88(0x1d2)][_0x276a88(0x1e4)],'period':_0x5045bb,'createdAt':_0x255aaa[_0x276a88(0x1d2)][_0x276a88(0x2b7)],'txid':_0x255aaa[_0x276a88(0x1d2)][_0x276a88(0x22a)]}),console[_0x276a88(0x217)]('ðŸ“±\x20Telegram\x20notification\x20sent\x20for\x20payout\x20'+_0x255aaa[_0x276a88(0x1d2)]['id']);}catch(_0x27f0d2){console['error'](_0x276a88(0x22f)+_0x255aaa['payout']['id']+':',_0x27f0d2);}return{'id':_0x255aaa['payout']['id'],'shopId':_0x255aaa['payout'][_0x276a88(0x2b2)],'shopName':_0x255aaa['shop'][_0x276a88(0x2a9)],'shopUsername':_0x255aaa[_0x276a88(0x2f1)]['username'],'amount':_0x255aaa['payout'][_0x276a88(0x1c4)],'network':_0x255aaa[_0x276a88(0x1d2)][_0x276a88(0x277)],'wallet':_0x255aaa[_0x276a88(0x1d2)][_0x276a88(0x1e4)],'status':_0x255aaa[_0x276a88(0x1d2)][_0x276a88(0x1da)],'txid':_0x255aaa[_0x276a88(0x1d2)]['txid'],'notes':_0x255aaa['payout']['notes'],'periodFrom':_0x255aaa[_0x276a88(0x1d2)][_0x276a88(0x216)],'periodTo':_0x255aaa[_0x276a88(0x1d2)][_0x276a88(0x2e6)],'createdAt':_0x255aaa[_0x276a88(0x1d2)][_0x276a88(0x2b7)],'paidAt':_0x255aaa[_0x276a88(0x1d2)][_0x276a88(0x199)]};}async[a46_0x36f641(0x25d)](_0xb305b5){const _0x1801b3=a46_0x36f641,{page:_0xbb87fd,limit:_0x2106f7,shopId:_0x1f1406,network:_0x47cfcb,dateFrom:_0x55a563,dateTo:_0x58deb0,search:_0x595adf}=_0xb305b5,_0x566f9c=(_0xbb87fd-0x1)*_0x2106f7,_0x235568={};_0x1f1406&&(_0x235568[_0x1801b3(0x2b2)]=_0x1f1406);_0x47cfcb&&(_0x235568[_0x1801b3(0x277)]=_0x47cfcb);if(_0x55a563||_0x58deb0){_0x235568['createdAt']={};if(_0x55a563){const _0x3182aa=new Date(_0x55a563);_0x3182aa['setHours'](0x0,0x0,0x0,0x1),_0x235568['createdAt'][_0x1801b3(0x222)]=_0x3182aa,console[_0x1801b3(0x217)]('ðŸ“…\x20Payout\x20date\x20from\x20filter:\x20'+_0x3182aa[_0x1801b3(0x2ef)]());}if(_0x58deb0){const _0x2a666b=new Date(_0x58deb0);_0x2a666b[_0x1801b3(0x1f3)](0x17,0x3b,0x3b,0x3e7),_0x235568[_0x1801b3(0x2b7)]['lte']=_0x2a666b,console[_0x1801b3(0x217)](_0x1801b3(0x249)+_0x2a666b[_0x1801b3(0x2ef)]());}}_0x595adf&&(_0x235568['OR']=[{'shop':{'name':{'contains':_0x595adf,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x595adf,'mode':_0x1801b3(0x2c9)}}},{'notes':{'contains':_0x595adf,'mode':'insensitive'}}]);const [_0x4dd076,_0x232212]=await Promise['all']([database_1['default'][_0x1801b3(0x1d2)][_0x1801b3(0x306)]({'where':_0x235568,'skip':_0x566f9c,'take':_0x2106f7,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'wallet':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x1801b3(0x237)][_0x1801b3(0x1d2)][_0x1801b3(0x2c3)]({'where':_0x235568})]);return{'payouts':_0x4dd076['map'](_0x2b1803=>({'id':_0x2b1803['id'],'shopId':_0x2b1803[_0x1801b3(0x2b2)],'shopName':_0x2b1803[_0x1801b3(0x2f1)][_0x1801b3(0x2a9)],'shopUsername':_0x2b1803[_0x1801b3(0x2f1)]['username'],'amount':_0x2b1803[_0x1801b3(0x1c4)],'network':_0x2b1803[_0x1801b3(0x277)],'wallet':_0x2b1803[_0x1801b3(0x1e4)],'status':_0x2b1803['status'],'txid':_0x2b1803[_0x1801b3(0x22a)],'notes':_0x2b1803[_0x1801b3(0x2ac)],'periodFrom':_0x2b1803[_0x1801b3(0x216)],'periodTo':_0x2b1803[_0x1801b3(0x2e6)],'createdAt':_0x2b1803[_0x1801b3(0x2b7)],'paidAt':_0x2b1803[_0x1801b3(0x199)]})),'pagination':{'page':_0xbb87fd,'limit':_0x2106f7,'total':_0x232212,'totalPages':Math[_0x1801b3(0x2a2)](_0x232212/_0x2106f7)}};}async[a46_0x36f641(0x206)](_0x4e5611){const _0x24189f=a46_0x36f641,_0x84dbc0=await database_1[_0x24189f(0x237)][_0x24189f(0x1d2)][_0x24189f(0x19b)]({'where':{'id':_0x4e5611},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x84dbc0)return null;return{'id':_0x84dbc0['id'],'shopId':_0x84dbc0[_0x24189f(0x2b2)],'shopName':_0x84dbc0[_0x24189f(0x2f1)][_0x24189f(0x2a9)],'shopUsername':_0x84dbc0[_0x24189f(0x2f1)][_0x24189f(0x252)],'amount':_0x84dbc0[_0x24189f(0x1c4)],'network':_0x84dbc0[_0x24189f(0x277)],'wallet':_0x84dbc0[_0x24189f(0x1e4)],'status':_0x84dbc0[_0x24189f(0x1da)],'txid':_0x84dbc0['txid'],'notes':_0x84dbc0[_0x24189f(0x2ac)],'periodFrom':_0x84dbc0[_0x24189f(0x216)],'periodTo':_0x84dbc0[_0x24189f(0x2e6)],'createdAt':_0x84dbc0[_0x24189f(0x2b7)],'paidAt':_0x84dbc0[_0x24189f(0x199)]};}async['deletePayout'](_0x2cd0a4){const _0x3b629a=a46_0x36f641;await database_1[_0x3b629a(0x237)]['payout']['delete']({'where':{'id':_0x2cd0a4}});}async[a46_0x36f641(0x2f9)](_0x44ab9f){const _0xc1a428=a46_0x36f641,{page:_0xb6901e,limit:_0x2d553b,status:_0xc16bc2,gateway:_0x64f162,shopId:_0x40db66,dateFrom:_0x4c334a,dateTo:_0x1e4480,search:_0x1edb37,currency:_0xdce8c5,sortBy:_0x1a22b7,sortOrder:_0x18188b}=_0x44ab9f,_0x2b148b=(_0xb6901e-0x1)*_0x2d553b;console[_0xc1a428(0x217)]('ðŸ“Š\x20Getting\x20payments\x20with\x20filters:',_0x44ab9f);const _0x586dba=await database_1['default'][_0xc1a428(0x2ee)][_0xc1a428(0x2d5)]({'by':[_0xc1a428(0x232)],'_count':{'gateway':!![]}});console[_0xc1a428(0x217)](_0xc1a428(0x2c7),_0x586dba['map'](_0x43ccc5=>_0x43ccc5['gateway']+'\x20('+_0x43ccc5['_count'][_0xc1a428(0x232)]+'\x20payments)'));if(_0x64f162){const _0x1caa35=_0x586dba[_0xc1a428(0x1d4)](_0x4daaa7=>_0x4daaa7[_0xc1a428(0x232)][_0xc1a428(0x21b)]()===_0x64f162[_0xc1a428(0x21b)]());!_0x1caa35&&_0x64f162[_0xc1a428(0x21b)]()!==_0xc1a428(0x1c6)&&console[_0xc1a428(0x217)]('âš ï¸\x20Requested\x20gateway\x20\x27'+_0x64f162+_0xc1a428(0x1f1)+_0x586dba[_0xc1a428(0x1cd)](_0x1c4c9a=>_0x1c4c9a[_0xc1a428(0x232)])['join'](',\x20'));}const _0x34f2b3={};_0xc16bc2&&(_0x34f2b3[_0xc1a428(0x1da)]=_0xc16bc2[_0xc1a428(0x1ca)]());if(!_0x64f162)_0x34f2b3[_0xc1a428(0x232)]={'not':'test_gateway'};else{if(_0x64f162&&(_0x64f162[_0xc1a428(0x21b)]()===_0xc1a428(0x1c6)||_0x64f162===_0xc1a428(0x258)))_0x34f2b3[_0xc1a428(0x232)]=_0xc1a428(0x1c6);else{let _0x5f1248=_0x64f162;const _0x5486f7=(0x0,gateway_1[_0xc1a428(0x2f5)])(_0x64f162);if(_0x5486f7)_0x5f1248=_0x5486f7,console['log'](_0xc1a428(0x298)+_0x64f162+_0xc1a428(0x1f2)+_0x5f1248+'\x27');else{const _0x4506a6=(0x0,gateway_1['getGatewayIdByName'])(_0x64f162);if(_0x4506a6){const _0x376834=(0x0,gateway_1[_0xc1a428(0x2f5)])(_0x4506a6);_0x376834&&(_0x5f1248=_0x376834,console['log'](_0xc1a428(0x211)+_0x64f162+_0xc1a428(0x2b3)+_0x4506a6+'\x27\x20->\x20name\x20\x27'+_0x5f1248+'\x27'));}else console[_0xc1a428(0x217)]('ðŸ”\x20Using\x20gateway\x20\x27'+_0x64f162+_0xc1a428(0x295));}const _0x3fb787=await database_1['default'][_0xc1a428(0x2ee)]['count']({'where':{'gateway':_0x5f1248[_0xc1a428(0x21b)]()},'take':0x1});_0x3fb787===0x0?(console['log']('âš ï¸\x20Gateway\x20\x27'+_0x5f1248+_0xc1a428(0x1a8)+_0x64f162+_0xc1a428(0x302)),_0x34f2b3['gateway']=_0xc1a428(0x2dd)):(_0x34f2b3[_0xc1a428(0x232)]=_0x5f1248['toLowerCase'](),console[_0xc1a428(0x217)](_0xc1a428(0x19e)+_0x5f1248+'\x27\x20(from\x20\x27'+_0x64f162+'\x27)'));}}console[_0xc1a428(0x217)](_0xc1a428(0x20f),_0x34f2b3[_0xc1a428(0x232)]);_0x40db66&&(_0x34f2b3[_0xc1a428(0x2b2)]=_0x40db66);_0xdce8c5&&(_0x34f2b3[_0xc1a428(0x1d5)]=_0xdce8c5[_0xc1a428(0x1ca)](),console['log'](_0xc1a428(0x275)+_0xdce8c5[_0xc1a428(0x1ca)]()));if(_0x4c334a||_0x1e4480){_0x34f2b3[_0xc1a428(0x2b7)]={};if(_0x4c334a){const _0x2ff96f=new Date(_0x4c334a);_0x2ff96f[_0xc1a428(0x1f3)](0x0,0x0,0x0,0x1),_0x34f2b3[_0xc1a428(0x2b7)][_0xc1a428(0x222)]=_0x2ff96f,console[_0xc1a428(0x217)](_0xc1a428(0x29b)+_0x2ff96f[_0xc1a428(0x2ef)]());}if(_0x1e4480){const _0x39e0cd=new Date(_0x1e4480);_0x39e0cd[_0xc1a428(0x1f3)](0x17,0x3b,0x3b,0x3e7),_0x34f2b3[_0xc1a428(0x2b7)][_0xc1a428(0x22d)]=_0x39e0cd,console[_0xc1a428(0x217)]('ðŸ“…\x20Date\x20to\x20filter:\x20'+_0x39e0cd['toISOString']());}}_0x1edb37&&(_0x34f2b3['OR']=[{'id':{'contains':_0x1edb37,'mode':_0xc1a428(0x2c9)}},{'orderId':{'contains':_0x1edb37,'mode':_0xc1a428(0x2c9)}},{'gatewayOrderId':{'contains':_0x1edb37,'mode':_0xc1a428(0x2c9)}},{'customerEmail':{'contains':_0x1edb37,'mode':_0xc1a428(0x2c9)}},{'shop':{'name':{'contains':_0x1edb37,'mode':_0xc1a428(0x2c9)}}},{'shop':{'username':{'contains':_0x1edb37,'mode':'insensitive'}}}]);console[_0xc1a428(0x217)](_0xc1a428(0x27a),JSON[_0xc1a428(0x2f6)](_0x34f2b3,null,0x2));let _0x1b7b3c={'createdAt':'desc'};if(_0x1a22b7){const _0x53482c=['amount',_0xc1a428(0x2b7),'updatedAt',_0xc1a428(0x1da),'gateway',_0xc1a428(0x1d5)],_0x5a1cf7=['asc',_0xc1a428(0x1a7)];if(_0x53482c['includes'](_0x1a22b7)){const _0x43ac59=_0x5a1cf7['includes'](_0x18188b)?_0x18188b:'desc';_0x1b7b3c={[_0x1a22b7]:_0x43ac59},console['log'](_0xc1a428(0x2a7)+_0x1a22b7+'\x20in\x20'+_0x43ac59+_0xc1a428(0x2fc));}}const [_0x12f93a,_0x2cfbc3]=await Promise[_0xc1a428(0x297)]([database_1['default'][_0xc1a428(0x2ee)]['findMany']({'where':_0x34f2b3,'skip':_0x2b148b,'take':_0x2d553b,'orderBy':_0x1b7b3c,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0xc1a428(0x237)][_0xc1a428(0x2ee)][_0xc1a428(0x2c3)]({'where':_0x34f2b3})]);return{'payments':_0x12f93a,'pagination':{'page':_0xb6901e,'limit':_0x2d553b,'total':_0x2cfbc3,'totalPages':Math['ceil'](_0x2cfbc3/_0x2d553b)}};}async[a46_0x36f641(0x261)](_0x232e28){const _0x24cfe6=a46_0x36f641,_0x1b9aa5=await database_1[_0x24cfe6(0x237)][_0x24cfe6(0x2ee)][_0x24cfe6(0x19b)]({'where':{'id':_0x232e28},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x1b9aa5)return null;return{'id':_0x1b9aa5['id'],'shopId':_0x1b9aa5[_0x24cfe6(0x2b2)],'gateway':_0x1b9aa5['gateway'],'amount':_0x1b9aa5[_0x24cfe6(0x1c4)],'currency':_0x1b9aa5[_0x24cfe6(0x1d5)],'status':_0x1b9aa5[_0x24cfe6(0x1da)],'orderId':_0x1b9aa5[_0x24cfe6(0x2c1)],'gatewayOrderId':_0x1b9aa5[_0x24cfe6(0x1d0)],'customerEmail':_0x1b9aa5[_0x24cfe6(0x21d)],'customerName':_0x1b9aa5[_0x24cfe6(0x1d8)],'customerCountry':_0x1b9aa5[_0x24cfe6(0x1e8)],'customerIp':_0x1b9aa5[_0x24cfe6(0x1c7)],'customerUa':_0x1b9aa5[_0x24cfe6(0x1e9)],'failureMessage':_0x1b9aa5[_0x24cfe6(0x230)],'externalPaymentUrl':_0x1b9aa5[_0x24cfe6(0x2c8)],'successUrl':_0x1b9aa5['successUrl'],'failUrl':_0x1b9aa5[_0x24cfe6(0x1fc)],'pendingUrl':_0x1b9aa5[_0x24cfe6(0x20c)],'whiteUrl':_0x1b9aa5[_0x24cfe6(0x2c2)],'createdAt':_0x1b9aa5[_0x24cfe6(0x2b7)],'updatedAt':_0x1b9aa5[_0x24cfe6(0x1c9)],'shop':_0x1b9aa5[_0x24cfe6(0x2f1)]};}async[a46_0x36f641(0x1bc)](_0x523b30,_0x3f1d96,_0x25a1c2,_0xa83de2){const _0x459a68=a46_0x36f641,_0x503f79=await database_1[_0x459a68(0x237)][_0x459a68(0x221)](async _0x1ec1ff=>{const _0x17eee6=_0x459a68,_0x54e12a=await _0x1ec1ff[_0x17eee6(0x2ee)][_0x17eee6(0x19b)]({'where':{'id':_0x523b30},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x54e12a)throw new Error(_0x17eee6(0x240));const _0x3ebfd2=_0x54e12a[_0x17eee6(0x1da)],_0x3b4042=_0x3f1d96[_0x17eee6(0x1ca)]();console[_0x17eee6(0x217)]('ðŸ”„\x20Admin\x20updating\x20payment\x20'+_0x523b30+_0x17eee6(0x2ab)+_0x3ebfd2+_0x17eee6(0x2dc)+_0x3b4042),console[_0x17eee6(0x217)](_0x17eee6(0x1a5)+_0x54e12a[_0x17eee6(0x2f1)][_0x17eee6(0x1b5)]+'\x20USDT');const _0x467f98={'status':_0x3b4042,'updatedAt':new Date(),'statusChangedBy':_0x17eee6(0x2b5),'statusChangedAt':new Date()};_0x25a1c2&&(_0x467f98[_0x17eee6(0x225)]=_0x25a1c2);_0x3b4042===_0x17eee6(0x26b)&&_0xa83de2&&(_0x467f98[_0x17eee6(0x1bd)]=_0xa83de2);let _0x5c809e=0x0,_0x1f8987=_0x54e12a[_0x17eee6(0x2f1)]['balance'];if(_0x3b4042===_0x17eee6(0x1f8)&&_0x3ebfd2!==_0x17eee6(0x1f8)){_0x467f98[_0x17eee6(0x199)]=new Date();const _0x17055a=await currencyService_1[_0x17eee6(0x2f4)][_0x17eee6(0x25f)](_0x54e12a[_0x17eee6(0x1c4)],_0x54e12a[_0x17eee6(0x1d5)]);_0x467f98[_0x17eee6(0x205)]=_0x17055a;let _0x492cd6=0x2d;const _0x50eabd=await _0x1ec1ff[_0x17eee6(0x2f1)][_0x17eee6(0x19b)]({'where':{'id':_0x54e12a[_0x17eee6(0x2b2)]},'select':{'gatewaySettings':!![]}});if(_0x50eabd?.[_0x17eee6(0x203)])try{const _0x2fe9bb=JSON[_0x17eee6(0x204)](_0x50eabd[_0x17eee6(0x203)]);for(const [_0x6185c,_0x138aef]of Object[_0x17eee6(0x266)](_0x2fe9bb)){if(_0x6185c[_0x17eee6(0x21b)]()===_0x54e12a['gateway'][_0x17eee6(0x21b)]()){_0x492cd6=_0x138aef[_0x17eee6(0x2ad)]||0xa;break;}}}catch(_0x10a48e){console['error'](_0x17eee6(0x1ec)+_0x523b30+':',_0x10a48e);}let _0x47ccbb;_0x54e12a[_0x17eee6(0x1a1)]!==null&&_0x54e12a[_0x17eee6(0x1a1)]!==undefined?(_0x47ccbb=_0x54e12a['amountAfterGatewayCommissionUSDT'],console[_0x17eee6(0x217)](_0x17eee6(0x226)+_0x47ccbb[_0x17eee6(0x2d7)](0x6)+_0x17eee6(0x25e)+_0x523b30)):(_0x47ccbb=_0x17055a*(0x1-_0x492cd6/0x64),console[_0x17eee6(0x217)](_0x17eee6(0x28f)+_0x523b30+':\x20'+_0x492cd6+'%\x20from\x20'+_0x17055a[_0x17eee6(0x2d7)](0x6)+_0x17eee6(0x2d9)),_0x467f98[_0x17eee6(0x1a1)]=_0x47ccbb,_0x467f98['gatewayCommissionRate']=_0x492cd6),_0x5c809e=_0x47ccbb,_0x1f8987+=_0x47ccbb,console['log']('ðŸ’°\x20Payment\x20'+_0x523b30+'\x20became\x20PAID:'),console['log']('\x20\x20\x20Full\x20amount:\x20'+_0x17055a[_0x17eee6(0x2d7)](0x6)+_0x17eee6(0x2d9)),console[_0x17eee6(0x217)](_0x17eee6(0x1db)+_0x54e12a[_0x17eee6(0x232)]+_0x17eee6(0x1e1)+_0x492cd6+'%'),console[_0x17eee6(0x217)]('\x20\x20\x20Merchant\x20gets:\x20'+_0x47ccbb['toFixed'](0x6)+_0x17eee6(0x2de)+_0x492cd6+_0x17eee6(0x29c)),console[_0x17eee6(0x217)](_0x17eee6(0x215)+_0x47ccbb[_0x17eee6(0x2d7)](0x6)+_0x17eee6(0x2d9));}else{if(_0x3ebfd2===_0x17eee6(0x1f8)&&_0x3b4042!=='PAID'&&_0x3b4042!==_0x17eee6(0x26b)){if(_0x54e12a[_0x17eee6(0x205)]){let _0x10c6d7=0x2d;const _0x291a1f=await _0x1ec1ff[_0x17eee6(0x2f1)][_0x17eee6(0x19b)]({'where':{'id':_0x54e12a[_0x17eee6(0x2b2)]},'select':{'gatewaySettings':!![]}});if(_0x291a1f?.[_0x17eee6(0x203)])try{const _0x692042=JSON[_0x17eee6(0x204)](_0x291a1f['gatewaySettings']);for(const [_0x5775ad,_0x65b256]of Object[_0x17eee6(0x266)](_0x692042)){if(_0x5775ad[_0x17eee6(0x21b)]()===_0x54e12a[_0x17eee6(0x232)][_0x17eee6(0x21b)]()){_0x10c6d7=_0x65b256[_0x17eee6(0x2ad)]||0xa;break;}}}catch(_0x23c1aa){console[_0x17eee6(0x280)](_0x17eee6(0x1ec)+_0x523b30+':',_0x23c1aa);}const _0x422182=_0x54e12a[_0x17eee6(0x205)]*(0x1-_0x10c6d7/0x64);_0x5c809e=-_0x422182,_0x1f8987-=_0x422182,console['log'](_0x17eee6(0x2bc)+_0x54e12a['amountUSDT'][_0x17eee6(0x2d7)](0x6)+'\x20USDT'),console[_0x17eee6(0x217)]('\x20\x20\x20Gateway:\x20'+_0x54e12a['gateway']+_0x17eee6(0x1e1)+_0x10c6d7+'%'),console['log'](_0x17eee6(0x2f3)+_0x422182[_0x17eee6(0x2d7)](0x6)+_0x17eee6(0x2de)+_0x10c6d7+_0x17eee6(0x29c)),console[_0x17eee6(0x217)](_0x17eee6(0x2a5)+_0x422182['toFixed'](0x6)+_0x17eee6(0x2d9));}}}_0x3b4042===_0x17eee6(0x26b)&&(console['log'](_0x17eee6(0x1a9)),_0xa83de2&&_0xa83de2>0x0?(_0x5c809e=-_0xa83de2,_0x1f8987-=_0xa83de2,console[_0x17eee6(0x217)](_0x17eee6(0x286)+_0xa83de2['toFixed'](0x6)+'\x20USDT\x20from\x20balance'),console[_0x17eee6(0x217)](_0x17eee6(0x1c2))):console[_0x17eee6(0x217)](_0x17eee6(0x1a3)),_0x467f98['chargebackAmount']=_0xa83de2||0x0);_0x3b4042===_0x17eee6(0x234)&&_0x3ebfd2===_0x17eee6(0x1f8)&&console['log']('ðŸ”„\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance');const _0x24d8af=await _0x1ec1ff['payment'][_0x17eee6(0x1ee)]({'where':{'id':_0x523b30},'data':_0x467f98,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x5c809e!==0x0&&(await _0x1ec1ff[_0x17eee6(0x2f1)][_0x17eee6(0x1ee)]({'where':{'id':_0x54e12a[_0x17eee6(0x2b2)]},'data':{'balance':_0x1f8987}}),console[_0x17eee6(0x217)](_0x17eee6(0x1de)+_0x54e12a[_0x17eee6(0x2b2)]+_0x17eee6(0x2a6)+_0x54e12a[_0x17eee6(0x2f1)][_0x17eee6(0x1b5)][_0x17eee6(0x2d7)](0x6)+_0x17eee6(0x2dc)+_0x1f8987[_0x17eee6(0x2d7)](0x6)+'\x20USDT\x20('+(_0x5c809e>0x0?'+':'')+_0x5c809e['toFixed'](0x6)+')')),_0x24d8af;});return{'id':_0x503f79['id'],'shopId':_0x503f79[_0x459a68(0x2b2)],'gateway':_0x503f79[_0x459a68(0x232)],'amount':_0x503f79[_0x459a68(0x1c4)],'currency':_0x503f79['currency'],'status':_0x503f79['status'],'orderId':_0x503f79[_0x459a68(0x2c1)],'gatewayOrderId':_0x503f79[_0x459a68(0x1d0)],'customerEmail':_0x503f79[_0x459a68(0x21d)],'customerName':_0x503f79['customerName'],'customerCountry':_0x503f79[_0x459a68(0x1e8)],'customerIp':_0x503f79['customerIp'],'customerUa':_0x503f79[_0x459a68(0x1e9)],'failureMessage':_0x503f79[_0x459a68(0x230)],'adminNotes':_0x503f79['adminNotes'],'chargebackAmount':_0x503f79[_0x459a68(0x1bd)],'statusChangedBy':_0x503f79['statusChangedBy'],'statusChangedAt':_0x503f79[_0x459a68(0x1d1)],'createdAt':_0x503f79['createdAt'],'updatedAt':_0x503f79[_0x459a68(0x1c9)],'shop':_0x503f79[_0x459a68(0x2f1)]};}async['updateUser'](_0x2cf49b,_0x5c98b2){const _0x2fe2eb=a46_0x36f641,_0x56a2c0=Math[_0x2fe2eb(0x21a)]()['toString'](0x24)[_0x2fe2eb(0x2f2)](0x2,0x9);console[_0x2fe2eb(0x217)](_0x2fe2eb(0x1e6)+_0x56a2c0+_0x2fe2eb(0x2d1)+_0x2cf49b);const _0x2b16b4={..._0x5c98b2};_0x5c98b2['password']&&_0x5c98b2[_0x2fe2eb(0x1ef)][_0x2fe2eb(0x2ec)]()!==''?(console[_0x2fe2eb(0x217)]('ðŸ”\x20['+_0x56a2c0+_0x2fe2eb(0x2e1)+_0x2cf49b),_0x2b16b4[_0x2fe2eb(0x1ef)]=await bcryptjs_1[_0x2fe2eb(0x237)]['hash'](_0x5c98b2[_0x2fe2eb(0x1ef)],0xc)):(console[_0x2fe2eb(0x217)](_0x2fe2eb(0x1ac)+_0x56a2c0+']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update'),delete _0x2b16b4[_0x2fe2eb(0x1ef)]);_0x5c98b2[_0x2fe2eb(0x233)]&&(_0x2b16b4[_0x2fe2eb(0x2a9)]=_0x5c98b2[_0x2fe2eb(0x233)],delete _0x2b16b4[_0x2fe2eb(0x233)]);_0x5c98b2[_0x2fe2eb(0x2a8)]&&(_0x2b16b4[_0x2fe2eb(0x26c)]=_0x5c98b2[_0x2fe2eb(0x2a8)],delete _0x2b16b4[_0x2fe2eb(0x2a8)]);_0x5c98b2[_0x2fe2eb(0x28d)]&&(_0x2b16b4[_0x2fe2eb(0x219)]=_0x5c98b2[_0x2fe2eb(0x28d)],delete _0x2b16b4[_0x2fe2eb(0x28d)]);if(_0x5c98b2[_0x2fe2eb(0x209)]){const _0x5608b0=_0x5c98b2[_0x2fe2eb(0x209)][_0x2fe2eb(0x1cd)](_0x1e08aa=>this[_0x2fe2eb(0x1cb)](_0x1e08aa));console[_0x2fe2eb(0x217)](_0x2fe2eb(0x259),_0x5c98b2[_0x2fe2eb(0x209)],'->',_0x5608b0),_0x2b16b4[_0x2fe2eb(0x1aa)]=JSON[_0x2fe2eb(0x2f6)](_0x5608b0),delete _0x2b16b4[_0x2fe2eb(0x209)];}_0x5c98b2[_0x2fe2eb(0x203)]&&(console[_0x2fe2eb(0x217)]('ðŸ”§\x20['+_0x56a2c0+_0x2fe2eb(0x1e0),_0x5c98b2[_0x2fe2eb(0x203)]),_0x2b16b4[_0x2fe2eb(0x203)]=JSON[_0x2fe2eb(0x2f6)](_0x5c98b2[_0x2fe2eb(0x203)]),console['log']('ðŸ”§\x20['+_0x56a2c0+_0x2fe2eb(0x260),_0x2b16b4['gatewaySettings']));_0x5c98b2[_0x2fe2eb(0x1f9)]&&(_0x5c98b2['wallets'][_0x2fe2eb(0x1ba)]!==undefined&&(_0x2b16b4['usdtPolygonWallet']=_0x5c98b2[_0x2fe2eb(0x1f9)][_0x2fe2eb(0x1ba)]||null),_0x5c98b2[_0x2fe2eb(0x1f9)]['usdtTrcWallet']!==undefined&&(_0x2b16b4[_0x2fe2eb(0x24e)]=_0x5c98b2['wallets'][_0x2fe2eb(0x24e)]||null),_0x5c98b2[_0x2fe2eb(0x1f9)][_0x2fe2eb(0x283)]!==undefined&&(_0x2b16b4[_0x2fe2eb(0x283)]=_0x5c98b2['wallets'][_0x2fe2eb(0x283)]||null),_0x5c98b2[_0x2fe2eb(0x1f9)][_0x2fe2eb(0x2d3)]!==undefined&&(_0x2b16b4[_0x2fe2eb(0x2d3)]=_0x5c98b2[_0x2fe2eb(0x1f9)]['usdcPolygonWallet']||null),delete _0x2b16b4['wallets']);const _0x8da7ea=await database_1['default'][_0x2fe2eb(0x2f1)][_0x2fe2eb(0x1ee)]({'where':{'id':_0x2cf49b},'data':_0x2b16b4,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0x2fe2eb(0x217)](_0x2fe2eb(0x1c3)+_0x56a2c0+_0x2fe2eb(0x25c),_0x8da7ea[_0x2fe2eb(0x203)]),{'id':_0x8da7ea['id'],'fullName':_0x8da7ea[_0x2fe2eb(0x2a9)],'username':_0x8da7ea['username'],'telegramId':_0x8da7ea['telegram'],'merchantUrl':_0x8da7ea[_0x2fe2eb(0x219)],'gateways':_0x8da7ea[_0x2fe2eb(0x1aa)]?JSON[_0x2fe2eb(0x204)](_0x8da7ea[_0x2fe2eb(0x1aa)]):null,'gatewaySettings':_0x8da7ea['gatewaySettings']?JSON[_0x2fe2eb(0x204)](_0x8da7ea['gatewaySettings']):null,'publicKey':_0x8da7ea['publicKey'],'wallets':{'usdtPolygonWallet':_0x8da7ea['usdtPolygonWallet'],'usdtTrcWallet':_0x8da7ea['usdtTrcWallet'],'usdtErcWallet':_0x8da7ea[_0x2fe2eb(0x283)],'usdcPolygonWallet':_0x8da7ea[_0x2fe2eb(0x2d3)]},'status':_0x8da7ea[_0x2fe2eb(0x1da)],'createdAt':_0x8da7ea[_0x2fe2eb(0x2b7)]};}async[a46_0x36f641(0x1a0)](_0x2c5458){const _0x1d3ef7=a46_0x36f641,_0x2bee11=await database_1['default']['shop'][_0x1d3ef7(0x1ee)]({'where':{'id':_0x2c5458},'data':{'status':'SUSPENDED'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2bee11['id'],'fullName':_0x2bee11[_0x1d3ef7(0x2a9)],'username':_0x2bee11[_0x1d3ef7(0x252)],'telegramId':_0x2bee11[_0x1d3ef7(0x26c)],'merchantUrl':_0x2bee11[_0x1d3ef7(0x219)],'gateways':_0x2bee11['paymentGateways']?JSON[_0x1d3ef7(0x204)](_0x2bee11[_0x1d3ef7(0x1aa)]):null,'gatewaySettings':_0x2bee11['gatewaySettings']?JSON[_0x1d3ef7(0x204)](_0x2bee11[_0x1d3ef7(0x203)]):null,'publicKey':_0x2bee11[_0x1d3ef7(0x26d)],'wallets':{'usdtPolygonWallet':_0x2bee11[_0x1d3ef7(0x1ba)],'usdtTrcWallet':_0x2bee11[_0x1d3ef7(0x24e)],'usdtErcWallet':_0x2bee11[_0x1d3ef7(0x283)],'usdcPolygonWallet':_0x2bee11['usdcPolygonWallet']},'status':_0x2bee11[_0x1d3ef7(0x1da)],'createdAt':_0x2bee11[_0x1d3ef7(0x2b7)]};}async[a46_0x36f641(0x1c5)](_0x29255d){const _0x34cc78=a46_0x36f641,_0x2e3986=await database_1[_0x34cc78(0x237)][_0x34cc78(0x2f1)][_0x34cc78(0x1ee)]({'where':{'id':_0x29255d},'data':{'status':_0x34cc78(0x1ad)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2e3986['id'],'fullName':_0x2e3986[_0x34cc78(0x2a9)],'username':_0x2e3986[_0x34cc78(0x252)],'telegramId':_0x2e3986[_0x34cc78(0x26c)],'merchantUrl':_0x2e3986[_0x34cc78(0x219)],'gateways':_0x2e3986[_0x34cc78(0x1aa)]?JSON['parse'](_0x2e3986[_0x34cc78(0x1aa)]):null,'gatewaySettings':_0x2e3986[_0x34cc78(0x203)]?JSON[_0x34cc78(0x204)](_0x2e3986[_0x34cc78(0x203)]):null,'publicKey':_0x2e3986[_0x34cc78(0x26d)],'wallets':{'usdtPolygonWallet':_0x2e3986[_0x34cc78(0x1ba)],'usdtTrcWallet':_0x2e3986[_0x34cc78(0x24e)],'usdtErcWallet':_0x2e3986[_0x34cc78(0x283)],'usdcPolygonWallet':_0x2e3986['usdcPolygonWallet']},'status':_0x2e3986[_0x34cc78(0x1da)],'createdAt':_0x2e3986['createdAt']};}async['getAllUsers'](_0x3a542c){const _0x3b23ff=a46_0x36f641,{page:_0x323bdb,limit:_0x35597b,status:_0x3414da}=_0x3a542c,_0x2f5b61=(_0x323bdb-0x1)*_0x35597b,_0x3773b8={};_0x3414da&&(_0x3773b8['status']=_0x3414da['toUpperCase']());const [_0x140d0d,_0xf25b89]=await Promise[_0x3b23ff(0x297)]([database_1[_0x3b23ff(0x237)][_0x3b23ff(0x2f1)][_0x3b23ff(0x306)]({'where':_0x3773b8,'skip':_0x2f5b61,'take':_0x35597b,'orderBy':{'createdAt':_0x3b23ff(0x1a7)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x3b23ff(0x237)][_0x3b23ff(0x2f1)][_0x3b23ff(0x2c3)]({'where':_0x3773b8})]);return{'users':_0x140d0d[_0x3b23ff(0x1cd)](_0x2bd696=>{const _0x2df529=_0x3b23ff,_0x3c48a5=_0x2bd696[_0x2df529(0x1aa)]?JSON['parse'](_0x2bd696[_0x2df529(0x1aa)]):null,_0x389ff1=_0x3c48a5?_0x3c48a5[_0x2df529(0x1cd)](_0x48cee4=>this[_0x2df529(0x2db)](_0x48cee4)):null;return{'id':_0x2bd696['id'],'fullName':_0x2bd696[_0x2df529(0x2a9)],'username':_0x2bd696[_0x2df529(0x252)],'telegramId':_0x2bd696[_0x2df529(0x26c)],'merchantUrl':_0x2bd696[_0x2df529(0x219)],'gateways':_0x389ff1,'gatewaySettings':_0x2bd696['gatewaySettings']?JSON[_0x2df529(0x204)](_0x2bd696[_0x2df529(0x203)]):null,'publicKey':_0x2bd696[_0x2df529(0x26d)],'wallets':{'usdtPolygonWallet':_0x2bd696[_0x2df529(0x1ba)],'usdtTrcWallet':_0x2bd696[_0x2df529(0x24e)],'usdtErcWallet':_0x2bd696['usdtErcWallet'],'usdcPolygonWallet':_0x2bd696[_0x2df529(0x2d3)]},'status':_0x2bd696['status'],'createdAt':_0x2bd696['createdAt']};}),'pagination':{'page':_0x323bdb,'limit':_0x35597b,'total':_0xf25b89,'totalPages':Math[_0x3b23ff(0x2a2)](_0xf25b89/_0x35597b)}};}async[a46_0x36f641(0x248)](_0x2f25cc){const _0xd6ab6f=a46_0x36f641,_0x34e224=await database_1[_0xd6ab6f(0x237)][_0xd6ab6f(0x2f1)]['findUnique']({'where':{'id':_0x2f25cc},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x34e224)return null;const _0x3d15e3=_0x34e224['paymentGateways']?JSON[_0xd6ab6f(0x204)](_0x34e224[_0xd6ab6f(0x1aa)]):null,_0x51de04=_0x3d15e3?_0x3d15e3[_0xd6ab6f(0x1cd)](_0x516961=>this[_0xd6ab6f(0x2db)](_0x516961)):null;return _0x3d15e3&&_0x51de04&&console['log'](_0xd6ab6f(0x2b4),_0x3d15e3,'->',_0x51de04),{'id':_0x34e224['id'],'fullName':_0x34e224[_0xd6ab6f(0x2a9)],'username':_0x34e224[_0xd6ab6f(0x252)],'telegramId':_0x34e224[_0xd6ab6f(0x26c)],'merchantUrl':_0x34e224['shopUrl'],'gateways':_0x51de04,'gatewaySettings':_0x34e224[_0xd6ab6f(0x203)]?JSON['parse'](_0x34e224[_0xd6ab6f(0x203)]):null,'publicKey':_0x34e224['publicKey'],'wallets':{'usdtPolygonWallet':_0x34e224[_0xd6ab6f(0x1ba)],'usdtTrcWallet':_0x34e224[_0xd6ab6f(0x24e)],'usdtErcWallet':_0x34e224[_0xd6ab6f(0x283)],'usdcPolygonWallet':_0x34e224[_0xd6ab6f(0x2d3)]},'status':_0x34e224[_0xd6ab6f(0x1da)],'createdAt':_0x34e224['createdAt']};}async[a46_0x36f641(0x2a1)](_0xaee0f6){const _0x3ed0a2=a46_0x36f641,{fullName:_0x17d792,username:_0x339705,password:_0xd37f44,telegramId:_0x2a21b3,merchantUrl:_0x51622b,gateways:_0x3e5dae,gatewaySettings:_0x5a320f,wallets:_0x12f212}=_0xaee0f6,_0x51a677=await database_1[_0x3ed0a2(0x237)][_0x3ed0a2(0x2f1)][_0x3ed0a2(0x19b)]({'where':{'username':_0x339705}});if(_0x51a677)throw new Error(_0x3ed0a2(0x2c4));if(_0x2a21b3){const _0x307c8d=await database_1['default'][_0x3ed0a2(0x2f1)][_0x3ed0a2(0x19b)]({'where':{'telegram':_0x2a21b3}});if(_0x307c8d)throw new Error(_0x3ed0a2(0x281));}const _0x356afe=await bcryptjs_1[_0x3ed0a2(0x237)][_0x3ed0a2(0x229)](_0xd37f44,0xc),_0x216a59='pk_'+crypto_1[_0x3ed0a2(0x237)]['randomBytes'](0x20)[_0x3ed0a2(0x2fe)]('hex'),_0x124a77='sk_'+crypto_1[_0x3ed0a2(0x237)][_0x3ed0a2(0x241)](0x20)[_0x3ed0a2(0x2fe)](_0x3ed0a2(0x2a4)),_0x3f8a64=_0x3e5dae?_0x3e5dae[_0x3ed0a2(0x1cd)](_0x232555=>this[_0x3ed0a2(0x1cb)](_0x232555)):null;_0x3e5dae&&_0x3f8a64&&console[_0x3ed0a2(0x217)](_0x3ed0a2(0x247),_0x3e5dae,'->',_0x3f8a64);const _0x54e6c4=await database_1[_0x3ed0a2(0x237)][_0x3ed0a2(0x2f1)][_0x3ed0a2(0x21e)]({'data':{'name':_0x17d792,'username':_0x339705,'password':_0x356afe,'telegram':_0x2a21b3,'shopUrl':_0x51622b,'paymentGateways':_0x3f8a64?JSON[_0x3ed0a2(0x2f6)](_0x3f8a64):null,'gatewaySettings':_0x5a320f?JSON[_0x3ed0a2(0x2f6)](_0x5a320f):null,'usdtPolygonWallet':_0x12f212?.[_0x3ed0a2(0x1ba)]||null,'usdtTrcWallet':_0x12f212?.[_0x3ed0a2(0x24e)]||null,'usdtErcWallet':_0x12f212?.[_0x3ed0a2(0x283)]||null,'usdcPolygonWallet':_0x12f212?.[_0x3ed0a2(0x2d3)]||null,'publicKey':_0x216a59,'secretKey':_0x124a77,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x54e6c4['id'],'fullName':_0x54e6c4['name'],'username':_0x54e6c4[_0x3ed0a2(0x252)],'telegramId':_0x54e6c4[_0x3ed0a2(0x26c)],'merchantUrl':_0x54e6c4[_0x3ed0a2(0x219)],'gateways':_0x54e6c4[_0x3ed0a2(0x1aa)]?JSON[_0x3ed0a2(0x204)](_0x54e6c4[_0x3ed0a2(0x1aa)]):null,'gatewaySettings':_0x54e6c4[_0x3ed0a2(0x203)]?JSON['parse'](_0x54e6c4[_0x3ed0a2(0x203)]):null,'publicKey':_0x54e6c4[_0x3ed0a2(0x26d)],'wallets':{'usdtPolygonWallet':_0x54e6c4[_0x3ed0a2(0x1ba)],'usdtTrcWallet':_0x54e6c4[_0x3ed0a2(0x24e)],'usdtErcWallet':_0x54e6c4[_0x3ed0a2(0x283)],'usdcPolygonWallet':_0x54e6c4['usdcPolygonWallet']},'status':_0x54e6c4[_0x3ed0a2(0x1da)],'createdAt':_0x54e6c4[_0x3ed0a2(0x2b7)]};}async['deleteUser'](_0x403881){const _0x922e63=a46_0x36f641;await database_1[_0x922e63(0x237)]['shop'][_0x922e63(0x2d2)]({'where':{'id':_0x403881}});}[a46_0x36f641(0x1af)](_0x41ea24,_0x364228,_0x30c35e){const _0x5e72c7=a46_0x36f641,_0x2a4b5d=new Map(),_0x1f73dc=new Date(_0x364228);while(_0x1f73dc<=_0x30c35e){const _0x6c3b18=_0x1f73dc[_0x5e72c7(0x2ef)]()[_0x5e72c7(0x1b9)]('T')[0x0];_0x2a4b5d[_0x5e72c7(0x1d9)](_0x6c3b18,{'revenue':0x0,'count':0x0}),_0x1f73dc[_0x5e72c7(0x2c6)](_0x1f73dc[_0x5e72c7(0x208)]()+0x1);}for(const _0x5dd0f3 of _0x41ea24){const _0x2f3774=_0x5dd0f3[_0x5e72c7(0x2b7)][_0x5e72c7(0x2ef)]()[_0x5e72c7(0x1b9)]('T')[0x0],_0x1bea9b=_0x2a4b5d['get'](_0x2f3774);_0x1bea9b&&(_0x1bea9b[_0x5e72c7(0x2c3)]+=0x1,_0x5dd0f3[_0x5e72c7(0x1da)]==='PAID'&&(_0x5dd0f3[_0x5e72c7(0x205)]?_0x1bea9b['revenue']+=_0x5dd0f3['amountUSDT']:console[_0x5e72c7(0x217)](_0x5e72c7(0x1ce)+_0x5dd0f3['id']+'\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion')));}const _0x3feb51=[],_0x5b2ba0=[];for(const [_0x45a4e0,_0x374ec2]of _0x2a4b5d){_0x3feb51[_0x5e72c7(0x28a)]({'date':_0x45a4e0,'amount':Math['round'](_0x374ec2[_0x5e72c7(0x246)]*0x64)/0x64}),_0x5b2ba0['push']({'date':_0x45a4e0,'count':_0x374ec2[_0x5e72c7(0x2c3)]});}return{'dailyRevenue':_0x3feb51,'dailyPayments':_0x5b2ba0};}}exports[a46_0x36f641(0x200)]=AdminService;