'use strict';function a35_0x1851(_0x3af260,_0x38103a){const _0x47be14=a35_0x47be();return a35_0x1851=function(_0x185157,_0x3fa64a){_0x185157=_0x185157-0x12b;let _0x2a0bc6=_0x47be14[_0x185157];return _0x2a0bc6;},a35_0x1851(_0x3af260,_0x38103a);}const a35_0x49364c=a35_0x1851;(function(_0x58e28e,_0x3e2da7){const _0x7cd49c=a35_0x1851,_0x495373=_0x58e28e();while(!![]){try{const _0x27b69a=parseInt(_0x7cd49c(0x1e5))/0x1*(parseInt(_0x7cd49c(0x1b1))/0x2)+parseInt(_0x7cd49c(0x160))/0x3*(-parseInt(_0x7cd49c(0x197))/0x4)+parseInt(_0x7cd49c(0x1da))/0x5*(parseInt(_0x7cd49c(0x187))/0x6)+parseInt(_0x7cd49c(0x131))/0x7+parseInt(_0x7cd49c(0x165))/0x8+parseInt(_0x7cd49c(0x1ce))/0x9+-parseInt(_0x7cd49c(0x19e))/0xa;if(_0x27b69a===_0x3e2da7)break;else _0x495373['push'](_0x495373['shift']());}catch(_0x3007b0){_0x495373['push'](_0x495373['shift']());}}}(a35_0x47be,0x3cbd2));function a35_0x47be(){const _0x3814b6=['stringify','\x20paid\x20payments\x20for\x20analysis','sk_','currencyService','amount','thisMonth','58105TEDrcR','test_gateway','orderId','failureMessage','totalPayments','updatePaymentStatus','fullName','\x20for\x20shop\x20','all','../config/database','paymentGateways','322855jJFuvG','\x20merchants\x20with\x20positive\x20balance','_count','shopUrl','payment','\x20USDT\x20(total\x20merchant\x20balances)','network','\x20USDT\x20from\x20balance','getPayoutStats','totalPayout','periodTo','Test\x20Gateway','__esModule','convertToUSDT','REFUND','Shop\x20not\x20found','length','averageCommissionRate','string','count','error','\x20USDT)','üìä\x20Merchants\x20awaiting\x20payout:\x20','‚úÖ\x20Customer\x20data\x20updated\x20for\x20payment\x20','txid','currency','\x20\x20\x20üåç\x20Country:\x20','usdtErcWallet','customerUa','1929452fOppsM','Telegram\x20username\x20already\x20exists','\x20USDT\x20(+','amountUSDT','$transaction','üìä\x20Getting\x20merchant\x20statistics\x20with\x20filters:','createPayout','\x20no\x20longer\x20PAID:\x20-','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','usdtTrcWallet','paidOutUSDT','paymentsCount','sort','wallets','values','Payment\x20not\x20found','adminNotes','admin','date','Plisio','usdcPolygonWallet','commission','ceil','year','merchantEarnings','KLYME\x20DE','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','telegramId','\x20->\x20','publicKey','groupBy','CHARGEBACK','üí∞\x20Found\x20','crypto','üìä\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','getAllUsers','getAllPayouts','COMPLETED','toUpperCase','customerName','gatewaySettings','availableBalance','gateway','default','customerEmail','pk_','deleteUser','822iJdLTr','suspendUser','updateCustomerData','üìÖ\x20Period:\x20','üí∞\x20Payment\x20','2875616KwgUhQ','KLYME\x20EU','create','\x20USDT\x20(','gte','\x20balance\x20updated:','üìä\x20Payout\x20statistics\x20calculated:','totalTurnover','\x20\x20\x20üë§\x20Merchant\x20earnings:\x20','shop','deletePayout','toFixed','\x20\x20\x20üè™\x20Gateway\x20earnings:\x20','externalPaymentUrl','\x20\x20\x20üí∞\x20Total\x20turnover:\x20','password','notes','\x20\x20\x20üìÖ\x20This\x20month:\x20','PAID','round','\x20USDT','customerIp','merchantEarningsUSDT','shopId','Rapyd','status','toString','averageCheckUSDT','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','getPaymentById','\x20USDT\x20total','balance','usdtPolygonWallet','__importDefault','6OjNiBs','parse','totalCommissionRate','üîÑ\x20Updating\x20customer\x20data\x20for\x20payment\x20','toLowerCase','üí∞\x20Shop\x20','getGatewayDisplayName','statusChangedBy','split','90d','turnoverUSDT','week','getUserById','updatedAt','reduce','getFullYear','3232iZjrrj','findUnique','_sum','üìä\x20Merchant\x20statistics\x20calculated:','map','\x20\x20\x20üñ•Ô∏è\x20User\x20Agent:\x20','\x20status:\x20','6387360zTfdkD','aggregate','CoinToPay','\x20\x20\x20Current\x20balance:\x20','\x20\x20\x20Payout\x20amount:\x20','not\x20set','telegram','hex','set','customerCountry','totalPaidOut','log','findMany','payout','createdAt','Username\x20already\x20exists','üí∞\x20Creating\x20payout\x20for\x20shop\x20','ACTIVE','lte','2fSXdyz','2020-01-01','localeCompare','üìä\x20Calculating\x20payout\x20statistics...','üîÑ\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','name','paidAt','insensitive','desc','‚úÖ\x20Payout\x20created:\x20','hash','getMerchantsAwaitingPayout','gatewayEarnings','period','\x20\x20\x20Balance:\x20','periodFrom','getMonth','\x20balance\x20updated:\x20','üí∏\x20CHARGEBACK\x20penalty:\x20-','merchantUrl','gateways','delete','username','AdminService','randomBytes','toISOString','update','Noda','\x20USDT\x20(same\x20as\x20awaiting)','1254150bgQJdh','dateTo','gatewayOrderId','commissionUSDT','turnover','getTime'];a35_0x47be=function(){return _0x3814b6;};return a35_0x47be();}var __importDefault=this&&this[a35_0x49364c(0x186)]||function(_0x38fd55){const _0x47ab90=a35_0x49364c;return _0x38fd55&&_0x38fd55[_0x47ab90(0x1f1)]?_0x38fd55:{'default':_0x38fd55};};Object['defineProperty'](exports,a35_0x49364c(0x1f1),{'value':!![]}),exports[a35_0x49364c(0x1c8)]=void 0x0;const database_1=__importDefault(require(a35_0x49364c(0x1e3))),bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a35_0x49364c(0x152))),currencyService_1=require('./currencyService');class AdminService{async[a35_0x49364c(0x1ed)](){const _0x569463=a35_0x49364c;console[_0x569463(0x1a9)](_0x569463(0x1b4));const _0x559660=await database_1[_0x569463(0x15c)][_0x569463(0x16e)][_0x569463(0x19f)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':'ACTIVE'}}),_0x39ff74=new Date(),_0x53de7c=new Date(_0x39ff74[_0x569463(0x196)](),_0x39ff74[_0x569463(0x1c1)](),0x1),_0x40b2c1=new Date(_0x39ff74[_0x569463(0x196)](),_0x39ff74['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x32f465=await database_1['default'][_0x569463(0x1ab)][_0x569463(0x19f)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x53de7c,'lte':_0x40b2c1},'status':_0x569463(0x156)}}),_0x5960e9=_0x559660[_0x569463(0x199)]['totalPaidOut']||0x0,_0x5e0d02=_0x559660[_0x569463(0x199)][_0x569463(0x184)]||0x0,_0x16af50=_0x32f465['_sum'][_0x569463(0x1d8)]||0x0,_0x546071={'totalPayout':Math[_0x569463(0x178)](_0x5960e9*0x64)/0x64,'awaitingPayout':Math[_0x569463(0x178)](_0x5e0d02*0x64)/0x64,'thisMonth':Math[_0x569463(0x178)](_0x16af50*0x64)/0x64,'availableBalance':Math[_0x569463(0x178)](_0x5e0d02*0x64)/0x64};return console[_0x569463(0x1a9)](_0x569463(0x16b)),console['log']('\x20\x20\x20üí∞\x20Total\x20payout:\x20'+_0x546071[_0x569463(0x1ee)]+'\x20USDT\x20(total\x20paid\x20to\x20merchants)'),console[_0x569463(0x1a9)](_0x569463(0x14b)+_0x546071['awaitingPayout']+_0x569463(0x1ea)),console[_0x569463(0x1a9)]('\x20\x20\x20üíµ\x20Available\x20balance:\x20'+_0x546071[_0x569463(0x15a)]+_0x569463(0x1cd)),console[_0x569463(0x1a9)](_0x569463(0x176)+_0x546071[_0x569463(0x1d9)]+_0x569463(0x179)),_0x546071;}async[a35_0x49364c(0x162)](_0x3c594b,_0xe43f2a){const _0x2e79fd=a35_0x49364c;console[_0x2e79fd(0x1a9)](_0x2e79fd(0x18a)+_0x3c594b+':',_0xe43f2a);const _0x2a4918=await database_1[_0x2e79fd(0x15c)][_0x2e79fd(0x1e9)]['findUnique']({'where':{'id':_0x3c594b},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x2a4918)throw new Error(_0x2e79fd(0x140));const _0x3537dc={};_0xe43f2a[_0x2e79fd(0x1a7)]!==undefined&&(_0x3537dc[_0x2e79fd(0x1a7)]=_0xe43f2a['customerCountry']||null);_0xe43f2a['customerIp']!==undefined&&(_0x3537dc['customerIp']=_0xe43f2a['customerIp']||null);_0xe43f2a[_0x2e79fd(0x130)]!==undefined&&(_0x3537dc[_0x2e79fd(0x130)]=_0xe43f2a[_0x2e79fd(0x130)]||null);const _0x466d42=await database_1[_0x2e79fd(0x15c)]['payment'][_0x2e79fd(0x1cb)]({'where':{'id':_0x3c594b},'data':{..._0x3537dc,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x2e79fd(0x1a9)](_0x2e79fd(0x12b)+_0x3c594b),console[_0x2e79fd(0x1a9)](_0x2e79fd(0x12e)+_0x2a4918['customerCountry']+_0x2e79fd(0x14d)+_0x466d42['customerCountry']),console['log']('\x20\x20\x20üåê\x20IP:\x20'+_0x2a4918[_0x2e79fd(0x17a)]+_0x2e79fd(0x14d)+_0x466d42['customerIp']),console['log'](_0x2e79fd(0x19c)+(_0x2a4918[_0x2e79fd(0x130)]?_0x2e79fd(0x1a6):'not\x20set')+_0x2e79fd(0x14d)+(_0x466d42[_0x2e79fd(0x130)]?_0x2e79fd(0x1a6):_0x2e79fd(0x1a3))),_0x466d42;}async['getSystemStatistics'](_0x45a630){const _0x34afc2=a35_0x49364c,_0x464997=new Date();let _0x37f21e;switch(_0x45a630){case'7d':_0x37f21e=new Date(_0x464997['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x37f21e=new Date(_0x464997[_0x34afc2(0x1d3)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x34afc2(0x190):_0x37f21e=new Date(_0x464997['getTime']()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x37f21e=new Date(_0x464997['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x322535,_0x41c8b9,_0x58b518,_0x3ea251,_0x430cba,_0x5eab85]=await Promise[_0x34afc2(0x1e2)]([database_1[_0x34afc2(0x15c)][_0x34afc2(0x16e)][_0x34afc2(0x1f8)](),database_1[_0x34afc2(0x15c)]['shop'][_0x34afc2(0x1f8)]({'where':{'status':'ACTIVE'}}),database_1[_0x34afc2(0x15c)][_0x34afc2(0x1e9)][_0x34afc2(0x1f8)]({'where':{'createdAt':{'gte':_0x37f21e},'gateway':{'not':_0x34afc2(0x1db)}}}),database_1['default'][_0x34afc2(0x1e9)][_0x34afc2(0x1f8)]({'where':{'status':_0x34afc2(0x177),'createdAt':{'gte':_0x37f21e},'gateway':{'not':_0x34afc2(0x1db)}}}),database_1[_0x34afc2(0x15c)][_0x34afc2(0x1e9)][_0x34afc2(0x1aa)]({'where':{'status':_0x34afc2(0x177),'createdAt':{'gte':_0x37f21e},'gateway':{'not':_0x34afc2(0x1db)}},'select':{'amount':!![],'currency':!![]}}),database_1[_0x34afc2(0x15c)]['payment'][_0x34afc2(0x1aa)]({'where':{'gateway':{'not':_0x34afc2(0x1db)}},'take':0xa,'orderBy':{'createdAt':_0x34afc2(0x1b9)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}})]);let _0xdd1c29=0x0;for(const _0x424ec1 of _0x430cba){const _0x1c4e9c=await currencyService_1[_0x34afc2(0x1d7)][_0x34afc2(0x1f2)](_0x424ec1['amount'],_0x424ec1['currency']);_0xdd1c29+=_0x1c4e9c;}const _0xc48497=_0x58b518>0x0?_0x3ea251/_0x58b518*0x64:0x0;return{'totalShops':_0x322535,'activeShops':_0x41c8b9,'totalPayments':_0x58b518,'successfulPayments':_0x3ea251,'totalRevenue':Math[_0x34afc2(0x178)](_0xdd1c29*0x64)/0x64,'conversionRate':Math[_0x34afc2(0x178)](_0xc48497*0x64)/0x64,'recentPayments':_0x5eab85['map'](_0x3ed894=>({'id':_0x3ed894['id'],'amount':_0x3ed894[_0x34afc2(0x1d8)],'currency':_0x3ed894[_0x34afc2(0x12d)],'status':_0x3ed894['status'],'gateway':_0x3ed894[_0x34afc2(0x15b)],'shop':_0x3ed894[_0x34afc2(0x16e)],'createdAt':_0x3ed894['createdAt']}))};}async['getMerchantStatistics'](_0x2bde20){const _0x426b36=a35_0x49364c;console[_0x426b36(0x1a9)](_0x426b36(0x136),_0x2bde20);let _0x44e3fc,_0xe2ebd7=new Date();if(_0x2bde20['period']==='custom'&&_0x2bde20['dateFrom']&&_0x2bde20[_0x426b36(0x1cf)])_0x44e3fc=new Date(_0x2bde20['dateFrom']),_0xe2ebd7=new Date(_0x2bde20[_0x426b36(0x1cf)]);else{const _0xe01272=new Date();switch(_0x2bde20[_0x426b36(0x1be)]){case _0x426b36(0x192):_0x44e3fc=new Date(_0xe01272[_0x426b36(0x1d3)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'month':_0x44e3fc=new Date(_0xe01272[_0x426b36(0x1d3)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x426b36(0x148):_0x44e3fc=new Date(_0xe01272[_0x426b36(0x1d3)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case'all':default:_0x44e3fc=new Date(_0x426b36(0x1b2));break;}}console['log'](_0x426b36(0x163)+_0x44e3fc[_0x426b36(0x1ca)]()+'\x20to\x20'+_0xe2ebd7[_0x426b36(0x1ca)]());const _0x4b706a={'status':'PAID','gateway':{'not':_0x426b36(0x1db)},'paidAt':{'gte':_0x44e3fc,'lte':_0xe2ebd7}};_0x2bde20[_0x426b36(0x17c)]&&(_0x4b706a[_0x426b36(0x17c)]=_0x2bde20[_0x426b36(0x17c)]);const _0xa81890=await database_1['default'][_0x426b36(0x1e9)][_0x426b36(0x1aa)]({'where':_0x4b706a,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x426b36(0x1a9)](_0x426b36(0x151)+_0xa81890[_0x426b36(0x1f5)]+_0x426b36(0x1d5));let _0x4599bf=0x0,_0x2cd515=0x0,_0x51ae0e=0x0;const _0x2e4ea1={},_0xba8660={},_0x3c14e5={};for(const _0x252f20 of _0xa81890){try{const _0x430c53=await currencyService_1[_0x426b36(0x1d7)]['convertToUSDT'](_0x252f20['amount'],_0x252f20[_0x426b36(0x12d)]);let _0x2e91c9={};if(_0x252f20['shop'][_0x426b36(0x159)])try{_0x2e91c9=JSON[_0x426b36(0x188)](_0x252f20[_0x426b36(0x16e)][_0x426b36(0x159)]);}catch(_0x2b2ad7){console[_0x426b36(0x1f9)](_0x426b36(0x181)+_0x252f20[_0x426b36(0x17c)]+':',_0x2b2ad7);}const _0x353088=_0x2e91c9[_0x426b36(0x146)]||0xa,_0x26d580=_0x430c53*(_0x353088/0x64),_0x1ed049=_0x430c53-_0x26d580;_0x4599bf+=_0x430c53,_0x2cd515+=_0x1ed049,_0x51ae0e+=_0x26d580;!_0x2e4ea1[_0x252f20[_0x426b36(0x15b)]]&&(_0x2e4ea1[_0x252f20['gateway']]={'gateway':_0x252f20[_0x426b36(0x15b)],'gatewayDisplayName':this[_0x426b36(0x18d)](_0x252f20[_0x426b36(0x15b)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x2e4ea1[_0x252f20[_0x426b36(0x15b)]]['paymentsCount']++,_0x2e4ea1[_0x252f20[_0x426b36(0x15b)]][_0x426b36(0x191)]+=_0x430c53,_0x2e4ea1[_0x252f20['gateway']][_0x426b36(0x1d1)]+=_0x26d580,_0x2e4ea1[_0x252f20[_0x426b36(0x15b)]][_0x426b36(0x17b)]+=_0x1ed049,_0x2e4ea1[_0x252f20[_0x426b36(0x15b)]]['totalCommissionRate']+=_0x353088;!_0x2bde20[_0x426b36(0x17c)]&&(!_0xba8660[_0x252f20[_0x426b36(0x17c)]]&&(_0xba8660[_0x252f20[_0x426b36(0x17c)]]={'shopId':_0x252f20['shopId'],'shopName':_0x252f20[_0x426b36(0x16e)][_0x426b36(0x1b6)],'shopUsername':_0x252f20['shop'][_0x426b36(0x1c7)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0xba8660[_0x252f20[_0x426b36(0x17c)]][_0x426b36(0x13c)]++,_0xba8660[_0x252f20[_0x426b36(0x17c)]][_0x426b36(0x191)]+=_0x430c53,_0xba8660[_0x252f20[_0x426b36(0x17c)]][_0x426b36(0x1d1)]+=_0x26d580,_0xba8660[_0x252f20[_0x426b36(0x17c)]][_0x426b36(0x17b)]+=_0x1ed049);const _0x4ebb84=_0x252f20[_0x426b36(0x1b7)]['toISOString']()[_0x426b36(0x18f)]('T')[0x0];!_0x3c14e5[_0x4ebb84]&&(_0x3c14e5[_0x4ebb84]={'date':_0x4ebb84,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x3c14e5[_0x4ebb84][_0x426b36(0x1d2)]+=_0x430c53,_0x3c14e5[_0x4ebb84][_0x426b36(0x149)]+=_0x1ed049,_0x3c14e5[_0x4ebb84]['gatewayEarnings']+=_0x26d580,_0x3c14e5[_0x4ebb84][_0x426b36(0x13c)]++;}catch(_0x2d3f1f){console[_0x426b36(0x1f9)]('Error\x20processing\x20payment\x20'+_0x252f20['id']+':',_0x2d3f1f);}}Object[_0x426b36(0x13f)](_0x2e4ea1)['forEach'](_0x2357cf=>{const _0x4f78bb=_0x426b36;_0x2357cf[_0x4f78bb(0x1f6)]=_0x2357cf['paymentsCount']>0x0?_0x2357cf[_0x4f78bb(0x189)]/_0x2357cf[_0x4f78bb(0x13c)]:0x0,delete _0x2357cf[_0x4f78bb(0x189)];}),Object[_0x426b36(0x13f)](_0xba8660)['forEach'](_0x23bcbf=>{const _0x1658dc=_0x426b36;_0x23bcbf[_0x1658dc(0x180)]=_0x23bcbf[_0x1658dc(0x13c)]>0x0?_0x23bcbf[_0x1658dc(0x191)]/_0x23bcbf[_0x1658dc(0x13c)]:0x0;});let _0x52b6e4=0x0;if(_0x2bde20[_0x426b36(0x17c)]){const _0x453a95=await database_1[_0x426b36(0x15c)][_0x426b36(0x1ab)][_0x426b36(0x1aa)]({'where':{'shopId':_0x2bde20['shopId'],'status':_0x426b36(0x156),'createdAt':{'gte':_0x44e3fc,'lte':_0xe2ebd7}},'select':{'amount':!![]}});_0x52b6e4=_0x453a95[_0x426b36(0x195)]((_0x5d368d,_0x5a8bf0)=>_0x5d368d+_0x5a8bf0['amount'],0x0);}const _0xc4e35f=_0xa81890[_0x426b36(0x1f5)],_0x5d8f13=_0xa81890[_0x426b36(0x1f5)],_0x4ef33c=_0xc4e35f>0x0?_0x4599bf/_0xc4e35f:0x0,_0x33ad8c=0x64,_0x1bc33c=Math[_0x426b36(0x147)]((_0xe2ebd7[_0x426b36(0x1d3)]()-_0x44e3fc['getTime']())/(0x3e8*0x3c*0x3c*0x18)),_0x1b480a={'totalTurnover':Math['round'](_0x4599bf*0x64)/0x64,'merchantEarnings':Math['round'](_0x2cd515*0x64)/0x64,'gatewayEarnings':Math[_0x426b36(0x178)](_0x51ae0e*0x64)/0x64,'totalPaidOut':Math['round'](_0x52b6e4*0x64)/0x64,'averageCheck':Math[_0x426b36(0x178)](_0x4ef33c*0x64)/0x64,'totalPayments':_0xc4e35f,'successfulPayments':_0x5d8f13,'conversionRate':_0x33ad8c,'gatewayBreakdown':Object[_0x426b36(0x13f)](_0x2e4ea1)[_0x426b36(0x19b)](_0x2486bb=>({..._0x2486bb,'turnoverUSDT':Math[_0x426b36(0x178)](_0x2486bb[_0x426b36(0x191)]*0x64)/0x64,'commissionUSDT':Math[_0x426b36(0x178)](_0x2486bb['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x2486bb[_0x426b36(0x17b)]*0x64)/0x64,'averageCommissionRate':Math[_0x426b36(0x178)](_0x2486bb[_0x426b36(0x1f6)]*0x64)/0x64})),'merchantBreakdown':_0x2bde20[_0x426b36(0x17c)]?undefined:Object['values'](_0xba8660)[_0x426b36(0x19b)](_0x2f4bef=>({..._0x2f4bef,'turnoverUSDT':Math[_0x426b36(0x178)](_0x2f4bef[_0x426b36(0x191)]*0x64)/0x64,'commissionUSDT':Math[_0x426b36(0x178)](_0x2f4bef[_0x426b36(0x1d1)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x426b36(0x178)](_0x2f4bef['merchantEarningsUSDT']*0x64)/0x64,'paidOutUSDT':Math[_0x426b36(0x178)](_0x2f4bef[_0x426b36(0x13b)]*0x64)/0x64,'averageCheckUSDT':Math['round'](_0x2f4bef[_0x426b36(0x180)]*0x64)/0x64})),'dailyData':Object[_0x426b36(0x13f)](_0x3c14e5)[_0x426b36(0x19b)](_0x26aa8f=>({..._0x26aa8f,'turnover':Math[_0x426b36(0x178)](_0x26aa8f[_0x426b36(0x1d2)]*0x64)/0x64,'merchantEarnings':Math['round'](_0x26aa8f[_0x426b36(0x149)]*0x64)/0x64,'gatewayEarnings':Math['round'](_0x26aa8f['gatewayEarnings']*0x64)/0x64}))[_0x426b36(0x13d)]((_0x456593,_0x49fbeb)=>_0x456593['date'][_0x426b36(0x1b3)](_0x49fbeb[_0x426b36(0x143)])),'periodInfo':{'from':_0x44e3fc,'to':_0xe2ebd7,'periodType':_0x2bde20[_0x426b36(0x1be)]||'custom','daysCount':_0x1bc33c}};return console[_0x426b36(0x1a9)](_0x426b36(0x19a)),console[_0x426b36(0x1a9)](_0x426b36(0x173)+_0x1b480a[_0x426b36(0x16c)]+_0x426b36(0x179)),console['log'](_0x426b36(0x16d)+_0x1b480a[_0x426b36(0x149)]+_0x426b36(0x179)),console['log'](_0x426b36(0x171)+_0x1b480a[_0x426b36(0x1bd)]+'\x20USDT'),console['log']('\x20\x20\x20üìä\x20Total\x20payments:\x20'+_0x1b480a[_0x426b36(0x1de)]),_0x1b480a;}[a35_0x49364c(0x18d)](_0x2683ac){const _0xd6d38f=a35_0x49364c,_0x399336={'test_gateway':_0xd6d38f(0x1f0),'plisio':_0xd6d38f(0x144),'rapyd':_0xd6d38f(0x17d),'noda':_0xd6d38f(0x1cc),'cointopay':_0xd6d38f(0x1a0),'klyme_eu':_0xd6d38f(0x166),'klyme_gb':'KLYME\x20GB','klyme_de':_0xd6d38f(0x14a)};return _0x399336[_0x2683ac]||_0x2683ac;}async[a35_0x49364c(0x1bc)](_0x28cf32){const _0x59f28b=a35_0x49364c,{page:_0x14553d,limit:_0x17f698,minAmount:_0x273dc1,search:_0x5e4c6e}=_0x28cf32,_0x2ff0db=(_0x14553d-0x1)*_0x17f698;console[_0x59f28b(0x1a9)](_0x59f28b(0x153),_0x28cf32);const _0x111236={'balance':{'gt':0x0},'status':_0x59f28b(0x1af)};_0x273dc1&&(_0x111236[_0x59f28b(0x184)][_0x59f28b(0x169)]=_0x273dc1);_0x5e4c6e&&(_0x111236['OR']=[{'name':{'contains':_0x5e4c6e,'mode':_0x59f28b(0x1b8)}},{'username':{'contains':_0x5e4c6e,'mode':'insensitive'}}]);const [_0x1f09d1,_0x306c78]=await Promise[_0x59f28b(0x1e2)]([database_1[_0x59f28b(0x15c)][_0x59f28b(0x16e)][_0x59f28b(0x1aa)]({'where':_0x111236,'skip':_0x2ff0db,'take':_0x17f698,'orderBy':{'balance':_0x59f28b(0x1b9)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'createdAt':!![]}}),database_1[_0x59f28b(0x15c)]['shop'][_0x59f28b(0x1f8)]({'where':_0x111236})]);console[_0x59f28b(0x1a9)](_0x59f28b(0x151)+_0x1f09d1[_0x59f28b(0x1f5)]+_0x59f28b(0x1e6));const _0x3cf40c=await Promise[_0x59f28b(0x1e2)](_0x1f09d1['map'](async _0x40dad7=>{const _0x16b1d7=_0x59f28b,[_0x4712c8,_0x12fa39,_0x4da56f]=await Promise['all']([database_1[_0x16b1d7(0x15c)][_0x16b1d7(0x1e9)]['count']({'where':{'shopId':_0x40dad7['id'],'status':'PAID','amountUSDT':{'not':null}}}),database_1['default'][_0x16b1d7(0x1e9)]['findFirst']({'where':{'shopId':_0x40dad7['id'],'status':_0x16b1d7(0x177),'amountUSDT':{'not':null}},'orderBy':{'paidAt':'asc'},'select':{'paidAt':!![]}}),database_1[_0x16b1d7(0x15c)][_0x16b1d7(0x1e9)][_0x16b1d7(0x14f)]({'by':[_0x16b1d7(0x15b)],'where':{'shopId':_0x40dad7['id'],'status':_0x16b1d7(0x177),'amountUSDT':{'not':null}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x418aa2=_0x4da56f['map'](_0x5e003e=>({'gateway':_0x5e003e[_0x16b1d7(0x15b)],'count':_0x5e003e[_0x16b1d7(0x1e7)]['id'],'amountUSDT':_0x5e003e[_0x16b1d7(0x199)][_0x16b1d7(0x134)]||0x0,'amountAfterCommissionUSDT':_0x5e003e['_sum'][_0x16b1d7(0x134)]||0x0,'commission':0x0}));return{'id':_0x40dad7['id'],'fullName':_0x40dad7[_0x16b1d7(0x1b6)],'username':_0x40dad7['username'],'telegramId':_0x40dad7['telegram'],'merchantUrl':_0x40dad7[_0x16b1d7(0x1e8)],'wallets':{'usdtPolygonWallet':_0x40dad7[_0x16b1d7(0x185)],'usdtTrcWallet':_0x40dad7[_0x16b1d7(0x13a)],'usdtErcWallet':_0x40dad7[_0x16b1d7(0x12f)],'usdcPolygonWallet':_0x40dad7['usdcPolygonWallet']},'totalAmountUSDT':_0x40dad7[_0x16b1d7(0x184)],'totalAmountAfterCommissionUSDT':_0x40dad7[_0x16b1d7(0x184)],'paymentsCount':_0x4712c8,'oldestPaymentDate':_0x12fa39?.[_0x16b1d7(0x1b7)]||_0x40dad7[_0x16b1d7(0x1ac)],'gatewayBreakdown':_0x418aa2};})),_0x32e825=_0x1f09d1['reduce']((_0x1745cc,_0x37c463)=>_0x1745cc+_0x37c463[_0x59f28b(0x184)],0x0),_0x4cf725=_0x32e825;return console['log'](_0x59f28b(0x1fb)+_0x306c78+'\x20merchants,\x20'+Math['round'](_0x4cf725*0x64)/0x64+_0x59f28b(0x183)),{'merchants':_0x3cf40c,'pagination':{'page':_0x14553d,'limit':_0x17f698,'total':_0x306c78,'totalPages':Math['ceil'](_0x306c78/_0x17f698)},'summary':{'totalMerchants':_0x306c78,'totalAmountUSDT':Math[_0x59f28b(0x178)](_0x32e825*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x59f28b(0x178)](_0x4cf725*0x64)/0x64}};}async[a35_0x49364c(0x137)](_0x575d56){const _0xcc81e1=a35_0x49364c,{shopId:_0x29c675,amount:_0x3b9165,network:_0x5ee0af,notes:_0x3a876a,periodFrom:_0x40f83a,periodTo:_0x27bb23}=_0x575d56,_0x2413f3=await database_1[_0xcc81e1(0x15c)][_0xcc81e1(0x135)](async _0x3daba5=>{const _0x5d91d3=_0xcc81e1,_0x248def=await _0x3daba5[_0x5d91d3(0x16e)]['findUnique']({'where':{'id':_0x29c675},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x248def)throw new Error(_0x5d91d3(0x1f4));console[_0x5d91d3(0x1a9)](_0x5d91d3(0x1ae)+_0x248def['username']+':'),console['log'](_0x5d91d3(0x1a1)+_0x248def[_0x5d91d3(0x184)][_0x5d91d3(0x170)](0x6)+_0x5d91d3(0x179)),console[_0x5d91d3(0x1a9)](_0x5d91d3(0x1a2)+_0x3b9165[_0x5d91d3(0x170)](0x6)+_0x5d91d3(0x179)),console['log'](_0x5d91d3(0x139)+_0x248def[_0x5d91d3(0x1a8)][_0x5d91d3(0x170)](0x6)+_0x5d91d3(0x179));if(_0x248def[_0x5d91d3(0x184)]<_0x3b9165)throw new Error('Insufficient\x20balance.\x20Available:\x20'+_0x248def[_0x5d91d3(0x184)]['toFixed'](0x6)+'\x20USDT,\x20Requested:\x20'+_0x3b9165['toFixed'](0x6)+'\x20USDT');const _0x5ca872=await _0x3daba5[_0x5d91d3(0x1ab)][_0x5d91d3(0x167)]({'data':{'shopId':_0x29c675,'amount':_0x3b9165,'network':_0x5ee0af,'status':_0x5d91d3(0x156),'notes':_0x3a876a,'periodFrom':_0x40f83a?new Date(_0x40f83a):null,'periodTo':_0x27bb23?new Date(_0x27bb23):null,'createdAt':new Date(),'paidAt':new Date()}}),_0xdfda37=_0x248def[_0x5d91d3(0x184)]-_0x3b9165,_0x3676ab=_0x248def['totalPaidOut']+_0x3b9165;return await _0x3daba5[_0x5d91d3(0x16e)]['update']({'where':{'id':_0x29c675},'data':{'balance':_0xdfda37,'totalPaidOut':_0x3676ab}}),console[_0x5d91d3(0x1a9)](_0x5d91d3(0x18c)+_0x248def['username']+_0x5d91d3(0x16a)),console[_0x5d91d3(0x1a9)](_0x5d91d3(0x1bf)+_0x248def[_0x5d91d3(0x184)][_0x5d91d3(0x170)](0x6)+_0x5d91d3(0x14d)+_0xdfda37['toFixed'](0x6)+'\x20USDT\x20(-'+_0x3b9165['toFixed'](0x6)+')'),console[_0x5d91d3(0x1a9)]('\x20\x20\x20Total\x20paid\x20out:\x20'+_0x248def[_0x5d91d3(0x1a8)][_0x5d91d3(0x170)](0x6)+_0x5d91d3(0x14d)+_0x3676ab[_0x5d91d3(0x170)](0x6)+_0x5d91d3(0x133)+_0x3b9165[_0x5d91d3(0x170)](0x6)+')'),{'payout':_0x5ca872,'shop':_0x248def};});return console[_0xcc81e1(0x1a9)](_0xcc81e1(0x1ba)+_0x2413f3['payout']['id']+_0xcc81e1(0x1e1)+_0x2413f3[_0xcc81e1(0x16e)][_0xcc81e1(0x1c7)]+'\x20('+_0x3b9165+_0xcc81e1(0x1fa)),{'id':_0x2413f3['payout']['id'],'shopId':_0x2413f3[_0xcc81e1(0x1ab)][_0xcc81e1(0x17c)],'shopName':_0x2413f3[_0xcc81e1(0x16e)][_0xcc81e1(0x1b6)],'shopUsername':_0x2413f3[_0xcc81e1(0x16e)][_0xcc81e1(0x1c7)],'amount':_0x2413f3['payout'][_0xcc81e1(0x1d8)],'network':_0x2413f3[_0xcc81e1(0x1ab)]['network'],'status':_0x2413f3[_0xcc81e1(0x1ab)]['status'],'txid':_0x2413f3[_0xcc81e1(0x1ab)]['txid'],'notes':_0x2413f3[_0xcc81e1(0x1ab)]['notes'],'periodFrom':_0x2413f3[_0xcc81e1(0x1ab)][_0xcc81e1(0x1c0)],'periodTo':_0x2413f3[_0xcc81e1(0x1ab)][_0xcc81e1(0x1ef)],'createdAt':_0x2413f3[_0xcc81e1(0x1ab)][_0xcc81e1(0x1ac)],'paidAt':_0x2413f3[_0xcc81e1(0x1ab)][_0xcc81e1(0x1b7)]};}async[a35_0x49364c(0x155)](_0xc9f70c){const _0x403406=a35_0x49364c,{page:_0x27c735,limit:_0x356e4e,shopId:_0x27c008,network:_0x18042a,dateFrom:_0x426f97,dateTo:_0x3895bb,search:_0x3d2f35}=_0xc9f70c,_0x4216a8=(_0x27c735-0x1)*_0x356e4e,_0x4f96dd={};_0x27c008&&(_0x4f96dd['shopId']=_0x27c008);_0x18042a&&(_0x4f96dd[_0x403406(0x1eb)]=_0x18042a);(_0x426f97||_0x3895bb)&&(_0x4f96dd[_0x403406(0x1ac)]={},_0x426f97&&(_0x4f96dd[_0x403406(0x1ac)][_0x403406(0x169)]=new Date(_0x426f97)),_0x3895bb&&(_0x4f96dd['createdAt'][_0x403406(0x1b0)]=new Date(_0x3895bb)));_0x3d2f35&&(_0x4f96dd['OR']=[{'shop':{'name':{'contains':_0x3d2f35,'mode':_0x403406(0x1b8)}}},{'shop':{'username':{'contains':_0x3d2f35,'mode':_0x403406(0x1b8)}}},{'notes':{'contains':_0x3d2f35,'mode':_0x403406(0x1b8)}}]);const [_0x54f389,_0x59cc86]=await Promise[_0x403406(0x1e2)]([database_1[_0x403406(0x15c)][_0x403406(0x1ab)][_0x403406(0x1aa)]({'where':_0x4f96dd,'skip':_0x4216a8,'take':_0x356e4e,'orderBy':{'createdAt':_0x403406(0x1b9)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x403406(0x15c)][_0x403406(0x1ab)][_0x403406(0x1f8)]({'where':_0x4f96dd})]);return{'payouts':_0x54f389[_0x403406(0x19b)](_0x3f0c6c=>({'id':_0x3f0c6c['id'],'shopId':_0x3f0c6c[_0x403406(0x17c)],'shopName':_0x3f0c6c[_0x403406(0x16e)]['name'],'shopUsername':_0x3f0c6c[_0x403406(0x16e)][_0x403406(0x1c7)],'amount':_0x3f0c6c[_0x403406(0x1d8)],'network':_0x3f0c6c[_0x403406(0x1eb)],'status':_0x3f0c6c['status'],'txid':_0x3f0c6c[_0x403406(0x12c)],'notes':_0x3f0c6c[_0x403406(0x175)],'periodFrom':_0x3f0c6c[_0x403406(0x1c0)],'periodTo':_0x3f0c6c['periodTo'],'createdAt':_0x3f0c6c['createdAt'],'paidAt':_0x3f0c6c[_0x403406(0x1b7)]})),'pagination':{'page':_0x27c735,'limit':_0x356e4e,'total':_0x59cc86,'totalPages':Math[_0x403406(0x147)](_0x59cc86/_0x356e4e)}};}async['getPayoutById'](_0x5f5081){const _0x4b4e7d=a35_0x49364c,_0x1a5d53=await database_1[_0x4b4e7d(0x15c)][_0x4b4e7d(0x1ab)][_0x4b4e7d(0x198)]({'where':{'id':_0x5f5081},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x1a5d53)return null;return{'id':_0x1a5d53['id'],'shopId':_0x1a5d53['shopId'],'shopName':_0x1a5d53['shop'][_0x4b4e7d(0x1b6)],'shopUsername':_0x1a5d53[_0x4b4e7d(0x16e)][_0x4b4e7d(0x1c7)],'amount':_0x1a5d53[_0x4b4e7d(0x1d8)],'network':_0x1a5d53[_0x4b4e7d(0x1eb)],'status':_0x1a5d53[_0x4b4e7d(0x17e)],'txid':_0x1a5d53['txid'],'notes':_0x1a5d53[_0x4b4e7d(0x175)],'periodFrom':_0x1a5d53[_0x4b4e7d(0x1c0)],'periodTo':_0x1a5d53[_0x4b4e7d(0x1ef)],'createdAt':_0x1a5d53[_0x4b4e7d(0x1ac)],'paidAt':_0x1a5d53[_0x4b4e7d(0x1b7)]};}async[a35_0x49364c(0x16f)](_0x3ebeb5){const _0x525330=a35_0x49364c;await database_1[_0x525330(0x15c)][_0x525330(0x1ab)]['delete']({'where':{'id':_0x3ebeb5}});}async['getAllPayments'](_0x54c98a){const _0x2a844b=a35_0x49364c,{page:_0x597c0f,limit:_0x3626ac,status:_0x7c0522,gateway:_0x1f39ef,shopId:_0x1f36b7,dateFrom:_0x1f1ef5,dateTo:_0x440675,search:_0x3af240}=_0x54c98a,_0x3f2813=(_0x597c0f-0x1)*_0x3626ac,_0x4b3d60={};_0x7c0522&&(_0x4b3d60[_0x2a844b(0x17e)]=_0x7c0522['toUpperCase']());_0x1f39ef&&(_0x4b3d60['gateway']=_0x1f39ef[_0x2a844b(0x18b)]());_0x4b3d60[_0x2a844b(0x15b)]=_0x4b3d60[_0x2a844b(0x15b)]?_0x4b3d60[_0x2a844b(0x15b)]:{'not':_0x2a844b(0x1db)};if(typeof _0x4b3d60[_0x2a844b(0x15b)]===_0x2a844b(0x1f7)&&_0x4b3d60[_0x2a844b(0x15b)]!==_0x2a844b(0x1db)){}else{if(typeof _0x4b3d60[_0x2a844b(0x15b)]===_0x2a844b(0x1f7)&&_0x4b3d60[_0x2a844b(0x15b)]==='test_gateway'){}else _0x4b3d60['gateway']={'not':_0x2a844b(0x1db)};}_0x1f36b7&&(_0x4b3d60['shopId']=_0x1f36b7);(_0x1f1ef5||_0x440675)&&(_0x4b3d60[_0x2a844b(0x1ac)]={},_0x1f1ef5&&(_0x4b3d60[_0x2a844b(0x1ac)][_0x2a844b(0x169)]=new Date(_0x1f1ef5)),_0x440675&&(_0x4b3d60['createdAt'][_0x2a844b(0x1b0)]=new Date(_0x440675)));_0x3af240&&(_0x4b3d60['OR']=[{'orderId':{'contains':_0x3af240,'mode':_0x2a844b(0x1b8)}},{'gatewayOrderId':{'contains':_0x3af240,'mode':_0x2a844b(0x1b8)}},{'customerEmail':{'contains':_0x3af240,'mode':_0x2a844b(0x1b8)}},{'shop':{'name':{'contains':_0x3af240,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x3af240,'mode':'insensitive'}}}]);const [_0x3c8a4f,_0x554139]=await Promise[_0x2a844b(0x1e2)]([database_1[_0x2a844b(0x15c)][_0x2a844b(0x1e9)][_0x2a844b(0x1aa)]({'where':_0x4b3d60,'skip':_0x3f2813,'take':_0x3626ac,'orderBy':{'createdAt':_0x2a844b(0x1b9)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x2a844b(0x1e9)][_0x2a844b(0x1f8)]({'where':_0x4b3d60})]);return{'payments':_0x3c8a4f[_0x2a844b(0x19b)](_0x526e57=>({'id':_0x526e57['id'],'shopId':_0x526e57[_0x2a844b(0x17c)],'gateway':_0x526e57[_0x2a844b(0x15b)],'amount':_0x526e57[_0x2a844b(0x1d8)],'currency':_0x526e57[_0x2a844b(0x12d)],'status':_0x526e57[_0x2a844b(0x17e)],'orderId':_0x526e57[_0x2a844b(0x1dc)],'gatewayOrderId':_0x526e57[_0x2a844b(0x1d0)],'customerEmail':_0x526e57['customerEmail'],'customerName':_0x526e57['customerName'],'customerCountry':_0x526e57[_0x2a844b(0x1a7)],'customerIp':_0x526e57[_0x2a844b(0x17a)],'customerUa':_0x526e57['customerUa'],'failureMessage':_0x526e57[_0x2a844b(0x1dd)],'createdAt':_0x526e57[_0x2a844b(0x1ac)],'updatedAt':_0x526e57['updatedAt'],'shop':_0x526e57[_0x2a844b(0x16e)]})),'pagination':{'page':_0x597c0f,'limit':_0x3626ac,'total':_0x554139,'totalPages':Math[_0x2a844b(0x147)](_0x554139/_0x3626ac)}};}async[a35_0x49364c(0x182)](_0x5c8035){const _0x58d1ee=a35_0x49364c,_0x2d06ef=await database_1[_0x58d1ee(0x15c)][_0x58d1ee(0x1e9)][_0x58d1ee(0x198)]({'where':{'id':_0x5c8035},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x2d06ef)return null;return{'id':_0x2d06ef['id'],'shopId':_0x2d06ef['shopId'],'gateway':_0x2d06ef[_0x58d1ee(0x15b)],'amount':_0x2d06ef['amount'],'currency':_0x2d06ef[_0x58d1ee(0x12d)],'status':_0x2d06ef[_0x58d1ee(0x17e)],'orderId':_0x2d06ef[_0x58d1ee(0x1dc)],'gatewayOrderId':_0x2d06ef[_0x58d1ee(0x1d0)],'customerEmail':_0x2d06ef[_0x58d1ee(0x15d)],'customerName':_0x2d06ef['customerName'],'customerCountry':_0x2d06ef[_0x58d1ee(0x1a7)],'customerIp':_0x2d06ef[_0x58d1ee(0x17a)],'customerUa':_0x2d06ef[_0x58d1ee(0x130)],'failureMessage':_0x2d06ef['failureMessage'],'externalPaymentUrl':_0x2d06ef[_0x58d1ee(0x172)],'successUrl':_0x2d06ef['successUrl'],'failUrl':_0x2d06ef['failUrl'],'pendingUrl':_0x2d06ef['pendingUrl'],'whiteUrl':_0x2d06ef['whiteUrl'],'createdAt':_0x2d06ef[_0x58d1ee(0x1ac)],'updatedAt':_0x2d06ef[_0x58d1ee(0x194)],'shop':_0x2d06ef[_0x58d1ee(0x16e)]};}async[a35_0x49364c(0x1df)](_0x514d0e,_0x4bf50c,_0x4b28b4,_0x53bf33){const _0xc045e4=a35_0x49364c,_0x7faa00=await database_1['default'][_0xc045e4(0x135)](async _0x260e9d=>{const _0x5e3070=_0xc045e4,_0x8391a0=await _0x260e9d[_0x5e3070(0x1e9)][_0x5e3070(0x198)]({'where':{'id':_0x514d0e},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x8391a0)throw new Error(_0x5e3070(0x140));const _0x4cd9ad=_0x8391a0[_0x5e3070(0x17e)],_0x4b4373=_0x4bf50c[_0x5e3070(0x157)]();console[_0x5e3070(0x1a9)]('üîÑ\x20Admin\x20updating\x20payment\x20'+_0x514d0e+_0x5e3070(0x19d)+_0x4cd9ad+'\x20->\x20'+_0x4b4373),console[_0x5e3070(0x1a9)]('üí∞\x20Current\x20shop\x20balance:\x20'+_0x8391a0[_0x5e3070(0x16e)][_0x5e3070(0x184)]+_0x5e3070(0x179));const _0x35f31c={'status':_0x4b4373,'updatedAt':new Date(),'statusChangedBy':_0x5e3070(0x142),'statusChangedAt':new Date()};_0x4b28b4&&(_0x35f31c[_0x5e3070(0x141)]=_0x4b28b4);_0x4b4373===_0x5e3070(0x150)&&_0x53bf33&&(_0x35f31c['chargebackAmount']=_0x53bf33);let _0x397072=0x0,_0x34f938=_0x8391a0[_0x5e3070(0x16e)][_0x5e3070(0x184)];if(_0x4b4373===_0x5e3070(0x177)&&_0x4cd9ad!==_0x5e3070(0x177)){_0x35f31c['paidAt']=new Date();const _0x3b3123=await currencyService_1['currencyService'][_0x5e3070(0x1f2)](_0x8391a0['amount'],_0x8391a0[_0x5e3070(0x12d)]);_0x35f31c[_0x5e3070(0x134)]=_0x3b3123,_0x397072=_0x3b3123,_0x34f938+=_0x3b3123,console['log'](_0x5e3070(0x164)+_0x514d0e+'\x20became\x20PAID:\x20+'+_0x3b3123[_0x5e3070(0x170)](0x6)+'\x20USDT\x20to\x20balance');}else _0x4cd9ad===_0x5e3070(0x177)&&_0x4b4373!=='PAID'&&(_0x8391a0['amountUSDT']&&(_0x397072=-_0x8391a0[_0x5e3070(0x134)],_0x34f938-=_0x8391a0[_0x5e3070(0x134)],_0x35f31c[_0x5e3070(0x134)]=null,console[_0x5e3070(0x1a9)](_0x5e3070(0x164)+_0x514d0e+_0x5e3070(0x138)+_0x8391a0[_0x5e3070(0x134)]['toFixed'](0x6)+_0x5e3070(0x1ec))));if(_0x4b4373===_0x5e3070(0x150)){if(_0x4cd9ad===_0x5e3070(0x177)&&_0x8391a0[_0x5e3070(0x134)]){}_0x53bf33&&_0x53bf33>0x0&&(_0x397072-=_0x53bf33,_0x34f938-=_0x53bf33,console[_0x5e3070(0x1a9)](_0x5e3070(0x1c3)+_0x53bf33[_0x5e3070(0x170)](0x6)+'\x20USDT\x20from\x20balance'));}_0x4b4373===_0x5e3070(0x1f3)&&_0x4cd9ad===_0x5e3070(0x177)&&console[_0x5e3070(0x1a9)](_0x5e3070(0x1b5));const _0x5430dd=await _0x260e9d['payment'][_0x5e3070(0x1cb)]({'where':{'id':_0x514d0e},'data':_0x35f31c,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x397072!==0x0&&(await _0x260e9d[_0x5e3070(0x16e)][_0x5e3070(0x1cb)]({'where':{'id':_0x8391a0[_0x5e3070(0x17c)]},'data':{'balance':_0x34f938}}),console[_0x5e3070(0x1a9)](_0x5e3070(0x18c)+_0x8391a0[_0x5e3070(0x17c)]+_0x5e3070(0x1c2)+_0x8391a0[_0x5e3070(0x16e)][_0x5e3070(0x184)]['toFixed'](0x6)+_0x5e3070(0x14d)+_0x34f938[_0x5e3070(0x170)](0x6)+_0x5e3070(0x168)+(_0x397072>0x0?'+':'')+_0x397072[_0x5e3070(0x170)](0x6)+')')),_0x5430dd;});return{'id':_0x7faa00['id'],'shopId':_0x7faa00[_0xc045e4(0x17c)],'gateway':_0x7faa00['gateway'],'amount':_0x7faa00['amount'],'currency':_0x7faa00[_0xc045e4(0x12d)],'status':_0x7faa00['status'],'orderId':_0x7faa00['orderId'],'gatewayOrderId':_0x7faa00['gatewayOrderId'],'customerEmail':_0x7faa00[_0xc045e4(0x15d)],'customerName':_0x7faa00[_0xc045e4(0x158)],'customerCountry':_0x7faa00[_0xc045e4(0x1a7)],'customerIp':_0x7faa00[_0xc045e4(0x17a)],'customerUa':_0x7faa00[_0xc045e4(0x130)],'failureMessage':_0x7faa00['failureMessage'],'adminNotes':_0x7faa00[_0xc045e4(0x141)],'chargebackAmount':_0x7faa00['chargebackAmount'],'statusChangedBy':_0x7faa00[_0xc045e4(0x18e)],'statusChangedAt':_0x7faa00['statusChangedAt'],'createdAt':_0x7faa00[_0xc045e4(0x1ac)],'updatedAt':_0x7faa00['updatedAt'],'shop':_0x7faa00['shop']};}async['updateUser'](_0x3a921a,_0x49555f){const _0x1a68f5=a35_0x49364c,_0x19c3ef={..._0x49555f};_0x49555f[_0x1a68f5(0x174)]&&(_0x19c3ef[_0x1a68f5(0x174)]=await bcryptjs_1['default'][_0x1a68f5(0x1bb)](_0x49555f['password'],0xc));_0x49555f[_0x1a68f5(0x1e0)]&&(_0x19c3ef[_0x1a68f5(0x1b6)]=_0x49555f[_0x1a68f5(0x1e0)],delete _0x19c3ef['fullName']);_0x49555f[_0x1a68f5(0x14c)]&&(_0x19c3ef[_0x1a68f5(0x1a4)]=_0x49555f['telegramId'],delete _0x19c3ef[_0x1a68f5(0x14c)]);_0x49555f[_0x1a68f5(0x1c4)]&&(_0x19c3ef[_0x1a68f5(0x1e8)]=_0x49555f[_0x1a68f5(0x1c4)],delete _0x19c3ef['merchantUrl']);_0x49555f[_0x1a68f5(0x1c5)]&&(_0x19c3ef[_0x1a68f5(0x1e4)]=JSON[_0x1a68f5(0x1d4)](_0x49555f[_0x1a68f5(0x1c5)]),delete _0x19c3ef[_0x1a68f5(0x1c5)]);_0x49555f[_0x1a68f5(0x159)]&&(_0x19c3ef[_0x1a68f5(0x159)]=JSON['stringify'](_0x49555f['gatewaySettings']),delete _0x19c3ef[_0x1a68f5(0x159)]);_0x49555f[_0x1a68f5(0x13e)]&&(_0x49555f[_0x1a68f5(0x13e)][_0x1a68f5(0x185)]!==undefined&&(_0x19c3ef[_0x1a68f5(0x185)]=_0x49555f['wallets'][_0x1a68f5(0x185)]||null),_0x49555f[_0x1a68f5(0x13e)][_0x1a68f5(0x13a)]!==undefined&&(_0x19c3ef[_0x1a68f5(0x13a)]=_0x49555f['wallets']['usdtTrcWallet']||null),_0x49555f[_0x1a68f5(0x13e)][_0x1a68f5(0x12f)]!==undefined&&(_0x19c3ef[_0x1a68f5(0x12f)]=_0x49555f['wallets']['usdtErcWallet']||null),_0x49555f[_0x1a68f5(0x13e)][_0x1a68f5(0x145)]!==undefined&&(_0x19c3ef['usdcPolygonWallet']=_0x49555f['wallets'][_0x1a68f5(0x145)]||null),delete _0x19c3ef[_0x1a68f5(0x13e)]);const _0x5d2535=await database_1[_0x1a68f5(0x15c)][_0x1a68f5(0x16e)][_0x1a68f5(0x1cb)]({'where':{'id':_0x3a921a},'data':_0x19c3ef,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x5d2535['id'],'fullName':_0x5d2535[_0x1a68f5(0x1b6)],'username':_0x5d2535[_0x1a68f5(0x1c7)],'telegramId':_0x5d2535['telegram'],'merchantUrl':_0x5d2535[_0x1a68f5(0x1e8)],'gateways':_0x5d2535[_0x1a68f5(0x1e4)]?JSON[_0x1a68f5(0x188)](_0x5d2535[_0x1a68f5(0x1e4)]):null,'gatewaySettings':_0x5d2535[_0x1a68f5(0x159)]?JSON[_0x1a68f5(0x188)](_0x5d2535[_0x1a68f5(0x159)]):null,'publicKey':_0x5d2535['publicKey'],'wallets':{'usdtPolygonWallet':_0x5d2535[_0x1a68f5(0x185)],'usdtTrcWallet':_0x5d2535[_0x1a68f5(0x13a)],'usdtErcWallet':_0x5d2535[_0x1a68f5(0x12f)],'usdcPolygonWallet':_0x5d2535[_0x1a68f5(0x145)]},'status':_0x5d2535[_0x1a68f5(0x17e)],'createdAt':_0x5d2535[_0x1a68f5(0x1ac)]};}async[a35_0x49364c(0x161)](_0xd1fbc2){const _0x198488=a35_0x49364c,_0x8cd8f9=await database_1[_0x198488(0x15c)]['shop'][_0x198488(0x1cb)]({'where':{'id':_0xd1fbc2},'data':{'status':'SUSPENDED'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x8cd8f9['id'],'fullName':_0x8cd8f9[_0x198488(0x1b6)],'username':_0x8cd8f9[_0x198488(0x1c7)],'telegramId':_0x8cd8f9[_0x198488(0x1a4)],'merchantUrl':_0x8cd8f9[_0x198488(0x1e8)],'gateways':_0x8cd8f9[_0x198488(0x1e4)]?JSON[_0x198488(0x188)](_0x8cd8f9[_0x198488(0x1e4)]):null,'gatewaySettings':_0x8cd8f9[_0x198488(0x159)]?JSON[_0x198488(0x188)](_0x8cd8f9[_0x198488(0x159)]):null,'publicKey':_0x8cd8f9[_0x198488(0x14e)],'wallets':{'usdtPolygonWallet':_0x8cd8f9[_0x198488(0x185)],'usdtTrcWallet':_0x8cd8f9[_0x198488(0x13a)],'usdtErcWallet':_0x8cd8f9[_0x198488(0x12f)],'usdcPolygonWallet':_0x8cd8f9[_0x198488(0x145)]},'status':_0x8cd8f9['status'],'createdAt':_0x8cd8f9[_0x198488(0x1ac)]};}async['activateUser'](_0x5bfd8e){const _0x26449=a35_0x49364c,_0x432c46=await database_1[_0x26449(0x15c)][_0x26449(0x16e)]['update']({'where':{'id':_0x5bfd8e},'data':{'status':_0x26449(0x1af)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x432c46['id'],'fullName':_0x432c46[_0x26449(0x1b6)],'username':_0x432c46[_0x26449(0x1c7)],'telegramId':_0x432c46[_0x26449(0x1a4)],'merchantUrl':_0x432c46[_0x26449(0x1e8)],'gateways':_0x432c46['paymentGateways']?JSON[_0x26449(0x188)](_0x432c46['paymentGateways']):null,'gatewaySettings':_0x432c46[_0x26449(0x159)]?JSON[_0x26449(0x188)](_0x432c46[_0x26449(0x159)]):null,'publicKey':_0x432c46[_0x26449(0x14e)],'wallets':{'usdtPolygonWallet':_0x432c46['usdtPolygonWallet'],'usdtTrcWallet':_0x432c46[_0x26449(0x13a)],'usdtErcWallet':_0x432c46['usdtErcWallet'],'usdcPolygonWallet':_0x432c46[_0x26449(0x145)]},'status':_0x432c46[_0x26449(0x17e)],'createdAt':_0x432c46[_0x26449(0x1ac)]};}async[a35_0x49364c(0x154)](_0x3090fe){const _0x223917=a35_0x49364c,{page:_0xce3305,limit:_0x836f62,status:_0x4dd392}=_0x3090fe,_0x37b419=(_0xce3305-0x1)*_0x836f62,_0x1d86ca={};_0x4dd392&&(_0x1d86ca[_0x223917(0x17e)]=_0x4dd392['toUpperCase']());const [_0x451dff,_0x21f88b]=await Promise[_0x223917(0x1e2)]([database_1['default']['shop']['findMany']({'where':_0x1d86ca,'skip':_0x37b419,'take':_0x836f62,'orderBy':{'createdAt':_0x223917(0x1b9)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x223917(0x15c)]['shop'][_0x223917(0x1f8)]({'where':_0x1d86ca})]);return{'users':_0x451dff['map'](_0x4cdc52=>({'id':_0x4cdc52['id'],'fullName':_0x4cdc52[_0x223917(0x1b6)],'username':_0x4cdc52[_0x223917(0x1c7)],'telegramId':_0x4cdc52[_0x223917(0x1a4)],'merchantUrl':_0x4cdc52[_0x223917(0x1e8)],'gateways':_0x4cdc52[_0x223917(0x1e4)]?JSON['parse'](_0x4cdc52[_0x223917(0x1e4)]):null,'gatewaySettings':_0x4cdc52[_0x223917(0x159)]?JSON[_0x223917(0x188)](_0x4cdc52[_0x223917(0x159)]):null,'publicKey':_0x4cdc52[_0x223917(0x14e)],'wallets':{'usdtPolygonWallet':_0x4cdc52['usdtPolygonWallet'],'usdtTrcWallet':_0x4cdc52[_0x223917(0x13a)],'usdtErcWallet':_0x4cdc52[_0x223917(0x12f)],'usdcPolygonWallet':_0x4cdc52['usdcPolygonWallet']},'status':_0x4cdc52[_0x223917(0x17e)],'createdAt':_0x4cdc52[_0x223917(0x1ac)]})),'pagination':{'page':_0xce3305,'limit':_0x836f62,'total':_0x21f88b,'totalPages':Math['ceil'](_0x21f88b/_0x836f62)}};}async[a35_0x49364c(0x193)](_0x5c74e9){const _0x5dd125=a35_0x49364c,_0x532706=await database_1[_0x5dd125(0x15c)]['shop'][_0x5dd125(0x198)]({'where':{'id':_0x5c74e9},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x532706)return null;return{'id':_0x532706['id'],'fullName':_0x532706['name'],'username':_0x532706[_0x5dd125(0x1c7)],'telegramId':_0x532706[_0x5dd125(0x1a4)],'merchantUrl':_0x532706[_0x5dd125(0x1e8)],'gateways':_0x532706[_0x5dd125(0x1e4)]?JSON[_0x5dd125(0x188)](_0x532706[_0x5dd125(0x1e4)]):null,'gatewaySettings':_0x532706['gatewaySettings']?JSON['parse'](_0x532706['gatewaySettings']):null,'publicKey':_0x532706[_0x5dd125(0x14e)],'wallets':{'usdtPolygonWallet':_0x532706[_0x5dd125(0x185)],'usdtTrcWallet':_0x532706[_0x5dd125(0x13a)],'usdtErcWallet':_0x532706[_0x5dd125(0x12f)],'usdcPolygonWallet':_0x532706[_0x5dd125(0x145)]},'status':_0x532706[_0x5dd125(0x17e)],'createdAt':_0x532706[_0x5dd125(0x1ac)]};}async['createUser'](_0x3cfef3){const _0x5bb796=a35_0x49364c,{fullName:_0x1e5681,username:_0x4a6de1,password:_0x3dff54,telegramId:_0x3ac247,merchantUrl:_0xa2e34,gateways:_0x5760b2,gatewaySettings:_0x3d2b32,wallets:_0x33bba4}=_0x3cfef3,_0x1b180b=await database_1[_0x5bb796(0x15c)][_0x5bb796(0x16e)][_0x5bb796(0x198)]({'where':{'username':_0x4a6de1}});if(_0x1b180b)throw new Error(_0x5bb796(0x1ad));if(_0x3ac247){const _0x257092=await database_1[_0x5bb796(0x15c)][_0x5bb796(0x16e)][_0x5bb796(0x198)]({'where':{'telegram':_0x3ac247}});if(_0x257092)throw new Error(_0x5bb796(0x132));}const _0x1469e7=await bcryptjs_1[_0x5bb796(0x15c)]['hash'](_0x3dff54,0xc),_0x56b9e3=_0x5bb796(0x15e)+crypto_1[_0x5bb796(0x15c)]['randomBytes'](0x20)['toString']('hex'),_0x11e53b=_0x5bb796(0x1d6)+crypto_1[_0x5bb796(0x15c)][_0x5bb796(0x1c9)](0x20)[_0x5bb796(0x17f)](_0x5bb796(0x1a5)),_0x472ffe=await database_1[_0x5bb796(0x15c)][_0x5bb796(0x16e)][_0x5bb796(0x167)]({'data':{'name':_0x1e5681,'username':_0x4a6de1,'password':_0x1469e7,'telegram':_0x3ac247,'shopUrl':_0xa2e34,'paymentGateways':_0x5760b2?JSON[_0x5bb796(0x1d4)](_0x5760b2):null,'gatewaySettings':_0x3d2b32?JSON[_0x5bb796(0x1d4)](_0x3d2b32):null,'usdtPolygonWallet':_0x33bba4?.[_0x5bb796(0x185)]||null,'usdtTrcWallet':_0x33bba4?.[_0x5bb796(0x13a)]||null,'usdtErcWallet':_0x33bba4?.[_0x5bb796(0x12f)]||null,'usdcPolygonWallet':_0x33bba4?.['usdcPolygonWallet']||null,'publicKey':_0x56b9e3,'secretKey':_0x11e53b,'status':_0x5bb796(0x1af)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x472ffe['id'],'fullName':_0x472ffe[_0x5bb796(0x1b6)],'username':_0x472ffe[_0x5bb796(0x1c7)],'telegramId':_0x472ffe[_0x5bb796(0x1a4)],'merchantUrl':_0x472ffe[_0x5bb796(0x1e8)],'gateways':_0x472ffe[_0x5bb796(0x1e4)]?JSON[_0x5bb796(0x188)](_0x472ffe[_0x5bb796(0x1e4)]):null,'gatewaySettings':_0x472ffe[_0x5bb796(0x159)]?JSON[_0x5bb796(0x188)](_0x472ffe['gatewaySettings']):null,'publicKey':_0x472ffe[_0x5bb796(0x14e)],'wallets':{'usdtPolygonWallet':_0x472ffe[_0x5bb796(0x185)],'usdtTrcWallet':_0x472ffe[_0x5bb796(0x13a)],'usdtErcWallet':_0x472ffe[_0x5bb796(0x12f)],'usdcPolygonWallet':_0x472ffe['usdcPolygonWallet']},'status':_0x472ffe['status'],'createdAt':_0x472ffe['createdAt']};}async[a35_0x49364c(0x15f)](_0x86ba9d){const _0x4b52bc=a35_0x49364c;await database_1[_0x4b52bc(0x15c)][_0x4b52bc(0x16e)][_0x4b52bc(0x1c6)]({'where':{'id':_0x86ba9d}});}}exports[a35_0x49364c(0x1c8)]=AdminService;