'use strict';const a33_0x31295c=a33_0x1d9d;(function(_0x2a9d59,_0x25804a){const _0x2a0154=a33_0x1d9d,_0x1243ea=_0x2a9d59();while(!![]){try{const _0x605be8=-parseInt(_0x2a0154(0x29a))/0x1*(parseInt(_0x2a0154(0x293))/0x2)+parseInt(_0x2a0154(0x2b8))/0x3*(-parseInt(_0x2a0154(0x25c))/0x4)+parseInt(_0x2a0154(0x224))/0x5+-parseInt(_0x2a0154(0x268))/0x6+-parseInt(_0x2a0154(0x211))/0x7*(parseInt(_0x2a0154(0x271))/0x8)+-parseInt(_0x2a0154(0x2ac))/0x9*(parseInt(_0x2a0154(0x227))/0xa)+parseInt(_0x2a0154(0x1fb))/0xb;if(_0x605be8===_0x25804a)break;else _0x1243ea['push'](_0x1243ea['shift']());}catch(_0x11e085){_0x1243ea['push'](_0x1243ea['shift']());}}}(a33_0x40f0,0xed0b1));var __importDefault=this&&this['__importDefault']||function(_0x30c18b){const _0x448b6b=a33_0x1d9d;return _0x30c18b&&_0x30c18b[_0x448b6b(0x259)]?_0x30c18b:{'default':_0x30c18b};};function a33_0x1d9d(_0x10f336,_0x1436ac){const _0x40f00f=a33_0x40f0();return a33_0x1d9d=function(_0x1d9d03,_0xc52b6c){_0x1d9d03=_0x1d9d03-0x1eb;let _0x2427d8=_0x40f00f[_0x1d9d03];return _0x2427d8;},a33_0x1d9d(_0x10f336,_0x1436ac);}Object[a33_0x31295c(0x2a4)](exports,a33_0x31295c(0x259),{'value':!![]}),exports[a33_0x31295c(0x24c)]=void 0x0;const database_1=__importDefault(require('../config/database')),currencyService_1=require(a33_0x31295c(0x22d)),userService_1=require(a33_0x31295c(0x273)),telegramBotService_1=require('./telegramBotService'),gateway_1=require(a33_0x31295c(0x242));class AdminService{constructor(){const _0x200c83=a33_0x31295c;this[_0x200c83(0x24a)]=new userService_1[(_0x200c83(0x206))]();}['getPeriodDays'](_0x5a5f50){const _0x1b8a00=a33_0x31295c;switch(_0x5a5f50){case'7d':return 0x7;case'30d':return 0x1e;case _0x1b8a00(0x2be):return 0x5a;case'1y':return 0x16d;default:return 0x1e;}}['generateDateRange'](_0x2f4c8a,_0x2c55f2){const _0x1116fa=a33_0x31295c,_0x58ddde=[],_0x4e22ca=new Date(_0x2f4c8a);while(_0x4e22ca<=_0x2c55f2){_0x58ddde[_0x1116fa(0x1ee)](_0x4e22ca[_0x1116fa(0x201)]()[_0x1116fa(0x208)]('T')[0x0]),_0x4e22ca[_0x1116fa(0x23d)](_0x4e22ca[_0x1116fa(0x205)]()+0x1);}return _0x58ddde;}['getGatewaySettings'](_0x51a6a5,_0x40b21a){const _0x5ef767=a33_0x31295c;if(!_0x51a6a5['gatewaySettings'])return{'commission':0x0,'payoutDelay':0x0};try{const _0x2ae27d=JSON['parse'](_0x51a6a5[_0x5ef767(0x217)]),_0x580fa1=_0x40b21a[_0x5ef767(0x26a)](0x0)['toUpperCase']()+_0x40b21a[_0x5ef767(0x214)](0x1)[_0x5ef767(0x1eb)]();if(_0x2ae27d&&_0x2ae27d[_0x580fa1])return{'commission':_0x2ae27d[_0x580fa1][_0x5ef767(0x20d)]||0x0,'payoutDelay':_0x2ae27d[_0x580fa1][_0x5ef767(0x26c)]||0x0};}catch(_0x2c938e){console[_0x5ef767(0x281)](_0x5ef767(0x266),_0x2c938e);}return{'commission':0x0,'payoutDelay':0x0};}[a33_0x31295c(0x2ae)](_0x537cd7){const _0x3d43d5=a33_0x31295c;if(_0x537cd7[_0x3d43d5(0x2a8)]!==_0x3d43d5(0x246)||_0x537cd7[_0x3d43d5(0x23a)]||!_0x537cd7['paidAt'])return![];const _0x5e01bf=this[_0x3d43d5(0x241)](_0x537cd7['shop'],_0x537cd7[_0x3d43d5(0x209)]),_0x498865=_0x5e01bf[_0x3d43d5(0x26c)]*0x18*0x3c*0x3c*0x3e8,_0x140e72=new Date(_0x537cd7['paidAt']['getTime']()+_0x498865);return new Date()>_0x140e72;}[a33_0x31295c(0x2a0)](_0x4a5f8f,_0x5dbaaf){return _0x4a5f8f*(0x1-_0x5dbaaf/0x64);}[a33_0x31295c(0x2b9)](_0x27e0f1){const _0x4f0b80=a33_0x31295c;switch(_0x27e0f1[_0x4f0b80(0x2a8)]){case _0x4f0b80(0x246):return _0x27e0f1[_0x4f0b80(0x22c)];case _0x4f0b80(0x231):return-(_0x27e0f1[_0x4f0b80(0x218)]||0x0);case _0x4f0b80(0x2bf):return 0x0;default:return 0x0;}}async[a33_0x31295c(0x256)](_0x71828d){const _0x5badd9=a33_0x31295c,{shopId:_0x2f54b7,amount:_0x5bed44,network:_0x117703,notes:_0x3568c}=_0x71828d;console[_0x5badd9(0x2bb)]('💸\x20Creating\x20payout\x20for\x20shop\x20'+_0x2f54b7+':\x20'+_0x5bed44+'\x20USDT\x20via\x20'+_0x117703);const _0x576554=await database_1[_0x5badd9(0x29d)]['shop'][_0x5badd9(0x200)]({'where':{'id':_0x2f54b7},'select':{'id':!![],'name':!![],'username':!![],'status':!![]}});if(!_0x576554)throw new Error(_0x5badd9(0x29f));if(_0x576554[_0x5badd9(0x2a8)]!==_0x5badd9(0x21e))throw new Error(_0x5badd9(0x29e));const _0x1e4cd5=await database_1[_0x5badd9(0x29d)]['payout']['create']({'data':{'shopId':_0x2f54b7,'amount':_0x5bed44,'network':_0x117703,'status':_0x5badd9(0x22e),'notes':_0x3568c||null,'paidAt':new Date()},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});await this[_0x5badd9(0x28c)](_0x2f54b7,_0x5bed44);try{await telegramBotService_1['telegramBotService'][_0x5badd9(0x2b2)](_0x2f54b7,_0x1e4cd5,_0x5badd9(0x2a1));}catch(_0x3a3ac5){console[_0x5badd9(0x281)](_0x5badd9(0x254),_0x3a3ac5);}return console['log'](_0x5badd9(0x213)+_0x1e4cd5['id']),{'id':_0x1e4cd5['id'],'shopId':_0x1e4cd5[_0x5badd9(0x255)],'shopName':_0x1e4cd5[_0x5badd9(0x258)][_0x5badd9(0x233)],'shopUsername':_0x1e4cd5[_0x5badd9(0x258)][_0x5badd9(0x27b)],'amount':_0x1e4cd5['amount'],'network':_0x1e4cd5['network'],'status':_0x1e4cd5[_0x5badd9(0x2a8)],'txid':_0x1e4cd5['txid'],'notes':_0x1e4cd5[_0x5badd9(0x28d)],'createdAt':_0x1e4cd5['createdAt'],'paidAt':_0x1e4cd5['paidAt']};}async[a33_0x31295c(0x28c)](_0x1ccfbb,_0x171b96){const _0xb884f4=a33_0x31295c;console[_0xb884f4(0x2bb)](_0xb884f4(0x2aa)+_0x1ccfbb+_0xb884f4(0x28f)+_0x171b96+_0xb884f4(0x277));const _0xf6a6b=await database_1[_0xb884f4(0x29d)][_0xb884f4(0x223)][_0xb884f4(0x2bc)]({'where':{'shopId':_0x1ccfbb,'status':_0xb884f4(0x246),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'shop':{'select':{'gatewaySettings':!![]}}},'orderBy':{'paidAt':_0xb884f4(0x1fc)}});let _0x5f135a=_0x171b96;const _0x32b137=[];for(const _0x47868b of _0xf6a6b){const _0x8e0f58={..._0x47868b,'status':'PAID','merchantPaid':![],'shop':{'gatewaySettings':_0x47868b[_0xb884f4(0x258)][_0xb884f4(0x217)]}};if(!this[_0xb884f4(0x2ae)](_0x8e0f58))continue;const _0x219e06=await currencyService_1[_0xb884f4(0x2ad)][_0xb884f4(0x26e)](_0x47868b['amount'],_0x47868b[_0xb884f4(0x240)]),_0x2a238e=this['getGatewaySettings'](_0x47868b['shop'],_0x47868b[_0xb884f4(0x209)]),_0x5c0c38=this['calculateAmountAfterCommission'](_0x219e06,_0x2a238e['commission']);if(_0x5c0c38<=_0x5f135a){_0x32b137[_0xb884f4(0x1ee)](_0x47868b['id']),_0x5f135a-=_0x5c0c38;if(_0x5f135a<=0.01)break;}}_0x32b137['length']>0x0&&(await database_1['default'][_0xb884f4(0x223)][_0xb884f4(0x2b4)]({'where':{'id':{'in':_0x32b137}},'data':{'merchantPaid':!![]}}),console[_0xb884f4(0x2bb)](_0xb884f4(0x29b)+_0x32b137['length']+_0xb884f4(0x247)));}async[a33_0x31295c(0x239)](_0x221c93){const _0x4c2b11=a33_0x31295c,{page:_0x1830f4,limit:_0x3ae7db,shopId:_0x1506f7,network:_0x2fb5e6,dateFrom:_0x1a2560,dateTo:_0x56912c,search:_0x40b85c}=_0x221c93,_0x17ea2e=(_0x1830f4-0x1)*_0x3ae7db;console[_0x4c2b11(0x2bb)]('📋\x20Getting\x20payouts\x20with\x20filters:',_0x221c93);const _0x22f364={};_0x1506f7&&(_0x22f364[_0x4c2b11(0x255)]=_0x1506f7);_0x2fb5e6&&(_0x22f364[_0x4c2b11(0x24f)]=_0x2fb5e6);(_0x1a2560||_0x56912c)&&(_0x22f364[_0x4c2b11(0x202)]={},_0x1a2560&&(_0x22f364[_0x4c2b11(0x202)][_0x4c2b11(0x25e)]=new Date(_0x1a2560)),_0x56912c&&(_0x22f364[_0x4c2b11(0x202)][_0x4c2b11(0x2c0)]=new Date(_0x56912c)));_0x40b85c&&(_0x22f364['OR']=[{'txid':{'contains':_0x40b85c,'mode':_0x4c2b11(0x230)}},{'notes':{'contains':_0x40b85c,'mode':_0x4c2b11(0x230)}},{'shop':{'name':{'contains':_0x40b85c,'mode':_0x4c2b11(0x230)}}},{'shop':{'username':{'contains':_0x40b85c,'mode':_0x4c2b11(0x230)}}}]);const [_0x46fe66,_0x520815]=await Promise['all']([database_1['default'][_0x4c2b11(0x207)][_0x4c2b11(0x2bc)]({'where':_0x22f364,'skip':_0x17ea2e,'take':_0x3ae7db,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x4c2b11(0x29d)][_0x4c2b11(0x207)]['count']({'where':_0x22f364})]);console[_0x4c2b11(0x2bb)](_0x4c2b11(0x285)+_0x46fe66['length']+_0x4c2b11(0x22b)+_0x520815+_0x4c2b11(0x2c3));const _0x1dbfb9=_0x46fe66[_0x4c2b11(0x248)](_0x427ba8=>({'id':_0x427ba8['id'],'shopId':_0x427ba8['shopId'],'shopName':_0x427ba8['shop'][_0x4c2b11(0x233)],'shopUsername':_0x427ba8[_0x4c2b11(0x258)][_0x4c2b11(0x27b)],'amount':_0x427ba8[_0x4c2b11(0x22c)],'network':_0x427ba8['network'],'status':_0x427ba8[_0x4c2b11(0x2a8)],'txid':_0x427ba8[_0x4c2b11(0x275)],'notes':_0x427ba8[_0x4c2b11(0x28d)],'createdAt':_0x427ba8[_0x4c2b11(0x202)],'paidAt':_0x427ba8[_0x4c2b11(0x216)]}));return{'payouts':_0x1dbfb9,'pagination':{'page':_0x1830f4,'limit':_0x3ae7db,'total':_0x520815,'totalPages':Math['ceil'](_0x520815/_0x3ae7db)}};}async[a33_0x31295c(0x2b6)](_0x1659fb){const _0x5ed7db=a33_0x31295c;console[_0x5ed7db(0x2bb)](_0x5ed7db(0x1f9)+_0x1659fb);const _0x219189=await database_1['default'][_0x5ed7db(0x207)][_0x5ed7db(0x200)]({'where':{'id':_0x1659fb},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x219189)return console[_0x5ed7db(0x2bb)](_0x5ed7db(0x1fe)+_0x1659fb),null;return console['log'](_0x5ed7db(0x22a)+_0x219189[_0x5ed7db(0x22c)]+_0x5ed7db(0x21b)+_0x219189['network']),{'id':_0x219189['id'],'shopId':_0x219189['shopId'],'shopName':_0x219189[_0x5ed7db(0x258)][_0x5ed7db(0x233)],'shopUsername':_0x219189[_0x5ed7db(0x258)]['username'],'amount':_0x219189['amount'],'network':_0x219189[_0x5ed7db(0x24f)],'status':_0x219189[_0x5ed7db(0x2a8)],'txid':_0x219189[_0x5ed7db(0x275)],'notes':_0x219189[_0x5ed7db(0x28d)],'createdAt':_0x219189[_0x5ed7db(0x202)],'paidAt':_0x219189[_0x5ed7db(0x216)]};}async[a33_0x31295c(0x21c)](_0x26fa5b){const _0x459352=a33_0x31295c;console[_0x459352(0x2bb)](_0x459352(0x20f)+_0x26fa5b);const _0x2c536c=await database_1[_0x459352(0x29d)][_0x459352(0x207)][_0x459352(0x200)]({'where':{'id':_0x26fa5b},'select':{'id':!![],'shopId':!![],'amount':!![]}});if(!_0x2c536c)throw new Error(_0x459352(0x260));await database_1[_0x459352(0x29d)][_0x459352(0x207)][_0x459352(0x251)]({'where':{'id':_0x26fa5b}}),console[_0x459352(0x2bb)](_0x459352(0x21f)+_0x26fa5b+_0x459352(0x1fa));}async[a33_0x31295c(0x1ed)](_0x2ab043){const _0x33f9d3=a33_0x31295c,{page:_0x10dcff,limit:_0x1b4665,minAmount:_0x163454,search:_0x49b963}=_0x2ab043;console[_0x33f9d3(0x2bb)]('📋\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:',_0x2ab043);const _0x33361c=await database_1[_0x33f9d3(0x29d)][_0x33f9d3(0x223)][_0x33f9d3(0x2bc)]({'where':{'status':_0x33f9d3(0x246),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'createdAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'gatewaySettings':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}});console['log'](_0x33f9d3(0x235)+_0x33361c[_0x33f9d3(0x2ab)]+_0x33f9d3(0x25d));const _0x3855a9=new Map();for(const _0x3b89c3 of _0x33361c){const _0x49e559={..._0x3b89c3,'status':_0x33f9d3(0x246),'merchantPaid':![],'shop':{'gatewaySettings':_0x3b89c3[_0x33f9d3(0x258)][_0x33f9d3(0x217)]}},_0x804f84=this[_0x33f9d3(0x2ae)](_0x49e559);if(!_0x804f84)continue;const _0x23187f=await currencyService_1[_0x33f9d3(0x2ad)]['convertToUSDT'](_0x3b89c3['amount'],_0x3b89c3[_0x33f9d3(0x240)]),_0x30b782=this[_0x33f9d3(0x241)](_0x3b89c3[_0x33f9d3(0x258)],_0x3b89c3['gateway']),_0x224c3b=this[_0x33f9d3(0x2a0)](_0x23187f,_0x30b782['commission']),_0x216e68=_0x3b89c3['shopId'];!_0x3855a9[_0x33f9d3(0x25b)](_0x216e68)&&_0x3855a9[_0x33f9d3(0x243)](_0x216e68,{'shop':_0x3b89c3[_0x33f9d3(0x258)],'payments':[]}),_0x3855a9[_0x33f9d3(0x292)](_0x216e68)[_0x33f9d3(0x267)][_0x33f9d3(0x1ee)]({'id':_0x3b89c3['id'],'amount':_0x3b89c3['amount'],'currency':_0x3b89c3[_0x33f9d3(0x240)],'gateway':_0x3b89c3['gateway'],'paidAt':_0x3b89c3[_0x33f9d3(0x216)],'createdAt':_0x3b89c3['createdAt'],'amountUSDT':_0x23187f,'commission':_0x30b782[_0x33f9d3(0x20d)],'amountAfterCommissionUSDT':_0x224c3b,'isEligible':!![]});}console[_0x33f9d3(0x2bb)]('🏪\x20Found\x20'+_0x3855a9[_0x33f9d3(0x220)]+_0x33f9d3(0x284));const _0x2d88e5=[];for(const [_0x426c21,_0x34e3dc]of _0x3855a9){const {shop:_0x373864,payments:_0x2c9ecb}=_0x34e3dc,_0x48d373=_0x2c9ecb[_0x33f9d3(0x22f)]((_0x1fe1be,_0x427bd5)=>_0x1fe1be+_0x427bd5[_0x33f9d3(0x28b)],0x0),_0x11bcb7=_0x2c9ecb[_0x33f9d3(0x22f)]((_0xcdae18,_0x479f37)=>_0xcdae18+_0x479f37[_0x33f9d3(0x1f6)],0x0);if(_0x163454&&_0x11bcb7<_0x163454)continue;if(_0x49b963){const _0x369e83=_0x49b963[_0x33f9d3(0x1eb)](),_0x402269=_0x373864['name'][_0x33f9d3(0x1eb)]()['includes'](_0x369e83)||_0x373864[_0x33f9d3(0x27b)][_0x33f9d3(0x1eb)]()[_0x33f9d3(0x1f2)](_0x369e83)||_0x373864[_0x33f9d3(0x261)]&&_0x373864['telegram'][_0x33f9d3(0x1eb)]()['includes'](_0x369e83);if(!_0x402269)continue;}const _0x168480=new Map();for(const _0x4d9ebe of _0x2c9ecb){const _0x1b0cf3=_0x4d9ebe[_0x33f9d3(0x209)];!_0x168480['has'](_0x1b0cf3)&&_0x168480[_0x33f9d3(0x243)](_0x1b0cf3,{'count':0x0,'amountUSDT':0x0,'amountAfterCommissionUSDT':0x0,'commission':_0x4d9ebe['commission']});const _0x1817ef=_0x168480['get'](_0x1b0cf3);_0x1817ef[_0x33f9d3(0x27a)]++,_0x1817ef['amountUSDT']+=_0x4d9ebe[_0x33f9d3(0x28b)],_0x1817ef['amountAfterCommissionUSDT']+=_0x4d9ebe[_0x33f9d3(0x1f6)];}const _0x2c6feb=Array[_0x33f9d3(0x25f)](_0x168480[_0x33f9d3(0x2b1)]())[_0x33f9d3(0x248)](([_0xd67681,_0x17928d])=>({'gateway':_0xd67681['charAt'](0x0)[_0x33f9d3(0x219)]()+_0xd67681[_0x33f9d3(0x214)](0x1),'count':_0x17928d[_0x33f9d3(0x27a)],'amountUSDT':Math[_0x33f9d3(0x289)](_0x17928d['amountUSDT']*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x33f9d3(0x289)](_0x17928d[_0x33f9d3(0x1f6)]*0x64)/0x64,'commission':_0x17928d[_0x33f9d3(0x20d)]})),_0x24e385=_0x2c9ecb[_0x33f9d3(0x22f)]((_0x417bb6,_0x21bf98)=>{const _0x198b12=_0x33f9d3;return _0x21bf98[_0x198b12(0x216)]<_0x417bb6?_0x21bf98[_0x198b12(0x216)]:_0x417bb6;},_0x2c9ecb[0x0]['paidAt']);_0x2d88e5[_0x33f9d3(0x1ee)]({'id':_0x373864['id'],'fullName':_0x373864['name'],'username':_0x373864['username'],'telegramId':_0x373864[_0x33f9d3(0x261)],'merchantUrl':_0x373864[_0x33f9d3(0x1f5)],'wallets':{'usdtPolygonWallet':_0x373864[_0x33f9d3(0x1f7)],'usdtTrcWallet':_0x373864[_0x33f9d3(0x26b)],'usdtErcWallet':_0x373864[_0x33f9d3(0x270)],'usdcPolygonWallet':_0x373864[_0x33f9d3(0x229)]},'totalAmountUSDT':Math[_0x33f9d3(0x289)](_0x48d373*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x33f9d3(0x289)](_0x11bcb7*0x64)/0x64,'paymentsCount':_0x2c9ecb[_0x33f9d3(0x2ab)],'oldestPaymentDate':_0x24e385,'gatewayBreakdown':_0x2c6feb});}_0x2d88e5['sort']((_0x435465,_0x2924db)=>_0x2924db[_0x33f9d3(0x2b7)]-_0x435465[_0x33f9d3(0x2b7)]);const _0x487150=_0x2d88e5[_0x33f9d3(0x2ab)],_0x249f24=_0x2d88e5[_0x33f9d3(0x22f)]((_0xadeb1b,_0x2c9829)=>_0xadeb1b+_0x2c9829['totalAmountUSDT'],0x0),_0x313479=_0x2d88e5[_0x33f9d3(0x22f)]((_0x2fea2f,_0x5bfe33)=>_0x2fea2f+_0x5bfe33[_0x33f9d3(0x2b7)],0x0),_0x2c1032=(_0x10dcff-0x1)*_0x1b4665,_0x335a95=_0x2d88e5[_0x33f9d3(0x214)](_0x2c1032,_0x2c1032+_0x1b4665);return console[_0x33f9d3(0x2bb)]('✅\x20Returning\x20'+_0x335a95[_0x33f9d3(0x2ab)]+_0x33f9d3(0x262)+_0x487150+_0x33f9d3(0x2c3)),console['log'](_0x33f9d3(0x25a)+_0x249f24[_0x33f9d3(0x253)](0x2)+'\x20USDT\x20('+_0x313479[_0x33f9d3(0x253)](0x2)+_0x33f9d3(0x1f1)),{'merchants':_0x335a95,'pagination':{'page':_0x10dcff,'limit':_0x1b4665,'total':_0x487150,'totalPages':Math[_0x33f9d3(0x1f4)](_0x487150/_0x1b4665)},'summary':{'totalMerchants':_0x487150,'totalAmountUSDT':Math[_0x33f9d3(0x289)](_0x249f24*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x33f9d3(0x289)](_0x313479*0x64)/0x64}};}async[a33_0x31295c(0x291)](){const _0x4bcc61=a33_0x31295c;console[_0x4bcc61(0x2bb)]('📊\x20Calculating\x20admin\x20payout\x20statistics...');const _0x3a400d=await database_1[_0x4bcc61(0x29d)][_0x4bcc61(0x223)][_0x4bcc61(0x2bc)]({'where':{'status':{'in':[_0x4bcc61(0x246),'REFUND',_0x4bcc61(0x231)]}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'status':!![],'gateway':!![],'paidAt':!![],'merchantPaid':!![],'createdAt':!![],'chargebackAmount':!![],'shop':{'select':{'gatewaySettings':!![]}}}});console['log']('💰\x20Found\x20'+_0x3a400d[_0x4bcc61(0x2ab)]+_0x4bcc61(0x24b));const _0xee2a2b=new Date(),_0x1a982f=new Date(_0xee2a2b[_0x4bcc61(0x2a6)](),_0xee2a2b['getMonth'](),0x1),_0x318fce=new Date(_0xee2a2b['getFullYear'](),_0xee2a2b[_0x4bcc61(0x210)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7);let _0x4faaf4=0x0,_0x32ee8b=0x0,_0x3ef16c=0x0,_0x5a8bec=0x0;for(const _0x3d4759 of _0x3a400d){const _0x2df123=this['calculateEffectiveAmount'](_0x3d4759);if(_0x2df123===0x0)continue;let _0x270c0f,_0x334528;if(_0x3d4759[_0x4bcc61(0x2a8)]===_0x4bcc61(0x231))_0x270c0f=Math['abs'](_0x2df123),_0x334528=-_0x270c0f;else{_0x270c0f=await currencyService_1[_0x4bcc61(0x2ad)][_0x4bcc61(0x26e)](_0x3d4759[_0x4bcc61(0x22c)],_0x3d4759[_0x4bcc61(0x240)]);const _0x1ec33f=this[_0x4bcc61(0x241)](_0x3d4759[_0x4bcc61(0x258)],_0x3d4759['gateway']);_0x334528=this[_0x4bcc61(0x2a0)](_0x270c0f,_0x1ec33f[_0x4bcc61(0x20d)]);}_0x3d4759[_0x4bcc61(0x23a)]&&(_0x4faaf4+=_0x334528,_0x3d4759[_0x4bcc61(0x216)]&&_0x3d4759[_0x4bcc61(0x216)]>=_0x1a982f&&_0x3d4759[_0x4bcc61(0x216)]<=_0x318fce&&(_0x3ef16c+=_0x334528)),_0x3d4759[_0x4bcc61(0x2a8)]===_0x4bcc61(0x246)&&this[_0x4bcc61(0x2ae)](_0x3d4759)&&(_0x32ee8b+=_0x334528,_0x5a8bec+=_0x270c0f);}const _0x1ca087={'totalPayout':Math[_0x4bcc61(0x289)](_0x4faaf4*0x64)/0x64,'awaitingPayout':Math[_0x4bcc61(0x289)](_0x32ee8b*0x64)/0x64,'thisMonth':Math[_0x4bcc61(0x289)](_0x3ef16c*0x64)/0x64,'availableBalance':Math[_0x4bcc61(0x289)](_0x5a8bec*0x64)/0x64};return console['log'](_0x4bcc61(0x294)),console['log']('💸\x20Total\x20Payout:\x20'+_0x1ca087[_0x4bcc61(0x296)]+_0x4bcc61(0x1f8)),console[_0x4bcc61(0x2bb)](_0x4bcc61(0x23e)+_0x1ca087[_0x4bcc61(0x269)]+_0x4bcc61(0x2c2)),console[_0x4bcc61(0x2bb)](_0x4bcc61(0x278)+_0x1ca087[_0x4bcc61(0x23f)]+_0x4bcc61(0x277)),console[_0x4bcc61(0x2bb)](_0x4bcc61(0x244)+_0x1ca087[_0x4bcc61(0x1ff)]+'\x20USDT'),_0x1ca087;}async[a33_0x31295c(0x29c)](_0x2f7099){const _0x28ad2d=a33_0x31295c,_0x5f571c=this[_0x28ad2d(0x27c)](_0x2f7099),_0x199d2d=new Date();_0x199d2d[_0x28ad2d(0x23d)](_0x199d2d[_0x28ad2d(0x205)]()-_0x5f571c),console[_0x28ad2d(0x2bb)](_0x28ad2d(0x297)+_0x2f7099+'\x20('+_0x5f571c+_0x28ad2d(0x287));const _0x3d557b=await database_1['default']['shop']['count']({'where':{'status':_0x28ad2d(0x21e)}}),_0x33a7fb=await database_1['default']['payment'][_0x28ad2d(0x27a)](),_0x5140b9=await database_1[_0x28ad2d(0x29d)]['payment'][_0x28ad2d(0x2bc)]({'where':{'status':{'in':[_0x28ad2d(0x246),_0x28ad2d(0x2bf),_0x28ad2d(0x231)]}},'select':{'amount':!![],'currency':!![],'status':!![],'chargebackAmount':!![],'createdAt':!![]}});console[_0x28ad2d(0x2bb)](_0x28ad2d(0x235)+_0x5140b9[_0x28ad2d(0x2ab)]+_0x28ad2d(0x1fd));const _0x166855=await Promise['all'](_0x5140b9[_0x28ad2d(0x248)](async _0x5501fc=>{const _0x4ddbc1=_0x28ad2d,_0x2d6a1a=this[_0x4ddbc1(0x2b9)](_0x5501fc);if(_0x2d6a1a===0x0)return{'amount':0x0,'createdAt':_0x5501fc[_0x4ddbc1(0x202)]};let _0x25e2e0;return _0x5501fc[_0x4ddbc1(0x2a8)]===_0x4ddbc1(0x231)?_0x25e2e0=-Math[_0x4ddbc1(0x1f3)](_0x2d6a1a):_0x25e2e0=await currencyService_1['currencyService'][_0x4ddbc1(0x26e)](_0x5501fc[_0x4ddbc1(0x22c)],_0x5501fc['currency']),{'amount':_0x25e2e0,'createdAt':_0x5501fc['createdAt']};})),_0x5dafc0=_0x166855[_0x28ad2d(0x22f)]((_0x1ba199,_0x33b65f)=>_0x1ba199+_0x33b65f[_0x28ad2d(0x22c)],0x0),_0x161ed6=_0x33a7fb>0x0?_0x5dafc0/_0x33a7fb:0x0;console[_0x28ad2d(0x2bb)](_0x28ad2d(0x26d)+_0x5dafc0[_0x28ad2d(0x253)](0x2)+'\x20USDT\x20(включая\x20штрафы\x20chargeback)'),console['log'](_0x28ad2d(0x1ec)+_0x161ed6[_0x28ad2d(0x253)](0x2)+_0x28ad2d(0x277));const _0x45f8bb=await database_1[_0x28ad2d(0x29d)]['$queryRaw']`
      SELECT 
        DATE(created_at) as date,
        array_agg(
          json_build_object(
            'amount', amount,
            'currency', currency,
            'status', status,
            'chargeback_amount', chargeback_amount
          )
        ) as payments
      FROM payments 
      WHERE created_at >= ${_0x199d2d}
        AND status IN ('PAID', 'REFUND', 'CHARGEBACK')
      GROUP BY DATE(created_at)
      ORDER BY date ASC
    `;console[_0x28ad2d(0x2bb)](_0x28ad2d(0x23b)+_0x45f8bb[_0x28ad2d(0x2ab)]+_0x28ad2d(0x283));const _0x41038=await Promise['all'](_0x45f8bb[_0x28ad2d(0x248)](async _0x8ccd43=>{const _0x122bf6=_0x28ad2d,_0xacf7fc=await Promise['all'](_0x8ccd43[_0x122bf6(0x267)][_0x122bf6(0x248)](async _0x10f55b=>{const _0x5e9560=_0x122bf6,_0x5c43b7=this[_0x5e9560(0x2b9)](_0x10f55b);if(_0x5c43b7===0x0)return 0x0;return _0x10f55b[_0x5e9560(0x2a8)]===_0x5e9560(0x231)?-Math[_0x5e9560(0x1f3)](_0x5c43b7):await currencyService_1[_0x5e9560(0x2ad)][_0x5e9560(0x26e)](_0x10f55b[_0x5e9560(0x22c)],_0x10f55b['currency']);})),_0x25af91=_0xacf7fc[_0x122bf6(0x22f)]((_0x53f356,_0x53355a)=>_0x53f356+_0x53355a,0x0);return{'date':_0x8ccd43[_0x122bf6(0x2a2)][_0x122bf6(0x201)]()[_0x122bf6(0x208)]('T')[0x0],'amount':_0x25af91};})),_0x4cb69d=this[_0x28ad2d(0x257)](_0x199d2d,new Date()),_0x1c20ae=new Map(_0x41038[_0x28ad2d(0x248)](_0x127acd=>[_0x127acd[_0x28ad2d(0x2a2)],_0x127acd['amount']])),_0x291400=_0x4cb69d['map'](_0x35b720=>({'date':_0x35b720,'amount':_0x1c20ae['get'](_0x35b720)||0x0}));return console[_0x28ad2d(0x2bb)](_0x28ad2d(0x282)),console[_0x28ad2d(0x2bb)](_0x28ad2d(0x28a)+_0x3d557b),console['log'](_0x28ad2d(0x263)+_0x33a7fb),console[_0x28ad2d(0x2bb)](_0x28ad2d(0x20b)+_0x291400[_0x28ad2d(0x2ab)]),{'totalRevenue':Math[_0x28ad2d(0x289)](_0x5dafc0*0x64)/0x64,'totalUsers':_0x3d557b,'totalPayments':_0x33a7fb,'averagePayment':Math[_0x28ad2d(0x289)](_0x161ed6*0x64)/0x64,'dailyRevenue':_0x291400};}async[a33_0x31295c(0x295)](_0x3732c0){const _0x34c57d=a33_0x31295c,{page:_0x2f2205,limit:_0x113d22,status:_0x4fc09c,gateway:_0x1222b7,shopId:_0x2cbfd3,dateFrom:_0x27cfbc,dateTo:_0x15d42e,search:_0x4571cb}=_0x3732c0,_0x4840d8=(_0x2f2205-0x1)*_0x113d22;console['log'](_0x34c57d(0x215),_0x3732c0);const _0x43b535={};_0x4fc09c&&(_0x43b535['status']=_0x4fc09c[_0x34c57d(0x219)]());if(_0x1222b7){if((0x0,gateway_1[_0x34c57d(0x245)])(_0x1222b7)){const _0x2997a9=(0x0,gateway_1['getGatewayNameById'])(_0x1222b7);_0x2997a9&&(_0x43b535[_0x34c57d(0x209)]=_0x2997a9);}else _0x43b535[_0x34c57d(0x209)]=_0x1222b7[_0x34c57d(0x1eb)]();}_0x2cbfd3&&(_0x43b535[_0x34c57d(0x255)]=_0x2cbfd3);(_0x27cfbc||_0x15d42e)&&(_0x43b535[_0x34c57d(0x202)]={},_0x27cfbc&&(_0x43b535[_0x34c57d(0x202)][_0x34c57d(0x25e)]=new Date(_0x27cfbc)),_0x15d42e&&(_0x43b535[_0x34c57d(0x202)][_0x34c57d(0x2c0)]=new Date(_0x15d42e)));_0x4571cb&&(_0x43b535['OR']=[{'orderId':{'contains':_0x4571cb,'mode':_0x34c57d(0x230)}},{'gatewayOrderId':{'contains':_0x4571cb,'mode':_0x34c57d(0x230)}},{'gatewayPaymentId':{'contains':_0x4571cb,'mode':_0x34c57d(0x230)}},{'customerEmail':{'contains':_0x4571cb,'mode':_0x34c57d(0x230)}},{'customerName':{'contains':_0x4571cb,'mode':_0x34c57d(0x230)}},{'shop':{'name':{'contains':_0x4571cb,'mode':_0x34c57d(0x230)}}},{'shop':{'username':{'contains':_0x4571cb,'mode':'insensitive'}}}]);const [_0x24d114,_0x1166bf]=await Promise['all']([database_1[_0x34c57d(0x29d)][_0x34c57d(0x223)][_0x34c57d(0x2bc)]({'where':_0x43b535,'skip':_0x4840d8,'take':_0x113d22,'orderBy':{'createdAt':_0x34c57d(0x2b5)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x34c57d(0x29d)][_0x34c57d(0x223)][_0x34c57d(0x27a)]({'where':_0x43b535})]);console['log']('📊\x20Found\x20'+_0x24d114[_0x34c57d(0x2ab)]+'\x20payments\x20out\x20of\x20'+_0x1166bf+_0x34c57d(0x2c3));const _0x26f621=_0x24d114['map'](_0x514829=>({'id':_0x514829['id'],'shopId':_0x514829['shopId'],'shopName':_0x514829[_0x34c57d(0x258)][_0x34c57d(0x233)],'shopUsername':_0x514829['shop'][_0x34c57d(0x27b)],'gateway':_0x514829['gateway'],'orderId':_0x514829[_0x34c57d(0x212)],'gatewayOrderId':_0x514829['gatewayOrderId'],'amount':_0x514829[_0x34c57d(0x22c)],'currency':_0x514829[_0x34c57d(0x240)],'sourceCurrency':_0x514829[_0x34c57d(0x28e)],'status':_0x514829[_0x34c57d(0x2a8)],'usage':_0x514829[_0x34c57d(0x279)],'externalPaymentUrl':_0x514829['externalPaymentUrl'],'gatewayPaymentId':_0x514829[_0x34c57d(0x274)],'customerEmail':_0x514829[_0x34c57d(0x265)],'customerName':_0x514829[_0x34c57d(0x232)],'cardLast4':_0x514829[_0x34c57d(0x24d)],'paymentMethod':_0x514829[_0x34c57d(0x276)],'bankId':_0x514829[_0x34c57d(0x272)],'remitterIban':_0x514829[_0x34c57d(0x222)],'remitterName':_0x514829[_0x34c57d(0x238)],'chargebackAmount':_0x514829[_0x34c57d(0x218)],'adminNotes':_0x514829[_0x34c57d(0x286)],'statusChangedBy':_0x514829[_0x34c57d(0x203)],'statusChangedAt':_0x514829['statusChangedAt'],'createdAt':_0x514829['createdAt'],'updatedAt':_0x514829[_0x34c57d(0x1f0)],'expiresAt':_0x514829['expiresAt']}));return{'payments':_0x26f621,'pagination':{'page':_0x2f2205,'limit':_0x113d22,'total':_0x1166bf,'totalPages':Math[_0x34c57d(0x1f4)](_0x1166bf/_0x113d22)}};}async[a33_0x31295c(0x2c5)](_0x1ebd95){const _0x247bd1=a33_0x31295c;console['log'](_0x247bd1(0x20c)+_0x1ebd95);const _0x2a1f65=await database_1['default']['payment'][_0x247bd1(0x200)]({'where':{'id':_0x1ebd95},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}},'webhookLogs':{'orderBy':{'createdAt':'desc'},'take':0xa,'select':{'id':!![],'event':!![],'statusCode':!![],'retryCount':!![],'createdAt':!![]}}}});if(!_0x2a1f65)return console['log'](_0x247bd1(0x2b0)+_0x1ebd95),null;return console[_0x247bd1(0x2bb)](_0x247bd1(0x20e)+_0x2a1f65[_0x247bd1(0x212)]+'\x20('+_0x2a1f65[_0x247bd1(0x2a8)]+')'),{'id':_0x2a1f65['id'],'shopId':_0x2a1f65[_0x247bd1(0x255)],'shopName':_0x2a1f65[_0x247bd1(0x258)][_0x247bd1(0x233)],'shopUsername':_0x2a1f65['shop'][_0x247bd1(0x27b)],'gateway':_0x2a1f65[_0x247bd1(0x209)],'orderId':_0x2a1f65[_0x247bd1(0x212)],'gatewayOrderId':_0x2a1f65['gatewayOrderId'],'amount':_0x2a1f65[_0x247bd1(0x22c)],'currency':_0x2a1f65['currency'],'sourceCurrency':_0x2a1f65['sourceCurrency'],'status':_0x2a1f65[_0x247bd1(0x2a8)],'usage':_0x2a1f65[_0x247bd1(0x279)],'externalPaymentUrl':_0x2a1f65[_0x247bd1(0x2c1)],'gatewayPaymentId':_0x2a1f65[_0x247bd1(0x274)],'customerEmail':_0x2a1f65[_0x247bd1(0x265)],'customerName':_0x2a1f65[_0x247bd1(0x232)],'cardLast4':_0x2a1f65[_0x247bd1(0x24d)],'paymentMethod':_0x2a1f65['paymentMethod'],'bankId':_0x2a1f65[_0x247bd1(0x272)],'remitterIban':_0x2a1f65[_0x247bd1(0x222)],'remitterName':_0x2a1f65['remitterName'],'chargebackAmount':_0x2a1f65['chargebackAmount'],'adminNotes':_0x2a1f65[_0x247bd1(0x286)],'statusChangedBy':_0x2a1f65['statusChangedBy'],'statusChangedAt':_0x2a1f65['statusChangedAt'],'createdAt':_0x2a1f65[_0x247bd1(0x202)],'updatedAt':_0x2a1f65[_0x247bd1(0x1f0)],'expiresAt':_0x2a1f65[_0x247bd1(0x26f)],'webhookLogs':_0x2a1f65[_0x247bd1(0x250)]};}async[a33_0x31295c(0x2af)](_0x2f9c8d,_0x5a74a4,_0x5b20be,_0x2936f8){const _0x35271e=a33_0x31295c;console[_0x35271e(0x2bb)]('🔄\x20Updating\x20payment\x20'+_0x2f9c8d+'\x20status\x20to:\x20'+_0x5a74a4);const _0x8ddc9d=[_0x35271e(0x221),_0x35271e(0x298),'PAID',_0x35271e(0x299),_0x35271e(0x2a3),'REFUND',_0x35271e(0x231)];if(!_0x8ddc9d[_0x35271e(0x1f2)](_0x5a74a4[_0x35271e(0x219)]()))throw new Error(_0x35271e(0x2c6)+_0x8ddc9d[_0x35271e(0x226)](',\x20'));const _0x12ef00=await database_1['default']['payment'][_0x35271e(0x200)]({'where':{'id':_0x2f9c8d},'select':{'id':!![],'status':!![],'orderId':!![]}});if(!_0x12ef00)throw new Error('Payment\x20not\x20found');if(_0x5a74a4[_0x35271e(0x219)]()===_0x35271e(0x231)){if(!_0x2936f8||_0x2936f8<=0x0)throw new Error(_0x35271e(0x252));console[_0x35271e(0x2bb)](_0x35271e(0x27f)+_0x2936f8+_0x35271e(0x21d));}const _0x1cc528={'status':_0x5a74a4['toUpperCase'](),'updatedAt':new Date()};_0x5b20be&&(_0x1cc528[_0x35271e(0x286)]=_0x5b20be);_0x5a74a4['toUpperCase']()===_0x35271e(0x231)&&_0x2936f8&&(_0x1cc528['chargebackAmount']=_0x2936f8);const _0x2c37cb=await database_1[_0x35271e(0x29d)]['payment'][_0x35271e(0x20a)]({'where':{'id':_0x2f9c8d},'data':_0x1cc528,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});return await database_1[_0x35271e(0x29d)][_0x35271e(0x24e)]['create']({'data':{'paymentId':_0x2f9c8d,'shopId':_0x2c37cb['shopId'],'event':'status_update','statusCode':0xc8,'responseBody':JSON['stringify']({'oldStatus':_0x12ef00[_0x35271e(0x2a8)],'newStatus':_0x5a74a4[_0x35271e(0x219)](),'notes':_0x5b20be||null,'chargebackAmount':_0x2936f8||null,'timestamp':new Date()[_0x35271e(0x201)]()})}}),console[_0x35271e(0x2bb)]('✅\x20Payment\x20'+_0x12ef00[_0x35271e(0x212)]+'\x20status\x20updated\x20from\x20'+_0x12ef00[_0x35271e(0x2a8)]+_0x35271e(0x234)+_0x5a74a4[_0x35271e(0x219)]()),_0x5a74a4[_0x35271e(0x219)]()===_0x35271e(0x231)&&console[_0x35271e(0x2bb)](_0x35271e(0x264)+_0x2936f8+_0x35271e(0x2bd)),{'id':_0x2c37cb['id'],'shopId':_0x2c37cb['shopId'],'shopName':_0x2c37cb[_0x35271e(0x258)][_0x35271e(0x233)],'shopUsername':_0x2c37cb[_0x35271e(0x258)][_0x35271e(0x27b)],'gateway':_0x2c37cb[_0x35271e(0x209)],'orderId':_0x2c37cb['orderId'],'gatewayOrderId':_0x2c37cb[_0x35271e(0x27e)],'amount':_0x2c37cb[_0x35271e(0x22c)],'currency':_0x2c37cb['currency'],'sourceCurrency':_0x2c37cb[_0x35271e(0x28e)],'status':_0x2c37cb[_0x35271e(0x2a8)],'usage':_0x2c37cb[_0x35271e(0x279)],'externalPaymentUrl':_0x2c37cb[_0x35271e(0x2c1)],'gatewayPaymentId':_0x2c37cb[_0x35271e(0x274)],'customerEmail':_0x2c37cb[_0x35271e(0x265)],'customerName':_0x2c37cb[_0x35271e(0x232)],'cardLast4':_0x2c37cb[_0x35271e(0x24d)],'paymentMethod':_0x2c37cb[_0x35271e(0x276)],'bankId':_0x2c37cb[_0x35271e(0x272)],'remitterIban':_0x2c37cb[_0x35271e(0x222)],'remitterName':_0x2c37cb['remitterName'],'chargebackAmount':_0x2c37cb[_0x35271e(0x218)],'adminNotes':_0x2c37cb[_0x35271e(0x286)],'statusChangedBy':_0x2c37cb[_0x35271e(0x203)],'statusChangedAt':_0x2c37cb['statusChangedAt'],'createdAt':_0x2c37cb[_0x35271e(0x202)],'updatedAt':_0x2c37cb[_0x35271e(0x1f0)],'expiresAt':_0x2c37cb[_0x35271e(0x26f)]};}async[a33_0x31295c(0x290)](_0x3b6202){const _0x263c2a=a33_0x31295c,{page:_0x1f9fd9,limit:_0x56bf2d,status:_0x59c6f0}=_0x3b6202,_0xc0a37a=(_0x1f9fd9-0x1)*_0x56bf2d,_0x56f383={};_0x59c6f0&&(_0x56f383[_0x263c2a(0x2a8)]=_0x59c6f0['toUpperCase']());console[_0x263c2a(0x2bb)](_0x263c2a(0x23c),{'page':_0x1f9fd9,'limit':_0x56bf2d,'status':_0x59c6f0,'where':_0x56f383});const [_0xa8d7fb,_0x207698]=await Promise[_0x263c2a(0x237)]([database_1[_0x263c2a(0x29d)]['shop'][_0x263c2a(0x2bc)]({'where':_0x56f383,'skip':_0xc0a37a,'take':_0x56bf2d,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x263c2a(0x2b5)}}),database_1[_0x263c2a(0x29d)]['shop']['count']({'where':_0x56f383})]);console[_0x263c2a(0x2bb)](_0x263c2a(0x285)+_0xa8d7fb[_0x263c2a(0x2ab)]+'\x20users\x20out\x20of\x20'+_0x207698+_0x263c2a(0x2c3));const _0x5958e1=_0xa8d7fb['map'](_0x2e726a=>({'id':_0x2e726a['id'],'fullName':_0x2e726a[_0x263c2a(0x233)],'username':_0x2e726a[_0x263c2a(0x27b)],'telegramId':_0x2e726a[_0x263c2a(0x261)],'merchantUrl':_0x2e726a[_0x263c2a(0x1f5)],'gateways':_0x2e726a['paymentGateways']?JSON[_0x263c2a(0x1ef)](_0x2e726a[_0x263c2a(0x204)]):null,'gatewaySettings':_0x2e726a[_0x263c2a(0x217)]?JSON[_0x263c2a(0x1ef)](_0x2e726a[_0x263c2a(0x217)]):null,'publicKey':_0x2e726a['publicKey'],'wallets':{'usdtPolygonWallet':_0x2e726a[_0x263c2a(0x1f7)],'usdtTrcWallet':_0x2e726a[_0x263c2a(0x26b)],'usdtErcWallet':_0x2e726a[_0x263c2a(0x270)],'usdcPolygonWallet':_0x2e726a[_0x263c2a(0x229)]},'status':_0x2e726a[_0x263c2a(0x2a8)],'createdAt':_0x2e726a['createdAt']}));return{'users':_0x5958e1,'pagination':{'page':_0x1f9fd9,'limit':_0x56bf2d,'total':_0x207698,'totalPages':Math[_0x263c2a(0x1f4)](_0x207698/_0x56bf2d)}};}async[a33_0x31295c(0x2c4)](_0x503f87){const _0x448d70=a33_0x31295c;return await this[_0x448d70(0x24a)][_0x448d70(0x2c4)](_0x503f87);}async[a33_0x31295c(0x2a9)](_0x497781){const _0x594cb7=a33_0x31295c;return await this[_0x594cb7(0x24a)][_0x594cb7(0x2a9)](_0x497781);}async[a33_0x31295c(0x21a)](_0x4c7dc3,_0x3d8083){const _0x439b42=a33_0x31295c;return await this[_0x439b42(0x24a)][_0x439b42(0x21a)](_0x4c7dc3,_0x3d8083);}async[a33_0x31295c(0x280)](_0x314ebe){const _0x326ea9=a33_0x31295c;return await this[_0x326ea9(0x24a)][_0x326ea9(0x280)](_0x314ebe);}async[a33_0x31295c(0x236)](_0x12b1aa){const _0x44d0fa=a33_0x31295c;console[_0x44d0fa(0x2bb)](_0x44d0fa(0x228)+_0x12b1aa);const _0xffa9b5=await database_1[_0x44d0fa(0x29d)][_0x44d0fa(0x258)]['findUnique']({'where':{'id':_0x12b1aa},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0xffa9b5)throw new Error(_0x44d0fa(0x225));if(_0xffa9b5['status']==='SUSPENDED')throw new Error(_0x44d0fa(0x288));const _0x4fbe2c=await this[_0x44d0fa(0x24a)][_0x44d0fa(0x21a)](_0x12b1aa,{'status':_0x44d0fa(0x27d)});return console[_0x44d0fa(0x2bb)]('✅\x20User\x20'+_0xffa9b5[_0x44d0fa(0x27b)]+'\x20suspended\x20successfully'),_0x4fbe2c;}async[a33_0x31295c(0x2a7)](_0x57fc94){const _0x49974e=a33_0x31295c;console[_0x49974e(0x2bb)](_0x49974e(0x2a5)+_0x57fc94);const _0x29f0c4=await database_1['default'][_0x49974e(0x258)][_0x49974e(0x200)]({'where':{'id':_0x57fc94},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x29f0c4)throw new Error(_0x49974e(0x225));if(_0x29f0c4[_0x49974e(0x2a8)]===_0x49974e(0x21e))throw new Error(_0x49974e(0x249));const _0x192b11=await this[_0x49974e(0x24a)][_0x49974e(0x21a)](_0x57fc94,{'status':'ACTIVE'});return console[_0x49974e(0x2bb)](_0x49974e(0x2b3)+_0x29f0c4['username']+_0x49974e(0x2ba)),_0x192b11;}}exports[a33_0x31295c(0x24c)]=AdminService;function a33_0x40f0(){const _0x3b6613=['error','✅\x20Admin\x20statistics\x20generated\x20successfully','\x20days','\x20merchants\x20with\x20eligible\x20PAID\x20payments','📊\x20Found\x20','adminNotes','\x20days)','User\x20is\x20already\x20suspended','round','👥\x20Total\x20users:\x20','amountUSDT','markPaymentsAsPaidOut','notes','sourceCurrency',',\x20amount:\x20','getAllUsers','getPayoutStats','get','2276930zgVuOb','✅\x20Payout\x20statistics\x20calculated:','getAllPayments','totalPayout','📊\x20Generating\x20admin\x20statistics\x20for\x20period:\x20','PROCESSING','EXPIRED','1paKHLP','✅\x20Marked\x20','getSystemStatistics','default','Shop\x20is\x20not\x20active','Shop\x20not\x20found','calculateAmountAfterCommission','completed','date','FAILED','defineProperty','✅\x20Activating\x20user:\x20','getFullYear','activateUser','status','createUser','🔄\x20Marking\x20payments\x20as\x20paid\x20out\x20for\x20shop\x20','length','461349TBHbaH','currencyService','isEligibleForPayout','updatePaymentStatus','❌\x20Payment\x20not\x20found:\x20','entries','sendPayoutNotification','✅\x20User\x20','updateMany','desc','getPayoutById','totalAmountAfterCommissionUSDT','3xbreSW','calculateEffectiveAmount','\x20activated\x20successfully','log','findMany','\x20USDT\x20(will\x20be\x20deducted\x20from\x20merchant\x20balance)','90d','REFUND','lte','externalPaymentUrl','\x20USDT\x20(только\x20PAID\x20платежи)','\x20total','getUserById','getPaymentById','Invalid\x20status.\x20Valid\x20statuses:\x20','toLowerCase','📈\x20Average\x20payment:\x20','getMerchantsAwaitingPayout','push','parse','updatedAt','\x20USDT\x20after\x20commission)','includes','abs','ceil','shopUrl','amountAfterCommissionUSDT','usdtPolygonWallet','\x20USDT\x20(включая\x20штрафы\x20chargeback)','🔍\x20Getting\x20payout\x20by\x20ID:\x20','\x20deleted\x20successfully','61905085CjNsoB','asc','\x20payments\x20for\x20revenue\x20calculation\x20(PAID/REFUND/CHARGEBACK)','❌\x20Payout\x20not\x20found:\x20','availableBalance','findUnique','toISOString','createdAt','statusChangedBy','paymentGateways','getDate','UserService','payout','split','gateway','update','📊\x20Daily\x20revenue\x20entries:\x20','🔍\x20Getting\x20payment\x20by\x20ID:\x20','commission','✅\x20Found\x20payment:\x20','🗑️\x20Deleting\x20payout:\x20','getMonth','14NloagG','orderId','✅\x20Payout\x20created\x20successfully:\x20','slice','📋\x20Getting\x20payments\x20with\x20filters:','paidAt','gatewaySettings','chargebackAmount','toUpperCase','updateUser','\x20USDT\x20via\x20','deletePayout','\x20USDT\x20(penalty\x20amount)','ACTIVE','✅\x20Payout\x20','size','PENDING','remitterIban','payment','2176290juKiRY','User\x20not\x20found','join','360HtVNgU','🚫\x20Suspending\x20user:\x20','usdcPolygonWallet','✅\x20Found\x20payout:\x20','\x20payouts\x20out\x20of\x20','amount','./currencyService','COMPLETED','reduce','insensitive','CHARGEBACK','customerName','name','\x20to\x20','💰\x20Found\x20','suspendUser','all','remitterName','getAllPayouts','merchantPaid','📅\x20Processing\x20daily\x20stats\x20for\x20','📋\x20Getting\x20users\x20with\x20filters:','setDate','⏳\x20Awaiting\x20Payout:\x20','thisMonth','currency','getGatewaySettings','../types/gateway','set','💰\x20Available\x20Balance:\x20','isValidGatewayId','PAID','\x20payments\x20as\x20paid\x20out','map','User\x20is\x20already\x20active','userService','\x20payments\x20for\x20analysis\x20(PAID/REFUND/CHARGEBACK)','AdminService','cardLast4','webhookLog','network','webhookLogs','delete','Chargeback\x20amount\x20is\x20required\x20and\x20must\x20be\x20positive\x20(amount\x20in\x20USDT)','toFixed','Failed\x20to\x20send\x20Telegram\x20payout\x20notification:','shopId','createPayout','generateDateRange','shop','__esModule','💰\x20Total\x20amount:\x20','has','2064016EzbPax','\x20eligible\x20PAID\x20payments\x20for\x20payout\x20analysis','gte','from','Payout\x20not\x20found','telegram','\x20merchants\x20out\x20of\x20','💳\x20Total\x20payments:\x20','💸\x20Chargeback\x20penalty:\x20','customerEmail','Error\x20parsing\x20gateway\x20settings:','payments','3062586RHLYcU','awaitingPayout','charAt','usdtTrcWallet','payoutDelay','💵\x20Total\x20revenue:\x20','convertToUSDT','expiresAt','usdtErcWallet','4327072LCWktm','bankId','./userService','gatewayPaymentId','txid','paymentMethod','\x20USDT','📅\x20This\x20Month:\x20','usage','count','username','getPeriodDays','SUSPENDED','gatewayOrderId','💸\x20Chargeback\x20amount:\x20','deleteUser'];a33_0x40f0=function(){return _0x3b6613;};return a33_0x40f0();}