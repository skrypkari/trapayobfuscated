'use strict';const a48_0x332814=a48_0x265e;(function(_0x2403a1,_0x2cb7ca){const _0x3dedff=a48_0x265e,_0x3bcd42=_0x2403a1();while(!![]){try{const _0xd9e671=parseInt(_0x3dedff(0x11d))/0x1*(-parseInt(_0x3dedff(0x178))/0x2)+parseInt(_0x3dedff(0x15c))/0x3+-parseInt(_0x3dedff(0x1d0))/0x4*(-parseInt(_0x3dedff(0xe1))/0x5)+-parseInt(_0x3dedff(0x165))/0x6*(parseInt(_0x3dedff(0x215))/0x7)+-parseInt(_0x3dedff(0xa7))/0x8*(-parseInt(_0x3dedff(0xca))/0x9)+-parseInt(_0x3dedff(0x1dc))/0xa*(parseInt(_0x3dedff(0xde))/0xb)+parseInt(_0x3dedff(0x1e5))/0xc;if(_0xd9e671===_0x2cb7ca)break;else _0x3bcd42['push'](_0x3bcd42['shift']());}catch(_0x36c58a){_0x3bcd42['push'](_0x3bcd42['shift']());}}}(a48_0x38f5,0x8bb4c));function a48_0x265e(_0x2b1137,_0x5aba0b){_0x2b1137=_0x2b1137-0x7e;const _0x38f56e=a48_0x38f5();let _0x265eb0=_0x38f56e[_0x2b1137];return _0x265eb0;}var __importDefault=this&&this['__importDefault']||function(_0x18aac6){const _0x22facc=a48_0x265e;return _0x18aac6&&_0x18aac6[_0x22facc(0x197)]?_0x18aac6:{'default':_0x18aac6};};Object[a48_0x332814(0x210)](exports,'__esModule',{'value':!![]}),exports[a48_0x332814(0x1df)]=void 0x0;const database_1=__importDefault(require(a48_0x332814(0x233))),bcryptjs_1=__importDefault(require(a48_0x332814(0x180))),crypto_1=__importDefault(require(a48_0x332814(0xd4))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a48_0x332814(0x1c0))),speakeasy_1=__importDefault(require(a48_0x332814(0x13f))),qrcode_1=__importDefault(require(a48_0x332814(0x22e))),config_1=require(a48_0x332814(0x19f)),currencyService_1=require(a48_0x332814(0x20f)),telegramBotService_1=require(a48_0x332814(0x1d5)),gateway_1=require(a48_0x332814(0x117));class AdminService{async[a48_0x332814(0x226)](){const _0x48a360=a48_0x332814;console[_0x48a360(0xd3)]('üìä\x20Calculating\x20payout\x20statistics...');const _0x12176f=await database_1['default'][_0x48a360(0x1de)]['aggregate']({'_sum':{'balance':!![],'totalPaidOut':!![]}}),_0x470d8d=await database_1['default'][_0x48a360(0x1f1)][_0x48a360(0xa6)]({'where':{'status':_0x48a360(0x1aa),'gateway':{'not':_0x48a360(0x81)}}}),_0x48cab7=new Date(),_0x395fe1=new Date(_0x48cab7[_0x48a360(0x14a)](),_0x48cab7['getMonth'](),0x1),_0x52abf8=new Date(_0x48cab7[_0x48a360(0x14a)](),_0x48cab7[_0x48a360(0x22c)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x19e9f1=await database_1['default'][_0x48a360(0x1da)][_0x48a360(0x22d)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x395fe1,'lte':_0x52abf8},'status':_0x48a360(0x10e)}}),_0x6f7aae=_0x12176f[_0x48a360(0x1f3)][_0x48a360(0x122)]||0x0,_0x1b8d10=_0x12176f[_0x48a360(0x1f3)][_0x48a360(0x1e9)]||0x0,_0x233967=_0x19e9f1[_0x48a360(0x1f3)]['amount']||0x0,_0x5d8126={'totalPayout':Math['round'](_0x6f7aae*0x64)/0x64,'awaitingPayout':Math[_0x48a360(0x13b)](_0x1b8d10*0x64)/0x64,'thisMonth':Math[_0x48a360(0x13b)](_0x233967*0x64)/0x64,'availableBalance':Math[_0x48a360(0x13b)](_0x1b8d10*0x64)/0x64,'totalPayments':_0x470d8d};return console[_0x48a360(0xd3)](_0x48a360(0x107)),console[_0x48a360(0xd3)]('\x20\x20\x20üí∞\x20Total\x20payout:\x20'+_0x5d8126['totalPayout']+_0x48a360(0x1e1)),console[_0x48a360(0xd3)](_0x48a360(0x1c8)+_0x5d8126[_0x48a360(0xc0)]+_0x48a360(0x11e)),console[_0x48a360(0xd3)]('\x20\x20\x20üíµ\x20Available\x20balance:\x20'+_0x5d8126[_0x48a360(0x1bf)]+_0x48a360(0x1a8)),console['log'](_0x48a360(0x200)+_0x5d8126[_0x48a360(0x10d)]+_0x48a360(0x1e0)),console['log']('\x20\x20\x20üí≥\x20Total\x20payments:\x20'+_0x5d8126[_0x48a360(0xd8)]+'\x20PAID\x20payments'),_0x5d8126;}async[a48_0x332814(0x1c2)](_0x127c92,_0x5764ed){const _0x441a77=a48_0x332814;console[_0x441a77(0xd3)](_0x441a77(0xf9)+_0x127c92+':',_0x5764ed);const _0x2ef69a=await database_1[_0x441a77(0x1fe)]['payment'][_0x441a77(0x89)]({'where':{'id':_0x127c92},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x2ef69a)throw new Error('Payment\x20not\x20found');const _0x1f3123={};_0x5764ed[_0x441a77(0x211)]!==undefined&&(_0x1f3123[_0x441a77(0x211)]=_0x5764ed[_0x441a77(0x211)]||null);_0x5764ed[_0x441a77(0x173)]!==undefined&&(_0x1f3123[_0x441a77(0x173)]=_0x5764ed['customerIp']||null);_0x5764ed[_0x441a77(0xa0)]!==undefined&&(_0x1f3123[_0x441a77(0xa0)]=_0x5764ed[_0x441a77(0xa0)]||null);const _0x48e21e=await database_1[_0x441a77(0x1fe)][_0x441a77(0x1f1)][_0x441a77(0x221)]({'where':{'id':_0x127c92},'data':{..._0x1f3123,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x441a77(0xd3)]('‚úÖ\x20Customer\x20data\x20updated\x20for\x20payment\x20'+_0x127c92),console[_0x441a77(0xd3)]('\x20\x20\x20üåç\x20Country:\x20'+_0x2ef69a['customerCountry']+'\x20->\x20'+_0x48e21e['customerCountry']),console[_0x441a77(0xd3)]('\x20\x20\x20üåê\x20IP:\x20'+_0x2ef69a[_0x441a77(0x173)]+_0x441a77(0x163)+_0x48e21e[_0x441a77(0x173)]),console[_0x441a77(0xd3)]('\x20\x20\x20üñ•Ô∏è\x20User\x20Agent:\x20'+(_0x2ef69a[_0x441a77(0xa0)]?_0x441a77(0x12e):'not\x20set')+'\x20->\x20'+(_0x48e21e[_0x441a77(0xa0)]?_0x441a77(0x12e):'not\x20set')),_0x48e21e;}async[a48_0x332814(0xf0)](_0x185d0f,_0x3bbed2){const _0x1f137f=a48_0x332814,_0x14943c=_0x3bbed2?new Date(_0x3bbed2):new Date();let _0x4ffeed,_0x3ab675;if(_0x185d0f[_0x1f137f(0x1e3)](_0x1f137f(0x114))){const _0x45ed13=_0x185d0f['replace'](_0x1f137f(0x114),'')[_0x1f137f(0x166)]('_');if(_0x45ed13[_0x1f137f(0x161)]===0x2){const _0x877cc5=new Date(_0x45ed13[0x0]),_0x5fa314=new Date(_0x45ed13[0x1]);_0x4ffeed=new Date(Date[_0x1f137f(0x16e)](_0x877cc5[_0x1f137f(0x1cd)](),_0x877cc5[_0x1f137f(0x16a)](),_0x877cc5[_0x1f137f(0x220)](),0x0,0x0,0x0,0x0)),_0x3ab675=new Date(Date[_0x1f137f(0x16e)](_0x5fa314['getUTCFullYear'](),_0x5fa314['getUTCMonth'](),_0x5fa314[_0x1f137f(0x220)](),0x17,0x3b,0x3b,0x3e7));}else{const _0x47a9e0=new Date(Date[_0x1f137f(0x16e)](_0x14943c[_0x1f137f(0x1cd)](),_0x14943c['getUTCMonth'](),_0x14943c[_0x1f137f(0x220)]()-0x1e));_0x4ffeed=new Date(Date[_0x1f137f(0x16e)](_0x47a9e0[_0x1f137f(0x1cd)](),_0x47a9e0['getUTCMonth'](),_0x47a9e0[_0x1f137f(0x220)](),0x0,0x0,0x0,0x0)),_0x3ab675=new Date(Date[_0x1f137f(0x16e)](_0x14943c[_0x1f137f(0x1cd)](),_0x14943c[_0x1f137f(0x16a)](),_0x14943c['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}}else{switch(_0x185d0f[_0x1f137f(0xc8)]()){case'today':_0x4ffeed=new Date(Date['UTC'](_0x14943c[_0x1f137f(0x1cd)](),_0x14943c['getUTCMonth'](),_0x14943c[_0x1f137f(0x220)](),0x0,0x0,0x0,0x0)),_0x3ab675=new Date(Date[_0x1f137f(0x16e)](_0x14943c[_0x1f137f(0x1cd)](),_0x14943c['getUTCMonth'](),_0x14943c[_0x1f137f(0x220)](),0x17,0x3b,0x3b,0x3e7));break;case _0x1f137f(0xaa):const _0xd8737a=new Date(_0x14943c);_0xd8737a[_0x1f137f(0x207)](_0xd8737a[_0x1f137f(0x220)]()-0x1),_0x4ffeed=new Date(Date[_0x1f137f(0x16e)](_0xd8737a[_0x1f137f(0x1cd)](),_0xd8737a[_0x1f137f(0x16a)](),_0xd8737a[_0x1f137f(0x220)](),0x0,0x0,0x0,0x0)),_0x3ab675=new Date(Date['UTC'](_0xd8737a[_0x1f137f(0x1cd)](),_0xd8737a[_0x1f137f(0x16a)](),_0xd8737a[_0x1f137f(0x220)](),0x17,0x3b,0x3b,0x3e7));break;case _0x1f137f(0xd0):const _0x54882d=_0x14943c['getUTCDay'](),_0x4d1370=_0x54882d===0x0?-0x6:0x1-_0x54882d,_0x2dc78a=_0x14943c[_0x1f137f(0x220)]()+_0x4d1370;_0x4ffeed=new Date(Date[_0x1f137f(0x16e)](_0x14943c[_0x1f137f(0x1cd)](),_0x14943c[_0x1f137f(0x16a)](),_0x2dc78a,0x0,0x0,0x0,0x0)),_0x3ab675=new Date(Date[_0x1f137f(0x16e)](_0x14943c[_0x1f137f(0x1cd)](),_0x14943c['getUTCMonth'](),_0x14943c[_0x1f137f(0x220)](),0x17,0x3b,0x3b,0x3e7));break;case _0x1f137f(0x16b):const _0x147f7f=new Date(Date['UTC'](_0x14943c[_0x1f137f(0x1cd)](),_0x14943c[_0x1f137f(0x16a)](),_0x14943c[_0x1f137f(0x220)]()-0x7)),_0x1b746c=_0x147f7f['getUTCDay'](),_0x1b9427=_0x1b746c===0x0?-0x6:0x1-_0x1b746c,_0x267620=_0x147f7f[_0x1f137f(0x220)]()+_0x1b9427;_0x4ffeed=new Date(Date[_0x1f137f(0x16e)](_0x147f7f[_0x1f137f(0x1cd)](),_0x147f7f[_0x1f137f(0x16a)](),_0x267620,0x0,0x0,0x0,0x0)),_0x3ab675=new Date(Date[_0x1f137f(0x16e)](_0x147f7f[_0x1f137f(0x1cd)](),_0x147f7f[_0x1f137f(0x16a)](),_0x267620+0x6,0x17,0x3b,0x3b,0x3e7));break;case _0x1f137f(0x190):_0x4ffeed=new Date(Date[_0x1f137f(0x16e)](_0x14943c[_0x1f137f(0x1cd)](),_0x14943c['getUTCMonth'](),0x1,0x0,0x0,0x0,0x0)),_0x3ab675=new Date(Date['UTC'](_0x14943c[_0x1f137f(0x1cd)](),_0x14943c[_0x1f137f(0x16a)](),_0x14943c[_0x1f137f(0x220)](),0x17,0x3b,0x3b,0x3e7));break;case _0x1f137f(0x11f):_0x4ffeed=new Date(Date[_0x1f137f(0x16e)](_0x14943c[_0x1f137f(0x1cd)](),_0x14943c[_0x1f137f(0x16a)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x3ab675=new Date(Date[_0x1f137f(0x16e)](_0x14943c[_0x1f137f(0x1cd)](),_0x14943c[_0x1f137f(0x16a)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x1f137f(0x19e):_0x4ffeed=new Date(Date[_0x1f137f(0x16e)](0x7e9,0x5,0xe,0x0,0x0,0x0,0x0)),_0x3ab675=new Date(Date[_0x1f137f(0x16e)](_0x14943c[_0x1f137f(0x1cd)](),_0x14943c[_0x1f137f(0x16a)](),_0x14943c[_0x1f137f(0x220)](),0x17,0x3b,0x3b,0x3e7));break;default:_0x4ffeed=new Date(_0x14943c['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);const _0xcb5e75=new Date(Date[_0x1f137f(0x16e)](_0x14943c[_0x1f137f(0x1cd)](),_0x14943c[_0x1f137f(0x16a)](),_0x14943c[_0x1f137f(0x220)]()-0x1e));_0x4ffeed=new Date(Date[_0x1f137f(0x16e)](_0xcb5e75['getUTCFullYear'](),_0xcb5e75[_0x1f137f(0x16a)](),_0xcb5e75['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x3ab675=new Date(Date[_0x1f137f(0x16e)](_0x14943c['getUTCFullYear'](),_0x14943c[_0x1f137f(0x16a)](),_0x14943c[_0x1f137f(0x220)](),0x17,0x3b,0x3b,0x3e7));}const _0x5e7afd={'gte':_0x4ffeed,'lte':_0x3ab675};console[_0x1f137f(0xd3)]('üìä\x20Statistics\x20date\x20range:\x20'+_0x4ffeed[_0x1f137f(0x1e8)]()+'\x20to\x20'+_0x3ab675[_0x1f137f(0x1e8)]());const [_0x224e93,_0x440330,_0x1578f7,_0x214214,_0x5d3cf4,_0x3f28e2,_0x5afe80,_0x5a97ef,_0x43abc5]=await Promise['all']([database_1['default'][_0x1f137f(0x1de)][_0x1f137f(0xa6)](),database_1[_0x1f137f(0x1fe)][_0x1f137f(0x1de)][_0x1f137f(0xa6)]({'where':{'status':_0x1f137f(0x8f)}}),database_1['default'][_0x1f137f(0x1f1)][_0x1f137f(0xa6)]({'where':{'status':'PAID','createdAt':_0x5e7afd,'gateway':{'not':'test_gateway'}}}),database_1['default'][_0x1f137f(0x1f1)][_0x1f137f(0xa6)]({'where':{'status':_0x1f137f(0x228),'createdAt':_0x5e7afd,'gateway':{'not':_0x1f137f(0x81)}}}),database_1[_0x1f137f(0x1fe)][_0x1f137f(0x1f1)][_0x1f137f(0xa6)]({'where':{'status':_0x1f137f(0x223),'createdAt':_0x5e7afd,'gateway':{'not':_0x1f137f(0x81)}}}),database_1[_0x1f137f(0x1fe)][_0x1f137f(0x1f1)]['findMany']({'where':{'status':_0x1f137f(0x1aa),'createdAt':_0x5e7afd,'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x1f137f(0x1fe)][_0x1f137f(0x1f1)][_0x1f137f(0x19a)]({'where':{'gateway':{'not':'test_gateway'}},'take':0xa,'orderBy':{'createdAt':_0x1f137f(0x154)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x1f137f(0x1f1)][_0x1f137f(0x19a)]({'where':{'createdAt':_0x5e7afd,'gateway':{'not':_0x1f137f(0x81)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1['default'][_0x1f137f(0x1f1)][_0x1f137f(0x19a)]({'where':{'status':_0x1f137f(0x1aa),'gateway':{'not':_0x1f137f(0x81)}},'select':{'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![]}})]);console[_0x1f137f(0xd3)](_0x1f137f(0x1fa)+_0x1578f7);let _0x32e459=0x0,_0x4b1946=0x0;for(const _0x4dd1c8 of _0x3f28e2){const _0x3fe0ec=_0x4dd1c8[_0x1f137f(0xbc)]||0x0;_0x32e459+=_0x3fe0ec;if(_0x4dd1c8['amountAfterGatewayCommissionUSDT']&&_0x4dd1c8['amountUSDT']){const _0x288fd1=_0x4dd1c8[_0x1f137f(0xbc)]-_0x4dd1c8[_0x1f137f(0x1cb)];_0x4b1946+=_0x288fd1;}}let _0x8e725f=0x0;for(const _0x748c7a of _0x43abc5){if(_0x748c7a['amountAfterGatewayCommissionUSDT']&&_0x748c7a[_0x1f137f(0xbc)]){const _0x34a7d2=_0x748c7a['amountUSDT']-_0x748c7a[_0x1f137f(0x1cb)];_0x8e725f+=_0x34a7d2;}}const _0x51018d=_0x1578f7>0x0?_0x32e459/_0x1578f7:0x0,_0x5386e0=this[_0x1f137f(0x159)](_0x5a97ef,_0x4ffeed,_0x3ab675),_0x37790e=await database_1[_0x1f137f(0x1fe)][_0x1f137f(0x1f1)]['count']({'where':{'createdAt':_0x5e7afd,'gateway':{'not':_0x1f137f(0x81)},'status':{'notIn':[_0x1f137f(0x136),'EXPIRED']}}}),_0x33826d=_0x37790e>0x0?_0x1578f7/_0x37790e*0x64:0x0;return{'totalShops':_0x224e93,'activeShops':_0x440330,'totalPayments':_0x37790e,'successfulPayments':_0x1578f7,'totalAttempts':_0x37790e,'chargebacks':_0x214214,'refunds':_0x5d3cf4,'totalRevenue':Math[_0x1f137f(0x13b)](_0x32e459*0x64)/0x64,'trapayEarnings':Math[_0x1f137f(0x13b)](_0x4b1946*0x64)/0x64,'trapayEarningsAllTime':Math[_0x1f137f(0x13b)](_0x8e725f*0x64)/0x64,'averagePaymentAmount':Math['round'](_0x51018d*0x64)/0x64,'conversionRate':Math[_0x1f137f(0x13b)](_0x33826d*0x64)/0x64,'dailyRevenue':_0x5386e0[_0x1f137f(0x17d)],'dailyPayments':_0x5386e0['dailyPayments'],'recentPayments':_0x5afe80[_0x1f137f(0x1f5)](_0x33fc45=>({'id':_0x33fc45['id'],'amount':_0x33fc45[_0x1f137f(0xb8)],'currency':_0x33fc45[_0x1f137f(0xfc)],'status':_0x33fc45[_0x1f137f(0xfa)],'gateway':_0x33fc45['gateway'],'shop':_0x33fc45[_0x1f137f(0x1de)],'createdAt':_0x33fc45[_0x1f137f(0xf7)]}))};}}async['getMerchantStatistics'](_0x238e3c){const _0x5e3c9e=a48_0x332814;console['log']('üìä\x20Getting\x20merchant\x20statistics\x20with\x20filters:',_0x238e3c);let _0x56e108,_0x48c0f9=new Date();if(_0x238e3c[_0x5e3c9e(0xbe)]==='custom'&&_0x238e3c[_0x5e3c9e(0x1a3)]&&_0x238e3c['dateTo']){const _0x552011=new Date(_0x238e3c[_0x5e3c9e(0x1a3)]),_0x5dcd32=new Date(_0x238e3c[_0x5e3c9e(0x1a4)]);_0x56e108=new Date(Date[_0x5e3c9e(0x16e)](_0x552011[_0x5e3c9e(0x1cd)](),_0x552011[_0x5e3c9e(0x16a)](),_0x552011['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x48c0f9=new Date(Date[_0x5e3c9e(0x16e)](_0x5dcd32[_0x5e3c9e(0x1cd)](),_0x5dcd32[_0x5e3c9e(0x16a)](),_0x5dcd32[_0x5e3c9e(0x220)](),0x17,0x3b,0x3b,0x3e7));}else{const _0x218117=new Date();switch(_0x238e3c[_0x5e3c9e(0xbe)]){case'week':_0x56e108=new Date(_0x218117[_0x5e3c9e(0x103)]()-0x7*0x18*0x3c*0x3c*0x3e8),_0x56e108['setHours'](0x0,0x0,0x0,0x0),_0x48c0f9[_0x5e3c9e(0x175)](0x17,0x3b,0x3b,0x3e7);break;case'month':_0x56e108=new Date(Date['UTC'](_0x218117[_0x5e3c9e(0x1cd)](),_0x218117['getUTCMonth'](),0x1,0x0,0x0,0x0,0x0)),_0x48c0f9=new Date(Date[_0x5e3c9e(0x16e)](_0x218117[_0x5e3c9e(0x1cd)](),_0x218117['getUTCMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7));break;case'lastMonth':_0x56e108=new Date(Date['UTC'](_0x218117['getUTCFullYear'](),_0x218117[_0x5e3c9e(0x16a)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x48c0f9=new Date(Date['UTC'](_0x218117[_0x5e3c9e(0x1cd)](),_0x218117[_0x5e3c9e(0x16a)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x5e3c9e(0x115):_0x56e108=new Date(_0x218117[_0x5e3c9e(0x103)]()-0x16d*0x18*0x3c*0x3c*0x3e8),_0x56e108[_0x5e3c9e(0x175)](0x0,0x0,0x0,0x0),_0x48c0f9[_0x5e3c9e(0x175)](0x17,0x3b,0x3b,0x3e7);break;case _0x5e3c9e(0xe9):default:_0x56e108=new Date(_0x5e3c9e(0x158)),_0x56e108['setHours'](0x0,0x0,0x0,0x0),_0x48c0f9[_0x5e3c9e(0x175)](0x17,0x3b,0x3b,0x3e7);break;}}console[_0x5e3c9e(0xd3)](_0x5e3c9e(0x203)+_0x56e108[_0x5e3c9e(0x1e8)]()+_0x5e3c9e(0x21a)+_0x48c0f9['toISOString']());const _0x297a93={'status':_0x5e3c9e(0x1aa),'gateway':{'not':_0x5e3c9e(0x81)},'createdAt':{'gte':_0x56e108,'lte':_0x48c0f9}};_0x238e3c['shopId']&&(_0x297a93[_0x5e3c9e(0xf5)]=_0x238e3c['shopId']);const _0x245c67=await database_1[_0x5e3c9e(0x1fe)][_0x5e3c9e(0x1f1)]['findMany']({'where':_0x297a93,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x5e3c9e(0xd3)](_0x5e3c9e(0x169)+_0x245c67[_0x5e3c9e(0x161)]+_0x5e3c9e(0x225));const _0x3b333d={'gateway':{'not':_0x5e3c9e(0x81)},'status':{'notIn':[_0x5e3c9e(0x136),_0x5e3c9e(0x201)]},'createdAt':{'gte':_0x56e108,'lte':_0x48c0f9}};_0x238e3c[_0x5e3c9e(0xf5)]&&(_0x3b333d[_0x5e3c9e(0xf5)]=_0x238e3c[_0x5e3c9e(0xf5)]);const _0x2b6316=await database_1['default']['payment'][_0x5e3c9e(0xa6)]({'where':_0x3b333d}),_0x4e5682={..._0x3b333d,'status':_0x5e3c9e(0x228)},_0x25dadc={..._0x3b333d,'status':_0x5e3c9e(0x223)},[_0x4c651c,_0xaee188]=await Promise['all']([database_1[_0x5e3c9e(0x1fe)][_0x5e3c9e(0x1f1)][_0x5e3c9e(0xa6)]({'where':_0x4e5682}),database_1[_0x5e3c9e(0x1fe)][_0x5e3c9e(0x1f1)][_0x5e3c9e(0xa6)]({'where':_0x25dadc})]);console[_0x5e3c9e(0xd3)](_0x5e3c9e(0xdf)+_0x2b6316+_0x5e3c9e(0xff)+_0x245c67[_0x5e3c9e(0x161)]+',\x20chargebacks:\x20'+_0x4c651c+',\x20refunds:\x20'+_0xaee188);let _0x5c868f=0x0,_0x35c208=0x0,_0x2510e3=0x0;const _0x14e7b4={},_0x934ed7={},_0x28b09f={},_0x4b099a=new Date(_0x56e108);while(_0x4b099a<=_0x48c0f9){const _0x2c50e9=_0x4b099a[_0x5e3c9e(0x1e8)]()[_0x5e3c9e(0x166)]('T')[0x0];_0x28b09f[_0x2c50e9]={'date':_0x2c50e9,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0},_0x4b099a[_0x5e3c9e(0x207)](_0x4b099a[_0x5e3c9e(0x220)]()+0x1);}for(const _0x43e5fa of _0x245c67){try{const _0x497d1a=_0x43e5fa[_0x5e3c9e(0xbc)]||0x0;if(_0x497d1a<=0x0){console[_0x5e3c9e(0x139)]('‚ö†Ô∏è\x20Payment\x20'+_0x43e5fa['id']+_0x5e3c9e(0x20e));continue;}let _0x1b57e6,_0x5abeff;if(_0x43e5fa['amountAfterGatewayCommissionUSDT']!==null&&_0x43e5fa[_0x5e3c9e(0x1cb)]!==undefined)_0x1b57e6=_0x43e5fa[_0x5e3c9e(0x1cb)],_0x5abeff=_0x497d1a-_0x1b57e6,console['log'](_0x5e3c9e(0x213)+_0x43e5fa['id']+':\x20'+_0x497d1a['toFixed'](0x6)+_0x5e3c9e(0x179)+_0x1b57e6[_0x5e3c9e(0x1ed)](0x6)+'\x20USDT');else{let _0xf52b3c={};if(_0x43e5fa[_0x5e3c9e(0x1de)][_0x5e3c9e(0xd7)])try{_0xf52b3c=JSON[_0x5e3c9e(0x18b)](_0x43e5fa[_0x5e3c9e(0x1de)][_0x5e3c9e(0xd7)]);}catch(_0x41f9d3){console[_0x5e3c9e(0x14c)](_0x5e3c9e(0x9f)+_0x43e5fa[_0x5e3c9e(0xf5)]+':',_0x41f9d3);}let _0x19fd68=0x2d;for(const [_0x3d5a51,_0x3de274]of Object[_0x5e3c9e(0x230)](_0xf52b3c)){if(_0x3d5a51[_0x5e3c9e(0xc8)]()===_0x43e5fa[_0x5e3c9e(0x241)][_0x5e3c9e(0xc8)]()){_0x19fd68=_0x3de274[_0x5e3c9e(0x214)]||0x2d;break;}}_0x5abeff=_0x497d1a*(_0x19fd68/0x64),_0x1b57e6=_0x497d1a-_0x5abeff,console[_0x5e3c9e(0xd3)]('üìä\x20Calculating\x20commission\x20manually\x20for\x20payment\x20'+_0x43e5fa['id']+':\x20'+_0x19fd68+_0x5e3c9e(0x1ea)+_0x497d1a[_0x5e3c9e(0x1ed)](0x6)+_0x5e3c9e(0x1e0));}_0x5c868f+=_0x497d1a,_0x35c208+=_0x1b57e6,_0x2510e3+=_0x5abeff;let _0x52c6c8;_0x43e5fa[_0x5e3c9e(0xc4)]!==null&&_0x43e5fa[_0x5e3c9e(0xc4)]!==undefined?(_0x52c6c8=_0x43e5fa['gatewayCommissionRate'],console[_0x5e3c9e(0xd3)](_0x5e3c9e(0x129)+_0x43e5fa['id']+':\x20'+_0x52c6c8+'%')):(_0x52c6c8=_0x497d1a>0x0?_0x5abeff/_0x497d1a*0x64:0x0,console[_0x5e3c9e(0xd3)](_0x5e3c9e(0xcd)+_0x43e5fa['id']+':\x20'+_0x52c6c8[_0x5e3c9e(0x1ed)](0x2)+'%'));!_0x14e7b4[_0x43e5fa[_0x5e3c9e(0x241)]]&&(_0x14e7b4[_0x43e5fa[_0x5e3c9e(0x241)]]={'gateway':_0x43e5fa[_0x5e3c9e(0x241)],'gatewayDisplayName':this['getGatewayDisplayName'](_0x43e5fa['gateway']),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x14e7b4[_0x43e5fa['gateway']]['paymentsCount']++,_0x14e7b4[_0x43e5fa[_0x5e3c9e(0x241)]][_0x5e3c9e(0x21e)]+=_0x497d1a,_0x14e7b4[_0x43e5fa['gateway']]['commissionUSDT']+=_0x5abeff,_0x14e7b4[_0x43e5fa[_0x5e3c9e(0x241)]][_0x5e3c9e(0x1e7)]+=_0x1b57e6,_0x14e7b4[_0x43e5fa['gateway']][_0x5e3c9e(0x1c4)]+=_0x52c6c8;!_0x238e3c[_0x5e3c9e(0xf5)]&&(!_0x934ed7[_0x43e5fa['shopId']]&&(_0x934ed7[_0x43e5fa[_0x5e3c9e(0xf5)]]={'shopId':_0x43e5fa[_0x5e3c9e(0xf5)],'shopName':_0x43e5fa[_0x5e3c9e(0x1de)][_0x5e3c9e(0x21d)],'shopUsername':_0x43e5fa[_0x5e3c9e(0x1de)]['username'],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x934ed7[_0x43e5fa[_0x5e3c9e(0xf5)]]['paymentsCount']++,_0x934ed7[_0x43e5fa[_0x5e3c9e(0xf5)]]['turnoverUSDT']+=_0x497d1a,_0x934ed7[_0x43e5fa[_0x5e3c9e(0xf5)]][_0x5e3c9e(0xb0)]+=_0x5abeff,_0x934ed7[_0x43e5fa[_0x5e3c9e(0xf5)]][_0x5e3c9e(0x1e7)]+=_0x1b57e6);const _0xa18227=_0x43e5fa[_0x5e3c9e(0x1be)][_0x5e3c9e(0x1e8)]()[_0x5e3c9e(0x166)]('T')[0x0];_0x28b09f[_0xa18227]&&(_0x28b09f[_0xa18227]['turnover']+=_0x497d1a,_0x28b09f[_0xa18227][_0x5e3c9e(0x219)]+=_0x1b57e6,_0x28b09f[_0xa18227][_0x5e3c9e(0x1b9)]+=_0x5abeff,_0x28b09f[_0xa18227][_0x5e3c9e(0x1d7)]++);}catch(_0x5d0dc2){console['error'](_0x5e3c9e(0x1cf)+_0x43e5fa['id']+':',_0x5d0dc2);}}Object[_0x5e3c9e(0xee)](_0x14e7b4)[_0x5e3c9e(0x22a)](_0x1fd310=>{const _0x518e00=_0x5e3c9e;_0x1fd310[_0x518e00(0x10a)]=_0x1fd310[_0x518e00(0x1d7)]>0x0?_0x1fd310[_0x518e00(0x1c4)]/_0x1fd310[_0x518e00(0x1d7)]:0x0,delete _0x1fd310[_0x518e00(0x1c4)];}),Object[_0x5e3c9e(0xee)](_0x934ed7)['forEach'](_0x255fb4=>{const _0x2d091d=_0x5e3c9e;_0x255fb4[_0x2d091d(0x1ff)]=_0x255fb4['paymentsCount']>0x0?_0x255fb4[_0x2d091d(0x21e)]/_0x255fb4[_0x2d091d(0x1d7)]:0x0;});let _0x5c0498=0x0,_0x3c7863=0x0;if(_0x238e3c['shopId']){const _0x5282cd=await database_1[_0x5e3c9e(0x1fe)][_0x5e3c9e(0x1da)][_0x5e3c9e(0x19a)]({'where':{'shopId':_0x238e3c[_0x5e3c9e(0xf5)],'status':_0x5e3c9e(0x10e),'createdAt':{'gte':_0x56e108,'lte':_0x48c0f9}},'select':{'amount':!![]}});_0x5c0498=_0x5282cd[_0x5e3c9e(0xe2)]((_0x461e63,_0x4d6f43)=>_0x461e63+_0x4d6f43[_0x5e3c9e(0xb8)],0x0);const _0x3abfdb=await database_1[_0x5e3c9e(0x1fe)][_0x5e3c9e(0x1da)][_0x5e3c9e(0x19a)]({'where':{'shopId':_0x238e3c[_0x5e3c9e(0xf5)],'status':_0x5e3c9e(0x136),'createdAt':{'gte':_0x56e108,'lte':_0x48c0f9}},'select':{'amount':!![]}});_0x3c7863=_0x3abfdb[_0x5e3c9e(0xe2)]((_0x4f17ab,_0x410d20)=>_0x4f17ab+_0x410d20[_0x5e3c9e(0xb8)],0x0);}const _0x1cba23=_0x2b6316,_0x1d01c8=_0x245c67[_0x5e3c9e(0x161)],_0x530089=_0x1d01c8>0x0?_0x5c868f/_0x1d01c8:0x0,_0x265922=_0x1cba23>0x0?Math['round'](_0x1d01c8/_0x1cba23*0x2710)/0x64:0x0,_0x10ed45=Math['ceil']((_0x48c0f9[_0x5e3c9e(0x103)]()-_0x56e108[_0x5e3c9e(0x103)]())/(0x3e8*0x3c*0x3c*0x18)),_0x297b01={'totalTurnover':Math['round'](_0x5c868f*0x64)/0x64,'merchantEarnings':Math[_0x5e3c9e(0x13b)](_0x35c208*0x64)/0x64,'gatewayEarnings':Math[_0x5e3c9e(0x13b)](_0x2510e3*0x64)/0x64,'totalPaidOut':Math[_0x5e3c9e(0x13b)](_0x5c0498*0x64)/0x64,'pendingPayout':Math['round'](_0x3c7863*0x64)/0x64,'averageCheck':Math['round'](_0x530089*0x64)/0x64,'totalPayments':_0x1cba23,'successfulPayments':_0x1d01c8,'conversionRate':_0x265922,'chargebacks':_0x4c651c,'refunds':_0xaee188,'gatewayBreakdown':Object[_0x5e3c9e(0xee)](_0x14e7b4)[_0x5e3c9e(0x1f5)](_0x363325=>({..._0x363325,'turnoverUSDT':Math[_0x5e3c9e(0x13b)](_0x363325[_0x5e3c9e(0x21e)]*0x64)/0x64,'commissionUSDT':Math[_0x5e3c9e(0x13b)](_0x363325[_0x5e3c9e(0xb0)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x5e3c9e(0x13b)](_0x363325[_0x5e3c9e(0x1e7)]*0x64)/0x64,'averageCommissionRate':Math[_0x5e3c9e(0x13b)](_0x363325[_0x5e3c9e(0x10a)]*0x64)/0x64})),'merchantBreakdown':_0x238e3c[_0x5e3c9e(0xf5)]?undefined:Object[_0x5e3c9e(0xee)](_0x934ed7)[_0x5e3c9e(0x1f5)](_0x3680b4=>({..._0x3680b4,'turnoverUSDT':Math[_0x5e3c9e(0x13b)](_0x3680b4[_0x5e3c9e(0x21e)]*0x64)/0x64,'commissionUSDT':Math[_0x5e3c9e(0x13b)](_0x3680b4['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x3680b4[_0x5e3c9e(0x1e7)]*0x64)/0x64,'paidOutUSDT':Math[_0x5e3c9e(0x13b)](_0x3680b4[_0x5e3c9e(0xba)]*0x64)/0x64,'averageCheckUSDT':Math['round'](_0x3680b4['averageCheckUSDT']*0x64)/0x64})),'dailyData':Object[_0x5e3c9e(0xee)](_0x28b09f)['map'](_0x44a8c2=>({..._0x44a8c2,'turnover':Math[_0x5e3c9e(0x13b)](_0x44a8c2['turnover']*0x64)/0x64,'merchantEarnings':Math[_0x5e3c9e(0x13b)](_0x44a8c2[_0x5e3c9e(0x219)]*0x64)/0x64,'gatewayEarnings':Math[_0x5e3c9e(0x13b)](_0x44a8c2[_0x5e3c9e(0x1b9)]*0x64)/0x64}))['sort']((_0x1ac98d,_0x4f8a8d)=>_0x1ac98d[_0x5e3c9e(0x191)][_0x5e3c9e(0x14f)](_0x4f8a8d[_0x5e3c9e(0x191)])),'periodInfo':{'from':_0x56e108,'to':_0x48c0f9,'periodType':_0x238e3c[_0x5e3c9e(0xbe)]||'custom','daysCount':_0x10ed45}};return console[_0x5e3c9e(0xd3)](_0x5e3c9e(0xb4)),console[_0x5e3c9e(0xd3)](_0x5e3c9e(0x1e2)+_0x297b01[_0x5e3c9e(0x137)]+_0x5e3c9e(0x1e0)),console[_0x5e3c9e(0xd3)](_0x5e3c9e(0x131)+_0x297b01['merchantEarnings']+_0x5e3c9e(0x1e0)),console[_0x5e3c9e(0xd3)](_0x5e3c9e(0x1a6)+_0x297b01[_0x5e3c9e(0x1b9)]+_0x5e3c9e(0x1e0)),console[_0x5e3c9e(0xd3)](_0x5e3c9e(0x17b)+_0x297b01['totalPaidOut']+_0x5e3c9e(0x1e0)),console[_0x5e3c9e(0xd3)]('\x20\x20\x20‚è≥\x20Pending\x20payout:\x20'+_0x297b01[_0x5e3c9e(0x113)]+_0x5e3c9e(0x1e0)),console[_0x5e3c9e(0xd3)](_0x5e3c9e(0x97)+_0x297b01['totalPayments']),_0x297b01;}async[a48_0x332814(0xfd)](_0x3f00e4){const _0x1f6ff8=a48_0x332814;console[_0x1f6ff8(0xd3)](_0x1f6ff8(0x1dd),{'hasPayoutHistory':_0x3f00e4});let _0x1b68dd={};_0x3f00e4&&(_0x1b68dd['payouts']={'some':{}});const _0x49470d=await database_1[_0x1f6ff8(0x1fe)][_0x1f6ff8(0x1de)][_0x1f6ff8(0x19a)]({'where':_0x1b68dd,'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x1f6ff8(0x143)}});return console['log'](_0x1f6ff8(0x240)+_0x49470d[_0x1f6ff8(0x161)]+_0x1f6ff8(0x21f)+(_0x3f00e4?'\x20with\x20payout\x20history':'')),_0x49470d[_0x1f6ff8(0x1f5)](_0x436db9=>({'id':_0x436db9['id'],'username':_0x436db9[_0x1f6ff8(0xcf)],'name':_0x436db9[_0x1f6ff8(0x21d)]}));}[a48_0x332814(0x116)](_0x76e1c){const _0x27170e=a48_0x332814,_0x358eeb={'test_gateway':_0x27170e(0x7f),'plisio':_0x27170e(0x152),'rapyd':_0x27170e(0x1d8),'noda':_0x27170e(0x1ba),'cointopay':_0x27170e(0xda),'cointopay2':_0x27170e(0xef),'klyme_eu':'KLYME\x20EU','klyme_gb':_0x27170e(0xd2),'klyme_de':'KLYME\x20DE','mastercard':_0x27170e(0x216),'visa/mastercard':'Visa/MasterCard','amer':_0x27170e(0xa3),'myxspend':_0x27170e(0x1c3),'ampay':'AmPay','ampay_try':_0x27170e(0x109),'sepa':_0x27170e(0x145),'interac':_0x27170e(0x130),'onramp':'OnRamp','squirrelpay':_0x27170e(0x1b1),'maxpara':_0x27170e(0x174),'instaxchange':_0x27170e(0x8e),'oxapay':_0x27170e(0x20a)};return _0x358eeb[_0x76e1c]||_0x76e1c;}['getGatewayInternalName'](_0x466f1d){const _0xe7529a=a48_0x332814,_0x534d84={'Test\x20Gateway':_0xe7529a(0x81),'Plisio':_0xe7529a(0x151),'Rapyd':'rapyd','Noda':_0xe7529a(0x95),'CoinToPay':_0xe7529a(0x1db),'CoinToPay2':_0xe7529a(0x1b0),'KLYME\x20EU':_0xe7529a(0x102),'KLYME\x20GB':'klyme_gb','KLYME\x20DE':_0xe7529a(0x184),'MasterCard':'mastercard'};return _0x534d84[_0x466f1d]||_0x466f1d[_0xe7529a(0xc8)]();}async[a48_0x332814(0x1cc)](_0x2bf608){const _0x4c1c6d=a48_0x332814,{page:_0x10e2dc,limit:_0x599f81,minAmount:_0x2627b3,search:_0x2ee026}=_0x2bf608;console[_0x4c1c6d(0xd3)](_0x4c1c6d(0x20b),_0x2bf608);let _0x4679f0={};_0x2ee026&&(_0x4679f0[_0x4c1c6d(0x21d)]={'contains':_0x2ee026,'mode':'insensitive'});const _0x450fd1=await database_1[_0x4c1c6d(0x1fe)][_0x4c1c6d(0x1de)]['findMany']({'where':_0x4679f0,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),_0x13a0b1=_0x450fd1['filter'](_0x5f5ca7=>{const _0x5dd976=_0x4c1c6d,_0x3c4ab5=Math[_0x5dd976(0x13e)](_0x5f5ca7[_0x5dd976(0x1e9)]*0x64)/0x64;if(_0x2627b3&&_0x3c4ab5<_0x2627b3)return![];return _0x3c4ab5!==0x0;});_0x13a0b1['sort']((_0x12815c,_0x30c934)=>_0x30c934[_0x4c1c6d(0x1e9)]-_0x12815c[_0x4c1c6d(0x1e9)]);const _0x5cf0ab=_0x13a0b1[_0x4c1c6d(0x161)],_0x1c153f=(_0x10e2dc-0x1)*_0x599f81,_0x5918c6=_0x13a0b1['slice'](_0x1c153f,_0x1c153f+_0x599f81);console[_0x4c1c6d(0xd3)]('üí∞\x20Found\x20'+_0x5918c6[_0x4c1c6d(0x161)]+_0x4c1c6d(0x1f8));const _0x564058=await Promise[_0x4c1c6d(0xe9)](_0x5918c6[_0x4c1c6d(0x1f5)](async _0x55edb7=>{const _0x5a9a6c=_0x4c1c6d,[_0x591c4e,_0x34df05,_0x2b9a3c]=await Promise['all']([database_1[_0x5a9a6c(0x1fe)][_0x5a9a6c(0x1f1)][_0x5a9a6c(0xa6)]({'where':{'shopId':_0x55edb7['id'],'status':_0x5a9a6c(0x1aa),'gateway':{'not':_0x5a9a6c(0x81)}}}),database_1[_0x5a9a6c(0x1fe)][_0x5a9a6c(0x1f1)]['findFirst']({'where':{'shopId':_0x55edb7['id'],'status':_0x5a9a6c(0x1aa),'gateway':{'not':'test_gateway'}},'orderBy':{'paidAt':_0x5a9a6c(0x143)},'select':{'paidAt':!![]}}),database_1[_0x5a9a6c(0x1fe)][_0x5a9a6c(0x1f1)][_0x5a9a6c(0xe6)]({'by':[_0x5a9a6c(0x241)],'where':{'shopId':_0x55edb7['id'],'status':_0x5a9a6c(0x1aa),'gateway':{'not':'test_gateway'}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x149863=new Date(),_0x410e08=new Date(_0x149863[_0x5a9a6c(0x14a)](),_0x149863['getMonth'](),0x1),_0x58f7c7=new Date(_0x149863[_0x5a9a6c(0x14a)](),_0x149863[_0x5a9a6c(0x22c)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x44c8c8,_0x1e088d]=await Promise[_0x5a9a6c(0xe9)]([database_1['default'][_0x5a9a6c(0x1da)][_0x5a9a6c(0x22d)]({'_sum':{'amount':!![]},'where':{'shopId':_0x55edb7['id'],'status':_0x5a9a6c(0x10e)}}),database_1['default'][_0x5a9a6c(0x1da)][_0x5a9a6c(0x22d)]({'_sum':{'amount':!![]},'where':{'shopId':_0x55edb7['id'],'status':_0x5a9a6c(0x10e),'createdAt':{'gte':_0x410e08,'lte':_0x58f7c7}}})]),_0x4929fb=_0x44c8c8[_0x5a9a6c(0x1f3)][_0x5a9a6c(0xb8)]||0x0,_0x46af21=_0x1e088d[_0x5a9a6c(0x1f3)]['amount']||0x0,_0x525223=await Promise[_0x5a9a6c(0xe9)](_0x2b9a3c['map'](async _0x57bc8f=>{const _0x28b4bb=_0x5a9a6c;let _0xd5e9f8=0x2d;if(_0x55edb7[_0x28b4bb(0xd7)])try{const _0x2e3b59=JSON['parse'](_0x55edb7[_0x28b4bb(0xd7)]);for(const [_0x392a64,_0x2bce30]of Object[_0x28b4bb(0x230)](_0x2e3b59)){if(_0x392a64['toLowerCase']()===_0x57bc8f['gateway'][_0x28b4bb(0xc8)]()){_0xd5e9f8=_0x2bce30[_0x28b4bb(0x214)]||0xa,console[_0x28b4bb(0xd3)](_0x28b4bb(0x80)+_0x57bc8f[_0x28b4bb(0x241)]+_0x28b4bb(0x188)+_0x55edb7['id']+_0x28b4bb(0x1fc)+_0xd5e9f8+'%');break;}}}catch(_0x293a41){console[_0x28b4bb(0x14c)](_0x28b4bb(0x9f)+_0x55edb7['id']+':',_0x293a41);}const _0x3cbbf0=_0x57bc8f[_0x28b4bb(0x1f3)]?.[_0x28b4bb(0xbc)]||0x0,_0xc33c28=_0x3cbbf0*(0x1-_0xd5e9f8/0x64);return{'gateway':_0x57bc8f[_0x28b4bb(0x241)],'count':_0x57bc8f[_0x28b4bb(0xec)]?.['id']||0x0,'amountUSDT':Math['round'](_0x3cbbf0*0x64)/0x64,'amountAfterCommissionUSDT':Math['round'](_0xc33c28*0x64)/0x64,'commission':_0xd5e9f8};})),_0x3dafb=_0x525223['reduce']((_0x4841b2,_0xf45451)=>_0x4841b2+_0xf45451[_0x5a9a6c(0xbc)],0x0),_0x3060a1=_0x525223[_0x5a9a6c(0xe2)]((_0x4c19da,_0x2127f0)=>_0x4c19da+_0x2127f0[_0x5a9a6c(0xce)],0x0),_0x4162ea=_0x55edb7[_0x5a9a6c(0x1e9)];return console['log']('üí∞\x20[PAYOUT]\x20Merchant\x20'+_0x55edb7['username']+':'),console['log']('\x20\x20\x20ÔøΩ\x20Total\x20payments\x20turnover:\x20'+_0x3dafb[_0x5a9a6c(0x1ed)](0x2)+_0x5a9a6c(0x186)),console[_0x5a9a6c(0xd3)](_0x5a9a6c(0x1f4)+_0x3060a1[_0x5a9a6c(0x1ed)](0x2)+_0x5a9a6c(0x1d4)),console[_0x5a9a6c(0xd3)]('\x20\x20\x20‚úÖ\x20Actual\x20available\x20balance:\x20'+_0x4162ea[_0x5a9a6c(0x1ed)](0x2)+_0x5a9a6c(0xc2)),console[_0x5a9a6c(0xd3)](_0x5a9a6c(0xdc)+_0x4929fb['toFixed'](0x2)+_0x5a9a6c(0x133)),console['log']('\x20\x20\x20ü§î\x20Difference:\x20'+(_0x3060a1-_0x4929fb-_0x4162ea)[_0x5a9a6c(0x1ed)](0x2)+_0x5a9a6c(0x171)),{'id':_0x55edb7['id'],'fullName':_0x55edb7[_0x5a9a6c(0x21d)],'username':_0x55edb7[_0x5a9a6c(0xcf)],'telegramId':_0x55edb7['telegram'],'merchantUrl':_0x55edb7[_0x5a9a6c(0xf8)],'wallets':{'usdtPolygonWallet':_0x55edb7[_0x5a9a6c(0xb6)],'usdtTrcWallet':_0x55edb7[_0x5a9a6c(0x87)],'usdtErcWallet':_0x55edb7[_0x5a9a6c(0xe5)],'usdcPolygonWallet':_0x55edb7[_0x5a9a6c(0x1d9)],'usdcErcWallet':_0x55edb7[_0x5a9a6c(0xcb)]},'totalAmountUSDT':Math[_0x5a9a6c(0x13b)](_0x3dafb*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x5a9a6c(0x13b)](_0x3060a1*0x64)/0x64,'currentBalance':Math[_0x5a9a6c(0x13e)](_0x4162ea*0x64)/0x64,'totalPayout':Math['round'](_0x4929fb*0x64)/0x64,'thisMonth':Math[_0x5a9a6c(0x13b)](_0x46af21*0x64)/0x64,'paymentsCount':_0x591c4e,'oldestPaymentDate':_0x34df05?.[_0x5a9a6c(0x1be)]||_0x55edb7[_0x5a9a6c(0xf7)],'gatewayBreakdown':_0x525223};})),_0x5f2b2a=_0x564058['reduce']((_0x1e53b4,_0x559150)=>_0x1e53b4+_0x559150[_0x4c1c6d(0x15b)],0x0),_0x3dff75=_0x564058[_0x4c1c6d(0xe2)]((_0x202f8c,_0xa0aa55)=>_0x202f8c+_0xa0aa55[_0x4c1c6d(0x1b5)],0x0),_0x5e2e50=_0x564058[_0x4c1c6d(0xe2)]((_0x5d7efa,_0x1c871f)=>_0x5d7efa+_0x1c871f[_0x4c1c6d(0x206)],0x0),_0x70ccbc=_0x564058['reduce']((_0x3edf39,_0x5b2a6f)=>_0x3edf39+_0x5b2a6f[_0x4c1c6d(0x10d)],0x0);return console[_0x4c1c6d(0xd3)](_0x4c1c6d(0x1bc)+_0x5cf0ab+'\x20merchants'),console[_0x4c1c6d(0xd3)]('\x20\x20\x20üí∞\x20Total\x20payments\x20turnover:\x20'+Math[_0x4c1c6d(0x13b)](_0x5f2b2a*0x64)/0x64+_0x4c1c6d(0x186)),console[_0x4c1c6d(0xd3)]('\x20\x20\x20‚úÖ\x20Total\x20net\x20balances:\x20'+Math['round'](_0x3dff75*0x64)/0x64+_0x4c1c6d(0x176)),console[_0x4c1c6d(0xd3)](_0x4c1c6d(0x12f)+Math[_0x4c1c6d(0x13b)](_0x5e2e50*0x64)/0x64+_0x4c1c6d(0x1e0)),console[_0x4c1c6d(0xd3)]('\x20\x20\x20üìÖ\x20Total\x20payouts\x20(this\x20month):\x20'+Math[_0x4c1c6d(0x13b)](_0x70ccbc*0x64)/0x64+_0x4c1c6d(0x1e0)),{'merchants':_0x564058,'pagination':{'page':_0x10e2dc,'limit':_0x599f81,'total':_0x5cf0ab,'totalPages':Math[_0x4c1c6d(0x110)](_0x5cf0ab/_0x599f81)},'summary':{'totalMerchants':_0x5cf0ab,'totalAmountUSDT':Math[_0x4c1c6d(0x13b)](_0x5f2b2a*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x4c1c6d(0x13b)](_0x3dff75*0x64)/0x64,'totalPayout':Math[_0x4c1c6d(0x13b)](_0x5e2e50*0x64)/0x64,'thisMonth':Math[_0x4c1c6d(0x13b)](_0x70ccbc*0x64)/0x64}};}async[a48_0x332814(0x93)](_0x3bc0e1){const _0x1e90e8=a48_0x332814,{shopId:_0x47dc74,amount:_0x4da5ee,network:_0x7b9abf,wallet:_0x317e45,notes:_0x2ecfe1,txid:_0x5c51c2,periodFrom:_0x2a372c,periodTo:_0x2d4f2d}=_0x3bc0e1,_0x3007b2=await database_1[_0x1e90e8(0x1fe)]['$transaction'](async _0x591e6e=>{const _0xb144fb=_0x1e90e8,_0xd39dfa=await _0x591e6e['shop'][_0xb144fb(0x89)]({'where':{'id':_0x47dc74},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0xd39dfa)throw new Error(_0xb144fb(0x8b));console[_0xb144fb(0xd3)](_0xb144fb(0x23f)+_0xd39dfa[_0xb144fb(0xcf)]+':'),console[_0xb144fb(0xd3)]('\x20\x20\x20Current\x20balance:\x20'+_0xd39dfa['balance'][_0xb144fb(0x1ed)](0x6)+_0xb144fb(0x1e0)),console['log'](_0xb144fb(0xd5)+_0x4da5ee[_0xb144fb(0x1ed)](0x6)+'\x20USDT'),console[_0xb144fb(0xd3)](_0xb144fb(0x15e)+_0xd39dfa[_0xb144fb(0x122)]['toFixed'](0x6)+'\x20USDT');if(_0x5c51c2)console[_0xb144fb(0xd3)](_0xb144fb(0x1a2)+_0x5c51c2);const _0x217d7c=0.000001,_0x29193a=Number(_0xd39dfa[_0xb144fb(0x1e9)]),_0x3f5312=Number(_0x4da5ee);console['log']('üîç\x20Balance\x20check\x20details:'),console[_0xb144fb(0xd3)]('\x20\x20\x20Available\x20(raw):\x20'+_0xd39dfa[_0xb144fb(0x1e9)]),console[_0xb144fb(0xd3)](_0xb144fb(0x1ce)+_0x29193a),console[_0xb144fb(0xd3)](_0xb144fb(0x212)+_0x3f5312),console[_0xb144fb(0xd3)]('\x20\x20\x20Difference:\x20'+(_0x29193a-_0x3f5312)),console['log'](_0xb144fb(0x20d)+_0x217d7c);if(_0x29193a<_0x3f5312-_0x217d7c)throw new Error(_0xb144fb(0x9b)+_0x29193a[_0xb144fb(0x1ed)](0x6)+_0xb144fb(0xbb)+_0x3f5312[_0xb144fb(0x1ed)](0x6)+_0xb144fb(0x1b7)+(_0x29193a-_0x3f5312)[_0xb144fb(0x1ed)](0x8)+'\x20USDT');console['log']('‚úÖ\x20Balance\x20check\x20passed\x20(with\x20tolerance)');const _0x30fd7c=Math[_0xb144fb(0x1f7)](_0x29193a,_0x3f5312);let _0x24c25f=_0x317e45;console['log'](_0xb144fb(0x1f2)+(_0x317e45||_0xb144fb(0x1ec)));if(!_0x24c25f){console[_0xb144fb(0xd3)]('üîç\x20No\x20wallet\x20provided,\x20looking\x20up\x20from\x20shop\x20settings...');const _0x1418da=await _0x591e6e[_0xb144fb(0x1de)][_0xb144fb(0x89)]({'where':{'id':_0x47dc74},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});console['log'](_0xb144fb(0x11a),_0x1418da);if(_0x1418da)switch(_0x7b9abf){case _0xb144fb(0xb2):_0x24c25f=_0x1418da[_0xb144fb(0xb6)]||undefined,console[_0xb144fb(0xd3)]('üîç\x20Selected\x20polygon\x20wallet:\x20'+_0x24c25f);break;case _0xb144fb(0x192):_0x24c25f=_0x1418da[_0xb144fb(0x87)]||undefined,console[_0xb144fb(0xd3)](_0xb144fb(0x182)+_0x24c25f);break;case _0xb144fb(0x218):_0x24c25f=_0x1418da[_0xb144fb(0xe5)]||undefined,console[_0xb144fb(0xd3)]('üîç\x20Selected\x20erc20\x20wallet:\x20'+_0x24c25f);break;case _0xb144fb(0x19b):_0x24c25f=_0x1418da['usdcPolygonWallet']||undefined,console[_0xb144fb(0xd3)]('üîç\x20Selected\x20polygon_usdc\x20wallet:\x20'+_0x24c25f);break;case _0xb144fb(0x119):_0x24c25f=_0x1418da[_0xb144fb(0xcb)]||undefined,console[_0xb144fb(0xd3)]('üîç\x20Selected\x20erc20_usdc\x20wallet:\x20'+_0x24c25f);break;}}else console[_0xb144fb(0xd3)](_0xb144fb(0x99)+_0x24c25f);console[_0xb144fb(0xd3)](_0xb144fb(0x21b)+_0x7b9abf+':\x20'+(_0x24c25f||_0xb144fb(0xa4))),console['log']('üîç\x20Creating\x20payout\x20with\x20data:',{'shopId':_0x47dc74,'amount':_0x30fd7c,'network':_0x7b9abf,'wallet':_0x24c25f,'status':'COMPLETED','txid':_0x5c51c2,'notes':_0x2ecfe1,'periodFrom':_0x2a372c?new Date(_0x2a372c):null,'periodTo':_0x2d4f2d?new Date(_0x2d4f2d):null});const _0x33c5e3=await _0x591e6e[_0xb144fb(0x1da)][_0xb144fb(0x168)]({'data':{'shopId':_0x47dc74,'amount':_0x30fd7c,'network':_0x7b9abf,'wallet':_0x24c25f,'status':_0xb144fb(0x10e),'txid':_0x5c51c2,'notes':_0x2ecfe1,'periodFrom':_0x2a372c?new Date(_0x2a372c):null,'periodTo':_0x2d4f2d?new Date(_0x2d4f2d):null,'createdAt':new Date(),'paidAt':new Date()}});console[_0xb144fb(0xd3)]('‚úÖ\x20Payout\x20created\x20in\x20DB:',{'id':_0x33c5e3['id'],'wallet':_0x33c5e3[_0xb144fb(0xc3)],'network':_0x33c5e3[_0xb144fb(0x155)],'amount':_0x33c5e3[_0xb144fb(0xb8)]});const _0x43d976=_0x29193a-_0x30fd7c,_0x2a77aa=Number(_0xd39dfa[_0xb144fb(0x122)])+_0x30fd7c;return await _0x591e6e[_0xb144fb(0x1de)]['update']({'where':{'id':_0x47dc74},'data':{'balance':_0x43d976,'totalPaidOut':_0x2a77aa}}),console['log'](_0xb144fb(0x1ad)+_0xd39dfa[_0xb144fb(0xcf)]+'\x20balance\x20updated:'),console[_0xb144fb(0xd3)](_0xb144fb(0x1af)+_0x29193a[_0xb144fb(0x1ed)](0x6)+'\x20->\x20'+_0x43d976[_0xb144fb(0x1ed)](0x6)+_0xb144fb(0x140)+_0x30fd7c['toFixed'](0x6)+')'),console[_0xb144fb(0xd3)](_0xb144fb(0x11b)+_0xd39dfa[_0xb144fb(0x122)][_0xb144fb(0x1ed)](0x6)+_0xb144fb(0x163)+_0x2a77aa[_0xb144fb(0x1ed)](0x6)+'\x20USDT\x20(+'+_0x30fd7c[_0xb144fb(0x1ed)](0x6)+')'),console['log'](_0xb144fb(0xa5)+_0x30fd7c['toFixed'](0x6)+'\x20USDT'),{'payout':_0x33c5e3,'shop':_0xd39dfa};});console[_0x1e90e8(0xd3)](_0x1e90e8(0xd6)+_0x3007b2[_0x1e90e8(0x1da)]['id']+'\x20for\x20shop\x20'+_0x3007b2['shop'][_0x1e90e8(0xcf)]+'\x20('+_0x3007b2['payout']['amount'][_0x1e90e8(0x1ed)](0x6)+_0x1e90e8(0xe4));try{let _0x59c8b1=_0x1e90e8(0x202);if(_0x3007b2['payout'][_0x1e90e8(0x12c)]&&_0x3007b2[_0x1e90e8(0x1da)]['periodTo']){const _0x563df0=new Date(_0x3007b2[_0x1e90e8(0x1da)]['periodFrom'])[_0x1e90e8(0x150)](_0x1e90e8(0xac)),_0x244b53=new Date(_0x3007b2[_0x1e90e8(0x1da)][_0x1e90e8(0x23c)])[_0x1e90e8(0x150)]('ru-RU');_0x59c8b1=_0x563df0+'\x20-\x20'+_0x244b53;}await telegramBotService_1['telegramBotService'][_0x1e90e8(0xa1)](_0x3007b2[_0x1e90e8(0x1da)][_0x1e90e8(0xf5)],{'id':_0x3007b2['payout']['id'],'amount':_0x3007b2['payout'][_0x1e90e8(0xb8)],'network':_0x3007b2['payout'][_0x1e90e8(0x155)],'wallet':_0x3007b2[_0x1e90e8(0x1da)][_0x1e90e8(0xc3)],'period':_0x59c8b1,'createdAt':_0x3007b2[_0x1e90e8(0x1da)][_0x1e90e8(0xf7)],'txid':_0x3007b2['payout']['txid']}),console['log'](_0x1e90e8(0x11c)+_0x3007b2[_0x1e90e8(0x1da)]['id']);}catch(_0x2d6f90){console[_0x1e90e8(0x14c)](_0x1e90e8(0x85)+_0x3007b2['payout']['id']+':',_0x2d6f90);}return{'id':_0x3007b2[_0x1e90e8(0x1da)]['id'],'shopId':_0x3007b2['payout'][_0x1e90e8(0xf5)],'shopName':_0x3007b2[_0x1e90e8(0x1de)][_0x1e90e8(0x21d)],'shopUsername':_0x3007b2[_0x1e90e8(0x1de)][_0x1e90e8(0xcf)],'amount':_0x3007b2[_0x1e90e8(0x1da)]['amount'],'network':_0x3007b2[_0x1e90e8(0x1da)][_0x1e90e8(0x155)],'wallet':_0x3007b2[_0x1e90e8(0x1da)][_0x1e90e8(0xc3)],'status':_0x3007b2['payout'][_0x1e90e8(0xfa)],'txid':_0x3007b2['payout'][_0x1e90e8(0x12d)],'notes':_0x3007b2[_0x1e90e8(0x1da)][_0x1e90e8(0x1ca)],'periodFrom':_0x3007b2[_0x1e90e8(0x1da)][_0x1e90e8(0x12c)],'periodTo':_0x3007b2[_0x1e90e8(0x1da)][_0x1e90e8(0x23c)],'createdAt':_0x3007b2[_0x1e90e8(0x1da)][_0x1e90e8(0xf7)],'paidAt':_0x3007b2['payout'][_0x1e90e8(0x1be)]};}async[a48_0x332814(0x19c)](_0x33bccf){const _0x4a672d=a48_0x332814,{page:_0x244b7b,limit:_0xb788ed,shopId:_0x2fb9fe,network:_0x1e42f4,dateFrom:_0x4e642e,dateTo:_0x3dad3d,search:_0x445a1a}=_0x33bccf,_0x28e4b9=(_0x244b7b-0x1)*_0xb788ed,_0x59c2a4={};_0x2fb9fe&&(_0x59c2a4[_0x4a672d(0xf5)]=_0x2fb9fe);_0x1e42f4&&(_0x59c2a4[_0x4a672d(0x155)]=_0x1e42f4);if(_0x4e642e||_0x3dad3d){_0x59c2a4[_0x4a672d(0xf7)]={};if(_0x4e642e){const _0x510ee6=new Date(_0x4e642e);_0x510ee6[_0x4a672d(0x175)](0x0,0x0,0x0,0x1),_0x59c2a4[_0x4a672d(0xf7)][_0x4a672d(0xfe)]=_0x510ee6,console[_0x4a672d(0xd3)](_0x4a672d(0x148)+_0x510ee6[_0x4a672d(0x1e8)]());}if(_0x3dad3d){const _0x2abd3c=new Date(_0x3dad3d);_0x2abd3c[_0x4a672d(0x175)](0x17,0x3b,0x3b,0x3e7),_0x59c2a4[_0x4a672d(0xf7)][_0x4a672d(0xae)]=_0x2abd3c,console['log'](_0x4a672d(0x14e)+_0x2abd3c[_0x4a672d(0x1e8)]());}}_0x445a1a&&(_0x59c2a4['OR']=[{'shop':{'name':{'contains':_0x445a1a,'mode':_0x4a672d(0x1ae)}}},{'shop':{'username':{'contains':_0x445a1a,'mode':_0x4a672d(0x1ae)}}},{'notes':{'contains':_0x445a1a,'mode':_0x4a672d(0x1ae)}}]);const [_0x362f85,_0x30efee]=await Promise['all']([database_1[_0x4a672d(0x1fe)][_0x4a672d(0x1da)][_0x4a672d(0x19a)]({'where':_0x59c2a4,'skip':_0x28e4b9,'take':_0xb788ed,'orderBy':{'createdAt':_0x4a672d(0x154)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'wallet':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x4a672d(0x1fe)]['payout'][_0x4a672d(0xa6)]({'where':_0x59c2a4})]);return{'payouts':_0x362f85['map'](_0x1c8a7b=>({'id':_0x1c8a7b['id'],'shopId':_0x1c8a7b[_0x4a672d(0xf5)],'shopName':_0x1c8a7b[_0x4a672d(0x1de)][_0x4a672d(0x21d)],'shopUsername':_0x1c8a7b['shop'][_0x4a672d(0xcf)],'amount':_0x1c8a7b[_0x4a672d(0xb8)],'network':_0x1c8a7b[_0x4a672d(0x155)],'wallet':_0x1c8a7b[_0x4a672d(0xc3)],'status':_0x1c8a7b[_0x4a672d(0xfa)],'txid':_0x1c8a7b['txid'],'notes':_0x1c8a7b[_0x4a672d(0x1ca)],'periodFrom':_0x1c8a7b[_0x4a672d(0x12c)],'periodTo':_0x1c8a7b[_0x4a672d(0x23c)],'createdAt':_0x1c8a7b[_0x4a672d(0xf7)],'paidAt':_0x1c8a7b[_0x4a672d(0x1be)]})),'pagination':{'page':_0x244b7b,'limit':_0xb788ed,'total':_0x30efee,'totalPages':Math[_0x4a672d(0x110)](_0x30efee/_0xb788ed)}};}async[a48_0x332814(0x1b3)](_0x8181d5){const _0x34ee77=a48_0x332814,_0x1edb83=await database_1[_0x34ee77(0x1fe)][_0x34ee77(0x1da)][_0x34ee77(0x89)]({'where':{'id':_0x8181d5},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x1edb83)return null;return{'id':_0x1edb83['id'],'shopId':_0x1edb83['shopId'],'shopName':_0x1edb83['shop'][_0x34ee77(0x21d)],'shopUsername':_0x1edb83[_0x34ee77(0x1de)][_0x34ee77(0xcf)],'amount':_0x1edb83[_0x34ee77(0xb8)],'network':_0x1edb83[_0x34ee77(0x155)],'wallet':_0x1edb83['wallet'],'status':_0x1edb83[_0x34ee77(0xfa)],'txid':_0x1edb83[_0x34ee77(0x12d)],'notes':_0x1edb83[_0x34ee77(0x1ca)],'periodFrom':_0x1edb83[_0x34ee77(0x12c)],'periodTo':_0x1edb83[_0x34ee77(0x23c)],'createdAt':_0x1edb83[_0x34ee77(0xf7)],'paidAt':_0x1edb83[_0x34ee77(0x1be)]};}async['deletePayout'](_0x422c2d){const _0x591044=a48_0x332814;await database_1[_0x591044(0x1fe)]['payout'][_0x591044(0x23a)]({'where':{'id':_0x422c2d}});}async[a48_0x332814(0x108)](_0xa4a3df,_0x70570c){const _0x4606d4=a48_0x332814,_0x1ab1c6=await database_1['default'][_0x4606d4(0x111)](async _0x2b7aba=>{const _0xa42f59=_0x4606d4,_0x31b77a=await _0x2b7aba['payout'][_0xa42f59(0x89)]({'where':{'id':_0xa4a3df},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}}}});if(!_0x31b77a)throw new Error(_0xa42f59(0xf1));console[_0xa42f59(0xd3)](_0xa42f59(0x149)+_0xa4a3df+'\x20for\x20shop\x20'+_0x31b77a[_0xa42f59(0x1de)]['username']+':'),console[_0xa42f59(0xd3)]('\x20\x20\x20Current\x20amount:\x20'+_0x31b77a['amount'][_0xa42f59(0x1ed)](0x6)+_0xa42f59(0x1e0)),console[_0xa42f59(0xd3)](_0xa42f59(0x1a9)+_0x31b77a[_0xa42f59(0x155)]),console[_0xa42f59(0xd3)](_0xa42f59(0x134)+_0x31b77a[_0xa42f59(0x1de)][_0xa42f59(0x1e9)][_0xa42f59(0x1ed)](0x6)+_0xa42f59(0x1e0)),console[_0xa42f59(0xd3)]('\x20\x20\x20Shop\x20totalPaidOut:\x20'+_0x31b77a['shop'][_0xa42f59(0x122)]['toFixed'](0x6)+_0xa42f59(0x1e0));let _0x401845=0x0;if(_0x70570c[_0xa42f59(0xb8)]!==undefined){const _0xdd11b3=Number(_0x31b77a[_0xa42f59(0xb8)]),_0x2350fa=Number(_0x70570c[_0xa42f59(0xb8)]);_0x401845=_0x2350fa-_0xdd11b3,console[_0xa42f59(0xd3)]('\x20\x20\x20New\x20amount:\x20'+_0x2350fa[_0xa42f59(0x1ed)](0x6)+_0xa42f59(0x1e0)),console[_0xa42f59(0xd3)](_0xa42f59(0x86)+_0x401845[_0xa42f59(0x1ed)](0x6)+_0xa42f59(0x1e0));if(_0x401845<0x0)console[_0xa42f59(0xd3)](_0xa42f59(0x124)+Math[_0xa42f59(0x204)](_0x401845)[_0xa42f59(0x1ed)](0x6)+_0xa42f59(0x82));else{if(_0x401845>0x0){const _0x5bb6ec=Number(_0x31b77a[_0xa42f59(0x1de)][_0xa42f59(0x1e9)]);console['log'](_0xa42f59(0xcc)+_0x401845[_0xa42f59(0x1ed)](0x6)+_0xa42f59(0x118));if(_0x5bb6ec<_0x401845)throw new Error(_0xa42f59(0x153)+_0x5bb6ec[_0xa42f59(0x1ed)](0x6)+_0xa42f59(0x94)+_0x401845['toFixed'](0x6)+_0xa42f59(0x1e0));}}}const _0x266931={};if(_0x70570c[_0xa42f59(0xb8)]!==undefined)_0x266931[_0xa42f59(0xb8)]=_0x70570c[_0xa42f59(0xb8)];if(_0x70570c[_0xa42f59(0x155)]!==undefined)_0x266931[_0xa42f59(0x155)]=_0x70570c['network'];if(_0x70570c[_0xa42f59(0xc3)]!==undefined)_0x266931[_0xa42f59(0xc3)]=_0x70570c[_0xa42f59(0xc3)]||null;if(_0x70570c[_0xa42f59(0x1ca)]!==undefined)_0x266931[_0xa42f59(0x1ca)]=_0x70570c['notes']||null;if(_0x70570c[_0xa42f59(0x12d)]!==undefined)_0x266931[_0xa42f59(0x12d)]=_0x70570c['txid']||null;if(_0x70570c['periodFrom']!==undefined)_0x266931['periodFrom']=_0x70570c['periodFrom']?new Date(_0x70570c[_0xa42f59(0x12c)]):null;if(_0x70570c['periodTo']!==undefined)_0x266931[_0xa42f59(0x23c)]=_0x70570c[_0xa42f59(0x23c)]?new Date(_0x70570c[_0xa42f59(0x23c)]):null;const _0x3f38b9=await _0x2b7aba[_0xa42f59(0x1da)][_0xa42f59(0x221)]({'where':{'id':_0xa4a3df},'data':_0x266931,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(_0x401845!==0x0){const _0x48ad69=Number(_0x31b77a[_0xa42f59(0x1de)][_0xa42f59(0x1e9)]),_0x410af1=Number(_0x31b77a['shop'][_0xa42f59(0x122)]),_0x47b0e0=_0x48ad69-_0x401845,_0x9b25e4=_0x410af1+_0x401845;await _0x2b7aba[_0xa42f59(0x1de)][_0xa42f59(0x221)]({'where':{'id':_0x31b77a[_0xa42f59(0xf5)]},'data':{'balance':_0x47b0e0,'totalPaidOut':_0x9b25e4}}),console['log'](_0xa42f59(0x1ad)+_0x31b77a['shop'][_0xa42f59(0xcf)]+_0xa42f59(0x229)),console['log'](_0xa42f59(0x1af)+_0x48ad69[_0xa42f59(0x1ed)](0x6)+'\x20->\x20'+_0x47b0e0['toFixed'](0x6)+'\x20USDT'),console['log']('\x20\x20\x20Total\x20paid\x20out:\x20'+_0x410af1[_0xa42f59(0x1ed)](0x6)+_0xa42f59(0x163)+_0x9b25e4[_0xa42f59(0x1ed)](0x6)+_0xa42f59(0x1e0));}return console[_0xa42f59(0xd3)](_0xa42f59(0xdd)+_0xa4a3df+_0xa42f59(0xf3)),_0x3f38b9;});return{'id':_0x1ab1c6['id'],'shopId':_0x1ab1c6[_0x4606d4(0xf5)],'shopName':_0x1ab1c6[_0x4606d4(0x1de)][_0x4606d4(0x21d)],'shopUsername':_0x1ab1c6[_0x4606d4(0x1de)]['username'],'amount':Number(_0x1ab1c6[_0x4606d4(0xb8)]),'network':_0x1ab1c6[_0x4606d4(0x155)],'wallet':_0x1ab1c6[_0x4606d4(0xc3)],'status':_0x1ab1c6[_0x4606d4(0xfa)],'txid':_0x1ab1c6[_0x4606d4(0x12d)],'notes':_0x1ab1c6['notes'],'periodFrom':_0x1ab1c6[_0x4606d4(0x12c)],'periodTo':_0x1ab1c6[_0x4606d4(0x23c)],'createdAt':_0x1ab1c6['createdAt'],'paidAt':_0x1ab1c6[_0x4606d4(0x1be)]};}async[a48_0x332814(0x195)](_0x3bdfa5){const _0x58f3b0=a48_0x332814,{page:_0x4c98c2,limit:_0x318c77,status:_0x1e3a69,gateway:_0x1921b5,shopId:_0x419322,dateFrom:_0x3a374f,dateTo:_0x54eb3a,search:_0x4d4cae,currency:_0x55887b,sortBy:_0x1557c2,sortOrder:_0x39031e}=_0x3bdfa5,_0x4bf907=(_0x4c98c2-0x1)*_0x318c77;console[_0x58f3b0(0xd3)](_0x58f3b0(0x16f),_0x3bdfa5);const _0x2f0092=await database_1[_0x58f3b0(0x1fe)]['payment'][_0x58f3b0(0xe6)]({'by':[_0x58f3b0(0x241)],'_count':{'gateway':!![]}});console[_0x58f3b0(0xd3)](_0x58f3b0(0x209),_0x2f0092[_0x58f3b0(0x1f5)](_0x25f195=>_0x25f195[_0x58f3b0(0x241)]+'\x20('+_0x25f195[_0x58f3b0(0xec)][_0x58f3b0(0x241)]+_0x58f3b0(0x141)));if(_0x1921b5){const _0x24517c=_0x2f0092[_0x58f3b0(0x88)](_0x3dbb56=>_0x3dbb56[_0x58f3b0(0x241)][_0x58f3b0(0xc8)]()===_0x1921b5[_0x58f3b0(0xc8)]());!_0x24517c&&_0x1921b5[_0x58f3b0(0xc8)]()!==_0x58f3b0(0x81)&&console[_0x58f3b0(0xd3)](_0x58f3b0(0x14d)+_0x1921b5+'\x27\x20not\x20found.\x20Available\x20gateways:\x20'+_0x2f0092[_0x58f3b0(0x1f5)](_0x3d3dd7=>_0x3d3dd7[_0x58f3b0(0x241)])[_0x58f3b0(0x17a)](',\x20'));}const _0x38820d={};_0x1e3a69&&(_0x38820d[_0x58f3b0(0xfa)]=_0x1e3a69['toUpperCase']());if(!_0x1921b5)_0x38820d[_0x58f3b0(0x241)]={'not':_0x58f3b0(0x81)};else{if(_0x1921b5&&(_0x1921b5[_0x58f3b0(0xc8)]()===_0x58f3b0(0x81)||_0x1921b5==='0000'))_0x38820d['gateway']='test_gateway';else{let _0x3cb61c=_0x1921b5;const _0x181b2d=(0x0,gateway_1[_0x58f3b0(0x21c)])(_0x1921b5);if(_0x181b2d)_0x3cb61c=_0x181b2d,console[_0x58f3b0(0xd3)](_0x58f3b0(0x1a5)+_0x1921b5+_0x58f3b0(0x235)+_0x3cb61c+'\x27');else{const _0x23d6f0=(0x0,gateway_1[_0x58f3b0(0x12b)])(_0x1921b5);if(_0x23d6f0){const _0x4bb4ec=(0x0,gateway_1[_0x58f3b0(0x21c)])(_0x23d6f0);_0x4bb4ec&&(_0x3cb61c=_0x4bb4ec,console[_0x58f3b0(0xd3)](_0x58f3b0(0x98)+_0x1921b5+_0x58f3b0(0x10f)+_0x23d6f0+_0x58f3b0(0xea)+_0x3cb61c+'\x27'));}else console[_0x58f3b0(0xd3)](_0x58f3b0(0x120)+_0x1921b5+'\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)');}const _0x222991=await database_1[_0x58f3b0(0x1fe)][_0x58f3b0(0x1f1)]['count']({'where':{'gateway':_0x3cb61c['toLowerCase']()},'take':0x1});_0x222991===0x0?(console[_0x58f3b0(0xd3)](_0x58f3b0(0x9c)+_0x3cb61c+_0x58f3b0(0x170)+_0x1921b5+'\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result'),_0x38820d['gateway']=_0x58f3b0(0x1ab)):(_0x38820d['gateway']=_0x3cb61c[_0x58f3b0(0xc8)](),console[_0x58f3b0(0xd3)]('‚úÖ\x20Using\x20gateway\x20filter:\x20\x27'+_0x3cb61c+'\x27\x20(from\x20\x27'+_0x1921b5+'\x27)'));}}console['log'](_0x58f3b0(0x156),_0x38820d['gateway']);_0x419322&&(_0x38820d[_0x58f3b0(0xf5)]=_0x419322);_0x55887b&&(_0x38820d[_0x58f3b0(0xfc)]=_0x55887b[_0x58f3b0(0xa9)](),console[_0x58f3b0(0xd3)](_0x58f3b0(0x84)+_0x55887b[_0x58f3b0(0xa9)]()));if(_0x3a374f||_0x54eb3a){_0x38820d[_0x58f3b0(0xf7)]={};if(_0x3a374f){const _0x4b3e7d=new Date(_0x3a374f),_0x93aa97=new Date(Date[_0x58f3b0(0x16e)](_0x4b3e7d[_0x58f3b0(0x1cd)](),_0x4b3e7d['getUTCMonth'](),_0x4b3e7d[_0x58f3b0(0x220)](),0x0,0x0,0x0,0x0));_0x38820d[_0x58f3b0(0xf7)]['gte']=_0x93aa97,console['log'](_0x58f3b0(0x193)+_0x93aa97[_0x58f3b0(0x1e8)]());}if(_0x54eb3a){const _0x4d6c81=new Date(_0x54eb3a),_0x51454f=new Date(Date[_0x58f3b0(0x16e)](_0x4d6c81[_0x58f3b0(0x1cd)](),_0x4d6c81['getUTCMonth'](),_0x4d6c81[_0x58f3b0(0x220)](),0x17,0x3b,0x3b,0x3e7));_0x38820d['createdAt']['lte']=_0x51454f,console['log'](_0x58f3b0(0x19d)+_0x51454f[_0x58f3b0(0x1e8)]());}}_0x4d4cae&&(_0x38820d['OR']=[{'id':{'contains':_0x4d4cae,'mode':_0x58f3b0(0x1ae)}},{'orderId':{'contains':_0x4d4cae,'mode':_0x58f3b0(0x1ae)}},{'gatewayOrderId':{'contains':_0x4d4cae,'mode':_0x58f3b0(0x1ae)}},{'customerEmail':{'contains':_0x4d4cae,'mode':_0x58f3b0(0x1ae)}},{'shop':{'name':{'contains':_0x4d4cae,'mode':_0x58f3b0(0x1ae)}}},{'shop':{'username':{'contains':_0x4d4cae,'mode':_0x58f3b0(0x1ae)}}}]);console[_0x58f3b0(0xd3)]('üìä\x20Final\x20WHERE\x20conditions:',JSON[_0x58f3b0(0x160)](_0x38820d,null,0x2));const _0xe37df8=await database_1[_0x58f3b0(0x1fe)]['payment'][_0x58f3b0(0xa6)]({'where':_0x38820d});console[_0x58f3b0(0xd3)](_0x58f3b0(0xb5)+_0xe37df8);let _0x2b8c7b={'createdAt':_0x58f3b0(0x154)};if(_0x1557c2){const _0x5cfac0=['amount','createdAt',_0x58f3b0(0x238),'status',_0x58f3b0(0x241),_0x58f3b0(0xfc)],_0x595230=[_0x58f3b0(0x143),_0x58f3b0(0x154)];if(_0x5cfac0[_0x58f3b0(0x17e)](_0x1557c2)){const _0x333ceb=_0x595230[_0x58f3b0(0x17e)](_0x39031e)?_0x39031e:_0x58f3b0(0x154);_0x2b8c7b={[_0x1557c2]:_0x333ceb},console[_0x58f3b0(0xd3)](_0x58f3b0(0x237)+_0x1557c2+_0x58f3b0(0x1b6)+_0x333ceb+_0x58f3b0(0x121));}}const [_0x37d359,_0x17c6a2]=await Promise[_0x58f3b0(0xe9)]([database_1[_0x58f3b0(0x1fe)][_0x58f3b0(0x1f1)][_0x58f3b0(0x19a)]({'where':_0x38820d,'skip':_0x4bf907,'take':_0x318c77,'orderBy':_0x2b8c7b,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default']['payment']['count']({'where':_0x38820d})]);let _0xcc37be,_0x267970;if(_0x3a374f){const _0x23f644=new Date(_0x3a374f);_0xcc37be=new Date(Date[_0x58f3b0(0x16e)](_0x23f644['getUTCFullYear'](),_0x23f644[_0x58f3b0(0x16a)](),_0x23f644[_0x58f3b0(0x220)](),0x0,0x0,0x0,0x0));}else{const _0xb08311=new Date();_0xcc37be=new Date(Date[_0x58f3b0(0x16e)](_0xb08311[_0x58f3b0(0x1cd)](),_0xb08311[_0x58f3b0(0x16a)](),_0xb08311[_0x58f3b0(0x220)](),0x0,0x0,0x0,0x0));}if(_0x54eb3a){const _0x2632b9=new Date(_0x54eb3a);_0x267970=new Date(Date['UTC'](_0x2632b9[_0x58f3b0(0x1cd)](),_0x2632b9[_0x58f3b0(0x16a)](),_0x2632b9[_0x58f3b0(0x220)](),0x17,0x3b,0x3b,0x3e7));}else{if(_0x3a374f){const _0x46ddbf=new Date(_0x3a374f);_0x267970=new Date(Date[_0x58f3b0(0x16e)](_0x46ddbf['getUTCFullYear'](),_0x46ddbf[_0x58f3b0(0x16a)](),_0x46ddbf[_0x58f3b0(0x220)](),0x17,0x3b,0x3b,0x3e7));}else{const _0x137811=new Date();_0x267970=new Date(Date['UTC'](_0x137811['getUTCFullYear'](),_0x137811[_0x58f3b0(0x16a)](),_0x137811[_0x58f3b0(0x220)](),0x17,0x3b,0x3b,0x3e7));}}const _0xdea277={'status':_0x58f3b0(0x1aa),'createdAt':{'gte':_0xcc37be,'lte':_0x267970}};_0x1921b5?_0xdea277['gateway']=_0x38820d['gateway']:_0xdea277[_0x58f3b0(0x241)]={'not':_0x58f3b0(0x81)};_0x419322&&(_0xdea277['shopId']=_0x419322);_0x55887b&&(_0xdea277[_0x58f3b0(0xfc)]=_0x55887b['toUpperCase']());console[_0x58f3b0(0xd3)]('üìä\x20Statistics\x20WHERE\x20conditions:',JSON['stringify'](_0xdea277,null,0x2));const _0x47eac6=await database_1[_0x58f3b0(0x1fe)]['payment']['findMany']({'where':_0xdea277,'select':{'amountUSDT':!![],'currency':!![],'amount':!![]}}),_0x4bb7a3={};let _0x530a19=0x0;return _0x47eac6[_0x58f3b0(0x22a)](_0xe85032=>{const _0x1a2753=_0x58f3b0;_0xe85032[_0x1a2753(0xbc)]&&(_0x530a19+=_0xe85032[_0x1a2753(0xbc)]);if(_0xe85032[_0x1a2753(0xfc)]){const _0x4f2e2d=_0xe85032['currency'][_0x1a2753(0xa9)]();!_0x4bb7a3[_0x4f2e2d]&&(_0x4bb7a3[_0x4f2e2d]=0x0),_0x4bb7a3[_0x4f2e2d]+=_0xe85032[_0x1a2753(0xb8)];}}),_0x530a19>0x0&&(_0x4bb7a3[_0x58f3b0(0x1e6)]=_0x530a19),{'payments':_0x37d359,'pagination':{'page':_0x4c98c2,'limit':_0x318c77,'total':_0x17c6a2,'totalPages':Math[_0x58f3b0(0x110)](_0x17c6a2/_0x318c77)},'statistics':_0x4bb7a3};}async['getPaymentById'](_0x10a323){const _0x2542d1=a48_0x332814,_0x459c94=await database_1[_0x2542d1(0x1fe)][_0x2542d1(0x1f1)][_0x2542d1(0x89)]({'where':{'id':_0x10a323},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x459c94)return null;return{'id':_0x459c94['id'],'shopId':_0x459c94[_0x2542d1(0xf5)],'gateway':_0x459c94[_0x2542d1(0x241)],'amount':_0x459c94['amount'],'currency':_0x459c94[_0x2542d1(0xfc)],'status':_0x459c94[_0x2542d1(0xfa)],'orderId':_0x459c94[_0x2542d1(0x217)],'gatewayOrderId':_0x459c94[_0x2542d1(0xa8)],'customerEmail':_0x459c94[_0x2542d1(0x181)],'customerName':_0x459c94[_0x2542d1(0x105)],'customerCountry':_0x459c94[_0x2542d1(0x211)],'customerIp':_0x459c94[_0x2542d1(0x173)],'customerUa':_0x459c94['customerUa'],'failureMessage':_0x459c94['failureMessage'],'externalPaymentUrl':_0x459c94[_0x2542d1(0x199)],'successUrl':_0x459c94['successUrl'],'failUrl':_0x459c94['failUrl'],'pendingUrl':_0x459c94[_0x2542d1(0x9e)],'whiteUrl':_0x459c94[_0x2542d1(0x10c)],'createdAt':_0x459c94[_0x2542d1(0xf7)],'updatedAt':_0x459c94[_0x2542d1(0x238)],'shop':_0x459c94[_0x2542d1(0x1de)]};}async[a48_0x332814(0xed)](_0x44dd71,_0x41657d,_0x2534b2,_0x6d3020){const _0x3a18e4=a48_0x332814,_0x2174a0=await database_1[_0x3a18e4(0x1fe)][_0x3a18e4(0x111)](async _0x4b20c6=>{const _0x429c00=_0x3a18e4,_0x2cf3b2=await _0x4b20c6[_0x429c00(0x1f1)]['findUnique']({'where':{'id':_0x44dd71},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x2cf3b2)throw new Error(_0x429c00(0x1fb));const _0x4dd941=_0x2cf3b2['status'],_0x4a1468=_0x41657d[_0x429c00(0xa9)]();console[_0x429c00(0xd3)]('üîÑ\x20Admin\x20updating\x20payment\x20'+_0x44dd71+_0x429c00(0xc1)+_0x4dd941+_0x429c00(0x163)+_0x4a1468),console['log'](_0x429c00(0x208)+_0x2cf3b2['shop'][_0x429c00(0x1e9)]+_0x429c00(0x1e0));const _0x1346c1={'status':_0x4a1468,'updatedAt':new Date(),'statusChangedBy':_0x429c00(0x101),'statusChangedAt':new Date()};_0x2534b2&&(_0x1346c1[_0x429c00(0x1f9)]=_0x2534b2);_0x4a1468===_0x429c00(0x228)&&_0x6d3020&&(_0x1346c1[_0x429c00(0xe0)]=_0x6d3020);let _0x25c219=0x0,_0x8675a=_0x2cf3b2[_0x429c00(0x1de)][_0x429c00(0x1e9)];if(_0x4a1468===_0x429c00(0x1aa)&&_0x4dd941!==_0x429c00(0x1aa)){_0x1346c1[_0x429c00(0x1be)]=new Date();const _0x4d992b=await currencyService_1[_0x429c00(0x187)][_0x429c00(0x164)](_0x2cf3b2[_0x429c00(0xb8)],_0x2cf3b2[_0x429c00(0xfc)]);_0x1346c1[_0x429c00(0xbc)]=_0x4d992b;let _0x211a29=0x2d;const _0x1154c5=await _0x4b20c6[_0x429c00(0x1de)]['findUnique']({'where':{'id':_0x2cf3b2[_0x429c00(0xf5)]},'select':{'gatewaySettings':!![]}});if(_0x1154c5?.[_0x429c00(0xd7)])try{const _0x8c06fd=JSON['parse'](_0x1154c5[_0x429c00(0xd7)]);for(const [_0x575e03,_0x33f5a3]of Object[_0x429c00(0x230)](_0x8c06fd)){if(_0x575e03['toLowerCase']()===_0x2cf3b2[_0x429c00(0x241)][_0x429c00(0xc8)]()){_0x211a29=_0x33f5a3[_0x429c00(0x214)]||0xa;break;}}}catch(_0x20b31a){console[_0x429c00(0x14c)]('Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20'+_0x44dd71+':',_0x20b31a);}let _0x48472f;_0x2cf3b2[_0x429c00(0x1cb)]!==null&&_0x2cf3b2[_0x429c00(0x1cb)]!==undefined?(_0x48472f=_0x2cf3b2[_0x429c00(0x1cb)],console[_0x429c00(0xd3)](_0x429c00(0xd1)+_0x48472f[_0x429c00(0x1ed)](0x6)+'\x20USDT\x20for\x20payment\x20'+_0x44dd71)):(_0x48472f=_0x4d992b*(0x1-_0x211a29/0x64),console[_0x429c00(0xd3)](_0x429c00(0x8d)+_0x44dd71+':\x20'+_0x211a29+_0x429c00(0x1ea)+_0x4d992b['toFixed'](0x6)+_0x429c00(0x1e0)),_0x1346c1[_0x429c00(0x1cb)]=_0x48472f,_0x1346c1[_0x429c00(0xc4)]=_0x211a29),_0x25c219=_0x48472f,_0x8675a+=_0x48472f,console[_0x429c00(0xd3)]('üí∞\x20Payment\x20'+_0x44dd71+_0x429c00(0xb9)),console[_0x429c00(0xd3)](_0x429c00(0x172)+_0x4d992b[_0x429c00(0x1ed)](0x6)+_0x429c00(0x1e0)),console[_0x429c00(0xd3)](_0x429c00(0x90)+_0x2cf3b2[_0x429c00(0x241)]+',\x20Commission:\x20'+_0x211a29+'%'),console[_0x429c00(0xd3)](_0x429c00(0x23d)+_0x48472f['toFixed'](0x6)+_0x429c00(0x128)+_0x211a29+_0x429c00(0x227)),console[_0x429c00(0xd3)]('\x20\x20\x20Added\x20to\x20balance:\x20+'+_0x48472f[_0x429c00(0x1ed)](0x6)+'\x20USDT');}else{if(_0x4dd941===_0x429c00(0x1aa)&&_0x4a1468!==_0x429c00(0x1aa)&&_0x4a1468!=='CHARGEBACK'){if(_0x2cf3b2[_0x429c00(0xbc)]){let _0x24836b=0x2d;const _0x4c77be=await _0x4b20c6[_0x429c00(0x1de)][_0x429c00(0x89)]({'where':{'id':_0x2cf3b2[_0x429c00(0xf5)]},'select':{'gatewaySettings':!![]}});if(_0x4c77be?.[_0x429c00(0xd7)])try{const _0x16dbe7=JSON['parse'](_0x4c77be[_0x429c00(0xd7)]);for(const [_0x27cc70,_0x30ab9c]of Object[_0x429c00(0x230)](_0x16dbe7)){if(_0x27cc70['toLowerCase']()===_0x2cf3b2['gateway'][_0x429c00(0xc8)]()){_0x24836b=_0x30ab9c[_0x429c00(0x214)]||0xa;break;}}}catch(_0x280106){console['error'](_0x429c00(0x18f)+_0x44dd71+':',_0x280106);}const _0x567143=_0x2cf3b2[_0x429c00(0xbc)]*(0x1-_0x24836b/0x64);_0x25c219=-_0x567143,_0x8675a-=_0x567143,console['log']('\x20\x20\x20Full\x20amount:\x20'+_0x2cf3b2[_0x429c00(0xbc)]['toFixed'](0x6)+'\x20USDT'),console['log'](_0x429c00(0x90)+_0x2cf3b2[_0x429c00(0x241)]+_0x429c00(0x18c)+_0x24836b+'%'),console[_0x429c00(0xd3)](_0x429c00(0x157)+_0x567143[_0x429c00(0x1ed)](0x6)+_0x429c00(0x128)+_0x24836b+_0x429c00(0x227)),console[_0x429c00(0xd3)](_0x429c00(0x162)+_0x567143[_0x429c00(0x1ed)](0x6)+'\x20USDT');}}}_0x4a1468===_0x429c00(0x228)&&(console[_0x429c00(0xd3)](_0x429c00(0xad)),_0x6d3020&&_0x6d3020>0x0?(_0x25c219=-_0x6d3020,_0x8675a-=_0x6d3020,console['log'](_0x429c00(0x138)+_0x6d3020['toFixed'](0x6)+_0x429c00(0x1e4)),console[_0x429c00(0xd3)](_0x429c00(0xe7))):console[_0x429c00(0xd3)](_0x429c00(0x1d3)),_0x1346c1[_0x429c00(0xe0)]=_0x6d3020||0x0);_0x4a1468===_0x429c00(0x223)&&_0x4dd941===_0x429c00(0x1aa)&&console[_0x429c00(0xd3)](_0x429c00(0x13a));const _0x20096f=await _0x4b20c6[_0x429c00(0x1f1)][_0x429c00(0x221)]({'where':{'id':_0x44dd71},'data':_0x1346c1,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x25c219!==0x0&&(await _0x4b20c6['shop'][_0x429c00(0x221)]({'where':{'id':_0x2cf3b2[_0x429c00(0xf5)]},'data':{'balance':_0x8675a}}),console[_0x429c00(0xd3)](_0x429c00(0x1ad)+_0x2cf3b2[_0x429c00(0xf5)]+_0x429c00(0x1d1)+_0x2cf3b2[_0x429c00(0x1de)][_0x429c00(0x1e9)]['toFixed'](0x6)+_0x429c00(0x163)+_0x8675a[_0x429c00(0x1ed)](0x6)+_0x429c00(0x135)+(_0x25c219>0x0?'+':'')+_0x25c219['toFixed'](0x6)+')')),_0x20096f;});return{'id':_0x2174a0['id'],'shopId':_0x2174a0[_0x3a18e4(0xf5)],'gateway':_0x2174a0['gateway'],'amount':_0x2174a0[_0x3a18e4(0xb8)],'currency':_0x2174a0[_0x3a18e4(0xfc)],'status':_0x2174a0[_0x3a18e4(0xfa)],'orderId':_0x2174a0[_0x3a18e4(0x217)],'gatewayOrderId':_0x2174a0[_0x3a18e4(0xa8)],'customerEmail':_0x2174a0[_0x3a18e4(0x181)],'customerName':_0x2174a0[_0x3a18e4(0x105)],'customerCountry':_0x2174a0[_0x3a18e4(0x211)],'customerIp':_0x2174a0['customerIp'],'customerUa':_0x2174a0['customerUa'],'failureMessage':_0x2174a0['failureMessage'],'adminNotes':_0x2174a0[_0x3a18e4(0x1f9)],'chargebackAmount':_0x2174a0['chargebackAmount'],'statusChangedBy':_0x2174a0[_0x3a18e4(0x125)],'statusChangedAt':_0x2174a0[_0x3a18e4(0x17f)],'createdAt':_0x2174a0['createdAt'],'updatedAt':_0x2174a0[_0x3a18e4(0x238)],'shop':_0x2174a0['shop']};}async[a48_0x332814(0x1bb)](_0x1c0607,_0x48ffa8){const _0x198a53=a48_0x332814,_0x1e297d=Math[_0x198a53(0x12a)]()[_0x198a53(0xb1)](0x24)[_0x198a53(0x15d)](0x2,0x9);console[_0x198a53(0xd3)](_0x198a53(0x167)+_0x1e297d+_0x198a53(0xbd)+_0x1c0607);const _0x1d5c4={..._0x48ffa8};_0x48ffa8[_0x198a53(0x1ac)]&&_0x48ffa8['password'][_0x198a53(0x232)]()!==''?(console['log']('üîê\x20['+_0x1e297d+']\x20Updating\x20password\x20for\x20user\x20'+_0x1c0607),_0x1d5c4[_0x198a53(0x1ac)]=await bcryptjs_1['default'][_0x198a53(0x1c9)](_0x48ffa8['password'],0xc)):(console[_0x198a53(0xd3)](_0x198a53(0x7e)+_0x1e297d+_0x198a53(0x14b)),delete _0x1d5c4[_0x198a53(0x1ac)]);_0x48ffa8[_0x198a53(0x8a)]&&(_0x1d5c4['name']=_0x48ffa8['fullName'],delete _0x1d5c4[_0x198a53(0x8a)]);_0x48ffa8[_0x198a53(0x123)]&&(_0x1d5c4[_0x198a53(0x1a1)]=_0x48ffa8[_0x198a53(0x123)],delete _0x1d5c4[_0x198a53(0x123)]);_0x48ffa8[_0x198a53(0x83)]&&(_0x1d5c4[_0x198a53(0xf8)]=_0x48ffa8[_0x198a53(0x83)],delete _0x1d5c4[_0x198a53(0x83)]);if(_0x48ffa8[_0x198a53(0x1b8)]){const _0x5dd42c=_0x48ffa8[_0x198a53(0x1b8)][_0x198a53(0x1f5)](_0x50f045=>this[_0x198a53(0x126)](_0x50f045));console[_0x198a53(0xd3)](_0x198a53(0xe8),_0x48ffa8[_0x198a53(0x1b8)],'->',_0x5dd42c),_0x1d5c4[_0x198a53(0x13d)]=JSON[_0x198a53(0x160)](_0x5dd42c),delete _0x1d5c4[_0x198a53(0x1b8)];}_0x48ffa8[_0x198a53(0xd7)]&&(console['log'](_0x198a53(0x1b2)+_0x1e297d+']\x20Gateway\x20settings\x20before\x20saving:',_0x48ffa8[_0x198a53(0xd7)]),_0x1d5c4[_0x198a53(0xd7)]=JSON['stringify'](_0x48ffa8[_0x198a53(0xd7)]),console['log']('üîß\x20['+_0x1e297d+_0x198a53(0xe3),_0x1d5c4[_0x198a53(0xd7)]));_0x48ffa8['wallets']&&(_0x48ffa8['wallets']['usdtPolygonWallet']!==undefined&&(_0x1d5c4[_0x198a53(0xb6)]=_0x48ffa8['wallets']['usdtPolygonWallet']||null),_0x48ffa8['wallets'][_0x198a53(0x87)]!==undefined&&(_0x1d5c4[_0x198a53(0x87)]=_0x48ffa8[_0x198a53(0x1f6)][_0x198a53(0x87)]||null),_0x48ffa8[_0x198a53(0x1f6)][_0x198a53(0xe5)]!==undefined&&(_0x1d5c4[_0x198a53(0xe5)]=_0x48ffa8[_0x198a53(0x1f6)]['usdtErcWallet']||null),_0x48ffa8[_0x198a53(0x1f6)]['usdcPolygonWallet']!==undefined&&(_0x1d5c4[_0x198a53(0x1d9)]=_0x48ffa8[_0x198a53(0x1f6)][_0x198a53(0x1d9)]||null),delete _0x1d5c4[_0x198a53(0x1f6)]);const _0x29902e=await database_1[_0x198a53(0x1fe)][_0x198a53(0x1de)][_0x198a53(0x221)]({'where':{'id':_0x1c0607},'data':_0x1d5c4,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console['log'](_0x198a53(0x91)+_0x1e297d+_0x198a53(0x132),_0x29902e['gatewaySettings']),{'id':_0x29902e['id'],'fullName':_0x29902e[_0x198a53(0x21d)],'username':_0x29902e['username'],'telegramId':_0x29902e[_0x198a53(0x1a1)],'merchantUrl':_0x29902e[_0x198a53(0xf8)],'gateways':_0x29902e[_0x198a53(0x13d)]?JSON['parse'](_0x29902e['paymentGateways']):null,'gatewaySettings':_0x29902e[_0x198a53(0xd7)]?JSON[_0x198a53(0x18b)](_0x29902e[_0x198a53(0xd7)]):null,'publicKey':_0x29902e[_0x198a53(0x234)],'wallets':{'usdtPolygonWallet':_0x29902e[_0x198a53(0xb6)],'usdtTrcWallet':_0x29902e[_0x198a53(0x87)],'usdtErcWallet':_0x29902e[_0x198a53(0xe5)],'usdcPolygonWallet':_0x29902e[_0x198a53(0x1d9)]},'status':_0x29902e[_0x198a53(0xfa)],'createdAt':_0x29902e[_0x198a53(0xf7)]};}async[a48_0x332814(0x1a0)](_0x21380c){const _0x44c5a0=a48_0x332814,_0x392502=await database_1[_0x44c5a0(0x1fe)][_0x44c5a0(0x1de)][_0x44c5a0(0x221)]({'where':{'id':_0x21380c},'data':{'status':'SUSPENDED'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x392502['id'],'fullName':_0x392502[_0x44c5a0(0x21d)],'username':_0x392502[_0x44c5a0(0xcf)],'telegramId':_0x392502[_0x44c5a0(0x1a1)],'merchantUrl':_0x392502['shopUrl'],'gateways':_0x392502[_0x44c5a0(0x13d)]?JSON['parse'](_0x392502[_0x44c5a0(0x13d)]):null,'gatewaySettings':_0x392502[_0x44c5a0(0xd7)]?JSON[_0x44c5a0(0x18b)](_0x392502['gatewaySettings']):null,'publicKey':_0x392502['publicKey'],'wallets':{'usdtPolygonWallet':_0x392502[_0x44c5a0(0xb6)],'usdtTrcWallet':_0x392502[_0x44c5a0(0x87)],'usdtErcWallet':_0x392502[_0x44c5a0(0xe5)],'usdcPolygonWallet':_0x392502[_0x44c5a0(0x1d9)]},'status':_0x392502['status'],'createdAt':_0x392502[_0x44c5a0(0xf7)]};}async[a48_0x332814(0x236)](_0x5cc911){const _0x597389=a48_0x332814,_0x38fb27=await database_1[_0x597389(0x1fe)][_0x597389(0x1de)]['update']({'where':{'id':_0x5cc911},'data':{'status':_0x597389(0x8f)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x38fb27['id'],'fullName':_0x38fb27['name'],'username':_0x38fb27[_0x597389(0xcf)],'telegramId':_0x38fb27[_0x597389(0x1a1)],'merchantUrl':_0x38fb27['shopUrl'],'gateways':_0x38fb27['paymentGateways']?JSON[_0x597389(0x18b)](_0x38fb27[_0x597389(0x13d)]):null,'gatewaySettings':_0x38fb27[_0x597389(0xd7)]?JSON[_0x597389(0x18b)](_0x38fb27['gatewaySettings']):null,'publicKey':_0x38fb27[_0x597389(0x234)],'wallets':{'usdtPolygonWallet':_0x38fb27[_0x597389(0xb6)],'usdtTrcWallet':_0x38fb27[_0x597389(0x87)],'usdtErcWallet':_0x38fb27[_0x597389(0xe5)],'usdcPolygonWallet':_0x38fb27[_0x597389(0x1d9)]},'status':_0x38fb27['status'],'createdAt':_0x38fb27[_0x597389(0xf7)]};}async[a48_0x332814(0x222)](_0x1a5938){const _0x219ed6=a48_0x332814,{page:_0x31d4e0,limit:_0x476fc1,status:_0x3531cd,search:_0x125db8}=_0x1a5938,_0x2390d0=(_0x31d4e0-0x1)*_0x476fc1,_0x4d8cd9={};_0x3531cd&&(_0x4d8cd9['status']=_0x3531cd[_0x219ed6(0xa9)]());_0x125db8&&(_0x4d8cd9['OR']=[{'name':{'contains':_0x125db8,'mode':_0x219ed6(0x1ae)}},{'username':{'contains':_0x125db8,'mode':_0x219ed6(0x1ae)}},{'telegram':{'contains':_0x125db8,'mode':_0x219ed6(0x1ae)}},{'shopUrl':{'contains':_0x125db8,'mode':_0x219ed6(0x1ae)}}]);const [_0x42ffb8,_0x2b8729]=await Promise[_0x219ed6(0xe9)]([database_1[_0x219ed6(0x1fe)]['shop'][_0x219ed6(0x19a)]({'where':_0x4d8cd9,'skip':_0x2390d0,'take':_0x476fc1,'orderBy':{'createdAt':_0x219ed6(0x154)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'twoFactorEnabled':!![],'createdAt':!![],'lastLoginAt':!![],'_count':{'select':{'telegramUsers':!![]}}}}),database_1[_0x219ed6(0x1fe)]['shop']['count']({'where':_0x4d8cd9})]);return{'users':_0x42ffb8[_0x219ed6(0x1f5)](_0x189406=>{const _0x58674a=_0x219ed6,_0x38ee61=_0x189406[_0x58674a(0x13d)]?JSON[_0x58674a(0x18b)](_0x189406[_0x58674a(0x13d)]):null,_0x86d5c8=_0x38ee61?_0x38ee61[_0x58674a(0x1f5)](_0x2e15f3=>this[_0x58674a(0x116)](_0x2e15f3)):null;return{'id':_0x189406['id'],'fullName':_0x189406['name'],'username':_0x189406[_0x58674a(0xcf)],'telegramId':_0x189406[_0x58674a(0x1a1)],'merchantUrl':_0x189406[_0x58674a(0xf8)],'gateways':_0x86d5c8,'gatewaySettings':_0x189406[_0x58674a(0xd7)]?JSON[_0x58674a(0x18b)](_0x189406['gatewaySettings']):null,'publicKey':_0x189406['publicKey'],'wallets':{'usdtPolygonWallet':_0x189406['usdtPolygonWallet'],'usdtTrcWallet':_0x189406[_0x58674a(0x87)],'usdtErcWallet':_0x189406['usdtErcWallet'],'usdcPolygonWallet':_0x189406[_0x58674a(0x1d9)],'usdcErcWallet':_0x189406[_0x58674a(0xcb)]},'status':_0x189406[_0x58674a(0xfa)],'twoFactorEnabled':_0x189406[_0x58674a(0xbf)]||![],'telegramUsersCount':_0x189406[_0x58674a(0xec)][_0x58674a(0xf6)],'createdAt':_0x189406[_0x58674a(0xf7)],'lastLoginAt':_0x189406[_0x58674a(0x22f)]};}),'pagination':{'page':_0x31d4e0,'limit':_0x476fc1,'total':_0x2b8729,'totalPages':Math['ceil'](_0x2b8729/_0x476fc1)}};}async[a48_0x332814(0x8c)](_0x490071){const _0x5ad51b=a48_0x332814,_0xb23928=await database_1[_0x5ad51b(0x1fe)][_0x5ad51b(0x1de)]['findUnique']({'where':{'id':_0x490071},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![]}});if(!_0xb23928)return null;const _0x3343e7=_0xb23928['paymentGateways']?JSON['parse'](_0xb23928[_0x5ad51b(0x13d)]):null,_0x56067f=_0x3343e7?_0x3343e7[_0x5ad51b(0x1f5)](_0x4613dc=>this[_0x5ad51b(0x116)](_0x4613dc)):null;return _0x3343e7&&_0x56067f&&console[_0x5ad51b(0xd3)](_0x5ad51b(0x1fd),_0x3343e7,'->',_0x56067f),{'id':_0xb23928['id'],'fullName':_0xb23928[_0x5ad51b(0x21d)],'username':_0xb23928['username'],'telegramId':_0xb23928[_0x5ad51b(0x1a1)],'merchantUrl':_0xb23928[_0x5ad51b(0xf8)],'gateways':_0x56067f,'gatewaySettings':_0xb23928['gatewaySettings']?JSON[_0x5ad51b(0x18b)](_0xb23928['gatewaySettings']):null,'publicKey':_0xb23928['publicKey'],'wallets':{'usdtPolygonWallet':_0xb23928[_0x5ad51b(0xb6)],'usdtTrcWallet':_0xb23928[_0x5ad51b(0x87)],'usdtErcWallet':_0xb23928[_0x5ad51b(0xe5)],'usdcPolygonWallet':_0xb23928[_0x5ad51b(0x1d9)],'usdcErcWallet':_0xb23928['usdcErcWallet']},'status':_0xb23928[_0x5ad51b(0xfa)],'createdAt':_0xb23928[_0x5ad51b(0xf7)]};}async[a48_0x332814(0x127)](_0x87b819){const _0x2c8ec3=a48_0x332814,{fullName:_0x5c32b0,username:_0x4337a3,password:_0x1ebf73,telegramId:_0x5825cb,merchantUrl:_0x53d49d,gateways:_0x530ec3,gatewaySettings:_0x32e59a,wallets:_0x58d4db}=_0x87b819,_0x28fde4=await database_1[_0x2c8ec3(0x1fe)]['shop'][_0x2c8ec3(0x89)]({'where':{'username':_0x4337a3}});if(_0x28fde4)throw new Error('Username\x20already\x20exists');if(_0x5825cb){const _0x1610a7=await database_1[_0x2c8ec3(0x1fe)][_0x2c8ec3(0x1de)]['findUnique']({'where':{'telegram':_0x5825cb}});if(_0x1610a7)throw new Error('Telegram\x20username\x20already\x20exists');}const _0x4c40bb=await bcryptjs_1[_0x2c8ec3(0x1fe)][_0x2c8ec3(0x1c9)](_0x1ebf73,0xc),_0x2493b0=_0x2c8ec3(0x106)+crypto_1[_0x2c8ec3(0x1fe)][_0x2c8ec3(0xc6)](0x20)[_0x2c8ec3(0xb1)](_0x2c8ec3(0x239)),_0xa81f02='sk_'+crypto_1[_0x2c8ec3(0x1fe)][_0x2c8ec3(0xc6)](0x20)[_0x2c8ec3(0xb1)](_0x2c8ec3(0x239)),_0x1ae08a=_0x530ec3?_0x530ec3[_0x2c8ec3(0x1f5)](_0x234b7c=>this[_0x2c8ec3(0x126)](_0x234b7c)):null;_0x530ec3&&_0x1ae08a&&console['log'](_0x2c8ec3(0xb3),_0x530ec3,'->',_0x1ae08a);const _0x101e5d=await database_1[_0x2c8ec3(0x1fe)]['shop']['create']({'data':{'name':_0x5c32b0,'username':_0x4337a3,'password':_0x4c40bb,'telegram':_0x5825cb,'shopUrl':_0x53d49d,'paymentGateways':_0x1ae08a?JSON[_0x2c8ec3(0x160)](_0x1ae08a):null,'gatewaySettings':_0x32e59a?JSON[_0x2c8ec3(0x160)](_0x32e59a):null,'usdtPolygonWallet':_0x58d4db?.[_0x2c8ec3(0xb6)]||null,'usdtTrcWallet':_0x58d4db?.[_0x2c8ec3(0x87)]||null,'usdtErcWallet':_0x58d4db?.[_0x2c8ec3(0xe5)]||null,'usdcPolygonWallet':_0x58d4db?.[_0x2c8ec3(0x1d9)]||null,'publicKey':_0x2493b0,'secretKey':_0xa81f02,'status':_0x2c8ec3(0x8f)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x101e5d['id'],'fullName':_0x101e5d[_0x2c8ec3(0x21d)],'username':_0x101e5d[_0x2c8ec3(0xcf)],'telegramId':_0x101e5d['telegram'],'merchantUrl':_0x101e5d[_0x2c8ec3(0xf8)],'gateways':_0x101e5d['paymentGateways']?JSON[_0x2c8ec3(0x18b)](_0x101e5d['paymentGateways']):null,'gatewaySettings':_0x101e5d[_0x2c8ec3(0xd7)]?JSON[_0x2c8ec3(0x18b)](_0x101e5d[_0x2c8ec3(0xd7)]):null,'publicKey':_0x101e5d[_0x2c8ec3(0x234)],'wallets':{'usdtPolygonWallet':_0x101e5d[_0x2c8ec3(0xb6)],'usdtTrcWallet':_0x101e5d['usdtTrcWallet'],'usdtErcWallet':_0x101e5d['usdtErcWallet'],'usdcPolygonWallet':_0x101e5d['usdcPolygonWallet']},'status':_0x101e5d[_0x2c8ec3(0xfa)],'createdAt':_0x101e5d[_0x2c8ec3(0xf7)]};}async[a48_0x332814(0x185)](_0x54a13d,_0x2e1428){const _0x168bb4=a48_0x332814;if(config_1[_0x168bb4(0x146)][_0x168bb4(0x101)][_0x168bb4(0xbf)]){if(!_0x2e1428)throw new Error(_0x168bb4(0xdb));const _0x389f6e=speakeasy_1[_0x168bb4(0x1fe)][_0x168bb4(0x17c)][_0x168bb4(0xaf)]({'secret':config_1[_0x168bb4(0x146)][_0x168bb4(0x101)]['twoFactorSecret'],'encoding':_0x168bb4(0x20c),'token':_0x2e1428,'window':0x2});if(!_0x389f6e){let _0x29c521=![];if(config_1[_0x168bb4(0x146)]['admin'][_0x168bb4(0x198)]){const _0x38be17=JSON[_0x168bb4(0x18b)](config_1[_0x168bb4(0x146)][_0x168bb4(0x101)][_0x168bb4(0x198)]);for(let _0x57816e=0x0;_0x57816e<_0x38be17[_0x168bb4(0x161)];_0x57816e++){const _0x33feda=await bcryptjs_1[_0x168bb4(0x1fe)][_0x168bb4(0x18d)](_0x2e1428,_0x38be17[_0x57816e]);if(_0x33feda){_0x29c521=!![],_0x38be17[_0x168bb4(0x100)](_0x57816e,0x1),config_1[_0x168bb4(0x146)][_0x168bb4(0x101)][_0x168bb4(0x198)]=JSON[_0x168bb4(0x160)](_0x38be17);const _0x54fb7c=path_1[_0x168bb4(0x1fe)][_0x168bb4(0x17a)](process[_0x168bb4(0x1d2)](),_0x168bb4(0x23b));if(fs_1[_0x168bb4(0x1fe)][_0x168bb4(0xc7)](_0x54fb7c)){let _0x96f65=fs_1[_0x168bb4(0x1fe)][_0x168bb4(0x1d6)](_0x54fb7c,_0x168bb4(0x15a));const _0x4d9b55=_0x96f65['split']('\x0a');for(let _0x1a7672=0x0;_0x1a7672<_0x4d9b55[_0x168bb4(0x161)];_0x1a7672++){if(_0x4d9b55[_0x1a7672]['startsWith'](_0x168bb4(0x1c5))){_0x4d9b55[_0x1a7672]='ADMIN_BACKUP_CODES='+JSON[_0x168bb4(0x160)](_0x38be17);break;}}fs_1['default'][_0x168bb4(0x18a)](_0x54fb7c,_0x4d9b55[_0x168bb4(0x17a)]('\x0a'),_0x168bb4(0x15a));}break;}}}if(!_0x29c521)throw new Error(_0x168bb4(0xfb));}}await database_1[_0x168bb4(0x1fe)]['shop']['delete']({'where':{'id':_0x54a13d}});}async['getShopWallets'](_0xa57914){const _0x102047=a48_0x332814,_0x58633a=await database_1[_0x102047(0x1fe)][_0x102047(0x1de)][_0x102047(0x89)]({'where':{'id':_0xa57914},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});if(!_0x58633a)throw new Error(_0x102047(0x8b));return{'usdtPolygonWallet':_0x58633a[_0x102047(0xb6)],'usdtTrcWallet':_0x58633a[_0x102047(0x87)],'usdtErcWallet':_0x58633a[_0x102047(0xe5)],'usdcPolygonWallet':_0x58633a['usdcPolygonWallet'],'usdcErcWallet':_0x58633a[_0x102047(0xcb)]};}['generateBackupCodes'](_0xb17e4f=0x8){const _0x3cec25=a48_0x332814,_0x48f906=[];for(let _0x41589b=0x0;_0x41589b<_0xb17e4f;_0x41589b++){const _0x2bd902=crypto_1['default'][_0x3cec25(0xc6)](0x4)[_0x3cec25(0xb1)](_0x3cec25(0x239))[_0x3cec25(0xa9)]();_0x48f906[_0x3cec25(0x10b)](_0x2bd902);}return _0x48f906;}async[a48_0x332814(0x104)](_0x2d6f33){const _0x219192=a48_0x332814,_0x164fc3=await database_1[_0x219192(0x1fe)][_0x219192(0x1de)]['findUnique']({'where':{'id':_0x2d6f33},'select':{'id':!![],'name':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x164fc3)throw new Error(_0x219192(0x8b));const _0x2659c9=speakeasy_1[_0x219192(0x1fe)][_0x219192(0x142)]({'name':_0x219192(0xab)+_0x164fc3[_0x219192(0xcf)]+')','issuer':_0x219192(0x92),'length':0x20}),_0x36a1e2=await qrcode_1[_0x219192(0x1fe)]['toDataURL'](_0x2659c9['otpauth_url']),_0x2d2d46=this['generateBackupCodes'](0x8),_0x47cb36=await Promise['all'](_0x2d2d46[_0x219192(0x1f5)](_0x57ce73=>bcryptjs_1[_0x219192(0x1fe)][_0x219192(0x1c9)](_0x57ce73,0xa)));return await database_1[_0x219192(0x1fe)][_0x219192(0x1de)][_0x219192(0x221)]({'where':{'id':_0x2d6f33},'data':{'twoFactorSecret':_0x2659c9['base32'],'backupCodes':JSON[_0x219192(0x160)](_0x47cb36)}}),console[_0x219192(0xd3)](_0x219192(0x1c7)+_0x164fc3[_0x219192(0xcf)]),console[_0x219192(0xd3)](_0x219192(0x177)+_0x2d2d46[_0x219192(0x161)]+'\x20backup\x20codes'),{'secret':_0x2659c9[_0x219192(0x20c)],'qrCode':_0x36a1e2,'manualEntryKey':_0x2659c9[_0x219192(0x20c)],'backupCodes':_0x2d2d46};}async[a48_0x332814(0x13c)](_0x82732b,_0x480cdf){const _0x46ce05=a48_0x332814,_0x3ff33f=await database_1['default'][_0x46ce05(0x1de)][_0x46ce05(0x89)]({'where':{'id':_0x82732b},'select':{'id':!![],'username':!![],'twoFactorSecret':!![],'twoFactorEnabled':!![]}});if(!_0x3ff33f)throw new Error(_0x46ce05(0x8b));if(!_0x3ff33f[_0x46ce05(0x196)])throw new Error(_0x46ce05(0x22b));if(_0x3ff33f[_0x46ce05(0xbf)])throw new Error(_0x46ce05(0xa2));const _0x171ba4=speakeasy_1[_0x46ce05(0x1fe)][_0x46ce05(0x17c)][_0x46ce05(0xaf)]({'secret':_0x3ff33f[_0x46ce05(0x196)],'encoding':_0x46ce05(0x20c),'token':_0x480cdf,'window':0x2});if(!_0x171ba4)throw new Error(_0x46ce05(0x1ef));return await database_1[_0x46ce05(0x1fe)]['shop'][_0x46ce05(0x221)]({'where':{'id':_0x82732b},'data':{'twoFactorEnabled':!![]}}),console[_0x46ce05(0xd3)](_0x46ce05(0x1bd)+_0x3ff33f[_0x46ce05(0xcf)]),{'enabled':!![]};}async[a48_0x332814(0x147)](_0xa5b697){const _0x3f17c7=a48_0x332814,_0x2434fe=await database_1[_0x3f17c7(0x1fe)][_0x3f17c7(0x1de)]['findUnique']({'where':{'id':_0xa5b697},'select':{'id':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x2434fe)throw new Error(_0x3f17c7(0x8b));await database_1[_0x3f17c7(0x1fe)][_0x3f17c7(0x1de)]['update']({'where':{'id':_0xa5b697},'data':{'twoFactorEnabled':![],'twoFactorSecret':null,'backupCodes':null}}),console['log']('üîê\x202FA\x20disabled\x20for\x20shop:\x20'+_0x2434fe[_0x3f17c7(0xcf)]);}async[a48_0x332814(0x96)](_0x2570f7,_0xc7656b,_0xd0bad9,_0x747852){const _0x1fdaba=a48_0x332814;if(_0xc7656b!==_0xd0bad9)throw new Error('New\x20password\x20and\x20confirmation\x20do\x20not\x20match');if(_0xc7656b[_0x1fdaba(0x161)]<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x2585cb=await bcryptjs_1[_0x1fdaba(0x1fe)][_0x1fdaba(0x18d)](_0x2570f7,config_1[_0x1fdaba(0x146)][_0x1fdaba(0x101)][_0x1fdaba(0xd9)]);if(!_0x2585cb)throw new Error('Current\x20password\x20is\x20incorrect');if(config_1[_0x1fdaba(0x146)]['admin'][_0x1fdaba(0xbf)]){if(!_0x747852)throw new Error(_0x1fdaba(0xdb));const _0x2fe7b6=speakeasy_1[_0x1fdaba(0x1fe)][_0x1fdaba(0x17c)][_0x1fdaba(0xaf)]({'secret':config_1['config']['admin'][_0x1fdaba(0x196)],'encoding':'base32','token':_0x747852,'window':0x2});if(!_0x2fe7b6){let _0x345d23=![];if(config_1[_0x1fdaba(0x146)][_0x1fdaba(0x101)][_0x1fdaba(0x198)]){const _0xa0358b=JSON['parse'](config_1[_0x1fdaba(0x146)]['admin'][_0x1fdaba(0x198)]);for(let _0x52cc6b=0x0;_0x52cc6b<_0xa0358b[_0x1fdaba(0x161)];_0x52cc6b++){const _0x2273e0=await bcryptjs_1['default'][_0x1fdaba(0x18d)](_0x747852,_0xa0358b[_0x52cc6b]);if(_0x2273e0){_0x345d23=!![],_0xa0358b[_0x1fdaba(0x100)](_0x52cc6b,0x1),config_1['config'][_0x1fdaba(0x101)][_0x1fdaba(0x198)]=JSON[_0x1fdaba(0x160)](_0xa0358b);const _0x2971df=path_1[_0x1fdaba(0x1fe)][_0x1fdaba(0x17a)](process[_0x1fdaba(0x1d2)](),_0x1fdaba(0x23b));if(fs_1[_0x1fdaba(0x1fe)][_0x1fdaba(0xc7)](_0x2971df)){let _0x51d210=fs_1['default'][_0x1fdaba(0x1d6)](_0x2971df,'utf8');const _0x3079ee=_0x51d210['split']('\x0a');for(let _0x4fdc22=0x0;_0x4fdc22<_0x3079ee[_0x1fdaba(0x161)];_0x4fdc22++){if(_0x3079ee[_0x4fdc22][_0x1fdaba(0x1e3)](_0x1fdaba(0x1c5))){_0x3079ee[_0x4fdc22]=_0x1fdaba(0x1c5)+JSON[_0x1fdaba(0x160)](_0xa0358b);break;}}fs_1[_0x1fdaba(0x1fe)][_0x1fdaba(0x18a)](_0x2971df,_0x3079ee['join']('\x0a'),'utf8');}break;}}}if(!_0x345d23)throw new Error(_0x1fdaba(0xfb));}}const _0x53b836=await bcryptjs_1[_0x1fdaba(0x1fe)][_0x1fdaba(0x1c9)](_0xc7656b,0xc);config_1[_0x1fdaba(0x146)][_0x1fdaba(0x101)][_0x1fdaba(0xd9)]=_0x53b836;const _0x17c449=path_1[_0x1fdaba(0x1fe)][_0x1fdaba(0x17a)](process['cwd'](),_0x1fdaba(0x23b));let _0x4c6d95='';if(fs_1[_0x1fdaba(0x1fe)][_0x1fdaba(0xc7)](_0x17c449)){_0x4c6d95=fs_1[_0x1fdaba(0x1fe)][_0x1fdaba(0x1d6)](_0x17c449,'utf8');const _0x5a7e90=_0x4c6d95[_0x1fdaba(0x166)]('\x0a');let _0x58b142=![];for(let _0x372782=0x0;_0x372782<_0x5a7e90[_0x1fdaba(0x161)];_0x372782++){if(_0x5a7e90[_0x372782][_0x1fdaba(0x1e3)]('ADMIN_PASSWORD_HASH=')){_0x5a7e90[_0x372782]=_0x1fdaba(0xc9)+_0x53b836,_0x58b142=!![];break;}}!_0x58b142&&_0x5a7e90[_0x1fdaba(0x10b)](_0x1fdaba(0xc9)+_0x53b836),_0x4c6d95=_0x5a7e90['join']('\x0a'),fs_1[_0x1fdaba(0x1fe)][_0x1fdaba(0x18a)](_0x17c449,_0x4c6d95,'utf8');}console[_0x1fdaba(0xd3)](_0x1fdaba(0x18e));}async[a48_0x332814(0xb7)](){const _0x4d4ba0=a48_0x332814;let _0x342b3e=0x0;if(config_1[_0x4d4ba0(0x146)][_0x4d4ba0(0x101)][_0x4d4ba0(0x198)])try{const _0x122a5a=JSON[_0x4d4ba0(0x18b)](config_1[_0x4d4ba0(0x146)][_0x4d4ba0(0x101)][_0x4d4ba0(0x198)]);_0x342b3e=_0x122a5a[_0x4d4ba0(0x161)];}catch(_0x1c7685){console[_0x4d4ba0(0x14c)]('Error\x20parsing\x20backup\x20codes:',_0x1c7685);}return{'twoFactorEnabled':config_1[_0x4d4ba0(0x146)]['admin'][_0x4d4ba0(0xbf)],'backupCodesCount':_0x342b3e};}async[a48_0x332814(0x9d)](){const _0x2b59a4=a48_0x332814,_0x511c6e=speakeasy_1[_0x2b59a4(0x1fe)][_0x2b59a4(0x142)]({'name':_0x2b59a4(0x1f0)+config_1['config'][_0x2b59a4(0x101)]['username']+')','issuer':'TrapaPay\x20Admin','length':0x20}),_0x5d4003=await qrcode_1[_0x2b59a4(0x1fe)][_0x2b59a4(0x183)](_0x511c6e[_0x2b59a4(0x1eb)]),_0x1db769=[];for(let _0x12e7bc=0x0;_0x12e7bc<0x8;_0x12e7bc++){const _0x6112e=crypto_1['default']['randomBytes'](0x4)[_0x2b59a4(0xb1)](_0x2b59a4(0x239))[_0x2b59a4(0xa9)]();_0x1db769[_0x2b59a4(0x10b)](_0x6112e);}const _0x6bf8f3=await Promise[_0x2b59a4(0xe9)](_0x1db769[_0x2b59a4(0x1f5)](_0x271843=>bcryptjs_1[_0x2b59a4(0x1fe)]['hash'](_0x271843,0xa)));config_1[_0x2b59a4(0x146)][_0x2b59a4(0x101)][_0x2b59a4(0x196)]=_0x511c6e[_0x2b59a4(0x20c)],config_1['config'][_0x2b59a4(0x101)][_0x2b59a4(0x198)]=JSON[_0x2b59a4(0x160)](_0x6bf8f3);const _0x7d9f05=path_1[_0x2b59a4(0x1fe)][_0x2b59a4(0x17a)](process[_0x2b59a4(0x1d2)](),_0x2b59a4(0x23b));if(fs_1[_0x2b59a4(0x1fe)][_0x2b59a4(0xc7)](_0x7d9f05)){let _0x597441=fs_1[_0x2b59a4(0x1fe)]['readFileSync'](_0x7d9f05,'utf8');const _0x296fa1=_0x597441[_0x2b59a4(0x166)]('\x0a');let _0x31c381=![],_0x15f3b4=![];for(let _0xc8cfc6=0x0;_0xc8cfc6<_0x296fa1['length'];_0xc8cfc6++){_0x296fa1[_0xc8cfc6][_0x2b59a4(0x1e3)]('ADMIN_2FA_SECRET=')&&(_0x296fa1[_0xc8cfc6]=_0x2b59a4(0x224)+_0x511c6e[_0x2b59a4(0x20c)],_0x31c381=!![]),_0x296fa1[_0xc8cfc6][_0x2b59a4(0x1e3)](_0x2b59a4(0x1c5))&&(_0x296fa1[_0xc8cfc6]=_0x2b59a4(0x1c5)+JSON[_0x2b59a4(0x160)](_0x6bf8f3),_0x15f3b4=!![]);}if(!_0x31c381)_0x296fa1[_0x2b59a4(0x10b)]('ADMIN_2FA_SECRET='+_0x511c6e[_0x2b59a4(0x20c)]);if(!_0x15f3b4)_0x296fa1['push']('ADMIN_BACKUP_CODES='+JSON[_0x2b59a4(0x160)](_0x6bf8f3));fs_1[_0x2b59a4(0x1fe)][_0x2b59a4(0x18a)](_0x7d9f05,_0x296fa1['join']('\x0a'),'utf8');}return console[_0x2b59a4(0xd3)](_0x2b59a4(0x1c6)),console[_0x2b59a4(0xd3)](_0x2b59a4(0x177)+_0x1db769[_0x2b59a4(0x161)]+_0x2b59a4(0x16d)),{'secret':_0x511c6e[_0x2b59a4(0x20c)],'qrCode':_0x5d4003,'manualEntryKey':_0x511c6e['base32'],'backupCodes':_0x1db769};}async[a48_0x332814(0x112)](_0x293751){const _0xf46d6c=a48_0x332814;if(!config_1[_0xf46d6c(0x146)][_0xf46d6c(0x101)][_0xf46d6c(0x196)])throw new Error(_0xf46d6c(0x22b));if(config_1[_0xf46d6c(0x146)][_0xf46d6c(0x101)][_0xf46d6c(0xbf)])throw new Error(_0xf46d6c(0xa2));const _0x48b9c4=speakeasy_1[_0xf46d6c(0x1fe)][_0xf46d6c(0x17c)]['verify']({'secret':config_1[_0xf46d6c(0x146)]['admin']['twoFactorSecret'],'encoding':_0xf46d6c(0x20c),'token':_0x293751,'window':0x2});if(!_0x48b9c4)throw new Error(_0xf46d6c(0x1ef));config_1['config'][_0xf46d6c(0x101)]['twoFactorEnabled']=!![];const _0x401c37=path_1['default'][_0xf46d6c(0x17a)](process[_0xf46d6c(0x1d2)](),_0xf46d6c(0x23b));if(fs_1[_0xf46d6c(0x1fe)][_0xf46d6c(0xc7)](_0x401c37)){let _0x38f06d=fs_1[_0xf46d6c(0x1fe)][_0xf46d6c(0x1d6)](_0x401c37,_0xf46d6c(0x15a));const _0x481191=_0x38f06d[_0xf46d6c(0x166)]('\x0a');let _0x31f16e=![];for(let _0x18e070=0x0;_0x18e070<_0x481191[_0xf46d6c(0x161)];_0x18e070++){if(_0x481191[_0x18e070]['startsWith']('ADMIN_2FA_ENABLED=')){_0x481191[_0x18e070]=_0xf46d6c(0xf4),_0x31f16e=!![];break;}}if(!_0x31f16e)_0x481191[_0xf46d6c(0x10b)](_0xf46d6c(0xf4));fs_1[_0xf46d6c(0x1fe)][_0xf46d6c(0x18a)](_0x401c37,_0x481191[_0xf46d6c(0x17a)]('\x0a'),_0xf46d6c(0x15a));}return console['log']('üîê\x20Admin\x202FA\x20enabled'),{'enabled':!![]};}async[a48_0x332814(0xeb)](){const _0x41db4c=a48_0x332814;config_1[_0x41db4c(0x146)][_0x41db4c(0x101)][_0x41db4c(0xbf)]=![],config_1['config'][_0x41db4c(0x101)]['twoFactorSecret']='',config_1['config'][_0x41db4c(0x101)]['backupCodes']='';const _0x2b9ef5=path_1[_0x41db4c(0x1fe)][_0x41db4c(0x17a)](process[_0x41db4c(0x1d2)](),_0x41db4c(0x23b));if(fs_1[_0x41db4c(0x1fe)][_0x41db4c(0xc7)](_0x2b9ef5)){let _0x79b53c=fs_1[_0x41db4c(0x1fe)][_0x41db4c(0x1d6)](_0x2b9ef5,'utf8');const _0xce4fb7=_0x79b53c[_0x41db4c(0x166)]('\x0a');for(let _0x282df0=0x0;_0x282df0<_0xce4fb7['length'];_0x282df0++){_0xce4fb7[_0x282df0][_0x41db4c(0x1e3)]('ADMIN_2FA_ENABLED=')&&(_0xce4fb7[_0x282df0]='ADMIN_2FA_ENABLED=false'),_0xce4fb7[_0x282df0][_0x41db4c(0x1e3)](_0x41db4c(0x224))&&(_0xce4fb7[_0x282df0]=_0x41db4c(0x224)),_0xce4fb7[_0x282df0][_0x41db4c(0x1e3)](_0x41db4c(0x1c5))&&(_0xce4fb7[_0x282df0]=_0x41db4c(0x1c5));}fs_1[_0x41db4c(0x1fe)][_0x41db4c(0x18a)](_0x2b9ef5,_0xce4fb7['join']('\x0a'),_0x41db4c(0x15a));}console['log'](_0x41db4c(0x1b4));}[a48_0x332814(0x159)](_0x53327c,_0x6a383c,_0xacb784){const _0x8858ad=a48_0x332814,_0x573906=new Map(),_0x9602b3=new Date(_0x6a383c);while(_0x9602b3<=_0xacb784){const _0x2959eb=_0x9602b3[_0x8858ad(0x1e8)]()[_0x8858ad(0x166)]('T')[0x0];_0x573906[_0x8858ad(0x12e)](_0x2959eb,{'revenue':0x0,'count':0x0}),_0x9602b3['setDate'](_0x9602b3[_0x8858ad(0x189)]()+0x1);}for(const _0x3d3ce0 of _0x53327c){const _0x4c4855=_0x3d3ce0[_0x8858ad(0xf7)]['toISOString']()[_0x8858ad(0x166)]('T')[0x0],_0x257617=_0x573906['get'](_0x4c4855);_0x257617&&(_0x257617['count']+=0x1,_0x3d3ce0[_0x8858ad(0xfa)]===_0x8858ad(0x1aa)&&(_0x3d3ce0[_0x8858ad(0xbc)]?_0x257617[_0x8858ad(0x205)]+=_0x3d3ce0[_0x8858ad(0xbc)]:console['log'](_0x8858ad(0xf2)+_0x3d3ce0['id']+'\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion')));}const _0x4ad0bd=[],_0xbd3730=[];for(const [_0x18e689,_0x153f94]of _0x573906){_0x4ad0bd['push']({'date':_0x18e689,'amount':Math['round'](_0x153f94[_0x8858ad(0x205)]*0x64)/0x64}),_0xbd3730[_0x8858ad(0x10b)]({'date':_0x18e689,'count':_0x153f94['count']});}return{'dailyRevenue':_0x4ad0bd,'dailyPayments':_0xbd3730};}async[a48_0x332814(0xc5)](_0x50755c){const _0x37cb85=a48_0x332814;console[_0x37cb85(0xd3)](_0x37cb85(0x1c1),_0x50755c);const _0x5e46f8=new Date(_0x50755c['periodFrom']),_0x5bb91a=new Date(_0x50755c[_0x37cb85(0x23c)]),_0xa7442d=new Date(Date[_0x37cb85(0x16e)](_0x5e46f8['getUTCFullYear'](),_0x5e46f8[_0x37cb85(0x16a)](),_0x5e46f8[_0x37cb85(0x220)](),0x0,0x0,0x0,0x0)),_0x1b324e=new Date(Date[_0x37cb85(0x16e)](_0x5bb91a[_0x37cb85(0x1cd)](),_0x5bb91a['getUTCMonth'](),_0x5bb91a[_0x37cb85(0x220)](),0x17,0x3b,0x3b,0x3e7));console[_0x37cb85(0xd3)](_0x37cb85(0x203)+_0xa7442d[_0x37cb85(0x1e8)]()+_0x37cb85(0x21a)+_0x1b324e['toISOString']()),console[_0x37cb85(0xd3)](_0x37cb85(0x1a7)+_0x50755c[_0x37cb85(0x241)]);const _0x500002=await database_1['default'][_0x37cb85(0x1f1)][_0x37cb85(0x19a)]({'where':{'status':_0x37cb85(0x1aa),'gateway':_0x50755c[_0x37cb85(0x241)]['toLowerCase'](),'createdAt':{'gte':_0xa7442d,'lte':_0x1b324e}},'select':{'id':!![],'shopId':!![],'amountAfterGatewayCommissionUSDT':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console[_0x37cb85(0xd3)](_0x37cb85(0x169)+_0x500002[_0x37cb85(0x161)]+'\x20paid\x20payments\x20for\x20gateway\x20'+_0x50755c['gateway']);const _0xa55903=new Map();for(const _0x2c58c9 of _0x500002){const _0x4f8d54=_0x2c58c9[_0x37cb85(0x1cb)]||0x0;if(_0x4f8d54<=0x0){console[_0x37cb85(0x139)]('‚ö†Ô∏è\x20Payment\x20'+_0x2c58c9['id']+_0x37cb85(0x9a));continue;}if(_0xa55903['has'](_0x2c58c9[_0x37cb85(0xf5)])){const _0xfadb99=_0xa55903[_0x37cb85(0x194)](_0x2c58c9[_0x37cb85(0xf5)]);_0xfadb99[_0x37cb85(0x1ee)]+=_0x4f8d54;}else _0xa55903[_0x37cb85(0x12e)](_0x2c58c9['shopId'],{'merchantId':_0x2c58c9['shop']['id'],'merchantName':_0x2c58c9[_0x37cb85(0x1de)]['name'],'merchantUsername':_0x2c58c9[_0x37cb85(0x1de)][_0x37cb85(0xcf)],'totalAmount':_0x4f8d54});}const _0xbbcdd6=Array[_0x37cb85(0x15f)](_0xa55903[_0x37cb85(0xee)]())['map'](_0x1b2d42=>({'merchantId':_0x1b2d42[_0x37cb85(0x16c)],'merchantName':_0x1b2d42[_0x37cb85(0x231)],'merchantUsername':_0x1b2d42['merchantUsername'],'gateway':_0x50755c[_0x37cb85(0x241)],'periodFrom':_0x50755c[_0x37cb85(0x12c)],'periodTo':_0x50755c[_0x37cb85(0x23c)],'totalAmount':Math[_0x37cb85(0x13b)](_0x1b2d42[_0x37cb85(0x1ee)]*0x64)/0x64}));return _0xbbcdd6[_0x37cb85(0x23e)]((_0x39774b,_0xd16b9a)=>_0xd16b9a[_0x37cb85(0x1ee)]-_0x39774b[_0x37cb85(0x1ee)]),console['log']('üìä\x20Generated\x20reports\x20for\x20'+_0xbbcdd6[_0x37cb85(0x161)]+_0x37cb85(0x144)),_0xbbcdd6;}}function a48_0x38f5(){const _0x29d43b=['turnoverUSDT','\x20merchants\x20for\x20selection','getUTCDate','update','getAllUsers','REFUND','ADMIN_2FA_SECRET=','\x20paid\x20payments\x20for\x20analysis','getPayoutStats','%\x20commission)','CHARGEBACK','\x20balance\x20updated:','forEach','2FA\x20not\x20set\x20up.\x20Please\x20call\x20setup\x20endpoint\x20first','getMonth','aggregate','qrcode','lastLoginAt','entries','merchantName','trim','../config/database','publicKey','\x27\x20to\x20name\x20\x27','activateUser','üìä\x20Sorting\x20payments\x20by\x20','updatedAt','hex','delete','.env','periodTo','\x20\x20\x20Merchant\x20gets:\x20','sort','üí∞\x20Creating\x20payout\x20for\x20shop\x20','üìã\x20Found\x20','gateway','üîê\x20[','Test\x20Gateway','üí∞\x20[PAYOUT]\x20Gateway\x20','test_gateway','\x20USDT\x20-\x20will\x20return\x20to\x20balance','merchantUrl','üí±\x20Currency\x20filter\x20applied:\x20','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notification\x20for\x20payout\x20','\x20\x20\x20Amount\x20difference:\x20','usdtTrcWallet','some','findUnique','fullName','Shop\x20not\x20found','getUserById','üìä\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','InstaXchange','ACTIVE','\x20\x20\x20Gateway:\x20','üéØ\x20[','TrapaPay','createPayout','\x20USDT,\x20Required:\x20','noda','changeAdminPassword','\x20\x20\x20ÔøΩüìä\x20Total\x20payments:\x20','üîÑ\x20Converted\x20gateway\x20name\x20\x27','‚úÖ\x20Using\x20wallet\x20from\x20request:\x20','\x20has\x20zero\x20or\x20null\x20merchant\x20amount,\x20skipping...','Insufficient\x20balance.\x20Available:\x20','‚ö†Ô∏è\x20Gateway\x20\x27','setupAdmin2FA','pendingUrl','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','customerUa','sendPayoutNotification','2FA\x20is\x20already\x20enabled','Amer','not\x20specified','\x20\x20\x20Final\x20payout\x20amount\x20used:\x20','count','30632rDulIg','gatewayOrderId','toUpperCase','yesterday','TrapaPay\x20(','ru-RU','üí∏\x20CHARGEBACK:\x20Processing\x20penalty-only\x20deduction','lte','verify','commissionUSDT','toString','polygon','üîÑ\x20Gateway\x20mapping\x20(create):','üìä\x20Merchant\x20statistics\x20calculated:','üîç\x20Total\x20payments\x20matching\x20filters:\x20','usdtPolygonWallet','get2FASettings','amount','\x20became\x20PAID:','paidOutUSDT','\x20USDT,\x20Requested:\x20','amountUSDT',',\x20userId:\x20','period','twoFactorEnabled','awaitingPayout','\x20status:\x20','\x20USDT\x20(current\x20balance\x20in\x20DB)','wallet','gatewayCommissionRate','getPayoutReports','randomBytes','existsSync','toLowerCase','ADMIN_PASSWORD_HASH=','2232Kqiezb','usdcErcWallet','\x20\x20\x20Amount\x20increased\x20by\x20','üìä\x20Calculated\x20commission\x20rate\x20for\x20payment\x20','amountAfterCommissionUSDT','username','this_week','üìä\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','KLYME\x20GB','log','crypto','\x20\x20\x20Payout\x20amount:\x20','‚úÖ\x20Payout\x20created:\x20','gatewaySettings','totalPayments','passwordHash','CoinToPay','2FA\x20token\x20is\x20required','\x20\x20\x20üí∏\x20Total\x20payouts:\x20','‚úÖ\x20Payout\x20','11WmEiwN','üìä\x20Total\x20payments\x20(including\x20failed):\x20','chargebackAmount','35tlyuNw','reduce',']\x20Gateway\x20settings\x20JSON\x20string:','\x20USDT)','usdtErcWallet','groupBy','üí∞\x20Payment\x20amount\x20is\x20NOT\x20deducted\x20(chargeback\x20penalty\x20only)','üîÑ\x20Gateway\x20mapping:','all','\x27\x20->\x20name\x20\x27','disableAdmin2FA','_count','updatePaymentStatus','values','CoinToPay2','getSystemStatistics','Payout\x20not\x20found','‚ö†Ô∏è\x20Payment\x20','\x20updated\x20successfully','ADMIN_2FA_ENABLED=true','shopId','telegramUsers','createdAt','shopUrl','üîÑ\x20Updating\x20customer\x20data\x20for\x20payment\x20','status','Invalid\x202FA\x20token\x20or\x20backup\x20code','currency','getMerchantsSelection','gte',',\x20successful:\x20','splice','admin','klyme_eu','getTime','setup2FA','customerName','pk_','üìä\x20Payout\x20statistics\x20calculated:','updatePayout','AmPay\x20TRY','averageCommissionRate','push','whiteUrl','thisMonth','COMPLETED','\x27\x20->\x20ID\x20\x27','ceil','$transaction','enableAdmin2FA','pendingPayout','custom_','year','getGatewayDisplayName','../types/gateway','\x20USDT\x20-\x20will\x20deduct\x20from\x20balance','erc20_usdc','üîç\x20Shop\x20wallets:','\x20\x20\x20Total\x20paid\x20out:\x20','üì±\x20Telegram\x20notification\x20sent\x20for\x20payout\x20','559990UKfDWf','\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)','last_month','üîç\x20Using\x20gateway\x20\x27','\x20order','totalPaidOut','telegramId','\x20\x20\x20Amount\x20decreased\x20by\x20','statusChangedBy','getGatewayInternalName','createUser','\x20USDT\x20(after\x20','üìä\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20','random','getGatewayIdByName','periodFrom','txid','set','\x20\x20\x20üí∏\x20Total\x20payouts\x20(all\x20time):\x20','Interac','\x20\x20\x20üë§\x20Merchant\x20earnings:\x20',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','\x20USDT\x20(already\x20paid\x20out)','\x20\x20\x20Shop\x20balance:\x20','\x20USDT\x20(','PENDING','totalTurnover','üí∏\x20CHARGEBACK\x20penalty\x20ONLY:\x20-','warn','üîÑ\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','round','enable2FA','paymentGateways','floor','speakeasy','\x20USDT\x20(-','\x20payments)','generateSecret','asc','\x20merchants','Sepa','config','disable2FA','üìÖ\x20Payout\x20date\x20from\x20filter:\x20','üí∞\x20Updating\x20payout\x20','getFullYear',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','error','‚ö†Ô∏è\x20Requested\x20gateway\x20\x27','üìÖ\x20Payout\x20date\x20to\x20filter:\x20','localeCompare','toLocaleDateString','plisio','Plisio','Insufficient\x20balance\x20for\x20amount\x20increase.\x20Available:\x20','desc','network','üìä\x20Gateway\x20filter\x20applied:','\x20\x20\x20Merchant\x20loses:\x20','2020-01-01','generateDailyStatistics','utf8','totalAmountUSDT','633642OjJiUK','substr','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','from','stringify','length','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','\x20->\x20','convertToUSDT','5466654ORfbAh','split','üéØ\x20updateUser\x20called\x20with\x20ID:\x20','create','üí∞\x20Found\x20','getUTCMonth','last_week','merchantId','\x20backup\x20codes','UTC','üìä\x20Getting\x20payments\x20with\x20filters:','\x27\x20(from\x20\x27','\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)','\x20\x20\x20Full\x20amount:\x20','customerIp','MaxPara','setHours','\x20USDT\x20(rounded\x20to\x202\x20decimal\x20places)','üîë\x20Generated\x20','2GIXGVj','\x20USDT,\x20merchant:\x20','join','\x20\x20\x20ÔøΩ\x20Total\x20paid\x20out:\x20','totp','dailyRevenue','includes','statusChangedAt','bcryptjs','customerEmail','üîç\x20Selected\x20trc20\x20wallet:\x20','toDataURL','klyme_de','deleteUser','\x20USDT\x20(gross\x20revenue)','currencyService','\x20for\x20shop\x20','getDate','writeFileSync','parse',',\x20Commission:\x20','compare','üîê\x20Admin\x20password\x20changed\x20successfully','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','this_month','date','trc20','üìÖ\x20Date\x20from\x20filter:\x20','get','getAllPayments','twoFactorSecret','__esModule','backupCodes','externalPaymentUrl','findMany','polygon_usdc','getAllPayouts','üìÖ\x20Date\x20to\x20filter:\x20','all_time','../config/config','suspendUser','telegram','\x20\x20\x20Transaction\x20hash:\x20','dateFrom','dateTo','üîÑ\x20Converted\x20gateway\x20ID\x20\x27','\x20\x20\x20üè™\x20Gateway\x20earnings:\x20','üîå\x20Gateway:\x20','\x20USDT\x20(same\x20as\x20awaiting)','\x20\x20\x20Current\x20network:\x20','PAID','NONEXISTENT_GATEWAY_FILTER','password','üí∞\x20Shop\x20','insensitive','\x20\x20\x20Balance:\x20','cointopay2','SquirrelPay','üîß\x20[','getPayoutById','üîê\x20Admin\x202FA\x20disabled','totalAmountAfterCommissionUSDT','\x20in\x20','\x20USDT,\x20Difference:\x20','gateways','gatewayEarnings','Noda','updateUser','üìä\x20Merchants\x20with\x20rounded\x20balance\x20!=\x200.00:\x20','üîê\x202FA\x20enabled\x20for\x20shop:\x20','paidAt','availableBalance','path','üìä\x20Getting\x20payout\x20reports\x20with\x20filters:','updateCustomerData','MyXSpend','totalCommissionRate','ADMIN_BACKUP_CODES=','üîê\x20Admin\x202FA\x20setup\x20initiated','üîê\x202FA\x20setup\x20initiated\x20for\x20shop:\x20','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','hash','notes','amountAfterGatewayCommissionUSDT','getMerchantsAwaitingPayout','getUTCFullYear','\x20\x20\x20Available\x20(number):\x20','Error\x20processing\x20payment\x20','625796sZYiyD','\x20balance\x20updated:\x20','cwd','‚ö†Ô∏è\x20CHARGEBACK\x20without\x20penalty\x20amount\x20-\x20no\x20balance\x20change','\x20USDT\x20(theoretical\x20net)','./telegramBotService','readFileSync','paymentsCount','Rapyd','usdcPolygonWallet','payout','cointopay','3753290XOSUvi','üìã\x20Getting\x20merchants\x20selection\x20list...','shop','AdminService','\x20USDT','\x20USDT\x20(total\x20paid\x20to\x20merchants)','\x20\x20\x20üí∞\x20Total\x20turnover:\x20','startsWith','\x20USDT\x20from\x20balance','1952580DTWdHr','USDT','merchantEarningsUSDT','toISOString','balance','%\x20from\x20','otpauth_url','not\x20provided','toFixed','totalAmount','Invalid\x202FA\x20token','TrapaPay\x20Admin\x20(','payment','üîç\x20Initial\x20wallet\x20from\x20request:\x20','_sum','\x20\x20\x20üîç\x20Calculated\x20after\x20commission:\x20','map','wallets','min','\x20merchants\x20with\x20rounded\x20balance\x20!=\x200.00\x20(excluding\x20balances\x20that\x20round\x20to\x200.00)','adminNotes','üìä\x20Statistics\x20PAID\x20payments\x20count:\x20','Payment\x20not\x20found',':\x20commission\x20=\x20','üîÑ\x20Gateway\x20mapping\x20(get):','default','averageCheckUSDT','\x20\x20\x20üìÖ\x20This\x20month:\x20','EXPIRED','–ù–µ\x20—É–∫–∞–∑–∞–Ω','üìÖ\x20Period:\x20','abs','revenue','totalPayout','setUTCDate','üí∞\x20Current\x20shop\x20balance:\x20','üìä\x20Available\x20gateways\x20in\x20database:','OxaPay','üìä\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','base32','\x20\x20\x20Tolerance:\x20','\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...','./currencyService','defineProperty','customerCountry','\x20\x20\x20Requested\x20(number):\x20','üìä\x20Using\x20saved\x20values\x20for\x20payment\x20','commission','7chcogo','MasterCard','orderId','erc20','merchantEarnings','\x20to\x20','üí≥\x20Final\x20payout\x20wallet\x20for\x20','getGatewayNameById','name'];a48_0x38f5=function(){return _0x29d43b;};return a48_0x38f5();}exports[a48_0x332814(0x1df)]=AdminService;