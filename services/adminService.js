'use strict';const a33_0x18713a=a33_0x25bf;function a33_0x5b92(){const _0x1be027=['calculateEffectiveAmount','insensitive','getGatewayNameById','gateway','name','414lJoahJ','sort','‚è≥\x20Awaiting\x20Payout:\x20','commission','convertToUSDT','currencyService','\x20payouts\x20out\x20of\x20','sourceCurrency','üìÖ\x20This\x20Month:\x20','\x20suspended\x20successfully','\x20deleted\x20successfully','log','üí∏\x20Total\x20Payout:\x20','‚úÖ\x20Payment\x20','abs','availableBalance','createdAt','usdtPolygonWallet','createUser','\x20days)','getPeriodDays','üóëÔ∏è\x20Deleting\x20payout:\x20','ceil','getAllUsers','getFullYear','username','üìã\x20Getting\x20users\x20with\x20filters:','üí∞\x20Found\x20','getPayoutStats','slice','usage','\x20payments\x20out\x20of\x20','status','UserService','amount','‚úÖ\x20Payout\x20statistics\x20calculated:','getGatewaySettings','5128QhUJjy','paymentMethod','EXPIRED','toLowerCase','payments','lte','network','statusChangedBy','setDate','toUpperCase','deletePayout','\x20activated\x20successfully',',\x20amount:\x20','round','üìÖ\x20Processing\x20daily\x20stats\x20for\x20','\x20USDT\x20after\x20commission)','date','3663928icZQmL','thisMonth','entries','createPayout','calculateAmountAfterCommission','telegramBotService','\x20total','Failed\x20to\x20send\x20Telegram\x20payout\x20notification:','‚úÖ\x20Activating\x20user:\x20','expiresAt','reduce','Payment\x20not\x20found','desc','$queryRaw','\x20USDT\x20(—Ç–æ–ª—å–∫–æ\x20PAID\x20–ø–ª–∞—Ç–µ–∂–∏)','397036zANvKU','payoutDelay','üí≥\x20Total\x20payments:\x20','totalAmountUSDT','shopId','./userService','create','awaitingPayout','update','telegram','üí∞\x20Available\x20Balance:\x20','charAt','SUSPENDED','get','length','paidAt','completed','remitterIban','map','shop','join','default','generateDateRange','cardLast4','üìä\x20Daily\x20revenue\x20entries:\x20','84210BakLEZ','\x20USDT\x20(penalty\x20amount)','deleteUser','‚úÖ\x20Found\x20payment:\x20','findUnique','totalPayout','usdcPolygonWallet','865ohQWak','üí∏\x20Chargeback\x20amount:\x20','paymentGateways','‚ùå\x20Payout\x20not\x20found:\x20','getSystemStatistics','PROCESSING','split','updateUser','5826nRdHkH','1741650XpXteQ','3585470bYBJXN','‚úÖ\x20User\x20','getMonth','gatewaySettings','orderId','üìã\x20Getting\x20payouts\x20with\x20filters:','90d','error','getMerchantsAwaitingPayout','\x20to\x20','totalAmountAfterCommissionUSDT','remitterName','markPaymentsAsPaidOut','User\x20is\x20already\x20active','üìä\x20Found\x20','\x20USDT','PENDING','\x20payments\x20as\x20paid\x20out','CHARGEBACK','webhookLog','2JVHlKz','‚úÖ\x20Payout\x20','\x20USDT\x20via\x20','isEligibleForPayout','üîÑ\x20Updating\x20payment\x20','customerEmail','gatewayPaymentId','üë•\x20Total\x20users:\x20','usdtTrcWallet','toFixed','publicKey','REFUND','has','count','\x20payments\x20for\x20revenue\x20calculation\x20(PAID/REFUND/CHARGEBACK)','üìã\x20Getting\x20payments\x20with\x20filters:','size','Chargeback\x20amount\x20is\x20required\x20and\x20must\x20be\x20positive\x20(amount\x20in\x20USDT)','\x20USDT\x20(–≤–∫–ª—é—á–∞—è\x20—à—Ç—Ä–∞—Ñ—ã\x20chargeback)','üè™\x20Found\x20','notes','webhookLogs','push','__esModule','merchantPaid','ACTIVE','Payout\x20not\x20found','Invalid\x20status.\x20Valid\x20statuses:\x20','\x20USDT\x20(will\x20be\x20deducted\x20from\x20merchant\x20balance)','getTime','payment','includes','üîç\x20Getting\x20payment\x20by\x20ID:\x20','chargebackAmount','adminNotes','gte','gatewayOrderId','userService','updatePaymentStatus','findMany','üìä\x20Calculating\x20admin\x20payout\x20statistics...','getDate','getPaymentById','AdminService','‚ùå\x20Payment\x20not\x20found:\x20','externalPaymentUrl','__importDefault','getUserById','customerName','Shop\x20not\x20found','updatedAt','../config/database','all','üìã\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','stringify','4037PhzixW','amountUSDT','set','activateUser','shopUrl','parse','FAILED','üí∏\x20Creating\x20payout\x20for\x20shop\x20','COMPLETED','../types/gateway','bankId','PAID','amountAfterCommissionUSDT','Error\x20parsing\x20gateway\x20settings:','üö´\x20Suspending\x20user:\x20','from','currency','‚úÖ\x20Returning\x20','User\x20not\x20found','statusChangedAt','\x20users\x20out\x20of\x20','getAllPayments','payout','txid','üîç\x20Getting\x20payout\x20by\x20ID:\x20'];a33_0x5b92=function(){return _0x1be027;};return a33_0x5b92();}(function(_0x3e5af3,_0x3c4bed){const _0x1a65a5=a33_0x25bf,_0x528511=_0x3e5af3();while(!![]){try{const _0xf14ce3=-parseInt(_0x1a65a5(0x1c3))/0x1*(parseInt(_0x1a65a5(0x129))/0x2)+-parseInt(_0x1a65a5(0x114))/0x3+-parseInt(_0x1a65a5(0x1b4))/0x4+parseInt(_0x1a65a5(0x10b))/0x5*(-parseInt(_0x1a65a5(0x113))/0x6)+-parseInt(_0x1a65a5(0x115))/0x7+parseInt(_0x1a65a5(0x1a3))/0x8*(parseInt(_0x1a65a5(0x17e))/0x9)+-parseInt(_0x1a65a5(0x1dc))/0xa*(-parseInt(_0x1a65a5(0x160))/0xb);if(_0xf14ce3===_0x3c4bed)break;else _0x528511['push'](_0x528511['shift']());}catch(_0x4a2043){_0x528511['push'](_0x528511['shift']());}}}(a33_0x5b92,0x855b8));var __importDefault=this&&this[a33_0x18713a(0x157)]||function(_0x53c4ff){return _0x53c4ff&&_0x53c4ff['__esModule']?_0x53c4ff:{'default':_0x53c4ff};};function a33_0x25bf(_0x1c3aed,_0x5d0fc0){const _0x5b92b8=a33_0x5b92();return a33_0x25bf=function(_0x25bff3,_0xa25ed0){_0x25bff3=_0x25bff3-0x10b;let _0x1fc2f9=_0x5b92b8[_0x25bff3];return _0x1fc2f9;},a33_0x25bf(_0x1c3aed,_0x5d0fc0);}Object['defineProperty'](exports,a33_0x18713a(0x140),{'value':!![]}),exports[a33_0x18713a(0x154)]=void 0x0;const database_1=__importDefault(require(a33_0x18713a(0x15c))),currencyService_1=require('./currencyService'),userService_1=require(a33_0x18713a(0x1c8)),telegramBotService_1=require('./telegramBotService'),gateway_1=require(a33_0x18713a(0x169));class AdminService{constructor(){const _0x1ef8b0=a33_0x18713a;this[_0x1ef8b0(0x14e)]=new userService_1[(_0x1ef8b0(0x19f))]();}[a33_0x18713a(0x192)](_0x2a4a80){const _0x59c843=a33_0x18713a;switch(_0x2a4a80){case'7d':return 0x7;case'30d':return 0x1e;case _0x59c843(0x11b):return 0x5a;case'1y':return 0x16d;default:return 0x1e;}}[a33_0x18713a(0x1d9)](_0x324640,_0x5d93bb){const _0x1c77a5=a33_0x18713a,_0x3b26b7=[],_0xde2524=new Date(_0x324640);while(_0xde2524<=_0x5d93bb){_0x3b26b7[_0x1c77a5(0x13f)](_0xde2524['toISOString']()[_0x1c77a5(0x111)]('T')[0x0]),_0xde2524[_0x1c77a5(0x1ab)](_0xde2524[_0x1c77a5(0x152)]()+0x1);}return _0x3b26b7;}[a33_0x18713a(0x1a2)](_0x1b026e,_0x259766){const _0x473949=a33_0x18713a;if(!_0x1b026e[_0x473949(0x118)])return{'commission':0x0,'payoutDelay':0x0};try{const _0x5c0f9e=JSON[_0x473949(0x165)](_0x1b026e[_0x473949(0x118)]),_0x39c6e3=_0x259766[_0x473949(0x1ce)](0x0)[_0x473949(0x1ac)]()+_0x259766[_0x473949(0x19b)](0x1)[_0x473949(0x1a6)]();if(_0x5c0f9e&&_0x5c0f9e[_0x39c6e3])return{'commission':_0x5c0f9e[_0x39c6e3][_0x473949(0x181)]||0x0,'payoutDelay':_0x5c0f9e[_0x39c6e3][_0x473949(0x1c4)]||0x0};}catch(_0x1ffce9){console[_0x473949(0x11c)](_0x473949(0x16d),_0x1ffce9);}return{'commission':0x0,'payoutDelay':0x0};}[a33_0x18713a(0x12c)](_0x3c016d){const _0xaf77cc=a33_0x18713a;if(_0x3c016d['status']!==_0xaf77cc(0x16b)||_0x3c016d[_0xaf77cc(0x141)]||!_0x3c016d[_0xaf77cc(0x1d2)])return![];const _0x1bb0d2=this['getGatewaySettings'](_0x3c016d[_0xaf77cc(0x1d6)],_0x3c016d[_0xaf77cc(0x17c)]),_0x72a6c5=_0x1bb0d2['payoutDelay']*0x18*0x3c*0x3c*0x3e8,_0x4f6ab9=new Date(_0x3c016d[_0xaf77cc(0x1d2)][_0xaf77cc(0x146)]()+_0x72a6c5);return new Date()>_0x4f6ab9;}['calculateAmountAfterCommission'](_0x494492,_0x4307a7){return _0x494492*(0x1-_0x4307a7/0x64);}[a33_0x18713a(0x179)](_0x359597){const _0x2f1fb3=a33_0x18713a;switch(_0x359597[_0x2f1fb3(0x19e)]){case _0x2f1fb3(0x16b):return _0x359597[_0x2f1fb3(0x1a0)];case _0x2f1fb3(0x127):return-(_0x359597[_0x2f1fb3(0x14a)]||0x0);case _0x2f1fb3(0x134):return 0x0;default:return 0x0;}}async[a33_0x18713a(0x1b7)](_0x2f5ec0){const _0x290832=a33_0x18713a,{shopId:_0x4bf631,amount:_0x1acfa1,network:_0xae1ee3,notes:_0x13e036}=_0x2f5ec0;console[_0x290832(0x189)](_0x290832(0x167)+_0x4bf631+':\x20'+_0x1acfa1+_0x290832(0x12b)+_0xae1ee3);const _0x1b7fa9=await database_1['default'][_0x290832(0x1d6)][_0x290832(0x1e0)]({'where':{'id':_0x4bf631},'select':{'id':!![],'name':!![],'username':!![],'status':!![]}});if(!_0x1b7fa9)throw new Error(_0x290832(0x15a));if(_0x1b7fa9[_0x290832(0x19e)]!==_0x290832(0x142))throw new Error('Shop\x20is\x20not\x20active');const _0x27a082=await database_1['default']['payout'][_0x290832(0x1c9)]({'data':{'shopId':_0x4bf631,'amount':_0x1acfa1,'network':_0xae1ee3,'status':_0x290832(0x168),'notes':_0x13e036||null,'paidAt':new Date()},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});await this[_0x290832(0x121)](_0x4bf631,_0x1acfa1);try{await telegramBotService_1[_0x290832(0x1b9)]['sendPayoutNotification'](_0x4bf631,_0x27a082,_0x290832(0x1d3));}catch(_0x345e67){console[_0x290832(0x11c)](_0x290832(0x1bb),_0x345e67);}return console[_0x290832(0x189)]('‚úÖ\x20Payout\x20created\x20successfully:\x20'+_0x27a082['id']),{'id':_0x27a082['id'],'shopId':_0x27a082['shopId'],'shopName':_0x27a082[_0x290832(0x1d6)]['name'],'shopUsername':_0x27a082[_0x290832(0x1d6)][_0x290832(0x197)],'amount':_0x27a082[_0x290832(0x1a0)],'network':_0x27a082['network'],'status':_0x27a082['status'],'txid':_0x27a082['txid'],'notes':_0x27a082[_0x290832(0x13d)],'createdAt':_0x27a082[_0x290832(0x18e)],'paidAt':_0x27a082['paidAt']};}async['markPaymentsAsPaidOut'](_0x4675c0,_0x352069){const _0x1f5929=a33_0x18713a;console[_0x1f5929(0x189)]('üîÑ\x20Marking\x20payments\x20as\x20paid\x20out\x20for\x20shop\x20'+_0x4675c0+_0x1f5929(0x1af)+_0x352069+_0x1f5929(0x124));const _0x5ad2c9=await database_1[_0x1f5929(0x1d8)]['payment'][_0x1f5929(0x150)]({'where':{'shopId':_0x4675c0,'status':_0x1f5929(0x16b),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'shop':{'select':{'gatewaySettings':!![]}}},'orderBy':{'paidAt':'asc'}});let _0x26962a=_0x352069;const _0x490202=[];for(const _0x53dd0a of _0x5ad2c9){const _0x4fbefe={..._0x53dd0a,'status':_0x1f5929(0x16b),'merchantPaid':![],'shop':{'gatewaySettings':_0x53dd0a[_0x1f5929(0x1d6)][_0x1f5929(0x118)]}};if(!this['isEligibleForPayout'](_0x4fbefe))continue;const _0x350257=await currencyService_1[_0x1f5929(0x183)][_0x1f5929(0x182)](_0x53dd0a[_0x1f5929(0x1a0)],_0x53dd0a[_0x1f5929(0x170)]),_0x318136=this['getGatewaySettings'](_0x53dd0a['shop'],_0x53dd0a[_0x1f5929(0x17c)]),_0x1488e4=this[_0x1f5929(0x1b8)](_0x350257,_0x318136[_0x1f5929(0x181)]);if(_0x1488e4<=_0x26962a){_0x490202['push'](_0x53dd0a['id']),_0x26962a-=_0x1488e4;if(_0x26962a<=0.01)break;}}_0x490202[_0x1f5929(0x1d1)]>0x0&&(await database_1[_0x1f5929(0x1d8)][_0x1f5929(0x147)]['updateMany']({'where':{'id':{'in':_0x490202}},'data':{'merchantPaid':!![]}}),console[_0x1f5929(0x189)]('‚úÖ\x20Marked\x20'+_0x490202[_0x1f5929(0x1d1)]+_0x1f5929(0x126)));}async['getAllPayouts'](_0x52fcf9){const _0x1a319a=a33_0x18713a,{page:_0x622a94,limit:_0x38a08e,shopId:_0x9a8b6c,network:_0x3838b1,dateFrom:_0x25f69d,dateTo:_0x2b71e1,search:_0x4fa5ab}=_0x52fcf9,_0xd3a110=(_0x622a94-0x1)*_0x38a08e;console[_0x1a319a(0x189)](_0x1a319a(0x11a),_0x52fcf9);const _0x1d0c58={};_0x9a8b6c&&(_0x1d0c58[_0x1a319a(0x1c7)]=_0x9a8b6c);_0x3838b1&&(_0x1d0c58[_0x1a319a(0x1a9)]=_0x3838b1);(_0x25f69d||_0x2b71e1)&&(_0x1d0c58['createdAt']={},_0x25f69d&&(_0x1d0c58[_0x1a319a(0x18e)][_0x1a319a(0x14c)]=new Date(_0x25f69d)),_0x2b71e1&&(_0x1d0c58['createdAt']['lte']=new Date(_0x2b71e1)));_0x4fa5ab&&(_0x1d0c58['OR']=[{'txid':{'contains':_0x4fa5ab,'mode':_0x1a319a(0x17a)}},{'notes':{'contains':_0x4fa5ab,'mode':_0x1a319a(0x17a)}},{'shop':{'name':{'contains':_0x4fa5ab,'mode':_0x1a319a(0x17a)}}},{'shop':{'username':{'contains':_0x4fa5ab,'mode':_0x1a319a(0x17a)}}}]);const [_0x406ec1,_0x50c5bf]=await Promise[_0x1a319a(0x15d)]([database_1[_0x1a319a(0x1d8)][_0x1a319a(0x176)][_0x1a319a(0x150)]({'where':_0x1d0c58,'skip':_0xd3a110,'take':_0x38a08e,'orderBy':{'createdAt':_0x1a319a(0x1c0)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x1a319a(0x176)]['count']({'where':_0x1d0c58})]);console['log']('üìä\x20Found\x20'+_0x406ec1['length']+_0x1a319a(0x184)+_0x50c5bf+_0x1a319a(0x1ba));const _0x20f2f3=_0x406ec1[_0x1a319a(0x1d5)](_0x4bd292=>({'id':_0x4bd292['id'],'shopId':_0x4bd292['shopId'],'shopName':_0x4bd292['shop'][_0x1a319a(0x17d)],'shopUsername':_0x4bd292[_0x1a319a(0x1d6)][_0x1a319a(0x197)],'amount':_0x4bd292[_0x1a319a(0x1a0)],'network':_0x4bd292['network'],'status':_0x4bd292[_0x1a319a(0x19e)],'txid':_0x4bd292[_0x1a319a(0x177)],'notes':_0x4bd292['notes'],'createdAt':_0x4bd292['createdAt'],'paidAt':_0x4bd292[_0x1a319a(0x1d2)]}));return{'payouts':_0x20f2f3,'pagination':{'page':_0x622a94,'limit':_0x38a08e,'total':_0x50c5bf,'totalPages':Math[_0x1a319a(0x194)](_0x50c5bf/_0x38a08e)}};}async['getPayoutById'](_0x572aa3){const _0x144fd8=a33_0x18713a;console[_0x144fd8(0x189)](_0x144fd8(0x178)+_0x572aa3);const _0x25b5b7=await database_1['default'][_0x144fd8(0x176)][_0x144fd8(0x1e0)]({'where':{'id':_0x572aa3},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x25b5b7)return console[_0x144fd8(0x189)](_0x144fd8(0x10e)+_0x572aa3),null;return console[_0x144fd8(0x189)]('‚úÖ\x20Found\x20payout:\x20'+_0x25b5b7[_0x144fd8(0x1a0)]+_0x144fd8(0x12b)+_0x25b5b7[_0x144fd8(0x1a9)]),{'id':_0x25b5b7['id'],'shopId':_0x25b5b7['shopId'],'shopName':_0x25b5b7[_0x144fd8(0x1d6)][_0x144fd8(0x17d)],'shopUsername':_0x25b5b7[_0x144fd8(0x1d6)][_0x144fd8(0x197)],'amount':_0x25b5b7[_0x144fd8(0x1a0)],'network':_0x25b5b7['network'],'status':_0x25b5b7['status'],'txid':_0x25b5b7['txid'],'notes':_0x25b5b7['notes'],'createdAt':_0x25b5b7['createdAt'],'paidAt':_0x25b5b7['paidAt']};}async[a33_0x18713a(0x1ad)](_0x3f10f0){const _0xd7eac2=a33_0x18713a;console[_0xd7eac2(0x189)](_0xd7eac2(0x193)+_0x3f10f0);const _0x458fec=await database_1[_0xd7eac2(0x1d8)][_0xd7eac2(0x176)][_0xd7eac2(0x1e0)]({'where':{'id':_0x3f10f0},'select':{'id':!![],'shopId':!![],'amount':!![]}});if(!_0x458fec)throw new Error(_0xd7eac2(0x143));await database_1[_0xd7eac2(0x1d8)][_0xd7eac2(0x176)]['delete']({'where':{'id':_0x3f10f0}}),console[_0xd7eac2(0x189)](_0xd7eac2(0x12a)+_0x3f10f0+_0xd7eac2(0x188));}async[a33_0x18713a(0x11d)](_0x824268){const _0x24ee4d=a33_0x18713a,{page:_0x4fd31b,limit:_0x257c6a,minAmount:_0x17caee,search:_0x1456e3}=_0x824268;console[_0x24ee4d(0x189)](_0x24ee4d(0x15e),_0x824268);const _0x3d21e1=await database_1[_0x24ee4d(0x1d8)][_0x24ee4d(0x147)][_0x24ee4d(0x150)]({'where':{'status':'PAID','merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'createdAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'gatewaySettings':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}});console['log']('üí∞\x20Found\x20'+_0x3d21e1['length']+'\x20eligible\x20PAID\x20payments\x20for\x20payout\x20analysis');const _0x147611=new Map();for(const _0x2a40e2 of _0x3d21e1){const _0x50b07d={..._0x2a40e2,'status':'PAID','merchantPaid':![],'shop':{'gatewaySettings':_0x2a40e2[_0x24ee4d(0x1d6)]['gatewaySettings']}},_0x175595=this[_0x24ee4d(0x12c)](_0x50b07d);if(!_0x175595)continue;const _0x4bc4f9=await currencyService_1[_0x24ee4d(0x183)]['convertToUSDT'](_0x2a40e2[_0x24ee4d(0x1a0)],_0x2a40e2[_0x24ee4d(0x170)]),_0x1540af=this['getGatewaySettings'](_0x2a40e2['shop'],_0x2a40e2[_0x24ee4d(0x17c)]),_0x17072a=this[_0x24ee4d(0x1b8)](_0x4bc4f9,_0x1540af['commission']),_0x1625a6=_0x2a40e2['shopId'];!_0x147611[_0x24ee4d(0x135)](_0x1625a6)&&_0x147611['set'](_0x1625a6,{'shop':_0x2a40e2[_0x24ee4d(0x1d6)],'payments':[]}),_0x147611[_0x24ee4d(0x1d0)](_0x1625a6)[_0x24ee4d(0x1a7)][_0x24ee4d(0x13f)]({'id':_0x2a40e2['id'],'amount':_0x2a40e2[_0x24ee4d(0x1a0)],'currency':_0x2a40e2['currency'],'gateway':_0x2a40e2[_0x24ee4d(0x17c)],'paidAt':_0x2a40e2[_0x24ee4d(0x1d2)],'createdAt':_0x2a40e2[_0x24ee4d(0x18e)],'amountUSDT':_0x4bc4f9,'commission':_0x1540af['commission'],'amountAfterCommissionUSDT':_0x17072a,'isEligible':!![]});}console[_0x24ee4d(0x189)](_0x24ee4d(0x13c)+_0x147611[_0x24ee4d(0x139)]+'\x20merchants\x20with\x20eligible\x20PAID\x20payments');const _0x4d8c5b=[];for(const [_0x3a825e,_0x5700ab]of _0x147611){const {shop:_0x492859,payments:_0x403bf7}=_0x5700ab,_0x136d18=_0x403bf7[_0x24ee4d(0x1be)]((_0x4708f2,_0x3c099c)=>_0x4708f2+_0x3c099c[_0x24ee4d(0x161)],0x0),_0x3bb526=_0x403bf7[_0x24ee4d(0x1be)]((_0x4af8bd,_0x38c618)=>_0x4af8bd+_0x38c618[_0x24ee4d(0x16c)],0x0);if(_0x17caee&&_0x3bb526<_0x17caee)continue;if(_0x1456e3){const _0xf569bd=_0x1456e3[_0x24ee4d(0x1a6)](),_0x31e62b=_0x492859[_0x24ee4d(0x17d)]['toLowerCase']()[_0x24ee4d(0x148)](_0xf569bd)||_0x492859[_0x24ee4d(0x197)][_0x24ee4d(0x1a6)]()[_0x24ee4d(0x148)](_0xf569bd)||_0x492859['telegram']&&_0x492859['telegram'][_0x24ee4d(0x1a6)]()[_0x24ee4d(0x148)](_0xf569bd);if(!_0x31e62b)continue;}const _0x3c0295=new Map();for(const _0x27164a of _0x403bf7){const _0x1c5069=_0x27164a['gateway'];!_0x3c0295['has'](_0x1c5069)&&_0x3c0295[_0x24ee4d(0x162)](_0x1c5069,{'count':0x0,'amountUSDT':0x0,'amountAfterCommissionUSDT':0x0,'commission':_0x27164a[_0x24ee4d(0x181)]});const _0x1f6474=_0x3c0295[_0x24ee4d(0x1d0)](_0x1c5069);_0x1f6474[_0x24ee4d(0x136)]++,_0x1f6474[_0x24ee4d(0x161)]+=_0x27164a[_0x24ee4d(0x161)],_0x1f6474[_0x24ee4d(0x16c)]+=_0x27164a[_0x24ee4d(0x16c)];}const _0x4a850a=Array[_0x24ee4d(0x16f)](_0x3c0295[_0x24ee4d(0x1b6)]())[_0x24ee4d(0x1d5)](([_0x2a89dd,_0x108c01])=>({'gateway':_0x2a89dd[_0x24ee4d(0x1ce)](0x0)['toUpperCase']()+_0x2a89dd[_0x24ee4d(0x19b)](0x1),'count':_0x108c01['count'],'amountUSDT':Math['round'](_0x108c01[_0x24ee4d(0x161)]*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x24ee4d(0x1b0)](_0x108c01[_0x24ee4d(0x16c)]*0x64)/0x64,'commission':_0x108c01['commission']})),_0x11c28b=_0x403bf7[_0x24ee4d(0x1be)]((_0x271c32,_0x350a61)=>{const _0x2de6e0=_0x24ee4d;return _0x350a61[_0x2de6e0(0x1d2)]<_0x271c32?_0x350a61[_0x2de6e0(0x1d2)]:_0x271c32;},_0x403bf7[0x0][_0x24ee4d(0x1d2)]);_0x4d8c5b['push']({'id':_0x492859['id'],'fullName':_0x492859[_0x24ee4d(0x17d)],'username':_0x492859[_0x24ee4d(0x197)],'telegramId':_0x492859[_0x24ee4d(0x1cc)],'merchantUrl':_0x492859[_0x24ee4d(0x164)],'wallets':{'usdtPolygonWallet':_0x492859[_0x24ee4d(0x18f)],'usdtTrcWallet':_0x492859['usdtTrcWallet'],'usdtErcWallet':_0x492859['usdtErcWallet'],'usdcPolygonWallet':_0x492859[_0x24ee4d(0x1e2)]},'totalAmountUSDT':Math['round'](_0x136d18*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x24ee4d(0x1b0)](_0x3bb526*0x64)/0x64,'paymentsCount':_0x403bf7[_0x24ee4d(0x1d1)],'oldestPaymentDate':_0x11c28b,'gatewayBreakdown':_0x4a850a});}_0x4d8c5b[_0x24ee4d(0x17f)]((_0xce54f7,_0x75c5ec)=>_0x75c5ec[_0x24ee4d(0x11f)]-_0xce54f7[_0x24ee4d(0x11f)]);const _0x404fb2=_0x4d8c5b[_0x24ee4d(0x1d1)],_0x5cb1e5=_0x4d8c5b['reduce']((_0x36b4ae,_0x2caeee)=>_0x36b4ae+_0x2caeee[_0x24ee4d(0x1c6)],0x0),_0x370f0a=_0x4d8c5b['reduce']((_0x4f7a72,_0x2ff6c2)=>_0x4f7a72+_0x2ff6c2[_0x24ee4d(0x11f)],0x0),_0x488e1c=(_0x4fd31b-0x1)*_0x257c6a,_0x1f5b93=_0x4d8c5b['slice'](_0x488e1c,_0x488e1c+_0x257c6a);return console['log'](_0x24ee4d(0x171)+_0x1f5b93[_0x24ee4d(0x1d1)]+'\x20merchants\x20out\x20of\x20'+_0x404fb2+_0x24ee4d(0x1ba)),console[_0x24ee4d(0x189)]('üí∞\x20Total\x20amount:\x20'+_0x5cb1e5[_0x24ee4d(0x132)](0x2)+'\x20USDT\x20('+_0x370f0a['toFixed'](0x2)+_0x24ee4d(0x1b2)),{'merchants':_0x1f5b93,'pagination':{'page':_0x4fd31b,'limit':_0x257c6a,'total':_0x404fb2,'totalPages':Math[_0x24ee4d(0x194)](_0x404fb2/_0x257c6a)},'summary':{'totalMerchants':_0x404fb2,'totalAmountUSDT':Math['round'](_0x5cb1e5*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x24ee4d(0x1b0)](_0x370f0a*0x64)/0x64}};}async[a33_0x18713a(0x19a)](){const _0x22c9b7=a33_0x18713a;console[_0x22c9b7(0x189)](_0x22c9b7(0x151));const _0x35d79b=await database_1[_0x22c9b7(0x1d8)][_0x22c9b7(0x147)][_0x22c9b7(0x150)]({'where':{'status':{'in':[_0x22c9b7(0x16b),_0x22c9b7(0x134),_0x22c9b7(0x127)]}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'status':!![],'gateway':!![],'paidAt':!![],'merchantPaid':!![],'createdAt':!![],'chargebackAmount':!![],'shop':{'select':{'gatewaySettings':!![]}}}});console[_0x22c9b7(0x189)](_0x22c9b7(0x199)+_0x35d79b[_0x22c9b7(0x1d1)]+'\x20payments\x20for\x20analysis\x20(PAID/REFUND/CHARGEBACK)');const _0x572f6b=new Date(),_0x4a18c5=new Date(_0x572f6b['getFullYear'](),_0x572f6b[_0x22c9b7(0x117)](),0x1),_0x518b98=new Date(_0x572f6b[_0x22c9b7(0x196)](),_0x572f6b[_0x22c9b7(0x117)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7);let _0x4627b3=0x0,_0x11cf4c=0x0,_0x2c2f63=0x0,_0x52cd40=0x0;for(const _0x2edb6c of _0x35d79b){const _0x649a71=this[_0x22c9b7(0x179)](_0x2edb6c);if(_0x649a71===0x0)continue;let _0x4c2d3a,_0x594b83;if(_0x2edb6c[_0x22c9b7(0x19e)]===_0x22c9b7(0x127))_0x4c2d3a=Math[_0x22c9b7(0x18c)](_0x649a71),_0x594b83=-_0x4c2d3a;else{_0x4c2d3a=await currencyService_1[_0x22c9b7(0x183)][_0x22c9b7(0x182)](_0x2edb6c['amount'],_0x2edb6c[_0x22c9b7(0x170)]);const _0x4519f6=this['getGatewaySettings'](_0x2edb6c[_0x22c9b7(0x1d6)],_0x2edb6c[_0x22c9b7(0x17c)]);_0x594b83=this[_0x22c9b7(0x1b8)](_0x4c2d3a,_0x4519f6[_0x22c9b7(0x181)]);}_0x2edb6c[_0x22c9b7(0x141)]&&(_0x4627b3+=_0x594b83,_0x2edb6c[_0x22c9b7(0x1d2)]&&_0x2edb6c[_0x22c9b7(0x1d2)]>=_0x4a18c5&&_0x2edb6c[_0x22c9b7(0x1d2)]<=_0x518b98&&(_0x2c2f63+=_0x594b83)),_0x2edb6c[_0x22c9b7(0x19e)]===_0x22c9b7(0x16b)&&this[_0x22c9b7(0x12c)](_0x2edb6c)&&(_0x11cf4c+=_0x594b83,_0x52cd40+=_0x4c2d3a);}const _0x49b9fa={'totalPayout':Math['round'](_0x4627b3*0x64)/0x64,'awaitingPayout':Math['round'](_0x11cf4c*0x64)/0x64,'thisMonth':Math['round'](_0x2c2f63*0x64)/0x64,'availableBalance':Math[_0x22c9b7(0x1b0)](_0x52cd40*0x64)/0x64};return console['log'](_0x22c9b7(0x1a1)),console[_0x22c9b7(0x189)](_0x22c9b7(0x18a)+_0x49b9fa[_0x22c9b7(0x1e1)]+_0x22c9b7(0x13b)),console[_0x22c9b7(0x189)](_0x22c9b7(0x180)+_0x49b9fa[_0x22c9b7(0x1ca)]+_0x22c9b7(0x1c2)),console[_0x22c9b7(0x189)](_0x22c9b7(0x186)+_0x49b9fa[_0x22c9b7(0x1b5)]+'\x20USDT'),console['log'](_0x22c9b7(0x1cd)+_0x49b9fa[_0x22c9b7(0x18d)]+_0x22c9b7(0x124)),_0x49b9fa;}async[a33_0x18713a(0x10f)](_0x27e5c6){const _0x186810=a33_0x18713a,_0x338cde=this[_0x186810(0x192)](_0x27e5c6),_0x3c9a7d=new Date();_0x3c9a7d[_0x186810(0x1ab)](_0x3c9a7d[_0x186810(0x152)]()-_0x338cde),console['log']('üìä\x20Generating\x20admin\x20statistics\x20for\x20period:\x20'+_0x27e5c6+'\x20('+_0x338cde+_0x186810(0x191));const _0xf96d10=await database_1[_0x186810(0x1d8)]['shop'][_0x186810(0x136)]({'where':{'status':_0x186810(0x142)}}),_0x28aa9b=await database_1[_0x186810(0x1d8)][_0x186810(0x147)][_0x186810(0x136)](),_0x2b5f82=await database_1[_0x186810(0x1d8)][_0x186810(0x147)][_0x186810(0x150)]({'where':{'status':{'in':[_0x186810(0x16b),'REFUND','CHARGEBACK']}},'select':{'amount':!![],'currency':!![],'status':!![],'chargebackAmount':!![],'createdAt':!![]}});console[_0x186810(0x189)]('üí∞\x20Found\x20'+_0x2b5f82[_0x186810(0x1d1)]+_0x186810(0x137));const _0x2586c2=await Promise[_0x186810(0x15d)](_0x2b5f82[_0x186810(0x1d5)](async _0x1b136f=>{const _0x284e54=_0x186810,_0x5670c5=this[_0x284e54(0x179)](_0x1b136f);if(_0x5670c5===0x0)return{'amount':0x0,'createdAt':_0x1b136f[_0x284e54(0x18e)]};let _0x2619c0;return _0x1b136f[_0x284e54(0x19e)]==='CHARGEBACK'?_0x2619c0=-Math[_0x284e54(0x18c)](_0x5670c5):_0x2619c0=await currencyService_1[_0x284e54(0x183)][_0x284e54(0x182)](_0x1b136f[_0x284e54(0x1a0)],_0x1b136f[_0x284e54(0x170)]),{'amount':_0x2619c0,'createdAt':_0x1b136f['createdAt']};})),_0xeb5962=_0x2586c2[_0x186810(0x1be)]((_0x4fdf50,_0x4afff3)=>_0x4fdf50+_0x4afff3[_0x186810(0x1a0)],0x0),_0xb0baca=_0x28aa9b>0x0?_0xeb5962/_0x28aa9b:0x0;console[_0x186810(0x189)]('üíµ\x20Total\x20revenue:\x20'+_0xeb5962[_0x186810(0x132)](0x2)+_0x186810(0x13b)),console[_0x186810(0x189)]('üìà\x20Average\x20payment:\x20'+_0xb0baca[_0x186810(0x132)](0x2)+_0x186810(0x124));const _0x31545b=await database_1[_0x186810(0x1d8)][_0x186810(0x1c1)]`
      SELECT 
        DATE(created_at) as date,
        array_agg(
          json_build_object(
            'amount', amount,
            'currency', currency,
            'status', status,
            'chargeback_amount', chargeback_amount
          )
        ) as payments
      FROM payments 
      WHERE created_at >= ${_0x3c9a7d}
        AND status IN ('PAID', 'REFUND', 'CHARGEBACK')
      GROUP BY DATE(created_at)
      ORDER BY date ASC
    `;console[_0x186810(0x189)](_0x186810(0x1b1)+_0x31545b[_0x186810(0x1d1)]+'\x20days');const _0x3e71b8=await Promise[_0x186810(0x15d)](_0x31545b[_0x186810(0x1d5)](async _0x2341d3=>{const _0xdb6f0f=_0x186810,_0x38ed51=await Promise[_0xdb6f0f(0x15d)](_0x2341d3['payments'][_0xdb6f0f(0x1d5)](async _0x5beddc=>{const _0xb4f2e5=_0xdb6f0f,_0x4369f2=this['calculateEffectiveAmount'](_0x5beddc);if(_0x4369f2===0x0)return 0x0;return _0x5beddc['status']===_0xb4f2e5(0x127)?-Math['abs'](_0x4369f2):await currencyService_1[_0xb4f2e5(0x183)][_0xb4f2e5(0x182)](_0x5beddc[_0xb4f2e5(0x1a0)],_0x5beddc[_0xb4f2e5(0x170)]);})),_0x73cb32=_0x38ed51[_0xdb6f0f(0x1be)]((_0x5c04b4,_0x455367)=>_0x5c04b4+_0x455367,0x0);return{'date':_0x2341d3[_0xdb6f0f(0x1b3)]['toISOString']()[_0xdb6f0f(0x111)]('T')[0x0],'amount':_0x73cb32};})),_0x4710f4=this['generateDateRange'](_0x3c9a7d,new Date()),_0x4c663b=new Map(_0x3e71b8[_0x186810(0x1d5)](_0x23e300=>[_0x23e300[_0x186810(0x1b3)],_0x23e300[_0x186810(0x1a0)]])),_0x448589=_0x4710f4[_0x186810(0x1d5)](_0x54e656=>({'date':_0x54e656,'amount':_0x4c663b[_0x186810(0x1d0)](_0x54e656)||0x0}));return console[_0x186810(0x189)]('‚úÖ\x20Admin\x20statistics\x20generated\x20successfully'),console[_0x186810(0x189)](_0x186810(0x130)+_0xf96d10),console[_0x186810(0x189)](_0x186810(0x1c5)+_0x28aa9b),console['log'](_0x186810(0x1db)+_0x448589['length']),{'totalRevenue':Math['round'](_0xeb5962*0x64)/0x64,'totalUsers':_0xf96d10,'totalPayments':_0x28aa9b,'averagePayment':Math[_0x186810(0x1b0)](_0xb0baca*0x64)/0x64,'dailyRevenue':_0x448589};}async[a33_0x18713a(0x175)](_0xd70198){const _0x278ac0=a33_0x18713a,{page:_0x48b1ed,limit:_0x474655,status:_0x3cbf97,gateway:_0x1e0722,shopId:_0x216330,dateFrom:_0x4a9011,dateTo:_0x411610,search:_0x4f2e79}=_0xd70198,_0x321668=(_0x48b1ed-0x1)*_0x474655;console[_0x278ac0(0x189)](_0x278ac0(0x138),_0xd70198);const _0x2d7a31={};_0x3cbf97&&(_0x2d7a31[_0x278ac0(0x19e)]=_0x3cbf97['toUpperCase']());if(_0x1e0722){if((0x0,gateway_1['isValidGatewayId'])(_0x1e0722)){const _0x168f37=(0x0,gateway_1[_0x278ac0(0x17b)])(_0x1e0722);_0x168f37&&(_0x2d7a31[_0x278ac0(0x17c)]=_0x168f37);}else _0x2d7a31[_0x278ac0(0x17c)]=_0x1e0722[_0x278ac0(0x1a6)]();}_0x216330&&(_0x2d7a31[_0x278ac0(0x1c7)]=_0x216330);(_0x4a9011||_0x411610)&&(_0x2d7a31[_0x278ac0(0x18e)]={},_0x4a9011&&(_0x2d7a31['createdAt'][_0x278ac0(0x14c)]=new Date(_0x4a9011)),_0x411610&&(_0x2d7a31[_0x278ac0(0x18e)][_0x278ac0(0x1a8)]=new Date(_0x411610)));_0x4f2e79&&(_0x2d7a31['OR']=[{'orderId':{'contains':_0x4f2e79,'mode':_0x278ac0(0x17a)}},{'gatewayOrderId':{'contains':_0x4f2e79,'mode':_0x278ac0(0x17a)}},{'gatewayPaymentId':{'contains':_0x4f2e79,'mode':_0x278ac0(0x17a)}},{'customerEmail':{'contains':_0x4f2e79,'mode':_0x278ac0(0x17a)}},{'customerName':{'contains':_0x4f2e79,'mode':'insensitive'}},{'shop':{'name':{'contains':_0x4f2e79,'mode':_0x278ac0(0x17a)}}},{'shop':{'username':{'contains':_0x4f2e79,'mode':_0x278ac0(0x17a)}}}]);const [_0x13836d,_0x35c36f]=await Promise[_0x278ac0(0x15d)]([database_1[_0x278ac0(0x1d8)][_0x278ac0(0x147)]['findMany']({'where':_0x2d7a31,'skip':_0x321668,'take':_0x474655,'orderBy':{'createdAt':_0x278ac0(0x1c0)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default']['payment']['count']({'where':_0x2d7a31})]);console[_0x278ac0(0x189)](_0x278ac0(0x123)+_0x13836d[_0x278ac0(0x1d1)]+_0x278ac0(0x19d)+_0x35c36f+_0x278ac0(0x1ba));const _0x16d446=_0x13836d[_0x278ac0(0x1d5)](_0x5e4837=>({'id':_0x5e4837['id'],'shopId':_0x5e4837[_0x278ac0(0x1c7)],'shopName':_0x5e4837[_0x278ac0(0x1d6)][_0x278ac0(0x17d)],'shopUsername':_0x5e4837[_0x278ac0(0x1d6)][_0x278ac0(0x197)],'gateway':_0x5e4837[_0x278ac0(0x17c)],'orderId':_0x5e4837[_0x278ac0(0x119)],'gatewayOrderId':_0x5e4837[_0x278ac0(0x14d)],'amount':_0x5e4837['amount'],'currency':_0x5e4837[_0x278ac0(0x170)],'sourceCurrency':_0x5e4837[_0x278ac0(0x185)],'status':_0x5e4837[_0x278ac0(0x19e)],'usage':_0x5e4837['usage'],'externalPaymentUrl':_0x5e4837[_0x278ac0(0x156)],'gatewayPaymentId':_0x5e4837['gatewayPaymentId'],'customerEmail':_0x5e4837[_0x278ac0(0x12e)],'customerName':_0x5e4837[_0x278ac0(0x159)],'cardLast4':_0x5e4837[_0x278ac0(0x1da)],'paymentMethod':_0x5e4837[_0x278ac0(0x1a4)],'bankId':_0x5e4837[_0x278ac0(0x16a)],'remitterIban':_0x5e4837[_0x278ac0(0x1d4)],'remitterName':_0x5e4837[_0x278ac0(0x120)],'chargebackAmount':_0x5e4837[_0x278ac0(0x14a)],'adminNotes':_0x5e4837[_0x278ac0(0x14b)],'statusChangedBy':_0x5e4837['statusChangedBy'],'statusChangedAt':_0x5e4837[_0x278ac0(0x173)],'createdAt':_0x5e4837[_0x278ac0(0x18e)],'updatedAt':_0x5e4837[_0x278ac0(0x15b)],'expiresAt':_0x5e4837[_0x278ac0(0x1bd)]}));return{'payments':_0x16d446,'pagination':{'page':_0x48b1ed,'limit':_0x474655,'total':_0x35c36f,'totalPages':Math['ceil'](_0x35c36f/_0x474655)}};}async[a33_0x18713a(0x153)](_0x3dd45f){const _0x2019ef=a33_0x18713a;console[_0x2019ef(0x189)](_0x2019ef(0x149)+_0x3dd45f);const _0xc0fda2=await database_1[_0x2019ef(0x1d8)]['payment'][_0x2019ef(0x1e0)]({'where':{'id':_0x3dd45f},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}},'webhookLogs':{'orderBy':{'createdAt':'desc'},'take':0xa,'select':{'id':!![],'event':!![],'statusCode':!![],'retryCount':!![],'createdAt':!![]}}}});if(!_0xc0fda2)return console['log'](_0x2019ef(0x155)+_0x3dd45f),null;return console['log'](_0x2019ef(0x1df)+_0xc0fda2[_0x2019ef(0x119)]+'\x20('+_0xc0fda2[_0x2019ef(0x19e)]+')'),{'id':_0xc0fda2['id'],'shopId':_0xc0fda2['shopId'],'shopName':_0xc0fda2['shop']['name'],'shopUsername':_0xc0fda2[_0x2019ef(0x1d6)][_0x2019ef(0x197)],'gateway':_0xc0fda2[_0x2019ef(0x17c)],'orderId':_0xc0fda2[_0x2019ef(0x119)],'gatewayOrderId':_0xc0fda2['gatewayOrderId'],'amount':_0xc0fda2[_0x2019ef(0x1a0)],'currency':_0xc0fda2[_0x2019ef(0x170)],'sourceCurrency':_0xc0fda2[_0x2019ef(0x185)],'status':_0xc0fda2[_0x2019ef(0x19e)],'usage':_0xc0fda2[_0x2019ef(0x19c)],'externalPaymentUrl':_0xc0fda2[_0x2019ef(0x156)],'gatewayPaymentId':_0xc0fda2['gatewayPaymentId'],'customerEmail':_0xc0fda2[_0x2019ef(0x12e)],'customerName':_0xc0fda2[_0x2019ef(0x159)],'cardLast4':_0xc0fda2['cardLast4'],'paymentMethod':_0xc0fda2[_0x2019ef(0x1a4)],'bankId':_0xc0fda2[_0x2019ef(0x16a)],'remitterIban':_0xc0fda2[_0x2019ef(0x1d4)],'remitterName':_0xc0fda2[_0x2019ef(0x120)],'chargebackAmount':_0xc0fda2[_0x2019ef(0x14a)],'adminNotes':_0xc0fda2[_0x2019ef(0x14b)],'statusChangedBy':_0xc0fda2['statusChangedBy'],'statusChangedAt':_0xc0fda2[_0x2019ef(0x173)],'createdAt':_0xc0fda2['createdAt'],'updatedAt':_0xc0fda2[_0x2019ef(0x15b)],'expiresAt':_0xc0fda2[_0x2019ef(0x1bd)],'webhookLogs':_0xc0fda2[_0x2019ef(0x13e)]};}async[a33_0x18713a(0x14f)](_0x1ede35,_0x3fef67,_0x5e0305,_0x10a91a){const _0x1807a7=a33_0x18713a;console[_0x1807a7(0x189)](_0x1807a7(0x12d)+_0x1ede35+'\x20status\x20to:\x20'+_0x3fef67);const _0x124ee0=[_0x1807a7(0x125),_0x1807a7(0x110),_0x1807a7(0x16b),_0x1807a7(0x1a5),_0x1807a7(0x166),_0x1807a7(0x134),'CHARGEBACK'];if(!_0x124ee0[_0x1807a7(0x148)](_0x3fef67[_0x1807a7(0x1ac)]()))throw new Error(_0x1807a7(0x144)+_0x124ee0[_0x1807a7(0x1d7)](',\x20'));const _0x2ba312=await database_1[_0x1807a7(0x1d8)][_0x1807a7(0x147)][_0x1807a7(0x1e0)]({'where':{'id':_0x1ede35},'select':{'id':!![],'status':!![],'orderId':!![]}});if(!_0x2ba312)throw new Error(_0x1807a7(0x1bf));if(_0x3fef67['toUpperCase']()===_0x1807a7(0x127)){if(!_0x10a91a||_0x10a91a<=0x0)throw new Error(_0x1807a7(0x13a));console[_0x1807a7(0x189)](_0x1807a7(0x10c)+_0x10a91a+_0x1807a7(0x1dd));}const _0x7a4027={'status':_0x3fef67[_0x1807a7(0x1ac)](),'updatedAt':new Date()};_0x5e0305&&(_0x7a4027['adminNotes']=_0x5e0305);_0x3fef67[_0x1807a7(0x1ac)]()===_0x1807a7(0x127)&&_0x10a91a&&(_0x7a4027['chargebackAmount']=_0x10a91a);const _0x2feb50=await database_1['default'][_0x1807a7(0x147)][_0x1807a7(0x1cb)]({'where':{'id':_0x1ede35},'data':_0x7a4027,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});return await database_1[_0x1807a7(0x1d8)][_0x1807a7(0x128)]['create']({'data':{'paymentId':_0x1ede35,'shopId':_0x2feb50[_0x1807a7(0x1c7)],'event':'status_update','statusCode':0xc8,'responseBody':JSON[_0x1807a7(0x15f)]({'oldStatus':_0x2ba312[_0x1807a7(0x19e)],'newStatus':_0x3fef67[_0x1807a7(0x1ac)](),'notes':_0x5e0305||null,'chargebackAmount':_0x10a91a||null,'timestamp':new Date()['toISOString']()})}}),console[_0x1807a7(0x189)](_0x1807a7(0x18b)+_0x2ba312['orderId']+'\x20status\x20updated\x20from\x20'+_0x2ba312[_0x1807a7(0x19e)]+_0x1807a7(0x11e)+_0x3fef67[_0x1807a7(0x1ac)]()),_0x3fef67[_0x1807a7(0x1ac)]()===_0x1807a7(0x127)&&console[_0x1807a7(0x189)]('üí∏\x20Chargeback\x20penalty:\x20'+_0x10a91a+_0x1807a7(0x145)),{'id':_0x2feb50['id'],'shopId':_0x2feb50[_0x1807a7(0x1c7)],'shopName':_0x2feb50['shop'][_0x1807a7(0x17d)],'shopUsername':_0x2feb50['shop'][_0x1807a7(0x197)],'gateway':_0x2feb50[_0x1807a7(0x17c)],'orderId':_0x2feb50['orderId'],'gatewayOrderId':_0x2feb50[_0x1807a7(0x14d)],'amount':_0x2feb50[_0x1807a7(0x1a0)],'currency':_0x2feb50[_0x1807a7(0x170)],'sourceCurrency':_0x2feb50[_0x1807a7(0x185)],'status':_0x2feb50[_0x1807a7(0x19e)],'usage':_0x2feb50[_0x1807a7(0x19c)],'externalPaymentUrl':_0x2feb50['externalPaymentUrl'],'gatewayPaymentId':_0x2feb50[_0x1807a7(0x12f)],'customerEmail':_0x2feb50[_0x1807a7(0x12e)],'customerName':_0x2feb50['customerName'],'cardLast4':_0x2feb50['cardLast4'],'paymentMethod':_0x2feb50['paymentMethod'],'bankId':_0x2feb50[_0x1807a7(0x16a)],'remitterIban':_0x2feb50['remitterIban'],'remitterName':_0x2feb50[_0x1807a7(0x120)],'chargebackAmount':_0x2feb50[_0x1807a7(0x14a)],'adminNotes':_0x2feb50[_0x1807a7(0x14b)],'statusChangedBy':_0x2feb50[_0x1807a7(0x1aa)],'statusChangedAt':_0x2feb50[_0x1807a7(0x173)],'createdAt':_0x2feb50['createdAt'],'updatedAt':_0x2feb50['updatedAt'],'expiresAt':_0x2feb50[_0x1807a7(0x1bd)]};}async[a33_0x18713a(0x195)](_0x49d133){const _0x47f826=a33_0x18713a,{page:_0x23c0e6,limit:_0x21d23f,status:_0xba637e}=_0x49d133,_0x15b9f3=(_0x23c0e6-0x1)*_0x21d23f,_0x13a71c={};_0xba637e&&(_0x13a71c['status']=_0xba637e['toUpperCase']());console['log'](_0x47f826(0x198),{'page':_0x23c0e6,'limit':_0x21d23f,'status':_0xba637e,'where':_0x13a71c});const [_0x4f233d,_0x193862]=await Promise[_0x47f826(0x15d)]([database_1[_0x47f826(0x1d8)][_0x47f826(0x1d6)][_0x47f826(0x150)]({'where':_0x13a71c,'skip':_0x15b9f3,'take':_0x21d23f,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':'desc'}}),database_1[_0x47f826(0x1d8)][_0x47f826(0x1d6)][_0x47f826(0x136)]({'where':_0x13a71c})]);console[_0x47f826(0x189)](_0x47f826(0x123)+_0x4f233d['length']+_0x47f826(0x174)+_0x193862+_0x47f826(0x1ba));const _0x564241=_0x4f233d[_0x47f826(0x1d5)](_0x19f201=>({'id':_0x19f201['id'],'fullName':_0x19f201['name'],'username':_0x19f201[_0x47f826(0x197)],'telegramId':_0x19f201['telegram'],'merchantUrl':_0x19f201['shopUrl'],'gateways':_0x19f201[_0x47f826(0x10d)]?JSON[_0x47f826(0x165)](_0x19f201[_0x47f826(0x10d)]):null,'gatewaySettings':_0x19f201[_0x47f826(0x118)]?JSON[_0x47f826(0x165)](_0x19f201['gatewaySettings']):null,'publicKey':_0x19f201[_0x47f826(0x133)],'wallets':{'usdtPolygonWallet':_0x19f201[_0x47f826(0x18f)],'usdtTrcWallet':_0x19f201[_0x47f826(0x131)],'usdtErcWallet':_0x19f201['usdtErcWallet'],'usdcPolygonWallet':_0x19f201['usdcPolygonWallet']},'status':_0x19f201['status'],'createdAt':_0x19f201[_0x47f826(0x18e)]}));return{'users':_0x564241,'pagination':{'page':_0x23c0e6,'limit':_0x21d23f,'total':_0x193862,'totalPages':Math['ceil'](_0x193862/_0x21d23f)}};}async[a33_0x18713a(0x158)](_0x46e464){const _0x5b2c52=a33_0x18713a;return await this[_0x5b2c52(0x14e)]['getUserById'](_0x46e464);}async[a33_0x18713a(0x190)](_0x99085d){const _0x1a70d6=a33_0x18713a;return await this[_0x1a70d6(0x14e)][_0x1a70d6(0x190)](_0x99085d);}async[a33_0x18713a(0x112)](_0x289e11,_0x183d10){const _0x268c91=a33_0x18713a;return await this[_0x268c91(0x14e)][_0x268c91(0x112)](_0x289e11,_0x183d10);}async['deleteUser'](_0x1b3880){const _0x174737=a33_0x18713a;return await this[_0x174737(0x14e)][_0x174737(0x1de)](_0x1b3880);}async['suspendUser'](_0xecd567){const _0x1ec64e=a33_0x18713a;console[_0x1ec64e(0x189)](_0x1ec64e(0x16e)+_0xecd567);const _0x3f0807=await database_1[_0x1ec64e(0x1d8)][_0x1ec64e(0x1d6)][_0x1ec64e(0x1e0)]({'where':{'id':_0xecd567},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x3f0807)throw new Error(_0x1ec64e(0x172));if(_0x3f0807[_0x1ec64e(0x19e)]==='SUSPENDED')throw new Error('User\x20is\x20already\x20suspended');const _0x5c1954=await this['userService']['updateUser'](_0xecd567,{'status':_0x1ec64e(0x1cf)});return console['log'](_0x1ec64e(0x116)+_0x3f0807[_0x1ec64e(0x197)]+_0x1ec64e(0x187)),_0x5c1954;}async[a33_0x18713a(0x163)](_0x4aa0e7){const _0x215f86=a33_0x18713a;console[_0x215f86(0x189)](_0x215f86(0x1bc)+_0x4aa0e7);const _0x201d6c=await database_1[_0x215f86(0x1d8)]['shop'][_0x215f86(0x1e0)]({'where':{'id':_0x4aa0e7},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x201d6c)throw new Error(_0x215f86(0x172));if(_0x201d6c[_0x215f86(0x19e)]===_0x215f86(0x142))throw new Error(_0x215f86(0x122));const _0x312ddf=await this['userService'][_0x215f86(0x112)](_0x4aa0e7,{'status':'ACTIVE'});return console['log'](_0x215f86(0x116)+_0x201d6c[_0x215f86(0x197)]+_0x215f86(0x1ae)),_0x312ddf;}}exports[a33_0x18713a(0x154)]=AdminService;