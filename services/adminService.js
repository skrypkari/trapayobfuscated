'use strict';const a35_0x1e45b9=a35_0x1edf;(function(_0x25a5eb,_0x6bc69f){const _0x299371=a35_0x1edf,_0x40e787=_0x25a5eb();while(!![]){try{const _0x3d8125=-parseInt(_0x299371(0x162))/0x1+parseInt(_0x299371(0x1e0))/0x2+-parseInt(_0x299371(0x1c7))/0x3+parseInt(_0x299371(0x248))/0x4+parseInt(_0x299371(0x1a4))/0x5*(parseInt(_0x299371(0x1b3))/0x6)+parseInt(_0x299371(0x1cf))/0x7*(parseInt(_0x299371(0x1a5))/0x8)+-parseInt(_0x299371(0x1d9))/0x9;if(_0x3d8125===_0x6bc69f)break;else _0x40e787['push'](_0x40e787['shift']());}catch(_0x218767){_0x40e787['push'](_0x40e787['shift']());}}}(a35_0x1d90,0xbc52e));function a35_0x1edf(_0x4861b0,_0x293d44){const _0x1d90e8=a35_0x1d90();return a35_0x1edf=function(_0x1edfe1,_0x183e11){_0x1edfe1=_0x1edfe1-0x15c;let _0xeb3e5c=_0x1d90e8[_0x1edfe1];return _0xeb3e5c;},a35_0x1edf(_0x4861b0,_0x293d44);}var __importDefault=this&&this['__importDefault']||function(_0x42c31b){const _0x578abf=a35_0x1edf;return _0x42c31b&&_0x42c31b[_0x578abf(0x164)]?_0x42c31b:{'default':_0x42c31b};};Object[a35_0x1e45b9(0x26a)](exports,'__esModule',{'value':!![]}),exports['AdminService']=void 0x0;const database_1=__importDefault(require(a35_0x1e45b9(0x1e8))),bcryptjs_1=__importDefault(require(a35_0x1e45b9(0x24e))),crypto_1=__importDefault(require(a35_0x1e45b9(0x230))),currencyService_1=require('./currencyService'),gateway_1=require(a35_0x1e45b9(0x19d));function a35_0x1d90(){const _0x328e41=['1403754KYfHFP','üìä\x20Merchant\x20statistics\x20calculated:','customerEmail','orderId','toFixed','split','üìä\x20Calculating\x20payout\x20statistics...','currencyService','../config/database','wallet','ACTIVE','üí∞\x20Payment\x20','üí∞\x20Current\x20shop\x20balance:\x20','gte','üìä\x20Payout\x20statistics\x20calculated:','\x20balance\x20updated:','paidAt','\x20\x20\x20Balance:\x20','\x20\x20\x20Total\x20paid\x20out:\x20','\x20\x20\x20üíµ\x20Available\x20balance:\x20','Noda','totalAmountAfterCommissionUSDT','trc20',':\x20commission\x20=\x20','revenue','2020-01-01','‚ö†Ô∏è\x20Requested\x20gateway\x20\x27','not\x20specified','\x20\x20\x20Actual\x20balance\x20from\x20DB:\x20','üìÖ\x20Period\x20\x27all\x27:\x20Using\x20start\x20date\x20from\x20first\x20payment:\x20','customerIp','customerUa','get','dailyRevenue','txid','\x20\x20\x20Payout\x20amount:\x20','periodTo','hash','üí±\x20Currency\x20filter\x20applied:\x20','hex','\x20USDT,\x20Requested:\x20','statusChangedBy','create','\x20\x20\x20üí∞\x20Total\x20turnover:\x20','\x20\x20\x20üí∞\x20Total\x20payout:\x20','30d','‚úÖ\x20Customer\x20data\x20updated\x20for\x20payment\x20','\x27\x20->\x20ID\x20\x27','totalPayments','dateTo','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','\x20\x20\x20üìä\x20Commission\x20difference:\x20','all','balance','week','\x27\x20->\x20name\x20\x27','failureMessage','activateUser','totalPaidOut','Plisio','insensitive','\x27\x20not\x20found.\x20Available\x20gateways:\x20','join','amountUSDT','findMany','\x20\x20\x20üè™\x20Gateway\x20earnings:\x20','paymentGateways','toLowerCase','gateways','set','usdcPolygonWallet','‚úÖ\x20Using\x20gateway\x20filter:\x20\x27','usdtTrcWallet','Telegram\x20username\x20already\x20exists','customerCountry','sort','\x20active\x20merchants\x20for\x20selection','groupBy','getMerchantStatistics','CoinToPay','crypto','Username\x20already\x20exists','log','not\x20set','\x20merchants\x20with\x20positive\x20balance','month','\x20\x20\x20üìä\x20Total\x20payments:\x20','\x27\x20(from\x20\x27','statusChangedAt','usdtErcWallet','createdAt','merchantEarnings','üí∞\x20Found\x20','summary','gateway','values','Rapyd','\x20in\x20','\x20no\x20longer\x20PAID:\x20-','‚ö†Ô∏è\x20Gateway\x20\x27','\x20to\x20','currency','\x20USDT\x20(with\x20commission\x20deducted)','üìã\x20Found\x20','4129440ZBGevU','commission','\x20\x20\x20üìÖ\x20This\x20month:\x20','COMPLETED','fullName','gatewaySettings','bcryptjs','push','\x20USDT\x20(total\x20paid\x20to\x20merchants)','telegramId','payment','erc20','üí∞\x20[PAYOUT]\x20Gateway\x20','username','\x20USDT\x20from\x20balance','setDate','totalPayout','üîÑ\x20Converted\x20gateway\x20name\x20\x27','dateFrom','PAID','forEach','üìä\x20Getting\x20merchant\x20statistics\x20with\x20filters:','üìä\x20Getting\x20payments\x20with\x20filters:','CHARGEBACK','getMonth','\x20USDT\x20(after\x20payouts)','üìä\x20Final\x20WHERE\x20conditions:','\x20\x20\x20üë§\x20Merchant\x20earnings:\x20','Insufficient\x20balance.\x20Available:\x20','thisMonth','chargebackAmount','telegram','date','parse','defineProperty','ceil','successUrl','KLYME\x20DE','error','Payment\x20not\x20found','üîÑ\x20Converted\x20gateway\x20ID\x20\x27','getUserById','notes','localeCompare','924422TUEIMa','\x20USDT\x20(-','__esModule','map','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','convertToUSDT','üîÑ\x20Updating\x20customer\x20data\x20for\x20payment\x20','üìä\x20Available\x20gateways\x20in\x20database:','üí∏\x20CHARGEBACK\x20penalty:\x20-','reduce','\x20for\x20shop\x20','asc','getGatewayNameById','stringify','suspendUser','getPaymentById','createUser','findFirst','round','shop','getFullYear','findUnique','averageCheckUSDT','merchantUrl','\x20status:\x20','network','üìä\x20Gateway\x20filter\x20applied:','default','gatewayEarnings','totalTurnover','generateDailyStatistics','wallets','gatewayOrderId','\x20payments)','adminNotes','some','createPayout','sk_','publicKey','getPayoutById','‚ö†Ô∏è\x20Payment\x20','toISOString','_sum','\x20became\x20PAID:\x20+','üí∞\x20Shop\x20',',\x20successful:\x20','NONEXISTENT_GATEWAY_FILTER','randomBytes','delete','üìä\x20Total\x20payments\x20(including\x20failed):\x20','\x20merchants,\x20','Test\x20Gateway','usdtPolygonWallet','getSystemStatistics','deletePayout','\x20USDT','üìÖ\x20Period:\x20','getAllUsers','toString','../types/gateway','\x20USDT)','paymentsCount','status','shopUrl','amount','pk_','10EKJhnr','11236040EzmjNL','lte','count','length','externalPaymentUrl','admin','name','\x20\x20\x20Current\x20balance:\x20','_count','merchantEarningsUSDT','amountAfterCommissionUSDT','whiteUrl','toUpperCase','updatePaymentStatus','84054hymUTW','getGatewayDisplayName','totalCommissionRate','getTime','\x20USDT\x20(+','üí∞\x20[PAYOUT]\x20Merchant\x20','custom','deleteUser','getDate','update','commissionUSDT','getMerchantsSelection','üí∞\x20Creating\x20payout\x20for\x20shop\x20','\x20->\x20','\x27\x20to\x20name\x20\x27','aggregate','period','includes','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','üîÑ\x20Admin\x20updating\x20payment\x20','285771WmWxwL','\x20\x20\x20üåç\x20Country:\x20','\x20USDT\x20to\x20balance','KLYME\x20GB','üîç\x20Using\x20gateway\x20\x27','periodFrom','desc','polygon_usdc','7eKzBod','0000','customerName','updateCustomerData','updatedAt','üìã\x20Getting\x20merchants\x20selection\x20list...','test_gateway','shopId','entries','turnoverUSDT','12381363UXQaYm','payout','averageCommissionRate','\x20USDT\x20total','password','\x20order','\x20balance\x20updated:\x20'];a35_0x1d90=function(){return _0x328e41;};return a35_0x1d90();}class AdminService{async['getPayoutStats'](){const _0x5752c3=a35_0x1e45b9;console['log'](_0x5752c3(0x1e6));const _0x2e7ec5=await database_1[_0x5752c3(0x17d)][_0x5752c3(0x175)]['aggregate']({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x5752c3(0x1ea)}}),_0x1e96a0=await this['getMerchantsAwaitingPayout']({'page':0x1,'limit':0x3e8}),_0x44d946=new Date(),_0x195d4b=new Date(_0x44d946[_0x5752c3(0x176)](),_0x44d946[_0x5752c3(0x260)](),0x1),_0x175d48=new Date(_0x44d946[_0x5752c3(0x176)](),_0x44d946[_0x5752c3(0x260)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x55c277=await database_1[_0x5752c3(0x17d)][_0x5752c3(0x1da)][_0x5752c3(0x1c2)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x195d4b,'lte':_0x175d48},'status':_0x5752c3(0x24b)}}),_0x4f20d5=_0x2e7ec5[_0x5752c3(0x18c)][_0x5752c3(0x21a)]||0x0,_0x39c2dd=_0x1e96a0[_0x5752c3(0x23d)][_0x5752c3(0x1f5)],_0x574f71=_0x55c277['_sum'][_0x5752c3(0x1a2)]||0x0,_0x1ae461={'totalPayout':Math[_0x5752c3(0x174)](_0x4f20d5*0x64)/0x64,'awaitingPayout':Math[_0x5752c3(0x174)](_0x39c2dd*0x64)/0x64,'thisMonth':Math[_0x5752c3(0x174)](_0x574f71*0x64)/0x64,'availableBalance':Math['round'](_0x39c2dd*0x64)/0x64};return console['log'](_0x5752c3(0x1ee)),console['log'](_0x5752c3(0x20c)+_0x1ae461[_0x5752c3(0x258)]+_0x5752c3(0x250)),console['log'](_0x5752c3(0x212)+_0x1ae461['awaitingPayout']+_0x5752c3(0x246)),console[_0x5752c3(0x232)](_0x5752c3(0x1f3)+_0x1ae461['availableBalance']+'\x20USDT\x20(same\x20as\x20awaiting)'),console[_0x5752c3(0x232)](_0x5752c3(0x24a)+_0x1ae461[_0x5752c3(0x265)]+_0x5752c3(0x199)),console[_0x5752c3(0x232)]('\x20\x20\x20üîç\x20Raw\x20balance\x20sum:\x20'+(_0x2e7ec5[_0x5752c3(0x18c)]['balance']||0x0)[_0x5752c3(0x1e4)](0x2)+'\x20USDT\x20(without\x20commission)'),console[_0x5752c3(0x232)](_0x5752c3(0x213)+((_0x2e7ec5['_sum'][_0x5752c3(0x215)]||0x0)-_0x39c2dd)[_0x5752c3(0x1e4)](0x2)+_0x5752c3(0x199)),_0x1ae461;}async[a35_0x1e45b9(0x1d2)](_0x288a1e,_0x2cc775){const _0x5b2f51=a35_0x1e45b9;console[_0x5b2f51(0x232)](_0x5b2f51(0x168)+_0x288a1e+':',_0x2cc775);const _0x50f4e1=await database_1[_0x5b2f51(0x17d)][_0x5b2f51(0x252)][_0x5b2f51(0x177)]({'where':{'id':_0x288a1e},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x50f4e1)throw new Error(_0x5b2f51(0x15d));const _0x3b1188={};_0x2cc775[_0x5b2f51(0x22a)]!==undefined&&(_0x3b1188['customerCountry']=_0x2cc775[_0x5b2f51(0x22a)]||null);_0x2cc775[_0x5b2f51(0x1fe)]!==undefined&&(_0x3b1188[_0x5b2f51(0x1fe)]=_0x2cc775[_0x5b2f51(0x1fe)]||null);_0x2cc775['customerUa']!==undefined&&(_0x3b1188['customerUa']=_0x2cc775[_0x5b2f51(0x1ff)]||null);const _0x3e7508=await database_1[_0x5b2f51(0x17d)][_0x5b2f51(0x252)]['update']({'where':{'id':_0x288a1e},'data':{..._0x3b1188,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console['log'](_0x5b2f51(0x20e)+_0x288a1e),console[_0x5b2f51(0x232)](_0x5b2f51(0x1c8)+_0x50f4e1[_0x5b2f51(0x22a)]+_0x5b2f51(0x1c0)+_0x3e7508['customerCountry']),console[_0x5b2f51(0x232)]('\x20\x20\x20üåê\x20IP:\x20'+_0x50f4e1[_0x5b2f51(0x1fe)]+'\x20->\x20'+_0x3e7508['customerIp']),console[_0x5b2f51(0x232)]('\x20\x20\x20üñ•Ô∏è\x20User\x20Agent:\x20'+(_0x50f4e1[_0x5b2f51(0x1ff)]?_0x5b2f51(0x225):_0x5b2f51(0x233))+_0x5b2f51(0x1c0)+(_0x3e7508[_0x5b2f51(0x1ff)]?_0x5b2f51(0x225):'not\x20set')),_0x3e7508;}async[a35_0x1e45b9(0x197)](_0x50c0fc){const _0x67e210=a35_0x1e45b9,_0x5b220a=new Date();let _0x3d15bd;switch(_0x50c0fc){case'7d':_0x3d15bd=new Date(_0x5b220a[_0x67e210(0x1b6)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x67e210(0x20d):_0x3d15bd=new Date(_0x5b220a[_0x67e210(0x1b6)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'90d':_0x3d15bd=new Date(_0x5b220a[_0x67e210(0x1b6)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case'all':const _0x3c837d=await database_1[_0x67e210(0x17d)][_0x67e210(0x252)][_0x67e210(0x173)]({'where':{'gateway':{'not':'test_gateway'}},'orderBy':{'createdAt':_0x67e210(0x16d)},'select':{'createdAt':!![]}});_0x3d15bd=_0x3c837d?_0x3c837d[_0x67e210(0x23a)]:new Date(_0x67e210(0x1f9)),console[_0x67e210(0x232)](_0x67e210(0x1fd)+_0x3d15bd['toISOString']());break;default:_0x3d15bd=new Date(_0x5b220a['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x4015a3,_0x49eadd,_0x2ec659,_0x26307d,_0x135e6c,_0x363fba,_0x3465f8]=await Promise[_0x67e210(0x214)]([database_1[_0x67e210(0x17d)][_0x67e210(0x175)][_0x67e210(0x1a7)](),database_1[_0x67e210(0x17d)][_0x67e210(0x175)]['count']({'where':{'status':_0x67e210(0x1ea)}}),database_1[_0x67e210(0x17d)][_0x67e210(0x252)][_0x67e210(0x1a7)]({'where':{'createdAt':{'gte':_0x3d15bd},'gateway':{'not':'test_gateway'}}}),database_1[_0x67e210(0x17d)][_0x67e210(0x252)][_0x67e210(0x1a7)]({'where':{'status':_0x67e210(0x25b),'createdAt':{'gte':_0x3d15bd},'gateway':{'not':_0x67e210(0x1d5)}}}),database_1[_0x67e210(0x17d)][_0x67e210(0x252)][_0x67e210(0x220)]({'where':{'status':_0x67e210(0x25b),'createdAt':{'gte':_0x3d15bd},'gateway':{'not':_0x67e210(0x1d5)}},'select':{'amount':!![],'currency':!![]}}),database_1['default'][_0x67e210(0x252)]['findMany']({'where':{'gateway':{'not':_0x67e210(0x1d5)}},'take':0xa,'orderBy':{'createdAt':_0x67e210(0x1cd)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x67e210(0x17d)][_0x67e210(0x252)][_0x67e210(0x220)]({'where':{'createdAt':{'gte':_0x3d15bd},'gateway':{'not':_0x67e210(0x1d5)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x27d9d4=0x0;for(const _0x572df1 of _0x135e6c){const _0x5f0b84=await currencyService_1[_0x67e210(0x1e7)]['convertToUSDT'](_0x572df1[_0x67e210(0x1a2)],_0x572df1[_0x67e210(0x245)]);_0x27d9d4+=_0x5f0b84;}const _0x163f5e=this[_0x67e210(0x180)](_0x3465f8,_0x3d15bd,_0x5b220a),_0x32933=_0x2ec659>0x0?_0x26307d/_0x2ec659*0x64:0x0;return{'totalShops':_0x4015a3,'activeShops':_0x49eadd,'totalPayments':_0x2ec659,'successfulPayments':_0x26307d,'totalRevenue':Math[_0x67e210(0x174)](_0x27d9d4*0x64)/0x64,'conversionRate':Math['round'](_0x32933*0x64)/0x64,'dailyRevenue':_0x163f5e[_0x67e210(0x201)],'dailyPayments':_0x163f5e['dailyPayments'],'recentPayments':_0x363fba[_0x67e210(0x165)](_0x352c57=>({'id':_0x352c57['id'],'amount':_0x352c57['amount'],'currency':_0x352c57[_0x67e210(0x245)],'status':_0x352c57[_0x67e210(0x1a0)],'gateway':_0x352c57['gateway'],'shop':_0x352c57[_0x67e210(0x175)],'createdAt':_0x352c57[_0x67e210(0x23a)]}))};}async[a35_0x1e45b9(0x22e)](_0x298773){const _0x28a20a=a35_0x1e45b9;console[_0x28a20a(0x232)](_0x28a20a(0x25d),_0x298773);let _0x57ded5,_0x2e1174=new Date();if(_0x298773['period']===_0x28a20a(0x1b9)&&_0x298773[_0x28a20a(0x25a)]&&_0x298773[_0x28a20a(0x211)])_0x57ded5=new Date(_0x298773['dateFrom']),_0x2e1174=new Date(_0x298773[_0x28a20a(0x211)]);else{const _0x20d4d7=new Date();switch(_0x298773[_0x28a20a(0x1c3)]){case _0x28a20a(0x216):_0x57ded5=new Date(_0x20d4d7[_0x28a20a(0x1b6)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x28a20a(0x235):_0x57ded5=new Date(_0x20d4d7['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'year':_0x57ded5=new Date(_0x20d4d7['getTime']()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x28a20a(0x214):default:_0x57ded5=new Date(_0x28a20a(0x1f9));break;}}console[_0x28a20a(0x232)](_0x28a20a(0x19a)+_0x57ded5[_0x28a20a(0x18b)]()+_0x28a20a(0x244)+_0x2e1174[_0x28a20a(0x18b)]());const _0x16f394={'status':_0x28a20a(0x25b),'gateway':{'not':_0x28a20a(0x1d5)},'paidAt':{'gte':_0x57ded5,'lte':_0x2e1174}};_0x298773[_0x28a20a(0x1d6)]&&(_0x16f394[_0x28a20a(0x1d6)]=_0x298773[_0x28a20a(0x1d6)]);const _0x3d9675=await database_1[_0x28a20a(0x17d)]['payment'][_0x28a20a(0x220)]({'where':_0x16f394,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x28a20a(0x232)](_0x28a20a(0x23c)+_0x3d9675[_0x28a20a(0x1a8)]+'\x20paid\x20payments\x20for\x20analysis');const _0x41345d={'gateway':{'not':_0x28a20a(0x1d5)},'createdAt':{'gte':_0x57ded5,'lte':_0x2e1174}};_0x298773[_0x28a20a(0x1d6)]&&(_0x41345d[_0x28a20a(0x1d6)]=_0x298773[_0x28a20a(0x1d6)]);const _0x1a1b2f=await database_1[_0x28a20a(0x17d)][_0x28a20a(0x252)]['count']({'where':_0x41345d});console[_0x28a20a(0x232)](_0x28a20a(0x193)+_0x1a1b2f+_0x28a20a(0x18f)+_0x3d9675[_0x28a20a(0x1a8)]);let _0x3421cf=0x0,_0x4bf392=0x0,_0x40bf37=0x0;const _0x6699dd={},_0x18d4e={},_0x528bae={};for(const _0x3ea8b1 of _0x3d9675){try{const _0xb5e7c8=await currencyService_1['currencyService'][_0x28a20a(0x167)](_0x3ea8b1[_0x28a20a(0x1a2)],_0x3ea8b1[_0x28a20a(0x245)]);let _0x11cedd={};if(_0x3ea8b1[_0x28a20a(0x175)]['gatewaySettings'])try{_0x11cedd=JSON[_0x28a20a(0x269)](_0x3ea8b1[_0x28a20a(0x175)][_0x28a20a(0x24d)]);}catch(_0x59260f){console[_0x28a20a(0x15c)](_0x28a20a(0x1c5)+_0x3ea8b1['shopId']+':',_0x59260f);}let _0x4c97bc={},_0x212fb9=0xa;for(const [_0x4e89d8,_0x58ca0c]of Object[_0x28a20a(0x1d7)](_0x11cedd)){if(_0x4e89d8[_0x28a20a(0x223)]()===_0x3ea8b1[_0x28a20a(0x23e)][_0x28a20a(0x223)]()){_0x4c97bc=_0x58ca0c,_0x212fb9=_0x58ca0c[_0x28a20a(0x249)]||0xa;break;}}const _0xfdc654=_0xb5e7c8*(_0x212fb9/0x64),_0x50dda8=_0xb5e7c8-_0xfdc654;_0x3421cf+=_0xb5e7c8,_0x4bf392+=_0x50dda8,_0x40bf37+=_0xfdc654;!_0x6699dd[_0x3ea8b1[_0x28a20a(0x23e)]]&&(_0x6699dd[_0x3ea8b1[_0x28a20a(0x23e)]]={'gateway':_0x3ea8b1['gateway'],'gatewayDisplayName':this[_0x28a20a(0x1b4)](_0x3ea8b1['gateway']),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x6699dd[_0x3ea8b1[_0x28a20a(0x23e)]][_0x28a20a(0x19f)]++,_0x6699dd[_0x3ea8b1[_0x28a20a(0x23e)]]['turnoverUSDT']+=_0xb5e7c8,_0x6699dd[_0x3ea8b1[_0x28a20a(0x23e)]][_0x28a20a(0x1bd)]+=_0xfdc654,_0x6699dd[_0x3ea8b1[_0x28a20a(0x23e)]][_0x28a20a(0x1ae)]+=_0x50dda8,_0x6699dd[_0x3ea8b1['gateway']][_0x28a20a(0x1b5)]+=_0x212fb9;!_0x298773[_0x28a20a(0x1d6)]&&(!_0x18d4e[_0x3ea8b1[_0x28a20a(0x1d6)]]&&(_0x18d4e[_0x3ea8b1['shopId']]={'shopId':_0x3ea8b1['shopId'],'shopName':_0x3ea8b1[_0x28a20a(0x175)]['name'],'shopUsername':_0x3ea8b1['shop'][_0x28a20a(0x255)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x18d4e[_0x3ea8b1[_0x28a20a(0x1d6)]][_0x28a20a(0x19f)]++,_0x18d4e[_0x3ea8b1[_0x28a20a(0x1d6)]]['turnoverUSDT']+=_0xb5e7c8,_0x18d4e[_0x3ea8b1[_0x28a20a(0x1d6)]][_0x28a20a(0x1bd)]+=_0xfdc654,_0x18d4e[_0x3ea8b1[_0x28a20a(0x1d6)]][_0x28a20a(0x1ae)]+=_0x50dda8);const _0xef665=_0x3ea8b1[_0x28a20a(0x1f0)]['toISOString']()[_0x28a20a(0x1e5)]('T')[0x0];!_0x528bae[_0xef665]&&(_0x528bae[_0xef665]={'date':_0xef665,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x528bae[_0xef665]['turnover']+=_0xb5e7c8,_0x528bae[_0xef665][_0x28a20a(0x23b)]+=_0x50dda8,_0x528bae[_0xef665][_0x28a20a(0x17e)]+=_0xfdc654,_0x528bae[_0xef665]['paymentsCount']++;}catch(_0xb173d8){console[_0x28a20a(0x15c)]('Error\x20processing\x20payment\x20'+_0x3ea8b1['id']+':',_0xb173d8);}}Object[_0x28a20a(0x23f)](_0x6699dd)[_0x28a20a(0x25c)](_0x77f0e4=>{const _0x324098=_0x28a20a;_0x77f0e4[_0x324098(0x1db)]=_0x77f0e4[_0x324098(0x19f)]>0x0?_0x77f0e4['totalCommissionRate']/_0x77f0e4['paymentsCount']:0x0,delete _0x77f0e4[_0x324098(0x1b5)];}),Object[_0x28a20a(0x23f)](_0x18d4e)[_0x28a20a(0x25c)](_0x4cfd2b=>{const _0x42ee01=_0x28a20a;_0x4cfd2b[_0x42ee01(0x178)]=_0x4cfd2b[_0x42ee01(0x19f)]>0x0?_0x4cfd2b[_0x42ee01(0x1d8)]/_0x4cfd2b['paymentsCount']:0x0;});let _0x22dc1b=0x0;if(_0x298773['shopId']){const _0x44f60c=await database_1['default']['payout'][_0x28a20a(0x220)]({'where':{'shopId':_0x298773['shopId'],'status':_0x28a20a(0x24b),'createdAt':{'gte':_0x57ded5,'lte':_0x2e1174}},'select':{'amount':!![]}});_0x22dc1b=_0x44f60c['reduce']((_0x20e40c,_0xb5588b)=>_0x20e40c+_0xb5588b['amount'],0x0);}const _0x1a1154=_0x1a1b2f,_0x476673=_0x3d9675[_0x28a20a(0x1a8)],_0x191ce3=_0x476673>0x0?_0x3421cf/_0x476673:0x0,_0x334889=_0x1a1154>0x0?Math[_0x28a20a(0x174)](_0x476673/_0x1a1154*0x2710)/0x64:0x0,_0x4f340d=Math[_0x28a20a(0x26b)]((_0x2e1174[_0x28a20a(0x1b6)]()-_0x57ded5[_0x28a20a(0x1b6)]())/(0x3e8*0x3c*0x3c*0x18)),_0x34da0f={'totalTurnover':Math['round'](_0x3421cf*0x64)/0x64,'merchantEarnings':Math['round'](_0x4bf392*0x64)/0x64,'gatewayEarnings':Math['round'](_0x40bf37*0x64)/0x64,'totalPaidOut':Math[_0x28a20a(0x174)](_0x22dc1b*0x64)/0x64,'averageCheck':Math['round'](_0x191ce3*0x64)/0x64,'totalPayments':_0x1a1154,'successfulPayments':_0x476673,'conversionRate':_0x334889,'gatewayBreakdown':Object[_0x28a20a(0x23f)](_0x6699dd)['map'](_0xaeb9e4=>({..._0xaeb9e4,'turnoverUSDT':Math[_0x28a20a(0x174)](_0xaeb9e4[_0x28a20a(0x1d8)]*0x64)/0x64,'commissionUSDT':Math[_0x28a20a(0x174)](_0xaeb9e4[_0x28a20a(0x1bd)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x28a20a(0x174)](_0xaeb9e4['merchantEarningsUSDT']*0x64)/0x64,'averageCommissionRate':Math[_0x28a20a(0x174)](_0xaeb9e4[_0x28a20a(0x1db)]*0x64)/0x64})),'merchantBreakdown':_0x298773[_0x28a20a(0x1d6)]?undefined:Object['values'](_0x18d4e)['map'](_0x38d0f8=>({..._0x38d0f8,'turnoverUSDT':Math[_0x28a20a(0x174)](_0x38d0f8[_0x28a20a(0x1d8)]*0x64)/0x64,'commissionUSDT':Math[_0x28a20a(0x174)](_0x38d0f8[_0x28a20a(0x1bd)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x38d0f8[_0x28a20a(0x1ae)]*0x64)/0x64,'paidOutUSDT':Math[_0x28a20a(0x174)](_0x38d0f8['paidOutUSDT']*0x64)/0x64,'averageCheckUSDT':Math[_0x28a20a(0x174)](_0x38d0f8[_0x28a20a(0x178)]*0x64)/0x64})),'dailyData':Object[_0x28a20a(0x23f)](_0x528bae)['map'](_0x3fb42a=>({..._0x3fb42a,'turnover':Math[_0x28a20a(0x174)](_0x3fb42a['turnover']*0x64)/0x64,'merchantEarnings':Math[_0x28a20a(0x174)](_0x3fb42a[_0x28a20a(0x23b)]*0x64)/0x64,'gatewayEarnings':Math[_0x28a20a(0x174)](_0x3fb42a[_0x28a20a(0x17e)]*0x64)/0x64}))[_0x28a20a(0x22b)]((_0x1b8cb6,_0x30bf3e)=>_0x1b8cb6['date'][_0x28a20a(0x161)](_0x30bf3e[_0x28a20a(0x268)])),'periodInfo':{'from':_0x57ded5,'to':_0x2e1174,'periodType':_0x298773['period']||_0x28a20a(0x1b9),'daysCount':_0x4f340d}};return console[_0x28a20a(0x232)](_0x28a20a(0x1e1)),console[_0x28a20a(0x232)](_0x28a20a(0x20b)+_0x34da0f[_0x28a20a(0x17f)]+'\x20USDT'),console[_0x28a20a(0x232)](_0x28a20a(0x263)+_0x34da0f['merchantEarnings']+_0x28a20a(0x199)),console[_0x28a20a(0x232)](_0x28a20a(0x221)+_0x34da0f[_0x28a20a(0x17e)]+_0x28a20a(0x199)),console[_0x28a20a(0x232)](_0x28a20a(0x236)+_0x34da0f[_0x28a20a(0x210)]),_0x34da0f;}async[a35_0x1e45b9(0x1be)](){const _0xc6bbd6=a35_0x1e45b9;console[_0xc6bbd6(0x232)](_0xc6bbd6(0x1d4));const _0x2db81f=await database_1[_0xc6bbd6(0x17d)][_0xc6bbd6(0x175)][_0xc6bbd6(0x220)]({'where':{'status':_0xc6bbd6(0x1ea)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0xc6bbd6(0x16d)}});return console[_0xc6bbd6(0x232)](_0xc6bbd6(0x247)+_0x2db81f['length']+_0xc6bbd6(0x22c)),_0x2db81f[_0xc6bbd6(0x165)](_0x1595ef=>({'id':_0x1595ef['id'],'username':_0x1595ef[_0xc6bbd6(0x255)],'name':_0x1595ef['name']}));}['getGatewayDisplayName'](_0x77df78){const _0x4ca0c7=a35_0x1e45b9,_0x4cb794={'test_gateway':_0x4ca0c7(0x195),'plisio':_0x4ca0c7(0x21b),'rapyd':_0x4ca0c7(0x240),'noda':_0x4ca0c7(0x1f4),'cointopay':_0x4ca0c7(0x22f),'klyme_eu':'KLYME\x20EU','klyme_gb':_0x4ca0c7(0x1ca),'klyme_de':_0x4ca0c7(0x26d)};return _0x4cb794[_0x77df78]||_0x77df78;}async['getMerchantsAwaitingPayout'](_0x3f8848){const _0x4bc4b0=a35_0x1e45b9,{page:_0x3faffb,limit:_0x2799b0,minAmount:_0x4f1a01,search:_0x495a3b}=_0x3f8848,_0x3017a0=(_0x3faffb-0x1)*_0x2799b0;console[_0x4bc4b0(0x232)]('üìä\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:',_0x3f8848);const _0x2249cd={'balance':{'gt':0x0},'status':'ACTIVE'};_0x4f1a01&&(_0x2249cd['balance'][_0x4bc4b0(0x1ed)]=_0x4f1a01);_0x495a3b&&(_0x2249cd['OR']=[{'name':{'contains':_0x495a3b,'mode':_0x4bc4b0(0x21c)}},{'username':{'contains':_0x495a3b,'mode':_0x4bc4b0(0x21c)}}]);const [_0x446c19,_0x222f5a]=await Promise['all']([database_1[_0x4bc4b0(0x17d)][_0x4bc4b0(0x175)]['findMany']({'where':_0x2249cd,'skip':_0x3017a0,'take':_0x2799b0,'orderBy':{'balance':_0x4bc4b0(0x1cd)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1['default'][_0x4bc4b0(0x175)][_0x4bc4b0(0x1a7)]({'where':_0x2249cd})]);console['log'](_0x4bc4b0(0x23c)+_0x446c19[_0x4bc4b0(0x1a8)]+_0x4bc4b0(0x234));const _0x970b8d=await Promise[_0x4bc4b0(0x214)](_0x446c19['map'](async _0x1ecd32=>{const _0x30c19a=_0x4bc4b0,[_0x5b37d1,_0x4bacc0,_0x35c99f]=await Promise[_0x30c19a(0x214)]([database_1['default']['payment'][_0x30c19a(0x1a7)]({'where':{'shopId':_0x1ecd32['id'],'status':'PAID','amountUSDT':{'not':null}}}),database_1[_0x30c19a(0x17d)]['payment'][_0x30c19a(0x173)]({'where':{'shopId':_0x1ecd32['id'],'status':'PAID','amountUSDT':{'not':null}},'orderBy':{'paidAt':_0x30c19a(0x16d)},'select':{'paidAt':!![]}}),database_1[_0x30c19a(0x17d)][_0x30c19a(0x252)]['groupBy']({'by':[_0x30c19a(0x23e)],'where':{'shopId':_0x1ecd32['id'],'status':_0x30c19a(0x25b),'amountUSDT':{'not':null}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x1edf30=await Promise[_0x30c19a(0x214)](_0x35c99f[_0x30c19a(0x165)](async _0x4aa480=>{const _0x46b9ea=_0x30c19a;let _0x579258=0xa;if(_0x1ecd32[_0x46b9ea(0x24d)])try{const _0x1692fd=JSON[_0x46b9ea(0x269)](_0x1ecd32[_0x46b9ea(0x24d)]);for(const [_0x2bc096,_0x4c5e0b]of Object[_0x46b9ea(0x1d7)](_0x1692fd)){if(_0x2bc096[_0x46b9ea(0x223)]()===_0x4aa480[_0x46b9ea(0x23e)]['toLowerCase']()){_0x579258=_0x4c5e0b['commission']||0xa,console['log'](_0x46b9ea(0x254)+_0x4aa480[_0x46b9ea(0x23e)]+_0x46b9ea(0x16c)+_0x1ecd32['id']+_0x46b9ea(0x1f7)+_0x579258+'%');break;}}}catch(_0x162028){console[_0x46b9ea(0x15c)](_0x46b9ea(0x1c5)+_0x1ecd32['id']+':',_0x162028);}const _0x238596=_0x4aa480['_sum']['amountUSDT']||0x0,_0x148b83=_0x238596*(0x1-_0x579258/0x64);return{'gateway':_0x4aa480['gateway'],'count':_0x4aa480[_0x46b9ea(0x1ad)]['id'],'amountUSDT':Math['round'](_0x238596*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x46b9ea(0x174)](_0x148b83*0x64)/0x64,'commission':_0x579258};})),_0x1e8da3=_0x1edf30[_0x30c19a(0x16b)]((_0x2cecf4,_0x4fd104)=>_0x2cecf4+_0x4fd104[_0x30c19a(0x21f)],0x0),_0x2b8423=_0x1ecd32['balance'];return console['log'](_0x30c19a(0x1b8)+_0x1ecd32[_0x30c19a(0x255)]+':'),console['log']('\x20\x20\x20Raw\x20total\x20from\x20payments:\x20'+Math[_0x30c19a(0x174)](_0x1e8da3*0x64)/0x64+_0x30c19a(0x199)),console[_0x30c19a(0x232)]('\x20\x20\x20Calculated\x20after\x20commission:\x20'+_0x1edf30[_0x30c19a(0x16b)]((_0x3dc6c6,_0x304c1d)=>_0x3dc6c6+_0x304c1d[_0x30c19a(0x1af)],0x0)+_0x30c19a(0x199)),console[_0x30c19a(0x232)](_0x30c19a(0x1fc)+_0x1ecd32[_0x30c19a(0x215)]+_0x30c19a(0x261)),{'id':_0x1ecd32['id'],'fullName':_0x1ecd32[_0x30c19a(0x1ab)],'username':_0x1ecd32['username'],'telegramId':_0x1ecd32[_0x30c19a(0x267)],'merchantUrl':_0x1ecd32[_0x30c19a(0x1a1)],'wallets':{'usdtPolygonWallet':_0x1ecd32['usdtPolygonWallet'],'usdtTrcWallet':_0x1ecd32[_0x30c19a(0x228)],'usdtErcWallet':_0x1ecd32[_0x30c19a(0x239)],'usdcPolygonWallet':_0x1ecd32[_0x30c19a(0x226)]},'totalAmountUSDT':Math[_0x30c19a(0x174)](_0x1e8da3*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x30c19a(0x174)](_0x2b8423*0x64)/0x64,'paymentsCount':_0x5b37d1,'oldestPaymentDate':_0x4bacc0?.[_0x30c19a(0x1f0)]||_0x1ecd32['createdAt'],'gatewayBreakdown':_0x1edf30};})),_0x4300ad=_0x970b8d[_0x4bc4b0(0x16b)]((_0x115bfc,_0x27abc3)=>_0x115bfc+_0x27abc3['totalAmountUSDT'],0x0),_0xcb14da=_0x970b8d[_0x4bc4b0(0x16b)]((_0x3601ad,_0x47ddd3)=>_0x3601ad+_0x47ddd3[_0x4bc4b0(0x1f5)],0x0);return console['log']('üìä\x20Merchants\x20awaiting\x20payout:\x20'+_0x222f5a+_0x4bc4b0(0x194)+Math[_0x4bc4b0(0x174)](_0xcb14da*0x64)/0x64+_0x4bc4b0(0x1dc)),{'merchants':_0x970b8d,'pagination':{'page':_0x3faffb,'limit':_0x2799b0,'total':_0x222f5a,'totalPages':Math[_0x4bc4b0(0x26b)](_0x222f5a/_0x2799b0)},'summary':{'totalMerchants':_0x222f5a,'totalAmountUSDT':Math['round'](_0x4300ad*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x4bc4b0(0x174)](_0xcb14da*0x64)/0x64}};}async[a35_0x1e45b9(0x186)](_0x40f75){const _0x2457a6=a35_0x1e45b9,{shopId:_0x28f0d2,amount:_0x1cc5e6,network:_0x7f62e1,wallet:_0x5b297a,notes:_0x420413,txid:_0x302281,periodFrom:_0x35c6c7,periodTo:_0x43d97d}=_0x40f75,_0x229b35=await database_1[_0x2457a6(0x17d)]['$transaction'](async _0x37fa5e=>{const _0xbf65a7=_0x2457a6,_0x1b0199=await _0x37fa5e[_0xbf65a7(0x175)]['findUnique']({'where':{'id':_0x28f0d2},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x1b0199)throw new Error('Shop\x20not\x20found');console[_0xbf65a7(0x232)](_0xbf65a7(0x1bf)+_0x1b0199[_0xbf65a7(0x255)]+':'),console['log'](_0xbf65a7(0x1ac)+_0x1b0199['balance'][_0xbf65a7(0x1e4)](0x6)+_0xbf65a7(0x199)),console[_0xbf65a7(0x232)](_0xbf65a7(0x203)+_0x1cc5e6[_0xbf65a7(0x1e4)](0x6)+_0xbf65a7(0x199)),console[_0xbf65a7(0x232)]('\x20\x20\x20Current\x20total\x20paid\x20out:\x20'+_0x1b0199[_0xbf65a7(0x21a)][_0xbf65a7(0x1e4)](0x6)+_0xbf65a7(0x199));if(_0x302281)console['log']('\x20\x20\x20Transaction\x20hash:\x20'+_0x302281);if(_0x1b0199[_0xbf65a7(0x215)]<_0x1cc5e6)throw new Error(_0xbf65a7(0x264)+_0x1b0199[_0xbf65a7(0x215)][_0xbf65a7(0x1e4)](0x6)+_0xbf65a7(0x208)+_0x1cc5e6[_0xbf65a7(0x1e4)](0x6)+_0xbf65a7(0x199));let _0x130e8c=_0x5b297a;if(!_0x130e8c){const _0x5ae18c=await _0x37fa5e[_0xbf65a7(0x175)]['findUnique']({'where':{'id':_0x28f0d2},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x5ae18c)switch(_0x7f62e1){case'polygon':_0x130e8c=_0x5ae18c['usdtPolygonWallet']||undefined;break;case _0xbf65a7(0x1f6):_0x130e8c=_0x5ae18c[_0xbf65a7(0x228)]||undefined;break;case _0xbf65a7(0x253):_0x130e8c=_0x5ae18c[_0xbf65a7(0x239)]||undefined;break;case _0xbf65a7(0x1ce):_0x130e8c=_0x5ae18c['usdcPolygonWallet']||undefined;break;}}console[_0xbf65a7(0x232)]('üí≥\x20Payout\x20wallet\x20for\x20'+_0x7f62e1+':\x20'+(_0x130e8c||_0xbf65a7(0x1fb)));const _0x1f677e=await _0x37fa5e['payout'][_0xbf65a7(0x20a)]({'data':{'shopId':_0x28f0d2,'amount':_0x1cc5e6,'network':_0x7f62e1,'status':_0xbf65a7(0x24b),'txid':_0x302281,'notes':_0x420413,'periodFrom':_0x35c6c7?new Date(_0x35c6c7):null,'periodTo':_0x43d97d?new Date(_0x43d97d):null,'createdAt':new Date(),'paidAt':new Date()}}),_0xc301e1=_0x1b0199[_0xbf65a7(0x215)]-_0x1cc5e6,_0x1ff04e=_0x1b0199[_0xbf65a7(0x21a)]+_0x1cc5e6;return await _0x37fa5e['shop']['update']({'where':{'id':_0x28f0d2},'data':{'balance':_0xc301e1,'totalPaidOut':_0x1ff04e}}),console[_0xbf65a7(0x232)](_0xbf65a7(0x18e)+_0x1b0199['username']+_0xbf65a7(0x1ef)),console[_0xbf65a7(0x232)](_0xbf65a7(0x1f1)+_0x1b0199[_0xbf65a7(0x215)][_0xbf65a7(0x1e4)](0x6)+_0xbf65a7(0x1c0)+_0xc301e1[_0xbf65a7(0x1e4)](0x6)+_0xbf65a7(0x163)+_0x1cc5e6['toFixed'](0x6)+')'),console[_0xbf65a7(0x232)](_0xbf65a7(0x1f2)+_0x1b0199[_0xbf65a7(0x21a)][_0xbf65a7(0x1e4)](0x6)+_0xbf65a7(0x1c0)+_0x1ff04e[_0xbf65a7(0x1e4)](0x6)+_0xbf65a7(0x1b7)+_0x1cc5e6[_0xbf65a7(0x1e4)](0x6)+')'),{'payout':_0x1f677e,'shop':_0x1b0199};});return console[_0x2457a6(0x232)]('‚úÖ\x20Payout\x20created:\x20'+_0x229b35[_0x2457a6(0x1da)]['id']+_0x2457a6(0x16c)+_0x229b35[_0x2457a6(0x175)][_0x2457a6(0x255)]+'\x20('+_0x1cc5e6+_0x2457a6(0x19e)),{'id':_0x229b35[_0x2457a6(0x1da)]['id'],'shopId':_0x229b35[_0x2457a6(0x1da)]['shopId'],'shopName':_0x229b35[_0x2457a6(0x175)][_0x2457a6(0x1ab)],'shopUsername':_0x229b35['shop'][_0x2457a6(0x255)],'amount':_0x229b35[_0x2457a6(0x1da)]['amount'],'network':_0x229b35[_0x2457a6(0x1da)][_0x2457a6(0x17b)],'status':_0x229b35[_0x2457a6(0x1da)][_0x2457a6(0x1a0)],'txid':_0x229b35[_0x2457a6(0x1da)]['txid'],'notes':_0x229b35[_0x2457a6(0x1da)][_0x2457a6(0x160)],'periodFrom':_0x229b35[_0x2457a6(0x1da)][_0x2457a6(0x1cc)],'periodTo':_0x229b35[_0x2457a6(0x1da)][_0x2457a6(0x204)],'createdAt':_0x229b35[_0x2457a6(0x1da)][_0x2457a6(0x23a)],'paidAt':_0x229b35['payout'][_0x2457a6(0x1f0)]};}async['getAllPayouts'](_0x38b189){const _0x47176f=a35_0x1e45b9,{page:_0x4eaf4d,limit:_0x370e7c,shopId:_0xb2bd5d,network:_0x53f7e3,dateFrom:_0x277f37,dateTo:_0x654cda,search:_0x6fb812}=_0x38b189,_0x3001ec=(_0x4eaf4d-0x1)*_0x370e7c,_0x44b7d1={};_0xb2bd5d&&(_0x44b7d1[_0x47176f(0x1d6)]=_0xb2bd5d);_0x53f7e3&&(_0x44b7d1['network']=_0x53f7e3);(_0x277f37||_0x654cda)&&(_0x44b7d1[_0x47176f(0x23a)]={},_0x277f37&&(_0x44b7d1['createdAt'][_0x47176f(0x1ed)]=new Date(_0x277f37)),_0x654cda&&(_0x44b7d1[_0x47176f(0x23a)]['lte']=new Date(_0x654cda)));_0x6fb812&&(_0x44b7d1['OR']=[{'shop':{'name':{'contains':_0x6fb812,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x6fb812,'mode':'insensitive'}}},{'notes':{'contains':_0x6fb812,'mode':'insensitive'}}]);const [_0xa172d2,_0x40336c]=await Promise['all']([database_1[_0x47176f(0x17d)][_0x47176f(0x1da)][_0x47176f(0x220)]({'where':_0x44b7d1,'skip':_0x3001ec,'take':_0x370e7c,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'wallet':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x47176f(0x17d)][_0x47176f(0x1da)][_0x47176f(0x1a7)]({'where':_0x44b7d1})]);return{'payouts':_0xa172d2[_0x47176f(0x165)](_0xa18790=>({'id':_0xa18790['id'],'shopId':_0xa18790[_0x47176f(0x1d6)],'shopName':_0xa18790['shop'][_0x47176f(0x1ab)],'shopUsername':_0xa18790['shop'][_0x47176f(0x255)],'amount':_0xa18790['amount'],'network':_0xa18790[_0x47176f(0x17b)],'wallet':_0xa18790[_0x47176f(0x1e9)],'status':_0xa18790[_0x47176f(0x1a0)],'txid':_0xa18790[_0x47176f(0x202)],'notes':_0xa18790['notes'],'periodFrom':_0xa18790[_0x47176f(0x1cc)],'periodTo':_0xa18790[_0x47176f(0x204)],'createdAt':_0xa18790[_0x47176f(0x23a)],'paidAt':_0xa18790[_0x47176f(0x1f0)]})),'pagination':{'page':_0x4eaf4d,'limit':_0x370e7c,'total':_0x40336c,'totalPages':Math[_0x47176f(0x26b)](_0x40336c/_0x370e7c)}};}async[a35_0x1e45b9(0x189)](_0x2639ec){const _0x2d58a8=a35_0x1e45b9,_0x2724c2=await database_1[_0x2d58a8(0x17d)][_0x2d58a8(0x1da)][_0x2d58a8(0x177)]({'where':{'id':_0x2639ec},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x2724c2)return null;return{'id':_0x2724c2['id'],'shopId':_0x2724c2[_0x2d58a8(0x1d6)],'shopName':_0x2724c2[_0x2d58a8(0x175)][_0x2d58a8(0x1ab)],'shopUsername':_0x2724c2['shop'][_0x2d58a8(0x255)],'amount':_0x2724c2[_0x2d58a8(0x1a2)],'network':_0x2724c2[_0x2d58a8(0x17b)],'status':_0x2724c2[_0x2d58a8(0x1a0)],'txid':_0x2724c2[_0x2d58a8(0x202)],'notes':_0x2724c2[_0x2d58a8(0x160)],'periodFrom':_0x2724c2[_0x2d58a8(0x1cc)],'periodTo':_0x2724c2[_0x2d58a8(0x204)],'createdAt':_0x2724c2[_0x2d58a8(0x23a)],'paidAt':_0x2724c2['paidAt']};}async[a35_0x1e45b9(0x198)](_0x5f0ed7){const _0x1504de=a35_0x1e45b9;await database_1['default'][_0x1504de(0x1da)][_0x1504de(0x192)]({'where':{'id':_0x5f0ed7}});}async['getAllPayments'](_0x19f269){const _0x19192b=a35_0x1e45b9,{page:_0x1eec7e,limit:_0xae72ef,status:_0x59fafe,gateway:_0x45d66a,shopId:_0x286155,dateFrom:_0x59ca05,dateTo:_0x95ba11,search:_0x582b5f,currency:_0x488918,sortBy:_0x186304,sortOrder:_0xbb0f52}=_0x19f269,_0x7e2d81=(_0x1eec7e-0x1)*_0xae72ef;console['log'](_0x19192b(0x25e),_0x19f269);const _0x5c4137=await database_1[_0x19192b(0x17d)]['payment'][_0x19192b(0x22d)]({'by':[_0x19192b(0x23e)],'_count':{'gateway':!![]}});console[_0x19192b(0x232)](_0x19192b(0x169),_0x5c4137[_0x19192b(0x165)](_0x2816c4=>_0x2816c4['gateway']+'\x20('+_0x2816c4[_0x19192b(0x1ad)]['gateway']+_0x19192b(0x183)));if(_0x45d66a){const _0x1a1933=_0x5c4137[_0x19192b(0x185)](_0x1d2f4e=>_0x1d2f4e[_0x19192b(0x23e)][_0x19192b(0x223)]()===_0x45d66a['toLowerCase']());!_0x1a1933&&_0x45d66a['toLowerCase']()!==_0x19192b(0x1d5)&&console[_0x19192b(0x232)](_0x19192b(0x1fa)+_0x45d66a+_0x19192b(0x21d)+_0x5c4137[_0x19192b(0x165)](_0x1d3cf4=>_0x1d3cf4[_0x19192b(0x23e)])[_0x19192b(0x21e)](',\x20'));}const _0x119417={};_0x59fafe&&(_0x119417[_0x19192b(0x1a0)]=_0x59fafe['toUpperCase']());if(!_0x45d66a)_0x119417[_0x19192b(0x23e)]={'not':'test_gateway'};else{if(_0x45d66a&&(_0x45d66a[_0x19192b(0x223)]()===_0x19192b(0x1d5)||_0x45d66a===_0x19192b(0x1d0)))_0x119417['gateway']='test_gateway';else{let _0x3dac19=_0x45d66a;const _0x760016=(0x0,gateway_1[_0x19192b(0x16e)])(_0x45d66a);if(_0x760016)_0x3dac19=_0x760016,console[_0x19192b(0x232)](_0x19192b(0x15e)+_0x45d66a+_0x19192b(0x1c1)+_0x3dac19+'\x27');else{const _0x16cd45=(0x0,gateway_1['getGatewayIdByName'])(_0x45d66a);if(_0x16cd45){const _0x250f35=(0x0,gateway_1[_0x19192b(0x16e)])(_0x16cd45);_0x250f35&&(_0x3dac19=_0x250f35,console[_0x19192b(0x232)](_0x19192b(0x259)+_0x45d66a+_0x19192b(0x20f)+_0x16cd45+_0x19192b(0x217)+_0x3dac19+'\x27'));}else console[_0x19192b(0x232)](_0x19192b(0x1cb)+_0x45d66a+_0x19192b(0x166));}const _0x3cc2db=await database_1[_0x19192b(0x17d)]['payment'][_0x19192b(0x1a7)]({'where':{'gateway':_0x3dac19['toLowerCase']()},'take':0x1});_0x3cc2db===0x0?(console['log'](_0x19192b(0x243)+_0x3dac19+'\x27\x20(from\x20\x27'+_0x45d66a+'\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result'),_0x119417['gateway']=_0x19192b(0x190)):(_0x119417['gateway']=_0x3dac19[_0x19192b(0x223)](),console[_0x19192b(0x232)](_0x19192b(0x227)+_0x3dac19+_0x19192b(0x237)+_0x45d66a+'\x27)'));}}console['log'](_0x19192b(0x17c),_0x119417[_0x19192b(0x23e)]);_0x286155&&(_0x119417[_0x19192b(0x1d6)]=_0x286155);_0x488918&&(_0x119417[_0x19192b(0x245)]=_0x488918[_0x19192b(0x1b1)](),console[_0x19192b(0x232)](_0x19192b(0x206)+_0x488918[_0x19192b(0x1b1)]()));(_0x59ca05||_0x95ba11)&&(_0x119417[_0x19192b(0x23a)]={},_0x59ca05&&(_0x119417['createdAt']['gte']=new Date(_0x59ca05)),_0x95ba11&&(_0x119417[_0x19192b(0x23a)][_0x19192b(0x1a6)]=new Date(_0x95ba11)));_0x582b5f&&(_0x119417['OR']=[{'id':{'contains':_0x582b5f,'mode':_0x19192b(0x21c)}},{'orderId':{'contains':_0x582b5f,'mode':_0x19192b(0x21c)}},{'gatewayOrderId':{'contains':_0x582b5f,'mode':'insensitive'}},{'customerEmail':{'contains':_0x582b5f,'mode':_0x19192b(0x21c)}},{'shop':{'name':{'contains':_0x582b5f,'mode':_0x19192b(0x21c)}}},{'shop':{'username':{'contains':_0x582b5f,'mode':_0x19192b(0x21c)}}}]);console[_0x19192b(0x232)](_0x19192b(0x262),JSON[_0x19192b(0x16f)](_0x119417,null,0x2));let _0x214198={'createdAt':_0x19192b(0x1cd)};if(_0x186304){const _0x342d28=['amount',_0x19192b(0x23a),_0x19192b(0x1d3),_0x19192b(0x1a0),'gateway','currency'],_0x528118=[_0x19192b(0x16d),_0x19192b(0x1cd)];if(_0x342d28['includes'](_0x186304)){const _0x5dbd18=_0x528118[_0x19192b(0x1c4)](_0xbb0f52)?_0xbb0f52:_0x19192b(0x1cd);_0x214198={[_0x186304]:_0x5dbd18},console[_0x19192b(0x232)]('üìä\x20Sorting\x20payments\x20by\x20'+_0x186304+_0x19192b(0x241)+_0x5dbd18+_0x19192b(0x1de));}}const [_0x5a32e3,_0x4ac781]=await Promise[_0x19192b(0x214)]([database_1[_0x19192b(0x17d)][_0x19192b(0x252)]['findMany']({'where':_0x119417,'skip':_0x7e2d81,'take':_0xae72ef,'orderBy':_0x214198,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x19192b(0x17d)][_0x19192b(0x252)]['count']({'where':_0x119417})]);return{'payments':_0x5a32e3[_0x19192b(0x165)](_0x2c7394=>({'id':_0x2c7394['id'],'shopId':_0x2c7394['shopId'],'gateway':_0x2c7394[_0x19192b(0x23e)],'amount':_0x2c7394[_0x19192b(0x1a2)],'currency':_0x2c7394[_0x19192b(0x245)],'status':_0x2c7394[_0x19192b(0x1a0)],'orderId':_0x2c7394[_0x19192b(0x1e3)],'gatewayOrderId':_0x2c7394[_0x19192b(0x182)],'customerEmail':_0x2c7394[_0x19192b(0x1e2)],'customerName':_0x2c7394[_0x19192b(0x1d1)],'customerCountry':_0x2c7394['customerCountry'],'customerIp':_0x2c7394['customerIp'],'customerUa':_0x2c7394[_0x19192b(0x1ff)],'failureMessage':_0x2c7394[_0x19192b(0x218)],'createdAt':_0x2c7394[_0x19192b(0x23a)],'updatedAt':_0x2c7394[_0x19192b(0x1d3)],'shop':_0x2c7394['shop']})),'pagination':{'page':_0x1eec7e,'limit':_0xae72ef,'total':_0x4ac781,'totalPages':Math[_0x19192b(0x26b)](_0x4ac781/_0xae72ef)}};}async[a35_0x1e45b9(0x171)](_0x4ce33f){const _0x21298e=a35_0x1e45b9,_0x840a33=await database_1['default'][_0x21298e(0x252)]['findUnique']({'where':{'id':_0x4ce33f},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x840a33)return null;return{'id':_0x840a33['id'],'shopId':_0x840a33['shopId'],'gateway':_0x840a33[_0x21298e(0x23e)],'amount':_0x840a33[_0x21298e(0x1a2)],'currency':_0x840a33[_0x21298e(0x245)],'status':_0x840a33[_0x21298e(0x1a0)],'orderId':_0x840a33[_0x21298e(0x1e3)],'gatewayOrderId':_0x840a33[_0x21298e(0x182)],'customerEmail':_0x840a33[_0x21298e(0x1e2)],'customerName':_0x840a33[_0x21298e(0x1d1)],'customerCountry':_0x840a33['customerCountry'],'customerIp':_0x840a33[_0x21298e(0x1fe)],'customerUa':_0x840a33[_0x21298e(0x1ff)],'failureMessage':_0x840a33[_0x21298e(0x218)],'externalPaymentUrl':_0x840a33[_0x21298e(0x1a9)],'successUrl':_0x840a33[_0x21298e(0x26c)],'failUrl':_0x840a33['failUrl'],'pendingUrl':_0x840a33['pendingUrl'],'whiteUrl':_0x840a33[_0x21298e(0x1b0)],'createdAt':_0x840a33[_0x21298e(0x23a)],'updatedAt':_0x840a33['updatedAt'],'shop':_0x840a33[_0x21298e(0x175)]};}async[a35_0x1e45b9(0x1b2)](_0x493e3e,_0x12de89,_0x2da514,_0x44e690){const _0x3eec72=a35_0x1e45b9,_0xfa49ae=await database_1[_0x3eec72(0x17d)]['$transaction'](async _0x191d8c=>{const _0x137ab0=_0x3eec72,_0x5e0c5f=await _0x191d8c[_0x137ab0(0x252)]['findUnique']({'where':{'id':_0x493e3e},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x5e0c5f)throw new Error(_0x137ab0(0x15d));const _0x20922e=_0x5e0c5f[_0x137ab0(0x1a0)],_0x406759=_0x12de89['toUpperCase']();console[_0x137ab0(0x232)](_0x137ab0(0x1c6)+_0x493e3e+_0x137ab0(0x17a)+_0x20922e+'\x20->\x20'+_0x406759),console[_0x137ab0(0x232)](_0x137ab0(0x1ec)+_0x5e0c5f['shop']['balance']+'\x20USDT');const _0x4d60cb={'status':_0x406759,'updatedAt':new Date(),'statusChangedBy':_0x137ab0(0x1aa),'statusChangedAt':new Date()};_0x2da514&&(_0x4d60cb[_0x137ab0(0x184)]=_0x2da514);_0x406759===_0x137ab0(0x25f)&&_0x44e690&&(_0x4d60cb['chargebackAmount']=_0x44e690);let _0x1f5ecc=0x0,_0x416135=_0x5e0c5f[_0x137ab0(0x175)][_0x137ab0(0x215)];if(_0x406759===_0x137ab0(0x25b)&&_0x20922e!==_0x137ab0(0x25b)){_0x4d60cb[_0x137ab0(0x1f0)]=new Date();const _0x295fe1=await currencyService_1[_0x137ab0(0x1e7)][_0x137ab0(0x167)](_0x5e0c5f[_0x137ab0(0x1a2)],_0x5e0c5f['currency']);_0x4d60cb[_0x137ab0(0x21f)]=_0x295fe1,_0x1f5ecc=_0x295fe1,_0x416135+=_0x295fe1,console[_0x137ab0(0x232)](_0x137ab0(0x1eb)+_0x493e3e+_0x137ab0(0x18d)+_0x295fe1[_0x137ab0(0x1e4)](0x6)+_0x137ab0(0x1c9));}else _0x20922e===_0x137ab0(0x25b)&&_0x406759!==_0x137ab0(0x25b)&&(_0x5e0c5f[_0x137ab0(0x21f)]&&(_0x1f5ecc=-_0x5e0c5f[_0x137ab0(0x21f)],_0x416135-=_0x5e0c5f['amountUSDT'],_0x4d60cb['amountUSDT']=null,console[_0x137ab0(0x232)](_0x137ab0(0x1eb)+_0x493e3e+_0x137ab0(0x242)+_0x5e0c5f[_0x137ab0(0x21f)]['toFixed'](0x6)+_0x137ab0(0x256))));if(_0x406759===_0x137ab0(0x25f)){if(_0x20922e===_0x137ab0(0x25b)&&_0x5e0c5f[_0x137ab0(0x21f)]){}_0x44e690&&_0x44e690>0x0&&(_0x1f5ecc-=_0x44e690,_0x416135-=_0x44e690,console[_0x137ab0(0x232)](_0x137ab0(0x16a)+_0x44e690[_0x137ab0(0x1e4)](0x6)+'\x20USDT\x20from\x20balance'));}_0x406759==='REFUND'&&_0x20922e===_0x137ab0(0x25b)&&console[_0x137ab0(0x232)]('üîÑ\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance');const _0xbd1cc1=await _0x191d8c[_0x137ab0(0x252)]['update']({'where':{'id':_0x493e3e},'data':_0x4d60cb,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x1f5ecc!==0x0&&(await _0x191d8c[_0x137ab0(0x175)][_0x137ab0(0x1bc)]({'where':{'id':_0x5e0c5f[_0x137ab0(0x1d6)]},'data':{'balance':_0x416135}}),console[_0x137ab0(0x232)]('üí∞\x20Shop\x20'+_0x5e0c5f[_0x137ab0(0x1d6)]+_0x137ab0(0x1df)+_0x5e0c5f[_0x137ab0(0x175)][_0x137ab0(0x215)][_0x137ab0(0x1e4)](0x6)+_0x137ab0(0x1c0)+_0x416135[_0x137ab0(0x1e4)](0x6)+'\x20USDT\x20('+(_0x1f5ecc>0x0?'+':'')+_0x1f5ecc['toFixed'](0x6)+')')),_0xbd1cc1;});return{'id':_0xfa49ae['id'],'shopId':_0xfa49ae[_0x3eec72(0x1d6)],'gateway':_0xfa49ae[_0x3eec72(0x23e)],'amount':_0xfa49ae[_0x3eec72(0x1a2)],'currency':_0xfa49ae[_0x3eec72(0x245)],'status':_0xfa49ae[_0x3eec72(0x1a0)],'orderId':_0xfa49ae['orderId'],'gatewayOrderId':_0xfa49ae[_0x3eec72(0x182)],'customerEmail':_0xfa49ae['customerEmail'],'customerName':_0xfa49ae[_0x3eec72(0x1d1)],'customerCountry':_0xfa49ae[_0x3eec72(0x22a)],'customerIp':_0xfa49ae[_0x3eec72(0x1fe)],'customerUa':_0xfa49ae[_0x3eec72(0x1ff)],'failureMessage':_0xfa49ae['failureMessage'],'adminNotes':_0xfa49ae[_0x3eec72(0x184)],'chargebackAmount':_0xfa49ae[_0x3eec72(0x266)],'statusChangedBy':_0xfa49ae[_0x3eec72(0x209)],'statusChangedAt':_0xfa49ae[_0x3eec72(0x238)],'createdAt':_0xfa49ae[_0x3eec72(0x23a)],'updatedAt':_0xfa49ae[_0x3eec72(0x1d3)],'shop':_0xfa49ae[_0x3eec72(0x175)]};}async['updateUser'](_0x5cb514,_0x13e6a1){const _0x3d15fd=a35_0x1e45b9,_0x59880e={..._0x13e6a1};_0x13e6a1[_0x3d15fd(0x1dd)]&&(_0x59880e[_0x3d15fd(0x1dd)]=await bcryptjs_1[_0x3d15fd(0x17d)][_0x3d15fd(0x205)](_0x13e6a1[_0x3d15fd(0x1dd)],0xc));_0x13e6a1[_0x3d15fd(0x24c)]&&(_0x59880e[_0x3d15fd(0x1ab)]=_0x13e6a1[_0x3d15fd(0x24c)],delete _0x59880e['fullName']);_0x13e6a1[_0x3d15fd(0x251)]&&(_0x59880e[_0x3d15fd(0x267)]=_0x13e6a1[_0x3d15fd(0x251)],delete _0x59880e[_0x3d15fd(0x251)]);_0x13e6a1[_0x3d15fd(0x179)]&&(_0x59880e['shopUrl']=_0x13e6a1[_0x3d15fd(0x179)],delete _0x59880e[_0x3d15fd(0x179)]);_0x13e6a1['gateways']&&(_0x59880e[_0x3d15fd(0x222)]=JSON[_0x3d15fd(0x16f)](_0x13e6a1['gateways']),delete _0x59880e[_0x3d15fd(0x224)]);_0x13e6a1[_0x3d15fd(0x24d)]&&(_0x59880e[_0x3d15fd(0x24d)]=JSON['stringify'](_0x13e6a1[_0x3d15fd(0x24d)]),delete _0x59880e[_0x3d15fd(0x24d)]);_0x13e6a1[_0x3d15fd(0x181)]&&(_0x13e6a1[_0x3d15fd(0x181)][_0x3d15fd(0x196)]!==undefined&&(_0x59880e[_0x3d15fd(0x196)]=_0x13e6a1['wallets'][_0x3d15fd(0x196)]||null),_0x13e6a1[_0x3d15fd(0x181)][_0x3d15fd(0x228)]!==undefined&&(_0x59880e['usdtTrcWallet']=_0x13e6a1[_0x3d15fd(0x181)][_0x3d15fd(0x228)]||null),_0x13e6a1[_0x3d15fd(0x181)]['usdtErcWallet']!==undefined&&(_0x59880e[_0x3d15fd(0x239)]=_0x13e6a1[_0x3d15fd(0x181)][_0x3d15fd(0x239)]||null),_0x13e6a1[_0x3d15fd(0x181)][_0x3d15fd(0x226)]!==undefined&&(_0x59880e[_0x3d15fd(0x226)]=_0x13e6a1[_0x3d15fd(0x181)]['usdcPolygonWallet']||null),delete _0x59880e['wallets']);const _0x28c630=await database_1[_0x3d15fd(0x17d)][_0x3d15fd(0x175)][_0x3d15fd(0x1bc)]({'where':{'id':_0x5cb514},'data':_0x59880e,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x28c630['id'],'fullName':_0x28c630['name'],'username':_0x28c630[_0x3d15fd(0x255)],'telegramId':_0x28c630[_0x3d15fd(0x267)],'merchantUrl':_0x28c630['shopUrl'],'gateways':_0x28c630[_0x3d15fd(0x222)]?JSON['parse'](_0x28c630[_0x3d15fd(0x222)]):null,'gatewaySettings':_0x28c630[_0x3d15fd(0x24d)]?JSON[_0x3d15fd(0x269)](_0x28c630[_0x3d15fd(0x24d)]):null,'publicKey':_0x28c630[_0x3d15fd(0x188)],'wallets':{'usdtPolygonWallet':_0x28c630[_0x3d15fd(0x196)],'usdtTrcWallet':_0x28c630[_0x3d15fd(0x228)],'usdtErcWallet':_0x28c630[_0x3d15fd(0x239)],'usdcPolygonWallet':_0x28c630['usdcPolygonWallet']},'status':_0x28c630[_0x3d15fd(0x1a0)],'createdAt':_0x28c630[_0x3d15fd(0x23a)]};}async[a35_0x1e45b9(0x170)](_0x131fa2){const _0x520f83=a35_0x1e45b9,_0x2e80c1=await database_1[_0x520f83(0x17d)][_0x520f83(0x175)][_0x520f83(0x1bc)]({'where':{'id':_0x131fa2},'data':{'status':'SUSPENDED'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2e80c1['id'],'fullName':_0x2e80c1[_0x520f83(0x1ab)],'username':_0x2e80c1[_0x520f83(0x255)],'telegramId':_0x2e80c1[_0x520f83(0x267)],'merchantUrl':_0x2e80c1[_0x520f83(0x1a1)],'gateways':_0x2e80c1[_0x520f83(0x222)]?JSON[_0x520f83(0x269)](_0x2e80c1[_0x520f83(0x222)]):null,'gatewaySettings':_0x2e80c1['gatewaySettings']?JSON[_0x520f83(0x269)](_0x2e80c1[_0x520f83(0x24d)]):null,'publicKey':_0x2e80c1[_0x520f83(0x188)],'wallets':{'usdtPolygonWallet':_0x2e80c1[_0x520f83(0x196)],'usdtTrcWallet':_0x2e80c1[_0x520f83(0x228)],'usdtErcWallet':_0x2e80c1['usdtErcWallet'],'usdcPolygonWallet':_0x2e80c1[_0x520f83(0x226)]},'status':_0x2e80c1[_0x520f83(0x1a0)],'createdAt':_0x2e80c1[_0x520f83(0x23a)]};}async[a35_0x1e45b9(0x219)](_0x2ba581){const _0xa8e592=a35_0x1e45b9,_0x4d42f9=await database_1[_0xa8e592(0x17d)][_0xa8e592(0x175)][_0xa8e592(0x1bc)]({'where':{'id':_0x2ba581},'data':{'status':_0xa8e592(0x1ea)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4d42f9['id'],'fullName':_0x4d42f9[_0xa8e592(0x1ab)],'username':_0x4d42f9[_0xa8e592(0x255)],'telegramId':_0x4d42f9['telegram'],'merchantUrl':_0x4d42f9['shopUrl'],'gateways':_0x4d42f9[_0xa8e592(0x222)]?JSON[_0xa8e592(0x269)](_0x4d42f9[_0xa8e592(0x222)]):null,'gatewaySettings':_0x4d42f9[_0xa8e592(0x24d)]?JSON['parse'](_0x4d42f9[_0xa8e592(0x24d)]):null,'publicKey':_0x4d42f9['publicKey'],'wallets':{'usdtPolygonWallet':_0x4d42f9[_0xa8e592(0x196)],'usdtTrcWallet':_0x4d42f9[_0xa8e592(0x228)],'usdtErcWallet':_0x4d42f9[_0xa8e592(0x239)],'usdcPolygonWallet':_0x4d42f9[_0xa8e592(0x226)]},'status':_0x4d42f9[_0xa8e592(0x1a0)],'createdAt':_0x4d42f9[_0xa8e592(0x23a)]};}async[a35_0x1e45b9(0x19b)](_0x382151){const _0x4a12d0=a35_0x1e45b9,{page:_0x19fdf2,limit:_0x447e10,status:_0x2c6640}=_0x382151,_0x5059d5=(_0x19fdf2-0x1)*_0x447e10,_0x12a8bf={};_0x2c6640&&(_0x12a8bf[_0x4a12d0(0x1a0)]=_0x2c6640['toUpperCase']());const [_0x5abdb7,_0x45b86b]=await Promise[_0x4a12d0(0x214)]([database_1[_0x4a12d0(0x17d)][_0x4a12d0(0x175)][_0x4a12d0(0x220)]({'where':_0x12a8bf,'skip':_0x5059d5,'take':_0x447e10,'orderBy':{'createdAt':_0x4a12d0(0x1cd)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x4a12d0(0x17d)][_0x4a12d0(0x175)][_0x4a12d0(0x1a7)]({'where':_0x12a8bf})]);return{'users':_0x5abdb7[_0x4a12d0(0x165)](_0x2b9e19=>({'id':_0x2b9e19['id'],'fullName':_0x2b9e19['name'],'username':_0x2b9e19['username'],'telegramId':_0x2b9e19['telegram'],'merchantUrl':_0x2b9e19[_0x4a12d0(0x1a1)],'gateways':_0x2b9e19[_0x4a12d0(0x222)]?JSON[_0x4a12d0(0x269)](_0x2b9e19[_0x4a12d0(0x222)]):null,'gatewaySettings':_0x2b9e19[_0x4a12d0(0x24d)]?JSON[_0x4a12d0(0x269)](_0x2b9e19[_0x4a12d0(0x24d)]):null,'publicKey':_0x2b9e19[_0x4a12d0(0x188)],'wallets':{'usdtPolygonWallet':_0x2b9e19[_0x4a12d0(0x196)],'usdtTrcWallet':_0x2b9e19[_0x4a12d0(0x228)],'usdtErcWallet':_0x2b9e19[_0x4a12d0(0x239)],'usdcPolygonWallet':_0x2b9e19['usdcPolygonWallet']},'status':_0x2b9e19[_0x4a12d0(0x1a0)],'createdAt':_0x2b9e19[_0x4a12d0(0x23a)]})),'pagination':{'page':_0x19fdf2,'limit':_0x447e10,'total':_0x45b86b,'totalPages':Math['ceil'](_0x45b86b/_0x447e10)}};}async[a35_0x1e45b9(0x15f)](_0x2c6a8a){const _0x3bf870=a35_0x1e45b9,_0x691bd9=await database_1['default'][_0x3bf870(0x175)][_0x3bf870(0x177)]({'where':{'id':_0x2c6a8a},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x691bd9)return null;return{'id':_0x691bd9['id'],'fullName':_0x691bd9['name'],'username':_0x691bd9[_0x3bf870(0x255)],'telegramId':_0x691bd9['telegram'],'merchantUrl':_0x691bd9[_0x3bf870(0x1a1)],'gateways':_0x691bd9[_0x3bf870(0x222)]?JSON[_0x3bf870(0x269)](_0x691bd9[_0x3bf870(0x222)]):null,'gatewaySettings':_0x691bd9[_0x3bf870(0x24d)]?JSON[_0x3bf870(0x269)](_0x691bd9['gatewaySettings']):null,'publicKey':_0x691bd9['publicKey'],'wallets':{'usdtPolygonWallet':_0x691bd9[_0x3bf870(0x196)],'usdtTrcWallet':_0x691bd9[_0x3bf870(0x228)],'usdtErcWallet':_0x691bd9['usdtErcWallet'],'usdcPolygonWallet':_0x691bd9['usdcPolygonWallet']},'status':_0x691bd9[_0x3bf870(0x1a0)],'createdAt':_0x691bd9[_0x3bf870(0x23a)]};}async[a35_0x1e45b9(0x172)](_0x51745f){const _0x23bca3=a35_0x1e45b9,{fullName:_0xc890d3,username:_0x1dfdcb,password:_0x321a9f,telegramId:_0x45f8e8,merchantUrl:_0x113eae,gateways:_0x21330e,gatewaySettings:_0x33a663,wallets:_0x1e2a17}=_0x51745f,_0x54995b=await database_1[_0x23bca3(0x17d)]['shop'][_0x23bca3(0x177)]({'where':{'username':_0x1dfdcb}});if(_0x54995b)throw new Error(_0x23bca3(0x231));if(_0x45f8e8){const _0xa96f7=await database_1[_0x23bca3(0x17d)]['shop'][_0x23bca3(0x177)]({'where':{'telegram':_0x45f8e8}});if(_0xa96f7)throw new Error(_0x23bca3(0x229));}const _0x183faa=await bcryptjs_1[_0x23bca3(0x17d)]['hash'](_0x321a9f,0xc),_0x309eb9=_0x23bca3(0x1a3)+crypto_1[_0x23bca3(0x17d)]['randomBytes'](0x20)['toString'](_0x23bca3(0x207)),_0x561038=_0x23bca3(0x187)+crypto_1[_0x23bca3(0x17d)][_0x23bca3(0x191)](0x20)[_0x23bca3(0x19c)](_0x23bca3(0x207)),_0x5ba163=await database_1['default'][_0x23bca3(0x175)][_0x23bca3(0x20a)]({'data':{'name':_0xc890d3,'username':_0x1dfdcb,'password':_0x183faa,'telegram':_0x45f8e8,'shopUrl':_0x113eae,'paymentGateways':_0x21330e?JSON[_0x23bca3(0x16f)](_0x21330e):null,'gatewaySettings':_0x33a663?JSON[_0x23bca3(0x16f)](_0x33a663):null,'usdtPolygonWallet':_0x1e2a17?.[_0x23bca3(0x196)]||null,'usdtTrcWallet':_0x1e2a17?.[_0x23bca3(0x228)]||null,'usdtErcWallet':_0x1e2a17?.[_0x23bca3(0x239)]||null,'usdcPolygonWallet':_0x1e2a17?.['usdcPolygonWallet']||null,'publicKey':_0x309eb9,'secretKey':_0x561038,'status':_0x23bca3(0x1ea)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x5ba163['id'],'fullName':_0x5ba163['name'],'username':_0x5ba163[_0x23bca3(0x255)],'telegramId':_0x5ba163['telegram'],'merchantUrl':_0x5ba163[_0x23bca3(0x1a1)],'gateways':_0x5ba163[_0x23bca3(0x222)]?JSON['parse'](_0x5ba163['paymentGateways']):null,'gatewaySettings':_0x5ba163['gatewaySettings']?JSON[_0x23bca3(0x269)](_0x5ba163[_0x23bca3(0x24d)]):null,'publicKey':_0x5ba163[_0x23bca3(0x188)],'wallets':{'usdtPolygonWallet':_0x5ba163[_0x23bca3(0x196)],'usdtTrcWallet':_0x5ba163[_0x23bca3(0x228)],'usdtErcWallet':_0x5ba163[_0x23bca3(0x239)],'usdcPolygonWallet':_0x5ba163[_0x23bca3(0x226)]},'status':_0x5ba163[_0x23bca3(0x1a0)],'createdAt':_0x5ba163[_0x23bca3(0x23a)]};}async[a35_0x1e45b9(0x1ba)](_0x206091){const _0x1364ed=a35_0x1e45b9;await database_1[_0x1364ed(0x17d)][_0x1364ed(0x175)][_0x1364ed(0x192)]({'where':{'id':_0x206091}});}[a35_0x1e45b9(0x180)](_0x11fa95,_0x13fbb3,_0x597b69){const _0x534e80=a35_0x1e45b9,_0x49dd3b=new Map(),_0x5e0060=new Date(_0x13fbb3);while(_0x5e0060<=_0x597b69){const _0x1f2e0a=_0x5e0060[_0x534e80(0x18b)]()[_0x534e80(0x1e5)]('T')[0x0];_0x49dd3b[_0x534e80(0x225)](_0x1f2e0a,{'revenue':0x0,'count':0x0}),_0x5e0060[_0x534e80(0x257)](_0x5e0060[_0x534e80(0x1bb)]()+0x1);}for(const _0x58cc29 of _0x11fa95){const _0x163f82=_0x58cc29[_0x534e80(0x23a)]['toISOString']()[_0x534e80(0x1e5)]('T')[0x0],_0x1a3872=_0x49dd3b[_0x534e80(0x200)](_0x163f82);_0x1a3872&&(_0x1a3872[_0x534e80(0x1a7)]+=0x1,_0x58cc29[_0x534e80(0x1a0)]==='PAID'&&(_0x58cc29['amountUSDT']?_0x1a3872[_0x534e80(0x1f8)]+=_0x58cc29[_0x534e80(0x21f)]:console['log'](_0x534e80(0x18a)+_0x58cc29['id']+'\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion')));}const _0x54c45b=[],_0x562315=[];for(const [_0x9118df,_0x5de358]of _0x49dd3b){_0x54c45b['push']({'date':_0x9118df,'amount':Math['round'](_0x5de358[_0x534e80(0x1f8)]*0x64)/0x64}),_0x562315[_0x534e80(0x24f)]({'date':_0x9118df,'count':_0x5de358['count']});}return{'dailyRevenue':_0x54c45b,'dailyPayments':_0x562315};}}exports['AdminService']=AdminService;