'use strict';const a53_0x22e8f6=a53_0x222d;(function(_0x559710,_0x2eeb44){const _0x27f17d=a53_0x222d,_0x28d2c2=_0x559710();while(!![]){try{const _0x116446=parseInt(_0x27f17d(0x1b0))/0x1*(parseInt(_0x27f17d(0x1a7))/0x2)+-parseInt(_0x27f17d(0xaf))/0x3+-parseInt(_0x27f17d(0xb8))/0x4+-parseInt(_0x27f17d(0xbf))/0x5*(parseInt(_0x27f17d(0x1fd))/0x6)+parseInt(_0x27f17d(0x12d))/0x7+parseInt(_0x27f17d(0x10d))/0x8*(parseInt(_0x27f17d(0x188))/0x9)+-parseInt(_0x27f17d(0x105))/0xa*(-parseInt(_0x27f17d(0x22f))/0xb);if(_0x116446===_0x2eeb44)break;else _0x28d2c2['push'](_0x28d2c2['shift']());}catch(_0x30cfda){_0x28d2c2['push'](_0x28d2c2['shift']());}}}(a53_0xdf7c,0x5e307));var __importDefault=this&&this[a53_0x22e8f6(0x10a)]||function(_0x9cdafc){return _0x9cdafc&&_0x9cdafc['__esModule']?_0x9cdafc:{'default':_0x9cdafc};};function a53_0xdf7c(){const _0xe53c08=['substr','_sum','forEach','ðŸ”\x20Admin\x20password\x20changed\x20successfully','periodTo','\x20\x20\x20ðŸ”\x20Calculated\x20after\x20commission:\x20','ðŸ“±\x20Telegram\x20notification\x20sent\x20for\x20payout\x20','merchantUrl','\x20\x20\x20ðŸ“…\x20Total\x20payouts\x20(this\x20month):\x20','CHARGEBACK','\x27\x20to\x20name\x20\x27','\x20USDT\x20(','\x20\x20\x20Available\x20(number):\x20','klyme_eu','currencyService','amountAfterGatewayCommissionUSDT','\x20\x20\x20Current\x20network:\x20','Amer','\x20balance\x20updated:','polygon','./telegramBotService','push','\x20\x20\x20Amount\x20decreased\x20by\x20','delete','1341445mRMqiU','config','\x20payments)','entries','statusChangedBy','findFirst','updateUser','setHours','ADMIN_2FA_SECRET=','getGatewayDisplayName','gte','âš ï¸\x20CHARGEBACK\x20without\x20penalty\x20amount\x20-\x20no\x20balance\x20change','\x20USDT\x20(same\x20as\x20awaiting)','totalAmount','ðŸ”\x20Using\x20gateway\x20\x27','updatedAt','customerName','ðŸ“Š\x20Total\x20payments\x20(including\x20failed):\x20','customerCountry','slice','default','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','\x20\x20\x20Amount\x20difference:\x20','CoinToPay','averageCheckUSDT','randomBytes','dailyRevenue','ðŸ“Š\x20Sorting\x20payments\x20by\x20','ðŸ’°\x20Found\x20','updatePaymentStatus','name','updatePayout','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','ðŸ“…\x20Period:\x20','ðŸ“…\x20Payout\x20date\x20from\x20filter:\x20','qrcode','warn','toFixed','\x20\x20\x20Merchant\x20gets:\x20','week','\x20\x20\x20ðŸ’¸\x20Total\x20payouts\x20(all\x20time):\x20','insensitive','USDC','telegramBotService','status','paymentGateways','REFUND','verify','dateTo','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','usdcPolygonWallet','Error\x20parsing\x20backup\x20codes:','\x20USDT,\x20Requested:\x20','ACTIVE','lte','count','getDate','hash','EXPIRED','passwordHash','ðŸ”„\x20Converted\x20gateway\x20ID\x20\x27','\x20USDT,\x20Difference:\x20','MyXSpend','Interac','sendPayoutNotification','create','turnover','klyme_gb','lastLoginAt','\x20-\x20','setupAdmin2FA','\x20\x20\x20ðŸ’°\x20Total\x20payments\x20turnover:\x20','ðŸ“Š\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','random','changeAdminPassword','ðŸ”\x20Admin\x202FA\x20setup\x20initiated','findUnique','ðŸ“…\x20Date\x20from\x20filter:\x20','filter','merchantEarnings','\x20USDT)','ðŸ“Š\x20Generated\x20reports\x20for\x20','createdAt','\x20\x20\x20Total\x20paid\x20out:\x20','ðŸ“Š\x20Merchants\x20with\x20rounded\x20balance\x20!=\x200.00:\x20','map','ðŸ”„\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','groupBy','externalPaymentUrl','ðŸ”Œ\x20Gateway:\x20','\x20\x20\x20Current\x20balance:\x20','18hYpedA','from','totalPayout','\x20\x20\x20ðŸ’¸\x20Total\x20payouts:\x20','UTC','custom_','paymentsCount','ðŸŽ¯\x20updateUser\x20called\x20with\x20ID:\x20','\x20\x20\x20ðŸ’°\x20Total\x20turnover:\x20','toLowerCase','abs','Telegram\x20username\x20already\x20exists','ðŸ”\x20No\x20wallet\x20provided,\x20looking\x20up\x20from\x20shop\x20settings...',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','cwd','totalPayments','twoFactorSecret','gateways','ðŸ’°\x20Payment\x20amount\x20is\x20NOT\x20deducted\x20(chargeback\x20penalty\x20only)','this_week','round','getGatewayInternalName','otpauth_url','getUTCDay','existsSync','../config/config','values','username','toDataURL','merchantId','2FA\x20is\x20already\x20enabled','16TgORaZ','notes','\x20\x20\x20New\x20amount:\x20','ðŸ”„\x20Admin\x20updating\x20payment\x20','MasterCard',',\x20refunds:\x20','Test\x20Gateway','setup2FA','ðŸ”\x20Shop\x20wallets:','21652VUfntr','getAllPayouts','getUTCMonth','Deposit','totp','reduce','getPaymentById','pk_','ðŸ“Š\x20Statistics\x20date\x20range:\x20','AmPay',',\x20Commission:\x20','\x20\x20\x20ðŸ’°\x20Total\x20payout:\x20','ðŸ“Š\x20Calculating\x20payout\x20statistics...','getTime','klyme_de','Payment\x20not\x20found','noda','custom','ðŸ“Š\x20Gateway\x20filter\x20applied:','paidOutUSDT','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','gateway','sk_','cointopay2','\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...','\x20USDT\x20-\x20will\x20return\x20to\x20balance','AmPay\x20TRY','backupCodes','gatewayCommissionRate','ðŸ“…\x20Date\x20to\x20filter:\x20','0000','ðŸ”„\x20Gateway\x20mapping:','\x20USDT,\x20merchant:\x20','period','crypto','all','Invalid\x202FA\x20token','\x20USDT\x20(theoretical\x20net)','\x20USDT\x20for\x20payment\x20','getAllUsers','âœ…\x20Using\x20gateway\x20filter:\x20\x27','totalPaidOut','base32','balance','sort','__esModule','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','\x20has\x20zero\x20or\x20null\x20merchant\x20amount,\x20skipping...','telegramId','splice','amountAfterCommissionUSDT','getPayoutStats','\x20\x20\x20Available\x20(raw):\x20','âœ…\x20Deposited\x20','ðŸ’°\x20Payment\x20','join','ru-RU','defineProperty','ðŸ“Š\x20Merchant\x20statistics\x20calculated:','failUrl','wallets','createUser','ðŸ’°\x20Shop\x20','password','COMPLETED','ðŸ”\x20Balance\x20check\x20details:','ðŸ”\x20Initial\x20wallet\x20from\x20request:\x20','_count','network','toISOString','Insufficient\x20balance.\x20Available:\x20','stringify','findMany','toUpperCase','some','month','TrapaPay\x20Admin\x20(','42GHXJBF','telegram','totalAmountAfterCommissionUSDT','ðŸ”\x20Admin\x202FA\x20disabled','ðŸ“Š\x20Getting\x20payments\x20with\x20filters:','gatewaySettings',']\x20Gateway\x20settings\x20JSON\x20string:','test_gateway','startsWith','activateUser','customerIp','getUserById','$transaction','TrapaPay\x20Admin','ðŸ’°\x20[PAYOUT]\x20Gateway\x20','ðŸ“‹\x20Getting\x20merchants\x20selection\x20list...','merchantEarningsUSDT','ðŸ”\x20Selected\x20trc20\x20wallet:\x20','KLYME\x20EU','setUTCDate','âš ï¸\x20Payment\x20','\x20USDT\x20-\x20will\x20deduct\x20from\x20balance','\x20backup\x20codes','\x20\x20\x20Requested\x20(number):\x20','2FA\x20token\x20is\x20required','AdminService','\x20\x20\x20ï¿½ðŸ“Š\x20Total\x20payments:\x20','Rapyd','ðŸ’¸\x20CHARGEBACK:\x20Processing\x20penalty-only\x20deduction','utf8','Error\x20processing\x20payment\x20','today','cointopay','KLYME\x20DE',':\x20commission\x20=\x20','\x20\x20\x20Shop\x20totalPaidOut:\x20',']\x20Gateway\x20settings\x20before\x20saving:','payouts','ðŸ”§\x20[','date','2FA\x20not\x20set\x20up.\x20Please\x20call\x20setup\x20endpoint\x20first','error','âŒ\x20Failed\x20to\x20send\x20Telegram\x20notification\x20for\x20payout\x20','chargebackAmount','\x20\x20\x20Transaction\x20hash:\x20','\x20merchants\x20for\x20selection','ðŸ“Š\x20Calculated\x20commission\x20rate\x20for\x20payment\x20','currency','mastercard','ðŸ”‘\x20Generated\x20','2959UmHJbP','getFullYear','disable2FA','.env','totalCommissionRate','shop','ðŸ“Š\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20','orderId','ðŸ“Š\x20Statistics\x20WHERE\x20conditions:','\x20\x20\x20ðŸ’³\x20Total\x20payments:\x20','\x20\x20\x20Current\x20amount:\x20','thisMonth','fullName','\x20\x20\x20Shop\x20balance:\x20','has','usdcErcWallet','\x20USDT\x20(gross\x20revenue)','ADMIN_PASSWORD_HASH=','ðŸ”\x202FA\x20enabled\x20for\x20shop:\x20','\x20with\x20payout\x20history','generateSecret','amountUSDT','%\x20from\x20','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','yesterday','ÐÐµ\x20ÑƒÐºÐ°Ð·Ð°Ð½','ðŸ“Š\x20Getting\x20merchant\x20statistics\x20with\x20filters:','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','availableBalance','ðŸ”„\x20Gateway\x20mapping\x20(create):','readFileSync','not\x20provided','min','update','all_time','2020-01-01','erc20','successUrl','ðŸ’°\x20[PAYOUT]\x20Merchant\x20','deleteUser','ðŸ”\x20Selected\x20polygon\x20wallet:\x20','payout','getUTCDate','ðŸ’°\x20Creating\x20payout\x20for\x20shop\x20','ðŸ“Š\x20Using\x20saved\x20values\x20for\x20payment\x20','rapyd','polygon_usdc','../types/gateway','setDate','periodFrom','getGatewayNameById','\x20USDT',']\x20Updating\x20password\x20for\x20user\x20','getUTCFullYear','ADMIN_2FA_ENABLED=','wallet','bcryptjs','ADMIN_BACKUP_CODES=','turnoverUSDT','ADMIN_2FA_ENABLED=true','shopUrl','Plisio','hex','\x20\x20\x20ðŸŒ\x20Country:\x20','\x20paid\x20payments\x20for\x20gateway\x20','getPayoutReports','asc','adminNotes','USDT','generateDailyStatistics','\x20->\x20','twoFactorEnabled','admin','ðŸ”\x20[','length','\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)','\x20became\x20PAID:','\x20\x20\x20Added\x20to\x20balance:\x20+','ðŸ’°\x20Current\x20shop\x20balance:\x20','writeFileSync','gatewayEarnings','ðŸ”\x20Total\x20payments\x20matching\x20filters:\x20','amount','customerUa','âœ…\x20Balance\x20check\x20passed\x20(with\x20tolerance)','548259eOXMVn','\x20\x20\x20âœ…\x20Actual\x20available\x20balance:\x20','getSystemStatistics','\x20\x20\x20âœ…\x20Total\x20net\x20balances:\x20','parse','pendingPayout','usdtPolygonWallet','PENDING','KLYME\x20GB','2238480ZWZutC','getAllPayments','PAID','aggregate',',\x20chargebacks:\x20','ðŸ“Š\x20Available\x20gateways\x20in\x20database:','localeCompare','532790fIuJCF','SUSPENDED','disableAdmin2FA','get','\x20\x20\x20ðŸ“…\x20This\x20month:\x20','last_month','\x20\x20\x20Gateway:\x20','\x20\x20\x20ðŸ‘¤\x20Merchant\x20earnings:\x20','commission','\x20USDC\x20to\x20merchant\x20','\x20\x20\x20Full\x20amount:\x20','revenue','log','convertToUSDT','\x20\x20\x20Merchant\x20loses:\x20','customerEmail','\x20merchants','OnRamp','split','includes','payment','merchantName','not\x20set','paidAt','%\x20commission)','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','\x20USDT,\x20Required:\x20','ðŸ”„\x20Converted\x20gateway\x20name\x20\x27',',\x20successful:\x20','getMonth','\x27\x20(from\x20\x27','ðŸ“Š\x20Getting\x20payout\x20reports\x20with\x20filters:','toString','ðŸ”\x20Creating\x20payout\x20with\x20data:','\x20paid\x20payments\x20for\x20analysis','\x20USDT\x20(current\x20balance\x20in\x20DB)',',\x20userId:\x20','\x20\x20\x20ðŸŒ\x20IP:\x20','set',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','../config/database','getShopWallets','ðŸ”„\x20Updating\x20customer\x20data\x20for\x20payment\x20','NONEXISTENT_GATEWAY_FILTER','enable2FA','dateFrom','ADMIN_2FA_ENABLED=false','usdtErcWallet','commissionUSDT','ðŸ’¸\x20CHARGEBACK\x20penalty\x20ONLY:\x20-','CRYPTO','shopId','\x20\x20\x20â³\x20Pending\x20payout:\x20','\x20to\x20','usdtTrcWallet','ðŸ“…\x20Payout\x20date\x20to\x20filter:\x20','lastMonth','replace','ðŸ“Š\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','Shop\x20not\x20found','\x20PAID\x20payments','\x20for\x20shop\x20','gatewayOrderId','failureMessage','âœ…\x20Using\x20wallet\x20from\x20request:\x20','Invalid\x202FA\x20token\x20or\x20backup\x20code','desc','\x20\x20\x20ðŸ¤”\x20Difference:\x20','\x20\x20\x20Difference:\x20','trc20','36130KUbvQW','publicKey','\x27\x20not\x20found.\x20Available\x20gateways:\x20','generateBackupCodes','last_week','__importDefault','\x20\x20\x20ðŸ’µ\x20Available\x20balance:\x20','\x20USDT\x20(after\x20','2149320niGcuI','compare','\x20\x20\x20Amount\x20increased\x20by\x20','CoinToPay2','txid','ceil','ðŸ”„\x20Gateway\x20mapping\x20(get):','\x20\x20\x20Balance:\x20'];a53_0xdf7c=function(){return _0xe53c08;};return a53_0xdf7c();}Object[a53_0x22e8f6(0x1e9)](exports,a53_0x22e8f6(0x1dd),{'value':!![]}),exports[a53_0x22e8f6(0x216)]=void 0x0;const database_1=__importDefault(require(a53_0x22e8f6(0xe7))),bcryptjs_1=__importDefault(require(a53_0x22e8f6(0x267))),crypto_1=__importDefault(require(a53_0x22e8f6(0x1d2))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path')),speakeasy_1=__importDefault(require('speakeasy')),qrcode_1=__importDefault(require(a53_0x22e8f6(0x150))),config_1=require(a53_0x22e8f6(0x1a1)),currencyService_1=require('./currencyService'),telegramBotService_1=require(a53_0x22e8f6(0x129)),gateway_1=require(a53_0x22e8f6(0x25e));class AdminService{async[a53_0x22e8f6(0x1e3)](){const _0x2c595e=a53_0x22e8f6;console[_0x2c595e(0xcb)](_0x2c595e(0x1bc));const _0x4c27fe=await database_1[_0x2c595e(0x141)][_0x2c595e(0x234)][_0x2c595e(0xbb)]({'_sum':{'balance':!![],'totalPaidOut':!![]}}),_0x2a2704=await database_1[_0x2c595e(0x141)]['payment'][_0x2c595e(0x164)]({'where':{'status':_0x2c595e(0xba),'gateway':{'not':_0x2c595e(0x204)}}}),_0x2d92c4=new Date(),_0x68c9e0=new Date(_0x2d92c4[_0x2c595e(0x230)](),_0x2d92c4['getMonth'](),0x1),_0x19d83b=new Date(_0x2d92c4[_0x2c595e(0x230)](),_0x2d92c4[_0x2c595e(0xdc)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x424a5a=await database_1[_0x2c595e(0x141)][_0x2c595e(0x258)][_0x2c595e(0xbb)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x68c9e0,'lte':_0x19d83b},'status':_0x2c595e(0x1f0)}}),_0x207392=_0x4c27fe[_0x2c595e(0x116)][_0x2c595e(0x1d9)]||0x0,_0x5b8686=_0x4c27fe['_sum'][_0x2c595e(0x1db)]||0x0,_0x2eb5cb=_0x424a5a['_sum'][_0x2c595e(0xac)]||0x0,_0x3995ae={'totalPayout':Math[_0x2c595e(0x19c)](_0x207392*0x64)/0x64,'awaitingPayout':Math['round'](_0x5b8686*0x64)/0x64,'thisMonth':Math[_0x2c595e(0x19c)](_0x2eb5cb*0x64)/0x64,'availableBalance':Math[_0x2c595e(0x19c)](_0x5b8686*0x64)/0x64,'totalPayments':_0x2a2704};return console[_0x2c595e(0xcb)]('ðŸ“Š\x20Payout\x20statistics\x20calculated:'),console[_0x2c595e(0xcb)](_0x2c595e(0x1bb)+_0x3995ae[_0x2c595e(0x18a)]+'\x20USDT\x20(total\x20paid\x20to\x20merchants)'),console[_0x2c595e(0xcb)]('\x20\x20\x20â³\x20Awaiting\x20payout:\x20'+_0x3995ae['awaitingPayout']+'\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)'),console['log'](_0x2c595e(0x10b)+_0x3995ae[_0x2c595e(0x24b)]+_0x2c595e(0x139)),console[_0x2c595e(0xcb)](_0x2c595e(0xc3)+_0x3995ae[_0x2c595e(0x23a)]+_0x2c595e(0x262)),console[_0x2c595e(0xcb)](_0x2c595e(0x238)+_0x3995ae[_0x2c595e(0x197)]+_0x2c595e(0xfb)),_0x3995ae;}async['updateCustomerData'](_0x19fb04,_0x5ee877){const _0x344418=a53_0x22e8f6;console[_0x344418(0xcb)](_0x344418(0xe9)+_0x19fb04+':',_0x5ee877);const _0x186af3=await database_1['default'][_0x344418(0xd3)][_0x344418(0x179)]({'where':{'id':_0x19fb04},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x186af3)throw new Error(_0x344418(0x1bf));const _0x41aaa5={};_0x5ee877[_0x344418(0x13f)]!==undefined&&(_0x41aaa5['customerCountry']=_0x5ee877[_0x344418(0x13f)]||null);_0x5ee877[_0x344418(0x207)]!==undefined&&(_0x41aaa5[_0x344418(0x207)]=_0x5ee877[_0x344418(0x207)]||null);_0x5ee877['customerUa']!==undefined&&(_0x41aaa5[_0x344418(0xad)]=_0x5ee877[_0x344418(0xad)]||null);const _0x1782a0=await database_1[_0x344418(0x141)][_0x344418(0xd3)][_0x344418(0x250)]({'where':{'id':_0x19fb04},'data':{..._0x41aaa5,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console['log']('âœ…\x20Customer\x20data\x20updated\x20for\x20payment\x20'+_0x19fb04),console['log'](_0x344418(0x26e)+_0x186af3['customerCountry']+_0x344418(0xa0)+_0x1782a0[_0x344418(0x13f)]),console['log'](_0x344418(0xe4)+_0x186af3['customerIp']+_0x344418(0xa0)+_0x1782a0['customerIp']),console[_0x344418(0xcb)]('\x20\x20\x20ðŸ–¥ï¸\x20User\x20Agent:\x20'+(_0x186af3[_0x344418(0xad)]?'set':_0x344418(0xd5))+_0x344418(0xa0)+(_0x1782a0['customerUa']?'set':_0x344418(0xd5))),_0x1782a0;}async[a53_0x22e8f6(0xb1)](_0x52cae5,_0x27ab4b){const _0x209615=a53_0x22e8f6,_0x21ba13=_0x27ab4b?new Date(_0x27ab4b):new Date();let _0x375341,_0x1c25fd;if(_0x52cae5[_0x209615(0x205)]('custom_')){const _0x3b3bb1=_0x52cae5[_0x209615(0xf8)](_0x209615(0x18d),'')['split']('_');if(_0x3b3bb1[_0x209615(0xa4)]===0x2){const _0x4f061c=new Date(_0x3b3bb1[0x0]),_0x56dfe7=new Date(_0x3b3bb1[0x1]);_0x375341=new Date(Date[_0x209615(0x18c)](_0x4f061c[_0x209615(0x264)](),_0x4f061c[_0x209615(0x1b2)](),_0x4f061c[_0x209615(0x259)](),0x0,0x0,0x0,0x0)),_0x1c25fd=new Date(Date[_0x209615(0x18c)](_0x56dfe7[_0x209615(0x264)](),_0x56dfe7[_0x209615(0x1b2)](),_0x56dfe7[_0x209615(0x259)](),0x17,0x3b,0x3b,0x3e7));}else{const _0x107712=new Date(Date['UTC'](_0x21ba13['getUTCFullYear'](),_0x21ba13['getUTCMonth'](),_0x21ba13[_0x209615(0x259)]()-0x1e));_0x375341=new Date(Date['UTC'](_0x107712[_0x209615(0x264)](),_0x107712[_0x209615(0x1b2)](),_0x107712[_0x209615(0x259)](),0x0,0x0,0x0,0x0)),_0x1c25fd=new Date(Date[_0x209615(0x18c)](_0x21ba13['getUTCFullYear'](),_0x21ba13['getUTCMonth'](),_0x21ba13['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}}else{switch(_0x52cae5[_0x209615(0x191)]()){case _0x209615(0x21c):_0x375341=new Date(Date['UTC'](_0x21ba13[_0x209615(0x264)](),_0x21ba13[_0x209615(0x1b2)](),_0x21ba13[_0x209615(0x259)](),0x0,0x0,0x0,0x0)),_0x1c25fd=new Date(Date[_0x209615(0x18c)](_0x21ba13['getUTCFullYear'](),_0x21ba13[_0x209615(0x1b2)](),_0x21ba13[_0x209615(0x259)](),0x17,0x3b,0x3b,0x3e7));break;case _0x209615(0x247):const _0x37f2f6=new Date(_0x21ba13);_0x37f2f6[_0x209615(0x210)](_0x37f2f6[_0x209615(0x259)]()-0x1),_0x375341=new Date(Date[_0x209615(0x18c)](_0x37f2f6[_0x209615(0x264)](),_0x37f2f6[_0x209615(0x1b2)](),_0x37f2f6['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x1c25fd=new Date(Date[_0x209615(0x18c)](_0x37f2f6['getUTCFullYear'](),_0x37f2f6[_0x209615(0x1b2)](),_0x37f2f6['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case _0x209615(0x19b):const _0x4d0cac=_0x21ba13[_0x209615(0x19f)](),_0x2a4d5a=_0x4d0cac===0x0?-0x6:0x1-_0x4d0cac,_0x57a0fb=_0x21ba13[_0x209615(0x259)]()+_0x2a4d5a;_0x375341=new Date(Date[_0x209615(0x18c)](_0x21ba13[_0x209615(0x264)](),_0x21ba13[_0x209615(0x1b2)](),_0x57a0fb,0x0,0x0,0x0,0x0)),_0x1c25fd=new Date(Date[_0x209615(0x18c)](_0x21ba13[_0x209615(0x264)](),_0x21ba13['getUTCMonth'](),_0x21ba13[_0x209615(0x259)](),0x17,0x3b,0x3b,0x3e7));break;case _0x209615(0x109):const _0xb0be23=new Date(Date[_0x209615(0x18c)](_0x21ba13[_0x209615(0x264)](),_0x21ba13[_0x209615(0x1b2)](),_0x21ba13[_0x209615(0x259)]()-0x7)),_0x180b98=_0xb0be23[_0x209615(0x19f)](),_0x4625c2=_0x180b98===0x0?-0x6:0x1-_0x180b98,_0x2c2953=_0xb0be23[_0x209615(0x259)]()+_0x4625c2;_0x375341=new Date(Date[_0x209615(0x18c)](_0xb0be23['getUTCFullYear'](),_0xb0be23[_0x209615(0x1b2)](),_0x2c2953,0x0,0x0,0x0,0x0)),_0x1c25fd=new Date(Date[_0x209615(0x18c)](_0xb0be23[_0x209615(0x264)](),_0xb0be23[_0x209615(0x1b2)](),_0x2c2953+0x6,0x17,0x3b,0x3b,0x3e7));break;case'this_month':_0x375341=new Date(Date['UTC'](_0x21ba13['getUTCFullYear'](),_0x21ba13[_0x209615(0x1b2)](),0x1,0x0,0x0,0x0,0x0)),_0x1c25fd=new Date(Date['UTC'](_0x21ba13[_0x209615(0x264)](),_0x21ba13[_0x209615(0x1b2)](),_0x21ba13['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case _0x209615(0xc4):_0x375341=new Date(Date[_0x209615(0x18c)](_0x21ba13[_0x209615(0x264)](),_0x21ba13['getUTCMonth']()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x1c25fd=new Date(Date[_0x209615(0x18c)](_0x21ba13['getUTCFullYear'](),_0x21ba13['getUTCMonth'](),0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x209615(0x251):_0x375341=new Date(Date[_0x209615(0x18c)](0x7e9,0x5,0xe,0x0,0x0,0x0,0x0)),_0x1c25fd=new Date(Date[_0x209615(0x18c)](_0x21ba13[_0x209615(0x264)](),_0x21ba13[_0x209615(0x1b2)](),_0x21ba13[_0x209615(0x259)](),0x17,0x3b,0x3b,0x3e7));break;default:_0x375341=new Date(_0x21ba13[_0x209615(0x1bd)]()-0x1e*0x18*0x3c*0x3c*0x3e8);const _0x42819a=new Date(Date['UTC'](_0x21ba13[_0x209615(0x264)](),_0x21ba13[_0x209615(0x1b2)](),_0x21ba13[_0x209615(0x259)]()-0x1e));_0x375341=new Date(Date['UTC'](_0x42819a[_0x209615(0x264)](),_0x42819a['getUTCMonth'](),_0x42819a[_0x209615(0x259)](),0x0,0x0,0x0,0x0)),_0x1c25fd=new Date(Date['UTC'](_0x21ba13[_0x209615(0x264)](),_0x21ba13[_0x209615(0x1b2)](),_0x21ba13[_0x209615(0x259)](),0x17,0x3b,0x3b,0x3e7));}const _0x4cf284={'gte':_0x375341,'lte':_0x1c25fd};console['log'](_0x209615(0x1b8)+_0x375341['toISOString']()+_0x209615(0xf4)+_0x1c25fd[_0x209615(0x1f5)]());const [_0x1eb6d6,_0x55ea87,_0x44e402,_0x3c32b3,_0xd8500a,_0x25c282,_0x5bb66e,_0x3d274b,_0x226251]=await Promise['all']([database_1['default']['shop'][_0x209615(0x164)](),database_1[_0x209615(0x141)][_0x209615(0x234)]['count']({'where':{'status':_0x209615(0x162)}}),database_1['default'][_0x209615(0xd3)]['count']({'where':{'status':_0x209615(0xba),'createdAt':_0x4cf284,'gateway':{'not':_0x209615(0x204)}}}),database_1[_0x209615(0x141)][_0x209615(0xd3)][_0x209615(0x164)]({'where':{'status':_0x209615(0x11e),'createdAt':_0x4cf284,'gateway':{'not':'test_gateway'}}}),database_1[_0x209615(0x141)][_0x209615(0xd3)][_0x209615(0x164)]({'where':{'status':_0x209615(0x15b),'createdAt':_0x4cf284,'gateway':{'not':_0x209615(0x204)}}}),database_1[_0x209615(0x141)][_0x209615(0xd3)][_0x209615(0x1f8)]({'where':{'status':_0x209615(0xba),'createdAt':_0x4cf284,'gateway':{'not':_0x209615(0x204)}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x209615(0x141)][_0x209615(0xd3)]['findMany']({'where':{'gateway':{'not':_0x209615(0x204)}},'take':0xa,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x209615(0x141)]['payment']['findMany']({'where':{'createdAt':_0x4cf284,'gateway':{'not':_0x209615(0x204)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x209615(0x141)]['payment'][_0x209615(0x1f8)]({'where':{'status':_0x209615(0xba),'gateway':{'not':'test_gateway'}},'select':{'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![]}})]);console[_0x209615(0xcb)]('ðŸ“Š\x20Statistics\x20PAID\x20payments\x20count:\x20'+_0x44e402);let _0x2000cd=0x0,_0x291b41=0x0;for(const _0x1469ee of _0x25c282){const _0x4e9534=_0x1469ee[_0x209615(0x244)]||0x0;_0x2000cd+=_0x4e9534;if(_0x1469ee[_0x209615(0x124)]&&_0x1469ee[_0x209615(0x244)]){const _0x1b713e=_0x1469ee['amountUSDT']-_0x1469ee[_0x209615(0x124)];_0x291b41+=_0x1b713e;}}let _0x1150fa=0x0;for(const _0x3b0d33 of _0x226251){if(_0x3b0d33[_0x209615(0x124)]&&_0x3b0d33[_0x209615(0x244)]){const _0x17f0ee=_0x3b0d33['amountUSDT']-_0x3b0d33[_0x209615(0x124)];_0x1150fa+=_0x17f0ee;}}const _0x4136cf=_0x44e402>0x0?_0x2000cd/_0x44e402:0x0,_0x305aba=this['generateDailyStatistics'](_0x3d274b,_0x375341,_0x1c25fd),_0x6ad3c6=await database_1[_0x209615(0x141)][_0x209615(0xd3)]['count']({'where':{'createdAt':_0x4cf284,'gateway':{'not':_0x209615(0x204)},'status':{'notIn':[_0x209615(0xb6),'EXPIRED']}}}),_0x7799a9=_0x6ad3c6>0x0?_0x44e402/_0x6ad3c6*0x64:0x0;return{'totalShops':_0x1eb6d6,'activeShops':_0x55ea87,'totalPayments':_0x6ad3c6,'successfulPayments':_0x44e402,'totalAttempts':_0x6ad3c6,'chargebacks':_0x3c32b3,'refunds':_0xd8500a,'totalRevenue':Math['round'](_0x2000cd*0x64)/0x64,'trapayEarnings':Math[_0x209615(0x19c)](_0x291b41*0x64)/0x64,'trapayEarningsAllTime':Math[_0x209615(0x19c)](_0x1150fa*0x64)/0x64,'averagePaymentAmount':Math[_0x209615(0x19c)](_0x4136cf*0x64)/0x64,'conversionRate':Math[_0x209615(0x19c)](_0x7799a9*0x64)/0x64,'dailyRevenue':_0x305aba[_0x209615(0x147)],'dailyPayments':_0x305aba['dailyPayments'],'recentPayments':_0x5bb66e['map'](_0x3b2649=>({'id':_0x3b2649['id'],'amount':_0x3b2649[_0x209615(0xac)],'currency':_0x3b2649[_0x209615(0x22c)],'status':_0x3b2649[_0x209615(0x159)],'gateway':_0x3b2649[_0x209615(0x1c5)],'shop':_0x3b2649[_0x209615(0x234)],'createdAt':_0x3b2649['createdAt']}))};}}async['getMerchantStatistics'](_0x3e3d21){const _0x458eea=a53_0x22e8f6;console[_0x458eea(0xcb)](_0x458eea(0x249),_0x3e3d21);let _0x5228d1,_0x4093e9=new Date();if(_0x3e3d21[_0x458eea(0x1d1)]===_0x458eea(0x1c1)&&_0x3e3d21[_0x458eea(0xec)]&&_0x3e3d21[_0x458eea(0x15d)]){const _0x55fb52=new Date(_0x3e3d21[_0x458eea(0xec)]),_0x2bae9d=new Date(_0x3e3d21[_0x458eea(0x15d)]);_0x5228d1=new Date(Date['UTC'](_0x55fb52[_0x458eea(0x264)](),_0x55fb52[_0x458eea(0x1b2)](),_0x55fb52[_0x458eea(0x259)](),0x0,0x0,0x0,0x0)),_0x4093e9=new Date(Date[_0x458eea(0x18c)](_0x2bae9d[_0x458eea(0x264)](),_0x2bae9d[_0x458eea(0x1b2)](),_0x2bae9d['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}else{const _0x302b09=new Date();switch(_0x3e3d21[_0x458eea(0x1d1)]){case _0x458eea(0x154):_0x5228d1=new Date(_0x302b09['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8),_0x5228d1['setHours'](0x0,0x0,0x0,0x0),_0x4093e9[_0x458eea(0x134)](0x17,0x3b,0x3b,0x3e7);break;case _0x458eea(0x1fb):_0x5228d1=new Date(Date[_0x458eea(0x18c)](_0x302b09[_0x458eea(0x264)](),_0x302b09['getUTCMonth'](),0x1,0x0,0x0,0x0,0x0)),_0x4093e9=new Date(Date['UTC'](_0x302b09['getUTCFullYear'](),_0x302b09[_0x458eea(0x1b2)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x458eea(0xf7):_0x5228d1=new Date(Date[_0x458eea(0x18c)](_0x302b09[_0x458eea(0x264)](),_0x302b09[_0x458eea(0x1b2)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x4093e9=new Date(Date[_0x458eea(0x18c)](_0x302b09[_0x458eea(0x264)](),_0x302b09[_0x458eea(0x1b2)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case'year':_0x5228d1=new Date(_0x302b09['getTime']()-0x16d*0x18*0x3c*0x3c*0x3e8),_0x5228d1['setHours'](0x0,0x0,0x0,0x0),_0x4093e9[_0x458eea(0x134)](0x17,0x3b,0x3b,0x3e7);break;case _0x458eea(0x1d3):default:_0x5228d1=new Date(_0x458eea(0x252)),_0x5228d1[_0x458eea(0x134)](0x0,0x0,0x0,0x0),_0x4093e9[_0x458eea(0x134)](0x17,0x3b,0x3b,0x3e7);break;}}console['log'](_0x458eea(0x14e)+_0x5228d1[_0x458eea(0x1f5)]()+'\x20to\x20'+_0x4093e9[_0x458eea(0x1f5)]());const _0x430199={'status':_0x458eea(0xba),'gateway':{'not':_0x458eea(0x204)},'createdAt':{'gte':_0x5228d1,'lte':_0x4093e9}};_0x3e3d21[_0x458eea(0xf2)]&&(_0x430199[_0x458eea(0xf2)]=_0x3e3d21[_0x458eea(0xf2)]);const _0x2d67b4=await database_1[_0x458eea(0x141)][_0x458eea(0xd3)][_0x458eea(0x1f8)]({'where':_0x430199,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x458eea(0xcb)]('ðŸ’°\x20Found\x20'+_0x2d67b4[_0x458eea(0xa4)]+_0x458eea(0xe1));const _0x5f2589={'gateway':{'not':_0x458eea(0x204)},'status':{'notIn':[_0x458eea(0xb6),_0x458eea(0x167)]},'createdAt':{'gte':_0x5228d1,'lte':_0x4093e9}};_0x3e3d21[_0x458eea(0xf2)]&&(_0x5f2589[_0x458eea(0xf2)]=_0x3e3d21['shopId']);const _0xf5cf27=await database_1['default']['payment'][_0x458eea(0x164)]({'where':_0x5f2589}),_0x3dcd06={..._0x5f2589,'status':_0x458eea(0x11e)},_0x128bb9={..._0x5f2589,'status':'REFUND'},[_0xc2f2ca,_0x16c450]=await Promise['all']([database_1[_0x458eea(0x141)]['payment'][_0x458eea(0x164)]({'where':_0x3dcd06}),database_1[_0x458eea(0x141)][_0x458eea(0xd3)]['count']({'where':_0x128bb9})]);console[_0x458eea(0xcb)](_0x458eea(0x13e)+_0xf5cf27+_0x458eea(0xdb)+_0x2d67b4[_0x458eea(0xa4)]+_0x458eea(0xbc)+_0xc2f2ca+_0x458eea(0x1ac)+_0x16c450);let _0x588ae7=0x0,_0x460f82=0x0,_0x55fd17=0x0;const _0x1c22f8={},_0x50628c={},_0x4b9916={},_0x43826f=new Date(_0x5228d1);while(_0x43826f<=_0x4093e9){const _0x590ca7=_0x43826f[_0x458eea(0x1f5)]()['split']('T')[0x0];_0x4b9916[_0x590ca7]={'date':_0x590ca7,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0},_0x43826f[_0x458eea(0x210)](_0x43826f[_0x458eea(0x259)]()+0x1);}for(const _0x514862 of _0x2d67b4){try{const _0x2683b2=_0x514862['amountUSDT']||0x0;if(_0x2683b2<=0x0){console[_0x458eea(0x151)](_0x458eea(0x211)+_0x514862['id']+_0x458eea(0x1c8));continue;}let _0x165d14,_0x35c6f0;if(_0x514862[_0x458eea(0x124)]!==null&&_0x514862[_0x458eea(0x124)]!==undefined)_0x165d14=_0x514862['amountAfterGatewayCommissionUSDT'],_0x35c6f0=_0x2683b2-_0x165d14,console[_0x458eea(0xcb)](_0x458eea(0x25b)+_0x514862['id']+':\x20'+_0x2683b2[_0x458eea(0x152)](0x6)+_0x458eea(0x1d0)+_0x165d14[_0x458eea(0x152)](0x6)+_0x458eea(0x262));else{let _0x4bda6c={};if(_0x514862[_0x458eea(0x234)][_0x458eea(0x202)])try{_0x4bda6c=JSON[_0x458eea(0xb3)](_0x514862[_0x458eea(0x234)]['gatewaySettings']);}catch(_0x2f8ca4){console[_0x458eea(0x226)](_0x458eea(0x1de)+_0x514862[_0x458eea(0xf2)]+':',_0x2f8ca4);}let _0x5226a4=0x2d;for(const [_0x5bf02c,_0x4cd0ff]of Object[_0x458eea(0x130)](_0x4bda6c)){if(_0x5bf02c[_0x458eea(0x191)]()===_0x514862['gateway'][_0x458eea(0x191)]()){_0x5226a4=_0x4cd0ff['commission']||0x2d;break;}}_0x35c6f0=_0x2683b2*(_0x5226a4/0x64),_0x165d14=_0x2683b2-_0x35c6f0,console[_0x458eea(0xcb)]('ðŸ“Š\x20Calculating\x20commission\x20manually\x20for\x20payment\x20'+_0x514862['id']+':\x20'+_0x5226a4+_0x458eea(0x245)+_0x2683b2[_0x458eea(0x152)](0x6)+'\x20USDT');}_0x588ae7+=_0x2683b2,_0x460f82+=_0x165d14,_0x55fd17+=_0x35c6f0;let _0x535263;_0x514862['gatewayCommissionRate']!==null&&_0x514862[_0x458eea(0x1cc)]!==undefined?(_0x535263=_0x514862[_0x458eea(0x1cc)],console[_0x458eea(0xcb)](_0x458eea(0x235)+_0x514862['id']+':\x20'+_0x535263+'%')):(_0x535263=_0x2683b2>0x0?_0x35c6f0/_0x2683b2*0x64:0x0,console[_0x458eea(0xcb)](_0x458eea(0x22b)+_0x514862['id']+':\x20'+_0x535263[_0x458eea(0x152)](0x2)+'%'));!_0x1c22f8[_0x514862['gateway']]&&(_0x1c22f8[_0x514862['gateway']]={'gateway':_0x514862['gateway'],'gatewayDisplayName':this[_0x458eea(0x136)](_0x514862[_0x458eea(0x1c5)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x1c22f8[_0x514862[_0x458eea(0x1c5)]]['paymentsCount']++,_0x1c22f8[_0x514862[_0x458eea(0x1c5)]][_0x458eea(0x269)]+=_0x2683b2,_0x1c22f8[_0x514862[_0x458eea(0x1c5)]][_0x458eea(0xef)]+=_0x35c6f0,_0x1c22f8[_0x514862[_0x458eea(0x1c5)]]['merchantEarningsUSDT']+=_0x165d14,_0x1c22f8[_0x514862[_0x458eea(0x1c5)]][_0x458eea(0x233)]+=_0x535263;!_0x3e3d21[_0x458eea(0xf2)]&&(!_0x50628c[_0x514862[_0x458eea(0xf2)]]&&(_0x50628c[_0x514862['shopId']]={'shopId':_0x514862[_0x458eea(0xf2)],'shopName':_0x514862[_0x458eea(0x234)]['name'],'shopUsername':_0x514862[_0x458eea(0x234)][_0x458eea(0x1a3)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x50628c[_0x514862[_0x458eea(0xf2)]]['paymentsCount']++,_0x50628c[_0x514862['shopId']][_0x458eea(0x269)]+=_0x2683b2,_0x50628c[_0x514862['shopId']][_0x458eea(0xef)]+=_0x35c6f0,_0x50628c[_0x514862[_0x458eea(0xf2)]][_0x458eea(0x20d)]+=_0x165d14);const _0x41817a=_0x514862['paidAt'][_0x458eea(0x1f5)]()['split']('T')[0x0];_0x4b9916[_0x41817a]&&(_0x4b9916[_0x41817a][_0x458eea(0x16f)]+=_0x2683b2,_0x4b9916[_0x41817a][_0x458eea(0x17c)]+=_0x165d14,_0x4b9916[_0x41817a]['gatewayEarnings']+=_0x35c6f0,_0x4b9916[_0x41817a][_0x458eea(0x18e)]++);}catch(_0xf321ed){console[_0x458eea(0x226)](_0x458eea(0x21b)+_0x514862['id']+':',_0xf321ed);}}Object[_0x458eea(0x1a2)](_0x1c22f8)['forEach'](_0x280c79=>{const _0x4285b5=_0x458eea;_0x280c79['averageCommissionRate']=_0x280c79[_0x4285b5(0x18e)]>0x0?_0x280c79[_0x4285b5(0x233)]/_0x280c79[_0x4285b5(0x18e)]:0x0,delete _0x280c79[_0x4285b5(0x233)];}),Object[_0x458eea(0x1a2)](_0x50628c)['forEach'](_0x2b56bd=>{const _0x5a9384=_0x458eea;_0x2b56bd[_0x5a9384(0x145)]=_0x2b56bd[_0x5a9384(0x18e)]>0x0?_0x2b56bd[_0x5a9384(0x269)]/_0x2b56bd['paymentsCount']:0x0;});let _0xa03de9=0x0,_0x4b02e4=0x0;if(_0x3e3d21['shopId']){const _0x290d6d=await database_1['default'][_0x458eea(0x258)]['findMany']({'where':{'shopId':_0x3e3d21[_0x458eea(0xf2)],'status':_0x458eea(0x1f0),'createdAt':{'gte':_0x5228d1,'lte':_0x4093e9}},'select':{'amount':!![]}});_0xa03de9=_0x290d6d['reduce']((_0x4436fa,_0x54cb93)=>_0x4436fa+_0x54cb93[_0x458eea(0xac)],0x0);const _0x309b64=await database_1[_0x458eea(0x141)][_0x458eea(0x258)][_0x458eea(0x1f8)]({'where':{'shopId':_0x3e3d21[_0x458eea(0xf2)],'status':_0x458eea(0xb6),'createdAt':{'gte':_0x5228d1,'lte':_0x4093e9}},'select':{'amount':!![]}});_0x4b02e4=_0x309b64[_0x458eea(0x1b5)]((_0x48d5d7,_0x5e3258)=>_0x48d5d7+_0x5e3258[_0x458eea(0xac)],0x0);}const _0x563c5c=_0xf5cf27,_0x46a49a=_0x2d67b4[_0x458eea(0xa4)],_0x4c3a81=_0x46a49a>0x0?_0x588ae7/_0x46a49a:0x0,_0x3dc05d=_0x563c5c>0x0?Math[_0x458eea(0x19c)](_0x46a49a/_0x563c5c*0x2710)/0x64:0x0,_0x5bd35f=Math['ceil']((_0x4093e9[_0x458eea(0x1bd)]()-_0x5228d1[_0x458eea(0x1bd)]())/(0x3e8*0x3c*0x3c*0x18)),_0x4a1414={'totalTurnover':Math['round'](_0x588ae7*0x64)/0x64,'merchantEarnings':Math['round'](_0x460f82*0x64)/0x64,'gatewayEarnings':Math['round'](_0x55fd17*0x64)/0x64,'totalPaidOut':Math['round'](_0xa03de9*0x64)/0x64,'pendingPayout':Math[_0x458eea(0x19c)](_0x4b02e4*0x64)/0x64,'averageCheck':Math[_0x458eea(0x19c)](_0x4c3a81*0x64)/0x64,'totalPayments':_0x563c5c,'successfulPayments':_0x46a49a,'conversionRate':_0x3dc05d,'chargebacks':_0xc2f2ca,'refunds':_0x16c450,'gatewayBreakdown':Object['values'](_0x1c22f8)[_0x458eea(0x182)](_0x27b313=>({..._0x27b313,'turnoverUSDT':Math[_0x458eea(0x19c)](_0x27b313['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x458eea(0x19c)](_0x27b313[_0x458eea(0xef)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x458eea(0x19c)](_0x27b313[_0x458eea(0x20d)]*0x64)/0x64,'averageCommissionRate':Math['round'](_0x27b313['averageCommissionRate']*0x64)/0x64})),'merchantBreakdown':_0x3e3d21[_0x458eea(0xf2)]?undefined:Object[_0x458eea(0x1a2)](_0x50628c)[_0x458eea(0x182)](_0x289005=>({..._0x289005,'turnoverUSDT':Math['round'](_0x289005[_0x458eea(0x269)]*0x64)/0x64,'commissionUSDT':Math[_0x458eea(0x19c)](_0x289005['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x458eea(0x19c)](_0x289005[_0x458eea(0x20d)]*0x64)/0x64,'paidOutUSDT':Math['round'](_0x289005[_0x458eea(0x1c3)]*0x64)/0x64,'averageCheckUSDT':Math[_0x458eea(0x19c)](_0x289005['averageCheckUSDT']*0x64)/0x64})),'dailyData':Object[_0x458eea(0x1a2)](_0x4b9916)[_0x458eea(0x182)](_0x29658f=>({..._0x29658f,'turnover':Math['round'](_0x29658f[_0x458eea(0x16f)]*0x64)/0x64,'merchantEarnings':Math['round'](_0x29658f['merchantEarnings']*0x64)/0x64,'gatewayEarnings':Math[_0x458eea(0x19c)](_0x29658f[_0x458eea(0xaa)]*0x64)/0x64}))[_0x458eea(0x1dc)]((_0x6fc307,_0x58f4b8)=>_0x6fc307[_0x458eea(0x224)][_0x458eea(0xbe)](_0x58f4b8[_0x458eea(0x224)])),'periodInfo':{'from':_0x5228d1,'to':_0x4093e9,'periodType':_0x3e3d21[_0x458eea(0x1d1)]||_0x458eea(0x1c1),'daysCount':_0x5bd35f}};return console[_0x458eea(0xcb)](_0x458eea(0x1ea)),console[_0x458eea(0xcb)](_0x458eea(0x190)+_0x4a1414['totalTurnover']+_0x458eea(0x262)),console[_0x458eea(0xcb)](_0x458eea(0xc6)+_0x4a1414[_0x458eea(0x17c)]+_0x458eea(0x262)),console[_0x458eea(0xcb)]('\x20\x20\x20ðŸª\x20Gateway\x20earnings:\x20'+_0x4a1414[_0x458eea(0xaa)]+_0x458eea(0x262)),console[_0x458eea(0xcb)]('\x20\x20\x20ï¿½\x20Total\x20paid\x20out:\x20'+_0x4a1414['totalPaidOut']+_0x458eea(0x262)),console[_0x458eea(0xcb)](_0x458eea(0xf3)+_0x4a1414[_0x458eea(0xb4)]+_0x458eea(0x262)),console['log'](_0x458eea(0x217)+_0x4a1414['totalPayments']),_0x4a1414;}async['getMerchantsSelection'](_0x2a3d2e){const _0x4adc1f=a53_0x22e8f6;console['log'](_0x4adc1f(0x20c),{'hasPayoutHistory':_0x2a3d2e});let _0x1ceb0d={};_0x2a3d2e&&(_0x1ceb0d[_0x4adc1f(0x222)]={'some':{}});const _0x3897e2=await database_1[_0x4adc1f(0x141)][_0x4adc1f(0x234)][_0x4adc1f(0x1f8)]({'where':_0x1ceb0d,'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x4adc1f(0x271)}});return console[_0x4adc1f(0xcb)]('ðŸ“‹\x20Found\x20'+_0x3897e2['length']+_0x4adc1f(0x22a)+(_0x2a3d2e?_0x4adc1f(0x242):'')),_0x3897e2[_0x4adc1f(0x182)](_0x113b2e=>({'id':_0x113b2e['id'],'username':_0x113b2e[_0x4adc1f(0x1a3)],'name':_0x113b2e[_0x4adc1f(0x14b)]}));}[a53_0x22e8f6(0x136)](_0x2fc1c7){const _0x2e213d=a53_0x22e8f6,_0x4f1350={'test_gateway':_0x2e213d(0x1ad),'plisio':_0x2e213d(0x26c),'rapyd':_0x2e213d(0x218),'noda':'Noda','cointopay':_0x2e213d(0x144),'cointopay2':_0x2e213d(0x110),'klyme_eu':_0x2e213d(0x20f),'klyme_gb':_0x2e213d(0xb7),'klyme_de':_0x2e213d(0x21e),'mastercard':_0x2e213d(0x1ab),'visa/mastercard':'Visa/MasterCard','amer':_0x2e213d(0x126),'myxspend':_0x2e213d(0x16b),'ampay':_0x2e213d(0x1b9),'ampay_try':_0x2e213d(0x1ca),'sepa':'Sepa','interac':_0x2e213d(0x16c),'onramp':_0x2e213d(0xd0),'squirrelpay':'SquirrelPay','maxpara':'MaxPara','instaxchange':'InstaXchange','oxapay':'OxaPay'};return _0x4f1350[_0x2fc1c7]||_0x2fc1c7;}[a53_0x22e8f6(0x19d)](_0x7967fe){const _0x194103=a53_0x22e8f6,_0x9184e1={'Test\x20Gateway':_0x194103(0x204),'Plisio':'plisio','Rapyd':_0x194103(0x25c),'Noda':_0x194103(0x1c0),'CoinToPay':_0x194103(0x21d),'CoinToPay2':_0x194103(0x1c7),'KLYME\x20EU':_0x194103(0x122),'KLYME\x20GB':_0x194103(0x170),'KLYME\x20DE':_0x194103(0x1be),'MasterCard':_0x194103(0x22d)};return _0x9184e1[_0x7967fe]||_0x7967fe[_0x194103(0x191)]();}async['getMerchantsAwaitingPayout'](_0x400329){const _0xb8e94=a53_0x22e8f6,{page:_0xeb5621,limit:_0x162f6d,minAmount:_0x183ed2,search:_0x48ac47}=_0x400329;console[_0xb8e94(0xcb)](_0xb8e94(0x175),_0x400329);let _0x597db5={};_0x48ac47&&(_0x597db5[_0xb8e94(0x14b)]={'contains':_0x48ac47,'mode':_0xb8e94(0x156)});const _0x5249c9=await database_1['default'][_0xb8e94(0x234)][_0xb8e94(0x1f8)]({'where':_0x597db5,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),_0x3a664d=_0x5249c9[_0xb8e94(0x17b)](_0x590e18=>{const _0xe258b8=_0xb8e94,_0x3957f6=Math['floor'](_0x590e18[_0xe258b8(0x1db)]*0x64)/0x64;if(_0x183ed2&&_0x3957f6<_0x183ed2)return![];return _0x3957f6!==0x0;});_0x3a664d[_0xb8e94(0x1dc)]((_0x4ff61b,_0x4ce545)=>_0x4ce545['balance']-_0x4ff61b[_0xb8e94(0x1db)]);const _0x28019f=_0x3a664d[_0xb8e94(0xa4)],_0x26123b=(_0xeb5621-0x1)*_0x162f6d,_0x1b125d=_0x3a664d[_0xb8e94(0x140)](_0x26123b,_0x26123b+_0x162f6d);console['log']('ðŸ’°\x20Found\x20'+_0x1b125d['length']+'\x20merchants\x20with\x20rounded\x20balance\x20!=\x200.00\x20(excluding\x20balances\x20that\x20round\x20to\x200.00)');const _0x34b2d0=await Promise[_0xb8e94(0x1d3)](_0x1b125d[_0xb8e94(0x182)](async _0x135795=>{const _0x3f8cf9=_0xb8e94,[_0x160295,_0x4a12a2,_0x4f1ea0]=await Promise[_0x3f8cf9(0x1d3)]([database_1['default']['payment'][_0x3f8cf9(0x164)]({'where':{'shopId':_0x135795['id'],'status':'PAID','gateway':{'not':_0x3f8cf9(0x204)}}}),database_1['default']['payment'][_0x3f8cf9(0x132)]({'where':{'shopId':_0x135795['id'],'status':'PAID','gateway':{'not':'test_gateway'}},'orderBy':{'paidAt':'asc'},'select':{'paidAt':!![]}}),database_1['default'][_0x3f8cf9(0xd3)][_0x3f8cf9(0x184)]({'by':[_0x3f8cf9(0x1c5)],'where':{'shopId':_0x135795['id'],'status':_0x3f8cf9(0xba),'gateway':{'not':_0x3f8cf9(0x204)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0xc7fe54=new Date(),_0x25605b=new Date(_0xc7fe54[_0x3f8cf9(0x230)](),_0xc7fe54[_0x3f8cf9(0xdc)](),0x1),_0x69b65=new Date(_0xc7fe54['getFullYear'](),_0xc7fe54[_0x3f8cf9(0xdc)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x3f25af,_0x339b42]=await Promise['all']([database_1[_0x3f8cf9(0x141)][_0x3f8cf9(0x258)]['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x135795['id'],'status':_0x3f8cf9(0x1f0)}}),database_1[_0x3f8cf9(0x141)]['payout'][_0x3f8cf9(0xbb)]({'_sum':{'amount':!![]},'where':{'shopId':_0x135795['id'],'status':_0x3f8cf9(0x1f0),'createdAt':{'gte':_0x25605b,'lte':_0x69b65}}})]),_0x27f078=_0x3f25af[_0x3f8cf9(0x116)][_0x3f8cf9(0xac)]||0x0,_0x30ddf1=_0x339b42[_0x3f8cf9(0x116)][_0x3f8cf9(0xac)]||0x0,_0x131dcb=await Promise[_0x3f8cf9(0x1d3)](_0x4f1ea0[_0x3f8cf9(0x182)](async _0x43c0d9=>{const _0x1cace8=_0x3f8cf9,_0x320122=await database_1['default'][_0x1cace8(0xd3)]['findMany']({'where':{'shopId':_0x135795['id'],'status':_0x1cace8(0xba),'gateway':_0x43c0d9[_0x1cace8(0x1c5)]},'select':{'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![]}});let _0x3b1b0b=0x2d;if(_0x135795['gatewaySettings'])try{const _0x2397ac=JSON[_0x1cace8(0xb3)](_0x135795[_0x1cace8(0x202)]);for(const [_0x20fbae,_0x2ecbbb]of Object['entries'](_0x2397ac)){if(_0x20fbae[_0x1cace8(0x191)]()===_0x43c0d9[_0x1cace8(0x1c5)][_0x1cace8(0x191)]()){_0x3b1b0b=_0x2ecbbb['commission']||0xa,console[_0x1cace8(0xcb)](_0x1cace8(0x20b)+_0x43c0d9[_0x1cace8(0x1c5)]+'\x20for\x20shop\x20'+_0x135795['id']+_0x1cace8(0x21f)+_0x3b1b0b+'%');break;}}}catch(_0x5e159a){console['error'](_0x1cace8(0x1de)+_0x135795['id']+':',_0x5e159a);}const _0x39851b=_0x43c0d9[_0x1cace8(0x116)]?.[_0x1cace8(0x244)]||0x0;let _0x59af8b=0x0;for(const _0x5ae8e7 of _0x320122){if(_0x5ae8e7[_0x1cace8(0x124)]!==null&&_0x5ae8e7[_0x1cace8(0x124)]!==undefined)_0x59af8b+=_0x5ae8e7[_0x1cace8(0x124)];else{const _0x4a2031=_0x5ae8e7['amountUSDT']||0x0;_0x59af8b+=_0x4a2031*(0x1-_0x3b1b0b/0x64);}}return{'gateway':_0x43c0d9['gateway'],'count':_0x43c0d9[_0x1cace8(0x1f3)]?.['id']||0x0,'amountUSDT':Math['round'](_0x39851b*0x64)/0x64,'amountAfterCommissionUSDT':Math['round'](_0x59af8b*0x64)/0x64,'commission':_0x3b1b0b};})),_0x3d6c4d=_0x131dcb[_0x3f8cf9(0x1b5)]((_0xdf5d3b,_0x3d520f)=>_0xdf5d3b+_0x3d520f[_0x3f8cf9(0x244)],0x0),_0x3efece=_0x131dcb[_0x3f8cf9(0x1b5)]((_0xd794ac,_0x340d18)=>_0xd794ac+_0x340d18[_0x3f8cf9(0x1e2)],0x0),_0x465de7=_0x135795[_0x3f8cf9(0x1db)];return console[_0x3f8cf9(0xcb)](_0x3f8cf9(0x255)+_0x135795['username']+':'),console[_0x3f8cf9(0xcb)]('\x20\x20\x20ï¿½\x20Total\x20payments\x20turnover:\x20'+_0x3d6c4d[_0x3f8cf9(0x152)](0x2)+_0x3f8cf9(0x23f)),console[_0x3f8cf9(0xcb)](_0x3f8cf9(0x11a)+_0x3efece[_0x3f8cf9(0x152)](0x2)+_0x3f8cf9(0x1d5)),console[_0x3f8cf9(0xcb)](_0x3f8cf9(0xb0)+_0x465de7[_0x3f8cf9(0x152)](0x2)+_0x3f8cf9(0xe2)),console[_0x3f8cf9(0xcb)](_0x3f8cf9(0x18b)+_0x27f078[_0x3f8cf9(0x152)](0x2)+'\x20USDT\x20(already\x20paid\x20out)'),console[_0x3f8cf9(0xcb)](_0x3f8cf9(0x102)+(_0x3efece-_0x27f078-_0x465de7)['toFixed'](0x2)+_0x3f8cf9(0xa5)),{'id':_0x135795['id'],'fullName':_0x135795[_0x3f8cf9(0x14b)],'username':_0x135795[_0x3f8cf9(0x1a3)],'telegramId':_0x135795[_0x3f8cf9(0x1fe)],'merchantUrl':_0x135795[_0x3f8cf9(0x26b)],'wallets':{'usdtPolygonWallet':_0x135795[_0x3f8cf9(0xb5)],'usdtTrcWallet':_0x135795['usdtTrcWallet'],'usdtErcWallet':_0x135795[_0x3f8cf9(0xee)],'usdcPolygonWallet':_0x135795['usdcPolygonWallet'],'usdcErcWallet':_0x135795['usdcErcWallet']},'totalAmountUSDT':Math['round'](_0x3d6c4d*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x3f8cf9(0x19c)](_0x3efece*0x64)/0x64,'currentBalance':Math['floor'](_0x465de7*0x64)/0x64,'totalPayout':Math[_0x3f8cf9(0x19c)](_0x27f078*0x64)/0x64,'thisMonth':Math[_0x3f8cf9(0x19c)](_0x30ddf1*0x64)/0x64,'paymentsCount':_0x160295,'oldestPaymentDate':_0x4a12a2?.[_0x3f8cf9(0xd6)]||_0x135795['createdAt'],'gatewayBreakdown':_0x131dcb};})),_0x2a1bca=_0x34b2d0[_0xb8e94(0x1b5)]((_0x424352,_0x2a967c)=>_0x424352+_0x2a967c['totalAmountUSDT'],0x0),_0x1db1d6=_0x34b2d0[_0xb8e94(0x1b5)]((_0x1ef437,_0x2d6ec3)=>_0x1ef437+_0x2d6ec3[_0xb8e94(0x1ff)],0x0),_0x304472=_0x34b2d0[_0xb8e94(0x1b5)]((_0x48d572,_0x286cfa)=>_0x48d572+_0x286cfa['totalPayout'],0x0),_0x5e6443=_0x34b2d0[_0xb8e94(0x1b5)]((_0x20dbf5,_0x46a8bd)=>_0x20dbf5+_0x46a8bd[_0xb8e94(0x23a)],0x0);return console['log'](_0xb8e94(0x181)+_0x28019f+'\x20merchants'),console['log'](_0xb8e94(0x174)+Math[_0xb8e94(0x19c)](_0x2a1bca*0x64)/0x64+_0xb8e94(0x23f)),console[_0xb8e94(0xcb)](_0xb8e94(0xb2)+Math[_0xb8e94(0x19c)](_0x1db1d6*0x64)/0x64+'\x20USDT\x20(rounded\x20to\x202\x20decimal\x20places)'),console['log'](_0xb8e94(0x155)+Math[_0xb8e94(0x19c)](_0x304472*0x64)/0x64+_0xb8e94(0x262)),console['log'](_0xb8e94(0x11d)+Math[_0xb8e94(0x19c)](_0x5e6443*0x64)/0x64+'\x20USDT'),{'merchants':_0x34b2d0,'pagination':{'page':_0xeb5621,'limit':_0x162f6d,'total':_0x28019f,'totalPages':Math[_0xb8e94(0x112)](_0x28019f/_0x162f6d)},'summary':{'totalMerchants':_0x28019f,'totalAmountUSDT':Math[_0xb8e94(0x19c)](_0x2a1bca*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0xb8e94(0x19c)](_0x1db1d6*0x64)/0x64,'totalPayout':Math['round'](_0x304472*0x64)/0x64,'thisMonth':Math[_0xb8e94(0x19c)](_0x5e6443*0x64)/0x64}};}async['createPayout'](_0x25b3a9){const _0x5bfe6a=a53_0x22e8f6,{shopId:_0x287aca,amount:_0x279d0e,network:_0x361ab7,wallet:_0x152951,notes:_0x19f4c8,txid:_0xcffc39,periodFrom:_0x41880f,periodTo:_0x242a5d}=_0x25b3a9,_0x12f36a=await database_1[_0x5bfe6a(0x141)][_0x5bfe6a(0x209)](async _0x306b2e=>{const _0x2061f6=_0x5bfe6a,_0x15fda1=await _0x306b2e[_0x2061f6(0x234)]['findUnique']({'where':{'id':_0x287aca},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x15fda1)throw new Error(_0x2061f6(0xfa));console[_0x2061f6(0xcb)](_0x2061f6(0x25a)+_0x15fda1[_0x2061f6(0x1a3)]+':'),console[_0x2061f6(0xcb)](_0x2061f6(0x187)+_0x15fda1['balance'][_0x2061f6(0x152)](0x6)+'\x20USDT'),console[_0x2061f6(0xcb)]('\x20\x20\x20Payout\x20amount:\x20'+_0x279d0e[_0x2061f6(0x152)](0x6)+_0x2061f6(0x262)),console[_0x2061f6(0xcb)](_0x2061f6(0x15e)+_0x15fda1[_0x2061f6(0x1d9)][_0x2061f6(0x152)](0x6)+_0x2061f6(0x262));if(_0xcffc39)console[_0x2061f6(0xcb)](_0x2061f6(0x229)+_0xcffc39);const _0x39ccd8=0.000001,_0x4012cd=Number(_0x15fda1['balance']),_0x2a4792=Number(_0x279d0e);console[_0x2061f6(0xcb)](_0x2061f6(0x1f1)),console[_0x2061f6(0xcb)](_0x2061f6(0x1e4)+_0x15fda1[_0x2061f6(0x1db)]),console['log'](_0x2061f6(0x121)+_0x4012cd),console['log'](_0x2061f6(0x214)+_0x2a4792),console[_0x2061f6(0xcb)](_0x2061f6(0x103)+(_0x4012cd-_0x2a4792)),console[_0x2061f6(0xcb)]('\x20\x20\x20Tolerance:\x20'+_0x39ccd8);if(_0x4012cd<_0x2a4792-_0x39ccd8)throw new Error(_0x2061f6(0x1f6)+_0x4012cd[_0x2061f6(0x152)](0x6)+_0x2061f6(0x161)+_0x2a4792[_0x2061f6(0x152)](0x6)+_0x2061f6(0x16a)+(_0x4012cd-_0x2a4792)[_0x2061f6(0x152)](0x8)+_0x2061f6(0x262));console[_0x2061f6(0xcb)](_0x2061f6(0xae));const _0x1783ee=Math[_0x2061f6(0x24f)](_0x4012cd,_0x2a4792);let _0x480c44=_0x152951;console[_0x2061f6(0xcb)](_0x2061f6(0x1f2)+(_0x152951||_0x2061f6(0x24e)));if(!_0x480c44){console['log'](_0x2061f6(0x194));const _0x491fb3=await _0x306b2e[_0x2061f6(0x234)]['findUnique']({'where':{'id':_0x287aca},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});console[_0x2061f6(0xcb)](_0x2061f6(0x1af),_0x491fb3);if(_0x491fb3)switch(_0x361ab7){case _0x2061f6(0x128):_0x480c44=_0x491fb3[_0x2061f6(0xb5)]||undefined,console[_0x2061f6(0xcb)](_0x2061f6(0x257)+_0x480c44);break;case _0x2061f6(0x104):_0x480c44=_0x491fb3[_0x2061f6(0xf5)]||undefined,console[_0x2061f6(0xcb)](_0x2061f6(0x20e)+_0x480c44);break;case _0x2061f6(0x253):_0x480c44=_0x491fb3['usdtErcWallet']||undefined,console[_0x2061f6(0xcb)]('ðŸ”\x20Selected\x20erc20\x20wallet:\x20'+_0x480c44);break;case _0x2061f6(0x25d):_0x480c44=_0x491fb3[_0x2061f6(0x15f)]||undefined,console[_0x2061f6(0xcb)]('ðŸ”\x20Selected\x20polygon_usdc\x20wallet:\x20'+_0x480c44);break;case'erc20_usdc':_0x480c44=_0x491fb3[_0x2061f6(0x23e)]||undefined,console[_0x2061f6(0xcb)]('ðŸ”\x20Selected\x20erc20_usdc\x20wallet:\x20'+_0x480c44);break;}}else console[_0x2061f6(0xcb)](_0x2061f6(0xff)+_0x480c44);console[_0x2061f6(0xcb)]('ðŸ’³\x20Final\x20payout\x20wallet\x20for\x20'+_0x361ab7+':\x20'+(_0x480c44||'not\x20specified')),console[_0x2061f6(0xcb)](_0x2061f6(0xe0),{'shopId':_0x287aca,'amount':_0x1783ee,'network':_0x361ab7,'wallet':_0x480c44,'status':_0x2061f6(0x1f0),'txid':_0xcffc39,'notes':_0x19f4c8,'periodFrom':_0x41880f?new Date(_0x41880f):null,'periodTo':_0x242a5d?new Date(_0x242a5d):null});const _0x49d10e=await _0x306b2e['payout'][_0x2061f6(0x16e)]({'data':{'shopId':_0x287aca,'amount':_0x1783ee,'network':_0x361ab7,'wallet':_0x480c44,'status':_0x2061f6(0x1f0),'txid':_0xcffc39,'notes':_0x19f4c8,'periodFrom':_0x41880f?new Date(_0x41880f):null,'periodTo':_0x242a5d?new Date(_0x242a5d):null,'createdAt':new Date(),'paidAt':new Date()}});console[_0x2061f6(0xcb)]('âœ…\x20Payout\x20created\x20in\x20DB:',{'id':_0x49d10e['id'],'wallet':_0x49d10e[_0x2061f6(0x266)],'network':_0x49d10e[_0x2061f6(0x1f4)],'amount':_0x49d10e['amount']});const _0x447e5c=_0x4012cd-_0x1783ee,_0x1bc270=Number(_0x15fda1['totalPaidOut'])+_0x1783ee;return await _0x306b2e['shop'][_0x2061f6(0x250)]({'where':{'id':_0x287aca},'data':{'balance':_0x447e5c,'totalPaidOut':_0x1bc270}}),console[_0x2061f6(0xcb)](_0x2061f6(0x1ee)+_0x15fda1['username']+_0x2061f6(0x127)),console['log'](_0x2061f6(0x114)+_0x4012cd[_0x2061f6(0x152)](0x6)+_0x2061f6(0xa0)+_0x447e5c[_0x2061f6(0x152)](0x6)+'\x20USDT\x20(-'+_0x1783ee[_0x2061f6(0x152)](0x6)+')'),console['log'](_0x2061f6(0x180)+_0x15fda1['totalPaidOut'][_0x2061f6(0x152)](0x6)+'\x20->\x20'+_0x1bc270[_0x2061f6(0x152)](0x6)+'\x20USDT\x20(+'+_0x1783ee[_0x2061f6(0x152)](0x6)+')'),console['log']('\x20\x20\x20Final\x20payout\x20amount\x20used:\x20'+_0x1783ee['toFixed'](0x6)+_0x2061f6(0x262)),{'payout':_0x49d10e,'shop':_0x15fda1};});console[_0x5bfe6a(0xcb)]('âœ…\x20Payout\x20created:\x20'+_0x12f36a[_0x5bfe6a(0x258)]['id']+'\x20for\x20shop\x20'+_0x12f36a[_0x5bfe6a(0x234)]['username']+'\x20('+_0x12f36a[_0x5bfe6a(0x258)]['amount']['toFixed'](0x6)+_0x5bfe6a(0x17d));try{let _0x19eb5a=_0x5bfe6a(0x248);if(_0x12f36a[_0x5bfe6a(0x258)][_0x5bfe6a(0x260)]&&_0x12f36a[_0x5bfe6a(0x258)][_0x5bfe6a(0x119)]){const _0x4b66e1=new Date(_0x12f36a[_0x5bfe6a(0x258)]['periodFrom'])['toLocaleDateString']('ru-RU'),_0x2b19b8=new Date(_0x12f36a['payout'][_0x5bfe6a(0x119)])['toLocaleDateString'](_0x5bfe6a(0x1e8));_0x19eb5a=_0x4b66e1+_0x5bfe6a(0x172)+_0x2b19b8;}await telegramBotService_1[_0x5bfe6a(0x158)][_0x5bfe6a(0x16d)](_0x12f36a['payout'][_0x5bfe6a(0xf2)],{'id':_0x12f36a[_0x5bfe6a(0x258)]['id'],'amount':_0x12f36a['payout'][_0x5bfe6a(0xac)],'network':_0x12f36a[_0x5bfe6a(0x258)][_0x5bfe6a(0x1f4)],'wallet':_0x12f36a[_0x5bfe6a(0x258)][_0x5bfe6a(0x266)],'period':_0x19eb5a,'createdAt':_0x12f36a[_0x5bfe6a(0x258)][_0x5bfe6a(0x17f)],'txid':_0x12f36a[_0x5bfe6a(0x258)][_0x5bfe6a(0x111)]}),console['log'](_0x5bfe6a(0x11b)+_0x12f36a[_0x5bfe6a(0x258)]['id']);}catch(_0xdaac32){console[_0x5bfe6a(0x226)](_0x5bfe6a(0x227)+_0x12f36a['payout']['id']+':',_0xdaac32);}return{'id':_0x12f36a[_0x5bfe6a(0x258)]['id'],'shopId':_0x12f36a['payout']['shopId'],'shopName':_0x12f36a[_0x5bfe6a(0x234)][_0x5bfe6a(0x14b)],'shopUsername':_0x12f36a['shop'][_0x5bfe6a(0x1a3)],'amount':_0x12f36a[_0x5bfe6a(0x258)][_0x5bfe6a(0xac)],'network':_0x12f36a['payout']['network'],'wallet':_0x12f36a[_0x5bfe6a(0x258)][_0x5bfe6a(0x266)],'status':_0x12f36a[_0x5bfe6a(0x258)][_0x5bfe6a(0x159)],'txid':_0x12f36a['payout'][_0x5bfe6a(0x111)],'notes':_0x12f36a[_0x5bfe6a(0x258)][_0x5bfe6a(0x1a8)],'periodFrom':_0x12f36a[_0x5bfe6a(0x258)][_0x5bfe6a(0x260)],'periodTo':_0x12f36a[_0x5bfe6a(0x258)][_0x5bfe6a(0x119)],'createdAt':_0x12f36a[_0x5bfe6a(0x258)][_0x5bfe6a(0x17f)],'paidAt':_0x12f36a[_0x5bfe6a(0x258)]['paidAt']};}async[a53_0x22e8f6(0x1b1)](_0x685ca0){const _0x44b2ec=a53_0x22e8f6,{page:_0x14aa9e,limit:_0x579b0d,shopId:_0x4307ad,network:_0x4daffb,dateFrom:_0x555587,dateTo:_0x3d2f2f,search:_0x21b632}=_0x685ca0,_0x577dbc=(_0x14aa9e-0x1)*_0x579b0d,_0x43fe04={};_0x4307ad&&(_0x43fe04[_0x44b2ec(0xf2)]=_0x4307ad);_0x4daffb&&(_0x43fe04[_0x44b2ec(0x1f4)]=_0x4daffb);if(_0x555587||_0x3d2f2f){_0x43fe04[_0x44b2ec(0x17f)]={};if(_0x555587){const _0x47ac48=new Date(_0x555587);_0x47ac48[_0x44b2ec(0x134)](0x0,0x0,0x0,0x1),_0x43fe04[_0x44b2ec(0x17f)][_0x44b2ec(0x137)]=_0x47ac48,console[_0x44b2ec(0xcb)](_0x44b2ec(0x14f)+_0x47ac48[_0x44b2ec(0x1f5)]());}if(_0x3d2f2f){const _0x179e35=new Date(_0x3d2f2f);_0x179e35[_0x44b2ec(0x134)](0x17,0x3b,0x3b,0x3e7),_0x43fe04[_0x44b2ec(0x17f)][_0x44b2ec(0x163)]=_0x179e35,console[_0x44b2ec(0xcb)](_0x44b2ec(0xf6)+_0x179e35['toISOString']());}}_0x21b632&&(_0x43fe04['OR']=[{'shop':{'name':{'contains':_0x21b632,'mode':_0x44b2ec(0x156)}}},{'shop':{'username':{'contains':_0x21b632,'mode':_0x44b2ec(0x156)}}},{'notes':{'contains':_0x21b632,'mode':_0x44b2ec(0x156)}}]);const [_0xead359,_0x4d8dd9]=await Promise[_0x44b2ec(0x1d3)]([database_1[_0x44b2ec(0x141)][_0x44b2ec(0x258)]['findMany']({'where':_0x43fe04,'skip':_0x577dbc,'take':_0x579b0d,'orderBy':{'createdAt':_0x44b2ec(0x101)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'wallet':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x44b2ec(0x141)][_0x44b2ec(0x258)][_0x44b2ec(0x164)]({'where':_0x43fe04})]);return{'payouts':_0xead359[_0x44b2ec(0x182)](_0x4238d9=>({'id':_0x4238d9['id'],'shopId':_0x4238d9[_0x44b2ec(0xf2)],'shopName':_0x4238d9[_0x44b2ec(0x234)][_0x44b2ec(0x14b)],'shopUsername':_0x4238d9[_0x44b2ec(0x234)][_0x44b2ec(0x1a3)],'amount':_0x4238d9[_0x44b2ec(0xac)],'network':_0x4238d9[_0x44b2ec(0x1f4)],'wallet':_0x4238d9[_0x44b2ec(0x266)],'status':_0x4238d9['status'],'txid':_0x4238d9[_0x44b2ec(0x111)],'notes':_0x4238d9[_0x44b2ec(0x1a8)],'periodFrom':_0x4238d9[_0x44b2ec(0x260)],'periodTo':_0x4238d9[_0x44b2ec(0x119)],'createdAt':_0x4238d9[_0x44b2ec(0x17f)],'paidAt':_0x4238d9[_0x44b2ec(0xd6)]})),'pagination':{'page':_0x14aa9e,'limit':_0x579b0d,'total':_0x4d8dd9,'totalPages':Math['ceil'](_0x4d8dd9/_0x579b0d)}};}async['getPayoutById'](_0xd33d52){const _0x269e3a=a53_0x22e8f6,_0x3f4756=await database_1[_0x269e3a(0x141)][_0x269e3a(0x258)]['findUnique']({'where':{'id':_0xd33d52},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x3f4756)return null;return{'id':_0x3f4756['id'],'shopId':_0x3f4756[_0x269e3a(0xf2)],'shopName':_0x3f4756[_0x269e3a(0x234)]['name'],'shopUsername':_0x3f4756['shop'][_0x269e3a(0x1a3)],'amount':_0x3f4756[_0x269e3a(0xac)],'network':_0x3f4756[_0x269e3a(0x1f4)],'wallet':_0x3f4756[_0x269e3a(0x266)],'status':_0x3f4756[_0x269e3a(0x159)],'txid':_0x3f4756['txid'],'notes':_0x3f4756[_0x269e3a(0x1a8)],'periodFrom':_0x3f4756['periodFrom'],'periodTo':_0x3f4756['periodTo'],'createdAt':_0x3f4756['createdAt'],'paidAt':_0x3f4756[_0x269e3a(0xd6)]};}async['deletePayout'](_0x5dcebc){const _0x5ccc8e=a53_0x22e8f6;await database_1[_0x5ccc8e(0x141)][_0x5ccc8e(0x258)][_0x5ccc8e(0x12c)]({'where':{'id':_0x5dcebc}});}async[a53_0x22e8f6(0x14c)](_0xcbb8fa,_0x270917){const _0x3d4259=a53_0x22e8f6,_0x39e822=await database_1[_0x3d4259(0x141)][_0x3d4259(0x209)](async _0x147317=>{const _0x259018=_0x3d4259,_0x44cdfe=await _0x147317[_0x259018(0x258)][_0x259018(0x179)]({'where':{'id':_0xcbb8fa},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}}}});if(!_0x44cdfe)throw new Error('Payout\x20not\x20found');console[_0x259018(0xcb)]('ðŸ’°\x20Updating\x20payout\x20'+_0xcbb8fa+_0x259018(0xfc)+_0x44cdfe[_0x259018(0x234)]['username']+':'),console[_0x259018(0xcb)](_0x259018(0x239)+_0x44cdfe[_0x259018(0xac)][_0x259018(0x152)](0x6)+_0x259018(0x262)),console[_0x259018(0xcb)](_0x259018(0x125)+_0x44cdfe[_0x259018(0x1f4)]),console['log'](_0x259018(0x23c)+_0x44cdfe[_0x259018(0x234)][_0x259018(0x1db)][_0x259018(0x152)](0x6)+_0x259018(0x262)),console[_0x259018(0xcb)](_0x259018(0x220)+_0x44cdfe[_0x259018(0x234)][_0x259018(0x1d9)][_0x259018(0x152)](0x6)+_0x259018(0x262));let _0x20d962=0x0;if(_0x270917[_0x259018(0xac)]!==undefined){const _0x2d0123=Number(_0x44cdfe[_0x259018(0xac)]),_0x48ace0=Number(_0x270917[_0x259018(0xac)]);_0x20d962=_0x48ace0-_0x2d0123,console[_0x259018(0xcb)](_0x259018(0x1a9)+_0x48ace0[_0x259018(0x152)](0x6)+_0x259018(0x262)),console[_0x259018(0xcb)](_0x259018(0x143)+_0x20d962[_0x259018(0x152)](0x6)+_0x259018(0x262));if(_0x20d962<0x0)console[_0x259018(0xcb)](_0x259018(0x12b)+Math[_0x259018(0x192)](_0x20d962)[_0x259018(0x152)](0x6)+_0x259018(0x1c9));else{if(_0x20d962>0x0){const _0x458d8e=Number(_0x44cdfe['shop']['balance']);console['log'](_0x259018(0x10f)+_0x20d962['toFixed'](0x6)+_0x259018(0x212));if(_0x458d8e<_0x20d962)throw new Error('Insufficient\x20balance\x20for\x20amount\x20increase.\x20Available:\x20'+_0x458d8e['toFixed'](0x6)+_0x259018(0xd9)+_0x20d962[_0x259018(0x152)](0x6)+_0x259018(0x262));}}}const _0x38040a={};if(_0x270917[_0x259018(0xac)]!==undefined)_0x38040a[_0x259018(0xac)]=_0x270917[_0x259018(0xac)];if(_0x270917[_0x259018(0x1f4)]!==undefined)_0x38040a[_0x259018(0x1f4)]=_0x270917[_0x259018(0x1f4)];if(_0x270917[_0x259018(0x266)]!==undefined)_0x38040a[_0x259018(0x266)]=_0x270917[_0x259018(0x266)]||null;if(_0x270917[_0x259018(0x1a8)]!==undefined)_0x38040a[_0x259018(0x1a8)]=_0x270917[_0x259018(0x1a8)]||null;if(_0x270917[_0x259018(0x111)]!==undefined)_0x38040a[_0x259018(0x111)]=_0x270917[_0x259018(0x111)]||null;if(_0x270917[_0x259018(0x260)]!==undefined)_0x38040a['periodFrom']=_0x270917['periodFrom']?new Date(_0x270917[_0x259018(0x260)]):null;if(_0x270917[_0x259018(0x119)]!==undefined)_0x38040a[_0x259018(0x119)]=_0x270917['periodTo']?new Date(_0x270917[_0x259018(0x119)]):null;const _0x5e6088=await _0x147317[_0x259018(0x258)]['update']({'where':{'id':_0xcbb8fa},'data':_0x38040a,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(_0x20d962!==0x0){const _0x2d8d98=Number(_0x44cdfe['shop'][_0x259018(0x1db)]),_0x923dc1=Number(_0x44cdfe['shop'][_0x259018(0x1d9)]),_0x2ae235=_0x2d8d98-_0x20d962,_0x5098c5=_0x923dc1+_0x20d962;await _0x147317['shop'][_0x259018(0x250)]({'where':{'id':_0x44cdfe['shopId']},'data':{'balance':_0x2ae235,'totalPaidOut':_0x5098c5}}),console['log'](_0x259018(0x1ee)+_0x44cdfe[_0x259018(0x234)]['username']+_0x259018(0x127)),console[_0x259018(0xcb)]('\x20\x20\x20Balance:\x20'+_0x2d8d98[_0x259018(0x152)](0x6)+'\x20->\x20'+_0x2ae235[_0x259018(0x152)](0x6)+_0x259018(0x262)),console[_0x259018(0xcb)]('\x20\x20\x20Total\x20paid\x20out:\x20'+_0x923dc1[_0x259018(0x152)](0x6)+_0x259018(0xa0)+_0x5098c5['toFixed'](0x6)+_0x259018(0x262));}return console[_0x259018(0xcb)]('âœ…\x20Payout\x20'+_0xcbb8fa+'\x20updated\x20successfully'),_0x5e6088;});return{'id':_0x39e822['id'],'shopId':_0x39e822['shopId'],'shopName':_0x39e822[_0x3d4259(0x234)][_0x3d4259(0x14b)],'shopUsername':_0x39e822['shop'][_0x3d4259(0x1a3)],'amount':Number(_0x39e822[_0x3d4259(0xac)]),'network':_0x39e822[_0x3d4259(0x1f4)],'wallet':_0x39e822[_0x3d4259(0x266)],'status':_0x39e822[_0x3d4259(0x159)],'txid':_0x39e822[_0x3d4259(0x111)],'notes':_0x39e822[_0x3d4259(0x1a8)],'periodFrom':_0x39e822[_0x3d4259(0x260)],'periodTo':_0x39e822['periodTo'],'createdAt':_0x39e822[_0x3d4259(0x17f)],'paidAt':_0x39e822[_0x3d4259(0xd6)]};}async[a53_0x22e8f6(0xb9)](_0x5acdf3){const _0x5208c4=a53_0x22e8f6,{page:_0x2575a2,limit:_0x4e1351,status:_0x40bdc2,gateway:_0xd3b9a1,shopId:_0xadb7c2,dateFrom:_0xef975a,dateTo:_0x27e035,search:_0x5f21d2,currency:_0x248425,sortBy:_0x4827af,sortOrder:_0x2891b7}=_0x5acdf3,_0x3c99b8=(_0x2575a2-0x1)*_0x4e1351;console['log'](_0x5208c4(0x201),_0x5acdf3);const _0x242634=await database_1[_0x5208c4(0x141)]['payment'][_0x5208c4(0x184)]({'by':[_0x5208c4(0x1c5)],'_count':{'gateway':!![]}});console['log'](_0x5208c4(0xbd),_0x242634[_0x5208c4(0x182)](_0x3ffed2=>_0x3ffed2['gateway']+'\x20('+_0x3ffed2[_0x5208c4(0x1f3)][_0x5208c4(0x1c5)]+_0x5208c4(0x12f)));if(_0xd3b9a1){const _0x2e6aff=_0x242634[_0x5208c4(0x1fa)](_0x585192=>_0x585192['gateway']['toLowerCase']()===_0xd3b9a1[_0x5208c4(0x191)]());!_0x2e6aff&&_0xd3b9a1['toLowerCase']()!=='test_gateway'&&console[_0x5208c4(0xcb)]('âš ï¸\x20Requested\x20gateway\x20\x27'+_0xd3b9a1+_0x5208c4(0x107)+_0x242634[_0x5208c4(0x182)](_0x4b0c2f=>_0x4b0c2f[_0x5208c4(0x1c5)])[_0x5208c4(0x1e7)](',\x20'));}const _0x4cc600={};_0x40bdc2&&(_0x4cc600['status']=_0x40bdc2[_0x5208c4(0x1f9)]());if(!_0xd3b9a1)_0x4cc600[_0x5208c4(0x1c5)]={'not':_0x5208c4(0x204)};else{if(_0xd3b9a1&&(_0xd3b9a1[_0x5208c4(0x191)]()===_0x5208c4(0x204)||_0xd3b9a1===_0x5208c4(0x1ce)))_0x4cc600[_0x5208c4(0x1c5)]='test_gateway';else{let _0x418c7b=_0xd3b9a1;const _0x93178f=(0x0,gateway_1[_0x5208c4(0x261)])(_0xd3b9a1);if(_0x93178f)_0x418c7b=_0x93178f,console['log'](_0x5208c4(0x169)+_0xd3b9a1+_0x5208c4(0x11f)+_0x418c7b+'\x27');else{const _0x4ce974=(0x0,gateway_1['getGatewayIdByName'])(_0xd3b9a1);if(_0x4ce974){const _0x9f4e9c=(0x0,gateway_1[_0x5208c4(0x261)])(_0x4ce974);_0x9f4e9c&&(_0x418c7b=_0x9f4e9c,console[_0x5208c4(0xcb)](_0x5208c4(0xda)+_0xd3b9a1+'\x27\x20->\x20ID\x20\x27'+_0x4ce974+'\x27\x20->\x20name\x20\x27'+_0x418c7b+'\x27'));}else console['log'](_0x5208c4(0x13b)+_0xd3b9a1+_0x5208c4(0x1c4));}const _0xe2d5c4=await database_1[_0x5208c4(0x141)][_0x5208c4(0xd3)][_0x5208c4(0x164)]({'where':{'gateway':_0x418c7b[_0x5208c4(0x191)]()},'take':0x1});_0xe2d5c4===0x0?(console[_0x5208c4(0xcb)]('âš ï¸\x20Gateway\x20\x27'+_0x418c7b+_0x5208c4(0xdd)+_0xd3b9a1+_0x5208c4(0x246)),_0x4cc600[_0x5208c4(0x1c5)]=_0x5208c4(0xea)):(_0x4cc600[_0x5208c4(0x1c5)]=_0x418c7b[_0x5208c4(0x191)](),console[_0x5208c4(0xcb)](_0x5208c4(0x1d8)+_0x418c7b+_0x5208c4(0xdd)+_0xd3b9a1+'\x27)'));}}console[_0x5208c4(0xcb)](_0x5208c4(0x1c2),_0x4cc600[_0x5208c4(0x1c5)]);_0xadb7c2&&(_0x4cc600[_0x5208c4(0xf2)]=_0xadb7c2);_0x248425&&(_0x4cc600[_0x5208c4(0x22c)]=_0x248425[_0x5208c4(0x1f9)](),console[_0x5208c4(0xcb)]('ðŸ’±\x20Currency\x20filter\x20applied:\x20'+_0x248425['toUpperCase']()));if(_0xef975a||_0x27e035){_0x4cc600[_0x5208c4(0x17f)]={};if(_0xef975a){const _0x3a0c11=new Date(_0xef975a),_0x4e1aba=new Date(Date['UTC'](_0x3a0c11[_0x5208c4(0x264)](),_0x3a0c11[_0x5208c4(0x1b2)](),_0x3a0c11['getUTCDate'](),0x0,0x0,0x0,0x0));_0x4cc600[_0x5208c4(0x17f)]['gte']=_0x4e1aba,console[_0x5208c4(0xcb)](_0x5208c4(0x17a)+_0x4e1aba[_0x5208c4(0x1f5)]());}if(_0x27e035){const _0x50f5f2=new Date(_0x27e035),_0x2f7d6e=new Date(Date['UTC'](_0x50f5f2[_0x5208c4(0x264)](),_0x50f5f2[_0x5208c4(0x1b2)](),_0x50f5f2[_0x5208c4(0x259)](),0x17,0x3b,0x3b,0x3e7));_0x4cc600['createdAt'][_0x5208c4(0x163)]=_0x2f7d6e,console[_0x5208c4(0xcb)](_0x5208c4(0x1cd)+_0x2f7d6e[_0x5208c4(0x1f5)]());}}_0x5f21d2&&(_0x4cc600['OR']=[{'id':{'contains':_0x5f21d2,'mode':_0x5208c4(0x156)}},{'orderId':{'contains':_0x5f21d2,'mode':_0x5208c4(0x156)}},{'gatewayOrderId':{'contains':_0x5f21d2,'mode':'insensitive'}},{'customerEmail':{'contains':_0x5f21d2,'mode':'insensitive'}},{'shop':{'name':{'contains':_0x5f21d2,'mode':_0x5208c4(0x156)}}},{'shop':{'username':{'contains':_0x5f21d2,'mode':'insensitive'}}}]);console['log']('ðŸ“Š\x20Final\x20WHERE\x20conditions:',JSON[_0x5208c4(0x1f7)](_0x4cc600,null,0x2));const _0x270794=await database_1[_0x5208c4(0x141)][_0x5208c4(0xd3)]['count']({'where':_0x4cc600});console[_0x5208c4(0xcb)](_0x5208c4(0xab)+_0x270794);let _0xf1c6f5={'createdAt':_0x5208c4(0x101)};if(_0x4827af){const _0xf82ffa=[_0x5208c4(0xac),'createdAt','updatedAt',_0x5208c4(0x159),_0x5208c4(0x1c5),_0x5208c4(0x22c)],_0x354c10=['asc','desc'];if(_0xf82ffa[_0x5208c4(0xd2)](_0x4827af)){const _0x3b7a92=_0x354c10[_0x5208c4(0xd2)](_0x2891b7)?_0x2891b7:_0x5208c4(0x101);_0xf1c6f5={[_0x4827af]:_0x3b7a92},console[_0x5208c4(0xcb)](_0x5208c4(0x148)+_0x4827af+'\x20in\x20'+_0x3b7a92+'\x20order');}}const [_0x4438eb,_0x599727]=await Promise[_0x5208c4(0x1d3)]([database_1[_0x5208c4(0x141)][_0x5208c4(0xd3)][_0x5208c4(0x1f8)]({'where':_0x4cc600,'skip':_0x3c99b8,'take':_0x4e1351,'orderBy':_0xf1c6f5,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x5208c4(0xd3)]['count']({'where':_0x4cc600})]);let _0x2c8e42,_0x3ac212;if(_0xef975a){const _0x2cf3e0=new Date(_0xef975a);_0x2c8e42=new Date(Date[_0x5208c4(0x18c)](_0x2cf3e0[_0x5208c4(0x264)](),_0x2cf3e0[_0x5208c4(0x1b2)](),_0x2cf3e0[_0x5208c4(0x259)](),0x0,0x0,0x0,0x0));}else{const _0x15cee8=new Date();_0x2c8e42=new Date(Date[_0x5208c4(0x18c)](_0x15cee8['getUTCFullYear'](),_0x15cee8['getUTCMonth'](),_0x15cee8[_0x5208c4(0x259)](),0x0,0x0,0x0,0x0));}if(_0x27e035){const _0x518cdd=new Date(_0x27e035);_0x3ac212=new Date(Date[_0x5208c4(0x18c)](_0x518cdd[_0x5208c4(0x264)](),_0x518cdd['getUTCMonth'](),_0x518cdd[_0x5208c4(0x259)](),0x17,0x3b,0x3b,0x3e7));}else{if(_0xef975a){const _0x412ea3=new Date(_0xef975a);_0x3ac212=new Date(Date[_0x5208c4(0x18c)](_0x412ea3[_0x5208c4(0x264)](),_0x412ea3[_0x5208c4(0x1b2)](),_0x412ea3['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}else{const _0x17b286=new Date();_0x3ac212=new Date(Date[_0x5208c4(0x18c)](_0x17b286['getUTCFullYear'](),_0x17b286[_0x5208c4(0x1b2)](),_0x17b286[_0x5208c4(0x259)](),0x17,0x3b,0x3b,0x3e7));}}const _0x5798f6={};{const _0x2e4526={'status':_0x40bdc2?_0x40bdc2[_0x5208c4(0x1f9)]():_0x5208c4(0xba),'createdAt':{'gte':_0x2c8e42,'lte':_0x3ac212}};_0xd3b9a1?_0x2e4526[_0x5208c4(0x1c5)]=_0x4cc600[_0x5208c4(0x1c5)]:_0x2e4526[_0x5208c4(0x1c5)]={'not':_0x5208c4(0x204)};_0xadb7c2&&(_0x2e4526[_0x5208c4(0xf2)]=_0xadb7c2);_0x248425&&(_0x2e4526[_0x5208c4(0x22c)]=_0x248425[_0x5208c4(0x1f9)]());console[_0x5208c4(0xcb)](_0x5208c4(0x237),JSON[_0x5208c4(0x1f7)](_0x2e4526,null,0x2));const _0x5e62bf=await database_1[_0x5208c4(0x141)][_0x5208c4(0xd3)][_0x5208c4(0x1f8)]({'where':_0x2e4526,'select':{'amountUSDT':!![],'currency':!![],'amount':!![]}});let _0x467cdb=0x0;_0x5e62bf[_0x5208c4(0x117)](_0x21acce=>{const _0x188456=_0x5208c4;_0x21acce[_0x188456(0x244)]&&(_0x467cdb+=_0x21acce[_0x188456(0x244)]);if(_0x21acce['currency']){const _0x26a11b=_0x21acce[_0x188456(0x22c)][_0x188456(0x1f9)]();!_0x5798f6[_0x26a11b]&&(_0x5798f6[_0x26a11b]=0x0),_0x5798f6[_0x26a11b]+=_0x21acce[_0x188456(0xac)];}}),_0x467cdb>0x0&&(_0x5798f6[_0x5208c4(0x273)]=_0x467cdb);}return{'payments':_0x4438eb,'pagination':{'page':_0x2575a2,'limit':_0x4e1351,'total':_0x599727,'totalPages':Math[_0x5208c4(0x112)](_0x599727/_0x4e1351)},'statistics':_0x5798f6};}async[a53_0x22e8f6(0x1b6)](_0x33afee){const _0x3e3806=a53_0x22e8f6,_0x264e60=await database_1[_0x3e3806(0x141)]['payment'][_0x3e3806(0x179)]({'where':{'id':_0x33afee},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x264e60)return null;return{'id':_0x264e60['id'],'shopId':_0x264e60[_0x3e3806(0xf2)],'gateway':_0x264e60[_0x3e3806(0x1c5)],'amount':_0x264e60[_0x3e3806(0xac)],'currency':_0x264e60[_0x3e3806(0x22c)],'status':_0x264e60[_0x3e3806(0x159)],'orderId':_0x264e60[_0x3e3806(0x236)],'gatewayOrderId':_0x264e60[_0x3e3806(0xfd)],'customerEmail':_0x264e60[_0x3e3806(0xce)],'customerName':_0x264e60[_0x3e3806(0x13d)],'customerCountry':_0x264e60['customerCountry'],'customerIp':_0x264e60[_0x3e3806(0x207)],'customerUa':_0x264e60['customerUa'],'failureMessage':_0x264e60[_0x3e3806(0xfe)],'externalPaymentUrl':_0x264e60[_0x3e3806(0x185)],'successUrl':_0x264e60[_0x3e3806(0x254)],'failUrl':_0x264e60[_0x3e3806(0x1eb)],'pendingUrl':_0x264e60['pendingUrl'],'whiteUrl':_0x264e60['whiteUrl'],'createdAt':_0x264e60['createdAt'],'updatedAt':_0x264e60[_0x3e3806(0x13c)],'shop':_0x264e60[_0x3e3806(0x234)]};}async[a53_0x22e8f6(0x14a)](_0x95ecfd,_0x56e5c5,_0x5829c4,_0x55e9f2){const _0x4101ad=a53_0x22e8f6,_0x539649=await database_1['default']['$transaction'](async _0xa1cff6=>{const _0x309b20=a53_0x222d,_0x9886cf=await _0xa1cff6[_0x309b20(0xd3)]['findUnique']({'where':{'id':_0x95ecfd},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x9886cf)throw new Error(_0x309b20(0x1bf));const _0x158cea=_0x9886cf[_0x309b20(0x159)],_0x851a89=_0x56e5c5[_0x309b20(0x1f9)]();console[_0x309b20(0xcb)](_0x309b20(0x1aa)+_0x95ecfd+'\x20status:\x20'+_0x158cea+'\x20->\x20'+_0x851a89),console['log'](_0x309b20(0xa8)+_0x9886cf[_0x309b20(0x234)][_0x309b20(0x1db)]+_0x309b20(0x262));const _0x382af1={'status':_0x851a89,'updatedAt':new Date(),'statusChangedBy':'admin','statusChangedAt':new Date()};_0x5829c4&&(_0x382af1['adminNotes']=_0x5829c4);_0x851a89===_0x309b20(0x11e)&&_0x55e9f2&&(_0x382af1[_0x309b20(0x228)]=_0x55e9f2);let _0x4b539c=0x0,_0x4640da=_0x9886cf[_0x309b20(0x234)][_0x309b20(0x1db)];if(_0x851a89===_0x309b20(0xba)&&_0x158cea!==_0x309b20(0xba)){_0x382af1[_0x309b20(0xd6)]=new Date();const _0x1f4bef=await currencyService_1[_0x309b20(0x123)][_0x309b20(0xcc)](_0x9886cf[_0x309b20(0xac)],_0x9886cf[_0x309b20(0x22c)]);_0x382af1[_0x309b20(0x244)]=_0x1f4bef;let _0x2cb716=0x2d;const _0x1babf8=await _0xa1cff6[_0x309b20(0x234)]['findUnique']({'where':{'id':_0x9886cf['shopId']},'select':{'gatewaySettings':!![]}});if(_0x1babf8?.[_0x309b20(0x202)])try{const _0x2774b7=JSON[_0x309b20(0xb3)](_0x1babf8[_0x309b20(0x202)]);for(const [_0x4632ae,_0x1cc537]of Object['entries'](_0x2774b7)){if(_0x4632ae[_0x309b20(0x191)]()===_0x9886cf[_0x309b20(0x1c5)]['toLowerCase']()){_0x2cb716=_0x1cc537[_0x309b20(0xc7)]||0xa;break;}}}catch(_0x5b9114){console[_0x309b20(0x226)](_0x309b20(0xd8)+_0x95ecfd+':',_0x5b9114);}let _0x58183d;_0x9886cf[_0x309b20(0x124)]!==null&&_0x9886cf[_0x309b20(0x124)]!==undefined?(_0x58183d=_0x9886cf[_0x309b20(0x124)],console[_0x309b20(0xcb)](_0x309b20(0xf9)+_0x58183d[_0x309b20(0x152)](0x6)+_0x309b20(0x1d6)+_0x95ecfd)):(_0x58183d=_0x1f4bef*(0x1-_0x2cb716/0x64),console[_0x309b20(0xcb)]('ðŸ“Š\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20'+_0x95ecfd+':\x20'+_0x2cb716+_0x309b20(0x245)+_0x1f4bef[_0x309b20(0x152)](0x6)+'\x20USDT'),_0x382af1[_0x309b20(0x124)]=_0x58183d,_0x382af1[_0x309b20(0x1cc)]=_0x2cb716),_0x4b539c=_0x58183d,_0x4640da+=_0x58183d,console[_0x309b20(0xcb)](_0x309b20(0x1e6)+_0x95ecfd+_0x309b20(0xa6)),console[_0x309b20(0xcb)]('\x20\x20\x20Full\x20amount:\x20'+_0x1f4bef['toFixed'](0x6)+_0x309b20(0x262)),console[_0x309b20(0xcb)](_0x309b20(0xc5)+_0x9886cf['gateway']+_0x309b20(0x1ba)+_0x2cb716+'%'),console[_0x309b20(0xcb)](_0x309b20(0x153)+_0x58183d['toFixed'](0x6)+_0x309b20(0x10c)+_0x2cb716+_0x309b20(0xd7)),console[_0x309b20(0xcb)](_0x309b20(0xa7)+_0x58183d[_0x309b20(0x152)](0x6)+_0x309b20(0x262));}else{if(_0x158cea==='PAID'&&_0x851a89!==_0x309b20(0xba)&&_0x851a89!==_0x309b20(0x11e)){if(_0x9886cf['amountUSDT']){let _0x2c3ef2=0x2d;const _0x50a69d=await _0xa1cff6[_0x309b20(0x234)]['findUnique']({'where':{'id':_0x9886cf[_0x309b20(0xf2)]},'select':{'gatewaySettings':!![]}});if(_0x50a69d?.[_0x309b20(0x202)])try{const _0x53feb5=JSON[_0x309b20(0xb3)](_0x50a69d['gatewaySettings']);for(const [_0x2e74da,_0x24ddec]of Object[_0x309b20(0x130)](_0x53feb5)){if(_0x2e74da[_0x309b20(0x191)]()===_0x9886cf[_0x309b20(0x1c5)][_0x309b20(0x191)]()){_0x2c3ef2=_0x24ddec[_0x309b20(0xc7)]||0xa;break;}}}catch(_0x3bcb31){console[_0x309b20(0x226)](_0x309b20(0xd8)+_0x95ecfd+':',_0x3bcb31);}const _0x265f26=_0x9886cf['amountUSDT']*(0x1-_0x2c3ef2/0x64);_0x4b539c=-_0x265f26,_0x4640da-=_0x265f26,console['log'](_0x309b20(0xc9)+_0x9886cf[_0x309b20(0x244)]['toFixed'](0x6)+'\x20USDT'),console[_0x309b20(0xcb)](_0x309b20(0xc5)+_0x9886cf[_0x309b20(0x1c5)]+_0x309b20(0x1ba)+_0x2c3ef2+'%'),console[_0x309b20(0xcb)](_0x309b20(0xcd)+_0x265f26[_0x309b20(0x152)](0x6)+_0x309b20(0x10c)+_0x2c3ef2+'%\x20commission)'),console[_0x309b20(0xcb)](_0x309b20(0x14d)+_0x265f26[_0x309b20(0x152)](0x6)+_0x309b20(0x262));}}}_0x851a89==='CHARGEBACK'&&(console[_0x309b20(0xcb)](_0x309b20(0x219)),_0x55e9f2&&_0x55e9f2>0x0?(_0x4b539c=-_0x55e9f2,_0x4640da-=_0x55e9f2,console[_0x309b20(0xcb)](_0x309b20(0xf0)+_0x55e9f2['toFixed'](0x6)+'\x20USDT\x20from\x20balance'),console[_0x309b20(0xcb)](_0x309b20(0x19a))):console[_0x309b20(0xcb)](_0x309b20(0x138)),_0x382af1[_0x309b20(0x228)]=_0x55e9f2||0x0);_0x851a89===_0x309b20(0x15b)&&_0x158cea===_0x309b20(0xba)&&console['log'](_0x309b20(0x183));const _0xf93dfb=await _0xa1cff6[_0x309b20(0xd3)][_0x309b20(0x250)]({'where':{'id':_0x95ecfd},'data':_0x382af1,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x4b539c!==0x0&&(await _0xa1cff6[_0x309b20(0x234)][_0x309b20(0x250)]({'where':{'id':_0x9886cf['shopId']},'data':{'balance':_0x4640da}}),console[_0x309b20(0xcb)](_0x309b20(0x1ee)+_0x9886cf[_0x309b20(0xf2)]+'\x20balance\x20updated:\x20'+_0x9886cf['shop'][_0x309b20(0x1db)][_0x309b20(0x152)](0x6)+_0x309b20(0xa0)+_0x4640da[_0x309b20(0x152)](0x6)+_0x309b20(0x120)+(_0x4b539c>0x0?'+':'')+_0x4b539c[_0x309b20(0x152)](0x6)+')')),_0xf93dfb;});return{'id':_0x539649['id'],'shopId':_0x539649[_0x4101ad(0xf2)],'gateway':_0x539649[_0x4101ad(0x1c5)],'amount':_0x539649[_0x4101ad(0xac)],'currency':_0x539649[_0x4101ad(0x22c)],'status':_0x539649['status'],'orderId':_0x539649[_0x4101ad(0x236)],'gatewayOrderId':_0x539649[_0x4101ad(0xfd)],'customerEmail':_0x539649[_0x4101ad(0xce)],'customerName':_0x539649[_0x4101ad(0x13d)],'customerCountry':_0x539649[_0x4101ad(0x13f)],'customerIp':_0x539649[_0x4101ad(0x207)],'customerUa':_0x539649[_0x4101ad(0xad)],'failureMessage':_0x539649[_0x4101ad(0xfe)],'adminNotes':_0x539649[_0x4101ad(0x272)],'chargebackAmount':_0x539649[_0x4101ad(0x228)],'statusChangedBy':_0x539649[_0x4101ad(0x131)],'statusChangedAt':_0x539649['statusChangedAt'],'createdAt':_0x539649['createdAt'],'updatedAt':_0x539649[_0x4101ad(0x13c)],'shop':_0x539649[_0x4101ad(0x234)]};}async[a53_0x22e8f6(0x133)](_0x30fe2e,_0x232cc4){const _0x617989=a53_0x22e8f6,_0x4f2971=Math[_0x617989(0x176)]()['toString'](0x24)[_0x617989(0x115)](0x2,0x9);console[_0x617989(0xcb)](_0x617989(0x18f)+_0x4f2971+_0x617989(0xe3)+_0x30fe2e);const _0x2d77d6={..._0x232cc4};_0x232cc4[_0x617989(0x1ef)]&&_0x232cc4[_0x617989(0x1ef)]['trim']()!==''?(console[_0x617989(0xcb)](_0x617989(0xa3)+_0x4f2971+_0x617989(0x263)+_0x30fe2e),_0x2d77d6[_0x617989(0x1ef)]=await bcryptjs_1[_0x617989(0x141)][_0x617989(0x166)](_0x232cc4[_0x617989(0x1ef)],0xc)):(console[_0x617989(0xcb)](_0x617989(0xa3)+_0x4f2971+_0x617989(0x195)),delete _0x2d77d6[_0x617989(0x1ef)]);_0x232cc4[_0x617989(0x23b)]&&(_0x2d77d6[_0x617989(0x14b)]=_0x232cc4[_0x617989(0x23b)],delete _0x2d77d6[_0x617989(0x23b)]);_0x232cc4[_0x617989(0x1e0)]&&(_0x2d77d6[_0x617989(0x1fe)]=_0x232cc4[_0x617989(0x1e0)],delete _0x2d77d6[_0x617989(0x1e0)]);_0x232cc4[_0x617989(0x11c)]&&(_0x2d77d6[_0x617989(0x26b)]=_0x232cc4[_0x617989(0x11c)],delete _0x2d77d6['merchantUrl']);if(_0x232cc4['gateways']){const _0x1a32ab=_0x232cc4[_0x617989(0x199)][_0x617989(0x182)](_0x3ba8e1=>this['getGatewayInternalName'](_0x3ba8e1));console[_0x617989(0xcb)](_0x617989(0x1cf),_0x232cc4[_0x617989(0x199)],'->',_0x1a32ab),_0x2d77d6[_0x617989(0x15a)]=JSON['stringify'](_0x1a32ab),delete _0x2d77d6['gateways'];}_0x232cc4[_0x617989(0x202)]&&(console[_0x617989(0xcb)](_0x617989(0x223)+_0x4f2971+_0x617989(0x221),_0x232cc4[_0x617989(0x202)]),_0x2d77d6[_0x617989(0x202)]=JSON[_0x617989(0x1f7)](_0x232cc4['gatewaySettings']),console['log'](_0x617989(0x223)+_0x4f2971+_0x617989(0x203),_0x2d77d6[_0x617989(0x202)]));_0x232cc4[_0x617989(0x1ec)]&&(_0x232cc4['wallets'][_0x617989(0xb5)]!==undefined&&(_0x2d77d6[_0x617989(0xb5)]=_0x232cc4[_0x617989(0x1ec)][_0x617989(0xb5)]||null),_0x232cc4[_0x617989(0x1ec)]['usdtTrcWallet']!==undefined&&(_0x2d77d6[_0x617989(0xf5)]=_0x232cc4['wallets'][_0x617989(0xf5)]||null),_0x232cc4[_0x617989(0x1ec)]['usdtErcWallet']!==undefined&&(_0x2d77d6[_0x617989(0xee)]=_0x232cc4[_0x617989(0x1ec)]['usdtErcWallet']||null),_0x232cc4[_0x617989(0x1ec)][_0x617989(0x15f)]!==undefined&&(_0x2d77d6[_0x617989(0x15f)]=_0x232cc4[_0x617989(0x1ec)][_0x617989(0x15f)]||null),delete _0x2d77d6[_0x617989(0x1ec)]);const _0x44349c=await database_1[_0x617989(0x141)][_0x617989(0x234)][_0x617989(0x250)]({'where':{'id':_0x30fe2e},'data':_0x2d77d6,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0x617989(0xcb)]('ðŸŽ¯\x20['+_0x4f2971+_0x617989(0xe6),_0x44349c[_0x617989(0x202)]),{'id':_0x44349c['id'],'fullName':_0x44349c[_0x617989(0x14b)],'username':_0x44349c[_0x617989(0x1a3)],'telegramId':_0x44349c[_0x617989(0x1fe)],'merchantUrl':_0x44349c[_0x617989(0x26b)],'gateways':_0x44349c[_0x617989(0x15a)]?JSON[_0x617989(0xb3)](_0x44349c[_0x617989(0x15a)]):null,'gatewaySettings':_0x44349c[_0x617989(0x202)]?JSON[_0x617989(0xb3)](_0x44349c[_0x617989(0x202)]):null,'publicKey':_0x44349c[_0x617989(0x106)],'wallets':{'usdtPolygonWallet':_0x44349c['usdtPolygonWallet'],'usdtTrcWallet':_0x44349c['usdtTrcWallet'],'usdtErcWallet':_0x44349c['usdtErcWallet'],'usdcPolygonWallet':_0x44349c[_0x617989(0x15f)]},'status':_0x44349c['status'],'createdAt':_0x44349c[_0x617989(0x17f)]};}async['suspendUser'](_0x1fcc50){const _0xd06478=a53_0x22e8f6,_0x3d236d=await database_1['default'][_0xd06478(0x234)][_0xd06478(0x250)]({'where':{'id':_0x1fcc50},'data':{'status':_0xd06478(0xc0)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x3d236d['id'],'fullName':_0x3d236d[_0xd06478(0x14b)],'username':_0x3d236d['username'],'telegramId':_0x3d236d[_0xd06478(0x1fe)],'merchantUrl':_0x3d236d[_0xd06478(0x26b)],'gateways':_0x3d236d[_0xd06478(0x15a)]?JSON[_0xd06478(0xb3)](_0x3d236d[_0xd06478(0x15a)]):null,'gatewaySettings':_0x3d236d[_0xd06478(0x202)]?JSON[_0xd06478(0xb3)](_0x3d236d[_0xd06478(0x202)]):null,'publicKey':_0x3d236d['publicKey'],'wallets':{'usdtPolygonWallet':_0x3d236d[_0xd06478(0xb5)],'usdtTrcWallet':_0x3d236d[_0xd06478(0xf5)],'usdtErcWallet':_0x3d236d[_0xd06478(0xee)],'usdcPolygonWallet':_0x3d236d[_0xd06478(0x15f)]},'status':_0x3d236d[_0xd06478(0x159)],'createdAt':_0x3d236d['createdAt']};}async[a53_0x22e8f6(0x206)](_0x4ca8b8){const _0x89dd13=a53_0x22e8f6,_0x51b141=await database_1[_0x89dd13(0x141)][_0x89dd13(0x234)][_0x89dd13(0x250)]({'where':{'id':_0x4ca8b8},'data':{'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x51b141['id'],'fullName':_0x51b141['name'],'username':_0x51b141[_0x89dd13(0x1a3)],'telegramId':_0x51b141[_0x89dd13(0x1fe)],'merchantUrl':_0x51b141[_0x89dd13(0x26b)],'gateways':_0x51b141[_0x89dd13(0x15a)]?JSON['parse'](_0x51b141['paymentGateways']):null,'gatewaySettings':_0x51b141[_0x89dd13(0x202)]?JSON[_0x89dd13(0xb3)](_0x51b141[_0x89dd13(0x202)]):null,'publicKey':_0x51b141['publicKey'],'wallets':{'usdtPolygonWallet':_0x51b141[_0x89dd13(0xb5)],'usdtTrcWallet':_0x51b141[_0x89dd13(0xf5)],'usdtErcWallet':_0x51b141[_0x89dd13(0xee)],'usdcPolygonWallet':_0x51b141[_0x89dd13(0x15f)]},'status':_0x51b141[_0x89dd13(0x159)],'createdAt':_0x51b141[_0x89dd13(0x17f)]};}async[a53_0x22e8f6(0x1d7)](_0xf754c2){const _0x285e2d=a53_0x22e8f6,{page:_0x1e63c4,limit:_0x48ae9b,status:_0x131307,search:_0x2e5f47}=_0xf754c2,_0x9430b0=(_0x1e63c4-0x1)*_0x48ae9b,_0x5caf8c={};_0x131307&&(_0x5caf8c[_0x285e2d(0x159)]=_0x131307[_0x285e2d(0x1f9)]());_0x2e5f47&&(_0x5caf8c['OR']=[{'name':{'contains':_0x2e5f47,'mode':'insensitive'}},{'username':{'contains':_0x2e5f47,'mode':_0x285e2d(0x156)}},{'telegram':{'contains':_0x2e5f47,'mode':_0x285e2d(0x156)}},{'shopUrl':{'contains':_0x2e5f47,'mode':'insensitive'}}]);const [_0x84f52e,_0x567a6a]=await Promise[_0x285e2d(0x1d3)]([database_1['default'][_0x285e2d(0x234)][_0x285e2d(0x1f8)]({'where':_0x5caf8c,'skip':_0x9430b0,'take':_0x48ae9b,'orderBy':{'createdAt':_0x285e2d(0x101)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'twoFactorEnabled':!![],'createdAt':!![],'lastLoginAt':!![],'_count':{'select':{'telegramUsers':!![]}}}}),database_1[_0x285e2d(0x141)][_0x285e2d(0x234)][_0x285e2d(0x164)]({'where':_0x5caf8c})]);return{'users':_0x84f52e[_0x285e2d(0x182)](_0x338448=>{const _0x353d7b=_0x285e2d,_0x52283f=_0x338448[_0x353d7b(0x15a)]?JSON[_0x353d7b(0xb3)](_0x338448[_0x353d7b(0x15a)]):null,_0x4c197e=_0x52283f?_0x52283f['map'](_0x366a66=>this[_0x353d7b(0x136)](_0x366a66)):null;return{'id':_0x338448['id'],'fullName':_0x338448[_0x353d7b(0x14b)],'username':_0x338448[_0x353d7b(0x1a3)],'telegramId':_0x338448[_0x353d7b(0x1fe)],'merchantUrl':_0x338448[_0x353d7b(0x26b)],'gateways':_0x4c197e,'gatewaySettings':_0x338448[_0x353d7b(0x202)]?JSON[_0x353d7b(0xb3)](_0x338448[_0x353d7b(0x202)]):null,'publicKey':_0x338448['publicKey'],'wallets':{'usdtPolygonWallet':_0x338448['usdtPolygonWallet'],'usdtTrcWallet':_0x338448[_0x353d7b(0xf5)],'usdtErcWallet':_0x338448['usdtErcWallet'],'usdcPolygonWallet':_0x338448[_0x353d7b(0x15f)],'usdcErcWallet':_0x338448[_0x353d7b(0x23e)]},'status':_0x338448['status'],'twoFactorEnabled':_0x338448['twoFactorEnabled']||![],'telegramUsersCount':_0x338448[_0x353d7b(0x1f3)]['telegramUsers'],'createdAt':_0x338448['createdAt'],'lastLoginAt':_0x338448[_0x353d7b(0x171)]};}),'pagination':{'page':_0x1e63c4,'limit':_0x48ae9b,'total':_0x567a6a,'totalPages':Math['ceil'](_0x567a6a/_0x48ae9b)}};}async[a53_0x22e8f6(0x208)](_0x20858d){const _0xe8c0b8=a53_0x22e8f6,_0x349ecb=await database_1[_0xe8c0b8(0x141)][_0xe8c0b8(0x234)][_0xe8c0b8(0x179)]({'where':{'id':_0x20858d},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x349ecb)return null;const _0x43a42e=_0x349ecb[_0xe8c0b8(0x15a)]?JSON[_0xe8c0b8(0xb3)](_0x349ecb[_0xe8c0b8(0x15a)]):null,_0xa45c89=_0x43a42e?_0x43a42e[_0xe8c0b8(0x182)](_0x112385=>this[_0xe8c0b8(0x136)](_0x112385)):null;return _0x43a42e&&_0xa45c89&&console[_0xe8c0b8(0xcb)](_0xe8c0b8(0x113),_0x43a42e,'->',_0xa45c89),{'id':_0x349ecb['id'],'fullName':_0x349ecb[_0xe8c0b8(0x14b)],'username':_0x349ecb[_0xe8c0b8(0x1a3)],'telegramId':_0x349ecb[_0xe8c0b8(0x1fe)],'merchantUrl':_0x349ecb[_0xe8c0b8(0x26b)],'gateways':_0xa45c89,'gatewaySettings':_0x349ecb['gatewaySettings']?JSON[_0xe8c0b8(0xb3)](_0x349ecb[_0xe8c0b8(0x202)]):null,'publicKey':_0x349ecb[_0xe8c0b8(0x106)],'wallets':{'usdtPolygonWallet':_0x349ecb['usdtPolygonWallet'],'usdtTrcWallet':_0x349ecb[_0xe8c0b8(0xf5)],'usdtErcWallet':_0x349ecb[_0xe8c0b8(0xee)],'usdcPolygonWallet':_0x349ecb[_0xe8c0b8(0x15f)],'usdcErcWallet':_0x349ecb[_0xe8c0b8(0x23e)]},'status':_0x349ecb[_0xe8c0b8(0x159)],'createdAt':_0x349ecb['createdAt']};}async[a53_0x22e8f6(0x1ed)](_0xe5b864){const _0x4e0738=a53_0x22e8f6,{fullName:_0x5c311c,username:_0x2696f2,password:_0x4cbb45,telegramId:_0x123d29,merchantUrl:_0x4b2ab9,gateways:_0x199b8b,gatewaySettings:_0x41307a,wallets:_0x35f1ff}=_0xe5b864,_0x3c48ea=await database_1[_0x4e0738(0x141)]['shop'][_0x4e0738(0x179)]({'where':{'username':_0x2696f2}});if(_0x3c48ea)throw new Error('Username\x20already\x20exists');if(_0x123d29){const _0x5d740a=await database_1[_0x4e0738(0x141)][_0x4e0738(0x234)]['findUnique']({'where':{'telegram':_0x123d29}});if(_0x5d740a)throw new Error(_0x4e0738(0x193));}const _0x92a4c9=await bcryptjs_1[_0x4e0738(0x141)]['hash'](_0x4cbb45,0xc),_0x39e383=_0x4e0738(0x1b7)+crypto_1[_0x4e0738(0x141)]['randomBytes'](0x20)['toString'](_0x4e0738(0x26d)),_0x56aa66=_0x4e0738(0x1c6)+crypto_1[_0x4e0738(0x141)][_0x4e0738(0x146)](0x20)[_0x4e0738(0xdf)]('hex'),_0x287b7f=_0x199b8b?_0x199b8b[_0x4e0738(0x182)](_0x41db10=>this[_0x4e0738(0x19d)](_0x41db10)):null;_0x199b8b&&_0x287b7f&&console[_0x4e0738(0xcb)](_0x4e0738(0x24c),_0x199b8b,'->',_0x287b7f);const _0x1142be=await database_1[_0x4e0738(0x141)]['shop'][_0x4e0738(0x16e)]({'data':{'name':_0x5c311c,'username':_0x2696f2,'password':_0x92a4c9,'telegram':_0x123d29,'shopUrl':_0x4b2ab9,'paymentGateways':_0x287b7f?JSON[_0x4e0738(0x1f7)](_0x287b7f):null,'gatewaySettings':_0x41307a?JSON[_0x4e0738(0x1f7)](_0x41307a):null,'usdtPolygonWallet':_0x35f1ff?.['usdtPolygonWallet']||null,'usdtTrcWallet':_0x35f1ff?.[_0x4e0738(0xf5)]||null,'usdtErcWallet':_0x35f1ff?.[_0x4e0738(0xee)]||null,'usdcPolygonWallet':_0x35f1ff?.[_0x4e0738(0x15f)]||null,'publicKey':_0x39e383,'secretKey':_0x56aa66,'status':_0x4e0738(0x162)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x1142be['id'],'fullName':_0x1142be[_0x4e0738(0x14b)],'username':_0x1142be[_0x4e0738(0x1a3)],'telegramId':_0x1142be[_0x4e0738(0x1fe)],'merchantUrl':_0x1142be[_0x4e0738(0x26b)],'gateways':_0x1142be['paymentGateways']?JSON[_0x4e0738(0xb3)](_0x1142be[_0x4e0738(0x15a)]):null,'gatewaySettings':_0x1142be['gatewaySettings']?JSON[_0x4e0738(0xb3)](_0x1142be[_0x4e0738(0x202)]):null,'publicKey':_0x1142be['publicKey'],'wallets':{'usdtPolygonWallet':_0x1142be[_0x4e0738(0xb5)],'usdtTrcWallet':_0x1142be[_0x4e0738(0xf5)],'usdtErcWallet':_0x1142be[_0x4e0738(0xee)],'usdcPolygonWallet':_0x1142be[_0x4e0738(0x15f)]},'status':_0x1142be[_0x4e0738(0x159)],'createdAt':_0x1142be[_0x4e0738(0x17f)]};}async[a53_0x22e8f6(0x256)](_0x75385d,_0x2371be){const _0x1c3e6c=a53_0x22e8f6;if(config_1[_0x1c3e6c(0x12e)][_0x1c3e6c(0xa2)][_0x1c3e6c(0xa1)]){if(!_0x2371be)throw new Error(_0x1c3e6c(0x215));const _0x4fa4aa=speakeasy_1[_0x1c3e6c(0x141)][_0x1c3e6c(0x1b4)]['verify']({'secret':config_1[_0x1c3e6c(0x12e)][_0x1c3e6c(0xa2)][_0x1c3e6c(0x198)],'encoding':_0x1c3e6c(0x1da),'token':_0x2371be,'window':0x2});if(!_0x4fa4aa){let _0x5eec0a=![];if(config_1['config'][_0x1c3e6c(0xa2)][_0x1c3e6c(0x1cb)]){const _0x320819=JSON[_0x1c3e6c(0xb3)](config_1[_0x1c3e6c(0x12e)][_0x1c3e6c(0xa2)][_0x1c3e6c(0x1cb)]);for(let _0x2729af=0x0;_0x2729af<_0x320819[_0x1c3e6c(0xa4)];_0x2729af++){const _0x4fd397=await bcryptjs_1[_0x1c3e6c(0x141)][_0x1c3e6c(0x10e)](_0x2371be,_0x320819[_0x2729af]);if(_0x4fd397){_0x5eec0a=!![],_0x320819[_0x1c3e6c(0x1e1)](_0x2729af,0x1),config_1['config'][_0x1c3e6c(0xa2)][_0x1c3e6c(0x1cb)]=JSON[_0x1c3e6c(0x1f7)](_0x320819);const _0x32c1dd=path_1['default']['join'](process[_0x1c3e6c(0x196)](),_0x1c3e6c(0x232));if(fs_1['default'][_0x1c3e6c(0x1a0)](_0x32c1dd)){let _0x166fd1=fs_1[_0x1c3e6c(0x141)][_0x1c3e6c(0x24d)](_0x32c1dd,_0x1c3e6c(0x21a));const _0x147e18=_0x166fd1['split']('\x0a');for(let _0x4b7cde=0x0;_0x4b7cde<_0x147e18[_0x1c3e6c(0xa4)];_0x4b7cde++){if(_0x147e18[_0x4b7cde]['startsWith'](_0x1c3e6c(0x268))){_0x147e18[_0x4b7cde]=_0x1c3e6c(0x268)+JSON[_0x1c3e6c(0x1f7)](_0x320819);break;}}fs_1[_0x1c3e6c(0x141)][_0x1c3e6c(0xa9)](_0x32c1dd,_0x147e18[_0x1c3e6c(0x1e7)]('\x0a'),_0x1c3e6c(0x21a));}break;}}}if(!_0x5eec0a)throw new Error(_0x1c3e6c(0x100));}}await database_1[_0x1c3e6c(0x141)][_0x1c3e6c(0x234)][_0x1c3e6c(0x12c)]({'where':{'id':_0x75385d}});}async[a53_0x22e8f6(0xe8)](_0x1e5070){const _0x1bf459=a53_0x22e8f6,_0x3f6ab5=await database_1['default']['shop'][_0x1bf459(0x179)]({'where':{'id':_0x1e5070},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});if(!_0x3f6ab5)throw new Error(_0x1bf459(0xfa));return{'usdtPolygonWallet':_0x3f6ab5[_0x1bf459(0xb5)],'usdtTrcWallet':_0x3f6ab5[_0x1bf459(0xf5)],'usdtErcWallet':_0x3f6ab5[_0x1bf459(0xee)],'usdcPolygonWallet':_0x3f6ab5[_0x1bf459(0x15f)],'usdcErcWallet':_0x3f6ab5[_0x1bf459(0x23e)]};}['generateBackupCodes'](_0x37d5ab=0x8){const _0x371f61=a53_0x22e8f6,_0x3e0431=[];for(let _0x44edcd=0x0;_0x44edcd<_0x37d5ab;_0x44edcd++){const _0x40ff8f=crypto_1[_0x371f61(0x141)][_0x371f61(0x146)](0x4)[_0x371f61(0xdf)](_0x371f61(0x26d))['toUpperCase']();_0x3e0431[_0x371f61(0x12a)](_0x40ff8f);}return _0x3e0431;}async[a53_0x22e8f6(0x1ae)](_0x19847b){const _0x4fb0dc=a53_0x22e8f6,_0x206d1e=await database_1[_0x4fb0dc(0x141)][_0x4fb0dc(0x234)]['findUnique']({'where':{'id':_0x19847b},'select':{'id':!![],'name':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x206d1e)throw new Error('Shop\x20not\x20found');const _0x3652f1=speakeasy_1[_0x4fb0dc(0x141)][_0x4fb0dc(0x243)]({'name':'TrapaPay\x20('+_0x206d1e[_0x4fb0dc(0x1a3)]+')','issuer':'TrapaPay','length':0x20}),_0x214351=await qrcode_1[_0x4fb0dc(0x141)][_0x4fb0dc(0x1a4)](_0x3652f1[_0x4fb0dc(0x19e)]),_0x32dae5=this[_0x4fb0dc(0x108)](0x8),_0x3cba68=await Promise[_0x4fb0dc(0x1d3)](_0x32dae5['map'](_0x35fdd5=>bcryptjs_1[_0x4fb0dc(0x141)][_0x4fb0dc(0x166)](_0x35fdd5,0xa)));return await database_1[_0x4fb0dc(0x141)]['shop'][_0x4fb0dc(0x250)]({'where':{'id':_0x19847b},'data':{'twoFactorSecret':_0x3652f1[_0x4fb0dc(0x1da)],'backupCodes':JSON[_0x4fb0dc(0x1f7)](_0x3cba68)}}),console[_0x4fb0dc(0xcb)]('ðŸ”\x202FA\x20setup\x20initiated\x20for\x20shop:\x20'+_0x206d1e[_0x4fb0dc(0x1a3)]),console[_0x4fb0dc(0xcb)](_0x4fb0dc(0x22e)+_0x32dae5[_0x4fb0dc(0xa4)]+_0x4fb0dc(0x213)),{'secret':_0x3652f1[_0x4fb0dc(0x1da)],'qrCode':_0x214351,'manualEntryKey':_0x3652f1[_0x4fb0dc(0x1da)],'backupCodes':_0x32dae5};}async[a53_0x22e8f6(0xeb)](_0xc85f4d,_0x5df2cb){const _0x3e7f6c=a53_0x22e8f6,_0xcfb8ae=await database_1['default']['shop'][_0x3e7f6c(0x179)]({'where':{'id':_0xc85f4d},'select':{'id':!![],'username':!![],'twoFactorSecret':!![],'twoFactorEnabled':!![]}});if(!_0xcfb8ae)throw new Error(_0x3e7f6c(0xfa));if(!_0xcfb8ae['twoFactorSecret'])throw new Error(_0x3e7f6c(0x225));if(_0xcfb8ae[_0x3e7f6c(0xa1)])throw new Error(_0x3e7f6c(0x1a6));const _0x3557d2=speakeasy_1['default'][_0x3e7f6c(0x1b4)][_0x3e7f6c(0x15c)]({'secret':_0xcfb8ae[_0x3e7f6c(0x198)],'encoding':_0x3e7f6c(0x1da),'token':_0x5df2cb,'window':0x2});if(!_0x3557d2)throw new Error(_0x3e7f6c(0x1d4));return await database_1[_0x3e7f6c(0x141)][_0x3e7f6c(0x234)][_0x3e7f6c(0x250)]({'where':{'id':_0xc85f4d},'data':{'twoFactorEnabled':!![]}}),console[_0x3e7f6c(0xcb)](_0x3e7f6c(0x241)+_0xcfb8ae[_0x3e7f6c(0x1a3)]),{'enabled':!![]};}async[a53_0x22e8f6(0x231)](_0xdc7d8a){const _0x1d35dc=a53_0x22e8f6,_0x4e2f7c=await database_1[_0x1d35dc(0x141)][_0x1d35dc(0x234)][_0x1d35dc(0x179)]({'where':{'id':_0xdc7d8a},'select':{'id':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x4e2f7c)throw new Error('Shop\x20not\x20found');await database_1[_0x1d35dc(0x141)][_0x1d35dc(0x234)][_0x1d35dc(0x250)]({'where':{'id':_0xdc7d8a},'data':{'twoFactorEnabled':![],'twoFactorSecret':null,'backupCodes':null}}),console[_0x1d35dc(0xcb)]('ðŸ”\x202FA\x20disabled\x20for\x20shop:\x20'+_0x4e2f7c['username']);}async[a53_0x22e8f6(0x177)](_0x303e9c,_0x1bf61c,_0x5526c2,_0x3c12a6){const _0xd0174d=a53_0x22e8f6;if(_0x1bf61c!==_0x5526c2)throw new Error('New\x20password\x20and\x20confirmation\x20do\x20not\x20match');if(_0x1bf61c['length']<0x6)throw new Error(_0xd0174d(0x24a));const _0x5257ac=await bcryptjs_1['default']['compare'](_0x303e9c,config_1[_0xd0174d(0x12e)][_0xd0174d(0xa2)][_0xd0174d(0x168)]);if(!_0x5257ac)throw new Error('Current\x20password\x20is\x20incorrect');if(config_1['config']['admin'][_0xd0174d(0xa1)]){if(!_0x3c12a6)throw new Error(_0xd0174d(0x215));const _0x1db004=speakeasy_1['default'][_0xd0174d(0x1b4)][_0xd0174d(0x15c)]({'secret':config_1[_0xd0174d(0x12e)][_0xd0174d(0xa2)][_0xd0174d(0x198)],'encoding':'base32','token':_0x3c12a6,'window':0x2});if(!_0x1db004){let _0x10e30b=![];if(config_1[_0xd0174d(0x12e)][_0xd0174d(0xa2)][_0xd0174d(0x1cb)]){const _0x3ba380=JSON[_0xd0174d(0xb3)](config_1[_0xd0174d(0x12e)]['admin'][_0xd0174d(0x1cb)]);for(let _0x1eb6d4=0x0;_0x1eb6d4<_0x3ba380[_0xd0174d(0xa4)];_0x1eb6d4++){const _0x3ae464=await bcryptjs_1[_0xd0174d(0x141)][_0xd0174d(0x10e)](_0x3c12a6,_0x3ba380[_0x1eb6d4]);if(_0x3ae464){_0x10e30b=!![],_0x3ba380[_0xd0174d(0x1e1)](_0x1eb6d4,0x1),config_1[_0xd0174d(0x12e)][_0xd0174d(0xa2)]['backupCodes']=JSON[_0xd0174d(0x1f7)](_0x3ba380);const _0x4f0359=path_1[_0xd0174d(0x141)][_0xd0174d(0x1e7)](process[_0xd0174d(0x196)](),_0xd0174d(0x232));if(fs_1['default'][_0xd0174d(0x1a0)](_0x4f0359)){let _0x221098=fs_1['default'][_0xd0174d(0x24d)](_0x4f0359,_0xd0174d(0x21a));const _0x4fcbdf=_0x221098[_0xd0174d(0xd1)]('\x0a');for(let _0x59f43c=0x0;_0x59f43c<_0x4fcbdf['length'];_0x59f43c++){if(_0x4fcbdf[_0x59f43c][_0xd0174d(0x205)](_0xd0174d(0x268))){_0x4fcbdf[_0x59f43c]=_0xd0174d(0x268)+JSON[_0xd0174d(0x1f7)](_0x3ba380);break;}}fs_1[_0xd0174d(0x141)][_0xd0174d(0xa9)](_0x4f0359,_0x4fcbdf[_0xd0174d(0x1e7)]('\x0a'),'utf8');}break;}}}if(!_0x10e30b)throw new Error(_0xd0174d(0x100));}}const _0x2522bc=await bcryptjs_1[_0xd0174d(0x141)][_0xd0174d(0x166)](_0x1bf61c,0xc);config_1[_0xd0174d(0x12e)]['admin'][_0xd0174d(0x168)]=_0x2522bc;const _0x370b79=path_1[_0xd0174d(0x141)]['join'](process[_0xd0174d(0x196)](),_0xd0174d(0x232));let _0x4b3231='';if(fs_1['default'][_0xd0174d(0x1a0)](_0x370b79)){_0x4b3231=fs_1['default'][_0xd0174d(0x24d)](_0x370b79,_0xd0174d(0x21a));const _0x4dc7a0=_0x4b3231['split']('\x0a');let _0x1c25fe=![];for(let _0x33ad1a=0x0;_0x33ad1a<_0x4dc7a0[_0xd0174d(0xa4)];_0x33ad1a++){if(_0x4dc7a0[_0x33ad1a][_0xd0174d(0x205)]('ADMIN_PASSWORD_HASH=')){_0x4dc7a0[_0x33ad1a]=_0xd0174d(0x240)+_0x2522bc,_0x1c25fe=!![];break;}}!_0x1c25fe&&_0x4dc7a0[_0xd0174d(0x12a)](_0xd0174d(0x240)+_0x2522bc),_0x4b3231=_0x4dc7a0[_0xd0174d(0x1e7)]('\x0a'),fs_1[_0xd0174d(0x141)]['writeFileSync'](_0x370b79,_0x4b3231,'utf8');}console[_0xd0174d(0xcb)](_0xd0174d(0x118));}async['get2FASettings'](){const _0x344574=a53_0x22e8f6;let _0x2fb666=0x0;if(config_1[_0x344574(0x12e)][_0x344574(0xa2)][_0x344574(0x1cb)])try{const _0x5c60a2=JSON[_0x344574(0xb3)](config_1[_0x344574(0x12e)][_0x344574(0xa2)]['backupCodes']);_0x2fb666=_0x5c60a2[_0x344574(0xa4)];}catch(_0x5e964b){console[_0x344574(0x226)](_0x344574(0x160),_0x5e964b);}return{'twoFactorEnabled':config_1[_0x344574(0x12e)]['admin'][_0x344574(0xa1)],'backupCodesCount':_0x2fb666};}async[a53_0x22e8f6(0x173)](){const _0x3a4815=a53_0x22e8f6,_0x423178=speakeasy_1['default'][_0x3a4815(0x243)]({'name':_0x3a4815(0x1fc)+config_1[_0x3a4815(0x12e)][_0x3a4815(0xa2)][_0x3a4815(0x1a3)]+')','issuer':_0x3a4815(0x20a),'length':0x20}),_0x4a2870=await qrcode_1[_0x3a4815(0x141)][_0x3a4815(0x1a4)](_0x423178[_0x3a4815(0x19e)]),_0x7123f8=[];for(let _0x4c2d42=0x0;_0x4c2d42<0x8;_0x4c2d42++){const _0x35a9b5=crypto_1[_0x3a4815(0x141)][_0x3a4815(0x146)](0x4)[_0x3a4815(0xdf)](_0x3a4815(0x26d))['toUpperCase']();_0x7123f8[_0x3a4815(0x12a)](_0x35a9b5);}const _0x4f4e44=await Promise[_0x3a4815(0x1d3)](_0x7123f8['map'](_0x89afa4=>bcryptjs_1['default'][_0x3a4815(0x166)](_0x89afa4,0xa)));config_1[_0x3a4815(0x12e)]['admin'][_0x3a4815(0x198)]=_0x423178[_0x3a4815(0x1da)],config_1[_0x3a4815(0x12e)][_0x3a4815(0xa2)][_0x3a4815(0x1cb)]=JSON['stringify'](_0x4f4e44);const _0x1cc9a1=path_1[_0x3a4815(0x141)][_0x3a4815(0x1e7)](process[_0x3a4815(0x196)](),_0x3a4815(0x232));if(fs_1['default']['existsSync'](_0x1cc9a1)){let _0x55d4b3=fs_1[_0x3a4815(0x141)][_0x3a4815(0x24d)](_0x1cc9a1,_0x3a4815(0x21a));const _0x2b2f31=_0x55d4b3[_0x3a4815(0xd1)]('\x0a');let _0x3e6710=![],_0x21395c=![];for(let _0x3d8eb5=0x0;_0x3d8eb5<_0x2b2f31['length'];_0x3d8eb5++){_0x2b2f31[_0x3d8eb5][_0x3a4815(0x205)](_0x3a4815(0x135))&&(_0x2b2f31[_0x3d8eb5]='ADMIN_2FA_SECRET='+_0x423178[_0x3a4815(0x1da)],_0x3e6710=!![]),_0x2b2f31[_0x3d8eb5][_0x3a4815(0x205)]('ADMIN_BACKUP_CODES=')&&(_0x2b2f31[_0x3d8eb5]=_0x3a4815(0x268)+JSON[_0x3a4815(0x1f7)](_0x4f4e44),_0x21395c=!![]);}if(!_0x3e6710)_0x2b2f31[_0x3a4815(0x12a)](_0x3a4815(0x135)+_0x423178['base32']);if(!_0x21395c)_0x2b2f31[_0x3a4815(0x12a)](_0x3a4815(0x268)+JSON[_0x3a4815(0x1f7)](_0x4f4e44));fs_1[_0x3a4815(0x141)][_0x3a4815(0xa9)](_0x1cc9a1,_0x2b2f31[_0x3a4815(0x1e7)]('\x0a'),_0x3a4815(0x21a));}return console[_0x3a4815(0xcb)](_0x3a4815(0x178)),console['log'](_0x3a4815(0x22e)+_0x7123f8['length']+_0x3a4815(0x213)),{'secret':_0x423178[_0x3a4815(0x1da)],'qrCode':_0x4a2870,'manualEntryKey':_0x423178['base32'],'backupCodes':_0x7123f8};}async['enableAdmin2FA'](_0xa9aa8b){const _0x559dee=a53_0x22e8f6;if(!config_1[_0x559dee(0x12e)][_0x559dee(0xa2)][_0x559dee(0x198)])throw new Error(_0x559dee(0x225));if(config_1['config'][_0x559dee(0xa2)][_0x559dee(0xa1)])throw new Error('2FA\x20is\x20already\x20enabled');const _0x2358af=speakeasy_1[_0x559dee(0x141)][_0x559dee(0x1b4)][_0x559dee(0x15c)]({'secret':config_1[_0x559dee(0x12e)][_0x559dee(0xa2)][_0x559dee(0x198)],'encoding':'base32','token':_0xa9aa8b,'window':0x2});if(!_0x2358af)throw new Error(_0x559dee(0x1d4));config_1[_0x559dee(0x12e)][_0x559dee(0xa2)][_0x559dee(0xa1)]=!![];const _0x47a855=path_1[_0x559dee(0x141)]['join'](process[_0x559dee(0x196)](),'.env');if(fs_1['default'][_0x559dee(0x1a0)](_0x47a855)){let _0x20af55=fs_1['default'][_0x559dee(0x24d)](_0x47a855,_0x559dee(0x21a));const _0x571288=_0x20af55[_0x559dee(0xd1)]('\x0a');let _0x396c9b=![];for(let _0x4ad741=0x0;_0x4ad741<_0x571288['length'];_0x4ad741++){if(_0x571288[_0x4ad741][_0x559dee(0x205)](_0x559dee(0x265))){_0x571288[_0x4ad741]=_0x559dee(0x26a),_0x396c9b=!![];break;}}if(!_0x396c9b)_0x571288['push'](_0x559dee(0x26a));fs_1[_0x559dee(0x141)][_0x559dee(0xa9)](_0x47a855,_0x571288['join']('\x0a'),_0x559dee(0x21a));}return console[_0x559dee(0xcb)]('ðŸ”\x20Admin\x202FA\x20enabled'),{'enabled':!![]};}async[a53_0x22e8f6(0xc1)](){const _0x454116=a53_0x22e8f6;config_1['config'][_0x454116(0xa2)][_0x454116(0xa1)]=![],config_1[_0x454116(0x12e)]['admin']['twoFactorSecret']='',config_1[_0x454116(0x12e)][_0x454116(0xa2)][_0x454116(0x1cb)]='';const _0x47a0ae=path_1['default'][_0x454116(0x1e7)](process[_0x454116(0x196)](),_0x454116(0x232));if(fs_1['default'][_0x454116(0x1a0)](_0x47a0ae)){let _0x324708=fs_1[_0x454116(0x141)][_0x454116(0x24d)](_0x47a0ae,_0x454116(0x21a));const _0x1f1bf7=_0x324708[_0x454116(0xd1)]('\x0a');for(let _0x1ea83d=0x0;_0x1ea83d<_0x1f1bf7[_0x454116(0xa4)];_0x1ea83d++){_0x1f1bf7[_0x1ea83d]['startsWith'](_0x454116(0x265))&&(_0x1f1bf7[_0x1ea83d]=_0x454116(0xed)),_0x1f1bf7[_0x1ea83d][_0x454116(0x205)](_0x454116(0x135))&&(_0x1f1bf7[_0x1ea83d]=_0x454116(0x135)),_0x1f1bf7[_0x1ea83d][_0x454116(0x205)](_0x454116(0x268))&&(_0x1f1bf7[_0x1ea83d]=_0x454116(0x268));}fs_1[_0x454116(0x141)][_0x454116(0xa9)](_0x47a0ae,_0x1f1bf7[_0x454116(0x1e7)]('\x0a'),_0x454116(0x21a));}console[_0x454116(0xcb)](_0x454116(0x200));}[a53_0x22e8f6(0x274)](_0x1b18e3,_0x47118c,_0x166f01){const _0x421b02=a53_0x22e8f6,_0x5a876d=new Map(),_0x2c847f=new Date(_0x47118c);while(_0x2c847f<=_0x166f01){const _0x58ef1f=_0x2c847f[_0x421b02(0x1f5)]()[_0x421b02(0xd1)]('T')[0x0];_0x5a876d[_0x421b02(0xe5)](_0x58ef1f,{'revenue':0x0,'count':0x0}),_0x2c847f[_0x421b02(0x25f)](_0x2c847f[_0x421b02(0x165)]()+0x1);}for(const _0x47392d of _0x1b18e3){const _0x4cb7d8=_0x47392d[_0x421b02(0x17f)]['toISOString']()['split']('T')[0x0],_0x4b8f7d=_0x5a876d[_0x421b02(0xc2)](_0x4cb7d8);_0x4b8f7d&&(_0x4b8f7d[_0x421b02(0x164)]+=0x1,_0x47392d[_0x421b02(0x159)]==='PAID'&&(_0x47392d[_0x421b02(0x244)]?_0x4b8f7d[_0x421b02(0xca)]+=_0x47392d[_0x421b02(0x244)]:console[_0x421b02(0xcb)](_0x421b02(0x211)+_0x47392d['id']+_0x421b02(0x142))));}const _0x56f279=[],_0x177c7a=[];for(const [_0x441997,_0x22081f]of _0x5a876d){_0x56f279[_0x421b02(0x12a)]({'date':_0x441997,'amount':Math[_0x421b02(0x19c)](_0x22081f['revenue']*0x64)/0x64}),_0x177c7a[_0x421b02(0x12a)]({'date':_0x441997,'count':_0x22081f[_0x421b02(0x164)]});}return{'dailyRevenue':_0x56f279,'dailyPayments':_0x177c7a};}async[a53_0x22e8f6(0x270)](_0x486417){const _0x456960=a53_0x22e8f6;console[_0x456960(0xcb)](_0x456960(0xde),_0x486417);const _0x51d600=new Date(_0x486417[_0x456960(0x260)]),_0x870697=new Date(_0x486417['periodTo']),_0x2f0d29=new Date(Date[_0x456960(0x18c)](_0x51d600[_0x456960(0x264)](),_0x51d600[_0x456960(0x1b2)](),_0x51d600[_0x456960(0x259)](),0x0,0x0,0x0,0x0)),_0x3dd8a1=new Date(Date[_0x456960(0x18c)](_0x870697[_0x456960(0x264)](),_0x870697[_0x456960(0x1b2)](),_0x870697['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));console[_0x456960(0xcb)](_0x456960(0x14e)+_0x2f0d29[_0x456960(0x1f5)]()+_0x456960(0xf4)+_0x3dd8a1[_0x456960(0x1f5)]()),console[_0x456960(0xcb)](_0x456960(0x186)+_0x486417[_0x456960(0x1c5)]);const _0x44fc6d=await database_1['default']['payment']['findMany']({'where':{'status':_0x456960(0xba),'gateway':_0x486417['gateway'][_0x456960(0x191)](),'createdAt':{'gte':_0x2f0d29,'lte':_0x3dd8a1}},'select':{'id':!![],'shopId':!![],'amountAfterGatewayCommissionUSDT':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console[_0x456960(0xcb)](_0x456960(0x149)+_0x44fc6d[_0x456960(0xa4)]+_0x456960(0x26f)+_0x486417[_0x456960(0x1c5)]);const _0x386b43=new Map();for(const _0x522a4a of _0x44fc6d){const _0x4bfed8=_0x522a4a[_0x456960(0x124)]||0x0;if(_0x4bfed8<=0x0){console['warn'](_0x456960(0x211)+_0x522a4a['id']+_0x456960(0x1df));continue;}if(_0x386b43[_0x456960(0x23d)](_0x522a4a[_0x456960(0xf2)])){const _0x5cdc0d=_0x386b43[_0x456960(0xc2)](_0x522a4a[_0x456960(0xf2)]);_0x5cdc0d[_0x456960(0x13a)]+=_0x4bfed8;}else _0x386b43[_0x456960(0xe5)](_0x522a4a['shopId'],{'merchantId':_0x522a4a[_0x456960(0x234)]['id'],'merchantName':_0x522a4a[_0x456960(0x234)][_0x456960(0x14b)],'merchantUsername':_0x522a4a[_0x456960(0x234)]['username'],'totalAmount':_0x4bfed8});}const _0x3f6d6b=Array[_0x456960(0x189)](_0x386b43[_0x456960(0x1a2)]())['map'](_0x4a3568=>({'merchantId':_0x4a3568[_0x456960(0x1a5)],'merchantName':_0x4a3568[_0x456960(0xd4)],'merchantUsername':_0x4a3568['merchantUsername'],'gateway':_0x486417[_0x456960(0x1c5)],'periodFrom':_0x486417[_0x456960(0x260)],'periodTo':_0x486417[_0x456960(0x119)],'totalAmount':Math[_0x456960(0x19c)](_0x4a3568['totalAmount']*0x64)/0x64}));return _0x3f6d6b[_0x456960(0x1dc)]((_0x1b7338,_0x516c72)=>_0x516c72[_0x456960(0x13a)]-_0x1b7338[_0x456960(0x13a)]),console[_0x456960(0xcb)](_0x456960(0x17e)+_0x3f6d6b[_0x456960(0xa4)]+_0x456960(0xcf)),_0x3f6d6b;}async['depositBalance'](_0x5497be,_0x89c791,_0x3783e1){const _0x3ce02d=a53_0x22e8f6,_0x49041f=await database_1[_0x3ce02d(0x141)][_0x3ce02d(0x234)][_0x3ce02d(0x179)]({'where':{'id':_0x5497be}});if(!_0x49041f)throw new Error('Merchant\x20not\x20found');await database_1[_0x3ce02d(0x141)][_0x3ce02d(0x209)](async _0xe2f2d6=>{const _0x3a4102=_0x3ce02d;await _0xe2f2d6['payment'][_0x3a4102(0x16e)]({'data':{'shopId':_0x49041f['id'],'amount':_0x89c791,'amountUSDT':_0x89c791,'amountAfterGatewayCommissionUSDT':_0x89c791,'sourceCurrency':_0x3a4102(0x157),'currency':'USDC','status':_0x3a4102(0xba),'gateway':_0x3a4102(0x1b3),'customerName':_0x49041f[_0x3a4102(0x1a3)],'customerEmail':'@'+_0x49041f[_0x3a4102(0x1fe)],'paymentMethod':_0x3a4102(0xf1),'adminNotes':_0x3783e1||null,'successUrl':'-','failUrl':'-','paidAt':new Date()}}),await _0xe2f2d6[_0x3a4102(0x234)][_0x3a4102(0x250)]({'where':{'id':_0x49041f['id']},'data':{'balance':{'increment':_0x89c791}}});}),console[_0x3ce02d(0xcb)](_0x3ce02d(0x1e5)+_0x89c791+_0x3ce02d(0xc8)+_0x49041f[_0x3ce02d(0x1a3)]);}}function a53_0x222d(_0x7e687a,_0x5d3cd2){_0x7e687a=_0x7e687a-0xa0;const _0xdf7c19=a53_0xdf7c();let _0x222d15=_0xdf7c19[_0x7e687a];return _0x222d15;}exports[a53_0x22e8f6(0x216)]=AdminService;