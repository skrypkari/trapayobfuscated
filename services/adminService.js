'use strict';const a35_0x445d8d=a35_0x5bce;(function(_0x276a19,_0x17e240){const _0x17f2ef=a35_0x5bce,_0x37c34d=_0x276a19();while(!![]){try{const _0x27eef5=-parseInt(_0x17f2ef(0x125))/0x1*(parseInt(_0x17f2ef(0x183))/0x2)+parseInt(_0x17f2ef(0x162))/0x3+-parseInt(_0x17f2ef(0x170))/0x4+parseInt(_0x17f2ef(0x21f))/0x5+-parseInt(_0x17f2ef(0x192))/0x6*(parseInt(_0x17f2ef(0x1c1))/0x7)+parseInt(_0x17f2ef(0x18a))/0x8+parseInt(_0x17f2ef(0x1ba))/0x9;if(_0x27eef5===_0x17e240)break;else _0x37c34d['push'](_0x37c34d['shift']());}catch(_0x415b47){_0x37c34d['push'](_0x37c34d['shift']());}}}(a35_0x52c8,0xceaee));function a35_0x5bce(_0x215deb,_0x4d4509){const _0x52c828=a35_0x52c8();return a35_0x5bce=function(_0x5bced8,_0x5116bf){_0x5bced8=_0x5bced8-0x106;let _0x282194=_0x52c828[_0x5bced8];return _0x282194;},a35_0x5bce(_0x215deb,_0x4d4509);}var __importDefault=this&&this[a35_0x445d8d(0x122)]||function(_0x536383){const _0x27e780=a35_0x445d8d;return _0x536383&&_0x536383[_0x27e780(0x14b)]?_0x536383:{'default':_0x536383};};function a35_0x52c8(){const _0x1e3778=['klyme_eu','üìä\x20Final\x20WHERE\x20conditions:','customerName','admin','mastercard','customerCountry','\x20\x20\x20Gateway:\x20','toFixed','failUrl','customerIp','count','telegram','\x20paid\x20payments\x20for\x20analysis','externalPaymentUrl','getGatewayDisplayName','log','error','turnoverUSDT','totalCommissionRate','date','successUrl','paymentsCount','\x20USDT\x20(with\x20commission\x20deducted)','setDate','noda','whiteUrl','summary','üí∏\x20CHARGEBACK:\x20Merchant\x20amount\x20already\x20deducted\x20from\x20balance','deletePayout','üìÖ\x20Period\x20\x27all\x27:\x20Using\x20start\x20date\x20from\x20first\x20payment:\x20','üìä\x20Merchants\x20awaiting\x20payout:\x20','random','\x20USDT\x20(after\x20payouts)','getAllPayments','custom','paidOutUSDT','turnover','üí∞\x20[PAYOUT]\x20Merchant\x20','getPayoutStats','__importDefault','year','\x20PAID\x20payments','151217YtKHtJ','push','amount','\x20active\x20merchants\x20for\x20selection','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','some','get','orderId','week','all','2020-01-01','\x20USDT\x20(+','30d','name','KLYME\x20GB','includes','entries','üìã\x20Getting\x20merchants\x20selection\x20list...','merchantUrl','‚ö†Ô∏è\x20Payment\x20','CHARGEBACK','üìã\x20Found\x20','customerUa','getMerchantsAwaitingPayout','findFirst','getGatewayNameById','\x20\x20\x20üí≥\x20Total\x20payments:\x20','\x20for\x20shop\x20','reduce','ACTIVE','currency','\x20\x20\x20Payout\x20amount:\x20','\x20order','password','Rapyd','\x20USDT\x20(gross\x20revenue)','defineProperty','generateDailyStatistics','__esModule','\x20USDT\x20from\x20balance','getGatewayIdByName','lte','payment','getMerchantsSelection','\x20USDT,\x20Requested:\x20','ceil','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','hex','periodFrom','üí∏\x20CHARGEBACK\x20penalty:\x20-','set','polygon','\x20merchants','awaitingPayout','getMerchantStatistics','delete','klyme_de','üéØ\x20[','stringify','failureMessage','../types/gateway','860145APQWGN','90d','length','üí∞\x20Found\x20','split','gatewayEarnings','values','toUpperCase','\x20\x20\x20üí∏\x20Total\x20payouts\x20(all\x20time):\x20',',\x20Commission:\x20','\x20\x20\x20Balance:\x20','findMany','üîÑ\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','5974028zSaZIc','../config/database','\x20in\x20','period','thisMonth','totalTurnover','\x20USDT\x20(theoretical\x20net)','gateway','commission','notes','desc','üí≥\x20Payout\x20wallet\x20for\x20','COMPLETED','telegramId','update','averageCheckUSDT','Plisio','\x20USDT\x20(without\x20commission)','üîÑ\x20Gateway\x20mapping:','6wBmTof','substr','wallets','adminNotes','\x20\x20\x20ÔøΩ\x20Total\x20payments\x20turnover:\x20','activateUser','\x20USDT\x20(after\x20','11442184TlTWpK','currencyService','randomBytes','dateTo','pendingUrl','plisio','üìÖ\x20Period:\x20','balance','5994438OwmtjH','\x20status:\x20','\x20\x20\x20üí∞\x20Total\x20payout:\x20','gatewaySettings','\x20\x20\x20üìä\x20Total\x20payments:\x20','username',']\x20Gateway\x20settings\x20JSON\x20string:','test_gateway','klyme_gb','createPayout','üí∞\x20Shop\x20','_sum','localeCompare','createdAt','findUnique','default','\x20->\x20','dateFrom','create','\x20\x20\x20Added\x20to\x20balance:\x20+','totalAmountUSDT','commissionUSDT','\x20\x20\x20üíµ\x20Available\x20balance:\x20','publicKey','bcryptjs','üîß\x20[','revenue','Payment\x20not\x20found','totalPayout',',\x20userId:\x20','./currencyService','\x20USDT\x20(total\x20paid\x20to\x20merchants)','üîÑ\x20Admin\x20updating\x20payment\x20','not\x20set','statusChangedBy','month','totalPaidOut','\x20\x20\x20‚úÖ\x20Total\x20available\x20for\x20payout:\x20','\x20\x20\x20üîç\x20Raw\x20balance\x20sum:\x20','shopId','6939081XSmFGg','üìä\x20Total\x20payments\x20(including\x20failed):\x20','sort','REFUND','\x20to\x20','getDate',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','7KPiiDm',']\x20Gateway\x20settings\x20before\x20saving:','usdtTrcWallet','fullName','PAID','\x20\x20\x20Transaction\x20hash:\x20','Open\x20Banking\x202','getFullYear','toLowerCase','getUserById','üìä\x20Available\x20gateways\x20in\x20database:','network','totalPayments','_count','crypto','AdminService','\x20USDT','paymentGateways','CoinToPay','\x20\x20\x20üìÖ\x20Total\x20payouts\x20(this\x20month):\x20',',\x20successful:\x20','cointopay','üéØ\x20updateUser\x20called\x20with\x20ID:\x20','getPaymentById','totalAmountAfterCommissionUSDT','usdtErcWallet','‚úÖ\x20Customer\x20data\x20updated\x20for\x20payment\x20','shopUrl','üìä\x20Merchant\x20statistics\x20calculated:','üí∞\x20Payment\x20','txid','getTime','\x20payments)','üìä\x20Getting\x20payments\x20with\x20filters:','updatedAt','insensitive','getAllPayouts','%\x20commission)','gte','üìä\x20Calculating\x20payout\x20statistics...','trc20','\x20\x20\x20üë§\x20Merchant\x20earnings:\x20','\x20\x20\x20Current\x20balance:\x20','\x20USDT\x20(-','\x20\x20\x20Full\x20amount:\x20','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','suspendUser','\x20\x20\x20üìä\x20Commission\x20difference:\x20','convertToUSDT','hash','shop','üí±\x20Currency\x20filter\x20applied:\x20','amountUSDT','\x20USDT\x20(','merchantEarningsUSDT','chargebackAmount','getMonth','rapyd','toString','customerEmail','\x20merchants\x20with\x20positive\x20balance','getPayoutById','üìä\x20Sorting\x20payments\x20by\x20','\x27\x20->\x20ID\x20\x27','pk_','üîÑ\x20Updating\x20customer\x20data\x20for\x20payment\x20','‚úÖ\x20Using\x20gateway\x20filter:\x20\x27','\x20\x20\x20Merchant\x20gets:\x20','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','gateways','KLYME\x20EU','aggregate','asc','toISOString','\x20\x20\x20üí∞\x20Total\x20turnover:\x20','\x27\x20to\x20name\x20\x27','forEach','round','usdtPolygonWallet','groupBy','\x20\x20\x20Total\x20paid\x20out:\x20','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','parse','status','\x20USDT\x20(same\x20as\x20awaiting)','merchantEarnings','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','\x20\x20\x20üîç\x20Calculated\x20after\x20commission:\x20','‚ö†Ô∏è\x20Gateway\x20\x27','usdcPolygonWallet','\x20USDT)','$transaction','paidAt','updateUser','6524040bXlbbU','NONEXISTENT_GATEWAY_FILTER','\x20\x20\x20üåç\x20Country:\x20','Noda','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','\x20no\x20longer\x20PAID:','averageCommissionRate','updatePaymentStatus','\x27\x20(from\x20\x27','getGatewayInternalName','map','payout'];a35_0x52c8=function(){return _0x1e3778;};return a35_0x52c8();}Object[a35_0x445d8d(0x149)](exports,a35_0x445d8d(0x14b),{'value':!![]}),exports[a35_0x445d8d(0x1d0)]=void 0x0;const database_1=__importDefault(require(a35_0x445d8d(0x171))),bcryptjs_1=__importDefault(require(a35_0x445d8d(0x1aa))),crypto_1=__importDefault(require(a35_0x445d8d(0x1cf))),currencyService_1=require(a35_0x445d8d(0x1b0)),gateway_1=require(a35_0x445d8d(0x161));class AdminService{async[a35_0x445d8d(0x121)](){const _0x4cded4=a35_0x445d8d;console[_0x4cded4(0x10a)](_0x4cded4(0x1e8));const _0x4c8e90=await database_1['default'][_0x4cded4(0x1f3)][_0x4cded4(0x208)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x4cded4(0x142)}}),_0x363ed3=await this[_0x4cded4(0x13c)]({'page':0x1,'limit':0x3e8}),_0x6b3218=await database_1[_0x4cded4(0x1a1)][_0x4cded4(0x14f)][_0x4cded4(0x235)]({'where':{'status':_0x4cded4(0x1c5),'gateway':{'not':_0x4cded4(0x199)}}}),_0x5dd748=new Date(),_0x255fe1=new Date(_0x5dd748[_0x4cded4(0x1c8)](),_0x5dd748[_0x4cded4(0x1f9)](),0x1),_0x15126e=new Date(_0x5dd748[_0x4cded4(0x1c8)](),_0x5dd748[_0x4cded4(0x1f9)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x27e4f2=await database_1[_0x4cded4(0x1a1)][_0x4cded4(0x22a)][_0x4cded4(0x208)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x255fe1,'lte':_0x15126e},'status':'COMPLETED'}}),_0xa5e0de=_0x4c8e90[_0x4cded4(0x19d)][_0x4cded4(0x1b6)]||0x0,_0x595940=_0x363ed3[_0x4cded4(0x115)][_0x4cded4(0x1d9)],_0x37a4d9=_0x27e4f2[_0x4cded4(0x19d)][_0x4cded4(0x127)]||0x0,_0x41757d={'totalPayout':Math[_0x4cded4(0x20e)](_0xa5e0de*0x64)/0x64,'awaitingPayout':Math['round'](_0x595940*0x64)/0x64,'thisMonth':Math[_0x4cded4(0x20e)](_0x37a4d9*0x64)/0x64,'availableBalance':Math[_0x4cded4(0x20e)](_0x595940*0x64)/0x64,'totalPayments':_0x6b3218};return console[_0x4cded4(0x10a)]('üìä\x20Payout\x20statistics\x20calculated:'),console['log'](_0x4cded4(0x194)+_0x41757d[_0x4cded4(0x1ae)]+_0x4cded4(0x1b1)),console[_0x4cded4(0x10a)](_0x4cded4(0x223)+_0x41757d[_0x4cded4(0x15a)]+_0x4cded4(0x111)),console['log'](_0x4cded4(0x1a8)+_0x41757d['availableBalance']+_0x4cded4(0x215)),console[_0x4cded4(0x10a)]('\x20\x20\x20üìÖ\x20This\x20month:\x20'+_0x41757d[_0x4cded4(0x174)]+'\x20USDT'),console[_0x4cded4(0x10a)](_0x4cded4(0x13f)+_0x41757d['totalPayments']+_0x4cded4(0x124)),console[_0x4cded4(0x10a)](_0x4cded4(0x1b8)+(_0x4c8e90[_0x4cded4(0x19d)][_0x4cded4(0x191)]||0x0)['toFixed'](0x2)+_0x4cded4(0x181)),console[_0x4cded4(0x10a)](_0x4cded4(0x1f0)+((_0x4c8e90[_0x4cded4(0x19d)][_0x4cded4(0x191)]||0x0)-_0x595940)['toFixed'](0x2)+_0x4cded4(0x1d1)),_0x41757d;}async['updateCustomerData'](_0x3c89fb,_0xe8bb65){const _0x568fcf=a35_0x445d8d;console[_0x568fcf(0x10a)](_0x568fcf(0x202)+_0x3c89fb+':',_0xe8bb65);const _0x3490ab=await database_1[_0x568fcf(0x1a1)][_0x568fcf(0x14f)]['findUnique']({'where':{'id':_0x3c89fb},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x3490ab)throw new Error(_0x568fcf(0x1ad));const _0x277d81={};_0xe8bb65['customerCountry']!==undefined&&(_0x277d81['customerCountry']=_0xe8bb65[_0x568fcf(0x230)]||null);_0xe8bb65[_0x568fcf(0x234)]!==undefined&&(_0x277d81[_0x568fcf(0x234)]=_0xe8bb65[_0x568fcf(0x234)]||null);_0xe8bb65['customerUa']!==undefined&&(_0x277d81[_0x568fcf(0x13b)]=_0xe8bb65[_0x568fcf(0x13b)]||null);const _0x3a7ac3=await database_1['default']['payment'][_0x568fcf(0x17e)]({'where':{'id':_0x3c89fb},'data':{..._0x277d81,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x568fcf(0x10a)](_0x568fcf(0x1db)+_0x3c89fb),console[_0x568fcf(0x10a)](_0x568fcf(0x221)+_0x3490ab[_0x568fcf(0x230)]+_0x568fcf(0x1a2)+_0x3a7ac3[_0x568fcf(0x230)]),console[_0x568fcf(0x10a)]('\x20\x20\x20üåê\x20IP:\x20'+_0x3490ab[_0x568fcf(0x234)]+'\x20->\x20'+_0x3a7ac3[_0x568fcf(0x234)]),console['log']('\x20\x20\x20üñ•Ô∏è\x20User\x20Agent:\x20'+(_0x3490ab[_0x568fcf(0x13b)]?_0x568fcf(0x157):_0x568fcf(0x1b3))+_0x568fcf(0x1a2)+(_0x3a7ac3[_0x568fcf(0x13b)]?_0x568fcf(0x157):_0x568fcf(0x1b3))),_0x3a7ac3;}async['getSystemStatistics'](_0x34b958){const _0x55bffc=a35_0x445d8d,_0x20413f=new Date();let _0x200aea;switch(_0x34b958){case'7d':_0x200aea=new Date(_0x20413f[_0x55bffc(0x1e0)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x55bffc(0x131):_0x200aea=new Date(_0x20413f[_0x55bffc(0x1e0)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x55bffc(0x163):_0x200aea=new Date(_0x20413f[_0x55bffc(0x1e0)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x55bffc(0x12e):const _0x36557c=await database_1[_0x55bffc(0x1a1)][_0x55bffc(0x14f)][_0x55bffc(0x13d)]({'where':{'gateway':{'not':_0x55bffc(0x199)}},'orderBy':{'createdAt':'asc'},'select':{'createdAt':!![]}});_0x200aea=_0x36557c?_0x36557c['createdAt']:new Date(_0x55bffc(0x12f)),console[_0x55bffc(0x10a)](_0x55bffc(0x118)+_0x200aea[_0x55bffc(0x20a)]());break;default:_0x200aea=new Date(_0x20413f[_0x55bffc(0x1e0)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x5bf655,_0x4aaea1,_0x42f6b6,_0x51ebee,_0xb249f,_0x5e426f,_0x2a9578]=await Promise['all']([database_1[_0x55bffc(0x1a1)][_0x55bffc(0x1f3)][_0x55bffc(0x235)](),database_1['default'][_0x55bffc(0x1f3)][_0x55bffc(0x235)]({'where':{'status':_0x55bffc(0x142)}}),database_1[_0x55bffc(0x1a1)][_0x55bffc(0x14f)][_0x55bffc(0x235)]({'where':{'createdAt':{'gte':_0x200aea},'gateway':{'not':_0x55bffc(0x199)}}}),database_1[_0x55bffc(0x1a1)][_0x55bffc(0x14f)]['count']({'where':{'status':'PAID','createdAt':{'gte':_0x200aea},'gateway':{'not':_0x55bffc(0x199)}}}),database_1[_0x55bffc(0x1a1)][_0x55bffc(0x14f)][_0x55bffc(0x16d)]({'where':{'status':'PAID','createdAt':{'gte':_0x200aea},'gateway':{'not':_0x55bffc(0x199)}},'select':{'amount':!![],'currency':!![]}}),database_1[_0x55bffc(0x1a1)][_0x55bffc(0x14f)]['findMany']({'where':{'gateway':{'not':'test_gateway'}},'take':0xa,'orderBy':{'createdAt':_0x55bffc(0x17a)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x55bffc(0x1a1)][_0x55bffc(0x14f)]['findMany']({'where':{'createdAt':{'gte':_0x200aea},'gateway':{'not':_0x55bffc(0x199)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x2d5011=0x0;for(const _0x450641 of _0xb249f){const _0x1761d8=await currencyService_1[_0x55bffc(0x18b)][_0x55bffc(0x1f1)](_0x450641[_0x55bffc(0x127)],_0x450641[_0x55bffc(0x143)]);_0x2d5011+=_0x1761d8;}const _0x4f8773=this[_0x55bffc(0x14a)](_0x2a9578,_0x200aea,_0x20413f),_0x1d3e8a=_0x42f6b6>0x0?_0x51ebee/_0x42f6b6*0x64:0x0;return{'totalShops':_0x5bf655,'activeShops':_0x4aaea1,'totalPayments':_0x42f6b6,'successfulPayments':_0x51ebee,'totalRevenue':Math[_0x55bffc(0x20e)](_0x2d5011*0x64)/0x64,'conversionRate':Math['round'](_0x1d3e8a*0x64)/0x64,'dailyRevenue':_0x4f8773['dailyRevenue'],'dailyPayments':_0x4f8773['dailyPayments'],'recentPayments':_0x5e426f[_0x55bffc(0x229)](_0x16618a=>({'id':_0x16618a['id'],'amount':_0x16618a[_0x55bffc(0x127)],'currency':_0x16618a['currency'],'status':_0x16618a[_0x55bffc(0x214)],'gateway':_0x16618a[_0x55bffc(0x177)],'shop':_0x16618a[_0x55bffc(0x1f3)],'createdAt':_0x16618a[_0x55bffc(0x19f)]}))};}async[a35_0x445d8d(0x15b)](_0x2fb4c7){const _0x2f641f=a35_0x445d8d;console[_0x2f641f(0x10a)]('üìä\x20Getting\x20merchant\x20statistics\x20with\x20filters:',_0x2fb4c7);let _0x4ccfad,_0x2780f3=new Date();if(_0x2fb4c7[_0x2f641f(0x173)]===_0x2f641f(0x11d)&&_0x2fb4c7['dateFrom']&&_0x2fb4c7[_0x2f641f(0x18d)])_0x4ccfad=new Date(_0x2fb4c7[_0x2f641f(0x1a3)]),_0x2780f3=new Date(_0x2fb4c7[_0x2f641f(0x18d)]);else{const _0x32aaea=new Date();switch(_0x2fb4c7[_0x2f641f(0x173)]){case _0x2f641f(0x12d):_0x4ccfad=new Date(_0x32aaea[_0x2f641f(0x1e0)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x2f641f(0x1b5):_0x4ccfad=new Date(_0x32aaea[_0x2f641f(0x1e0)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x2f641f(0x123):_0x4ccfad=new Date(_0x32aaea['getTime']()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x2f641f(0x12e):default:_0x4ccfad=new Date('2020-01-01');break;}}console[_0x2f641f(0x10a)](_0x2f641f(0x190)+_0x4ccfad['toISOString']()+_0x2f641f(0x1be)+_0x2780f3[_0x2f641f(0x20a)]());const _0x46f9f0={'status':'PAID','gateway':{'not':_0x2f641f(0x199)},'paidAt':{'gte':_0x4ccfad,'lte':_0x2780f3}};_0x2fb4c7['shopId']&&(_0x46f9f0[_0x2f641f(0x1b9)]=_0x2fb4c7[_0x2f641f(0x1b9)]);const _0x138e7a=await database_1[_0x2f641f(0x1a1)]['payment'][_0x2f641f(0x16d)]({'where':_0x46f9f0,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x2f641f(0x10a)](_0x2f641f(0x165)+_0x138e7a['length']+_0x2f641f(0x107));const _0x3b1942={'gateway':{'not':_0x2f641f(0x199)},'createdAt':{'gte':_0x4ccfad,'lte':_0x2780f3}};_0x2fb4c7[_0x2f641f(0x1b9)]&&(_0x3b1942[_0x2f641f(0x1b9)]=_0x2fb4c7['shopId']);const _0xdd74c5=await database_1['default']['payment'][_0x2f641f(0x235)]({'where':_0x3b1942});console[_0x2f641f(0x10a)](_0x2f641f(0x1bb)+_0xdd74c5+_0x2f641f(0x1d5)+_0x138e7a[_0x2f641f(0x164)]);let _0x56d59a=0x0,_0x22ca43=0x0,_0x4f7911=0x0;const _0x31fc64={},_0x325827={},_0x456d59={};for(const _0x3e48ae of _0x138e7a){try{const _0x244485=await currencyService_1[_0x2f641f(0x18b)][_0x2f641f(0x1f1)](_0x3e48ae[_0x2f641f(0x127)],_0x3e48ae[_0x2f641f(0x143)]);let _0xdc72b4={};if(_0x3e48ae[_0x2f641f(0x1f3)][_0x2f641f(0x195)])try{_0xdc72b4=JSON['parse'](_0x3e48ae[_0x2f641f(0x1f3)][_0x2f641f(0x195)]);}catch(_0x21c29b){console[_0x2f641f(0x10b)](_0x2f641f(0x153)+_0x3e48ae[_0x2f641f(0x1b9)]+':',_0x21c29b);}let _0x44bf5b={},_0x8c51b8=0xa;for(const [_0x21f6c7,_0x3c6c2f]of Object['entries'](_0xdc72b4)){if(_0x21f6c7[_0x2f641f(0x1c9)]()===_0x3e48ae[_0x2f641f(0x177)][_0x2f641f(0x1c9)]()){_0x44bf5b=_0x3c6c2f,_0x8c51b8=_0x3c6c2f[_0x2f641f(0x178)]||0xa;break;}}const _0x3a17a3=_0x244485*(_0x8c51b8/0x64),_0x52ecf8=_0x244485-_0x3a17a3;_0x56d59a+=_0x244485,_0x22ca43+=_0x52ecf8,_0x4f7911+=_0x3a17a3;!_0x31fc64[_0x3e48ae[_0x2f641f(0x177)]]&&(_0x31fc64[_0x3e48ae[_0x2f641f(0x177)]]={'gateway':_0x3e48ae['gateway'],'gatewayDisplayName':this['getGatewayDisplayName'](_0x3e48ae[_0x2f641f(0x177)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x31fc64[_0x3e48ae['gateway']][_0x2f641f(0x110)]++,_0x31fc64[_0x3e48ae[_0x2f641f(0x177)]]['turnoverUSDT']+=_0x244485,_0x31fc64[_0x3e48ae[_0x2f641f(0x177)]][_0x2f641f(0x1a7)]+=_0x3a17a3,_0x31fc64[_0x3e48ae[_0x2f641f(0x177)]]['merchantEarningsUSDT']+=_0x52ecf8,_0x31fc64[_0x3e48ae[_0x2f641f(0x177)]]['totalCommissionRate']+=_0x8c51b8;!_0x2fb4c7['shopId']&&(!_0x325827[_0x3e48ae[_0x2f641f(0x1b9)]]&&(_0x325827[_0x3e48ae['shopId']]={'shopId':_0x3e48ae['shopId'],'shopName':_0x3e48ae['shop'][_0x2f641f(0x132)],'shopUsername':_0x3e48ae[_0x2f641f(0x1f3)][_0x2f641f(0x197)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x325827[_0x3e48ae[_0x2f641f(0x1b9)]][_0x2f641f(0x110)]++,_0x325827[_0x3e48ae[_0x2f641f(0x1b9)]][_0x2f641f(0x10c)]+=_0x244485,_0x325827[_0x3e48ae[_0x2f641f(0x1b9)]][_0x2f641f(0x1a7)]+=_0x3a17a3,_0x325827[_0x3e48ae[_0x2f641f(0x1b9)]][_0x2f641f(0x1f7)]+=_0x52ecf8);const _0xb68305=_0x3e48ae['paidAt']['toISOString']()[_0x2f641f(0x166)]('T')[0x0];!_0x456d59[_0xb68305]&&(_0x456d59[_0xb68305]={'date':_0xb68305,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x456d59[_0xb68305][_0x2f641f(0x11f)]+=_0x244485,_0x456d59[_0xb68305][_0x2f641f(0x216)]+=_0x52ecf8,_0x456d59[_0xb68305]['gatewayEarnings']+=_0x3a17a3,_0x456d59[_0xb68305][_0x2f641f(0x110)]++;}catch(_0x55e6d1){console['error']('Error\x20processing\x20payment\x20'+_0x3e48ae['id']+':',_0x55e6d1);}}Object[_0x2f641f(0x168)](_0x31fc64)[_0x2f641f(0x20d)](_0x380dff=>{const _0x478219=_0x2f641f;_0x380dff['averageCommissionRate']=_0x380dff[_0x478219(0x110)]>0x0?_0x380dff[_0x478219(0x10d)]/_0x380dff[_0x478219(0x110)]:0x0,delete _0x380dff[_0x478219(0x10d)];}),Object['values'](_0x325827)[_0x2f641f(0x20d)](_0x89168a=>{const _0x433d69=_0x2f641f;_0x89168a[_0x433d69(0x17f)]=_0x89168a[_0x433d69(0x110)]>0x0?_0x89168a[_0x433d69(0x10c)]/_0x89168a['paymentsCount']:0x0;});let _0x41b794=0x0;if(_0x2fb4c7[_0x2f641f(0x1b9)]){const _0x1e426c=await database_1[_0x2f641f(0x1a1)][_0x2f641f(0x22a)]['findMany']({'where':{'shopId':_0x2fb4c7[_0x2f641f(0x1b9)],'status':_0x2f641f(0x17c),'createdAt':{'gte':_0x4ccfad,'lte':_0x2780f3}},'select':{'amount':!![]}});_0x41b794=_0x1e426c['reduce']((_0x289f75,_0x17c001)=>_0x289f75+_0x17c001[_0x2f641f(0x127)],0x0);}const _0x32d425=_0xdd74c5,_0x2cadcf=_0x138e7a[_0x2f641f(0x164)],_0x4f81f1=_0x2cadcf>0x0?_0x56d59a/_0x2cadcf:0x0,_0x52b6e5=_0x32d425>0x0?Math['round'](_0x2cadcf/_0x32d425*0x2710)/0x64:0x0,_0x144ea1=Math['ceil']((_0x2780f3[_0x2f641f(0x1e0)]()-_0x4ccfad[_0x2f641f(0x1e0)]())/(0x3e8*0x3c*0x3c*0x18)),_0x10929e={'totalTurnover':Math[_0x2f641f(0x20e)](_0x56d59a*0x64)/0x64,'merchantEarnings':Math[_0x2f641f(0x20e)](_0x22ca43*0x64)/0x64,'gatewayEarnings':Math[_0x2f641f(0x20e)](_0x4f7911*0x64)/0x64,'totalPaidOut':Math['round'](_0x41b794*0x64)/0x64,'averageCheck':Math[_0x2f641f(0x20e)](_0x4f81f1*0x64)/0x64,'totalPayments':_0x32d425,'successfulPayments':_0x2cadcf,'conversionRate':_0x52b6e5,'gatewayBreakdown':Object['values'](_0x31fc64)['map'](_0x389522=>({..._0x389522,'turnoverUSDT':Math[_0x2f641f(0x20e)](_0x389522[_0x2f641f(0x10c)]*0x64)/0x64,'commissionUSDT':Math[_0x2f641f(0x20e)](_0x389522['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x2f641f(0x20e)](_0x389522['merchantEarningsUSDT']*0x64)/0x64,'averageCommissionRate':Math[_0x2f641f(0x20e)](_0x389522[_0x2f641f(0x225)]*0x64)/0x64})),'merchantBreakdown':_0x2fb4c7[_0x2f641f(0x1b9)]?undefined:Object['values'](_0x325827)['map'](_0x2120ab=>({..._0x2120ab,'turnoverUSDT':Math['round'](_0x2120ab['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x2f641f(0x20e)](_0x2120ab[_0x2f641f(0x1a7)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x2f641f(0x20e)](_0x2120ab[_0x2f641f(0x1f7)]*0x64)/0x64,'paidOutUSDT':Math['round'](_0x2120ab[_0x2f641f(0x11e)]*0x64)/0x64,'averageCheckUSDT':Math[_0x2f641f(0x20e)](_0x2120ab[_0x2f641f(0x17f)]*0x64)/0x64})),'dailyData':Object[_0x2f641f(0x168)](_0x456d59)['map'](_0x1aa374=>({..._0x1aa374,'turnover':Math[_0x2f641f(0x20e)](_0x1aa374[_0x2f641f(0x11f)]*0x64)/0x64,'merchantEarnings':Math[_0x2f641f(0x20e)](_0x1aa374[_0x2f641f(0x216)]*0x64)/0x64,'gatewayEarnings':Math['round'](_0x1aa374[_0x2f641f(0x167)]*0x64)/0x64}))[_0x2f641f(0x1bc)]((_0x2fc7d5,_0x102d69)=>_0x2fc7d5['date'][_0x2f641f(0x19e)](_0x102d69[_0x2f641f(0x10e)])),'periodInfo':{'from':_0x4ccfad,'to':_0x2780f3,'periodType':_0x2fb4c7[_0x2f641f(0x173)]||_0x2f641f(0x11d),'daysCount':_0x144ea1}};return console['log'](_0x2f641f(0x1dd)),console['log'](_0x2f641f(0x20b)+_0x10929e[_0x2f641f(0x175)]+_0x2f641f(0x1d1)),console[_0x2f641f(0x10a)](_0x2f641f(0x1ea)+_0x10929e[_0x2f641f(0x216)]+_0x2f641f(0x1d1)),console[_0x2f641f(0x10a)]('\x20\x20\x20üè™\x20Gateway\x20earnings:\x20'+_0x10929e['gatewayEarnings']+_0x2f641f(0x1d1)),console['log'](_0x2f641f(0x196)+_0x10929e[_0x2f641f(0x1cd)]),_0x10929e;}async[a35_0x445d8d(0x150)](){const _0x452e1f=a35_0x445d8d;console[_0x452e1f(0x10a)](_0x452e1f(0x136));const _0x41d4a9=await database_1[_0x452e1f(0x1a1)][_0x452e1f(0x1f3)][_0x452e1f(0x16d)]({'where':{'status':'ACTIVE'},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x452e1f(0x209)}});return console[_0x452e1f(0x10a)](_0x452e1f(0x13a)+_0x41d4a9[_0x452e1f(0x164)]+_0x452e1f(0x128)),_0x41d4a9['map'](_0x13e539=>({'id':_0x13e539['id'],'username':_0x13e539[_0x452e1f(0x197)],'name':_0x13e539[_0x452e1f(0x132)]}));}[a35_0x445d8d(0x109)](_0x2ae637){const _0x2dae98=a35_0x445d8d,_0x2628e2={'test_gateway':'Test\x20Gateway','plisio':_0x2dae98(0x180),'rapyd':_0x2dae98(0x147),'noda':_0x2dae98(0x222),'cointopay':_0x2dae98(0x1d3),'cointopay2':_0x2dae98(0x1c7),'klyme_eu':_0x2dae98(0x207),'klyme_gb':_0x2dae98(0x133),'klyme_de':'KLYME\x20DE','mastercard':'MasterCard'};return _0x2628e2[_0x2ae637]||_0x2ae637;}['getGatewayInternalName'](_0x26e4a8){const _0x3c55ec=a35_0x445d8d,_0x518d47={'Test\x20Gateway':_0x3c55ec(0x199),'Plisio':_0x3c55ec(0x18f),'Rapyd':_0x3c55ec(0x1fa),'Noda':_0x3c55ec(0x113),'CoinToPay':_0x3c55ec(0x1d6),'CoinToPay2':'cointopay2','KLYME\x20EU':_0x3c55ec(0x22b),'KLYME\x20GB':_0x3c55ec(0x19a),'KLYME\x20DE':_0x3c55ec(0x15d),'MasterCard':_0x3c55ec(0x22f)};return _0x518d47[_0x26e4a8]||_0x26e4a8[_0x3c55ec(0x1c9)]();}async[a35_0x445d8d(0x13c)](_0xd03bfc){const _0x446d89=a35_0x445d8d,{page:_0xd8e942,limit:_0x50c4f7,minAmount:_0x3eafce,search:_0x9f1761}=_0xd03bfc,_0x2d2278=(_0xd8e942-0x1)*_0x50c4f7;console[_0x446d89(0x10a)]('üìä\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:',_0xd03bfc);const _0x124996={'balance':{'gt':0x0},'status':_0x446d89(0x142)};_0x3eafce&&(_0x124996[_0x446d89(0x191)]['gte']=_0x3eafce);_0x9f1761&&(_0x124996['OR']=[{'name':{'contains':_0x9f1761,'mode':_0x446d89(0x1e4)}},{'username':{'contains':_0x9f1761,'mode':_0x446d89(0x1e4)}}]);const [_0xb5031b,_0x2241f1]=await Promise[_0x446d89(0x12e)]([database_1[_0x446d89(0x1a1)]['shop'][_0x446d89(0x16d)]({'where':_0x124996,'skip':_0x2d2278,'take':_0x50c4f7,'orderBy':{'balance':_0x446d89(0x17a)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1[_0x446d89(0x1a1)][_0x446d89(0x1f3)][_0x446d89(0x235)]({'where':_0x124996})]);console[_0x446d89(0x10a)]('üí∞\x20Found\x20'+_0xb5031b[_0x446d89(0x164)]+_0x446d89(0x1fd));const _0x4def70=await Promise['all'](_0xb5031b[_0x446d89(0x229)](async _0x564b23=>{const _0x38d74c=_0x446d89,[_0x576e45,_0x405c0e,_0x5609c1]=await Promise[_0x38d74c(0x12e)]([database_1[_0x38d74c(0x1a1)][_0x38d74c(0x14f)][_0x38d74c(0x235)]({'where':{'shopId':_0x564b23['id'],'status':_0x38d74c(0x1c5),'gateway':{'not':_0x38d74c(0x199)}}}),database_1[_0x38d74c(0x1a1)]['payment']['findFirst']({'where':{'shopId':_0x564b23['id'],'status':_0x38d74c(0x1c5),'gateway':{'not':_0x38d74c(0x199)}},'orderBy':{'paidAt':_0x38d74c(0x209)},'select':{'paidAt':!![]}}),database_1['default']['payment'][_0x38d74c(0x210)]({'by':['gateway'],'where':{'shopId':_0x564b23['id'],'status':_0x38d74c(0x1c5),'gateway':{'not':_0x38d74c(0x199)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x3d0c3d=new Date(),_0x3ec805=new Date(_0x3d0c3d[_0x38d74c(0x1c8)](),_0x3d0c3d['getMonth'](),0x1),_0x5540ea=new Date(_0x3d0c3d['getFullYear'](),_0x3d0c3d[_0x38d74c(0x1f9)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x3dac35,_0x5345f8]=await Promise[_0x38d74c(0x12e)]([database_1[_0x38d74c(0x1a1)][_0x38d74c(0x22a)]['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x564b23['id'],'status':_0x38d74c(0x17c)}}),database_1[_0x38d74c(0x1a1)][_0x38d74c(0x22a)][_0x38d74c(0x208)]({'_sum':{'amount':!![]},'where':{'shopId':_0x564b23['id'],'status':'COMPLETED','createdAt':{'gte':_0x3ec805,'lte':_0x5540ea}}})]),_0x4259dd=_0x3dac35[_0x38d74c(0x19d)]['amount']||0x0,_0x19da54=_0x5345f8[_0x38d74c(0x19d)][_0x38d74c(0x127)]||0x0,_0x56ff2c=await Promise[_0x38d74c(0x12e)](_0x5609c1[_0x38d74c(0x229)](async _0x5e1560=>{const _0x54fb0f=_0x38d74c;let _0x3392d9=0xa;if(_0x564b23[_0x54fb0f(0x195)])try{const _0x55d92d=JSON[_0x54fb0f(0x213)](_0x564b23['gatewaySettings']);for(const [_0x7f3c91,_0x5da0ab]of Object[_0x54fb0f(0x135)](_0x55d92d)){if(_0x7f3c91[_0x54fb0f(0x1c9)]()===_0x5e1560[_0x54fb0f(0x177)][_0x54fb0f(0x1c9)]()){_0x3392d9=_0x5da0ab[_0x54fb0f(0x178)]||0xa,console[_0x54fb0f(0x10a)]('üí∞\x20[PAYOUT]\x20Gateway\x20'+_0x5e1560[_0x54fb0f(0x177)]+_0x54fb0f(0x140)+_0x564b23['id']+':\x20commission\x20=\x20'+_0x3392d9+'%');break;}}}catch(_0x4f5332){console[_0x54fb0f(0x10b)](_0x54fb0f(0x153)+_0x564b23['id']+':',_0x4f5332);}const _0x1d9108=_0x5e1560[_0x54fb0f(0x19d)]['amountUSDT']||0x0,_0x41cd61=_0x1d9108*(0x1-_0x3392d9/0x64);return{'gateway':_0x5e1560[_0x54fb0f(0x177)],'count':_0x5e1560['_count']['id'],'amountUSDT':Math['round'](_0x1d9108*0x64)/0x64,'amountAfterCommissionUSDT':Math['round'](_0x41cd61*0x64)/0x64,'commission':_0x3392d9};})),_0x17652d=_0x56ff2c[_0x38d74c(0x141)]((_0x3863d4,_0x433c14)=>_0x3863d4+_0x433c14[_0x38d74c(0x1f5)],0x0),_0x5e539d=_0x564b23[_0x38d74c(0x191)];return console[_0x38d74c(0x10a)](_0x38d74c(0x120)+_0x564b23['username']+':'),console['log'](_0x38d74c(0x187)+_0x17652d[_0x38d74c(0x232)](0x2)+_0x38d74c(0x148)),console[_0x38d74c(0x10a)](_0x38d74c(0x218)+_0x56ff2c['reduce']((_0x6f8fb,_0x19acb2)=>_0x6f8fb+_0x19acb2['amountAfterCommissionUSDT'],0x0)[_0x38d74c(0x232)](0x2)+_0x38d74c(0x176)),console[_0x38d74c(0x10a)]('\x20\x20\x20‚úÖ\x20Actual\x20available\x20balance:\x20'+_0x5e539d[_0x38d74c(0x232)](0x2)+_0x38d74c(0x11b)),{'id':_0x564b23['id'],'fullName':_0x564b23[_0x38d74c(0x132)],'username':_0x564b23[_0x38d74c(0x197)],'telegramId':_0x564b23[_0x38d74c(0x106)],'merchantUrl':_0x564b23[_0x38d74c(0x1dc)],'wallets':{'usdtPolygonWallet':_0x564b23[_0x38d74c(0x20f)],'usdtTrcWallet':_0x564b23[_0x38d74c(0x1c3)],'usdtErcWallet':_0x564b23[_0x38d74c(0x1da)],'usdcPolygonWallet':_0x564b23[_0x38d74c(0x21a)]},'totalAmountUSDT':Math['round'](_0x17652d*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x38d74c(0x20e)](_0x5e539d*0x64)/0x64,'totalPayout':Math[_0x38d74c(0x20e)](_0x4259dd*0x64)/0x64,'thisMonth':Math['round'](_0x19da54*0x64)/0x64,'paymentsCount':_0x576e45,'oldestPaymentDate':_0x405c0e?.['paidAt']||_0x564b23[_0x38d74c(0x19f)],'gatewayBreakdown':_0x56ff2c};})),_0x3db031=_0x4def70[_0x446d89(0x141)]((_0x5a081f,_0x234635)=>_0x5a081f+_0x234635[_0x446d89(0x1a6)],0x0),_0x1cdce3=_0x4def70[_0x446d89(0x141)]((_0xa0a0b8,_0x4bd908)=>_0xa0a0b8+_0x4bd908[_0x446d89(0x1d9)],0x0),_0x288de0=_0x4def70[_0x446d89(0x141)]((_0x243cf6,_0x44e19a)=>_0x243cf6+_0x44e19a[_0x446d89(0x1ae)],0x0),_0x43b974=_0x4def70[_0x446d89(0x141)]((_0x282b34,_0x2c11f4)=>_0x282b34+_0x2c11f4[_0x446d89(0x174)],0x0);return console[_0x446d89(0x10a)](_0x446d89(0x119)+_0x2241f1+_0x446d89(0x159)),console['log']('\x20\x20\x20üí∞\x20Total\x20payments\x20turnover:\x20'+Math['round'](_0x3db031*0x64)/0x64+'\x20USDT\x20(gross\x20revenue)'),console[_0x446d89(0x10a)](_0x446d89(0x1b7)+Math['round'](_0x1cdce3*0x64)/0x64+'\x20USDT\x20(actual\x20balances)'),console[_0x446d89(0x10a)](_0x446d89(0x16a)+Math[_0x446d89(0x20e)](_0x288de0*0x64)/0x64+_0x446d89(0x1d1)),console[_0x446d89(0x10a)](_0x446d89(0x1d4)+Math[_0x446d89(0x20e)](_0x43b974*0x64)/0x64+'\x20USDT'),{'merchants':_0x4def70,'pagination':{'page':_0xd8e942,'limit':_0x50c4f7,'total':_0x2241f1,'totalPages':Math[_0x446d89(0x152)](_0x2241f1/_0x50c4f7)},'summary':{'totalMerchants':_0x2241f1,'totalAmountUSDT':Math[_0x446d89(0x20e)](_0x3db031*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x446d89(0x20e)](_0x1cdce3*0x64)/0x64,'totalPayout':Math[_0x446d89(0x20e)](_0x288de0*0x64)/0x64,'thisMonth':Math[_0x446d89(0x20e)](_0x43b974*0x64)/0x64}};}async[a35_0x445d8d(0x19b)](_0x1ea54d){const _0x434282=a35_0x445d8d,{shopId:_0x3b2460,amount:_0x4855c3,network:_0x550897,wallet:_0x169300,notes:_0x5c3886,txid:_0xa3b7f9,periodFrom:_0x51b39b,periodTo:_0x534202}=_0x1ea54d,_0x2c115b=await database_1[_0x434282(0x1a1)][_0x434282(0x21c)](async _0x59a229=>{const _0x485958=_0x434282,_0xd2c7b1=await _0x59a229['shop'][_0x485958(0x1a0)]({'where':{'id':_0x3b2460},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0xd2c7b1)throw new Error('Shop\x20not\x20found');console[_0x485958(0x10a)]('üí∞\x20Creating\x20payout\x20for\x20shop\x20'+_0xd2c7b1[_0x485958(0x197)]+':'),console['log'](_0x485958(0x1eb)+_0xd2c7b1[_0x485958(0x191)][_0x485958(0x232)](0x6)+_0x485958(0x1d1)),console[_0x485958(0x10a)](_0x485958(0x144)+_0x4855c3['toFixed'](0x6)+_0x485958(0x1d1)),console['log'](_0x485958(0x217)+_0xd2c7b1['totalPaidOut'][_0x485958(0x232)](0x6)+_0x485958(0x1d1));if(_0xa3b7f9)console[_0x485958(0x10a)](_0x485958(0x1c6)+_0xa3b7f9);if(_0xd2c7b1['balance']<_0x4855c3)throw new Error('Insufficient\x20balance.\x20Available:\x20'+_0xd2c7b1[_0x485958(0x191)][_0x485958(0x232)](0x6)+_0x485958(0x151)+_0x4855c3[_0x485958(0x232)](0x6)+_0x485958(0x1d1));let _0xdb4fd6=_0x169300;if(!_0xdb4fd6){const _0x4a1770=await _0x59a229['shop']['findUnique']({'where':{'id':_0x3b2460},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x4a1770)switch(_0x550897){case _0x485958(0x158):_0xdb4fd6=_0x4a1770[_0x485958(0x20f)]||undefined;break;case _0x485958(0x1e9):_0xdb4fd6=_0x4a1770['usdtTrcWallet']||undefined;break;case'erc20':_0xdb4fd6=_0x4a1770[_0x485958(0x1da)]||undefined;break;case'polygon_usdc':_0xdb4fd6=_0x4a1770[_0x485958(0x21a)]||undefined;break;}}console[_0x485958(0x10a)](_0x485958(0x17b)+_0x550897+':\x20'+(_0xdb4fd6||'not\x20specified'));const _0x5fe066=await _0x59a229['payout'][_0x485958(0x1a4)]({'data':{'shopId':_0x3b2460,'amount':_0x4855c3,'network':_0x550897,'status':_0x485958(0x17c),'txid':_0xa3b7f9,'notes':_0x5c3886,'periodFrom':_0x51b39b?new Date(_0x51b39b):null,'periodTo':_0x534202?new Date(_0x534202):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x4ab2b4=_0xd2c7b1['balance']-_0x4855c3,_0x9914c0=_0xd2c7b1[_0x485958(0x1b6)]+_0x4855c3;return await _0x59a229[_0x485958(0x1f3)][_0x485958(0x17e)]({'where':{'id':_0x3b2460},'data':{'balance':_0x4ab2b4,'totalPaidOut':_0x9914c0}}),console['log']('üí∞\x20Shop\x20'+_0xd2c7b1[_0x485958(0x197)]+'\x20balance\x20updated:'),console[_0x485958(0x10a)](_0x485958(0x16c)+_0xd2c7b1[_0x485958(0x191)][_0x485958(0x232)](0x6)+_0x485958(0x1a2)+_0x4ab2b4['toFixed'](0x6)+_0x485958(0x1ec)+_0x4855c3[_0x485958(0x232)](0x6)+')'),console[_0x485958(0x10a)](_0x485958(0x211)+_0xd2c7b1[_0x485958(0x1b6)]['toFixed'](0x6)+'\x20->\x20'+_0x9914c0[_0x485958(0x232)](0x6)+_0x485958(0x130)+_0x4855c3['toFixed'](0x6)+')'),{'payout':_0x5fe066,'shop':_0xd2c7b1};});return console[_0x434282(0x10a)]('‚úÖ\x20Payout\x20created:\x20'+_0x2c115b[_0x434282(0x22a)]['id']+_0x434282(0x140)+_0x2c115b['shop'][_0x434282(0x197)]+'\x20('+_0x4855c3+_0x434282(0x21b)),{'id':_0x2c115b['payout']['id'],'shopId':_0x2c115b[_0x434282(0x22a)][_0x434282(0x1b9)],'shopName':_0x2c115b[_0x434282(0x1f3)][_0x434282(0x132)],'shopUsername':_0x2c115b[_0x434282(0x1f3)]['username'],'amount':_0x2c115b[_0x434282(0x22a)][_0x434282(0x127)],'network':_0x2c115b[_0x434282(0x22a)][_0x434282(0x1cc)],'status':_0x2c115b[_0x434282(0x22a)][_0x434282(0x214)],'txid':_0x2c115b[_0x434282(0x22a)]['txid'],'notes':_0x2c115b[_0x434282(0x22a)][_0x434282(0x179)],'periodFrom':_0x2c115b[_0x434282(0x22a)][_0x434282(0x155)],'periodTo':_0x2c115b[_0x434282(0x22a)]['periodTo'],'createdAt':_0x2c115b[_0x434282(0x22a)][_0x434282(0x19f)],'paidAt':_0x2c115b['payout']['paidAt']};}async[a35_0x445d8d(0x1e5)](_0x320cd0){const _0x46fd99=a35_0x445d8d,{page:_0x46b0c0,limit:_0x23f9a0,shopId:_0x4f1405,network:_0x40349e,dateFrom:_0x1c6268,dateTo:_0x41d0cd,search:_0x39246e}=_0x320cd0,_0x385c2c=(_0x46b0c0-0x1)*_0x23f9a0,_0x33da36={};_0x4f1405&&(_0x33da36[_0x46fd99(0x1b9)]=_0x4f1405);_0x40349e&&(_0x33da36[_0x46fd99(0x1cc)]=_0x40349e);(_0x1c6268||_0x41d0cd)&&(_0x33da36[_0x46fd99(0x19f)]={},_0x1c6268&&(_0x33da36['createdAt'][_0x46fd99(0x1e7)]=new Date(_0x1c6268)),_0x41d0cd&&(_0x33da36[_0x46fd99(0x19f)]['lte']=new Date(_0x41d0cd)));_0x39246e&&(_0x33da36['OR']=[{'shop':{'name':{'contains':_0x39246e,'mode':_0x46fd99(0x1e4)}}},{'shop':{'username':{'contains':_0x39246e,'mode':_0x46fd99(0x1e4)}}},{'notes':{'contains':_0x39246e,'mode':_0x46fd99(0x1e4)}}]);const [_0x58674a,_0x5395eb]=await Promise[_0x46fd99(0x12e)]([database_1[_0x46fd99(0x1a1)][_0x46fd99(0x22a)][_0x46fd99(0x16d)]({'where':_0x33da36,'skip':_0x385c2c,'take':_0x23f9a0,'orderBy':{'createdAt':_0x46fd99(0x17a)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x46fd99(0x1a1)][_0x46fd99(0x22a)][_0x46fd99(0x235)]({'where':_0x33da36})]);return{'payouts':_0x58674a[_0x46fd99(0x229)](_0x1718b1=>({'id':_0x1718b1['id'],'shopId':_0x1718b1[_0x46fd99(0x1b9)],'shopName':_0x1718b1[_0x46fd99(0x1f3)][_0x46fd99(0x132)],'shopUsername':_0x1718b1[_0x46fd99(0x1f3)][_0x46fd99(0x197)],'amount':_0x1718b1[_0x46fd99(0x127)],'network':_0x1718b1[_0x46fd99(0x1cc)],'status':_0x1718b1[_0x46fd99(0x214)],'txid':_0x1718b1['txid'],'notes':_0x1718b1['notes'],'periodFrom':_0x1718b1[_0x46fd99(0x155)],'periodTo':_0x1718b1['periodTo'],'createdAt':_0x1718b1['createdAt'],'paidAt':_0x1718b1[_0x46fd99(0x21d)]})),'pagination':{'page':_0x46b0c0,'limit':_0x23f9a0,'total':_0x5395eb,'totalPages':Math[_0x46fd99(0x152)](_0x5395eb/_0x23f9a0)}};}async[a35_0x445d8d(0x1fe)](_0x3839e3){const _0x2d1680=a35_0x445d8d,_0x44da12=await database_1[_0x2d1680(0x1a1)][_0x2d1680(0x22a)]['findUnique']({'where':{'id':_0x3839e3},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x44da12)return null;return{'id':_0x44da12['id'],'shopId':_0x44da12['shopId'],'shopName':_0x44da12[_0x2d1680(0x1f3)][_0x2d1680(0x132)],'shopUsername':_0x44da12[_0x2d1680(0x1f3)][_0x2d1680(0x197)],'amount':_0x44da12[_0x2d1680(0x127)],'network':_0x44da12[_0x2d1680(0x1cc)],'status':_0x44da12[_0x2d1680(0x214)],'txid':_0x44da12[_0x2d1680(0x1df)],'notes':_0x44da12[_0x2d1680(0x179)],'periodFrom':_0x44da12[_0x2d1680(0x155)],'periodTo':_0x44da12['periodTo'],'createdAt':_0x44da12['createdAt'],'paidAt':_0x44da12[_0x2d1680(0x21d)]};}async[a35_0x445d8d(0x117)](_0x5578cf){const _0x3f6cf2=a35_0x445d8d;await database_1['default'][_0x3f6cf2(0x22a)][_0x3f6cf2(0x15c)]({'where':{'id':_0x5578cf}});}async[a35_0x445d8d(0x11c)](_0x1b20de){const _0x10be0a=a35_0x445d8d,{page:_0x47d547,limit:_0x10472c,status:_0x528a1f,gateway:_0x2ba145,shopId:_0x5627c1,dateFrom:_0x418955,dateTo:_0x3a8a8f,search:_0x458445,currency:_0xcb9d29,sortBy:_0x494e57,sortOrder:_0xcd0b4d}=_0x1b20de,_0x2a44ef=(_0x47d547-0x1)*_0x10472c;console[_0x10be0a(0x10a)](_0x10be0a(0x1e2),_0x1b20de);const _0x5a57bd=await database_1[_0x10be0a(0x1a1)][_0x10be0a(0x14f)]['groupBy']({'by':['gateway'],'_count':{'gateway':!![]}});console[_0x10be0a(0x10a)](_0x10be0a(0x1cb),_0x5a57bd[_0x10be0a(0x229)](_0x4aefba=>_0x4aefba[_0x10be0a(0x177)]+'\x20('+_0x4aefba[_0x10be0a(0x1ce)][_0x10be0a(0x177)]+_0x10be0a(0x1e1)));if(_0x2ba145){const _0xd3db5f=_0x5a57bd[_0x10be0a(0x12a)](_0x11c56b=>_0x11c56b['gateway'][_0x10be0a(0x1c9)]()===_0x2ba145[_0x10be0a(0x1c9)]());!_0xd3db5f&&_0x2ba145['toLowerCase']()!==_0x10be0a(0x199)&&console['log']('‚ö†Ô∏è\x20Requested\x20gateway\x20\x27'+_0x2ba145+'\x27\x20not\x20found.\x20Available\x20gateways:\x20'+_0x5a57bd['map'](_0xb4a674=>_0xb4a674[_0x10be0a(0x177)])['join'](',\x20'));}const _0x3d6dfd={};_0x528a1f&&(_0x3d6dfd[_0x10be0a(0x214)]=_0x528a1f[_0x10be0a(0x169)]());if(!_0x2ba145)_0x3d6dfd[_0x10be0a(0x177)]={'not':'test_gateway'};else{if(_0x2ba145&&(_0x2ba145[_0x10be0a(0x1c9)]()===_0x10be0a(0x199)||_0x2ba145==='0000'))_0x3d6dfd[_0x10be0a(0x177)]=_0x10be0a(0x199);else{let _0x15df30=_0x2ba145;const _0x404877=(0x0,gateway_1[_0x10be0a(0x13e)])(_0x2ba145);if(_0x404877)_0x15df30=_0x404877,console['log']('üîÑ\x20Converted\x20gateway\x20ID\x20\x27'+_0x2ba145+_0x10be0a(0x20c)+_0x15df30+'\x27');else{const _0x24452d=(0x0,gateway_1[_0x10be0a(0x14d)])(_0x2ba145);if(_0x24452d){const _0xe63d58=(0x0,gateway_1[_0x10be0a(0x13e)])(_0x24452d);_0xe63d58&&(_0x15df30=_0xe63d58,console[_0x10be0a(0x10a)]('üîÑ\x20Converted\x20gateway\x20name\x20\x27'+_0x2ba145+_0x10be0a(0x200)+_0x24452d+'\x27\x20->\x20name\x20\x27'+_0x15df30+'\x27'));}else console[_0x10be0a(0x10a)]('üîç\x20Using\x20gateway\x20\x27'+_0x2ba145+_0x10be0a(0x16f));}const _0x492257=await database_1[_0x10be0a(0x1a1)][_0x10be0a(0x14f)][_0x10be0a(0x235)]({'where':{'gateway':_0x15df30[_0x10be0a(0x1c9)]()},'take':0x1});_0x492257===0x0?(console[_0x10be0a(0x10a)](_0x10be0a(0x219)+_0x15df30+'\x27\x20(from\x20\x27'+_0x2ba145+_0x10be0a(0x1ee)),_0x3d6dfd[_0x10be0a(0x177)]=_0x10be0a(0x220)):(_0x3d6dfd[_0x10be0a(0x177)]=_0x15df30[_0x10be0a(0x1c9)](),console['log'](_0x10be0a(0x203)+_0x15df30+_0x10be0a(0x227)+_0x2ba145+'\x27)'));}}console[_0x10be0a(0x10a)]('üìä\x20Gateway\x20filter\x20applied:',_0x3d6dfd[_0x10be0a(0x177)]);_0x5627c1&&(_0x3d6dfd[_0x10be0a(0x1b9)]=_0x5627c1);_0xcb9d29&&(_0x3d6dfd[_0x10be0a(0x143)]=_0xcb9d29[_0x10be0a(0x169)](),console['log'](_0x10be0a(0x1f4)+_0xcb9d29[_0x10be0a(0x169)]()));(_0x418955||_0x3a8a8f)&&(_0x3d6dfd[_0x10be0a(0x19f)]={},_0x418955&&(_0x3d6dfd[_0x10be0a(0x19f)][_0x10be0a(0x1e7)]=new Date(_0x418955)),_0x3a8a8f&&(_0x3d6dfd[_0x10be0a(0x19f)][_0x10be0a(0x14e)]=new Date(_0x3a8a8f)));_0x458445&&(_0x3d6dfd['OR']=[{'id':{'contains':_0x458445,'mode':_0x10be0a(0x1e4)}},{'orderId':{'contains':_0x458445,'mode':_0x10be0a(0x1e4)}},{'gatewayOrderId':{'contains':_0x458445,'mode':_0x10be0a(0x1e4)}},{'customerEmail':{'contains':_0x458445,'mode':_0x10be0a(0x1e4)}},{'shop':{'name':{'contains':_0x458445,'mode':_0x10be0a(0x1e4)}}},{'shop':{'username':{'contains':_0x458445,'mode':_0x10be0a(0x1e4)}}}]);console[_0x10be0a(0x10a)](_0x10be0a(0x22c),JSON['stringify'](_0x3d6dfd,null,0x2));let _0x5515f3={'createdAt':'desc'};if(_0x494e57){const _0x421bed=[_0x10be0a(0x127),'createdAt',_0x10be0a(0x1e3),'status',_0x10be0a(0x177),_0x10be0a(0x143)],_0x5c5c9b=[_0x10be0a(0x209),_0x10be0a(0x17a)];if(_0x421bed['includes'](_0x494e57)){const _0x26eee5=_0x5c5c9b[_0x10be0a(0x134)](_0xcd0b4d)?_0xcd0b4d:'desc';_0x5515f3={[_0x494e57]:_0x26eee5},console[_0x10be0a(0x10a)](_0x10be0a(0x1ff)+_0x494e57+_0x10be0a(0x172)+_0x26eee5+_0x10be0a(0x145));}}const [_0x449f1a,_0x5683a1]=await Promise[_0x10be0a(0x12e)]([database_1[_0x10be0a(0x1a1)]['payment'][_0x10be0a(0x16d)]({'where':_0x3d6dfd,'skip':_0x2a44ef,'take':_0x10472c,'orderBy':_0x5515f3,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x10be0a(0x1a1)]['payment'][_0x10be0a(0x235)]({'where':_0x3d6dfd})]);return{'payments':_0x449f1a,'pagination':{'page':_0x47d547,'limit':_0x10472c,'total':_0x5683a1,'totalPages':Math[_0x10be0a(0x152)](_0x5683a1/_0x10472c)}};}async[a35_0x445d8d(0x1d8)](_0x405472){const _0x30dba6=a35_0x445d8d,_0x4c7af1=await database_1[_0x30dba6(0x1a1)][_0x30dba6(0x14f)][_0x30dba6(0x1a0)]({'where':{'id':_0x405472},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x4c7af1)return null;return{'id':_0x4c7af1['id'],'shopId':_0x4c7af1[_0x30dba6(0x1b9)],'gateway':_0x4c7af1[_0x30dba6(0x177)],'amount':_0x4c7af1['amount'],'currency':_0x4c7af1[_0x30dba6(0x143)],'status':_0x4c7af1[_0x30dba6(0x214)],'orderId':_0x4c7af1[_0x30dba6(0x12c)],'gatewayOrderId':_0x4c7af1['gatewayOrderId'],'customerEmail':_0x4c7af1['customerEmail'],'customerName':_0x4c7af1[_0x30dba6(0x22d)],'customerCountry':_0x4c7af1[_0x30dba6(0x230)],'customerIp':_0x4c7af1[_0x30dba6(0x234)],'customerUa':_0x4c7af1['customerUa'],'failureMessage':_0x4c7af1[_0x30dba6(0x160)],'externalPaymentUrl':_0x4c7af1[_0x30dba6(0x108)],'successUrl':_0x4c7af1[_0x30dba6(0x10f)],'failUrl':_0x4c7af1[_0x30dba6(0x233)],'pendingUrl':_0x4c7af1[_0x30dba6(0x18e)],'whiteUrl':_0x4c7af1[_0x30dba6(0x114)],'createdAt':_0x4c7af1['createdAt'],'updatedAt':_0x4c7af1[_0x30dba6(0x1e3)],'shop':_0x4c7af1[_0x30dba6(0x1f3)]};}async[a35_0x445d8d(0x226)](_0x4a6573,_0x2c80aa,_0x55728a,_0x2e20f5){const _0x102f59=a35_0x445d8d,_0x346b01=await database_1[_0x102f59(0x1a1)][_0x102f59(0x21c)](async _0x4e3edf=>{const _0x3c46a2=_0x102f59,_0x26d298=await _0x4e3edf[_0x3c46a2(0x14f)]['findUnique']({'where':{'id':_0x4a6573},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x26d298)throw new Error('Payment\x20not\x20found');const _0xc2d694=_0x26d298[_0x3c46a2(0x214)],_0x57ae22=_0x2c80aa['toUpperCase']();console[_0x3c46a2(0x10a)](_0x3c46a2(0x1b2)+_0x4a6573+_0x3c46a2(0x193)+_0xc2d694+_0x3c46a2(0x1a2)+_0x57ae22),console[_0x3c46a2(0x10a)]('üí∞\x20Current\x20shop\x20balance:\x20'+_0x26d298[_0x3c46a2(0x1f3)][_0x3c46a2(0x191)]+_0x3c46a2(0x1d1));const _0x54556a={'status':_0x57ae22,'updatedAt':new Date(),'statusChangedBy':_0x3c46a2(0x22e),'statusChangedAt':new Date()};_0x55728a&&(_0x54556a[_0x3c46a2(0x186)]=_0x55728a);_0x57ae22===_0x3c46a2(0x139)&&_0x2e20f5&&(_0x54556a['chargebackAmount']=_0x2e20f5);let _0x67594b=0x0,_0x141929=_0x26d298['shop'][_0x3c46a2(0x191)];if(_0x57ae22===_0x3c46a2(0x1c5)&&_0xc2d694!==_0x3c46a2(0x1c5)){_0x54556a[_0x3c46a2(0x21d)]=new Date();const _0x59deec=await currencyService_1['currencyService'][_0x3c46a2(0x1f1)](_0x26d298[_0x3c46a2(0x127)],_0x26d298['currency']);_0x54556a['amountUSDT']=_0x59deec;let _0x3cc359=0xa;const _0x4160d2=await _0x4e3edf['shop'][_0x3c46a2(0x1a0)]({'where':{'id':_0x26d298[_0x3c46a2(0x1b9)]},'select':{'gatewaySettings':!![]}});if(_0x4160d2?.[_0x3c46a2(0x195)])try{const _0xafebfe=JSON[_0x3c46a2(0x213)](_0x4160d2[_0x3c46a2(0x195)]);for(const [_0xefea55,_0x24e490]of Object[_0x3c46a2(0x135)](_0xafebfe)){if(_0xefea55[_0x3c46a2(0x1c9)]()===_0x26d298[_0x3c46a2(0x177)][_0x3c46a2(0x1c9)]()){_0x3cc359=_0x24e490[_0x3c46a2(0x178)]||0xa;break;}}}catch(_0x25766d){console[_0x3c46a2(0x10b)](_0x3c46a2(0x129)+_0x4a6573+':',_0x25766d);}const _0x4be139=_0x59deec*(0x1-_0x3cc359/0x64);_0x67594b=_0x4be139,_0x141929+=_0x4be139,console[_0x3c46a2(0x10a)](_0x3c46a2(0x1de)+_0x4a6573+'\x20became\x20PAID:'),console['log'](_0x3c46a2(0x1ed)+_0x59deec[_0x3c46a2(0x232)](0x6)+_0x3c46a2(0x1d1)),console[_0x3c46a2(0x10a)](_0x3c46a2(0x231)+_0x26d298[_0x3c46a2(0x177)]+_0x3c46a2(0x16b)+_0x3cc359+'%'),console[_0x3c46a2(0x10a)](_0x3c46a2(0x204)+_0x4be139[_0x3c46a2(0x232)](0x6)+_0x3c46a2(0x189)+_0x3cc359+_0x3c46a2(0x1e6)),console[_0x3c46a2(0x10a)](_0x3c46a2(0x1a5)+_0x4be139['toFixed'](0x6)+'\x20USDT');}else{if(_0xc2d694===_0x3c46a2(0x1c5)&&_0x57ae22!==_0x3c46a2(0x1c5)){if(_0x26d298[_0x3c46a2(0x1f5)]){let _0x5d2dec=0xa;const _0x1730eb=await _0x4e3edf[_0x3c46a2(0x1f3)][_0x3c46a2(0x1a0)]({'where':{'id':_0x26d298[_0x3c46a2(0x1b9)]},'select':{'gatewaySettings':!![]}});if(_0x1730eb?.[_0x3c46a2(0x195)])try{const _0x481e11=JSON['parse'](_0x1730eb[_0x3c46a2(0x195)]);for(const [_0x30ff75,_0x18360f]of Object['entries'](_0x481e11)){if(_0x30ff75['toLowerCase']()===_0x26d298[_0x3c46a2(0x177)][_0x3c46a2(0x1c9)]()){_0x5d2dec=_0x18360f['commission']||0xa;break;}}}catch(_0x247a2c){console[_0x3c46a2(0x10b)](_0x3c46a2(0x129)+_0x4a6573+':',_0x247a2c);}const _0x593c68=_0x26d298[_0x3c46a2(0x1f5)]*(0x1-_0x5d2dec/0x64);_0x67594b=-_0x593c68,_0x141929-=_0x593c68,_0x54556a[_0x3c46a2(0x1f5)]=null,console[_0x3c46a2(0x10a)](_0x3c46a2(0x1de)+_0x4a6573+_0x3c46a2(0x224)),console[_0x3c46a2(0x10a)](_0x3c46a2(0x1ed)+_0x26d298['amountUSDT'][_0x3c46a2(0x232)](0x6)+_0x3c46a2(0x1d1)),console[_0x3c46a2(0x10a)](_0x3c46a2(0x231)+_0x26d298[_0x3c46a2(0x177)]+_0x3c46a2(0x16b)+_0x5d2dec+'%'),console[_0x3c46a2(0x10a)]('\x20\x20\x20Merchant\x20loses:\x20'+_0x593c68[_0x3c46a2(0x232)](0x6)+_0x3c46a2(0x189)+_0x5d2dec+_0x3c46a2(0x1e6)),console[_0x3c46a2(0x10a)](_0x3c46a2(0x212)+_0x593c68['toFixed'](0x6)+_0x3c46a2(0x1d1));}}}_0x57ae22==='CHARGEBACK'&&(_0xc2d694==='PAID'&&_0x26d298['amountUSDT']&&console[_0x3c46a2(0x10a)](_0x3c46a2(0x116)),_0x2e20f5&&_0x2e20f5>0x0&&(_0x67594b-=_0x2e20f5,_0x141929-=_0x2e20f5,console['log'](_0x3c46a2(0x156)+_0x2e20f5[_0x3c46a2(0x232)](0x6)+_0x3c46a2(0x14c))));_0x57ae22===_0x3c46a2(0x1bd)&&_0xc2d694===_0x3c46a2(0x1c5)&&console[_0x3c46a2(0x10a)](_0x3c46a2(0x16e));const _0x250a62=await _0x4e3edf[_0x3c46a2(0x14f)][_0x3c46a2(0x17e)]({'where':{'id':_0x4a6573},'data':_0x54556a,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x67594b!==0x0&&(await _0x4e3edf['shop'][_0x3c46a2(0x17e)]({'where':{'id':_0x26d298[_0x3c46a2(0x1b9)]},'data':{'balance':_0x141929}}),console[_0x3c46a2(0x10a)](_0x3c46a2(0x19c)+_0x26d298['shopId']+'\x20balance\x20updated:\x20'+_0x26d298[_0x3c46a2(0x1f3)]['balance'][_0x3c46a2(0x232)](0x6)+_0x3c46a2(0x1a2)+_0x141929[_0x3c46a2(0x232)](0x6)+_0x3c46a2(0x1f6)+(_0x67594b>0x0?'+':'')+_0x67594b[_0x3c46a2(0x232)](0x6)+')')),_0x250a62;});return{'id':_0x346b01['id'],'shopId':_0x346b01[_0x102f59(0x1b9)],'gateway':_0x346b01[_0x102f59(0x177)],'amount':_0x346b01[_0x102f59(0x127)],'currency':_0x346b01[_0x102f59(0x143)],'status':_0x346b01[_0x102f59(0x214)],'orderId':_0x346b01['orderId'],'gatewayOrderId':_0x346b01['gatewayOrderId'],'customerEmail':_0x346b01[_0x102f59(0x1fc)],'customerName':_0x346b01[_0x102f59(0x22d)],'customerCountry':_0x346b01['customerCountry'],'customerIp':_0x346b01[_0x102f59(0x234)],'customerUa':_0x346b01[_0x102f59(0x13b)],'failureMessage':_0x346b01[_0x102f59(0x160)],'adminNotes':_0x346b01[_0x102f59(0x186)],'chargebackAmount':_0x346b01[_0x102f59(0x1f8)],'statusChangedBy':_0x346b01[_0x102f59(0x1b4)],'statusChangedAt':_0x346b01['statusChangedAt'],'createdAt':_0x346b01['createdAt'],'updatedAt':_0x346b01[_0x102f59(0x1e3)],'shop':_0x346b01[_0x102f59(0x1f3)]};}async[a35_0x445d8d(0x21e)](_0x47b336,_0xd4f7ed){const _0x324c9b=a35_0x445d8d,_0x324a57=Math[_0x324c9b(0x11a)]()[_0x324c9b(0x1fb)](0x24)[_0x324c9b(0x184)](0x2,0x9);console[_0x324c9b(0x10a)](_0x324c9b(0x1d7)+_0x324a57+_0x324c9b(0x1af)+_0x47b336);const _0x1bff2a={..._0xd4f7ed};_0xd4f7ed[_0x324c9b(0x146)]&&(_0x1bff2a['password']=await bcryptjs_1[_0x324c9b(0x1a1)][_0x324c9b(0x1f2)](_0xd4f7ed[_0x324c9b(0x146)],0xc));_0xd4f7ed[_0x324c9b(0x1c4)]&&(_0x1bff2a['name']=_0xd4f7ed[_0x324c9b(0x1c4)],delete _0x1bff2a[_0x324c9b(0x1c4)]);_0xd4f7ed[_0x324c9b(0x17d)]&&(_0x1bff2a['telegram']=_0xd4f7ed['telegramId'],delete _0x1bff2a[_0x324c9b(0x17d)]);_0xd4f7ed[_0x324c9b(0x137)]&&(_0x1bff2a[_0x324c9b(0x1dc)]=_0xd4f7ed[_0x324c9b(0x137)],delete _0x1bff2a[_0x324c9b(0x137)]);if(_0xd4f7ed['gateways']){const _0x29cb46=_0xd4f7ed[_0x324c9b(0x206)][_0x324c9b(0x229)](_0x14751c=>this[_0x324c9b(0x228)](_0x14751c));console[_0x324c9b(0x10a)](_0x324c9b(0x182),_0xd4f7ed[_0x324c9b(0x206)],'->',_0x29cb46),_0x1bff2a[_0x324c9b(0x1d2)]=JSON[_0x324c9b(0x15f)](_0x29cb46),delete _0x1bff2a[_0x324c9b(0x206)];}_0xd4f7ed[_0x324c9b(0x195)]&&(console[_0x324c9b(0x10a)](_0x324c9b(0x1ab)+_0x324a57+_0x324c9b(0x1c2),_0xd4f7ed[_0x324c9b(0x195)]),_0x1bff2a['gatewaySettings']=JSON['stringify'](_0xd4f7ed['gatewaySettings']),console[_0x324c9b(0x10a)](_0x324c9b(0x1ab)+_0x324a57+_0x324c9b(0x198),_0x1bff2a[_0x324c9b(0x195)]));_0xd4f7ed[_0x324c9b(0x185)]&&(_0xd4f7ed['wallets'][_0x324c9b(0x20f)]!==undefined&&(_0x1bff2a[_0x324c9b(0x20f)]=_0xd4f7ed[_0x324c9b(0x185)]['usdtPolygonWallet']||null),_0xd4f7ed[_0x324c9b(0x185)]['usdtTrcWallet']!==undefined&&(_0x1bff2a[_0x324c9b(0x1c3)]=_0xd4f7ed['wallets']['usdtTrcWallet']||null),_0xd4f7ed[_0x324c9b(0x185)][_0x324c9b(0x1da)]!==undefined&&(_0x1bff2a[_0x324c9b(0x1da)]=_0xd4f7ed[_0x324c9b(0x185)][_0x324c9b(0x1da)]||null),_0xd4f7ed[_0x324c9b(0x185)]['usdcPolygonWallet']!==undefined&&(_0x1bff2a[_0x324c9b(0x21a)]=_0xd4f7ed[_0x324c9b(0x185)][_0x324c9b(0x21a)]||null),delete _0x1bff2a['wallets']);const _0x2b3a05=await database_1[_0x324c9b(0x1a1)][_0x324c9b(0x1f3)][_0x324c9b(0x17e)]({'where':{'id':_0x47b336},'data':_0x1bff2a,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console['log'](_0x324c9b(0x15e)+_0x324a57+_0x324c9b(0x1c0),_0x2b3a05['gatewaySettings']),{'id':_0x2b3a05['id'],'fullName':_0x2b3a05[_0x324c9b(0x132)],'username':_0x2b3a05[_0x324c9b(0x197)],'telegramId':_0x2b3a05[_0x324c9b(0x106)],'merchantUrl':_0x2b3a05[_0x324c9b(0x1dc)],'gateways':_0x2b3a05['paymentGateways']?JSON['parse'](_0x2b3a05[_0x324c9b(0x1d2)]):null,'gatewaySettings':_0x2b3a05['gatewaySettings']?JSON[_0x324c9b(0x213)](_0x2b3a05[_0x324c9b(0x195)]):null,'publicKey':_0x2b3a05[_0x324c9b(0x1a9)],'wallets':{'usdtPolygonWallet':_0x2b3a05[_0x324c9b(0x20f)],'usdtTrcWallet':_0x2b3a05[_0x324c9b(0x1c3)],'usdtErcWallet':_0x2b3a05[_0x324c9b(0x1da)],'usdcPolygonWallet':_0x2b3a05[_0x324c9b(0x21a)]},'status':_0x2b3a05[_0x324c9b(0x214)],'createdAt':_0x2b3a05[_0x324c9b(0x19f)]};}async[a35_0x445d8d(0x1ef)](_0x15c3cb){const _0x49bd36=a35_0x445d8d,_0x4e96f3=await database_1[_0x49bd36(0x1a1)][_0x49bd36(0x1f3)][_0x49bd36(0x17e)]({'where':{'id':_0x15c3cb},'data':{'status':'SUSPENDED'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4e96f3['id'],'fullName':_0x4e96f3[_0x49bd36(0x132)],'username':_0x4e96f3[_0x49bd36(0x197)],'telegramId':_0x4e96f3[_0x49bd36(0x106)],'merchantUrl':_0x4e96f3[_0x49bd36(0x1dc)],'gateways':_0x4e96f3[_0x49bd36(0x1d2)]?JSON[_0x49bd36(0x213)](_0x4e96f3[_0x49bd36(0x1d2)]):null,'gatewaySettings':_0x4e96f3[_0x49bd36(0x195)]?JSON[_0x49bd36(0x213)](_0x4e96f3['gatewaySettings']):null,'publicKey':_0x4e96f3[_0x49bd36(0x1a9)],'wallets':{'usdtPolygonWallet':_0x4e96f3['usdtPolygonWallet'],'usdtTrcWallet':_0x4e96f3['usdtTrcWallet'],'usdtErcWallet':_0x4e96f3['usdtErcWallet'],'usdcPolygonWallet':_0x4e96f3[_0x49bd36(0x21a)]},'status':_0x4e96f3['status'],'createdAt':_0x4e96f3[_0x49bd36(0x19f)]};}async[a35_0x445d8d(0x188)](_0x51fdfd){const _0x50e165=a35_0x445d8d,_0x24e81e=await database_1['default'][_0x50e165(0x1f3)]['update']({'where':{'id':_0x51fdfd},'data':{'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x24e81e['id'],'fullName':_0x24e81e[_0x50e165(0x132)],'username':_0x24e81e[_0x50e165(0x197)],'telegramId':_0x24e81e[_0x50e165(0x106)],'merchantUrl':_0x24e81e[_0x50e165(0x1dc)],'gateways':_0x24e81e['paymentGateways']?JSON[_0x50e165(0x213)](_0x24e81e[_0x50e165(0x1d2)]):null,'gatewaySettings':_0x24e81e['gatewaySettings']?JSON['parse'](_0x24e81e[_0x50e165(0x195)]):null,'publicKey':_0x24e81e[_0x50e165(0x1a9)],'wallets':{'usdtPolygonWallet':_0x24e81e['usdtPolygonWallet'],'usdtTrcWallet':_0x24e81e[_0x50e165(0x1c3)],'usdtErcWallet':_0x24e81e[_0x50e165(0x1da)],'usdcPolygonWallet':_0x24e81e[_0x50e165(0x21a)]},'status':_0x24e81e[_0x50e165(0x214)],'createdAt':_0x24e81e[_0x50e165(0x19f)]};}async['getAllUsers'](_0x1a0bc9){const _0x5400b3=a35_0x445d8d,{page:_0x2f7a0e,limit:_0x125178,status:_0x3b67e5}=_0x1a0bc9,_0x150e28=(_0x2f7a0e-0x1)*_0x125178,_0x52db0a={};_0x3b67e5&&(_0x52db0a[_0x5400b3(0x214)]=_0x3b67e5[_0x5400b3(0x169)]());const [_0x5f4bef,_0x1663d9]=await Promise[_0x5400b3(0x12e)]([database_1[_0x5400b3(0x1a1)]['shop']['findMany']({'where':_0x52db0a,'skip':_0x150e28,'take':_0x125178,'orderBy':{'createdAt':_0x5400b3(0x17a)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x5400b3(0x1a1)][_0x5400b3(0x1f3)][_0x5400b3(0x235)]({'where':_0x52db0a})]);return{'users':_0x5f4bef[_0x5400b3(0x229)](_0x39bbde=>{const _0x27e5ae=_0x5400b3,_0x4355f1=_0x39bbde['paymentGateways']?JSON[_0x27e5ae(0x213)](_0x39bbde[_0x27e5ae(0x1d2)]):null,_0x518bc7=_0x4355f1?_0x4355f1[_0x27e5ae(0x229)](_0x2bf62b=>this[_0x27e5ae(0x109)](_0x2bf62b)):null;return{'id':_0x39bbde['id'],'fullName':_0x39bbde[_0x27e5ae(0x132)],'username':_0x39bbde[_0x27e5ae(0x197)],'telegramId':_0x39bbde[_0x27e5ae(0x106)],'merchantUrl':_0x39bbde['shopUrl'],'gateways':_0x518bc7,'gatewaySettings':_0x39bbde[_0x27e5ae(0x195)]?JSON[_0x27e5ae(0x213)](_0x39bbde['gatewaySettings']):null,'publicKey':_0x39bbde[_0x27e5ae(0x1a9)],'wallets':{'usdtPolygonWallet':_0x39bbde[_0x27e5ae(0x20f)],'usdtTrcWallet':_0x39bbde['usdtTrcWallet'],'usdtErcWallet':_0x39bbde[_0x27e5ae(0x1da)],'usdcPolygonWallet':_0x39bbde[_0x27e5ae(0x21a)]},'status':_0x39bbde[_0x27e5ae(0x214)],'createdAt':_0x39bbde[_0x27e5ae(0x19f)]};}),'pagination':{'page':_0x2f7a0e,'limit':_0x125178,'total':_0x1663d9,'totalPages':Math['ceil'](_0x1663d9/_0x125178)}};}async[a35_0x445d8d(0x1ca)](_0x49c2ac){const _0x50f0fa=a35_0x445d8d,_0x10c421=await database_1[_0x50f0fa(0x1a1)]['shop'][_0x50f0fa(0x1a0)]({'where':{'id':_0x49c2ac},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x10c421)return null;const _0x5be915=_0x10c421[_0x50f0fa(0x1d2)]?JSON[_0x50f0fa(0x213)](_0x10c421['paymentGateways']):null,_0x4cc396=_0x5be915?_0x5be915[_0x50f0fa(0x229)](_0x4924fc=>this['getGatewayDisplayName'](_0x4924fc)):null;return _0x5be915&&_0x4cc396&&console[_0x50f0fa(0x10a)]('üîÑ\x20Gateway\x20mapping\x20(get):',_0x5be915,'->',_0x4cc396),{'id':_0x10c421['id'],'fullName':_0x10c421[_0x50f0fa(0x132)],'username':_0x10c421[_0x50f0fa(0x197)],'telegramId':_0x10c421[_0x50f0fa(0x106)],'merchantUrl':_0x10c421[_0x50f0fa(0x1dc)],'gateways':_0x4cc396,'gatewaySettings':_0x10c421[_0x50f0fa(0x195)]?JSON[_0x50f0fa(0x213)](_0x10c421[_0x50f0fa(0x195)]):null,'publicKey':_0x10c421[_0x50f0fa(0x1a9)],'wallets':{'usdtPolygonWallet':_0x10c421[_0x50f0fa(0x20f)],'usdtTrcWallet':_0x10c421[_0x50f0fa(0x1c3)],'usdtErcWallet':_0x10c421['usdtErcWallet'],'usdcPolygonWallet':_0x10c421[_0x50f0fa(0x21a)]},'status':_0x10c421[_0x50f0fa(0x214)],'createdAt':_0x10c421[_0x50f0fa(0x19f)]};}async['createUser'](_0x153f68){const _0x5b4db8=a35_0x445d8d,{fullName:_0x52f805,username:_0x1e97bf,password:_0x3d4f9f,telegramId:_0x23bf49,merchantUrl:_0x5bac87,gateways:_0x418157,gatewaySettings:_0x1e07a8,wallets:_0x1e09cc}=_0x153f68,_0xae082b=await database_1[_0x5b4db8(0x1a1)][_0x5b4db8(0x1f3)][_0x5b4db8(0x1a0)]({'where':{'username':_0x1e97bf}});if(_0xae082b)throw new Error('Username\x20already\x20exists');if(_0x23bf49){const _0x47b5ba=await database_1[_0x5b4db8(0x1a1)][_0x5b4db8(0x1f3)][_0x5b4db8(0x1a0)]({'where':{'telegram':_0x23bf49}});if(_0x47b5ba)throw new Error('Telegram\x20username\x20already\x20exists');}const _0xb232d=await bcryptjs_1['default']['hash'](_0x3d4f9f,0xc),_0x5eb6b=_0x5b4db8(0x201)+crypto_1[_0x5b4db8(0x1a1)][_0x5b4db8(0x18c)](0x20)[_0x5b4db8(0x1fb)]('hex'),_0x2db350='sk_'+crypto_1[_0x5b4db8(0x1a1)][_0x5b4db8(0x18c)](0x20)['toString'](_0x5b4db8(0x154)),_0x3c33d5=_0x418157?_0x418157['map'](_0x317ed8=>this[_0x5b4db8(0x228)](_0x317ed8)):null;_0x418157&&_0x3c33d5&&console[_0x5b4db8(0x10a)]('üîÑ\x20Gateway\x20mapping\x20(create):',_0x418157,'->',_0x3c33d5);const _0x19a9ab=await database_1[_0x5b4db8(0x1a1)]['shop'][_0x5b4db8(0x1a4)]({'data':{'name':_0x52f805,'username':_0x1e97bf,'password':_0xb232d,'telegram':_0x23bf49,'shopUrl':_0x5bac87,'paymentGateways':_0x3c33d5?JSON['stringify'](_0x3c33d5):null,'gatewaySettings':_0x1e07a8?JSON[_0x5b4db8(0x15f)](_0x1e07a8):null,'usdtPolygonWallet':_0x1e09cc?.[_0x5b4db8(0x20f)]||null,'usdtTrcWallet':_0x1e09cc?.[_0x5b4db8(0x1c3)]||null,'usdtErcWallet':_0x1e09cc?.['usdtErcWallet']||null,'usdcPolygonWallet':_0x1e09cc?.[_0x5b4db8(0x21a)]||null,'publicKey':_0x5eb6b,'secretKey':_0x2db350,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x19a9ab['id'],'fullName':_0x19a9ab[_0x5b4db8(0x132)],'username':_0x19a9ab[_0x5b4db8(0x197)],'telegramId':_0x19a9ab[_0x5b4db8(0x106)],'merchantUrl':_0x19a9ab[_0x5b4db8(0x1dc)],'gateways':_0x19a9ab[_0x5b4db8(0x1d2)]?JSON['parse'](_0x19a9ab[_0x5b4db8(0x1d2)]):null,'gatewaySettings':_0x19a9ab[_0x5b4db8(0x195)]?JSON[_0x5b4db8(0x213)](_0x19a9ab[_0x5b4db8(0x195)]):null,'publicKey':_0x19a9ab[_0x5b4db8(0x1a9)],'wallets':{'usdtPolygonWallet':_0x19a9ab[_0x5b4db8(0x20f)],'usdtTrcWallet':_0x19a9ab['usdtTrcWallet'],'usdtErcWallet':_0x19a9ab[_0x5b4db8(0x1da)],'usdcPolygonWallet':_0x19a9ab[_0x5b4db8(0x21a)]},'status':_0x19a9ab[_0x5b4db8(0x214)],'createdAt':_0x19a9ab[_0x5b4db8(0x19f)]};}async['deleteUser'](_0x220094){const _0x290d08=a35_0x445d8d;await database_1[_0x290d08(0x1a1)][_0x290d08(0x1f3)][_0x290d08(0x15c)]({'where':{'id':_0x220094}});}[a35_0x445d8d(0x14a)](_0x11da5f,_0x3e8ce5,_0x38199a){const _0x819cf2=a35_0x445d8d,_0x188f96=new Map(),_0x4bdf90=new Date(_0x3e8ce5);while(_0x4bdf90<=_0x38199a){const _0x497be6=_0x4bdf90[_0x819cf2(0x20a)]()[_0x819cf2(0x166)]('T')[0x0];_0x188f96['set'](_0x497be6,{'revenue':0x0,'count':0x0}),_0x4bdf90[_0x819cf2(0x112)](_0x4bdf90[_0x819cf2(0x1bf)]()+0x1);}for(const _0x463142 of _0x11da5f){const _0x34db8e=_0x463142[_0x819cf2(0x19f)][_0x819cf2(0x20a)]()[_0x819cf2(0x166)]('T')[0x0],_0x6a469e=_0x188f96[_0x819cf2(0x12b)](_0x34db8e);_0x6a469e&&(_0x6a469e[_0x819cf2(0x235)]+=0x1,_0x463142['status']===_0x819cf2(0x1c5)&&(_0x463142[_0x819cf2(0x1f5)]?_0x6a469e[_0x819cf2(0x1ac)]+=_0x463142[_0x819cf2(0x1f5)]:console[_0x819cf2(0x10a)](_0x819cf2(0x138)+_0x463142['id']+_0x819cf2(0x205))));}const _0x3213e0=[],_0x187254=[];for(const [_0x2710fd,_0x3cb6f2]of _0x188f96){_0x3213e0['push']({'date':_0x2710fd,'amount':Math[_0x819cf2(0x20e)](_0x3cb6f2[_0x819cf2(0x1ac)]*0x64)/0x64}),_0x187254[_0x819cf2(0x126)]({'date':_0x2710fd,'count':_0x3cb6f2[_0x819cf2(0x235)]});}return{'dailyRevenue':_0x3213e0,'dailyPayments':_0x187254};}}exports[a35_0x445d8d(0x1d0)]=AdminService;