'use strict';function a35_0x25c2(_0x5e6c1c,_0x4b882f){const _0x56eea4=a35_0x56ee();return a35_0x25c2=function(_0x25c201,_0x178cb8){_0x25c201=_0x25c201-0x1d0;let _0x411936=_0x56eea4[_0x25c201];return _0x411936;},a35_0x25c2(_0x5e6c1c,_0x4b882f);}const a35_0x402199=a35_0x25c2;(function(_0x318a91,_0x41ffe4){const _0x113e08=a35_0x25c2,_0x4d6b48=_0x318a91();while(!![]){try{const _0x47282f=-parseInt(_0x113e08(0x248))/0x1*(parseInt(_0x113e08(0x2dd))/0x2)+parseInt(_0x113e08(0x262))/0x3+parseInt(_0x113e08(0x267))/0x4+parseInt(_0x113e08(0x240))/0x5*(-parseInt(_0x113e08(0x230))/0x6)+-parseInt(_0x113e08(0x2a6))/0x7+parseInt(_0x113e08(0x2ce))/0x8+parseInt(_0x113e08(0x2b8))/0x9*(parseInt(_0x113e08(0x217))/0xa);if(_0x47282f===_0x41ffe4)break;else _0x4d6b48['push'](_0x4d6b48['shift']());}catch(_0x81d4d7){_0x4d6b48['push'](_0x4d6b48['shift']());}}}(a35_0x56ee,0x791ae));var __importDefault=this&&this[a35_0x402199(0x24e)]||function(_0x262df6){const _0x54206c=a35_0x402199;return _0x262df6&&_0x262df6[_0x54206c(0x22b)]?_0x262df6:{'default':_0x262df6};};Object[a35_0x402199(0x235)](exports,a35_0x402199(0x22b),{'value':!![]}),exports['AdminService']=void 0x0;function a35_0x56ee(){const _0x223753=['\x20to\x20','localeCompare','getGatewayIdByName','💰\x20[PAYOUT]\x20Gateway\x20','length','publicKey','Username\x20already\x20exists','getAllPayments','usdtPolygonWallet','REFUND','hash','🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','\x20\x20\x20💰\x20Total\x20turnover:\x20','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','7192480KkJZkL','shop','periodFrom','set','\x20\x20\x20💰\x20Total\x20payout:\x20','statusChangedBy','updatePaymentStatus','\x20\x20\x20💳\x20Total\x20payments:\x20','\x20balance\x20updated:\x20','wallets','some','amount','totalAmountAfterCommissionUSDT','cointopay','username','2QNKAJR','update','thisMonth','successUrl','values','turnoverUSDT','AdminService','\x20\x20\x20✅\x20Actual\x20available\x20balance:\x20','🔄\x20Gateway\x20mapping\x20(get):','cointopay2','test_gateway','💸\x20CHARGEBACK\x20penalty:\x20-','CoinToPay','telegram','ceil','password','generateDailyStatistics','getMerchantsSelection','log','✅\x20Using\x20gateway\x20filter:\x20\x27','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','getGatewayDisplayName','dailyRevenue','shopUrl','$transaction','amountAfterCommissionUSDT','currency','Plisio','\x20USDT\x20(without\x20commission)','🔄\x20Converted\x20gateway\x20ID\x20\x27','Payment\x20not\x20found','💰\x20Payment\x20','\x20USDT\x20(total\x20paid\x20to\x20merchants)','toFixed','findUnique','💱\x20Currency\x20filter\x20applied:\x20','pk_','../types/gateway','\x20\x20\x20✅\x20Total\x20available\x20for\x20payout:\x20','join','_count','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','commissionUSDT','totalPaidOut','\x20USDT\x20(with\x20commission\x20deducted)','desc','delete','network','sort','Error\x20processing\x20payment\x20','\x20USDT\x20(gross\x20revenue)','paymentGateways','name','30d','usdtErcWallet','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','📊\x20Merchant\x20statistics\x20calculated:','toISOString','split','\x20\x20\x20🌍\x20Country:\x20','toUpperCase','\x20\x20\x20Payout\x20amount:\x20',',\x20successful:\x20','gatewayOrderId','usdcPolygonWallet','push','\x20no\x20longer\x20PAID:','\x27\x20not\x20found.\x20Available\x20gateways:\x20','Open\x20Banking\x202','\x20for\x20shop\x20','📅\x20Period:\x20','✅\x20Payout\x20created:\x20','getTime','\x20\x20\x20Merchant\x20loses:\x20','aggregate','customerName','💰\x20Shop\x20','averageCommissionRate','externalPaymentUrl','\x20payments)','asc','📋\x20Getting\x20merchants\x20selection\x20list...','map','📊\x20Merchants\x20awaiting\x20payout:\x20','../config/database','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','\x20\x20\x20💵\x20Available\x20balance:\x20','customerCountry','updatedAt','\x20USDT,\x20Requested:\x20','Telegram\x20username\x20already\x20exists','getGatewayNameById','💰\x20Found\x20','getUserById','notes','📊\x20Available\x20gateways\x20in\x20database:','ACTIVE','27220ffWScQ','KLYME\x20DE','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','\x20->\x20','getFullYear','plisio','\x20USDT\x20(actual\x20balances)','Noda','📅\x20Period\x20\x27all\x27:\x20Using\x20start\x20date\x20from\x20first\x20payment:\x20','groupBy','totalPayout','\x20USDT\x20(same\x20as\x20awaiting)','\x20\x20\x20🔍\x20Calculated\x20after\x20commission:\x20','\x20\x20\x20Current\x20balance:\x20','klyme_eu','failureMessage','\x20USDT','insensitive','\x20paid\x20payments\x20for\x20analysis','Test\x20Gateway','__esModule','%\x20commission)','telegramId','payment','createUser','711174xBquTv','getPaymentById','⚠️\x20Gateway\x20\x27','\x20\x20\x20�\x20Total\x20payments\x20turnover:\x20','erc20','defineProperty','\x20merchants','CHARGEBACK','hex','\x20merchants\x20with\x20positive\x20balance','findFirst','gatewayEarnings','\x20\x20\x20📊\x20Total\x20payments:\x20','toString','date','round','20xnZGKt','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','klyme_de','count','shopId','customerUa','gateways','🔍\x20Using\x20gateway\x20\x27','960737DUOeib','currencyService','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','getGatewayInternalName','\x20USDT\x20(after\x20payouts)','status','__importDefault','\x20\x20\x20📅\x20Total\x20payouts\x20(this\x20month):\x20','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','updateUser','\x20in\x20','entries','📋\x20Found\x20','\x20USDT\x20from\x20balance','stringify','create','📊\x20Payout\x20statistics\x20calculated:','totalCommissionRate','dateTo','COMPLETED','deletePayout','PAID','getAllPayouts','KLYME\x20EU','🔄\x20Gateway\x20mapping\x20(create):','paymentsCount','988818NvDmtQ','revenue','statusChangedAt','toLowerCase','reduce','1661984VLTrys','MasterCard','deleteUser','admin','orderId','💰\x20Current\x20shop\x20balance:\x20','balance','SUSPENDED','includes','updateCustomerData','period','default','payout','\x20\x20\x20🔍\x20Raw\x20balance\x20sum:\x20','lte','periodTo','totalTurnover','amountUSDT','merchantUrl','activateUser','dateFrom','fullName','Rapyd','commission','adminNotes','crypto','🔄\x20Converted\x20gateway\x20name\x20\x27','💰\x20[PAYOUT]\x20Merchant\x20','convertToUSDT','failUrl','\x20PAID\x20payments','\x20\x20\x20Balance:\x20','\x20USDT\x20(+','\x20USDT)','gateway','💸\x20CHARGEBACK:\x20Merchant\x20amount\x20already\x20deducted\x20from\x20balance','\x20USDT\x20(','\x20\x20\x20Total\x20paid\x20out:\x20',',\x20Commission:\x20','gatewaySettings','getMerchantsAwaitingPayout','KLYME\x20GB','totalAmountUSDT','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','\x20\x20\x20Full\x20amount:\x20','\x20\x20\x20🌐\x20IP:\x20','\x20USDT\x20(after\x20','_sum','💰\x20Creating\x20payout\x20for\x20shop\x20','🔄\x20Gateway\x20mapping:','2020-01-01','parse','customerIp','getPayoutById','findMany','gte','merchantEarnings','📊\x20Calculating\x20payout\x20statistics...','summary','\x20became\x20PAID:','merchantEarningsUSDT','\x20status:\x20','getDate','3918635drKjKy','getMonth','paidAt','txid','\x27\x20->\x20ID\x20\x27','\x20\x20\x20Gateway:\x20','polygon_usdc','createdAt','not\x20set','error','usdtTrcWallet',':\x20commission\x20=\x20','paidOutUSDT','averageCheckUSDT','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','turnover','forEach','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','2799YdUOtX','totalPayments','\x20balance\x20updated:','all','randomBytes','getMerchantStatistics','\x20\x20\x20💰\x20Total\x20payments\x20turnover:\x20','trc20'];a35_0x56ee=function(){return _0x223753;};return a35_0x56ee();}const database_1=__importDefault(require(a35_0x402199(0x20a))),bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a35_0x402199(0x280))),currencyService_1=require('./currencyService'),gateway_1=require(a35_0x402199(0x1db));class AdminService{async['getPayoutStats'](){const _0x3f3cef=a35_0x402199;console[_0x3f3cef(0x2ef)](_0x3f3cef(0x2a0));const _0x4646c5=await database_1[_0x3f3cef(0x272)][_0x3f3cef(0x2cf)][_0x3f3cef(0x200)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':'ACTIVE'}}),_0x14648c=await this[_0x3f3cef(0x28f)]({'page':0x1,'limit':0x3e8}),_0x5b6102=await database_1[_0x3f3cef(0x272)]['payment'][_0x3f3cef(0x243)]({'where':{'status':_0x3f3cef(0x25d),'gateway':{'not':_0x3f3cef(0x2e7)}}}),_0x16407a=new Date(),_0x1f97e6=new Date(_0x16407a[_0x3f3cef(0x21b)](),_0x16407a[_0x3f3cef(0x2a7)](),0x1),_0x3b1de5=new Date(_0x16407a['getFullYear'](),_0x16407a[_0x3f3cef(0x2a7)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x5e894c=await database_1[_0x3f3cef(0x272)]['payout'][_0x3f3cef(0x200)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x1f97e6,'lte':_0x3b1de5},'status':_0x3f3cef(0x25b)}}),_0x17e40b=_0x4646c5[_0x3f3cef(0x296)][_0x3f3cef(0x1e1)]||0x0,_0x5d1b44=_0x14648c[_0x3f3cef(0x2a1)]['totalAmountAfterCommissionUSDT'],_0x16fba7=_0x5e894c[_0x3f3cef(0x296)][_0x3f3cef(0x2d9)]||0x0,_0x5eb1a7={'totalPayout':Math[_0x3f3cef(0x23f)](_0x17e40b*0x64)/0x64,'awaitingPayout':Math[_0x3f3cef(0x23f)](_0x5d1b44*0x64)/0x64,'thisMonth':Math[_0x3f3cef(0x23f)](_0x16fba7*0x64)/0x64,'availableBalance':Math[_0x3f3cef(0x23f)](_0x5d1b44*0x64)/0x64,'totalPayments':_0x5b6102};return console[_0x3f3cef(0x2ef)](_0x3f3cef(0x258)),console[_0x3f3cef(0x2ef)](_0x3f3cef(0x2d2)+_0x5eb1a7[_0x3f3cef(0x221)]+_0x3f3cef(0x1d6)),console[_0x3f3cef(0x2ef)](_0x3f3cef(0x219)+_0x5eb1a7['awaitingPayout']+_0x3f3cef(0x1e2)),console[_0x3f3cef(0x2ef)](_0x3f3cef(0x20c)+_0x5eb1a7['availableBalance']+_0x3f3cef(0x222)),console[_0x3f3cef(0x2ef)]('\x20\x20\x20📅\x20This\x20month:\x20'+_0x5eb1a7['thisMonth']+_0x3f3cef(0x227)),console[_0x3f3cef(0x2ef)](_0x3f3cef(0x2d5)+_0x5eb1a7['totalPayments']+_0x3f3cef(0x285)),console[_0x3f3cef(0x2ef)](_0x3f3cef(0x274)+(_0x4646c5[_0x3f3cef(0x296)][_0x3f3cef(0x26d)]||0x0)[_0x3f3cef(0x1d7)](0x2)+_0x3f3cef(0x1d2)),console['log']('\x20\x20\x20📊\x20Commission\x20difference:\x20'+((_0x4646c5[_0x3f3cef(0x296)]['balance']||0x0)-_0x5d1b44)[_0x3f3cef(0x1d7)](0x2)+_0x3f3cef(0x227)),_0x5eb1a7;}async[a35_0x402199(0x270)](_0x371470,_0x2ca728){const _0xfbf17=a35_0x402199;console[_0xfbf17(0x2ef)](_0xfbf17(0x2cd)+_0x371470+':',_0x2ca728);const _0x25a314=await database_1[_0xfbf17(0x272)][_0xfbf17(0x22e)][_0xfbf17(0x1d8)]({'where':{'id':_0x371470},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x25a314)throw new Error(_0xfbf17(0x1d4));const _0x574879={};_0x2ca728[_0xfbf17(0x20d)]!==undefined&&(_0x574879[_0xfbf17(0x20d)]=_0x2ca728['customerCountry']||null);_0x2ca728[_0xfbf17(0x29b)]!==undefined&&(_0x574879[_0xfbf17(0x29b)]=_0x2ca728['customerIp']||null);_0x2ca728[_0xfbf17(0x245)]!==undefined&&(_0x574879['customerUa']=_0x2ca728['customerUa']||null);const _0xdc9a1=await database_1[_0xfbf17(0x272)][_0xfbf17(0x22e)][_0xfbf17(0x2de)]({'where':{'id':_0x371470},'data':{..._0x574879,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0xfbf17(0x2ef)](_0xfbf17(0x1ed)+_0x371470),console[_0xfbf17(0x2ef)](_0xfbf17(0x1f1)+_0x25a314['customerCountry']+_0xfbf17(0x21a)+_0xdc9a1[_0xfbf17(0x20d)]),console[_0xfbf17(0x2ef)](_0xfbf17(0x294)+_0x25a314[_0xfbf17(0x29b)]+_0xfbf17(0x21a)+_0xdc9a1[_0xfbf17(0x29b)]),console[_0xfbf17(0x2ef)]('\x20\x20\x20🖥️\x20User\x20Agent:\x20'+(_0x25a314[_0xfbf17(0x245)]?_0xfbf17(0x2d1):_0xfbf17(0x2ae))+'\x20->\x20'+(_0xdc9a1[_0xfbf17(0x245)]?_0xfbf17(0x2d1):_0xfbf17(0x2ae))),_0xdc9a1;}async['getSystemStatistics'](_0xfc5a1e){const _0x213b48=a35_0x402199,_0x1e49b5=new Date();let _0x107369;switch(_0xfc5a1e){case'7d':_0x107369=new Date(_0x1e49b5['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x213b48(0x1eb):_0x107369=new Date(_0x1e49b5[_0x213b48(0x1fe)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'90d':_0x107369=new Date(_0x1e49b5[_0x213b48(0x1fe)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x213b48(0x2bb):const _0x427fd5=await database_1[_0x213b48(0x272)][_0x213b48(0x22e)]['findFirst']({'where':{'gateway':{'not':_0x213b48(0x2e7)}},'orderBy':{'createdAt':_0x213b48(0x206)},'select':{'createdAt':!![]}});_0x107369=_0x427fd5?_0x427fd5[_0x213b48(0x2ad)]:new Date(_0x213b48(0x299)),console[_0x213b48(0x2ef)](_0x213b48(0x21f)+_0x107369[_0x213b48(0x1ef)]());break;default:_0x107369=new Date(_0x1e49b5[_0x213b48(0x1fe)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x3ad2d7,_0x352e99,_0x1049c8,_0x1f574c,_0x580d9e,_0x1e79b5,_0x4843ed]=await Promise[_0x213b48(0x2bb)]([database_1['default'][_0x213b48(0x2cf)]['count'](),database_1[_0x213b48(0x272)][_0x213b48(0x2cf)][_0x213b48(0x243)]({'where':{'status':'ACTIVE'}}),database_1[_0x213b48(0x272)]['payment']['count']({'where':{'createdAt':{'gte':_0x107369},'gateway':{'not':_0x213b48(0x2e7)}}}),database_1[_0x213b48(0x272)][_0x213b48(0x22e)][_0x213b48(0x243)]({'where':{'status':_0x213b48(0x25d),'createdAt':{'gte':_0x107369},'gateway':{'not':'test_gateway'}}}),database_1[_0x213b48(0x272)]['payment']['findMany']({'where':{'status':_0x213b48(0x25d),'createdAt':{'gte':_0x107369},'gateway':{'not':_0x213b48(0x2e7)}},'select':{'amount':!![],'currency':!![]}}),database_1['default']['payment']['findMany']({'where':{'gateway':{'not':_0x213b48(0x2e7)}},'take':0xa,'orderBy':{'createdAt':_0x213b48(0x1e3)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x213b48(0x272)][_0x213b48(0x22e)][_0x213b48(0x29d)]({'where':{'createdAt':{'gte':_0x107369},'gateway':{'not':_0x213b48(0x2e7)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x1c64ff=0x0;for(const _0x2d9491 of _0x580d9e){const _0x5815f1=await currencyService_1[_0x213b48(0x249)][_0x213b48(0x283)](_0x2d9491[_0x213b48(0x2d9)],_0x2d9491['currency']);_0x1c64ff+=_0x5815f1;}const _0x5eb41d=this[_0x213b48(0x2ed)](_0x4843ed,_0x107369,_0x1e49b5),_0x411dba=_0x1049c8>0x0?_0x1f574c/_0x1049c8*0x64:0x0;return{'totalShops':_0x3ad2d7,'activeShops':_0x352e99,'totalPayments':_0x1049c8,'successfulPayments':_0x1f574c,'totalRevenue':Math[_0x213b48(0x23f)](_0x1c64ff*0x64)/0x64,'conversionRate':Math[_0x213b48(0x23f)](_0x411dba*0x64)/0x64,'dailyRevenue':_0x5eb41d[_0x213b48(0x2f3)],'dailyPayments':_0x5eb41d['dailyPayments'],'recentPayments':_0x1e79b5[_0x213b48(0x208)](_0x72c5fb=>({'id':_0x72c5fb['id'],'amount':_0x72c5fb[_0x213b48(0x2d9)],'currency':_0x72c5fb[_0x213b48(0x1d0)],'status':_0x72c5fb[_0x213b48(0x24d)],'gateway':_0x72c5fb[_0x213b48(0x289)],'shop':_0x72c5fb[_0x213b48(0x2cf)],'createdAt':_0x72c5fb[_0x213b48(0x2ad)]}))};}async[a35_0x402199(0x2bd)](_0xa47a0e){const _0x398fd7=a35_0x402199;console[_0x398fd7(0x2ef)](_0x398fd7(0x2b4),_0xa47a0e);let _0x27004b,_0x56db26=new Date();if(_0xa47a0e['period']==='custom'&&_0xa47a0e[_0x398fd7(0x27b)]&&_0xa47a0e[_0x398fd7(0x25a)])_0x27004b=new Date(_0xa47a0e[_0x398fd7(0x27b)]),_0x56db26=new Date(_0xa47a0e[_0x398fd7(0x25a)]);else{const _0x2772f5=new Date();switch(_0xa47a0e[_0x398fd7(0x271)]){case'week':_0x27004b=new Date(_0x2772f5['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'month':_0x27004b=new Date(_0x2772f5[_0x398fd7(0x1fe)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'year':_0x27004b=new Date(_0x2772f5[_0x398fd7(0x1fe)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x398fd7(0x2bb):default:_0x27004b=new Date(_0x398fd7(0x299));break;}}console['log'](_0x398fd7(0x1fc)+_0x27004b[_0x398fd7(0x1ef)]()+_0x398fd7(0x2c0)+_0x56db26[_0x398fd7(0x1ef)]());const _0x33f859={'status':'PAID','gateway':{'not':_0x398fd7(0x2e7)},'paidAt':{'gte':_0x27004b,'lte':_0x56db26}};_0xa47a0e[_0x398fd7(0x244)]&&(_0x33f859[_0x398fd7(0x244)]=_0xa47a0e[_0x398fd7(0x244)]);const _0x3b757d=await database_1['default'][_0x398fd7(0x22e)][_0x398fd7(0x29d)]({'where':_0x33f859,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console['log'](_0x398fd7(0x212)+_0x3b757d['length']+_0x398fd7(0x229));const _0x346a14={'gateway':{'not':_0x398fd7(0x2e7)},'createdAt':{'gte':_0x27004b,'lte':_0x56db26}};_0xa47a0e[_0x398fd7(0x244)]&&(_0x346a14[_0x398fd7(0x244)]=_0xa47a0e[_0x398fd7(0x244)]);const _0x5161ff=await database_1['default'][_0x398fd7(0x22e)][_0x398fd7(0x243)]({'where':_0x346a14});console[_0x398fd7(0x2ef)]('📊\x20Total\x20payments\x20(including\x20failed):\x20'+_0x5161ff+_0x398fd7(0x1f4)+_0x3b757d[_0x398fd7(0x2c4)]);let _0x160f3b=0x0,_0xc6a549=0x0,_0x3c8a13=0x0;const _0x4cfcff={},_0x32516e={},_0x4fda60={};for(const _0x1d24a6 of _0x3b757d){try{const _0x1e10e0=await currencyService_1[_0x398fd7(0x249)]['convertToUSDT'](_0x1d24a6['amount'],_0x1d24a6['currency']);let _0x51008c={};if(_0x1d24a6[_0x398fd7(0x2cf)]['gatewaySettings'])try{_0x51008c=JSON[_0x398fd7(0x29a)](_0x1d24a6[_0x398fd7(0x2cf)]['gatewaySettings']);}catch(_0x4b7d45){console[_0x398fd7(0x2af)](_0x398fd7(0x2b7)+_0x1d24a6[_0x398fd7(0x244)]+':',_0x4b7d45);}let _0x2bd6ca={},_0x1c4d04=0xa;for(const [_0x874702,_0x41be5b]of Object[_0x398fd7(0x253)](_0x51008c)){if(_0x874702['toLowerCase']()===_0x1d24a6[_0x398fd7(0x289)]['toLowerCase']()){_0x2bd6ca=_0x41be5b,_0x1c4d04=_0x41be5b['commission']||0xa;break;}}const _0x5b8867=_0x1e10e0*(_0x1c4d04/0x64),_0x11e11f=_0x1e10e0-_0x5b8867;_0x160f3b+=_0x1e10e0,_0xc6a549+=_0x11e11f,_0x3c8a13+=_0x5b8867;!_0x4cfcff[_0x1d24a6['gateway']]&&(_0x4cfcff[_0x1d24a6[_0x398fd7(0x289)]]={'gateway':_0x1d24a6['gateway'],'gatewayDisplayName':this[_0x398fd7(0x2f2)](_0x1d24a6[_0x398fd7(0x289)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x4cfcff[_0x1d24a6['gateway']][_0x398fd7(0x261)]++,_0x4cfcff[_0x1d24a6[_0x398fd7(0x289)]]['turnoverUSDT']+=_0x1e10e0,_0x4cfcff[_0x1d24a6[_0x398fd7(0x289)]][_0x398fd7(0x1e0)]+=_0x5b8867,_0x4cfcff[_0x1d24a6[_0x398fd7(0x289)]][_0x398fd7(0x2a3)]+=_0x11e11f,_0x4cfcff[_0x1d24a6[_0x398fd7(0x289)]][_0x398fd7(0x259)]+=_0x1c4d04;!_0xa47a0e[_0x398fd7(0x244)]&&(!_0x32516e[_0x1d24a6['shopId']]&&(_0x32516e[_0x1d24a6[_0x398fd7(0x244)]]={'shopId':_0x1d24a6[_0x398fd7(0x244)],'shopName':_0x1d24a6['shop'][_0x398fd7(0x1ea)],'shopUsername':_0x1d24a6[_0x398fd7(0x2cf)][_0x398fd7(0x2dc)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x32516e[_0x1d24a6[_0x398fd7(0x244)]]['paymentsCount']++,_0x32516e[_0x1d24a6[_0x398fd7(0x244)]][_0x398fd7(0x2e2)]+=_0x1e10e0,_0x32516e[_0x1d24a6['shopId']][_0x398fd7(0x1e0)]+=_0x5b8867,_0x32516e[_0x1d24a6[_0x398fd7(0x244)]][_0x398fd7(0x2a3)]+=_0x11e11f);const _0x512122=_0x1d24a6[_0x398fd7(0x2a8)][_0x398fd7(0x1ef)]()[_0x398fd7(0x1f0)]('T')[0x0];!_0x4fda60[_0x512122]&&(_0x4fda60[_0x512122]={'date':_0x512122,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x4fda60[_0x512122]['turnover']+=_0x1e10e0,_0x4fda60[_0x512122][_0x398fd7(0x29f)]+=_0x11e11f,_0x4fda60[_0x512122]['gatewayEarnings']+=_0x5b8867,_0x4fda60[_0x512122][_0x398fd7(0x261)]++;}catch(_0x3f331d){console[_0x398fd7(0x2af)](_0x398fd7(0x1e7)+_0x1d24a6['id']+':',_0x3f331d);}}Object[_0x398fd7(0x2e1)](_0x4cfcff)[_0x398fd7(0x2b6)](_0x44c329=>{const _0x208a98=_0x398fd7;_0x44c329[_0x208a98(0x203)]=_0x44c329[_0x208a98(0x261)]>0x0?_0x44c329[_0x208a98(0x259)]/_0x44c329[_0x208a98(0x261)]:0x0,delete _0x44c329[_0x208a98(0x259)];}),Object[_0x398fd7(0x2e1)](_0x32516e)[_0x398fd7(0x2b6)](_0x5d34d2=>{const _0xe31efc=_0x398fd7;_0x5d34d2[_0xe31efc(0x2b3)]=_0x5d34d2[_0xe31efc(0x261)]>0x0?_0x5d34d2[_0xe31efc(0x2e2)]/_0x5d34d2[_0xe31efc(0x261)]:0x0;});let _0x2668cd=0x0;if(_0xa47a0e['shopId']){const _0x577935=await database_1[_0x398fd7(0x272)][_0x398fd7(0x273)][_0x398fd7(0x29d)]({'where':{'shopId':_0xa47a0e[_0x398fd7(0x244)],'status':_0x398fd7(0x25b),'createdAt':{'gte':_0x27004b,'lte':_0x56db26}},'select':{'amount':!![]}});_0x2668cd=_0x577935[_0x398fd7(0x266)]((_0x1be46e,_0x2cf465)=>_0x1be46e+_0x2cf465['amount'],0x0);}const _0xc50129=_0x5161ff,_0x3072a8=_0x3b757d[_0x398fd7(0x2c4)],_0x2246da=_0x3072a8>0x0?_0x160f3b/_0x3072a8:0x0,_0x39604d=_0xc50129>0x0?Math[_0x398fd7(0x23f)](_0x3072a8/_0xc50129*0x2710)/0x64:0x0,_0x5969ac=Math[_0x398fd7(0x2eb)]((_0x56db26[_0x398fd7(0x1fe)]()-_0x27004b[_0x398fd7(0x1fe)]())/(0x3e8*0x3c*0x3c*0x18)),_0x35298a={'totalTurnover':Math[_0x398fd7(0x23f)](_0x160f3b*0x64)/0x64,'merchantEarnings':Math[_0x398fd7(0x23f)](_0xc6a549*0x64)/0x64,'gatewayEarnings':Math[_0x398fd7(0x23f)](_0x3c8a13*0x64)/0x64,'totalPaidOut':Math[_0x398fd7(0x23f)](_0x2668cd*0x64)/0x64,'averageCheck':Math[_0x398fd7(0x23f)](_0x2246da*0x64)/0x64,'totalPayments':_0xc50129,'successfulPayments':_0x3072a8,'conversionRate':_0x39604d,'gatewayBreakdown':Object[_0x398fd7(0x2e1)](_0x4cfcff)[_0x398fd7(0x208)](_0x68f7e2=>({..._0x68f7e2,'turnoverUSDT':Math[_0x398fd7(0x23f)](_0x68f7e2[_0x398fd7(0x2e2)]*0x64)/0x64,'commissionUSDT':Math[_0x398fd7(0x23f)](_0x68f7e2[_0x398fd7(0x1e0)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x398fd7(0x23f)](_0x68f7e2[_0x398fd7(0x2a3)]*0x64)/0x64,'averageCommissionRate':Math[_0x398fd7(0x23f)](_0x68f7e2['averageCommissionRate']*0x64)/0x64})),'merchantBreakdown':_0xa47a0e[_0x398fd7(0x244)]?undefined:Object[_0x398fd7(0x2e1)](_0x32516e)[_0x398fd7(0x208)](_0x51e1ea=>({..._0x51e1ea,'turnoverUSDT':Math[_0x398fd7(0x23f)](_0x51e1ea[_0x398fd7(0x2e2)]*0x64)/0x64,'commissionUSDT':Math[_0x398fd7(0x23f)](_0x51e1ea['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x398fd7(0x23f)](_0x51e1ea['merchantEarningsUSDT']*0x64)/0x64,'paidOutUSDT':Math[_0x398fd7(0x23f)](_0x51e1ea[_0x398fd7(0x2b2)]*0x64)/0x64,'averageCheckUSDT':Math[_0x398fd7(0x23f)](_0x51e1ea['averageCheckUSDT']*0x64)/0x64})),'dailyData':Object['values'](_0x4fda60)['map'](_0x4654e3=>({..._0x4654e3,'turnover':Math[_0x398fd7(0x23f)](_0x4654e3[_0x398fd7(0x2b5)]*0x64)/0x64,'merchantEarnings':Math['round'](_0x4654e3[_0x398fd7(0x29f)]*0x64)/0x64,'gatewayEarnings':Math['round'](_0x4654e3['gatewayEarnings']*0x64)/0x64}))[_0x398fd7(0x1e6)]((_0x466cfe,_0x2cacc7)=>_0x466cfe[_0x398fd7(0x23e)][_0x398fd7(0x2c1)](_0x2cacc7[_0x398fd7(0x23e)])),'periodInfo':{'from':_0x27004b,'to':_0x56db26,'periodType':_0xa47a0e[_0x398fd7(0x271)]||'custom','daysCount':_0x5969ac}};return console[_0x398fd7(0x2ef)](_0x398fd7(0x1ee)),console[_0x398fd7(0x2ef)](_0x398fd7(0x2cc)+_0x35298a[_0x398fd7(0x277)]+'\x20USDT'),console[_0x398fd7(0x2ef)](_0x398fd7(0x24a)+_0x35298a[_0x398fd7(0x29f)]+_0x398fd7(0x227)),console[_0x398fd7(0x2ef)](_0x398fd7(0x20b)+_0x35298a[_0x398fd7(0x23b)]+'\x20USDT'),console['log'](_0x398fd7(0x23c)+_0x35298a[_0x398fd7(0x2b9)]),_0x35298a;}async[a35_0x402199(0x2ee)](){const _0x3789dc=a35_0x402199;console[_0x3789dc(0x2ef)](_0x3789dc(0x207));const _0x43fd49=await database_1[_0x3789dc(0x272)][_0x3789dc(0x2cf)][_0x3789dc(0x29d)]({'where':{'status':_0x3789dc(0x216)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x3789dc(0x206)}});return console[_0x3789dc(0x2ef)](_0x3789dc(0x254)+_0x43fd49[_0x3789dc(0x2c4)]+'\x20active\x20merchants\x20for\x20selection'),_0x43fd49[_0x3789dc(0x208)](_0x41f5e6=>({'id':_0x41f5e6['id'],'username':_0x41f5e6[_0x3789dc(0x2dc)],'name':_0x41f5e6[_0x3789dc(0x1ea)]}));}[a35_0x402199(0x2f2)](_0xa45526){const _0x77527d=a35_0x402199,_0x1a3995={'test_gateway':_0x77527d(0x22a),'plisio':_0x77527d(0x1d1),'rapyd':_0x77527d(0x27d),'noda':_0x77527d(0x21e),'cointopay':_0x77527d(0x2e9),'cointopay2':_0x77527d(0x1fa),'klyme_eu':_0x77527d(0x25f),'klyme_gb':_0x77527d(0x290),'klyme_de':_0x77527d(0x218),'mastercard':_0x77527d(0x268)};return _0x1a3995[_0xa45526]||_0xa45526;}[a35_0x402199(0x24b)](_0x3701f7){const _0x5bf363=a35_0x402199,_0x270548={'Test\x20Gateway':'test_gateway','Plisio':_0x5bf363(0x21c),'Rapyd':'rapyd','Noda':'noda','CoinToPay':_0x5bf363(0x2db),'CoinToPay2':_0x5bf363(0x2e6),'KLYME\x20EU':_0x5bf363(0x225),'KLYME\x20GB':'klyme_gb','KLYME\x20DE':_0x5bf363(0x242),'MasterCard':'mastercard'};return _0x270548[_0x3701f7]||_0x3701f7[_0x5bf363(0x265)]();}async[a35_0x402199(0x28f)](_0x1ddee4){const _0x2456e1=a35_0x402199,{page:_0x10ee56,limit:_0x668837,minAmount:_0x49b035,search:_0x15110c}=_0x1ddee4,_0x31f290=(_0x10ee56-0x1)*_0x668837;console[_0x2456e1(0x2ef)]('📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:',_0x1ddee4);const _0x1e0c2e={'balance':{'gt':0x0},'status':_0x2456e1(0x216)};_0x49b035&&(_0x1e0c2e['balance'][_0x2456e1(0x29e)]=_0x49b035);_0x15110c&&(_0x1e0c2e['OR']=[{'name':{'contains':_0x15110c,'mode':_0x2456e1(0x228)}},{'username':{'contains':_0x15110c,'mode':_0x2456e1(0x228)}}]);const [_0x21a879,_0x2b47bf]=await Promise[_0x2456e1(0x2bb)]([database_1[_0x2456e1(0x272)][_0x2456e1(0x2cf)][_0x2456e1(0x29d)]({'where':_0x1e0c2e,'skip':_0x31f290,'take':_0x668837,'orderBy':{'balance':_0x2456e1(0x1e3)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1[_0x2456e1(0x272)]['shop'][_0x2456e1(0x243)]({'where':_0x1e0c2e})]);console[_0x2456e1(0x2ef)](_0x2456e1(0x212)+_0x21a879['length']+_0x2456e1(0x239));const _0x296bd5=await Promise['all'](_0x21a879[_0x2456e1(0x208)](async _0x3f0c22=>{const _0x24c9ef=_0x2456e1,[_0xfdf96e,_0x5d5381,_0x9dfcf4]=await Promise['all']([database_1['default'][_0x24c9ef(0x22e)]['count']({'where':{'shopId':_0x3f0c22['id'],'status':_0x24c9ef(0x25d),'gateway':{'not':_0x24c9ef(0x2e7)}}}),database_1[_0x24c9ef(0x272)]['payment'][_0x24c9ef(0x23a)]({'where':{'shopId':_0x3f0c22['id'],'status':'PAID','gateway':{'not':_0x24c9ef(0x2e7)}},'orderBy':{'paidAt':_0x24c9ef(0x206)},'select':{'paidAt':!![]}}),database_1[_0x24c9ef(0x272)][_0x24c9ef(0x22e)][_0x24c9ef(0x220)]({'by':[_0x24c9ef(0x289)],'where':{'shopId':_0x3f0c22['id'],'status':_0x24c9ef(0x25d),'gateway':{'not':'test_gateway'}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x301aee=new Date(),_0x236640=new Date(_0x301aee[_0x24c9ef(0x21b)](),_0x301aee['getMonth'](),0x1),_0x443646=new Date(_0x301aee[_0x24c9ef(0x21b)](),_0x301aee[_0x24c9ef(0x2a7)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x20f0cf,_0x40708e]=await Promise['all']([database_1[_0x24c9ef(0x272)][_0x24c9ef(0x273)]['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x3f0c22['id'],'status':_0x24c9ef(0x25b)}}),database_1[_0x24c9ef(0x272)][_0x24c9ef(0x273)]['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x3f0c22['id'],'status':_0x24c9ef(0x25b),'createdAt':{'gte':_0x236640,'lte':_0x443646}}})]),_0x5a1ba8=_0x20f0cf[_0x24c9ef(0x296)]['amount']||0x0,_0x5a810e=_0x40708e[_0x24c9ef(0x296)]['amount']||0x0,_0x51f086=await Promise[_0x24c9ef(0x2bb)](_0x9dfcf4[_0x24c9ef(0x208)](async _0x53ccb=>{const _0x484c3a=_0x24c9ef;let _0x26a1ad=0xa;if(_0x3f0c22[_0x484c3a(0x28e)])try{const _0x3044b4=JSON['parse'](_0x3f0c22[_0x484c3a(0x28e)]);for(const [_0x227900,_0x55c284]of Object[_0x484c3a(0x253)](_0x3044b4)){if(_0x227900[_0x484c3a(0x265)]()===_0x53ccb[_0x484c3a(0x289)][_0x484c3a(0x265)]()){_0x26a1ad=_0x55c284[_0x484c3a(0x27e)]||0xa,console[_0x484c3a(0x2ef)](_0x484c3a(0x2c3)+_0x53ccb['gateway']+_0x484c3a(0x1fb)+_0x3f0c22['id']+_0x484c3a(0x2b1)+_0x26a1ad+'%');break;}}}catch(_0x4a1551){console[_0x484c3a(0x2af)](_0x484c3a(0x2b7)+_0x3f0c22['id']+':',_0x4a1551);}const _0xab5b14=_0x53ccb[_0x484c3a(0x296)][_0x484c3a(0x278)]||0x0,_0x34c976=_0xab5b14*(0x1-_0x26a1ad/0x64);return{'gateway':_0x53ccb[_0x484c3a(0x289)],'count':_0x53ccb[_0x484c3a(0x1de)]['id'],'amountUSDT':Math[_0x484c3a(0x23f)](_0xab5b14*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x484c3a(0x23f)](_0x34c976*0x64)/0x64,'commission':_0x26a1ad};})),_0x100849=_0x51f086['reduce']((_0x5a9f07,_0x38b285)=>_0x5a9f07+_0x38b285[_0x24c9ef(0x278)],0x0),_0x338215=_0x3f0c22[_0x24c9ef(0x26d)];return console[_0x24c9ef(0x2ef)](_0x24c9ef(0x282)+_0x3f0c22[_0x24c9ef(0x2dc)]+':'),console['log'](_0x24c9ef(0x233)+_0x100849[_0x24c9ef(0x1d7)](0x2)+_0x24c9ef(0x1e8)),console[_0x24c9ef(0x2ef)](_0x24c9ef(0x223)+_0x51f086[_0x24c9ef(0x266)]((_0x5b21e5,_0x42cf0a)=>_0x5b21e5+_0x42cf0a[_0x24c9ef(0x2f6)],0x0)['toFixed'](0x2)+'\x20USDT\x20(theoretical\x20net)'),console[_0x24c9ef(0x2ef)](_0x24c9ef(0x2e4)+_0x338215[_0x24c9ef(0x1d7)](0x2)+_0x24c9ef(0x24c)),{'id':_0x3f0c22['id'],'fullName':_0x3f0c22[_0x24c9ef(0x1ea)],'username':_0x3f0c22[_0x24c9ef(0x2dc)],'telegramId':_0x3f0c22[_0x24c9ef(0x2ea)],'merchantUrl':_0x3f0c22[_0x24c9ef(0x2f4)],'wallets':{'usdtPolygonWallet':_0x3f0c22[_0x24c9ef(0x2c8)],'usdtTrcWallet':_0x3f0c22[_0x24c9ef(0x2b0)],'usdtErcWallet':_0x3f0c22[_0x24c9ef(0x1ec)],'usdcPolygonWallet':_0x3f0c22[_0x24c9ef(0x1f6)]},'totalAmountUSDT':Math[_0x24c9ef(0x23f)](_0x100849*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x338215*0x64)/0x64,'totalPayout':Math[_0x24c9ef(0x23f)](_0x5a1ba8*0x64)/0x64,'thisMonth':Math['round'](_0x5a810e*0x64)/0x64,'paymentsCount':_0xfdf96e,'oldestPaymentDate':_0x5d5381?.[_0x24c9ef(0x2a8)]||_0x3f0c22[_0x24c9ef(0x2ad)],'gatewayBreakdown':_0x51f086};})),_0xb0205e=_0x296bd5[_0x2456e1(0x266)]((_0x1e72fb,_0x27f75d)=>_0x1e72fb+_0x27f75d[_0x2456e1(0x291)],0x0),_0x57b791=_0x296bd5[_0x2456e1(0x266)]((_0x36e6cd,_0x28d7ef)=>_0x36e6cd+_0x28d7ef[_0x2456e1(0x2da)],0x0),_0x43e6ff=_0x296bd5[_0x2456e1(0x266)]((_0x11e092,_0x1e019c)=>_0x11e092+_0x1e019c[_0x2456e1(0x221)],0x0),_0x29a776=_0x296bd5[_0x2456e1(0x266)]((_0x3ab666,_0xa059fc)=>_0x3ab666+_0xa059fc[_0x2456e1(0x2df)],0x0);return console[_0x2456e1(0x2ef)](_0x2456e1(0x209)+_0x2b47bf+_0x2456e1(0x236)),console['log'](_0x2456e1(0x2be)+Math['round'](_0xb0205e*0x64)/0x64+_0x2456e1(0x1e8)),console[_0x2456e1(0x2ef)](_0x2456e1(0x1dc)+Math[_0x2456e1(0x23f)](_0x57b791*0x64)/0x64+_0x2456e1(0x21d)),console[_0x2456e1(0x2ef)]('\x20\x20\x20💸\x20Total\x20payouts\x20(all\x20time):\x20'+Math[_0x2456e1(0x23f)](_0x43e6ff*0x64)/0x64+_0x2456e1(0x227)),console[_0x2456e1(0x2ef)](_0x2456e1(0x24f)+Math[_0x2456e1(0x23f)](_0x29a776*0x64)/0x64+_0x2456e1(0x227)),{'merchants':_0x296bd5,'pagination':{'page':_0x10ee56,'limit':_0x668837,'total':_0x2b47bf,'totalPages':Math['ceil'](_0x2b47bf/_0x668837)},'summary':{'totalMerchants':_0x2b47bf,'totalAmountUSDT':Math[_0x2456e1(0x23f)](_0xb0205e*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x57b791*0x64)/0x64,'totalPayout':Math[_0x2456e1(0x23f)](_0x43e6ff*0x64)/0x64,'thisMonth':Math[_0x2456e1(0x23f)](_0x29a776*0x64)/0x64}};}async['createPayout'](_0x9eed29){const _0x274213=a35_0x402199,{shopId:_0x123b35,amount:_0x3941ad,network:_0x21dc46,wallet:_0x37761c,notes:_0x49aa9d,txid:_0x429509,periodFrom:_0x55ee8a,periodTo:_0x79cf5}=_0x9eed29,_0x566ff0=await database_1[_0x274213(0x272)][_0x274213(0x2f5)](async _0x483aca=>{const _0x24ed76=_0x274213,_0x43fdb9=await _0x483aca[_0x24ed76(0x2cf)][_0x24ed76(0x1d8)]({'where':{'id':_0x123b35},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x43fdb9)throw new Error('Shop\x20not\x20found');console[_0x24ed76(0x2ef)](_0x24ed76(0x297)+_0x43fdb9[_0x24ed76(0x2dc)]+':'),console[_0x24ed76(0x2ef)](_0x24ed76(0x224)+_0x43fdb9[_0x24ed76(0x26d)][_0x24ed76(0x1d7)](0x6)+'\x20USDT'),console[_0x24ed76(0x2ef)](_0x24ed76(0x1f3)+_0x3941ad['toFixed'](0x6)+_0x24ed76(0x227)),console[_0x24ed76(0x2ef)]('\x20\x20\x20Current\x20total\x20paid\x20out:\x20'+_0x43fdb9[_0x24ed76(0x1e1)]['toFixed'](0x6)+'\x20USDT');if(_0x429509)console[_0x24ed76(0x2ef)]('\x20\x20\x20Transaction\x20hash:\x20'+_0x429509);if(_0x43fdb9[_0x24ed76(0x26d)]<_0x3941ad)throw new Error('Insufficient\x20balance.\x20Available:\x20'+_0x43fdb9[_0x24ed76(0x26d)][_0x24ed76(0x1d7)](0x6)+_0x24ed76(0x20f)+_0x3941ad[_0x24ed76(0x1d7)](0x6)+'\x20USDT');let _0x5e8b6f=_0x37761c;if(!_0x5e8b6f){const _0x180be2=await _0x483aca[_0x24ed76(0x2cf)][_0x24ed76(0x1d8)]({'where':{'id':_0x123b35},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x180be2)switch(_0x21dc46){case'polygon':_0x5e8b6f=_0x180be2[_0x24ed76(0x2c8)]||undefined;break;case _0x24ed76(0x2bf):_0x5e8b6f=_0x180be2[_0x24ed76(0x2b0)]||undefined;break;case _0x24ed76(0x234):_0x5e8b6f=_0x180be2[_0x24ed76(0x1ec)]||undefined;break;case _0x24ed76(0x2ac):_0x5e8b6f=_0x180be2[_0x24ed76(0x1f6)]||undefined;break;}}console['log']('💳\x20Payout\x20wallet\x20for\x20'+_0x21dc46+':\x20'+(_0x5e8b6f||'not\x20specified'));const _0x120274=await _0x483aca[_0x24ed76(0x273)][_0x24ed76(0x257)]({'data':{'shopId':_0x123b35,'amount':_0x3941ad,'network':_0x21dc46,'status':_0x24ed76(0x25b),'txid':_0x429509,'notes':_0x49aa9d,'periodFrom':_0x55ee8a?new Date(_0x55ee8a):null,'periodTo':_0x79cf5?new Date(_0x79cf5):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x5a1896=_0x43fdb9[_0x24ed76(0x26d)]-_0x3941ad,_0x3ce029=_0x43fdb9[_0x24ed76(0x1e1)]+_0x3941ad;return await _0x483aca[_0x24ed76(0x2cf)][_0x24ed76(0x2de)]({'where':{'id':_0x123b35},'data':{'balance':_0x5a1896,'totalPaidOut':_0x3ce029}}),console['log'](_0x24ed76(0x202)+_0x43fdb9[_0x24ed76(0x2dc)]+_0x24ed76(0x2ba)),console[_0x24ed76(0x2ef)](_0x24ed76(0x286)+_0x43fdb9[_0x24ed76(0x26d)]['toFixed'](0x6)+'\x20->\x20'+_0x5a1896[_0x24ed76(0x1d7)](0x6)+'\x20USDT\x20(-'+_0x3941ad['toFixed'](0x6)+')'),console[_0x24ed76(0x2ef)](_0x24ed76(0x28c)+_0x43fdb9[_0x24ed76(0x1e1)][_0x24ed76(0x1d7)](0x6)+_0x24ed76(0x21a)+_0x3ce029['toFixed'](0x6)+_0x24ed76(0x287)+_0x3941ad[_0x24ed76(0x1d7)](0x6)+')'),{'payout':_0x120274,'shop':_0x43fdb9};});return console[_0x274213(0x2ef)](_0x274213(0x1fd)+_0x566ff0[_0x274213(0x273)]['id']+_0x274213(0x1fb)+_0x566ff0['shop'][_0x274213(0x2dc)]+'\x20('+_0x3941ad+_0x274213(0x288)),{'id':_0x566ff0[_0x274213(0x273)]['id'],'shopId':_0x566ff0[_0x274213(0x273)][_0x274213(0x244)],'shopName':_0x566ff0[_0x274213(0x2cf)][_0x274213(0x1ea)],'shopUsername':_0x566ff0[_0x274213(0x2cf)]['username'],'amount':_0x566ff0[_0x274213(0x273)][_0x274213(0x2d9)],'network':_0x566ff0[_0x274213(0x273)][_0x274213(0x1e5)],'status':_0x566ff0['payout'][_0x274213(0x24d)],'txid':_0x566ff0[_0x274213(0x273)][_0x274213(0x2a9)],'notes':_0x566ff0[_0x274213(0x273)]['notes'],'periodFrom':_0x566ff0['payout'][_0x274213(0x2d0)],'periodTo':_0x566ff0[_0x274213(0x273)][_0x274213(0x276)],'createdAt':_0x566ff0[_0x274213(0x273)][_0x274213(0x2ad)],'paidAt':_0x566ff0[_0x274213(0x273)][_0x274213(0x2a8)]};}async[a35_0x402199(0x25e)](_0x2e5815){const _0x22155f=a35_0x402199,{page:_0x11437d,limit:_0x109027,shopId:_0x2fa05e,network:_0x1687ab,dateFrom:_0x10756d,dateTo:_0x44c060,search:_0x559f8b}=_0x2e5815,_0x2fb34a=(_0x11437d-0x1)*_0x109027,_0x2f3d32={};_0x2fa05e&&(_0x2f3d32[_0x22155f(0x244)]=_0x2fa05e);_0x1687ab&&(_0x2f3d32[_0x22155f(0x1e5)]=_0x1687ab);(_0x10756d||_0x44c060)&&(_0x2f3d32[_0x22155f(0x2ad)]={},_0x10756d&&(_0x2f3d32[_0x22155f(0x2ad)][_0x22155f(0x29e)]=new Date(_0x10756d)),_0x44c060&&(_0x2f3d32[_0x22155f(0x2ad)]['lte']=new Date(_0x44c060)));_0x559f8b&&(_0x2f3d32['OR']=[{'shop':{'name':{'contains':_0x559f8b,'mode':_0x22155f(0x228)}}},{'shop':{'username':{'contains':_0x559f8b,'mode':_0x22155f(0x228)}}},{'notes':{'contains':_0x559f8b,'mode':'insensitive'}}]);const [_0x3b19bb,_0x3ec165]=await Promise['all']([database_1[_0x22155f(0x272)][_0x22155f(0x273)][_0x22155f(0x29d)]({'where':_0x2f3d32,'skip':_0x2fb34a,'take':_0x109027,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x22155f(0x272)][_0x22155f(0x273)][_0x22155f(0x243)]({'where':_0x2f3d32})]);return{'payouts':_0x3b19bb[_0x22155f(0x208)](_0x338d8d=>({'id':_0x338d8d['id'],'shopId':_0x338d8d[_0x22155f(0x244)],'shopName':_0x338d8d[_0x22155f(0x2cf)][_0x22155f(0x1ea)],'shopUsername':_0x338d8d[_0x22155f(0x2cf)][_0x22155f(0x2dc)],'amount':_0x338d8d[_0x22155f(0x2d9)],'network':_0x338d8d[_0x22155f(0x1e5)],'status':_0x338d8d[_0x22155f(0x24d)],'txid':_0x338d8d[_0x22155f(0x2a9)],'notes':_0x338d8d['notes'],'periodFrom':_0x338d8d[_0x22155f(0x2d0)],'periodTo':_0x338d8d[_0x22155f(0x276)],'createdAt':_0x338d8d[_0x22155f(0x2ad)],'paidAt':_0x338d8d[_0x22155f(0x2a8)]})),'pagination':{'page':_0x11437d,'limit':_0x109027,'total':_0x3ec165,'totalPages':Math[_0x22155f(0x2eb)](_0x3ec165/_0x109027)}};}async[a35_0x402199(0x29c)](_0x2de7cb){const _0x2eab49=a35_0x402199,_0x3d1a3d=await database_1[_0x2eab49(0x272)][_0x2eab49(0x273)][_0x2eab49(0x1d8)]({'where':{'id':_0x2de7cb},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x3d1a3d)return null;return{'id':_0x3d1a3d['id'],'shopId':_0x3d1a3d[_0x2eab49(0x244)],'shopName':_0x3d1a3d['shop'][_0x2eab49(0x1ea)],'shopUsername':_0x3d1a3d[_0x2eab49(0x2cf)]['username'],'amount':_0x3d1a3d[_0x2eab49(0x2d9)],'network':_0x3d1a3d['network'],'status':_0x3d1a3d['status'],'txid':_0x3d1a3d[_0x2eab49(0x2a9)],'notes':_0x3d1a3d[_0x2eab49(0x214)],'periodFrom':_0x3d1a3d[_0x2eab49(0x2d0)],'periodTo':_0x3d1a3d[_0x2eab49(0x276)],'createdAt':_0x3d1a3d['createdAt'],'paidAt':_0x3d1a3d[_0x2eab49(0x2a8)]};}async[a35_0x402199(0x25c)](_0x3ba0aa){const _0x498c43=a35_0x402199;await database_1[_0x498c43(0x272)][_0x498c43(0x273)][_0x498c43(0x1e4)]({'where':{'id':_0x3ba0aa}});}async[a35_0x402199(0x2c7)](_0x544a1c){const _0x18bddb=a35_0x402199,{page:_0x17ea22,limit:_0x168bcf,status:_0x4e9007,gateway:_0x3b3617,shopId:_0x4450dc,dateFrom:_0x283785,dateTo:_0x4e53ba,search:_0x5eab30,currency:_0xd1aa27,sortBy:_0x31aece,sortOrder:_0x11cf44}=_0x544a1c,_0x4fbf65=(_0x17ea22-0x1)*_0x168bcf;console[_0x18bddb(0x2ef)]('📊\x20Getting\x20payments\x20with\x20filters:',_0x544a1c);const _0x1e7134=await database_1['default'][_0x18bddb(0x22e)]['groupBy']({'by':[_0x18bddb(0x289)],'_count':{'gateway':!![]}});console[_0x18bddb(0x2ef)](_0x18bddb(0x215),_0x1e7134[_0x18bddb(0x208)](_0x5b0cd1=>_0x5b0cd1[_0x18bddb(0x289)]+'\x20('+_0x5b0cd1[_0x18bddb(0x1de)][_0x18bddb(0x289)]+_0x18bddb(0x205)));if(_0x3b3617){const _0x186c9e=_0x1e7134[_0x18bddb(0x2d8)](_0x367da4=>_0x367da4[_0x18bddb(0x289)][_0x18bddb(0x265)]()===_0x3b3617['toLowerCase']());!_0x186c9e&&_0x3b3617[_0x18bddb(0x265)]()!==_0x18bddb(0x2e7)&&console[_0x18bddb(0x2ef)]('⚠️\x20Requested\x20gateway\x20\x27'+_0x3b3617+_0x18bddb(0x1f9)+_0x1e7134[_0x18bddb(0x208)](_0x285a2f=>_0x285a2f['gateway'])[_0x18bddb(0x1dd)](',\x20'));}const _0x433f43={};_0x4e9007&&(_0x433f43[_0x18bddb(0x24d)]=_0x4e9007['toUpperCase']());if(!_0x3b3617)_0x433f43[_0x18bddb(0x289)]={'not':'test_gateway'};else{if(_0x3b3617&&(_0x3b3617[_0x18bddb(0x265)]()===_0x18bddb(0x2e7)||_0x3b3617==='0000'))_0x433f43[_0x18bddb(0x289)]=_0x18bddb(0x2e7);else{let _0xf61b67=_0x3b3617;const _0x2205d5=(0x0,gateway_1['getGatewayNameById'])(_0x3b3617);if(_0x2205d5)_0xf61b67=_0x2205d5,console[_0x18bddb(0x2ef)](_0x18bddb(0x1d3)+_0x3b3617+'\x27\x20to\x20name\x20\x27'+_0xf61b67+'\x27');else{const _0x1fea1d=(0x0,gateway_1[_0x18bddb(0x2c2)])(_0x3b3617);if(_0x1fea1d){const _0x2d85c1=(0x0,gateway_1[_0x18bddb(0x211)])(_0x1fea1d);_0x2d85c1&&(_0xf61b67=_0x2d85c1,console[_0x18bddb(0x2ef)](_0x18bddb(0x281)+_0x3b3617+_0x18bddb(0x2aa)+_0x1fea1d+'\x27\x20->\x20name\x20\x27'+_0xf61b67+'\x27'));}else console[_0x18bddb(0x2ef)](_0x18bddb(0x247)+_0x3b3617+_0x18bddb(0x2f1));}const _0x43472b=await database_1[_0x18bddb(0x272)][_0x18bddb(0x22e)][_0x18bddb(0x243)]({'where':{'gateway':_0xf61b67[_0x18bddb(0x265)]()},'take':0x1});_0x43472b===0x0?(console[_0x18bddb(0x2ef)](_0x18bddb(0x232)+_0xf61b67+'\x27\x20(from\x20\x27'+_0x3b3617+_0x18bddb(0x1df)),_0x433f43[_0x18bddb(0x289)]='NONEXISTENT_GATEWAY_FILTER'):(_0x433f43[_0x18bddb(0x289)]=_0xf61b67[_0x18bddb(0x265)](),console[_0x18bddb(0x2ef)](_0x18bddb(0x2f0)+_0xf61b67+'\x27\x20(from\x20\x27'+_0x3b3617+'\x27)'));}}console[_0x18bddb(0x2ef)]('📊\x20Gateway\x20filter\x20applied:',_0x433f43['gateway']);_0x4450dc&&(_0x433f43[_0x18bddb(0x244)]=_0x4450dc);_0xd1aa27&&(_0x433f43[_0x18bddb(0x1d0)]=_0xd1aa27['toUpperCase'](),console[_0x18bddb(0x2ef)](_0x18bddb(0x1d9)+_0xd1aa27[_0x18bddb(0x1f2)]()));(_0x283785||_0x4e53ba)&&(_0x433f43[_0x18bddb(0x2ad)]={},_0x283785&&(_0x433f43[_0x18bddb(0x2ad)][_0x18bddb(0x29e)]=new Date(_0x283785)),_0x4e53ba&&(_0x433f43['createdAt'][_0x18bddb(0x275)]=new Date(_0x4e53ba)));_0x5eab30&&(_0x433f43['OR']=[{'id':{'contains':_0x5eab30,'mode':_0x18bddb(0x228)}},{'orderId':{'contains':_0x5eab30,'mode':_0x18bddb(0x228)}},{'gatewayOrderId':{'contains':_0x5eab30,'mode':_0x18bddb(0x228)}},{'customerEmail':{'contains':_0x5eab30,'mode':_0x18bddb(0x228)}},{'shop':{'name':{'contains':_0x5eab30,'mode':_0x18bddb(0x228)}}},{'shop':{'username':{'contains':_0x5eab30,'mode':_0x18bddb(0x228)}}}]);console[_0x18bddb(0x2ef)]('📊\x20Final\x20WHERE\x20conditions:',JSON[_0x18bddb(0x256)](_0x433f43,null,0x2));let _0x2e7662={'createdAt':_0x18bddb(0x1e3)};if(_0x31aece){const _0x4bcc4c=['amount',_0x18bddb(0x2ad),_0x18bddb(0x20e),_0x18bddb(0x24d),_0x18bddb(0x289),_0x18bddb(0x1d0)],_0x414e4f=[_0x18bddb(0x206),_0x18bddb(0x1e3)];if(_0x4bcc4c[_0x18bddb(0x26f)](_0x31aece)){const _0xf1d4ec=_0x414e4f[_0x18bddb(0x26f)](_0x11cf44)?_0x11cf44:_0x18bddb(0x1e3);_0x2e7662={[_0x31aece]:_0xf1d4ec},console[_0x18bddb(0x2ef)]('📊\x20Sorting\x20payments\x20by\x20'+_0x31aece+_0x18bddb(0x252)+_0xf1d4ec+'\x20order');}}const [_0x5ac580,_0x5a3304]=await Promise[_0x18bddb(0x2bb)]([database_1[_0x18bddb(0x272)][_0x18bddb(0x22e)][_0x18bddb(0x29d)]({'where':_0x433f43,'skip':_0x4fbf65,'take':_0x168bcf,'orderBy':_0x2e7662,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x18bddb(0x272)]['payment'][_0x18bddb(0x243)]({'where':_0x433f43})]);return{'payments':_0x5ac580,'pagination':{'page':_0x17ea22,'limit':_0x168bcf,'total':_0x5a3304,'totalPages':Math['ceil'](_0x5a3304/_0x168bcf)}};}async[a35_0x402199(0x231)](_0x1e96e7){const _0x222419=a35_0x402199,_0x7e363f=await database_1[_0x222419(0x272)][_0x222419(0x22e)][_0x222419(0x1d8)]({'where':{'id':_0x1e96e7},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x7e363f)return null;return{'id':_0x7e363f['id'],'shopId':_0x7e363f[_0x222419(0x244)],'gateway':_0x7e363f[_0x222419(0x289)],'amount':_0x7e363f[_0x222419(0x2d9)],'currency':_0x7e363f['currency'],'status':_0x7e363f[_0x222419(0x24d)],'orderId':_0x7e363f['orderId'],'gatewayOrderId':_0x7e363f[_0x222419(0x1f5)],'customerEmail':_0x7e363f['customerEmail'],'customerName':_0x7e363f[_0x222419(0x201)],'customerCountry':_0x7e363f[_0x222419(0x20d)],'customerIp':_0x7e363f[_0x222419(0x29b)],'customerUa':_0x7e363f[_0x222419(0x245)],'failureMessage':_0x7e363f[_0x222419(0x226)],'externalPaymentUrl':_0x7e363f[_0x222419(0x204)],'successUrl':_0x7e363f[_0x222419(0x2e0)],'failUrl':_0x7e363f[_0x222419(0x284)],'pendingUrl':_0x7e363f['pendingUrl'],'whiteUrl':_0x7e363f['whiteUrl'],'createdAt':_0x7e363f[_0x222419(0x2ad)],'updatedAt':_0x7e363f[_0x222419(0x20e)],'shop':_0x7e363f[_0x222419(0x2cf)]};}async[a35_0x402199(0x2d4)](_0x6d170,_0x46182d,_0x293404,_0x5d2c88){const _0x22a62f=a35_0x402199,_0x4d877e=await database_1[_0x22a62f(0x272)][_0x22a62f(0x2f5)](async _0x395e94=>{const _0x2b0500=_0x22a62f,_0x41dacb=await _0x395e94['payment'][_0x2b0500(0x1d8)]({'where':{'id':_0x6d170},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x41dacb)throw new Error(_0x2b0500(0x1d4));const _0x15001b=_0x41dacb[_0x2b0500(0x24d)],_0x4b6f64=_0x46182d[_0x2b0500(0x1f2)]();console[_0x2b0500(0x2ef)]('🔄\x20Admin\x20updating\x20payment\x20'+_0x6d170+_0x2b0500(0x2a4)+_0x15001b+'\x20->\x20'+_0x4b6f64),console[_0x2b0500(0x2ef)](_0x2b0500(0x26c)+_0x41dacb[_0x2b0500(0x2cf)][_0x2b0500(0x26d)]+_0x2b0500(0x227));const _0x3e49f6={'status':_0x4b6f64,'updatedAt':new Date(),'statusChangedBy':_0x2b0500(0x26a),'statusChangedAt':new Date()};_0x293404&&(_0x3e49f6[_0x2b0500(0x27f)]=_0x293404);_0x4b6f64===_0x2b0500(0x237)&&_0x5d2c88&&(_0x3e49f6['chargebackAmount']=_0x5d2c88);let _0x2f1a6f=0x0,_0xe19d71=_0x41dacb['shop'][_0x2b0500(0x26d)];if(_0x4b6f64===_0x2b0500(0x25d)&&_0x15001b!=='PAID'){_0x3e49f6['paidAt']=new Date();const _0x50ceab=await currencyService_1[_0x2b0500(0x249)][_0x2b0500(0x283)](_0x41dacb['amount'],_0x41dacb['currency']);_0x3e49f6[_0x2b0500(0x278)]=_0x50ceab;let _0x4fdf23=0xa;const _0x868ce4=await _0x395e94[_0x2b0500(0x2cf)]['findUnique']({'where':{'id':_0x41dacb[_0x2b0500(0x244)]},'select':{'gatewaySettings':!![]}});if(_0x868ce4?.[_0x2b0500(0x28e)])try{const _0x2c7825=JSON[_0x2b0500(0x29a)](_0x868ce4[_0x2b0500(0x28e)]);for(const [_0x5f44d8,_0x3a6252]of Object['entries'](_0x2c7825)){if(_0x5f44d8[_0x2b0500(0x265)]()===_0x41dacb[_0x2b0500(0x289)][_0x2b0500(0x265)]()){_0x4fdf23=_0x3a6252[_0x2b0500(0x27e)]||0xa;break;}}}catch(_0x48398d){console[_0x2b0500(0x2af)]('Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20'+_0x6d170+':',_0x48398d);}const _0x5ecdff=_0x50ceab*(0x1-_0x4fdf23/0x64);_0x2f1a6f=_0x5ecdff,_0xe19d71+=_0x5ecdff,console['log'](_0x2b0500(0x1d5)+_0x6d170+_0x2b0500(0x2a2)),console[_0x2b0500(0x2ef)](_0x2b0500(0x293)+_0x50ceab['toFixed'](0x6)+_0x2b0500(0x227)),console['log'](_0x2b0500(0x2ab)+_0x41dacb[_0x2b0500(0x289)]+',\x20Commission:\x20'+_0x4fdf23+'%'),console[_0x2b0500(0x2ef)]('\x20\x20\x20Merchant\x20gets:\x20'+_0x5ecdff[_0x2b0500(0x1d7)](0x6)+'\x20USDT\x20(after\x20'+_0x4fdf23+'%\x20commission)'),console[_0x2b0500(0x2ef)]('\x20\x20\x20Added\x20to\x20balance:\x20+'+_0x5ecdff[_0x2b0500(0x1d7)](0x6)+'\x20USDT');}else{if(_0x15001b===_0x2b0500(0x25d)&&_0x4b6f64!=='PAID'){if(_0x41dacb[_0x2b0500(0x278)]){let _0x1512f6=0xa;const _0x1d3456=await _0x395e94['shop'][_0x2b0500(0x1d8)]({'where':{'id':_0x41dacb[_0x2b0500(0x244)]},'select':{'gatewaySettings':!![]}});if(_0x1d3456?.[_0x2b0500(0x28e)])try{const _0x167c80=JSON['parse'](_0x1d3456['gatewaySettings']);for(const [_0x4a2ec0,_0x7beb14]of Object[_0x2b0500(0x253)](_0x167c80)){if(_0x4a2ec0['toLowerCase']()===_0x41dacb[_0x2b0500(0x289)][_0x2b0500(0x265)]()){_0x1512f6=_0x7beb14[_0x2b0500(0x27e)]||0xa;break;}}}catch(_0x58b318){console[_0x2b0500(0x2af)](_0x2b0500(0x250)+_0x6d170+':',_0x58b318);}const _0x4931b3=_0x41dacb[_0x2b0500(0x278)]*(0x1-_0x1512f6/0x64);_0x2f1a6f=-_0x4931b3,_0xe19d71-=_0x4931b3,_0x3e49f6[_0x2b0500(0x278)]=null,console[_0x2b0500(0x2ef)](_0x2b0500(0x1d5)+_0x6d170+_0x2b0500(0x1f8)),console['log']('\x20\x20\x20Full\x20amount:\x20'+_0x41dacb['amountUSDT'][_0x2b0500(0x1d7)](0x6)+_0x2b0500(0x227)),console[_0x2b0500(0x2ef)](_0x2b0500(0x2ab)+_0x41dacb[_0x2b0500(0x289)]+_0x2b0500(0x28d)+_0x1512f6+'%'),console['log'](_0x2b0500(0x1ff)+_0x4931b3['toFixed'](0x6)+_0x2b0500(0x295)+_0x1512f6+_0x2b0500(0x22c)),console[_0x2b0500(0x2ef)](_0x2b0500(0x292)+_0x4931b3[_0x2b0500(0x1d7)](0x6)+_0x2b0500(0x227));}}}_0x4b6f64==='CHARGEBACK'&&(_0x15001b===_0x2b0500(0x25d)&&_0x41dacb[_0x2b0500(0x278)]&&console[_0x2b0500(0x2ef)](_0x2b0500(0x28a)),_0x5d2c88&&_0x5d2c88>0x0&&(_0x2f1a6f-=_0x5d2c88,_0xe19d71-=_0x5d2c88,console[_0x2b0500(0x2ef)](_0x2b0500(0x2e8)+_0x5d2c88[_0x2b0500(0x1d7)](0x6)+_0x2b0500(0x255))));_0x4b6f64===_0x2b0500(0x2c9)&&_0x15001b==='PAID'&&console[_0x2b0500(0x2ef)](_0x2b0500(0x2cb));const _0x254520=await _0x395e94[_0x2b0500(0x22e)][_0x2b0500(0x2de)]({'where':{'id':_0x6d170},'data':_0x3e49f6,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x2f1a6f!==0x0&&(await _0x395e94[_0x2b0500(0x2cf)][_0x2b0500(0x2de)]({'where':{'id':_0x41dacb['shopId']},'data':{'balance':_0xe19d71}}),console[_0x2b0500(0x2ef)](_0x2b0500(0x202)+_0x41dacb['shopId']+_0x2b0500(0x2d6)+_0x41dacb[_0x2b0500(0x2cf)][_0x2b0500(0x26d)]['toFixed'](0x6)+_0x2b0500(0x21a)+_0xe19d71[_0x2b0500(0x1d7)](0x6)+_0x2b0500(0x28b)+(_0x2f1a6f>0x0?'+':'')+_0x2f1a6f[_0x2b0500(0x1d7)](0x6)+')')),_0x254520;});return{'id':_0x4d877e['id'],'shopId':_0x4d877e[_0x22a62f(0x244)],'gateway':_0x4d877e[_0x22a62f(0x289)],'amount':_0x4d877e[_0x22a62f(0x2d9)],'currency':_0x4d877e[_0x22a62f(0x1d0)],'status':_0x4d877e[_0x22a62f(0x24d)],'orderId':_0x4d877e[_0x22a62f(0x26b)],'gatewayOrderId':_0x4d877e['gatewayOrderId'],'customerEmail':_0x4d877e['customerEmail'],'customerName':_0x4d877e[_0x22a62f(0x201)],'customerCountry':_0x4d877e['customerCountry'],'customerIp':_0x4d877e[_0x22a62f(0x29b)],'customerUa':_0x4d877e[_0x22a62f(0x245)],'failureMessage':_0x4d877e[_0x22a62f(0x226)],'adminNotes':_0x4d877e[_0x22a62f(0x27f)],'chargebackAmount':_0x4d877e['chargebackAmount'],'statusChangedBy':_0x4d877e[_0x22a62f(0x2d3)],'statusChangedAt':_0x4d877e[_0x22a62f(0x264)],'createdAt':_0x4d877e[_0x22a62f(0x2ad)],'updatedAt':_0x4d877e['updatedAt'],'shop':_0x4d877e['shop']};}async[a35_0x402199(0x251)](_0x2e732e,_0x3beab0){const _0x21db96=a35_0x402199,_0xaaf6b8={..._0x3beab0};_0x3beab0[_0x21db96(0x2ec)]&&(_0xaaf6b8[_0x21db96(0x2ec)]=await bcryptjs_1['default'][_0x21db96(0x2ca)](_0x3beab0[_0x21db96(0x2ec)],0xc));_0x3beab0[_0x21db96(0x27c)]&&(_0xaaf6b8[_0x21db96(0x1ea)]=_0x3beab0[_0x21db96(0x27c)],delete _0xaaf6b8[_0x21db96(0x27c)]);_0x3beab0[_0x21db96(0x22d)]&&(_0xaaf6b8[_0x21db96(0x2ea)]=_0x3beab0[_0x21db96(0x22d)],delete _0xaaf6b8[_0x21db96(0x22d)]);_0x3beab0[_0x21db96(0x279)]&&(_0xaaf6b8[_0x21db96(0x2f4)]=_0x3beab0['merchantUrl'],delete _0xaaf6b8['merchantUrl']);if(_0x3beab0[_0x21db96(0x246)]){const _0x39eb50=_0x3beab0[_0x21db96(0x246)][_0x21db96(0x208)](_0x22e1f8=>this[_0x21db96(0x24b)](_0x22e1f8));console[_0x21db96(0x2ef)](_0x21db96(0x298),_0x3beab0[_0x21db96(0x246)],'->',_0x39eb50),_0xaaf6b8['paymentGateways']=JSON[_0x21db96(0x256)](_0x39eb50),delete _0xaaf6b8[_0x21db96(0x246)];}_0x3beab0[_0x21db96(0x28e)]&&(_0xaaf6b8['gatewaySettings']=JSON[_0x21db96(0x256)](_0x3beab0[_0x21db96(0x28e)]),delete _0xaaf6b8[_0x21db96(0x28e)]);_0x3beab0[_0x21db96(0x2d7)]&&(_0x3beab0[_0x21db96(0x2d7)]['usdtPolygonWallet']!==undefined&&(_0xaaf6b8[_0x21db96(0x2c8)]=_0x3beab0[_0x21db96(0x2d7)]['usdtPolygonWallet']||null),_0x3beab0[_0x21db96(0x2d7)][_0x21db96(0x2b0)]!==undefined&&(_0xaaf6b8[_0x21db96(0x2b0)]=_0x3beab0['wallets'][_0x21db96(0x2b0)]||null),_0x3beab0[_0x21db96(0x2d7)][_0x21db96(0x1ec)]!==undefined&&(_0xaaf6b8[_0x21db96(0x1ec)]=_0x3beab0[_0x21db96(0x2d7)][_0x21db96(0x1ec)]||null),_0x3beab0[_0x21db96(0x2d7)]['usdcPolygonWallet']!==undefined&&(_0xaaf6b8[_0x21db96(0x1f6)]=_0x3beab0[_0x21db96(0x2d7)][_0x21db96(0x1f6)]||null),delete _0xaaf6b8[_0x21db96(0x2d7)]);const _0xbdc0ba=await database_1['default'][_0x21db96(0x2cf)][_0x21db96(0x2de)]({'where':{'id':_0x2e732e},'data':_0xaaf6b8,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0xbdc0ba['id'],'fullName':_0xbdc0ba[_0x21db96(0x1ea)],'username':_0xbdc0ba[_0x21db96(0x2dc)],'telegramId':_0xbdc0ba[_0x21db96(0x2ea)],'merchantUrl':_0xbdc0ba['shopUrl'],'gateways':_0xbdc0ba['paymentGateways']?JSON[_0x21db96(0x29a)](_0xbdc0ba[_0x21db96(0x1e9)]):null,'gatewaySettings':_0xbdc0ba['gatewaySettings']?JSON['parse'](_0xbdc0ba[_0x21db96(0x28e)]):null,'publicKey':_0xbdc0ba['publicKey'],'wallets':{'usdtPolygonWallet':_0xbdc0ba[_0x21db96(0x2c8)],'usdtTrcWallet':_0xbdc0ba['usdtTrcWallet'],'usdtErcWallet':_0xbdc0ba[_0x21db96(0x1ec)],'usdcPolygonWallet':_0xbdc0ba[_0x21db96(0x1f6)]},'status':_0xbdc0ba[_0x21db96(0x24d)],'createdAt':_0xbdc0ba[_0x21db96(0x2ad)]};}async['suspendUser'](_0x402ee2){const _0x2c94c3=a35_0x402199,_0x36dfb8=await database_1[_0x2c94c3(0x272)][_0x2c94c3(0x2cf)][_0x2c94c3(0x2de)]({'where':{'id':_0x402ee2},'data':{'status':_0x2c94c3(0x26e)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x36dfb8['id'],'fullName':_0x36dfb8[_0x2c94c3(0x1ea)],'username':_0x36dfb8[_0x2c94c3(0x2dc)],'telegramId':_0x36dfb8[_0x2c94c3(0x2ea)],'merchantUrl':_0x36dfb8[_0x2c94c3(0x2f4)],'gateways':_0x36dfb8['paymentGateways']?JSON[_0x2c94c3(0x29a)](_0x36dfb8['paymentGateways']):null,'gatewaySettings':_0x36dfb8['gatewaySettings']?JSON['parse'](_0x36dfb8['gatewaySettings']):null,'publicKey':_0x36dfb8[_0x2c94c3(0x2c5)],'wallets':{'usdtPolygonWallet':_0x36dfb8['usdtPolygonWallet'],'usdtTrcWallet':_0x36dfb8['usdtTrcWallet'],'usdtErcWallet':_0x36dfb8[_0x2c94c3(0x1ec)],'usdcPolygonWallet':_0x36dfb8['usdcPolygonWallet']},'status':_0x36dfb8[_0x2c94c3(0x24d)],'createdAt':_0x36dfb8[_0x2c94c3(0x2ad)]};}async[a35_0x402199(0x27a)](_0x51c253){const _0x30c2ef=a35_0x402199,_0x100166=await database_1[_0x30c2ef(0x272)][_0x30c2ef(0x2cf)][_0x30c2ef(0x2de)]({'where':{'id':_0x51c253},'data':{'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x100166['id'],'fullName':_0x100166[_0x30c2ef(0x1ea)],'username':_0x100166[_0x30c2ef(0x2dc)],'telegramId':_0x100166[_0x30c2ef(0x2ea)],'merchantUrl':_0x100166[_0x30c2ef(0x2f4)],'gateways':_0x100166['paymentGateways']?JSON[_0x30c2ef(0x29a)](_0x100166[_0x30c2ef(0x1e9)]):null,'gatewaySettings':_0x100166[_0x30c2ef(0x28e)]?JSON[_0x30c2ef(0x29a)](_0x100166[_0x30c2ef(0x28e)]):null,'publicKey':_0x100166['publicKey'],'wallets':{'usdtPolygonWallet':_0x100166['usdtPolygonWallet'],'usdtTrcWallet':_0x100166[_0x30c2ef(0x2b0)],'usdtErcWallet':_0x100166['usdtErcWallet'],'usdcPolygonWallet':_0x100166['usdcPolygonWallet']},'status':_0x100166['status'],'createdAt':_0x100166[_0x30c2ef(0x2ad)]};}async['getAllUsers'](_0xbb21ed){const _0x3aa184=a35_0x402199,{page:_0xd4bd25,limit:_0x4f66fa,status:_0x2f556c}=_0xbb21ed,_0x46e5a0=(_0xd4bd25-0x1)*_0x4f66fa,_0x1f382b={};_0x2f556c&&(_0x1f382b[_0x3aa184(0x24d)]=_0x2f556c[_0x3aa184(0x1f2)]());const [_0x4ed730,_0x2c92fc]=await Promise[_0x3aa184(0x2bb)]([database_1[_0x3aa184(0x272)][_0x3aa184(0x2cf)][_0x3aa184(0x29d)]({'where':_0x1f382b,'skip':_0x46e5a0,'take':_0x4f66fa,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1['default'][_0x3aa184(0x2cf)][_0x3aa184(0x243)]({'where':_0x1f382b})]);return{'users':_0x4ed730[_0x3aa184(0x208)](_0x4eb111=>{const _0x317353=_0x3aa184,_0x3861a0=_0x4eb111['paymentGateways']?JSON[_0x317353(0x29a)](_0x4eb111['paymentGateways']):null,_0xbba802=_0x3861a0?_0x3861a0[_0x317353(0x208)](_0xca99f7=>this[_0x317353(0x2f2)](_0xca99f7)):null;return{'id':_0x4eb111['id'],'fullName':_0x4eb111[_0x317353(0x1ea)],'username':_0x4eb111[_0x317353(0x2dc)],'telegramId':_0x4eb111[_0x317353(0x2ea)],'merchantUrl':_0x4eb111[_0x317353(0x2f4)],'gateways':_0xbba802,'gatewaySettings':_0x4eb111['gatewaySettings']?JSON[_0x317353(0x29a)](_0x4eb111[_0x317353(0x28e)]):null,'publicKey':_0x4eb111[_0x317353(0x2c5)],'wallets':{'usdtPolygonWallet':_0x4eb111[_0x317353(0x2c8)],'usdtTrcWallet':_0x4eb111['usdtTrcWallet'],'usdtErcWallet':_0x4eb111[_0x317353(0x1ec)],'usdcPolygonWallet':_0x4eb111[_0x317353(0x1f6)]},'status':_0x4eb111[_0x317353(0x24d)],'createdAt':_0x4eb111[_0x317353(0x2ad)]};}),'pagination':{'page':_0xd4bd25,'limit':_0x4f66fa,'total':_0x2c92fc,'totalPages':Math[_0x3aa184(0x2eb)](_0x2c92fc/_0x4f66fa)}};}async[a35_0x402199(0x213)](_0x221263){const _0x512b7e=a35_0x402199,_0x46c801=await database_1[_0x512b7e(0x272)][_0x512b7e(0x2cf)][_0x512b7e(0x1d8)]({'where':{'id':_0x221263},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x46c801)return null;const _0x1f3c0b=_0x46c801[_0x512b7e(0x1e9)]?JSON[_0x512b7e(0x29a)](_0x46c801[_0x512b7e(0x1e9)]):null,_0x590678=_0x1f3c0b?_0x1f3c0b['map'](_0x3fa8be=>this['getGatewayDisplayName'](_0x3fa8be)):null;return _0x1f3c0b&&_0x590678&&console[_0x512b7e(0x2ef)](_0x512b7e(0x2e5),_0x1f3c0b,'->',_0x590678),{'id':_0x46c801['id'],'fullName':_0x46c801['name'],'username':_0x46c801['username'],'telegramId':_0x46c801[_0x512b7e(0x2ea)],'merchantUrl':_0x46c801[_0x512b7e(0x2f4)],'gateways':_0x590678,'gatewaySettings':_0x46c801[_0x512b7e(0x28e)]?JSON[_0x512b7e(0x29a)](_0x46c801[_0x512b7e(0x28e)]):null,'publicKey':_0x46c801[_0x512b7e(0x2c5)],'wallets':{'usdtPolygonWallet':_0x46c801[_0x512b7e(0x2c8)],'usdtTrcWallet':_0x46c801[_0x512b7e(0x2b0)],'usdtErcWallet':_0x46c801[_0x512b7e(0x1ec)],'usdcPolygonWallet':_0x46c801[_0x512b7e(0x1f6)]},'status':_0x46c801[_0x512b7e(0x24d)],'createdAt':_0x46c801[_0x512b7e(0x2ad)]};}async[a35_0x402199(0x22f)](_0x284ac9){const _0x345462=a35_0x402199,{fullName:_0x2ea50b,username:_0x501fc4,password:_0x14136a,telegramId:_0x501e43,merchantUrl:_0x44c99e,gateways:_0x9a333e,gatewaySettings:_0x2c2df1,wallets:_0x101b6c}=_0x284ac9,_0x3e7e3d=await database_1[_0x345462(0x272)][_0x345462(0x2cf)][_0x345462(0x1d8)]({'where':{'username':_0x501fc4}});if(_0x3e7e3d)throw new Error(_0x345462(0x2c6));if(_0x501e43){const _0x7af3d5=await database_1[_0x345462(0x272)]['shop'][_0x345462(0x1d8)]({'where':{'telegram':_0x501e43}});if(_0x7af3d5)throw new Error(_0x345462(0x210));}const _0x3fcebd=await bcryptjs_1[_0x345462(0x272)][_0x345462(0x2ca)](_0x14136a,0xc),_0x4beff1=_0x345462(0x1da)+crypto_1[_0x345462(0x272)]['randomBytes'](0x20)[_0x345462(0x23d)](_0x345462(0x238)),_0x5208f5='sk_'+crypto_1[_0x345462(0x272)][_0x345462(0x2bc)](0x20)[_0x345462(0x23d)](_0x345462(0x238)),_0x1226dd=_0x9a333e?_0x9a333e[_0x345462(0x208)](_0x14bf71=>this['getGatewayInternalName'](_0x14bf71)):null;_0x9a333e&&_0x1226dd&&console[_0x345462(0x2ef)](_0x345462(0x260),_0x9a333e,'->',_0x1226dd);const _0x2e5342=await database_1[_0x345462(0x272)][_0x345462(0x2cf)][_0x345462(0x257)]({'data':{'name':_0x2ea50b,'username':_0x501fc4,'password':_0x3fcebd,'telegram':_0x501e43,'shopUrl':_0x44c99e,'paymentGateways':_0x1226dd?JSON[_0x345462(0x256)](_0x1226dd):null,'gatewaySettings':_0x2c2df1?JSON['stringify'](_0x2c2df1):null,'usdtPolygonWallet':_0x101b6c?.[_0x345462(0x2c8)]||null,'usdtTrcWallet':_0x101b6c?.[_0x345462(0x2b0)]||null,'usdtErcWallet':_0x101b6c?.[_0x345462(0x1ec)]||null,'usdcPolygonWallet':_0x101b6c?.['usdcPolygonWallet']||null,'publicKey':_0x4beff1,'secretKey':_0x5208f5,'status':_0x345462(0x216)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2e5342['id'],'fullName':_0x2e5342[_0x345462(0x1ea)],'username':_0x2e5342[_0x345462(0x2dc)],'telegramId':_0x2e5342[_0x345462(0x2ea)],'merchantUrl':_0x2e5342[_0x345462(0x2f4)],'gateways':_0x2e5342['paymentGateways']?JSON['parse'](_0x2e5342[_0x345462(0x1e9)]):null,'gatewaySettings':_0x2e5342[_0x345462(0x28e)]?JSON['parse'](_0x2e5342[_0x345462(0x28e)]):null,'publicKey':_0x2e5342[_0x345462(0x2c5)],'wallets':{'usdtPolygonWallet':_0x2e5342[_0x345462(0x2c8)],'usdtTrcWallet':_0x2e5342['usdtTrcWallet'],'usdtErcWallet':_0x2e5342[_0x345462(0x1ec)],'usdcPolygonWallet':_0x2e5342[_0x345462(0x1f6)]},'status':_0x2e5342[_0x345462(0x24d)],'createdAt':_0x2e5342[_0x345462(0x2ad)]};}async[a35_0x402199(0x269)](_0x1652e5){const _0x2934aa=a35_0x402199;await database_1[_0x2934aa(0x272)]['shop'][_0x2934aa(0x1e4)]({'where':{'id':_0x1652e5}});}[a35_0x402199(0x2ed)](_0x465ccb,_0x4a5591,_0x515ba2){const _0x34ff8f=a35_0x402199,_0x1bc7e1=new Map(),_0x2ea019=new Date(_0x4a5591);while(_0x2ea019<=_0x515ba2){const _0x221b1a=_0x2ea019['toISOString']()['split']('T')[0x0];_0x1bc7e1['set'](_0x221b1a,{'revenue':0x0,'count':0x0}),_0x2ea019['setDate'](_0x2ea019[_0x34ff8f(0x2a5)]()+0x1);}for(const _0x2e29ed of _0x465ccb){const _0x43aa28=_0x2e29ed[_0x34ff8f(0x2ad)][_0x34ff8f(0x1ef)]()[_0x34ff8f(0x1f0)]('T')[0x0],_0x1ee795=_0x1bc7e1['get'](_0x43aa28);_0x1ee795&&(_0x1ee795[_0x34ff8f(0x243)]+=0x1,_0x2e29ed[_0x34ff8f(0x24d)]===_0x34ff8f(0x25d)&&(_0x2e29ed[_0x34ff8f(0x278)]?_0x1ee795['revenue']+=_0x2e29ed[_0x34ff8f(0x278)]:console[_0x34ff8f(0x2ef)]('⚠️\x20Payment\x20'+_0x2e29ed['id']+_0x34ff8f(0x241))));}const _0x44c66d=[],_0x46386=[];for(const [_0x12a1d0,_0x5f0673]of _0x1bc7e1){_0x44c66d[_0x34ff8f(0x1f7)]({'date':_0x12a1d0,'amount':Math[_0x34ff8f(0x23f)](_0x5f0673[_0x34ff8f(0x263)]*0x64)/0x64}),_0x46386[_0x34ff8f(0x1f7)]({'date':_0x12a1d0,'count':_0x5f0673['count']});}return{'dailyRevenue':_0x44c66d,'dailyPayments':_0x46386};}}exports[a35_0x402199(0x2e3)]=AdminService;