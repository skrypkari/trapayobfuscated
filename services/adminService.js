'use strict';function a53_0x3d45(_0x3cfc47,_0x4afa73){_0x3cfc47=_0x3cfc47-0x1c3;const _0x220aab=a53_0x220a();let _0x3d4528=_0x220aab[_0x3cfc47];return _0x3d4528;}const a53_0xce6f5b=a53_0x3d45;(function(_0xdb6441,_0x511cf7){const _0x5d6ec6=a53_0x3d45,_0x44c999=_0xdb6441();while(!![]){try{const _0x5e9de6=-parseInt(_0x5d6ec6(0x328))/0x1*(-parseInt(_0x5d6ec6(0x2ee))/0x2)+parseInt(_0x5d6ec6(0x1de))/0x3+parseInt(_0x5d6ec6(0x357))/0x4*(parseInt(_0x5d6ec6(0x280))/0x5)+parseInt(_0x5d6ec6(0x28e))/0x6+parseInt(_0x5d6ec6(0x35e))/0x7*(parseInt(_0x5d6ec6(0x31c))/0x8)+-parseInt(_0x5d6ec6(0x31b))/0x9*(-parseInt(_0x5d6ec6(0x224))/0xa)+-parseInt(_0x5d6ec6(0x2d2))/0xb*(parseInt(_0x5d6ec6(0x288))/0xc);if(_0x5e9de6===_0x511cf7)break;else _0x44c999['push'](_0x44c999['shift']());}catch(_0x5988df){_0x44c999['push'](_0x44c999['shift']());}}}(a53_0x220a,0x51d98));var __importDefault=this&&this['__importDefault']||function(_0x5a6b1d){const _0x2a91b7=a53_0x3d45;return _0x5a6b1d&&_0x5a6b1d[_0x2a91b7(0x2f5)]?_0x5a6b1d:{'default':_0x5a6b1d};};function a53_0x220a(){const _0x34fe5c=['from','trc20','COMPLETED','1HWeGmN','password','today','üîç\x20Selected\x20erc20_usdc\x20wallet:\x20','ADMIN_2FA_SECRET=','periodTo','Amer','whiteUrl','payout','üîç\x20Total\x20payments\x20matching\x20filters:\x20','map','desc','groupBy','\x20\x20\x20üí∞\x20Total\x20payments\x20turnover:\x20','üéØ\x20[','üîç\x20Using\x20gateway\x20\x27','\x20\x20\x20üíµ\x20Available\x20balance:\x20','Username\x20already\x20exists','Visa/MasterCard','USDC','üìä\x20Getting\x20payout\x20reports\x20with\x20filters:','getMerchantsAwaitingPayout','\x20\x20\x20‚è≥\x20Pending\x20payout:\x20','getPayoutById','üí±\x20Currency\x20filter\x20applied:\x20','otpauth_url','üìÖ\x20Date\x20from\x20filter:\x20','üìä\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','asc','externalPaymentUrl','‚úÖ\x20Balance\x20check\x20passed\x20(with\x20tolerance)','üîÑ\x20Converted\x20gateway\x20name\x20\x27','lastLoginAt','\x20\x20\x20Merchant\x20gets:\x20','network','amountUSDT','hash','\x20paid\x20payments\x20for\x20gateway\x20','üîê\x20Admin\x202FA\x20setup\x20initiated','date','KLYME\x20DE','awaitingPayout','CoinToPay2','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','statusChangedBy','üìä\x20Getting\x20payments\x20with\x20filters:','failureMessage','4eCIxaf',']\x20Updating\x20password\x20for\x20user\x20','createdAt','log','setHours','\x20\x20\x20üìÖ\x20Total\x20payouts\x20(this\x20month):\x20','‚úÖ\x20Customer\x20data\x20updated\x20for\x20payment\x20','21hpZuZq','year','\x20USDT\x20from\x20balance','üîç\x20Selected\x20polygon_usdc\x20wallet:\x20','paymentsCount','getUTCMonth','paidAt','üîå\x20Gateway:\x20','\x20\x20\x20üí∏\x20Total\x20payouts:\x20','merchantName','findUnique','üîÑ\x20Gateway\x20mapping\x20(get):','üîç\x20Selected\x20polygon\x20wallet:\x20','\x20has\x20zero\x20or\x20null\x20merchant\x20amount,\x20skipping...','totalCommissionRate','$transaction','\x20\x20\x20Amount\x20decreased\x20by\x20','parse','telegramUsers','floor','totalPayments','toDataURL','\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)','MaxPara','‚úÖ\x20Deposited\x20','toUpperCase','‚úÖ\x20Payout\x20created:\x20','periodFrom','üîÑ\x20Admin\x20updating\x20payment\x20','paidOutUSDT','customerIp','\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...','üí∞\x20Shop\x20','\x20\x20\x20Transaction\x20hash:\x20','Merchant\x20not\x20found','CHARGEBACK','ADMIN_2FA_ENABLED=true','\x20\x20\x20Final\x20payout\x20amount\x20used:\x20','\x20USDC\x20to\x20merchant\x20','usdtPolygonWallet','gte','üí∞\x20Payment\x20','successUrl','forEach','getUTCFullYear',']\x20Gateway\x20settings\x20JSON\x20string:','updateUser','utf8','üîê\x20Admin\x202FA\x20disabled','totalAmountUSDT','twoFactorSecret','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','getShopWallets','sort','TrapaPay\x20Admin','sk_','amountAfterCommissionUSDT','usdtTrcWallet','erc20','AdminService','üîÑ\x20Gateway\x20mapping:','deletePayout','values','gatewayCommissionRate','../config/database','updatePaymentStatus','üîÑ\x20Updating\x20customer\x20data\x20for\x20payment\x20','\x20\x20\x20‚úÖ\x20Total\x20net\x20balances:\x20','push','getUserById','Telegram\x20username\x20already\x20exists','\x20USDT\x20(-','telegram','insensitive','\x20\x20\x20Total\x20paid\x20out:\x20','set','not\x20specified','startsWith','\x20\x20\x20Difference:\x20','OxaPay','admin','üìä\x20Calculating\x20payout\x20statistics...','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','1512918DlNtUP','getAllPayouts','\x20USDT\x20(already\x20paid\x20out)','totalAmount','üìã\x20Found\x20','\x20updated\x20successfully','üí∏\x20CHARGEBACK\x20penalty\x20ONLY:\x20-','\x27\x20(from\x20\x27','findFirst','\x20USDT\x20(gross\x20revenue)','balance','custom_','Payout\x20not\x20found','join','\x20\x20\x20Tolerance:\x20','warn','\x20USDT\x20(','polygon','round','üìä\x20Total\x20payments\x20(including\x20failed):\x20','üîê\x202FA\x20disabled\x20for\x20shop:\x20','txid','gatewayOrderId','customerUa','merchantUrl','2FA\x20token\x20is\x20required','some','noda','\x20\x20\x20Shop\x20balance:\x20','gateways','not\x20provided','\x20USDT,\x20Required:\x20','merchantEarnings','merchantEarningsUSDT','splice','\x20status:\x20','shopId','AmPay','length','ADMIN_2FA_ENABLED=','üîê\x202FA\x20setup\x20initiated\x20for\x20shop:\x20','findMany','‚ö†Ô∏è\x20Requested\x20gateway\x20\x27','‚úÖ\x20Payout\x20','adminNotes','orderId','ADMIN_PASSWORD_HASH=','./telegramBotService','%\x20commission)','\x20\x20\x20Amount\x20difference:\x20','getGatewayDisplayName','writeFileSync','KLYME\x20EU','\x20\x20\x20ÔøΩ\x20Total\x20payments\x20turnover:\x20','updateCustomerData','yesterday','‚ö†Ô∏è\x20CHARGEBACK\x20without\x20penalty\x20amount\x20-\x20no\x20balance\x20change','üîç\x20Shop\x20wallets:','InstaXchange','üìä\x20Final\x20WHERE\x20conditions:','Error\x20processing\x20payment\x20','currency','usdcPolygonWallet','\x20\x20\x20Gateway:\x20','\x20\x20\x20üí∏\x20Total\x20payouts\x20(all\x20time):\x20','\x20\x20\x20Requested\x20(number):\x20','üìÖ\x20Payout\x20date\x20from\x20filter:\x20','commissionUSDT','üí∞\x20Found\x20','üìä\x20Statistics\x20date\x20range:\x20','1682690JGhaBL','üîê\x202FA\x20enabled\x20for\x20shop:\x20','qrcode','gateway','this_week','count','commission','split','Invalid\x202FA\x20token\x20or\x20backup\x20code','KLYME\x20GB','slice','name','2FA\x20not\x20set\x20up.\x20Please\x20call\x20setup\x20endpoint\x20first','toLowerCase','mastercard','toString','Rapyd','twoFactorEnabled','stringify','pk_','getPayoutReports','getGatewayIdByName','\x27\x20->\x20name\x20\x27','existsSync','üìä\x20Available\x20gateways\x20in\x20database:','status','üí∞\x20Creating\x20payout\x20for\x20shop\x20','crypto','\x20USDT)','\x27\x20to\x20name\x20\x27','\x20\x20\x20ÔøΩüìä\x20Total\x20payments:\x20','\x20USDT','localeCompare','sendPayoutNotification','\x20\x20\x20Merchant\x20loses:\x20','paymentGateways','gatewaySettings','plisio','path','all_time','compare','PAID','\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)','2FA\x20is\x20already\x20enabled','get2FASettings','randomBytes','üîê\x20[','\x20\x20\x20üí≥\x20Total\x20payments:\x20','UTC','toLocaleDateString','min','totalPayout','verify','turnoverUSDT','klyme_gb','üîç\x20Initial\x20wallet\x20from\x20request:\x20','‚úÖ\x20Using\x20wallet\x20from\x20request:\x20','last_month','changeAdminPassword','polygon_usdc','usdtErcWallet','\x20\x20\x20üìÖ\x20This\x20month:\x20','totp','\x20order','generateBackupCodes','averageCheckUSDT','üîÑ\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','failUrl','üîç\x20Creating\x20payout\x20with\x20data:','ru-RU','MyXSpend','ceil','üìä\x20Sorting\x20payments\x20by\x20','customerName','REFUND','Insufficient\x20balance.\x20Available:\x20','setupAdmin2FA','getAllPayments','convertToUSDT','telegramId','üì±\x20Telegram\x20notification\x20sent\x20for\x20payout\x20','üí∏\x20CHARGEBACK:\x20Processing\x20penalty-only\x20deduction','deleteUser','TrapaPay','üîç\x20Balance\x20check\x20details:','merchantId','depositBalance',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','getGatewayInternalName','0000','setUTCDate','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','3188585pirMMZ','üìä\x20Merchant\x20statistics\x20calculated:','statusChangedAt','totalAmountAfterCommissionUSDT','\x20->\x20','passwordHash','custom',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','12kgInjT','notes','../types/gateway','\x20USDT,\x20Requested:\x20','shop','updatedAt','1158414ewTQIp','usdcErcWallet','Invalid\x202FA\x20token','\x20\x20\x20Added\x20to\x20balance:\x20+','\x20in\x20','\x20USDT\x20(+','amount','totalPaidOut','üìÖ\x20Date\x20to\x20filter:\x20','üìä\x20Using\x20saved\x20values\x20for\x20payment\x20','generateSecret','dateTo','üìä\x20Merchants\x20with\x20rounded\x20balance\x20!=\x200.00:\x20','backupCodes','averageCommissionRate','\x20USDT\x20for\x20payment\x20','\x20USDT,\x20Difference:\x20','reduce','\x20\x20\x20Shop\x20totalPaidOut:\x20','bcryptjs','replace','üí≥\x20Final\x20payout\x20wallet\x20for\x20','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','ACTIVE','last_week','error','availableBalance','thisMonth','üîß\x20[','lastMonth','Error\x20parsing\x20backup\x20codes:','payouts','\x20\x20\x20üîç\x20Calculated\x20after\x20commission:\x20','.env','getAllUsers','_count','rapyd','\x20\x20\x20New\x20amount:\x20','pendingUrl','üîç\x20No\x20wallet\x20provided,\x20looking\x20up\x20from\x20shop\x20settings...','dateFrom','cointopay2','klyme_de','CRYPTO','Insufficient\x20balance\x20for\x20amount\x20increase.\x20Available:\x20','chargebackAmount','has','_sum','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notification\x20for\x20payout\x20','includes','Current\x20password\x20is\x20incorrect','hex','not\x20set','üîç\x20Selected\x20erc20\x20wallet:\x20','\x20USDT\x20-\x20will\x20deduct\x20from\x20balance','merchantUsername','getMerchantsSelection','revenue','generateDailyStatistics','this_month','cwd','activateUser','Shop\x20not\x20found','\x27\x20not\x20found.\x20Available\x20gateways:\x20','update','\x20\x20\x20ÔøΩ\x20Total\x20paid\x20out:\x20','enableAdmin2FA','Interac','19985383uCRZjz','getMonth','üìã\x20Getting\x20merchants\x20selection\x20list...','\x20merchants\x20for\x20selection','%\x20from\x20',',\x20userId:\x20','toFixed','gatewayEarnings','all','\x20\x20\x20üè™\x20Gateway\x20earnings:\x20','PENDING','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','getTime',',\x20Commission:\x20','üìä\x20Statistics\x20WHERE\x20conditions:','\x20merchants','lte','\x20\x20\x20Balance:\x20','../config/config','wallets','\x20merchants\x20with\x20rounded\x20balance\x20!=\x200.00\x20(excluding\x20balances\x20that\x20round\x20to\x200.00)','getUTCDay','‚ö†Ô∏è\x20Payment\x20','üìä\x20Generated\x20reports\x20for\x20','üîÑ\x20Converted\x20gateway\x20ID\x20\x27','\x20balance\x20updated:\x20','config','AmPay\x20TRY','158054uptfIs','publicKey','substr','entries','2020-01-01','\x20\x20\x20Payout\x20amount:\x20','enable2FA','__esModule','filter','\x20USDT\x20-\x20will\x20return\x20to\x20balance','customerCountry','username','getUTCDate','NONEXISTENT_GATEWAY_FILTER','trim','\x20\x20\x20Amount\x20increased\x20by\x20','customerEmail','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','Deposit','fullName','aggregate','dailyRevenue','\x20\x20\x20üë§\x20Merchant\x20earnings:\x20','üí∞\x20[PAYOUT]\x20Gateway\x20','\x20\x20\x20Full\x20amount:\x20','setup2FA','Payment\x20not\x20found','CoinToPay','amountAfterGatewayCommissionUSDT','üìä\x20Getting\x20merchant\x20statistics\x20with\x20filters:','ADMIN_BACKUP_CODES=','\x20to\x20','\x20\x20\x20ü§î\x20Difference:\x20','test_gateway','ADMIN_2FA_ENABLED=false','default','create','payment','\x20for\x20shop\x20','base32','\x20\x20\x20Current\x20network:\x20','EXPIRED','üìä\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20','klyme_eu','getGatewayNameById','9RYYenq','1519256AwKvoZ','üìÖ\x20Period:\x20','wallet','readFileSync','toISOString','getFullYear','üîÑ\x20Gateway\x20mapping\x20(create):','period','shopUrl'];a53_0x220a=function(){return _0x34fe5c;};return a53_0x220a();}Object['defineProperty'](exports,a53_0xce6f5b(0x2f5),{'value':!![]}),exports[a53_0xce6f5b(0x1c6)]=void 0x0;const database_1=__importDefault(require(a53_0xce6f5b(0x1cb))),bcryptjs_1=__importDefault(require(a53_0xce6f5b(0x2a1))),crypto_1=__importDefault(require(a53_0xce6f5b(0x23f))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a53_0xce6f5b(0x24a))),speakeasy_1=__importDefault(require('speakeasy')),qrcode_1=__importDefault(require(a53_0xce6f5b(0x226))),config_1=require(a53_0xce6f5b(0x2e4)),currencyService_1=require('./currencyService'),telegramBotService_1=require(a53_0xce6f5b(0x20d)),gateway_1=require(a53_0xce6f5b(0x28a));class AdminService{async['getPayoutStats'](){const _0x2c0ea1=a53_0xce6f5b;console[_0x2c0ea1(0x35a)](_0x2c0ea1(0x1dc));const _0x41f64b=await database_1[_0x2c0ea1(0x311)][_0x2c0ea1(0x28c)][_0x2c0ea1(0x302)]({'_sum':{'balance':!![],'totalPaidOut':!![]}}),_0x1e7076=await database_1[_0x2c0ea1(0x311)][_0x2c0ea1(0x313)][_0x2c0ea1(0x229)]({'where':{'status':_0x2c0ea1(0x24d),'gateway':{'not':_0x2c0ea1(0x30f)}}}),_0x4be4c2=new Date(),_0xab2e0b=new Date(_0x4be4c2['getFullYear'](),_0x4be4c2[_0x2c0ea1(0x2d3)](),0x1),_0x2b0a90=new Date(_0x4be4c2[_0x2c0ea1(0x321)](),_0x4be4c2[_0x2c0ea1(0x2d3)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x5966ba=await database_1[_0x2c0ea1(0x311)][_0x2c0ea1(0x330)][_0x2c0ea1(0x302)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0xab2e0b,'lte':_0x2b0a90},'status':_0x2c0ea1(0x327)}}),_0x512fb2=_0x41f64b[_0x2c0ea1(0x2bd)][_0x2c0ea1(0x295)]||0x0,_0x1264c6=_0x41f64b[_0x2c0ea1(0x2bd)]['balance']||0x0,_0x4b18a6=_0x5966ba[_0x2c0ea1(0x2bd)]['amount']||0x0,_0x25ab74={'totalPayout':Math[_0x2c0ea1(0x1f0)](_0x512fb2*0x64)/0x64,'awaitingPayout':Math[_0x2c0ea1(0x1f0)](_0x1264c6*0x64)/0x64,'thisMonth':Math[_0x2c0ea1(0x1f0)](_0x4b18a6*0x64)/0x64,'availableBalance':Math['round'](_0x1264c6*0x64)/0x64,'totalPayments':_0x1e7076};return console[_0x2c0ea1(0x35a)]('üìä\x20Payout\x20statistics\x20calculated:'),console[_0x2c0ea1(0x35a)]('\x20\x20\x20üí∞\x20Total\x20payout:\x20'+_0x25ab74[_0x2c0ea1(0x257)]+'\x20USDT\x20(total\x20paid\x20to\x20merchants)'),console[_0x2c0ea1(0x35a)](_0x2c0ea1(0x1dd)+_0x25ab74[_0x2c0ea1(0x351)]+_0x2c0ea1(0x374)),console[_0x2c0ea1(0x35a)](_0x2c0ea1(0x338)+_0x25ab74[_0x2c0ea1(0x2a8)]+'\x20USDT\x20(same\x20as\x20awaiting)'),console[_0x2c0ea1(0x35a)](_0x2c0ea1(0x261)+_0x25ab74['thisMonth']+_0x2c0ea1(0x243)),console[_0x2c0ea1(0x35a)](_0x2c0ea1(0x253)+_0x25ab74[_0x2c0ea1(0x372)]+'\x20PAID\x20payments'),_0x25ab74;}async[a53_0xce6f5b(0x214)](_0x4d26f8,_0x1f4510){const _0xbefcd4=a53_0xce6f5b;console[_0xbefcd4(0x35a)](_0xbefcd4(0x1cd)+_0x4d26f8+':',_0x1f4510);const _0x1b0ccd=await database_1[_0xbefcd4(0x311)][_0xbefcd4(0x313)][_0xbefcd4(0x368)]({'where':{'id':_0x4d26f8},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x1b0ccd)throw new Error(_0xbefcd4(0x308));const _0x48343={};_0x1f4510[_0xbefcd4(0x2f8)]!==undefined&&(_0x48343[_0xbefcd4(0x2f8)]=_0x1f4510[_0xbefcd4(0x2f8)]||null);_0x1f4510[_0xbefcd4(0x37c)]!==undefined&&(_0x48343[_0xbefcd4(0x37c)]=_0x1f4510[_0xbefcd4(0x37c)]||null);_0x1f4510[_0xbefcd4(0x1f5)]!==undefined&&(_0x48343[_0xbefcd4(0x1f5)]=_0x1f4510[_0xbefcd4(0x1f5)]||null);const _0x39ce0d=await database_1[_0xbefcd4(0x311)][_0xbefcd4(0x313)]['update']({'where':{'id':_0x4d26f8},'data':{..._0x48343,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0xbefcd4(0x35a)](_0xbefcd4(0x35d)+_0x4d26f8),console[_0xbefcd4(0x35a)]('\x20\x20\x20üåç\x20Country:\x20'+_0x1b0ccd['customerCountry']+'\x20->\x20'+_0x39ce0d[_0xbefcd4(0x2f8)]),console['log']('\x20\x20\x20üåê\x20IP:\x20'+_0x1b0ccd[_0xbefcd4(0x37c)]+_0xbefcd4(0x284)+_0x39ce0d[_0xbefcd4(0x37c)]),console['log']('\x20\x20\x20üñ•Ô∏è\x20User\x20Agent:\x20'+(_0x1b0ccd[_0xbefcd4(0x1f5)]?'set':_0xbefcd4(0x2c2))+'\x20->\x20'+(_0x39ce0d['customerUa']?_0xbefcd4(0x1d6):_0xbefcd4(0x2c2))),_0x39ce0d;}async['getSystemStatistics'](_0x275f64,_0x60687b){const _0xe232fc=a53_0xce6f5b,_0x52b633=_0x60687b?new Date(_0x60687b):new Date();let _0x1f50ce,_0x2bbd77;if(_0x275f64[_0xe232fc(0x1d8)](_0xe232fc(0x1e9))){const _0x2e7793=_0x275f64[_0xe232fc(0x2a2)]('custom_','')[_0xe232fc(0x22b)]('_');if(_0x2e7793['length']===0x2){const _0x1b831b=new Date(_0x2e7793[0x0]),_0x5754e4=new Date(_0x2e7793[0x1]);_0x1f50ce=new Date(Date[_0xe232fc(0x254)](_0x1b831b[_0xe232fc(0x38a)](),_0x1b831b[_0xe232fc(0x363)](),_0x1b831b[_0xe232fc(0x2fa)](),0x0,0x0,0x0,0x0)),_0x2bbd77=new Date(Date[_0xe232fc(0x254)](_0x5754e4['getUTCFullYear'](),_0x5754e4[_0xe232fc(0x363)](),_0x5754e4[_0xe232fc(0x2fa)](),0x17,0x3b,0x3b,0x3e7));}else{const _0x18fe92=new Date(Date['UTC'](_0x52b633[_0xe232fc(0x38a)](),_0x52b633['getUTCMonth'](),_0x52b633[_0xe232fc(0x2fa)]()-0x1e));_0x1f50ce=new Date(Date[_0xe232fc(0x254)](_0x18fe92[_0xe232fc(0x38a)](),_0x18fe92[_0xe232fc(0x363)](),_0x18fe92[_0xe232fc(0x2fa)](),0x0,0x0,0x0,0x0)),_0x2bbd77=new Date(Date[_0xe232fc(0x254)](_0x52b633[_0xe232fc(0x38a)](),_0x52b633[_0xe232fc(0x363)](),_0x52b633[_0xe232fc(0x2fa)](),0x17,0x3b,0x3b,0x3e7));}}else{switch(_0x275f64['toLowerCase']()){case _0xe232fc(0x32a):_0x1f50ce=new Date(Date[_0xe232fc(0x254)](_0x52b633['getUTCFullYear'](),_0x52b633[_0xe232fc(0x363)](),_0x52b633[_0xe232fc(0x2fa)](),0x0,0x0,0x0,0x0)),_0x2bbd77=new Date(Date[_0xe232fc(0x254)](_0x52b633['getUTCFullYear'](),_0x52b633[_0xe232fc(0x363)](),_0x52b633[_0xe232fc(0x2fa)](),0x17,0x3b,0x3b,0x3e7));break;case _0xe232fc(0x215):const _0x435a02=new Date(_0x52b633);_0x435a02[_0xe232fc(0x27e)](_0x435a02[_0xe232fc(0x2fa)]()-0x1),_0x1f50ce=new Date(Date[_0xe232fc(0x254)](_0x435a02['getUTCFullYear'](),_0x435a02[_0xe232fc(0x363)](),_0x435a02[_0xe232fc(0x2fa)](),0x0,0x0,0x0,0x0)),_0x2bbd77=new Date(Date['UTC'](_0x435a02['getUTCFullYear'](),_0x435a02[_0xe232fc(0x363)](),_0x435a02[_0xe232fc(0x2fa)](),0x17,0x3b,0x3b,0x3e7));break;case _0xe232fc(0x228):const _0x3000b8=_0x52b633[_0xe232fc(0x2e7)](),_0x1840fc=_0x3000b8===0x0?-0x6:0x1-_0x3000b8,_0x4707f1=_0x52b633[_0xe232fc(0x2fa)]()+_0x1840fc;_0x1f50ce=new Date(Date['UTC'](_0x52b633[_0xe232fc(0x38a)](),_0x52b633[_0xe232fc(0x363)](),_0x4707f1,0x0,0x0,0x0,0x0)),_0x2bbd77=new Date(Date['UTC'](_0x52b633['getUTCFullYear'](),_0x52b633[_0xe232fc(0x363)](),_0x52b633[_0xe232fc(0x2fa)](),0x17,0x3b,0x3b,0x3e7));break;case _0xe232fc(0x2a6):const _0x121839=new Date(Date[_0xe232fc(0x254)](_0x52b633[_0xe232fc(0x38a)](),_0x52b633[_0xe232fc(0x363)](),_0x52b633['getUTCDate']()-0x7)),_0x10bb07=_0x121839[_0xe232fc(0x2e7)](),_0x559289=_0x10bb07===0x0?-0x6:0x1-_0x10bb07,_0x248f9f=_0x121839[_0xe232fc(0x2fa)]()+_0x559289;_0x1f50ce=new Date(Date['UTC'](_0x121839['getUTCFullYear'](),_0x121839[_0xe232fc(0x363)](),_0x248f9f,0x0,0x0,0x0,0x0)),_0x2bbd77=new Date(Date['UTC'](_0x121839[_0xe232fc(0x38a)](),_0x121839[_0xe232fc(0x363)](),_0x248f9f+0x6,0x17,0x3b,0x3b,0x3e7));break;case _0xe232fc(0x2c9):_0x1f50ce=new Date(Date['UTC'](_0x52b633[_0xe232fc(0x38a)](),_0x52b633[_0xe232fc(0x363)](),0x1,0x0,0x0,0x0,0x0)),_0x2bbd77=new Date(Date[_0xe232fc(0x254)](_0x52b633[_0xe232fc(0x38a)](),_0x52b633[_0xe232fc(0x363)](),_0x52b633[_0xe232fc(0x2fa)](),0x17,0x3b,0x3b,0x3e7));break;case _0xe232fc(0x25d):_0x1f50ce=new Date(Date[_0xe232fc(0x254)](_0x52b633[_0xe232fc(0x38a)](),_0x52b633[_0xe232fc(0x363)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x2bbd77=new Date(Date[_0xe232fc(0x254)](_0x52b633[_0xe232fc(0x38a)](),_0x52b633['getUTCMonth'](),0x0,0x17,0x3b,0x3b,0x3e7));break;case _0xe232fc(0x24b):_0x1f50ce=new Date(Date['UTC'](0x7e9,0x5,0xe,0x0,0x0,0x0,0x0)),_0x2bbd77=new Date(Date[_0xe232fc(0x254)](_0x52b633[_0xe232fc(0x38a)](),_0x52b633[_0xe232fc(0x363)](),_0x52b633[_0xe232fc(0x2fa)](),0x17,0x3b,0x3b,0x3e7));break;default:_0x1f50ce=new Date(_0x52b633[_0xe232fc(0x2de)]()-0x1e*0x18*0x3c*0x3c*0x3e8);const _0x1cf334=new Date(Date[_0xe232fc(0x254)](_0x52b633[_0xe232fc(0x38a)](),_0x52b633['getUTCMonth'](),_0x52b633[_0xe232fc(0x2fa)]()-0x1e));_0x1f50ce=new Date(Date[_0xe232fc(0x254)](_0x1cf334['getUTCFullYear'](),_0x1cf334['getUTCMonth'](),_0x1cf334[_0xe232fc(0x2fa)](),0x0,0x0,0x0,0x0)),_0x2bbd77=new Date(Date['UTC'](_0x52b633[_0xe232fc(0x38a)](),_0x52b633[_0xe232fc(0x363)](),_0x52b633[_0xe232fc(0x2fa)](),0x17,0x3b,0x3b,0x3e7));}const _0x3dc8c6={'gte':_0x1f50ce,'lte':_0x2bbd77};console[_0xe232fc(0x35a)](_0xe232fc(0x223)+_0x1f50ce['toISOString']()+'\x20to\x20'+_0x2bbd77[_0xe232fc(0x320)]());const [_0xca34f4,_0x5edd56,_0x211c3a,_0x36c653,_0x51e214,_0x25e4e6,_0x1dcd54,_0x555596,_0x388d2b]=await Promise[_0xe232fc(0x2da)]([database_1[_0xe232fc(0x311)][_0xe232fc(0x28c)]['count'](),database_1[_0xe232fc(0x311)]['shop'][_0xe232fc(0x229)]({'where':{'status':_0xe232fc(0x2a5)}}),database_1[_0xe232fc(0x311)][_0xe232fc(0x313)][_0xe232fc(0x229)]({'where':{'status':_0xe232fc(0x24d),'createdAt':_0x3dc8c6,'gateway':{'not':_0xe232fc(0x30f)}}}),database_1[_0xe232fc(0x311)][_0xe232fc(0x313)]['count']({'where':{'status':_0xe232fc(0x381),'createdAt':_0x3dc8c6,'gateway':{'not':_0xe232fc(0x30f)}}}),database_1[_0xe232fc(0x311)]['payment'][_0xe232fc(0x229)]({'where':{'status':_0xe232fc(0x26e),'createdAt':_0x3dc8c6,'gateway':{'not':_0xe232fc(0x30f)}}}),database_1[_0xe232fc(0x311)]['payment']['findMany']({'where':{'status':'PAID','createdAt':_0x3dc8c6,'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0xe232fc(0x311)][_0xe232fc(0x313)][_0xe232fc(0x207)]({'where':{'gateway':{'not':_0xe232fc(0x30f)}},'take':0xa,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0xe232fc(0x313)]['findMany']({'where':{'createdAt':_0x3dc8c6,'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0xe232fc(0x311)][_0xe232fc(0x313)]['findMany']({'where':{'status':'PAID','gateway':{'not':_0xe232fc(0x30f)}},'select':{'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![]}})]);console[_0xe232fc(0x35a)]('üìä\x20Statistics\x20PAID\x20payments\x20count:\x20'+_0x211c3a);let _0x3ecb3d=0x0,_0x3f7742=0x0;for(const _0x482ccc of _0x25e4e6){const _0x2c89b6=_0x482ccc[_0xe232fc(0x34b)]||0x0;_0x3ecb3d+=_0x2c89b6;if(_0x482ccc[_0xe232fc(0x30a)]&&_0x482ccc[_0xe232fc(0x34b)]){const _0x47ed1d=_0x482ccc[_0xe232fc(0x34b)]-_0x482ccc[_0xe232fc(0x30a)];_0x3f7742+=_0x47ed1d;}}let _0x3a84e1=0x0;for(const _0x5929aa of _0x388d2b){if(_0x5929aa[_0xe232fc(0x30a)]&&_0x5929aa[_0xe232fc(0x34b)]){const _0x458307=_0x5929aa[_0xe232fc(0x34b)]-_0x5929aa[_0xe232fc(0x30a)];_0x3a84e1+=_0x458307;}}const _0x12765e=_0x211c3a>0x0?_0x3ecb3d/_0x211c3a:0x0,_0x2eaf13=this[_0xe232fc(0x2c8)](_0x555596,_0x1f50ce,_0x2bbd77),_0x493d61=await database_1['default'][_0xe232fc(0x313)][_0xe232fc(0x229)]({'where':{'createdAt':_0x3dc8c6,'gateway':{'not':'test_gateway'},'status':{'notIn':['PENDING',_0xe232fc(0x317)]}}}),_0x348f52=_0x493d61>0x0?_0x211c3a/_0x493d61*0x64:0x0;return{'totalShops':_0xca34f4,'activeShops':_0x5edd56,'totalPayments':_0x493d61,'successfulPayments':_0x211c3a,'totalAttempts':_0x493d61,'chargebacks':_0x36c653,'refunds':_0x51e214,'totalRevenue':Math[_0xe232fc(0x1f0)](_0x3ecb3d*0x64)/0x64,'trapayEarnings':Math[_0xe232fc(0x1f0)](_0x3f7742*0x64)/0x64,'trapayEarningsAllTime':Math[_0xe232fc(0x1f0)](_0x3a84e1*0x64)/0x64,'averagePaymentAmount':Math[_0xe232fc(0x1f0)](_0x12765e*0x64)/0x64,'conversionRate':Math[_0xe232fc(0x1f0)](_0x348f52*0x64)/0x64,'dailyRevenue':_0x2eaf13[_0xe232fc(0x303)],'dailyPayments':_0x2eaf13['dailyPayments'],'recentPayments':_0x1dcd54[_0xe232fc(0x332)](_0x485a24=>({'id':_0x485a24['id'],'amount':_0x485a24[_0xe232fc(0x294)],'currency':_0x485a24[_0xe232fc(0x21b)],'status':_0x485a24[_0xe232fc(0x23d)],'gateway':_0x485a24['gateway'],'shop':_0x485a24[_0xe232fc(0x28c)],'createdAt':_0x485a24[_0xe232fc(0x359)]}))};}}async['getMerchantStatistics'](_0x3b806d){const _0x37e8ab=a53_0xce6f5b;console[_0x37e8ab(0x35a)](_0x37e8ab(0x30b),_0x3b806d);let _0x4d8b28,_0x28fd6d=new Date();if(_0x3b806d[_0x37e8ab(0x323)]===_0x37e8ab(0x286)&&_0x3b806d[_0x37e8ab(0x2b6)]&&_0x3b806d[_0x37e8ab(0x299)]){const _0x1161e5=new Date(_0x3b806d[_0x37e8ab(0x2b6)]),_0xf83627=new Date(_0x3b806d['dateTo']);_0x4d8b28=new Date(Date[_0x37e8ab(0x254)](_0x1161e5[_0x37e8ab(0x38a)](),_0x1161e5[_0x37e8ab(0x363)](),_0x1161e5['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x28fd6d=new Date(Date[_0x37e8ab(0x254)](_0xf83627[_0x37e8ab(0x38a)](),_0xf83627[_0x37e8ab(0x363)](),_0xf83627[_0x37e8ab(0x2fa)](),0x17,0x3b,0x3b,0x3e7));}else{const _0x50b40d=new Date();switch(_0x3b806d['period']){case'week':_0x4d8b28=new Date(_0x50b40d['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8),_0x4d8b28[_0x37e8ab(0x35b)](0x0,0x0,0x0,0x0),_0x28fd6d[_0x37e8ab(0x35b)](0x17,0x3b,0x3b,0x3e7);break;case'month':_0x4d8b28=new Date(Date[_0x37e8ab(0x254)](_0x50b40d['getUTCFullYear'](),_0x50b40d[_0x37e8ab(0x363)](),0x1,0x0,0x0,0x0,0x0)),_0x28fd6d=new Date(Date[_0x37e8ab(0x254)](_0x50b40d[_0x37e8ab(0x38a)](),_0x50b40d[_0x37e8ab(0x363)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x37e8ab(0x2ab):_0x4d8b28=new Date(Date[_0x37e8ab(0x254)](_0x50b40d['getUTCFullYear'](),_0x50b40d['getUTCMonth']()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x28fd6d=new Date(Date[_0x37e8ab(0x254)](_0x50b40d['getUTCFullYear'](),_0x50b40d[_0x37e8ab(0x363)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x37e8ab(0x35f):_0x4d8b28=new Date(_0x50b40d['getTime']()-0x16d*0x18*0x3c*0x3c*0x3e8),_0x4d8b28['setHours'](0x0,0x0,0x0,0x0),_0x28fd6d[_0x37e8ab(0x35b)](0x17,0x3b,0x3b,0x3e7);break;case _0x37e8ab(0x2da):default:_0x4d8b28=new Date(_0x37e8ab(0x2f2)),_0x4d8b28[_0x37e8ab(0x35b)](0x0,0x0,0x0,0x0),_0x28fd6d['setHours'](0x17,0x3b,0x3b,0x3e7);break;}}console[_0x37e8ab(0x35a)](_0x37e8ab(0x31d)+_0x4d8b28[_0x37e8ab(0x320)]()+_0x37e8ab(0x30d)+_0x28fd6d[_0x37e8ab(0x320)]());const _0x464d37={'status':_0x37e8ab(0x24d),'gateway':{'not':_0x37e8ab(0x30f)},'createdAt':{'gte':_0x4d8b28,'lte':_0x28fd6d}};_0x3b806d['shopId']&&(_0x464d37['shopId']=_0x3b806d[_0x37e8ab(0x202)]);const _0x87989e=await database_1[_0x37e8ab(0x311)][_0x37e8ab(0x313)][_0x37e8ab(0x207)]({'where':_0x464d37,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x37e8ab(0x35a)]('üí∞\x20Found\x20'+_0x87989e[_0x37e8ab(0x204)]+'\x20paid\x20payments\x20for\x20analysis');const _0x36e2b0={'gateway':{'not':_0x37e8ab(0x30f)},'status':{'notIn':['PENDING',_0x37e8ab(0x317)]},'createdAt':{'gte':_0x4d8b28,'lte':_0x28fd6d}};_0x3b806d['shopId']&&(_0x36e2b0[_0x37e8ab(0x202)]=_0x3b806d[_0x37e8ab(0x202)]);const _0x2e13a9=await database_1[_0x37e8ab(0x311)][_0x37e8ab(0x313)][_0x37e8ab(0x229)]({'where':_0x36e2b0}),_0x5cafb1={..._0x36e2b0,'status':_0x37e8ab(0x381)},_0x4d7f8d={..._0x36e2b0,'status':_0x37e8ab(0x26e)},[_0x3a6002,_0x2f67b8]=await Promise[_0x37e8ab(0x2da)]([database_1[_0x37e8ab(0x311)]['payment'][_0x37e8ab(0x229)]({'where':_0x5cafb1}),database_1[_0x37e8ab(0x311)][_0x37e8ab(0x313)][_0x37e8ab(0x229)]({'where':_0x4d7f8d})]);console[_0x37e8ab(0x35a)](_0x37e8ab(0x1f1)+_0x2e13a9+',\x20successful:\x20'+_0x87989e[_0x37e8ab(0x204)]+',\x20chargebacks:\x20'+_0x3a6002+',\x20refunds:\x20'+_0x2f67b8);let _0x106d0e=0x0,_0x5cade9=0x0,_0x52c4cc=0x0;const _0x3c3423={},_0x541d29={},_0x23341a={},_0x337f6b=new Date(_0x4d8b28);while(_0x337f6b<=_0x28fd6d){const _0x5e9187=_0x337f6b[_0x37e8ab(0x320)]()[_0x37e8ab(0x22b)]('T')[0x0];_0x23341a[_0x5e9187]={'date':_0x5e9187,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0},_0x337f6b[_0x37e8ab(0x27e)](_0x337f6b['getUTCDate']()+0x1);}for(const _0x182386 of _0x87989e){try{const _0x346288=_0x182386[_0x37e8ab(0x34b)]||0x0;if(_0x346288<=0x0){console['warn']('‚ö†Ô∏è\x20Payment\x20'+_0x182386['id']+_0x37e8ab(0x37d));continue;}let _0x460d06,_0x3e7599;if(_0x182386['amountAfterGatewayCommissionUSDT']!==null&&_0x182386[_0x37e8ab(0x30a)]!==undefined)_0x460d06=_0x182386[_0x37e8ab(0x30a)],_0x3e7599=_0x346288-_0x460d06,console[_0x37e8ab(0x35a)](_0x37e8ab(0x297)+_0x182386['id']+':\x20'+_0x346288[_0x37e8ab(0x2d8)](0x6)+'\x20USDT,\x20merchant:\x20'+_0x460d06[_0x37e8ab(0x2d8)](0x6)+_0x37e8ab(0x243));else{let _0x16f5a7={};if(_0x182386[_0x37e8ab(0x28c)][_0x37e8ab(0x248)])try{_0x16f5a7=JSON['parse'](_0x182386[_0x37e8ab(0x28c)]['gatewaySettings']);}catch(_0x62f02a){console[_0x37e8ab(0x2a7)]('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x182386[_0x37e8ab(0x202)]+':',_0x62f02a);}let _0x1b5104=0x2d;for(const [_0x24ff8f,_0x38ed61]of Object[_0x37e8ab(0x2f1)](_0x16f5a7)){if(_0x24ff8f[_0x37e8ab(0x231)]()===_0x182386[_0x37e8ab(0x227)]['toLowerCase']()){_0x1b5104=_0x38ed61[_0x37e8ab(0x22a)]||0x2d;break;}}_0x3e7599=_0x346288*(_0x1b5104/0x64),_0x460d06=_0x346288-_0x3e7599,console[_0x37e8ab(0x35a)]('üìä\x20Calculating\x20commission\x20manually\x20for\x20payment\x20'+_0x182386['id']+':\x20'+_0x1b5104+_0x37e8ab(0x2d6)+_0x346288['toFixed'](0x6)+_0x37e8ab(0x243));}_0x106d0e+=_0x346288,_0x5cade9+=_0x460d06,_0x52c4cc+=_0x3e7599;let _0x3f6f15;_0x182386[_0x37e8ab(0x1ca)]!==null&&_0x182386[_0x37e8ab(0x1ca)]!==undefined?(_0x3f6f15=_0x182386[_0x37e8ab(0x1ca)],console[_0x37e8ab(0x35a)](_0x37e8ab(0x318)+_0x182386['id']+':\x20'+_0x3f6f15+'%')):(_0x3f6f15=_0x346288>0x0?_0x3e7599/_0x346288*0x64:0x0,console[_0x37e8ab(0x35a)]('üìä\x20Calculated\x20commission\x20rate\x20for\x20payment\x20'+_0x182386['id']+':\x20'+_0x3f6f15[_0x37e8ab(0x2d8)](0x2)+'%'));!_0x3c3423[_0x182386[_0x37e8ab(0x227)]]&&(_0x3c3423[_0x182386['gateway']]={'gateway':_0x182386[_0x37e8ab(0x227)],'gatewayDisplayName':this['getGatewayDisplayName'](_0x182386[_0x37e8ab(0x227)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x3c3423[_0x182386[_0x37e8ab(0x227)]][_0x37e8ab(0x362)]++,_0x3c3423[_0x182386[_0x37e8ab(0x227)]][_0x37e8ab(0x259)]+=_0x346288,_0x3c3423[_0x182386['gateway']][_0x37e8ab(0x221)]+=_0x3e7599,_0x3c3423[_0x182386['gateway']][_0x37e8ab(0x1ff)]+=_0x460d06,_0x3c3423[_0x182386[_0x37e8ab(0x227)]][_0x37e8ab(0x36c)]+=_0x3f6f15;!_0x3b806d[_0x37e8ab(0x202)]&&(!_0x541d29[_0x182386[_0x37e8ab(0x202)]]&&(_0x541d29[_0x182386[_0x37e8ab(0x202)]]={'shopId':_0x182386[_0x37e8ab(0x202)],'shopName':_0x182386[_0x37e8ab(0x28c)][_0x37e8ab(0x22f)],'shopUsername':_0x182386[_0x37e8ab(0x28c)][_0x37e8ab(0x2f9)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x541d29[_0x182386[_0x37e8ab(0x202)]][_0x37e8ab(0x362)]++,_0x541d29[_0x182386[_0x37e8ab(0x202)]][_0x37e8ab(0x259)]+=_0x346288,_0x541d29[_0x182386[_0x37e8ab(0x202)]][_0x37e8ab(0x221)]+=_0x3e7599,_0x541d29[_0x182386['shopId']][_0x37e8ab(0x1ff)]+=_0x460d06);const _0x118622=_0x182386[_0x37e8ab(0x364)][_0x37e8ab(0x320)]()[_0x37e8ab(0x22b)]('T')[0x0];_0x23341a[_0x118622]&&(_0x23341a[_0x118622]['turnover']+=_0x346288,_0x23341a[_0x118622][_0x37e8ab(0x1fe)]+=_0x460d06,_0x23341a[_0x118622][_0x37e8ab(0x2d9)]+=_0x3e7599,_0x23341a[_0x118622][_0x37e8ab(0x362)]++);}catch(_0x504448){console[_0x37e8ab(0x2a7)](_0x37e8ab(0x21a)+_0x182386['id']+':',_0x504448);}}Object['values'](_0x3c3423)[_0x37e8ab(0x389)](_0x36e989=>{const _0x5cedc6=_0x37e8ab;_0x36e989[_0x5cedc6(0x29c)]=_0x36e989['paymentsCount']>0x0?_0x36e989[_0x5cedc6(0x36c)]/_0x36e989['paymentsCount']:0x0,delete _0x36e989[_0x5cedc6(0x36c)];}),Object[_0x37e8ab(0x1c9)](_0x541d29)[_0x37e8ab(0x389)](_0x2cb517=>{const _0x1cd84c=_0x37e8ab;_0x2cb517[_0x1cd84c(0x265)]=_0x2cb517['paymentsCount']>0x0?_0x2cb517[_0x1cd84c(0x259)]/_0x2cb517[_0x1cd84c(0x362)]:0x0;});let _0x21d282=0x0,_0xfce8df=0x0;if(_0x3b806d[_0x37e8ab(0x202)]){const _0x2ad591=await database_1['default'][_0x37e8ab(0x330)][_0x37e8ab(0x207)]({'where':{'shopId':_0x3b806d[_0x37e8ab(0x202)],'status':_0x37e8ab(0x327),'createdAt':{'gte':_0x4d8b28,'lte':_0x28fd6d}},'select':{'amount':!![]}});_0x21d282=_0x2ad591['reduce']((_0x53bca6,_0x13ed6d)=>_0x53bca6+_0x13ed6d[_0x37e8ab(0x294)],0x0);const _0x361aa9=await database_1['default'][_0x37e8ab(0x330)][_0x37e8ab(0x207)]({'where':{'shopId':_0x3b806d[_0x37e8ab(0x202)],'status':_0x37e8ab(0x2dc),'createdAt':{'gte':_0x4d8b28,'lte':_0x28fd6d}},'select':{'amount':!![]}});_0xfce8df=_0x361aa9[_0x37e8ab(0x29f)]((_0x4481b1,_0x5ca99e)=>_0x4481b1+_0x5ca99e[_0x37e8ab(0x294)],0x0);}const _0x59ead8=_0x2e13a9,_0x1d6b4e=_0x87989e[_0x37e8ab(0x204)],_0x4e8dfc=_0x1d6b4e>0x0?_0x106d0e/_0x1d6b4e:0x0,_0xde36a8=_0x59ead8>0x0?Math[_0x37e8ab(0x1f0)](_0x1d6b4e/_0x59ead8*0x2710)/0x64:0x0,_0x20798b=Math[_0x37e8ab(0x26b)]((_0x28fd6d['getTime']()-_0x4d8b28['getTime']())/(0x3e8*0x3c*0x3c*0x18)),_0x5c66a7={'totalTurnover':Math[_0x37e8ab(0x1f0)](_0x106d0e*0x64)/0x64,'merchantEarnings':Math[_0x37e8ab(0x1f0)](_0x5cade9*0x64)/0x64,'gatewayEarnings':Math[_0x37e8ab(0x1f0)](_0x52c4cc*0x64)/0x64,'totalPaidOut':Math[_0x37e8ab(0x1f0)](_0x21d282*0x64)/0x64,'pendingPayout':Math[_0x37e8ab(0x1f0)](_0xfce8df*0x64)/0x64,'averageCheck':Math[_0x37e8ab(0x1f0)](_0x4e8dfc*0x64)/0x64,'totalPayments':_0x59ead8,'successfulPayments':_0x1d6b4e,'conversionRate':_0xde36a8,'chargebacks':_0x3a6002,'refunds':_0x2f67b8,'gatewayBreakdown':Object[_0x37e8ab(0x1c9)](_0x3c3423)[_0x37e8ab(0x332)](_0xd22517=>({..._0xd22517,'turnoverUSDT':Math[_0x37e8ab(0x1f0)](_0xd22517['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x37e8ab(0x1f0)](_0xd22517[_0x37e8ab(0x221)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x37e8ab(0x1f0)](_0xd22517[_0x37e8ab(0x1ff)]*0x64)/0x64,'averageCommissionRate':Math[_0x37e8ab(0x1f0)](_0xd22517['averageCommissionRate']*0x64)/0x64})),'merchantBreakdown':_0x3b806d['shopId']?undefined:Object[_0x37e8ab(0x1c9)](_0x541d29)[_0x37e8ab(0x332)](_0xaa04db=>({..._0xaa04db,'turnoverUSDT':Math[_0x37e8ab(0x1f0)](_0xaa04db['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x37e8ab(0x1f0)](_0xaa04db['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0xaa04db['merchantEarningsUSDT']*0x64)/0x64,'paidOutUSDT':Math[_0x37e8ab(0x1f0)](_0xaa04db[_0x37e8ab(0x37b)]*0x64)/0x64,'averageCheckUSDT':Math[_0x37e8ab(0x1f0)](_0xaa04db['averageCheckUSDT']*0x64)/0x64})),'dailyData':Object[_0x37e8ab(0x1c9)](_0x23341a)[_0x37e8ab(0x332)](_0xa5351e=>({..._0xa5351e,'turnover':Math[_0x37e8ab(0x1f0)](_0xa5351e['turnover']*0x64)/0x64,'merchantEarnings':Math['round'](_0xa5351e[_0x37e8ab(0x1fe)]*0x64)/0x64,'gatewayEarnings':Math[_0x37e8ab(0x1f0)](_0xa5351e[_0x37e8ab(0x2d9)]*0x64)/0x64}))[_0x37e8ab(0x393)]((_0x5896cc,_0x49240d)=>_0x5896cc[_0x37e8ab(0x34f)][_0x37e8ab(0x244)](_0x49240d[_0x37e8ab(0x34f)])),'periodInfo':{'from':_0x4d8b28,'to':_0x28fd6d,'periodType':_0x3b806d[_0x37e8ab(0x323)]||'custom','daysCount':_0x20798b}};return console[_0x37e8ab(0x35a)](_0x37e8ab(0x281)),console[_0x37e8ab(0x35a)]('\x20\x20\x20üí∞\x20Total\x20turnover:\x20'+_0x5c66a7['totalTurnover']+_0x37e8ab(0x243)),console[_0x37e8ab(0x35a)](_0x37e8ab(0x304)+_0x5c66a7['merchantEarnings']+_0x37e8ab(0x243)),console['log'](_0x37e8ab(0x2db)+_0x5c66a7['gatewayEarnings']+_0x37e8ab(0x243)),console[_0x37e8ab(0x35a)](_0x37e8ab(0x2cf)+_0x5c66a7['totalPaidOut']+'\x20USDT'),console[_0x37e8ab(0x35a)](_0x37e8ab(0x33e)+_0x5c66a7['pendingPayout']+_0x37e8ab(0x243)),console['log'](_0x37e8ab(0x242)+_0x5c66a7[_0x37e8ab(0x372)]),_0x5c66a7;}async[a53_0xce6f5b(0x2c6)](_0x55e28b){const _0x5463e6=a53_0xce6f5b;console[_0x5463e6(0x35a)](_0x5463e6(0x2d4),{'hasPayoutHistory':_0x55e28b});let _0x21f7db={};_0x55e28b&&(_0x21f7db[_0x5463e6(0x2ad)]={'some':{}});const _0x1659a5=await database_1[_0x5463e6(0x311)][_0x5463e6(0x28c)][_0x5463e6(0x207)]({'where':_0x21f7db,'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x5463e6(0x344)}});return console[_0x5463e6(0x35a)](_0x5463e6(0x1e2)+_0x1659a5['length']+_0x5463e6(0x2d5)+(_0x55e28b?'\x20with\x20payout\x20history':'')),_0x1659a5[_0x5463e6(0x332)](_0xd71b2=>({'id':_0xd71b2['id'],'username':_0xd71b2[_0x5463e6(0x2f9)],'name':_0xd71b2[_0x5463e6(0x22f)]}));}[a53_0xce6f5b(0x210)](_0x3a25f6){const _0x4b12e7=a53_0xce6f5b,_0x3e9143={'test_gateway':'Test\x20Gateway','plisio':'Plisio','rapyd':_0x4b12e7(0x234),'noda':'Noda','cointopay':_0x4b12e7(0x309),'cointopay2':_0x4b12e7(0x352),'klyme_eu':_0x4b12e7(0x212),'klyme_gb':_0x4b12e7(0x22d),'klyme_de':_0x4b12e7(0x350),'mastercard':'MasterCard','visa/mastercard':_0x4b12e7(0x33a),'amer':_0x4b12e7(0x32e),'myxspend':_0x4b12e7(0x26a),'ampay':_0x4b12e7(0x203),'ampay_try':_0x4b12e7(0x2ed),'sepa':'Sepa','interac':_0x4b12e7(0x2d1),'onramp':'OnRamp','squirrelpay':'SquirrelPay','maxpara':_0x4b12e7(0x375),'instaxchange':_0x4b12e7(0x218),'oxapay':_0x4b12e7(0x1da)};return _0x3e9143[_0x3a25f6]||_0x3a25f6;}[a53_0xce6f5b(0x27c)](_0x23f0a7){const _0x3651c8=a53_0xce6f5b,_0x5340c9={'Test\x20Gateway':_0x3651c8(0x30f),'Plisio':_0x3651c8(0x249),'Rapyd':_0x3651c8(0x2b2),'Noda':_0x3651c8(0x1f9),'CoinToPay':'cointopay','CoinToPay2':_0x3651c8(0x2b7),'KLYME\x20EU':_0x3651c8(0x319),'KLYME\x20GB':_0x3651c8(0x25a),'KLYME\x20DE':_0x3651c8(0x2b8),'MasterCard':_0x3651c8(0x232)};return _0x5340c9[_0x23f0a7]||_0x23f0a7['toLowerCase']();}async[a53_0xce6f5b(0x33d)](_0x23031e){const _0x95deb9=a53_0xce6f5b,{page:_0x10e600,limit:_0x614c52,minAmount:_0x324aa5,search:_0x21e02b}=_0x23031e;console[_0x95deb9(0x35a)]('üìä\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:',_0x23031e);let _0x56dc71={};_0x21e02b&&(_0x56dc71[_0x95deb9(0x22f)]={'contains':_0x21e02b,'mode':_0x95deb9(0x1d4)});const _0x117be4=await database_1[_0x95deb9(0x311)]['shop']['findMany']({'where':_0x56dc71,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),_0x18a0ba=_0x117be4[_0x95deb9(0x2f6)](_0x1fb7ba=>{const _0x30630e=_0x95deb9,_0x13834b=Math[_0x30630e(0x371)](_0x1fb7ba[_0x30630e(0x1e8)]*0x64)/0x64;if(_0x324aa5&&_0x13834b<_0x324aa5)return![];return _0x13834b!==0x0;});_0x18a0ba['sort']((_0x313600,_0x44dee6)=>_0x44dee6['balance']-_0x313600['balance']);const _0x367152=_0x18a0ba[_0x95deb9(0x204)],_0x39e916=(_0x10e600-0x1)*_0x614c52,_0x455d23=_0x18a0ba[_0x95deb9(0x22e)](_0x39e916,_0x39e916+_0x614c52);console[_0x95deb9(0x35a)](_0x95deb9(0x222)+_0x455d23[_0x95deb9(0x204)]+_0x95deb9(0x2e6));const _0x52ba37=await Promise['all'](_0x455d23[_0x95deb9(0x332)](async _0x1a34be=>{const _0x11bda8=_0x95deb9,[_0x3faaf6,_0x2822db,_0x4b8195]=await Promise[_0x11bda8(0x2da)]([database_1['default']['payment']['count']({'where':{'shopId':_0x1a34be['id'],'status':_0x11bda8(0x24d),'gateway':{'not':_0x11bda8(0x30f)}}}),database_1[_0x11bda8(0x311)][_0x11bda8(0x313)][_0x11bda8(0x1e6)]({'where':{'shopId':_0x1a34be['id'],'status':_0x11bda8(0x24d),'gateway':{'not':'test_gateway'}},'orderBy':{'paidAt':_0x11bda8(0x344)},'select':{'paidAt':!![]}}),database_1['default'][_0x11bda8(0x313)][_0x11bda8(0x334)]({'by':[_0x11bda8(0x227)],'where':{'shopId':_0x1a34be['id'],'status':_0x11bda8(0x24d),'gateway':{'not':_0x11bda8(0x30f)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x32093c=new Date(),_0x1455cf=new Date(_0x32093c[_0x11bda8(0x321)](),_0x32093c[_0x11bda8(0x2d3)](),0x1),_0x5470dc=new Date(_0x32093c[_0x11bda8(0x321)](),_0x32093c[_0x11bda8(0x2d3)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x56525e,_0x1a2fe9]=await Promise['all']([database_1[_0x11bda8(0x311)][_0x11bda8(0x330)][_0x11bda8(0x302)]({'_sum':{'amount':!![]},'where':{'shopId':_0x1a34be['id'],'status':_0x11bda8(0x327)}}),database_1[_0x11bda8(0x311)][_0x11bda8(0x330)][_0x11bda8(0x302)]({'_sum':{'amount':!![]},'where':{'shopId':_0x1a34be['id'],'status':'COMPLETED','createdAt':{'gte':_0x1455cf,'lte':_0x5470dc}}})]),_0x1411ed=_0x56525e[_0x11bda8(0x2bd)][_0x11bda8(0x294)]||0x0,_0x41a797=_0x1a2fe9[_0x11bda8(0x2bd)][_0x11bda8(0x294)]||0x0,_0x3c4727=await Promise[_0x11bda8(0x2da)](_0x4b8195[_0x11bda8(0x332)](async _0x2ceeb9=>{const _0x1b7a7b=_0x11bda8,_0x5cd79b=await database_1[_0x1b7a7b(0x311)]['payment'][_0x1b7a7b(0x207)]({'where':{'shopId':_0x1a34be['id'],'status':_0x1b7a7b(0x24d),'gateway':_0x2ceeb9[_0x1b7a7b(0x227)]},'select':{'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![]}});let _0x172ec6=0x2d;if(_0x1a34be[_0x1b7a7b(0x248)])try{const _0x1b8d1a=JSON[_0x1b7a7b(0x36f)](_0x1a34be['gatewaySettings']);for(const [_0x6eecc8,_0xc6fb31]of Object['entries'](_0x1b8d1a)){if(_0x6eecc8[_0x1b7a7b(0x231)]()===_0x2ceeb9[_0x1b7a7b(0x227)][_0x1b7a7b(0x231)]()){_0x172ec6=_0xc6fb31[_0x1b7a7b(0x22a)]||0xa,console[_0x1b7a7b(0x35a)](_0x1b7a7b(0x305)+_0x2ceeb9[_0x1b7a7b(0x227)]+_0x1b7a7b(0x314)+_0x1a34be['id']+':\x20commission\x20=\x20'+_0x172ec6+'%');break;}}}catch(_0x2dbc23){console[_0x1b7a7b(0x2a7)](_0x1b7a7b(0x353)+_0x1a34be['id']+':',_0x2dbc23);}const _0x59a7cf=_0x2ceeb9[_0x1b7a7b(0x2bd)]?.[_0x1b7a7b(0x34b)]||0x0;let _0x5b1d47=0x0;for(const _0x283865 of _0x5cd79b){if(_0x283865[_0x1b7a7b(0x30a)]!==null&&_0x283865[_0x1b7a7b(0x30a)]!==undefined)_0x5b1d47+=_0x283865['amountAfterGatewayCommissionUSDT'];else{const _0x17e582=_0x283865[_0x1b7a7b(0x34b)]||0x0;_0x5b1d47+=_0x17e582*(0x1-_0x172ec6/0x64);}}return{'gateway':_0x2ceeb9['gateway'],'count':_0x2ceeb9[_0x1b7a7b(0x2b1)]?.['id']||0x0,'amountUSDT':Math[_0x1b7a7b(0x1f0)](_0x59a7cf*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x1b7a7b(0x1f0)](_0x5b1d47*0x64)/0x64,'commission':_0x172ec6};})),_0x20ccbe=_0x3c4727[_0x11bda8(0x29f)]((_0x31d9cb,_0x5db8c8)=>_0x31d9cb+_0x5db8c8[_0x11bda8(0x34b)],0x0),_0x1ef247=_0x3c4727['reduce']((_0x1be341,_0x312744)=>_0x1be341+_0x312744[_0x11bda8(0x1c3)],0x0),_0x12d4fe=_0x1a34be[_0x11bda8(0x1e8)];return console['log']('üí∞\x20[PAYOUT]\x20Merchant\x20'+_0x1a34be[_0x11bda8(0x2f9)]+':'),console[_0x11bda8(0x35a)](_0x11bda8(0x213)+_0x20ccbe[_0x11bda8(0x2d8)](0x2)+_0x11bda8(0x1e7)),console['log'](_0x11bda8(0x2ae)+_0x1ef247[_0x11bda8(0x2d8)](0x2)+'\x20USDT\x20(theoretical\x20net)'),console['log']('\x20\x20\x20‚úÖ\x20Actual\x20available\x20balance:\x20'+_0x12d4fe['toFixed'](0x2)+'\x20USDT\x20(current\x20balance\x20in\x20DB)'),console['log'](_0x11bda8(0x366)+_0x1411ed[_0x11bda8(0x2d8)](0x2)+_0x11bda8(0x1e0)),console[_0x11bda8(0x35a)](_0x11bda8(0x30e)+(_0x1ef247-_0x1411ed-_0x12d4fe)[_0x11bda8(0x2d8)](0x2)+_0x11bda8(0x24e)),{'id':_0x1a34be['id'],'fullName':_0x1a34be[_0x11bda8(0x22f)],'username':_0x1a34be[_0x11bda8(0x2f9)],'telegramId':_0x1a34be[_0x11bda8(0x1d3)],'merchantUrl':_0x1a34be[_0x11bda8(0x324)],'wallets':{'usdtPolygonWallet':_0x1a34be[_0x11bda8(0x385)],'usdtTrcWallet':_0x1a34be[_0x11bda8(0x1c4)],'usdtErcWallet':_0x1a34be[_0x11bda8(0x260)],'usdcPolygonWallet':_0x1a34be[_0x11bda8(0x21c)],'usdcErcWallet':_0x1a34be[_0x11bda8(0x28f)]},'totalAmountUSDT':Math[_0x11bda8(0x1f0)](_0x20ccbe*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x1ef247*0x64)/0x64,'currentBalance':Math[_0x11bda8(0x371)](_0x12d4fe*0x64)/0x64,'totalPayout':Math[_0x11bda8(0x1f0)](_0x1411ed*0x64)/0x64,'thisMonth':Math[_0x11bda8(0x1f0)](_0x41a797*0x64)/0x64,'paymentsCount':_0x3faaf6,'oldestPaymentDate':_0x2822db?.[_0x11bda8(0x364)]||_0x1a34be['createdAt'],'gatewayBreakdown':_0x3c4727};})),_0x3deb7f=_0x52ba37[_0x95deb9(0x29f)]((_0x333606,_0x306402)=>_0x333606+_0x306402[_0x95deb9(0x38f)],0x0),_0x17ba74=_0x52ba37[_0x95deb9(0x29f)]((_0x4e5a27,_0x340274)=>_0x4e5a27+_0x340274[_0x95deb9(0x283)],0x0),_0xb4597e=_0x52ba37[_0x95deb9(0x29f)]((_0x59d086,_0x21ada3)=>_0x59d086+_0x21ada3[_0x95deb9(0x257)],0x0),_0x364592=_0x52ba37[_0x95deb9(0x29f)]((_0xf4ac37,_0x545535)=>_0xf4ac37+_0x545535[_0x95deb9(0x2a9)],0x0);return console[_0x95deb9(0x35a)](_0x95deb9(0x29a)+_0x367152+_0x95deb9(0x2e1)),console['log'](_0x95deb9(0x335)+Math['round'](_0x3deb7f*0x64)/0x64+_0x95deb9(0x1e7)),console[_0x95deb9(0x35a)](_0x95deb9(0x1ce)+Math[_0x95deb9(0x1f0)](_0x17ba74*0x64)/0x64+'\x20USDT\x20(rounded\x20to\x202\x20decimal\x20places)'),console[_0x95deb9(0x35a)](_0x95deb9(0x21e)+Math[_0x95deb9(0x1f0)](_0xb4597e*0x64)/0x64+_0x95deb9(0x243)),console['log'](_0x95deb9(0x35c)+Math[_0x95deb9(0x1f0)](_0x364592*0x64)/0x64+_0x95deb9(0x243)),{'merchants':_0x52ba37,'pagination':{'page':_0x10e600,'limit':_0x614c52,'total':_0x367152,'totalPages':Math['ceil'](_0x367152/_0x614c52)},'summary':{'totalMerchants':_0x367152,'totalAmountUSDT':Math[_0x95deb9(0x1f0)](_0x3deb7f*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x95deb9(0x1f0)](_0x17ba74*0x64)/0x64,'totalPayout':Math[_0x95deb9(0x1f0)](_0xb4597e*0x64)/0x64,'thisMonth':Math[_0x95deb9(0x1f0)](_0x364592*0x64)/0x64}};}async['createPayout'](_0x451bed){const _0x3e5302=a53_0xce6f5b,{shopId:_0x397cf1,amount:_0x37a84c,network:_0x12cb14,wallet:_0xa97cc7,notes:_0x38d940,txid:_0x5228d0,periodFrom:_0x40214c,periodTo:_0x4a1c77}=_0x451bed,_0x8377e1=await database_1[_0x3e5302(0x311)]['$transaction'](async _0x19673c=>{const _0x3682be=_0x3e5302,_0x579f34=await _0x19673c[_0x3682be(0x28c)]['findUnique']({'where':{'id':_0x397cf1},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x579f34)throw new Error(_0x3682be(0x2cc));console[_0x3682be(0x35a)](_0x3682be(0x23e)+_0x579f34['username']+':'),console[_0x3682be(0x35a)]('\x20\x20\x20Current\x20balance:\x20'+_0x579f34[_0x3682be(0x1e8)]['toFixed'](0x6)+_0x3682be(0x243)),console[_0x3682be(0x35a)](_0x3682be(0x2f3)+_0x37a84c[_0x3682be(0x2d8)](0x6)+_0x3682be(0x243)),console[_0x3682be(0x35a)]('\x20\x20\x20Current\x20total\x20paid\x20out:\x20'+_0x579f34[_0x3682be(0x295)]['toFixed'](0x6)+'\x20USDT');if(_0x5228d0)console[_0x3682be(0x35a)](_0x3682be(0x37f)+_0x5228d0);const _0x3326b6=0.000001,_0x2e1c40=Number(_0x579f34[_0x3682be(0x1e8)]),_0x3a3089=Number(_0x37a84c);console['log'](_0x3682be(0x278)),console[_0x3682be(0x35a)]('\x20\x20\x20Available\x20(raw):\x20'+_0x579f34[_0x3682be(0x1e8)]),console[_0x3682be(0x35a)]('\x20\x20\x20Available\x20(number):\x20'+_0x2e1c40),console['log'](_0x3682be(0x21f)+_0x3a3089),console['log'](_0x3682be(0x1d9)+(_0x2e1c40-_0x3a3089)),console[_0x3682be(0x35a)](_0x3682be(0x1ec)+_0x3326b6);if(_0x2e1c40<_0x3a3089-_0x3326b6)throw new Error(_0x3682be(0x26f)+_0x2e1c40[_0x3682be(0x2d8)](0x6)+_0x3682be(0x28b)+_0x3a3089[_0x3682be(0x2d8)](0x6)+_0x3682be(0x29e)+(_0x2e1c40-_0x3a3089)[_0x3682be(0x2d8)](0x8)+_0x3682be(0x243));console[_0x3682be(0x35a)](_0x3682be(0x346));const _0xb5c076=Math[_0x3682be(0x256)](_0x2e1c40,_0x3a3089);let _0x439e4c=_0xa97cc7;console['log'](_0x3682be(0x25b)+(_0xa97cc7||_0x3682be(0x1fc)));if(!_0x439e4c){console['log'](_0x3682be(0x2b5));const _0x286e2b=await _0x19673c[_0x3682be(0x28c)]['findUnique']({'where':{'id':_0x397cf1},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});console[_0x3682be(0x35a)](_0x3682be(0x217),_0x286e2b);if(_0x286e2b)switch(_0x12cb14){case _0x3682be(0x1ef):_0x439e4c=_0x286e2b[_0x3682be(0x385)]||undefined,console[_0x3682be(0x35a)](_0x3682be(0x36a)+_0x439e4c);break;case _0x3682be(0x326):_0x439e4c=_0x286e2b[_0x3682be(0x1c4)]||undefined,console[_0x3682be(0x35a)]('üîç\x20Selected\x20trc20\x20wallet:\x20'+_0x439e4c);break;case _0x3682be(0x1c5):_0x439e4c=_0x286e2b['usdtErcWallet']||undefined,console[_0x3682be(0x35a)](_0x3682be(0x2c3)+_0x439e4c);break;case _0x3682be(0x25f):_0x439e4c=_0x286e2b[_0x3682be(0x21c)]||undefined,console[_0x3682be(0x35a)](_0x3682be(0x361)+_0x439e4c);break;case'erc20_usdc':_0x439e4c=_0x286e2b[_0x3682be(0x28f)]||undefined,console['log'](_0x3682be(0x32b)+_0x439e4c);break;}}else console[_0x3682be(0x35a)](_0x3682be(0x25c)+_0x439e4c);console[_0x3682be(0x35a)](_0x3682be(0x2a3)+_0x12cb14+':\x20'+(_0x439e4c||_0x3682be(0x1d7))),console[_0x3682be(0x35a)](_0x3682be(0x268),{'shopId':_0x397cf1,'amount':_0xb5c076,'network':_0x12cb14,'wallet':_0x439e4c,'status':_0x3682be(0x327),'txid':_0x5228d0,'notes':_0x38d940,'periodFrom':_0x40214c?new Date(_0x40214c):null,'periodTo':_0x4a1c77?new Date(_0x4a1c77):null});const _0x2b4437=await _0x19673c['payout'][_0x3682be(0x312)]({'data':{'shopId':_0x397cf1,'amount':_0xb5c076,'network':_0x12cb14,'wallet':_0x439e4c,'status':'COMPLETED','txid':_0x5228d0,'notes':_0x38d940,'periodFrom':_0x40214c?new Date(_0x40214c):null,'periodTo':_0x4a1c77?new Date(_0x4a1c77):null,'createdAt':new Date(),'paidAt':new Date()}});console[_0x3682be(0x35a)]('‚úÖ\x20Payout\x20created\x20in\x20DB:',{'id':_0x2b4437['id'],'wallet':_0x2b4437[_0x3682be(0x31e)],'network':_0x2b4437['network'],'amount':_0x2b4437['amount']});const _0x22c7a9=_0x2e1c40-_0xb5c076,_0x101596=Number(_0x579f34[_0x3682be(0x295)])+_0xb5c076;return await _0x19673c[_0x3682be(0x28c)][_0x3682be(0x2ce)]({'where':{'id':_0x397cf1},'data':{'balance':_0x22c7a9,'totalPaidOut':_0x101596}}),console['log'](_0x3682be(0x37e)+_0x579f34[_0x3682be(0x2f9)]+'\x20balance\x20updated:'),console['log']('\x20\x20\x20Balance:\x20'+_0x2e1c40[_0x3682be(0x2d8)](0x6)+'\x20->\x20'+_0x22c7a9[_0x3682be(0x2d8)](0x6)+_0x3682be(0x1d2)+_0xb5c076['toFixed'](0x6)+')'),console[_0x3682be(0x35a)](_0x3682be(0x1d5)+_0x579f34['totalPaidOut'][_0x3682be(0x2d8)](0x6)+_0x3682be(0x284)+_0x101596[_0x3682be(0x2d8)](0x6)+_0x3682be(0x293)+_0xb5c076['toFixed'](0x6)+')'),console[_0x3682be(0x35a)](_0x3682be(0x383)+_0xb5c076['toFixed'](0x6)+_0x3682be(0x243)),{'payout':_0x2b4437,'shop':_0x579f34};});console[_0x3e5302(0x35a)](_0x3e5302(0x378)+_0x8377e1['payout']['id']+'\x20for\x20shop\x20'+_0x8377e1[_0x3e5302(0x28c)][_0x3e5302(0x2f9)]+'\x20('+_0x8377e1['payout']['amount'][_0x3e5302(0x2d8)](0x6)+_0x3e5302(0x240));try{let _0x2dafcd='–ù–µ\x20—É–∫–∞–∑–∞–Ω';if(_0x8377e1['payout'][_0x3e5302(0x379)]&&_0x8377e1[_0x3e5302(0x330)]['periodTo']){const _0x4cd501=new Date(_0x8377e1[_0x3e5302(0x330)][_0x3e5302(0x379)])[_0x3e5302(0x255)](_0x3e5302(0x269)),_0x56e070=new Date(_0x8377e1[_0x3e5302(0x330)][_0x3e5302(0x32d)])[_0x3e5302(0x255)](_0x3e5302(0x269));_0x2dafcd=_0x4cd501+'\x20-\x20'+_0x56e070;}await telegramBotService_1['telegramBotService'][_0x3e5302(0x245)](_0x8377e1[_0x3e5302(0x330)][_0x3e5302(0x202)],{'id':_0x8377e1['payout']['id'],'amount':_0x8377e1['payout']['amount'],'network':_0x8377e1[_0x3e5302(0x330)][_0x3e5302(0x34a)],'wallet':_0x8377e1[_0x3e5302(0x330)][_0x3e5302(0x31e)],'period':_0x2dafcd,'createdAt':_0x8377e1[_0x3e5302(0x330)][_0x3e5302(0x359)],'txid':_0x8377e1[_0x3e5302(0x330)][_0x3e5302(0x1f3)]}),console[_0x3e5302(0x35a)](_0x3e5302(0x274)+_0x8377e1[_0x3e5302(0x330)]['id']);}catch(_0x587ddb){console[_0x3e5302(0x2a7)](_0x3e5302(0x2be)+_0x8377e1['payout']['id']+':',_0x587ddb);}return{'id':_0x8377e1['payout']['id'],'shopId':_0x8377e1[_0x3e5302(0x330)][_0x3e5302(0x202)],'shopName':_0x8377e1[_0x3e5302(0x28c)][_0x3e5302(0x22f)],'shopUsername':_0x8377e1[_0x3e5302(0x28c)][_0x3e5302(0x2f9)],'amount':_0x8377e1[_0x3e5302(0x330)][_0x3e5302(0x294)],'network':_0x8377e1[_0x3e5302(0x330)][_0x3e5302(0x34a)],'wallet':_0x8377e1[_0x3e5302(0x330)]['wallet'],'status':_0x8377e1[_0x3e5302(0x330)][_0x3e5302(0x23d)],'txid':_0x8377e1['payout'][_0x3e5302(0x1f3)],'notes':_0x8377e1[_0x3e5302(0x330)][_0x3e5302(0x289)],'periodFrom':_0x8377e1[_0x3e5302(0x330)][_0x3e5302(0x379)],'periodTo':_0x8377e1[_0x3e5302(0x330)][_0x3e5302(0x32d)],'createdAt':_0x8377e1[_0x3e5302(0x330)][_0x3e5302(0x359)],'paidAt':_0x8377e1[_0x3e5302(0x330)][_0x3e5302(0x364)]};}async[a53_0xce6f5b(0x1df)](_0x4c74ee){const _0x54d007=a53_0xce6f5b,{page:_0x38fbe9,limit:_0x548174,shopId:_0x4d4693,network:_0x51ebea,dateFrom:_0x10a60a,dateTo:_0x244d8e,search:_0x122cfd}=_0x4c74ee,_0x397200=(_0x38fbe9-0x1)*_0x548174,_0x2a9b03={};_0x4d4693&&(_0x2a9b03[_0x54d007(0x202)]=_0x4d4693);_0x51ebea&&(_0x2a9b03[_0x54d007(0x34a)]=_0x51ebea);if(_0x10a60a||_0x244d8e){_0x2a9b03[_0x54d007(0x359)]={};if(_0x10a60a){const _0x47dd2e=new Date(_0x10a60a);_0x47dd2e['setHours'](0x0,0x0,0x0,0x1),_0x2a9b03[_0x54d007(0x359)][_0x54d007(0x386)]=_0x47dd2e,console[_0x54d007(0x35a)](_0x54d007(0x220)+_0x47dd2e[_0x54d007(0x320)]());}if(_0x244d8e){const _0x5662ab=new Date(_0x244d8e);_0x5662ab[_0x54d007(0x35b)](0x17,0x3b,0x3b,0x3e7),_0x2a9b03[_0x54d007(0x359)][_0x54d007(0x2e2)]=_0x5662ab,console[_0x54d007(0x35a)]('üìÖ\x20Payout\x20date\x20to\x20filter:\x20'+_0x5662ab[_0x54d007(0x320)]());}}_0x122cfd&&(_0x2a9b03['OR']=[{'shop':{'name':{'contains':_0x122cfd,'mode':_0x54d007(0x1d4)}}},{'shop':{'username':{'contains':_0x122cfd,'mode':'insensitive'}}},{'notes':{'contains':_0x122cfd,'mode':_0x54d007(0x1d4)}}]);const [_0x3ac1cc,_0x489cc3]=await Promise[_0x54d007(0x2da)]([database_1['default'][_0x54d007(0x330)][_0x54d007(0x207)]({'where':_0x2a9b03,'skip':_0x397200,'take':_0x548174,'orderBy':{'createdAt':_0x54d007(0x333)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'wallet':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x54d007(0x311)][_0x54d007(0x330)][_0x54d007(0x229)]({'where':_0x2a9b03})]);return{'payouts':_0x3ac1cc[_0x54d007(0x332)](_0x2f644e=>({'id':_0x2f644e['id'],'shopId':_0x2f644e['shopId'],'shopName':_0x2f644e[_0x54d007(0x28c)][_0x54d007(0x22f)],'shopUsername':_0x2f644e['shop'][_0x54d007(0x2f9)],'amount':_0x2f644e[_0x54d007(0x294)],'network':_0x2f644e[_0x54d007(0x34a)],'wallet':_0x2f644e[_0x54d007(0x31e)],'status':_0x2f644e[_0x54d007(0x23d)],'txid':_0x2f644e[_0x54d007(0x1f3)],'notes':_0x2f644e[_0x54d007(0x289)],'periodFrom':_0x2f644e[_0x54d007(0x379)],'periodTo':_0x2f644e[_0x54d007(0x32d)],'createdAt':_0x2f644e[_0x54d007(0x359)],'paidAt':_0x2f644e[_0x54d007(0x364)]})),'pagination':{'page':_0x38fbe9,'limit':_0x548174,'total':_0x489cc3,'totalPages':Math[_0x54d007(0x26b)](_0x489cc3/_0x548174)}};}async[a53_0xce6f5b(0x33f)](_0x5c9825){const _0x68de38=a53_0xce6f5b,_0x243b32=await database_1[_0x68de38(0x311)][_0x68de38(0x330)][_0x68de38(0x368)]({'where':{'id':_0x5c9825},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x243b32)return null;return{'id':_0x243b32['id'],'shopId':_0x243b32['shopId'],'shopName':_0x243b32['shop']['name'],'shopUsername':_0x243b32[_0x68de38(0x28c)]['username'],'amount':_0x243b32[_0x68de38(0x294)],'network':_0x243b32['network'],'wallet':_0x243b32[_0x68de38(0x31e)],'status':_0x243b32[_0x68de38(0x23d)],'txid':_0x243b32[_0x68de38(0x1f3)],'notes':_0x243b32[_0x68de38(0x289)],'periodFrom':_0x243b32['periodFrom'],'periodTo':_0x243b32['periodTo'],'createdAt':_0x243b32[_0x68de38(0x359)],'paidAt':_0x243b32[_0x68de38(0x364)]};}async[a53_0xce6f5b(0x1c8)](_0xc3f65e){const _0x2daf09=a53_0xce6f5b;await database_1['default'][_0x2daf09(0x330)]['delete']({'where':{'id':_0xc3f65e}});}async['updatePayout'](_0x19f88f,_0xd34d51){const _0x584729=a53_0xce6f5b,_0x2106ee=await database_1[_0x584729(0x311)]['$transaction'](async _0x5522ee=>{const _0x4d43b7=_0x584729,_0x3467f5=await _0x5522ee[_0x4d43b7(0x330)]['findUnique']({'where':{'id':_0x19f88f},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}}}});if(!_0x3467f5)throw new Error(_0x4d43b7(0x1ea));console['log']('üí∞\x20Updating\x20payout\x20'+_0x19f88f+_0x4d43b7(0x314)+_0x3467f5[_0x4d43b7(0x28c)][_0x4d43b7(0x2f9)]+':'),console[_0x4d43b7(0x35a)]('\x20\x20\x20Current\x20amount:\x20'+_0x3467f5[_0x4d43b7(0x294)][_0x4d43b7(0x2d8)](0x6)+'\x20USDT'),console['log'](_0x4d43b7(0x316)+_0x3467f5[_0x4d43b7(0x34a)]),console['log'](_0x4d43b7(0x1fa)+_0x3467f5[_0x4d43b7(0x28c)][_0x4d43b7(0x1e8)][_0x4d43b7(0x2d8)](0x6)+'\x20USDT'),console[_0x4d43b7(0x35a)](_0x4d43b7(0x2a0)+_0x3467f5['shop'][_0x4d43b7(0x295)][_0x4d43b7(0x2d8)](0x6)+_0x4d43b7(0x243));let _0x4b3acd=0x0;if(_0xd34d51[_0x4d43b7(0x294)]!==undefined){const _0x367354=Number(_0x3467f5[_0x4d43b7(0x294)]),_0x2fb3c4=Number(_0xd34d51[_0x4d43b7(0x294)]);_0x4b3acd=_0x2fb3c4-_0x367354,console[_0x4d43b7(0x35a)](_0x4d43b7(0x2b3)+_0x2fb3c4['toFixed'](0x6)+_0x4d43b7(0x243)),console['log'](_0x4d43b7(0x20f)+_0x4b3acd[_0x4d43b7(0x2d8)](0x6)+_0x4d43b7(0x243));if(_0x4b3acd<0x0)console[_0x4d43b7(0x35a)](_0x4d43b7(0x36e)+Math['abs'](_0x4b3acd)[_0x4d43b7(0x2d8)](0x6)+_0x4d43b7(0x2f7));else{if(_0x4b3acd>0x0){const _0x22d614=Number(_0x3467f5['shop'][_0x4d43b7(0x1e8)]);console[_0x4d43b7(0x35a)](_0x4d43b7(0x2fd)+_0x4b3acd[_0x4d43b7(0x2d8)](0x6)+_0x4d43b7(0x2c4));if(_0x22d614<_0x4b3acd)throw new Error(_0x4d43b7(0x2ba)+_0x22d614[_0x4d43b7(0x2d8)](0x6)+_0x4d43b7(0x1fd)+_0x4b3acd[_0x4d43b7(0x2d8)](0x6)+'\x20USDT');}}}const _0x3d4d8c={};if(_0xd34d51['amount']!==undefined)_0x3d4d8c[_0x4d43b7(0x294)]=_0xd34d51['amount'];if(_0xd34d51['network']!==undefined)_0x3d4d8c[_0x4d43b7(0x34a)]=_0xd34d51[_0x4d43b7(0x34a)];if(_0xd34d51['wallet']!==undefined)_0x3d4d8c[_0x4d43b7(0x31e)]=_0xd34d51[_0x4d43b7(0x31e)]||null;if(_0xd34d51['notes']!==undefined)_0x3d4d8c[_0x4d43b7(0x289)]=_0xd34d51[_0x4d43b7(0x289)]||null;if(_0xd34d51['txid']!==undefined)_0x3d4d8c['txid']=_0xd34d51['txid']||null;if(_0xd34d51['periodFrom']!==undefined)_0x3d4d8c[_0x4d43b7(0x379)]=_0xd34d51[_0x4d43b7(0x379)]?new Date(_0xd34d51[_0x4d43b7(0x379)]):null;if(_0xd34d51[_0x4d43b7(0x32d)]!==undefined)_0x3d4d8c[_0x4d43b7(0x32d)]=_0xd34d51[_0x4d43b7(0x32d)]?new Date(_0xd34d51['periodTo']):null;const _0x9f2b31=await _0x5522ee[_0x4d43b7(0x330)]['update']({'where':{'id':_0x19f88f},'data':_0x3d4d8c,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(_0x4b3acd!==0x0){const _0x27b667=Number(_0x3467f5[_0x4d43b7(0x28c)][_0x4d43b7(0x1e8)]),_0x8e11ba=Number(_0x3467f5['shop']['totalPaidOut']),_0x43a855=_0x27b667-_0x4b3acd,_0x5dc9db=_0x8e11ba+_0x4b3acd;await _0x5522ee[_0x4d43b7(0x28c)][_0x4d43b7(0x2ce)]({'where':{'id':_0x3467f5['shopId']},'data':{'balance':_0x43a855,'totalPaidOut':_0x5dc9db}}),console[_0x4d43b7(0x35a)]('üí∞\x20Shop\x20'+_0x3467f5['shop'][_0x4d43b7(0x2f9)]+'\x20balance\x20updated:'),console[_0x4d43b7(0x35a)](_0x4d43b7(0x2e3)+_0x27b667[_0x4d43b7(0x2d8)](0x6)+_0x4d43b7(0x284)+_0x43a855[_0x4d43b7(0x2d8)](0x6)+_0x4d43b7(0x243)),console[_0x4d43b7(0x35a)](_0x4d43b7(0x1d5)+_0x8e11ba['toFixed'](0x6)+_0x4d43b7(0x284)+_0x5dc9db[_0x4d43b7(0x2d8)](0x6)+'\x20USDT');}return console[_0x4d43b7(0x35a)](_0x4d43b7(0x209)+_0x19f88f+_0x4d43b7(0x1e3)),_0x9f2b31;});return{'id':_0x2106ee['id'],'shopId':_0x2106ee[_0x584729(0x202)],'shopName':_0x2106ee[_0x584729(0x28c)]['name'],'shopUsername':_0x2106ee['shop'][_0x584729(0x2f9)],'amount':Number(_0x2106ee['amount']),'network':_0x2106ee['network'],'wallet':_0x2106ee[_0x584729(0x31e)],'status':_0x2106ee[_0x584729(0x23d)],'txid':_0x2106ee[_0x584729(0x1f3)],'notes':_0x2106ee[_0x584729(0x289)],'periodFrom':_0x2106ee[_0x584729(0x379)],'periodTo':_0x2106ee['periodTo'],'createdAt':_0x2106ee['createdAt'],'paidAt':_0x2106ee[_0x584729(0x364)]};}async[a53_0xce6f5b(0x271)](_0x3f90fb){const _0xf8fa9b=a53_0xce6f5b,{page:_0x23bb85,limit:_0x2493f0,status:_0x31cb05,gateway:_0x2c3ab3,shopId:_0x37a783,dateFrom:_0x592301,dateTo:_0x4ea66d,search:_0x309b8d,currency:_0x395a32,sortBy:_0x3e54d1,sortOrder:_0x203ad2}=_0x3f90fb,_0x1bb638=(_0x23bb85-0x1)*_0x2493f0;console['log'](_0xf8fa9b(0x355),_0x3f90fb);const _0x4fa9c6=await database_1[_0xf8fa9b(0x311)][_0xf8fa9b(0x313)][_0xf8fa9b(0x334)]({'by':['gateway'],'_count':{'gateway':!![]}});console[_0xf8fa9b(0x35a)](_0xf8fa9b(0x23c),_0x4fa9c6[_0xf8fa9b(0x332)](_0x302a9a=>_0x302a9a[_0xf8fa9b(0x227)]+'\x20('+_0x302a9a[_0xf8fa9b(0x2b1)]['gateway']+'\x20payments)'));if(_0x2c3ab3){const _0x46e4fd=_0x4fa9c6[_0xf8fa9b(0x1f8)](_0x73aa04=>_0x73aa04[_0xf8fa9b(0x227)][_0xf8fa9b(0x231)]()===_0x2c3ab3[_0xf8fa9b(0x231)]());!_0x46e4fd&&_0x2c3ab3[_0xf8fa9b(0x231)]()!==_0xf8fa9b(0x30f)&&console[_0xf8fa9b(0x35a)](_0xf8fa9b(0x208)+_0x2c3ab3+_0xf8fa9b(0x2cd)+_0x4fa9c6[_0xf8fa9b(0x332)](_0x550b4c=>_0x550b4c[_0xf8fa9b(0x227)])['join'](',\x20'));}const _0x2f7e2b={};_0x31cb05&&(_0x2f7e2b[_0xf8fa9b(0x23d)]=_0x31cb05[_0xf8fa9b(0x377)]());if(!_0x2c3ab3)_0x2f7e2b[_0xf8fa9b(0x227)]={'not':'test_gateway'};else{if(_0x2c3ab3&&(_0x2c3ab3[_0xf8fa9b(0x231)]()==='test_gateway'||_0x2c3ab3===_0xf8fa9b(0x27d)))_0x2f7e2b['gateway']=_0xf8fa9b(0x30f);else{let _0xbdda02=_0x2c3ab3;const _0x3f2789=(0x0,gateway_1[_0xf8fa9b(0x31a)])(_0x2c3ab3);if(_0x3f2789)_0xbdda02=_0x3f2789,console['log'](_0xf8fa9b(0x2ea)+_0x2c3ab3+_0xf8fa9b(0x241)+_0xbdda02+'\x27');else{const _0x3b18f7=(0x0,gateway_1[_0xf8fa9b(0x239)])(_0x2c3ab3);if(_0x3b18f7){const _0x528abf=(0x0,gateway_1['getGatewayNameById'])(_0x3b18f7);_0x528abf&&(_0xbdda02=_0x528abf,console['log'](_0xf8fa9b(0x347)+_0x2c3ab3+'\x27\x20->\x20ID\x20\x27'+_0x3b18f7+_0xf8fa9b(0x23a)+_0xbdda02+'\x27'));}else console['log'](_0xf8fa9b(0x337)+_0x2c3ab3+'\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)');}const _0x2f979f=await database_1[_0xf8fa9b(0x311)]['payment'][_0xf8fa9b(0x229)]({'where':{'gateway':_0xbdda02[_0xf8fa9b(0x231)]()},'take':0x1});_0x2f979f===0x0?(console['log']('‚ö†Ô∏è\x20Gateway\x20\x27'+_0xbdda02+_0xf8fa9b(0x1e5)+_0x2c3ab3+_0xf8fa9b(0x2dd)),_0x2f7e2b['gateway']=_0xf8fa9b(0x2fb)):(_0x2f7e2b[_0xf8fa9b(0x227)]=_0xbdda02[_0xf8fa9b(0x231)](),console[_0xf8fa9b(0x35a)]('‚úÖ\x20Using\x20gateway\x20filter:\x20\x27'+_0xbdda02+_0xf8fa9b(0x1e5)+_0x2c3ab3+'\x27)'));}}console['log']('üìä\x20Gateway\x20filter\x20applied:',_0x2f7e2b['gateway']);_0x37a783&&(_0x2f7e2b['shopId']=_0x37a783);_0x395a32&&(_0x2f7e2b[_0xf8fa9b(0x21b)]=_0x395a32['toUpperCase'](),console['log'](_0xf8fa9b(0x340)+_0x395a32[_0xf8fa9b(0x377)]()));if(_0x592301||_0x4ea66d){_0x2f7e2b[_0xf8fa9b(0x359)]={};if(_0x592301){const _0x1931ff=new Date(_0x592301),_0x414c16=new Date(Date['UTC'](_0x1931ff[_0xf8fa9b(0x38a)](),_0x1931ff[_0xf8fa9b(0x363)](),_0x1931ff[_0xf8fa9b(0x2fa)](),0x0,0x0,0x0,0x0));_0x2f7e2b[_0xf8fa9b(0x359)]['gte']=_0x414c16,console[_0xf8fa9b(0x35a)](_0xf8fa9b(0x342)+_0x414c16[_0xf8fa9b(0x320)]());}if(_0x4ea66d){const _0x358e1a=new Date(_0x4ea66d),_0x2874ea=new Date(Date['UTC'](_0x358e1a[_0xf8fa9b(0x38a)](),_0x358e1a['getUTCMonth'](),_0x358e1a[_0xf8fa9b(0x2fa)](),0x17,0x3b,0x3b,0x3e7));_0x2f7e2b[_0xf8fa9b(0x359)][_0xf8fa9b(0x2e2)]=_0x2874ea,console[_0xf8fa9b(0x35a)](_0xf8fa9b(0x296)+_0x2874ea[_0xf8fa9b(0x320)]());}}_0x309b8d&&(_0x2f7e2b['OR']=[{'id':{'contains':_0x309b8d,'mode':_0xf8fa9b(0x1d4)}},{'orderId':{'contains':_0x309b8d,'mode':_0xf8fa9b(0x1d4)}},{'gatewayOrderId':{'contains':_0x309b8d,'mode':_0xf8fa9b(0x1d4)}},{'customerEmail':{'contains':_0x309b8d,'mode':_0xf8fa9b(0x1d4)}},{'shop':{'name':{'contains':_0x309b8d,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x309b8d,'mode':_0xf8fa9b(0x1d4)}}}]);console[_0xf8fa9b(0x35a)](_0xf8fa9b(0x219),JSON[_0xf8fa9b(0x236)](_0x2f7e2b,null,0x2));const _0x217027=await database_1['default']['payment'][_0xf8fa9b(0x229)]({'where':_0x2f7e2b});console[_0xf8fa9b(0x35a)](_0xf8fa9b(0x331)+_0x217027);let _0x14913a={'createdAt':_0xf8fa9b(0x333)};if(_0x3e54d1){const _0x478f0b=[_0xf8fa9b(0x294),_0xf8fa9b(0x359),_0xf8fa9b(0x28d),'status',_0xf8fa9b(0x227),'currency'],_0x24c5c1=['asc','desc'];if(_0x478f0b[_0xf8fa9b(0x2bf)](_0x3e54d1)){const _0x3b0ba7=_0x24c5c1[_0xf8fa9b(0x2bf)](_0x203ad2)?_0x203ad2:_0xf8fa9b(0x333);_0x14913a={[_0x3e54d1]:_0x3b0ba7},console[_0xf8fa9b(0x35a)](_0xf8fa9b(0x26c)+_0x3e54d1+_0xf8fa9b(0x292)+_0x3b0ba7+_0xf8fa9b(0x263));}}const [_0x3edf32,_0x240793]=await Promise[_0xf8fa9b(0x2da)]([database_1['default'][_0xf8fa9b(0x313)][_0xf8fa9b(0x207)]({'where':_0x2f7e2b,'skip':_0x1bb638,'take':_0x2493f0,'orderBy':_0x14913a,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0xf8fa9b(0x311)][_0xf8fa9b(0x313)][_0xf8fa9b(0x229)]({'where':_0x2f7e2b})]);let _0x201c36,_0x29162b;if(_0x592301){const _0x199977=new Date(_0x592301);_0x201c36=new Date(Date['UTC'](_0x199977[_0xf8fa9b(0x38a)](),_0x199977[_0xf8fa9b(0x363)](),_0x199977[_0xf8fa9b(0x2fa)](),0x0,0x0,0x0,0x0));}else{const _0x400d32=new Date();_0x201c36=new Date(Date['UTC'](_0x400d32[_0xf8fa9b(0x38a)](),_0x400d32[_0xf8fa9b(0x363)](),_0x400d32[_0xf8fa9b(0x2fa)](),0x0,0x0,0x0,0x0));}if(_0x4ea66d){const _0x3af11b=new Date(_0x4ea66d);_0x29162b=new Date(Date[_0xf8fa9b(0x254)](_0x3af11b[_0xf8fa9b(0x38a)](),_0x3af11b[_0xf8fa9b(0x363)](),_0x3af11b[_0xf8fa9b(0x2fa)](),0x17,0x3b,0x3b,0x3e7));}else{if(_0x592301){const _0x10adde=new Date(_0x592301);_0x29162b=new Date(Date[_0xf8fa9b(0x254)](_0x10adde[_0xf8fa9b(0x38a)](),_0x10adde['getUTCMonth'](),_0x10adde['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}else{const _0x4dcf2a=new Date();_0x29162b=new Date(Date[_0xf8fa9b(0x254)](_0x4dcf2a[_0xf8fa9b(0x38a)](),_0x4dcf2a[_0xf8fa9b(0x363)](),_0x4dcf2a[_0xf8fa9b(0x2fa)](),0x17,0x3b,0x3b,0x3e7));}}const _0x23cf4c={};{const _0x26ff54={'status':_0x31cb05?_0x31cb05[_0xf8fa9b(0x377)]():'PAID','createdAt':{'gte':_0x201c36,'lte':_0x29162b}};_0x2c3ab3?_0x26ff54[_0xf8fa9b(0x227)]=_0x2f7e2b[_0xf8fa9b(0x227)]:_0x26ff54['gateway']={'not':'test_gateway'};_0x37a783&&(_0x26ff54['shopId']=_0x37a783);_0x395a32&&(_0x26ff54[_0xf8fa9b(0x21b)]=_0x395a32[_0xf8fa9b(0x377)]());console[_0xf8fa9b(0x35a)](_0xf8fa9b(0x2e0),JSON['stringify'](_0x26ff54,null,0x2));const _0x56fd9c=await database_1['default'][_0xf8fa9b(0x313)][_0xf8fa9b(0x207)]({'where':_0x26ff54,'select':{'amountUSDT':!![],'currency':!![],'amount':!![]}});let _0x25b46a=0x0;_0x56fd9c[_0xf8fa9b(0x389)](_0x4edb28=>{const _0x1d120f=_0xf8fa9b;_0x4edb28['amountUSDT']&&(_0x25b46a+=_0x4edb28[_0x1d120f(0x34b)]);if(_0x4edb28['currency']){const _0x3baa06=_0x4edb28['currency']['toUpperCase']();!_0x23cf4c[_0x3baa06]&&(_0x23cf4c[_0x3baa06]=0x0),_0x23cf4c[_0x3baa06]+=_0x4edb28[_0x1d120f(0x294)];}}),_0x25b46a>0x0&&(_0x23cf4c['USDT']=_0x25b46a);}return{'payments':_0x3edf32,'pagination':{'page':_0x23bb85,'limit':_0x2493f0,'total':_0x240793,'totalPages':Math[_0xf8fa9b(0x26b)](_0x240793/_0x2493f0)},'statistics':_0x23cf4c};}async['getPaymentById'](_0x3a45ff){const _0x48fd67=a53_0xce6f5b,_0x1962bf=await database_1[_0x48fd67(0x311)][_0x48fd67(0x313)][_0x48fd67(0x368)]({'where':{'id':_0x3a45ff},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x1962bf)return null;return{'id':_0x1962bf['id'],'shopId':_0x1962bf[_0x48fd67(0x202)],'gateway':_0x1962bf[_0x48fd67(0x227)],'amount':_0x1962bf[_0x48fd67(0x294)],'currency':_0x1962bf[_0x48fd67(0x21b)],'status':_0x1962bf[_0x48fd67(0x23d)],'orderId':_0x1962bf['orderId'],'gatewayOrderId':_0x1962bf['gatewayOrderId'],'customerEmail':_0x1962bf[_0x48fd67(0x2fe)],'customerName':_0x1962bf[_0x48fd67(0x26d)],'customerCountry':_0x1962bf['customerCountry'],'customerIp':_0x1962bf[_0x48fd67(0x37c)],'customerUa':_0x1962bf[_0x48fd67(0x1f5)],'failureMessage':_0x1962bf[_0x48fd67(0x356)],'externalPaymentUrl':_0x1962bf[_0x48fd67(0x345)],'successUrl':_0x1962bf[_0x48fd67(0x388)],'failUrl':_0x1962bf[_0x48fd67(0x267)],'pendingUrl':_0x1962bf[_0x48fd67(0x2b4)],'whiteUrl':_0x1962bf[_0x48fd67(0x32f)],'createdAt':_0x1962bf['createdAt'],'updatedAt':_0x1962bf[_0x48fd67(0x28d)],'shop':_0x1962bf[_0x48fd67(0x28c)]};}async[a53_0xce6f5b(0x1cc)](_0x31383c,_0x25d8ad,_0x5ceeb9,_0x5ee961){const _0x35dd6b=a53_0xce6f5b,_0x4dec0e=await database_1['default'][_0x35dd6b(0x36d)](async _0x159fbd=>{const _0x19c25b=_0x35dd6b,_0x319120=await _0x159fbd[_0x19c25b(0x313)][_0x19c25b(0x368)]({'where':{'id':_0x31383c},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x319120)throw new Error(_0x19c25b(0x308));const _0x5c5baf=_0x319120[_0x19c25b(0x23d)],_0xb88e76=_0x25d8ad[_0x19c25b(0x377)]();console[_0x19c25b(0x35a)](_0x19c25b(0x37a)+_0x31383c+_0x19c25b(0x201)+_0x5c5baf+_0x19c25b(0x284)+_0xb88e76),console[_0x19c25b(0x35a)]('üí∞\x20Current\x20shop\x20balance:\x20'+_0x319120[_0x19c25b(0x28c)][_0x19c25b(0x1e8)]+'\x20USDT');const _0x828a47={'status':_0xb88e76,'updatedAt':new Date(),'statusChangedBy':_0x19c25b(0x1db),'statusChangedAt':new Date()};_0x5ceeb9&&(_0x828a47[_0x19c25b(0x20a)]=_0x5ceeb9);_0xb88e76===_0x19c25b(0x381)&&_0x5ee961&&(_0x828a47[_0x19c25b(0x2bb)]=_0x5ee961);let _0x1a1e09=0x0,_0x524c02=_0x319120['shop'][_0x19c25b(0x1e8)];if(_0xb88e76===_0x19c25b(0x24d)&&_0x5c5baf!==_0x19c25b(0x24d)){_0x828a47[_0x19c25b(0x364)]=new Date();const _0xae20c3=await currencyService_1['currencyService'][_0x19c25b(0x272)](_0x319120['amount'],_0x319120[_0x19c25b(0x21b)]);_0x828a47[_0x19c25b(0x34b)]=_0xae20c3;let _0x2d36e7=0x2d;const _0xa302a9=await _0x159fbd[_0x19c25b(0x28c)][_0x19c25b(0x368)]({'where':{'id':_0x319120[_0x19c25b(0x202)]},'select':{'gatewaySettings':!![]}});if(_0xa302a9?.[_0x19c25b(0x248)])try{const _0x418749=JSON[_0x19c25b(0x36f)](_0xa302a9[_0x19c25b(0x248)]);for(const [_0x40901c,_0xfda989]of Object[_0x19c25b(0x2f1)](_0x418749)){if(_0x40901c[_0x19c25b(0x231)]()===_0x319120[_0x19c25b(0x227)]['toLowerCase']()){_0x2d36e7=_0xfda989['commission']||0xa;break;}}}catch(_0x5598c4){console[_0x19c25b(0x2a7)]('Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20'+_0x31383c+':',_0x5598c4);}let _0x923841;_0x319120[_0x19c25b(0x30a)]!==null&&_0x319120[_0x19c25b(0x30a)]!==undefined?(_0x923841=_0x319120['amountAfterGatewayCommissionUSDT'],console[_0x19c25b(0x35a)](_0x19c25b(0x343)+_0x923841[_0x19c25b(0x2d8)](0x6)+_0x19c25b(0x29d)+_0x31383c)):(_0x923841=_0xae20c3*(0x1-_0x2d36e7/0x64),console['log']('üìä\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20'+_0x31383c+':\x20'+_0x2d36e7+_0x19c25b(0x2d6)+_0xae20c3[_0x19c25b(0x2d8)](0x6)+_0x19c25b(0x243)),_0x828a47[_0x19c25b(0x30a)]=_0x923841,_0x828a47[_0x19c25b(0x1ca)]=_0x2d36e7),_0x1a1e09=_0x923841,_0x524c02+=_0x923841,console[_0x19c25b(0x35a)](_0x19c25b(0x387)+_0x31383c+'\x20became\x20PAID:'),console['log'](_0x19c25b(0x306)+_0xae20c3[_0x19c25b(0x2d8)](0x6)+_0x19c25b(0x243)),console[_0x19c25b(0x35a)](_0x19c25b(0x21d)+_0x319120['gateway']+_0x19c25b(0x2df)+_0x2d36e7+'%'),console[_0x19c25b(0x35a)](_0x19c25b(0x349)+_0x923841[_0x19c25b(0x2d8)](0x6)+'\x20USDT\x20(after\x20'+_0x2d36e7+'%\x20commission)'),console[_0x19c25b(0x35a)](_0x19c25b(0x291)+_0x923841['toFixed'](0x6)+_0x19c25b(0x243));}else{if(_0x5c5baf===_0x19c25b(0x24d)&&_0xb88e76!==_0x19c25b(0x24d)&&_0xb88e76!==_0x19c25b(0x381)){if(_0x319120[_0x19c25b(0x34b)]){let _0x1f2024=0x2d;const _0x2d3acd=await _0x159fbd[_0x19c25b(0x28c)]['findUnique']({'where':{'id':_0x319120[_0x19c25b(0x202)]},'select':{'gatewaySettings':!![]}});if(_0x2d3acd?.[_0x19c25b(0x248)])try{const _0x5a0f47=JSON[_0x19c25b(0x36f)](_0x2d3acd[_0x19c25b(0x248)]);for(const [_0x50c5e3,_0x2faf22]of Object[_0x19c25b(0x2f1)](_0x5a0f47)){if(_0x50c5e3['toLowerCase']()===_0x319120[_0x19c25b(0x227)][_0x19c25b(0x231)]()){_0x1f2024=_0x2faf22[_0x19c25b(0x22a)]||0xa;break;}}}catch(_0x4ca15e){console['error'](_0x19c25b(0x2a4)+_0x31383c+':',_0x4ca15e);}const _0x36d8fd=_0x319120[_0x19c25b(0x34b)]*(0x1-_0x1f2024/0x64);_0x1a1e09=-_0x36d8fd,_0x524c02-=_0x36d8fd,console[_0x19c25b(0x35a)](_0x19c25b(0x306)+_0x319120['amountUSDT']['toFixed'](0x6)+'\x20USDT'),console['log'](_0x19c25b(0x21d)+_0x319120[_0x19c25b(0x227)]+_0x19c25b(0x2df)+_0x1f2024+'%'),console['log'](_0x19c25b(0x246)+_0x36d8fd[_0x19c25b(0x2d8)](0x6)+'\x20USDT\x20(after\x20'+_0x1f2024+_0x19c25b(0x20e)),console[_0x19c25b(0x35a)]('\x20\x20\x20Subtracted\x20from\x20balance:\x20-'+_0x36d8fd[_0x19c25b(0x2d8)](0x6)+'\x20USDT');}}}_0xb88e76===_0x19c25b(0x381)&&(console[_0x19c25b(0x35a)](_0x19c25b(0x275)),_0x5ee961&&_0x5ee961>0x0?(_0x1a1e09=-_0x5ee961,_0x524c02-=_0x5ee961,console[_0x19c25b(0x35a)](_0x19c25b(0x1e4)+_0x5ee961[_0x19c25b(0x2d8)](0x6)+_0x19c25b(0x360)),console[_0x19c25b(0x35a)]('üí∞\x20Payment\x20amount\x20is\x20NOT\x20deducted\x20(chargeback\x20penalty\x20only)')):console[_0x19c25b(0x35a)](_0x19c25b(0x216)),_0x828a47[_0x19c25b(0x2bb)]=_0x5ee961||0x0);_0xb88e76===_0x19c25b(0x26e)&&_0x5c5baf===_0x19c25b(0x24d)&&console['log'](_0x19c25b(0x266));const _0x498e92=await _0x159fbd[_0x19c25b(0x313)]['update']({'where':{'id':_0x31383c},'data':_0x828a47,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x1a1e09!==0x0&&(await _0x159fbd[_0x19c25b(0x28c)][_0x19c25b(0x2ce)]({'where':{'id':_0x319120['shopId']},'data':{'balance':_0x524c02}}),console[_0x19c25b(0x35a)](_0x19c25b(0x37e)+_0x319120['shopId']+_0x19c25b(0x2eb)+_0x319120[_0x19c25b(0x28c)][_0x19c25b(0x1e8)][_0x19c25b(0x2d8)](0x6)+_0x19c25b(0x284)+_0x524c02[_0x19c25b(0x2d8)](0x6)+_0x19c25b(0x1ee)+(_0x1a1e09>0x0?'+':'')+_0x1a1e09['toFixed'](0x6)+')')),_0x498e92;});return{'id':_0x4dec0e['id'],'shopId':_0x4dec0e[_0x35dd6b(0x202)],'gateway':_0x4dec0e['gateway'],'amount':_0x4dec0e['amount'],'currency':_0x4dec0e[_0x35dd6b(0x21b)],'status':_0x4dec0e[_0x35dd6b(0x23d)],'orderId':_0x4dec0e[_0x35dd6b(0x20b)],'gatewayOrderId':_0x4dec0e[_0x35dd6b(0x1f4)],'customerEmail':_0x4dec0e[_0x35dd6b(0x2fe)],'customerName':_0x4dec0e[_0x35dd6b(0x26d)],'customerCountry':_0x4dec0e['customerCountry'],'customerIp':_0x4dec0e[_0x35dd6b(0x37c)],'customerUa':_0x4dec0e[_0x35dd6b(0x1f5)],'failureMessage':_0x4dec0e[_0x35dd6b(0x356)],'adminNotes':_0x4dec0e[_0x35dd6b(0x20a)],'chargebackAmount':_0x4dec0e['chargebackAmount'],'statusChangedBy':_0x4dec0e[_0x35dd6b(0x354)],'statusChangedAt':_0x4dec0e[_0x35dd6b(0x282)],'createdAt':_0x4dec0e['createdAt'],'updatedAt':_0x4dec0e[_0x35dd6b(0x28d)],'shop':_0x4dec0e[_0x35dd6b(0x28c)]};}async[a53_0xce6f5b(0x38c)](_0x33e8e0,_0x310220){const _0x2ee355=a53_0xce6f5b,_0x574c37=Math['random']()[_0x2ee355(0x233)](0x24)[_0x2ee355(0x2f0)](0x2,0x9);console[_0x2ee355(0x35a)]('üéØ\x20updateUser\x20called\x20with\x20ID:\x20'+_0x574c37+_0x2ee355(0x2d7)+_0x33e8e0);const _0x528587={..._0x310220};_0x310220[_0x2ee355(0x329)]&&_0x310220['password'][_0x2ee355(0x2fc)]()!==''?(console[_0x2ee355(0x35a)](_0x2ee355(0x252)+_0x574c37+_0x2ee355(0x358)+_0x33e8e0),_0x528587[_0x2ee355(0x329)]=await bcryptjs_1[_0x2ee355(0x311)][_0x2ee355(0x34c)](_0x310220[_0x2ee355(0x329)],0xc)):(console[_0x2ee355(0x35a)](_0x2ee355(0x252)+_0x574c37+_0x2ee355(0x27b)),delete _0x528587['password']);_0x310220[_0x2ee355(0x301)]&&(_0x528587[_0x2ee355(0x22f)]=_0x310220[_0x2ee355(0x301)],delete _0x528587[_0x2ee355(0x301)]);_0x310220[_0x2ee355(0x273)]&&(_0x528587[_0x2ee355(0x1d3)]=_0x310220[_0x2ee355(0x273)],delete _0x528587['telegramId']);_0x310220[_0x2ee355(0x1f6)]&&(_0x528587[_0x2ee355(0x324)]=_0x310220['merchantUrl'],delete _0x528587[_0x2ee355(0x1f6)]);if(_0x310220['gateways']){const _0x47b2c2=_0x310220[_0x2ee355(0x1fb)]['map'](_0x46037c=>this[_0x2ee355(0x27c)](_0x46037c));console[_0x2ee355(0x35a)](_0x2ee355(0x1c7),_0x310220['gateways'],'->',_0x47b2c2),_0x528587[_0x2ee355(0x247)]=JSON[_0x2ee355(0x236)](_0x47b2c2),delete _0x528587[_0x2ee355(0x1fb)];}_0x310220['gatewaySettings']&&(console[_0x2ee355(0x35a)]('üîß\x20['+_0x574c37+']\x20Gateway\x20settings\x20before\x20saving:',_0x310220[_0x2ee355(0x248)]),_0x528587[_0x2ee355(0x248)]=JSON[_0x2ee355(0x236)](_0x310220['gatewaySettings']),console[_0x2ee355(0x35a)](_0x2ee355(0x2aa)+_0x574c37+_0x2ee355(0x38b),_0x528587[_0x2ee355(0x248)]));_0x310220[_0x2ee355(0x2e5)]&&(_0x310220[_0x2ee355(0x2e5)][_0x2ee355(0x385)]!==undefined&&(_0x528587[_0x2ee355(0x385)]=_0x310220[_0x2ee355(0x2e5)][_0x2ee355(0x385)]||null),_0x310220[_0x2ee355(0x2e5)][_0x2ee355(0x1c4)]!==undefined&&(_0x528587[_0x2ee355(0x1c4)]=_0x310220[_0x2ee355(0x2e5)][_0x2ee355(0x1c4)]||null),_0x310220[_0x2ee355(0x2e5)][_0x2ee355(0x260)]!==undefined&&(_0x528587[_0x2ee355(0x260)]=_0x310220['wallets']['usdtErcWallet']||null),_0x310220[_0x2ee355(0x2e5)][_0x2ee355(0x21c)]!==undefined&&(_0x528587[_0x2ee355(0x21c)]=_0x310220['wallets']['usdcPolygonWallet']||null),delete _0x528587[_0x2ee355(0x2e5)]);const _0x1091e7=await database_1[_0x2ee355(0x311)][_0x2ee355(0x28c)]['update']({'where':{'id':_0x33e8e0},'data':_0x528587,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0x2ee355(0x35a)](_0x2ee355(0x336)+_0x574c37+_0x2ee355(0x287),_0x1091e7[_0x2ee355(0x248)]),{'id':_0x1091e7['id'],'fullName':_0x1091e7[_0x2ee355(0x22f)],'username':_0x1091e7[_0x2ee355(0x2f9)],'telegramId':_0x1091e7[_0x2ee355(0x1d3)],'merchantUrl':_0x1091e7[_0x2ee355(0x324)],'gateways':_0x1091e7['paymentGateways']?JSON['parse'](_0x1091e7[_0x2ee355(0x247)]):null,'gatewaySettings':_0x1091e7[_0x2ee355(0x248)]?JSON[_0x2ee355(0x36f)](_0x1091e7['gatewaySettings']):null,'publicKey':_0x1091e7['publicKey'],'wallets':{'usdtPolygonWallet':_0x1091e7['usdtPolygonWallet'],'usdtTrcWallet':_0x1091e7[_0x2ee355(0x1c4)],'usdtErcWallet':_0x1091e7[_0x2ee355(0x260)],'usdcPolygonWallet':_0x1091e7[_0x2ee355(0x21c)]},'status':_0x1091e7['status'],'createdAt':_0x1091e7[_0x2ee355(0x359)]};}async['suspendUser'](_0x53f2a1){const _0x3fd3dc=a53_0xce6f5b,_0x20c6a3=await database_1[_0x3fd3dc(0x311)]['shop'][_0x3fd3dc(0x2ce)]({'where':{'id':_0x53f2a1},'data':{'status':'SUSPENDED'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x20c6a3['id'],'fullName':_0x20c6a3[_0x3fd3dc(0x22f)],'username':_0x20c6a3[_0x3fd3dc(0x2f9)],'telegramId':_0x20c6a3[_0x3fd3dc(0x1d3)],'merchantUrl':_0x20c6a3[_0x3fd3dc(0x324)],'gateways':_0x20c6a3[_0x3fd3dc(0x247)]?JSON[_0x3fd3dc(0x36f)](_0x20c6a3[_0x3fd3dc(0x247)]):null,'gatewaySettings':_0x20c6a3['gatewaySettings']?JSON[_0x3fd3dc(0x36f)](_0x20c6a3['gatewaySettings']):null,'publicKey':_0x20c6a3['publicKey'],'wallets':{'usdtPolygonWallet':_0x20c6a3['usdtPolygonWallet'],'usdtTrcWallet':_0x20c6a3[_0x3fd3dc(0x1c4)],'usdtErcWallet':_0x20c6a3[_0x3fd3dc(0x260)],'usdcPolygonWallet':_0x20c6a3[_0x3fd3dc(0x21c)]},'status':_0x20c6a3['status'],'createdAt':_0x20c6a3[_0x3fd3dc(0x359)]};}async[a53_0xce6f5b(0x2cb)](_0x4e7d13){const _0x236aad=a53_0xce6f5b,_0x2d95da=await database_1['default']['shop'][_0x236aad(0x2ce)]({'where':{'id':_0x4e7d13},'data':{'status':_0x236aad(0x2a5)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2d95da['id'],'fullName':_0x2d95da[_0x236aad(0x22f)],'username':_0x2d95da[_0x236aad(0x2f9)],'telegramId':_0x2d95da[_0x236aad(0x1d3)],'merchantUrl':_0x2d95da[_0x236aad(0x324)],'gateways':_0x2d95da[_0x236aad(0x247)]?JSON[_0x236aad(0x36f)](_0x2d95da[_0x236aad(0x247)]):null,'gatewaySettings':_0x2d95da[_0x236aad(0x248)]?JSON[_0x236aad(0x36f)](_0x2d95da[_0x236aad(0x248)]):null,'publicKey':_0x2d95da['publicKey'],'wallets':{'usdtPolygonWallet':_0x2d95da['usdtPolygonWallet'],'usdtTrcWallet':_0x2d95da[_0x236aad(0x1c4)],'usdtErcWallet':_0x2d95da['usdtErcWallet'],'usdcPolygonWallet':_0x2d95da[_0x236aad(0x21c)]},'status':_0x2d95da[_0x236aad(0x23d)],'createdAt':_0x2d95da[_0x236aad(0x359)]};}async[a53_0xce6f5b(0x2b0)](_0x24581d){const _0x16aa43=a53_0xce6f5b,{page:_0x849221,limit:_0x526019,status:_0x5b9491,search:_0xee84e2}=_0x24581d,_0x45ac1b=(_0x849221-0x1)*_0x526019,_0x24326d={};_0x5b9491&&(_0x24326d[_0x16aa43(0x23d)]=_0x5b9491[_0x16aa43(0x377)]());_0xee84e2&&(_0x24326d['OR']=[{'name':{'contains':_0xee84e2,'mode':_0x16aa43(0x1d4)}},{'username':{'contains':_0xee84e2,'mode':_0x16aa43(0x1d4)}},{'telegram':{'contains':_0xee84e2,'mode':'insensitive'}},{'shopUrl':{'contains':_0xee84e2,'mode':_0x16aa43(0x1d4)}}]);const [_0x4bf3ce,_0x2f470d]=await Promise[_0x16aa43(0x2da)]([database_1[_0x16aa43(0x311)][_0x16aa43(0x28c)][_0x16aa43(0x207)]({'where':_0x24326d,'skip':_0x45ac1b,'take':_0x526019,'orderBy':{'createdAt':_0x16aa43(0x333)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'twoFactorEnabled':!![],'createdAt':!![],'lastLoginAt':!![],'_count':{'select':{'telegramUsers':!![]}}}}),database_1['default'][_0x16aa43(0x28c)][_0x16aa43(0x229)]({'where':_0x24326d})]);return{'users':_0x4bf3ce[_0x16aa43(0x332)](_0x4c43b0=>{const _0x49939e=_0x16aa43,_0x35752a=_0x4c43b0[_0x49939e(0x247)]?JSON[_0x49939e(0x36f)](_0x4c43b0[_0x49939e(0x247)]):null,_0x23df07=_0x35752a?_0x35752a[_0x49939e(0x332)](_0x5923c5=>this[_0x49939e(0x210)](_0x5923c5)):null;return{'id':_0x4c43b0['id'],'fullName':_0x4c43b0[_0x49939e(0x22f)],'username':_0x4c43b0[_0x49939e(0x2f9)],'telegramId':_0x4c43b0[_0x49939e(0x1d3)],'merchantUrl':_0x4c43b0[_0x49939e(0x324)],'gateways':_0x23df07,'gatewaySettings':_0x4c43b0[_0x49939e(0x248)]?JSON[_0x49939e(0x36f)](_0x4c43b0['gatewaySettings']):null,'publicKey':_0x4c43b0[_0x49939e(0x2ef)],'wallets':{'usdtPolygonWallet':_0x4c43b0[_0x49939e(0x385)],'usdtTrcWallet':_0x4c43b0['usdtTrcWallet'],'usdtErcWallet':_0x4c43b0[_0x49939e(0x260)],'usdcPolygonWallet':_0x4c43b0[_0x49939e(0x21c)],'usdcErcWallet':_0x4c43b0[_0x49939e(0x28f)]},'status':_0x4c43b0[_0x49939e(0x23d)],'twoFactorEnabled':_0x4c43b0[_0x49939e(0x235)]||![],'telegramUsersCount':_0x4c43b0[_0x49939e(0x2b1)][_0x49939e(0x370)],'createdAt':_0x4c43b0[_0x49939e(0x359)],'lastLoginAt':_0x4c43b0[_0x49939e(0x348)]};}),'pagination':{'page':_0x849221,'limit':_0x526019,'total':_0x2f470d,'totalPages':Math[_0x16aa43(0x26b)](_0x2f470d/_0x526019)}};}async[a53_0xce6f5b(0x1d0)](_0x52b504){const _0x3cac67=a53_0xce6f5b,_0x2da491=await database_1[_0x3cac67(0x311)][_0x3cac67(0x28c)][_0x3cac67(0x368)]({'where':{'id':_0x52b504},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x2da491)return null;const _0x4529d6=_0x2da491[_0x3cac67(0x247)]?JSON['parse'](_0x2da491[_0x3cac67(0x247)]):null,_0x4a2175=_0x4529d6?_0x4529d6[_0x3cac67(0x332)](_0x29c9d7=>this['getGatewayDisplayName'](_0x29c9d7)):null;return _0x4529d6&&_0x4a2175&&console[_0x3cac67(0x35a)](_0x3cac67(0x369),_0x4529d6,'->',_0x4a2175),{'id':_0x2da491['id'],'fullName':_0x2da491[_0x3cac67(0x22f)],'username':_0x2da491[_0x3cac67(0x2f9)],'telegramId':_0x2da491[_0x3cac67(0x1d3)],'merchantUrl':_0x2da491['shopUrl'],'gateways':_0x4a2175,'gatewaySettings':_0x2da491[_0x3cac67(0x248)]?JSON[_0x3cac67(0x36f)](_0x2da491[_0x3cac67(0x248)]):null,'publicKey':_0x2da491[_0x3cac67(0x2ef)],'wallets':{'usdtPolygonWallet':_0x2da491[_0x3cac67(0x385)],'usdtTrcWallet':_0x2da491[_0x3cac67(0x1c4)],'usdtErcWallet':_0x2da491['usdtErcWallet'],'usdcPolygonWallet':_0x2da491[_0x3cac67(0x21c)],'usdcErcWallet':_0x2da491[_0x3cac67(0x28f)]},'status':_0x2da491[_0x3cac67(0x23d)],'createdAt':_0x2da491[_0x3cac67(0x359)]};}async['createUser'](_0x1c4cdf){const _0x1bcfa3=a53_0xce6f5b,{fullName:_0x524790,username:_0x456776,password:_0x5b6741,telegramId:_0x3aa688,merchantUrl:_0x5b87e2,gateways:_0x3abca7,gatewaySettings:_0x928873,wallets:_0x521dcc}=_0x1c4cdf,_0xb2116f=await database_1[_0x1bcfa3(0x311)][_0x1bcfa3(0x28c)][_0x1bcfa3(0x368)]({'where':{'username':_0x456776}});if(_0xb2116f)throw new Error(_0x1bcfa3(0x339));if(_0x3aa688){const _0x4d7f14=await database_1[_0x1bcfa3(0x311)][_0x1bcfa3(0x28c)][_0x1bcfa3(0x368)]({'where':{'telegram':_0x3aa688}});if(_0x4d7f14)throw new Error(_0x1bcfa3(0x1d1));}const _0x40a0d2=await bcryptjs_1[_0x1bcfa3(0x311)][_0x1bcfa3(0x34c)](_0x5b6741,0xc),_0x12cb98=_0x1bcfa3(0x237)+crypto_1[_0x1bcfa3(0x311)][_0x1bcfa3(0x251)](0x20)[_0x1bcfa3(0x233)](_0x1bcfa3(0x2c1)),_0xa1a4d9=_0x1bcfa3(0x395)+crypto_1[_0x1bcfa3(0x311)]['randomBytes'](0x20)[_0x1bcfa3(0x233)]('hex'),_0x2d4c9c=_0x3abca7?_0x3abca7[_0x1bcfa3(0x332)](_0x5be889=>this[_0x1bcfa3(0x27c)](_0x5be889)):null;_0x3abca7&&_0x2d4c9c&&console[_0x1bcfa3(0x35a)](_0x1bcfa3(0x322),_0x3abca7,'->',_0x2d4c9c);const _0x2e8011=await database_1[_0x1bcfa3(0x311)]['shop'][_0x1bcfa3(0x312)]({'data':{'name':_0x524790,'username':_0x456776,'password':_0x40a0d2,'telegram':_0x3aa688,'shopUrl':_0x5b87e2,'paymentGateways':_0x2d4c9c?JSON[_0x1bcfa3(0x236)](_0x2d4c9c):null,'gatewaySettings':_0x928873?JSON['stringify'](_0x928873):null,'usdtPolygonWallet':_0x521dcc?.[_0x1bcfa3(0x385)]||null,'usdtTrcWallet':_0x521dcc?.[_0x1bcfa3(0x1c4)]||null,'usdtErcWallet':_0x521dcc?.[_0x1bcfa3(0x260)]||null,'usdcPolygonWallet':_0x521dcc?.[_0x1bcfa3(0x21c)]||null,'publicKey':_0x12cb98,'secretKey':_0xa1a4d9,'status':_0x1bcfa3(0x2a5)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2e8011['id'],'fullName':_0x2e8011[_0x1bcfa3(0x22f)],'username':_0x2e8011[_0x1bcfa3(0x2f9)],'telegramId':_0x2e8011[_0x1bcfa3(0x1d3)],'merchantUrl':_0x2e8011[_0x1bcfa3(0x324)],'gateways':_0x2e8011['paymentGateways']?JSON[_0x1bcfa3(0x36f)](_0x2e8011[_0x1bcfa3(0x247)]):null,'gatewaySettings':_0x2e8011[_0x1bcfa3(0x248)]?JSON[_0x1bcfa3(0x36f)](_0x2e8011['gatewaySettings']):null,'publicKey':_0x2e8011[_0x1bcfa3(0x2ef)],'wallets':{'usdtPolygonWallet':_0x2e8011['usdtPolygonWallet'],'usdtTrcWallet':_0x2e8011[_0x1bcfa3(0x1c4)],'usdtErcWallet':_0x2e8011['usdtErcWallet'],'usdcPolygonWallet':_0x2e8011[_0x1bcfa3(0x21c)]},'status':_0x2e8011[_0x1bcfa3(0x23d)],'createdAt':_0x2e8011['createdAt']};}async[a53_0xce6f5b(0x276)](_0x371303,_0x559d74){const _0x5dbaf6=a53_0xce6f5b;if(config_1[_0x5dbaf6(0x2ec)]['admin'][_0x5dbaf6(0x235)]){if(!_0x559d74)throw new Error('2FA\x20token\x20is\x20required');const _0x3963f4=speakeasy_1['default']['totp'][_0x5dbaf6(0x258)]({'secret':config_1[_0x5dbaf6(0x2ec)][_0x5dbaf6(0x1db)][_0x5dbaf6(0x390)],'encoding':_0x5dbaf6(0x315),'token':_0x559d74,'window':0x2});if(!_0x3963f4){let _0x3922b8=![];if(config_1[_0x5dbaf6(0x2ec)][_0x5dbaf6(0x1db)][_0x5dbaf6(0x29b)]){const _0x43bb27=JSON[_0x5dbaf6(0x36f)](config_1[_0x5dbaf6(0x2ec)][_0x5dbaf6(0x1db)]['backupCodes']);for(let _0x28af7f=0x0;_0x28af7f<_0x43bb27[_0x5dbaf6(0x204)];_0x28af7f++){const _0x323034=await bcryptjs_1['default'][_0x5dbaf6(0x24c)](_0x559d74,_0x43bb27[_0x28af7f]);if(_0x323034){_0x3922b8=!![],_0x43bb27['splice'](_0x28af7f,0x1),config_1[_0x5dbaf6(0x2ec)]['admin'][_0x5dbaf6(0x29b)]=JSON[_0x5dbaf6(0x236)](_0x43bb27);const _0x226855=path_1[_0x5dbaf6(0x311)][_0x5dbaf6(0x1eb)](process[_0x5dbaf6(0x2ca)](),_0x5dbaf6(0x2af));if(fs_1['default'][_0x5dbaf6(0x23b)](_0x226855)){let _0x2ae4fe=fs_1['default']['readFileSync'](_0x226855,'utf8');const _0x2657cb=_0x2ae4fe[_0x5dbaf6(0x22b)]('\x0a');for(let _0x36f1cb=0x0;_0x36f1cb<_0x2657cb[_0x5dbaf6(0x204)];_0x36f1cb++){if(_0x2657cb[_0x36f1cb][_0x5dbaf6(0x1d8)]('ADMIN_BACKUP_CODES=')){_0x2657cb[_0x36f1cb]=_0x5dbaf6(0x30c)+JSON[_0x5dbaf6(0x236)](_0x43bb27);break;}}fs_1['default']['writeFileSync'](_0x226855,_0x2657cb[_0x5dbaf6(0x1eb)]('\x0a'),_0x5dbaf6(0x38d));}break;}}}if(!_0x3922b8)throw new Error(_0x5dbaf6(0x22c));}}await database_1['default'][_0x5dbaf6(0x28c)]['delete']({'where':{'id':_0x371303}});}async[a53_0xce6f5b(0x392)](_0x4b1628){const _0x264d95=a53_0xce6f5b,_0x12c868=await database_1[_0x264d95(0x311)][_0x264d95(0x28c)][_0x264d95(0x368)]({'where':{'id':_0x4b1628},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});if(!_0x12c868)throw new Error(_0x264d95(0x2cc));return{'usdtPolygonWallet':_0x12c868[_0x264d95(0x385)],'usdtTrcWallet':_0x12c868[_0x264d95(0x1c4)],'usdtErcWallet':_0x12c868['usdtErcWallet'],'usdcPolygonWallet':_0x12c868['usdcPolygonWallet'],'usdcErcWallet':_0x12c868[_0x264d95(0x28f)]};}[a53_0xce6f5b(0x264)](_0x254c84=0x8){const _0x3988e7=a53_0xce6f5b,_0x397ac1=[];for(let _0x4110dc=0x0;_0x4110dc<_0x254c84;_0x4110dc++){const _0x5996a0=crypto_1[_0x3988e7(0x311)][_0x3988e7(0x251)](0x4)[_0x3988e7(0x233)]('hex')[_0x3988e7(0x377)]();_0x397ac1['push'](_0x5996a0);}return _0x397ac1;}async[a53_0xce6f5b(0x307)](_0x48f645){const _0x15bfbf=a53_0xce6f5b,_0x29f607=await database_1[_0x15bfbf(0x311)][_0x15bfbf(0x28c)]['findUnique']({'where':{'id':_0x48f645},'select':{'id':!![],'name':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x29f607)throw new Error(_0x15bfbf(0x2cc));const _0x311a2f=speakeasy_1['default'][_0x15bfbf(0x298)]({'name':'TrapaPay\x20('+_0x29f607[_0x15bfbf(0x2f9)]+')','issuer':_0x15bfbf(0x277),'length':0x20}),_0x439da6=await qrcode_1[_0x15bfbf(0x311)][_0x15bfbf(0x373)](_0x311a2f[_0x15bfbf(0x341)]),_0x3875c7=this['generateBackupCodes'](0x8),_0x545526=await Promise[_0x15bfbf(0x2da)](_0x3875c7[_0x15bfbf(0x332)](_0x41c67f=>bcryptjs_1[_0x15bfbf(0x311)][_0x15bfbf(0x34c)](_0x41c67f,0xa)));return await database_1[_0x15bfbf(0x311)][_0x15bfbf(0x28c)]['update']({'where':{'id':_0x48f645},'data':{'twoFactorSecret':_0x311a2f[_0x15bfbf(0x315)],'backupCodes':JSON[_0x15bfbf(0x236)](_0x545526)}}),console[_0x15bfbf(0x35a)](_0x15bfbf(0x206)+_0x29f607[_0x15bfbf(0x2f9)]),console[_0x15bfbf(0x35a)]('üîë\x20Generated\x20'+_0x3875c7[_0x15bfbf(0x204)]+'\x20backup\x20codes'),{'secret':_0x311a2f[_0x15bfbf(0x315)],'qrCode':_0x439da6,'manualEntryKey':_0x311a2f[_0x15bfbf(0x315)],'backupCodes':_0x3875c7};}async[a53_0xce6f5b(0x2f4)](_0x3a726f,_0x399d60){const _0x111b59=a53_0xce6f5b,_0x561c4c=await database_1[_0x111b59(0x311)][_0x111b59(0x28c)]['findUnique']({'where':{'id':_0x3a726f},'select':{'id':!![],'username':!![],'twoFactorSecret':!![],'twoFactorEnabled':!![]}});if(!_0x561c4c)throw new Error(_0x111b59(0x2cc));if(!_0x561c4c[_0x111b59(0x390)])throw new Error(_0x111b59(0x230));if(_0x561c4c[_0x111b59(0x235)])throw new Error(_0x111b59(0x24f));const _0x552e88=speakeasy_1[_0x111b59(0x311)][_0x111b59(0x262)][_0x111b59(0x258)]({'secret':_0x561c4c[_0x111b59(0x390)],'encoding':_0x111b59(0x315),'token':_0x399d60,'window':0x2});if(!_0x552e88)throw new Error(_0x111b59(0x290));return await database_1[_0x111b59(0x311)]['shop'][_0x111b59(0x2ce)]({'where':{'id':_0x3a726f},'data':{'twoFactorEnabled':!![]}}),console['log'](_0x111b59(0x225)+_0x561c4c[_0x111b59(0x2f9)]),{'enabled':!![]};}async['disable2FA'](_0x4c8a0e){const _0x4fe679=a53_0xce6f5b,_0x5025ac=await database_1[_0x4fe679(0x311)][_0x4fe679(0x28c)][_0x4fe679(0x368)]({'where':{'id':_0x4c8a0e},'select':{'id':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x5025ac)throw new Error(_0x4fe679(0x2cc));await database_1[_0x4fe679(0x311)][_0x4fe679(0x28c)][_0x4fe679(0x2ce)]({'where':{'id':_0x4c8a0e},'data':{'twoFactorEnabled':![],'twoFactorSecret':null,'backupCodes':null}}),console[_0x4fe679(0x35a)](_0x4fe679(0x1f2)+_0x5025ac[_0x4fe679(0x2f9)]);}async[a53_0xce6f5b(0x25e)](_0x4a2742,_0x2e8198,_0x2ef058,_0x507e70){const _0x5f585f=a53_0xce6f5b;if(_0x2e8198!==_0x2ef058)throw new Error(_0x5f585f(0x391));if(_0x2e8198[_0x5f585f(0x204)]<0x6)throw new Error(_0x5f585f(0x2ff));const _0x5971c5=await bcryptjs_1['default'][_0x5f585f(0x24c)](_0x4a2742,config_1[_0x5f585f(0x2ec)][_0x5f585f(0x1db)]['passwordHash']);if(!_0x5971c5)throw new Error(_0x5f585f(0x2c0));if(config_1[_0x5f585f(0x2ec)][_0x5f585f(0x1db)][_0x5f585f(0x235)]){if(!_0x507e70)throw new Error(_0x5f585f(0x1f7));const _0x45c334=speakeasy_1[_0x5f585f(0x311)][_0x5f585f(0x262)][_0x5f585f(0x258)]({'secret':config_1['config'][_0x5f585f(0x1db)][_0x5f585f(0x390)],'encoding':_0x5f585f(0x315),'token':_0x507e70,'window':0x2});if(!_0x45c334){let _0x1ad9d2=![];if(config_1['config'][_0x5f585f(0x1db)][_0x5f585f(0x29b)]){const _0x4dec98=JSON[_0x5f585f(0x36f)](config_1['config'][_0x5f585f(0x1db)][_0x5f585f(0x29b)]);for(let _0xb74d60=0x0;_0xb74d60<_0x4dec98[_0x5f585f(0x204)];_0xb74d60++){const _0xa700fd=await bcryptjs_1[_0x5f585f(0x311)][_0x5f585f(0x24c)](_0x507e70,_0x4dec98[_0xb74d60]);if(_0xa700fd){_0x1ad9d2=!![],_0x4dec98[_0x5f585f(0x200)](_0xb74d60,0x1),config_1[_0x5f585f(0x2ec)][_0x5f585f(0x1db)]['backupCodes']=JSON['stringify'](_0x4dec98);const _0x2118bc=path_1[_0x5f585f(0x311)]['join'](process['cwd'](),_0x5f585f(0x2af));if(fs_1[_0x5f585f(0x311)]['existsSync'](_0x2118bc)){let _0xb7018=fs_1[_0x5f585f(0x311)][_0x5f585f(0x31f)](_0x2118bc,_0x5f585f(0x38d));const _0x19cb31=_0xb7018['split']('\x0a');for(let _0x1a5296=0x0;_0x1a5296<_0x19cb31[_0x5f585f(0x204)];_0x1a5296++){if(_0x19cb31[_0x1a5296]['startsWith'](_0x5f585f(0x30c))){_0x19cb31[_0x1a5296]=_0x5f585f(0x30c)+JSON[_0x5f585f(0x236)](_0x4dec98);break;}}fs_1['default']['writeFileSync'](_0x2118bc,_0x19cb31[_0x5f585f(0x1eb)]('\x0a'),_0x5f585f(0x38d));}break;}}}if(!_0x1ad9d2)throw new Error(_0x5f585f(0x22c));}}const _0x4927bb=await bcryptjs_1['default'][_0x5f585f(0x34c)](_0x2e8198,0xc);config_1[_0x5f585f(0x2ec)][_0x5f585f(0x1db)][_0x5f585f(0x285)]=_0x4927bb;const _0xde0262=path_1[_0x5f585f(0x311)]['join'](process[_0x5f585f(0x2ca)](),'.env');let _0x1732a3='';if(fs_1[_0x5f585f(0x311)][_0x5f585f(0x23b)](_0xde0262)){_0x1732a3=fs_1[_0x5f585f(0x311)][_0x5f585f(0x31f)](_0xde0262,'utf8');const _0x27b354=_0x1732a3[_0x5f585f(0x22b)]('\x0a');let _0x1913ce=![];for(let _0x2cbe9b=0x0;_0x2cbe9b<_0x27b354['length'];_0x2cbe9b++){if(_0x27b354[_0x2cbe9b]['startsWith'](_0x5f585f(0x20c))){_0x27b354[_0x2cbe9b]='ADMIN_PASSWORD_HASH='+_0x4927bb,_0x1913ce=!![];break;}}!_0x1913ce&&_0x27b354[_0x5f585f(0x1cf)](_0x5f585f(0x20c)+_0x4927bb),_0x1732a3=_0x27b354[_0x5f585f(0x1eb)]('\x0a'),fs_1['default'][_0x5f585f(0x211)](_0xde0262,_0x1732a3,_0x5f585f(0x38d));}console['log']('üîê\x20Admin\x20password\x20changed\x20successfully');}async[a53_0xce6f5b(0x250)](){const _0x46e037=a53_0xce6f5b;let _0x48ddca=0x0;if(config_1[_0x46e037(0x2ec)][_0x46e037(0x1db)][_0x46e037(0x29b)])try{const _0x58e308=JSON[_0x46e037(0x36f)](config_1[_0x46e037(0x2ec)][_0x46e037(0x1db)][_0x46e037(0x29b)]);_0x48ddca=_0x58e308['length'];}catch(_0x4d95e3){console[_0x46e037(0x2a7)](_0x46e037(0x2ac),_0x4d95e3);}return{'twoFactorEnabled':config_1[_0x46e037(0x2ec)][_0x46e037(0x1db)]['twoFactorEnabled'],'backupCodesCount':_0x48ddca};}async[a53_0xce6f5b(0x270)](){const _0x44fb02=a53_0xce6f5b,_0x1e1270=speakeasy_1['default'][_0x44fb02(0x298)]({'name':'TrapaPay\x20Admin\x20('+config_1['config'][_0x44fb02(0x1db)][_0x44fb02(0x2f9)]+')','issuer':_0x44fb02(0x394),'length':0x20}),_0x2fddfb=await qrcode_1[_0x44fb02(0x311)][_0x44fb02(0x373)](_0x1e1270['otpauth_url']),_0x191395=[];for(let _0x3f3e7a=0x0;_0x3f3e7a<0x8;_0x3f3e7a++){const _0x2dff99=crypto_1[_0x44fb02(0x311)]['randomBytes'](0x4)['toString']('hex')[_0x44fb02(0x377)]();_0x191395['push'](_0x2dff99);}const _0x529074=await Promise[_0x44fb02(0x2da)](_0x191395[_0x44fb02(0x332)](_0x2407eb=>bcryptjs_1[_0x44fb02(0x311)][_0x44fb02(0x34c)](_0x2407eb,0xa)));config_1[_0x44fb02(0x2ec)][_0x44fb02(0x1db)][_0x44fb02(0x390)]=_0x1e1270['base32'],config_1[_0x44fb02(0x2ec)][_0x44fb02(0x1db)][_0x44fb02(0x29b)]=JSON[_0x44fb02(0x236)](_0x529074);const _0x146545=path_1['default']['join'](process[_0x44fb02(0x2ca)](),_0x44fb02(0x2af));if(fs_1[_0x44fb02(0x311)][_0x44fb02(0x23b)](_0x146545)){let _0x286dbc=fs_1['default'][_0x44fb02(0x31f)](_0x146545,'utf8');const _0x4b2213=_0x286dbc[_0x44fb02(0x22b)]('\x0a');let _0x7b293f=![],_0x21b557=![];for(let _0x57a827=0x0;_0x57a827<_0x4b2213[_0x44fb02(0x204)];_0x57a827++){_0x4b2213[_0x57a827][_0x44fb02(0x1d8)](_0x44fb02(0x32c))&&(_0x4b2213[_0x57a827]=_0x44fb02(0x32c)+_0x1e1270[_0x44fb02(0x315)],_0x7b293f=!![]),_0x4b2213[_0x57a827]['startsWith'](_0x44fb02(0x30c))&&(_0x4b2213[_0x57a827]=_0x44fb02(0x30c)+JSON[_0x44fb02(0x236)](_0x529074),_0x21b557=!![]);}if(!_0x7b293f)_0x4b2213[_0x44fb02(0x1cf)](_0x44fb02(0x32c)+_0x1e1270[_0x44fb02(0x315)]);if(!_0x21b557)_0x4b2213[_0x44fb02(0x1cf)](_0x44fb02(0x30c)+JSON[_0x44fb02(0x236)](_0x529074));fs_1['default'][_0x44fb02(0x211)](_0x146545,_0x4b2213[_0x44fb02(0x1eb)]('\x0a'),'utf8');}return console[_0x44fb02(0x35a)](_0x44fb02(0x34e)),console['log']('üîë\x20Generated\x20'+_0x191395[_0x44fb02(0x204)]+'\x20backup\x20codes'),{'secret':_0x1e1270[_0x44fb02(0x315)],'qrCode':_0x2fddfb,'manualEntryKey':_0x1e1270['base32'],'backupCodes':_0x191395};}async[a53_0xce6f5b(0x2d0)](_0x2ab288){const _0x3a83bc=a53_0xce6f5b;if(!config_1[_0x3a83bc(0x2ec)][_0x3a83bc(0x1db)]['twoFactorSecret'])throw new Error(_0x3a83bc(0x230));if(config_1['config'][_0x3a83bc(0x1db)][_0x3a83bc(0x235)])throw new Error('2FA\x20is\x20already\x20enabled');const _0x5d9a30=speakeasy_1['default'][_0x3a83bc(0x262)]['verify']({'secret':config_1['config'][_0x3a83bc(0x1db)]['twoFactorSecret'],'encoding':'base32','token':_0x2ab288,'window':0x2});if(!_0x5d9a30)throw new Error(_0x3a83bc(0x290));config_1['config'][_0x3a83bc(0x1db)]['twoFactorEnabled']=!![];const _0xeaa21a=path_1[_0x3a83bc(0x311)][_0x3a83bc(0x1eb)](process[_0x3a83bc(0x2ca)](),'.env');if(fs_1[_0x3a83bc(0x311)]['existsSync'](_0xeaa21a)){let _0x413b51=fs_1['default'][_0x3a83bc(0x31f)](_0xeaa21a,_0x3a83bc(0x38d));const _0x256ca2=_0x413b51[_0x3a83bc(0x22b)]('\x0a');let _0xe11fc6=![];for(let _0x4eb1ff=0x0;_0x4eb1ff<_0x256ca2['length'];_0x4eb1ff++){if(_0x256ca2[_0x4eb1ff][_0x3a83bc(0x1d8)](_0x3a83bc(0x205))){_0x256ca2[_0x4eb1ff]=_0x3a83bc(0x382),_0xe11fc6=!![];break;}}if(!_0xe11fc6)_0x256ca2[_0x3a83bc(0x1cf)](_0x3a83bc(0x382));fs_1[_0x3a83bc(0x311)][_0x3a83bc(0x211)](_0xeaa21a,_0x256ca2['join']('\x0a'),'utf8');}return console[_0x3a83bc(0x35a)]('üîê\x20Admin\x202FA\x20enabled'),{'enabled':!![]};}async['disableAdmin2FA'](){const _0x1e32ea=a53_0xce6f5b;config_1['config'][_0x1e32ea(0x1db)][_0x1e32ea(0x235)]=![],config_1[_0x1e32ea(0x2ec)][_0x1e32ea(0x1db)][_0x1e32ea(0x390)]='',config_1['config'][_0x1e32ea(0x1db)][_0x1e32ea(0x29b)]='';const _0x529e0c=path_1[_0x1e32ea(0x311)][_0x1e32ea(0x1eb)](process['cwd'](),_0x1e32ea(0x2af));if(fs_1[_0x1e32ea(0x311)][_0x1e32ea(0x23b)](_0x529e0c)){let _0x61b7b6=fs_1['default'][_0x1e32ea(0x31f)](_0x529e0c,'utf8');const _0x495fa5=_0x61b7b6[_0x1e32ea(0x22b)]('\x0a');for(let _0x27c616=0x0;_0x27c616<_0x495fa5[_0x1e32ea(0x204)];_0x27c616++){_0x495fa5[_0x27c616]['startsWith'](_0x1e32ea(0x205))&&(_0x495fa5[_0x27c616]=_0x1e32ea(0x310)),_0x495fa5[_0x27c616][_0x1e32ea(0x1d8)](_0x1e32ea(0x32c))&&(_0x495fa5[_0x27c616]=_0x1e32ea(0x32c)),_0x495fa5[_0x27c616][_0x1e32ea(0x1d8)](_0x1e32ea(0x30c))&&(_0x495fa5[_0x27c616]='ADMIN_BACKUP_CODES=');}fs_1[_0x1e32ea(0x311)]['writeFileSync'](_0x529e0c,_0x495fa5[_0x1e32ea(0x1eb)]('\x0a'),'utf8');}console['log'](_0x1e32ea(0x38e));}[a53_0xce6f5b(0x2c8)](_0x55d042,_0x43ede6,_0x11d194){const _0x646a4b=a53_0xce6f5b,_0x2c0d72=new Map(),_0x4fd0c4=new Date(_0x43ede6);while(_0x4fd0c4<=_0x11d194){const _0x46afe1=_0x4fd0c4['toISOString']()[_0x646a4b(0x22b)]('T')[0x0];_0x2c0d72[_0x646a4b(0x1d6)](_0x46afe1,{'revenue':0x0,'count':0x0}),_0x4fd0c4['setDate'](_0x4fd0c4['getDate']()+0x1);}for(const _0x5cbb96 of _0x55d042){const _0x5946bc=_0x5cbb96['createdAt'][_0x646a4b(0x320)]()[_0x646a4b(0x22b)]('T')[0x0],_0x408bde=_0x2c0d72['get'](_0x5946bc);_0x408bde&&(_0x408bde[_0x646a4b(0x229)]+=0x1,_0x5cbb96['status']===_0x646a4b(0x24d)&&(_0x5cbb96[_0x646a4b(0x34b)]?_0x408bde[_0x646a4b(0x2c7)]+=_0x5cbb96[_0x646a4b(0x34b)]:console[_0x646a4b(0x35a)](_0x646a4b(0x2e8)+_0x5cbb96['id']+_0x646a4b(0x27f))));}const _0x263795=[],_0x4bb19=[];for(const [_0x860841,_0x3f82c1]of _0x2c0d72){_0x263795['push']({'date':_0x860841,'amount':Math[_0x646a4b(0x1f0)](_0x3f82c1[_0x646a4b(0x2c7)]*0x64)/0x64}),_0x4bb19[_0x646a4b(0x1cf)]({'date':_0x860841,'count':_0x3f82c1[_0x646a4b(0x229)]});}return{'dailyRevenue':_0x263795,'dailyPayments':_0x4bb19};}async[a53_0xce6f5b(0x238)](_0x53d287){const _0x36b155=a53_0xce6f5b;console[_0x36b155(0x35a)](_0x36b155(0x33c),_0x53d287);const _0xbff62c=new Date(_0x53d287[_0x36b155(0x379)]),_0x22cd22=new Date(_0x53d287[_0x36b155(0x32d)]),_0x5d02c0=new Date(Date[_0x36b155(0x254)](_0xbff62c[_0x36b155(0x38a)](),_0xbff62c[_0x36b155(0x363)](),_0xbff62c[_0x36b155(0x2fa)](),0x0,0x0,0x0,0x0)),_0x533152=new Date(Date['UTC'](_0x22cd22[_0x36b155(0x38a)](),_0x22cd22[_0x36b155(0x363)](),_0x22cd22['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));console[_0x36b155(0x35a)]('üìÖ\x20Period:\x20'+_0x5d02c0['toISOString']()+_0x36b155(0x30d)+_0x533152[_0x36b155(0x320)]()),console[_0x36b155(0x35a)](_0x36b155(0x365)+_0x53d287[_0x36b155(0x227)]);const _0x5d55a1=await database_1[_0x36b155(0x311)]['payment']['findMany']({'where':{'status':_0x36b155(0x24d),'gateway':_0x53d287[_0x36b155(0x227)][_0x36b155(0x231)](),'createdAt':{'gte':_0x5d02c0,'lte':_0x533152}},'select':{'id':!![],'shopId':!![],'amountAfterGatewayCommissionUSDT':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console[_0x36b155(0x35a)](_0x36b155(0x222)+_0x5d55a1[_0x36b155(0x204)]+_0x36b155(0x34d)+_0x53d287[_0x36b155(0x227)]);const _0x44d579=new Map();for(const _0x1fe65d of _0x5d55a1){const _0x37c5c8=_0x1fe65d[_0x36b155(0x30a)]||0x0;if(_0x37c5c8<=0x0){console[_0x36b155(0x1ed)](_0x36b155(0x2e8)+_0x1fe65d['id']+_0x36b155(0x36b));continue;}if(_0x44d579[_0x36b155(0x2bc)](_0x1fe65d[_0x36b155(0x202)])){const _0xf806ce=_0x44d579['get'](_0x1fe65d['shopId']);_0xf806ce['totalAmount']+=_0x37c5c8;}else _0x44d579['set'](_0x1fe65d[_0x36b155(0x202)],{'merchantId':_0x1fe65d[_0x36b155(0x28c)]['id'],'merchantName':_0x1fe65d[_0x36b155(0x28c)]['name'],'merchantUsername':_0x1fe65d[_0x36b155(0x28c)][_0x36b155(0x2f9)],'totalAmount':_0x37c5c8});}const _0x34f38b=Array[_0x36b155(0x325)](_0x44d579[_0x36b155(0x1c9)]())[_0x36b155(0x332)](_0x16209a=>({'merchantId':_0x16209a[_0x36b155(0x279)],'merchantName':_0x16209a[_0x36b155(0x367)],'merchantUsername':_0x16209a[_0x36b155(0x2c5)],'gateway':_0x53d287['gateway'],'periodFrom':_0x53d287[_0x36b155(0x379)],'periodTo':_0x53d287['periodTo'],'totalAmount':Math['round'](_0x16209a['totalAmount']*0x64)/0x64}));return _0x34f38b['sort']((_0x5b0f6e,_0x4e094b)=>_0x4e094b[_0x36b155(0x1e1)]-_0x5b0f6e[_0x36b155(0x1e1)]),console[_0x36b155(0x35a)](_0x36b155(0x2e9)+_0x34f38b[_0x36b155(0x204)]+_0x36b155(0x2e1)),_0x34f38b;}async[a53_0xce6f5b(0x27a)](_0x46eca8,_0x3c5b61,_0x49f25e){const _0xd741e0=a53_0xce6f5b,_0xae1a5a=await database_1['default'][_0xd741e0(0x28c)][_0xd741e0(0x368)]({'where':{'id':_0x46eca8}});if(!_0xae1a5a)throw new Error(_0xd741e0(0x380));await database_1[_0xd741e0(0x311)][_0xd741e0(0x36d)](async _0x14dbc8=>{const _0xd94b9b=_0xd741e0;await _0x14dbc8['payment'][_0xd94b9b(0x312)]({'data':{'shopId':_0xae1a5a['id'],'amount':_0x3c5b61,'amountUSDT':_0x3c5b61,'amountAfterGatewayCommissionUSDT':_0x3c5b61,'sourceCurrency':'USDC','currency':_0xd94b9b(0x33b),'status':'PAID','gateway':_0xd94b9b(0x300),'customerName':_0xae1a5a['username'],'customerEmail':'@'+_0xae1a5a[_0xd94b9b(0x1d3)],'paymentMethod':_0xd94b9b(0x2b9),'adminNotes':_0x49f25e||null,'successUrl':'-','failUrl':'-','paidAt':new Date()}}),await _0x14dbc8['shop'][_0xd94b9b(0x2ce)]({'where':{'id':_0xae1a5a['id']},'data':{'balance':{'increment':_0x3c5b61}}});}),console[_0xd741e0(0x35a)](_0xd741e0(0x376)+_0x3c5b61+_0xd741e0(0x384)+_0xae1a5a[_0xd741e0(0x2f9)]);}}exports[a53_0xce6f5b(0x1c6)]=AdminService;