'use strict';const a35_0x287a11=a35_0x419e;function a35_0x1f1b(){const _0x76f11=['payout','1544SdgheU','lte','getPayoutById','dateFrom','deleteUser','test_gateway','adminNotes','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','COMPLETED','Noda','createUser','paymentsCount','date','not\x20set','Username\x20already\x20exists','default','balance','getTime','week','usdtTrcWallet','randomBytes','year','wallets','gatewayEarnings','getPaymentById','📊\x20Merchants\x20awaiting\x20payout:\x20','30d','\x20\x20\x20Current\x20balance:\x20','getAllPayouts','currency','amountUSDT','Error\x20processing\x20payment\x20','\x20USDT\x20(same\x20as\x20awaiting)','customerName','orderId','customerIp','\x20\x20\x20💵\x20Available\x20balance:\x20','findUnique','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','payment','💰\x20Payment\x20','119336EwnoVx','Payment\x20not\x20found','ACTIVE','periodFrom','telegram','forEach','shopUrl','24QyHlKl','2020-01-01','stringify','KLYME\x20GB','_sum','hex','reduce','\x20USDT\x20(-','sort','\x20became\x20PAID:\x20+','publicKey','getMerchantStatistics','updatedAt','commission','gatewayOrderId','toString','\x20\x20\x20Payout\x20amount:\x20','\x20\x20\x20🌍\x20Country:\x20','periodTo','asc','Test\x20Gateway','📊\x20Calculating\x20payout\x20statistics...','../config/database','turnover','Insufficient\x20balance.\x20Available:\x20','\x20no\x20longer\x20PAID:\x20-','hash','_count','network','totalPayments','usdtPolygonWallet','KLYME\x20EU','month','96618bQGpJY','710868zYYwGv','createPayout','Rapyd','string','\x20\x20\x20📊\x20Total\x20payments:\x20','create','\x20USDT)','getAllPayments','\x20\x20\x20🌐\x20IP:\x20','chargebackAmount','insensitive','68680gQMxLm','count','merchantUrl','paymentGateways','convertToUSDT','💰\x20Current\x20shop\x20balance:\x20','getPayoutStats','🔄\x20Admin\x20updating\x20payment\x20','getGatewayDisplayName','\x20merchants,\x20','error','merchantEarningsUSDT','shop','ceil','\x20USDT\x20(+','map','131319IOPGfc','availableBalance','parse','turnoverUSDT','paidAt','usdcPolygonWallet','\x20for\x20shop\x20','period','\x20\x20\x20Balance:\x20','successUrl','CoinToPay','\x20USDT\x20(total\x20paid\x20to\x20merchants)','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','\x20\x20\x20💰\x20Total\x20turnover:\x20','customerEmail','thisMonth','\x20\x20\x20🖥️\x20User\x20Agent:\x20','📊\x20Payout\x20statistics\x20calculated:','commissionUSDT','$transaction','getFullYear','getMerchantsAwaitingPayout','customerCountry','amount','Plisio','SUSPENDED','all','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','getMonth','sk_','update','\x20\x20\x20📅\x20This\x20month:\x20','130jQQLhi','gateway','558025EeTkEh','statusChangedBy','dateTo','bcryptjs','Shop\x20not\x20found','\x20to\x20','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','REFUND','values','findMany','40DyFFRm','\x20status:\x20','status','log','aggregate','toUpperCase','totalPaidOut','updateCustomerData','name','totalCommissionRate','\x20USDT','username','\x20USDT\x20(total\x20merchant\x20balances)','failureMessage','getUserById','activateUser','desc','\x20USDT\x20from\x20balance','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','telegramId','gateways','toFixed','gatewaySettings','\x20->\x20','fullName','AdminService','./telegramBotService','\x20USDT\x20total','Telegram\x20username\x20already\x20exists','\x20\x20\x20Transaction\x20hash:\x20','\x20USDT,\x20Requested:\x20','suspendUser','toLowerCase','\x20USDT\x20(','delete','shopId','paidOutUSDT','toISOString','💰\x20Found\x20','getAllUsers','📱\x20Telegram\x20notification\x20sent\x20for\x20payout\x20','✅\x20Payout\x20created:\x20','PAID','__esModule','length','\x20paid\x20payments\x20for\x20analysis','sendPayoutNotification','txid','5299fEJIVr','__importDefault','findFirst','💸\x20CHARGEBACK\x20penalty:\x20-','password','custom','round','customerUa','currencyService','merchantEarnings','\x20\x20\x20Total\x20paid\x20out:\x20','usdtErcWallet','awaitingPayout','154lfWhsE','\x20balance\x20updated:\x20','createdAt','updatePaymentStatus','gte'];a35_0x1f1b=function(){return _0x76f11;};return a35_0x1f1b();}(function(_0x36f7ca,_0x42bd36){const _0x319c47=a35_0x419e,_0x8f4ee2=_0x36f7ca();while(!![]){try{const _0xfdf3a8=parseInt(_0x319c47(0x205))/0x1+parseInt(_0x319c47(0x19f))/0x2*(parseInt(_0x319c47(0x1a6))/0x3)+parseInt(_0x319c47(0x20f))/0x4*(parseInt(_0x319c47(0x1d3))/0x5)+parseInt(_0x319c47(0x1c7))/0x6+-parseInt(_0x319c47(0x163))/0x7*(-parseInt(_0x319c47(0x176))/0x8)+parseInt(_0x319c47(0x1e3))/0x9*(-parseInt(_0x319c47(0x203))/0xa)+parseInt(_0x319c47(0x170))/0xb*(-parseInt(_0x319c47(0x1c8))/0xc);if(_0xfdf3a8===_0x42bd36)break;else _0x8f4ee2['push'](_0x8f4ee2['shift']());}catch(_0x24080d){_0x8f4ee2['push'](_0x8f4ee2['shift']());}}}(a35_0x1f1b,0x4d200));function a35_0x419e(_0x47153e,_0x5c7adb){const _0x1f1b41=a35_0x1f1b();return a35_0x419e=function(_0x419ea0,_0x5e0a79){_0x419ea0=_0x419ea0-0x135;let _0x3dea8d=_0x1f1b41[_0x419ea0];return _0x3dea8d;},a35_0x419e(_0x47153e,_0x5c7adb);}var __importDefault=this&&this[a35_0x287a11(0x164)]||function(_0x7276dd){const _0x422259=a35_0x287a11;return _0x7276dd&&_0x7276dd[_0x422259(0x15e)]?_0x7276dd:{'default':_0x7276dd};};Object['defineProperty'](exports,a35_0x287a11(0x15e),{'value':!![]}),exports['AdminService']=void 0x0;const database_1=__importDefault(require(a35_0x287a11(0x1bc))),bcryptjs_1=__importDefault(require(a35_0x287a11(0x208))),crypto_1=__importDefault(require('crypto')),currencyService_1=require('./currencyService'),telegramBotService_1=require(a35_0x287a11(0x14d));class AdminService{async[a35_0x287a11(0x1d9)](){const _0x4c0c7e=a35_0x287a11;console[_0x4c0c7e(0x136)](_0x4c0c7e(0x1bb));const _0x33dd9a=await database_1[_0x4c0c7e(0x185)]['shop'][_0x4c0c7e(0x137)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':'ACTIVE'}}),_0x46a252=new Date(),_0x560e99=new Date(_0x46a252[_0x4c0c7e(0x1f7)](),_0x46a252[_0x4c0c7e(0x1ff)](),0x1),_0x3937d9=new Date(_0x46a252['getFullYear'](),_0x46a252[_0x4c0c7e(0x1ff)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x2537ca=await database_1[_0x4c0c7e(0x185)][_0x4c0c7e(0x175)][_0x4c0c7e(0x137)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x560e99,'lte':_0x3937d9},'status':_0x4c0c7e(0x17e)}}),_0x14d2df=_0x33dd9a[_0x4c0c7e(0x1aa)][_0x4c0c7e(0x139)]||0x0,_0x54b31c=_0x33dd9a[_0x4c0c7e(0x1aa)][_0x4c0c7e(0x186)]||0x0,_0x26d5bb=_0x2537ca[_0x4c0c7e(0x1aa)][_0x4c0c7e(0x1fa)]||0x0,_0x1b4730={'totalPayout':Math[_0x4c0c7e(0x169)](_0x14d2df*0x64)/0x64,'awaitingPayout':Math[_0x4c0c7e(0x169)](_0x54b31c*0x64)/0x64,'thisMonth':Math['round'](_0x26d5bb*0x64)/0x64,'availableBalance':Math[_0x4c0c7e(0x169)](_0x54b31c*0x64)/0x64};return console[_0x4c0c7e(0x136)](_0x4c0c7e(0x1f4)),console['log']('\x20\x20\x20💰\x20Total\x20payout:\x20'+_0x1b4730['totalPayout']+_0x4c0c7e(0x1ee)),console['log'](_0x4c0c7e(0x19c)+_0x1b4730[_0x4c0c7e(0x16f)]+_0x4c0c7e(0x13f)),console[_0x4c0c7e(0x136)](_0x4c0c7e(0x19a)+_0x1b4730[_0x4c0c7e(0x1e4)]+_0x4c0c7e(0x196)),console[_0x4c0c7e(0x136)](_0x4c0c7e(0x202)+_0x1b4730[_0x4c0c7e(0x1f2)]+_0x4c0c7e(0x13d)),_0x1b4730;}async[a35_0x287a11(0x13a)](_0x2cb7af,_0x314850){const _0x2eed70=a35_0x287a11;console['log'](_0x2eed70(0x145)+_0x2cb7af+':',_0x314850);const _0x44131a=await database_1[_0x2eed70(0x185)][_0x2eed70(0x19d)][_0x2eed70(0x19b)]({'where':{'id':_0x2cb7af},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x44131a)throw new Error(_0x2eed70(0x1a0));const _0x1fd739={};_0x314850['customerCountry']!==undefined&&(_0x1fd739[_0x2eed70(0x1f9)]=_0x314850['customerCountry']||null);_0x314850[_0x2eed70(0x199)]!==undefined&&(_0x1fd739['customerIp']=_0x314850[_0x2eed70(0x199)]||null);_0x314850['customerUa']!==undefined&&(_0x1fd739[_0x2eed70(0x16a)]=_0x314850[_0x2eed70(0x16a)]||null);const _0x51270d=await database_1[_0x2eed70(0x185)][_0x2eed70(0x19d)]['update']({'where':{'id':_0x2cb7af},'data':{..._0x1fd739,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x2eed70(0x136)]('✅\x20Customer\x20data\x20updated\x20for\x20payment\x20'+_0x2cb7af),console[_0x2eed70(0x136)](_0x2eed70(0x1b7)+_0x44131a[_0x2eed70(0x1f9)]+_0x2eed70(0x14a)+_0x51270d[_0x2eed70(0x1f9)]),console[_0x2eed70(0x136)](_0x2eed70(0x1d0)+_0x44131a['customerIp']+'\x20->\x20'+_0x51270d['customerIp']),console['log'](_0x2eed70(0x1f3)+(_0x44131a[_0x2eed70(0x16a)]?'set':_0x2eed70(0x183))+'\x20->\x20'+(_0x51270d['customerUa']?'set':_0x2eed70(0x183))),_0x51270d;}async['getSystemStatistics'](_0x5cf8c4){const _0x1033c6=a35_0x287a11,_0x44c866=new Date();let _0x1371e1;switch(_0x5cf8c4){case'7d':_0x1371e1=new Date(_0x44c866[_0x1033c6(0x187)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x1033c6(0x190):_0x1371e1=new Date(_0x44c866[_0x1033c6(0x187)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'90d':_0x1371e1=new Date(_0x44c866[_0x1033c6(0x187)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x1371e1=new Date(_0x44c866['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x2cba62,_0x1ea2c5,_0x1aae2d,_0x81839b,_0x167487,_0x537a3e]=await Promise['all']([database_1[_0x1033c6(0x185)][_0x1033c6(0x1df)][_0x1033c6(0x1d4)](),database_1['default'][_0x1033c6(0x1df)][_0x1033c6(0x1d4)]({'where':{'status':_0x1033c6(0x1a1)}}),database_1[_0x1033c6(0x185)][_0x1033c6(0x19d)][_0x1033c6(0x1d4)]({'where':{'createdAt':{'gte':_0x1371e1},'gateway':{'not':'test_gateway'}}}),database_1[_0x1033c6(0x185)][_0x1033c6(0x19d)]['count']({'where':{'status':_0x1033c6(0x15d),'createdAt':{'gte':_0x1371e1},'gateway':{'not':_0x1033c6(0x17b)}}}),database_1[_0x1033c6(0x185)][_0x1033c6(0x19d)][_0x1033c6(0x20e)]({'where':{'status':_0x1033c6(0x15d),'createdAt':{'gte':_0x1371e1},'gateway':{'not':_0x1033c6(0x17b)}},'select':{'amount':!![],'currency':!![]}}),database_1['default'][_0x1033c6(0x19d)][_0x1033c6(0x20e)]({'where':{'gateway':{'not':_0x1033c6(0x17b)}},'take':0xa,'orderBy':{'createdAt':_0x1033c6(0x143)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}})]);let _0xf56c2=0x0;for(const _0x6d0de2 of _0x167487){const _0x533ea5=await currencyService_1[_0x1033c6(0x16b)][_0x1033c6(0x1d7)](_0x6d0de2[_0x1033c6(0x1fa)],_0x6d0de2[_0x1033c6(0x193)]);_0xf56c2+=_0x533ea5;}const _0xc74275=_0x1aae2d>0x0?_0x81839b/_0x1aae2d*0x64:0x0;return{'totalShops':_0x2cba62,'activeShops':_0x1ea2c5,'totalPayments':_0x1aae2d,'successfulPayments':_0x81839b,'totalRevenue':Math[_0x1033c6(0x169)](_0xf56c2*0x64)/0x64,'conversionRate':Math[_0x1033c6(0x169)](_0xc74275*0x64)/0x64,'recentPayments':_0x537a3e[_0x1033c6(0x1e2)](_0x40678a=>({'id':_0x40678a['id'],'amount':_0x40678a[_0x1033c6(0x1fa)],'currency':_0x40678a[_0x1033c6(0x193)],'status':_0x40678a[_0x1033c6(0x135)],'gateway':_0x40678a[_0x1033c6(0x204)],'shop':_0x40678a['shop'],'createdAt':_0x40678a['createdAt']}))};}async[a35_0x287a11(0x1b1)](_0x493cdd){const _0x2f1373=a35_0x287a11;console['log'](_0x2f1373(0x17d),_0x493cdd);let _0x49d862,_0x2b3efa=new Date();if(_0x493cdd[_0x2f1373(0x1ea)]===_0x2f1373(0x168)&&_0x493cdd[_0x2f1373(0x179)]&&_0x493cdd[_0x2f1373(0x207)])_0x49d862=new Date(_0x493cdd[_0x2f1373(0x179)]),_0x2b3efa=new Date(_0x493cdd['dateTo']);else{const _0x159229=new Date();switch(_0x493cdd[_0x2f1373(0x1ea)]){case _0x2f1373(0x188):_0x49d862=new Date(_0x159229[_0x2f1373(0x187)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x2f1373(0x1c6):_0x49d862=new Date(_0x159229[_0x2f1373(0x187)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x2f1373(0x18b):_0x49d862=new Date(_0x159229[_0x2f1373(0x187)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x2f1373(0x1fd):default:_0x49d862=new Date(_0x2f1373(0x1a7));break;}}console[_0x2f1373(0x136)]('📅\x20Period:\x20'+_0x49d862[_0x2f1373(0x158)]()+_0x2f1373(0x20a)+_0x2b3efa[_0x2f1373(0x158)]());const _0x551727={'status':_0x2f1373(0x15d),'gateway':{'not':_0x2f1373(0x17b)},'paidAt':{'gte':_0x49d862,'lte':_0x2b3efa}};_0x493cdd['shopId']&&(_0x551727[_0x2f1373(0x156)]=_0x493cdd['shopId']);const _0x13687b=await database_1[_0x2f1373(0x185)][_0x2f1373(0x19d)]['findMany']({'where':_0x551727,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x2f1373(0x136)]('💰\x20Found\x20'+_0x13687b['length']+_0x2f1373(0x160));let _0x29b1f3=0x0,_0x202c52=0x0,_0x24b7d2=0x0;const _0x409c5a={},_0x43e82a={},_0x2441e1={};for(const _0x38b4f4 of _0x13687b){try{const _0x3aaec5=await currencyService_1[_0x2f1373(0x16b)][_0x2f1373(0x1d7)](_0x38b4f4[_0x2f1373(0x1fa)],_0x38b4f4['currency']);let _0x353c3d={};if(_0x38b4f4[_0x2f1373(0x1df)]['gatewaySettings'])try{_0x353c3d=JSON[_0x2f1373(0x1e5)](_0x38b4f4[_0x2f1373(0x1df)]['gatewaySettings']);}catch(_0x133bb5){console[_0x2f1373(0x1dd)]('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x38b4f4[_0x2f1373(0x156)]+':',_0x133bb5);}const _0x266660=_0x353c3d[_0x2f1373(0x1b3)]||0xa,_0x48b6f1=_0x3aaec5*(_0x266660/0x64),_0x2b0851=_0x3aaec5-_0x48b6f1;_0x29b1f3+=_0x3aaec5,_0x202c52+=_0x2b0851,_0x24b7d2+=_0x48b6f1;!_0x409c5a[_0x38b4f4['gateway']]&&(_0x409c5a[_0x38b4f4['gateway']]={'gateway':_0x38b4f4[_0x2f1373(0x204)],'gatewayDisplayName':this['getGatewayDisplayName'](_0x38b4f4[_0x2f1373(0x204)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x409c5a[_0x38b4f4[_0x2f1373(0x204)]][_0x2f1373(0x181)]++,_0x409c5a[_0x38b4f4[_0x2f1373(0x204)]][_0x2f1373(0x1e6)]+=_0x3aaec5,_0x409c5a[_0x38b4f4[_0x2f1373(0x204)]][_0x2f1373(0x1f5)]+=_0x48b6f1,_0x409c5a[_0x38b4f4['gateway']][_0x2f1373(0x1de)]+=_0x2b0851,_0x409c5a[_0x38b4f4[_0x2f1373(0x204)]][_0x2f1373(0x13c)]+=_0x266660;!_0x493cdd['shopId']&&(!_0x43e82a[_0x38b4f4[_0x2f1373(0x156)]]&&(_0x43e82a[_0x38b4f4['shopId']]={'shopId':_0x38b4f4[_0x2f1373(0x156)],'shopName':_0x38b4f4[_0x2f1373(0x1df)]['name'],'shopUsername':_0x38b4f4['shop'][_0x2f1373(0x13e)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x43e82a[_0x38b4f4[_0x2f1373(0x156)]][_0x2f1373(0x181)]++,_0x43e82a[_0x38b4f4[_0x2f1373(0x156)]]['turnoverUSDT']+=_0x3aaec5,_0x43e82a[_0x38b4f4['shopId']][_0x2f1373(0x1f5)]+=_0x48b6f1,_0x43e82a[_0x38b4f4[_0x2f1373(0x156)]][_0x2f1373(0x1de)]+=_0x2b0851);const _0x3dd312=_0x38b4f4['paidAt']['toISOString']()['split']('T')[0x0];!_0x2441e1[_0x3dd312]&&(_0x2441e1[_0x3dd312]={'date':_0x3dd312,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x2441e1[_0x3dd312][_0x2f1373(0x1bd)]+=_0x3aaec5,_0x2441e1[_0x3dd312][_0x2f1373(0x16c)]+=_0x2b0851,_0x2441e1[_0x3dd312]['gatewayEarnings']+=_0x48b6f1,_0x2441e1[_0x3dd312][_0x2f1373(0x181)]++;}catch(_0x45df87){console[_0x2f1373(0x1dd)](_0x2f1373(0x195)+_0x38b4f4['id']+':',_0x45df87);}}Object[_0x2f1373(0x20d)](_0x409c5a)[_0x2f1373(0x1a4)](_0x41127a=>{const _0x59ec41=_0x2f1373;_0x41127a['averageCommissionRate']=_0x41127a[_0x59ec41(0x181)]>0x0?_0x41127a['totalCommissionRate']/_0x41127a[_0x59ec41(0x181)]:0x0,delete _0x41127a[_0x59ec41(0x13c)];}),Object[_0x2f1373(0x20d)](_0x43e82a)['forEach'](_0x1064b6=>{const _0x2b3022=_0x2f1373;_0x1064b6['averageCheckUSDT']=_0x1064b6[_0x2b3022(0x181)]>0x0?_0x1064b6[_0x2b3022(0x1e6)]/_0x1064b6[_0x2b3022(0x181)]:0x0;});let _0x135849=0x0;if(_0x493cdd[_0x2f1373(0x156)]){const _0x41dc21=await database_1[_0x2f1373(0x185)][_0x2f1373(0x175)][_0x2f1373(0x20e)]({'where':{'shopId':_0x493cdd[_0x2f1373(0x156)],'status':_0x2f1373(0x17e),'createdAt':{'gte':_0x49d862,'lte':_0x2b3efa}},'select':{'amount':!![]}});_0x135849=_0x41dc21[_0x2f1373(0x1ac)]((_0x21c972,_0x2bdd51)=>_0x21c972+_0x2bdd51[_0x2f1373(0x1fa)],0x0);}const _0x31f3fc=_0x13687b['length'],_0x1ccb2f=_0x13687b[_0x2f1373(0x15f)],_0x10e6fb=_0x31f3fc>0x0?_0x29b1f3/_0x31f3fc:0x0,_0x205448=0x64,_0x1aea02=Math[_0x2f1373(0x1e0)]((_0x2b3efa[_0x2f1373(0x187)]()-_0x49d862[_0x2f1373(0x187)]())/(0x3e8*0x3c*0x3c*0x18)),_0x3e4b01={'totalTurnover':Math['round'](_0x29b1f3*0x64)/0x64,'merchantEarnings':Math['round'](_0x202c52*0x64)/0x64,'gatewayEarnings':Math['round'](_0x24b7d2*0x64)/0x64,'totalPaidOut':Math[_0x2f1373(0x169)](_0x135849*0x64)/0x64,'averageCheck':Math[_0x2f1373(0x169)](_0x10e6fb*0x64)/0x64,'totalPayments':_0x31f3fc,'successfulPayments':_0x1ccb2f,'conversionRate':_0x205448,'gatewayBreakdown':Object[_0x2f1373(0x20d)](_0x409c5a)['map'](_0x1b93b4=>({..._0x1b93b4,'turnoverUSDT':Math['round'](_0x1b93b4['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x2f1373(0x169)](_0x1b93b4[_0x2f1373(0x1f5)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x1b93b4[_0x2f1373(0x1de)]*0x64)/0x64,'averageCommissionRate':Math['round'](_0x1b93b4['averageCommissionRate']*0x64)/0x64})),'merchantBreakdown':_0x493cdd[_0x2f1373(0x156)]?undefined:Object['values'](_0x43e82a)[_0x2f1373(0x1e2)](_0xe69670=>({..._0xe69670,'turnoverUSDT':Math[_0x2f1373(0x169)](_0xe69670[_0x2f1373(0x1e6)]*0x64)/0x64,'commissionUSDT':Math['round'](_0xe69670['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x2f1373(0x169)](_0xe69670[_0x2f1373(0x1de)]*0x64)/0x64,'paidOutUSDT':Math['round'](_0xe69670[_0x2f1373(0x157)]*0x64)/0x64,'averageCheckUSDT':Math[_0x2f1373(0x169)](_0xe69670['averageCheckUSDT']*0x64)/0x64})),'dailyData':Object[_0x2f1373(0x20d)](_0x2441e1)[_0x2f1373(0x1e2)](_0x5ce680=>({..._0x5ce680,'turnover':Math[_0x2f1373(0x169)](_0x5ce680[_0x2f1373(0x1bd)]*0x64)/0x64,'merchantEarnings':Math['round'](_0x5ce680[_0x2f1373(0x16c)]*0x64)/0x64,'gatewayEarnings':Math['round'](_0x5ce680[_0x2f1373(0x18d)]*0x64)/0x64}))[_0x2f1373(0x1ae)]((_0x3e0dd2,_0x4d4c34)=>_0x3e0dd2[_0x2f1373(0x182)]['localeCompare'](_0x4d4c34[_0x2f1373(0x182)])),'periodInfo':{'from':_0x49d862,'to':_0x2b3efa,'periodType':_0x493cdd[_0x2f1373(0x1ea)]||_0x2f1373(0x168),'daysCount':_0x1aea02}};return console['log']('📊\x20Merchant\x20statistics\x20calculated:'),console[_0x2f1373(0x136)](_0x2f1373(0x1f0)+_0x3e4b01['totalTurnover']+_0x2f1373(0x13d)),console['log'](_0x2f1373(0x1fe)+_0x3e4b01[_0x2f1373(0x16c)]+_0x2f1373(0x13d)),console[_0x2f1373(0x136)]('\x20\x20\x20🏪\x20Gateway\x20earnings:\x20'+_0x3e4b01[_0x2f1373(0x18d)]+_0x2f1373(0x13d)),console[_0x2f1373(0x136)](_0x2f1373(0x1cc)+_0x3e4b01[_0x2f1373(0x1c3)]),_0x3e4b01;}[a35_0x287a11(0x1db)](_0x235b30){const _0xe58c3d=a35_0x287a11,_0x57c5de={'test_gateway':_0xe58c3d(0x1ba),'plisio':_0xe58c3d(0x1fb),'rapyd':_0xe58c3d(0x1ca),'noda':_0xe58c3d(0x17f),'cointopay':_0xe58c3d(0x1ed),'klyme_eu':_0xe58c3d(0x1c5),'klyme_gb':_0xe58c3d(0x1a9),'klyme_de':'KLYME\x20DE'};return _0x57c5de[_0x235b30]||_0x235b30;}async[a35_0x287a11(0x1f8)](_0x1f56c8){const _0x2bd4f5=a35_0x287a11,{page:_0x5889ca,limit:_0x4935f1,minAmount:_0x370ca0,search:_0x5b5463}=_0x1f56c8,_0x26e29d=(_0x5889ca-0x1)*_0x4935f1;console[_0x2bd4f5(0x136)](_0x2bd4f5(0x20b),_0x1f56c8);const _0x4ac017={'balance':{'gt':0x0},'status':_0x2bd4f5(0x1a1)};_0x370ca0&&(_0x4ac017[_0x2bd4f5(0x186)][_0x2bd4f5(0x174)]=_0x370ca0);_0x5b5463&&(_0x4ac017['OR']=[{'name':{'contains':_0x5b5463,'mode':_0x2bd4f5(0x1d2)}},{'username':{'contains':_0x5b5463,'mode':_0x2bd4f5(0x1d2)}}]);const [_0x4c6fc5,_0x3383ba]=await Promise[_0x2bd4f5(0x1fd)]([database_1[_0x2bd4f5(0x185)][_0x2bd4f5(0x1df)][_0x2bd4f5(0x20e)]({'where':_0x4ac017,'skip':_0x26e29d,'take':_0x4935f1,'orderBy':{'balance':_0x2bd4f5(0x143)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'createdAt':!![]}}),database_1[_0x2bd4f5(0x185)][_0x2bd4f5(0x1df)]['count']({'where':_0x4ac017})]);console[_0x2bd4f5(0x136)](_0x2bd4f5(0x159)+_0x4c6fc5[_0x2bd4f5(0x15f)]+'\x20merchants\x20with\x20positive\x20balance');const _0x5f154b=await Promise[_0x2bd4f5(0x1fd)](_0x4c6fc5['map'](async _0x3eb10d=>{const _0x2eeeba=_0x2bd4f5,[_0x53fe21,_0x1f6755,_0x360760]=await Promise[_0x2eeeba(0x1fd)]([database_1[_0x2eeeba(0x185)][_0x2eeeba(0x19d)][_0x2eeeba(0x1d4)]({'where':{'shopId':_0x3eb10d['id'],'status':_0x2eeeba(0x15d),'amountUSDT':{'not':null}}}),database_1[_0x2eeeba(0x185)][_0x2eeeba(0x19d)][_0x2eeeba(0x165)]({'where':{'shopId':_0x3eb10d['id'],'status':_0x2eeeba(0x15d),'amountUSDT':{'not':null}},'orderBy':{'paidAt':_0x2eeeba(0x1b9)},'select':{'paidAt':!![]}}),database_1[_0x2eeeba(0x185)]['payment']['groupBy']({'by':[_0x2eeeba(0x204)],'where':{'shopId':_0x3eb10d['id'],'status':_0x2eeeba(0x15d),'amountUSDT':{'not':null}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x3d3813=_0x360760['map'](_0x3032e8=>({'gateway':_0x3032e8['gateway'],'count':_0x3032e8[_0x2eeeba(0x1c1)]['id'],'amountUSDT':_0x3032e8['_sum'][_0x2eeeba(0x194)]||0x0,'amountAfterCommissionUSDT':_0x3032e8[_0x2eeeba(0x1aa)][_0x2eeeba(0x194)]||0x0,'commission':0x0}));return{'id':_0x3eb10d['id'],'fullName':_0x3eb10d[_0x2eeeba(0x13b)],'username':_0x3eb10d['username'],'telegramId':_0x3eb10d[_0x2eeeba(0x1a3)],'merchantUrl':_0x3eb10d['shopUrl'],'wallets':{'usdtPolygonWallet':_0x3eb10d[_0x2eeeba(0x1c4)],'usdtTrcWallet':_0x3eb10d[_0x2eeeba(0x189)],'usdtErcWallet':_0x3eb10d[_0x2eeeba(0x16e)],'usdcPolygonWallet':_0x3eb10d[_0x2eeeba(0x1e8)]},'totalAmountUSDT':_0x3eb10d[_0x2eeeba(0x186)],'totalAmountAfterCommissionUSDT':_0x3eb10d[_0x2eeeba(0x186)],'paymentsCount':_0x53fe21,'oldestPaymentDate':_0x1f6755?.[_0x2eeeba(0x1e7)]||_0x3eb10d['createdAt'],'gatewayBreakdown':_0x3d3813};})),_0x55acb9=_0x4c6fc5['reduce']((_0x43dbb0,_0x478d64)=>_0x43dbb0+_0x478d64[_0x2bd4f5(0x186)],0x0),_0x1d7cfa=_0x55acb9;return console['log'](_0x2bd4f5(0x18f)+_0x3383ba+_0x2bd4f5(0x1dc)+Math[_0x2bd4f5(0x169)](_0x1d7cfa*0x64)/0x64+_0x2bd4f5(0x14e)),{'merchants':_0x5f154b,'pagination':{'page':_0x5889ca,'limit':_0x4935f1,'total':_0x3383ba,'totalPages':Math[_0x2bd4f5(0x1e0)](_0x3383ba/_0x4935f1)},'summary':{'totalMerchants':_0x3383ba,'totalAmountUSDT':Math[_0x2bd4f5(0x169)](_0x55acb9*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x2bd4f5(0x169)](_0x1d7cfa*0x64)/0x64}};}async[a35_0x287a11(0x1c9)](_0x121b03){const _0x3a097a=a35_0x287a11,{shopId:_0x47c691,amount:_0x897e61,network:_0x13e4e0,notes:_0x81a7b2,txid:_0x40aee2,periodFrom:_0x575585,periodTo:_0x41e534}=_0x121b03,_0x492c3b=await database_1['default'][_0x3a097a(0x1f6)](async _0x16c0c6=>{const _0x5931b0=_0x3a097a,_0x13f1ce=await _0x16c0c6[_0x5931b0(0x1df)]['findUnique']({'where':{'id':_0x47c691},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x13f1ce)throw new Error(_0x5931b0(0x209));console['log']('💰\x20Creating\x20payout\x20for\x20shop\x20'+_0x13f1ce[_0x5931b0(0x13e)]+':'),console[_0x5931b0(0x136)](_0x5931b0(0x191)+_0x13f1ce[_0x5931b0(0x186)]['toFixed'](0x6)+_0x5931b0(0x13d)),console[_0x5931b0(0x136)](_0x5931b0(0x1b6)+_0x897e61['toFixed'](0x6)+_0x5931b0(0x13d)),console['log'](_0x5931b0(0x1ef)+_0x13f1ce[_0x5931b0(0x139)][_0x5931b0(0x148)](0x6)+_0x5931b0(0x13d));if(_0x40aee2)console[_0x5931b0(0x136)](_0x5931b0(0x150)+_0x40aee2);if(_0x13f1ce[_0x5931b0(0x186)]<_0x897e61)throw new Error(_0x5931b0(0x1be)+_0x13f1ce['balance'][_0x5931b0(0x148)](0x6)+_0x5931b0(0x151)+_0x897e61[_0x5931b0(0x148)](0x6)+_0x5931b0(0x13d));const _0x4b095c=await _0x16c0c6['payout'][_0x5931b0(0x1cd)]({'data':{'shopId':_0x47c691,'amount':_0x897e61,'network':_0x13e4e0,'status':'COMPLETED','txid':_0x40aee2,'notes':_0x81a7b2,'periodFrom':_0x575585?new Date(_0x575585):null,'periodTo':_0x41e534?new Date(_0x41e534):null,'createdAt':new Date(),'paidAt':new Date()}}),_0xeae195=_0x13f1ce[_0x5931b0(0x186)]-_0x897e61,_0x412565=_0x13f1ce['totalPaidOut']+_0x897e61;return await _0x16c0c6['shop'][_0x5931b0(0x201)]({'where':{'id':_0x47c691},'data':{'balance':_0xeae195,'totalPaidOut':_0x412565}}),console[_0x5931b0(0x136)]('💰\x20Shop\x20'+_0x13f1ce[_0x5931b0(0x13e)]+'\x20balance\x20updated:'),console[_0x5931b0(0x136)](_0x5931b0(0x1eb)+_0x13f1ce[_0x5931b0(0x186)]['toFixed'](0x6)+_0x5931b0(0x14a)+_0xeae195[_0x5931b0(0x148)](0x6)+_0x5931b0(0x1ad)+_0x897e61[_0x5931b0(0x148)](0x6)+')'),console[_0x5931b0(0x136)](_0x5931b0(0x16d)+_0x13f1ce['totalPaidOut'][_0x5931b0(0x148)](0x6)+'\x20->\x20'+_0x412565[_0x5931b0(0x148)](0x6)+_0x5931b0(0x1e1)+_0x897e61[_0x5931b0(0x148)](0x6)+')'),{'payout':_0x4b095c,'shop':_0x13f1ce};});console[_0x3a097a(0x136)](_0x3a097a(0x15c)+_0x492c3b['payout']['id']+_0x3a097a(0x1e9)+_0x492c3b['shop'][_0x3a097a(0x13e)]+'\x20('+_0x897e61+_0x3a097a(0x1ce));try{await telegramBotService_1['telegramBotService'][_0x3a097a(0x161)](_0x47c691,{'id':_0x492c3b[_0x3a097a(0x175)]['id'],'amount':_0x492c3b[_0x3a097a(0x175)][_0x3a097a(0x1fa)],'method':_0x492c3b[_0x3a097a(0x175)]['network'],'txid':_0x492c3b[_0x3a097a(0x175)][_0x3a097a(0x162)],'createdAt':_0x492c3b[_0x3a097a(0x175)]['createdAt']},'created'),console['log'](_0x3a097a(0x15b)+_0x492c3b[_0x3a097a(0x175)]['id']);}catch(_0x5e6a4c){console['error']('❌\x20Failed\x20to\x20send\x20Telegram\x20notification\x20for\x20payout\x20'+_0x492c3b[_0x3a097a(0x175)]['id']+':',_0x5e6a4c);}return{'id':_0x492c3b[_0x3a097a(0x175)]['id'],'shopId':_0x492c3b['payout'][_0x3a097a(0x156)],'shopName':_0x492c3b[_0x3a097a(0x1df)]['name'],'shopUsername':_0x492c3b[_0x3a097a(0x1df)][_0x3a097a(0x13e)],'amount':_0x492c3b['payout'][_0x3a097a(0x1fa)],'network':_0x492c3b[_0x3a097a(0x175)][_0x3a097a(0x1c2)],'status':_0x492c3b[_0x3a097a(0x175)][_0x3a097a(0x135)],'txid':_0x492c3b[_0x3a097a(0x175)][_0x3a097a(0x162)],'notes':_0x492c3b[_0x3a097a(0x175)]['notes'],'periodFrom':_0x492c3b['payout'][_0x3a097a(0x1a2)],'periodTo':_0x492c3b[_0x3a097a(0x175)]['periodTo'],'createdAt':_0x492c3b[_0x3a097a(0x175)]['createdAt'],'paidAt':_0x492c3b[_0x3a097a(0x175)][_0x3a097a(0x1e7)]};}async[a35_0x287a11(0x192)](_0x4dc7a4){const _0x10d46f=a35_0x287a11,{page:_0x194bd2,limit:_0x22d22b,shopId:_0x249f8e,network:_0x79a9d8,dateFrom:_0x3d1e53,dateTo:_0x154875,search:_0x28f51c}=_0x4dc7a4,_0x1c50de=(_0x194bd2-0x1)*_0x22d22b,_0xb09f38={};_0x249f8e&&(_0xb09f38[_0x10d46f(0x156)]=_0x249f8e);_0x79a9d8&&(_0xb09f38[_0x10d46f(0x1c2)]=_0x79a9d8);(_0x3d1e53||_0x154875)&&(_0xb09f38['createdAt']={},_0x3d1e53&&(_0xb09f38[_0x10d46f(0x172)][_0x10d46f(0x174)]=new Date(_0x3d1e53)),_0x154875&&(_0xb09f38[_0x10d46f(0x172)][_0x10d46f(0x177)]=new Date(_0x154875)));_0x28f51c&&(_0xb09f38['OR']=[{'shop':{'name':{'contains':_0x28f51c,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x28f51c,'mode':_0x10d46f(0x1d2)}}},{'notes':{'contains':_0x28f51c,'mode':'insensitive'}}]);const [_0x31654a,_0x310b26]=await Promise[_0x10d46f(0x1fd)]([database_1[_0x10d46f(0x185)][_0x10d46f(0x175)][_0x10d46f(0x20e)]({'where':_0xb09f38,'skip':_0x1c50de,'take':_0x22d22b,'orderBy':{'createdAt':_0x10d46f(0x143)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x10d46f(0x185)][_0x10d46f(0x175)][_0x10d46f(0x1d4)]({'where':_0xb09f38})]);return{'payouts':_0x31654a[_0x10d46f(0x1e2)](_0x33452b=>({'id':_0x33452b['id'],'shopId':_0x33452b[_0x10d46f(0x156)],'shopName':_0x33452b[_0x10d46f(0x1df)]['name'],'shopUsername':_0x33452b[_0x10d46f(0x1df)][_0x10d46f(0x13e)],'amount':_0x33452b[_0x10d46f(0x1fa)],'network':_0x33452b['network'],'status':_0x33452b[_0x10d46f(0x135)],'txid':_0x33452b[_0x10d46f(0x162)],'notes':_0x33452b['notes'],'periodFrom':_0x33452b[_0x10d46f(0x1a2)],'periodTo':_0x33452b['periodTo'],'createdAt':_0x33452b['createdAt'],'paidAt':_0x33452b[_0x10d46f(0x1e7)]})),'pagination':{'page':_0x194bd2,'limit':_0x22d22b,'total':_0x310b26,'totalPages':Math[_0x10d46f(0x1e0)](_0x310b26/_0x22d22b)}};}async[a35_0x287a11(0x178)](_0x329147){const _0x556d8a=a35_0x287a11,_0x5d7542=await database_1['default']['payout'][_0x556d8a(0x19b)]({'where':{'id':_0x329147},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x5d7542)return null;return{'id':_0x5d7542['id'],'shopId':_0x5d7542[_0x556d8a(0x156)],'shopName':_0x5d7542[_0x556d8a(0x1df)]['name'],'shopUsername':_0x5d7542['shop'][_0x556d8a(0x13e)],'amount':_0x5d7542[_0x556d8a(0x1fa)],'network':_0x5d7542[_0x556d8a(0x1c2)],'status':_0x5d7542['status'],'txid':_0x5d7542['txid'],'notes':_0x5d7542['notes'],'periodFrom':_0x5d7542['periodFrom'],'periodTo':_0x5d7542[_0x556d8a(0x1b8)],'createdAt':_0x5d7542[_0x556d8a(0x172)],'paidAt':_0x5d7542[_0x556d8a(0x1e7)]};}async['deletePayout'](_0x12800b){const _0x227131=a35_0x287a11;await database_1[_0x227131(0x185)][_0x227131(0x175)]['delete']({'where':{'id':_0x12800b}});}async[a35_0x287a11(0x1cf)](_0x5c6822){const _0xffc877=a35_0x287a11,{page:_0x24fbd4,limit:_0x4bbfd2,status:_0x23ec34,gateway:_0x3f7231,shopId:_0x146792,dateFrom:_0x201531,dateTo:_0x2cefd1,search:_0x4125ba}=_0x5c6822,_0x3e8a53=(_0x24fbd4-0x1)*_0x4bbfd2,_0x275e2f={};_0x23ec34&&(_0x275e2f[_0xffc877(0x135)]=_0x23ec34[_0xffc877(0x138)]());_0x3f7231&&(_0x275e2f['gateway']=_0x3f7231[_0xffc877(0x153)]());_0x275e2f[_0xffc877(0x204)]=_0x275e2f[_0xffc877(0x204)]?_0x275e2f[_0xffc877(0x204)]:{'not':_0xffc877(0x17b)};if(typeof _0x275e2f[_0xffc877(0x204)]===_0xffc877(0x1cb)&&_0x275e2f['gateway']!==_0xffc877(0x17b)){}else{if(typeof _0x275e2f[_0xffc877(0x204)]===_0xffc877(0x1cb)&&_0x275e2f[_0xffc877(0x204)]===_0xffc877(0x17b)){}else _0x275e2f['gateway']={'not':_0xffc877(0x17b)};}_0x146792&&(_0x275e2f[_0xffc877(0x156)]=_0x146792);(_0x201531||_0x2cefd1)&&(_0x275e2f[_0xffc877(0x172)]={},_0x201531&&(_0x275e2f[_0xffc877(0x172)][_0xffc877(0x174)]=new Date(_0x201531)),_0x2cefd1&&(_0x275e2f[_0xffc877(0x172)][_0xffc877(0x177)]=new Date(_0x2cefd1)));_0x4125ba&&(_0x275e2f['OR']=[{'orderId':{'contains':_0x4125ba,'mode':_0xffc877(0x1d2)}},{'gatewayOrderId':{'contains':_0x4125ba,'mode':_0xffc877(0x1d2)}},{'customerEmail':{'contains':_0x4125ba,'mode':_0xffc877(0x1d2)}},{'shop':{'name':{'contains':_0x4125ba,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x4125ba,'mode':'insensitive'}}}]);const [_0x1225f9,_0x1ce5bb]=await Promise[_0xffc877(0x1fd)]([database_1['default'][_0xffc877(0x19d)][_0xffc877(0x20e)]({'where':_0x275e2f,'skip':_0x3e8a53,'take':_0x4bbfd2,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0xffc877(0x185)][_0xffc877(0x19d)][_0xffc877(0x1d4)]({'where':_0x275e2f})]);return{'payments':_0x1225f9['map'](_0x448c07=>({'id':_0x448c07['id'],'shopId':_0x448c07['shopId'],'gateway':_0x448c07['gateway'],'amount':_0x448c07[_0xffc877(0x1fa)],'currency':_0x448c07[_0xffc877(0x193)],'status':_0x448c07[_0xffc877(0x135)],'orderId':_0x448c07[_0xffc877(0x198)],'gatewayOrderId':_0x448c07['gatewayOrderId'],'customerEmail':_0x448c07[_0xffc877(0x1f1)],'customerName':_0x448c07['customerName'],'customerCountry':_0x448c07[_0xffc877(0x1f9)],'customerIp':_0x448c07[_0xffc877(0x199)],'customerUa':_0x448c07['customerUa'],'failureMessage':_0x448c07[_0xffc877(0x140)],'createdAt':_0x448c07[_0xffc877(0x172)],'updatedAt':_0x448c07[_0xffc877(0x1b2)],'shop':_0x448c07['shop']})),'pagination':{'page':_0x24fbd4,'limit':_0x4bbfd2,'total':_0x1ce5bb,'totalPages':Math[_0xffc877(0x1e0)](_0x1ce5bb/_0x4bbfd2)}};}async[a35_0x287a11(0x18e)](_0x24a821){const _0x40010a=a35_0x287a11,_0x51dc87=await database_1[_0x40010a(0x185)][_0x40010a(0x19d)][_0x40010a(0x19b)]({'where':{'id':_0x24a821},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x51dc87)return null;return{'id':_0x51dc87['id'],'shopId':_0x51dc87[_0x40010a(0x156)],'gateway':_0x51dc87[_0x40010a(0x204)],'amount':_0x51dc87['amount'],'currency':_0x51dc87[_0x40010a(0x193)],'status':_0x51dc87[_0x40010a(0x135)],'orderId':_0x51dc87['orderId'],'gatewayOrderId':_0x51dc87[_0x40010a(0x1b4)],'customerEmail':_0x51dc87['customerEmail'],'customerName':_0x51dc87[_0x40010a(0x197)],'customerCountry':_0x51dc87[_0x40010a(0x1f9)],'customerIp':_0x51dc87['customerIp'],'customerUa':_0x51dc87[_0x40010a(0x16a)],'failureMessage':_0x51dc87[_0x40010a(0x140)],'externalPaymentUrl':_0x51dc87['externalPaymentUrl'],'successUrl':_0x51dc87[_0x40010a(0x1ec)],'failUrl':_0x51dc87['failUrl'],'pendingUrl':_0x51dc87['pendingUrl'],'whiteUrl':_0x51dc87['whiteUrl'],'createdAt':_0x51dc87['createdAt'],'updatedAt':_0x51dc87[_0x40010a(0x1b2)],'shop':_0x51dc87['shop']};}async[a35_0x287a11(0x173)](_0x479f85,_0x57e91a,_0x3deb4a,_0x38d90c){const _0x72331a=a35_0x287a11,_0x5c92be=await database_1[_0x72331a(0x185)][_0x72331a(0x1f6)](async _0x3a09e0=>{const _0x8a5fa0=_0x72331a,_0x524819=await _0x3a09e0['payment'][_0x8a5fa0(0x19b)]({'where':{'id':_0x479f85},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x524819)throw new Error(_0x8a5fa0(0x1a0));const _0x3ffaae=_0x524819[_0x8a5fa0(0x135)],_0x1848bc=_0x57e91a[_0x8a5fa0(0x138)]();console[_0x8a5fa0(0x136)](_0x8a5fa0(0x1da)+_0x479f85+_0x8a5fa0(0x210)+_0x3ffaae+'\x20->\x20'+_0x1848bc),console[_0x8a5fa0(0x136)](_0x8a5fa0(0x1d8)+_0x524819['shop'][_0x8a5fa0(0x186)]+_0x8a5fa0(0x13d));const _0x2a7c2f={'status':_0x1848bc,'updatedAt':new Date(),'statusChangedBy':'admin','statusChangedAt':new Date()};_0x3deb4a&&(_0x2a7c2f['adminNotes']=_0x3deb4a);_0x1848bc==='CHARGEBACK'&&_0x38d90c&&(_0x2a7c2f[_0x8a5fa0(0x1d1)]=_0x38d90c);let _0x548488=0x0,_0x3a123e=_0x524819[_0x8a5fa0(0x1df)][_0x8a5fa0(0x186)];if(_0x1848bc===_0x8a5fa0(0x15d)&&_0x3ffaae!==_0x8a5fa0(0x15d)){_0x2a7c2f[_0x8a5fa0(0x1e7)]=new Date();const _0x1b379b=await currencyService_1[_0x8a5fa0(0x16b)]['convertToUSDT'](_0x524819[_0x8a5fa0(0x1fa)],_0x524819[_0x8a5fa0(0x193)]);_0x2a7c2f[_0x8a5fa0(0x194)]=_0x1b379b,_0x548488=_0x1b379b,_0x3a123e+=_0x1b379b,console['log'](_0x8a5fa0(0x19e)+_0x479f85+_0x8a5fa0(0x1af)+_0x1b379b[_0x8a5fa0(0x148)](0x6)+'\x20USDT\x20to\x20balance');}else _0x3ffaae===_0x8a5fa0(0x15d)&&_0x1848bc!=='PAID'&&(_0x524819[_0x8a5fa0(0x194)]&&(_0x548488=-_0x524819['amountUSDT'],_0x3a123e-=_0x524819[_0x8a5fa0(0x194)],_0x2a7c2f[_0x8a5fa0(0x194)]=null,console[_0x8a5fa0(0x136)](_0x8a5fa0(0x19e)+_0x479f85+_0x8a5fa0(0x1bf)+_0x524819[_0x8a5fa0(0x194)]['toFixed'](0x6)+_0x8a5fa0(0x144))));if(_0x1848bc==='CHARGEBACK'){if(_0x3ffaae===_0x8a5fa0(0x15d)&&_0x524819[_0x8a5fa0(0x194)]){}_0x38d90c&&_0x38d90c>0x0&&(_0x548488-=_0x38d90c,_0x3a123e-=_0x38d90c,console[_0x8a5fa0(0x136)](_0x8a5fa0(0x166)+_0x38d90c[_0x8a5fa0(0x148)](0x6)+'\x20USDT\x20from\x20balance'));}_0x1848bc===_0x8a5fa0(0x20c)&&_0x3ffaae===_0x8a5fa0(0x15d)&&console['log']('🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance');const _0x23a0f6=await _0x3a09e0[_0x8a5fa0(0x19d)][_0x8a5fa0(0x201)]({'where':{'id':_0x479f85},'data':_0x2a7c2f,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x548488!==0x0&&(await _0x3a09e0[_0x8a5fa0(0x1df)][_0x8a5fa0(0x201)]({'where':{'id':_0x524819[_0x8a5fa0(0x156)]},'data':{'balance':_0x3a123e}}),console['log']('💰\x20Shop\x20'+_0x524819[_0x8a5fa0(0x156)]+_0x8a5fa0(0x171)+_0x524819['shop'][_0x8a5fa0(0x186)][_0x8a5fa0(0x148)](0x6)+_0x8a5fa0(0x14a)+_0x3a123e[_0x8a5fa0(0x148)](0x6)+_0x8a5fa0(0x154)+(_0x548488>0x0?'+':'')+_0x548488['toFixed'](0x6)+')')),_0x23a0f6;});return{'id':_0x5c92be['id'],'shopId':_0x5c92be['shopId'],'gateway':_0x5c92be[_0x72331a(0x204)],'amount':_0x5c92be[_0x72331a(0x1fa)],'currency':_0x5c92be[_0x72331a(0x193)],'status':_0x5c92be[_0x72331a(0x135)],'orderId':_0x5c92be[_0x72331a(0x198)],'gatewayOrderId':_0x5c92be[_0x72331a(0x1b4)],'customerEmail':_0x5c92be[_0x72331a(0x1f1)],'customerName':_0x5c92be['customerName'],'customerCountry':_0x5c92be[_0x72331a(0x1f9)],'customerIp':_0x5c92be[_0x72331a(0x199)],'customerUa':_0x5c92be[_0x72331a(0x16a)],'failureMessage':_0x5c92be[_0x72331a(0x140)],'adminNotes':_0x5c92be[_0x72331a(0x17c)],'chargebackAmount':_0x5c92be[_0x72331a(0x1d1)],'statusChangedBy':_0x5c92be[_0x72331a(0x206)],'statusChangedAt':_0x5c92be['statusChangedAt'],'createdAt':_0x5c92be[_0x72331a(0x172)],'updatedAt':_0x5c92be[_0x72331a(0x1b2)],'shop':_0x5c92be[_0x72331a(0x1df)]};}async['updateUser'](_0x59b68a,_0x51597c){const _0x587e6e=a35_0x287a11,_0x1c9ce7={..._0x51597c};_0x51597c[_0x587e6e(0x167)]&&(_0x1c9ce7[_0x587e6e(0x167)]=await bcryptjs_1[_0x587e6e(0x185)][_0x587e6e(0x1c0)](_0x51597c['password'],0xc));_0x51597c[_0x587e6e(0x14b)]&&(_0x1c9ce7[_0x587e6e(0x13b)]=_0x51597c['fullName'],delete _0x1c9ce7[_0x587e6e(0x14b)]);_0x51597c['telegramId']&&(_0x1c9ce7[_0x587e6e(0x1a3)]=_0x51597c[_0x587e6e(0x146)],delete _0x1c9ce7[_0x587e6e(0x146)]);_0x51597c[_0x587e6e(0x1d5)]&&(_0x1c9ce7[_0x587e6e(0x1a5)]=_0x51597c[_0x587e6e(0x1d5)],delete _0x1c9ce7[_0x587e6e(0x1d5)]);_0x51597c['gateways']&&(_0x1c9ce7[_0x587e6e(0x1d6)]=JSON[_0x587e6e(0x1a8)](_0x51597c[_0x587e6e(0x147)]),delete _0x1c9ce7['gateways']);_0x51597c[_0x587e6e(0x149)]&&(_0x1c9ce7[_0x587e6e(0x149)]=JSON[_0x587e6e(0x1a8)](_0x51597c[_0x587e6e(0x149)]),delete _0x1c9ce7[_0x587e6e(0x149)]);_0x51597c[_0x587e6e(0x18c)]&&(_0x51597c['wallets'][_0x587e6e(0x1c4)]!==undefined&&(_0x1c9ce7[_0x587e6e(0x1c4)]=_0x51597c[_0x587e6e(0x18c)][_0x587e6e(0x1c4)]||null),_0x51597c[_0x587e6e(0x18c)][_0x587e6e(0x189)]!==undefined&&(_0x1c9ce7[_0x587e6e(0x189)]=_0x51597c[_0x587e6e(0x18c)][_0x587e6e(0x189)]||null),_0x51597c[_0x587e6e(0x18c)]['usdtErcWallet']!==undefined&&(_0x1c9ce7['usdtErcWallet']=_0x51597c[_0x587e6e(0x18c)][_0x587e6e(0x16e)]||null),_0x51597c[_0x587e6e(0x18c)][_0x587e6e(0x1e8)]!==undefined&&(_0x1c9ce7['usdcPolygonWallet']=_0x51597c[_0x587e6e(0x18c)][_0x587e6e(0x1e8)]||null),delete _0x1c9ce7[_0x587e6e(0x18c)]);const _0x3e5b59=await database_1[_0x587e6e(0x185)]['shop'][_0x587e6e(0x201)]({'where':{'id':_0x59b68a},'data':_0x1c9ce7,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x3e5b59['id'],'fullName':_0x3e5b59[_0x587e6e(0x13b)],'username':_0x3e5b59['username'],'telegramId':_0x3e5b59[_0x587e6e(0x1a3)],'merchantUrl':_0x3e5b59[_0x587e6e(0x1a5)],'gateways':_0x3e5b59['paymentGateways']?JSON[_0x587e6e(0x1e5)](_0x3e5b59['paymentGateways']):null,'gatewaySettings':_0x3e5b59[_0x587e6e(0x149)]?JSON['parse'](_0x3e5b59[_0x587e6e(0x149)]):null,'publicKey':_0x3e5b59[_0x587e6e(0x1b0)],'wallets':{'usdtPolygonWallet':_0x3e5b59[_0x587e6e(0x1c4)],'usdtTrcWallet':_0x3e5b59['usdtTrcWallet'],'usdtErcWallet':_0x3e5b59[_0x587e6e(0x16e)],'usdcPolygonWallet':_0x3e5b59['usdcPolygonWallet']},'status':_0x3e5b59[_0x587e6e(0x135)],'createdAt':_0x3e5b59[_0x587e6e(0x172)]};}async[a35_0x287a11(0x152)](_0x332d7e){const _0x203ac6=a35_0x287a11,_0x500e19=await database_1[_0x203ac6(0x185)][_0x203ac6(0x1df)][_0x203ac6(0x201)]({'where':{'id':_0x332d7e},'data':{'status':_0x203ac6(0x1fc)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x500e19['id'],'fullName':_0x500e19['name'],'username':_0x500e19[_0x203ac6(0x13e)],'telegramId':_0x500e19[_0x203ac6(0x1a3)],'merchantUrl':_0x500e19[_0x203ac6(0x1a5)],'gateways':_0x500e19[_0x203ac6(0x1d6)]?JSON[_0x203ac6(0x1e5)](_0x500e19[_0x203ac6(0x1d6)]):null,'gatewaySettings':_0x500e19[_0x203ac6(0x149)]?JSON[_0x203ac6(0x1e5)](_0x500e19[_0x203ac6(0x149)]):null,'publicKey':_0x500e19['publicKey'],'wallets':{'usdtPolygonWallet':_0x500e19['usdtPolygonWallet'],'usdtTrcWallet':_0x500e19['usdtTrcWallet'],'usdtErcWallet':_0x500e19[_0x203ac6(0x16e)],'usdcPolygonWallet':_0x500e19[_0x203ac6(0x1e8)]},'status':_0x500e19[_0x203ac6(0x135)],'createdAt':_0x500e19[_0x203ac6(0x172)]};}async[a35_0x287a11(0x142)](_0x509282){const _0x317233=a35_0x287a11,_0x295fa4=await database_1[_0x317233(0x185)][_0x317233(0x1df)]['update']({'where':{'id':_0x509282},'data':{'status':_0x317233(0x1a1)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x295fa4['id'],'fullName':_0x295fa4[_0x317233(0x13b)],'username':_0x295fa4[_0x317233(0x13e)],'telegramId':_0x295fa4[_0x317233(0x1a3)],'merchantUrl':_0x295fa4[_0x317233(0x1a5)],'gateways':_0x295fa4[_0x317233(0x1d6)]?JSON[_0x317233(0x1e5)](_0x295fa4[_0x317233(0x1d6)]):null,'gatewaySettings':_0x295fa4[_0x317233(0x149)]?JSON['parse'](_0x295fa4[_0x317233(0x149)]):null,'publicKey':_0x295fa4[_0x317233(0x1b0)],'wallets':{'usdtPolygonWallet':_0x295fa4[_0x317233(0x1c4)],'usdtTrcWallet':_0x295fa4[_0x317233(0x189)],'usdtErcWallet':_0x295fa4[_0x317233(0x16e)],'usdcPolygonWallet':_0x295fa4[_0x317233(0x1e8)]},'status':_0x295fa4['status'],'createdAt':_0x295fa4[_0x317233(0x172)]};}async[a35_0x287a11(0x15a)](_0x56d3d1){const _0x2a8276=a35_0x287a11,{page:_0x4e61b0,limit:_0x8b7558,status:_0x2ff88f}=_0x56d3d1,_0x2f48f5=(_0x4e61b0-0x1)*_0x8b7558,_0x244df2={};_0x2ff88f&&(_0x244df2['status']=_0x2ff88f[_0x2a8276(0x138)]());const [_0xa4be9d,_0x53e6ac]=await Promise[_0x2a8276(0x1fd)]([database_1[_0x2a8276(0x185)]['shop'][_0x2a8276(0x20e)]({'where':_0x244df2,'skip':_0x2f48f5,'take':_0x8b7558,'orderBy':{'createdAt':_0x2a8276(0x143)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x2a8276(0x185)][_0x2a8276(0x1df)][_0x2a8276(0x1d4)]({'where':_0x244df2})]);return{'users':_0xa4be9d[_0x2a8276(0x1e2)](_0x2a353e=>({'id':_0x2a353e['id'],'fullName':_0x2a353e[_0x2a8276(0x13b)],'username':_0x2a353e[_0x2a8276(0x13e)],'telegramId':_0x2a353e[_0x2a8276(0x1a3)],'merchantUrl':_0x2a353e[_0x2a8276(0x1a5)],'gateways':_0x2a353e['paymentGateways']?JSON[_0x2a8276(0x1e5)](_0x2a353e[_0x2a8276(0x1d6)]):null,'gatewaySettings':_0x2a353e[_0x2a8276(0x149)]?JSON[_0x2a8276(0x1e5)](_0x2a353e[_0x2a8276(0x149)]):null,'publicKey':_0x2a353e[_0x2a8276(0x1b0)],'wallets':{'usdtPolygonWallet':_0x2a353e['usdtPolygonWallet'],'usdtTrcWallet':_0x2a353e['usdtTrcWallet'],'usdtErcWallet':_0x2a353e['usdtErcWallet'],'usdcPolygonWallet':_0x2a353e[_0x2a8276(0x1e8)]},'status':_0x2a353e['status'],'createdAt':_0x2a353e[_0x2a8276(0x172)]})),'pagination':{'page':_0x4e61b0,'limit':_0x8b7558,'total':_0x53e6ac,'totalPages':Math[_0x2a8276(0x1e0)](_0x53e6ac/_0x8b7558)}};}async[a35_0x287a11(0x141)](_0x8523f8){const _0x22f9e3=a35_0x287a11,_0x46bb25=await database_1[_0x22f9e3(0x185)][_0x22f9e3(0x1df)][_0x22f9e3(0x19b)]({'where':{'id':_0x8523f8},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x46bb25)return null;return{'id':_0x46bb25['id'],'fullName':_0x46bb25[_0x22f9e3(0x13b)],'username':_0x46bb25[_0x22f9e3(0x13e)],'telegramId':_0x46bb25[_0x22f9e3(0x1a3)],'merchantUrl':_0x46bb25[_0x22f9e3(0x1a5)],'gateways':_0x46bb25['paymentGateways']?JSON['parse'](_0x46bb25[_0x22f9e3(0x1d6)]):null,'gatewaySettings':_0x46bb25['gatewaySettings']?JSON['parse'](_0x46bb25['gatewaySettings']):null,'publicKey':_0x46bb25[_0x22f9e3(0x1b0)],'wallets':{'usdtPolygonWallet':_0x46bb25['usdtPolygonWallet'],'usdtTrcWallet':_0x46bb25[_0x22f9e3(0x189)],'usdtErcWallet':_0x46bb25[_0x22f9e3(0x16e)],'usdcPolygonWallet':_0x46bb25[_0x22f9e3(0x1e8)]},'status':_0x46bb25[_0x22f9e3(0x135)],'createdAt':_0x46bb25[_0x22f9e3(0x172)]};}async[a35_0x287a11(0x180)](_0x2dc565){const _0x17e808=a35_0x287a11,{fullName:_0x43d3b8,username:_0x198e83,password:_0xeda75f,telegramId:_0x226883,merchantUrl:_0x2a75ea,gateways:_0x3b643a,gatewaySettings:_0x3e07f8,wallets:_0x2c4387}=_0x2dc565,_0x18c575=await database_1[_0x17e808(0x185)]['shop'][_0x17e808(0x19b)]({'where':{'username':_0x198e83}});if(_0x18c575)throw new Error(_0x17e808(0x184));if(_0x226883){const _0x1bcc1a=await database_1[_0x17e808(0x185)][_0x17e808(0x1df)][_0x17e808(0x19b)]({'where':{'telegram':_0x226883}});if(_0x1bcc1a)throw new Error(_0x17e808(0x14f));}const _0x49c7b0=await bcryptjs_1[_0x17e808(0x185)][_0x17e808(0x1c0)](_0xeda75f,0xc),_0x2f4404='pk_'+crypto_1[_0x17e808(0x185)][_0x17e808(0x18a)](0x20)[_0x17e808(0x1b5)](_0x17e808(0x1ab)),_0x1d8fe2=_0x17e808(0x200)+crypto_1[_0x17e808(0x185)][_0x17e808(0x18a)](0x20)[_0x17e808(0x1b5)](_0x17e808(0x1ab)),_0x37b0cf=await database_1[_0x17e808(0x185)][_0x17e808(0x1df)][_0x17e808(0x1cd)]({'data':{'name':_0x43d3b8,'username':_0x198e83,'password':_0x49c7b0,'telegram':_0x226883,'shopUrl':_0x2a75ea,'paymentGateways':_0x3b643a?JSON[_0x17e808(0x1a8)](_0x3b643a):null,'gatewaySettings':_0x3e07f8?JSON['stringify'](_0x3e07f8):null,'usdtPolygonWallet':_0x2c4387?.[_0x17e808(0x1c4)]||null,'usdtTrcWallet':_0x2c4387?.[_0x17e808(0x189)]||null,'usdtErcWallet':_0x2c4387?.[_0x17e808(0x16e)]||null,'usdcPolygonWallet':_0x2c4387?.[_0x17e808(0x1e8)]||null,'publicKey':_0x2f4404,'secretKey':_0x1d8fe2,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x37b0cf['id'],'fullName':_0x37b0cf[_0x17e808(0x13b)],'username':_0x37b0cf[_0x17e808(0x13e)],'telegramId':_0x37b0cf[_0x17e808(0x1a3)],'merchantUrl':_0x37b0cf[_0x17e808(0x1a5)],'gateways':_0x37b0cf['paymentGateways']?JSON[_0x17e808(0x1e5)](_0x37b0cf[_0x17e808(0x1d6)]):null,'gatewaySettings':_0x37b0cf['gatewaySettings']?JSON[_0x17e808(0x1e5)](_0x37b0cf[_0x17e808(0x149)]):null,'publicKey':_0x37b0cf[_0x17e808(0x1b0)],'wallets':{'usdtPolygonWallet':_0x37b0cf[_0x17e808(0x1c4)],'usdtTrcWallet':_0x37b0cf['usdtTrcWallet'],'usdtErcWallet':_0x37b0cf[_0x17e808(0x16e)],'usdcPolygonWallet':_0x37b0cf[_0x17e808(0x1e8)]},'status':_0x37b0cf['status'],'createdAt':_0x37b0cf[_0x17e808(0x172)]};}async[a35_0x287a11(0x17a)](_0x4e938d){const _0x49c1e7=a35_0x287a11;await database_1[_0x49c1e7(0x185)][_0x49c1e7(0x1df)][_0x49c1e7(0x155)]({'where':{'id':_0x4e938d}});}}exports[a35_0x287a11(0x14c)]=AdminService;