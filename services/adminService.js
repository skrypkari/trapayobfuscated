'use strict';const a35_0x582483=a35_0x1389;(function(_0x1dc5cd,_0x4dc1e8){const _0x39fd98=a35_0x1389,_0x31919b=_0x1dc5cd();while(!![]){try{const _0x3afceb=-parseInt(_0x39fd98(0x211))/0x1+-parseInt(_0x39fd98(0x1df))/0x2*(-parseInt(_0x39fd98(0x1d1))/0x3)+-parseInt(_0x39fd98(0x1ea))/0x4+-parseInt(_0x39fd98(0x28b))/0x5*(-parseInt(_0x39fd98(0x1e7))/0x6)+-parseInt(_0x39fd98(0x230))/0x7*(parseInt(_0x39fd98(0x2b2))/0x8)+parseInt(_0x39fd98(0x268))/0x9+-parseInt(_0x39fd98(0x1ef))/0xa*(-parseInt(_0x39fd98(0x27b))/0xb);if(_0x3afceb===_0x4dc1e8)break;else _0x31919b['push'](_0x31919b['shift']());}catch(_0x5aea49){_0x31919b['push'](_0x31919b['shift']());}}}(a35_0x1de8,0x62298));function a35_0x1389(_0xd94de1,_0xf60168){const _0x1de847=a35_0x1de8();return a35_0x1389=function(_0x138936,_0x1241f2){_0x138936=_0x138936-0x1cf;let _0xb79064=_0x1de847[_0x138936];return _0xb79064;},a35_0x1389(_0xd94de1,_0xf60168);}function a35_0x1de8(){const _0x5ee23c=['\x20\x20\x20Current\x20balance:\x20','30d','customerEmail','findUnique','\x20merchants,\x20','updateCustomerData','map','customerIp','📊\x20Merchant\x20statistics\x20calculated:','336299hVxSqi','count','📊\x20Merchants\x20awaiting\x20payout:\x20','customerCountry','gatewayOrderId','INACTIVE','deletePayout','periodFrom','chargebackAmount','ACTIVE','amount','password','\x20USDT,\x20Requested:\x20','error','customerUa','forEach','\x20\x20\x20📅\x20This\x20month:\x20','toUpperCase','includes','currency','turnoverUSDT','updateUser','Rapyd','\x20\x20\x20🌍\x20Country:\x20','Payment\x20not\x20found','totalCommissionRate','\x20\x20\x20Payout\x20amount:\x20','usdtErcWallet','sort','split','username','67158LKXPZn','externalPaymentUrl','length','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','set','orderId','\x20USDT\x20(total\x20merchant\x20balances)','shopId','totalPayout','usdtPolygonWallet','payout','payment','periodTo','getAllUsers','suspendUser','status','fullName','notes','\x20USDT\x20(+','\x20USDT\x20(-','default','admin','\x20balance\x20updated:\x20','90d','randomBytes','localeCompare','../config/database','usdtTrcWallet','getFullYear','stringify','all','getMerchantsAwaitingPayout','💰\x20Found\x20','hash','Plisio','toFixed','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','AdminService','Noda','insensitive','amountUSDT','values','update','Error\x20processing\x20payment\x20','totalTurnover','gateway','ceil','wallets','\x20paid\x20payments\x20for\x20analysis','📊\x20Calculating\x20payout\x20statistics...','name','getMerchantsSelection','💰\x20Payment\x20','KLYME\x20EU','getAllPayments','push','550170rvLTeB','log','SUSPENDED','toString','createUser','getGatewayDisplayName','getPayoutById','findMany','PAID','📊\x20Payout\x20statistics\x20calculated:','🔄\x20Admin\x20updating\x20payment\x20','\x20USDT\x20total','merchantEarningsUSDT','🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','./currencyService','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','\x20to\x20','test_gateway','telegram','5181APzmAb','findFirst','gte','delete','revenue','custom','getPaymentById','__importDefault','string','getMerchantStatistics','gateways','KLYME\x20GB','shop','📅\x20Period:\x20','paidOutUSDT','paymentsCount','497395bSMEQZ','lte','month','activateUser','currencyService','COMPLETED','updatePaymentStatus','merchantUrl','sk_','whiteUrl','convertToUSDT','get','publicKey','defineProperty','averageCheckUSDT','totalPaidOut','aggregate','desc','\x20USDT\x20from\x20balance','getMonth','getTime','date','shopUrl','Shop\x20not\x20found','2020-01-01','network','averageCommissionRate','$transaction','balance','adminNotes','dailyRevenue','reduce','\x20->\x20','generateDailyStatistics','💰\x20Shop\x20','\x20USDT','\x20\x20\x20📊\x20Total\x20payments:\x20','toISOString','\x20for\x20shop\x20','24TtOLUB','gatewayEarnings','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','create','not\x20set','✅\x20Payout\x20created:\x20','138CZgcVV','dailyPayments','failureMessage','Test\x20Gateway','\x20\x20\x20🌐\x20IP:\x20','CHARGEBACK','\x20USDT\x20(same\x20as\x20awaiting)','\x20USDT\x20(total\x20paid\x20to\x20merchants)','hex','KLYME\x20DE','__esModule','\x20\x20\x20Total\x20paid\x20out:\x20','Username\x20already\x20exists','bcryptjs','34634CwMXPT','successUrl','Insufficient\x20balance.\x20Available:\x20','dateFrom','paidAt','asc','_sum','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','18NoJTNk','getDate','\x20\x20\x20💰\x20Total\x20turnover:\x20','2682616kIJclq','parse','updatedAt','gatewaySettings','telegramId','5980qTeIGL','paymentGateways','Telegram\x20username\x20already\x20exists','commissionUSDT','getSystemStatistics','txid','deleteUser','turnover','round','dateTo','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','period','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','getAllPayouts','\x20became\x20PAID:\x20+','pendingUrl','_count','commission','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','customerName','setDate','usdcPolygonWallet','thisMonth','getPayoutStats','createdAt'];a35_0x1de8=function(){return _0x5ee23c;};return a35_0x1de8();}var __importDefault=this&&this[a35_0x582483(0x282)]||function(_0x2411ff){const _0x342cb4=a35_0x582483;return _0x2411ff&&_0x2411ff[_0x342cb4(0x1db)]?_0x2411ff:{'default':_0x2411ff};};Object[a35_0x582483(0x298)](exports,'__esModule',{'value':!![]}),exports['AdminService']=void 0x0;const database_1=__importDefault(require(a35_0x582483(0x24a))),bcryptjs_1=__importDefault(require(a35_0x582483(0x1de))),crypto_1=__importDefault(require('crypto')),currencyService_1=require(a35_0x582483(0x276));class AdminService{async[a35_0x582483(0x206)](){const _0x4a8d2f=a35_0x582483;console[_0x4a8d2f(0x269)](_0x4a8d2f(0x261));const _0x406328=await database_1['default'][_0x4a8d2f(0x287)][_0x4a8d2f(0x29b)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x4a8d2f(0x21a)}}),_0x20263c=new Date(),_0x4aec0e=new Date(_0x20263c[_0x4a8d2f(0x24c)](),_0x20263c[_0x4a8d2f(0x29e)](),0x1),_0xfa04c9=new Date(_0x20263c[_0x4a8d2f(0x24c)](),_0x20263c[_0x4a8d2f(0x29e)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x594b29=await database_1[_0x4a8d2f(0x244)][_0x4a8d2f(0x23a)][_0x4a8d2f(0x29b)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x4aec0e,'lte':_0xfa04c9},'status':_0x4a8d2f(0x290)}}),_0x1d7bb6=_0x406328['_sum'][_0x4a8d2f(0x29a)]||0x0,_0x2ec763=_0x406328['_sum'][_0x4a8d2f(0x2a7)]||0x0,_0x1e969d=_0x594b29['_sum'][_0x4a8d2f(0x21b)]||0x0,_0x455899={'totalPayout':Math[_0x4a8d2f(0x1f7)](_0x1d7bb6*0x64)/0x64,'awaitingPayout':Math[_0x4a8d2f(0x1f7)](_0x2ec763*0x64)/0x64,'thisMonth':Math['round'](_0x1e969d*0x64)/0x64,'availableBalance':Math['round'](_0x2ec763*0x64)/0x64};return console[_0x4a8d2f(0x269)](_0x4a8d2f(0x271)),console[_0x4a8d2f(0x269)]('\x20\x20\x20💰\x20Total\x20payout:\x20'+_0x455899[_0x4a8d2f(0x238)]+_0x4a8d2f(0x1d8)),console['log'](_0x4a8d2f(0x1fb)+_0x455899['awaitingPayout']+_0x4a8d2f(0x236)),console[_0x4a8d2f(0x269)]('\x20\x20\x20💵\x20Available\x20balance:\x20'+_0x455899['availableBalance']+_0x4a8d2f(0x1d7)),console[_0x4a8d2f(0x269)](_0x4a8d2f(0x221)+_0x455899[_0x4a8d2f(0x205)]+_0x4a8d2f(0x2ae)),_0x455899;}async[a35_0x582483(0x20d)](_0x9d8ee3,_0x5dd738){const _0x18eafa=a35_0x582483;console[_0x18eafa(0x269)](_0x18eafa(0x277)+_0x9d8ee3+':',_0x5dd738);const _0x5c5a2f=await database_1[_0x18eafa(0x244)]['payment'][_0x18eafa(0x20b)]({'where':{'id':_0x9d8ee3},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x5c5a2f)throw new Error(_0x18eafa(0x229));const _0x194c64={};_0x5dd738[_0x18eafa(0x214)]!==undefined&&(_0x194c64[_0x18eafa(0x214)]=_0x5dd738['customerCountry']||null);_0x5dd738[_0x18eafa(0x20f)]!==undefined&&(_0x194c64[_0x18eafa(0x20f)]=_0x5dd738[_0x18eafa(0x20f)]||null);_0x5dd738[_0x18eafa(0x21f)]!==undefined&&(_0x194c64[_0x18eafa(0x21f)]=_0x5dd738[_0x18eafa(0x21f)]||null);const _0x2403c9=await database_1['default'][_0x18eafa(0x23b)][_0x18eafa(0x25a)]({'where':{'id':_0x9d8ee3},'data':{..._0x194c64,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x18eafa(0x269)](_0x18eafa(0x1e6)+_0x9d8ee3),console['log'](_0x18eafa(0x228)+_0x5c5a2f['customerCountry']+_0x18eafa(0x2ab)+_0x2403c9['customerCountry']),console[_0x18eafa(0x269)](_0x18eafa(0x1d5)+_0x5c5a2f['customerIp']+'\x20->\x20'+_0x2403c9[_0x18eafa(0x20f)]),console[_0x18eafa(0x269)]('\x20\x20\x20🖥️\x20User\x20Agent:\x20'+(_0x5c5a2f['customerUa']?_0x18eafa(0x234):'not\x20set')+_0x18eafa(0x2ab)+(_0x2403c9[_0x18eafa(0x21f)]?'set':_0x18eafa(0x1cf))),_0x2403c9;}async[a35_0x582483(0x1f3)](_0x5b5679){const _0x490557=a35_0x582483,_0x1964c0=new Date();let _0x2f80e7;switch(_0x5b5679){case'7d':_0x2f80e7=new Date(_0x1964c0[_0x490557(0x29f)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x490557(0x209):_0x2f80e7=new Date(_0x1964c0['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x490557(0x247):_0x2f80e7=new Date(_0x1964c0[_0x490557(0x29f)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x2f80e7=new Date(_0x1964c0['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x32a866,_0x1b1cbd,_0x5c67ca,_0x560da3,_0x3b0b70,_0x44bbda,_0x200ded]=await Promise[_0x490557(0x24e)]([database_1[_0x490557(0x244)][_0x490557(0x287)]['count'](),database_1['default'][_0x490557(0x287)][_0x490557(0x212)]({'where':{'status':_0x490557(0x21a)}}),database_1[_0x490557(0x244)][_0x490557(0x23b)][_0x490557(0x212)]({'where':{'createdAt':{'gte':_0x2f80e7},'gateway':{'not':_0x490557(0x279)}}}),database_1[_0x490557(0x244)][_0x490557(0x23b)][_0x490557(0x212)]({'where':{'status':'PAID','createdAt':{'gte':_0x2f80e7},'gateway':{'not':'test_gateway'}}}),database_1[_0x490557(0x244)][_0x490557(0x23b)][_0x490557(0x26f)]({'where':{'status':_0x490557(0x270),'createdAt':{'gte':_0x2f80e7},'gateway':{'not':_0x490557(0x279)}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1['default'][_0x490557(0x23b)][_0x490557(0x26f)]({'where':{'gateway':{'not':'test_gateway'}},'take':0xa,'orderBy':{'createdAt':_0x490557(0x29c)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x490557(0x244)]['payment'][_0x490557(0x26f)]({'where':{'createdAt':{'gte':_0x2f80e7},'gateway':{'not':_0x490557(0x279)}},'select':{'status':!![],'amountUSDT':!![],'amount':!![],'currency':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x490557(0x1e4)}})]);let _0x13a802=0x0;for(const _0x289564 of _0x3b0b70){if(_0x289564[_0x490557(0x258)])_0x13a802+=_0x289564['amountUSDT'];else{const _0x563f65=await currencyService_1[_0x490557(0x28f)][_0x490557(0x295)](_0x289564['amount'],_0x289564[_0x490557(0x224)]);_0x13a802+=_0x563f65;}}const _0x181989=this['generateDailyStatistics'](_0x200ded,_0x2f80e7,_0x1964c0),_0x531f6e=_0x5c67ca>0x0?_0x560da3/_0x5c67ca*0x64:0x0;return{'totalShops':_0x32a866,'activeShops':_0x1b1cbd,'totalPayments':_0x5c67ca,'successfulPayments':_0x560da3,'totalRevenue':Math['round'](_0x13a802*0x64)/0x64,'conversionRate':Math[_0x490557(0x1f7)](_0x531f6e*0x64)/0x64,'dailyRevenue':_0x181989[_0x490557(0x2a9)],'dailyPayments':_0x181989[_0x490557(0x1d2)],'recentPayments':_0x44bbda[_0x490557(0x20e)](_0x38f12d=>({'id':_0x38f12d['id'],'amount':_0x38f12d['amount'],'currency':_0x38f12d[_0x490557(0x224)],'status':_0x38f12d[_0x490557(0x23f)],'gateway':_0x38f12d[_0x490557(0x25d)],'shop':_0x38f12d[_0x490557(0x287)],'createdAt':_0x38f12d['createdAt']}))};}[a35_0x582483(0x2ac)](_0x3ba75d,_0x36674a,_0x1529d1){const _0xea7b14=a35_0x582483,_0x503614=new Map(),_0x51bfed=new Date(_0x36674a);while(_0x51bfed<=_0x1529d1){const _0xd1833d=_0x51bfed['toISOString']()['split']('T')[0x0];_0x503614['set'](_0xd1833d,{'revenue':0x0,'count':0x0}),_0x51bfed[_0xea7b14(0x203)](_0x51bfed[_0xea7b14(0x1e8)]()+0x1);}for(const _0x5a60f2 of _0x3ba75d){const _0x1cdc4b=_0x5a60f2['createdAt'][_0xea7b14(0x2b0)]()[_0xea7b14(0x22e)]('T')[0x0],_0x3e0d3b=_0x503614[_0xea7b14(0x296)](_0x1cdc4b);if(_0x3e0d3b){_0x3e0d3b[_0xea7b14(0x212)]+=0x1;if(_0x5a60f2['status']===_0xea7b14(0x270)){if(_0x5a60f2[_0xea7b14(0x258)])_0x3e0d3b[_0xea7b14(0x27f)]+=_0x5a60f2[_0xea7b14(0x258)];else{}}}}const _0x103afb=[],_0x4ef6b3=[];for(const [_0x458859,_0x57138f]of _0x503614){_0x103afb[_0xea7b14(0x267)]({'date':_0x458859,'amount':Math[_0xea7b14(0x1f7)](_0x57138f[_0xea7b14(0x27f)]*0x64)/0x64}),_0x4ef6b3[_0xea7b14(0x267)]({'date':_0x458859,'count':_0x57138f['count']});}return{'dailyRevenue':_0x103afb,'dailyPayments':_0x4ef6b3};}async[a35_0x582483(0x284)](_0x1ddde3){const _0x1da092=a35_0x582483;console[_0x1da092(0x269)](_0x1da092(0x2b4),_0x1ddde3);let _0x46c4f6,_0x298088=new Date();if(_0x1ddde3[_0x1da092(0x1fa)]==='custom'&&_0x1ddde3[_0x1da092(0x1e2)]&&_0x1ddde3[_0x1da092(0x1f8)])_0x46c4f6=new Date(_0x1ddde3[_0x1da092(0x1e2)]),_0x298088=new Date(_0x1ddde3[_0x1da092(0x1f8)]);else{const _0x36829b=new Date();switch(_0x1ddde3[_0x1da092(0x1fa)]){case'week':_0x46c4f6=new Date(_0x36829b[_0x1da092(0x29f)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x1da092(0x28d):_0x46c4f6=new Date(_0x36829b[_0x1da092(0x29f)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'year':_0x46c4f6=new Date(_0x36829b['getTime']()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x1da092(0x24e):default:_0x46c4f6=new Date(_0x1da092(0x2a3));break;}}console['log'](_0x1da092(0x288)+_0x46c4f6[_0x1da092(0x2b0)]()+_0x1da092(0x278)+_0x298088[_0x1da092(0x2b0)]());const _0x1f34bb={'status':_0x1da092(0x270),'gateway':{'not':_0x1da092(0x279)},'paidAt':{'gte':_0x46c4f6,'lte':_0x298088}};_0x1ddde3[_0x1da092(0x237)]&&(_0x1f34bb[_0x1da092(0x237)]=_0x1ddde3[_0x1da092(0x237)]);const _0x2fa781=await database_1['default']['payment']['findMany']({'where':_0x1f34bb,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x1da092(0x269)](_0x1da092(0x250)+_0x2fa781[_0x1da092(0x232)]+_0x1da092(0x260));let _0x3e6b44=0x0,_0x1cb0c2=0x0,_0x1424a6=0x0;const _0x4c8d70={},_0x1bc325={},_0xf23e49={};for(const _0x4bdd56 of _0x2fa781){try{const _0x170013=await currencyService_1[_0x1da092(0x28f)]['convertToUSDT'](_0x4bdd56[_0x1da092(0x21b)],_0x4bdd56['currency']);let _0x3a0fdf={};if(_0x4bdd56[_0x1da092(0x287)]['gatewaySettings'])try{_0x3a0fdf=JSON['parse'](_0x4bdd56[_0x1da092(0x287)][_0x1da092(0x1ed)]);}catch(_0xfd371c){console[_0x1da092(0x21e)]('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x4bdd56[_0x1da092(0x237)]+':',_0xfd371c);}const _0x5b6559=_0x3a0fdf[_0x1da092(0x200)]||0xa,_0x252558=_0x170013*(_0x5b6559/0x64),_0x5186c2=_0x170013-_0x252558;_0x3e6b44+=_0x170013,_0x1cb0c2+=_0x5186c2,_0x1424a6+=_0x252558;!_0x4c8d70[_0x4bdd56[_0x1da092(0x25d)]]&&(_0x4c8d70[_0x4bdd56[_0x1da092(0x25d)]]={'gateway':_0x4bdd56[_0x1da092(0x25d)],'gatewayDisplayName':this[_0x1da092(0x26d)](_0x4bdd56['gateway']),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x4c8d70[_0x4bdd56['gateway']]['paymentsCount']++,_0x4c8d70[_0x4bdd56[_0x1da092(0x25d)]][_0x1da092(0x225)]+=_0x170013,_0x4c8d70[_0x4bdd56[_0x1da092(0x25d)]][_0x1da092(0x1f2)]+=_0x252558,_0x4c8d70[_0x4bdd56['gateway']][_0x1da092(0x274)]+=_0x5186c2,_0x4c8d70[_0x4bdd56[_0x1da092(0x25d)]][_0x1da092(0x22a)]+=_0x5b6559;!_0x1ddde3[_0x1da092(0x237)]&&(!_0x1bc325[_0x4bdd56[_0x1da092(0x237)]]&&(_0x1bc325[_0x4bdd56[_0x1da092(0x237)]]={'shopId':_0x4bdd56[_0x1da092(0x237)],'shopName':_0x4bdd56[_0x1da092(0x287)][_0x1da092(0x262)],'shopUsername':_0x4bdd56[_0x1da092(0x287)][_0x1da092(0x22f)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x1bc325[_0x4bdd56[_0x1da092(0x237)]][_0x1da092(0x28a)]++,_0x1bc325[_0x4bdd56[_0x1da092(0x237)]][_0x1da092(0x225)]+=_0x170013,_0x1bc325[_0x4bdd56[_0x1da092(0x237)]][_0x1da092(0x1f2)]+=_0x252558,_0x1bc325[_0x4bdd56['shopId']][_0x1da092(0x274)]+=_0x5186c2);const _0x462ca0=_0x4bdd56[_0x1da092(0x1e3)][_0x1da092(0x2b0)]()[_0x1da092(0x22e)]('T')[0x0];!_0xf23e49[_0x462ca0]&&(_0xf23e49[_0x462ca0]={'date':_0x462ca0,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0xf23e49[_0x462ca0][_0x1da092(0x1f6)]+=_0x170013,_0xf23e49[_0x462ca0]['merchantEarnings']+=_0x5186c2,_0xf23e49[_0x462ca0][_0x1da092(0x2b3)]+=_0x252558,_0xf23e49[_0x462ca0][_0x1da092(0x28a)]++;}catch(_0x5b650a){console[_0x1da092(0x21e)](_0x1da092(0x25b)+_0x4bdd56['id']+':',_0x5b650a);}}Object[_0x1da092(0x259)](_0x4c8d70)[_0x1da092(0x220)](_0x3b29ee=>{const _0xe444aa=_0x1da092;_0x3b29ee[_0xe444aa(0x2a5)]=_0x3b29ee[_0xe444aa(0x28a)]>0x0?_0x3b29ee['totalCommissionRate']/_0x3b29ee[_0xe444aa(0x28a)]:0x0,delete _0x3b29ee['totalCommissionRate'];}),Object[_0x1da092(0x259)](_0x1bc325)['forEach'](_0x4b91f2=>{const _0x42be70=_0x1da092;_0x4b91f2[_0x42be70(0x299)]=_0x4b91f2[_0x42be70(0x28a)]>0x0?_0x4b91f2[_0x42be70(0x225)]/_0x4b91f2[_0x42be70(0x28a)]:0x0;});let _0x5a838f=0x0;if(_0x1ddde3[_0x1da092(0x237)]){const _0x560d77=await database_1[_0x1da092(0x244)][_0x1da092(0x23a)]['findMany']({'where':{'shopId':_0x1ddde3[_0x1da092(0x237)],'status':_0x1da092(0x290),'createdAt':{'gte':_0x46c4f6,'lte':_0x298088}},'select':{'amount':!![]}});_0x5a838f=_0x560d77['reduce']((_0x4266ac,_0x37cf9e)=>_0x4266ac+_0x37cf9e[_0x1da092(0x21b)],0x0);}const _0x8aafe=_0x2fa781[_0x1da092(0x232)],_0x42c1fe=_0x2fa781[_0x1da092(0x232)],_0x45bc53=_0x8aafe>0x0?_0x3e6b44/_0x8aafe:0x0,_0x9c4867=0x64,_0x1ff236=Math[_0x1da092(0x25e)]((_0x298088['getTime']()-_0x46c4f6[_0x1da092(0x29f)]())/(0x3e8*0x3c*0x3c*0x18)),_0x9448eb={'totalTurnover':Math[_0x1da092(0x1f7)](_0x3e6b44*0x64)/0x64,'merchantEarnings':Math[_0x1da092(0x1f7)](_0x1cb0c2*0x64)/0x64,'gatewayEarnings':Math[_0x1da092(0x1f7)](_0x1424a6*0x64)/0x64,'totalPaidOut':Math[_0x1da092(0x1f7)](_0x5a838f*0x64)/0x64,'averageCheck':Math[_0x1da092(0x1f7)](_0x45bc53*0x64)/0x64,'totalPayments':_0x8aafe,'successfulPayments':_0x42c1fe,'conversionRate':_0x9c4867,'gatewayBreakdown':Object[_0x1da092(0x259)](_0x4c8d70)['map'](_0x17160e=>({..._0x17160e,'turnoverUSDT':Math['round'](_0x17160e[_0x1da092(0x225)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x17160e[_0x1da092(0x1f2)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x1da092(0x1f7)](_0x17160e['merchantEarningsUSDT']*0x64)/0x64,'averageCommissionRate':Math[_0x1da092(0x1f7)](_0x17160e[_0x1da092(0x2a5)]*0x64)/0x64})),'merchantBreakdown':_0x1ddde3['shopId']?undefined:Object[_0x1da092(0x259)](_0x1bc325)[_0x1da092(0x20e)](_0x45d9b9=>({..._0x45d9b9,'turnoverUSDT':Math[_0x1da092(0x1f7)](_0x45d9b9[_0x1da092(0x225)]*0x64)/0x64,'commissionUSDT':Math[_0x1da092(0x1f7)](_0x45d9b9[_0x1da092(0x1f2)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x1da092(0x1f7)](_0x45d9b9[_0x1da092(0x274)]*0x64)/0x64,'paidOutUSDT':Math['round'](_0x45d9b9[_0x1da092(0x289)]*0x64)/0x64,'averageCheckUSDT':Math[_0x1da092(0x1f7)](_0x45d9b9[_0x1da092(0x299)]*0x64)/0x64})),'dailyData':Object[_0x1da092(0x259)](_0xf23e49)[_0x1da092(0x20e)](_0xfb6646=>({..._0xfb6646,'turnover':Math['round'](_0xfb6646[_0x1da092(0x1f6)]*0x64)/0x64,'merchantEarnings':Math[_0x1da092(0x1f7)](_0xfb6646['merchantEarnings']*0x64)/0x64,'gatewayEarnings':Math[_0x1da092(0x1f7)](_0xfb6646[_0x1da092(0x2b3)]*0x64)/0x64}))[_0x1da092(0x22d)]((_0x36659c,_0x392c12)=>_0x36659c[_0x1da092(0x2a0)][_0x1da092(0x249)](_0x392c12['date'])),'periodInfo':{'from':_0x46c4f6,'to':_0x298088,'periodType':_0x1ddde3[_0x1da092(0x1fa)]||_0x1da092(0x280),'daysCount':_0x1ff236}};return console[_0x1da092(0x269)](_0x1da092(0x210)),console[_0x1da092(0x269)](_0x1da092(0x1e9)+_0x9448eb[_0x1da092(0x25c)]+_0x1da092(0x2ae)),console[_0x1da092(0x269)](_0x1da092(0x233)+_0x9448eb['merchantEarnings']+'\x20USDT'),console['log'](_0x1da092(0x254)+_0x9448eb[_0x1da092(0x2b3)]+_0x1da092(0x2ae)),console['log'](_0x1da092(0x2af)+_0x9448eb['totalPayments']),_0x9448eb;}[a35_0x582483(0x26d)](_0x3a0a0a){const _0x1cbb00=a35_0x582483,_0x12eb52={'test_gateway':_0x1cbb00(0x1d4),'plisio':_0x1cbb00(0x252),'rapyd':_0x1cbb00(0x227),'noda':_0x1cbb00(0x256),'cointopay':'CoinToPay','klyme_eu':_0x1cbb00(0x265),'klyme_gb':_0x1cbb00(0x286),'klyme_de':_0x1cbb00(0x1da)};return _0x12eb52[_0x3a0a0a]||_0x3a0a0a;}async[a35_0x582483(0x24f)](_0x3ce745){const _0x56f60b=a35_0x582483,{page:_0x3851df,limit:_0x235c03,minAmount:_0x5a2f23,search:_0x358dc7}=_0x3ce745,_0x446572=(_0x3851df-0x1)*_0x235c03;console['log'](_0x56f60b(0x1f9),_0x3ce745);const _0x159bf0={'balance':{'gt':0x0},'status':_0x56f60b(0x21a)};_0x5a2f23&&(_0x159bf0[_0x56f60b(0x2a7)][_0x56f60b(0x27d)]=_0x5a2f23);_0x358dc7&&(_0x159bf0['OR']=[{'name':{'contains':_0x358dc7,'mode':'insensitive'}},{'username':{'contains':_0x358dc7,'mode':_0x56f60b(0x257)}}]);const [_0x3f312e,_0x6e63ab]=await Promise['all']([database_1[_0x56f60b(0x244)]['shop'][_0x56f60b(0x26f)]({'where':_0x159bf0,'skip':_0x446572,'take':_0x235c03,'orderBy':{'balance':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'createdAt':!![]}}),database_1['default'][_0x56f60b(0x287)][_0x56f60b(0x212)]({'where':_0x159bf0})]);console[_0x56f60b(0x269)](_0x56f60b(0x250)+_0x3f312e['length']+'\x20merchants\x20with\x20positive\x20balance');const _0x365154=await Promise['all'](_0x3f312e[_0x56f60b(0x20e)](async _0x1b53dd=>{const _0x39f1e7=_0x56f60b,[_0x1212fe,_0x73ed4b,_0x42c315]=await Promise[_0x39f1e7(0x24e)]([database_1['default'][_0x39f1e7(0x23b)][_0x39f1e7(0x212)]({'where':{'shopId':_0x1b53dd['id'],'status':_0x39f1e7(0x270),'amountUSDT':{'not':null}}}),database_1[_0x39f1e7(0x244)][_0x39f1e7(0x23b)][_0x39f1e7(0x27c)]({'where':{'shopId':_0x1b53dd['id'],'status':_0x39f1e7(0x270),'amountUSDT':{'not':null}},'orderBy':{'paidAt':_0x39f1e7(0x1e4)},'select':{'paidAt':!![]}}),database_1[_0x39f1e7(0x244)][_0x39f1e7(0x23b)]['groupBy']({'by':[_0x39f1e7(0x25d)],'where':{'shopId':_0x1b53dd['id'],'status':_0x39f1e7(0x270),'amountUSDT':{'not':null}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x306570=_0x42c315[_0x39f1e7(0x20e)](_0x37ad49=>({'gateway':_0x37ad49['gateway'],'count':_0x37ad49[_0x39f1e7(0x1ff)]['id'],'amountUSDT':_0x37ad49[_0x39f1e7(0x1e5)][_0x39f1e7(0x258)]||0x0,'amountAfterCommissionUSDT':_0x37ad49[_0x39f1e7(0x1e5)]['amountUSDT']||0x0,'commission':0x0}));return{'id':_0x1b53dd['id'],'fullName':_0x1b53dd[_0x39f1e7(0x262)],'username':_0x1b53dd[_0x39f1e7(0x22f)],'telegramId':_0x1b53dd[_0x39f1e7(0x27a)],'merchantUrl':_0x1b53dd[_0x39f1e7(0x2a1)],'wallets':{'usdtPolygonWallet':_0x1b53dd['usdtPolygonWallet'],'usdtTrcWallet':_0x1b53dd[_0x39f1e7(0x24b)],'usdtErcWallet':_0x1b53dd[_0x39f1e7(0x22c)],'usdcPolygonWallet':_0x1b53dd['usdcPolygonWallet']},'totalAmountUSDT':_0x1b53dd[_0x39f1e7(0x2a7)],'totalAmountAfterCommissionUSDT':_0x1b53dd[_0x39f1e7(0x2a7)],'paymentsCount':_0x1212fe,'oldestPaymentDate':_0x73ed4b?.[_0x39f1e7(0x1e3)]||_0x1b53dd['createdAt'],'gatewayBreakdown':_0x306570};})),_0x4a8016=_0x3f312e[_0x56f60b(0x2aa)]((_0x35648e,_0x313db0)=>_0x35648e+_0x313db0[_0x56f60b(0x2a7)],0x0),_0x19e25c=_0x4a8016;return console[_0x56f60b(0x269)](_0x56f60b(0x213)+_0x6e63ab+_0x56f60b(0x20c)+Math[_0x56f60b(0x1f7)](_0x19e25c*0x64)/0x64+_0x56f60b(0x273)),{'merchants':_0x365154,'pagination':{'page':_0x3851df,'limit':_0x235c03,'total':_0x6e63ab,'totalPages':Math['ceil'](_0x6e63ab/_0x235c03)},'summary':{'totalMerchants':_0x6e63ab,'totalAmountUSDT':Math[_0x56f60b(0x1f7)](_0x4a8016*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x56f60b(0x1f7)](_0x19e25c*0x64)/0x64}};}async['createPayout'](_0x20238b){const _0xd47b70=a35_0x582483,{shopId:_0x250ded,amount:_0xb56666,network:_0x16b557,notes:_0x54511a,periodFrom:_0x52a0a8,periodTo:_0x346d4e}=_0x20238b,_0x2d1d76=await database_1[_0xd47b70(0x244)][_0xd47b70(0x2a6)](async _0x59f672=>{const _0x133d5a=_0xd47b70,_0x4bd349=await _0x59f672[_0x133d5a(0x287)][_0x133d5a(0x20b)]({'where':{'id':_0x250ded},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x4bd349)throw new Error(_0x133d5a(0x2a2));console['log']('💰\x20Creating\x20payout\x20for\x20shop\x20'+_0x4bd349['username']+':'),console['log'](_0x133d5a(0x208)+_0x4bd349[_0x133d5a(0x2a7)][_0x133d5a(0x253)](0x6)+'\x20USDT'),console[_0x133d5a(0x269)](_0x133d5a(0x22b)+_0xb56666[_0x133d5a(0x253)](0x6)+_0x133d5a(0x2ae)),console[_0x133d5a(0x269)](_0x133d5a(0x201)+_0x4bd349['totalPaidOut'][_0x133d5a(0x253)](0x6)+_0x133d5a(0x2ae));if(_0x4bd349[_0x133d5a(0x2a7)]<_0xb56666)throw new Error(_0x133d5a(0x1e1)+_0x4bd349[_0x133d5a(0x2a7)][_0x133d5a(0x253)](0x6)+_0x133d5a(0x21d)+_0xb56666[_0x133d5a(0x253)](0x6)+_0x133d5a(0x2ae));const _0x29d919=await _0x59f672['payout'][_0x133d5a(0x2b5)]({'data':{'shopId':_0x250ded,'amount':_0xb56666,'network':_0x16b557,'status':'COMPLETED','notes':_0x54511a,'periodFrom':_0x52a0a8?new Date(_0x52a0a8):null,'periodTo':_0x346d4e?new Date(_0x346d4e):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x2734d6=_0x4bd349['balance']-_0xb56666,_0x5ebdc6=_0x4bd349[_0x133d5a(0x29a)]+_0xb56666;return await _0x59f672[_0x133d5a(0x287)][_0x133d5a(0x25a)]({'where':{'id':_0x250ded},'data':{'balance':_0x2734d6,'totalPaidOut':_0x5ebdc6}}),console[_0x133d5a(0x269)]('💰\x20Shop\x20'+_0x4bd349[_0x133d5a(0x22f)]+'\x20balance\x20updated:'),console[_0x133d5a(0x269)]('\x20\x20\x20Balance:\x20'+_0x4bd349[_0x133d5a(0x2a7)]['toFixed'](0x6)+_0x133d5a(0x2ab)+_0x2734d6[_0x133d5a(0x253)](0x6)+_0x133d5a(0x243)+_0xb56666[_0x133d5a(0x253)](0x6)+')'),console[_0x133d5a(0x269)](_0x133d5a(0x1dc)+_0x4bd349[_0x133d5a(0x29a)]['toFixed'](0x6)+'\x20->\x20'+_0x5ebdc6[_0x133d5a(0x253)](0x6)+_0x133d5a(0x242)+_0xb56666[_0x133d5a(0x253)](0x6)+')'),{'payout':_0x29d919,'shop':_0x4bd349};});return console[_0xd47b70(0x269)](_0xd47b70(0x1d0)+_0x2d1d76[_0xd47b70(0x23a)]['id']+_0xd47b70(0x2b1)+_0x2d1d76[_0xd47b70(0x287)][_0xd47b70(0x22f)]+'\x20('+_0xb56666+'\x20USDT)'),{'id':_0x2d1d76[_0xd47b70(0x23a)]['id'],'shopId':_0x2d1d76[_0xd47b70(0x23a)][_0xd47b70(0x237)],'shopName':_0x2d1d76['shop']['name'],'shopUsername':_0x2d1d76['shop'][_0xd47b70(0x22f)],'amount':_0x2d1d76[_0xd47b70(0x23a)][_0xd47b70(0x21b)],'network':_0x2d1d76[_0xd47b70(0x23a)][_0xd47b70(0x2a4)],'status':_0x2d1d76['payout'][_0xd47b70(0x23f)],'txid':_0x2d1d76[_0xd47b70(0x23a)][_0xd47b70(0x1f4)],'notes':_0x2d1d76[_0xd47b70(0x23a)][_0xd47b70(0x241)],'periodFrom':_0x2d1d76[_0xd47b70(0x23a)][_0xd47b70(0x218)],'periodTo':_0x2d1d76[_0xd47b70(0x23a)][_0xd47b70(0x23c)],'createdAt':_0x2d1d76[_0xd47b70(0x23a)][_0xd47b70(0x207)],'paidAt':_0x2d1d76[_0xd47b70(0x23a)][_0xd47b70(0x1e3)]};}async[a35_0x582483(0x1fc)](_0x32ac2a){const _0x2e7d03=a35_0x582483,{page:_0x258639,limit:_0x7e5b10,shopId:_0xf9f95,network:_0x3c85f1,dateFrom:_0xecb968,dateTo:_0x3b3b29,search:_0x33af7c}=_0x32ac2a,_0x1303fe=(_0x258639-0x1)*_0x7e5b10,_0x34bd9e={};_0xf9f95&&(_0x34bd9e[_0x2e7d03(0x237)]=_0xf9f95);_0x3c85f1&&(_0x34bd9e[_0x2e7d03(0x2a4)]=_0x3c85f1);(_0xecb968||_0x3b3b29)&&(_0x34bd9e[_0x2e7d03(0x207)]={},_0xecb968&&(_0x34bd9e[_0x2e7d03(0x207)][_0x2e7d03(0x27d)]=new Date(_0xecb968)),_0x3b3b29&&(_0x34bd9e[_0x2e7d03(0x207)][_0x2e7d03(0x28c)]=new Date(_0x3b3b29)));_0x33af7c&&(_0x34bd9e['OR']=[{'shop':{'name':{'contains':_0x33af7c,'mode':_0x2e7d03(0x257)}}},{'shop':{'username':{'contains':_0x33af7c,'mode':'insensitive'}}},{'notes':{'contains':_0x33af7c,'mode':'insensitive'}}]);const [_0x2a09e5,_0x2b497b]=await Promise[_0x2e7d03(0x24e)]([database_1[_0x2e7d03(0x244)][_0x2e7d03(0x23a)][_0x2e7d03(0x26f)]({'where':_0x34bd9e,'skip':_0x1303fe,'take':_0x7e5b10,'orderBy':{'createdAt':_0x2e7d03(0x29c)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x2e7d03(0x244)][_0x2e7d03(0x23a)][_0x2e7d03(0x212)]({'where':_0x34bd9e})]);return{'payouts':_0x2a09e5[_0x2e7d03(0x20e)](_0x94ead1=>({'id':_0x94ead1['id'],'shopId':_0x94ead1[_0x2e7d03(0x237)],'shopName':_0x94ead1[_0x2e7d03(0x287)]['name'],'shopUsername':_0x94ead1['shop'][_0x2e7d03(0x22f)],'amount':_0x94ead1[_0x2e7d03(0x21b)],'network':_0x94ead1[_0x2e7d03(0x2a4)],'status':_0x94ead1[_0x2e7d03(0x23f)],'txid':_0x94ead1['txid'],'notes':_0x94ead1[_0x2e7d03(0x241)],'periodFrom':_0x94ead1[_0x2e7d03(0x218)],'periodTo':_0x94ead1[_0x2e7d03(0x23c)],'createdAt':_0x94ead1[_0x2e7d03(0x207)],'paidAt':_0x94ead1[_0x2e7d03(0x1e3)]})),'pagination':{'page':_0x258639,'limit':_0x7e5b10,'total':_0x2b497b,'totalPages':Math['ceil'](_0x2b497b/_0x7e5b10)}};}async[a35_0x582483(0x26e)](_0xe0c001){const _0x4c5132=a35_0x582483,_0x32476b=await database_1[_0x4c5132(0x244)][_0x4c5132(0x23a)][_0x4c5132(0x20b)]({'where':{'id':_0xe0c001},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x32476b)return null;return{'id':_0x32476b['id'],'shopId':_0x32476b[_0x4c5132(0x237)],'shopName':_0x32476b[_0x4c5132(0x287)][_0x4c5132(0x262)],'shopUsername':_0x32476b[_0x4c5132(0x287)]['username'],'amount':_0x32476b[_0x4c5132(0x21b)],'network':_0x32476b[_0x4c5132(0x2a4)],'status':_0x32476b[_0x4c5132(0x23f)],'txid':_0x32476b[_0x4c5132(0x1f4)],'notes':_0x32476b[_0x4c5132(0x241)],'periodFrom':_0x32476b[_0x4c5132(0x218)],'periodTo':_0x32476b[_0x4c5132(0x23c)],'createdAt':_0x32476b[_0x4c5132(0x207)],'paidAt':_0x32476b['paidAt']};}async[a35_0x582483(0x217)](_0x476b7b){const _0x243f0e=a35_0x582483;await database_1['default']['payout'][_0x243f0e(0x27e)]({'where':{'id':_0x476b7b}});}async[a35_0x582483(0x266)](_0x3b3c15){const _0x38194a=a35_0x582483,{page:_0x3abe24,limit:_0xb3f0d9,status:_0x19eee4,gateway:_0x40442a,shopId:_0x4ea09b,dateFrom:_0x5d1b4a,dateTo:_0x5952c7,search:_0x555952}=_0x3b3c15,_0x30dc9f=(_0x3abe24-0x1)*_0xb3f0d9,_0x4a055e={};_0x19eee4&&(_0x4a055e[_0x38194a(0x23f)]=_0x19eee4[_0x38194a(0x222)]());_0x40442a&&(_0x4a055e[_0x38194a(0x25d)]=_0x40442a['toLowerCase']());_0x4a055e[_0x38194a(0x25d)]=_0x4a055e['gateway']?_0x4a055e[_0x38194a(0x25d)]:{'not':_0x38194a(0x279)};if(typeof _0x4a055e[_0x38194a(0x25d)]===_0x38194a(0x283)&&_0x4a055e[_0x38194a(0x25d)]!==_0x38194a(0x279)){}else{if(typeof _0x4a055e['gateway']==='string'&&_0x4a055e[_0x38194a(0x25d)]==='test_gateway'){}else _0x4a055e['gateway']={'not':'test_gateway'};}_0x4ea09b&&(_0x4a055e[_0x38194a(0x237)]=_0x4ea09b);(_0x5d1b4a||_0x5952c7)&&(_0x4a055e['createdAt']={},_0x5d1b4a&&(_0x4a055e[_0x38194a(0x207)][_0x38194a(0x27d)]=new Date(_0x5d1b4a)),_0x5952c7&&(_0x4a055e[_0x38194a(0x207)]['lte']=new Date(_0x5952c7)));_0x555952&&(_0x4a055e['OR']=[{'orderId':{'contains':_0x555952,'mode':_0x38194a(0x257)}},{'gatewayOrderId':{'contains':_0x555952,'mode':_0x38194a(0x257)}},{'customerEmail':{'contains':_0x555952,'mode':_0x38194a(0x257)}},{'shop':{'name':{'contains':_0x555952,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x555952,'mode':_0x38194a(0x257)}}}]);const [_0x189d45,_0x588969]=await Promise[_0x38194a(0x24e)]([database_1['default'][_0x38194a(0x23b)]['findMany']({'where':_0x4a055e,'skip':_0x30dc9f,'take':_0xb3f0d9,'orderBy':{'createdAt':_0x38194a(0x29c)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x38194a(0x244)][_0x38194a(0x23b)][_0x38194a(0x212)]({'where':_0x4a055e})]);return{'payments':_0x189d45[_0x38194a(0x20e)](_0x596175=>({'id':_0x596175['id'],'shopId':_0x596175[_0x38194a(0x237)],'gateway':_0x596175[_0x38194a(0x25d)],'amount':_0x596175[_0x38194a(0x21b)],'currency':_0x596175[_0x38194a(0x224)],'status':_0x596175['status'],'orderId':_0x596175['orderId'],'gatewayOrderId':_0x596175[_0x38194a(0x215)],'customerEmail':_0x596175['customerEmail'],'customerName':_0x596175[_0x38194a(0x202)],'customerCountry':_0x596175[_0x38194a(0x214)],'customerIp':_0x596175[_0x38194a(0x20f)],'customerUa':_0x596175[_0x38194a(0x21f)],'failureMessage':_0x596175[_0x38194a(0x1d3)],'createdAt':_0x596175[_0x38194a(0x207)],'updatedAt':_0x596175[_0x38194a(0x1ec)],'shop':_0x596175[_0x38194a(0x287)]})),'pagination':{'page':_0x3abe24,'limit':_0xb3f0d9,'total':_0x588969,'totalPages':Math[_0x38194a(0x25e)](_0x588969/_0xb3f0d9)}};}async[a35_0x582483(0x281)](_0x1a7bbb){const _0x2b2a50=a35_0x582483,_0x58528c=await database_1[_0x2b2a50(0x244)][_0x2b2a50(0x23b)][_0x2b2a50(0x20b)]({'where':{'id':_0x1a7bbb},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x58528c)return null;return{'id':_0x58528c['id'],'shopId':_0x58528c[_0x2b2a50(0x237)],'gateway':_0x58528c[_0x2b2a50(0x25d)],'amount':_0x58528c[_0x2b2a50(0x21b)],'currency':_0x58528c[_0x2b2a50(0x224)],'status':_0x58528c[_0x2b2a50(0x23f)],'orderId':_0x58528c[_0x2b2a50(0x235)],'gatewayOrderId':_0x58528c[_0x2b2a50(0x215)],'customerEmail':_0x58528c[_0x2b2a50(0x20a)],'customerName':_0x58528c[_0x2b2a50(0x202)],'customerCountry':_0x58528c['customerCountry'],'customerIp':_0x58528c[_0x2b2a50(0x20f)],'customerUa':_0x58528c['customerUa'],'failureMessage':_0x58528c[_0x2b2a50(0x1d3)],'externalPaymentUrl':_0x58528c[_0x2b2a50(0x231)],'successUrl':_0x58528c[_0x2b2a50(0x1e0)],'failUrl':_0x58528c['failUrl'],'pendingUrl':_0x58528c[_0x2b2a50(0x1fe)],'whiteUrl':_0x58528c[_0x2b2a50(0x294)],'createdAt':_0x58528c[_0x2b2a50(0x207)],'updatedAt':_0x58528c[_0x2b2a50(0x1ec)],'shop':_0x58528c[_0x2b2a50(0x287)]};}async[a35_0x582483(0x291)](_0x3aa9dd,_0x3f99a9,_0x4c8493,_0x325a66){const _0x53b69c=a35_0x582483,_0x318159=await database_1[_0x53b69c(0x244)]['$transaction'](async _0x12385f=>{const _0x3c081f=_0x53b69c,_0x2e0d10=await _0x12385f[_0x3c081f(0x23b)][_0x3c081f(0x20b)]({'where':{'id':_0x3aa9dd},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x2e0d10)throw new Error(_0x3c081f(0x229));const _0xc8d01f=_0x2e0d10[_0x3c081f(0x23f)],_0x820bda=_0x3f99a9['toUpperCase']();console[_0x3c081f(0x269)](_0x3c081f(0x272)+_0x3aa9dd+'\x20status:\x20'+_0xc8d01f+'\x20->\x20'+_0x820bda),console['log']('💰\x20Current\x20shop\x20balance:\x20'+_0x2e0d10[_0x3c081f(0x287)]['balance']+'\x20USDT');const _0x4591d2={'status':_0x820bda,'updatedAt':new Date(),'statusChangedBy':_0x3c081f(0x245),'statusChangedAt':new Date()};_0x4c8493&&(_0x4591d2['adminNotes']=_0x4c8493);_0x820bda===_0x3c081f(0x1d6)&&_0x325a66&&(_0x4591d2[_0x3c081f(0x219)]=_0x325a66);let _0xed3536=0x0,_0x2df26e=_0x2e0d10[_0x3c081f(0x287)][_0x3c081f(0x2a7)];if(_0x820bda===_0x3c081f(0x270)&&_0xc8d01f!=='PAID'){_0x4591d2[_0x3c081f(0x1e3)]=new Date();const _0x5e6c46=await currencyService_1[_0x3c081f(0x28f)]['convertToUSDT'](_0x2e0d10[_0x3c081f(0x21b)],_0x2e0d10[_0x3c081f(0x224)]);_0x4591d2['amountUSDT']=_0x5e6c46,_0xed3536=_0x5e6c46,_0x2df26e+=_0x5e6c46,console['log'](_0x3c081f(0x264)+_0x3aa9dd+_0x3c081f(0x1fd)+_0x5e6c46[_0x3c081f(0x253)](0x6)+'\x20USDT\x20to\x20balance');}else _0xc8d01f===_0x3c081f(0x270)&&_0x820bda!==_0x3c081f(0x270)&&(_0x2e0d10[_0x3c081f(0x258)]&&(_0xed3536=-_0x2e0d10[_0x3c081f(0x258)],_0x2df26e-=_0x2e0d10[_0x3c081f(0x258)],_0x4591d2[_0x3c081f(0x258)]=null,console[_0x3c081f(0x269)](_0x3c081f(0x264)+_0x3aa9dd+'\x20no\x20longer\x20PAID:\x20-'+_0x2e0d10[_0x3c081f(0x258)][_0x3c081f(0x253)](0x6)+'\x20USDT\x20from\x20balance')));if(_0x820bda==='CHARGEBACK'){if(_0xc8d01f==='PAID'&&_0x2e0d10[_0x3c081f(0x258)]){}_0x325a66&&_0x325a66>0x0&&(_0xed3536-=_0x325a66,_0x2df26e-=_0x325a66,console[_0x3c081f(0x269)]('💸\x20CHARGEBACK\x20penalty:\x20-'+_0x325a66['toFixed'](0x6)+_0x3c081f(0x29d)));}_0x820bda==='REFUND'&&_0xc8d01f==='PAID'&&console[_0x3c081f(0x269)](_0x3c081f(0x275));const _0x190c74=await _0x12385f[_0x3c081f(0x23b)][_0x3c081f(0x25a)]({'where':{'id':_0x3aa9dd},'data':_0x4591d2,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0xed3536!==0x0&&(await _0x12385f[_0x3c081f(0x287)][_0x3c081f(0x25a)]({'where':{'id':_0x2e0d10[_0x3c081f(0x237)]},'data':{'balance':_0x2df26e}}),console['log'](_0x3c081f(0x2ad)+_0x2e0d10['shopId']+_0x3c081f(0x246)+_0x2e0d10['shop'][_0x3c081f(0x2a7)][_0x3c081f(0x253)](0x6)+_0x3c081f(0x2ab)+_0x2df26e[_0x3c081f(0x253)](0x6)+'\x20USDT\x20('+(_0xed3536>0x0?'+':'')+_0xed3536['toFixed'](0x6)+')')),_0x190c74;});return{'id':_0x318159['id'],'shopId':_0x318159['shopId'],'gateway':_0x318159['gateway'],'amount':_0x318159[_0x53b69c(0x21b)],'currency':_0x318159['currency'],'status':_0x318159[_0x53b69c(0x23f)],'orderId':_0x318159[_0x53b69c(0x235)],'gatewayOrderId':_0x318159[_0x53b69c(0x215)],'customerEmail':_0x318159[_0x53b69c(0x20a)],'customerName':_0x318159['customerName'],'customerCountry':_0x318159['customerCountry'],'customerIp':_0x318159['customerIp'],'customerUa':_0x318159[_0x53b69c(0x21f)],'failureMessage':_0x318159['failureMessage'],'adminNotes':_0x318159[_0x53b69c(0x2a8)],'chargebackAmount':_0x318159[_0x53b69c(0x219)],'statusChangedBy':_0x318159['statusChangedBy'],'statusChangedAt':_0x318159['statusChangedAt'],'createdAt':_0x318159[_0x53b69c(0x207)],'updatedAt':_0x318159[_0x53b69c(0x1ec)],'shop':_0x318159[_0x53b69c(0x287)]};}async[a35_0x582483(0x226)](_0x4a8742,_0x69f10b){const _0x58a517=a35_0x582483,_0x14fbcf={..._0x69f10b};_0x69f10b[_0x58a517(0x21c)]&&(_0x14fbcf['password']=await bcryptjs_1['default'][_0x58a517(0x251)](_0x69f10b[_0x58a517(0x21c)],0xc));_0x69f10b['fullName']&&(_0x14fbcf[_0x58a517(0x262)]=_0x69f10b[_0x58a517(0x240)],delete _0x14fbcf[_0x58a517(0x240)]);_0x69f10b[_0x58a517(0x1ee)]&&(_0x14fbcf[_0x58a517(0x27a)]=_0x69f10b[_0x58a517(0x1ee)],delete _0x14fbcf[_0x58a517(0x1ee)]);_0x69f10b[_0x58a517(0x292)]&&(_0x14fbcf[_0x58a517(0x2a1)]=_0x69f10b[_0x58a517(0x292)],delete _0x14fbcf['merchantUrl']);_0x69f10b['gateways']&&(_0x14fbcf[_0x58a517(0x1f0)]=JSON[_0x58a517(0x24d)](_0x69f10b[_0x58a517(0x285)]),delete _0x14fbcf[_0x58a517(0x285)]);_0x69f10b[_0x58a517(0x1ed)]&&(_0x14fbcf[_0x58a517(0x1ed)]=JSON[_0x58a517(0x24d)](_0x69f10b[_0x58a517(0x1ed)]),delete _0x14fbcf[_0x58a517(0x1ed)]);_0x69f10b[_0x58a517(0x25f)]&&(_0x69f10b[_0x58a517(0x25f)][_0x58a517(0x239)]!==undefined&&(_0x14fbcf[_0x58a517(0x239)]=_0x69f10b['wallets']['usdtPolygonWallet']||null),_0x69f10b['wallets'][_0x58a517(0x24b)]!==undefined&&(_0x14fbcf[_0x58a517(0x24b)]=_0x69f10b[_0x58a517(0x25f)][_0x58a517(0x24b)]||null),_0x69f10b[_0x58a517(0x25f)]['usdtErcWallet']!==undefined&&(_0x14fbcf[_0x58a517(0x22c)]=_0x69f10b['wallets'][_0x58a517(0x22c)]||null),_0x69f10b[_0x58a517(0x25f)]['usdcPolygonWallet']!==undefined&&(_0x14fbcf[_0x58a517(0x204)]=_0x69f10b['wallets'][_0x58a517(0x204)]||null),delete _0x14fbcf[_0x58a517(0x25f)]);const _0x10248a=await database_1[_0x58a517(0x244)][_0x58a517(0x287)]['update']({'where':{'id':_0x4a8742},'data':_0x14fbcf,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x10248a['id'],'fullName':_0x10248a[_0x58a517(0x262)],'username':_0x10248a[_0x58a517(0x22f)],'telegramId':_0x10248a[_0x58a517(0x27a)],'merchantUrl':_0x10248a[_0x58a517(0x2a1)],'gateways':_0x10248a['paymentGateways']?JSON['parse'](_0x10248a[_0x58a517(0x1f0)]):null,'gatewaySettings':_0x10248a[_0x58a517(0x1ed)]?JSON['parse'](_0x10248a[_0x58a517(0x1ed)]):null,'publicKey':_0x10248a['publicKey'],'wallets':{'usdtPolygonWallet':_0x10248a[_0x58a517(0x239)],'usdtTrcWallet':_0x10248a[_0x58a517(0x24b)],'usdtErcWallet':_0x10248a[_0x58a517(0x22c)],'usdcPolygonWallet':_0x10248a[_0x58a517(0x204)]},'status':_0x10248a[_0x58a517(0x23f)],'createdAt':_0x10248a[_0x58a517(0x207)]};}async[a35_0x582483(0x23e)](_0x510a1d){const _0x3e556d=a35_0x582483,_0x128c4c=await database_1[_0x3e556d(0x244)][_0x3e556d(0x287)][_0x3e556d(0x25a)]({'where':{'id':_0x510a1d},'data':{'status':'SUSPENDED'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x128c4c['id'],'fullName':_0x128c4c[_0x3e556d(0x262)],'username':_0x128c4c[_0x3e556d(0x22f)],'telegramId':_0x128c4c[_0x3e556d(0x27a)],'merchantUrl':_0x128c4c[_0x3e556d(0x2a1)],'gateways':_0x128c4c['paymentGateways']?JSON[_0x3e556d(0x1eb)](_0x128c4c[_0x3e556d(0x1f0)]):null,'gatewaySettings':_0x128c4c[_0x3e556d(0x1ed)]?JSON[_0x3e556d(0x1eb)](_0x128c4c[_0x3e556d(0x1ed)]):null,'publicKey':_0x128c4c[_0x3e556d(0x297)],'wallets':{'usdtPolygonWallet':_0x128c4c[_0x3e556d(0x239)],'usdtTrcWallet':_0x128c4c['usdtTrcWallet'],'usdtErcWallet':_0x128c4c['usdtErcWallet'],'usdcPolygonWallet':_0x128c4c[_0x3e556d(0x204)]},'status':_0x128c4c[_0x3e556d(0x23f)],'createdAt':_0x128c4c[_0x3e556d(0x207)]};}async[a35_0x582483(0x28e)](_0x2546ac){const _0x5c55a7=a35_0x582483,_0xd09a6e=await database_1[_0x5c55a7(0x244)]['shop'][_0x5c55a7(0x25a)]({'where':{'id':_0x2546ac},'data':{'status':_0x5c55a7(0x21a)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0xd09a6e['id'],'fullName':_0xd09a6e['name'],'username':_0xd09a6e['username'],'telegramId':_0xd09a6e[_0x5c55a7(0x27a)],'merchantUrl':_0xd09a6e[_0x5c55a7(0x2a1)],'gateways':_0xd09a6e['paymentGateways']?JSON[_0x5c55a7(0x1eb)](_0xd09a6e['paymentGateways']):null,'gatewaySettings':_0xd09a6e[_0x5c55a7(0x1ed)]?JSON[_0x5c55a7(0x1eb)](_0xd09a6e['gatewaySettings']):null,'publicKey':_0xd09a6e[_0x5c55a7(0x297)],'wallets':{'usdtPolygonWallet':_0xd09a6e[_0x5c55a7(0x239)],'usdtTrcWallet':_0xd09a6e[_0x5c55a7(0x24b)],'usdtErcWallet':_0xd09a6e[_0x5c55a7(0x22c)],'usdcPolygonWallet':_0xd09a6e[_0x5c55a7(0x204)]},'status':_0xd09a6e[_0x5c55a7(0x23f)],'createdAt':_0xd09a6e[_0x5c55a7(0x207)]};}async[a35_0x582483(0x23d)](_0x2ef7c0){const _0x146b81=a35_0x582483,{page:_0x26be16,limit:_0x5655b5,status:_0xef41b6}=_0x2ef7c0,_0x4ba2c6=(_0x26be16-0x1)*_0x5655b5,_0x3d0ce3={};_0xef41b6&&(_0x3d0ce3['status']=_0xef41b6[_0x146b81(0x222)]());const [_0x540be6,_0x43b09f]=await Promise[_0x146b81(0x24e)]([database_1['default'][_0x146b81(0x287)][_0x146b81(0x26f)]({'where':_0x3d0ce3,'skip':_0x4ba2c6,'take':_0x5655b5,'orderBy':{'createdAt':_0x146b81(0x29c)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1['default'][_0x146b81(0x287)][_0x146b81(0x212)]({'where':_0x3d0ce3})]);return{'users':_0x540be6['map'](_0x5f3467=>({'id':_0x5f3467['id'],'fullName':_0x5f3467[_0x146b81(0x262)],'username':_0x5f3467[_0x146b81(0x22f)],'telegramId':_0x5f3467[_0x146b81(0x27a)],'merchantUrl':_0x5f3467[_0x146b81(0x2a1)],'gateways':_0x5f3467[_0x146b81(0x1f0)]?JSON[_0x146b81(0x1eb)](_0x5f3467['paymentGateways']):null,'gatewaySettings':_0x5f3467[_0x146b81(0x1ed)]?JSON['parse'](_0x5f3467[_0x146b81(0x1ed)]):null,'publicKey':_0x5f3467[_0x146b81(0x297)],'wallets':{'usdtPolygonWallet':_0x5f3467[_0x146b81(0x239)],'usdtTrcWallet':_0x5f3467['usdtTrcWallet'],'usdtErcWallet':_0x5f3467[_0x146b81(0x22c)],'usdcPolygonWallet':_0x5f3467['usdcPolygonWallet']},'status':_0x5f3467['status'],'createdAt':_0x5f3467[_0x146b81(0x207)]})),'pagination':{'page':_0x26be16,'limit':_0x5655b5,'total':_0x43b09f,'totalPages':Math[_0x146b81(0x25e)](_0x43b09f/_0x5655b5)}};}async['getUserById'](_0x23c71f){const _0x416079=a35_0x582483,_0x472252=await database_1[_0x416079(0x244)][_0x416079(0x287)][_0x416079(0x20b)]({'where':{'id':_0x23c71f},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x472252)return null;return{'id':_0x472252['id'],'fullName':_0x472252[_0x416079(0x262)],'username':_0x472252[_0x416079(0x22f)],'telegramId':_0x472252['telegram'],'merchantUrl':_0x472252['shopUrl'],'gateways':_0x472252['paymentGateways']?JSON[_0x416079(0x1eb)](_0x472252[_0x416079(0x1f0)]):null,'gatewaySettings':_0x472252[_0x416079(0x1ed)]?JSON[_0x416079(0x1eb)](_0x472252[_0x416079(0x1ed)]):null,'publicKey':_0x472252['publicKey'],'wallets':{'usdtPolygonWallet':_0x472252[_0x416079(0x239)],'usdtTrcWallet':_0x472252[_0x416079(0x24b)],'usdtErcWallet':_0x472252['usdtErcWallet'],'usdcPolygonWallet':_0x472252['usdcPolygonWallet']},'status':_0x472252['status'],'createdAt':_0x472252[_0x416079(0x207)]};}async[a35_0x582483(0x26c)](_0x5534f2){const _0x1848a9=a35_0x582483,{fullName:_0xd6fbca,username:_0x26663b,password:_0x4a5473,telegramId:_0x8d9494,merchantUrl:_0x573d8e,gateways:_0x568ddc,gatewaySettings:_0x474ccc,wallets:_0x4f007a}=_0x5534f2,_0x4774c0=await database_1[_0x1848a9(0x244)]['shop'][_0x1848a9(0x20b)]({'where':{'username':_0x26663b}});if(_0x4774c0)throw new Error(_0x1848a9(0x1dd));if(_0x8d9494){const _0x4d11f9=await database_1[_0x1848a9(0x244)][_0x1848a9(0x287)][_0x1848a9(0x20b)]({'where':{'telegram':_0x8d9494}});if(_0x4d11f9)throw new Error(_0x1848a9(0x1f1));}const _0x54f88a=await bcryptjs_1[_0x1848a9(0x244)][_0x1848a9(0x251)](_0x4a5473,0xc),_0x25989f='pk_'+crypto_1[_0x1848a9(0x244)][_0x1848a9(0x248)](0x20)['toString'](_0x1848a9(0x1d9)),_0x5ded56=_0x1848a9(0x293)+crypto_1[_0x1848a9(0x244)][_0x1848a9(0x248)](0x20)[_0x1848a9(0x26b)](_0x1848a9(0x1d9)),_0x4e59b3=await database_1[_0x1848a9(0x244)][_0x1848a9(0x287)][_0x1848a9(0x2b5)]({'data':{'name':_0xd6fbca,'username':_0x26663b,'password':_0x54f88a,'telegram':_0x8d9494,'shopUrl':_0x573d8e,'paymentGateways':_0x568ddc?JSON[_0x1848a9(0x24d)](_0x568ddc):null,'gatewaySettings':_0x474ccc?JSON['stringify'](_0x474ccc):null,'usdtPolygonWallet':_0x4f007a?.[_0x1848a9(0x239)]||null,'usdtTrcWallet':_0x4f007a?.[_0x1848a9(0x24b)]||null,'usdtErcWallet':_0x4f007a?.[_0x1848a9(0x22c)]||null,'usdcPolygonWallet':_0x4f007a?.['usdcPolygonWallet']||null,'publicKey':_0x25989f,'secretKey':_0x5ded56,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4e59b3['id'],'fullName':_0x4e59b3[_0x1848a9(0x262)],'username':_0x4e59b3[_0x1848a9(0x22f)],'telegramId':_0x4e59b3['telegram'],'merchantUrl':_0x4e59b3[_0x1848a9(0x2a1)],'gateways':_0x4e59b3['paymentGateways']?JSON['parse'](_0x4e59b3['paymentGateways']):null,'gatewaySettings':_0x4e59b3[_0x1848a9(0x1ed)]?JSON[_0x1848a9(0x1eb)](_0x4e59b3[_0x1848a9(0x1ed)]):null,'publicKey':_0x4e59b3[_0x1848a9(0x297)],'wallets':{'usdtPolygonWallet':_0x4e59b3[_0x1848a9(0x239)],'usdtTrcWallet':_0x4e59b3[_0x1848a9(0x24b)],'usdtErcWallet':_0x4e59b3[_0x1848a9(0x22c)],'usdcPolygonWallet':_0x4e59b3[_0x1848a9(0x204)]},'status':_0x4e59b3[_0x1848a9(0x23f)],'createdAt':_0x4e59b3[_0x1848a9(0x207)]};}async[a35_0x582483(0x1f5)](_0x75b781){const _0x531e7b=a35_0x582483;await database_1[_0x531e7b(0x244)][_0x531e7b(0x287)][_0x531e7b(0x27e)]({'where':{'id':_0x75b781}});}async[a35_0x582483(0x263)](_0x455ff4){const _0x134040=a35_0x582483,_0x35a33f={};_0x455ff4&&[_0x134040(0x21a),_0x134040(0x216),_0x134040(0x26a)][_0x134040(0x223)](_0x455ff4[_0x134040(0x222)]())&&(_0x35a33f[_0x134040(0x23f)]=_0x455ff4['toUpperCase']());const _0x46c012=await database_1[_0x134040(0x244)][_0x134040(0x287)][_0x134040(0x26f)]({'where':_0x35a33f,'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x134040(0x1e4)}});return _0x46c012;}}exports[a35_0x582483(0x255)]=AdminService;