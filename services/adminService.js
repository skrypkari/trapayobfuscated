'use strict';const a38_0x30ac33=a38_0x3201;function a38_0x3cbe(){const _0x582a63=['\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','klyme_de','insensitive','💰\x20[PAYOUT]\x20Merchant\x20','🔄\x20Converted\x20gateway\x20ID\x20\x27','\x20\x20\x20🌍\x20Country:\x20','KLYME\x20EU','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','pendingUrl','\x20\x20\x20💰\x20Total\x20payments\x20turnover:\x20','createUser','1205819GMajqw','../config/database','revenue','substr','amountAfterCommissionUSDT','chargebackAmount','txid','\x20\x20\x20Transaction\x20hash:\x20','aggregate','PENDING','commissionUSDT','KLYME\x20GB','plisio','🔍\x20Using\x20gateway\x20\x27','lte','dateTo','getAllPayouts','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','getGatewayNameById','📊\x20Available\x20gateways\x20in\x20database:','orderId','📊\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','✅\x20Using\x20gateway\x20filter:\x20\x27','💳\x20Payout\x20wallet\x20for\x20','📋\x20Found\x20','day','customerCountry','Rapyd','\x20\x20\x20Current\x20balance:\x20','updateUser','\x20USDT\x20(current\x20balance\x20in\x20DB)','payment','\x20USDT\x20(','\x20\x20\x20💸\x20Total\x20payouts\x20(all\x20time):\x20','\x27\x20to\x20name\x20\x27','totalPaidOut','averageCheckUSDT','statusChangedBy','MasterCard','statusChangedAt','merchantEarningsUSDT','📊\x20Merchants\x20awaiting\x20payout:\x20','\x20USDT\x20(already\x20paid\x20out)','toUpperCase','bcryptjs','\x20merchants\x20with\x20positive\x20balance','totalPayout','\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)','gte','pendingPayout','../types/gateway','wallets','gatewayCommissionRate','\x20\x20\x20Merchant\x20gets:\x20','findMany','default','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','periodTo','gateways','💰\x20Found\x20','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','telegramId','90d','hex','\x20merchants','🎯\x20updateUser\x20called\x20with\x20ID:\x20','\x20PAID\x20payments','\x20USDT\x20from\x20balance','successUrl','totalPayments','toISOString','getMerchantsAwaitingPayout','delete','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','Insufficient\x20balance.\x20Available:\x20','not\x20set','\x20\x20\x20💰\x20Total\x20turnover:\x20','NONEXISTENT_GATEWAY_FILTER','ACTIVE','2cyPEiQ','erc20','adminNotes','\x20USDT','pk_','🎯\x20[','noda','externalPaymentUrl','%\x20commission)','2020-01-01','\x20\x20\x20Total\x20paid\x20out:\x20','amountUSDT','turnoverUSDT','\x20\x20\x20Added\x20to\x20balance:\x20+','\x20\x20\x20💵\x20Available\x20balance:\x20','getPaymentById','Open\x20Banking\x202','paidAt','30d','customerName','\x20became\x20PAID:','get','set','includes','\x20\x20\x20Full\x20amount:\x20','length','0000','parse','network','amount','customerUa','sort','KLYME\x20DE','\x20\x20\x20💸\x20Total\x20payouts:\x20','🔐\x20[','failUrl','REFUND','📊\x20Getting\x20payments\x20with\x20filters:','fullName','⚠️\x20Payment\x20','⚠️\x20Gateway\x20\x27','\x20\x20\x20�\x20Total\x20payments\x20turnover:\x20',':\x20commission\x20=\x20','💰\x20Creating\x20payout\x20for\x20shop\x20','crypto','💰\x20[PAYOUT]\x20Gateway\x20','getFullYear','all','🔄\x20Converted\x20gateway\x20name\x20\x27','round','💰\x20Current\x20shop\x20balance:\x20','currencyService','shopUrl','polygon_usdc','custom','name','suspendUser','1200QwizAW','gatewayOrderId','customerEmail','CoinToPay','36330GlEdzA','📊\x20Payout\x20statistics\x20calculated:','\x20for\x20shop\x20',']\x20Updating\x20password\x20for\x20user\x20','paidOutUSDT','findUnique','getPayoutById','activateUser','warn','\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)','notes','usdtPolygonWallet','\x20\x20\x20🖥️\x20User\x20Agent:\x20','paymentGateways','\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...','turnover','getDate','updatedAt','COMPLETED','🔄\x20Gateway\x20mapping\x20(create):','balance','erc20_usdc','\x20to\x20','getGatewayInternalName','thisMonth','toString','hash','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','\x20\x20\x20Merchant\x20loses:\x20','144avWnpf','25qyajph','getUserById','📊\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','cointopay2','CHARGEBACK','setHours','availableBalance','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','dailyPayments','Telegram\x20username\x20already\x20exists','\x20USDT)','1078NFRCnQ','⚠️\x20Requested\x20gateway\x20\x27',',\x20Commission:\x20','gateway','Payment\x20not\x20found','randomBytes',',\x20userId:\x20','AdminService','getGatewayDisplayName','customerIp','publicKey','usdtErcWallet',']\x20Gateway\x20settings\x20JSON\x20string:','📊\x20Merchant\x20statistics\x20calculated:','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','Noda','\x20USDT\x20(after\x20','yesterday','findFirst','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','\x20USDT\x20(actual\x20balances)',',\x20successful:\x20','currency','count','merchantEarnings','createdAt','Plisio','join','forEach','\x27\x20not\x20found.\x20Available\x20gateways:\x20','toFixed','\x20\x20\x20🔍\x20Calculated\x20after\x20commission:\x20','paymentsCount','push','shopId','date','\x20\x20\x20📅\x20Total\x20payouts\x20(this\x20month):\x20','💰\x20Shop\x20','awaitingPayout','desc','$transaction','reduce','gatewayEarnings','failureMessage','\x20\x20\x20Payout\x20amount:\x20','usdcPolygonWallet','merchantUrl','\x20\x20\x20📅\x20This\x20month:\x20','updateCustomerData','update','\x20\x20\x20Gateway:\x20','getMerchantsSelection','\x20balance\x20updated:','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','split','\x20\x20\x20💰\x20Total\x20payout:\x20','\x27\x20->\x20ID\x20\x27','usdtTrcWallet','totalCommissionRate',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','\x20USDT\x20(total\x20paid\x20to\x20merchants)','88214YeXaPQ','entries','Shop\x20not\x20found','klyme_gb','\x20\x20\x20✅\x20Actual\x20available\x20balance:\x20','create','getAllPayments','cointopay','PAID','payout','trim','getGatewayIdByName','log','defineProperty','📊\x20Calculating\x20payout\x20statistics...','📋\x20Getting\x20merchants\x20selection\x20list...','\x20\x20\x20🤔\x20Difference:\x20','username','\x20\x20\x20Balance:\x20','3497289vDapsb','🔄\x20Admin\x20updating\x20payment\x20','\x20\x20\x20💳\x20Total\x20payments:\x20','createPayout','sk_','amountAfterGatewayCommissionUSDT','🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','totalAmountAfterCommissionUSDT','📅\x20Period:\x20','map','_count','getPayoutStats','\x20USDT\x20(gross\x20revenue)','\x20in\x20','totalAmountUSDT','groupBy','📊\x20Using\x20saved\x20values\x20for\x20payment\x20','5724296eUpdrt','klyme_eu','error','ceil','values','💰\x20Payment\x20','mastercard','period','getTime','1180690KLuheT','getMonth','dailyRevenue','commission','stringify','\x20->\x20','shop','password','%\x20from\x20','💸\x20CHARGEBACK\x20penalty:\x20-','random','_sum','💱\x20Currency\x20filter\x20applied:\x20','\x20USDT,\x20Requested:\x20','gatewaySettings','\x20paid\x20payments\x20for\x20analysis','getSystemStatistics','__esModule','month','🔧\x20[','dateFrom','📊\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','generateDailyStatistics','some','status','toLowerCase','trc20','setDate','convertToUSDT','\x27\x20->\x20name\x20\x27','\x20balance\x20updated:\x20','averageCommissionRate','📊\x20Calculated\x20commission\x20rate\x20for\x20payment\x20','usdcErcWallet','telegram','periodFrom','asc','polygon','285756vBaBHE','\x27\x20(from\x20\x27','test_gateway','\x20USDT\x20(same\x20as\x20awaiting)','\x20status:\x20'];a38_0x3cbe=function(){return _0x582a63;};return a38_0x3cbe();}(function(_0x4b916f,_0x599bbb){const _0x1b3a67=a38_0x3201,_0x1da7d4=_0x4b916f();while(!![]){try{const _0x4395ad=parseInt(_0x1b3a67(0x22d))/0x1+parseInt(_0x1b3a67(0x27d))/0x2*(-parseInt(_0x1b3a67(0x1dd))/0x3)+-parseInt(_0x1b3a67(0x1ee))/0x4+parseInt(_0x1b3a67(0x182))/0x5*(parseInt(_0x1b3a67(0x2ba))/0x6)+-parseInt(_0x1b3a67(0x1ca))/0x7*(parseInt(_0x1b3a67(0x2b6))/0x8)+parseInt(_0x1b3a67(0x181))/0x9*(parseInt(_0x1b3a67(0x1f7))/0xa)+-parseInt(_0x1b3a67(0x18d))/0xb*(-parseInt(_0x1b3a67(0x21d))/0xc);if(_0x4395ad===_0x599bbb)break;else _0x1da7d4['push'](_0x1da7d4['shift']());}catch(_0x5b5a4d){_0x1da7d4['push'](_0x1da7d4['shift']());}}}(a38_0x3cbe,0xed3d7));var __importDefault=this&&this['__importDefault']||function(_0x7a0ed4){const _0x365ea0=a38_0x3201;return _0x7a0ed4&&_0x7a0ed4[_0x365ea0(0x208)]?_0x7a0ed4:{'default':_0x7a0ed4};};Object[a38_0x30ac33(0x1d7)](exports,a38_0x30ac33(0x208),{'value':!![]}),exports['AdminService']=void 0x0;const database_1=__importDefault(require(a38_0x30ac33(0x22e))),bcryptjs_1=__importDefault(require(a38_0x30ac33(0x259))),crypto_1=__importDefault(require(a38_0x30ac33(0x2a9))),currencyService_1=require('./currencyService'),gateway_1=require(a38_0x30ac33(0x25f));function a38_0x3201(_0x1ff7c7,_0x3596b5){const _0x3cbec8=a38_0x3cbe();return a38_0x3201=function(_0x3201fb,_0x36c63c){_0x3201fb=_0x3201fb-0x168;let _0x454f18=_0x3cbec8[_0x3201fb];return _0x454f18;},a38_0x3201(_0x1ff7c7,_0x3596b5);}class AdminService{async[a38_0x30ac33(0x1e8)](){const _0x3eadee=a38_0x30ac33;console[_0x3eadee(0x1d6)](_0x3eadee(0x1d8));const _0x386f82=await database_1['default']['shop'][_0x3eadee(0x235)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x3eadee(0x27c)}}),_0x43a017=await database_1[_0x3eadee(0x264)][_0x3eadee(0x24c)]['count']({'where':{'status':_0x3eadee(0x1d2),'gateway':{'not':'test_gateway'}}}),_0x4c91f1=new Date(),_0x2c534c=new Date(_0x4c91f1['getFullYear'](),_0x4c91f1['getMonth'](),0x1),_0x5a72fa=new Date(_0x4c91f1[_0x3eadee(0x2ab)](),_0x4c91f1[_0x3eadee(0x1f8)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x5b6c1=await database_1[_0x3eadee(0x264)][_0x3eadee(0x1d3)][_0x3eadee(0x235)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x2c534c,'lte':_0x5a72fa},'status':'COMPLETED'}}),_0x13c828=_0x386f82['_sum'][_0x3eadee(0x250)]||0x0,_0x5e7b4f=_0x386f82[_0x3eadee(0x202)][_0x3eadee(0x178)]||0x0,_0xebc6a4=_0x5b6c1[_0x3eadee(0x202)][_0x3eadee(0x29a)]||0x0,_0x25db28={'totalPayout':Math[_0x3eadee(0x2ae)](_0x13c828*0x64)/0x64,'awaitingPayout':Math['round'](_0x5e7b4f*0x64)/0x64,'thisMonth':Math[_0x3eadee(0x2ae)](_0xebc6a4*0x64)/0x64,'availableBalance':Math[_0x3eadee(0x2ae)](_0x5e7b4f*0x64)/0x64,'totalPayments':_0x43a017};return console['log'](_0x3eadee(0x2bb)),console[_0x3eadee(0x1d6)](_0x3eadee(0x1c4)+_0x25db28[_0x3eadee(0x25b)]+_0x3eadee(0x1c9)),console[_0x3eadee(0x1d6)](_0x3eadee(0x1c2)+_0x25db28[_0x3eadee(0x1b3)]+_0x3eadee(0x16d)),console[_0x3eadee(0x1d6)](_0x3eadee(0x28b)+_0x25db28[_0x3eadee(0x188)]+_0x3eadee(0x220)),console[_0x3eadee(0x1d6)](_0x3eadee(0x1bc)+_0x25db28[_0x3eadee(0x17c)]+_0x3eadee(0x280)),console[_0x3eadee(0x1d6)](_0x3eadee(0x1df)+_0x25db28['totalPayments']+_0x3eadee(0x270)),_0x25db28;}async[a38_0x30ac33(0x1bd)](_0x54c7c6,_0x25efba){const _0x23751b=a38_0x30ac33;console[_0x23751b(0x1d6)](_0x23751b(0x189)+_0x54c7c6+':',_0x25efba);const _0x2dfbe1=await database_1[_0x23751b(0x264)][_0x23751b(0x24c)]['findUnique']({'where':{'id':_0x54c7c6},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x2dfbe1)throw new Error('Payment\x20not\x20found');const _0x1463c7={};_0x25efba['customerCountry']!==undefined&&(_0x1463c7[_0x23751b(0x247)]=_0x25efba[_0x23751b(0x247)]||null);_0x25efba['customerIp']!==undefined&&(_0x1463c7['customerIp']=_0x25efba[_0x23751b(0x196)]||null);_0x25efba['customerUa']!==undefined&&(_0x1463c7['customerUa']=_0x25efba[_0x23751b(0x29b)]||null);const _0x49a982=await database_1['default'][_0x23751b(0x24c)]['update']({'where':{'id':_0x54c7c6},'data':{..._0x1463c7,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console['log'](_0x23751b(0x23e)+_0x54c7c6),console[_0x23751b(0x1d6)](_0x23751b(0x227)+_0x2dfbe1[_0x23751b(0x247)]+_0x23751b(0x1fc)+_0x49a982[_0x23751b(0x247)]),console['log']('\x20\x20\x20🌐\x20IP:\x20'+_0x2dfbe1[_0x23751b(0x196)]+_0x23751b(0x1fc)+_0x49a982[_0x23751b(0x196)]),console['log'](_0x23751b(0x170)+(_0x2dfbe1[_0x23751b(0x29b)]?_0x23751b(0x293):_0x23751b(0x279))+_0x23751b(0x1fc)+(_0x49a982[_0x23751b(0x29b)]?_0x23751b(0x293):_0x23751b(0x279))),_0x49a982;}async[a38_0x30ac33(0x207)](_0x3929cc){const _0x1177b9=a38_0x30ac33,_0x5742bd=new Date();let _0x1e5d57;switch(_0x3929cc[_0x1177b9(0x210)]()){case _0x1177b9(0x246):_0x1e5d57=new Date(_0x5742bd['getFullYear'](),_0x5742bd[_0x1177b9(0x1f8)](),_0x5742bd[_0x1177b9(0x174)](),0x0,0x0,0x0,0x0);break;case _0x1177b9(0x19e):const _0x2a59c5=new Date(_0x5742bd);_0x2a59c5['setDate'](_0x2a59c5['getDate']()-0x1),_0x1e5d57=new Date(_0x2a59c5['getFullYear'](),_0x2a59c5[_0x1177b9(0x1f8)](),_0x2a59c5[_0x1177b9(0x174)](),0x0,0x0,0x0,0x0);break;case'7d':_0x1e5d57=new Date(_0x5742bd[_0x1177b9(0x1f6)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x1177b9(0x28f):_0x1e5d57=new Date(_0x5742bd[_0x1177b9(0x1f6)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x1177b9(0x26c):_0x1e5d57=new Date(_0x5742bd[_0x1177b9(0x1f6)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x1177b9(0x2ac):const _0x3188e2=await database_1[_0x1177b9(0x264)][_0x1177b9(0x24c)][_0x1177b9(0x19f)]({'where':{'gateway':{'not':'test_gateway'}},'orderBy':{'createdAt':_0x1177b9(0x21b)},'select':{'createdAt':!![]}});_0x1e5d57=_0x3188e2?_0x3188e2[_0x1177b9(0x1a6)]:new Date(_0x1177b9(0x286));break;default:_0x1e5d57=new Date(_0x5742bd[_0x1177b9(0x1f6)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}_0x1e5d57[_0x1177b9(0x187)](0x0,0x0,0x0,0x0);let _0x23636b;if(_0x3929cc[_0x1177b9(0x210)]()==='yesterday'){const _0x46a330=new Date(_0x5742bd);_0x46a330[_0x1177b9(0x212)](_0x46a330[_0x1177b9(0x174)]()-0x1),_0x23636b=new Date(_0x46a330[_0x1177b9(0x2ab)](),_0x46a330[_0x1177b9(0x1f8)](),_0x46a330[_0x1177b9(0x174)](),0x17,0x3b,0x3b,0x3e7);}const _0x2346e0={'gte':_0x1e5d57};_0x23636b&&(_0x2346e0[_0x1177b9(0x23b)]=_0x23636b);const [_0x4933b2,_0x1d1b78,_0x2b7d78,_0xf64885,_0x4a6690,_0x4fc014]=await Promise[_0x1177b9(0x2ac)]([database_1[_0x1177b9(0x264)]['shop'][_0x1177b9(0x1a4)](),database_1[_0x1177b9(0x264)][_0x1177b9(0x1fd)][_0x1177b9(0x1a4)]({'where':{'status':'ACTIVE'}}),database_1[_0x1177b9(0x264)]['payment'][_0x1177b9(0x1a4)]({'where':{'status':_0x1177b9(0x1d2),'createdAt':_0x2346e0,'gateway':{'not':_0x1177b9(0x21f)}}}),database_1[_0x1177b9(0x264)][_0x1177b9(0x24c)][_0x1177b9(0x263)]({'where':{'status':'PAID','createdAt':_0x2346e0,'gateway':{'not':_0x1177b9(0x21f)}},'select':{'amount':!![],'currency':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1['default'][_0x1177b9(0x24c)][_0x1177b9(0x263)]({'where':{'gateway':{'not':_0x1177b9(0x21f)}},'take':0xa,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x1177b9(0x264)]['payment'][_0x1177b9(0x263)]({'where':{'createdAt':_0x2346e0,'gateway':{'not':_0x1177b9(0x21f)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x4db801=0x0,_0xb1f3a2=0x0;for(const _0x207e23 of _0xf64885){const _0x5d87f4=await currencyService_1['currencyService'][_0x1177b9(0x213)](_0x207e23[_0x1177b9(0x29a)],_0x207e23['currency']);_0x4db801+=_0x5d87f4;if(_0x207e23['amountAfterGatewayCommissionUSDT']){const _0x2a3a17=await currencyService_1[_0x1177b9(0x2b0)]['convertToUSDT'](_0x207e23[_0x1177b9(0x29a)],_0x207e23[_0x1177b9(0x1a3)]),_0x324a44=_0x207e23[_0x1177b9(0x1e2)],_0x272632=_0x2a3a17-_0x324a44;_0xb1f3a2+=_0x272632;}}const _0x376896=_0x2b7d78>0x0?_0x4db801/_0x2b7d78:0x0,_0x2fe8a0=this[_0x1177b9(0x20d)](_0x4fc014,_0x1e5d57,_0x23636b||_0x5742bd),_0x455449=await database_1['default'][_0x1177b9(0x24c)][_0x1177b9(0x1a4)]({'where':{'createdAt':_0x2346e0,'gateway':{'not':_0x1177b9(0x21f)}}}),_0x8b530a=_0x455449>0x0?_0x2b7d78/_0x455449*0x64:0x0;return{'totalShops':_0x4933b2,'activeShops':_0x1d1b78,'totalPayments':_0x2b7d78,'successfulPayments':_0x2b7d78,'totalAttempts':_0x455449,'totalRevenue':Math['round'](_0x4db801*0x64)/0x64,'trapayEarnings':Math[_0x1177b9(0x2ae)](_0xb1f3a2*0x64)/0x64,'averagePaymentAmount':Math[_0x1177b9(0x2ae)](_0x376896*0x64)/0x64,'conversionRate':Math['round'](_0x8b530a*0x64)/0x64,'dailyRevenue':_0x2fe8a0[_0x1177b9(0x1f9)],'dailyPayments':_0x2fe8a0[_0x1177b9(0x18a)],'recentPayments':_0x4a6690[_0x1177b9(0x1e6)](_0x3d3409=>({'id':_0x3d3409['id'],'amount':_0x3d3409[_0x1177b9(0x29a)],'currency':_0x3d3409[_0x1177b9(0x1a3)],'status':_0x3d3409['status'],'gateway':_0x3d3409[_0x1177b9(0x190)],'shop':_0x3d3409['shop'],'createdAt':_0x3d3409[_0x1177b9(0x1a6)]}))};}async['getMerchantStatistics'](_0x1f24ef){const _0x434350=a38_0x30ac33;console['log'](_0x434350(0x26a),_0x1f24ef);let _0x1c851c,_0x16de69=new Date();if(_0x1f24ef['period']==='custom'&&_0x1f24ef['dateFrom']&&_0x1f24ef['dateTo'])_0x1c851c=new Date(_0x1f24ef[_0x434350(0x20b)]),_0x16de69=new Date(_0x1f24ef[_0x434350(0x23c)]),_0x1c851c['setHours'](0x0,0x0,0x0,0x0),_0x16de69[_0x434350(0x187)](0x17,0x3b,0x3b,0x3e7);else{const _0x3132f8=new Date();switch(_0x1f24ef['period']){case'week':_0x1c851c=new Date(_0x3132f8['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x434350(0x209):_0x1c851c=new Date(_0x3132f8[_0x434350(0x1f6)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'year':_0x1c851c=new Date(_0x3132f8[_0x434350(0x1f6)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x434350(0x2ac):default:_0x1c851c=new Date('2020-01-01');break;}_0x1c851c[_0x434350(0x187)](0x0,0x0,0x0,0x0),_0x16de69['setHours'](0x17,0x3b,0x3b,0x3e7);}console['log'](_0x434350(0x1e5)+_0x1c851c[_0x434350(0x274)]()+_0x434350(0x17a)+_0x16de69[_0x434350(0x274)]());const _0x3ddeb2={'status':_0x434350(0x1d2),'gateway':{'not':_0x434350(0x21f)},'paidAt':{'gte':_0x1c851c,'lte':_0x16de69}};_0x1f24ef[_0x434350(0x1af)]&&(_0x3ddeb2['shopId']=_0x1f24ef['shopId']);const _0x161ef0=await database_1[_0x434350(0x264)]['payment'][_0x434350(0x263)]({'where':_0x3ddeb2,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x434350(0x1d6)](_0x434350(0x269)+_0x161ef0[_0x434350(0x296)]+_0x434350(0x206));const _0x144d46={'gateway':{'not':'test_gateway'},'createdAt':{'gte':_0x1c851c,'lte':_0x16de69}};_0x1f24ef[_0x434350(0x1af)]&&(_0x144d46['shopId']=_0x1f24ef[_0x434350(0x1af)]);const _0x1cfa1b=await database_1[_0x434350(0x264)][_0x434350(0x24c)][_0x434350(0x1a4)]({'where':_0x144d46});console[_0x434350(0x1d6)]('📊\x20Total\x20payments\x20(including\x20failed):\x20'+_0x1cfa1b+_0x434350(0x1a2)+_0x161ef0[_0x434350(0x296)]);let _0x485303=0x0,_0x1025ed=0x0,_0xe34155=0x0;const _0x380db2={},_0x234a0b={},_0x281e2f={};for(const _0x41f9bd of _0x161ef0){try{const _0x2815e9=_0x41f9bd[_0x434350(0x288)]||0x0;if(_0x2815e9<=0x0){console[_0x434350(0x16c)](_0x434350(0x2a4)+_0x41f9bd['id']+_0x434350(0x172));continue;}let _0x487a11,_0x30e4f5;if(_0x41f9bd['amountAfterGatewayCommissionUSDT']!==null&&_0x41f9bd[_0x434350(0x1e2)]!==undefined)_0x487a11=_0x41f9bd[_0x434350(0x1e2)],_0x30e4f5=_0x2815e9-_0x487a11,console[_0x434350(0x1d6)](_0x434350(0x1ed)+_0x41f9bd['id']+':\x20'+_0x2815e9[_0x434350(0x1ab)](0x6)+'\x20USDT,\x20merchant:\x20'+_0x487a11[_0x434350(0x1ab)](0x6)+_0x434350(0x280));else{let _0x41ba64={};if(_0x41f9bd['shop'][_0x434350(0x205)])try{_0x41ba64=JSON['parse'](_0x41f9bd[_0x434350(0x1fd)][_0x434350(0x205)]);}catch(_0x1490c1){console['error']('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x41f9bd[_0x434350(0x1af)]+':',_0x1490c1);}let _0x4a370e=0x2d;for(const [_0x264981,_0x3a7870]of Object[_0x434350(0x1cb)](_0x41ba64)){if(_0x264981[_0x434350(0x210)]()===_0x41f9bd['gateway'][_0x434350(0x210)]()){_0x4a370e=_0x3a7870[_0x434350(0x1fa)]||0x2d;break;}}_0x30e4f5=_0x2815e9*(_0x4a370e/0x64),_0x487a11=_0x2815e9-_0x30e4f5,console[_0x434350(0x1d6)](_0x434350(0x184)+_0x41f9bd['id']+':\x20'+_0x4a370e+'%\x20from\x20'+_0x2815e9['toFixed'](0x6)+_0x434350(0x280));}_0x485303+=_0x2815e9,_0x1025ed+=_0x487a11,_0xe34155+=_0x30e4f5;let _0x5ac393;_0x41f9bd[_0x434350(0x261)]!==null&&_0x41f9bd[_0x434350(0x261)]!==undefined?(_0x5ac393=_0x41f9bd['gatewayCommissionRate'],console[_0x434350(0x1d6)]('📊\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20'+_0x41f9bd['id']+':\x20'+_0x5ac393+'%')):(_0x5ac393=_0x2815e9>0x0?_0x30e4f5/_0x2815e9*0x64:0x0,console[_0x434350(0x1d6)](_0x434350(0x217)+_0x41f9bd['id']+':\x20'+_0x5ac393['toFixed'](0x2)+'%'));!_0x380db2[_0x41f9bd['gateway']]&&(_0x380db2[_0x41f9bd['gateway']]={'gateway':_0x41f9bd[_0x434350(0x190)],'gatewayDisplayName':this[_0x434350(0x195)](_0x41f9bd[_0x434350(0x190)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x380db2[_0x41f9bd[_0x434350(0x190)]]['paymentsCount']++,_0x380db2[_0x41f9bd['gateway']][_0x434350(0x289)]+=_0x2815e9,_0x380db2[_0x41f9bd[_0x434350(0x190)]][_0x434350(0x237)]+=_0x30e4f5,_0x380db2[_0x41f9bd['gateway']][_0x434350(0x255)]+=_0x487a11,_0x380db2[_0x41f9bd[_0x434350(0x190)]][_0x434350(0x1c7)]+=_0x5ac393;!_0x1f24ef[_0x434350(0x1af)]&&(!_0x234a0b[_0x41f9bd[_0x434350(0x1af)]]&&(_0x234a0b[_0x41f9bd[_0x434350(0x1af)]]={'shopId':_0x41f9bd[_0x434350(0x1af)],'shopName':_0x41f9bd['shop'][_0x434350(0x2b4)],'shopUsername':_0x41f9bd[_0x434350(0x1fd)]['username'],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x234a0b[_0x41f9bd[_0x434350(0x1af)]]['paymentsCount']++,_0x234a0b[_0x41f9bd[_0x434350(0x1af)]][_0x434350(0x289)]+=_0x2815e9,_0x234a0b[_0x41f9bd[_0x434350(0x1af)]]['commissionUSDT']+=_0x30e4f5,_0x234a0b[_0x41f9bd[_0x434350(0x1af)]][_0x434350(0x255)]+=_0x487a11);const _0x26adf4=_0x41f9bd[_0x434350(0x28e)][_0x434350(0x274)]()[_0x434350(0x1c3)]('T')[0x0];!_0x281e2f[_0x26adf4]&&(_0x281e2f[_0x26adf4]={'date':_0x26adf4,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x281e2f[_0x26adf4][_0x434350(0x173)]+=_0x2815e9,_0x281e2f[_0x26adf4][_0x434350(0x1a5)]+=_0x487a11,_0x281e2f[_0x26adf4]['gatewayEarnings']+=_0x30e4f5,_0x281e2f[_0x26adf4][_0x434350(0x1ad)]++;}catch(_0x252cf2){console[_0x434350(0x1f0)]('Error\x20processing\x20payment\x20'+_0x41f9bd['id']+':',_0x252cf2);}}Object[_0x434350(0x1f2)](_0x380db2)[_0x434350(0x1a9)](_0x462c6e=>{const _0x18152e=_0x434350;_0x462c6e[_0x18152e(0x216)]=_0x462c6e['paymentsCount']>0x0?_0x462c6e[_0x18152e(0x1c7)]/_0x462c6e[_0x18152e(0x1ad)]:0x0,delete _0x462c6e[_0x18152e(0x1c7)];}),Object['values'](_0x234a0b)[_0x434350(0x1a9)](_0x1307b2=>{const _0x43ce88=_0x434350;_0x1307b2[_0x43ce88(0x251)]=_0x1307b2['paymentsCount']>0x0?_0x1307b2[_0x43ce88(0x289)]/_0x1307b2['paymentsCount']:0x0;});let _0x322f71=0x0,_0x5042ff=0x0;if(_0x1f24ef[_0x434350(0x1af)]){const _0x5efde4=await database_1['default'][_0x434350(0x1d3)][_0x434350(0x263)]({'where':{'shopId':_0x1f24ef['shopId'],'status':_0x434350(0x176),'createdAt':{'gte':_0x1c851c,'lte':_0x16de69}},'select':{'amount':!![]}});_0x322f71=_0x5efde4[_0x434350(0x1b6)]((_0x49da34,_0x5e06f8)=>_0x49da34+_0x5e06f8[_0x434350(0x29a)],0x0);const _0x5c0a33=await database_1[_0x434350(0x264)]['payout']['findMany']({'where':{'shopId':_0x1f24ef['shopId'],'status':_0x434350(0x236),'createdAt':{'gte':_0x1c851c,'lte':_0x16de69}},'select':{'amount':!![]}});_0x5042ff=_0x5c0a33['reduce']((_0x20b20a,_0x1eb14f)=>_0x20b20a+_0x1eb14f[_0x434350(0x29a)],0x0);}const _0x4de6dd=_0x1cfa1b,_0x24a09c=_0x161ef0[_0x434350(0x296)],_0x5e4599=_0x24a09c>0x0?_0x485303/_0x24a09c:0x0,_0x83df36=_0x4de6dd>0x0?Math[_0x434350(0x2ae)](_0x24a09c/_0x4de6dd*0x2710)/0x64:0x0,_0x344f12=Math[_0x434350(0x1f1)]((_0x16de69[_0x434350(0x1f6)]()-_0x1c851c['getTime']())/(0x3e8*0x3c*0x3c*0x18)),_0x1e7eee={'totalTurnover':Math[_0x434350(0x2ae)](_0x485303*0x64)/0x64,'merchantEarnings':Math[_0x434350(0x2ae)](_0x1025ed*0x64)/0x64,'gatewayEarnings':Math[_0x434350(0x2ae)](_0xe34155*0x64)/0x64,'totalPaidOut':Math[_0x434350(0x2ae)](_0x322f71*0x64)/0x64,'pendingPayout':Math['round'](_0x5042ff*0x64)/0x64,'averageCheck':Math[_0x434350(0x2ae)](_0x5e4599*0x64)/0x64,'totalPayments':_0x4de6dd,'successfulPayments':_0x24a09c,'conversionRate':_0x83df36,'gatewayBreakdown':Object[_0x434350(0x1f2)](_0x380db2)['map'](_0x1763bc=>({..._0x1763bc,'turnoverUSDT':Math[_0x434350(0x2ae)](_0x1763bc[_0x434350(0x289)]*0x64)/0x64,'commissionUSDT':Math[_0x434350(0x2ae)](_0x1763bc[_0x434350(0x237)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x434350(0x2ae)](_0x1763bc[_0x434350(0x255)]*0x64)/0x64,'averageCommissionRate':Math[_0x434350(0x2ae)](_0x1763bc['averageCommissionRate']*0x64)/0x64})),'merchantBreakdown':_0x1f24ef[_0x434350(0x1af)]?undefined:Object['values'](_0x234a0b)[_0x434350(0x1e6)](_0xea4499=>({..._0xea4499,'turnoverUSDT':Math[_0x434350(0x2ae)](_0xea4499[_0x434350(0x289)]*0x64)/0x64,'commissionUSDT':Math[_0x434350(0x2ae)](_0xea4499[_0x434350(0x237)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x434350(0x2ae)](_0xea4499[_0x434350(0x255)]*0x64)/0x64,'paidOutUSDT':Math[_0x434350(0x2ae)](_0xea4499[_0x434350(0x168)]*0x64)/0x64,'averageCheckUSDT':Math[_0x434350(0x2ae)](_0xea4499[_0x434350(0x251)]*0x64)/0x64})),'dailyData':Object[_0x434350(0x1f2)](_0x281e2f)['map'](_0x39b2dc=>({..._0x39b2dc,'turnover':Math['round'](_0x39b2dc[_0x434350(0x173)]*0x64)/0x64,'merchantEarnings':Math['round'](_0x39b2dc[_0x434350(0x1a5)]*0x64)/0x64,'gatewayEarnings':Math[_0x434350(0x2ae)](_0x39b2dc[_0x434350(0x1b7)]*0x64)/0x64}))[_0x434350(0x29c)]((_0x58dc97,_0x47abc8)=>_0x58dc97[_0x434350(0x1b0)]['localeCompare'](_0x47abc8['date'])),'periodInfo':{'from':_0x1c851c,'to':_0x16de69,'periodType':_0x1f24ef[_0x434350(0x1f5)]||_0x434350(0x2b3),'daysCount':_0x344f12}};return console[_0x434350(0x1d6)](_0x434350(0x19a)),console[_0x434350(0x1d6)](_0x434350(0x27a)+_0x1e7eee['totalTurnover']+_0x434350(0x280)),console['log'](_0x434350(0x229)+_0x1e7eee[_0x434350(0x1a5)]+_0x434350(0x280)),console[_0x434350(0x1d6)](_0x434350(0x222)+_0x1e7eee['gatewayEarnings']+_0x434350(0x280)),console[_0x434350(0x1d6)]('\x20\x20\x20�\x20Total\x20paid\x20out:\x20'+_0x1e7eee['totalPaidOut']+_0x434350(0x280)),console[_0x434350(0x1d6)]('\x20\x20\x20⏳\x20Pending\x20payout:\x20'+_0x1e7eee[_0x434350(0x25e)]+_0x434350(0x280)),console['log']('\x20\x20\x20�📊\x20Total\x20payments:\x20'+_0x1e7eee[_0x434350(0x273)]),_0x1e7eee;}async[a38_0x30ac33(0x1c0)](){const _0x5cee44=a38_0x30ac33;console[_0x5cee44(0x1d6)](_0x5cee44(0x1d9));const _0x2dfc08=await database_1[_0x5cee44(0x264)][_0x5cee44(0x1fd)][_0x5cee44(0x263)]({'where':{'status':_0x5cee44(0x27c)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x5cee44(0x21b)}});return console['log'](_0x5cee44(0x245)+_0x2dfc08['length']+'\x20active\x20merchants\x20for\x20selection'),_0x2dfc08[_0x5cee44(0x1e6)](_0x677335=>({'id':_0x677335['id'],'username':_0x677335[_0x5cee44(0x1db)],'name':_0x677335[_0x5cee44(0x2b4)]}));}[a38_0x30ac33(0x195)](_0x1396e0){const _0x2d9ab7=a38_0x30ac33,_0x36d340={'test_gateway':'Test\x20Gateway','plisio':_0x2d9ab7(0x1a7),'rapyd':_0x2d9ab7(0x248),'noda':_0x2d9ab7(0x19c),'cointopay':_0x2d9ab7(0x2b9),'cointopay2':_0x2d9ab7(0x28d),'klyme_eu':_0x2d9ab7(0x228),'klyme_gb':_0x2d9ab7(0x238),'klyme_de':_0x2d9ab7(0x29d),'mastercard':_0x2d9ab7(0x253)};return _0x36d340[_0x1396e0]||_0x1396e0;}[a38_0x30ac33(0x17b)](_0x5c371c){const _0x17a61e=a38_0x30ac33,_0x56bdf9={'Test\x20Gateway':'test_gateway','Plisio':_0x17a61e(0x239),'Rapyd':'rapyd','Noda':_0x17a61e(0x283),'CoinToPay':_0x17a61e(0x1d1),'CoinToPay2':_0x17a61e(0x185),'KLYME\x20EU':_0x17a61e(0x1ef),'KLYME\x20GB':_0x17a61e(0x1cd),'KLYME\x20DE':_0x17a61e(0x223),'MasterCard':_0x17a61e(0x1f4)};return _0x56bdf9[_0x5c371c]||_0x5c371c[_0x17a61e(0x210)]();}async[a38_0x30ac33(0x275)](_0x1cca9b){const _0x419926=a38_0x30ac33,{page:_0x3256ad,limit:_0x252486,minAmount:_0x51efdf,search:_0x6c9731}=_0x1cca9b,_0x250953=(_0x3256ad-0x1)*_0x252486;console[_0x419926(0x1d6)](_0x419926(0x17f),_0x1cca9b);const _0x323d5f={'balance':{'gt':0x0},'status':_0x419926(0x27c)};_0x51efdf&&(_0x323d5f['balance'][_0x419926(0x25d)]=_0x51efdf);_0x6c9731&&(_0x323d5f[_0x419926(0x2b4)]={'contains':_0x6c9731,'mode':_0x419926(0x224)});const [_0xefe67,_0x12015b]=await Promise[_0x419926(0x2ac)]([database_1[_0x419926(0x264)][_0x419926(0x1fd)][_0x419926(0x263)]({'where':_0x323d5f,'skip':_0x250953,'take':_0x252486,'orderBy':{'balance':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1['default'][_0x419926(0x1fd)]['count']({'where':_0x323d5f})]);console[_0x419926(0x1d6)](_0x419926(0x269)+_0xefe67[_0x419926(0x296)]+_0x419926(0x25a));const _0xf66a4e=await Promise[_0x419926(0x2ac)](_0xefe67[_0x419926(0x1e6)](async _0x1efb91=>{const _0x1ef50a=_0x419926,[_0x5890bb,_0x12ad20,_0x1c91e4]=await Promise[_0x1ef50a(0x2ac)]([database_1[_0x1ef50a(0x264)][_0x1ef50a(0x24c)][_0x1ef50a(0x1a4)]({'where':{'shopId':_0x1efb91['id'],'status':_0x1ef50a(0x1d2),'gateway':{'not':_0x1ef50a(0x21f)}}}),database_1[_0x1ef50a(0x264)][_0x1ef50a(0x24c)][_0x1ef50a(0x19f)]({'where':{'shopId':_0x1efb91['id'],'status':_0x1ef50a(0x1d2),'gateway':{'not':_0x1ef50a(0x21f)}},'orderBy':{'paidAt':'asc'},'select':{'paidAt':!![]}}),database_1[_0x1ef50a(0x264)][_0x1ef50a(0x24c)][_0x1ef50a(0x1ec)]({'by':[_0x1ef50a(0x190)],'where':{'shopId':_0x1efb91['id'],'status':_0x1ef50a(0x1d2),'gateway':{'not':_0x1ef50a(0x21f)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x3193b8=new Date(),_0x1808b8=new Date(_0x3193b8[_0x1ef50a(0x2ab)](),_0x3193b8[_0x1ef50a(0x1f8)](),0x1),_0x2a099d=new Date(_0x3193b8[_0x1ef50a(0x2ab)](),_0x3193b8['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x3e2f73,_0x4b46a9]=await Promise[_0x1ef50a(0x2ac)]([database_1[_0x1ef50a(0x264)][_0x1ef50a(0x1d3)][_0x1ef50a(0x235)]({'_sum':{'amount':!![]},'where':{'shopId':_0x1efb91['id'],'status':'COMPLETED'}}),database_1['default'][_0x1ef50a(0x1d3)][_0x1ef50a(0x235)]({'_sum':{'amount':!![]},'where':{'shopId':_0x1efb91['id'],'status':_0x1ef50a(0x176),'createdAt':{'gte':_0x1808b8,'lte':_0x2a099d}}})]),_0x3f9984=_0x3e2f73[_0x1ef50a(0x202)]['amount']||0x0,_0xf49255=_0x4b46a9[_0x1ef50a(0x202)][_0x1ef50a(0x29a)]||0x0,_0x195e1a=await Promise[_0x1ef50a(0x2ac)](_0x1c91e4[_0x1ef50a(0x1e6)](async _0x229baa=>{const _0x4fe0cd=_0x1ef50a;let _0xe373b1=0x2d;if(_0x1efb91[_0x4fe0cd(0x205)])try{const _0x474fd6=JSON[_0x4fe0cd(0x298)](_0x1efb91[_0x4fe0cd(0x205)]);for(const [_0x4250e5,_0x2567d9]of Object[_0x4fe0cd(0x1cb)](_0x474fd6)){if(_0x4250e5[_0x4fe0cd(0x210)]()===_0x229baa[_0x4fe0cd(0x190)]['toLowerCase']()){_0xe373b1=_0x2567d9[_0x4fe0cd(0x1fa)]||0xa,console[_0x4fe0cd(0x1d6)](_0x4fe0cd(0x2aa)+_0x229baa[_0x4fe0cd(0x190)]+_0x4fe0cd(0x2bc)+_0x1efb91['id']+_0x4fe0cd(0x2a7)+_0xe373b1+'%');break;}}}catch(_0x15328d){console['error']('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x1efb91['id']+':',_0x15328d);}const _0x51d49d=_0x229baa[_0x4fe0cd(0x202)]?.['amountUSDT']||0x0,_0x1a9a5b=_0x51d49d*(0x1-_0xe373b1/0x64);return{'gateway':_0x229baa[_0x4fe0cd(0x190)],'count':_0x229baa[_0x4fe0cd(0x1e7)]?.['id']||0x0,'amountUSDT':Math[_0x4fe0cd(0x2ae)](_0x51d49d*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x4fe0cd(0x2ae)](_0x1a9a5b*0x64)/0x64,'commission':_0xe373b1};})),_0xd340cc=_0x195e1a[_0x1ef50a(0x1b6)]((_0x5be48c,_0x574c16)=>_0x5be48c+_0x574c16[_0x1ef50a(0x288)],0x0),_0x394abe=_0x195e1a['reduce']((_0x25848a,_0x356a77)=>_0x25848a+_0x356a77[_0x1ef50a(0x231)],0x0),_0x12369e=_0x1efb91['balance'];return console['log'](_0x1ef50a(0x225)+_0x1efb91[_0x1ef50a(0x1db)]+':'),console[_0x1ef50a(0x1d6)](_0x1ef50a(0x2a6)+_0xd340cc[_0x1ef50a(0x1ab)](0x2)+_0x1ef50a(0x1e9)),console[_0x1ef50a(0x1d6)](_0x1ef50a(0x1ac)+_0x394abe['toFixed'](0x2)+'\x20USDT\x20(theoretical\x20net)'),console[_0x1ef50a(0x1d6)](_0x1ef50a(0x1ce)+_0x12369e[_0x1ef50a(0x1ab)](0x2)+_0x1ef50a(0x24b)),console['log'](_0x1ef50a(0x29e)+_0x3f9984[_0x1ef50a(0x1ab)](0x2)+_0x1ef50a(0x257)),console[_0x1ef50a(0x1d6)](_0x1ef50a(0x1da)+(_0x394abe-_0x3f9984-_0x12369e)[_0x1ef50a(0x1ab)](0x2)+_0x1ef50a(0x25c)),{'id':_0x1efb91['id'],'fullName':_0x1efb91[_0x1ef50a(0x2b4)],'username':_0x1efb91[_0x1ef50a(0x1db)],'telegramId':_0x1efb91[_0x1ef50a(0x219)],'merchantUrl':_0x1efb91['shopUrl'],'wallets':{'usdtPolygonWallet':_0x1efb91[_0x1ef50a(0x16f)],'usdtTrcWallet':_0x1efb91[_0x1ef50a(0x1c6)],'usdtErcWallet':_0x1efb91[_0x1ef50a(0x198)],'usdcPolygonWallet':_0x1efb91[_0x1ef50a(0x1ba)],'usdcErcWallet':_0x1efb91[_0x1ef50a(0x218)]},'totalAmountUSDT':Math[_0x1ef50a(0x2ae)](_0xd340cc*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x1ef50a(0x2ae)](_0x394abe*0x64)/0x64,'currentBalance':Math[_0x1ef50a(0x2ae)](_0x12369e*0x64)/0x64,'totalPayout':Math[_0x1ef50a(0x2ae)](_0x3f9984*0x64)/0x64,'thisMonth':Math[_0x1ef50a(0x2ae)](_0xf49255*0x64)/0x64,'paymentsCount':_0x5890bb,'oldestPaymentDate':_0x12ad20?.[_0x1ef50a(0x28e)]||_0x1efb91[_0x1ef50a(0x1a6)],'gatewayBreakdown':_0x195e1a};})),_0x14a00e=_0xf66a4e[_0x419926(0x1b6)]((_0x2e65e3,_0x1e561f)=>_0x2e65e3+_0x1e561f[_0x419926(0x1eb)],0x0),_0x22d9b8=_0xf66a4e[_0x419926(0x1b6)]((_0x368026,_0x4dd70a)=>_0x368026+_0x4dd70a[_0x419926(0x1e4)],0x0),_0x19fa0f=_0xf66a4e['reduce']((_0x343768,_0x2703aa)=>_0x343768+_0x2703aa['totalPayout'],0x0),_0x25ffad=_0xf66a4e[_0x419926(0x1b6)]((_0x39c851,_0x33c19a)=>_0x39c851+_0x33c19a['thisMonth'],0x0);return console[_0x419926(0x1d6)](_0x419926(0x256)+_0x12015b+_0x419926(0x26e)),console[_0x419926(0x1d6)](_0x419926(0x22b)+Math['round'](_0x14a00e*0x64)/0x64+_0x419926(0x1e9)),console[_0x419926(0x1d6)]('\x20\x20\x20✅\x20Total\x20available\x20for\x20payout:\x20'+Math['round'](_0x22d9b8*0x64)/0x64+_0x419926(0x1a1)),console[_0x419926(0x1d6)](_0x419926(0x24e)+Math[_0x419926(0x2ae)](_0x19fa0f*0x64)/0x64+'\x20USDT'),console['log'](_0x419926(0x1b1)+Math['round'](_0x25ffad*0x64)/0x64+_0x419926(0x280)),{'merchants':_0xf66a4e,'pagination':{'page':_0x3256ad,'limit':_0x252486,'total':_0x12015b,'totalPages':Math[_0x419926(0x1f1)](_0x12015b/_0x252486)},'summary':{'totalMerchants':_0x12015b,'totalAmountUSDT':Math[_0x419926(0x2ae)](_0x14a00e*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x419926(0x2ae)](_0x22d9b8*0x64)/0x64,'totalPayout':Math[_0x419926(0x2ae)](_0x19fa0f*0x64)/0x64,'thisMonth':Math['round'](_0x25ffad*0x64)/0x64}};}async[a38_0x30ac33(0x1e0)](_0x222db9){const _0x2324d8=a38_0x30ac33,{shopId:_0x3e14e4,amount:_0x50069b,network:_0x4f2d7a,wallet:_0x394036,notes:_0x238bbd,txid:_0x5f4852,periodFrom:_0x17a67d,periodTo:_0x6aa6b6}=_0x222db9,_0x2f897a=await database_1[_0x2324d8(0x264)]['$transaction'](async _0x2adf97=>{const _0x3af3aa=_0x2324d8,_0x31f63a=await _0x2adf97[_0x3af3aa(0x1fd)][_0x3af3aa(0x169)]({'where':{'id':_0x3e14e4},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x31f63a)throw new Error(_0x3af3aa(0x1cc));console[_0x3af3aa(0x1d6)](_0x3af3aa(0x2a8)+_0x31f63a[_0x3af3aa(0x1db)]+':'),console[_0x3af3aa(0x1d6)](_0x3af3aa(0x249)+_0x31f63a[_0x3af3aa(0x178)][_0x3af3aa(0x1ab)](0x6)+_0x3af3aa(0x280)),console[_0x3af3aa(0x1d6)](_0x3af3aa(0x1b9)+_0x50069b['toFixed'](0x6)+_0x3af3aa(0x280)),console['log']('\x20\x20\x20Current\x20total\x20paid\x20out:\x20'+_0x31f63a[_0x3af3aa(0x250)]['toFixed'](0x6)+_0x3af3aa(0x280));if(_0x5f4852)console[_0x3af3aa(0x1d6)](_0x3af3aa(0x234)+_0x5f4852);if(_0x31f63a[_0x3af3aa(0x178)]<_0x50069b)throw new Error(_0x3af3aa(0x278)+_0x31f63a[_0x3af3aa(0x178)][_0x3af3aa(0x1ab)](0x6)+_0x3af3aa(0x204)+_0x50069b[_0x3af3aa(0x1ab)](0x6)+'\x20USDT');let _0x141b85=_0x394036;if(!_0x141b85){const _0x5294eb=await _0x2adf97[_0x3af3aa(0x1fd)]['findUnique']({'where':{'id':_0x3e14e4},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});if(_0x5294eb)switch(_0x4f2d7a){case _0x3af3aa(0x21c):_0x141b85=_0x5294eb[_0x3af3aa(0x16f)]||undefined;break;case _0x3af3aa(0x211):_0x141b85=_0x5294eb[_0x3af3aa(0x1c6)]||undefined;break;case _0x3af3aa(0x27e):_0x141b85=_0x5294eb[_0x3af3aa(0x198)]||undefined;break;case _0x3af3aa(0x2b2):_0x141b85=_0x5294eb[_0x3af3aa(0x1ba)]||undefined;break;case _0x3af3aa(0x179):_0x141b85=_0x5294eb[_0x3af3aa(0x218)]||undefined;break;}}console['log'](_0x3af3aa(0x244)+_0x4f2d7a+':\x20'+(_0x141b85||'not\x20specified'));const _0xacc8eb=await _0x2adf97[_0x3af3aa(0x1d3)][_0x3af3aa(0x1cf)]({'data':{'shopId':_0x3e14e4,'amount':_0x50069b,'network':_0x4f2d7a,'status':_0x3af3aa(0x176),'txid':_0x5f4852,'notes':_0x238bbd,'periodFrom':_0x17a67d?new Date(_0x17a67d):null,'periodTo':_0x6aa6b6?new Date(_0x6aa6b6):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x310a69=_0x31f63a['balance']-_0x50069b,_0x4058f0=_0x31f63a[_0x3af3aa(0x250)]+_0x50069b;return await _0x2adf97[_0x3af3aa(0x1fd)][_0x3af3aa(0x1be)]({'where':{'id':_0x3e14e4},'data':{'balance':_0x310a69,'totalPaidOut':_0x4058f0}}),console['log']('💰\x20Shop\x20'+_0x31f63a[_0x3af3aa(0x1db)]+_0x3af3aa(0x1c1)),console['log'](_0x3af3aa(0x1dc)+_0x31f63a[_0x3af3aa(0x178)]['toFixed'](0x6)+_0x3af3aa(0x1fc)+_0x310a69[_0x3af3aa(0x1ab)](0x6)+'\x20USDT\x20(-'+_0x50069b['toFixed'](0x6)+')'),console['log'](_0x3af3aa(0x287)+_0x31f63a['totalPaidOut'][_0x3af3aa(0x1ab)](0x6)+_0x3af3aa(0x1fc)+_0x4058f0[_0x3af3aa(0x1ab)](0x6)+'\x20USDT\x20(+'+_0x50069b[_0x3af3aa(0x1ab)](0x6)+')'),{'payout':_0xacc8eb,'shop':_0x31f63a};});return console[_0x2324d8(0x1d6)]('✅\x20Payout\x20created:\x20'+_0x2f897a['payout']['id']+_0x2324d8(0x2bc)+_0x2f897a[_0x2324d8(0x1fd)][_0x2324d8(0x1db)]+'\x20('+_0x50069b+_0x2324d8(0x18c)),{'id':_0x2f897a[_0x2324d8(0x1d3)]['id'],'shopId':_0x2f897a[_0x2324d8(0x1d3)][_0x2324d8(0x1af)],'shopName':_0x2f897a[_0x2324d8(0x1fd)]['name'],'shopUsername':_0x2f897a[_0x2324d8(0x1fd)][_0x2324d8(0x1db)],'amount':_0x2f897a['payout']['amount'],'network':_0x2f897a['payout']['network'],'status':_0x2f897a['payout'][_0x2324d8(0x20f)],'txid':_0x2f897a[_0x2324d8(0x1d3)][_0x2324d8(0x233)],'notes':_0x2f897a[_0x2324d8(0x1d3)][_0x2324d8(0x16e)],'periodFrom':_0x2f897a[_0x2324d8(0x1d3)][_0x2324d8(0x21a)],'periodTo':_0x2f897a[_0x2324d8(0x1d3)]['periodTo'],'createdAt':_0x2f897a[_0x2324d8(0x1d3)]['createdAt'],'paidAt':_0x2f897a[_0x2324d8(0x1d3)][_0x2324d8(0x28e)]};}async[a38_0x30ac33(0x23d)](_0x1a3cd2){const _0xc2b35a=a38_0x30ac33,{page:_0x56b138,limit:_0xb1d9a,shopId:_0x37c4fd,network:_0x35ff0b,dateFrom:_0x437b81,dateTo:_0x1fdf6d,search:_0x46f62e}=_0x1a3cd2,_0x11f38e=(_0x56b138-0x1)*_0xb1d9a,_0x22c8ac={};_0x37c4fd&&(_0x22c8ac[_0xc2b35a(0x1af)]=_0x37c4fd);_0x35ff0b&&(_0x22c8ac[_0xc2b35a(0x299)]=_0x35ff0b);(_0x437b81||_0x1fdf6d)&&(_0x22c8ac[_0xc2b35a(0x1a6)]={},_0x437b81&&(_0x22c8ac[_0xc2b35a(0x1a6)][_0xc2b35a(0x25d)]=new Date(_0x437b81)),_0x1fdf6d&&(_0x22c8ac[_0xc2b35a(0x1a6)][_0xc2b35a(0x23b)]=new Date(_0x1fdf6d)));_0x46f62e&&(_0x22c8ac['OR']=[{'shop':{'name':{'contains':_0x46f62e,'mode':_0xc2b35a(0x224)}}},{'shop':{'username':{'contains':_0x46f62e,'mode':'insensitive'}}},{'notes':{'contains':_0x46f62e,'mode':'insensitive'}}]);const [_0x451068,_0x3c4bb5]=await Promise['all']([database_1[_0xc2b35a(0x264)][_0xc2b35a(0x1d3)][_0xc2b35a(0x263)]({'where':_0x22c8ac,'skip':_0x11f38e,'take':_0xb1d9a,'orderBy':{'createdAt':_0xc2b35a(0x1b4)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0xc2b35a(0x264)]['payout']['count']({'where':_0x22c8ac})]);return{'payouts':_0x451068[_0xc2b35a(0x1e6)](_0x3548e6=>({'id':_0x3548e6['id'],'shopId':_0x3548e6[_0xc2b35a(0x1af)],'shopName':_0x3548e6[_0xc2b35a(0x1fd)][_0xc2b35a(0x2b4)],'shopUsername':_0x3548e6[_0xc2b35a(0x1fd)][_0xc2b35a(0x1db)],'amount':_0x3548e6[_0xc2b35a(0x29a)],'network':_0x3548e6[_0xc2b35a(0x299)],'status':_0x3548e6[_0xc2b35a(0x20f)],'txid':_0x3548e6[_0xc2b35a(0x233)],'notes':_0x3548e6[_0xc2b35a(0x16e)],'periodFrom':_0x3548e6[_0xc2b35a(0x21a)],'periodTo':_0x3548e6[_0xc2b35a(0x267)],'createdAt':_0x3548e6[_0xc2b35a(0x1a6)],'paidAt':_0x3548e6['paidAt']})),'pagination':{'page':_0x56b138,'limit':_0xb1d9a,'total':_0x3c4bb5,'totalPages':Math[_0xc2b35a(0x1f1)](_0x3c4bb5/_0xb1d9a)}};}async[a38_0x30ac33(0x16a)](_0x42ee0d){const _0x36490a=a38_0x30ac33,_0x3ec5ad=await database_1[_0x36490a(0x264)][_0x36490a(0x1d3)]['findUnique']({'where':{'id':_0x42ee0d},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x3ec5ad)return null;return{'id':_0x3ec5ad['id'],'shopId':_0x3ec5ad[_0x36490a(0x1af)],'shopName':_0x3ec5ad[_0x36490a(0x1fd)][_0x36490a(0x2b4)],'shopUsername':_0x3ec5ad[_0x36490a(0x1fd)][_0x36490a(0x1db)],'amount':_0x3ec5ad[_0x36490a(0x29a)],'network':_0x3ec5ad[_0x36490a(0x299)],'status':_0x3ec5ad[_0x36490a(0x20f)],'txid':_0x3ec5ad[_0x36490a(0x233)],'notes':_0x3ec5ad[_0x36490a(0x16e)],'periodFrom':_0x3ec5ad[_0x36490a(0x21a)],'periodTo':_0x3ec5ad['periodTo'],'createdAt':_0x3ec5ad[_0x36490a(0x1a6)],'paidAt':_0x3ec5ad[_0x36490a(0x28e)]};}async['deletePayout'](_0x1e6745){const _0x3e5887=a38_0x30ac33;await database_1['default']['payout'][_0x3e5887(0x276)]({'where':{'id':_0x1e6745}});}async[a38_0x30ac33(0x1d0)](_0x108a0b){const _0x1f89b9=a38_0x30ac33,{page:_0x208cbd,limit:_0x18e281,status:_0x571891,gateway:_0x9d2931,shopId:_0x4fd588,dateFrom:_0x2deb17,dateTo:_0x2c4eba,search:_0x260b1b,currency:_0x210803,sortBy:_0x19a543,sortOrder:_0x156cfb}=_0x108a0b,_0x33cbf8=(_0x208cbd-0x1)*_0x18e281;console[_0x1f89b9(0x1d6)](_0x1f89b9(0x2a2),_0x108a0b);const _0x1c87ba=await database_1[_0x1f89b9(0x264)][_0x1f89b9(0x24c)][_0x1f89b9(0x1ec)]({'by':[_0x1f89b9(0x190)],'_count':{'gateway':!![]}});console[_0x1f89b9(0x1d6)](_0x1f89b9(0x240),_0x1c87ba[_0x1f89b9(0x1e6)](_0x257d37=>_0x257d37[_0x1f89b9(0x190)]+'\x20('+_0x257d37[_0x1f89b9(0x1e7)][_0x1f89b9(0x190)]+'\x20payments)'));if(_0x9d2931){const _0x33e99a=_0x1c87ba[_0x1f89b9(0x20e)](_0x3a5821=>_0x3a5821[_0x1f89b9(0x190)][_0x1f89b9(0x210)]()===_0x9d2931[_0x1f89b9(0x210)]());!_0x33e99a&&_0x9d2931[_0x1f89b9(0x210)]()!==_0x1f89b9(0x21f)&&console['log'](_0x1f89b9(0x18e)+_0x9d2931+_0x1f89b9(0x1aa)+_0x1c87ba[_0x1f89b9(0x1e6)](_0x2e5708=>_0x2e5708['gateway'])[_0x1f89b9(0x1a8)](',\x20'));}const _0x1d21ee={};_0x571891&&(_0x1d21ee['status']=_0x571891[_0x1f89b9(0x258)]());if(!_0x9d2931)_0x1d21ee[_0x1f89b9(0x190)]={'not':_0x1f89b9(0x21f)};else{if(_0x9d2931&&(_0x9d2931[_0x1f89b9(0x210)]()===_0x1f89b9(0x21f)||_0x9d2931===_0x1f89b9(0x297)))_0x1d21ee[_0x1f89b9(0x190)]='test_gateway';else{let _0x243e5b=_0x9d2931;const _0x5881a1=(0x0,gateway_1[_0x1f89b9(0x23f)])(_0x9d2931);if(_0x5881a1)_0x243e5b=_0x5881a1,console[_0x1f89b9(0x1d6)](_0x1f89b9(0x226)+_0x9d2931+_0x1f89b9(0x24f)+_0x243e5b+'\x27');else{const _0x50b6ec=(0x0,gateway_1[_0x1f89b9(0x1d5)])(_0x9d2931);if(_0x50b6ec){const _0xb9b76c=(0x0,gateway_1['getGatewayNameById'])(_0x50b6ec);_0xb9b76c&&(_0x243e5b=_0xb9b76c,console[_0x1f89b9(0x1d6)](_0x1f89b9(0x2ad)+_0x9d2931+_0x1f89b9(0x1c5)+_0x50b6ec+_0x1f89b9(0x214)+_0x243e5b+'\x27'));}else console[_0x1f89b9(0x1d6)](_0x1f89b9(0x23a)+_0x9d2931+_0x1f89b9(0x277));}const _0x27db14=await database_1[_0x1f89b9(0x264)][_0x1f89b9(0x24c)]['count']({'where':{'gateway':_0x243e5b[_0x1f89b9(0x210)]()},'take':0x1});_0x27db14===0x0?(console[_0x1f89b9(0x1d6)](_0x1f89b9(0x2a5)+_0x243e5b+_0x1f89b9(0x21e)+_0x9d2931+_0x1f89b9(0x265)),_0x1d21ee['gateway']=_0x1f89b9(0x27b)):(_0x1d21ee[_0x1f89b9(0x190)]=_0x243e5b['toLowerCase'](),console[_0x1f89b9(0x1d6)](_0x1f89b9(0x243)+_0x243e5b+_0x1f89b9(0x21e)+_0x9d2931+'\x27)'));}}console[_0x1f89b9(0x1d6)]('📊\x20Gateway\x20filter\x20applied:',_0x1d21ee[_0x1f89b9(0x190)]);_0x4fd588&&(_0x1d21ee[_0x1f89b9(0x1af)]=_0x4fd588);_0x210803&&(_0x1d21ee[_0x1f89b9(0x1a3)]=_0x210803[_0x1f89b9(0x258)](),console[_0x1f89b9(0x1d6)](_0x1f89b9(0x203)+_0x210803['toUpperCase']()));(_0x2deb17||_0x2c4eba)&&(_0x1d21ee['createdAt']={},_0x2deb17&&(_0x1d21ee[_0x1f89b9(0x1a6)]['gte']=new Date(_0x2deb17)),_0x2c4eba&&(_0x1d21ee[_0x1f89b9(0x1a6)]['lte']=new Date(_0x2c4eba)));_0x260b1b&&(_0x1d21ee['OR']=[{'id':{'contains':_0x260b1b,'mode':_0x1f89b9(0x224)}},{'orderId':{'contains':_0x260b1b,'mode':'insensitive'}},{'gatewayOrderId':{'contains':_0x260b1b,'mode':_0x1f89b9(0x224)}},{'customerEmail':{'contains':_0x260b1b,'mode':'insensitive'}},{'shop':{'name':{'contains':_0x260b1b,'mode':_0x1f89b9(0x224)}}},{'shop':{'username':{'contains':_0x260b1b,'mode':_0x1f89b9(0x224)}}}]);console[_0x1f89b9(0x1d6)]('📊\x20Final\x20WHERE\x20conditions:',JSON[_0x1f89b9(0x1fb)](_0x1d21ee,null,0x2));let _0x347221={'createdAt':_0x1f89b9(0x1b4)};if(_0x19a543){const _0xf2c56e=[_0x1f89b9(0x29a),_0x1f89b9(0x1a6),_0x1f89b9(0x175),_0x1f89b9(0x20f),_0x1f89b9(0x190),_0x1f89b9(0x1a3)],_0x47d2c5=[_0x1f89b9(0x21b),_0x1f89b9(0x1b4)];if(_0xf2c56e['includes'](_0x19a543)){const _0x1083e1=_0x47d2c5[_0x1f89b9(0x294)](_0x156cfb)?_0x156cfb:_0x1f89b9(0x1b4);_0x347221={[_0x19a543]:_0x1083e1},console[_0x1f89b9(0x1d6)]('📊\x20Sorting\x20payments\x20by\x20'+_0x19a543+_0x1f89b9(0x1ea)+_0x1083e1+'\x20order');}}const [_0x494919,_0x10aa53]=await Promise[_0x1f89b9(0x2ac)]([database_1[_0x1f89b9(0x264)]['payment']['findMany']({'where':_0x1d21ee,'skip':_0x33cbf8,'take':_0x18e281,'orderBy':_0x347221,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x1f89b9(0x264)][_0x1f89b9(0x24c)][_0x1f89b9(0x1a4)]({'where':_0x1d21ee})]);return{'payments':_0x494919,'pagination':{'page':_0x208cbd,'limit':_0x18e281,'total':_0x10aa53,'totalPages':Math[_0x1f89b9(0x1f1)](_0x10aa53/_0x18e281)}};}async[a38_0x30ac33(0x28c)](_0x5e372d){const _0x144ada=a38_0x30ac33,_0x2d77d5=await database_1['default'][_0x144ada(0x24c)]['findUnique']({'where':{'id':_0x5e372d},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x2d77d5)return null;return{'id':_0x2d77d5['id'],'shopId':_0x2d77d5[_0x144ada(0x1af)],'gateway':_0x2d77d5[_0x144ada(0x190)],'amount':_0x2d77d5[_0x144ada(0x29a)],'currency':_0x2d77d5[_0x144ada(0x1a3)],'status':_0x2d77d5[_0x144ada(0x20f)],'orderId':_0x2d77d5[_0x144ada(0x241)],'gatewayOrderId':_0x2d77d5['gatewayOrderId'],'customerEmail':_0x2d77d5[_0x144ada(0x2b8)],'customerName':_0x2d77d5['customerName'],'customerCountry':_0x2d77d5[_0x144ada(0x247)],'customerIp':_0x2d77d5[_0x144ada(0x196)],'customerUa':_0x2d77d5[_0x144ada(0x29b)],'failureMessage':_0x2d77d5['failureMessage'],'externalPaymentUrl':_0x2d77d5[_0x144ada(0x284)],'successUrl':_0x2d77d5[_0x144ada(0x272)],'failUrl':_0x2d77d5[_0x144ada(0x2a0)],'pendingUrl':_0x2d77d5[_0x144ada(0x22a)],'whiteUrl':_0x2d77d5['whiteUrl'],'createdAt':_0x2d77d5['createdAt'],'updatedAt':_0x2d77d5[_0x144ada(0x175)],'shop':_0x2d77d5[_0x144ada(0x1fd)]};}async['updatePaymentStatus'](_0x412ed4,_0x45ea40,_0x3ccab4,_0x5253be){const _0x33947f=a38_0x30ac33,_0x5e548d=await database_1['default'][_0x33947f(0x1b5)](async _0x1eefea=>{const _0x5cd54d=_0x33947f,_0x3254ca=await _0x1eefea['payment']['findUnique']({'where':{'id':_0x412ed4},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x3254ca)throw new Error(_0x5cd54d(0x191));const _0x1e5e5b=_0x3254ca[_0x5cd54d(0x20f)],_0x40d663=_0x45ea40[_0x5cd54d(0x258)]();console[_0x5cd54d(0x1d6)](_0x5cd54d(0x1de)+_0x412ed4+_0x5cd54d(0x221)+_0x1e5e5b+'\x20->\x20'+_0x40d663),console['log'](_0x5cd54d(0x2af)+_0x3254ca[_0x5cd54d(0x1fd)]['balance']+_0x5cd54d(0x280));const _0x429285={'status':_0x40d663,'updatedAt':new Date(),'statusChangedBy':'admin','statusChangedAt':new Date()};_0x3ccab4&&(_0x429285[_0x5cd54d(0x27f)]=_0x3ccab4);_0x40d663===_0x5cd54d(0x186)&&_0x5253be&&(_0x429285[_0x5cd54d(0x232)]=_0x5253be);let _0x3b867e=0x0,_0x514536=_0x3254ca[_0x5cd54d(0x1fd)][_0x5cd54d(0x178)];if(_0x40d663===_0x5cd54d(0x1d2)&&_0x1e5e5b!==_0x5cd54d(0x1d2)){_0x429285['paidAt']=new Date();const _0x4920a2=await currencyService_1['currencyService'][_0x5cd54d(0x213)](_0x3254ca['amount'],_0x3254ca['currency']);_0x429285[_0x5cd54d(0x288)]=_0x4920a2;let _0x45b05f=0x2d;const _0x5c426c=await _0x1eefea[_0x5cd54d(0x1fd)][_0x5cd54d(0x169)]({'where':{'id':_0x3254ca['shopId']},'select':{'gatewaySettings':!![]}});if(_0x5c426c?.[_0x5cd54d(0x205)])try{const _0x344fe2=JSON['parse'](_0x5c426c[_0x5cd54d(0x205)]);for(const [_0x4a541a,_0x517be6]of Object['entries'](_0x344fe2)){if(_0x4a541a['toLowerCase']()===_0x3254ca['gateway'][_0x5cd54d(0x210)]()){_0x45b05f=_0x517be6[_0x5cd54d(0x1fa)]||0xa;break;}}}catch(_0x390f27){console['error'](_0x5cd54d(0x1a0)+_0x412ed4+':',_0x390f27);}let _0x4c4416;_0x3254ca[_0x5cd54d(0x1e2)]!==null&&_0x3254ca[_0x5cd54d(0x1e2)]!==undefined?(_0x4c4416=_0x3254ca[_0x5cd54d(0x1e2)],console[_0x5cd54d(0x1d6)](_0x5cd54d(0x20c)+_0x4c4416['toFixed'](0x6)+'\x20USDT\x20for\x20payment\x20'+_0x412ed4)):(_0x4c4416=_0x4920a2*(0x1-_0x45b05f/0x64),console['log'](_0x5cd54d(0x242)+_0x412ed4+':\x20'+_0x45b05f+_0x5cd54d(0x1ff)+_0x4920a2[_0x5cd54d(0x1ab)](0x6)+_0x5cd54d(0x280)),_0x429285[_0x5cd54d(0x1e2)]=_0x4c4416,_0x429285[_0x5cd54d(0x261)]=_0x45b05f),_0x3b867e=_0x4c4416,_0x514536+=_0x4c4416,console['log']('💰\x20Payment\x20'+_0x412ed4+_0x5cd54d(0x291)),console[_0x5cd54d(0x1d6)](_0x5cd54d(0x295)+_0x4920a2[_0x5cd54d(0x1ab)](0x6)+_0x5cd54d(0x280)),console[_0x5cd54d(0x1d6)]('\x20\x20\x20Gateway:\x20'+_0x3254ca[_0x5cd54d(0x190)]+',\x20Commission:\x20'+_0x45b05f+'%'),console[_0x5cd54d(0x1d6)](_0x5cd54d(0x262)+_0x4c4416[_0x5cd54d(0x1ab)](0x6)+_0x5cd54d(0x19d)+_0x45b05f+_0x5cd54d(0x285)),console[_0x5cd54d(0x1d6)](_0x5cd54d(0x28a)+_0x4c4416[_0x5cd54d(0x1ab)](0x6)+_0x5cd54d(0x280));}else{if(_0x1e5e5b===_0x5cd54d(0x1d2)&&_0x40d663!==_0x5cd54d(0x1d2)){if(_0x3254ca[_0x5cd54d(0x288)]){let _0x201bdd=0x2d;const _0x463b36=await _0x1eefea[_0x5cd54d(0x1fd)][_0x5cd54d(0x169)]({'where':{'id':_0x3254ca['shopId']},'select':{'gatewaySettings':!![]}});if(_0x463b36?.[_0x5cd54d(0x205)])try{const _0x36973b=JSON[_0x5cd54d(0x298)](_0x463b36[_0x5cd54d(0x205)]);for(const [_0x3eaf3b,_0x4dd536]of Object[_0x5cd54d(0x1cb)](_0x36973b)){if(_0x3eaf3b[_0x5cd54d(0x210)]()===_0x3254ca[_0x5cd54d(0x190)][_0x5cd54d(0x210)]()){_0x201bdd=_0x4dd536['commission']||0xa;break;}}}catch(_0x1e1978){console[_0x5cd54d(0x1f0)]('Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20'+_0x412ed4+':',_0x1e1978);}const _0x55b9e1=_0x3254ca[_0x5cd54d(0x288)]*(0x1-_0x201bdd/0x64);_0x3b867e=-_0x55b9e1,_0x514536-=_0x55b9e1,_0x429285[_0x5cd54d(0x288)]=null,_0x429285[_0x5cd54d(0x1e2)]=null,console[_0x5cd54d(0x1d6)](_0x5cd54d(0x1f3)+_0x412ed4+'\x20no\x20longer\x20PAID:'),console[_0x5cd54d(0x1d6)](_0x5cd54d(0x295)+_0x3254ca[_0x5cd54d(0x288)]['toFixed'](0x6)+_0x5cd54d(0x280)),console[_0x5cd54d(0x1d6)](_0x5cd54d(0x1bf)+_0x3254ca[_0x5cd54d(0x190)]+_0x5cd54d(0x18f)+_0x201bdd+'%'),console[_0x5cd54d(0x1d6)](_0x5cd54d(0x180)+_0x55b9e1['toFixed'](0x6)+_0x5cd54d(0x19d)+_0x201bdd+_0x5cd54d(0x285)),console['log'](_0x5cd54d(0x19b)+_0x55b9e1[_0x5cd54d(0x1ab)](0x6)+'\x20USDT');}}}_0x40d663===_0x5cd54d(0x186)&&(_0x1e5e5b===_0x5cd54d(0x1d2)&&_0x3254ca['amountUSDT']&&console[_0x5cd54d(0x1d6)]('💸\x20CHARGEBACK:\x20Merchant\x20amount\x20already\x20deducted\x20from\x20balance'),_0x5253be&&_0x5253be>0x0&&(_0x3b867e-=_0x5253be,_0x514536-=_0x5253be,console['log'](_0x5cd54d(0x200)+_0x5253be[_0x5cd54d(0x1ab)](0x6)+_0x5cd54d(0x271))));_0x40d663===_0x5cd54d(0x2a1)&&_0x1e5e5b===_0x5cd54d(0x1d2)&&console[_0x5cd54d(0x1d6)](_0x5cd54d(0x1e3));const _0x2e603a=await _0x1eefea[_0x5cd54d(0x24c)][_0x5cd54d(0x1be)]({'where':{'id':_0x412ed4},'data':_0x429285,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x3b867e!==0x0&&(await _0x1eefea[_0x5cd54d(0x1fd)][_0x5cd54d(0x1be)]({'where':{'id':_0x3254ca[_0x5cd54d(0x1af)]},'data':{'balance':_0x514536}}),console[_0x5cd54d(0x1d6)](_0x5cd54d(0x1b2)+_0x3254ca[_0x5cd54d(0x1af)]+_0x5cd54d(0x215)+_0x3254ca[_0x5cd54d(0x1fd)][_0x5cd54d(0x178)][_0x5cd54d(0x1ab)](0x6)+_0x5cd54d(0x1fc)+_0x514536[_0x5cd54d(0x1ab)](0x6)+_0x5cd54d(0x24d)+(_0x3b867e>0x0?'+':'')+_0x3b867e[_0x5cd54d(0x1ab)](0x6)+')')),_0x2e603a;});return{'id':_0x5e548d['id'],'shopId':_0x5e548d['shopId'],'gateway':_0x5e548d[_0x33947f(0x190)],'amount':_0x5e548d['amount'],'currency':_0x5e548d['currency'],'status':_0x5e548d[_0x33947f(0x20f)],'orderId':_0x5e548d[_0x33947f(0x241)],'gatewayOrderId':_0x5e548d[_0x33947f(0x2b7)],'customerEmail':_0x5e548d[_0x33947f(0x2b8)],'customerName':_0x5e548d[_0x33947f(0x290)],'customerCountry':_0x5e548d['customerCountry'],'customerIp':_0x5e548d[_0x33947f(0x196)],'customerUa':_0x5e548d[_0x33947f(0x29b)],'failureMessage':_0x5e548d[_0x33947f(0x1b8)],'adminNotes':_0x5e548d[_0x33947f(0x27f)],'chargebackAmount':_0x5e548d[_0x33947f(0x232)],'statusChangedBy':_0x5e548d[_0x33947f(0x252)],'statusChangedAt':_0x5e548d[_0x33947f(0x254)],'createdAt':_0x5e548d[_0x33947f(0x1a6)],'updatedAt':_0x5e548d[_0x33947f(0x175)],'shop':_0x5e548d['shop']};}async[a38_0x30ac33(0x24a)](_0x3cc854,_0x3118af){const _0xc7d799=a38_0x30ac33,_0x19c1ef=Math[_0xc7d799(0x201)]()[_0xc7d799(0x17d)](0x24)[_0xc7d799(0x230)](0x2,0x9);console['log'](_0xc7d799(0x26f)+_0x19c1ef+_0xc7d799(0x193)+_0x3cc854);const _0x1555df={..._0x3118af};_0x3118af[_0xc7d799(0x1fe)]&&_0x3118af[_0xc7d799(0x1fe)][_0xc7d799(0x1d4)]()!==''?(console[_0xc7d799(0x1d6)](_0xc7d799(0x29f)+_0x19c1ef+_0xc7d799(0x2bd)+_0x3cc854),_0x1555df['password']=await bcryptjs_1['default'][_0xc7d799(0x17e)](_0x3118af['password'],0xc)):(console['log'](_0xc7d799(0x29f)+_0x19c1ef+']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update'),delete _0x1555df[_0xc7d799(0x1fe)]);_0x3118af[_0xc7d799(0x2a3)]&&(_0x1555df[_0xc7d799(0x2b4)]=_0x3118af[_0xc7d799(0x2a3)],delete _0x1555df[_0xc7d799(0x2a3)]);_0x3118af[_0xc7d799(0x26b)]&&(_0x1555df['telegram']=_0x3118af['telegramId'],delete _0x1555df[_0xc7d799(0x26b)]);_0x3118af['merchantUrl']&&(_0x1555df[_0xc7d799(0x2b1)]=_0x3118af[_0xc7d799(0x1bb)],delete _0x1555df[_0xc7d799(0x1bb)]);if(_0x3118af[_0xc7d799(0x268)]){const _0x57140a=_0x3118af[_0xc7d799(0x268)][_0xc7d799(0x1e6)](_0x4d7123=>this[_0xc7d799(0x17b)](_0x4d7123));console[_0xc7d799(0x1d6)]('🔄\x20Gateway\x20mapping:',_0x3118af[_0xc7d799(0x268)],'->',_0x57140a),_0x1555df[_0xc7d799(0x171)]=JSON['stringify'](_0x57140a),delete _0x1555df[_0xc7d799(0x268)];}_0x3118af['gatewaySettings']&&(console[_0xc7d799(0x1d6)](_0xc7d799(0x20a)+_0x19c1ef+']\x20Gateway\x20settings\x20before\x20saving:',_0x3118af[_0xc7d799(0x205)]),_0x1555df[_0xc7d799(0x205)]=JSON[_0xc7d799(0x1fb)](_0x3118af[_0xc7d799(0x205)]),console[_0xc7d799(0x1d6)](_0xc7d799(0x20a)+_0x19c1ef+_0xc7d799(0x199),_0x1555df[_0xc7d799(0x205)]));_0x3118af[_0xc7d799(0x260)]&&(_0x3118af[_0xc7d799(0x260)][_0xc7d799(0x16f)]!==undefined&&(_0x1555df['usdtPolygonWallet']=_0x3118af[_0xc7d799(0x260)]['usdtPolygonWallet']||null),_0x3118af[_0xc7d799(0x260)][_0xc7d799(0x1c6)]!==undefined&&(_0x1555df[_0xc7d799(0x1c6)]=_0x3118af[_0xc7d799(0x260)][_0xc7d799(0x1c6)]||null),_0x3118af[_0xc7d799(0x260)]['usdtErcWallet']!==undefined&&(_0x1555df[_0xc7d799(0x198)]=_0x3118af['wallets']['usdtErcWallet']||null),_0x3118af[_0xc7d799(0x260)][_0xc7d799(0x1ba)]!==undefined&&(_0x1555df[_0xc7d799(0x1ba)]=_0x3118af[_0xc7d799(0x260)][_0xc7d799(0x1ba)]||null),delete _0x1555df[_0xc7d799(0x260)]);const _0x2eac26=await database_1[_0xc7d799(0x264)]['shop'][_0xc7d799(0x1be)]({'where':{'id':_0x3cc854},'data':_0x1555df,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0xc7d799(0x1d6)](_0xc7d799(0x282)+_0x19c1ef+_0xc7d799(0x1c8),_0x2eac26[_0xc7d799(0x205)]),{'id':_0x2eac26['id'],'fullName':_0x2eac26[_0xc7d799(0x2b4)],'username':_0x2eac26['username'],'telegramId':_0x2eac26[_0xc7d799(0x219)],'merchantUrl':_0x2eac26[_0xc7d799(0x2b1)],'gateways':_0x2eac26['paymentGateways']?JSON[_0xc7d799(0x298)](_0x2eac26[_0xc7d799(0x171)]):null,'gatewaySettings':_0x2eac26['gatewaySettings']?JSON[_0xc7d799(0x298)](_0x2eac26[_0xc7d799(0x205)]):null,'publicKey':_0x2eac26[_0xc7d799(0x197)],'wallets':{'usdtPolygonWallet':_0x2eac26['usdtPolygonWallet'],'usdtTrcWallet':_0x2eac26[_0xc7d799(0x1c6)],'usdtErcWallet':_0x2eac26[_0xc7d799(0x198)],'usdcPolygonWallet':_0x2eac26[_0xc7d799(0x1ba)]},'status':_0x2eac26[_0xc7d799(0x20f)],'createdAt':_0x2eac26[_0xc7d799(0x1a6)]};}async[a38_0x30ac33(0x2b5)](_0x14b046){const _0x461347=a38_0x30ac33,_0x133a6e=await database_1['default'][_0x461347(0x1fd)][_0x461347(0x1be)]({'where':{'id':_0x14b046},'data':{'status':'SUSPENDED'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x133a6e['id'],'fullName':_0x133a6e[_0x461347(0x2b4)],'username':_0x133a6e[_0x461347(0x1db)],'telegramId':_0x133a6e[_0x461347(0x219)],'merchantUrl':_0x133a6e[_0x461347(0x2b1)],'gateways':_0x133a6e['paymentGateways']?JSON[_0x461347(0x298)](_0x133a6e[_0x461347(0x171)]):null,'gatewaySettings':_0x133a6e[_0x461347(0x205)]?JSON[_0x461347(0x298)](_0x133a6e[_0x461347(0x205)]):null,'publicKey':_0x133a6e[_0x461347(0x197)],'wallets':{'usdtPolygonWallet':_0x133a6e['usdtPolygonWallet'],'usdtTrcWallet':_0x133a6e['usdtTrcWallet'],'usdtErcWallet':_0x133a6e[_0x461347(0x198)],'usdcPolygonWallet':_0x133a6e['usdcPolygonWallet']},'status':_0x133a6e['status'],'createdAt':_0x133a6e[_0x461347(0x1a6)]};}async[a38_0x30ac33(0x16b)](_0x1e11f3){const _0x3bd790=a38_0x30ac33,_0xaad9d8=await database_1[_0x3bd790(0x264)][_0x3bd790(0x1fd)][_0x3bd790(0x1be)]({'where':{'id':_0x1e11f3},'data':{'status':_0x3bd790(0x27c)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0xaad9d8['id'],'fullName':_0xaad9d8['name'],'username':_0xaad9d8[_0x3bd790(0x1db)],'telegramId':_0xaad9d8[_0x3bd790(0x219)],'merchantUrl':_0xaad9d8[_0x3bd790(0x2b1)],'gateways':_0xaad9d8[_0x3bd790(0x171)]?JSON[_0x3bd790(0x298)](_0xaad9d8[_0x3bd790(0x171)]):null,'gatewaySettings':_0xaad9d8[_0x3bd790(0x205)]?JSON[_0x3bd790(0x298)](_0xaad9d8[_0x3bd790(0x205)]):null,'publicKey':_0xaad9d8[_0x3bd790(0x197)],'wallets':{'usdtPolygonWallet':_0xaad9d8[_0x3bd790(0x16f)],'usdtTrcWallet':_0xaad9d8[_0x3bd790(0x1c6)],'usdtErcWallet':_0xaad9d8['usdtErcWallet'],'usdcPolygonWallet':_0xaad9d8[_0x3bd790(0x1ba)]},'status':_0xaad9d8[_0x3bd790(0x20f)],'createdAt':_0xaad9d8[_0x3bd790(0x1a6)]};}async['getAllUsers'](_0x581314){const _0x4d62fd=a38_0x30ac33,{page:_0x3176e0,limit:_0x3b3f53,status:_0x2f7f76}=_0x581314,_0x113341=(_0x3176e0-0x1)*_0x3b3f53,_0x3caac2={};_0x2f7f76&&(_0x3caac2[_0x4d62fd(0x20f)]=_0x2f7f76['toUpperCase']());const [_0x334fbe,_0x4a0444]=await Promise[_0x4d62fd(0x2ac)]([database_1['default'][_0x4d62fd(0x1fd)]['findMany']({'where':_0x3caac2,'skip':_0x113341,'take':_0x3b3f53,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x4d62fd(0x264)][_0x4d62fd(0x1fd)][_0x4d62fd(0x1a4)]({'where':_0x3caac2})]);return{'users':_0x334fbe['map'](_0x551bf4=>{const _0x32b87b=_0x4d62fd,_0x1cea6c=_0x551bf4[_0x32b87b(0x171)]?JSON['parse'](_0x551bf4[_0x32b87b(0x171)]):null,_0x612785=_0x1cea6c?_0x1cea6c[_0x32b87b(0x1e6)](_0x199441=>this[_0x32b87b(0x195)](_0x199441)):null;return{'id':_0x551bf4['id'],'fullName':_0x551bf4[_0x32b87b(0x2b4)],'username':_0x551bf4[_0x32b87b(0x1db)],'telegramId':_0x551bf4[_0x32b87b(0x219)],'merchantUrl':_0x551bf4[_0x32b87b(0x2b1)],'gateways':_0x612785,'gatewaySettings':_0x551bf4[_0x32b87b(0x205)]?JSON[_0x32b87b(0x298)](_0x551bf4[_0x32b87b(0x205)]):null,'publicKey':_0x551bf4[_0x32b87b(0x197)],'wallets':{'usdtPolygonWallet':_0x551bf4[_0x32b87b(0x16f)],'usdtTrcWallet':_0x551bf4['usdtTrcWallet'],'usdtErcWallet':_0x551bf4[_0x32b87b(0x198)],'usdcPolygonWallet':_0x551bf4['usdcPolygonWallet']},'status':_0x551bf4['status'],'createdAt':_0x551bf4[_0x32b87b(0x1a6)]};}),'pagination':{'page':_0x3176e0,'limit':_0x3b3f53,'total':_0x4a0444,'totalPages':Math['ceil'](_0x4a0444/_0x3b3f53)}};}async[a38_0x30ac33(0x183)](_0x43e37d){const _0x4b0570=a38_0x30ac33,_0x155264=await database_1['default'][_0x4b0570(0x1fd)][_0x4b0570(0x169)]({'where':{'id':_0x43e37d},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x155264)return null;const _0x2032ac=_0x155264[_0x4b0570(0x171)]?JSON[_0x4b0570(0x298)](_0x155264[_0x4b0570(0x171)]):null,_0x23655c=_0x2032ac?_0x2032ac[_0x4b0570(0x1e6)](_0x56e1ca=>this[_0x4b0570(0x195)](_0x56e1ca)):null;return _0x2032ac&&_0x23655c&&console['log']('🔄\x20Gateway\x20mapping\x20(get):',_0x2032ac,'->',_0x23655c),{'id':_0x155264['id'],'fullName':_0x155264[_0x4b0570(0x2b4)],'username':_0x155264['username'],'telegramId':_0x155264['telegram'],'merchantUrl':_0x155264['shopUrl'],'gateways':_0x23655c,'gatewaySettings':_0x155264[_0x4b0570(0x205)]?JSON[_0x4b0570(0x298)](_0x155264[_0x4b0570(0x205)]):null,'publicKey':_0x155264[_0x4b0570(0x197)],'wallets':{'usdtPolygonWallet':_0x155264[_0x4b0570(0x16f)],'usdtTrcWallet':_0x155264['usdtTrcWallet'],'usdtErcWallet':_0x155264['usdtErcWallet'],'usdcPolygonWallet':_0x155264[_0x4b0570(0x1ba)]},'status':_0x155264[_0x4b0570(0x20f)],'createdAt':_0x155264[_0x4b0570(0x1a6)]};}async[a38_0x30ac33(0x22c)](_0x3e6f50){const _0x506b5e=a38_0x30ac33,{fullName:_0x4dedf0,username:_0x156552,password:_0x185748,telegramId:_0x237116,merchantUrl:_0x3a8486,gateways:_0xec9aff,gatewaySettings:_0x3dcd9e,wallets:_0x153ca5}=_0x3e6f50,_0x196eb0=await database_1[_0x506b5e(0x264)]['shop'][_0x506b5e(0x169)]({'where':{'username':_0x156552}});if(_0x196eb0)throw new Error('Username\x20already\x20exists');if(_0x237116){const _0x4622b1=await database_1[_0x506b5e(0x264)][_0x506b5e(0x1fd)][_0x506b5e(0x169)]({'where':{'telegram':_0x237116}});if(_0x4622b1)throw new Error(_0x506b5e(0x18b));}const _0x5c0329=await bcryptjs_1[_0x506b5e(0x264)][_0x506b5e(0x17e)](_0x185748,0xc),_0x1d3f3b=_0x506b5e(0x281)+crypto_1[_0x506b5e(0x264)][_0x506b5e(0x192)](0x20)[_0x506b5e(0x17d)](_0x506b5e(0x26d)),_0x3dcfbb=_0x506b5e(0x1e1)+crypto_1[_0x506b5e(0x264)][_0x506b5e(0x192)](0x20)[_0x506b5e(0x17d)]('hex'),_0x2178cd=_0xec9aff?_0xec9aff[_0x506b5e(0x1e6)](_0x190db7=>this[_0x506b5e(0x17b)](_0x190db7)):null;_0xec9aff&&_0x2178cd&&console[_0x506b5e(0x1d6)](_0x506b5e(0x177),_0xec9aff,'->',_0x2178cd);const _0x2ecded=await database_1[_0x506b5e(0x264)][_0x506b5e(0x1fd)][_0x506b5e(0x1cf)]({'data':{'name':_0x4dedf0,'username':_0x156552,'password':_0x5c0329,'telegram':_0x237116,'shopUrl':_0x3a8486,'paymentGateways':_0x2178cd?JSON[_0x506b5e(0x1fb)](_0x2178cd):null,'gatewaySettings':_0x3dcd9e?JSON[_0x506b5e(0x1fb)](_0x3dcd9e):null,'usdtPolygonWallet':_0x153ca5?.[_0x506b5e(0x16f)]||null,'usdtTrcWallet':_0x153ca5?.[_0x506b5e(0x1c6)]||null,'usdtErcWallet':_0x153ca5?.[_0x506b5e(0x198)]||null,'usdcPolygonWallet':_0x153ca5?.[_0x506b5e(0x1ba)]||null,'publicKey':_0x1d3f3b,'secretKey':_0x3dcfbb,'status':_0x506b5e(0x27c)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2ecded['id'],'fullName':_0x2ecded[_0x506b5e(0x2b4)],'username':_0x2ecded[_0x506b5e(0x1db)],'telegramId':_0x2ecded['telegram'],'merchantUrl':_0x2ecded[_0x506b5e(0x2b1)],'gateways':_0x2ecded['paymentGateways']?JSON[_0x506b5e(0x298)](_0x2ecded[_0x506b5e(0x171)]):null,'gatewaySettings':_0x2ecded['gatewaySettings']?JSON[_0x506b5e(0x298)](_0x2ecded[_0x506b5e(0x205)]):null,'publicKey':_0x2ecded['publicKey'],'wallets':{'usdtPolygonWallet':_0x2ecded[_0x506b5e(0x16f)],'usdtTrcWallet':_0x2ecded[_0x506b5e(0x1c6)],'usdtErcWallet':_0x2ecded['usdtErcWallet'],'usdcPolygonWallet':_0x2ecded[_0x506b5e(0x1ba)]},'status':_0x2ecded[_0x506b5e(0x20f)],'createdAt':_0x2ecded['createdAt']};}async['deleteUser'](_0x4110a2){const _0x1b8377=a38_0x30ac33;await database_1[_0x1b8377(0x264)][_0x1b8377(0x1fd)][_0x1b8377(0x276)]({'where':{'id':_0x4110a2}});}[a38_0x30ac33(0x20d)](_0x338713,_0x3f4394,_0x1163d1){const _0x2b8636=a38_0x30ac33,_0x10d329=new Map(),_0x584abd=new Date(_0x3f4394);while(_0x584abd<=_0x1163d1){const _0x419820=_0x584abd[_0x2b8636(0x274)]()['split']('T')[0x0];_0x10d329['set'](_0x419820,{'revenue':0x0,'count':0x0}),_0x584abd[_0x2b8636(0x212)](_0x584abd[_0x2b8636(0x174)]()+0x1);}for(const _0x5dc682 of _0x338713){const _0x342997=_0x5dc682[_0x2b8636(0x1a6)][_0x2b8636(0x274)]()[_0x2b8636(0x1c3)]('T')[0x0],_0x38ac20=_0x10d329[_0x2b8636(0x292)](_0x342997);_0x38ac20&&(_0x38ac20[_0x2b8636(0x1a4)]+=0x1,_0x5dc682[_0x2b8636(0x20f)]===_0x2b8636(0x1d2)&&(_0x5dc682[_0x2b8636(0x288)]?_0x38ac20['revenue']+=_0x5dc682[_0x2b8636(0x288)]:console['log'](_0x2b8636(0x2a4)+_0x5dc682['id']+_0x2b8636(0x266))));}const _0x16d9c4=[],_0x5e7b5b=[];for(const [_0x48022d,_0x11a10a]of _0x10d329){_0x16d9c4[_0x2b8636(0x1ae)]({'date':_0x48022d,'amount':Math['round'](_0x11a10a[_0x2b8636(0x22f)]*0x64)/0x64}),_0x5e7b5b[_0x2b8636(0x1ae)]({'date':_0x48022d,'count':_0x11a10a[_0x2b8636(0x1a4)]});}return{'dailyRevenue':_0x16d9c4,'dailyPayments':_0x5e7b5b};}}exports[a38_0x30ac33(0x194)]=AdminService;