'use strict';const a36_0x2ad47b=a36_0x35e9;(function(_0x384858,_0x2762de){const _0x498a5d=a36_0x35e9,_0xa28501=_0x384858();while(!![]){try{const _0xbc1be6=-parseInt(_0x498a5d(0x14e))/0x1*(parseInt(_0x498a5d(0x11a))/0x2)+parseInt(_0x498a5d(0x183))/0x3*(-parseInt(_0x498a5d(0x18e))/0x4)+-parseInt(_0x498a5d(0x13f))/0x5*(parseInt(_0x498a5d(0xce))/0x6)+parseInt(_0x498a5d(0x17b))/0x7+parseInt(_0x498a5d(0xf3))/0x8+-parseInt(_0x498a5d(0x198))/0x9+parseInt(_0x498a5d(0x1fc))/0xa;if(_0xbc1be6===_0x2762de)break;else _0xa28501['push'](_0xa28501['shift']());}catch(_0x2925ef){_0xa28501['push'](_0xa28501['shift']());}}}(a36_0x5d9c,0x43b2e));function a36_0x5d9c(){const _0x42f112=['getMonth','662823csyOCX','groupBy','reduce','successUrl','findMany','\x20merchants\x20with\x20positive\x20balance','\x20USDT\x20(gross\x20revenue)','PAID','134751vAHQPF','usdtPolygonWallet','üîÑ\x20Converted\x20gateway\x20ID\x20\x27','crypto','\x20\x20\x20ÔøΩüìä\x20Total\x20payments:\x20','\x20USDT)','../config/database','\x27\x20(from\x20\x27','NONEXISTENT_GATEWAY_FILTER','paymentsCount','‚úÖ\x20Payout\x20created:\x20','20jOvtgG','whiteUrl','klyme_de','getDate','\x20\x20\x20üè™\x20Gateway\x20earnings:\x20','year','createUser','deleteUser',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','username','3180024dSoxAu','revenue','amount','\x20\x20\x20üåç\x20Country:\x20','getGatewayIdByName','\x20\x20\x20Total\x20paid\x20out:\x20','trc20','$transaction','\x20USDT\x20(actual\x20balances)','\x20\x20\x20üí≥\x20Total\x20payments:\x20','%\x20from\x20','dateFrom','üîß\x20[','‚ö†Ô∏è\x20Payment\x20','sort','\x20\x20\x20‚úÖ\x20Total\x20available\x20for\x20payout:\x20','mastercard','\x20\x20\x20‚è≥\x20Pending\x20payout:\x20','paidAt','üéØ\x20updateUser\x20called\x20with\x20ID:\x20','klyme_gb','telegram','\x20\x20\x20Current\x20balance:\x20','\x20active\x20merchants\x20for\x20selection','activateUser','localeCompare','notes','hash','toFixed','90d',']\x20Updating\x20password\x20for\x20user\x20','pk_','\x20USDT\x20(','AdminService','ACTIVE','\x27\x20to\x20name\x20\x27',']\x20Gateway\x20settings\x20before\x20saving:','MasterCard','delete','toISOString','üìä\x20Calculated\x20commission\x20rate\x20for\x20payment\x20','\x20\x20\x20üí∏\x20Total\x20payouts\x20(all\x20time):\x20','aggregate','\x20\x20\x20Transaction\x20hash:\x20','totalPaidOut','amountUSDT','gatewayEarnings','statusChangedAt','2020-01-01','__importDefault','amountAfterCommissionUSDT','üìã\x20Found\x20','commission','adminNotes','Error\x20processing\x20payment\x20','üìä\x20Calculating\x20payout\x20statistics...','updateUser','getUserById','üîç\x20Using\x20gateway\x20\x27','usdtTrcWallet','merchantEarningsUSDT','update',':\x20commission\x20=\x20','totalPayments','dateTo','network','getGatewayNameById','asc','publicKey','averageCommissionRate','gte','üìä\x20Merchants\x20awaiting\x20payout:\x20','getSystemStatistics','customerName','paidOutUSDT','default','üìä\x20Getting\x20payments\x20with\x20filters:','\x20\x20\x20Balance:\x20','\x20PAID\x20payments','gateway','random','map','Telegram\x20username\x20already\x20exists','status','\x20\x20\x20üñ•Ô∏è\x20User\x20Agent:\x20','thisMonth','entries','join','hex','\x20no\x20longer\x20PAID:','statusChangedBy','\x20USDT,\x20Requested:\x20','shop','merchantUrl','setHours','week','klyme_eu','availableBalance','getMerchantStatistics','üîÑ\x20Updating\x20customer\x20data\x20for\x20payment\x20','9706750lurPpj','üí∞\x20Payment\x20','\x20USDT\x20(after\x20payouts)','\x20\x20\x20üí∞\x20Total\x20payments\x20turnover:\x20','lte','\x20balance\x20updated:','desc','failureMessage','round','month','commissionUSDT','\x20USDT\x20for\x20payment\x20','failUrl','substr','customerCountry','30d','\x20\x20\x20Merchant\x20loses:\x20','üìä\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','stringify','pendingPayout','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','currency','getFullYear','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','totalCommissionRate','428676aoOXaD','üí∞\x20Creating\x20payout\x20for\x20shop\x20','split','payout','toUpperCase','createPayout','üîÑ\x20Gateway\x20mapping\x20(create):','not\x20set','findFirst',',\x20userId:\x20','password','\x20USDT\x20(+','trim','gatewayCommissionRate','\x20USDT\x20(theoretical\x20net)','\x20for\x20shop\x20','suspendUser','SUSPENDED','CHARGEBACK','count','createdAt','gateways','üí∞\x20[PAYOUT]\x20Gateway\x20','turnoverUSDT','customerEmail','\x20\x20\x20üí∞\x20Total\x20turnover:\x20','error','\x20USDT,\x20merchant:\x20','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','cointopay','üí∞\x20Current\x20shop\x20balance:\x20','values',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','üîê\x20[','\x20\x20\x20üë§\x20Merchant\x20earnings:\x20','Rapyd','üìä\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','707120YZojiL','gatewayOrderId','cointopay2','averageCheckUSDT','push','üìä\x20Gateway\x20filter\x20applied:','üí∞\x20Shop\x20','üìä\x20Payout\x20statistics\x20calculated:','period','\x20\x20\x20üìÖ\x20Total\x20payouts\x20(this\x20month):\x20',',\x20Commission:\x20','insensitive','üîÑ\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','date','Payment\x20not\x20found','forEach','fullName','\x20\x20\x20Full\x20amount:\x20','__esModule','gatewaySettings','awaitingPayout','turnover','KLYME\x20DE','getGatewayInternalName','deletePayout','\x20merchants','set','orderId','findUnique','erc20','dailyRevenue','totalAmountAfterCommissionUSDT','\x20status:\x20','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','getTime','balance','payment','summary','chargebackAmount','311294wNjvMP','\x20USDT\x20(-','\x20\x20\x20üìÖ\x20This\x20month:\x20','updatedAt','üìä\x20Final\x20WHERE\x20conditions:','\x20USDT\x20from\x20balance','üìä\x20Available\x20gateways\x20in\x20database:','txid','toLowerCase','all','\x27\x20->\x20ID\x20\x27','üí≥\x20Payout\x20wallet\x20for\x20','0000','\x20\x20\x20ÔøΩ\x20Total\x20paid\x20out:\x20','\x27\x20->\x20name\x20\x27','getAllPayments','includes','\x20\x20\x20üåê\x20IP:\x20','üí∞\x20Found\x20','\x20\x20\x20üîç\x20Calculated\x20after\x20commission:\x20','yesterday','usdtErcWallet','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','getMerchantsSelection','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','üìä\x20Getting\x20merchant\x20statistics\x20with\x20filters:','üîÑ\x20Gateway\x20mapping\x20(get):','\x20USDT','periodTo','randomBytes','getPayoutStats','üìä\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20','some','externalPaymentUrl','toString','name','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','10zHQLoB','paymentGateways','\x20paid\x20payments\x20for\x20analysis','üí∞\x20[PAYOUT]\x20Merchant\x20','test_gateway','\x20->\x20','currencyService','amountAfterGatewayCommissionUSDT','‚úÖ\x20Customer\x20data\x20updated\x20for\x20payment\x20','\x20USDT\x20(total\x20paid\x20to\x20merchants)','Insufficient\x20balance.\x20Available:\x20','üéØ\x20[','shopUrl','üîÑ\x20Gateway\x20mapping:','not\x20specified','1RnZxIb','setDate','dailyPayments','getPaymentById','generateDailyStatistics','custom','\x20order','\x20became\x20PAID:','getGatewayDisplayName','convertToUSDT','_sum','getMerchantsAwaitingPayout','getAllPayouts','_count','REFUND','\x20USDT\x20(with\x20commission\x20deducted)','log','‚úÖ\x20Using\x20gateway\x20filter:\x20\x27','üìä\x20Merchant\x20statistics\x20calculated:','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','CoinToPay','\x20in\x20','customerUa','\x20\x20\x20‚úÖ\x20Actual\x20available\x20balance:\x20','usdcPolygonWallet','üìä\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','customerIp','wallets','üí∏\x20CHARGEBACK:\x20Merchant\x20amount\x20already\x20deducted\x20from\x20balance','totalPayout','\x20\x20\x20ÔøΩ\x20Total\x20payments\x20turnover:\x20','totalAmountUSDT','shopId','\x20\x20\x20Gateway:\x20','telegramId','\x20USDT\x20(without\x20commission)','ceil','üìä\x20Sorting\x20payments\x20by\x20','\x20USDT\x20(after\x20','parse','%\x20commission)','\x20\x20\x20üîç\x20Raw\x20balance\x20sum:\x20','COMPLETED','length'];a36_0x5d9c=function(){return _0x42f112;};return a36_0x5d9c();}var __importDefault=this&&this[a36_0x2ad47b(0x1c9)]||function(_0x27a15d){const _0x25f114=a36_0x2ad47b;return _0x27a15d&&_0x27a15d[_0x25f114(0x105)]?_0x27a15d:{'default':_0x27a15d};};function a36_0x35e9(_0x5938ca,_0x2602cb){const _0x5d9cb6=a36_0x5d9c();return a36_0x35e9=function(_0x35e95d,_0x15a16e){_0x35e95d=_0x35e95d-0xc0;let _0x1ef88f=_0x5d9cb6[_0x35e95d];return _0x1ef88f;},a36_0x35e9(_0x5938ca,_0x2602cb);}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a36_0x2ad47b(0x1b9)]=void 0x0;const database_1=__importDefault(require(a36_0x2ad47b(0x189))),bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a36_0x2ad47b(0x186))),currencyService_1=require('./currencyService'),gateway_1=require('../types/gateway');class AdminService{async[a36_0x2ad47b(0x138)](){const _0x78cfd3=a36_0x2ad47b;console['log'](_0x78cfd3(0x1cf));const _0x4b2b93=await database_1[_0x78cfd3(0x1e3)][_0x78cfd3(0x1f4)][_0x78cfd3(0x1c2)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x78cfd3(0x1ba)}}),_0x2a92d3=await this[_0x78cfd3(0x159)]({'page':0x1,'limit':0x3e8}),_0x3baa99=await database_1[_0x78cfd3(0x1e3)][_0x78cfd3(0x117)][_0x78cfd3(0xe1)]({'where':{'status':_0x78cfd3(0x182),'gateway':{'not':_0x78cfd3(0x143)}}}),_0x2d985b=new Date(),_0x317567=new Date(_0x2d985b[_0x78cfd3(0xcb)](),_0x2d985b[_0x78cfd3(0x17a)](),0x1),_0x2258cb=new Date(_0x2d985b['getFullYear'](),_0x2d985b[_0x78cfd3(0x17a)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x421b2c=await database_1[_0x78cfd3(0x1e3)][_0x78cfd3(0xd1)][_0x78cfd3(0x1c2)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x317567,'lte':_0x2258cb},'status':'COMPLETED'}}),_0x502411=_0x4b2b93[_0x78cfd3(0x158)]['totalPaidOut']||0x0,_0x361a53=_0x2a92d3[_0x78cfd3(0x118)]['totalAmountAfterCommissionUSDT'],_0xbf1ac8=_0x421b2c[_0x78cfd3(0x158)]['amount']||0x0,_0x3f57ea={'totalPayout':Math[_0x78cfd3(0x204)](_0x502411*0x64)/0x64,'awaitingPayout':Math['round'](_0x361a53*0x64)/0x64,'thisMonth':Math[_0x78cfd3(0x204)](_0xbf1ac8*0x64)/0x64,'availableBalance':Math['round'](_0x361a53*0x64)/0x64,'totalPayments':_0x3baa99};return console[_0x78cfd3(0x15e)](_0x78cfd3(0xfa)),console[_0x78cfd3(0x15e)]('\x20\x20\x20üí∞\x20Total\x20payout:\x20'+_0x3f57ea[_0x78cfd3(0x16b)]+_0x78cfd3(0x148)),console[_0x78cfd3(0x15e)](_0x78cfd3(0xea)+_0x3f57ea[_0x78cfd3(0x107)]+_0x78cfd3(0x15d)),console[_0x78cfd3(0x15e)]('\x20\x20\x20üíµ\x20Available\x20balance:\x20'+_0x3f57ea[_0x78cfd3(0x1f9)]+'\x20USDT\x20(same\x20as\x20awaiting)'),console[_0x78cfd3(0x15e)](_0x78cfd3(0x11c)+_0x3f57ea[_0x78cfd3(0x1ed)]+_0x78cfd3(0x135)),console['log'](_0x78cfd3(0x1a1)+_0x3f57ea[_0x78cfd3(0x1d7)]+_0x78cfd3(0x1e6)),console[_0x78cfd3(0x15e)](_0x78cfd3(0x177)+(_0x4b2b93[_0x78cfd3(0x158)][_0x78cfd3(0x116)]||0x0)[_0x78cfd3(0x1b4)](0x2)+_0x78cfd3(0x171)),console[_0x78cfd3(0x15e)]('\x20\x20\x20üìä\x20Commission\x20difference:\x20'+((_0x4b2b93[_0x78cfd3(0x158)][_0x78cfd3(0x116)]||0x0)-_0x361a53)[_0x78cfd3(0x1b4)](0x2)+_0x78cfd3(0x135)),_0x3f57ea;}async['updateCustomerData'](_0x538b00,_0x40db3d){const _0x3038f2=a36_0x2ad47b;console[_0x3038f2(0x15e)](_0x3038f2(0x1fb)+_0x538b00+':',_0x40db3d);const _0x1f4384=await database_1['default'][_0x3038f2(0x117)][_0x3038f2(0x10f)]({'where':{'id':_0x538b00},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x1f4384)throw new Error(_0x3038f2(0x101));const _0x3fc338={};_0x40db3d[_0x3038f2(0xc3)]!==undefined&&(_0x3fc338[_0x3038f2(0xc3)]=_0x40db3d['customerCountry']||null);_0x40db3d['customerIp']!==undefined&&(_0x3fc338[_0x3038f2(0x168)]=_0x40db3d['customerIp']||null);_0x40db3d[_0x3038f2(0x164)]!==undefined&&(_0x3fc338[_0x3038f2(0x164)]=_0x40db3d['customerUa']||null);const _0x155278=await database_1[_0x3038f2(0x1e3)][_0x3038f2(0x117)][_0x3038f2(0x1d5)]({'where':{'id':_0x538b00},'data':{..._0x3fc338,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x3038f2(0x15e)](_0x3038f2(0x147)+_0x538b00),console[_0x3038f2(0x15e)](_0x3038f2(0x19b)+_0x1f4384[_0x3038f2(0xc3)]+'\x20->\x20'+_0x155278[_0x3038f2(0xc3)]),console['log'](_0x3038f2(0x12b)+_0x1f4384['customerIp']+_0x3038f2(0x144)+_0x155278[_0x3038f2(0x168)]),console[_0x3038f2(0x15e)](_0x3038f2(0x1ec)+(_0x1f4384[_0x3038f2(0x164)]?'set':'not\x20set')+_0x3038f2(0x144)+(_0x155278['customerUa']?_0x3038f2(0x10d):_0x3038f2(0xd5))),_0x155278;}async[a36_0x2ad47b(0x1e0)](_0x49d64a){const _0x34cdfa=a36_0x2ad47b,_0xfb214c=new Date();let _0x4a3ea6;switch(_0x49d64a[_0x34cdfa(0x122)]()){case'day':_0x4a3ea6=new Date(_0xfb214c[_0x34cdfa(0xcb)](),_0xfb214c['getMonth'](),_0xfb214c[_0x34cdfa(0x191)](),0x0,0x0,0x0,0x0);break;case _0x34cdfa(0x12e):const _0x15a2f0=new Date(_0xfb214c);_0x15a2f0[_0x34cdfa(0x14f)](_0x15a2f0[_0x34cdfa(0x191)]()-0x1),_0x4a3ea6=new Date(_0x15a2f0['getFullYear'](),_0x15a2f0[_0x34cdfa(0x17a)](),_0x15a2f0[_0x34cdfa(0x191)](),0x0,0x0,0x0,0x0);break;case'7d':_0x4a3ea6=new Date(_0xfb214c[_0x34cdfa(0x115)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x34cdfa(0xc4):_0x4a3ea6=new Date(_0xfb214c['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x34cdfa(0x1b5):_0x4a3ea6=new Date(_0xfb214c[_0x34cdfa(0x115)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case'all':const _0x33e18a=await database_1[_0x34cdfa(0x1e3)]['payment'][_0x34cdfa(0xd6)]({'where':{'gateway':{'not':_0x34cdfa(0x143)}},'orderBy':{'createdAt':_0x34cdfa(0x1db)},'select':{'createdAt':!![]}});_0x4a3ea6=_0x33e18a?_0x33e18a[_0x34cdfa(0xe2)]:new Date(_0x34cdfa(0x1c8));break;default:_0x4a3ea6=new Date(_0xfb214c['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}_0x4a3ea6['setHours'](0x0,0x0,0x0,0x0);let _0x38a2d3;if(_0x49d64a[_0x34cdfa(0x122)]()==='yesterday'){const _0x3e4ab1=new Date(_0xfb214c);_0x3e4ab1[_0x34cdfa(0x14f)](_0x3e4ab1[_0x34cdfa(0x191)]()-0x1),_0x38a2d3=new Date(_0x3e4ab1['getFullYear'](),_0x3e4ab1[_0x34cdfa(0x17a)](),_0x3e4ab1[_0x34cdfa(0x191)](),0x17,0x3b,0x3b,0x3e7);}const _0x33f08f={'gte':_0x4a3ea6};_0x38a2d3&&(_0x33f08f['lte']=_0x38a2d3);const [_0x1aec98,_0x350b1b,_0x4c6446,_0x15afe6,_0x279d47,_0xf21d2e]=await Promise[_0x34cdfa(0x123)]([database_1[_0x34cdfa(0x1e3)][_0x34cdfa(0x1f4)][_0x34cdfa(0xe1)](),database_1[_0x34cdfa(0x1e3)][_0x34cdfa(0x1f4)][_0x34cdfa(0xe1)]({'where':{'status':'ACTIVE'}}),database_1[_0x34cdfa(0x1e3)][_0x34cdfa(0x117)][_0x34cdfa(0xe1)]({'where':{'status':'PAID','createdAt':_0x33f08f,'gateway':{'not':_0x34cdfa(0x143)}}}),database_1[_0x34cdfa(0x1e3)][_0x34cdfa(0x117)]['findMany']({'where':{'status':_0x34cdfa(0x182),'createdAt':_0x33f08f,'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x34cdfa(0x1e3)]['payment']['findMany']({'where':{'gateway':{'not':_0x34cdfa(0x143)}},'take':0xa,'orderBy':{'createdAt':_0x34cdfa(0x202)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x34cdfa(0x1e3)][_0x34cdfa(0x117)][_0x34cdfa(0x17f)]({'where':{'createdAt':_0x33f08f,'gateway':{'not':_0x34cdfa(0x143)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x17e0fb=0x0,_0x411add=0x0;for(const _0x1e04fd of _0x15afe6){const _0x38e1bb=await currencyService_1[_0x34cdfa(0x145)][_0x34cdfa(0x157)](_0x1e04fd['amount'],_0x1e04fd['currency']);_0x17e0fb+=_0x38e1bb;if(_0x1e04fd[_0x34cdfa(0x146)]){const _0x693a11=await currencyService_1[_0x34cdfa(0x145)]['convertToUSDT'](_0x1e04fd[_0x34cdfa(0x19a)],_0x1e04fd['currency']),_0x268354=_0x1e04fd[_0x34cdfa(0x146)],_0x45e199=_0x693a11-_0x268354;_0x411add+=_0x45e199;}}const _0x1f730f=_0x4c6446>0x0?_0x17e0fb/_0x4c6446:0x0,_0x1e31b8=this['generateDailyStatistics'](_0xf21d2e,_0x4a3ea6,_0x38a2d3||_0xfb214c),_0x4742ed=await database_1[_0x34cdfa(0x1e3)][_0x34cdfa(0x117)][_0x34cdfa(0xe1)]({'where':{'createdAt':_0x33f08f,'gateway':{'not':'test_gateway'}}}),_0x34a310=_0x4742ed>0x0?_0x4c6446/_0x4742ed*0x64:0x0;return{'totalShops':_0x1aec98,'activeShops':_0x350b1b,'totalPayments':_0x4c6446,'successfulPayments':_0x4c6446,'totalAttempts':_0x4742ed,'totalRevenue':Math[_0x34cdfa(0x204)](_0x17e0fb*0x64)/0x64,'trapayEarnings':Math[_0x34cdfa(0x204)](_0x411add*0x64)/0x64,'averagePaymentAmount':Math[_0x34cdfa(0x204)](_0x1f730f*0x64)/0x64,'conversionRate':Math[_0x34cdfa(0x204)](_0x34a310*0x64)/0x64,'dailyRevenue':_0x1e31b8[_0x34cdfa(0x111)],'dailyPayments':_0x1e31b8[_0x34cdfa(0x150)],'recentPayments':_0x279d47['map'](_0x1ed44c=>({'id':_0x1ed44c['id'],'amount':_0x1ed44c[_0x34cdfa(0x19a)],'currency':_0x1ed44c[_0x34cdfa(0xca)],'status':_0x1ed44c[_0x34cdfa(0x1eb)],'gateway':_0x1ed44c['gateway'],'shop':_0x1ed44c[_0x34cdfa(0x1f4)],'createdAt':_0x1ed44c[_0x34cdfa(0xe2)]}))};}async[a36_0x2ad47b(0x1fa)](_0x52e009){const _0x3068de=a36_0x2ad47b;console['log'](_0x3068de(0x133),_0x52e009);let _0x286921,_0x4fd746=new Date();if(_0x52e009[_0x3068de(0xfb)]===_0x3068de(0x153)&&_0x52e009[_0x3068de(0x1a3)]&&_0x52e009[_0x3068de(0x1d8)])_0x286921=new Date(_0x52e009[_0x3068de(0x1a3)]),_0x4fd746=new Date(_0x52e009[_0x3068de(0x1d8)]),_0x286921[_0x3068de(0x1f6)](0x0,0x0,0x0,0x0),_0x4fd746['setHours'](0x17,0x3b,0x3b,0x3e7);else{const _0x5778d3=new Date();switch(_0x52e009['period']){case _0x3068de(0x1f7):_0x286921=new Date(_0x5778d3[_0x3068de(0x115)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x3068de(0x205):_0x286921=new Date(_0x5778d3[_0x3068de(0x115)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x3068de(0x193):_0x286921=new Date(_0x5778d3[_0x3068de(0x115)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x3068de(0x123):default:_0x286921=new Date(_0x3068de(0x1c8));break;}_0x286921[_0x3068de(0x1f6)](0x0,0x0,0x0,0x0),_0x4fd746[_0x3068de(0x1f6)](0x17,0x3b,0x3b,0x3e7);}console[_0x3068de(0x15e)]('üìÖ\x20Period:\x20'+_0x286921['toISOString']()+'\x20to\x20'+_0x4fd746['toISOString']());const _0x1d89f0={'status':'PAID','gateway':{'not':_0x3068de(0x143)},'paidAt':{'gte':_0x286921,'lte':_0x4fd746}};_0x52e009[_0x3068de(0x16e)]&&(_0x1d89f0['shopId']=_0x52e009[_0x3068de(0x16e)]);const _0x1b0da0=await database_1[_0x3068de(0x1e3)][_0x3068de(0x117)]['findMany']({'where':_0x1d89f0,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x3068de(0x15e)](_0x3068de(0x12c)+_0x1b0da0['length']+_0x3068de(0x141));const _0x492b16={'gateway':{'not':_0x3068de(0x143)},'createdAt':{'gte':_0x286921,'lte':_0x4fd746}};_0x52e009[_0x3068de(0x16e)]&&(_0x492b16[_0x3068de(0x16e)]=_0x52e009[_0x3068de(0x16e)]);const _0xd3f2d5=await database_1[_0x3068de(0x1e3)]['payment'][_0x3068de(0xe1)]({'where':_0x492b16});console[_0x3068de(0x15e)]('üìä\x20Total\x20payments\x20(including\x20failed):\x20'+_0xd3f2d5+',\x20successful:\x20'+_0x1b0da0[_0x3068de(0x179)]);let _0xbade5c=0x0,_0x1010fc=0x0,_0x1c2696=0x0;const _0x31fce5={},_0x39aa93={},_0x21e843={};for(const _0x83c288 of _0x1b0da0){try{const _0x509a1d=_0x83c288[_0x3068de(0x1c5)]||0x0;if(_0x509a1d<=0x0){console['warn'](_0x3068de(0x1a5)+_0x83c288['id']+'\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...');continue;}let _0x3d0ca6,_0x58ab08;if(_0x83c288['amountAfterGatewayCommissionUSDT']!==null&&_0x83c288[_0x3068de(0x146)]!==undefined)_0x3d0ca6=_0x83c288['amountAfterGatewayCommissionUSDT'],_0x58ab08=_0x509a1d-_0x3d0ca6,console[_0x3068de(0x15e)]('üìä\x20Using\x20saved\x20values\x20for\x20payment\x20'+_0x83c288['id']+':\x20'+_0x509a1d[_0x3068de(0x1b4)](0x6)+_0x3068de(0xe9)+_0x3d0ca6[_0x3068de(0x1b4)](0x6)+_0x3068de(0x135));else{let _0x58c72e={};if(_0x83c288[_0x3068de(0x1f4)][_0x3068de(0x106)])try{_0x58c72e=JSON['parse'](_0x83c288['shop'][_0x3068de(0x106)]);}catch(_0x5b22d7){console[_0x3068de(0xe8)](_0x3068de(0x130)+_0x83c288[_0x3068de(0x16e)]+':',_0x5b22d7);}let _0x59d7d1=0x2d;for(const [_0x225b38,_0x428f37]of Object['entries'](_0x58c72e)){if(_0x225b38[_0x3068de(0x122)]()===_0x83c288[_0x3068de(0x1e7)][_0x3068de(0x122)]()){_0x59d7d1=_0x428f37[_0x3068de(0x1cc)]||0x2d;break;}}_0x58ab08=_0x509a1d*(_0x59d7d1/0x64),_0x3d0ca6=_0x509a1d-_0x58ab08,console[_0x3068de(0x15e)](_0x3068de(0x167)+_0x83c288['id']+':\x20'+_0x59d7d1+'%\x20from\x20'+_0x509a1d[_0x3068de(0x1b4)](0x6)+_0x3068de(0x135));}_0xbade5c+=_0x509a1d,_0x1010fc+=_0x3d0ca6,_0x1c2696+=_0x58ab08;let _0x41b903;_0x83c288[_0x3068de(0xdb)]!==null&&_0x83c288['gatewayCommissionRate']!==undefined?(_0x41b903=_0x83c288[_0x3068de(0xdb)],console['log'](_0x3068de(0x139)+_0x83c288['id']+':\x20'+_0x41b903+'%')):(_0x41b903=_0x509a1d>0x0?_0x58ab08/_0x509a1d*0x64:0x0,console[_0x3068de(0x15e)](_0x3068de(0x1c0)+_0x83c288['id']+':\x20'+_0x41b903[_0x3068de(0x1b4)](0x2)+'%'));!_0x31fce5[_0x83c288[_0x3068de(0x1e7)]]&&(_0x31fce5[_0x83c288[_0x3068de(0x1e7)]]={'gateway':_0x83c288[_0x3068de(0x1e7)],'gatewayDisplayName':this[_0x3068de(0x156)](_0x83c288[_0x3068de(0x1e7)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x31fce5[_0x83c288['gateway']]['paymentsCount']++,_0x31fce5[_0x83c288[_0x3068de(0x1e7)]]['turnoverUSDT']+=_0x509a1d,_0x31fce5[_0x83c288[_0x3068de(0x1e7)]][_0x3068de(0x206)]+=_0x58ab08,_0x31fce5[_0x83c288[_0x3068de(0x1e7)]][_0x3068de(0x1d4)]+=_0x3d0ca6,_0x31fce5[_0x83c288[_0x3068de(0x1e7)]][_0x3068de(0xcd)]+=_0x41b903;!_0x52e009[_0x3068de(0x16e)]&&(!_0x39aa93[_0x83c288[_0x3068de(0x16e)]]&&(_0x39aa93[_0x83c288[_0x3068de(0x16e)]]={'shopId':_0x83c288['shopId'],'shopName':_0x83c288[_0x3068de(0x1f4)][_0x3068de(0x13d)],'shopUsername':_0x83c288[_0x3068de(0x1f4)][_0x3068de(0x197)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x39aa93[_0x83c288[_0x3068de(0x16e)]][_0x3068de(0x18c)]++,_0x39aa93[_0x83c288['shopId']]['turnoverUSDT']+=_0x509a1d,_0x39aa93[_0x83c288[_0x3068de(0x16e)]][_0x3068de(0x206)]+=_0x58ab08,_0x39aa93[_0x83c288[_0x3068de(0x16e)]][_0x3068de(0x1d4)]+=_0x3d0ca6);const _0x1df537=_0x83c288[_0x3068de(0x1aa)][_0x3068de(0x1bf)]()[_0x3068de(0xd0)]('T')[0x0];!_0x21e843[_0x1df537]&&(_0x21e843[_0x1df537]={'date':_0x1df537,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x21e843[_0x1df537][_0x3068de(0x108)]+=_0x509a1d,_0x21e843[_0x1df537]['merchantEarnings']+=_0x3d0ca6,_0x21e843[_0x1df537][_0x3068de(0x1c6)]+=_0x58ab08,_0x21e843[_0x1df537][_0x3068de(0x18c)]++;}catch(_0x49152c){console[_0x3068de(0xe8)](_0x3068de(0x1ce)+_0x83c288['id']+':',_0x49152c);}}Object[_0x3068de(0xed)](_0x31fce5)[_0x3068de(0x102)](_0x53bb6c=>{const _0x4a171a=_0x3068de;_0x53bb6c['averageCommissionRate']=_0x53bb6c[_0x4a171a(0x18c)]>0x0?_0x53bb6c['totalCommissionRate']/_0x53bb6c[_0x4a171a(0x18c)]:0x0,delete _0x53bb6c['totalCommissionRate'];}),Object['values'](_0x39aa93)[_0x3068de(0x102)](_0x549072=>{const _0x4d525f=_0x3068de;_0x549072[_0x4d525f(0xf6)]=_0x549072[_0x4d525f(0x18c)]>0x0?_0x549072[_0x4d525f(0xe5)]/_0x549072[_0x4d525f(0x18c)]:0x0;});let _0x1a29ba=0x0,_0x3016b3=0x0;if(_0x52e009[_0x3068de(0x16e)]){const _0x510ecd=await database_1[_0x3068de(0x1e3)]['payout'][_0x3068de(0x17f)]({'where':{'shopId':_0x52e009[_0x3068de(0x16e)],'status':_0x3068de(0x178),'createdAt':{'gte':_0x286921,'lte':_0x4fd746}},'select':{'amount':!![]}});_0x1a29ba=_0x510ecd[_0x3068de(0x17d)]((_0x282ec8,_0x4edae4)=>_0x282ec8+_0x4edae4[_0x3068de(0x19a)],0x0);const _0x12bd44=await database_1[_0x3068de(0x1e3)]['payout'][_0x3068de(0x17f)]({'where':{'shopId':_0x52e009['shopId'],'status':'PENDING','createdAt':{'gte':_0x286921,'lte':_0x4fd746}},'select':{'amount':!![]}});_0x3016b3=_0x12bd44['reduce']((_0x5f1fc6,_0x309562)=>_0x5f1fc6+_0x309562[_0x3068de(0x19a)],0x0);}const _0x42049b=_0xd3f2d5,_0x472f1f=_0x1b0da0['length'],_0x7d4622=_0x472f1f>0x0?_0xbade5c/_0x472f1f:0x0,_0x4f1388=_0x42049b>0x0?Math[_0x3068de(0x204)](_0x472f1f/_0x42049b*0x2710)/0x64:0x0,_0x3f6174=Math[_0x3068de(0x172)]((_0x4fd746['getTime']()-_0x286921[_0x3068de(0x115)]())/(0x3e8*0x3c*0x3c*0x18)),_0x126bb0={'totalTurnover':Math[_0x3068de(0x204)](_0xbade5c*0x64)/0x64,'merchantEarnings':Math['round'](_0x1010fc*0x64)/0x64,'gatewayEarnings':Math['round'](_0x1c2696*0x64)/0x64,'totalPaidOut':Math[_0x3068de(0x204)](_0x1a29ba*0x64)/0x64,'pendingPayout':Math[_0x3068de(0x204)](_0x3016b3*0x64)/0x64,'averageCheck':Math['round'](_0x7d4622*0x64)/0x64,'totalPayments':_0x42049b,'successfulPayments':_0x472f1f,'conversionRate':_0x4f1388,'gatewayBreakdown':Object['values'](_0x31fce5)[_0x3068de(0x1e9)](_0x224c71=>({..._0x224c71,'turnoverUSDT':Math[_0x3068de(0x204)](_0x224c71[_0x3068de(0xe5)]*0x64)/0x64,'commissionUSDT':Math[_0x3068de(0x204)](_0x224c71[_0x3068de(0x206)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x3068de(0x204)](_0x224c71[_0x3068de(0x1d4)]*0x64)/0x64,'averageCommissionRate':Math['round'](_0x224c71[_0x3068de(0x1dd)]*0x64)/0x64})),'merchantBreakdown':_0x52e009[_0x3068de(0x16e)]?undefined:Object[_0x3068de(0xed)](_0x39aa93)[_0x3068de(0x1e9)](_0x151086=>({..._0x151086,'turnoverUSDT':Math[_0x3068de(0x204)](_0x151086[_0x3068de(0xe5)]*0x64)/0x64,'commissionUSDT':Math[_0x3068de(0x204)](_0x151086[_0x3068de(0x206)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x3068de(0x204)](_0x151086[_0x3068de(0x1d4)]*0x64)/0x64,'paidOutUSDT':Math[_0x3068de(0x204)](_0x151086[_0x3068de(0x1e2)]*0x64)/0x64,'averageCheckUSDT':Math[_0x3068de(0x204)](_0x151086[_0x3068de(0xf6)]*0x64)/0x64})),'dailyData':Object['values'](_0x21e843)[_0x3068de(0x1e9)](_0x5cb297=>({..._0x5cb297,'turnover':Math['round'](_0x5cb297[_0x3068de(0x108)]*0x64)/0x64,'merchantEarnings':Math[_0x3068de(0x204)](_0x5cb297['merchantEarnings']*0x64)/0x64,'gatewayEarnings':Math['round'](_0x5cb297[_0x3068de(0x1c6)]*0x64)/0x64}))[_0x3068de(0x1a6)]((_0x72b7fa,_0x29ed38)=>_0x72b7fa[_0x3068de(0x100)][_0x3068de(0x1b1)](_0x29ed38['date'])),'periodInfo':{'from':_0x286921,'to':_0x4fd746,'periodType':_0x52e009[_0x3068de(0xfb)]||'custom','daysCount':_0x3f6174}};return console[_0x3068de(0x15e)](_0x3068de(0x160)),console[_0x3068de(0x15e)](_0x3068de(0xe7)+_0x126bb0['totalTurnover']+_0x3068de(0x135)),console[_0x3068de(0x15e)](_0x3068de(0xf0)+_0x126bb0['merchantEarnings']+_0x3068de(0x135)),console[_0x3068de(0x15e)](_0x3068de(0x192)+_0x126bb0[_0x3068de(0x1c6)]+'\x20USDT'),console[_0x3068de(0x15e)](_0x3068de(0x127)+_0x126bb0['totalPaidOut']+_0x3068de(0x135)),console[_0x3068de(0x15e)](_0x3068de(0x1a9)+_0x126bb0[_0x3068de(0xc8)]+_0x3068de(0x135)),console[_0x3068de(0x15e)](_0x3068de(0x187)+_0x126bb0[_0x3068de(0x1d7)]),_0x126bb0;}async[a36_0x2ad47b(0x131)](){const _0x3f345b=a36_0x2ad47b;console[_0x3f345b(0x15e)]('üìã\x20Getting\x20merchants\x20selection\x20list...');const _0xcf4629=await database_1['default'][_0x3f345b(0x1f4)]['findMany']({'where':{'status':'ACTIVE'},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x3f345b(0x1db)}});return console['log'](_0x3f345b(0x1cb)+_0xcf4629[_0x3f345b(0x179)]+_0x3f345b(0x1af)),_0xcf4629[_0x3f345b(0x1e9)](_0x1a959c=>({'id':_0x1a959c['id'],'username':_0x1a959c[_0x3f345b(0x197)],'name':_0x1a959c[_0x3f345b(0x13d)]}));}[a36_0x2ad47b(0x156)](_0x4e348b){const _0x275ee6=a36_0x2ad47b,_0x566558={'test_gateway':'Test\x20Gateway','plisio':'Plisio','rapyd':_0x275ee6(0xf1),'noda':'Noda','cointopay':_0x275ee6(0x162),'cointopay2':'Open\x20Banking\x202','klyme_eu':'KLYME\x20EU','klyme_gb':'KLYME\x20GB','klyme_de':_0x275ee6(0x109),'mastercard':_0x275ee6(0x1bd)};return _0x566558[_0x4e348b]||_0x4e348b;}[a36_0x2ad47b(0x10a)](_0x26afc8){const _0x226f5c=a36_0x2ad47b,_0x50bb93={'Test\x20Gateway':_0x226f5c(0x143),'Plisio':'plisio','Rapyd':'rapyd','Noda':'noda','CoinToPay':_0x226f5c(0xeb),'CoinToPay2':_0x226f5c(0xf5),'KLYME\x20EU':_0x226f5c(0x1f8),'KLYME\x20GB':_0x226f5c(0x1ac),'KLYME\x20DE':_0x226f5c(0x190),'MasterCard':_0x226f5c(0x1a8)};return _0x50bb93[_0x26afc8]||_0x26afc8['toLowerCase']();}async[a36_0x2ad47b(0x159)](_0x200357){const _0x4f3bf2=a36_0x2ad47b,{page:_0x4e0648,limit:_0xe60eef,minAmount:_0x1c2d55,search:_0x32714f}=_0x200357,_0x14b397=(_0x4e0648-0x1)*_0xe60eef;console['log']('üìä\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:',_0x200357);const _0x2bb996={'balance':{'gt':0x0},'status':_0x4f3bf2(0x1ba)};_0x1c2d55&&(_0x2bb996[_0x4f3bf2(0x116)][_0x4f3bf2(0x1de)]=_0x1c2d55);_0x32714f&&(_0x2bb996[_0x4f3bf2(0x13d)]={'contains':_0x32714f,'mode':_0x4f3bf2(0xfe)});const [_0xb9cc38,_0x187a12]=await Promise[_0x4f3bf2(0x123)]([database_1[_0x4f3bf2(0x1e3)]['shop'][_0x4f3bf2(0x17f)]({'where':_0x2bb996,'skip':_0x14b397,'take':_0xe60eef,'orderBy':{'balance':_0x4f3bf2(0x202)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1[_0x4f3bf2(0x1e3)][_0x4f3bf2(0x1f4)][_0x4f3bf2(0xe1)]({'where':_0x2bb996})]);console['log']('üí∞\x20Found\x20'+_0xb9cc38[_0x4f3bf2(0x179)]+_0x4f3bf2(0x180));const _0x3e0060=await Promise[_0x4f3bf2(0x123)](_0xb9cc38['map'](async _0x4d946a=>{const _0x139a4a=_0x4f3bf2,[_0xed498e,_0x48ea5c,_0x37e233]=await Promise['all']([database_1[_0x139a4a(0x1e3)][_0x139a4a(0x117)][_0x139a4a(0xe1)]({'where':{'shopId':_0x4d946a['id'],'status':'PAID','gateway':{'not':_0x139a4a(0x143)}}}),database_1['default'][_0x139a4a(0x117)]['findFirst']({'where':{'shopId':_0x4d946a['id'],'status':_0x139a4a(0x182),'gateway':{'not':'test_gateway'}},'orderBy':{'paidAt':_0x139a4a(0x1db)},'select':{'paidAt':!![]}}),database_1[_0x139a4a(0x1e3)][_0x139a4a(0x117)]['groupBy']({'by':[_0x139a4a(0x1e7)],'where':{'shopId':_0x4d946a['id'],'status':_0x139a4a(0x182),'gateway':{'not':_0x139a4a(0x143)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x3ab8cb=new Date(),_0x17ed47=new Date(_0x3ab8cb[_0x139a4a(0xcb)](),_0x3ab8cb[_0x139a4a(0x17a)](),0x1),_0x3792ba=new Date(_0x3ab8cb[_0x139a4a(0xcb)](),_0x3ab8cb['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x373cb5,_0x3aea29]=await Promise[_0x139a4a(0x123)]([database_1['default'][_0x139a4a(0xd1)][_0x139a4a(0x1c2)]({'_sum':{'amount':!![]},'where':{'shopId':_0x4d946a['id'],'status':_0x139a4a(0x178)}}),database_1[_0x139a4a(0x1e3)][_0x139a4a(0xd1)][_0x139a4a(0x1c2)]({'_sum':{'amount':!![]},'where':{'shopId':_0x4d946a['id'],'status':'COMPLETED','createdAt':{'gte':_0x17ed47,'lte':_0x3792ba}}})]),_0x1c21f7=_0x373cb5[_0x139a4a(0x158)]['amount']||0x0,_0x1aa287=_0x3aea29[_0x139a4a(0x158)][_0x139a4a(0x19a)]||0x0,_0x33e3dd=await Promise[_0x139a4a(0x123)](_0x37e233['map'](async _0x4940ff=>{const _0x396fe9=_0x139a4a;let _0xb1c9e9=0x2d;if(_0x4d946a[_0x396fe9(0x106)])try{const _0x4ea56c=JSON['parse'](_0x4d946a[_0x396fe9(0x106)]);for(const [_0x45105d,_0x1b4798]of Object[_0x396fe9(0x1ee)](_0x4ea56c)){if(_0x45105d['toLowerCase']()===_0x4940ff[_0x396fe9(0x1e7)][_0x396fe9(0x122)]()){_0xb1c9e9=_0x1b4798[_0x396fe9(0x1cc)]||0xa,console[_0x396fe9(0x15e)](_0x396fe9(0xe4)+_0x4940ff[_0x396fe9(0x1e7)]+_0x396fe9(0xdd)+_0x4d946a['id']+_0x396fe9(0x1d6)+_0xb1c9e9+'%');break;}}}catch(_0x4e3d0f){console[_0x396fe9(0xe8)](_0x396fe9(0x130)+_0x4d946a['id']+':',_0x4e3d0f);}const _0x58bfa5=_0x4940ff['_sum']?.[_0x396fe9(0x1c5)]||0x0,_0x25d4db=_0x58bfa5*(0x1-_0xb1c9e9/0x64);return{'gateway':_0x4940ff[_0x396fe9(0x1e7)],'count':_0x4940ff['_count']?.['id']||0x0,'amountUSDT':Math[_0x396fe9(0x204)](_0x58bfa5*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x396fe9(0x204)](_0x25d4db*0x64)/0x64,'commission':_0xb1c9e9};})),_0x196509=_0x33e3dd[_0x139a4a(0x17d)]((_0x1ed786,_0x5c9db3)=>_0x1ed786+_0x5c9db3[_0x139a4a(0x1c5)],0x0),_0xfacaba=_0x4d946a['balance'];return console['log'](_0x139a4a(0x142)+_0x4d946a[_0x139a4a(0x197)]+':'),console[_0x139a4a(0x15e)](_0x139a4a(0x16c)+_0x196509[_0x139a4a(0x1b4)](0x2)+_0x139a4a(0x181)),console[_0x139a4a(0x15e)](_0x139a4a(0x12d)+_0x33e3dd['reduce']((_0xb71124,_0x3a34b8)=>_0xb71124+_0x3a34b8[_0x139a4a(0x1ca)],0x0)['toFixed'](0x2)+_0x139a4a(0xdc)),console['log'](_0x139a4a(0x165)+_0xfacaba[_0x139a4a(0x1b4)](0x2)+_0x139a4a(0x1fe)),{'id':_0x4d946a['id'],'fullName':_0x4d946a[_0x139a4a(0x13d)],'username':_0x4d946a[_0x139a4a(0x197)],'telegramId':_0x4d946a['telegram'],'merchantUrl':_0x4d946a[_0x139a4a(0x14b)],'wallets':{'usdtPolygonWallet':_0x4d946a[_0x139a4a(0x184)],'usdtTrcWallet':_0x4d946a[_0x139a4a(0x1d3)],'usdtErcWallet':_0x4d946a['usdtErcWallet'],'usdcPolygonWallet':_0x4d946a[_0x139a4a(0x166)]},'totalAmountUSDT':Math[_0x139a4a(0x204)](_0x196509*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0xfacaba*0x64)/0x64,'totalPayout':Math[_0x139a4a(0x204)](_0x1c21f7*0x64)/0x64,'thisMonth':Math[_0x139a4a(0x204)](_0x1aa287*0x64)/0x64,'paymentsCount':_0xed498e,'oldestPaymentDate':_0x48ea5c?.[_0x139a4a(0x1aa)]||_0x4d946a['createdAt'],'gatewayBreakdown':_0x33e3dd};})),_0x2ac20d=_0x3e0060[_0x4f3bf2(0x17d)]((_0x3ef619,_0x3312ed)=>_0x3ef619+_0x3312ed[_0x4f3bf2(0x16d)],0x0),_0x309f0a=_0x3e0060[_0x4f3bf2(0x17d)]((_0x4331bb,_0x5727e1)=>_0x4331bb+_0x5727e1[_0x4f3bf2(0x112)],0x0),_0x866b81=_0x3e0060[_0x4f3bf2(0x17d)]((_0x32514e,_0xda8d6e)=>_0x32514e+_0xda8d6e[_0x4f3bf2(0x16b)],0x0),_0x51a284=_0x3e0060['reduce']((_0x536bb7,_0x3dc222)=>_0x536bb7+_0x3dc222[_0x4f3bf2(0x1ed)],0x0);return console[_0x4f3bf2(0x15e)](_0x4f3bf2(0x1df)+_0x187a12+_0x4f3bf2(0x10c)),console[_0x4f3bf2(0x15e)](_0x4f3bf2(0x1ff)+Math['round'](_0x2ac20d*0x64)/0x64+_0x4f3bf2(0x181)),console[_0x4f3bf2(0x15e)](_0x4f3bf2(0x1a7)+Math['round'](_0x309f0a*0x64)/0x64+_0x4f3bf2(0x1a0)),console[_0x4f3bf2(0x15e)](_0x4f3bf2(0x1c1)+Math[_0x4f3bf2(0x204)](_0x866b81*0x64)/0x64+_0x4f3bf2(0x135)),console['log'](_0x4f3bf2(0xfc)+Math['round'](_0x51a284*0x64)/0x64+'\x20USDT'),{'merchants':_0x3e0060,'pagination':{'page':_0x4e0648,'limit':_0xe60eef,'total':_0x187a12,'totalPages':Math['ceil'](_0x187a12/_0xe60eef)},'summary':{'totalMerchants':_0x187a12,'totalAmountUSDT':Math[_0x4f3bf2(0x204)](_0x2ac20d*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x4f3bf2(0x204)](_0x309f0a*0x64)/0x64,'totalPayout':Math[_0x4f3bf2(0x204)](_0x866b81*0x64)/0x64,'thisMonth':Math['round'](_0x51a284*0x64)/0x64}};}async[a36_0x2ad47b(0xd3)](_0x12a5c3){const _0x492000=a36_0x2ad47b,{shopId:_0xaef08e,amount:_0x4f6f22,network:_0x3aa779,wallet:_0x42e122,notes:_0xd2c3b8,txid:_0x432e52,periodFrom:_0xccd59e,periodTo:_0x28c78d}=_0x12a5c3,_0x3dde96=await database_1['default']['$transaction'](async _0x3122db=>{const _0x8f378d=a36_0x35e9,_0x5883bd=await _0x3122db[_0x8f378d(0x1f4)][_0x8f378d(0x10f)]({'where':{'id':_0xaef08e},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x5883bd)throw new Error('Shop\x20not\x20found');console[_0x8f378d(0x15e)](_0x8f378d(0xcf)+_0x5883bd[_0x8f378d(0x197)]+':'),console['log'](_0x8f378d(0x1ae)+_0x5883bd[_0x8f378d(0x116)][_0x8f378d(0x1b4)](0x6)+'\x20USDT'),console[_0x8f378d(0x15e)]('\x20\x20\x20Payout\x20amount:\x20'+_0x4f6f22[_0x8f378d(0x1b4)](0x6)+_0x8f378d(0x135)),console[_0x8f378d(0x15e)](_0x8f378d(0xcc)+_0x5883bd[_0x8f378d(0x1c4)]['toFixed'](0x6)+'\x20USDT');if(_0x432e52)console[_0x8f378d(0x15e)](_0x8f378d(0x1c3)+_0x432e52);if(_0x5883bd[_0x8f378d(0x116)]<_0x4f6f22)throw new Error(_0x8f378d(0x149)+_0x5883bd[_0x8f378d(0x116)]['toFixed'](0x6)+_0x8f378d(0x1f3)+_0x4f6f22[_0x8f378d(0x1b4)](0x6)+_0x8f378d(0x135));let _0x5d5da4=_0x42e122;if(!_0x5d5da4){const _0x294b32=await _0x3122db[_0x8f378d(0x1f4)][_0x8f378d(0x10f)]({'where':{'id':_0xaef08e},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x294b32)switch(_0x3aa779){case'polygon':_0x5d5da4=_0x294b32[_0x8f378d(0x184)]||undefined;break;case _0x8f378d(0x19e):_0x5d5da4=_0x294b32[_0x8f378d(0x1d3)]||undefined;break;case _0x8f378d(0x110):_0x5d5da4=_0x294b32[_0x8f378d(0x12f)]||undefined;break;case'polygon_usdc':_0x5d5da4=_0x294b32['usdcPolygonWallet']||undefined;break;}}console['log'](_0x8f378d(0x125)+_0x3aa779+':\x20'+(_0x5d5da4||_0x8f378d(0x14d)));const _0x12c365=await _0x3122db[_0x8f378d(0xd1)]['create']({'data':{'shopId':_0xaef08e,'amount':_0x4f6f22,'network':_0x3aa779,'status':_0x8f378d(0x178),'txid':_0x432e52,'notes':_0xd2c3b8,'periodFrom':_0xccd59e?new Date(_0xccd59e):null,'periodTo':_0x28c78d?new Date(_0x28c78d):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x4bb85d=_0x5883bd['balance']-_0x4f6f22,_0x17d5b4=_0x5883bd[_0x8f378d(0x1c4)]+_0x4f6f22;return await _0x3122db[_0x8f378d(0x1f4)]['update']({'where':{'id':_0xaef08e},'data':{'balance':_0x4bb85d,'totalPaidOut':_0x17d5b4}}),console[_0x8f378d(0x15e)]('üí∞\x20Shop\x20'+_0x5883bd[_0x8f378d(0x197)]+_0x8f378d(0x201)),console[_0x8f378d(0x15e)](_0x8f378d(0x1e5)+_0x5883bd[_0x8f378d(0x116)]['toFixed'](0x6)+_0x8f378d(0x144)+_0x4bb85d[_0x8f378d(0x1b4)](0x6)+_0x8f378d(0x11b)+_0x4f6f22[_0x8f378d(0x1b4)](0x6)+')'),console[_0x8f378d(0x15e)](_0x8f378d(0x19d)+_0x5883bd[_0x8f378d(0x1c4)][_0x8f378d(0x1b4)](0x6)+_0x8f378d(0x144)+_0x17d5b4[_0x8f378d(0x1b4)](0x6)+_0x8f378d(0xd9)+_0x4f6f22[_0x8f378d(0x1b4)](0x6)+')'),{'payout':_0x12c365,'shop':_0x5883bd};});return console[_0x492000(0x15e)](_0x492000(0x18d)+_0x3dde96[_0x492000(0xd1)]['id']+'\x20for\x20shop\x20'+_0x3dde96[_0x492000(0x1f4)][_0x492000(0x197)]+'\x20('+_0x4f6f22+_0x492000(0x188)),{'id':_0x3dde96['payout']['id'],'shopId':_0x3dde96[_0x492000(0xd1)][_0x492000(0x16e)],'shopName':_0x3dde96['shop'][_0x492000(0x13d)],'shopUsername':_0x3dde96[_0x492000(0x1f4)]['username'],'amount':_0x3dde96[_0x492000(0xd1)][_0x492000(0x19a)],'network':_0x3dde96[_0x492000(0xd1)][_0x492000(0x1d9)],'status':_0x3dde96[_0x492000(0xd1)][_0x492000(0x1eb)],'txid':_0x3dde96[_0x492000(0xd1)]['txid'],'notes':_0x3dde96[_0x492000(0xd1)][_0x492000(0x1b2)],'periodFrom':_0x3dde96[_0x492000(0xd1)]['periodFrom'],'periodTo':_0x3dde96[_0x492000(0xd1)][_0x492000(0x136)],'createdAt':_0x3dde96[_0x492000(0xd1)][_0x492000(0xe2)],'paidAt':_0x3dde96['payout'][_0x492000(0x1aa)]};}async[a36_0x2ad47b(0x15a)](_0xee57bc){const _0x33ef34=a36_0x2ad47b,{page:_0x536f45,limit:_0x3e5a67,shopId:_0x364fbe,network:_0x270253,dateFrom:_0x2324a7,dateTo:_0x2b7cfc,search:_0x1948f4}=_0xee57bc,_0x249da1=(_0x536f45-0x1)*_0x3e5a67,_0x5f14ae={};_0x364fbe&&(_0x5f14ae[_0x33ef34(0x16e)]=_0x364fbe);_0x270253&&(_0x5f14ae[_0x33ef34(0x1d9)]=_0x270253);(_0x2324a7||_0x2b7cfc)&&(_0x5f14ae[_0x33ef34(0xe2)]={},_0x2324a7&&(_0x5f14ae[_0x33ef34(0xe2)]['gte']=new Date(_0x2324a7)),_0x2b7cfc&&(_0x5f14ae['createdAt'][_0x33ef34(0x200)]=new Date(_0x2b7cfc)));_0x1948f4&&(_0x5f14ae['OR']=[{'shop':{'name':{'contains':_0x1948f4,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x1948f4,'mode':'insensitive'}}},{'notes':{'contains':_0x1948f4,'mode':_0x33ef34(0xfe)}}]);const [_0x483925,_0x27bb40]=await Promise['all']([database_1[_0x33ef34(0x1e3)][_0x33ef34(0xd1)][_0x33ef34(0x17f)]({'where':_0x5f14ae,'skip':_0x249da1,'take':_0x3e5a67,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x33ef34(0x1e3)][_0x33ef34(0xd1)][_0x33ef34(0xe1)]({'where':_0x5f14ae})]);return{'payouts':_0x483925[_0x33ef34(0x1e9)](_0x391a5=>({'id':_0x391a5['id'],'shopId':_0x391a5[_0x33ef34(0x16e)],'shopName':_0x391a5[_0x33ef34(0x1f4)][_0x33ef34(0x13d)],'shopUsername':_0x391a5[_0x33ef34(0x1f4)][_0x33ef34(0x197)],'amount':_0x391a5[_0x33ef34(0x19a)],'network':_0x391a5['network'],'status':_0x391a5[_0x33ef34(0x1eb)],'txid':_0x391a5[_0x33ef34(0x121)],'notes':_0x391a5['notes'],'periodFrom':_0x391a5['periodFrom'],'periodTo':_0x391a5[_0x33ef34(0x136)],'createdAt':_0x391a5[_0x33ef34(0xe2)],'paidAt':_0x391a5[_0x33ef34(0x1aa)]})),'pagination':{'page':_0x536f45,'limit':_0x3e5a67,'total':_0x27bb40,'totalPages':Math['ceil'](_0x27bb40/_0x3e5a67)}};}async['getPayoutById'](_0x837e53){const _0x5c4e5f=a36_0x2ad47b,_0x37a0c6=await database_1['default']['payout'][_0x5c4e5f(0x10f)]({'where':{'id':_0x837e53},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x37a0c6)return null;return{'id':_0x37a0c6['id'],'shopId':_0x37a0c6[_0x5c4e5f(0x16e)],'shopName':_0x37a0c6[_0x5c4e5f(0x1f4)][_0x5c4e5f(0x13d)],'shopUsername':_0x37a0c6[_0x5c4e5f(0x1f4)][_0x5c4e5f(0x197)],'amount':_0x37a0c6[_0x5c4e5f(0x19a)],'network':_0x37a0c6[_0x5c4e5f(0x1d9)],'status':_0x37a0c6[_0x5c4e5f(0x1eb)],'txid':_0x37a0c6[_0x5c4e5f(0x121)],'notes':_0x37a0c6[_0x5c4e5f(0x1b2)],'periodFrom':_0x37a0c6['periodFrom'],'periodTo':_0x37a0c6['periodTo'],'createdAt':_0x37a0c6[_0x5c4e5f(0xe2)],'paidAt':_0x37a0c6['paidAt']};}async[a36_0x2ad47b(0x10b)](_0x4e0d9e){const _0xb4fe52=a36_0x2ad47b;await database_1[_0xb4fe52(0x1e3)][_0xb4fe52(0xd1)][_0xb4fe52(0x1be)]({'where':{'id':_0x4e0d9e}});}async[a36_0x2ad47b(0x129)](_0x666df0){const _0x28d6bd=a36_0x2ad47b,{page:_0x42a64b,limit:_0xa67bb,status:_0x583974,gateway:_0x1924f7,shopId:_0x2fadb1,dateFrom:_0x598b6f,dateTo:_0x2b3dda,search:_0x217860,currency:_0x39d5cf,sortBy:_0x4edf73,sortOrder:_0x307ee7}=_0x666df0,_0x218de2=(_0x42a64b-0x1)*_0xa67bb;console['log'](_0x28d6bd(0x1e4),_0x666df0);const _0x3f1b44=await database_1[_0x28d6bd(0x1e3)][_0x28d6bd(0x117)][_0x28d6bd(0x17c)]({'by':['gateway'],'_count':{'gateway':!![]}});console[_0x28d6bd(0x15e)](_0x28d6bd(0x120),_0x3f1b44[_0x28d6bd(0x1e9)](_0x383c99=>_0x383c99['gateway']+'\x20('+_0x383c99[_0x28d6bd(0x15b)]['gateway']+'\x20payments)'));if(_0x1924f7){const _0xac4b74=_0x3f1b44[_0x28d6bd(0x13a)](_0x1aff1d=>_0x1aff1d[_0x28d6bd(0x1e7)]['toLowerCase']()===_0x1924f7[_0x28d6bd(0x122)]());!_0xac4b74&&_0x1924f7[_0x28d6bd(0x122)]()!==_0x28d6bd(0x143)&&console[_0x28d6bd(0x15e)]('‚ö†Ô∏è\x20Requested\x20gateway\x20\x27'+_0x1924f7+'\x27\x20not\x20found.\x20Available\x20gateways:\x20'+_0x3f1b44[_0x28d6bd(0x1e9)](_0x2a5aff=>_0x2a5aff['gateway'])[_0x28d6bd(0x1ef)](',\x20'));}const _0x1c1c36={};_0x583974&&(_0x1c1c36['status']=_0x583974[_0x28d6bd(0xd2)]());if(!_0x1924f7)_0x1c1c36[_0x28d6bd(0x1e7)]={'not':_0x28d6bd(0x143)};else{if(_0x1924f7&&(_0x1924f7['toLowerCase']()==='test_gateway'||_0x1924f7===_0x28d6bd(0x126)))_0x1c1c36[_0x28d6bd(0x1e7)]='test_gateway';else{let _0x46be72=_0x1924f7;const _0x196440=(0x0,gateway_1[_0x28d6bd(0x1da)])(_0x1924f7);if(_0x196440)_0x46be72=_0x196440,console[_0x28d6bd(0x15e)](_0x28d6bd(0x185)+_0x1924f7+_0x28d6bd(0x1bb)+_0x46be72+'\x27');else{const _0x13f957=(0x0,gateway_1[_0x28d6bd(0x19c)])(_0x1924f7);if(_0x13f957){const _0x2ffd2c=(0x0,gateway_1[_0x28d6bd(0x1da)])(_0x13f957);_0x2ffd2c&&(_0x46be72=_0x2ffd2c,console[_0x28d6bd(0x15e)]('üîÑ\x20Converted\x20gateway\x20name\x20\x27'+_0x1924f7+_0x28d6bd(0x124)+_0x13f957+_0x28d6bd(0x128)+_0x46be72+'\x27'));}else console[_0x28d6bd(0x15e)](_0x28d6bd(0x1d2)+_0x1924f7+_0x28d6bd(0x13e));}const _0x5cda14=await database_1[_0x28d6bd(0x1e3)]['payment']['count']({'where':{'gateway':_0x46be72[_0x28d6bd(0x122)]()},'take':0x1});_0x5cda14===0x0?(console['log']('‚ö†Ô∏è\x20Gateway\x20\x27'+_0x46be72+_0x28d6bd(0x18a)+_0x1924f7+_0x28d6bd(0x161)),_0x1c1c36['gateway']=_0x28d6bd(0x18b)):(_0x1c1c36[_0x28d6bd(0x1e7)]=_0x46be72[_0x28d6bd(0x122)](),console['log'](_0x28d6bd(0x15f)+_0x46be72+'\x27\x20(from\x20\x27'+_0x1924f7+'\x27)'));}}console[_0x28d6bd(0x15e)](_0x28d6bd(0xf8),_0x1c1c36[_0x28d6bd(0x1e7)]);_0x2fadb1&&(_0x1c1c36[_0x28d6bd(0x16e)]=_0x2fadb1);_0x39d5cf&&(_0x1c1c36['currency']=_0x39d5cf[_0x28d6bd(0xd2)](),console[_0x28d6bd(0x15e)]('üí±\x20Currency\x20filter\x20applied:\x20'+_0x39d5cf[_0x28d6bd(0xd2)]()));(_0x598b6f||_0x2b3dda)&&(_0x1c1c36[_0x28d6bd(0xe2)]={},_0x598b6f&&(_0x1c1c36[_0x28d6bd(0xe2)][_0x28d6bd(0x1de)]=new Date(_0x598b6f)),_0x2b3dda&&(_0x1c1c36['createdAt'][_0x28d6bd(0x200)]=new Date(_0x2b3dda)));_0x217860&&(_0x1c1c36['OR']=[{'id':{'contains':_0x217860,'mode':'insensitive'}},{'orderId':{'contains':_0x217860,'mode':_0x28d6bd(0xfe)}},{'gatewayOrderId':{'contains':_0x217860,'mode':_0x28d6bd(0xfe)}},{'customerEmail':{'contains':_0x217860,'mode':_0x28d6bd(0xfe)}},{'shop':{'name':{'contains':_0x217860,'mode':_0x28d6bd(0xfe)}}},{'shop':{'username':{'contains':_0x217860,'mode':_0x28d6bd(0xfe)}}}]);console[_0x28d6bd(0x15e)](_0x28d6bd(0x11e),JSON[_0x28d6bd(0xc7)](_0x1c1c36,null,0x2));let _0x32867c={'createdAt':_0x28d6bd(0x202)};if(_0x4edf73){const _0x23bcef=[_0x28d6bd(0x19a),_0x28d6bd(0xe2),_0x28d6bd(0x11d),_0x28d6bd(0x1eb),_0x28d6bd(0x1e7),_0x28d6bd(0xca)],_0x48675f=[_0x28d6bd(0x1db),_0x28d6bd(0x202)];if(_0x23bcef[_0x28d6bd(0x12a)](_0x4edf73)){const _0x549e49=_0x48675f[_0x28d6bd(0x12a)](_0x307ee7)?_0x307ee7:_0x28d6bd(0x202);_0x32867c={[_0x4edf73]:_0x549e49},console[_0x28d6bd(0x15e)](_0x28d6bd(0x173)+_0x4edf73+_0x28d6bd(0x163)+_0x549e49+_0x28d6bd(0x154));}}const [_0xdb9d96,_0x43f910]=await Promise[_0x28d6bd(0x123)]([database_1['default']['payment'][_0x28d6bd(0x17f)]({'where':_0x1c1c36,'skip':_0x218de2,'take':_0xa67bb,'orderBy':_0x32867c,'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x28d6bd(0x1e3)]['payment'][_0x28d6bd(0xe1)]({'where':_0x1c1c36})]);return{'payments':_0xdb9d96,'pagination':{'page':_0x42a64b,'limit':_0xa67bb,'total':_0x43f910,'totalPages':Math[_0x28d6bd(0x172)](_0x43f910/_0xa67bb)}};}async[a36_0x2ad47b(0x151)](_0x4e259f){const _0x2b5dfb=a36_0x2ad47b,_0x2227b9=await database_1['default'][_0x2b5dfb(0x117)][_0x2b5dfb(0x10f)]({'where':{'id':_0x4e259f},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x2227b9)return null;return{'id':_0x2227b9['id'],'shopId':_0x2227b9['shopId'],'gateway':_0x2227b9[_0x2b5dfb(0x1e7)],'amount':_0x2227b9['amount'],'currency':_0x2227b9[_0x2b5dfb(0xca)],'status':_0x2227b9[_0x2b5dfb(0x1eb)],'orderId':_0x2227b9[_0x2b5dfb(0x10e)],'gatewayOrderId':_0x2227b9[_0x2b5dfb(0xf4)],'customerEmail':_0x2227b9[_0x2b5dfb(0xe6)],'customerName':_0x2227b9['customerName'],'customerCountry':_0x2227b9['customerCountry'],'customerIp':_0x2227b9[_0x2b5dfb(0x168)],'customerUa':_0x2227b9['customerUa'],'failureMessage':_0x2227b9[_0x2b5dfb(0x203)],'externalPaymentUrl':_0x2227b9[_0x2b5dfb(0x13b)],'successUrl':_0x2227b9[_0x2b5dfb(0x17e)],'failUrl':_0x2227b9[_0x2b5dfb(0xc1)],'pendingUrl':_0x2227b9['pendingUrl'],'whiteUrl':_0x2227b9[_0x2b5dfb(0x18f)],'createdAt':_0x2227b9[_0x2b5dfb(0xe2)],'updatedAt':_0x2227b9[_0x2b5dfb(0x11d)],'shop':_0x2227b9['shop']};}async['updatePaymentStatus'](_0x2c1f84,_0x144ef3,_0x4dc494,_0xfdb43e){const _0x546948=a36_0x2ad47b,_0x4dd4d0=await database_1['default'][_0x546948(0x19f)](async _0x2b4a3a=>{const _0x32aae3=_0x546948,_0x5c111f=await _0x2b4a3a[_0x32aae3(0x117)][_0x32aae3(0x10f)]({'where':{'id':_0x2c1f84},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x5c111f)throw new Error(_0x32aae3(0x101));const _0x11d7c0=_0x5c111f[_0x32aae3(0x1eb)],_0x147271=_0x144ef3[_0x32aae3(0xd2)]();console[_0x32aae3(0x15e)]('üîÑ\x20Admin\x20updating\x20payment\x20'+_0x2c1f84+_0x32aae3(0x113)+_0x11d7c0+_0x32aae3(0x144)+_0x147271),console[_0x32aae3(0x15e)](_0x32aae3(0xec)+_0x5c111f[_0x32aae3(0x1f4)][_0x32aae3(0x116)]+_0x32aae3(0x135));const _0xf7b3f5={'status':_0x147271,'updatedAt':new Date(),'statusChangedBy':'admin','statusChangedAt':new Date()};_0x4dc494&&(_0xf7b3f5['adminNotes']=_0x4dc494);_0x147271===_0x32aae3(0xe0)&&_0xfdb43e&&(_0xf7b3f5[_0x32aae3(0x119)]=_0xfdb43e);let _0x1716a7=0x0,_0x535823=_0x5c111f[_0x32aae3(0x1f4)]['balance'];if(_0x147271===_0x32aae3(0x182)&&_0x11d7c0!=='PAID'){_0xf7b3f5[_0x32aae3(0x1aa)]=new Date();const _0x3521de=await currencyService_1[_0x32aae3(0x145)][_0x32aae3(0x157)](_0x5c111f[_0x32aae3(0x19a)],_0x5c111f[_0x32aae3(0xca)]);_0xf7b3f5[_0x32aae3(0x1c5)]=_0x3521de;let _0x10a0eb=0x2d;const _0x2291ad=await _0x2b4a3a['shop']['findUnique']({'where':{'id':_0x5c111f[_0x32aae3(0x16e)]},'select':{'gatewaySettings':!![]}});if(_0x2291ad?.['gatewaySettings'])try{const _0x56342c=JSON[_0x32aae3(0x175)](_0x2291ad['gatewaySettings']);for(const [_0x4ff91c,_0xb8024]of Object[_0x32aae3(0x1ee)](_0x56342c)){if(_0x4ff91c[_0x32aae3(0x122)]()===_0x5c111f[_0x32aae3(0x1e7)]['toLowerCase']()){_0x10a0eb=_0xb8024[_0x32aae3(0x1cc)]||0xa;break;}}}catch(_0x3c77fa){console[_0x32aae3(0xe8)](_0x32aae3(0xc9)+_0x2c1f84+':',_0x3c77fa);}let _0x141708;_0x5c111f['amountAfterGatewayCommissionUSDT']!==null&&_0x5c111f[_0x32aae3(0x146)]!==undefined?(_0x141708=_0x5c111f['amountAfterGatewayCommissionUSDT'],console[_0x32aae3(0x15e)](_0x32aae3(0xc6)+_0x141708['toFixed'](0x6)+_0x32aae3(0xc0)+_0x2c1f84)):(_0x141708=_0x3521de*(0x1-_0x10a0eb/0x64),console[_0x32aae3(0x15e)](_0x32aae3(0xf2)+_0x2c1f84+':\x20'+_0x10a0eb+_0x32aae3(0x1a2)+_0x3521de[_0x32aae3(0x1b4)](0x6)+_0x32aae3(0x135)),_0xf7b3f5[_0x32aae3(0x146)]=_0x141708,_0xf7b3f5[_0x32aae3(0xdb)]=_0x10a0eb),_0x1716a7=_0x141708,_0x535823+=_0x141708,console[_0x32aae3(0x15e)](_0x32aae3(0x1fd)+_0x2c1f84+_0x32aae3(0x155)),console[_0x32aae3(0x15e)](_0x32aae3(0x104)+_0x3521de[_0x32aae3(0x1b4)](0x6)+_0x32aae3(0x135)),console[_0x32aae3(0x15e)](_0x32aae3(0x16f)+_0x5c111f['gateway']+_0x32aae3(0xfd)+_0x10a0eb+'%'),console[_0x32aae3(0x15e)]('\x20\x20\x20Merchant\x20gets:\x20'+_0x141708[_0x32aae3(0x1b4)](0x6)+_0x32aae3(0x174)+_0x10a0eb+_0x32aae3(0x176)),console['log']('\x20\x20\x20Added\x20to\x20balance:\x20+'+_0x141708[_0x32aae3(0x1b4)](0x6)+'\x20USDT');}else{if(_0x11d7c0===_0x32aae3(0x182)&&_0x147271!==_0x32aae3(0x182)){if(_0x5c111f[_0x32aae3(0x1c5)]){let _0x25100c=0x2d;const _0x1316a4=await _0x2b4a3a[_0x32aae3(0x1f4)][_0x32aae3(0x10f)]({'where':{'id':_0x5c111f[_0x32aae3(0x16e)]},'select':{'gatewaySettings':!![]}});if(_0x1316a4?.[_0x32aae3(0x106)])try{const _0x53a499=JSON['parse'](_0x1316a4['gatewaySettings']);for(const [_0x2426fc,_0x588ba7]of Object[_0x32aae3(0x1ee)](_0x53a499)){if(_0x2426fc[_0x32aae3(0x122)]()===_0x5c111f[_0x32aae3(0x1e7)][_0x32aae3(0x122)]()){_0x25100c=_0x588ba7[_0x32aae3(0x1cc)]||0xa;break;}}}catch(_0x3c58b6){console['error'](_0x32aae3(0xc9)+_0x2c1f84+':',_0x3c58b6);}const _0x34cb96=_0x5c111f[_0x32aae3(0x1c5)]*(0x1-_0x25100c/0x64);_0x1716a7=-_0x34cb96,_0x535823-=_0x34cb96,_0xf7b3f5[_0x32aae3(0x1c5)]=null,_0xf7b3f5[_0x32aae3(0x146)]=null,console['log']('üí∞\x20Payment\x20'+_0x2c1f84+_0x32aae3(0x1f1)),console[_0x32aae3(0x15e)](_0x32aae3(0x104)+_0x5c111f[_0x32aae3(0x1c5)][_0x32aae3(0x1b4)](0x6)+_0x32aae3(0x135)),console[_0x32aae3(0x15e)](_0x32aae3(0x16f)+_0x5c111f['gateway']+_0x32aae3(0xfd)+_0x25100c+'%'),console[_0x32aae3(0x15e)](_0x32aae3(0xc5)+_0x34cb96[_0x32aae3(0x1b4)](0x6)+_0x32aae3(0x174)+_0x25100c+_0x32aae3(0x176)),console[_0x32aae3(0x15e)](_0x32aae3(0x132)+_0x34cb96[_0x32aae3(0x1b4)](0x6)+_0x32aae3(0x135));}}}_0x147271===_0x32aae3(0xe0)&&(_0x11d7c0==='PAID'&&_0x5c111f[_0x32aae3(0x1c5)]&&console[_0x32aae3(0x15e)](_0x32aae3(0x16a)),_0xfdb43e&&_0xfdb43e>0x0&&(_0x1716a7-=_0xfdb43e,_0x535823-=_0xfdb43e,console[_0x32aae3(0x15e)]('üí∏\x20CHARGEBACK\x20penalty:\x20-'+_0xfdb43e[_0x32aae3(0x1b4)](0x6)+_0x32aae3(0x11f))));_0x147271===_0x32aae3(0x15c)&&_0x11d7c0===_0x32aae3(0x182)&&console[_0x32aae3(0x15e)](_0x32aae3(0xff));const _0x18cc4e=await _0x2b4a3a[_0x32aae3(0x117)]['update']({'where':{'id':_0x2c1f84},'data':_0xf7b3f5,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x1716a7!==0x0&&(await _0x2b4a3a[_0x32aae3(0x1f4)][_0x32aae3(0x1d5)]({'where':{'id':_0x5c111f[_0x32aae3(0x16e)]},'data':{'balance':_0x535823}}),console[_0x32aae3(0x15e)](_0x32aae3(0xf9)+_0x5c111f[_0x32aae3(0x16e)]+'\x20balance\x20updated:\x20'+_0x5c111f[_0x32aae3(0x1f4)][_0x32aae3(0x116)][_0x32aae3(0x1b4)](0x6)+_0x32aae3(0x144)+_0x535823['toFixed'](0x6)+_0x32aae3(0x1b8)+(_0x1716a7>0x0?'+':'')+_0x1716a7[_0x32aae3(0x1b4)](0x6)+')')),_0x18cc4e;});return{'id':_0x4dd4d0['id'],'shopId':_0x4dd4d0['shopId'],'gateway':_0x4dd4d0[_0x546948(0x1e7)],'amount':_0x4dd4d0[_0x546948(0x19a)],'currency':_0x4dd4d0['currency'],'status':_0x4dd4d0[_0x546948(0x1eb)],'orderId':_0x4dd4d0[_0x546948(0x10e)],'gatewayOrderId':_0x4dd4d0['gatewayOrderId'],'customerEmail':_0x4dd4d0[_0x546948(0xe6)],'customerName':_0x4dd4d0[_0x546948(0x1e1)],'customerCountry':_0x4dd4d0[_0x546948(0xc3)],'customerIp':_0x4dd4d0[_0x546948(0x168)],'customerUa':_0x4dd4d0[_0x546948(0x164)],'failureMessage':_0x4dd4d0['failureMessage'],'adminNotes':_0x4dd4d0[_0x546948(0x1cd)],'chargebackAmount':_0x4dd4d0['chargebackAmount'],'statusChangedBy':_0x4dd4d0[_0x546948(0x1f2)],'statusChangedAt':_0x4dd4d0[_0x546948(0x1c7)],'createdAt':_0x4dd4d0[_0x546948(0xe2)],'updatedAt':_0x4dd4d0[_0x546948(0x11d)],'shop':_0x4dd4d0[_0x546948(0x1f4)]};}async[a36_0x2ad47b(0x1d0)](_0x3cb95b,_0x75592b){const _0x26b483=a36_0x2ad47b,_0x32a405=Math[_0x26b483(0x1e8)]()['toString'](0x24)[_0x26b483(0xc2)](0x2,0x9);console[_0x26b483(0x15e)](_0x26b483(0x1ab)+_0x32a405+_0x26b483(0xd7)+_0x3cb95b);const _0xc1ee52={..._0x75592b};_0x75592b[_0x26b483(0xd8)]&&_0x75592b[_0x26b483(0xd8)][_0x26b483(0xda)]()!==''?(console[_0x26b483(0x15e)]('üîê\x20['+_0x32a405+_0x26b483(0x1b6)+_0x3cb95b),_0xc1ee52[_0x26b483(0xd8)]=await bcryptjs_1[_0x26b483(0x1e3)]['hash'](_0x75592b['password'],0xc)):(console[_0x26b483(0x15e)](_0x26b483(0xef)+_0x32a405+_0x26b483(0xee)),delete _0xc1ee52[_0x26b483(0xd8)]);_0x75592b[_0x26b483(0x103)]&&(_0xc1ee52[_0x26b483(0x13d)]=_0x75592b[_0x26b483(0x103)],delete _0xc1ee52[_0x26b483(0x103)]);_0x75592b[_0x26b483(0x170)]&&(_0xc1ee52[_0x26b483(0x1ad)]=_0x75592b[_0x26b483(0x170)],delete _0xc1ee52[_0x26b483(0x170)]);_0x75592b[_0x26b483(0x1f5)]&&(_0xc1ee52[_0x26b483(0x14b)]=_0x75592b[_0x26b483(0x1f5)],delete _0xc1ee52[_0x26b483(0x1f5)]);if(_0x75592b[_0x26b483(0xe3)]){const _0x5bda66=_0x75592b[_0x26b483(0xe3)][_0x26b483(0x1e9)](_0x30fb9d=>this[_0x26b483(0x10a)](_0x30fb9d));console['log'](_0x26b483(0x14c),_0x75592b['gateways'],'->',_0x5bda66),_0xc1ee52[_0x26b483(0x140)]=JSON[_0x26b483(0xc7)](_0x5bda66),delete _0xc1ee52[_0x26b483(0xe3)];}_0x75592b[_0x26b483(0x106)]&&(console[_0x26b483(0x15e)]('üîß\x20['+_0x32a405+_0x26b483(0x1bc),_0x75592b[_0x26b483(0x106)]),_0xc1ee52['gatewaySettings']=JSON[_0x26b483(0xc7)](_0x75592b[_0x26b483(0x106)]),console['log'](_0x26b483(0x1a4)+_0x32a405+']\x20Gateway\x20settings\x20JSON\x20string:',_0xc1ee52[_0x26b483(0x106)]));_0x75592b['wallets']&&(_0x75592b[_0x26b483(0x169)][_0x26b483(0x184)]!==undefined&&(_0xc1ee52[_0x26b483(0x184)]=_0x75592b[_0x26b483(0x169)][_0x26b483(0x184)]||null),_0x75592b['wallets'][_0x26b483(0x1d3)]!==undefined&&(_0xc1ee52[_0x26b483(0x1d3)]=_0x75592b[_0x26b483(0x169)][_0x26b483(0x1d3)]||null),_0x75592b[_0x26b483(0x169)][_0x26b483(0x12f)]!==undefined&&(_0xc1ee52[_0x26b483(0x12f)]=_0x75592b[_0x26b483(0x169)]['usdtErcWallet']||null),_0x75592b[_0x26b483(0x169)][_0x26b483(0x166)]!==undefined&&(_0xc1ee52[_0x26b483(0x166)]=_0x75592b[_0x26b483(0x169)]['usdcPolygonWallet']||null),delete _0xc1ee52[_0x26b483(0x169)]);const _0x4035d3=await database_1[_0x26b483(0x1e3)][_0x26b483(0x1f4)][_0x26b483(0x1d5)]({'where':{'id':_0x3cb95b},'data':_0xc1ee52,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console['log'](_0x26b483(0x14a)+_0x32a405+_0x26b483(0x196),_0x4035d3['gatewaySettings']),{'id':_0x4035d3['id'],'fullName':_0x4035d3[_0x26b483(0x13d)],'username':_0x4035d3[_0x26b483(0x197)],'telegramId':_0x4035d3[_0x26b483(0x1ad)],'merchantUrl':_0x4035d3[_0x26b483(0x14b)],'gateways':_0x4035d3['paymentGateways']?JSON[_0x26b483(0x175)](_0x4035d3[_0x26b483(0x140)]):null,'gatewaySettings':_0x4035d3[_0x26b483(0x106)]?JSON[_0x26b483(0x175)](_0x4035d3['gatewaySettings']):null,'publicKey':_0x4035d3['publicKey'],'wallets':{'usdtPolygonWallet':_0x4035d3[_0x26b483(0x184)],'usdtTrcWallet':_0x4035d3[_0x26b483(0x1d3)],'usdtErcWallet':_0x4035d3[_0x26b483(0x12f)],'usdcPolygonWallet':_0x4035d3['usdcPolygonWallet']},'status':_0x4035d3[_0x26b483(0x1eb)],'createdAt':_0x4035d3[_0x26b483(0xe2)]};}async[a36_0x2ad47b(0xde)](_0x2ad8af){const _0x283e76=a36_0x2ad47b,_0x320523=await database_1[_0x283e76(0x1e3)][_0x283e76(0x1f4)][_0x283e76(0x1d5)]({'where':{'id':_0x2ad8af},'data':{'status':_0x283e76(0xdf)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x320523['id'],'fullName':_0x320523[_0x283e76(0x13d)],'username':_0x320523[_0x283e76(0x197)],'telegramId':_0x320523['telegram'],'merchantUrl':_0x320523[_0x283e76(0x14b)],'gateways':_0x320523[_0x283e76(0x140)]?JSON[_0x283e76(0x175)](_0x320523[_0x283e76(0x140)]):null,'gatewaySettings':_0x320523[_0x283e76(0x106)]?JSON[_0x283e76(0x175)](_0x320523[_0x283e76(0x106)]):null,'publicKey':_0x320523[_0x283e76(0x1dc)],'wallets':{'usdtPolygonWallet':_0x320523[_0x283e76(0x184)],'usdtTrcWallet':_0x320523['usdtTrcWallet'],'usdtErcWallet':_0x320523[_0x283e76(0x12f)],'usdcPolygonWallet':_0x320523[_0x283e76(0x166)]},'status':_0x320523[_0x283e76(0x1eb)],'createdAt':_0x320523['createdAt']};}async[a36_0x2ad47b(0x1b0)](_0x1c01df){const _0x17e850=a36_0x2ad47b,_0x1a2d2b=await database_1[_0x17e850(0x1e3)][_0x17e850(0x1f4)][_0x17e850(0x1d5)]({'where':{'id':_0x1c01df},'data':{'status':_0x17e850(0x1ba)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x1a2d2b['id'],'fullName':_0x1a2d2b[_0x17e850(0x13d)],'username':_0x1a2d2b[_0x17e850(0x197)],'telegramId':_0x1a2d2b[_0x17e850(0x1ad)],'merchantUrl':_0x1a2d2b[_0x17e850(0x14b)],'gateways':_0x1a2d2b[_0x17e850(0x140)]?JSON['parse'](_0x1a2d2b[_0x17e850(0x140)]):null,'gatewaySettings':_0x1a2d2b[_0x17e850(0x106)]?JSON['parse'](_0x1a2d2b[_0x17e850(0x106)]):null,'publicKey':_0x1a2d2b[_0x17e850(0x1dc)],'wallets':{'usdtPolygonWallet':_0x1a2d2b[_0x17e850(0x184)],'usdtTrcWallet':_0x1a2d2b['usdtTrcWallet'],'usdtErcWallet':_0x1a2d2b[_0x17e850(0x12f)],'usdcPolygonWallet':_0x1a2d2b[_0x17e850(0x166)]},'status':_0x1a2d2b[_0x17e850(0x1eb)],'createdAt':_0x1a2d2b[_0x17e850(0xe2)]};}async['getAllUsers'](_0x26b28e){const _0x251b4d=a36_0x2ad47b,{page:_0x11621a,limit:_0x22fab6,status:_0x40f188}=_0x26b28e,_0x187c36=(_0x11621a-0x1)*_0x22fab6,_0x1b829c={};_0x40f188&&(_0x1b829c[_0x251b4d(0x1eb)]=_0x40f188['toUpperCase']());const [_0x217d63,_0x4b4396]=await Promise[_0x251b4d(0x123)]([database_1[_0x251b4d(0x1e3)][_0x251b4d(0x1f4)][_0x251b4d(0x17f)]({'where':_0x1b829c,'skip':_0x187c36,'take':_0x22fab6,'orderBy':{'createdAt':_0x251b4d(0x202)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x251b4d(0x1e3)][_0x251b4d(0x1f4)][_0x251b4d(0xe1)]({'where':_0x1b829c})]);return{'users':_0x217d63[_0x251b4d(0x1e9)](_0x25d2c3=>{const _0x4df8db=_0x251b4d,_0x5ead1e=_0x25d2c3[_0x4df8db(0x140)]?JSON[_0x4df8db(0x175)](_0x25d2c3[_0x4df8db(0x140)]):null,_0x50da6c=_0x5ead1e?_0x5ead1e[_0x4df8db(0x1e9)](_0x1adea6=>this[_0x4df8db(0x156)](_0x1adea6)):null;return{'id':_0x25d2c3['id'],'fullName':_0x25d2c3[_0x4df8db(0x13d)],'username':_0x25d2c3[_0x4df8db(0x197)],'telegramId':_0x25d2c3[_0x4df8db(0x1ad)],'merchantUrl':_0x25d2c3[_0x4df8db(0x14b)],'gateways':_0x50da6c,'gatewaySettings':_0x25d2c3['gatewaySettings']?JSON['parse'](_0x25d2c3[_0x4df8db(0x106)]):null,'publicKey':_0x25d2c3['publicKey'],'wallets':{'usdtPolygonWallet':_0x25d2c3[_0x4df8db(0x184)],'usdtTrcWallet':_0x25d2c3[_0x4df8db(0x1d3)],'usdtErcWallet':_0x25d2c3['usdtErcWallet'],'usdcPolygonWallet':_0x25d2c3[_0x4df8db(0x166)]},'status':_0x25d2c3[_0x4df8db(0x1eb)],'createdAt':_0x25d2c3[_0x4df8db(0xe2)]};}),'pagination':{'page':_0x11621a,'limit':_0x22fab6,'total':_0x4b4396,'totalPages':Math[_0x251b4d(0x172)](_0x4b4396/_0x22fab6)}};}async[a36_0x2ad47b(0x1d1)](_0x628a0b){const _0x5c774b=a36_0x2ad47b,_0x3086f2=await database_1['default']['shop'][_0x5c774b(0x10f)]({'where':{'id':_0x628a0b},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x3086f2)return null;const _0x514654=_0x3086f2[_0x5c774b(0x140)]?JSON[_0x5c774b(0x175)](_0x3086f2[_0x5c774b(0x140)]):null,_0x4807c8=_0x514654?_0x514654[_0x5c774b(0x1e9)](_0x386ae3=>this['getGatewayDisplayName'](_0x386ae3)):null;return _0x514654&&_0x4807c8&&console['log'](_0x5c774b(0x134),_0x514654,'->',_0x4807c8),{'id':_0x3086f2['id'],'fullName':_0x3086f2[_0x5c774b(0x13d)],'username':_0x3086f2[_0x5c774b(0x197)],'telegramId':_0x3086f2['telegram'],'merchantUrl':_0x3086f2[_0x5c774b(0x14b)],'gateways':_0x4807c8,'gatewaySettings':_0x3086f2['gatewaySettings']?JSON[_0x5c774b(0x175)](_0x3086f2['gatewaySettings']):null,'publicKey':_0x3086f2[_0x5c774b(0x1dc)],'wallets':{'usdtPolygonWallet':_0x3086f2[_0x5c774b(0x184)],'usdtTrcWallet':_0x3086f2[_0x5c774b(0x1d3)],'usdtErcWallet':_0x3086f2[_0x5c774b(0x12f)],'usdcPolygonWallet':_0x3086f2[_0x5c774b(0x166)]},'status':_0x3086f2['status'],'createdAt':_0x3086f2['createdAt']};}async[a36_0x2ad47b(0x194)](_0x361e90){const _0x10a889=a36_0x2ad47b,{fullName:_0x91878e,username:_0x266485,password:_0x1a768e,telegramId:_0x5265a5,merchantUrl:_0x2be564,gateways:_0x2de05a,gatewaySettings:_0x1c79e9,wallets:_0x4c049b}=_0x361e90,_0x281965=await database_1[_0x10a889(0x1e3)][_0x10a889(0x1f4)][_0x10a889(0x10f)]({'where':{'username':_0x266485}});if(_0x281965)throw new Error('Username\x20already\x20exists');if(_0x5265a5){const _0xb3193a=await database_1[_0x10a889(0x1e3)][_0x10a889(0x1f4)][_0x10a889(0x10f)]({'where':{'telegram':_0x5265a5}});if(_0xb3193a)throw new Error(_0x10a889(0x1ea));}const _0x2b2ae4=await bcryptjs_1[_0x10a889(0x1e3)][_0x10a889(0x1b3)](_0x1a768e,0xc),_0x308cc0=_0x10a889(0x1b7)+crypto_1[_0x10a889(0x1e3)][_0x10a889(0x137)](0x20)[_0x10a889(0x13c)]('hex'),_0x31fdca='sk_'+crypto_1['default'][_0x10a889(0x137)](0x20)['toString'](_0x10a889(0x1f0)),_0x29ebf0=_0x2de05a?_0x2de05a[_0x10a889(0x1e9)](_0x2de76a=>this[_0x10a889(0x10a)](_0x2de76a)):null;_0x2de05a&&_0x29ebf0&&console[_0x10a889(0x15e)](_0x10a889(0xd4),_0x2de05a,'->',_0x29ebf0);const _0x3c7187=await database_1[_0x10a889(0x1e3)][_0x10a889(0x1f4)]['create']({'data':{'name':_0x91878e,'username':_0x266485,'password':_0x2b2ae4,'telegram':_0x5265a5,'shopUrl':_0x2be564,'paymentGateways':_0x29ebf0?JSON[_0x10a889(0xc7)](_0x29ebf0):null,'gatewaySettings':_0x1c79e9?JSON[_0x10a889(0xc7)](_0x1c79e9):null,'usdtPolygonWallet':_0x4c049b?.[_0x10a889(0x184)]||null,'usdtTrcWallet':_0x4c049b?.[_0x10a889(0x1d3)]||null,'usdtErcWallet':_0x4c049b?.[_0x10a889(0x12f)]||null,'usdcPolygonWallet':_0x4c049b?.['usdcPolygonWallet']||null,'publicKey':_0x308cc0,'secretKey':_0x31fdca,'status':_0x10a889(0x1ba)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x3c7187['id'],'fullName':_0x3c7187['name'],'username':_0x3c7187[_0x10a889(0x197)],'telegramId':_0x3c7187[_0x10a889(0x1ad)],'merchantUrl':_0x3c7187['shopUrl'],'gateways':_0x3c7187['paymentGateways']?JSON[_0x10a889(0x175)](_0x3c7187[_0x10a889(0x140)]):null,'gatewaySettings':_0x3c7187[_0x10a889(0x106)]?JSON['parse'](_0x3c7187[_0x10a889(0x106)]):null,'publicKey':_0x3c7187[_0x10a889(0x1dc)],'wallets':{'usdtPolygonWallet':_0x3c7187[_0x10a889(0x184)],'usdtTrcWallet':_0x3c7187[_0x10a889(0x1d3)],'usdtErcWallet':_0x3c7187[_0x10a889(0x12f)],'usdcPolygonWallet':_0x3c7187[_0x10a889(0x166)]},'status':_0x3c7187[_0x10a889(0x1eb)],'createdAt':_0x3c7187[_0x10a889(0xe2)]};}async[a36_0x2ad47b(0x195)](_0x496402){const _0x17fb4d=a36_0x2ad47b;await database_1[_0x17fb4d(0x1e3)][_0x17fb4d(0x1f4)][_0x17fb4d(0x1be)]({'where':{'id':_0x496402}});}[a36_0x2ad47b(0x152)](_0x25f1e3,_0x201cc4,_0x2fd7eb){const _0xd69b31=a36_0x2ad47b,_0x69f0af=new Map(),_0x22feaf=new Date(_0x201cc4);while(_0x22feaf<=_0x2fd7eb){const _0x1c4547=_0x22feaf[_0xd69b31(0x1bf)]()[_0xd69b31(0xd0)]('T')[0x0];_0x69f0af['set'](_0x1c4547,{'revenue':0x0,'count':0x0}),_0x22feaf['setDate'](_0x22feaf[_0xd69b31(0x191)]()+0x1);}for(const _0x5eb076 of _0x25f1e3){const _0x3d5f18=_0x5eb076['createdAt'][_0xd69b31(0x1bf)]()['split']('T')[0x0],_0x2a097=_0x69f0af['get'](_0x3d5f18);_0x2a097&&(_0x2a097['count']+=0x1,_0x5eb076[_0xd69b31(0x1eb)]===_0xd69b31(0x182)&&(_0x5eb076[_0xd69b31(0x1c5)]?_0x2a097[_0xd69b31(0x199)]+=_0x5eb076['amountUSDT']:console[_0xd69b31(0x15e)](_0xd69b31(0x1a5)+_0x5eb076['id']+_0xd69b31(0x114))));}const _0x5add6d=[],_0x4806ec=[];for(const [_0x139ce9,_0xa79215]of _0x69f0af){_0x5add6d[_0xd69b31(0xf7)]({'date':_0x139ce9,'amount':Math['round'](_0xa79215[_0xd69b31(0x199)]*0x64)/0x64}),_0x4806ec[_0xd69b31(0xf7)]({'date':_0x139ce9,'count':_0xa79215[_0xd69b31(0xe1)]});}return{'dailyRevenue':_0x5add6d,'dailyPayments':_0x4806ec};}}exports[a36_0x2ad47b(0x1b9)]=AdminService;