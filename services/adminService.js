'use strict';const a38_0xc71753=a38_0x14b4;(function(_0x35c453,_0x5d3656){const _0x10935e=a38_0x14b4,_0x4833f4=_0x35c453();while(!![]){try{const _0x54c142=-parseInt(_0x10935e(0x155))/0x1+-parseInt(_0x10935e(0xea))/0x2*(-parseInt(_0x10935e(0x19d))/0x3)+-parseInt(_0x10935e(0x1aa))/0x4*(-parseInt(_0x10935e(0x127))/0x5)+parseInt(_0x10935e(0xb9))/0x6+-parseInt(_0x10935e(0x1bc))/0x7*(parseInt(_0x10935e(0x150))/0x8)+parseInt(_0x10935e(0x1cc))/0x9*(parseInt(_0x10935e(0x16d))/0xa)+-parseInt(_0x10935e(0x15d))/0xb*(parseInt(_0x10935e(0x1a9))/0xc);if(_0x54c142===_0x5d3656)break;else _0x4833f4['push'](_0x4833f4['shift']());}catch(_0x2ed390){_0x4833f4['push'](_0x4833f4['shift']());}}}(a38_0x38a9,0xda141));var __importDefault=this&&this['__importDefault']||function(_0x289476){return _0x289476&&_0x289476['__esModule']?_0x289476:{'default':_0x289476};};Object[a38_0xc71753(0xec)](exports,a38_0xc71753(0x133),{'value':!![]}),exports[a38_0xc71753(0xa4)]=void 0x0;function a38_0x14b4(_0x24dbae,_0x1054d7){const _0x38a9fb=a38_0x38a9();return a38_0x14b4=function(_0x14b4f1,_0x3522cb){_0x14b4f1=_0x14b4f1-0x93;let _0xa0cce4=_0x38a9fb[_0x14b4f1];return _0xa0cce4;},a38_0x14b4(_0x24dbae,_0x1054d7);}function a38_0x38a9(){const _0x1bbc06=['trc20','telegram','gateway','noda','merchantEarnings','\x20in\x20','📊\x20Final\x20WHERE\x20conditions:','getGatewayInternalName','totalTurnover','\x20\x20\x20📅\x20This\x20month:\x20','⚠️\x20Gateway\x20\x27','year','turnoverUSDT','payment','\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)','gatewayOrderId','gatewaySettings','createUser','failUrl','hex','random','🔄\x20Gateway\x20mapping:','count','PENDING','KLYME\x20DE','whiteUrl','ceil',',\x20Commission:\x20','usdcPolygonWallet','desc','\x20\x20\x20💸\x20Total\x20payouts\x20(all\x20time):\x20','externalPaymentUrl','getMerchantsAwaitingPayout','💰\x20Found\x20','\x20for\x20shop\x20','💰\x20Creating\x20payout\x20for\x20shop\x20','✅\x20Payout\x20created:\x20','network','3eeovAV','customerUa','dateFrom','_sum','\x20\x20\x20💰\x20Total\x20payments\x20turnover:\x20','period','Rapyd','klyme_gb','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','%\x20from\x20','username','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','24GgIrzq','6393828BsCSaH','suspendUser','\x20\x20\x20Payout\x20amount:\x20','Insufficient\x20balance.\x20Available:\x20','amount','📅\x20Period:\x20','pk_','includes','../config/database','getMerchantsSelection','date','polygon_usdc','\x20USDT\x20(total\x20paid\x20to\x20merchants)','push','week','📊\x20Calculating\x20payout\x20statistics...','\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)','findMany','119MQtOiS','toLowerCase','💳\x20Payout\x20wallet\x20for\x20','Username\x20already\x20exists','createPayout','shopId','status','substr','💸\x20CHARGEBACK:\x20Merchant\x20amount\x20already\x20deducted\x20from\x20balance','balance','📊\x20Calculated\x20commission\x20rate\x20for\x20payment\x20','ACTIVE','\x27\x20(from\x20\x27','commission','pendingUrl','getTime','9fgpKie','📊\x20Payout\x20statistics\x20calculated:','set','KLYME\x20GB','\x20\x20\x20🌐\x20IP:\x20','day','deletePayout','30d','deleteUser','delete','\x20USDT','amountAfterGatewayCommissionUSDT','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','\x20active\x20merchants\x20for\x20selection','setHours','🎯\x20updateUser\x20called\x20with\x20ID:\x20','📊\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20','setDate','aggregate','🔄\x20Converted\x20gateway\x20name\x20\x27','map','findUnique','periodTo','telegramId','\x20\x20\x20Current\x20balance:\x20','custom','mastercard','2020-01-01','REFUND','\x20\x20\x20�\x20Total\x20paid\x20out:\x20','amountAfterCommissionUSDT','name','getGatewayDisplayName','AdminService','usdtErcWallet','cointopay2','amountUSDT','totalCommissionRate','update','paidOutUSDT','fullName','getPaymentById','shop','90d','updatePaymentStatus','\x20USDT\x20(gross\x20revenue)',']\x20Gateway\x20settings\x20before\x20saving:','getGatewayIdByName','turnover','📊\x20Total\x20payments\x20(including\x20failed):\x20','\x20\x20\x20📅\x20Total\x20payouts\x20(this\x20month):\x20','CoinToPay','payout','toUpperCase','10557642gltsUr','totalPayout','merchantUrl',':\x20commission\x20=\x20','getPayoutById','\x20\x20\x20�\x20Total\x20payments\x20turnover:\x20','currency','getDate','getPayoutStats','getSystemStatistics','getUserById',']\x20Gateway\x20settings\x20JSON\x20string:','\x20balance\x20updated:','\x20USDT\x20(+','default','klyme_de','\x20status:\x20','Payment\x20not\x20found','generateDailyStatistics','wallets','🔄\x20Converted\x20gateway\x20ID\x20\x27','gatewayCommissionRate','warn','Plisio','📋\x20Found\x20','\x20no\x20longer\x20PAID:','currencyService','\x20\x20\x20Gateway:\x20','\x20USDT,\x20Requested:\x20','📊\x20Available\x20gateways\x20in\x20database:','PAID','dailyPayments','parse','stringify','chargebackAmount','getGatewayNameById','yesterday','toString','lte','\x20\x20\x20Added\x20to\x20balance:\x20+','create','merchantEarningsUSDT','asc','paidAt','⚠️\x20Payment\x20','reduce','customerEmail','all','publicKey','2944988KwWUek','error','defineProperty','adminNotes','gatewayEarnings','updateUser','💰\x20Payment\x20','\x20\x20\x20💰\x20Total\x20turnover:\x20','forEach','Open\x20Banking\x202','convertToUSDT','\x20\x20\x20Balance:\x20','🔍\x20Using\x20gateway\x20\x27','split','\x20USDT\x20(current\x20balance\x20in\x20DB)','periodFrom','\x20\x20\x20🌍\x20Country:\x20','MasterCard','randomBytes','thisMonth','statusChangedBy','\x20USDT\x20(-','not\x20set','📊\x20Using\x20saved\x20values\x20for\x20payment\x20','bcryptjs','crypto','statusChangedAt','length','\x20\x20\x20�📊\x20Total\x20payments:\x20','averageCommissionRate','createdAt','totalPayments','../types/gateway','totalPaidOut','insensitive','\x20PAID\x20payments','rapyd','Error\x20processing\x20payment\x20','toFixed','cointopay','💰\x20Current\x20shop\x20balance:\x20','values','💰\x20[PAYOUT]\x20Gateway\x20','orderId','not\x20specified','getMonth','updatedAt','Test\x20Gateway','paymentGateways','localeCompare','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','paymentsCount','shopUrl','groupBy','🔧\x20[','\x20merchants','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','📊\x20Gateway\x20filter\x20applied:','gte','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','_count','5RZmuwb',',\x20userId:\x20','\x20USDT\x20(already\x20paid\x20out)','\x20\x20\x20🔍\x20Calculated\x20after\x20commission:\x20','getFullYear','$transaction','\x20\x20\x20✅\x20Actual\x20available\x20balance:\x20','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','\x20\x20\x20Merchant\x20gets:\x20','\x20\x20\x20⏳\x20Pending\x20payout:\x20','log','📊\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','__esModule','password','\x27\x20->\x20name\x20\x27','📊\x20Merchant\x20statistics\x20calculated:',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','updateCustomerData','get','sk_','0000','\x20\x20\x20✅\x20Total\x20available\x20for\x20payout:\x20','📊\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','hash','📊\x20Sorting\x20payments\x20by\x20','getMerchantStatistics','round','gateways','\x20USDT)','test_gateway','\x20\x20\x20Full\x20amount:\x20','%\x20commission)','customerName','usdtTrcWallet','\x20USDT,\x20merchant:\x20','CHARGEBACK','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','🔄\x20Gateway\x20mapping\x20(create):','\x20order','\x20USDT\x20from\x20balance','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','748304SRoYLQ','averageCheckUSDT','\x20USDT\x20(actual\x20balances)','usdtPolygonWallet','toISOString','1492443yQxKwj','\x20\x20\x20Transaction\x20hash:\x20','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','polygon','Noda','erc20','\x20to\x20','failureMessage','13255143FdsaJW','\x20merchants\x20with\x20positive\x20balance','\x20\x20\x20💵\x20Available\x20balance:\x20','commissionUSDT','\x20->\x20','\x20\x20\x20🤔\x20Difference:\x20','Telegram\x20username\x20already\x20exists','customerCountry','\x20payments)','\x27\x20not\x20found.\x20Available\x20gateways:\x20','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','customerIp','awaitingPayout','entries','\x20\x20\x20Merchant\x20loses:\x20','✅\x20Using\x20gateway\x20filter:\x20\x27','15553060nyUkYC','\x20USDT\x20(',']\x20Updating\x20password\x20for\x20user\x20','\x20\x20\x20💰\x20Total\x20payout:\x20','🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','COMPLETED','txid','💰\x20[PAYOUT]\x20Merchant\x20','sort','\x20became\x20PAID:'];a38_0x38a9=function(){return _0x1bbc06;};return a38_0x38a9();}const database_1=__importDefault(require(a38_0xc71753(0x1b2))),bcryptjs_1=__importDefault(require(a38_0xc71753(0x102))),crypto_1=__importDefault(require(a38_0xc71753(0x103))),currencyService_1=require('./currencyService'),gateway_1=require(a38_0xc71753(0x10a));class AdminService{async[a38_0xc71753(0xc1)](){const _0x47f017=a38_0xc71753;console[_0x47f017(0x131)](_0x47f017(0x1b9));const _0x1052ee=await database_1[_0x47f017(0xc7)][_0x47f017(0xad)]['aggregate']({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x47f017(0x1c7)}}),_0x3b4f72=await database_1[_0x47f017(0xc7)][_0x47f017(0x184)][_0x47f017(0x18d)]({'where':{'status':_0x47f017(0xd7),'gateway':{'not':_0x47f017(0x144)}}}),_0x21aaf5=new Date(),_0x2419a0=new Date(_0x21aaf5['getFullYear'](),_0x21aaf5[_0x47f017(0x117)](),0x1),_0x17b1e3=new Date(_0x21aaf5['getFullYear'](),_0x21aaf5[_0x47f017(0x117)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x8078b=await database_1['default'][_0x47f017(0xb7)]['aggregate']({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x2419a0,'lte':_0x17b1e3},'status':_0x47f017(0x172)}}),_0x494838=_0x1052ee[_0x47f017(0x1a0)]['totalPaidOut']||0x0,_0x2d341e=_0x1052ee[_0x47f017(0x1a0)][_0x47f017(0x1c5)]||0x0,_0x424cca=_0x8078b['_sum'][_0x47f017(0x1ae)]||0x0,_0xc75180={'totalPayout':Math[_0x47f017(0x141)](_0x494838*0x64)/0x64,'awaitingPayout':Math[_0x47f017(0x141)](_0x2d341e*0x64)/0x64,'thisMonth':Math[_0x47f017(0x141)](_0x424cca*0x64)/0x64,'availableBalance':Math[_0x47f017(0x141)](_0x2d341e*0x64)/0x64,'totalPayments':_0x3b4f72};return console[_0x47f017(0x131)](_0x47f017(0x1cd)),console['log'](_0x47f017(0x170)+_0xc75180[_0x47f017(0xba)]+_0x47f017(0x1b6)),console[_0x47f017(0x131)](_0x47f017(0x157)+_0xc75180[_0x47f017(0x169)]+_0x47f017(0x1ba)),console[_0x47f017(0x131)](_0x47f017(0x15f)+_0xc75180['availableBalance']+'\x20USDT\x20(same\x20as\x20awaiting)'),console['log'](_0x47f017(0x180)+_0xc75180[_0x47f017(0xfd)]+_0x47f017(0x1d6)),console[_0x47f017(0x131)]('\x20\x20\x20💳\x20Total\x20payments:\x20'+_0xc75180[_0x47f017(0x109)]+_0x47f017(0x10d)),_0xc75180;}async[a38_0xc71753(0x138)](_0x116b83,_0x4248eb){const _0x574964=a38_0xc71753;console['log'](_0x574964(0x11c)+_0x116b83+':',_0x4248eb);const _0x5a9c48=await database_1[_0x574964(0xc7)]['payment'][_0x574964(0x98)]({'where':{'id':_0x116b83},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x5a9c48)throw new Error(_0x574964(0xca));const _0x4c2f58={};_0x4248eb['customerCountry']!==undefined&&(_0x4c2f58['customerCountry']=_0x4248eb['customerCountry']||null);_0x4248eb['customerIp']!==undefined&&(_0x4c2f58[_0x574964(0x168)]=_0x4248eb[_0x574964(0x168)]||null);_0x4248eb[_0x574964(0x19e)]!==undefined&&(_0x4c2f58[_0x574964(0x19e)]=_0x4248eb['customerUa']||null);const _0x274916=await database_1[_0x574964(0xc7)][_0x574964(0x184)][_0x574964(0xa9)]({'where':{'id':_0x116b83},'data':{..._0x4c2f58,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x574964(0x131)](_0x574964(0x14f)+_0x116b83),console[_0x574964(0x131)](_0x574964(0xfa)+_0x5a9c48['customerCountry']+_0x574964(0x161)+_0x274916[_0x574964(0x164)]),console[_0x574964(0x131)](_0x574964(0x1d0)+_0x5a9c48[_0x574964(0x168)]+_0x574964(0x161)+_0x274916['customerIp']),console[_0x574964(0x131)]('\x20\x20\x20🖥️\x20User\x20Agent:\x20'+(_0x5a9c48[_0x574964(0x19e)]?_0x574964(0x1ce):_0x574964(0x100))+'\x20->\x20'+(_0x274916['customerUa']?_0x574964(0x1ce):_0x574964(0x100))),_0x274916;}async[a38_0xc71753(0xc2)](_0x35efac){const _0x237891=a38_0xc71753,_0x4ceb3c=new Date();let _0x2c7c7d;switch(_0x35efac['toLowerCase']()){case _0x237891(0x1d1):_0x2c7c7d=new Date(_0x4ceb3c[_0x237891(0x12b)](),_0x4ceb3c[_0x237891(0x117)](),_0x4ceb3c[_0x237891(0xc0)](),0x0,0x0,0x0,0x0);break;case'yesterday':const _0x54ae1e=new Date(_0x4ceb3c);_0x54ae1e[_0x237891(0x94)](_0x54ae1e[_0x237891(0xc0)]()-0x1),_0x2c7c7d=new Date(_0x54ae1e[_0x237891(0x12b)](),_0x54ae1e[_0x237891(0x117)](),_0x54ae1e[_0x237891(0xc0)](),0x0,0x0,0x0,0x0);break;case'7d':_0x2c7c7d=new Date(_0x4ceb3c[_0x237891(0x1cb)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x237891(0x1d3):_0x2c7c7d=new Date(_0x4ceb3c['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x237891(0xae):_0x2c7c7d=new Date(_0x4ceb3c['getTime']()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x237891(0xe8):const _0x283e4d=await database_1['default']['payment']['findFirst']({'where':{'gateway':{'not':'test_gateway'}},'orderBy':{'createdAt':_0x237891(0xe3)},'select':{'createdAt':!![]}});_0x2c7c7d=_0x283e4d?_0x283e4d[_0x237891(0x108)]:new Date('2020-01-01');break;default:_0x2c7c7d=new Date(_0x4ceb3c[_0x237891(0x1cb)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}_0x2c7c7d[_0x237891(0x1da)](0x0,0x0,0x0,0x0);let _0x2d41af;if(_0x35efac[_0x237891(0x1bd)]()===_0x237891(0xdd)){const _0x29e5c7=new Date(_0x4ceb3c);_0x29e5c7[_0x237891(0x94)](_0x29e5c7[_0x237891(0xc0)]()-0x1),_0x2d41af=new Date(_0x29e5c7[_0x237891(0x12b)](),_0x29e5c7[_0x237891(0x117)](),_0x29e5c7['getDate'](),0x17,0x3b,0x3b,0x3e7);}const _0x15b81d={'gte':_0x2c7c7d};_0x2d41af&&(_0x15b81d[_0x237891(0xdf)]=_0x2d41af);const [_0x5cdd97,_0x335046,_0x432f2e,_0x4354fc,_0x2caaa8,_0x4a1404]=await Promise[_0x237891(0xe8)]([database_1[_0x237891(0xc7)]['shop'][_0x237891(0x18d)](),database_1['default'][_0x237891(0xad)]['count']({'where':{'status':'ACTIVE'}}),database_1['default']['payment']['count']({'where':{'status':_0x237891(0xd7),'createdAt':_0x15b81d,'gateway':{'not':'test_gateway'}}}),database_1[_0x237891(0xc7)][_0x237891(0x184)][_0x237891(0x1bb)]({'where':{'status':_0x237891(0xd7),'createdAt':_0x15b81d,'gateway':{'not':_0x237891(0x144)}},'select':{'amount':!![],'currency':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x237891(0xc7)][_0x237891(0x184)][_0x237891(0x1bb)]({'where':{'gateway':{'not':'test_gateway'}},'take':0xa,'orderBy':{'createdAt':_0x237891(0x194)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x237891(0xc7)][_0x237891(0x184)]['findMany']({'where':{'createdAt':_0x15b81d,'gateway':{'not':_0x237891(0x144)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x73eb9e=0x0,_0x119025=0x0;for(const _0x3f5baf of _0x4354fc){const _0x493cae=await currencyService_1['currencyService'][_0x237891(0xf4)](_0x3f5baf['amount'],_0x3f5baf[_0x237891(0xbf)]);_0x73eb9e+=_0x493cae;if(_0x3f5baf[_0x237891(0x1d7)]){const _0x32781a=await currencyService_1[_0x237891(0xd3)][_0x237891(0xf4)](_0x3f5baf['amount'],_0x3f5baf['currency']),_0x307990=_0x3f5baf['amountAfterGatewayCommissionUSDT'],_0x101ae2=_0x32781a-_0x307990;_0x119025+=_0x101ae2;}}const _0x3497e3=_0x432f2e>0x0?_0x73eb9e/_0x432f2e:0x0,_0xfe9a4a=this[_0x237891(0xcb)](_0x4a1404,_0x2c7c7d,_0x2d41af||_0x4ceb3c),_0x43fc75=await database_1['default'][_0x237891(0x184)][_0x237891(0x18d)]({'where':{'createdAt':_0x15b81d,'gateway':{'not':_0x237891(0x144)}}}),_0xb503fd=_0x43fc75>0x0?_0x432f2e/_0x43fc75*0x64:0x0;return{'totalShops':_0x5cdd97,'activeShops':_0x335046,'totalPayments':_0x432f2e,'successfulPayments':_0x432f2e,'totalAttempts':_0x43fc75,'totalRevenue':Math[_0x237891(0x141)](_0x73eb9e*0x64)/0x64,'trapayEarnings':Math[_0x237891(0x141)](_0x119025*0x64)/0x64,'averagePaymentAmount':Math[_0x237891(0x141)](_0x3497e3*0x64)/0x64,'conversionRate':Math[_0x237891(0x141)](_0xb503fd*0x64)/0x64,'dailyRevenue':_0xfe9a4a['dailyRevenue'],'dailyPayments':_0xfe9a4a[_0x237891(0xd8)],'recentPayments':_0x2caaa8[_0x237891(0x97)](_0x3f50c1=>({'id':_0x3f50c1['id'],'amount':_0x3f50c1[_0x237891(0x1ae)],'currency':_0x3f50c1[_0x237891(0xbf)],'status':_0x3f50c1[_0x237891(0x1c2)],'gateway':_0x3f50c1[_0x237891(0x179)],'shop':_0x3f50c1[_0x237891(0xad)],'createdAt':_0x3f50c1[_0x237891(0x108)]}))};}async[a38_0xc71753(0x140)](_0x1200f6){const _0x216540=a38_0xc71753;console[_0x216540(0x131)]('📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:',_0x1200f6);let _0x22ef9d,_0x5ed926=new Date();if(_0x1200f6[_0x216540(0x1a2)]===_0x216540(0x9c)&&_0x1200f6[_0x216540(0x19f)]&&_0x1200f6['dateTo'])_0x22ef9d=new Date(_0x1200f6[_0x216540(0x19f)]),_0x5ed926=new Date(_0x1200f6['dateTo']),_0x22ef9d[_0x216540(0x1da)](0x0,0x0,0x0,0x0),_0x5ed926[_0x216540(0x1da)](0x17,0x3b,0x3b,0x3e7);else{const _0x8b6a7c=new Date();switch(_0x1200f6[_0x216540(0x1a2)]){case _0x216540(0x1b8):_0x22ef9d=new Date(_0x8b6a7c[_0x216540(0x1cb)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'month':_0x22ef9d=new Date(_0x8b6a7c['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x216540(0x182):_0x22ef9d=new Date(_0x8b6a7c[_0x216540(0x1cb)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case'all':default:_0x22ef9d=new Date(_0x216540(0x9e));break;}_0x22ef9d[_0x216540(0x1da)](0x0,0x0,0x0,0x0),_0x5ed926[_0x216540(0x1da)](0x17,0x3b,0x3b,0x3e7);}console['log'](_0x216540(0x1af)+_0x22ef9d[_0x216540(0x154)]()+_0x216540(0x15b)+_0x5ed926[_0x216540(0x154)]());const _0x55246a={'status':_0x216540(0xd7),'gateway':{'not':'test_gateway'},'paidAt':{'gte':_0x22ef9d,'lte':_0x5ed926}};_0x1200f6['shopId']&&(_0x55246a['shopId']=_0x1200f6[_0x216540(0x1c1)]);const _0x55d99d=await database_1[_0x216540(0xc7)][_0x216540(0x184)][_0x216540(0x1bb)]({'where':_0x55246a,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x216540(0x131)](_0x216540(0x198)+_0x55d99d['length']+'\x20paid\x20payments\x20for\x20analysis');const _0x58bf2d={'gateway':{'not':_0x216540(0x144)},'createdAt':{'gte':_0x22ef9d,'lte':_0x5ed926}};_0x1200f6[_0x216540(0x1c1)]&&(_0x58bf2d[_0x216540(0x1c1)]=_0x1200f6[_0x216540(0x1c1)]);const _0x3271c6=await database_1[_0x216540(0xc7)][_0x216540(0x184)][_0x216540(0x18d)]({'where':_0x58bf2d});console[_0x216540(0x131)](_0x216540(0xb4)+_0x3271c6+',\x20successful:\x20'+_0x55d99d['length']);let _0x1afb31=0x0,_0x252509=0x0,_0x15ebfe=0x0;const _0x323b74={},_0x213900={},_0x3004dc={};for(const _0x295997 of _0x55d99d){try{const _0x2db940=_0x295997[_0x216540(0xa7)]||0x0;if(_0x2db940<=0x0){console[_0x216540(0xcf)](_0x216540(0xe5)+_0x295997['id']+'\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...');continue;}let _0x12e265,_0x451bba;if(_0x295997[_0x216540(0x1d7)]!==null&&_0x295997['amountAfterGatewayCommissionUSDT']!==undefined)_0x12e265=_0x295997[_0x216540(0x1d7)],_0x451bba=_0x2db940-_0x12e265,console[_0x216540(0x131)](_0x216540(0x101)+_0x295997['id']+':\x20'+_0x2db940[_0x216540(0x110)](0x6)+_0x216540(0x149)+_0x12e265[_0x216540(0x110)](0x6)+'\x20USDT');else{let _0x367522={};if(_0x295997[_0x216540(0xad)][_0x216540(0x187)])try{_0x367522=JSON['parse'](_0x295997[_0x216540(0xad)][_0x216540(0x187)]);}catch(_0x1eaf5c){console['error'](_0x216540(0x1a8)+_0x295997[_0x216540(0x1c1)]+':',_0x1eaf5c);}let _0x163590=0x2d;for(const [_0x44c6c3,_0x4b4520]of Object['entries'](_0x367522)){if(_0x44c6c3['toLowerCase']()===_0x295997[_0x216540(0x179)][_0x216540(0x1bd)]()){_0x163590=_0x4b4520[_0x216540(0x1c9)]||0x2d;break;}}_0x451bba=_0x2db940*(_0x163590/0x64),_0x12e265=_0x2db940-_0x451bba,console[_0x216540(0x131)](_0x216540(0x13d)+_0x295997['id']+':\x20'+_0x163590+_0x216540(0x1a6)+_0x2db940[_0x216540(0x110)](0x6)+_0x216540(0x1d6));}_0x1afb31+=_0x2db940,_0x252509+=_0x12e265,_0x15ebfe+=_0x451bba;let _0x40bbb4;_0x295997[_0x216540(0xce)]!==null&&_0x295997['gatewayCommissionRate']!==undefined?(_0x40bbb4=_0x295997[_0x216540(0xce)],console[_0x216540(0x131)](_0x216540(0x93)+_0x295997['id']+':\x20'+_0x40bbb4+'%')):(_0x40bbb4=_0x2db940>0x0?_0x451bba/_0x2db940*0x64:0x0,console[_0x216540(0x131)](_0x216540(0x1c6)+_0x295997['id']+':\x20'+_0x40bbb4['toFixed'](0x2)+'%'));!_0x323b74[_0x295997[_0x216540(0x179)]]&&(_0x323b74[_0x295997[_0x216540(0x179)]]={'gateway':_0x295997['gateway'],'gatewayDisplayName':this[_0x216540(0xa3)](_0x295997[_0x216540(0x179)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x323b74[_0x295997['gateway']][_0x216540(0x11d)]++,_0x323b74[_0x295997['gateway']][_0x216540(0x183)]+=_0x2db940,_0x323b74[_0x295997['gateway']]['commissionUSDT']+=_0x451bba,_0x323b74[_0x295997['gateway']]['merchantEarningsUSDT']+=_0x12e265,_0x323b74[_0x295997['gateway']][_0x216540(0xa8)]+=_0x40bbb4;!_0x1200f6['shopId']&&(!_0x213900[_0x295997[_0x216540(0x1c1)]]&&(_0x213900[_0x295997['shopId']]={'shopId':_0x295997[_0x216540(0x1c1)],'shopName':_0x295997[_0x216540(0xad)]['name'],'shopUsername':_0x295997['shop'][_0x216540(0x1a7)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x213900[_0x295997[_0x216540(0x1c1)]][_0x216540(0x11d)]++,_0x213900[_0x295997[_0x216540(0x1c1)]][_0x216540(0x183)]+=_0x2db940,_0x213900[_0x295997[_0x216540(0x1c1)]][_0x216540(0x160)]+=_0x451bba,_0x213900[_0x295997[_0x216540(0x1c1)]][_0x216540(0xe2)]+=_0x12e265);const _0x4df1a0=_0x295997[_0x216540(0xe4)][_0x216540(0x154)]()['split']('T')[0x0];!_0x3004dc[_0x4df1a0]&&(_0x3004dc[_0x4df1a0]={'date':_0x4df1a0,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x3004dc[_0x4df1a0][_0x216540(0xb3)]+=_0x2db940,_0x3004dc[_0x4df1a0][_0x216540(0x17b)]+=_0x12e265,_0x3004dc[_0x4df1a0][_0x216540(0xee)]+=_0x451bba,_0x3004dc[_0x4df1a0]['paymentsCount']++;}catch(_0x59e256){console['error'](_0x216540(0x10f)+_0x295997['id']+':',_0x59e256);}}Object['values'](_0x323b74)[_0x216540(0xf2)](_0x24e010=>{const _0x344426=_0x216540;_0x24e010[_0x344426(0x107)]=_0x24e010[_0x344426(0x11d)]>0x0?_0x24e010[_0x344426(0xa8)]/_0x24e010['paymentsCount']:0x0,delete _0x24e010['totalCommissionRate'];}),Object[_0x216540(0x113)](_0x213900)[_0x216540(0xf2)](_0x442f30=>{const _0x31d8f6=_0x216540;_0x442f30[_0x31d8f6(0x151)]=_0x442f30[_0x31d8f6(0x11d)]>0x0?_0x442f30['turnoverUSDT']/_0x442f30[_0x31d8f6(0x11d)]:0x0;});let _0x29daee=0x0,_0x676882=0x0;if(_0x1200f6[_0x216540(0x1c1)]){const _0x349f34=await database_1[_0x216540(0xc7)][_0x216540(0xb7)][_0x216540(0x1bb)]({'where':{'shopId':_0x1200f6[_0x216540(0x1c1)],'status':_0x216540(0x172),'createdAt':{'gte':_0x22ef9d,'lte':_0x5ed926}},'select':{'amount':!![]}});_0x29daee=_0x349f34[_0x216540(0xe6)]((_0x7e8569,_0xe98196)=>_0x7e8569+_0xe98196[_0x216540(0x1ae)],0x0);const _0x46958e=await database_1[_0x216540(0xc7)]['payout']['findMany']({'where':{'shopId':_0x1200f6['shopId'],'status':_0x216540(0x18e),'createdAt':{'gte':_0x22ef9d,'lte':_0x5ed926}},'select':{'amount':!![]}});_0x676882=_0x46958e['reduce']((_0x3447ee,_0x587120)=>_0x3447ee+_0x587120['amount'],0x0);}const _0x113867=_0x3271c6,_0x59486b=_0x55d99d[_0x216540(0x105)],_0x2ce6a9=_0x59486b>0x0?_0x1afb31/_0x59486b:0x0,_0x1de742=_0x113867>0x0?Math[_0x216540(0x141)](_0x59486b/_0x113867*0x2710)/0x64:0x0,_0x41cef4=Math[_0x216540(0x191)]((_0x5ed926['getTime']()-_0x22ef9d[_0x216540(0x1cb)]())/(0x3e8*0x3c*0x3c*0x18)),_0x5800cc={'totalTurnover':Math['round'](_0x1afb31*0x64)/0x64,'merchantEarnings':Math[_0x216540(0x141)](_0x252509*0x64)/0x64,'gatewayEarnings':Math[_0x216540(0x141)](_0x15ebfe*0x64)/0x64,'totalPaidOut':Math[_0x216540(0x141)](_0x29daee*0x64)/0x64,'pendingPayout':Math[_0x216540(0x141)](_0x676882*0x64)/0x64,'averageCheck':Math[_0x216540(0x141)](_0x2ce6a9*0x64)/0x64,'totalPayments':_0x113867,'successfulPayments':_0x59486b,'conversionRate':_0x1de742,'gatewayBreakdown':Object[_0x216540(0x113)](_0x323b74)[_0x216540(0x97)](_0x3ac42f=>({..._0x3ac42f,'turnoverUSDT':Math[_0x216540(0x141)](_0x3ac42f[_0x216540(0x183)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x3ac42f['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x216540(0x141)](_0x3ac42f[_0x216540(0xe2)]*0x64)/0x64,'averageCommissionRate':Math['round'](_0x3ac42f[_0x216540(0x107)]*0x64)/0x64})),'merchantBreakdown':_0x1200f6[_0x216540(0x1c1)]?undefined:Object[_0x216540(0x113)](_0x213900)[_0x216540(0x97)](_0x21bd55=>({..._0x21bd55,'turnoverUSDT':Math[_0x216540(0x141)](_0x21bd55[_0x216540(0x183)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x21bd55['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x21bd55[_0x216540(0xe2)]*0x64)/0x64,'paidOutUSDT':Math[_0x216540(0x141)](_0x21bd55[_0x216540(0xaa)]*0x64)/0x64,'averageCheckUSDT':Math['round'](_0x21bd55['averageCheckUSDT']*0x64)/0x64})),'dailyData':Object[_0x216540(0x113)](_0x3004dc)['map'](_0x57bf4f=>({..._0x57bf4f,'turnover':Math[_0x216540(0x141)](_0x57bf4f[_0x216540(0xb3)]*0x64)/0x64,'merchantEarnings':Math[_0x216540(0x141)](_0x57bf4f[_0x216540(0x17b)]*0x64)/0x64,'gatewayEarnings':Math[_0x216540(0x141)](_0x57bf4f[_0x216540(0xee)]*0x64)/0x64}))[_0x216540(0x175)]((_0x10feaa,_0x5338fb)=>_0x10feaa[_0x216540(0x1b4)][_0x216540(0x11b)](_0x5338fb[_0x216540(0x1b4)])),'periodInfo':{'from':_0x22ef9d,'to':_0x5ed926,'periodType':_0x1200f6['period']||_0x216540(0x9c),'daysCount':_0x41cef4}};return console[_0x216540(0x131)](_0x216540(0x136)),console[_0x216540(0x131)](_0x216540(0xf1)+_0x5800cc[_0x216540(0x17f)]+_0x216540(0x1d6)),console[_0x216540(0x131)](_0x216540(0x1d8)+_0x5800cc['merchantEarnings']+'\x20USDT'),console[_0x216540(0x131)](_0x216540(0x122)+_0x5800cc['gatewayEarnings']+_0x216540(0x1d6)),console[_0x216540(0x131)](_0x216540(0xa0)+_0x5800cc['totalPaidOut']+'\x20USDT'),console[_0x216540(0x131)](_0x216540(0x130)+_0x5800cc['pendingPayout']+_0x216540(0x1d6)),console[_0x216540(0x131)](_0x216540(0x106)+_0x5800cc[_0x216540(0x109)]),_0x5800cc;}async[a38_0xc71753(0x1b3)](){const _0x178ac0=a38_0xc71753;console['log']('📋\x20Getting\x20merchants\x20selection\x20list...');const _0x44df59=await database_1['default'][_0x178ac0(0xad)][_0x178ac0(0x1bb)]({'where':{'status':_0x178ac0(0x1c7)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x178ac0(0xe3)}});return console['log'](_0x178ac0(0xd1)+_0x44df59[_0x178ac0(0x105)]+_0x178ac0(0x1d9)),_0x44df59[_0x178ac0(0x97)](_0x29afbc=>({'id':_0x29afbc['id'],'username':_0x29afbc['username'],'name':_0x29afbc['name']}));}[a38_0xc71753(0xa3)](_0x68b37c){const _0x7ed90=a38_0xc71753,_0x3c1181={'test_gateway':_0x7ed90(0x119),'plisio':_0x7ed90(0xd0),'rapyd':_0x7ed90(0x1a3),'noda':_0x7ed90(0x159),'cointopay':_0x7ed90(0xb6),'cointopay2':_0x7ed90(0xf3),'klyme_eu':'KLYME\x20EU','klyme_gb':_0x7ed90(0x1cf),'klyme_de':_0x7ed90(0x18f),'mastercard':_0x7ed90(0xfb)};return _0x3c1181[_0x68b37c]||_0x68b37c;}[a38_0xc71753(0x17e)](_0x455a50){const _0x22950f=a38_0xc71753,_0x236a68={'Test\x20Gateway':_0x22950f(0x144),'Plisio':'plisio','Rapyd':_0x22950f(0x10e),'Noda':_0x22950f(0x17a),'CoinToPay':_0x22950f(0x111),'CoinToPay2':_0x22950f(0xa6),'KLYME\x20EU':'klyme_eu','KLYME\x20GB':_0x22950f(0x1a4),'KLYME\x20DE':_0x22950f(0xc8),'MasterCard':_0x22950f(0x9d)};return _0x236a68[_0x455a50]||_0x455a50[_0x22950f(0x1bd)]();}async[a38_0xc71753(0x197)](_0x43e1c0){const _0x1a651c=a38_0xc71753,{page:_0x1b3b07,limit:_0x1066be,minAmount:_0x49719b,search:_0x48dddf}=_0x43e1c0,_0x279aff=(_0x1b3b07-0x1)*_0x1066be;console['log']('📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:',_0x43e1c0);const _0x4ce1c3={'balance':{'gt':0x0},'status':'ACTIVE'};_0x49719b&&(_0x4ce1c3[_0x1a651c(0x1c5)][_0x1a651c(0x124)]=_0x49719b);_0x48dddf&&(_0x4ce1c3[_0x1a651c(0xa2)]={'contains':_0x48dddf,'mode':_0x1a651c(0x10c)});const [_0x3d67bc,_0x31b237]=await Promise['all']([database_1[_0x1a651c(0xc7)][_0x1a651c(0xad)]['findMany']({'where':_0x4ce1c3,'skip':_0x279aff,'take':_0x1066be,'orderBy':{'balance':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1[_0x1a651c(0xc7)][_0x1a651c(0xad)][_0x1a651c(0x18d)]({'where':_0x4ce1c3})]);console[_0x1a651c(0x131)](_0x1a651c(0x198)+_0x3d67bc[_0x1a651c(0x105)]+_0x1a651c(0x15e));const _0x1c82df=await Promise['all'](_0x3d67bc['map'](async _0x30a434=>{const _0x494ca1=_0x1a651c,[_0x215475,_0x31e1ca,_0x5e4661]=await Promise['all']([database_1['default'][_0x494ca1(0x184)][_0x494ca1(0x18d)]({'where':{'shopId':_0x30a434['id'],'status':'PAID','gateway':{'not':_0x494ca1(0x144)}}}),database_1[_0x494ca1(0xc7)][_0x494ca1(0x184)]['findFirst']({'where':{'shopId':_0x30a434['id'],'status':_0x494ca1(0xd7),'gateway':{'not':'test_gateway'}},'orderBy':{'paidAt':_0x494ca1(0xe3)},'select':{'paidAt':!![]}}),database_1['default'][_0x494ca1(0x184)][_0x494ca1(0x11f)]({'by':['gateway'],'where':{'shopId':_0x30a434['id'],'status':_0x494ca1(0xd7),'gateway':{'not':_0x494ca1(0x144)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x258345=new Date(),_0x5ae1fa=new Date(_0x258345[_0x494ca1(0x12b)](),_0x258345[_0x494ca1(0x117)](),0x1),_0x588493=new Date(_0x258345[_0x494ca1(0x12b)](),_0x258345[_0x494ca1(0x117)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x2e4016,_0x1e45af]=await Promise['all']([database_1['default'][_0x494ca1(0xb7)][_0x494ca1(0x95)]({'_sum':{'amount':!![]},'where':{'shopId':_0x30a434['id'],'status':_0x494ca1(0x172)}}),database_1[_0x494ca1(0xc7)][_0x494ca1(0xb7)][_0x494ca1(0x95)]({'_sum':{'amount':!![]},'where':{'shopId':_0x30a434['id'],'status':'COMPLETED','createdAt':{'gte':_0x5ae1fa,'lte':_0x588493}}})]),_0x397e96=_0x2e4016['_sum'][_0x494ca1(0x1ae)]||0x0,_0x4ac8b5=_0x1e45af[_0x494ca1(0x1a0)][_0x494ca1(0x1ae)]||0x0,_0x15f19b=await Promise['all'](_0x5e4661['map'](async _0x217d32=>{const _0x275d91=_0x494ca1;let _0x2646b3=0x2d;if(_0x30a434[_0x275d91(0x187)])try{const _0x3211fd=JSON[_0x275d91(0xd9)](_0x30a434[_0x275d91(0x187)]);for(const [_0x27a955,_0x303153]of Object[_0x275d91(0x16a)](_0x3211fd)){if(_0x27a955[_0x275d91(0x1bd)]()===_0x217d32[_0x275d91(0x179)][_0x275d91(0x1bd)]()){_0x2646b3=_0x303153[_0x275d91(0x1c9)]||0xa,console[_0x275d91(0x131)](_0x275d91(0x114)+_0x217d32[_0x275d91(0x179)]+_0x275d91(0x199)+_0x30a434['id']+_0x275d91(0xbc)+_0x2646b3+'%');break;}}}catch(_0x2634d1){console['error']('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x30a434['id']+':',_0x2634d1);}const _0x5bb51e=_0x217d32[_0x275d91(0x1a0)]?.[_0x275d91(0xa7)]||0x0,_0x156d3d=_0x5bb51e*(0x1-_0x2646b3/0x64);return{'gateway':_0x217d32[_0x275d91(0x179)],'count':_0x217d32['_count']?.['id']||0x0,'amountUSDT':Math[_0x275d91(0x141)](_0x5bb51e*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x275d91(0x141)](_0x156d3d*0x64)/0x64,'commission':_0x2646b3};})),_0x48e64a=_0x15f19b[_0x494ca1(0xe6)]((_0x4a266f,_0x515580)=>_0x4a266f+_0x515580[_0x494ca1(0xa7)],0x0),_0x5d321c=_0x15f19b[_0x494ca1(0xe6)]((_0x3e96d2,_0x3e6d79)=>_0x3e96d2+_0x3e6d79[_0x494ca1(0xa1)],0x0),_0x3be2bd=_0x30a434['balance'];return console[_0x494ca1(0x131)](_0x494ca1(0x174)+_0x30a434[_0x494ca1(0x1a7)]+':'),console[_0x494ca1(0x131)](_0x494ca1(0xbe)+_0x48e64a[_0x494ca1(0x110)](0x2)+_0x494ca1(0xb0)),console[_0x494ca1(0x131)](_0x494ca1(0x12a)+_0x5d321c[_0x494ca1(0x110)](0x2)+'\x20USDT\x20(theoretical\x20net)'),console[_0x494ca1(0x131)](_0x494ca1(0x12d)+_0x3be2bd[_0x494ca1(0x110)](0x2)+_0x494ca1(0xf8)),console[_0x494ca1(0x131)]('\x20\x20\x20💸\x20Total\x20payouts:\x20'+_0x397e96[_0x494ca1(0x110)](0x2)+_0x494ca1(0x129)),console[_0x494ca1(0x131)](_0x494ca1(0x162)+(_0x5d321c-_0x397e96-_0x3be2bd)[_0x494ca1(0x110)](0x2)+_0x494ca1(0x185)),{'id':_0x30a434['id'],'fullName':_0x30a434[_0x494ca1(0xa2)],'username':_0x30a434[_0x494ca1(0x1a7)],'telegramId':_0x30a434[_0x494ca1(0x178)],'merchantUrl':_0x30a434[_0x494ca1(0x11e)],'wallets':{'usdtPolygonWallet':_0x30a434[_0x494ca1(0x153)],'usdtTrcWallet':_0x30a434[_0x494ca1(0x148)],'usdtErcWallet':_0x30a434[_0x494ca1(0xa5)],'usdcPolygonWallet':_0x30a434['usdcPolygonWallet']},'totalAmountUSDT':Math[_0x494ca1(0x141)](_0x48e64a*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x494ca1(0x141)](_0x5d321c*0x64)/0x64,'currentBalance':Math['round'](_0x3be2bd*0x64)/0x64,'totalPayout':Math[_0x494ca1(0x141)](_0x397e96*0x64)/0x64,'thisMonth':Math[_0x494ca1(0x141)](_0x4ac8b5*0x64)/0x64,'paymentsCount':_0x215475,'oldestPaymentDate':_0x31e1ca?.['paidAt']||_0x30a434['createdAt'],'gatewayBreakdown':_0x15f19b};})),_0x1a84b3=_0x1c82df['reduce']((_0x507f22,_0x5e82c1)=>_0x507f22+_0x5e82c1['totalAmountUSDT'],0x0),_0x13e10a=_0x1c82df[_0x1a651c(0xe6)]((_0x5f4ffe,_0xc446ba)=>_0x5f4ffe+_0xc446ba['totalAmountAfterCommissionUSDT'],0x0),_0xc4db7a=_0x1c82df['reduce']((_0x2b8e24,_0x17dc07)=>_0x2b8e24+_0x17dc07[_0x1a651c(0xba)],0x0),_0xefc5bb=_0x1c82df[_0x1a651c(0xe6)]((_0x152ca6,_0x165f96)=>_0x152ca6+_0x165f96['thisMonth'],0x0);return console['log']('📊\x20Merchants\x20awaiting\x20payout:\x20'+_0x31b237+_0x1a651c(0x121)),console[_0x1a651c(0x131)](_0x1a651c(0x1a1)+Math[_0x1a651c(0x141)](_0x1a84b3*0x64)/0x64+_0x1a651c(0xb0)),console['log'](_0x1a651c(0x13c)+Math[_0x1a651c(0x141)](_0x13e10a*0x64)/0x64+_0x1a651c(0x152)),console['log'](_0x1a651c(0x195)+Math['round'](_0xc4db7a*0x64)/0x64+_0x1a651c(0x1d6)),console['log'](_0x1a651c(0xb5)+Math[_0x1a651c(0x141)](_0xefc5bb*0x64)/0x64+_0x1a651c(0x1d6)),{'merchants':_0x1c82df,'pagination':{'page':_0x1b3b07,'limit':_0x1066be,'total':_0x31b237,'totalPages':Math[_0x1a651c(0x191)](_0x31b237/_0x1066be)},'summary':{'totalMerchants':_0x31b237,'totalAmountUSDT':Math[_0x1a651c(0x141)](_0x1a84b3*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x1a651c(0x141)](_0x13e10a*0x64)/0x64,'totalPayout':Math[_0x1a651c(0x141)](_0xc4db7a*0x64)/0x64,'thisMonth':Math['round'](_0xefc5bb*0x64)/0x64}};}async[a38_0xc71753(0x1c0)](_0x7b97e5){const _0x4e0a7e=a38_0xc71753,{shopId:_0xe8ab84,amount:_0x1d7fe4,network:_0x163d3,wallet:_0x4d0d56,notes:_0x4a3a5d,txid:_0x5e26ea,periodFrom:_0x5d9517,periodTo:_0x19b345}=_0x7b97e5,_0x587935=await database_1['default'][_0x4e0a7e(0x12c)](async _0x1c5ce9=>{const _0x4f5d3c=_0x4e0a7e,_0xc97a9b=await _0x1c5ce9[_0x4f5d3c(0xad)][_0x4f5d3c(0x98)]({'where':{'id':_0xe8ab84},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0xc97a9b)throw new Error('Shop\x20not\x20found');console['log'](_0x4f5d3c(0x19a)+_0xc97a9b[_0x4f5d3c(0x1a7)]+':'),console['log'](_0x4f5d3c(0x9b)+_0xc97a9b['balance'][_0x4f5d3c(0x110)](0x6)+_0x4f5d3c(0x1d6)),console['log'](_0x4f5d3c(0x1ac)+_0x1d7fe4[_0x4f5d3c(0x110)](0x6)+'\x20USDT'),console[_0x4f5d3c(0x131)]('\x20\x20\x20Current\x20total\x20paid\x20out:\x20'+_0xc97a9b[_0x4f5d3c(0x10b)][_0x4f5d3c(0x110)](0x6)+_0x4f5d3c(0x1d6));if(_0x5e26ea)console[_0x4f5d3c(0x131)](_0x4f5d3c(0x156)+_0x5e26ea);if(_0xc97a9b[_0x4f5d3c(0x1c5)]<_0x1d7fe4)throw new Error(_0x4f5d3c(0x1ad)+_0xc97a9b['balance'][_0x4f5d3c(0x110)](0x6)+_0x4f5d3c(0xd5)+_0x1d7fe4[_0x4f5d3c(0x110)](0x6)+_0x4f5d3c(0x1d6));let _0x3f0f02=_0x4d0d56;if(!_0x3f0f02){const _0xdeea5e=await _0x1c5ce9[_0x4f5d3c(0xad)]['findUnique']({'where':{'id':_0xe8ab84},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0xdeea5e)switch(_0x163d3){case _0x4f5d3c(0x158):_0x3f0f02=_0xdeea5e['usdtPolygonWallet']||undefined;break;case _0x4f5d3c(0x177):_0x3f0f02=_0xdeea5e[_0x4f5d3c(0x148)]||undefined;break;case _0x4f5d3c(0x15a):_0x3f0f02=_0xdeea5e[_0x4f5d3c(0xa5)]||undefined;break;case _0x4f5d3c(0x1b5):_0x3f0f02=_0xdeea5e[_0x4f5d3c(0x193)]||undefined;break;}}console['log'](_0x4f5d3c(0x1be)+_0x163d3+':\x20'+(_0x3f0f02||_0x4f5d3c(0x116)));const _0x19c275=await _0x1c5ce9[_0x4f5d3c(0xb7)][_0x4f5d3c(0xe1)]({'data':{'shopId':_0xe8ab84,'amount':_0x1d7fe4,'network':_0x163d3,'status':'COMPLETED','txid':_0x5e26ea,'notes':_0x4a3a5d,'periodFrom':_0x5d9517?new Date(_0x5d9517):null,'periodTo':_0x19b345?new Date(_0x19b345):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x252c82=_0xc97a9b[_0x4f5d3c(0x1c5)]-_0x1d7fe4,_0x2f8e89=_0xc97a9b[_0x4f5d3c(0x10b)]+_0x1d7fe4;return await _0x1c5ce9[_0x4f5d3c(0xad)][_0x4f5d3c(0xa9)]({'where':{'id':_0xe8ab84},'data':{'balance':_0x252c82,'totalPaidOut':_0x2f8e89}}),console[_0x4f5d3c(0x131)]('💰\x20Shop\x20'+_0xc97a9b['username']+_0x4f5d3c(0xc5)),console[_0x4f5d3c(0x131)](_0x4f5d3c(0xf5)+_0xc97a9b[_0x4f5d3c(0x1c5)][_0x4f5d3c(0x110)](0x6)+_0x4f5d3c(0x161)+_0x252c82[_0x4f5d3c(0x110)](0x6)+_0x4f5d3c(0xff)+_0x1d7fe4[_0x4f5d3c(0x110)](0x6)+')'),console[_0x4f5d3c(0x131)]('\x20\x20\x20Total\x20paid\x20out:\x20'+_0xc97a9b['totalPaidOut']['toFixed'](0x6)+_0x4f5d3c(0x161)+_0x2f8e89['toFixed'](0x6)+_0x4f5d3c(0xc6)+_0x1d7fe4['toFixed'](0x6)+')'),{'payout':_0x19c275,'shop':_0xc97a9b};});return console[_0x4e0a7e(0x131)](_0x4e0a7e(0x19b)+_0x587935[_0x4e0a7e(0xb7)]['id']+_0x4e0a7e(0x199)+_0x587935[_0x4e0a7e(0xad)][_0x4e0a7e(0x1a7)]+'\x20('+_0x1d7fe4+_0x4e0a7e(0x143)),{'id':_0x587935[_0x4e0a7e(0xb7)]['id'],'shopId':_0x587935[_0x4e0a7e(0xb7)][_0x4e0a7e(0x1c1)],'shopName':_0x587935[_0x4e0a7e(0xad)][_0x4e0a7e(0xa2)],'shopUsername':_0x587935[_0x4e0a7e(0xad)]['username'],'amount':_0x587935[_0x4e0a7e(0xb7)][_0x4e0a7e(0x1ae)],'network':_0x587935[_0x4e0a7e(0xb7)][_0x4e0a7e(0x19c)],'status':_0x587935['payout'][_0x4e0a7e(0x1c2)],'txid':_0x587935[_0x4e0a7e(0xb7)][_0x4e0a7e(0x173)],'notes':_0x587935[_0x4e0a7e(0xb7)]['notes'],'periodFrom':_0x587935[_0x4e0a7e(0xb7)][_0x4e0a7e(0xf9)],'periodTo':_0x587935['payout'][_0x4e0a7e(0x99)],'createdAt':_0x587935['payout']['createdAt'],'paidAt':_0x587935[_0x4e0a7e(0xb7)]['paidAt']};}async['getAllPayouts'](_0x525002){const _0x16cd17=a38_0xc71753,{page:_0xe9bd80,limit:_0x239bc6,shopId:_0x570d21,network:_0x2d4346,dateFrom:_0x51e314,dateTo:_0xf262b8,search:_0x467a3e}=_0x525002,_0x11bf75=(_0xe9bd80-0x1)*_0x239bc6,_0x299621={};_0x570d21&&(_0x299621[_0x16cd17(0x1c1)]=_0x570d21);_0x2d4346&&(_0x299621[_0x16cd17(0x19c)]=_0x2d4346);(_0x51e314||_0xf262b8)&&(_0x299621[_0x16cd17(0x108)]={},_0x51e314&&(_0x299621['createdAt'][_0x16cd17(0x124)]=new Date(_0x51e314)),_0xf262b8&&(_0x299621[_0x16cd17(0x108)][_0x16cd17(0xdf)]=new Date(_0xf262b8)));_0x467a3e&&(_0x299621['OR']=[{'shop':{'name':{'contains':_0x467a3e,'mode':_0x16cd17(0x10c)}}},{'shop':{'username':{'contains':_0x467a3e,'mode':_0x16cd17(0x10c)}}},{'notes':{'contains':_0x467a3e,'mode':_0x16cd17(0x10c)}}]);const [_0x3f1705,_0x5744a2]=await Promise['all']([database_1[_0x16cd17(0xc7)][_0x16cd17(0xb7)][_0x16cd17(0x1bb)]({'where':_0x299621,'skip':_0x11bf75,'take':_0x239bc6,'orderBy':{'createdAt':_0x16cd17(0x194)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x16cd17(0xc7)][_0x16cd17(0xb7)]['count']({'where':_0x299621})]);return{'payouts':_0x3f1705[_0x16cd17(0x97)](_0x415805=>({'id':_0x415805['id'],'shopId':_0x415805[_0x16cd17(0x1c1)],'shopName':_0x415805[_0x16cd17(0xad)][_0x16cd17(0xa2)],'shopUsername':_0x415805[_0x16cd17(0xad)][_0x16cd17(0x1a7)],'amount':_0x415805[_0x16cd17(0x1ae)],'network':_0x415805['network'],'status':_0x415805[_0x16cd17(0x1c2)],'txid':_0x415805[_0x16cd17(0x173)],'notes':_0x415805['notes'],'periodFrom':_0x415805[_0x16cd17(0xf9)],'periodTo':_0x415805[_0x16cd17(0x99)],'createdAt':_0x415805[_0x16cd17(0x108)],'paidAt':_0x415805[_0x16cd17(0xe4)]})),'pagination':{'page':_0xe9bd80,'limit':_0x239bc6,'total':_0x5744a2,'totalPages':Math[_0x16cd17(0x191)](_0x5744a2/_0x239bc6)}};}async[a38_0xc71753(0xbd)](_0x3e1c2a){const _0x4642bb=a38_0xc71753,_0x414ca7=await database_1[_0x4642bb(0xc7)]['payout']['findUnique']({'where':{'id':_0x3e1c2a},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x414ca7)return null;return{'id':_0x414ca7['id'],'shopId':_0x414ca7[_0x4642bb(0x1c1)],'shopName':_0x414ca7['shop'][_0x4642bb(0xa2)],'shopUsername':_0x414ca7[_0x4642bb(0xad)]['username'],'amount':_0x414ca7[_0x4642bb(0x1ae)],'network':_0x414ca7[_0x4642bb(0x19c)],'status':_0x414ca7['status'],'txid':_0x414ca7[_0x4642bb(0x173)],'notes':_0x414ca7['notes'],'periodFrom':_0x414ca7[_0x4642bb(0xf9)],'periodTo':_0x414ca7[_0x4642bb(0x99)],'createdAt':_0x414ca7[_0x4642bb(0x108)],'paidAt':_0x414ca7[_0x4642bb(0xe4)]};}async[a38_0xc71753(0x1d2)](_0x27354d){const _0x544403=a38_0xc71753;await database_1['default']['payout'][_0x544403(0x1d5)]({'where':{'id':_0x27354d}});}async['getAllPayments'](_0x434703){const _0x591f67=a38_0xc71753,{page:_0x52b552,limit:_0x4c57c8,status:_0x4a6c25,gateway:_0x2a3e3f,shopId:_0x1341e7,dateFrom:_0x1c50fa,dateTo:_0x2ad2cc,search:_0x19302e,currency:_0x16f5e1,sortBy:_0x3fd23d,sortOrder:_0x22577f}=_0x434703,_0xf08172=(_0x52b552-0x1)*_0x4c57c8;console['log']('📊\x20Getting\x20payments\x20with\x20filters:',_0x434703);const _0x112e10=await database_1[_0x591f67(0xc7)][_0x591f67(0x184)][_0x591f67(0x11f)]({'by':['gateway'],'_count':{'gateway':!![]}});console['log'](_0x591f67(0xd6),_0x112e10[_0x591f67(0x97)](_0x874278=>_0x874278['gateway']+'\x20('+_0x874278[_0x591f67(0x126)]['gateway']+_0x591f67(0x165)));if(_0x2a3e3f){const _0x574d1c=_0x112e10['some'](_0x38c3a9=>_0x38c3a9[_0x591f67(0x179)][_0x591f67(0x1bd)]()===_0x2a3e3f[_0x591f67(0x1bd)]());!_0x574d1c&&_0x2a3e3f[_0x591f67(0x1bd)]()!==_0x591f67(0x144)&&console[_0x591f67(0x131)]('⚠️\x20Requested\x20gateway\x20\x27'+_0x2a3e3f+_0x591f67(0x166)+_0x112e10[_0x591f67(0x97)](_0x15b3a8=>_0x15b3a8['gateway'])['join'](',\x20'));}const _0x5b1580={};_0x4a6c25&&(_0x5b1580['status']=_0x4a6c25['toUpperCase']());if(!_0x2a3e3f)_0x5b1580[_0x591f67(0x179)]={'not':_0x591f67(0x144)};else{if(_0x2a3e3f&&(_0x2a3e3f[_0x591f67(0x1bd)]()===_0x591f67(0x144)||_0x2a3e3f===_0x591f67(0x13b)))_0x5b1580[_0x591f67(0x179)]=_0x591f67(0x144);else{let _0x44515e=_0x2a3e3f;const _0x5e4ca6=(0x0,gateway_1['getGatewayNameById'])(_0x2a3e3f);if(_0x5e4ca6)_0x44515e=_0x5e4ca6,console[_0x591f67(0x131)](_0x591f67(0xcd)+_0x2a3e3f+'\x27\x20to\x20name\x20\x27'+_0x44515e+'\x27');else{const _0x37d9a6=(0x0,gateway_1[_0x591f67(0xb2)])(_0x2a3e3f);if(_0x37d9a6){const _0x4c06a3=(0x0,gateway_1[_0x591f67(0xdc)])(_0x37d9a6);_0x4c06a3&&(_0x44515e=_0x4c06a3,console[_0x591f67(0x131)](_0x591f67(0x96)+_0x2a3e3f+'\x27\x20->\x20ID\x20\x27'+_0x37d9a6+_0x591f67(0x135)+_0x44515e+'\x27'));}else console[_0x591f67(0x131)](_0x591f67(0xf6)+_0x2a3e3f+_0x591f67(0x1a5));}const _0x419769=await database_1[_0x591f67(0xc7)][_0x591f67(0x184)]['count']({'where':{'gateway':_0x44515e[_0x591f67(0x1bd)]()},'take':0x1});_0x419769===0x0?(console[_0x591f67(0x131)](_0x591f67(0x181)+_0x44515e+_0x591f67(0x1c8)+_0x2a3e3f+_0x591f67(0x12e)),_0x5b1580['gateway']='NONEXISTENT_GATEWAY_FILTER'):(_0x5b1580[_0x591f67(0x179)]=_0x44515e[_0x591f67(0x1bd)](),console[_0x591f67(0x131)](_0x591f67(0x16c)+_0x44515e+'\x27\x20(from\x20\x27'+_0x2a3e3f+'\x27)'));}}console[_0x591f67(0x131)](_0x591f67(0x123),_0x5b1580[_0x591f67(0x179)]);_0x1341e7&&(_0x5b1580[_0x591f67(0x1c1)]=_0x1341e7);_0x16f5e1&&(_0x5b1580[_0x591f67(0xbf)]=_0x16f5e1[_0x591f67(0xb8)](),console[_0x591f67(0x131)]('💱\x20Currency\x20filter\x20applied:\x20'+_0x16f5e1[_0x591f67(0xb8)]()));(_0x1c50fa||_0x2ad2cc)&&(_0x5b1580[_0x591f67(0x108)]={},_0x1c50fa&&(_0x5b1580['createdAt'][_0x591f67(0x124)]=new Date(_0x1c50fa)),_0x2ad2cc&&(_0x5b1580[_0x591f67(0x108)][_0x591f67(0xdf)]=new Date(_0x2ad2cc)));_0x19302e&&(_0x5b1580['OR']=[{'id':{'contains':_0x19302e,'mode':'insensitive'}},{'orderId':{'contains':_0x19302e,'mode':_0x591f67(0x10c)}},{'gatewayOrderId':{'contains':_0x19302e,'mode':'insensitive'}},{'customerEmail':{'contains':_0x19302e,'mode':'insensitive'}},{'shop':{'name':{'contains':_0x19302e,'mode':_0x591f67(0x10c)}}},{'shop':{'username':{'contains':_0x19302e,'mode':_0x591f67(0x10c)}}}]);console[_0x591f67(0x131)](_0x591f67(0x17d),JSON['stringify'](_0x5b1580,null,0x2));let _0xd78a84={'createdAt':_0x591f67(0x194)};if(_0x3fd23d){const _0x3fcaaa=[_0x591f67(0x1ae),'createdAt','updatedAt','status',_0x591f67(0x179),_0x591f67(0xbf)],_0x21e8bd=['asc',_0x591f67(0x194)];if(_0x3fcaaa[_0x591f67(0x1b1)](_0x3fd23d)){const _0x300f24=_0x21e8bd[_0x591f67(0x1b1)](_0x22577f)?_0x22577f:'desc';_0xd78a84={[_0x3fd23d]:_0x300f24},console[_0x591f67(0x131)](_0x591f67(0x13f)+_0x3fd23d+_0x591f67(0x17c)+_0x300f24+_0x591f67(0x14d));}}const [_0x34f0b1,_0x330755]=await Promise['all']([database_1[_0x591f67(0xc7)]['payment']['findMany']({'where':_0x5b1580,'skip':_0xf08172,'take':_0x4c57c8,'orderBy':_0xd78a84,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x591f67(0xc7)][_0x591f67(0x184)][_0x591f67(0x18d)]({'where':_0x5b1580})]);return{'payments':_0x34f0b1,'pagination':{'page':_0x52b552,'limit':_0x4c57c8,'total':_0x330755,'totalPages':Math['ceil'](_0x330755/_0x4c57c8)}};}async[a38_0xc71753(0xac)](_0x4d630c){const _0x150a5a=a38_0xc71753,_0x3b8ead=await database_1[_0x150a5a(0xc7)][_0x150a5a(0x184)]['findUnique']({'where':{'id':_0x4d630c},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x3b8ead)return null;return{'id':_0x3b8ead['id'],'shopId':_0x3b8ead['shopId'],'gateway':_0x3b8ead['gateway'],'amount':_0x3b8ead[_0x150a5a(0x1ae)],'currency':_0x3b8ead['currency'],'status':_0x3b8ead[_0x150a5a(0x1c2)],'orderId':_0x3b8ead[_0x150a5a(0x115)],'gatewayOrderId':_0x3b8ead[_0x150a5a(0x186)],'customerEmail':_0x3b8ead['customerEmail'],'customerName':_0x3b8ead['customerName'],'customerCountry':_0x3b8ead[_0x150a5a(0x164)],'customerIp':_0x3b8ead[_0x150a5a(0x168)],'customerUa':_0x3b8ead['customerUa'],'failureMessage':_0x3b8ead[_0x150a5a(0x15c)],'externalPaymentUrl':_0x3b8ead[_0x150a5a(0x196)],'successUrl':_0x3b8ead['successUrl'],'failUrl':_0x3b8ead[_0x150a5a(0x189)],'pendingUrl':_0x3b8ead[_0x150a5a(0x1ca)],'whiteUrl':_0x3b8ead[_0x150a5a(0x190)],'createdAt':_0x3b8ead[_0x150a5a(0x108)],'updatedAt':_0x3b8ead['updatedAt'],'shop':_0x3b8ead[_0x150a5a(0xad)]};}async[a38_0xc71753(0xaf)](_0x451aa9,_0x346d98,_0x5a66b4,_0x1aa61a){const _0x3ed0c6=a38_0xc71753,_0x3bc051=await database_1['default'][_0x3ed0c6(0x12c)](async _0x4cbfbb=>{const _0x2ee7ff=_0x3ed0c6,_0x8c52b3=await _0x4cbfbb[_0x2ee7ff(0x184)][_0x2ee7ff(0x98)]({'where':{'id':_0x451aa9},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x8c52b3)throw new Error('Payment\x20not\x20found');const _0x5b1989=_0x8c52b3[_0x2ee7ff(0x1c2)],_0x5dbe0f=_0x346d98[_0x2ee7ff(0xb8)]();console[_0x2ee7ff(0x131)]('🔄\x20Admin\x20updating\x20payment\x20'+_0x451aa9+_0x2ee7ff(0xc9)+_0x5b1989+'\x20->\x20'+_0x5dbe0f),console[_0x2ee7ff(0x131)](_0x2ee7ff(0x112)+_0x8c52b3[_0x2ee7ff(0xad)][_0x2ee7ff(0x1c5)]+'\x20USDT');const _0xa3e299={'status':_0x5dbe0f,'updatedAt':new Date(),'statusChangedBy':'admin','statusChangedAt':new Date()};_0x5a66b4&&(_0xa3e299[_0x2ee7ff(0xed)]=_0x5a66b4);_0x5dbe0f===_0x2ee7ff(0x14a)&&_0x1aa61a&&(_0xa3e299[_0x2ee7ff(0xdb)]=_0x1aa61a);let _0x3f8790=0x0,_0x36a9ab=_0x8c52b3[_0x2ee7ff(0xad)]['balance'];if(_0x5dbe0f===_0x2ee7ff(0xd7)&&_0x5b1989!=='PAID'){_0xa3e299[_0x2ee7ff(0xe4)]=new Date();const _0x5b7d29=await currencyService_1[_0x2ee7ff(0xd3)]['convertToUSDT'](_0x8c52b3[_0x2ee7ff(0x1ae)],_0x8c52b3[_0x2ee7ff(0xbf)]);_0xa3e299[_0x2ee7ff(0xa7)]=_0x5b7d29;let _0x16cced=0x2d;const _0xb59ef2=await _0x4cbfbb[_0x2ee7ff(0xad)]['findUnique']({'where':{'id':_0x8c52b3[_0x2ee7ff(0x1c1)]},'select':{'gatewaySettings':!![]}});if(_0xb59ef2?.['gatewaySettings'])try{const _0xbb8ab3=JSON[_0x2ee7ff(0xd9)](_0xb59ef2[_0x2ee7ff(0x187)]);for(const [_0x475255,_0x5820ba]of Object[_0x2ee7ff(0x16a)](_0xbb8ab3)){if(_0x475255['toLowerCase']()===_0x8c52b3[_0x2ee7ff(0x179)][_0x2ee7ff(0x1bd)]()){_0x16cced=_0x5820ba[_0x2ee7ff(0x1c9)]||0xa;break;}}}catch(_0xd1e632){console[_0x2ee7ff(0xeb)](_0x2ee7ff(0x14b)+_0x451aa9+':',_0xd1e632);}let _0x342bbb;_0x8c52b3[_0x2ee7ff(0x1d7)]!==null&&_0x8c52b3[_0x2ee7ff(0x1d7)]!==undefined?(_0x342bbb=_0x8c52b3[_0x2ee7ff(0x1d7)],console[_0x2ee7ff(0x131)](_0x2ee7ff(0x132)+_0x342bbb['toFixed'](0x6)+'\x20USDT\x20for\x20payment\x20'+_0x451aa9)):(_0x342bbb=_0x5b7d29*(0x1-_0x16cced/0x64),console[_0x2ee7ff(0x131)]('📊\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20'+_0x451aa9+':\x20'+_0x16cced+_0x2ee7ff(0x1a6)+_0x5b7d29[_0x2ee7ff(0x110)](0x6)+'\x20USDT'),_0xa3e299[_0x2ee7ff(0x1d7)]=_0x342bbb,_0xa3e299[_0x2ee7ff(0xce)]=_0x16cced),_0x3f8790=_0x342bbb,_0x36a9ab+=_0x342bbb,console[_0x2ee7ff(0x131)](_0x2ee7ff(0xf0)+_0x451aa9+_0x2ee7ff(0x176)),console[_0x2ee7ff(0x131)]('\x20\x20\x20Full\x20amount:\x20'+_0x5b7d29['toFixed'](0x6)+_0x2ee7ff(0x1d6)),console[_0x2ee7ff(0x131)](_0x2ee7ff(0xd4)+_0x8c52b3['gateway']+_0x2ee7ff(0x192)+_0x16cced+'%'),console[_0x2ee7ff(0x131)](_0x2ee7ff(0x12f)+_0x342bbb[_0x2ee7ff(0x110)](0x6)+'\x20USDT\x20(after\x20'+_0x16cced+'%\x20commission)'),console['log'](_0x2ee7ff(0xe0)+_0x342bbb[_0x2ee7ff(0x110)](0x6)+_0x2ee7ff(0x1d6));}else{if(_0x5b1989===_0x2ee7ff(0xd7)&&_0x5dbe0f!==_0x2ee7ff(0xd7)){if(_0x8c52b3[_0x2ee7ff(0xa7)]){let _0x555050=0x2d;const _0x5309b2=await _0x4cbfbb[_0x2ee7ff(0xad)]['findUnique']({'where':{'id':_0x8c52b3[_0x2ee7ff(0x1c1)]},'select':{'gatewaySettings':!![]}});if(_0x5309b2?.[_0x2ee7ff(0x187)])try{const _0x4f579c=JSON[_0x2ee7ff(0xd9)](_0x5309b2[_0x2ee7ff(0x187)]);for(const [_0xb4e333,_0xad428]of Object[_0x2ee7ff(0x16a)](_0x4f579c)){if(_0xb4e333[_0x2ee7ff(0x1bd)]()===_0x8c52b3['gateway'][_0x2ee7ff(0x1bd)]()){_0x555050=_0xad428[_0x2ee7ff(0x1c9)]||0xa;break;}}}catch(_0x146380){console[_0x2ee7ff(0xeb)](_0x2ee7ff(0x14b)+_0x451aa9+':',_0x146380);}const _0x102233=_0x8c52b3[_0x2ee7ff(0xa7)]*(0x1-_0x555050/0x64);_0x3f8790=-_0x102233,_0x36a9ab-=_0x102233,_0xa3e299[_0x2ee7ff(0xa7)]=null,_0xa3e299['amountAfterGatewayCommissionUSDT']=null,console[_0x2ee7ff(0x131)]('💰\x20Payment\x20'+_0x451aa9+_0x2ee7ff(0xd2)),console[_0x2ee7ff(0x131)](_0x2ee7ff(0x145)+_0x8c52b3[_0x2ee7ff(0xa7)][_0x2ee7ff(0x110)](0x6)+_0x2ee7ff(0x1d6)),console[_0x2ee7ff(0x131)](_0x2ee7ff(0xd4)+_0x8c52b3[_0x2ee7ff(0x179)]+',\x20Commission:\x20'+_0x555050+'%'),console[_0x2ee7ff(0x131)](_0x2ee7ff(0x16b)+_0x102233[_0x2ee7ff(0x110)](0x6)+'\x20USDT\x20(after\x20'+_0x555050+_0x2ee7ff(0x146)),console[_0x2ee7ff(0x131)](_0x2ee7ff(0x167)+_0x102233['toFixed'](0x6)+_0x2ee7ff(0x1d6));}}}_0x5dbe0f===_0x2ee7ff(0x14a)&&(_0x5b1989===_0x2ee7ff(0xd7)&&_0x8c52b3[_0x2ee7ff(0xa7)]&&console[_0x2ee7ff(0x131)](_0x2ee7ff(0x1c4)),_0x1aa61a&&_0x1aa61a>0x0&&(_0x3f8790-=_0x1aa61a,_0x36a9ab-=_0x1aa61a,console[_0x2ee7ff(0x131)]('💸\x20CHARGEBACK\x20penalty:\x20-'+_0x1aa61a[_0x2ee7ff(0x110)](0x6)+_0x2ee7ff(0x14e))));_0x5dbe0f===_0x2ee7ff(0x9f)&&_0x5b1989===_0x2ee7ff(0xd7)&&console[_0x2ee7ff(0x131)](_0x2ee7ff(0x171));const _0x305cf7=await _0x4cbfbb[_0x2ee7ff(0x184)][_0x2ee7ff(0xa9)]({'where':{'id':_0x451aa9},'data':_0xa3e299,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x3f8790!==0x0&&(await _0x4cbfbb['shop'][_0x2ee7ff(0xa9)]({'where':{'id':_0x8c52b3[_0x2ee7ff(0x1c1)]},'data':{'balance':_0x36a9ab}}),console['log']('💰\x20Shop\x20'+_0x8c52b3['shopId']+'\x20balance\x20updated:\x20'+_0x8c52b3[_0x2ee7ff(0xad)]['balance'][_0x2ee7ff(0x110)](0x6)+_0x2ee7ff(0x161)+_0x36a9ab[_0x2ee7ff(0x110)](0x6)+_0x2ee7ff(0x16e)+(_0x3f8790>0x0?'+':'')+_0x3f8790[_0x2ee7ff(0x110)](0x6)+')')),_0x305cf7;});return{'id':_0x3bc051['id'],'shopId':_0x3bc051['shopId'],'gateway':_0x3bc051[_0x3ed0c6(0x179)],'amount':_0x3bc051[_0x3ed0c6(0x1ae)],'currency':_0x3bc051[_0x3ed0c6(0xbf)],'status':_0x3bc051[_0x3ed0c6(0x1c2)],'orderId':_0x3bc051[_0x3ed0c6(0x115)],'gatewayOrderId':_0x3bc051[_0x3ed0c6(0x186)],'customerEmail':_0x3bc051[_0x3ed0c6(0xe7)],'customerName':_0x3bc051[_0x3ed0c6(0x147)],'customerCountry':_0x3bc051[_0x3ed0c6(0x164)],'customerIp':_0x3bc051[_0x3ed0c6(0x168)],'customerUa':_0x3bc051[_0x3ed0c6(0x19e)],'failureMessage':_0x3bc051[_0x3ed0c6(0x15c)],'adminNotes':_0x3bc051['adminNotes'],'chargebackAmount':_0x3bc051[_0x3ed0c6(0xdb)],'statusChangedBy':_0x3bc051[_0x3ed0c6(0xfe)],'statusChangedAt':_0x3bc051[_0x3ed0c6(0x104)],'createdAt':_0x3bc051[_0x3ed0c6(0x108)],'updatedAt':_0x3bc051[_0x3ed0c6(0x118)],'shop':_0x3bc051[_0x3ed0c6(0xad)]};}async[a38_0xc71753(0xef)](_0x53ba9a,_0x469ce8){const _0x358d13=a38_0xc71753,_0x438fab=Math[_0x358d13(0x18b)]()[_0x358d13(0xde)](0x24)[_0x358d13(0x1c3)](0x2,0x9);console[_0x358d13(0x131)](_0x358d13(0x1db)+_0x438fab+_0x358d13(0x128)+_0x53ba9a);const _0x4caf8d={..._0x469ce8};_0x469ce8[_0x358d13(0x134)]&&_0x469ce8['password']['trim']()!==''?(console[_0x358d13(0x131)]('🔐\x20['+_0x438fab+_0x358d13(0x16f)+_0x53ba9a),_0x4caf8d[_0x358d13(0x134)]=await bcryptjs_1[_0x358d13(0xc7)]['hash'](_0x469ce8['password'],0xc)):(console[_0x358d13(0x131)]('🔐\x20['+_0x438fab+_0x358d13(0x137)),delete _0x4caf8d[_0x358d13(0x134)]);_0x469ce8[_0x358d13(0xab)]&&(_0x4caf8d[_0x358d13(0xa2)]=_0x469ce8[_0x358d13(0xab)],delete _0x4caf8d[_0x358d13(0xab)]);_0x469ce8['telegramId']&&(_0x4caf8d[_0x358d13(0x178)]=_0x469ce8[_0x358d13(0x9a)],delete _0x4caf8d[_0x358d13(0x9a)]);_0x469ce8[_0x358d13(0xbb)]&&(_0x4caf8d['shopUrl']=_0x469ce8[_0x358d13(0xbb)],delete _0x4caf8d[_0x358d13(0xbb)]);if(_0x469ce8[_0x358d13(0x142)]){const _0x3a9d60=_0x469ce8[_0x358d13(0x142)][_0x358d13(0x97)](_0x43c191=>this[_0x358d13(0x17e)](_0x43c191));console[_0x358d13(0x131)](_0x358d13(0x18c),_0x469ce8['gateways'],'->',_0x3a9d60),_0x4caf8d[_0x358d13(0x11a)]=JSON[_0x358d13(0xda)](_0x3a9d60),delete _0x4caf8d['gateways'];}_0x469ce8[_0x358d13(0x187)]&&(console['log'](_0x358d13(0x120)+_0x438fab+_0x358d13(0xb1),_0x469ce8[_0x358d13(0x187)]),_0x4caf8d[_0x358d13(0x187)]=JSON[_0x358d13(0xda)](_0x469ce8[_0x358d13(0x187)]),console['log'](_0x358d13(0x120)+_0x438fab+_0x358d13(0xc4),_0x4caf8d['gatewaySettings']));_0x469ce8['wallets']&&(_0x469ce8[_0x358d13(0xcc)][_0x358d13(0x153)]!==undefined&&(_0x4caf8d['usdtPolygonWallet']=_0x469ce8['wallets']['usdtPolygonWallet']||null),_0x469ce8[_0x358d13(0xcc)][_0x358d13(0x148)]!==undefined&&(_0x4caf8d['usdtTrcWallet']=_0x469ce8[_0x358d13(0xcc)][_0x358d13(0x148)]||null),_0x469ce8['wallets'][_0x358d13(0xa5)]!==undefined&&(_0x4caf8d[_0x358d13(0xa5)]=_0x469ce8[_0x358d13(0xcc)][_0x358d13(0xa5)]||null),_0x469ce8['wallets'][_0x358d13(0x193)]!==undefined&&(_0x4caf8d['usdcPolygonWallet']=_0x469ce8[_0x358d13(0xcc)]['usdcPolygonWallet']||null),delete _0x4caf8d[_0x358d13(0xcc)]);const _0x25adeb=await database_1['default'][_0x358d13(0xad)][_0x358d13(0xa9)]({'where':{'id':_0x53ba9a},'data':_0x4caf8d,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0x358d13(0x131)]('🎯\x20['+_0x438fab+']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:',_0x25adeb[_0x358d13(0x187)]),{'id':_0x25adeb['id'],'fullName':_0x25adeb[_0x358d13(0xa2)],'username':_0x25adeb['username'],'telegramId':_0x25adeb[_0x358d13(0x178)],'merchantUrl':_0x25adeb[_0x358d13(0x11e)],'gateways':_0x25adeb[_0x358d13(0x11a)]?JSON[_0x358d13(0xd9)](_0x25adeb[_0x358d13(0x11a)]):null,'gatewaySettings':_0x25adeb['gatewaySettings']?JSON[_0x358d13(0xd9)](_0x25adeb[_0x358d13(0x187)]):null,'publicKey':_0x25adeb['publicKey'],'wallets':{'usdtPolygonWallet':_0x25adeb[_0x358d13(0x153)],'usdtTrcWallet':_0x25adeb[_0x358d13(0x148)],'usdtErcWallet':_0x25adeb[_0x358d13(0xa5)],'usdcPolygonWallet':_0x25adeb[_0x358d13(0x193)]},'status':_0x25adeb['status'],'createdAt':_0x25adeb[_0x358d13(0x108)]};}async[a38_0xc71753(0x1ab)](_0x1fb9a8){const _0x5214e5=a38_0xc71753,_0x5eb68c=await database_1[_0x5214e5(0xc7)]['shop']['update']({'where':{'id':_0x1fb9a8},'data':{'status':'SUSPENDED'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x5eb68c['id'],'fullName':_0x5eb68c[_0x5214e5(0xa2)],'username':_0x5eb68c[_0x5214e5(0x1a7)],'telegramId':_0x5eb68c[_0x5214e5(0x178)],'merchantUrl':_0x5eb68c[_0x5214e5(0x11e)],'gateways':_0x5eb68c['paymentGateways']?JSON[_0x5214e5(0xd9)](_0x5eb68c[_0x5214e5(0x11a)]):null,'gatewaySettings':_0x5eb68c[_0x5214e5(0x187)]?JSON[_0x5214e5(0xd9)](_0x5eb68c['gatewaySettings']):null,'publicKey':_0x5eb68c[_0x5214e5(0xe9)],'wallets':{'usdtPolygonWallet':_0x5eb68c['usdtPolygonWallet'],'usdtTrcWallet':_0x5eb68c[_0x5214e5(0x148)],'usdtErcWallet':_0x5eb68c[_0x5214e5(0xa5)],'usdcPolygonWallet':_0x5eb68c[_0x5214e5(0x193)]},'status':_0x5eb68c[_0x5214e5(0x1c2)],'createdAt':_0x5eb68c[_0x5214e5(0x108)]};}async['activateUser'](_0x584d66){const _0x5221f4=a38_0xc71753,_0x3395b6=await database_1[_0x5221f4(0xc7)][_0x5221f4(0xad)]['update']({'where':{'id':_0x584d66},'data':{'status':_0x5221f4(0x1c7)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x3395b6['id'],'fullName':_0x3395b6[_0x5221f4(0xa2)],'username':_0x3395b6[_0x5221f4(0x1a7)],'telegramId':_0x3395b6[_0x5221f4(0x178)],'merchantUrl':_0x3395b6[_0x5221f4(0x11e)],'gateways':_0x3395b6['paymentGateways']?JSON[_0x5221f4(0xd9)](_0x3395b6[_0x5221f4(0x11a)]):null,'gatewaySettings':_0x3395b6[_0x5221f4(0x187)]?JSON[_0x5221f4(0xd9)](_0x3395b6[_0x5221f4(0x187)]):null,'publicKey':_0x3395b6[_0x5221f4(0xe9)],'wallets':{'usdtPolygonWallet':_0x3395b6[_0x5221f4(0x153)],'usdtTrcWallet':_0x3395b6[_0x5221f4(0x148)],'usdtErcWallet':_0x3395b6['usdtErcWallet'],'usdcPolygonWallet':_0x3395b6[_0x5221f4(0x193)]},'status':_0x3395b6['status'],'createdAt':_0x3395b6[_0x5221f4(0x108)]};}async['getAllUsers'](_0x15c69b){const _0x1221eb=a38_0xc71753,{page:_0x286dfa,limit:_0x1b86fc,status:_0x7847d4}=_0x15c69b,_0x1cab69=(_0x286dfa-0x1)*_0x1b86fc,_0x3d46c3={};_0x7847d4&&(_0x3d46c3[_0x1221eb(0x1c2)]=_0x7847d4[_0x1221eb(0xb8)]());const [_0x57b446,_0x3f851a]=await Promise[_0x1221eb(0xe8)]([database_1['default'][_0x1221eb(0xad)][_0x1221eb(0x1bb)]({'where':_0x3d46c3,'skip':_0x1cab69,'take':_0x1b86fc,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x1221eb(0xc7)]['shop']['count']({'where':_0x3d46c3})]);return{'users':_0x57b446[_0x1221eb(0x97)](_0x4f52f1=>{const _0x4a5164=_0x1221eb,_0x49cefe=_0x4f52f1[_0x4a5164(0x11a)]?JSON[_0x4a5164(0xd9)](_0x4f52f1[_0x4a5164(0x11a)]):null,_0x1e9a2a=_0x49cefe?_0x49cefe[_0x4a5164(0x97)](_0x30f11f=>this[_0x4a5164(0xa3)](_0x30f11f)):null;return{'id':_0x4f52f1['id'],'fullName':_0x4f52f1[_0x4a5164(0xa2)],'username':_0x4f52f1[_0x4a5164(0x1a7)],'telegramId':_0x4f52f1['telegram'],'merchantUrl':_0x4f52f1[_0x4a5164(0x11e)],'gateways':_0x1e9a2a,'gatewaySettings':_0x4f52f1['gatewaySettings']?JSON['parse'](_0x4f52f1[_0x4a5164(0x187)]):null,'publicKey':_0x4f52f1[_0x4a5164(0xe9)],'wallets':{'usdtPolygonWallet':_0x4f52f1[_0x4a5164(0x153)],'usdtTrcWallet':_0x4f52f1['usdtTrcWallet'],'usdtErcWallet':_0x4f52f1[_0x4a5164(0xa5)],'usdcPolygonWallet':_0x4f52f1['usdcPolygonWallet']},'status':_0x4f52f1['status'],'createdAt':_0x4f52f1[_0x4a5164(0x108)]};}),'pagination':{'page':_0x286dfa,'limit':_0x1b86fc,'total':_0x3f851a,'totalPages':Math['ceil'](_0x3f851a/_0x1b86fc)}};}async[a38_0xc71753(0xc3)](_0x54f835){const _0x36a52f=a38_0xc71753,_0x49ce98=await database_1[_0x36a52f(0xc7)][_0x36a52f(0xad)]['findUnique']({'where':{'id':_0x54f835},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x49ce98)return null;const _0x1f83cc=_0x49ce98[_0x36a52f(0x11a)]?JSON['parse'](_0x49ce98['paymentGateways']):null,_0xbcf17d=_0x1f83cc?_0x1f83cc['map'](_0x12cc17=>this['getGatewayDisplayName'](_0x12cc17)):null;return _0x1f83cc&&_0xbcf17d&&console[_0x36a52f(0x131)]('🔄\x20Gateway\x20mapping\x20(get):',_0x1f83cc,'->',_0xbcf17d),{'id':_0x49ce98['id'],'fullName':_0x49ce98[_0x36a52f(0xa2)],'username':_0x49ce98[_0x36a52f(0x1a7)],'telegramId':_0x49ce98[_0x36a52f(0x178)],'merchantUrl':_0x49ce98[_0x36a52f(0x11e)],'gateways':_0xbcf17d,'gatewaySettings':_0x49ce98[_0x36a52f(0x187)]?JSON[_0x36a52f(0xd9)](_0x49ce98[_0x36a52f(0x187)]):null,'publicKey':_0x49ce98['publicKey'],'wallets':{'usdtPolygonWallet':_0x49ce98[_0x36a52f(0x153)],'usdtTrcWallet':_0x49ce98[_0x36a52f(0x148)],'usdtErcWallet':_0x49ce98[_0x36a52f(0xa5)],'usdcPolygonWallet':_0x49ce98['usdcPolygonWallet']},'status':_0x49ce98['status'],'createdAt':_0x49ce98[_0x36a52f(0x108)]};}async[a38_0xc71753(0x188)](_0x573a8b){const _0x71dca5=a38_0xc71753,{fullName:_0x178fbe,username:_0x5d4655,password:_0xf51c71,telegramId:_0x20d00c,merchantUrl:_0x1b2baf,gateways:_0x494f30,gatewaySettings:_0x152399,wallets:_0x1f75b3}=_0x573a8b,_0x373724=await database_1[_0x71dca5(0xc7)]['shop'][_0x71dca5(0x98)]({'where':{'username':_0x5d4655}});if(_0x373724)throw new Error(_0x71dca5(0x1bf));if(_0x20d00c){const _0x59c620=await database_1[_0x71dca5(0xc7)][_0x71dca5(0xad)]['findUnique']({'where':{'telegram':_0x20d00c}});if(_0x59c620)throw new Error(_0x71dca5(0x163));}const _0x37867e=await bcryptjs_1[_0x71dca5(0xc7)][_0x71dca5(0x13e)](_0xf51c71,0xc),_0x860393=_0x71dca5(0x1b0)+crypto_1[_0x71dca5(0xc7)][_0x71dca5(0xfc)](0x20)[_0x71dca5(0xde)](_0x71dca5(0x18a)),_0x2e19cd=_0x71dca5(0x13a)+crypto_1[_0x71dca5(0xc7)]['randomBytes'](0x20)['toString'](_0x71dca5(0x18a)),_0x1100f6=_0x494f30?_0x494f30[_0x71dca5(0x97)](_0x22e39d=>this[_0x71dca5(0x17e)](_0x22e39d)):null;_0x494f30&&_0x1100f6&&console[_0x71dca5(0x131)](_0x71dca5(0x14c),_0x494f30,'->',_0x1100f6);const _0x345125=await database_1[_0x71dca5(0xc7)]['shop'][_0x71dca5(0xe1)]({'data':{'name':_0x178fbe,'username':_0x5d4655,'password':_0x37867e,'telegram':_0x20d00c,'shopUrl':_0x1b2baf,'paymentGateways':_0x1100f6?JSON[_0x71dca5(0xda)](_0x1100f6):null,'gatewaySettings':_0x152399?JSON[_0x71dca5(0xda)](_0x152399):null,'usdtPolygonWallet':_0x1f75b3?.[_0x71dca5(0x153)]||null,'usdtTrcWallet':_0x1f75b3?.[_0x71dca5(0x148)]||null,'usdtErcWallet':_0x1f75b3?.[_0x71dca5(0xa5)]||null,'usdcPolygonWallet':_0x1f75b3?.[_0x71dca5(0x193)]||null,'publicKey':_0x860393,'secretKey':_0x2e19cd,'status':_0x71dca5(0x1c7)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x345125['id'],'fullName':_0x345125[_0x71dca5(0xa2)],'username':_0x345125[_0x71dca5(0x1a7)],'telegramId':_0x345125[_0x71dca5(0x178)],'merchantUrl':_0x345125[_0x71dca5(0x11e)],'gateways':_0x345125[_0x71dca5(0x11a)]?JSON['parse'](_0x345125[_0x71dca5(0x11a)]):null,'gatewaySettings':_0x345125[_0x71dca5(0x187)]?JSON['parse'](_0x345125['gatewaySettings']):null,'publicKey':_0x345125[_0x71dca5(0xe9)],'wallets':{'usdtPolygonWallet':_0x345125[_0x71dca5(0x153)],'usdtTrcWallet':_0x345125[_0x71dca5(0x148)],'usdtErcWallet':_0x345125['usdtErcWallet'],'usdcPolygonWallet':_0x345125[_0x71dca5(0x193)]},'status':_0x345125[_0x71dca5(0x1c2)],'createdAt':_0x345125['createdAt']};}async[a38_0xc71753(0x1d4)](_0x3edf70){const _0x55f00b=a38_0xc71753;await database_1[_0x55f00b(0xc7)][_0x55f00b(0xad)][_0x55f00b(0x1d5)]({'where':{'id':_0x3edf70}});}['generateDailyStatistics'](_0x315a2d,_0x2b718e,_0x434d74){const _0x3e4250=a38_0xc71753,_0x559bb8=new Map(),_0x2eddfb=new Date(_0x2b718e);while(_0x2eddfb<=_0x434d74){const _0x3f79a1=_0x2eddfb[_0x3e4250(0x154)]()[_0x3e4250(0xf7)]('T')[0x0];_0x559bb8[_0x3e4250(0x1ce)](_0x3f79a1,{'revenue':0x0,'count':0x0}),_0x2eddfb[_0x3e4250(0x94)](_0x2eddfb[_0x3e4250(0xc0)]()+0x1);}for(const _0x2a96f8 of _0x315a2d){const _0x96b275=_0x2a96f8[_0x3e4250(0x108)][_0x3e4250(0x154)]()[_0x3e4250(0xf7)]('T')[0x0],_0x3acf74=_0x559bb8[_0x3e4250(0x139)](_0x96b275);_0x3acf74&&(_0x3acf74[_0x3e4250(0x18d)]+=0x1,_0x2a96f8[_0x3e4250(0x1c2)]===_0x3e4250(0xd7)&&(_0x2a96f8['amountUSDT']?_0x3acf74['revenue']+=_0x2a96f8['amountUSDT']:console[_0x3e4250(0x131)](_0x3e4250(0xe5)+_0x2a96f8['id']+_0x3e4250(0x125))));}const _0x5c7529=[],_0x328e12=[];for(const [_0x387986,_0x24dfee]of _0x559bb8){_0x5c7529['push']({'date':_0x387986,'amount':Math[_0x3e4250(0x141)](_0x24dfee['revenue']*0x64)/0x64}),_0x328e12[_0x3e4250(0x1b7)]({'date':_0x387986,'count':_0x24dfee['count']});}return{'dailyRevenue':_0x5c7529,'dailyPayments':_0x328e12};}}exports[a38_0xc71753(0xa4)]=AdminService;