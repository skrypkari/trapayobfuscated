'use strict';const a35_0x5a9071=a35_0x4c70;(function(_0x2c9731,_0x9c4a58){const _0x8d9106=a35_0x4c70,_0xc299d1=_0x2c9731();while(!![]){try{const _0x38349a=-parseInt(_0x8d9106(0x139))/0x1*(parseInt(_0x8d9106(0x169))/0x2)+parseInt(_0x8d9106(0xc7))/0x3*(parseInt(_0x8d9106(0x167))/0x4)+-parseInt(_0x8d9106(0x119))/0x5+parseInt(_0x8d9106(0x11e))/0x6+-parseInt(_0x8d9106(0xfd))/0x7+parseInt(_0x8d9106(0xe6))/0x8+parseInt(_0x8d9106(0xc4))/0x9;if(_0x38349a===_0x9c4a58)break;else _0xc299d1['push'](_0xc299d1['shift']());}catch(_0x246f67){_0xc299d1['push'](_0xc299d1['shift']());}}}(a35_0x5dfe,0x286af));var __importDefault=this&&this['__importDefault']||function(_0x79a414){return _0x79a414&&_0x79a414['__esModule']?_0x79a414:{'default':_0x79a414};};Object[a35_0x5a9071(0x17b)](exports,a35_0x5a9071(0x109),{'value':!![]}),exports[a35_0x5a9071(0xcf)]=void 0x0;const database_1=__importDefault(require(a35_0x5a9071(0x10c))),bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a35_0x5a9071(0x165))),currencyService_1=require(a35_0x5a9071(0x17a));class AdminService{async['getPayoutStats'](){const _0x1c543c=a35_0x5a9071;console[_0x1c543c(0xe0)](_0x1c543c(0x142));const _0x1ef4f8=await database_1[_0x1c543c(0x11f)]['payment'][_0x1c543c(0x166)]({'where':{'status':'PAID','paidAt':{'not':null}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'merchantPaid':!![],'paidAt':!![],'createdAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x1c543c(0xe0)]('💰\x20Found\x20'+_0x1ef4f8[_0x1c543c(0x180)]+_0x1c543c(0x156));let _0x32405e=0x0,_0x793efd=0x0,_0x1d4935=0x0;for(const _0x20ad29 of _0x1ef4f8){try{const _0x59f200=await currencyService_1[_0x1c543c(0xcc)][_0x1c543c(0x146)](_0x20ad29['amount'],_0x20ad29[_0x1c543c(0xc5)]);let _0x1cbda8={};if(_0x20ad29[_0x1c543c(0xf4)][_0x1c543c(0xdd)])try{_0x1cbda8=JSON[_0x1c543c(0x177)](_0x20ad29['shop']['gatewaySettings']);}catch(_0x47a406){console[_0x1c543c(0xfa)](_0x1c543c(0x111)+_0x20ad29[_0x1c543c(0xef)]+':',_0x47a406);}const _0x45d708=_0x1cbda8['commission']||0xa,_0x519ed2=_0x59f200*(0x1-_0x45d708/0x64);_0x20ad29[_0x1c543c(0x144)]?(_0x32405e+=_0x519ed2,console[_0x1c543c(0xe0)](_0x1c543c(0x149)+_0x20ad29['id']+':\x20'+_0x519ed2['toFixed'](0x2)+_0x1c543c(0xdc))):(_0x793efd+=_0x519ed2,_0x1d4935+=_0x59f200,console['log'](_0x1c543c(0x182)+_0x20ad29['id']+':\x20'+_0x519ed2[_0x1c543c(0x10f)](0x2)+_0x1c543c(0x16c)));}catch(_0x24550e){console[_0x1c543c(0xfa)](_0x1c543c(0xd1)+_0x20ad29['id']+':',_0x24550e);}}const _0x39d2f3=new Date(),_0x510c60=new Date(_0x39d2f3[_0x1c543c(0xbf)](),_0x39d2f3[_0x1c543c(0x13b)](),0x1),_0x300506=new Date(_0x39d2f3[_0x1c543c(0xbf)](),_0x39d2f3[_0x1c543c(0x13b)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x33c071=await database_1['default'][_0x1c543c(0xf2)][_0x1c543c(0x166)]({'where':{'createdAt':{'gte':_0x510c60,'lte':_0x300506},'status':'COMPLETED'},'select':{'amount':!![]}}),_0x257637=_0x33c071[_0x1c543c(0x11c)]((_0x257826,_0x5ec3a1)=>_0x257826+_0x5ec3a1[_0x1c543c(0xf0)],0x0),_0x2ea434={'totalPayout':Math[_0x1c543c(0x100)](_0x32405e*0x64)/0x64,'awaitingPayout':Math[_0x1c543c(0x100)](_0x793efd*0x64)/0x64,'thisMonth':Math['round'](_0x257637*0x64)/0x64,'availableBalance':Math[_0x1c543c(0x100)](_0x1d4935*0x64)/0x64};return console[_0x1c543c(0xe0)](_0x1c543c(0xd5)),console[_0x1c543c(0xe0)]('\x20\x20\x20💰\x20Total\x20payout:\x20'+_0x2ea434[_0x1c543c(0xd0)]+_0x1c543c(0x136)),console[_0x1c543c(0xe0)](_0x1c543c(0x101)+_0x2ea434[_0x1c543c(0x131)]+_0x1c543c(0xcb)),console[_0x1c543c(0xe0)](_0x1c543c(0x138)+_0x2ea434[_0x1c543c(0x127)]+'\x20USDT\x20(before\x20commission)'),console[_0x1c543c(0xe0)]('\x20\x20\x20📅\x20This\x20month:\x20'+_0x2ea434['thisMonth']+_0x1c543c(0x133)),_0x2ea434;}async[a35_0x5a9071(0xca)](_0x40567d,_0x41f228){const _0x1cce5f=a35_0x5a9071;console['log']('🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20'+_0x40567d+':',_0x41f228);const _0x514004=await database_1[_0x1cce5f(0x11f)][_0x1cce5f(0x121)][_0x1cce5f(0xea)]({'where':{'id':_0x40567d},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x514004)throw new Error(_0x1cce5f(0xc2));const _0x2bee2f={};_0x41f228[_0x1cce5f(0x10d)]!==undefined&&(_0x2bee2f[_0x1cce5f(0x10d)]=_0x41f228[_0x1cce5f(0x10d)]||null);_0x41f228['customerIp']!==undefined&&(_0x2bee2f['customerIp']=_0x41f228[_0x1cce5f(0x15b)]||null);_0x41f228['customerUa']!==undefined&&(_0x2bee2f[_0x1cce5f(0x185)]=_0x41f228[_0x1cce5f(0x185)]||null);const _0x23b8e2=await database_1['default'][_0x1cce5f(0x121)][_0x1cce5f(0xeb)]({'where':{'id':_0x40567d},'data':{..._0x2bee2f,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x1cce5f(0xe0)](_0x1cce5f(0x115)+_0x40567d),console[_0x1cce5f(0xe0)](_0x1cce5f(0x112)+_0x514004[_0x1cce5f(0x10d)]+_0x1cce5f(0x117)+_0x23b8e2[_0x1cce5f(0x10d)]),console['log']('\x20\x20\x20🌐\x20IP:\x20'+_0x514004['customerIp']+'\x20->\x20'+_0x23b8e2[_0x1cce5f(0x15b)]),console[_0x1cce5f(0xe0)](_0x1cce5f(0xff)+(_0x514004[_0x1cce5f(0x185)]?_0x1cce5f(0x108):_0x1cce5f(0x130))+_0x1cce5f(0x117)+(_0x23b8e2[_0x1cce5f(0x185)]?_0x1cce5f(0x108):'not\x20set')),_0x23b8e2;}async[a35_0x5a9071(0x113)](_0x37c05c){const _0x137d7e=a35_0x5a9071,_0x26f081=new Date();let _0x159a87;switch(_0x37c05c){case'7d':_0x159a87=new Date(_0x26f081[_0x137d7e(0x118)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x137d7e(0x157):_0x159a87=new Date(_0x26f081[_0x137d7e(0x118)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x137d7e(0x124):_0x159a87=new Date(_0x26f081['getTime']()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x159a87=new Date(_0x26f081[_0x137d7e(0x118)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x23923c,_0x2c27d0,_0x2c49bc,_0x302c80,_0x5e06dd,_0x123d69]=await Promise['all']([database_1[_0x137d7e(0x11f)][_0x137d7e(0xf4)][_0x137d7e(0x187)](),database_1['default']['shop'][_0x137d7e(0x187)]({'where':{'status':_0x137d7e(0x134)}}),database_1[_0x137d7e(0x11f)][_0x137d7e(0x121)][_0x137d7e(0x187)]({'where':{'createdAt':{'gte':_0x159a87},'gateway':{'not':_0x137d7e(0xcd)}}}),database_1[_0x137d7e(0x11f)][_0x137d7e(0x121)][_0x137d7e(0x187)]({'where':{'status':_0x137d7e(0x17d),'createdAt':{'gte':_0x159a87},'gateway':{'not':_0x137d7e(0xcd)}}}),database_1[_0x137d7e(0x11f)]['payment']['findMany']({'where':{'status':_0x137d7e(0x17d),'createdAt':{'gte':_0x159a87},'gateway':{'not':_0x137d7e(0xcd)}},'select':{'amount':!![],'currency':!![]}}),database_1[_0x137d7e(0x11f)][_0x137d7e(0x121)][_0x137d7e(0x166)]({'where':{'gateway':{'not':_0x137d7e(0xcd)}},'take':0xa,'orderBy':{'createdAt':_0x137d7e(0x184)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}})]);let _0x3caf6b=0x0;for(const _0x5f46a9 of _0x5e06dd){const _0xd51dcd=await currencyService_1[_0x137d7e(0xcc)][_0x137d7e(0x146)](_0x5f46a9['amount'],_0x5f46a9[_0x137d7e(0xc5)]);_0x3caf6b+=_0xd51dcd;}const _0x590bbf=_0x2c49bc>0x0?_0x302c80/_0x2c49bc*0x64:0x0;return{'totalShops':_0x23923c,'activeShops':_0x2c27d0,'totalPayments':_0x2c49bc,'successfulPayments':_0x302c80,'totalRevenue':Math[_0x137d7e(0x100)](_0x3caf6b*0x64)/0x64,'conversionRate':Math[_0x137d7e(0x100)](_0x590bbf*0x64)/0x64,'recentPayments':_0x123d69[_0x137d7e(0x13e)](_0x356cf5=>({'id':_0x356cf5['id'],'amount':_0x356cf5[_0x137d7e(0xf0)],'currency':_0x356cf5['currency'],'status':_0x356cf5[_0x137d7e(0x15e)],'gateway':_0x356cf5['gateway'],'shop':_0x356cf5[_0x137d7e(0xf4)],'createdAt':_0x356cf5['createdAt']}))};}async['getMerchantStatistics'](_0x597cea){const _0x4a6a6b=a35_0x5a9071;console[_0x4a6a6b(0xe0)](_0x4a6a6b(0x179),_0x597cea);let _0x504abb,_0x305a84=new Date();if(_0x597cea['period']===_0x4a6a6b(0x164)&&_0x597cea[_0x4a6a6b(0x103)]&&_0x597cea[_0x4a6a6b(0x11b)])_0x504abb=new Date(_0x597cea[_0x4a6a6b(0x103)]),_0x305a84=new Date(_0x597cea[_0x4a6a6b(0x11b)]);else{const _0x26a4f2=new Date();switch(_0x597cea[_0x4a6a6b(0x120)]){case _0x4a6a6b(0x163):_0x504abb=new Date(_0x26a4f2['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x4a6a6b(0x145):_0x504abb=new Date(_0x26a4f2[_0x4a6a6b(0x118)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x4a6a6b(0x13c):_0x504abb=new Date(_0x26a4f2[_0x4a6a6b(0x118)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x4a6a6b(0x110):default:_0x504abb=new Date(_0x4a6a6b(0xda));break;}}console[_0x4a6a6b(0xe0)](_0x4a6a6b(0x140)+_0x504abb[_0x4a6a6b(0x10e)]()+_0x4a6a6b(0x126)+_0x305a84['toISOString']());const _0x51f1b8={'status':_0x4a6a6b(0x17d),'gateway':{'not':_0x4a6a6b(0xcd)},'paidAt':{'gte':_0x504abb,'lte':_0x305a84}};_0x597cea[_0x4a6a6b(0xef)]&&(_0x51f1b8[_0x4a6a6b(0xef)]=_0x597cea[_0x4a6a6b(0xef)]);const _0x176c1d=await database_1[_0x4a6a6b(0x11f)]['payment']['findMany']({'where':_0x51f1b8,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x4a6a6b(0xe0)]('💰\x20Found\x20'+_0x176c1d['length']+'\x20paid\x20payments\x20for\x20analysis');let _0x214898=0x0,_0x52cef7=0x0,_0xdd3d22=0x0;const _0x4f29fd={},_0x4fe880={},_0x2f2996={};for(const _0x55b022 of _0x176c1d){try{const _0x590e9b=await currencyService_1[_0x4a6a6b(0xcc)][_0x4a6a6b(0x146)](_0x55b022[_0x4a6a6b(0xf0)],_0x55b022['currency']);let _0x1a3206={};if(_0x55b022[_0x4a6a6b(0xf4)][_0x4a6a6b(0xdd)])try{_0x1a3206=JSON[_0x4a6a6b(0x177)](_0x55b022['shop'][_0x4a6a6b(0xdd)]);}catch(_0x257a2b){console[_0x4a6a6b(0xfa)](_0x4a6a6b(0x111)+_0x55b022[_0x4a6a6b(0xef)]+':',_0x257a2b);}const _0x687821=_0x1a3206[_0x4a6a6b(0xee)]||0xa,_0x3c2484=_0x590e9b*(_0x687821/0x64),_0x1f5a21=_0x590e9b-_0x3c2484;_0x214898+=_0x590e9b,_0x52cef7+=_0x1f5a21,_0xdd3d22+=_0x3c2484;!_0x4f29fd[_0x55b022[_0x4a6a6b(0x152)]]&&(_0x4f29fd[_0x55b022[_0x4a6a6b(0x152)]]={'gateway':_0x55b022[_0x4a6a6b(0x152)],'gatewayDisplayName':this[_0x4a6a6b(0xf9)](_0x55b022[_0x4a6a6b(0x152)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x4f29fd[_0x55b022[_0x4a6a6b(0x152)]][_0x4a6a6b(0xe3)]++,_0x4f29fd[_0x55b022[_0x4a6a6b(0x152)]][_0x4a6a6b(0xfe)]+=_0x590e9b,_0x4f29fd[_0x55b022[_0x4a6a6b(0x152)]][_0x4a6a6b(0x12d)]+=_0x3c2484,_0x4f29fd[_0x55b022[_0x4a6a6b(0x152)]]['merchantEarningsUSDT']+=_0x1f5a21,_0x4f29fd[_0x55b022[_0x4a6a6b(0x152)]][_0x4a6a6b(0xf8)]+=_0x687821;!_0x597cea[_0x4a6a6b(0xef)]&&(!_0x4fe880[_0x55b022[_0x4a6a6b(0xef)]]&&(_0x4fe880[_0x55b022['shopId']]={'shopId':_0x55b022[_0x4a6a6b(0xef)],'shopName':_0x55b022[_0x4a6a6b(0xf4)][_0x4a6a6b(0x16f)],'shopUsername':_0x55b022[_0x4a6a6b(0xf4)][_0x4a6a6b(0x15f)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x4fe880[_0x55b022[_0x4a6a6b(0xef)]]['paymentsCount']++,_0x4fe880[_0x55b022[_0x4a6a6b(0xef)]]['turnoverUSDT']+=_0x590e9b,_0x4fe880[_0x55b022[_0x4a6a6b(0xef)]]['commissionUSDT']+=_0x3c2484,_0x4fe880[_0x55b022[_0x4a6a6b(0xef)]]['merchantEarningsUSDT']+=_0x1f5a21);const _0x34684b=_0x55b022['paidAt'][_0x4a6a6b(0x10e)]()[_0x4a6a6b(0x17e)]('T')[0x0];!_0x2f2996[_0x34684b]&&(_0x2f2996[_0x34684b]={'date':_0x34684b,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x2f2996[_0x34684b]['turnover']+=_0x590e9b,_0x2f2996[_0x34684b][_0x4a6a6b(0x14c)]+=_0x1f5a21,_0x2f2996[_0x34684b]['gatewayEarnings']+=_0x3c2484,_0x2f2996[_0x34684b][_0x4a6a6b(0xe3)]++;}catch(_0x880612){console[_0x4a6a6b(0xfa)]('Error\x20processing\x20payment\x20'+_0x55b022['id']+':',_0x880612);}}Object[_0x4a6a6b(0x17c)](_0x4f29fd)['forEach'](_0x527c45=>{const _0x34ea23=_0x4a6a6b;_0x527c45[_0x34ea23(0x150)]=_0x527c45['paymentsCount']>0x0?_0x527c45[_0x34ea23(0xf8)]/_0x527c45[_0x34ea23(0xe3)]:0x0,delete _0x527c45['totalCommissionRate'];}),Object[_0x4a6a6b(0x17c)](_0x4fe880)[_0x4a6a6b(0x168)](_0x4c0b06=>{const _0x220509=_0x4a6a6b;_0x4c0b06[_0x220509(0x12a)]=_0x4c0b06[_0x220509(0xe3)]>0x0?_0x4c0b06[_0x220509(0xfe)]/_0x4c0b06[_0x220509(0xe3)]:0x0;});let _0x411e0e=0x0;if(_0x597cea['shopId']){const _0x2ba25a=await database_1[_0x4a6a6b(0x11f)][_0x4a6a6b(0xf2)][_0x4a6a6b(0x166)]({'where':{'shopId':_0x597cea['shopId'],'status':_0x4a6a6b(0x158),'createdAt':{'gte':_0x504abb,'lte':_0x305a84}},'select':{'amount':!![]}});_0x411e0e=_0x2ba25a[_0x4a6a6b(0x11c)]((_0x4b3dad,_0x3eda3f)=>_0x4b3dad+_0x3eda3f['amount'],0x0);}const _0x4d4707=_0x176c1d[_0x4a6a6b(0x180)],_0x2adce5=_0x176c1d['length'],_0x3fcf09=_0x4d4707>0x0?_0x214898/_0x4d4707:0x0,_0xac085d=0x64,_0x6b0f35=Math['ceil']((_0x305a84[_0x4a6a6b(0x118)]()-_0x504abb['getTime']())/(0x3e8*0x3c*0x3c*0x18)),_0x29938c={'totalTurnover':Math[_0x4a6a6b(0x100)](_0x214898*0x64)/0x64,'merchantEarnings':Math[_0x4a6a6b(0x100)](_0x52cef7*0x64)/0x64,'gatewayEarnings':Math[_0x4a6a6b(0x100)](_0xdd3d22*0x64)/0x64,'totalPaidOut':Math[_0x4a6a6b(0x100)](_0x411e0e*0x64)/0x64,'averageCheck':Math[_0x4a6a6b(0x100)](_0x3fcf09*0x64)/0x64,'totalPayments':_0x4d4707,'successfulPayments':_0x2adce5,'conversionRate':_0xac085d,'gatewayBreakdown':Object['values'](_0x4f29fd)['map'](_0x4779d7=>({..._0x4779d7,'turnoverUSDT':Math['round'](_0x4779d7[_0x4a6a6b(0xfe)]*0x64)/0x64,'commissionUSDT':Math[_0x4a6a6b(0x100)](_0x4779d7[_0x4a6a6b(0x12d)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x4779d7[_0x4a6a6b(0xd4)]*0x64)/0x64,'averageCommissionRate':Math[_0x4a6a6b(0x100)](_0x4779d7[_0x4a6a6b(0x150)]*0x64)/0x64})),'merchantBreakdown':_0x597cea[_0x4a6a6b(0xef)]?undefined:Object[_0x4a6a6b(0x17c)](_0x4fe880)[_0x4a6a6b(0x13e)](_0x5ebc80=>({..._0x5ebc80,'turnoverUSDT':Math[_0x4a6a6b(0x100)](_0x5ebc80[_0x4a6a6b(0xfe)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x5ebc80['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x5ebc80['merchantEarningsUSDT']*0x64)/0x64,'paidOutUSDT':Math['round'](_0x5ebc80[_0x4a6a6b(0x12f)]*0x64)/0x64,'averageCheckUSDT':Math[_0x4a6a6b(0x100)](_0x5ebc80[_0x4a6a6b(0x12a)]*0x64)/0x64})),'dailyData':Object[_0x4a6a6b(0x17c)](_0x2f2996)[_0x4a6a6b(0x13e)](_0x2b2a5b=>({..._0x2b2a5b,'turnover':Math[_0x4a6a6b(0x100)](_0x2b2a5b[_0x4a6a6b(0x102)]*0x64)/0x64,'merchantEarnings':Math[_0x4a6a6b(0x100)](_0x2b2a5b['merchantEarnings']*0x64)/0x64,'gatewayEarnings':Math[_0x4a6a6b(0x100)](_0x2b2a5b['gatewayEarnings']*0x64)/0x64}))[_0x4a6a6b(0xec)]((_0x2bab60,_0x547c63)=>_0x2bab60[_0x4a6a6b(0xf5)][_0x4a6a6b(0xbe)](_0x547c63['date'])),'periodInfo':{'from':_0x504abb,'to':_0x305a84,'periodType':_0x597cea[_0x4a6a6b(0x120)]||_0x4a6a6b(0x164),'daysCount':_0x6b0f35}};return console['log'](_0x4a6a6b(0xe5)),console['log'](_0x4a6a6b(0xe7)+_0x29938c[_0x4a6a6b(0x170)]+_0x4a6a6b(0x133)),console['log']('\x20\x20\x20👤\x20Merchant\x20earnings:\x20'+_0x29938c[_0x4a6a6b(0x14c)]+'\x20USDT'),console[_0x4a6a6b(0xe0)](_0x4a6a6b(0x15d)+_0x29938c[_0x4a6a6b(0xfb)]+_0x4a6a6b(0x133)),console[_0x4a6a6b(0xe0)]('\x20\x20\x20📊\x20Total\x20payments:\x20'+_0x29938c[_0x4a6a6b(0x12b)]),_0x29938c;}[a35_0x5a9071(0xf9)](_0x201acf){const _0x18246f=a35_0x5a9071,_0x2129a0={'test_gateway':_0x18246f(0xfc),'plisio':_0x18246f(0x16d),'rapyd':_0x18246f(0xc9),'noda':_0x18246f(0xed),'cointopay':'CoinToPay','klyme_eu':'KLYME\x20EU','klyme_gb':_0x18246f(0xf7),'klyme_de':_0x18246f(0xc1)};return _0x2129a0[_0x201acf]||_0x201acf;}async[a35_0x5a9071(0xe9)](_0xa45d34){const _0x31220c=a35_0x5a9071,{page:_0x42c251,limit:_0x519911,minAmount:_0x16d1b0,search:_0x6fbcea}=_0xa45d34,_0xfd3316=(_0x42c251-0x1)*_0x519911;console[_0x31220c(0xe0)](_0x31220c(0xc0),_0xa45d34);const _0x67638b=await database_1[_0x31220c(0x11f)][_0x31220c(0x121)][_0x31220c(0x166)]({'where':{'status':_0x31220c(0x17d),'merchantPaid':![],'paidAt':{'not':null}},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'gatewaySettings':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}});console[_0x31220c(0xe0)](_0x31220c(0x148)+_0x67638b[_0x31220c(0x180)]+_0x31220c(0x128));const _0x36ed65={};for(const _0x48b61f of _0x67638b){const _0x3d9d90=_0x48b61f['shopId'];!_0x36ed65[_0x3d9d90]&&(_0x36ed65[_0x3d9d90]={'id':_0x48b61f[_0x31220c(0xf4)]['id'],'fullName':_0x48b61f[_0x31220c(0xf4)][_0x31220c(0x16f)],'username':_0x48b61f[_0x31220c(0xf4)][_0x31220c(0x15f)],'telegramId':_0x48b61f['shop'][_0x31220c(0xbc)],'merchantUrl':_0x48b61f[_0x31220c(0xf4)][_0x31220c(0x141)],'wallets':{'usdtPolygonWallet':_0x48b61f['shop'][_0x31220c(0x12e)],'usdtTrcWallet':_0x48b61f[_0x31220c(0xf4)][_0x31220c(0xf6)],'usdtErcWallet':_0x48b61f[_0x31220c(0xf4)][_0x31220c(0x116)],'usdcPolygonWallet':_0x48b61f[_0x31220c(0xf4)][_0x31220c(0x172)]},'totalAmountUSDT':0x0,'totalAmountAfterCommissionUSDT':0x0,'paymentsCount':0x0,'oldestPaymentDate':_0x48b61f['paidAt'],'gatewayBreakdown':{},'gatewaySettings':_0x48b61f[_0x31220c(0xf4)][_0x31220c(0xdd)]});try{const _0x10ffc0=await currencyService_1[_0x31220c(0xcc)][_0x31220c(0x146)](_0x48b61f['amount'],_0x48b61f[_0x31220c(0xc5)]);let _0xff9e67={};if(_0x48b61f[_0x31220c(0xf4)][_0x31220c(0xdd)])try{_0xff9e67=JSON[_0x31220c(0x177)](_0x48b61f[_0x31220c(0xf4)][_0x31220c(0xdd)]);}catch(_0x28d3f8){console['error'](_0x31220c(0x111)+_0x3d9d90+':',_0x28d3f8);}const _0x3eb6d2=_0xff9e67[_0x31220c(0xee)]||0xa,_0x2900f2=_0x10ffc0*(0x1-_0x3eb6d2/0x64);_0x36ed65[_0x3d9d90][_0x31220c(0xf1)]+=_0x10ffc0,_0x36ed65[_0x3d9d90][_0x31220c(0x153)]+=_0x2900f2,_0x36ed65[_0x3d9d90][_0x31220c(0xe3)]++,_0x48b61f[_0x31220c(0x181)]<_0x36ed65[_0x3d9d90][_0x31220c(0xc8)]&&(_0x36ed65[_0x3d9d90][_0x31220c(0xc8)]=_0x48b61f[_0x31220c(0x181)]),!_0x36ed65[_0x3d9d90]['gatewayBreakdown'][_0x48b61f['gateway']]&&(_0x36ed65[_0x3d9d90][_0x31220c(0xce)][_0x48b61f['gateway']]={'gateway':_0x48b61f[_0x31220c(0x152)],'count':0x0,'amountUSDT':0x0,'amountAfterCommissionUSDT':0x0,'commission':_0x3eb6d2}),_0x36ed65[_0x3d9d90][_0x31220c(0xce)][_0x48b61f[_0x31220c(0x152)]][_0x31220c(0x187)]++,_0x36ed65[_0x3d9d90]['gatewayBreakdown'][_0x48b61f[_0x31220c(0x152)]][_0x31220c(0x161)]+=_0x10ffc0,_0x36ed65[_0x3d9d90][_0x31220c(0xce)][_0x48b61f[_0x31220c(0x152)]][_0x31220c(0x106)]+=_0x2900f2;}catch(_0x4ba931){console[_0x31220c(0xfa)]('Error\x20processing\x20payment\x20'+_0x48b61f['id']+':',_0x4ba931);}}let _0x5ca17e=Object[_0x31220c(0x17c)](_0x36ed65)[_0x31220c(0x13e)](_0x1d602a=>({..._0x1d602a,'totalAmountUSDT':Math[_0x31220c(0x100)](_0x1d602a[_0x31220c(0xf1)]*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x1d602a['totalAmountAfterCommissionUSDT']*0x64)/0x64,'gatewayBreakdown':Object[_0x31220c(0x17c)](_0x1d602a[_0x31220c(0xce)])[_0x31220c(0x13e)](_0x51fbd0=>({..._0x51fbd0,'amountUSDT':Math[_0x31220c(0x100)](_0x51fbd0[_0x31220c(0x161)]*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x31220c(0x100)](_0x51fbd0['amountAfterCommissionUSDT']*0x64)/0x64}))}));_0x16d1b0&&(_0x5ca17e=_0x5ca17e[_0x31220c(0x13a)](_0x28ffc1=>_0x28ffc1[_0x31220c(0x153)]>=_0x16d1b0));if(_0x6fbcea){const _0x25e911=_0x6fbcea['toLowerCase']();_0x5ca17e=_0x5ca17e[_0x31220c(0x13a)](_0x1749de=>_0x1749de[_0x31220c(0x135)]['toLowerCase']()['includes'](_0x25e911)||_0x1749de['username'][_0x31220c(0x160)]()[_0x31220c(0x114)](_0x25e911));}_0x5ca17e[_0x31220c(0xec)]((_0x21aa97,_0x10546e)=>_0x10546e[_0x31220c(0x153)]-_0x21aa97['totalAmountAfterCommissionUSDT']);const _0x35fc9f=_0x5ca17e['length'],_0x34d480=_0x5ca17e[_0x31220c(0x186)](_0xfd3316,_0xfd3316+_0x519911),_0x476fc0=_0x5ca17e[_0x31220c(0x11c)]((_0x3a143f,_0xdc0983)=>_0x3a143f+_0xdc0983[_0x31220c(0xf1)],0x0),_0x1f77cd=_0x5ca17e[_0x31220c(0x11c)]((_0x14092e,_0x2b4e72)=>_0x14092e+_0x2b4e72['totalAmountAfterCommissionUSDT'],0x0);return console[_0x31220c(0xe0)](_0x31220c(0xdf)+_0x35fc9f+'\x20merchants,\x20'+Math[_0x31220c(0x100)](_0x1f77cd*0x64)/0x64+_0x31220c(0x10a)),{'merchants':_0x34d480,'pagination':{'page':_0x42c251,'limit':_0x519911,'total':_0x35fc9f,'totalPages':Math[_0x31220c(0x129)](_0x35fc9f/_0x519911)},'summary':{'totalMerchants':_0x35fc9f,'totalAmountUSDT':Math['round'](_0x476fc0*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x1f77cd*0x64)/0x64}};}async[a35_0x5a9071(0x175)](_0x40671f){const _0x2a9ee1=a35_0x5a9071,{shopId:_0xa8b03a,amount:_0x4c6397,network:_0xad5245,notes:_0x3189fa,periodFrom:_0x1e58af,periodTo:_0x1a449a}=_0x40671f,_0x219aa7=await database_1[_0x2a9ee1(0x11f)]['shop']['findUnique']({'where':{'id':_0xa8b03a},'select':{'id':!![],'name':!![],'username':!![]}});if(!_0x219aa7)throw new Error('Shop\x20not\x20found');const _0x3fb98d=await database_1['default'][_0x2a9ee1(0xf2)]['create']({'data':{'shopId':_0xa8b03a,'amount':_0x4c6397,'network':_0xad5245,'status':_0x2a9ee1(0x158),'notes':_0x3189fa,'periodFrom':_0x1e58af?new Date(_0x1e58af):null,'periodTo':_0x1a449a?new Date(_0x1a449a):null,'createdAt':new Date(),'paidAt':new Date()}});return console['log']('✅\x20Payout\x20created:\x20'+_0x3fb98d['id']+'\x20for\x20shop\x20'+_0x219aa7['username']+'\x20('+_0x4c6397+'\x20USDT)'),{'id':_0x3fb98d['id'],'shopId':_0x3fb98d[_0x2a9ee1(0xef)],'shopName':_0x219aa7[_0x2a9ee1(0x16f)],'shopUsername':_0x219aa7[_0x2a9ee1(0x15f)],'amount':_0x3fb98d[_0x2a9ee1(0xf0)],'network':_0x3fb98d[_0x2a9ee1(0xc6)],'status':_0x3fb98d[_0x2a9ee1(0x15e)],'txid':_0x3fb98d[_0x2a9ee1(0x107)],'notes':_0x3fb98d[_0x2a9ee1(0x17f)],'periodFrom':_0x3fb98d[_0x2a9ee1(0x13f)],'periodTo':_0x3fb98d[_0x2a9ee1(0x16e)],'createdAt':_0x3fb98d[_0x2a9ee1(0x183)],'paidAt':_0x3fb98d['paidAt']};}async['getAllPayouts'](_0x136452){const _0x2784cb=a35_0x5a9071,{page:_0x336447,limit:_0x291a28,shopId:_0x440b96,network:_0x2507bb,dateFrom:_0xf8f2d7,dateTo:_0x581600,search:_0x57fe3b}=_0x136452,_0x184ca4=(_0x336447-0x1)*_0x291a28,_0x3ba7d5={};_0x440b96&&(_0x3ba7d5[_0x2784cb(0xef)]=_0x440b96);_0x2507bb&&(_0x3ba7d5[_0x2784cb(0xc6)]=_0x2507bb);(_0xf8f2d7||_0x581600)&&(_0x3ba7d5[_0x2784cb(0x183)]={},_0xf8f2d7&&(_0x3ba7d5[_0x2784cb(0x183)][_0x2784cb(0x14a)]=new Date(_0xf8f2d7)),_0x581600&&(_0x3ba7d5[_0x2784cb(0x183)][_0x2784cb(0x155)]=new Date(_0x581600)));_0x57fe3b&&(_0x3ba7d5['OR']=[{'shop':{'name':{'contains':_0x57fe3b,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x57fe3b,'mode':_0x2784cb(0xd9)}}},{'notes':{'contains':_0x57fe3b,'mode':_0x2784cb(0xd9)}}]);const [_0x4e67e2,_0xc8015e]=await Promise[_0x2784cb(0x110)]([database_1['default'][_0x2784cb(0xf2)][_0x2784cb(0x166)]({'where':_0x3ba7d5,'skip':_0x184ca4,'take':_0x291a28,'orderBy':{'createdAt':_0x2784cb(0x184)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x2784cb(0x11f)][_0x2784cb(0xf2)][_0x2784cb(0x187)]({'where':_0x3ba7d5})]);return{'payouts':_0x4e67e2[_0x2784cb(0x13e)](_0x515a97=>({'id':_0x515a97['id'],'shopId':_0x515a97[_0x2784cb(0xef)],'shopName':_0x515a97[_0x2784cb(0xf4)][_0x2784cb(0x16f)],'shopUsername':_0x515a97[_0x2784cb(0xf4)][_0x2784cb(0x15f)],'amount':_0x515a97[_0x2784cb(0xf0)],'network':_0x515a97[_0x2784cb(0xc6)],'status':_0x515a97['status'],'txid':_0x515a97[_0x2784cb(0x107)],'notes':_0x515a97[_0x2784cb(0x17f)],'periodFrom':_0x515a97[_0x2784cb(0x13f)],'periodTo':_0x515a97['periodTo'],'createdAt':_0x515a97[_0x2784cb(0x183)],'paidAt':_0x515a97['paidAt']})),'pagination':{'page':_0x336447,'limit':_0x291a28,'total':_0xc8015e,'totalPages':Math['ceil'](_0xc8015e/_0x291a28)}};}async[a35_0x5a9071(0x14d)](_0x219ba1){const _0x51e52a=a35_0x5a9071,_0x22e6f4=await database_1['default']['payout'][_0x51e52a(0xea)]({'where':{'id':_0x219ba1},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x22e6f4)return null;return{'id':_0x22e6f4['id'],'shopId':_0x22e6f4[_0x51e52a(0xef)],'shopName':_0x22e6f4[_0x51e52a(0xf4)][_0x51e52a(0x16f)],'shopUsername':_0x22e6f4[_0x51e52a(0xf4)]['username'],'amount':_0x22e6f4[_0x51e52a(0xf0)],'network':_0x22e6f4[_0x51e52a(0xc6)],'status':_0x22e6f4[_0x51e52a(0x15e)],'txid':_0x22e6f4[_0x51e52a(0x107)],'notes':_0x22e6f4[_0x51e52a(0x17f)],'periodFrom':_0x22e6f4[_0x51e52a(0x13f)],'periodTo':_0x22e6f4[_0x51e52a(0x16e)],'createdAt':_0x22e6f4['createdAt'],'paidAt':_0x22e6f4[_0x51e52a(0x181)]};}async[a35_0x5a9071(0xe1)](_0x39199a){const _0x1ab0ce=a35_0x5a9071;await database_1[_0x1ab0ce(0x11f)][_0x1ab0ce(0xf2)]['delete']({'where':{'id':_0x39199a}});}async[a35_0x5a9071(0xd2)](_0x50558a){const _0x189dfa=a35_0x5a9071,{page:_0xf77c78,limit:_0x57875e,status:_0x4332d7,gateway:_0x4d7622,shopId:_0x4dd87a,dateFrom:_0x2d8ab0,dateTo:_0x2be0b0,search:_0x19749b}=_0x50558a,_0x3c5b1e=(_0xf77c78-0x1)*_0x57875e,_0x4f6313={};_0x4332d7&&(_0x4f6313[_0x189dfa(0x15e)]=_0x4332d7['toUpperCase']());_0x4d7622&&(_0x4f6313['gateway']=_0x4d7622['toLowerCase']());_0x4f6313[_0x189dfa(0x152)]=_0x4f6313[_0x189dfa(0x152)]?_0x4f6313[_0x189dfa(0x152)]:{'not':_0x189dfa(0xcd)};if(typeof _0x4f6313[_0x189dfa(0x152)]===_0x189dfa(0xc3)&&_0x4f6313[_0x189dfa(0x152)]!==_0x189dfa(0xcd)){}else{if(typeof _0x4f6313[_0x189dfa(0x152)]===_0x189dfa(0xc3)&&_0x4f6313[_0x189dfa(0x152)]===_0x189dfa(0xcd)){}else _0x4f6313[_0x189dfa(0x152)]={'not':_0x189dfa(0xcd)};}_0x4dd87a&&(_0x4f6313[_0x189dfa(0xef)]=_0x4dd87a);(_0x2d8ab0||_0x2be0b0)&&(_0x4f6313[_0x189dfa(0x183)]={},_0x2d8ab0&&(_0x4f6313[_0x189dfa(0x183)][_0x189dfa(0x14a)]=new Date(_0x2d8ab0)),_0x2be0b0&&(_0x4f6313[_0x189dfa(0x183)][_0x189dfa(0x155)]=new Date(_0x2be0b0)));_0x19749b&&(_0x4f6313['OR']=[{'orderId':{'contains':_0x19749b,'mode':'insensitive'}},{'gatewayOrderId':{'contains':_0x19749b,'mode':_0x189dfa(0xd9)}},{'customerEmail':{'contains':_0x19749b,'mode':_0x189dfa(0xd9)}},{'shop':{'name':{'contains':_0x19749b,'mode':_0x189dfa(0xd9)}}},{'shop':{'username':{'contains':_0x19749b,'mode':_0x189dfa(0xd9)}}}]);const [_0x30d10a,_0x4216c7]=await Promise[_0x189dfa(0x110)]([database_1[_0x189dfa(0x11f)][_0x189dfa(0x121)][_0x189dfa(0x166)]({'where':_0x4f6313,'skip':_0x3c5b1e,'take':_0x57875e,'orderBy':{'createdAt':_0x189dfa(0x184)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default']['payment'][_0x189dfa(0x187)]({'where':_0x4f6313})]);return{'payments':_0x30d10a['map'](_0x3a7730=>({'id':_0x3a7730['id'],'shopId':_0x3a7730['shopId'],'gateway':_0x3a7730['gateway'],'amount':_0x3a7730[_0x189dfa(0xf0)],'currency':_0x3a7730[_0x189dfa(0xc5)],'status':_0x3a7730['status'],'orderId':_0x3a7730[_0x189dfa(0x173)],'gatewayOrderId':_0x3a7730[_0x189dfa(0x151)],'customerEmail':_0x3a7730[_0x189dfa(0xe2)],'customerName':_0x3a7730[_0x189dfa(0x132)],'customerCountry':_0x3a7730[_0x189dfa(0x10d)],'customerIp':_0x3a7730[_0x189dfa(0x15b)],'customerUa':_0x3a7730[_0x189dfa(0x185)],'failureMessage':_0x3a7730[_0x189dfa(0x122)],'createdAt':_0x3a7730['createdAt'],'updatedAt':_0x3a7730['updatedAt'],'shop':_0x3a7730[_0x189dfa(0xf4)]})),'pagination':{'page':_0xf77c78,'limit':_0x57875e,'total':_0x4216c7,'totalPages':Math[_0x189dfa(0x129)](_0x4216c7/_0x57875e)}};}async[a35_0x5a9071(0x16b)](_0x2ed6f2){const _0x4fb8c0=a35_0x5a9071,_0xe009e7=await database_1[_0x4fb8c0(0x11f)][_0x4fb8c0(0x121)][_0x4fb8c0(0xea)]({'where':{'id':_0x2ed6f2},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0xe009e7)return null;return{'id':_0xe009e7['id'],'shopId':_0xe009e7['shopId'],'gateway':_0xe009e7['gateway'],'amount':_0xe009e7['amount'],'currency':_0xe009e7[_0x4fb8c0(0xc5)],'status':_0xe009e7[_0x4fb8c0(0x15e)],'orderId':_0xe009e7[_0x4fb8c0(0x173)],'gatewayOrderId':_0xe009e7[_0x4fb8c0(0x151)],'customerEmail':_0xe009e7['customerEmail'],'customerName':_0xe009e7[_0x4fb8c0(0x132)],'customerCountry':_0xe009e7['customerCountry'],'customerIp':_0xe009e7[_0x4fb8c0(0x15b)],'customerUa':_0xe009e7[_0x4fb8c0(0x185)],'failureMessage':_0xe009e7[_0x4fb8c0(0x122)],'externalPaymentUrl':_0xe009e7[_0x4fb8c0(0x143)],'successUrl':_0xe009e7[_0x4fb8c0(0x15c)],'failUrl':_0xe009e7[_0x4fb8c0(0x162)],'pendingUrl':_0xe009e7[_0x4fb8c0(0x176)],'whiteUrl':_0xe009e7[_0x4fb8c0(0x14f)],'createdAt':_0xe009e7[_0x4fb8c0(0x183)],'updatedAt':_0xe009e7['updatedAt'],'shop':_0xe009e7[_0x4fb8c0(0xf4)]};}async['updatePaymentStatus'](_0x52fb24,_0x4fb704,_0x1ffec3,_0x42b437){const _0x158d76=a35_0x5a9071,_0x535fdf={'status':_0x4fb704[_0x158d76(0x125)](),'updatedAt':new Date(),'statusChangedBy':_0x158d76(0x11d),'statusChangedAt':new Date()};_0x1ffec3&&(_0x535fdf[_0x158d76(0x137)]=_0x1ffec3);_0x4fb704[_0x158d76(0x125)]()===_0x158d76(0x105)&&_0x42b437&&(_0x535fdf['chargebackAmount']=_0x42b437);_0x4fb704[_0x158d76(0x125)]()==='PAID'&&(_0x535fdf['paidAt']=new Date());const _0x3a013d=await database_1[_0x158d76(0x11f)]['payment'][_0x158d76(0xeb)]({'where':{'id':_0x52fb24},'data':_0x535fdf,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return{'id':_0x3a013d['id'],'shopId':_0x3a013d[_0x158d76(0xef)],'gateway':_0x3a013d[_0x158d76(0x152)],'amount':_0x3a013d[_0x158d76(0xf0)],'currency':_0x3a013d['currency'],'status':_0x3a013d[_0x158d76(0x15e)],'orderId':_0x3a013d['orderId'],'gatewayOrderId':_0x3a013d['gatewayOrderId'],'customerEmail':_0x3a013d[_0x158d76(0xe2)],'customerName':_0x3a013d['customerName'],'customerCountry':_0x3a013d[_0x158d76(0x10d)],'customerIp':_0x3a013d['customerIp'],'customerUa':_0x3a013d[_0x158d76(0x185)],'failureMessage':_0x3a013d[_0x158d76(0x122)],'adminNotes':_0x3a013d[_0x158d76(0x137)],'chargebackAmount':_0x3a013d[_0x158d76(0x14e)],'statusChangedBy':_0x3a013d[_0x158d76(0xf3)],'statusChangedAt':_0x3a013d[_0x158d76(0x178)],'createdAt':_0x3a013d[_0x158d76(0x183)],'updatedAt':_0x3a013d['updatedAt'],'shop':_0x3a013d['shop']};}async[a35_0x5a9071(0xdb)](_0x50d52a,_0x127c7f){const _0x26aa3d=a35_0x5a9071,_0x1a6326={..._0x127c7f};_0x127c7f['password']&&(_0x1a6326[_0x26aa3d(0xd6)]=await bcryptjs_1[_0x26aa3d(0x11f)][_0x26aa3d(0xe8)](_0x127c7f[_0x26aa3d(0xd6)],0xc));_0x127c7f['fullName']&&(_0x1a6326[_0x26aa3d(0x16f)]=_0x127c7f[_0x26aa3d(0x135)],delete _0x1a6326['fullName']);_0x127c7f[_0x26aa3d(0x14b)]&&(_0x1a6326[_0x26aa3d(0xbc)]=_0x127c7f[_0x26aa3d(0x14b)],delete _0x1a6326[_0x26aa3d(0x14b)]);_0x127c7f[_0x26aa3d(0xde)]&&(_0x1a6326[_0x26aa3d(0x141)]=_0x127c7f[_0x26aa3d(0xde)],delete _0x1a6326[_0x26aa3d(0xde)]);_0x127c7f[_0x26aa3d(0x171)]&&(_0x1a6326[_0x26aa3d(0x12c)]=JSON['stringify'](_0x127c7f[_0x26aa3d(0x171)]),delete _0x1a6326[_0x26aa3d(0x171)]);_0x127c7f[_0x26aa3d(0xdd)]&&(_0x1a6326[_0x26aa3d(0xdd)]=JSON[_0x26aa3d(0xd3)](_0x127c7f['gatewaySettings']),delete _0x1a6326[_0x26aa3d(0xdd)]);_0x127c7f[_0x26aa3d(0x10b)]&&(_0x127c7f[_0x26aa3d(0x10b)][_0x26aa3d(0x12e)]!==undefined&&(_0x1a6326[_0x26aa3d(0x12e)]=_0x127c7f['wallets'][_0x26aa3d(0x12e)]||null),_0x127c7f[_0x26aa3d(0x10b)][_0x26aa3d(0xf6)]!==undefined&&(_0x1a6326[_0x26aa3d(0xf6)]=_0x127c7f[_0x26aa3d(0x10b)][_0x26aa3d(0xf6)]||null),_0x127c7f[_0x26aa3d(0x10b)][_0x26aa3d(0x116)]!==undefined&&(_0x1a6326[_0x26aa3d(0x116)]=_0x127c7f['wallets'][_0x26aa3d(0x116)]||null),_0x127c7f[_0x26aa3d(0x10b)]['usdcPolygonWallet']!==undefined&&(_0x1a6326['usdcPolygonWallet']=_0x127c7f[_0x26aa3d(0x10b)]['usdcPolygonWallet']||null),delete _0x1a6326[_0x26aa3d(0x10b)]);const _0x2fc1c6=await database_1['default'][_0x26aa3d(0xf4)][_0x26aa3d(0xeb)]({'where':{'id':_0x50d52a},'data':_0x1a6326,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2fc1c6['id'],'fullName':_0x2fc1c6['name'],'username':_0x2fc1c6[_0x26aa3d(0x15f)],'telegramId':_0x2fc1c6['telegram'],'merchantUrl':_0x2fc1c6[_0x26aa3d(0x141)],'gateways':_0x2fc1c6['paymentGateways']?JSON[_0x26aa3d(0x177)](_0x2fc1c6[_0x26aa3d(0x12c)]):null,'gatewaySettings':_0x2fc1c6['gatewaySettings']?JSON['parse'](_0x2fc1c6[_0x26aa3d(0xdd)]):null,'publicKey':_0x2fc1c6[_0x26aa3d(0x159)],'wallets':{'usdtPolygonWallet':_0x2fc1c6[_0x26aa3d(0x12e)],'usdtTrcWallet':_0x2fc1c6[_0x26aa3d(0xf6)],'usdtErcWallet':_0x2fc1c6['usdtErcWallet'],'usdcPolygonWallet':_0x2fc1c6[_0x26aa3d(0x172)]},'status':_0x2fc1c6[_0x26aa3d(0x15e)],'createdAt':_0x2fc1c6[_0x26aa3d(0x183)]};}async[a35_0x5a9071(0x16a)](_0x4e78c0){const _0x3d1d7b=a35_0x5a9071,_0x14c298=await database_1[_0x3d1d7b(0x11f)][_0x3d1d7b(0xf4)][_0x3d1d7b(0xeb)]({'where':{'id':_0x4e78c0},'data':{'status':'SUSPENDED'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x14c298['id'],'fullName':_0x14c298[_0x3d1d7b(0x16f)],'username':_0x14c298[_0x3d1d7b(0x15f)],'telegramId':_0x14c298[_0x3d1d7b(0xbc)],'merchantUrl':_0x14c298[_0x3d1d7b(0x141)],'gateways':_0x14c298[_0x3d1d7b(0x12c)]?JSON[_0x3d1d7b(0x177)](_0x14c298[_0x3d1d7b(0x12c)]):null,'gatewaySettings':_0x14c298[_0x3d1d7b(0xdd)]?JSON[_0x3d1d7b(0x177)](_0x14c298[_0x3d1d7b(0xdd)]):null,'publicKey':_0x14c298[_0x3d1d7b(0x159)],'wallets':{'usdtPolygonWallet':_0x14c298[_0x3d1d7b(0x12e)],'usdtTrcWallet':_0x14c298[_0x3d1d7b(0xf6)],'usdtErcWallet':_0x14c298['usdtErcWallet'],'usdcPolygonWallet':_0x14c298[_0x3d1d7b(0x172)]},'status':_0x14c298['status'],'createdAt':_0x14c298[_0x3d1d7b(0x183)]};}async['activateUser'](_0x2913ed){const _0x22f78e=a35_0x5a9071,_0x417bbf=await database_1['default'][_0x22f78e(0xf4)][_0x22f78e(0xeb)]({'where':{'id':_0x2913ed},'data':{'status':_0x22f78e(0x134)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x417bbf['id'],'fullName':_0x417bbf['name'],'username':_0x417bbf[_0x22f78e(0x15f)],'telegramId':_0x417bbf[_0x22f78e(0xbc)],'merchantUrl':_0x417bbf[_0x22f78e(0x141)],'gateways':_0x417bbf[_0x22f78e(0x12c)]?JSON[_0x22f78e(0x177)](_0x417bbf[_0x22f78e(0x12c)]):null,'gatewaySettings':_0x417bbf[_0x22f78e(0xdd)]?JSON[_0x22f78e(0x177)](_0x417bbf[_0x22f78e(0xdd)]):null,'publicKey':_0x417bbf['publicKey'],'wallets':{'usdtPolygonWallet':_0x417bbf['usdtPolygonWallet'],'usdtTrcWallet':_0x417bbf[_0x22f78e(0xf6)],'usdtErcWallet':_0x417bbf[_0x22f78e(0x116)],'usdcPolygonWallet':_0x417bbf[_0x22f78e(0x172)]},'status':_0x417bbf[_0x22f78e(0x15e)],'createdAt':_0x417bbf[_0x22f78e(0x183)]};}async['getAllUsers'](_0x290407){const _0xa98d09=a35_0x5a9071,{page:_0x1d85b7,limit:_0x5dcf38,status:_0x3b3e71}=_0x290407,_0x518843=(_0x1d85b7-0x1)*_0x5dcf38,_0x25dcb7={};_0x3b3e71&&(_0x25dcb7[_0xa98d09(0x15e)]=_0x3b3e71[_0xa98d09(0x125)]());const [_0x3a7e69,_0x130498]=await Promise[_0xa98d09(0x110)]([database_1['default'][_0xa98d09(0xf4)][_0xa98d09(0x166)]({'where':_0x25dcb7,'skip':_0x518843,'take':_0x5dcf38,'orderBy':{'createdAt':_0xa98d09(0x184)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1['default'][_0xa98d09(0xf4)][_0xa98d09(0x187)]({'where':_0x25dcb7})]);return{'users':_0x3a7e69[_0xa98d09(0x13e)](_0x4be917=>({'id':_0x4be917['id'],'fullName':_0x4be917[_0xa98d09(0x16f)],'username':_0x4be917[_0xa98d09(0x15f)],'telegramId':_0x4be917[_0xa98d09(0xbc)],'merchantUrl':_0x4be917[_0xa98d09(0x141)],'gateways':_0x4be917[_0xa98d09(0x12c)]?JSON[_0xa98d09(0x177)](_0x4be917[_0xa98d09(0x12c)]):null,'gatewaySettings':_0x4be917['gatewaySettings']?JSON[_0xa98d09(0x177)](_0x4be917['gatewaySettings']):null,'publicKey':_0x4be917[_0xa98d09(0x159)],'wallets':{'usdtPolygonWallet':_0x4be917[_0xa98d09(0x12e)],'usdtTrcWallet':_0x4be917[_0xa98d09(0xf6)],'usdtErcWallet':_0x4be917['usdtErcWallet'],'usdcPolygonWallet':_0x4be917['usdcPolygonWallet']},'status':_0x4be917['status'],'createdAt':_0x4be917[_0xa98d09(0x183)]})),'pagination':{'page':_0x1d85b7,'limit':_0x5dcf38,'total':_0x130498,'totalPages':Math[_0xa98d09(0x129)](_0x130498/_0x5dcf38)}};}async[a35_0x5a9071(0xd8)](_0x5663db){const _0x42e9de=a35_0x5a9071,_0x52a7b4=await database_1[_0x42e9de(0x11f)][_0x42e9de(0xf4)]['findUnique']({'where':{'id':_0x5663db},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x52a7b4)return null;return{'id':_0x52a7b4['id'],'fullName':_0x52a7b4[_0x42e9de(0x16f)],'username':_0x52a7b4[_0x42e9de(0x15f)],'telegramId':_0x52a7b4[_0x42e9de(0xbc)],'merchantUrl':_0x52a7b4[_0x42e9de(0x141)],'gateways':_0x52a7b4[_0x42e9de(0x12c)]?JSON[_0x42e9de(0x177)](_0x52a7b4[_0x42e9de(0x12c)]):null,'gatewaySettings':_0x52a7b4[_0x42e9de(0xdd)]?JSON['parse'](_0x52a7b4[_0x42e9de(0xdd)]):null,'publicKey':_0x52a7b4[_0x42e9de(0x159)],'wallets':{'usdtPolygonWallet':_0x52a7b4[_0x42e9de(0x12e)],'usdtTrcWallet':_0x52a7b4[_0x42e9de(0xf6)],'usdtErcWallet':_0x52a7b4[_0x42e9de(0x116)],'usdcPolygonWallet':_0x52a7b4[_0x42e9de(0x172)]},'status':_0x52a7b4['status'],'createdAt':_0x52a7b4[_0x42e9de(0x183)]};}async[a35_0x5a9071(0x104)](_0xaf4af3){const _0x1fbcc2=a35_0x5a9071,{fullName:_0x34d616,username:_0x1c541d,password:_0x586f8f,telegramId:_0x5f3fa9,merchantUrl:_0x5a04aa,gateways:_0x3ac088,gatewaySettings:_0x38acb7,wallets:_0x2b38d9}=_0xaf4af3,_0x48d0e1=await database_1['default'][_0x1fbcc2(0xf4)][_0x1fbcc2(0xea)]({'where':{'username':_0x1c541d}});if(_0x48d0e1)throw new Error(_0x1fbcc2(0x11a));if(_0x5f3fa9){const _0x5b2cb7=await database_1[_0x1fbcc2(0x11f)][_0x1fbcc2(0xf4)]['findUnique']({'where':{'telegram':_0x5f3fa9}});if(_0x5b2cb7)throw new Error(_0x1fbcc2(0xe4));}const _0x53abe7=await bcryptjs_1[_0x1fbcc2(0x11f)][_0x1fbcc2(0xe8)](_0x586f8f,0xc),_0x3c31af=_0x1fbcc2(0x154)+crypto_1[_0x1fbcc2(0x11f)]['randomBytes'](0x20)[_0x1fbcc2(0x174)](_0x1fbcc2(0xd7)),_0x5edf7b=_0x1fbcc2(0x147)+crypto_1[_0x1fbcc2(0x11f)][_0x1fbcc2(0x15a)](0x20)['toString'](_0x1fbcc2(0xd7)),_0x5c5b98=await database_1[_0x1fbcc2(0x11f)][_0x1fbcc2(0xf4)][_0x1fbcc2(0x123)]({'data':{'name':_0x34d616,'username':_0x1c541d,'password':_0x53abe7,'telegram':_0x5f3fa9,'shopUrl':_0x5a04aa,'paymentGateways':_0x3ac088?JSON[_0x1fbcc2(0xd3)](_0x3ac088):null,'gatewaySettings':_0x38acb7?JSON[_0x1fbcc2(0xd3)](_0x38acb7):null,'usdtPolygonWallet':_0x2b38d9?.[_0x1fbcc2(0x12e)]||null,'usdtTrcWallet':_0x2b38d9?.[_0x1fbcc2(0xf6)]||null,'usdtErcWallet':_0x2b38d9?.[_0x1fbcc2(0x116)]||null,'usdcPolygonWallet':_0x2b38d9?.[_0x1fbcc2(0x172)]||null,'publicKey':_0x3c31af,'secretKey':_0x5edf7b,'status':_0x1fbcc2(0x134)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x5c5b98['id'],'fullName':_0x5c5b98['name'],'username':_0x5c5b98[_0x1fbcc2(0x15f)],'telegramId':_0x5c5b98[_0x1fbcc2(0xbc)],'merchantUrl':_0x5c5b98[_0x1fbcc2(0x141)],'gateways':_0x5c5b98[_0x1fbcc2(0x12c)]?JSON[_0x1fbcc2(0x177)](_0x5c5b98[_0x1fbcc2(0x12c)]):null,'gatewaySettings':_0x5c5b98['gatewaySettings']?JSON[_0x1fbcc2(0x177)](_0x5c5b98[_0x1fbcc2(0xdd)]):null,'publicKey':_0x5c5b98['publicKey'],'wallets':{'usdtPolygonWallet':_0x5c5b98[_0x1fbcc2(0x12e)],'usdtTrcWallet':_0x5c5b98[_0x1fbcc2(0xf6)],'usdtErcWallet':_0x5c5b98[_0x1fbcc2(0x116)],'usdcPolygonWallet':_0x5c5b98['usdcPolygonWallet']},'status':_0x5c5b98['status'],'createdAt':_0x5c5b98[_0x1fbcc2(0x183)]};}async[a35_0x5a9071(0x13d)](_0x26e98d){const _0x70c688=a35_0x5a9071;await database_1[_0x70c688(0x11f)][_0x70c688(0xf4)][_0x70c688(0xbd)]({'where':{'id':_0x26e98d}});}}function a35_0x4c70(_0x3f93b3,_0x2ed688){const _0x5dfe35=a35_0x5dfe();return a35_0x4c70=function(_0x4c70b2,_0x143ccc){_0x4c70b2=_0x4c70b2-0xbc;let _0x40a08b=_0x5dfe35[_0x4c70b2];return _0x40a08b;},a35_0x4c70(_0x3f93b3,_0x2ed688);}exports[a35_0x5a9071(0xcf)]=AdminService;function a35_0x5dfe(){const _0x3ca01a=['📅\x20Period:\x20','shopUrl','📊\x20Calculating\x20payout\x20statistics...','externalPaymentUrl','merchantPaid','month','convertToUSDT','sk_','💰\x20Found\x20','✅\x20Payment\x20','gte','telegramId','merchantEarnings','getPayoutById','chargebackAmount','whiteUrl','averageCommissionRate','gatewayOrderId','gateway','totalAmountAfterCommissionUSDT','pk_','lte','\x20paid\x20payments','30d','COMPLETED','publicKey','randomBytes','customerIp','successUrl','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','status','username','toLowerCase','amountUSDT','failUrl','week','custom','crypto','findMany','795104NywvLF','forEach','2ZqkSBp','suspendUser','getPaymentById','\x20USDT\x20(pending\x20payout)','Plisio','periodTo','name','totalTurnover','gateways','usdcPolygonWallet','orderId','toString','createPayout','pendingUrl','parse','statusChangedAt','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','./currencyService','defineProperty','values','PAID','split','notes','length','paidAt','⏳\x20Payment\x20','createdAt','desc','customerUa','slice','count','telegram','delete','localeCompare','getFullYear','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','KLYME\x20DE','Payment\x20not\x20found','string','1088127YvLKpc','currency','network','3ajmthd','oldestPaymentDate','Rapyd','updateCustomerData','\x20USDT\x20(after\x20commission)','currencyService','test_gateway','gatewayBreakdown','AdminService','totalPayout','Error\x20processing\x20payment\x20','getAllPayments','stringify','merchantEarningsUSDT','📊\x20Payout\x20statistics\x20calculated:','password','hex','getUserById','insensitive','2020-01-01','updateUser','\x20USDT\x20(paid\x20out)','gatewaySettings','merchantUrl','📊\x20Merchants\x20awaiting\x20payout:\x20','log','deletePayout','customerEmail','paymentsCount','Telegram\x20username\x20already\x20exists','📊\x20Merchant\x20statistics\x20calculated:','276416RSOBsA','\x20\x20\x20💰\x20Total\x20turnover:\x20','hash','getMerchantsAwaitingPayout','findUnique','update','sort','Noda','commission','shopId','amount','totalAmountUSDT','payout','statusChangedBy','shop','date','usdtTrcWallet','KLYME\x20GB','totalCommissionRate','getGatewayDisplayName','error','gatewayEarnings','Test\x20Gateway','23289PMfpjB','turnoverUSDT','\x20\x20\x20🖥️\x20User\x20Agent:\x20','round','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','turnover','dateFrom','createUser','CHARGEBACK','amountAfterCommissionUSDT','txid','set','__esModule','\x20USDT\x20total','wallets','../config/database','customerCountry','toISOString','toFixed','all','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','\x20\x20\x20🌍\x20Country:\x20','getSystemStatistics','includes','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','usdtErcWallet','\x20->\x20','getTime','477595hQtjLT','Username\x20already\x20exists','dateTo','reduce','admin','624348xHnClO','default','period','payment','failureMessage','create','90d','toUpperCase','\x20to\x20','availableBalance','\x20payments\x20awaiting\x20payout','ceil','averageCheckUSDT','totalPayments','paymentGateways','commissionUSDT','usdtPolygonWallet','paidOutUSDT','not\x20set','awaitingPayout','customerName','\x20USDT','ACTIVE','fullName','\x20USDT\x20(paid\x20to\x20merchants)','adminNotes','\x20\x20\x20💵\x20Available\x20balance:\x20','193892DZJjOw','filter','getMonth','year','deleteUser','map','periodFrom'];a35_0x5dfe=function(){return _0x3ca01a;};return a35_0x5dfe();}