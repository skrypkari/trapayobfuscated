'use strict';const a46_0x42f014=a46_0x189e;function a46_0x4c6c(){const _0x4b3d23=['ðŸ”\x20[','\x20merchants\x20with\x20rounded\x20balance\x20!=\x200.00\x20(excluding\x20balances\x20that\x20round\x20to\x200.00)','lte','\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)','paidAt','groupBy','ðŸ“Š\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','trc20','turnover','username','4179720UtPoVg','orderId','\x20merchants','ðŸ”„\x20Gateway\x20mapping\x20(get):','test_gateway','notes','insensitive','shopUrl','dailyPayments','\x20USDT\x20(rounded\x20to\x202\x20decimal\x20places)','desc','usdcErcWallet','ðŸ“Š\x20Gateway\x20filter\x20applied:','getGatewayDisplayName','activateUser','ðŸ”§\x20[','currencyService','âš ï¸\x20Gateway\x20\x27','adminNotes','\x20\x20\x20ðŸ‘¤\x20Merchant\x20earnings:\x20','3742724RWugNl','gatewayCommissionRate','âš ï¸\x20CHARGEBACK\x20without\x20penalty\x20amount\x20-\x20no\x20balance\x20change','dailyRevenue','\x20USDT\x20(after\x20','\x20USDT\x20(same\x20as\x20awaiting)','Test\x20Gateway','all_time','polygon_usdc','min','customerUa','âœ…\x20Balance\x20check\x20passed\x20(with\x20tolerance)','ðŸ“Š\x20Sorting\x20payments\x20by\x20','\x20\x20\x20ðŸ’°\x20Total\x20payments\x20turnover:\x20','10EPRuED','\x20USDT\x20(total\x20paid\x20to\x20merchants)','whiteUrl','\x20USDT\x20(current\x20balance\x20in\x20DB)','balance','getMerchantsSelection','\x20\x20\x20Payout\x20amount:\x20','6076926HnQblZ','\x20\x20\x20ðŸª\x20Gateway\x20earnings:\x20','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','ðŸ“Š\x20Total\x20payments\x20(including\x20failed):\x20','toString','\x20\x20\x20ðŸ“…\x20Total\x20payouts\x20(this\x20month):\x20','ðŸ’°\x20[PAYOUT]\x20Merchant\x20','period','\x20PAID\x20payments','ðŸ“Š\x20Payout\x20statistics\x20calculated:','stringify','usdtErcWallet','ðŸ“Š\x20Calculated\x20commission\x20rate\x20for\x20payment\x20','getUTCMonth','ðŸ“‹\x20Found\x20','not\x20provided','\x20USDT\x20(gross\x20revenue)','ðŸ”„\x20Converted\x20gateway\x20name\x20\x27','customerCountry','toLocaleDateString','floor','MasterCard','ðŸŽ¯\x20[','\x20USDT,\x20Difference:\x20','ÐÐµ\x20ÑƒÐºÐ°Ð·Ð°Ð½','\x20in\x20','last_week','averageCheckUSDT','getFullYear','findMany','../types/gateway','ðŸ“Š\x20Final\x20WHERE\x20conditions:','updatedAt','push','ðŸ”„\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','reduce','currency',']\x20Updating\x20password\x20for\x20user\x20','getDate','âœ…\x20Using\x20gateway\x20filter:\x20\x27','getPaymentById','ðŸ“Š\x20Getting\x20merchant\x20statistics\x20with\x20filters:','3GWOogp','setDate','getMerchantStatistics','\x20status:\x20','klyme_gb','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)','getUTCFullYear','commissionUSDT','getTime','\x20\x20\x20Merchant\x20gets:\x20',',\x20chargebacks:\x20','failUrl','ðŸ”\x20Balance\x20check\x20details:','customerIp','__importDefault','\x20\x20\x20Current\x20balance:\x20','ðŸ’±\x20Currency\x20filter\x20applied:\x20','totalPayments','\x20\x20\x20Full\x20amount:\x20','count','network','convertToUSDT','parse','ðŸ”\x20Selected\x20polygon\x20wallet:\x20','ðŸ“Š\x20Merchant\x20statistics\x20calculated:','ðŸ“Š\x20Using\x20saved\x20values\x20for\x20payment\x20','totalTurnover','statusChangedBy','gte','averageCommissionRate','REFUND','suspendUser','\x20\x20\x20Total\x20paid\x20out:\x20','yesterday','\x20USDT\x20(+','dateFrom','turnoverUSDT','payment','\x20->\x20','ðŸ“…\x20Payout\x20date\x20from\x20filter:\x20','89028jHOJSK','ðŸ“Š\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','join','gatewayEarnings','UTC','bcryptjs','fullName','this_month','commission','setHours','telegramId','amount','createdAt','\x20\x20\x20ï¿½\x20Total\x20payments\x20turnover:\x20','26bkBzxQ','Payment\x20not\x20found','merchantEarningsUSDT','\x20payments)','ðŸ“…\x20Date\x20from\x20filter:\x20','sk_','pendingUrl','statusChangedAt','shop','wallets','amountUSDT','\x20merchants\x20for\x20selection','ðŸ’°\x20Found\x20','payout','setUTCDate','date','merchantUrl','periodTo','usdcPolygonWallet','\x20\x20\x20â³\x20Pending\x20payout:\x20','AdminService','\x20-\x20','error',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','âœ…\x20Payout\x20created\x20in\x20DB:','ðŸ”\x20Creating\x20payout\x20with\x20data:','ðŸ“Š\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','COMPLETED','ðŸŽ¯\x20updateUser\x20called\x20with\x20ID:\x20','custom_','CHARGEBACK','ðŸ”\x20Selected\x20erc20\x20wallet:\x20','Rapyd','entries','ðŸ”„\x20Converted\x20gateway\x20ID\x20\x27','ðŸ”„\x20Updating\x20customer\x20data\x20for\x20payment\x20','\x20\x20\x20ðŸ”\x20Calculated\x20after\x20commission:\x20','randomBytes','\x20\x20\x20ï¿½\x20Total\x20paid\x20out:\x20','2991675XirYws','KLYME\x20DE','\x20USDT\x20(-','\x20order','random','hex','ðŸ”\x20No\x20wallet\x20provided,\x20looking\x20up\x20from\x20shop\x20settings...','KLYME\x20EU','crypto','klyme_eu','\x20USDT\x20(already\x20paid\x20out)','\x20\x20\x20Gateway:\x20','./currencyService','txid','externalPaymentUrl','ðŸ“Š\x20Getting\x20payments\x20with\x20filters:','not\x20set','toISOString','pk_','generateDailyStatistics','publicKey','toLowerCase','ðŸ”„\x20Admin\x20updating\x20payment\x20','\x20\x20\x20ðŸ¤”\x20Difference:\x20','getAllPayments','get','./telegramBotService','gatewayOrderId','chargebackAmount','\x20for\x20shop\x20','âš ï¸\x20Payment\x20','getAllPayouts','âœ…\x20Using\x20wallet\x20from\x20request:\x20','%\x20commission)','\x20\x20\x20ðŸ–¥ï¸\x20User\x20Agent:\x20','4853800tTGAVa','create','gateways','wallet','totalCommissionRate','dateTo','customerName','EXPIRED','getSystemStatistics','getMerchantsAwaitingPayout','week','\x20\x20\x20ðŸŒ\x20IP:\x20','\x20\x20\x20Difference:\x20','\x20became\x20PAID:','ACTIVE','\x20USDT','ðŸ”\x20Selected\x20polygon_usdc\x20wallet:\x20','ðŸ’°\x20[PAYOUT]\x20Gateway\x20','7kppOWT','Telegram\x20username\x20already\x20exists','\x20USDT\x20from\x20balance','forEach','erc20','ðŸ“Š\x20Merchants\x20with\x20rounded\x20balance\x20!=\x200.00:\x20','paymentsCount','CoinToPay','\x27\x20->\x20name\x20\x27','âŒ\x20Failed\x20to\x20send\x20Telegram\x20notification\x20for\x20payout\x20','ðŸ“Š\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','month','\x27\x20(from\x20\x27','revenue','gatewaySettings','paymentGateways','\x20\x20\x20ðŸ’µ\x20Available\x20balance:\x20','ru-RU','ðŸ’¸\x20CHARGEBACK:\x20Processing\x20penalty-only\x20deduction','deleteUser','ðŸ“…\x20Payout\x20date\x20to\x20filter:\x20','ðŸ’°\x20Current\x20shop\x20balance:\x20','\x20\x20\x20ðŸ’¸\x20Total\x20payouts:\x20','defineProperty','status','cointopay2','toFixed','aggregate','periodFrom','ðŸ’°\x20Payment\x20amount\x20is\x20NOT\x20deducted\x20(chargeback\x20penalty\x20only)','\x20with\x20payout\x20history','getGatewayIdByName','gateway','custom','update','cointopay','getUserById','split','\x20\x20\x20Available\x20(raw):\x20','set','\x20\x20\x20ðŸ’³\x20Total\x20payments:\x20',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','\x27\x20not\x20found.\x20Available\x20gateways:\x20','ðŸ”\x20Initial\x20wallet\x20from\x20request:\x20','amountAfterCommissionUSDT','\x20USDT,\x20Requested:\x20','totalAmountUSDT','merchantEarnings','52217oZcyMO','totalPaidOut','toUpperCase','plisio','mastercard','\x20\x20\x20ðŸ’°\x20Total\x20turnover:\x20','ðŸ”\x20Selected\x20erc20_usdc\x20wallet:\x20','failureMessage','default','getMonth','replace','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','includes','year','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','3636ianpJw','ðŸ”\x20Using\x20gateway\x20\x27',']\x20Gateway\x20settings\x20before\x20saving:','âœ…\x20Customer\x20data\x20updated\x20for\x20payment\x20','getAllUsers','telegram','ceil','\x20USDT\x20(theoretical\x20net)','getPayoutById','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','PAID','klyme_de','\x20\x20\x20Added\x20to\x20balance:\x20+','âœ…\x20Payout\x20created:\x20','ðŸ’°\x20Shop\x20','getPayoutStats','2020-01-01','customerEmail','asc','getGatewayNameById','\x20\x20\x20ï¿½ðŸ“Š\x20Total\x20payments:\x20','thisMonth','getGatewayInternalName','totalPayout','all','\x20\x20\x20âœ…\x20Actual\x20available\x20balance:\x20','slice','name','usdtPolygonWallet','_sum','Error\x20processing\x20payment\x20','\x20balance\x20updated:','updateCustomerData','log','ðŸ“Š\x20Calculating\x20payout\x20statistics...','length','sort','polygon','ðŸ“±\x20Telegram\x20notification\x20sent\x20for\x20payout\x20','password','ðŸ”„\x20Gateway\x20mapping:','createUser','âš ï¸\x20Requested\x20gateway\x20\x27','\x20to\x20','getUTCDate','delete','$transaction','values',',\x20refunds:\x20','usdtTrcWallet','round','getDay','paidOutUSDT','PENDING','amountAfterGatewayCommissionUSDT','sendPayoutNotification','admin','last_month','\x20\x20\x20Available\x20(number):\x20','\x20USDT)','%\x20from\x20','findUnique','\x20\x20\x20Final\x20payout\x20amount\x20used:\x20','map',',\x20Commission:\x20','shopId','../config/database','deletePayout','hash'];a46_0x4c6c=function(){return _0x4b3d23;};return a46_0x4c6c();}(function(_0x23ee26,_0x5466bc){const _0x3fcadb=a46_0x189e,_0x52f287=_0x23ee26();while(!![]){try{const _0x56854c=parseInt(_0x3fcadb(0x239))/0x1*(parseInt(_0x3fcadb(0x22b))/0x2)+parseInt(_0x3fcadb(0x202))/0x3*(parseInt(_0x3fcadb(0x338))/0x4)+parseInt(_0x3fcadb(0x260))/0x5+-parseInt(_0x3fcadb(0x324))/0x6+parseInt(_0x3fcadb(0x295))/0x7*(-parseInt(_0x3fcadb(0x283))/0x8)+parseInt(_0x3fcadb(0x1d8))/0x9*(parseInt(_0x3fcadb(0x1d1))/0xa)+-parseInt(_0x3fcadb(0x2c6))/0xb*(parseInt(_0x3fcadb(0x2d5))/0xc);if(_0x56854c===_0x5466bc)break;else _0x52f287['push'](_0x52f287['shift']());}catch(_0x42fc98){_0x52f287['push'](_0x52f287['shift']());}}}(a46_0x4c6c,0x9890c));var __importDefault=this&&this[a46_0x42f014(0x211)]||function(_0x4f9370){return _0x4f9370&&_0x4f9370['__esModule']?_0x4f9370:{'default':_0x4f9370};};function a46_0x189e(_0x4a2321,_0x386ba4){_0x4a2321=_0x4a2321-0x1cc;const _0x4c6c09=a46_0x4c6c();let _0x189ef4=_0x4c6c09[_0x4a2321];return _0x189ef4;}Object[a46_0x42f014(0x2ad)](exports,'__esModule',{'value':!![]}),exports[a46_0x42f014(0x24d)]=void 0x0;const database_1=__importDefault(require(a46_0x42f014(0x317))),bcryptjs_1=__importDefault(require(a46_0x42f014(0x230))),crypto_1=__importDefault(require(a46_0x42f014(0x268))),currencyService_1=require(a46_0x42f014(0x26c)),telegramBotService_1=require(a46_0x42f014(0x27a)),gateway_1=require(a46_0x42f014(0x1f6));class AdminService{async[a46_0x42f014(0x2e4)](){const _0xd78988=a46_0x42f014;console['log'](_0xd78988(0x2f7));const _0x3b132d=await database_1['default'][_0xd78988(0x241)]['aggregate']({'_sum':{'balance':!![],'totalPaidOut':!![]}}),_0x15a577=await database_1['default'][_0xd78988(0x228)][_0xd78988(0x216)]({'where':{'status':_0xd78988(0x2df),'gateway':{'not':_0xd78988(0x328)}}}),_0x4b4b69=new Date(),_0x141cc0=new Date(_0x4b4b69[_0xd78988(0x1f4)](),_0x4b4b69[_0xd78988(0x2cf)](),0x1),_0x19b9f5=new Date(_0x4b4b69[_0xd78988(0x1f4)](),_0x4b4b69['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x43abbc=await database_1[_0xd78988(0x2ce)]['payout']['aggregate']({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x141cc0,'lte':_0x19b9f5},'status':_0xd78988(0x254)}}),_0x374bda=_0x3b132d[_0xd78988(0x2f2)][_0xd78988(0x2c7)]||0x0,_0x36e51c=_0x3b132d[_0xd78988(0x2f2)][_0xd78988(0x1d5)]||0x0,_0x2968a2=_0x43abbc['_sum'][_0xd78988(0x236)]||0x0,_0x2c0c6b={'totalPayout':Math[_0xd78988(0x307)](_0x374bda*0x64)/0x64,'awaitingPayout':Math[_0xd78988(0x307)](_0x36e51c*0x64)/0x64,'thisMonth':Math[_0xd78988(0x307)](_0x2968a2*0x64)/0x64,'availableBalance':Math[_0xd78988(0x307)](_0x36e51c*0x64)/0x64,'totalPayments':_0x15a577};return console[_0xd78988(0x2f6)](_0xd78988(0x1e1)),console[_0xd78988(0x2f6)]('\x20\x20\x20ðŸ’°\x20Total\x20payout:\x20'+_0x2c0c6b[_0xd78988(0x2ec)]+_0xd78988(0x1d2)),console['log']('\x20\x20\x20â³\x20Awaiting\x20payout:\x20'+_0x2c0c6b['awaitingPayout']+_0xd78988(0x208)),console['log'](_0xd78988(0x2a6)+_0x2c0c6b['availableBalance']+_0xd78988(0x33d)),console[_0xd78988(0x2f6)]('\x20\x20\x20ðŸ“…\x20This\x20month:\x20'+_0x2c0c6b[_0xd78988(0x2ea)]+'\x20USDT'),console[_0xd78988(0x2f6)](_0xd78988(0x2be)+_0x2c0c6b[_0xd78988(0x214)]+_0xd78988(0x1e0)),_0x2c0c6b;}async[a46_0x42f014(0x2f5)](_0xe1bc01,_0x245a35){const _0x288fd=a46_0x42f014;console['log'](_0x288fd(0x25c)+_0xe1bc01+':',_0x245a35);const _0x23a6c3=await database_1['default']['payment'][_0x288fd(0x312)]({'where':{'id':_0xe1bc01},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x23a6c3)throw new Error('Payment\x20not\x20found');const _0x1115a2={};_0x245a35[_0x288fd(0x1ea)]!==undefined&&(_0x1115a2[_0x288fd(0x1ea)]=_0x245a35['customerCountry']||null);_0x245a35['customerIp']!==undefined&&(_0x1115a2['customerIp']=_0x245a35[_0x288fd(0x210)]||null);_0x245a35[_0x288fd(0x1cd)]!==undefined&&(_0x1115a2['customerUa']=_0x245a35[_0x288fd(0x1cd)]||null);const _0x5f4538=await database_1[_0x288fd(0x2ce)][_0x288fd(0x228)][_0x288fd(0x2b8)]({'where':{'id':_0xe1bc01},'data':{..._0x1115a2,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console['log'](_0x288fd(0x2d8)+_0xe1bc01),console[_0x288fd(0x2f6)]('\x20\x20\x20ðŸŒ\x20Country:\x20'+_0x23a6c3['customerCountry']+_0x288fd(0x229)+_0x5f4538[_0x288fd(0x1ea)]),console['log'](_0x288fd(0x28e)+_0x23a6c3['customerIp']+_0x288fd(0x229)+_0x5f4538['customerIp']),console['log'](_0x288fd(0x282)+(_0x23a6c3[_0x288fd(0x1cd)]?_0x288fd(0x2bd):_0x288fd(0x270))+_0x288fd(0x229)+(_0x5f4538['customerUa']?_0x288fd(0x2bd):_0x288fd(0x270))),_0x5f4538;}async[a46_0x42f014(0x28b)](_0x240b1b,_0x20b751){const _0x1f7b50=a46_0x42f014,_0x4b4473=_0x20b751?new Date(_0x20b751):new Date();let _0x236e33,_0x3096b3;if(_0x240b1b['startsWith'](_0x1f7b50(0x256))){const _0x1a8f46=_0x240b1b[_0x1f7b50(0x2d0)]('custom_','')[_0x1f7b50(0x2bb)]('_');_0x1a8f46[_0x1f7b50(0x2f8)]===0x2?(_0x236e33=new Date(_0x1a8f46[0x0]),_0x236e33[_0x1f7b50(0x234)](0x0,0x0,0x0,0x0),_0x3096b3=new Date(_0x1a8f46[0x1]),_0x3096b3['setHours'](0x17,0x3b,0x3b,0x3e7)):(_0x236e33=new Date(_0x4b4473[_0x1f7b50(0x20b)]()-0x1e*0x18*0x3c*0x3c*0x3e8),_0x236e33[_0x1f7b50(0x234)](0x0,0x0,0x0,0x0),_0x3096b3=new Date(),_0x3096b3[_0x1f7b50(0x234)](0x17,0x3b,0x3b,0x3e7));}else switch(_0x240b1b[_0x1f7b50(0x275)]()){case'today':_0x236e33=new Date(Date[_0x1f7b50(0x22f)](_0x4b4473['getUTCFullYear'](),_0x4b4473[_0x1f7b50(0x1e5)](),_0x4b4473['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x3096b3=new Date(Date[_0x1f7b50(0x22f)](_0x4b4473[_0x1f7b50(0x209)](),_0x4b4473[_0x1f7b50(0x1e5)](),_0x4b4473[_0x1f7b50(0x301)](),0x17,0x3b,0x3b,0x3e7));break;case _0x1f7b50(0x224):const _0x105f3d=new Date(_0x4b4473);_0x105f3d[_0x1f7b50(0x247)](_0x105f3d[_0x1f7b50(0x301)]()-0x1),_0x236e33=new Date(Date[_0x1f7b50(0x22f)](_0x105f3d[_0x1f7b50(0x209)](),_0x105f3d[_0x1f7b50(0x1e5)](),_0x105f3d['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x3096b3=new Date(Date[_0x1f7b50(0x22f)](_0x105f3d[_0x1f7b50(0x209)](),_0x105f3d[_0x1f7b50(0x1e5)](),_0x105f3d['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case'this_week':const _0xbdd0c2=_0x4b4473[_0x1f7b50(0x308)](),_0x5f11cc=_0xbdd0c2===0x0?-0x6:0x1-_0xbdd0c2;_0x236e33=new Date(_0x4b4473),_0x236e33[_0x1f7b50(0x203)](_0x4b4473[_0x1f7b50(0x1fe)]()+_0x5f11cc),_0x236e33['setHours'](0x0,0x0,0x0,0x0),_0x3096b3=new Date(_0x4b4473['getFullYear'](),_0x4b4473[_0x1f7b50(0x2cf)](),_0x4b4473[_0x1f7b50(0x1fe)](),0x17,0x3b,0x3b,0x3e7);break;case _0x1f7b50(0x1f2):const _0x5cbb60=new Date(_0x4b4473);_0x5cbb60['setDate'](_0x4b4473[_0x1f7b50(0x1fe)]()-0x7);const _0x193ec1=_0x5cbb60[_0x1f7b50(0x308)](),_0x4f95ea=_0x193ec1===0x0?-0x6:0x1-_0x193ec1;_0x236e33=new Date(_0x5cbb60),_0x236e33[_0x1f7b50(0x203)](_0x5cbb60[_0x1f7b50(0x1fe)]()+_0x4f95ea),_0x236e33[_0x1f7b50(0x234)](0x0,0x0,0x0,0x0),_0x3096b3=new Date(_0x236e33),_0x3096b3['setDate'](_0x236e33[_0x1f7b50(0x1fe)]()+0x6),_0x3096b3[_0x1f7b50(0x234)](0x17,0x3b,0x3b,0x3e7);break;case _0x1f7b50(0x232):_0x236e33=new Date(Date[_0x1f7b50(0x22f)](_0x4b4473[_0x1f7b50(0x209)](),_0x4b4473[_0x1f7b50(0x1e5)](),0x1,0x0,0x0,0x0,0x0)),_0x3096b3=new Date(Date[_0x1f7b50(0x22f)](_0x4b4473[_0x1f7b50(0x209)](),_0x4b4473[_0x1f7b50(0x1e5)](),_0x4b4473['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case _0x1f7b50(0x30e):_0x236e33=new Date(Date[_0x1f7b50(0x22f)](_0x4b4473[_0x1f7b50(0x209)](),_0x4b4473[_0x1f7b50(0x1e5)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x3096b3=new Date(Date[_0x1f7b50(0x22f)](_0x4b4473[_0x1f7b50(0x209)](),_0x4b4473[_0x1f7b50(0x1e5)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x1f7b50(0x33f):_0x236e33=new Date(Date[_0x1f7b50(0x22f)](0x7e4,0x0,0x1,0x0,0x0,0x0,0x0)),_0x3096b3=new Date(Date[_0x1f7b50(0x22f)](_0x4b4473[_0x1f7b50(0x209)](),_0x4b4473[_0x1f7b50(0x1e5)](),_0x4b4473['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;default:_0x236e33=new Date(_0x4b4473['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8),_0x236e33[_0x1f7b50(0x234)](0x0,0x0,0x0,0x0),_0x3096b3=new Date(_0x4b4473[_0x1f7b50(0x1f4)](),_0x4b4473[_0x1f7b50(0x2cf)](),_0x4b4473[_0x1f7b50(0x1fe)](),0x17,0x3b,0x3b,0x3e7);}const _0x5c73a4={'gte':_0x236e33,'lte':_0x3096b3},[_0x155b4b,_0xc317ce,_0x2cc4f4,_0x22f200,_0x3558d1,_0x7b2e4b,_0x38e344,_0x440ddc]=await Promise[_0x1f7b50(0x2ed)]([database_1['default'][_0x1f7b50(0x241)]['count'](),database_1[_0x1f7b50(0x2ce)][_0x1f7b50(0x241)][_0x1f7b50(0x216)]({'where':{'status':_0x1f7b50(0x291)}}),database_1[_0x1f7b50(0x2ce)]['payment'][_0x1f7b50(0x216)]({'where':{'status':_0x1f7b50(0x2df),'createdAt':_0x5c73a4,'gateway':{'not':_0x1f7b50(0x328)}}}),database_1['default']['payment'][_0x1f7b50(0x216)]({'where':{'status':'CHARGEBACK','createdAt':_0x5c73a4,'gateway':{'not':_0x1f7b50(0x328)}}}),database_1['default'][_0x1f7b50(0x228)][_0x1f7b50(0x216)]({'where':{'status':_0x1f7b50(0x221),'createdAt':_0x5c73a4,'gateway':{'not':_0x1f7b50(0x328)}}}),database_1[_0x1f7b50(0x2ce)][_0x1f7b50(0x228)][_0x1f7b50(0x1f5)]({'where':{'status':_0x1f7b50(0x2df),'createdAt':_0x5c73a4,'gateway':{'not':_0x1f7b50(0x328)}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x1f7b50(0x2ce)][_0x1f7b50(0x228)][_0x1f7b50(0x1f5)]({'where':{'gateway':{'not':'test_gateway'}},'take':0xa,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x1f7b50(0x2ce)][_0x1f7b50(0x228)]['findMany']({'where':{'createdAt':_0x5c73a4,'gateway':{'not':_0x1f7b50(0x328)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x1305c9=0x0,_0x17cf3e=0x0;for(const _0xeadb40 of _0x7b2e4b){const _0x235dca=_0xeadb40[_0x1f7b50(0x243)]||0x0;_0x1305c9+=_0x235dca;if(_0xeadb40['amountAfterGatewayCommissionUSDT']&&_0xeadb40[_0x1f7b50(0x243)]){const _0x39c217=_0xeadb40[_0x1f7b50(0x243)]-_0xeadb40[_0x1f7b50(0x30b)];_0x17cf3e+=_0x39c217;}}const _0x193fe5=_0x2cc4f4>0x0?_0x1305c9/_0x2cc4f4:0x0,_0x406464=this[_0x1f7b50(0x273)](_0x440ddc,_0x236e33,_0x3096b3),_0x5ecb96=await database_1['default'][_0x1f7b50(0x228)][_0x1f7b50(0x216)]({'where':{'createdAt':_0x5c73a4,'gateway':{'not':_0x1f7b50(0x328)},'status':{'notIn':[_0x1f7b50(0x30a),'EXPIRED']}}}),_0x17bd6b=_0x5ecb96>0x0?_0x2cc4f4/_0x5ecb96*0x64:0x0;return{'totalShops':_0x155b4b,'activeShops':_0xc317ce,'totalPayments':_0x5ecb96,'successfulPayments':_0x2cc4f4,'totalAttempts':_0x5ecb96,'chargebacks':_0x22f200,'refunds':_0x3558d1,'totalRevenue':Math['round'](_0x1305c9*0x64)/0x64,'trapayEarnings':Math['round'](_0x17cf3e*0x64)/0x64,'averagePaymentAmount':Math[_0x1f7b50(0x307)](_0x193fe5*0x64)/0x64,'conversionRate':Math[_0x1f7b50(0x307)](_0x17bd6b*0x64)/0x64,'dailyRevenue':_0x406464[_0x1f7b50(0x33b)],'dailyPayments':_0x406464[_0x1f7b50(0x32c)],'recentPayments':_0x38e344[_0x1f7b50(0x314)](_0x7e432a=>({'id':_0x7e432a['id'],'amount':_0x7e432a[_0x1f7b50(0x236)],'currency':_0x7e432a[_0x1f7b50(0x1fc)],'status':_0x7e432a[_0x1f7b50(0x2ae)],'gateway':_0x7e432a[_0x1f7b50(0x2b6)],'shop':_0x7e432a[_0x1f7b50(0x241)],'createdAt':_0x7e432a['createdAt']}))};}async[a46_0x42f014(0x204)](_0x5d2adb){const _0x3c7ce7=a46_0x42f014;console[_0x3c7ce7(0x2f6)](_0x3c7ce7(0x201),_0x5d2adb);let _0x108396,_0x3b1f37=new Date();if(_0x5d2adb['period']===_0x3c7ce7(0x2b7)&&_0x5d2adb[_0x3c7ce7(0x226)]&&_0x5d2adb[_0x3c7ce7(0x288)])_0x108396=new Date(_0x5d2adb['dateFrom']),_0x3b1f37=new Date(_0x5d2adb[_0x3c7ce7(0x288)]),_0x108396['setHours'](0x0,0x0,0x0,0x0),_0x3b1f37[_0x3c7ce7(0x234)](0x17,0x3b,0x3b,0x3e7);else{const _0x267d2a=new Date();switch(_0x5d2adb[_0x3c7ce7(0x1df)]){case _0x3c7ce7(0x28d):_0x108396=new Date(_0x267d2a[_0x3c7ce7(0x20b)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x3c7ce7(0x2a1):_0x108396=new Date(_0x267d2a[_0x3c7ce7(0x20b)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x3c7ce7(0x2d3):_0x108396=new Date(_0x267d2a['getTime']()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x3c7ce7(0x2ed):default:_0x108396=new Date(_0x3c7ce7(0x2e5));break;}_0x108396['setHours'](0x0,0x0,0x0,0x0),_0x3b1f37['setHours'](0x17,0x3b,0x3b,0x3e7);}console[_0x3c7ce7(0x2f6)]('ðŸ“…\x20Period:\x20'+_0x108396[_0x3c7ce7(0x271)]()+_0x3c7ce7(0x300)+_0x3b1f37[_0x3c7ce7(0x271)]());const _0x1d75c7={'status':_0x3c7ce7(0x2df),'gateway':{'not':'test_gateway'},'paidAt':{'gte':_0x108396,'lte':_0x3b1f37}};_0x5d2adb[_0x3c7ce7(0x316)]&&(_0x1d75c7[_0x3c7ce7(0x316)]=_0x5d2adb[_0x3c7ce7(0x316)]);const _0x55e8c3=await database_1[_0x3c7ce7(0x2ce)][_0x3c7ce7(0x228)][_0x3c7ce7(0x1f5)]({'where':_0x1d75c7,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x3c7ce7(0x2f6)](_0x3c7ce7(0x245)+_0x55e8c3['length']+'\x20paid\x20payments\x20for\x20analysis');const _0x2d07f8={'gateway':{'not':_0x3c7ce7(0x328)},'status':{'notIn':[_0x3c7ce7(0x30a),_0x3c7ce7(0x28a)]},'createdAt':{'gte':_0x108396,'lte':_0x3b1f37}};_0x5d2adb[_0x3c7ce7(0x316)]&&(_0x2d07f8[_0x3c7ce7(0x316)]=_0x5d2adb['shopId']);const _0x1b37a6=await database_1['default'][_0x3c7ce7(0x228)][_0x3c7ce7(0x216)]({'where':_0x2d07f8}),_0x23dee1={..._0x2d07f8,'status':_0x3c7ce7(0x257)},_0x57a7e6={..._0x2d07f8,'status':_0x3c7ce7(0x221)},[_0x3c4914,_0x589110]=await Promise[_0x3c7ce7(0x2ed)]([database_1[_0x3c7ce7(0x2ce)][_0x3c7ce7(0x228)][_0x3c7ce7(0x216)]({'where':_0x23dee1}),database_1['default']['payment'][_0x3c7ce7(0x216)]({'where':_0x57a7e6})]);console[_0x3c7ce7(0x2f6)](_0x3c7ce7(0x1db)+_0x1b37a6+',\x20successful:\x20'+_0x55e8c3[_0x3c7ce7(0x2f8)]+_0x3c7ce7(0x20d)+_0x3c4914+_0x3c7ce7(0x305)+_0x589110);let _0x40f863=0x0,_0x4743d1=0x0,_0x324dd2=0x0;const _0x18ecb2={},_0x34ed0c={},_0x68edbb={};for(const _0x3ffbf1 of _0x55e8c3){try{const _0xecc365=_0x3ffbf1[_0x3c7ce7(0x243)]||0x0;if(_0xecc365<=0x0){console['warn'](_0x3c7ce7(0x27e)+_0x3ffbf1['id']+'\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...');continue;}let _0x402218,_0x46f156;if(_0x3ffbf1[_0x3c7ce7(0x30b)]!==null&&_0x3ffbf1[_0x3c7ce7(0x30b)]!==undefined)_0x402218=_0x3ffbf1[_0x3c7ce7(0x30b)],_0x46f156=_0xecc365-_0x402218,console[_0x3c7ce7(0x2f6)](_0x3c7ce7(0x21c)+_0x3ffbf1['id']+':\x20'+_0xecc365[_0x3c7ce7(0x2b0)](0x6)+'\x20USDT,\x20merchant:\x20'+_0x402218['toFixed'](0x6)+_0x3c7ce7(0x292));else{let _0x2f56c4={};if(_0x3ffbf1[_0x3c7ce7(0x241)][_0x3c7ce7(0x2a4)])try{_0x2f56c4=JSON[_0x3c7ce7(0x219)](_0x3ffbf1['shop'][_0x3c7ce7(0x2a4)]);}catch(_0x32b839){console[_0x3c7ce7(0x24f)](_0x3c7ce7(0x1da)+_0x3ffbf1[_0x3c7ce7(0x316)]+':',_0x32b839);}let _0x3e089c=0x2d;for(const [_0x37ce54,_0xbd5817]of Object['entries'](_0x2f56c4)){if(_0x37ce54[_0x3c7ce7(0x275)]()===_0x3ffbf1[_0x3c7ce7(0x2b6)][_0x3c7ce7(0x275)]()){_0x3e089c=_0xbd5817[_0x3c7ce7(0x233)]||0x2d;break;}}_0x46f156=_0xecc365*(_0x3e089c/0x64),_0x402218=_0xecc365-_0x46f156,console[_0x3c7ce7(0x2f6)](_0x3c7ce7(0x320)+_0x3ffbf1['id']+':\x20'+_0x3e089c+_0x3c7ce7(0x311)+_0xecc365[_0x3c7ce7(0x2b0)](0x6)+_0x3c7ce7(0x292));}_0x40f863+=_0xecc365,_0x4743d1+=_0x402218,_0x324dd2+=_0x46f156;let _0x13f6f2;_0x3ffbf1[_0x3c7ce7(0x339)]!==null&&_0x3ffbf1[_0x3c7ce7(0x339)]!==undefined?(_0x13f6f2=_0x3ffbf1[_0x3c7ce7(0x339)],console[_0x3c7ce7(0x2f6)]('ðŸ“Š\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20'+_0x3ffbf1['id']+':\x20'+_0x13f6f2+'%')):(_0x13f6f2=_0xecc365>0x0?_0x46f156/_0xecc365*0x64:0x0,console[_0x3c7ce7(0x2f6)](_0x3c7ce7(0x1e4)+_0x3ffbf1['id']+':\x20'+_0x13f6f2[_0x3c7ce7(0x2b0)](0x2)+'%'));!_0x18ecb2[_0x3ffbf1[_0x3c7ce7(0x2b6)]]&&(_0x18ecb2[_0x3ffbf1['gateway']]={'gateway':_0x3ffbf1[_0x3c7ce7(0x2b6)],'gatewayDisplayName':this[_0x3c7ce7(0x331)](_0x3ffbf1[_0x3c7ce7(0x2b6)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x18ecb2[_0x3ffbf1[_0x3c7ce7(0x2b6)]][_0x3c7ce7(0x29b)]++,_0x18ecb2[_0x3ffbf1[_0x3c7ce7(0x2b6)]][_0x3c7ce7(0x227)]+=_0xecc365,_0x18ecb2[_0x3ffbf1[_0x3c7ce7(0x2b6)]][_0x3c7ce7(0x20a)]+=_0x46f156,_0x18ecb2[_0x3ffbf1[_0x3c7ce7(0x2b6)]][_0x3c7ce7(0x23b)]+=_0x402218,_0x18ecb2[_0x3ffbf1[_0x3c7ce7(0x2b6)]][_0x3c7ce7(0x287)]+=_0x13f6f2;!_0x5d2adb[_0x3c7ce7(0x316)]&&(!_0x34ed0c[_0x3ffbf1[_0x3c7ce7(0x316)]]&&(_0x34ed0c[_0x3ffbf1['shopId']]={'shopId':_0x3ffbf1['shopId'],'shopName':_0x3ffbf1[_0x3c7ce7(0x241)][_0x3c7ce7(0x2f0)],'shopUsername':_0x3ffbf1[_0x3c7ce7(0x241)][_0x3c7ce7(0x323)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x34ed0c[_0x3ffbf1[_0x3c7ce7(0x316)]][_0x3c7ce7(0x29b)]++,_0x34ed0c[_0x3ffbf1['shopId']][_0x3c7ce7(0x227)]+=_0xecc365,_0x34ed0c[_0x3ffbf1['shopId']][_0x3c7ce7(0x20a)]+=_0x46f156,_0x34ed0c[_0x3ffbf1['shopId']][_0x3c7ce7(0x23b)]+=_0x402218);const _0x3b2c4f=_0x3ffbf1[_0x3c7ce7(0x31e)]['toISOString']()[_0x3c7ce7(0x2bb)]('T')[0x0];!_0x68edbb[_0x3b2c4f]&&(_0x68edbb[_0x3b2c4f]={'date':_0x3b2c4f,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x68edbb[_0x3b2c4f][_0x3c7ce7(0x322)]+=_0xecc365,_0x68edbb[_0x3b2c4f][_0x3c7ce7(0x2c5)]+=_0x402218,_0x68edbb[_0x3b2c4f][_0x3c7ce7(0x22e)]+=_0x46f156,_0x68edbb[_0x3b2c4f]['paymentsCount']++;}catch(_0xb7e6a3){console[_0x3c7ce7(0x24f)](_0x3c7ce7(0x2f3)+_0x3ffbf1['id']+':',_0xb7e6a3);}}Object[_0x3c7ce7(0x304)](_0x18ecb2)[_0x3c7ce7(0x298)](_0x4211f0=>{const _0x2f8aa4=_0x3c7ce7;_0x4211f0[_0x2f8aa4(0x220)]=_0x4211f0[_0x2f8aa4(0x29b)]>0x0?_0x4211f0[_0x2f8aa4(0x287)]/_0x4211f0['paymentsCount']:0x0,delete _0x4211f0[_0x2f8aa4(0x287)];}),Object[_0x3c7ce7(0x304)](_0x34ed0c)[_0x3c7ce7(0x298)](_0xda7856=>{const _0x37cb5e=_0x3c7ce7;_0xda7856['averageCheckUSDT']=_0xda7856[_0x37cb5e(0x29b)]>0x0?_0xda7856[_0x37cb5e(0x227)]/_0xda7856['paymentsCount']:0x0;});let _0x133efb=0x0,_0x97717f=0x0;if(_0x5d2adb['shopId']){const _0x4b9a8c=await database_1[_0x3c7ce7(0x2ce)][_0x3c7ce7(0x246)][_0x3c7ce7(0x1f5)]({'where':{'shopId':_0x5d2adb['shopId'],'status':_0x3c7ce7(0x254),'createdAt':{'gte':_0x108396,'lte':_0x3b1f37}},'select':{'amount':!![]}});_0x133efb=_0x4b9a8c[_0x3c7ce7(0x1fb)]((_0x16cab0,_0x1dc519)=>_0x16cab0+_0x1dc519[_0x3c7ce7(0x236)],0x0);const _0x2df613=await database_1[_0x3c7ce7(0x2ce)][_0x3c7ce7(0x246)][_0x3c7ce7(0x1f5)]({'where':{'shopId':_0x5d2adb[_0x3c7ce7(0x316)],'status':_0x3c7ce7(0x30a),'createdAt':{'gte':_0x108396,'lte':_0x3b1f37}},'select':{'amount':!![]}});_0x97717f=_0x2df613[_0x3c7ce7(0x1fb)]((_0xbd4191,_0x147ae9)=>_0xbd4191+_0x147ae9['amount'],0x0);}const _0x1e4b28=_0x1b37a6,_0x535d54=_0x55e8c3[_0x3c7ce7(0x2f8)],_0x306b72=_0x535d54>0x0?_0x40f863/_0x535d54:0x0,_0x2236c5=_0x1e4b28>0x0?Math[_0x3c7ce7(0x307)](_0x535d54/_0x1e4b28*0x2710)/0x64:0x0,_0x1c1cea=Math[_0x3c7ce7(0x2db)]((_0x3b1f37[_0x3c7ce7(0x20b)]()-_0x108396[_0x3c7ce7(0x20b)]())/(0x3e8*0x3c*0x3c*0x18)),_0x125a94={'totalTurnover':Math[_0x3c7ce7(0x307)](_0x40f863*0x64)/0x64,'merchantEarnings':Math['round'](_0x4743d1*0x64)/0x64,'gatewayEarnings':Math[_0x3c7ce7(0x307)](_0x324dd2*0x64)/0x64,'totalPaidOut':Math[_0x3c7ce7(0x307)](_0x133efb*0x64)/0x64,'pendingPayout':Math[_0x3c7ce7(0x307)](_0x97717f*0x64)/0x64,'averageCheck':Math[_0x3c7ce7(0x307)](_0x306b72*0x64)/0x64,'totalPayments':_0x1e4b28,'successfulPayments':_0x535d54,'conversionRate':_0x2236c5,'chargebacks':_0x3c4914,'refunds':_0x589110,'gatewayBreakdown':Object[_0x3c7ce7(0x304)](_0x18ecb2)[_0x3c7ce7(0x314)](_0x98f2aa=>({..._0x98f2aa,'turnoverUSDT':Math[_0x3c7ce7(0x307)](_0x98f2aa['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math['round'](_0x98f2aa[_0x3c7ce7(0x20a)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x3c7ce7(0x307)](_0x98f2aa['merchantEarningsUSDT']*0x64)/0x64,'averageCommissionRate':Math[_0x3c7ce7(0x307)](_0x98f2aa[_0x3c7ce7(0x220)]*0x64)/0x64})),'merchantBreakdown':_0x5d2adb['shopId']?undefined:Object['values'](_0x34ed0c)['map'](_0x2d9461=>({..._0x2d9461,'turnoverUSDT':Math[_0x3c7ce7(0x307)](_0x2d9461[_0x3c7ce7(0x227)]*0x64)/0x64,'commissionUSDT':Math[_0x3c7ce7(0x307)](_0x2d9461[_0x3c7ce7(0x20a)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x3c7ce7(0x307)](_0x2d9461[_0x3c7ce7(0x23b)]*0x64)/0x64,'paidOutUSDT':Math['round'](_0x2d9461[_0x3c7ce7(0x309)]*0x64)/0x64,'averageCheckUSDT':Math[_0x3c7ce7(0x307)](_0x2d9461[_0x3c7ce7(0x1f3)]*0x64)/0x64})),'dailyData':Object['values'](_0x68edbb)['map'](_0x278288=>({..._0x278288,'turnover':Math[_0x3c7ce7(0x307)](_0x278288['turnover']*0x64)/0x64,'merchantEarnings':Math[_0x3c7ce7(0x307)](_0x278288[_0x3c7ce7(0x2c5)]*0x64)/0x64,'gatewayEarnings':Math['round'](_0x278288[_0x3c7ce7(0x22e)]*0x64)/0x64}))[_0x3c7ce7(0x2f9)]((_0x3ffb47,_0x39d78f)=>_0x3ffb47[_0x3c7ce7(0x248)]['localeCompare'](_0x39d78f[_0x3c7ce7(0x248)])),'periodInfo':{'from':_0x108396,'to':_0x3b1f37,'periodType':_0x5d2adb[_0x3c7ce7(0x1df)]||_0x3c7ce7(0x2b7),'daysCount':_0x1c1cea}};return console[_0x3c7ce7(0x2f6)](_0x3c7ce7(0x21b)),console[_0x3c7ce7(0x2f6)](_0x3c7ce7(0x2cb)+_0x125a94[_0x3c7ce7(0x21d)]+_0x3c7ce7(0x292)),console[_0x3c7ce7(0x2f6)](_0x3c7ce7(0x337)+_0x125a94[_0x3c7ce7(0x2c5)]+_0x3c7ce7(0x292)),console[_0x3c7ce7(0x2f6)](_0x3c7ce7(0x1d9)+_0x125a94[_0x3c7ce7(0x22e)]+_0x3c7ce7(0x292)),console[_0x3c7ce7(0x2f6)](_0x3c7ce7(0x25f)+_0x125a94['totalPaidOut']+_0x3c7ce7(0x292)),console[_0x3c7ce7(0x2f6)](_0x3c7ce7(0x24c)+_0x125a94['pendingPayout']+'\x20USDT'),console[_0x3c7ce7(0x2f6)](_0x3c7ce7(0x2e9)+_0x125a94[_0x3c7ce7(0x214)]),_0x125a94;}async[a46_0x42f014(0x1d6)](_0xbfda64){const _0x2bfa1a=a46_0x42f014;console[_0x2bfa1a(0x2f6)]('ðŸ“‹\x20Getting\x20merchants\x20selection\x20list...',{'hasPayoutHistory':_0xbfda64});let _0x2954a5={};_0xbfda64&&(_0x2954a5['payouts']={'some':{}});const _0x197f86=await database_1[_0x2bfa1a(0x2ce)][_0x2bfa1a(0x241)]['findMany']({'where':_0x2954a5,'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':'asc'}});return console[_0x2bfa1a(0x2f6)](_0x2bfa1a(0x1e6)+_0x197f86[_0x2bfa1a(0x2f8)]+_0x2bfa1a(0x244)+(_0xbfda64?_0x2bfa1a(0x2b4):'')),_0x197f86[_0x2bfa1a(0x314)](_0x271924=>({'id':_0x271924['id'],'username':_0x271924[_0x2bfa1a(0x323)],'name':_0x271924[_0x2bfa1a(0x2f0)]}));}[a46_0x42f014(0x331)](_0x45709a){const _0x345b7f=a46_0x42f014,_0x5d7e9f={'test_gateway':_0x345b7f(0x33e),'plisio':'Plisio','rapyd':_0x345b7f(0x259),'noda':'Noda','cointopay':_0x345b7f(0x29c),'cointopay2':'Open\x20Banking\x202','klyme_eu':_0x345b7f(0x267),'klyme_gb':'KLYME\x20GB','klyme_de':_0x345b7f(0x261),'mastercard':_0x345b7f(0x1ed)};return _0x5d7e9f[_0x45709a]||_0x45709a;}[a46_0x42f014(0x2eb)](_0x49630f){const _0x4b3d27=a46_0x42f014,_0x159554={'Test\x20Gateway':_0x4b3d27(0x328),'Plisio':_0x4b3d27(0x2c9),'Rapyd':'rapyd','Noda':'noda','CoinToPay':_0x4b3d27(0x2b9),'CoinToPay2':_0x4b3d27(0x2af),'KLYME\x20EU':_0x4b3d27(0x269),'KLYME\x20GB':_0x4b3d27(0x206),'KLYME\x20DE':_0x4b3d27(0x2e0),'MasterCard':_0x4b3d27(0x2ca)};return _0x159554[_0x49630f]||_0x49630f[_0x4b3d27(0x275)]();}async[a46_0x42f014(0x28c)](_0x5243e1){const _0x33940=a46_0x42f014,{page:_0x2efbd4,limit:_0x543360,minAmount:_0x2eae0c,search:_0xf45a18}=_0x5243e1;console[_0x33940(0x2f6)](_0x33940(0x22c),_0x5243e1);let _0x5d22f7={};_0xf45a18&&(_0x5d22f7[_0x33940(0x2f0)]={'contains':_0xf45a18,'mode':'insensitive'});const _0x514ca3=await database_1[_0x33940(0x2ce)][_0x33940(0x241)]['findMany']({'where':_0x5d22f7,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),_0x46b8f3=_0x514ca3['filter'](_0x563b32=>{const _0x23e2b7=_0x33940,_0x2c7857=Math[_0x23e2b7(0x1ec)](_0x563b32['balance']*0x64)/0x64;if(_0x2eae0c&&_0x2c7857<_0x2eae0c)return![];return _0x2c7857!==0x0;});_0x46b8f3[_0x33940(0x2f9)]((_0x3f3854,_0x4a65f0)=>_0x4a65f0['balance']-_0x3f3854[_0x33940(0x1d5)]);const _0x29b45=_0x46b8f3[_0x33940(0x2f8)],_0x522069=(_0x2efbd4-0x1)*_0x543360,_0x47a326=_0x46b8f3[_0x33940(0x2ef)](_0x522069,_0x522069+_0x543360);console['log']('ðŸ’°\x20Found\x20'+_0x47a326['length']+_0x33940(0x31b));const _0x36365b=await Promise['all'](_0x47a326[_0x33940(0x314)](async _0x3ba4f1=>{const _0x397d8b=_0x33940,[_0x4eee88,_0x27f9dd,_0x58493d]=await Promise['all']([database_1[_0x397d8b(0x2ce)][_0x397d8b(0x228)][_0x397d8b(0x216)]({'where':{'shopId':_0x3ba4f1['id'],'status':_0x397d8b(0x2df),'gateway':{'not':'test_gateway'}}}),database_1[_0x397d8b(0x2ce)]['payment']['findFirst']({'where':{'shopId':_0x3ba4f1['id'],'status':'PAID','gateway':{'not':_0x397d8b(0x328)}},'orderBy':{'paidAt':_0x397d8b(0x2e7)},'select':{'paidAt':!![]}}),database_1['default'][_0x397d8b(0x228)][_0x397d8b(0x31f)]({'by':[_0x397d8b(0x2b6)],'where':{'shopId':_0x3ba4f1['id'],'status':_0x397d8b(0x2df),'gateway':{'not':_0x397d8b(0x328)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x119c81=new Date(),_0x22a7df=new Date(_0x119c81['getFullYear'](),_0x119c81[_0x397d8b(0x2cf)](),0x1),_0x478180=new Date(_0x119c81[_0x397d8b(0x1f4)](),_0x119c81[_0x397d8b(0x2cf)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x137c6e,_0x3a057a]=await Promise[_0x397d8b(0x2ed)]([database_1[_0x397d8b(0x2ce)][_0x397d8b(0x246)][_0x397d8b(0x2b1)]({'_sum':{'amount':!![]},'where':{'shopId':_0x3ba4f1['id'],'status':_0x397d8b(0x254)}}),database_1[_0x397d8b(0x2ce)][_0x397d8b(0x246)][_0x397d8b(0x2b1)]({'_sum':{'amount':!![]},'where':{'shopId':_0x3ba4f1['id'],'status':_0x397d8b(0x254),'createdAt':{'gte':_0x22a7df,'lte':_0x478180}}})]),_0x431f68=_0x137c6e['_sum'][_0x397d8b(0x236)]||0x0,_0x20312b=_0x3a057a['_sum'][_0x397d8b(0x236)]||0x0,_0x48b7b8=await Promise[_0x397d8b(0x2ed)](_0x58493d[_0x397d8b(0x314)](async _0x49cbc5=>{const _0x59f244=_0x397d8b;let _0x59d126=0x2d;if(_0x3ba4f1['gatewaySettings'])try{const _0x589729=JSON[_0x59f244(0x219)](_0x3ba4f1[_0x59f244(0x2a4)]);for(const [_0x62f40b,_0x2e8a06]of Object[_0x59f244(0x25a)](_0x589729)){if(_0x62f40b[_0x59f244(0x275)]()===_0x49cbc5['gateway']['toLowerCase']()){_0x59d126=_0x2e8a06['commission']||0xa,console[_0x59f244(0x2f6)](_0x59f244(0x294)+_0x49cbc5[_0x59f244(0x2b6)]+_0x59f244(0x27d)+_0x3ba4f1['id']+':\x20commission\x20=\x20'+_0x59d126+'%');break;}}}catch(_0x545b16){console[_0x59f244(0x24f)]('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x3ba4f1['id']+':',_0x545b16);}const _0x3b21bb=_0x49cbc5[_0x59f244(0x2f2)]?.['amountUSDT']||0x0,_0x1231b2=_0x3b21bb*(0x1-_0x59d126/0x64);return{'gateway':_0x49cbc5[_0x59f244(0x2b6)],'count':_0x49cbc5['_count']?.['id']||0x0,'amountUSDT':Math[_0x59f244(0x307)](_0x3b21bb*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x59f244(0x307)](_0x1231b2*0x64)/0x64,'commission':_0x59d126};})),_0x1e0f18=_0x48b7b8['reduce']((_0x59b63a,_0x436c4a)=>_0x59b63a+_0x436c4a['amountUSDT'],0x0),_0x5ed069=_0x48b7b8[_0x397d8b(0x1fb)]((_0x24dfec,_0xc46fd8)=>_0x24dfec+_0xc46fd8[_0x397d8b(0x2c2)],0x0),_0x27bb03=_0x3ba4f1[_0x397d8b(0x1d5)];return console['log'](_0x397d8b(0x1de)+_0x3ba4f1['username']+':'),console['log'](_0x397d8b(0x238)+_0x1e0f18[_0x397d8b(0x2b0)](0x2)+_0x397d8b(0x1e8)),console['log'](_0x397d8b(0x25d)+_0x5ed069[_0x397d8b(0x2b0)](0x2)+_0x397d8b(0x2dc)),console[_0x397d8b(0x2f6)](_0x397d8b(0x2ee)+_0x27bb03[_0x397d8b(0x2b0)](0x2)+_0x397d8b(0x1d4)),console[_0x397d8b(0x2f6)](_0x397d8b(0x2ac)+_0x431f68[_0x397d8b(0x2b0)](0x2)+_0x397d8b(0x26a)),console['log'](_0x397d8b(0x277)+(_0x5ed069-_0x431f68-_0x27bb03)[_0x397d8b(0x2b0)](0x2)+_0x397d8b(0x31d)),{'id':_0x3ba4f1['id'],'fullName':_0x3ba4f1[_0x397d8b(0x2f0)],'username':_0x3ba4f1[_0x397d8b(0x323)],'telegramId':_0x3ba4f1[_0x397d8b(0x2da)],'merchantUrl':_0x3ba4f1[_0x397d8b(0x32b)],'wallets':{'usdtPolygonWallet':_0x3ba4f1['usdtPolygonWallet'],'usdtTrcWallet':_0x3ba4f1[_0x397d8b(0x306)],'usdtErcWallet':_0x3ba4f1['usdtErcWallet'],'usdcPolygonWallet':_0x3ba4f1[_0x397d8b(0x24b)],'usdcErcWallet':_0x3ba4f1['usdcErcWallet']},'totalAmountUSDT':Math['round'](_0x1e0f18*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x397d8b(0x307)](_0x5ed069*0x64)/0x64,'currentBalance':Math['floor'](_0x27bb03*0x64)/0x64,'totalPayout':Math[_0x397d8b(0x307)](_0x431f68*0x64)/0x64,'thisMonth':Math[_0x397d8b(0x307)](_0x20312b*0x64)/0x64,'paymentsCount':_0x4eee88,'oldestPaymentDate':_0x27f9dd?.[_0x397d8b(0x31e)]||_0x3ba4f1[_0x397d8b(0x237)],'gatewayBreakdown':_0x48b7b8};})),_0xd3d15c=_0x36365b[_0x33940(0x1fb)]((_0x24ff2f,_0x5aeadc)=>_0x24ff2f+_0x5aeadc[_0x33940(0x2c4)],0x0),_0x15db12=_0x36365b[_0x33940(0x1fb)]((_0x372946,_0x4e8e9b)=>_0x372946+_0x4e8e9b['totalAmountAfterCommissionUSDT'],0x0),_0x169791=_0x36365b[_0x33940(0x1fb)]((_0x3bb25f,_0x59ed81)=>_0x3bb25f+_0x59ed81[_0x33940(0x2ec)],0x0),_0x5185a2=_0x36365b[_0x33940(0x1fb)]((_0xd332b2,_0x4ab3b4)=>_0xd332b2+_0x4ab3b4[_0x33940(0x2ea)],0x0);return console[_0x33940(0x2f6)](_0x33940(0x29a)+_0x29b45+_0x33940(0x326)),console[_0x33940(0x2f6)](_0x33940(0x1d0)+Math[_0x33940(0x307)](_0xd3d15c*0x64)/0x64+_0x33940(0x1e8)),console[_0x33940(0x2f6)]('\x20\x20\x20âœ…\x20Total\x20net\x20balances:\x20'+Math[_0x33940(0x307)](_0x15db12*0x64)/0x64+_0x33940(0x32d)),console[_0x33940(0x2f6)]('\x20\x20\x20ðŸ’¸\x20Total\x20payouts\x20(all\x20time):\x20'+Math[_0x33940(0x307)](_0x169791*0x64)/0x64+_0x33940(0x292)),console[_0x33940(0x2f6)](_0x33940(0x1dd)+Math[_0x33940(0x307)](_0x5185a2*0x64)/0x64+'\x20USDT'),{'merchants':_0x36365b,'pagination':{'page':_0x2efbd4,'limit':_0x543360,'total':_0x29b45,'totalPages':Math[_0x33940(0x2db)](_0x29b45/_0x543360)},'summary':{'totalMerchants':_0x29b45,'totalAmountUSDT':Math[_0x33940(0x307)](_0xd3d15c*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x33940(0x307)](_0x15db12*0x64)/0x64,'totalPayout':Math[_0x33940(0x307)](_0x169791*0x64)/0x64,'thisMonth':Math[_0x33940(0x307)](_0x5185a2*0x64)/0x64}};}async['createPayout'](_0x2be296){const _0x280a21=a46_0x42f014,{shopId:_0x4c5625,amount:_0x54e2e4,network:_0x40ca8e,wallet:_0x1c8205,notes:_0x351d33,txid:_0x3dd3d0,periodFrom:_0x127a7f,periodTo:_0x16e407}=_0x2be296,_0x4581fb=await database_1[_0x280a21(0x2ce)][_0x280a21(0x303)](async _0x5bce94=>{const _0x4e1386=_0x280a21,_0x925caf=await _0x5bce94['shop'][_0x4e1386(0x312)]({'where':{'id':_0x4c5625},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x925caf)throw new Error('Shop\x20not\x20found');console[_0x4e1386(0x2f6)]('ðŸ’°\x20Creating\x20payout\x20for\x20shop\x20'+_0x925caf[_0x4e1386(0x323)]+':'),console['log'](_0x4e1386(0x212)+_0x925caf[_0x4e1386(0x1d5)][_0x4e1386(0x2b0)](0x6)+_0x4e1386(0x292)),console[_0x4e1386(0x2f6)](_0x4e1386(0x1d7)+_0x54e2e4['toFixed'](0x6)+'\x20USDT'),console[_0x4e1386(0x2f6)](_0x4e1386(0x207)+_0x925caf[_0x4e1386(0x2c7)][_0x4e1386(0x2b0)](0x6)+_0x4e1386(0x292));if(_0x3dd3d0)console[_0x4e1386(0x2f6)]('\x20\x20\x20Transaction\x20hash:\x20'+_0x3dd3d0);const _0x7daf9c=0.000001,_0x50515d=Number(_0x925caf[_0x4e1386(0x1d5)]),_0x5d395a=Number(_0x54e2e4);console[_0x4e1386(0x2f6)](_0x4e1386(0x20f)),console['log'](_0x4e1386(0x2bc)+_0x925caf[_0x4e1386(0x1d5)]),console[_0x4e1386(0x2f6)](_0x4e1386(0x30f)+_0x50515d),console[_0x4e1386(0x2f6)]('\x20\x20\x20Requested\x20(number):\x20'+_0x5d395a),console['log'](_0x4e1386(0x28f)+(_0x50515d-_0x5d395a)),console['log']('\x20\x20\x20Tolerance:\x20'+_0x7daf9c);if(_0x50515d<_0x5d395a-_0x7daf9c)throw new Error('Insufficient\x20balance.\x20Available:\x20'+_0x50515d[_0x4e1386(0x2b0)](0x6)+_0x4e1386(0x2c3)+_0x5d395a[_0x4e1386(0x2b0)](0x6)+_0x4e1386(0x1ef)+(_0x50515d-_0x5d395a)[_0x4e1386(0x2b0)](0x8)+_0x4e1386(0x292));console[_0x4e1386(0x2f6)](_0x4e1386(0x1ce));const _0xadf91=Math[_0x4e1386(0x1cc)](_0x50515d,_0x5d395a);let _0x35d074=_0x1c8205;console['log'](_0x4e1386(0x2c1)+(_0x1c8205||_0x4e1386(0x1e7)));if(!_0x35d074){console['log'](_0x4e1386(0x266));const _0x181ac3=await _0x5bce94['shop']['findUnique']({'where':{'id':_0x4c5625},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});console['log']('ðŸ”\x20Shop\x20wallets:',_0x181ac3);if(_0x181ac3)switch(_0x40ca8e){case _0x4e1386(0x2fa):_0x35d074=_0x181ac3[_0x4e1386(0x2f1)]||undefined,console[_0x4e1386(0x2f6)](_0x4e1386(0x21a)+_0x35d074);break;case _0x4e1386(0x321):_0x35d074=_0x181ac3['usdtTrcWallet']||undefined,console['log']('ðŸ”\x20Selected\x20trc20\x20wallet:\x20'+_0x35d074);break;case _0x4e1386(0x299):_0x35d074=_0x181ac3['usdtErcWallet']||undefined,console[_0x4e1386(0x2f6)](_0x4e1386(0x258)+_0x35d074);break;case _0x4e1386(0x340):_0x35d074=_0x181ac3[_0x4e1386(0x24b)]||undefined,console[_0x4e1386(0x2f6)](_0x4e1386(0x293)+_0x35d074);break;case'erc20_usdc':_0x35d074=_0x181ac3[_0x4e1386(0x32f)]||undefined,console[_0x4e1386(0x2f6)](_0x4e1386(0x2cc)+_0x35d074);break;}}else console[_0x4e1386(0x2f6)](_0x4e1386(0x280)+_0x35d074);console['log']('ðŸ’³\x20Final\x20payout\x20wallet\x20for\x20'+_0x40ca8e+':\x20'+(_0x35d074||'not\x20specified')),console[_0x4e1386(0x2f6)](_0x4e1386(0x252),{'shopId':_0x4c5625,'amount':_0xadf91,'network':_0x40ca8e,'wallet':_0x35d074,'status':'COMPLETED','txid':_0x3dd3d0,'notes':_0x351d33,'periodFrom':_0x127a7f?new Date(_0x127a7f):null,'periodTo':_0x16e407?new Date(_0x16e407):null});const _0x5ef424=await _0x5bce94[_0x4e1386(0x246)][_0x4e1386(0x284)]({'data':{'shopId':_0x4c5625,'amount':_0xadf91,'network':_0x40ca8e,'wallet':_0x35d074,'status':'COMPLETED','txid':_0x3dd3d0,'notes':_0x351d33,'periodFrom':_0x127a7f?new Date(_0x127a7f):null,'periodTo':_0x16e407?new Date(_0x16e407):null,'createdAt':new Date(),'paidAt':new Date()}});console['log'](_0x4e1386(0x251),{'id':_0x5ef424['id'],'wallet':_0x5ef424[_0x4e1386(0x286)],'network':_0x5ef424[_0x4e1386(0x217)],'amount':_0x5ef424[_0x4e1386(0x236)]});const _0x433354=_0x50515d-_0xadf91,_0x151ac2=Number(_0x925caf[_0x4e1386(0x2c7)])+_0xadf91;return await _0x5bce94['shop'][_0x4e1386(0x2b8)]({'where':{'id':_0x4c5625},'data':{'balance':_0x433354,'totalPaidOut':_0x151ac2}}),console[_0x4e1386(0x2f6)]('ðŸ’°\x20Shop\x20'+_0x925caf[_0x4e1386(0x323)]+_0x4e1386(0x2f4)),console[_0x4e1386(0x2f6)]('\x20\x20\x20Balance:\x20'+_0x50515d[_0x4e1386(0x2b0)](0x6)+'\x20->\x20'+_0x433354['toFixed'](0x6)+_0x4e1386(0x262)+_0xadf91[_0x4e1386(0x2b0)](0x6)+')'),console['log'](_0x4e1386(0x223)+_0x925caf[_0x4e1386(0x2c7)]['toFixed'](0x6)+_0x4e1386(0x229)+_0x151ac2[_0x4e1386(0x2b0)](0x6)+_0x4e1386(0x225)+_0xadf91[_0x4e1386(0x2b0)](0x6)+')'),console[_0x4e1386(0x2f6)](_0x4e1386(0x313)+_0xadf91[_0x4e1386(0x2b0)](0x6)+_0x4e1386(0x292)),{'payout':_0x5ef424,'shop':_0x925caf};});console[_0x280a21(0x2f6)](_0x280a21(0x2e2)+_0x4581fb[_0x280a21(0x246)]['id']+_0x280a21(0x27d)+_0x4581fb[_0x280a21(0x241)][_0x280a21(0x323)]+'\x20('+_0x4581fb[_0x280a21(0x246)][_0x280a21(0x236)][_0x280a21(0x2b0)](0x6)+_0x280a21(0x310));try{let _0x208523=_0x280a21(0x1f0);if(_0x4581fb[_0x280a21(0x246)][_0x280a21(0x2b2)]&&_0x4581fb[_0x280a21(0x246)]['periodTo']){const _0xe5c701=new Date(_0x4581fb[_0x280a21(0x246)][_0x280a21(0x2b2)])[_0x280a21(0x1eb)](_0x280a21(0x2a7)),_0x1695dc=new Date(_0x4581fb[_0x280a21(0x246)][_0x280a21(0x24a)])[_0x280a21(0x1eb)](_0x280a21(0x2a7));_0x208523=_0xe5c701+_0x280a21(0x24e)+_0x1695dc;}await telegramBotService_1['telegramBotService'][_0x280a21(0x30c)](_0x4581fb[_0x280a21(0x246)][_0x280a21(0x316)],{'id':_0x4581fb[_0x280a21(0x246)]['id'],'amount':_0x4581fb[_0x280a21(0x246)][_0x280a21(0x236)],'network':_0x4581fb[_0x280a21(0x246)][_0x280a21(0x217)],'wallet':_0x4581fb[_0x280a21(0x246)]['wallet'],'period':_0x208523,'createdAt':_0x4581fb[_0x280a21(0x246)][_0x280a21(0x237)],'txid':_0x4581fb['payout']['txid']}),console[_0x280a21(0x2f6)](_0x280a21(0x2fb)+_0x4581fb['payout']['id']);}catch(_0x3b236a){console[_0x280a21(0x24f)](_0x280a21(0x29e)+_0x4581fb['payout']['id']+':',_0x3b236a);}return{'id':_0x4581fb['payout']['id'],'shopId':_0x4581fb[_0x280a21(0x246)][_0x280a21(0x316)],'shopName':_0x4581fb[_0x280a21(0x241)][_0x280a21(0x2f0)],'shopUsername':_0x4581fb[_0x280a21(0x241)][_0x280a21(0x323)],'amount':_0x4581fb[_0x280a21(0x246)][_0x280a21(0x236)],'network':_0x4581fb[_0x280a21(0x246)]['network'],'wallet':_0x4581fb['payout'][_0x280a21(0x286)],'status':_0x4581fb['payout'][_0x280a21(0x2ae)],'txid':_0x4581fb[_0x280a21(0x246)][_0x280a21(0x26d)],'notes':_0x4581fb[_0x280a21(0x246)][_0x280a21(0x329)],'periodFrom':_0x4581fb[_0x280a21(0x246)][_0x280a21(0x2b2)],'periodTo':_0x4581fb[_0x280a21(0x246)][_0x280a21(0x24a)],'createdAt':_0x4581fb['payout'][_0x280a21(0x237)],'paidAt':_0x4581fb[_0x280a21(0x246)]['paidAt']};}async[a46_0x42f014(0x27f)](_0x4b08d2){const _0x14fba2=a46_0x42f014,{page:_0x19e3bd,limit:_0x2ab9a8,shopId:_0x2cf5cb,network:_0x25546c,dateFrom:_0x11c3f2,dateTo:_0x399b56,search:_0xb8d08e}=_0x4b08d2,_0x230eac=(_0x19e3bd-0x1)*_0x2ab9a8,_0x5ce13f={};_0x2cf5cb&&(_0x5ce13f[_0x14fba2(0x316)]=_0x2cf5cb);_0x25546c&&(_0x5ce13f[_0x14fba2(0x217)]=_0x25546c);if(_0x11c3f2||_0x399b56){_0x5ce13f['createdAt']={};if(_0x11c3f2){const _0x49f452=new Date(_0x11c3f2);_0x49f452[_0x14fba2(0x234)](0x0,0x0,0x0,0x1),_0x5ce13f['createdAt'][_0x14fba2(0x21f)]=_0x49f452,console[_0x14fba2(0x2f6)](_0x14fba2(0x22a)+_0x49f452[_0x14fba2(0x271)]());}if(_0x399b56){const _0x113c73=new Date(_0x399b56);_0x113c73['setHours'](0x17,0x3b,0x3b,0x3e7),_0x5ce13f[_0x14fba2(0x237)]['lte']=_0x113c73,console[_0x14fba2(0x2f6)](_0x14fba2(0x2aa)+_0x113c73[_0x14fba2(0x271)]());}}_0xb8d08e&&(_0x5ce13f['OR']=[{'shop':{'name':{'contains':_0xb8d08e,'mode':_0x14fba2(0x32a)}}},{'shop':{'username':{'contains':_0xb8d08e,'mode':_0x14fba2(0x32a)}}},{'notes':{'contains':_0xb8d08e,'mode':_0x14fba2(0x32a)}}]);const [_0x30d882,_0x5e607c]=await Promise[_0x14fba2(0x2ed)]([database_1[_0x14fba2(0x2ce)]['payout'][_0x14fba2(0x1f5)]({'where':_0x5ce13f,'skip':_0x230eac,'take':_0x2ab9a8,'orderBy':{'createdAt':_0x14fba2(0x32e)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'wallet':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x14fba2(0x2ce)][_0x14fba2(0x246)]['count']({'where':_0x5ce13f})]);return{'payouts':_0x30d882[_0x14fba2(0x314)](_0x2bfdee=>({'id':_0x2bfdee['id'],'shopId':_0x2bfdee[_0x14fba2(0x316)],'shopName':_0x2bfdee[_0x14fba2(0x241)][_0x14fba2(0x2f0)],'shopUsername':_0x2bfdee[_0x14fba2(0x241)][_0x14fba2(0x323)],'amount':_0x2bfdee[_0x14fba2(0x236)],'network':_0x2bfdee[_0x14fba2(0x217)],'wallet':_0x2bfdee[_0x14fba2(0x286)],'status':_0x2bfdee['status'],'txid':_0x2bfdee['txid'],'notes':_0x2bfdee[_0x14fba2(0x329)],'periodFrom':_0x2bfdee[_0x14fba2(0x2b2)],'periodTo':_0x2bfdee['periodTo'],'createdAt':_0x2bfdee[_0x14fba2(0x237)],'paidAt':_0x2bfdee[_0x14fba2(0x31e)]})),'pagination':{'page':_0x19e3bd,'limit':_0x2ab9a8,'total':_0x5e607c,'totalPages':Math['ceil'](_0x5e607c/_0x2ab9a8)}};}async[a46_0x42f014(0x2dd)](_0x52757b){const _0x5e1011=a46_0x42f014,_0x3f543c=await database_1[_0x5e1011(0x2ce)][_0x5e1011(0x246)][_0x5e1011(0x312)]({'where':{'id':_0x52757b},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x3f543c)return null;return{'id':_0x3f543c['id'],'shopId':_0x3f543c['shopId'],'shopName':_0x3f543c[_0x5e1011(0x241)][_0x5e1011(0x2f0)],'shopUsername':_0x3f543c[_0x5e1011(0x241)][_0x5e1011(0x323)],'amount':_0x3f543c[_0x5e1011(0x236)],'network':_0x3f543c[_0x5e1011(0x217)],'wallet':_0x3f543c['wallet'],'status':_0x3f543c[_0x5e1011(0x2ae)],'txid':_0x3f543c[_0x5e1011(0x26d)],'notes':_0x3f543c['notes'],'periodFrom':_0x3f543c[_0x5e1011(0x2b2)],'periodTo':_0x3f543c[_0x5e1011(0x24a)],'createdAt':_0x3f543c[_0x5e1011(0x237)],'paidAt':_0x3f543c[_0x5e1011(0x31e)]};}async[a46_0x42f014(0x318)](_0x7a43e1){const _0x3be78a=a46_0x42f014;await database_1['default'][_0x3be78a(0x246)][_0x3be78a(0x302)]({'where':{'id':_0x7a43e1}});}async[a46_0x42f014(0x278)](_0x2323d5){const _0x571337=a46_0x42f014,{page:_0x57528e,limit:_0x50a8b3,status:_0x5780da,gateway:_0x462742,shopId:_0x2accd0,dateFrom:_0x1ea614,dateTo:_0x3af911,search:_0x55ba7a,currency:_0xc4c7bf,sortBy:_0xbc8c80,sortOrder:_0x5dbb02}=_0x2323d5,_0x2cc40b=(_0x57528e-0x1)*_0x50a8b3;console[_0x571337(0x2f6)](_0x571337(0x26f),_0x2323d5);const _0x4623aa=await database_1[_0x571337(0x2ce)][_0x571337(0x228)][_0x571337(0x31f)]({'by':['gateway'],'_count':{'gateway':!![]}});console[_0x571337(0x2f6)]('ðŸ“Š\x20Available\x20gateways\x20in\x20database:',_0x4623aa[_0x571337(0x314)](_0x53e5a2=>_0x53e5a2[_0x571337(0x2b6)]+'\x20('+_0x53e5a2['_count']['gateway']+_0x571337(0x23c)));if(_0x462742){const _0x3c0e66=_0x4623aa['some'](_0x5beb3d=>_0x5beb3d[_0x571337(0x2b6)][_0x571337(0x275)]()===_0x462742[_0x571337(0x275)]());!_0x3c0e66&&_0x462742[_0x571337(0x275)]()!==_0x571337(0x328)&&console[_0x571337(0x2f6)](_0x571337(0x2ff)+_0x462742+_0x571337(0x2c0)+_0x4623aa[_0x571337(0x314)](_0x28e114=>_0x28e114['gateway'])[_0x571337(0x22d)](',\x20'));}const _0x5709e9={};_0x5780da&&(_0x5709e9['status']=_0x5780da[_0x571337(0x2c8)]());if(!_0x462742)_0x5709e9['gateway']={'not':_0x571337(0x328)};else{if(_0x462742&&(_0x462742['toLowerCase']()===_0x571337(0x328)||_0x462742==='0000'))_0x5709e9['gateway']=_0x571337(0x328);else{let _0x532901=_0x462742;const _0x2b1b2d=(0x0,gateway_1[_0x571337(0x2e8)])(_0x462742);if(_0x2b1b2d)_0x532901=_0x2b1b2d,console[_0x571337(0x2f6)](_0x571337(0x25b)+_0x462742+'\x27\x20to\x20name\x20\x27'+_0x532901+'\x27');else{const _0x422e05=(0x0,gateway_1[_0x571337(0x2b5)])(_0x462742);if(_0x422e05){const _0x130ada=(0x0,gateway_1[_0x571337(0x2e8)])(_0x422e05);_0x130ada&&(_0x532901=_0x130ada,console[_0x571337(0x2f6)](_0x571337(0x1e9)+_0x462742+'\x27\x20->\x20ID\x20\x27'+_0x422e05+_0x571337(0x29d)+_0x532901+'\x27'));}else console['log'](_0x571337(0x2d6)+_0x462742+'\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)');}const _0x2dd0eb=await database_1[_0x571337(0x2ce)][_0x571337(0x228)][_0x571337(0x216)]({'where':{'gateway':_0x532901[_0x571337(0x275)]()},'take':0x1});_0x2dd0eb===0x0?(console[_0x571337(0x2f6)](_0x571337(0x335)+_0x532901+'\x27\x20(from\x20\x27'+_0x462742+_0x571337(0x2d1)),_0x5709e9[_0x571337(0x2b6)]='NONEXISTENT_GATEWAY_FILTER'):(_0x5709e9[_0x571337(0x2b6)]=_0x532901[_0x571337(0x275)](),console['log'](_0x571337(0x1ff)+_0x532901+_0x571337(0x2a2)+_0x462742+'\x27)'));}}console[_0x571337(0x2f6)](_0x571337(0x330),_0x5709e9[_0x571337(0x2b6)]);_0x2accd0&&(_0x5709e9['shopId']=_0x2accd0);_0xc4c7bf&&(_0x5709e9[_0x571337(0x1fc)]=_0xc4c7bf[_0x571337(0x2c8)](),console[_0x571337(0x2f6)](_0x571337(0x213)+_0xc4c7bf[_0x571337(0x2c8)]()));if(_0x1ea614||_0x3af911){_0x5709e9['createdAt']={};if(_0x1ea614){const _0x49b635=new Date(_0x1ea614);_0x49b635[_0x571337(0x234)](0x0,0x0,0x0,0x1),_0x5709e9[_0x571337(0x237)][_0x571337(0x21f)]=_0x49b635,console[_0x571337(0x2f6)](_0x571337(0x23d)+_0x49b635[_0x571337(0x271)]());}if(_0x3af911){const _0x14c21c=new Date(_0x3af911);_0x14c21c['setHours'](0x17,0x3b,0x3b,0x3e7),_0x5709e9[_0x571337(0x237)][_0x571337(0x31c)]=_0x14c21c,console[_0x571337(0x2f6)]('ðŸ“…\x20Date\x20to\x20filter:\x20'+_0x14c21c[_0x571337(0x271)]());}}_0x55ba7a&&(_0x5709e9['OR']=[{'id':{'contains':_0x55ba7a,'mode':_0x571337(0x32a)}},{'orderId':{'contains':_0x55ba7a,'mode':'insensitive'}},{'gatewayOrderId':{'contains':_0x55ba7a,'mode':_0x571337(0x32a)}},{'customerEmail':{'contains':_0x55ba7a,'mode':_0x571337(0x32a)}},{'shop':{'name':{'contains':_0x55ba7a,'mode':_0x571337(0x32a)}}},{'shop':{'username':{'contains':_0x55ba7a,'mode':_0x571337(0x32a)}}}]);console[_0x571337(0x2f6)](_0x571337(0x1f7),JSON['stringify'](_0x5709e9,null,0x2));let _0x3d6a76={'createdAt':_0x571337(0x32e)};if(_0xbc8c80){const _0x55e1a7=[_0x571337(0x236),_0x571337(0x237),_0x571337(0x1f8),_0x571337(0x2ae),_0x571337(0x2b6),_0x571337(0x1fc)],_0x1e2dd2=['asc',_0x571337(0x32e)];if(_0x55e1a7[_0x571337(0x2d2)](_0xbc8c80)){const _0x397f93=_0x1e2dd2['includes'](_0x5dbb02)?_0x5dbb02:'desc';_0x3d6a76={[_0xbc8c80]:_0x397f93},console['log'](_0x571337(0x1cf)+_0xbc8c80+_0x571337(0x1f1)+_0x397f93+_0x571337(0x263));}}const [_0x5bb579,_0x4ece41]=await Promise['all']([database_1[_0x571337(0x2ce)][_0x571337(0x228)][_0x571337(0x1f5)]({'where':_0x5709e9,'skip':_0x2cc40b,'take':_0x50a8b3,'orderBy':_0x3d6a76,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x571337(0x2ce)][_0x571337(0x228)][_0x571337(0x216)]({'where':_0x5709e9})]);return{'payments':_0x5bb579,'pagination':{'page':_0x57528e,'limit':_0x50a8b3,'total':_0x4ece41,'totalPages':Math[_0x571337(0x2db)](_0x4ece41/_0x50a8b3)}};}async[a46_0x42f014(0x200)](_0x7e300b){const _0x3b4a66=a46_0x42f014,_0x5b9ae9=await database_1[_0x3b4a66(0x2ce)]['payment'][_0x3b4a66(0x312)]({'where':{'id':_0x7e300b},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x5b9ae9)return null;return{'id':_0x5b9ae9['id'],'shopId':_0x5b9ae9[_0x3b4a66(0x316)],'gateway':_0x5b9ae9[_0x3b4a66(0x2b6)],'amount':_0x5b9ae9[_0x3b4a66(0x236)],'currency':_0x5b9ae9['currency'],'status':_0x5b9ae9[_0x3b4a66(0x2ae)],'orderId':_0x5b9ae9[_0x3b4a66(0x325)],'gatewayOrderId':_0x5b9ae9[_0x3b4a66(0x27b)],'customerEmail':_0x5b9ae9[_0x3b4a66(0x2e6)],'customerName':_0x5b9ae9['customerName'],'customerCountry':_0x5b9ae9[_0x3b4a66(0x1ea)],'customerIp':_0x5b9ae9[_0x3b4a66(0x210)],'customerUa':_0x5b9ae9[_0x3b4a66(0x1cd)],'failureMessage':_0x5b9ae9[_0x3b4a66(0x2cd)],'externalPaymentUrl':_0x5b9ae9[_0x3b4a66(0x26e)],'successUrl':_0x5b9ae9['successUrl'],'failUrl':_0x5b9ae9[_0x3b4a66(0x20e)],'pendingUrl':_0x5b9ae9[_0x3b4a66(0x23f)],'whiteUrl':_0x5b9ae9[_0x3b4a66(0x1d3)],'createdAt':_0x5b9ae9[_0x3b4a66(0x237)],'updatedAt':_0x5b9ae9[_0x3b4a66(0x1f8)],'shop':_0x5b9ae9[_0x3b4a66(0x241)]};}async['updatePaymentStatus'](_0x34f6f6,_0x47bf24,_0x194b49,_0x9d98c4){const _0x18adc1=a46_0x42f014,_0x211f9f=await database_1[_0x18adc1(0x2ce)]['$transaction'](async _0x575484=>{const _0x1649bd=_0x18adc1,_0xb7e067=await _0x575484[_0x1649bd(0x228)][_0x1649bd(0x312)]({'where':{'id':_0x34f6f6},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0xb7e067)throw new Error(_0x1649bd(0x23a));const _0x5bbf01=_0xb7e067[_0x1649bd(0x2ae)],_0xe7111f=_0x47bf24['toUpperCase']();console[_0x1649bd(0x2f6)](_0x1649bd(0x276)+_0x34f6f6+_0x1649bd(0x205)+_0x5bbf01+_0x1649bd(0x229)+_0xe7111f),console['log'](_0x1649bd(0x2ab)+_0xb7e067['shop']['balance']+_0x1649bd(0x292));const _0x3ec3ff={'status':_0xe7111f,'updatedAt':new Date(),'statusChangedBy':_0x1649bd(0x30d),'statusChangedAt':new Date()};_0x194b49&&(_0x3ec3ff[_0x1649bd(0x336)]=_0x194b49);_0xe7111f===_0x1649bd(0x257)&&_0x9d98c4&&(_0x3ec3ff[_0x1649bd(0x27c)]=_0x9d98c4);let _0x5a600d=0x0,_0x1202f0=_0xb7e067[_0x1649bd(0x241)]['balance'];if(_0xe7111f===_0x1649bd(0x2df)&&_0x5bbf01!=='PAID'){_0x3ec3ff[_0x1649bd(0x31e)]=new Date();const _0xe6d252=await currencyService_1[_0x1649bd(0x334)][_0x1649bd(0x218)](_0xb7e067[_0x1649bd(0x236)],_0xb7e067[_0x1649bd(0x1fc)]);_0x3ec3ff[_0x1649bd(0x243)]=_0xe6d252;let _0x547493=0x2d;const _0x382a7f=await _0x575484[_0x1649bd(0x241)][_0x1649bd(0x312)]({'where':{'id':_0xb7e067['shopId']},'select':{'gatewaySettings':!![]}});if(_0x382a7f?.['gatewaySettings'])try{const _0x5e60aa=JSON[_0x1649bd(0x219)](_0x382a7f[_0x1649bd(0x2a4)]);for(const [_0x3a810d,_0x135494]of Object[_0x1649bd(0x25a)](_0x5e60aa)){if(_0x3a810d[_0x1649bd(0x275)]()===_0xb7e067[_0x1649bd(0x2b6)][_0x1649bd(0x275)]()){_0x547493=_0x135494[_0x1649bd(0x233)]||0xa;break;}}}catch(_0x27e4ac){console['error'](_0x1649bd(0x2d4)+_0x34f6f6+':',_0x27e4ac);}let _0x6e4ebc;_0xb7e067[_0x1649bd(0x30b)]!==null&&_0xb7e067[_0x1649bd(0x30b)]!==undefined?(_0x6e4ebc=_0xb7e067[_0x1649bd(0x30b)],console[_0x1649bd(0x2f6)](_0x1649bd(0x253)+_0x6e4ebc[_0x1649bd(0x2b0)](0x6)+'\x20USDT\x20for\x20payment\x20'+_0x34f6f6)):(_0x6e4ebc=_0xe6d252*(0x1-_0x547493/0x64),console[_0x1649bd(0x2f6)](_0x1649bd(0x29f)+_0x34f6f6+':\x20'+_0x547493+_0x1649bd(0x311)+_0xe6d252[_0x1649bd(0x2b0)](0x6)+_0x1649bd(0x292)),_0x3ec3ff[_0x1649bd(0x30b)]=_0x6e4ebc,_0x3ec3ff[_0x1649bd(0x339)]=_0x547493),_0x5a600d=_0x6e4ebc,_0x1202f0+=_0x6e4ebc,console['log']('ðŸ’°\x20Payment\x20'+_0x34f6f6+_0x1649bd(0x290)),console[_0x1649bd(0x2f6)](_0x1649bd(0x215)+_0xe6d252[_0x1649bd(0x2b0)](0x6)+'\x20USDT'),console[_0x1649bd(0x2f6)](_0x1649bd(0x26b)+_0xb7e067[_0x1649bd(0x2b6)]+_0x1649bd(0x315)+_0x547493+'%'),console[_0x1649bd(0x2f6)](_0x1649bd(0x20c)+_0x6e4ebc[_0x1649bd(0x2b0)](0x6)+'\x20USDT\x20(after\x20'+_0x547493+_0x1649bd(0x281)),console[_0x1649bd(0x2f6)](_0x1649bd(0x2e1)+_0x6e4ebc[_0x1649bd(0x2b0)](0x6)+_0x1649bd(0x292));}else{if(_0x5bbf01===_0x1649bd(0x2df)&&_0xe7111f!=='PAID'&&_0xe7111f!==_0x1649bd(0x257)){if(_0xb7e067[_0x1649bd(0x243)]){let _0x5322b6=0x2d;const _0x4679b4=await _0x575484[_0x1649bd(0x241)][_0x1649bd(0x312)]({'where':{'id':_0xb7e067[_0x1649bd(0x316)]},'select':{'gatewaySettings':!![]}});if(_0x4679b4?.[_0x1649bd(0x2a4)])try{const _0x10b4a7=JSON['parse'](_0x4679b4[_0x1649bd(0x2a4)]);for(const [_0x2cf86c,_0x2bc470]of Object[_0x1649bd(0x25a)](_0x10b4a7)){if(_0x2cf86c['toLowerCase']()===_0xb7e067[_0x1649bd(0x2b6)][_0x1649bd(0x275)]()){_0x5322b6=_0x2bc470[_0x1649bd(0x233)]||0xa;break;}}}catch(_0x4f0389){console['error'](_0x1649bd(0x2d4)+_0x34f6f6+':',_0x4f0389);}const _0x4e53b6=_0xb7e067['amountUSDT']*(0x1-_0x5322b6/0x64);_0x5a600d=-_0x4e53b6,_0x1202f0-=_0x4e53b6,console[_0x1649bd(0x2f6)]('\x20\x20\x20Full\x20amount:\x20'+_0xb7e067['amountUSDT'][_0x1649bd(0x2b0)](0x6)+_0x1649bd(0x292)),console['log']('\x20\x20\x20Gateway:\x20'+_0xb7e067[_0x1649bd(0x2b6)]+_0x1649bd(0x315)+_0x5322b6+'%'),console[_0x1649bd(0x2f6)]('\x20\x20\x20Merchant\x20loses:\x20'+_0x4e53b6['toFixed'](0x6)+_0x1649bd(0x33c)+_0x5322b6+_0x1649bd(0x281)),console[_0x1649bd(0x2f6)](_0x1649bd(0x2a0)+_0x4e53b6['toFixed'](0x6)+_0x1649bd(0x292));}}}_0xe7111f===_0x1649bd(0x257)&&(console[_0x1649bd(0x2f6)](_0x1649bd(0x2a8)),_0x9d98c4&&_0x9d98c4>0x0?(_0x5a600d=-_0x9d98c4,_0x1202f0-=_0x9d98c4,console['log']('ðŸ’¸\x20CHARGEBACK\x20penalty\x20ONLY:\x20-'+_0x9d98c4['toFixed'](0x6)+_0x1649bd(0x297)),console['log'](_0x1649bd(0x2b3))):console[_0x1649bd(0x2f6)](_0x1649bd(0x33a)),_0x3ec3ff[_0x1649bd(0x27c)]=_0x9d98c4||0x0);_0xe7111f===_0x1649bd(0x221)&&_0x5bbf01===_0x1649bd(0x2df)&&console[_0x1649bd(0x2f6)](_0x1649bd(0x1fa));const _0x2b003f=await _0x575484[_0x1649bd(0x228)]['update']({'where':{'id':_0x34f6f6},'data':_0x3ec3ff,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x5a600d!==0x0&&(await _0x575484[_0x1649bd(0x241)]['update']({'where':{'id':_0xb7e067[_0x1649bd(0x316)]},'data':{'balance':_0x1202f0}}),console['log'](_0x1649bd(0x2e3)+_0xb7e067[_0x1649bd(0x316)]+'\x20balance\x20updated:\x20'+_0xb7e067[_0x1649bd(0x241)]['balance'][_0x1649bd(0x2b0)](0x6)+_0x1649bd(0x229)+_0x1202f0[_0x1649bd(0x2b0)](0x6)+'\x20USDT\x20('+(_0x5a600d>0x0?'+':'')+_0x5a600d['toFixed'](0x6)+')')),_0x2b003f;});return{'id':_0x211f9f['id'],'shopId':_0x211f9f[_0x18adc1(0x316)],'gateway':_0x211f9f[_0x18adc1(0x2b6)],'amount':_0x211f9f['amount'],'currency':_0x211f9f[_0x18adc1(0x1fc)],'status':_0x211f9f['status'],'orderId':_0x211f9f['orderId'],'gatewayOrderId':_0x211f9f[_0x18adc1(0x27b)],'customerEmail':_0x211f9f[_0x18adc1(0x2e6)],'customerName':_0x211f9f[_0x18adc1(0x289)],'customerCountry':_0x211f9f[_0x18adc1(0x1ea)],'customerIp':_0x211f9f[_0x18adc1(0x210)],'customerUa':_0x211f9f['customerUa'],'failureMessage':_0x211f9f[_0x18adc1(0x2cd)],'adminNotes':_0x211f9f[_0x18adc1(0x336)],'chargebackAmount':_0x211f9f[_0x18adc1(0x27c)],'statusChangedBy':_0x211f9f[_0x18adc1(0x21e)],'statusChangedAt':_0x211f9f[_0x18adc1(0x240)],'createdAt':_0x211f9f[_0x18adc1(0x237)],'updatedAt':_0x211f9f[_0x18adc1(0x1f8)],'shop':_0x211f9f[_0x18adc1(0x241)]};}async['updateUser'](_0x4baa49,_0x486cfb){const _0x2c6a90=a46_0x42f014,_0x3de42c=Math[_0x2c6a90(0x264)]()['toString'](0x24)['substr'](0x2,0x9);console[_0x2c6a90(0x2f6)](_0x2c6a90(0x255)+_0x3de42c+',\x20userId:\x20'+_0x4baa49);const _0x41e769={..._0x486cfb};_0x486cfb[_0x2c6a90(0x2fc)]&&_0x486cfb[_0x2c6a90(0x2fc)]['trim']()!==''?(console[_0x2c6a90(0x2f6)]('ðŸ”\x20['+_0x3de42c+_0x2c6a90(0x1fd)+_0x4baa49),_0x41e769[_0x2c6a90(0x2fc)]=await bcryptjs_1[_0x2c6a90(0x2ce)][_0x2c6a90(0x319)](_0x486cfb[_0x2c6a90(0x2fc)],0xc)):(console[_0x2c6a90(0x2f6)](_0x2c6a90(0x31a)+_0x3de42c+_0x2c6a90(0x2bf)),delete _0x41e769[_0x2c6a90(0x2fc)]);_0x486cfb[_0x2c6a90(0x231)]&&(_0x41e769[_0x2c6a90(0x2f0)]=_0x486cfb[_0x2c6a90(0x231)],delete _0x41e769[_0x2c6a90(0x231)]);_0x486cfb['telegramId']&&(_0x41e769[_0x2c6a90(0x2da)]=_0x486cfb[_0x2c6a90(0x235)],delete _0x41e769[_0x2c6a90(0x235)]);_0x486cfb['merchantUrl']&&(_0x41e769[_0x2c6a90(0x32b)]=_0x486cfb['merchantUrl'],delete _0x41e769[_0x2c6a90(0x249)]);if(_0x486cfb[_0x2c6a90(0x285)]){const _0x64759d=_0x486cfb['gateways']['map'](_0x3baf7e=>this['getGatewayInternalName'](_0x3baf7e));console[_0x2c6a90(0x2f6)](_0x2c6a90(0x2fd),_0x486cfb['gateways'],'->',_0x64759d),_0x41e769[_0x2c6a90(0x2a5)]=JSON[_0x2c6a90(0x1e2)](_0x64759d),delete _0x41e769[_0x2c6a90(0x285)];}_0x486cfb['gatewaySettings']&&(console[_0x2c6a90(0x2f6)](_0x2c6a90(0x333)+_0x3de42c+_0x2c6a90(0x2d7),_0x486cfb[_0x2c6a90(0x2a4)]),_0x41e769['gatewaySettings']=JSON[_0x2c6a90(0x1e2)](_0x486cfb['gatewaySettings']),console[_0x2c6a90(0x2f6)](_0x2c6a90(0x333)+_0x3de42c+']\x20Gateway\x20settings\x20JSON\x20string:',_0x41e769[_0x2c6a90(0x2a4)]));_0x486cfb[_0x2c6a90(0x242)]&&(_0x486cfb[_0x2c6a90(0x242)][_0x2c6a90(0x2f1)]!==undefined&&(_0x41e769[_0x2c6a90(0x2f1)]=_0x486cfb[_0x2c6a90(0x242)][_0x2c6a90(0x2f1)]||null),_0x486cfb[_0x2c6a90(0x242)][_0x2c6a90(0x306)]!==undefined&&(_0x41e769[_0x2c6a90(0x306)]=_0x486cfb[_0x2c6a90(0x242)]['usdtTrcWallet']||null),_0x486cfb[_0x2c6a90(0x242)][_0x2c6a90(0x1e3)]!==undefined&&(_0x41e769[_0x2c6a90(0x1e3)]=_0x486cfb[_0x2c6a90(0x242)][_0x2c6a90(0x1e3)]||null),_0x486cfb[_0x2c6a90(0x242)][_0x2c6a90(0x24b)]!==undefined&&(_0x41e769[_0x2c6a90(0x24b)]=_0x486cfb['wallets']['usdcPolygonWallet']||null),delete _0x41e769[_0x2c6a90(0x242)]);const _0x3943e9=await database_1[_0x2c6a90(0x2ce)]['shop']['update']({'where':{'id':_0x4baa49},'data':_0x41e769,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0x2c6a90(0x2f6)](_0x2c6a90(0x1ee)+_0x3de42c+_0x2c6a90(0x250),_0x3943e9[_0x2c6a90(0x2a4)]),{'id':_0x3943e9['id'],'fullName':_0x3943e9[_0x2c6a90(0x2f0)],'username':_0x3943e9[_0x2c6a90(0x323)],'telegramId':_0x3943e9[_0x2c6a90(0x2da)],'merchantUrl':_0x3943e9[_0x2c6a90(0x32b)],'gateways':_0x3943e9['paymentGateways']?JSON[_0x2c6a90(0x219)](_0x3943e9[_0x2c6a90(0x2a5)]):null,'gatewaySettings':_0x3943e9[_0x2c6a90(0x2a4)]?JSON[_0x2c6a90(0x219)](_0x3943e9['gatewaySettings']):null,'publicKey':_0x3943e9['publicKey'],'wallets':{'usdtPolygonWallet':_0x3943e9[_0x2c6a90(0x2f1)],'usdtTrcWallet':_0x3943e9[_0x2c6a90(0x306)],'usdtErcWallet':_0x3943e9[_0x2c6a90(0x1e3)],'usdcPolygonWallet':_0x3943e9[_0x2c6a90(0x24b)]},'status':_0x3943e9[_0x2c6a90(0x2ae)],'createdAt':_0x3943e9['createdAt']};}async[a46_0x42f014(0x222)](_0x2b76d0){const _0x579baf=a46_0x42f014,_0x5a01a4=await database_1['default'][_0x579baf(0x241)]['update']({'where':{'id':_0x2b76d0},'data':{'status':'SUSPENDED'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x5a01a4['id'],'fullName':_0x5a01a4['name'],'username':_0x5a01a4[_0x579baf(0x323)],'telegramId':_0x5a01a4[_0x579baf(0x2da)],'merchantUrl':_0x5a01a4[_0x579baf(0x32b)],'gateways':_0x5a01a4['paymentGateways']?JSON[_0x579baf(0x219)](_0x5a01a4[_0x579baf(0x2a5)]):null,'gatewaySettings':_0x5a01a4[_0x579baf(0x2a4)]?JSON[_0x579baf(0x219)](_0x5a01a4[_0x579baf(0x2a4)]):null,'publicKey':_0x5a01a4[_0x579baf(0x274)],'wallets':{'usdtPolygonWallet':_0x5a01a4[_0x579baf(0x2f1)],'usdtTrcWallet':_0x5a01a4[_0x579baf(0x306)],'usdtErcWallet':_0x5a01a4[_0x579baf(0x1e3)],'usdcPolygonWallet':_0x5a01a4[_0x579baf(0x24b)]},'status':_0x5a01a4[_0x579baf(0x2ae)],'createdAt':_0x5a01a4['createdAt']};}async[a46_0x42f014(0x332)](_0x392103){const _0x35dc8f=a46_0x42f014,_0x266115=await database_1['default']['shop'][_0x35dc8f(0x2b8)]({'where':{'id':_0x392103},'data':{'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x266115['id'],'fullName':_0x266115['name'],'username':_0x266115[_0x35dc8f(0x323)],'telegramId':_0x266115[_0x35dc8f(0x2da)],'merchantUrl':_0x266115['shopUrl'],'gateways':_0x266115[_0x35dc8f(0x2a5)]?JSON['parse'](_0x266115['paymentGateways']):null,'gatewaySettings':_0x266115[_0x35dc8f(0x2a4)]?JSON[_0x35dc8f(0x219)](_0x266115[_0x35dc8f(0x2a4)]):null,'publicKey':_0x266115['publicKey'],'wallets':{'usdtPolygonWallet':_0x266115['usdtPolygonWallet'],'usdtTrcWallet':_0x266115[_0x35dc8f(0x306)],'usdtErcWallet':_0x266115[_0x35dc8f(0x1e3)],'usdcPolygonWallet':_0x266115[_0x35dc8f(0x24b)]},'status':_0x266115[_0x35dc8f(0x2ae)],'createdAt':_0x266115[_0x35dc8f(0x237)]};}async[a46_0x42f014(0x2d9)](_0x21a6cf){const _0x2d04aa=a46_0x42f014,{page:_0x3a6f36,limit:_0x35f176,status:_0x36c034}=_0x21a6cf,_0xb13963=(_0x3a6f36-0x1)*_0x35f176,_0x10c299={};_0x36c034&&(_0x10c299[_0x2d04aa(0x2ae)]=_0x36c034[_0x2d04aa(0x2c8)]());const [_0x23f852,_0x3b7825]=await Promise[_0x2d04aa(0x2ed)]([database_1[_0x2d04aa(0x2ce)][_0x2d04aa(0x241)][_0x2d04aa(0x1f5)]({'where':_0x10c299,'skip':_0xb13963,'take':_0x35f176,'orderBy':{'createdAt':_0x2d04aa(0x32e)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1['default'][_0x2d04aa(0x241)][_0x2d04aa(0x216)]({'where':_0x10c299})]);return{'users':_0x23f852['map'](_0x233b50=>{const _0x45f603=_0x2d04aa,_0x257539=_0x233b50[_0x45f603(0x2a5)]?JSON[_0x45f603(0x219)](_0x233b50[_0x45f603(0x2a5)]):null,_0x94aeef=_0x257539?_0x257539['map'](_0xdb0629=>this[_0x45f603(0x331)](_0xdb0629)):null;return{'id':_0x233b50['id'],'fullName':_0x233b50['name'],'username':_0x233b50[_0x45f603(0x323)],'telegramId':_0x233b50['telegram'],'merchantUrl':_0x233b50['shopUrl'],'gateways':_0x94aeef,'gatewaySettings':_0x233b50[_0x45f603(0x2a4)]?JSON[_0x45f603(0x219)](_0x233b50[_0x45f603(0x2a4)]):null,'publicKey':_0x233b50[_0x45f603(0x274)],'wallets':{'usdtPolygonWallet':_0x233b50['usdtPolygonWallet'],'usdtTrcWallet':_0x233b50[_0x45f603(0x306)],'usdtErcWallet':_0x233b50[_0x45f603(0x1e3)],'usdcPolygonWallet':_0x233b50['usdcPolygonWallet']},'status':_0x233b50['status'],'createdAt':_0x233b50[_0x45f603(0x237)]};}),'pagination':{'page':_0x3a6f36,'limit':_0x35f176,'total':_0x3b7825,'totalPages':Math[_0x2d04aa(0x2db)](_0x3b7825/_0x35f176)}};}async[a46_0x42f014(0x2ba)](_0x2c7a11){const _0x3b0b24=a46_0x42f014,_0x33f31f=await database_1['default'][_0x3b0b24(0x241)][_0x3b0b24(0x312)]({'where':{'id':_0x2c7a11},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x33f31f)return null;const _0x4ff00c=_0x33f31f['paymentGateways']?JSON[_0x3b0b24(0x219)](_0x33f31f['paymentGateways']):null,_0xdd0a0a=_0x4ff00c?_0x4ff00c['map'](_0x4c8e52=>this[_0x3b0b24(0x331)](_0x4c8e52)):null;return _0x4ff00c&&_0xdd0a0a&&console['log'](_0x3b0b24(0x327),_0x4ff00c,'->',_0xdd0a0a),{'id':_0x33f31f['id'],'fullName':_0x33f31f['name'],'username':_0x33f31f['username'],'telegramId':_0x33f31f['telegram'],'merchantUrl':_0x33f31f[_0x3b0b24(0x32b)],'gateways':_0xdd0a0a,'gatewaySettings':_0x33f31f[_0x3b0b24(0x2a4)]?JSON[_0x3b0b24(0x219)](_0x33f31f[_0x3b0b24(0x2a4)]):null,'publicKey':_0x33f31f[_0x3b0b24(0x274)],'wallets':{'usdtPolygonWallet':_0x33f31f[_0x3b0b24(0x2f1)],'usdtTrcWallet':_0x33f31f['usdtTrcWallet'],'usdtErcWallet':_0x33f31f['usdtErcWallet'],'usdcPolygonWallet':_0x33f31f[_0x3b0b24(0x24b)]},'status':_0x33f31f[_0x3b0b24(0x2ae)],'createdAt':_0x33f31f[_0x3b0b24(0x237)]};}async[a46_0x42f014(0x2fe)](_0x1087d9){const _0x509829=a46_0x42f014,{fullName:_0x4af971,username:_0x4e5e1c,password:_0x5c7697,telegramId:_0x2b6916,merchantUrl:_0xf871c5,gateways:_0x276a61,gatewaySettings:_0x3b030d,wallets:_0x136c3e}=_0x1087d9,_0x36c0f2=await database_1[_0x509829(0x2ce)][_0x509829(0x241)][_0x509829(0x312)]({'where':{'username':_0x4e5e1c}});if(_0x36c0f2)throw new Error('Username\x20already\x20exists');if(_0x2b6916){const _0xdc7262=await database_1['default'][_0x509829(0x241)]['findUnique']({'where':{'telegram':_0x2b6916}});if(_0xdc7262)throw new Error(_0x509829(0x296));}const _0x5a1fb0=await bcryptjs_1['default'][_0x509829(0x319)](_0x5c7697,0xc),_0x490570=_0x509829(0x272)+crypto_1[_0x509829(0x2ce)][_0x509829(0x25e)](0x20)['toString'](_0x509829(0x265)),_0x4d6a25=_0x509829(0x23e)+crypto_1[_0x509829(0x2ce)]['randomBytes'](0x20)[_0x509829(0x1dc)]('hex'),_0x4bd091=_0x276a61?_0x276a61['map'](_0x17d97b=>this['getGatewayInternalName'](_0x17d97b)):null;_0x276a61&&_0x4bd091&&console[_0x509829(0x2f6)]('ðŸ”„\x20Gateway\x20mapping\x20(create):',_0x276a61,'->',_0x4bd091);const _0x2b3757=await database_1[_0x509829(0x2ce)]['shop']['create']({'data':{'name':_0x4af971,'username':_0x4e5e1c,'password':_0x5a1fb0,'telegram':_0x2b6916,'shopUrl':_0xf871c5,'paymentGateways':_0x4bd091?JSON['stringify'](_0x4bd091):null,'gatewaySettings':_0x3b030d?JSON[_0x509829(0x1e2)](_0x3b030d):null,'usdtPolygonWallet':_0x136c3e?.[_0x509829(0x2f1)]||null,'usdtTrcWallet':_0x136c3e?.[_0x509829(0x306)]||null,'usdtErcWallet':_0x136c3e?.[_0x509829(0x1e3)]||null,'usdcPolygonWallet':_0x136c3e?.['usdcPolygonWallet']||null,'publicKey':_0x490570,'secretKey':_0x4d6a25,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2b3757['id'],'fullName':_0x2b3757[_0x509829(0x2f0)],'username':_0x2b3757[_0x509829(0x323)],'telegramId':_0x2b3757['telegram'],'merchantUrl':_0x2b3757[_0x509829(0x32b)],'gateways':_0x2b3757[_0x509829(0x2a5)]?JSON[_0x509829(0x219)](_0x2b3757[_0x509829(0x2a5)]):null,'gatewaySettings':_0x2b3757['gatewaySettings']?JSON[_0x509829(0x219)](_0x2b3757[_0x509829(0x2a4)]):null,'publicKey':_0x2b3757[_0x509829(0x274)],'wallets':{'usdtPolygonWallet':_0x2b3757[_0x509829(0x2f1)],'usdtTrcWallet':_0x2b3757[_0x509829(0x306)],'usdtErcWallet':_0x2b3757[_0x509829(0x1e3)],'usdcPolygonWallet':_0x2b3757[_0x509829(0x24b)]},'status':_0x2b3757['status'],'createdAt':_0x2b3757['createdAt']};}async[a46_0x42f014(0x2a9)](_0x2cc745){const _0x59b3ed=a46_0x42f014;await database_1['default'][_0x59b3ed(0x241)]['delete']({'where':{'id':_0x2cc745}});}[a46_0x42f014(0x273)](_0x47b76d,_0x144579,_0x327ab2){const _0x2edbd3=a46_0x42f014,_0x4f763f=new Map(),_0x5d3e6a=new Date(_0x144579);while(_0x5d3e6a<=_0x327ab2){const _0x4e78bf=_0x5d3e6a[_0x2edbd3(0x271)]()[_0x2edbd3(0x2bb)]('T')[0x0];_0x4f763f[_0x2edbd3(0x2bd)](_0x4e78bf,{'revenue':0x0,'count':0x0}),_0x5d3e6a[_0x2edbd3(0x203)](_0x5d3e6a[_0x2edbd3(0x1fe)]()+0x1);}for(const _0x1bacc8 of _0x47b76d){const _0x324648=_0x1bacc8['createdAt'][_0x2edbd3(0x271)]()[_0x2edbd3(0x2bb)]('T')[0x0],_0x327482=_0x4f763f[_0x2edbd3(0x279)](_0x324648);_0x327482&&(_0x327482['count']+=0x1,_0x1bacc8[_0x2edbd3(0x2ae)]===_0x2edbd3(0x2df)&&(_0x1bacc8[_0x2edbd3(0x243)]?_0x327482[_0x2edbd3(0x2a3)]+=_0x1bacc8[_0x2edbd3(0x243)]:console[_0x2edbd3(0x2f6)]('âš ï¸\x20Payment\x20'+_0x1bacc8['id']+_0x2edbd3(0x2de))));}const _0x10975a=[],_0x126f10=[];for(const [_0x56bf06,_0x3bc0fa]of _0x4f763f){_0x10975a[_0x2edbd3(0x1f9)]({'date':_0x56bf06,'amount':Math[_0x2edbd3(0x307)](_0x3bc0fa[_0x2edbd3(0x2a3)]*0x64)/0x64}),_0x126f10[_0x2edbd3(0x1f9)]({'date':_0x56bf06,'count':_0x3bc0fa['count']});}return{'dailyRevenue':_0x10975a,'dailyPayments':_0x126f10};}}exports[a46_0x42f014(0x24d)]=AdminService;