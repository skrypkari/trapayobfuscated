'use strict';const a33_0x52b3ed=a33_0x18f6;(function(_0xa70df1,_0x4aec9b){const _0x69dd5d=a33_0x18f6,_0x41afd6=_0xa70df1();while(!![]){try{const _0x437b53=parseInt(_0x69dd5d(0x1dc))/0x1*(parseInt(_0x69dd5d(0x252))/0x2)+-parseInt(_0x69dd5d(0x21c))/0x3+parseInt(_0x69dd5d(0x25c))/0x4+-parseInt(_0x69dd5d(0x22d))/0x5*(parseInt(_0x69dd5d(0x1b6))/0x6)+-parseInt(_0x69dd5d(0x19f))/0x7*(-parseInt(_0x69dd5d(0x1cc))/0x8)+-parseInt(_0x69dd5d(0x1e3))/0x9+parseInt(_0x69dd5d(0x234))/0xa;if(_0x437b53===_0x4aec9b)break;else _0x41afd6['push'](_0x41afd6['shift']());}catch(_0x202c57){_0x41afd6['push'](_0x41afd6['shift']());}}}(a33_0x32a3,0xb1f62));var __importDefault=this&&this[a33_0x52b3ed(0x1ef)]||function(_0x220a2b){return _0x220a2b&&_0x220a2b['__esModule']?_0x220a2b:{'default':_0x220a2b};};Object[a33_0x52b3ed(0x21d)](exports,a33_0x52b3ed(0x185),{'value':!![]}),exports[a33_0x52b3ed(0x1a9)]=void 0x0;function a33_0x18f6(_0x561bac,_0x3519c4){const _0x32a307=a33_0x32a3();return a33_0x18f6=function(_0x18f6a2,_0x351eea){_0x18f6a2=_0x18f6a2-0x184;let _0x50daa0=_0x32a307[_0x18f6a2];return _0x50daa0;},a33_0x18f6(_0x561bac,_0x3519c4);}function a33_0x32a3(){const _0x1e4e5d=['asc','$queryRaw','includes','findUnique','merchantPaid','default','insensitive','suspendUser','📋\x20Getting\x20payouts\x20with\x20filters:','\x20payouts\x20out\x20of\x20','./telegramBotService','cardLast4','txid','count','EXPIRED','parse','has','toLowerCase','usdtPolygonWallet','totalAmountAfterCommissionUSDT','payments','calculateAmountAfterCommission','activateUser','commission','../config/database','getDate','2360355ShnDry','defineProperty','ACTIVE','sourceCurrency','SUSPENDED','gatewaySettings','paidAt','gatewayPaymentId','size','getUserById','🔄\x20Admin\x20updating\x20payment\x20','statusChangedBy','User\x20is\x20already\x20suspended','\x20payments\x20for\x20revenue\x20calculation\x20(PAID/REFUND/CHARGEBACK)','sort','remitterIban','getFullYear','100cgYguf','reduce','Payout\x20not\x20found','\x20USDT\x20(только\x20PAID\x20платежи)','customerName','adminNotes','\x20merchants\x20with\x20eligible\x20PAID\x20payments','2407970sQZMxf','✅\x20Returning\x20','\x20payments\x20out\x20of\x20','🏪\x20Found\x20','shopUrl','charAt','Shop\x20is\x20not\x20active','\x20USDT','📋\x20Getting\x20payments\x20with\x20filters:','💸\x20Total\x20Payout:\x20','🔍\x20Getting\x20payment\x20by\x20ID:\x20','push','payout','\x20to\x20','log',',\x20amount:\x20','gatewayOrderId','payment','amountAfterCommissionUSDT','💸\x20Chargeback\x20amount:\x20','desc','update','📈\x20Average\x20payment:\x20','usdtTrcWallet','expiresAt','status','date','📊\x20Generating\x20admin\x20statistics\x20for\x20period:\x20','amount','❌\x20Payment\x20not\x20found:\x20','385032AUsxIb','name','getAllPayments','Payment\x20not\x20found','updatedAt','💳\x20Total\x20payments:\x20','isEligibleForPayout','publicKey','ceil','totalAmountUSDT','5686448HaYTvo','PENDING','paymentMethod','availableBalance','__esModule','📊\x20Calculating\x20admin\x20payout\x20statistics...','currency','toUpperCase','\x20USDT\x20via\x20','entries','✅\x20Admin\x20statistics\x20generated\x20successfully','webhookLogs','✅\x20Payout\x20statistics\x20calculated:','toISOString','PAID','remitterName','\x20USDT\x20(penalty\x20amount)','getPeriodDays','REFUND','convertToUSDT','admin_status_update','getGatewaySettings','paymentGateways','💵\x20Total\x20revenue:\x20','👥\x20Total\x20users:\x20','chargebackAmount','findMany','90d','admin','customerEmail','7ggShWa','✅\x20User\x20','📋\x20Getting\x20users\x20with\x20filters:','⏳\x20Awaiting\x20Payout:\x20','totalPayout','../types/gateway','./userService','usdcPolygonWallet','\x20USDT\x20(will\x20be\x20deducted\x20from\x20merchant\x20balance)','error','AdminService','awaitingPayout','usage','gte','🚫\x20Suspending\x20user:\x20','\x20users\x20out\x20of\x20','CHARGEBACK','\x20USDT\x20(включая\x20штрафы\x20chargeback)','📅\x20Processing\x20daily\x20stats\x20for\x20','💰\x20Total\x20amount:\x20','delete','✅\x20Payment\x20','getAllUsers','41934yuuxoe','User\x20not\x20found','generateDateRange','getMonth','create','🔄\x20Marking\x20payments\x20as\x20paid\x20out\x20for\x20shop\x20','gateway','\x20deleted\x20successfully','usdtErcWallet','notes','updatePaymentStatus','updateUser','💰\x20Found\x20','getGatewayNameById','markPaymentsAsPaidOut','payoutDelay','getTime','get','💰\x20Available\x20Balance:\x20','\x20total','\x20days)','sendPayoutNotification','5586584ziJwrK','🔍\x20Getting\x20payout\x20by\x20ID:\x20','getMerchantsAwaitingPayout','./currencyService','🗑️\x20Deleting\x20payout:\x20','\x20status\x20to:\x20','userService','📊\x20Found\x20','toFixed','network','shop','📊\x20Daily\x20revenue\x20entries:\x20','getPaymentById','bankId','📅\x20This\x20Month:\x20','\x20payments\x20as\x20paid\x20out','3dQirsw','\x20merchants\x20out\x20of\x20','Chargeback\x20amount\x20is\x20required\x20and\x20must\x20be\x20positive\x20(amount\x20in\x20USDT)','Invalid\x20status.\x20Valid\x20statuses:\x20','statusChangedAt','lte','setDate','11545065VuhDma','deleteUser','set','split','✅\x20Payout\x20created\x20successfully:\x20','map','\x20activated\x20successfully','\x20USDT\x20(','length','webhookLog','createdAt','amountUSDT','__importDefault','join','externalPaymentUrl','\x20USDT\x20after\x20commission)','📋\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','getSystemStatistics','isValidGatewayId','telegram','shopId','createUser','✅\x20Found\x20payment:\x20','FAILED','currencyService','round','username','abs','calculateEffectiveAmount','all','orderId'];a33_0x32a3=function(){return _0x1e4e5d;};return a33_0x32a3();}const database_1=__importDefault(require(a33_0x52b3ed(0x21a))),currencyService_1=require(a33_0x52b3ed(0x1cf)),userService_1=require(a33_0x52b3ed(0x1a5)),telegramBotService_1=require(a33_0x52b3ed(0x20c)),gateway_1=require(a33_0x52b3ed(0x1a4));class AdminService{constructor(){const _0x223d5d=a33_0x52b3ed;this[_0x223d5d(0x1d2)]=new userService_1['UserService']();}[a33_0x52b3ed(0x192)](_0x208140){const _0x2b1d2c=a33_0x52b3ed;switch(_0x208140){case'7d':return 0x7;case'30d':return 0x1e;case _0x2b1d2c(0x19c):return 0x5a;case'1y':return 0x16d;default:return 0x1e;}}[a33_0x52b3ed(0x1b8)](_0x49ac89,_0x457456){const _0x225864=a33_0x52b3ed,_0x3cd97f=[],_0x3a9aaa=new Date(_0x49ac89);while(_0x3a9aaa<=_0x457456){_0x3cd97f[_0x225864(0x23f)](_0x3a9aaa[_0x225864(0x18e)]()[_0x225864(0x1e6)]('T')[0x0]),_0x3a9aaa[_0x225864(0x1e2)](_0x3a9aaa[_0x225864(0x21b)]()+0x1);}return _0x3cd97f;}[a33_0x52b3ed(0x196)](_0x1fa3a9,_0x46a14d){const _0x582477=a33_0x52b3ed;if(!_0x1fa3a9[_0x582477(0x221)])return{'commission':0x0,'payoutDelay':0x0};try{const _0x36b31f=JSON[_0x582477(0x211)](_0x1fa3a9[_0x582477(0x221)]),_0x4e4a12=_0x46a14d[_0x582477(0x239)](0x0)[_0x582477(0x188)]()+_0x46a14d['slice'](0x1)[_0x582477(0x213)]();if(_0x36b31f&&_0x36b31f[_0x4e4a12])return{'commission':_0x36b31f[_0x4e4a12][_0x582477(0x219)]||0x0,'payoutDelay':_0x36b31f[_0x4e4a12][_0x582477(0x1c5)]||0x0};}catch(_0x50e5be){console[_0x582477(0x1a8)]('Error\x20parsing\x20gateway\x20settings:',_0x50e5be);}return{'commission':0x0,'payoutDelay':0x0};}[a33_0x52b3ed(0x258)](_0x6f0ae2){const _0x3813f8=a33_0x52b3ed;if(_0x6f0ae2[_0x3813f8(0x24d)]!==_0x3813f8(0x18f)||_0x6f0ae2[_0x3813f8(0x206)]||!_0x6f0ae2[_0x3813f8(0x222)])return![];const _0x458852=this[_0x3813f8(0x196)](_0x6f0ae2['shop'],_0x6f0ae2[_0x3813f8(0x1bc)]),_0x221d0f=_0x458852[_0x3813f8(0x1c5)]*0x18*0x3c*0x3c*0x3e8,_0x51357f=new Date(_0x6f0ae2['paidAt'][_0x3813f8(0x1c6)]()+_0x221d0f);return new Date()>_0x51357f;}[a33_0x52b3ed(0x217)](_0x9ae390,_0x21a6c0){return _0x9ae390*(0x1-_0x21a6c0/0x64);}[a33_0x52b3ed(0x1ff)](_0x1de6c9){const _0x520247=a33_0x52b3ed;switch(_0x1de6c9[_0x520247(0x24d)]){case _0x520247(0x18f):return _0x1de6c9[_0x520247(0x250)];case'CHARGEBACK':return-(_0x1de6c9[_0x520247(0x19a)]||0x0);case _0x520247(0x193):return 0x0;default:return 0x0;}}async['createPayout'](_0x4a5797){const _0x57161a=a33_0x52b3ed,{shopId:_0x5e8a76,amount:_0x4f2e95,network:_0x4cedde,notes:_0x2a98dc}=_0x4a5797;console[_0x57161a(0x242)]('💸\x20Creating\x20payout\x20for\x20shop\x20'+_0x5e8a76+':\x20'+_0x4f2e95+_0x57161a(0x189)+_0x4cedde);const _0x176956=await database_1[_0x57161a(0x207)][_0x57161a(0x1d6)][_0x57161a(0x205)]({'where':{'id':_0x5e8a76},'select':{'id':!![],'name':!![],'username':!![],'status':!![]}});if(!_0x176956)throw new Error('Shop\x20not\x20found');if(_0x176956[_0x57161a(0x24d)]!==_0x57161a(0x21e))throw new Error(_0x57161a(0x23a));const _0x3dd324=await database_1['default'][_0x57161a(0x240)][_0x57161a(0x1ba)]({'data':{'shopId':_0x5e8a76,'amount':_0x4f2e95,'network':_0x4cedde,'status':'COMPLETED','notes':_0x2a98dc||null,'paidAt':new Date()},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});await this[_0x57161a(0x1c4)](_0x5e8a76,_0x4f2e95);try{await telegramBotService_1['telegramBotService'][_0x57161a(0x1cb)](_0x5e8a76,_0x3dd324,'completed');}catch(_0x1754ed){console['error']('Failed\x20to\x20send\x20Telegram\x20payout\x20notification:',_0x1754ed);}return console['log'](_0x57161a(0x1e7)+_0x3dd324['id']),{'id':_0x3dd324['id'],'shopId':_0x3dd324['shopId'],'shopName':_0x3dd324[_0x57161a(0x1d6)][_0x57161a(0x253)],'shopUsername':_0x3dd324[_0x57161a(0x1d6)]['username'],'amount':_0x3dd324['amount'],'network':_0x3dd324[_0x57161a(0x1d5)],'status':_0x3dd324[_0x57161a(0x24d)],'txid':_0x3dd324[_0x57161a(0x20e)],'notes':_0x3dd324[_0x57161a(0x1bf)],'createdAt':_0x3dd324['createdAt'],'paidAt':_0x3dd324[_0x57161a(0x222)]};}async[a33_0x52b3ed(0x1c4)](_0x58763b,_0xeceb23){const _0x317d1e=a33_0x52b3ed;console[_0x317d1e(0x242)](_0x317d1e(0x1bb)+_0x58763b+_0x317d1e(0x243)+_0xeceb23+_0x317d1e(0x23b));const _0x3ca03a=await database_1[_0x317d1e(0x207)][_0x317d1e(0x245)][_0x317d1e(0x19b)]({'where':{'shopId':_0x58763b,'status':_0x317d1e(0x18f),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'shop':{'select':{'gatewaySettings':!![]}}},'orderBy':{'paidAt':_0x317d1e(0x202)}});let _0x223acd=_0xeceb23;const _0x1d1374=[];for(const _0x548c48 of _0x3ca03a){const _0x192977={..._0x548c48,'status':_0x317d1e(0x18f),'merchantPaid':![],'shop':{'gatewaySettings':_0x548c48[_0x317d1e(0x1d6)][_0x317d1e(0x221)]}};if(!this[_0x317d1e(0x258)](_0x192977))continue;const _0x139236=await currencyService_1[_0x317d1e(0x1fb)][_0x317d1e(0x194)](_0x548c48[_0x317d1e(0x250)],_0x548c48[_0x317d1e(0x187)]),_0x571213=this[_0x317d1e(0x196)](_0x548c48[_0x317d1e(0x1d6)],_0x548c48[_0x317d1e(0x1bc)]),_0x47cecf=this[_0x317d1e(0x217)](_0x139236,_0x571213[_0x317d1e(0x219)]);if(_0x47cecf<=_0x223acd){_0x1d1374[_0x317d1e(0x23f)](_0x548c48['id']),_0x223acd-=_0x47cecf;if(_0x223acd<=0.01)break;}}_0x1d1374[_0x317d1e(0x1eb)]>0x0&&(await database_1[_0x317d1e(0x207)]['payment']['updateMany']({'where':{'id':{'in':_0x1d1374}},'data':{'merchantPaid':!![]}}),console[_0x317d1e(0x242)]('✅\x20Marked\x20'+_0x1d1374[_0x317d1e(0x1eb)]+_0x317d1e(0x1db)));}async['getAllPayouts'](_0x37fd0e){const _0x433390=a33_0x52b3ed,{page:_0x2bd62e,limit:_0x3aaeb1,shopId:_0x31a75d,network:_0x4b1de3,dateFrom:_0x5e20f7,dateTo:_0x3dc1ae,search:_0x33c2d2}=_0x37fd0e,_0x45d26=(_0x2bd62e-0x1)*_0x3aaeb1;console[_0x433390(0x242)](_0x433390(0x20a),_0x37fd0e);const _0xdb680b={};_0x31a75d&&(_0xdb680b[_0x433390(0x1f7)]=_0x31a75d);_0x4b1de3&&(_0xdb680b[_0x433390(0x1d5)]=_0x4b1de3);(_0x5e20f7||_0x3dc1ae)&&(_0xdb680b[_0x433390(0x1ed)]={},_0x5e20f7&&(_0xdb680b[_0x433390(0x1ed)][_0x433390(0x1ac)]=new Date(_0x5e20f7)),_0x3dc1ae&&(_0xdb680b[_0x433390(0x1ed)][_0x433390(0x1e1)]=new Date(_0x3dc1ae)));_0x33c2d2&&(_0xdb680b['OR']=[{'txid':{'contains':_0x33c2d2,'mode':_0x433390(0x208)}},{'notes':{'contains':_0x33c2d2,'mode':_0x433390(0x208)}},{'shop':{'name':{'contains':_0x33c2d2,'mode':_0x433390(0x208)}}},{'shop':{'username':{'contains':_0x33c2d2,'mode':_0x433390(0x208)}}}]);const [_0x294ff4,_0x4de875]=await Promise[_0x433390(0x200)]([database_1['default']['payout']['findMany']({'where':_0xdb680b,'skip':_0x45d26,'take':_0x3aaeb1,'orderBy':{'createdAt':_0x433390(0x248)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x433390(0x207)][_0x433390(0x240)][_0x433390(0x20f)]({'where':_0xdb680b})]);console[_0x433390(0x242)](_0x433390(0x1d3)+_0x294ff4[_0x433390(0x1eb)]+_0x433390(0x20b)+_0x4de875+_0x433390(0x1c9));const _0x32ee08=_0x294ff4[_0x433390(0x1e8)](_0xf70050=>({'id':_0xf70050['id'],'shopId':_0xf70050[_0x433390(0x1f7)],'shopName':_0xf70050[_0x433390(0x1d6)]['name'],'shopUsername':_0xf70050[_0x433390(0x1d6)][_0x433390(0x1fd)],'amount':_0xf70050[_0x433390(0x250)],'network':_0xf70050[_0x433390(0x1d5)],'status':_0xf70050[_0x433390(0x24d)],'txid':_0xf70050[_0x433390(0x20e)],'notes':_0xf70050[_0x433390(0x1bf)],'createdAt':_0xf70050['createdAt'],'paidAt':_0xf70050[_0x433390(0x222)]}));return{'payouts':_0x32ee08,'pagination':{'page':_0x2bd62e,'limit':_0x3aaeb1,'total':_0x4de875,'totalPages':Math['ceil'](_0x4de875/_0x3aaeb1)}};}async['getPayoutById'](_0x2fdc1d){const _0x55fe84=a33_0x52b3ed;console[_0x55fe84(0x242)](_0x55fe84(0x1cd)+_0x2fdc1d);const _0xd52a96=await database_1[_0x55fe84(0x207)][_0x55fe84(0x240)][_0x55fe84(0x205)]({'where':{'id':_0x2fdc1d},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0xd52a96)return console[_0x55fe84(0x242)]('❌\x20Payout\x20not\x20found:\x20'+_0x2fdc1d),null;return console['log']('✅\x20Found\x20payout:\x20'+_0xd52a96[_0x55fe84(0x250)]+_0x55fe84(0x189)+_0xd52a96['network']),{'id':_0xd52a96['id'],'shopId':_0xd52a96[_0x55fe84(0x1f7)],'shopName':_0xd52a96[_0x55fe84(0x1d6)][_0x55fe84(0x253)],'shopUsername':_0xd52a96[_0x55fe84(0x1d6)][_0x55fe84(0x1fd)],'amount':_0xd52a96['amount'],'network':_0xd52a96['network'],'status':_0xd52a96['status'],'txid':_0xd52a96['txid'],'notes':_0xd52a96['notes'],'createdAt':_0xd52a96[_0x55fe84(0x1ed)],'paidAt':_0xd52a96[_0x55fe84(0x222)]};}async['deletePayout'](_0x468d53){const _0x336c54=a33_0x52b3ed;console['log'](_0x336c54(0x1d0)+_0x468d53);const _0x3238a2=await database_1[_0x336c54(0x207)][_0x336c54(0x240)][_0x336c54(0x205)]({'where':{'id':_0x468d53},'select':{'id':!![],'shopId':!![],'amount':!![]}});if(!_0x3238a2)throw new Error(_0x336c54(0x22f));await database_1['default'][_0x336c54(0x240)][_0x336c54(0x1b3)]({'where':{'id':_0x468d53}}),console[_0x336c54(0x242)]('✅\x20Payout\x20'+_0x468d53+_0x336c54(0x1bd));}async[a33_0x52b3ed(0x1ce)](_0x149c0b){const _0x7892ce=a33_0x52b3ed,{page:_0x2884f3,limit:_0x33f06b,minAmount:_0xd160c5,search:_0x1d1500}=_0x149c0b;console[_0x7892ce(0x242)](_0x7892ce(0x1f3),_0x149c0b);const _0x37bcd6=await database_1[_0x7892ce(0x207)][_0x7892ce(0x245)][_0x7892ce(0x19b)]({'where':{'status':_0x7892ce(0x18f),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'createdAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'gatewaySettings':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}});console[_0x7892ce(0x242)](_0x7892ce(0x1c2)+_0x37bcd6['length']+'\x20eligible\x20PAID\x20payments\x20for\x20payout\x20analysis');const _0xc6b8d0=new Map();for(const _0x5197d9 of _0x37bcd6){const _0x385b1f={..._0x5197d9,'status':_0x7892ce(0x18f),'merchantPaid':![],'shop':{'gatewaySettings':_0x5197d9[_0x7892ce(0x1d6)][_0x7892ce(0x221)]}},_0x58778f=this[_0x7892ce(0x258)](_0x385b1f);if(!_0x58778f)continue;const _0x52f3bd=await currencyService_1[_0x7892ce(0x1fb)][_0x7892ce(0x194)](_0x5197d9['amount'],_0x5197d9[_0x7892ce(0x187)]),_0x4cf0b2=this['getGatewaySettings'](_0x5197d9['shop'],_0x5197d9['gateway']),_0x1c2a63=this['calculateAmountAfterCommission'](_0x52f3bd,_0x4cf0b2[_0x7892ce(0x219)]),_0x4825c3=_0x5197d9[_0x7892ce(0x1f7)];!_0xc6b8d0[_0x7892ce(0x212)](_0x4825c3)&&_0xc6b8d0[_0x7892ce(0x1e5)](_0x4825c3,{'shop':_0x5197d9[_0x7892ce(0x1d6)],'payments':[]}),_0xc6b8d0['get'](_0x4825c3)['payments'][_0x7892ce(0x23f)]({'id':_0x5197d9['id'],'amount':_0x5197d9[_0x7892ce(0x250)],'currency':_0x5197d9[_0x7892ce(0x187)],'gateway':_0x5197d9['gateway'],'paidAt':_0x5197d9[_0x7892ce(0x222)],'createdAt':_0x5197d9[_0x7892ce(0x1ed)],'amountUSDT':_0x52f3bd,'commission':_0x4cf0b2[_0x7892ce(0x219)],'amountAfterCommissionUSDT':_0x1c2a63,'isEligible':!![]});}console[_0x7892ce(0x242)](_0x7892ce(0x237)+_0xc6b8d0[_0x7892ce(0x224)]+_0x7892ce(0x233));const _0x566d74=[];for(const [_0x3b07b8,_0x22e451]of _0xc6b8d0){const {shop:_0x51f461,payments:_0x35aab4}=_0x22e451,_0x3a7541=_0x35aab4[_0x7892ce(0x22e)]((_0x5b4839,_0x11d88a)=>_0x5b4839+_0x11d88a[_0x7892ce(0x1ee)],0x0),_0x22ad66=_0x35aab4[_0x7892ce(0x22e)]((_0x4e8bf3,_0x1da958)=>_0x4e8bf3+_0x1da958['amountAfterCommissionUSDT'],0x0);if(_0xd160c5&&_0x22ad66<_0xd160c5)continue;if(_0x1d1500){const _0x285082=_0x1d1500[_0x7892ce(0x213)](),_0x54025b=_0x51f461['name'][_0x7892ce(0x213)]()[_0x7892ce(0x204)](_0x285082)||_0x51f461['username'][_0x7892ce(0x213)]()[_0x7892ce(0x204)](_0x285082)||_0x51f461[_0x7892ce(0x1f6)]&&_0x51f461[_0x7892ce(0x1f6)][_0x7892ce(0x213)]()[_0x7892ce(0x204)](_0x285082);if(!_0x54025b)continue;}const _0x54a48b=new Map();for(const _0x24967f of _0x35aab4){const _0x38da0f=_0x24967f[_0x7892ce(0x1bc)];!_0x54a48b[_0x7892ce(0x212)](_0x38da0f)&&_0x54a48b[_0x7892ce(0x1e5)](_0x38da0f,{'count':0x0,'amountUSDT':0x0,'amountAfterCommissionUSDT':0x0,'commission':_0x24967f['commission']});const _0x121f8d=_0x54a48b[_0x7892ce(0x1c7)](_0x38da0f);_0x121f8d[_0x7892ce(0x20f)]++,_0x121f8d[_0x7892ce(0x1ee)]+=_0x24967f[_0x7892ce(0x1ee)],_0x121f8d[_0x7892ce(0x246)]+=_0x24967f[_0x7892ce(0x246)];}const _0x523e8a=Array['from'](_0x54a48b[_0x7892ce(0x18a)]())[_0x7892ce(0x1e8)](([_0x39c7db,_0x571a95])=>({'gateway':_0x39c7db[_0x7892ce(0x239)](0x0)['toUpperCase']()+_0x39c7db['slice'](0x1),'count':_0x571a95[_0x7892ce(0x20f)],'amountUSDT':Math[_0x7892ce(0x1fc)](_0x571a95['amountUSDT']*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x7892ce(0x1fc)](_0x571a95[_0x7892ce(0x246)]*0x64)/0x64,'commission':_0x571a95[_0x7892ce(0x219)]})),_0x45a59b=_0x35aab4[_0x7892ce(0x22e)]((_0x3a1472,_0xabd295)=>{const _0x45f2f6=_0x7892ce;return _0xabd295[_0x45f2f6(0x222)]<_0x3a1472?_0xabd295[_0x45f2f6(0x222)]:_0x3a1472;},_0x35aab4[0x0][_0x7892ce(0x222)]);_0x566d74[_0x7892ce(0x23f)]({'id':_0x51f461['id'],'fullName':_0x51f461[_0x7892ce(0x253)],'username':_0x51f461['username'],'telegramId':_0x51f461[_0x7892ce(0x1f6)],'merchantUrl':_0x51f461['shopUrl'],'wallets':{'usdtPolygonWallet':_0x51f461[_0x7892ce(0x214)],'usdtTrcWallet':_0x51f461['usdtTrcWallet'],'usdtErcWallet':_0x51f461[_0x7892ce(0x1be)],'usdcPolygonWallet':_0x51f461[_0x7892ce(0x1a6)]},'totalAmountUSDT':Math['round'](_0x3a7541*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x7892ce(0x1fc)](_0x22ad66*0x64)/0x64,'paymentsCount':_0x35aab4[_0x7892ce(0x1eb)],'oldestPaymentDate':_0x45a59b,'gatewayBreakdown':_0x523e8a});}_0x566d74[_0x7892ce(0x22a)]((_0x1b0959,_0x14a294)=>_0x14a294[_0x7892ce(0x215)]-_0x1b0959[_0x7892ce(0x215)]);const _0x2844c9=_0x566d74[_0x7892ce(0x1eb)],_0x249cba=_0x566d74[_0x7892ce(0x22e)]((_0x261675,_0x27493d)=>_0x261675+_0x27493d[_0x7892ce(0x25b)],0x0),_0x3a26d9=_0x566d74[_0x7892ce(0x22e)]((_0x380d6c,_0xaadb34)=>_0x380d6c+_0xaadb34[_0x7892ce(0x215)],0x0),_0x2c5d81=(_0x2884f3-0x1)*_0x33f06b,_0x8d2edc=_0x566d74['slice'](_0x2c5d81,_0x2c5d81+_0x33f06b);return console[_0x7892ce(0x242)](_0x7892ce(0x235)+_0x8d2edc[_0x7892ce(0x1eb)]+_0x7892ce(0x1dd)+_0x2844c9+'\x20total'),console['log'](_0x7892ce(0x1b2)+_0x249cba[_0x7892ce(0x1d4)](0x2)+_0x7892ce(0x1ea)+_0x3a26d9[_0x7892ce(0x1d4)](0x2)+_0x7892ce(0x1f2)),{'merchants':_0x8d2edc,'pagination':{'page':_0x2884f3,'limit':_0x33f06b,'total':_0x2844c9,'totalPages':Math[_0x7892ce(0x25a)](_0x2844c9/_0x33f06b)},'summary':{'totalMerchants':_0x2844c9,'totalAmountUSDT':Math[_0x7892ce(0x1fc)](_0x249cba*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x7892ce(0x1fc)](_0x3a26d9*0x64)/0x64}};}async['getPayoutStats'](){const _0x51e876=a33_0x52b3ed;console[_0x51e876(0x242)](_0x51e876(0x186));const _0x4f4465=await database_1[_0x51e876(0x207)][_0x51e876(0x245)][_0x51e876(0x19b)]({'where':{'status':{'in':[_0x51e876(0x18f),_0x51e876(0x193),_0x51e876(0x1af)]}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'status':!![],'gateway':!![],'paidAt':!![],'merchantPaid':!![],'createdAt':!![],'chargebackAmount':!![],'shop':{'select':{'gatewaySettings':!![]}}}});console[_0x51e876(0x242)](_0x51e876(0x1c2)+_0x4f4465[_0x51e876(0x1eb)]+'\x20payments\x20for\x20analysis\x20(PAID/REFUND/CHARGEBACK)');const _0x17e462=new Date(),_0x19a857=new Date(_0x17e462[_0x51e876(0x22c)](),_0x17e462[_0x51e876(0x1b9)](),0x1),_0x1dc318=new Date(_0x17e462[_0x51e876(0x22c)](),_0x17e462[_0x51e876(0x1b9)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7);let _0x48be25=0x0,_0x57a55a=0x0,_0x5c618e=0x0,_0x529950=0x0;for(const _0x21202b of _0x4f4465){const _0x4b6231=this[_0x51e876(0x1ff)](_0x21202b);if(_0x4b6231===0x0)continue;let _0x5ef501,_0x3348f6;if(_0x21202b[_0x51e876(0x24d)]===_0x51e876(0x1af))_0x5ef501=Math['abs'](_0x4b6231),_0x3348f6=-_0x5ef501;else{_0x5ef501=await currencyService_1[_0x51e876(0x1fb)]['convertToUSDT'](_0x21202b[_0x51e876(0x250)],_0x21202b[_0x51e876(0x187)]);const _0x453422=this['getGatewaySettings'](_0x21202b[_0x51e876(0x1d6)],_0x21202b['gateway']);_0x3348f6=this[_0x51e876(0x217)](_0x5ef501,_0x453422[_0x51e876(0x219)]);}_0x21202b[_0x51e876(0x206)]&&(_0x48be25+=_0x3348f6,_0x21202b['paidAt']&&_0x21202b['paidAt']>=_0x19a857&&_0x21202b[_0x51e876(0x222)]<=_0x1dc318&&(_0x5c618e+=_0x3348f6)),_0x21202b[_0x51e876(0x24d)]===_0x51e876(0x18f)&&this[_0x51e876(0x258)](_0x21202b)&&(_0x57a55a+=_0x3348f6,_0x529950+=_0x5ef501);}const _0x4dc103={'totalPayout':Math['round'](_0x48be25*0x64)/0x64,'awaitingPayout':Math['round'](_0x57a55a*0x64)/0x64,'thisMonth':Math['round'](_0x5c618e*0x64)/0x64,'availableBalance':Math[_0x51e876(0x1fc)](_0x529950*0x64)/0x64};return console['log'](_0x51e876(0x18d)),console['log'](_0x51e876(0x23d)+_0x4dc103[_0x51e876(0x1a3)]+'\x20USDT\x20(включая\x20штрафы\x20chargeback)'),console[_0x51e876(0x242)](_0x51e876(0x1a2)+_0x4dc103[_0x51e876(0x1aa)]+_0x51e876(0x230)),console[_0x51e876(0x242)](_0x51e876(0x1da)+_0x4dc103['thisMonth']+'\x20USDT'),console[_0x51e876(0x242)](_0x51e876(0x1c8)+_0x4dc103[_0x51e876(0x184)]+'\x20USDT'),_0x4dc103;}async[a33_0x52b3ed(0x1f4)](_0xcf74a5){const _0x1bfb0e=a33_0x52b3ed,_0x25e907=this[_0x1bfb0e(0x192)](_0xcf74a5),_0x3c35b2=new Date();_0x3c35b2['setDate'](_0x3c35b2['getDate']()-_0x25e907),console[_0x1bfb0e(0x242)](_0x1bfb0e(0x24f)+_0xcf74a5+'\x20('+_0x25e907+_0x1bfb0e(0x1ca));const _0x49eaad=await database_1[_0x1bfb0e(0x207)][_0x1bfb0e(0x1d6)][_0x1bfb0e(0x20f)]({'where':{'status':_0x1bfb0e(0x21e)}}),_0x31e49a=await database_1[_0x1bfb0e(0x207)][_0x1bfb0e(0x245)]['count'](),_0x5e664b=await database_1[_0x1bfb0e(0x207)][_0x1bfb0e(0x245)][_0x1bfb0e(0x19b)]({'where':{'status':{'in':[_0x1bfb0e(0x18f),_0x1bfb0e(0x193),_0x1bfb0e(0x1af)]}},'select':{'amount':!![],'currency':!![],'status':!![],'chargebackAmount':!![],'createdAt':!![]}});console[_0x1bfb0e(0x242)](_0x1bfb0e(0x1c2)+_0x5e664b['length']+_0x1bfb0e(0x229));const _0x36f806=await Promise[_0x1bfb0e(0x200)](_0x5e664b[_0x1bfb0e(0x1e8)](async _0x2529b8=>{const _0xcba1df=_0x1bfb0e,_0xcdddf1=this[_0xcba1df(0x1ff)](_0x2529b8);if(_0xcdddf1===0x0)return{'amount':0x0,'createdAt':_0x2529b8[_0xcba1df(0x1ed)]};let _0x4d64dc;return _0x2529b8[_0xcba1df(0x24d)]===_0xcba1df(0x1af)?_0x4d64dc=-Math['abs'](_0xcdddf1):_0x4d64dc=await currencyService_1[_0xcba1df(0x1fb)][_0xcba1df(0x194)](_0x2529b8[_0xcba1df(0x250)],_0x2529b8[_0xcba1df(0x187)]),{'amount':_0x4d64dc,'createdAt':_0x2529b8[_0xcba1df(0x1ed)]};})),_0x21f153=_0x36f806[_0x1bfb0e(0x22e)]((_0x305ece,_0xcefa53)=>_0x305ece+_0xcefa53['amount'],0x0),_0x2d6e4a=_0x31e49a>0x0?_0x21f153/_0x31e49a:0x0;console[_0x1bfb0e(0x242)](_0x1bfb0e(0x198)+_0x21f153['toFixed'](0x2)+_0x1bfb0e(0x1b0)),console[_0x1bfb0e(0x242)](_0x1bfb0e(0x24a)+_0x2d6e4a[_0x1bfb0e(0x1d4)](0x2)+_0x1bfb0e(0x23b));const _0x28579f=await database_1[_0x1bfb0e(0x207)][_0x1bfb0e(0x203)]`
      SELECT 
        DATE(created_at) as date,
        array_agg(
          json_build_object(
            'amount', amount,
            'currency', currency,
            'status', status,
            'chargeback_amount', chargeback_amount
          )
        ) as payments
      FROM payments 
      WHERE created_at >= ${_0x3c35b2}
        AND status IN ('PAID', 'REFUND', 'CHARGEBACK')
      GROUP BY DATE(created_at)
      ORDER BY date ASC
    `;console[_0x1bfb0e(0x242)](_0x1bfb0e(0x1b1)+_0x28579f[_0x1bfb0e(0x1eb)]+'\x20days');const _0x4d96d7=await Promise[_0x1bfb0e(0x200)](_0x28579f[_0x1bfb0e(0x1e8)](async _0x36e789=>{const _0x1cf5ad=_0x1bfb0e,_0x10033b=await Promise[_0x1cf5ad(0x200)](_0x36e789[_0x1cf5ad(0x216)][_0x1cf5ad(0x1e8)](async _0xff8ec3=>{const _0x20f301=_0x1cf5ad,_0x3e49d2=this[_0x20f301(0x1ff)](_0xff8ec3);if(_0x3e49d2===0x0)return 0x0;return _0xff8ec3['status']==='CHARGEBACK'?-Math[_0x20f301(0x1fe)](_0x3e49d2):await currencyService_1['currencyService'][_0x20f301(0x194)](_0xff8ec3[_0x20f301(0x250)],_0xff8ec3['currency']);})),_0x586b40=_0x10033b[_0x1cf5ad(0x22e)]((_0x12fec9,_0x4cb126)=>_0x12fec9+_0x4cb126,0x0);return{'date':_0x36e789[_0x1cf5ad(0x24e)][_0x1cf5ad(0x18e)]()[_0x1cf5ad(0x1e6)]('T')[0x0],'amount':_0x586b40};})),_0x24f131=this[_0x1bfb0e(0x1b8)](_0x3c35b2,new Date()),_0x296308=new Map(_0x4d96d7[_0x1bfb0e(0x1e8)](_0x84db7e=>[_0x84db7e[_0x1bfb0e(0x24e)],_0x84db7e['amount']])),_0x4573c2=_0x24f131[_0x1bfb0e(0x1e8)](_0x3b5bf4=>({'date':_0x3b5bf4,'amount':_0x296308[_0x1bfb0e(0x1c7)](_0x3b5bf4)||0x0}));return console[_0x1bfb0e(0x242)](_0x1bfb0e(0x18b)),console['log'](_0x1bfb0e(0x199)+_0x49eaad),console[_0x1bfb0e(0x242)](_0x1bfb0e(0x257)+_0x31e49a),console[_0x1bfb0e(0x242)](_0x1bfb0e(0x1d7)+_0x4573c2[_0x1bfb0e(0x1eb)]),{'totalRevenue':Math[_0x1bfb0e(0x1fc)](_0x21f153*0x64)/0x64,'totalUsers':_0x49eaad,'totalPayments':_0x31e49a,'averagePayment':Math[_0x1bfb0e(0x1fc)](_0x2d6e4a*0x64)/0x64,'dailyRevenue':_0x4573c2};}async[a33_0x52b3ed(0x254)](_0x4a3767){const _0x304d65=a33_0x52b3ed,{page:_0x33c002,limit:_0x23de09,status:_0xae8860,gateway:_0x39a1f5,shopId:_0x34c241,dateFrom:_0x214afa,dateTo:_0xe738ff,search:_0x1fd9de}=_0x4a3767,_0x8a3036=(_0x33c002-0x1)*_0x23de09;console[_0x304d65(0x242)](_0x304d65(0x23c),_0x4a3767);const _0x1a7f9f={};_0xae8860&&(_0x1a7f9f[_0x304d65(0x24d)]=_0xae8860[_0x304d65(0x188)]());if(_0x39a1f5){if((0x0,gateway_1[_0x304d65(0x1f5)])(_0x39a1f5)){const _0x4f3414=(0x0,gateway_1[_0x304d65(0x1c3)])(_0x39a1f5);_0x4f3414&&(_0x1a7f9f['gateway']=_0x4f3414);}else _0x1a7f9f[_0x304d65(0x1bc)]=_0x39a1f5[_0x304d65(0x213)]();}_0x34c241&&(_0x1a7f9f[_0x304d65(0x1f7)]=_0x34c241);(_0x214afa||_0xe738ff)&&(_0x1a7f9f[_0x304d65(0x1ed)]={},_0x214afa&&(_0x1a7f9f[_0x304d65(0x1ed)]['gte']=new Date(_0x214afa)),_0xe738ff&&(_0x1a7f9f[_0x304d65(0x1ed)][_0x304d65(0x1e1)]=new Date(_0xe738ff)));_0x1fd9de&&(_0x1a7f9f['OR']=[{'orderId':{'contains':_0x1fd9de,'mode':_0x304d65(0x208)}},{'gatewayOrderId':{'contains':_0x1fd9de,'mode':_0x304d65(0x208)}},{'gatewayPaymentId':{'contains':_0x1fd9de,'mode':'insensitive'}},{'customerEmail':{'contains':_0x1fd9de,'mode':_0x304d65(0x208)}},{'customerName':{'contains':_0x1fd9de,'mode':_0x304d65(0x208)}},{'shop':{'name':{'contains':_0x1fd9de,'mode':_0x304d65(0x208)}}},{'shop':{'username':{'contains':_0x1fd9de,'mode':_0x304d65(0x208)}}}]);const [_0x100ea5,_0x59136a]=await Promise[_0x304d65(0x200)]([database_1['default']['payment']['findMany']({'where':_0x1a7f9f,'skip':_0x8a3036,'take':_0x23de09,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x304d65(0x207)][_0x304d65(0x245)][_0x304d65(0x20f)]({'where':_0x1a7f9f})]);console[_0x304d65(0x242)](_0x304d65(0x1d3)+_0x100ea5[_0x304d65(0x1eb)]+_0x304d65(0x236)+_0x59136a+_0x304d65(0x1c9));const _0x5720cc=_0x100ea5[_0x304d65(0x1e8)](_0x2937ac=>({'id':_0x2937ac['id'],'shopId':_0x2937ac[_0x304d65(0x1f7)],'shopName':_0x2937ac[_0x304d65(0x1d6)][_0x304d65(0x253)],'shopUsername':_0x2937ac[_0x304d65(0x1d6)][_0x304d65(0x1fd)],'gateway':_0x2937ac[_0x304d65(0x1bc)],'orderId':_0x2937ac[_0x304d65(0x201)],'gatewayOrderId':_0x2937ac['gatewayOrderId'],'amount':_0x2937ac['amount'],'currency':_0x2937ac[_0x304d65(0x187)],'sourceCurrency':_0x2937ac['sourceCurrency'],'status':_0x2937ac[_0x304d65(0x24d)],'usage':_0x2937ac[_0x304d65(0x1ab)],'externalPaymentUrl':_0x2937ac['externalPaymentUrl'],'gatewayPaymentId':_0x2937ac[_0x304d65(0x223)],'customerEmail':_0x2937ac['customerEmail'],'customerName':_0x2937ac[_0x304d65(0x231)],'cardLast4':_0x2937ac[_0x304d65(0x20d)],'paymentMethod':_0x2937ac[_0x304d65(0x25e)],'bankId':_0x2937ac[_0x304d65(0x1d9)],'remitterIban':_0x2937ac[_0x304d65(0x22b)],'remitterName':_0x2937ac['remitterName'],'chargebackAmount':_0x2937ac['chargebackAmount'],'adminNotes':_0x2937ac[_0x304d65(0x232)],'statusChangedBy':_0x2937ac[_0x304d65(0x227)],'statusChangedAt':_0x2937ac[_0x304d65(0x1e0)],'createdAt':_0x2937ac[_0x304d65(0x1ed)],'updatedAt':_0x2937ac['updatedAt'],'expiresAt':_0x2937ac[_0x304d65(0x24c)]}));return{'payments':_0x5720cc,'pagination':{'page':_0x33c002,'limit':_0x23de09,'total':_0x59136a,'totalPages':Math[_0x304d65(0x25a)](_0x59136a/_0x23de09)}};}async[a33_0x52b3ed(0x1d8)](_0x46ba27){const _0x1ae002=a33_0x52b3ed;console[_0x1ae002(0x242)](_0x1ae002(0x23e)+_0x46ba27);const _0x309a29=await database_1[_0x1ae002(0x207)][_0x1ae002(0x245)][_0x1ae002(0x205)]({'where':{'id':_0x46ba27},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}},'webhookLogs':{'orderBy':{'createdAt':_0x1ae002(0x248)},'take':0xa,'select':{'id':!![],'event':!![],'statusCode':!![],'retryCount':!![],'createdAt':!![]}}}});if(!_0x309a29)return console[_0x1ae002(0x242)](_0x1ae002(0x251)+_0x46ba27),null;return console[_0x1ae002(0x242)](_0x1ae002(0x1f9)+_0x309a29[_0x1ae002(0x201)]+'\x20('+_0x309a29['status']+')'),{'id':_0x309a29['id'],'shopId':_0x309a29['shopId'],'shopName':_0x309a29[_0x1ae002(0x1d6)][_0x1ae002(0x253)],'shopUsername':_0x309a29[_0x1ae002(0x1d6)][_0x1ae002(0x1fd)],'gateway':_0x309a29[_0x1ae002(0x1bc)],'orderId':_0x309a29['orderId'],'gatewayOrderId':_0x309a29[_0x1ae002(0x244)],'amount':_0x309a29['amount'],'currency':_0x309a29[_0x1ae002(0x187)],'sourceCurrency':_0x309a29[_0x1ae002(0x21f)],'status':_0x309a29[_0x1ae002(0x24d)],'usage':_0x309a29[_0x1ae002(0x1ab)],'externalPaymentUrl':_0x309a29['externalPaymentUrl'],'gatewayPaymentId':_0x309a29[_0x1ae002(0x223)],'customerEmail':_0x309a29[_0x1ae002(0x19e)],'customerName':_0x309a29[_0x1ae002(0x231)],'cardLast4':_0x309a29['cardLast4'],'paymentMethod':_0x309a29[_0x1ae002(0x25e)],'bankId':_0x309a29[_0x1ae002(0x1d9)],'remitterIban':_0x309a29[_0x1ae002(0x22b)],'remitterName':_0x309a29[_0x1ae002(0x190)],'chargebackAmount':_0x309a29[_0x1ae002(0x19a)],'adminNotes':_0x309a29[_0x1ae002(0x232)],'statusChangedBy':_0x309a29[_0x1ae002(0x227)],'statusChangedAt':_0x309a29['statusChangedAt'],'createdAt':_0x309a29[_0x1ae002(0x1ed)],'updatedAt':_0x309a29[_0x1ae002(0x256)],'expiresAt':_0x309a29['expiresAt'],'webhookLogs':_0x309a29[_0x1ae002(0x18c)]};}async[a33_0x52b3ed(0x1c0)](_0x32e4c9,_0x3d1c16,_0x4a7944,_0x4efcec){const _0x3bdc90=a33_0x52b3ed;console[_0x3bdc90(0x242)](_0x3bdc90(0x226)+_0x32e4c9+_0x3bdc90(0x1d1)+_0x3d1c16);const _0xcc21a6=[_0x3bdc90(0x25d),_0x3bdc90(0x18f),_0x3bdc90(0x210),_0x3bdc90(0x1fa),_0x3bdc90(0x193),'CHARGEBACK'];if(!_0xcc21a6[_0x3bdc90(0x204)](_0x3d1c16[_0x3bdc90(0x188)]()))throw new Error(_0x3bdc90(0x1df)+_0xcc21a6[_0x3bdc90(0x1f0)](',\x20'));const _0x4ce755=await database_1['default'][_0x3bdc90(0x245)][_0x3bdc90(0x205)]({'where':{'id':_0x32e4c9},'select':{'id':!![],'status':!![],'orderId':!![]}});if(!_0x4ce755)throw new Error(_0x3bdc90(0x255));if(_0x3d1c16['toUpperCase']()===_0x3bdc90(0x1af)){if(!_0x4efcec||_0x4efcec<=0x0)throw new Error(_0x3bdc90(0x1de));console['log'](_0x3bdc90(0x247)+_0x4efcec+_0x3bdc90(0x191));}const _0x314493={'status':_0x3d1c16[_0x3bdc90(0x188)](),'updatedAt':new Date(),'statusChangedBy':_0x3bdc90(0x19d),'statusChangedAt':new Date()};_0x4a7944&&(_0x314493[_0x3bdc90(0x232)]=_0x4a7944);_0x3d1c16['toUpperCase']()===_0x3bdc90(0x1af)&&_0x4efcec&&(_0x314493[_0x3bdc90(0x19a)]=_0x4efcec);const _0x33eeee=await database_1[_0x3bdc90(0x207)][_0x3bdc90(0x245)][_0x3bdc90(0x249)]({'where':{'id':_0x32e4c9},'data':_0x314493,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});return await database_1[_0x3bdc90(0x207)][_0x3bdc90(0x1ec)][_0x3bdc90(0x1ba)]({'data':{'paymentId':_0x32e4c9,'shopId':_0x33eeee[_0x3bdc90(0x1f7)],'event':_0x3bdc90(0x195),'statusCode':0xc8,'responseBody':JSON['stringify']({'oldStatus':_0x4ce755[_0x3bdc90(0x24d)],'newStatus':_0x3d1c16['toUpperCase'](),'notes':_0x4a7944||null,'chargebackAmount':_0x4efcec||null,'updatedBy':_0x3bdc90(0x19d),'timestamp':new Date()[_0x3bdc90(0x18e)]()})}}),console[_0x3bdc90(0x242)](_0x3bdc90(0x1b4)+_0x4ce755['orderId']+'\x20status\x20updated\x20from\x20'+_0x4ce755[_0x3bdc90(0x24d)]+_0x3bdc90(0x241)+_0x3d1c16[_0x3bdc90(0x188)]()),_0x3d1c16[_0x3bdc90(0x188)]()==='CHARGEBACK'&&console[_0x3bdc90(0x242)]('💸\x20Chargeback\x20penalty:\x20'+_0x4efcec+_0x3bdc90(0x1a7)),{'id':_0x33eeee['id'],'shopId':_0x33eeee[_0x3bdc90(0x1f7)],'shopName':_0x33eeee[_0x3bdc90(0x1d6)]['name'],'shopUsername':_0x33eeee['shop'][_0x3bdc90(0x1fd)],'gateway':_0x33eeee[_0x3bdc90(0x1bc)],'orderId':_0x33eeee[_0x3bdc90(0x201)],'gatewayOrderId':_0x33eeee[_0x3bdc90(0x244)],'amount':_0x33eeee[_0x3bdc90(0x250)],'currency':_0x33eeee[_0x3bdc90(0x187)],'sourceCurrency':_0x33eeee[_0x3bdc90(0x21f)],'status':_0x33eeee[_0x3bdc90(0x24d)],'usage':_0x33eeee['usage'],'externalPaymentUrl':_0x33eeee[_0x3bdc90(0x1f1)],'gatewayPaymentId':_0x33eeee['gatewayPaymentId'],'customerEmail':_0x33eeee[_0x3bdc90(0x19e)],'customerName':_0x33eeee['customerName'],'cardLast4':_0x33eeee[_0x3bdc90(0x20d)],'paymentMethod':_0x33eeee[_0x3bdc90(0x25e)],'bankId':_0x33eeee['bankId'],'remitterIban':_0x33eeee['remitterIban'],'remitterName':_0x33eeee['remitterName'],'chargebackAmount':_0x33eeee[_0x3bdc90(0x19a)],'adminNotes':_0x33eeee[_0x3bdc90(0x232)],'statusChangedBy':_0x33eeee[_0x3bdc90(0x227)],'statusChangedAt':_0x33eeee[_0x3bdc90(0x1e0)],'createdAt':_0x33eeee[_0x3bdc90(0x1ed)],'updatedAt':_0x33eeee[_0x3bdc90(0x256)],'expiresAt':_0x33eeee[_0x3bdc90(0x24c)]};}async[a33_0x52b3ed(0x1b5)](_0x18bad7){const _0x329c01=a33_0x52b3ed,{page:_0x1d33c0,limit:_0x25ea4a,status:_0x75cfcd}=_0x18bad7,_0x13c2db=(_0x1d33c0-0x1)*_0x25ea4a,_0x4508bf={};_0x75cfcd&&(_0x4508bf[_0x329c01(0x24d)]=_0x75cfcd['toUpperCase']());console[_0x329c01(0x242)](_0x329c01(0x1a1),{'page':_0x1d33c0,'limit':_0x25ea4a,'status':_0x75cfcd,'where':_0x4508bf});const [_0x5ebc5a,_0x4073a6]=await Promise[_0x329c01(0x200)]([database_1[_0x329c01(0x207)][_0x329c01(0x1d6)][_0x329c01(0x19b)]({'where':_0x4508bf,'skip':_0x13c2db,'take':_0x25ea4a,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':'desc'}}),database_1[_0x329c01(0x207)][_0x329c01(0x1d6)][_0x329c01(0x20f)]({'where':_0x4508bf})]);console['log']('📊\x20Found\x20'+_0x5ebc5a[_0x329c01(0x1eb)]+_0x329c01(0x1ae)+_0x4073a6+_0x329c01(0x1c9));const _0x2d7480=_0x5ebc5a[_0x329c01(0x1e8)](_0x396c68=>({'id':_0x396c68['id'],'fullName':_0x396c68['name'],'username':_0x396c68[_0x329c01(0x1fd)],'telegramId':_0x396c68[_0x329c01(0x1f6)],'merchantUrl':_0x396c68[_0x329c01(0x238)],'gateways':_0x396c68[_0x329c01(0x197)]?JSON['parse'](_0x396c68['paymentGateways']):null,'gatewaySettings':_0x396c68[_0x329c01(0x221)]?JSON['parse'](_0x396c68[_0x329c01(0x221)]):null,'publicKey':_0x396c68[_0x329c01(0x259)],'wallets':{'usdtPolygonWallet':_0x396c68[_0x329c01(0x214)],'usdtTrcWallet':_0x396c68[_0x329c01(0x24b)],'usdtErcWallet':_0x396c68['usdtErcWallet'],'usdcPolygonWallet':_0x396c68[_0x329c01(0x1a6)]},'status':_0x396c68['status'],'createdAt':_0x396c68['createdAt']}));return{'users':_0x2d7480,'pagination':{'page':_0x1d33c0,'limit':_0x25ea4a,'total':_0x4073a6,'totalPages':Math['ceil'](_0x4073a6/_0x25ea4a)}};}async[a33_0x52b3ed(0x225)](_0x1191cd){const _0x3a285e=a33_0x52b3ed;return await this[_0x3a285e(0x1d2)][_0x3a285e(0x225)](_0x1191cd);}async[a33_0x52b3ed(0x1f8)](_0xbdca9d){const _0x4255b1=a33_0x52b3ed;return await this[_0x4255b1(0x1d2)][_0x4255b1(0x1f8)](_0xbdca9d);}async[a33_0x52b3ed(0x1c1)](_0x5f2727,_0x3350f8){const _0x5c78f5=a33_0x52b3ed;return await this[_0x5c78f5(0x1d2)][_0x5c78f5(0x1c1)](_0x5f2727,_0x3350f8);}async[a33_0x52b3ed(0x1e4)](_0x1bb72d){const _0x1e1011=a33_0x52b3ed;return await this['userService'][_0x1e1011(0x1e4)](_0x1bb72d);}async[a33_0x52b3ed(0x209)](_0x2f32a6){const _0x38b477=a33_0x52b3ed;console['log'](_0x38b477(0x1ad)+_0x2f32a6);const _0x2b2d9f=await database_1[_0x38b477(0x207)][_0x38b477(0x1d6)][_0x38b477(0x205)]({'where':{'id':_0x2f32a6},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x2b2d9f)throw new Error(_0x38b477(0x1b7));if(_0x2b2d9f[_0x38b477(0x24d)]==='SUSPENDED')throw new Error(_0x38b477(0x228));const _0x597c3e=await this[_0x38b477(0x1d2)][_0x38b477(0x1c1)](_0x2f32a6,{'status':_0x38b477(0x220)});return console['log'](_0x38b477(0x1a0)+_0x2b2d9f[_0x38b477(0x1fd)]+'\x20suspended\x20successfully'),_0x597c3e;}async[a33_0x52b3ed(0x218)](_0x156aac){const _0x2fe218=a33_0x52b3ed;console['log']('✅\x20Activating\x20user:\x20'+_0x156aac);const _0x3ea2cf=await database_1[_0x2fe218(0x207)][_0x2fe218(0x1d6)][_0x2fe218(0x205)]({'where':{'id':_0x156aac},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x3ea2cf)throw new Error('User\x20not\x20found');if(_0x3ea2cf[_0x2fe218(0x24d)]==='ACTIVE')throw new Error('User\x20is\x20already\x20active');const _0x3ae210=await this[_0x2fe218(0x1d2)]['updateUser'](_0x156aac,{'status':_0x2fe218(0x21e)});return console[_0x2fe218(0x242)](_0x2fe218(0x1a0)+_0x3ea2cf[_0x2fe218(0x1fd)]+_0x2fe218(0x1e9)),_0x3ae210;}}exports['AdminService']=AdminService;