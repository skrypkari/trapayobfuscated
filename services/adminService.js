'use strict';function a33_0x2259(_0xc54ecf,_0x290b47){const _0x459a7d=a33_0x459a();return a33_0x2259=function(_0x2259a1,_0x2acf31){_0x2259a1=_0x2259a1-0x78;let _0x18dcca=_0x459a7d[_0x2259a1];return _0x18dcca;},a33_0x2259(_0xc54ecf,_0x290b47);}function a33_0x459a(){const _0x714726=['shop','EXPIRED','desc','default','usdtErcWallet','Invalid\x20status.\x20Valid\x20statuses:\x20','customerName','isEligibleForPayout','updatePaymentStatus','Failed\x20to\x20send\x20Telegram\x20payout\x20notification:','payments','expiresAt','deleteUser','getUserById','stringify','2XhfHUx','__importDefault','\x20total','sourceCurrency','userService','üíµ\x20Total\x20revenue:\x20','üîÑ\x20Marking\x20payments\x20as\x20paid\x20out\x20for\x20shop\x20','10200174iiYTRt',',\x20amount:\x20','round','\x20USDT\x20via\x20','telegramBotService','üìä\x20Daily\x20revenue\x20entries:\x20','set','payout','abs','PENDING','getPaymentById','txid','\x20merchants\x20out\x20of\x20','Shop\x20not\x20found','gateway','üìã\x20Getting\x20users\x20with\x20filters:','../config/database','status','‚è≥\x20Awaiting\x20Payout:\x20','Payout\x20not\x20found','gte','calculateEffectiveAmount','awaitingPayout','\x20status\x20updated\x20from\x20','has','all','üìÖ\x20This\x20Month:\x20','update','defineProperty','ceil','User\x20not\x20found','externalPaymentUrl','thisMonth','User\x20is\x20already\x20active','payment','üîÑ\x20Updating\x20payment\x20','./currencyService','status_update','updatedAt','üîç\x20Getting\x20payout\x20by\x20ID:\x20','üí∏\x20Chargeback\x20amount:\x20','usage','‚úÖ\x20Activating\x20user:\x20','name','SUSPENDED','üìä\x20Generating\x20admin\x20statistics\x20for\x20period:\x20','REFUND','30d','\x20payouts\x20out\x20of\x20','slice','CHARGEBACK','\x20USDT','‚úÖ\x20Payout\x20created\x20successfully:\x20','üìã\x20Getting\x20payments\x20with\x20filters:','payoutDelay','‚ùå\x20Payment\x20not\x20found:\x20','getPeriodDays','7499260OEhviK','3491270aIvEph','create','split','üí∞\x20Found\x20','\x20suspended\x20successfully','519309GcgJtf','length','paidAt','\x20merchants\x20with\x20eligible\x20PAID\x20payments','getSystemStatistics','currency','getDate','webhookLogs','publicKey','amount','toUpperCase','createPayout','remitterIban','paymentMethod','push','gatewaySettings','shopUrl','usdtTrcWallet','totalPayout','setDate','reduce','\x20USDT\x20(penalty\x20amount)','1565446OmDNXt','sort','getGatewaySettings','count','üìã\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','getAllUsers','createUser','amountAfterCommissionUSDT','ACTIVE','notes','error','entries','üí∏\x20Chargeback\x20penalty:\x20','$queryRaw','chargebackAmount','\x20USDT\x20(—Ç–æ–ª—å–∫–æ\x20PAID\x20–ø–ª–∞—Ç–µ–∂–∏)','./userService','Shop\x20is\x20not\x20active','findUnique','\x20payments\x20as\x20paid\x20out','‚úÖ\x20User\x20','toLowerCase','\x20deleted\x20successfully','üí∏\x20Creating\x20payout\x20for\x20shop\x20','availableBalance','get','updateUser','üë•\x20Total\x20users:\x20','findMany','currencyService','totalAmountAfterCommissionUSDT','bankId','UserService','getMerchantsAwaitingPayout','gatewayOrderId','orderId','log','markPaymentsAsPaidOut','üóëÔ∏è\x20Deleting\x20payout:\x20','‚úÖ\x20Payment\x20','\x20to\x20','3353787RSsgTb','User\x20is\x20already\x20suspended','activateUser','Payment\x20not\x20found','charAt','48Fngjvk','36pSHoTp','suspendUser','shopId','getGatewayNameById','gatewayPaymentId','merchantPaid','join','\x20status\x20to:\x20','‚úÖ\x20Payout\x20statistics\x20calculated:','‚úÖ\x20Admin\x20statistics\x20generated\x20successfully','isValidGatewayId','calculateAmountAfterCommission','deletePayout','map','amountUSDT','username','from','usdtPolygonWallet','asc','PAID','getAllPayments','\x20users\x20out\x20of\x20','size','date','getPayoutStats','\x20days)','statusChangedBy','Chargeback\x20amount\x20is\x20required\x20and\x20must\x20be\x20positive\x20(amount\x20in\x20USDT)','toISOString','‚úÖ\x20Marked\x20','\x20payments\x20for\x20analysis\x20(PAID/REFUND/CHARGEBACK)','üìä\x20Found\x20','customerEmail','90d','telegram','üö´\x20Suspending\x20user:\x20','üîç\x20Getting\x20payment\x20by\x20ID:\x20','commission','createdAt','statusChangedAt','\x20USDT\x20(–≤–∫–ª—é—á–∞—è\x20—à—Ç—Ä–∞—Ñ—ã\x20chargeback)','getTime','AdminService','remitterName','getMonth','cardLast4','insensitive','includes','‚úÖ\x20Returning\x20','getFullYear','toFixed','lte','network','webhookLog','adminNotes','convertToUSDT','6576908adnNfj'];a33_0x459a=function(){return _0x714726;};return a33_0x459a();}const a33_0x2d8b13=a33_0x2259;(function(_0x5e229b,_0x5daaf7){const _0xf27aaf=a33_0x2259,_0x2a93f4=_0x5e229b();while(!![]){try{const _0x49f61f=parseInt(_0xf27aaf(0xdd))/0x1*(parseInt(_0xf27aaf(0x81))/0x2)+parseInt(_0xf27aaf(0x106))/0x3+-parseInt(_0xf27aaf(0x144))/0x4+parseInt(_0xf27aaf(0xc2))/0x5+parseInt(_0xf27aaf(0x88))/0x6+parseInt(_0xf27aaf(0xc7))/0x7*(parseInt(_0xf27aaf(0x10b))/0x8)+-parseInt(_0xf27aaf(0x10c))/0x9*(parseInt(_0xf27aaf(0xc1))/0xa);if(_0x49f61f===_0x5daaf7)break;else _0x2a93f4['push'](_0x2a93f4['shift']());}catch(_0x47abc8){_0x2a93f4['push'](_0x2a93f4['shift']());}}}(a33_0x459a,0xd78a1));var __importDefault=this&&this[a33_0x2d8b13(0x82)]||function(_0x545848){return _0x545848&&_0x545848['__esModule']?_0x545848:{'default':_0x545848};};Object[a33_0x2d8b13(0xa4)](exports,'__esModule',{'value':!![]}),exports[a33_0x2d8b13(0x136)]=void 0x0;const database_1=__importDefault(require(a33_0x2d8b13(0x98))),currencyService_1=require(a33_0x2d8b13(0xac)),userService_1=require(a33_0x2d8b13(0xed)),telegramBotService_1=require('./telegramBotService'),gateway_1=require('../types/gateway');class AdminService{constructor(){const _0x519e7b=a33_0x2d8b13;this[_0x519e7b(0x85)]=new userService_1[(_0x519e7b(0xfd))]();}[a33_0x2d8b13(0xc0)](_0x500ce9){const _0x2816d0=a33_0x2d8b13;switch(_0x500ce9){case'7d':return 0x7;case _0x2816d0(0xb7):return 0x1e;case _0x2816d0(0x12d):return 0x5a;case'1y':return 0x16d;default:return 0x1e;}}['generateDateRange'](_0x158ec3,_0x243812){const _0x5c1d0e=a33_0x2d8b13,_0x476bdd=[],_0x432659=new Date(_0x158ec3);while(_0x432659<=_0x243812){_0x476bdd['push'](_0x432659['toISOString']()[_0x5c1d0e(0xc4)]('T')[0x0]),_0x432659[_0x5c1d0e(0xda)](_0x432659['getDate']()+0x1);}return _0x476bdd;}[a33_0x2d8b13(0xdf)](_0x2e3e8f,_0x3928cc){const _0x539ae6=a33_0x2d8b13;if(!_0x2e3e8f[_0x539ae6(0xd6)])return{'commission':0x0,'payoutDelay':0x0};try{const _0x12beb5=JSON['parse'](_0x2e3e8f[_0x539ae6(0xd6)]),_0x5c55c1=_0x3928cc['charAt'](0x0)[_0x539ae6(0xd1)]()+_0x3928cc[_0x539ae6(0xb9)](0x1)[_0x539ae6(0xf2)]();if(_0x12beb5&&_0x12beb5[_0x5c55c1])return{'commission':_0x12beb5[_0x5c55c1][_0x539ae6(0x131)]||0x0,'payoutDelay':_0x12beb5[_0x5c55c1][_0x539ae6(0xbe)]||0x0};}catch(_0x46a9b0){console[_0x539ae6(0xe7)]('Error\x20parsing\x20gateway\x20settings:',_0x46a9b0);}return{'commission':0x0,'payoutDelay':0x0};}[a33_0x2d8b13(0x79)](_0x27e261){const _0x17b6d5=a33_0x2d8b13;if(_0x27e261[_0x17b6d5(0x99)]!==_0x17b6d5(0x11f)||_0x27e261[_0x17b6d5(0x111)]||!_0x27e261[_0x17b6d5(0xc9)])return![];const _0x5e2a37=this[_0x17b6d5(0xdf)](_0x27e261[_0x17b6d5(0x145)],_0x27e261[_0x17b6d5(0x96)]),_0xd23419=_0x5e2a37['payoutDelay']*0x18*0x3c*0x3c*0x3e8,_0x4943f9=new Date(_0x27e261[_0x17b6d5(0xc9)][_0x17b6d5(0x135)]()+_0xd23419);return new Date()>_0x4943f9;}[a33_0x2d8b13(0x117)](_0x385b87,_0x1a57f4){return _0x385b87*(0x1-_0x1a57f4/0x64);}[a33_0x2d8b13(0x9d)](_0x32fb0d){const _0x434575=a33_0x2d8b13;switch(_0x32fb0d[_0x434575(0x99)]){case _0x434575(0x11f):return _0x32fb0d[_0x434575(0xd0)];case _0x434575(0xba):return-(_0x32fb0d['chargebackAmount']||0x0);case _0x434575(0xb6):return 0x0;default:return 0x0;}}async[a33_0x2d8b13(0xd2)](_0x536e43){const _0x3d0b9c=a33_0x2d8b13,{shopId:_0x3f794a,amount:_0x582f4f,network:_0x235bf9,notes:_0x66aaaa}=_0x536e43;console[_0x3d0b9c(0x101)](_0x3d0b9c(0xf4)+_0x3f794a+':\x20'+_0x582f4f+_0x3d0b9c(0x8b)+_0x235bf9);const _0x5cf20a=await database_1[_0x3d0b9c(0x148)][_0x3d0b9c(0x145)][_0x3d0b9c(0xef)]({'where':{'id':_0x3f794a},'select':{'id':!![],'name':!![],'username':!![],'status':!![]}});if(!_0x5cf20a)throw new Error(_0x3d0b9c(0x95));if(_0x5cf20a['status']!=='ACTIVE')throw new Error(_0x3d0b9c(0xee));const _0x4e9c10=await database_1[_0x3d0b9c(0x148)]['payout'][_0x3d0b9c(0xc3)]({'data':{'shopId':_0x3f794a,'amount':_0x582f4f,'network':_0x235bf9,'status':'COMPLETED','notes':_0x66aaaa||null,'paidAt':new Date()},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});await this['markPaymentsAsPaidOut'](_0x3f794a,_0x582f4f);try{await telegramBotService_1[_0x3d0b9c(0x8c)]['sendPayoutNotification'](_0x3f794a,_0x4e9c10,'completed');}catch(_0x54e04e){console[_0x3d0b9c(0xe7)](_0x3d0b9c(0x7b),_0x54e04e);}return console[_0x3d0b9c(0x101)](_0x3d0b9c(0xbc)+_0x4e9c10['id']),{'id':_0x4e9c10['id'],'shopId':_0x4e9c10[_0x3d0b9c(0x10e)],'shopName':_0x4e9c10['shop'][_0x3d0b9c(0xb3)],'shopUsername':_0x4e9c10[_0x3d0b9c(0x145)][_0x3d0b9c(0x11b)],'amount':_0x4e9c10[_0x3d0b9c(0xd0)],'network':_0x4e9c10['network'],'status':_0x4e9c10['status'],'txid':_0x4e9c10['txid'],'notes':_0x4e9c10['notes'],'createdAt':_0x4e9c10[_0x3d0b9c(0x132)],'paidAt':_0x4e9c10['paidAt']};}async[a33_0x2d8b13(0x102)](_0x17bab9,_0x5c9912){const _0x4b1640=a33_0x2d8b13;console[_0x4b1640(0x101)](_0x4b1640(0x87)+_0x17bab9+_0x4b1640(0x89)+_0x5c9912+_0x4b1640(0xbb));const _0x40c813=await database_1[_0x4b1640(0x148)][_0x4b1640(0xaa)]['findMany']({'where':{'shopId':_0x17bab9,'status':_0x4b1640(0x11f),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'shop':{'select':{'gatewaySettings':!![]}}},'orderBy':{'paidAt':_0x4b1640(0x11e)}});let _0x4ab87a=_0x5c9912;const _0x5d115b=[];for(const _0x1cb76d of _0x40c813){const _0x2e4aab={..._0x1cb76d,'status':_0x4b1640(0x11f),'merchantPaid':![],'shop':{'gatewaySettings':_0x1cb76d[_0x4b1640(0x145)][_0x4b1640(0xd6)]}};if(!this[_0x4b1640(0x79)](_0x2e4aab))continue;const _0x404cbd=await currencyService_1[_0x4b1640(0xfa)][_0x4b1640(0x143)](_0x1cb76d['amount'],_0x1cb76d[_0x4b1640(0xcc)]),_0x5c11a6=this['getGatewaySettings'](_0x1cb76d[_0x4b1640(0x145)],_0x1cb76d[_0x4b1640(0x96)]),_0x581f91=this[_0x4b1640(0x117)](_0x404cbd,_0x5c11a6[_0x4b1640(0x131)]);if(_0x581f91<=_0x4ab87a){_0x5d115b['push'](_0x1cb76d['id']),_0x4ab87a-=_0x581f91;if(_0x4ab87a<=0.01)break;}}_0x5d115b[_0x4b1640(0xc8)]>0x0&&(await database_1[_0x4b1640(0x148)][_0x4b1640(0xaa)]['updateMany']({'where':{'id':{'in':_0x5d115b}},'data':{'merchantPaid':!![]}}),console[_0x4b1640(0x101)](_0x4b1640(0x129)+_0x5d115b['length']+_0x4b1640(0xf0)));}async['getAllPayouts'](_0x464dcd){const _0x5b3c35=a33_0x2d8b13,{page:_0x5d28d9,limit:_0x27a5b5,shopId:_0x4d0415,network:_0x9da6d6,dateFrom:_0x2c85f5,dateTo:_0x48e3b3,search:_0x329f7b}=_0x464dcd,_0x849f12=(_0x5d28d9-0x1)*_0x27a5b5;console[_0x5b3c35(0x101)]('üìã\x20Getting\x20payouts\x20with\x20filters:',_0x464dcd);const _0x192f28={};_0x4d0415&&(_0x192f28[_0x5b3c35(0x10e)]=_0x4d0415);_0x9da6d6&&(_0x192f28[_0x5b3c35(0x140)]=_0x9da6d6);(_0x2c85f5||_0x48e3b3)&&(_0x192f28[_0x5b3c35(0x132)]={},_0x2c85f5&&(_0x192f28[_0x5b3c35(0x132)][_0x5b3c35(0x9c)]=new Date(_0x2c85f5)),_0x48e3b3&&(_0x192f28['createdAt']['lte']=new Date(_0x48e3b3)));_0x329f7b&&(_0x192f28['OR']=[{'txid':{'contains':_0x329f7b,'mode':_0x5b3c35(0x13a)}},{'notes':{'contains':_0x329f7b,'mode':_0x5b3c35(0x13a)}},{'shop':{'name':{'contains':_0x329f7b,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x329f7b,'mode':_0x5b3c35(0x13a)}}}]);const [_0x5301ad,_0xf4b065]=await Promise[_0x5b3c35(0xa1)]([database_1['default'][_0x5b3c35(0x8f)]['findMany']({'where':_0x192f28,'skip':_0x849f12,'take':_0x27a5b5,'orderBy':{'createdAt':_0x5b3c35(0x147)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x5b3c35(0x148)][_0x5b3c35(0x8f)][_0x5b3c35(0xe0)]({'where':_0x192f28})]);console[_0x5b3c35(0x101)](_0x5b3c35(0x12b)+_0x5301ad[_0x5b3c35(0xc8)]+_0x5b3c35(0xb8)+_0xf4b065+_0x5b3c35(0x83));const _0x78f39b=_0x5301ad[_0x5b3c35(0x119)](_0x154e9a=>({'id':_0x154e9a['id'],'shopId':_0x154e9a['shopId'],'shopName':_0x154e9a[_0x5b3c35(0x145)][_0x5b3c35(0xb3)],'shopUsername':_0x154e9a[_0x5b3c35(0x145)][_0x5b3c35(0x11b)],'amount':_0x154e9a[_0x5b3c35(0xd0)],'network':_0x154e9a[_0x5b3c35(0x140)],'status':_0x154e9a[_0x5b3c35(0x99)],'txid':_0x154e9a['txid'],'notes':_0x154e9a[_0x5b3c35(0xe6)],'createdAt':_0x154e9a['createdAt'],'paidAt':_0x154e9a[_0x5b3c35(0xc9)]}));return{'payouts':_0x78f39b,'pagination':{'page':_0x5d28d9,'limit':_0x27a5b5,'total':_0xf4b065,'totalPages':Math[_0x5b3c35(0xa5)](_0xf4b065/_0x27a5b5)}};}async['getPayoutById'](_0x3e3370){const _0x523d6f=a33_0x2d8b13;console[_0x523d6f(0x101)](_0x523d6f(0xaf)+_0x3e3370);const _0x594870=await database_1['default'][_0x523d6f(0x8f)][_0x523d6f(0xef)]({'where':{'id':_0x3e3370},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x594870)return console[_0x523d6f(0x101)]('‚ùå\x20Payout\x20not\x20found:\x20'+_0x3e3370),null;return console[_0x523d6f(0x101)]('‚úÖ\x20Found\x20payout:\x20'+_0x594870[_0x523d6f(0xd0)]+_0x523d6f(0x8b)+_0x594870[_0x523d6f(0x140)]),{'id':_0x594870['id'],'shopId':_0x594870['shopId'],'shopName':_0x594870[_0x523d6f(0x145)]['name'],'shopUsername':_0x594870[_0x523d6f(0x145)][_0x523d6f(0x11b)],'amount':_0x594870[_0x523d6f(0xd0)],'network':_0x594870['network'],'status':_0x594870[_0x523d6f(0x99)],'txid':_0x594870[_0x523d6f(0x93)],'notes':_0x594870[_0x523d6f(0xe6)],'createdAt':_0x594870[_0x523d6f(0x132)],'paidAt':_0x594870[_0x523d6f(0xc9)]};}async[a33_0x2d8b13(0x118)](_0x1bb911){const _0x377512=a33_0x2d8b13;console[_0x377512(0x101)](_0x377512(0x103)+_0x1bb911);const _0x5860d9=await database_1[_0x377512(0x148)][_0x377512(0x8f)]['findUnique']({'where':{'id':_0x1bb911},'select':{'id':!![],'shopId':!![],'amount':!![]}});if(!_0x5860d9)throw new Error(_0x377512(0x9b));await database_1['default'][_0x377512(0x8f)]['delete']({'where':{'id':_0x1bb911}}),console[_0x377512(0x101)]('‚úÖ\x20Payout\x20'+_0x1bb911+_0x377512(0xf3));}async[a33_0x2d8b13(0xfe)](_0x423d4d){const _0x15b81a=a33_0x2d8b13,{page:_0x562dc5,limit:_0x302cc0,minAmount:_0x1465b7,search:_0x42c679}=_0x423d4d;console[_0x15b81a(0x101)](_0x15b81a(0xe1),_0x423d4d);const _0x59802c=await database_1[_0x15b81a(0x148)]['payment']['findMany']({'where':{'status':_0x15b81a(0x11f),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'createdAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'gatewaySettings':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}});console[_0x15b81a(0x101)](_0x15b81a(0xc5)+_0x59802c[_0x15b81a(0xc8)]+'\x20eligible\x20PAID\x20payments\x20for\x20payout\x20analysis');const _0x936d6b=new Map();for(const _0x4ef534 of _0x59802c){const _0x1c2432={..._0x4ef534,'status':_0x15b81a(0x11f),'merchantPaid':![],'shop':{'gatewaySettings':_0x4ef534[_0x15b81a(0x145)]['gatewaySettings']}},_0x1abe15=this[_0x15b81a(0x79)](_0x1c2432);if(!_0x1abe15)continue;const _0xf25766=await currencyService_1[_0x15b81a(0xfa)][_0x15b81a(0x143)](_0x4ef534['amount'],_0x4ef534[_0x15b81a(0xcc)]),_0x264523=this[_0x15b81a(0xdf)](_0x4ef534[_0x15b81a(0x145)],_0x4ef534[_0x15b81a(0x96)]),_0x460684=this['calculateAmountAfterCommission'](_0xf25766,_0x264523[_0x15b81a(0x131)]),_0x3b37eb=_0x4ef534[_0x15b81a(0x10e)];!_0x936d6b['has'](_0x3b37eb)&&_0x936d6b[_0x15b81a(0x8e)](_0x3b37eb,{'shop':_0x4ef534[_0x15b81a(0x145)],'payments':[]}),_0x936d6b['get'](_0x3b37eb)[_0x15b81a(0x7c)][_0x15b81a(0xd5)]({'id':_0x4ef534['id'],'amount':_0x4ef534[_0x15b81a(0xd0)],'currency':_0x4ef534['currency'],'gateway':_0x4ef534[_0x15b81a(0x96)],'paidAt':_0x4ef534[_0x15b81a(0xc9)],'createdAt':_0x4ef534[_0x15b81a(0x132)],'amountUSDT':_0xf25766,'commission':_0x264523[_0x15b81a(0x131)],'amountAfterCommissionUSDT':_0x460684,'isEligible':!![]});}console[_0x15b81a(0x101)]('üè™\x20Found\x20'+_0x936d6b[_0x15b81a(0x122)]+_0x15b81a(0xca));const _0x234947=[];for(const [_0x3624c5,_0x24618e]of _0x936d6b){const {shop:_0x53516f,payments:_0x28811c}=_0x24618e,_0x1a3ab6=_0x28811c[_0x15b81a(0xdb)]((_0x3c2e02,_0x4b4f7e)=>_0x3c2e02+_0x4b4f7e[_0x15b81a(0x11a)],0x0),_0x5b7796=_0x28811c['reduce']((_0x5836f1,_0x24d643)=>_0x5836f1+_0x24d643[_0x15b81a(0xe4)],0x0);if(_0x1465b7&&_0x5b7796<_0x1465b7)continue;if(_0x42c679){const _0x13cff3=_0x42c679[_0x15b81a(0xf2)](),_0x59c567=_0x53516f['name'][_0x15b81a(0xf2)]()[_0x15b81a(0x13b)](_0x13cff3)||_0x53516f[_0x15b81a(0x11b)][_0x15b81a(0xf2)]()[_0x15b81a(0x13b)](_0x13cff3)||_0x53516f[_0x15b81a(0x12e)]&&_0x53516f[_0x15b81a(0x12e)][_0x15b81a(0xf2)]()['includes'](_0x13cff3);if(!_0x59c567)continue;}const _0x11f0cd=new Map();for(const _0x5f3d13 of _0x28811c){const _0x363b17=_0x5f3d13[_0x15b81a(0x96)];!_0x11f0cd[_0x15b81a(0xa0)](_0x363b17)&&_0x11f0cd['set'](_0x363b17,{'count':0x0,'amountUSDT':0x0,'amountAfterCommissionUSDT':0x0,'commission':_0x5f3d13[_0x15b81a(0x131)]});const _0x263876=_0x11f0cd['get'](_0x363b17);_0x263876[_0x15b81a(0xe0)]++,_0x263876['amountUSDT']+=_0x5f3d13[_0x15b81a(0x11a)],_0x263876[_0x15b81a(0xe4)]+=_0x5f3d13['amountAfterCommissionUSDT'];}const _0x1aa2c2=Array[_0x15b81a(0x11c)](_0x11f0cd[_0x15b81a(0xe8)]())[_0x15b81a(0x119)](([_0x39fc83,_0x782f1c])=>({'gateway':_0x39fc83[_0x15b81a(0x10a)](0x0)[_0x15b81a(0xd1)]()+_0x39fc83[_0x15b81a(0xb9)](0x1),'count':_0x782f1c['count'],'amountUSDT':Math[_0x15b81a(0x8a)](_0x782f1c[_0x15b81a(0x11a)]*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x15b81a(0x8a)](_0x782f1c[_0x15b81a(0xe4)]*0x64)/0x64,'commission':_0x782f1c[_0x15b81a(0x131)]})),_0x2ddb30=_0x28811c[_0x15b81a(0xdb)]((_0x47615e,_0x29d1ad)=>{return _0x29d1ad['paidAt']<_0x47615e?_0x29d1ad['paidAt']:_0x47615e;},_0x28811c[0x0][_0x15b81a(0xc9)]);_0x234947[_0x15b81a(0xd5)]({'id':_0x53516f['id'],'fullName':_0x53516f['name'],'username':_0x53516f[_0x15b81a(0x11b)],'telegramId':_0x53516f['telegram'],'merchantUrl':_0x53516f[_0x15b81a(0xd7)],'wallets':{'usdtPolygonWallet':_0x53516f['usdtPolygonWallet'],'usdtTrcWallet':_0x53516f['usdtTrcWallet'],'usdtErcWallet':_0x53516f[_0x15b81a(0x149)],'usdcPolygonWallet':_0x53516f['usdcPolygonWallet']},'totalAmountUSDT':Math[_0x15b81a(0x8a)](_0x1a3ab6*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x15b81a(0x8a)](_0x5b7796*0x64)/0x64,'paymentsCount':_0x28811c[_0x15b81a(0xc8)],'oldestPaymentDate':_0x2ddb30,'gatewayBreakdown':_0x1aa2c2});}_0x234947[_0x15b81a(0xde)]((_0x5aef59,_0x5de18f)=>_0x5de18f[_0x15b81a(0xfb)]-_0x5aef59[_0x15b81a(0xfb)]);const _0x305c4=_0x234947[_0x15b81a(0xc8)],_0x520029=_0x234947[_0x15b81a(0xdb)]((_0x26b355,_0x2bca83)=>_0x26b355+_0x2bca83['totalAmountUSDT'],0x0),_0x5dad63=_0x234947[_0x15b81a(0xdb)]((_0x5702b7,_0x4cf5ad)=>_0x5702b7+_0x4cf5ad[_0x15b81a(0xfb)],0x0),_0x53843e=(_0x562dc5-0x1)*_0x302cc0,_0x12bfd8=_0x234947['slice'](_0x53843e,_0x53843e+_0x302cc0);return console['log'](_0x15b81a(0x13c)+_0x12bfd8[_0x15b81a(0xc8)]+_0x15b81a(0x94)+_0x305c4+_0x15b81a(0x83)),console[_0x15b81a(0x101)]('üí∞\x20Total\x20amount:\x20'+_0x520029['toFixed'](0x2)+'\x20USDT\x20('+_0x5dad63['toFixed'](0x2)+'\x20USDT\x20after\x20commission)'),{'merchants':_0x12bfd8,'pagination':{'page':_0x562dc5,'limit':_0x302cc0,'total':_0x305c4,'totalPages':Math[_0x15b81a(0xa5)](_0x305c4/_0x302cc0)},'summary':{'totalMerchants':_0x305c4,'totalAmountUSDT':Math[_0x15b81a(0x8a)](_0x520029*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x15b81a(0x8a)](_0x5dad63*0x64)/0x64}};}async[a33_0x2d8b13(0x124)](){const _0x941e3d=a33_0x2d8b13;console[_0x941e3d(0x101)]('üìä\x20Calculating\x20admin\x20payout\x20statistics...');const _0x27ac29=await database_1[_0x941e3d(0x148)][_0x941e3d(0xaa)][_0x941e3d(0xf9)]({'where':{'status':{'in':[_0x941e3d(0x11f),_0x941e3d(0xb6),'CHARGEBACK']}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'status':!![],'gateway':!![],'paidAt':!![],'merchantPaid':!![],'createdAt':!![],'chargebackAmount':!![],'shop':{'select':{'gatewaySettings':!![]}}}});console[_0x941e3d(0x101)](_0x941e3d(0xc5)+_0x27ac29[_0x941e3d(0xc8)]+_0x941e3d(0x12a));const _0x417419=new Date(),_0x1477df=new Date(_0x417419[_0x941e3d(0x13d)](),_0x417419[_0x941e3d(0x138)](),0x1),_0x3de527=new Date(_0x417419[_0x941e3d(0x13d)](),_0x417419[_0x941e3d(0x138)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7);let _0x5af815=0x0,_0x5d5ac0=0x0,_0x13385f=0x0,_0x5d7516=0x0;for(const _0x38c517 of _0x27ac29){const _0x225976=this[_0x941e3d(0x9d)](_0x38c517);if(_0x225976===0x0)continue;let _0x5d8b26,_0x10f4ad;if(_0x38c517[_0x941e3d(0x99)]===_0x941e3d(0xba))_0x5d8b26=Math['abs'](_0x225976),_0x10f4ad=-_0x5d8b26;else{_0x5d8b26=await currencyService_1[_0x941e3d(0xfa)]['convertToUSDT'](_0x38c517[_0x941e3d(0xd0)],_0x38c517['currency']);const _0x5bb03c=this[_0x941e3d(0xdf)](_0x38c517[_0x941e3d(0x145)],_0x38c517[_0x941e3d(0x96)]);_0x10f4ad=this[_0x941e3d(0x117)](_0x5d8b26,_0x5bb03c[_0x941e3d(0x131)]);}_0x38c517[_0x941e3d(0x111)]&&(_0x5af815+=_0x10f4ad,_0x38c517[_0x941e3d(0xc9)]&&_0x38c517[_0x941e3d(0xc9)]>=_0x1477df&&_0x38c517[_0x941e3d(0xc9)]<=_0x3de527&&(_0x13385f+=_0x10f4ad)),_0x38c517[_0x941e3d(0x99)]===_0x941e3d(0x11f)&&this[_0x941e3d(0x79)](_0x38c517)&&(_0x5d5ac0+=_0x10f4ad,_0x5d7516+=_0x5d8b26);}const _0x585ba7={'totalPayout':Math[_0x941e3d(0x8a)](_0x5af815*0x64)/0x64,'awaitingPayout':Math['round'](_0x5d5ac0*0x64)/0x64,'thisMonth':Math[_0x941e3d(0x8a)](_0x13385f*0x64)/0x64,'availableBalance':Math[_0x941e3d(0x8a)](_0x5d7516*0x64)/0x64};return console[_0x941e3d(0x101)](_0x941e3d(0x114)),console[_0x941e3d(0x101)]('üí∏\x20Total\x20Payout:\x20'+_0x585ba7[_0x941e3d(0xd9)]+_0x941e3d(0x134)),console[_0x941e3d(0x101)](_0x941e3d(0x9a)+_0x585ba7[_0x941e3d(0x9e)]+_0x941e3d(0xec)),console[_0x941e3d(0x101)](_0x941e3d(0xa2)+_0x585ba7[_0x941e3d(0xa8)]+'\x20USDT'),console[_0x941e3d(0x101)]('üí∞\x20Available\x20Balance:\x20'+_0x585ba7[_0x941e3d(0xf5)]+_0x941e3d(0xbb)),_0x585ba7;}async[a33_0x2d8b13(0xcb)](_0x56b56c){const _0x3ec06c=a33_0x2d8b13,_0x336c7a=this[_0x3ec06c(0xc0)](_0x56b56c),_0x12d403=new Date();_0x12d403[_0x3ec06c(0xda)](_0x12d403[_0x3ec06c(0xcd)]()-_0x336c7a),console[_0x3ec06c(0x101)](_0x3ec06c(0xb5)+_0x56b56c+'\x20('+_0x336c7a+_0x3ec06c(0x125));const _0x3898a4=await database_1[_0x3ec06c(0x148)][_0x3ec06c(0x145)][_0x3ec06c(0xe0)]({'where':{'status':'ACTIVE'}}),_0x355b93=await database_1[_0x3ec06c(0x148)]['payment'][_0x3ec06c(0xe0)](),_0x3e7a13=await database_1[_0x3ec06c(0x148)]['payment'][_0x3ec06c(0xf9)]({'where':{'status':{'in':['PAID','REFUND',_0x3ec06c(0xba)]}},'select':{'amount':!![],'currency':!![],'status':!![],'chargebackAmount':!![],'createdAt':!![]}});console[_0x3ec06c(0x101)](_0x3ec06c(0xc5)+_0x3e7a13[_0x3ec06c(0xc8)]+'\x20payments\x20for\x20revenue\x20calculation\x20(PAID/REFUND/CHARGEBACK)');const _0x155a5c=await Promise['all'](_0x3e7a13['map'](async _0x1955eb=>{const _0x3fc4d8=_0x3ec06c,_0x1e45ff=this['calculateEffectiveAmount'](_0x1955eb);if(_0x1e45ff===0x0)return{'amount':0x0,'createdAt':_0x1955eb[_0x3fc4d8(0x132)]};let _0x26a36b;return _0x1955eb['status']===_0x3fc4d8(0xba)?_0x26a36b=-Math[_0x3fc4d8(0x90)](_0x1e45ff):_0x26a36b=await currencyService_1[_0x3fc4d8(0xfa)][_0x3fc4d8(0x143)](_0x1955eb[_0x3fc4d8(0xd0)],_0x1955eb[_0x3fc4d8(0xcc)]),{'amount':_0x26a36b,'createdAt':_0x1955eb[_0x3fc4d8(0x132)]};})),_0x344661=_0x155a5c[_0x3ec06c(0xdb)]((_0x21bf2f,_0x230223)=>_0x21bf2f+_0x230223[_0x3ec06c(0xd0)],0x0),_0x2e5cf8=_0x355b93>0x0?_0x344661/_0x355b93:0x0;console[_0x3ec06c(0x101)](_0x3ec06c(0x86)+_0x344661[_0x3ec06c(0x13e)](0x2)+_0x3ec06c(0x134)),console[_0x3ec06c(0x101)]('üìà\x20Average\x20payment:\x20'+_0x2e5cf8[_0x3ec06c(0x13e)](0x2)+_0x3ec06c(0xbb));const _0xe5f1d7=await database_1[_0x3ec06c(0x148)][_0x3ec06c(0xea)]`
      SELECT 
        DATE(created_at) as date,
        array_agg(
          json_build_object(
            'amount', amount,
            'currency', currency,
            'status', status,
            'chargeback_amount', chargeback_amount
          )
        ) as payments
      FROM payments 
      WHERE created_at >= ${_0x12d403}
        AND status IN ('PAID', 'REFUND', 'CHARGEBACK')
      GROUP BY DATE(created_at)
      ORDER BY date ASC
    `;console[_0x3ec06c(0x101)]('üìÖ\x20Processing\x20daily\x20stats\x20for\x20'+_0xe5f1d7[_0x3ec06c(0xc8)]+'\x20days');const _0x3a22e3=await Promise['all'](_0xe5f1d7[_0x3ec06c(0x119)](async _0x29f98d=>{const _0x19e85e=_0x3ec06c,_0x3a4b47=await Promise['all'](_0x29f98d[_0x19e85e(0x7c)][_0x19e85e(0x119)](async _0x399185=>{const _0x412946=_0x19e85e,_0x5488d3=this[_0x412946(0x9d)](_0x399185);if(_0x5488d3===0x0)return 0x0;return _0x399185[_0x412946(0x99)]===_0x412946(0xba)?-Math['abs'](_0x5488d3):await currencyService_1['currencyService']['convertToUSDT'](_0x399185[_0x412946(0xd0)],_0x399185[_0x412946(0xcc)]);})),_0x3bc325=_0x3a4b47['reduce']((_0x7af845,_0x2032a3)=>_0x7af845+_0x2032a3,0x0);return{'date':_0x29f98d['date'][_0x19e85e(0x128)]()[_0x19e85e(0xc4)]('T')[0x0],'amount':_0x3bc325};})),_0x5b22eb=this['generateDateRange'](_0x12d403,new Date()),_0x1ab1fe=new Map(_0x3a22e3[_0x3ec06c(0x119)](_0x32a13b=>[_0x32a13b[_0x3ec06c(0x123)],_0x32a13b[_0x3ec06c(0xd0)]])),_0x3247ca=_0x5b22eb[_0x3ec06c(0x119)](_0x33c58f=>({'date':_0x33c58f,'amount':_0x1ab1fe[_0x3ec06c(0xf6)](_0x33c58f)||0x0}));return console[_0x3ec06c(0x101)](_0x3ec06c(0x115)),console[_0x3ec06c(0x101)](_0x3ec06c(0xf8)+_0x3898a4),console[_0x3ec06c(0x101)]('üí≥\x20Total\x20payments:\x20'+_0x355b93),console[_0x3ec06c(0x101)](_0x3ec06c(0x8d)+_0x3247ca[_0x3ec06c(0xc8)]),{'totalRevenue':Math[_0x3ec06c(0x8a)](_0x344661*0x64)/0x64,'totalUsers':_0x3898a4,'totalPayments':_0x355b93,'averagePayment':Math['round'](_0x2e5cf8*0x64)/0x64,'dailyRevenue':_0x3247ca};}async[a33_0x2d8b13(0x120)](_0x5d308a){const _0x389e46=a33_0x2d8b13,{page:_0x823abb,limit:_0x52c7af,status:_0x598976,gateway:_0x232215,shopId:_0x5a00cd,dateFrom:_0x5b067f,dateTo:_0x59cbe0,search:_0xb60f07}=_0x5d308a,_0x3f5f0c=(_0x823abb-0x1)*_0x52c7af;console[_0x389e46(0x101)](_0x389e46(0xbd),_0x5d308a);const _0x48a393={};_0x598976&&(_0x48a393[_0x389e46(0x99)]=_0x598976[_0x389e46(0xd1)]());if(_0x232215){if((0x0,gateway_1[_0x389e46(0x116)])(_0x232215)){const _0x39663c=(0x0,gateway_1[_0x389e46(0x10f)])(_0x232215);_0x39663c&&(_0x48a393[_0x389e46(0x96)]=_0x39663c);}else _0x48a393['gateway']=_0x232215[_0x389e46(0xf2)]();}_0x5a00cd&&(_0x48a393[_0x389e46(0x10e)]=_0x5a00cd);(_0x5b067f||_0x59cbe0)&&(_0x48a393['createdAt']={},_0x5b067f&&(_0x48a393['createdAt'][_0x389e46(0x9c)]=new Date(_0x5b067f)),_0x59cbe0&&(_0x48a393['createdAt'][_0x389e46(0x13f)]=new Date(_0x59cbe0)));_0xb60f07&&(_0x48a393['OR']=[{'orderId':{'contains':_0xb60f07,'mode':_0x389e46(0x13a)}},{'gatewayOrderId':{'contains':_0xb60f07,'mode':'insensitive'}},{'gatewayPaymentId':{'contains':_0xb60f07,'mode':_0x389e46(0x13a)}},{'customerEmail':{'contains':_0xb60f07,'mode':'insensitive'}},{'customerName':{'contains':_0xb60f07,'mode':_0x389e46(0x13a)}},{'shop':{'name':{'contains':_0xb60f07,'mode':_0x389e46(0x13a)}}},{'shop':{'username':{'contains':_0xb60f07,'mode':_0x389e46(0x13a)}}}]);const [_0x46efd4,_0x545d88]=await Promise[_0x389e46(0xa1)]([database_1[_0x389e46(0x148)][_0x389e46(0xaa)][_0x389e46(0xf9)]({'where':_0x48a393,'skip':_0x3f5f0c,'take':_0x52c7af,'orderBy':{'createdAt':_0x389e46(0x147)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default'][_0x389e46(0xaa)][_0x389e46(0xe0)]({'where':_0x48a393})]);console[_0x389e46(0x101)](_0x389e46(0x12b)+_0x46efd4[_0x389e46(0xc8)]+'\x20payments\x20out\x20of\x20'+_0x545d88+'\x20total');const _0x437b0a=_0x46efd4['map'](_0x4e5a78=>({'id':_0x4e5a78['id'],'shopId':_0x4e5a78[_0x389e46(0x10e)],'shopName':_0x4e5a78[_0x389e46(0x145)][_0x389e46(0xb3)],'shopUsername':_0x4e5a78[_0x389e46(0x145)][_0x389e46(0x11b)],'gateway':_0x4e5a78[_0x389e46(0x96)],'orderId':_0x4e5a78[_0x389e46(0x100)],'gatewayOrderId':_0x4e5a78['gatewayOrderId'],'amount':_0x4e5a78[_0x389e46(0xd0)],'currency':_0x4e5a78[_0x389e46(0xcc)],'sourceCurrency':_0x4e5a78['sourceCurrency'],'status':_0x4e5a78[_0x389e46(0x99)],'usage':_0x4e5a78[_0x389e46(0xb1)],'externalPaymentUrl':_0x4e5a78[_0x389e46(0xa7)],'gatewayPaymentId':_0x4e5a78[_0x389e46(0x110)],'customerEmail':_0x4e5a78[_0x389e46(0x12c)],'customerName':_0x4e5a78[_0x389e46(0x78)],'cardLast4':_0x4e5a78[_0x389e46(0x139)],'paymentMethod':_0x4e5a78['paymentMethod'],'bankId':_0x4e5a78[_0x389e46(0xfc)],'remitterIban':_0x4e5a78['remitterIban'],'remitterName':_0x4e5a78[_0x389e46(0x137)],'chargebackAmount':_0x4e5a78[_0x389e46(0xeb)],'adminNotes':_0x4e5a78[_0x389e46(0x142)],'statusChangedBy':_0x4e5a78[_0x389e46(0x126)],'statusChangedAt':_0x4e5a78[_0x389e46(0x133)],'createdAt':_0x4e5a78['createdAt'],'updatedAt':_0x4e5a78['updatedAt'],'expiresAt':_0x4e5a78['expiresAt']}));return{'payments':_0x437b0a,'pagination':{'page':_0x823abb,'limit':_0x52c7af,'total':_0x545d88,'totalPages':Math[_0x389e46(0xa5)](_0x545d88/_0x52c7af)}};}async[a33_0x2d8b13(0x92)](_0xaa69c){const _0x3e98da=a33_0x2d8b13;console[_0x3e98da(0x101)](_0x3e98da(0x130)+_0xaa69c);const _0x2f6b4e=await database_1[_0x3e98da(0x148)][_0x3e98da(0xaa)][_0x3e98da(0xef)]({'where':{'id':_0xaa69c},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}},'webhookLogs':{'orderBy':{'createdAt':_0x3e98da(0x147)},'take':0xa,'select':{'id':!![],'event':!![],'statusCode':!![],'retryCount':!![],'createdAt':!![]}}}});if(!_0x2f6b4e)return console[_0x3e98da(0x101)](_0x3e98da(0xbf)+_0xaa69c),null;return console[_0x3e98da(0x101)]('‚úÖ\x20Found\x20payment:\x20'+_0x2f6b4e[_0x3e98da(0x100)]+'\x20('+_0x2f6b4e[_0x3e98da(0x99)]+')'),{'id':_0x2f6b4e['id'],'shopId':_0x2f6b4e[_0x3e98da(0x10e)],'shopName':_0x2f6b4e[_0x3e98da(0x145)][_0x3e98da(0xb3)],'shopUsername':_0x2f6b4e[_0x3e98da(0x145)][_0x3e98da(0x11b)],'gateway':_0x2f6b4e[_0x3e98da(0x96)],'orderId':_0x2f6b4e[_0x3e98da(0x100)],'gatewayOrderId':_0x2f6b4e[_0x3e98da(0xff)],'amount':_0x2f6b4e[_0x3e98da(0xd0)],'currency':_0x2f6b4e[_0x3e98da(0xcc)],'sourceCurrency':_0x2f6b4e[_0x3e98da(0x84)],'status':_0x2f6b4e['status'],'usage':_0x2f6b4e[_0x3e98da(0xb1)],'externalPaymentUrl':_0x2f6b4e[_0x3e98da(0xa7)],'gatewayPaymentId':_0x2f6b4e[_0x3e98da(0x110)],'customerEmail':_0x2f6b4e['customerEmail'],'customerName':_0x2f6b4e['customerName'],'cardLast4':_0x2f6b4e[_0x3e98da(0x139)],'paymentMethod':_0x2f6b4e[_0x3e98da(0xd4)],'bankId':_0x2f6b4e[_0x3e98da(0xfc)],'remitterIban':_0x2f6b4e[_0x3e98da(0xd3)],'remitterName':_0x2f6b4e['remitterName'],'chargebackAmount':_0x2f6b4e[_0x3e98da(0xeb)],'adminNotes':_0x2f6b4e[_0x3e98da(0x142)],'statusChangedBy':_0x2f6b4e[_0x3e98da(0x126)],'statusChangedAt':_0x2f6b4e[_0x3e98da(0x133)],'createdAt':_0x2f6b4e[_0x3e98da(0x132)],'updatedAt':_0x2f6b4e[_0x3e98da(0xae)],'expiresAt':_0x2f6b4e[_0x3e98da(0x7d)],'webhookLogs':_0x2f6b4e[_0x3e98da(0xce)]};}async[a33_0x2d8b13(0x7a)](_0x2646f7,_0x574799,_0x1b1e21,_0x2da608){const _0x28f25b=a33_0x2d8b13;console[_0x28f25b(0x101)](_0x28f25b(0xab)+_0x2646f7+_0x28f25b(0x113)+_0x574799);const _0x23afe5=[_0x28f25b(0x91),'PROCESSING',_0x28f25b(0x11f),_0x28f25b(0x146),'FAILED','REFUND',_0x28f25b(0xba)];if(!_0x23afe5[_0x28f25b(0x13b)](_0x574799['toUpperCase']()))throw new Error(_0x28f25b(0x14a)+_0x23afe5[_0x28f25b(0x112)](',\x20'));const _0x1aefd2=await database_1[_0x28f25b(0x148)]['payment'][_0x28f25b(0xef)]({'where':{'id':_0x2646f7},'select':{'id':!![],'status':!![],'orderId':!![]}});if(!_0x1aefd2)throw new Error(_0x28f25b(0x109));if(_0x574799['toUpperCase']()===_0x28f25b(0xba)){if(!_0x2da608||_0x2da608<=0x0)throw new Error(_0x28f25b(0x127));console[_0x28f25b(0x101)](_0x28f25b(0xb0)+_0x2da608+_0x28f25b(0xdc));}const _0x35186d={'status':_0x574799[_0x28f25b(0xd1)](),'updatedAt':new Date()};_0x1b1e21&&(_0x35186d[_0x28f25b(0x142)]=_0x1b1e21);_0x574799[_0x28f25b(0xd1)]()===_0x28f25b(0xba)&&_0x2da608&&(_0x35186d['chargebackAmount']=_0x2da608);const _0x1a5ee5=await database_1[_0x28f25b(0x148)][_0x28f25b(0xaa)][_0x28f25b(0xa3)]({'where':{'id':_0x2646f7},'data':_0x35186d,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});return await database_1[_0x28f25b(0x148)][_0x28f25b(0x141)][_0x28f25b(0xc3)]({'data':{'paymentId':_0x2646f7,'shopId':_0x1a5ee5[_0x28f25b(0x10e)],'event':_0x28f25b(0xad),'statusCode':0xc8,'responseBody':JSON[_0x28f25b(0x80)]({'oldStatus':_0x1aefd2[_0x28f25b(0x99)],'newStatus':_0x574799[_0x28f25b(0xd1)](),'notes':_0x1b1e21||null,'chargebackAmount':_0x2da608||null,'timestamp':new Date()['toISOString']()})}}),console['log'](_0x28f25b(0x104)+_0x1aefd2['orderId']+_0x28f25b(0x9f)+_0x1aefd2[_0x28f25b(0x99)]+_0x28f25b(0x105)+_0x574799[_0x28f25b(0xd1)]()),_0x574799[_0x28f25b(0xd1)]()===_0x28f25b(0xba)&&console[_0x28f25b(0x101)](_0x28f25b(0xe9)+_0x2da608+'\x20USDT\x20(will\x20be\x20deducted\x20from\x20merchant\x20balance)'),{'id':_0x1a5ee5['id'],'shopId':_0x1a5ee5[_0x28f25b(0x10e)],'shopName':_0x1a5ee5['shop']['name'],'shopUsername':_0x1a5ee5[_0x28f25b(0x145)][_0x28f25b(0x11b)],'gateway':_0x1a5ee5[_0x28f25b(0x96)],'orderId':_0x1a5ee5[_0x28f25b(0x100)],'gatewayOrderId':_0x1a5ee5[_0x28f25b(0xff)],'amount':_0x1a5ee5[_0x28f25b(0xd0)],'currency':_0x1a5ee5[_0x28f25b(0xcc)],'sourceCurrency':_0x1a5ee5[_0x28f25b(0x84)],'status':_0x1a5ee5[_0x28f25b(0x99)],'usage':_0x1a5ee5[_0x28f25b(0xb1)],'externalPaymentUrl':_0x1a5ee5['externalPaymentUrl'],'gatewayPaymentId':_0x1a5ee5[_0x28f25b(0x110)],'customerEmail':_0x1a5ee5[_0x28f25b(0x12c)],'customerName':_0x1a5ee5['customerName'],'cardLast4':_0x1a5ee5[_0x28f25b(0x139)],'paymentMethod':_0x1a5ee5[_0x28f25b(0xd4)],'bankId':_0x1a5ee5['bankId'],'remitterIban':_0x1a5ee5[_0x28f25b(0xd3)],'remitterName':_0x1a5ee5[_0x28f25b(0x137)],'chargebackAmount':_0x1a5ee5[_0x28f25b(0xeb)],'adminNotes':_0x1a5ee5[_0x28f25b(0x142)],'statusChangedBy':_0x1a5ee5['statusChangedBy'],'statusChangedAt':_0x1a5ee5[_0x28f25b(0x133)],'createdAt':_0x1a5ee5['createdAt'],'updatedAt':_0x1a5ee5['updatedAt'],'expiresAt':_0x1a5ee5[_0x28f25b(0x7d)]};}async[a33_0x2d8b13(0xe2)](_0x495173){const _0x26024f=a33_0x2d8b13,{page:_0x7717d3,limit:_0x344bc7,status:_0x228873}=_0x495173,_0x4cfdac=(_0x7717d3-0x1)*_0x344bc7,_0x4e3dfc={};_0x228873&&(_0x4e3dfc[_0x26024f(0x99)]=_0x228873[_0x26024f(0xd1)]());console['log'](_0x26024f(0x97),{'page':_0x7717d3,'limit':_0x344bc7,'status':_0x228873,'where':_0x4e3dfc});const [_0x40f8a0,_0x188c7d]=await Promise[_0x26024f(0xa1)]([database_1[_0x26024f(0x148)][_0x26024f(0x145)][_0x26024f(0xf9)]({'where':_0x4e3dfc,'skip':_0x4cfdac,'take':_0x344bc7,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x26024f(0x147)}}),database_1[_0x26024f(0x148)][_0x26024f(0x145)][_0x26024f(0xe0)]({'where':_0x4e3dfc})]);console['log'](_0x26024f(0x12b)+_0x40f8a0[_0x26024f(0xc8)]+_0x26024f(0x121)+_0x188c7d+'\x20total');const _0x5e8331=_0x40f8a0[_0x26024f(0x119)](_0x4a0ab3=>({'id':_0x4a0ab3['id'],'fullName':_0x4a0ab3[_0x26024f(0xb3)],'username':_0x4a0ab3[_0x26024f(0x11b)],'telegramId':_0x4a0ab3['telegram'],'merchantUrl':_0x4a0ab3[_0x26024f(0xd7)],'gateways':_0x4a0ab3['paymentGateways']?JSON['parse'](_0x4a0ab3['paymentGateways']):null,'gatewaySettings':_0x4a0ab3['gatewaySettings']?JSON['parse'](_0x4a0ab3['gatewaySettings']):null,'publicKey':_0x4a0ab3[_0x26024f(0xcf)],'wallets':{'usdtPolygonWallet':_0x4a0ab3[_0x26024f(0x11d)],'usdtTrcWallet':_0x4a0ab3[_0x26024f(0xd8)],'usdtErcWallet':_0x4a0ab3[_0x26024f(0x149)],'usdcPolygonWallet':_0x4a0ab3['usdcPolygonWallet']},'status':_0x4a0ab3[_0x26024f(0x99)],'createdAt':_0x4a0ab3[_0x26024f(0x132)]}));return{'users':_0x5e8331,'pagination':{'page':_0x7717d3,'limit':_0x344bc7,'total':_0x188c7d,'totalPages':Math[_0x26024f(0xa5)](_0x188c7d/_0x344bc7)}};}async[a33_0x2d8b13(0x7f)](_0x1958c9){const _0x2a3a36=a33_0x2d8b13;return await this[_0x2a3a36(0x85)][_0x2a3a36(0x7f)](_0x1958c9);}async['createUser'](_0x15b40d){const _0x319e34=a33_0x2d8b13;return await this[_0x319e34(0x85)][_0x319e34(0xe3)](_0x15b40d);}async['updateUser'](_0x2cca65,_0x1b0836){const _0x577b9c=a33_0x2d8b13;return await this['userService'][_0x577b9c(0xf7)](_0x2cca65,_0x1b0836);}async[a33_0x2d8b13(0x7e)](_0x45f590){const _0x321883=a33_0x2d8b13;return await this['userService'][_0x321883(0x7e)](_0x45f590);}async[a33_0x2d8b13(0x10d)](_0x527a60){const _0x19d492=a33_0x2d8b13;console['log'](_0x19d492(0x12f)+_0x527a60);const _0x9bf92c=await database_1[_0x19d492(0x148)]['shop']['findUnique']({'where':{'id':_0x527a60},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x9bf92c)throw new Error('User\x20not\x20found');if(_0x9bf92c[_0x19d492(0x99)]===_0x19d492(0xb4))throw new Error(_0x19d492(0x107));const _0x49b89d=await this[_0x19d492(0x85)]['updateUser'](_0x527a60,{'status':_0x19d492(0xb4)});return console[_0x19d492(0x101)](_0x19d492(0xf1)+_0x9bf92c[_0x19d492(0x11b)]+_0x19d492(0xc6)),_0x49b89d;}async[a33_0x2d8b13(0x108)](_0x385f82){const _0x4f0b44=a33_0x2d8b13;console[_0x4f0b44(0x101)](_0x4f0b44(0xb2)+_0x385f82);const _0x344842=await database_1['default']['shop'][_0x4f0b44(0xef)]({'where':{'id':_0x385f82},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x344842)throw new Error(_0x4f0b44(0xa6));if(_0x344842[_0x4f0b44(0x99)]===_0x4f0b44(0xe5))throw new Error(_0x4f0b44(0xa9));const _0xa509c=await this[_0x4f0b44(0x85)][_0x4f0b44(0xf7)](_0x385f82,{'status':_0x4f0b44(0xe5)});return console['log'](_0x4f0b44(0xf1)+_0x344842[_0x4f0b44(0x11b)]+'\x20activated\x20successfully'),_0xa509c;}}exports[a33_0x2d8b13(0x136)]=AdminService;