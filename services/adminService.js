'use strict';const a35_0x471a84=a35_0x1279;(function(_0x344760,_0x2a17ad){const _0x224d22=a35_0x1279,_0x2a2448=_0x344760();while(!![]){try{const _0xdd8bc3=-parseInt(_0x224d22(0x231))/0x1+-parseInt(_0x224d22(0x209))/0x2*(parseInt(_0x224d22(0x1d9))/0x3)+-parseInt(_0x224d22(0x253))/0x4+parseInt(_0x224d22(0x2c8))/0x5*(-parseInt(_0x224d22(0x1e5))/0x6)+-parseInt(_0x224d22(0x2c4))/0x7+parseInt(_0x224d22(0x1d8))/0x8*(parseInt(_0x224d22(0x222))/0x9)+parseInt(_0x224d22(0x2d3))/0xa;if(_0xdd8bc3===_0x2a17ad)break;else _0x2a2448['push'](_0x2a2448['shift']());}catch(_0x25c429){_0x2a2448['push'](_0x2a2448['shift']());}}}(a35_0x385f,0xbada1));function a35_0x1279(_0x15bd0d,_0x4707e1){const _0x385f1a=a35_0x385f();return a35_0x1279=function(_0x127983,_0x177375){_0x127983=_0x127983-0x1bf;let _0x130f2e=_0x385f1a[_0x127983];return _0x130f2e;},a35_0x1279(_0x15bd0d,_0x4707e1);}var __importDefault=this&&this[a35_0x471a84(0x20c)]||function(_0x38da8b){const _0x2a4618=a35_0x471a84;return _0x38da8b&&_0x38da8b[_0x2a4618(0x234)]?_0x38da8b:{'default':_0x38da8b};};function a35_0x385f(){const _0x1458a0=['\x20\x20\x20👤\x20Merchant\x20earnings:\x20','convertToUSDT','90d','randomBytes','Open\x20Banking\x202','⚠️\x20Payment\x20','createdAt','test_gateway','gatewaySettings','averageCommissionRate','\x20USDT\x20(','\x20\x20\x20Merchant\x20gets:\x20','period','💰\x20Current\x20shop\x20balance:\x20','\x20\x20\x20Full\x20amount:\x20','shopUrl','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','whiteUrl','telegram','\x20\x20\x20Payout\x20amount:\x20','updatedAt','\x20\x20\x20💰\x20Total\x20payout:\x20','📊\x20Gateway\x20filter\x20applied:','ACTIVE','stringify','balance','error','\x20\x20\x20Added\x20to\x20balance:\x20+','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','\x27\x20->\x20name\x20\x27','deleteUser','\x20USDT\x20(without\x20commission)','getPayoutStats','shop','not\x20specified','\x20balance\x20updated:\x20','merchantEarnings','adminNotes','updatePaymentStatus','map','values','getPaymentById','awaitingPayout','length','wallets','not\x20set','findMany','\x20paid\x20payments\x20for\x20analysis','turnoverUSDT','toString','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','KLYME\x20DE','amountUSDT','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','plisio','Insufficient\x20balance.\x20Available:\x20','commissionUSDT','🔄\x20Converted\x20gateway\x20ID\x20\x27','\x20PAID\x20payments','orderId','getTime','../config/database','🔄\x20Gateway\x20mapping:','\x20\x20\x20📅\x20Total\x20payouts\x20(this\x20month):\x20','💰\x20Creating\x20payout\x20for\x20shop\x20','\x20to\x20','totalPaidOut','sk_','🔍\x20Using\x20gateway\x20\x27','pk_','Username\x20already\x20exists','aggregate','externalPaymentUrl','year','📊\x20Sorting\x20payments\x20by\x20','rapyd','3037930azJGdl','all','week','COMPLETED','2037220XZGURy','💰\x20Found\x20','\x20\x20\x20💰\x20Total\x20payments\x20turnover:\x20','totalAmountAfterCommissionUSDT','\x27\x20not\x20found.\x20Available\x20gateways:\x20','includes','🔄\x20Admin\x20updating\x20payment\x20','update','get','getUserById','\x20USDT\x20(-','36472820CsxmKy','commission','txid','usdtErcWallet','dailyRevenue','gateways','merchantEarningsUSDT','✅\x20Payout\x20created:\x20','date','\x20USDT\x20(+','Test\x20Gateway','fullName','summary','\x20->\x20','\x20merchants','totalPayments','some','🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','totalCommissionRate','MasterCard','toISOString','%\x20commission)','failUrl','\x20\x20\x20Current\x20balance:\x20','gte','push','polygon_usdc','Telegram\x20username\x20already\x20exists','customerCountry','\x20USDT,\x20Requested:\x20','\x20no\x20longer\x20PAID:','reduce','periodFrom','setDate','findFirst','create','REFUND','revenue','\x20\x20\x20💵\x20Available\x20balance:\x20','💰\x20[PAYOUT]\x20Merchant\x20','📊\x20Calculating\x20payout\x20statistics...','\x20\x20\x20Transaction\x20hash:\x20','set','📊\x20Merchants\x20awaiting\x20payout:\x20','customerUa','deletePayout',',\x20successful:\x20','network','delete','55400VCfdfB','573vUTAFA','\x20\x20\x20🌍\x20Country:\x20','getGatewayNameById','KLYME\x20EU','payout','currencyService','toUpperCase','\x20\x20\x20🔍\x20Calculated\x20after\x20commission:\x20','AdminService','Shop\x20not\x20found','Payment\x20not\x20found','entries','12OUQggv','CHARGEBACK','telegramId','getMonth','shopId','month','\x20\x20\x20📊\x20Commission\x20difference:\x20','pendingUrl','failureMessage','createUser','toFixed','📋\x20Getting\x20merchants\x20selection\x20list...','dateTo','\x20USDT','hex','\x20USDT\x20from\x20balance','amountAfterCommissionUSDT','dailyPayments','toLowerCase','totalAmountUSDT','statusChangedBy','💰\x20Shop\x20','round','\x20active\x20merchants\x20for\x20selection','thisMonth','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','\x20\x20\x20🔍\x20Raw\x20balance\x20sum:\x20','cointopay2','sort','amount','_count','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','usdcPolygonWallet','turnover','$transaction','📊\x20Getting\x20payments\x20with\x20filters:','10014rMniOR','hash','📅\x20Period:\x20','__importDefault','paidAt','periodTo','\x20USDT\x20(after\x20payouts)','getGatewayDisplayName','totalPayout','insensitive','NONEXISTENT_GATEWAY_FILTER','averageCheckUSDT','💸\x20CHARGEBACK:\x20Merchant\x20amount\x20already\x20deducted\x20from\x20balance','notes','getAllUsers','split','getMerchantsSelection','name','forEach','join','klyme_de','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','chargebackAmount','📊\x20Merchant\x20statistics\x20calculated:','paymentGateways','801wXGUxK','\x20\x20\x20Gateway:\x20','username','findUnique','totalTurnover','updateCustomerData','getGatewayIdByName','\x20\x20\x20Merchant\x20loses:\x20','\x20USDT\x20(total\x20paid\x20to\x20merchants)','💰\x20[PAYOUT]\x20Gateway\x20','getFullYear','currency','defineProperty','crypto','\x20for\x20shop\x20','980850oSRwxy','count','custom','__esModule','\x20\x20\x20📊\x20Total\x20payments:\x20','CoinToPay','\x20USDT\x20(same\x20as\x20awaiting)','usdtTrcWallet','activateUser','🔄\x20Gateway\x20mapping\x20(get):','./currencyService','\x20\x20\x20💸\x20Total\x20payouts\x20(all\x20time):\x20','publicKey','createPayout','📋\x20Found\x20','usdtPolygonWallet','💳\x20Payout\x20wallet\x20for\x20','SUSPENDED','ceil','customerName','merchantUrl','getGatewayInternalName','bcryptjs','mastercard','📊\x20Payout\x20statistics\x20calculated:','\x20USDT\x20(gross\x20revenue)','paymentsCount',',\x20Commission:\x20','noda','\x20became\x20PAID:','customerEmail','📅\x20Period\x20\x27all\x27:\x20Using\x20start\x20date\x20from\x20first\x20payment:\x20','klyme_gb',':\x20commission\x20=\x20','1248788ZxFvBx','\x20\x20\x20🖥️\x20User\x20Agent:\x20','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','getAllPayments','📊\x20Total\x20payments\x20(including\x20failed):\x20','password','Plisio','gateway','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','status','gatewayEarnings','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','getMerchantsAwaitingPayout','\x27\x20(from\x20\x27','parse','PAID','default','klyme_eu','_sum','../types/gateway','\x20USDT\x20(actual\x20balances)','📊\x20Final\x20WHERE\x20conditions:','customerIp','30d','payment','getPayoutById','\x20status:\x20','asc','trc20','lte','successUrl','desc','2020-01-01','admin','\x20\x20\x20✅\x20Total\x20available\x20for\x20payout:\x20','log','\x20USDT\x20(with\x20commission\x20deducted)'];a35_0x385f=function(){return _0x1458a0;};return a35_0x385f();}Object[a35_0x471a84(0x22e)](exports,a35_0x471a84(0x234),{'value':!![]}),exports[a35_0x471a84(0x1e1)]=void 0x0;const database_1=__importDefault(require(a35_0x471a84(0x2b5))),bcryptjs_1=__importDefault(require(a35_0x471a84(0x247))),crypto_1=__importDefault(require(a35_0x471a84(0x22f))),currencyService_1=require(a35_0x471a84(0x23b)),gateway_1=require(a35_0x471a84(0x266));class AdminService{async[a35_0x471a84(0x298)](){const _0x202f9d=a35_0x471a84;console[_0x202f9d(0x276)](_0x202f9d(0x1cf));const _0xccfc53=await database_1[_0x202f9d(0x263)][_0x202f9d(0x299)][_0x202f9d(0x2bf)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x202f9d(0x28f)}}),_0x43e641=await this[_0x202f9d(0x25f)]({'page':0x1,'limit':0x3e8}),_0x1fc1ab=await database_1['default'][_0x202f9d(0x26b)]['count']({'where':{'status':_0x202f9d(0x262),'gateway':{'not':_0x202f9d(0x27f)}}}),_0x350d17=new Date(),_0x4c25e6=new Date(_0x350d17[_0x202f9d(0x22c)](),_0x350d17[_0x202f9d(0x1e8)](),0x1),_0x51a561=new Date(_0x350d17['getFullYear'](),_0x350d17[_0x202f9d(0x1e8)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x108f5e=await database_1[_0x202f9d(0x263)][_0x202f9d(0x1dd)][_0x202f9d(0x2bf)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x4c25e6,'lte':_0x51a561},'status':_0x202f9d(0x2c7)}}),_0x3eb72b=_0xccfc53[_0x202f9d(0x265)][_0x202f9d(0x2ba)]||0x0,_0x5ed41d=_0x43e641[_0x202f9d(0x2df)][_0x202f9d(0x2cb)],_0x597d9e=_0x108f5e[_0x202f9d(0x265)][_0x202f9d(0x202)]||0x0,_0x19a5db={'totalPayout':Math['round'](_0x3eb72b*0x64)/0x64,'awaitingPayout':Math[_0x202f9d(0x1fb)](_0x5ed41d*0x64)/0x64,'thisMonth':Math[_0x202f9d(0x1fb)](_0x597d9e*0x64)/0x64,'availableBalance':Math[_0x202f9d(0x1fb)](_0x5ed41d*0x64)/0x64,'totalPayments':_0x1fc1ab};return console[_0x202f9d(0x276)](_0x202f9d(0x249)),console[_0x202f9d(0x276)](_0x202f9d(0x28d)+_0x19a5db[_0x202f9d(0x211)]+_0x202f9d(0x22a)),console[_0x202f9d(0x276)](_0x202f9d(0x255)+_0x19a5db[_0x202f9d(0x2a2)]+_0x202f9d(0x277)),console[_0x202f9d(0x276)](_0x202f9d(0x1cd)+_0x19a5db['availableBalance']+_0x202f9d(0x237)),console['log']('\x20\x20\x20📅\x20This\x20month:\x20'+_0x19a5db[_0x202f9d(0x1fd)]+_0x202f9d(0x1f2)),console[_0x202f9d(0x276)]('\x20\x20\x20💳\x20Total\x20payments:\x20'+_0x19a5db[_0x202f9d(0x2e2)]+_0x202f9d(0x2b2)),console[_0x202f9d(0x276)](_0x202f9d(0x1ff)+(_0xccfc53[_0x202f9d(0x265)]['balance']||0x0)['toFixed'](0x2)+_0x202f9d(0x297)),console[_0x202f9d(0x276)](_0x202f9d(0x1eb)+((_0xccfc53[_0x202f9d(0x265)][_0x202f9d(0x291)]||0x0)-_0x5ed41d)[_0x202f9d(0x1ef)](0x2)+_0x202f9d(0x1f2)),_0x19a5db;}async[a35_0x471a84(0x227)](_0x297942,_0x52beef){const _0x22b932=a35_0x471a84;console[_0x22b932(0x276)](_0x22b932(0x25b)+_0x297942+':',_0x52beef);const _0x48fda4=await database_1[_0x22b932(0x263)][_0x22b932(0x26b)][_0x22b932(0x225)]({'where':{'id':_0x297942},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x48fda4)throw new Error(_0x22b932(0x1e3));const _0x4b1fb0={};_0x52beef[_0x22b932(0x1c3)]!==undefined&&(_0x4b1fb0[_0x22b932(0x1c3)]=_0x52beef[_0x22b932(0x1c3)]||null);_0x52beef[_0x22b932(0x269)]!==undefined&&(_0x4b1fb0[_0x22b932(0x269)]=_0x52beef[_0x22b932(0x269)]||null);_0x52beef[_0x22b932(0x1d3)]!==undefined&&(_0x4b1fb0[_0x22b932(0x1d3)]=_0x52beef['customerUa']||null);const _0x577a74=await database_1[_0x22b932(0x263)][_0x22b932(0x26b)][_0x22b932(0x2cf)]({'where':{'id':_0x297942},'data':{..._0x4b1fb0,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x22b932(0x276)]('✅\x20Customer\x20data\x20updated\x20for\x20payment\x20'+_0x297942),console[_0x22b932(0x276)](_0x22b932(0x1da)+_0x48fda4[_0x22b932(0x1c3)]+_0x22b932(0x2e0)+_0x577a74[_0x22b932(0x1c3)]),console[_0x22b932(0x276)]('\x20\x20\x20🌐\x20IP:\x20'+_0x48fda4['customerIp']+_0x22b932(0x2e0)+_0x577a74[_0x22b932(0x269)]),console[_0x22b932(0x276)](_0x22b932(0x254)+(_0x48fda4[_0x22b932(0x1d3)]?_0x22b932(0x1d1):_0x22b932(0x2a5))+'\x20->\x20'+(_0x577a74['customerUa']?_0x22b932(0x1d1):_0x22b932(0x2a5))),_0x577a74;}async['getSystemStatistics'](_0x3a7136){const _0x1bfce1=a35_0x471a84,_0x33044c=new Date();let _0x2d3067;switch(_0x3a7136){case'7d':_0x2d3067=new Date(_0x33044c[_0x1bfce1(0x2b4)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x1bfce1(0x26a):_0x2d3067=new Date(_0x33044c['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x1bfce1(0x27a):_0x2d3067=new Date(_0x33044c[_0x1bfce1(0x2b4)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x1bfce1(0x2c5):const _0x5bfbf2=await database_1[_0x1bfce1(0x263)][_0x1bfce1(0x26b)][_0x1bfce1(0x1c9)]({'where':{'gateway':{'not':_0x1bfce1(0x27f)}},'orderBy':{'createdAt':_0x1bfce1(0x26e)},'select':{'createdAt':!![]}});_0x2d3067=_0x5bfbf2?_0x5bfbf2[_0x1bfce1(0x27e)]:new Date(_0x1bfce1(0x273)),console[_0x1bfce1(0x276)](_0x1bfce1(0x250)+_0x2d3067[_0x1bfce1(0x2e7)]());break;default:_0x2d3067=new Date(_0x33044c[_0x1bfce1(0x2b4)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x43b683,_0x27af34,_0x4a99f5,_0x35c3a4,_0xf133c,_0x4ae9fd,_0x51d7f0]=await Promise[_0x1bfce1(0x2c5)]([database_1[_0x1bfce1(0x263)][_0x1bfce1(0x299)]['count'](),database_1[_0x1bfce1(0x263)]['shop'][_0x1bfce1(0x232)]({'where':{'status':_0x1bfce1(0x28f)}}),database_1[_0x1bfce1(0x263)][_0x1bfce1(0x26b)][_0x1bfce1(0x232)]({'where':{'createdAt':{'gte':_0x2d3067},'gateway':{'not':_0x1bfce1(0x27f)}}}),database_1['default']['payment'][_0x1bfce1(0x232)]({'where':{'status':'PAID','createdAt':{'gte':_0x2d3067},'gateway':{'not':_0x1bfce1(0x27f)}}}),database_1['default'][_0x1bfce1(0x26b)][_0x1bfce1(0x2a6)]({'where':{'status':_0x1bfce1(0x262),'createdAt':{'gte':_0x2d3067},'gateway':{'not':_0x1bfce1(0x27f)}},'select':{'amount':!![],'currency':!![]}}),database_1[_0x1bfce1(0x263)][_0x1bfce1(0x26b)][_0x1bfce1(0x2a6)]({'where':{'gateway':{'not':'test_gateway'}},'take':0xa,'orderBy':{'createdAt':_0x1bfce1(0x272)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x1bfce1(0x263)][_0x1bfce1(0x26b)][_0x1bfce1(0x2a6)]({'where':{'createdAt':{'gte':_0x2d3067},'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x13c87c=0x0;for(const _0x242f5c of _0xf133c){const _0x4bdc47=await currencyService_1[_0x1bfce1(0x1de)][_0x1bfce1(0x279)](_0x242f5c[_0x1bfce1(0x202)],_0x242f5c[_0x1bfce1(0x22d)]);_0x13c87c+=_0x4bdc47;}const _0x35eb18=this['generateDailyStatistics'](_0x51d7f0,_0x2d3067,_0x33044c),_0x19d0d2=_0x4a99f5>0x0?_0x35c3a4/_0x4a99f5*0x64:0x0;return{'totalShops':_0x43b683,'activeShops':_0x27af34,'totalPayments':_0x4a99f5,'successfulPayments':_0x35c3a4,'totalRevenue':Math['round'](_0x13c87c*0x64)/0x64,'conversionRate':Math['round'](_0x19d0d2*0x64)/0x64,'dailyRevenue':_0x35eb18[_0x1bfce1(0x2d7)],'dailyPayments':_0x35eb18[_0x1bfce1(0x1f6)],'recentPayments':_0x4ae9fd[_0x1bfce1(0x29f)](_0x547616=>({'id':_0x547616['id'],'amount':_0x547616['amount'],'currency':_0x547616[_0x1bfce1(0x22d)],'status':_0x547616[_0x1bfce1(0x25c)],'gateway':_0x547616['gateway'],'shop':_0x547616[_0x1bfce1(0x299)],'createdAt':_0x547616[_0x1bfce1(0x27e)]}))};}async['getMerchantStatistics'](_0x8b2394){const _0xfa2590=a35_0x471a84;console['log'](_0xfa2590(0x2ad),_0x8b2394);let _0x2c00e0,_0x5ba99f=new Date();if(_0x8b2394[_0xfa2590(0x284)]===_0xfa2590(0x233)&&_0x8b2394['dateFrom']&&_0x8b2394[_0xfa2590(0x1f1)])_0x2c00e0=new Date(_0x8b2394['dateFrom']),_0x5ba99f=new Date(_0x8b2394['dateTo']);else{const _0x3d66dd=new Date();switch(_0x8b2394[_0xfa2590(0x284)]){case _0xfa2590(0x2c6):_0x2c00e0=new Date(_0x3d66dd[_0xfa2590(0x2b4)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0xfa2590(0x1ea):_0x2c00e0=new Date(_0x3d66dd[_0xfa2590(0x2b4)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0xfa2590(0x2c1):_0x2c00e0=new Date(_0x3d66dd['getTime']()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0xfa2590(0x2c5):default:_0x2c00e0=new Date('2020-01-01');break;}}console['log'](_0xfa2590(0x20b)+_0x2c00e0[_0xfa2590(0x2e7)]()+_0xfa2590(0x2b9)+_0x5ba99f[_0xfa2590(0x2e7)]());const _0x3b513f={'status':_0xfa2590(0x262),'gateway':{'not':_0xfa2590(0x27f)},'paidAt':{'gte':_0x2c00e0,'lte':_0x5ba99f}};_0x8b2394[_0xfa2590(0x1e9)]&&(_0x3b513f[_0xfa2590(0x1e9)]=_0x8b2394[_0xfa2590(0x1e9)]);const _0x3a5ebb=await database_1['default']['payment'][_0xfa2590(0x2a6)]({'where':_0x3b513f,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0xfa2590(0x276)](_0xfa2590(0x2c9)+_0x3a5ebb[_0xfa2590(0x2a3)]+_0xfa2590(0x2a7));const _0x36a248={'gateway':{'not':'test_gateway'},'createdAt':{'gte':_0x2c00e0,'lte':_0x5ba99f}};_0x8b2394[_0xfa2590(0x1e9)]&&(_0x36a248[_0xfa2590(0x1e9)]=_0x8b2394[_0xfa2590(0x1e9)]);const _0x386305=await database_1['default'][_0xfa2590(0x26b)]['count']({'where':_0x36a248});console[_0xfa2590(0x276)](_0xfa2590(0x257)+_0x386305+_0xfa2590(0x1d5)+_0x3a5ebb[_0xfa2590(0x2a3)]);let _0x333a71=0x0,_0x42ae0e=0x0,_0x3338cc=0x0;const _0x3abc35={},_0x3600b3={},_0x3d5680={};for(const _0x3d3d80 of _0x3a5ebb){try{const _0x4ab539=await currencyService_1[_0xfa2590(0x1de)][_0xfa2590(0x279)](_0x3d3d80[_0xfa2590(0x202)],_0x3d3d80[_0xfa2590(0x22d)]);let _0x18a1e0={};if(_0x3d3d80[_0xfa2590(0x299)]['gatewaySettings'])try{_0x18a1e0=JSON[_0xfa2590(0x261)](_0x3d3d80[_0xfa2590(0x299)][_0xfa2590(0x280)]);}catch(_0x461400){console[_0xfa2590(0x292)](_0xfa2590(0x288)+_0x3d3d80[_0xfa2590(0x1e9)]+':',_0x461400);}let _0x1c4b7c={},_0x31fade=0xa;for(const [_0x4e5a70,_0x3e3f3e]of Object[_0xfa2590(0x1e4)](_0x18a1e0)){if(_0x4e5a70[_0xfa2590(0x1f7)]()===_0x3d3d80['gateway'][_0xfa2590(0x1f7)]()){_0x1c4b7c=_0x3e3f3e,_0x31fade=_0x3e3f3e['commission']||0xa;break;}}const _0x2c9ed4=_0x4ab539*(_0x31fade/0x64),_0x4be793=_0x4ab539-_0x2c9ed4;_0x333a71+=_0x4ab539,_0x42ae0e+=_0x4be793,_0x3338cc+=_0x2c9ed4;!_0x3abc35[_0x3d3d80['gateway']]&&(_0x3abc35[_0x3d3d80[_0xfa2590(0x25a)]]={'gateway':_0x3d3d80[_0xfa2590(0x25a)],'gatewayDisplayName':this[_0xfa2590(0x210)](_0x3d3d80['gateway']),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x3abc35[_0x3d3d80[_0xfa2590(0x25a)]]['paymentsCount']++,_0x3abc35[_0x3d3d80[_0xfa2590(0x25a)]]['turnoverUSDT']+=_0x4ab539,_0x3abc35[_0x3d3d80[_0xfa2590(0x25a)]]['commissionUSDT']+=_0x2c9ed4,_0x3abc35[_0x3d3d80['gateway']][_0xfa2590(0x2d9)]+=_0x4be793,_0x3abc35[_0x3d3d80['gateway']][_0xfa2590(0x2e5)]+=_0x31fade;!_0x8b2394['shopId']&&(!_0x3600b3[_0x3d3d80[_0xfa2590(0x1e9)]]&&(_0x3600b3[_0x3d3d80['shopId']]={'shopId':_0x3d3d80[_0xfa2590(0x1e9)],'shopName':_0x3d3d80['shop']['name'],'shopUsername':_0x3d3d80[_0xfa2590(0x299)][_0xfa2590(0x224)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x3600b3[_0x3d3d80[_0xfa2590(0x1e9)]]['paymentsCount']++,_0x3600b3[_0x3d3d80['shopId']][_0xfa2590(0x2a8)]+=_0x4ab539,_0x3600b3[_0x3d3d80[_0xfa2590(0x1e9)]][_0xfa2590(0x2b0)]+=_0x2c9ed4,_0x3600b3[_0x3d3d80[_0xfa2590(0x1e9)]][_0xfa2590(0x2d9)]+=_0x4be793);const _0x3be194=_0x3d3d80['paidAt'][_0xfa2590(0x2e7)]()['split']('T')[0x0];!_0x3d5680[_0x3be194]&&(_0x3d5680[_0x3be194]={'date':_0x3be194,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x3d5680[_0x3be194]['turnover']+=_0x4ab539,_0x3d5680[_0x3be194][_0xfa2590(0x29c)]+=_0x4be793,_0x3d5680[_0x3be194][_0xfa2590(0x25d)]+=_0x2c9ed4,_0x3d5680[_0x3be194]['paymentsCount']++;}catch(_0x3966c0){console['error']('Error\x20processing\x20payment\x20'+_0x3d3d80['id']+':',_0x3966c0);}}Object[_0xfa2590(0x2a0)](_0x3abc35)[_0xfa2590(0x21b)](_0x142b86=>{const _0x12dc5e=_0xfa2590;_0x142b86[_0x12dc5e(0x281)]=_0x142b86['paymentsCount']>0x0?_0x142b86[_0x12dc5e(0x2e5)]/_0x142b86[_0x12dc5e(0x24b)]:0x0,delete _0x142b86[_0x12dc5e(0x2e5)];}),Object[_0xfa2590(0x2a0)](_0x3600b3)[_0xfa2590(0x21b)](_0x1780c9=>{const _0x326fb4=_0xfa2590;_0x1780c9['averageCheckUSDT']=_0x1780c9['paymentsCount']>0x0?_0x1780c9[_0x326fb4(0x2a8)]/_0x1780c9[_0x326fb4(0x24b)]:0x0;});let _0x2d9a97=0x0;if(_0x8b2394['shopId']){const _0x4e514d=await database_1['default'][_0xfa2590(0x1dd)][_0xfa2590(0x2a6)]({'where':{'shopId':_0x8b2394['shopId'],'status':'COMPLETED','createdAt':{'gte':_0x2c00e0,'lte':_0x5ba99f}},'select':{'amount':!![]}});_0x2d9a97=_0x4e514d[_0xfa2590(0x1c6)]((_0xef78f8,_0x1d70d1)=>_0xef78f8+_0x1d70d1[_0xfa2590(0x202)],0x0);}const _0x343564=_0x386305,_0x1a7c64=_0x3a5ebb['length'],_0x138544=_0x1a7c64>0x0?_0x333a71/_0x1a7c64:0x0,_0x3b63bc=_0x343564>0x0?Math[_0xfa2590(0x1fb)](_0x1a7c64/_0x343564*0x2710)/0x64:0x0,_0x3cb5db=Math[_0xfa2590(0x243)]((_0x5ba99f[_0xfa2590(0x2b4)]()-_0x2c00e0[_0xfa2590(0x2b4)]())/(0x3e8*0x3c*0x3c*0x18)),_0x1551d3={'totalTurnover':Math[_0xfa2590(0x1fb)](_0x333a71*0x64)/0x64,'merchantEarnings':Math[_0xfa2590(0x1fb)](_0x42ae0e*0x64)/0x64,'gatewayEarnings':Math[_0xfa2590(0x1fb)](_0x3338cc*0x64)/0x64,'totalPaidOut':Math['round'](_0x2d9a97*0x64)/0x64,'averageCheck':Math[_0xfa2590(0x1fb)](_0x138544*0x64)/0x64,'totalPayments':_0x343564,'successfulPayments':_0x1a7c64,'conversionRate':_0x3b63bc,'gatewayBreakdown':Object[_0xfa2590(0x2a0)](_0x3abc35)[_0xfa2590(0x29f)](_0x47736a=>({..._0x47736a,'turnoverUSDT':Math['round'](_0x47736a[_0xfa2590(0x2a8)]*0x64)/0x64,'commissionUSDT':Math[_0xfa2590(0x1fb)](_0x47736a[_0xfa2590(0x2b0)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0xfa2590(0x1fb)](_0x47736a[_0xfa2590(0x2d9)]*0x64)/0x64,'averageCommissionRate':Math['round'](_0x47736a[_0xfa2590(0x281)]*0x64)/0x64})),'merchantBreakdown':_0x8b2394['shopId']?undefined:Object['values'](_0x3600b3)[_0xfa2590(0x29f)](_0x145270=>({..._0x145270,'turnoverUSDT':Math[_0xfa2590(0x1fb)](_0x145270[_0xfa2590(0x2a8)]*0x64)/0x64,'commissionUSDT':Math[_0xfa2590(0x1fb)](_0x145270[_0xfa2590(0x2b0)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x145270[_0xfa2590(0x2d9)]*0x64)/0x64,'paidOutUSDT':Math[_0xfa2590(0x1fb)](_0x145270['paidOutUSDT']*0x64)/0x64,'averageCheckUSDT':Math[_0xfa2590(0x1fb)](_0x145270[_0xfa2590(0x214)]*0x64)/0x64})),'dailyData':Object[_0xfa2590(0x2a0)](_0x3d5680)[_0xfa2590(0x29f)](_0x172fe1=>({..._0x172fe1,'turnover':Math[_0xfa2590(0x1fb)](_0x172fe1[_0xfa2590(0x206)]*0x64)/0x64,'merchantEarnings':Math[_0xfa2590(0x1fb)](_0x172fe1[_0xfa2590(0x29c)]*0x64)/0x64,'gatewayEarnings':Math[_0xfa2590(0x1fb)](_0x172fe1[_0xfa2590(0x25d)]*0x64)/0x64}))[_0xfa2590(0x201)]((_0x2751ca,_0x4de5f8)=>_0x2751ca['date']['localeCompare'](_0x4de5f8[_0xfa2590(0x2db)])),'periodInfo':{'from':_0x2c00e0,'to':_0x5ba99f,'periodType':_0x8b2394[_0xfa2590(0x284)]||'custom','daysCount':_0x3cb5db}};return console[_0xfa2590(0x276)](_0xfa2590(0x220)),console[_0xfa2590(0x276)]('\x20\x20\x20💰\x20Total\x20turnover:\x20'+_0x1551d3[_0xfa2590(0x226)]+_0xfa2590(0x1f2)),console[_0xfa2590(0x276)](_0xfa2590(0x278)+_0x1551d3[_0xfa2590(0x29c)]+_0xfa2590(0x1f2)),console[_0xfa2590(0x276)]('\x20\x20\x20🏪\x20Gateway\x20earnings:\x20'+_0x1551d3['gatewayEarnings']+_0xfa2590(0x1f2)),console['log'](_0xfa2590(0x235)+_0x1551d3[_0xfa2590(0x2e2)]),_0x1551d3;}async[a35_0x471a84(0x219)](){const _0x2fc20e=a35_0x471a84;console[_0x2fc20e(0x276)](_0x2fc20e(0x1f0));const _0x5bc2a1=await database_1[_0x2fc20e(0x263)][_0x2fc20e(0x299)][_0x2fc20e(0x2a6)]({'where':{'status':'ACTIVE'},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x2fc20e(0x26e)}});return console[_0x2fc20e(0x276)](_0x2fc20e(0x23f)+_0x5bc2a1['length']+_0x2fc20e(0x1fc)),_0x5bc2a1[_0x2fc20e(0x29f)](_0x547683=>({'id':_0x547683['id'],'username':_0x547683[_0x2fc20e(0x224)],'name':_0x547683[_0x2fc20e(0x21a)]}));}[a35_0x471a84(0x210)](_0x28435c){const _0x5eaa0d=a35_0x471a84,_0x47a96f={'test_gateway':_0x5eaa0d(0x2dd),'plisio':_0x5eaa0d(0x259),'rapyd':'Rapyd','noda':'Noda','cointopay':_0x5eaa0d(0x236),'cointopay2':_0x5eaa0d(0x27c),'klyme_eu':_0x5eaa0d(0x1dc),'klyme_gb':'KLYME\x20GB','klyme_de':_0x5eaa0d(0x2ab),'mastercard':_0x5eaa0d(0x2e6)};return _0x47a96f[_0x28435c]||_0x28435c;}[a35_0x471a84(0x246)](_0x2823f4){const _0x4ceca9=a35_0x471a84,_0x37b94f={'Test\x20Gateway':_0x4ceca9(0x27f),'Plisio':_0x4ceca9(0x2ae),'Rapyd':_0x4ceca9(0x2c3),'Noda':_0x4ceca9(0x24d),'CoinToPay':'cointopay','CoinToPay2':_0x4ceca9(0x200),'KLYME\x20EU':_0x4ceca9(0x264),'KLYME\x20GB':_0x4ceca9(0x251),'KLYME\x20DE':_0x4ceca9(0x21d),'MasterCard':_0x4ceca9(0x248)};return _0x37b94f[_0x2823f4]||_0x2823f4[_0x4ceca9(0x1f7)]();}async[a35_0x471a84(0x25f)](_0x33d8ce){const _0x5b9ace=a35_0x471a84,{page:_0x3fdd42,limit:_0x545f85,minAmount:_0x33d7f3,search:_0x7c3ab7}=_0x33d8ce,_0x4c3af7=(_0x3fdd42-0x1)*_0x545f85;console[_0x5b9ace(0x276)](_0x5b9ace(0x294),_0x33d8ce);const _0x17ee7a={'balance':{'gt':0x0},'status':_0x5b9ace(0x28f)};_0x33d7f3&&(_0x17ee7a[_0x5b9ace(0x291)][_0x5b9ace(0x1bf)]=_0x33d7f3);_0x7c3ab7&&(_0x17ee7a['OR']=[{'name':{'contains':_0x7c3ab7,'mode':_0x5b9ace(0x212)}},{'username':{'contains':_0x7c3ab7,'mode':'insensitive'}}]);const [_0x60e426,_0xa74401]=await Promise[_0x5b9ace(0x2c5)]([database_1[_0x5b9ace(0x263)]['shop'][_0x5b9ace(0x2a6)]({'where':_0x17ee7a,'skip':_0x4c3af7,'take':_0x545f85,'orderBy':{'balance':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1[_0x5b9ace(0x263)]['shop'][_0x5b9ace(0x232)]({'where':_0x17ee7a})]);console[_0x5b9ace(0x276)](_0x5b9ace(0x2c9)+_0x60e426[_0x5b9ace(0x2a3)]+'\x20merchants\x20with\x20positive\x20balance');const _0x208b8c=await Promise[_0x5b9ace(0x2c5)](_0x60e426[_0x5b9ace(0x29f)](async _0x4f6ae2=>{const _0x33870f=_0x5b9ace,[_0x290c32,_0x341390,_0x121aaf]=await Promise[_0x33870f(0x2c5)]([database_1[_0x33870f(0x263)][_0x33870f(0x26b)][_0x33870f(0x232)]({'where':{'shopId':_0x4f6ae2['id'],'status':'PAID','gateway':{'not':_0x33870f(0x27f)}}}),database_1[_0x33870f(0x263)][_0x33870f(0x26b)][_0x33870f(0x1c9)]({'where':{'shopId':_0x4f6ae2['id'],'status':_0x33870f(0x262),'gateway':{'not':'test_gateway'}},'orderBy':{'paidAt':_0x33870f(0x26e)},'select':{'paidAt':!![]}}),database_1[_0x33870f(0x263)][_0x33870f(0x26b)]['groupBy']({'by':[_0x33870f(0x25a)],'where':{'shopId':_0x4f6ae2['id'],'status':'PAID','gateway':{'not':_0x33870f(0x27f)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x24d615=new Date(),_0x17b652=new Date(_0x24d615[_0x33870f(0x22c)](),_0x24d615['getMonth'](),0x1),_0x51d09a=new Date(_0x24d615[_0x33870f(0x22c)](),_0x24d615[_0x33870f(0x1e8)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x161c87,_0x4dcda3]=await Promise[_0x33870f(0x2c5)]([database_1[_0x33870f(0x263)][_0x33870f(0x1dd)][_0x33870f(0x2bf)]({'_sum':{'amount':!![]},'where':{'shopId':_0x4f6ae2['id'],'status':_0x33870f(0x2c7)}}),database_1['default'][_0x33870f(0x1dd)]['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x4f6ae2['id'],'status':_0x33870f(0x2c7),'createdAt':{'gte':_0x17b652,'lte':_0x51d09a}}})]),_0x42737f=_0x161c87[_0x33870f(0x265)]['amount']||0x0,_0x5449ec=_0x4dcda3[_0x33870f(0x265)][_0x33870f(0x202)]||0x0,_0x1009a6=await Promise['all'](_0x121aaf[_0x33870f(0x29f)](async _0x2e1015=>{const _0x43c94e=_0x33870f;let _0xbc171=0xa;if(_0x4f6ae2[_0x43c94e(0x280)])try{const _0x54cfde=JSON[_0x43c94e(0x261)](_0x4f6ae2[_0x43c94e(0x280)]);for(const [_0x5d5c25,_0x10e057]of Object[_0x43c94e(0x1e4)](_0x54cfde)){if(_0x5d5c25['toLowerCase']()===_0x2e1015[_0x43c94e(0x25a)][_0x43c94e(0x1f7)]()){_0xbc171=_0x10e057['commission']||0xa,console[_0x43c94e(0x276)](_0x43c94e(0x22b)+_0x2e1015[_0x43c94e(0x25a)]+'\x20for\x20shop\x20'+_0x4f6ae2['id']+_0x43c94e(0x252)+_0xbc171+'%');break;}}}catch(_0x26e046){console[_0x43c94e(0x292)](_0x43c94e(0x288)+_0x4f6ae2['id']+':',_0x26e046);}const _0x16e686=_0x2e1015[_0x43c94e(0x265)]['amountUSDT']||0x0,_0x99738e=_0x16e686*(0x1-_0xbc171/0x64);return{'gateway':_0x2e1015[_0x43c94e(0x25a)],'count':_0x2e1015[_0x43c94e(0x203)]['id'],'amountUSDT':Math[_0x43c94e(0x1fb)](_0x16e686*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x43c94e(0x1fb)](_0x99738e*0x64)/0x64,'commission':_0xbc171};})),_0xfa7a87=_0x1009a6[_0x33870f(0x1c6)]((_0x35db65,_0x202946)=>_0x35db65+_0x202946['amountUSDT'],0x0),_0xe107e0=_0x4f6ae2['balance'];return console[_0x33870f(0x276)](_0x33870f(0x1ce)+_0x4f6ae2[_0x33870f(0x224)]+':'),console[_0x33870f(0x276)]('\x20\x20\x20�\x20Total\x20payments\x20turnover:\x20'+_0xfa7a87[_0x33870f(0x1ef)](0x2)+_0x33870f(0x24a)),console[_0x33870f(0x276)](_0x33870f(0x1e0)+_0x1009a6[_0x33870f(0x1c6)]((_0x4bf136,_0x16530f)=>_0x4bf136+_0x16530f[_0x33870f(0x1f5)],0x0)[_0x33870f(0x1ef)](0x2)+'\x20USDT\x20(theoretical\x20net)'),console[_0x33870f(0x276)]('\x20\x20\x20✅\x20Actual\x20available\x20balance:\x20'+_0xe107e0[_0x33870f(0x1ef)](0x2)+_0x33870f(0x20f)),{'id':_0x4f6ae2['id'],'fullName':_0x4f6ae2[_0x33870f(0x21a)],'username':_0x4f6ae2[_0x33870f(0x224)],'telegramId':_0x4f6ae2[_0x33870f(0x28a)],'merchantUrl':_0x4f6ae2[_0x33870f(0x287)],'wallets':{'usdtPolygonWallet':_0x4f6ae2[_0x33870f(0x240)],'usdtTrcWallet':_0x4f6ae2[_0x33870f(0x238)],'usdtErcWallet':_0x4f6ae2[_0x33870f(0x2d6)],'usdcPolygonWallet':_0x4f6ae2[_0x33870f(0x205)]},'totalAmountUSDT':Math['round'](_0xfa7a87*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x33870f(0x1fb)](_0xe107e0*0x64)/0x64,'totalPayout':Math[_0x33870f(0x1fb)](_0x42737f*0x64)/0x64,'thisMonth':Math[_0x33870f(0x1fb)](_0x5449ec*0x64)/0x64,'paymentsCount':_0x290c32,'oldestPaymentDate':_0x341390?.[_0x33870f(0x20d)]||_0x4f6ae2[_0x33870f(0x27e)],'gatewayBreakdown':_0x1009a6};})),_0x2141c7=_0x208b8c[_0x5b9ace(0x1c6)]((_0x499209,_0x40a7c6)=>_0x499209+_0x40a7c6[_0x5b9ace(0x1f8)],0x0),_0xa73400=_0x208b8c['reduce']((_0xe7528f,_0x26d8b0)=>_0xe7528f+_0x26d8b0[_0x5b9ace(0x2cb)],0x0),_0x38e484=_0x208b8c[_0x5b9ace(0x1c6)]((_0x459a76,_0x52e4c9)=>_0x459a76+_0x52e4c9['totalPayout'],0x0),_0xdb5ef6=_0x208b8c[_0x5b9ace(0x1c6)]((_0x3b15fc,_0x572d02)=>_0x3b15fc+_0x572d02[_0x5b9ace(0x1fd)],0x0);return console['log'](_0x5b9ace(0x1d2)+_0xa74401+_0x5b9ace(0x2e1)),console['log'](_0x5b9ace(0x2ca)+Math[_0x5b9ace(0x1fb)](_0x2141c7*0x64)/0x64+'\x20USDT\x20(gross\x20revenue)'),console[_0x5b9ace(0x276)](_0x5b9ace(0x275)+Math[_0x5b9ace(0x1fb)](_0xa73400*0x64)/0x64+_0x5b9ace(0x267)),console[_0x5b9ace(0x276)](_0x5b9ace(0x23c)+Math[_0x5b9ace(0x1fb)](_0x38e484*0x64)/0x64+_0x5b9ace(0x1f2)),console[_0x5b9ace(0x276)](_0x5b9ace(0x2b7)+Math['round'](_0xdb5ef6*0x64)/0x64+_0x5b9ace(0x1f2)),{'merchants':_0x208b8c,'pagination':{'page':_0x3fdd42,'limit':_0x545f85,'total':_0xa74401,'totalPages':Math[_0x5b9ace(0x243)](_0xa74401/_0x545f85)},'summary':{'totalMerchants':_0xa74401,'totalAmountUSDT':Math[_0x5b9ace(0x1fb)](_0x2141c7*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x5b9ace(0x1fb)](_0xa73400*0x64)/0x64,'totalPayout':Math['round'](_0x38e484*0x64)/0x64,'thisMonth':Math['round'](_0xdb5ef6*0x64)/0x64}};}async[a35_0x471a84(0x23e)](_0x5a05ae){const _0x30a85f=a35_0x471a84,{shopId:_0x185cb3,amount:_0x36f0f,network:_0x19eef9,wallet:_0x24aef2,notes:_0x48262f,txid:_0x22bf20,periodFrom:_0x385c45,periodTo:_0xcffe9c}=_0x5a05ae,_0x3a242f=await database_1[_0x30a85f(0x263)][_0x30a85f(0x207)](async _0x5ef18f=>{const _0x8e594e=_0x30a85f,_0x167b14=await _0x5ef18f[_0x8e594e(0x299)][_0x8e594e(0x225)]({'where':{'id':_0x185cb3},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x167b14)throw new Error(_0x8e594e(0x1e2));console['log'](_0x8e594e(0x2b8)+_0x167b14[_0x8e594e(0x224)]+':'),console[_0x8e594e(0x276)](_0x8e594e(0x2ea)+_0x167b14[_0x8e594e(0x291)][_0x8e594e(0x1ef)](0x6)+_0x8e594e(0x1f2)),console[_0x8e594e(0x276)](_0x8e594e(0x28b)+_0x36f0f[_0x8e594e(0x1ef)](0x6)+'\x20USDT'),console[_0x8e594e(0x276)](_0x8e594e(0x21e)+_0x167b14[_0x8e594e(0x2ba)][_0x8e594e(0x1ef)](0x6)+_0x8e594e(0x1f2));if(_0x22bf20)console[_0x8e594e(0x276)](_0x8e594e(0x1d0)+_0x22bf20);if(_0x167b14[_0x8e594e(0x291)]<_0x36f0f)throw new Error(_0x8e594e(0x2af)+_0x167b14['balance'][_0x8e594e(0x1ef)](0x6)+_0x8e594e(0x1c4)+_0x36f0f[_0x8e594e(0x1ef)](0x6)+_0x8e594e(0x1f2));let _0x3852af=_0x24aef2;if(!_0x3852af){const _0xe9a59b=await _0x5ef18f[_0x8e594e(0x299)][_0x8e594e(0x225)]({'where':{'id':_0x185cb3},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0xe9a59b)switch(_0x19eef9){case'polygon':_0x3852af=_0xe9a59b[_0x8e594e(0x240)]||undefined;break;case _0x8e594e(0x26f):_0x3852af=_0xe9a59b[_0x8e594e(0x238)]||undefined;break;case'erc20':_0x3852af=_0xe9a59b[_0x8e594e(0x2d6)]||undefined;break;case _0x8e594e(0x1c1):_0x3852af=_0xe9a59b[_0x8e594e(0x205)]||undefined;break;}}console[_0x8e594e(0x276)](_0x8e594e(0x241)+_0x19eef9+':\x20'+(_0x3852af||_0x8e594e(0x29a)));const _0x40965e=await _0x5ef18f['payout'][_0x8e594e(0x1ca)]({'data':{'shopId':_0x185cb3,'amount':_0x36f0f,'network':_0x19eef9,'status':_0x8e594e(0x2c7),'txid':_0x22bf20,'notes':_0x48262f,'periodFrom':_0x385c45?new Date(_0x385c45):null,'periodTo':_0xcffe9c?new Date(_0xcffe9c):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x586fbc=_0x167b14['balance']-_0x36f0f,_0x564701=_0x167b14['totalPaidOut']+_0x36f0f;return await _0x5ef18f[_0x8e594e(0x299)]['update']({'where':{'id':_0x185cb3},'data':{'balance':_0x586fbc,'totalPaidOut':_0x564701}}),console[_0x8e594e(0x276)](_0x8e594e(0x1fa)+_0x167b14[_0x8e594e(0x224)]+'\x20balance\x20updated:'),console[_0x8e594e(0x276)]('\x20\x20\x20Balance:\x20'+_0x167b14[_0x8e594e(0x291)][_0x8e594e(0x1ef)](0x6)+_0x8e594e(0x2e0)+_0x586fbc['toFixed'](0x6)+_0x8e594e(0x2d2)+_0x36f0f[_0x8e594e(0x1ef)](0x6)+')'),console[_0x8e594e(0x276)]('\x20\x20\x20Total\x20paid\x20out:\x20'+_0x167b14[_0x8e594e(0x2ba)][_0x8e594e(0x1ef)](0x6)+_0x8e594e(0x2e0)+_0x564701[_0x8e594e(0x1ef)](0x6)+_0x8e594e(0x2dc)+_0x36f0f[_0x8e594e(0x1ef)](0x6)+')'),{'payout':_0x40965e,'shop':_0x167b14};});return console[_0x30a85f(0x276)](_0x30a85f(0x2da)+_0x3a242f[_0x30a85f(0x1dd)]['id']+_0x30a85f(0x230)+_0x3a242f[_0x30a85f(0x299)][_0x30a85f(0x224)]+'\x20('+_0x36f0f+'\x20USDT)'),{'id':_0x3a242f[_0x30a85f(0x1dd)]['id'],'shopId':_0x3a242f[_0x30a85f(0x1dd)][_0x30a85f(0x1e9)],'shopName':_0x3a242f[_0x30a85f(0x299)]['name'],'shopUsername':_0x3a242f['shop']['username'],'amount':_0x3a242f[_0x30a85f(0x1dd)][_0x30a85f(0x202)],'network':_0x3a242f[_0x30a85f(0x1dd)][_0x30a85f(0x1d6)],'status':_0x3a242f['payout'][_0x30a85f(0x25c)],'txid':_0x3a242f[_0x30a85f(0x1dd)][_0x30a85f(0x2d5)],'notes':_0x3a242f[_0x30a85f(0x1dd)][_0x30a85f(0x216)],'periodFrom':_0x3a242f['payout']['periodFrom'],'periodTo':_0x3a242f['payout']['periodTo'],'createdAt':_0x3a242f[_0x30a85f(0x1dd)][_0x30a85f(0x27e)],'paidAt':_0x3a242f[_0x30a85f(0x1dd)][_0x30a85f(0x20d)]};}async['getAllPayouts'](_0x48d728){const _0x459300=a35_0x471a84,{page:_0x1b2355,limit:_0x46262d,shopId:_0x300189,network:_0x4a10ea,dateFrom:_0x2387bd,dateTo:_0x4a1637,search:_0x56f5f8}=_0x48d728,_0x3bd309=(_0x1b2355-0x1)*_0x46262d,_0x4634e1={};_0x300189&&(_0x4634e1[_0x459300(0x1e9)]=_0x300189);_0x4a10ea&&(_0x4634e1['network']=_0x4a10ea);(_0x2387bd||_0x4a1637)&&(_0x4634e1[_0x459300(0x27e)]={},_0x2387bd&&(_0x4634e1[_0x459300(0x27e)]['gte']=new Date(_0x2387bd)),_0x4a1637&&(_0x4634e1[_0x459300(0x27e)][_0x459300(0x270)]=new Date(_0x4a1637)));_0x56f5f8&&(_0x4634e1['OR']=[{'shop':{'name':{'contains':_0x56f5f8,'mode':_0x459300(0x212)}}},{'shop':{'username':{'contains':_0x56f5f8,'mode':_0x459300(0x212)}}},{'notes':{'contains':_0x56f5f8,'mode':'insensitive'}}]);const [_0x3ae3a8,_0x1da7e1]=await Promise[_0x459300(0x2c5)]([database_1['default'][_0x459300(0x1dd)][_0x459300(0x2a6)]({'where':_0x4634e1,'skip':_0x3bd309,'take':_0x46262d,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x459300(0x263)]['payout'][_0x459300(0x232)]({'where':_0x4634e1})]);return{'payouts':_0x3ae3a8['map'](_0x403400=>({'id':_0x403400['id'],'shopId':_0x403400[_0x459300(0x1e9)],'shopName':_0x403400[_0x459300(0x299)][_0x459300(0x21a)],'shopUsername':_0x403400[_0x459300(0x299)][_0x459300(0x224)],'amount':_0x403400[_0x459300(0x202)],'network':_0x403400[_0x459300(0x1d6)],'status':_0x403400['status'],'txid':_0x403400['txid'],'notes':_0x403400[_0x459300(0x216)],'periodFrom':_0x403400[_0x459300(0x1c7)],'periodTo':_0x403400[_0x459300(0x20e)],'createdAt':_0x403400[_0x459300(0x27e)],'paidAt':_0x403400[_0x459300(0x20d)]})),'pagination':{'page':_0x1b2355,'limit':_0x46262d,'total':_0x1da7e1,'totalPages':Math[_0x459300(0x243)](_0x1da7e1/_0x46262d)}};}async[a35_0x471a84(0x26c)](_0x125421){const _0x34bddb=a35_0x471a84,_0x50644d=await database_1[_0x34bddb(0x263)][_0x34bddb(0x1dd)][_0x34bddb(0x225)]({'where':{'id':_0x125421},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x50644d)return null;return{'id':_0x50644d['id'],'shopId':_0x50644d[_0x34bddb(0x1e9)],'shopName':_0x50644d[_0x34bddb(0x299)][_0x34bddb(0x21a)],'shopUsername':_0x50644d[_0x34bddb(0x299)][_0x34bddb(0x224)],'amount':_0x50644d['amount'],'network':_0x50644d[_0x34bddb(0x1d6)],'status':_0x50644d[_0x34bddb(0x25c)],'txid':_0x50644d[_0x34bddb(0x2d5)],'notes':_0x50644d[_0x34bddb(0x216)],'periodFrom':_0x50644d[_0x34bddb(0x1c7)],'periodTo':_0x50644d[_0x34bddb(0x20e)],'createdAt':_0x50644d[_0x34bddb(0x27e)],'paidAt':_0x50644d[_0x34bddb(0x20d)]};}async[a35_0x471a84(0x1d4)](_0x1f831c){const _0x22f184=a35_0x471a84;await database_1[_0x22f184(0x263)]['payout'][_0x22f184(0x1d7)]({'where':{'id':_0x1f831c}});}async[a35_0x471a84(0x256)](_0x15fc01){const _0x54e470=a35_0x471a84,{page:_0x3dfcb9,limit:_0x57fabf,status:_0x446290,gateway:_0x2246a4,shopId:_0x557368,dateFrom:_0x57ec60,dateTo:_0x26cc36,search:_0x4bd33a,currency:_0xa8c5ad,sortBy:_0xa109f8,sortOrder:_0x269eb4}=_0x15fc01,_0x919993=(_0x3dfcb9-0x1)*_0x57fabf;console[_0x54e470(0x276)](_0x54e470(0x208),_0x15fc01);const _0xc2258e=await database_1['default'][_0x54e470(0x26b)]['groupBy']({'by':['gateway'],'_count':{'gateway':!![]}});console['log']('📊\x20Available\x20gateways\x20in\x20database:',_0xc2258e['map'](_0x2c76f1=>_0x2c76f1['gateway']+'\x20('+_0x2c76f1[_0x54e470(0x203)][_0x54e470(0x25a)]+'\x20payments)'));if(_0x2246a4){const _0x3dadca=_0xc2258e[_0x54e470(0x2e3)](_0x7dad8=>_0x7dad8[_0x54e470(0x25a)][_0x54e470(0x1f7)]()===_0x2246a4['toLowerCase']());!_0x3dadca&&_0x2246a4['toLowerCase']()!=='test_gateway'&&console['log']('⚠️\x20Requested\x20gateway\x20\x27'+_0x2246a4+_0x54e470(0x2cc)+_0xc2258e[_0x54e470(0x29f)](_0x13af7f=>_0x13af7f[_0x54e470(0x25a)])[_0x54e470(0x21c)](',\x20'));}const _0x3fe085={};_0x446290&&(_0x3fe085[_0x54e470(0x25c)]=_0x446290[_0x54e470(0x1df)]());if(!_0x2246a4)_0x3fe085['gateway']={'not':_0x54e470(0x27f)};else{if(_0x2246a4&&(_0x2246a4[_0x54e470(0x1f7)]()===_0x54e470(0x27f)||_0x2246a4==='0000'))_0x3fe085[_0x54e470(0x25a)]=_0x54e470(0x27f);else{let _0x518c2a=_0x2246a4;const _0x186bda=(0x0,gateway_1[_0x54e470(0x1db)])(_0x2246a4);if(_0x186bda)_0x518c2a=_0x186bda,console[_0x54e470(0x276)](_0x54e470(0x2b1)+_0x2246a4+'\x27\x20to\x20name\x20\x27'+_0x518c2a+'\x27');else{const _0x4fc7f6=(0x0,gateway_1[_0x54e470(0x228)])(_0x2246a4);if(_0x4fc7f6){const _0x158285=(0x0,gateway_1[_0x54e470(0x1db)])(_0x4fc7f6);_0x158285&&(_0x518c2a=_0x158285,console[_0x54e470(0x276)]('🔄\x20Converted\x20gateway\x20name\x20\x27'+_0x2246a4+'\x27\x20->\x20ID\x20\x27'+_0x4fc7f6+_0x54e470(0x295)+_0x518c2a+'\x27'));}else console[_0x54e470(0x276)](_0x54e470(0x2bc)+_0x2246a4+_0x54e470(0x2aa));}const _0x3f2449=await database_1[_0x54e470(0x263)]['payment'][_0x54e470(0x232)]({'where':{'gateway':_0x518c2a[_0x54e470(0x1f7)]()},'take':0x1});_0x3f2449===0x0?(console[_0x54e470(0x276)]('⚠️\x20Gateway\x20\x27'+_0x518c2a+_0x54e470(0x260)+_0x2246a4+_0x54e470(0x25e)),_0x3fe085[_0x54e470(0x25a)]=_0x54e470(0x213)):(_0x3fe085[_0x54e470(0x25a)]=_0x518c2a[_0x54e470(0x1f7)](),console[_0x54e470(0x276)]('✅\x20Using\x20gateway\x20filter:\x20\x27'+_0x518c2a+_0x54e470(0x260)+_0x2246a4+'\x27)'));}}console[_0x54e470(0x276)](_0x54e470(0x28e),_0x3fe085['gateway']);_0x557368&&(_0x3fe085['shopId']=_0x557368);_0xa8c5ad&&(_0x3fe085['currency']=_0xa8c5ad[_0x54e470(0x1df)](),console[_0x54e470(0x276)]('💱\x20Currency\x20filter\x20applied:\x20'+_0xa8c5ad[_0x54e470(0x1df)]()));(_0x57ec60||_0x26cc36)&&(_0x3fe085[_0x54e470(0x27e)]={},_0x57ec60&&(_0x3fe085['createdAt'][_0x54e470(0x1bf)]=new Date(_0x57ec60)),_0x26cc36&&(_0x3fe085[_0x54e470(0x27e)]['lte']=new Date(_0x26cc36)));_0x4bd33a&&(_0x3fe085['OR']=[{'id':{'contains':_0x4bd33a,'mode':'insensitive'}},{'orderId':{'contains':_0x4bd33a,'mode':'insensitive'}},{'gatewayOrderId':{'contains':_0x4bd33a,'mode':_0x54e470(0x212)}},{'customerEmail':{'contains':_0x4bd33a,'mode':'insensitive'}},{'shop':{'name':{'contains':_0x4bd33a,'mode':_0x54e470(0x212)}}},{'shop':{'username':{'contains':_0x4bd33a,'mode':_0x54e470(0x212)}}}]);console[_0x54e470(0x276)](_0x54e470(0x268),JSON[_0x54e470(0x290)](_0x3fe085,null,0x2));let _0x360c08={'createdAt':_0x54e470(0x272)};if(_0xa109f8){const _0x4de06f=[_0x54e470(0x202),_0x54e470(0x27e),_0x54e470(0x28c),_0x54e470(0x25c),_0x54e470(0x25a),_0x54e470(0x22d)],_0x4bbd9f=['asc',_0x54e470(0x272)];if(_0x4de06f[_0x54e470(0x2cd)](_0xa109f8)){const _0xd11ffa=_0x4bbd9f[_0x54e470(0x2cd)](_0x269eb4)?_0x269eb4:'desc';_0x360c08={[_0xa109f8]:_0xd11ffa},console['log'](_0x54e470(0x2c2)+_0xa109f8+'\x20in\x20'+_0xd11ffa+'\x20order');}}const [_0x28846b,_0x14d092]=await Promise[_0x54e470(0x2c5)]([database_1[_0x54e470(0x263)][_0x54e470(0x26b)]['findMany']({'where':_0x3fe085,'skip':_0x919993,'take':_0x57fabf,'orderBy':_0x360c08,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x54e470(0x263)][_0x54e470(0x26b)]['count']({'where':_0x3fe085})]);return{'payments':_0x28846b,'pagination':{'page':_0x3dfcb9,'limit':_0x57fabf,'total':_0x14d092,'totalPages':Math[_0x54e470(0x243)](_0x14d092/_0x57fabf)}};}async[a35_0x471a84(0x2a1)](_0x1f3f57){const _0x364ffe=a35_0x471a84,_0x5a2984=await database_1['default'][_0x364ffe(0x26b)][_0x364ffe(0x225)]({'where':{'id':_0x1f3f57},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x5a2984)return null;return{'id':_0x5a2984['id'],'shopId':_0x5a2984[_0x364ffe(0x1e9)],'gateway':_0x5a2984[_0x364ffe(0x25a)],'amount':_0x5a2984[_0x364ffe(0x202)],'currency':_0x5a2984[_0x364ffe(0x22d)],'status':_0x5a2984[_0x364ffe(0x25c)],'orderId':_0x5a2984[_0x364ffe(0x2b3)],'gatewayOrderId':_0x5a2984['gatewayOrderId'],'customerEmail':_0x5a2984[_0x364ffe(0x24f)],'customerName':_0x5a2984[_0x364ffe(0x244)],'customerCountry':_0x5a2984[_0x364ffe(0x1c3)],'customerIp':_0x5a2984['customerIp'],'customerUa':_0x5a2984[_0x364ffe(0x1d3)],'failureMessage':_0x5a2984['failureMessage'],'externalPaymentUrl':_0x5a2984[_0x364ffe(0x2c0)],'successUrl':_0x5a2984[_0x364ffe(0x271)],'failUrl':_0x5a2984[_0x364ffe(0x2e9)],'pendingUrl':_0x5a2984[_0x364ffe(0x1ec)],'whiteUrl':_0x5a2984[_0x364ffe(0x289)],'createdAt':_0x5a2984[_0x364ffe(0x27e)],'updatedAt':_0x5a2984[_0x364ffe(0x28c)],'shop':_0x5a2984[_0x364ffe(0x299)]};}async[a35_0x471a84(0x29e)](_0x2df29d,_0x23bfe6,_0x11c3d9,_0x31517e){const _0x415ef5=a35_0x471a84,_0x630624=await database_1[_0x415ef5(0x263)][_0x415ef5(0x207)](async _0x392809=>{const _0x408fc9=_0x415ef5,_0x3ce215=await _0x392809[_0x408fc9(0x26b)][_0x408fc9(0x225)]({'where':{'id':_0x2df29d},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x3ce215)throw new Error(_0x408fc9(0x1e3));const _0xe6d60=_0x3ce215[_0x408fc9(0x25c)],_0x5ac1ae=_0x23bfe6[_0x408fc9(0x1df)]();console[_0x408fc9(0x276)](_0x408fc9(0x2ce)+_0x2df29d+_0x408fc9(0x26d)+_0xe6d60+_0x408fc9(0x2e0)+_0x5ac1ae),console[_0x408fc9(0x276)](_0x408fc9(0x285)+_0x3ce215[_0x408fc9(0x299)][_0x408fc9(0x291)]+'\x20USDT');const _0x39c804={'status':_0x5ac1ae,'updatedAt':new Date(),'statusChangedBy':_0x408fc9(0x274),'statusChangedAt':new Date()};_0x11c3d9&&(_0x39c804[_0x408fc9(0x29d)]=_0x11c3d9);_0x5ac1ae==='CHARGEBACK'&&_0x31517e&&(_0x39c804[_0x408fc9(0x21f)]=_0x31517e);let _0x5c883e=0x0,_0x4aabb4=_0x3ce215[_0x408fc9(0x299)][_0x408fc9(0x291)];if(_0x5ac1ae==='PAID'&&_0xe6d60!==_0x408fc9(0x262)){_0x39c804[_0x408fc9(0x20d)]=new Date();const _0x447f6e=await currencyService_1[_0x408fc9(0x1de)][_0x408fc9(0x279)](_0x3ce215[_0x408fc9(0x202)],_0x3ce215[_0x408fc9(0x22d)]);_0x39c804['amountUSDT']=_0x447f6e;let _0x4126d7=0xa;const _0x1769e9=await _0x392809[_0x408fc9(0x299)]['findUnique']({'where':{'id':_0x3ce215[_0x408fc9(0x1e9)]},'select':{'gatewaySettings':!![]}});if(_0x1769e9?.[_0x408fc9(0x280)])try{const _0x4bef96=JSON[_0x408fc9(0x261)](_0x1769e9[_0x408fc9(0x280)]);for(const [_0x273bd2,_0x3fc144]of Object[_0x408fc9(0x1e4)](_0x4bef96)){if(_0x273bd2[_0x408fc9(0x1f7)]()===_0x3ce215[_0x408fc9(0x25a)][_0x408fc9(0x1f7)]()){_0x4126d7=_0x3fc144[_0x408fc9(0x2d4)]||0xa;break;}}}catch(_0x2db584){console[_0x408fc9(0x292)](_0x408fc9(0x204)+_0x2df29d+':',_0x2db584);}const _0x1ac0bc=_0x447f6e*(0x1-_0x4126d7/0x64);_0x5c883e=_0x1ac0bc,_0x4aabb4+=_0x1ac0bc,console[_0x408fc9(0x276)]('💰\x20Payment\x20'+_0x2df29d+_0x408fc9(0x24e)),console[_0x408fc9(0x276)]('\x20\x20\x20Full\x20amount:\x20'+_0x447f6e['toFixed'](0x6)+_0x408fc9(0x1f2)),console[_0x408fc9(0x276)]('\x20\x20\x20Gateway:\x20'+_0x3ce215['gateway']+_0x408fc9(0x24c)+_0x4126d7+'%'),console[_0x408fc9(0x276)](_0x408fc9(0x283)+_0x1ac0bc[_0x408fc9(0x1ef)](0x6)+'\x20USDT\x20(after\x20'+_0x4126d7+_0x408fc9(0x2e8)),console[_0x408fc9(0x276)](_0x408fc9(0x293)+_0x1ac0bc[_0x408fc9(0x1ef)](0x6)+_0x408fc9(0x1f2));}else{if(_0xe6d60===_0x408fc9(0x262)&&_0x5ac1ae!==_0x408fc9(0x262)){if(_0x3ce215[_0x408fc9(0x2ac)]){let _0x2b007f=0xa;const _0x474954=await _0x392809[_0x408fc9(0x299)][_0x408fc9(0x225)]({'where':{'id':_0x3ce215['shopId']},'select':{'gatewaySettings':!![]}});if(_0x474954?.[_0x408fc9(0x280)])try{const _0x59a9ce=JSON['parse'](_0x474954['gatewaySettings']);for(const [_0x457c14,_0x29a574]of Object[_0x408fc9(0x1e4)](_0x59a9ce)){if(_0x457c14[_0x408fc9(0x1f7)]()===_0x3ce215['gateway'][_0x408fc9(0x1f7)]()){_0x2b007f=_0x29a574[_0x408fc9(0x2d4)]||0xa;break;}}}catch(_0x4af7fc){console['error'](_0x408fc9(0x204)+_0x2df29d+':',_0x4af7fc);}const _0x19ac9e=_0x3ce215['amountUSDT']*(0x1-_0x2b007f/0x64);_0x5c883e=-_0x19ac9e,_0x4aabb4-=_0x19ac9e,_0x39c804[_0x408fc9(0x2ac)]=null,console[_0x408fc9(0x276)]('💰\x20Payment\x20'+_0x2df29d+_0x408fc9(0x1c5)),console[_0x408fc9(0x276)](_0x408fc9(0x286)+_0x3ce215[_0x408fc9(0x2ac)][_0x408fc9(0x1ef)](0x6)+_0x408fc9(0x1f2)),console[_0x408fc9(0x276)](_0x408fc9(0x223)+_0x3ce215[_0x408fc9(0x25a)]+_0x408fc9(0x24c)+_0x2b007f+'%'),console['log'](_0x408fc9(0x229)+_0x19ac9e[_0x408fc9(0x1ef)](0x6)+'\x20USDT\x20(after\x20'+_0x2b007f+_0x408fc9(0x2e8)),console[_0x408fc9(0x276)]('\x20\x20\x20Subtracted\x20from\x20balance:\x20-'+_0x19ac9e['toFixed'](0x6)+_0x408fc9(0x1f2));}}}_0x5ac1ae===_0x408fc9(0x1e6)&&(_0xe6d60===_0x408fc9(0x262)&&_0x3ce215[_0x408fc9(0x2ac)]&&console[_0x408fc9(0x276)](_0x408fc9(0x215)),_0x31517e&&_0x31517e>0x0&&(_0x5c883e-=_0x31517e,_0x4aabb4-=_0x31517e,console[_0x408fc9(0x276)]('💸\x20CHARGEBACK\x20penalty:\x20-'+_0x31517e[_0x408fc9(0x1ef)](0x6)+_0x408fc9(0x1f4))));_0x5ac1ae===_0x408fc9(0x1cb)&&_0xe6d60===_0x408fc9(0x262)&&console[_0x408fc9(0x276)](_0x408fc9(0x2e4));const _0x1b3e48=await _0x392809[_0x408fc9(0x26b)][_0x408fc9(0x2cf)]({'where':{'id':_0x2df29d},'data':_0x39c804,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x5c883e!==0x0&&(await _0x392809['shop'][_0x408fc9(0x2cf)]({'where':{'id':_0x3ce215[_0x408fc9(0x1e9)]},'data':{'balance':_0x4aabb4}}),console['log'](_0x408fc9(0x1fa)+_0x3ce215[_0x408fc9(0x1e9)]+_0x408fc9(0x29b)+_0x3ce215[_0x408fc9(0x299)]['balance'][_0x408fc9(0x1ef)](0x6)+_0x408fc9(0x2e0)+_0x4aabb4[_0x408fc9(0x1ef)](0x6)+_0x408fc9(0x282)+(_0x5c883e>0x0?'+':'')+_0x5c883e['toFixed'](0x6)+')')),_0x1b3e48;});return{'id':_0x630624['id'],'shopId':_0x630624[_0x415ef5(0x1e9)],'gateway':_0x630624['gateway'],'amount':_0x630624['amount'],'currency':_0x630624['currency'],'status':_0x630624[_0x415ef5(0x25c)],'orderId':_0x630624[_0x415ef5(0x2b3)],'gatewayOrderId':_0x630624['gatewayOrderId'],'customerEmail':_0x630624['customerEmail'],'customerName':_0x630624['customerName'],'customerCountry':_0x630624[_0x415ef5(0x1c3)],'customerIp':_0x630624[_0x415ef5(0x269)],'customerUa':_0x630624[_0x415ef5(0x1d3)],'failureMessage':_0x630624[_0x415ef5(0x1ed)],'adminNotes':_0x630624[_0x415ef5(0x29d)],'chargebackAmount':_0x630624[_0x415ef5(0x21f)],'statusChangedBy':_0x630624[_0x415ef5(0x1f9)],'statusChangedAt':_0x630624['statusChangedAt'],'createdAt':_0x630624['createdAt'],'updatedAt':_0x630624[_0x415ef5(0x28c)],'shop':_0x630624[_0x415ef5(0x299)]};}async['updateUser'](_0x28784a,_0x746a2d){const _0xe343b0=a35_0x471a84,_0x599673={..._0x746a2d};_0x746a2d['password']&&(_0x599673[_0xe343b0(0x258)]=await bcryptjs_1['default'][_0xe343b0(0x20a)](_0x746a2d['password'],0xc));_0x746a2d[_0xe343b0(0x2de)]&&(_0x599673[_0xe343b0(0x21a)]=_0x746a2d[_0xe343b0(0x2de)],delete _0x599673['fullName']);_0x746a2d['telegramId']&&(_0x599673[_0xe343b0(0x28a)]=_0x746a2d[_0xe343b0(0x1e7)],delete _0x599673[_0xe343b0(0x1e7)]);_0x746a2d['merchantUrl']&&(_0x599673[_0xe343b0(0x287)]=_0x746a2d[_0xe343b0(0x245)],delete _0x599673['merchantUrl']);if(_0x746a2d[_0xe343b0(0x2d8)]){const _0x214df1=_0x746a2d[_0xe343b0(0x2d8)]['map'](_0x175b86=>this['getGatewayInternalName'](_0x175b86));console['log'](_0xe343b0(0x2b6),_0x746a2d[_0xe343b0(0x2d8)],'->',_0x214df1),_0x599673[_0xe343b0(0x221)]=JSON[_0xe343b0(0x290)](_0x214df1),delete _0x599673['gateways'];}_0x746a2d[_0xe343b0(0x280)]&&(_0x599673['gatewaySettings']=JSON[_0xe343b0(0x290)](_0x746a2d['gatewaySettings']),delete _0x599673['gatewaySettings']);_0x746a2d[_0xe343b0(0x2a4)]&&(_0x746a2d['wallets']['usdtPolygonWallet']!==undefined&&(_0x599673['usdtPolygonWallet']=_0x746a2d[_0xe343b0(0x2a4)][_0xe343b0(0x240)]||null),_0x746a2d['wallets'][_0xe343b0(0x238)]!==undefined&&(_0x599673[_0xe343b0(0x238)]=_0x746a2d[_0xe343b0(0x2a4)][_0xe343b0(0x238)]||null),_0x746a2d[_0xe343b0(0x2a4)]['usdtErcWallet']!==undefined&&(_0x599673[_0xe343b0(0x2d6)]=_0x746a2d[_0xe343b0(0x2a4)][_0xe343b0(0x2d6)]||null),_0x746a2d['wallets'][_0xe343b0(0x205)]!==undefined&&(_0x599673[_0xe343b0(0x205)]=_0x746a2d['wallets'][_0xe343b0(0x205)]||null),delete _0x599673[_0xe343b0(0x2a4)]);const _0x4404a5=await database_1[_0xe343b0(0x263)][_0xe343b0(0x299)]['update']({'where':{'id':_0x28784a},'data':_0x599673,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4404a5['id'],'fullName':_0x4404a5[_0xe343b0(0x21a)],'username':_0x4404a5[_0xe343b0(0x224)],'telegramId':_0x4404a5[_0xe343b0(0x28a)],'merchantUrl':_0x4404a5[_0xe343b0(0x287)],'gateways':_0x4404a5['paymentGateways']?JSON[_0xe343b0(0x261)](_0x4404a5['paymentGateways']):null,'gatewaySettings':_0x4404a5[_0xe343b0(0x280)]?JSON[_0xe343b0(0x261)](_0x4404a5[_0xe343b0(0x280)]):null,'publicKey':_0x4404a5[_0xe343b0(0x23d)],'wallets':{'usdtPolygonWallet':_0x4404a5[_0xe343b0(0x240)],'usdtTrcWallet':_0x4404a5[_0xe343b0(0x238)],'usdtErcWallet':_0x4404a5[_0xe343b0(0x2d6)],'usdcPolygonWallet':_0x4404a5['usdcPolygonWallet']},'status':_0x4404a5[_0xe343b0(0x25c)],'createdAt':_0x4404a5[_0xe343b0(0x27e)]};}async['suspendUser'](_0x40ba6a){const _0x3f0e49=a35_0x471a84,_0x505160=await database_1[_0x3f0e49(0x263)]['shop'][_0x3f0e49(0x2cf)]({'where':{'id':_0x40ba6a},'data':{'status':_0x3f0e49(0x242)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x505160['id'],'fullName':_0x505160['name'],'username':_0x505160[_0x3f0e49(0x224)],'telegramId':_0x505160[_0x3f0e49(0x28a)],'merchantUrl':_0x505160[_0x3f0e49(0x287)],'gateways':_0x505160['paymentGateways']?JSON[_0x3f0e49(0x261)](_0x505160['paymentGateways']):null,'gatewaySettings':_0x505160[_0x3f0e49(0x280)]?JSON[_0x3f0e49(0x261)](_0x505160[_0x3f0e49(0x280)]):null,'publicKey':_0x505160['publicKey'],'wallets':{'usdtPolygonWallet':_0x505160[_0x3f0e49(0x240)],'usdtTrcWallet':_0x505160[_0x3f0e49(0x238)],'usdtErcWallet':_0x505160[_0x3f0e49(0x2d6)],'usdcPolygonWallet':_0x505160[_0x3f0e49(0x205)]},'status':_0x505160['status'],'createdAt':_0x505160[_0x3f0e49(0x27e)]};}async[a35_0x471a84(0x239)](_0x37bdd4){const _0x2144cc=a35_0x471a84,_0x2cf3ee=await database_1[_0x2144cc(0x263)][_0x2144cc(0x299)][_0x2144cc(0x2cf)]({'where':{'id':_0x37bdd4},'data':{'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2cf3ee['id'],'fullName':_0x2cf3ee['name'],'username':_0x2cf3ee[_0x2144cc(0x224)],'telegramId':_0x2cf3ee[_0x2144cc(0x28a)],'merchantUrl':_0x2cf3ee['shopUrl'],'gateways':_0x2cf3ee[_0x2144cc(0x221)]?JSON['parse'](_0x2cf3ee[_0x2144cc(0x221)]):null,'gatewaySettings':_0x2cf3ee[_0x2144cc(0x280)]?JSON[_0x2144cc(0x261)](_0x2cf3ee['gatewaySettings']):null,'publicKey':_0x2cf3ee[_0x2144cc(0x23d)],'wallets':{'usdtPolygonWallet':_0x2cf3ee[_0x2144cc(0x240)],'usdtTrcWallet':_0x2cf3ee['usdtTrcWallet'],'usdtErcWallet':_0x2cf3ee[_0x2144cc(0x2d6)],'usdcPolygonWallet':_0x2cf3ee['usdcPolygonWallet']},'status':_0x2cf3ee['status'],'createdAt':_0x2cf3ee[_0x2144cc(0x27e)]};}async[a35_0x471a84(0x217)](_0x19313e){const _0x1d1838=a35_0x471a84,{page:_0x3d3916,limit:_0x59e94e,status:_0x36d67a}=_0x19313e,_0x3fab2a=(_0x3d3916-0x1)*_0x59e94e,_0x1afcfa={};_0x36d67a&&(_0x1afcfa['status']=_0x36d67a['toUpperCase']());const [_0x393246,_0x104977]=await Promise[_0x1d1838(0x2c5)]([database_1[_0x1d1838(0x263)]['shop'][_0x1d1838(0x2a6)]({'where':_0x1afcfa,'skip':_0x3fab2a,'take':_0x59e94e,'orderBy':{'createdAt':_0x1d1838(0x272)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x1d1838(0x263)][_0x1d1838(0x299)]['count']({'where':_0x1afcfa})]);return{'users':_0x393246[_0x1d1838(0x29f)](_0x303ef3=>{const _0x374f4d=_0x1d1838,_0x3c01fe=_0x303ef3[_0x374f4d(0x221)]?JSON[_0x374f4d(0x261)](_0x303ef3['paymentGateways']):null,_0x140d22=_0x3c01fe?_0x3c01fe[_0x374f4d(0x29f)](_0x105dff=>this[_0x374f4d(0x210)](_0x105dff)):null;return{'id':_0x303ef3['id'],'fullName':_0x303ef3['name'],'username':_0x303ef3[_0x374f4d(0x224)],'telegramId':_0x303ef3[_0x374f4d(0x28a)],'merchantUrl':_0x303ef3[_0x374f4d(0x287)],'gateways':_0x140d22,'gatewaySettings':_0x303ef3[_0x374f4d(0x280)]?JSON[_0x374f4d(0x261)](_0x303ef3['gatewaySettings']):null,'publicKey':_0x303ef3['publicKey'],'wallets':{'usdtPolygonWallet':_0x303ef3[_0x374f4d(0x240)],'usdtTrcWallet':_0x303ef3[_0x374f4d(0x238)],'usdtErcWallet':_0x303ef3[_0x374f4d(0x2d6)],'usdcPolygonWallet':_0x303ef3[_0x374f4d(0x205)]},'status':_0x303ef3[_0x374f4d(0x25c)],'createdAt':_0x303ef3['createdAt']};}),'pagination':{'page':_0x3d3916,'limit':_0x59e94e,'total':_0x104977,'totalPages':Math[_0x1d1838(0x243)](_0x104977/_0x59e94e)}};}async[a35_0x471a84(0x2d1)](_0x4181f1){const _0x544529=a35_0x471a84,_0x549ddb=await database_1[_0x544529(0x263)][_0x544529(0x299)]['findUnique']({'where':{'id':_0x4181f1},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x549ddb)return null;const _0x5cb1d8=_0x549ddb['paymentGateways']?JSON[_0x544529(0x261)](_0x549ddb[_0x544529(0x221)]):null,_0x5401ac=_0x5cb1d8?_0x5cb1d8[_0x544529(0x29f)](_0x20ed47=>this[_0x544529(0x210)](_0x20ed47)):null;return _0x5cb1d8&&_0x5401ac&&console[_0x544529(0x276)](_0x544529(0x23a),_0x5cb1d8,'->',_0x5401ac),{'id':_0x549ddb['id'],'fullName':_0x549ddb[_0x544529(0x21a)],'username':_0x549ddb['username'],'telegramId':_0x549ddb[_0x544529(0x28a)],'merchantUrl':_0x549ddb['shopUrl'],'gateways':_0x5401ac,'gatewaySettings':_0x549ddb[_0x544529(0x280)]?JSON['parse'](_0x549ddb[_0x544529(0x280)]):null,'publicKey':_0x549ddb[_0x544529(0x23d)],'wallets':{'usdtPolygonWallet':_0x549ddb[_0x544529(0x240)],'usdtTrcWallet':_0x549ddb['usdtTrcWallet'],'usdtErcWallet':_0x549ddb['usdtErcWallet'],'usdcPolygonWallet':_0x549ddb['usdcPolygonWallet']},'status':_0x549ddb[_0x544529(0x25c)],'createdAt':_0x549ddb['createdAt']};}async[a35_0x471a84(0x1ee)](_0x59568a){const _0x540eb6=a35_0x471a84,{fullName:_0x2bbee6,username:_0x5bf20a,password:_0x389b52,telegramId:_0xc57329,merchantUrl:_0xe4579b,gateways:_0x428387,gatewaySettings:_0x31e53a,wallets:_0x3101a0}=_0x59568a,_0x447f22=await database_1[_0x540eb6(0x263)][_0x540eb6(0x299)][_0x540eb6(0x225)]({'where':{'username':_0x5bf20a}});if(_0x447f22)throw new Error(_0x540eb6(0x2be));if(_0xc57329){const _0x3b7ebd=await database_1[_0x540eb6(0x263)][_0x540eb6(0x299)]['findUnique']({'where':{'telegram':_0xc57329}});if(_0x3b7ebd)throw new Error(_0x540eb6(0x1c2));}const _0xadbf33=await bcryptjs_1['default'][_0x540eb6(0x20a)](_0x389b52,0xc),_0x3d1a5d=_0x540eb6(0x2bd)+crypto_1['default'][_0x540eb6(0x27b)](0x20)['toString'](_0x540eb6(0x1f3)),_0x337158=_0x540eb6(0x2bb)+crypto_1[_0x540eb6(0x263)][_0x540eb6(0x27b)](0x20)[_0x540eb6(0x2a9)](_0x540eb6(0x1f3)),_0x4cb879=_0x428387?_0x428387[_0x540eb6(0x29f)](_0x4d3a9d=>this['getGatewayInternalName'](_0x4d3a9d)):null;_0x428387&&_0x4cb879&&console[_0x540eb6(0x276)]('🔄\x20Gateway\x20mapping\x20(create):',_0x428387,'->',_0x4cb879);const _0x5833b3=await database_1[_0x540eb6(0x263)][_0x540eb6(0x299)]['create']({'data':{'name':_0x2bbee6,'username':_0x5bf20a,'password':_0xadbf33,'telegram':_0xc57329,'shopUrl':_0xe4579b,'paymentGateways':_0x4cb879?JSON[_0x540eb6(0x290)](_0x4cb879):null,'gatewaySettings':_0x31e53a?JSON[_0x540eb6(0x290)](_0x31e53a):null,'usdtPolygonWallet':_0x3101a0?.[_0x540eb6(0x240)]||null,'usdtTrcWallet':_0x3101a0?.['usdtTrcWallet']||null,'usdtErcWallet':_0x3101a0?.['usdtErcWallet']||null,'usdcPolygonWallet':_0x3101a0?.[_0x540eb6(0x205)]||null,'publicKey':_0x3d1a5d,'secretKey':_0x337158,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x5833b3['id'],'fullName':_0x5833b3[_0x540eb6(0x21a)],'username':_0x5833b3[_0x540eb6(0x224)],'telegramId':_0x5833b3[_0x540eb6(0x28a)],'merchantUrl':_0x5833b3[_0x540eb6(0x287)],'gateways':_0x5833b3[_0x540eb6(0x221)]?JSON[_0x540eb6(0x261)](_0x5833b3[_0x540eb6(0x221)]):null,'gatewaySettings':_0x5833b3[_0x540eb6(0x280)]?JSON['parse'](_0x5833b3[_0x540eb6(0x280)]):null,'publicKey':_0x5833b3[_0x540eb6(0x23d)],'wallets':{'usdtPolygonWallet':_0x5833b3[_0x540eb6(0x240)],'usdtTrcWallet':_0x5833b3[_0x540eb6(0x238)],'usdtErcWallet':_0x5833b3[_0x540eb6(0x2d6)],'usdcPolygonWallet':_0x5833b3[_0x540eb6(0x205)]},'status':_0x5833b3[_0x540eb6(0x25c)],'createdAt':_0x5833b3[_0x540eb6(0x27e)]};}async[a35_0x471a84(0x296)](_0x461e79){const _0x190eb1=a35_0x471a84;await database_1[_0x190eb1(0x263)][_0x190eb1(0x299)][_0x190eb1(0x1d7)]({'where':{'id':_0x461e79}});}['generateDailyStatistics'](_0x46c503,_0x5f109c,_0x4285ff){const _0x2ed79b=a35_0x471a84,_0x4f5a60=new Map(),_0x14421e=new Date(_0x5f109c);while(_0x14421e<=_0x4285ff){const _0x1c8739=_0x14421e['toISOString']()[_0x2ed79b(0x218)]('T')[0x0];_0x4f5a60[_0x2ed79b(0x1d1)](_0x1c8739,{'revenue':0x0,'count':0x0}),_0x14421e[_0x2ed79b(0x1c8)](_0x14421e['getDate']()+0x1);}for(const _0x1d7da5 of _0x46c503){const _0xabd431=_0x1d7da5[_0x2ed79b(0x27e)][_0x2ed79b(0x2e7)]()[_0x2ed79b(0x218)]('T')[0x0],_0x211920=_0x4f5a60[_0x2ed79b(0x2d0)](_0xabd431);_0x211920&&(_0x211920[_0x2ed79b(0x232)]+=0x1,_0x1d7da5['status']===_0x2ed79b(0x262)&&(_0x1d7da5[_0x2ed79b(0x2ac)]?_0x211920[_0x2ed79b(0x1cc)]+=_0x1d7da5[_0x2ed79b(0x2ac)]:console['log'](_0x2ed79b(0x27d)+_0x1d7da5['id']+_0x2ed79b(0x1fe))));}const _0x22e613=[],_0x408b18=[];for(const [_0x59023b,_0x289de7]of _0x4f5a60){_0x22e613[_0x2ed79b(0x1c0)]({'date':_0x59023b,'amount':Math[_0x2ed79b(0x1fb)](_0x289de7['revenue']*0x64)/0x64}),_0x408b18[_0x2ed79b(0x1c0)]({'date':_0x59023b,'count':_0x289de7['count']});}return{'dailyRevenue':_0x22e613,'dailyPayments':_0x408b18};}}exports[a35_0x471a84(0x1e1)]=AdminService;