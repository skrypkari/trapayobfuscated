'use strict';const a35_0x59b166=a35_0x44e4;(function(_0x40b268,_0xeac598){const _0x41c097=a35_0x44e4,_0x477629=_0x40b268();while(!![]){try{const _0xf7f18a=parseInt(_0x41c097(0x145))/0x1*(parseInt(_0x41c097(0x197))/0x2)+parseInt(_0x41c097(0x1d4))/0x3*(-parseInt(_0x41c097(0x107))/0x4)+-parseInt(_0x41c097(0x10b))/0x5+-parseInt(_0x41c097(0x18e))/0x6+parseInt(_0x41c097(0x19e))/0x7*(parseInt(_0x41c097(0x126))/0x8)+parseInt(_0x41c097(0x118))/0x9+-parseInt(_0x41c097(0x212))/0xa*(-parseInt(_0x41c097(0x1e0))/0xb);if(_0xf7f18a===_0xeac598)break;else _0x477629['push'](_0x477629['shift']());}catch(_0x382769){_0x477629['push'](_0x477629['shift']());}}}(a35_0x36e3,0x77e51));var __importDefault=this&&this[a35_0x59b166(0x233)]||function(_0x2d8312){const _0x171e45=a35_0x59b166;return _0x2d8312&&_0x2d8312[_0x171e45(0x116)]?_0x2d8312:{'default':_0x2d8312};};function a35_0x36e3(){const _0x227770=['successUrl','üí∞\x20Payment\x20','hex','merchantEarningsUSDT','\x20payments)','\x27\x20not\x20found.\x20Available\x20gateways:\x20','customerIp','getTime','üìä\x20Merchant\x20statistics\x20calculated:','paidAt','shopId','totalCommissionRate','getAllPayments','üí∞\x20[PAYOUT]\x20Merchant\x20','toISOString','turnoverUSDT','statusChangedBy','\x20\x20\x20üîç\x20Calculated\x20after\x20commission:\x20','createdAt','30d','getUserById','wallets','erc20','\x20\x20\x20Added\x20to\x20balance:\x20+','‚ö†Ô∏è\x20Requested\x20gateway\x20\x27','‚úÖ\x20Payout\x20created:\x20','gatewaySettings','\x20merchants\x20with\x20positive\x20balance','klyme_gb','\x20USDT\x20(actual\x20balances)','1445742kXPDRG','üí∞\x20Creating\x20payout\x20for\x20shop\x20','not\x20set','üîÑ\x20Converted\x20gateway\x20ID\x20\x27','\x20no\x20longer\x20PAID:','usdtTrcWallet','awaitingPayout','\x20paid\x20payments\x20for\x20analysis','groupBy','26998BUMqhI',',\x20userId:\x20','ceil','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','\x20USDT\x20(','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','14tgvxeT','insensitive','usdtPolygonWallet','../types/gateway','üí∏\x20CHARGEBACK:\x20Merchant\x20amount\x20already\x20deducted\x20from\x20balance','trim','gateways','all','\x20\x20\x20Total\x20paid\x20out:\x20','gatewayOrderId','currencyService','count','crypto','Open\x20Banking\x202','setDate','\x20USDT\x20(-','üìä\x20Calculating\x20payout\x20statistics...','cointopay','\x20\x20\x20ÔøΩ\x20Total\x20payments\x20turnover:\x20','desc','üìä\x20Getting\x20payments\x20with\x20filters:','test_gateway','paymentGateways','createUser','merchantEarnings','üîê\x20[','gateway','sk_','averageCommissionRate','getMerchantsAwaitingPayout','password','telegram','stringify','totalAmountUSDT','values','entries','getDate','payout','dailyPayments','\x20USDT','KLYME\x20EU','status','\x20active\x20merchants\x20for\x20selection','updatePaymentStatus','aggregate','toFixed','AdminService','forEach','amountUSDT','polygon_usdc','COMPLETED','%\x20commission)','\x20order','update','1539maZQfG','\x20for\x20shop\x20','usdcPolygonWallet','\x20USDT\x20(theoretical\x20net)','get','username','plisio','üìä\x20Sorting\x20payments\x20by\x20','Noda','getGatewayNameById','network','notes','296076UMavzM','trc20','Test\x20Gateway','currency','hash','üí∞\x20Current\x20shop\x20balance:\x20','\x20became\x20PAID:','üìä\x20Total\x20payments\x20(including\x20failed):\x20','amount','üéØ\x20updateUser\x20called\x20with\x20ID:\x20','üí≥\x20Payout\x20wallet\x20for\x20','getPayoutStats','\x20\x20\x20Merchant\x20gets:\x20','\x20USDT\x20(gross\x20revenue)','\x20\x20\x20üñ•Ô∏è\x20User\x20Agent:\x20','convertToUSDT','telegramId','split','CHARGEBACK','not\x20specified','log','averageCheckUSDT','updateCustomerData','createPayout','whiteUrl','findUnique','some','üîÑ\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','üí∞\x20[PAYOUT]\x20Gateway\x20','customerEmail','date','payment','getGatewayDisplayName','\x20\x20\x20üí∞\x20Total\x20payments\x20turnover:\x20','dailyRevenue','Username\x20already\x20exists','totalPayments','sort','commissionUSDT','getPaymentById',':\x20commission\x20=\x20','getAllPayouts','deletePayout','reduce','customerCountry','map','\x20\x20\x20üìä\x20Total\x20payments:\x20','defineProperty','PAID','\x20to\x20','110CTuozQ','pendingUrl','üìä\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','\x27\x20to\x20name\x20\x27','üìä\x20Payout\x20statistics\x20calculated:','Plisio','customerUa','\x27\x20->\x20name\x20\x27','lte','paidOutUSDT','paymentsCount','updateUser','periodTo','\x20\x20\x20üîç\x20Raw\x20balance\x20sum:\x20','merchantUrl','üìä\x20Getting\x20merchant\x20statistics\x20with\x20filters:','bcryptjs','\x20USDT\x20(after\x20','shopUrl','üîÑ\x20Gateway\x20mapping\x20(get):','randomBytes','üí∞\x20Shop\x20','gatewayEarnings','parse','üìã\x20Found\x20','totalAmountAfterCommissionUSDT','fullName',']\x20Gateway\x20settings\x20JSON\x20string:','üîÑ\x20Gateway\x20mapping\x20(create):','gte','\x20\x20\x20üìÖ\x20Total\x20payouts\x20(this\x20month):\x20','updatedAt','Rapyd','__importDefault','deleteUser','\x20\x20\x20üè™\x20Gateway\x20earnings:\x20','mastercard','‚úÖ\x20Customer\x20data\x20updated\x20for\x20payment\x20','2020-01-01','üìä\x20Gateway\x20filter\x20applied:','customerName','getAllUsers','\x20in\x20','5640UDhTki','\x20\x20\x20Payout\x20amount:\x20','getGatewayIdByName','üîß\x20[','1955630lfgFfn','periodFrom','\x20\x20\x20üíµ\x20Available\x20balance:\x20','txid','üéØ\x20[','round','getPayoutById','findMany','üîÑ\x20Updating\x20customer\x20data\x20for\x20payment\x20','toLowerCase','availableBalance','__esModule','length','7625043oKeUnA','default',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:',',\x20successful:\x20','_sum','\x20merchants','‚úÖ\x20Using\x20gateway\x20filter:\x20\x27','toUpperCase','üìÖ\x20Period:\x20','dateFrom','push','commission','\x27\x20(from\x20\x27','üìä\x20Available\x20gateways\x20in\x20database:','1894864pzxNOX','getMonth','_count','\x20\x20\x20üí∞\x20Total\x20payout:\x20','pk_','SUSPENDED','totalPaidOut','suspendUser','üîÑ\x20Admin\x20updating\x20payment\x20','error','\x20USDT\x20(after\x20payouts)','period','getGatewayInternalName','name','amountAfterCommissionUSDT','statusChangedAt','asc','orderId','\x20->\x20','ACTIVE','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','\x20USDT,\x20Requested:\x20','delete','custom','set','polygon','\x20\x20\x20Gateway:\x20','month','totalTurnover','‚ö†Ô∏è\x20Gateway\x20\x27','üí±\x20Currency\x20filter\x20applied:\x20','17bZzjSb','failureMessage','90d','\x20\x20\x20Full\x20amount:\x20','\x20\x20\x20üåç\x20Country:\x20','\x20\x20\x20üåê\x20IP:\x20','klyme_eu','$transaction','localeCompare','REFUND','publicKey','\x20status:\x20','noda','getFullYear','activateUser','revenue','Payment\x20not\x20found','includes','findFirst','turnover',']\x20Updating\x20password\x20for\x20user\x20','create','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','\x20\x20\x20Current\x20balance:\x20','üìä\x20Merchants\x20awaiting\x20payout:\x20','Telegram\x20username\x20already\x20exists','\x20\x20\x20üí≥\x20Total\x20payments:\x20','\x20\x20\x20‚úÖ\x20Total\x20available\x20for\x20payout:\x20','getMerchantsSelection','\x20USDT\x20(without\x20commission)',',\x20Commission:\x20',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','KLYME\x20GB','\x20USDT)','getMerchantStatistics','adminNotes','balance','generateDailyStatistics','üìä\x20Final\x20WHERE\x20conditions:','chargebackAmount','usdtErcWallet','shop','\x20\x20\x20‚úÖ\x20Actual\x20available\x20balance:\x20'];a35_0x36e3=function(){return _0x227770;};return a35_0x36e3();}function a35_0x44e4(_0x2694ca,_0xd3b36d){const _0x36e3ef=a35_0x36e3();return a35_0x44e4=function(_0x44e48c,_0x529c7f){_0x44e48c=_0x44e48c-0x102;let _0x2ec36d=_0x36e3ef[_0x44e48c];return _0x2ec36d;},a35_0x44e4(_0x2694ca,_0xd3b36d);}Object[a35_0x59b166(0x20f)](exports,a35_0x59b166(0x116),{'value':!![]}),exports['AdminService']=void 0x0;const database_1=__importDefault(require('../config/database')),bcryptjs_1=__importDefault(require(a35_0x59b166(0x222))),crypto_1=__importDefault(require(a35_0x59b166(0x1aa))),currencyService_1=require('./currencyService'),gateway_1=require(a35_0x59b166(0x1a1));class AdminService{async[a35_0x59b166(0x1eb)](){const _0x1b0001=a35_0x59b166;console['log'](_0x1b0001(0x1ae));const _0x4902a1=await database_1[_0x1b0001(0x119)][_0x1b0001(0x16e)][_0x1b0001(0x1ca)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x1b0001(0x139)}}),_0x5b65c9=await this['getMerchantsAwaitingPayout']({'page':0x1,'limit':0x3e8}),_0x46e703=await database_1['default'][_0x1b0001(0x1ff)][_0x1b0001(0x1a9)]({'where':{'status':_0x1b0001(0x210),'gateway':{'not':'test_gateway'}}}),_0x9649be=new Date(),_0x24e02b=new Date(_0x9649be['getFullYear'](),_0x9649be[_0x1b0001(0x127)](),0x1),_0x342867=new Date(_0x9649be[_0x1b0001(0x152)](),_0x9649be[_0x1b0001(0x127)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x3eb593=await database_1[_0x1b0001(0x119)]['payout'][_0x1b0001(0x1ca)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x24e02b,'lte':_0x342867},'status':'COMPLETED'}}),_0x49c3ae=_0x4902a1['_sum']['totalPaidOut']||0x0,_0x3fd354=_0x5b65c9['summary']['totalAmountAfterCommissionUSDT'],_0xaf8fa0=_0x3eb593['_sum']['amount']||0x0,_0x39651c={'totalPayout':Math[_0x1b0001(0x110)](_0x49c3ae*0x64)/0x64,'awaitingPayout':Math[_0x1b0001(0x110)](_0x3fd354*0x64)/0x64,'thisMonth':Math[_0x1b0001(0x110)](_0xaf8fa0*0x64)/0x64,'availableBalance':Math['round'](_0x3fd354*0x64)/0x64,'totalPayments':_0x46e703};return console[_0x1b0001(0x1f4)](_0x1b0001(0x216)),console[_0x1b0001(0x1f4)](_0x1b0001(0x129)+_0x39651c['totalPayout']+'\x20USDT\x20(total\x20paid\x20to\x20merchants)'),console[_0x1b0001(0x1f4)](_0x1b0001(0x13a)+_0x39651c[_0x1b0001(0x194)]+'\x20USDT\x20(with\x20commission\x20deducted)'),console[_0x1b0001(0x1f4)](_0x1b0001(0x10d)+_0x39651c[_0x1b0001(0x115)]+'\x20USDT\x20(same\x20as\x20awaiting)'),console['log']('\x20\x20\x20üìÖ\x20This\x20month:\x20'+_0x39651c['thisMonth']+_0x1b0001(0x1c5)),console['log'](_0x1b0001(0x15f)+_0x39651c[_0x1b0001(0x204)]+'\x20PAID\x20payments'),console[_0x1b0001(0x1f4)](_0x1b0001(0x21f)+(_0x4902a1[_0x1b0001(0x11c)]['balance']||0x0)[_0x1b0001(0x1cb)](0x2)+_0x1b0001(0x162)),console['log']('\x20\x20\x20üìä\x20Commission\x20difference:\x20'+((_0x4902a1[_0x1b0001(0x11c)][_0x1b0001(0x169)]||0x0)-_0x3fd354)[_0x1b0001(0x1cb)](0x2)+_0x1b0001(0x1c5)),_0x39651c;}async[a35_0x59b166(0x1f6)](_0x157cc1,_0xe47fc2){const _0x150f77=a35_0x59b166;console['log'](_0x150f77(0x113)+_0x157cc1+':',_0xe47fc2);const _0x344dda=await database_1[_0x150f77(0x119)][_0x150f77(0x1ff)][_0x150f77(0x1f9)]({'where':{'id':_0x157cc1},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x344dda)throw new Error(_0x150f77(0x155));const _0x54e79d={};_0xe47fc2['customerCountry']!==undefined&&(_0x54e79d['customerCountry']=_0xe47fc2[_0x150f77(0x20c)]||null);_0xe47fc2[_0x150f77(0x176)]!==undefined&&(_0x54e79d[_0x150f77(0x176)]=_0xe47fc2[_0x150f77(0x176)]||null);_0xe47fc2[_0x150f77(0x218)]!==undefined&&(_0x54e79d[_0x150f77(0x218)]=_0xe47fc2[_0x150f77(0x218)]||null);const _0x4865e2=await database_1['default']['payment'][_0x150f77(0x1d3)]({'where':{'id':_0x157cc1},'data':{..._0x54e79d,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x150f77(0x1f4)](_0x150f77(0x237)+_0x157cc1),console[_0x150f77(0x1f4)](_0x150f77(0x149)+_0x344dda[_0x150f77(0x20c)]+_0x150f77(0x138)+_0x4865e2[_0x150f77(0x20c)]),console[_0x150f77(0x1f4)](_0x150f77(0x14a)+_0x344dda[_0x150f77(0x176)]+_0x150f77(0x138)+_0x4865e2['customerIp']),console['log'](_0x150f77(0x1ee)+(_0x344dda[_0x150f77(0x218)]?_0x150f77(0x13e):'not\x20set')+_0x150f77(0x138)+(_0x4865e2[_0x150f77(0x218)]?'set':_0x150f77(0x190))),_0x4865e2;}async['getSystemStatistics'](_0x25d991){const _0x286a66=a35_0x59b166,_0x1eb74=new Date();let _0x59deba;switch(_0x25d991){case'7d':_0x59deba=new Date(_0x1eb74[_0x286a66(0x177)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x286a66(0x183):_0x59deba=new Date(_0x1eb74[_0x286a66(0x177)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x286a66(0x147):_0x59deba=new Date(_0x1eb74['getTime']()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x286a66(0x1a5):const _0x1f8695=await database_1['default'][_0x286a66(0x1ff)][_0x286a66(0x157)]({'where':{'gateway':{'not':_0x286a66(0x1b3)}},'orderBy':{'createdAt':'asc'},'select':{'createdAt':!![]}});_0x59deba=_0x1f8695?_0x1f8695['createdAt']:new Date(_0x286a66(0x102)),console[_0x286a66(0x1f4)]('üìÖ\x20Period\x20\x27all\x27:\x20Using\x20start\x20date\x20from\x20first\x20payment:\x20'+_0x59deba[_0x286a66(0x17e)]());break;default:_0x59deba=new Date(_0x1eb74[_0x286a66(0x177)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x42ef55,_0x31fc8f,_0xe1d579,_0x18b618,_0x414129,_0x3a4784,_0x2c7776]=await Promise['all']([database_1[_0x286a66(0x119)][_0x286a66(0x16e)][_0x286a66(0x1a9)](),database_1['default']['shop'][_0x286a66(0x1a9)]({'where':{'status':_0x286a66(0x139)}}),database_1['default'][_0x286a66(0x1ff)][_0x286a66(0x1a9)]({'where':{'createdAt':{'gte':_0x59deba},'gateway':{'not':_0x286a66(0x1b3)}}}),database_1[_0x286a66(0x119)]['payment'][_0x286a66(0x1a9)]({'where':{'status':_0x286a66(0x210),'createdAt':{'gte':_0x59deba},'gateway':{'not':'test_gateway'}}}),database_1[_0x286a66(0x119)][_0x286a66(0x1ff)][_0x286a66(0x112)]({'where':{'status':_0x286a66(0x210),'createdAt':{'gte':_0x59deba},'gateway':{'not':_0x286a66(0x1b3)}},'select':{'amount':!![],'currency':!![]}}),database_1['default'][_0x286a66(0x1ff)][_0x286a66(0x112)]({'where':{'gateway':{'not':_0x286a66(0x1b3)}},'take':0xa,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x286a66(0x119)][_0x286a66(0x1ff)][_0x286a66(0x112)]({'where':{'createdAt':{'gte':_0x59deba},'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x4f260b=0x0;for(const _0x4b9676 of _0x414129){const _0x732c2e=await currencyService_1[_0x286a66(0x1a8)]['convertToUSDT'](_0x4b9676[_0x286a66(0x1e8)],_0x4b9676[_0x286a66(0x1e3)]);_0x4f260b+=_0x732c2e;}const _0x14d8e2=this[_0x286a66(0x16a)](_0x2c7776,_0x59deba,_0x1eb74),_0x5e3632=_0xe1d579>0x0?_0x18b618/_0xe1d579*0x64:0x0;return{'totalShops':_0x42ef55,'activeShops':_0x31fc8f,'totalPayments':_0xe1d579,'successfulPayments':_0x18b618,'totalRevenue':Math[_0x286a66(0x110)](_0x4f260b*0x64)/0x64,'conversionRate':Math['round'](_0x5e3632*0x64)/0x64,'dailyRevenue':_0x14d8e2[_0x286a66(0x202)],'dailyPayments':_0x14d8e2[_0x286a66(0x1c4)],'recentPayments':_0x3a4784[_0x286a66(0x20d)](_0x38fc25=>({'id':_0x38fc25['id'],'amount':_0x38fc25[_0x286a66(0x1e8)],'currency':_0x38fc25[_0x286a66(0x1e3)],'status':_0x38fc25[_0x286a66(0x1c7)],'gateway':_0x38fc25[_0x286a66(0x1b8)],'shop':_0x38fc25[_0x286a66(0x16e)],'createdAt':_0x38fc25[_0x286a66(0x182)]}))};}async[a35_0x59b166(0x167)](_0x8f6721){const _0x2a8c2f=a35_0x59b166;console[_0x2a8c2f(0x1f4)](_0x2a8c2f(0x221),_0x8f6721);let _0x94059d,_0x55a540=new Date();if(_0x8f6721[_0x2a8c2f(0x131)]===_0x2a8c2f(0x13d)&&_0x8f6721[_0x2a8c2f(0x121)]&&_0x8f6721['dateTo'])_0x94059d=new Date(_0x8f6721['dateFrom']),_0x55a540=new Date(_0x8f6721['dateTo']);else{const _0x323b1c=new Date();switch(_0x8f6721[_0x2a8c2f(0x131)]){case'week':_0x94059d=new Date(_0x323b1c[_0x2a8c2f(0x177)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x2a8c2f(0x141):_0x94059d=new Date(_0x323b1c[_0x2a8c2f(0x177)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'year':_0x94059d=new Date(_0x323b1c[_0x2a8c2f(0x177)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x2a8c2f(0x1a5):default:_0x94059d=new Date(_0x2a8c2f(0x102));break;}}console[_0x2a8c2f(0x1f4)](_0x2a8c2f(0x120)+_0x94059d[_0x2a8c2f(0x17e)]()+_0x2a8c2f(0x211)+_0x55a540[_0x2a8c2f(0x17e)]());const _0x1576b6={'status':_0x2a8c2f(0x210),'gateway':{'not':_0x2a8c2f(0x1b3)},'paidAt':{'gte':_0x94059d,'lte':_0x55a540}};_0x8f6721[_0x2a8c2f(0x17a)]&&(_0x1576b6['shopId']=_0x8f6721[_0x2a8c2f(0x17a)]);const _0x441c74=await database_1[_0x2a8c2f(0x119)][_0x2a8c2f(0x1ff)][_0x2a8c2f(0x112)]({'where':_0x1576b6,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x2a8c2f(0x1f4)]('üí∞\x20Found\x20'+_0x441c74[_0x2a8c2f(0x117)]+_0x2a8c2f(0x195));const _0x36b0e2={'gateway':{'not':_0x2a8c2f(0x1b3)},'createdAt':{'gte':_0x94059d,'lte':_0x55a540}};_0x8f6721[_0x2a8c2f(0x17a)]&&(_0x36b0e2[_0x2a8c2f(0x17a)]=_0x8f6721['shopId']);const _0x4a9483=await database_1[_0x2a8c2f(0x119)][_0x2a8c2f(0x1ff)][_0x2a8c2f(0x1a9)]({'where':_0x36b0e2});console['log'](_0x2a8c2f(0x1e7)+_0x4a9483+_0x2a8c2f(0x11b)+_0x441c74[_0x2a8c2f(0x117)]);let _0x57d161=0x0,_0x2236b4=0x0,_0x24568b=0x0;const _0x2b5308={},_0x59a3a3={},_0xa7b2b8={};for(const _0x42f25b of _0x441c74){try{const _0x5e437b=await currencyService_1[_0x2a8c2f(0x1a8)][_0x2a8c2f(0x1ef)](_0x42f25b['amount'],_0x42f25b[_0x2a8c2f(0x1e3)]);let _0x406512={};if(_0x42f25b[_0x2a8c2f(0x16e)][_0x2a8c2f(0x18a)])try{_0x406512=JSON[_0x2a8c2f(0x229)](_0x42f25b[_0x2a8c2f(0x16e)][_0x2a8c2f(0x18a)]);}catch(_0xf5dfa3){console[_0x2a8c2f(0x12f)](_0x2a8c2f(0x19a)+_0x42f25b['shopId']+':',_0xf5dfa3);}let _0x6e13f6={},_0x4719da=0xa;for(const [_0x40b26c,_0x120a00]of Object['entries'](_0x406512)){if(_0x40b26c[_0x2a8c2f(0x114)]()===_0x42f25b[_0x2a8c2f(0x1b8)][_0x2a8c2f(0x114)]()){_0x6e13f6=_0x120a00,_0x4719da=_0x120a00[_0x2a8c2f(0x123)]||0xa;break;}}const _0x292d60=_0x5e437b*(_0x4719da/0x64),_0x70bac5=_0x5e437b-_0x292d60;_0x57d161+=_0x5e437b,_0x2236b4+=_0x70bac5,_0x24568b+=_0x292d60;!_0x2b5308[_0x42f25b[_0x2a8c2f(0x1b8)]]&&(_0x2b5308[_0x42f25b['gateway']]={'gateway':_0x42f25b['gateway'],'gatewayDisplayName':this[_0x2a8c2f(0x200)](_0x42f25b[_0x2a8c2f(0x1b8)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x2b5308[_0x42f25b[_0x2a8c2f(0x1b8)]][_0x2a8c2f(0x21c)]++,_0x2b5308[_0x42f25b[_0x2a8c2f(0x1b8)]][_0x2a8c2f(0x17f)]+=_0x5e437b,_0x2b5308[_0x42f25b[_0x2a8c2f(0x1b8)]][_0x2a8c2f(0x206)]+=_0x292d60,_0x2b5308[_0x42f25b['gateway']]['merchantEarningsUSDT']+=_0x70bac5,_0x2b5308[_0x42f25b[_0x2a8c2f(0x1b8)]]['totalCommissionRate']+=_0x4719da;!_0x8f6721['shopId']&&(!_0x59a3a3[_0x42f25b[_0x2a8c2f(0x17a)]]&&(_0x59a3a3[_0x42f25b[_0x2a8c2f(0x17a)]]={'shopId':_0x42f25b[_0x2a8c2f(0x17a)],'shopName':_0x42f25b[_0x2a8c2f(0x16e)][_0x2a8c2f(0x133)],'shopUsername':_0x42f25b[_0x2a8c2f(0x16e)]['username'],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x59a3a3[_0x42f25b[_0x2a8c2f(0x17a)]][_0x2a8c2f(0x21c)]++,_0x59a3a3[_0x42f25b[_0x2a8c2f(0x17a)]][_0x2a8c2f(0x17f)]+=_0x5e437b,_0x59a3a3[_0x42f25b['shopId']][_0x2a8c2f(0x206)]+=_0x292d60,_0x59a3a3[_0x42f25b[_0x2a8c2f(0x17a)]][_0x2a8c2f(0x173)]+=_0x70bac5);const _0xabccb5=_0x42f25b[_0x2a8c2f(0x179)][_0x2a8c2f(0x17e)]()[_0x2a8c2f(0x1f1)]('T')[0x0];!_0xa7b2b8[_0xabccb5]&&(_0xa7b2b8[_0xabccb5]={'date':_0xabccb5,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0xa7b2b8[_0xabccb5]['turnover']+=_0x5e437b,_0xa7b2b8[_0xabccb5][_0x2a8c2f(0x1b6)]+=_0x70bac5,_0xa7b2b8[_0xabccb5][_0x2a8c2f(0x228)]+=_0x292d60,_0xa7b2b8[_0xabccb5][_0x2a8c2f(0x21c)]++;}catch(_0x58876d){console[_0x2a8c2f(0x12f)]('Error\x20processing\x20payment\x20'+_0x42f25b['id']+':',_0x58876d);}}Object[_0x2a8c2f(0x1c0)](_0x2b5308)['forEach'](_0x7942ee=>{const _0x1a572a=_0x2a8c2f;_0x7942ee['averageCommissionRate']=_0x7942ee[_0x1a572a(0x21c)]>0x0?_0x7942ee[_0x1a572a(0x17b)]/_0x7942ee[_0x1a572a(0x21c)]:0x0,delete _0x7942ee[_0x1a572a(0x17b)];}),Object[_0x2a8c2f(0x1c0)](_0x59a3a3)[_0x2a8c2f(0x1cd)](_0x8634d0=>{const _0x6dcafb=_0x2a8c2f;_0x8634d0['averageCheckUSDT']=_0x8634d0[_0x6dcafb(0x21c)]>0x0?_0x8634d0[_0x6dcafb(0x17f)]/_0x8634d0[_0x6dcafb(0x21c)]:0x0;});let _0x4139bf=0x0;if(_0x8f6721['shopId']){const _0x4f8c55=await database_1[_0x2a8c2f(0x119)][_0x2a8c2f(0x1c3)][_0x2a8c2f(0x112)]({'where':{'shopId':_0x8f6721[_0x2a8c2f(0x17a)],'status':_0x2a8c2f(0x1d0),'createdAt':{'gte':_0x94059d,'lte':_0x55a540}},'select':{'amount':!![]}});_0x4139bf=_0x4f8c55['reduce']((_0x312a67,_0x4ae91d)=>_0x312a67+_0x4ae91d['amount'],0x0);}const _0x7fdf91=_0x4a9483,_0x297303=_0x441c74['length'],_0x1c3559=_0x297303>0x0?_0x57d161/_0x297303:0x0,_0x7ad4c=_0x7fdf91>0x0?Math[_0x2a8c2f(0x110)](_0x297303/_0x7fdf91*0x2710)/0x64:0x0,_0x56149d=Math[_0x2a8c2f(0x199)]((_0x55a540[_0x2a8c2f(0x177)]()-_0x94059d[_0x2a8c2f(0x177)]())/(0x3e8*0x3c*0x3c*0x18)),_0x2218a3={'totalTurnover':Math[_0x2a8c2f(0x110)](_0x57d161*0x64)/0x64,'merchantEarnings':Math['round'](_0x2236b4*0x64)/0x64,'gatewayEarnings':Math[_0x2a8c2f(0x110)](_0x24568b*0x64)/0x64,'totalPaidOut':Math[_0x2a8c2f(0x110)](_0x4139bf*0x64)/0x64,'averageCheck':Math['round'](_0x1c3559*0x64)/0x64,'totalPayments':_0x7fdf91,'successfulPayments':_0x297303,'conversionRate':_0x7ad4c,'gatewayBreakdown':Object[_0x2a8c2f(0x1c0)](_0x2b5308)[_0x2a8c2f(0x20d)](_0x259676=>({..._0x259676,'turnoverUSDT':Math[_0x2a8c2f(0x110)](_0x259676[_0x2a8c2f(0x17f)]*0x64)/0x64,'commissionUSDT':Math[_0x2a8c2f(0x110)](_0x259676[_0x2a8c2f(0x206)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x2a8c2f(0x110)](_0x259676[_0x2a8c2f(0x173)]*0x64)/0x64,'averageCommissionRate':Math[_0x2a8c2f(0x110)](_0x259676[_0x2a8c2f(0x1ba)]*0x64)/0x64})),'merchantBreakdown':_0x8f6721[_0x2a8c2f(0x17a)]?undefined:Object[_0x2a8c2f(0x1c0)](_0x59a3a3)[_0x2a8c2f(0x20d)](_0x2f5a90=>({..._0x2f5a90,'turnoverUSDT':Math[_0x2a8c2f(0x110)](_0x2f5a90['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x2a8c2f(0x110)](_0x2f5a90[_0x2a8c2f(0x206)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x2f5a90['merchantEarningsUSDT']*0x64)/0x64,'paidOutUSDT':Math[_0x2a8c2f(0x110)](_0x2f5a90[_0x2a8c2f(0x21b)]*0x64)/0x64,'averageCheckUSDT':Math[_0x2a8c2f(0x110)](_0x2f5a90[_0x2a8c2f(0x1f5)]*0x64)/0x64})),'dailyData':Object[_0x2a8c2f(0x1c0)](_0xa7b2b8)[_0x2a8c2f(0x20d)](_0x1078a7=>({..._0x1078a7,'turnover':Math[_0x2a8c2f(0x110)](_0x1078a7[_0x2a8c2f(0x158)]*0x64)/0x64,'merchantEarnings':Math[_0x2a8c2f(0x110)](_0x1078a7[_0x2a8c2f(0x1b6)]*0x64)/0x64,'gatewayEarnings':Math[_0x2a8c2f(0x110)](_0x1078a7[_0x2a8c2f(0x228)]*0x64)/0x64}))[_0x2a8c2f(0x205)]((_0x5c191d,_0x13d55b)=>_0x5c191d[_0x2a8c2f(0x1fe)][_0x2a8c2f(0x14d)](_0x13d55b[_0x2a8c2f(0x1fe)])),'periodInfo':{'from':_0x94059d,'to':_0x55a540,'periodType':_0x8f6721[_0x2a8c2f(0x131)]||'custom','daysCount':_0x56149d}};return console['log'](_0x2a8c2f(0x178)),console[_0x2a8c2f(0x1f4)]('\x20\x20\x20üí∞\x20Total\x20turnover:\x20'+_0x2218a3[_0x2a8c2f(0x142)]+'\x20USDT'),console[_0x2a8c2f(0x1f4)]('\x20\x20\x20üë§\x20Merchant\x20earnings:\x20'+_0x2218a3[_0x2a8c2f(0x1b6)]+_0x2a8c2f(0x1c5)),console[_0x2a8c2f(0x1f4)](_0x2a8c2f(0x235)+_0x2218a3[_0x2a8c2f(0x228)]+_0x2a8c2f(0x1c5)),console[_0x2a8c2f(0x1f4)](_0x2a8c2f(0x20e)+_0x2218a3[_0x2a8c2f(0x204)]),_0x2218a3;}async[a35_0x59b166(0x161)](){const _0x14e40e=a35_0x59b166;console[_0x14e40e(0x1f4)]('üìã\x20Getting\x20merchants\x20selection\x20list...');const _0x58e210=await database_1[_0x14e40e(0x119)][_0x14e40e(0x16e)][_0x14e40e(0x112)]({'where':{'status':_0x14e40e(0x139)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x14e40e(0x136)}});return console[_0x14e40e(0x1f4)](_0x14e40e(0x22a)+_0x58e210[_0x14e40e(0x117)]+_0x14e40e(0x1c8)),_0x58e210['map'](_0x4c17bb=>({'id':_0x4c17bb['id'],'username':_0x4c17bb['username'],'name':_0x4c17bb['name']}));}[a35_0x59b166(0x200)](_0x596178){const _0x289746=a35_0x59b166,_0x1d3d17={'test_gateway':_0x289746(0x1e2),'plisio':_0x289746(0x217),'rapyd':_0x289746(0x232),'noda':_0x289746(0x1dc),'cointopay':'CoinToPay','cointopay2':_0x289746(0x1ab),'klyme_eu':_0x289746(0x1c6),'klyme_gb':_0x289746(0x165),'klyme_de':'KLYME\x20DE','mastercard':'MasterCard'};return _0x1d3d17[_0x596178]||_0x596178;}[a35_0x59b166(0x132)](_0xe496cb){const _0x59a822=a35_0x59b166,_0x4f6119={'Test\x20Gateway':'test_gateway','Plisio':_0x59a822(0x1da),'Rapyd':'rapyd','Noda':_0x59a822(0x151),'CoinToPay':_0x59a822(0x1af),'CoinToPay2':'cointopay2','KLYME\x20EU':_0x59a822(0x14b),'KLYME\x20GB':_0x59a822(0x18c),'KLYME\x20DE':'klyme_de','MasterCard':_0x59a822(0x236)};return _0x4f6119[_0xe496cb]||_0xe496cb[_0x59a822(0x114)]();}async[a35_0x59b166(0x1bb)](_0x802006){const _0x3d29a2=a35_0x59b166,{page:_0x2b5a1a,limit:_0x36cf72,minAmount:_0x3d2664,search:_0x43451c}=_0x802006,_0x1a8b23=(_0x2b5a1a-0x1)*_0x36cf72;console[_0x3d29a2(0x1f4)](_0x3d29a2(0x214),_0x802006);const _0x58bca6={'balance':{'gt':0x0},'status':_0x3d29a2(0x139)};_0x3d2664&&(_0x58bca6['balance'][_0x3d29a2(0x22f)]=_0x3d2664);_0x43451c&&(_0x58bca6['OR']=[{'name':{'contains':_0x43451c,'mode':_0x3d29a2(0x19f)}},{'username':{'contains':_0x43451c,'mode':_0x3d29a2(0x19f)}}]);const [_0x50dfa8,_0x308df7]=await Promise[_0x3d29a2(0x1a5)]([database_1['default'][_0x3d29a2(0x16e)]['findMany']({'where':_0x58bca6,'skip':_0x1a8b23,'take':_0x36cf72,'orderBy':{'balance':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1[_0x3d29a2(0x119)]['shop'][_0x3d29a2(0x1a9)]({'where':_0x58bca6})]);console[_0x3d29a2(0x1f4)]('üí∞\x20Found\x20'+_0x50dfa8[_0x3d29a2(0x117)]+_0x3d29a2(0x18b));const _0x43ad87=await Promise['all'](_0x50dfa8[_0x3d29a2(0x20d)](async _0x48d3a9=>{const _0x20d555=_0x3d29a2,[_0x9791c6,_0x5aac9d,_0x77800f]=await Promise['all']([database_1['default'][_0x20d555(0x1ff)][_0x20d555(0x1a9)]({'where':{'shopId':_0x48d3a9['id'],'status':_0x20d555(0x210),'gateway':{'not':_0x20d555(0x1b3)}}}),database_1['default']['payment'][_0x20d555(0x157)]({'where':{'shopId':_0x48d3a9['id'],'status':'PAID','gateway':{'not':_0x20d555(0x1b3)}},'orderBy':{'paidAt':_0x20d555(0x136)},'select':{'paidAt':!![]}}),database_1[_0x20d555(0x119)][_0x20d555(0x1ff)][_0x20d555(0x196)]({'by':[_0x20d555(0x1b8)],'where':{'shopId':_0x48d3a9['id'],'status':_0x20d555(0x210),'gateway':{'not':'test_gateway'}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x4983ba=new Date(),_0x242a57=new Date(_0x4983ba['getFullYear'](),_0x4983ba[_0x20d555(0x127)](),0x1),_0x5e88eb=new Date(_0x4983ba[_0x20d555(0x152)](),_0x4983ba[_0x20d555(0x127)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x505fc9,_0x328bc5]=await Promise[_0x20d555(0x1a5)]([database_1[_0x20d555(0x119)][_0x20d555(0x1c3)]['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x48d3a9['id'],'status':_0x20d555(0x1d0)}}),database_1[_0x20d555(0x119)][_0x20d555(0x1c3)]['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x48d3a9['id'],'status':_0x20d555(0x1d0),'createdAt':{'gte':_0x242a57,'lte':_0x5e88eb}}})]),_0x4f3886=_0x505fc9[_0x20d555(0x11c)][_0x20d555(0x1e8)]||0x0,_0x5dcf5d=_0x328bc5[_0x20d555(0x11c)]['amount']||0x0,_0x27de59=await Promise[_0x20d555(0x1a5)](_0x77800f[_0x20d555(0x20d)](async _0x4fb124=>{const _0x473340=_0x20d555;let _0x288cf1=0xa;if(_0x48d3a9[_0x473340(0x18a)])try{const _0x30fd0b=JSON[_0x473340(0x229)](_0x48d3a9['gatewaySettings']);for(const [_0x229e4c,_0x28878a]of Object[_0x473340(0x1c1)](_0x30fd0b)){if(_0x229e4c['toLowerCase']()===_0x4fb124[_0x473340(0x1b8)][_0x473340(0x114)]()){_0x288cf1=_0x28878a[_0x473340(0x123)]||0xa,console[_0x473340(0x1f4)](_0x473340(0x1fc)+_0x4fb124['gateway']+'\x20for\x20shop\x20'+_0x48d3a9['id']+_0x473340(0x208)+_0x288cf1+'%');break;}}}catch(_0x393322){console[_0x473340(0x12f)](_0x473340(0x19a)+_0x48d3a9['id']+':',_0x393322);}const _0x3f221b=_0x4fb124['_sum'][_0x473340(0x1ce)]||0x0,_0x214240=_0x3f221b*(0x1-_0x288cf1/0x64);return{'gateway':_0x4fb124[_0x473340(0x1b8)],'count':_0x4fb124['_count']['id'],'amountUSDT':Math[_0x473340(0x110)](_0x3f221b*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x473340(0x110)](_0x214240*0x64)/0x64,'commission':_0x288cf1};})),_0xd91bd=_0x27de59[_0x20d555(0x20b)]((_0x4f5401,_0x3c18bd)=>_0x4f5401+_0x3c18bd['amountUSDT'],0x0),_0x3c7ae9=_0x48d3a9[_0x20d555(0x169)];return console['log'](_0x20d555(0x17d)+_0x48d3a9[_0x20d555(0x1d9)]+':'),console[_0x20d555(0x1f4)](_0x20d555(0x1b0)+_0xd91bd[_0x20d555(0x1cb)](0x2)+_0x20d555(0x1ed)),console['log'](_0x20d555(0x181)+_0x27de59[_0x20d555(0x20b)]((_0x2812aa,_0x18065a)=>_0x2812aa+_0x18065a[_0x20d555(0x134)],0x0)[_0x20d555(0x1cb)](0x2)+_0x20d555(0x1d7)),console[_0x20d555(0x1f4)](_0x20d555(0x16f)+_0x3c7ae9[_0x20d555(0x1cb)](0x2)+_0x20d555(0x130)),{'id':_0x48d3a9['id'],'fullName':_0x48d3a9[_0x20d555(0x133)],'username':_0x48d3a9[_0x20d555(0x1d9)],'telegramId':_0x48d3a9[_0x20d555(0x1bd)],'merchantUrl':_0x48d3a9[_0x20d555(0x224)],'wallets':{'usdtPolygonWallet':_0x48d3a9[_0x20d555(0x1a0)],'usdtTrcWallet':_0x48d3a9[_0x20d555(0x193)],'usdtErcWallet':_0x48d3a9[_0x20d555(0x16d)],'usdcPolygonWallet':_0x48d3a9['usdcPolygonWallet']},'totalAmountUSDT':Math[_0x20d555(0x110)](_0xd91bd*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x20d555(0x110)](_0x3c7ae9*0x64)/0x64,'totalPayout':Math[_0x20d555(0x110)](_0x4f3886*0x64)/0x64,'thisMonth':Math['round'](_0x5dcf5d*0x64)/0x64,'paymentsCount':_0x9791c6,'oldestPaymentDate':_0x5aac9d?.[_0x20d555(0x179)]||_0x48d3a9[_0x20d555(0x182)],'gatewayBreakdown':_0x27de59};})),_0x10cbb7=_0x43ad87['reduce']((_0x5d011d,_0x2d1eeb)=>_0x5d011d+_0x2d1eeb[_0x3d29a2(0x1bf)],0x0),_0x234ad0=_0x43ad87[_0x3d29a2(0x20b)]((_0xb2f5b9,_0x299eff)=>_0xb2f5b9+_0x299eff[_0x3d29a2(0x22b)],0x0),_0x1542bf=_0x43ad87[_0x3d29a2(0x20b)]((_0x4cef30,_0xbf6f7f)=>_0x4cef30+_0xbf6f7f['totalPayout'],0x0),_0x13807a=_0x43ad87[_0x3d29a2(0x20b)]((_0x29b492,_0x1d00bd)=>_0x29b492+_0x1d00bd['thisMonth'],0x0);return console[_0x3d29a2(0x1f4)](_0x3d29a2(0x15d)+_0x308df7+_0x3d29a2(0x11d)),console[_0x3d29a2(0x1f4)](_0x3d29a2(0x201)+Math[_0x3d29a2(0x110)](_0x10cbb7*0x64)/0x64+_0x3d29a2(0x1ed)),console[_0x3d29a2(0x1f4)](_0x3d29a2(0x160)+Math[_0x3d29a2(0x110)](_0x234ad0*0x64)/0x64+_0x3d29a2(0x18d)),console[_0x3d29a2(0x1f4)]('\x20\x20\x20üí∏\x20Total\x20payouts\x20(all\x20time):\x20'+Math[_0x3d29a2(0x110)](_0x1542bf*0x64)/0x64+_0x3d29a2(0x1c5)),console[_0x3d29a2(0x1f4)](_0x3d29a2(0x230)+Math[_0x3d29a2(0x110)](_0x13807a*0x64)/0x64+'\x20USDT'),{'merchants':_0x43ad87,'pagination':{'page':_0x2b5a1a,'limit':_0x36cf72,'total':_0x308df7,'totalPages':Math[_0x3d29a2(0x199)](_0x308df7/_0x36cf72)},'summary':{'totalMerchants':_0x308df7,'totalAmountUSDT':Math[_0x3d29a2(0x110)](_0x10cbb7*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x3d29a2(0x110)](_0x234ad0*0x64)/0x64,'totalPayout':Math['round'](_0x1542bf*0x64)/0x64,'thisMonth':Math[_0x3d29a2(0x110)](_0x13807a*0x64)/0x64}};}async[a35_0x59b166(0x1f7)](_0x59891e){const _0x15cad3=a35_0x59b166,{shopId:_0x17185b,amount:_0x4e646d,network:_0x35ac4f,wallet:_0x419e76,notes:_0xd3aec,txid:_0x363e47,periodFrom:_0x30c3b6,periodTo:_0x31c734}=_0x59891e,_0x56af77=await database_1[_0x15cad3(0x119)]['$transaction'](async _0x3dda29=>{const _0x170069=_0x15cad3,_0x1cc918=await _0x3dda29[_0x170069(0x16e)][_0x170069(0x1f9)]({'where':{'id':_0x17185b},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x1cc918)throw new Error('Shop\x20not\x20found');console[_0x170069(0x1f4)](_0x170069(0x18f)+_0x1cc918[_0x170069(0x1d9)]+':'),console['log'](_0x170069(0x15c)+_0x1cc918[_0x170069(0x169)][_0x170069(0x1cb)](0x6)+_0x170069(0x1c5)),console[_0x170069(0x1f4)](_0x170069(0x108)+_0x4e646d[_0x170069(0x1cb)](0x6)+_0x170069(0x1c5)),console[_0x170069(0x1f4)]('\x20\x20\x20Current\x20total\x20paid\x20out:\x20'+_0x1cc918[_0x170069(0x12c)][_0x170069(0x1cb)](0x6)+_0x170069(0x1c5));if(_0x363e47)console[_0x170069(0x1f4)]('\x20\x20\x20Transaction\x20hash:\x20'+_0x363e47);if(_0x1cc918[_0x170069(0x169)]<_0x4e646d)throw new Error('Insufficient\x20balance.\x20Available:\x20'+_0x1cc918[_0x170069(0x169)][_0x170069(0x1cb)](0x6)+_0x170069(0x13b)+_0x4e646d['toFixed'](0x6)+_0x170069(0x1c5));let _0xd978bb=_0x419e76;if(!_0xd978bb){const _0x38e594=await _0x3dda29[_0x170069(0x16e)][_0x170069(0x1f9)]({'where':{'id':_0x17185b},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x38e594)switch(_0x35ac4f){case _0x170069(0x13f):_0xd978bb=_0x38e594['usdtPolygonWallet']||undefined;break;case _0x170069(0x1e1):_0xd978bb=_0x38e594['usdtTrcWallet']||undefined;break;case _0x170069(0x186):_0xd978bb=_0x38e594[_0x170069(0x16d)]||undefined;break;case _0x170069(0x1cf):_0xd978bb=_0x38e594['usdcPolygonWallet']||undefined;break;}}console[_0x170069(0x1f4)](_0x170069(0x1ea)+_0x35ac4f+':\x20'+(_0xd978bb||_0x170069(0x1f3)));const _0xb4deeb=await _0x3dda29[_0x170069(0x1c3)][_0x170069(0x15a)]({'data':{'shopId':_0x17185b,'amount':_0x4e646d,'network':_0x35ac4f,'status':_0x170069(0x1d0),'txid':_0x363e47,'notes':_0xd3aec,'periodFrom':_0x30c3b6?new Date(_0x30c3b6):null,'periodTo':_0x31c734?new Date(_0x31c734):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x271139=_0x1cc918['balance']-_0x4e646d,_0x1168f3=_0x1cc918['totalPaidOut']+_0x4e646d;return await _0x3dda29[_0x170069(0x16e)][_0x170069(0x1d3)]({'where':{'id':_0x17185b},'data':{'balance':_0x271139,'totalPaidOut':_0x1168f3}}),console['log'](_0x170069(0x227)+_0x1cc918['username']+'\x20balance\x20updated:'),console[_0x170069(0x1f4)]('\x20\x20\x20Balance:\x20'+_0x1cc918[_0x170069(0x169)][_0x170069(0x1cb)](0x6)+_0x170069(0x138)+_0x271139[_0x170069(0x1cb)](0x6)+_0x170069(0x1ad)+_0x4e646d[_0x170069(0x1cb)](0x6)+')'),console[_0x170069(0x1f4)](_0x170069(0x1a6)+_0x1cc918[_0x170069(0x12c)][_0x170069(0x1cb)](0x6)+'\x20->\x20'+_0x1168f3['toFixed'](0x6)+'\x20USDT\x20(+'+_0x4e646d[_0x170069(0x1cb)](0x6)+')'),{'payout':_0xb4deeb,'shop':_0x1cc918};});return console[_0x15cad3(0x1f4)](_0x15cad3(0x189)+_0x56af77[_0x15cad3(0x1c3)]['id']+_0x15cad3(0x1d5)+_0x56af77[_0x15cad3(0x16e)][_0x15cad3(0x1d9)]+'\x20('+_0x4e646d+_0x15cad3(0x166)),{'id':_0x56af77[_0x15cad3(0x1c3)]['id'],'shopId':_0x56af77[_0x15cad3(0x1c3)][_0x15cad3(0x17a)],'shopName':_0x56af77['shop'][_0x15cad3(0x133)],'shopUsername':_0x56af77[_0x15cad3(0x16e)]['username'],'amount':_0x56af77[_0x15cad3(0x1c3)][_0x15cad3(0x1e8)],'network':_0x56af77[_0x15cad3(0x1c3)][_0x15cad3(0x1de)],'status':_0x56af77['payout']['status'],'txid':_0x56af77[_0x15cad3(0x1c3)]['txid'],'notes':_0x56af77[_0x15cad3(0x1c3)][_0x15cad3(0x1df)],'periodFrom':_0x56af77['payout'][_0x15cad3(0x10c)],'periodTo':_0x56af77[_0x15cad3(0x1c3)][_0x15cad3(0x21e)],'createdAt':_0x56af77[_0x15cad3(0x1c3)][_0x15cad3(0x182)],'paidAt':_0x56af77[_0x15cad3(0x1c3)]['paidAt']};}async[a35_0x59b166(0x209)](_0x2a458f){const _0x32d6c9=a35_0x59b166,{page:_0x1456bb,limit:_0x19b436,shopId:_0xa890a6,network:_0x2a298a,dateFrom:_0x887390,dateTo:_0x29c6ea,search:_0x3cc0c4}=_0x2a458f,_0x1d1385=(_0x1456bb-0x1)*_0x19b436,_0x53635f={};_0xa890a6&&(_0x53635f[_0x32d6c9(0x17a)]=_0xa890a6);_0x2a298a&&(_0x53635f['network']=_0x2a298a);(_0x887390||_0x29c6ea)&&(_0x53635f['createdAt']={},_0x887390&&(_0x53635f['createdAt']['gte']=new Date(_0x887390)),_0x29c6ea&&(_0x53635f[_0x32d6c9(0x182)]['lte']=new Date(_0x29c6ea)));_0x3cc0c4&&(_0x53635f['OR']=[{'shop':{'name':{'contains':_0x3cc0c4,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x3cc0c4,'mode':_0x32d6c9(0x19f)}}},{'notes':{'contains':_0x3cc0c4,'mode':_0x32d6c9(0x19f)}}]);const [_0x4168b1,_0x2028a2]=await Promise[_0x32d6c9(0x1a5)]([database_1['default'][_0x32d6c9(0x1c3)][_0x32d6c9(0x112)]({'where':_0x53635f,'skip':_0x1d1385,'take':_0x19b436,'orderBy':{'createdAt':_0x32d6c9(0x1b1)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x32d6c9(0x119)][_0x32d6c9(0x1c3)]['count']({'where':_0x53635f})]);return{'payouts':_0x4168b1[_0x32d6c9(0x20d)](_0x3e30a9=>({'id':_0x3e30a9['id'],'shopId':_0x3e30a9['shopId'],'shopName':_0x3e30a9[_0x32d6c9(0x16e)][_0x32d6c9(0x133)],'shopUsername':_0x3e30a9[_0x32d6c9(0x16e)][_0x32d6c9(0x1d9)],'amount':_0x3e30a9[_0x32d6c9(0x1e8)],'network':_0x3e30a9[_0x32d6c9(0x1de)],'status':_0x3e30a9[_0x32d6c9(0x1c7)],'txid':_0x3e30a9[_0x32d6c9(0x10e)],'notes':_0x3e30a9[_0x32d6c9(0x1df)],'periodFrom':_0x3e30a9[_0x32d6c9(0x10c)],'periodTo':_0x3e30a9[_0x32d6c9(0x21e)],'createdAt':_0x3e30a9[_0x32d6c9(0x182)],'paidAt':_0x3e30a9[_0x32d6c9(0x179)]})),'pagination':{'page':_0x1456bb,'limit':_0x19b436,'total':_0x2028a2,'totalPages':Math[_0x32d6c9(0x199)](_0x2028a2/_0x19b436)}};}async[a35_0x59b166(0x111)](_0x2bad24){const _0x35a56b=a35_0x59b166,_0x2680b7=await database_1[_0x35a56b(0x119)]['payout']['findUnique']({'where':{'id':_0x2bad24},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x2680b7)return null;return{'id':_0x2680b7['id'],'shopId':_0x2680b7[_0x35a56b(0x17a)],'shopName':_0x2680b7['shop'][_0x35a56b(0x133)],'shopUsername':_0x2680b7[_0x35a56b(0x16e)][_0x35a56b(0x1d9)],'amount':_0x2680b7['amount'],'network':_0x2680b7[_0x35a56b(0x1de)],'status':_0x2680b7['status'],'txid':_0x2680b7[_0x35a56b(0x10e)],'notes':_0x2680b7[_0x35a56b(0x1df)],'periodFrom':_0x2680b7[_0x35a56b(0x10c)],'periodTo':_0x2680b7[_0x35a56b(0x21e)],'createdAt':_0x2680b7[_0x35a56b(0x182)],'paidAt':_0x2680b7['paidAt']};}async[a35_0x59b166(0x20a)](_0x38b757){const _0x50890c=a35_0x59b166;await database_1[_0x50890c(0x119)][_0x50890c(0x1c3)][_0x50890c(0x13c)]({'where':{'id':_0x38b757}});}async[a35_0x59b166(0x17c)](_0x198931){const _0x40b10c=a35_0x59b166,{page:_0x6147f7,limit:_0x263dae,status:_0x2316b2,gateway:_0x372cb8,shopId:_0x4dac5f,dateFrom:_0x4ddaf5,dateTo:_0xd7f92b,search:_0x3d5f90,currency:_0x33f054,sortBy:_0x22459,sortOrder:_0x3b61fb}=_0x198931,_0x4a610c=(_0x6147f7-0x1)*_0x263dae;console[_0x40b10c(0x1f4)](_0x40b10c(0x1b2),_0x198931);const _0xd976a6=await database_1[_0x40b10c(0x119)]['payment'][_0x40b10c(0x196)]({'by':[_0x40b10c(0x1b8)],'_count':{'gateway':!![]}});console[_0x40b10c(0x1f4)](_0x40b10c(0x125),_0xd976a6[_0x40b10c(0x20d)](_0x75dac7=>_0x75dac7['gateway']+'\x20('+_0x75dac7[_0x40b10c(0x128)][_0x40b10c(0x1b8)]+_0x40b10c(0x174)));if(_0x372cb8){const _0x2f32e8=_0xd976a6[_0x40b10c(0x1fa)](_0x279f34=>_0x279f34[_0x40b10c(0x1b8)]['toLowerCase']()===_0x372cb8[_0x40b10c(0x114)]());!_0x2f32e8&&_0x372cb8[_0x40b10c(0x114)]()!==_0x40b10c(0x1b3)&&console['log'](_0x40b10c(0x188)+_0x372cb8+_0x40b10c(0x175)+_0xd976a6[_0x40b10c(0x20d)](_0x44cd3e=>_0x44cd3e[_0x40b10c(0x1b8)])['join'](',\x20'));}const _0x49b15e={};_0x2316b2&&(_0x49b15e['status']=_0x2316b2[_0x40b10c(0x11f)]());if(!_0x372cb8)_0x49b15e['gateway']={'not':_0x40b10c(0x1b3)};else{if(_0x372cb8&&(_0x372cb8[_0x40b10c(0x114)]()==='test_gateway'||_0x372cb8==='0000'))_0x49b15e['gateway']=_0x40b10c(0x1b3);else{let _0x56f054=_0x372cb8;const _0x18087d=(0x0,gateway_1['getGatewayNameById'])(_0x372cb8);if(_0x18087d)_0x56f054=_0x18087d,console[_0x40b10c(0x1f4)](_0x40b10c(0x191)+_0x372cb8+_0x40b10c(0x215)+_0x56f054+'\x27');else{const _0x3cdde8=(0x0,gateway_1[_0x40b10c(0x109)])(_0x372cb8);if(_0x3cdde8){const _0xf8a9cb=(0x0,gateway_1[_0x40b10c(0x1dd)])(_0x3cdde8);_0xf8a9cb&&(_0x56f054=_0xf8a9cb,console[_0x40b10c(0x1f4)]('üîÑ\x20Converted\x20gateway\x20name\x20\x27'+_0x372cb8+'\x27\x20->\x20ID\x20\x27'+_0x3cdde8+_0x40b10c(0x219)+_0x56f054+'\x27'));}else console[_0x40b10c(0x1f4)]('üîç\x20Using\x20gateway\x20\x27'+_0x372cb8+'\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)');}const _0x2907b0=await database_1['default'][_0x40b10c(0x1ff)][_0x40b10c(0x1a9)]({'where':{'gateway':_0x56f054[_0x40b10c(0x114)]()},'take':0x1});_0x2907b0===0x0?(console[_0x40b10c(0x1f4)](_0x40b10c(0x143)+_0x56f054+_0x40b10c(0x124)+_0x372cb8+_0x40b10c(0x15b)),_0x49b15e[_0x40b10c(0x1b8)]='NONEXISTENT_GATEWAY_FILTER'):(_0x49b15e[_0x40b10c(0x1b8)]=_0x56f054[_0x40b10c(0x114)](),console['log'](_0x40b10c(0x11e)+_0x56f054+_0x40b10c(0x124)+_0x372cb8+'\x27)'));}}console[_0x40b10c(0x1f4)](_0x40b10c(0x103),_0x49b15e[_0x40b10c(0x1b8)]);_0x4dac5f&&(_0x49b15e[_0x40b10c(0x17a)]=_0x4dac5f);_0x33f054&&(_0x49b15e[_0x40b10c(0x1e3)]=_0x33f054[_0x40b10c(0x11f)](),console[_0x40b10c(0x1f4)](_0x40b10c(0x144)+_0x33f054[_0x40b10c(0x11f)]()));(_0x4ddaf5||_0xd7f92b)&&(_0x49b15e[_0x40b10c(0x182)]={},_0x4ddaf5&&(_0x49b15e['createdAt'][_0x40b10c(0x22f)]=new Date(_0x4ddaf5)),_0xd7f92b&&(_0x49b15e[_0x40b10c(0x182)][_0x40b10c(0x21a)]=new Date(_0xd7f92b)));_0x3d5f90&&(_0x49b15e['OR']=[{'id':{'contains':_0x3d5f90,'mode':'insensitive'}},{'orderId':{'contains':_0x3d5f90,'mode':_0x40b10c(0x19f)}},{'gatewayOrderId':{'contains':_0x3d5f90,'mode':_0x40b10c(0x19f)}},{'customerEmail':{'contains':_0x3d5f90,'mode':'insensitive'}},{'shop':{'name':{'contains':_0x3d5f90,'mode':_0x40b10c(0x19f)}}},{'shop':{'username':{'contains':_0x3d5f90,'mode':_0x40b10c(0x19f)}}}]);console[_0x40b10c(0x1f4)](_0x40b10c(0x16b),JSON[_0x40b10c(0x1be)](_0x49b15e,null,0x2));let _0x513f5c={'createdAt':_0x40b10c(0x1b1)};if(_0x22459){const _0x4b95ec=[_0x40b10c(0x1e8),_0x40b10c(0x182),_0x40b10c(0x231),'status',_0x40b10c(0x1b8),'currency'],_0x1382e9=[_0x40b10c(0x136),_0x40b10c(0x1b1)];if(_0x4b95ec[_0x40b10c(0x156)](_0x22459)){const _0x518ec4=_0x1382e9[_0x40b10c(0x156)](_0x3b61fb)?_0x3b61fb:_0x40b10c(0x1b1);_0x513f5c={[_0x22459]:_0x518ec4},console[_0x40b10c(0x1f4)](_0x40b10c(0x1db)+_0x22459+_0x40b10c(0x106)+_0x518ec4+_0x40b10c(0x1d2));}}const [_0x1e6746,_0x40ad2a]=await Promise[_0x40b10c(0x1a5)]([database_1[_0x40b10c(0x119)]['payment'][_0x40b10c(0x112)]({'where':_0x49b15e,'skip':_0x4a610c,'take':_0x263dae,'orderBy':_0x513f5c,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x40b10c(0x119)][_0x40b10c(0x1ff)][_0x40b10c(0x1a9)]({'where':_0x49b15e})]);return{'payments':_0x1e6746,'pagination':{'page':_0x6147f7,'limit':_0x263dae,'total':_0x40ad2a,'totalPages':Math[_0x40b10c(0x199)](_0x40ad2a/_0x263dae)}};}async[a35_0x59b166(0x207)](_0x5236d4){const _0x1734d1=a35_0x59b166,_0x5e9367=await database_1[_0x1734d1(0x119)][_0x1734d1(0x1ff)][_0x1734d1(0x1f9)]({'where':{'id':_0x5236d4},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x5e9367)return null;return{'id':_0x5e9367['id'],'shopId':_0x5e9367[_0x1734d1(0x17a)],'gateway':_0x5e9367['gateway'],'amount':_0x5e9367[_0x1734d1(0x1e8)],'currency':_0x5e9367['currency'],'status':_0x5e9367[_0x1734d1(0x1c7)],'orderId':_0x5e9367[_0x1734d1(0x137)],'gatewayOrderId':_0x5e9367['gatewayOrderId'],'customerEmail':_0x5e9367[_0x1734d1(0x1fd)],'customerName':_0x5e9367[_0x1734d1(0x104)],'customerCountry':_0x5e9367['customerCountry'],'customerIp':_0x5e9367[_0x1734d1(0x176)],'customerUa':_0x5e9367[_0x1734d1(0x218)],'failureMessage':_0x5e9367[_0x1734d1(0x146)],'externalPaymentUrl':_0x5e9367['externalPaymentUrl'],'successUrl':_0x5e9367[_0x1734d1(0x170)],'failUrl':_0x5e9367['failUrl'],'pendingUrl':_0x5e9367[_0x1734d1(0x213)],'whiteUrl':_0x5e9367[_0x1734d1(0x1f8)],'createdAt':_0x5e9367[_0x1734d1(0x182)],'updatedAt':_0x5e9367[_0x1734d1(0x231)],'shop':_0x5e9367[_0x1734d1(0x16e)]};}async[a35_0x59b166(0x1c9)](_0x53bae8,_0x55c7bf,_0x521693,_0x900e92){const _0x535a64=a35_0x59b166,_0x17e7b0=await database_1['default'][_0x535a64(0x14c)](async _0x432480=>{const _0x4687d8=_0x535a64,_0x1de482=await _0x432480[_0x4687d8(0x1ff)][_0x4687d8(0x1f9)]({'where':{'id':_0x53bae8},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x1de482)throw new Error(_0x4687d8(0x155));const _0x4fd5b0=_0x1de482['status'],_0x3027d7=_0x55c7bf[_0x4687d8(0x11f)]();console[_0x4687d8(0x1f4)](_0x4687d8(0x12e)+_0x53bae8+_0x4687d8(0x150)+_0x4fd5b0+'\x20->\x20'+_0x3027d7),console[_0x4687d8(0x1f4)](_0x4687d8(0x1e5)+_0x1de482['shop']['balance']+_0x4687d8(0x1c5));const _0x3dc9bc={'status':_0x3027d7,'updatedAt':new Date(),'statusChangedBy':'admin','statusChangedAt':new Date()};_0x521693&&(_0x3dc9bc[_0x4687d8(0x168)]=_0x521693);_0x3027d7===_0x4687d8(0x1f2)&&_0x900e92&&(_0x3dc9bc[_0x4687d8(0x16c)]=_0x900e92);let _0x5bed97=0x0,_0x4c61a5=_0x1de482[_0x4687d8(0x16e)][_0x4687d8(0x169)];if(_0x3027d7==='PAID'&&_0x4fd5b0!==_0x4687d8(0x210)){_0x3dc9bc[_0x4687d8(0x179)]=new Date();const _0x10cea0=await currencyService_1[_0x4687d8(0x1a8)][_0x4687d8(0x1ef)](_0x1de482[_0x4687d8(0x1e8)],_0x1de482[_0x4687d8(0x1e3)]);_0x3dc9bc[_0x4687d8(0x1ce)]=_0x10cea0;let _0x5edf1f=0xa;const _0x32809b=await _0x432480['shop'][_0x4687d8(0x1f9)]({'where':{'id':_0x1de482[_0x4687d8(0x17a)]},'select':{'gatewaySettings':!![]}});if(_0x32809b?.[_0x4687d8(0x18a)])try{const _0x57f430=JSON[_0x4687d8(0x229)](_0x32809b[_0x4687d8(0x18a)]);for(const [_0xc47023,_0x31aaed]of Object[_0x4687d8(0x1c1)](_0x57f430)){if(_0xc47023['toLowerCase']()===_0x1de482[_0x4687d8(0x1b8)][_0x4687d8(0x114)]()){_0x5edf1f=_0x31aaed[_0x4687d8(0x123)]||0xa;break;}}}catch(_0x48371a){console['error'](_0x4687d8(0x19d)+_0x53bae8+':',_0x48371a);}const _0x41f65d=_0x10cea0*(0x1-_0x5edf1f/0x64);_0x5bed97=_0x41f65d,_0x4c61a5+=_0x41f65d,console['log'](_0x4687d8(0x171)+_0x53bae8+_0x4687d8(0x1e6)),console[_0x4687d8(0x1f4)](_0x4687d8(0x148)+_0x10cea0[_0x4687d8(0x1cb)](0x6)+_0x4687d8(0x1c5)),console[_0x4687d8(0x1f4)](_0x4687d8(0x140)+_0x1de482['gateway']+_0x4687d8(0x163)+_0x5edf1f+'%'),console[_0x4687d8(0x1f4)](_0x4687d8(0x1ec)+_0x41f65d[_0x4687d8(0x1cb)](0x6)+_0x4687d8(0x223)+_0x5edf1f+_0x4687d8(0x1d1)),console['log'](_0x4687d8(0x187)+_0x41f65d[_0x4687d8(0x1cb)](0x6)+_0x4687d8(0x1c5));}else{if(_0x4fd5b0==='PAID'&&_0x3027d7!=='PAID'){if(_0x1de482[_0x4687d8(0x1ce)]){let _0x11edcf=0xa;const _0x182de7=await _0x432480[_0x4687d8(0x16e)]['findUnique']({'where':{'id':_0x1de482[_0x4687d8(0x17a)]},'select':{'gatewaySettings':!![]}});if(_0x182de7?.['gatewaySettings'])try{const _0x50da42=JSON[_0x4687d8(0x229)](_0x182de7[_0x4687d8(0x18a)]);for(const [_0x19ab01,_0x35f402]of Object[_0x4687d8(0x1c1)](_0x50da42)){if(_0x19ab01[_0x4687d8(0x114)]()===_0x1de482[_0x4687d8(0x1b8)][_0x4687d8(0x114)]()){_0x11edcf=_0x35f402['commission']||0xa;break;}}}catch(_0x42114){console[_0x4687d8(0x12f)]('Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20'+_0x53bae8+':',_0x42114);}const _0x4fe9e0=_0x1de482['amountUSDT']*(0x1-_0x11edcf/0x64);_0x5bed97=-_0x4fe9e0,_0x4c61a5-=_0x4fe9e0,_0x3dc9bc[_0x4687d8(0x1ce)]=null,console['log'](_0x4687d8(0x171)+_0x53bae8+_0x4687d8(0x192)),console[_0x4687d8(0x1f4)]('\x20\x20\x20Full\x20amount:\x20'+_0x1de482[_0x4687d8(0x1ce)][_0x4687d8(0x1cb)](0x6)+'\x20USDT'),console['log'](_0x4687d8(0x140)+_0x1de482['gateway']+_0x4687d8(0x163)+_0x11edcf+'%'),console[_0x4687d8(0x1f4)]('\x20\x20\x20Merchant\x20loses:\x20'+_0x4fe9e0[_0x4687d8(0x1cb)](0x6)+_0x4687d8(0x223)+_0x11edcf+'%\x20commission)'),console[_0x4687d8(0x1f4)](_0x4687d8(0x19b)+_0x4fe9e0[_0x4687d8(0x1cb)](0x6)+'\x20USDT');}}}_0x3027d7===_0x4687d8(0x1f2)&&(_0x4fd5b0===_0x4687d8(0x210)&&_0x1de482['amountUSDT']&&console[_0x4687d8(0x1f4)](_0x4687d8(0x1a2)),_0x900e92&&_0x900e92>0x0&&(_0x5bed97-=_0x900e92,_0x4c61a5-=_0x900e92,console[_0x4687d8(0x1f4)]('üí∏\x20CHARGEBACK\x20penalty:\x20-'+_0x900e92[_0x4687d8(0x1cb)](0x6)+'\x20USDT\x20from\x20balance')));_0x3027d7===_0x4687d8(0x14e)&&_0x4fd5b0==='PAID'&&console[_0x4687d8(0x1f4)](_0x4687d8(0x1fb));const _0x1f34ae=await _0x432480[_0x4687d8(0x1ff)][_0x4687d8(0x1d3)]({'where':{'id':_0x53bae8},'data':_0x3dc9bc,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x5bed97!==0x0&&(await _0x432480[_0x4687d8(0x16e)][_0x4687d8(0x1d3)]({'where':{'id':_0x1de482['shopId']},'data':{'balance':_0x4c61a5}}),console['log'](_0x4687d8(0x227)+_0x1de482[_0x4687d8(0x17a)]+'\x20balance\x20updated:\x20'+_0x1de482[_0x4687d8(0x16e)]['balance'][_0x4687d8(0x1cb)](0x6)+_0x4687d8(0x138)+_0x4c61a5[_0x4687d8(0x1cb)](0x6)+_0x4687d8(0x19c)+(_0x5bed97>0x0?'+':'')+_0x5bed97[_0x4687d8(0x1cb)](0x6)+')')),_0x1f34ae;});return{'id':_0x17e7b0['id'],'shopId':_0x17e7b0['shopId'],'gateway':_0x17e7b0[_0x535a64(0x1b8)],'amount':_0x17e7b0[_0x535a64(0x1e8)],'currency':_0x17e7b0[_0x535a64(0x1e3)],'status':_0x17e7b0[_0x535a64(0x1c7)],'orderId':_0x17e7b0[_0x535a64(0x137)],'gatewayOrderId':_0x17e7b0[_0x535a64(0x1a7)],'customerEmail':_0x17e7b0[_0x535a64(0x1fd)],'customerName':_0x17e7b0[_0x535a64(0x104)],'customerCountry':_0x17e7b0[_0x535a64(0x20c)],'customerIp':_0x17e7b0[_0x535a64(0x176)],'customerUa':_0x17e7b0[_0x535a64(0x218)],'failureMessage':_0x17e7b0[_0x535a64(0x146)],'adminNotes':_0x17e7b0[_0x535a64(0x168)],'chargebackAmount':_0x17e7b0[_0x535a64(0x16c)],'statusChangedBy':_0x17e7b0[_0x535a64(0x180)],'statusChangedAt':_0x17e7b0[_0x535a64(0x135)],'createdAt':_0x17e7b0[_0x535a64(0x182)],'updatedAt':_0x17e7b0['updatedAt'],'shop':_0x17e7b0[_0x535a64(0x16e)]};}async[a35_0x59b166(0x21d)](_0x77ad3e,_0x168c05){const _0x5dd5a5=a35_0x59b166,_0x299ff3=Math['random']()['toString'](0x24)['substr'](0x2,0x9);console['log'](_0x5dd5a5(0x1e9)+_0x299ff3+_0x5dd5a5(0x198)+_0x77ad3e);const _0x1885ed={..._0x168c05};_0x168c05[_0x5dd5a5(0x1bc)]&&_0x168c05['password'][_0x5dd5a5(0x1a3)]()!==''?(console[_0x5dd5a5(0x1f4)](_0x5dd5a5(0x1b7)+_0x299ff3+_0x5dd5a5(0x159)+_0x77ad3e),_0x1885ed['password']=await bcryptjs_1[_0x5dd5a5(0x119)]['hash'](_0x168c05[_0x5dd5a5(0x1bc)],0xc)):(console[_0x5dd5a5(0x1f4)](_0x5dd5a5(0x1b7)+_0x299ff3+_0x5dd5a5(0x164)),delete _0x1885ed[_0x5dd5a5(0x1bc)]);_0x168c05[_0x5dd5a5(0x22c)]&&(_0x1885ed['name']=_0x168c05['fullName'],delete _0x1885ed['fullName']);_0x168c05[_0x5dd5a5(0x1f0)]&&(_0x1885ed[_0x5dd5a5(0x1bd)]=_0x168c05[_0x5dd5a5(0x1f0)],delete _0x1885ed[_0x5dd5a5(0x1f0)]);_0x168c05[_0x5dd5a5(0x220)]&&(_0x1885ed[_0x5dd5a5(0x224)]=_0x168c05[_0x5dd5a5(0x220)],delete _0x1885ed[_0x5dd5a5(0x220)]);if(_0x168c05['gateways']){const _0x17f4e7=_0x168c05['gateways'][_0x5dd5a5(0x20d)](_0x48cf61=>this[_0x5dd5a5(0x132)](_0x48cf61));console[_0x5dd5a5(0x1f4)]('üîÑ\x20Gateway\x20mapping:',_0x168c05[_0x5dd5a5(0x1a4)],'->',_0x17f4e7),_0x1885ed[_0x5dd5a5(0x1b4)]=JSON[_0x5dd5a5(0x1be)](_0x17f4e7),delete _0x1885ed['gateways'];}_0x168c05[_0x5dd5a5(0x18a)]&&(console[_0x5dd5a5(0x1f4)](_0x5dd5a5(0x10a)+_0x299ff3+']\x20Gateway\x20settings\x20before\x20saving:',_0x168c05[_0x5dd5a5(0x18a)]),_0x1885ed['gatewaySettings']=JSON[_0x5dd5a5(0x1be)](_0x168c05[_0x5dd5a5(0x18a)]),console[_0x5dd5a5(0x1f4)](_0x5dd5a5(0x10a)+_0x299ff3+_0x5dd5a5(0x22d),_0x1885ed[_0x5dd5a5(0x18a)]));_0x168c05['wallets']&&(_0x168c05[_0x5dd5a5(0x185)][_0x5dd5a5(0x1a0)]!==undefined&&(_0x1885ed[_0x5dd5a5(0x1a0)]=_0x168c05[_0x5dd5a5(0x185)][_0x5dd5a5(0x1a0)]||null),_0x168c05[_0x5dd5a5(0x185)][_0x5dd5a5(0x193)]!==undefined&&(_0x1885ed['usdtTrcWallet']=_0x168c05[_0x5dd5a5(0x185)][_0x5dd5a5(0x193)]||null),_0x168c05[_0x5dd5a5(0x185)][_0x5dd5a5(0x16d)]!==undefined&&(_0x1885ed[_0x5dd5a5(0x16d)]=_0x168c05['wallets'][_0x5dd5a5(0x16d)]||null),_0x168c05[_0x5dd5a5(0x185)][_0x5dd5a5(0x1d6)]!==undefined&&(_0x1885ed[_0x5dd5a5(0x1d6)]=_0x168c05['wallets'][_0x5dd5a5(0x1d6)]||null),delete _0x1885ed['wallets']);const _0xbc76f4=await database_1[_0x5dd5a5(0x119)][_0x5dd5a5(0x16e)][_0x5dd5a5(0x1d3)]({'where':{'id':_0x77ad3e},'data':_0x1885ed,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0x5dd5a5(0x1f4)](_0x5dd5a5(0x10f)+_0x299ff3+_0x5dd5a5(0x11a),_0xbc76f4['gatewaySettings']),{'id':_0xbc76f4['id'],'fullName':_0xbc76f4[_0x5dd5a5(0x133)],'username':_0xbc76f4[_0x5dd5a5(0x1d9)],'telegramId':_0xbc76f4['telegram'],'merchantUrl':_0xbc76f4[_0x5dd5a5(0x224)],'gateways':_0xbc76f4[_0x5dd5a5(0x1b4)]?JSON['parse'](_0xbc76f4['paymentGateways']):null,'gatewaySettings':_0xbc76f4[_0x5dd5a5(0x18a)]?JSON[_0x5dd5a5(0x229)](_0xbc76f4[_0x5dd5a5(0x18a)]):null,'publicKey':_0xbc76f4[_0x5dd5a5(0x14f)],'wallets':{'usdtPolygonWallet':_0xbc76f4[_0x5dd5a5(0x1a0)],'usdtTrcWallet':_0xbc76f4[_0x5dd5a5(0x193)],'usdtErcWallet':_0xbc76f4[_0x5dd5a5(0x16d)],'usdcPolygonWallet':_0xbc76f4[_0x5dd5a5(0x1d6)]},'status':_0xbc76f4[_0x5dd5a5(0x1c7)],'createdAt':_0xbc76f4[_0x5dd5a5(0x182)]};}async[a35_0x59b166(0x12d)](_0x421768){const _0x5085f0=a35_0x59b166,_0x4279a1=await database_1[_0x5085f0(0x119)]['shop'][_0x5085f0(0x1d3)]({'where':{'id':_0x421768},'data':{'status':_0x5085f0(0x12b)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4279a1['id'],'fullName':_0x4279a1['name'],'username':_0x4279a1['username'],'telegramId':_0x4279a1[_0x5085f0(0x1bd)],'merchantUrl':_0x4279a1['shopUrl'],'gateways':_0x4279a1[_0x5085f0(0x1b4)]?JSON[_0x5085f0(0x229)](_0x4279a1[_0x5085f0(0x1b4)]):null,'gatewaySettings':_0x4279a1['gatewaySettings']?JSON[_0x5085f0(0x229)](_0x4279a1['gatewaySettings']):null,'publicKey':_0x4279a1[_0x5085f0(0x14f)],'wallets':{'usdtPolygonWallet':_0x4279a1[_0x5085f0(0x1a0)],'usdtTrcWallet':_0x4279a1[_0x5085f0(0x193)],'usdtErcWallet':_0x4279a1['usdtErcWallet'],'usdcPolygonWallet':_0x4279a1[_0x5085f0(0x1d6)]},'status':_0x4279a1['status'],'createdAt':_0x4279a1[_0x5085f0(0x182)]};}async[a35_0x59b166(0x153)](_0x47035e){const _0x5cb0d3=a35_0x59b166,_0x28150b=await database_1['default'][_0x5cb0d3(0x16e)][_0x5cb0d3(0x1d3)]({'where':{'id':_0x47035e},'data':{'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x28150b['id'],'fullName':_0x28150b[_0x5cb0d3(0x133)],'username':_0x28150b['username'],'telegramId':_0x28150b[_0x5cb0d3(0x1bd)],'merchantUrl':_0x28150b[_0x5cb0d3(0x224)],'gateways':_0x28150b[_0x5cb0d3(0x1b4)]?JSON[_0x5cb0d3(0x229)](_0x28150b[_0x5cb0d3(0x1b4)]):null,'gatewaySettings':_0x28150b[_0x5cb0d3(0x18a)]?JSON[_0x5cb0d3(0x229)](_0x28150b[_0x5cb0d3(0x18a)]):null,'publicKey':_0x28150b[_0x5cb0d3(0x14f)],'wallets':{'usdtPolygonWallet':_0x28150b['usdtPolygonWallet'],'usdtTrcWallet':_0x28150b[_0x5cb0d3(0x193)],'usdtErcWallet':_0x28150b['usdtErcWallet'],'usdcPolygonWallet':_0x28150b[_0x5cb0d3(0x1d6)]},'status':_0x28150b[_0x5cb0d3(0x1c7)],'createdAt':_0x28150b[_0x5cb0d3(0x182)]};}async[a35_0x59b166(0x105)](_0x658103){const _0x34ff2a=a35_0x59b166,{page:_0x5991b7,limit:_0x17e8e1,status:_0x320c1b}=_0x658103,_0x1ae547=(_0x5991b7-0x1)*_0x17e8e1,_0x4d87d7={};_0x320c1b&&(_0x4d87d7[_0x34ff2a(0x1c7)]=_0x320c1b[_0x34ff2a(0x11f)]());const [_0x4fa958,_0x295215]=await Promise[_0x34ff2a(0x1a5)]([database_1['default'][_0x34ff2a(0x16e)][_0x34ff2a(0x112)]({'where':_0x4d87d7,'skip':_0x1ae547,'take':_0x17e8e1,'orderBy':{'createdAt':_0x34ff2a(0x1b1)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x34ff2a(0x119)]['shop'][_0x34ff2a(0x1a9)]({'where':_0x4d87d7})]);return{'users':_0x4fa958[_0x34ff2a(0x20d)](_0x8778bc=>{const _0x30525b=_0x34ff2a,_0x27ec18=_0x8778bc[_0x30525b(0x1b4)]?JSON['parse'](_0x8778bc['paymentGateways']):null,_0x4096f9=_0x27ec18?_0x27ec18[_0x30525b(0x20d)](_0xe561bb=>this[_0x30525b(0x200)](_0xe561bb)):null;return{'id':_0x8778bc['id'],'fullName':_0x8778bc['name'],'username':_0x8778bc[_0x30525b(0x1d9)],'telegramId':_0x8778bc[_0x30525b(0x1bd)],'merchantUrl':_0x8778bc['shopUrl'],'gateways':_0x4096f9,'gatewaySettings':_0x8778bc[_0x30525b(0x18a)]?JSON[_0x30525b(0x229)](_0x8778bc[_0x30525b(0x18a)]):null,'publicKey':_0x8778bc[_0x30525b(0x14f)],'wallets':{'usdtPolygonWallet':_0x8778bc[_0x30525b(0x1a0)],'usdtTrcWallet':_0x8778bc[_0x30525b(0x193)],'usdtErcWallet':_0x8778bc[_0x30525b(0x16d)],'usdcPolygonWallet':_0x8778bc['usdcPolygonWallet']},'status':_0x8778bc['status'],'createdAt':_0x8778bc[_0x30525b(0x182)]};}),'pagination':{'page':_0x5991b7,'limit':_0x17e8e1,'total':_0x295215,'totalPages':Math[_0x34ff2a(0x199)](_0x295215/_0x17e8e1)}};}async[a35_0x59b166(0x184)](_0x226540){const _0x3a12e4=a35_0x59b166,_0x156af7=await database_1[_0x3a12e4(0x119)]['shop'][_0x3a12e4(0x1f9)]({'where':{'id':_0x226540},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x156af7)return null;const _0x531d14=_0x156af7[_0x3a12e4(0x1b4)]?JSON[_0x3a12e4(0x229)](_0x156af7[_0x3a12e4(0x1b4)]):null,_0x468b10=_0x531d14?_0x531d14[_0x3a12e4(0x20d)](_0x5d988c=>this[_0x3a12e4(0x200)](_0x5d988c)):null;return _0x531d14&&_0x468b10&&console[_0x3a12e4(0x1f4)](_0x3a12e4(0x225),_0x531d14,'->',_0x468b10),{'id':_0x156af7['id'],'fullName':_0x156af7[_0x3a12e4(0x133)],'username':_0x156af7[_0x3a12e4(0x1d9)],'telegramId':_0x156af7['telegram'],'merchantUrl':_0x156af7[_0x3a12e4(0x224)],'gateways':_0x468b10,'gatewaySettings':_0x156af7[_0x3a12e4(0x18a)]?JSON[_0x3a12e4(0x229)](_0x156af7[_0x3a12e4(0x18a)]):null,'publicKey':_0x156af7[_0x3a12e4(0x14f)],'wallets':{'usdtPolygonWallet':_0x156af7[_0x3a12e4(0x1a0)],'usdtTrcWallet':_0x156af7[_0x3a12e4(0x193)],'usdtErcWallet':_0x156af7['usdtErcWallet'],'usdcPolygonWallet':_0x156af7[_0x3a12e4(0x1d6)]},'status':_0x156af7[_0x3a12e4(0x1c7)],'createdAt':_0x156af7[_0x3a12e4(0x182)]};}async[a35_0x59b166(0x1b5)](_0x587497){const _0xc6ec97=a35_0x59b166,{fullName:_0x31bc31,username:_0x59fa36,password:_0x41012d,telegramId:_0x108983,merchantUrl:_0x4c1e1b,gateways:_0x932bf,gatewaySettings:_0x4e1fd3,wallets:_0x33c591}=_0x587497,_0x260b8c=await database_1[_0xc6ec97(0x119)]['shop'][_0xc6ec97(0x1f9)]({'where':{'username':_0x59fa36}});if(_0x260b8c)throw new Error(_0xc6ec97(0x203));if(_0x108983){const _0xc4efaf=await database_1[_0xc6ec97(0x119)]['shop'][_0xc6ec97(0x1f9)]({'where':{'telegram':_0x108983}});if(_0xc4efaf)throw new Error(_0xc6ec97(0x15e));}const _0x5281d2=await bcryptjs_1[_0xc6ec97(0x119)][_0xc6ec97(0x1e4)](_0x41012d,0xc),_0x35a4bb=_0xc6ec97(0x12a)+crypto_1[_0xc6ec97(0x119)]['randomBytes'](0x20)['toString'](_0xc6ec97(0x172)),_0x481893=_0xc6ec97(0x1b9)+crypto_1[_0xc6ec97(0x119)][_0xc6ec97(0x226)](0x20)['toString']('hex'),_0x444c04=_0x932bf?_0x932bf[_0xc6ec97(0x20d)](_0x3642d6=>this[_0xc6ec97(0x132)](_0x3642d6)):null;_0x932bf&&_0x444c04&&console['log'](_0xc6ec97(0x22e),_0x932bf,'->',_0x444c04);const _0x3abf7d=await database_1[_0xc6ec97(0x119)]['shop'][_0xc6ec97(0x15a)]({'data':{'name':_0x31bc31,'username':_0x59fa36,'password':_0x5281d2,'telegram':_0x108983,'shopUrl':_0x4c1e1b,'paymentGateways':_0x444c04?JSON[_0xc6ec97(0x1be)](_0x444c04):null,'gatewaySettings':_0x4e1fd3?JSON['stringify'](_0x4e1fd3):null,'usdtPolygonWallet':_0x33c591?.[_0xc6ec97(0x1a0)]||null,'usdtTrcWallet':_0x33c591?.['usdtTrcWallet']||null,'usdtErcWallet':_0x33c591?.['usdtErcWallet']||null,'usdcPolygonWallet':_0x33c591?.[_0xc6ec97(0x1d6)]||null,'publicKey':_0x35a4bb,'secretKey':_0x481893,'status':_0xc6ec97(0x139)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x3abf7d['id'],'fullName':_0x3abf7d[_0xc6ec97(0x133)],'username':_0x3abf7d[_0xc6ec97(0x1d9)],'telegramId':_0x3abf7d[_0xc6ec97(0x1bd)],'merchantUrl':_0x3abf7d[_0xc6ec97(0x224)],'gateways':_0x3abf7d[_0xc6ec97(0x1b4)]?JSON['parse'](_0x3abf7d[_0xc6ec97(0x1b4)]):null,'gatewaySettings':_0x3abf7d['gatewaySettings']?JSON['parse'](_0x3abf7d[_0xc6ec97(0x18a)]):null,'publicKey':_0x3abf7d[_0xc6ec97(0x14f)],'wallets':{'usdtPolygonWallet':_0x3abf7d['usdtPolygonWallet'],'usdtTrcWallet':_0x3abf7d[_0xc6ec97(0x193)],'usdtErcWallet':_0x3abf7d[_0xc6ec97(0x16d)],'usdcPolygonWallet':_0x3abf7d[_0xc6ec97(0x1d6)]},'status':_0x3abf7d[_0xc6ec97(0x1c7)],'createdAt':_0x3abf7d['createdAt']};}async[a35_0x59b166(0x234)](_0x15ccb8){const _0xfd047d=a35_0x59b166;await database_1[_0xfd047d(0x119)]['shop'][_0xfd047d(0x13c)]({'where':{'id':_0x15ccb8}});}[a35_0x59b166(0x16a)](_0x1cfef6,_0x531d39,_0x2e9286){const _0x510b0e=a35_0x59b166,_0x15235d=new Map(),_0x28c231=new Date(_0x531d39);while(_0x28c231<=_0x2e9286){const _0x454504=_0x28c231[_0x510b0e(0x17e)]()[_0x510b0e(0x1f1)]('T')[0x0];_0x15235d[_0x510b0e(0x13e)](_0x454504,{'revenue':0x0,'count':0x0}),_0x28c231[_0x510b0e(0x1ac)](_0x28c231[_0x510b0e(0x1c2)]()+0x1);}for(const _0x2a7a58 of _0x1cfef6){const _0x10a3b9=_0x2a7a58[_0x510b0e(0x182)][_0x510b0e(0x17e)]()[_0x510b0e(0x1f1)]('T')[0x0],_0x2d5f31=_0x15235d[_0x510b0e(0x1d8)](_0x10a3b9);_0x2d5f31&&(_0x2d5f31[_0x510b0e(0x1a9)]+=0x1,_0x2a7a58['status']==='PAID'&&(_0x2a7a58[_0x510b0e(0x1ce)]?_0x2d5f31[_0x510b0e(0x154)]+=_0x2a7a58[_0x510b0e(0x1ce)]:console[_0x510b0e(0x1f4)]('‚ö†Ô∏è\x20Payment\x20'+_0x2a7a58['id']+'\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion')));}const _0x1aff94=[],_0x3657c0=[];for(const [_0x218087,_0x5df163]of _0x15235d){_0x1aff94[_0x510b0e(0x122)]({'date':_0x218087,'amount':Math['round'](_0x5df163[_0x510b0e(0x154)]*0x64)/0x64}),_0x3657c0[_0x510b0e(0x122)]({'date':_0x218087,'count':_0x5df163[_0x510b0e(0x1a9)]});}return{'dailyRevenue':_0x1aff94,'dailyPayments':_0x3657c0};}}exports[a35_0x59b166(0x1cc)]=AdminService;