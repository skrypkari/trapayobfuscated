'use strict';const a35_0x1b51c9=a35_0x3685;(function(_0x334f9e,_0x5b18e0){const _0x132fa3=a35_0x3685,_0x27e420=_0x334f9e();while(!![]){try{const _0x18a27d=parseInt(_0x132fa3(0x1ab))/0x1+-parseInt(_0x132fa3(0x17a))/0x2*(parseInt(_0x132fa3(0x1fc))/0x3)+-parseInt(_0x132fa3(0x235))/0x4*(-parseInt(_0x132fa3(0x179))/0x5)+-parseInt(_0x132fa3(0x185))/0x6+-parseInt(_0x132fa3(0x168))/0x7+-parseInt(_0x132fa3(0x275))/0x8+parseInt(_0x132fa3(0x17f))/0x9*(parseInt(_0x132fa3(0x21e))/0xa);if(_0x18a27d===_0x5b18e0)break;else _0x27e420['push'](_0x27e420['shift']());}catch(_0x5a3ff7){_0x27e420['push'](_0x27e420['shift']());}}}(a35_0x49e8,0x9e7b8));var __importDefault=this&&this[a35_0x1b51c9(0x1d0)]||function(_0x545bc8){const _0x5ff15d=a35_0x1b51c9;return _0x545bc8&&_0x545bc8[_0x5ff15d(0x1ec)]?_0x545bc8:{'default':_0x545bc8};};Object['defineProperty'](exports,a35_0x1b51c9(0x1ec),{'value':!![]}),exports['AdminService']=void 0x0;function a35_0x3685(_0x40bd55,_0x5825b9){const _0x49e838=a35_0x49e8();return a35_0x3685=function(_0x3685a7,_0x4e120d){_0x3685a7=_0x3685a7-0x15d;let _0x589765=_0x49e838[_0x3685a7];return _0x589765;},a35_0x3685(_0x40bd55,_0x5825b9);}const database_1=__importDefault(require(a35_0x1b51c9(0x164))),bcryptjs_1=__importDefault(require(a35_0x1b51c9(0x199))),crypto_1=__importDefault(require(a35_0x1b51c9(0x219))),currencyService_1=require(a35_0x1b51c9(0x18f));class AdminService{async[a35_0x1b51c9(0x280)](){const _0x435ceb=a35_0x1b51c9;console[_0x435ceb(0x21d)](_0x435ceb(0x1f6));const _0x1399c5=await database_1[_0x435ceb(0x1a5)][_0x435ceb(0x1eb)][_0x435ceb(0x1a3)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x435ceb(0x233)}}),_0x4950ab=new Date(),_0x134300=new Date(_0x4950ab['getFullYear'](),_0x4950ab['getMonth'](),0x1),_0x5ea7b4=new Date(_0x4950ab[_0x435ceb(0x1aa)](),_0x4950ab[_0x435ceb(0x16b)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x3fa356=await database_1[_0x435ceb(0x1a5)]['payout'][_0x435ceb(0x1a3)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x134300,'lte':_0x5ea7b4},'status':_0x435ceb(0x224)}}),_0x14291c=_0x1399c5['_sum'][_0x435ceb(0x251)]||0x0,_0x377a3f=_0x1399c5['_sum'][_0x435ceb(0x20d)]||0x0,_0x49ec18=_0x3fa356[_0x435ceb(0x1a2)][_0x435ceb(0x1ac)]||0x0,_0x22d151={'totalPayout':Math[_0x435ceb(0x16d)](_0x14291c*0x64)/0x64,'awaitingPayout':Math[_0x435ceb(0x16d)](_0x377a3f*0x64)/0x64,'thisMonth':Math[_0x435ceb(0x16d)](_0x49ec18*0x64)/0x64,'availableBalance':Math[_0x435ceb(0x16d)](_0x377a3f*0x64)/0x64};return console[_0x435ceb(0x21d)]('📊\x20Payout\x20statistics\x20calculated:'),console[_0x435ceb(0x21d)](_0x435ceb(0x184)+_0x22d151[_0x435ceb(0x17b)]+_0x435ceb(0x212)),console[_0x435ceb(0x21d)](_0x435ceb(0x256)+_0x22d151['awaitingPayout']+_0x435ceb(0x15d)),console[_0x435ceb(0x21d)](_0x435ceb(0x1f9)+_0x22d151[_0x435ceb(0x262)]+_0x435ceb(0x19a)),console[_0x435ceb(0x21d)](_0x435ceb(0x15f)+_0x22d151[_0x435ceb(0x19b)]+_0x435ceb(0x20f)),_0x22d151;}async[a35_0x1b51c9(0x27f)](_0x26bc22,_0x8edb12){const _0x341085=a35_0x1b51c9;console[_0x341085(0x21d)]('🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20'+_0x26bc22+':',_0x8edb12);const _0x56eb43=await database_1[_0x341085(0x1a5)][_0x341085(0x1f1)][_0x341085(0x18d)]({'where':{'id':_0x26bc22},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x56eb43)throw new Error(_0x341085(0x279));const _0x4765fa={};_0x8edb12[_0x341085(0x245)]!==undefined&&(_0x4765fa[_0x341085(0x245)]=_0x8edb12[_0x341085(0x245)]||null);_0x8edb12[_0x341085(0x250)]!==undefined&&(_0x4765fa[_0x341085(0x250)]=_0x8edb12['customerIp']||null);_0x8edb12[_0x341085(0x196)]!==undefined&&(_0x4765fa[_0x341085(0x196)]=_0x8edb12['customerUa']||null);const _0x6d8a50=await database_1[_0x341085(0x1a5)][_0x341085(0x1f1)]['update']({'where':{'id':_0x26bc22},'data':{..._0x4765fa,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x341085(0x21d)](_0x341085(0x1be)+_0x26bc22),console[_0x341085(0x21d)](_0x341085(0x193)+_0x56eb43['customerCountry']+'\x20->\x20'+_0x6d8a50['customerCountry']),console[_0x341085(0x21d)](_0x341085(0x252)+_0x56eb43[_0x341085(0x250)]+'\x20->\x20'+_0x6d8a50[_0x341085(0x250)]),console['log'](_0x341085(0x1b7)+(_0x56eb43['customerUa']?_0x341085(0x204):_0x341085(0x241))+'\x20->\x20'+(_0x6d8a50['customerUa']?'set':_0x341085(0x241))),_0x6d8a50;}async[a35_0x1b51c9(0x22b)](_0x4c7b0a){const _0x3e6ee4=a35_0x1b51c9,_0x306d31=new Date();let _0x7706c7;switch(_0x4c7b0a){case'7d':_0x7706c7=new Date(_0x306d31[_0x3e6ee4(0x1ea)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x3e6ee4(0x25d):_0x7706c7=new Date(_0x306d31['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x3e6ee4(0x1e9):_0x7706c7=new Date(_0x306d31[_0x3e6ee4(0x1ea)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x3e6ee4(0x1c7):case _0x3e6ee4(0x211):case _0x3e6ee4(0x1e7):const _0x3e2a32=await database_1[_0x3e6ee4(0x1a5)][_0x3e6ee4(0x1f1)][_0x3e6ee4(0x1d2)]({'where':{'gateway':{'not':_0x3e6ee4(0x249)}},'orderBy':{'createdAt':_0x3e6ee4(0x24f)},'select':{'createdAt':!![]}});_0x7706c7=_0x3e2a32?_0x3e2a32[_0x3e6ee4(0x1ff)]:new Date(0x0),console[_0x3e6ee4(0x21d)](_0x3e6ee4(0x281)+_0x7706c7[_0x3e6ee4(0x226)]());break;default:_0x7706c7=new Date(_0x306d31[_0x3e6ee4(0x1ea)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x4135da,_0x42b9de,_0x38c781,_0x351564,_0x4a6286,_0x3eddc3,_0x3dac8c]=await Promise[_0x3e6ee4(0x1c7)]([database_1[_0x3e6ee4(0x1a5)][_0x3e6ee4(0x1eb)][_0x3e6ee4(0x1b1)](),database_1[_0x3e6ee4(0x1a5)][_0x3e6ee4(0x1eb)][_0x3e6ee4(0x1b1)]({'where':{'status':_0x3e6ee4(0x233)}}),database_1[_0x3e6ee4(0x1a5)][_0x3e6ee4(0x1f1)][_0x3e6ee4(0x1b1)]({'where':{'createdAt':{'gte':_0x7706c7},'gateway':{'not':_0x3e6ee4(0x249)}}}),database_1['default']['payment'][_0x3e6ee4(0x1b1)]({'where':{'status':'PAID','createdAt':{'gte':_0x7706c7},'gateway':{'not':_0x3e6ee4(0x249)}}}),database_1[_0x3e6ee4(0x1a5)][_0x3e6ee4(0x1f1)]['findMany']({'where':{'status':'PAID','createdAt':{'gte':_0x7706c7},'gateway':{'not':_0x3e6ee4(0x249)}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x3e6ee4(0x1a5)][_0x3e6ee4(0x1f1)]['findMany']({'where':{'gateway':{'not':_0x3e6ee4(0x249)}},'take':0xa,'orderBy':{'createdAt':_0x3e6ee4(0x22f)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x3e6ee4(0x1a5)][_0x3e6ee4(0x1f1)][_0x3e6ee4(0x287)]({'where':{'createdAt':{'gte':_0x7706c7},'gateway':{'not':'test_gateway'}},'select':{'status':!![],'amountUSDT':!![],'amount':!![],'currency':!![],'createdAt':!![]},'orderBy':{'createdAt':'asc'}})]);let _0x4bd40e=0x0;for(const _0x48d2f7 of _0x4a6286){if(_0x48d2f7[_0x3e6ee4(0x278)])_0x4bd40e+=_0x48d2f7[_0x3e6ee4(0x278)];else{const _0x2007b6=await currencyService_1[_0x3e6ee4(0x263)]['convertToUSDT'](_0x48d2f7['amount'],_0x48d2f7[_0x3e6ee4(0x266)]);_0x4bd40e+=_0x2007b6;}}console['log'](_0x3e6ee4(0x1da)+_0x3dac8c[_0x3e6ee4(0x1dd)]+_0x3e6ee4(0x178)),console['log']('📊\x20[ADMIN]\x20Period:\x20'+_0x7706c7[_0x3e6ee4(0x226)]()['split']('T')[0x0]+_0x3e6ee4(0x1a0)+_0x306d31[_0x3e6ee4(0x226)]()[_0x3e6ee4(0x187)]('T')[0x0]);const _0x2f9f87=_0x3dac8c['reduce']((_0x8aa194,_0x916c4c)=>{const _0x49bffc=_0x3e6ee4;return _0x8aa194[_0x916c4c[_0x49bffc(0x23f)]]=(_0x8aa194[_0x916c4c[_0x49bffc(0x23f)]]||0x0)+0x1,_0x8aa194;},{});console[_0x3e6ee4(0x21d)](_0x3e6ee4(0x205),_0x2f9f87);const _0x3a2cdd=await this['generateDailyStatistics'](_0x3dac8c,_0x7706c7,_0x306d31),_0x45e800=_0x38c781>0x0?_0x351564/_0x38c781*0x64:0x0;return{'totalShops':_0x4135da,'activeShops':_0x42b9de,'totalPayments':_0x38c781,'successfulPayments':_0x351564,'totalRevenue':Math[_0x3e6ee4(0x16d)](_0x4bd40e*0x64)/0x64,'conversionRate':Math['round'](_0x45e800*0x64)/0x64,'dailyRevenue':_0x3a2cdd['dailyRevenue'],'dailyPayments':_0x3a2cdd[_0x3e6ee4(0x283)],'recentPayments':_0x3eddc3[_0x3e6ee4(0x236)](_0x4bd0bb=>({'id':_0x4bd0bb['id'],'amount':_0x4bd0bb['amount'],'currency':_0x4bd0bb[_0x3e6ee4(0x266)],'status':_0x4bd0bb[_0x3e6ee4(0x23f)],'gateway':_0x4bd0bb[_0x3e6ee4(0x1f0)],'shop':_0x4bd0bb[_0x3e6ee4(0x1eb)],'createdAt':_0x4bd0bb[_0x3e6ee4(0x1ff)]}))};}async[a35_0x1b51c9(0x258)](_0x494bf1,_0x27918c,_0x2951d1){const _0x4758a6=a35_0x1b51c9,_0x279ad1=new Map(),_0x11449b=new Date(_0x27918c);while(_0x11449b<=_0x2951d1){const _0xb4cb72=_0x11449b['toISOString']()[_0x4758a6(0x187)]('T')[0x0];_0x279ad1[_0x4758a6(0x204)](_0xb4cb72,{'revenue':0x0,'count':0x0}),_0x11449b['setDate'](_0x11449b[_0x4758a6(0x202)]()+0x1);}let _0x149637=0x0,_0x119239=0x0;for(const _0x455afb of _0x494bf1){const _0x45821e=_0x455afb['createdAt'][_0x4758a6(0x226)]()[_0x4758a6(0x187)]('T')[0x0],_0x573bb3=_0x279ad1['get'](_0x45821e);if(_0x573bb3){_0x573bb3[_0x4758a6(0x1b1)]+=0x1;if(_0x455afb[_0x4758a6(0x23f)]===_0x4758a6(0x22d)){_0x149637++;if(_0x455afb[_0x4758a6(0x278)])_0x573bb3[_0x4758a6(0x1df)]+=_0x455afb[_0x4758a6(0x278)],_0x119239+=_0x455afb[_0x4758a6(0x278)],console[_0x4758a6(0x21d)](_0x4758a6(0x1a6)+_0x455afb[_0x4758a6(0x278)]+_0x4758a6(0x1b5)+_0x45821e+_0x4758a6(0x1c4));else try{const _0x3fd82b=await currencyService_1['currencyService'][_0x4758a6(0x1ef)](_0x455afb[_0x4758a6(0x1ac)],_0x455afb[_0x4758a6(0x266)]);_0x573bb3[_0x4758a6(0x1df)]+=_0x3fd82b,_0x119239+=_0x3fd82b,console[_0x4758a6(0x21d)]('💱\x20[DAILY]\x20Converted\x20'+_0x455afb[_0x4758a6(0x1ac)]+'\x20'+_0x455afb[_0x4758a6(0x266)]+_0x4758a6(0x1a0)+_0x3fd82b+_0x4758a6(0x1a8)+_0x45821e);}catch(_0x294640){console['warn']('⚠️\x20[DAILY]\x20Failed\x20to\x20convert\x20'+_0x455afb[_0x4758a6(0x1ac)]+'\x20'+_0x455afb[_0x4758a6(0x266)]+'\x20for\x20payment\x20on\x20'+_0x45821e+':',_0x294640);}}}}console['log'](_0x4758a6(0x207)+_0x149637+_0x4758a6(0x238)+_0x494bf1[_0x4758a6(0x1dd)]+_0x4758a6(0x274)),console[_0x4758a6(0x21d)](_0x4758a6(0x23b)+_0x119239+_0x4758a6(0x20f));const _0x30b709=[],_0xb44fb2=[];for(const [_0x2b6685,_0x5226b5]of _0x279ad1){_0x30b709[_0x4758a6(0x1f8)]({'date':_0x2b6685,'amount':Math[_0x4758a6(0x16d)](_0x5226b5[_0x4758a6(0x1df)]*0x64)/0x64}),_0xb44fb2[_0x4758a6(0x1f8)]({'date':_0x2b6685,'count':_0x5226b5['count']});}return{'dailyRevenue':_0x30b709,'dailyPayments':_0xb44fb2};}async[a35_0x1b51c9(0x1d6)](_0x5960e3){const _0x763f01=a35_0x1b51c9;console['log'](_0x763f01(0x255),_0x5960e3);let _0x4063e2,_0x56a779=new Date();if(_0x5960e3[_0x763f01(0x1ae)]===_0x763f01(0x209)&&_0x5960e3['dateFrom']&&_0x5960e3[_0x763f01(0x1e8)])_0x4063e2=new Date(_0x5960e3['dateFrom']),_0x56a779=new Date(_0x5960e3[_0x763f01(0x1e8)]);else{const _0x291bb5=new Date();switch(_0x5960e3[_0x763f01(0x1ae)]){case _0x763f01(0x261):_0x4063e2=new Date(_0x291bb5[_0x763f01(0x1ea)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x763f01(0x19c):_0x4063e2=new Date(_0x291bb5['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x763f01(0x175):_0x4063e2=new Date(_0x291bb5[_0x763f01(0x1ea)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x763f01(0x1c7):case'alltime':case _0x763f01(0x1e7):const _0x23988c=_0x5960e3[_0x763f01(0x20b)]?{'gateway':{'not':_0x763f01(0x249)},'shopId':_0x5960e3[_0x763f01(0x20b)]}:{'gateway':{'not':_0x763f01(0x249)}},_0x15d0a2=await database_1['default'][_0x763f01(0x1f1)][_0x763f01(0x1d2)]({'where':_0x23988c,'orderBy':{'createdAt':'asc'},'select':{'createdAt':!![]}});_0x4063e2=_0x15d0a2?_0x15d0a2[_0x763f01(0x1ff)]:new Date('2020-01-01'),console[_0x763f01(0x21d)](_0x763f01(0x281)+_0x4063e2['toISOString']());break;default:const _0x993662=await database_1['default'][_0x763f01(0x1f1)][_0x763f01(0x1d2)]({'where':{'gateway':{'not':_0x763f01(0x249)}},'orderBy':{'createdAt':'asc'},'select':{'createdAt':!![]}});_0x4063e2=_0x993662?_0x993662[_0x763f01(0x1ff)]:new Date(_0x763f01(0x213));break;}}console['log'](_0x763f01(0x206)+_0x4063e2['toISOString']()+_0x763f01(0x1a0)+_0x56a779[_0x763f01(0x226)]());if(_0x5960e3[_0x763f01(0x20b)]){const _0x4d5c82=await database_1[_0x763f01(0x1a5)][_0x763f01(0x1eb)][_0x763f01(0x18d)]({'where':{'id':_0x5960e3[_0x763f01(0x20b)]},'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}});console[_0x763f01(0x21d)]('📊\x20Shop\x20info\x20for\x20'+_0x5960e3[_0x763f01(0x20b)]+':'),console[_0x763f01(0x21d)](_0x763f01(0x22a)+_0x4d5c82?.[_0x763f01(0x25c)]),console[_0x763f01(0x21d)](_0x763f01(0x195)+_0x4d5c82?.[_0x763f01(0x15e)]),console[_0x763f01(0x21d)]('\x20\x20\x20Raw\x20gatewaySettings:\x20'+(_0x4d5c82?.[_0x763f01(0x163)]||_0x763f01(0x23d)));if(_0x4d5c82?.[_0x763f01(0x163)])try{const _0x3c7486=JSON[_0x763f01(0x170)](_0x4d5c82[_0x763f01(0x163)]);console[_0x763f01(0x21d)](_0x763f01(0x17e),_0x3c7486),console[_0x763f01(0x21d)]('\x20\x20\x20Commission\x20from\x20shop\x20settings:\x20'+(_0x3c7486[_0x763f01(0x23a)]||_0x763f01(0x239)));}catch(_0x1b2156){console[_0x763f01(0x21d)](_0x763f01(0x227)+_0x1b2156);}}const _0x1b1b0f={'status':_0x763f01(0x22d),'gateway':{'not':'test_gateway'},'paidAt':{'gte':_0x4063e2,'lte':_0x56a779}};_0x5960e3[_0x763f01(0x20b)]&&(_0x1b1b0f[_0x763f01(0x20b)]=_0x5960e3[_0x763f01(0x20b)]);const _0x42ee6a=await database_1['default'][_0x763f01(0x1f1)][_0x763f01(0x287)]({'where':_0x1b1b0f,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x763f01(0x21d)](_0x763f01(0x191)+_0x42ee6a[_0x763f01(0x1dd)]+_0x763f01(0x1ca));const _0x236dd6={'gateway':{'not':'test_gateway'},'createdAt':{'gte':_0x4063e2,'lte':_0x56a779}};_0x5960e3[_0x763f01(0x20b)]&&(_0x236dd6[_0x763f01(0x20b)]=_0x5960e3['shopId']);const _0x5bb7ac=await database_1[_0x763f01(0x1a5)][_0x763f01(0x1f1)][_0x763f01(0x1b1)]({'where':_0x236dd6});console[_0x763f01(0x21d)](_0x763f01(0x1e5)+_0x5bb7ac),console[_0x763f01(0x21d)]('✅\x20Successful\x20payments:\x20'+_0x42ee6a[_0x763f01(0x1dd)]);let _0x47ceae=0x0,_0x58d2af=0x0,_0x4ffbe=0x0;const _0x17627c={},_0x1e7d7c={},_0x23be57={};for(const _0x39513e of _0x42ee6a){try{const _0x2680c6=await currencyService_1[_0x763f01(0x263)][_0x763f01(0x1ef)](_0x39513e[_0x763f01(0x1ac)],_0x39513e[_0x763f01(0x266)]);let _0x202b86={};if(_0x39513e[_0x763f01(0x1eb)][_0x763f01(0x163)])try{_0x202b86=JSON[_0x763f01(0x170)](_0x39513e[_0x763f01(0x1eb)]['gatewaySettings']);}catch(_0x2fb36b){console[_0x763f01(0x273)]('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x39513e[_0x763f01(0x20b)]+':',_0x2fb36b);}let _0x257279=0xa;const _0x23a9ef=Object[_0x763f01(0x25b)](_0x202b86)['find'](_0xbea804=>_0xbea804['toLowerCase']()===_0x39513e['gateway'][_0x763f01(0x26a)]());_0x23a9ef&&_0x202b86[_0x23a9ef]&&_0x202b86[_0x23a9ef][_0x763f01(0x23a)]&&(_0x257279=_0x202b86[_0x23a9ef]['commission']);console[_0x763f01(0x21d)](_0x763f01(0x171)+_0x39513e['id']+_0x763f01(0x162)),console[_0x763f01(0x21d)]('\x20\x20\x20Shop:\x20'+_0x39513e[_0x763f01(0x1eb)][_0x763f01(0x25c)]+'\x20('+_0x39513e['shopId']+')'),console[_0x763f01(0x21d)]('\x20\x20\x20Gateway:\x20'+_0x39513e[_0x763f01(0x1f0)]),console['log'](_0x763f01(0x21a)+(_0x39513e[_0x763f01(0x1eb)][_0x763f01(0x163)]||_0x763f01(0x23d))),console[_0x763f01(0x21d)]('\x20\x20\x20Parsed\x20gatewaySettings:',_0x202b86),console[_0x763f01(0x21d)](_0x763f01(0x1ce)+(_0x23a9ef||'not\x20found')),console['log'](_0x763f01(0x1e4)+(_0x23a9ef&&_0x202b86[_0x23a9ef]?_0x202b86[_0x23a9ef][_0x763f01(0x23a)]:'not\x20found')),console[_0x763f01(0x21d)](_0x763f01(0x1e6)+_0x257279+'%');const _0x9e999a=_0x2680c6*(_0x257279/0x64),_0x1e3bb3=_0x2680c6-_0x9e999a;_0x47ceae+=_0x2680c6,_0x58d2af+=_0x1e3bb3,_0x4ffbe+=_0x9e999a;!_0x17627c[_0x39513e[_0x763f01(0x1f0)]]&&(_0x17627c[_0x39513e[_0x763f01(0x1f0)]]={'gateway':_0x39513e[_0x763f01(0x1f0)],'gatewayDisplayName':this[_0x763f01(0x197)](_0x39513e[_0x763f01(0x1f0)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x17627c[_0x39513e[_0x763f01(0x1f0)]][_0x763f01(0x18c)]++,_0x17627c[_0x39513e[_0x763f01(0x1f0)]][_0x763f01(0x288)]+=_0x2680c6,_0x17627c[_0x39513e[_0x763f01(0x1f0)]][_0x763f01(0x18e)]+=_0x9e999a,_0x17627c[_0x39513e[_0x763f01(0x1f0)]][_0x763f01(0x1af)]+=_0x1e3bb3,_0x17627c[_0x39513e[_0x763f01(0x1f0)]][_0x763f01(0x246)]+=_0x257279;!_0x5960e3[_0x763f01(0x20b)]&&(!_0x1e7d7c[_0x39513e[_0x763f01(0x20b)]]&&(_0x1e7d7c[_0x39513e[_0x763f01(0x20b)]]={'shopId':_0x39513e[_0x763f01(0x20b)],'shopName':_0x39513e[_0x763f01(0x1eb)]['name'],'shopUsername':_0x39513e['shop'][_0x763f01(0x15e)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x1e7d7c[_0x39513e[_0x763f01(0x20b)]][_0x763f01(0x18c)]++,_0x1e7d7c[_0x39513e[_0x763f01(0x20b)]][_0x763f01(0x288)]+=_0x2680c6,_0x1e7d7c[_0x39513e['shopId']][_0x763f01(0x18e)]+=_0x9e999a,_0x1e7d7c[_0x39513e[_0x763f01(0x20b)]][_0x763f01(0x1af)]+=_0x1e3bb3);const _0x17711f=_0x39513e[_0x763f01(0x214)][_0x763f01(0x226)]()[_0x763f01(0x187)]('T')[0x0];!_0x23be57[_0x17711f]&&(_0x23be57[_0x17711f]={'date':_0x17711f,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x23be57[_0x17711f][_0x763f01(0x1a1)]+=_0x2680c6,_0x23be57[_0x17711f]['merchantEarnings']+=_0x1e3bb3,_0x23be57[_0x17711f][_0x763f01(0x27a)]+=_0x9e999a,_0x23be57[_0x17711f][_0x763f01(0x18c)]++;}catch(_0x1dc74f){console[_0x763f01(0x273)](_0x763f01(0x1a9)+_0x39513e['id']+':',_0x1dc74f);}}Object[_0x763f01(0x229)](_0x17627c)['forEach'](_0x3538b5=>{const _0x161eb0=_0x763f01;_0x3538b5['averageCommissionRate']=_0x3538b5[_0x161eb0(0x18c)]>0x0?_0x3538b5[_0x161eb0(0x246)]/_0x3538b5[_0x161eb0(0x18c)]:0x0,delete _0x3538b5[_0x161eb0(0x246)];}),Object[_0x763f01(0x229)](_0x1e7d7c)[_0x763f01(0x1fa)](_0x2bcc4e=>{const _0x5b5abc=_0x763f01;_0x2bcc4e[_0x5b5abc(0x267)]=_0x2bcc4e[_0x5b5abc(0x18c)]>0x0?_0x2bcc4e[_0x5b5abc(0x288)]/_0x2bcc4e['paymentsCount']:0x0;});let _0x1b54f3=0x0;if(_0x5960e3[_0x763f01(0x20b)]){const _0x70dd37=await database_1[_0x763f01(0x1a5)][_0x763f01(0x24c)][_0x763f01(0x287)]({'where':{'shopId':_0x5960e3[_0x763f01(0x20b)],'status':'COMPLETED','createdAt':{'gte':_0x4063e2,'lte':_0x56a779}},'select':{'amount':!![]}});_0x1b54f3=_0x70dd37[_0x763f01(0x18b)]((_0x4d7b3b,_0x313fad)=>_0x4d7b3b+_0x313fad['amount'],0x0);}const _0x3bce7d=_0x5bb7ac,_0x607cdf=_0x42ee6a['length'],_0x1db912=_0x607cdf>0x0?_0x47ceae/_0x607cdf:0x0,_0x2bb806=_0x3bce7d>0x0?_0x607cdf/_0x3bce7d*0x64:0x0;console[_0x763f01(0x21d)](_0x763f01(0x194)),console['log'](_0x763f01(0x1ee)+_0x3bce7d),console[_0x763f01(0x21d)](_0x763f01(0x201)+_0x607cdf),console['log'](_0x763f01(0x23e)+_0x2bb806[_0x763f01(0x1c5)](0x2)+'%');const _0x43392c=Math[_0x763f01(0x208)]((_0x56a779['getTime']()-_0x4063e2[_0x763f01(0x1ea)]())/(0x3e8*0x3c*0x3c*0x18)),_0x44bb29={'totalTurnover':Math[_0x763f01(0x16d)](_0x47ceae*0x64)/0x64,'merchantEarnings':Math[_0x763f01(0x16d)](_0x58d2af*0x64)/0x64,'gatewayEarnings':Math[_0x763f01(0x16d)](_0x4ffbe*0x64)/0x64,'totalPaidOut':Math[_0x763f01(0x16d)](_0x1b54f3*0x64)/0x64,'averageCheck':Math[_0x763f01(0x16d)](_0x1db912*0x64)/0x64,'totalPayments':_0x3bce7d,'successfulPayments':_0x607cdf,'conversionRate':Math[_0x763f01(0x16d)](_0x2bb806*0x64)/0x64,'gatewayBreakdown':Object[_0x763f01(0x229)](_0x17627c)[_0x763f01(0x236)](_0x113b87=>({..._0x113b87,'turnoverUSDT':Math[_0x763f01(0x16d)](_0x113b87[_0x763f01(0x288)]*0x64)/0x64,'commissionUSDT':Math[_0x763f01(0x16d)](_0x113b87['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x763f01(0x16d)](_0x113b87[_0x763f01(0x1af)]*0x64)/0x64,'averageCommissionRate':Math['round'](_0x113b87[_0x763f01(0x177)]*0x64)/0x64})),'merchantBreakdown':_0x5960e3[_0x763f01(0x20b)]?undefined:Object[_0x763f01(0x229)](_0x1e7d7c)[_0x763f01(0x236)](_0x1ca5e1=>({..._0x1ca5e1,'turnoverUSDT':Math[_0x763f01(0x16d)](_0x1ca5e1['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math['round'](_0x1ca5e1[_0x763f01(0x18e)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x763f01(0x16d)](_0x1ca5e1[_0x763f01(0x1af)]*0x64)/0x64,'paidOutUSDT':Math[_0x763f01(0x16d)](_0x1ca5e1[_0x763f01(0x190)]*0x64)/0x64,'averageCheckUSDT':Math[_0x763f01(0x16d)](_0x1ca5e1[_0x763f01(0x267)]*0x64)/0x64})),'dailyData':Object[_0x763f01(0x229)](_0x23be57)['map'](_0x3e40a7=>({..._0x3e40a7,'turnover':Math[_0x763f01(0x16d)](_0x3e40a7[_0x763f01(0x1a1)]*0x64)/0x64,'merchantEarnings':Math[_0x763f01(0x16d)](_0x3e40a7[_0x763f01(0x24e)]*0x64)/0x64,'gatewayEarnings':Math['round'](_0x3e40a7[_0x763f01(0x27a)]*0x64)/0x64}))[_0x763f01(0x1c3)]((_0x3db941,_0x1da0e7)=>_0x3db941[_0x763f01(0x1b8)][_0x763f01(0x1f7)](_0x1da0e7[_0x763f01(0x1b8)])),'periodInfo':{'from':_0x4063e2,'to':_0x56a779,'periodType':_0x5960e3['period']||_0x763f01(0x209),'daysCount':_0x43392c}};return console[_0x763f01(0x21d)](_0x763f01(0x165)),console[_0x763f01(0x21d)](_0x763f01(0x174)+_0x44bb29[_0x763f01(0x26c)]+_0x763f01(0x20f)),console['log'](_0x763f01(0x192)+_0x44bb29[_0x763f01(0x24e)]+_0x763f01(0x20f)),console[_0x763f01(0x21d)](_0x763f01(0x257)+_0x44bb29[_0x763f01(0x27a)]+_0x763f01(0x20f)),console[_0x763f01(0x21d)](_0x763f01(0x289)+_0x44bb29[_0x763f01(0x285)]),console[_0x763f01(0x21d)](_0x763f01(0x259)+_0x44bb29[_0x763f01(0x282)]),console['log'](_0x763f01(0x1fe)+_0x44bb29[_0x763f01(0x1b6)]+'%'),_0x44bb29;}['getGatewayDisplayName'](_0x159d14){const _0x57ec8e=a35_0x1b51c9,_0x11f71d={'test_gateway':_0x57ec8e(0x1cb),'plisio':_0x57ec8e(0x222),'rapyd':_0x57ec8e(0x182),'noda':'Noda','cointopay':_0x57ec8e(0x200),'mastercard':_0x57ec8e(0x24d),'klyme_eu':_0x57ec8e(0x1f3),'klyme_gb':_0x57ec8e(0x242),'klyme_de':_0x57ec8e(0x253)};return _0x11f71d[_0x159d14]||_0x159d14;}async[a35_0x1b51c9(0x20e)](_0x57306f){const _0x353322=a35_0x1b51c9,{page:_0x27624f,limit:_0x54163d,minAmount:_0x136858,search:_0x3690f6}=_0x57306f,_0x518702=(_0x27624f-0x1)*_0x54163d;console['log'](_0x353322(0x22e),_0x57306f);const _0x54af90={'balance':{'gt':0x0},'status':_0x353322(0x233)};_0x136858&&(_0x54af90['balance'][_0x353322(0x169)]=_0x136858);_0x3690f6&&(_0x54af90['OR']=[{'name':{'contains':_0x3690f6,'mode':_0x353322(0x189)}},{'username':{'contains':_0x3690f6,'mode':'insensitive'}}]);const [_0x5e4632,_0x207663]=await Promise[_0x353322(0x1c7)]([database_1[_0x353322(0x1a5)][_0x353322(0x1eb)][_0x353322(0x287)]({'where':_0x54af90,'skip':_0x518702,'take':_0x54163d,'orderBy':{'balance':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'createdAt':!![]}}),database_1[_0x353322(0x1a5)][_0x353322(0x1eb)][_0x353322(0x1b1)]({'where':_0x54af90})]);console[_0x353322(0x21d)](_0x353322(0x191)+_0x5e4632[_0x353322(0x1dd)]+_0x353322(0x277));const _0x72f791=await Promise[_0x353322(0x1c7)](_0x5e4632[_0x353322(0x236)](async _0x5534b8=>{const _0x12c8e1=_0x353322,[_0x1b2409,_0x5b729c,_0x1b038e]=await Promise[_0x12c8e1(0x1c7)]([database_1[_0x12c8e1(0x1a5)][_0x12c8e1(0x1f1)][_0x12c8e1(0x1b1)]({'where':{'shopId':_0x5534b8['id'],'status':_0x12c8e1(0x22d),'amountUSDT':{'not':null}}}),database_1[_0x12c8e1(0x1a5)][_0x12c8e1(0x1f1)][_0x12c8e1(0x1d2)]({'where':{'shopId':_0x5534b8['id'],'status':_0x12c8e1(0x22d),'amountUSDT':{'not':null}},'orderBy':{'paidAt':_0x12c8e1(0x24f)},'select':{'paidAt':!![]}}),database_1['default']['payment'][_0x12c8e1(0x1f4)]({'by':[_0x12c8e1(0x1f0)],'where':{'shopId':_0x5534b8['id'],'status':_0x12c8e1(0x22d),'amountUSDT':{'not':null}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x2b89ad=_0x1b038e[_0x12c8e1(0x236)](_0x41b6a8=>({'gateway':_0x41b6a8[_0x12c8e1(0x1f0)],'count':_0x41b6a8[_0x12c8e1(0x19e)]['id'],'amountUSDT':_0x41b6a8[_0x12c8e1(0x1a2)][_0x12c8e1(0x278)]||0x0,'amountAfterCommissionUSDT':_0x41b6a8[_0x12c8e1(0x1a2)][_0x12c8e1(0x278)]||0x0,'commission':0x0}));return{'id':_0x5534b8['id'],'fullName':_0x5534b8[_0x12c8e1(0x25c)],'username':_0x5534b8[_0x12c8e1(0x15e)],'telegramId':_0x5534b8[_0x12c8e1(0x1bd)],'merchantUrl':_0x5534b8[_0x12c8e1(0x1c0)],'wallets':{'usdtPolygonWallet':_0x5534b8[_0x12c8e1(0x286)],'usdtTrcWallet':_0x5534b8[_0x12c8e1(0x16a)],'usdtErcWallet':_0x5534b8[_0x12c8e1(0x1f2)],'usdcPolygonWallet':_0x5534b8['usdcPolygonWallet']},'totalAmountUSDT':_0x5534b8[_0x12c8e1(0x20d)],'totalAmountAfterCommissionUSDT':_0x5534b8['balance'],'paymentsCount':_0x1b2409,'oldestPaymentDate':_0x5b729c?.[_0x12c8e1(0x214)]||_0x5534b8[_0x12c8e1(0x1ff)],'gatewayBreakdown':_0x2b89ad};})),_0xea31ba=_0x5e4632['reduce']((_0xc54d8a,_0x41774c)=>_0xc54d8a+_0x41774c[_0x353322(0x20d)],0x0),_0x115aef=_0xea31ba;return console[_0x353322(0x21d)]('📊\x20Merchants\x20awaiting\x20payout:\x20'+_0x207663+_0x353322(0x1c2)+Math['round'](_0x115aef*0x64)/0x64+_0x353322(0x1c8)),{'merchants':_0x72f791,'pagination':{'page':_0x27624f,'limit':_0x54163d,'total':_0x207663,'totalPages':Math[_0x353322(0x208)](_0x207663/_0x54163d)},'summary':{'totalMerchants':_0x207663,'totalAmountUSDT':Math['round'](_0xea31ba*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x115aef*0x64)/0x64}};}async[a35_0x1b51c9(0x203)](_0x4f8c3a){const _0x4a7cd1=a35_0x1b51c9,{shopId:_0x268202,amount:_0x2492f7,network:_0x2ed2ea,notes:_0x1259e9,periodFrom:_0x52a213,periodTo:_0xe01a62}=_0x4f8c3a,_0x542155=await database_1[_0x4a7cd1(0x1a5)][_0x4a7cd1(0x180)](async _0x36543a=>{const _0x272be0=_0x4a7cd1,_0x4de578=await _0x36543a[_0x272be0(0x1eb)][_0x272be0(0x18d)]({'where':{'id':_0x268202},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x4de578)throw new Error('Shop\x20not\x20found');console[_0x272be0(0x21d)](_0x272be0(0x27e)+_0x4de578['username']+':'),console[_0x272be0(0x21d)](_0x272be0(0x1bf)+_0x4de578[_0x272be0(0x20d)][_0x272be0(0x1c5)](0x6)+_0x272be0(0x20f)),console['log'](_0x272be0(0x16f)+_0x2492f7[_0x272be0(0x1c5)](0x6)+'\x20USDT'),console[_0x272be0(0x21d)]('\x20\x20\x20Current\x20total\x20paid\x20out:\x20'+_0x4de578['totalPaidOut'][_0x272be0(0x1c5)](0x6)+_0x272be0(0x20f));if(_0x4de578['balance']<_0x2492f7)throw new Error('Insufficient\x20balance.\x20Available:\x20'+_0x4de578[_0x272be0(0x20d)][_0x272be0(0x1c5)](0x6)+_0x272be0(0x217)+_0x2492f7[_0x272be0(0x1c5)](0x6)+_0x272be0(0x20f));const _0x4d3071=await _0x36543a[_0x272be0(0x24c)][_0x272be0(0x20c)]({'data':{'shopId':_0x268202,'amount':_0x2492f7,'network':_0x2ed2ea,'status':_0x272be0(0x224),'notes':_0x1259e9,'periodFrom':_0x52a213?new Date(_0x52a213):null,'periodTo':_0xe01a62?new Date(_0xe01a62):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x2ba1f0=_0x4de578['balance']-_0x2492f7,_0x274637=_0x4de578[_0x272be0(0x251)]+_0x2492f7;return await _0x36543a[_0x272be0(0x1eb)][_0x272be0(0x232)]({'where':{'id':_0x268202},'data':{'balance':_0x2ba1f0,'totalPaidOut':_0x274637}}),console[_0x272be0(0x21d)]('💰\x20Shop\x20'+_0x4de578[_0x272be0(0x15e)]+_0x272be0(0x1d5)),console['log']('\x20\x20\x20Balance:\x20'+_0x4de578[_0x272be0(0x20d)][_0x272be0(0x1c5)](0x6)+_0x272be0(0x230)+_0x2ba1f0[_0x272be0(0x1c5)](0x6)+_0x272be0(0x234)+_0x2492f7['toFixed'](0x6)+')'),console['log'](_0x272be0(0x270)+_0x4de578['totalPaidOut']['toFixed'](0x6)+'\x20->\x20'+_0x274637['toFixed'](0x6)+'\x20USDT\x20(+'+_0x2492f7['toFixed'](0x6)+')'),{'payout':_0x4d3071,'shop':_0x4de578};});return console[_0x4a7cd1(0x21d)](_0x4a7cd1(0x198)+_0x542155['payout']['id']+_0x4a7cd1(0x244)+_0x542155[_0x4a7cd1(0x1eb)]['username']+'\x20('+_0x2492f7+_0x4a7cd1(0x231)),{'id':_0x542155[_0x4a7cd1(0x24c)]['id'],'shopId':_0x542155[_0x4a7cd1(0x24c)][_0x4a7cd1(0x20b)],'shopName':_0x542155[_0x4a7cd1(0x1eb)][_0x4a7cd1(0x25c)],'shopUsername':_0x542155[_0x4a7cd1(0x1eb)]['username'],'amount':_0x542155[_0x4a7cd1(0x24c)]['amount'],'network':_0x542155[_0x4a7cd1(0x24c)][_0x4a7cd1(0x215)],'status':_0x542155['payout']['status'],'txid':_0x542155[_0x4a7cd1(0x24c)]['txid'],'notes':_0x542155[_0x4a7cd1(0x24c)][_0x4a7cd1(0x1cc)],'periodFrom':_0x542155['payout'][_0x4a7cd1(0x17c)],'periodTo':_0x542155[_0x4a7cd1(0x24c)][_0x4a7cd1(0x237)],'createdAt':_0x542155[_0x4a7cd1(0x24c)][_0x4a7cd1(0x1ff)],'paidAt':_0x542155['payout']['paidAt']};}[a35_0x1b51c9(0x24a)](_0x5d7a44){const _0x868ae9=a35_0x1b51c9,_0x387bf8={'polygon':_0x868ae9(0x1b2),'trc20':_0x868ae9(0x216),'erc20':_0x868ae9(0x181),'polygon_usdc':_0x868ae9(0x271)};return _0x387bf8[_0x5d7a44]||_0x5d7a44[_0x868ae9(0x1cd)]();}[a35_0x1b51c9(0x1b4)](_0x2c67b4,_0x324fe8){const _0x3ad089=a35_0x1b51c9,_0x42683b={'polygon':_0x3ad089(0x286),'trc20':_0x3ad089(0x16a),'erc20':_0x3ad089(0x1f2),'polygon_usdc':_0x3ad089(0x1bc)},_0xdeff96=_0x42683b[_0x324fe8];return _0xdeff96?_0x2c67b4[_0xdeff96]:null;}async[a35_0x1b51c9(0x223)](_0x545825){const _0x3fab9e=a35_0x1b51c9,{page:_0x5c92b1,limit:_0x422637,shopId:_0x3ab120,network:_0x8a622a,dateFrom:_0x44085e,dateTo:_0x3698c1,search:_0x1fad22}=_0x545825,_0x2f044b=(_0x5c92b1-0x1)*_0x422637,_0x5e7e7b={};_0x3ab120&&(_0x5e7e7b[_0x3fab9e(0x20b)]=_0x3ab120);_0x8a622a&&(_0x5e7e7b[_0x3fab9e(0x215)]=_0x8a622a);(_0x44085e||_0x3698c1)&&(_0x5e7e7b[_0x3fab9e(0x1ff)]={},_0x44085e&&(_0x5e7e7b[_0x3fab9e(0x1ff)]['gte']=new Date(_0x44085e)),_0x3698c1&&(_0x5e7e7b['createdAt'][_0x3fab9e(0x248)]=new Date(_0x3698c1)));_0x1fad22&&(_0x5e7e7b['OR']=[{'shop':{'name':{'contains':_0x1fad22,'mode':_0x3fab9e(0x189)}}},{'shop':{'username':{'contains':_0x1fad22,'mode':_0x3fab9e(0x189)}}},{'notes':{'contains':_0x1fad22,'mode':'insensitive'}}]);const [_0x4128f8,_0x1b9011]=await Promise[_0x3fab9e(0x1c7)]([database_1['default'][_0x3fab9e(0x24c)][_0x3fab9e(0x287)]({'where':_0x5e7e7b,'skip':_0x2f044b,'take':_0x422637,'orderBy':{'createdAt':_0x3fab9e(0x22f)},'include':{'shop':{'select':{'name':!![],'username':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}}),database_1['default'][_0x3fab9e(0x24c)]['count']({'where':_0x5e7e7b})]);return{'payouts':_0x4128f8['map'](_0x21dc36=>({'id':_0x21dc36['id'],'shopId':_0x21dc36['shopId'],'shopName':_0x21dc36[_0x3fab9e(0x1eb)][_0x3fab9e(0x25c)],'shopUsername':_0x21dc36[_0x3fab9e(0x1eb)][_0x3fab9e(0x15e)],'amount':_0x21dc36[_0x3fab9e(0x1ac)],'network':this[_0x3fab9e(0x24a)](_0x21dc36['network']),'networkTechnical':_0x21dc36[_0x3fab9e(0x215)],'walletAddress':this[_0x3fab9e(0x1b4)](_0x21dc36[_0x3fab9e(0x1eb)],_0x21dc36[_0x3fab9e(0x215)]),'status':_0x21dc36[_0x3fab9e(0x23f)],'txid':_0x21dc36['txid'],'notes':_0x21dc36[_0x3fab9e(0x1cc)],'periodFrom':_0x21dc36[_0x3fab9e(0x17c)],'periodTo':_0x21dc36[_0x3fab9e(0x237)],'createdAt':_0x21dc36[_0x3fab9e(0x1ff)],'paidAt':_0x21dc36[_0x3fab9e(0x214)]})),'pagination':{'page':_0x5c92b1,'limit':_0x422637,'total':_0x1b9011,'totalPages':Math[_0x3fab9e(0x208)](_0x1b9011/_0x422637)}};}async[a35_0x1b51c9(0x1b3)](_0x11b19b){const _0xb2300d=a35_0x1b51c9,_0x3e1e7e=await database_1['default'][_0xb2300d(0x24c)][_0xb2300d(0x18d)]({'where':{'id':_0x11b19b},'include':{'shop':{'select':{'name':!![],'username':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}});if(!_0x3e1e7e)return null;return{'id':_0x3e1e7e['id'],'shopId':_0x3e1e7e[_0xb2300d(0x20b)],'shopName':_0x3e1e7e['shop'][_0xb2300d(0x25c)],'shopUsername':_0x3e1e7e[_0xb2300d(0x1eb)][_0xb2300d(0x15e)],'amount':_0x3e1e7e[_0xb2300d(0x1ac)],'network':this[_0xb2300d(0x24a)](_0x3e1e7e['network']),'networkTechnical':_0x3e1e7e[_0xb2300d(0x215)],'walletAddress':this[_0xb2300d(0x1b4)](_0x3e1e7e['shop'],_0x3e1e7e[_0xb2300d(0x215)]),'status':_0x3e1e7e['status'],'txid':_0x3e1e7e[_0xb2300d(0x161)],'notes':_0x3e1e7e[_0xb2300d(0x1cc)],'periodFrom':_0x3e1e7e[_0xb2300d(0x17c)],'periodTo':_0x3e1e7e['periodTo'],'createdAt':_0x3e1e7e[_0xb2300d(0x1ff)],'paidAt':_0x3e1e7e['paidAt']};}async[a35_0x1b51c9(0x260)](_0x22e5de){const _0x192d78=a35_0x1b51c9;await database_1[_0x192d78(0x1a5)]['payout'][_0x192d78(0x1c9)]({'where':{'id':_0x22e5de}});}async['getAllPayments'](_0x30c6be){const _0x328c10=a35_0x1b51c9,{page:_0x391147,limit:_0xc666b3,status:_0x22ef67,gateway:_0x728666,shopId:_0x2e412f,dateFrom:_0x3d60ab,dateTo:_0x4bcab3,search:_0x44b41b,sortBy:sortBy=_0x328c10(0x1ff),sortOrder:sortOrder='desc'}=_0x30c6be,_0x3781d5=(_0x391147-0x1)*_0xc666b3,_0x5da56c={},_0x3514ac=[_0x328c10(0x1ff),'amount',_0x328c10(0x23f),_0x328c10(0x1f0)],_0x46d08a=_0x3514ac[_0x328c10(0x240)](sortBy)?sortBy:_0x328c10(0x1ff),_0x2b073d=[_0x328c10(0x24f),_0x328c10(0x22f)]['includes'](sortOrder?.[_0x328c10(0x26a)]())?sortOrder[_0x328c10(0x26a)]():_0x328c10(0x22f);console[_0x328c10(0x21d)](_0x328c10(0x221)+_0x46d08a+'\x20'+_0x2b073d);_0x22ef67&&(_0x5da56c[_0x328c10(0x23f)]=_0x22ef67[_0x328c10(0x1cd)]());if(_0x728666){const {getGatewayNameById:_0x375f6a,isValidGatewayId:_0xeadc70}=require(_0x328c10(0x276)),_0x5d81d7=/^\d{4}$/[_0x328c10(0x1d4)](_0x728666);if(_0x5d81d7&&_0xeadc70(_0x728666)){const _0x27e90b=_0x375f6a(_0x728666);console['log'](_0x328c10(0x268)+_0x728666+_0x328c10(0x1bb)+_0x27e90b),_0x5da56c[_0x328c10(0x1f0)]=_0x27e90b;}else console[_0x328c10(0x21d)](_0x328c10(0x26f)+_0x728666+'\x20as-is'),_0x5da56c[_0x328c10(0x1f0)]=_0x728666[_0x328c10(0x26a)]();}_0x5da56c[_0x328c10(0x1f0)]=_0x5da56c['gateway']?_0x5da56c[_0x328c10(0x1f0)]:{'not':_0x328c10(0x249)};if(typeof _0x5da56c[_0x328c10(0x1f0)]===_0x328c10(0x1dc)&&_0x5da56c[_0x328c10(0x1f0)]!==_0x328c10(0x249)){}else{if(typeof _0x5da56c[_0x328c10(0x1f0)]===_0x328c10(0x1dc)&&_0x5da56c[_0x328c10(0x1f0)]==='test_gateway'){}else _0x5da56c[_0x328c10(0x1f0)]={'not':_0x328c10(0x249)};}_0x2e412f&&(_0x5da56c[_0x328c10(0x20b)]=_0x2e412f);(_0x3d60ab||_0x4bcab3)&&(_0x5da56c[_0x328c10(0x1ff)]={},_0x3d60ab&&(_0x5da56c[_0x328c10(0x1ff)][_0x328c10(0x169)]=new Date(_0x3d60ab)),_0x4bcab3&&(_0x5da56c[_0x328c10(0x1ff)][_0x328c10(0x248)]=new Date(_0x4bcab3)));_0x44b41b&&(_0x5da56c['OR']=[{'id':_0x44b41b},{'id':{'contains':_0x44b41b,'mode':'insensitive'}},{'orderId':{'contains':_0x44b41b,'mode':_0x328c10(0x189)}},{'gatewayOrderId':{'contains':_0x44b41b,'mode':'insensitive'}},{'customerEmail':{'contains':_0x44b41b,'mode':'insensitive'}},{'shop':{'name':{'contains':_0x44b41b,'mode':_0x328c10(0x189)}}},{'shop':{'username':{'contains':_0x44b41b,'mode':'insensitive'}}}],console[_0x328c10(0x21d)](_0x328c10(0x1e2)+_0x44b41b+'\x22'));console[_0x328c10(0x21d)](_0x328c10(0x27b),JSON[_0x328c10(0x28a)](_0x5da56c,null,0x2));if(_0x44b41b&&_0x44b41b[_0x328c10(0x1dd)]>0x14){const _0x4e9f96=await database_1[_0x328c10(0x1a5)][_0x328c10(0x1f1)][_0x328c10(0x18d)]({'where':{'id':_0x44b41b},'select':{'id':!![],'orderId':!![],'gatewayOrderId':!![],'gateway':!![]}});console[_0x328c10(0x21d)]('🔍\x20Direct\x20payment\x20check\x20for\x20ID\x20\x22'+_0x44b41b+'\x22:',_0x4e9f96?_0x328c10(0x20a):_0x328c10(0x225)),_0x4e9f96&&console[_0x328c10(0x21d)]('📋\x20Payment\x20details:\x20ID='+_0x4e9f96['id']+',\x20orderID='+_0x4e9f96[_0x328c10(0x26e)]+_0x328c10(0x1e0)+_0x4e9f96[_0x328c10(0x1de)]+_0x328c10(0x27c)+_0x4e9f96[_0x328c10(0x1f0)]);}const _0x3789e5={};_0x3789e5[_0x46d08a]=_0x2b073d;const [_0x337664,_0xef1f7d]=await Promise[_0x328c10(0x1c7)]([database_1[_0x328c10(0x1a5)]['payment']['findMany']({'where':_0x5da56c,'skip':_0x3781d5,'take':_0xc666b3,'orderBy':_0x3789e5,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x328c10(0x1a5)][_0x328c10(0x1f1)][_0x328c10(0x1b1)]({'where':_0x5da56c})]);return console[_0x328c10(0x21d)](_0x328c10(0x247)+_0xef1f7d+_0x328c10(0x210)+_0x337664['length']+'\x20items'),_0x44b41b&&(console[_0x328c10(0x21d)]('🔍\x20Search\x20term:\x20\x22'+_0x44b41b+'\x22'),console[_0x328c10(0x21d)](_0x328c10(0x1a7)+_0x337664[_0x328c10(0x1dd)]+'\x20payments\x20found')),_0x337664[_0x328c10(0x1dd)]>0x0&&console[_0x328c10(0x21d)]('📊\x20First\x20payment\x20gateway:\x20'+_0x337664[0x0][_0x328c10(0x1f0)]+_0x328c10(0x21b)+_0x337664[0x0]['id']),{'payments':_0x337664[_0x328c10(0x236)](_0x351e06=>({'id':_0x351e06['id'],'shopId':_0x351e06[_0x328c10(0x20b)],'gateway':this[_0x328c10(0x197)](_0x351e06['gateway']),'gatewayTechnical':_0x351e06[_0x328c10(0x1f0)],'amount':_0x351e06['amount'],'currency':_0x351e06[_0x328c10(0x266)],'status':_0x351e06[_0x328c10(0x23f)],'orderId':_0x351e06[_0x328c10(0x26e)],'gatewayOrderId':_0x351e06[_0x328c10(0x1de)],'customerEmail':_0x351e06[_0x328c10(0x1b9)],'customerName':_0x351e06[_0x328c10(0x21f)],'customerCountry':_0x351e06['customerCountry'],'customerIp':_0x351e06[_0x328c10(0x250)],'customerUa':_0x351e06['customerUa'],'failureMessage':_0x351e06[_0x328c10(0x1a4)],'cardLast4':_0x351e06['cardLast4'],'paymentMethod':_0x351e06[_0x328c10(0x21c)],'bankId':_0x351e06[_0x328c10(0x173)],'remitterIban':_0x351e06[_0x328c10(0x1e3)],'remitterName':_0x351e06[_0x328c10(0x1fb)],'txUrls':_0x351e06[_0x328c10(0x172)],'createdAt':_0x351e06['createdAt'],'updatedAt':_0x351e06['updatedAt'],'shop':_0x351e06[_0x328c10(0x1eb)]})),'pagination':{'page':_0x391147,'limit':_0xc666b3,'total':_0xef1f7d,'totalPages':Math['ceil'](_0xef1f7d/_0xc666b3)}};}async[a35_0x1b51c9(0x1cf)](_0x1a2f36){const _0x5931ce=a35_0x1b51c9,_0x324a11=await database_1[_0x5931ce(0x1a5)][_0x5931ce(0x1f1)][_0x5931ce(0x18d)]({'where':{'id':_0x1a2f36},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x324a11)return null;return{'id':_0x324a11['id'],'shopId':_0x324a11[_0x5931ce(0x20b)],'gateway':this['getGatewayDisplayName'](_0x324a11[_0x5931ce(0x1f0)]),'gatewayTechnical':_0x324a11['gateway'],'amount':_0x324a11['amount'],'currency':_0x324a11[_0x5931ce(0x266)],'status':_0x324a11[_0x5931ce(0x23f)],'orderId':_0x324a11[_0x5931ce(0x26e)],'gatewayOrderId':_0x324a11[_0x5931ce(0x1de)],'customerEmail':_0x324a11[_0x5931ce(0x1b9)],'customerName':_0x324a11['customerName'],'customerCountry':_0x324a11[_0x5931ce(0x245)],'customerIp':_0x324a11[_0x5931ce(0x250)],'customerUa':_0x324a11['customerUa'],'failureMessage':_0x324a11[_0x5931ce(0x1a4)],'externalPaymentUrl':_0x324a11[_0x5931ce(0x269)],'successUrl':_0x324a11[_0x5931ce(0x1d3)],'failUrl':_0x324a11[_0x5931ce(0x228)],'pendingUrl':_0x324a11['pendingUrl'],'whiteUrl':_0x324a11['whiteUrl'],'cardLast4':_0x324a11[_0x5931ce(0x183)],'paymentMethod':_0x324a11[_0x5931ce(0x21c)],'bankId':_0x324a11[_0x5931ce(0x173)],'remitterIban':_0x324a11[_0x5931ce(0x1e3)],'remitterName':_0x324a11['remitterName'],'txUrls':_0x324a11[_0x5931ce(0x172)],'createdAt':_0x324a11['createdAt'],'updatedAt':_0x324a11[_0x5931ce(0x18a)],'shop':_0x324a11['shop']};}async[a35_0x1b51c9(0x26d)](_0x118fe7,_0x6bc1cf,_0x5786a6,_0x14af05){const _0x579537=a35_0x1b51c9,_0x3fee93=await database_1['default'][_0x579537(0x180)](async _0x3cf44c=>{const _0x593f09=_0x579537,_0x2d70fd=await _0x3cf44c[_0x593f09(0x1f1)][_0x593f09(0x18d)]({'where':{'id':_0x118fe7},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x2d70fd)throw new Error(_0x593f09(0x279));const _0x20ea07=_0x2d70fd['status'],_0x23bfb3=_0x6bc1cf[_0x593f09(0x1cd)]();console[_0x593f09(0x21d)](_0x593f09(0x1ed)+_0x118fe7+_0x593f09(0x218)+_0x20ea07+_0x593f09(0x230)+_0x23bfb3),console[_0x593f09(0x21d)](_0x593f09(0x25e)+_0x2d70fd[_0x593f09(0x1eb)][_0x593f09(0x20d)]+_0x593f09(0x20f));const _0xb6d15b={'status':_0x23bfb3,'updatedAt':new Date(),'statusChangedBy':_0x593f09(0x243),'statusChangedAt':new Date()};_0x5786a6&&(_0xb6d15b[_0x593f09(0x1d8)]=_0x5786a6);_0x23bfb3===_0x593f09(0x1b0)&&_0x14af05&&(_0xb6d15b['chargebackAmount']=_0x14af05);let _0x331e3a=0x0,_0x21b9b4=_0x2d70fd[_0x593f09(0x1eb)][_0x593f09(0x20d)];if(_0x23bfb3===_0x593f09(0x22d)&&_0x20ea07!==_0x593f09(0x22d)){_0xb6d15b[_0x593f09(0x214)]=new Date();const _0x272821=await currencyService_1[_0x593f09(0x263)][_0x593f09(0x1ef)](_0x2d70fd[_0x593f09(0x1ac)],_0x2d70fd[_0x593f09(0x266)]);_0xb6d15b[_0x593f09(0x278)]=_0x272821,_0x331e3a=_0x272821,_0x21b9b4+=_0x272821,console[_0x593f09(0x21d)](_0x593f09(0x1ba)+_0x118fe7+'\x20became\x20PAID:\x20+'+_0x272821['toFixed'](0x6)+_0x593f09(0x1d9));}else _0x20ea07===_0x593f09(0x22d)&&_0x23bfb3!==_0x593f09(0x22d)&&(_0x2d70fd[_0x593f09(0x278)]&&(_0x331e3a=-_0x2d70fd[_0x593f09(0x278)],_0x21b9b4-=_0x2d70fd[_0x593f09(0x278)],_0xb6d15b[_0x593f09(0x278)]=null,console[_0x593f09(0x21d)](_0x593f09(0x1ba)+_0x118fe7+_0x593f09(0x176)+_0x2d70fd[_0x593f09(0x278)][_0x593f09(0x1c5)](0x6)+_0x593f09(0x264))));if(_0x23bfb3==='CHARGEBACK'){if(_0x20ea07===_0x593f09(0x22d)&&_0x2d70fd[_0x593f09(0x278)]){}_0x14af05&&_0x14af05>0x0&&(_0x331e3a-=_0x14af05,_0x21b9b4-=_0x14af05,console[_0x593f09(0x21d)](_0x593f09(0x220)+_0x14af05[_0x593f09(0x1c5)](0x6)+_0x593f09(0x264)));}_0x23bfb3==='REFUND'&&_0x20ea07===_0x593f09(0x22d)&&console[_0x593f09(0x21d)](_0x593f09(0x166));const _0x35763d=await _0x3cf44c[_0x593f09(0x1f1)][_0x593f09(0x232)]({'where':{'id':_0x118fe7},'data':_0xb6d15b,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x331e3a!==0x0&&(await _0x3cf44c['shop'][_0x593f09(0x232)]({'where':{'id':_0x2d70fd[_0x593f09(0x20b)]},'data':{'balance':_0x21b9b4}}),console[_0x593f09(0x21d)](_0x593f09(0x1d7)+_0x2d70fd[_0x593f09(0x20b)]+_0x593f09(0x26b)+_0x2d70fd[_0x593f09(0x1eb)]['balance'][_0x593f09(0x1c5)](0x6)+_0x593f09(0x230)+_0x21b9b4[_0x593f09(0x1c5)](0x6)+_0x593f09(0x160)+(_0x331e3a>0x0?'+':'')+_0x331e3a[_0x593f09(0x1c5)](0x6)+')')),_0x35763d;});return{'id':_0x3fee93['id'],'shopId':_0x3fee93[_0x579537(0x20b)],'gateway':_0x3fee93['gateway'],'amount':_0x3fee93[_0x579537(0x1ac)],'currency':_0x3fee93[_0x579537(0x266)],'status':_0x3fee93[_0x579537(0x23f)],'orderId':_0x3fee93[_0x579537(0x26e)],'gatewayOrderId':_0x3fee93[_0x579537(0x1de)],'customerEmail':_0x3fee93[_0x579537(0x1b9)],'customerName':_0x3fee93[_0x579537(0x21f)],'customerCountry':_0x3fee93['customerCountry'],'customerIp':_0x3fee93['customerIp'],'customerUa':_0x3fee93[_0x579537(0x196)],'failureMessage':_0x3fee93[_0x579537(0x1a4)],'adminNotes':_0x3fee93['adminNotes'],'chargebackAmount':_0x3fee93[_0x579537(0x24b)],'statusChangedBy':_0x3fee93['statusChangedBy'],'statusChangedAt':_0x3fee93[_0x579537(0x25a)],'createdAt':_0x3fee93[_0x579537(0x1ff)],'updatedAt':_0x3fee93[_0x579537(0x18a)],'shop':_0x3fee93[_0x579537(0x1eb)]};}async[a35_0x1b51c9(0x19f)](_0x29ccd6,_0x4fadf0){const _0x19d149=a35_0x1b51c9,_0x1d5235={..._0x4fadf0};_0x4fadf0[_0x19d149(0x1ad)]&&(_0x1d5235[_0x19d149(0x1ad)]=await bcryptjs_1[_0x19d149(0x1a5)]['hash'](_0x4fadf0['password'],0xc));_0x4fadf0[_0x19d149(0x1d1)]&&(_0x1d5235['name']=_0x4fadf0['fullName'],delete _0x1d5235[_0x19d149(0x1d1)]);_0x4fadf0['telegramId']&&(_0x1d5235[_0x19d149(0x1bd)]=_0x4fadf0[_0x19d149(0x17d)],delete _0x1d5235[_0x19d149(0x17d)]);_0x4fadf0[_0x19d149(0x1c1)]&&(_0x1d5235[_0x19d149(0x1c0)]=_0x4fadf0[_0x19d149(0x1c1)],delete _0x1d5235[_0x19d149(0x1c1)]);_0x4fadf0[_0x19d149(0x254)]&&(_0x1d5235[_0x19d149(0x167)]=JSON[_0x19d149(0x28a)](_0x4fadf0['gateways']),delete _0x1d5235[_0x19d149(0x254)]);_0x4fadf0['gatewaySettings']&&(_0x1d5235['gatewaySettings']=JSON[_0x19d149(0x28a)](_0x4fadf0['gatewaySettings']));_0x4fadf0[_0x19d149(0x1f5)]&&(_0x4fadf0[_0x19d149(0x1f5)][_0x19d149(0x286)]!==undefined&&(_0x1d5235[_0x19d149(0x286)]=_0x4fadf0['wallets'][_0x19d149(0x286)]||null),_0x4fadf0[_0x19d149(0x1f5)]['usdtTrcWallet']!==undefined&&(_0x1d5235[_0x19d149(0x16a)]=_0x4fadf0[_0x19d149(0x1f5)][_0x19d149(0x16a)]||null),_0x4fadf0[_0x19d149(0x1f5)][_0x19d149(0x1f2)]!==undefined&&(_0x1d5235[_0x19d149(0x1f2)]=_0x4fadf0[_0x19d149(0x1f5)][_0x19d149(0x1f2)]||null),_0x4fadf0['wallets'][_0x19d149(0x1bc)]!==undefined&&(_0x1d5235[_0x19d149(0x1bc)]=_0x4fadf0[_0x19d149(0x1f5)][_0x19d149(0x1bc)]||null),delete _0x1d5235[_0x19d149(0x1f5)]);const _0x8441f6=await database_1[_0x19d149(0x1a5)]['shop'][_0x19d149(0x232)]({'where':{'id':_0x29ccd6},'data':_0x1d5235,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x8441f6['id'],'fullName':_0x8441f6[_0x19d149(0x25c)],'username':_0x8441f6[_0x19d149(0x15e)],'telegramId':_0x8441f6['telegram'],'merchantUrl':_0x8441f6[_0x19d149(0x1c0)],'gateways':_0x8441f6[_0x19d149(0x167)]?JSON['parse'](_0x8441f6[_0x19d149(0x167)]):null,'gatewaySettings':_0x8441f6[_0x19d149(0x163)]?JSON[_0x19d149(0x170)](_0x8441f6[_0x19d149(0x163)]):null,'publicKey':_0x8441f6[_0x19d149(0x1db)],'wallets':{'usdtPolygonWallet':_0x8441f6[_0x19d149(0x286)],'usdtTrcWallet':_0x8441f6[_0x19d149(0x16a)],'usdtErcWallet':_0x8441f6['usdtErcWallet'],'usdcPolygonWallet':_0x8441f6[_0x19d149(0x1bc)]},'status':_0x8441f6['status'],'createdAt':_0x8441f6[_0x19d149(0x1ff)]};}async['suspendUser'](_0x3220dd){const _0xf59bec=a35_0x1b51c9,_0x619e88=await database_1[_0xf59bec(0x1a5)][_0xf59bec(0x1eb)][_0xf59bec(0x232)]({'where':{'id':_0x3220dd},'data':{'status':_0xf59bec(0x265)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x619e88['id'],'fullName':_0x619e88[_0xf59bec(0x25c)],'username':_0x619e88[_0xf59bec(0x15e)],'telegramId':_0x619e88[_0xf59bec(0x1bd)],'merchantUrl':_0x619e88['shopUrl'],'gateways':_0x619e88[_0xf59bec(0x167)]?JSON['parse'](_0x619e88[_0xf59bec(0x167)]):null,'gatewaySettings':_0x619e88[_0xf59bec(0x163)]?JSON[_0xf59bec(0x170)](_0x619e88['gatewaySettings']):null,'publicKey':_0x619e88[_0xf59bec(0x1db)],'wallets':{'usdtPolygonWallet':_0x619e88[_0xf59bec(0x286)],'usdtTrcWallet':_0x619e88[_0xf59bec(0x16a)],'usdtErcWallet':_0x619e88['usdtErcWallet'],'usdcPolygonWallet':_0x619e88[_0xf59bec(0x1bc)]},'status':_0x619e88[_0xf59bec(0x23f)],'createdAt':_0x619e88[_0xf59bec(0x1ff)]};}async[a35_0x1b51c9(0x284)](_0x2cc3cf){const _0x21c431=a35_0x1b51c9,_0x4148c1=await database_1[_0x21c431(0x1a5)][_0x21c431(0x1eb)]['update']({'where':{'id':_0x2cc3cf},'data':{'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4148c1['id'],'fullName':_0x4148c1[_0x21c431(0x25c)],'username':_0x4148c1[_0x21c431(0x15e)],'telegramId':_0x4148c1[_0x21c431(0x1bd)],'merchantUrl':_0x4148c1[_0x21c431(0x1c0)],'gateways':_0x4148c1[_0x21c431(0x167)]?JSON[_0x21c431(0x170)](_0x4148c1[_0x21c431(0x167)]):null,'gatewaySettings':_0x4148c1[_0x21c431(0x163)]?JSON[_0x21c431(0x170)](_0x4148c1[_0x21c431(0x163)]):null,'publicKey':_0x4148c1[_0x21c431(0x1db)],'wallets':{'usdtPolygonWallet':_0x4148c1[_0x21c431(0x286)],'usdtTrcWallet':_0x4148c1[_0x21c431(0x16a)],'usdtErcWallet':_0x4148c1['usdtErcWallet'],'usdcPolygonWallet':_0x4148c1[_0x21c431(0x1bc)]},'status':_0x4148c1['status'],'createdAt':_0x4148c1[_0x21c431(0x1ff)]};}async[a35_0x1b51c9(0x272)](_0x28669f){const _0x693568=a35_0x1b51c9,{page:_0x584f8d,limit:_0x37926f,status:_0x42d250}=_0x28669f,_0x4902f0=(_0x584f8d-0x1)*_0x37926f,_0x6cb0f4={};_0x42d250&&(_0x6cb0f4[_0x693568(0x23f)]=_0x42d250[_0x693568(0x1cd)]());const [_0x42b145,_0x20f3d0]=await Promise[_0x693568(0x1c7)]([database_1[_0x693568(0x1a5)][_0x693568(0x1eb)][_0x693568(0x287)]({'where':_0x6cb0f4,'skip':_0x4902f0,'take':_0x37926f,'orderBy':{'createdAt':_0x693568(0x22f)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x693568(0x1a5)][_0x693568(0x1eb)][_0x693568(0x1b1)]({'where':_0x6cb0f4})]);return{'users':_0x42b145[_0x693568(0x236)](_0x57dcb0=>({'id':_0x57dcb0['id'],'fullName':_0x57dcb0[_0x693568(0x25c)],'username':_0x57dcb0[_0x693568(0x15e)],'telegramId':_0x57dcb0[_0x693568(0x1bd)],'merchantUrl':_0x57dcb0['shopUrl'],'gateways':_0x57dcb0['paymentGateways']?JSON['parse'](_0x57dcb0['paymentGateways']):null,'gatewaySettings':_0x57dcb0[_0x693568(0x163)]?JSON[_0x693568(0x170)](_0x57dcb0['gatewaySettings']):null,'publicKey':_0x57dcb0['publicKey'],'wallets':{'usdtPolygonWallet':_0x57dcb0['usdtPolygonWallet'],'usdtTrcWallet':_0x57dcb0[_0x693568(0x16a)],'usdtErcWallet':_0x57dcb0[_0x693568(0x1f2)],'usdcPolygonWallet':_0x57dcb0[_0x693568(0x1bc)]},'status':_0x57dcb0[_0x693568(0x23f)],'createdAt':_0x57dcb0[_0x693568(0x1ff)]})),'pagination':{'page':_0x584f8d,'limit':_0x37926f,'total':_0x20f3d0,'totalPages':Math['ceil'](_0x20f3d0/_0x37926f)}};}async[a35_0x1b51c9(0x27d)](_0x3cae8f){const _0x5de123=a35_0x1b51c9,_0x17226b=await database_1[_0x5de123(0x1a5)]['shop'][_0x5de123(0x18d)]({'where':{'id':_0x3cae8f},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x17226b)return null;return{'id':_0x17226b['id'],'fullName':_0x17226b['name'],'username':_0x17226b[_0x5de123(0x15e)],'telegramId':_0x17226b[_0x5de123(0x1bd)],'merchantUrl':_0x17226b[_0x5de123(0x1c0)],'gateways':_0x17226b[_0x5de123(0x167)]?JSON[_0x5de123(0x170)](_0x17226b['paymentGateways']):null,'gatewaySettings':_0x17226b[_0x5de123(0x163)]?JSON[_0x5de123(0x170)](_0x17226b[_0x5de123(0x163)]):null,'publicKey':_0x17226b[_0x5de123(0x1db)],'wallets':{'usdtPolygonWallet':_0x17226b[_0x5de123(0x286)],'usdtTrcWallet':_0x17226b[_0x5de123(0x16a)],'usdtErcWallet':_0x17226b[_0x5de123(0x1f2)],'usdcPolygonWallet':_0x17226b[_0x5de123(0x1bc)]},'status':_0x17226b[_0x5de123(0x23f)],'createdAt':_0x17226b[_0x5de123(0x1ff)]};}async[a35_0x1b51c9(0x16e)](_0x3f523b){const _0x48fe30=a35_0x1b51c9,{fullName:_0x53bbc8,username:_0x42e134,password:_0x430773,telegramId:_0x155f4d,merchantUrl:_0x115b6e,gateways:_0x330ec3,gatewaySettings:_0x58f82b,wallets:_0x61b16}=_0x3f523b,_0x25cce6=await database_1[_0x48fe30(0x1a5)][_0x48fe30(0x1eb)][_0x48fe30(0x18d)]({'where':{'username':_0x42e134}});if(_0x25cce6)throw new Error(_0x48fe30(0x1fd));if(_0x155f4d){const _0x5ffc2c=await database_1[_0x48fe30(0x1a5)][_0x48fe30(0x1eb)][_0x48fe30(0x18d)]({'where':{'telegram':_0x155f4d}});if(_0x5ffc2c)throw new Error('Telegram\x20username\x20already\x20exists');}const _0x59ba57=await bcryptjs_1[_0x48fe30(0x1a5)][_0x48fe30(0x1c6)](_0x430773,0xc),_0x15cbf9=_0x48fe30(0x188)+crypto_1[_0x48fe30(0x1a5)]['randomBytes'](0x20)[_0x48fe30(0x25f)](_0x48fe30(0x22c)),_0x436317=_0x48fe30(0x186)+crypto_1[_0x48fe30(0x1a5)]['randomBytes'](0x20)[_0x48fe30(0x25f)]('hex'),_0x7081a6=await database_1['default'][_0x48fe30(0x1eb)][_0x48fe30(0x20c)]({'data':{'name':_0x53bbc8,'username':_0x42e134,'password':_0x59ba57,'telegram':_0x155f4d,'shopUrl':_0x115b6e,'paymentGateways':_0x330ec3?JSON[_0x48fe30(0x28a)](_0x330ec3):null,'gatewaySettings':_0x58f82b?JSON['stringify'](_0x58f82b):null,'usdtPolygonWallet':_0x61b16?.[_0x48fe30(0x286)]||null,'usdtTrcWallet':_0x61b16?.[_0x48fe30(0x16a)]||null,'usdtErcWallet':_0x61b16?.[_0x48fe30(0x1f2)]||null,'usdcPolygonWallet':_0x61b16?.[_0x48fe30(0x1bc)]||null,'publicKey':_0x15cbf9,'secretKey':_0x436317,'status':_0x48fe30(0x233)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x7081a6['id'],'fullName':_0x7081a6[_0x48fe30(0x25c)],'username':_0x7081a6['username'],'telegramId':_0x7081a6['telegram'],'merchantUrl':_0x7081a6[_0x48fe30(0x1c0)],'gateways':_0x7081a6[_0x48fe30(0x167)]?JSON[_0x48fe30(0x170)](_0x7081a6['paymentGateways']):null,'gatewaySettings':_0x7081a6[_0x48fe30(0x163)]?JSON[_0x48fe30(0x170)](_0x7081a6[_0x48fe30(0x163)]):null,'publicKey':_0x7081a6[_0x48fe30(0x1db)],'wallets':{'usdtPolygonWallet':_0x7081a6['usdtPolygonWallet'],'usdtTrcWallet':_0x7081a6[_0x48fe30(0x16a)],'usdtErcWallet':_0x7081a6[_0x48fe30(0x1f2)],'usdcPolygonWallet':_0x7081a6[_0x48fe30(0x1bc)]},'status':_0x7081a6[_0x48fe30(0x23f)],'createdAt':_0x7081a6[_0x48fe30(0x1ff)]};}async[a35_0x1b51c9(0x1e1)](_0x4f087e){const _0x3ecb9a=a35_0x1b51c9;await database_1[_0x3ecb9a(0x1a5)]['shop'][_0x3ecb9a(0x1c9)]({'where':{'id':_0x4f087e}});}async[a35_0x1b51c9(0x23c)](_0x198a0e){const _0x3100e7=a35_0x1b51c9,_0x13c54b={};_0x198a0e&&[_0x3100e7(0x233),_0x3100e7(0x19d),_0x3100e7(0x265)][_0x3100e7(0x240)](_0x198a0e[_0x3100e7(0x1cd)]())&&(_0x13c54b[_0x3100e7(0x23f)]=_0x198a0e[_0x3100e7(0x1cd)]());const _0xf46df6=await database_1[_0x3100e7(0x1a5)][_0x3100e7(0x1eb)][_0x3100e7(0x287)]({'where':_0x13c54b,'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':'asc'}});return _0xf46df6;}}function a35_0x49e8(){const _0x3806ab=['🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','paymentGateways','5719175aryFcV','gte','usdtTrcWallet','getMonth','AdminService','round','createUser','\x20\x20\x20Payout\x20amount:\x20','parse','📊\x20Payment\x20','txUrls','bankId','\x20\x20\x20💰\x20Total\x20turnover:\x20','year','\x20no\x20longer\x20PAID:\x20-','averageCommissionRate','\x20payments\x20for\x20daily\x20statistics','565135GtZIMW','69164mVYzgS','totalPayout','periodFrom','telegramId','\x20\x20\x20Parsed\x20gatewaySettings:','7715223unbWgM','$transaction','USDT\x20ERC20','Rapyd','cardLast4','\x20\x20\x20💰\x20Total\x20payout:\x20','3663984doBYtv','sk_','split','pk_','insensitive','updatedAt','reduce','paymentsCount','findUnique','commissionUSDT','./currencyService','paidOutUSDT','💰\x20Found\x20','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','\x20\x20\x20🌍\x20Country:\x20','📊\x20Conversion\x20rate\x20calculation:','\x20\x20\x20Username:\x20','customerUa','getGatewayDisplayName','✅\x20Payout\x20created:\x20','bcryptjs','\x20USDT\x20(same\x20as\x20awaiting)','thisMonth','month','INACTIVE','_count','updateUser','\x20to\x20','turnover','_sum','aggregate','failureMessage','default','💰\x20[DAILY]\x20Added\x20','🔍\x20Search\x20results:\x20','\x20USDT\x20for\x20payment\x20on\x20','Error\x20processing\x20payment\x20','getFullYear','455936FretRJ','amount','password','period','merchantEarningsUSDT','CHARGEBACK','count','USDT\x20Polygon','getPayoutById','getWalletAddress','\x20USDT\x20for\x20','conversionRate','\x20\x20\x20🖥️\x20User\x20Agent:\x20','date','customerEmail','💰\x20Payment\x20','\x20to\x20name\x20','usdcPolygonWallet','telegram','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','\x20\x20\x20Current\x20balance:\x20','shopUrl','merchantUrl','\x20merchants,\x20','sort','\x20(direct\x20amountUSDT)','toFixed','hash','all','\x20USDT\x20total','delete','\x20paid\x20payments\x20for\x20analysis','Test\x20Gateway','notes','toUpperCase','\x20\x20\x20Gateway\x20key\x20found:\x20','getPaymentById','__importDefault','fullName','findFirst','successUrl','test','\x20balance\x20updated:','getMerchantStatistics','💰\x20Shop\x20','adminNotes','\x20USDT\x20to\x20balance','📊\x20[ADMIN]\x20Processing\x20','publicKey','string','length','gatewayOrderId','revenue',',\x20gatewayOrderID=','deleteUser','🔍\x20Admin\x20search\x20query:\x20\x22','remitterIban','\x20\x20\x20Commission\x20from\x20settings:\x20','📊\x20Total\x20payments\x20(all\x20statuses):\x20','\x20\x20\x20Final\x20commission\x20used:\x20','lifetime','dateTo','90d','getTime','shop','__esModule','🔄\x20Admin\x20updating\x20payment\x20','\x20\x20\x20Total\x20payments:\x20','convertToUSDT','gateway','payment','usdtErcWallet','KLYME\x20EU','groupBy','wallets','📊\x20Calculating\x20payout\x20statistics...','localeCompare','push','\x20\x20\x20💵\x20Available\x20balance:\x20','forEach','remitterName','24yQbIVQ','Username\x20already\x20exists','\x20\x20\x20📈\x20Conversion\x20rate:\x20','createdAt','CoinToPay','\x20\x20\x20Successful\x20payments:\x20','getDate','createPayout','set','📊\x20[ADMIN]\x20Status\x20breakdown:','📅\x20Period:\x20','📊\x20[DAILY]\x20Processed\x20','ceil','custom','FOUND','shopId','create','balance','getMerchantsAwaitingPayout','\x20USDT','\x20payments,\x20returning\x20','alltime','\x20USDT\x20(total\x20paid\x20to\x20merchants)','2020-01-01','paidAt','network','USDT\x20TRC20','\x20USDT,\x20Requested:\x20','\x20status:\x20','crypto','\x20\x20\x20Raw\x20gatewaySettings:\x20',',\x20ID:\x20','paymentMethod','log','20QLMiPM','customerName','💸\x20CHARGEBACK\x20penalty:\x20-','🔍\x20Admin\x20getAllPayments\x20sorting:\x20','Plisio','getAllPayouts','COMPLETED','NOT\x20FOUND','toISOString','\x20\x20\x20Failed\x20to\x20parse\x20gatewaySettings:\x20','failUrl','values','\x20\x20\x20Name:\x20','getSystemStatistics','hex','PAID','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','desc','\x20->\x20','\x20USDT)','update','ACTIVE','\x20USDT\x20(-','16HKpOWJ','map','periodTo','\x20PAID\x20payments\x20out\x20of\x20','not\x20found','commission','📊\x20[DAILY]\x20Total\x20revenue\x20processed:\x20','getMerchantsSelection','null','\x20\x20\x20Conversion\x20rate:\x20','status','includes','not\x20set','KLYME\x20GB','admin','\x20for\x20shop\x20','customerCountry','totalCommissionRate','📊\x20Admin\x20getAllPayments\x20results:\x20found\x20','lte','test_gateway','formatNetworkName','chargebackAmount','payout','Amer\x20Master','merchantEarnings','asc','customerIp','totalPaidOut','\x20\x20\x20🌐\x20IP:\x20','KLYME\x20DE','gateways','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','generateDailyStatistics','\x20\x20\x20✅\x20Successful\x20payments:\x20','statusChangedAt','keys','name','30d','💰\x20Current\x20shop\x20balance:\x20','toString','deletePayout','week','availableBalance','currencyService','\x20USDT\x20from\x20balance','SUSPENDED','currency','averageCheckUSDT','🔍\x20Admin\x20payments\x20filter:\x20Converting\x20gateway\x20ID\x20','externalPaymentUrl','toLowerCase','\x20balance\x20updated:\x20','totalTurnover','updatePaymentStatus','orderId','🔍\x20Admin\x20payments\x20filter:\x20Using\x20gateway\x20name\x20','\x20\x20\x20Total\x20paid\x20out:\x20','USDC\x20Polygon','getAllUsers','error','\x20total','2152392IuTOAt','../types/gateway','\x20merchants\x20with\x20positive\x20balance','amountUSDT','Payment\x20not\x20found','gatewayEarnings','🔍\x20Admin\x20getAllPayments\x20query\x20filters:',',\x20gateway=','getUserById','💰\x20Creating\x20payout\x20for\x20shop\x20','updateCustomerData','getPayoutStats','📊\x20All-time\x20statistics\x20from\x20first\x20payment:\x20','successfulPayments','dailyPayments','activateUser','totalPayments','usdtPolygonWallet','findMany','turnoverUSDT','\x20\x20\x20📊\x20Total\x20payments:\x20','stringify','\x20USDT\x20(total\x20merchant\x20balances)','username','\x20\x20\x20📅\x20This\x20month:\x20','\x20USDT\x20(','txid','\x20commission\x20analysis:','gatewaySettings','../config/database','📊\x20Merchant\x20statistics\x20calculated:'];a35_0x49e8=function(){return _0x3806ab;};return a35_0x49e8();}exports[a35_0x1b51c9(0x16c)]=AdminService;