'use strict';const a35_0x5767a8=a35_0x1183;(function(_0x34f871,_0x1445a5){const _0x515d40=a35_0x1183,_0xd6dd4c=_0x34f871();while(!![]){try{const _0x5bd15e=-parseInt(_0x515d40(0x106))/0x1*(-parseInt(_0x515d40(0x114))/0x2)+-parseInt(_0x515d40(0x171))/0x3*(-parseInt(_0x515d40(0x1c4))/0x4)+parseInt(_0x515d40(0x1be))/0x5+parseInt(_0x515d40(0x127))/0x6+-parseInt(_0x515d40(0x12f))/0x7+-parseInt(_0x515d40(0xde))/0x8+parseInt(_0x515d40(0x118))/0x9*(-parseInt(_0x515d40(0x10e))/0xa);if(_0x5bd15e===_0x1445a5)break;else _0xd6dd4c['push'](_0xd6dd4c['shift']());}catch(_0x1329cc){_0xd6dd4c['push'](_0xd6dd4c['shift']());}}}(a35_0x3057,0x9c42c));function a35_0x1183(_0x4aa23f,_0x1a890f){const _0x305748=a35_0x3057();return a35_0x1183=function(_0x118328,_0x55841d){_0x118328=_0x118328-0xb9;let _0x232727=_0x305748[_0x118328];return _0x232727;},a35_0x1183(_0x4aa23f,_0x1a890f);}function a35_0x3057(){const _0x4230eb=['updatePaymentStatus','aggregate','updateUser','./currencyService','forEach','📊\x20Calculating\x20payout\x20statistics...','📊\x20Total\x20payments\x20(including\x20failed):\x20','usdtTrcWallet','activateUser','turnover','toLowerCase','\x20USDT)','\x20\x20\x20✅\x20Total\x20available\x20for\x20payout:\x20','Open\x20Banking\x202','\x20for\x20shop\x20','asc','🔄\x20Converted\x20gateway\x20name\x20\x27','customerIp','convertToUSDT','Error\x20processing\x20payment\x20','getTime','💸\x20CHARGEBACK\x20penalty:\x20-','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','\x20\x20\x20Added\x20to\x20balance:\x20+','shopUrl','klyme_gb','getUserById','failureMessage','customerCountry','telegramId','customerUa','\x20\x20\x20Transaction\x20hash:\x20','⚠️\x20Requested\x20gateway\x20\x27','30d','entries','../types/gateway','revenue','date','608190cXbpiX','90d','klyme_de','\x20\x20\x20💵\x20Available\x20balance:\x20','year','CHARGEBACK','187864NTjaOP','📊\x20Available\x20gateways\x20in\x20database:','all','network','💰\x20[PAYOUT]\x20Gateway\x20','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','\x20USDT','\x20\x20\x20Current\x20balance:\x20','updateCustomerData','\x20USDT\x20(','availableBalance','some','payout','\x20USDT\x20from\x20balance','$transaction','parse','toISOString','findFirst','deletePayout','usdtPolygonWallet','gatewayEarnings','join','stringify','\x20USDT\x20(after\x20payouts)','Test\x20Gateway','fullName','error','chargebackAmount','push','includes','totalPayout','💳\x20Payout\x20wallet\x20for\x20','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','count','values','\x20merchants\x20with\x20positive\x20balance','\x20\x20\x20📊\x20Total\x20payments:\x20','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','notes','\x20\x20\x20💰\x20Total\x20payout:\x20','periodTo','shop','⚠️\x20Payment\x20','⚠️\x20Gateway\x20\x27','klyme_eu','usdcPolygonWallet','status','📊\x20Merchant\x20statistics\x20calculated:','Noda','gte','\x20\x20\x20🌐\x20IP:\x20','customerEmail','💸\x20CHARGEBACK:\x20Merchant\x20amount\x20already\x20deducted\x20from\x20balance','📊\x20Sorting\x20payments\x20by\x20','📊\x20Gateway\x20filter\x20applied:','\x20\x20\x20Balance:\x20','getGatewayDisplayName','\x27\x20->\x20name\x20\x27','getAllUsers','publicKey','name','\x20USDT\x20(+','adminNotes','amountAfterCommissionUSDT','\x20balance\x20updated:','📊\x20Getting\x20payments\x20with\x20filters:','pendingUrl','✅\x20Payout\x20created:\x20','delete','trc20','map','2170464WCthkT','\x20status:\x20','balance','thisMonth','dailyRevenue','🔍\x20Using\x20gateway\x20\x27','getMonth','awaitingPayout','\x20USDT\x20(with\x20commission\x20deducted)','PAID','💰\x20Current\x20shop\x20balance:\x20','getPaymentById','merchantEarnings','\x20\x20\x20Total\x20paid\x20out:\x20','round','\x20USDT\x20(theoretical\x20net)','\x27\x20->\x20ID\x20\x27','commission','updatedAt','toFixed','insensitive','erc20','polygon','\x20USDT\x20(-','📋\x20Found\x20','getAllPayments','payment','\x27\x20(from\x20\x27','getGatewayInternalName','KLYME\x20EU','plisio','🔄\x20Gateway\x20mapping\x20(create):','\x20\x20\x20✅\x20Actual\x20available\x20balance:\x20',',\x20Commission:\x20','dateFrom','MasterCard','set','\x20\x20\x20💰\x20Total\x20payments\x20turnover:\x20','getDate','averageCheckUSDT','308wORaIU','create','admin','txid','📋\x20Getting\x20merchants\x20selection\x20list...','groupBy','custom','ceil','50OnJRFQ','\x20->\x20','💰\x20Payment\x20','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','gateway','length','6004euixmN','\x20USDT\x20(gross\x20revenue)','telegram',',\x20successful:\x20','1103967lUgIBP','COMPLETED','\x20\x20\x20Merchant\x20loses:\x20','toString','\x20merchants','createdAt','amountUSDT','not\x20specified','💱\x20Currency\x20filter\x20applied:\x20','Username\x20already\x20exists','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','🔄\x20Converted\x20gateway\x20ID\x20\x27','Shop\x20not\x20found','paidOutUSDT','\x20\x20\x20Merchant\x20gets:\x20','4015386ojrktA','totalCommissionRate','\x20\x20\x20💳\x20Total\x20payments:\x20','polygon_usdc','dateTo','lte','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','gateways','1664488JpEwrq','desc','sk_','📊\x20Payout\x20statistics\x20calculated:','usdtErcWallet','\x20became\x20PAID:','Rapyd','getGatewayIdByName','getMerchantsAwaitingPayout','🔄\x20Gateway\x20mapping\x20(get):','currency','toUpperCase','__esModule',':\x20commission\x20=\x20','getAllPayouts','externalPaymentUrl','\x20balance\x20updated:\x20','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','🔄\x20Admin\x20updating\x20payment\x20','whiteUrl','periodFrom','mastercard','\x20\x20\x20Gateway:\x20','getSystemStatistics','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','2020-01-01','\x20\x20\x20🖥️\x20User\x20Agent:\x20','orderId','customerName','KLYME\x20DE','\x20to\x20','period','\x20in\x20','pk_','📅\x20Period\x20\x27all\x27:\x20Using\x20start\x20date\x20from\x20first\x20payment:\x20','getMerchantStatistics','statusChangedBy','wallets','totalPaidOut','cointopay2','hex','paymentsCount','ACTIVE','test_gateway','paidAt','suspendUser','gatewaySettings','randomBytes','\x20\x20\x20Payout\x20amount:\x20','commissionUSDT','merchantUrl','\x20USDT\x20(after\x20','week','split','username','amount','\x20paid\x20payments\x20for\x20analysis','getPayoutStats','update','getPayoutById','averageCommissionRate','log','getMerchantsSelection','%\x20commission)','hash','REFUND','3TzHxjh','default','\x27\x20not\x20found.\x20Available\x20gateways:\x20','✅\x20Using\x20gateway\x20filter:\x20\x27','📊\x20Final\x20WHERE\x20conditions:','turnoverUSDT','\x20order','totalAmountAfterCommissionUSDT','\x27\x20to\x20name\x20\x27','findUnique','getFullYear','_count','_sum','merchantEarningsUSDT','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','generateDailyStatistics','summary','AdminService','crypto','💰\x20Found\x20','totalTurnover','paymentGateways','reduce','getGatewayNameById','currencyService','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','\x20USDT\x20(same\x20as\x20awaiting)','\x20USDT\x20(actual\x20balances)','not\x20set','__importDefault','\x20payments)','\x20\x20\x20Full\x20amount:\x20','password','Insufficient\x20balance.\x20Available:\x20','findMany','gatewayOrderId','successUrl','shopId','deleteUser'];a35_0x3057=function(){return _0x4230eb;};return a35_0x3057();}var __importDefault=this&&this[a35_0x5767a8(0x18e)]||function(_0x45d55c){const _0x553719=a35_0x5767a8;return _0x45d55c&&_0x45d55c[_0x553719(0x13b)]?_0x45d55c:{'default':_0x45d55c};};Object['defineProperty'](exports,a35_0x5767a8(0x13b),{'value':!![]}),exports[a35_0x5767a8(0x182)]=void 0x0;const database_1=__importDefault(require('../config/database')),bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a35_0x5767a8(0x183))),currencyService_1=require(a35_0x5767a8(0x19b)),gateway_1=require(a35_0x5767a8(0x1bb));class AdminService{async[a35_0x5767a8(0x168)](){const _0x35bd5f=a35_0x5767a8;console[_0x35bd5f(0x16c)](_0x35bd5f(0x19d));const _0x52b463=await database_1['default']['shop'][_0x35bd5f(0x199)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x35bd5f(0x159)}}),_0x4f6a12=await this['getMerchantsAwaitingPayout']({'page':0x1,'limit':0x3e8}),_0x177d99=await database_1[_0x35bd5f(0x172)][_0x35bd5f(0xf8)][_0x35bd5f(0x1e5)]({'where':{'status':_0x35bd5f(0xe7),'gateway':{'not':_0x35bd5f(0x15a)}}}),_0x4db9e5=new Date(),_0x3df5b7=new Date(_0x4db9e5[_0x35bd5f(0x17b)](),_0x4db9e5[_0x35bd5f(0xe4)](),0x1),_0x131b89=new Date(_0x4db9e5[_0x35bd5f(0x17b)](),_0x4db9e5['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x1142db=await database_1['default'][_0x35bd5f(0x1d0)][_0x35bd5f(0x199)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x3df5b7,'lte':_0x131b89},'status':_0x35bd5f(0x119)}}),_0x13d416=_0x52b463[_0x35bd5f(0x17d)][_0x35bd5f(0x155)]||0x0,_0x1f9a8c=_0x4f6a12[_0x35bd5f(0x181)][_0x35bd5f(0x178)],_0x147f82=_0x1142db[_0x35bd5f(0x17d)]['amount']||0x0,_0x53948b={'totalPayout':Math['round'](_0x13d416*0x64)/0x64,'awaitingPayout':Math[_0x35bd5f(0xec)](_0x1f9a8c*0x64)/0x64,'thisMonth':Math['round'](_0x147f82*0x64)/0x64,'availableBalance':Math[_0x35bd5f(0xec)](_0x1f9a8c*0x64)/0x64,'totalPayments':_0x177d99};return console[_0x35bd5f(0x16c)](_0x35bd5f(0x132)),console[_0x35bd5f(0x16c)](_0x35bd5f(0xbe)+_0x53948b['totalPayout']+'\x20USDT\x20(total\x20paid\x20to\x20merchants)'),console[_0x35bd5f(0x16c)]('\x20\x20\x20⏳\x20Awaiting\x20payout:\x20'+_0x53948b[_0x35bd5f(0xe5)]+_0x35bd5f(0xe6)),console[_0x35bd5f(0x16c)](_0x35bd5f(0x1c1)+_0x53948b[_0x35bd5f(0x1ce)]+_0x35bd5f(0x18b)),console[_0x35bd5f(0x16c)]('\x20\x20\x20📅\x20This\x20month:\x20'+_0x53948b[_0x35bd5f(0xe1)]+_0x35bd5f(0x1ca)),console[_0x35bd5f(0x16c)](_0x35bd5f(0x129)+_0x53948b['totalPayments']+'\x20PAID\x20payments'),console[_0x35bd5f(0x16c)]('\x20\x20\x20🔍\x20Raw\x20balance\x20sum:\x20'+(_0x52b463[_0x35bd5f(0x17d)][_0x35bd5f(0xe0)]||0x0)[_0x35bd5f(0xf1)](0x2)+'\x20USDT\x20(without\x20commission)'),console[_0x35bd5f(0x16c)]('\x20\x20\x20📊\x20Commission\x20difference:\x20'+((_0x52b463[_0x35bd5f(0x17d)][_0x35bd5f(0xe0)]||0x0)-_0x1f9a8c)['toFixed'](0x2)+_0x35bd5f(0x1ca)),_0x53948b;}async[a35_0x5767a8(0x1cc)](_0x58738e,_0x43e7fa){const _0x55f1a1=a35_0x5767a8;console[_0x55f1a1(0x16c)]('🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20'+_0x58738e+':',_0x43e7fa);const _0x470845=await database_1[_0x55f1a1(0x172)][_0x55f1a1(0xf8)][_0x55f1a1(0x17a)]({'where':{'id':_0x58738e},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x470845)throw new Error('Payment\x20not\x20found');const _0x2e50d1={};_0x43e7fa[_0x55f1a1(0x1b4)]!==undefined&&(_0x2e50d1[_0x55f1a1(0x1b4)]=_0x43e7fa[_0x55f1a1(0x1b4)]||null);_0x43e7fa[_0x55f1a1(0x1a9)]!==undefined&&(_0x2e50d1[_0x55f1a1(0x1a9)]=_0x43e7fa[_0x55f1a1(0x1a9)]||null);_0x43e7fa[_0x55f1a1(0x1b6)]!==undefined&&(_0x2e50d1['customerUa']=_0x43e7fa[_0x55f1a1(0x1b6)]||null);const _0x379b30=await database_1[_0x55f1a1(0x172)]['payment'][_0x55f1a1(0x169)]({'where':{'id':_0x58738e},'data':{..._0x2e50d1,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x55f1a1(0x16c)](_0x55f1a1(0x111)+_0x58738e),console['log']('\x20\x20\x20🌍\x20Country:\x20'+_0x470845[_0x55f1a1(0x1b4)]+_0x55f1a1(0x10f)+_0x379b30[_0x55f1a1(0x1b4)]),console['log'](_0x55f1a1(0xc9)+_0x470845[_0x55f1a1(0x1a9)]+_0x55f1a1(0x10f)+_0x379b30['customerIp']),console[_0x55f1a1(0x16c)](_0x55f1a1(0x149)+(_0x470845['customerUa']?_0x55f1a1(0x102):_0x55f1a1(0x18d))+_0x55f1a1(0x10f)+(_0x379b30['customerUa']?_0x55f1a1(0x102):'not\x20set')),_0x379b30;}async[a35_0x5767a8(0x146)](_0x48828d){const _0x53f6f4=a35_0x5767a8,_0x590f37=new Date();let _0x24693c;switch(_0x48828d){case'7d':_0x24693c=new Date(_0x590f37['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x53f6f4(0x1b9):_0x24693c=new Date(_0x590f37['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x53f6f4(0x1bf):_0x24693c=new Date(_0x590f37[_0x53f6f4(0x1ac)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x53f6f4(0x1c6):const _0x270fea=await database_1[_0x53f6f4(0x172)]['payment']['findFirst']({'where':{'gateway':{'not':_0x53f6f4(0x15a)}},'orderBy':{'createdAt':_0x53f6f4(0x1a7)},'select':{'createdAt':!![]}});_0x24693c=_0x270fea?_0x270fea[_0x53f6f4(0x11d)]:new Date('2020-01-01'),console['log'](_0x53f6f4(0x151)+_0x24693c[_0x53f6f4(0x1d4)]());break;default:_0x24693c=new Date(_0x590f37[_0x53f6f4(0x1ac)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x2e4dd4,_0x4414c0,_0x1d9d8c,_0x2678d5,_0x54af39,_0x2adde6,_0x229370]=await Promise[_0x53f6f4(0x1c6)]([database_1[_0x53f6f4(0x172)][_0x53f6f4(0xc0)][_0x53f6f4(0x1e5)](),database_1[_0x53f6f4(0x172)][_0x53f6f4(0xc0)][_0x53f6f4(0x1e5)]({'where':{'status':'ACTIVE'}}),database_1[_0x53f6f4(0x172)][_0x53f6f4(0xf8)][_0x53f6f4(0x1e5)]({'where':{'createdAt':{'gte':_0x24693c},'gateway':{'not':_0x53f6f4(0x15a)}}}),database_1['default']['payment'][_0x53f6f4(0x1e5)]({'where':{'status':_0x53f6f4(0xe7),'createdAt':{'gte':_0x24693c},'gateway':{'not':_0x53f6f4(0x15a)}}}),database_1[_0x53f6f4(0x172)][_0x53f6f4(0xf8)][_0x53f6f4(0x193)]({'where':{'status':'PAID','createdAt':{'gte':_0x24693c},'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![]}}),database_1[_0x53f6f4(0x172)][_0x53f6f4(0xf8)][_0x53f6f4(0x193)]({'where':{'gateway':{'not':_0x53f6f4(0x15a)}},'take':0xa,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x53f6f4(0xf8)][_0x53f6f4(0x193)]({'where':{'createdAt':{'gte':_0x24693c},'gateway':{'not':_0x53f6f4(0x15a)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x572a18=0x0;for(const _0x104068 of _0x54af39){const _0x1169bf=await currencyService_1['currencyService'][_0x53f6f4(0x1aa)](_0x104068[_0x53f6f4(0x166)],_0x104068[_0x53f6f4(0x139)]);_0x572a18+=_0x1169bf;}const _0x3cce53=this[_0x53f6f4(0x180)](_0x229370,_0x24693c,_0x590f37),_0x6707b=_0x1d9d8c>0x0?_0x2678d5/_0x1d9d8c*0x64:0x0;return{'totalShops':_0x2e4dd4,'activeShops':_0x4414c0,'totalPayments':_0x1d9d8c,'successfulPayments':_0x2678d5,'totalRevenue':Math[_0x53f6f4(0xec)](_0x572a18*0x64)/0x64,'conversionRate':Math['round'](_0x6707b*0x64)/0x64,'dailyRevenue':_0x3cce53[_0x53f6f4(0xe2)],'dailyPayments':_0x3cce53['dailyPayments'],'recentPayments':_0x2adde6['map'](_0x311bdc=>({'id':_0x311bdc['id'],'amount':_0x311bdc[_0x53f6f4(0x166)],'currency':_0x311bdc[_0x53f6f4(0x139)],'status':_0x311bdc['status'],'gateway':_0x311bdc[_0x53f6f4(0x112)],'shop':_0x311bdc[_0x53f6f4(0xc0)],'createdAt':_0x311bdc[_0x53f6f4(0x11d)]}))};}async[a35_0x5767a8(0x152)](_0x2aada0){const _0xa5ed7f=a35_0x5767a8;console[_0xa5ed7f(0x16c)](_0xa5ed7f(0x147),_0x2aada0);let _0x52f054,_0x5aa731=new Date();if(_0x2aada0[_0xa5ed7f(0x14e)]===_0xa5ed7f(0x10c)&&_0x2aada0[_0xa5ed7f(0x100)]&&_0x2aada0[_0xa5ed7f(0x12b)])_0x52f054=new Date(_0x2aada0[_0xa5ed7f(0x100)]),_0x5aa731=new Date(_0x2aada0['dateTo']);else{const _0x528d71=new Date();switch(_0x2aada0['period']){case _0xa5ed7f(0x163):_0x52f054=new Date(_0x528d71['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'month':_0x52f054=new Date(_0x528d71[_0xa5ed7f(0x1ac)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0xa5ed7f(0x1c2):_0x52f054=new Date(_0x528d71[_0xa5ed7f(0x1ac)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case'all':default:_0x52f054=new Date(_0xa5ed7f(0x148));break;}}console[_0xa5ed7f(0x16c)]('📅\x20Period:\x20'+_0x52f054[_0xa5ed7f(0x1d4)]()+_0xa5ed7f(0x14d)+_0x5aa731[_0xa5ed7f(0x1d4)]());const _0x5a45d1={'status':_0xa5ed7f(0xe7),'gateway':{'not':_0xa5ed7f(0x15a)},'paidAt':{'gte':_0x52f054,'lte':_0x5aa731}};_0x2aada0[_0xa5ed7f(0x196)]&&(_0x5a45d1[_0xa5ed7f(0x196)]=_0x2aada0['shopId']);const _0x1f3d61=await database_1[_0xa5ed7f(0x172)][_0xa5ed7f(0xf8)][_0xa5ed7f(0x193)]({'where':_0x5a45d1,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0xa5ed7f(0x16c)](_0xa5ed7f(0x184)+_0x1f3d61[_0xa5ed7f(0x113)]+_0xa5ed7f(0x167));const _0x271c09={'gateway':{'not':_0xa5ed7f(0x15a)},'createdAt':{'gte':_0x52f054,'lte':_0x5aa731}};_0x2aada0['shopId']&&(_0x271c09[_0xa5ed7f(0x196)]=_0x2aada0[_0xa5ed7f(0x196)]);const _0x34c958=await database_1[_0xa5ed7f(0x172)][_0xa5ed7f(0xf8)][_0xa5ed7f(0x1e5)]({'where':_0x271c09});console[_0xa5ed7f(0x16c)](_0xa5ed7f(0x19e)+_0x34c958+_0xa5ed7f(0x117)+_0x1f3d61[_0xa5ed7f(0x113)]);let _0x2e6ccb=0x0,_0x28d671=0x0,_0x4a9f77=0x0;const _0x19d3c6={},_0x23ce12={},_0x5b65ee={};for(const _0x3d4b73 of _0x1f3d61){try{const _0x3bc960=await currencyService_1['currencyService'][_0xa5ed7f(0x1aa)](_0x3d4b73['amount'],_0x3d4b73[_0xa5ed7f(0x139)]);let _0x125b3b={};if(_0x3d4b73['shop'][_0xa5ed7f(0x15d)])try{_0x125b3b=JSON[_0xa5ed7f(0x1d3)](_0x3d4b73[_0xa5ed7f(0xc0)][_0xa5ed7f(0x15d)]);}catch(_0x4c264b){console['error'](_0xa5ed7f(0x140)+_0x3d4b73['shopId']+':',_0x4c264b);}let _0x332466={},_0x4b170b=0xa;for(const [_0xffd2e,_0x24e526]of Object['entries'](_0x125b3b)){if(_0xffd2e['toLowerCase']()===_0x3d4b73['gateway'][_0xa5ed7f(0x1a2)]()){_0x332466=_0x24e526,_0x4b170b=_0x24e526[_0xa5ed7f(0xef)]||0xa;break;}}const _0x5daf83=_0x3bc960*(_0x4b170b/0x64),_0x53d026=_0x3bc960-_0x5daf83;_0x2e6ccb+=_0x3bc960,_0x28d671+=_0x53d026,_0x4a9f77+=_0x5daf83;!_0x19d3c6[_0x3d4b73['gateway']]&&(_0x19d3c6[_0x3d4b73[_0xa5ed7f(0x112)]]={'gateway':_0x3d4b73[_0xa5ed7f(0x112)],'gatewayDisplayName':this[_0xa5ed7f(0xcf)](_0x3d4b73[_0xa5ed7f(0x112)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x19d3c6[_0x3d4b73[_0xa5ed7f(0x112)]]['paymentsCount']++,_0x19d3c6[_0x3d4b73['gateway']][_0xa5ed7f(0x176)]+=_0x3bc960,_0x19d3c6[_0x3d4b73[_0xa5ed7f(0x112)]][_0xa5ed7f(0x160)]+=_0x5daf83,_0x19d3c6[_0x3d4b73['gateway']]['merchantEarningsUSDT']+=_0x53d026,_0x19d3c6[_0x3d4b73[_0xa5ed7f(0x112)]][_0xa5ed7f(0x128)]+=_0x4b170b;!_0x2aada0[_0xa5ed7f(0x196)]&&(!_0x23ce12[_0x3d4b73[_0xa5ed7f(0x196)]]&&(_0x23ce12[_0x3d4b73[_0xa5ed7f(0x196)]]={'shopId':_0x3d4b73['shopId'],'shopName':_0x3d4b73[_0xa5ed7f(0xc0)]['name'],'shopUsername':_0x3d4b73[_0xa5ed7f(0xc0)][_0xa5ed7f(0x165)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x23ce12[_0x3d4b73['shopId']][_0xa5ed7f(0x158)]++,_0x23ce12[_0x3d4b73[_0xa5ed7f(0x196)]][_0xa5ed7f(0x176)]+=_0x3bc960,_0x23ce12[_0x3d4b73['shopId']][_0xa5ed7f(0x160)]+=_0x5daf83,_0x23ce12[_0x3d4b73[_0xa5ed7f(0x196)]][_0xa5ed7f(0x17e)]+=_0x53d026);const _0x420aaf=_0x3d4b73[_0xa5ed7f(0x15b)][_0xa5ed7f(0x1d4)]()[_0xa5ed7f(0x164)]('T')[0x0];!_0x5b65ee[_0x420aaf]&&(_0x5b65ee[_0x420aaf]={'date':_0x420aaf,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x5b65ee[_0x420aaf][_0xa5ed7f(0x1a1)]+=_0x3bc960,_0x5b65ee[_0x420aaf][_0xa5ed7f(0xea)]+=_0x53d026,_0x5b65ee[_0x420aaf]['gatewayEarnings']+=_0x5daf83,_0x5b65ee[_0x420aaf][_0xa5ed7f(0x158)]++;}catch(_0x5ad3c1){console['error'](_0xa5ed7f(0x1ab)+_0x3d4b73['id']+':',_0x5ad3c1);}}Object[_0xa5ed7f(0xb9)](_0x19d3c6)[_0xa5ed7f(0x19c)](_0x416712=>{const _0x275b26=_0xa5ed7f;_0x416712['averageCommissionRate']=_0x416712[_0x275b26(0x158)]>0x0?_0x416712[_0x275b26(0x128)]/_0x416712[_0x275b26(0x158)]:0x0,delete _0x416712[_0x275b26(0x128)];}),Object['values'](_0x23ce12)[_0xa5ed7f(0x19c)](_0xad1189=>{const _0x15698a=_0xa5ed7f;_0xad1189[_0x15698a(0x105)]=_0xad1189[_0x15698a(0x158)]>0x0?_0xad1189[_0x15698a(0x176)]/_0xad1189[_0x15698a(0x158)]:0x0;});let _0x945c18=0x0;if(_0x2aada0[_0xa5ed7f(0x196)]){const _0x2b2a1c=await database_1[_0xa5ed7f(0x172)][_0xa5ed7f(0x1d0)]['findMany']({'where':{'shopId':_0x2aada0[_0xa5ed7f(0x196)],'status':'COMPLETED','createdAt':{'gte':_0x52f054,'lte':_0x5aa731}},'select':{'amount':!![]}});_0x945c18=_0x2b2a1c[_0xa5ed7f(0x187)]((_0xc1ad3a,_0x156c05)=>_0xc1ad3a+_0x156c05[_0xa5ed7f(0x166)],0x0);}const _0x5cfcea=_0x34c958,_0x43c94a=_0x1f3d61['length'],_0x35aa65=_0x43c94a>0x0?_0x2e6ccb/_0x43c94a:0x0,_0x584fa7=_0x5cfcea>0x0?Math[_0xa5ed7f(0xec)](_0x43c94a/_0x5cfcea*0x2710)/0x64:0x0,_0x1065fc=Math[_0xa5ed7f(0x10d)]((_0x5aa731['getTime']()-_0x52f054[_0xa5ed7f(0x1ac)]())/(0x3e8*0x3c*0x3c*0x18)),_0x5d5082={'totalTurnover':Math[_0xa5ed7f(0xec)](_0x2e6ccb*0x64)/0x64,'merchantEarnings':Math[_0xa5ed7f(0xec)](_0x28d671*0x64)/0x64,'gatewayEarnings':Math[_0xa5ed7f(0xec)](_0x4a9f77*0x64)/0x64,'totalPaidOut':Math[_0xa5ed7f(0xec)](_0x945c18*0x64)/0x64,'averageCheck':Math['round'](_0x35aa65*0x64)/0x64,'totalPayments':_0x5cfcea,'successfulPayments':_0x43c94a,'conversionRate':_0x584fa7,'gatewayBreakdown':Object[_0xa5ed7f(0xb9)](_0x19d3c6)[_0xa5ed7f(0xdd)](_0x42ca0f=>({..._0x42ca0f,'turnoverUSDT':Math['round'](_0x42ca0f[_0xa5ed7f(0x176)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x42ca0f[_0xa5ed7f(0x160)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0xa5ed7f(0xec)](_0x42ca0f[_0xa5ed7f(0x17e)]*0x64)/0x64,'averageCommissionRate':Math['round'](_0x42ca0f[_0xa5ed7f(0x16b)]*0x64)/0x64})),'merchantBreakdown':_0x2aada0[_0xa5ed7f(0x196)]?undefined:Object[_0xa5ed7f(0xb9)](_0x23ce12)['map'](_0x16f294=>({..._0x16f294,'turnoverUSDT':Math[_0xa5ed7f(0xec)](_0x16f294['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0xa5ed7f(0xec)](_0x16f294['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0xa5ed7f(0xec)](_0x16f294[_0xa5ed7f(0x17e)]*0x64)/0x64,'paidOutUSDT':Math[_0xa5ed7f(0xec)](_0x16f294[_0xa5ed7f(0x125)]*0x64)/0x64,'averageCheckUSDT':Math['round'](_0x16f294[_0xa5ed7f(0x105)]*0x64)/0x64})),'dailyData':Object[_0xa5ed7f(0xb9)](_0x5b65ee)['map'](_0x3ae736=>({..._0x3ae736,'turnover':Math[_0xa5ed7f(0xec)](_0x3ae736[_0xa5ed7f(0x1a1)]*0x64)/0x64,'merchantEarnings':Math[_0xa5ed7f(0xec)](_0x3ae736[_0xa5ed7f(0xea)]*0x64)/0x64,'gatewayEarnings':Math[_0xa5ed7f(0xec)](_0x3ae736['gatewayEarnings']*0x64)/0x64}))['sort']((_0x523d97,_0x409cfa)=>_0x523d97[_0xa5ed7f(0x1bd)]['localeCompare'](_0x409cfa[_0xa5ed7f(0x1bd)])),'periodInfo':{'from':_0x52f054,'to':_0x5aa731,'periodType':_0x2aada0[_0xa5ed7f(0x14e)]||_0xa5ed7f(0x10c),'daysCount':_0x1065fc}};return console['log'](_0xa5ed7f(0xc6)),console[_0xa5ed7f(0x16c)]('\x20\x20\x20💰\x20Total\x20turnover:\x20'+_0x5d5082[_0xa5ed7f(0x185)]+'\x20USDT'),console['log'](_0xa5ed7f(0x18a)+_0x5d5082['merchantEarnings']+_0xa5ed7f(0x1ca)),console['log'](_0xa5ed7f(0x1c9)+_0x5d5082[_0xa5ed7f(0x1d8)]+_0xa5ed7f(0x1ca)),console[_0xa5ed7f(0x16c)](_0xa5ed7f(0xbb)+_0x5d5082['totalPayments']),_0x5d5082;}async[a35_0x5767a8(0x16d)](){const _0xf3271a=a35_0x5767a8;console['log'](_0xf3271a(0x10a));const _0x579ecd=await database_1[_0xf3271a(0x172)]['shop'][_0xf3271a(0x193)]({'where':{'status':_0xf3271a(0x159)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0xf3271a(0x1a7)}});return console[_0xf3271a(0x16c)](_0xf3271a(0xf6)+_0x579ecd[_0xf3271a(0x113)]+'\x20active\x20merchants\x20for\x20selection'),_0x579ecd['map'](_0x39a7ab=>({'id':_0x39a7ab['id'],'username':_0x39a7ab['username'],'name':_0x39a7ab[_0xf3271a(0xd3)]}));}[a35_0x5767a8(0xcf)](_0x5ac728){const _0x47bc21=a35_0x5767a8,_0x1a46e9={'test_gateway':_0x47bc21(0x1dc),'plisio':'Plisio','rapyd':_0x47bc21(0x135),'noda':_0x47bc21(0xc7),'cointopay':'CoinToPay','cointopay2':_0x47bc21(0x1a5),'klyme_eu':_0x47bc21(0xfb),'klyme_gb':'KLYME\x20GB','klyme_de':_0x47bc21(0x14c),'mastercard':_0x47bc21(0x101)};return _0x1a46e9[_0x5ac728]||_0x5ac728;}[a35_0x5767a8(0xfa)](_0x18dab5){const _0x4728aa=a35_0x5767a8,_0x174a28={'Test\x20Gateway':_0x4728aa(0x15a),'Plisio':_0x4728aa(0xfc),'Rapyd':'rapyd','Noda':'noda','CoinToPay':'cointopay','CoinToPay2':_0x4728aa(0x156),'KLYME\x20EU':_0x4728aa(0xc3),'KLYME\x20GB':_0x4728aa(0x1b1),'KLYME\x20DE':_0x4728aa(0x1c0),'MasterCard':_0x4728aa(0x144)};return _0x174a28[_0x18dab5]||_0x18dab5[_0x4728aa(0x1a2)]();}async[a35_0x5767a8(0x137)](_0x2efdeb){const _0x1dca13=a35_0x5767a8,{page:_0x195f9b,limit:_0x2a9b1d,minAmount:_0x3f9dfb,search:_0xd0674e}=_0x2efdeb,_0x42f017=(_0x195f9b-0x1)*_0x2a9b1d;console[_0x1dca13(0x16c)](_0x1dca13(0x12d),_0x2efdeb);const _0x312494={'balance':{'gt':0x0},'status':_0x1dca13(0x159)};_0x3f9dfb&&(_0x312494[_0x1dca13(0xe0)][_0x1dca13(0xc8)]=_0x3f9dfb);_0xd0674e&&(_0x312494['OR']=[{'name':{'contains':_0xd0674e,'mode':_0x1dca13(0xf2)}},{'username':{'contains':_0xd0674e,'mode':'insensitive'}}]);const [_0x3f8c86,_0x392dd4]=await Promise[_0x1dca13(0x1c6)]([database_1['default'][_0x1dca13(0xc0)][_0x1dca13(0x193)]({'where':_0x312494,'skip':_0x42f017,'take':_0x2a9b1d,'orderBy':{'balance':_0x1dca13(0x130)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1[_0x1dca13(0x172)][_0x1dca13(0xc0)][_0x1dca13(0x1e5)]({'where':_0x312494})]);console[_0x1dca13(0x16c)](_0x1dca13(0x184)+_0x3f8c86[_0x1dca13(0x113)]+_0x1dca13(0xba));const _0xe4fc08=await Promise['all'](_0x3f8c86['map'](async _0x53c8a0=>{const _0xc7d9bd=_0x1dca13,[_0x2815ef,_0x3b7290,_0x22442d]=await Promise[_0xc7d9bd(0x1c6)]([database_1[_0xc7d9bd(0x172)][_0xc7d9bd(0xf8)]['count']({'where':{'shopId':_0x53c8a0['id'],'status':_0xc7d9bd(0xe7),'gateway':{'not':'test_gateway'}}}),database_1[_0xc7d9bd(0x172)]['payment'][_0xc7d9bd(0x1d5)]({'where':{'shopId':_0x53c8a0['id'],'status':_0xc7d9bd(0xe7),'gateway':{'not':_0xc7d9bd(0x15a)}},'orderBy':{'paidAt':_0xc7d9bd(0x1a7)},'select':{'paidAt':!![]}}),database_1['default'][_0xc7d9bd(0xf8)]['groupBy']({'by':[_0xc7d9bd(0x112)],'where':{'shopId':_0x53c8a0['id'],'status':_0xc7d9bd(0xe7),'gateway':{'not':_0xc7d9bd(0x15a)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x38c3af=new Date(),_0x5eeada=new Date(_0x38c3af['getFullYear'](),_0x38c3af[_0xc7d9bd(0xe4)](),0x1),_0x20d44e=new Date(_0x38c3af['getFullYear'](),_0x38c3af['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x58c490,_0xf7bb37]=await Promise[_0xc7d9bd(0x1c6)]([database_1[_0xc7d9bd(0x172)][_0xc7d9bd(0x1d0)]['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x53c8a0['id'],'status':'COMPLETED'}}),database_1[_0xc7d9bd(0x172)]['payout'][_0xc7d9bd(0x199)]({'_sum':{'amount':!![]},'where':{'shopId':_0x53c8a0['id'],'status':_0xc7d9bd(0x119),'createdAt':{'gte':_0x5eeada,'lte':_0x20d44e}}})]),_0x5f11df=_0x58c490[_0xc7d9bd(0x17d)]['amount']||0x0,_0x237506=_0xf7bb37[_0xc7d9bd(0x17d)][_0xc7d9bd(0x166)]||0x0,_0x23c4a8=await Promise[_0xc7d9bd(0x1c6)](_0x22442d[_0xc7d9bd(0xdd)](async _0x5a5ea6=>{const _0x55d7cb=_0xc7d9bd;let _0x56de54=0xa;if(_0x53c8a0[_0x55d7cb(0x15d)])try{const _0x531c41=JSON[_0x55d7cb(0x1d3)](_0x53c8a0['gatewaySettings']);for(const [_0x48bd86,_0x3e6851]of Object[_0x55d7cb(0x1ba)](_0x531c41)){if(_0x48bd86[_0x55d7cb(0x1a2)]()===_0x5a5ea6[_0x55d7cb(0x112)][_0x55d7cb(0x1a2)]()){_0x56de54=_0x3e6851[_0x55d7cb(0xef)]||0xa,console[_0x55d7cb(0x16c)](_0x55d7cb(0x1c8)+_0x5a5ea6['gateway']+_0x55d7cb(0x1a6)+_0x53c8a0['id']+_0x55d7cb(0x13c)+_0x56de54+'%');break;}}}catch(_0xfcd74c){console[_0x55d7cb(0x1de)](_0x55d7cb(0x140)+_0x53c8a0['id']+':',_0xfcd74c);}const _0x1734dc=_0x5a5ea6[_0x55d7cb(0x17d)][_0x55d7cb(0x11e)]||0x0,_0x323955=_0x1734dc*(0x1-_0x56de54/0x64);return{'gateway':_0x5a5ea6[_0x55d7cb(0x112)],'count':_0x5a5ea6[_0x55d7cb(0x17c)]['id'],'amountUSDT':Math[_0x55d7cb(0xec)](_0x1734dc*0x64)/0x64,'amountAfterCommissionUSDT':Math['round'](_0x323955*0x64)/0x64,'commission':_0x56de54};})),_0xdf0d1a=_0x23c4a8[_0xc7d9bd(0x187)]((_0x1d0350,_0x3f8919)=>_0x1d0350+_0x3f8919[_0xc7d9bd(0x11e)],0x0),_0x52d468=_0x53c8a0[_0xc7d9bd(0xe0)];return console['log']('💰\x20[PAYOUT]\x20Merchant\x20'+_0x53c8a0[_0xc7d9bd(0x165)]+':'),console[_0xc7d9bd(0x16c)]('\x20\x20\x20�\x20Total\x20payments\x20turnover:\x20'+_0xdf0d1a[_0xc7d9bd(0xf1)](0x2)+_0xc7d9bd(0x115)),console[_0xc7d9bd(0x16c)]('\x20\x20\x20🔍\x20Calculated\x20after\x20commission:\x20'+_0x23c4a8[_0xc7d9bd(0x187)]((_0x18fe96,_0x36f1ed)=>_0x18fe96+_0x36f1ed[_0xc7d9bd(0xd6)],0x0)[_0xc7d9bd(0xf1)](0x2)+_0xc7d9bd(0xed)),console[_0xc7d9bd(0x16c)](_0xc7d9bd(0xfe)+_0x52d468[_0xc7d9bd(0xf1)](0x2)+_0xc7d9bd(0x1db)),{'id':_0x53c8a0['id'],'fullName':_0x53c8a0[_0xc7d9bd(0xd3)],'username':_0x53c8a0['username'],'telegramId':_0x53c8a0[_0xc7d9bd(0x116)],'merchantUrl':_0x53c8a0[_0xc7d9bd(0x1b0)],'wallets':{'usdtPolygonWallet':_0x53c8a0['usdtPolygonWallet'],'usdtTrcWallet':_0x53c8a0['usdtTrcWallet'],'usdtErcWallet':_0x53c8a0[_0xc7d9bd(0x133)],'usdcPolygonWallet':_0x53c8a0['usdcPolygonWallet']},'totalAmountUSDT':Math[_0xc7d9bd(0xec)](_0xdf0d1a*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0xc7d9bd(0xec)](_0x52d468*0x64)/0x64,'totalPayout':Math['round'](_0x5f11df*0x64)/0x64,'thisMonth':Math['round'](_0x237506*0x64)/0x64,'paymentsCount':_0x2815ef,'oldestPaymentDate':_0x3b7290?.['paidAt']||_0x53c8a0[_0xc7d9bd(0x11d)],'gatewayBreakdown':_0x23c4a8};})),_0x39868c=_0xe4fc08['reduce']((_0x4af471,_0x557539)=>_0x4af471+_0x557539['totalAmountUSDT'],0x0),_0x1afd07=_0xe4fc08['reduce']((_0x30caa5,_0x414557)=>_0x30caa5+_0x414557[_0x1dca13(0x178)],0x0),_0x17784b=_0xe4fc08[_0x1dca13(0x187)]((_0x54e143,_0x501ed8)=>_0x54e143+_0x501ed8[_0x1dca13(0x1e2)],0x0),_0x3fc727=_0xe4fc08['reduce']((_0x87316,_0x31b9f9)=>_0x87316+_0x31b9f9[_0x1dca13(0xe1)],0x0);return console[_0x1dca13(0x16c)]('📊\x20Merchants\x20awaiting\x20payout:\x20'+_0x392dd4+_0x1dca13(0x11c)),console['log'](_0x1dca13(0x103)+Math['round'](_0x39868c*0x64)/0x64+_0x1dca13(0x115)),console['log'](_0x1dca13(0x1a4)+Math[_0x1dca13(0xec)](_0x1afd07*0x64)/0x64+_0x1dca13(0x18c)),console[_0x1dca13(0x16c)]('\x20\x20\x20💸\x20Total\x20payouts\x20(all\x20time):\x20'+Math[_0x1dca13(0xec)](_0x17784b*0x64)/0x64+'\x20USDT'),console[_0x1dca13(0x16c)]('\x20\x20\x20📅\x20Total\x20payouts\x20(this\x20month):\x20'+Math[_0x1dca13(0xec)](_0x3fc727*0x64)/0x64+_0x1dca13(0x1ca)),{'merchants':_0xe4fc08,'pagination':{'page':_0x195f9b,'limit':_0x2a9b1d,'total':_0x392dd4,'totalPages':Math[_0x1dca13(0x10d)](_0x392dd4/_0x2a9b1d)},'summary':{'totalMerchants':_0x392dd4,'totalAmountUSDT':Math[_0x1dca13(0xec)](_0x39868c*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x1dca13(0xec)](_0x1afd07*0x64)/0x64,'totalPayout':Math[_0x1dca13(0xec)](_0x17784b*0x64)/0x64,'thisMonth':Math[_0x1dca13(0xec)](_0x3fc727*0x64)/0x64}};}async['createPayout'](_0x1b1edd){const _0x183704=a35_0x5767a8,{shopId:_0x1af252,amount:_0x1cbe43,network:_0x222934,wallet:_0x2cd80c,notes:_0x19cfc0,txid:_0x525c59,periodFrom:_0x2afeea,periodTo:_0x2c8c3a}=_0x1b1edd,_0x1a64ae=await database_1[_0x183704(0x172)]['$transaction'](async _0x567ea5=>{const _0x2e3499=_0x183704,_0x2914fa=await _0x567ea5[_0x2e3499(0xc0)]['findUnique']({'where':{'id':_0x1af252},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x2914fa)throw new Error(_0x2e3499(0x124));console[_0x2e3499(0x16c)]('💰\x20Creating\x20payout\x20for\x20shop\x20'+_0x2914fa[_0x2e3499(0x165)]+':'),console['log'](_0x2e3499(0x1cb)+_0x2914fa[_0x2e3499(0xe0)][_0x2e3499(0xf1)](0x6)+_0x2e3499(0x1ca)),console['log'](_0x2e3499(0x15f)+_0x1cbe43[_0x2e3499(0xf1)](0x6)+'\x20USDT'),console[_0x2e3499(0x16c)](_0x2e3499(0x1e4)+_0x2914fa[_0x2e3499(0x155)]['toFixed'](0x6)+_0x2e3499(0x1ca));if(_0x525c59)console['log'](_0x2e3499(0x1b7)+_0x525c59);if(_0x2914fa[_0x2e3499(0xe0)]<_0x1cbe43)throw new Error(_0x2e3499(0x192)+_0x2914fa['balance'][_0x2e3499(0xf1)](0x6)+'\x20USDT,\x20Requested:\x20'+_0x1cbe43[_0x2e3499(0xf1)](0x6)+_0x2e3499(0x1ca));let _0x4393e6=_0x2cd80c;if(!_0x4393e6){const _0x4edb70=await _0x567ea5[_0x2e3499(0xc0)][_0x2e3499(0x17a)]({'where':{'id':_0x1af252},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x4edb70)switch(_0x222934){case _0x2e3499(0xf4):_0x4393e6=_0x4edb70['usdtPolygonWallet']||undefined;break;case _0x2e3499(0xdc):_0x4393e6=_0x4edb70['usdtTrcWallet']||undefined;break;case _0x2e3499(0xf3):_0x4393e6=_0x4edb70['usdtErcWallet']||undefined;break;case _0x2e3499(0x12a):_0x4393e6=_0x4edb70[_0x2e3499(0xc4)]||undefined;break;}}console[_0x2e3499(0x16c)](_0x2e3499(0x1e3)+_0x222934+':\x20'+(_0x4393e6||_0x2e3499(0x11f)));const _0x1ac34c=await _0x567ea5['payout'][_0x2e3499(0x107)]({'data':{'shopId':_0x1af252,'amount':_0x1cbe43,'network':_0x222934,'status':_0x2e3499(0x119),'txid':_0x525c59,'notes':_0x19cfc0,'periodFrom':_0x2afeea?new Date(_0x2afeea):null,'periodTo':_0x2c8c3a?new Date(_0x2c8c3a):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x307d96=_0x2914fa[_0x2e3499(0xe0)]-_0x1cbe43,_0xa64db7=_0x2914fa[_0x2e3499(0x155)]+_0x1cbe43;return await _0x567ea5[_0x2e3499(0xc0)]['update']({'where':{'id':_0x1af252},'data':{'balance':_0x307d96,'totalPaidOut':_0xa64db7}}),console['log']('💰\x20Shop\x20'+_0x2914fa[_0x2e3499(0x165)]+_0x2e3499(0xd7)),console[_0x2e3499(0x16c)](_0x2e3499(0xce)+_0x2914fa[_0x2e3499(0xe0)][_0x2e3499(0xf1)](0x6)+'\x20->\x20'+_0x307d96[_0x2e3499(0xf1)](0x6)+_0x2e3499(0xf5)+_0x1cbe43[_0x2e3499(0xf1)](0x6)+')'),console['log'](_0x2e3499(0xeb)+_0x2914fa[_0x2e3499(0x155)]['toFixed'](0x6)+_0x2e3499(0x10f)+_0xa64db7['toFixed'](0x6)+_0x2e3499(0xd4)+_0x1cbe43['toFixed'](0x6)+')'),{'payout':_0x1ac34c,'shop':_0x2914fa};});return console['log'](_0x183704(0xda)+_0x1a64ae['payout']['id']+_0x183704(0x1a6)+_0x1a64ae[_0x183704(0xc0)]['username']+'\x20('+_0x1cbe43+_0x183704(0x1a3)),{'id':_0x1a64ae['payout']['id'],'shopId':_0x1a64ae[_0x183704(0x1d0)][_0x183704(0x196)],'shopName':_0x1a64ae[_0x183704(0xc0)][_0x183704(0xd3)],'shopUsername':_0x1a64ae['shop'][_0x183704(0x165)],'amount':_0x1a64ae[_0x183704(0x1d0)]['amount'],'network':_0x1a64ae[_0x183704(0x1d0)][_0x183704(0x1c7)],'status':_0x1a64ae[_0x183704(0x1d0)][_0x183704(0xc5)],'txid':_0x1a64ae['payout']['txid'],'notes':_0x1a64ae[_0x183704(0x1d0)]['notes'],'periodFrom':_0x1a64ae['payout'][_0x183704(0x143)],'periodTo':_0x1a64ae[_0x183704(0x1d0)]['periodTo'],'createdAt':_0x1a64ae[_0x183704(0x1d0)][_0x183704(0x11d)],'paidAt':_0x1a64ae[_0x183704(0x1d0)][_0x183704(0x15b)]};}async[a35_0x5767a8(0x13d)](_0x51faa3){const _0x3cbf82=a35_0x5767a8,{page:_0x1928f9,limit:_0x55a555,shopId:_0x5d80a6,network:_0x535e13,dateFrom:_0x567afa,dateTo:_0x143309,search:_0x2598d8}=_0x51faa3,_0x4e4edc=(_0x1928f9-0x1)*_0x55a555,_0x1dad32={};_0x5d80a6&&(_0x1dad32[_0x3cbf82(0x196)]=_0x5d80a6);_0x535e13&&(_0x1dad32[_0x3cbf82(0x1c7)]=_0x535e13);(_0x567afa||_0x143309)&&(_0x1dad32['createdAt']={},_0x567afa&&(_0x1dad32[_0x3cbf82(0x11d)][_0x3cbf82(0xc8)]=new Date(_0x567afa)),_0x143309&&(_0x1dad32['createdAt'][_0x3cbf82(0x12c)]=new Date(_0x143309)));_0x2598d8&&(_0x1dad32['OR']=[{'shop':{'name':{'contains':_0x2598d8,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x2598d8,'mode':'insensitive'}}},{'notes':{'contains':_0x2598d8,'mode':_0x3cbf82(0xf2)}}]);const [_0x48bda2,_0x89f2de]=await Promise[_0x3cbf82(0x1c6)]([database_1['default'][_0x3cbf82(0x1d0)]['findMany']({'where':_0x1dad32,'skip':_0x4e4edc,'take':_0x55a555,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x3cbf82(0x172)][_0x3cbf82(0x1d0)]['count']({'where':_0x1dad32})]);return{'payouts':_0x48bda2['map'](_0x148a6a=>({'id':_0x148a6a['id'],'shopId':_0x148a6a[_0x3cbf82(0x196)],'shopName':_0x148a6a[_0x3cbf82(0xc0)][_0x3cbf82(0xd3)],'shopUsername':_0x148a6a[_0x3cbf82(0xc0)][_0x3cbf82(0x165)],'amount':_0x148a6a[_0x3cbf82(0x166)],'network':_0x148a6a[_0x3cbf82(0x1c7)],'status':_0x148a6a['status'],'txid':_0x148a6a[_0x3cbf82(0x109)],'notes':_0x148a6a[_0x3cbf82(0xbd)],'periodFrom':_0x148a6a[_0x3cbf82(0x143)],'periodTo':_0x148a6a[_0x3cbf82(0xbf)],'createdAt':_0x148a6a[_0x3cbf82(0x11d)],'paidAt':_0x148a6a[_0x3cbf82(0x15b)]})),'pagination':{'page':_0x1928f9,'limit':_0x55a555,'total':_0x89f2de,'totalPages':Math[_0x3cbf82(0x10d)](_0x89f2de/_0x55a555)}};}async[a35_0x5767a8(0x16a)](_0x566c29){const _0x45a9a5=a35_0x5767a8,_0x3dab65=await database_1[_0x45a9a5(0x172)]['payout'][_0x45a9a5(0x17a)]({'where':{'id':_0x566c29},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x3dab65)return null;return{'id':_0x3dab65['id'],'shopId':_0x3dab65['shopId'],'shopName':_0x3dab65[_0x45a9a5(0xc0)]['name'],'shopUsername':_0x3dab65[_0x45a9a5(0xc0)][_0x45a9a5(0x165)],'amount':_0x3dab65[_0x45a9a5(0x166)],'network':_0x3dab65['network'],'status':_0x3dab65[_0x45a9a5(0xc5)],'txid':_0x3dab65[_0x45a9a5(0x109)],'notes':_0x3dab65[_0x45a9a5(0xbd)],'periodFrom':_0x3dab65[_0x45a9a5(0x143)],'periodTo':_0x3dab65['periodTo'],'createdAt':_0x3dab65[_0x45a9a5(0x11d)],'paidAt':_0x3dab65[_0x45a9a5(0x15b)]};}async[a35_0x5767a8(0x1d6)](_0x211b8e){const _0x40d3ca=a35_0x5767a8;await database_1['default'][_0x40d3ca(0x1d0)][_0x40d3ca(0xdb)]({'where':{'id':_0x211b8e}});}async[a35_0x5767a8(0xf7)](_0x1e491d){const _0x30a097=a35_0x5767a8,{page:_0x419930,limit:_0x411541,status:_0x16c0bf,gateway:_0x48b304,shopId:_0x28540d,dateFrom:_0x50b1db,dateTo:_0x3eaed0,search:_0x263d61,currency:_0x519dd7,sortBy:_0x43bb8e,sortOrder:_0xfaa808}=_0x1e491d,_0x41dfda=(_0x419930-0x1)*_0x411541;console[_0x30a097(0x16c)](_0x30a097(0xd8),_0x1e491d);const _0xc1b72a=await database_1['default']['payment'][_0x30a097(0x10b)]({'by':[_0x30a097(0x112)],'_count':{'gateway':!![]}});console[_0x30a097(0x16c)](_0x30a097(0x1c5),_0xc1b72a[_0x30a097(0xdd)](_0x4ec5b1=>_0x4ec5b1['gateway']+'\x20('+_0x4ec5b1[_0x30a097(0x17c)][_0x30a097(0x112)]+_0x30a097(0x18f)));if(_0x48b304){const _0x39e8c6=_0xc1b72a[_0x30a097(0x1cf)](_0x10938e=>_0x10938e[_0x30a097(0x112)][_0x30a097(0x1a2)]()===_0x48b304[_0x30a097(0x1a2)]());!_0x39e8c6&&_0x48b304[_0x30a097(0x1a2)]()!==_0x30a097(0x15a)&&console[_0x30a097(0x16c)](_0x30a097(0x1b8)+_0x48b304+_0x30a097(0x173)+_0xc1b72a[_0x30a097(0xdd)](_0xfd891f=>_0xfd891f[_0x30a097(0x112)])[_0x30a097(0x1d9)](',\x20'));}const _0x40fd82={};_0x16c0bf&&(_0x40fd82[_0x30a097(0xc5)]=_0x16c0bf[_0x30a097(0x13a)]());if(!_0x48b304)_0x40fd82[_0x30a097(0x112)]={'not':_0x30a097(0x15a)};else{if(_0x48b304&&(_0x48b304[_0x30a097(0x1a2)]()===_0x30a097(0x15a)||_0x48b304==='0000'))_0x40fd82[_0x30a097(0x112)]='test_gateway';else{let _0x3e85d6=_0x48b304;const _0x2f175f=(0x0,gateway_1[_0x30a097(0x188)])(_0x48b304);if(_0x2f175f)_0x3e85d6=_0x2f175f,console['log'](_0x30a097(0x123)+_0x48b304+_0x30a097(0x179)+_0x3e85d6+'\x27');else{const _0x1c740d=(0x0,gateway_1[_0x30a097(0x136)])(_0x48b304);if(_0x1c740d){const _0x335393=(0x0,gateway_1[_0x30a097(0x188)])(_0x1c740d);_0x335393&&(_0x3e85d6=_0x335393,console['log'](_0x30a097(0x1a8)+_0x48b304+_0x30a097(0xee)+_0x1c740d+_0x30a097(0xd0)+_0x3e85d6+'\x27'));}else console[_0x30a097(0x16c)](_0x30a097(0xe3)+_0x48b304+'\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)');}const _0x184557=await database_1[_0x30a097(0x172)]['payment'][_0x30a097(0x1e5)]({'where':{'gateway':_0x3e85d6[_0x30a097(0x1a2)]()},'take':0x1});_0x184557===0x0?(console[_0x30a097(0x16c)](_0x30a097(0xc2)+_0x3e85d6+_0x30a097(0xf9)+_0x48b304+_0x30a097(0x122)),_0x40fd82['gateway']='NONEXISTENT_GATEWAY_FILTER'):(_0x40fd82[_0x30a097(0x112)]=_0x3e85d6[_0x30a097(0x1a2)](),console[_0x30a097(0x16c)](_0x30a097(0x174)+_0x3e85d6+_0x30a097(0xf9)+_0x48b304+'\x27)'));}}console['log'](_0x30a097(0xcd),_0x40fd82[_0x30a097(0x112)]);_0x28540d&&(_0x40fd82[_0x30a097(0x196)]=_0x28540d);_0x519dd7&&(_0x40fd82[_0x30a097(0x139)]=_0x519dd7[_0x30a097(0x13a)](),console[_0x30a097(0x16c)](_0x30a097(0x120)+_0x519dd7[_0x30a097(0x13a)]()));(_0x50b1db||_0x3eaed0)&&(_0x40fd82['createdAt']={},_0x50b1db&&(_0x40fd82['createdAt'][_0x30a097(0xc8)]=new Date(_0x50b1db)),_0x3eaed0&&(_0x40fd82[_0x30a097(0x11d)][_0x30a097(0x12c)]=new Date(_0x3eaed0)));_0x263d61&&(_0x40fd82['OR']=[{'id':{'contains':_0x263d61,'mode':_0x30a097(0xf2)}},{'orderId':{'contains':_0x263d61,'mode':_0x30a097(0xf2)}},{'gatewayOrderId':{'contains':_0x263d61,'mode':_0x30a097(0xf2)}},{'customerEmail':{'contains':_0x263d61,'mode':'insensitive'}},{'shop':{'name':{'contains':_0x263d61,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x263d61,'mode':'insensitive'}}}]);console[_0x30a097(0x16c)](_0x30a097(0x175),JSON['stringify'](_0x40fd82,null,0x2));let _0x6d8f0f={'createdAt':_0x30a097(0x130)};if(_0x43bb8e){const _0x43f02b=[_0x30a097(0x166),_0x30a097(0x11d),_0x30a097(0xf0),_0x30a097(0xc5),'gateway',_0x30a097(0x139)],_0x5610e8=[_0x30a097(0x1a7),_0x30a097(0x130)];if(_0x43f02b[_0x30a097(0x1e1)](_0x43bb8e)){const _0x2d8c85=_0x5610e8['includes'](_0xfaa808)?_0xfaa808:_0x30a097(0x130);_0x6d8f0f={[_0x43bb8e]:_0x2d8c85},console[_0x30a097(0x16c)](_0x30a097(0xcc)+_0x43bb8e+_0x30a097(0x14f)+_0x2d8c85+_0x30a097(0x177));}}const [_0x3928d5,_0x300cdf]=await Promise[_0x30a097(0x1c6)]([database_1['default'][_0x30a097(0xf8)][_0x30a097(0x193)]({'where':_0x40fd82,'skip':_0x41dfda,'take':_0x411541,'orderBy':_0x6d8f0f,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x30a097(0x172)][_0x30a097(0xf8)]['count']({'where':_0x40fd82})]);return{'payments':_0x3928d5,'pagination':{'page':_0x419930,'limit':_0x411541,'total':_0x300cdf,'totalPages':Math[_0x30a097(0x10d)](_0x300cdf/_0x411541)}};}async[a35_0x5767a8(0xe9)](_0x27d387){const _0x39aca2=a35_0x5767a8,_0x43d3ff=await database_1[_0x39aca2(0x172)]['payment'][_0x39aca2(0x17a)]({'where':{'id':_0x27d387},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x43d3ff)return null;return{'id':_0x43d3ff['id'],'shopId':_0x43d3ff[_0x39aca2(0x196)],'gateway':_0x43d3ff['gateway'],'amount':_0x43d3ff[_0x39aca2(0x166)],'currency':_0x43d3ff['currency'],'status':_0x43d3ff[_0x39aca2(0xc5)],'orderId':_0x43d3ff['orderId'],'gatewayOrderId':_0x43d3ff['gatewayOrderId'],'customerEmail':_0x43d3ff[_0x39aca2(0xca)],'customerName':_0x43d3ff[_0x39aca2(0x14b)],'customerCountry':_0x43d3ff[_0x39aca2(0x1b4)],'customerIp':_0x43d3ff[_0x39aca2(0x1a9)],'customerUa':_0x43d3ff[_0x39aca2(0x1b6)],'failureMessage':_0x43d3ff[_0x39aca2(0x1b3)],'externalPaymentUrl':_0x43d3ff[_0x39aca2(0x13e)],'successUrl':_0x43d3ff[_0x39aca2(0x195)],'failUrl':_0x43d3ff['failUrl'],'pendingUrl':_0x43d3ff[_0x39aca2(0xd9)],'whiteUrl':_0x43d3ff[_0x39aca2(0x142)],'createdAt':_0x43d3ff['createdAt'],'updatedAt':_0x43d3ff[_0x39aca2(0xf0)],'shop':_0x43d3ff[_0x39aca2(0xc0)]};}async[a35_0x5767a8(0x198)](_0x42309b,_0x1ecf04,_0x449e25,_0x1a9869){const _0x3f62c0=a35_0x5767a8,_0x4fb6a4=await database_1['default'][_0x3f62c0(0x1d2)](async _0xec7463=>{const _0x5ca953=_0x3f62c0,_0x48e712=await _0xec7463['payment'][_0x5ca953(0x17a)]({'where':{'id':_0x42309b},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x48e712)throw new Error('Payment\x20not\x20found');const _0x8d07d4=_0x48e712['status'],_0x59767f=_0x1ecf04[_0x5ca953(0x13a)]();console[_0x5ca953(0x16c)](_0x5ca953(0x141)+_0x42309b+_0x5ca953(0xdf)+_0x8d07d4+'\x20->\x20'+_0x59767f),console[_0x5ca953(0x16c)](_0x5ca953(0xe8)+_0x48e712[_0x5ca953(0xc0)]['balance']+_0x5ca953(0x1ca));const _0x4d8f9f={'status':_0x59767f,'updatedAt':new Date(),'statusChangedBy':_0x5ca953(0x108),'statusChangedAt':new Date()};_0x449e25&&(_0x4d8f9f[_0x5ca953(0xd5)]=_0x449e25);_0x59767f===_0x5ca953(0x1c3)&&_0x1a9869&&(_0x4d8f9f[_0x5ca953(0x1df)]=_0x1a9869);let _0x4e6f30=0x0,_0x467116=_0x48e712[_0x5ca953(0xc0)]['balance'];if(_0x59767f===_0x5ca953(0xe7)&&_0x8d07d4!==_0x5ca953(0xe7)){_0x4d8f9f[_0x5ca953(0x15b)]=new Date();const _0x3caff9=await currencyService_1[_0x5ca953(0x189)]['convertToUSDT'](_0x48e712[_0x5ca953(0x166)],_0x48e712['currency']);_0x4d8f9f[_0x5ca953(0x11e)]=_0x3caff9;let _0x3ab5f3=0xa;const _0x40b2aa=await _0xec7463[_0x5ca953(0xc0)][_0x5ca953(0x17a)]({'where':{'id':_0x48e712[_0x5ca953(0x196)]},'select':{'gatewaySettings':!![]}});if(_0x40b2aa?.[_0x5ca953(0x15d)])try{const _0x5a7c1f=JSON[_0x5ca953(0x1d3)](_0x40b2aa[_0x5ca953(0x15d)]);for(const [_0x496179,_0x5cc7e2]of Object['entries'](_0x5a7c1f)){if(_0x496179[_0x5ca953(0x1a2)]()===_0x48e712[_0x5ca953(0x112)]['toLowerCase']()){_0x3ab5f3=_0x5cc7e2[_0x5ca953(0xef)]||0xa;break;}}}catch(_0xcb2193){console['error']('Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20'+_0x42309b+':',_0xcb2193);}const _0xbf49fa=_0x3caff9*(0x1-_0x3ab5f3/0x64);_0x4e6f30=_0xbf49fa,_0x467116+=_0xbf49fa,console['log'](_0x5ca953(0x110)+_0x42309b+_0x5ca953(0x134)),console[_0x5ca953(0x16c)](_0x5ca953(0x190)+_0x3caff9[_0x5ca953(0xf1)](0x6)+_0x5ca953(0x1ca)),console[_0x5ca953(0x16c)](_0x5ca953(0x145)+_0x48e712['gateway']+_0x5ca953(0xff)+_0x3ab5f3+'%'),console[_0x5ca953(0x16c)](_0x5ca953(0x126)+_0xbf49fa['toFixed'](0x6)+_0x5ca953(0x162)+_0x3ab5f3+_0x5ca953(0x16e)),console[_0x5ca953(0x16c)](_0x5ca953(0x1af)+_0xbf49fa['toFixed'](0x6)+_0x5ca953(0x1ca));}else{if(_0x8d07d4===_0x5ca953(0xe7)&&_0x59767f!==_0x5ca953(0xe7)){if(_0x48e712['amountUSDT']){let _0x4b9cca=0xa;const _0x533f8e=await _0xec7463[_0x5ca953(0xc0)][_0x5ca953(0x17a)]({'where':{'id':_0x48e712[_0x5ca953(0x196)]},'select':{'gatewaySettings':!![]}});if(_0x533f8e?.[_0x5ca953(0x15d)])try{const _0x59ab1f=JSON[_0x5ca953(0x1d3)](_0x533f8e['gatewaySettings']);for(const [_0x9311ee,_0x1597d8]of Object[_0x5ca953(0x1ba)](_0x59ab1f)){if(_0x9311ee[_0x5ca953(0x1a2)]()===_0x48e712[_0x5ca953(0x112)]['toLowerCase']()){_0x4b9cca=_0x1597d8[_0x5ca953(0xef)]||0xa;break;}}}catch(_0x13e99e){console[_0x5ca953(0x1de)](_0x5ca953(0xbc)+_0x42309b+':',_0x13e99e);}const _0x21467=_0x48e712[_0x5ca953(0x11e)]*(0x1-_0x4b9cca/0x64);_0x4e6f30=-_0x21467,_0x467116-=_0x21467,_0x4d8f9f['amountUSDT']=null,console[_0x5ca953(0x16c)](_0x5ca953(0x110)+_0x42309b+'\x20no\x20longer\x20PAID:'),console[_0x5ca953(0x16c)](_0x5ca953(0x190)+_0x48e712[_0x5ca953(0x11e)][_0x5ca953(0xf1)](0x6)+_0x5ca953(0x1ca)),console[_0x5ca953(0x16c)](_0x5ca953(0x145)+_0x48e712[_0x5ca953(0x112)]+_0x5ca953(0xff)+_0x4b9cca+'%'),console[_0x5ca953(0x16c)](_0x5ca953(0x11a)+_0x21467[_0x5ca953(0xf1)](0x6)+_0x5ca953(0x162)+_0x4b9cca+_0x5ca953(0x16e)),console[_0x5ca953(0x16c)](_0x5ca953(0x1ae)+_0x21467['toFixed'](0x6)+'\x20USDT');}}}_0x59767f===_0x5ca953(0x1c3)&&(_0x8d07d4===_0x5ca953(0xe7)&&_0x48e712['amountUSDT']&&console['log'](_0x5ca953(0xcb)),_0x1a9869&&_0x1a9869>0x0&&(_0x4e6f30-=_0x1a9869,_0x467116-=_0x1a9869,console[_0x5ca953(0x16c)](_0x5ca953(0x1ad)+_0x1a9869['toFixed'](0x6)+_0x5ca953(0x1d1))));_0x59767f===_0x5ca953(0x170)&&_0x8d07d4===_0x5ca953(0xe7)&&console[_0x5ca953(0x16c)]('🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance');const _0x5ea03b=await _0xec7463[_0x5ca953(0xf8)][_0x5ca953(0x169)]({'where':{'id':_0x42309b},'data':_0x4d8f9f,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x4e6f30!==0x0&&(await _0xec7463[_0x5ca953(0xc0)][_0x5ca953(0x169)]({'where':{'id':_0x48e712['shopId']},'data':{'balance':_0x467116}}),console[_0x5ca953(0x16c)]('💰\x20Shop\x20'+_0x48e712['shopId']+_0x5ca953(0x13f)+_0x48e712[_0x5ca953(0xc0)][_0x5ca953(0xe0)][_0x5ca953(0xf1)](0x6)+_0x5ca953(0x10f)+_0x467116[_0x5ca953(0xf1)](0x6)+_0x5ca953(0x1cd)+(_0x4e6f30>0x0?'+':'')+_0x4e6f30[_0x5ca953(0xf1)](0x6)+')')),_0x5ea03b;});return{'id':_0x4fb6a4['id'],'shopId':_0x4fb6a4[_0x3f62c0(0x196)],'gateway':_0x4fb6a4[_0x3f62c0(0x112)],'amount':_0x4fb6a4[_0x3f62c0(0x166)],'currency':_0x4fb6a4[_0x3f62c0(0x139)],'status':_0x4fb6a4[_0x3f62c0(0xc5)],'orderId':_0x4fb6a4[_0x3f62c0(0x14a)],'gatewayOrderId':_0x4fb6a4[_0x3f62c0(0x194)],'customerEmail':_0x4fb6a4[_0x3f62c0(0xca)],'customerName':_0x4fb6a4[_0x3f62c0(0x14b)],'customerCountry':_0x4fb6a4['customerCountry'],'customerIp':_0x4fb6a4[_0x3f62c0(0x1a9)],'customerUa':_0x4fb6a4[_0x3f62c0(0x1b6)],'failureMessage':_0x4fb6a4[_0x3f62c0(0x1b3)],'adminNotes':_0x4fb6a4[_0x3f62c0(0xd5)],'chargebackAmount':_0x4fb6a4[_0x3f62c0(0x1df)],'statusChangedBy':_0x4fb6a4[_0x3f62c0(0x153)],'statusChangedAt':_0x4fb6a4['statusChangedAt'],'createdAt':_0x4fb6a4[_0x3f62c0(0x11d)],'updatedAt':_0x4fb6a4[_0x3f62c0(0xf0)],'shop':_0x4fb6a4[_0x3f62c0(0xc0)]};}async[a35_0x5767a8(0x19a)](_0x975d85,_0x32494b){const _0x4fca88=a35_0x5767a8,_0x4322eb={..._0x32494b};_0x32494b[_0x4fca88(0x191)]&&(_0x4322eb[_0x4fca88(0x191)]=await bcryptjs_1['default']['hash'](_0x32494b[_0x4fca88(0x191)],0xc));_0x32494b['fullName']&&(_0x4322eb['name']=_0x32494b[_0x4fca88(0x1dd)],delete _0x4322eb[_0x4fca88(0x1dd)]);_0x32494b['telegramId']&&(_0x4322eb[_0x4fca88(0x116)]=_0x32494b[_0x4fca88(0x1b5)],delete _0x4322eb[_0x4fca88(0x1b5)]);_0x32494b[_0x4fca88(0x161)]&&(_0x4322eb[_0x4fca88(0x1b0)]=_0x32494b[_0x4fca88(0x161)],delete _0x4322eb['merchantUrl']);if(_0x32494b[_0x4fca88(0x12e)]){const _0x51b673=_0x32494b[_0x4fca88(0x12e)][_0x4fca88(0xdd)](_0x4a28e1=>this[_0x4fca88(0xfa)](_0x4a28e1));console['log']('🔄\x20Gateway\x20mapping:',_0x32494b[_0x4fca88(0x12e)],'->',_0x51b673),_0x4322eb[_0x4fca88(0x186)]=JSON[_0x4fca88(0x1da)](_0x51b673),delete _0x4322eb[_0x4fca88(0x12e)];}_0x32494b['gatewaySettings']&&(_0x4322eb[_0x4fca88(0x15d)]=JSON[_0x4fca88(0x1da)](_0x32494b[_0x4fca88(0x15d)]),delete _0x4322eb[_0x4fca88(0x15d)]);_0x32494b[_0x4fca88(0x154)]&&(_0x32494b['wallets']['usdtPolygonWallet']!==undefined&&(_0x4322eb['usdtPolygonWallet']=_0x32494b[_0x4fca88(0x154)][_0x4fca88(0x1d7)]||null),_0x32494b[_0x4fca88(0x154)][_0x4fca88(0x19f)]!==undefined&&(_0x4322eb[_0x4fca88(0x19f)]=_0x32494b[_0x4fca88(0x154)][_0x4fca88(0x19f)]||null),_0x32494b[_0x4fca88(0x154)][_0x4fca88(0x133)]!==undefined&&(_0x4322eb[_0x4fca88(0x133)]=_0x32494b[_0x4fca88(0x154)]['usdtErcWallet']||null),_0x32494b[_0x4fca88(0x154)][_0x4fca88(0xc4)]!==undefined&&(_0x4322eb[_0x4fca88(0xc4)]=_0x32494b['wallets']['usdcPolygonWallet']||null),delete _0x4322eb['wallets']);const _0xa49e23=await database_1[_0x4fca88(0x172)]['shop'][_0x4fca88(0x169)]({'where':{'id':_0x975d85},'data':_0x4322eb,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0xa49e23['id'],'fullName':_0xa49e23[_0x4fca88(0xd3)],'username':_0xa49e23[_0x4fca88(0x165)],'telegramId':_0xa49e23[_0x4fca88(0x116)],'merchantUrl':_0xa49e23[_0x4fca88(0x1b0)],'gateways':_0xa49e23[_0x4fca88(0x186)]?JSON[_0x4fca88(0x1d3)](_0xa49e23[_0x4fca88(0x186)]):null,'gatewaySettings':_0xa49e23[_0x4fca88(0x15d)]?JSON[_0x4fca88(0x1d3)](_0xa49e23[_0x4fca88(0x15d)]):null,'publicKey':_0xa49e23['publicKey'],'wallets':{'usdtPolygonWallet':_0xa49e23[_0x4fca88(0x1d7)],'usdtTrcWallet':_0xa49e23[_0x4fca88(0x19f)],'usdtErcWallet':_0xa49e23[_0x4fca88(0x133)],'usdcPolygonWallet':_0xa49e23[_0x4fca88(0xc4)]},'status':_0xa49e23['status'],'createdAt':_0xa49e23['createdAt']};}async[a35_0x5767a8(0x15c)](_0x6d27d3){const _0x4c4ec1=a35_0x5767a8,_0x52e7f8=await database_1['default'][_0x4c4ec1(0xc0)][_0x4c4ec1(0x169)]({'where':{'id':_0x6d27d3},'data':{'status':'SUSPENDED'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x52e7f8['id'],'fullName':_0x52e7f8[_0x4c4ec1(0xd3)],'username':_0x52e7f8[_0x4c4ec1(0x165)],'telegramId':_0x52e7f8['telegram'],'merchantUrl':_0x52e7f8[_0x4c4ec1(0x1b0)],'gateways':_0x52e7f8[_0x4c4ec1(0x186)]?JSON[_0x4c4ec1(0x1d3)](_0x52e7f8[_0x4c4ec1(0x186)]):null,'gatewaySettings':_0x52e7f8[_0x4c4ec1(0x15d)]?JSON['parse'](_0x52e7f8[_0x4c4ec1(0x15d)]):null,'publicKey':_0x52e7f8[_0x4c4ec1(0xd2)],'wallets':{'usdtPolygonWallet':_0x52e7f8[_0x4c4ec1(0x1d7)],'usdtTrcWallet':_0x52e7f8[_0x4c4ec1(0x19f)],'usdtErcWallet':_0x52e7f8[_0x4c4ec1(0x133)],'usdcPolygonWallet':_0x52e7f8['usdcPolygonWallet']},'status':_0x52e7f8[_0x4c4ec1(0xc5)],'createdAt':_0x52e7f8[_0x4c4ec1(0x11d)]};}async[a35_0x5767a8(0x1a0)](_0xa12090){const _0x5f137d=a35_0x5767a8,_0x2ef25b=await database_1[_0x5f137d(0x172)][_0x5f137d(0xc0)][_0x5f137d(0x169)]({'where':{'id':_0xa12090},'data':{'status':_0x5f137d(0x159)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2ef25b['id'],'fullName':_0x2ef25b['name'],'username':_0x2ef25b[_0x5f137d(0x165)],'telegramId':_0x2ef25b[_0x5f137d(0x116)],'merchantUrl':_0x2ef25b['shopUrl'],'gateways':_0x2ef25b['paymentGateways']?JSON[_0x5f137d(0x1d3)](_0x2ef25b['paymentGateways']):null,'gatewaySettings':_0x2ef25b[_0x5f137d(0x15d)]?JSON[_0x5f137d(0x1d3)](_0x2ef25b['gatewaySettings']):null,'publicKey':_0x2ef25b['publicKey'],'wallets':{'usdtPolygonWallet':_0x2ef25b['usdtPolygonWallet'],'usdtTrcWallet':_0x2ef25b['usdtTrcWallet'],'usdtErcWallet':_0x2ef25b[_0x5f137d(0x133)],'usdcPolygonWallet':_0x2ef25b[_0x5f137d(0xc4)]},'status':_0x2ef25b[_0x5f137d(0xc5)],'createdAt':_0x2ef25b[_0x5f137d(0x11d)]};}async[a35_0x5767a8(0xd1)](_0xcc240f){const _0x244f13=a35_0x5767a8,{page:_0x1bebe8,limit:_0x2f1654,status:_0x2d2032}=_0xcc240f,_0x54061c=(_0x1bebe8-0x1)*_0x2f1654,_0x3f24c5={};_0x2d2032&&(_0x3f24c5[_0x244f13(0xc5)]=_0x2d2032['toUpperCase']());const [_0x2077b4,_0x334789]=await Promise['all']([database_1[_0x244f13(0x172)][_0x244f13(0xc0)]['findMany']({'where':_0x3f24c5,'skip':_0x54061c,'take':_0x2f1654,'orderBy':{'createdAt':_0x244f13(0x130)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x244f13(0x172)]['shop']['count']({'where':_0x3f24c5})]);return{'users':_0x2077b4['map'](_0x2b29f2=>{const _0x4a0030=_0x244f13,_0x38289b=_0x2b29f2['paymentGateways']?JSON[_0x4a0030(0x1d3)](_0x2b29f2[_0x4a0030(0x186)]):null,_0x63fdd=_0x38289b?_0x38289b[_0x4a0030(0xdd)](_0x32a3fb=>this[_0x4a0030(0xcf)](_0x32a3fb)):null;return{'id':_0x2b29f2['id'],'fullName':_0x2b29f2[_0x4a0030(0xd3)],'username':_0x2b29f2[_0x4a0030(0x165)],'telegramId':_0x2b29f2[_0x4a0030(0x116)],'merchantUrl':_0x2b29f2[_0x4a0030(0x1b0)],'gateways':_0x63fdd,'gatewaySettings':_0x2b29f2['gatewaySettings']?JSON[_0x4a0030(0x1d3)](_0x2b29f2['gatewaySettings']):null,'publicKey':_0x2b29f2['publicKey'],'wallets':{'usdtPolygonWallet':_0x2b29f2[_0x4a0030(0x1d7)],'usdtTrcWallet':_0x2b29f2[_0x4a0030(0x19f)],'usdtErcWallet':_0x2b29f2['usdtErcWallet'],'usdcPolygonWallet':_0x2b29f2[_0x4a0030(0xc4)]},'status':_0x2b29f2[_0x4a0030(0xc5)],'createdAt':_0x2b29f2[_0x4a0030(0x11d)]};}),'pagination':{'page':_0x1bebe8,'limit':_0x2f1654,'total':_0x334789,'totalPages':Math[_0x244f13(0x10d)](_0x334789/_0x2f1654)}};}async[a35_0x5767a8(0x1b2)](_0x5c302e){const _0x20ca94=a35_0x5767a8,_0x23869c=await database_1['default'][_0x20ca94(0xc0)]['findUnique']({'where':{'id':_0x5c302e},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x23869c)return null;const _0x458f2d=_0x23869c[_0x20ca94(0x186)]?JSON['parse'](_0x23869c[_0x20ca94(0x186)]):null,_0x4a4c07=_0x458f2d?_0x458f2d['map'](_0x44617a=>this[_0x20ca94(0xcf)](_0x44617a)):null;return _0x458f2d&&_0x4a4c07&&console[_0x20ca94(0x16c)](_0x20ca94(0x138),_0x458f2d,'->',_0x4a4c07),{'id':_0x23869c['id'],'fullName':_0x23869c[_0x20ca94(0xd3)],'username':_0x23869c['username'],'telegramId':_0x23869c[_0x20ca94(0x116)],'merchantUrl':_0x23869c['shopUrl'],'gateways':_0x4a4c07,'gatewaySettings':_0x23869c[_0x20ca94(0x15d)]?JSON['parse'](_0x23869c[_0x20ca94(0x15d)]):null,'publicKey':_0x23869c[_0x20ca94(0xd2)],'wallets':{'usdtPolygonWallet':_0x23869c[_0x20ca94(0x1d7)],'usdtTrcWallet':_0x23869c[_0x20ca94(0x19f)],'usdtErcWallet':_0x23869c[_0x20ca94(0x133)],'usdcPolygonWallet':_0x23869c[_0x20ca94(0xc4)]},'status':_0x23869c['status'],'createdAt':_0x23869c[_0x20ca94(0x11d)]};}async['createUser'](_0x26a5b4){const _0x8a7f05=a35_0x5767a8,{fullName:_0x1e760b,username:_0x1a0375,password:_0x516248,telegramId:_0x1b9822,merchantUrl:_0x1cc36b,gateways:_0x16ac55,gatewaySettings:_0x4d09e7,wallets:_0x2e93c6}=_0x26a5b4,_0x260f19=await database_1['default'][_0x8a7f05(0xc0)][_0x8a7f05(0x17a)]({'where':{'username':_0x1a0375}});if(_0x260f19)throw new Error(_0x8a7f05(0x121));if(_0x1b9822){const _0x7adf72=await database_1[_0x8a7f05(0x172)]['shop'][_0x8a7f05(0x17a)]({'where':{'telegram':_0x1b9822}});if(_0x7adf72)throw new Error('Telegram\x20username\x20already\x20exists');}const _0x3e5488=await bcryptjs_1[_0x8a7f05(0x172)][_0x8a7f05(0x16f)](_0x516248,0xc),_0x5295d6=_0x8a7f05(0x150)+crypto_1[_0x8a7f05(0x172)][_0x8a7f05(0x15e)](0x20)[_0x8a7f05(0x11b)]('hex'),_0x4826a9=_0x8a7f05(0x131)+crypto_1[_0x8a7f05(0x172)]['randomBytes'](0x20)[_0x8a7f05(0x11b)](_0x8a7f05(0x157)),_0x1b3b78=_0x16ac55?_0x16ac55[_0x8a7f05(0xdd)](_0x5e1df1=>this[_0x8a7f05(0xfa)](_0x5e1df1)):null;_0x16ac55&&_0x1b3b78&&console[_0x8a7f05(0x16c)](_0x8a7f05(0xfd),_0x16ac55,'->',_0x1b3b78);const _0xe7039c=await database_1[_0x8a7f05(0x172)][_0x8a7f05(0xc0)][_0x8a7f05(0x107)]({'data':{'name':_0x1e760b,'username':_0x1a0375,'password':_0x3e5488,'telegram':_0x1b9822,'shopUrl':_0x1cc36b,'paymentGateways':_0x1b3b78?JSON[_0x8a7f05(0x1da)](_0x1b3b78):null,'gatewaySettings':_0x4d09e7?JSON['stringify'](_0x4d09e7):null,'usdtPolygonWallet':_0x2e93c6?.['usdtPolygonWallet']||null,'usdtTrcWallet':_0x2e93c6?.[_0x8a7f05(0x19f)]||null,'usdtErcWallet':_0x2e93c6?.[_0x8a7f05(0x133)]||null,'usdcPolygonWallet':_0x2e93c6?.[_0x8a7f05(0xc4)]||null,'publicKey':_0x5295d6,'secretKey':_0x4826a9,'status':_0x8a7f05(0x159)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0xe7039c['id'],'fullName':_0xe7039c[_0x8a7f05(0xd3)],'username':_0xe7039c[_0x8a7f05(0x165)],'telegramId':_0xe7039c[_0x8a7f05(0x116)],'merchantUrl':_0xe7039c[_0x8a7f05(0x1b0)],'gateways':_0xe7039c[_0x8a7f05(0x186)]?JSON[_0x8a7f05(0x1d3)](_0xe7039c[_0x8a7f05(0x186)]):null,'gatewaySettings':_0xe7039c[_0x8a7f05(0x15d)]?JSON[_0x8a7f05(0x1d3)](_0xe7039c[_0x8a7f05(0x15d)]):null,'publicKey':_0xe7039c['publicKey'],'wallets':{'usdtPolygonWallet':_0xe7039c[_0x8a7f05(0x1d7)],'usdtTrcWallet':_0xe7039c['usdtTrcWallet'],'usdtErcWallet':_0xe7039c['usdtErcWallet'],'usdcPolygonWallet':_0xe7039c[_0x8a7f05(0xc4)]},'status':_0xe7039c[_0x8a7f05(0xc5)],'createdAt':_0xe7039c[_0x8a7f05(0x11d)]};}async[a35_0x5767a8(0x197)](_0x38ba5d){const _0x57e2ec=a35_0x5767a8;await database_1[_0x57e2ec(0x172)][_0x57e2ec(0xc0)][_0x57e2ec(0xdb)]({'where':{'id':_0x38ba5d}});}[a35_0x5767a8(0x180)](_0x1085c1,_0x531717,_0x3f92b9){const _0x57b263=a35_0x5767a8,_0x244bbe=new Map(),_0x294279=new Date(_0x531717);while(_0x294279<=_0x3f92b9){const _0xbc8535=_0x294279[_0x57b263(0x1d4)]()[_0x57b263(0x164)]('T')[0x0];_0x244bbe['set'](_0xbc8535,{'revenue':0x0,'count':0x0}),_0x294279['setDate'](_0x294279[_0x57b263(0x104)]()+0x1);}for(const _0x143ccf of _0x1085c1){const _0x9ae513=_0x143ccf['createdAt'][_0x57b263(0x1d4)]()['split']('T')[0x0],_0x344676=_0x244bbe['get'](_0x9ae513);_0x344676&&(_0x344676['count']+=0x1,_0x143ccf[_0x57b263(0xc5)]===_0x57b263(0xe7)&&(_0x143ccf['amountUSDT']?_0x344676[_0x57b263(0x1bc)]+=_0x143ccf['amountUSDT']:console['log'](_0x57b263(0xc1)+_0x143ccf['id']+_0x57b263(0x17f))));}const _0x3ffc8b=[],_0x14ea2a=[];for(const [_0x4dfc3e,_0x5b6f20]of _0x244bbe){_0x3ffc8b[_0x57b263(0x1e0)]({'date':_0x4dfc3e,'amount':Math[_0x57b263(0xec)](_0x5b6f20['revenue']*0x64)/0x64}),_0x14ea2a[_0x57b263(0x1e0)]({'date':_0x4dfc3e,'count':_0x5b6f20[_0x57b263(0x1e5)]});}return{'dailyRevenue':_0x3ffc8b,'dailyPayments':_0x14ea2a};}}exports['AdminService']=AdminService;