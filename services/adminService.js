'use strict';const a33_0x42ee18=a33_0x56f7;(function(_0x2d6543,_0x513db5){const _0x1aff0c=a33_0x56f7,_0x5c3a5a=_0x2d6543();while(!![]){try{const _0x1d5984=-parseInt(_0x1aff0c(0x116))/0x1+-parseInt(_0x1aff0c(0xa3))/0x2+-parseInt(_0x1aff0c(0xa8))/0x3*(-parseInt(_0x1aff0c(0x88))/0x4)+-parseInt(_0x1aff0c(0x90))/0x5+parseInt(_0x1aff0c(0x112))/0x6*(parseInt(_0x1aff0c(0x13b))/0x7)+-parseInt(_0x1aff0c(0xa7))/0x8*(parseInt(_0x1aff0c(0x96))/0x9)+parseInt(_0x1aff0c(0x141))/0xa;if(_0x1d5984===_0x513db5)break;else _0x5c3a5a['push'](_0x5c3a5a['shift']());}catch(_0x329ac2){_0x5c3a5a['push'](_0x5c3a5a['shift']());}}}(a33_0x58fb,0xc4c0f));var __importDefault=this&&this[a33_0x42ee18(0x10c)]||function(_0x54122a){const _0x33c49d=a33_0x42ee18;return _0x54122a&&_0x54122a[_0x33c49d(0x115)]?_0x54122a:{'default':_0x54122a};};Object[a33_0x42ee18(0x105)](exports,a33_0x42ee18(0x115),{'value':!![]}),exports[a33_0x42ee18(0x109)]=void 0x0;function a33_0x58fb(){const _0x1dd0a1=['createdAt','\x20USDT\x20via\x20','gte','‚úÖ\x20Found\x20payment:\x20','shop','statusChangedAt','‚ùå\x20Payment\x20not\x20found:\x20','Error\x20parsing\x20gateway\x20settings:','delete','../types/gateway','getPayoutStats','orderId','üìã\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','deleteUser','availableBalance','\x20USDT','payoutDelay','payment','../config/database','publicKey','gateway','./currencyService','üë•\x20Total\x20users:\x20','suspendUser','\x20payments\x20as\x20paid\x20out','findMany','‚úÖ\x20Found\x20payout:\x20','getSystemStatistics','amount','getAllUsers','sort','usdcPolygonWallet','shopUrl','expiresAt','90d','telegram','üìä\x20Daily\x20revenue\x20entries:\x20',',\x20amount:\x20','chargebackAmount','Failed\x20to\x20send\x20Telegram\x20payout\x20notification:','toLowerCase','usdtErcWallet','thisMonth','amountUSDT','‚úÖ\x20Marked\x20','getMerchantsAwaitingPayout','gatewayPaymentId','üìä\x20Found\x20','‚úÖ\x20Payout\x20','bankId','üìä\x20Generating\x20admin\x20statistics\x20for\x20period:\x20','markPaymentsAsPaidOut','totalAmountUSDT','getMonth','\x20eligible\x20PAID\x20payments\x20for\x20payout\x20analysis','‚úÖ\x20Payout\x20created\x20successfully:\x20','getPayoutById','lte','COMPLETED','currency','\x20total','REFUND','Shop\x20not\x20found','asc','$queryRaw','\x20activated\x20successfully','üìà\x20Average\x20payment:\x20','set','\x20USDT\x20(','getPaymentById','üîç\x20Getting\x20payout\x20by\x20ID:\x20','includes','notes','üíµ\x20Total\x20revenue:\x20','all','Payout\x20not\x20found','createUser','abs','has','üìä\x20Calculating\x20admin\x20payout\x20statistics...','defineProperty','getAllPayments','‚úÖ\x20User\x20','customerEmail','AdminService','gatewayOrderId','slice','__importDefault','desc','\x20deleted\x20successfully','awaitingPayout','date','merchantPaid','6PAXsaF','./telegramBotService','calculateEffectiveAmount','__esModule','1456325nqiCdQ','toFixed','paidAt','PROCESSING','CHARGEBACK','length','EXPIRED','\x20USDT\x20(will\x20be\x20deducted\x20from\x20merchant\x20balance)','cardLast4','\x20payouts\x20out\x20of\x20','externalPaymentUrl','payout','üí∏\x20Chargeback\x20amount:\x20','ACTIVE','setDate','amountAfterCommissionUSDT','toUpperCase','webhookLogs','generateDateRange','calculateAmountAfterCommission','getAllPayouts','FAILED','SUSPENDED','getPeriodDays','commission','adminNotes','\x20days)','status_update','completed','findUnique','‚úÖ\x20Payout\x20statistics\x20calculated:','üîÑ\x20Updating\x20payment\x20','\x20payments\x20out\x20of\x20','userService','count','\x20users\x20out\x20of\x20','üìÖ\x20This\x20Month:\x20','2510389xqYZvw','default','customerName','‚úÖ\x20Returning\x20','üí∏\x20Chargeback\x20penalty:\x20','usdtPolygonWallet','20825120WHCcxw','Invalid\x20status.\x20Valid\x20statuses:\x20','isValidGatewayId','isEligibleForPayout','Chargeback\x20amount\x20is\x20required\x20and\x20must\x20be\x20positive\x20(amount\x20in\x20USDT)','Shop\x20is\x20not\x20active','name','shopId','\x20USDT\x20(penalty\x20amount)','gatewaySettings','\x20payments\x20for\x20analysis\x20(PAID/REFUND/CHARGEBACK)','üóëÔ∏è\x20Deleting\x20payout:\x20','payments','\x20suspended\x20successfully','User\x20is\x20already\x20active','log','usage','‚ùå\x20Payout\x20not\x20found:\x20','txid','üí≥\x20Total\x20payments:\x20','\x20merchants\x20out\x20of\x20','‚úÖ\x20Admin\x20statistics\x20generated\x20successfully','parse','split','sourceCurrency','convertToUSDT','Payment\x20not\x20found','4753928BSiyOt','getFullYear','status','updatedAt','\x20USDT\x20(–≤–∫–ª—é—á–∞—è\x20—à—Ç—Ä–∞—Ñ—ã\x20chargeback)','remitterName','statusChangedBy','üí∞\x20Found\x20','731680RldBIK','create','\x20payments\x20for\x20revenue\x20calculation\x20(PAID/REFUND/CHARGEBACK)','üîç\x20Getting\x20payment\x20by\x20ID:\x20','insensitive','push','783QmpChQ','getUserById','activateUser','get','network','PAID','ceil','error','paymentGateways','\x20to\x20','getGatewaySettings','totalAmountAfterCommissionUSDT','join','2203038KkKHgT','getDate','reduce','map','10992jKAKJL','3cmvPtA','entries','currencyService','round','charAt','PENDING','stringify','üí∏\x20Total\x20Payout:\x20','toISOString','updateMany','\x20merchants\x20with\x20eligible\x20PAID\x20payments','username','getGatewayNameById'];a33_0x58fb=function(){return _0x1dd0a1;};return a33_0x58fb();}const database_1=__importDefault(require(a33_0x42ee18(0xc7))),currencyService_1=require(a33_0x42ee18(0xca)),userService_1=require('./userService'),telegramBotService_1=require(a33_0x42ee18(0x113)),gateway_1=require(a33_0x42ee18(0xbe));function a33_0x56f7(_0x45950b,_0x119d48){const _0x58fb0f=a33_0x58fb();return a33_0x56f7=function(_0x56f7d3,_0x1e412a){_0x56f7d3=_0x56f7d3-0x72;let _0x1f9efd=_0x58fb0f[_0x56f7d3];return _0x1f9efd;},a33_0x56f7(_0x45950b,_0x119d48);}class AdminService{constructor(){const _0x3de4a1=a33_0x42ee18;this[_0x3de4a1(0x137)]=new userService_1['UserService']();}[a33_0x42ee18(0x12d)](_0x2d2c03){const _0x206351=a33_0x42ee18;switch(_0x2d2c03){case'7d':return 0x7;case'30d':return 0x1e;case _0x206351(0xd7):return 0x5a;case'1y':return 0x16d;default:return 0x1e;}}[a33_0x42ee18(0x128)](_0x4267f6,_0x12ea25){const _0x1f04fc=a33_0x42ee18,_0x52218e=[],_0x297aa1=new Date(_0x4267f6);while(_0x297aa1<=_0x12ea25){_0x52218e[_0x1f04fc(0x95)](_0x297aa1[_0x1f04fc(0xb0)]()[_0x1f04fc(0x84)]('T')[0x0]),_0x297aa1[_0x1f04fc(0x124)](_0x297aa1['getDate']()+0x1);}return _0x52218e;}['getGatewaySettings'](_0x3ad333,_0x35952f){const _0x5d58f2=a33_0x42ee18;if(!_0x3ad333['gatewaySettings'])return{'commission':0x0,'payoutDelay':0x0};try{const _0x3ba999=JSON[_0x5d58f2(0x83)](_0x3ad333[_0x5d58f2(0x76)]),_0x576c8e=_0x35952f[_0x5d58f2(0xac)](0x0)[_0x5d58f2(0x126)]()+_0x35952f[_0x5d58f2(0x10b)](0x1)[_0x5d58f2(0xdd)]();if(_0x3ba999&&_0x3ba999[_0x576c8e])return{'commission':_0x3ba999[_0x576c8e][_0x5d58f2(0x12e)]||0x0,'payoutDelay':_0x3ba999[_0x576c8e][_0x5d58f2(0xc5)]||0x0};}catch(_0x7bba7d){console[_0x5d58f2(0x9d)](_0x5d58f2(0xbc),_0x7bba7d);}return{'commission':0x0,'payoutDelay':0x0};}[a33_0x42ee18(0x144)](_0x5c8377){const _0xbfb42e=a33_0x42ee18;if(_0x5c8377[_0xbfb42e(0x8a)]!==_0xbfb42e(0x9b)||_0x5c8377[_0xbfb42e(0x111)]||!_0x5c8377[_0xbfb42e(0x118)])return![];const _0x584e7b=this['getGatewaySettings'](_0x5c8377['shop'],_0x5c8377['gateway']),_0x514995=_0x584e7b[_0xbfb42e(0xc5)]*0x18*0x3c*0x3c*0x3e8,_0x21f051=new Date(_0x5c8377[_0xbfb42e(0x118)]['getTime']()+_0x514995);return new Date()>_0x21f051;}[a33_0x42ee18(0x129)](_0x5c1391,_0x18f1d8){return _0x5c1391*(0x1-_0x18f1d8/0x64);}[a33_0x42ee18(0x114)](_0x1c62f1){const _0x5d2989=a33_0x42ee18;switch(_0x1c62f1[_0x5d2989(0x8a)]){case'PAID':return _0x1c62f1['amount'];case'CHARGEBACK':return-(_0x1c62f1[_0x5d2989(0xdb)]||0x0);case _0x5d2989(0xf2):return 0x0;default:return 0x0;}}async['createPayout'](_0x1d7550){const _0xf12f83=a33_0x42ee18,{shopId:_0x5f0219,amount:_0x256bca,network:_0x3f16aa,notes:_0x43b947}=_0x1d7550;console[_0xf12f83(0x7c)]('üí∏\x20Creating\x20payout\x20for\x20shop\x20'+_0x5f0219+':\x20'+_0x256bca+'\x20USDT\x20via\x20'+_0x3f16aa);const _0x15a744=await database_1[_0xf12f83(0x13c)][_0xf12f83(0xb9)][_0xf12f83(0x133)]({'where':{'id':_0x5f0219},'select':{'id':!![],'name':!![],'username':!![],'status':!![]}});if(!_0x15a744)throw new Error(_0xf12f83(0xf3));if(_0x15a744[_0xf12f83(0x8a)]!=='ACTIVE')throw new Error(_0xf12f83(0x72));const _0x3dcfda=await database_1[_0xf12f83(0x13c)][_0xf12f83(0x121)][_0xf12f83(0x91)]({'data':{'shopId':_0x5f0219,'amount':_0x256bca,'network':_0x3f16aa,'status':_0xf12f83(0xef),'notes':_0x43b947||null,'paidAt':new Date()},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});await this[_0xf12f83(0xe8)](_0x5f0219,_0x256bca);try{await telegramBotService_1['telegramBotService']['sendPayoutNotification'](_0x5f0219,_0x3dcfda,_0xf12f83(0x132));}catch(_0xc91c43){console['error'](_0xf12f83(0xdc),_0xc91c43);}return console[_0xf12f83(0x7c)](_0xf12f83(0xec)+_0x3dcfda['id']),{'id':_0x3dcfda['id'],'shopId':_0x3dcfda[_0xf12f83(0x74)],'shopName':_0x3dcfda[_0xf12f83(0xb9)][_0xf12f83(0x73)],'shopUsername':_0x3dcfda[_0xf12f83(0xb9)][_0xf12f83(0xb3)],'amount':_0x3dcfda[_0xf12f83(0xd1)],'network':_0x3dcfda[_0xf12f83(0x9a)],'status':_0x3dcfda[_0xf12f83(0x8a)],'txid':_0x3dcfda[_0xf12f83(0x7f)],'notes':_0x3dcfda[_0xf12f83(0xfd)],'createdAt':_0x3dcfda['createdAt'],'paidAt':_0x3dcfda[_0xf12f83(0x118)]};}async['markPaymentsAsPaidOut'](_0x556e1b,_0x81c593){const _0x1b0696=a33_0x42ee18;console[_0x1b0696(0x7c)]('üîÑ\x20Marking\x20payments\x20as\x20paid\x20out\x20for\x20shop\x20'+_0x556e1b+_0x1b0696(0xda)+_0x81c593+'\x20USDT');const _0x5e5f8d=await database_1['default'][_0x1b0696(0xc6)]['findMany']({'where':{'shopId':_0x556e1b,'status':_0x1b0696(0x9b),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'shop':{'select':{'gatewaySettings':!![]}}},'orderBy':{'paidAt':_0x1b0696(0xf4)}});let _0x3df1d7=_0x81c593;const _0x389c93=[];for(const _0x2f6e11 of _0x5e5f8d){const _0x58dddf={..._0x2f6e11,'status':_0x1b0696(0x9b),'merchantPaid':![],'shop':{'gatewaySettings':_0x2f6e11['shop'][_0x1b0696(0x76)]}};if(!this[_0x1b0696(0x144)](_0x58dddf))continue;const _0x401978=await currencyService_1[_0x1b0696(0xaa)][_0x1b0696(0x86)](_0x2f6e11[_0x1b0696(0xd1)],_0x2f6e11['currency']),_0x1e3766=this['getGatewaySettings'](_0x2f6e11['shop'],_0x2f6e11['gateway']),_0x91d1ae=this[_0x1b0696(0x129)](_0x401978,_0x1e3766['commission']);if(_0x91d1ae<=_0x3df1d7){_0x389c93[_0x1b0696(0x95)](_0x2f6e11['id']),_0x3df1d7-=_0x91d1ae;if(_0x3df1d7<=0.01)break;}}_0x389c93['length']>0x0&&(await database_1[_0x1b0696(0x13c)]['payment'][_0x1b0696(0xb1)]({'where':{'id':{'in':_0x389c93}},'data':{'merchantPaid':!![]}}),console['log'](_0x1b0696(0xe1)+_0x389c93[_0x1b0696(0x11b)]+_0x1b0696(0xcd)));}async[a33_0x42ee18(0x12a)](_0x5b408e){const _0x4bd977=a33_0x42ee18,{page:_0x2c7aca,limit:_0xb66ec7,shopId:_0x38b498,network:_0x1064a1,dateFrom:_0x3bec19,dateTo:_0x527c52,search:_0x1e40c5}=_0x5b408e,_0x2aeebe=(_0x2c7aca-0x1)*_0xb66ec7;console[_0x4bd977(0x7c)]('üìã\x20Getting\x20payouts\x20with\x20filters:',_0x5b408e);const _0x15350f={};_0x38b498&&(_0x15350f['shopId']=_0x38b498);_0x1064a1&&(_0x15350f[_0x4bd977(0x9a)]=_0x1064a1);(_0x3bec19||_0x527c52)&&(_0x15350f[_0x4bd977(0xb5)]={},_0x3bec19&&(_0x15350f[_0x4bd977(0xb5)][_0x4bd977(0xb7)]=new Date(_0x3bec19)),_0x527c52&&(_0x15350f[_0x4bd977(0xb5)][_0x4bd977(0xee)]=new Date(_0x527c52)));_0x1e40c5&&(_0x15350f['OR']=[{'txid':{'contains':_0x1e40c5,'mode':'insensitive'}},{'notes':{'contains':_0x1e40c5,'mode':_0x4bd977(0x94)}},{'shop':{'name':{'contains':_0x1e40c5,'mode':_0x4bd977(0x94)}}},{'shop':{'username':{'contains':_0x1e40c5,'mode':_0x4bd977(0x94)}}}]);const [_0x5335aa,_0x264130]=await Promise[_0x4bd977(0xff)]([database_1[_0x4bd977(0x13c)][_0x4bd977(0x121)][_0x4bd977(0xce)]({'where':_0x15350f,'skip':_0x2aeebe,'take':_0xb66ec7,'orderBy':{'createdAt':_0x4bd977(0x10d)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default']['payout']['count']({'where':_0x15350f})]);console[_0x4bd977(0x7c)](_0x4bd977(0xe4)+_0x5335aa[_0x4bd977(0x11b)]+_0x4bd977(0x11f)+_0x264130+_0x4bd977(0xf1));const _0x4091a4=_0x5335aa[_0x4bd977(0xa6)](_0xed437f=>({'id':_0xed437f['id'],'shopId':_0xed437f[_0x4bd977(0x74)],'shopName':_0xed437f[_0x4bd977(0xb9)][_0x4bd977(0x73)],'shopUsername':_0xed437f['shop'][_0x4bd977(0xb3)],'amount':_0xed437f[_0x4bd977(0xd1)],'network':_0xed437f[_0x4bd977(0x9a)],'status':_0xed437f['status'],'txid':_0xed437f[_0x4bd977(0x7f)],'notes':_0xed437f['notes'],'createdAt':_0xed437f[_0x4bd977(0xb5)],'paidAt':_0xed437f[_0x4bd977(0x118)]}));return{'payouts':_0x4091a4,'pagination':{'page':_0x2c7aca,'limit':_0xb66ec7,'total':_0x264130,'totalPages':Math[_0x4bd977(0x9c)](_0x264130/_0xb66ec7)}};}async[a33_0x42ee18(0xed)](_0x5446e){const _0x4150db=a33_0x42ee18;console[_0x4150db(0x7c)](_0x4150db(0xfb)+_0x5446e);const _0x527a2c=await database_1[_0x4150db(0x13c)]['payout'][_0x4150db(0x133)]({'where':{'id':_0x5446e},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x527a2c)return console[_0x4150db(0x7c)](_0x4150db(0x7e)+_0x5446e),null;return console[_0x4150db(0x7c)](_0x4150db(0xcf)+_0x527a2c['amount']+_0x4150db(0xb6)+_0x527a2c[_0x4150db(0x9a)]),{'id':_0x527a2c['id'],'shopId':_0x527a2c['shopId'],'shopName':_0x527a2c[_0x4150db(0xb9)][_0x4150db(0x73)],'shopUsername':_0x527a2c[_0x4150db(0xb9)][_0x4150db(0xb3)],'amount':_0x527a2c[_0x4150db(0xd1)],'network':_0x527a2c[_0x4150db(0x9a)],'status':_0x527a2c[_0x4150db(0x8a)],'txid':_0x527a2c[_0x4150db(0x7f)],'notes':_0x527a2c['notes'],'createdAt':_0x527a2c[_0x4150db(0xb5)],'paidAt':_0x527a2c[_0x4150db(0x118)]};}async['deletePayout'](_0x10d2e5){const _0x27b526=a33_0x42ee18;console[_0x27b526(0x7c)](_0x27b526(0x78)+_0x10d2e5);const _0x5c5fe1=await database_1[_0x27b526(0x13c)][_0x27b526(0x121)][_0x27b526(0x133)]({'where':{'id':_0x10d2e5},'select':{'id':!![],'shopId':!![],'amount':!![]}});if(!_0x5c5fe1)throw new Error(_0x27b526(0x100));await database_1['default'][_0x27b526(0x121)][_0x27b526(0xbd)]({'where':{'id':_0x10d2e5}}),console[_0x27b526(0x7c)](_0x27b526(0xe5)+_0x10d2e5+_0x27b526(0x10e));}async[a33_0x42ee18(0xe2)](_0x203870){const _0x3e28a0=a33_0x42ee18,{page:_0x58afb,limit:_0x39933e,minAmount:_0x1350bc,search:_0x464621}=_0x203870;console[_0x3e28a0(0x7c)](_0x3e28a0(0xc1),_0x203870);const _0x3c8dc0=await database_1[_0x3e28a0(0x13c)][_0x3e28a0(0xc6)][_0x3e28a0(0xce)]({'where':{'status':_0x3e28a0(0x9b),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'createdAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'gatewaySettings':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}});console['log'](_0x3e28a0(0x8f)+_0x3c8dc0['length']+_0x3e28a0(0xeb));const _0x594a63=new Map();for(const _0x1145e7 of _0x3c8dc0){const _0x2754e1={..._0x1145e7,'status':_0x3e28a0(0x9b),'merchantPaid':![],'shop':{'gatewaySettings':_0x1145e7['shop'][_0x3e28a0(0x76)]}},_0x5ba3f4=this[_0x3e28a0(0x144)](_0x2754e1);if(!_0x5ba3f4)continue;const _0x507a91=await currencyService_1['currencyService'][_0x3e28a0(0x86)](_0x1145e7[_0x3e28a0(0xd1)],_0x1145e7[_0x3e28a0(0xf0)]),_0x3b5373=this[_0x3e28a0(0xa0)](_0x1145e7['shop'],_0x1145e7[_0x3e28a0(0xc9)]),_0x8d4697=this[_0x3e28a0(0x129)](_0x507a91,_0x3b5373[_0x3e28a0(0x12e)]),_0x4b7f58=_0x1145e7[_0x3e28a0(0x74)];!_0x594a63['has'](_0x4b7f58)&&_0x594a63[_0x3e28a0(0xf8)](_0x4b7f58,{'shop':_0x1145e7[_0x3e28a0(0xb9)],'payments':[]}),_0x594a63['get'](_0x4b7f58)['payments'][_0x3e28a0(0x95)]({'id':_0x1145e7['id'],'amount':_0x1145e7[_0x3e28a0(0xd1)],'currency':_0x1145e7[_0x3e28a0(0xf0)],'gateway':_0x1145e7[_0x3e28a0(0xc9)],'paidAt':_0x1145e7[_0x3e28a0(0x118)],'createdAt':_0x1145e7[_0x3e28a0(0xb5)],'amountUSDT':_0x507a91,'commission':_0x3b5373['commission'],'amountAfterCommissionUSDT':_0x8d4697,'isEligible':!![]});}console[_0x3e28a0(0x7c)]('üè™\x20Found\x20'+_0x594a63['size']+_0x3e28a0(0xb2));const _0x4f741c=[];for(const [_0x5b7de4,_0x299453]of _0x594a63){const {shop:_0x57a5f0,payments:_0x255e0d}=_0x299453,_0x24c7f9=_0x255e0d[_0x3e28a0(0xa5)]((_0x2ced52,_0x1dd460)=>_0x2ced52+_0x1dd460[_0x3e28a0(0xe0)],0x0),_0x1c90cb=_0x255e0d['reduce']((_0x1b9ceb,_0x3740c4)=>_0x1b9ceb+_0x3740c4[_0x3e28a0(0x125)],0x0);if(_0x1350bc&&_0x1c90cb<_0x1350bc)continue;if(_0x464621){const _0x32ee84=_0x464621['toLowerCase'](),_0x2e8a31=_0x57a5f0[_0x3e28a0(0x73)][_0x3e28a0(0xdd)]()[_0x3e28a0(0xfc)](_0x32ee84)||_0x57a5f0['username'][_0x3e28a0(0xdd)]()['includes'](_0x32ee84)||_0x57a5f0[_0x3e28a0(0xd8)]&&_0x57a5f0['telegram'][_0x3e28a0(0xdd)]()[_0x3e28a0(0xfc)](_0x32ee84);if(!_0x2e8a31)continue;}const _0x5df1c8=new Map();for(const _0x47de9c of _0x255e0d){const _0x490888=_0x47de9c[_0x3e28a0(0xc9)];!_0x5df1c8[_0x3e28a0(0x103)](_0x490888)&&_0x5df1c8[_0x3e28a0(0xf8)](_0x490888,{'count':0x0,'amountUSDT':0x0,'amountAfterCommissionUSDT':0x0,'commission':_0x47de9c[_0x3e28a0(0x12e)]});const _0x56ccd2=_0x5df1c8[_0x3e28a0(0x99)](_0x490888);_0x56ccd2[_0x3e28a0(0x138)]++,_0x56ccd2[_0x3e28a0(0xe0)]+=_0x47de9c[_0x3e28a0(0xe0)],_0x56ccd2[_0x3e28a0(0x125)]+=_0x47de9c[_0x3e28a0(0x125)];}const _0x5b34fd=Array['from'](_0x5df1c8[_0x3e28a0(0xa9)]())[_0x3e28a0(0xa6)](([_0xf8c55b,_0x197565])=>({'gateway':_0xf8c55b['charAt'](0x0)[_0x3e28a0(0x126)]()+_0xf8c55b[_0x3e28a0(0x10b)](0x1),'count':_0x197565[_0x3e28a0(0x138)],'amountUSDT':Math[_0x3e28a0(0xab)](_0x197565[_0x3e28a0(0xe0)]*0x64)/0x64,'amountAfterCommissionUSDT':Math['round'](_0x197565[_0x3e28a0(0x125)]*0x64)/0x64,'commission':_0x197565[_0x3e28a0(0x12e)]})),_0x23171e=_0x255e0d[_0x3e28a0(0xa5)]((_0x2b8132,_0x312e9e)=>{const _0x17fdec=_0x3e28a0;return _0x312e9e[_0x17fdec(0x118)]<_0x2b8132?_0x312e9e[_0x17fdec(0x118)]:_0x2b8132;},_0x255e0d[0x0][_0x3e28a0(0x118)]);_0x4f741c[_0x3e28a0(0x95)]({'id':_0x57a5f0['id'],'fullName':_0x57a5f0[_0x3e28a0(0x73)],'username':_0x57a5f0['username'],'telegramId':_0x57a5f0[_0x3e28a0(0xd8)],'merchantUrl':_0x57a5f0[_0x3e28a0(0xd5)],'wallets':{'usdtPolygonWallet':_0x57a5f0[_0x3e28a0(0x140)],'usdtTrcWallet':_0x57a5f0['usdtTrcWallet'],'usdtErcWallet':_0x57a5f0[_0x3e28a0(0xde)],'usdcPolygonWallet':_0x57a5f0['usdcPolygonWallet']},'totalAmountUSDT':Math[_0x3e28a0(0xab)](_0x24c7f9*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x1c90cb*0x64)/0x64,'paymentsCount':_0x255e0d[_0x3e28a0(0x11b)],'oldestPaymentDate':_0x23171e,'gatewayBreakdown':_0x5b34fd});}_0x4f741c[_0x3e28a0(0xd3)]((_0x1c08ff,_0x3c3f1c)=>_0x3c3f1c[_0x3e28a0(0xa1)]-_0x1c08ff[_0x3e28a0(0xa1)]);const _0x17bdc8=_0x4f741c[_0x3e28a0(0x11b)],_0x1af802=_0x4f741c[_0x3e28a0(0xa5)]((_0x10973b,_0x18a46b)=>_0x10973b+_0x18a46b[_0x3e28a0(0xe9)],0x0),_0x32d96a=_0x4f741c['reduce']((_0x216129,_0x1134cc)=>_0x216129+_0x1134cc[_0x3e28a0(0xa1)],0x0),_0x5bf0ab=(_0x58afb-0x1)*_0x39933e,_0x281748=_0x4f741c[_0x3e28a0(0x10b)](_0x5bf0ab,_0x5bf0ab+_0x39933e);return console[_0x3e28a0(0x7c)](_0x3e28a0(0x13e)+_0x281748['length']+_0x3e28a0(0x81)+_0x17bdc8+'\x20total'),console[_0x3e28a0(0x7c)]('üí∞\x20Total\x20amount:\x20'+_0x1af802[_0x3e28a0(0x117)](0x2)+_0x3e28a0(0xf9)+_0x32d96a[_0x3e28a0(0x117)](0x2)+'\x20USDT\x20after\x20commission)'),{'merchants':_0x281748,'pagination':{'page':_0x58afb,'limit':_0x39933e,'total':_0x17bdc8,'totalPages':Math[_0x3e28a0(0x9c)](_0x17bdc8/_0x39933e)},'summary':{'totalMerchants':_0x17bdc8,'totalAmountUSDT':Math[_0x3e28a0(0xab)](_0x1af802*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x32d96a*0x64)/0x64}};}async[a33_0x42ee18(0xbf)](){const _0x5dc6a3=a33_0x42ee18;console[_0x5dc6a3(0x7c)](_0x5dc6a3(0x104));const _0x5ebb42=await database_1[_0x5dc6a3(0x13c)][_0x5dc6a3(0xc6)][_0x5dc6a3(0xce)]({'where':{'status':{'in':[_0x5dc6a3(0x9b),_0x5dc6a3(0xf2),_0x5dc6a3(0x11a)]}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'status':!![],'gateway':!![],'paidAt':!![],'merchantPaid':!![],'createdAt':!![],'chargebackAmount':!![],'shop':{'select':{'gatewaySettings':!![]}}}});console[_0x5dc6a3(0x7c)](_0x5dc6a3(0x8f)+_0x5ebb42[_0x5dc6a3(0x11b)]+_0x5dc6a3(0x77));const _0x23f9d8=new Date(),_0x1b9a89=new Date(_0x23f9d8[_0x5dc6a3(0x89)](),_0x23f9d8[_0x5dc6a3(0xea)](),0x1),_0x416061=new Date(_0x23f9d8['getFullYear'](),_0x23f9d8[_0x5dc6a3(0xea)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7);let _0xa73907=0x0,_0x2873e9=0x0,_0x52f5f4=0x0,_0x47c2d3=0x0;for(const _0x15dfb1 of _0x5ebb42){const _0x127814=this[_0x5dc6a3(0x114)](_0x15dfb1);if(_0x127814===0x0)continue;let _0xc2bf99,_0x2d3261;if(_0x15dfb1[_0x5dc6a3(0x8a)]===_0x5dc6a3(0x11a))_0xc2bf99=Math[_0x5dc6a3(0x102)](_0x127814),_0x2d3261=-_0xc2bf99;else{_0xc2bf99=await currencyService_1[_0x5dc6a3(0xaa)][_0x5dc6a3(0x86)](_0x15dfb1[_0x5dc6a3(0xd1)],_0x15dfb1[_0x5dc6a3(0xf0)]);const _0x239ebc=this[_0x5dc6a3(0xa0)](_0x15dfb1[_0x5dc6a3(0xb9)],_0x15dfb1[_0x5dc6a3(0xc9)]);_0x2d3261=this[_0x5dc6a3(0x129)](_0xc2bf99,_0x239ebc[_0x5dc6a3(0x12e)]);}_0x15dfb1['merchantPaid']&&(_0xa73907+=_0x2d3261,_0x15dfb1['paidAt']&&_0x15dfb1[_0x5dc6a3(0x118)]>=_0x1b9a89&&_0x15dfb1[_0x5dc6a3(0x118)]<=_0x416061&&(_0x52f5f4+=_0x2d3261)),_0x15dfb1[_0x5dc6a3(0x8a)]===_0x5dc6a3(0x9b)&&this[_0x5dc6a3(0x144)](_0x15dfb1)&&(_0x2873e9+=_0x2d3261,_0x47c2d3+=_0xc2bf99);}const _0x440d1d={'totalPayout':Math[_0x5dc6a3(0xab)](_0xa73907*0x64)/0x64,'awaitingPayout':Math[_0x5dc6a3(0xab)](_0x2873e9*0x64)/0x64,'thisMonth':Math[_0x5dc6a3(0xab)](_0x52f5f4*0x64)/0x64,'availableBalance':Math[_0x5dc6a3(0xab)](_0x47c2d3*0x64)/0x64};return console[_0x5dc6a3(0x7c)](_0x5dc6a3(0x134)),console[_0x5dc6a3(0x7c)](_0x5dc6a3(0xaf)+_0x440d1d['totalPayout']+_0x5dc6a3(0x8c)),console[_0x5dc6a3(0x7c)]('‚è≥\x20Awaiting\x20Payout:\x20'+_0x440d1d[_0x5dc6a3(0x10f)]+'\x20USDT\x20(—Ç–æ–ª—å–∫–æ\x20PAID\x20–ø–ª–∞—Ç–µ–∂–∏)'),console['log'](_0x5dc6a3(0x13a)+_0x440d1d[_0x5dc6a3(0xdf)]+_0x5dc6a3(0xc4)),console['log']('üí∞\x20Available\x20Balance:\x20'+_0x440d1d[_0x5dc6a3(0xc3)]+'\x20USDT'),_0x440d1d;}async[a33_0x42ee18(0xd0)](_0x34cde5){const _0x45674c=a33_0x42ee18,_0x503ab2=this[_0x45674c(0x12d)](_0x34cde5),_0x4e460c=new Date();_0x4e460c[_0x45674c(0x124)](_0x4e460c[_0x45674c(0xa4)]()-_0x503ab2),console[_0x45674c(0x7c)](_0x45674c(0xe7)+_0x34cde5+'\x20('+_0x503ab2+_0x45674c(0x130));const _0x3e6f38=await database_1[_0x45674c(0x13c)][_0x45674c(0xb9)][_0x45674c(0x138)]({'where':{'status':'ACTIVE'}}),_0x160feb=await database_1[_0x45674c(0x13c)][_0x45674c(0xc6)]['count'](),_0x588df9=await database_1[_0x45674c(0x13c)]['payment'][_0x45674c(0xce)]({'where':{'status':{'in':['PAID',_0x45674c(0xf2),'CHARGEBACK']}},'select':{'amount':!![],'currency':!![],'status':!![],'chargebackAmount':!![],'createdAt':!![]}});console[_0x45674c(0x7c)](_0x45674c(0x8f)+_0x588df9[_0x45674c(0x11b)]+_0x45674c(0x92));const _0x12e4cf=await Promise[_0x45674c(0xff)](_0x588df9[_0x45674c(0xa6)](async _0x44de96=>{const _0x2f96fe=_0x45674c,_0x41b018=this[_0x2f96fe(0x114)](_0x44de96);if(_0x41b018===0x0)return{'amount':0x0,'createdAt':_0x44de96[_0x2f96fe(0xb5)]};let _0x657044;return _0x44de96['status']===_0x2f96fe(0x11a)?_0x657044=-Math[_0x2f96fe(0x102)](_0x41b018):_0x657044=await currencyService_1[_0x2f96fe(0xaa)]['convertToUSDT'](_0x44de96[_0x2f96fe(0xd1)],_0x44de96['currency']),{'amount':_0x657044,'createdAt':_0x44de96[_0x2f96fe(0xb5)]};})),_0x182f33=_0x12e4cf[_0x45674c(0xa5)]((_0xf3d1f1,_0x3691fa)=>_0xf3d1f1+_0x3691fa[_0x45674c(0xd1)],0x0),_0x21293e=_0x160feb>0x0?_0x182f33/_0x160feb:0x0;console['log'](_0x45674c(0xfe)+_0x182f33[_0x45674c(0x117)](0x2)+_0x45674c(0x8c)),console[_0x45674c(0x7c)](_0x45674c(0xf7)+_0x21293e[_0x45674c(0x117)](0x2)+_0x45674c(0xc4));const _0x548c28=await database_1[_0x45674c(0x13c)][_0x45674c(0xf5)]`
      SELECT 
        DATE(created_at) as date,
        array_agg(
          json_build_object(
            'amount', amount,
            'currency', currency,
            'status', status,
            'chargeback_amount', chargeback_amount
          )
        ) as payments
      FROM payments 
      WHERE created_at >= ${_0x4e460c}
        AND status IN ('PAID', 'REFUND', 'CHARGEBACK')
      GROUP BY DATE(created_at)
      ORDER BY date ASC
    `;console[_0x45674c(0x7c)]('üìÖ\x20Processing\x20daily\x20stats\x20for\x20'+_0x548c28[_0x45674c(0x11b)]+'\x20days');const _0x438d64=await Promise[_0x45674c(0xff)](_0x548c28[_0x45674c(0xa6)](async _0x56d9e8=>{const _0x4d0544=_0x45674c,_0x848b8f=await Promise[_0x4d0544(0xff)](_0x56d9e8[_0x4d0544(0x79)][_0x4d0544(0xa6)](async _0x598b66=>{const _0x31947e=_0x4d0544,_0x4ba778=this[_0x31947e(0x114)](_0x598b66);if(_0x4ba778===0x0)return 0x0;return _0x598b66[_0x31947e(0x8a)]==='CHARGEBACK'?-Math[_0x31947e(0x102)](_0x4ba778):await currencyService_1[_0x31947e(0xaa)][_0x31947e(0x86)](_0x598b66[_0x31947e(0xd1)],_0x598b66['currency']);})),_0x110f8d=_0x848b8f[_0x4d0544(0xa5)]((_0x30672a,_0x4652f8)=>_0x30672a+_0x4652f8,0x0);return{'date':_0x56d9e8[_0x4d0544(0x110)]['toISOString']()['split']('T')[0x0],'amount':_0x110f8d};})),_0x506a99=this['generateDateRange'](_0x4e460c,new Date()),_0x184176=new Map(_0x438d64[_0x45674c(0xa6)](_0x7835d2=>[_0x7835d2[_0x45674c(0x110)],_0x7835d2[_0x45674c(0xd1)]])),_0x54a77e=_0x506a99['map'](_0x752979=>({'date':_0x752979,'amount':_0x184176[_0x45674c(0x99)](_0x752979)||0x0}));return console[_0x45674c(0x7c)](_0x45674c(0x82)),console['log'](_0x45674c(0xcb)+_0x3e6f38),console[_0x45674c(0x7c)](_0x45674c(0x80)+_0x160feb),console[_0x45674c(0x7c)](_0x45674c(0xd9)+_0x54a77e[_0x45674c(0x11b)]),{'totalRevenue':Math['round'](_0x182f33*0x64)/0x64,'totalUsers':_0x3e6f38,'totalPayments':_0x160feb,'averagePayment':Math['round'](_0x21293e*0x64)/0x64,'dailyRevenue':_0x54a77e};}async[a33_0x42ee18(0x106)](_0x66636c){const _0x259df3=a33_0x42ee18,{page:_0x7647df,limit:_0x29a3a1,status:_0xad41c1,gateway:_0x1b33fd,shopId:_0xd1ef5b,dateFrom:_0x133a1c,dateTo:_0x46b546,search:_0x27473f}=_0x66636c,_0x1ea889=(_0x7647df-0x1)*_0x29a3a1;console[_0x259df3(0x7c)]('üìã\x20Getting\x20payments\x20with\x20filters:',_0x66636c);const _0x2ff62e={};_0xad41c1&&(_0x2ff62e[_0x259df3(0x8a)]=_0xad41c1['toUpperCase']());if(_0x1b33fd){if((0x0,gateway_1[_0x259df3(0x143)])(_0x1b33fd)){const _0x2bbaba=(0x0,gateway_1[_0x259df3(0xb4)])(_0x1b33fd);_0x2bbaba&&(_0x2ff62e[_0x259df3(0xc9)]=_0x2bbaba);}else _0x2ff62e[_0x259df3(0xc9)]=_0x1b33fd['toLowerCase']();}_0xd1ef5b&&(_0x2ff62e[_0x259df3(0x74)]=_0xd1ef5b);(_0x133a1c||_0x46b546)&&(_0x2ff62e[_0x259df3(0xb5)]={},_0x133a1c&&(_0x2ff62e[_0x259df3(0xb5)]['gte']=new Date(_0x133a1c)),_0x46b546&&(_0x2ff62e['createdAt']['lte']=new Date(_0x46b546)));_0x27473f&&(_0x2ff62e['OR']=[{'orderId':{'contains':_0x27473f,'mode':_0x259df3(0x94)}},{'gatewayOrderId':{'contains':_0x27473f,'mode':_0x259df3(0x94)}},{'gatewayPaymentId':{'contains':_0x27473f,'mode':'insensitive'}},{'customerEmail':{'contains':_0x27473f,'mode':_0x259df3(0x94)}},{'customerName':{'contains':_0x27473f,'mode':_0x259df3(0x94)}},{'shop':{'name':{'contains':_0x27473f,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x27473f,'mode':_0x259df3(0x94)}}}]);const [_0x375ce2,_0x457b77]=await Promise[_0x259df3(0xff)]([database_1[_0x259df3(0x13c)][_0x259df3(0xc6)][_0x259df3(0xce)]({'where':_0x2ff62e,'skip':_0x1ea889,'take':_0x29a3a1,'orderBy':{'createdAt':_0x259df3(0x10d)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x259df3(0x13c)][_0x259df3(0xc6)][_0x259df3(0x138)]({'where':_0x2ff62e})]);console[_0x259df3(0x7c)](_0x259df3(0xe4)+_0x375ce2[_0x259df3(0x11b)]+_0x259df3(0x136)+_0x457b77+'\x20total');const _0x3a9306=_0x375ce2[_0x259df3(0xa6)](_0xe541db=>({'id':_0xe541db['id'],'shopId':_0xe541db[_0x259df3(0x74)],'shopName':_0xe541db[_0x259df3(0xb9)]['name'],'shopUsername':_0xe541db[_0x259df3(0xb9)][_0x259df3(0xb3)],'gateway':_0xe541db[_0x259df3(0xc9)],'orderId':_0xe541db[_0x259df3(0xc0)],'gatewayOrderId':_0xe541db[_0x259df3(0x10a)],'amount':_0xe541db[_0x259df3(0xd1)],'currency':_0xe541db['currency'],'sourceCurrency':_0xe541db[_0x259df3(0x85)],'status':_0xe541db[_0x259df3(0x8a)],'usage':_0xe541db[_0x259df3(0x7d)],'externalPaymentUrl':_0xe541db[_0x259df3(0x120)],'gatewayPaymentId':_0xe541db[_0x259df3(0xe3)],'customerEmail':_0xe541db[_0x259df3(0x108)],'customerName':_0xe541db[_0x259df3(0x13d)],'cardLast4':_0xe541db[_0x259df3(0x11e)],'paymentMethod':_0xe541db['paymentMethod'],'bankId':_0xe541db[_0x259df3(0xe6)],'remitterIban':_0xe541db['remitterIban'],'remitterName':_0xe541db['remitterName'],'chargebackAmount':_0xe541db['chargebackAmount'],'adminNotes':_0xe541db[_0x259df3(0x12f)],'statusChangedBy':_0xe541db['statusChangedBy'],'statusChangedAt':_0xe541db['statusChangedAt'],'createdAt':_0xe541db[_0x259df3(0xb5)],'updatedAt':_0xe541db[_0x259df3(0x8b)],'expiresAt':_0xe541db[_0x259df3(0xd6)]}));return{'payments':_0x3a9306,'pagination':{'page':_0x7647df,'limit':_0x29a3a1,'total':_0x457b77,'totalPages':Math['ceil'](_0x457b77/_0x29a3a1)}};}async[a33_0x42ee18(0xfa)](_0x16f346){const _0x475de6=a33_0x42ee18;console[_0x475de6(0x7c)](_0x475de6(0x93)+_0x16f346);const _0x377997=await database_1['default'][_0x475de6(0xc6)][_0x475de6(0x133)]({'where':{'id':_0x16f346},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}},'webhookLogs':{'orderBy':{'createdAt':_0x475de6(0x10d)},'take':0xa,'select':{'id':!![],'event':!![],'statusCode':!![],'retryCount':!![],'createdAt':!![]}}}});if(!_0x377997)return console[_0x475de6(0x7c)](_0x475de6(0xbb)+_0x16f346),null;return console[_0x475de6(0x7c)](_0x475de6(0xb8)+_0x377997[_0x475de6(0xc0)]+'\x20('+_0x377997[_0x475de6(0x8a)]+')'),{'id':_0x377997['id'],'shopId':_0x377997[_0x475de6(0x74)],'shopName':_0x377997[_0x475de6(0xb9)][_0x475de6(0x73)],'shopUsername':_0x377997[_0x475de6(0xb9)][_0x475de6(0xb3)],'gateway':_0x377997[_0x475de6(0xc9)],'orderId':_0x377997[_0x475de6(0xc0)],'gatewayOrderId':_0x377997['gatewayOrderId'],'amount':_0x377997['amount'],'currency':_0x377997[_0x475de6(0xf0)],'sourceCurrency':_0x377997[_0x475de6(0x85)],'status':_0x377997[_0x475de6(0x8a)],'usage':_0x377997[_0x475de6(0x7d)],'externalPaymentUrl':_0x377997[_0x475de6(0x120)],'gatewayPaymentId':_0x377997[_0x475de6(0xe3)],'customerEmail':_0x377997[_0x475de6(0x108)],'customerName':_0x377997[_0x475de6(0x13d)],'cardLast4':_0x377997[_0x475de6(0x11e)],'paymentMethod':_0x377997['paymentMethod'],'bankId':_0x377997['bankId'],'remitterIban':_0x377997['remitterIban'],'remitterName':_0x377997[_0x475de6(0x8d)],'chargebackAmount':_0x377997[_0x475de6(0xdb)],'adminNotes':_0x377997['adminNotes'],'statusChangedBy':_0x377997[_0x475de6(0x8e)],'statusChangedAt':_0x377997['statusChangedAt'],'createdAt':_0x377997['createdAt'],'updatedAt':_0x377997[_0x475de6(0x8b)],'expiresAt':_0x377997[_0x475de6(0xd6)],'webhookLogs':_0x377997[_0x475de6(0x127)]};}async['updatePaymentStatus'](_0x3fa131,_0x395b24,_0x2d89b6,_0x4af3bf){const _0x1eefba=a33_0x42ee18;console['log'](_0x1eefba(0x135)+_0x3fa131+'\x20status\x20to:\x20'+_0x395b24);const _0x522b7e=[_0x1eefba(0xad),_0x1eefba(0x119),'PAID',_0x1eefba(0x11c),_0x1eefba(0x12b),_0x1eefba(0xf2),_0x1eefba(0x11a)];if(!_0x522b7e[_0x1eefba(0xfc)](_0x395b24[_0x1eefba(0x126)]()))throw new Error(_0x1eefba(0x142)+_0x522b7e[_0x1eefba(0xa2)](',\x20'));const _0x421540=await database_1[_0x1eefba(0x13c)][_0x1eefba(0xc6)][_0x1eefba(0x133)]({'where':{'id':_0x3fa131},'select':{'id':!![],'status':!![],'orderId':!![]}});if(!_0x421540)throw new Error(_0x1eefba(0x87));if(_0x395b24[_0x1eefba(0x126)]()==='CHARGEBACK'){if(!_0x4af3bf||_0x4af3bf<=0x0)throw new Error(_0x1eefba(0x145));console[_0x1eefba(0x7c)](_0x1eefba(0x122)+_0x4af3bf+_0x1eefba(0x75));}const _0x300662={'status':_0x395b24[_0x1eefba(0x126)](),'updatedAt':new Date()};_0x2d89b6&&(_0x300662['adminNotes']=_0x2d89b6);_0x395b24[_0x1eefba(0x126)]()===_0x1eefba(0x11a)&&_0x4af3bf&&(_0x300662[_0x1eefba(0xdb)]=_0x4af3bf);const _0x1b807e=await database_1[_0x1eefba(0x13c)][_0x1eefba(0xc6)]['update']({'where':{'id':_0x3fa131},'data':_0x300662,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});return await database_1['default']['webhookLog'][_0x1eefba(0x91)]({'data':{'paymentId':_0x3fa131,'shopId':_0x1b807e['shopId'],'event':_0x1eefba(0x131),'statusCode':0xc8,'responseBody':JSON[_0x1eefba(0xae)]({'oldStatus':_0x421540['status'],'newStatus':_0x395b24[_0x1eefba(0x126)](),'notes':_0x2d89b6||null,'chargebackAmount':_0x4af3bf||null,'timestamp':new Date()[_0x1eefba(0xb0)]()})}}),console[_0x1eefba(0x7c)]('‚úÖ\x20Payment\x20'+_0x421540[_0x1eefba(0xc0)]+'\x20status\x20updated\x20from\x20'+_0x421540[_0x1eefba(0x8a)]+_0x1eefba(0x9f)+_0x395b24[_0x1eefba(0x126)]()),_0x395b24['toUpperCase']()===_0x1eefba(0x11a)&&console[_0x1eefba(0x7c)](_0x1eefba(0x13f)+_0x4af3bf+_0x1eefba(0x11d)),{'id':_0x1b807e['id'],'shopId':_0x1b807e[_0x1eefba(0x74)],'shopName':_0x1b807e[_0x1eefba(0xb9)][_0x1eefba(0x73)],'shopUsername':_0x1b807e[_0x1eefba(0xb9)][_0x1eefba(0xb3)],'gateway':_0x1b807e[_0x1eefba(0xc9)],'orderId':_0x1b807e[_0x1eefba(0xc0)],'gatewayOrderId':_0x1b807e[_0x1eefba(0x10a)],'amount':_0x1b807e[_0x1eefba(0xd1)],'currency':_0x1b807e['currency'],'sourceCurrency':_0x1b807e[_0x1eefba(0x85)],'status':_0x1b807e['status'],'usage':_0x1b807e[_0x1eefba(0x7d)],'externalPaymentUrl':_0x1b807e['externalPaymentUrl'],'gatewayPaymentId':_0x1b807e[_0x1eefba(0xe3)],'customerEmail':_0x1b807e[_0x1eefba(0x108)],'customerName':_0x1b807e['customerName'],'cardLast4':_0x1b807e[_0x1eefba(0x11e)],'paymentMethod':_0x1b807e['paymentMethod'],'bankId':_0x1b807e['bankId'],'remitterIban':_0x1b807e['remitterIban'],'remitterName':_0x1b807e[_0x1eefba(0x8d)],'chargebackAmount':_0x1b807e['chargebackAmount'],'adminNotes':_0x1b807e['adminNotes'],'statusChangedBy':_0x1b807e[_0x1eefba(0x8e)],'statusChangedAt':_0x1b807e[_0x1eefba(0xba)],'createdAt':_0x1b807e[_0x1eefba(0xb5)],'updatedAt':_0x1b807e['updatedAt'],'expiresAt':_0x1b807e[_0x1eefba(0xd6)]};}async[a33_0x42ee18(0xd2)](_0x3a927a){const _0x278f2f=a33_0x42ee18,{page:_0x5e4d3,limit:_0x334dd3,status:_0x4ffe52}=_0x3a927a,_0x286bfe=(_0x5e4d3-0x1)*_0x334dd3,_0x339b2c={};_0x4ffe52&&(_0x339b2c[_0x278f2f(0x8a)]=_0x4ffe52[_0x278f2f(0x126)]());console[_0x278f2f(0x7c)]('üìã\x20Getting\x20users\x20with\x20filters:',{'page':_0x5e4d3,'limit':_0x334dd3,'status':_0x4ffe52,'where':_0x339b2c});const [_0x43a0f1,_0x473ae0]=await Promise[_0x278f2f(0xff)]([database_1[_0x278f2f(0x13c)][_0x278f2f(0xb9)][_0x278f2f(0xce)]({'where':_0x339b2c,'skip':_0x286bfe,'take':_0x334dd3,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':'desc'}}),database_1[_0x278f2f(0x13c)]['shop'][_0x278f2f(0x138)]({'where':_0x339b2c})]);console['log']('üìä\x20Found\x20'+_0x43a0f1[_0x278f2f(0x11b)]+_0x278f2f(0x139)+_0x473ae0+'\x20total');const _0x22f344=_0x43a0f1[_0x278f2f(0xa6)](_0x1b1a86=>({'id':_0x1b1a86['id'],'fullName':_0x1b1a86[_0x278f2f(0x73)],'username':_0x1b1a86[_0x278f2f(0xb3)],'telegramId':_0x1b1a86['telegram'],'merchantUrl':_0x1b1a86[_0x278f2f(0xd5)],'gateways':_0x1b1a86[_0x278f2f(0x9e)]?JSON[_0x278f2f(0x83)](_0x1b1a86[_0x278f2f(0x9e)]):null,'gatewaySettings':_0x1b1a86[_0x278f2f(0x76)]?JSON[_0x278f2f(0x83)](_0x1b1a86[_0x278f2f(0x76)]):null,'publicKey':_0x1b1a86[_0x278f2f(0xc8)],'wallets':{'usdtPolygonWallet':_0x1b1a86[_0x278f2f(0x140)],'usdtTrcWallet':_0x1b1a86['usdtTrcWallet'],'usdtErcWallet':_0x1b1a86[_0x278f2f(0xde)],'usdcPolygonWallet':_0x1b1a86[_0x278f2f(0xd4)]},'status':_0x1b1a86['status'],'createdAt':_0x1b1a86[_0x278f2f(0xb5)]}));return{'users':_0x22f344,'pagination':{'page':_0x5e4d3,'limit':_0x334dd3,'total':_0x473ae0,'totalPages':Math[_0x278f2f(0x9c)](_0x473ae0/_0x334dd3)}};}async[a33_0x42ee18(0x97)](_0x5a0d24){const _0x1dbdbd=a33_0x42ee18;return await this['userService'][_0x1dbdbd(0x97)](_0x5a0d24);}async['createUser'](_0x480289){const _0xd79ad3=a33_0x42ee18;return await this['userService'][_0xd79ad3(0x101)](_0x480289);}async['updateUser'](_0xd595d8,_0x53b41d){const _0x3e933f=a33_0x42ee18;return await this[_0x3e933f(0x137)]['updateUser'](_0xd595d8,_0x53b41d);}async[a33_0x42ee18(0xc2)](_0x1a3303){const _0x4b9714=a33_0x42ee18;return await this[_0x4b9714(0x137)][_0x4b9714(0xc2)](_0x1a3303);}async[a33_0x42ee18(0xcc)](_0x2b343a){const _0x1f2f35=a33_0x42ee18;console[_0x1f2f35(0x7c)]('üö´\x20Suspending\x20user:\x20'+_0x2b343a);const _0x1e4e0b=await database_1[_0x1f2f35(0x13c)]['shop'][_0x1f2f35(0x133)]({'where':{'id':_0x2b343a},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x1e4e0b)throw new Error('User\x20not\x20found');if(_0x1e4e0b[_0x1f2f35(0x8a)]===_0x1f2f35(0x12c))throw new Error('User\x20is\x20already\x20suspended');const _0x325206=await this[_0x1f2f35(0x137)]['updateUser'](_0x2b343a,{'status':'SUSPENDED'});return console[_0x1f2f35(0x7c)](_0x1f2f35(0x107)+_0x1e4e0b['username']+_0x1f2f35(0x7a)),_0x325206;}async[a33_0x42ee18(0x98)](_0x2f3bd2){const _0x11244d=a33_0x42ee18;console[_0x11244d(0x7c)]('‚úÖ\x20Activating\x20user:\x20'+_0x2f3bd2);const _0x105a69=await database_1[_0x11244d(0x13c)][_0x11244d(0xb9)]['findUnique']({'where':{'id':_0x2f3bd2},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x105a69)throw new Error('User\x20not\x20found');if(_0x105a69[_0x11244d(0x8a)]===_0x11244d(0x123))throw new Error(_0x11244d(0x7b));const _0x5d61dd=await this['userService']['updateUser'](_0x2f3bd2,{'status':'ACTIVE'});return console[_0x11244d(0x7c)](_0x11244d(0x107)+_0x105a69[_0x11244d(0xb3)]+_0x11244d(0xf6)),_0x5d61dd;}}exports[a33_0x42ee18(0x109)]=AdminService;