'use strict';const a35_0x11039f=a35_0x214b;(function(_0x16ed05,_0x3aaf11){const _0x291c15=a35_0x214b,_0x3550da=_0x16ed05();while(!![]){try{const _0x4cb5f4=parseInt(_0x291c15(0x140))/0x1+-parseInt(_0x291c15(0x114))/0x2+parseInt(_0x291c15(0x1b7))/0x3+-parseInt(_0x291c15(0x163))/0x4*(-parseInt(_0x291c15(0x16e))/0x5)+-parseInt(_0x291c15(0x144))/0x6+-parseInt(_0x291c15(0x104))/0x7*(-parseInt(_0x291c15(0x145))/0x8)+-parseInt(_0x291c15(0xe4))/0x9;if(_0x4cb5f4===_0x3aaf11)break;else _0x3550da['push'](_0x3550da['shift']());}catch(_0x124416){_0x3550da['push'](_0x3550da['shift']());}}}(a35_0x26a0,0xc4c2a));var __importDefault=this&&this[a35_0x11039f(0x18c)]||function(_0x399be6){const _0x5efc7f=a35_0x11039f;return _0x399be6&&_0x399be6[_0x5efc7f(0xfd)]?_0x399be6:{'default':_0x399be6};};function a35_0x214b(_0xa0638f,_0x132a0d){const _0x26a04b=a35_0x26a0();return a35_0x214b=function(_0x214b4f,_0x3ef100){_0x214b4f=_0x214b4f-0xcb;let _0x6b043c=_0x26a04b[_0x214b4f];return _0x6b043c;},a35_0x214b(_0xa0638f,_0x132a0d);}Object[a35_0x11039f(0xe6)](exports,'__esModule',{'value':!![]}),exports[a35_0x11039f(0x1fa)]=void 0x0;const database_1=__importDefault(require(a35_0x11039f(0xd9))),bcryptjs_1=__importDefault(require(a35_0x11039f(0x166))),crypto_1=__importDefault(require(a35_0x11039f(0x134))),currencyService_1=require(a35_0x11039f(0x1d9)),gateway_1=require('../types/gateway');class AdminService{async[a35_0x11039f(0x19e)](){const _0x1d9082=a35_0x11039f;console[_0x1d9082(0xe5)](_0x1d9082(0x16d));const _0x35a7e3=await database_1[_0x1d9082(0xfb)]['shop']['aggregate']({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x1d9082(0x1aa)}}),_0x2a1752=await this[_0x1d9082(0x14c)]({'page':0x1,'limit':0x3e8}),_0x1e65ff=await database_1[_0x1d9082(0xfb)]['payment']['count']({'where':{'status':_0x1d9082(0x12b),'gateway':{'not':_0x1d9082(0x1da)}}}),_0x3f76b8=new Date(),_0x2b3e43=new Date(_0x3f76b8[_0x1d9082(0x1f6)](),_0x3f76b8['getMonth'](),0x1),_0x2b3090=new Date(_0x3f76b8['getFullYear'](),_0x3f76b8[_0x1d9082(0x108)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x5189cf=await database_1[_0x1d9082(0xfb)][_0x1d9082(0x143)][_0x1d9082(0x1a8)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x2b3e43,'lte':_0x2b3090},'status':_0x1d9082(0x180)}}),_0x14e271=_0x35a7e3[_0x1d9082(0x1e6)][_0x1d9082(0x176)]||0x0,_0x4cade9=_0x2a1752[_0x1d9082(0x10d)][_0x1d9082(0x135)],_0x3178e1=_0x5189cf['_sum'][_0x1d9082(0x1b1)]||0x0,_0x5a59b2={'totalPayout':Math[_0x1d9082(0x19a)](_0x14e271*0x64)/0x64,'awaitingPayout':Math[_0x1d9082(0x19a)](_0x4cade9*0x64)/0x64,'thisMonth':Math['round'](_0x3178e1*0x64)/0x64,'availableBalance':Math[_0x1d9082(0x19a)](_0x4cade9*0x64)/0x64,'totalPayments':_0x1e65ff};return console[_0x1d9082(0xe5)](_0x1d9082(0xd7)),console[_0x1d9082(0xe5)](_0x1d9082(0x18d)+_0x5a59b2['totalPayout']+_0x1d9082(0x185)),console['log']('\x20\x20\x20⏳\x20Awaiting\x20payout:\x20'+_0x5a59b2[_0x1d9082(0x17b)]+_0x1d9082(0x1b5)),console['log']('\x20\x20\x20💵\x20Available\x20balance:\x20'+_0x5a59b2[_0x1d9082(0x199)]+'\x20USDT\x20(same\x20as\x20awaiting)'),console[_0x1d9082(0xe5)](_0x1d9082(0x11f)+_0x5a59b2[_0x1d9082(0x1b6)]+'\x20USDT'),console[_0x1d9082(0xe5)](_0x1d9082(0xcc)+_0x5a59b2['totalPayments']+_0x1d9082(0xf8)),console[_0x1d9082(0xe5)](_0x1d9082(0x14b)+(_0x35a7e3[_0x1d9082(0x1e6)][_0x1d9082(0x1e3)]||0x0)[_0x1d9082(0x165)](0x2)+_0x1d9082(0x1bc)),console['log'](_0x1d9082(0x19b)+((_0x35a7e3[_0x1d9082(0x1e6)]['balance']||0x0)-_0x4cade9)[_0x1d9082(0x165)](0x2)+_0x1d9082(0x1c8)),_0x5a59b2;}async['updateCustomerData'](_0x3fda8c,_0x16cd68){const _0x2a37ab=a35_0x11039f;console['log'](_0x2a37ab(0x1f0)+_0x3fda8c+':',_0x16cd68);const _0x4416a1=await database_1[_0x2a37ab(0xfb)][_0x2a37ab(0x155)]['findUnique']({'where':{'id':_0x3fda8c},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x4416a1)throw new Error(_0x2a37ab(0x1f5));const _0x485ca8={};_0x16cd68[_0x2a37ab(0x172)]!==undefined&&(_0x485ca8[_0x2a37ab(0x172)]=_0x16cd68[_0x2a37ab(0x172)]||null);_0x16cd68[_0x2a37ab(0x116)]!==undefined&&(_0x485ca8[_0x2a37ab(0x116)]=_0x16cd68[_0x2a37ab(0x116)]||null);_0x16cd68[_0x2a37ab(0x1d5)]!==undefined&&(_0x485ca8[_0x2a37ab(0x1d5)]=_0x16cd68[_0x2a37ab(0x1d5)]||null);const _0xd1f9d3=await database_1['default']['payment']['update']({'where':{'id':_0x3fda8c},'data':{..._0x485ca8,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console['log']('✅\x20Customer\x20data\x20updated\x20for\x20payment\x20'+_0x3fda8c),console[_0x2a37ab(0xe5)]('\x20\x20\x20🌍\x20Country:\x20'+_0x4416a1[_0x2a37ab(0x172)]+_0x2a37ab(0x118)+_0xd1f9d3[_0x2a37ab(0x172)]),console[_0x2a37ab(0xe5)](_0x2a37ab(0xf3)+_0x4416a1[_0x2a37ab(0x116)]+_0x2a37ab(0x118)+_0xd1f9d3[_0x2a37ab(0x116)]),console[_0x2a37ab(0xe5)](_0x2a37ab(0x19d)+(_0x4416a1[_0x2a37ab(0x1d5)]?'set':_0x2a37ab(0x161))+_0x2a37ab(0x118)+(_0xd1f9d3[_0x2a37ab(0x1d5)]?_0x2a37ab(0xe1):'not\x20set')),_0xd1f9d3;}async[a35_0x11039f(0xd6)](_0x38f342){const _0x340466=a35_0x11039f,_0x116a5e=new Date();let _0x55410f;switch(_0x38f342){case'7d':_0x55410f=new Date(_0x116a5e['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x340466(0x115):_0x55410f=new Date(_0x116a5e[_0x340466(0x170)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x340466(0x17f):_0x55410f=new Date(_0x116a5e[_0x340466(0x170)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x340466(0x1d2):const _0x2d00a6=await database_1[_0x340466(0xfb)][_0x340466(0x155)][_0x340466(0x106)]({'where':{'gateway':{'not':_0x340466(0x1da)}},'orderBy':{'createdAt':'asc'},'select':{'createdAt':!![]}});_0x55410f=_0x2d00a6?_0x2d00a6[_0x340466(0x12f)]:new Date('2020-01-01'),console[_0x340466(0xe5)](_0x340466(0xd4)+_0x55410f['toISOString']());break;default:_0x55410f=new Date(_0x116a5e['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x53bc85,_0x21087a,_0x4d238f,_0x1d35f9,_0x1eefe0,_0x4c0ad3,_0x274953]=await Promise[_0x340466(0x1d2)]([database_1[_0x340466(0xfb)][_0x340466(0x193)][_0x340466(0x1b2)](),database_1['default'][_0x340466(0x193)][_0x340466(0x1b2)]({'where':{'status':'ACTIVE'}}),database_1['default'][_0x340466(0x155)][_0x340466(0x1b2)]({'where':{'createdAt':{'gte':_0x55410f},'gateway':{'not':_0x340466(0x1da)}}}),database_1['default']['payment'][_0x340466(0x1b2)]({'where':{'status':_0x340466(0x12b),'createdAt':{'gte':_0x55410f},'gateway':{'not':'test_gateway'}}}),database_1['default'][_0x340466(0x155)][_0x340466(0x130)]({'where':{'status':_0x340466(0x12b),'createdAt':{'gte':_0x55410f},'gateway':{'not':_0x340466(0x1da)}},'select':{'amount':!![],'currency':!![]}}),database_1[_0x340466(0xfb)][_0x340466(0x155)][_0x340466(0x130)]({'where':{'gateway':{'not':_0x340466(0x1da)}},'take':0xa,'orderBy':{'createdAt':_0x340466(0x13c)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x340466(0xfb)][_0x340466(0x155)][_0x340466(0x130)]({'where':{'createdAt':{'gte':_0x55410f},'gateway':{'not':_0x340466(0x1da)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x25509f=0x0;for(const _0x52ea51 of _0x1eefe0){const _0x3b6728=await currencyService_1[_0x340466(0x1ee)][_0x340466(0x100)](_0x52ea51[_0x340466(0x1b1)],_0x52ea51[_0x340466(0x1d6)]);_0x25509f+=_0x3b6728;}const _0x5dab7b=this[_0x340466(0xde)](_0x274953,_0x55410f,_0x116a5e),_0x5128fb=_0x4d238f>0x0?_0x1d35f9/_0x4d238f*0x64:0x0;return{'totalShops':_0x53bc85,'activeShops':_0x21087a,'totalPayments':_0x4d238f,'successfulPayments':_0x1d35f9,'totalRevenue':Math[_0x340466(0x19a)](_0x25509f*0x64)/0x64,'conversionRate':Math[_0x340466(0x19a)](_0x5128fb*0x64)/0x64,'dailyRevenue':_0x5dab7b[_0x340466(0x1dd)],'dailyPayments':_0x5dab7b[_0x340466(0x15c)],'recentPayments':_0x4c0ad3['map'](_0x44114b=>({'id':_0x44114b['id'],'amount':_0x44114b['amount'],'currency':_0x44114b[_0x340466(0x1d6)],'status':_0x44114b[_0x340466(0x124)],'gateway':_0x44114b[_0x340466(0x107)],'shop':_0x44114b[_0x340466(0x193)],'createdAt':_0x44114b[_0x340466(0x12f)]}))};}async[a35_0x11039f(0x168)](_0x7ab184){const _0x19d7f7=a35_0x11039f;console[_0x19d7f7(0xe5)]('📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:',_0x7ab184);let _0x56a80,_0x5cecf1=new Date();if(_0x7ab184[_0x19d7f7(0xf9)]==='custom'&&_0x7ab184['dateFrom']&&_0x7ab184['dateTo'])_0x56a80=new Date(_0x7ab184[_0x19d7f7(0x1d1)]),_0x5cecf1=new Date(_0x7ab184[_0x19d7f7(0x119)]);else{const _0xe8b5c0=new Date();switch(_0x7ab184[_0x19d7f7(0xf9)]){case _0x19d7f7(0x10f):_0x56a80=new Date(_0xe8b5c0['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x19d7f7(0x1f2):_0x56a80=new Date(_0xe8b5c0[_0x19d7f7(0x170)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x19d7f7(0x152):_0x56a80=new Date(_0xe8b5c0['getTime']()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x19d7f7(0x1d2):default:_0x56a80=new Date('2020-01-01');break;}}console[_0x19d7f7(0xe5)]('📅\x20Period:\x20'+_0x56a80[_0x19d7f7(0xd1)]()+'\x20to\x20'+_0x5cecf1['toISOString']());const _0xf140df={'status':_0x19d7f7(0x12b),'gateway':{'not':'test_gateway'},'paidAt':{'gte':_0x56a80,'lte':_0x5cecf1}};_0x7ab184[_0x19d7f7(0x12a)]&&(_0xf140df[_0x19d7f7(0x12a)]=_0x7ab184[_0x19d7f7(0x12a)]);const _0x1742a0=await database_1[_0x19d7f7(0xfb)][_0x19d7f7(0x155)]['findMany']({'where':_0xf140df,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x19d7f7(0xe5)](_0x19d7f7(0x1ae)+_0x1742a0[_0x19d7f7(0x11b)]+_0x19d7f7(0x1df));const _0x3118a6={'gateway':{'not':_0x19d7f7(0x1da)},'createdAt':{'gte':_0x56a80,'lte':_0x5cecf1}};_0x7ab184[_0x19d7f7(0x12a)]&&(_0x3118a6[_0x19d7f7(0x12a)]=_0x7ab184[_0x19d7f7(0x12a)]);const _0x22b02b=await database_1[_0x19d7f7(0xfb)][_0x19d7f7(0x155)][_0x19d7f7(0x1b2)]({'where':_0x3118a6});console[_0x19d7f7(0xe5)](_0x19d7f7(0x17a)+_0x22b02b+_0x19d7f7(0x1d0)+_0x1742a0[_0x19d7f7(0x11b)]);let _0x21a426=0x0,_0x300349=0x0,_0x2d3e23=0x0;const _0x24e0e3={},_0x2a0e4d={},_0x4b51ea={};for(const _0x23a1e9 of _0x1742a0){try{const _0xcb8ee7=await currencyService_1[_0x19d7f7(0x1ee)][_0x19d7f7(0x100)](_0x23a1e9[_0x19d7f7(0x1b1)],_0x23a1e9[_0x19d7f7(0x1d6)]);let _0x18e6a5={};if(_0x23a1e9[_0x19d7f7(0x193)]['gatewaySettings'])try{_0x18e6a5=JSON['parse'](_0x23a1e9[_0x19d7f7(0x193)]['gatewaySettings']);}catch(_0xf3e074){console['error'](_0x19d7f7(0x139)+_0x23a1e9[_0x19d7f7(0x12a)]+':',_0xf3e074);}let _0x1822aa={},_0x931ccd=0xa;for(const [_0x1ed9ce,_0x268ca2]of Object[_0x19d7f7(0x10a)](_0x18e6a5)){if(_0x1ed9ce[_0x19d7f7(0x127)]()===_0x23a1e9[_0x19d7f7(0x107)]['toLowerCase']()){_0x1822aa=_0x268ca2,_0x931ccd=_0x268ca2['commission']||0xa;break;}}const _0x3a4094=_0xcb8ee7*(_0x931ccd/0x64),_0x5290cb=_0xcb8ee7-_0x3a4094;_0x21a426+=_0xcb8ee7,_0x300349+=_0x5290cb,_0x2d3e23+=_0x3a4094;!_0x24e0e3[_0x23a1e9[_0x19d7f7(0x107)]]&&(_0x24e0e3[_0x23a1e9['gateway']]={'gateway':_0x23a1e9[_0x19d7f7(0x107)],'gatewayDisplayName':this[_0x19d7f7(0xef)](_0x23a1e9[_0x19d7f7(0x107)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x24e0e3[_0x23a1e9[_0x19d7f7(0x107)]]['paymentsCount']++,_0x24e0e3[_0x23a1e9[_0x19d7f7(0x107)]]['turnoverUSDT']+=_0xcb8ee7,_0x24e0e3[_0x23a1e9[_0x19d7f7(0x107)]][_0x19d7f7(0x1a5)]+=_0x3a4094,_0x24e0e3[_0x23a1e9[_0x19d7f7(0x107)]][_0x19d7f7(0x1c5)]+=_0x5290cb,_0x24e0e3[_0x23a1e9[_0x19d7f7(0x107)]][_0x19d7f7(0x1e1)]+=_0x931ccd;!_0x7ab184['shopId']&&(!_0x2a0e4d[_0x23a1e9[_0x19d7f7(0x12a)]]&&(_0x2a0e4d[_0x23a1e9[_0x19d7f7(0x12a)]]={'shopId':_0x23a1e9[_0x19d7f7(0x12a)],'shopName':_0x23a1e9['shop'][_0x19d7f7(0x1e0)],'shopUsername':_0x23a1e9[_0x19d7f7(0x193)][_0x19d7f7(0x1b9)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x2a0e4d[_0x23a1e9[_0x19d7f7(0x12a)]][_0x19d7f7(0x1c1)]++,_0x2a0e4d[_0x23a1e9[_0x19d7f7(0x12a)]][_0x19d7f7(0x171)]+=_0xcb8ee7,_0x2a0e4d[_0x23a1e9[_0x19d7f7(0x12a)]]['commissionUSDT']+=_0x3a4094,_0x2a0e4d[_0x23a1e9[_0x19d7f7(0x12a)]][_0x19d7f7(0x1c5)]+=_0x5290cb);const _0x1c1164=_0x23a1e9[_0x19d7f7(0x1ad)]['toISOString']()[_0x19d7f7(0xdb)]('T')[0x0];!_0x4b51ea[_0x1c1164]&&(_0x4b51ea[_0x1c1164]={'date':_0x1c1164,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x4b51ea[_0x1c1164][_0x19d7f7(0x132)]+=_0xcb8ee7,_0x4b51ea[_0x1c1164][_0x19d7f7(0x173)]+=_0x5290cb,_0x4b51ea[_0x1c1164]['gatewayEarnings']+=_0x3a4094,_0x4b51ea[_0x1c1164][_0x19d7f7(0x1c1)]++;}catch(_0x531f50){console['error'](_0x19d7f7(0x112)+_0x23a1e9['id']+':',_0x531f50);}}Object[_0x19d7f7(0xdd)](_0x24e0e3)[_0x19d7f7(0x175)](_0x2d2eab=>{const _0x27431f=_0x19d7f7;_0x2d2eab[_0x27431f(0x126)]=_0x2d2eab[_0x27431f(0x1c1)]>0x0?_0x2d2eab[_0x27431f(0x1e1)]/_0x2d2eab[_0x27431f(0x1c1)]:0x0,delete _0x2d2eab['totalCommissionRate'];}),Object[_0x19d7f7(0xdd)](_0x2a0e4d)[_0x19d7f7(0x175)](_0x48f396=>{const _0x12bf6b=_0x19d7f7;_0x48f396[_0x12bf6b(0x13a)]=_0x48f396[_0x12bf6b(0x1c1)]>0x0?_0x48f396[_0x12bf6b(0x171)]/_0x48f396['paymentsCount']:0x0;});let _0x397168=0x0;if(_0x7ab184[_0x19d7f7(0x12a)]){const _0x4ed5ad=await database_1[_0x19d7f7(0xfb)][_0x19d7f7(0x143)][_0x19d7f7(0x130)]({'where':{'shopId':_0x7ab184['shopId'],'status':_0x19d7f7(0x180),'createdAt':{'gte':_0x56a80,'lte':_0x5cecf1}},'select':{'amount':!![]}});_0x397168=_0x4ed5ad[_0x19d7f7(0x177)]((_0x34adbe,_0x73ea)=>_0x34adbe+_0x73ea[_0x19d7f7(0x1b1)],0x0);}const _0x56915c=_0x22b02b,_0x3b9639=_0x1742a0[_0x19d7f7(0x11b)],_0x4993ea=_0x3b9639>0x0?_0x21a426/_0x3b9639:0x0,_0x3a17a0=_0x56915c>0x0?Math['round'](_0x3b9639/_0x56915c*0x2710)/0x64:0x0,_0x1cac23=Math['ceil']((_0x5cecf1[_0x19d7f7(0x170)]()-_0x56a80['getTime']())/(0x3e8*0x3c*0x3c*0x18)),_0x4a1805={'totalTurnover':Math[_0x19d7f7(0x19a)](_0x21a426*0x64)/0x64,'merchantEarnings':Math[_0x19d7f7(0x19a)](_0x300349*0x64)/0x64,'gatewayEarnings':Math['round'](_0x2d3e23*0x64)/0x64,'totalPaidOut':Math['round'](_0x397168*0x64)/0x64,'averageCheck':Math['round'](_0x4993ea*0x64)/0x64,'totalPayments':_0x56915c,'successfulPayments':_0x3b9639,'conversionRate':_0x3a17a0,'gatewayBreakdown':Object[_0x19d7f7(0xdd)](_0x24e0e3)['map'](_0x4a56f2=>({..._0x4a56f2,'turnoverUSDT':Math[_0x19d7f7(0x19a)](_0x4a56f2[_0x19d7f7(0x171)]*0x64)/0x64,'commissionUSDT':Math[_0x19d7f7(0x19a)](_0x4a56f2[_0x19d7f7(0x1a5)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x19d7f7(0x19a)](_0x4a56f2[_0x19d7f7(0x1c5)]*0x64)/0x64,'averageCommissionRate':Math[_0x19d7f7(0x19a)](_0x4a56f2[_0x19d7f7(0x126)]*0x64)/0x64})),'merchantBreakdown':_0x7ab184['shopId']?undefined:Object[_0x19d7f7(0xdd)](_0x2a0e4d)['map'](_0x3cd311=>({..._0x3cd311,'turnoverUSDT':Math['round'](_0x3cd311[_0x19d7f7(0x171)]*0x64)/0x64,'commissionUSDT':Math[_0x19d7f7(0x19a)](_0x3cd311[_0x19d7f7(0x1a5)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x19d7f7(0x19a)](_0x3cd311[_0x19d7f7(0x1c5)]*0x64)/0x64,'paidOutUSDT':Math[_0x19d7f7(0x19a)](_0x3cd311[_0x19d7f7(0x11e)]*0x64)/0x64,'averageCheckUSDT':Math['round'](_0x3cd311[_0x19d7f7(0x13a)]*0x64)/0x64})),'dailyData':Object[_0x19d7f7(0xdd)](_0x4b51ea)[_0x19d7f7(0x1e7)](_0x1e2c64=>({..._0x1e2c64,'turnover':Math[_0x19d7f7(0x19a)](_0x1e2c64[_0x19d7f7(0x132)]*0x64)/0x64,'merchantEarnings':Math[_0x19d7f7(0x19a)](_0x1e2c64[_0x19d7f7(0x173)]*0x64)/0x64,'gatewayEarnings':Math[_0x19d7f7(0x19a)](_0x1e2c64[_0x19d7f7(0x151)]*0x64)/0x64}))[_0x19d7f7(0x1a2)]((_0x3359cc,_0x87f5f7)=>_0x3359cc['date'][_0x19d7f7(0x188)](_0x87f5f7['date'])),'periodInfo':{'from':_0x56a80,'to':_0x5cecf1,'periodType':_0x7ab184['period']||_0x19d7f7(0xd8),'daysCount':_0x1cac23}};return console['log']('📊\x20Merchant\x20statistics\x20calculated:'),console[_0x19d7f7(0xe5)](_0x19d7f7(0x1a6)+_0x4a1805[_0x19d7f7(0x164)]+_0x19d7f7(0x1c8)),console[_0x19d7f7(0xe5)](_0x19d7f7(0x1cc)+_0x4a1805['merchantEarnings']+'\x20USDT'),console[_0x19d7f7(0xe5)](_0x19d7f7(0x10e)+_0x4a1805['gatewayEarnings']+_0x19d7f7(0x1c8)),console[_0x19d7f7(0xe5)](_0x19d7f7(0x136)+_0x4a1805[_0x19d7f7(0x1b8)]),_0x4a1805;}async[a35_0x11039f(0x1f8)](){const _0x599fc2=a35_0x11039f;console[_0x599fc2(0xe5)](_0x599fc2(0xe0));const _0x328b8b=await database_1[_0x599fc2(0xfb)][_0x599fc2(0x193)][_0x599fc2(0x130)]({'where':{'status':'ACTIVE'},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x599fc2(0x1c9)}});return console['log'](_0x599fc2(0xd5)+_0x328b8b[_0x599fc2(0x11b)]+_0x599fc2(0x101)),_0x328b8b[_0x599fc2(0x1e7)](_0x25e71f=>({'id':_0x25e71f['id'],'username':_0x25e71f['username'],'name':_0x25e71f['name']}));}['getGatewayDisplayName'](_0x207b57){const _0x39a358=a35_0x11039f,_0x206c3f={'test_gateway':_0x39a358(0x159),'plisio':_0x39a358(0x16a),'rapyd':_0x39a358(0xdc),'noda':_0x39a358(0x17c),'cointopay':_0x39a358(0x18a),'cointopay2':_0x39a358(0x148),'klyme_eu':_0x39a358(0xe8),'klyme_gb':_0x39a358(0x1a3),'klyme_de':_0x39a358(0x14a),'mastercard':_0x39a358(0x1bb)};return _0x206c3f[_0x207b57]||_0x207b57;}['getGatewayInternalName'](_0xa5c4b4){const _0x107ca7=a35_0x11039f,_0x402a33={'Test\x20Gateway':_0x107ca7(0x1da),'Plisio':_0x107ca7(0x15e),'Rapyd':_0x107ca7(0x198),'Noda':_0x107ca7(0x18b),'CoinToPay':_0x107ca7(0x18f),'CoinToPay2':_0x107ca7(0x12e),'KLYME\x20EU':'klyme_eu','KLYME\x20GB':_0x107ca7(0x1c0),'KLYME\x20DE':_0x107ca7(0xf5),'MasterCard':_0x107ca7(0x1ef)};return _0x402a33[_0xa5c4b4]||_0xa5c4b4[_0x107ca7(0x127)]();}async[a35_0x11039f(0x14c)](_0xebd32a){const _0x2cc321=a35_0x11039f,{page:_0x1b5d8e,limit:_0x26c7f7,minAmount:_0x5c87ee,search:_0x18ef28}=_0xebd32a,_0x13ea72=(_0x1b5d8e-0x1)*_0x26c7f7;console['log'](_0x2cc321(0xcb),_0xebd32a);const _0x3ee972={'balance':{'gt':0x0},'status':_0x2cc321(0x1aa)};_0x5c87ee&&(_0x3ee972['balance'][_0x2cc321(0x131)]=_0x5c87ee);_0x18ef28&&(_0x3ee972['OR']=[{'name':{'contains':_0x18ef28,'mode':'insensitive'}},{'username':{'contains':_0x18ef28,'mode':_0x2cc321(0x186)}}]);const [_0xc0ad60,_0x39141d]=await Promise['all']([database_1[_0x2cc321(0xfb)][_0x2cc321(0x193)]['findMany']({'where':_0x3ee972,'skip':_0x13ea72,'take':_0x26c7f7,'orderBy':{'balance':_0x2cc321(0x13c)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1[_0x2cc321(0xfb)][_0x2cc321(0x193)][_0x2cc321(0x1b2)]({'where':_0x3ee972})]);console[_0x2cc321(0xe5)](_0x2cc321(0x1ae)+_0xc0ad60[_0x2cc321(0x11b)]+'\x20merchants\x20with\x20positive\x20balance');const _0x41f4fb=await Promise['all'](_0xc0ad60[_0x2cc321(0x1e7)](async _0x3b088f=>{const _0x23835b=_0x2cc321,[_0x47b355,_0x2adaea,_0x573efb]=await Promise[_0x23835b(0x1d2)]([database_1[_0x23835b(0xfb)][_0x23835b(0x155)][_0x23835b(0x1b2)]({'where':{'shopId':_0x3b088f['id'],'status':'PAID','gateway':{'not':'test_gateway'}}}),database_1[_0x23835b(0xfb)][_0x23835b(0x155)][_0x23835b(0x106)]({'where':{'shopId':_0x3b088f['id'],'status':_0x23835b(0x12b),'gateway':{'not':'test_gateway'}},'orderBy':{'paidAt':'asc'},'select':{'paidAt':!![]}}),database_1['default'][_0x23835b(0x155)][_0x23835b(0x133)]({'by':[_0x23835b(0x107)],'where':{'shopId':_0x3b088f['id'],'status':_0x23835b(0x12b),'gateway':{'not':_0x23835b(0x1da)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x311d1f=new Date(),_0x38f9ff=new Date(_0x311d1f[_0x23835b(0x1f6)](),_0x311d1f[_0x23835b(0x108)](),0x1),_0xa10323=new Date(_0x311d1f[_0x23835b(0x1f6)](),_0x311d1f['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x3a4314,_0x5527b2]=await Promise[_0x23835b(0x1d2)]([database_1[_0x23835b(0xfb)]['payout']['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x3b088f['id'],'status':_0x23835b(0x180)}}),database_1[_0x23835b(0xfb)][_0x23835b(0x143)][_0x23835b(0x1a8)]({'_sum':{'amount':!![]},'where':{'shopId':_0x3b088f['id'],'status':_0x23835b(0x180),'createdAt':{'gte':_0x38f9ff,'lte':_0xa10323}}})]),_0x525d17=_0x3a4314[_0x23835b(0x1e6)][_0x23835b(0x1b1)]||0x0,_0x5d7de9=_0x5527b2['_sum'][_0x23835b(0x1b1)]||0x0,_0x13924c=await Promise['all'](_0x573efb[_0x23835b(0x1e7)](async _0xd7919a=>{const _0x16b1dd=_0x23835b;let _0x561ff2=0xa;if(_0x3b088f['gatewaySettings'])try{const _0x1d667d=JSON[_0x16b1dd(0x154)](_0x3b088f[_0x16b1dd(0x1dc)]);for(const [_0x11e812,_0x5627f2]of Object[_0x16b1dd(0x10a)](_0x1d667d)){if(_0x11e812[_0x16b1dd(0x127)]()===_0xd7919a[_0x16b1dd(0x107)][_0x16b1dd(0x127)]()){_0x561ff2=_0x5627f2[_0x16b1dd(0x1b0)]||0xa,console[_0x16b1dd(0xe5)]('💰\x20[PAYOUT]\x20Gateway\x20'+_0xd7919a[_0x16b1dd(0x107)]+_0x16b1dd(0x138)+_0x3b088f['id']+':\x20commission\x20=\x20'+_0x561ff2+'%');break;}}}catch(_0x5a3398){console[_0x16b1dd(0x189)](_0x16b1dd(0x139)+_0x3b088f['id']+':',_0x5a3398);}const _0x5ee679=_0xd7919a[_0x16b1dd(0x1e6)][_0x16b1dd(0x109)]||0x0,_0x103c6c=_0x5ee679*(0x1-_0x561ff2/0x64);return{'gateway':_0xd7919a[_0x16b1dd(0x107)],'count':_0xd7919a['_count']['id'],'amountUSDT':Math['round'](_0x5ee679*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x16b1dd(0x19a)](_0x103c6c*0x64)/0x64,'commission':_0x561ff2};})),_0x1d9e47=_0x13924c['reduce']((_0x2e4b2a,_0x3199a5)=>_0x2e4b2a+_0x3199a5[_0x23835b(0x109)],0x0),_0x455107=_0x3b088f['balance'];return console[_0x23835b(0xe5)](_0x23835b(0xcf)+_0x3b088f[_0x23835b(0x1b9)]+':'),console[_0x23835b(0xe5)](_0x23835b(0x181)+_0x1d9e47['toFixed'](0x2)+_0x23835b(0x1c3)),console['log']('\x20\x20\x20🔍\x20Calculated\x20after\x20commission:\x20'+_0x13924c[_0x23835b(0x177)]((_0x4f69bf,_0x5f4278)=>_0x4f69bf+_0x5f4278[_0x23835b(0x178)],0x0)[_0x23835b(0x165)](0x2)+'\x20USDT\x20(theoretical\x20net)'),console['log'](_0x23835b(0x1cb)+_0x455107[_0x23835b(0x165)](0x2)+_0x23835b(0x150)),{'id':_0x3b088f['id'],'fullName':_0x3b088f['name'],'username':_0x3b088f[_0x23835b(0x1b9)],'telegramId':_0x3b088f[_0x23835b(0x111)],'merchantUrl':_0x3b088f[_0x23835b(0x1de)],'wallets':{'usdtPolygonWallet':_0x3b088f[_0x23835b(0x142)],'usdtTrcWallet':_0x3b088f['usdtTrcWallet'],'usdtErcWallet':_0x3b088f[_0x23835b(0x1a9)],'usdcPolygonWallet':_0x3b088f[_0x23835b(0x157)]},'totalAmountUSDT':Math[_0x23835b(0x19a)](_0x1d9e47*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x23835b(0x19a)](_0x455107*0x64)/0x64,'totalPayout':Math[_0x23835b(0x19a)](_0x525d17*0x64)/0x64,'thisMonth':Math[_0x23835b(0x19a)](_0x5d7de9*0x64)/0x64,'paymentsCount':_0x47b355,'oldestPaymentDate':_0x2adaea?.[_0x23835b(0x1ad)]||_0x3b088f[_0x23835b(0x12f)],'gatewayBreakdown':_0x13924c};})),_0x40d55b=_0x41f4fb[_0x2cc321(0x177)]((_0x111450,_0x28168c)=>_0x111450+_0x28168c[_0x2cc321(0xe2)],0x0),_0x4bb0f0=_0x41f4fb[_0x2cc321(0x177)]((_0x319fa8,_0x688eb5)=>_0x319fa8+_0x688eb5[_0x2cc321(0x135)],0x0),_0x4799e1=_0x41f4fb['reduce']((_0x32a9d5,_0x344a26)=>_0x32a9d5+_0x344a26['totalPayout'],0x0),_0x4649b7=_0x41f4fb[_0x2cc321(0x177)]((_0x190a81,_0x416002)=>_0x190a81+_0x416002[_0x2cc321(0x1b6)],0x0);return console[_0x2cc321(0xe5)]('📊\x20Merchants\x20awaiting\x20payout:\x20'+_0x39141d+'\x20merchants'),console[_0x2cc321(0xe5)](_0x2cc321(0x1d4)+Math['round'](_0x40d55b*0x64)/0x64+'\x20USDT\x20(gross\x20revenue)'),console[_0x2cc321(0xe5)](_0x2cc321(0x14d)+Math[_0x2cc321(0x19a)](_0x4bb0f0*0x64)/0x64+_0x2cc321(0x194)),console[_0x2cc321(0xe5)](_0x2cc321(0x11c)+Math[_0x2cc321(0x19a)](_0x4799e1*0x64)/0x64+'\x20USDT'),console[_0x2cc321(0xe5)](_0x2cc321(0xeb)+Math[_0x2cc321(0x19a)](_0x4649b7*0x64)/0x64+_0x2cc321(0x1c8)),{'merchants':_0x41f4fb,'pagination':{'page':_0x1b5d8e,'limit':_0x26c7f7,'total':_0x39141d,'totalPages':Math[_0x2cc321(0x1e2)](_0x39141d/_0x26c7f7)},'summary':{'totalMerchants':_0x39141d,'totalAmountUSDT':Math['round'](_0x40d55b*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x2cc321(0x19a)](_0x4bb0f0*0x64)/0x64,'totalPayout':Math[_0x2cc321(0x19a)](_0x4799e1*0x64)/0x64,'thisMonth':Math[_0x2cc321(0x19a)](_0x4649b7*0x64)/0x64}};}async[a35_0x11039f(0x15f)](_0x191873){const _0x217aa5=a35_0x11039f,{shopId:_0x12826d,amount:_0xaead65,network:_0x18dbc6,wallet:_0x2af8ad,notes:_0x5bbb1b,txid:_0x2af524,periodFrom:_0x1ad8ce,periodTo:_0x17d2f9}=_0x191873,_0x2dfca6=await database_1[_0x217aa5(0xfb)][_0x217aa5(0x153)](async _0x250c03=>{const _0x3b4298=_0x217aa5,_0x4e4428=await _0x250c03['shop'][_0x3b4298(0x1a1)]({'where':{'id':_0x12826d},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x4e4428)throw new Error(_0x3b4298(0xcd));console['log'](_0x3b4298(0x184)+_0x4e4428[_0x3b4298(0x1b9)]+':'),console[_0x3b4298(0xe5)](_0x3b4298(0xda)+_0x4e4428[_0x3b4298(0x1e3)]['toFixed'](0x6)+_0x3b4298(0x1c8)),console['log'](_0x3b4298(0x121)+_0xaead65[_0x3b4298(0x165)](0x6)+_0x3b4298(0x1c8)),console['log']('\x20\x20\x20Current\x20total\x20paid\x20out:\x20'+_0x4e4428[_0x3b4298(0x176)][_0x3b4298(0x165)](0x6)+_0x3b4298(0x1c8));if(_0x2af524)console['log'](_0x3b4298(0x13f)+_0x2af524);if(_0x4e4428[_0x3b4298(0x1e3)]<_0xaead65)throw new Error(_0x3b4298(0x1c4)+_0x4e4428[_0x3b4298(0x1e3)][_0x3b4298(0x165)](0x6)+_0x3b4298(0x10c)+_0xaead65[_0x3b4298(0x165)](0x6)+_0x3b4298(0x1c8));let _0xb8b915=_0x2af8ad;if(!_0xb8b915){const _0x32856f=await _0x250c03['shop'][_0x3b4298(0x1a1)]({'where':{'id':_0x12826d},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x32856f)switch(_0x18dbc6){case'polygon':_0xb8b915=_0x32856f[_0x3b4298(0x142)]||undefined;break;case _0x3b4298(0xee):_0xb8b915=_0x32856f[_0x3b4298(0x1d8)]||undefined;break;case'erc20':_0xb8b915=_0x32856f['usdtErcWallet']||undefined;break;case _0x3b4298(0xff):_0xb8b915=_0x32856f[_0x3b4298(0x157)]||undefined;break;}}console[_0x3b4298(0xe5)]('💳\x20Payout\x20wallet\x20for\x20'+_0x18dbc6+':\x20'+(_0xb8b915||_0x3b4298(0x1ac)));const _0x51f3e0=await _0x250c03[_0x3b4298(0x143)][_0x3b4298(0x17d)]({'data':{'shopId':_0x12826d,'amount':_0xaead65,'network':_0x18dbc6,'status':_0x3b4298(0x180),'txid':_0x2af524,'notes':_0x5bbb1b,'periodFrom':_0x1ad8ce?new Date(_0x1ad8ce):null,'periodTo':_0x17d2f9?new Date(_0x17d2f9):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x341c6a=_0x4e4428[_0x3b4298(0x1e3)]-_0xaead65,_0x3c3afa=_0x4e4428[_0x3b4298(0x176)]+_0xaead65;return await _0x250c03[_0x3b4298(0x193)][_0x3b4298(0x1f3)]({'where':{'id':_0x12826d},'data':{'balance':_0x341c6a,'totalPaidOut':_0x3c3afa}}),console[_0x3b4298(0xe5)](_0x3b4298(0xf7)+_0x4e4428[_0x3b4298(0x1b9)]+_0x3b4298(0xf6)),console[_0x3b4298(0xe5)](_0x3b4298(0xfe)+_0x4e4428[_0x3b4298(0x1e3)][_0x3b4298(0x165)](0x6)+'\x20->\x20'+_0x341c6a[_0x3b4298(0x165)](0x6)+'\x20USDT\x20(-'+_0xaead65[_0x3b4298(0x165)](0x6)+')'),console[_0x3b4298(0xe5)](_0x3b4298(0x10b)+_0x4e4428['totalPaidOut'][_0x3b4298(0x165)](0x6)+_0x3b4298(0x118)+_0x3c3afa[_0x3b4298(0x165)](0x6)+_0x3b4298(0xf4)+_0xaead65['toFixed'](0x6)+')'),{'payout':_0x51f3e0,'shop':_0x4e4428};});return console[_0x217aa5(0xe5)]('✅\x20Payout\x20created:\x20'+_0x2dfca6[_0x217aa5(0x143)]['id']+_0x217aa5(0x138)+_0x2dfca6[_0x217aa5(0x193)][_0x217aa5(0x1b9)]+'\x20('+_0xaead65+_0x217aa5(0x1cf)),{'id':_0x2dfca6[_0x217aa5(0x143)]['id'],'shopId':_0x2dfca6[_0x217aa5(0x143)][_0x217aa5(0x12a)],'shopName':_0x2dfca6['shop'][_0x217aa5(0x1e0)],'shopUsername':_0x2dfca6[_0x217aa5(0x193)][_0x217aa5(0x1b9)],'amount':_0x2dfca6[_0x217aa5(0x143)][_0x217aa5(0x1b1)],'network':_0x2dfca6[_0x217aa5(0x143)]['network'],'status':_0x2dfca6[_0x217aa5(0x143)][_0x217aa5(0x124)],'txid':_0x2dfca6[_0x217aa5(0x143)]['txid'],'notes':_0x2dfca6[_0x217aa5(0x143)][_0x217aa5(0x156)],'periodFrom':_0x2dfca6[_0x217aa5(0x143)]['periodFrom'],'periodTo':_0x2dfca6[_0x217aa5(0x143)][_0x217aa5(0x13e)],'createdAt':_0x2dfca6[_0x217aa5(0x143)][_0x217aa5(0x12f)],'paidAt':_0x2dfca6[_0x217aa5(0x143)]['paidAt']};}async[a35_0x11039f(0x1bf)](_0x4ab04e){const _0x4c4c1e=a35_0x11039f,{page:_0x5ae396,limit:_0x27205e,shopId:_0x1c95ae,network:_0x23e0f2,dateFrom:_0x5658c4,dateTo:_0x2c27b4,search:_0x18e58e}=_0x4ab04e,_0x51ab00=(_0x5ae396-0x1)*_0x27205e,_0x96537d={};_0x1c95ae&&(_0x96537d[_0x4c4c1e(0x12a)]=_0x1c95ae);_0x23e0f2&&(_0x96537d[_0x4c4c1e(0x113)]=_0x23e0f2);(_0x5658c4||_0x2c27b4)&&(_0x96537d[_0x4c4c1e(0x12f)]={},_0x5658c4&&(_0x96537d['createdAt'][_0x4c4c1e(0x131)]=new Date(_0x5658c4)),_0x2c27b4&&(_0x96537d['createdAt']['lte']=new Date(_0x2c27b4)));_0x18e58e&&(_0x96537d['OR']=[{'shop':{'name':{'contains':_0x18e58e,'mode':_0x4c4c1e(0x186)}}},{'shop':{'username':{'contains':_0x18e58e,'mode':_0x4c4c1e(0x186)}}},{'notes':{'contains':_0x18e58e,'mode':_0x4c4c1e(0x186)}}]);const [_0x3b2f8b,_0x2c9fb2]=await Promise[_0x4c4c1e(0x1d2)]([database_1['default'][_0x4c4c1e(0x143)][_0x4c4c1e(0x130)]({'where':_0x96537d,'skip':_0x51ab00,'take':_0x27205e,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x4c4c1e(0x143)]['count']({'where':_0x96537d})]);return{'payouts':_0x3b2f8b[_0x4c4c1e(0x1e7)](_0xb75c78=>({'id':_0xb75c78['id'],'shopId':_0xb75c78['shopId'],'shopName':_0xb75c78[_0x4c4c1e(0x193)][_0x4c4c1e(0x1e0)],'shopUsername':_0xb75c78['shop'][_0x4c4c1e(0x1b9)],'amount':_0xb75c78[_0x4c4c1e(0x1b1)],'network':_0xb75c78[_0x4c4c1e(0x113)],'status':_0xb75c78[_0x4c4c1e(0x124)],'txid':_0xb75c78[_0x4c4c1e(0x162)],'notes':_0xb75c78[_0x4c4c1e(0x156)],'periodFrom':_0xb75c78[_0x4c4c1e(0x192)],'periodTo':_0xb75c78[_0x4c4c1e(0x13e)],'createdAt':_0xb75c78[_0x4c4c1e(0x12f)],'paidAt':_0xb75c78[_0x4c4c1e(0x1ad)]})),'pagination':{'page':_0x5ae396,'limit':_0x27205e,'total':_0x2c9fb2,'totalPages':Math[_0x4c4c1e(0x1e2)](_0x2c9fb2/_0x27205e)}};}async[a35_0x11039f(0x1ed)](_0x1cf89e){const _0x1f039b=a35_0x11039f,_0x267419=await database_1[_0x1f039b(0xfb)][_0x1f039b(0x143)][_0x1f039b(0x1a1)]({'where':{'id':_0x1cf89e},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x267419)return null;return{'id':_0x267419['id'],'shopId':_0x267419[_0x1f039b(0x12a)],'shopName':_0x267419['shop'][_0x1f039b(0x1e0)],'shopUsername':_0x267419[_0x1f039b(0x193)]['username'],'amount':_0x267419['amount'],'network':_0x267419[_0x1f039b(0x113)],'status':_0x267419['status'],'txid':_0x267419['txid'],'notes':_0x267419['notes'],'periodFrom':_0x267419[_0x1f039b(0x192)],'periodTo':_0x267419[_0x1f039b(0x13e)],'createdAt':_0x267419[_0x1f039b(0x12f)],'paidAt':_0x267419[_0x1f039b(0x1ad)]};}async['deletePayout'](_0x5c5a66){const _0xd4bb63=a35_0x11039f;await database_1['default'][_0xd4bb63(0x143)][_0xd4bb63(0x1db)]({'where':{'id':_0x5c5a66}});}async[a35_0x11039f(0xd2)](_0x4bb693){const _0x47cd3b=a35_0x11039f,{page:_0x40a21d,limit:_0x1d664b,status:_0x3e3fad,gateway:_0x1602cf,shopId:_0x4b1d7c,dateFrom:_0x518465,dateTo:_0x4dd7c7,search:_0x48f96b,currency:_0x292a3f,sortBy:_0x47bb01,sortOrder:_0x529ad0}=_0x4bb693,_0x3ebd8f=(_0x40a21d-0x1)*_0x1d664b;console['log'](_0x47cd3b(0x12d),_0x4bb693);const _0x4cbdad=await database_1['default'][_0x47cd3b(0x155)][_0x47cd3b(0x133)]({'by':[_0x47cd3b(0x107)],'_count':{'gateway':!![]}});console[_0x47cd3b(0xe5)](_0x47cd3b(0xed),_0x4cbdad[_0x47cd3b(0x1e7)](_0x2078ce=>_0x2078ce[_0x47cd3b(0x107)]+'\x20('+_0x2078ce[_0x47cd3b(0x1ce)][_0x47cd3b(0x107)]+_0x47cd3b(0x1d7)));if(_0x1602cf){const _0x1a336d=_0x4cbdad[_0x47cd3b(0x187)](_0xc9d54e=>_0xc9d54e[_0x47cd3b(0x107)][_0x47cd3b(0x127)]()===_0x1602cf[_0x47cd3b(0x127)]());!_0x1a336d&&_0x1602cf[_0x47cd3b(0x127)]()!==_0x47cd3b(0x1da)&&console[_0x47cd3b(0xe5)](_0x47cd3b(0x1ba)+_0x1602cf+'\x27\x20not\x20found.\x20Available\x20gateways:\x20'+_0x4cbdad[_0x47cd3b(0x1e7)](_0x32ef54=>_0x32ef54[_0x47cd3b(0x107)])['join'](',\x20'));}const _0x1fcac5={};_0x3e3fad&&(_0x1fcac5[_0x47cd3b(0x124)]=_0x3e3fad[_0x47cd3b(0x102)]());if(!_0x1602cf)_0x1fcac5[_0x47cd3b(0x107)]={'not':'test_gateway'};else{if(_0x1602cf&&(_0x1602cf['toLowerCase']()===_0x47cd3b(0x1da)||_0x1602cf===_0x47cd3b(0x123)))_0x1fcac5[_0x47cd3b(0x107)]=_0x47cd3b(0x1da);else{let _0x18dd55=_0x1602cf;const _0x372695=(0x0,gateway_1[_0x47cd3b(0x12c)])(_0x1602cf);if(_0x372695)_0x18dd55=_0x372695,console[_0x47cd3b(0xe5)](_0x47cd3b(0x1ea)+_0x1602cf+_0x47cd3b(0x1d3)+_0x18dd55+'\x27');else{const _0x38c501=(0x0,gateway_1[_0x47cd3b(0x167)])(_0x1602cf);if(_0x38c501){const _0x2c30a1=(0x0,gateway_1['getGatewayNameById'])(_0x38c501);_0x2c30a1&&(_0x18dd55=_0x2c30a1,console['log'](_0x47cd3b(0x1f7)+_0x1602cf+_0x47cd3b(0xd3)+_0x38c501+_0x47cd3b(0x117)+_0x18dd55+'\x27'));}else console[_0x47cd3b(0xe5)](_0x47cd3b(0xe9)+_0x1602cf+'\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)');}const _0x1406a3=await database_1[_0x47cd3b(0xfb)][_0x47cd3b(0x155)][_0x47cd3b(0x1b2)]({'where':{'gateway':_0x18dd55['toLowerCase']()},'take':0x1});_0x1406a3===0x0?(console[_0x47cd3b(0xe5)](_0x47cd3b(0x137)+_0x18dd55+'\x27\x20(from\x20\x27'+_0x1602cf+_0x47cd3b(0x1e5)),_0x1fcac5['gateway']=_0x47cd3b(0xce)):(_0x1fcac5[_0x47cd3b(0x107)]=_0x18dd55[_0x47cd3b(0x127)](),console[_0x47cd3b(0xe5)](_0x47cd3b(0x1c7)+_0x18dd55+_0x47cd3b(0xe7)+_0x1602cf+'\x27)'));}}console['log']('📊\x20Gateway\x20filter\x20applied:',_0x1fcac5[_0x47cd3b(0x107)]);_0x4b1d7c&&(_0x1fcac5['shopId']=_0x4b1d7c);_0x292a3f&&(_0x1fcac5[_0x47cd3b(0x1d6)]=_0x292a3f[_0x47cd3b(0x102)](),console['log']('💱\x20Currency\x20filter\x20applied:\x20'+_0x292a3f[_0x47cd3b(0x102)]()));(_0x518465||_0x4dd7c7)&&(_0x1fcac5['createdAt']={},_0x518465&&(_0x1fcac5[_0x47cd3b(0x12f)][_0x47cd3b(0x131)]=new Date(_0x518465)),_0x4dd7c7&&(_0x1fcac5[_0x47cd3b(0x12f)][_0x47cd3b(0x190)]=new Date(_0x4dd7c7)));_0x48f96b&&(_0x1fcac5['OR']=[{'id':{'contains':_0x48f96b,'mode':'insensitive'}},{'orderId':{'contains':_0x48f96b,'mode':'insensitive'}},{'gatewayOrderId':{'contains':_0x48f96b,'mode':'insensitive'}},{'customerEmail':{'contains':_0x48f96b,'mode':'insensitive'}},{'shop':{'name':{'contains':_0x48f96b,'mode':_0x47cd3b(0x186)}}},{'shop':{'username':{'contains':_0x48f96b,'mode':_0x47cd3b(0x186)}}}]);console[_0x47cd3b(0xe5)](_0x47cd3b(0x14f),JSON[_0x47cd3b(0x149)](_0x1fcac5,null,0x2));let _0xccd98b={'createdAt':'desc'};if(_0x47bb01){const _0x128961=[_0x47cd3b(0x1b1),_0x47cd3b(0x12f),_0x47cd3b(0x182),_0x47cd3b(0x124),_0x47cd3b(0x107),_0x47cd3b(0x1d6)],_0x27c32c=[_0x47cd3b(0x1c9),_0x47cd3b(0x13c)];if(_0x128961['includes'](_0x47bb01)){const _0x402b1e=_0x27c32c['includes'](_0x529ad0)?_0x529ad0:'desc';_0xccd98b={[_0x47bb01]:_0x402b1e},console[_0x47cd3b(0xe5)]('📊\x20Sorting\x20payments\x20by\x20'+_0x47bb01+_0x47cd3b(0x1a0)+_0x402b1e+_0x47cd3b(0x15a));}}const [_0x44e3a7,_0x30fc7b]=await Promise[_0x47cd3b(0x1d2)]([database_1['default']['payment'][_0x47cd3b(0x130)]({'where':_0x1fcac5,'skip':_0x3ebd8f,'take':_0x1d664b,'orderBy':_0xccd98b,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x47cd3b(0xfb)]['payment']['count']({'where':_0x1fcac5})]);return{'payments':_0x44e3a7,'pagination':{'page':_0x40a21d,'limit':_0x1d664b,'total':_0x30fc7b,'totalPages':Math[_0x47cd3b(0x1e2)](_0x30fc7b/_0x1d664b)}};}async[a35_0x11039f(0x18e)](_0x411aaa){const _0xc2c61a=a35_0x11039f,_0x451b28=await database_1[_0xc2c61a(0xfb)]['payment'][_0xc2c61a(0x1a1)]({'where':{'id':_0x411aaa},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x451b28)return null;return{'id':_0x451b28['id'],'shopId':_0x451b28[_0xc2c61a(0x12a)],'gateway':_0x451b28[_0xc2c61a(0x107)],'amount':_0x451b28[_0xc2c61a(0x1b1)],'currency':_0x451b28[_0xc2c61a(0x1d6)],'status':_0x451b28[_0xc2c61a(0x124)],'orderId':_0x451b28[_0xc2c61a(0x1ca)],'gatewayOrderId':_0x451b28[_0xc2c61a(0xea)],'customerEmail':_0x451b28['customerEmail'],'customerName':_0x451b28[_0xc2c61a(0x1f4)],'customerCountry':_0x451b28[_0xc2c61a(0x172)],'customerIp':_0x451b28['customerIp'],'customerUa':_0x451b28[_0xc2c61a(0x1d5)],'failureMessage':_0x451b28[_0xc2c61a(0x125)],'externalPaymentUrl':_0x451b28[_0xc2c61a(0xdf)],'successUrl':_0x451b28[_0xc2c61a(0x1ab)],'failUrl':_0x451b28[_0xc2c61a(0x1be)],'pendingUrl':_0x451b28[_0xc2c61a(0x196)],'whiteUrl':_0x451b28['whiteUrl'],'createdAt':_0x451b28[_0xc2c61a(0x12f)],'updatedAt':_0x451b28[_0xc2c61a(0x182)],'shop':_0x451b28[_0xc2c61a(0x193)]};}async[a35_0x11039f(0xf2)](_0x39306b,_0xa81eb8,_0x223f30,_0x29af96){const _0x37670d=a35_0x11039f,_0x35cbc9=await database_1[_0x37670d(0xfb)][_0x37670d(0x153)](async _0x499f33=>{const _0x2871d2=_0x37670d,_0x1eec5d=await _0x499f33[_0x2871d2(0x155)][_0x2871d2(0x1a1)]({'where':{'id':_0x39306b},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x1eec5d)throw new Error(_0x2871d2(0x1f5));const _0xaf44c3=_0x1eec5d['status'],_0x35e3e8=_0xa81eb8[_0x2871d2(0x102)]();console[_0x2871d2(0xe5)](_0x2871d2(0x183)+_0x39306b+'\x20status:\x20'+_0xaf44c3+_0x2871d2(0x118)+_0x35e3e8),console[_0x2871d2(0xe5)](_0x2871d2(0x169)+_0x1eec5d[_0x2871d2(0x193)]['balance']+'\x20USDT');const _0x1c7144={'status':_0x35e3e8,'updatedAt':new Date(),'statusChangedBy':_0x2871d2(0x191),'statusChangedAt':new Date()};_0x223f30&&(_0x1c7144[_0x2871d2(0x1eb)]=_0x223f30);_0x35e3e8===_0x2871d2(0x13d)&&_0x29af96&&(_0x1c7144[_0x2871d2(0x1a7)]=_0x29af96);let _0x1c889e=0x0,_0x5804e5=_0x1eec5d[_0x2871d2(0x193)][_0x2871d2(0x1e3)];if(_0x35e3e8===_0x2871d2(0x12b)&&_0xaf44c3!=='PAID'){_0x1c7144[_0x2871d2(0x1ad)]=new Date();const _0x1f7a54=await currencyService_1['currencyService'][_0x2871d2(0x100)](_0x1eec5d[_0x2871d2(0x1b1)],_0x1eec5d[_0x2871d2(0x1d6)]);_0x1c7144[_0x2871d2(0x109)]=_0x1f7a54;let _0x3f6eb8=0xa;const _0x229b56=await _0x499f33[_0x2871d2(0x193)]['findUnique']({'where':{'id':_0x1eec5d[_0x2871d2(0x12a)]},'select':{'gatewaySettings':!![]}});if(_0x229b56?.[_0x2871d2(0x1dc)])try{const _0x7d5454=JSON[_0x2871d2(0x154)](_0x229b56['gatewaySettings']);for(const [_0x3dc3fe,_0x39b053]of Object[_0x2871d2(0x10a)](_0x7d5454)){if(_0x3dc3fe[_0x2871d2(0x127)]()===_0x1eec5d[_0x2871d2(0x107)]['toLowerCase']()){_0x3f6eb8=_0x39b053[_0x2871d2(0x1b0)]||0xa;break;}}}catch(_0xc3d53a){console['error'](_0x2871d2(0x129)+_0x39306b+':',_0xc3d53a);}const _0x421a03=_0x1f7a54*(0x1-_0x3f6eb8/0x64);_0x1c889e=_0x421a03,_0x5804e5+=_0x421a03,console[_0x2871d2(0xe5)](_0x2871d2(0x16c)+_0x39306b+_0x2871d2(0x160)),console['log'](_0x2871d2(0x147)+_0x1f7a54[_0x2871d2(0x165)](0x6)+'\x20USDT'),console[_0x2871d2(0xe5)](_0x2871d2(0x105)+_0x1eec5d[_0x2871d2(0x107)]+_0x2871d2(0x1b3)+_0x3f6eb8+'%'),console[_0x2871d2(0xe5)](_0x2871d2(0x1e4)+_0x421a03[_0x2871d2(0x165)](0x6)+_0x2871d2(0x15d)+_0x3f6eb8+_0x2871d2(0x174)),console['log']('\x20\x20\x20Added\x20to\x20balance:\x20+'+_0x421a03[_0x2871d2(0x165)](0x6)+_0x2871d2(0x1c8));}else{if(_0xaf44c3==='PAID'&&_0x35e3e8!==_0x2871d2(0x12b)){if(_0x1eec5d[_0x2871d2(0x109)]){let _0x31a177=0xa;const _0x6f7903=await _0x499f33[_0x2871d2(0x193)][_0x2871d2(0x1a1)]({'where':{'id':_0x1eec5d['shopId']},'select':{'gatewaySettings':!![]}});if(_0x6f7903?.[_0x2871d2(0x1dc)])try{const _0x2e4545=JSON[_0x2871d2(0x154)](_0x6f7903[_0x2871d2(0x1dc)]);for(const [_0x28a769,_0x251a73]of Object['entries'](_0x2e4545)){if(_0x28a769[_0x2871d2(0x127)]()===_0x1eec5d[_0x2871d2(0x107)]['toLowerCase']()){_0x31a177=_0x251a73['commission']||0xa;break;}}}catch(_0x25a1fd){console[_0x2871d2(0x189)]('Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20'+_0x39306b+':',_0x25a1fd);}const _0x3ea26c=_0x1eec5d[_0x2871d2(0x109)]*(0x1-_0x31a177/0x64);_0x1c889e=-_0x3ea26c,_0x5804e5-=_0x3ea26c,_0x1c7144[_0x2871d2(0x109)]=null,console[_0x2871d2(0xe5)](_0x2871d2(0x16c)+_0x39306b+_0x2871d2(0x103)),console[_0x2871d2(0xe5)]('\x20\x20\x20Full\x20amount:\x20'+_0x1eec5d[_0x2871d2(0x109)][_0x2871d2(0x165)](0x6)+_0x2871d2(0x1c8)),console[_0x2871d2(0xe5)]('\x20\x20\x20Gateway:\x20'+_0x1eec5d[_0x2871d2(0x107)]+_0x2871d2(0x1b3)+_0x31a177+'%'),console[_0x2871d2(0xe5)](_0x2871d2(0x19f)+_0x3ea26c[_0x2871d2(0x165)](0x6)+_0x2871d2(0x15d)+_0x31a177+_0x2871d2(0x174)),console[_0x2871d2(0xe5)](_0x2871d2(0x14e)+_0x3ea26c[_0x2871d2(0x165)](0x6)+_0x2871d2(0x1c8));}}}_0x35e3e8===_0x2871d2(0x13d)&&(_0xaf44c3===_0x2871d2(0x12b)&&_0x1eec5d[_0x2871d2(0x109)]&&console['log']('💸\x20CHARGEBACK:\x20Merchant\x20amount\x20already\x20deducted\x20from\x20balance'),_0x29af96&&_0x29af96>0x0&&(_0x1c889e-=_0x29af96,_0x5804e5-=_0x29af96,console[_0x2871d2(0xe5)](_0x2871d2(0x128)+_0x29af96[_0x2871d2(0x165)](0x6)+_0x2871d2(0x17e))));_0x35e3e8===_0x2871d2(0x179)&&_0xaf44c3===_0x2871d2(0x12b)&&console[_0x2871d2(0xe5)]('🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance');const _0x2e10fa=await _0x499f33[_0x2871d2(0x155)][_0x2871d2(0x1f3)]({'where':{'id':_0x39306b},'data':_0x1c7144,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x1c889e!==0x0&&(await _0x499f33[_0x2871d2(0x193)][_0x2871d2(0x1f3)]({'where':{'id':_0x1eec5d['shopId']},'data':{'balance':_0x5804e5}}),console[_0x2871d2(0xe5)](_0x2871d2(0xf7)+_0x1eec5d[_0x2871d2(0x12a)]+_0x2871d2(0x195)+_0x1eec5d['shop'][_0x2871d2(0x1e3)][_0x2871d2(0x165)](0x6)+_0x2871d2(0x118)+_0x5804e5['toFixed'](0x6)+_0x2871d2(0x11d)+(_0x1c889e>0x0?'+':'')+_0x1c889e[_0x2871d2(0x165)](0x6)+')')),_0x2e10fa;});return{'id':_0x35cbc9['id'],'shopId':_0x35cbc9[_0x37670d(0x12a)],'gateway':_0x35cbc9['gateway'],'amount':_0x35cbc9[_0x37670d(0x1b1)],'currency':_0x35cbc9[_0x37670d(0x1d6)],'status':_0x35cbc9['status'],'orderId':_0x35cbc9['orderId'],'gatewayOrderId':_0x35cbc9['gatewayOrderId'],'customerEmail':_0x35cbc9[_0x37670d(0x15b)],'customerName':_0x35cbc9[_0x37670d(0x1f4)],'customerCountry':_0x35cbc9[_0x37670d(0x172)],'customerIp':_0x35cbc9[_0x37670d(0x116)],'customerUa':_0x35cbc9['customerUa'],'failureMessage':_0x35cbc9[_0x37670d(0x125)],'adminNotes':_0x35cbc9[_0x37670d(0x1eb)],'chargebackAmount':_0x35cbc9['chargebackAmount'],'statusChangedBy':_0x35cbc9[_0x37670d(0x158)],'statusChangedAt':_0x35cbc9[_0x37670d(0x141)],'createdAt':_0x35cbc9['createdAt'],'updatedAt':_0x35cbc9[_0x37670d(0x182)],'shop':_0x35cbc9[_0x37670d(0x193)]};}async[a35_0x11039f(0x1af)](_0x3f5d77,_0x5296df){const _0x161e26=a35_0x11039f,_0xe86fea={..._0x5296df};_0x5296df['password']&&(_0xe86fea[_0x161e26(0x120)]=await bcryptjs_1['default']['hash'](_0x5296df['password'],0xc));_0x5296df[_0x161e26(0xfc)]&&(_0xe86fea['name']=_0x5296df[_0x161e26(0xfc)],delete _0xe86fea['fullName']);_0x5296df['telegramId']&&(_0xe86fea['telegram']=_0x5296df['telegramId'],delete _0xe86fea[_0x161e26(0x122)]);_0x5296df['merchantUrl']&&(_0xe86fea[_0x161e26(0x1de)]=_0x5296df[_0x161e26(0x1a4)],delete _0xe86fea[_0x161e26(0x1a4)]);if(_0x5296df[_0x161e26(0x1f1)]){const _0xfeee8c=_0x5296df['gateways'][_0x161e26(0x1e7)](_0x61f8a5=>this[_0x161e26(0x1e9)](_0x61f8a5));console[_0x161e26(0xe5)](_0x161e26(0xe3),_0x5296df[_0x161e26(0x1f1)],'->',_0xfeee8c),_0xe86fea[_0x161e26(0xf0)]=JSON['stringify'](_0xfeee8c),delete _0xe86fea[_0x161e26(0x1f1)];}_0x5296df['gatewaySettings']&&(_0xe86fea[_0x161e26(0x1dc)]=JSON[_0x161e26(0x149)](_0x5296df['gatewaySettings']),delete _0xe86fea[_0x161e26(0x1dc)]);_0x5296df['wallets']&&(_0x5296df['wallets']['usdtPolygonWallet']!==undefined&&(_0xe86fea[_0x161e26(0x142)]=_0x5296df['wallets'][_0x161e26(0x142)]||null),_0x5296df['wallets']['usdtTrcWallet']!==undefined&&(_0xe86fea[_0x161e26(0x1d8)]=_0x5296df[_0x161e26(0x1ec)][_0x161e26(0x1d8)]||null),_0x5296df['wallets']['usdtErcWallet']!==undefined&&(_0xe86fea[_0x161e26(0x1a9)]=_0x5296df['wallets'][_0x161e26(0x1a9)]||null),_0x5296df[_0x161e26(0x1ec)][_0x161e26(0x157)]!==undefined&&(_0xe86fea[_0x161e26(0x157)]=_0x5296df[_0x161e26(0x1ec)]['usdcPolygonWallet']||null),delete _0xe86fea[_0x161e26(0x1ec)]);const _0x1adbff=await database_1[_0x161e26(0xfb)]['shop'][_0x161e26(0x1f3)]({'where':{'id':_0x3f5d77},'data':_0xe86fea,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x1adbff['id'],'fullName':_0x1adbff[_0x161e26(0x1e0)],'username':_0x1adbff[_0x161e26(0x1b9)],'telegramId':_0x1adbff['telegram'],'merchantUrl':_0x1adbff[_0x161e26(0x1de)],'gateways':_0x1adbff[_0x161e26(0xf0)]?JSON[_0x161e26(0x154)](_0x1adbff[_0x161e26(0xf0)]):null,'gatewaySettings':_0x1adbff[_0x161e26(0x1dc)]?JSON[_0x161e26(0x154)](_0x1adbff['gatewaySettings']):null,'publicKey':_0x1adbff['publicKey'],'wallets':{'usdtPolygonWallet':_0x1adbff[_0x161e26(0x142)],'usdtTrcWallet':_0x1adbff[_0x161e26(0x1d8)],'usdtErcWallet':_0x1adbff[_0x161e26(0x1a9)],'usdcPolygonWallet':_0x1adbff[_0x161e26(0x157)]},'status':_0x1adbff[_0x161e26(0x124)],'createdAt':_0x1adbff['createdAt']};}async[a35_0x11039f(0x13b)](_0x4318f4){const _0x1bc70d=a35_0x11039f,_0x214a3a=await database_1[_0x1bc70d(0xfb)][_0x1bc70d(0x193)]['update']({'where':{'id':_0x4318f4},'data':{'status':_0x1bc70d(0x16b)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x214a3a['id'],'fullName':_0x214a3a[_0x1bc70d(0x1e0)],'username':_0x214a3a['username'],'telegramId':_0x214a3a[_0x1bc70d(0x111)],'merchantUrl':_0x214a3a[_0x1bc70d(0x1de)],'gateways':_0x214a3a['paymentGateways']?JSON[_0x1bc70d(0x154)](_0x214a3a[_0x1bc70d(0xf0)]):null,'gatewaySettings':_0x214a3a[_0x1bc70d(0x1dc)]?JSON[_0x1bc70d(0x154)](_0x214a3a[_0x1bc70d(0x1dc)]):null,'publicKey':_0x214a3a[_0x1bc70d(0x16f)],'wallets':{'usdtPolygonWallet':_0x214a3a[_0x1bc70d(0x142)],'usdtTrcWallet':_0x214a3a['usdtTrcWallet'],'usdtErcWallet':_0x214a3a[_0x1bc70d(0x1a9)],'usdcPolygonWallet':_0x214a3a[_0x1bc70d(0x157)]},'status':_0x214a3a[_0x1bc70d(0x124)],'createdAt':_0x214a3a['createdAt']};}async['activateUser'](_0x37f09d){const _0x250d40=a35_0x11039f,_0x556302=await database_1[_0x250d40(0xfb)][_0x250d40(0x193)]['update']({'where':{'id':_0x37f09d},'data':{'status':_0x250d40(0x1aa)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x556302['id'],'fullName':_0x556302[_0x250d40(0x1e0)],'username':_0x556302[_0x250d40(0x1b9)],'telegramId':_0x556302['telegram'],'merchantUrl':_0x556302[_0x250d40(0x1de)],'gateways':_0x556302[_0x250d40(0xf0)]?JSON[_0x250d40(0x154)](_0x556302[_0x250d40(0xf0)]):null,'gatewaySettings':_0x556302[_0x250d40(0x1dc)]?JSON[_0x250d40(0x154)](_0x556302[_0x250d40(0x1dc)]):null,'publicKey':_0x556302[_0x250d40(0x16f)],'wallets':{'usdtPolygonWallet':_0x556302[_0x250d40(0x142)],'usdtTrcWallet':_0x556302['usdtTrcWallet'],'usdtErcWallet':_0x556302[_0x250d40(0x1a9)],'usdcPolygonWallet':_0x556302[_0x250d40(0x157)]},'status':_0x556302[_0x250d40(0x124)],'createdAt':_0x556302[_0x250d40(0x12f)]};}async[a35_0x11039f(0x1c6)](_0x48cd2d){const _0x3df679=a35_0x11039f,{page:_0x2187cb,limit:_0x52e166,status:_0x183943}=_0x48cd2d,_0x5e4459=(_0x2187cb-0x1)*_0x52e166,_0x422a2b={};_0x183943&&(_0x422a2b[_0x3df679(0x124)]=_0x183943[_0x3df679(0x102)]());const [_0x3b2be8,_0x25f012]=await Promise[_0x3df679(0x1d2)]([database_1[_0x3df679(0xfb)][_0x3df679(0x193)]['findMany']({'where':_0x422a2b,'skip':_0x5e4459,'take':_0x52e166,'orderBy':{'createdAt':_0x3df679(0x13c)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1['default'][_0x3df679(0x193)][_0x3df679(0x1b2)]({'where':_0x422a2b})]);return{'users':_0x3b2be8[_0x3df679(0x1e7)](_0x563b3e=>{const _0x496bd0=_0x3df679,_0x9cf3f1=_0x563b3e['paymentGateways']?JSON[_0x496bd0(0x154)](_0x563b3e[_0x496bd0(0xf0)]):null,_0xecd7cc=_0x9cf3f1?_0x9cf3f1[_0x496bd0(0x1e7)](_0x57fa40=>this[_0x496bd0(0xef)](_0x57fa40)):null;return{'id':_0x563b3e['id'],'fullName':_0x563b3e[_0x496bd0(0x1e0)],'username':_0x563b3e[_0x496bd0(0x1b9)],'telegramId':_0x563b3e[_0x496bd0(0x111)],'merchantUrl':_0x563b3e[_0x496bd0(0x1de)],'gateways':_0xecd7cc,'gatewaySettings':_0x563b3e['gatewaySettings']?JSON['parse'](_0x563b3e[_0x496bd0(0x1dc)]):null,'publicKey':_0x563b3e[_0x496bd0(0x16f)],'wallets':{'usdtPolygonWallet':_0x563b3e[_0x496bd0(0x142)],'usdtTrcWallet':_0x563b3e[_0x496bd0(0x1d8)],'usdtErcWallet':_0x563b3e[_0x496bd0(0x1a9)],'usdcPolygonWallet':_0x563b3e[_0x496bd0(0x157)]},'status':_0x563b3e['status'],'createdAt':_0x563b3e[_0x496bd0(0x12f)]};}),'pagination':{'page':_0x2187cb,'limit':_0x52e166,'total':_0x25f012,'totalPages':Math['ceil'](_0x25f012/_0x52e166)}};}async[a35_0x11039f(0x1cd)](_0x3ccaa3){const _0x1203e2=a35_0x11039f,_0x44f4c8=await database_1[_0x1203e2(0xfb)][_0x1203e2(0x193)][_0x1203e2(0x1a1)]({'where':{'id':_0x3ccaa3},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x44f4c8)return null;const _0x578d5d=_0x44f4c8['paymentGateways']?JSON['parse'](_0x44f4c8[_0x1203e2(0xf0)]):null,_0x2ad8b3=_0x578d5d?_0x578d5d[_0x1203e2(0x1e7)](_0x48a03a=>this[_0x1203e2(0xef)](_0x48a03a)):null;return _0x578d5d&&_0x2ad8b3&&console[_0x1203e2(0xe5)]('🔄\x20Gateway\x20mapping\x20(get):',_0x578d5d,'->',_0x2ad8b3),{'id':_0x44f4c8['id'],'fullName':_0x44f4c8[_0x1203e2(0x1e0)],'username':_0x44f4c8[_0x1203e2(0x1b9)],'telegramId':_0x44f4c8[_0x1203e2(0x111)],'merchantUrl':_0x44f4c8['shopUrl'],'gateways':_0x2ad8b3,'gatewaySettings':_0x44f4c8[_0x1203e2(0x1dc)]?JSON['parse'](_0x44f4c8[_0x1203e2(0x1dc)]):null,'publicKey':_0x44f4c8[_0x1203e2(0x16f)],'wallets':{'usdtPolygonWallet':_0x44f4c8[_0x1203e2(0x142)],'usdtTrcWallet':_0x44f4c8[_0x1203e2(0x1d8)],'usdtErcWallet':_0x44f4c8['usdtErcWallet'],'usdcPolygonWallet':_0x44f4c8['usdcPolygonWallet']},'status':_0x44f4c8['status'],'createdAt':_0x44f4c8[_0x1203e2(0x12f)]};}async['createUser'](_0x2a302a){const _0x181337=a35_0x11039f,{fullName:_0x1078f2,username:_0x1b87c2,password:_0x57477c,telegramId:_0x4092d5,merchantUrl:_0x2b6eba,gateways:_0x47a8fb,gatewaySettings:_0x5d42c2,wallets:_0x1b98dc}=_0x2a302a,_0x181b7f=await database_1[_0x181337(0xfb)][_0x181337(0x193)]['findUnique']({'where':{'username':_0x1b87c2}});if(_0x181b7f)throw new Error('Username\x20already\x20exists');if(_0x4092d5){const _0x56353d=await database_1[_0x181337(0xfb)]['shop'][_0x181337(0x1a1)]({'where':{'telegram':_0x4092d5}});if(_0x56353d)throw new Error(_0x181337(0x197));}const _0x44af67=await bcryptjs_1[_0x181337(0xfb)]['hash'](_0x57477c,0xc),_0x49bfcc='pk_'+crypto_1[_0x181337(0xfb)][_0x181337(0xec)](0x20)[_0x181337(0x1c2)](_0x181337(0x1e8)),_0x20483b=_0x181337(0x1b4)+crypto_1[_0x181337(0xfb)][_0x181337(0xec)](0x20)[_0x181337(0x1c2)](_0x181337(0x1e8)),_0x18d9a6=_0x47a8fb?_0x47a8fb[_0x181337(0x1e7)](_0x15543d=>this[_0x181337(0x1e9)](_0x15543d)):null;_0x47a8fb&&_0x18d9a6&&console[_0x181337(0xe5)](_0x181337(0x19c),_0x47a8fb,'->',_0x18d9a6);const _0x5af508=await database_1['default'][_0x181337(0x193)][_0x181337(0x17d)]({'data':{'name':_0x1078f2,'username':_0x1b87c2,'password':_0x44af67,'telegram':_0x4092d5,'shopUrl':_0x2b6eba,'paymentGateways':_0x18d9a6?JSON[_0x181337(0x149)](_0x18d9a6):null,'gatewaySettings':_0x5d42c2?JSON[_0x181337(0x149)](_0x5d42c2):null,'usdtPolygonWallet':_0x1b98dc?.[_0x181337(0x142)]||null,'usdtTrcWallet':_0x1b98dc?.[_0x181337(0x1d8)]||null,'usdtErcWallet':_0x1b98dc?.[_0x181337(0x1a9)]||null,'usdcPolygonWallet':_0x1b98dc?.[_0x181337(0x157)]||null,'publicKey':_0x49bfcc,'secretKey':_0x20483b,'status':_0x181337(0x1aa)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x5af508['id'],'fullName':_0x5af508[_0x181337(0x1e0)],'username':_0x5af508[_0x181337(0x1b9)],'telegramId':_0x5af508[_0x181337(0x111)],'merchantUrl':_0x5af508[_0x181337(0x1de)],'gateways':_0x5af508[_0x181337(0xf0)]?JSON['parse'](_0x5af508[_0x181337(0xf0)]):null,'gatewaySettings':_0x5af508[_0x181337(0x1dc)]?JSON['parse'](_0x5af508['gatewaySettings']):null,'publicKey':_0x5af508[_0x181337(0x16f)],'wallets':{'usdtPolygonWallet':_0x5af508[_0x181337(0x142)],'usdtTrcWallet':_0x5af508[_0x181337(0x1d8)],'usdtErcWallet':_0x5af508[_0x181337(0x1a9)],'usdcPolygonWallet':_0x5af508['usdcPolygonWallet']},'status':_0x5af508['status'],'createdAt':_0x5af508[_0x181337(0x12f)]};}async[a35_0x11039f(0x11a)](_0x47ecc5){const _0x109dd6=a35_0x11039f;await database_1[_0x109dd6(0xfb)][_0x109dd6(0x193)][_0x109dd6(0x1db)]({'where':{'id':_0x47ecc5}});}[a35_0x11039f(0xde)](_0x28beb2,_0x2483c0,_0xcec3b5){const _0x15ca4f=a35_0x11039f,_0x9223fc=new Map(),_0x25beb=new Date(_0x2483c0);while(_0x25beb<=_0xcec3b5){const _0x3e7cf9=_0x25beb['toISOString']()[_0x15ca4f(0xdb)]('T')[0x0];_0x9223fc[_0x15ca4f(0xe1)](_0x3e7cf9,{'revenue':0x0,'count':0x0}),_0x25beb[_0x15ca4f(0x110)](_0x25beb[_0x15ca4f(0x1bd)]()+0x1);}for(const _0x223023 of _0x28beb2){const _0xe9997=_0x223023[_0x15ca4f(0x12f)][_0x15ca4f(0xd1)]()[_0x15ca4f(0xdb)]('T')[0x0],_0x31a91d=_0x9223fc[_0x15ca4f(0xfa)](_0xe9997);_0x31a91d&&(_0x31a91d[_0x15ca4f(0x1b2)]+=0x1,_0x223023['status']===_0x15ca4f(0x12b)&&(_0x223023[_0x15ca4f(0x109)]?_0x31a91d['revenue']+=_0x223023[_0x15ca4f(0x109)]:console[_0x15ca4f(0xe5)](_0x15ca4f(0x1f9)+_0x223023['id']+_0x15ca4f(0x146))));}const _0x281785=[],_0x4ae40f=[];for(const [_0x3ae162,_0x5e540e]of _0x9223fc){_0x281785['push']({'date':_0x3ae162,'amount':Math[_0x15ca4f(0x19a)](_0x5e540e[_0x15ca4f(0xd0)]*0x64)/0x64}),_0x4ae40f[_0x15ca4f(0xf1)]({'date':_0x3ae162,'count':_0x5e540e[_0x15ca4f(0x1b2)]});}return{'dailyRevenue':_0x281785,'dailyPayments':_0x4ae40f};}}exports[a35_0x11039f(0x1fa)]=AdminService;function a35_0x26a0(){const _0x3ca144=['commission','amount','count',',\x20Commission:\x20','sk_','\x20USDT\x20(with\x20commission\x20deducted)','thisMonth','3376050BMPxGF','totalPayments','username','⚠️\x20Requested\x20gateway\x20\x27','MasterCard','\x20USDT\x20(without\x20commission)','getDate','failUrl','getAllPayouts','klyme_gb','paymentsCount','toString','\x20USDT\x20(gross\x20revenue)','Insufficient\x20balance.\x20Available:\x20','merchantEarningsUSDT','getAllUsers','✅\x20Using\x20gateway\x20filter:\x20\x27','\x20USDT','asc','orderId','\x20\x20\x20✅\x20Actual\x20available\x20balance:\x20','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','getUserById','_count','\x20USDT)',',\x20successful:\x20','dateFrom','all','\x27\x20to\x20name\x20\x27','\x20\x20\x20💰\x20Total\x20payments\x20turnover:\x20','customerUa','currency','\x20payments)','usdtTrcWallet','./currencyService','test_gateway','delete','gatewaySettings','dailyRevenue','shopUrl','\x20paid\x20payments\x20for\x20analysis','name','totalCommissionRate','ceil','balance','\x20\x20\x20Merchant\x20gets:\x20','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','_sum','map','hex','getGatewayInternalName','🔄\x20Converted\x20gateway\x20ID\x20\x27','adminNotes','wallets','getPayoutById','currencyService','mastercard','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','gateways','month','update','customerName','Payment\x20not\x20found','getFullYear','🔄\x20Converted\x20gateway\x20name\x20\x27','getMerchantsSelection','⚠️\x20Payment\x20','AdminService','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','\x20\x20\x20💳\x20Total\x20payments:\x20','Shop\x20not\x20found','NONEXISTENT_GATEWAY_FILTER','💰\x20[PAYOUT]\x20Merchant\x20','revenue','toISOString','getAllPayments','\x27\x20->\x20ID\x20\x27','📅\x20Period\x20\x27all\x27:\x20Using\x20start\x20date\x20from\x20first\x20payment:\x20','📋\x20Found\x20','getSystemStatistics','📊\x20Payout\x20statistics\x20calculated:','custom','../config/database','\x20\x20\x20Current\x20balance:\x20','split','Rapyd','values','generateDailyStatistics','externalPaymentUrl','📋\x20Getting\x20merchants\x20selection\x20list...','set','totalAmountUSDT','🔄\x20Gateway\x20mapping:','26034435oIYebo','log','defineProperty','\x27\x20(from\x20\x27','KLYME\x20EU','🔍\x20Using\x20gateway\x20\x27','gatewayOrderId','\x20\x20\x20📅\x20Total\x20payouts\x20(this\x20month):\x20','randomBytes','📊\x20Available\x20gateways\x20in\x20database:','trc20','getGatewayDisplayName','paymentGateways','push','updatePaymentStatus','\x20\x20\x20🌐\x20IP:\x20','\x20USDT\x20(+','klyme_de','\x20balance\x20updated:','💰\x20Shop\x20','\x20PAID\x20payments','period','get','default','fullName','__esModule','\x20\x20\x20Balance:\x20','polygon_usdc','convertToUSDT','\x20active\x20merchants\x20for\x20selection','toUpperCase','\x20no\x20longer\x20PAID:','203DfiBhq','\x20\x20\x20Gateway:\x20','findFirst','gateway','getMonth','amountUSDT','entries','\x20\x20\x20Total\x20paid\x20out:\x20','\x20USDT,\x20Requested:\x20','summary','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','week','setDate','telegram','Error\x20processing\x20payment\x20','network','543564BDHxWk','30d','customerIp','\x27\x20->\x20name\x20\x27','\x20->\x20','dateTo','deleteUser','length','\x20\x20\x20💸\x20Total\x20payouts\x20(all\x20time):\x20','\x20USDT\x20(','paidOutUSDT','\x20\x20\x20📅\x20This\x20month:\x20','password','\x20\x20\x20Payout\x20amount:\x20','telegramId','0000','status','failureMessage','averageCommissionRate','toLowerCase','💸\x20CHARGEBACK\x20penalty:\x20-','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','shopId','PAID','getGatewayNameById','📊\x20Getting\x20payments\x20with\x20filters:','cointopay2','createdAt','findMany','gte','turnover','groupBy','crypto','totalAmountAfterCommissionUSDT','\x20\x20\x20📊\x20Total\x20payments:\x20','⚠️\x20Gateway\x20\x27','\x20for\x20shop\x20','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','averageCheckUSDT','suspendUser','desc','CHARGEBACK','periodTo','\x20\x20\x20Transaction\x20hash:\x20','1451243yWUZIP','statusChangedAt','usdtPolygonWallet','payout','1199664qdXUbo','354416pgwjKY','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','\x20\x20\x20Full\x20amount:\x20','Open\x20Banking\x202','stringify','KLYME\x20DE','\x20\x20\x20🔍\x20Raw\x20balance\x20sum:\x20','getMerchantsAwaitingPayout','\x20\x20\x20✅\x20Total\x20available\x20for\x20payout:\x20','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','📊\x20Final\x20WHERE\x20conditions:','\x20USDT\x20(after\x20payouts)','gatewayEarnings','year','$transaction','parse','payment','notes','usdcPolygonWallet','statusChangedBy','Test\x20Gateway','\x20order','customerEmail','dailyPayments','\x20USDT\x20(after\x20','plisio','createPayout','\x20became\x20PAID:','not\x20set','txid','618040SVUdOA','totalTurnover','toFixed','bcryptjs','getGatewayIdByName','getMerchantStatistics','💰\x20Current\x20shop\x20balance:\x20','Plisio','SUSPENDED','💰\x20Payment\x20','📊\x20Calculating\x20payout\x20statistics...','10qYxAId','publicKey','getTime','turnoverUSDT','customerCountry','merchantEarnings','%\x20commission)','forEach','totalPaidOut','reduce','amountAfterCommissionUSDT','REFUND','📊\x20Total\x20payments\x20(including\x20failed):\x20','awaitingPayout','Noda','create','\x20USDT\x20from\x20balance','90d','COMPLETED','\x20\x20\x20�\x20Total\x20payments\x20turnover:\x20','updatedAt','🔄\x20Admin\x20updating\x20payment\x20','💰\x20Creating\x20payout\x20for\x20shop\x20','\x20USDT\x20(total\x20paid\x20to\x20merchants)','insensitive','some','localeCompare','error','CoinToPay','noda','__importDefault','\x20\x20\x20💰\x20Total\x20payout:\x20','getPaymentById','cointopay','lte','admin','periodFrom','shop','\x20USDT\x20(actual\x20balances)','\x20balance\x20updated:\x20','pendingUrl','Telegram\x20username\x20already\x20exists','rapyd','availableBalance','round','\x20\x20\x20📊\x20Commission\x20difference:\x20','🔄\x20Gateway\x20mapping\x20(create):','\x20\x20\x20🖥️\x20User\x20Agent:\x20','getPayoutStats','\x20\x20\x20Merchant\x20loses:\x20','\x20in\x20','findUnique','sort','KLYME\x20GB','merchantUrl','commissionUSDT','\x20\x20\x20💰\x20Total\x20turnover:\x20','chargebackAmount','aggregate','usdtErcWallet','ACTIVE','successUrl','not\x20specified','paidAt','💰\x20Found\x20','updateUser'];a35_0x26a0=function(){return _0x3ca144;};return a35_0x26a0();}