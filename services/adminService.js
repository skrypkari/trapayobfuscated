'use strict';const a33_0x493b1a=a33_0x4e9e;(function(_0x36df86,_0x164ad5){const _0x1e7b0b=a33_0x4e9e,_0x405a3b=_0x36df86();while(!![]){try{const _0x50e6a6=-parseInt(_0x1e7b0b(0x111))/0x1+-parseInt(_0x1e7b0b(0x144))/0x2+parseInt(_0x1e7b0b(0xcf))/0x3+-parseInt(_0x1e7b0b(0xae))/0x4*(-parseInt(_0x1e7b0b(0x140))/0x5)+-parseInt(_0x1e7b0b(0x15c))/0x6*(parseInt(_0x1e7b0b(0x149))/0x7)+parseInt(_0x1e7b0b(0x11a))/0x8+parseInt(_0x1e7b0b(0x12b))/0x9*(-parseInt(_0x1e7b0b(0xde))/0xa);if(_0x50e6a6===_0x164ad5)break;else _0x405a3b['push'](_0x405a3b['shift']());}catch(_0x37650f){_0x405a3b['push'](_0x405a3b['shift']());}}}(a33_0x1626,0x244a1));var __importDefault=this&&this['__importDefault']||function(_0x625d77){const _0x7a13b0=a33_0x4e9e;return _0x625d77&&_0x625d77[_0x7a13b0(0xf7)]?_0x625d77:{'default':_0x625d77};};Object[a33_0x493b1a(0x172)](exports,a33_0x493b1a(0xf7),{'value':!![]}),exports[a33_0x493b1a(0xe3)]=void 0x0;function a33_0x1626(){const _0xc1263d=['getGatewayNameById','shop','isEligibleForPayout','‚ùå\x20Payment\x20not\x20found:\x20','payments','\x20status\x20to:\x20','EXPIRED','\x20payouts\x20out\x20of\x20','delete','payout','remitterName','‚úÖ\x20Payout\x20created\x20successfully:\x20','30asNhai','calculateAmountAfterCommission','chargebackAmount','PAID','getGatewaySettings','AdminService','statusChangedBy','PENDING','admin','customerEmail','expiresAt','‚úÖ\x20Marked\x20','Invalid\x20status.\x20Valid\x20statuses:\x20','findUnique','getDate','shopId',',\x20amount:\x20','includes','updatedAt','orderId','‚úÖ\x20Payout\x20statistics\x20calculated:','üíµ\x20Total\x20revenue:\x20','calculateEffectiveAmount','User\x20not\x20found','amountUSDT','__esModule','currency','awaitingPayout','merchantPaid','count','‚úÖ\x20Payout\x20','\x20merchants\x20out\x20of\x20','\x20total','\x20days','Payout\x20not\x20found','Payment\x20not\x20found','Chargeback\x20amount\x20is\x20required\x20and\x20must\x20be\x20positive\x20(amount\x20in\x20USDT)','telegram','usdtErcWallet','SUSPENDED','updateUser','getUserById','$queryRaw','stringify','asc','‚úÖ\x20Returning\x20','COMPLETED','\x20USDT\x20(–≤–∫–ª—é—á–∞—è\x20—à—Ç—Ä–∞—Ñ—ã\x20chargeback)','entries','thisMonth','userService','28416UmVWDq','‚úÖ\x20Activating\x20user:\x20','availableBalance','get','üí∏\x20Chargeback\x20penalty:\x20','‚ùå\x20Payout\x20not\x20found:\x20','\x20days)','‚úÖ\x20Payment\x20','totalAmountAfterCommissionUSDT','1329528wTizTR','\x20deleted\x20successfully','gte','deletePayout','remitterIban','‚úÖ\x20Found\x20payout:\x20','sourceCurrency','\x20merchants\x20with\x20eligible\x20PAID\x20payments','join','set','sendPayoutNotification','error','\x20payments\x20for\x20revenue\x20calculation\x20(PAID/REFUND/CHARGEBACK)','lte','gatewayOrderId','abs','deleteUser','34911dMqutC','charAt','ceil','log','sort','updateMany','findMany','getPayoutStats','usdtPolygonWallet','webhookLogs','üìÖ\x20Processing\x20daily\x20stats\x20for\x20','../types/gateway','totalAmountUSDT','round','üè™\x20Found\x20','webhookLog','publicKey','\x20users\x20out\x20of\x20','Shop\x20is\x20not\x20active','size','üîç\x20Getting\x20payment\x20by\x20ID:\x20','702635FKkuNx','completed','commission','payment','408818zwUPok','getPayoutById','amount','length','from','234003eFvAXJ','getPeriodDays','paymentGateways','gateway','push','create','üìà\x20Average\x20payment:\x20','currencyService','User\x20is\x20already\x20active','30d','txid','üîç\x20Getting\x20payout\x20by\x20ID:\x20','isValidGatewayId','gatewayPaymentId','toLowerCase','\x20payments\x20as\x20paid\x20out','all','markPaymentsAsPaidOut','\x20suspended\x20successfully','12hDmIWr','usage','üìã\x20Getting\x20payouts\x20with\x20filters:','üí∞\x20Found\x20','gatewaySettings','status','ACTIVE','getAllPayments','usdtTrcWallet','üìÖ\x20This\x20Month:\x20','getMonth','üìã\x20Getting\x20users\x20with\x20filters:','üí∞\x20Available\x20Balance:\x20','REFUND','slice','name','desc','cardLast4','default','convertToUSDT','getTime','reduce','defineProperty','toISOString','getSystemStatistics','\x20eligible\x20PAID\x20payments\x20for\x20payout\x20analysis','CHARGEBACK','has','‚úÖ\x20User\x20','adminNotes','amountAfterCommissionUSDT','parse','notes','split','map','4TxmZgC','‚úÖ\x20Found\x20payment:\x20','network','./userService','getFullYear','toUpperCase','üìä\x20Generating\x20admin\x20statistics\x20for\x20period:\x20','paymentMethod','FAILED','suspendUser','username','üìä\x20Found\x20','toFixed','bankId','../config/database','üí≥\x20Total\x20payments:\x20','createdAt','./currencyService','telegramBotService','externalPaymentUrl','insensitive','payoutDelay','‚è≥\x20Awaiting\x20Payout:\x20','generateDateRange','üìä\x20Daily\x20revenue\x20entries:\x20','shopUrl','getMerchantsAwaitingPayout','üìä\x20Calculating\x20admin\x20payout\x20statistics...','\x20USDT','admin_status_update','paidAt','customerName','createPayout','459729SdGsiL','createUser','update'];a33_0x1626=function(){return _0xc1263d;};return a33_0x1626();}const database_1=__importDefault(require(a33_0x493b1a(0xbc))),currencyService_1=require(a33_0x493b1a(0xbf)),userService_1=require(a33_0x493b1a(0xb1)),telegramBotService_1=require('./telegramBotService'),gateway_1=require(a33_0x493b1a(0x136));class AdminService{constructor(){this['userService']=new userService_1['UserService']();}[a33_0x493b1a(0x14a)](_0x4af0c3){const _0x361c7c=a33_0x493b1a;switch(_0x4af0c3){case'7d':return 0x7;case _0x361c7c(0x152):return 0x1e;case'90d':return 0x5a;case'1y':return 0x16d;default:return 0x1e;}}[a33_0x493b1a(0xc5)](_0x2e37c7,_0x3d9c37){const _0x59c9e5=a33_0x493b1a,_0xe00c9d=[],_0x10ce0f=new Date(_0x2e37c7);while(_0x10ce0f<=_0x3d9c37){_0xe00c9d[_0x59c9e5(0x14d)](_0x10ce0f[_0x59c9e5(0x173)]()[_0x59c9e5(0xac)]('T')[0x0]),_0x10ce0f['setDate'](_0x10ce0f[_0x59c9e5(0xec)]()+0x1);}return _0xe00c9d;}[a33_0x493b1a(0xe2)](_0x9c8be0,_0x49a553){const _0x341475=a33_0x493b1a;if(!_0x9c8be0[_0x341475(0x160)])return{'commission':0x0,'payoutDelay':0x0};try{const _0x3a519d=JSON['parse'](_0x9c8be0[_0x341475(0x160)]),_0x175bb3=_0x49a553[_0x341475(0x12c)](0x0)[_0x341475(0xb3)]()+_0x49a553['slice'](0x1)[_0x341475(0x157)]();if(_0x3a519d&&_0x3a519d[_0x175bb3])return{'commission':_0x3a519d[_0x175bb3][_0x341475(0x142)]||0x0,'payoutDelay':_0x3a519d[_0x175bb3]['payoutDelay']||0x0};}catch(_0x5f4c6){console[_0x341475(0x125)]('Error\x20parsing\x20gateway\x20settings:',_0x5f4c6);}return{'commission':0x0,'payoutDelay':0x0};}['isEligibleForPayout'](_0x577a01){const _0x3c67d4=a33_0x493b1a;if(_0x577a01['status']!==_0x3c67d4(0xe1)||_0x577a01['merchantPaid']||!_0x577a01[_0x3c67d4(0xcc)])return![];const _0x4923dc=this[_0x3c67d4(0xe2)](_0x577a01[_0x3c67d4(0xd3)],_0x577a01[_0x3c67d4(0x14c)]),_0x3780d5=_0x4923dc[_0x3c67d4(0xc3)]*0x18*0x3c*0x3c*0x3e8,_0x43cd2e=new Date(_0x577a01['paidAt'][_0x3c67d4(0x170)]()+_0x3780d5);return new Date()>_0x43cd2e;}['calculateAmountAfterCommission'](_0x5dfe66,_0x3a0780){return _0x5dfe66*(0x1-_0x3a0780/0x64);}[a33_0x493b1a(0xf4)](_0x3575d5){const _0x21b5cf=a33_0x493b1a;switch(_0x3575d5[_0x21b5cf(0x161)]){case'PAID':return _0x3575d5['amount'];case'CHARGEBACK':return-(_0x3575d5[_0x21b5cf(0xe0)]||0x0);case'REFUND':return 0x0;default:return 0x0;}}async[a33_0x493b1a(0xce)](_0x2ef2eb){const _0x5371a1=a33_0x493b1a,{shopId:_0x2c5fd9,amount:_0x5b1ad3,network:_0x260f0e,notes:_0x35e5ce}=_0x2ef2eb;console[_0x5371a1(0x12e)]('üí∏\x20Creating\x20payout\x20for\x20shop\x20'+_0x2c5fd9+':\x20'+_0x5b1ad3+'\x20USDT\x20via\x20'+_0x260f0e);const _0x21d4ca=await database_1[_0x5371a1(0x16e)]['shop'][_0x5371a1(0xeb)]({'where':{'id':_0x2c5fd9},'select':{'id':!![],'name':!![],'username':!![],'status':!![]}});if(!_0x21d4ca)throw new Error('Shop\x20not\x20found');if(_0x21d4ca[_0x5371a1(0x161)]!==_0x5371a1(0x162))throw new Error(_0x5371a1(0x13d));const _0x3f235c=await database_1[_0x5371a1(0x16e)]['payout']['create']({'data':{'shopId':_0x2c5fd9,'amount':_0x5b1ad3,'network':_0x260f0e,'status':_0x5371a1(0x10c),'notes':_0x35e5ce||null,'paidAt':new Date()},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});await this['markPaymentsAsPaidOut'](_0x2c5fd9,_0x5b1ad3);try{await telegramBotService_1[_0x5371a1(0xc0)][_0x5371a1(0x124)](_0x2c5fd9,_0x3f235c,_0x5371a1(0x141));}catch(_0x14114a){console[_0x5371a1(0x125)]('Failed\x20to\x20send\x20Telegram\x20payout\x20notification:',_0x14114a);}return console[_0x5371a1(0x12e)](_0x5371a1(0xdd)+_0x3f235c['id']),{'id':_0x3f235c['id'],'shopId':_0x3f235c[_0x5371a1(0xed)],'shopName':_0x3f235c[_0x5371a1(0xd3)]['name'],'shopUsername':_0x3f235c[_0x5371a1(0xd3)]['username'],'amount':_0x3f235c[_0x5371a1(0x146)],'network':_0x3f235c['network'],'status':_0x3f235c[_0x5371a1(0x161)],'txid':_0x3f235c['txid'],'notes':_0x3f235c['notes'],'createdAt':_0x3f235c[_0x5371a1(0xbe)],'paidAt':_0x3f235c[_0x5371a1(0xcc)]};}async[a33_0x493b1a(0x15a)](_0x4e5b98,_0x10bb33){const _0x4ad929=a33_0x493b1a;console[_0x4ad929(0x12e)]('üîÑ\x20Marking\x20payments\x20as\x20paid\x20out\x20for\x20shop\x20'+_0x4e5b98+_0x4ad929(0xee)+_0x10bb33+'\x20USDT');const _0x4178d0=await database_1['default'][_0x4ad929(0x143)][_0x4ad929(0x131)]({'where':{'shopId':_0x4e5b98,'status':_0x4ad929(0xe1),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'shop':{'select':{'gatewaySettings':!![]}}},'orderBy':{'paidAt':_0x4ad929(0x10a)}});let _0x39bdef=_0x10bb33;const _0x1a0cde=[];for(const _0x581a86 of _0x4178d0){const _0xd04a5c={..._0x581a86,'status':_0x4ad929(0xe1),'merchantPaid':![],'shop':{'gatewaySettings':_0x581a86[_0x4ad929(0xd3)][_0x4ad929(0x160)]}};if(!this['isEligibleForPayout'](_0xd04a5c))continue;const _0x4c146c=await currencyService_1['currencyService'][_0x4ad929(0x16f)](_0x581a86[_0x4ad929(0x146)],_0x581a86['currency']),_0x6d3027=this[_0x4ad929(0xe2)](_0x581a86[_0x4ad929(0xd3)],_0x581a86[_0x4ad929(0x14c)]),_0x5d77e7=this[_0x4ad929(0xdf)](_0x4c146c,_0x6d3027['commission']);if(_0x5d77e7<=_0x39bdef){_0x1a0cde[_0x4ad929(0x14d)](_0x581a86['id']),_0x39bdef-=_0x5d77e7;if(_0x39bdef<=0.01)break;}}_0x1a0cde[_0x4ad929(0x147)]>0x0&&(await database_1[_0x4ad929(0x16e)]['payment'][_0x4ad929(0x130)]({'where':{'id':{'in':_0x1a0cde}},'data':{'merchantPaid':!![]}}),console[_0x4ad929(0x12e)](_0x4ad929(0xe9)+_0x1a0cde[_0x4ad929(0x147)]+_0x4ad929(0x158)));}async['getAllPayouts'](_0x1d91e3){const _0x2d55b2=a33_0x493b1a,{page:_0x5a5ec9,limit:_0x34813a,shopId:_0x823284,network:_0x464fde,dateFrom:_0x120d63,dateTo:_0xc58e2b,search:_0x324834}=_0x1d91e3,_0x7238b1=(_0x5a5ec9-0x1)*_0x34813a;console[_0x2d55b2(0x12e)](_0x2d55b2(0x15e),_0x1d91e3);const _0x277828={};_0x823284&&(_0x277828['shopId']=_0x823284);_0x464fde&&(_0x277828['network']=_0x464fde);(_0x120d63||_0xc58e2b)&&(_0x277828[_0x2d55b2(0xbe)]={},_0x120d63&&(_0x277828[_0x2d55b2(0xbe)][_0x2d55b2(0x11c)]=new Date(_0x120d63)),_0xc58e2b&&(_0x277828[_0x2d55b2(0xbe)][_0x2d55b2(0x127)]=new Date(_0xc58e2b)));_0x324834&&(_0x277828['OR']=[{'txid':{'contains':_0x324834,'mode':_0x2d55b2(0xc2)}},{'notes':{'contains':_0x324834,'mode':_0x2d55b2(0xc2)}},{'shop':{'name':{'contains':_0x324834,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x324834,'mode':_0x2d55b2(0xc2)}}}]);const [_0x322870,_0x1365de]=await Promise[_0x2d55b2(0x159)]([database_1['default'][_0x2d55b2(0xdb)][_0x2d55b2(0x131)]({'where':_0x277828,'skip':_0x7238b1,'take':_0x34813a,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x2d55b2(0x16e)][_0x2d55b2(0xdb)][_0x2d55b2(0xfb)]({'where':_0x277828})]);console[_0x2d55b2(0x12e)]('üìä\x20Found\x20'+_0x322870[_0x2d55b2(0x147)]+_0x2d55b2(0xd9)+_0x1365de+_0x2d55b2(0xfe));const _0x2dc64c=_0x322870[_0x2d55b2(0xad)](_0x1ef9d0=>({'id':_0x1ef9d0['id'],'shopId':_0x1ef9d0[_0x2d55b2(0xed)],'shopName':_0x1ef9d0['shop'][_0x2d55b2(0x16b)],'shopUsername':_0x1ef9d0[_0x2d55b2(0xd3)][_0x2d55b2(0xb8)],'amount':_0x1ef9d0[_0x2d55b2(0x146)],'network':_0x1ef9d0[_0x2d55b2(0xb0)],'status':_0x1ef9d0['status'],'txid':_0x1ef9d0['txid'],'notes':_0x1ef9d0['notes'],'createdAt':_0x1ef9d0[_0x2d55b2(0xbe)],'paidAt':_0x1ef9d0[_0x2d55b2(0xcc)]}));return{'payouts':_0x2dc64c,'pagination':{'page':_0x5a5ec9,'limit':_0x34813a,'total':_0x1365de,'totalPages':Math[_0x2d55b2(0x12d)](_0x1365de/_0x34813a)}};}async[a33_0x493b1a(0x145)](_0xc15a28){const _0x297b9c=a33_0x493b1a;console['log'](_0x297b9c(0x154)+_0xc15a28);const _0x4f1fc1=await database_1['default'][_0x297b9c(0xdb)]['findUnique']({'where':{'id':_0xc15a28},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x4f1fc1)return console['log'](_0x297b9c(0x116)+_0xc15a28),null;return console[_0x297b9c(0x12e)](_0x297b9c(0x11f)+_0x4f1fc1[_0x297b9c(0x146)]+'\x20USDT\x20via\x20'+_0x4f1fc1[_0x297b9c(0xb0)]),{'id':_0x4f1fc1['id'],'shopId':_0x4f1fc1[_0x297b9c(0xed)],'shopName':_0x4f1fc1[_0x297b9c(0xd3)]['name'],'shopUsername':_0x4f1fc1[_0x297b9c(0xd3)]['username'],'amount':_0x4f1fc1[_0x297b9c(0x146)],'network':_0x4f1fc1[_0x297b9c(0xb0)],'status':_0x4f1fc1[_0x297b9c(0x161)],'txid':_0x4f1fc1[_0x297b9c(0x153)],'notes':_0x4f1fc1[_0x297b9c(0xab)],'createdAt':_0x4f1fc1[_0x297b9c(0xbe)],'paidAt':_0x4f1fc1[_0x297b9c(0xcc)]};}async[a33_0x493b1a(0x11d)](_0xe9a216){const _0x27fed1=a33_0x493b1a;console[_0x27fed1(0x12e)]('üóëÔ∏è\x20Deleting\x20payout:\x20'+_0xe9a216);const _0x356072=await database_1['default'][_0x27fed1(0xdb)][_0x27fed1(0xeb)]({'where':{'id':_0xe9a216},'select':{'id':!![],'shopId':!![],'amount':!![]}});if(!_0x356072)throw new Error(_0x27fed1(0x100));await database_1[_0x27fed1(0x16e)][_0x27fed1(0xdb)][_0x27fed1(0xda)]({'where':{'id':_0xe9a216}}),console[_0x27fed1(0x12e)](_0x27fed1(0xfc)+_0xe9a216+_0x27fed1(0x11b));}async[a33_0x493b1a(0xc8)](_0x5ee5b2){const _0x4b4441=a33_0x493b1a,{page:_0x34f190,limit:_0x544310,minAmount:_0x352b76,search:_0x2178de}=_0x5ee5b2;console[_0x4b4441(0x12e)]('üìã\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:',_0x5ee5b2);const _0x26a024=await database_1[_0x4b4441(0x16e)][_0x4b4441(0x143)][_0x4b4441(0x131)]({'where':{'status':_0x4b4441(0xe1),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'createdAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'gatewaySettings':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}});console[_0x4b4441(0x12e)](_0x4b4441(0x15f)+_0x26a024[_0x4b4441(0x147)]+_0x4b4441(0x175));const _0x43d7d1=new Map();for(const _0x2d1312 of _0x26a024){const _0x266e16={..._0x2d1312,'status':_0x4b4441(0xe1),'merchantPaid':![],'shop':{'gatewaySettings':_0x2d1312[_0x4b4441(0xd3)][_0x4b4441(0x160)]}},_0x185b30=this['isEligibleForPayout'](_0x266e16);if(!_0x185b30)continue;const _0x16a173=await currencyService_1[_0x4b4441(0x150)][_0x4b4441(0x16f)](_0x2d1312['amount'],_0x2d1312['currency']),_0x3604be=this[_0x4b4441(0xe2)](_0x2d1312[_0x4b4441(0xd3)],_0x2d1312['gateway']),_0x41ae3a=this['calculateAmountAfterCommission'](_0x16a173,_0x3604be[_0x4b4441(0x142)]),_0x1235ee=_0x2d1312['shopId'];!_0x43d7d1[_0x4b4441(0x177)](_0x1235ee)&&_0x43d7d1[_0x4b4441(0x123)](_0x1235ee,{'shop':_0x2d1312[_0x4b4441(0xd3)],'payments':[]}),_0x43d7d1[_0x4b4441(0x114)](_0x1235ee)[_0x4b4441(0xd6)]['push']({'id':_0x2d1312['id'],'amount':_0x2d1312[_0x4b4441(0x146)],'currency':_0x2d1312[_0x4b4441(0xf8)],'gateway':_0x2d1312[_0x4b4441(0x14c)],'paidAt':_0x2d1312['paidAt'],'createdAt':_0x2d1312[_0x4b4441(0xbe)],'amountUSDT':_0x16a173,'commission':_0x3604be['commission'],'amountAfterCommissionUSDT':_0x41ae3a,'isEligible':!![]});}console[_0x4b4441(0x12e)](_0x4b4441(0x139)+_0x43d7d1[_0x4b4441(0x13e)]+_0x4b4441(0x121));const _0x285019=[];for(const [_0x237368,_0x5bc56a]of _0x43d7d1){const {shop:_0x4558cb,payments:_0xaf7abe}=_0x5bc56a,_0x1e37d7=_0xaf7abe[_0x4b4441(0x171)]((_0x58bce3,_0x2b7f74)=>_0x58bce3+_0x2b7f74[_0x4b4441(0xf6)],0x0),_0x3ae116=_0xaf7abe['reduce']((_0x110880,_0x233d33)=>_0x110880+_0x233d33[_0x4b4441(0xa9)],0x0);if(_0x352b76&&_0x3ae116<_0x352b76)continue;if(_0x2178de){const _0x588257=_0x2178de[_0x4b4441(0x157)](),_0x1ed787=_0x4558cb[_0x4b4441(0x16b)][_0x4b4441(0x157)]()[_0x4b4441(0xef)](_0x588257)||_0x4558cb[_0x4b4441(0xb8)][_0x4b4441(0x157)]()[_0x4b4441(0xef)](_0x588257)||_0x4558cb[_0x4b4441(0x103)]&&_0x4558cb['telegram'][_0x4b4441(0x157)]()['includes'](_0x588257);if(!_0x1ed787)continue;}const _0x474f48=new Map();for(const _0x2aa8ec of _0xaf7abe){const _0x2062fc=_0x2aa8ec[_0x4b4441(0x14c)];!_0x474f48[_0x4b4441(0x177)](_0x2062fc)&&_0x474f48[_0x4b4441(0x123)](_0x2062fc,{'count':0x0,'amountUSDT':0x0,'amountAfterCommissionUSDT':0x0,'commission':_0x2aa8ec['commission']});const _0x3735b2=_0x474f48[_0x4b4441(0x114)](_0x2062fc);_0x3735b2[_0x4b4441(0xfb)]++,_0x3735b2['amountUSDT']+=_0x2aa8ec[_0x4b4441(0xf6)],_0x3735b2[_0x4b4441(0xa9)]+=_0x2aa8ec['amountAfterCommissionUSDT'];}const _0x8d500f=Array[_0x4b4441(0x148)](_0x474f48[_0x4b4441(0x10e)]())[_0x4b4441(0xad)](([_0x49e5f2,_0x679c8e])=>({'gateway':_0x49e5f2[_0x4b4441(0x12c)](0x0)[_0x4b4441(0xb3)]()+_0x49e5f2[_0x4b4441(0x16a)](0x1),'count':_0x679c8e[_0x4b4441(0xfb)],'amountUSDT':Math[_0x4b4441(0x138)](_0x679c8e[_0x4b4441(0xf6)]*0x64)/0x64,'amountAfterCommissionUSDT':Math['round'](_0x679c8e[_0x4b4441(0xa9)]*0x64)/0x64,'commission':_0x679c8e['commission']})),_0x51d9d8=_0xaf7abe[_0x4b4441(0x171)]((_0x19af20,_0x3af8e7)=>{const _0x359b6c=_0x4b4441;return _0x3af8e7[_0x359b6c(0xcc)]<_0x19af20?_0x3af8e7[_0x359b6c(0xcc)]:_0x19af20;},_0xaf7abe[0x0]['paidAt']);_0x285019['push']({'id':_0x4558cb['id'],'fullName':_0x4558cb['name'],'username':_0x4558cb['username'],'telegramId':_0x4558cb[_0x4b4441(0x103)],'merchantUrl':_0x4558cb['shopUrl'],'wallets':{'usdtPolygonWallet':_0x4558cb[_0x4b4441(0x133)],'usdtTrcWallet':_0x4558cb[_0x4b4441(0x164)],'usdtErcWallet':_0x4558cb[_0x4b4441(0x104)],'usdcPolygonWallet':_0x4558cb['usdcPolygonWallet']},'totalAmountUSDT':Math[_0x4b4441(0x138)](_0x1e37d7*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x4b4441(0x138)](_0x3ae116*0x64)/0x64,'paymentsCount':_0xaf7abe[_0x4b4441(0x147)],'oldestPaymentDate':_0x51d9d8,'gatewayBreakdown':_0x8d500f});}_0x285019[_0x4b4441(0x12f)]((_0x17c661,_0x7aff99)=>_0x7aff99[_0x4b4441(0x119)]-_0x17c661[_0x4b4441(0x119)]);const _0x38f219=_0x285019['length'],_0x175a46=_0x285019['reduce']((_0x43c6df,_0x4164d7)=>_0x43c6df+_0x4164d7[_0x4b4441(0x137)],0x0),_0x520214=_0x285019[_0x4b4441(0x171)]((_0x5ebf15,_0x3dad2e)=>_0x5ebf15+_0x3dad2e['totalAmountAfterCommissionUSDT'],0x0),_0x2a579a=(_0x34f190-0x1)*_0x544310,_0x2a7d26=_0x285019[_0x4b4441(0x16a)](_0x2a579a,_0x2a579a+_0x544310);return console[_0x4b4441(0x12e)](_0x4b4441(0x10b)+_0x2a7d26[_0x4b4441(0x147)]+_0x4b4441(0xfd)+_0x38f219+_0x4b4441(0xfe)),console[_0x4b4441(0x12e)]('üí∞\x20Total\x20amount:\x20'+_0x175a46[_0x4b4441(0xba)](0x2)+'\x20USDT\x20('+_0x520214[_0x4b4441(0xba)](0x2)+'\x20USDT\x20after\x20commission)'),{'merchants':_0x2a7d26,'pagination':{'page':_0x34f190,'limit':_0x544310,'total':_0x38f219,'totalPages':Math['ceil'](_0x38f219/_0x544310)},'summary':{'totalMerchants':_0x38f219,'totalAmountUSDT':Math['round'](_0x175a46*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x4b4441(0x138)](_0x520214*0x64)/0x64}};}async[a33_0x493b1a(0x132)](){const _0x4756f1=a33_0x493b1a;console[_0x4756f1(0x12e)](_0x4756f1(0xc9));const _0x215c17=await database_1[_0x4756f1(0x16e)]['payment'][_0x4756f1(0x131)]({'where':{'status':{'in':[_0x4756f1(0xe1),'REFUND','CHARGEBACK']}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'status':!![],'gateway':!![],'paidAt':!![],'merchantPaid':!![],'createdAt':!![],'chargebackAmount':!![],'shop':{'select':{'gatewaySettings':!![]}}}});console['log']('üí∞\x20Found\x20'+_0x215c17[_0x4756f1(0x147)]+'\x20payments\x20for\x20analysis\x20(PAID/REFUND/CHARGEBACK)');const _0xc2db61=new Date(),_0x596018=new Date(_0xc2db61[_0x4756f1(0xb2)](),_0xc2db61[_0x4756f1(0x166)](),0x1),_0x53fc76=new Date(_0xc2db61['getFullYear'](),_0xc2db61[_0x4756f1(0x166)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7);let _0x154278=0x0,_0x2cc084=0x0,_0x544f39=0x0,_0xfa74c8=0x0;for(const _0x2cec11 of _0x215c17){const _0xefbac5=this[_0x4756f1(0xf4)](_0x2cec11);if(_0xefbac5===0x0)continue;let _0x3d9b8e,_0x417fc4;if(_0x2cec11[_0x4756f1(0x161)]===_0x4756f1(0x176))_0x3d9b8e=Math[_0x4756f1(0x129)](_0xefbac5),_0x417fc4=-_0x3d9b8e;else{_0x3d9b8e=await currencyService_1[_0x4756f1(0x150)][_0x4756f1(0x16f)](_0x2cec11[_0x4756f1(0x146)],_0x2cec11['currency']);const _0x47b0c7=this[_0x4756f1(0xe2)](_0x2cec11[_0x4756f1(0xd3)],_0x2cec11[_0x4756f1(0x14c)]);_0x417fc4=this[_0x4756f1(0xdf)](_0x3d9b8e,_0x47b0c7[_0x4756f1(0x142)]);}_0x2cec11[_0x4756f1(0xfa)]&&(_0x154278+=_0x417fc4,_0x2cec11[_0x4756f1(0xcc)]&&_0x2cec11[_0x4756f1(0xcc)]>=_0x596018&&_0x2cec11[_0x4756f1(0xcc)]<=_0x53fc76&&(_0x544f39+=_0x417fc4)),_0x2cec11[_0x4756f1(0x161)]===_0x4756f1(0xe1)&&this[_0x4756f1(0xd4)](_0x2cec11)&&(_0x2cc084+=_0x417fc4,_0xfa74c8+=_0x3d9b8e);}const _0x267a39={'totalPayout':Math[_0x4756f1(0x138)](_0x154278*0x64)/0x64,'awaitingPayout':Math['round'](_0x2cc084*0x64)/0x64,'thisMonth':Math[_0x4756f1(0x138)](_0x544f39*0x64)/0x64,'availableBalance':Math['round'](_0xfa74c8*0x64)/0x64};return console[_0x4756f1(0x12e)](_0x4756f1(0xf2)),console[_0x4756f1(0x12e)]('üí∏\x20Total\x20Payout:\x20'+_0x267a39['totalPayout']+_0x4756f1(0x10d)),console[_0x4756f1(0x12e)](_0x4756f1(0xc4)+_0x267a39[_0x4756f1(0xf9)]+'\x20USDT\x20(—Ç–æ–ª—å–∫–æ\x20PAID\x20–ø–ª–∞—Ç–µ–∂–∏)'),console[_0x4756f1(0x12e)](_0x4756f1(0x165)+_0x267a39[_0x4756f1(0x10f)]+_0x4756f1(0xca)),console[_0x4756f1(0x12e)](_0x4756f1(0x168)+_0x267a39[_0x4756f1(0x113)]+'\x20USDT'),_0x267a39;}async[a33_0x493b1a(0x174)](_0x317791){const _0x4e84c6=a33_0x493b1a,_0x39ad12=this[_0x4e84c6(0x14a)](_0x317791),_0x3c9fa2=new Date();_0x3c9fa2['setDate'](_0x3c9fa2['getDate']()-_0x39ad12),console['log'](_0x4e84c6(0xb4)+_0x317791+'\x20('+_0x39ad12+_0x4e84c6(0x117));const _0x34dc10=await database_1['default'][_0x4e84c6(0xd3)]['count']({'where':{'status':_0x4e84c6(0x162)}}),_0x226ed3=await database_1[_0x4e84c6(0x16e)][_0x4e84c6(0x143)][_0x4e84c6(0xfb)](),_0x57c7d6=await database_1[_0x4e84c6(0x16e)][_0x4e84c6(0x143)][_0x4e84c6(0x131)]({'where':{'status':{'in':[_0x4e84c6(0xe1),'REFUND',_0x4e84c6(0x176)]}},'select':{'amount':!![],'currency':!![],'status':!![],'chargebackAmount':!![],'createdAt':!![]}});console[_0x4e84c6(0x12e)](_0x4e84c6(0x15f)+_0x57c7d6['length']+_0x4e84c6(0x126));const _0x49c358=await Promise['all'](_0x57c7d6['map'](async _0x419cf1=>{const _0x58ea3e=_0x4e84c6,_0x1707d6=this[_0x58ea3e(0xf4)](_0x419cf1);if(_0x1707d6===0x0)return{'amount':0x0,'createdAt':_0x419cf1[_0x58ea3e(0xbe)]};let _0x5caf0c;return _0x419cf1[_0x58ea3e(0x161)]===_0x58ea3e(0x176)?_0x5caf0c=-Math[_0x58ea3e(0x129)](_0x1707d6):_0x5caf0c=await currencyService_1[_0x58ea3e(0x150)][_0x58ea3e(0x16f)](_0x419cf1[_0x58ea3e(0x146)],_0x419cf1[_0x58ea3e(0xf8)]),{'amount':_0x5caf0c,'createdAt':_0x419cf1[_0x58ea3e(0xbe)]};})),_0x53dc4c=_0x49c358[_0x4e84c6(0x171)]((_0x5e495b,_0x3bf4b6)=>_0x5e495b+_0x3bf4b6[_0x4e84c6(0x146)],0x0),_0x24f4d5=_0x226ed3>0x0?_0x53dc4c/_0x226ed3:0x0;console[_0x4e84c6(0x12e)](_0x4e84c6(0xf3)+_0x53dc4c[_0x4e84c6(0xba)](0x2)+_0x4e84c6(0x10d)),console[_0x4e84c6(0x12e)](_0x4e84c6(0x14f)+_0x24f4d5[_0x4e84c6(0xba)](0x2)+_0x4e84c6(0xca));const _0x547c79=await database_1[_0x4e84c6(0x16e)][_0x4e84c6(0x108)]`
      SELECT 
        DATE(created_at) as date,
        array_agg(
          json_build_object(
            'amount', amount,
            'currency', currency,
            'status', status,
            'chargeback_amount', chargeback_amount
          )
        ) as payments
      FROM payments 
      WHERE created_at >= ${_0x3c9fa2}
        AND status IN ('PAID', 'REFUND', 'CHARGEBACK')
      GROUP BY DATE(created_at)
      ORDER BY date ASC
    `;console[_0x4e84c6(0x12e)](_0x4e84c6(0x135)+_0x547c79[_0x4e84c6(0x147)]+_0x4e84c6(0xff));const _0x23dcc8=await Promise[_0x4e84c6(0x159)](_0x547c79[_0x4e84c6(0xad)](async _0x27facf=>{const _0xa70c1e=_0x4e84c6,_0x48c627=await Promise['all'](_0x27facf[_0xa70c1e(0xd6)]['map'](async _0x39d54a=>{const _0x75d2d0=_0xa70c1e,_0x1e95b9=this['calculateEffectiveAmount'](_0x39d54a);if(_0x1e95b9===0x0)return 0x0;return _0x39d54a['status']===_0x75d2d0(0x176)?-Math[_0x75d2d0(0x129)](_0x1e95b9):await currencyService_1[_0x75d2d0(0x150)][_0x75d2d0(0x16f)](_0x39d54a[_0x75d2d0(0x146)],_0x39d54a[_0x75d2d0(0xf8)]);})),_0x48fec3=_0x48c627[_0xa70c1e(0x171)]((_0x1ce927,_0x3a0596)=>_0x1ce927+_0x3a0596,0x0);return{'date':_0x27facf['date'][_0xa70c1e(0x173)]()['split']('T')[0x0],'amount':_0x48fec3};})),_0x462e1d=this[_0x4e84c6(0xc5)](_0x3c9fa2,new Date()),_0x4edc67=new Map(_0x23dcc8[_0x4e84c6(0xad)](_0x20224d=>[_0x20224d['date'],_0x20224d[_0x4e84c6(0x146)]])),_0x3ad1e6=_0x462e1d[_0x4e84c6(0xad)](_0x1aa8a9=>({'date':_0x1aa8a9,'amount':_0x4edc67['get'](_0x1aa8a9)||0x0}));return console[_0x4e84c6(0x12e)]('‚úÖ\x20Admin\x20statistics\x20generated\x20successfully'),console[_0x4e84c6(0x12e)]('üë•\x20Total\x20users:\x20'+_0x34dc10),console[_0x4e84c6(0x12e)](_0x4e84c6(0xbd)+_0x226ed3),console[_0x4e84c6(0x12e)](_0x4e84c6(0xc6)+_0x3ad1e6[_0x4e84c6(0x147)]),{'totalRevenue':Math[_0x4e84c6(0x138)](_0x53dc4c*0x64)/0x64,'totalUsers':_0x34dc10,'totalPayments':_0x226ed3,'averagePayment':Math['round'](_0x24f4d5*0x64)/0x64,'dailyRevenue':_0x3ad1e6};}async[a33_0x493b1a(0x163)](_0xdac01b){const _0x333750=a33_0x493b1a,{page:_0x213f89,limit:_0x5acf2c,status:_0x534ee6,gateway:_0x127686,shopId:_0x340166,dateFrom:_0x35f08a,dateTo:_0x51516f,search:_0x19413e}=_0xdac01b,_0x5689cf=(_0x213f89-0x1)*_0x5acf2c;console[_0x333750(0x12e)]('üìã\x20Getting\x20payments\x20with\x20filters:',_0xdac01b);const _0x2f3376={};_0x534ee6&&(_0x2f3376[_0x333750(0x161)]=_0x534ee6[_0x333750(0xb3)]());if(_0x127686){if((0x0,gateway_1[_0x333750(0x155)])(_0x127686)){const _0x4b5d13=(0x0,gateway_1[_0x333750(0xd2)])(_0x127686);_0x4b5d13&&(_0x2f3376[_0x333750(0x14c)]=_0x4b5d13);}else _0x2f3376['gateway']=_0x127686[_0x333750(0x157)]();}_0x340166&&(_0x2f3376[_0x333750(0xed)]=_0x340166);(_0x35f08a||_0x51516f)&&(_0x2f3376[_0x333750(0xbe)]={},_0x35f08a&&(_0x2f3376['createdAt'][_0x333750(0x11c)]=new Date(_0x35f08a)),_0x51516f&&(_0x2f3376[_0x333750(0xbe)]['lte']=new Date(_0x51516f)));_0x19413e&&(_0x2f3376['OR']=[{'orderId':{'contains':_0x19413e,'mode':_0x333750(0xc2)}},{'gatewayOrderId':{'contains':_0x19413e,'mode':_0x333750(0xc2)}},{'gatewayPaymentId':{'contains':_0x19413e,'mode':'insensitive'}},{'customerEmail':{'contains':_0x19413e,'mode':_0x333750(0xc2)}},{'customerName':{'contains':_0x19413e,'mode':_0x333750(0xc2)}},{'shop':{'name':{'contains':_0x19413e,'mode':_0x333750(0xc2)}}},{'shop':{'username':{'contains':_0x19413e,'mode':'insensitive'}}}]);const [_0x19972c,_0x34ec73]=await Promise[_0x333750(0x159)]([database_1[_0x333750(0x16e)]['payment'][_0x333750(0x131)]({'where':_0x2f3376,'skip':_0x5689cf,'take':_0x5acf2c,'orderBy':{'createdAt':_0x333750(0x16c)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x333750(0x16e)]['payment'][_0x333750(0xfb)]({'where':_0x2f3376})]);console[_0x333750(0x12e)](_0x333750(0xb9)+_0x19972c[_0x333750(0x147)]+'\x20payments\x20out\x20of\x20'+_0x34ec73+'\x20total');const _0x15d053=_0x19972c[_0x333750(0xad)](_0x3e5801=>({'id':_0x3e5801['id'],'shopId':_0x3e5801['shopId'],'shopName':_0x3e5801[_0x333750(0xd3)][_0x333750(0x16b)],'shopUsername':_0x3e5801[_0x333750(0xd3)][_0x333750(0xb8)],'gateway':_0x3e5801[_0x333750(0x14c)],'orderId':_0x3e5801['orderId'],'gatewayOrderId':_0x3e5801['gatewayOrderId'],'amount':_0x3e5801['amount'],'currency':_0x3e5801['currency'],'sourceCurrency':_0x3e5801[_0x333750(0x120)],'status':_0x3e5801['status'],'usage':_0x3e5801[_0x333750(0x15d)],'externalPaymentUrl':_0x3e5801[_0x333750(0xc1)],'gatewayPaymentId':_0x3e5801[_0x333750(0x156)],'customerEmail':_0x3e5801[_0x333750(0xe7)],'customerName':_0x3e5801[_0x333750(0xcd)],'cardLast4':_0x3e5801[_0x333750(0x16d)],'paymentMethod':_0x3e5801['paymentMethod'],'bankId':_0x3e5801[_0x333750(0xbb)],'remitterIban':_0x3e5801[_0x333750(0x11e)],'remitterName':_0x3e5801[_0x333750(0xdc)],'chargebackAmount':_0x3e5801['chargebackAmount'],'adminNotes':_0x3e5801['adminNotes'],'statusChangedBy':_0x3e5801[_0x333750(0xe4)],'statusChangedAt':_0x3e5801['statusChangedAt'],'createdAt':_0x3e5801['createdAt'],'updatedAt':_0x3e5801[_0x333750(0xf0)],'expiresAt':_0x3e5801[_0x333750(0xe8)]}));return{'payments':_0x15d053,'pagination':{'page':_0x213f89,'limit':_0x5acf2c,'total':_0x34ec73,'totalPages':Math[_0x333750(0x12d)](_0x34ec73/_0x5acf2c)}};}async['getPaymentById'](_0x2c1d8e){const _0x6c3a80=a33_0x493b1a;console[_0x6c3a80(0x12e)](_0x6c3a80(0x13f)+_0x2c1d8e);const _0x47149c=await database_1['default'][_0x6c3a80(0x143)]['findUnique']({'where':{'id':_0x2c1d8e},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}},'webhookLogs':{'orderBy':{'createdAt':_0x6c3a80(0x16c)},'take':0xa,'select':{'id':!![],'event':!![],'statusCode':!![],'retryCount':!![],'createdAt':!![]}}}});if(!_0x47149c)return console[_0x6c3a80(0x12e)](_0x6c3a80(0xd5)+_0x2c1d8e),null;return console['log'](_0x6c3a80(0xaf)+_0x47149c[_0x6c3a80(0xf1)]+'\x20('+_0x47149c['status']+')'),{'id':_0x47149c['id'],'shopId':_0x47149c[_0x6c3a80(0xed)],'shopName':_0x47149c[_0x6c3a80(0xd3)][_0x6c3a80(0x16b)],'shopUsername':_0x47149c[_0x6c3a80(0xd3)][_0x6c3a80(0xb8)],'gateway':_0x47149c[_0x6c3a80(0x14c)],'orderId':_0x47149c['orderId'],'gatewayOrderId':_0x47149c['gatewayOrderId'],'amount':_0x47149c[_0x6c3a80(0x146)],'currency':_0x47149c['currency'],'sourceCurrency':_0x47149c[_0x6c3a80(0x120)],'status':_0x47149c[_0x6c3a80(0x161)],'usage':_0x47149c[_0x6c3a80(0x15d)],'externalPaymentUrl':_0x47149c['externalPaymentUrl'],'gatewayPaymentId':_0x47149c[_0x6c3a80(0x156)],'customerEmail':_0x47149c['customerEmail'],'customerName':_0x47149c['customerName'],'cardLast4':_0x47149c[_0x6c3a80(0x16d)],'paymentMethod':_0x47149c['paymentMethod'],'bankId':_0x47149c['bankId'],'remitterIban':_0x47149c[_0x6c3a80(0x11e)],'remitterName':_0x47149c[_0x6c3a80(0xdc)],'chargebackAmount':_0x47149c[_0x6c3a80(0xe0)],'adminNotes':_0x47149c[_0x6c3a80(0x179)],'statusChangedBy':_0x47149c[_0x6c3a80(0xe4)],'statusChangedAt':_0x47149c['statusChangedAt'],'createdAt':_0x47149c[_0x6c3a80(0xbe)],'updatedAt':_0x47149c[_0x6c3a80(0xf0)],'expiresAt':_0x47149c[_0x6c3a80(0xe8)],'webhookLogs':_0x47149c[_0x6c3a80(0x134)]};}async['updatePaymentStatus'](_0xfd4d42,_0x342d04,_0xfabf2f,_0x20c29b){const _0x10e901=a33_0x493b1a;console['log']('üîÑ\x20Admin\x20updating\x20payment\x20'+_0xfd4d42+_0x10e901(0xd7)+_0x342d04);const _0x4819fa=[_0x10e901(0xe5),_0x10e901(0xe1),_0x10e901(0xd8),_0x10e901(0xb6),_0x10e901(0x169),_0x10e901(0x176)];if(!_0x4819fa['includes'](_0x342d04['toUpperCase']()))throw new Error(_0x10e901(0xea)+_0x4819fa[_0x10e901(0x122)](',\x20'));const _0x33bd6d=await database_1[_0x10e901(0x16e)]['payment'][_0x10e901(0xeb)]({'where':{'id':_0xfd4d42},'select':{'id':!![],'status':!![],'orderId':!![]}});if(!_0x33bd6d)throw new Error(_0x10e901(0x101));if(_0x342d04['toUpperCase']()===_0x10e901(0x176)){if(!_0x20c29b||_0x20c29b<=0x0)throw new Error(_0x10e901(0x102));console[_0x10e901(0x12e)]('üí∏\x20Chargeback\x20amount:\x20'+_0x20c29b+'\x20USDT\x20(penalty\x20amount)');}const _0x3ae8ce={'status':_0x342d04[_0x10e901(0xb3)](),'updatedAt':new Date(),'statusChangedBy':_0x10e901(0xe6),'statusChangedAt':new Date()};_0xfabf2f&&(_0x3ae8ce[_0x10e901(0x179)]=_0xfabf2f);_0x342d04[_0x10e901(0xb3)]()===_0x10e901(0x176)&&_0x20c29b&&(_0x3ae8ce[_0x10e901(0xe0)]=_0x20c29b);const _0x5da46e=await database_1[_0x10e901(0x16e)]['payment'][_0x10e901(0xd1)]({'where':{'id':_0xfd4d42},'data':_0x3ae8ce,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});return await database_1['default'][_0x10e901(0x13a)][_0x10e901(0x14e)]({'data':{'paymentId':_0xfd4d42,'shopId':_0x5da46e['shopId'],'event':_0x10e901(0xcb),'statusCode':0xc8,'responseBody':JSON[_0x10e901(0x109)]({'oldStatus':_0x33bd6d[_0x10e901(0x161)],'newStatus':_0x342d04['toUpperCase'](),'notes':_0xfabf2f||null,'chargebackAmount':_0x20c29b||null,'updatedBy':'admin','timestamp':new Date()[_0x10e901(0x173)]()})}}),console[_0x10e901(0x12e)](_0x10e901(0x118)+_0x33bd6d['orderId']+'\x20status\x20updated\x20from\x20'+_0x33bd6d[_0x10e901(0x161)]+'\x20to\x20'+_0x342d04[_0x10e901(0xb3)]()),_0x342d04[_0x10e901(0xb3)]()===_0x10e901(0x176)&&console[_0x10e901(0x12e)](_0x10e901(0x115)+_0x20c29b+'\x20USDT\x20(will\x20be\x20deducted\x20from\x20merchant\x20balance)'),{'id':_0x5da46e['id'],'shopId':_0x5da46e[_0x10e901(0xed)],'shopName':_0x5da46e[_0x10e901(0xd3)][_0x10e901(0x16b)],'shopUsername':_0x5da46e[_0x10e901(0xd3)][_0x10e901(0xb8)],'gateway':_0x5da46e[_0x10e901(0x14c)],'orderId':_0x5da46e['orderId'],'gatewayOrderId':_0x5da46e[_0x10e901(0x128)],'amount':_0x5da46e['amount'],'currency':_0x5da46e[_0x10e901(0xf8)],'sourceCurrency':_0x5da46e[_0x10e901(0x120)],'status':_0x5da46e[_0x10e901(0x161)],'usage':_0x5da46e[_0x10e901(0x15d)],'externalPaymentUrl':_0x5da46e[_0x10e901(0xc1)],'gatewayPaymentId':_0x5da46e['gatewayPaymentId'],'customerEmail':_0x5da46e[_0x10e901(0xe7)],'customerName':_0x5da46e[_0x10e901(0xcd)],'cardLast4':_0x5da46e[_0x10e901(0x16d)],'paymentMethod':_0x5da46e[_0x10e901(0xb5)],'bankId':_0x5da46e[_0x10e901(0xbb)],'remitterIban':_0x5da46e['remitterIban'],'remitterName':_0x5da46e[_0x10e901(0xdc)],'chargebackAmount':_0x5da46e[_0x10e901(0xe0)],'adminNotes':_0x5da46e[_0x10e901(0x179)],'statusChangedBy':_0x5da46e[_0x10e901(0xe4)],'statusChangedAt':_0x5da46e['statusChangedAt'],'createdAt':_0x5da46e[_0x10e901(0xbe)],'updatedAt':_0x5da46e[_0x10e901(0xf0)],'expiresAt':_0x5da46e[_0x10e901(0xe8)]};}async['getAllUsers'](_0x20f86a){const _0x436149=a33_0x493b1a,{page:_0x4e0d82,limit:_0x5c177c,status:_0x5202cd}=_0x20f86a,_0x5c28af=(_0x4e0d82-0x1)*_0x5c177c,_0x4e7e60={};_0x5202cd&&(_0x4e7e60[_0x436149(0x161)]=_0x5202cd[_0x436149(0xb3)]());console[_0x436149(0x12e)](_0x436149(0x167),{'page':_0x4e0d82,'limit':_0x5c177c,'status':_0x5202cd,'where':_0x4e7e60});const [_0x573786,_0x3b9e72]=await Promise[_0x436149(0x159)]([database_1['default'][_0x436149(0xd3)][_0x436149(0x131)]({'where':_0x4e7e60,'skip':_0x5c28af,'take':_0x5c177c,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':'desc'}}),database_1[_0x436149(0x16e)][_0x436149(0xd3)]['count']({'where':_0x4e7e60})]);console[_0x436149(0x12e)](_0x436149(0xb9)+_0x573786['length']+_0x436149(0x13c)+_0x3b9e72+_0x436149(0xfe));const _0x1b38b7=_0x573786[_0x436149(0xad)](_0x29f4c3=>({'id':_0x29f4c3['id'],'fullName':_0x29f4c3[_0x436149(0x16b)],'username':_0x29f4c3[_0x436149(0xb8)],'telegramId':_0x29f4c3['telegram'],'merchantUrl':_0x29f4c3[_0x436149(0xc7)],'gateways':_0x29f4c3[_0x436149(0x14b)]?JSON['parse'](_0x29f4c3[_0x436149(0x14b)]):null,'gatewaySettings':_0x29f4c3['gatewaySettings']?JSON[_0x436149(0xaa)](_0x29f4c3[_0x436149(0x160)]):null,'publicKey':_0x29f4c3[_0x436149(0x13b)],'wallets':{'usdtPolygonWallet':_0x29f4c3[_0x436149(0x133)],'usdtTrcWallet':_0x29f4c3[_0x436149(0x164)],'usdtErcWallet':_0x29f4c3[_0x436149(0x104)],'usdcPolygonWallet':_0x29f4c3['usdcPolygonWallet']},'status':_0x29f4c3[_0x436149(0x161)],'createdAt':_0x29f4c3[_0x436149(0xbe)]}));return{'users':_0x1b38b7,'pagination':{'page':_0x4e0d82,'limit':_0x5c177c,'total':_0x3b9e72,'totalPages':Math[_0x436149(0x12d)](_0x3b9e72/_0x5c177c)}};}async[a33_0x493b1a(0x107)](_0xa3f8a7){const _0x12aad3=a33_0x493b1a;return await this[_0x12aad3(0x110)][_0x12aad3(0x107)](_0xa3f8a7);}async[a33_0x493b1a(0xd0)](_0x42c1a6){const _0x12cc53=a33_0x493b1a;return await this[_0x12cc53(0x110)][_0x12cc53(0xd0)](_0x42c1a6);}async[a33_0x493b1a(0x106)](_0x1ced8a,_0x1240cd){const _0xf6393f=a33_0x493b1a;return await this[_0xf6393f(0x110)]['updateUser'](_0x1ced8a,_0x1240cd);}async[a33_0x493b1a(0x12a)](_0x49ce6c){const _0x51caf0=a33_0x493b1a;return await this[_0x51caf0(0x110)][_0x51caf0(0x12a)](_0x49ce6c);}async[a33_0x493b1a(0xb7)](_0x482263){const _0x12fbdd=a33_0x493b1a;console[_0x12fbdd(0x12e)]('üö´\x20Suspending\x20user:\x20'+_0x482263);const _0x154a6d=await database_1[_0x12fbdd(0x16e)]['shop'][_0x12fbdd(0xeb)]({'where':{'id':_0x482263},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x154a6d)throw new Error(_0x12fbdd(0xf5));if(_0x154a6d[_0x12fbdd(0x161)]==='SUSPENDED')throw new Error('User\x20is\x20already\x20suspended');const _0x63dc68=await this[_0x12fbdd(0x110)][_0x12fbdd(0x106)](_0x482263,{'status':_0x12fbdd(0x105)});return console[_0x12fbdd(0x12e)](_0x12fbdd(0x178)+_0x154a6d['username']+_0x12fbdd(0x15b)),_0x63dc68;}async['activateUser'](_0x21723b){const _0x93d88b=a33_0x493b1a;console['log'](_0x93d88b(0x112)+_0x21723b);const _0x40f124=await database_1[_0x93d88b(0x16e)][_0x93d88b(0xd3)]['findUnique']({'where':{'id':_0x21723b},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x40f124)throw new Error(_0x93d88b(0xf5));if(_0x40f124[_0x93d88b(0x161)]==='ACTIVE')throw new Error(_0x93d88b(0x151));const _0x1ebbec=await this[_0x93d88b(0x110)][_0x93d88b(0x106)](_0x21723b,{'status':_0x93d88b(0x162)});return console['log']('‚úÖ\x20User\x20'+_0x40f124[_0x93d88b(0xb8)]+'\x20activated\x20successfully'),_0x1ebbec;}}function a33_0x4e9e(_0x333490,_0x1e830a){const _0x1626f7=a33_0x1626();return a33_0x4e9e=function(_0x4e9ec2,_0x2daeb2){_0x4e9ec2=_0x4e9ec2-0xa9;let _0x4bd60c=_0x1626f7[_0x4e9ec2];return _0x4bd60c;},a33_0x4e9e(_0x333490,_0x1e830a);}exports[a33_0x493b1a(0xe3)]=AdminService;