'use strict';const a35_0xc66d11=a35_0x3314;(function(_0x13bc47,_0x165d52){const _0x2ffa2b=a35_0x3314,_0x3517b3=_0x13bc47();while(!![]){try{const _0xeb6af6=-parseInt(_0x2ffa2b(0x251))/0x1+parseInt(_0x2ffa2b(0x1b6))/0x2*(-parseInt(_0x2ffa2b(0x1ee))/0x3)+parseInt(_0x2ffa2b(0x178))/0x4+-parseInt(_0x2ffa2b(0x1f2))/0x5+parseInt(_0x2ffa2b(0x185))/0x6*(parseInt(_0x2ffa2b(0x182))/0x7)+parseInt(_0x2ffa2b(0x165))/0x8+-parseInt(_0x2ffa2b(0x224))/0x9*(parseInt(_0x2ffa2b(0x1a2))/0xa);if(_0xeb6af6===_0x165d52)break;else _0x3517b3['push'](_0x3517b3['shift']());}catch(_0x2f17b6){_0x3517b3['push'](_0x3517b3['shift']());}}}(a35_0xce38,0xd053e));var __importDefault=this&&this[a35_0xc66d11(0x1a6)]||function(_0x4ec102){return _0x4ec102&&_0x4ec102['__esModule']?_0x4ec102:{'default':_0x4ec102};};Object[a35_0xc66d11(0x200)](exports,'__esModule',{'value':!![]}),exports[a35_0xc66d11(0x1ca)]=void 0x0;const database_1=__importDefault(require('../config/database')),bcryptjs_1=__importDefault(require(a35_0xc66d11(0x1e1))),crypto_1=__importDefault(require(a35_0xc66d11(0x262))),currencyService_1=require(a35_0xc66d11(0x167)),gateway_1=require(a35_0xc66d11(0x1bf));class AdminService{async[a35_0xc66d11(0x1bb)](){const _0x5cf13b=a35_0xc66d11;console[_0x5cf13b(0x26e)](_0x5cf13b(0x175));const _0x3e43d7=await database_1[_0x5cf13b(0x231)][_0x5cf13b(0x19a)][_0x5cf13b(0x1ae)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x5cf13b(0x1d7)}}),_0xe5b928=await this[_0x5cf13b(0x168)]({'page':0x1,'limit':0x3e8}),_0x5d0244=await database_1[_0x5cf13b(0x231)][_0x5cf13b(0x179)][_0x5cf13b(0x20e)]({'where':{'status':_0x5cf13b(0x226),'gateway':{'not':_0x5cf13b(0x1b8)}}}),_0x4c82ba=new Date(),_0x56135b=new Date(_0x4c82ba[_0x5cf13b(0x18c)](),_0x4c82ba['getMonth'](),0x1),_0x10337e=new Date(_0x4c82ba[_0x5cf13b(0x18c)](),_0x4c82ba['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x296656=await database_1[_0x5cf13b(0x231)][_0x5cf13b(0x1e3)][_0x5cf13b(0x1ae)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x56135b,'lte':_0x10337e},'status':'COMPLETED'}}),_0x54ef45=_0x3e43d7[_0x5cf13b(0x22f)][_0x5cf13b(0x202)]||0x0,_0x2bf5e7=_0xe5b928['summary'][_0x5cf13b(0x23b)],_0x1781c4=_0x296656['_sum'][_0x5cf13b(0x24c)]||0x0,_0x3e8b19={'totalPayout':Math[_0x5cf13b(0x1a1)](_0x54ef45*0x64)/0x64,'awaitingPayout':Math[_0x5cf13b(0x1a1)](_0x2bf5e7*0x64)/0x64,'thisMonth':Math['round'](_0x1781c4*0x64)/0x64,'availableBalance':Math['round'](_0x2bf5e7*0x64)/0x64,'totalPayments':_0x5d0244};return console[_0x5cf13b(0x26e)](_0x5cf13b(0x208)),console[_0x5cf13b(0x26e)]('\x20\x20\x20💰\x20Total\x20payout:\x20'+_0x3e8b19[_0x5cf13b(0x277)]+_0x5cf13b(0x192)),console['log'](_0x5cf13b(0x1fe)+_0x3e8b19[_0x5cf13b(0x1f1)]+'\x20USDT\x20(with\x20commission\x20deducted)'),console['log'](_0x5cf13b(0x15d)+_0x3e8b19[_0x5cf13b(0x236)]+_0x5cf13b(0x276)),console[_0x5cf13b(0x26e)](_0x5cf13b(0x256)+_0x3e8b19[_0x5cf13b(0x260)]+'\x20USDT'),console['log'](_0x5cf13b(0x1a8)+_0x3e8b19[_0x5cf13b(0x204)]+_0x5cf13b(0x214)),console[_0x5cf13b(0x26e)](_0x5cf13b(0x278)+(_0x3e43d7[_0x5cf13b(0x22f)]['balance']||0x0)[_0x5cf13b(0x1f0)](0x2)+_0x5cf13b(0x201)),console[_0x5cf13b(0x26e)](_0x5cf13b(0x187)+((_0x3e43d7['_sum']['balance']||0x0)-_0x2bf5e7)[_0x5cf13b(0x1f0)](0x2)+_0x5cf13b(0x206)),_0x3e8b19;}async[a35_0xc66d11(0x1cc)](_0x1c6f89,_0x369ac9){const _0x367c7=a35_0xc66d11;console['log'](_0x367c7(0x19f)+_0x1c6f89+':',_0x369ac9);const _0x1f78f1=await database_1['default'][_0x367c7(0x179)][_0x367c7(0x1d4)]({'where':{'id':_0x1c6f89},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x1f78f1)throw new Error(_0x367c7(0x169));const _0x37784f={};_0x369ac9['customerCountry']!==undefined&&(_0x37784f[_0x367c7(0x16d)]=_0x369ac9[_0x367c7(0x16d)]||null);_0x369ac9['customerIp']!==undefined&&(_0x37784f[_0x367c7(0x1dd)]=_0x369ac9[_0x367c7(0x1dd)]||null);_0x369ac9[_0x367c7(0x20a)]!==undefined&&(_0x37784f[_0x367c7(0x20a)]=_0x369ac9[_0x367c7(0x20a)]||null);const _0x39d069=await database_1[_0x367c7(0x231)][_0x367c7(0x179)]['update']({'where':{'id':_0x1c6f89},'data':{..._0x37784f,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x367c7(0x26e)](_0x367c7(0x1ea)+_0x1c6f89),console[_0x367c7(0x26e)](_0x367c7(0x1b3)+_0x1f78f1['customerCountry']+_0x367c7(0x164)+_0x39d069[_0x367c7(0x16d)]),console['log'](_0x367c7(0x1ec)+_0x1f78f1[_0x367c7(0x1dd)]+_0x367c7(0x164)+_0x39d069['customerIp']),console[_0x367c7(0x26e)](_0x367c7(0x243)+(_0x1f78f1['customerUa']?_0x367c7(0x237):'not\x20set')+_0x367c7(0x164)+(_0x39d069[_0x367c7(0x20a)]?'set':_0x367c7(0x21b))),_0x39d069;}async[a35_0xc66d11(0x1bc)](_0x3659e1){const _0x394b31=a35_0xc66d11,_0x6cdb64=new Date();let _0x5db4d3;switch(_0x3659e1){case'7d':_0x5db4d3=new Date(_0x6cdb64[_0x394b31(0x17d)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x394b31(0x1fd):_0x5db4d3=new Date(_0x6cdb64[_0x394b31(0x17d)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x394b31(0x19d):_0x5db4d3=new Date(_0x6cdb64[_0x394b31(0x17d)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x394b31(0x17a):const _0x32c35f=await database_1[_0x394b31(0x231)][_0x394b31(0x179)][_0x394b31(0x174)]({'where':{'gateway':{'not':_0x394b31(0x1b8)}},'orderBy':{'createdAt':_0x394b31(0x246)},'select':{'createdAt':!![]}});_0x5db4d3=_0x32c35f?_0x32c35f['createdAt']:new Date('2020-01-01'),console[_0x394b31(0x26e)]('📅\x20Period\x20\x27all\x27:\x20Using\x20start\x20date\x20from\x20first\x20payment:\x20'+_0x5db4d3[_0x394b31(0x223)]());break;default:_0x5db4d3=new Date(_0x6cdb64[_0x394b31(0x17d)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x5acb39,_0x17d082,_0x4a34e1,_0x1aebeb,_0x3ce37e,_0x135064,_0x436879]=await Promise['all']([database_1[_0x394b31(0x231)][_0x394b31(0x19a)]['count'](),database_1['default'][_0x394b31(0x19a)]['count']({'where':{'status':_0x394b31(0x1d7)}}),database_1[_0x394b31(0x231)][_0x394b31(0x179)][_0x394b31(0x20e)]({'where':{'createdAt':{'gte':_0x5db4d3},'gateway':{'not':_0x394b31(0x1b8)}}}),database_1[_0x394b31(0x231)]['payment'][_0x394b31(0x20e)]({'where':{'status':_0x394b31(0x226),'createdAt':{'gte':_0x5db4d3},'gateway':{'not':'test_gateway'}}}),database_1['default'][_0x394b31(0x179)][_0x394b31(0x160)]({'where':{'status':_0x394b31(0x226),'createdAt':{'gte':_0x5db4d3},'gateway':{'not':_0x394b31(0x1b8)}},'select':{'amount':!![],'currency':!![]}}),database_1['default'][_0x394b31(0x179)][_0x394b31(0x160)]({'where':{'gateway':{'not':_0x394b31(0x1b8)}},'take':0xa,'orderBy':{'createdAt':_0x394b31(0x1b7)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x394b31(0x231)][_0x394b31(0x179)][_0x394b31(0x160)]({'where':{'createdAt':{'gte':_0x5db4d3},'gateway':{'not':_0x394b31(0x1b8)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x9e55ea=0x0;for(const _0x9676d0 of _0x3ce37e){const _0x27efa1=await currencyService_1[_0x394b31(0x258)][_0x394b31(0x1c4)](_0x9676d0['amount'],_0x9676d0[_0x394b31(0x1c1)]);_0x9e55ea+=_0x27efa1;}const _0xb72062=this[_0x394b31(0x23a)](_0x436879,_0x5db4d3,_0x6cdb64),_0x57a460=_0x4a34e1>0x0?_0x1aebeb/_0x4a34e1*0x64:0x0;return{'totalShops':_0x5acb39,'activeShops':_0x17d082,'totalPayments':_0x4a34e1,'successfulPayments':_0x1aebeb,'totalRevenue':Math[_0x394b31(0x1a1)](_0x9e55ea*0x64)/0x64,'conversionRate':Math[_0x394b31(0x1a1)](_0x57a460*0x64)/0x64,'dailyRevenue':_0xb72062[_0x394b31(0x20d)],'dailyPayments':_0xb72062[_0x394b31(0x1d3)],'recentPayments':_0x135064[_0x394b31(0x1f6)](_0x3dab43=>({'id':_0x3dab43['id'],'amount':_0x3dab43['amount'],'currency':_0x3dab43[_0x394b31(0x1c1)],'status':_0x3dab43[_0x394b31(0x162)],'gateway':_0x3dab43[_0x394b31(0x22a)],'shop':_0x3dab43['shop'],'createdAt':_0x3dab43[_0x394b31(0x180)]}))};}async[a35_0xc66d11(0x21f)](_0x45e2a1){const _0xbcba0b=a35_0xc66d11;console['log'](_0xbcba0b(0x272),_0x45e2a1);let _0x5c1ebf,_0x4849bd=new Date();if(_0x45e2a1[_0xbcba0b(0x1cf)]===_0xbcba0b(0x18f)&&_0x45e2a1[_0xbcba0b(0x1f9)]&&_0x45e2a1['dateTo'])_0x5c1ebf=new Date(_0x45e2a1[_0xbcba0b(0x1f9)]),_0x4849bd=new Date(_0x45e2a1['dateTo']);else{const _0x68c3f5=new Date();switch(_0x45e2a1[_0xbcba0b(0x1cf)]){case'week':_0x5c1ebf=new Date(_0x68c3f5[_0xbcba0b(0x17d)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0xbcba0b(0x238):_0x5c1ebf=new Date(_0x68c3f5[_0xbcba0b(0x17d)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0xbcba0b(0x25d):_0x5c1ebf=new Date(_0x68c3f5[_0xbcba0b(0x17d)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0xbcba0b(0x17a):default:_0x5c1ebf=new Date(_0xbcba0b(0x184));break;}}console[_0xbcba0b(0x26e)](_0xbcba0b(0x23d)+_0x5c1ebf[_0xbcba0b(0x223)]()+_0xbcba0b(0x228)+_0x4849bd[_0xbcba0b(0x223)]());const _0x11c825={'status':'PAID','gateway':{'not':_0xbcba0b(0x1b8)},'paidAt':{'gte':_0x5c1ebf,'lte':_0x4849bd}};_0x45e2a1[_0xbcba0b(0x25c)]&&(_0x11c825['shopId']=_0x45e2a1[_0xbcba0b(0x25c)]);const _0x27e091=await database_1[_0xbcba0b(0x231)][_0xbcba0b(0x179)]['findMany']({'where':_0x11c825,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console['log'](_0xbcba0b(0x170)+_0x27e091[_0xbcba0b(0x25f)]+'\x20paid\x20payments\x20for\x20analysis');const _0x35d40f={'gateway':{'not':_0xbcba0b(0x1b8)},'createdAt':{'gte':_0x5c1ebf,'lte':_0x4849bd}};_0x45e2a1[_0xbcba0b(0x25c)]&&(_0x35d40f['shopId']=_0x45e2a1[_0xbcba0b(0x25c)]);const _0x3a65c0=await database_1['default'][_0xbcba0b(0x179)][_0xbcba0b(0x20e)]({'where':_0x35d40f});console['log'](_0xbcba0b(0x183)+_0x3a65c0+_0xbcba0b(0x247)+_0x27e091['length']);let _0x29fb2a=0x0,_0x2438b1=0x0,_0x310248=0x0;const _0xef77e2={},_0x1b2927={},_0xc46d89={};for(const _0x443e5a of _0x27e091){try{const _0x141851=await currencyService_1[_0xbcba0b(0x258)][_0xbcba0b(0x1c4)](_0x443e5a[_0xbcba0b(0x24c)],_0x443e5a['currency']);let _0xc8f738={};if(_0x443e5a['shop'][_0xbcba0b(0x1a7)])try{_0xc8f738=JSON['parse'](_0x443e5a[_0xbcba0b(0x19a)]['gatewaySettings']);}catch(_0x545ff7){console[_0xbcba0b(0x274)](_0xbcba0b(0x16e)+_0x443e5a[_0xbcba0b(0x25c)]+':',_0x545ff7);}let _0x1a5c92={},_0x5bbf78=0xa;for(const [_0xcb1595,_0x466a71]of Object[_0xbcba0b(0x205)](_0xc8f738)){if(_0xcb1595[_0xbcba0b(0x211)]()===_0x443e5a['gateway']['toLowerCase']()){_0x1a5c92=_0x466a71,_0x5bbf78=_0x466a71[_0xbcba0b(0x181)]||0xa;break;}}const _0x25a596=_0x141851*(_0x5bbf78/0x64),_0x503b56=_0x141851-_0x25a596;_0x29fb2a+=_0x141851,_0x2438b1+=_0x503b56,_0x310248+=_0x25a596;!_0xef77e2[_0x443e5a[_0xbcba0b(0x22a)]]&&(_0xef77e2[_0x443e5a[_0xbcba0b(0x22a)]]={'gateway':_0x443e5a[_0xbcba0b(0x22a)],'gatewayDisplayName':this[_0xbcba0b(0x22b)](_0x443e5a[_0xbcba0b(0x22a)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0xef77e2[_0x443e5a[_0xbcba0b(0x22a)]][_0xbcba0b(0x1fa)]++,_0xef77e2[_0x443e5a[_0xbcba0b(0x22a)]]['turnoverUSDT']+=_0x141851,_0xef77e2[_0x443e5a[_0xbcba0b(0x22a)]]['commissionUSDT']+=_0x25a596,_0xef77e2[_0x443e5a[_0xbcba0b(0x22a)]][_0xbcba0b(0x27b)]+=_0x503b56,_0xef77e2[_0x443e5a[_0xbcba0b(0x22a)]]['totalCommissionRate']+=_0x5bbf78;!_0x45e2a1[_0xbcba0b(0x25c)]&&(!_0x1b2927[_0x443e5a[_0xbcba0b(0x25c)]]&&(_0x1b2927[_0x443e5a[_0xbcba0b(0x25c)]]={'shopId':_0x443e5a[_0xbcba0b(0x25c)],'shopName':_0x443e5a['shop']['name'],'shopUsername':_0x443e5a[_0xbcba0b(0x19a)]['username'],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x1b2927[_0x443e5a[_0xbcba0b(0x25c)]]['paymentsCount']++,_0x1b2927[_0x443e5a['shopId']][_0xbcba0b(0x1cb)]+=_0x141851,_0x1b2927[_0x443e5a['shopId']]['commissionUSDT']+=_0x25a596,_0x1b2927[_0x443e5a[_0xbcba0b(0x25c)]][_0xbcba0b(0x27b)]+=_0x503b56);const _0x37e80a=_0x443e5a[_0xbcba0b(0x212)][_0xbcba0b(0x223)]()['split']('T')[0x0];!_0xc46d89[_0x37e80a]&&(_0xc46d89[_0x37e80a]={'date':_0x37e80a,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0xc46d89[_0x37e80a]['turnover']+=_0x141851,_0xc46d89[_0x37e80a][_0xbcba0b(0x21d)]+=_0x503b56,_0xc46d89[_0x37e80a][_0xbcba0b(0x15f)]+=_0x25a596,_0xc46d89[_0x37e80a]['paymentsCount']++;}catch(_0x2c2590){console['error'](_0xbcba0b(0x17e)+_0x443e5a['id']+':',_0x2c2590);}}Object[_0xbcba0b(0x1e8)](_0xef77e2)[_0xbcba0b(0x1ad)](_0x5a44e8=>{const _0x5d9404=_0xbcba0b;_0x5a44e8[_0x5d9404(0x239)]=_0x5a44e8[_0x5d9404(0x1fa)]>0x0?_0x5a44e8[_0x5d9404(0x257)]/_0x5a44e8[_0x5d9404(0x1fa)]:0x0,delete _0x5a44e8[_0x5d9404(0x257)];}),Object[_0xbcba0b(0x1e8)](_0x1b2927)['forEach'](_0x3c514f=>{const _0x131555=_0xbcba0b;_0x3c514f[_0x131555(0x203)]=_0x3c514f[_0x131555(0x1fa)]>0x0?_0x3c514f[_0x131555(0x1cb)]/_0x3c514f[_0x131555(0x1fa)]:0x0;});let _0x59e156=0x0;if(_0x45e2a1[_0xbcba0b(0x25c)]){const _0x376b85=await database_1[_0xbcba0b(0x231)][_0xbcba0b(0x1e3)][_0xbcba0b(0x160)]({'where':{'shopId':_0x45e2a1[_0xbcba0b(0x25c)],'status':_0xbcba0b(0x1e0),'createdAt':{'gte':_0x5c1ebf,'lte':_0x4849bd}},'select':{'amount':!![]}});_0x59e156=_0x376b85['reduce']((_0x16cb0d,_0xa96c9d)=>_0x16cb0d+_0xa96c9d[_0xbcba0b(0x24c)],0x0);}const _0x4d576f=_0x3a65c0,_0x43fe80=_0x27e091[_0xbcba0b(0x25f)],_0x121825=_0x43fe80>0x0?_0x29fb2a/_0x43fe80:0x0,_0x194764=_0x4d576f>0x0?Math[_0xbcba0b(0x1a1)](_0x43fe80/_0x4d576f*0x2710)/0x64:0x0,_0x4aa96e=Math[_0xbcba0b(0x1b0)]((_0x4849bd[_0xbcba0b(0x17d)]()-_0x5c1ebf[_0xbcba0b(0x17d)]())/(0x3e8*0x3c*0x3c*0x18)),_0x49a5de={'totalTurnover':Math['round'](_0x29fb2a*0x64)/0x64,'merchantEarnings':Math[_0xbcba0b(0x1a1)](_0x2438b1*0x64)/0x64,'gatewayEarnings':Math[_0xbcba0b(0x1a1)](_0x310248*0x64)/0x64,'totalPaidOut':Math[_0xbcba0b(0x1a1)](_0x59e156*0x64)/0x64,'averageCheck':Math[_0xbcba0b(0x1a1)](_0x121825*0x64)/0x64,'totalPayments':_0x4d576f,'successfulPayments':_0x43fe80,'conversionRate':_0x194764,'gatewayBreakdown':Object['values'](_0xef77e2)[_0xbcba0b(0x1f6)](_0x5be2fc=>({..._0x5be2fc,'turnoverUSDT':Math[_0xbcba0b(0x1a1)](_0x5be2fc[_0xbcba0b(0x1cb)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x5be2fc['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0xbcba0b(0x1a1)](_0x5be2fc['merchantEarningsUSDT']*0x64)/0x64,'averageCommissionRate':Math['round'](_0x5be2fc[_0xbcba0b(0x239)]*0x64)/0x64})),'merchantBreakdown':_0x45e2a1['shopId']?undefined:Object[_0xbcba0b(0x1e8)](_0x1b2927)[_0xbcba0b(0x1f6)](_0x5ae33c=>({..._0x5ae33c,'turnoverUSDT':Math[_0xbcba0b(0x1a1)](_0x5ae33c[_0xbcba0b(0x1cb)]*0x64)/0x64,'commissionUSDT':Math[_0xbcba0b(0x1a1)](_0x5ae33c[_0xbcba0b(0x189)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x5ae33c['merchantEarningsUSDT']*0x64)/0x64,'paidOutUSDT':Math[_0xbcba0b(0x1a1)](_0x5ae33c[_0xbcba0b(0x235)]*0x64)/0x64,'averageCheckUSDT':Math[_0xbcba0b(0x1a1)](_0x5ae33c[_0xbcba0b(0x203)]*0x64)/0x64})),'dailyData':Object[_0xbcba0b(0x1e8)](_0xc46d89)[_0xbcba0b(0x1f6)](_0x17c3ed=>({..._0x17c3ed,'turnover':Math[_0xbcba0b(0x1a1)](_0x17c3ed[_0xbcba0b(0x1a9)]*0x64)/0x64,'merchantEarnings':Math[_0xbcba0b(0x1a1)](_0x17c3ed['merchantEarnings']*0x64)/0x64,'gatewayEarnings':Math[_0xbcba0b(0x1a1)](_0x17c3ed[_0xbcba0b(0x15f)]*0x64)/0x64}))['sort']((_0x281f43,_0x1d5d54)=>_0x281f43[_0xbcba0b(0x1e2)][_0xbcba0b(0x263)](_0x1d5d54[_0xbcba0b(0x1e2)])),'periodInfo':{'from':_0x5c1ebf,'to':_0x4849bd,'periodType':_0x45e2a1[_0xbcba0b(0x1cf)]||_0xbcba0b(0x18f),'daysCount':_0x4aa96e}};return console['log']('📊\x20Merchant\x20statistics\x20calculated:'),console[_0xbcba0b(0x26e)](_0xbcba0b(0x1e7)+_0x49a5de['totalTurnover']+_0xbcba0b(0x206)),console[_0xbcba0b(0x26e)](_0xbcba0b(0x19e)+_0x49a5de[_0xbcba0b(0x21d)]+'\x20USDT'),console['log'](_0xbcba0b(0x193)+_0x49a5de[_0xbcba0b(0x15f)]+_0xbcba0b(0x206)),console[_0xbcba0b(0x26e)]('\x20\x20\x20📊\x20Total\x20payments:\x20'+_0x49a5de[_0xbcba0b(0x204)]),_0x49a5de;}async[a35_0xc66d11(0x24f)](){const _0x10eb19=a35_0xc66d11;console['log'](_0x10eb19(0x1f8));const _0x5c72a6=await database_1['default'][_0x10eb19(0x19a)][_0x10eb19(0x160)]({'where':{'status':_0x10eb19(0x1d7)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x10eb19(0x246)}});return console['log'](_0x10eb19(0x1b9)+_0x5c72a6[_0x10eb19(0x25f)]+_0x10eb19(0x1b4)),_0x5c72a6[_0x10eb19(0x1f6)](_0x4542f3=>({'id':_0x4542f3['id'],'username':_0x4542f3[_0x10eb19(0x241)],'name':_0x4542f3[_0x10eb19(0x221)]}));}[a35_0xc66d11(0x22b)](_0x4e1bb0){const _0x2c70bf=a35_0xc66d11,_0x2f91fb={'test_gateway':_0x2c70bf(0x176),'plisio':_0x2c70bf(0x242),'rapyd':'Rapyd','noda':_0x2c70bf(0x259),'cointopay':_0x2c70bf(0x1fc),'klyme_eu':_0x2c70bf(0x225),'klyme_gb':'KLYME\x20GB','klyme_de':'KLYME\x20DE'};return _0x2f91fb[_0x4e1bb0]||_0x4e1bb0;}async[a35_0xc66d11(0x168)](_0x30e967){const _0x4d0583=a35_0xc66d11,{page:_0x16f8d6,limit:_0x32b42e,minAmount:_0x5da7b3,search:_0x2e78ec}=_0x30e967,_0x54d585=(_0x16f8d6-0x1)*_0x32b42e;console[_0x4d0583(0x26e)]('📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:',_0x30e967);const _0x52928f={'balance':{'gt':0x0},'status':_0x4d0583(0x1d7)};_0x5da7b3&&(_0x52928f['balance'][_0x4d0583(0x171)]=_0x5da7b3);_0x2e78ec&&(_0x52928f['OR']=[{'name':{'contains':_0x2e78ec,'mode':_0x4d0583(0x1a3)}},{'username':{'contains':_0x2e78ec,'mode':_0x4d0583(0x1a3)}}]);const [_0x33758a,_0x10cf4f]=await Promise[_0x4d0583(0x17a)]([database_1['default'][_0x4d0583(0x19a)][_0x4d0583(0x160)]({'where':_0x52928f,'skip':_0x54d585,'take':_0x32b42e,'orderBy':{'balance':_0x4d0583(0x1b7)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1['default'][_0x4d0583(0x19a)][_0x4d0583(0x20e)]({'where':_0x52928f})]);console['log'](_0x4d0583(0x170)+_0x33758a[_0x4d0583(0x25f)]+'\x20merchants\x20with\x20positive\x20balance');const _0x38b40b=await Promise[_0x4d0583(0x17a)](_0x33758a[_0x4d0583(0x1f6)](async _0x3dc13a=>{const _0x3f626c=_0x4d0583,[_0x262925,_0x3ef17d,_0x503b59]=await Promise['all']([database_1[_0x3f626c(0x231)][_0x3f626c(0x179)][_0x3f626c(0x20e)]({'where':{'shopId':_0x3dc13a['id'],'status':_0x3f626c(0x226),'gateway':{'not':_0x3f626c(0x1b8)}}}),database_1[_0x3f626c(0x231)][_0x3f626c(0x179)]['findFirst']({'where':{'shopId':_0x3dc13a['id'],'status':'PAID','gateway':{'not':_0x3f626c(0x1b8)}},'orderBy':{'paidAt':_0x3f626c(0x246)},'select':{'paidAt':!![]}}),database_1[_0x3f626c(0x231)][_0x3f626c(0x179)][_0x3f626c(0x1a4)]({'by':[_0x3f626c(0x22a)],'where':{'shopId':_0x3dc13a['id'],'status':_0x3f626c(0x226),'gateway':{'not':_0x3f626c(0x1b8)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x47e67f=new Date(),_0x1de36e=new Date(_0x47e67f[_0x3f626c(0x18c)](),_0x47e67f[_0x3f626c(0x19b)](),0x1),_0x43494a=new Date(_0x47e67f[_0x3f626c(0x18c)](),_0x47e67f[_0x3f626c(0x19b)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x2bf127,_0x4c5368]=await Promise['all']([database_1[_0x3f626c(0x231)][_0x3f626c(0x1e3)][_0x3f626c(0x1ae)]({'_sum':{'amount':!![]},'where':{'shopId':_0x3dc13a['id'],'status':'COMPLETED'}}),database_1['default'][_0x3f626c(0x1e3)][_0x3f626c(0x1ae)]({'_sum':{'amount':!![]},'where':{'shopId':_0x3dc13a['id'],'status':_0x3f626c(0x1e0),'createdAt':{'gte':_0x1de36e,'lte':_0x43494a}}})]),_0x2c7ffd=_0x2bf127[_0x3f626c(0x22f)][_0x3f626c(0x24c)]||0x0,_0x1aa3ee=_0x4c5368[_0x3f626c(0x22f)][_0x3f626c(0x24c)]||0x0,_0x46c33a=await Promise['all'](_0x503b59['map'](async _0x333e52=>{const _0x5b003c=_0x3f626c;let _0x227dff=0xa;if(_0x3dc13a['gatewaySettings'])try{const _0x434c74=JSON[_0x5b003c(0x1d1)](_0x3dc13a[_0x5b003c(0x1a7)]);for(const [_0x163492,_0x100c62]of Object[_0x5b003c(0x205)](_0x434c74)){if(_0x163492[_0x5b003c(0x211)]()===_0x333e52[_0x5b003c(0x22a)][_0x5b003c(0x211)]()){_0x227dff=_0x100c62[_0x5b003c(0x181)]||0xa,console[_0x5b003c(0x26e)](_0x5b003c(0x245)+_0x333e52['gateway']+_0x5b003c(0x279)+_0x3dc13a['id']+_0x5b003c(0x271)+_0x227dff+'%');break;}}}catch(_0x2363a1){console[_0x5b003c(0x274)](_0x5b003c(0x16e)+_0x3dc13a['id']+':',_0x2363a1);}const _0x3455a8=_0x333e52['_sum']['amountUSDT']||0x0,_0x382a6a=_0x3455a8*(0x1-_0x227dff/0x64);return{'gateway':_0x333e52[_0x5b003c(0x22a)],'count':_0x333e52[_0x5b003c(0x220)]['id'],'amountUSDT':Math[_0x5b003c(0x1a1)](_0x3455a8*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x5b003c(0x1a1)](_0x382a6a*0x64)/0x64,'commission':_0x227dff};})),_0x34a686=_0x46c33a[_0x3f626c(0x222)]((_0x496d3a,_0x7952a9)=>_0x496d3a+_0x7952a9['amountUSDT'],0x0),_0x2cf35b=_0x3dc13a[_0x3f626c(0x230)];return console['log'](_0x3f626c(0x1cd)+_0x3dc13a[_0x3f626c(0x241)]+':'),console[_0x3f626c(0x26e)](_0x3f626c(0x1f3)+_0x34a686[_0x3f626c(0x1f0)](0x2)+_0x3f626c(0x1d0)),console[_0x3f626c(0x26e)](_0x3f626c(0x198)+_0x46c33a[_0x3f626c(0x222)]((_0x374d28,_0x52d391)=>_0x374d28+_0x52d391[_0x3f626c(0x1df)],0x0)['toFixed'](0x2)+_0x3f626c(0x213)),console['log'](_0x3f626c(0x17b)+_0x2cf35b[_0x3f626c(0x1f0)](0x2)+_0x3f626c(0x26c)),{'id':_0x3dc13a['id'],'fullName':_0x3dc13a[_0x3f626c(0x221)],'username':_0x3dc13a['username'],'telegramId':_0x3dc13a[_0x3f626c(0x1d8)],'merchantUrl':_0x3dc13a[_0x3f626c(0x1aa)],'wallets':{'usdtPolygonWallet':_0x3dc13a['usdtPolygonWallet'],'usdtTrcWallet':_0x3dc13a['usdtTrcWallet'],'usdtErcWallet':_0x3dc13a[_0x3f626c(0x252)],'usdcPolygonWallet':_0x3dc13a[_0x3f626c(0x21c)]},'totalAmountUSDT':Math['round'](_0x34a686*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x2cf35b*0x64)/0x64,'totalPayout':Math[_0x3f626c(0x1a1)](_0x2c7ffd*0x64)/0x64,'thisMonth':Math[_0x3f626c(0x1a1)](_0x1aa3ee*0x64)/0x64,'paymentsCount':_0x262925,'oldestPaymentDate':_0x3ef17d?.['paidAt']||_0x3dc13a['createdAt'],'gatewayBreakdown':_0x46c33a};})),_0xa75904=_0x38b40b[_0x4d0583(0x222)]((_0x1b5566,_0x4327a9)=>_0x1b5566+_0x4327a9[_0x4d0583(0x1be)],0x0),_0x68eac0=_0x38b40b['reduce']((_0x4cab1c,_0x291046)=>_0x4cab1c+_0x291046[_0x4d0583(0x23b)],0x0),_0x1d81c6=_0x38b40b[_0x4d0583(0x222)]((_0x2d7850,_0x273061)=>_0x2d7850+_0x273061[_0x4d0583(0x277)],0x0),_0x183ba3=_0x38b40b['reduce']((_0x23869a,_0x8333bc)=>_0x23869a+_0x8333bc['thisMonth'],0x0);return console['log'](_0x4d0583(0x26a)+_0x10cf4f+_0x4d0583(0x216)),console[_0x4d0583(0x26e)](_0x4d0583(0x217)+Math['round'](_0xa75904*0x64)/0x64+_0x4d0583(0x1d0)),console[_0x4d0583(0x26e)](_0x4d0583(0x27a)+Math[_0x4d0583(0x1a1)](_0x68eac0*0x64)/0x64+_0x4d0583(0x186)),console[_0x4d0583(0x26e)](_0x4d0583(0x18d)+Math['round'](_0x1d81c6*0x64)/0x64+_0x4d0583(0x206)),console[_0x4d0583(0x26e)](_0x4d0583(0x1b5)+Math[_0x4d0583(0x1a1)](_0x183ba3*0x64)/0x64+_0x4d0583(0x206)),{'merchants':_0x38b40b,'pagination':{'page':_0x16f8d6,'limit':_0x32b42e,'total':_0x10cf4f,'totalPages':Math[_0x4d0583(0x1b0)](_0x10cf4f/_0x32b42e)},'summary':{'totalMerchants':_0x10cf4f,'totalAmountUSDT':Math[_0x4d0583(0x1a1)](_0xa75904*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x4d0583(0x1a1)](_0x68eac0*0x64)/0x64,'totalPayout':Math[_0x4d0583(0x1a1)](_0x1d81c6*0x64)/0x64,'thisMonth':Math['round'](_0x183ba3*0x64)/0x64}};}async['createPayout'](_0x244c18){const _0x1c84a7=a35_0xc66d11,{shopId:_0x4dd355,amount:_0x54399e,network:_0x16f2ca,wallet:_0x233503,notes:_0x6eeeb2,txid:_0x1a398d,periodFrom:_0x2f51a8,periodTo:_0x1bebe7}=_0x244c18,_0x2b7c8a=await database_1['default'][_0x1c84a7(0x232)](async _0x3f2402=>{const _0x3c58e0=_0x1c84a7,_0x394062=await _0x3f2402[_0x3c58e0(0x19a)][_0x3c58e0(0x1d4)]({'where':{'id':_0x4dd355},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x394062)throw new Error('Shop\x20not\x20found');console['log'](_0x3c58e0(0x17c)+_0x394062[_0x3c58e0(0x241)]+':'),console[_0x3c58e0(0x26e)]('\x20\x20\x20Current\x20balance:\x20'+_0x394062['balance'][_0x3c58e0(0x1f0)](0x6)+_0x3c58e0(0x206)),console[_0x3c58e0(0x26e)]('\x20\x20\x20Payout\x20amount:\x20'+_0x54399e['toFixed'](0x6)+'\x20USDT'),console[_0x3c58e0(0x26e)](_0x3c58e0(0x1e5)+_0x394062[_0x3c58e0(0x202)][_0x3c58e0(0x1f0)](0x6)+'\x20USDT');if(_0x1a398d)console['log']('\x20\x20\x20Transaction\x20hash:\x20'+_0x1a398d);if(_0x394062['balance']<_0x54399e)throw new Error(_0x3c58e0(0x265)+_0x394062[_0x3c58e0(0x230)][_0x3c58e0(0x1f0)](0x6)+'\x20USDT,\x20Requested:\x20'+_0x54399e[_0x3c58e0(0x1f0)](0x6)+_0x3c58e0(0x206));let _0x2629d3=_0x233503;if(!_0x2629d3){const _0x231de9=await _0x3f2402[_0x3c58e0(0x19a)][_0x3c58e0(0x1d4)]({'where':{'id':_0x4dd355},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x231de9)switch(_0x16f2ca){case _0x3c58e0(0x1c3):_0x2629d3=_0x231de9['usdtPolygonWallet']||undefined;break;case _0x3c58e0(0x1c8):_0x2629d3=_0x231de9['usdtTrcWallet']||undefined;break;case'erc20':_0x2629d3=_0x231de9[_0x3c58e0(0x252)]||undefined;break;case'polygon_usdc':_0x2629d3=_0x231de9[_0x3c58e0(0x21c)]||undefined;break;}}console[_0x3c58e0(0x26e)](_0x3c58e0(0x240)+_0x16f2ca+':\x20'+(_0x2629d3||_0x3c58e0(0x1d6)));const _0x3913bc=await _0x3f2402[_0x3c58e0(0x1e3)]['create']({'data':{'shopId':_0x4dd355,'amount':_0x54399e,'network':_0x16f2ca,'status':_0x3c58e0(0x1e0),'txid':_0x1a398d,'notes':_0x6eeeb2,'periodFrom':_0x2f51a8?new Date(_0x2f51a8):null,'periodTo':_0x1bebe7?new Date(_0x1bebe7):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x3a9139=_0x394062[_0x3c58e0(0x230)]-_0x54399e,_0x14c2ee=_0x394062[_0x3c58e0(0x202)]+_0x54399e;return await _0x3f2402[_0x3c58e0(0x19a)]['update']({'where':{'id':_0x4dd355},'data':{'balance':_0x3a9139,'totalPaidOut':_0x14c2ee}}),console[_0x3c58e0(0x26e)](_0x3c58e0(0x1b1)+_0x394062[_0x3c58e0(0x241)]+'\x20balance\x20updated:'),console[_0x3c58e0(0x26e)](_0x3c58e0(0x1fb)+_0x394062[_0x3c58e0(0x230)][_0x3c58e0(0x1f0)](0x6)+_0x3c58e0(0x164)+_0x3a9139[_0x3c58e0(0x1f0)](0x6)+_0x3c58e0(0x268)+_0x54399e[_0x3c58e0(0x1f0)](0x6)+')'),console[_0x3c58e0(0x26e)]('\x20\x20\x20Total\x20paid\x20out:\x20'+_0x394062[_0x3c58e0(0x202)][_0x3c58e0(0x1f0)](0x6)+'\x20->\x20'+_0x14c2ee[_0x3c58e0(0x1f0)](0x6)+_0x3c58e0(0x22e)+_0x54399e['toFixed'](0x6)+')'),{'payout':_0x3913bc,'shop':_0x394062};});return console[_0x1c84a7(0x26e)](_0x1c84a7(0x24b)+_0x2b7c8a['payout']['id']+_0x1c84a7(0x279)+_0x2b7c8a[_0x1c84a7(0x19a)][_0x1c84a7(0x241)]+'\x20('+_0x54399e+_0x1c84a7(0x1da)),{'id':_0x2b7c8a['payout']['id'],'shopId':_0x2b7c8a['payout'][_0x1c84a7(0x25c)],'shopName':_0x2b7c8a['shop'][_0x1c84a7(0x221)],'shopUsername':_0x2b7c8a[_0x1c84a7(0x19a)]['username'],'amount':_0x2b7c8a[_0x1c84a7(0x1e3)][_0x1c84a7(0x24c)],'network':_0x2b7c8a[_0x1c84a7(0x1e3)][_0x1c84a7(0x1ce)],'status':_0x2b7c8a[_0x1c84a7(0x1e3)][_0x1c84a7(0x162)],'txid':_0x2b7c8a['payout']['txid'],'notes':_0x2b7c8a['payout'][_0x1c84a7(0x18b)],'periodFrom':_0x2b7c8a[_0x1c84a7(0x1e3)][_0x1c84a7(0x248)],'periodTo':_0x2b7c8a[_0x1c84a7(0x1e3)][_0x1c84a7(0x266)],'createdAt':_0x2b7c8a[_0x1c84a7(0x1e3)][_0x1c84a7(0x180)],'paidAt':_0x2b7c8a[_0x1c84a7(0x1e3)][_0x1c84a7(0x212)]};}async[a35_0xc66d11(0x1ab)](_0x133354){const _0x168c62=a35_0xc66d11,{page:_0x2bfc2a,limit:_0x27f91c,shopId:_0x3f4176,network:_0x11d85d,dateFrom:_0x4a848d,dateTo:_0x4005dc,search:_0x48ff91}=_0x133354,_0x2daea5=(_0x2bfc2a-0x1)*_0x27f91c,_0x1ba1c6={};_0x3f4176&&(_0x1ba1c6[_0x168c62(0x25c)]=_0x3f4176);_0x11d85d&&(_0x1ba1c6[_0x168c62(0x1ce)]=_0x11d85d);(_0x4a848d||_0x4005dc)&&(_0x1ba1c6[_0x168c62(0x180)]={},_0x4a848d&&(_0x1ba1c6[_0x168c62(0x180)]['gte']=new Date(_0x4a848d)),_0x4005dc&&(_0x1ba1c6[_0x168c62(0x180)]['lte']=new Date(_0x4005dc)));_0x48ff91&&(_0x1ba1c6['OR']=[{'shop':{'name':{'contains':_0x48ff91,'mode':_0x168c62(0x1a3)}}},{'shop':{'username':{'contains':_0x48ff91,'mode':_0x168c62(0x1a3)}}},{'notes':{'contains':_0x48ff91,'mode':_0x168c62(0x1a3)}}]);const [_0x3f0809,_0x583bd9]=await Promise[_0x168c62(0x17a)]([database_1['default'][_0x168c62(0x1e3)]['findMany']({'where':_0x1ba1c6,'skip':_0x2daea5,'take':_0x27f91c,'orderBy':{'createdAt':_0x168c62(0x1b7)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x168c62(0x1e3)][_0x168c62(0x20e)]({'where':_0x1ba1c6})]);return{'payouts':_0x3f0809[_0x168c62(0x1f6)](_0x5959bb=>({'id':_0x5959bb['id'],'shopId':_0x5959bb[_0x168c62(0x25c)],'shopName':_0x5959bb[_0x168c62(0x19a)][_0x168c62(0x221)],'shopUsername':_0x5959bb[_0x168c62(0x19a)]['username'],'amount':_0x5959bb[_0x168c62(0x24c)],'network':_0x5959bb['network'],'status':_0x5959bb['status'],'txid':_0x5959bb[_0x168c62(0x1a5)],'notes':_0x5959bb['notes'],'periodFrom':_0x5959bb[_0x168c62(0x248)],'periodTo':_0x5959bb[_0x168c62(0x266)],'createdAt':_0x5959bb[_0x168c62(0x180)],'paidAt':_0x5959bb[_0x168c62(0x212)]})),'pagination':{'page':_0x2bfc2a,'limit':_0x27f91c,'total':_0x583bd9,'totalPages':Math['ceil'](_0x583bd9/_0x27f91c)}};}async[a35_0xc66d11(0x1d5)](_0x348c6c){const _0x4ab17f=a35_0xc66d11,_0x343435=await database_1['default'][_0x4ab17f(0x1e3)][_0x4ab17f(0x1d4)]({'where':{'id':_0x348c6c},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x343435)return null;return{'id':_0x343435['id'],'shopId':_0x343435[_0x4ab17f(0x25c)],'shopName':_0x343435[_0x4ab17f(0x19a)][_0x4ab17f(0x221)],'shopUsername':_0x343435[_0x4ab17f(0x19a)]['username'],'amount':_0x343435[_0x4ab17f(0x24c)],'network':_0x343435[_0x4ab17f(0x1ce)],'status':_0x343435['status'],'txid':_0x343435[_0x4ab17f(0x1a5)],'notes':_0x343435[_0x4ab17f(0x18b)],'periodFrom':_0x343435[_0x4ab17f(0x248)],'periodTo':_0x343435[_0x4ab17f(0x266)],'createdAt':_0x343435['createdAt'],'paidAt':_0x343435[_0x4ab17f(0x212)]};}async[a35_0xc66d11(0x267)](_0x27c741){const _0x5c9c73=a35_0xc66d11;await database_1[_0x5c9c73(0x231)][_0x5c9c73(0x1e3)][_0x5c9c73(0x227)]({'where':{'id':_0x27c741}});}async[a35_0xc66d11(0x194)](_0x1df6eb){const _0x293995=a35_0xc66d11,{page:_0x730885,limit:_0x43ccf7,status:_0xb29801,gateway:_0x26f624,shopId:_0x225c07,dateFrom:_0x25604f,dateTo:_0x300c0e,search:_0x4c67e1,currency:_0x28f26f,sortBy:_0x571b63,sortOrder:_0x3eaa3c}=_0x1df6eb,_0x33a0e9=(_0x730885-0x1)*_0x43ccf7;console[_0x293995(0x26e)]('📊\x20Getting\x20payments\x20with\x20filters:',_0x1df6eb);const _0x4e2514=await database_1[_0x293995(0x231)]['payment'][_0x293995(0x1a4)]({'by':[_0x293995(0x22a)],'_count':{'gateway':!![]}});console[_0x293995(0x26e)](_0x293995(0x207),_0x4e2514[_0x293995(0x1f6)](_0x6ec29a=>_0x6ec29a[_0x293995(0x22a)]+'\x20('+_0x6ec29a['_count'][_0x293995(0x22a)]+_0x293995(0x22c)));if(_0x26f624){const _0x508977=_0x4e2514[_0x293995(0x1a0)](_0xc7ba1c=>_0xc7ba1c['gateway'][_0x293995(0x211)]()===_0x26f624[_0x293995(0x211)]());!_0x508977&&_0x26f624[_0x293995(0x211)]()!==_0x293995(0x1b8)&&console['log'](_0x293995(0x219)+_0x26f624+_0x293995(0x233)+_0x4e2514['map'](_0x29184e=>_0x29184e[_0x293995(0x22a)])[_0x293995(0x23c)](',\x20'));}const _0x5b69d6={};_0xb29801&&(_0x5b69d6[_0x293995(0x162)]=_0xb29801[_0x293995(0x1c5)]());if(!_0x26f624)_0x5b69d6[_0x293995(0x22a)]={'not':'test_gateway'};else{if(_0x26f624&&(_0x26f624[_0x293995(0x211)]()==='test_gateway'||_0x26f624===_0x293995(0x1f5)))_0x5b69d6['gateway']=_0x293995(0x1b8);else{let _0x17bf15=_0x26f624;const _0x15b3a7=(0x0,gateway_1[_0x293995(0x16f)])(_0x26f624);if(_0x15b3a7)_0x17bf15=_0x15b3a7,console[_0x293995(0x26e)](_0x293995(0x1ba)+_0x26f624+_0x293995(0x1b2)+_0x17bf15+'\x27');else{const _0x48af63=(0x0,gateway_1['getGatewayIdByName'])(_0x26f624);if(_0x48af63){const _0x5b793e=(0x0,gateway_1['getGatewayNameById'])(_0x48af63);_0x5b793e&&(_0x17bf15=_0x5b793e,console['log'](_0x293995(0x209)+_0x26f624+_0x293995(0x1e9)+_0x48af63+'\x27\x20->\x20name\x20\x27'+_0x17bf15+'\x27'));}else console[_0x293995(0x26e)]('🔍\x20Using\x20gateway\x20\x27'+_0x26f624+_0x293995(0x20b));}const _0x246e2a=await database_1[_0x293995(0x231)][_0x293995(0x179)][_0x293995(0x20e)]({'where':{'gateway':_0x17bf15['toLowerCase']()},'take':0x1});_0x246e2a===0x0?(console[_0x293995(0x26e)]('⚠️\x20Gateway\x20\x27'+_0x17bf15+'\x27\x20(from\x20\x27'+_0x26f624+_0x293995(0x1f7)),_0x5b69d6['gateway']=_0x293995(0x275)):(_0x5b69d6['gateway']=_0x17bf15['toLowerCase'](),console[_0x293995(0x26e)]('✅\x20Using\x20gateway\x20filter:\x20\x27'+_0x17bf15+'\x27\x20(from\x20\x27'+_0x26f624+'\x27)'));}}console['log'](_0x293995(0x26b),_0x5b69d6[_0x293995(0x22a)]);_0x225c07&&(_0x5b69d6['shopId']=_0x225c07);_0x28f26f&&(_0x5b69d6[_0x293995(0x1c1)]=_0x28f26f[_0x293995(0x1c5)](),console[_0x293995(0x26e)](_0x293995(0x1dc)+_0x28f26f[_0x293995(0x1c5)]()));(_0x25604f||_0x300c0e)&&(_0x5b69d6[_0x293995(0x180)]={},_0x25604f&&(_0x5b69d6['createdAt'][_0x293995(0x171)]=new Date(_0x25604f)),_0x300c0e&&(_0x5b69d6['createdAt'][_0x293995(0x190)]=new Date(_0x300c0e)));_0x4c67e1&&(_0x5b69d6['OR']=[{'id':{'contains':_0x4c67e1,'mode':_0x293995(0x1a3)}},{'orderId':{'contains':_0x4c67e1,'mode':_0x293995(0x1a3)}},{'gatewayOrderId':{'contains':_0x4c67e1,'mode':'insensitive'}},{'customerEmail':{'contains':_0x4c67e1,'mode':_0x293995(0x1a3)}},{'shop':{'name':{'contains':_0x4c67e1,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x4c67e1,'mode':_0x293995(0x1a3)}}}]);console[_0x293995(0x26e)](_0x293995(0x218),JSON[_0x293995(0x25a)](_0x5b69d6,null,0x2));let _0x355c22={'createdAt':_0x293995(0x1b7)};if(_0x571b63){const _0x4d20aa=[_0x293995(0x24c),_0x293995(0x180),_0x293995(0x1eb),_0x293995(0x162),'gateway',_0x293995(0x1c1)],_0x189cef=[_0x293995(0x246),'desc'];if(_0x4d20aa[_0x293995(0x191)](_0x571b63)){const _0x4a3a35=_0x189cef[_0x293995(0x191)](_0x3eaa3c)?_0x3eaa3c:_0x293995(0x1b7);_0x355c22={[_0x571b63]:_0x4a3a35},console[_0x293995(0x26e)](_0x293995(0x1ed)+_0x571b63+_0x293995(0x1af)+_0x4a3a35+'\x20order');}}const [_0x5ca98d,_0xbe3edd]=await Promise['all']([database_1[_0x293995(0x231)][_0x293995(0x179)]['findMany']({'where':_0x5b69d6,'skip':_0x33a0e9,'take':_0x43ccf7,'orderBy':_0x355c22,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x293995(0x231)][_0x293995(0x179)][_0x293995(0x20e)]({'where':_0x5b69d6})]);return{'payments':_0x5ca98d,'pagination':{'page':_0x730885,'limit':_0x43ccf7,'total':_0xbe3edd,'totalPages':Math[_0x293995(0x1b0)](_0xbe3edd/_0x43ccf7)}};}async['getPaymentById'](_0x3bdf60){const _0x39c3f3=a35_0xc66d11,_0x3b9030=await database_1['default'][_0x39c3f3(0x179)][_0x39c3f3(0x1d4)]({'where':{'id':_0x3bdf60},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x3b9030)return null;return{'id':_0x3b9030['id'],'shopId':_0x3b9030[_0x39c3f3(0x25c)],'gateway':_0x3b9030[_0x39c3f3(0x22a)],'amount':_0x3b9030[_0x39c3f3(0x24c)],'currency':_0x3b9030[_0x39c3f3(0x1c1)],'status':_0x3b9030['status'],'orderId':_0x3b9030['orderId'],'gatewayOrderId':_0x3b9030['gatewayOrderId'],'customerEmail':_0x3b9030[_0x39c3f3(0x188)],'customerName':_0x3b9030['customerName'],'customerCountry':_0x3b9030['customerCountry'],'customerIp':_0x3b9030['customerIp'],'customerUa':_0x3b9030[_0x39c3f3(0x20a)],'failureMessage':_0x3b9030[_0x39c3f3(0x1c2)],'externalPaymentUrl':_0x3b9030[_0x39c3f3(0x270)],'successUrl':_0x3b9030['successUrl'],'failUrl':_0x3b9030['failUrl'],'pendingUrl':_0x3b9030[_0x39c3f3(0x20c)],'whiteUrl':_0x3b9030[_0x39c3f3(0x264)],'createdAt':_0x3b9030[_0x39c3f3(0x180)],'updatedAt':_0x3b9030[_0x39c3f3(0x1eb)],'shop':_0x3b9030['shop']};}async['updatePaymentStatus'](_0x2e93a2,_0x40b5d8,_0x483524,_0x31ffeb){const _0x6f727c=a35_0xc66d11,_0x51c880=await database_1['default'][_0x6f727c(0x232)](async _0x4d8a84=>{const _0x166228=_0x6f727c,_0x2e6bea=await _0x4d8a84['payment'][_0x166228(0x1d4)]({'where':{'id':_0x2e93a2},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x2e6bea)throw new Error(_0x166228(0x169));const _0x156766=_0x2e6bea[_0x166228(0x162)],_0x2a51ab=_0x40b5d8[_0x166228(0x1c5)]();console[_0x166228(0x26e)](_0x166228(0x1de)+_0x2e93a2+'\x20status:\x20'+_0x156766+_0x166228(0x164)+_0x2a51ab),console[_0x166228(0x26e)]('💰\x20Current\x20shop\x20balance:\x20'+_0x2e6bea[_0x166228(0x19a)][_0x166228(0x230)]+_0x166228(0x206));const _0x42f09c={'status':_0x2a51ab,'updatedAt':new Date(),'statusChangedBy':_0x166228(0x161),'statusChangedAt':new Date()};_0x483524&&(_0x42f09c[_0x166228(0x1ef)]=_0x483524);_0x2a51ab==='CHARGEBACK'&&_0x31ffeb&&(_0x42f09c[_0x166228(0x210)]=_0x31ffeb);let _0x4255c0=0x0,_0x397b43=_0x2e6bea['shop'][_0x166228(0x230)];if(_0x2a51ab===_0x166228(0x226)&&_0x156766!==_0x166228(0x226)){_0x42f09c[_0x166228(0x212)]=new Date();const _0x7f5325=await currencyService_1['currencyService'][_0x166228(0x1c4)](_0x2e6bea[_0x166228(0x24c)],_0x2e6bea['currency']);_0x42f09c[_0x166228(0x21e)]=_0x7f5325;let _0x7896a5=0xa;const _0x709b84=await _0x4d8a84[_0x166228(0x19a)]['findUnique']({'where':{'id':_0x2e6bea[_0x166228(0x25c)]},'select':{'gatewaySettings':!![]}});if(_0x709b84?.['gatewaySettings'])try{const _0x204905=JSON[_0x166228(0x1d1)](_0x709b84['gatewaySettings']);for(const [_0x3f8c07,_0x45c7db]of Object[_0x166228(0x205)](_0x204905)){if(_0x3f8c07[_0x166228(0x211)]()===_0x2e6bea['gateway']['toLowerCase']()){_0x7896a5=_0x45c7db[_0x166228(0x181)]||0xa;break;}}}catch(_0x32d306){console[_0x166228(0x274)](_0x166228(0x1db)+_0x2e93a2+':',_0x32d306);}const _0xa89771=_0x7f5325*(0x1-_0x7896a5/0x64);_0x4255c0=_0xa89771,_0x397b43+=_0xa89771,console['log'](_0x166228(0x16c)+_0x2e93a2+_0x166228(0x1bd)),console[_0x166228(0x26e)](_0x166228(0x177)+_0x7f5325['toFixed'](0x6)+_0x166228(0x206)),console[_0x166228(0x26e)](_0x166228(0x1ac)+_0x2e6bea['gateway']+_0x166228(0x23e)+_0x7896a5+'%'),console[_0x166228(0x26e)](_0x166228(0x253)+_0xa89771[_0x166228(0x1f0)](0x6)+_0x166228(0x215)+_0x7896a5+_0x166228(0x1e4)),console[_0x166228(0x26e)](_0x166228(0x25b)+_0xa89771[_0x166228(0x1f0)](0x6)+_0x166228(0x206));}else{if(_0x156766==='PAID'&&_0x2a51ab!==_0x166228(0x226)){if(_0x2e6bea[_0x166228(0x21e)]){let _0x212d4f=0xa;const _0x150b59=await _0x4d8a84[_0x166228(0x19a)][_0x166228(0x1d4)]({'where':{'id':_0x2e6bea[_0x166228(0x25c)]},'select':{'gatewaySettings':!![]}});if(_0x150b59?.['gatewaySettings'])try{const _0x128edc=JSON[_0x166228(0x1d1)](_0x150b59['gatewaySettings']);for(const [_0x5c801f,_0x1bebb5]of Object[_0x166228(0x205)](_0x128edc)){if(_0x5c801f[_0x166228(0x211)]()===_0x2e6bea['gateway'][_0x166228(0x211)]()){_0x212d4f=_0x1bebb5[_0x166228(0x181)]||0xa;break;}}}catch(_0x38781f){console[_0x166228(0x274)](_0x166228(0x1db)+_0x2e93a2+':',_0x38781f);}const _0x2d92be=_0x2e6bea[_0x166228(0x21e)]*(0x1-_0x212d4f/0x64);_0x4255c0=-_0x2d92be,_0x397b43-=_0x2d92be,_0x42f09c[_0x166228(0x21e)]=null,console[_0x166228(0x26e)](_0x166228(0x16c)+_0x2e93a2+_0x166228(0x25e)),console['log'](_0x166228(0x177)+_0x2e6bea[_0x166228(0x21e)][_0x166228(0x1f0)](0x6)+_0x166228(0x206)),console[_0x166228(0x26e)](_0x166228(0x1ac)+_0x2e6bea[_0x166228(0x22a)]+',\x20Commission:\x20'+_0x212d4f+'%'),console[_0x166228(0x26e)](_0x166228(0x24a)+_0x2d92be[_0x166228(0x1f0)](0x6)+_0x166228(0x215)+_0x212d4f+_0x166228(0x1e4)),console[_0x166228(0x26e)](_0x166228(0x19c)+_0x2d92be[_0x166228(0x1f0)](0x6)+_0x166228(0x206));}}}_0x2a51ab===_0x166228(0x195)&&(_0x156766===_0x166228(0x226)&&_0x2e6bea['amountUSDT']&&console[_0x166228(0x26e)](_0x166228(0x22d)),_0x31ffeb&&_0x31ffeb>0x0&&(_0x4255c0-=_0x31ffeb,_0x397b43-=_0x31ffeb,console[_0x166228(0x26e)](_0x166228(0x15e)+_0x31ffeb[_0x166228(0x1f0)](0x6)+_0x166228(0x197))));_0x2a51ab==='REFUND'&&_0x156766===_0x166228(0x226)&&console[_0x166228(0x26e)](_0x166228(0x26f));const _0x424dc0=await _0x4d8a84['payment'][_0x166228(0x234)]({'where':{'id':_0x2e93a2},'data':_0x42f09c,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x4255c0!==0x0&&(await _0x4d8a84[_0x166228(0x19a)][_0x166228(0x234)]({'where':{'id':_0x2e6bea[_0x166228(0x25c)]},'data':{'balance':_0x397b43}}),console[_0x166228(0x26e)](_0x166228(0x1b1)+_0x2e6bea[_0x166228(0x25c)]+_0x166228(0x1ff)+_0x2e6bea[_0x166228(0x19a)][_0x166228(0x230)][_0x166228(0x1f0)](0x6)+_0x166228(0x164)+_0x397b43['toFixed'](0x6)+_0x166228(0x18a)+(_0x4255c0>0x0?'+':'')+_0x4255c0[_0x166228(0x1f0)](0x6)+')')),_0x424dc0;});return{'id':_0x51c880['id'],'shopId':_0x51c880[_0x6f727c(0x25c)],'gateway':_0x51c880[_0x6f727c(0x22a)],'amount':_0x51c880['amount'],'currency':_0x51c880['currency'],'status':_0x51c880[_0x6f727c(0x162)],'orderId':_0x51c880['orderId'],'gatewayOrderId':_0x51c880[_0x6f727c(0x26d)],'customerEmail':_0x51c880[_0x6f727c(0x188)],'customerName':_0x51c880['customerName'],'customerCountry':_0x51c880['customerCountry'],'customerIp':_0x51c880[_0x6f727c(0x1dd)],'customerUa':_0x51c880[_0x6f727c(0x20a)],'failureMessage':_0x51c880['failureMessage'],'adminNotes':_0x51c880[_0x6f727c(0x1ef)],'chargebackAmount':_0x51c880[_0x6f727c(0x210)],'statusChangedBy':_0x51c880[_0x6f727c(0x199)],'statusChangedAt':_0x51c880[_0x6f727c(0x172)],'createdAt':_0x51c880['createdAt'],'updatedAt':_0x51c880['updatedAt'],'shop':_0x51c880[_0x6f727c(0x19a)]};}async[a35_0xc66d11(0x163)](_0x55b446,_0x1f7e07){const _0x186464=a35_0xc66d11,_0x5ac364={..._0x1f7e07};_0x1f7e07[_0x186464(0x16b)]&&(_0x5ac364['password']=await bcryptjs_1[_0x186464(0x231)][_0x186464(0x1d9)](_0x1f7e07['password'],0xc));_0x1f7e07[_0x186464(0x249)]&&(_0x5ac364[_0x186464(0x221)]=_0x1f7e07[_0x186464(0x249)],delete _0x5ac364[_0x186464(0x249)]);_0x1f7e07[_0x186464(0x173)]&&(_0x5ac364['telegram']=_0x1f7e07[_0x186464(0x173)],delete _0x5ac364[_0x186464(0x173)]);_0x1f7e07[_0x186464(0x1e6)]&&(_0x5ac364[_0x186464(0x1aa)]=_0x1f7e07[_0x186464(0x1e6)],delete _0x5ac364[_0x186464(0x1e6)]);_0x1f7e07[_0x186464(0x1f4)]&&(_0x5ac364['paymentGateways']=JSON[_0x186464(0x25a)](_0x1f7e07[_0x186464(0x1f4)]),delete _0x5ac364[_0x186464(0x1f4)]);_0x1f7e07[_0x186464(0x1a7)]&&(_0x5ac364[_0x186464(0x1a7)]=JSON[_0x186464(0x25a)](_0x1f7e07[_0x186464(0x1a7)]),delete _0x5ac364['gatewaySettings']);_0x1f7e07[_0x186464(0x18e)]&&(_0x1f7e07['wallets'][_0x186464(0x16a)]!==undefined&&(_0x5ac364[_0x186464(0x16a)]=_0x1f7e07[_0x186464(0x18e)][_0x186464(0x16a)]||null),_0x1f7e07[_0x186464(0x18e)]['usdtTrcWallet']!==undefined&&(_0x5ac364[_0x186464(0x1c9)]=_0x1f7e07[_0x186464(0x18e)][_0x186464(0x1c9)]||null),_0x1f7e07['wallets']['usdtErcWallet']!==undefined&&(_0x5ac364[_0x186464(0x252)]=_0x1f7e07[_0x186464(0x18e)][_0x186464(0x252)]||null),_0x1f7e07['wallets'][_0x186464(0x21c)]!==undefined&&(_0x5ac364[_0x186464(0x21c)]=_0x1f7e07[_0x186464(0x18e)][_0x186464(0x21c)]||null),delete _0x5ac364[_0x186464(0x18e)]);const _0x30e5ee=await database_1[_0x186464(0x231)][_0x186464(0x19a)][_0x186464(0x234)]({'where':{'id':_0x55b446},'data':_0x5ac364,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x30e5ee['id'],'fullName':_0x30e5ee['name'],'username':_0x30e5ee[_0x186464(0x241)],'telegramId':_0x30e5ee[_0x186464(0x1d8)],'merchantUrl':_0x30e5ee[_0x186464(0x1aa)],'gateways':_0x30e5ee[_0x186464(0x20f)]?JSON['parse'](_0x30e5ee['paymentGateways']):null,'gatewaySettings':_0x30e5ee[_0x186464(0x1a7)]?JSON[_0x186464(0x1d1)](_0x30e5ee['gatewaySettings']):null,'publicKey':_0x30e5ee[_0x186464(0x273)],'wallets':{'usdtPolygonWallet':_0x30e5ee[_0x186464(0x16a)],'usdtTrcWallet':_0x30e5ee[_0x186464(0x1c9)],'usdtErcWallet':_0x30e5ee[_0x186464(0x252)],'usdcPolygonWallet':_0x30e5ee[_0x186464(0x21c)]},'status':_0x30e5ee[_0x186464(0x162)],'createdAt':_0x30e5ee['createdAt']};}async['suspendUser'](_0x5d917c){const _0x2aca9c=a35_0xc66d11,_0x153faf=await database_1[_0x2aca9c(0x231)][_0x2aca9c(0x19a)][_0x2aca9c(0x234)]({'where':{'id':_0x5d917c},'data':{'status':_0x2aca9c(0x254)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x153faf['id'],'fullName':_0x153faf[_0x2aca9c(0x221)],'username':_0x153faf[_0x2aca9c(0x241)],'telegramId':_0x153faf[_0x2aca9c(0x1d8)],'merchantUrl':_0x153faf[_0x2aca9c(0x1aa)],'gateways':_0x153faf[_0x2aca9c(0x20f)]?JSON[_0x2aca9c(0x1d1)](_0x153faf[_0x2aca9c(0x20f)]):null,'gatewaySettings':_0x153faf['gatewaySettings']?JSON[_0x2aca9c(0x1d1)](_0x153faf[_0x2aca9c(0x1a7)]):null,'publicKey':_0x153faf[_0x2aca9c(0x273)],'wallets':{'usdtPolygonWallet':_0x153faf[_0x2aca9c(0x16a)],'usdtTrcWallet':_0x153faf[_0x2aca9c(0x1c9)],'usdtErcWallet':_0x153faf['usdtErcWallet'],'usdcPolygonWallet':_0x153faf[_0x2aca9c(0x21c)]},'status':_0x153faf[_0x2aca9c(0x162)],'createdAt':_0x153faf[_0x2aca9c(0x180)]};}async[a35_0xc66d11(0x24d)](_0x59aa09){const _0x2ef464=a35_0xc66d11,_0x5a4444=await database_1['default'][_0x2ef464(0x19a)]['update']({'where':{'id':_0x59aa09},'data':{'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x5a4444['id'],'fullName':_0x5a4444[_0x2ef464(0x221)],'username':_0x5a4444[_0x2ef464(0x241)],'telegramId':_0x5a4444[_0x2ef464(0x1d8)],'merchantUrl':_0x5a4444[_0x2ef464(0x1aa)],'gateways':_0x5a4444[_0x2ef464(0x20f)]?JSON[_0x2ef464(0x1d1)](_0x5a4444[_0x2ef464(0x20f)]):null,'gatewaySettings':_0x5a4444['gatewaySettings']?JSON[_0x2ef464(0x1d1)](_0x5a4444['gatewaySettings']):null,'publicKey':_0x5a4444[_0x2ef464(0x273)],'wallets':{'usdtPolygonWallet':_0x5a4444[_0x2ef464(0x16a)],'usdtTrcWallet':_0x5a4444['usdtTrcWallet'],'usdtErcWallet':_0x5a4444[_0x2ef464(0x252)],'usdcPolygonWallet':_0x5a4444['usdcPolygonWallet']},'status':_0x5a4444[_0x2ef464(0x162)],'createdAt':_0x5a4444[_0x2ef464(0x180)]};}async[a35_0xc66d11(0x255)](_0x1d1e82){const _0x2d0381=a35_0xc66d11,{page:_0x46af9e,limit:_0x2c88a8,status:_0x48883c}=_0x1d1e82,_0x2964c2=(_0x46af9e-0x1)*_0x2c88a8,_0x18d6cb={};_0x48883c&&(_0x18d6cb[_0x2d0381(0x162)]=_0x48883c[_0x2d0381(0x1c5)]());const [_0x335fba,_0x568eef]=await Promise[_0x2d0381(0x17a)]([database_1['default']['shop'][_0x2d0381(0x160)]({'where':_0x18d6cb,'skip':_0x2964c2,'take':_0x2c88a8,'orderBy':{'createdAt':_0x2d0381(0x1b7)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x2d0381(0x231)][_0x2d0381(0x19a)]['count']({'where':_0x18d6cb})]);return{'users':_0x335fba['map'](_0x23bb61=>({'id':_0x23bb61['id'],'fullName':_0x23bb61[_0x2d0381(0x221)],'username':_0x23bb61[_0x2d0381(0x241)],'telegramId':_0x23bb61['telegram'],'merchantUrl':_0x23bb61[_0x2d0381(0x1aa)],'gateways':_0x23bb61['paymentGateways']?JSON[_0x2d0381(0x1d1)](_0x23bb61[_0x2d0381(0x20f)]):null,'gatewaySettings':_0x23bb61['gatewaySettings']?JSON[_0x2d0381(0x1d1)](_0x23bb61[_0x2d0381(0x1a7)]):null,'publicKey':_0x23bb61[_0x2d0381(0x273)],'wallets':{'usdtPolygonWallet':_0x23bb61['usdtPolygonWallet'],'usdtTrcWallet':_0x23bb61['usdtTrcWallet'],'usdtErcWallet':_0x23bb61['usdtErcWallet'],'usdcPolygonWallet':_0x23bb61[_0x2d0381(0x21c)]},'status':_0x23bb61[_0x2d0381(0x162)],'createdAt':_0x23bb61[_0x2d0381(0x180)]})),'pagination':{'page':_0x46af9e,'limit':_0x2c88a8,'total':_0x568eef,'totalPages':Math[_0x2d0381(0x1b0)](_0x568eef/_0x2c88a8)}};}async[a35_0xc66d11(0x244)](_0x2e3cbd){const _0x55bd72=a35_0xc66d11,_0x3b3692=await database_1[_0x55bd72(0x231)][_0x55bd72(0x19a)]['findUnique']({'where':{'id':_0x2e3cbd},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x3b3692)return null;return{'id':_0x3b3692['id'],'fullName':_0x3b3692[_0x55bd72(0x221)],'username':_0x3b3692[_0x55bd72(0x241)],'telegramId':_0x3b3692[_0x55bd72(0x1d8)],'merchantUrl':_0x3b3692['shopUrl'],'gateways':_0x3b3692['paymentGateways']?JSON[_0x55bd72(0x1d1)](_0x3b3692[_0x55bd72(0x20f)]):null,'gatewaySettings':_0x3b3692[_0x55bd72(0x1a7)]?JSON[_0x55bd72(0x1d1)](_0x3b3692[_0x55bd72(0x1a7)]):null,'publicKey':_0x3b3692[_0x55bd72(0x273)],'wallets':{'usdtPolygonWallet':_0x3b3692['usdtPolygonWallet'],'usdtTrcWallet':_0x3b3692['usdtTrcWallet'],'usdtErcWallet':_0x3b3692['usdtErcWallet'],'usdcPolygonWallet':_0x3b3692[_0x55bd72(0x21c)]},'status':_0x3b3692['status'],'createdAt':_0x3b3692[_0x55bd72(0x180)]};}async[a35_0xc66d11(0x17f)](_0x55b086){const _0xd71211=a35_0xc66d11,{fullName:_0xfb9f96,username:_0x26e95e,password:_0xb9b5e6,telegramId:_0x39c204,merchantUrl:_0x285e64,gateways:_0xe134cc,gatewaySettings:_0x2613a7,wallets:_0x310f2f}=_0x55b086,_0x3d8667=await database_1[_0xd71211(0x231)][_0xd71211(0x19a)][_0xd71211(0x1d4)]({'where':{'username':_0x26e95e}});if(_0x3d8667)throw new Error(_0xd71211(0x1c7));if(_0x39c204){const _0x5acb1a=await database_1[_0xd71211(0x231)][_0xd71211(0x19a)][_0xd71211(0x1d4)]({'where':{'telegram':_0x39c204}});if(_0x5acb1a)throw new Error('Telegram\x20username\x20already\x20exists');}const _0x176cb7=await bcryptjs_1['default'][_0xd71211(0x1d9)](_0xb9b5e6,0xc),_0x38d0c4=_0xd71211(0x1c0)+crypto_1[_0xd71211(0x231)][_0xd71211(0x1d2)](0x20)[_0xd71211(0x24e)](_0xd71211(0x166)),_0x153965='sk_'+crypto_1[_0xd71211(0x231)][_0xd71211(0x1d2)](0x20)[_0xd71211(0x24e)](_0xd71211(0x166)),_0x2f095b=await database_1[_0xd71211(0x231)][_0xd71211(0x19a)][_0xd71211(0x1c6)]({'data':{'name':_0xfb9f96,'username':_0x26e95e,'password':_0x176cb7,'telegram':_0x39c204,'shopUrl':_0x285e64,'paymentGateways':_0xe134cc?JSON[_0xd71211(0x25a)](_0xe134cc):null,'gatewaySettings':_0x2613a7?JSON[_0xd71211(0x25a)](_0x2613a7):null,'usdtPolygonWallet':_0x310f2f?.[_0xd71211(0x16a)]||null,'usdtTrcWallet':_0x310f2f?.[_0xd71211(0x1c9)]||null,'usdtErcWallet':_0x310f2f?.[_0xd71211(0x252)]||null,'usdcPolygonWallet':_0x310f2f?.[_0xd71211(0x21c)]||null,'publicKey':_0x38d0c4,'secretKey':_0x153965,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2f095b['id'],'fullName':_0x2f095b[_0xd71211(0x221)],'username':_0x2f095b[_0xd71211(0x241)],'telegramId':_0x2f095b[_0xd71211(0x1d8)],'merchantUrl':_0x2f095b[_0xd71211(0x1aa)],'gateways':_0x2f095b['paymentGateways']?JSON[_0xd71211(0x1d1)](_0x2f095b[_0xd71211(0x20f)]):null,'gatewaySettings':_0x2f095b[_0xd71211(0x1a7)]?JSON[_0xd71211(0x1d1)](_0x2f095b[_0xd71211(0x1a7)]):null,'publicKey':_0x2f095b['publicKey'],'wallets':{'usdtPolygonWallet':_0x2f095b[_0xd71211(0x16a)],'usdtTrcWallet':_0x2f095b[_0xd71211(0x1c9)],'usdtErcWallet':_0x2f095b[_0xd71211(0x252)],'usdcPolygonWallet':_0x2f095b[_0xd71211(0x21c)]},'status':_0x2f095b['status'],'createdAt':_0x2f095b[_0xd71211(0x180)]};}async[a35_0xc66d11(0x229)](_0x5316f7){const _0x2e6572=a35_0xc66d11;await database_1[_0x2e6572(0x231)][_0x2e6572(0x19a)][_0x2e6572(0x227)]({'where':{'id':_0x5316f7}});}['generateDailyStatistics'](_0x1dd679,_0x30367e,_0x3d289d){const _0x2506f0=a35_0xc66d11,_0x511e62=new Map(),_0xb52a65=new Date(_0x30367e);while(_0xb52a65<=_0x3d289d){const _0x230a00=_0xb52a65[_0x2506f0(0x223)]()[_0x2506f0(0x27c)]('T')[0x0];_0x511e62[_0x2506f0(0x237)](_0x230a00,{'revenue':0x0,'count':0x0}),_0xb52a65[_0x2506f0(0x21a)](_0xb52a65[_0x2506f0(0x261)]()+0x1);}for(const _0x3e53a6 of _0x1dd679){const _0x3ec92b=_0x3e53a6[_0x2506f0(0x180)]['toISOString']()[_0x2506f0(0x27c)]('T')[0x0],_0x1f88eb=_0x511e62[_0x2506f0(0x250)](_0x3ec92b);_0x1f88eb&&(_0x1f88eb[_0x2506f0(0x20e)]+=0x1,_0x3e53a6[_0x2506f0(0x162)]===_0x2506f0(0x226)&&(_0x3e53a6['amountUSDT']?_0x1f88eb[_0x2506f0(0x269)]+=_0x3e53a6[_0x2506f0(0x21e)]:console[_0x2506f0(0x26e)](_0x2506f0(0x23f)+_0x3e53a6['id']+'\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion')));}const _0x27cf6e=[],_0x36fc4c=[];for(const [_0x7d83fa,_0x258b41]of _0x511e62){_0x27cf6e[_0x2506f0(0x196)]({'date':_0x7d83fa,'amount':Math['round'](_0x258b41['revenue']*0x64)/0x64}),_0x36fc4c['push']({'date':_0x7d83fa,'count':_0x258b41['count']});}return{'dailyRevenue':_0x27cf6e,'dailyPayments':_0x36fc4c};}}function a35_0xce38(){const _0x9e01f4=['30d','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','\x20balance\x20updated:\x20','defineProperty','\x20USDT\x20(without\x20commission)','totalPaidOut','averageCheckUSDT','totalPayments','entries','\x20USDT','📊\x20Available\x20gateways\x20in\x20database:','📊\x20Payout\x20statistics\x20calculated:','🔄\x20Converted\x20gateway\x20name\x20\x27','customerUa','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','pendingUrl','dailyRevenue','count','paymentGateways','chargebackAmount','toLowerCase','paidAt','\x20USDT\x20(theoretical\x20net)','\x20PAID\x20payments','\x20USDT\x20(after\x20','\x20merchants','\x20\x20\x20💰\x20Total\x20payments\x20turnover:\x20','📊\x20Final\x20WHERE\x20conditions:','⚠️\x20Requested\x20gateway\x20\x27','setDate','not\x20set','usdcPolygonWallet','merchantEarnings','amountUSDT','getMerchantStatistics','_count','name','reduce','toISOString','1271394QdHmJU','KLYME\x20EU','PAID','delete','\x20to\x20','deleteUser','gateway','getGatewayDisplayName','\x20payments)','💸\x20CHARGEBACK:\x20Merchant\x20amount\x20already\x20deducted\x20from\x20balance','\x20USDT\x20(+','_sum','balance','default','$transaction','\x27\x20not\x20found.\x20Available\x20gateways:\x20','update','paidOutUSDT','availableBalance','set','month','averageCommissionRate','generateDailyStatistics','totalAmountAfterCommissionUSDT','join','📅\x20Period:\x20',',\x20Commission:\x20','⚠️\x20Payment\x20','💳\x20Payout\x20wallet\x20for\x20','username','Plisio','\x20\x20\x20🖥️\x20User\x20Agent:\x20','getUserById','💰\x20[PAYOUT]\x20Gateway\x20','asc',',\x20successful:\x20','periodFrom','fullName','\x20\x20\x20Merchant\x20loses:\x20','✅\x20Payout\x20created:\x20','amount','activateUser','toString','getMerchantsSelection','get','883159exDjJz','usdtErcWallet','\x20\x20\x20Merchant\x20gets:\x20','SUSPENDED','getAllUsers','\x20\x20\x20📅\x20This\x20month:\x20','totalCommissionRate','currencyService','Noda','stringify','\x20\x20\x20Added\x20to\x20balance:\x20+','shopId','year','\x20no\x20longer\x20PAID:','length','thisMonth','getDate','crypto','localeCompare','whiteUrl','Insufficient\x20balance.\x20Available:\x20','periodTo','deletePayout','\x20USDT\x20(-','revenue','📊\x20Merchants\x20awaiting\x20payout:\x20','📊\x20Gateway\x20filter\x20applied:','\x20USDT\x20(after\x20payouts)','gatewayOrderId','log','🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','externalPaymentUrl',':\x20commission\x20=\x20','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','publicKey','error','NONEXISTENT_GATEWAY_FILTER','\x20USDT\x20(same\x20as\x20awaiting)','totalPayout','\x20\x20\x20🔍\x20Raw\x20balance\x20sum:\x20','\x20for\x20shop\x20','\x20\x20\x20✅\x20Total\x20available\x20for\x20payout:\x20','merchantEarningsUSDT','split','\x20\x20\x20💵\x20Available\x20balance:\x20','💸\x20CHARGEBACK\x20penalty:\x20-','gatewayEarnings','findMany','admin','status','updateUser','\x20->\x20','4909792dGYJkU','hex','./currencyService','getMerchantsAwaitingPayout','Payment\x20not\x20found','usdtPolygonWallet','password','💰\x20Payment\x20','customerCountry','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','getGatewayNameById','💰\x20Found\x20','gte','statusChangedAt','telegramId','findFirst','📊\x20Calculating\x20payout\x20statistics...','Test\x20Gateway','\x20\x20\x20Full\x20amount:\x20','6782640dWApCA','payment','all','\x20\x20\x20✅\x20Actual\x20available\x20balance:\x20','💰\x20Creating\x20payout\x20for\x20shop\x20','getTime','Error\x20processing\x20payment\x20','createUser','createdAt','commission','7wWJhKE','📊\x20Total\x20payments\x20(including\x20failed):\x20','2020-01-01','2460474bAonmk','\x20USDT\x20(actual\x20balances)','\x20\x20\x20📊\x20Commission\x20difference:\x20','customerEmail','commissionUSDT','\x20USDT\x20(','notes','getFullYear','\x20\x20\x20💸\x20Total\x20payouts\x20(all\x20time):\x20','wallets','custom','lte','includes','\x20USDT\x20(total\x20paid\x20to\x20merchants)','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','getAllPayments','CHARGEBACK','push','\x20USDT\x20from\x20balance','\x20\x20\x20🔍\x20Calculated\x20after\x20commission:\x20','statusChangedBy','shop','getMonth','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','90d','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','some','round','20dEIThB','insensitive','groupBy','txid','__importDefault','gatewaySettings','\x20\x20\x20💳\x20Total\x20payments:\x20','turnover','shopUrl','getAllPayouts','\x20\x20\x20Gateway:\x20','forEach','aggregate','\x20in\x20','ceil','💰\x20Shop\x20','\x27\x20to\x20name\x20\x27','\x20\x20\x20🌍\x20Country:\x20','\x20active\x20merchants\x20for\x20selection','\x20\x20\x20📅\x20Total\x20payouts\x20(this\x20month):\x20','15112ewhzwr','desc','test_gateway','📋\x20Found\x20','🔄\x20Converted\x20gateway\x20ID\x20\x27','getPayoutStats','getSystemStatistics','\x20became\x20PAID:','totalAmountUSDT','../types/gateway','pk_','currency','failureMessage','polygon','convertToUSDT','toUpperCase','create','Username\x20already\x20exists','trc20','usdtTrcWallet','AdminService','turnoverUSDT','updateCustomerData','💰\x20[PAYOUT]\x20Merchant\x20','network','period','\x20USDT\x20(gross\x20revenue)','parse','randomBytes','dailyPayments','findUnique','getPayoutById','not\x20specified','ACTIVE','telegram','hash','\x20USDT)','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','💱\x20Currency\x20filter\x20applied:\x20','customerIp','🔄\x20Admin\x20updating\x20payment\x20','amountAfterCommissionUSDT','COMPLETED','bcryptjs','date','payout','%\x20commission)','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','merchantUrl','\x20\x20\x20💰\x20Total\x20turnover:\x20','values','\x27\x20->\x20ID\x20\x27','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','updatedAt','\x20\x20\x20🌐\x20IP:\x20','📊\x20Sorting\x20payments\x20by\x20','51HlylSd','adminNotes','toFixed','awaitingPayout','2860050phgRaq','\x20\x20\x20�\x20Total\x20payments\x20turnover:\x20','gateways','0000','map','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','📋\x20Getting\x20merchants\x20selection\x20list...','dateFrom','paymentsCount','\x20\x20\x20Balance:\x20','CoinToPay'];a35_0xce38=function(){return _0x9e01f4;};return a35_0xce38();}function a35_0x3314(_0x45c739,_0x169501){const _0xce38c5=a35_0xce38();return a35_0x3314=function(_0x331447,_0x26850d){_0x331447=_0x331447-0x15d;let _0x5d7def=_0xce38c5[_0x331447];return _0x5d7def;},a35_0x3314(_0x45c739,_0x169501);}exports['AdminService']=AdminService;