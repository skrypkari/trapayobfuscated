'use strict';const a35_0xf9bae0=a35_0x18bf;(function(_0x41892e,_0x350096){const _0x392927=a35_0x18bf,_0x14a0bd=_0x41892e();while(!![]){try{const _0x497576=parseInt(_0x392927(0xcb))/0x1*(parseInt(_0x392927(0x181))/0x2)+-parseInt(_0x392927(0x1a6))/0x3*(-parseInt(_0x392927(0xff))/0x4)+parseInt(_0x392927(0x167))/0x5+-parseInt(_0x392927(0x1d4))/0x6*(parseInt(_0x392927(0x1bc))/0x7)+-parseInt(_0x392927(0x171))/0x8+parseInt(_0x392927(0x177))/0x9*(-parseInt(_0x392927(0x158))/0xa)+parseInt(_0x392927(0x192))/0xb;if(_0x497576===_0x350096)break;else _0x14a0bd['push'](_0x14a0bd['shift']());}catch(_0x46b3f1){_0x14a0bd['push'](_0x14a0bd['shift']());}}}(a35_0x600f,0x69cbc));function a35_0x600f(){const _0x2f5345=['createUser','findMany','\x20\x20\x20Total\x20paid\x20out:\x20','\x20USDT\x20(same\x20as\x20awaiting)','9632rmObmo','\x20\x20\x20Failed\x20to\x20parse\x20gatewaySettings:\x20','📊\x20[DAILY]\x20Total\x20revenue\x20processed:\x20','averageCommissionRate','usdtPolygonWallet','month','periodTo','\x20no\x20longer\x20PAID:\x20-','totalPaidOut','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','Username\x20already\x20exists','currency','periodFrom','custom','Error\x20processing\x20payment\x20','publicKey','\x20for\x20payment\x20on\x20','gatewaySettings','remitterIban','txid','Shop\x20not\x20found','statusChangedBy','week','includes','Noda','__esModule','getUserById','name','updatePaymentStatus','updatedAt','pendingUrl','gte','error','log','🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','forEach','Telegram\x20username\x20already\x20exists','\x20\x20\x20Name:\x20','\x20\x20\x20Gateway\x20key\x20found:\x20','chargebackAmount','\x20paid\x20payments\x20for\x20analysis','externalPaymentUrl','createPayout','Payment\x20not\x20found','\x20became\x20PAID:\x20+','\x20\x20\x20Final\x20commission\x20used:\x20','30d','\x20\x20\x20🌍\x20Country:\x20','\x20USDT)','_sum','paidAt','💰\x20Shop\x20','71236BcGHiQ','gatewayEarnings','createdAt','getSystemStatistics','AdminService','activateUser','null','dailyRevenue','getFullYear','telegram','usdtTrcWallet','commissionUSDT','\x20\x20\x20Payout\x20amount:\x20','customerIp','\x20\x20\x20Parsed\x20gatewaySettings:','aggregate','turnover','getGatewayDisplayName','adminNotes','totalTurnover','getPayoutStats','year','suspendUser','keys','📊\x20[ADMIN]\x20Status\x20breakdown:','failUrl','merchantUrl','getAllUsers','📊\x20Total\x20payments\x20(all\x20statuses):\x20','reduce','commission','\x20\x20\x20📊\x20Total\x20payments:\x20','SUSPENDED','hex','\x20USDT\x20(total\x20merchant\x20balances)','KLYME\x20GB','notes','availableBalance','90d','setDate','awaitingPayout','payout','\x20->\x20','\x20USDT\x20to\x20balance','customerUa','toLowerCase','PAID','ceil','getMerchantsAwaitingPayout','thisMonth','\x20USDT','\x20\x20\x20🖥️\x20User\x20Agent:\x20','updateCustomerData','📅\x20Period:\x20','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','revenue','💰\x20Found\x20','📊\x20Merchant\x20statistics\x20calculated:','averageCheckUSDT','\x20for\x20shop\x20','hash','📊\x20Calculating\x20payout\x20statistics...','toFixed','\x20to\x20','not\x20found','asc','\x20merchants,\x20','round','📊\x20[ADMIN]\x20Processing\x20','\x20\x20\x20Current\x20balance:\x20','\x20\x20\x20💰\x20Total\x20turnover:\x20','shopUrl','\x20\x20\x20📅\x20This\x20month:\x20','successUrl','\x20\x20\x20Commission\x20from\x20shop\x20settings:\x20','💰\x20Creating\x20payout\x20for\x20shop\x20','toUpperCase','not\x20set','paymentGateways','\x20commission\x20analysis:','payment','merchantEarningsUSDT','gateway','default','push','turnoverUSDT','balance','status','find','137170ZtZKjE','\x20(direct\x20amountUSDT)','usdcPolygonWallet','\x20balance\x20updated:','\x20total','shopId','period','\x20\x20\x20Raw\x20gatewaySettings:\x20','📊\x20Payout\x20statistics\x20calculated:','desc','\x20\x20\x20Username:\x20','__importDefault','\x20\x20\x20Commission\x20from\x20settings:\x20','\x20USDT\x20total','telegramId','93855hmZUIL','CHARGEBACK','COMPLETED','getDate','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','convertToUSDT','all','sk_','remitterName','deletePayout','6016360WGVqrt','network','\x20payments\x20for\x20daily\x20statistics','totalCommissionRate','dateTo','shop','531xJVlEp','\x20\x20\x20Shop:\x20','\x20USDT\x20(','split','groupBy','💰\x20[DAILY]\x20Added\x20','customerEmail','localeCompare','REFUND','$transaction','102SSCqWT','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','delete','\x20USDT\x20(+','\x20\x20\x20🌐\x20IP:\x20','sort','2020-01-01','dateFrom','string','💰\x20Current\x20shop\x20balance:\x20','txUrls','customerCountry','getTime','totalPayments','gateways','\x20\x20\x20💵\x20Available\x20balance:\x20','amountUSDT','16822223MzfsnI','\x20\x20\x20Successful\x20payments:\x20','update','date','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','./currencyService','getAllPayments','successfulPayments','amount','toString','stringify','\x20\x20\x20📈\x20Conversion\x20rate:\x20','pk_','merchantEarnings','\x20\x20\x20Gateway:\x20','test_gateway','bankId','getPayoutById','username','whiteUrl','114cSrVrF','parse','insensitive','paymentMethod','Test\x20Gateway','admin','ACTIVE','📊\x20Payment\x20','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','paidOutUSDT','create','values','💱\x20[DAILY]\x20Converted\x20','count','\x20\x20\x20Total\x20payments:\x20','cardLast4','paymentsCount','📊\x20Shop\x20info\x20for\x20','lte','length','getMonth','fullName','3150wclUVl','wallets','\x20USDT,\x20Requested:\x20','map','password','\x20balance\x20updated:\x20','_count','set','statusChangedAt','gatewayOrderId','orderId','usdtErcWallet','toISOString','findUnique','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','INACTIVE','💰\x20Payment\x20','defineProperty','randomBytes','updateUser','failureMessage','currencyService','customerName','KLYME\x20EU','9618ueBcmK','conversionRate','💸\x20CHARGEBACK\x20penalty:\x20-','KLYME\x20DE','\x20USDT\x20from\x20balance','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20'];a35_0x600f=function(){return _0x2f5345;};return a35_0x600f();}function a35_0x18bf(_0x29c1ad,_0x3d4558){const _0x600f92=a35_0x600f();return a35_0x18bf=function(_0x18bfbe,_0xd64a27){_0x18bfbe=_0x18bfbe-0xc9;let _0x2b8c5c=_0x600f92[_0x18bfbe];return _0x2b8c5c;},a35_0x18bf(_0x29c1ad,_0x3d4558);}var __importDefault=this&&this[a35_0xf9bae0(0x163)]||function(_0x5838a9){const _0x270439=a35_0xf9bae0;return _0x5838a9&&_0x5838a9[_0x270439(0xe4)]?_0x5838a9:{'default':_0x5838a9};};Object[a35_0xf9bae0(0x1cd)](exports,a35_0xf9bae0(0xe4),{'value':!![]}),exports[a35_0xf9bae0(0x103)]=void 0x0;const database_1=__importDefault(require('../config/database')),bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require('crypto')),currencyService_1=require(a35_0xf9bae0(0x197));class AdminService{async[a35_0xf9bae0(0x113)](){const _0x41e2ab=a35_0xf9bae0;console[_0x41e2ab(0xec)](_0x41e2ab(0x13c));const _0x37eea8=await database_1['default'][_0x41e2ab(0x176)][_0x41e2ab(0x10e)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x41e2ab(0x1ac)}}),_0x3d3c4f=new Date(),_0x361c4e=new Date(_0x3d3c4f[_0x41e2ab(0x107)](),_0x3d3c4f[_0x41e2ab(0x1ba)](),0x1),_0x5bf899=new Date(_0x3d3c4f[_0x41e2ab(0x107)](),_0x3d3c4f[_0x41e2ab(0x1ba)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x1d0e73=await database_1[_0x41e2ab(0x152)][_0x41e2ab(0x128)][_0x41e2ab(0x10e)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x361c4e,'lte':_0x5bf899},'status':'COMPLETED'}}),_0x502c52=_0x37eea8[_0x41e2ab(0xfc)][_0x41e2ab(0xd3)]||0x0,_0x419923=_0x37eea8[_0x41e2ab(0xfc)][_0x41e2ab(0x155)]||0x0,_0x52fa45=_0x1d0e73['_sum']['amount']||0x0,_0x41b354={'totalPayout':Math[_0x41e2ab(0x142)](_0x502c52*0x64)/0x64,'awaitingPayout':Math[_0x41e2ab(0x142)](_0x419923*0x64)/0x64,'thisMonth':Math[_0x41e2ab(0x142)](_0x52fa45*0x64)/0x64,'availableBalance':Math['round'](_0x419923*0x64)/0x64};return console[_0x41e2ab(0xec)](_0x41e2ab(0x160)),console[_0x41e2ab(0xec)]('\x20\x20\x20💰\x20Total\x20payout:\x20'+_0x41b354['totalPayout']+'\x20USDT\x20(total\x20paid\x20to\x20merchants)'),console['log'](_0x41e2ab(0x182)+_0x41b354[_0x41e2ab(0x127)]+_0x41e2ab(0x121)),console[_0x41e2ab(0xec)](_0x41e2ab(0x190)+_0x41b354[_0x41e2ab(0x124)]+_0x41e2ab(0xca)),console[_0x41e2ab(0xec)](_0x41e2ab(0x147)+_0x41b354[_0x41e2ab(0x130)]+_0x41e2ab(0x131)),_0x41b354;}async[a35_0xf9bae0(0x133)](_0x26f482,_0x206d55){const _0x251b65=a35_0xf9bae0;console[_0x251b65(0xec)](_0x251b65(0xd4)+_0x26f482+':',_0x206d55);const _0x39bc85=await database_1[_0x251b65(0x152)][_0x251b65(0x14f)]['findUnique']({'where':{'id':_0x26f482},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x39bc85)throw new Error(_0x251b65(0xf6));const _0x15ef98={};_0x206d55['customerCountry']!==undefined&&(_0x15ef98[_0x251b65(0x18c)]=_0x206d55[_0x251b65(0x18c)]||null);_0x206d55[_0x251b65(0x10c)]!==undefined&&(_0x15ef98[_0x251b65(0x10c)]=_0x206d55[_0x251b65(0x10c)]||null);_0x206d55[_0x251b65(0x12b)]!==undefined&&(_0x15ef98[_0x251b65(0x12b)]=_0x206d55['customerUa']||null);const _0x38c871=await database_1['default'][_0x251b65(0x14f)][_0x251b65(0x194)]({'where':{'id':_0x26f482},'data':{..._0x15ef98,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x251b65(0xec)](_0x251b65(0x1d9)+_0x26f482),console['log'](_0x251b65(0xfa)+_0x39bc85[_0x251b65(0x18c)]+_0x251b65(0x129)+_0x38c871[_0x251b65(0x18c)]),console[_0x251b65(0xec)](_0x251b65(0x185)+_0x39bc85[_0x251b65(0x10c)]+_0x251b65(0x129)+_0x38c871[_0x251b65(0x10c)]),console[_0x251b65(0xec)](_0x251b65(0x132)+(_0x39bc85[_0x251b65(0x12b)]?'set':'not\x20set')+_0x251b65(0x129)+(_0x38c871[_0x251b65(0x12b)]?_0x251b65(0x1c3):_0x251b65(0x14c))),_0x38c871;}async[a35_0xf9bae0(0x102)](_0x3dad6f){const _0x2f2c79=a35_0xf9bae0,_0xda82f=new Date();let _0x42b694;switch(_0x3dad6f){case'7d':_0x42b694=new Date(_0xda82f[_0x2f2c79(0x18d)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x2f2c79(0xf9):_0x42b694=new Date(_0xda82f[_0x2f2c79(0x18d)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x2f2c79(0x125):_0x42b694=new Date(_0xda82f[_0x2f2c79(0x18d)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x42b694=new Date(_0xda82f['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x570f6a,_0x589e39,_0x76f513,_0x54a9c2,_0x1c8765,_0x2da7f3,_0x382e85]=await Promise[_0x2f2c79(0x16d)]([database_1['default'][_0x2f2c79(0x176)][_0x2f2c79(0x1b3)](),database_1[_0x2f2c79(0x152)][_0x2f2c79(0x176)][_0x2f2c79(0x1b3)]({'where':{'status':'ACTIVE'}}),database_1[_0x2f2c79(0x152)][_0x2f2c79(0x14f)][_0x2f2c79(0x1b3)]({'where':{'createdAt':{'gte':_0x42b694},'gateway':{'not':_0x2f2c79(0x1a1)}}}),database_1[_0x2f2c79(0x152)][_0x2f2c79(0x14f)][_0x2f2c79(0x1b3)]({'where':{'status':_0x2f2c79(0x12d),'createdAt':{'gte':_0x42b694},'gateway':{'not':_0x2f2c79(0x1a1)}}}),database_1[_0x2f2c79(0x152)][_0x2f2c79(0x14f)]['findMany']({'where':{'status':'PAID','createdAt':{'gte':_0x42b694},'gateway':{'not':_0x2f2c79(0x1a1)}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x2f2c79(0x152)][_0x2f2c79(0x14f)][_0x2f2c79(0x1db)]({'where':{'gateway':{'not':_0x2f2c79(0x1a1)}},'take':0xa,'orderBy':{'createdAt':_0x2f2c79(0x161)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x2f2c79(0x152)][_0x2f2c79(0x14f)][_0x2f2c79(0x1db)]({'where':{'createdAt':{'gte':_0x42b694},'gateway':{'not':_0x2f2c79(0x1a1)}},'select':{'status':!![],'amountUSDT':!![],'amount':!![],'currency':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x2f2c79(0x140)}})]);let _0x23e5e0=0x0;for(const _0x56d82b of _0x1c8765){if(_0x56d82b[_0x2f2c79(0x191)])_0x23e5e0+=_0x56d82b[_0x2f2c79(0x191)];else{const _0x1b64c4=await currencyService_1['currencyService'][_0x2f2c79(0x16c)](_0x56d82b['amount'],_0x56d82b['currency']);_0x23e5e0+=_0x1b64c4;}}console['log'](_0x2f2c79(0x143)+_0x382e85[_0x2f2c79(0x1b9)]+_0x2f2c79(0x173)),console[_0x2f2c79(0xec)]('📊\x20[ADMIN]\x20Period:\x20'+_0x42b694[_0x2f2c79(0x1c8)]()[_0x2f2c79(0x17a)]('T')[0x0]+_0x2f2c79(0x13e)+_0xda82f['toISOString']()[_0x2f2c79(0x17a)]('T')[0x0]);const _0x388dd6=_0x382e85[_0x2f2c79(0x11c)]((_0x20c103,_0x1506c6)=>{const _0x27076a=_0x2f2c79;return _0x20c103[_0x1506c6[_0x27076a(0x156)]]=(_0x20c103[_0x1506c6['status']]||0x0)+0x1,_0x20c103;},{});console[_0x2f2c79(0xec)](_0x2f2c79(0x117),_0x388dd6);const _0x981c7e=await this['generateDailyStatistics'](_0x382e85,_0x42b694,_0xda82f),_0x2a0816=_0x76f513>0x0?_0x54a9c2/_0x76f513*0x64:0x0;return{'totalShops':_0x570f6a,'activeShops':_0x589e39,'totalPayments':_0x76f513,'successfulPayments':_0x54a9c2,'totalRevenue':Math[_0x2f2c79(0x142)](_0x23e5e0*0x64)/0x64,'conversionRate':Math[_0x2f2c79(0x142)](_0x2a0816*0x64)/0x64,'dailyRevenue':_0x981c7e[_0x2f2c79(0x106)],'dailyPayments':_0x981c7e['dailyPayments'],'recentPayments':_0x2da7f3['map'](_0x2b8f45=>({'id':_0x2b8f45['id'],'amount':_0x2b8f45[_0x2f2c79(0x19a)],'currency':_0x2b8f45[_0x2f2c79(0xd6)],'status':_0x2b8f45[_0x2f2c79(0x156)],'gateway':_0x2b8f45['gateway'],'shop':_0x2b8f45['shop'],'createdAt':_0x2b8f45[_0x2f2c79(0x101)]}))};}async['generateDailyStatistics'](_0x22580e,_0x4dc340,_0x42c634){const _0x3bc25e=a35_0xf9bae0,_0x8e8a6a=new Map(),_0x55775c=new Date(_0x4dc340);while(_0x55775c<=_0x42c634){const _0x43b903=_0x55775c[_0x3bc25e(0x1c8)]()['split']('T')[0x0];_0x8e8a6a[_0x3bc25e(0x1c3)](_0x43b903,{'revenue':0x0,'count':0x0}),_0x55775c[_0x3bc25e(0x126)](_0x55775c[_0x3bc25e(0x16a)]()+0x1);}let _0x1831dd=0x0,_0x517e15=0x0;for(const _0xc562ac of _0x22580e){const _0x3c43d1=_0xc562ac['createdAt'][_0x3bc25e(0x1c8)]()[_0x3bc25e(0x17a)]('T')[0x0],_0x4f3001=_0x8e8a6a['get'](_0x3c43d1);if(_0x4f3001){_0x4f3001[_0x3bc25e(0x1b3)]+=0x1;if(_0xc562ac['status']===_0x3bc25e(0x12d)){_0x1831dd++;if(_0xc562ac[_0x3bc25e(0x191)])_0x4f3001[_0x3bc25e(0x136)]+=_0xc562ac[_0x3bc25e(0x191)],_0x517e15+=_0xc562ac['amountUSDT'],console['log'](_0x3bc25e(0x17c)+_0xc562ac[_0x3bc25e(0x191)]+'\x20USDT\x20for\x20'+_0x3c43d1+_0x3bc25e(0x159));else try{const _0x5b0f21=await currencyService_1[_0x3bc25e(0x1d1)]['convertToUSDT'](_0xc562ac[_0x3bc25e(0x19a)],_0xc562ac[_0x3bc25e(0xd6)]);_0x4f3001[_0x3bc25e(0x136)]+=_0x5b0f21,_0x517e15+=_0x5b0f21,console[_0x3bc25e(0xec)](_0x3bc25e(0x1b2)+_0xc562ac[_0x3bc25e(0x19a)]+'\x20'+_0xc562ac[_0x3bc25e(0xd6)]+_0x3bc25e(0x13e)+_0x5b0f21+'\x20USDT\x20for\x20payment\x20on\x20'+_0x3c43d1);}catch(_0x56cbd5){console['warn']('⚠️\x20[DAILY]\x20Failed\x20to\x20convert\x20'+_0xc562ac['amount']+'\x20'+_0xc562ac[_0x3bc25e(0xd6)]+_0x3bc25e(0xdb)+_0x3c43d1+':',_0x56cbd5);}}}}console[_0x3bc25e(0xec)]('📊\x20[DAILY]\x20Processed\x20'+_0x1831dd+'\x20PAID\x20payments\x20out\x20of\x20'+_0x22580e[_0x3bc25e(0x1b9)]+_0x3bc25e(0x15c)),console['log'](_0x3bc25e(0xcd)+_0x517e15+'\x20USDT');const _0x2d7581=[],_0x2429ac=[];for(const [_0x1ab288,_0x445f5e]of _0x8e8a6a){_0x2d7581['push']({'date':_0x1ab288,'amount':Math[_0x3bc25e(0x142)](_0x445f5e[_0x3bc25e(0x136)]*0x64)/0x64}),_0x2429ac[_0x3bc25e(0x153)]({'date':_0x1ab288,'count':_0x445f5e[_0x3bc25e(0x1b3)]});}return{'dailyRevenue':_0x2d7581,'dailyPayments':_0x2429ac};}async['getMerchantStatistics'](_0x14a345){const _0x5bfc27=a35_0xf9bae0;console[_0x5bfc27(0xec)](_0x5bfc27(0x135),_0x14a345);let _0x329a8e,_0x378c45=new Date();if(_0x14a345[_0x5bfc27(0x15e)]===_0x5bfc27(0xd8)&&_0x14a345[_0x5bfc27(0x188)]&&_0x14a345[_0x5bfc27(0x175)])_0x329a8e=new Date(_0x14a345[_0x5bfc27(0x188)]),_0x378c45=new Date(_0x14a345[_0x5bfc27(0x175)]);else{const _0x5011ff=new Date();switch(_0x14a345[_0x5bfc27(0x15e)]){case _0x5bfc27(0xe1):_0x329a8e=new Date(_0x5011ff[_0x5bfc27(0x18d)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x5bfc27(0xd0):_0x329a8e=new Date(_0x5011ff['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x5bfc27(0x114):_0x329a8e=new Date(_0x5011ff[_0x5bfc27(0x18d)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x5bfc27(0x16d):default:_0x329a8e=new Date(_0x5bfc27(0x187));break;}}console[_0x5bfc27(0xec)](_0x5bfc27(0x134)+_0x329a8e[_0x5bfc27(0x1c8)]()+_0x5bfc27(0x13e)+_0x378c45[_0x5bfc27(0x1c8)]());if(_0x14a345[_0x5bfc27(0x15d)]){const _0x3d855f=await database_1[_0x5bfc27(0x152)][_0x5bfc27(0x176)][_0x5bfc27(0x1c9)]({'where':{'id':_0x14a345[_0x5bfc27(0x15d)]},'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}});console['log'](_0x5bfc27(0x1b7)+_0x14a345[_0x5bfc27(0x15d)]+':'),console[_0x5bfc27(0xec)](_0x5bfc27(0xf0)+_0x3d855f?.[_0x5bfc27(0xe6)]),console[_0x5bfc27(0xec)](_0x5bfc27(0x162)+_0x3d855f?.[_0x5bfc27(0x1a4)]),console[_0x5bfc27(0xec)](_0x5bfc27(0x15f)+(_0x3d855f?.['gatewaySettings']||_0x5bfc27(0x105)));if(_0x3d855f?.[_0x5bfc27(0xdc)])try{const _0x574599=JSON[_0x5bfc27(0x1a7)](_0x3d855f[_0x5bfc27(0xdc)]);console[_0x5bfc27(0xec)](_0x5bfc27(0x10d),_0x574599),console['log'](_0x5bfc27(0x149)+(_0x574599[_0x5bfc27(0x11d)]||_0x5bfc27(0x13f)));}catch(_0x1ca3e3){console[_0x5bfc27(0xec)](_0x5bfc27(0xcc)+_0x1ca3e3);}}const _0x5427e3={'status':_0x5bfc27(0x12d),'gateway':{'not':_0x5bfc27(0x1a1)},'paidAt':{'gte':_0x329a8e,'lte':_0x378c45}};_0x14a345[_0x5bfc27(0x15d)]&&(_0x5427e3['shopId']=_0x14a345[_0x5bfc27(0x15d)]);const _0x4ec088=await database_1[_0x5bfc27(0x152)][_0x5bfc27(0x14f)][_0x5bfc27(0x1db)]({'where':_0x5427e3,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x5bfc27(0xec)](_0x5bfc27(0x137)+_0x4ec088[_0x5bfc27(0x1b9)]+_0x5bfc27(0xf3));const _0x2eb7a9={'gateway':{'not':'test_gateway'},'createdAt':{'gte':_0x329a8e,'lte':_0x378c45}};_0x14a345[_0x5bfc27(0x15d)]&&(_0x2eb7a9[_0x5bfc27(0x15d)]=_0x14a345[_0x5bfc27(0x15d)]);const _0x3b66fe=await database_1[_0x5bfc27(0x152)][_0x5bfc27(0x14f)][_0x5bfc27(0x1b3)]({'where':_0x2eb7a9});console['log'](_0x5bfc27(0x11b)+_0x3b66fe),console[_0x5bfc27(0xec)]('✅\x20Successful\x20payments:\x20'+_0x4ec088[_0x5bfc27(0x1b9)]);let _0x1a8030=0x0,_0x2743ab=0x0,_0x9169d3=0x0;const _0x5e66eb={},_0xd5a033={},_0x2c2759={};for(const _0x1eb0fa of _0x4ec088){try{const _0x141da7=await currencyService_1[_0x5bfc27(0x1d1)][_0x5bfc27(0x16c)](_0x1eb0fa['amount'],_0x1eb0fa[_0x5bfc27(0xd6)]);let _0x30dc67={};if(_0x1eb0fa[_0x5bfc27(0x176)][_0x5bfc27(0xdc)])try{_0x30dc67=JSON[_0x5bfc27(0x1a7)](_0x1eb0fa[_0x5bfc27(0x176)][_0x5bfc27(0xdc)]);}catch(_0x5e26ff){console[_0x5bfc27(0xeb)](_0x5bfc27(0x1ae)+_0x1eb0fa['shopId']+':',_0x5e26ff);}let _0x3b2742=0xa;const _0x43d49e=Object[_0x5bfc27(0x116)](_0x30dc67)[_0x5bfc27(0x157)](_0x13b3e1=>_0x13b3e1[_0x5bfc27(0x12c)]()===_0x1eb0fa[_0x5bfc27(0x151)]['toLowerCase']());_0x43d49e&&_0x30dc67[_0x43d49e]&&_0x30dc67[_0x43d49e]['commission']&&(_0x3b2742=_0x30dc67[_0x43d49e]['commission']);console[_0x5bfc27(0xec)](_0x5bfc27(0x1ad)+_0x1eb0fa['id']+_0x5bfc27(0x14e)),console['log'](_0x5bfc27(0x178)+_0x1eb0fa[_0x5bfc27(0x176)]['name']+'\x20('+_0x1eb0fa[_0x5bfc27(0x15d)]+')'),console[_0x5bfc27(0xec)](_0x5bfc27(0x1a0)+_0x1eb0fa[_0x5bfc27(0x151)]),console[_0x5bfc27(0xec)](_0x5bfc27(0x15f)+(_0x1eb0fa[_0x5bfc27(0x176)]['gatewaySettings']||_0x5bfc27(0x105))),console['log'](_0x5bfc27(0x10d),_0x30dc67),console[_0x5bfc27(0xec)](_0x5bfc27(0xf1)+(_0x43d49e||_0x5bfc27(0x13f))),console[_0x5bfc27(0xec)](_0x5bfc27(0x164)+(_0x43d49e&&_0x30dc67[_0x43d49e]?_0x30dc67[_0x43d49e][_0x5bfc27(0x11d)]:'not\x20found')),console[_0x5bfc27(0xec)](_0x5bfc27(0xf8)+_0x3b2742+'%');const _0x37d65f=_0x141da7*(_0x3b2742/0x64),_0x33e88f=_0x141da7-_0x37d65f;_0x1a8030+=_0x141da7,_0x2743ab+=_0x33e88f,_0x9169d3+=_0x37d65f;!_0x5e66eb[_0x1eb0fa[_0x5bfc27(0x151)]]&&(_0x5e66eb[_0x1eb0fa[_0x5bfc27(0x151)]]={'gateway':_0x1eb0fa[_0x5bfc27(0x151)],'gatewayDisplayName':this[_0x5bfc27(0x110)](_0x1eb0fa[_0x5bfc27(0x151)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x5e66eb[_0x1eb0fa[_0x5bfc27(0x151)]]['paymentsCount']++,_0x5e66eb[_0x1eb0fa[_0x5bfc27(0x151)]][_0x5bfc27(0x154)]+=_0x141da7,_0x5e66eb[_0x1eb0fa[_0x5bfc27(0x151)]][_0x5bfc27(0x10a)]+=_0x37d65f,_0x5e66eb[_0x1eb0fa['gateway']][_0x5bfc27(0x150)]+=_0x33e88f,_0x5e66eb[_0x1eb0fa['gateway']][_0x5bfc27(0x174)]+=_0x3b2742;!_0x14a345['shopId']&&(!_0xd5a033[_0x1eb0fa['shopId']]&&(_0xd5a033[_0x1eb0fa[_0x5bfc27(0x15d)]]={'shopId':_0x1eb0fa[_0x5bfc27(0x15d)],'shopName':_0x1eb0fa['shop']['name'],'shopUsername':_0x1eb0fa[_0x5bfc27(0x176)][_0x5bfc27(0x1a4)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0xd5a033[_0x1eb0fa[_0x5bfc27(0x15d)]][_0x5bfc27(0x1b6)]++,_0xd5a033[_0x1eb0fa[_0x5bfc27(0x15d)]][_0x5bfc27(0x154)]+=_0x141da7,_0xd5a033[_0x1eb0fa[_0x5bfc27(0x15d)]][_0x5bfc27(0x10a)]+=_0x37d65f,_0xd5a033[_0x1eb0fa[_0x5bfc27(0x15d)]]['merchantEarningsUSDT']+=_0x33e88f);const _0x847634=_0x1eb0fa['paidAt'][_0x5bfc27(0x1c8)]()[_0x5bfc27(0x17a)]('T')[0x0];!_0x2c2759[_0x847634]&&(_0x2c2759[_0x847634]={'date':_0x847634,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x2c2759[_0x847634][_0x5bfc27(0x10f)]+=_0x141da7,_0x2c2759[_0x847634]['merchantEarnings']+=_0x33e88f,_0x2c2759[_0x847634][_0x5bfc27(0x100)]+=_0x37d65f,_0x2c2759[_0x847634][_0x5bfc27(0x1b6)]++;}catch(_0x11a016){console[_0x5bfc27(0xeb)](_0x5bfc27(0xd9)+_0x1eb0fa['id']+':',_0x11a016);}}Object[_0x5bfc27(0x1b1)](_0x5e66eb)[_0x5bfc27(0xee)](_0x2927d2=>{const _0x2fc958=_0x5bfc27;_0x2927d2['averageCommissionRate']=_0x2927d2[_0x2fc958(0x1b6)]>0x0?_0x2927d2[_0x2fc958(0x174)]/_0x2927d2['paymentsCount']:0x0,delete _0x2927d2[_0x2fc958(0x174)];}),Object[_0x5bfc27(0x1b1)](_0xd5a033)['forEach'](_0x554758=>{const _0x490d2c=_0x5bfc27;_0x554758[_0x490d2c(0x139)]=_0x554758[_0x490d2c(0x1b6)]>0x0?_0x554758[_0x490d2c(0x154)]/_0x554758['paymentsCount']:0x0;});let _0x278261=0x0;if(_0x14a345[_0x5bfc27(0x15d)]){const _0x50e9e0=await database_1['default'][_0x5bfc27(0x128)][_0x5bfc27(0x1db)]({'where':{'shopId':_0x14a345[_0x5bfc27(0x15d)],'status':_0x5bfc27(0x169),'createdAt':{'gte':_0x329a8e,'lte':_0x378c45}},'select':{'amount':!![]}});_0x278261=_0x50e9e0['reduce']((_0x8c2859,_0x26b70c)=>_0x8c2859+_0x26b70c[_0x5bfc27(0x19a)],0x0);}const _0x59e23d=_0x3b66fe,_0x212b04=_0x4ec088[_0x5bfc27(0x1b9)],_0x3c773c=_0x212b04>0x0?_0x1a8030/_0x212b04:0x0,_0x26e084=_0x59e23d>0x0?_0x212b04/_0x59e23d*0x64:0x0;console[_0x5bfc27(0xec)]('📊\x20Conversion\x20rate\x20calculation:'),console[_0x5bfc27(0xec)](_0x5bfc27(0x1b4)+_0x59e23d),console['log'](_0x5bfc27(0x193)+_0x212b04),console['log']('\x20\x20\x20Conversion\x20rate:\x20'+_0x26e084[_0x5bfc27(0x13d)](0x2)+'%');const _0x17b628=Math[_0x5bfc27(0x12e)]((_0x378c45[_0x5bfc27(0x18d)]()-_0x329a8e[_0x5bfc27(0x18d)]())/(0x3e8*0x3c*0x3c*0x18)),_0x130a8b={'totalTurnover':Math[_0x5bfc27(0x142)](_0x1a8030*0x64)/0x64,'merchantEarnings':Math['round'](_0x2743ab*0x64)/0x64,'gatewayEarnings':Math[_0x5bfc27(0x142)](_0x9169d3*0x64)/0x64,'totalPaidOut':Math['round'](_0x278261*0x64)/0x64,'averageCheck':Math[_0x5bfc27(0x142)](_0x3c773c*0x64)/0x64,'totalPayments':_0x59e23d,'successfulPayments':_0x212b04,'conversionRate':Math[_0x5bfc27(0x142)](_0x26e084*0x64)/0x64,'gatewayBreakdown':Object[_0x5bfc27(0x1b1)](_0x5e66eb)['map'](_0x1e9e16=>({..._0x1e9e16,'turnoverUSDT':Math['round'](_0x1e9e16['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math['round'](_0x1e9e16[_0x5bfc27(0x10a)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x1e9e16['merchantEarningsUSDT']*0x64)/0x64,'averageCommissionRate':Math[_0x5bfc27(0x142)](_0x1e9e16[_0x5bfc27(0xce)]*0x64)/0x64})),'merchantBreakdown':_0x14a345['shopId']?undefined:Object[_0x5bfc27(0x1b1)](_0xd5a033)[_0x5bfc27(0x1bf)](_0x1b1433=>({..._0x1b1433,'turnoverUSDT':Math[_0x5bfc27(0x142)](_0x1b1433[_0x5bfc27(0x154)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x1b1433[_0x5bfc27(0x10a)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x1b1433[_0x5bfc27(0x150)]*0x64)/0x64,'paidOutUSDT':Math[_0x5bfc27(0x142)](_0x1b1433[_0x5bfc27(0x1af)]*0x64)/0x64,'averageCheckUSDT':Math[_0x5bfc27(0x142)](_0x1b1433[_0x5bfc27(0x139)]*0x64)/0x64})),'dailyData':Object[_0x5bfc27(0x1b1)](_0x2c2759)['map'](_0x4c236f=>({..._0x4c236f,'turnover':Math[_0x5bfc27(0x142)](_0x4c236f[_0x5bfc27(0x10f)]*0x64)/0x64,'merchantEarnings':Math['round'](_0x4c236f[_0x5bfc27(0x19f)]*0x64)/0x64,'gatewayEarnings':Math[_0x5bfc27(0x142)](_0x4c236f[_0x5bfc27(0x100)]*0x64)/0x64}))[_0x5bfc27(0x186)]((_0x162239,_0x4eb4b6)=>_0x162239['date'][_0x5bfc27(0x17e)](_0x4eb4b6[_0x5bfc27(0x195)])),'periodInfo':{'from':_0x329a8e,'to':_0x378c45,'periodType':_0x14a345['period']||_0x5bfc27(0xd8),'daysCount':_0x17b628}};return console['log'](_0x5bfc27(0x138)),console['log'](_0x5bfc27(0x145)+_0x130a8b[_0x5bfc27(0x112)]+_0x5bfc27(0x131)),console['log'](_0x5bfc27(0x16b)+_0x130a8b[_0x5bfc27(0x19f)]+_0x5bfc27(0x131)),console[_0x5bfc27(0xec)]('\x20\x20\x20🏪\x20Gateway\x20earnings:\x20'+_0x130a8b['gatewayEarnings']+_0x5bfc27(0x131)),console[_0x5bfc27(0xec)](_0x5bfc27(0x11e)+_0x130a8b[_0x5bfc27(0x18e)]),console[_0x5bfc27(0xec)]('\x20\x20\x20✅\x20Successful\x20payments:\x20'+_0x130a8b[_0x5bfc27(0x199)]),console[_0x5bfc27(0xec)](_0x5bfc27(0x19d)+_0x130a8b[_0x5bfc27(0x1d5)]+'%'),_0x130a8b;}[a35_0xf9bae0(0x110)](_0x59db82){const _0x214ce0=a35_0xf9bae0,_0x49c5bd={'test_gateway':_0x214ce0(0x1aa),'plisio':'Plisio','rapyd':'Rapyd','noda':_0x214ce0(0xe3),'cointopay':'CoinToPay','mastercard':'Amer\x20Master','klyme_eu':_0x214ce0(0x1d3),'klyme_gb':_0x214ce0(0x122),'klyme_de':_0x214ce0(0x1d7)};return _0x49c5bd[_0x59db82]||_0x59db82;}async[a35_0xf9bae0(0x12f)](_0x6c5a54){const _0x200d8e=a35_0xf9bae0,{page:_0x231d38,limit:_0x2510e2,minAmount:_0x186144,search:_0x5eabb7}=_0x6c5a54,_0x50793f=(_0x231d38-0x1)*_0x2510e2;console[_0x200d8e(0xec)](_0x200d8e(0x196),_0x6c5a54);const _0x947c6f={'balance':{'gt':0x0},'status':'ACTIVE'};_0x186144&&(_0x947c6f['balance']['gte']=_0x186144);_0x5eabb7&&(_0x947c6f['OR']=[{'name':{'contains':_0x5eabb7,'mode':'insensitive'}},{'username':{'contains':_0x5eabb7,'mode':_0x200d8e(0x1a8)}}]);const [_0x5bc8a2,_0x373b7e]=await Promise[_0x200d8e(0x16d)]([database_1['default'][_0x200d8e(0x176)][_0x200d8e(0x1db)]({'where':_0x947c6f,'skip':_0x50793f,'take':_0x2510e2,'orderBy':{'balance':_0x200d8e(0x161)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'createdAt':!![]}}),database_1[_0x200d8e(0x152)][_0x200d8e(0x176)]['count']({'where':_0x947c6f})]);console[_0x200d8e(0xec)](_0x200d8e(0x137)+_0x5bc8a2[_0x200d8e(0x1b9)]+'\x20merchants\x20with\x20positive\x20balance');const _0x3182cf=await Promise[_0x200d8e(0x16d)](_0x5bc8a2['map'](async _0xf2778b=>{const _0x445267=_0x200d8e,[_0x155562,_0x130a35,_0x3f091b]=await Promise[_0x445267(0x16d)]([database_1[_0x445267(0x152)][_0x445267(0x14f)][_0x445267(0x1b3)]({'where':{'shopId':_0xf2778b['id'],'status':_0x445267(0x12d),'amountUSDT':{'not':null}}}),database_1[_0x445267(0x152)]['payment']['findFirst']({'where':{'shopId':_0xf2778b['id'],'status':_0x445267(0x12d),'amountUSDT':{'not':null}},'orderBy':{'paidAt':_0x445267(0x140)},'select':{'paidAt':!![]}}),database_1[_0x445267(0x152)][_0x445267(0x14f)][_0x445267(0x17b)]({'by':[_0x445267(0x151)],'where':{'shopId':_0xf2778b['id'],'status':'PAID','amountUSDT':{'not':null}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x2c0b0d=_0x3f091b[_0x445267(0x1bf)](_0x50389e=>({'gateway':_0x50389e[_0x445267(0x151)],'count':_0x50389e[_0x445267(0x1c2)]['id'],'amountUSDT':_0x50389e[_0x445267(0xfc)][_0x445267(0x191)]||0x0,'amountAfterCommissionUSDT':_0x50389e[_0x445267(0xfc)][_0x445267(0x191)]||0x0,'commission':0x0}));return{'id':_0xf2778b['id'],'fullName':_0xf2778b['name'],'username':_0xf2778b['username'],'telegramId':_0xf2778b['telegram'],'merchantUrl':_0xf2778b[_0x445267(0x146)],'wallets':{'usdtPolygonWallet':_0xf2778b[_0x445267(0xcf)],'usdtTrcWallet':_0xf2778b['usdtTrcWallet'],'usdtErcWallet':_0xf2778b[_0x445267(0x1c7)],'usdcPolygonWallet':_0xf2778b[_0x445267(0x15a)]},'totalAmountUSDT':_0xf2778b['balance'],'totalAmountAfterCommissionUSDT':_0xf2778b[_0x445267(0x155)],'paymentsCount':_0x155562,'oldestPaymentDate':_0x130a35?.[_0x445267(0xfd)]||_0xf2778b[_0x445267(0x101)],'gatewayBreakdown':_0x2c0b0d};})),_0x333056=_0x5bc8a2[_0x200d8e(0x11c)]((_0x4f9432,_0x3edfae)=>_0x4f9432+_0x3edfae[_0x200d8e(0x155)],0x0),_0x18b1d0=_0x333056;return console[_0x200d8e(0xec)]('📊\x20Merchants\x20awaiting\x20payout:\x20'+_0x373b7e+_0x200d8e(0x141)+Math[_0x200d8e(0x142)](_0x18b1d0*0x64)/0x64+_0x200d8e(0x165)),{'merchants':_0x3182cf,'pagination':{'page':_0x231d38,'limit':_0x2510e2,'total':_0x373b7e,'totalPages':Math[_0x200d8e(0x12e)](_0x373b7e/_0x2510e2)},'summary':{'totalMerchants':_0x373b7e,'totalAmountUSDT':Math['round'](_0x333056*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x200d8e(0x142)](_0x18b1d0*0x64)/0x64}};}async[a35_0xf9bae0(0xf5)](_0x2ea5ce){const _0x324cd8=a35_0xf9bae0,{shopId:_0x1fb179,amount:_0x7ccb08,network:_0x2398bb,notes:_0x4f9e27,periodFrom:_0x1fdae3,periodTo:_0x3e42ff}=_0x2ea5ce,_0x29831b=await database_1[_0x324cd8(0x152)][_0x324cd8(0x180)](async _0x450d09=>{const _0x2283a6=_0x324cd8,_0x19fc34=await _0x450d09[_0x2283a6(0x176)][_0x2283a6(0x1c9)]({'where':{'id':_0x1fb179},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x19fc34)throw new Error(_0x2283a6(0xdf));console[_0x2283a6(0xec)](_0x2283a6(0x14a)+_0x19fc34[_0x2283a6(0x1a4)]+':'),console[_0x2283a6(0xec)](_0x2283a6(0x144)+_0x19fc34[_0x2283a6(0x155)][_0x2283a6(0x13d)](0x6)+_0x2283a6(0x131)),console['log'](_0x2283a6(0x10b)+_0x7ccb08[_0x2283a6(0x13d)](0x6)+_0x2283a6(0x131)),console['log'](_0x2283a6(0x1ca)+_0x19fc34[_0x2283a6(0xd3)]['toFixed'](0x6)+_0x2283a6(0x131));if(_0x19fc34[_0x2283a6(0x155)]<_0x7ccb08)throw new Error('Insufficient\x20balance.\x20Available:\x20'+_0x19fc34['balance']['toFixed'](0x6)+_0x2283a6(0x1be)+_0x7ccb08[_0x2283a6(0x13d)](0x6)+_0x2283a6(0x131));const _0x64177a=await _0x450d09[_0x2283a6(0x128)][_0x2283a6(0x1b0)]({'data':{'shopId':_0x1fb179,'amount':_0x7ccb08,'network':_0x2398bb,'status':_0x2283a6(0x169),'notes':_0x4f9e27,'periodFrom':_0x1fdae3?new Date(_0x1fdae3):null,'periodTo':_0x3e42ff?new Date(_0x3e42ff):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x1839d6=_0x19fc34[_0x2283a6(0x155)]-_0x7ccb08,_0x1c5d50=_0x19fc34['totalPaidOut']+_0x7ccb08;return await _0x450d09[_0x2283a6(0x176)][_0x2283a6(0x194)]({'where':{'id':_0x1fb179},'data':{'balance':_0x1839d6,'totalPaidOut':_0x1c5d50}}),console[_0x2283a6(0xec)](_0x2283a6(0xfe)+_0x19fc34['username']+_0x2283a6(0x15b)),console[_0x2283a6(0xec)]('\x20\x20\x20Balance:\x20'+_0x19fc34[_0x2283a6(0x155)][_0x2283a6(0x13d)](0x6)+_0x2283a6(0x129)+_0x1839d6[_0x2283a6(0x13d)](0x6)+'\x20USDT\x20(-'+_0x7ccb08[_0x2283a6(0x13d)](0x6)+')'),console['log'](_0x2283a6(0xc9)+_0x19fc34[_0x2283a6(0xd3)][_0x2283a6(0x13d)](0x6)+'\x20->\x20'+_0x1c5d50[_0x2283a6(0x13d)](0x6)+_0x2283a6(0x184)+_0x7ccb08[_0x2283a6(0x13d)](0x6)+')'),{'payout':_0x64177a,'shop':_0x19fc34};});return console['log']('✅\x20Payout\x20created:\x20'+_0x29831b[_0x324cd8(0x128)]['id']+_0x324cd8(0x13a)+_0x29831b[_0x324cd8(0x176)][_0x324cd8(0x1a4)]+'\x20('+_0x7ccb08+_0x324cd8(0xfb)),{'id':_0x29831b[_0x324cd8(0x128)]['id'],'shopId':_0x29831b[_0x324cd8(0x128)][_0x324cd8(0x15d)],'shopName':_0x29831b[_0x324cd8(0x176)][_0x324cd8(0xe6)],'shopUsername':_0x29831b[_0x324cd8(0x176)][_0x324cd8(0x1a4)],'amount':_0x29831b[_0x324cd8(0x128)][_0x324cd8(0x19a)],'network':_0x29831b['payout'][_0x324cd8(0x172)],'status':_0x29831b['payout'][_0x324cd8(0x156)],'txid':_0x29831b[_0x324cd8(0x128)]['txid'],'notes':_0x29831b[_0x324cd8(0x128)][_0x324cd8(0x123)],'periodFrom':_0x29831b[_0x324cd8(0x128)][_0x324cd8(0xd7)],'periodTo':_0x29831b[_0x324cd8(0x128)][_0x324cd8(0xd1)],'createdAt':_0x29831b[_0x324cd8(0x128)]['createdAt'],'paidAt':_0x29831b['payout']['paidAt']};}async['getAllPayouts'](_0x2efddc){const _0x32455a=a35_0xf9bae0,{page:_0x283b49,limit:_0x56052f,shopId:_0x250407,network:_0x5caf61,dateFrom:_0x1458a1,dateTo:_0x376b67,search:_0x1eb964}=_0x2efddc,_0x227a42=(_0x283b49-0x1)*_0x56052f,_0x3970cd={};_0x250407&&(_0x3970cd['shopId']=_0x250407);_0x5caf61&&(_0x3970cd['network']=_0x5caf61);(_0x1458a1||_0x376b67)&&(_0x3970cd['createdAt']={},_0x1458a1&&(_0x3970cd['createdAt'][_0x32455a(0xea)]=new Date(_0x1458a1)),_0x376b67&&(_0x3970cd[_0x32455a(0x101)]['lte']=new Date(_0x376b67)));_0x1eb964&&(_0x3970cd['OR']=[{'shop':{'name':{'contains':_0x1eb964,'mode':_0x32455a(0x1a8)}}},{'shop':{'username':{'contains':_0x1eb964,'mode':_0x32455a(0x1a8)}}},{'notes':{'contains':_0x1eb964,'mode':_0x32455a(0x1a8)}}]);const [_0x355310,_0x556b63]=await Promise[_0x32455a(0x16d)]([database_1[_0x32455a(0x152)][_0x32455a(0x128)][_0x32455a(0x1db)]({'where':_0x3970cd,'skip':_0x227a42,'take':_0x56052f,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x32455a(0x152)][_0x32455a(0x128)]['count']({'where':_0x3970cd})]);return{'payouts':_0x355310[_0x32455a(0x1bf)](_0x4fc037=>({'id':_0x4fc037['id'],'shopId':_0x4fc037[_0x32455a(0x15d)],'shopName':_0x4fc037['shop']['name'],'shopUsername':_0x4fc037[_0x32455a(0x176)][_0x32455a(0x1a4)],'amount':_0x4fc037[_0x32455a(0x19a)],'network':_0x4fc037[_0x32455a(0x172)],'status':_0x4fc037[_0x32455a(0x156)],'txid':_0x4fc037[_0x32455a(0xde)],'notes':_0x4fc037[_0x32455a(0x123)],'periodFrom':_0x4fc037[_0x32455a(0xd7)],'periodTo':_0x4fc037[_0x32455a(0xd1)],'createdAt':_0x4fc037['createdAt'],'paidAt':_0x4fc037[_0x32455a(0xfd)]})),'pagination':{'page':_0x283b49,'limit':_0x56052f,'total':_0x556b63,'totalPages':Math['ceil'](_0x556b63/_0x56052f)}};}async[a35_0xf9bae0(0x1a3)](_0x28a23f){const _0x491746=a35_0xf9bae0,_0x3df868=await database_1[_0x491746(0x152)][_0x491746(0x128)][_0x491746(0x1c9)]({'where':{'id':_0x28a23f},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x3df868)return null;return{'id':_0x3df868['id'],'shopId':_0x3df868['shopId'],'shopName':_0x3df868[_0x491746(0x176)][_0x491746(0xe6)],'shopUsername':_0x3df868[_0x491746(0x176)][_0x491746(0x1a4)],'amount':_0x3df868[_0x491746(0x19a)],'network':_0x3df868['network'],'status':_0x3df868[_0x491746(0x156)],'txid':_0x3df868[_0x491746(0xde)],'notes':_0x3df868[_0x491746(0x123)],'periodFrom':_0x3df868['periodFrom'],'periodTo':_0x3df868['periodTo'],'createdAt':_0x3df868['createdAt'],'paidAt':_0x3df868[_0x491746(0xfd)]};}async[a35_0xf9bae0(0x170)](_0x14d540){const _0x39566f=a35_0xf9bae0;await database_1[_0x39566f(0x152)][_0x39566f(0x128)][_0x39566f(0x183)]({'where':{'id':_0x14d540}});}async[a35_0xf9bae0(0x198)](_0x7a2d58){const _0x2d323d=a35_0xf9bae0,{page:_0x4db200,limit:_0x243aa6,status:_0x36bee8,gateway:_0x41de00,shopId:_0x102dda,dateFrom:_0x4e0fc5,dateTo:_0xf09077,search:_0x5f143c}=_0x7a2d58,_0x4e513e=(_0x4db200-0x1)*_0x243aa6,_0x5de4b4={};_0x36bee8&&(_0x5de4b4[_0x2d323d(0x156)]=_0x36bee8[_0x2d323d(0x14b)]());_0x41de00&&(_0x5de4b4[_0x2d323d(0x151)]=_0x41de00[_0x2d323d(0x12c)]());_0x5de4b4['gateway']=_0x5de4b4['gateway']?_0x5de4b4[_0x2d323d(0x151)]:{'not':_0x2d323d(0x1a1)};if(typeof _0x5de4b4['gateway']==='string'&&_0x5de4b4[_0x2d323d(0x151)]!==_0x2d323d(0x1a1)){}else{if(typeof _0x5de4b4[_0x2d323d(0x151)]===_0x2d323d(0x189)&&_0x5de4b4[_0x2d323d(0x151)]===_0x2d323d(0x1a1)){}else _0x5de4b4[_0x2d323d(0x151)]={'not':_0x2d323d(0x1a1)};}_0x102dda&&(_0x5de4b4[_0x2d323d(0x15d)]=_0x102dda);(_0x4e0fc5||_0xf09077)&&(_0x5de4b4[_0x2d323d(0x101)]={},_0x4e0fc5&&(_0x5de4b4[_0x2d323d(0x101)]['gte']=new Date(_0x4e0fc5)),_0xf09077&&(_0x5de4b4[_0x2d323d(0x101)][_0x2d323d(0x1b8)]=new Date(_0xf09077)));_0x5f143c&&(_0x5de4b4['OR']=[{'orderId':{'contains':_0x5f143c,'mode':_0x2d323d(0x1a8)}},{'gatewayOrderId':{'contains':_0x5f143c,'mode':_0x2d323d(0x1a8)}},{'customerEmail':{'contains':_0x5f143c,'mode':'insensitive'}},{'shop':{'name':{'contains':_0x5f143c,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x5f143c,'mode':'insensitive'}}}]);const [_0x1b7c9b,_0x80f65e]=await Promise[_0x2d323d(0x16d)]([database_1[_0x2d323d(0x152)][_0x2d323d(0x14f)][_0x2d323d(0x1db)]({'where':_0x5de4b4,'skip':_0x4e513e,'take':_0x243aa6,'orderBy':{'createdAt':_0x2d323d(0x161)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x2d323d(0x152)][_0x2d323d(0x14f)][_0x2d323d(0x1b3)]({'where':_0x5de4b4})]);return{'payments':_0x1b7c9b[_0x2d323d(0x1bf)](_0x424834=>({'id':_0x424834['id'],'shopId':_0x424834[_0x2d323d(0x15d)],'gateway':this[_0x2d323d(0x110)](_0x424834['gateway']),'gatewayTechnical':_0x424834['gateway'],'amount':_0x424834[_0x2d323d(0x19a)],'currency':_0x424834['currency'],'status':_0x424834[_0x2d323d(0x156)],'orderId':_0x424834[_0x2d323d(0x1c6)],'gatewayOrderId':_0x424834[_0x2d323d(0x1c5)],'customerEmail':_0x424834[_0x2d323d(0x17d)],'customerName':_0x424834[_0x2d323d(0x1d2)],'customerCountry':_0x424834['customerCountry'],'customerIp':_0x424834['customerIp'],'customerUa':_0x424834[_0x2d323d(0x12b)],'failureMessage':_0x424834[_0x2d323d(0x1d0)],'cardLast4':_0x424834[_0x2d323d(0x1b5)],'paymentMethod':_0x424834[_0x2d323d(0x1a9)],'bankId':_0x424834[_0x2d323d(0x1a2)],'remitterIban':_0x424834[_0x2d323d(0xdd)],'remitterName':_0x424834[_0x2d323d(0x16f)],'txUrls':_0x424834[_0x2d323d(0x18b)],'createdAt':_0x424834[_0x2d323d(0x101)],'updatedAt':_0x424834['updatedAt'],'shop':_0x424834[_0x2d323d(0x176)]})),'pagination':{'page':_0x4db200,'limit':_0x243aa6,'total':_0x80f65e,'totalPages':Math['ceil'](_0x80f65e/_0x243aa6)}};}async['getPaymentById'](_0x554888){const _0x560391=a35_0xf9bae0,_0x18df73=await database_1['default']['payment'][_0x560391(0x1c9)]({'where':{'id':_0x554888},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x18df73)return null;return{'id':_0x18df73['id'],'shopId':_0x18df73[_0x560391(0x15d)],'gateway':this[_0x560391(0x110)](_0x18df73[_0x560391(0x151)]),'gatewayTechnical':_0x18df73[_0x560391(0x151)],'amount':_0x18df73[_0x560391(0x19a)],'currency':_0x18df73[_0x560391(0xd6)],'status':_0x18df73[_0x560391(0x156)],'orderId':_0x18df73['orderId'],'gatewayOrderId':_0x18df73[_0x560391(0x1c5)],'customerEmail':_0x18df73[_0x560391(0x17d)],'customerName':_0x18df73[_0x560391(0x1d2)],'customerCountry':_0x18df73[_0x560391(0x18c)],'customerIp':_0x18df73['customerIp'],'customerUa':_0x18df73['customerUa'],'failureMessage':_0x18df73[_0x560391(0x1d0)],'externalPaymentUrl':_0x18df73[_0x560391(0xf4)],'successUrl':_0x18df73[_0x560391(0x148)],'failUrl':_0x18df73[_0x560391(0x118)],'pendingUrl':_0x18df73[_0x560391(0xe9)],'whiteUrl':_0x18df73[_0x560391(0x1a5)],'cardLast4':_0x18df73['cardLast4'],'paymentMethod':_0x18df73['paymentMethod'],'bankId':_0x18df73['bankId'],'remitterIban':_0x18df73[_0x560391(0xdd)],'remitterName':_0x18df73[_0x560391(0x16f)],'txUrls':_0x18df73['txUrls'],'createdAt':_0x18df73[_0x560391(0x101)],'updatedAt':_0x18df73[_0x560391(0xe8)],'shop':_0x18df73[_0x560391(0x176)]};}async[a35_0xf9bae0(0xe7)](_0x202efb,_0x396ff9,_0x120bcd,_0x55c3c8){const _0x453ef7=a35_0xf9bae0,_0x42c492=await database_1[_0x453ef7(0x152)]['$transaction'](async _0x5e688f=>{const _0x43dd2b=_0x453ef7,_0xd84377=await _0x5e688f[_0x43dd2b(0x14f)][_0x43dd2b(0x1c9)]({'where':{'id':_0x202efb},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0xd84377)throw new Error('Payment\x20not\x20found');const _0x4cb5d4=_0xd84377[_0x43dd2b(0x156)],_0x5c6bde=_0x396ff9['toUpperCase']();console[_0x43dd2b(0xec)]('🔄\x20Admin\x20updating\x20payment\x20'+_0x202efb+'\x20status:\x20'+_0x4cb5d4+'\x20->\x20'+_0x5c6bde),console[_0x43dd2b(0xec)](_0x43dd2b(0x18a)+_0xd84377[_0x43dd2b(0x176)]['balance']+_0x43dd2b(0x131));const _0x5c3879={'status':_0x5c6bde,'updatedAt':new Date(),'statusChangedBy':_0x43dd2b(0x1ab),'statusChangedAt':new Date()};_0x120bcd&&(_0x5c3879['adminNotes']=_0x120bcd);_0x5c6bde===_0x43dd2b(0x168)&&_0x55c3c8&&(_0x5c3879['chargebackAmount']=_0x55c3c8);let _0x50ff3c=0x0,_0x4a502d=_0xd84377[_0x43dd2b(0x176)]['balance'];if(_0x5c6bde===_0x43dd2b(0x12d)&&_0x4cb5d4!==_0x43dd2b(0x12d)){_0x5c3879[_0x43dd2b(0xfd)]=new Date();const _0x1bc086=await currencyService_1[_0x43dd2b(0x1d1)]['convertToUSDT'](_0xd84377[_0x43dd2b(0x19a)],_0xd84377[_0x43dd2b(0xd6)]);_0x5c3879['amountUSDT']=_0x1bc086,_0x50ff3c=_0x1bc086,_0x4a502d+=_0x1bc086,console[_0x43dd2b(0xec)](_0x43dd2b(0x1cc)+_0x202efb+_0x43dd2b(0xf7)+_0x1bc086[_0x43dd2b(0x13d)](0x6)+_0x43dd2b(0x12a));}else _0x4cb5d4===_0x43dd2b(0x12d)&&_0x5c6bde!=='PAID'&&(_0xd84377[_0x43dd2b(0x191)]&&(_0x50ff3c=-_0xd84377[_0x43dd2b(0x191)],_0x4a502d-=_0xd84377[_0x43dd2b(0x191)],_0x5c3879['amountUSDT']=null,console[_0x43dd2b(0xec)](_0x43dd2b(0x1cc)+_0x202efb+_0x43dd2b(0xd2)+_0xd84377[_0x43dd2b(0x191)]['toFixed'](0x6)+_0x43dd2b(0x1d8))));if(_0x5c6bde==='CHARGEBACK'){if(_0x4cb5d4==='PAID'&&_0xd84377[_0x43dd2b(0x191)]){}_0x55c3c8&&_0x55c3c8>0x0&&(_0x50ff3c-=_0x55c3c8,_0x4a502d-=_0x55c3c8,console['log'](_0x43dd2b(0x1d6)+_0x55c3c8[_0x43dd2b(0x13d)](0x6)+_0x43dd2b(0x1d8)));}_0x5c6bde===_0x43dd2b(0x17f)&&_0x4cb5d4===_0x43dd2b(0x12d)&&console[_0x43dd2b(0xec)](_0x43dd2b(0xed));const _0x18b094=await _0x5e688f[_0x43dd2b(0x14f)][_0x43dd2b(0x194)]({'where':{'id':_0x202efb},'data':_0x5c3879,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x50ff3c!==0x0&&(await _0x5e688f[_0x43dd2b(0x176)]['update']({'where':{'id':_0xd84377['shopId']},'data':{'balance':_0x4a502d}}),console[_0x43dd2b(0xec)](_0x43dd2b(0xfe)+_0xd84377[_0x43dd2b(0x15d)]+_0x43dd2b(0x1c1)+_0xd84377['shop'][_0x43dd2b(0x155)]['toFixed'](0x6)+_0x43dd2b(0x129)+_0x4a502d[_0x43dd2b(0x13d)](0x6)+_0x43dd2b(0x179)+(_0x50ff3c>0x0?'+':'')+_0x50ff3c['toFixed'](0x6)+')')),_0x18b094;});return{'id':_0x42c492['id'],'shopId':_0x42c492['shopId'],'gateway':_0x42c492[_0x453ef7(0x151)],'amount':_0x42c492['amount'],'currency':_0x42c492['currency'],'status':_0x42c492[_0x453ef7(0x156)],'orderId':_0x42c492[_0x453ef7(0x1c6)],'gatewayOrderId':_0x42c492[_0x453ef7(0x1c5)],'customerEmail':_0x42c492['customerEmail'],'customerName':_0x42c492['customerName'],'customerCountry':_0x42c492[_0x453ef7(0x18c)],'customerIp':_0x42c492[_0x453ef7(0x10c)],'customerUa':_0x42c492[_0x453ef7(0x12b)],'failureMessage':_0x42c492['failureMessage'],'adminNotes':_0x42c492[_0x453ef7(0x111)],'chargebackAmount':_0x42c492[_0x453ef7(0xf2)],'statusChangedBy':_0x42c492[_0x453ef7(0xe0)],'statusChangedAt':_0x42c492[_0x453ef7(0x1c4)],'createdAt':_0x42c492[_0x453ef7(0x101)],'updatedAt':_0x42c492['updatedAt'],'shop':_0x42c492[_0x453ef7(0x176)]};}async[a35_0xf9bae0(0x1cf)](_0x541299,_0x4970fa){const _0x4c0f07=a35_0xf9bae0,_0x4e78ff={..._0x4970fa};_0x4970fa[_0x4c0f07(0x1c0)]&&(_0x4e78ff[_0x4c0f07(0x1c0)]=await bcryptjs_1[_0x4c0f07(0x152)][_0x4c0f07(0x13b)](_0x4970fa[_0x4c0f07(0x1c0)],0xc));_0x4970fa[_0x4c0f07(0x1bb)]&&(_0x4e78ff['name']=_0x4970fa[_0x4c0f07(0x1bb)],delete _0x4e78ff[_0x4c0f07(0x1bb)]);_0x4970fa[_0x4c0f07(0x166)]&&(_0x4e78ff[_0x4c0f07(0x108)]=_0x4970fa[_0x4c0f07(0x166)],delete _0x4e78ff['telegramId']);_0x4970fa['merchantUrl']&&(_0x4e78ff[_0x4c0f07(0x146)]=_0x4970fa[_0x4c0f07(0x119)],delete _0x4e78ff[_0x4c0f07(0x119)]);_0x4970fa[_0x4c0f07(0x18f)]&&(_0x4e78ff[_0x4c0f07(0x14d)]=JSON[_0x4c0f07(0x19c)](_0x4970fa[_0x4c0f07(0x18f)]),delete _0x4e78ff['gateways']);_0x4970fa[_0x4c0f07(0xdc)]&&(_0x4e78ff[_0x4c0f07(0xdc)]=JSON['stringify'](_0x4970fa['gatewaySettings']),delete _0x4e78ff[_0x4c0f07(0xdc)]);_0x4970fa[_0x4c0f07(0x1bd)]&&(_0x4970fa[_0x4c0f07(0x1bd)]['usdtPolygonWallet']!==undefined&&(_0x4e78ff[_0x4c0f07(0xcf)]=_0x4970fa[_0x4c0f07(0x1bd)][_0x4c0f07(0xcf)]||null),_0x4970fa[_0x4c0f07(0x1bd)]['usdtTrcWallet']!==undefined&&(_0x4e78ff['usdtTrcWallet']=_0x4970fa['wallets'][_0x4c0f07(0x109)]||null),_0x4970fa[_0x4c0f07(0x1bd)]['usdtErcWallet']!==undefined&&(_0x4e78ff[_0x4c0f07(0x1c7)]=_0x4970fa[_0x4c0f07(0x1bd)][_0x4c0f07(0x1c7)]||null),_0x4970fa[_0x4c0f07(0x1bd)][_0x4c0f07(0x15a)]!==undefined&&(_0x4e78ff[_0x4c0f07(0x15a)]=_0x4970fa[_0x4c0f07(0x1bd)][_0x4c0f07(0x15a)]||null),delete _0x4e78ff['wallets']);const _0x210f52=await database_1['default'][_0x4c0f07(0x176)][_0x4c0f07(0x194)]({'where':{'id':_0x541299},'data':_0x4e78ff,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x210f52['id'],'fullName':_0x210f52[_0x4c0f07(0xe6)],'username':_0x210f52[_0x4c0f07(0x1a4)],'telegramId':_0x210f52['telegram'],'merchantUrl':_0x210f52[_0x4c0f07(0x146)],'gateways':_0x210f52['paymentGateways']?JSON[_0x4c0f07(0x1a7)](_0x210f52['paymentGateways']):null,'gatewaySettings':_0x210f52['gatewaySettings']?JSON[_0x4c0f07(0x1a7)](_0x210f52[_0x4c0f07(0xdc)]):null,'publicKey':_0x210f52[_0x4c0f07(0xda)],'wallets':{'usdtPolygonWallet':_0x210f52[_0x4c0f07(0xcf)],'usdtTrcWallet':_0x210f52[_0x4c0f07(0x109)],'usdtErcWallet':_0x210f52[_0x4c0f07(0x1c7)],'usdcPolygonWallet':_0x210f52[_0x4c0f07(0x15a)]},'status':_0x210f52[_0x4c0f07(0x156)],'createdAt':_0x210f52[_0x4c0f07(0x101)]};}async[a35_0xf9bae0(0x115)](_0x2baeef){const _0x57e460=a35_0xf9bae0,_0x443f18=await database_1[_0x57e460(0x152)][_0x57e460(0x176)]['update']({'where':{'id':_0x2baeef},'data':{'status':_0x57e460(0x11f)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x443f18['id'],'fullName':_0x443f18[_0x57e460(0xe6)],'username':_0x443f18['username'],'telegramId':_0x443f18[_0x57e460(0x108)],'merchantUrl':_0x443f18[_0x57e460(0x146)],'gateways':_0x443f18[_0x57e460(0x14d)]?JSON['parse'](_0x443f18[_0x57e460(0x14d)]):null,'gatewaySettings':_0x443f18[_0x57e460(0xdc)]?JSON[_0x57e460(0x1a7)](_0x443f18['gatewaySettings']):null,'publicKey':_0x443f18[_0x57e460(0xda)],'wallets':{'usdtPolygonWallet':_0x443f18[_0x57e460(0xcf)],'usdtTrcWallet':_0x443f18['usdtTrcWallet'],'usdtErcWallet':_0x443f18[_0x57e460(0x1c7)],'usdcPolygonWallet':_0x443f18[_0x57e460(0x15a)]},'status':_0x443f18[_0x57e460(0x156)],'createdAt':_0x443f18[_0x57e460(0x101)]};}async[a35_0xf9bae0(0x104)](_0x893ef7){const _0x72fa08=a35_0xf9bae0,_0x29d3d1=await database_1[_0x72fa08(0x152)]['shop']['update']({'where':{'id':_0x893ef7},'data':{'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x29d3d1['id'],'fullName':_0x29d3d1[_0x72fa08(0xe6)],'username':_0x29d3d1[_0x72fa08(0x1a4)],'telegramId':_0x29d3d1[_0x72fa08(0x108)],'merchantUrl':_0x29d3d1[_0x72fa08(0x146)],'gateways':_0x29d3d1['paymentGateways']?JSON['parse'](_0x29d3d1[_0x72fa08(0x14d)]):null,'gatewaySettings':_0x29d3d1['gatewaySettings']?JSON[_0x72fa08(0x1a7)](_0x29d3d1[_0x72fa08(0xdc)]):null,'publicKey':_0x29d3d1[_0x72fa08(0xda)],'wallets':{'usdtPolygonWallet':_0x29d3d1[_0x72fa08(0xcf)],'usdtTrcWallet':_0x29d3d1['usdtTrcWallet'],'usdtErcWallet':_0x29d3d1['usdtErcWallet'],'usdcPolygonWallet':_0x29d3d1[_0x72fa08(0x15a)]},'status':_0x29d3d1[_0x72fa08(0x156)],'createdAt':_0x29d3d1[_0x72fa08(0x101)]};}async[a35_0xf9bae0(0x11a)](_0x144fb7){const _0x3fd4aa=a35_0xf9bae0,{page:_0x219f2b,limit:_0x443510,status:_0x2c9f86}=_0x144fb7,_0x4bf785=(_0x219f2b-0x1)*_0x443510,_0x4b0392={};_0x2c9f86&&(_0x4b0392[_0x3fd4aa(0x156)]=_0x2c9f86[_0x3fd4aa(0x14b)]());const [_0x52cc3f,_0x5e59e7]=await Promise[_0x3fd4aa(0x16d)]([database_1[_0x3fd4aa(0x152)]['shop'][_0x3fd4aa(0x1db)]({'where':_0x4b0392,'skip':_0x4bf785,'take':_0x443510,'orderBy':{'createdAt':_0x3fd4aa(0x161)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x3fd4aa(0x152)][_0x3fd4aa(0x176)]['count']({'where':_0x4b0392})]);return{'users':_0x52cc3f['map'](_0x26e7fc=>({'id':_0x26e7fc['id'],'fullName':_0x26e7fc[_0x3fd4aa(0xe6)],'username':_0x26e7fc[_0x3fd4aa(0x1a4)],'telegramId':_0x26e7fc[_0x3fd4aa(0x108)],'merchantUrl':_0x26e7fc[_0x3fd4aa(0x146)],'gateways':_0x26e7fc[_0x3fd4aa(0x14d)]?JSON[_0x3fd4aa(0x1a7)](_0x26e7fc[_0x3fd4aa(0x14d)]):null,'gatewaySettings':_0x26e7fc[_0x3fd4aa(0xdc)]?JSON['parse'](_0x26e7fc[_0x3fd4aa(0xdc)]):null,'publicKey':_0x26e7fc[_0x3fd4aa(0xda)],'wallets':{'usdtPolygonWallet':_0x26e7fc['usdtPolygonWallet'],'usdtTrcWallet':_0x26e7fc[_0x3fd4aa(0x109)],'usdtErcWallet':_0x26e7fc[_0x3fd4aa(0x1c7)],'usdcPolygonWallet':_0x26e7fc[_0x3fd4aa(0x15a)]},'status':_0x26e7fc[_0x3fd4aa(0x156)],'createdAt':_0x26e7fc['createdAt']})),'pagination':{'page':_0x219f2b,'limit':_0x443510,'total':_0x5e59e7,'totalPages':Math[_0x3fd4aa(0x12e)](_0x5e59e7/_0x443510)}};}async[a35_0xf9bae0(0xe5)](_0x277248){const _0x13c39a=a35_0xf9bae0,_0x912f8a=await database_1['default'][_0x13c39a(0x176)][_0x13c39a(0x1c9)]({'where':{'id':_0x277248},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x912f8a)return null;return{'id':_0x912f8a['id'],'fullName':_0x912f8a[_0x13c39a(0xe6)],'username':_0x912f8a[_0x13c39a(0x1a4)],'telegramId':_0x912f8a['telegram'],'merchantUrl':_0x912f8a['shopUrl'],'gateways':_0x912f8a['paymentGateways']?JSON[_0x13c39a(0x1a7)](_0x912f8a[_0x13c39a(0x14d)]):null,'gatewaySettings':_0x912f8a[_0x13c39a(0xdc)]?JSON['parse'](_0x912f8a[_0x13c39a(0xdc)]):null,'publicKey':_0x912f8a[_0x13c39a(0xda)],'wallets':{'usdtPolygonWallet':_0x912f8a[_0x13c39a(0xcf)],'usdtTrcWallet':_0x912f8a['usdtTrcWallet'],'usdtErcWallet':_0x912f8a[_0x13c39a(0x1c7)],'usdcPolygonWallet':_0x912f8a[_0x13c39a(0x15a)]},'status':_0x912f8a[_0x13c39a(0x156)],'createdAt':_0x912f8a[_0x13c39a(0x101)]};}async[a35_0xf9bae0(0x1da)](_0x3e273c){const _0x348306=a35_0xf9bae0,{fullName:_0x267dd8,username:_0x50db2b,password:_0x38fe10,telegramId:_0x52cc43,merchantUrl:_0x36060d,gateways:_0x1b66ee,gatewaySettings:_0x20745c,wallets:_0x32dd76}=_0x3e273c,_0xe32e5f=await database_1[_0x348306(0x152)]['shop']['findUnique']({'where':{'username':_0x50db2b}});if(_0xe32e5f)throw new Error(_0x348306(0xd5));if(_0x52cc43){const _0x1abbab=await database_1['default'][_0x348306(0x176)][_0x348306(0x1c9)]({'where':{'telegram':_0x52cc43}});if(_0x1abbab)throw new Error(_0x348306(0xef));}const _0x5b5c84=await bcryptjs_1[_0x348306(0x152)]['hash'](_0x38fe10,0xc),_0x2e2325=_0x348306(0x19e)+crypto_1['default'][_0x348306(0x1ce)](0x20)[_0x348306(0x19b)](_0x348306(0x120)),_0x2e5ea0=_0x348306(0x16e)+crypto_1[_0x348306(0x152)][_0x348306(0x1ce)](0x20)['toString'](_0x348306(0x120)),_0x45a02c=await database_1['default'][_0x348306(0x176)][_0x348306(0x1b0)]({'data':{'name':_0x267dd8,'username':_0x50db2b,'password':_0x5b5c84,'telegram':_0x52cc43,'shopUrl':_0x36060d,'paymentGateways':_0x1b66ee?JSON[_0x348306(0x19c)](_0x1b66ee):null,'gatewaySettings':_0x20745c?JSON[_0x348306(0x19c)](_0x20745c):null,'usdtPolygonWallet':_0x32dd76?.[_0x348306(0xcf)]||null,'usdtTrcWallet':_0x32dd76?.[_0x348306(0x109)]||null,'usdtErcWallet':_0x32dd76?.[_0x348306(0x1c7)]||null,'usdcPolygonWallet':_0x32dd76?.[_0x348306(0x15a)]||null,'publicKey':_0x2e2325,'secretKey':_0x2e5ea0,'status':_0x348306(0x1ac)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x45a02c['id'],'fullName':_0x45a02c[_0x348306(0xe6)],'username':_0x45a02c[_0x348306(0x1a4)],'telegramId':_0x45a02c[_0x348306(0x108)],'merchantUrl':_0x45a02c[_0x348306(0x146)],'gateways':_0x45a02c[_0x348306(0x14d)]?JSON[_0x348306(0x1a7)](_0x45a02c['paymentGateways']):null,'gatewaySettings':_0x45a02c[_0x348306(0xdc)]?JSON[_0x348306(0x1a7)](_0x45a02c[_0x348306(0xdc)]):null,'publicKey':_0x45a02c[_0x348306(0xda)],'wallets':{'usdtPolygonWallet':_0x45a02c[_0x348306(0xcf)],'usdtTrcWallet':_0x45a02c[_0x348306(0x109)],'usdtErcWallet':_0x45a02c['usdtErcWallet'],'usdcPolygonWallet':_0x45a02c[_0x348306(0x15a)]},'status':_0x45a02c[_0x348306(0x156)],'createdAt':_0x45a02c[_0x348306(0x101)]};}async['deleteUser'](_0x192046){const _0x1d78e1=a35_0xf9bae0;await database_1[_0x1d78e1(0x152)][_0x1d78e1(0x176)][_0x1d78e1(0x183)]({'where':{'id':_0x192046}});}async['getMerchantsSelection'](_0x5614d4){const _0x5ced81=a35_0xf9bae0,_0xcb4a45={};_0x5614d4&&[_0x5ced81(0x1ac),_0x5ced81(0x1cb),_0x5ced81(0x11f)][_0x5ced81(0xe2)](_0x5614d4[_0x5ced81(0x14b)]())&&(_0xcb4a45[_0x5ced81(0x156)]=_0x5614d4[_0x5ced81(0x14b)]());const _0x4282d3=await database_1['default'][_0x5ced81(0x176)][_0x5ced81(0x1db)]({'where':_0xcb4a45,'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':'asc'}});return _0x4282d3;}}exports[a35_0xf9bae0(0x103)]=AdminService;