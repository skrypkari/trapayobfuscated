'use strict';const a40_0x3f592f=a40_0x58a2;(function(_0x54d032,_0x10d8d2){const _0x5a6a34=a40_0x58a2,_0x2d47c0=_0x54d032();while(!![]){try{const _0x14709c=-parseInt(_0x5a6a34(0x2bb))/0x1*(-parseInt(_0x5a6a34(0x2a0))/0x2)+-parseInt(_0x5a6a34(0x21f))/0x3*(parseInt(_0x5a6a34(0x2d7))/0x4)+-parseInt(_0x5a6a34(0x19f))/0x5+parseInt(_0x5a6a34(0x2a3))/0x6+parseInt(_0x5a6a34(0x1e4))/0x7+parseInt(_0x5a6a34(0x2da))/0x8+-parseInt(_0x5a6a34(0x230))/0x9*(-parseInt(_0x5a6a34(0x1d2))/0xa);if(_0x14709c===_0x10d8d2)break;else _0x2d47c0['push'](_0x2d47c0['shift']());}catch(_0x1c5c2b){_0x2d47c0['push'](_0x2d47c0['shift']());}}}(a40_0x1f17,0xf3097));var __importDefault=this&&this['__importDefault']||function(_0x361485){const _0x522f34=a40_0x58a2;return _0x361485&&_0x361485[_0x522f34(0x29c)]?_0x361485:{'default':_0x361485};};function a40_0x58a2(_0x46785e,_0x5ae027){const _0x1f170f=a40_0x1f17();return a40_0x58a2=function(_0x58a29a,_0x589510){_0x58a29a=_0x58a29a-0x19b;let _0x54de24=_0x1f170f[_0x58a29a];return _0x54de24;},a40_0x58a2(_0x46785e,_0x5ae027);}function a40_0x1f17(){const _0x410461=['payment','getMerchantStatistics','groupBy','create','totalCommissionRate','\x20\x20\x20üìÖ\x20This\x20month:\x20','Test\x20Gateway','\x20\x20\x20üñ•Ô∏è\x20User\x20Agent:\x20','username','getTime','‚úÖ\x20Balance\x20check\x20passed\x20(with\x20tolerance)','\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)','erc20',']\x20Gateway\x20settings\x20before\x20saving:','Insufficient\x20balance.\x20Available:\x20','split','map','crypto','üìä\x20Calculating\x20payout\x20statistics...','\x20\x20\x20ÔøΩ\x20Total\x20paid\x20out:\x20','usdtTrcWallet','\x20\x20\x20‚úÖ\x20Actual\x20available\x20balance:\x20','turnoverUSDT','\x20for\x20shop\x20','Payment\x20not\x20found','getGatewayInternalName','periodFrom','\x20merchants','üí≥\x20Payout\x20wallet\x20for\x20','üîÑ\x20Gateway\x20mapping\x20(create):','\x20\x20\x20üè™\x20Gateway\x20earnings:\x20','totalTurnover','getMerchantsSelection','Rapyd','%\x20from\x20','values','week','some','getGatewayDisplayName','currencyService','updatedAt','getGatewayNameById','error','üí∞\x20Creating\x20payout\x20for\x20shop\x20','name','averageCheckUSDT','hex','klyme_eu','password','failureMessage','\x20\x20\x20ÔøΩüìä\x20Total\x20payments:\x20','KLYME\x20GB','publicKey','\x27\x20->\x20ID\x20\x27','dailyRevenue','rapyd','test_gateway','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','averageCommissionRate','\x20PAID\x20payments','customerIp','üí∞\x20Found\x20','createdAt','thisMonth','pendingPayout','amountUSDT','createUser','pendingUrl','usdtPolygonWallet',',\x20Commission:\x20','amount','üîß\x20[','totalPayout','\x20USDT\x20(theoretical\x20net)','üìä\x20Calculated\x20commission\x20rate\x20for\x20payment\x20','paidAt','log','merchantEarningsUSDT','__esModule','shopUrl','deletePayout','\x20\x20\x20Full\x20amount:\x20','6dwWjQY','\x20in\x20',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','8126604HulNWN','updateUser','localeCompare','amountAfterGatewayCommissionUSDT','commissionUSDT','fullName','toISOString','update','getMonth','\x20\x20\x20Final\x20payout\x20amount\x20used:\x20','../types/gateway','CoinToPay','\x20\x20\x20Tolerance:\x20','usdcPolygonWallet','\x20\x20\x20üåê\x20IP:\x20','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','revenue','\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...','\x20\x20\x20Transaction\x20hash:\x20','\x20USDT\x20from\x20balance','gateway','orderId','SUSPENDED','includes','207439kIAmtp','join','statusChangedBy','KLYME\x20DE','substr','klyme_gb',']\x20Updating\x20password\x20for\x20user\x20','\x27\x20not\x20found.\x20Available\x20gateways:\x20','Shop\x20not\x20found','Open\x20Banking\x202','statusChangedAt','30d','updatePaymentStatus','mastercard','üìä\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','setHours','findUnique','\x20USDT\x20(same\x20as\x20awaiting)','aggregate','ACTIVE','telegram','not\x20specified','get','getFullYear','CHARGEBACK','toString','forEach','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','2164RmnYVh','\x20\x20\x20Gateway:\x20','chargebackAmount','9625760GYixpr','\x20USDT\x20(after\x20','üìä\x20Sorting\x20payments\x20by\x20','üìä\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20','üîÑ\x20Converted\x20gateway\x20ID\x20\x27','reduce','getGatewayIdByName','üí∞\x20Current\x20shop\x20balance:\x20','adminNotes','gatewayEarnings','8565765JBhJQK','\x20USDT\x20(gross\x20revenue)','üí∞\x20[PAYOUT]\x20Merchant\x20','usdtErcWallet','generateDailyStatistics','\x20\x20\x20üë§\x20Merchant\x20earnings:\x20','entries','status','desc','üéØ\x20[','suspendUser','ceil','Plisio','push','plisio','totalAmountUSDT','year','\x20became\x20PAID:','üîç\x20Balance\x20check\x20details:','trim','getAllPayouts','random','sort',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','telegramId','dateTo','üìä\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','gatewayOrderId','lte','COMPLETED','\x20\x20\x20üíµ\x20Available\x20balance:\x20','defineProperty','wallets','asc','üìä\x20Using\x20saved\x20values\x20for\x20payment\x20','\x20USDT\x20for\x20payment\x20','\x20\x20\x20Available\x20(raw):\x20','delete','stringify','findMany','payout','shop','date','\x20USDT\x20(','\x20\x20\x20Merchant\x20loses:\x20','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','paymentGateways','\x20to\x20','\x20balance\x20updated:\x20','turnover','getPaymentById','10SQIXFu','‚úÖ\x20Using\x20gateway\x20filter:\x20\x27','üìä\x20Merchant\x20statistics\x20calculated:','\x20\x20\x20Payout\x20amount:\x20','parse','txid','convertToUSDT','set','insensitive','\x20\x20\x20Added\x20to\x20balance:\x20+','üîÑ\x20Updating\x20customer\x20data\x20for\x20payment\x20','\x20USDT,\x20Requested:\x20','default','merchantEarnings','gatewaySettings','setDate','getAllPayments','üîÑ\x20Converted\x20gateway\x20name\x20\x27','766409KCmLhw','\x20USDT\x20(total\x20paid\x20to\x20merchants)','NONEXISTENT_GATEWAY_FILTER','dateFrom','0000','\x20\x20\x20Difference:\x20','merchantUrl','90d','period','\x20USDT','üîÑ\x20Admin\x20updating\x20payment\x20','\x20\x20\x20üîç\x20Calculated\x20after\x20commission:\x20','\x20USDT\x20(current\x20balance\x20in\x20DB)','customerEmail','admin','sk_','shopId','\x20\x20\x20üí∏\x20Total\x20payouts\x20(all\x20time):\x20','\x20\x20\x20Current\x20balance:\x20','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','MasterCard','toFixed','\x20USDT)','deleteUser','activateUser','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','polygon','üìÖ\x20Period:\x20','gte','\x20balance\x20updated:','KLYME\x20EU','\x20\x20\x20ü§î\x20Difference:\x20','%\x20commission)','getSystemStatistics','Username\x20already\x20exists','totalPaidOut','cointopay2','not\x20set','notes','failUrl','gateways','currency','üìä\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','usdcErcWallet','\x27\x20->\x20name\x20\x27','min','randomBytes','\x27\x20to\x20name\x20\x27','customerUa',':\x20commission\x20=\x20','./currencyService','length','\x27\x20(from\x20\x27','commission','all','üí∞\x20Payment\x20','custom','periodTo','findFirst','9759cJlvNt','\x20\x20\x20‚úÖ\x20Total\x20available\x20for\x20payout:\x20','yesterday','network','\x20\x20\x20üí∞\x20Total\x20turnover:\x20','_sum','totalPayments','‚ö†Ô∏è\x20Gateway\x20\x27','customerCountry','\x20USDT\x20(actual\x20balances)','\x20active\x20merchants\x20for\x20selection','\x20->\x20','\x20\x20\x20üí∞\x20Total\x20payments\x20turnover:\x20',']\x20Gateway\x20settings\x20JSON\x20string:','toUpperCase','trc20','\x20\x20\x20ÔøΩ\x20Total\x20payments\x20turnover:\x20','10611423LdVlzR','‚ö†Ô∏è\x20Payment\x20','\x20USDT\x20(already\x20paid\x20out)','count','whiteUrl','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20',',\x20userId:\x20','\x20\x20\x20‚è≥\x20Pending\x20payout:\x20','klyme_de','AdminService','\x20\x20\x20Requested\x20(number):\x20','üí∞\x20Payment\x20amount\x20is\x20NOT\x20deducted\x20(chargeback\x20penalty\x20only)','üîç\x20Using\x20gateway\x20\x27','round','toLowerCase','‚úÖ\x20Customer\x20data\x20updated\x20for\x20payment\x20','getPayoutById','\x20\x20\x20üìÖ\x20Total\x20payouts\x20(this\x20month):\x20','paidOutUSDT','gatewayCommissionRate','paymentsCount','\x20USDT,\x20Difference:\x20','customerName','üí∏\x20CHARGEBACK\x20penalty\x20ONLY:\x20-','\x20USDT,\x20merchant:\x20','getDate','PAID','day','balance','getAllUsers'];a40_0x1f17=function(){return _0x410461;};return a40_0x1f17();}Object[a40_0x3f592f(0x1be)](exports,a40_0x3f592f(0x29c),{'value':!![]}),exports[a40_0x3f592f(0x239)]=void 0x0;const database_1=__importDefault(require('../config/database')),bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a40_0x3f592f(0x25f))),currencyService_1=require(a40_0x3f592f(0x216)),gateway_1=require(a40_0x3f592f(0x2ad));class AdminService{async['getPayoutStats'](){const _0x22d774=a40_0x3f592f;console['log'](_0x22d774(0x260));const _0x4d1732=await database_1[_0x22d774(0x1de)][_0x22d774(0x1c8)][_0x22d774(0x2cd)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x22d774(0x2ce)}}),_0x1380a5=await database_1['default'][_0x22d774(0x24e)][_0x22d774(0x233)]({'where':{'status':_0x22d774(0x24a),'gateway':{'not':_0x22d774(0x286)}}}),_0x2f10db=new Date(),_0x4da802=new Date(_0x2f10db[_0x22d774(0x2d2)](),_0x2f10db[_0x22d774(0x2ab)](),0x1),_0x280c92=new Date(_0x2f10db['getFullYear'](),_0x2f10db[_0x22d774(0x2ab)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x2de917=await database_1['default']['payout']['aggregate']({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x4da802,'lte':_0x280c92},'status':'COMPLETED'}}),_0x33cebe=_0x4d1732[_0x22d774(0x224)]['totalPaidOut']||0x0,_0x5a73b9=_0x4d1732[_0x22d774(0x224)][_0x22d774(0x24c)]||0x0,_0x419c30=_0x2de917[_0x22d774(0x224)]['amount']||0x0,_0x3abd33={'totalPayout':Math[_0x22d774(0x23d)](_0x33cebe*0x64)/0x64,'awaitingPayout':Math[_0x22d774(0x23d)](_0x5a73b9*0x64)/0x64,'thisMonth':Math[_0x22d774(0x23d)](_0x419c30*0x64)/0x64,'availableBalance':Math[_0x22d774(0x23d)](_0x5a73b9*0x64)/0x64,'totalPayments':_0x1380a5};return console[_0x22d774(0x29a)]('üìä\x20Payout\x20statistics\x20calculated:'),console[_0x22d774(0x29a)]('\x20\x20\x20üí∞\x20Total\x20payout:\x20'+_0x3abd33[_0x22d774(0x296)]+_0x22d774(0x1e5)),console[_0x22d774(0x29a)](_0x22d774(0x235)+_0x3abd33['awaitingPayout']+_0x22d774(0x259)),console[_0x22d774(0x29a)](_0x22d774(0x1bd)+_0x3abd33['availableBalance']+_0x22d774(0x2cc)),console[_0x22d774(0x29a)](_0x22d774(0x253)+_0x3abd33['thisMonth']+_0x22d774(0x1ed)),console[_0x22d774(0x29a)]('\x20\x20\x20üí≥\x20Total\x20payments:\x20'+_0x3abd33[_0x22d774(0x225)]+_0x22d774(0x289)),_0x3abd33;}async['updateCustomerData'](_0x2fa359,_0x381385){const _0x13b8f2=a40_0x3f592f;console[_0x13b8f2(0x29a)](_0x13b8f2(0x1dc)+_0x2fa359+':',_0x381385);const _0x182145=await database_1[_0x13b8f2(0x1de)][_0x13b8f2(0x24e)]['findUnique']({'where':{'id':_0x2fa359},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x182145)throw new Error(_0x13b8f2(0x266));const _0x2b1712={};_0x381385[_0x13b8f2(0x227)]!==undefined&&(_0x2b1712[_0x13b8f2(0x227)]=_0x381385['customerCountry']||null);_0x381385[_0x13b8f2(0x28a)]!==undefined&&(_0x2b1712['customerIp']=_0x381385[_0x13b8f2(0x28a)]||null);_0x381385[_0x13b8f2(0x214)]!==undefined&&(_0x2b1712[_0x13b8f2(0x214)]=_0x381385[_0x13b8f2(0x214)]||null);const _0x3d46d9=await database_1[_0x13b8f2(0x1de)][_0x13b8f2(0x24e)][_0x13b8f2(0x2aa)]({'where':{'id':_0x2fa359},'data':{..._0x2b1712,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x13b8f2(0x29a)](_0x13b8f2(0x23f)+_0x2fa359),console['log']('\x20\x20\x20üåç\x20Country:\x20'+_0x182145[_0x13b8f2(0x227)]+_0x13b8f2(0x22a)+_0x3d46d9[_0x13b8f2(0x227)]),console[_0x13b8f2(0x29a)](_0x13b8f2(0x2b1)+_0x182145[_0x13b8f2(0x28a)]+_0x13b8f2(0x22a)+_0x3d46d9[_0x13b8f2(0x28a)]),console[_0x13b8f2(0x29a)](_0x13b8f2(0x255)+(_0x182145[_0x13b8f2(0x214)]?_0x13b8f2(0x1d9):'not\x20set')+'\x20->\x20'+(_0x3d46d9[_0x13b8f2(0x214)]?_0x13b8f2(0x1d9):_0x13b8f2(0x209))),_0x3d46d9;}async[a40_0x3f592f(0x205)](_0x22f276){const _0x1da7cc=a40_0x3f592f,_0x5b044d=new Date();let _0x2bef84;switch(_0x22f276[_0x1da7cc(0x23e)]()){case _0x1da7cc(0x24b):_0x2bef84=new Date(_0x5b044d[_0x1da7cc(0x2d2)](),_0x5b044d[_0x1da7cc(0x2ab)](),_0x5b044d[_0x1da7cc(0x249)](),0x0,0x0,0x0,0x0);break;case _0x1da7cc(0x221):const _0x212742=new Date(_0x5b044d);_0x212742[_0x1da7cc(0x1e1)](_0x212742[_0x1da7cc(0x249)]()-0x1),_0x2bef84=new Date(_0x212742['getFullYear'](),_0x212742[_0x1da7cc(0x2ab)](),_0x212742[_0x1da7cc(0x249)](),0x0,0x0,0x0,0x0);break;case'7d':_0x2bef84=new Date(_0x5b044d[_0x1da7cc(0x257)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x1da7cc(0x2c6):_0x2bef84=new Date(_0x5b044d[_0x1da7cc(0x257)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x1da7cc(0x1eb):_0x2bef84=new Date(_0x5b044d['getTime']()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x1da7cc(0x21a):const _0x16940c=await database_1['default'][_0x1da7cc(0x24e)]['findFirst']({'where':{'gateway':{'not':_0x1da7cc(0x286)}},'orderBy':{'createdAt':_0x1da7cc(0x1c0)},'select':{'createdAt':!![]}});_0x2bef84=_0x16940c?_0x16940c[_0x1da7cc(0x28c)]:new Date('2020-01-01');break;default:_0x2bef84=new Date(_0x5b044d[_0x1da7cc(0x257)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}_0x2bef84['setHours'](0x0,0x0,0x0,0x0);let _0x1c0bb6;if(_0x22f276[_0x1da7cc(0x23e)]()===_0x1da7cc(0x221)){const _0x316835=new Date(_0x5b044d);_0x316835['setDate'](_0x316835[_0x1da7cc(0x249)]()-0x1),_0x1c0bb6=new Date(_0x316835[_0x1da7cc(0x2d2)](),_0x316835[_0x1da7cc(0x2ab)](),_0x316835[_0x1da7cc(0x249)](),0x17,0x3b,0x3b,0x3e7);}const _0x319045={'gte':_0x2bef84};_0x1c0bb6&&(_0x319045[_0x1da7cc(0x1bb)]=_0x1c0bb6);const [_0x304d12,_0x59be89,_0x265d60,_0x2e8d4a,_0x6821c3,_0x4dc41b]=await Promise[_0x1da7cc(0x21a)]([database_1[_0x1da7cc(0x1de)]['shop'][_0x1da7cc(0x233)](),database_1[_0x1da7cc(0x1de)][_0x1da7cc(0x1c8)][_0x1da7cc(0x233)]({'where':{'status':'ACTIVE'}}),database_1['default'][_0x1da7cc(0x24e)][_0x1da7cc(0x233)]({'where':{'status':_0x1da7cc(0x24a),'createdAt':_0x319045,'gateway':{'not':_0x1da7cc(0x286)}}}),database_1[_0x1da7cc(0x1de)][_0x1da7cc(0x24e)][_0x1da7cc(0x1c6)]({'where':{'status':_0x1da7cc(0x24a),'createdAt':_0x319045,'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x1da7cc(0x1de)]['payment'][_0x1da7cc(0x1c6)]({'where':{'gateway':{'not':_0x1da7cc(0x286)}},'take':0xa,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x1da7cc(0x1de)]['payment'][_0x1da7cc(0x1c6)]({'where':{'createdAt':_0x319045,'gateway':{'not':_0x1da7cc(0x286)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x4baade=0x0,_0x3ec7f0=0x0;for(const _0x2521ed of _0x2e8d4a){const _0x51adbe=await currencyService_1[_0x1da7cc(0x275)]['convertToUSDT'](_0x2521ed[_0x1da7cc(0x294)],_0x2521ed[_0x1da7cc(0x20d)]);_0x4baade+=_0x51adbe;if(_0x2521ed[_0x1da7cc(0x2a6)]){const _0x5dcaa7=await currencyService_1['currencyService'][_0x1da7cc(0x1d8)](_0x2521ed[_0x1da7cc(0x294)],_0x2521ed[_0x1da7cc(0x20d)]),_0x534162=_0x2521ed['amountAfterGatewayCommissionUSDT'],_0x2debf3=_0x5dcaa7-_0x534162;_0x3ec7f0+=_0x2debf3;}}const _0x38fc08=_0x265d60>0x0?_0x4baade/_0x265d60:0x0,_0x131895=this[_0x1da7cc(0x1a3)](_0x4dc41b,_0x2bef84,_0x1c0bb6||_0x5b044d),_0x2a778f=await database_1[_0x1da7cc(0x1de)][_0x1da7cc(0x24e)][_0x1da7cc(0x233)]({'where':{'createdAt':_0x319045,'gateway':{'not':_0x1da7cc(0x286)}}}),_0x157b31=_0x2a778f>0x0?_0x265d60/_0x2a778f*0x64:0x0;return{'totalShops':_0x304d12,'activeShops':_0x59be89,'totalPayments':_0x265d60,'successfulPayments':_0x265d60,'totalAttempts':_0x2a778f,'totalRevenue':Math['round'](_0x4baade*0x64)/0x64,'trapayEarnings':Math['round'](_0x3ec7f0*0x64)/0x64,'averagePaymentAmount':Math[_0x1da7cc(0x23d)](_0x38fc08*0x64)/0x64,'conversionRate':Math[_0x1da7cc(0x23d)](_0x157b31*0x64)/0x64,'dailyRevenue':_0x131895[_0x1da7cc(0x284)],'dailyPayments':_0x131895['dailyPayments'],'recentPayments':_0x6821c3[_0x1da7cc(0x25e)](_0x2db0bb=>({'id':_0x2db0bb['id'],'amount':_0x2db0bb[_0x1da7cc(0x294)],'currency':_0x2db0bb[_0x1da7cc(0x20d)],'status':_0x2db0bb[_0x1da7cc(0x1a6)],'gateway':_0x2db0bb['gateway'],'shop':_0x2db0bb[_0x1da7cc(0x1c8)],'createdAt':_0x2db0bb[_0x1da7cc(0x28c)]}))};}async[a40_0x3f592f(0x24f)](_0x2b67e9){const _0x344149=a40_0x3f592f;console[_0x344149(0x29a)]('üìä\x20Getting\x20merchant\x20statistics\x20with\x20filters:',_0x2b67e9);let _0x1e27d7,_0x222951=new Date();if(_0x2b67e9['period']==='custom'&&_0x2b67e9[_0x344149(0x1e7)]&&_0x2b67e9[_0x344149(0x1b8)])_0x1e27d7=new Date(_0x2b67e9[_0x344149(0x1e7)]),_0x222951=new Date(_0x2b67e9[_0x344149(0x1b8)]),_0x1e27d7['setHours'](0x0,0x0,0x0,0x0),_0x222951['setHours'](0x17,0x3b,0x3b,0x3e7);else{const _0x385ace=new Date();switch(_0x2b67e9[_0x344149(0x1ec)]){case _0x344149(0x272):_0x1e27d7=new Date(_0x385ace[_0x344149(0x257)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'month':_0x1e27d7=new Date(_0x385ace['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x344149(0x1af):_0x1e27d7=new Date(_0x385ace[_0x344149(0x257)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x344149(0x21a):default:_0x1e27d7=new Date('2020-01-01');break;}_0x1e27d7[_0x344149(0x2ca)](0x0,0x0,0x0,0x0),_0x222951[_0x344149(0x2ca)](0x17,0x3b,0x3b,0x3e7);}console[_0x344149(0x29a)](_0x344149(0x1ff)+_0x1e27d7[_0x344149(0x2a9)]()+_0x344149(0x1ce)+_0x222951[_0x344149(0x2a9)]());const _0x1a5811={'status':_0x344149(0x24a),'gateway':{'not':_0x344149(0x286)},'paidAt':{'gte':_0x1e27d7,'lte':_0x222951}};_0x2b67e9[_0x344149(0x1f4)]&&(_0x1a5811[_0x344149(0x1f4)]=_0x2b67e9[_0x344149(0x1f4)]);const _0x4910e0=await database_1[_0x344149(0x1de)]['payment'][_0x344149(0x1c6)]({'where':_0x1a5811,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x344149(0x29a)](_0x344149(0x28b)+_0x4910e0['length']+'\x20paid\x20payments\x20for\x20analysis');const _0xcdc916={'gateway':{'not':_0x344149(0x286)},'createdAt':{'gte':_0x1e27d7,'lte':_0x222951}};_0x2b67e9['shopId']&&(_0xcdc916[_0x344149(0x1f4)]=_0x2b67e9['shopId']);const _0xec81ec=await database_1[_0x344149(0x1de)]['payment'][_0x344149(0x233)]({'where':_0xcdc916});console[_0x344149(0x29a)]('üìä\x20Total\x20payments\x20(including\x20failed):\x20'+_0xec81ec+',\x20successful:\x20'+_0x4910e0['length']);let _0x44c814=0x0,_0x1fe3e8=0x0,_0x58bf0d=0x0;const _0x2a02c7={},_0x1d21cd={},_0x1c29cc={};for(const _0x2465e8 of _0x4910e0){try{const _0x240035=_0x2465e8[_0x344149(0x28f)]||0x0;if(_0x240035<=0x0){console['warn'](_0x344149(0x231)+_0x2465e8['id']+_0x344149(0x2b4));continue;}let _0x587038,_0x152907;if(_0x2465e8[_0x344149(0x2a6)]!==null&&_0x2465e8[_0x344149(0x2a6)]!==undefined)_0x587038=_0x2465e8[_0x344149(0x2a6)],_0x152907=_0x240035-_0x587038,console[_0x344149(0x29a)](_0x344149(0x1c1)+_0x2465e8['id']+':\x20'+_0x240035[_0x344149(0x1f9)](0x6)+_0x344149(0x248)+_0x587038[_0x344149(0x1f9)](0x6)+_0x344149(0x1ed));else{let _0x57ffdd={};if(_0x2465e8[_0x344149(0x1c8)][_0x344149(0x1e0)])try{_0x57ffdd=JSON[_0x344149(0x1d6)](_0x2465e8[_0x344149(0x1c8)][_0x344149(0x1e0)]);}catch(_0x3bf62a){console[_0x344149(0x278)](_0x344149(0x2d6)+_0x2465e8[_0x344149(0x1f4)]+':',_0x3bf62a);}let _0x37886c=0x2d;for(const [_0x2f821d,_0x4cedcd]of Object[_0x344149(0x1a5)](_0x57ffdd)){if(_0x2f821d[_0x344149(0x23e)]()===_0x2465e8[_0x344149(0x2b7)][_0x344149(0x23e)]()){_0x37886c=_0x4cedcd[_0x344149(0x219)]||0x2d;break;}}_0x152907=_0x240035*(_0x37886c/0x64),_0x587038=_0x240035-_0x152907,console['log']('üìä\x20Calculating\x20commission\x20manually\x20for\x20payment\x20'+_0x2465e8['id']+':\x20'+_0x37886c+_0x344149(0x270)+_0x240035['toFixed'](0x6)+_0x344149(0x1ed));}_0x44c814+=_0x240035,_0x1fe3e8+=_0x587038,_0x58bf0d+=_0x152907;let _0x3dbd35;_0x2465e8['gatewayCommissionRate']!==null&&_0x2465e8[_0x344149(0x243)]!==undefined?(_0x3dbd35=_0x2465e8['gatewayCommissionRate'],console[_0x344149(0x29a)](_0x344149(0x2dd)+_0x2465e8['id']+':\x20'+_0x3dbd35+'%')):(_0x3dbd35=_0x240035>0x0?_0x152907/_0x240035*0x64:0x0,console[_0x344149(0x29a)](_0x344149(0x298)+_0x2465e8['id']+':\x20'+_0x3dbd35[_0x344149(0x1f9)](0x2)+'%'));!_0x2a02c7[_0x2465e8[_0x344149(0x2b7)]]&&(_0x2a02c7[_0x2465e8['gateway']]={'gateway':_0x2465e8[_0x344149(0x2b7)],'gatewayDisplayName':this['getGatewayDisplayName'](_0x2465e8[_0x344149(0x2b7)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x2a02c7[_0x2465e8['gateway']][_0x344149(0x244)]++,_0x2a02c7[_0x2465e8[_0x344149(0x2b7)]][_0x344149(0x264)]+=_0x240035,_0x2a02c7[_0x2465e8[_0x344149(0x2b7)]][_0x344149(0x2a7)]+=_0x152907,_0x2a02c7[_0x2465e8[_0x344149(0x2b7)]]['merchantEarningsUSDT']+=_0x587038,_0x2a02c7[_0x2465e8[_0x344149(0x2b7)]][_0x344149(0x252)]+=_0x3dbd35;!_0x2b67e9[_0x344149(0x1f4)]&&(!_0x1d21cd[_0x2465e8[_0x344149(0x1f4)]]&&(_0x1d21cd[_0x2465e8[_0x344149(0x1f4)]]={'shopId':_0x2465e8[_0x344149(0x1f4)],'shopName':_0x2465e8[_0x344149(0x1c8)][_0x344149(0x27a)],'shopUsername':_0x2465e8[_0x344149(0x1c8)][_0x344149(0x256)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x1d21cd[_0x2465e8[_0x344149(0x1f4)]]['paymentsCount']++,_0x1d21cd[_0x2465e8['shopId']]['turnoverUSDT']+=_0x240035,_0x1d21cd[_0x2465e8[_0x344149(0x1f4)]]['commissionUSDT']+=_0x152907,_0x1d21cd[_0x2465e8[_0x344149(0x1f4)]][_0x344149(0x29b)]+=_0x587038);const _0x1e516f=_0x2465e8[_0x344149(0x299)][_0x344149(0x2a9)]()[_0x344149(0x25d)]('T')[0x0];!_0x1c29cc[_0x1e516f]&&(_0x1c29cc[_0x1e516f]={'date':_0x1e516f,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x1c29cc[_0x1e516f][_0x344149(0x1d0)]+=_0x240035,_0x1c29cc[_0x1e516f][_0x344149(0x1df)]+=_0x587038,_0x1c29cc[_0x1e516f][_0x344149(0x19e)]+=_0x152907,_0x1c29cc[_0x1e516f]['paymentsCount']++;}catch(_0xcf242c){console[_0x344149(0x278)]('Error\x20processing\x20payment\x20'+_0x2465e8['id']+':',_0xcf242c);}}Object[_0x344149(0x271)](_0x2a02c7)[_0x344149(0x2d5)](_0x1def35=>{const _0x1d29cf=_0x344149;_0x1def35[_0x1d29cf(0x288)]=_0x1def35['paymentsCount']>0x0?_0x1def35[_0x1d29cf(0x252)]/_0x1def35['paymentsCount']:0x0,delete _0x1def35[_0x1d29cf(0x252)];}),Object[_0x344149(0x271)](_0x1d21cd)[_0x344149(0x2d5)](_0x59cd38=>{const _0x3bd717=_0x344149;_0x59cd38['averageCheckUSDT']=_0x59cd38['paymentsCount']>0x0?_0x59cd38[_0x3bd717(0x264)]/_0x59cd38[_0x3bd717(0x244)]:0x0;});let _0x27255=0x0,_0x4281af=0x0;if(_0x2b67e9[_0x344149(0x1f4)]){const _0x4a6f5d=await database_1[_0x344149(0x1de)][_0x344149(0x1c7)]['findMany']({'where':{'shopId':_0x2b67e9[_0x344149(0x1f4)],'status':_0x344149(0x1bc),'createdAt':{'gte':_0x1e27d7,'lte':_0x222951}},'select':{'amount':!![]}});_0x27255=_0x4a6f5d[_0x344149(0x2df)]((_0x314807,_0x15b2e9)=>_0x314807+_0x15b2e9[_0x344149(0x294)],0x0);const _0x3dcf07=await database_1[_0x344149(0x1de)][_0x344149(0x1c7)][_0x344149(0x1c6)]({'where':{'shopId':_0x2b67e9[_0x344149(0x1f4)],'status':'PENDING','createdAt':{'gte':_0x1e27d7,'lte':_0x222951}},'select':{'amount':!![]}});_0x4281af=_0x3dcf07[_0x344149(0x2df)]((_0x4c5067,_0xf6e9f7)=>_0x4c5067+_0xf6e9f7[_0x344149(0x294)],0x0);}const _0x3c0a00=_0xec81ec,_0x5dbf1d=_0x4910e0['length'],_0x3f2201=_0x5dbf1d>0x0?_0x44c814/_0x5dbf1d:0x0,_0x2f1246=_0x3c0a00>0x0?Math[_0x344149(0x23d)](_0x5dbf1d/_0x3c0a00*0x2710)/0x64:0x0,_0x28850f=Math[_0x344149(0x1aa)]((_0x222951[_0x344149(0x257)]()-_0x1e27d7[_0x344149(0x257)]())/(0x3e8*0x3c*0x3c*0x18)),_0x2a9555={'totalTurnover':Math['round'](_0x44c814*0x64)/0x64,'merchantEarnings':Math['round'](_0x1fe3e8*0x64)/0x64,'gatewayEarnings':Math[_0x344149(0x23d)](_0x58bf0d*0x64)/0x64,'totalPaidOut':Math['round'](_0x27255*0x64)/0x64,'pendingPayout':Math[_0x344149(0x23d)](_0x4281af*0x64)/0x64,'averageCheck':Math[_0x344149(0x23d)](_0x3f2201*0x64)/0x64,'totalPayments':_0x3c0a00,'successfulPayments':_0x5dbf1d,'conversionRate':_0x2f1246,'gatewayBreakdown':Object[_0x344149(0x271)](_0x2a02c7)[_0x344149(0x25e)](_0x16eec5=>({..._0x16eec5,'turnoverUSDT':Math['round'](_0x16eec5['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x344149(0x23d)](_0x16eec5['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x344149(0x23d)](_0x16eec5[_0x344149(0x29b)]*0x64)/0x64,'averageCommissionRate':Math[_0x344149(0x23d)](_0x16eec5[_0x344149(0x288)]*0x64)/0x64})),'merchantBreakdown':_0x2b67e9[_0x344149(0x1f4)]?undefined:Object['values'](_0x1d21cd)['map'](_0xe67b4d=>({..._0xe67b4d,'turnoverUSDT':Math['round'](_0xe67b4d[_0x344149(0x264)]*0x64)/0x64,'commissionUSDT':Math['round'](_0xe67b4d[_0x344149(0x2a7)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0xe67b4d[_0x344149(0x29b)]*0x64)/0x64,'paidOutUSDT':Math['round'](_0xe67b4d[_0x344149(0x242)]*0x64)/0x64,'averageCheckUSDT':Math[_0x344149(0x23d)](_0xe67b4d[_0x344149(0x27b)]*0x64)/0x64})),'dailyData':Object[_0x344149(0x271)](_0x1c29cc)[_0x344149(0x25e)](_0x2b2369=>({..._0x2b2369,'turnover':Math[_0x344149(0x23d)](_0x2b2369[_0x344149(0x1d0)]*0x64)/0x64,'merchantEarnings':Math[_0x344149(0x23d)](_0x2b2369[_0x344149(0x1df)]*0x64)/0x64,'gatewayEarnings':Math[_0x344149(0x23d)](_0x2b2369[_0x344149(0x19e)]*0x64)/0x64}))[_0x344149(0x1b5)]((_0x36fb1f,_0x3d18ff)=>_0x36fb1f[_0x344149(0x1c9)][_0x344149(0x2a5)](_0x3d18ff['date'])),'periodInfo':{'from':_0x1e27d7,'to':_0x222951,'periodType':_0x2b67e9['period']||_0x344149(0x21c),'daysCount':_0x28850f}};return console[_0x344149(0x29a)](_0x344149(0x1d4)),console[_0x344149(0x29a)](_0x344149(0x223)+_0x2a9555[_0x344149(0x26d)]+'\x20USDT'),console['log'](_0x344149(0x1a4)+_0x2a9555[_0x344149(0x1df)]+_0x344149(0x1ed)),console[_0x344149(0x29a)](_0x344149(0x26c)+_0x2a9555[_0x344149(0x19e)]+_0x344149(0x1ed)),console[_0x344149(0x29a)](_0x344149(0x261)+_0x2a9555[_0x344149(0x207)]+_0x344149(0x1ed)),console[_0x344149(0x29a)](_0x344149(0x237)+_0x2a9555[_0x344149(0x28e)]+_0x344149(0x1ed)),console[_0x344149(0x29a)](_0x344149(0x280)+_0x2a9555[_0x344149(0x225)]),_0x2a9555;}async[a40_0x3f592f(0x26e)](){const _0x2ce9d8=a40_0x3f592f;console[_0x2ce9d8(0x29a)]('üìã\x20Getting\x20merchants\x20selection\x20list...');const _0x35ecba=await database_1[_0x2ce9d8(0x1de)][_0x2ce9d8(0x1c8)][_0x2ce9d8(0x1c6)]({'where':{'status':'ACTIVE'},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x2ce9d8(0x1c0)}});return console[_0x2ce9d8(0x29a)]('üìã\x20Found\x20'+_0x35ecba[_0x2ce9d8(0x217)]+_0x2ce9d8(0x229)),_0x35ecba[_0x2ce9d8(0x25e)](_0x2b6014=>({'id':_0x2b6014['id'],'username':_0x2b6014[_0x2ce9d8(0x256)],'name':_0x2b6014[_0x2ce9d8(0x27a)]}));}[a40_0x3f592f(0x274)](_0x129a2d){const _0x1e4693=a40_0x3f592f,_0x1d3d05={'test_gateway':_0x1e4693(0x254),'plisio':_0x1e4693(0x1ab),'rapyd':_0x1e4693(0x26f),'noda':'Noda','cointopay':_0x1e4693(0x2ae),'cointopay2':_0x1e4693(0x2c4),'klyme_eu':_0x1e4693(0x202),'klyme_gb':_0x1e4693(0x281),'klyme_de':_0x1e4693(0x2be),'mastercard':_0x1e4693(0x1f8)};return _0x1d3d05[_0x129a2d]||_0x129a2d;}['getGatewayInternalName'](_0x253f6a){const _0x5333e2=a40_0x3f592f,_0x270e12={'Test\x20Gateway':_0x5333e2(0x286),'Plisio':_0x5333e2(0x1ad),'Rapyd':_0x5333e2(0x285),'Noda':'noda','CoinToPay':'cointopay','CoinToPay2':_0x5333e2(0x208),'KLYME\x20EU':_0x5333e2(0x27d),'KLYME\x20GB':_0x5333e2(0x2c0),'KLYME\x20DE':_0x5333e2(0x238),'MasterCard':_0x5333e2(0x2c8)};return _0x270e12[_0x253f6a]||_0x253f6a['toLowerCase']();}async['getMerchantsAwaitingPayout'](_0x2e5516){const _0x5a20c7=a40_0x3f592f,{page:_0x335207,limit:_0x10b352,minAmount:_0xb91edd,search:_0x511ca7}=_0x2e5516,_0x1814a6=(_0x335207-0x1)*_0x10b352;console['log'](_0x5a20c7(0x2c9),_0x2e5516);const _0xcd2be2={'balance':{'gt':0x0},'status':_0x5a20c7(0x2ce)};_0xb91edd&&(_0xcd2be2[_0x5a20c7(0x24c)]['gte']=_0xb91edd);_0x511ca7&&(_0xcd2be2['name']={'contains':_0x511ca7,'mode':_0x5a20c7(0x1da)});const [_0x430289,_0xbb5516]=await Promise['all']([database_1[_0x5a20c7(0x1de)]['shop'][_0x5a20c7(0x1c6)]({'where':_0xcd2be2,'skip':_0x1814a6,'take':_0x10b352,'orderBy':{'balance':_0x5a20c7(0x1a7)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1[_0x5a20c7(0x1de)][_0x5a20c7(0x1c8)]['count']({'where':_0xcd2be2})]);console[_0x5a20c7(0x29a)](_0x5a20c7(0x28b)+_0x430289[_0x5a20c7(0x217)]+'\x20merchants\x20with\x20positive\x20balance');const _0x548bb2=await Promise['all'](_0x430289[_0x5a20c7(0x25e)](async _0x450a34=>{const _0x122639=_0x5a20c7,[_0x37fcfa,_0x572531,_0x1cd37c]=await Promise['all']([database_1['default'][_0x122639(0x24e)][_0x122639(0x233)]({'where':{'shopId':_0x450a34['id'],'status':_0x122639(0x24a),'gateway':{'not':_0x122639(0x286)}}}),database_1['default'][_0x122639(0x24e)][_0x122639(0x21e)]({'where':{'shopId':_0x450a34['id'],'status':'PAID','gateway':{'not':_0x122639(0x286)}},'orderBy':{'paidAt':'asc'},'select':{'paidAt':!![]}}),database_1[_0x122639(0x1de)][_0x122639(0x24e)][_0x122639(0x250)]({'by':['gateway'],'where':{'shopId':_0x450a34['id'],'status':'PAID','gateway':{'not':_0x122639(0x286)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x5dcbc8=new Date(),_0x5ee26d=new Date(_0x5dcbc8[_0x122639(0x2d2)](),_0x5dcbc8[_0x122639(0x2ab)](),0x1),_0x5db3b9=new Date(_0x5dcbc8[_0x122639(0x2d2)](),_0x5dcbc8[_0x122639(0x2ab)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x2ff0dd,_0x52afa0]=await Promise['all']([database_1[_0x122639(0x1de)][_0x122639(0x1c7)]['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x450a34['id'],'status':'COMPLETED'}}),database_1['default'][_0x122639(0x1c7)][_0x122639(0x2cd)]({'_sum':{'amount':!![]},'where':{'shopId':_0x450a34['id'],'status':_0x122639(0x1bc),'createdAt':{'gte':_0x5ee26d,'lte':_0x5db3b9}}})]),_0x2a5202=_0x2ff0dd[_0x122639(0x224)][_0x122639(0x294)]||0x0,_0x5ee781=_0x52afa0[_0x122639(0x224)][_0x122639(0x294)]||0x0,_0xa51415=await Promise[_0x122639(0x21a)](_0x1cd37c['map'](async _0x943611=>{const _0x149659=_0x122639;let _0x2c6cd2=0x2d;if(_0x450a34[_0x149659(0x1e0)])try{const _0x19c2f=JSON[_0x149659(0x1d6)](_0x450a34['gatewaySettings']);for(const [_0xf62ba2,_0xde770a]of Object[_0x149659(0x1a5)](_0x19c2f)){if(_0xf62ba2[_0x149659(0x23e)]()===_0x943611[_0x149659(0x2b7)][_0x149659(0x23e)]()){_0x2c6cd2=_0xde770a[_0x149659(0x219)]||0xa,console[_0x149659(0x29a)]('üí∞\x20[PAYOUT]\x20Gateway\x20'+_0x943611[_0x149659(0x2b7)]+_0x149659(0x265)+_0x450a34['id']+_0x149659(0x215)+_0x2c6cd2+'%');break;}}}catch(_0x4d5ec4){console['error']('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x450a34['id']+':',_0x4d5ec4);}const _0x33ed91=_0x943611[_0x149659(0x224)]?.[_0x149659(0x28f)]||0x0,_0x4c5aec=_0x33ed91*(0x1-_0x2c6cd2/0x64);return{'gateway':_0x943611[_0x149659(0x2b7)],'count':_0x943611['_count']?.['id']||0x0,'amountUSDT':Math['round'](_0x33ed91*0x64)/0x64,'amountAfterCommissionUSDT':Math['round'](_0x4c5aec*0x64)/0x64,'commission':_0x2c6cd2};})),_0x18354d=_0xa51415['reduce']((_0x25ac2c,_0x100018)=>_0x25ac2c+_0x100018[_0x122639(0x28f)],0x0),_0xb25768=_0xa51415[_0x122639(0x2df)]((_0x2cc7e6,_0x4b94cc)=>_0x2cc7e6+_0x4b94cc['amountAfterCommissionUSDT'],0x0),_0x4429dc=_0x450a34[_0x122639(0x24c)];return console[_0x122639(0x29a)](_0x122639(0x1a1)+_0x450a34[_0x122639(0x256)]+':'),console[_0x122639(0x29a)](_0x122639(0x22f)+_0x18354d[_0x122639(0x1f9)](0x2)+_0x122639(0x1a0)),console[_0x122639(0x29a)](_0x122639(0x1ef)+_0xb25768[_0x122639(0x1f9)](0x2)+_0x122639(0x297)),console['log'](_0x122639(0x263)+_0x4429dc[_0x122639(0x1f9)](0x2)+_0x122639(0x1f0)),console[_0x122639(0x29a)]('\x20\x20\x20üí∏\x20Total\x20payouts:\x20'+_0x2a5202['toFixed'](0x2)+_0x122639(0x232)),console[_0x122639(0x29a)](_0x122639(0x203)+(_0xb25768-_0x2a5202-_0x4429dc)[_0x122639(0x1f9)](0x2)+'\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)'),{'id':_0x450a34['id'],'fullName':_0x450a34[_0x122639(0x27a)],'username':_0x450a34[_0x122639(0x256)],'telegramId':_0x450a34[_0x122639(0x2cf)],'merchantUrl':_0x450a34['shopUrl'],'wallets':{'usdtPolygonWallet':_0x450a34[_0x122639(0x292)],'usdtTrcWallet':_0x450a34[_0x122639(0x262)],'usdtErcWallet':_0x450a34['usdtErcWallet'],'usdcPolygonWallet':_0x450a34[_0x122639(0x2b0)],'usdcErcWallet':_0x450a34[_0x122639(0x20f)]},'totalAmountUSDT':Math[_0x122639(0x23d)](_0x18354d*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x122639(0x23d)](_0xb25768*0x64)/0x64,'currentBalance':Math[_0x122639(0x23d)](_0x4429dc*0x64)/0x64,'totalPayout':Math[_0x122639(0x23d)](_0x2a5202*0x64)/0x64,'thisMonth':Math[_0x122639(0x23d)](_0x5ee781*0x64)/0x64,'paymentsCount':_0x37fcfa,'oldestPaymentDate':_0x572531?.[_0x122639(0x299)]||_0x450a34[_0x122639(0x28c)],'gatewayBreakdown':_0xa51415};})),_0x2905c9=_0x548bb2[_0x5a20c7(0x2df)]((_0x12564f,_0x1b9f20)=>_0x12564f+_0x1b9f20[_0x5a20c7(0x1ae)],0x0),_0x341804=_0x548bb2[_0x5a20c7(0x2df)]((_0x4e1167,_0x30bd97)=>_0x4e1167+_0x30bd97['totalAmountAfterCommissionUSDT'],0x0),_0x48b8ce=_0x548bb2[_0x5a20c7(0x2df)]((_0x519caf,_0x37982d)=>_0x519caf+_0x37982d[_0x5a20c7(0x296)],0x0),_0x17bba6=_0x548bb2['reduce']((_0x157088,_0x1c4b81)=>_0x157088+_0x1c4b81[_0x5a20c7(0x28d)],0x0);return console['log']('üìä\x20Merchants\x20awaiting\x20payout:\x20'+_0xbb5516+_0x5a20c7(0x269)),console[_0x5a20c7(0x29a)](_0x5a20c7(0x22b)+Math[_0x5a20c7(0x23d)](_0x2905c9*0x64)/0x64+_0x5a20c7(0x1a0)),console[_0x5a20c7(0x29a)](_0x5a20c7(0x220)+Math[_0x5a20c7(0x23d)](_0x341804*0x64)/0x64+_0x5a20c7(0x228)),console['log'](_0x5a20c7(0x1f5)+Math['round'](_0x48b8ce*0x64)/0x64+'\x20USDT'),console[_0x5a20c7(0x29a)](_0x5a20c7(0x241)+Math['round'](_0x17bba6*0x64)/0x64+_0x5a20c7(0x1ed)),{'merchants':_0x548bb2,'pagination':{'page':_0x335207,'limit':_0x10b352,'total':_0xbb5516,'totalPages':Math[_0x5a20c7(0x1aa)](_0xbb5516/_0x10b352)},'summary':{'totalMerchants':_0xbb5516,'totalAmountUSDT':Math[_0x5a20c7(0x23d)](_0x2905c9*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x341804*0x64)/0x64,'totalPayout':Math[_0x5a20c7(0x23d)](_0x48b8ce*0x64)/0x64,'thisMonth':Math[_0x5a20c7(0x23d)](_0x17bba6*0x64)/0x64}};}async['createPayout'](_0xd270dd){const _0x5679e3=a40_0x3f592f,{shopId:_0x525e91,amount:_0x2d965e,network:_0x4ef3c9,wallet:_0x7c4ffc,notes:_0x2e306f,txid:_0x3707a4,periodFrom:_0x280ec2,periodTo:_0x3435d5}=_0xd270dd,_0x3ad56a=await database_1[_0x5679e3(0x1de)]['$transaction'](async _0x337a76=>{const _0x2f1158=_0x5679e3,_0x3531e5=await _0x337a76[_0x2f1158(0x1c8)][_0x2f1158(0x2cb)]({'where':{'id':_0x525e91},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x3531e5)throw new Error(_0x2f1158(0x2c3));console['log'](_0x2f1158(0x279)+_0x3531e5['username']+':'),console[_0x2f1158(0x29a)](_0x2f1158(0x1f6)+_0x3531e5[_0x2f1158(0x24c)][_0x2f1158(0x1f9)](0x6)+_0x2f1158(0x1ed)),console['log'](_0x2f1158(0x1d5)+_0x2d965e[_0x2f1158(0x1f9)](0x6)+_0x2f1158(0x1ed)),console[_0x2f1158(0x29a)]('\x20\x20\x20Current\x20total\x20paid\x20out:\x20'+_0x3531e5[_0x2f1158(0x207)][_0x2f1158(0x1f9)](0x6)+_0x2f1158(0x1ed));if(_0x3707a4)console[_0x2f1158(0x29a)](_0x2f1158(0x2b5)+_0x3707a4);const _0xdd1f57=0.000001,_0x2b4df5=Number(_0x3531e5[_0x2f1158(0x24c)]),_0x150c08=Number(_0x2d965e);console[_0x2f1158(0x29a)](_0x2f1158(0x1b1)),console[_0x2f1158(0x29a)](_0x2f1158(0x1c3)+_0x3531e5[_0x2f1158(0x24c)]),console['log']('\x20\x20\x20Available\x20(number):\x20'+_0x2b4df5),console[_0x2f1158(0x29a)](_0x2f1158(0x23a)+_0x150c08),console[_0x2f1158(0x29a)](_0x2f1158(0x1e9)+(_0x2b4df5-_0x150c08)),console[_0x2f1158(0x29a)](_0x2f1158(0x2af)+_0xdd1f57);if(_0x2b4df5<_0x150c08-_0xdd1f57)throw new Error(_0x2f1158(0x25c)+_0x2b4df5['toFixed'](0x6)+_0x2f1158(0x1dd)+_0x150c08[_0x2f1158(0x1f9)](0x6)+_0x2f1158(0x245)+(_0x2b4df5-_0x150c08)['toFixed'](0x8)+_0x2f1158(0x1ed));console[_0x2f1158(0x29a)](_0x2f1158(0x258));const _0x2d98fe=Math[_0x2f1158(0x211)](_0x2b4df5,_0x150c08);let _0xf82d0a=_0x7c4ffc;if(!_0xf82d0a){const _0x46fbb7=await _0x337a76['shop'][_0x2f1158(0x2cb)]({'where':{'id':_0x525e91},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});if(_0x46fbb7)switch(_0x4ef3c9){case _0x2f1158(0x1fe):_0xf82d0a=_0x46fbb7['usdtPolygonWallet']||undefined;break;case _0x2f1158(0x22e):_0xf82d0a=_0x46fbb7[_0x2f1158(0x262)]||undefined;break;case _0x2f1158(0x25a):_0xf82d0a=_0x46fbb7[_0x2f1158(0x1a2)]||undefined;break;case'polygon_usdc':_0xf82d0a=_0x46fbb7[_0x2f1158(0x2b0)]||undefined;break;case'erc20_usdc':_0xf82d0a=_0x46fbb7[_0x2f1158(0x20f)]||undefined;break;}}console['log'](_0x2f1158(0x26a)+_0x4ef3c9+':\x20'+(_0xf82d0a||_0x2f1158(0x2d0)));const _0x20d2ea=await _0x337a76['payout'][_0x2f1158(0x251)]({'data':{'shopId':_0x525e91,'amount':_0x2d98fe,'network':_0x4ef3c9,'status':_0x2f1158(0x1bc),'txid':_0x3707a4,'notes':_0x2e306f,'periodFrom':_0x280ec2?new Date(_0x280ec2):null,'periodTo':_0x3435d5?new Date(_0x3435d5):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x2a2341=_0x2b4df5-_0x2d98fe,_0x2138ee=Number(_0x3531e5['totalPaidOut'])+_0x2d98fe;return await _0x337a76[_0x2f1158(0x1c8)][_0x2f1158(0x2aa)]({'where':{'id':_0x525e91},'data':{'balance':_0x2a2341,'totalPaidOut':_0x2138ee}}),console[_0x2f1158(0x29a)]('üí∞\x20Shop\x20'+_0x3531e5['username']+_0x2f1158(0x201)),console[_0x2f1158(0x29a)]('\x20\x20\x20Balance:\x20'+_0x2b4df5[_0x2f1158(0x1f9)](0x6)+_0x2f1158(0x22a)+_0x2a2341[_0x2f1158(0x1f9)](0x6)+'\x20USDT\x20(-'+_0x2d98fe[_0x2f1158(0x1f9)](0x6)+')'),console[_0x2f1158(0x29a)]('\x20\x20\x20Total\x20paid\x20out:\x20'+_0x3531e5[_0x2f1158(0x207)][_0x2f1158(0x1f9)](0x6)+_0x2f1158(0x22a)+_0x2138ee[_0x2f1158(0x1f9)](0x6)+'\x20USDT\x20(+'+_0x2d98fe['toFixed'](0x6)+')'),console[_0x2f1158(0x29a)](_0x2f1158(0x2ac)+_0x2d98fe[_0x2f1158(0x1f9)](0x6)+_0x2f1158(0x1ed)),{'payout':_0x20d2ea,'shop':_0x3531e5};});return console['log']('‚úÖ\x20Payout\x20created:\x20'+_0x3ad56a[_0x5679e3(0x1c7)]['id']+_0x5679e3(0x265)+_0x3ad56a[_0x5679e3(0x1c8)][_0x5679e3(0x256)]+'\x20('+_0x3ad56a[_0x5679e3(0x1c7)][_0x5679e3(0x294)][_0x5679e3(0x1f9)](0x6)+_0x5679e3(0x1fa)),{'id':_0x3ad56a[_0x5679e3(0x1c7)]['id'],'shopId':_0x3ad56a[_0x5679e3(0x1c7)][_0x5679e3(0x1f4)],'shopName':_0x3ad56a[_0x5679e3(0x1c8)][_0x5679e3(0x27a)],'shopUsername':_0x3ad56a['shop'][_0x5679e3(0x256)],'amount':_0x3ad56a[_0x5679e3(0x1c7)]['amount'],'network':_0x3ad56a[_0x5679e3(0x1c7)]['network'],'status':_0x3ad56a['payout'][_0x5679e3(0x1a6)],'txid':_0x3ad56a[_0x5679e3(0x1c7)][_0x5679e3(0x1d7)],'notes':_0x3ad56a[_0x5679e3(0x1c7)][_0x5679e3(0x20a)],'periodFrom':_0x3ad56a[_0x5679e3(0x1c7)][_0x5679e3(0x268)],'periodTo':_0x3ad56a['payout'][_0x5679e3(0x21d)],'createdAt':_0x3ad56a[_0x5679e3(0x1c7)][_0x5679e3(0x28c)],'paidAt':_0x3ad56a[_0x5679e3(0x1c7)][_0x5679e3(0x299)]};}async[a40_0x3f592f(0x1b3)](_0x50423e){const _0xe7509d=a40_0x3f592f,{page:_0x37384b,limit:_0x216e46,shopId:_0x1421e0,network:_0x20d506,dateFrom:_0x113850,dateTo:_0x20544c,search:_0x278fe1}=_0x50423e,_0x5753b4=(_0x37384b-0x1)*_0x216e46,_0x44973d={};_0x1421e0&&(_0x44973d[_0xe7509d(0x1f4)]=_0x1421e0);_0x20d506&&(_0x44973d[_0xe7509d(0x222)]=_0x20d506);(_0x113850||_0x20544c)&&(_0x44973d[_0xe7509d(0x28c)]={},_0x113850&&(_0x44973d[_0xe7509d(0x28c)][_0xe7509d(0x200)]=new Date(_0x113850)),_0x20544c&&(_0x44973d[_0xe7509d(0x28c)]['lte']=new Date(_0x20544c)));_0x278fe1&&(_0x44973d['OR']=[{'shop':{'name':{'contains':_0x278fe1,'mode':_0xe7509d(0x1da)}}},{'shop':{'username':{'contains':_0x278fe1,'mode':_0xe7509d(0x1da)}}},{'notes':{'contains':_0x278fe1,'mode':_0xe7509d(0x1da)}}]);const [_0x58900b,_0x1c2ef7]=await Promise[_0xe7509d(0x21a)]([database_1[_0xe7509d(0x1de)][_0xe7509d(0x1c7)]['findMany']({'where':_0x44973d,'skip':_0x5753b4,'take':_0x216e46,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0xe7509d(0x1de)][_0xe7509d(0x1c7)][_0xe7509d(0x233)]({'where':_0x44973d})]);return{'payouts':_0x58900b[_0xe7509d(0x25e)](_0x587098=>({'id':_0x587098['id'],'shopId':_0x587098[_0xe7509d(0x1f4)],'shopName':_0x587098['shop'][_0xe7509d(0x27a)],'shopUsername':_0x587098[_0xe7509d(0x1c8)][_0xe7509d(0x256)],'amount':_0x587098['amount'],'network':_0x587098['network'],'status':_0x587098[_0xe7509d(0x1a6)],'txid':_0x587098[_0xe7509d(0x1d7)],'notes':_0x587098[_0xe7509d(0x20a)],'periodFrom':_0x587098['periodFrom'],'periodTo':_0x587098['periodTo'],'createdAt':_0x587098[_0xe7509d(0x28c)],'paidAt':_0x587098['paidAt']})),'pagination':{'page':_0x37384b,'limit':_0x216e46,'total':_0x1c2ef7,'totalPages':Math[_0xe7509d(0x1aa)](_0x1c2ef7/_0x216e46)}};}async[a40_0x3f592f(0x240)](_0x1f072e){const _0x2c7156=a40_0x3f592f,_0x33aae0=await database_1[_0x2c7156(0x1de)]['payout'][_0x2c7156(0x2cb)]({'where':{'id':_0x1f072e},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x33aae0)return null;return{'id':_0x33aae0['id'],'shopId':_0x33aae0[_0x2c7156(0x1f4)],'shopName':_0x33aae0[_0x2c7156(0x1c8)][_0x2c7156(0x27a)],'shopUsername':_0x33aae0[_0x2c7156(0x1c8)]['username'],'amount':_0x33aae0[_0x2c7156(0x294)],'network':_0x33aae0[_0x2c7156(0x222)],'status':_0x33aae0[_0x2c7156(0x1a6)],'txid':_0x33aae0[_0x2c7156(0x1d7)],'notes':_0x33aae0[_0x2c7156(0x20a)],'periodFrom':_0x33aae0[_0x2c7156(0x268)],'periodTo':_0x33aae0[_0x2c7156(0x21d)],'createdAt':_0x33aae0[_0x2c7156(0x28c)],'paidAt':_0x33aae0[_0x2c7156(0x299)]};}async[a40_0x3f592f(0x29e)](_0x550ab6){const _0xbf3dd3=a40_0x3f592f;await database_1[_0xbf3dd3(0x1de)]['payout']['delete']({'where':{'id':_0x550ab6}});}async[a40_0x3f592f(0x1e2)](_0x23702c){const _0x4bfd17=a40_0x3f592f,{page:_0x4e3752,limit:_0x3c2f7f,status:_0x10ab74,gateway:_0x278e59,shopId:_0x4674b9,dateFrom:_0x2008eb,dateTo:_0x57beac,search:_0x222dab,currency:_0x273463,sortBy:_0x179405,sortOrder:_0x177ccd}=_0x23702c,_0x2e3347=(_0x4e3752-0x1)*_0x3c2f7f;console['log']('üìä\x20Getting\x20payments\x20with\x20filters:',_0x23702c);const _0x5a5a67=await database_1['default'][_0x4bfd17(0x24e)][_0x4bfd17(0x250)]({'by':['gateway'],'_count':{'gateway':!![]}});console['log']('üìä\x20Available\x20gateways\x20in\x20database:',_0x5a5a67[_0x4bfd17(0x25e)](_0x515b79=>_0x515b79[_0x4bfd17(0x2b7)]+'\x20('+_0x515b79['_count']['gateway']+'\x20payments)'));if(_0x278e59){const _0x4fa730=_0x5a5a67[_0x4bfd17(0x273)](_0x24aee2=>_0x24aee2[_0x4bfd17(0x2b7)][_0x4bfd17(0x23e)]()===_0x278e59[_0x4bfd17(0x23e)]());!_0x4fa730&&_0x278e59[_0x4bfd17(0x23e)]()!=='test_gateway'&&console[_0x4bfd17(0x29a)]('‚ö†Ô∏è\x20Requested\x20gateway\x20\x27'+_0x278e59+_0x4bfd17(0x2c2)+_0x5a5a67[_0x4bfd17(0x25e)](_0xa129d3=>_0xa129d3[_0x4bfd17(0x2b7)])[_0x4bfd17(0x2bc)](',\x20'));}const _0x3cd38d={};_0x10ab74&&(_0x3cd38d[_0x4bfd17(0x1a6)]=_0x10ab74[_0x4bfd17(0x22d)]());if(!_0x278e59)_0x3cd38d[_0x4bfd17(0x2b7)]={'not':_0x4bfd17(0x286)};else{if(_0x278e59&&(_0x278e59[_0x4bfd17(0x23e)]()==='test_gateway'||_0x278e59===_0x4bfd17(0x1e8)))_0x3cd38d['gateway']=_0x4bfd17(0x286);else{let _0x28f918=_0x278e59;const _0x25a24a=(0x0,gateway_1[_0x4bfd17(0x277)])(_0x278e59);if(_0x25a24a)_0x28f918=_0x25a24a,console[_0x4bfd17(0x29a)](_0x4bfd17(0x2de)+_0x278e59+_0x4bfd17(0x213)+_0x28f918+'\x27');else{const _0x2e23f0=(0x0,gateway_1[_0x4bfd17(0x19b)])(_0x278e59);if(_0x2e23f0){const _0x5780aa=(0x0,gateway_1[_0x4bfd17(0x277)])(_0x2e23f0);_0x5780aa&&(_0x28f918=_0x5780aa,console['log'](_0x4bfd17(0x1e3)+_0x278e59+_0x4bfd17(0x283)+_0x2e23f0+_0x4bfd17(0x210)+_0x28f918+'\x27'));}else console[_0x4bfd17(0x29a)](_0x4bfd17(0x23c)+_0x278e59+_0x4bfd17(0x2b2));}const _0x5bcfb8=await database_1[_0x4bfd17(0x1de)][_0x4bfd17(0x24e)][_0x4bfd17(0x233)]({'where':{'gateway':_0x28f918[_0x4bfd17(0x23e)]()},'take':0x1});_0x5bcfb8===0x0?(console[_0x4bfd17(0x29a)](_0x4bfd17(0x226)+_0x28f918+_0x4bfd17(0x218)+_0x278e59+_0x4bfd17(0x287)),_0x3cd38d[_0x4bfd17(0x2b7)]=_0x4bfd17(0x1e6)):(_0x3cd38d[_0x4bfd17(0x2b7)]=_0x28f918['toLowerCase'](),console[_0x4bfd17(0x29a)](_0x4bfd17(0x1d3)+_0x28f918+_0x4bfd17(0x218)+_0x278e59+'\x27)'));}}console[_0x4bfd17(0x29a)]('üìä\x20Gateway\x20filter\x20applied:',_0x3cd38d[_0x4bfd17(0x2b7)]);_0x4674b9&&(_0x3cd38d[_0x4bfd17(0x1f4)]=_0x4674b9);_0x273463&&(_0x3cd38d[_0x4bfd17(0x20d)]=_0x273463['toUpperCase'](),console[_0x4bfd17(0x29a)]('üí±\x20Currency\x20filter\x20applied:\x20'+_0x273463['toUpperCase']()));(_0x2008eb||_0x57beac)&&(_0x3cd38d[_0x4bfd17(0x28c)]={},_0x2008eb&&(_0x3cd38d[_0x4bfd17(0x28c)][_0x4bfd17(0x200)]=new Date(_0x2008eb)),_0x57beac&&(_0x3cd38d[_0x4bfd17(0x28c)][_0x4bfd17(0x1bb)]=new Date(_0x57beac)));_0x222dab&&(_0x3cd38d['OR']=[{'id':{'contains':_0x222dab,'mode':'insensitive'}},{'orderId':{'contains':_0x222dab,'mode':_0x4bfd17(0x1da)}},{'gatewayOrderId':{'contains':_0x222dab,'mode':_0x4bfd17(0x1da)}},{'customerEmail':{'contains':_0x222dab,'mode':_0x4bfd17(0x1da)}},{'shop':{'name':{'contains':_0x222dab,'mode':_0x4bfd17(0x1da)}}},{'shop':{'username':{'contains':_0x222dab,'mode':_0x4bfd17(0x1da)}}}]);console[_0x4bfd17(0x29a)]('üìä\x20Final\x20WHERE\x20conditions:',JSON[_0x4bfd17(0x1c5)](_0x3cd38d,null,0x2));let _0x505400={'createdAt':'desc'};if(_0x179405){const _0x5cb94d=['amount','createdAt','updatedAt','status',_0x4bfd17(0x2b7),_0x4bfd17(0x20d)],_0x2f9601=['asc',_0x4bfd17(0x1a7)];if(_0x5cb94d[_0x4bfd17(0x2ba)](_0x179405)){const _0x4ac3b0=_0x2f9601['includes'](_0x177ccd)?_0x177ccd:_0x4bfd17(0x1a7);_0x505400={[_0x179405]:_0x4ac3b0},console[_0x4bfd17(0x29a)](_0x4bfd17(0x2dc)+_0x179405+_0x4bfd17(0x2a1)+_0x4ac3b0+'\x20order');}}const [_0x34c72e,_0x3d0162]=await Promise[_0x4bfd17(0x21a)]([database_1[_0x4bfd17(0x1de)][_0x4bfd17(0x24e)]['findMany']({'where':_0x3cd38d,'skip':_0x2e3347,'take':_0x3c2f7f,'orderBy':_0x505400,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x4bfd17(0x1de)][_0x4bfd17(0x24e)][_0x4bfd17(0x233)]({'where':_0x3cd38d})]);return{'payments':_0x34c72e,'pagination':{'page':_0x4e3752,'limit':_0x3c2f7f,'total':_0x3d0162,'totalPages':Math['ceil'](_0x3d0162/_0x3c2f7f)}};}async[a40_0x3f592f(0x1d1)](_0x777b6b){const _0x1fe7f9=a40_0x3f592f,_0x1375c3=await database_1['default'][_0x1fe7f9(0x24e)][_0x1fe7f9(0x2cb)]({'where':{'id':_0x777b6b},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x1375c3)return null;return{'id':_0x1375c3['id'],'shopId':_0x1375c3[_0x1fe7f9(0x1f4)],'gateway':_0x1375c3[_0x1fe7f9(0x2b7)],'amount':_0x1375c3[_0x1fe7f9(0x294)],'currency':_0x1375c3['currency'],'status':_0x1375c3[_0x1fe7f9(0x1a6)],'orderId':_0x1375c3[_0x1fe7f9(0x2b8)],'gatewayOrderId':_0x1375c3[_0x1fe7f9(0x1ba)],'customerEmail':_0x1375c3[_0x1fe7f9(0x1f1)],'customerName':_0x1375c3[_0x1fe7f9(0x246)],'customerCountry':_0x1375c3[_0x1fe7f9(0x227)],'customerIp':_0x1375c3[_0x1fe7f9(0x28a)],'customerUa':_0x1375c3[_0x1fe7f9(0x214)],'failureMessage':_0x1375c3['failureMessage'],'externalPaymentUrl':_0x1375c3['externalPaymentUrl'],'successUrl':_0x1375c3['successUrl'],'failUrl':_0x1375c3[_0x1fe7f9(0x20b)],'pendingUrl':_0x1375c3[_0x1fe7f9(0x291)],'whiteUrl':_0x1375c3[_0x1fe7f9(0x234)],'createdAt':_0x1375c3[_0x1fe7f9(0x28c)],'updatedAt':_0x1375c3[_0x1fe7f9(0x276)],'shop':_0x1375c3[_0x1fe7f9(0x1c8)]};}async[a40_0x3f592f(0x2c7)](_0x50519b,_0x38e904,_0x5b4763,_0x4ddbac){const _0x15439f=a40_0x3f592f,_0x4b4cb8=await database_1[_0x15439f(0x1de)]['$transaction'](async _0x51f31e=>{const _0x31bd76=_0x15439f,_0x2490d7=await _0x51f31e[_0x31bd76(0x24e)]['findUnique']({'where':{'id':_0x50519b},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x2490d7)throw new Error(_0x31bd76(0x266));const _0xd6f473=_0x2490d7[_0x31bd76(0x1a6)],_0x5e2c0d=_0x38e904[_0x31bd76(0x22d)]();console[_0x31bd76(0x29a)](_0x31bd76(0x1ee)+_0x50519b+'\x20status:\x20'+_0xd6f473+_0x31bd76(0x22a)+_0x5e2c0d),console['log'](_0x31bd76(0x19c)+_0x2490d7[_0x31bd76(0x1c8)][_0x31bd76(0x24c)]+_0x31bd76(0x1ed));const _0x164e90={'status':_0x5e2c0d,'updatedAt':new Date(),'statusChangedBy':_0x31bd76(0x1f2),'statusChangedAt':new Date()};_0x5b4763&&(_0x164e90['adminNotes']=_0x5b4763);_0x5e2c0d==='CHARGEBACK'&&_0x4ddbac&&(_0x164e90['chargebackAmount']=_0x4ddbac);let _0x4a6de2=0x0,_0x3362a1=_0x2490d7[_0x31bd76(0x1c8)][_0x31bd76(0x24c)];if(_0x5e2c0d===_0x31bd76(0x24a)&&_0xd6f473!=='PAID'){_0x164e90[_0x31bd76(0x299)]=new Date();const _0x5b7ce0=await currencyService_1[_0x31bd76(0x275)][_0x31bd76(0x1d8)](_0x2490d7['amount'],_0x2490d7[_0x31bd76(0x20d)]);_0x164e90[_0x31bd76(0x28f)]=_0x5b7ce0;let _0x59777e=0x2d;const _0x54bc3f=await _0x51f31e[_0x31bd76(0x1c8)][_0x31bd76(0x2cb)]({'where':{'id':_0x2490d7[_0x31bd76(0x1f4)]},'select':{'gatewaySettings':!![]}});if(_0x54bc3f?.[_0x31bd76(0x1e0)])try{const _0x1bacf9=JSON[_0x31bd76(0x1d6)](_0x54bc3f[_0x31bd76(0x1e0)]);for(const [_0x42f1ba,_0x407d81]of Object[_0x31bd76(0x1a5)](_0x1bacf9)){if(_0x42f1ba[_0x31bd76(0x23e)]()===_0x2490d7[_0x31bd76(0x2b7)][_0x31bd76(0x23e)]()){_0x59777e=_0x407d81['commission']||0xa;break;}}}catch(_0x311f88){console[_0x31bd76(0x278)](_0x31bd76(0x1cc)+_0x50519b+':',_0x311f88);}let _0xcd4e63;_0x2490d7[_0x31bd76(0x2a6)]!==null&&_0x2490d7[_0x31bd76(0x2a6)]!==undefined?(_0xcd4e63=_0x2490d7[_0x31bd76(0x2a6)],console[_0x31bd76(0x29a)](_0x31bd76(0x20e)+_0xcd4e63[_0x31bd76(0x1f9)](0x6)+_0x31bd76(0x1c2)+_0x50519b)):(_0xcd4e63=_0x5b7ce0*(0x1-_0x59777e/0x64),console[_0x31bd76(0x29a)](_0x31bd76(0x1b9)+_0x50519b+':\x20'+_0x59777e+_0x31bd76(0x270)+_0x5b7ce0[_0x31bd76(0x1f9)](0x6)+'\x20USDT'),_0x164e90[_0x31bd76(0x2a6)]=_0xcd4e63,_0x164e90['gatewayCommissionRate']=_0x59777e),_0x4a6de2=_0xcd4e63,_0x3362a1+=_0xcd4e63,console['log'](_0x31bd76(0x21b)+_0x50519b+_0x31bd76(0x1b0)),console[_0x31bd76(0x29a)](_0x31bd76(0x29f)+_0x5b7ce0[_0x31bd76(0x1f9)](0x6)+'\x20USDT'),console['log'](_0x31bd76(0x2d8)+_0x2490d7[_0x31bd76(0x2b7)]+_0x31bd76(0x293)+_0x59777e+'%'),console['log']('\x20\x20\x20Merchant\x20gets:\x20'+_0xcd4e63[_0x31bd76(0x1f9)](0x6)+_0x31bd76(0x2db)+_0x59777e+_0x31bd76(0x204)),console[_0x31bd76(0x29a)](_0x31bd76(0x1db)+_0xcd4e63[_0x31bd76(0x1f9)](0x6)+'\x20USDT');}else{if(_0xd6f473===_0x31bd76(0x24a)&&_0x5e2c0d!==_0x31bd76(0x24a)&&_0x5e2c0d!==_0x31bd76(0x2d3)){if(_0x2490d7[_0x31bd76(0x28f)]){let _0x290f4a=0x2d;const _0x4ac071=await _0x51f31e[_0x31bd76(0x1c8)][_0x31bd76(0x2cb)]({'where':{'id':_0x2490d7[_0x31bd76(0x1f4)]},'select':{'gatewaySettings':!![]}});if(_0x4ac071?.[_0x31bd76(0x1e0)])try{const _0x5c5e2d=JSON[_0x31bd76(0x1d6)](_0x4ac071[_0x31bd76(0x1e0)]);for(const [_0x1c4451,_0x47ad5b]of Object['entries'](_0x5c5e2d)){if(_0x1c4451[_0x31bd76(0x23e)]()===_0x2490d7[_0x31bd76(0x2b7)][_0x31bd76(0x23e)]()){_0x290f4a=_0x47ad5b[_0x31bd76(0x219)]||0xa;break;}}}catch(_0x1d3cfe){console[_0x31bd76(0x278)](_0x31bd76(0x1cc)+_0x50519b+':',_0x1d3cfe);}const _0x2dce3e=_0x2490d7['amountUSDT']*(0x1-_0x290f4a/0x64);_0x4a6de2=-_0x2dce3e,_0x3362a1-=_0x2dce3e,console[_0x31bd76(0x29a)](_0x31bd76(0x29f)+_0x2490d7['amountUSDT'][_0x31bd76(0x1f9)](0x6)+_0x31bd76(0x1ed)),console['log'](_0x31bd76(0x2d8)+_0x2490d7[_0x31bd76(0x2b7)]+_0x31bd76(0x293)+_0x290f4a+'%'),console['log'](_0x31bd76(0x1cb)+_0x2dce3e[_0x31bd76(0x1f9)](0x6)+_0x31bd76(0x2db)+_0x290f4a+_0x31bd76(0x204)),console[_0x31bd76(0x29a)](_0x31bd76(0x1f7)+_0x2dce3e[_0x31bd76(0x1f9)](0x6)+_0x31bd76(0x1ed));}}}_0x5e2c0d===_0x31bd76(0x2d3)&&(console[_0x31bd76(0x29a)]('üí∏\x20CHARGEBACK:\x20Processing\x20penalty-only\x20deduction'),_0x4ddbac&&_0x4ddbac>0x0?(_0x4a6de2=-_0x4ddbac,_0x3362a1-=_0x4ddbac,console[_0x31bd76(0x29a)](_0x31bd76(0x247)+_0x4ddbac[_0x31bd76(0x1f9)](0x6)+_0x31bd76(0x2b6)),console['log'](_0x31bd76(0x23b))):console[_0x31bd76(0x29a)]('‚ö†Ô∏è\x20CHARGEBACK\x20without\x20penalty\x20amount\x20-\x20no\x20balance\x20change'),_0x164e90[_0x31bd76(0x2d9)]=_0x4ddbac||0x0);_0x5e2c0d==='REFUND'&&_0xd6f473===_0x31bd76(0x24a)&&console['log']('üîÑ\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance');const _0x3f4e10=await _0x51f31e[_0x31bd76(0x24e)][_0x31bd76(0x2aa)]({'where':{'id':_0x50519b},'data':_0x164e90,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x4a6de2!==0x0&&(await _0x51f31e[_0x31bd76(0x1c8)][_0x31bd76(0x2aa)]({'where':{'id':_0x2490d7['shopId']},'data':{'balance':_0x3362a1}}),console[_0x31bd76(0x29a)]('üí∞\x20Shop\x20'+_0x2490d7[_0x31bd76(0x1f4)]+_0x31bd76(0x1cf)+_0x2490d7[_0x31bd76(0x1c8)]['balance'][_0x31bd76(0x1f9)](0x6)+_0x31bd76(0x22a)+_0x3362a1[_0x31bd76(0x1f9)](0x6)+_0x31bd76(0x1ca)+(_0x4a6de2>0x0?'+':'')+_0x4a6de2[_0x31bd76(0x1f9)](0x6)+')')),_0x3f4e10;});return{'id':_0x4b4cb8['id'],'shopId':_0x4b4cb8[_0x15439f(0x1f4)],'gateway':_0x4b4cb8[_0x15439f(0x2b7)],'amount':_0x4b4cb8['amount'],'currency':_0x4b4cb8[_0x15439f(0x20d)],'status':_0x4b4cb8[_0x15439f(0x1a6)],'orderId':_0x4b4cb8[_0x15439f(0x2b8)],'gatewayOrderId':_0x4b4cb8['gatewayOrderId'],'customerEmail':_0x4b4cb8[_0x15439f(0x1f1)],'customerName':_0x4b4cb8[_0x15439f(0x246)],'customerCountry':_0x4b4cb8[_0x15439f(0x227)],'customerIp':_0x4b4cb8['customerIp'],'customerUa':_0x4b4cb8['customerUa'],'failureMessage':_0x4b4cb8[_0x15439f(0x27f)],'adminNotes':_0x4b4cb8[_0x15439f(0x19d)],'chargebackAmount':_0x4b4cb8['chargebackAmount'],'statusChangedBy':_0x4b4cb8[_0x15439f(0x2bd)],'statusChangedAt':_0x4b4cb8[_0x15439f(0x2c5)],'createdAt':_0x4b4cb8[_0x15439f(0x28c)],'updatedAt':_0x4b4cb8[_0x15439f(0x276)],'shop':_0x4b4cb8[_0x15439f(0x1c8)]};}async[a40_0x3f592f(0x2a4)](_0x3ae8b6,_0x3c8d56){const _0x2eb246=a40_0x3f592f,_0x217761=Math[_0x2eb246(0x1b4)]()[_0x2eb246(0x2d4)](0x24)[_0x2eb246(0x2bf)](0x2,0x9);console[_0x2eb246(0x29a)]('üéØ\x20updateUser\x20called\x20with\x20ID:\x20'+_0x217761+_0x2eb246(0x236)+_0x3ae8b6);const _0x54049b={..._0x3c8d56};_0x3c8d56[_0x2eb246(0x27e)]&&_0x3c8d56['password'][_0x2eb246(0x1b2)]()!==''?(console['log']('üîê\x20['+_0x217761+_0x2eb246(0x2c1)+_0x3ae8b6),_0x54049b[_0x2eb246(0x27e)]=await bcryptjs_1[_0x2eb246(0x1de)]['hash'](_0x3c8d56[_0x2eb246(0x27e)],0xc)):(console[_0x2eb246(0x29a)]('üîê\x20['+_0x217761+_0x2eb246(0x2a2)),delete _0x54049b[_0x2eb246(0x27e)]);_0x3c8d56[_0x2eb246(0x2a8)]&&(_0x54049b['name']=_0x3c8d56[_0x2eb246(0x2a8)],delete _0x54049b[_0x2eb246(0x2a8)]);_0x3c8d56['telegramId']&&(_0x54049b[_0x2eb246(0x2cf)]=_0x3c8d56[_0x2eb246(0x1b7)],delete _0x54049b[_0x2eb246(0x1b7)]);_0x3c8d56[_0x2eb246(0x1ea)]&&(_0x54049b['shopUrl']=_0x3c8d56[_0x2eb246(0x1ea)],delete _0x54049b[_0x2eb246(0x1ea)]);if(_0x3c8d56[_0x2eb246(0x20c)]){const _0x2afbad=_0x3c8d56[_0x2eb246(0x20c)][_0x2eb246(0x25e)](_0x289151=>this[_0x2eb246(0x267)](_0x289151));console[_0x2eb246(0x29a)]('üîÑ\x20Gateway\x20mapping:',_0x3c8d56[_0x2eb246(0x20c)],'->',_0x2afbad),_0x54049b[_0x2eb246(0x1cd)]=JSON[_0x2eb246(0x1c5)](_0x2afbad),delete _0x54049b[_0x2eb246(0x20c)];}_0x3c8d56[_0x2eb246(0x1e0)]&&(console[_0x2eb246(0x29a)](_0x2eb246(0x295)+_0x217761+_0x2eb246(0x25b),_0x3c8d56[_0x2eb246(0x1e0)]),_0x54049b[_0x2eb246(0x1e0)]=JSON['stringify'](_0x3c8d56['gatewaySettings']),console[_0x2eb246(0x29a)]('üîß\x20['+_0x217761+_0x2eb246(0x22c),_0x54049b['gatewaySettings']));_0x3c8d56['wallets']&&(_0x3c8d56[_0x2eb246(0x1bf)]['usdtPolygonWallet']!==undefined&&(_0x54049b[_0x2eb246(0x292)]=_0x3c8d56['wallets']['usdtPolygonWallet']||null),_0x3c8d56[_0x2eb246(0x1bf)][_0x2eb246(0x262)]!==undefined&&(_0x54049b[_0x2eb246(0x262)]=_0x3c8d56[_0x2eb246(0x1bf)]['usdtTrcWallet']||null),_0x3c8d56[_0x2eb246(0x1bf)][_0x2eb246(0x1a2)]!==undefined&&(_0x54049b['usdtErcWallet']=_0x3c8d56['wallets'][_0x2eb246(0x1a2)]||null),_0x3c8d56[_0x2eb246(0x1bf)]['usdcPolygonWallet']!==undefined&&(_0x54049b['usdcPolygonWallet']=_0x3c8d56['wallets'][_0x2eb246(0x2b0)]||null),delete _0x54049b[_0x2eb246(0x1bf)]);const _0x17c6b7=await database_1['default'][_0x2eb246(0x1c8)][_0x2eb246(0x2aa)]({'where':{'id':_0x3ae8b6},'data':_0x54049b,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console['log'](_0x2eb246(0x1a8)+_0x217761+_0x2eb246(0x1b6),_0x17c6b7[_0x2eb246(0x1e0)]),{'id':_0x17c6b7['id'],'fullName':_0x17c6b7['name'],'username':_0x17c6b7[_0x2eb246(0x256)],'telegramId':_0x17c6b7['telegram'],'merchantUrl':_0x17c6b7['shopUrl'],'gateways':_0x17c6b7['paymentGateways']?JSON[_0x2eb246(0x1d6)](_0x17c6b7[_0x2eb246(0x1cd)]):null,'gatewaySettings':_0x17c6b7[_0x2eb246(0x1e0)]?JSON['parse'](_0x17c6b7[_0x2eb246(0x1e0)]):null,'publicKey':_0x17c6b7['publicKey'],'wallets':{'usdtPolygonWallet':_0x17c6b7[_0x2eb246(0x292)],'usdtTrcWallet':_0x17c6b7['usdtTrcWallet'],'usdtErcWallet':_0x17c6b7[_0x2eb246(0x1a2)],'usdcPolygonWallet':_0x17c6b7[_0x2eb246(0x2b0)]},'status':_0x17c6b7[_0x2eb246(0x1a6)],'createdAt':_0x17c6b7[_0x2eb246(0x28c)]};}async[a40_0x3f592f(0x1a9)](_0x377142){const _0x277c68=a40_0x3f592f,_0x135a4d=await database_1[_0x277c68(0x1de)]['shop']['update']({'where':{'id':_0x377142},'data':{'status':_0x277c68(0x2b9)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x135a4d['id'],'fullName':_0x135a4d[_0x277c68(0x27a)],'username':_0x135a4d[_0x277c68(0x256)],'telegramId':_0x135a4d[_0x277c68(0x2cf)],'merchantUrl':_0x135a4d[_0x277c68(0x29d)],'gateways':_0x135a4d['paymentGateways']?JSON['parse'](_0x135a4d[_0x277c68(0x1cd)]):null,'gatewaySettings':_0x135a4d[_0x277c68(0x1e0)]?JSON['parse'](_0x135a4d[_0x277c68(0x1e0)]):null,'publicKey':_0x135a4d['publicKey'],'wallets':{'usdtPolygonWallet':_0x135a4d[_0x277c68(0x292)],'usdtTrcWallet':_0x135a4d[_0x277c68(0x262)],'usdtErcWallet':_0x135a4d['usdtErcWallet'],'usdcPolygonWallet':_0x135a4d[_0x277c68(0x2b0)]},'status':_0x135a4d[_0x277c68(0x1a6)],'createdAt':_0x135a4d[_0x277c68(0x28c)]};}async[a40_0x3f592f(0x1fc)](_0x517f57){const _0x184e58=a40_0x3f592f,_0x4b3494=await database_1[_0x184e58(0x1de)][_0x184e58(0x1c8)]['update']({'where':{'id':_0x517f57},'data':{'status':_0x184e58(0x2ce)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4b3494['id'],'fullName':_0x4b3494['name'],'username':_0x4b3494[_0x184e58(0x256)],'telegramId':_0x4b3494[_0x184e58(0x2cf)],'merchantUrl':_0x4b3494['shopUrl'],'gateways':_0x4b3494[_0x184e58(0x1cd)]?JSON['parse'](_0x4b3494['paymentGateways']):null,'gatewaySettings':_0x4b3494[_0x184e58(0x1e0)]?JSON[_0x184e58(0x1d6)](_0x4b3494[_0x184e58(0x1e0)]):null,'publicKey':_0x4b3494[_0x184e58(0x282)],'wallets':{'usdtPolygonWallet':_0x4b3494['usdtPolygonWallet'],'usdtTrcWallet':_0x4b3494[_0x184e58(0x262)],'usdtErcWallet':_0x4b3494[_0x184e58(0x1a2)],'usdcPolygonWallet':_0x4b3494[_0x184e58(0x2b0)]},'status':_0x4b3494[_0x184e58(0x1a6)],'createdAt':_0x4b3494[_0x184e58(0x28c)]};}async[a40_0x3f592f(0x24d)](_0x2196e2){const _0x5a33f2=a40_0x3f592f,{page:_0x5bf147,limit:_0x1d9568,status:_0x5337f3}=_0x2196e2,_0x283494=(_0x5bf147-0x1)*_0x1d9568,_0x325ef7={};_0x5337f3&&(_0x325ef7[_0x5a33f2(0x1a6)]=_0x5337f3[_0x5a33f2(0x22d)]());const [_0x2b3813,_0x1a325e]=await Promise[_0x5a33f2(0x21a)]([database_1[_0x5a33f2(0x1de)][_0x5a33f2(0x1c8)][_0x5a33f2(0x1c6)]({'where':_0x325ef7,'skip':_0x283494,'take':_0x1d9568,'orderBy':{'createdAt':_0x5a33f2(0x1a7)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x5a33f2(0x1de)][_0x5a33f2(0x1c8)][_0x5a33f2(0x233)]({'where':_0x325ef7})]);return{'users':_0x2b3813['map'](_0x1ea468=>{const _0x2b0d89=_0x5a33f2,_0x3c4e41=_0x1ea468[_0x2b0d89(0x1cd)]?JSON['parse'](_0x1ea468['paymentGateways']):null,_0x310f03=_0x3c4e41?_0x3c4e41[_0x2b0d89(0x25e)](_0x518f28=>this[_0x2b0d89(0x274)](_0x518f28)):null;return{'id':_0x1ea468['id'],'fullName':_0x1ea468[_0x2b0d89(0x27a)],'username':_0x1ea468[_0x2b0d89(0x256)],'telegramId':_0x1ea468['telegram'],'merchantUrl':_0x1ea468['shopUrl'],'gateways':_0x310f03,'gatewaySettings':_0x1ea468[_0x2b0d89(0x1e0)]?JSON[_0x2b0d89(0x1d6)](_0x1ea468[_0x2b0d89(0x1e0)]):null,'publicKey':_0x1ea468[_0x2b0d89(0x282)],'wallets':{'usdtPolygonWallet':_0x1ea468['usdtPolygonWallet'],'usdtTrcWallet':_0x1ea468[_0x2b0d89(0x262)],'usdtErcWallet':_0x1ea468[_0x2b0d89(0x1a2)],'usdcPolygonWallet':_0x1ea468['usdcPolygonWallet']},'status':_0x1ea468[_0x2b0d89(0x1a6)],'createdAt':_0x1ea468[_0x2b0d89(0x28c)]};}),'pagination':{'page':_0x5bf147,'limit':_0x1d9568,'total':_0x1a325e,'totalPages':Math[_0x5a33f2(0x1aa)](_0x1a325e/_0x1d9568)}};}async['getUserById'](_0x110a7b){const _0x478fe3=a40_0x3f592f,_0xd1ca3b=await database_1['default'][_0x478fe3(0x1c8)][_0x478fe3(0x2cb)]({'where':{'id':_0x110a7b},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0xd1ca3b)return null;const _0x2d474c=_0xd1ca3b[_0x478fe3(0x1cd)]?JSON[_0x478fe3(0x1d6)](_0xd1ca3b['paymentGateways']):null,_0x6bef1c=_0x2d474c?_0x2d474c['map'](_0x31cf42=>this[_0x478fe3(0x274)](_0x31cf42)):null;return _0x2d474c&&_0x6bef1c&&console['log']('üîÑ\x20Gateway\x20mapping\x20(get):',_0x2d474c,'->',_0x6bef1c),{'id':_0xd1ca3b['id'],'fullName':_0xd1ca3b[_0x478fe3(0x27a)],'username':_0xd1ca3b[_0x478fe3(0x256)],'telegramId':_0xd1ca3b['telegram'],'merchantUrl':_0xd1ca3b[_0x478fe3(0x29d)],'gateways':_0x6bef1c,'gatewaySettings':_0xd1ca3b[_0x478fe3(0x1e0)]?JSON[_0x478fe3(0x1d6)](_0xd1ca3b[_0x478fe3(0x1e0)]):null,'publicKey':_0xd1ca3b[_0x478fe3(0x282)],'wallets':{'usdtPolygonWallet':_0xd1ca3b[_0x478fe3(0x292)],'usdtTrcWallet':_0xd1ca3b[_0x478fe3(0x262)],'usdtErcWallet':_0xd1ca3b[_0x478fe3(0x1a2)],'usdcPolygonWallet':_0xd1ca3b['usdcPolygonWallet']},'status':_0xd1ca3b[_0x478fe3(0x1a6)],'createdAt':_0xd1ca3b[_0x478fe3(0x28c)]};}async[a40_0x3f592f(0x290)](_0x1ff7f6){const _0x4914bf=a40_0x3f592f,{fullName:_0x58c00c,username:_0x4b3f91,password:_0x55d371,telegramId:_0x4393d9,merchantUrl:_0x49bdc3,gateways:_0x385a43,gatewaySettings:_0x28962d,wallets:_0x32aae1}=_0x1ff7f6,_0x2b88f8=await database_1['default']['shop'][_0x4914bf(0x2cb)]({'where':{'username':_0x4b3f91}});if(_0x2b88f8)throw new Error(_0x4914bf(0x206));if(_0x4393d9){const _0xbf0e9a=await database_1[_0x4914bf(0x1de)][_0x4914bf(0x1c8)][_0x4914bf(0x2cb)]({'where':{'telegram':_0x4393d9}});if(_0xbf0e9a)throw new Error('Telegram\x20username\x20already\x20exists');}const _0x312676=await bcryptjs_1[_0x4914bf(0x1de)]['hash'](_0x55d371,0xc),_0x135801='pk_'+crypto_1[_0x4914bf(0x1de)][_0x4914bf(0x212)](0x20)[_0x4914bf(0x2d4)](_0x4914bf(0x27c)),_0x27ec8a=_0x4914bf(0x1f3)+crypto_1['default'][_0x4914bf(0x212)](0x20)[_0x4914bf(0x2d4)](_0x4914bf(0x27c)),_0x11ccbd=_0x385a43?_0x385a43['map'](_0x34c3c1=>this[_0x4914bf(0x267)](_0x34c3c1)):null;_0x385a43&&_0x11ccbd&&console[_0x4914bf(0x29a)](_0x4914bf(0x26b),_0x385a43,'->',_0x11ccbd);const _0x34c28f=await database_1[_0x4914bf(0x1de)][_0x4914bf(0x1c8)][_0x4914bf(0x251)]({'data':{'name':_0x58c00c,'username':_0x4b3f91,'password':_0x312676,'telegram':_0x4393d9,'shopUrl':_0x49bdc3,'paymentGateways':_0x11ccbd?JSON[_0x4914bf(0x1c5)](_0x11ccbd):null,'gatewaySettings':_0x28962d?JSON[_0x4914bf(0x1c5)](_0x28962d):null,'usdtPolygonWallet':_0x32aae1?.[_0x4914bf(0x292)]||null,'usdtTrcWallet':_0x32aae1?.['usdtTrcWallet']||null,'usdtErcWallet':_0x32aae1?.[_0x4914bf(0x1a2)]||null,'usdcPolygonWallet':_0x32aae1?.[_0x4914bf(0x2b0)]||null,'publicKey':_0x135801,'secretKey':_0x27ec8a,'status':_0x4914bf(0x2ce)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x34c28f['id'],'fullName':_0x34c28f[_0x4914bf(0x27a)],'username':_0x34c28f[_0x4914bf(0x256)],'telegramId':_0x34c28f[_0x4914bf(0x2cf)],'merchantUrl':_0x34c28f[_0x4914bf(0x29d)],'gateways':_0x34c28f[_0x4914bf(0x1cd)]?JSON[_0x4914bf(0x1d6)](_0x34c28f['paymentGateways']):null,'gatewaySettings':_0x34c28f[_0x4914bf(0x1e0)]?JSON['parse'](_0x34c28f[_0x4914bf(0x1e0)]):null,'publicKey':_0x34c28f[_0x4914bf(0x282)],'wallets':{'usdtPolygonWallet':_0x34c28f[_0x4914bf(0x292)],'usdtTrcWallet':_0x34c28f[_0x4914bf(0x262)],'usdtErcWallet':_0x34c28f[_0x4914bf(0x1a2)],'usdcPolygonWallet':_0x34c28f[_0x4914bf(0x2b0)]},'status':_0x34c28f[_0x4914bf(0x1a6)],'createdAt':_0x34c28f[_0x4914bf(0x28c)]};}async[a40_0x3f592f(0x1fb)](_0x4a66ec){const _0x167ba4=a40_0x3f592f;await database_1[_0x167ba4(0x1de)][_0x167ba4(0x1c8)][_0x167ba4(0x1c4)]({'where':{'id':_0x4a66ec}});}[a40_0x3f592f(0x1a3)](_0xb8994f,_0x341599,_0x127630){const _0x589aca=a40_0x3f592f,_0x4e17d1=new Map(),_0x56de8e=new Date(_0x341599);while(_0x56de8e<=_0x127630){const _0x32502b=_0x56de8e[_0x589aca(0x2a9)]()[_0x589aca(0x25d)]('T')[0x0];_0x4e17d1[_0x589aca(0x1d9)](_0x32502b,{'revenue':0x0,'count':0x0}),_0x56de8e['setDate'](_0x56de8e['getDate']()+0x1);}for(const _0x3a152d of _0xb8994f){const _0x413c8f=_0x3a152d[_0x589aca(0x28c)][_0x589aca(0x2a9)]()[_0x589aca(0x25d)]('T')[0x0],_0x14b047=_0x4e17d1[_0x589aca(0x2d1)](_0x413c8f);_0x14b047&&(_0x14b047[_0x589aca(0x233)]+=0x1,_0x3a152d[_0x589aca(0x1a6)]===_0x589aca(0x24a)&&(_0x3a152d[_0x589aca(0x28f)]?_0x14b047[_0x589aca(0x2b3)]+=_0x3a152d['amountUSDT']:console[_0x589aca(0x29a)](_0x589aca(0x231)+_0x3a152d['id']+_0x589aca(0x1fd))));}const _0x42b7b7=[],_0x34b77f=[];for(const [_0x1a0240,_0x49ae64]of _0x4e17d1){_0x42b7b7[_0x589aca(0x1ac)]({'date':_0x1a0240,'amount':Math[_0x589aca(0x23d)](_0x49ae64['revenue']*0x64)/0x64}),_0x34b77f[_0x589aca(0x1ac)]({'date':_0x1a0240,'count':_0x49ae64[_0x589aca(0x233)]});}return{'dailyRevenue':_0x42b7b7,'dailyPayments':_0x34b77f};}}exports[a40_0x3f592f(0x239)]=AdminService;