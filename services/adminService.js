'use strict';const a35_0x495033=a35_0xf6df;(function(_0x3e9ed6,_0x3f8230){const _0x90dccd=a35_0xf6df,_0x3f180b=_0x3e9ed6();while(!![]){try{const _0x26aad0=-parseInt(_0x90dccd(0x1f3))/0x1*(-parseInt(_0x90dccd(0x200))/0x2)+-parseInt(_0x90dccd(0x1ad))/0x3*(-parseInt(_0x90dccd(0x1c3))/0x4)+parseInt(_0x90dccd(0x1fd))/0x5*(-parseInt(_0x90dccd(0x1ac))/0x6)+-parseInt(_0x90dccd(0x128))/0x7+-parseInt(_0x90dccd(0x21a))/0x8*(parseInt(_0x90dccd(0x15f))/0x9)+parseInt(_0x90dccd(0x175))/0xa+-parseInt(_0x90dccd(0x124))/0xb*(parseInt(_0x90dccd(0x117))/0xc);if(_0x26aad0===_0x3f8230)break;else _0x3f180b['push'](_0x3f180b['shift']());}catch(_0x57e660){_0x3f180b['push'](_0x3f180b['shift']());}}}(a35_0x1c5e,0x99e83));var __importDefault=this&&this[a35_0x495033(0x17a)]||function(_0xa1f0a7){const _0x41ea8e=a35_0x495033;return _0xa1f0a7&&_0xa1f0a7[_0x41ea8e(0x1f6)]?_0xa1f0a7:{'default':_0xa1f0a7};};Object[a35_0x495033(0x14c)](exports,a35_0x495033(0x1f6),{'value':!![]}),exports[a35_0x495033(0x172)]=void 0x0;function a35_0x1c5e(){const _0x40c1c9=['generateDailyStatistics','\x20no\x20longer\x20PAID:','telegram','üí∞\x20Current\x20shop\x20balance:\x20','Rapyd','23352mkKluA','default','includes','deletePayout','dateFrom','randomBytes','../types/gateway','publicKey','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','Shop\x20not\x20found','usdcPolygonWallet','Plisio','totalPayout','payout','üí∞\x20Shop\x20','getAllUsers','‚ö†Ô∏è\x20Gateway\x20\x27','name','CHARGEBACK','averageCheckUSDT','password','üí∏\x20CHARGEBACK:\x20Merchant\x20amount\x20already\x20deducted\x20from\x20balance','gte','üîÑ\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','insensitive','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','\x20USDT','klyme_de','paymentGateways','parse','some','\x20USDT\x20from\x20balance','MasterCard','\x20USDT\x20(same\x20as\x20awaiting)','Payment\x20not\x20found','getUserById','turnoverUSDT','\x20\x20\x20üîç\x20Calculated\x20after\x20commission:\x20','findFirst','üîß\x20[','Noda','12bQcXeA','create','_count','\x20\x20\x20üåç\x20Country:\x20','polygon','commission','getGatewayInternalName','dateTo','payment','balance','pk_','‚úÖ\x20Payout\x20created:\x20','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','386089xhazgk','‚úÖ\x20Customer\x20data\x20updated\x20for\x20payment\x20','merchantEarnings','findMany','7519071SovSPE','admin','gatewayEarnings','push','\x20USDT)','ceil','whiteUrl','updatedAt','90d','klyme_gb','üìä\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','\x20status:\x20','\x20\x20\x20üñ•Ô∏è\x20User\x20Agent:\x20','rapyd','\x20USDT\x20(+','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','üìä\x20Sorting\x20payments\x20by\x20','%\x20commission)',']\x20Gateway\x20settings\x20JSON\x20string:','lte','getMonth','üìä\x20Calculating\x20payout\x20statistics...','customerCountry','usdtTrcWallet','revenue','totalPaidOut','NONEXISTENT_GATEWAY_FILTER','setDate','\x27\x20not\x20found.\x20Available\x20gateways:\x20','üìä\x20Total\x20payments\x20(including\x20failed):\x20','forEach','reduce','\x20USDT\x20(gross\x20revenue)','Error\x20processing\x20payment\x20','periodTo','externalPaymentUrl','defineProperty','\x20balance\x20updated:\x20','getMerchantStatistics','üîÑ\x20Updating\x20customer\x20data\x20for\x20payment\x20','count','\x20\x20\x20Gateway:\x20','amountUSDT','shop','KLYME\x20DE','availableBalance',',\x20userId:\x20','merchantUrl','failureMessage','usdtErcWallet','\x20paid\x20payments\x20for\x20analysis','entries','length','\x20\x20\x20Transaction\x20hash:\x20','notes','2169VmxqEV','polygon_usdc','successUrl','üí∞\x20Found\x20','customerEmail','status','week','\x20order','üí∞\x20Payment\x20','orderId','random','not\x20set','customerName','periodFrom','\x27\x20->\x20name\x20\x27','\x20\x20\x20Subtracted\x20from\x20balance:\x20-',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','network','summary','AdminService','\x20\x20\x20Merchant\x20gets:\x20','adminNotes','11599920Eldjam','map','getFullYear','username','totalAmountUSDT','__importDefault','üîÑ\x20Gateway\x20mapping\x20(get):','wallets','updateCustomerData','üîÑ\x20Gateway\x20mapping\x20(create):','\x20\x20\x20Full\x20amount:\x20','pendingUrl','get','test_gateway','all','sort','üìä\x20Payout\x20statistics\x20calculated:','updatePaymentStatus','üí≥\x20Payout\x20wallet\x20for\x20','\x20\x20\x20Total\x20paid\x20out:\x20','merchantEarningsUSDT','gateway','amount','createdAt','_sum','toString','noda','totalAmountAfterCommissionUSDT','stringify','COMPLETED','üí∞\x20[PAYOUT]\x20Gateway\x20','Open\x20Banking\x202','\x20USDT\x20(after\x20payouts)','\x20\x20\x20üí∏\x20Total\x20payouts\x20(all\x20time):\x20','averageCommissionRate','‚ö†Ô∏è\x20Requested\x20gateway\x20\x27','toISOString','getMerchantsSelection','telegramId','Username\x20already\x20exists','\x20\x20\x20üìÖ\x20This\x20month:\x20','\x27\x20to\x20name\x20\x27','\x20USDT\x20(actual\x20balances)','üìÖ\x20Period:\x20','aggregate','üí±\x20Currency\x20filter\x20applied:\x20','period','fullName','üìä\x20Merchant\x20statistics\x20calculated:','\x20\x20\x20‚úÖ\x20Actual\x20available\x20balance:\x20','\x20\x20\x20Payout\x20amount:\x20','2020-01-01','\x20PAID\x20payments','toFixed','gatewaySettings','234918dblXtx','12663MHqDZC','custom','delete','toLowerCase','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','\x20\x20\x20Balance:\x20','Test\x20Gateway','KLYME\x20EU','\x20\x20\x20‚úÖ\x20Total\x20available\x20for\x20payout:\x20','toUpperCase','REFUND','\x20USDT\x20(','customerUa','gateways','hex','convertToUSDT','üìä\x20Getting\x20merchant\x20statistics\x20with\x20filters:','join','customerIp','üéØ\x20updateUser\x20called\x20with\x20ID:\x20','split','createUser','308AUiwno',',\x20successful:\x20','values','‚ö†Ô∏è\x20Payment\x20','30d','\x20USDT\x20(after\x20','paidAt','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','\x20USDT\x20(-','month','shopId','paymentsCount','üìÖ\x20Period\x20\x27all\x27:\x20Using\x20start\x20date\x20from\x20first\x20payment:\x20','getPayoutById','txid','year','üí∞\x20Creating\x20payout\x20for\x20shop\x20','klyme_eu','getMerchantsAwaitingPayout','sk_','commissionUSDT','./currencyService','usdtPolygonWallet','paidOutUSDT','erc20','plisio','üìã\x20Getting\x20merchants\x20selection\x20list...','üîÑ\x20Gateway\x20mapping:','SUSPENDED','üìä\x20Final\x20WHERE\x20conditions:',':\x20commission\x20=\x20','totalCommissionRate','ACTIVE',',\x20Commission:\x20','PAID','currencyService','‚úÖ\x20Using\x20gateway\x20filter:\x20\x27','findUnique','date','\x20->\x20','getGatewayDisplayName','\x20\x20\x20Merchant\x20loses:\x20','\x20for\x20shop\x20','update','round','getGatewayIdByName','shopUrl','log','8xAzCBJ','üìä\x20Gateway\x20filter\x20applied:','error','__esModule','Insufficient\x20balance.\x20Available:\x20','createPayout','\x20\x20\x20üë§\x20Merchant\x20earnings:\x20','turnover','\x20merchants\x20with\x20positive\x20balance','chargebackAmount','15HGDxMF','\x20to\x20','groupBy','268896SDBfhg','cointopay2','desc','deleteUser','getTime','thisMonth','not\x20specified','getDate','\x20\x20\x20üè™\x20Gateway\x20earnings:\x20','asc','\x20in\x20','\x20active\x20merchants\x20for\x20selection','../config/database','set','\x20\x20\x20Current\x20balance:\x20','Telegram\x20username\x20already\x20exists','gatewayOrderId','$transaction','bcryptjs','currency','CoinToPay'];a35_0x1c5e=function(){return _0x40c1c9;};return a35_0x1c5e();}const database_1=__importDefault(require(a35_0x495033(0x20c))),bcryptjs_1=__importDefault(require(a35_0x495033(0x212))),crypto_1=__importDefault(require('crypto')),currencyService_1=require(a35_0x495033(0x1d8)),gateway_1=require(a35_0x495033(0x220));function a35_0xf6df(_0x3a7884,_0x168ae7){const _0x1c5ec9=a35_0x1c5e();return a35_0xf6df=function(_0xf6dfc3,_0x1510dc){_0xf6dfc3=_0xf6dfc3-0x109;let _0x448feb=_0x1c5ec9[_0xf6dfc3];return _0x448feb;},a35_0xf6df(_0x3a7884,_0x168ae7);}class AdminService{async['getPayoutStats'](){const _0x149d4a=a35_0x495033;console[_0x149d4a(0x1f2)](_0x149d4a(0x13d));const _0x11652b=await database_1['default']['shop'][_0x149d4a(0x1a1)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x149d4a(0x1e3)}}),_0x43ceef=await this[_0x149d4a(0x1d5)]({'page':0x1,'limit':0x3e8}),_0x938762=await database_1[_0x149d4a(0x21b)][_0x149d4a(0x11f)]['count']({'where':{'status':_0x149d4a(0x1e5),'gateway':{'not':'test_gateway'}}}),_0x3022fe=new Date(),_0x508f7f=new Date(_0x3022fe[_0x149d4a(0x177)](),_0x3022fe[_0x149d4a(0x13c)](),0x1),_0x24133f=new Date(_0x3022fe[_0x149d4a(0x177)](),_0x3022fe['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x365b54=await database_1[_0x149d4a(0x21b)][_0x149d4a(0x227)][_0x149d4a(0x1a1)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x508f7f,'lte':_0x24133f},'status':'COMPLETED'}}),_0x155b29=_0x11652b[_0x149d4a(0x18d)][_0x149d4a(0x141)]||0x0,_0x4e8b8f=_0x43ceef[_0x149d4a(0x171)][_0x149d4a(0x190)],_0xf6bc40=_0x365b54[_0x149d4a(0x18d)]['amount']||0x0,_0x25eb35={'totalPayout':Math[_0x149d4a(0x1ef)](_0x155b29*0x64)/0x64,'awaitingPayout':Math['round'](_0x4e8b8f*0x64)/0x64,'thisMonth':Math[_0x149d4a(0x1ef)](_0xf6bc40*0x64)/0x64,'availableBalance':Math[_0x149d4a(0x1ef)](_0x4e8b8f*0x64)/0x64,'totalPayments':_0x938762};return console[_0x149d4a(0x1f2)](_0x149d4a(0x185)),console[_0x149d4a(0x1f2)]('\x20\x20\x20üí∞\x20Total\x20payout:\x20'+_0x25eb35[_0x149d4a(0x226)]+'\x20USDT\x20(total\x20paid\x20to\x20merchants)'),console[_0x149d4a(0x1f2)]('\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20'+_0x25eb35['awaitingPayout']+'\x20USDT\x20(with\x20commission\x20deducted)'),console[_0x149d4a(0x1f2)]('\x20\x20\x20üíµ\x20Available\x20balance:\x20'+_0x25eb35[_0x149d4a(0x155)]+_0x149d4a(0x10f)),console[_0x149d4a(0x1f2)](_0x149d4a(0x19d)+_0x25eb35['thisMonth']+_0x149d4a(0x234)),console[_0x149d4a(0x1f2)]('\x20\x20\x20üí≥\x20Total\x20payments:\x20'+_0x25eb35['totalPayments']+_0x149d4a(0x1a9)),console[_0x149d4a(0x1f2)]('\x20\x20\x20üîç\x20Raw\x20balance\x20sum:\x20'+(_0x11652b[_0x149d4a(0x18d)][_0x149d4a(0x120)]||0x0)[_0x149d4a(0x1aa)](0x2)+'\x20USDT\x20(without\x20commission)'),console[_0x149d4a(0x1f2)]('\x20\x20\x20üìä\x20Commission\x20difference:\x20'+((_0x11652b[_0x149d4a(0x18d)][_0x149d4a(0x120)]||0x0)-_0x4e8b8f)[_0x149d4a(0x1aa)](0x2)+'\x20USDT'),_0x25eb35;}async[a35_0x495033(0x17d)](_0xb75294,_0x4abf6d){const _0x56e51d=a35_0x495033;console[_0x56e51d(0x1f2)](_0x56e51d(0x14f)+_0xb75294+':',_0x4abf6d);const _0x223fc9=await database_1[_0x56e51d(0x21b)][_0x56e51d(0x11f)][_0x56e51d(0x1e8)]({'where':{'id':_0xb75294},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x223fc9)throw new Error(_0x56e51d(0x110));const _0x4c6dde={};_0x4abf6d[_0x56e51d(0x13e)]!==undefined&&(_0x4c6dde[_0x56e51d(0x13e)]=_0x4abf6d[_0x56e51d(0x13e)]||null);_0x4abf6d['customerIp']!==undefined&&(_0x4c6dde['customerIp']=_0x4abf6d[_0x56e51d(0x1bf)]||null);_0x4abf6d[_0x56e51d(0x1b9)]!==undefined&&(_0x4c6dde['customerUa']=_0x4abf6d[_0x56e51d(0x1b9)]||null);const _0x45282f=await database_1['default'][_0x56e51d(0x11f)]['update']({'where':{'id':_0xb75294},'data':{..._0x4c6dde,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x56e51d(0x1f2)](_0x56e51d(0x125)+_0xb75294),console[_0x56e51d(0x1f2)](_0x56e51d(0x11a)+_0x223fc9[_0x56e51d(0x13e)]+_0x56e51d(0x1ea)+_0x45282f[_0x56e51d(0x13e)]),console[_0x56e51d(0x1f2)]('\x20\x20\x20üåê\x20IP:\x20'+_0x223fc9['customerIp']+_0x56e51d(0x1ea)+_0x45282f[_0x56e51d(0x1bf)]),console[_0x56e51d(0x1f2)](_0x56e51d(0x134)+(_0x223fc9['customerUa']?_0x56e51d(0x20d):_0x56e51d(0x16a))+'\x20->\x20'+(_0x45282f[_0x56e51d(0x1b9)]?_0x56e51d(0x20d):_0x56e51d(0x16a))),_0x45282f;}async['getSystemStatistics'](_0x6b3b30){const _0x4211ce=a35_0x495033,_0x441105=new Date();let _0x26f819;switch(_0x6b3b30){case'7d':_0x26f819=new Date(_0x441105[_0x4211ce(0x204)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x4211ce(0x1c7):_0x26f819=new Date(_0x441105['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x4211ce(0x130):_0x26f819=new Date(_0x441105['getTime']()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x4211ce(0x183):const _0x33f31c=await database_1[_0x4211ce(0x21b)][_0x4211ce(0x11f)][_0x4211ce(0x114)]({'where':{'gateway':{'not':_0x4211ce(0x182)}},'orderBy':{'createdAt':_0x4211ce(0x209)},'select':{'createdAt':!![]}});_0x26f819=_0x33f31c?_0x33f31c[_0x4211ce(0x18c)]:new Date(_0x4211ce(0x1a8)),console['log'](_0x4211ce(0x1cf)+_0x26f819[_0x4211ce(0x199)]());break;default:_0x26f819=new Date(_0x441105[_0x4211ce(0x204)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x54b060,_0x10d629,_0x3c4291,_0x4580af,_0x52a8f3,_0x1a4cff,_0x266a9e]=await Promise[_0x4211ce(0x183)]([database_1['default'][_0x4211ce(0x153)][_0x4211ce(0x150)](),database_1[_0x4211ce(0x21b)][_0x4211ce(0x153)]['count']({'where':{'status':_0x4211ce(0x1e3)}}),database_1[_0x4211ce(0x21b)]['payment'][_0x4211ce(0x150)]({'where':{'createdAt':{'gte':_0x26f819},'gateway':{'not':'test_gateway'}}}),database_1['default'][_0x4211ce(0x11f)][_0x4211ce(0x150)]({'where':{'status':_0x4211ce(0x1e5),'createdAt':{'gte':_0x26f819},'gateway':{'not':_0x4211ce(0x182)}}}),database_1['default']['payment'][_0x4211ce(0x127)]({'where':{'status':_0x4211ce(0x1e5),'createdAt':{'gte':_0x26f819},'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![]}}),database_1[_0x4211ce(0x21b)]['payment'][_0x4211ce(0x127)]({'where':{'gateway':{'not':_0x4211ce(0x182)}},'take':0xa,'orderBy':{'createdAt':_0x4211ce(0x202)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x4211ce(0x21b)][_0x4211ce(0x11f)][_0x4211ce(0x127)]({'where':{'createdAt':{'gte':_0x26f819},'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x37b966=0x0;for(const _0x534157 of _0x52a8f3){const _0x78eed1=await currencyService_1['currencyService'][_0x4211ce(0x1bc)](_0x534157[_0x4211ce(0x18b)],_0x534157['currency']);_0x37b966+=_0x78eed1;}const _0x5beace=this['generateDailyStatistics'](_0x266a9e,_0x26f819,_0x441105),_0x1abeb4=_0x3c4291>0x0?_0x4580af/_0x3c4291*0x64:0x0;return{'totalShops':_0x54b060,'activeShops':_0x10d629,'totalPayments':_0x3c4291,'successfulPayments':_0x4580af,'totalRevenue':Math[_0x4211ce(0x1ef)](_0x37b966*0x64)/0x64,'conversionRate':Math[_0x4211ce(0x1ef)](_0x1abeb4*0x64)/0x64,'dailyRevenue':_0x5beace['dailyRevenue'],'dailyPayments':_0x5beace['dailyPayments'],'recentPayments':_0x1a4cff[_0x4211ce(0x176)](_0x105236=>({'id':_0x105236['id'],'amount':_0x105236['amount'],'currency':_0x105236[_0x4211ce(0x213)],'status':_0x105236['status'],'gateway':_0x105236['gateway'],'shop':_0x105236[_0x4211ce(0x153)],'createdAt':_0x105236[_0x4211ce(0x18c)]}))};}async[a35_0x495033(0x14e)](_0x32a6a1){const _0x3bf4ae=a35_0x495033;console[_0x3bf4ae(0x1f2)](_0x3bf4ae(0x1bd),_0x32a6a1);let _0x5d9728,_0xec55ce=new Date();if(_0x32a6a1[_0x3bf4ae(0x1a3)]===_0x3bf4ae(0x1ae)&&_0x32a6a1[_0x3bf4ae(0x21e)]&&_0x32a6a1[_0x3bf4ae(0x11e)])_0x5d9728=new Date(_0x32a6a1['dateFrom']),_0xec55ce=new Date(_0x32a6a1[_0x3bf4ae(0x11e)]);else{const _0x102f17=new Date();switch(_0x32a6a1[_0x3bf4ae(0x1a3)]){case _0x3bf4ae(0x165):_0x5d9728=new Date(_0x102f17[_0x3bf4ae(0x204)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x3bf4ae(0x1cc):_0x5d9728=new Date(_0x102f17[_0x3bf4ae(0x204)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x3bf4ae(0x1d2):_0x5d9728=new Date(_0x102f17[_0x3bf4ae(0x204)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x3bf4ae(0x183):default:_0x5d9728=new Date('2020-01-01');break;}}console[_0x3bf4ae(0x1f2)](_0x3bf4ae(0x1a0)+_0x5d9728[_0x3bf4ae(0x199)]()+_0x3bf4ae(0x1fe)+_0xec55ce['toISOString']());const _0x2d31a3={'status':_0x3bf4ae(0x1e5),'gateway':{'not':_0x3bf4ae(0x182)},'paidAt':{'gte':_0x5d9728,'lte':_0xec55ce}};_0x32a6a1[_0x3bf4ae(0x1cd)]&&(_0x2d31a3[_0x3bf4ae(0x1cd)]=_0x32a6a1[_0x3bf4ae(0x1cd)]);const _0x1ab8a3=await database_1[_0x3bf4ae(0x21b)][_0x3bf4ae(0x11f)][_0x3bf4ae(0x127)]({'where':_0x2d31a3,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x3bf4ae(0x1f2)]('üí∞\x20Found\x20'+_0x1ab8a3[_0x3bf4ae(0x15c)]+_0x3bf4ae(0x15a));const _0x1f5b30={'gateway':{'not':_0x3bf4ae(0x182)},'createdAt':{'gte':_0x5d9728,'lte':_0xec55ce}};_0x32a6a1[_0x3bf4ae(0x1cd)]&&(_0x1f5b30[_0x3bf4ae(0x1cd)]=_0x32a6a1[_0x3bf4ae(0x1cd)]);const _0x569880=await database_1['default']['payment'][_0x3bf4ae(0x150)]({'where':_0x1f5b30});console[_0x3bf4ae(0x1f2)](_0x3bf4ae(0x145)+_0x569880+_0x3bf4ae(0x1c4)+_0x1ab8a3[_0x3bf4ae(0x15c)]);let _0x4401d5=0x0,_0x4ecc72=0x0,_0x3f22fa=0x0;const _0x47c602={},_0xf74d12={},_0x399c59={};for(const _0xb106d6 of _0x1ab8a3){try{const _0x45b1a1=await currencyService_1[_0x3bf4ae(0x1e6)]['convertToUSDT'](_0xb106d6[_0x3bf4ae(0x18b)],_0xb106d6[_0x3bf4ae(0x213)]);let _0xcc0a2f={};if(_0xb106d6[_0x3bf4ae(0x153)]['gatewaySettings'])try{_0xcc0a2f=JSON[_0x3bf4ae(0x10b)](_0xb106d6[_0x3bf4ae(0x153)][_0x3bf4ae(0x1ab)]);}catch(_0x824d81){console['error'](_0x3bf4ae(0x222)+_0xb106d6['shopId']+':',_0x824d81);}let _0x247ec1={},_0x4a868e=0xa;for(const [_0x5e5d5c,_0x180cd1]of Object['entries'](_0xcc0a2f)){if(_0x5e5d5c['toLowerCase']()===_0xb106d6[_0x3bf4ae(0x18a)][_0x3bf4ae(0x1b0)]()){_0x247ec1=_0x180cd1,_0x4a868e=_0x180cd1[_0x3bf4ae(0x11c)]||0xa;break;}}const _0x2a965a=_0x45b1a1*(_0x4a868e/0x64),_0x3977b3=_0x45b1a1-_0x2a965a;_0x4401d5+=_0x45b1a1,_0x4ecc72+=_0x3977b3,_0x3f22fa+=_0x2a965a;!_0x47c602[_0xb106d6['gateway']]&&(_0x47c602[_0xb106d6[_0x3bf4ae(0x18a)]]={'gateway':_0xb106d6['gateway'],'gatewayDisplayName':this[_0x3bf4ae(0x1eb)](_0xb106d6['gateway']),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x47c602[_0xb106d6[_0x3bf4ae(0x18a)]][_0x3bf4ae(0x1ce)]++,_0x47c602[_0xb106d6[_0x3bf4ae(0x18a)]][_0x3bf4ae(0x112)]+=_0x45b1a1,_0x47c602[_0xb106d6[_0x3bf4ae(0x18a)]][_0x3bf4ae(0x1d7)]+=_0x2a965a,_0x47c602[_0xb106d6['gateway']][_0x3bf4ae(0x189)]+=_0x3977b3,_0x47c602[_0xb106d6[_0x3bf4ae(0x18a)]][_0x3bf4ae(0x1e2)]+=_0x4a868e;!_0x32a6a1[_0x3bf4ae(0x1cd)]&&(!_0xf74d12[_0xb106d6[_0x3bf4ae(0x1cd)]]&&(_0xf74d12[_0xb106d6['shopId']]={'shopId':_0xb106d6['shopId'],'shopName':_0xb106d6[_0x3bf4ae(0x153)][_0x3bf4ae(0x22b)],'shopUsername':_0xb106d6[_0x3bf4ae(0x153)]['username'],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0xf74d12[_0xb106d6[_0x3bf4ae(0x1cd)]][_0x3bf4ae(0x1ce)]++,_0xf74d12[_0xb106d6[_0x3bf4ae(0x1cd)]][_0x3bf4ae(0x112)]+=_0x45b1a1,_0xf74d12[_0xb106d6[_0x3bf4ae(0x1cd)]][_0x3bf4ae(0x1d7)]+=_0x2a965a,_0xf74d12[_0xb106d6[_0x3bf4ae(0x1cd)]]['merchantEarningsUSDT']+=_0x3977b3);const _0x401044=_0xb106d6['paidAt']['toISOString']()['split']('T')[0x0];!_0x399c59[_0x401044]&&(_0x399c59[_0x401044]={'date':_0x401044,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x399c59[_0x401044][_0x3bf4ae(0x1fa)]+=_0x45b1a1,_0x399c59[_0x401044]['merchantEarnings']+=_0x3977b3,_0x399c59[_0x401044]['gatewayEarnings']+=_0x2a965a,_0x399c59[_0x401044][_0x3bf4ae(0x1ce)]++;}catch(_0x21a494){console[_0x3bf4ae(0x1f5)](_0x3bf4ae(0x149)+_0xb106d6['id']+':',_0x21a494);}}Object[_0x3bf4ae(0x1c5)](_0x47c602)[_0x3bf4ae(0x146)](_0x4c0889=>{const _0x1da310=_0x3bf4ae;_0x4c0889[_0x1da310(0x197)]=_0x4c0889['paymentsCount']>0x0?_0x4c0889[_0x1da310(0x1e2)]/_0x4c0889['paymentsCount']:0x0,delete _0x4c0889['totalCommissionRate'];}),Object[_0x3bf4ae(0x1c5)](_0xf74d12)[_0x3bf4ae(0x146)](_0x1d0f23=>{const _0x5a2319=_0x3bf4ae;_0x1d0f23[_0x5a2319(0x22d)]=_0x1d0f23['paymentsCount']>0x0?_0x1d0f23['turnoverUSDT']/_0x1d0f23[_0x5a2319(0x1ce)]:0x0;});let _0x24cdb3=0x0;if(_0x32a6a1[_0x3bf4ae(0x1cd)]){const _0x4e7067=await database_1[_0x3bf4ae(0x21b)][_0x3bf4ae(0x227)][_0x3bf4ae(0x127)]({'where':{'shopId':_0x32a6a1[_0x3bf4ae(0x1cd)],'status':_0x3bf4ae(0x192),'createdAt':{'gte':_0x5d9728,'lte':_0xec55ce}},'select':{'amount':!![]}});_0x24cdb3=_0x4e7067[_0x3bf4ae(0x147)]((_0x3cddd5,_0x197b7d)=>_0x3cddd5+_0x197b7d['amount'],0x0);}const _0x769354=_0x569880,_0x200bd3=_0x1ab8a3['length'],_0x3818a6=_0x200bd3>0x0?_0x4401d5/_0x200bd3:0x0,_0x3f8e8c=_0x769354>0x0?Math['round'](_0x200bd3/_0x769354*0x2710)/0x64:0x0,_0x4a089c=Math[_0x3bf4ae(0x12d)]((_0xec55ce[_0x3bf4ae(0x204)]()-_0x5d9728[_0x3bf4ae(0x204)]())/(0x3e8*0x3c*0x3c*0x18)),_0x16f86a={'totalTurnover':Math[_0x3bf4ae(0x1ef)](_0x4401d5*0x64)/0x64,'merchantEarnings':Math[_0x3bf4ae(0x1ef)](_0x4ecc72*0x64)/0x64,'gatewayEarnings':Math[_0x3bf4ae(0x1ef)](_0x3f22fa*0x64)/0x64,'totalPaidOut':Math['round'](_0x24cdb3*0x64)/0x64,'averageCheck':Math['round'](_0x3818a6*0x64)/0x64,'totalPayments':_0x769354,'successfulPayments':_0x200bd3,'conversionRate':_0x3f8e8c,'gatewayBreakdown':Object[_0x3bf4ae(0x1c5)](_0x47c602)[_0x3bf4ae(0x176)](_0x6fb662=>({..._0x6fb662,'turnoverUSDT':Math['round'](_0x6fb662[_0x3bf4ae(0x112)]*0x64)/0x64,'commissionUSDT':Math[_0x3bf4ae(0x1ef)](_0x6fb662[_0x3bf4ae(0x1d7)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x6fb662[_0x3bf4ae(0x189)]*0x64)/0x64,'averageCommissionRate':Math[_0x3bf4ae(0x1ef)](_0x6fb662[_0x3bf4ae(0x197)]*0x64)/0x64})),'merchantBreakdown':_0x32a6a1[_0x3bf4ae(0x1cd)]?undefined:Object[_0x3bf4ae(0x1c5)](_0xf74d12)[_0x3bf4ae(0x176)](_0x15e79c=>({..._0x15e79c,'turnoverUSDT':Math[_0x3bf4ae(0x1ef)](_0x15e79c[_0x3bf4ae(0x112)]*0x64)/0x64,'commissionUSDT':Math[_0x3bf4ae(0x1ef)](_0x15e79c['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x3bf4ae(0x1ef)](_0x15e79c[_0x3bf4ae(0x189)]*0x64)/0x64,'paidOutUSDT':Math[_0x3bf4ae(0x1ef)](_0x15e79c[_0x3bf4ae(0x1da)]*0x64)/0x64,'averageCheckUSDT':Math['round'](_0x15e79c['averageCheckUSDT']*0x64)/0x64})),'dailyData':Object['values'](_0x399c59)[_0x3bf4ae(0x176)](_0x3a87d9=>({..._0x3a87d9,'turnover':Math[_0x3bf4ae(0x1ef)](_0x3a87d9[_0x3bf4ae(0x1fa)]*0x64)/0x64,'merchantEarnings':Math[_0x3bf4ae(0x1ef)](_0x3a87d9[_0x3bf4ae(0x126)]*0x64)/0x64,'gatewayEarnings':Math['round'](_0x3a87d9['gatewayEarnings']*0x64)/0x64}))[_0x3bf4ae(0x184)]((_0x41b165,_0x3a4872)=>_0x41b165['date']['localeCompare'](_0x3a4872[_0x3bf4ae(0x1e9)])),'periodInfo':{'from':_0x5d9728,'to':_0xec55ce,'periodType':_0x32a6a1[_0x3bf4ae(0x1a3)]||_0x3bf4ae(0x1ae),'daysCount':_0x4a089c}};return console[_0x3bf4ae(0x1f2)](_0x3bf4ae(0x1a5)),console[_0x3bf4ae(0x1f2)]('\x20\x20\x20üí∞\x20Total\x20turnover:\x20'+_0x16f86a['totalTurnover']+_0x3bf4ae(0x234)),console[_0x3bf4ae(0x1f2)](_0x3bf4ae(0x1f9)+_0x16f86a[_0x3bf4ae(0x126)]+_0x3bf4ae(0x234)),console[_0x3bf4ae(0x1f2)](_0x3bf4ae(0x208)+_0x16f86a[_0x3bf4ae(0x12a)]+_0x3bf4ae(0x234)),console['log']('\x20\x20\x20üìä\x20Total\x20payments:\x20'+_0x16f86a['totalPayments']),_0x16f86a;}async[a35_0x495033(0x19a)](){const _0x4d733d=a35_0x495033;console[_0x4d733d(0x1f2)](_0x4d733d(0x1dd));const _0x2b71e0=await database_1[_0x4d733d(0x21b)][_0x4d733d(0x153)][_0x4d733d(0x127)]({'where':{'status':_0x4d733d(0x1e3)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':'asc'}});return console[_0x4d733d(0x1f2)]('üìã\x20Found\x20'+_0x2b71e0['length']+_0x4d733d(0x20b)),_0x2b71e0['map'](_0x582851=>({'id':_0x582851['id'],'username':_0x582851[_0x4d733d(0x178)],'name':_0x582851[_0x4d733d(0x22b)]}));}[a35_0x495033(0x1eb)](_0x5ec48b){const _0x7d5b3e=a35_0x495033,_0x1379ba={'test_gateway':_0x7d5b3e(0x1b3),'plisio':_0x7d5b3e(0x225),'rapyd':_0x7d5b3e(0x219),'noda':_0x7d5b3e(0x116),'cointopay':_0x7d5b3e(0x214),'cointopay2':_0x7d5b3e(0x194),'klyme_eu':_0x7d5b3e(0x1b4),'klyme_gb':'KLYME\x20GB','klyme_de':_0x7d5b3e(0x154),'mastercard':_0x7d5b3e(0x10e)};return _0x1379ba[_0x5ec48b]||_0x5ec48b;}[a35_0x495033(0x11d)](_0x37e2d6){const _0x17fd8e=a35_0x495033,_0x262a65={'Test\x20Gateway':'test_gateway','Plisio':_0x17fd8e(0x1dc),'Rapyd':_0x17fd8e(0x135),'Noda':_0x17fd8e(0x18f),'CoinToPay':'cointopay','CoinToPay2':_0x17fd8e(0x201),'KLYME\x20EU':_0x17fd8e(0x1d4),'KLYME\x20GB':_0x17fd8e(0x131),'KLYME\x20DE':_0x17fd8e(0x109),'MasterCard':'mastercard'};return _0x262a65[_0x37e2d6]||_0x37e2d6[_0x17fd8e(0x1b0)]();}async[a35_0x495033(0x1d5)](_0x29b6c2){const _0x2993a8=a35_0x495033,{page:_0x20c565,limit:_0x3ea361,minAmount:_0x81797d,search:_0x422fbc}=_0x29b6c2,_0x21bba3=(_0x20c565-0x1)*_0x3ea361;console[_0x2993a8(0x1f2)](_0x2993a8(0x132),_0x29b6c2);const _0x56fe8d={'balance':{'gt':0x0},'status':'ACTIVE'};_0x81797d&&(_0x56fe8d[_0x2993a8(0x120)][_0x2993a8(0x230)]=_0x81797d);_0x422fbc&&(_0x56fe8d['OR']=[{'name':{'contains':_0x422fbc,'mode':'insensitive'}},{'username':{'contains':_0x422fbc,'mode':'insensitive'}}]);const [_0x39f323,_0xd9e862]=await Promise[_0x2993a8(0x183)]([database_1[_0x2993a8(0x21b)][_0x2993a8(0x153)][_0x2993a8(0x127)]({'where':_0x56fe8d,'skip':_0x21bba3,'take':_0x3ea361,'orderBy':{'balance':_0x2993a8(0x202)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1[_0x2993a8(0x21b)][_0x2993a8(0x153)][_0x2993a8(0x150)]({'where':_0x56fe8d})]);console['log'](_0x2993a8(0x162)+_0x39f323['length']+_0x2993a8(0x1fb));const _0x363192=await Promise[_0x2993a8(0x183)](_0x39f323['map'](async _0x29b503=>{const _0xaf0e26=_0x2993a8,[_0x3177da,_0x5d69b0,_0xa69ef5]=await Promise[_0xaf0e26(0x183)]([database_1[_0xaf0e26(0x21b)]['payment'][_0xaf0e26(0x150)]({'where':{'shopId':_0x29b503['id'],'status':_0xaf0e26(0x1e5),'gateway':{'not':_0xaf0e26(0x182)}}}),database_1['default'][_0xaf0e26(0x11f)]['findFirst']({'where':{'shopId':_0x29b503['id'],'status':'PAID','gateway':{'not':'test_gateway'}},'orderBy':{'paidAt':_0xaf0e26(0x209)},'select':{'paidAt':!![]}}),database_1['default'][_0xaf0e26(0x11f)][_0xaf0e26(0x1ff)]({'by':['gateway'],'where':{'shopId':_0x29b503['id'],'status':'PAID','gateway':{'not':_0xaf0e26(0x182)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0xde3e6f=new Date(),_0x76e305=new Date(_0xde3e6f[_0xaf0e26(0x177)](),_0xde3e6f[_0xaf0e26(0x13c)](),0x1),_0x5bd908=new Date(_0xde3e6f[_0xaf0e26(0x177)](),_0xde3e6f[_0xaf0e26(0x13c)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x5c8b37,_0x52f59b]=await Promise[_0xaf0e26(0x183)]([database_1[_0xaf0e26(0x21b)][_0xaf0e26(0x227)][_0xaf0e26(0x1a1)]({'_sum':{'amount':!![]},'where':{'shopId':_0x29b503['id'],'status':'COMPLETED'}}),database_1[_0xaf0e26(0x21b)][_0xaf0e26(0x227)][_0xaf0e26(0x1a1)]({'_sum':{'amount':!![]},'where':{'shopId':_0x29b503['id'],'status':_0xaf0e26(0x192),'createdAt':{'gte':_0x76e305,'lte':_0x5bd908}}})]),_0x54bc93=_0x5c8b37[_0xaf0e26(0x18d)]['amount']||0x0,_0x5c074c=_0x52f59b[_0xaf0e26(0x18d)][_0xaf0e26(0x18b)]||0x0,_0x9bd89b=await Promise[_0xaf0e26(0x183)](_0xa69ef5[_0xaf0e26(0x176)](async _0x3b75e9=>{const _0x12ae47=_0xaf0e26;let _0x2e1cad=0xa;if(_0x29b503['gatewaySettings'])try{const _0x3aa8ad=JSON[_0x12ae47(0x10b)](_0x29b503[_0x12ae47(0x1ab)]);for(const [_0x1b31bd,_0xaf1bf7]of Object['entries'](_0x3aa8ad)){if(_0x1b31bd[_0x12ae47(0x1b0)]()===_0x3b75e9[_0x12ae47(0x18a)][_0x12ae47(0x1b0)]()){_0x2e1cad=_0xaf1bf7[_0x12ae47(0x11c)]||0xa,console[_0x12ae47(0x1f2)](_0x12ae47(0x193)+_0x3b75e9[_0x12ae47(0x18a)]+_0x12ae47(0x1ed)+_0x29b503['id']+_0x12ae47(0x1e1)+_0x2e1cad+'%');break;}}}catch(_0x424908){console[_0x12ae47(0x1f5)]('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x29b503['id']+':',_0x424908);}const _0x4289e1=_0x3b75e9[_0x12ae47(0x18d)]['amountUSDT']||0x0,_0x433495=_0x4289e1*(0x1-_0x2e1cad/0x64);return{'gateway':_0x3b75e9[_0x12ae47(0x18a)],'count':_0x3b75e9[_0x12ae47(0x119)]['id'],'amountUSDT':Math[_0x12ae47(0x1ef)](_0x4289e1*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x12ae47(0x1ef)](_0x433495*0x64)/0x64,'commission':_0x2e1cad};})),_0x2323c8=_0x9bd89b[_0xaf0e26(0x147)]((_0x1714f5,_0x11b663)=>_0x1714f5+_0x11b663[_0xaf0e26(0x152)],0x0),_0x25c734=_0x29b503[_0xaf0e26(0x120)];return console[_0xaf0e26(0x1f2)]('üí∞\x20[PAYOUT]\x20Merchant\x20'+_0x29b503['username']+':'),console[_0xaf0e26(0x1f2)]('\x20\x20\x20ÔøΩ\x20Total\x20payments\x20turnover:\x20'+_0x2323c8['toFixed'](0x2)+_0xaf0e26(0x148)),console[_0xaf0e26(0x1f2)](_0xaf0e26(0x113)+_0x9bd89b[_0xaf0e26(0x147)]((_0x2511fe,_0x4c02d8)=>_0x2511fe+_0x4c02d8['amountAfterCommissionUSDT'],0x0)[_0xaf0e26(0x1aa)](0x2)+'\x20USDT\x20(theoretical\x20net)'),console[_0xaf0e26(0x1f2)](_0xaf0e26(0x1a6)+_0x25c734['toFixed'](0x2)+_0xaf0e26(0x195)),{'id':_0x29b503['id'],'fullName':_0x29b503[_0xaf0e26(0x22b)],'username':_0x29b503[_0xaf0e26(0x178)],'telegramId':_0x29b503[_0xaf0e26(0x217)],'merchantUrl':_0x29b503[_0xaf0e26(0x1f1)],'wallets':{'usdtPolygonWallet':_0x29b503[_0xaf0e26(0x1d9)],'usdtTrcWallet':_0x29b503['usdtTrcWallet'],'usdtErcWallet':_0x29b503[_0xaf0e26(0x159)],'usdcPolygonWallet':_0x29b503['usdcPolygonWallet']},'totalAmountUSDT':Math['round'](_0x2323c8*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0xaf0e26(0x1ef)](_0x25c734*0x64)/0x64,'totalPayout':Math[_0xaf0e26(0x1ef)](_0x54bc93*0x64)/0x64,'thisMonth':Math[_0xaf0e26(0x1ef)](_0x5c074c*0x64)/0x64,'paymentsCount':_0x3177da,'oldestPaymentDate':_0x5d69b0?.[_0xaf0e26(0x1c9)]||_0x29b503[_0xaf0e26(0x18c)],'gatewayBreakdown':_0x9bd89b};})),_0x1aa671=_0x363192['reduce']((_0x3d5382,_0x4ccce9)=>_0x3d5382+_0x4ccce9[_0x2993a8(0x179)],0x0),_0x35266f=_0x363192['reduce']((_0x400762,_0x23ca08)=>_0x400762+_0x23ca08[_0x2993a8(0x190)],0x0),_0x6fd9da=_0x363192[_0x2993a8(0x147)]((_0x44f4f4,_0x3460cd)=>_0x44f4f4+_0x3460cd[_0x2993a8(0x226)],0x0),_0x5bf7d0=_0x363192[_0x2993a8(0x147)]((_0x21fd57,_0x4747ee)=>_0x21fd57+_0x4747ee[_0x2993a8(0x205)],0x0);return console['log']('üìä\x20Merchants\x20awaiting\x20payout:\x20'+_0xd9e862+'\x20merchants'),console[_0x2993a8(0x1f2)]('\x20\x20\x20üí∞\x20Total\x20payments\x20turnover:\x20'+Math[_0x2993a8(0x1ef)](_0x1aa671*0x64)/0x64+_0x2993a8(0x148)),console[_0x2993a8(0x1f2)](_0x2993a8(0x1b5)+Math['round'](_0x35266f*0x64)/0x64+_0x2993a8(0x19f)),console['log'](_0x2993a8(0x196)+Math[_0x2993a8(0x1ef)](_0x6fd9da*0x64)/0x64+_0x2993a8(0x234)),console[_0x2993a8(0x1f2)]('\x20\x20\x20üìÖ\x20Total\x20payouts\x20(this\x20month):\x20'+Math[_0x2993a8(0x1ef)](_0x5bf7d0*0x64)/0x64+_0x2993a8(0x234)),{'merchants':_0x363192,'pagination':{'page':_0x20c565,'limit':_0x3ea361,'total':_0xd9e862,'totalPages':Math[_0x2993a8(0x12d)](_0xd9e862/_0x3ea361)},'summary':{'totalMerchants':_0xd9e862,'totalAmountUSDT':Math['round'](_0x1aa671*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x2993a8(0x1ef)](_0x35266f*0x64)/0x64,'totalPayout':Math[_0x2993a8(0x1ef)](_0x6fd9da*0x64)/0x64,'thisMonth':Math[_0x2993a8(0x1ef)](_0x5bf7d0*0x64)/0x64}};}async[a35_0x495033(0x1f8)](_0x1db717){const _0x2b703b=a35_0x495033,{shopId:_0x4130ef,amount:_0x81aced,network:_0x385e68,wallet:_0x581671,notes:_0x3882ea,txid:_0x5383f2,periodFrom:_0x2ed99b,periodTo:_0xe40990}=_0x1db717,_0x3d7647=await database_1['default']['$transaction'](async _0x300eef=>{const _0x3dc77e=a35_0xf6df,_0x1ec52d=await _0x300eef[_0x3dc77e(0x153)][_0x3dc77e(0x1e8)]({'where':{'id':_0x4130ef},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x1ec52d)throw new Error(_0x3dc77e(0x223));console[_0x3dc77e(0x1f2)](_0x3dc77e(0x1d3)+_0x1ec52d['username']+':'),console[_0x3dc77e(0x1f2)](_0x3dc77e(0x20e)+_0x1ec52d['balance'][_0x3dc77e(0x1aa)](0x6)+_0x3dc77e(0x234)),console[_0x3dc77e(0x1f2)](_0x3dc77e(0x1a7)+_0x81aced[_0x3dc77e(0x1aa)](0x6)+'\x20USDT'),console[_0x3dc77e(0x1f2)](_0x3dc77e(0x233)+_0x1ec52d[_0x3dc77e(0x141)][_0x3dc77e(0x1aa)](0x6)+_0x3dc77e(0x234));if(_0x5383f2)console[_0x3dc77e(0x1f2)](_0x3dc77e(0x15d)+_0x5383f2);if(_0x1ec52d['balance']<_0x81aced)throw new Error(_0x3dc77e(0x1f7)+_0x1ec52d[_0x3dc77e(0x120)][_0x3dc77e(0x1aa)](0x6)+'\x20USDT,\x20Requested:\x20'+_0x81aced[_0x3dc77e(0x1aa)](0x6)+'\x20USDT');let _0xb6c16f=_0x581671;if(!_0xb6c16f){const _0x63f038=await _0x300eef[_0x3dc77e(0x153)][_0x3dc77e(0x1e8)]({'where':{'id':_0x4130ef},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x63f038)switch(_0x385e68){case _0x3dc77e(0x11b):_0xb6c16f=_0x63f038[_0x3dc77e(0x1d9)]||undefined;break;case'trc20':_0xb6c16f=_0x63f038[_0x3dc77e(0x13f)]||undefined;break;case _0x3dc77e(0x1db):_0xb6c16f=_0x63f038[_0x3dc77e(0x159)]||undefined;break;case _0x3dc77e(0x160):_0xb6c16f=_0x63f038[_0x3dc77e(0x224)]||undefined;break;}}console[_0x3dc77e(0x1f2)](_0x3dc77e(0x187)+_0x385e68+':\x20'+(_0xb6c16f||_0x3dc77e(0x206)));const _0x3892e7=await _0x300eef[_0x3dc77e(0x227)][_0x3dc77e(0x118)]({'data':{'shopId':_0x4130ef,'amount':_0x81aced,'network':_0x385e68,'status':_0x3dc77e(0x192),'txid':_0x5383f2,'notes':_0x3882ea,'periodFrom':_0x2ed99b?new Date(_0x2ed99b):null,'periodTo':_0xe40990?new Date(_0xe40990):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x3d08b1=_0x1ec52d[_0x3dc77e(0x120)]-_0x81aced,_0x53ebce=_0x1ec52d['totalPaidOut']+_0x81aced;return await _0x300eef['shop'][_0x3dc77e(0x1ee)]({'where':{'id':_0x4130ef},'data':{'balance':_0x3d08b1,'totalPaidOut':_0x53ebce}}),console[_0x3dc77e(0x1f2)](_0x3dc77e(0x228)+_0x1ec52d[_0x3dc77e(0x178)]+'\x20balance\x20updated:'),console['log'](_0x3dc77e(0x1b2)+_0x1ec52d['balance'][_0x3dc77e(0x1aa)](0x6)+_0x3dc77e(0x1ea)+_0x3d08b1[_0x3dc77e(0x1aa)](0x6)+_0x3dc77e(0x1cb)+_0x81aced[_0x3dc77e(0x1aa)](0x6)+')'),console[_0x3dc77e(0x1f2)](_0x3dc77e(0x188)+_0x1ec52d[_0x3dc77e(0x141)][_0x3dc77e(0x1aa)](0x6)+'\x20->\x20'+_0x53ebce[_0x3dc77e(0x1aa)](0x6)+_0x3dc77e(0x136)+_0x81aced[_0x3dc77e(0x1aa)](0x6)+')'),{'payout':_0x3892e7,'shop':_0x1ec52d};});return console[_0x2b703b(0x1f2)](_0x2b703b(0x122)+_0x3d7647[_0x2b703b(0x227)]['id']+_0x2b703b(0x1ed)+_0x3d7647['shop']['username']+'\x20('+_0x81aced+_0x2b703b(0x12c)),{'id':_0x3d7647[_0x2b703b(0x227)]['id'],'shopId':_0x3d7647['payout'][_0x2b703b(0x1cd)],'shopName':_0x3d7647['shop'][_0x2b703b(0x22b)],'shopUsername':_0x3d7647['shop'][_0x2b703b(0x178)],'amount':_0x3d7647[_0x2b703b(0x227)][_0x2b703b(0x18b)],'network':_0x3d7647[_0x2b703b(0x227)][_0x2b703b(0x170)],'status':_0x3d7647['payout']['status'],'txid':_0x3d7647[_0x2b703b(0x227)][_0x2b703b(0x1d1)],'notes':_0x3d7647[_0x2b703b(0x227)]['notes'],'periodFrom':_0x3d7647['payout'][_0x2b703b(0x16c)],'periodTo':_0x3d7647[_0x2b703b(0x227)][_0x2b703b(0x14a)],'createdAt':_0x3d7647['payout'][_0x2b703b(0x18c)],'paidAt':_0x3d7647[_0x2b703b(0x227)]['paidAt']};}async['getAllPayouts'](_0xa3ffbb){const _0x5b989c=a35_0x495033,{page:_0x4fb66d,limit:_0x1e0319,shopId:_0x4a5fd2,network:_0x4f61eb,dateFrom:_0x1406a9,dateTo:_0x2ab281,search:_0x125731}=_0xa3ffbb,_0x5714c8=(_0x4fb66d-0x1)*_0x1e0319,_0x56b583={};_0x4a5fd2&&(_0x56b583[_0x5b989c(0x1cd)]=_0x4a5fd2);_0x4f61eb&&(_0x56b583[_0x5b989c(0x170)]=_0x4f61eb);(_0x1406a9||_0x2ab281)&&(_0x56b583[_0x5b989c(0x18c)]={},_0x1406a9&&(_0x56b583[_0x5b989c(0x18c)][_0x5b989c(0x230)]=new Date(_0x1406a9)),_0x2ab281&&(_0x56b583[_0x5b989c(0x18c)][_0x5b989c(0x13b)]=new Date(_0x2ab281)));_0x125731&&(_0x56b583['OR']=[{'shop':{'name':{'contains':_0x125731,'mode':_0x5b989c(0x232)}}},{'shop':{'username':{'contains':_0x125731,'mode':_0x5b989c(0x232)}}},{'notes':{'contains':_0x125731,'mode':_0x5b989c(0x232)}}]);const [_0x239212,_0x2ae0e8]=await Promise['all']([database_1['default'][_0x5b989c(0x227)][_0x5b989c(0x127)]({'where':_0x56b583,'skip':_0x5714c8,'take':_0x1e0319,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x5b989c(0x21b)][_0x5b989c(0x227)][_0x5b989c(0x150)]({'where':_0x56b583})]);return{'payouts':_0x239212['map'](_0x3e0730=>({'id':_0x3e0730['id'],'shopId':_0x3e0730[_0x5b989c(0x1cd)],'shopName':_0x3e0730[_0x5b989c(0x153)][_0x5b989c(0x22b)],'shopUsername':_0x3e0730[_0x5b989c(0x153)][_0x5b989c(0x178)],'amount':_0x3e0730['amount'],'network':_0x3e0730['network'],'status':_0x3e0730[_0x5b989c(0x164)],'txid':_0x3e0730[_0x5b989c(0x1d1)],'notes':_0x3e0730[_0x5b989c(0x15e)],'periodFrom':_0x3e0730[_0x5b989c(0x16c)],'periodTo':_0x3e0730[_0x5b989c(0x14a)],'createdAt':_0x3e0730[_0x5b989c(0x18c)],'paidAt':_0x3e0730['paidAt']})),'pagination':{'page':_0x4fb66d,'limit':_0x1e0319,'total':_0x2ae0e8,'totalPages':Math[_0x5b989c(0x12d)](_0x2ae0e8/_0x1e0319)}};}async[a35_0x495033(0x1d0)](_0x1c568e){const _0x1722c2=a35_0x495033,_0x33a076=await database_1[_0x1722c2(0x21b)][_0x1722c2(0x227)][_0x1722c2(0x1e8)]({'where':{'id':_0x1c568e},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x33a076)return null;return{'id':_0x33a076['id'],'shopId':_0x33a076[_0x1722c2(0x1cd)],'shopName':_0x33a076[_0x1722c2(0x153)]['name'],'shopUsername':_0x33a076[_0x1722c2(0x153)][_0x1722c2(0x178)],'amount':_0x33a076[_0x1722c2(0x18b)],'network':_0x33a076[_0x1722c2(0x170)],'status':_0x33a076['status'],'txid':_0x33a076[_0x1722c2(0x1d1)],'notes':_0x33a076[_0x1722c2(0x15e)],'periodFrom':_0x33a076[_0x1722c2(0x16c)],'periodTo':_0x33a076[_0x1722c2(0x14a)],'createdAt':_0x33a076[_0x1722c2(0x18c)],'paidAt':_0x33a076['paidAt']};}async[a35_0x495033(0x21d)](_0x411b2a){const _0x47593b=a35_0x495033;await database_1['default'][_0x47593b(0x227)][_0x47593b(0x1af)]({'where':{'id':_0x411b2a}});}async['getAllPayments'](_0x253377){const _0x4301e0=a35_0x495033,{page:_0x94ca7d,limit:_0x194729,status:_0x24271c,gateway:_0xbbc512,shopId:_0x538da4,dateFrom:_0x40f6fe,dateTo:_0x402fc3,search:_0x372681,currency:_0x48abaf,sortBy:_0x3d08ea,sortOrder:_0xb64ce8}=_0x253377,_0x2bf388=(_0x94ca7d-0x1)*_0x194729;console['log']('üìä\x20Getting\x20payments\x20with\x20filters:',_0x253377);const _0x4fc266=await database_1[_0x4301e0(0x21b)]['payment'][_0x4301e0(0x1ff)]({'by':[_0x4301e0(0x18a)],'_count':{'gateway':!![]}});console[_0x4301e0(0x1f2)]('üìä\x20Available\x20gateways\x20in\x20database:',_0x4fc266[_0x4301e0(0x176)](_0x282775=>_0x282775[_0x4301e0(0x18a)]+'\x20('+_0x282775[_0x4301e0(0x119)]['gateway']+'\x20payments)'));if(_0xbbc512){const _0x1e84cf=_0x4fc266[_0x4301e0(0x10c)](_0x15f917=>_0x15f917[_0x4301e0(0x18a)]['toLowerCase']()===_0xbbc512['toLowerCase']());!_0x1e84cf&&_0xbbc512[_0x4301e0(0x1b0)]()!==_0x4301e0(0x182)&&console[_0x4301e0(0x1f2)](_0x4301e0(0x198)+_0xbbc512+_0x4301e0(0x144)+_0x4fc266[_0x4301e0(0x176)](_0x2d3741=>_0x2d3741[_0x4301e0(0x18a)])[_0x4301e0(0x1be)](',\x20'));}const _0x543531={};_0x24271c&&(_0x543531[_0x4301e0(0x164)]=_0x24271c[_0x4301e0(0x1b6)]());if(!_0xbbc512)_0x543531['gateway']={'not':_0x4301e0(0x182)};else{if(_0xbbc512&&(_0xbbc512[_0x4301e0(0x1b0)]()===_0x4301e0(0x182)||_0xbbc512==='0000'))_0x543531[_0x4301e0(0x18a)]=_0x4301e0(0x182);else{let _0x50c74f=_0xbbc512;const _0x55b6e6=(0x0,gateway_1['getGatewayNameById'])(_0xbbc512);if(_0x55b6e6)_0x50c74f=_0x55b6e6,console[_0x4301e0(0x1f2)]('üîÑ\x20Converted\x20gateway\x20ID\x20\x27'+_0xbbc512+_0x4301e0(0x19e)+_0x50c74f+'\x27');else{const _0x180cee=(0x0,gateway_1[_0x4301e0(0x1f0)])(_0xbbc512);if(_0x180cee){const _0x440659=(0x0,gateway_1['getGatewayNameById'])(_0x180cee);_0x440659&&(_0x50c74f=_0x440659,console[_0x4301e0(0x1f2)]('üîÑ\x20Converted\x20gateway\x20name\x20\x27'+_0xbbc512+'\x27\x20->\x20ID\x20\x27'+_0x180cee+_0x4301e0(0x16d)+_0x50c74f+'\x27'));}else console[_0x4301e0(0x1f2)]('üîç\x20Using\x20gateway\x20\x27'+_0xbbc512+_0x4301e0(0x1ca));}const _0x5beb52=await database_1['default'][_0x4301e0(0x11f)]['count']({'where':{'gateway':_0x50c74f['toLowerCase']()},'take':0x1});_0x5beb52===0x0?(console[_0x4301e0(0x1f2)](_0x4301e0(0x22a)+_0x50c74f+'\x27\x20(from\x20\x27'+_0xbbc512+_0x4301e0(0x137)),_0x543531[_0x4301e0(0x18a)]=_0x4301e0(0x142)):(_0x543531[_0x4301e0(0x18a)]=_0x50c74f[_0x4301e0(0x1b0)](),console[_0x4301e0(0x1f2)](_0x4301e0(0x1e7)+_0x50c74f+'\x27\x20(from\x20\x27'+_0xbbc512+'\x27)'));}}console['log'](_0x4301e0(0x1f4),_0x543531[_0x4301e0(0x18a)]);_0x538da4&&(_0x543531['shopId']=_0x538da4);_0x48abaf&&(_0x543531['currency']=_0x48abaf[_0x4301e0(0x1b6)](),console[_0x4301e0(0x1f2)](_0x4301e0(0x1a2)+_0x48abaf[_0x4301e0(0x1b6)]()));(_0x40f6fe||_0x402fc3)&&(_0x543531[_0x4301e0(0x18c)]={},_0x40f6fe&&(_0x543531[_0x4301e0(0x18c)][_0x4301e0(0x230)]=new Date(_0x40f6fe)),_0x402fc3&&(_0x543531[_0x4301e0(0x18c)]['lte']=new Date(_0x402fc3)));_0x372681&&(_0x543531['OR']=[{'id':{'contains':_0x372681,'mode':_0x4301e0(0x232)}},{'orderId':{'contains':_0x372681,'mode':_0x4301e0(0x232)}},{'gatewayOrderId':{'contains':_0x372681,'mode':'insensitive'}},{'customerEmail':{'contains':_0x372681,'mode':'insensitive'}},{'shop':{'name':{'contains':_0x372681,'mode':_0x4301e0(0x232)}}},{'shop':{'username':{'contains':_0x372681,'mode':'insensitive'}}}]);console[_0x4301e0(0x1f2)](_0x4301e0(0x1e0),JSON[_0x4301e0(0x191)](_0x543531,null,0x2));let _0x473d8d={'createdAt':_0x4301e0(0x202)};if(_0x3d08ea){const _0x3d40a5=[_0x4301e0(0x18b),'createdAt',_0x4301e0(0x12f),_0x4301e0(0x164),_0x4301e0(0x18a),_0x4301e0(0x213)],_0x52ddf7=[_0x4301e0(0x209),'desc'];if(_0x3d40a5[_0x4301e0(0x21c)](_0x3d08ea)){const _0x3e4df6=_0x52ddf7[_0x4301e0(0x21c)](_0xb64ce8)?_0xb64ce8:_0x4301e0(0x202);_0x473d8d={[_0x3d08ea]:_0x3e4df6},console[_0x4301e0(0x1f2)](_0x4301e0(0x138)+_0x3d08ea+_0x4301e0(0x20a)+_0x3e4df6+_0x4301e0(0x166));}}const [_0x57c00f,_0x204618]=await Promise[_0x4301e0(0x183)]([database_1[_0x4301e0(0x21b)][_0x4301e0(0x11f)][_0x4301e0(0x127)]({'where':_0x543531,'skip':_0x2bf388,'take':_0x194729,'orderBy':_0x473d8d,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x4301e0(0x21b)]['payment']['count']({'where':_0x543531})]);return{'payments':_0x57c00f,'pagination':{'page':_0x94ca7d,'limit':_0x194729,'total':_0x204618,'totalPages':Math[_0x4301e0(0x12d)](_0x204618/_0x194729)}};}async['getPaymentById'](_0x1d7060){const _0x46b9e4=a35_0x495033,_0x15069b=await database_1[_0x46b9e4(0x21b)][_0x46b9e4(0x11f)][_0x46b9e4(0x1e8)]({'where':{'id':_0x1d7060},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x15069b)return null;return{'id':_0x15069b['id'],'shopId':_0x15069b[_0x46b9e4(0x1cd)],'gateway':_0x15069b['gateway'],'amount':_0x15069b[_0x46b9e4(0x18b)],'currency':_0x15069b[_0x46b9e4(0x213)],'status':_0x15069b[_0x46b9e4(0x164)],'orderId':_0x15069b[_0x46b9e4(0x168)],'gatewayOrderId':_0x15069b[_0x46b9e4(0x210)],'customerEmail':_0x15069b[_0x46b9e4(0x163)],'customerName':_0x15069b[_0x46b9e4(0x16b)],'customerCountry':_0x15069b['customerCountry'],'customerIp':_0x15069b[_0x46b9e4(0x1bf)],'customerUa':_0x15069b[_0x46b9e4(0x1b9)],'failureMessage':_0x15069b[_0x46b9e4(0x158)],'externalPaymentUrl':_0x15069b[_0x46b9e4(0x14b)],'successUrl':_0x15069b[_0x46b9e4(0x161)],'failUrl':_0x15069b['failUrl'],'pendingUrl':_0x15069b[_0x46b9e4(0x180)],'whiteUrl':_0x15069b[_0x46b9e4(0x12e)],'createdAt':_0x15069b[_0x46b9e4(0x18c)],'updatedAt':_0x15069b[_0x46b9e4(0x12f)],'shop':_0x15069b[_0x46b9e4(0x153)]};}async[a35_0x495033(0x186)](_0x399961,_0x12543d,_0x36a559,_0x277c27){const _0x216da9=a35_0x495033,_0x53157f=await database_1['default'][_0x216da9(0x211)](async _0xd3fd2c=>{const _0x55bfee=_0x216da9,_0x29c1e4=await _0xd3fd2c[_0x55bfee(0x11f)]['findUnique']({'where':{'id':_0x399961},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x29c1e4)throw new Error(_0x55bfee(0x110));const _0x38a5c1=_0x29c1e4[_0x55bfee(0x164)],_0x4f82c5=_0x12543d[_0x55bfee(0x1b6)]();console['log']('üîÑ\x20Admin\x20updating\x20payment\x20'+_0x399961+_0x55bfee(0x133)+_0x38a5c1+_0x55bfee(0x1ea)+_0x4f82c5),console['log'](_0x55bfee(0x218)+_0x29c1e4[_0x55bfee(0x153)][_0x55bfee(0x120)]+_0x55bfee(0x234));const _0x35cdcd={'status':_0x4f82c5,'updatedAt':new Date(),'statusChangedBy':_0x55bfee(0x129),'statusChangedAt':new Date()};_0x36a559&&(_0x35cdcd['adminNotes']=_0x36a559);_0x4f82c5===_0x55bfee(0x22c)&&_0x277c27&&(_0x35cdcd[_0x55bfee(0x1fc)]=_0x277c27);let _0x3df0f1=0x0,_0x3d57fb=_0x29c1e4['shop'][_0x55bfee(0x120)];if(_0x4f82c5==='PAID'&&_0x38a5c1!==_0x55bfee(0x1e5)){_0x35cdcd['paidAt']=new Date();const _0x529fbc=await currencyService_1[_0x55bfee(0x1e6)]['convertToUSDT'](_0x29c1e4['amount'],_0x29c1e4['currency']);_0x35cdcd[_0x55bfee(0x152)]=_0x529fbc;let _0x40fc5a=0xa;const _0x13fddb=await _0xd3fd2c[_0x55bfee(0x153)][_0x55bfee(0x1e8)]({'where':{'id':_0x29c1e4['shopId']},'select':{'gatewaySettings':!![]}});if(_0x13fddb?.['gatewaySettings'])try{const _0x56ad8c=JSON[_0x55bfee(0x10b)](_0x13fddb[_0x55bfee(0x1ab)]);for(const [_0x3e9a0c,_0x24fa13]of Object[_0x55bfee(0x15b)](_0x56ad8c)){if(_0x3e9a0c[_0x55bfee(0x1b0)]()===_0x29c1e4[_0x55bfee(0x18a)]['toLowerCase']()){_0x40fc5a=_0x24fa13['commission']||0xa;break;}}}catch(_0x524ed9){console[_0x55bfee(0x1f5)](_0x55bfee(0x1b1)+_0x399961+':',_0x524ed9);}const _0x211045=_0x529fbc*(0x1-_0x40fc5a/0x64);_0x3df0f1=_0x211045,_0x3d57fb+=_0x211045,console[_0x55bfee(0x1f2)](_0x55bfee(0x167)+_0x399961+'\x20became\x20PAID:'),console[_0x55bfee(0x1f2)](_0x55bfee(0x17f)+_0x529fbc[_0x55bfee(0x1aa)](0x6)+_0x55bfee(0x234)),console['log'](_0x55bfee(0x151)+_0x29c1e4[_0x55bfee(0x18a)]+_0x55bfee(0x1e4)+_0x40fc5a+'%'),console[_0x55bfee(0x1f2)](_0x55bfee(0x173)+_0x211045[_0x55bfee(0x1aa)](0x6)+_0x55bfee(0x1c8)+_0x40fc5a+_0x55bfee(0x139)),console['log']('\x20\x20\x20Added\x20to\x20balance:\x20+'+_0x211045[_0x55bfee(0x1aa)](0x6)+_0x55bfee(0x234));}else{if(_0x38a5c1===_0x55bfee(0x1e5)&&_0x4f82c5!=='PAID'){if(_0x29c1e4['amountUSDT']){let _0x392cdd=0xa;const _0x1f21d8=await _0xd3fd2c[_0x55bfee(0x153)]['findUnique']({'where':{'id':_0x29c1e4['shopId']},'select':{'gatewaySettings':!![]}});if(_0x1f21d8?.[_0x55bfee(0x1ab)])try{const _0x42c6ea=JSON[_0x55bfee(0x10b)](_0x1f21d8[_0x55bfee(0x1ab)]);for(const [_0x39ec85,_0x22956d]of Object[_0x55bfee(0x15b)](_0x42c6ea)){if(_0x39ec85[_0x55bfee(0x1b0)]()===_0x29c1e4[_0x55bfee(0x18a)][_0x55bfee(0x1b0)]()){_0x392cdd=_0x22956d['commission']||0xa;break;}}}catch(_0x30bfb1){console['error'](_0x55bfee(0x1b1)+_0x399961+':',_0x30bfb1);}const _0x2f4a84=_0x29c1e4[_0x55bfee(0x152)]*(0x1-_0x392cdd/0x64);_0x3df0f1=-_0x2f4a84,_0x3d57fb-=_0x2f4a84,_0x35cdcd['amountUSDT']=null,console[_0x55bfee(0x1f2)](_0x55bfee(0x167)+_0x399961+_0x55bfee(0x216)),console['log'](_0x55bfee(0x17f)+_0x29c1e4[_0x55bfee(0x152)][_0x55bfee(0x1aa)](0x6)+_0x55bfee(0x234)),console['log']('\x20\x20\x20Gateway:\x20'+_0x29c1e4[_0x55bfee(0x18a)]+_0x55bfee(0x1e4)+_0x392cdd+'%'),console[_0x55bfee(0x1f2)](_0x55bfee(0x1ec)+_0x2f4a84['toFixed'](0x6)+'\x20USDT\x20(after\x20'+_0x392cdd+_0x55bfee(0x139)),console[_0x55bfee(0x1f2)](_0x55bfee(0x16e)+_0x2f4a84[_0x55bfee(0x1aa)](0x6)+_0x55bfee(0x234));}}}_0x4f82c5==='CHARGEBACK'&&(_0x38a5c1===_0x55bfee(0x1e5)&&_0x29c1e4[_0x55bfee(0x152)]&&console['log'](_0x55bfee(0x22f)),_0x277c27&&_0x277c27>0x0&&(_0x3df0f1-=_0x277c27,_0x3d57fb-=_0x277c27,console[_0x55bfee(0x1f2)]('üí∏\x20CHARGEBACK\x20penalty:\x20-'+_0x277c27[_0x55bfee(0x1aa)](0x6)+_0x55bfee(0x10d))));_0x4f82c5===_0x55bfee(0x1b7)&&_0x38a5c1===_0x55bfee(0x1e5)&&console['log'](_0x55bfee(0x231));const _0x50ffd4=await _0xd3fd2c[_0x55bfee(0x11f)][_0x55bfee(0x1ee)]({'where':{'id':_0x399961},'data':_0x35cdcd,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x3df0f1!==0x0&&(await _0xd3fd2c[_0x55bfee(0x153)]['update']({'where':{'id':_0x29c1e4[_0x55bfee(0x1cd)]},'data':{'balance':_0x3d57fb}}),console[_0x55bfee(0x1f2)](_0x55bfee(0x228)+_0x29c1e4[_0x55bfee(0x1cd)]+_0x55bfee(0x14d)+_0x29c1e4['shop'][_0x55bfee(0x120)]['toFixed'](0x6)+_0x55bfee(0x1ea)+_0x3d57fb['toFixed'](0x6)+_0x55bfee(0x1b8)+(_0x3df0f1>0x0?'+':'')+_0x3df0f1[_0x55bfee(0x1aa)](0x6)+')')),_0x50ffd4;});return{'id':_0x53157f['id'],'shopId':_0x53157f[_0x216da9(0x1cd)],'gateway':_0x53157f[_0x216da9(0x18a)],'amount':_0x53157f[_0x216da9(0x18b)],'currency':_0x53157f[_0x216da9(0x213)],'status':_0x53157f['status'],'orderId':_0x53157f[_0x216da9(0x168)],'gatewayOrderId':_0x53157f[_0x216da9(0x210)],'customerEmail':_0x53157f[_0x216da9(0x163)],'customerName':_0x53157f['customerName'],'customerCountry':_0x53157f[_0x216da9(0x13e)],'customerIp':_0x53157f[_0x216da9(0x1bf)],'customerUa':_0x53157f[_0x216da9(0x1b9)],'failureMessage':_0x53157f[_0x216da9(0x158)],'adminNotes':_0x53157f[_0x216da9(0x174)],'chargebackAmount':_0x53157f[_0x216da9(0x1fc)],'statusChangedBy':_0x53157f['statusChangedBy'],'statusChangedAt':_0x53157f['statusChangedAt'],'createdAt':_0x53157f[_0x216da9(0x18c)],'updatedAt':_0x53157f['updatedAt'],'shop':_0x53157f[_0x216da9(0x153)]};}async['updateUser'](_0x4c9e3e,_0xda4681){const _0x1e6794=a35_0x495033,_0x4a19f1=Math[_0x1e6794(0x169)]()[_0x1e6794(0x18e)](0x24)['substr'](0x2,0x9);console[_0x1e6794(0x1f2)](_0x1e6794(0x1c0)+_0x4a19f1+_0x1e6794(0x156)+_0x4c9e3e);const _0x2fbfd7={..._0xda4681};_0xda4681[_0x1e6794(0x22e)]&&(_0x2fbfd7[_0x1e6794(0x22e)]=await bcryptjs_1['default']['hash'](_0xda4681[_0x1e6794(0x22e)],0xc));_0xda4681['fullName']&&(_0x2fbfd7[_0x1e6794(0x22b)]=_0xda4681['fullName'],delete _0x2fbfd7[_0x1e6794(0x1a4)]);_0xda4681[_0x1e6794(0x19b)]&&(_0x2fbfd7[_0x1e6794(0x217)]=_0xda4681[_0x1e6794(0x19b)],delete _0x2fbfd7['telegramId']);_0xda4681[_0x1e6794(0x157)]&&(_0x2fbfd7[_0x1e6794(0x1f1)]=_0xda4681['merchantUrl'],delete _0x2fbfd7[_0x1e6794(0x157)]);if(_0xda4681[_0x1e6794(0x1ba)]){const _0x2b7092=_0xda4681[_0x1e6794(0x1ba)][_0x1e6794(0x176)](_0x51aafb=>this['getGatewayInternalName'](_0x51aafb));console[_0x1e6794(0x1f2)](_0x1e6794(0x1de),_0xda4681[_0x1e6794(0x1ba)],'->',_0x2b7092),_0x2fbfd7[_0x1e6794(0x10a)]=JSON[_0x1e6794(0x191)](_0x2b7092),delete _0x2fbfd7[_0x1e6794(0x1ba)];}_0xda4681['gatewaySettings']&&(console['log'](_0x1e6794(0x115)+_0x4a19f1+']\x20Gateway\x20settings\x20before\x20saving:',_0xda4681['gatewaySettings']),_0x2fbfd7['gatewaySettings']=JSON['stringify'](_0xda4681[_0x1e6794(0x1ab)]),console[_0x1e6794(0x1f2)](_0x1e6794(0x115)+_0x4a19f1+_0x1e6794(0x13a),_0x2fbfd7[_0x1e6794(0x1ab)]),delete _0x2fbfd7[_0x1e6794(0x1ab)]);_0xda4681[_0x1e6794(0x17c)]&&(_0xda4681[_0x1e6794(0x17c)][_0x1e6794(0x1d9)]!==undefined&&(_0x2fbfd7['usdtPolygonWallet']=_0xda4681['wallets'][_0x1e6794(0x1d9)]||null),_0xda4681[_0x1e6794(0x17c)][_0x1e6794(0x13f)]!==undefined&&(_0x2fbfd7['usdtTrcWallet']=_0xda4681[_0x1e6794(0x17c)][_0x1e6794(0x13f)]||null),_0xda4681[_0x1e6794(0x17c)][_0x1e6794(0x159)]!==undefined&&(_0x2fbfd7[_0x1e6794(0x159)]=_0xda4681[_0x1e6794(0x17c)][_0x1e6794(0x159)]||null),_0xda4681[_0x1e6794(0x17c)][_0x1e6794(0x224)]!==undefined&&(_0x2fbfd7[_0x1e6794(0x224)]=_0xda4681['wallets'][_0x1e6794(0x224)]||null),delete _0x2fbfd7[_0x1e6794(0x17c)]);const _0x1d034f=await database_1[_0x1e6794(0x21b)][_0x1e6794(0x153)][_0x1e6794(0x1ee)]({'where':{'id':_0x4c9e3e},'data':_0x2fbfd7,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console['log']('üéØ\x20['+_0x4a19f1+_0x1e6794(0x16f),_0x1d034f[_0x1e6794(0x1ab)]),{'id':_0x1d034f['id'],'fullName':_0x1d034f['name'],'username':_0x1d034f[_0x1e6794(0x178)],'telegramId':_0x1d034f[_0x1e6794(0x217)],'merchantUrl':_0x1d034f['shopUrl'],'gateways':_0x1d034f[_0x1e6794(0x10a)]?JSON[_0x1e6794(0x10b)](_0x1d034f['paymentGateways']):null,'gatewaySettings':_0x1d034f[_0x1e6794(0x1ab)]?JSON[_0x1e6794(0x10b)](_0x1d034f[_0x1e6794(0x1ab)]):null,'publicKey':_0x1d034f[_0x1e6794(0x221)],'wallets':{'usdtPolygonWallet':_0x1d034f[_0x1e6794(0x1d9)],'usdtTrcWallet':_0x1d034f[_0x1e6794(0x13f)],'usdtErcWallet':_0x1d034f[_0x1e6794(0x159)],'usdcPolygonWallet':_0x1d034f[_0x1e6794(0x224)]},'status':_0x1d034f['status'],'createdAt':_0x1d034f[_0x1e6794(0x18c)]};}async['suspendUser'](_0x3edf9e){const _0x2b2fe2=a35_0x495033,_0x5038c3=await database_1[_0x2b2fe2(0x21b)]['shop'][_0x2b2fe2(0x1ee)]({'where':{'id':_0x3edf9e},'data':{'status':_0x2b2fe2(0x1df)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x5038c3['id'],'fullName':_0x5038c3[_0x2b2fe2(0x22b)],'username':_0x5038c3[_0x2b2fe2(0x178)],'telegramId':_0x5038c3[_0x2b2fe2(0x217)],'merchantUrl':_0x5038c3[_0x2b2fe2(0x1f1)],'gateways':_0x5038c3[_0x2b2fe2(0x10a)]?JSON['parse'](_0x5038c3[_0x2b2fe2(0x10a)]):null,'gatewaySettings':_0x5038c3[_0x2b2fe2(0x1ab)]?JSON['parse'](_0x5038c3[_0x2b2fe2(0x1ab)]):null,'publicKey':_0x5038c3[_0x2b2fe2(0x221)],'wallets':{'usdtPolygonWallet':_0x5038c3[_0x2b2fe2(0x1d9)],'usdtTrcWallet':_0x5038c3[_0x2b2fe2(0x13f)],'usdtErcWallet':_0x5038c3['usdtErcWallet'],'usdcPolygonWallet':_0x5038c3[_0x2b2fe2(0x224)]},'status':_0x5038c3[_0x2b2fe2(0x164)],'createdAt':_0x5038c3[_0x2b2fe2(0x18c)]};}async['activateUser'](_0x31048e){const _0x298ba5=a35_0x495033,_0x21416f=await database_1[_0x298ba5(0x21b)][_0x298ba5(0x153)]['update']({'where':{'id':_0x31048e},'data':{'status':_0x298ba5(0x1e3)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x21416f['id'],'fullName':_0x21416f[_0x298ba5(0x22b)],'username':_0x21416f[_0x298ba5(0x178)],'telegramId':_0x21416f['telegram'],'merchantUrl':_0x21416f[_0x298ba5(0x1f1)],'gateways':_0x21416f[_0x298ba5(0x10a)]?JSON[_0x298ba5(0x10b)](_0x21416f[_0x298ba5(0x10a)]):null,'gatewaySettings':_0x21416f[_0x298ba5(0x1ab)]?JSON[_0x298ba5(0x10b)](_0x21416f['gatewaySettings']):null,'publicKey':_0x21416f['publicKey'],'wallets':{'usdtPolygonWallet':_0x21416f[_0x298ba5(0x1d9)],'usdtTrcWallet':_0x21416f['usdtTrcWallet'],'usdtErcWallet':_0x21416f[_0x298ba5(0x159)],'usdcPolygonWallet':_0x21416f[_0x298ba5(0x224)]},'status':_0x21416f['status'],'createdAt':_0x21416f[_0x298ba5(0x18c)]};}async[a35_0x495033(0x229)](_0x1b07b2){const _0xe58b5f=a35_0x495033,{page:_0x50c803,limit:_0x1465d6,status:_0x38c524}=_0x1b07b2,_0x30a3e7=(_0x50c803-0x1)*_0x1465d6,_0xb31ba1={};_0x38c524&&(_0xb31ba1['status']=_0x38c524['toUpperCase']());const [_0x19f295,_0x515198]=await Promise[_0xe58b5f(0x183)]([database_1['default'][_0xe58b5f(0x153)]['findMany']({'where':_0xb31ba1,'skip':_0x30a3e7,'take':_0x1465d6,'orderBy':{'createdAt':_0xe58b5f(0x202)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1['default'][_0xe58b5f(0x153)][_0xe58b5f(0x150)]({'where':_0xb31ba1})]);return{'users':_0x19f295[_0xe58b5f(0x176)](_0x4dd0ff=>{const _0x1661d3=_0xe58b5f,_0x29b248=_0x4dd0ff['paymentGateways']?JSON[_0x1661d3(0x10b)](_0x4dd0ff[_0x1661d3(0x10a)]):null,_0x467b43=_0x29b248?_0x29b248[_0x1661d3(0x176)](_0x9463ac=>this['getGatewayDisplayName'](_0x9463ac)):null;return{'id':_0x4dd0ff['id'],'fullName':_0x4dd0ff[_0x1661d3(0x22b)],'username':_0x4dd0ff[_0x1661d3(0x178)],'telegramId':_0x4dd0ff[_0x1661d3(0x217)],'merchantUrl':_0x4dd0ff[_0x1661d3(0x1f1)],'gateways':_0x467b43,'gatewaySettings':_0x4dd0ff[_0x1661d3(0x1ab)]?JSON['parse'](_0x4dd0ff[_0x1661d3(0x1ab)]):null,'publicKey':_0x4dd0ff[_0x1661d3(0x221)],'wallets':{'usdtPolygonWallet':_0x4dd0ff['usdtPolygonWallet'],'usdtTrcWallet':_0x4dd0ff[_0x1661d3(0x13f)],'usdtErcWallet':_0x4dd0ff['usdtErcWallet'],'usdcPolygonWallet':_0x4dd0ff['usdcPolygonWallet']},'status':_0x4dd0ff['status'],'createdAt':_0x4dd0ff[_0x1661d3(0x18c)]};}),'pagination':{'page':_0x50c803,'limit':_0x1465d6,'total':_0x515198,'totalPages':Math[_0xe58b5f(0x12d)](_0x515198/_0x1465d6)}};}async[a35_0x495033(0x111)](_0x589e5f){const _0x22e62a=a35_0x495033,_0x5aea7c=await database_1[_0x22e62a(0x21b)][_0x22e62a(0x153)]['findUnique']({'where':{'id':_0x589e5f},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x5aea7c)return null;const _0x2e308e=_0x5aea7c['paymentGateways']?JSON['parse'](_0x5aea7c[_0x22e62a(0x10a)]):null,_0x47c6c7=_0x2e308e?_0x2e308e[_0x22e62a(0x176)](_0xa12165=>this[_0x22e62a(0x1eb)](_0xa12165)):null;return _0x2e308e&&_0x47c6c7&&console[_0x22e62a(0x1f2)](_0x22e62a(0x17b),_0x2e308e,'->',_0x47c6c7),{'id':_0x5aea7c['id'],'fullName':_0x5aea7c[_0x22e62a(0x22b)],'username':_0x5aea7c[_0x22e62a(0x178)],'telegramId':_0x5aea7c[_0x22e62a(0x217)],'merchantUrl':_0x5aea7c[_0x22e62a(0x1f1)],'gateways':_0x47c6c7,'gatewaySettings':_0x5aea7c['gatewaySettings']?JSON[_0x22e62a(0x10b)](_0x5aea7c['gatewaySettings']):null,'publicKey':_0x5aea7c[_0x22e62a(0x221)],'wallets':{'usdtPolygonWallet':_0x5aea7c[_0x22e62a(0x1d9)],'usdtTrcWallet':_0x5aea7c[_0x22e62a(0x13f)],'usdtErcWallet':_0x5aea7c['usdtErcWallet'],'usdcPolygonWallet':_0x5aea7c['usdcPolygonWallet']},'status':_0x5aea7c['status'],'createdAt':_0x5aea7c[_0x22e62a(0x18c)]};}async[a35_0x495033(0x1c2)](_0x39f350){const _0x262e83=a35_0x495033,{fullName:_0x15bab4,username:_0x22c084,password:_0x2d05af,telegramId:_0x129f36,merchantUrl:_0x1103a0,gateways:_0x3070c1,gatewaySettings:_0x201b11,wallets:_0x42a058}=_0x39f350,_0x4ece86=await database_1[_0x262e83(0x21b)][_0x262e83(0x153)][_0x262e83(0x1e8)]({'where':{'username':_0x22c084}});if(_0x4ece86)throw new Error(_0x262e83(0x19c));if(_0x129f36){const _0x1621c2=await database_1['default']['shop']['findUnique']({'where':{'telegram':_0x129f36}});if(_0x1621c2)throw new Error(_0x262e83(0x20f));}const _0x1fa19f=await bcryptjs_1['default']['hash'](_0x2d05af,0xc),_0x31183b=_0x262e83(0x121)+crypto_1[_0x262e83(0x21b)][_0x262e83(0x21f)](0x20)[_0x262e83(0x18e)](_0x262e83(0x1bb)),_0x178754=_0x262e83(0x1d6)+crypto_1[_0x262e83(0x21b)]['randomBytes'](0x20)[_0x262e83(0x18e)](_0x262e83(0x1bb)),_0x459ea0=_0x3070c1?_0x3070c1['map'](_0x35a452=>this['getGatewayInternalName'](_0x35a452)):null;_0x3070c1&&_0x459ea0&&console[_0x262e83(0x1f2)](_0x262e83(0x17e),_0x3070c1,'->',_0x459ea0);const _0x451faa=await database_1[_0x262e83(0x21b)][_0x262e83(0x153)][_0x262e83(0x118)]({'data':{'name':_0x15bab4,'username':_0x22c084,'password':_0x1fa19f,'telegram':_0x129f36,'shopUrl':_0x1103a0,'paymentGateways':_0x459ea0?JSON['stringify'](_0x459ea0):null,'gatewaySettings':_0x201b11?JSON['stringify'](_0x201b11):null,'usdtPolygonWallet':_0x42a058?.[_0x262e83(0x1d9)]||null,'usdtTrcWallet':_0x42a058?.[_0x262e83(0x13f)]||null,'usdtErcWallet':_0x42a058?.[_0x262e83(0x159)]||null,'usdcPolygonWallet':_0x42a058?.[_0x262e83(0x224)]||null,'publicKey':_0x31183b,'secretKey':_0x178754,'status':_0x262e83(0x1e3)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x451faa['id'],'fullName':_0x451faa['name'],'username':_0x451faa[_0x262e83(0x178)],'telegramId':_0x451faa['telegram'],'merchantUrl':_0x451faa[_0x262e83(0x1f1)],'gateways':_0x451faa[_0x262e83(0x10a)]?JSON[_0x262e83(0x10b)](_0x451faa['paymentGateways']):null,'gatewaySettings':_0x451faa[_0x262e83(0x1ab)]?JSON['parse'](_0x451faa[_0x262e83(0x1ab)]):null,'publicKey':_0x451faa[_0x262e83(0x221)],'wallets':{'usdtPolygonWallet':_0x451faa[_0x262e83(0x1d9)],'usdtTrcWallet':_0x451faa['usdtTrcWallet'],'usdtErcWallet':_0x451faa[_0x262e83(0x159)],'usdcPolygonWallet':_0x451faa['usdcPolygonWallet']},'status':_0x451faa[_0x262e83(0x164)],'createdAt':_0x451faa['createdAt']};}async[a35_0x495033(0x203)](_0x47dd7a){const _0x10568b=a35_0x495033;await database_1[_0x10568b(0x21b)]['shop']['delete']({'where':{'id':_0x47dd7a}});}[a35_0x495033(0x215)](_0x2eb9ca,_0x38a6b5,_0x5d264c){const _0xaed3e1=a35_0x495033,_0x4a68be=new Map(),_0x1248a2=new Date(_0x38a6b5);while(_0x1248a2<=_0x5d264c){const _0x1221e7=_0x1248a2[_0xaed3e1(0x199)]()[_0xaed3e1(0x1c1)]('T')[0x0];_0x4a68be[_0xaed3e1(0x20d)](_0x1221e7,{'revenue':0x0,'count':0x0}),_0x1248a2[_0xaed3e1(0x143)](_0x1248a2[_0xaed3e1(0x207)]()+0x1);}for(const _0x31cb1b of _0x2eb9ca){const _0x4f59b5=_0x31cb1b[_0xaed3e1(0x18c)]['toISOString']()['split']('T')[0x0],_0x3e5073=_0x4a68be[_0xaed3e1(0x181)](_0x4f59b5);_0x3e5073&&(_0x3e5073['count']+=0x1,_0x31cb1b[_0xaed3e1(0x164)]===_0xaed3e1(0x1e5)&&(_0x31cb1b['amountUSDT']?_0x3e5073[_0xaed3e1(0x140)]+=_0x31cb1b[_0xaed3e1(0x152)]:console[_0xaed3e1(0x1f2)](_0xaed3e1(0x1c6)+_0x31cb1b['id']+_0xaed3e1(0x123))));}const _0x4b8599=[],_0x339877=[];for(const [_0x19a483,_0x490f59]of _0x4a68be){_0x4b8599[_0xaed3e1(0x12b)]({'date':_0x19a483,'amount':Math[_0xaed3e1(0x1ef)](_0x490f59[_0xaed3e1(0x140)]*0x64)/0x64}),_0x339877[_0xaed3e1(0x12b)]({'date':_0x19a483,'count':_0x490f59[_0xaed3e1(0x150)]});}return{'dailyRevenue':_0x4b8599,'dailyPayments':_0x339877};}}exports[a35_0x495033(0x172)]=AdminService;