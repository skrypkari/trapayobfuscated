'use strict';const a35_0x578865=a35_0x4a21;(function(_0x123bc0,_0x5b142e){const _0x490f8e=a35_0x4a21,_0x3b9699=_0x123bc0();while(!![]){try{const _0x578931=parseInt(_0x490f8e(0x1e0))/0x1+-parseInt(_0x490f8e(0x1a2))/0x2*(parseInt(_0x490f8e(0x1f1))/0x3)+parseInt(_0x490f8e(0x1cd))/0x4*(-parseInt(_0x490f8e(0x20e))/0x5)+parseInt(_0x490f8e(0x1f5))/0x6*(-parseInt(_0x490f8e(0x1ce))/0x7)+-parseInt(_0x490f8e(0x18a))/0x8*(-parseInt(_0x490f8e(0x229))/0x9)+parseInt(_0x490f8e(0x1a9))/0xa*(-parseInt(_0x490f8e(0x194))/0xb)+-parseInt(_0x490f8e(0x198))/0xc*(-parseInt(_0x490f8e(0x1b1))/0xd);if(_0x578931===_0x5b142e)break;else _0x3b9699['push'](_0x3b9699['shift']());}catch(_0x7d34){_0x3b9699['push'](_0x3b9699['shift']());}}}(a35_0x1d18,0x2df56));function a35_0x4a21(_0x214b6e,_0x5106f9){const _0x1d18ff=a35_0x1d18();return a35_0x4a21=function(_0x4a2141,_0x581e07){_0x4a2141=_0x4a2141-0x188;let _0x296ae4=_0x1d18ff[_0x4a2141];return _0x296ae4;},a35_0x4a21(_0x214b6e,_0x5106f9);}var __importDefault=this&&this[a35_0x578865(0x207)]||function(_0x153d28){const _0x3d063d=a35_0x578865;return _0x153d28&&_0x153d28[_0x3d063d(0x22a)]?_0x153d28:{'default':_0x153d28};};Object[a35_0x578865(0x1a6)](exports,a35_0x578865(0x22a),{'value':!![]}),exports['AdminService']=void 0x0;const database_1=__importDefault(require(a35_0x578865(0x224))),bcryptjs_1=__importDefault(require(a35_0x578865(0x1e9))),crypto_1=__importDefault(require('crypto')),currencyService_1=require(a35_0x578865(0x20d));function a35_0x1d18(){const _0x1a751f=['AdminService','customerEmail','Payment\x20not\x20found','stringify','üîÑ\x20Admin\x20updating\x20payment\x20','default','SUSPENDED','createUser','status','568168vncvKG','week','90d','\x20\x20\x20Payout\x20amount:\x20','updatedAt','\x20status:\x20','hex','\x20\x20\x20üñ•Ô∏è\x20User\x20Agent:\x20','_sum','currency','816211wZfzBq','‚úÖ\x20Payout\x20created:\x20','gatewaySettings','totalPayments','168HIqKhr','payout','averageCheckUSDT','shop','Error\x20processing\x20payment\x20','telegram','statusChangedBy','updatePaymentStatus','\x20USDT\x20(total\x20paid\x20to\x20merchants)','publicKey','12612FXBofD','customerUa','Telegram\x20username\x20already\x20exists','findMany','defineProperty','year','gateway','10VVGUca','KLYME\x20EU','not\x20set','üí∞\x20Current\x20shop\x20balance:\x20','30d','externalPaymentUrl','gte','totalPayout','525928jUZfgL','COMPLETED','CoinToPay','‚úÖ\x20Customer\x20data\x20updated\x20for\x20payment\x20','toLowerCase','amountUSDT','length','totalCommissionRate','periodFrom','localeCompare','üí∞\x20Creating\x20payout\x20for\x20shop\x20','telegramId','network','\x20no\x20longer\x20PAID:\x20-','\x20USDT\x20from\x20balance','üîÑ\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','admin','\x20\x20\x20Current\x20balance:\x20','usdcPolygonWallet','usdtPolygonWallet','üìä\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','parse','\x20USDT)','createPayout','turnover','chargebackAmount','dateTo','gatewayOrderId','1164556bKljaM','578774iosVop','\x20USDT\x20(','\x20USDT,\x20Requested:\x20','error','2020-01-01','getGatewayDisplayName','\x20\x20\x20üåê\x20IP:\x20','lte','values','paymentsCount','toUpperCase','Test\x20Gateway','REFUND','orderId','\x20to\x20','\x20USDT','\x20\x20\x20üí∞\x20Total\x20payout:\x20','getMerchantStatistics','257409PKqEvs','Shop\x20not\x20found','insensitive','createdAt','merchantEarningsUSDT','convertToUSDT','update','getMerchantsAwaitingPayout','toFixed','bcryptjs','create','adminNotes','name','period','merchantUrl','txid','currencyService','123gTZJQg','all','month','count','6FxYDRw','toString','paymentGateways','üí∞\x20Shop\x20','getMonth','\x20merchants,\x20','üí∞\x20Payment\x20','deleteUser','customerIp','password','whiteUrl','totalTurnover','set','\x20paid\x20payments\x20for\x20analysis','getTime','\x20became\x20PAID:\x20+','Rapyd','Username\x20already\x20exists','__importDefault','dateFrom','failureMessage','ACTIVE','commissionUSDT','\x20USDT\x20total','./currencyService','5mLmYyO','desc','CHARGEBACK','sk_','üìä\x20Calculating\x20payout\x20statistics...','payment','aggregate','thisMonth','usdtErcWallet','\x20\x20\x20üë§\x20Merchant\x20earnings:\x20','forEach','\x20\x20\x20Balance:\x20','gateways','üìä\x20Merchants\x20awaiting\x20payout:\x20','randomBytes','pendingUrl','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','paidAt','ceil','\x20USDT\x20(total\x20merchant\x20balances)','fullName','successUrl','../config/database','\x20for\x20shop\x20','username','Insufficient\x20balance.\x20Available:\x20','usdtTrcWallet','9wNJVpt','__esModule','statusChangedAt','periodTo','_count','üìä\x20Payout\x20statistics\x20calculated:','map','$transaction','amount','date','commission','getAllPayouts','PAID','updateCustomerData','notes','\x20->\x20','totalPaidOut','toISOString','wallets','string','\x20\x20\x20Total\x20paid\x20out:\x20','\x20\x20\x20üìä\x20Total\x20payments:\x20','\x20\x20\x20üåç\x20Country:\x20','shopUrl','awaitingPayout','split','round','getFullYear','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','Plisio','findUnique','\x20balance\x20updated:','deletePayout','\x20\x20\x20üìÖ\x20This\x20month:\x20','custom','averageCommissionRate','reduce','shopId','log','test_gateway','merchantEarnings','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','üîÑ\x20Updating\x20customer\x20data\x20for\x20payment\x20','customerCountry','\x20merchants\x20with\x20positive\x20balance','KLYME\x20GB','turnoverUSDT','balance','asc'];a35_0x1d18=function(){return _0x1a751f;};return a35_0x1d18();}class AdminService{async['getPayoutStats'](){const _0x46fcd0=a35_0x578865;console[_0x46fcd0(0x24f)](_0x46fcd0(0x212));const _0x55f27b=await database_1['default'][_0x46fcd0(0x19b)][_0x46fcd0(0x214)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x46fcd0(0x20a)}}),_0x5dbb31=new Date(),_0x4d78e2=new Date(_0x5dbb31[_0x46fcd0(0x244)](),_0x5dbb31[_0x46fcd0(0x1f9)](),0x1),_0x1c0599=new Date(_0x5dbb31['getFullYear'](),_0x5dbb31[_0x46fcd0(0x1f9)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x1b1c55=await database_1[_0x46fcd0(0x25f)][_0x46fcd0(0x199)][_0x46fcd0(0x214)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x4d78e2,'lte':_0x1c0599},'status':_0x46fcd0(0x1b2)}}),_0x2252ac=_0x55f27b[_0x46fcd0(0x192)][_0x46fcd0(0x239)]||0x0,_0x1172bf=_0x55f27b[_0x46fcd0(0x192)][_0x46fcd0(0x258)]||0x0,_0x5f4ba0=_0x1b1c55['_sum'][_0x46fcd0(0x231)]||0x0,_0x2331b3={'totalPayout':Math[_0x46fcd0(0x243)](_0x2252ac*0x64)/0x64,'awaitingPayout':Math[_0x46fcd0(0x243)](_0x1172bf*0x64)/0x64,'thisMonth':Math[_0x46fcd0(0x243)](_0x5f4ba0*0x64)/0x64,'availableBalance':Math['round'](_0x1172bf*0x64)/0x64};return console['log'](_0x46fcd0(0x22e)),console[_0x46fcd0(0x24f)](_0x46fcd0(0x1de)+_0x2331b3[_0x46fcd0(0x1b0)]+_0x46fcd0(0x1a0)),console['log'](_0x46fcd0(0x21e)+_0x2331b3[_0x46fcd0(0x241)]+_0x46fcd0(0x221)),console['log']('\x20\x20\x20üíµ\x20Available\x20balance:\x20'+_0x2331b3['availableBalance']+'\x20USDT\x20(same\x20as\x20awaiting)'),console['log'](_0x46fcd0(0x24a)+_0x2331b3[_0x46fcd0(0x215)]+_0x46fcd0(0x1dd)),_0x2331b3;}async[a35_0x578865(0x236)](_0x387739,_0x1f1ed6){const _0x45d403=a35_0x578865;console[_0x45d403(0x24f)](_0x45d403(0x253)+_0x387739+':',_0x1f1ed6);const _0x57c317=await database_1[_0x45d403(0x25f)]['payment']['findUnique']({'where':{'id':_0x387739},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x57c317)throw new Error(_0x45d403(0x25c));const _0x19ee53={};_0x1f1ed6['customerCountry']!==undefined&&(_0x19ee53[_0x45d403(0x254)]=_0x1f1ed6[_0x45d403(0x254)]||null);_0x1f1ed6[_0x45d403(0x1fd)]!==undefined&&(_0x19ee53[_0x45d403(0x1fd)]=_0x1f1ed6[_0x45d403(0x1fd)]||null);_0x1f1ed6['customerUa']!==undefined&&(_0x19ee53['customerUa']=_0x1f1ed6[_0x45d403(0x1a3)]||null);const _0x577474=await database_1['default']['payment'][_0x45d403(0x1e6)]({'where':{'id':_0x387739},'data':{..._0x19ee53,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console['log'](_0x45d403(0x1b4)+_0x387739),console[_0x45d403(0x24f)](_0x45d403(0x23f)+_0x57c317[_0x45d403(0x254)]+_0x45d403(0x238)+_0x577474['customerCountry']),console[_0x45d403(0x24f)](_0x45d403(0x1d4)+_0x57c317[_0x45d403(0x1fd)]+_0x45d403(0x238)+_0x577474[_0x45d403(0x1fd)]),console[_0x45d403(0x24f)](_0x45d403(0x191)+(_0x57c317[_0x45d403(0x1a3)]?_0x45d403(0x201):'not\x20set')+_0x45d403(0x238)+(_0x577474[_0x45d403(0x1a3)]?'set':_0x45d403(0x1ab))),_0x577474;}async['getSystemStatistics'](_0x1bc188){const _0x32e167=a35_0x578865,_0x19834d=new Date();let _0x141d4d;switch(_0x1bc188){case'7d':_0x141d4d=new Date(_0x19834d['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x32e167(0x1ad):_0x141d4d=new Date(_0x19834d[_0x32e167(0x203)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x32e167(0x18c):_0x141d4d=new Date(_0x19834d[_0x32e167(0x203)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x141d4d=new Date(_0x19834d[_0x32e167(0x203)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x502ae0,_0x38d2f1,_0x3e6308,_0x3605b3,_0x551121,_0x292449]=await Promise['all']([database_1['default'][_0x32e167(0x19b)][_0x32e167(0x1f4)](),database_1[_0x32e167(0x25f)][_0x32e167(0x19b)][_0x32e167(0x1f4)]({'where':{'status':_0x32e167(0x20a)}}),database_1[_0x32e167(0x25f)][_0x32e167(0x213)][_0x32e167(0x1f4)]({'where':{'createdAt':{'gte':_0x141d4d},'gateway':{'not':'test_gateway'}}}),database_1[_0x32e167(0x25f)][_0x32e167(0x213)][_0x32e167(0x1f4)]({'where':{'status':'PAID','createdAt':{'gte':_0x141d4d},'gateway':{'not':_0x32e167(0x250)}}}),database_1[_0x32e167(0x25f)][_0x32e167(0x213)]['findMany']({'where':{'status':_0x32e167(0x235),'createdAt':{'gte':_0x141d4d},'gateway':{'not':_0x32e167(0x250)}},'select':{'amount':!![],'currency':!![]}}),database_1[_0x32e167(0x25f)][_0x32e167(0x213)]['findMany']({'where':{'gateway':{'not':_0x32e167(0x250)}},'take':0xa,'orderBy':{'createdAt':_0x32e167(0x20f)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}})]);let _0x1fdec1=0x0;for(const _0x2c5eef of _0x551121){const _0x36996f=await currencyService_1['currencyService'][_0x32e167(0x1e5)](_0x2c5eef[_0x32e167(0x231)],_0x2c5eef['currency']);_0x1fdec1+=_0x36996f;}const _0x1313cc=_0x3e6308>0x0?_0x3605b3/_0x3e6308*0x64:0x0;return{'totalShops':_0x502ae0,'activeShops':_0x38d2f1,'totalPayments':_0x3e6308,'successfulPayments':_0x3605b3,'totalRevenue':Math[_0x32e167(0x243)](_0x1fdec1*0x64)/0x64,'conversionRate':Math['round'](_0x1313cc*0x64)/0x64,'recentPayments':_0x292449['map'](_0x4d85e0=>({'id':_0x4d85e0['id'],'amount':_0x4d85e0[_0x32e167(0x231)],'currency':_0x4d85e0[_0x32e167(0x193)],'status':_0x4d85e0[_0x32e167(0x189)],'gateway':_0x4d85e0[_0x32e167(0x1a8)],'shop':_0x4d85e0[_0x32e167(0x19b)],'createdAt':_0x4d85e0[_0x32e167(0x1e3)]}))};}async[a35_0x578865(0x1df)](_0x31d899){const _0x7b6a62=a35_0x578865;console[_0x7b6a62(0x24f)]('üìä\x20Getting\x20merchant\x20statistics\x20with\x20filters:',_0x31d899);let _0x2865d9,_0x49b61a=new Date();if(_0x31d899[_0x7b6a62(0x1ed)]===_0x7b6a62(0x24b)&&_0x31d899[_0x7b6a62(0x208)]&&_0x31d899['dateTo'])_0x2865d9=new Date(_0x31d899[_0x7b6a62(0x208)]),_0x49b61a=new Date(_0x31d899[_0x7b6a62(0x1cb)]);else{const _0x39c39a=new Date();switch(_0x31d899[_0x7b6a62(0x1ed)]){case _0x7b6a62(0x18b):_0x2865d9=new Date(_0x39c39a[_0x7b6a62(0x203)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x7b6a62(0x1f3):_0x2865d9=new Date(_0x39c39a[_0x7b6a62(0x203)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x7b6a62(0x1a7):_0x2865d9=new Date(_0x39c39a[_0x7b6a62(0x203)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x7b6a62(0x1f2):default:_0x2865d9=new Date(_0x7b6a62(0x1d2));break;}}console[_0x7b6a62(0x24f)]('üìÖ\x20Period:\x20'+_0x2865d9[_0x7b6a62(0x23a)]()+_0x7b6a62(0x1dc)+_0x49b61a['toISOString']());const _0x51ad26={'status':_0x7b6a62(0x235),'gateway':{'not':'test_gateway'},'paidAt':{'gte':_0x2865d9,'lte':_0x49b61a}};_0x31d899[_0x7b6a62(0x24e)]&&(_0x51ad26[_0x7b6a62(0x24e)]=_0x31d899[_0x7b6a62(0x24e)]);const _0x9797a3=await database_1[_0x7b6a62(0x25f)][_0x7b6a62(0x213)][_0x7b6a62(0x1a5)]({'where':_0x51ad26,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console['log']('üí∞\x20Found\x20'+_0x9797a3[_0x7b6a62(0x1b7)]+_0x7b6a62(0x202));let _0x2768a6=0x0,_0x1f62c0=0x0,_0x2912bb=0x0;const _0x2f47a7={},_0x359182={},_0x453d24={};for(const _0x120548 of _0x9797a3){try{const _0x2bfb55=await currencyService_1[_0x7b6a62(0x1f0)][_0x7b6a62(0x1e5)](_0x120548['amount'],_0x120548[_0x7b6a62(0x193)]);let _0x30350f={};if(_0x120548[_0x7b6a62(0x19b)]['gatewaySettings'])try{_0x30350f=JSON['parse'](_0x120548[_0x7b6a62(0x19b)][_0x7b6a62(0x196)]);}catch(_0x45a00d){console['error'](_0x7b6a62(0x252)+_0x120548[_0x7b6a62(0x24e)]+':',_0x45a00d);}const _0x4a5f75=_0x30350f[_0x7b6a62(0x233)]||0xa,_0x374c7d=_0x2bfb55*(_0x4a5f75/0x64),_0x1aff5a=_0x2bfb55-_0x374c7d;_0x2768a6+=_0x2bfb55,_0x1f62c0+=_0x1aff5a,_0x2912bb+=_0x374c7d;!_0x2f47a7[_0x120548[_0x7b6a62(0x1a8)]]&&(_0x2f47a7[_0x120548[_0x7b6a62(0x1a8)]]={'gateway':_0x120548[_0x7b6a62(0x1a8)],'gatewayDisplayName':this['getGatewayDisplayName'](_0x120548[_0x7b6a62(0x1a8)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x2f47a7[_0x120548[_0x7b6a62(0x1a8)]]['paymentsCount']++,_0x2f47a7[_0x120548[_0x7b6a62(0x1a8)]][_0x7b6a62(0x257)]+=_0x2bfb55,_0x2f47a7[_0x120548[_0x7b6a62(0x1a8)]]['commissionUSDT']+=_0x374c7d,_0x2f47a7[_0x120548['gateway']]['merchantEarningsUSDT']+=_0x1aff5a,_0x2f47a7[_0x120548[_0x7b6a62(0x1a8)]]['totalCommissionRate']+=_0x4a5f75;!_0x31d899['shopId']&&(!_0x359182[_0x120548[_0x7b6a62(0x24e)]]&&(_0x359182[_0x120548[_0x7b6a62(0x24e)]]={'shopId':_0x120548['shopId'],'shopName':_0x120548[_0x7b6a62(0x19b)]['name'],'shopUsername':_0x120548['shop'][_0x7b6a62(0x226)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x359182[_0x120548['shopId']]['paymentsCount']++,_0x359182[_0x120548[_0x7b6a62(0x24e)]]['turnoverUSDT']+=_0x2bfb55,_0x359182[_0x120548[_0x7b6a62(0x24e)]][_0x7b6a62(0x20b)]+=_0x374c7d,_0x359182[_0x120548[_0x7b6a62(0x24e)]]['merchantEarningsUSDT']+=_0x1aff5a);const _0x398dde=_0x120548[_0x7b6a62(0x21f)][_0x7b6a62(0x23a)]()[_0x7b6a62(0x242)]('T')[0x0];!_0x453d24[_0x398dde]&&(_0x453d24[_0x398dde]={'date':_0x398dde,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x453d24[_0x398dde][_0x7b6a62(0x1c9)]+=_0x2bfb55,_0x453d24[_0x398dde][_0x7b6a62(0x251)]+=_0x1aff5a,_0x453d24[_0x398dde]['gatewayEarnings']+=_0x374c7d,_0x453d24[_0x398dde]['paymentsCount']++;}catch(_0x5289b0){console[_0x7b6a62(0x1d1)](_0x7b6a62(0x19c)+_0x120548['id']+':',_0x5289b0);}}Object[_0x7b6a62(0x1d6)](_0x2f47a7)[_0x7b6a62(0x218)](_0x26296a=>{const _0x190c79=_0x7b6a62;_0x26296a[_0x190c79(0x24c)]=_0x26296a[_0x190c79(0x1d7)]>0x0?_0x26296a[_0x190c79(0x1b8)]/_0x26296a['paymentsCount']:0x0,delete _0x26296a['totalCommissionRate'];}),Object['values'](_0x359182)[_0x7b6a62(0x218)](_0x507163=>{const _0x570c04=_0x7b6a62;_0x507163[_0x570c04(0x19a)]=_0x507163[_0x570c04(0x1d7)]>0x0?_0x507163[_0x570c04(0x257)]/_0x507163['paymentsCount']:0x0;});let _0x51b737=0x0;if(_0x31d899[_0x7b6a62(0x24e)]){const _0x41efdf=await database_1['default'][_0x7b6a62(0x199)][_0x7b6a62(0x1a5)]({'where':{'shopId':_0x31d899[_0x7b6a62(0x24e)],'status':_0x7b6a62(0x1b2),'createdAt':{'gte':_0x2865d9,'lte':_0x49b61a}},'select':{'amount':!![]}});_0x51b737=_0x41efdf[_0x7b6a62(0x24d)]((_0x18cbb0,_0x32fbff)=>_0x18cbb0+_0x32fbff[_0x7b6a62(0x231)],0x0);}const _0x4800de=_0x9797a3['length'],_0x3945e0=_0x9797a3[_0x7b6a62(0x1b7)],_0x30a0d8=_0x4800de>0x0?_0x2768a6/_0x4800de:0x0,_0xcdf8d0=0x64,_0x445022=Math['ceil']((_0x49b61a[_0x7b6a62(0x203)]()-_0x2865d9[_0x7b6a62(0x203)]())/(0x3e8*0x3c*0x3c*0x18)),_0x51dfbb={'totalTurnover':Math[_0x7b6a62(0x243)](_0x2768a6*0x64)/0x64,'merchantEarnings':Math[_0x7b6a62(0x243)](_0x1f62c0*0x64)/0x64,'gatewayEarnings':Math[_0x7b6a62(0x243)](_0x2912bb*0x64)/0x64,'totalPaidOut':Math[_0x7b6a62(0x243)](_0x51b737*0x64)/0x64,'averageCheck':Math[_0x7b6a62(0x243)](_0x30a0d8*0x64)/0x64,'totalPayments':_0x4800de,'successfulPayments':_0x3945e0,'conversionRate':_0xcdf8d0,'gatewayBreakdown':Object[_0x7b6a62(0x1d6)](_0x2f47a7)[_0x7b6a62(0x22f)](_0x1b5efb=>({..._0x1b5efb,'turnoverUSDT':Math['round'](_0x1b5efb[_0x7b6a62(0x257)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x1b5efb['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x7b6a62(0x243)](_0x1b5efb['merchantEarningsUSDT']*0x64)/0x64,'averageCommissionRate':Math[_0x7b6a62(0x243)](_0x1b5efb[_0x7b6a62(0x24c)]*0x64)/0x64})),'merchantBreakdown':_0x31d899[_0x7b6a62(0x24e)]?undefined:Object[_0x7b6a62(0x1d6)](_0x359182)['map'](_0x4e3d78=>({..._0x4e3d78,'turnoverUSDT':Math[_0x7b6a62(0x243)](_0x4e3d78[_0x7b6a62(0x257)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x4e3d78[_0x7b6a62(0x20b)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x7b6a62(0x243)](_0x4e3d78[_0x7b6a62(0x1e4)]*0x64)/0x64,'paidOutUSDT':Math[_0x7b6a62(0x243)](_0x4e3d78['paidOutUSDT']*0x64)/0x64,'averageCheckUSDT':Math[_0x7b6a62(0x243)](_0x4e3d78[_0x7b6a62(0x19a)]*0x64)/0x64})),'dailyData':Object['values'](_0x453d24)['map'](_0x199879=>({..._0x199879,'turnover':Math[_0x7b6a62(0x243)](_0x199879[_0x7b6a62(0x1c9)]*0x64)/0x64,'merchantEarnings':Math['round'](_0x199879['merchantEarnings']*0x64)/0x64,'gatewayEarnings':Math[_0x7b6a62(0x243)](_0x199879['gatewayEarnings']*0x64)/0x64}))['sort']((_0x513daf,_0x2623e5)=>_0x513daf[_0x7b6a62(0x232)][_0x7b6a62(0x1ba)](_0x2623e5[_0x7b6a62(0x232)])),'periodInfo':{'from':_0x2865d9,'to':_0x49b61a,'periodType':_0x31d899[_0x7b6a62(0x1ed)]||_0x7b6a62(0x24b),'daysCount':_0x445022}};return console[_0x7b6a62(0x24f)]('üìä\x20Merchant\x20statistics\x20calculated:'),console[_0x7b6a62(0x24f)]('\x20\x20\x20üí∞\x20Total\x20turnover:\x20'+_0x51dfbb[_0x7b6a62(0x200)]+_0x7b6a62(0x1dd)),console[_0x7b6a62(0x24f)](_0x7b6a62(0x217)+_0x51dfbb[_0x7b6a62(0x251)]+_0x7b6a62(0x1dd)),console['log']('\x20\x20\x20üè™\x20Gateway\x20earnings:\x20'+_0x51dfbb['gatewayEarnings']+_0x7b6a62(0x1dd)),console[_0x7b6a62(0x24f)](_0x7b6a62(0x23e)+_0x51dfbb[_0x7b6a62(0x197)]),_0x51dfbb;}[a35_0x578865(0x1d3)](_0x1cc4ef){const _0x1ddc0f=a35_0x578865,_0x28ae10={'test_gateway':_0x1ddc0f(0x1d9),'plisio':_0x1ddc0f(0x246),'rapyd':_0x1ddc0f(0x205),'noda':'Noda','cointopay':_0x1ddc0f(0x1b3),'klyme_eu':_0x1ddc0f(0x1aa),'klyme_gb':_0x1ddc0f(0x256),'klyme_de':'KLYME\x20DE'};return _0x28ae10[_0x1cc4ef]||_0x1cc4ef;}async[a35_0x578865(0x1e7)](_0x30fb52){const _0xeca39e=a35_0x578865,{page:_0x31e91b,limit:_0x75c9fa,minAmount:_0x30a750,search:_0x4778cc}=_0x30fb52,_0x451796=(_0x31e91b-0x1)*_0x75c9fa;console[_0xeca39e(0x24f)](_0xeca39e(0x1c5),_0x30fb52);const _0x484d3e={'balance':{'gt':0x0},'status':_0xeca39e(0x20a)};_0x30a750&&(_0x484d3e[_0xeca39e(0x258)][_0xeca39e(0x1af)]=_0x30a750);_0x4778cc&&(_0x484d3e['OR']=[{'name':{'contains':_0x4778cc,'mode':_0xeca39e(0x1e2)}},{'username':{'contains':_0x4778cc,'mode':_0xeca39e(0x1e2)}}]);const [_0x2559aa,_0x222947]=await Promise[_0xeca39e(0x1f2)]([database_1[_0xeca39e(0x25f)][_0xeca39e(0x19b)]['findMany']({'where':_0x484d3e,'skip':_0x451796,'take':_0x75c9fa,'orderBy':{'balance':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'createdAt':!![]}}),database_1[_0xeca39e(0x25f)][_0xeca39e(0x19b)][_0xeca39e(0x1f4)]({'where':_0x484d3e})]);console[_0xeca39e(0x24f)]('üí∞\x20Found\x20'+_0x2559aa[_0xeca39e(0x1b7)]+_0xeca39e(0x255));const _0x267688=await Promise['all'](_0x2559aa[_0xeca39e(0x22f)](async _0x4d5cac=>{const _0x45709e=_0xeca39e,[_0x2d6cdf,_0x4d07ff,_0x4ea016]=await Promise[_0x45709e(0x1f2)]([database_1[_0x45709e(0x25f)][_0x45709e(0x213)][_0x45709e(0x1f4)]({'where':{'shopId':_0x4d5cac['id'],'status':_0x45709e(0x235),'amountUSDT':{'not':null}}}),database_1['default'][_0x45709e(0x213)]['findFirst']({'where':{'shopId':_0x4d5cac['id'],'status':_0x45709e(0x235),'amountUSDT':{'not':null}},'orderBy':{'paidAt':_0x45709e(0x259)},'select':{'paidAt':!![]}}),database_1[_0x45709e(0x25f)]['payment']['groupBy']({'by':[_0x45709e(0x1a8)],'where':{'shopId':_0x4d5cac['id'],'status':_0x45709e(0x235),'amountUSDT':{'not':null}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x4c9cd9=_0x4ea016[_0x45709e(0x22f)](_0x450e7f=>({'gateway':_0x450e7f[_0x45709e(0x1a8)],'count':_0x450e7f[_0x45709e(0x22d)]['id'],'amountUSDT':_0x450e7f[_0x45709e(0x192)][_0x45709e(0x1b6)]||0x0,'amountAfterCommissionUSDT':_0x450e7f[_0x45709e(0x192)][_0x45709e(0x1b6)]||0x0,'commission':0x0}));return{'id':_0x4d5cac['id'],'fullName':_0x4d5cac[_0x45709e(0x1ec)],'username':_0x4d5cac[_0x45709e(0x226)],'telegramId':_0x4d5cac[_0x45709e(0x19d)],'merchantUrl':_0x4d5cac[_0x45709e(0x240)],'wallets':{'usdtPolygonWallet':_0x4d5cac[_0x45709e(0x1c4)],'usdtTrcWallet':_0x4d5cac['usdtTrcWallet'],'usdtErcWallet':_0x4d5cac['usdtErcWallet'],'usdcPolygonWallet':_0x4d5cac[_0x45709e(0x1c3)]},'totalAmountUSDT':_0x4d5cac[_0x45709e(0x258)],'totalAmountAfterCommissionUSDT':_0x4d5cac[_0x45709e(0x258)],'paymentsCount':_0x2d6cdf,'oldestPaymentDate':_0x4d07ff?.[_0x45709e(0x21f)]||_0x4d5cac[_0x45709e(0x1e3)],'gatewayBreakdown':_0x4c9cd9};})),_0x208fd8=_0x2559aa[_0xeca39e(0x24d)]((_0x886d6d,_0x43b988)=>_0x886d6d+_0x43b988[_0xeca39e(0x258)],0x0),_0x37add7=_0x208fd8;return console[_0xeca39e(0x24f)](_0xeca39e(0x21b)+_0x222947+_0xeca39e(0x1fa)+Math[_0xeca39e(0x243)](_0x37add7*0x64)/0x64+_0xeca39e(0x20c)),{'merchants':_0x267688,'pagination':{'page':_0x31e91b,'limit':_0x75c9fa,'total':_0x222947,'totalPages':Math[_0xeca39e(0x220)](_0x222947/_0x75c9fa)},'summary':{'totalMerchants':_0x222947,'totalAmountUSDT':Math[_0xeca39e(0x243)](_0x208fd8*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x37add7*0x64)/0x64}};}async[a35_0x578865(0x1c8)](_0x83e4ee){const _0x4fb6d6=a35_0x578865,{shopId:_0x252fcf,amount:_0x3277f9,network:_0x3e64d2,notes:_0x1afde3,periodFrom:_0x26d7e7,periodTo:_0x5eb4ec}=_0x83e4ee,_0x447856=await database_1[_0x4fb6d6(0x25f)][_0x4fb6d6(0x230)](async _0x347731=>{const _0x5d3db1=_0x4fb6d6,_0x1b62e4=await _0x347731[_0x5d3db1(0x19b)][_0x5d3db1(0x247)]({'where':{'id':_0x252fcf},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x1b62e4)throw new Error(_0x5d3db1(0x1e1));console['log'](_0x5d3db1(0x1bb)+_0x1b62e4[_0x5d3db1(0x226)]+':'),console[_0x5d3db1(0x24f)](_0x5d3db1(0x1c2)+_0x1b62e4[_0x5d3db1(0x258)][_0x5d3db1(0x1e8)](0x6)+_0x5d3db1(0x1dd)),console[_0x5d3db1(0x24f)](_0x5d3db1(0x18d)+_0x3277f9[_0x5d3db1(0x1e8)](0x6)+'\x20USDT'),console[_0x5d3db1(0x24f)](_0x5d3db1(0x245)+_0x1b62e4[_0x5d3db1(0x239)][_0x5d3db1(0x1e8)](0x6)+'\x20USDT');if(_0x1b62e4[_0x5d3db1(0x258)]<_0x3277f9)throw new Error(_0x5d3db1(0x227)+_0x1b62e4[_0x5d3db1(0x258)]['toFixed'](0x6)+_0x5d3db1(0x1d0)+_0x3277f9['toFixed'](0x6)+_0x5d3db1(0x1dd));const _0x7bdb79=await _0x347731[_0x5d3db1(0x199)][_0x5d3db1(0x1ea)]({'data':{'shopId':_0x252fcf,'amount':_0x3277f9,'network':_0x3e64d2,'status':'COMPLETED','notes':_0x1afde3,'periodFrom':_0x26d7e7?new Date(_0x26d7e7):null,'periodTo':_0x5eb4ec?new Date(_0x5eb4ec):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x294734=_0x1b62e4[_0x5d3db1(0x258)]-_0x3277f9,_0x2d7d03=_0x1b62e4[_0x5d3db1(0x239)]+_0x3277f9;return await _0x347731[_0x5d3db1(0x19b)]['update']({'where':{'id':_0x252fcf},'data':{'balance':_0x294734,'totalPaidOut':_0x2d7d03}}),console[_0x5d3db1(0x24f)]('üí∞\x20Shop\x20'+_0x1b62e4[_0x5d3db1(0x226)]+_0x5d3db1(0x248)),console[_0x5d3db1(0x24f)](_0x5d3db1(0x219)+_0x1b62e4[_0x5d3db1(0x258)][_0x5d3db1(0x1e8)](0x6)+_0x5d3db1(0x238)+_0x294734['toFixed'](0x6)+'\x20USDT\x20(-'+_0x3277f9['toFixed'](0x6)+')'),console[_0x5d3db1(0x24f)](_0x5d3db1(0x23d)+_0x1b62e4[_0x5d3db1(0x239)]['toFixed'](0x6)+'\x20->\x20'+_0x2d7d03[_0x5d3db1(0x1e8)](0x6)+'\x20USDT\x20(+'+_0x3277f9[_0x5d3db1(0x1e8)](0x6)+')'),{'payout':_0x7bdb79,'shop':_0x1b62e4};});return console[_0x4fb6d6(0x24f)](_0x4fb6d6(0x195)+_0x447856['payout']['id']+_0x4fb6d6(0x225)+_0x447856[_0x4fb6d6(0x19b)][_0x4fb6d6(0x226)]+'\x20('+_0x3277f9+_0x4fb6d6(0x1c7)),{'id':_0x447856['payout']['id'],'shopId':_0x447856['payout'][_0x4fb6d6(0x24e)],'shopName':_0x447856[_0x4fb6d6(0x19b)][_0x4fb6d6(0x1ec)],'shopUsername':_0x447856[_0x4fb6d6(0x19b)][_0x4fb6d6(0x226)],'amount':_0x447856[_0x4fb6d6(0x199)][_0x4fb6d6(0x231)],'network':_0x447856[_0x4fb6d6(0x199)][_0x4fb6d6(0x1bd)],'status':_0x447856[_0x4fb6d6(0x199)]['status'],'txid':_0x447856[_0x4fb6d6(0x199)][_0x4fb6d6(0x1ef)],'notes':_0x447856[_0x4fb6d6(0x199)]['notes'],'periodFrom':_0x447856[_0x4fb6d6(0x199)][_0x4fb6d6(0x1b9)],'periodTo':_0x447856['payout'][_0x4fb6d6(0x22c)],'createdAt':_0x447856['payout'][_0x4fb6d6(0x1e3)],'paidAt':_0x447856[_0x4fb6d6(0x199)][_0x4fb6d6(0x21f)]};}async[a35_0x578865(0x234)](_0x1399c5){const _0x227be9=a35_0x578865,{page:_0x136c8c,limit:_0x22e414,shopId:_0x4f32be,network:_0x2b66fa,dateFrom:_0x2bf7b9,dateTo:_0x2b013,search:_0x54690d}=_0x1399c5,_0x235b34=(_0x136c8c-0x1)*_0x22e414,_0x2bc36b={};_0x4f32be&&(_0x2bc36b[_0x227be9(0x24e)]=_0x4f32be);_0x2b66fa&&(_0x2bc36b[_0x227be9(0x1bd)]=_0x2b66fa);(_0x2bf7b9||_0x2b013)&&(_0x2bc36b[_0x227be9(0x1e3)]={},_0x2bf7b9&&(_0x2bc36b['createdAt']['gte']=new Date(_0x2bf7b9)),_0x2b013&&(_0x2bc36b[_0x227be9(0x1e3)][_0x227be9(0x1d5)]=new Date(_0x2b013)));_0x54690d&&(_0x2bc36b['OR']=[{'shop':{'name':{'contains':_0x54690d,'mode':_0x227be9(0x1e2)}}},{'shop':{'username':{'contains':_0x54690d,'mode':_0x227be9(0x1e2)}}},{'notes':{'contains':_0x54690d,'mode':_0x227be9(0x1e2)}}]);const [_0x44fd68,_0x107b5d]=await Promise[_0x227be9(0x1f2)]([database_1['default'][_0x227be9(0x199)][_0x227be9(0x1a5)]({'where':_0x2bc36b,'skip':_0x235b34,'take':_0x22e414,'orderBy':{'createdAt':_0x227be9(0x20f)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x227be9(0x25f)]['payout']['count']({'where':_0x2bc36b})]);return{'payouts':_0x44fd68[_0x227be9(0x22f)](_0x4068b6=>({'id':_0x4068b6['id'],'shopId':_0x4068b6['shopId'],'shopName':_0x4068b6[_0x227be9(0x19b)][_0x227be9(0x1ec)],'shopUsername':_0x4068b6[_0x227be9(0x19b)]['username'],'amount':_0x4068b6[_0x227be9(0x231)],'network':_0x4068b6[_0x227be9(0x1bd)],'status':_0x4068b6[_0x227be9(0x189)],'txid':_0x4068b6[_0x227be9(0x1ef)],'notes':_0x4068b6['notes'],'periodFrom':_0x4068b6[_0x227be9(0x1b9)],'periodTo':_0x4068b6[_0x227be9(0x22c)],'createdAt':_0x4068b6[_0x227be9(0x1e3)],'paidAt':_0x4068b6['paidAt']})),'pagination':{'page':_0x136c8c,'limit':_0x22e414,'total':_0x107b5d,'totalPages':Math[_0x227be9(0x220)](_0x107b5d/_0x22e414)}};}async['getPayoutById'](_0x4a77d1){const _0x4c3e1c=a35_0x578865,_0x25ab67=await database_1[_0x4c3e1c(0x25f)][_0x4c3e1c(0x199)][_0x4c3e1c(0x247)]({'where':{'id':_0x4a77d1},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x25ab67)return null;return{'id':_0x25ab67['id'],'shopId':_0x25ab67[_0x4c3e1c(0x24e)],'shopName':_0x25ab67[_0x4c3e1c(0x19b)][_0x4c3e1c(0x1ec)],'shopUsername':_0x25ab67[_0x4c3e1c(0x19b)]['username'],'amount':_0x25ab67[_0x4c3e1c(0x231)],'network':_0x25ab67['network'],'status':_0x25ab67['status'],'txid':_0x25ab67[_0x4c3e1c(0x1ef)],'notes':_0x25ab67[_0x4c3e1c(0x237)],'periodFrom':_0x25ab67['periodFrom'],'periodTo':_0x25ab67[_0x4c3e1c(0x22c)],'createdAt':_0x25ab67[_0x4c3e1c(0x1e3)],'paidAt':_0x25ab67['paidAt']};}async[a35_0x578865(0x249)](_0x131c24){const _0x5b439e=a35_0x578865;await database_1[_0x5b439e(0x25f)][_0x5b439e(0x199)]['delete']({'where':{'id':_0x131c24}});}async['getAllPayments'](_0x5ed7ee){const _0xbfa9f9=a35_0x578865,{page:_0x5c31ab,limit:_0x15b05c,status:_0x53ffae,gateway:_0x102589,shopId:_0x3d2ae5,dateFrom:_0x4f27c1,dateTo:_0x3688ae,search:_0x30adb2}=_0x5ed7ee,_0x238e98=(_0x5c31ab-0x1)*_0x15b05c,_0x35bc43={};_0x53ffae&&(_0x35bc43[_0xbfa9f9(0x189)]=_0x53ffae[_0xbfa9f9(0x1d8)]());_0x102589&&(_0x35bc43[_0xbfa9f9(0x1a8)]=_0x102589[_0xbfa9f9(0x1b5)]());_0x35bc43[_0xbfa9f9(0x1a8)]=_0x35bc43[_0xbfa9f9(0x1a8)]?_0x35bc43[_0xbfa9f9(0x1a8)]:{'not':_0xbfa9f9(0x250)};if(typeof _0x35bc43[_0xbfa9f9(0x1a8)]==='string'&&_0x35bc43[_0xbfa9f9(0x1a8)]!==_0xbfa9f9(0x250)){}else{if(typeof _0x35bc43[_0xbfa9f9(0x1a8)]===_0xbfa9f9(0x23c)&&_0x35bc43[_0xbfa9f9(0x1a8)]===_0xbfa9f9(0x250)){}else _0x35bc43[_0xbfa9f9(0x1a8)]={'not':_0xbfa9f9(0x250)};}_0x3d2ae5&&(_0x35bc43['shopId']=_0x3d2ae5);(_0x4f27c1||_0x3688ae)&&(_0x35bc43[_0xbfa9f9(0x1e3)]={},_0x4f27c1&&(_0x35bc43['createdAt'][_0xbfa9f9(0x1af)]=new Date(_0x4f27c1)),_0x3688ae&&(_0x35bc43[_0xbfa9f9(0x1e3)][_0xbfa9f9(0x1d5)]=new Date(_0x3688ae)));_0x30adb2&&(_0x35bc43['OR']=[{'orderId':{'contains':_0x30adb2,'mode':_0xbfa9f9(0x1e2)}},{'gatewayOrderId':{'contains':_0x30adb2,'mode':_0xbfa9f9(0x1e2)}},{'customerEmail':{'contains':_0x30adb2,'mode':_0xbfa9f9(0x1e2)}},{'shop':{'name':{'contains':_0x30adb2,'mode':_0xbfa9f9(0x1e2)}}},{'shop':{'username':{'contains':_0x30adb2,'mode':_0xbfa9f9(0x1e2)}}}]);const [_0x2a0cab,_0x4deba6]=await Promise[_0xbfa9f9(0x1f2)]([database_1[_0xbfa9f9(0x25f)][_0xbfa9f9(0x213)][_0xbfa9f9(0x1a5)]({'where':_0x35bc43,'skip':_0x238e98,'take':_0x15b05c,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0xbfa9f9(0x25f)][_0xbfa9f9(0x213)][_0xbfa9f9(0x1f4)]({'where':_0x35bc43})]);return{'payments':_0x2a0cab['map'](_0x26161e=>({'id':_0x26161e['id'],'shopId':_0x26161e['shopId'],'gateway':_0x26161e[_0xbfa9f9(0x1a8)],'amount':_0x26161e[_0xbfa9f9(0x231)],'currency':_0x26161e['currency'],'status':_0x26161e[_0xbfa9f9(0x189)],'orderId':_0x26161e[_0xbfa9f9(0x1db)],'gatewayOrderId':_0x26161e[_0xbfa9f9(0x1cc)],'customerEmail':_0x26161e['customerEmail'],'customerName':_0x26161e['customerName'],'customerCountry':_0x26161e['customerCountry'],'customerIp':_0x26161e[_0xbfa9f9(0x1fd)],'customerUa':_0x26161e[_0xbfa9f9(0x1a3)],'failureMessage':_0x26161e['failureMessage'],'createdAt':_0x26161e[_0xbfa9f9(0x1e3)],'updatedAt':_0x26161e[_0xbfa9f9(0x18e)],'shop':_0x26161e[_0xbfa9f9(0x19b)]})),'pagination':{'page':_0x5c31ab,'limit':_0x15b05c,'total':_0x4deba6,'totalPages':Math[_0xbfa9f9(0x220)](_0x4deba6/_0x15b05c)}};}async['getPaymentById'](_0x56273e){const _0x5df158=a35_0x578865,_0x1a6d90=await database_1[_0x5df158(0x25f)]['payment'][_0x5df158(0x247)]({'where':{'id':_0x56273e},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x1a6d90)return null;return{'id':_0x1a6d90['id'],'shopId':_0x1a6d90['shopId'],'gateway':_0x1a6d90['gateway'],'amount':_0x1a6d90[_0x5df158(0x231)],'currency':_0x1a6d90['currency'],'status':_0x1a6d90[_0x5df158(0x189)],'orderId':_0x1a6d90[_0x5df158(0x1db)],'gatewayOrderId':_0x1a6d90[_0x5df158(0x1cc)],'customerEmail':_0x1a6d90['customerEmail'],'customerName':_0x1a6d90['customerName'],'customerCountry':_0x1a6d90['customerCountry'],'customerIp':_0x1a6d90[_0x5df158(0x1fd)],'customerUa':_0x1a6d90[_0x5df158(0x1a3)],'failureMessage':_0x1a6d90[_0x5df158(0x209)],'externalPaymentUrl':_0x1a6d90[_0x5df158(0x1ae)],'successUrl':_0x1a6d90[_0x5df158(0x223)],'failUrl':_0x1a6d90['failUrl'],'pendingUrl':_0x1a6d90[_0x5df158(0x21d)],'whiteUrl':_0x1a6d90[_0x5df158(0x1ff)],'createdAt':_0x1a6d90[_0x5df158(0x1e3)],'updatedAt':_0x1a6d90[_0x5df158(0x18e)],'shop':_0x1a6d90[_0x5df158(0x19b)]};}async[a35_0x578865(0x19f)](_0x2bda85,_0x2ee116,_0x1b72ec,_0x2a5c0c){const _0x538006=a35_0x578865,_0x4ffd35=await database_1[_0x538006(0x25f)][_0x538006(0x230)](async _0x26844a=>{const _0x165dbe=_0x538006,_0x588e12=await _0x26844a['payment'][_0x165dbe(0x247)]({'where':{'id':_0x2bda85},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x588e12)throw new Error(_0x165dbe(0x25c));const _0x172c62=_0x588e12['status'],_0x30a7f7=_0x2ee116[_0x165dbe(0x1d8)]();console[_0x165dbe(0x24f)](_0x165dbe(0x25e)+_0x2bda85+_0x165dbe(0x18f)+_0x172c62+_0x165dbe(0x238)+_0x30a7f7),console[_0x165dbe(0x24f)](_0x165dbe(0x1ac)+_0x588e12[_0x165dbe(0x19b)][_0x165dbe(0x258)]+_0x165dbe(0x1dd));const _0x1edc2e={'status':_0x30a7f7,'updatedAt':new Date(),'statusChangedBy':_0x165dbe(0x1c1),'statusChangedAt':new Date()};_0x1b72ec&&(_0x1edc2e['adminNotes']=_0x1b72ec);_0x30a7f7===_0x165dbe(0x210)&&_0x2a5c0c&&(_0x1edc2e[_0x165dbe(0x1ca)]=_0x2a5c0c);let _0xc520a5=0x0,_0x5674d7=_0x588e12[_0x165dbe(0x19b)][_0x165dbe(0x258)];if(_0x30a7f7===_0x165dbe(0x235)&&_0x172c62!=='PAID'){_0x1edc2e['paidAt']=new Date();const _0x30c1a7=await currencyService_1[_0x165dbe(0x1f0)][_0x165dbe(0x1e5)](_0x588e12[_0x165dbe(0x231)],_0x588e12['currency']);_0x1edc2e['amountUSDT']=_0x30c1a7,_0xc520a5=_0x30c1a7,_0x5674d7+=_0x30c1a7,console[_0x165dbe(0x24f)](_0x165dbe(0x1fb)+_0x2bda85+_0x165dbe(0x204)+_0x30c1a7['toFixed'](0x6)+'\x20USDT\x20to\x20balance');}else _0x172c62===_0x165dbe(0x235)&&_0x30a7f7!=='PAID'&&(_0x588e12[_0x165dbe(0x1b6)]&&(_0xc520a5=-_0x588e12[_0x165dbe(0x1b6)],_0x5674d7-=_0x588e12['amountUSDT'],_0x1edc2e[_0x165dbe(0x1b6)]=null,console[_0x165dbe(0x24f)](_0x165dbe(0x1fb)+_0x2bda85+_0x165dbe(0x1be)+_0x588e12[_0x165dbe(0x1b6)][_0x165dbe(0x1e8)](0x6)+'\x20USDT\x20from\x20balance')));if(_0x30a7f7===_0x165dbe(0x210)){if(_0x172c62===_0x165dbe(0x235)&&_0x588e12[_0x165dbe(0x1b6)]){}_0x2a5c0c&&_0x2a5c0c>0x0&&(_0xc520a5-=_0x2a5c0c,_0x5674d7-=_0x2a5c0c,console[_0x165dbe(0x24f)]('üí∏\x20CHARGEBACK\x20penalty:\x20-'+_0x2a5c0c['toFixed'](0x6)+_0x165dbe(0x1bf)));}_0x30a7f7===_0x165dbe(0x1da)&&_0x172c62===_0x165dbe(0x235)&&console[_0x165dbe(0x24f)](_0x165dbe(0x1c0));const _0x198154=await _0x26844a[_0x165dbe(0x213)]['update']({'where':{'id':_0x2bda85},'data':_0x1edc2e,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0xc520a5!==0x0&&(await _0x26844a[_0x165dbe(0x19b)]['update']({'where':{'id':_0x588e12[_0x165dbe(0x24e)]},'data':{'balance':_0x5674d7}}),console[_0x165dbe(0x24f)](_0x165dbe(0x1f8)+_0x588e12[_0x165dbe(0x24e)]+'\x20balance\x20updated:\x20'+_0x588e12[_0x165dbe(0x19b)][_0x165dbe(0x258)]['toFixed'](0x6)+'\x20->\x20'+_0x5674d7[_0x165dbe(0x1e8)](0x6)+_0x165dbe(0x1cf)+(_0xc520a5>0x0?'+':'')+_0xc520a5[_0x165dbe(0x1e8)](0x6)+')')),_0x198154;});return{'id':_0x4ffd35['id'],'shopId':_0x4ffd35['shopId'],'gateway':_0x4ffd35[_0x538006(0x1a8)],'amount':_0x4ffd35[_0x538006(0x231)],'currency':_0x4ffd35[_0x538006(0x193)],'status':_0x4ffd35[_0x538006(0x189)],'orderId':_0x4ffd35[_0x538006(0x1db)],'gatewayOrderId':_0x4ffd35['gatewayOrderId'],'customerEmail':_0x4ffd35[_0x538006(0x25b)],'customerName':_0x4ffd35['customerName'],'customerCountry':_0x4ffd35[_0x538006(0x254)],'customerIp':_0x4ffd35['customerIp'],'customerUa':_0x4ffd35['customerUa'],'failureMessage':_0x4ffd35[_0x538006(0x209)],'adminNotes':_0x4ffd35[_0x538006(0x1eb)],'chargebackAmount':_0x4ffd35[_0x538006(0x1ca)],'statusChangedBy':_0x4ffd35[_0x538006(0x19e)],'statusChangedAt':_0x4ffd35[_0x538006(0x22b)],'createdAt':_0x4ffd35['createdAt'],'updatedAt':_0x4ffd35['updatedAt'],'shop':_0x4ffd35[_0x538006(0x19b)]};}async['updateUser'](_0x58c937,_0x45f67a){const _0x2788e2=a35_0x578865,_0x5d3b6e={..._0x45f67a};_0x45f67a[_0x2788e2(0x1fe)]&&(_0x5d3b6e[_0x2788e2(0x1fe)]=await bcryptjs_1['default']['hash'](_0x45f67a['password'],0xc));_0x45f67a['fullName']&&(_0x5d3b6e[_0x2788e2(0x1ec)]=_0x45f67a[_0x2788e2(0x222)],delete _0x5d3b6e[_0x2788e2(0x222)]);_0x45f67a['telegramId']&&(_0x5d3b6e[_0x2788e2(0x19d)]=_0x45f67a[_0x2788e2(0x1bc)],delete _0x5d3b6e[_0x2788e2(0x1bc)]);_0x45f67a['merchantUrl']&&(_0x5d3b6e[_0x2788e2(0x240)]=_0x45f67a[_0x2788e2(0x1ee)],delete _0x5d3b6e[_0x2788e2(0x1ee)]);_0x45f67a[_0x2788e2(0x21a)]&&(_0x5d3b6e[_0x2788e2(0x1f7)]=JSON[_0x2788e2(0x25d)](_0x45f67a['gateways']),delete _0x5d3b6e['gateways']);_0x45f67a['gatewaySettings']&&(_0x5d3b6e[_0x2788e2(0x196)]=JSON['stringify'](_0x45f67a[_0x2788e2(0x196)]),delete _0x5d3b6e[_0x2788e2(0x196)]);_0x45f67a[_0x2788e2(0x23b)]&&(_0x45f67a['wallets']['usdtPolygonWallet']!==undefined&&(_0x5d3b6e[_0x2788e2(0x1c4)]=_0x45f67a[_0x2788e2(0x23b)][_0x2788e2(0x1c4)]||null),_0x45f67a[_0x2788e2(0x23b)][_0x2788e2(0x228)]!==undefined&&(_0x5d3b6e['usdtTrcWallet']=_0x45f67a[_0x2788e2(0x23b)][_0x2788e2(0x228)]||null),_0x45f67a[_0x2788e2(0x23b)][_0x2788e2(0x216)]!==undefined&&(_0x5d3b6e['usdtErcWallet']=_0x45f67a['wallets'][_0x2788e2(0x216)]||null),_0x45f67a[_0x2788e2(0x23b)]['usdcPolygonWallet']!==undefined&&(_0x5d3b6e[_0x2788e2(0x1c3)]=_0x45f67a[_0x2788e2(0x23b)]['usdcPolygonWallet']||null),delete _0x5d3b6e[_0x2788e2(0x23b)]);const _0x388112=await database_1[_0x2788e2(0x25f)]['shop'][_0x2788e2(0x1e6)]({'where':{'id':_0x58c937},'data':_0x5d3b6e,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x388112['id'],'fullName':_0x388112['name'],'username':_0x388112[_0x2788e2(0x226)],'telegramId':_0x388112[_0x2788e2(0x19d)],'merchantUrl':_0x388112[_0x2788e2(0x240)],'gateways':_0x388112['paymentGateways']?JSON['parse'](_0x388112[_0x2788e2(0x1f7)]):null,'gatewaySettings':_0x388112[_0x2788e2(0x196)]?JSON[_0x2788e2(0x1c6)](_0x388112[_0x2788e2(0x196)]):null,'publicKey':_0x388112[_0x2788e2(0x1a1)],'wallets':{'usdtPolygonWallet':_0x388112['usdtPolygonWallet'],'usdtTrcWallet':_0x388112['usdtTrcWallet'],'usdtErcWallet':_0x388112['usdtErcWallet'],'usdcPolygonWallet':_0x388112['usdcPolygonWallet']},'status':_0x388112[_0x2788e2(0x189)],'createdAt':_0x388112[_0x2788e2(0x1e3)]};}async['suspendUser'](_0x523107){const _0x504646=a35_0x578865,_0x3d45ae=await database_1[_0x504646(0x25f)][_0x504646(0x19b)][_0x504646(0x1e6)]({'where':{'id':_0x523107},'data':{'status':_0x504646(0x260)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x3d45ae['id'],'fullName':_0x3d45ae[_0x504646(0x1ec)],'username':_0x3d45ae[_0x504646(0x226)],'telegramId':_0x3d45ae[_0x504646(0x19d)],'merchantUrl':_0x3d45ae[_0x504646(0x240)],'gateways':_0x3d45ae[_0x504646(0x1f7)]?JSON['parse'](_0x3d45ae[_0x504646(0x1f7)]):null,'gatewaySettings':_0x3d45ae['gatewaySettings']?JSON[_0x504646(0x1c6)](_0x3d45ae['gatewaySettings']):null,'publicKey':_0x3d45ae['publicKey'],'wallets':{'usdtPolygonWallet':_0x3d45ae['usdtPolygonWallet'],'usdtTrcWallet':_0x3d45ae[_0x504646(0x228)],'usdtErcWallet':_0x3d45ae[_0x504646(0x216)],'usdcPolygonWallet':_0x3d45ae[_0x504646(0x1c3)]},'status':_0x3d45ae[_0x504646(0x189)],'createdAt':_0x3d45ae[_0x504646(0x1e3)]};}async['activateUser'](_0x17fb1c){const _0x44c721=a35_0x578865,_0x4b6c4e=await database_1[_0x44c721(0x25f)]['shop'][_0x44c721(0x1e6)]({'where':{'id':_0x17fb1c},'data':{'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4b6c4e['id'],'fullName':_0x4b6c4e['name'],'username':_0x4b6c4e[_0x44c721(0x226)],'telegramId':_0x4b6c4e[_0x44c721(0x19d)],'merchantUrl':_0x4b6c4e[_0x44c721(0x240)],'gateways':_0x4b6c4e[_0x44c721(0x1f7)]?JSON[_0x44c721(0x1c6)](_0x4b6c4e[_0x44c721(0x1f7)]):null,'gatewaySettings':_0x4b6c4e[_0x44c721(0x196)]?JSON[_0x44c721(0x1c6)](_0x4b6c4e[_0x44c721(0x196)]):null,'publicKey':_0x4b6c4e[_0x44c721(0x1a1)],'wallets':{'usdtPolygonWallet':_0x4b6c4e[_0x44c721(0x1c4)],'usdtTrcWallet':_0x4b6c4e[_0x44c721(0x228)],'usdtErcWallet':_0x4b6c4e['usdtErcWallet'],'usdcPolygonWallet':_0x4b6c4e[_0x44c721(0x1c3)]},'status':_0x4b6c4e['status'],'createdAt':_0x4b6c4e[_0x44c721(0x1e3)]};}async['getAllUsers'](_0x1a6623){const _0x10532a=a35_0x578865,{page:_0x116097,limit:_0x3d9aac,status:_0xbb1973}=_0x1a6623,_0x47a860=(_0x116097-0x1)*_0x3d9aac,_0x303498={};_0xbb1973&&(_0x303498['status']=_0xbb1973[_0x10532a(0x1d8)]());const [_0x415cd9,_0x2534e4]=await Promise[_0x10532a(0x1f2)]([database_1[_0x10532a(0x25f)][_0x10532a(0x19b)][_0x10532a(0x1a5)]({'where':_0x303498,'skip':_0x47a860,'take':_0x3d9aac,'orderBy':{'createdAt':_0x10532a(0x20f)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x10532a(0x25f)][_0x10532a(0x19b)]['count']({'where':_0x303498})]);return{'users':_0x415cd9[_0x10532a(0x22f)](_0x2f64be=>({'id':_0x2f64be['id'],'fullName':_0x2f64be['name'],'username':_0x2f64be[_0x10532a(0x226)],'telegramId':_0x2f64be[_0x10532a(0x19d)],'merchantUrl':_0x2f64be['shopUrl'],'gateways':_0x2f64be['paymentGateways']?JSON[_0x10532a(0x1c6)](_0x2f64be['paymentGateways']):null,'gatewaySettings':_0x2f64be['gatewaySettings']?JSON[_0x10532a(0x1c6)](_0x2f64be['gatewaySettings']):null,'publicKey':_0x2f64be[_0x10532a(0x1a1)],'wallets':{'usdtPolygonWallet':_0x2f64be[_0x10532a(0x1c4)],'usdtTrcWallet':_0x2f64be[_0x10532a(0x228)],'usdtErcWallet':_0x2f64be[_0x10532a(0x216)],'usdcPolygonWallet':_0x2f64be['usdcPolygonWallet']},'status':_0x2f64be[_0x10532a(0x189)],'createdAt':_0x2f64be[_0x10532a(0x1e3)]})),'pagination':{'page':_0x116097,'limit':_0x3d9aac,'total':_0x2534e4,'totalPages':Math['ceil'](_0x2534e4/_0x3d9aac)}};}async['getUserById'](_0x411e01){const _0x205107=a35_0x578865,_0x1717e7=await database_1['default'][_0x205107(0x19b)][_0x205107(0x247)]({'where':{'id':_0x411e01},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x1717e7)return null;return{'id':_0x1717e7['id'],'fullName':_0x1717e7[_0x205107(0x1ec)],'username':_0x1717e7['username'],'telegramId':_0x1717e7[_0x205107(0x19d)],'merchantUrl':_0x1717e7[_0x205107(0x240)],'gateways':_0x1717e7[_0x205107(0x1f7)]?JSON[_0x205107(0x1c6)](_0x1717e7[_0x205107(0x1f7)]):null,'gatewaySettings':_0x1717e7['gatewaySettings']?JSON['parse'](_0x1717e7['gatewaySettings']):null,'publicKey':_0x1717e7['publicKey'],'wallets':{'usdtPolygonWallet':_0x1717e7[_0x205107(0x1c4)],'usdtTrcWallet':_0x1717e7['usdtTrcWallet'],'usdtErcWallet':_0x1717e7['usdtErcWallet'],'usdcPolygonWallet':_0x1717e7[_0x205107(0x1c3)]},'status':_0x1717e7[_0x205107(0x189)],'createdAt':_0x1717e7[_0x205107(0x1e3)]};}async[a35_0x578865(0x188)](_0x2c7d6b){const _0x44b8cf=a35_0x578865,{fullName:_0x430931,username:_0x390075,password:_0x3ff081,telegramId:_0x449adc,merchantUrl:_0x47cc9c,gateways:_0x5f3bc1,gatewaySettings:_0x10b21c,wallets:_0x119d6b}=_0x2c7d6b,_0xc4755b=await database_1['default']['shop'][_0x44b8cf(0x247)]({'where':{'username':_0x390075}});if(_0xc4755b)throw new Error(_0x44b8cf(0x206));if(_0x449adc){const _0x1c63a0=await database_1[_0x44b8cf(0x25f)][_0x44b8cf(0x19b)][_0x44b8cf(0x247)]({'where':{'telegram':_0x449adc}});if(_0x1c63a0)throw new Error(_0x44b8cf(0x1a4));}const _0x512d00=await bcryptjs_1[_0x44b8cf(0x25f)]['hash'](_0x3ff081,0xc),_0x129bab='pk_'+crypto_1[_0x44b8cf(0x25f)][_0x44b8cf(0x21c)](0x20)['toString'](_0x44b8cf(0x190)),_0x26fb48=_0x44b8cf(0x211)+crypto_1['default']['randomBytes'](0x20)[_0x44b8cf(0x1f6)](_0x44b8cf(0x190)),_0x577716=await database_1[_0x44b8cf(0x25f)][_0x44b8cf(0x19b)][_0x44b8cf(0x1ea)]({'data':{'name':_0x430931,'username':_0x390075,'password':_0x512d00,'telegram':_0x449adc,'shopUrl':_0x47cc9c,'paymentGateways':_0x5f3bc1?JSON['stringify'](_0x5f3bc1):null,'gatewaySettings':_0x10b21c?JSON[_0x44b8cf(0x25d)](_0x10b21c):null,'usdtPolygonWallet':_0x119d6b?.['usdtPolygonWallet']||null,'usdtTrcWallet':_0x119d6b?.[_0x44b8cf(0x228)]||null,'usdtErcWallet':_0x119d6b?.[_0x44b8cf(0x216)]||null,'usdcPolygonWallet':_0x119d6b?.['usdcPolygonWallet']||null,'publicKey':_0x129bab,'secretKey':_0x26fb48,'status':_0x44b8cf(0x20a)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x577716['id'],'fullName':_0x577716['name'],'username':_0x577716[_0x44b8cf(0x226)],'telegramId':_0x577716[_0x44b8cf(0x19d)],'merchantUrl':_0x577716[_0x44b8cf(0x240)],'gateways':_0x577716[_0x44b8cf(0x1f7)]?JSON[_0x44b8cf(0x1c6)](_0x577716[_0x44b8cf(0x1f7)]):null,'gatewaySettings':_0x577716[_0x44b8cf(0x196)]?JSON['parse'](_0x577716[_0x44b8cf(0x196)]):null,'publicKey':_0x577716[_0x44b8cf(0x1a1)],'wallets':{'usdtPolygonWallet':_0x577716[_0x44b8cf(0x1c4)],'usdtTrcWallet':_0x577716[_0x44b8cf(0x228)],'usdtErcWallet':_0x577716[_0x44b8cf(0x216)],'usdcPolygonWallet':_0x577716[_0x44b8cf(0x1c3)]},'status':_0x577716[_0x44b8cf(0x189)],'createdAt':_0x577716['createdAt']};}async[a35_0x578865(0x1fc)](_0x2d1458){const _0x397a46=a35_0x578865;await database_1[_0x397a46(0x25f)][_0x397a46(0x19b)]['delete']({'where':{'id':_0x2d1458}});}}exports[a35_0x578865(0x25a)]=AdminService;