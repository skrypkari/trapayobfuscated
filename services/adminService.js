'use strict';function a46_0x2b36(){const _0x982eb3=['createUser','map','üí∞\x20[PAYOUT]\x20Merchant\x20','\x20paid\x20payments\x20for\x20analysis','random','sort','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','\x20USDT\x20(rounded\x20to\x202\x20decimal\x20places)','üìä\x20Using\x20saved\x20values\x20for\x20payment\x20','‚úÖ\x20Payout\x20created:\x20','üìä\x20Calculated\x20commission\x20rate\x20for\x20payment\x20','setDate','üîÑ\x20Gateway\x20mapping\x20(get):','name','‚úÖ\x20Using\x20gateway\x20filter:\x20\x27','\x20to\x20','\x20balance\x20updated:\x20',',\x20userId:\x20','‚ö†Ô∏è\x20CHARGEBACK\x20without\x20penalty\x20amount\x20-\x20no\x20balance\x20change','\x20\x20\x20Transaction\x20hash:\x20','currency','getMonth','all','week','\x20\x20\x20Difference:\x20','totalPayments','üîÑ\x20Updating\x20customer\x20data\x20for\x20payment\x20','paidAt','stringify','\x20\x20\x20üåç\x20Country:\x20','2561274IkoMDc','Error\x20processing\x20payment\x20','gatewayEarnings','./currencyService','merchantUrl','adminNotes','KLYME\x20EU','push','trc20','\x20\x20\x20üìÖ\x20This\x20month:\x20','klyme_gb','\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)','dailyPayments','CHARGEBACK','REFUND','payout','aggregate','erc20','\x20\x20\x20‚úÖ\x20Actual\x20available\x20balance:\x20','üîç\x20Creating\x20payout\x20with\x20data:','error','\x20\x20\x20üí≥\x20Total\x20payments:\x20','getDay','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notification\x20for\x20payout\x20','\x20USDT,\x20merchant:\x20','cointopay2','‚úÖ\x20Payout\x20created\x20in\x20DB:','period','replace','\x20\x20\x20Gateway:\x20','ru-RU',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','ceil','\x20USDT\x20(current\x20balance\x20in\x20DB)','warn','\x20\x20\x20üè™\x20Gateway\x20earnings:\x20','hash','updatePaymentStatus','gateway','entries','ACTIVE','publicKey','paidOutUSDT','toUpperCase','customerIp','getPayoutStats','\x20\x20\x20Balance:\x20','test_gateway','createdAt','üéØ\x20[','\x27\x20->\x20ID\x20\x27','getSystemStatistics','$transaction','paymentsCount','totalCommissionRate','failUrl','suspendUser','KLYME\x20GB','network','__importDefault','fullName','\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)','üîê\x20[','COMPLETED','bcryptjs','\x20USDT\x20for\x20payment\x20','\x20\x20\x20ÔøΩüìä\x20Total\x20payments:\x20','custom_','üìä\x20Gateway\x20filter\x20applied:','üìã\x20Getting\x20merchants\x20selection\x20list...','\x20\x20\x20Merchant\x20loses:\x20','findMany','üîç\x20Using\x20gateway\x20\x27','\x20\x20\x20üìÖ\x20Total\x20payouts\x20(this\x20month):\x20',',\x20Commission:\x20','üîÑ\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','\x20USDT\x20(total\x20paid\x20to\x20merchants)','24685aWALYY','‚úÖ\x20Balance\x20check\x20passed\x20(with\x20tolerance)','üìä\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','üîç\x20No\x20wallet\x20provided,\x20looking\x20up\x20from\x20shop\x20settings...','\x20\x20\x20ÔøΩ\x20Total\x20payments\x20turnover:\x20','_count','\x20payments)','lte','üìä\x20Merchant\x20statistics\x20calculated:','revenue','parse','\x20USDT\x20(already\x20paid\x20out)','üìä\x20Getting\x20merchant\x20statistics\x20with\x20filters:','last_week','üîÑ\x20Converted\x20gateway\x20name\x20\x27','MasterCard','üîç\x20Selected\x20polygon_usdc\x20wallet:\x20','statusChangedBy','getMerchantStatistics','averageCommissionRate','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','üìä\x20Available\x20gateways\x20in\x20database:','\x20status:\x20','üìä\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20','erc20_usdc','dateFrom',',\x20refunds:\x20','orderId','\x20merchants\x20for\x20selection','\x20\x20\x20üí∞\x20Total\x20turnover:\x20',':\x20commission\x20=\x20',']\x20Gateway\x20settings\x20JSON\x20string:','date','toString','trim','year','üìä\x20Calculating\x20payout\x20statistics...','\x20\x20\x20Total\x20paid\x20out:\x20','commission','turnover','round','values','\x20\x20\x20Available\x20(raw):\x20','‚ö†Ô∏è\x20Gateway\x20\x27','CoinToPay','11470312EQKFeE','customerName','toFixed','getTime','desc','KLYME\x20DE','üîç\x20Selected\x20polygon\x20wallet:\x20','gte','shop','\x20\x20\x20Payout\x20amount:\x20','localeCompare','\x20\x20\x20Merchant\x20gets:\x20','gateways','generateDailyStatistics','\x20->\x20','\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...','%\x20from\x20','join','findUnique','whiteUrl','insensitive','üìÖ\x20Date\x20to\x20filter:\x20','üì±\x20Telegram\x20notification\x20sent\x20for\x20payout\x20','AdminService','forEach','\x20\x20\x20ü§î\x20Difference:\x20','groupBy','shopUrl','periodTo','usdtTrcWallet','count','not\x20provided','\x20\x20\x20‚úÖ\x20Total\x20net\x20balances:\x20','not\x20set','üìä\x20Payout\x20statistics\x20calculated:','pendingPayout','Username\x20already\x20exists','./telegramBotService',']\x20Updating\x20password\x20for\x20user\x20','last_month','pk_','\x20\x20\x20Added\x20to\x20balance:\x20+','üîç\x20Selected\x20trc20\x20wallet:\x20','Payment\x20not\x20found','customerEmail','randomBytes','_sum','\x20USDT\x20(after\x20','üîç\x20Initial\x20wallet\x20from\x20request:\x20','dailyRevenue','2ihOHGo','1539819QdUpUd','amountUSDT','availableBalance','üí∞\x20Found\x20','shopId','üí∞\x20Current\x20shop\x20balance:\x20','\x20balance\x20updated:','\x20for\x20shop\x20','üéØ\x20updateUser\x20called\x20with\x20ID:\x20','1056473uqEYVO','üí∞\x20Shop\x20','8996652TpQffc','convertToUSDT','Shop\x20not\x20found','get','\x20USDT\x20(theoretical\x20net)','\x20USDT\x20from\x20balance','activateUser','getMerchantsSelection','\x27\x20->\x20name\x20\x27','getAllUsers',',\x20successful:\x20','floor','hex','length','PENDING','\x20merchants','üìÖ\x20Payout\x20date\x20from\x20filter:\x20','\x20USDT\x20(-','getAllPayments','createPayout','Open\x20Banking\x202','password','averageCheckUSDT','wallet','üìÖ\x20Payout\x20date\x20to\x20filter:\x20','üìä\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','\x20USDT)','getGatewayDisplayName','split','create','getFullYear','totalPayout','periodFrom','\x20-\x20','klyme_de','üìÖ\x20Date\x20from\x20filter:\x20','month','noda','__esModule','externalPaymentUrl','set','PAID','mastercard','\x20\x20\x20Current\x20balance:\x20','%\x20commission)','Insufficient\x20balance.\x20Available:\x20','some','reduce','\x20\x20\x20Available\x20(number):\x20','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','not\x20specified','‚úÖ\x20Customer\x20data\x20updated\x20for\x20payment\x20','toISOString','wallets','Telegram\x20username\x20already\x20exists','üìä\x20Final\x20WHERE\x20conditions:','toLowerCase','Rapyd','usdtPolygonWallet','includes','polygon_usdc','status','crypto','üîÑ\x20Admin\x20updating\x20payment\x20','merchantEarningsUSDT','username','\x20\x20\x20üí∏\x20Total\x20payouts:\x20','toLocaleDateString','turnoverUSDT','‚ö†Ô∏è\x20Payment\x20','getPaymentById','getPayoutById','\x20USDT,\x20Requested:\x20','üìä\x20Total\x20payments\x20(including\x20failed):\x20','amountAfterCommissionUSDT','gatewayCommissionRate','balance','üîç\x20Selected\x20erc20_usdc\x20wallet:\x20','\x20\x20\x20Tolerance:\x20','getDate','filter','failureMessage','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','amountAfterGatewayCommissionUSDT','custom','usdcPolygonWallet','paymentGateways','\x27\x20(from\x20\x27','Plisio','telegramId','\x27\x20not\x20found.\x20Available\x20gateways:\x20','txid','üí∏\x20CHARGEBACK\x20penalty\x20ONLY:\x20-','notes','thisMonth','\x20PAID\x20payments','sk_','üí∞\x20[PAYOUT]\x20Gateway\x20','totalPaidOut','116zfWnHw','üí∞\x20Payment\x20amount\x20is\x20NOT\x20deducted\x20(chargeback\x20penalty\x20only)','\x20USDT\x20(gross\x20revenue)','commissionUSDT','../config/database','usdtErcWallet','SUSPENDED','telegram','\x20\x20\x20üí∞\x20Total\x20payments\x20turnover:\x20','yesterday','üìä\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','rapyd','amount','totalTurnover','\x20\x20\x20üñ•Ô∏è\x20User\x20Agent:\x20','getGatewayInternalName','asc','\x20\x20\x20‚è≥\x20Pending\x20payout:\x20','setHours','üí∞\x20Creating\x20payout\x20for\x20shop\x20','default','customerCountry','\x20USDT\x20(','üí∏\x20CHARGEBACK:\x20Processing\x20penalty-only\x20deduction','totalAmountUSDT','totalAmountAfterCommissionUSDT','getMerchantsAwaitingPayout','getGatewayNameById','gatewaySettings','chargebackAmount','customerUa','deleteUser',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','log','üîÑ\x20Gateway\x20mapping:','üìã\x20Found\x20','\x20USDT','updateCustomerData','update','updatedAt','10479749AgwZyM','cointopay','telegramBotService','gatewayOrderId','statusChangedAt','2020-01-01','\x20with\x20payout\x20history','payment','polygon','\x20USDT\x20(same\x20as\x20awaiting)','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','–ù–µ\x20—É–∫–∞–∑–∞–Ω','\x20\x20\x20üåê\x20IP:\x20','üîß\x20[','merchantEarnings','\x20\x20\x20Full\x20amount:\x20'];a46_0x2b36=function(){return _0x982eb3;};return a46_0x2b36();}function a46_0x3636(_0x1d4380,_0x5e2ba9){_0x1d4380=_0x1d4380-0x15a;const _0x2b36e6=a46_0x2b36();let _0x363612=_0x2b36e6[_0x1d4380];return _0x363612;}const a46_0x316b14=a46_0x3636;(function(_0x576204,_0x479b69){const _0x5db5cd=a46_0x3636,_0x1a8f7a=_0x576204();while(!![]){try{const _0x2b6aeb=-parseInt(_0x5db5cd(0x281))/0x1*(parseInt(_0x5db5cd(0x277))/0x2)+-parseInt(_0x5db5cd(0x278))/0x3+parseInt(_0x5db5cd(0x175))/0x4*(parseInt(_0x5db5cd(0x218))/0x5)+parseInt(_0x5db5cd(0x1cb))/0x6+parseInt(_0x5db5cd(0x19d))/0x7+parseInt(_0x5db5cd(0x245))/0x8+-parseInt(_0x5db5cd(0x283))/0x9;if(_0x2b6aeb===_0x479b69)break;else _0x1a8f7a['push'](_0x1a8f7a['shift']());}catch(_0x931eb3){_0x1a8f7a['push'](_0x1a8f7a['shift']());}}}(a46_0x2b36,0xe36f6));var __importDefault=this&&this[a46_0x316b14(0x206)]||function(_0x4cf36c){const _0x294478=a46_0x316b14;return _0x4cf36c&&_0x4cf36c[_0x294478(0x2a9)]?_0x4cf36c:{'default':_0x4cf36c};};Object['defineProperty'](exports,a46_0x316b14(0x2a9),{'value':!![]}),exports[a46_0x316b14(0x25c)]=void 0x0;const database_1=__importDefault(require(a46_0x316b14(0x179))),bcryptjs_1=__importDefault(require(a46_0x316b14(0x20b))),crypto_1=__importDefault(require(a46_0x316b14(0x2c1))),currencyService_1=require(a46_0x316b14(0x1ce)),telegramBotService_1=require(a46_0x316b14(0x26a)),gateway_1=require('../types/gateway');class AdminService{async[a46_0x316b14(0x1f8)](){const _0x260dff=a46_0x316b14;console['log'](_0x260dff(0x23c));const _0x275c4b=await database_1['default'][_0x260dff(0x24d)][_0x260dff(0x1db)]({'_sum':{'balance':!![],'totalPaidOut':!![]}}),_0x42b4ea=await database_1[_0x260dff(0x189)][_0x260dff(0x1a4)][_0x260dff(0x263)]({'where':{'status':_0x260dff(0x2ac),'gateway':{'not':_0x260dff(0x1fa)}}}),_0x10e471=new Date(),_0x2de9ef=new Date(_0x10e471[_0x260dff(0x2a1)](),_0x10e471[_0x260dff(0x1c2)](),0x1),_0x15bbe7=new Date(_0x10e471[_0x260dff(0x2a1)](),_0x10e471[_0x260dff(0x1c2)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x3aff7c=await database_1[_0x260dff(0x189)][_0x260dff(0x1da)][_0x260dff(0x1db)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x2de9ef,'lte':_0x15bbe7},'status':_0x260dff(0x20a)}}),_0x1c2df8=_0x275c4b[_0x260dff(0x273)]['totalPaidOut']||0x0,_0x287963=_0x275c4b[_0x260dff(0x273)][_0x260dff(0x15d)]||0x0,_0x53f339=_0x3aff7c[_0x260dff(0x273)][_0x260dff(0x181)]||0x0,_0x425a05={'totalPayout':Math[_0x260dff(0x240)](_0x1c2df8*0x64)/0x64,'awaitingPayout':Math[_0x260dff(0x240)](_0x287963*0x64)/0x64,'thisMonth':Math[_0x260dff(0x240)](_0x53f339*0x64)/0x64,'availableBalance':Math[_0x260dff(0x240)](_0x287963*0x64)/0x64,'totalPayments':_0x42b4ea};return console[_0x260dff(0x196)](_0x260dff(0x267)),console[_0x260dff(0x196)]('\x20\x20\x20üí∞\x20Total\x20payout:\x20'+_0x425a05['totalPayout']+_0x260dff(0x217)),console[_0x260dff(0x196)](_0x260dff(0x1a7)+_0x425a05['awaitingPayout']+_0x260dff(0x1d6)),console[_0x260dff(0x196)]('\x20\x20\x20üíµ\x20Available\x20balance:\x20'+_0x425a05[_0x260dff(0x27a)]+_0x260dff(0x1a6)),console['log'](_0x260dff(0x1d4)+_0x425a05[_0x260dff(0x170)]+_0x260dff(0x199)),console[_0x260dff(0x196)](_0x260dff(0x1e0)+_0x425a05[_0x260dff(0x1c6)]+_0x260dff(0x171)),_0x425a05;}async[a46_0x316b14(0x19a)](_0x3058f0,_0x2b6487){const _0x32754b=a46_0x316b14;console[_0x32754b(0x196)](_0x32754b(0x1c7)+_0x3058f0+':',_0x2b6487);const _0xc07da4=await database_1[_0x32754b(0x189)][_0x32754b(0x1a4)][_0x32754b(0x257)]({'where':{'id':_0x3058f0},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0xc07da4)throw new Error('Payment\x20not\x20found');const _0x22e973={};_0x2b6487[_0x32754b(0x18a)]!==undefined&&(_0x22e973[_0x32754b(0x18a)]=_0x2b6487[_0x32754b(0x18a)]||null);_0x2b6487[_0x32754b(0x1f7)]!==undefined&&(_0x22e973[_0x32754b(0x1f7)]=_0x2b6487[_0x32754b(0x1f7)]||null);_0x2b6487['customerUa']!==undefined&&(_0x22e973['customerUa']=_0x2b6487['customerUa']||null);const _0x106e04=await database_1[_0x32754b(0x189)][_0x32754b(0x1a4)][_0x32754b(0x19b)]({'where':{'id':_0x3058f0},'data':{..._0x22e973,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x32754b(0x196)](_0x32754b(0x2b6)+_0x3058f0),console['log'](_0x32754b(0x1ca)+_0xc07da4[_0x32754b(0x18a)]+_0x32754b(0x253)+_0x106e04[_0x32754b(0x18a)]),console['log'](_0x32754b(0x1a9)+_0xc07da4[_0x32754b(0x1f7)]+_0x32754b(0x253)+_0x106e04[_0x32754b(0x1f7)]),console[_0x32754b(0x196)](_0x32754b(0x183)+(_0xc07da4['customerUa']?_0x32754b(0x2ab):_0x32754b(0x266))+_0x32754b(0x253)+(_0x106e04[_0x32754b(0x193)]?_0x32754b(0x2ab):_0x32754b(0x266))),_0x106e04;}async[a46_0x316b14(0x1fe)](_0x1a1014){const _0x30102c=a46_0x316b14,_0x189255=new Date();let _0x5851ea,_0x119a4c;if(_0x1a1014['startsWith']('custom_')){const _0x411f00=_0x1a1014[_0x30102c(0x1e7)](_0x30102c(0x20e),'')['split']('_');_0x411f00[_0x30102c(0x290)]===0x2?(_0x5851ea=new Date(_0x411f00[0x0]),_0x5851ea['setHours'](0x0,0x0,0x0,0x0),_0x119a4c=new Date(_0x411f00[0x1]),_0x119a4c['setHours'](0x17,0x3b,0x3b,0x3e7)):(_0x5851ea=new Date(_0x189255[_0x30102c(0x248)]()-0x1e*0x18*0x3c*0x3c*0x3e8),_0x5851ea[_0x30102c(0x187)](0x0,0x0,0x0,0x0),_0x119a4c=new Date(),_0x119a4c[_0x30102c(0x187)](0x17,0x3b,0x3b,0x3e7));}else switch(_0x1a1014[_0x30102c(0x2bb)]()){case'today':_0x5851ea=new Date(_0x189255[_0x30102c(0x2a1)](),_0x189255['getMonth'](),_0x189255[_0x30102c(0x160)](),0x0,0x0,0x0,0x0),_0x119a4c=new Date(_0x189255[_0x30102c(0x2a1)](),_0x189255[_0x30102c(0x1c2)](),_0x189255[_0x30102c(0x160)](),0x17,0x3b,0x3b,0x3e7);break;case _0x30102c(0x17e):const _0x4f0ff7=new Date(_0x189255);_0x4f0ff7[_0x30102c(0x1b8)](_0x4f0ff7['getDate']()-0x1),_0x5851ea=new Date(_0x4f0ff7[_0x30102c(0x2a1)](),_0x4f0ff7['getMonth'](),_0x4f0ff7[_0x30102c(0x160)](),0x0,0x0,0x0,0x0),_0x119a4c=new Date(_0x4f0ff7[_0x30102c(0x2a1)](),_0x4f0ff7[_0x30102c(0x1c2)](),_0x4f0ff7[_0x30102c(0x160)](),0x17,0x3b,0x3b,0x3e7);break;case'this_week':const _0x3cbe05=_0x189255['getDay'](),_0xe3ea27=_0x3cbe05===0x0?-0x6:0x1-_0x3cbe05;_0x5851ea=new Date(_0x189255),_0x5851ea[_0x30102c(0x1b8)](_0x189255[_0x30102c(0x160)]()+_0xe3ea27),_0x5851ea[_0x30102c(0x187)](0x0,0x0,0x0,0x0),_0x119a4c=new Date(_0x189255[_0x30102c(0x2a1)](),_0x189255[_0x30102c(0x1c2)](),_0x189255[_0x30102c(0x160)](),0x17,0x3b,0x3b,0x3e7);break;case _0x30102c(0x225):const _0x4cb37b=new Date(_0x189255);_0x4cb37b['setDate'](_0x189255[_0x30102c(0x160)]()-0x7);const _0xfa28c3=_0x4cb37b[_0x30102c(0x1e1)](),_0x318ca3=_0xfa28c3===0x0?-0x6:0x1-_0xfa28c3;_0x5851ea=new Date(_0x4cb37b),_0x5851ea[_0x30102c(0x1b8)](_0x4cb37b['getDate']()+_0x318ca3),_0x5851ea[_0x30102c(0x187)](0x0,0x0,0x0,0x0),_0x119a4c=new Date(_0x5851ea),_0x119a4c['setDate'](_0x5851ea[_0x30102c(0x160)]()+0x6),_0x119a4c[_0x30102c(0x187)](0x17,0x3b,0x3b,0x3e7);break;case'this_month':_0x5851ea=new Date(_0x189255[_0x30102c(0x2a1)](),_0x189255[_0x30102c(0x1c2)](),0x1,0x0,0x0,0x0,0x0),_0x119a4c=new Date(_0x189255['getFullYear'](),_0x189255['getMonth'](),_0x189255['getDate'](),0x17,0x3b,0x3b,0x3e7);break;case _0x30102c(0x26c):_0x5851ea=new Date(_0x189255[_0x30102c(0x2a1)](),_0x189255[_0x30102c(0x1c2)]()-0x1,0x1,0x0,0x0,0x0,0x0),_0x119a4c=new Date(_0x189255['getFullYear'](),_0x189255[_0x30102c(0x1c2)](),0x0,0x17,0x3b,0x3b,0x3e7);break;default:_0x5851ea=new Date(_0x189255[_0x30102c(0x248)]()-0x1e*0x18*0x3c*0x3c*0x3e8),_0x5851ea[_0x30102c(0x187)](0x0,0x0,0x0,0x0),_0x119a4c=new Date(_0x189255[_0x30102c(0x2a1)](),_0x189255[_0x30102c(0x1c2)](),_0x189255[_0x30102c(0x160)](),0x17,0x3b,0x3b,0x3e7);}const _0x4b26c9={'gte':_0x5851ea,'lte':_0x119a4c},[_0x7c1524,_0x561bc7,_0x3127e7,_0x2debc8,_0x4cfcf8,_0x5f01a8,_0x3b23de,_0x41c4e0]=await Promise[_0x30102c(0x1c3)]([database_1[_0x30102c(0x189)]['shop'][_0x30102c(0x263)](),database_1[_0x30102c(0x189)][_0x30102c(0x24d)][_0x30102c(0x263)]({'where':{'status':_0x30102c(0x1f3)}}),database_1[_0x30102c(0x189)][_0x30102c(0x1a4)][_0x30102c(0x263)]({'where':{'status':'PAID','createdAt':_0x4b26c9,'gateway':{'not':_0x30102c(0x1fa)}}}),database_1[_0x30102c(0x189)][_0x30102c(0x1a4)][_0x30102c(0x263)]({'where':{'status':_0x30102c(0x1d8),'createdAt':_0x4b26c9,'gateway':{'not':_0x30102c(0x1fa)}}}),database_1[_0x30102c(0x189)][_0x30102c(0x1a4)][_0x30102c(0x263)]({'where':{'status':'REFUND','createdAt':_0x4b26c9,'gateway':{'not':_0x30102c(0x1fa)}}}),database_1[_0x30102c(0x189)]['payment']['findMany']({'where':{'status':_0x30102c(0x2ac),'createdAt':_0x4b26c9,'gateway':{'not':_0x30102c(0x1fa)}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x30102c(0x189)][_0x30102c(0x1a4)][_0x30102c(0x212)]({'where':{'gateway':{'not':_0x30102c(0x1fa)}},'take':0xa,'orderBy':{'createdAt':_0x30102c(0x249)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x30102c(0x189)][_0x30102c(0x1a4)][_0x30102c(0x212)]({'where':{'createdAt':_0x4b26c9,'gateway':{'not':_0x30102c(0x1fa)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x43b9c6=0x0,_0x4522f0=0x0;for(const _0x3010d3 of _0x5f01a8){const _0x1437b6=_0x3010d3[_0x30102c(0x279)]||0x0;_0x43b9c6+=_0x1437b6;if(_0x3010d3[_0x30102c(0x165)]&&_0x3010d3[_0x30102c(0x279)]){const _0x248e7b=_0x3010d3[_0x30102c(0x279)]-_0x3010d3[_0x30102c(0x165)];_0x4522f0+=_0x248e7b;}}const _0x24d931=_0x3127e7>0x0?_0x43b9c6/_0x3127e7:0x0,_0x590987=this[_0x30102c(0x252)](_0x41c4e0,_0x5851ea,_0x119a4c),_0x4ffe89=await database_1['default'][_0x30102c(0x1a4)][_0x30102c(0x263)]({'where':{'createdAt':_0x4b26c9,'gateway':{'not':_0x30102c(0x1fa)}}}),_0x21b456=_0x4ffe89>0x0?_0x3127e7/_0x4ffe89*0x64:0x0;return{'totalShops':_0x7c1524,'activeShops':_0x561bc7,'totalPayments':_0x3127e7,'successfulPayments':_0x3127e7,'totalAttempts':_0x4ffe89,'chargebacks':_0x2debc8,'refunds':_0x4cfcf8,'totalRevenue':Math[_0x30102c(0x240)](_0x43b9c6*0x64)/0x64,'trapayEarnings':Math[_0x30102c(0x240)](_0x4522f0*0x64)/0x64,'averagePaymentAmount':Math[_0x30102c(0x240)](_0x24d931*0x64)/0x64,'conversionRate':Math[_0x30102c(0x240)](_0x21b456*0x64)/0x64,'dailyRevenue':_0x590987[_0x30102c(0x276)],'dailyPayments':_0x590987[_0x30102c(0x1d7)],'recentPayments':_0x3b23de[_0x30102c(0x1ae)](_0x747c5d=>({'id':_0x747c5d['id'],'amount':_0x747c5d[_0x30102c(0x181)],'currency':_0x747c5d[_0x30102c(0x1c1)],'status':_0x747c5d[_0x30102c(0x2c0)],'gateway':_0x747c5d[_0x30102c(0x1f1)],'shop':_0x747c5d[_0x30102c(0x24d)],'createdAt':_0x747c5d[_0x30102c(0x1fb)]}))};}async[a46_0x316b14(0x22a)](_0x2be8fb){const _0x512852=a46_0x316b14;console[_0x512852(0x196)](_0x512852(0x224),_0x2be8fb);let _0x9efea4,_0x1bd831=new Date();if(_0x2be8fb[_0x512852(0x1e6)]===_0x512852(0x166)&&_0x2be8fb[_0x512852(0x231)]&&_0x2be8fb['dateTo'])_0x9efea4=new Date(_0x2be8fb[_0x512852(0x231)]),_0x1bd831=new Date(_0x2be8fb['dateTo']),_0x9efea4[_0x512852(0x187)](0x0,0x0,0x0,0x0),_0x1bd831['setHours'](0x17,0x3b,0x3b,0x3e7);else{const _0x30c4c7=new Date();switch(_0x2be8fb[_0x512852(0x1e6)]){case _0x512852(0x1c4):_0x9efea4=new Date(_0x30c4c7[_0x512852(0x248)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x512852(0x2a7):_0x9efea4=new Date(_0x30c4c7['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x512852(0x23b):_0x9efea4=new Date(_0x30c4c7[_0x512852(0x248)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case'all':default:_0x9efea4=new Date(_0x512852(0x1a2));break;}_0x9efea4[_0x512852(0x187)](0x0,0x0,0x0,0x0),_0x1bd831['setHours'](0x17,0x3b,0x3b,0x3e7);}console['log']('üìÖ\x20Period:\x20'+_0x9efea4[_0x512852(0x2b7)]()+_0x512852(0x1bc)+_0x1bd831[_0x512852(0x2b7)]());const _0x4719ba={'status':_0x512852(0x2ac),'gateway':{'not':'test_gateway'},'paidAt':{'gte':_0x9efea4,'lte':_0x1bd831}};_0x2be8fb[_0x512852(0x27c)]&&(_0x4719ba['shopId']=_0x2be8fb[_0x512852(0x27c)]);const _0x75df1b=await database_1['default'][_0x512852(0x1a4)][_0x512852(0x212)]({'where':_0x4719ba,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x512852(0x196)](_0x512852(0x27b)+_0x75df1b[_0x512852(0x290)]+_0x512852(0x1b0));const _0x313def={'gateway':{'not':_0x512852(0x1fa)},'status':{'not':_0x512852(0x291)},'createdAt':{'gte':_0x9efea4,'lte':_0x1bd831}};_0x2be8fb['shopId']&&(_0x313def['shopId']=_0x2be8fb[_0x512852(0x27c)]);const _0x593ab6=await database_1[_0x512852(0x189)][_0x512852(0x1a4)]['count']({'where':_0x313def}),_0x1bd324={..._0x313def,'status':'CHARGEBACK'},_0x591af7={..._0x313def,'status':_0x512852(0x1d9)},[_0x41d716,_0x155d1a]=await Promise['all']([database_1[_0x512852(0x189)][_0x512852(0x1a4)][_0x512852(0x263)]({'where':_0x1bd324}),database_1[_0x512852(0x189)]['payment'][_0x512852(0x263)]({'where':_0x591af7})]);console[_0x512852(0x196)](_0x512852(0x15a)+_0x593ab6+_0x512852(0x28d)+_0x75df1b[_0x512852(0x290)]+',\x20chargebacks:\x20'+_0x41d716+_0x512852(0x232)+_0x155d1a);let _0x40527f=0x0,_0x4e2211=0x0,_0x291af3=0x0;const _0x232190={},_0x267507={},_0x5d4d96={};for(const _0x48f54d of _0x75df1b){try{const _0x388254=_0x48f54d[_0x512852(0x279)]||0x0;if(_0x388254<=0x0){console[_0x512852(0x1ed)](_0x512852(0x2c8)+_0x48f54d['id']+_0x512852(0x254));continue;}let _0x1a1a02,_0xc08a44;if(_0x48f54d[_0x512852(0x165)]!==null&&_0x48f54d[_0x512852(0x165)]!==undefined)_0x1a1a02=_0x48f54d[_0x512852(0x165)],_0xc08a44=_0x388254-_0x1a1a02,console[_0x512852(0x196)](_0x512852(0x1b5)+_0x48f54d['id']+':\x20'+_0x388254[_0x512852(0x247)](0x6)+_0x512852(0x1e3)+_0x1a1a02[_0x512852(0x247)](0x6)+_0x512852(0x199));else{let _0x31478e={};if(_0x48f54d['shop'][_0x512852(0x191)])try{_0x31478e=JSON[_0x512852(0x222)](_0x48f54d[_0x512852(0x24d)][_0x512852(0x191)]);}catch(_0x64c4a9){console['error'](_0x512852(0x164)+_0x48f54d[_0x512852(0x27c)]+':',_0x64c4a9);}let _0x4563b7=0x2d;for(const [_0xa239df,_0x2739f9]of Object['entries'](_0x31478e)){if(_0xa239df['toLowerCase']()===_0x48f54d[_0x512852(0x1f1)]['toLowerCase']()){_0x4563b7=_0x2739f9[_0x512852(0x23e)]||0x2d;break;}}_0xc08a44=_0x388254*(_0x4563b7/0x64),_0x1a1a02=_0x388254-_0xc08a44,console['log'](_0x512852(0x29c)+_0x48f54d['id']+':\x20'+_0x4563b7+_0x512852(0x255)+_0x388254[_0x512852(0x247)](0x6)+_0x512852(0x199));}_0x40527f+=_0x388254,_0x4e2211+=_0x1a1a02,_0x291af3+=_0xc08a44;let _0xc689a;_0x48f54d['gatewayCommissionRate']!==null&&_0x48f54d[_0x512852(0x15c)]!==undefined?(_0xc689a=_0x48f54d[_0x512852(0x15c)],console['log'](_0x512852(0x22f)+_0x48f54d['id']+':\x20'+_0xc689a+'%')):(_0xc689a=_0x388254>0x0?_0xc08a44/_0x388254*0x64:0x0,console['log'](_0x512852(0x1b7)+_0x48f54d['id']+':\x20'+_0xc689a['toFixed'](0x2)+'%'));!_0x232190[_0x48f54d['gateway']]&&(_0x232190[_0x48f54d[_0x512852(0x1f1)]]={'gateway':_0x48f54d[_0x512852(0x1f1)],'gatewayDisplayName':this[_0x512852(0x29e)](_0x48f54d[_0x512852(0x1f1)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x232190[_0x48f54d[_0x512852(0x1f1)]][_0x512852(0x200)]++,_0x232190[_0x48f54d[_0x512852(0x1f1)]][_0x512852(0x2c7)]+=_0x388254,_0x232190[_0x48f54d[_0x512852(0x1f1)]]['commissionUSDT']+=_0xc08a44,_0x232190[_0x48f54d[_0x512852(0x1f1)]][_0x512852(0x2c3)]+=_0x1a1a02,_0x232190[_0x48f54d['gateway']]['totalCommissionRate']+=_0xc689a;!_0x2be8fb[_0x512852(0x27c)]&&(!_0x267507[_0x48f54d[_0x512852(0x27c)]]&&(_0x267507[_0x48f54d['shopId']]={'shopId':_0x48f54d[_0x512852(0x27c)],'shopName':_0x48f54d[_0x512852(0x24d)][_0x512852(0x1ba)],'shopUsername':_0x48f54d[_0x512852(0x24d)][_0x512852(0x2c4)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x267507[_0x48f54d['shopId']][_0x512852(0x200)]++,_0x267507[_0x48f54d[_0x512852(0x27c)]][_0x512852(0x2c7)]+=_0x388254,_0x267507[_0x48f54d[_0x512852(0x27c)]][_0x512852(0x178)]+=_0xc08a44,_0x267507[_0x48f54d[_0x512852(0x27c)]][_0x512852(0x2c3)]+=_0x1a1a02);const _0x104ec8=_0x48f54d[_0x512852(0x1c8)][_0x512852(0x2b7)]()[_0x512852(0x29f)]('T')[0x0];!_0x5d4d96[_0x104ec8]&&(_0x5d4d96[_0x104ec8]={'date':_0x104ec8,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x5d4d96[_0x104ec8][_0x512852(0x23f)]+=_0x388254,_0x5d4d96[_0x104ec8][_0x512852(0x1ab)]+=_0x1a1a02,_0x5d4d96[_0x104ec8][_0x512852(0x1cd)]+=_0xc08a44,_0x5d4d96[_0x104ec8]['paymentsCount']++;}catch(_0x498ed7){console[_0x512852(0x1df)](_0x512852(0x1cc)+_0x48f54d['id']+':',_0x498ed7);}}Object[_0x512852(0x241)](_0x232190)[_0x512852(0x25d)](_0x5340f9=>{const _0xf9f419=_0x512852;_0x5340f9[_0xf9f419(0x22b)]=_0x5340f9['paymentsCount']>0x0?_0x5340f9[_0xf9f419(0x201)]/_0x5340f9[_0xf9f419(0x200)]:0x0,delete _0x5340f9[_0xf9f419(0x201)];}),Object[_0x512852(0x241)](_0x267507)[_0x512852(0x25d)](_0x140401=>{const _0x28fb24=_0x512852;_0x140401[_0x28fb24(0x299)]=_0x140401[_0x28fb24(0x200)]>0x0?_0x140401[_0x28fb24(0x2c7)]/_0x140401[_0x28fb24(0x200)]:0x0;});let _0x4691dd=0x0,_0x35c381=0x0;if(_0x2be8fb[_0x512852(0x27c)]){const _0x4f05df=await database_1['default'][_0x512852(0x1da)][_0x512852(0x212)]({'where':{'shopId':_0x2be8fb[_0x512852(0x27c)],'status':_0x512852(0x20a),'createdAt':{'gte':_0x9efea4,'lte':_0x1bd831}},'select':{'amount':!![]}});_0x4691dd=_0x4f05df['reduce']((_0xb8e055,_0x264d96)=>_0xb8e055+_0x264d96[_0x512852(0x181)],0x0);const _0x36650f=await database_1[_0x512852(0x189)][_0x512852(0x1da)][_0x512852(0x212)]({'where':{'shopId':_0x2be8fb[_0x512852(0x27c)],'status':_0x512852(0x291),'createdAt':{'gte':_0x9efea4,'lte':_0x1bd831}},'select':{'amount':!![]}});_0x35c381=_0x36650f['reduce']((_0x4d71d1,_0x5b434e)=>_0x4d71d1+_0x5b434e[_0x512852(0x181)],0x0);}const _0xc7fad6=_0x593ab6,_0x5545b2=_0x75df1b[_0x512852(0x290)],_0x4773a0=_0x5545b2>0x0?_0x40527f/_0x5545b2:0x0,_0x56f1cc=_0xc7fad6>0x0?Math[_0x512852(0x240)](_0x5545b2/_0xc7fad6*0x2710)/0x64:0x0,_0x1aa13e=Math[_0x512852(0x1eb)]((_0x1bd831[_0x512852(0x248)]()-_0x9efea4[_0x512852(0x248)]())/(0x3e8*0x3c*0x3c*0x18)),_0x3f81d6={'totalTurnover':Math[_0x512852(0x240)](_0x40527f*0x64)/0x64,'merchantEarnings':Math[_0x512852(0x240)](_0x4e2211*0x64)/0x64,'gatewayEarnings':Math['round'](_0x291af3*0x64)/0x64,'totalPaidOut':Math[_0x512852(0x240)](_0x4691dd*0x64)/0x64,'pendingPayout':Math['round'](_0x35c381*0x64)/0x64,'averageCheck':Math[_0x512852(0x240)](_0x4773a0*0x64)/0x64,'totalPayments':_0xc7fad6,'successfulPayments':_0x5545b2,'conversionRate':_0x56f1cc,'chargebacks':_0x41d716,'refunds':_0x155d1a,'gatewayBreakdown':Object['values'](_0x232190)[_0x512852(0x1ae)](_0x4a9f74=>({..._0x4a9f74,'turnoverUSDT':Math[_0x512852(0x240)](_0x4a9f74[_0x512852(0x2c7)]*0x64)/0x64,'commissionUSDT':Math[_0x512852(0x240)](_0x4a9f74[_0x512852(0x178)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x512852(0x240)](_0x4a9f74[_0x512852(0x2c3)]*0x64)/0x64,'averageCommissionRate':Math[_0x512852(0x240)](_0x4a9f74['averageCommissionRate']*0x64)/0x64})),'merchantBreakdown':_0x2be8fb['shopId']?undefined:Object[_0x512852(0x241)](_0x267507)[_0x512852(0x1ae)](_0x3b655b=>({..._0x3b655b,'turnoverUSDT':Math['round'](_0x3b655b[_0x512852(0x2c7)]*0x64)/0x64,'commissionUSDT':Math[_0x512852(0x240)](_0x3b655b[_0x512852(0x178)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x512852(0x240)](_0x3b655b[_0x512852(0x2c3)]*0x64)/0x64,'paidOutUSDT':Math['round'](_0x3b655b[_0x512852(0x1f5)]*0x64)/0x64,'averageCheckUSDT':Math[_0x512852(0x240)](_0x3b655b[_0x512852(0x299)]*0x64)/0x64})),'dailyData':Object[_0x512852(0x241)](_0x5d4d96)[_0x512852(0x1ae)](_0x2f8242=>({..._0x2f8242,'turnover':Math['round'](_0x2f8242[_0x512852(0x23f)]*0x64)/0x64,'merchantEarnings':Math['round'](_0x2f8242[_0x512852(0x1ab)]*0x64)/0x64,'gatewayEarnings':Math[_0x512852(0x240)](_0x2f8242[_0x512852(0x1cd)]*0x64)/0x64}))[_0x512852(0x1b2)]((_0x204237,_0x3d3bfc)=>_0x204237['date'][_0x512852(0x24f)](_0x3d3bfc[_0x512852(0x238)])),'periodInfo':{'from':_0x9efea4,'to':_0x1bd831,'periodType':_0x2be8fb['period']||'custom','daysCount':_0x1aa13e}};return console[_0x512852(0x196)](_0x512852(0x220)),console[_0x512852(0x196)](_0x512852(0x235)+_0x3f81d6[_0x512852(0x182)]+_0x512852(0x199)),console['log']('\x20\x20\x20üë§\x20Merchant\x20earnings:\x20'+_0x3f81d6[_0x512852(0x1ab)]+'\x20USDT'),console['log'](_0x512852(0x1ee)+_0x3f81d6[_0x512852(0x1cd)]+_0x512852(0x199)),console['log']('\x20\x20\x20ÔøΩ\x20Total\x20paid\x20out:\x20'+_0x3f81d6[_0x512852(0x174)]+'\x20USDT'),console['log'](_0x512852(0x186)+_0x3f81d6[_0x512852(0x268)]+_0x512852(0x199)),console[_0x512852(0x196)](_0x512852(0x20d)+_0x3f81d6[_0x512852(0x1c6)]),_0x3f81d6;}async[a46_0x316b14(0x28a)](_0xb6ef75){const _0x26511a=a46_0x316b14;console['log'](_0x26511a(0x210),{'hasPayoutHistory':_0xb6ef75});let _0x28aa30={};_0xb6ef75&&(_0x28aa30['payouts']={'some':{}});const _0x375425=await database_1[_0x26511a(0x189)][_0x26511a(0x24d)][_0x26511a(0x212)]({'where':_0x28aa30,'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':'asc'}});return console[_0x26511a(0x196)](_0x26511a(0x198)+_0x375425['length']+_0x26511a(0x234)+(_0xb6ef75?_0x26511a(0x1a3):'')),_0x375425[_0x26511a(0x1ae)](_0x55b926=>({'id':_0x55b926['id'],'username':_0x55b926[_0x26511a(0x2c4)],'name':_0x55b926[_0x26511a(0x1ba)]}));}[a46_0x316b14(0x29e)](_0x189663){const _0x35a16d=a46_0x316b14,_0x193251={'test_gateway':'Test\x20Gateway','plisio':_0x35a16d(0x16a),'rapyd':_0x35a16d(0x2bc),'noda':'Noda','cointopay':_0x35a16d(0x244),'cointopay2':_0x35a16d(0x297),'klyme_eu':_0x35a16d(0x1d1),'klyme_gb':_0x35a16d(0x204),'klyme_de':_0x35a16d(0x24a),'mastercard':_0x35a16d(0x227)};return _0x193251[_0x189663]||_0x189663;}[a46_0x316b14(0x184)](_0x59ac36){const _0x32b8f1=a46_0x316b14,_0x4f5727={'Test\x20Gateway':'test_gateway','Plisio':'plisio','Rapyd':_0x32b8f1(0x180),'Noda':_0x32b8f1(0x2a8),'CoinToPay':_0x32b8f1(0x19e),'CoinToPay2':_0x32b8f1(0x1e4),'KLYME\x20EU':'klyme_eu','KLYME\x20GB':_0x32b8f1(0x1d5),'KLYME\x20DE':_0x32b8f1(0x2a5),'MasterCard':_0x32b8f1(0x2ad)};return _0x4f5727[_0x59ac36]||_0x59ac36['toLowerCase']();}async[a46_0x316b14(0x18f)](_0x439dd2){const _0x366887=a46_0x316b14,{page:_0x26b402,limit:_0x30be61,minAmount:_0x26382c,search:_0xe58d50}=_0x439dd2;console['log'](_0x366887(0x21a),_0x439dd2);let _0x5264af={};_0xe58d50&&(_0x5264af[_0x366887(0x1ba)]={'contains':_0xe58d50,'mode':_0x366887(0x259)});const _0x3b6996=await database_1[_0x366887(0x189)][_0x366887(0x24d)][_0x366887(0x212)]({'where':_0x5264af,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),_0xff1b8f=_0x3b6996[_0x366887(0x161)](_0x581ac8=>{const _0x2323a5=_0x366887,_0x2c7918=Math[_0x2323a5(0x28e)](_0x581ac8[_0x2323a5(0x15d)]*0x64)/0x64;if(_0x26382c&&_0x2c7918<_0x26382c)return![];return _0x2c7918!==0x0;});_0xff1b8f[_0x366887(0x1b2)]((_0x18f8b6,_0xbe80e2)=>_0xbe80e2['balance']-_0x18f8b6[_0x366887(0x15d)]);const _0x2672c4=_0xff1b8f[_0x366887(0x290)],_0x2017dd=(_0x26b402-0x1)*_0x30be61,_0x29f483=_0xff1b8f['slice'](_0x2017dd,_0x2017dd+_0x30be61);console[_0x366887(0x196)]('üí∞\x20Found\x20'+_0x29f483[_0x366887(0x290)]+'\x20merchants\x20with\x20rounded\x20balance\x20!=\x200.00\x20(excluding\x20balances\x20that\x20round\x20to\x200.00)');const _0x41b8c3=await Promise['all'](_0x29f483[_0x366887(0x1ae)](async _0x19e76b=>{const _0x1b8dc9=_0x366887,[_0x5962b0,_0xb00ce5,_0x517b66]=await Promise[_0x1b8dc9(0x1c3)]([database_1[_0x1b8dc9(0x189)][_0x1b8dc9(0x1a4)][_0x1b8dc9(0x263)]({'where':{'shopId':_0x19e76b['id'],'status':'PAID','gateway':{'not':_0x1b8dc9(0x1fa)}}}),database_1[_0x1b8dc9(0x189)]['payment']['findFirst']({'where':{'shopId':_0x19e76b['id'],'status':_0x1b8dc9(0x2ac),'gateway':{'not':_0x1b8dc9(0x1fa)}},'orderBy':{'paidAt':'asc'},'select':{'paidAt':!![]}}),database_1[_0x1b8dc9(0x189)][_0x1b8dc9(0x1a4)][_0x1b8dc9(0x25f)]({'by':[_0x1b8dc9(0x1f1)],'where':{'shopId':_0x19e76b['id'],'status':'PAID','gateway':{'not':'test_gateway'}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x39212a=new Date(),_0x52abb8=new Date(_0x39212a[_0x1b8dc9(0x2a1)](),_0x39212a['getMonth'](),0x1),_0x2a2957=new Date(_0x39212a[_0x1b8dc9(0x2a1)](),_0x39212a[_0x1b8dc9(0x1c2)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x4b57ea,_0x215444]=await Promise['all']([database_1[_0x1b8dc9(0x189)][_0x1b8dc9(0x1da)]['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x19e76b['id'],'status':_0x1b8dc9(0x20a)}}),database_1[_0x1b8dc9(0x189)]['payout']['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x19e76b['id'],'status':_0x1b8dc9(0x20a),'createdAt':{'gte':_0x52abb8,'lte':_0x2a2957}}})]),_0x3f498a=_0x4b57ea[_0x1b8dc9(0x273)][_0x1b8dc9(0x181)]||0x0,_0x17b082=_0x215444[_0x1b8dc9(0x273)][_0x1b8dc9(0x181)]||0x0,_0x51a361=await Promise[_0x1b8dc9(0x1c3)](_0x517b66[_0x1b8dc9(0x1ae)](async _0x64604e=>{const _0x59dd88=_0x1b8dc9;let _0x2d979b=0x2d;if(_0x19e76b[_0x59dd88(0x191)])try{const _0x1b2019=JSON[_0x59dd88(0x222)](_0x19e76b['gatewaySettings']);for(const [_0x102388,_0x24a819]of Object[_0x59dd88(0x1f2)](_0x1b2019)){if(_0x102388[_0x59dd88(0x2bb)]()===_0x64604e[_0x59dd88(0x1f1)][_0x59dd88(0x2bb)]()){_0x2d979b=_0x24a819[_0x59dd88(0x23e)]||0xa,console[_0x59dd88(0x196)](_0x59dd88(0x173)+_0x64604e['gateway']+'\x20for\x20shop\x20'+_0x19e76b['id']+_0x59dd88(0x236)+_0x2d979b+'%');break;}}}catch(_0x53fc54){console[_0x59dd88(0x1df)](_0x59dd88(0x164)+_0x19e76b['id']+':',_0x53fc54);}const _0xe82240=_0x64604e[_0x59dd88(0x273)]?.[_0x59dd88(0x279)]||0x0,_0x399a57=_0xe82240*(0x1-_0x2d979b/0x64);return{'gateway':_0x64604e[_0x59dd88(0x1f1)],'count':_0x64604e[_0x59dd88(0x21d)]?.['id']||0x0,'amountUSDT':Math['round'](_0xe82240*0x64)/0x64,'amountAfterCommissionUSDT':Math['round'](_0x399a57*0x64)/0x64,'commission':_0x2d979b};})),_0x146fae=_0x51a361[_0x1b8dc9(0x2b2)]((_0x367a2f,_0x4ff091)=>_0x367a2f+_0x4ff091[_0x1b8dc9(0x279)],0x0),_0x3d78ac=_0x51a361['reduce']((_0x23d63c,_0x40dd43)=>_0x23d63c+_0x40dd43[_0x1b8dc9(0x15b)],0x0),_0x33a115=_0x19e76b[_0x1b8dc9(0x15d)];return console[_0x1b8dc9(0x196)](_0x1b8dc9(0x1af)+_0x19e76b[_0x1b8dc9(0x2c4)]+':'),console[_0x1b8dc9(0x196)](_0x1b8dc9(0x21c)+_0x146fae[_0x1b8dc9(0x247)](0x2)+_0x1b8dc9(0x177)),console[_0x1b8dc9(0x196)]('\x20\x20\x20üîç\x20Calculated\x20after\x20commission:\x20'+_0x3d78ac['toFixed'](0x2)+_0x1b8dc9(0x287)),console['log'](_0x1b8dc9(0x1dd)+_0x33a115['toFixed'](0x2)+_0x1b8dc9(0x1ec)),console[_0x1b8dc9(0x196)](_0x1b8dc9(0x2c5)+_0x3f498a[_0x1b8dc9(0x247)](0x2)+_0x1b8dc9(0x223)),console[_0x1b8dc9(0x196)](_0x1b8dc9(0x25e)+(_0x3d78ac-_0x3f498a-_0x33a115)[_0x1b8dc9(0x247)](0x2)+_0x1b8dc9(0x208)),{'id':_0x19e76b['id'],'fullName':_0x19e76b[_0x1b8dc9(0x1ba)],'username':_0x19e76b[_0x1b8dc9(0x2c4)],'telegramId':_0x19e76b['telegram'],'merchantUrl':_0x19e76b[_0x1b8dc9(0x260)],'wallets':{'usdtPolygonWallet':_0x19e76b['usdtPolygonWallet'],'usdtTrcWallet':_0x19e76b[_0x1b8dc9(0x262)],'usdtErcWallet':_0x19e76b[_0x1b8dc9(0x17a)],'usdcPolygonWallet':_0x19e76b[_0x1b8dc9(0x167)],'usdcErcWallet':_0x19e76b['usdcErcWallet']},'totalAmountUSDT':Math['round'](_0x146fae*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x3d78ac*0x64)/0x64,'currentBalance':Math[_0x1b8dc9(0x28e)](_0x33a115*0x64)/0x64,'totalPayout':Math[_0x1b8dc9(0x240)](_0x3f498a*0x64)/0x64,'thisMonth':Math[_0x1b8dc9(0x240)](_0x17b082*0x64)/0x64,'paymentsCount':_0x5962b0,'oldestPaymentDate':_0xb00ce5?.[_0x1b8dc9(0x1c8)]||_0x19e76b[_0x1b8dc9(0x1fb)],'gatewayBreakdown':_0x51a361};})),_0x4aeb91=_0x41b8c3['reduce']((_0x3598b7,_0x3cd3bc)=>_0x3598b7+_0x3cd3bc[_0x366887(0x18d)],0x0),_0x45df2d=_0x41b8c3['reduce']((_0x560bb7,_0x45f63b)=>_0x560bb7+_0x45f63b[_0x366887(0x18e)],0x0),_0x41c6f0=_0x41b8c3[_0x366887(0x2b2)]((_0x36d262,_0x42b44a)=>_0x36d262+_0x42b44a[_0x366887(0x2a2)],0x0),_0x5f4c08=_0x41b8c3[_0x366887(0x2b2)]((_0x1478f1,_0x85e988)=>_0x1478f1+_0x85e988['thisMonth'],0x0);return console[_0x366887(0x196)]('üìä\x20Merchants\x20with\x20rounded\x20balance\x20!=\x200.00:\x20'+_0x2672c4+_0x366887(0x292)),console[_0x366887(0x196)](_0x366887(0x17d)+Math[_0x366887(0x240)](_0x4aeb91*0x64)/0x64+'\x20USDT\x20(gross\x20revenue)'),console[_0x366887(0x196)](_0x366887(0x265)+Math[_0x366887(0x240)](_0x45df2d*0x64)/0x64+_0x366887(0x1b4)),console[_0x366887(0x196)]('\x20\x20\x20üí∏\x20Total\x20payouts\x20(all\x20time):\x20'+Math[_0x366887(0x240)](_0x41c6f0*0x64)/0x64+'\x20USDT'),console['log'](_0x366887(0x214)+Math['round'](_0x5f4c08*0x64)/0x64+_0x366887(0x199)),{'merchants':_0x41b8c3,'pagination':{'page':_0x26b402,'limit':_0x30be61,'total':_0x2672c4,'totalPages':Math[_0x366887(0x1eb)](_0x2672c4/_0x30be61)},'summary':{'totalMerchants':_0x2672c4,'totalAmountUSDT':Math[_0x366887(0x240)](_0x4aeb91*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x366887(0x240)](_0x45df2d*0x64)/0x64,'totalPayout':Math[_0x366887(0x240)](_0x41c6f0*0x64)/0x64,'thisMonth':Math[_0x366887(0x240)](_0x5f4c08*0x64)/0x64}};}async[a46_0x316b14(0x296)](_0x36bdd0){const _0x3fca99=a46_0x316b14,{shopId:_0x2448ce,amount:_0x43589f,network:_0x8194d8,wallet:_0x5aee1f,notes:_0x330215,txid:_0x6b2b3e,periodFrom:_0x3b5e5b,periodTo:_0x4fcd56}=_0x36bdd0,_0x40349e=await database_1[_0x3fca99(0x189)][_0x3fca99(0x1ff)](async _0x48afdf=>{const _0x4808d7=_0x3fca99,_0x1ba112=await _0x48afdf[_0x4808d7(0x24d)][_0x4808d7(0x257)]({'where':{'id':_0x2448ce},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x1ba112)throw new Error(_0x4808d7(0x285));console[_0x4808d7(0x196)](_0x4808d7(0x188)+_0x1ba112[_0x4808d7(0x2c4)]+':'),console['log'](_0x4808d7(0x2ae)+_0x1ba112['balance']['toFixed'](0x6)+_0x4808d7(0x199)),console[_0x4808d7(0x196)](_0x4808d7(0x24e)+_0x43589f[_0x4808d7(0x247)](0x6)+_0x4808d7(0x199)),console[_0x4808d7(0x196)](_0x4808d7(0x2b4)+_0x1ba112[_0x4808d7(0x174)][_0x4808d7(0x247)](0x6)+_0x4808d7(0x199));if(_0x6b2b3e)console['log'](_0x4808d7(0x1c0)+_0x6b2b3e);const _0x4dbb93=0.000001,_0x14349b=Number(_0x1ba112[_0x4808d7(0x15d)]),_0x21c74b=Number(_0x43589f);console[_0x4808d7(0x196)]('üîç\x20Balance\x20check\x20details:'),console[_0x4808d7(0x196)](_0x4808d7(0x242)+_0x1ba112[_0x4808d7(0x15d)]),console[_0x4808d7(0x196)](_0x4808d7(0x2b3)+_0x14349b),console[_0x4808d7(0x196)]('\x20\x20\x20Requested\x20(number):\x20'+_0x21c74b),console[_0x4808d7(0x196)](_0x4808d7(0x1c5)+(_0x14349b-_0x21c74b)),console['log'](_0x4808d7(0x15f)+_0x4dbb93);if(_0x14349b<_0x21c74b-_0x4dbb93)throw new Error(_0x4808d7(0x2b0)+_0x14349b[_0x4808d7(0x247)](0x6)+_0x4808d7(0x2cb)+_0x21c74b['toFixed'](0x6)+'\x20USDT,\x20Difference:\x20'+(_0x14349b-_0x21c74b)[_0x4808d7(0x247)](0x8)+_0x4808d7(0x199));console[_0x4808d7(0x196)](_0x4808d7(0x219));const _0x55af44=Math['min'](_0x14349b,_0x21c74b);let _0x2ae104=_0x5aee1f;console[_0x4808d7(0x196)](_0x4808d7(0x275)+(_0x5aee1f||_0x4808d7(0x264)));if(!_0x2ae104){console[_0x4808d7(0x196)](_0x4808d7(0x21b));const _0x500c0a=await _0x48afdf[_0x4808d7(0x24d)][_0x4808d7(0x257)]({'where':{'id':_0x2448ce},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});console[_0x4808d7(0x196)]('üîç\x20Shop\x20wallets:',_0x500c0a);if(_0x500c0a)switch(_0x8194d8){case _0x4808d7(0x1a5):_0x2ae104=_0x500c0a['usdtPolygonWallet']||undefined,console['log'](_0x4808d7(0x24b)+_0x2ae104);break;case _0x4808d7(0x1d3):_0x2ae104=_0x500c0a[_0x4808d7(0x262)]||undefined,console[_0x4808d7(0x196)](_0x4808d7(0x26f)+_0x2ae104);break;case _0x4808d7(0x1dc):_0x2ae104=_0x500c0a['usdtErcWallet']||undefined,console[_0x4808d7(0x196)]('üîç\x20Selected\x20erc20\x20wallet:\x20'+_0x2ae104);break;case _0x4808d7(0x2bf):_0x2ae104=_0x500c0a[_0x4808d7(0x167)]||undefined,console['log'](_0x4808d7(0x228)+_0x2ae104);break;case _0x4808d7(0x230):_0x2ae104=_0x500c0a['usdcErcWallet']||undefined,console['log'](_0x4808d7(0x15e)+_0x2ae104);break;}}else console[_0x4808d7(0x196)]('‚úÖ\x20Using\x20wallet\x20from\x20request:\x20'+_0x2ae104);console['log']('üí≥\x20Final\x20payout\x20wallet\x20for\x20'+_0x8194d8+':\x20'+(_0x2ae104||_0x4808d7(0x2b5))),console[_0x4808d7(0x196)](_0x4808d7(0x1de),{'shopId':_0x2448ce,'amount':_0x55af44,'network':_0x8194d8,'wallet':_0x2ae104,'status':'COMPLETED','txid':_0x6b2b3e,'notes':_0x330215,'periodFrom':_0x3b5e5b?new Date(_0x3b5e5b):null,'periodTo':_0x4fcd56?new Date(_0x4fcd56):null});const _0x2cfd35=await _0x48afdf['payout'][_0x4808d7(0x2a0)]({'data':{'shopId':_0x2448ce,'amount':_0x55af44,'network':_0x8194d8,'wallet':_0x2ae104,'status':_0x4808d7(0x20a),'txid':_0x6b2b3e,'notes':_0x330215,'periodFrom':_0x3b5e5b?new Date(_0x3b5e5b):null,'periodTo':_0x4fcd56?new Date(_0x4fcd56):null,'createdAt':new Date(),'paidAt':new Date()}});console['log'](_0x4808d7(0x1e5),{'id':_0x2cfd35['id'],'wallet':_0x2cfd35[_0x4808d7(0x29a)],'network':_0x2cfd35[_0x4808d7(0x205)],'amount':_0x2cfd35[_0x4808d7(0x181)]});const _0x41004e=_0x14349b-_0x55af44,_0x24ed96=Number(_0x1ba112[_0x4808d7(0x174)])+_0x55af44;return await _0x48afdf[_0x4808d7(0x24d)][_0x4808d7(0x19b)]({'where':{'id':_0x2448ce},'data':{'balance':_0x41004e,'totalPaidOut':_0x24ed96}}),console[_0x4808d7(0x196)](_0x4808d7(0x282)+_0x1ba112['username']+_0x4808d7(0x27e)),console[_0x4808d7(0x196)](_0x4808d7(0x1f9)+_0x14349b[_0x4808d7(0x247)](0x6)+_0x4808d7(0x253)+_0x41004e[_0x4808d7(0x247)](0x6)+_0x4808d7(0x294)+_0x55af44['toFixed'](0x6)+')'),console[_0x4808d7(0x196)](_0x4808d7(0x23d)+_0x1ba112[_0x4808d7(0x174)][_0x4808d7(0x247)](0x6)+_0x4808d7(0x253)+_0x24ed96[_0x4808d7(0x247)](0x6)+'\x20USDT\x20(+'+_0x55af44[_0x4808d7(0x247)](0x6)+')'),console[_0x4808d7(0x196)]('\x20\x20\x20Final\x20payout\x20amount\x20used:\x20'+_0x55af44[_0x4808d7(0x247)](0x6)+'\x20USDT'),{'payout':_0x2cfd35,'shop':_0x1ba112};});console[_0x3fca99(0x196)](_0x3fca99(0x1b6)+_0x40349e[_0x3fca99(0x1da)]['id']+_0x3fca99(0x27f)+_0x40349e['shop']['username']+'\x20('+_0x40349e[_0x3fca99(0x1da)][_0x3fca99(0x181)][_0x3fca99(0x247)](0x6)+_0x3fca99(0x29d));try{let _0x88af4=_0x3fca99(0x1a8);if(_0x40349e[_0x3fca99(0x1da)][_0x3fca99(0x2a3)]&&_0x40349e[_0x3fca99(0x1da)]['periodTo']){const _0x18ad9f=new Date(_0x40349e[_0x3fca99(0x1da)][_0x3fca99(0x2a3)])[_0x3fca99(0x2c6)](_0x3fca99(0x1e9)),_0x34f9af=new Date(_0x40349e[_0x3fca99(0x1da)][_0x3fca99(0x261)])[_0x3fca99(0x2c6)]('ru-RU');_0x88af4=_0x18ad9f+_0x3fca99(0x2a4)+_0x34f9af;}await telegramBotService_1[_0x3fca99(0x19f)]['sendPayoutNotification'](_0x40349e[_0x3fca99(0x1da)][_0x3fca99(0x27c)],{'id':_0x40349e[_0x3fca99(0x1da)]['id'],'amount':_0x40349e[_0x3fca99(0x1da)][_0x3fca99(0x181)],'network':_0x40349e['payout'][_0x3fca99(0x205)],'wallet':_0x40349e[_0x3fca99(0x1da)][_0x3fca99(0x29a)],'period':_0x88af4,'createdAt':_0x40349e[_0x3fca99(0x1da)]['createdAt'],'txid':_0x40349e[_0x3fca99(0x1da)][_0x3fca99(0x16d)]}),console[_0x3fca99(0x196)](_0x3fca99(0x25b)+_0x40349e['payout']['id']);}catch(_0x13f307){console[_0x3fca99(0x1df)](_0x3fca99(0x1e2)+_0x40349e['payout']['id']+':',_0x13f307);}return{'id':_0x40349e[_0x3fca99(0x1da)]['id'],'shopId':_0x40349e['payout'][_0x3fca99(0x27c)],'shopName':_0x40349e[_0x3fca99(0x24d)][_0x3fca99(0x1ba)],'shopUsername':_0x40349e[_0x3fca99(0x24d)][_0x3fca99(0x2c4)],'amount':_0x40349e['payout'][_0x3fca99(0x181)],'network':_0x40349e[_0x3fca99(0x1da)][_0x3fca99(0x205)],'wallet':_0x40349e[_0x3fca99(0x1da)][_0x3fca99(0x29a)],'status':_0x40349e[_0x3fca99(0x1da)][_0x3fca99(0x2c0)],'txid':_0x40349e['payout'][_0x3fca99(0x16d)],'notes':_0x40349e[_0x3fca99(0x1da)]['notes'],'periodFrom':_0x40349e['payout'][_0x3fca99(0x2a3)],'periodTo':_0x40349e[_0x3fca99(0x1da)][_0x3fca99(0x261)],'createdAt':_0x40349e[_0x3fca99(0x1da)][_0x3fca99(0x1fb)],'paidAt':_0x40349e['payout'][_0x3fca99(0x1c8)]};}async['getAllPayouts'](_0xb2d124){const _0x448ec8=a46_0x316b14,{page:_0x2583d4,limit:_0x48a677,shopId:_0x329649,network:_0x566466,dateFrom:_0x16c5b8,dateTo:_0x23399e,search:_0x269cdc}=_0xb2d124,_0x3b54a2=(_0x2583d4-0x1)*_0x48a677,_0x5b3683={};_0x329649&&(_0x5b3683[_0x448ec8(0x27c)]=_0x329649);_0x566466&&(_0x5b3683['network']=_0x566466);if(_0x16c5b8||_0x23399e){_0x5b3683[_0x448ec8(0x1fb)]={};if(_0x16c5b8){const _0x272c4a=new Date(_0x16c5b8);_0x272c4a[_0x448ec8(0x187)](0x0,0x0,0x0,0x1),_0x5b3683['createdAt'][_0x448ec8(0x24c)]=_0x272c4a,console[_0x448ec8(0x196)](_0x448ec8(0x293)+_0x272c4a[_0x448ec8(0x2b7)]());}if(_0x23399e){const _0x16c3f2=new Date(_0x23399e);_0x16c3f2[_0x448ec8(0x187)](0x17,0x3b,0x3b,0x3e7),_0x5b3683[_0x448ec8(0x1fb)]['lte']=_0x16c3f2,console[_0x448ec8(0x196)](_0x448ec8(0x29b)+_0x16c3f2[_0x448ec8(0x2b7)]());}}_0x269cdc&&(_0x5b3683['OR']=[{'shop':{'name':{'contains':_0x269cdc,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x269cdc,'mode':'insensitive'}}},{'notes':{'contains':_0x269cdc,'mode':_0x448ec8(0x259)}}]);const [_0x13eccb,_0x377086]=await Promise['all']([database_1[_0x448ec8(0x189)][_0x448ec8(0x1da)][_0x448ec8(0x212)]({'where':_0x5b3683,'skip':_0x3b54a2,'take':_0x48a677,'orderBy':{'createdAt':_0x448ec8(0x249)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'wallet':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x448ec8(0x189)][_0x448ec8(0x1da)][_0x448ec8(0x263)]({'where':_0x5b3683})]);return{'payouts':_0x13eccb[_0x448ec8(0x1ae)](_0x54f900=>({'id':_0x54f900['id'],'shopId':_0x54f900[_0x448ec8(0x27c)],'shopName':_0x54f900['shop'][_0x448ec8(0x1ba)],'shopUsername':_0x54f900[_0x448ec8(0x24d)]['username'],'amount':_0x54f900[_0x448ec8(0x181)],'network':_0x54f900[_0x448ec8(0x205)],'wallet':_0x54f900[_0x448ec8(0x29a)],'status':_0x54f900[_0x448ec8(0x2c0)],'txid':_0x54f900[_0x448ec8(0x16d)],'notes':_0x54f900['notes'],'periodFrom':_0x54f900[_0x448ec8(0x2a3)],'periodTo':_0x54f900[_0x448ec8(0x261)],'createdAt':_0x54f900['createdAt'],'paidAt':_0x54f900['paidAt']})),'pagination':{'page':_0x2583d4,'limit':_0x48a677,'total':_0x377086,'totalPages':Math[_0x448ec8(0x1eb)](_0x377086/_0x48a677)}};}async[a46_0x316b14(0x2ca)](_0x425260){const _0x1655ea=a46_0x316b14,_0x1e12e0=await database_1[_0x1655ea(0x189)][_0x1655ea(0x1da)][_0x1655ea(0x257)]({'where':{'id':_0x425260},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x1e12e0)return null;return{'id':_0x1e12e0['id'],'shopId':_0x1e12e0[_0x1655ea(0x27c)],'shopName':_0x1e12e0[_0x1655ea(0x24d)]['name'],'shopUsername':_0x1e12e0[_0x1655ea(0x24d)][_0x1655ea(0x2c4)],'amount':_0x1e12e0[_0x1655ea(0x181)],'network':_0x1e12e0[_0x1655ea(0x205)],'wallet':_0x1e12e0[_0x1655ea(0x29a)],'status':_0x1e12e0[_0x1655ea(0x2c0)],'txid':_0x1e12e0['txid'],'notes':_0x1e12e0[_0x1655ea(0x16f)],'periodFrom':_0x1e12e0['periodFrom'],'periodTo':_0x1e12e0[_0x1655ea(0x261)],'createdAt':_0x1e12e0['createdAt'],'paidAt':_0x1e12e0[_0x1655ea(0x1c8)]};}async['deletePayout'](_0x3a74d9){const _0x41fa6c=a46_0x316b14;await database_1[_0x41fa6c(0x189)]['payout']['delete']({'where':{'id':_0x3a74d9}});}async[a46_0x316b14(0x295)](_0x520e88){const _0x3024af=a46_0x316b14,{page:_0x42a41d,limit:_0x34d6ea,status:_0x1a24ec,gateway:_0x54eca1,shopId:_0x14f7c2,dateFrom:_0x5bcf39,dateTo:_0x1dd3a7,search:_0x44c761,currency:_0x3053a5,sortBy:_0x4e0b1b,sortOrder:_0x47e318}=_0x520e88,_0x1d48e7=(_0x42a41d-0x1)*_0x34d6ea;console['log']('üìä\x20Getting\x20payments\x20with\x20filters:',_0x520e88);const _0x5a01ca=await database_1['default'][_0x3024af(0x1a4)][_0x3024af(0x25f)]({'by':['gateway'],'_count':{'gateway':!![]}});console[_0x3024af(0x196)](_0x3024af(0x22d),_0x5a01ca[_0x3024af(0x1ae)](_0x1d76f4=>_0x1d76f4[_0x3024af(0x1f1)]+'\x20('+_0x1d76f4[_0x3024af(0x21d)][_0x3024af(0x1f1)]+_0x3024af(0x21e)));if(_0x54eca1){const _0x3cefd6=_0x5a01ca[_0x3024af(0x2b1)](_0x704a4c=>_0x704a4c[_0x3024af(0x1f1)][_0x3024af(0x2bb)]()===_0x54eca1[_0x3024af(0x2bb)]());!_0x3cefd6&&_0x54eca1['toLowerCase']()!==_0x3024af(0x1fa)&&console[_0x3024af(0x196)]('‚ö†Ô∏è\x20Requested\x20gateway\x20\x27'+_0x54eca1+_0x3024af(0x16c)+_0x5a01ca[_0x3024af(0x1ae)](_0x500b47=>_0x500b47[_0x3024af(0x1f1)])[_0x3024af(0x256)](',\x20'));}const _0x29d9c1={};_0x1a24ec&&(_0x29d9c1[_0x3024af(0x2c0)]=_0x1a24ec[_0x3024af(0x1f6)]());if(!_0x54eca1)_0x29d9c1[_0x3024af(0x1f1)]={'not':_0x3024af(0x1fa)};else{if(_0x54eca1&&(_0x54eca1[_0x3024af(0x2bb)]()===_0x3024af(0x1fa)||_0x54eca1==='0000'))_0x29d9c1[_0x3024af(0x1f1)]='test_gateway';else{let _0x3ce734=_0x54eca1;const _0x56062e=(0x0,gateway_1[_0x3024af(0x190)])(_0x54eca1);if(_0x56062e)_0x3ce734=_0x56062e,console[_0x3024af(0x196)]('üîÑ\x20Converted\x20gateway\x20ID\x20\x27'+_0x54eca1+'\x27\x20to\x20name\x20\x27'+_0x3ce734+'\x27');else{const _0x10aa46=(0x0,gateway_1['getGatewayIdByName'])(_0x54eca1);if(_0x10aa46){const _0x5c066a=(0x0,gateway_1[_0x3024af(0x190)])(_0x10aa46);_0x5c066a&&(_0x3ce734=_0x5c066a,console[_0x3024af(0x196)](_0x3024af(0x226)+_0x54eca1+_0x3024af(0x1fd)+_0x10aa46+_0x3024af(0x28b)+_0x3ce734+'\x27'));}else console[_0x3024af(0x196)](_0x3024af(0x213)+_0x54eca1+'\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)');}const _0x48b48f=await database_1['default'][_0x3024af(0x1a4)][_0x3024af(0x263)]({'where':{'gateway':_0x3ce734[_0x3024af(0x2bb)]()},'take':0x1});_0x48b48f===0x0?(console['log'](_0x3024af(0x243)+_0x3ce734+'\x27\x20(from\x20\x27'+_0x54eca1+_0x3024af(0x1b3)),_0x29d9c1[_0x3024af(0x1f1)]='NONEXISTENT_GATEWAY_FILTER'):(_0x29d9c1[_0x3024af(0x1f1)]=_0x3ce734[_0x3024af(0x2bb)](),console[_0x3024af(0x196)](_0x3024af(0x1bb)+_0x3ce734+_0x3024af(0x169)+_0x54eca1+'\x27)'));}}console['log'](_0x3024af(0x20f),_0x29d9c1[_0x3024af(0x1f1)]);_0x14f7c2&&(_0x29d9c1[_0x3024af(0x27c)]=_0x14f7c2);_0x3053a5&&(_0x29d9c1[_0x3024af(0x1c1)]=_0x3053a5['toUpperCase'](),console[_0x3024af(0x196)]('üí±\x20Currency\x20filter\x20applied:\x20'+_0x3053a5['toUpperCase']()));if(_0x5bcf39||_0x1dd3a7){_0x29d9c1[_0x3024af(0x1fb)]={};if(_0x5bcf39){const _0xd87203=new Date(_0x5bcf39);_0xd87203[_0x3024af(0x187)](0x0,0x0,0x0,0x1),_0x29d9c1['createdAt'][_0x3024af(0x24c)]=_0xd87203,console[_0x3024af(0x196)](_0x3024af(0x2a6)+_0xd87203[_0x3024af(0x2b7)]());}if(_0x1dd3a7){const _0x347059=new Date(_0x1dd3a7);_0x347059[_0x3024af(0x187)](0x17,0x3b,0x3b,0x3e7),_0x29d9c1[_0x3024af(0x1fb)][_0x3024af(0x21f)]=_0x347059,console['log'](_0x3024af(0x25a)+_0x347059[_0x3024af(0x2b7)]());}}_0x44c761&&(_0x29d9c1['OR']=[{'id':{'contains':_0x44c761,'mode':_0x3024af(0x259)}},{'orderId':{'contains':_0x44c761,'mode':_0x3024af(0x259)}},{'gatewayOrderId':{'contains':_0x44c761,'mode':_0x3024af(0x259)}},{'customerEmail':{'contains':_0x44c761,'mode':_0x3024af(0x259)}},{'shop':{'name':{'contains':_0x44c761,'mode':_0x3024af(0x259)}}},{'shop':{'username':{'contains':_0x44c761,'mode':'insensitive'}}}]);console['log'](_0x3024af(0x2ba),JSON[_0x3024af(0x1c9)](_0x29d9c1,null,0x2));let _0x955cc6={'createdAt':_0x3024af(0x249)};if(_0x4e0b1b){const _0x45c78e=[_0x3024af(0x181),_0x3024af(0x1fb),_0x3024af(0x19c),_0x3024af(0x2c0),'gateway',_0x3024af(0x1c1)],_0xe49e72=[_0x3024af(0x185),_0x3024af(0x249)];if(_0x45c78e[_0x3024af(0x2be)](_0x4e0b1b)){const _0x34dae2=_0xe49e72[_0x3024af(0x2be)](_0x47e318)?_0x47e318:_0x3024af(0x249);_0x955cc6={[_0x4e0b1b]:_0x34dae2},console[_0x3024af(0x196)]('üìä\x20Sorting\x20payments\x20by\x20'+_0x4e0b1b+'\x20in\x20'+_0x34dae2+'\x20order');}}const [_0x38848b,_0x25e2dd]=await Promise[_0x3024af(0x1c3)]([database_1[_0x3024af(0x189)][_0x3024af(0x1a4)][_0x3024af(0x212)]({'where':_0x29d9c1,'skip':_0x1d48e7,'take':_0x34d6ea,'orderBy':_0x955cc6,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x3024af(0x189)]['payment']['count']({'where':_0x29d9c1})]);return{'payments':_0x38848b,'pagination':{'page':_0x42a41d,'limit':_0x34d6ea,'total':_0x25e2dd,'totalPages':Math[_0x3024af(0x1eb)](_0x25e2dd/_0x34d6ea)}};}async[a46_0x316b14(0x2c9)](_0x5de406){const _0x361f2a=a46_0x316b14,_0xc2d4ae=await database_1[_0x361f2a(0x189)][_0x361f2a(0x1a4)][_0x361f2a(0x257)]({'where':{'id':_0x5de406},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0xc2d4ae)return null;return{'id':_0xc2d4ae['id'],'shopId':_0xc2d4ae[_0x361f2a(0x27c)],'gateway':_0xc2d4ae[_0x361f2a(0x1f1)],'amount':_0xc2d4ae['amount'],'currency':_0xc2d4ae[_0x361f2a(0x1c1)],'status':_0xc2d4ae[_0x361f2a(0x2c0)],'orderId':_0xc2d4ae[_0x361f2a(0x233)],'gatewayOrderId':_0xc2d4ae[_0x361f2a(0x1a0)],'customerEmail':_0xc2d4ae[_0x361f2a(0x271)],'customerName':_0xc2d4ae[_0x361f2a(0x246)],'customerCountry':_0xc2d4ae[_0x361f2a(0x18a)],'customerIp':_0xc2d4ae[_0x361f2a(0x1f7)],'customerUa':_0xc2d4ae['customerUa'],'failureMessage':_0xc2d4ae[_0x361f2a(0x162)],'externalPaymentUrl':_0xc2d4ae[_0x361f2a(0x2aa)],'successUrl':_0xc2d4ae['successUrl'],'failUrl':_0xc2d4ae[_0x361f2a(0x202)],'pendingUrl':_0xc2d4ae['pendingUrl'],'whiteUrl':_0xc2d4ae[_0x361f2a(0x258)],'createdAt':_0xc2d4ae[_0x361f2a(0x1fb)],'updatedAt':_0xc2d4ae[_0x361f2a(0x19c)],'shop':_0xc2d4ae[_0x361f2a(0x24d)]};}async[a46_0x316b14(0x1f0)](_0x381a33,_0x4c590d,_0x111217,_0x274841){const _0x4f0d6c=a46_0x316b14,_0x2e29ec=await database_1['default'][_0x4f0d6c(0x1ff)](async _0x30b461=>{const _0x46cee2=_0x4f0d6c,_0x26ffff=await _0x30b461[_0x46cee2(0x1a4)]['findUnique']({'where':{'id':_0x381a33},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x26ffff)throw new Error(_0x46cee2(0x270));const _0xa6abef=_0x26ffff[_0x46cee2(0x2c0)],_0x1dca1d=_0x4c590d[_0x46cee2(0x1f6)]();console[_0x46cee2(0x196)](_0x46cee2(0x2c2)+_0x381a33+_0x46cee2(0x22e)+_0xa6abef+_0x46cee2(0x253)+_0x1dca1d),console[_0x46cee2(0x196)](_0x46cee2(0x27d)+_0x26ffff[_0x46cee2(0x24d)][_0x46cee2(0x15d)]+_0x46cee2(0x199));const _0x467207={'status':_0x1dca1d,'updatedAt':new Date(),'statusChangedBy':'admin','statusChangedAt':new Date()};_0x111217&&(_0x467207['adminNotes']=_0x111217);_0x1dca1d===_0x46cee2(0x1d8)&&_0x274841&&(_0x467207[_0x46cee2(0x192)]=_0x274841);let _0x1cb39a=0x0,_0x405555=_0x26ffff[_0x46cee2(0x24d)][_0x46cee2(0x15d)];if(_0x1dca1d==='PAID'&&_0xa6abef!==_0x46cee2(0x2ac)){_0x467207[_0x46cee2(0x1c8)]=new Date();const _0x3d6ceb=await currencyService_1['currencyService'][_0x46cee2(0x284)](_0x26ffff[_0x46cee2(0x181)],_0x26ffff[_0x46cee2(0x1c1)]);_0x467207[_0x46cee2(0x279)]=_0x3d6ceb;let _0x4c6f7b=0x2d;const _0x37808c=await _0x30b461[_0x46cee2(0x24d)][_0x46cee2(0x257)]({'where':{'id':_0x26ffff[_0x46cee2(0x27c)]},'select':{'gatewaySettings':!![]}});if(_0x37808c?.['gatewaySettings'])try{const _0x59bf86=JSON[_0x46cee2(0x222)](_0x37808c[_0x46cee2(0x191)]);for(const [_0x122feb,_0x1556bf]of Object[_0x46cee2(0x1f2)](_0x59bf86)){if(_0x122feb['toLowerCase']()===_0x26ffff[_0x46cee2(0x1f1)][_0x46cee2(0x2bb)]()){_0x4c6f7b=_0x1556bf[_0x46cee2(0x23e)]||0xa;break;}}}catch(_0x21c97b){console[_0x46cee2(0x1df)](_0x46cee2(0x163)+_0x381a33+':',_0x21c97b);}let _0x572a85;_0x26ffff[_0x46cee2(0x165)]!==null&&_0x26ffff[_0x46cee2(0x165)]!==undefined?(_0x572a85=_0x26ffff['amountAfterGatewayCommissionUSDT'],console['log'](_0x46cee2(0x17f)+_0x572a85[_0x46cee2(0x247)](0x6)+_0x46cee2(0x20c)+_0x381a33)):(_0x572a85=_0x3d6ceb*(0x1-_0x4c6f7b/0x64),console[_0x46cee2(0x196)]('üìä\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20'+_0x381a33+':\x20'+_0x4c6f7b+_0x46cee2(0x255)+_0x3d6ceb[_0x46cee2(0x247)](0x6)+_0x46cee2(0x199)),_0x467207[_0x46cee2(0x165)]=_0x572a85,_0x467207[_0x46cee2(0x15c)]=_0x4c6f7b),_0x1cb39a=_0x572a85,_0x405555+=_0x572a85,console[_0x46cee2(0x196)]('üí∞\x20Payment\x20'+_0x381a33+'\x20became\x20PAID:'),console[_0x46cee2(0x196)](_0x46cee2(0x1ac)+_0x3d6ceb['toFixed'](0x6)+'\x20USDT'),console['log']('\x20\x20\x20Gateway:\x20'+_0x26ffff[_0x46cee2(0x1f1)]+_0x46cee2(0x215)+_0x4c6f7b+'%'),console['log'](_0x46cee2(0x250)+_0x572a85[_0x46cee2(0x247)](0x6)+'\x20USDT\x20(after\x20'+_0x4c6f7b+_0x46cee2(0x2af)),console[_0x46cee2(0x196)](_0x46cee2(0x26e)+_0x572a85[_0x46cee2(0x247)](0x6)+_0x46cee2(0x199));}else{if(_0xa6abef===_0x46cee2(0x2ac)&&_0x1dca1d!==_0x46cee2(0x2ac)&&_0x1dca1d!==_0x46cee2(0x1d8)){if(_0x26ffff[_0x46cee2(0x279)]){let _0x246754=0x2d;const _0x198185=await _0x30b461[_0x46cee2(0x24d)][_0x46cee2(0x257)]({'where':{'id':_0x26ffff[_0x46cee2(0x27c)]},'select':{'gatewaySettings':!![]}});if(_0x198185?.['gatewaySettings'])try{const _0x35e8f6=JSON[_0x46cee2(0x222)](_0x198185['gatewaySettings']);for(const [_0x3bfaa2,_0x43de09]of Object[_0x46cee2(0x1f2)](_0x35e8f6)){if(_0x3bfaa2[_0x46cee2(0x2bb)]()===_0x26ffff[_0x46cee2(0x1f1)][_0x46cee2(0x2bb)]()){_0x246754=_0x43de09[_0x46cee2(0x23e)]||0xa;break;}}}catch(_0x4420b9){console[_0x46cee2(0x1df)](_0x46cee2(0x163)+_0x381a33+':',_0x4420b9);}const _0x4df8aa=_0x26ffff['amountUSDT']*(0x1-_0x246754/0x64);_0x1cb39a=-_0x4df8aa,_0x405555-=_0x4df8aa,console[_0x46cee2(0x196)](_0x46cee2(0x1ac)+_0x26ffff[_0x46cee2(0x279)]['toFixed'](0x6)+_0x46cee2(0x199)),console[_0x46cee2(0x196)](_0x46cee2(0x1e8)+_0x26ffff['gateway']+_0x46cee2(0x215)+_0x246754+'%'),console[_0x46cee2(0x196)](_0x46cee2(0x211)+_0x4df8aa[_0x46cee2(0x247)](0x6)+_0x46cee2(0x274)+_0x246754+'%\x20commission)'),console[_0x46cee2(0x196)](_0x46cee2(0x22c)+_0x4df8aa[_0x46cee2(0x247)](0x6)+_0x46cee2(0x199));}}}_0x1dca1d==='CHARGEBACK'&&(console[_0x46cee2(0x196)](_0x46cee2(0x18c)),_0x274841&&_0x274841>0x0?(_0x1cb39a=-_0x274841,_0x405555-=_0x274841,console[_0x46cee2(0x196)](_0x46cee2(0x16e)+_0x274841[_0x46cee2(0x247)](0x6)+_0x46cee2(0x288)),console[_0x46cee2(0x196)](_0x46cee2(0x176))):console['log'](_0x46cee2(0x1bf)),_0x467207[_0x46cee2(0x192)]=_0x274841||0x0);_0x1dca1d==='REFUND'&&_0xa6abef===_0x46cee2(0x2ac)&&console[_0x46cee2(0x196)](_0x46cee2(0x216));const _0x29fe08=await _0x30b461['payment']['update']({'where':{'id':_0x381a33},'data':_0x467207,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x1cb39a!==0x0&&(await _0x30b461[_0x46cee2(0x24d)][_0x46cee2(0x19b)]({'where':{'id':_0x26ffff[_0x46cee2(0x27c)]},'data':{'balance':_0x405555}}),console['log'](_0x46cee2(0x282)+_0x26ffff[_0x46cee2(0x27c)]+_0x46cee2(0x1bd)+_0x26ffff['shop'][_0x46cee2(0x15d)][_0x46cee2(0x247)](0x6)+_0x46cee2(0x253)+_0x405555[_0x46cee2(0x247)](0x6)+_0x46cee2(0x18b)+(_0x1cb39a>0x0?'+':'')+_0x1cb39a[_0x46cee2(0x247)](0x6)+')')),_0x29fe08;});return{'id':_0x2e29ec['id'],'shopId':_0x2e29ec['shopId'],'gateway':_0x2e29ec[_0x4f0d6c(0x1f1)],'amount':_0x2e29ec[_0x4f0d6c(0x181)],'currency':_0x2e29ec[_0x4f0d6c(0x1c1)],'status':_0x2e29ec[_0x4f0d6c(0x2c0)],'orderId':_0x2e29ec[_0x4f0d6c(0x233)],'gatewayOrderId':_0x2e29ec['gatewayOrderId'],'customerEmail':_0x2e29ec['customerEmail'],'customerName':_0x2e29ec['customerName'],'customerCountry':_0x2e29ec[_0x4f0d6c(0x18a)],'customerIp':_0x2e29ec[_0x4f0d6c(0x1f7)],'customerUa':_0x2e29ec['customerUa'],'failureMessage':_0x2e29ec[_0x4f0d6c(0x162)],'adminNotes':_0x2e29ec[_0x4f0d6c(0x1d0)],'chargebackAmount':_0x2e29ec[_0x4f0d6c(0x192)],'statusChangedBy':_0x2e29ec[_0x4f0d6c(0x229)],'statusChangedAt':_0x2e29ec[_0x4f0d6c(0x1a1)],'createdAt':_0x2e29ec[_0x4f0d6c(0x1fb)],'updatedAt':_0x2e29ec[_0x4f0d6c(0x19c)],'shop':_0x2e29ec[_0x4f0d6c(0x24d)]};}async['updateUser'](_0x27adef,_0x302205){const _0x114d57=a46_0x316b14,_0x5061be=Math[_0x114d57(0x1b1)]()['toString'](0x24)['substr'](0x2,0x9);console[_0x114d57(0x196)](_0x114d57(0x280)+_0x5061be+_0x114d57(0x1be)+_0x27adef);const _0xe677fb={..._0x302205};_0x302205[_0x114d57(0x298)]&&_0x302205[_0x114d57(0x298)][_0x114d57(0x23a)]()!==''?(console[_0x114d57(0x196)]('üîê\x20['+_0x5061be+_0x114d57(0x26b)+_0x27adef),_0xe677fb[_0x114d57(0x298)]=await bcryptjs_1['default'][_0x114d57(0x1ef)](_0x302205[_0x114d57(0x298)],0xc)):(console[_0x114d57(0x196)](_0x114d57(0x209)+_0x5061be+_0x114d57(0x1ea)),delete _0xe677fb[_0x114d57(0x298)]);_0x302205[_0x114d57(0x207)]&&(_0xe677fb[_0x114d57(0x1ba)]=_0x302205[_0x114d57(0x207)],delete _0xe677fb['fullName']);_0x302205[_0x114d57(0x16b)]&&(_0xe677fb['telegram']=_0x302205['telegramId'],delete _0xe677fb[_0x114d57(0x16b)]);_0x302205[_0x114d57(0x1cf)]&&(_0xe677fb[_0x114d57(0x260)]=_0x302205['merchantUrl'],delete _0xe677fb[_0x114d57(0x1cf)]);if(_0x302205[_0x114d57(0x251)]){const _0x10e13f=_0x302205[_0x114d57(0x251)][_0x114d57(0x1ae)](_0x427ed1=>this[_0x114d57(0x184)](_0x427ed1));console[_0x114d57(0x196)](_0x114d57(0x197),_0x302205[_0x114d57(0x251)],'->',_0x10e13f),_0xe677fb[_0x114d57(0x168)]=JSON[_0x114d57(0x1c9)](_0x10e13f),delete _0xe677fb[_0x114d57(0x251)];}_0x302205[_0x114d57(0x191)]&&(console[_0x114d57(0x196)](_0x114d57(0x1aa)+_0x5061be+']\x20Gateway\x20settings\x20before\x20saving:',_0x302205['gatewaySettings']),_0xe677fb['gatewaySettings']=JSON['stringify'](_0x302205[_0x114d57(0x191)]),console[_0x114d57(0x196)](_0x114d57(0x1aa)+_0x5061be+_0x114d57(0x237),_0xe677fb[_0x114d57(0x191)]));_0x302205[_0x114d57(0x2b8)]&&(_0x302205[_0x114d57(0x2b8)][_0x114d57(0x2bd)]!==undefined&&(_0xe677fb[_0x114d57(0x2bd)]=_0x302205[_0x114d57(0x2b8)][_0x114d57(0x2bd)]||null),_0x302205['wallets'][_0x114d57(0x262)]!==undefined&&(_0xe677fb[_0x114d57(0x262)]=_0x302205[_0x114d57(0x2b8)][_0x114d57(0x262)]||null),_0x302205['wallets'][_0x114d57(0x17a)]!==undefined&&(_0xe677fb[_0x114d57(0x17a)]=_0x302205['wallets'][_0x114d57(0x17a)]||null),_0x302205[_0x114d57(0x2b8)][_0x114d57(0x167)]!==undefined&&(_0xe677fb[_0x114d57(0x167)]=_0x302205['wallets'][_0x114d57(0x167)]||null),delete _0xe677fb[_0x114d57(0x2b8)]);const _0x2f712e=await database_1[_0x114d57(0x189)][_0x114d57(0x24d)][_0x114d57(0x19b)]({'where':{'id':_0x27adef},'data':_0xe677fb,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0x114d57(0x196)](_0x114d57(0x1fc)+_0x5061be+_0x114d57(0x195),_0x2f712e[_0x114d57(0x191)]),{'id':_0x2f712e['id'],'fullName':_0x2f712e[_0x114d57(0x1ba)],'username':_0x2f712e[_0x114d57(0x2c4)],'telegramId':_0x2f712e[_0x114d57(0x17c)],'merchantUrl':_0x2f712e[_0x114d57(0x260)],'gateways':_0x2f712e[_0x114d57(0x168)]?JSON[_0x114d57(0x222)](_0x2f712e['paymentGateways']):null,'gatewaySettings':_0x2f712e[_0x114d57(0x191)]?JSON[_0x114d57(0x222)](_0x2f712e[_0x114d57(0x191)]):null,'publicKey':_0x2f712e[_0x114d57(0x1f4)],'wallets':{'usdtPolygonWallet':_0x2f712e[_0x114d57(0x2bd)],'usdtTrcWallet':_0x2f712e[_0x114d57(0x262)],'usdtErcWallet':_0x2f712e[_0x114d57(0x17a)],'usdcPolygonWallet':_0x2f712e[_0x114d57(0x167)]},'status':_0x2f712e[_0x114d57(0x2c0)],'createdAt':_0x2f712e['createdAt']};}async[a46_0x316b14(0x203)](_0x219787){const _0x5eac7a=a46_0x316b14,_0x310c24=await database_1[_0x5eac7a(0x189)][_0x5eac7a(0x24d)][_0x5eac7a(0x19b)]({'where':{'id':_0x219787},'data':{'status':_0x5eac7a(0x17b)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x310c24['id'],'fullName':_0x310c24[_0x5eac7a(0x1ba)],'username':_0x310c24['username'],'telegramId':_0x310c24[_0x5eac7a(0x17c)],'merchantUrl':_0x310c24[_0x5eac7a(0x260)],'gateways':_0x310c24[_0x5eac7a(0x168)]?JSON[_0x5eac7a(0x222)](_0x310c24['paymentGateways']):null,'gatewaySettings':_0x310c24['gatewaySettings']?JSON[_0x5eac7a(0x222)](_0x310c24[_0x5eac7a(0x191)]):null,'publicKey':_0x310c24[_0x5eac7a(0x1f4)],'wallets':{'usdtPolygonWallet':_0x310c24[_0x5eac7a(0x2bd)],'usdtTrcWallet':_0x310c24[_0x5eac7a(0x262)],'usdtErcWallet':_0x310c24[_0x5eac7a(0x17a)],'usdcPolygonWallet':_0x310c24[_0x5eac7a(0x167)]},'status':_0x310c24['status'],'createdAt':_0x310c24['createdAt']};}async[a46_0x316b14(0x289)](_0x5a211e){const _0x284afc=a46_0x316b14,_0x4cfb59=await database_1[_0x284afc(0x189)][_0x284afc(0x24d)][_0x284afc(0x19b)]({'where':{'id':_0x5a211e},'data':{'status':_0x284afc(0x1f3)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4cfb59['id'],'fullName':_0x4cfb59[_0x284afc(0x1ba)],'username':_0x4cfb59[_0x284afc(0x2c4)],'telegramId':_0x4cfb59[_0x284afc(0x17c)],'merchantUrl':_0x4cfb59[_0x284afc(0x260)],'gateways':_0x4cfb59[_0x284afc(0x168)]?JSON[_0x284afc(0x222)](_0x4cfb59[_0x284afc(0x168)]):null,'gatewaySettings':_0x4cfb59[_0x284afc(0x191)]?JSON[_0x284afc(0x222)](_0x4cfb59[_0x284afc(0x191)]):null,'publicKey':_0x4cfb59['publicKey'],'wallets':{'usdtPolygonWallet':_0x4cfb59[_0x284afc(0x2bd)],'usdtTrcWallet':_0x4cfb59[_0x284afc(0x262)],'usdtErcWallet':_0x4cfb59['usdtErcWallet'],'usdcPolygonWallet':_0x4cfb59[_0x284afc(0x167)]},'status':_0x4cfb59[_0x284afc(0x2c0)],'createdAt':_0x4cfb59[_0x284afc(0x1fb)]};}async[a46_0x316b14(0x28c)](_0x42881b){const _0x3d9244=a46_0x316b14,{page:_0x3faac6,limit:_0x576e40,status:_0x2f3c19}=_0x42881b,_0x42a2d2=(_0x3faac6-0x1)*_0x576e40,_0x199594={};_0x2f3c19&&(_0x199594[_0x3d9244(0x2c0)]=_0x2f3c19[_0x3d9244(0x1f6)]());const [_0x240d5d,_0x4edc92]=await Promise['all']([database_1[_0x3d9244(0x189)]['shop']['findMany']({'where':_0x199594,'skip':_0x42a2d2,'take':_0x576e40,'orderBy':{'createdAt':_0x3d9244(0x249)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x3d9244(0x189)][_0x3d9244(0x24d)][_0x3d9244(0x263)]({'where':_0x199594})]);return{'users':_0x240d5d[_0x3d9244(0x1ae)](_0x549195=>{const _0x33444c=_0x3d9244,_0x366a4d=_0x549195[_0x33444c(0x168)]?JSON['parse'](_0x549195[_0x33444c(0x168)]):null,_0x50084d=_0x366a4d?_0x366a4d[_0x33444c(0x1ae)](_0x4bcb5a=>this[_0x33444c(0x29e)](_0x4bcb5a)):null;return{'id':_0x549195['id'],'fullName':_0x549195['name'],'username':_0x549195[_0x33444c(0x2c4)],'telegramId':_0x549195[_0x33444c(0x17c)],'merchantUrl':_0x549195[_0x33444c(0x260)],'gateways':_0x50084d,'gatewaySettings':_0x549195[_0x33444c(0x191)]?JSON[_0x33444c(0x222)](_0x549195[_0x33444c(0x191)]):null,'publicKey':_0x549195[_0x33444c(0x1f4)],'wallets':{'usdtPolygonWallet':_0x549195['usdtPolygonWallet'],'usdtTrcWallet':_0x549195[_0x33444c(0x262)],'usdtErcWallet':_0x549195[_0x33444c(0x17a)],'usdcPolygonWallet':_0x549195[_0x33444c(0x167)]},'status':_0x549195[_0x33444c(0x2c0)],'createdAt':_0x549195[_0x33444c(0x1fb)]};}),'pagination':{'page':_0x3faac6,'limit':_0x576e40,'total':_0x4edc92,'totalPages':Math[_0x3d9244(0x1eb)](_0x4edc92/_0x576e40)}};}async['getUserById'](_0xbc663d){const _0x355db2=a46_0x316b14,_0x459ff5=await database_1[_0x355db2(0x189)][_0x355db2(0x24d)][_0x355db2(0x257)]({'where':{'id':_0xbc663d},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x459ff5)return null;const _0x4812c4=_0x459ff5[_0x355db2(0x168)]?JSON[_0x355db2(0x222)](_0x459ff5['paymentGateways']):null,_0x1db272=_0x4812c4?_0x4812c4[_0x355db2(0x1ae)](_0x4eeb5e=>this[_0x355db2(0x29e)](_0x4eeb5e)):null;return _0x4812c4&&_0x1db272&&console['log'](_0x355db2(0x1b9),_0x4812c4,'->',_0x1db272),{'id':_0x459ff5['id'],'fullName':_0x459ff5['name'],'username':_0x459ff5[_0x355db2(0x2c4)],'telegramId':_0x459ff5['telegram'],'merchantUrl':_0x459ff5[_0x355db2(0x260)],'gateways':_0x1db272,'gatewaySettings':_0x459ff5['gatewaySettings']?JSON[_0x355db2(0x222)](_0x459ff5[_0x355db2(0x191)]):null,'publicKey':_0x459ff5['publicKey'],'wallets':{'usdtPolygonWallet':_0x459ff5[_0x355db2(0x2bd)],'usdtTrcWallet':_0x459ff5[_0x355db2(0x262)],'usdtErcWallet':_0x459ff5['usdtErcWallet'],'usdcPolygonWallet':_0x459ff5[_0x355db2(0x167)]},'status':_0x459ff5[_0x355db2(0x2c0)],'createdAt':_0x459ff5[_0x355db2(0x1fb)]};}async[a46_0x316b14(0x1ad)](_0x4d921d){const _0x2589e9=a46_0x316b14,{fullName:_0x20915a,username:_0x32798c,password:_0x407ab4,telegramId:_0x52d233,merchantUrl:_0x59c752,gateways:_0x5d0bd6,gatewaySettings:_0x4fc60c,wallets:_0x548303}=_0x4d921d,_0x21cb52=await database_1['default']['shop'][_0x2589e9(0x257)]({'where':{'username':_0x32798c}});if(_0x21cb52)throw new Error(_0x2589e9(0x269));if(_0x52d233){const _0x56c177=await database_1[_0x2589e9(0x189)][_0x2589e9(0x24d)][_0x2589e9(0x257)]({'where':{'telegram':_0x52d233}});if(_0x56c177)throw new Error(_0x2589e9(0x2b9));}const _0x196b48=await bcryptjs_1['default'][_0x2589e9(0x1ef)](_0x407ab4,0xc),_0xb151ca=_0x2589e9(0x26d)+crypto_1['default']['randomBytes'](0x20)[_0x2589e9(0x239)](_0x2589e9(0x28f)),_0x285cf4=_0x2589e9(0x172)+crypto_1[_0x2589e9(0x189)][_0x2589e9(0x272)](0x20)[_0x2589e9(0x239)](_0x2589e9(0x28f)),_0x74b76f=_0x5d0bd6?_0x5d0bd6[_0x2589e9(0x1ae)](_0x185491=>this[_0x2589e9(0x184)](_0x185491)):null;_0x5d0bd6&&_0x74b76f&&console[_0x2589e9(0x196)]('üîÑ\x20Gateway\x20mapping\x20(create):',_0x5d0bd6,'->',_0x74b76f);const _0x4451a9=await database_1['default'][_0x2589e9(0x24d)][_0x2589e9(0x2a0)]({'data':{'name':_0x20915a,'username':_0x32798c,'password':_0x196b48,'telegram':_0x52d233,'shopUrl':_0x59c752,'paymentGateways':_0x74b76f?JSON[_0x2589e9(0x1c9)](_0x74b76f):null,'gatewaySettings':_0x4fc60c?JSON['stringify'](_0x4fc60c):null,'usdtPolygonWallet':_0x548303?.['usdtPolygonWallet']||null,'usdtTrcWallet':_0x548303?.[_0x2589e9(0x262)]||null,'usdtErcWallet':_0x548303?.['usdtErcWallet']||null,'usdcPolygonWallet':_0x548303?.[_0x2589e9(0x167)]||null,'publicKey':_0xb151ca,'secretKey':_0x285cf4,'status':_0x2589e9(0x1f3)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4451a9['id'],'fullName':_0x4451a9['name'],'username':_0x4451a9[_0x2589e9(0x2c4)],'telegramId':_0x4451a9[_0x2589e9(0x17c)],'merchantUrl':_0x4451a9[_0x2589e9(0x260)],'gateways':_0x4451a9[_0x2589e9(0x168)]?JSON[_0x2589e9(0x222)](_0x4451a9[_0x2589e9(0x168)]):null,'gatewaySettings':_0x4451a9[_0x2589e9(0x191)]?JSON['parse'](_0x4451a9['gatewaySettings']):null,'publicKey':_0x4451a9[_0x2589e9(0x1f4)],'wallets':{'usdtPolygonWallet':_0x4451a9[_0x2589e9(0x2bd)],'usdtTrcWallet':_0x4451a9[_0x2589e9(0x262)],'usdtErcWallet':_0x4451a9[_0x2589e9(0x17a)],'usdcPolygonWallet':_0x4451a9['usdcPolygonWallet']},'status':_0x4451a9[_0x2589e9(0x2c0)],'createdAt':_0x4451a9['createdAt']};}async[a46_0x316b14(0x194)](_0x206b93){const _0x16a0f4=a46_0x316b14;await database_1[_0x16a0f4(0x189)]['shop']['delete']({'where':{'id':_0x206b93}});}[a46_0x316b14(0x252)](_0x18f46b,_0x373b1a,_0x2d6fa8){const _0x501b93=a46_0x316b14,_0x4f7b18=new Map(),_0x30a613=new Date(_0x373b1a);while(_0x30a613<=_0x2d6fa8){const _0x56b128=_0x30a613[_0x501b93(0x2b7)]()[_0x501b93(0x29f)]('T')[0x0];_0x4f7b18['set'](_0x56b128,{'revenue':0x0,'count':0x0}),_0x30a613[_0x501b93(0x1b8)](_0x30a613[_0x501b93(0x160)]()+0x1);}for(const _0x4d6f1a of _0x18f46b){const _0x2f40cf=_0x4d6f1a['createdAt'][_0x501b93(0x2b7)]()[_0x501b93(0x29f)]('T')[0x0],_0x32087b=_0x4f7b18[_0x501b93(0x286)](_0x2f40cf);_0x32087b&&(_0x32087b[_0x501b93(0x263)]+=0x1,_0x4d6f1a['status']==='PAID'&&(_0x4d6f1a[_0x501b93(0x279)]?_0x32087b['revenue']+=_0x4d6f1a['amountUSDT']:console['log'](_0x501b93(0x2c8)+_0x4d6f1a['id']+'\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion')));}const _0x3b2043=[],_0x4b3da7=[];for(const [_0x248112,_0x32b5a0]of _0x4f7b18){_0x3b2043[_0x501b93(0x1d2)]({'date':_0x248112,'amount':Math[_0x501b93(0x240)](_0x32b5a0[_0x501b93(0x221)]*0x64)/0x64}),_0x4b3da7[_0x501b93(0x1d2)]({'date':_0x248112,'count':_0x32b5a0[_0x501b93(0x263)]});}return{'dailyRevenue':_0x3b2043,'dailyPayments':_0x4b3da7};}}exports['AdminService']=AdminService;