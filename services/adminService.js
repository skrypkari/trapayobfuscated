'use strict';function a33_0x172a(_0x3ab4a1,_0x403575){const _0x4862ae=a33_0x4862();return a33_0x172a=function(_0x172ab7,_0x2bc5e1){_0x172ab7=_0x172ab7-0x1d7;let _0x2dcf76=_0x4862ae[_0x172ab7];return _0x2dcf76;},a33_0x172a(_0x3ab4a1,_0x403575);}const a33_0x2e7cdd=a33_0x172a;(function(_0x301ecb,_0x93d384){const _0x147d63=a33_0x172a,_0x55d0fb=_0x301ecb();while(!![]){try{const _0x10ef14=parseInt(_0x147d63(0x242))/0x1*(parseInt(_0x147d63(0x1f5))/0x2)+-parseInt(_0x147d63(0x236))/0x3*(parseInt(_0x147d63(0x204))/0x4)+parseInt(_0x147d63(0x22b))/0x5+-parseInt(_0x147d63(0x27d))/0x6+parseInt(_0x147d63(0x2ae))/0x7+-parseInt(_0x147d63(0x25f))/0x8*(parseInt(_0x147d63(0x26a))/0x9)+-parseInt(_0x147d63(0x243))/0xa;if(_0x10ef14===_0x93d384)break;else _0x55d0fb['push'](_0x55d0fb['shift']());}catch(_0x3d553d){_0x55d0fb['push'](_0x55d0fb['shift']());}}}(a33_0x4862,0xd0cf4));var __importDefault=this&&this['__importDefault']||function(_0x58cee6){const _0x44f23a=a33_0x172a;return _0x58cee6&&_0x58cee6[_0x44f23a(0x276)]?_0x58cee6:{'default':_0x58cee6};};Object[a33_0x2e7cdd(0x1f6)](exports,a33_0x2e7cdd(0x276),{'value':!![]}),exports['AdminService']=void 0x0;const database_1=__importDefault(require(a33_0x2e7cdd(0x1ee))),currencyService_1=require(a33_0x2e7cdd(0x215)),userService_1=require('./userService'),telegramBotService_1=require(a33_0x2e7cdd(0x25e)),gateway_1=require('../types/gateway');class AdminService{constructor(){const _0x2ca9e0=a33_0x2e7cdd;this[_0x2ca9e0(0x1fc)]=new userService_1[(_0x2ca9e0(0x247))]();}[a33_0x2e7cdd(0x1f4)](_0x185bb3){const _0x1a65d4=a33_0x2e7cdd;switch(_0x185bb3){case'7d':return 0x7;case'30d':return 0x1e;case _0x1a65d4(0x2a2):return 0x5a;case'1y':return 0x16d;default:return 0x1e;}}[a33_0x2e7cdd(0x27b)](_0x3f80f8,_0x312f8b){const _0xe888d5=a33_0x2e7cdd,_0x4c6b1c=[],_0x1d9234=new Date(_0x3f80f8);while(_0x1d9234<=_0x312f8b){_0x4c6b1c[_0xe888d5(0x248)](_0x1d9234[_0xe888d5(0x255)]()[_0xe888d5(0x289)]('T')[0x0]),_0x1d9234['setDate'](_0x1d9234['getDate']()+0x1);}return _0x4c6b1c;}['getGatewaySettings'](_0x525428,_0x26c6a1){const _0x39d80e=a33_0x2e7cdd;if(!_0x525428[_0x39d80e(0x22e)])return{'commission':0x0,'payoutDelay':0x0};try{const _0x14b5a5=JSON['parse'](_0x525428['gatewaySettings']),_0x7b676d=_0x26c6a1[_0x39d80e(0x290)](0x0)[_0x39d80e(0x282)]()+_0x26c6a1[_0x39d80e(0x297)](0x1)[_0x39d80e(0x1fe)]();if(_0x14b5a5&&_0x14b5a5[_0x7b676d])return{'commission':_0x14b5a5[_0x7b676d][_0x39d80e(0x281)]||0x0,'payoutDelay':_0x14b5a5[_0x7b676d][_0x39d80e(0x24c)]||0x0};}catch(_0x801592){console[_0x39d80e(0x241)]('Error\x20parsing\x20gateway\x20settings:',_0x801592);}return{'commission':0x0,'payoutDelay':0x0};}['isEligibleForPayout'](_0x44b839){const _0x29c9b1=a33_0x2e7cdd;if(_0x44b839[_0x29c9b1(0x265)]!==_0x29c9b1(0x286)||_0x44b839[_0x29c9b1(0x227)]||!_0x44b839['paidAt'])return![];const _0x5aa8f8=this[_0x29c9b1(0x253)](_0x44b839[_0x29c9b1(0x29e)],_0x44b839[_0x29c9b1(0x214)]),_0xd6848e=_0x5aa8f8[_0x29c9b1(0x24c)]*0x18*0x3c*0x3c*0x3e8,_0x129f80=new Date(_0x44b839[_0x29c9b1(0x223)][_0x29c9b1(0x251)]()+_0xd6848e);return new Date()>_0x129f80;}[a33_0x2e7cdd(0x2ad)](_0x277552,_0x12f33e){return _0x277552*(0x1-_0x12f33e/0x64);}[a33_0x2e7cdd(0x27e)](_0x26d3d3){const _0x12c566=a33_0x2e7cdd;switch(_0x26d3d3[_0x12c566(0x265)]){case _0x12c566(0x286):return _0x26d3d3[_0x12c566(0x27c)];case _0x12c566(0x219):return-(_0x26d3d3[_0x12c566(0x264)]||0x0);case _0x12c566(0x1e2):return 0x0;default:return 0x0;}}async['createPayout'](_0xb0a3ea){const _0x9ec437=a33_0x2e7cdd,{shopId:_0xe018e7,amount:_0x1a3145,network:_0x146cd4,notes:_0x9648aa}=_0xb0a3ea;console['log'](_0x9ec437(0x2a9)+_0xe018e7+':\x20'+_0x1a3145+_0x9ec437(0x270)+_0x146cd4);const _0x8a1b01=await database_1['default'][_0x9ec437(0x29e)][_0x9ec437(0x21a)]({'where':{'id':_0xe018e7},'select':{'id':!![],'name':!![],'username':!![],'status':!![]}});if(!_0x8a1b01)throw new Error(_0x9ec437(0x1da));if(_0x8a1b01[_0x9ec437(0x265)]!=='ACTIVE')throw new Error(_0x9ec437(0x1e9));const _0x20d3f7=await database_1['default'][_0x9ec437(0x25b)]['create']({'data':{'shopId':_0xe018e7,'amount':_0x1a3145,'network':_0x146cd4,'status':_0x9ec437(0x278),'notes':_0x9648aa||null,'paidAt':new Date()},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});await this['markPaymentsAsPaidOut'](_0xe018e7,_0x1a3145);try{await telegramBotService_1[_0x9ec437(0x27f)][_0x9ec437(0x1ed)](_0xe018e7,_0x20d3f7,_0x9ec437(0x279));}catch(_0x87cf76){console[_0x9ec437(0x241)](_0x9ec437(0x1e3),_0x87cf76);}return console[_0x9ec437(0x269)](_0x9ec437(0x244)+_0x20d3f7['id']),{'id':_0x20d3f7['id'],'shopId':_0x20d3f7['shopId'],'shopName':_0x20d3f7['shop'][_0x9ec437(0x222)],'shopUsername':_0x20d3f7[_0x9ec437(0x29e)][_0x9ec437(0x1ff)],'amount':_0x20d3f7['amount'],'network':_0x20d3f7['network'],'status':_0x20d3f7['status'],'txid':_0x20d3f7[_0x9ec437(0x22c)],'notes':_0x20d3f7[_0x9ec437(0x1f7)],'createdAt':_0x20d3f7['createdAt'],'paidAt':_0x20d3f7['paidAt']};}async[a33_0x2e7cdd(0x23a)](_0x2887e4,_0x2a0b27){const _0xa5a01a=a33_0x2e7cdd;console[_0xa5a01a(0x269)](_0xa5a01a(0x246)+_0x2887e4+_0xa5a01a(0x28c)+_0x2a0b27+_0xa5a01a(0x229));const _0x2973d9=await database_1[_0xa5a01a(0x287)][_0xa5a01a(0x22a)][_0xa5a01a(0x211)]({'where':{'shopId':_0x2887e4,'status':_0xa5a01a(0x286),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'shop':{'select':{'gatewaySettings':!![]}}},'orderBy':{'paidAt':_0xa5a01a(0x258)}});let _0x584a18=_0x2a0b27;const _0x4e42a8=[];for(const _0x24cb3f of _0x2973d9){const _0xee828f={..._0x24cb3f,'status':_0xa5a01a(0x286),'merchantPaid':![],'shop':{'gatewaySettings':_0x24cb3f[_0xa5a01a(0x29e)]['gatewaySettings']}};if(!this[_0xa5a01a(0x1fb)](_0xee828f))continue;const _0x5105ef=await currencyService_1[_0xa5a01a(0x21c)][_0xa5a01a(0x228)](_0x24cb3f['amount'],_0x24cb3f[_0xa5a01a(0x22f)]),_0x15393c=this[_0xa5a01a(0x253)](_0x24cb3f['shop'],_0x24cb3f[_0xa5a01a(0x214)]),_0x22b1b7=this[_0xa5a01a(0x2ad)](_0x5105ef,_0x15393c['commission']);if(_0x22b1b7<=_0x584a18){_0x4e42a8[_0xa5a01a(0x248)](_0x24cb3f['id']),_0x584a18-=_0x22b1b7;if(_0x584a18<=0.01)break;}}_0x4e42a8[_0xa5a01a(0x1ec)]>0x0&&(await database_1[_0xa5a01a(0x287)]['payment'][_0xa5a01a(0x2a1)]({'where':{'id':{'in':_0x4e42a8}},'data':{'merchantPaid':!![]}}),console[_0xa5a01a(0x269)]('✅\x20Marked\x20'+_0x4e42a8[_0xa5a01a(0x1ec)]+'\x20payments\x20as\x20paid\x20out'));}async[a33_0x2e7cdd(0x20b)](_0x568b3a){const _0x3d6503=a33_0x2e7cdd,{page:_0x11f105,limit:_0x5336e8,shopId:_0x4fe625,network:_0x58e67c,dateFrom:_0x45aee1,dateTo:_0x3e4e98,search:_0x15022d}=_0x568b3a,_0x2883b9=(_0x11f105-0x1)*_0x5336e8;console[_0x3d6503(0x269)](_0x3d6503(0x239),_0x568b3a);const _0x38d30e={};_0x4fe625&&(_0x38d30e[_0x3d6503(0x1dc)]=_0x4fe625);_0x58e67c&&(_0x38d30e['network']=_0x58e67c);(_0x45aee1||_0x3e4e98)&&(_0x38d30e[_0x3d6503(0x213)]={},_0x45aee1&&(_0x38d30e[_0x3d6503(0x213)][_0x3d6503(0x1ea)]=new Date(_0x45aee1)),_0x3e4e98&&(_0x38d30e[_0x3d6503(0x213)][_0x3d6503(0x1d8)]=new Date(_0x3e4e98)));_0x15022d&&(_0x38d30e['OR']=[{'txid':{'contains':_0x15022d,'mode':_0x3d6503(0x2a8)}},{'notes':{'contains':_0x15022d,'mode':_0x3d6503(0x2a8)}},{'shop':{'name':{'contains':_0x15022d,'mode':_0x3d6503(0x2a8)}}},{'shop':{'username':{'contains':_0x15022d,'mode':'insensitive'}}}]);const [_0x2f7073,_0x300305]=await Promise[_0x3d6503(0x299)]([database_1[_0x3d6503(0x287)]['payout'][_0x3d6503(0x211)]({'where':_0x38d30e,'skip':_0x2883b9,'take':_0x5336e8,'orderBy':{'createdAt':_0x3d6503(0x268)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x3d6503(0x287)][_0x3d6503(0x25b)]['count']({'where':_0x38d30e})]);console['log']('📊\x20Found\x20'+_0x2f7073[_0x3d6503(0x1ec)]+_0x3d6503(0x207)+_0x300305+_0x3d6503(0x23b));const _0x57d6ed=_0x2f7073['map'](_0x4a69f8=>({'id':_0x4a69f8['id'],'shopId':_0x4a69f8['shopId'],'shopName':_0x4a69f8[_0x3d6503(0x29e)][_0x3d6503(0x222)],'shopUsername':_0x4a69f8[_0x3d6503(0x29e)][_0x3d6503(0x1ff)],'amount':_0x4a69f8[_0x3d6503(0x27c)],'network':_0x4a69f8['network'],'status':_0x4a69f8['status'],'txid':_0x4a69f8[_0x3d6503(0x22c)],'notes':_0x4a69f8['notes'],'createdAt':_0x4a69f8['createdAt'],'paidAt':_0x4a69f8[_0x3d6503(0x223)]}));return{'payouts':_0x57d6ed,'pagination':{'page':_0x11f105,'limit':_0x5336e8,'total':_0x300305,'totalPages':Math['ceil'](_0x300305/_0x5336e8)}};}async['getPayoutById'](_0x33327d){const _0x3ba286=a33_0x2e7cdd;console[_0x3ba286(0x269)](_0x3ba286(0x292)+_0x33327d);const _0x59dc8b=await database_1[_0x3ba286(0x287)][_0x3ba286(0x25b)][_0x3ba286(0x21a)]({'where':{'id':_0x33327d},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x59dc8b)return console[_0x3ba286(0x269)](_0x3ba286(0x1e0)+_0x33327d),null;return console['log'](_0x3ba286(0x1e7)+_0x59dc8b['amount']+_0x3ba286(0x270)+_0x59dc8b[_0x3ba286(0x25d)]),{'id':_0x59dc8b['id'],'shopId':_0x59dc8b[_0x3ba286(0x1dc)],'shopName':_0x59dc8b[_0x3ba286(0x29e)][_0x3ba286(0x222)],'shopUsername':_0x59dc8b[_0x3ba286(0x29e)][_0x3ba286(0x1ff)],'amount':_0x59dc8b['amount'],'network':_0x59dc8b[_0x3ba286(0x25d)],'status':_0x59dc8b[_0x3ba286(0x265)],'txid':_0x59dc8b[_0x3ba286(0x22c)],'notes':_0x59dc8b[_0x3ba286(0x1f7)],'createdAt':_0x59dc8b[_0x3ba286(0x213)],'paidAt':_0x59dc8b[_0x3ba286(0x223)]};}async[a33_0x2e7cdd(0x212)](_0x557224){const _0x3bf9ae=a33_0x2e7cdd;console[_0x3bf9ae(0x269)](_0x3bf9ae(0x2a4)+_0x557224);const _0xcdef73=await database_1[_0x3bf9ae(0x287)][_0x3bf9ae(0x25b)]['findUnique']({'where':{'id':_0x557224},'select':{'id':!![],'shopId':!![],'amount':!![]}});if(!_0xcdef73)throw new Error(_0x3bf9ae(0x280));await database_1['default'][_0x3bf9ae(0x25b)]['delete']({'where':{'id':_0x557224}}),console[_0x3bf9ae(0x269)](_0x3bf9ae(0x218)+_0x557224+'\x20deleted\x20successfully');}async[a33_0x2e7cdd(0x20a)](_0x572b53){const _0x199c0c=a33_0x2e7cdd,{page:_0x1450de,limit:_0x344e67,minAmount:_0x373ed4,search:_0x21663c}=_0x572b53;console['log'](_0x199c0c(0x284),_0x572b53);const _0x449099=await database_1['default'][_0x199c0c(0x22a)]['findMany']({'where':{'status':_0x199c0c(0x286),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'createdAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'gatewaySettings':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}});console[_0x199c0c(0x269)](_0x199c0c(0x285)+_0x449099[_0x199c0c(0x1ec)]+'\x20eligible\x20PAID\x20payments\x20for\x20payout\x20analysis');const _0x2d2bcb=new Map();for(const _0x6bced3 of _0x449099){const _0x1c0eb8={..._0x6bced3,'status':_0x199c0c(0x286),'merchantPaid':![],'shop':{'gatewaySettings':_0x6bced3[_0x199c0c(0x29e)][_0x199c0c(0x22e)]}},_0x2aa2ef=this[_0x199c0c(0x1fb)](_0x1c0eb8);if(!_0x2aa2ef)continue;const _0xb06e09=await currencyService_1[_0x199c0c(0x21c)][_0x199c0c(0x228)](_0x6bced3[_0x199c0c(0x27c)],_0x6bced3[_0x199c0c(0x22f)]),_0x27e448=this['getGatewaySettings'](_0x6bced3['shop'],_0x6bced3[_0x199c0c(0x214)]),_0x4178ed=this[_0x199c0c(0x2ad)](_0xb06e09,_0x27e448[_0x199c0c(0x281)]),_0xa21960=_0x6bced3['shopId'];!_0x2d2bcb[_0x199c0c(0x23c)](_0xa21960)&&_0x2d2bcb[_0x199c0c(0x220)](_0xa21960,{'shop':_0x6bced3[_0x199c0c(0x29e)],'payments':[]}),_0x2d2bcb[_0x199c0c(0x26c)](_0xa21960)[_0x199c0c(0x1fa)][_0x199c0c(0x248)]({'id':_0x6bced3['id'],'amount':_0x6bced3[_0x199c0c(0x27c)],'currency':_0x6bced3[_0x199c0c(0x22f)],'gateway':_0x6bced3[_0x199c0c(0x214)],'paidAt':_0x6bced3[_0x199c0c(0x223)],'createdAt':_0x6bced3['createdAt'],'amountUSDT':_0xb06e09,'commission':_0x27e448[_0x199c0c(0x281)],'amountAfterCommissionUSDT':_0x4178ed,'isEligible':!![]});}console[_0x199c0c(0x269)](_0x199c0c(0x205)+_0x2d2bcb[_0x199c0c(0x272)]+_0x199c0c(0x208));const _0x52ce90=[];for(const [_0x4c3b88,_0x31f51c]of _0x2d2bcb){const {shop:_0xbfc24d,payments:_0x4b7486}=_0x31f51c,_0x266eef=_0x4b7486[_0x199c0c(0x296)]((_0x836fc2,_0x375059)=>_0x836fc2+_0x375059['amountUSDT'],0x0),_0x1cb38c=_0x4b7486[_0x199c0c(0x296)]((_0x4ea842,_0x578988)=>_0x4ea842+_0x578988[_0x199c0c(0x24f)],0x0);if(_0x373ed4&&_0x1cb38c<_0x373ed4)continue;if(_0x21663c){const _0x1490e0=_0x21663c[_0x199c0c(0x1fe)](),_0x449c26=_0xbfc24d[_0x199c0c(0x222)][_0x199c0c(0x1fe)]()[_0x199c0c(0x274)](_0x1490e0)||_0xbfc24d['username'][_0x199c0c(0x1fe)]()[_0x199c0c(0x274)](_0x1490e0)||_0xbfc24d[_0x199c0c(0x240)]&&_0xbfc24d[_0x199c0c(0x240)]['toLowerCase']()[_0x199c0c(0x274)](_0x1490e0);if(!_0x449c26)continue;}const _0x2b8423=new Map();for(const _0x220fb2 of _0x4b7486){const _0x3d2648=_0x220fb2[_0x199c0c(0x214)];!_0x2b8423[_0x199c0c(0x23c)](_0x3d2648)&&_0x2b8423[_0x199c0c(0x220)](_0x3d2648,{'count':0x0,'amountUSDT':0x0,'amountAfterCommissionUSDT':0x0,'commission':_0x220fb2[_0x199c0c(0x281)]});const _0x4341b1=_0x2b8423[_0x199c0c(0x26c)](_0x3d2648);_0x4341b1[_0x199c0c(0x20c)]++,_0x4341b1['amountUSDT']+=_0x220fb2[_0x199c0c(0x1e4)],_0x4341b1[_0x199c0c(0x24f)]+=_0x220fb2[_0x199c0c(0x24f)];}const _0x3903c5=Array[_0x199c0c(0x230)](_0x2b8423[_0x199c0c(0x20d)]())['map'](([_0x2347aa,_0x1d3e90])=>({'gateway':_0x2347aa[_0x199c0c(0x290)](0x0)['toUpperCase']()+_0x2347aa['slice'](0x1),'count':_0x1d3e90[_0x199c0c(0x20c)],'amountUSDT':Math[_0x199c0c(0x216)](_0x1d3e90[_0x199c0c(0x1e4)]*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x199c0c(0x216)](_0x1d3e90[_0x199c0c(0x24f)]*0x64)/0x64,'commission':_0x1d3e90['commission']})),_0x48c612=_0x4b7486[_0x199c0c(0x296)]((_0x413f3b,_0x18de02)=>{const _0x441ea8=_0x199c0c;return _0x18de02[_0x441ea8(0x223)]<_0x413f3b?_0x18de02['paidAt']:_0x413f3b;},_0x4b7486[0x0][_0x199c0c(0x223)]);_0x52ce90['push']({'id':_0xbfc24d['id'],'fullName':_0xbfc24d[_0x199c0c(0x222)],'username':_0xbfc24d[_0x199c0c(0x1ff)],'telegramId':_0xbfc24d[_0x199c0c(0x240)],'merchantUrl':_0xbfc24d[_0x199c0c(0x23d)],'wallets':{'usdtPolygonWallet':_0xbfc24d['usdtPolygonWallet'],'usdtTrcWallet':_0xbfc24d[_0x199c0c(0x21b)],'usdtErcWallet':_0xbfc24d[_0x199c0c(0x2af)],'usdcPolygonWallet':_0xbfc24d[_0x199c0c(0x21e)]},'totalAmountUSDT':Math[_0x199c0c(0x216)](_0x266eef*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x199c0c(0x216)](_0x1cb38c*0x64)/0x64,'paymentsCount':_0x4b7486['length'],'oldestPaymentDate':_0x48c612,'gatewayBreakdown':_0x3903c5});}_0x52ce90[_0x199c0c(0x1f9)]((_0x505c32,_0x421e5a)=>_0x421e5a['totalAmountAfterCommissionUSDT']-_0x505c32[_0x199c0c(0x254)]);const _0x494fb2=_0x52ce90[_0x199c0c(0x1ec)],_0x252f97=_0x52ce90[_0x199c0c(0x296)]((_0x24f47e,_0x5f2c71)=>_0x24f47e+_0x5f2c71[_0x199c0c(0x234)],0x0),_0x1d03d8=_0x52ce90['reduce']((_0x1f4d60,_0x16f694)=>_0x1f4d60+_0x16f694['totalAmountAfterCommissionUSDT'],0x0),_0x106d97=(_0x1450de-0x1)*_0x344e67,_0x4dc06f=_0x52ce90[_0x199c0c(0x297)](_0x106d97,_0x106d97+_0x344e67);return console[_0x199c0c(0x269)](_0x199c0c(0x26e)+_0x4dc06f[_0x199c0c(0x1ec)]+'\x20merchants\x20out\x20of\x20'+_0x494fb2+'\x20total'),console[_0x199c0c(0x269)](_0x199c0c(0x291)+_0x252f97[_0x199c0c(0x29c)](0x2)+'\x20USDT\x20('+_0x1d03d8[_0x199c0c(0x29c)](0x2)+_0x199c0c(0x238)),{'merchants':_0x4dc06f,'pagination':{'page':_0x1450de,'limit':_0x344e67,'total':_0x494fb2,'totalPages':Math[_0x199c0c(0x27a)](_0x494fb2/_0x344e67)},'summary':{'totalMerchants':_0x494fb2,'totalAmountUSDT':Math[_0x199c0c(0x216)](_0x252f97*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x199c0c(0x216)](_0x1d03d8*0x64)/0x64}};}async[a33_0x2e7cdd(0x237)](){const _0x18b92c=a33_0x2e7cdd;console[_0x18b92c(0x269)](_0x18b92c(0x23f));const _0x2330e7=await database_1[_0x18b92c(0x287)][_0x18b92c(0x22a)][_0x18b92c(0x211)]({'where':{'status':{'in':[_0x18b92c(0x286),_0x18b92c(0x1e2),_0x18b92c(0x219)]}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'status':!![],'gateway':!![],'paidAt':!![],'merchantPaid':!![],'createdAt':!![],'chargebackAmount':!![],'shop':{'select':{'gatewaySettings':!![]}}}});console[_0x18b92c(0x269)](_0x18b92c(0x285)+_0x2330e7['length']+'\x20payments\x20for\x20analysis\x20(PAID/REFUND/CHARGEBACK)');const _0x44b416=new Date(),_0x1fdc5c=new Date(_0x44b416[_0x18b92c(0x1e5)](),_0x44b416[_0x18b92c(0x1f1)](),0x1),_0x2b76b6=new Date(_0x44b416[_0x18b92c(0x1e5)](),_0x44b416[_0x18b92c(0x1f1)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7);let _0x2c9fb6=0x0,_0x231eb6=0x0,_0x45504e=0x0,_0x18c691=0x0;for(const _0x23576c of _0x2330e7){const _0x2645f8=this[_0x18b92c(0x27e)](_0x23576c);if(_0x2645f8===0x0)continue;let _0x8c605d,_0x38c03c;if(_0x23576c['status']===_0x18b92c(0x219))_0x8c605d=Math[_0x18b92c(0x1de)](_0x2645f8),_0x38c03c=-_0x8c605d;else{_0x8c605d=await currencyService_1[_0x18b92c(0x21c)][_0x18b92c(0x228)](_0x23576c[_0x18b92c(0x27c)],_0x23576c[_0x18b92c(0x22f)]);const _0x2251f0=this[_0x18b92c(0x253)](_0x23576c[_0x18b92c(0x29e)],_0x23576c[_0x18b92c(0x214)]);_0x38c03c=this[_0x18b92c(0x2ad)](_0x8c605d,_0x2251f0[_0x18b92c(0x281)]);}_0x23576c[_0x18b92c(0x227)]&&(_0x2c9fb6+=_0x38c03c,_0x23576c[_0x18b92c(0x223)]&&_0x23576c[_0x18b92c(0x223)]>=_0x1fdc5c&&_0x23576c[_0x18b92c(0x223)]<=_0x2b76b6&&(_0x45504e+=_0x38c03c)),_0x23576c[_0x18b92c(0x265)]==='PAID'&&this[_0x18b92c(0x1fb)](_0x23576c)&&(_0x231eb6+=_0x38c03c,_0x18c691+=_0x8c605d);}const _0x1f5867={'totalPayout':Math[_0x18b92c(0x216)](_0x2c9fb6*0x64)/0x64,'awaitingPayout':Math[_0x18b92c(0x216)](_0x231eb6*0x64)/0x64,'thisMonth':Math[_0x18b92c(0x216)](_0x45504e*0x64)/0x64,'availableBalance':Math[_0x18b92c(0x216)](_0x18c691*0x64)/0x64};return console[_0x18b92c(0x269)](_0x18b92c(0x295)),console[_0x18b92c(0x269)]('💸\x20Total\x20Payout:\x20'+_0x1f5867[_0x18b92c(0x21f)]+_0x18b92c(0x28e)),console['log']('⏳\x20Awaiting\x20Payout:\x20'+_0x1f5867['awaitingPayout']+_0x18b92c(0x252)),console[_0x18b92c(0x269)](_0x18b92c(0x20e)+_0x1f5867['thisMonth']+_0x18b92c(0x229)),console[_0x18b92c(0x269)](_0x18b92c(0x283)+_0x1f5867['availableBalance']+_0x18b92c(0x229)),_0x1f5867;}async['getSystemStatistics'](_0x8f5c6e){const _0x57efd3=a33_0x2e7cdd,_0x4562cd=this['getPeriodDays'](_0x8f5c6e),_0x4c9312=new Date();_0x4c9312[_0x57efd3(0x245)](_0x4c9312[_0x57efd3(0x25c)]()-_0x4562cd),console['log'](_0x57efd3(0x200)+_0x8f5c6e+'\x20('+_0x4562cd+'\x20days)');const _0x3675c3=await database_1[_0x57efd3(0x287)][_0x57efd3(0x29e)][_0x57efd3(0x20c)]({'where':{'status':_0x57efd3(0x260)}}),_0x3cbd26=await database_1[_0x57efd3(0x287)][_0x57efd3(0x22a)]['count'](),_0x5e9773=await database_1[_0x57efd3(0x287)][_0x57efd3(0x22a)][_0x57efd3(0x211)]({'where':{'status':{'in':[_0x57efd3(0x286),'REFUND',_0x57efd3(0x219)]}},'select':{'amount':!![],'currency':!![],'status':!![],'chargebackAmount':!![],'createdAt':!![]}});console[_0x57efd3(0x269)]('💰\x20Found\x20'+_0x5e9773['length']+_0x57efd3(0x29d));const _0x3bad41=await Promise[_0x57efd3(0x299)](_0x5e9773[_0x57efd3(0x24e)](async _0xfe60f1=>{const _0x3e28ae=_0x57efd3,_0x8c2d21=this[_0x3e28ae(0x27e)](_0xfe60f1);if(_0x8c2d21===0x0)return{'amount':0x0,'createdAt':_0xfe60f1[_0x3e28ae(0x213)]};let _0x212375;return _0xfe60f1[_0x3e28ae(0x265)]===_0x3e28ae(0x219)?_0x212375=-Math['abs'](_0x8c2d21):_0x212375=await currencyService_1['currencyService'][_0x3e28ae(0x228)](_0xfe60f1[_0x3e28ae(0x27c)],_0xfe60f1[_0x3e28ae(0x22f)]),{'amount':_0x212375,'createdAt':_0xfe60f1[_0x3e28ae(0x213)]};})),_0x46f434=_0x3bad41[_0x57efd3(0x296)]((_0x5a165d,_0x39492b)=>_0x5a165d+_0x39492b['amount'],0x0),_0x3d1e40=_0x3cbd26>0x0?_0x46f434/_0x3cbd26:0x0;console['log'](_0x57efd3(0x2a7)+_0x46f434[_0x57efd3(0x29c)](0x2)+'\x20USDT\x20(включая\x20штрафы\x20chargeback)'),console['log'](_0x57efd3(0x206)+_0x3d1e40[_0x57efd3(0x29c)](0x2)+_0x57efd3(0x229));const _0x1e0d87=await database_1[_0x57efd3(0x287)][_0x57efd3(0x1f8)]`
      SELECT 
        DATE(created_at) as date,
        array_agg(
          json_build_object(
            'amount', amount,
            'currency', currency,
            'status', status,
            'chargeback_amount', chargeback_amount
          )
        ) as payments
      FROM payments 
      WHERE created_at >= ${_0x4c9312}
        AND status IN ('PAID', 'REFUND', 'CHARGEBACK')
      GROUP BY DATE(created_at)
      ORDER BY date ASC
    `;console[_0x57efd3(0x269)](_0x57efd3(0x266)+_0x1e0d87[_0x57efd3(0x1ec)]+'\x20days');const _0x5d91a1=await Promise[_0x57efd3(0x299)](_0x1e0d87[_0x57efd3(0x24e)](async _0x1157ef=>{const _0x53e9f1=_0x57efd3,_0xb2d69b=await Promise[_0x53e9f1(0x299)](_0x1157ef[_0x53e9f1(0x1fa)][_0x53e9f1(0x24e)](async _0x138b1f=>{const _0x494cc9=_0x53e9f1,_0x4527b2=this[_0x494cc9(0x27e)](_0x138b1f);if(_0x4527b2===0x0)return 0x0;return _0x138b1f[_0x494cc9(0x265)]===_0x494cc9(0x219)?-Math[_0x494cc9(0x1de)](_0x4527b2):await currencyService_1[_0x494cc9(0x21c)][_0x494cc9(0x228)](_0x138b1f[_0x494cc9(0x27c)],_0x138b1f['currency']);})),_0x4971c6=_0xb2d69b[_0x53e9f1(0x296)]((_0x138bac,_0x21dad2)=>_0x138bac+_0x21dad2,0x0);return{'date':_0x1157ef['date']['toISOString']()['split']('T')[0x0],'amount':_0x4971c6};})),_0x34ec83=this[_0x57efd3(0x27b)](_0x4c9312,new Date()),_0x2c665d=new Map(_0x5d91a1[_0x57efd3(0x24e)](_0x268ce3=>[_0x268ce3[_0x57efd3(0x217)],_0x268ce3['amount']])),_0x465bc3=_0x34ec83[_0x57efd3(0x24e)](_0x3d4344=>({'date':_0x3d4344,'amount':_0x2c665d[_0x57efd3(0x26c)](_0x3d4344)||0x0}));return console[_0x57efd3(0x269)](_0x57efd3(0x1fd)),console['log'](_0x57efd3(0x267)+_0x3675c3),console[_0x57efd3(0x269)](_0x57efd3(0x221)+_0x3cbd26),console[_0x57efd3(0x269)]('📊\x20Daily\x20revenue\x20entries:\x20'+_0x465bc3[_0x57efd3(0x1ec)]),{'totalRevenue':Math[_0x57efd3(0x216)](_0x46f434*0x64)/0x64,'totalUsers':_0x3675c3,'totalPayments':_0x3cbd26,'averagePayment':Math[_0x57efd3(0x216)](_0x3d1e40*0x64)/0x64,'dailyRevenue':_0x465bc3};}async[a33_0x2e7cdd(0x2a6)](_0x45eb9e){const _0x23b8ae=a33_0x2e7cdd,{page:_0x58ce63,limit:_0x20c03d,status:_0x429a74,gateway:_0x11c8cc,shopId:_0x95a96d,dateFrom:_0x573c84,dateTo:_0x17c0cc,search:_0x3ca25e}=_0x45eb9e,_0x5130bf=(_0x58ce63-0x1)*_0x20c03d;console[_0x23b8ae(0x269)](_0x23b8ae(0x26b),_0x45eb9e);const _0x80c53c={};_0x429a74&&(_0x80c53c['status']=_0x429a74[_0x23b8ae(0x282)]());if(_0x11c8cc){if((0x0,gateway_1[_0x23b8ae(0x271)])(_0x11c8cc)){const _0x418856=(0x0,gateway_1[_0x23b8ae(0x2a0)])(_0x11c8cc);_0x418856&&(_0x80c53c[_0x23b8ae(0x214)]=_0x418856);}else _0x80c53c[_0x23b8ae(0x214)]=_0x11c8cc['toLowerCase']();}_0x95a96d&&(_0x80c53c['shopId']=_0x95a96d);(_0x573c84||_0x17c0cc)&&(_0x80c53c[_0x23b8ae(0x213)]={},_0x573c84&&(_0x80c53c['createdAt'][_0x23b8ae(0x1ea)]=new Date(_0x573c84)),_0x17c0cc&&(_0x80c53c[_0x23b8ae(0x213)]['lte']=new Date(_0x17c0cc)));_0x3ca25e&&(_0x80c53c['OR']=[{'orderId':{'contains':_0x3ca25e,'mode':'insensitive'}},{'gatewayOrderId':{'contains':_0x3ca25e,'mode':_0x23b8ae(0x2a8)}},{'gatewayPaymentId':{'contains':_0x3ca25e,'mode':_0x23b8ae(0x2a8)}},{'customerEmail':{'contains':_0x3ca25e,'mode':_0x23b8ae(0x2a8)}},{'customerName':{'contains':_0x3ca25e,'mode':_0x23b8ae(0x2a8)}},{'shop':{'name':{'contains':_0x3ca25e,'mode':_0x23b8ae(0x2a8)}}},{'shop':{'username':{'contains':_0x3ca25e,'mode':'insensitive'}}}]);const [_0x445bce,_0x368b59]=await Promise[_0x23b8ae(0x299)]([database_1[_0x23b8ae(0x287)]['payment'][_0x23b8ae(0x211)]({'where':_0x80c53c,'skip':_0x5130bf,'take':_0x20c03d,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default'][_0x23b8ae(0x22a)][_0x23b8ae(0x20c)]({'where':_0x80c53c})]);console[_0x23b8ae(0x269)](_0x23b8ae(0x225)+_0x445bce['length']+'\x20payments\x20out\x20of\x20'+_0x368b59+'\x20total');const _0x525c4c=_0x445bce[_0x23b8ae(0x24e)](_0x361ed4=>({'id':_0x361ed4['id'],'shopId':_0x361ed4[_0x23b8ae(0x1dc)],'shopName':_0x361ed4[_0x23b8ae(0x29e)][_0x23b8ae(0x222)],'shopUsername':_0x361ed4[_0x23b8ae(0x29e)]['username'],'gateway':_0x361ed4[_0x23b8ae(0x214)],'orderId':_0x361ed4['orderId'],'gatewayOrderId':_0x361ed4[_0x23b8ae(0x2a3)],'amount':_0x361ed4[_0x23b8ae(0x27c)],'currency':_0x361ed4['currency'],'sourceCurrency':_0x361ed4[_0x23b8ae(0x1d7)],'status':_0x361ed4['status'],'usage':_0x361ed4[_0x23b8ae(0x249)],'externalPaymentUrl':_0x361ed4[_0x23b8ae(0x257)],'gatewayPaymentId':_0x361ed4[_0x23b8ae(0x210)],'customerEmail':_0x361ed4['customerEmail'],'customerName':_0x361ed4[_0x23b8ae(0x277)],'cardLast4':_0x361ed4[_0x23b8ae(0x261)],'paymentMethod':_0x361ed4['paymentMethod'],'bankId':_0x361ed4[_0x23b8ae(0x288)],'remitterIban':_0x361ed4[_0x23b8ae(0x256)],'remitterName':_0x361ed4[_0x23b8ae(0x20f)],'chargebackAmount':_0x361ed4[_0x23b8ae(0x264)],'adminNotes':_0x361ed4[_0x23b8ae(0x263)],'statusChangedBy':_0x361ed4[_0x23b8ae(0x29a)],'statusChangedAt':_0x361ed4[_0x23b8ae(0x1e1)],'createdAt':_0x361ed4['createdAt'],'updatedAt':_0x361ed4[_0x23b8ae(0x25a)],'expiresAt':_0x361ed4[_0x23b8ae(0x294)]}));return{'payments':_0x525c4c,'pagination':{'page':_0x58ce63,'limit':_0x20c03d,'total':_0x368b59,'totalPages':Math[_0x23b8ae(0x27a)](_0x368b59/_0x20c03d)}};}async[a33_0x2e7cdd(0x1e8)](_0x1c1f45){const _0x17371b=a33_0x2e7cdd;console[_0x17371b(0x269)](_0x17371b(0x28d)+_0x1c1f45);const _0xbfa964=await database_1[_0x17371b(0x287)][_0x17371b(0x22a)][_0x17371b(0x21a)]({'where':{'id':_0x1c1f45},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}},'webhookLogs':{'orderBy':{'createdAt':'desc'},'take':0xa,'select':{'id':!![],'event':!![],'statusCode':!![],'retryCount':!![],'createdAt':!![]}}}});if(!_0xbfa964)return console['log'](_0x17371b(0x28f)+_0x1c1f45),null;return console[_0x17371b(0x269)](_0x17371b(0x1db)+_0xbfa964[_0x17371b(0x29b)]+'\x20('+_0xbfa964[_0x17371b(0x265)]+')'),{'id':_0xbfa964['id'],'shopId':_0xbfa964[_0x17371b(0x1dc)],'shopName':_0xbfa964[_0x17371b(0x29e)][_0x17371b(0x222)],'shopUsername':_0xbfa964[_0x17371b(0x29e)][_0x17371b(0x1ff)],'gateway':_0xbfa964[_0x17371b(0x214)],'orderId':_0xbfa964['orderId'],'gatewayOrderId':_0xbfa964[_0x17371b(0x2a3)],'amount':_0xbfa964[_0x17371b(0x27c)],'currency':_0xbfa964['currency'],'sourceCurrency':_0xbfa964[_0x17371b(0x1d7)],'status':_0xbfa964[_0x17371b(0x265)],'usage':_0xbfa964['usage'],'externalPaymentUrl':_0xbfa964[_0x17371b(0x257)],'gatewayPaymentId':_0xbfa964[_0x17371b(0x210)],'customerEmail':_0xbfa964['customerEmail'],'customerName':_0xbfa964[_0x17371b(0x277)],'cardLast4':_0xbfa964[_0x17371b(0x261)],'paymentMethod':_0xbfa964[_0x17371b(0x262)],'bankId':_0xbfa964[_0x17371b(0x288)],'remitterIban':_0xbfa964['remitterIban'],'remitterName':_0xbfa964[_0x17371b(0x20f)],'chargebackAmount':_0xbfa964[_0x17371b(0x264)],'adminNotes':_0xbfa964[_0x17371b(0x263)],'statusChangedBy':_0xbfa964[_0x17371b(0x29a)],'statusChangedAt':_0xbfa964[_0x17371b(0x1e1)],'createdAt':_0xbfa964[_0x17371b(0x213)],'updatedAt':_0xbfa964[_0x17371b(0x25a)],'expiresAt':_0xbfa964[_0x17371b(0x294)],'webhookLogs':_0xbfa964[_0x17371b(0x2a5)]};}async[a33_0x2e7cdd(0x22d)](_0xd1718c,_0x4717d9,_0x2e955c,_0x5a42c0){const _0xe90b8b=a33_0x2e7cdd;console[_0xe90b8b(0x269)]('🔄\x20Updating\x20payment\x20'+_0xd1718c+_0xe90b8b(0x26d)+_0x4717d9);const _0x5b8f81=['PENDING',_0xe90b8b(0x24d),_0xe90b8b(0x286),_0xe90b8b(0x1f3),_0xe90b8b(0x202),_0xe90b8b(0x1e2),_0xe90b8b(0x219)];if(!_0x5b8f81[_0xe90b8b(0x274)](_0x4717d9[_0xe90b8b(0x282)]()))throw new Error('Invalid\x20status.\x20Valid\x20statuses:\x20'+_0x5b8f81[_0xe90b8b(0x298)](',\x20'));const _0x590ba3=await database_1[_0xe90b8b(0x287)][_0xe90b8b(0x22a)][_0xe90b8b(0x21a)]({'where':{'id':_0xd1718c},'select':{'id':!![],'status':!![],'orderId':!![]}});if(!_0x590ba3)throw new Error(_0xe90b8b(0x233));if(_0x4717d9['toUpperCase']()===_0xe90b8b(0x219)){if(!_0x5a42c0||_0x5a42c0<=0x0)throw new Error('Chargeback\x20amount\x20is\x20required\x20and\x20must\x20be\x20positive\x20(amount\x20in\x20USDT)');console[_0xe90b8b(0x269)](_0xe90b8b(0x224)+_0x5a42c0+_0xe90b8b(0x21d));}const _0x4fc365={'status':_0x4717d9[_0xe90b8b(0x282)](),'updatedAt':new Date()};_0x2e955c&&(_0x4fc365[_0xe90b8b(0x263)]=_0x2e955c);_0x4717d9['toUpperCase']()===_0xe90b8b(0x219)&&_0x5a42c0&&(_0x4fc365[_0xe90b8b(0x264)]=_0x5a42c0);const _0x5675c0=await database_1[_0xe90b8b(0x287)]['payment'][_0xe90b8b(0x226)]({'where':{'id':_0xd1718c},'data':_0x4fc365,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});return await database_1[_0xe90b8b(0x287)][_0xe90b8b(0x232)][_0xe90b8b(0x26f)]({'data':{'paymentId':_0xd1718c,'shopId':_0x5675c0[_0xe90b8b(0x1dc)],'event':_0xe90b8b(0x24a),'statusCode':0xc8,'responseBody':JSON['stringify']({'oldStatus':_0x590ba3[_0xe90b8b(0x265)],'newStatus':_0x4717d9['toUpperCase'](),'notes':_0x2e955c||null,'chargebackAmount':_0x5a42c0||null,'timestamp':new Date()[_0xe90b8b(0x255)]()})}}),console[_0xe90b8b(0x269)](_0xe90b8b(0x2ab)+_0x590ba3[_0xe90b8b(0x29b)]+_0xe90b8b(0x1eb)+_0x590ba3[_0xe90b8b(0x265)]+_0xe90b8b(0x28b)+_0x4717d9[_0xe90b8b(0x282)]()),_0x4717d9[_0xe90b8b(0x282)]()==='CHARGEBACK'&&console[_0xe90b8b(0x269)](_0xe90b8b(0x23e)+_0x5a42c0+_0xe90b8b(0x231)),{'id':_0x5675c0['id'],'shopId':_0x5675c0['shopId'],'shopName':_0x5675c0[_0xe90b8b(0x29e)]['name'],'shopUsername':_0x5675c0['shop'][_0xe90b8b(0x1ff)],'gateway':_0x5675c0[_0xe90b8b(0x214)],'orderId':_0x5675c0['orderId'],'gatewayOrderId':_0x5675c0[_0xe90b8b(0x2a3)],'amount':_0x5675c0['amount'],'currency':_0x5675c0[_0xe90b8b(0x22f)],'sourceCurrency':_0x5675c0[_0xe90b8b(0x1d7)],'status':_0x5675c0[_0xe90b8b(0x265)],'usage':_0x5675c0[_0xe90b8b(0x249)],'externalPaymentUrl':_0x5675c0['externalPaymentUrl'],'gatewayPaymentId':_0x5675c0[_0xe90b8b(0x210)],'customerEmail':_0x5675c0[_0xe90b8b(0x209)],'customerName':_0x5675c0[_0xe90b8b(0x277)],'cardLast4':_0x5675c0[_0xe90b8b(0x261)],'paymentMethod':_0x5675c0[_0xe90b8b(0x262)],'bankId':_0x5675c0['bankId'],'remitterIban':_0x5675c0['remitterIban'],'remitterName':_0x5675c0[_0xe90b8b(0x20f)],'chargebackAmount':_0x5675c0[_0xe90b8b(0x264)],'adminNotes':_0x5675c0['adminNotes'],'statusChangedBy':_0x5675c0[_0xe90b8b(0x29a)],'statusChangedAt':_0x5675c0[_0xe90b8b(0x1e1)],'createdAt':_0x5675c0[_0xe90b8b(0x213)],'updatedAt':_0x5675c0[_0xe90b8b(0x25a)],'expiresAt':_0x5675c0[_0xe90b8b(0x294)]};}async[a33_0x2e7cdd(0x1f0)](_0x3c5573){const _0x619179=a33_0x2e7cdd,{page:_0x4e183e,limit:_0x24ad40,status:_0x2cf89d}=_0x3c5573,_0x47ffc6=(_0x4e183e-0x1)*_0x24ad40,_0xb2e3bb={};_0x2cf89d&&(_0xb2e3bb[_0x619179(0x265)]=_0x2cf89d[_0x619179(0x282)]());console[_0x619179(0x269)](_0x619179(0x1ef),{'page':_0x4e183e,'limit':_0x24ad40,'status':_0x2cf89d,'where':_0xb2e3bb});const [_0x1549e5,_0x559c68]=await Promise[_0x619179(0x299)]([database_1[_0x619179(0x287)][_0x619179(0x29e)]['findMany']({'where':_0xb2e3bb,'skip':_0x47ffc6,'take':_0x24ad40,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x619179(0x268)}}),database_1['default'][_0x619179(0x29e)][_0x619179(0x20c)]({'where':_0xb2e3bb})]);console[_0x619179(0x269)]('📊\x20Found\x20'+_0x1549e5['length']+_0x619179(0x1d9)+_0x559c68+_0x619179(0x23b));const _0x54e430=_0x1549e5[_0x619179(0x24e)](_0x348035=>({'id':_0x348035['id'],'fullName':_0x348035[_0x619179(0x222)],'username':_0x348035[_0x619179(0x1ff)],'telegramId':_0x348035[_0x619179(0x240)],'merchantUrl':_0x348035[_0x619179(0x23d)],'gateways':_0x348035['paymentGateways']?JSON[_0x619179(0x2ac)](_0x348035['paymentGateways']):null,'gatewaySettings':_0x348035[_0x619179(0x22e)]?JSON[_0x619179(0x2ac)](_0x348035[_0x619179(0x22e)]):null,'publicKey':_0x348035[_0x619179(0x235)],'wallets':{'usdtPolygonWallet':_0x348035[_0x619179(0x24b)],'usdtTrcWallet':_0x348035[_0x619179(0x21b)],'usdtErcWallet':_0x348035[_0x619179(0x2af)],'usdcPolygonWallet':_0x348035[_0x619179(0x21e)]},'status':_0x348035[_0x619179(0x265)],'createdAt':_0x348035[_0x619179(0x213)]}));return{'users':_0x54e430,'pagination':{'page':_0x4e183e,'limit':_0x24ad40,'total':_0x559c68,'totalPages':Math[_0x619179(0x27a)](_0x559c68/_0x24ad40)}};}async[a33_0x2e7cdd(0x293)](_0x41be24){const _0x203f99=a33_0x2e7cdd;return await this[_0x203f99(0x1fc)][_0x203f99(0x293)](_0x41be24);}async['createUser'](_0x1c05f2){const _0x38fe16=a33_0x2e7cdd;return await this[_0x38fe16(0x1fc)][_0x38fe16(0x1dd)](_0x1c05f2);}async[a33_0x2e7cdd(0x201)](_0x1e91d7,_0x17c664){const _0x42a96a=a33_0x2e7cdd;return await this[_0x42a96a(0x1fc)][_0x42a96a(0x201)](_0x1e91d7,_0x17c664);}async['deleteUser'](_0x53cfe5){const _0x79456b=a33_0x2e7cdd;return await this[_0x79456b(0x1fc)][_0x79456b(0x1df)](_0x53cfe5);}async[a33_0x2e7cdd(0x273)](_0x180be8){const _0x34f73e=a33_0x2e7cdd;console[_0x34f73e(0x269)](_0x34f73e(0x1f2)+_0x180be8);const _0x2ecd0b=await database_1[_0x34f73e(0x287)][_0x34f73e(0x29e)]['findUnique']({'where':{'id':_0x180be8},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x2ecd0b)throw new Error('User\x20not\x20found');if(_0x2ecd0b[_0x34f73e(0x265)]===_0x34f73e(0x275))throw new Error(_0x34f73e(0x29f));const _0x429e38=await this['userService'][_0x34f73e(0x201)](_0x180be8,{'status':_0x34f73e(0x275)});return console[_0x34f73e(0x269)]('✅\x20User\x20'+_0x2ecd0b['username']+'\x20suspended\x20successfully'),_0x429e38;}async[a33_0x2e7cdd(0x259)](_0x1328cb){const _0x25fecf=a33_0x2e7cdd;console[_0x25fecf(0x269)](_0x25fecf(0x203)+_0x1328cb);const _0x511ecf=await database_1[_0x25fecf(0x287)][_0x25fecf(0x29e)]['findUnique']({'where':{'id':_0x1328cb},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x511ecf)throw new Error(_0x25fecf(0x1e6));if(_0x511ecf[_0x25fecf(0x265)]===_0x25fecf(0x260))throw new Error(_0x25fecf(0x28a));const _0x5d84a5=await this['userService'][_0x25fecf(0x201)](_0x1328cb,{'status':_0x25fecf(0x260)});return console['log']('✅\x20User\x20'+_0x511ecf['username']+_0x25fecf(0x250)),_0x5d84a5;}}function a33_0x4862(){const _0x33a950=['\x20users\x20out\x20of\x20','Shop\x20not\x20found','✅\x20Found\x20payment:\x20','shopId','createUser','abs','deleteUser','❌\x20Payout\x20not\x20found:\x20','statusChangedAt','REFUND','Failed\x20to\x20send\x20Telegram\x20payout\x20notification:','amountUSDT','getFullYear','User\x20not\x20found','✅\x20Found\x20payout:\x20','getPaymentById','Shop\x20is\x20not\x20active','gte','\x20status\x20updated\x20from\x20','length','sendPayoutNotification','../config/database','📋\x20Getting\x20users\x20with\x20filters:','getAllUsers','getMonth','🚫\x20Suspending\x20user:\x20','EXPIRED','getPeriodDays','6robgFy','defineProperty','notes','$queryRaw','sort','payments','isEligibleForPayout','userService','✅\x20Admin\x20statistics\x20generated\x20successfully','toLowerCase','username','📊\x20Generating\x20admin\x20statistics\x20for\x20period:\x20','updateUser','FAILED','✅\x20Activating\x20user:\x20','197444oYjFFj','🏪\x20Found\x20','📈\x20Average\x20payment:\x20','\x20payouts\x20out\x20of\x20','\x20merchants\x20with\x20eligible\x20PAID\x20payments','customerEmail','getMerchantsAwaitingPayout','getAllPayouts','count','entries','📅\x20This\x20Month:\x20','remitterName','gatewayPaymentId','findMany','deletePayout','createdAt','gateway','./currencyService','round','date','✅\x20Payout\x20','CHARGEBACK','findUnique','usdtTrcWallet','currencyService','\x20USDT\x20(penalty\x20amount)','usdcPolygonWallet','totalPayout','set','💳\x20Total\x20payments:\x20','name','paidAt','💸\x20Chargeback\x20amount:\x20','📊\x20Found\x20','update','merchantPaid','convertToUSDT','\x20USDT','payment','5719770qmVBdr','txid','updatePaymentStatus','gatewaySettings','currency','from','\x20USDT\x20(will\x20be\x20deducted\x20from\x20merchant\x20balance)','webhookLog','Payment\x20not\x20found','totalAmountUSDT','publicKey','57AFFBOl','getPayoutStats','\x20USDT\x20after\x20commission)','📋\x20Getting\x20payouts\x20with\x20filters:','markPaymentsAsPaidOut','\x20total','has','shopUrl','💸\x20Chargeback\x20penalty:\x20','📊\x20Calculating\x20admin\x20payout\x20statistics...','telegram','error','390899mrwqLp','5655350njacbH','✅\x20Payout\x20created\x20successfully:\x20','setDate','🔄\x20Marking\x20payments\x20as\x20paid\x20out\x20for\x20shop\x20','UserService','push','usage','status_update','usdtPolygonWallet','payoutDelay','PROCESSING','map','amountAfterCommissionUSDT','\x20activated\x20successfully','getTime','\x20USDT\x20(только\x20PAID\x20платежи)','getGatewaySettings','totalAmountAfterCommissionUSDT','toISOString','remitterIban','externalPaymentUrl','asc','activateUser','updatedAt','payout','getDate','network','./telegramBotService','3341864ekXzPt','ACTIVE','cardLast4','paymentMethod','adminNotes','chargebackAmount','status','📅\x20Processing\x20daily\x20stats\x20for\x20','👥\x20Total\x20users:\x20','desc','log','9LKPZgF','📋\x20Getting\x20payments\x20with\x20filters:','get','\x20status\x20to:\x20','✅\x20Returning\x20','create','\x20USDT\x20via\x20','isValidGatewayId','size','suspendUser','includes','SUSPENDED','__esModule','customerName','COMPLETED','completed','ceil','generateDateRange','amount','2682360FUrkSA','calculateEffectiveAmount','telegramBotService','Payout\x20not\x20found','commission','toUpperCase','💰\x20Available\x20Balance:\x20','📋\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','💰\x20Found\x20','PAID','default','bankId','split','User\x20is\x20already\x20active','\x20to\x20',',\x20amount:\x20','🔍\x20Getting\x20payment\x20by\x20ID:\x20','\x20USDT\x20(включая\x20штрафы\x20chargeback)','❌\x20Payment\x20not\x20found:\x20','charAt','💰\x20Total\x20amount:\x20','🔍\x20Getting\x20payout\x20by\x20ID:\x20','getUserById','expiresAt','✅\x20Payout\x20statistics\x20calculated:','reduce','slice','join','all','statusChangedBy','orderId','toFixed','\x20payments\x20for\x20revenue\x20calculation\x20(PAID/REFUND/CHARGEBACK)','shop','User\x20is\x20already\x20suspended','getGatewayNameById','updateMany','90d','gatewayOrderId','🗑️\x20Deleting\x20payout:\x20','webhookLogs','getAllPayments','💵\x20Total\x20revenue:\x20','insensitive','💸\x20Creating\x20payout\x20for\x20shop\x20','AdminService','✅\x20Payment\x20','parse','calculateAmountAfterCommission','6347740dxxpNP','usdtErcWallet','sourceCurrency','lte'];a33_0x4862=function(){return _0x33a950;};return a33_0x4862();}exports[a33_0x2e7cdd(0x2aa)]=AdminService;