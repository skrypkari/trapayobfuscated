'use strict';const a33_0x148e1e=a33_0x4f1d;(function(_0x13eafa,_0x50f4f3){const _0x563642=a33_0x4f1d,_0x4cad95=_0x13eafa();while(!![]){try{const _0x152e43=-parseInt(_0x563642(0xbc))/0x1+parseInt(_0x563642(0x151))/0x2*(-parseInt(_0x563642(0xda))/0x3)+parseInt(_0x563642(0xf5))/0x4*(-parseInt(_0x563642(0x11f))/0x5)+-parseInt(_0x563642(0x146))/0x6+-parseInt(_0x563642(0xb1))/0x7+-parseInt(_0x563642(0xe2))/0x8*(-parseInt(_0x563642(0xc2))/0x9)+parseInt(_0x563642(0x145))/0xa;if(_0x152e43===_0x50f4f3)break;else _0x4cad95['push'](_0x4cad95['shift']());}catch(_0x298420){_0x4cad95['push'](_0x4cad95['shift']());}}}(a33_0x5b09,0x5974a));function a33_0x4f1d(_0x5412bb,_0x3cee1d){const _0x5b0953=a33_0x5b09();return a33_0x4f1d=function(_0x4f1db7,_0x8d6f86){_0x4f1db7=_0x4f1db7-0x86;let _0x45a55c=_0x5b0953[_0x4f1db7];return _0x45a55c;},a33_0x4f1d(_0x5412bb,_0x3cee1d);}var __importDefault=this&&this[a33_0x148e1e(0x115)]||function(_0x32cb57){return _0x32cb57&&_0x32cb57['__esModule']?_0x32cb57:{'default':_0x32cb57};};Object[a33_0x148e1e(0x92)](exports,'__esModule',{'value':!![]}),exports['AdminService']=void 0x0;function a33_0x5b09(){const _0x3916f3=['üí∞\x20Found\x20','create','üìà\x20Average\x20payment:\x20','paidAt','statusChangedBy','‚úÖ\x20Admin\x20statistics\x20generated\x20successfully','usdtTrcWallet','\x20activated\x20successfully','toFixed','calculateEffectiveAmount','deleteUser','get','\x20merchants\x20with\x20eligible\x20PAID\x20payments','parse','deletePayout','User\x20is\x20already\x20suspended','üë•\x20Total\x20users:\x20','4343360EeVjDr','üí∞\x20Total\x20amount:\x20','round','90d','merchantPaid','gatewayPaymentId','username','EXPIRED','User\x20is\x20already\x20active','join','log','546973iPWGvl','charAt','./currencyService','asc','insensitive','totalAmountAfterCommissionUSDT','9phGhif','getPeriodDays','paymentGateways','adminNotes','usdcPolygonWallet','Payment\x20not\x20found','shopUrl','updateUser','findUnique','shop','updateMany','split','has','includes','customerName','entries','CHARGEBACK','üìä\x20Generating\x20admin\x20statistics\x20for\x20period:\x20','markPaymentsAsPaidOut','statusChangedAt','\x20USDT\x20(–≤–∫–ª—é—á–∞—è\x20—à—Ç—Ä–∞—Ñ—ã\x20chargeback)','getGatewaySettings','üí∏\x20Chargeback\x20amount:\x20','setDate','3dYIHbB','isValidGatewayId','üö´\x20Suspending\x20user:\x20','currency','UserService','generateDateRange','toISOString','sourceCurrency','5436512ISHQlu','length','amount','set','\x20status\x20updated\x20from\x20','sort','totalAmountUSDT','webhookLog','getPayoutById','paymentMethod','status','üìã\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','push','payments','remitterIban','PAID','‚úÖ\x20Payout\x20created\x20successfully:\x20','\x20USDT\x20(—Ç–æ–ª—å–∫–æ\x20PAID\x20–ø–ª–∞—Ç–µ–∂–∏)','‚ùå\x20Payment\x20not\x20found:\x20','212vLKSOI','\x20USDT\x20(','getPayoutStats','\x20merchants\x20out\x20of\x20','Shop\x20not\x20found','payout','../config/database','externalPaymentUrl','getAllPayments','getFullYear','üí∏\x20Total\x20Payout:\x20','getAllUsers','amountUSDT','\x20to\x20','gatewaySettings','REFUND','slice','./userService','üíµ\x20Total\x20revenue:\x20','orderId','usage','\x20payments\x20out\x20of\x20','gateway','status_update','notes','currencyService','gte','getSystemStatistics','shopId','üîç\x20Getting\x20payment\x20by\x20ID:\x20','üîÑ\x20Marking\x20payments\x20as\x20paid\x20out\x20for\x20shop\x20','network','__importDefault','availableBalance','suspendUser','chargebackAmount','üìã\x20Getting\x20users\x20with\x20filters:','ceil','\x20payments\x20for\x20analysis\x20(PAID/REFUND/CHARGEBACK)','activateUser','calculateAmountAfterCommission','\x20days)','65405SMOmgn','30d','payment','üîç\x20Getting\x20payout\x20by\x20ID:\x20','expiresAt','üìä\x20Calculating\x20admin\x20payout\x20statistics...','getAllPayouts','\x20USDT','getMerchantsAwaitingPayout','üîÑ\x20Updating\x20payment\x20','name','\x20payments\x20for\x20revenue\x20calculation\x20(PAID/REFUND/CHARGEBACK)','\x20payouts\x20out\x20of\x20','‚úÖ\x20Activating\x20user:\x20','payoutDelay','\x20USDT\x20after\x20commission)','publicKey','amountAfterCommissionUSDT','updatePaymentStatus','toLowerCase','Payout\x20not\x20found','üìÖ\x20This\x20Month:\x20','default','üìÖ\x20Processing\x20daily\x20stats\x20for\x20','cardLast4','isEligibleForPayout','getUserById','all','\x20eligible\x20PAID\x20payments\x20for\x20payout\x20analysis','lte','abs','webhookLogs','usdtPolygonWallet','usdtErcWallet','Chargeback\x20amount\x20is\x20required\x20and\x20must\x20be\x20positive\x20(amount\x20in\x20USDT)','totalPayout','updatedAt','\x20total','21798310XsSuwj','1718838akbuuw','../types/gateway','üìã\x20Getting\x20payments\x20with\x20filters:','customerEmail','SUSPENDED','getDate','telegramBotService','reduce','\x20USDT\x20(penalty\x20amount)','from','Failed\x20to\x20send\x20Telegram\x20payout\x20notification:','691532DKMuHL','toUpperCase','createdAt','convertToUSDT','userService','ACTIVE','Shop\x20is\x20not\x20active','Error\x20parsing\x20gateway\x20settings:','gatewayOrderId','./telegramBotService','Invalid\x20status.\x20Valid\x20statuses:\x20','\x20payments\x20as\x20paid\x20out',',\x20amount:\x20','\x20USDT\x20via\x20','\x20status\x20to:\x20','count','bankId','‚úÖ\x20User\x20','telegram','getMonth','üí≥\x20Total\x20payments:\x20','txid','stringify','map','date','defineProperty','‚úÖ\x20Payment\x20','remitterName','commission','createPayout','size','$queryRaw','error','User\x20not\x20found','desc','PENDING','\x20deleted\x20successfully','findMany','‚úÖ\x20Payout\x20'];a33_0x5b09=function(){return _0x3916f3;};return a33_0x5b09();}const database_1=__importDefault(require(a33_0x148e1e(0xfb))),currencyService_1=require(a33_0x148e1e(0xbe)),userService_1=require(a33_0x148e1e(0x106)),telegramBotService_1=require(a33_0x148e1e(0x15a)),gateway_1=require(a33_0x148e1e(0x147));class AdminService{constructor(){const _0x296330=a33_0x148e1e;this['userService']=new userService_1[(_0x296330(0xde))]();}[a33_0x148e1e(0xc3)](_0x42569c){const _0x21ef56=a33_0x148e1e;switch(_0x42569c){case'7d':return 0x7;case _0x21ef56(0x120):return 0x1e;case _0x21ef56(0xb4):return 0x5a;case'1y':return 0x16d;default:return 0x1e;}}['generateDateRange'](_0x11a34c,_0x4b0dbe){const _0x5b8f21=a33_0x148e1e,_0x30f5c8=[],_0xea2731=new Date(_0x11a34c);while(_0xea2731<=_0x4b0dbe){_0x30f5c8[_0x5b8f21(0xee)](_0xea2731['toISOString']()[_0x5b8f21(0xcd)]('T')[0x0]),_0xea2731[_0x5b8f21(0xd9)](_0xea2731[_0x5b8f21(0x14b)]()+0x1);}return _0x30f5c8;}[a33_0x148e1e(0xd7)](_0x1f91e0,_0x133e3b){const _0x32d342=a33_0x148e1e;if(!_0x1f91e0['gatewaySettings'])return{'commission':0x0,'payoutDelay':0x0};try{const _0x11cae5=JSON[_0x32d342(0xad)](_0x1f91e0['gatewaySettings']),_0x3743b5=_0x133e3b['charAt'](0x0)[_0x32d342(0x152)]()+_0x133e3b[_0x32d342(0x105)](0x1)[_0x32d342(0x132)]();if(_0x11cae5&&_0x11cae5[_0x3743b5])return{'commission':_0x11cae5[_0x3743b5]['commission']||0x0,'payoutDelay':_0x11cae5[_0x3743b5][_0x32d342(0x12d)]||0x0};}catch(_0x53323d){console[_0x32d342(0x99)](_0x32d342(0x158),_0x53323d);}return{'commission':0x0,'payoutDelay':0x0};}[a33_0x148e1e(0x138)](_0x2ec7cb){const _0x56647c=a33_0x148e1e;if(_0x2ec7cb[_0x56647c(0xec)]!==_0x56647c(0xf1)||_0x2ec7cb[_0x56647c(0xb5)]||!_0x2ec7cb[_0x56647c(0xa3)])return![];const _0xe55c8c=this[_0x56647c(0xd7)](_0x2ec7cb['shop'],_0x2ec7cb[_0x56647c(0x10b)]),_0x10eba0=_0xe55c8c[_0x56647c(0x12d)]*0x18*0x3c*0x3c*0x3e8,_0x1ca686=new Date(_0x2ec7cb[_0x56647c(0xa3)]['getTime']()+_0x10eba0);return new Date()>_0x1ca686;}[a33_0x148e1e(0x11d)](_0x522726,_0x1b882f){return _0x522726*(0x1-_0x1b882f/0x64);}[a33_0x148e1e(0xa9)](_0x550ae9){const _0x5830d5=a33_0x148e1e;switch(_0x550ae9['status']){case _0x5830d5(0xf1):return _0x550ae9['amount'];case _0x5830d5(0xd2):return-(_0x550ae9[_0x5830d5(0x118)]||0x0);case _0x5830d5(0x104):return 0x0;default:return 0x0;}}async[a33_0x148e1e(0x96)](_0x152358){const _0x186846=a33_0x148e1e,{shopId:_0x1a6d2c,amount:_0xe62f16,network:_0x2455e6,notes:_0x46a11d}=_0x152358;console[_0x186846(0xbb)]('üí∏\x20Creating\x20payout\x20for\x20shop\x20'+_0x1a6d2c+':\x20'+_0xe62f16+_0x186846(0x86)+_0x2455e6);const _0xceb8f6=await database_1[_0x186846(0x135)][_0x186846(0xcb)]['findUnique']({'where':{'id':_0x1a6d2c},'select':{'id':!![],'name':!![],'username':!![],'status':!![]}});if(!_0xceb8f6)throw new Error(_0x186846(0xf9));if(_0xceb8f6[_0x186846(0xec)]!==_0x186846(0x156))throw new Error(_0x186846(0x157));const _0x17f637=await database_1[_0x186846(0x135)][_0x186846(0xfa)][_0x186846(0xa1)]({'data':{'shopId':_0x1a6d2c,'amount':_0xe62f16,'network':_0x2455e6,'status':'COMPLETED','notes':_0x46a11d||null,'paidAt':new Date()},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});await this[_0x186846(0xd4)](_0x1a6d2c,_0xe62f16);try{await telegramBotService_1[_0x186846(0x14c)]['sendPayoutNotification'](_0x1a6d2c,_0x17f637,'completed');}catch(_0x493cd2){console[_0x186846(0x99)](_0x186846(0x150),_0x493cd2);}return console[_0x186846(0xbb)](_0x186846(0xf2)+_0x17f637['id']),{'id':_0x17f637['id'],'shopId':_0x17f637[_0x186846(0x111)],'shopName':_0x17f637[_0x186846(0xcb)][_0x186846(0x129)],'shopUsername':_0x17f637[_0x186846(0xcb)][_0x186846(0xb7)],'amount':_0x17f637[_0x186846(0xe4)],'network':_0x17f637['network'],'status':_0x17f637['status'],'txid':_0x17f637[_0x186846(0x8e)],'notes':_0x17f637[_0x186846(0x10d)],'createdAt':_0x17f637[_0x186846(0x153)],'paidAt':_0x17f637['paidAt']};}async[a33_0x148e1e(0xd4)](_0x26aba1,_0x5dc65e){const _0x1d06ca=a33_0x148e1e;console[_0x1d06ca(0xbb)](_0x1d06ca(0x113)+_0x26aba1+_0x1d06ca(0x15d)+_0x5dc65e+_0x1d06ca(0x126));const _0x337a4a=await database_1[_0x1d06ca(0x135)][_0x1d06ca(0x121)][_0x1d06ca(0x9e)]({'where':{'shopId':_0x26aba1,'status':_0x1d06ca(0xf1),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'shop':{'select':{'gatewaySettings':!![]}}},'orderBy':{'paidAt':_0x1d06ca(0xbf)}});let _0x5ee626=_0x5dc65e;const _0x14bf26=[];for(const _0x35bc72 of _0x337a4a){const _0x3c4bfc={..._0x35bc72,'status':_0x1d06ca(0xf1),'merchantPaid':![],'shop':{'gatewaySettings':_0x35bc72['shop']['gatewaySettings']}};if(!this[_0x1d06ca(0x138)](_0x3c4bfc))continue;const _0x23e475=await currencyService_1[_0x1d06ca(0x10e)][_0x1d06ca(0x154)](_0x35bc72['amount'],_0x35bc72[_0x1d06ca(0xdd)]),_0x379769=this['getGatewaySettings'](_0x35bc72[_0x1d06ca(0xcb)],_0x35bc72[_0x1d06ca(0x10b)]),_0x4258bc=this[_0x1d06ca(0x11d)](_0x23e475,_0x379769[_0x1d06ca(0x95)]);if(_0x4258bc<=_0x5ee626){_0x14bf26['push'](_0x35bc72['id']),_0x5ee626-=_0x4258bc;if(_0x5ee626<=0.01)break;}}_0x14bf26[_0x1d06ca(0xe3)]>0x0&&(await database_1[_0x1d06ca(0x135)][_0x1d06ca(0x121)][_0x1d06ca(0xcc)]({'where':{'id':{'in':_0x14bf26}},'data':{'merchantPaid':!![]}}),console[_0x1d06ca(0xbb)]('‚úÖ\x20Marked\x20'+_0x14bf26[_0x1d06ca(0xe3)]+_0x1d06ca(0x15c)));}async[a33_0x148e1e(0x125)](_0x4184c7){const _0x5d3d82=a33_0x148e1e,{page:_0x131a36,limit:_0x3b326f,shopId:_0x27ca98,network:_0xbf3cae,dateFrom:_0x3d173c,dateTo:_0x397f5c,search:_0x7982f9}=_0x4184c7,_0x26ddae=(_0x131a36-0x1)*_0x3b326f;console[_0x5d3d82(0xbb)]('üìã\x20Getting\x20payouts\x20with\x20filters:',_0x4184c7);const _0x9a4c2a={};_0x27ca98&&(_0x9a4c2a[_0x5d3d82(0x111)]=_0x27ca98);_0xbf3cae&&(_0x9a4c2a['network']=_0xbf3cae);(_0x3d173c||_0x397f5c)&&(_0x9a4c2a[_0x5d3d82(0x153)]={},_0x3d173c&&(_0x9a4c2a[_0x5d3d82(0x153)][_0x5d3d82(0x10f)]=new Date(_0x3d173c)),_0x397f5c&&(_0x9a4c2a['createdAt'][_0x5d3d82(0x13c)]=new Date(_0x397f5c)));_0x7982f9&&(_0x9a4c2a['OR']=[{'txid':{'contains':_0x7982f9,'mode':_0x5d3d82(0xc0)}},{'notes':{'contains':_0x7982f9,'mode':_0x5d3d82(0xc0)}},{'shop':{'name':{'contains':_0x7982f9,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x7982f9,'mode':_0x5d3d82(0xc0)}}}]);const [_0x3e31b6,_0x2554e3]=await Promise[_0x5d3d82(0x13a)]([database_1[_0x5d3d82(0x135)][_0x5d3d82(0xfa)][_0x5d3d82(0x9e)]({'where':_0x9a4c2a,'skip':_0x26ddae,'take':_0x3b326f,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x5d3d82(0x135)]['payout']['count']({'where':_0x9a4c2a})]);console[_0x5d3d82(0xbb)]('üìä\x20Found\x20'+_0x3e31b6[_0x5d3d82(0xe3)]+_0x5d3d82(0x12b)+_0x2554e3+'\x20total');const _0x4df036=_0x3e31b6['map'](_0x3250dc=>({'id':_0x3250dc['id'],'shopId':_0x3250dc[_0x5d3d82(0x111)],'shopName':_0x3250dc[_0x5d3d82(0xcb)][_0x5d3d82(0x129)],'shopUsername':_0x3250dc['shop'][_0x5d3d82(0xb7)],'amount':_0x3250dc[_0x5d3d82(0xe4)],'network':_0x3250dc[_0x5d3d82(0x114)],'status':_0x3250dc[_0x5d3d82(0xec)],'txid':_0x3250dc[_0x5d3d82(0x8e)],'notes':_0x3250dc[_0x5d3d82(0x10d)],'createdAt':_0x3250dc[_0x5d3d82(0x153)],'paidAt':_0x3250dc['paidAt']}));return{'payouts':_0x4df036,'pagination':{'page':_0x131a36,'limit':_0x3b326f,'total':_0x2554e3,'totalPages':Math[_0x5d3d82(0x11a)](_0x2554e3/_0x3b326f)}};}async[a33_0x148e1e(0xea)](_0x42937c){const _0x102b4f=a33_0x148e1e;console[_0x102b4f(0xbb)](_0x102b4f(0x122)+_0x42937c);const _0x38632a=await database_1['default']['payout']['findUnique']({'where':{'id':_0x42937c},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x38632a)return console[_0x102b4f(0xbb)]('‚ùå\x20Payout\x20not\x20found:\x20'+_0x42937c),null;return console[_0x102b4f(0xbb)]('‚úÖ\x20Found\x20payout:\x20'+_0x38632a[_0x102b4f(0xe4)]+'\x20USDT\x20via\x20'+_0x38632a['network']),{'id':_0x38632a['id'],'shopId':_0x38632a[_0x102b4f(0x111)],'shopName':_0x38632a['shop'][_0x102b4f(0x129)],'shopUsername':_0x38632a['shop'][_0x102b4f(0xb7)],'amount':_0x38632a[_0x102b4f(0xe4)],'network':_0x38632a[_0x102b4f(0x114)],'status':_0x38632a[_0x102b4f(0xec)],'txid':_0x38632a['txid'],'notes':_0x38632a[_0x102b4f(0x10d)],'createdAt':_0x38632a[_0x102b4f(0x153)],'paidAt':_0x38632a[_0x102b4f(0xa3)]};}async[a33_0x148e1e(0xae)](_0x4a2d3c){const _0x5b348b=a33_0x148e1e;console[_0x5b348b(0xbb)]('üóëÔ∏è\x20Deleting\x20payout:\x20'+_0x4a2d3c);const _0x153dbc=await database_1['default'][_0x5b348b(0xfa)][_0x5b348b(0xca)]({'where':{'id':_0x4a2d3c},'select':{'id':!![],'shopId':!![],'amount':!![]}});if(!_0x153dbc)throw new Error(_0x5b348b(0x133));await database_1[_0x5b348b(0x135)]['payout']['delete']({'where':{'id':_0x4a2d3c}}),console[_0x5b348b(0xbb)](_0x5b348b(0x9f)+_0x4a2d3c+_0x5b348b(0x9d));}async[a33_0x148e1e(0x127)](_0x1a93eb){const _0x34b9f6=a33_0x148e1e,{page:_0x268028,limit:_0x505509,minAmount:_0x484c5b,search:_0x585838}=_0x1a93eb;console[_0x34b9f6(0xbb)](_0x34b9f6(0xed),_0x1a93eb);const _0x46da0c=await database_1['default'][_0x34b9f6(0x121)][_0x34b9f6(0x9e)]({'where':{'status':_0x34b9f6(0xf1),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'createdAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'gatewaySettings':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}});console[_0x34b9f6(0xbb)](_0x34b9f6(0xa0)+_0x46da0c['length']+_0x34b9f6(0x13b));const _0x3d06e1=new Map();for(const _0xbc68f3 of _0x46da0c){const _0xa74b7d={..._0xbc68f3,'status':_0x34b9f6(0xf1),'merchantPaid':![],'shop':{'gatewaySettings':_0xbc68f3['shop']['gatewaySettings']}},_0x5a6bd3=this[_0x34b9f6(0x138)](_0xa74b7d);if(!_0x5a6bd3)continue;const _0x3a6fef=await currencyService_1['currencyService'][_0x34b9f6(0x154)](_0xbc68f3['amount'],_0xbc68f3[_0x34b9f6(0xdd)]),_0x2325b1=this[_0x34b9f6(0xd7)](_0xbc68f3[_0x34b9f6(0xcb)],_0xbc68f3[_0x34b9f6(0x10b)]),_0x40fab7=this['calculateAmountAfterCommission'](_0x3a6fef,_0x2325b1['commission']),_0x51dc7d=_0xbc68f3[_0x34b9f6(0x111)];!_0x3d06e1[_0x34b9f6(0xce)](_0x51dc7d)&&_0x3d06e1['set'](_0x51dc7d,{'shop':_0xbc68f3['shop'],'payments':[]}),_0x3d06e1[_0x34b9f6(0xab)](_0x51dc7d)['payments'][_0x34b9f6(0xee)]({'id':_0xbc68f3['id'],'amount':_0xbc68f3['amount'],'currency':_0xbc68f3['currency'],'gateway':_0xbc68f3[_0x34b9f6(0x10b)],'paidAt':_0xbc68f3[_0x34b9f6(0xa3)],'createdAt':_0xbc68f3[_0x34b9f6(0x153)],'amountUSDT':_0x3a6fef,'commission':_0x2325b1[_0x34b9f6(0x95)],'amountAfterCommissionUSDT':_0x40fab7,'isEligible':!![]});}console['log']('üè™\x20Found\x20'+_0x3d06e1[_0x34b9f6(0x97)]+_0x34b9f6(0xac));const _0x2e4305=[];for(const [_0xaad0b2,_0x3a0f40]of _0x3d06e1){const {shop:_0x14aeac,payments:_0x5c4671}=_0x3a0f40,_0x5658a7=_0x5c4671[_0x34b9f6(0x14d)]((_0x27a465,_0x4f949b)=>_0x27a465+_0x4f949b[_0x34b9f6(0x101)],0x0),_0x42b71a=_0x5c4671[_0x34b9f6(0x14d)]((_0x3a0f45,_0x2a2867)=>_0x3a0f45+_0x2a2867[_0x34b9f6(0x130)],0x0);if(_0x484c5b&&_0x42b71a<_0x484c5b)continue;if(_0x585838){const _0x205e46=_0x585838[_0x34b9f6(0x132)](),_0xf28575=_0x14aeac[_0x34b9f6(0x129)][_0x34b9f6(0x132)]()[_0x34b9f6(0xcf)](_0x205e46)||_0x14aeac[_0x34b9f6(0xb7)]['toLowerCase']()[_0x34b9f6(0xcf)](_0x205e46)||_0x14aeac[_0x34b9f6(0x8b)]&&_0x14aeac[_0x34b9f6(0x8b)]['toLowerCase']()['includes'](_0x205e46);if(!_0xf28575)continue;}const _0x29efa3=new Map();for(const _0x206329 of _0x5c4671){const _0x1447e1=_0x206329[_0x34b9f6(0x10b)];!_0x29efa3['has'](_0x1447e1)&&_0x29efa3[_0x34b9f6(0xe5)](_0x1447e1,{'count':0x0,'amountUSDT':0x0,'amountAfterCommissionUSDT':0x0,'commission':_0x206329['commission']});const _0x55742f=_0x29efa3['get'](_0x1447e1);_0x55742f['count']++,_0x55742f['amountUSDT']+=_0x206329[_0x34b9f6(0x101)],_0x55742f[_0x34b9f6(0x130)]+=_0x206329[_0x34b9f6(0x130)];}const _0xcf1d28=Array[_0x34b9f6(0x14f)](_0x29efa3[_0x34b9f6(0xd1)]())[_0x34b9f6(0x90)](([_0x45cc32,_0x576529])=>({'gateway':_0x45cc32[_0x34b9f6(0xbd)](0x0)[_0x34b9f6(0x152)]()+_0x45cc32[_0x34b9f6(0x105)](0x1),'count':_0x576529[_0x34b9f6(0x88)],'amountUSDT':Math[_0x34b9f6(0xb3)](_0x576529[_0x34b9f6(0x101)]*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x34b9f6(0xb3)](_0x576529[_0x34b9f6(0x130)]*0x64)/0x64,'commission':_0x576529[_0x34b9f6(0x95)]})),_0x31974e=_0x5c4671[_0x34b9f6(0x14d)]((_0x309601,_0x5e5bae)=>{const _0x3d6824=_0x34b9f6;return _0x5e5bae[_0x3d6824(0xa3)]<_0x309601?_0x5e5bae[_0x3d6824(0xa3)]:_0x309601;},_0x5c4671[0x0][_0x34b9f6(0xa3)]);_0x2e4305[_0x34b9f6(0xee)]({'id':_0x14aeac['id'],'fullName':_0x14aeac[_0x34b9f6(0x129)],'username':_0x14aeac[_0x34b9f6(0xb7)],'telegramId':_0x14aeac['telegram'],'merchantUrl':_0x14aeac[_0x34b9f6(0xc8)],'wallets':{'usdtPolygonWallet':_0x14aeac[_0x34b9f6(0x13f)],'usdtTrcWallet':_0x14aeac[_0x34b9f6(0xa6)],'usdtErcWallet':_0x14aeac[_0x34b9f6(0x140)],'usdcPolygonWallet':_0x14aeac['usdcPolygonWallet']},'totalAmountUSDT':Math[_0x34b9f6(0xb3)](_0x5658a7*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x34b9f6(0xb3)](_0x42b71a*0x64)/0x64,'paymentsCount':_0x5c4671[_0x34b9f6(0xe3)],'oldestPaymentDate':_0x31974e,'gatewayBreakdown':_0xcf1d28});}_0x2e4305[_0x34b9f6(0xe7)]((_0x4f9880,_0x53f6c4)=>_0x53f6c4['totalAmountAfterCommissionUSDT']-_0x4f9880[_0x34b9f6(0xc1)]);const _0x5c8981=_0x2e4305[_0x34b9f6(0xe3)],_0x5b1bfb=_0x2e4305['reduce']((_0x3d32c0,_0x8cdfb5)=>_0x3d32c0+_0x8cdfb5[_0x34b9f6(0xe8)],0x0),_0x16e2c2=_0x2e4305['reduce']((_0x3fa5c2,_0x563f0a)=>_0x3fa5c2+_0x563f0a[_0x34b9f6(0xc1)],0x0),_0x5584cd=(_0x268028-0x1)*_0x505509,_0x5ca280=_0x2e4305[_0x34b9f6(0x105)](_0x5584cd,_0x5584cd+_0x505509);return console['log']('‚úÖ\x20Returning\x20'+_0x5ca280[_0x34b9f6(0xe3)]+_0x34b9f6(0xf8)+_0x5c8981+_0x34b9f6(0x144)),console[_0x34b9f6(0xbb)](_0x34b9f6(0xb2)+_0x5b1bfb[_0x34b9f6(0xa8)](0x2)+_0x34b9f6(0xf6)+_0x16e2c2['toFixed'](0x2)+_0x34b9f6(0x12e)),{'merchants':_0x5ca280,'pagination':{'page':_0x268028,'limit':_0x505509,'total':_0x5c8981,'totalPages':Math[_0x34b9f6(0x11a)](_0x5c8981/_0x505509)},'summary':{'totalMerchants':_0x5c8981,'totalAmountUSDT':Math[_0x34b9f6(0xb3)](_0x5b1bfb*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x34b9f6(0xb3)](_0x16e2c2*0x64)/0x64}};}async[a33_0x148e1e(0xf7)](){const _0x4ce42a=a33_0x148e1e;console[_0x4ce42a(0xbb)](_0x4ce42a(0x124));const _0x8d3c87=await database_1[_0x4ce42a(0x135)]['payment'][_0x4ce42a(0x9e)]({'where':{'status':{'in':[_0x4ce42a(0xf1),_0x4ce42a(0x104),_0x4ce42a(0xd2)]}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'status':!![],'gateway':!![],'paidAt':!![],'merchantPaid':!![],'createdAt':!![],'chargebackAmount':!![],'shop':{'select':{'gatewaySettings':!![]}}}});console['log'](_0x4ce42a(0xa0)+_0x8d3c87[_0x4ce42a(0xe3)]+_0x4ce42a(0x11b));const _0x20e309=new Date(),_0x2d14e3=new Date(_0x20e309[_0x4ce42a(0xfe)](),_0x20e309[_0x4ce42a(0x8c)](),0x1),_0x31af5a=new Date(_0x20e309['getFullYear'](),_0x20e309[_0x4ce42a(0x8c)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7);let _0x23a96c=0x0,_0x16681d=0x0,_0x49ef80=0x0,_0x2a824e=0x0;for(const _0x495af6 of _0x8d3c87){const _0x138fe0=this[_0x4ce42a(0xa9)](_0x495af6);if(_0x138fe0===0x0)continue;let _0x316586,_0x2879a5;if(_0x495af6['status']===_0x4ce42a(0xd2))_0x316586=Math[_0x4ce42a(0x13d)](_0x138fe0),_0x2879a5=-_0x316586;else{_0x316586=await currencyService_1[_0x4ce42a(0x10e)][_0x4ce42a(0x154)](_0x495af6['amount'],_0x495af6[_0x4ce42a(0xdd)]);const _0xd93194=this[_0x4ce42a(0xd7)](_0x495af6[_0x4ce42a(0xcb)],_0x495af6['gateway']);_0x2879a5=this[_0x4ce42a(0x11d)](_0x316586,_0xd93194[_0x4ce42a(0x95)]);}_0x495af6['merchantPaid']&&(_0x23a96c+=_0x2879a5,_0x495af6[_0x4ce42a(0xa3)]&&_0x495af6[_0x4ce42a(0xa3)]>=_0x2d14e3&&_0x495af6['paidAt']<=_0x31af5a&&(_0x49ef80+=_0x2879a5)),_0x495af6[_0x4ce42a(0xec)]==='PAID'&&this[_0x4ce42a(0x138)](_0x495af6)&&(_0x16681d+=_0x2879a5,_0x2a824e+=_0x316586);}const _0x46213c={'totalPayout':Math[_0x4ce42a(0xb3)](_0x23a96c*0x64)/0x64,'awaitingPayout':Math[_0x4ce42a(0xb3)](_0x16681d*0x64)/0x64,'thisMonth':Math[_0x4ce42a(0xb3)](_0x49ef80*0x64)/0x64,'availableBalance':Math[_0x4ce42a(0xb3)](_0x2a824e*0x64)/0x64};return console[_0x4ce42a(0xbb)]('‚úÖ\x20Payout\x20statistics\x20calculated:'),console[_0x4ce42a(0xbb)](_0x4ce42a(0xff)+_0x46213c[_0x4ce42a(0x142)]+_0x4ce42a(0xd6)),console[_0x4ce42a(0xbb)]('‚è≥\x20Awaiting\x20Payout:\x20'+_0x46213c['awaitingPayout']+_0x4ce42a(0xf3)),console[_0x4ce42a(0xbb)](_0x4ce42a(0x134)+_0x46213c['thisMonth']+_0x4ce42a(0x126)),console[_0x4ce42a(0xbb)]('üí∞\x20Available\x20Balance:\x20'+_0x46213c[_0x4ce42a(0x116)]+_0x4ce42a(0x126)),_0x46213c;}async[a33_0x148e1e(0x110)](_0x52d222){const _0x493fe8=a33_0x148e1e,_0x1944b8=this[_0x493fe8(0xc3)](_0x52d222),_0x126e35=new Date();_0x126e35[_0x493fe8(0xd9)](_0x126e35[_0x493fe8(0x14b)]()-_0x1944b8),console['log'](_0x493fe8(0xd3)+_0x52d222+'\x20('+_0x1944b8+_0x493fe8(0x11e));const _0x5af36d=await database_1[_0x493fe8(0x135)][_0x493fe8(0xcb)][_0x493fe8(0x88)]({'where':{'status':_0x493fe8(0x156)}}),_0x1f8239=await database_1[_0x493fe8(0x135)]['payment'][_0x493fe8(0x88)](),_0x38e663=await database_1['default'][_0x493fe8(0x121)][_0x493fe8(0x9e)]({'where':{'status':{'in':[_0x493fe8(0xf1),'REFUND',_0x493fe8(0xd2)]}},'select':{'amount':!![],'currency':!![],'status':!![],'chargebackAmount':!![],'createdAt':!![]}});console[_0x493fe8(0xbb)](_0x493fe8(0xa0)+_0x38e663[_0x493fe8(0xe3)]+_0x493fe8(0x12a));const _0x335242=await Promise['all'](_0x38e663['map'](async _0x5bb7fc=>{const _0x61d14a=_0x493fe8,_0x3feb5a=this[_0x61d14a(0xa9)](_0x5bb7fc);if(_0x3feb5a===0x0)return{'amount':0x0,'createdAt':_0x5bb7fc[_0x61d14a(0x153)]};let _0xafac5b;return _0x5bb7fc[_0x61d14a(0xec)]==='CHARGEBACK'?_0xafac5b=-Math[_0x61d14a(0x13d)](_0x3feb5a):_0xafac5b=await currencyService_1[_0x61d14a(0x10e)][_0x61d14a(0x154)](_0x5bb7fc[_0x61d14a(0xe4)],_0x5bb7fc[_0x61d14a(0xdd)]),{'amount':_0xafac5b,'createdAt':_0x5bb7fc['createdAt']};})),_0x1731fb=_0x335242['reduce']((_0x487f00,_0xff12b1)=>_0x487f00+_0xff12b1[_0x493fe8(0xe4)],0x0),_0x23e3be=_0x1f8239>0x0?_0x1731fb/_0x1f8239:0x0;console['log'](_0x493fe8(0x107)+_0x1731fb[_0x493fe8(0xa8)](0x2)+_0x493fe8(0xd6)),console[_0x493fe8(0xbb)](_0x493fe8(0xa2)+_0x23e3be[_0x493fe8(0xa8)](0x2)+'\x20USDT');const _0x2d28ed=await database_1['default'][_0x493fe8(0x98)]`
      SELECT 
        DATE(created_at) as date,
        array_agg(
          json_build_object(
            'amount', amount,
            'currency', currency,
            'status', status,
            'chargeback_amount', chargeback_amount
          )
        ) as payments
      FROM payments 
      WHERE created_at >= ${_0x126e35}
        AND status IN ('PAID', 'REFUND', 'CHARGEBACK')
      GROUP BY DATE(created_at)
      ORDER BY date ASC
    `;console[_0x493fe8(0xbb)](_0x493fe8(0x136)+_0x2d28ed[_0x493fe8(0xe3)]+'\x20days');const _0x2491bf=await Promise['all'](_0x2d28ed[_0x493fe8(0x90)](async _0x2073a3=>{const _0x38c4c3=_0x493fe8,_0x302387=await Promise[_0x38c4c3(0x13a)](_0x2073a3[_0x38c4c3(0xef)][_0x38c4c3(0x90)](async _0x2bbf1d=>{const _0x43cdbb=_0x38c4c3,_0x9776bb=this['calculateEffectiveAmount'](_0x2bbf1d);if(_0x9776bb===0x0)return 0x0;return _0x2bbf1d['status']===_0x43cdbb(0xd2)?-Math['abs'](_0x9776bb):await currencyService_1['currencyService']['convertToUSDT'](_0x2bbf1d[_0x43cdbb(0xe4)],_0x2bbf1d['currency']);})),_0x253d78=_0x302387[_0x38c4c3(0x14d)]((_0x2e7ab4,_0x47c598)=>_0x2e7ab4+_0x47c598,0x0);return{'date':_0x2073a3['date'][_0x38c4c3(0xe0)]()['split']('T')[0x0],'amount':_0x253d78};})),_0x3cd6fc=this[_0x493fe8(0xdf)](_0x126e35,new Date()),_0x5a864a=new Map(_0x2491bf[_0x493fe8(0x90)](_0x2ebf4a=>[_0x2ebf4a[_0x493fe8(0x91)],_0x2ebf4a[_0x493fe8(0xe4)]])),_0x2b70b4=_0x3cd6fc['map'](_0x3194ed=>({'date':_0x3194ed,'amount':_0x5a864a[_0x493fe8(0xab)](_0x3194ed)||0x0}));return console['log'](_0x493fe8(0xa5)),console['log'](_0x493fe8(0xb0)+_0x5af36d),console[_0x493fe8(0xbb)](_0x493fe8(0x8d)+_0x1f8239),console[_0x493fe8(0xbb)]('üìä\x20Daily\x20revenue\x20entries:\x20'+_0x2b70b4['length']),{'totalRevenue':Math[_0x493fe8(0xb3)](_0x1731fb*0x64)/0x64,'totalUsers':_0x5af36d,'totalPayments':_0x1f8239,'averagePayment':Math[_0x493fe8(0xb3)](_0x23e3be*0x64)/0x64,'dailyRevenue':_0x2b70b4};}async[a33_0x148e1e(0xfd)](_0x4f0eb4){const _0x55d391=a33_0x148e1e,{page:_0x5306f0,limit:_0x2b0a61,status:_0x3f1b51,gateway:_0x159946,shopId:_0x32f940,dateFrom:_0x52f3f4,dateTo:_0x6162e4,search:_0x2561b4}=_0x4f0eb4,_0x1d87b4=(_0x5306f0-0x1)*_0x2b0a61;console[_0x55d391(0xbb)](_0x55d391(0x148),_0x4f0eb4);const _0x239dfc={};_0x3f1b51&&(_0x239dfc['status']=_0x3f1b51[_0x55d391(0x152)]());if(_0x159946){if((0x0,gateway_1[_0x55d391(0xdb)])(_0x159946)){const _0x2c5e09=(0x0,gateway_1['getGatewayNameById'])(_0x159946);_0x2c5e09&&(_0x239dfc['gateway']=_0x2c5e09);}else _0x239dfc[_0x55d391(0x10b)]=_0x159946['toLowerCase']();}_0x32f940&&(_0x239dfc[_0x55d391(0x111)]=_0x32f940);(_0x52f3f4||_0x6162e4)&&(_0x239dfc[_0x55d391(0x153)]={},_0x52f3f4&&(_0x239dfc[_0x55d391(0x153)]['gte']=new Date(_0x52f3f4)),_0x6162e4&&(_0x239dfc['createdAt'][_0x55d391(0x13c)]=new Date(_0x6162e4)));_0x2561b4&&(_0x239dfc['OR']=[{'orderId':{'contains':_0x2561b4,'mode':_0x55d391(0xc0)}},{'gatewayOrderId':{'contains':_0x2561b4,'mode':_0x55d391(0xc0)}},{'gatewayPaymentId':{'contains':_0x2561b4,'mode':_0x55d391(0xc0)}},{'customerEmail':{'contains':_0x2561b4,'mode':'insensitive'}},{'customerName':{'contains':_0x2561b4,'mode':_0x55d391(0xc0)}},{'shop':{'name':{'contains':_0x2561b4,'mode':_0x55d391(0xc0)}}},{'shop':{'username':{'contains':_0x2561b4,'mode':_0x55d391(0xc0)}}}]);const [_0x105c44,_0x22104f]=await Promise[_0x55d391(0x13a)]([database_1[_0x55d391(0x135)]['payment'][_0x55d391(0x9e)]({'where':_0x239dfc,'skip':_0x1d87b4,'take':_0x2b0a61,'orderBy':{'createdAt':_0x55d391(0x9b)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default'][_0x55d391(0x121)][_0x55d391(0x88)]({'where':_0x239dfc})]);console[_0x55d391(0xbb)]('üìä\x20Found\x20'+_0x105c44[_0x55d391(0xe3)]+_0x55d391(0x10a)+_0x22104f+'\x20total');const _0x310e24=_0x105c44[_0x55d391(0x90)](_0x55c699=>({'id':_0x55c699['id'],'shopId':_0x55c699[_0x55d391(0x111)],'shopName':_0x55c699[_0x55d391(0xcb)][_0x55d391(0x129)],'shopUsername':_0x55c699[_0x55d391(0xcb)][_0x55d391(0xb7)],'gateway':_0x55c699[_0x55d391(0x10b)],'orderId':_0x55c699[_0x55d391(0x108)],'gatewayOrderId':_0x55c699['gatewayOrderId'],'amount':_0x55c699[_0x55d391(0xe4)],'currency':_0x55c699[_0x55d391(0xdd)],'sourceCurrency':_0x55c699[_0x55d391(0xe1)],'status':_0x55c699[_0x55d391(0xec)],'usage':_0x55c699['usage'],'externalPaymentUrl':_0x55c699[_0x55d391(0xfc)],'gatewayPaymentId':_0x55c699[_0x55d391(0xb6)],'customerEmail':_0x55c699[_0x55d391(0x149)],'customerName':_0x55c699[_0x55d391(0xd0)],'cardLast4':_0x55c699[_0x55d391(0x137)],'paymentMethod':_0x55c699[_0x55d391(0xeb)],'bankId':_0x55c699[_0x55d391(0x89)],'remitterIban':_0x55c699[_0x55d391(0xf0)],'remitterName':_0x55c699[_0x55d391(0x94)],'chargebackAmount':_0x55c699[_0x55d391(0x118)],'adminNotes':_0x55c699[_0x55d391(0xc5)],'statusChangedBy':_0x55c699[_0x55d391(0xa4)],'statusChangedAt':_0x55c699['statusChangedAt'],'createdAt':_0x55c699[_0x55d391(0x153)],'updatedAt':_0x55c699['updatedAt'],'expiresAt':_0x55c699[_0x55d391(0x123)]}));return{'payments':_0x310e24,'pagination':{'page':_0x5306f0,'limit':_0x2b0a61,'total':_0x22104f,'totalPages':Math[_0x55d391(0x11a)](_0x22104f/_0x2b0a61)}};}async['getPaymentById'](_0x202bca){const _0x2e5dac=a33_0x148e1e;console['log'](_0x2e5dac(0x112)+_0x202bca);const _0x3cf8ac=await database_1[_0x2e5dac(0x135)][_0x2e5dac(0x121)]['findUnique']({'where':{'id':_0x202bca},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}},'webhookLogs':{'orderBy':{'createdAt':'desc'},'take':0xa,'select':{'id':!![],'event':!![],'statusCode':!![],'retryCount':!![],'createdAt':!![]}}}});if(!_0x3cf8ac)return console[_0x2e5dac(0xbb)](_0x2e5dac(0xf4)+_0x202bca),null;return console[_0x2e5dac(0xbb)]('‚úÖ\x20Found\x20payment:\x20'+_0x3cf8ac['orderId']+'\x20('+_0x3cf8ac[_0x2e5dac(0xec)]+')'),{'id':_0x3cf8ac['id'],'shopId':_0x3cf8ac[_0x2e5dac(0x111)],'shopName':_0x3cf8ac[_0x2e5dac(0xcb)][_0x2e5dac(0x129)],'shopUsername':_0x3cf8ac['shop'][_0x2e5dac(0xb7)],'gateway':_0x3cf8ac['gateway'],'orderId':_0x3cf8ac[_0x2e5dac(0x108)],'gatewayOrderId':_0x3cf8ac[_0x2e5dac(0x159)],'amount':_0x3cf8ac[_0x2e5dac(0xe4)],'currency':_0x3cf8ac[_0x2e5dac(0xdd)],'sourceCurrency':_0x3cf8ac['sourceCurrency'],'status':_0x3cf8ac[_0x2e5dac(0xec)],'usage':_0x3cf8ac['usage'],'externalPaymentUrl':_0x3cf8ac['externalPaymentUrl'],'gatewayPaymentId':_0x3cf8ac[_0x2e5dac(0xb6)],'customerEmail':_0x3cf8ac[_0x2e5dac(0x149)],'customerName':_0x3cf8ac['customerName'],'cardLast4':_0x3cf8ac['cardLast4'],'paymentMethod':_0x3cf8ac[_0x2e5dac(0xeb)],'bankId':_0x3cf8ac[_0x2e5dac(0x89)],'remitterIban':_0x3cf8ac[_0x2e5dac(0xf0)],'remitterName':_0x3cf8ac['remitterName'],'chargebackAmount':_0x3cf8ac[_0x2e5dac(0x118)],'adminNotes':_0x3cf8ac[_0x2e5dac(0xc5)],'statusChangedBy':_0x3cf8ac[_0x2e5dac(0xa4)],'statusChangedAt':_0x3cf8ac[_0x2e5dac(0xd5)],'createdAt':_0x3cf8ac[_0x2e5dac(0x153)],'updatedAt':_0x3cf8ac[_0x2e5dac(0x143)],'expiresAt':_0x3cf8ac[_0x2e5dac(0x123)],'webhookLogs':_0x3cf8ac[_0x2e5dac(0x13e)]};}async[a33_0x148e1e(0x131)](_0x122891,_0x2d220a,_0x333a74,_0x4fcdf2){const _0x14f722=a33_0x148e1e;console[_0x14f722(0xbb)](_0x14f722(0x128)+_0x122891+_0x14f722(0x87)+_0x2d220a);const _0x2f637d=[_0x14f722(0x9c),'PROCESSING',_0x14f722(0xf1),_0x14f722(0xb8),'FAILED',_0x14f722(0x104),_0x14f722(0xd2)];if(!_0x2f637d[_0x14f722(0xcf)](_0x2d220a[_0x14f722(0x152)]()))throw new Error(_0x14f722(0x15b)+_0x2f637d[_0x14f722(0xba)](',\x20'));const _0x532947=await database_1[_0x14f722(0x135)]['payment'][_0x14f722(0xca)]({'where':{'id':_0x122891},'select':{'id':!![],'status':!![],'orderId':!![]}});if(!_0x532947)throw new Error(_0x14f722(0xc7));if(_0x2d220a[_0x14f722(0x152)]()==='CHARGEBACK'){if(!_0x4fcdf2||_0x4fcdf2<=0x0)throw new Error(_0x14f722(0x141));console['log'](_0x14f722(0xd8)+_0x4fcdf2+_0x14f722(0x14e));}const _0x5d3569={'status':_0x2d220a[_0x14f722(0x152)](),'updatedAt':new Date()};_0x333a74&&(_0x5d3569['adminNotes']=_0x333a74);_0x2d220a['toUpperCase']()==='CHARGEBACK'&&_0x4fcdf2&&(_0x5d3569[_0x14f722(0x118)]=_0x4fcdf2);const _0xe3cccf=await database_1[_0x14f722(0x135)][_0x14f722(0x121)]['update']({'where':{'id':_0x122891},'data':_0x5d3569,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});return await database_1[_0x14f722(0x135)][_0x14f722(0xe9)]['create']({'data':{'paymentId':_0x122891,'shopId':_0xe3cccf['shopId'],'event':_0x14f722(0x10c),'statusCode':0xc8,'responseBody':JSON[_0x14f722(0x8f)]({'oldStatus':_0x532947[_0x14f722(0xec)],'newStatus':_0x2d220a[_0x14f722(0x152)](),'notes':_0x333a74||null,'chargebackAmount':_0x4fcdf2||null,'timestamp':new Date()[_0x14f722(0xe0)]()})}}),console['log'](_0x14f722(0x93)+_0x532947['orderId']+_0x14f722(0xe6)+_0x532947[_0x14f722(0xec)]+_0x14f722(0x102)+_0x2d220a[_0x14f722(0x152)]()),_0x2d220a['toUpperCase']()==='CHARGEBACK'&&console[_0x14f722(0xbb)]('üí∏\x20Chargeback\x20penalty:\x20'+_0x4fcdf2+'\x20USDT\x20(will\x20be\x20deducted\x20from\x20merchant\x20balance)'),{'id':_0xe3cccf['id'],'shopId':_0xe3cccf[_0x14f722(0x111)],'shopName':_0xe3cccf[_0x14f722(0xcb)][_0x14f722(0x129)],'shopUsername':_0xe3cccf[_0x14f722(0xcb)][_0x14f722(0xb7)],'gateway':_0xe3cccf[_0x14f722(0x10b)],'orderId':_0xe3cccf[_0x14f722(0x108)],'gatewayOrderId':_0xe3cccf['gatewayOrderId'],'amount':_0xe3cccf[_0x14f722(0xe4)],'currency':_0xe3cccf[_0x14f722(0xdd)],'sourceCurrency':_0xe3cccf['sourceCurrency'],'status':_0xe3cccf[_0x14f722(0xec)],'usage':_0xe3cccf[_0x14f722(0x109)],'externalPaymentUrl':_0xe3cccf['externalPaymentUrl'],'gatewayPaymentId':_0xe3cccf['gatewayPaymentId'],'customerEmail':_0xe3cccf[_0x14f722(0x149)],'customerName':_0xe3cccf['customerName'],'cardLast4':_0xe3cccf[_0x14f722(0x137)],'paymentMethod':_0xe3cccf[_0x14f722(0xeb)],'bankId':_0xe3cccf[_0x14f722(0x89)],'remitterIban':_0xe3cccf[_0x14f722(0xf0)],'remitterName':_0xe3cccf[_0x14f722(0x94)],'chargebackAmount':_0xe3cccf[_0x14f722(0x118)],'adminNotes':_0xe3cccf[_0x14f722(0xc5)],'statusChangedBy':_0xe3cccf['statusChangedBy'],'statusChangedAt':_0xe3cccf[_0x14f722(0xd5)],'createdAt':_0xe3cccf[_0x14f722(0x153)],'updatedAt':_0xe3cccf[_0x14f722(0x143)],'expiresAt':_0xe3cccf[_0x14f722(0x123)]};}async[a33_0x148e1e(0x100)](_0x37ec23){const _0x4f3993=a33_0x148e1e,{page:_0xa1452f,limit:_0x1e06fa,status:_0x162e53}=_0x37ec23,_0x4a84a1=(_0xa1452f-0x1)*_0x1e06fa,_0x2b1d75={};_0x162e53&&(_0x2b1d75['status']=_0x162e53['toUpperCase']());console[_0x4f3993(0xbb)](_0x4f3993(0x119),{'page':_0xa1452f,'limit':_0x1e06fa,'status':_0x162e53,'where':_0x2b1d75});const [_0x4944ea,_0x5dac90]=await Promise[_0x4f3993(0x13a)]([database_1[_0x4f3993(0x135)]['shop'][_0x4f3993(0x9e)]({'where':_0x2b1d75,'skip':_0x4a84a1,'take':_0x1e06fa,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x4f3993(0x9b)}}),database_1[_0x4f3993(0x135)]['shop'][_0x4f3993(0x88)]({'where':_0x2b1d75})]);console[_0x4f3993(0xbb)]('üìä\x20Found\x20'+_0x4944ea[_0x4f3993(0xe3)]+'\x20users\x20out\x20of\x20'+_0x5dac90+_0x4f3993(0x144));const _0x17f5fe=_0x4944ea[_0x4f3993(0x90)](_0x579d0b=>({'id':_0x579d0b['id'],'fullName':_0x579d0b['name'],'username':_0x579d0b[_0x4f3993(0xb7)],'telegramId':_0x579d0b['telegram'],'merchantUrl':_0x579d0b[_0x4f3993(0xc8)],'gateways':_0x579d0b[_0x4f3993(0xc4)]?JSON['parse'](_0x579d0b[_0x4f3993(0xc4)]):null,'gatewaySettings':_0x579d0b[_0x4f3993(0x103)]?JSON[_0x4f3993(0xad)](_0x579d0b[_0x4f3993(0x103)]):null,'publicKey':_0x579d0b[_0x4f3993(0x12f)],'wallets':{'usdtPolygonWallet':_0x579d0b[_0x4f3993(0x13f)],'usdtTrcWallet':_0x579d0b['usdtTrcWallet'],'usdtErcWallet':_0x579d0b[_0x4f3993(0x140)],'usdcPolygonWallet':_0x579d0b[_0x4f3993(0xc6)]},'status':_0x579d0b[_0x4f3993(0xec)],'createdAt':_0x579d0b[_0x4f3993(0x153)]}));return{'users':_0x17f5fe,'pagination':{'page':_0xa1452f,'limit':_0x1e06fa,'total':_0x5dac90,'totalPages':Math['ceil'](_0x5dac90/_0x1e06fa)}};}async[a33_0x148e1e(0x139)](_0x5316f6){const _0x411206=a33_0x148e1e;return await this[_0x411206(0x155)][_0x411206(0x139)](_0x5316f6);}async['createUser'](_0x3a6902){return await this['userService']['createUser'](_0x3a6902);}async[a33_0x148e1e(0xc9)](_0x513214,_0xaa8183){const _0x4ac3d6=a33_0x148e1e;return await this[_0x4ac3d6(0x155)][_0x4ac3d6(0xc9)](_0x513214,_0xaa8183);}async[a33_0x148e1e(0xaa)](_0x499f60){const _0x3c5cf2=a33_0x148e1e;return await this[_0x3c5cf2(0x155)]['deleteUser'](_0x499f60);}async[a33_0x148e1e(0x117)](_0x394993){const _0x41f2df=a33_0x148e1e;console['log'](_0x41f2df(0xdc)+_0x394993);const _0x543639=await database_1[_0x41f2df(0x135)][_0x41f2df(0xcb)][_0x41f2df(0xca)]({'where':{'id':_0x394993},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x543639)throw new Error(_0x41f2df(0x9a));if(_0x543639['status']===_0x41f2df(0x14a))throw new Error(_0x41f2df(0xaf));const _0x37c3bd=await this[_0x41f2df(0x155)]['updateUser'](_0x394993,{'status':_0x41f2df(0x14a)});return console[_0x41f2df(0xbb)](_0x41f2df(0x8a)+_0x543639[_0x41f2df(0xb7)]+'\x20suspended\x20successfully'),_0x37c3bd;}async[a33_0x148e1e(0x11c)](_0x2e18d2){const _0x5dab98=a33_0x148e1e;console[_0x5dab98(0xbb)](_0x5dab98(0x12c)+_0x2e18d2);const _0x2939f2=await database_1[_0x5dab98(0x135)][_0x5dab98(0xcb)]['findUnique']({'where':{'id':_0x2e18d2},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x2939f2)throw new Error('User\x20not\x20found');if(_0x2939f2[_0x5dab98(0xec)]===_0x5dab98(0x156))throw new Error(_0x5dab98(0xb9));const _0x2e2b3e=await this[_0x5dab98(0x155)][_0x5dab98(0xc9)](_0x2e18d2,{'status':'ACTIVE'});return console[_0x5dab98(0xbb)](_0x5dab98(0x8a)+_0x2939f2[_0x5dab98(0xb7)]+_0x5dab98(0xa7)),_0x2e2b3e;}}exports['AdminService']=AdminService;