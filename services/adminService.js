'use strict';function a35_0x1b84(_0x5c0498,_0x2d5b17){const _0x1f4ba2=a35_0x1f4b();return a35_0x1b84=function(_0x1b84a4,_0x53b316){_0x1b84a4=_0x1b84a4-0x13d;let _0x3cabf6=_0x1f4ba2[_0x1b84a4];return _0x3cabf6;},a35_0x1b84(_0x5c0498,_0x2d5b17);}const a35_0x40908e=a35_0x1b84;(function(_0x5b147f,_0x54c782){const _0x532684=a35_0x1b84,_0x543c33=_0x5b147f();while(!![]){try{const _0x5cfa06=-parseInt(_0x532684(0x1be))/0x1+parseInt(_0x532684(0x17c))/0x2+parseInt(_0x532684(0x1ee))/0x3*(parseInt(_0x532684(0x1ac))/0x4)+-parseInt(_0x532684(0x15b))/0x5+-parseInt(_0x532684(0x1c4))/0x6+parseInt(_0x532684(0x14b))/0x7+-parseInt(_0x532684(0x1c2))/0x8*(-parseInt(_0x532684(0x1da))/0x9);if(_0x5cfa06===_0x54c782)break;else _0x543c33['push'](_0x543c33['shift']());}catch(_0x5261e1){_0x543c33['push'](_0x543c33['shift']());}}}(a35_0x1f4b,0xd84fc));var __importDefault=this&&this[a35_0x40908e(0x1b7)]||function(_0x166a8f){const _0x27e1f3=a35_0x40908e;return _0x166a8f&&_0x166a8f[_0x27e1f3(0x161)]?_0x166a8f:{'default':_0x166a8f};};Object[a35_0x40908e(0x190)](exports,a35_0x40908e(0x161),{'value':!![]}),exports[a35_0x40908e(0x157)]=void 0x0;const database_1=__importDefault(require(a35_0x40908e(0x15a))),bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require('crypto')),currencyService_1=require(a35_0x40908e(0x1d0));class AdminService{async['getPayoutStats'](){const _0x3543f2=a35_0x40908e;console[_0x3543f2(0x174)](_0x3543f2(0x21a));const _0x2d4ca2=await database_1[_0x3543f2(0x1ba)][_0x3543f2(0x211)][_0x3543f2(0x1db)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x3543f2(0x180)}}),_0x1698cf=new Date(),_0x11c53a=new Date(_0x1698cf[_0x3543f2(0x146)](),_0x1698cf[_0x3543f2(0x16a)](),0x1),_0x5b9d04=new Date(_0x1698cf[_0x3543f2(0x146)](),_0x1698cf['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x1bc31f=await database_1['default'][_0x3543f2(0x13d)][_0x3543f2(0x1db)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x11c53a,'lte':_0x5b9d04},'status':_0x3543f2(0x13f)}}),_0x4ca8da=_0x2d4ca2[_0x3543f2(0x20f)][_0x3543f2(0x187)]||0x0,_0x4d8988=_0x2d4ca2[_0x3543f2(0x20f)][_0x3543f2(0x1bd)]||0x0,_0x28341e=_0x1bc31f['_sum'][_0x3543f2(0x214)]||0x0,_0x48005a={'totalPayout':Math[_0x3543f2(0x141)](_0x4ca8da*0x64)/0x64,'awaitingPayout':Math['round'](_0x4d8988*0x64)/0x64,'thisMonth':Math[_0x3543f2(0x141)](_0x28341e*0x64)/0x64,'availableBalance':Math[_0x3543f2(0x141)](_0x4d8988*0x64)/0x64};return console['log'](_0x3543f2(0x17b)),console[_0x3543f2(0x174)](_0x3543f2(0x215)+_0x48005a[_0x3543f2(0x217)]+_0x3543f2(0x193)),console[_0x3543f2(0x174)](_0x3543f2(0x1d8)+_0x48005a['awaitingPayout']+_0x3543f2(0x201)),console['log'](_0x3543f2(0x19f)+_0x48005a[_0x3543f2(0x164)]+_0x3543f2(0x1f6)),console[_0x3543f2(0x174)](_0x3543f2(0x1cf)+_0x48005a['thisMonth']+_0x3543f2(0x1b8)),_0x48005a;}async[a35_0x40908e(0x19b)](_0x3492a4,_0x2cc2d5){const _0x1916be=a35_0x40908e;console['log'](_0x1916be(0x1ca)+_0x3492a4+':',_0x2cc2d5);const _0x1d73fc=await database_1[_0x1916be(0x1ba)][_0x1916be(0x198)][_0x1916be(0x1ef)]({'where':{'id':_0x3492a4},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x1d73fc)throw new Error(_0x1916be(0x1a7));const _0x388cad={};_0x2cc2d5[_0x1916be(0x208)]!==undefined&&(_0x388cad['customerCountry']=_0x2cc2d5[_0x1916be(0x208)]||null);_0x2cc2d5[_0x1916be(0x172)]!==undefined&&(_0x388cad[_0x1916be(0x172)]=_0x2cc2d5['customerIp']||null);_0x2cc2d5['customerUa']!==undefined&&(_0x388cad[_0x1916be(0x183)]=_0x2cc2d5[_0x1916be(0x183)]||null);const _0x5b0b5c=await database_1[_0x1916be(0x1ba)][_0x1916be(0x198)][_0x1916be(0x1b0)]({'where':{'id':_0x3492a4},'data':{..._0x388cad,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console['log'](_0x1916be(0x14c)+_0x3492a4),console[_0x1916be(0x174)]('\x20\x20\x20🌍\x20Country:\x20'+_0x1d73fc['customerCountry']+'\x20->\x20'+_0x5b0b5c['customerCountry']),console[_0x1916be(0x174)](_0x1916be(0x145)+_0x1d73fc[_0x1916be(0x172)]+_0x1916be(0x184)+_0x5b0b5c['customerIp']),console[_0x1916be(0x174)](_0x1916be(0x1cb)+(_0x1d73fc[_0x1916be(0x183)]?_0x1916be(0x1e3):_0x1916be(0x1f1))+_0x1916be(0x184)+(_0x5b0b5c['customerUa']?_0x1916be(0x1e3):_0x1916be(0x1f1))),_0x5b0b5c;}async[a35_0x40908e(0x16b)](_0x1e50b1){const _0x52f40a=a35_0x40908e,_0x5ae9b4=new Date();let _0x2e68c7;switch(_0x1e50b1){case'7d':_0x2e68c7=new Date(_0x5ae9b4[_0x52f40a(0x196)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x52f40a(0x1a0):_0x2e68c7=new Date(_0x5ae9b4[_0x52f40a(0x196)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'90d':_0x2e68c7=new Date(_0x5ae9b4['getTime']()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x2e68c7=new Date(_0x5ae9b4[_0x52f40a(0x196)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x5517e4,_0x2b55ac,_0x5de329,_0x2dba2b,_0x2aa63e,_0x4dffb3]=await Promise[_0x52f40a(0x1c7)]([database_1['default'][_0x52f40a(0x211)][_0x52f40a(0x1d6)](),database_1['default'][_0x52f40a(0x211)][_0x52f40a(0x1d6)]({'where':{'status':'ACTIVE'}}),database_1[_0x52f40a(0x1ba)][_0x52f40a(0x198)][_0x52f40a(0x1d6)]({'where':{'createdAt':{'gte':_0x2e68c7},'gateway':{'not':_0x52f40a(0x209)}}}),database_1[_0x52f40a(0x1ba)][_0x52f40a(0x198)][_0x52f40a(0x1d6)]({'where':{'status':'PAID','createdAt':{'gte':_0x2e68c7},'gateway':{'not':'test_gateway'}}}),database_1[_0x52f40a(0x1ba)]['payment'][_0x52f40a(0x1a5)]({'where':{'status':_0x52f40a(0x1a1),'createdAt':{'gte':_0x2e68c7},'gateway':{'not':_0x52f40a(0x209)}},'select':{'amount':!![],'currency':!![]}}),database_1[_0x52f40a(0x1ba)][_0x52f40a(0x198)][_0x52f40a(0x1a5)]({'where':{'gateway':{'not':_0x52f40a(0x209)}},'take':0xa,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}})]);let _0x42e8ce=0x0;for(const _0x9d4fc9 of _0x2aa63e){const _0x5163c1=await currencyService_1[_0x52f40a(0x17e)][_0x52f40a(0x202)](_0x9d4fc9['amount'],_0x9d4fc9[_0x52f40a(0x1d9)]);_0x42e8ce+=_0x5163c1;}const _0x380e48=_0x5de329>0x0?_0x2dba2b/_0x5de329*0x64:0x0;return{'totalShops':_0x5517e4,'activeShops':_0x2b55ac,'totalPayments':_0x5de329,'successfulPayments':_0x2dba2b,'totalRevenue':Math[_0x52f40a(0x141)](_0x42e8ce*0x64)/0x64,'conversionRate':Math[_0x52f40a(0x141)](_0x380e48*0x64)/0x64,'recentPayments':_0x4dffb3[_0x52f40a(0x1fd)](_0x54b7a6=>({'id':_0x54b7a6['id'],'amount':_0x54b7a6[_0x52f40a(0x214)],'currency':_0x54b7a6[_0x52f40a(0x1d9)],'status':_0x54b7a6[_0x52f40a(0x1ea)],'gateway':_0x54b7a6[_0x52f40a(0x158)],'shop':_0x54b7a6[_0x52f40a(0x211)],'createdAt':_0x54b7a6[_0x52f40a(0x1fb)]}))};}async[a35_0x40908e(0x1ff)](_0x10b84b){const _0x542349=a35_0x40908e;console[_0x542349(0x174)](_0x542349(0x150),_0x10b84b);let _0x47677e,_0x4cdd93=new Date();if(_0x10b84b[_0x542349(0x173)]===_0x542349(0x20d)&&_0x10b84b[_0x542349(0x144)]&&_0x10b84b[_0x542349(0x1de)])_0x47677e=new Date(_0x10b84b[_0x542349(0x144)]),_0x4cdd93=new Date(_0x10b84b['dateTo']);else{const _0x1143b5=new Date();switch(_0x10b84b[_0x542349(0x173)]){case _0x542349(0x1d1):_0x47677e=new Date(_0x1143b5[_0x542349(0x196)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x542349(0x17d):_0x47677e=new Date(_0x1143b5[_0x542349(0x196)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x542349(0x160):_0x47677e=new Date(_0x1143b5[_0x542349(0x196)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x542349(0x1c7):default:_0x47677e=new Date(_0x542349(0x19e));break;}}console['log'](_0x542349(0x16d)+_0x47677e[_0x542349(0x18e)]()+_0x542349(0x140)+_0x4cdd93[_0x542349(0x18e)]());const _0x146c45={'status':'PAID','gateway':{'not':'test_gateway'},'paidAt':{'gte':_0x47677e,'lte':_0x4cdd93}};_0x10b84b[_0x542349(0x1ae)]&&(_0x146c45[_0x542349(0x1ae)]=_0x10b84b[_0x542349(0x1ae)]);const _0x516b5d=await database_1[_0x542349(0x1ba)][_0x542349(0x198)]['findMany']({'where':_0x146c45,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x542349(0x174)](_0x542349(0x1e2)+_0x516b5d['length']+_0x542349(0x1fe));let _0x39e824=0x0,_0x155c67=0x0,_0x58a652=0x0;const _0x104af3={},_0x450428={},_0x20d199={};for(const _0x4a46e9 of _0x516b5d){try{const _0x3ea844=await currencyService_1[_0x542349(0x17e)][_0x542349(0x202)](_0x4a46e9[_0x542349(0x214)],_0x4a46e9['currency']);let _0x5806ee={};if(_0x4a46e9[_0x542349(0x211)][_0x542349(0x13e)])try{_0x5806ee=JSON['parse'](_0x4a46e9[_0x542349(0x211)][_0x542349(0x13e)]);}catch(_0x73be5e){console[_0x542349(0x181)](_0x542349(0x1b4)+_0x4a46e9[_0x542349(0x1ae)]+':',_0x73be5e);}const _0x4437d9=_0x5806ee[_0x542349(0x1d7)]||0xa,_0x2d0fb2=_0x3ea844*(_0x4437d9/0x64),_0x4686f5=_0x3ea844-_0x2d0fb2;_0x39e824+=_0x3ea844,_0x155c67+=_0x4686f5,_0x58a652+=_0x2d0fb2;!_0x104af3[_0x4a46e9['gateway']]&&(_0x104af3[_0x4a46e9[_0x542349(0x158)]]={'gateway':_0x4a46e9[_0x542349(0x158)],'gatewayDisplayName':this['getGatewayDisplayName'](_0x4a46e9[_0x542349(0x158)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x104af3[_0x4a46e9[_0x542349(0x158)]][_0x542349(0x19a)]++,_0x104af3[_0x4a46e9[_0x542349(0x158)]][_0x542349(0x1ed)]+=_0x3ea844,_0x104af3[_0x4a46e9[_0x542349(0x158)]][_0x542349(0x195)]+=_0x2d0fb2,_0x104af3[_0x4a46e9['gateway']][_0x542349(0x1c0)]+=_0x4686f5,_0x104af3[_0x4a46e9[_0x542349(0x158)]][_0x542349(0x18a)]+=_0x4437d9;!_0x10b84b[_0x542349(0x1ae)]&&(!_0x450428[_0x4a46e9[_0x542349(0x1ae)]]&&(_0x450428[_0x4a46e9['shopId']]={'shopId':_0x4a46e9[_0x542349(0x1ae)],'shopName':_0x4a46e9[_0x542349(0x211)]['name'],'shopUsername':_0x4a46e9[_0x542349(0x211)]['username'],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x450428[_0x4a46e9[_0x542349(0x1ae)]][_0x542349(0x19a)]++,_0x450428[_0x4a46e9[_0x542349(0x1ae)]][_0x542349(0x1ed)]+=_0x3ea844,_0x450428[_0x4a46e9[_0x542349(0x1ae)]][_0x542349(0x195)]+=_0x2d0fb2,_0x450428[_0x4a46e9[_0x542349(0x1ae)]]['merchantEarningsUSDT']+=_0x4686f5);const _0x5d074c=_0x4a46e9[_0x542349(0x1b5)]['toISOString']()[_0x542349(0x213)]('T')[0x0];!_0x20d199[_0x5d074c]&&(_0x20d199[_0x5d074c]={'date':_0x5d074c,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x20d199[_0x5d074c][_0x542349(0x1f4)]+=_0x3ea844,_0x20d199[_0x5d074c][_0x542349(0x205)]+=_0x4686f5,_0x20d199[_0x5d074c]['gatewayEarnings']+=_0x2d0fb2,_0x20d199[_0x5d074c][_0x542349(0x19a)]++;}catch(_0x3dddcc){console[_0x542349(0x181)](_0x542349(0x1ec)+_0x4a46e9['id']+':',_0x3dddcc);}}Object['values'](_0x104af3)['forEach'](_0xeae1be=>{const _0x506203=_0x542349;_0xeae1be[_0x506203(0x203)]=_0xeae1be[_0x506203(0x19a)]>0x0?_0xeae1be['totalCommissionRate']/_0xeae1be[_0x506203(0x19a)]:0x0,delete _0xeae1be[_0x506203(0x18a)];}),Object['values'](_0x450428)[_0x542349(0x1f7)](_0x2dfb0c=>{const _0x522810=_0x542349;_0x2dfb0c[_0x522810(0x1c1)]=_0x2dfb0c[_0x522810(0x19a)]>0x0?_0x2dfb0c[_0x522810(0x1ed)]/_0x2dfb0c[_0x522810(0x19a)]:0x0;});let _0x54ac99=0x0;if(_0x10b84b[_0x542349(0x1ae)]){const _0x12b763=await database_1[_0x542349(0x1ba)][_0x542349(0x13d)][_0x542349(0x1a5)]({'where':{'shopId':_0x10b84b[_0x542349(0x1ae)],'status':_0x542349(0x13f),'createdAt':{'gte':_0x47677e,'lte':_0x4cdd93}},'select':{'amount':!![]}});_0x54ac99=_0x12b763[_0x542349(0x1d5)]((_0x33d85b,_0xfba108)=>_0x33d85b+_0xfba108[_0x542349(0x214)],0x0);}const _0x360744=_0x516b5d[_0x542349(0x16f)],_0x5ea66c=_0x516b5d[_0x542349(0x16f)],_0x478951=_0x360744>0x0?_0x39e824/_0x360744:0x0,_0x11b7fc=0x64,_0x2b421a=Math['ceil']((_0x4cdd93[_0x542349(0x196)]()-_0x47677e[_0x542349(0x196)]())/(0x3e8*0x3c*0x3c*0x18)),_0x5e0cd7={'totalTurnover':Math[_0x542349(0x141)](_0x39e824*0x64)/0x64,'merchantEarnings':Math[_0x542349(0x141)](_0x155c67*0x64)/0x64,'gatewayEarnings':Math[_0x542349(0x141)](_0x58a652*0x64)/0x64,'totalPaidOut':Math[_0x542349(0x141)](_0x54ac99*0x64)/0x64,'averageCheck':Math[_0x542349(0x141)](_0x478951*0x64)/0x64,'totalPayments':_0x360744,'successfulPayments':_0x5ea66c,'conversionRate':_0x11b7fc,'gatewayBreakdown':Object[_0x542349(0x1eb)](_0x104af3)[_0x542349(0x1fd)](_0x3dbe07=>({..._0x3dbe07,'turnoverUSDT':Math[_0x542349(0x141)](_0x3dbe07['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math['round'](_0x3dbe07[_0x542349(0x195)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x3dbe07[_0x542349(0x1c0)]*0x64)/0x64,'averageCommissionRate':Math[_0x542349(0x141)](_0x3dbe07[_0x542349(0x203)]*0x64)/0x64})),'merchantBreakdown':_0x10b84b[_0x542349(0x1ae)]?undefined:Object[_0x542349(0x1eb)](_0x450428)[_0x542349(0x1fd)](_0x2e81aa=>({..._0x2e81aa,'turnoverUSDT':Math[_0x542349(0x141)](_0x2e81aa[_0x542349(0x1ed)]*0x64)/0x64,'commissionUSDT':Math[_0x542349(0x141)](_0x2e81aa[_0x542349(0x195)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x2e81aa[_0x542349(0x1c0)]*0x64)/0x64,'paidOutUSDT':Math['round'](_0x2e81aa['paidOutUSDT']*0x64)/0x64,'averageCheckUSDT':Math[_0x542349(0x141)](_0x2e81aa['averageCheckUSDT']*0x64)/0x64})),'dailyData':Object['values'](_0x20d199)[_0x542349(0x1fd)](_0x10c553=>({..._0x10c553,'turnover':Math[_0x542349(0x141)](_0x10c553['turnover']*0x64)/0x64,'merchantEarnings':Math[_0x542349(0x141)](_0x10c553[_0x542349(0x205)]*0x64)/0x64,'gatewayEarnings':Math['round'](_0x10c553[_0x542349(0x1b1)]*0x64)/0x64}))[_0x542349(0x1a8)]((_0x37493a,_0x41f5b6)=>_0x37493a['date'][_0x542349(0x16c)](_0x41f5b6['date'])),'periodInfo':{'from':_0x47677e,'to':_0x4cdd93,'periodType':_0x10b84b[_0x542349(0x173)]||_0x542349(0x20d),'daysCount':_0x2b421a}};return console[_0x542349(0x174)](_0x542349(0x21b)),console[_0x542349(0x174)](_0x542349(0x14d)+_0x5e0cd7[_0x542349(0x186)]+_0x542349(0x1b8)),console[_0x542349(0x174)]('\x20\x20\x20👤\x20Merchant\x20earnings:\x20'+_0x5e0cd7['merchantEarnings']+_0x542349(0x1b8)),console[_0x542349(0x174)](_0x542349(0x197)+_0x5e0cd7[_0x542349(0x1b1)]+_0x542349(0x1b8)),console['log'](_0x542349(0x15f)+_0x5e0cd7[_0x542349(0x154)]),_0x5e0cd7;}[a35_0x40908e(0x1a4)](_0x1c0135){const _0x2cc96e=a35_0x40908e,_0x12a26c={'test_gateway':_0x2cc96e(0x194),'plisio':'Plisio','rapyd':'Rapyd','noda':_0x2cc96e(0x192),'cointopay':'CoinToPay','klyme_eu':_0x2cc96e(0x15e),'klyme_gb':_0x2cc96e(0x178),'klyme_de':_0x2cc96e(0x159)};return _0x12a26c[_0x1c0135]||_0x1c0135;}async[a35_0x40908e(0x188)](_0x1d665b){const _0x4ba58e=a35_0x40908e,{page:_0x59d8f5,limit:_0x10b5e7,minAmount:_0x59ee91,search:_0x236e05}=_0x1d665b,_0x3b19e8=(_0x59d8f5-0x1)*_0x10b5e7;console['log'](_0x4ba58e(0x14e),_0x1d665b);const _0x5ce4c5={'balance':{'gt':0x0},'status':_0x4ba58e(0x180)};_0x59ee91&&(_0x5ce4c5['balance']['gte']=_0x59ee91);_0x236e05&&(_0x5ce4c5['OR']=[{'name':{'contains':_0x236e05,'mode':_0x4ba58e(0x20a)}},{'username':{'contains':_0x236e05,'mode':_0x4ba58e(0x20a)}}]);const [_0x26efba,_0x4ea175]=await Promise[_0x4ba58e(0x1c7)]([database_1[_0x4ba58e(0x1ba)]['shop'][_0x4ba58e(0x1a5)]({'where':_0x5ce4c5,'skip':_0x3b19e8,'take':_0x10b5e7,'orderBy':{'balance':_0x4ba58e(0x17a)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'createdAt':!![]}}),database_1[_0x4ba58e(0x1ba)][_0x4ba58e(0x211)][_0x4ba58e(0x1d6)]({'where':_0x5ce4c5})]);console[_0x4ba58e(0x174)](_0x4ba58e(0x1e2)+_0x26efba[_0x4ba58e(0x16f)]+_0x4ba58e(0x1e9));const _0x2975fa=await Promise[_0x4ba58e(0x1c7)](_0x26efba['map'](async _0x1cbd2c=>{const _0x52af9a=_0x4ba58e,[_0x2c2405,_0x57ecf6,_0x36bb47]=await Promise['all']([database_1[_0x52af9a(0x1ba)][_0x52af9a(0x198)][_0x52af9a(0x1d6)]({'where':{'shopId':_0x1cbd2c['id'],'status':'PAID','amountUSDT':{'not':null}}}),database_1[_0x52af9a(0x1ba)][_0x52af9a(0x198)][_0x52af9a(0x18b)]({'where':{'shopId':_0x1cbd2c['id'],'status':_0x52af9a(0x1a1),'amountUSDT':{'not':null}},'orderBy':{'paidAt':_0x52af9a(0x14f)},'select':{'paidAt':!![]}}),database_1[_0x52af9a(0x1ba)][_0x52af9a(0x198)][_0x52af9a(0x1f9)]({'by':[_0x52af9a(0x158)],'where':{'shopId':_0x1cbd2c['id'],'status':_0x52af9a(0x1a1),'amountUSDT':{'not':null}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x4cad29=_0x36bb47['map'](_0x13905b=>({'gateway':_0x13905b[_0x52af9a(0x158)],'count':_0x13905b[_0x52af9a(0x185)]['id'],'amountUSDT':_0x13905b[_0x52af9a(0x20f)][_0x52af9a(0x1c5)]||0x0,'amountAfterCommissionUSDT':_0x13905b[_0x52af9a(0x20f)][_0x52af9a(0x1c5)]||0x0,'commission':0x0}));return{'id':_0x1cbd2c['id'],'fullName':_0x1cbd2c[_0x52af9a(0x171)],'username':_0x1cbd2c['username'],'telegramId':_0x1cbd2c[_0x52af9a(0x1af)],'merchantUrl':_0x1cbd2c['shopUrl'],'wallets':{'usdtPolygonWallet':_0x1cbd2c[_0x52af9a(0x162)],'usdtTrcWallet':_0x1cbd2c[_0x52af9a(0x1e7)],'usdtErcWallet':_0x1cbd2c[_0x52af9a(0x18c)],'usdcPolygonWallet':_0x1cbd2c[_0x52af9a(0x218)]},'totalAmountUSDT':_0x1cbd2c['balance'],'totalAmountAfterCommissionUSDT':_0x1cbd2c[_0x52af9a(0x1bd)],'paymentsCount':_0x2c2405,'oldestPaymentDate':_0x57ecf6?.[_0x52af9a(0x1b5)]||_0x1cbd2c[_0x52af9a(0x1fb)],'gatewayBreakdown':_0x4cad29};})),_0x126234=_0x26efba['reduce']((_0x3ee582,_0x3a07b9)=>_0x3ee582+_0x3a07b9[_0x4ba58e(0x1bd)],0x0),_0x356f27=_0x126234;return console[_0x4ba58e(0x174)](_0x4ba58e(0x1e4)+_0x4ea175+_0x4ba58e(0x156)+Math['round'](_0x356f27*0x64)/0x64+_0x4ba58e(0x1e0)),{'merchants':_0x2975fa,'pagination':{'page':_0x59d8f5,'limit':_0x10b5e7,'total':_0x4ea175,'totalPages':Math[_0x4ba58e(0x1f3)](_0x4ea175/_0x10b5e7)},'summary':{'totalMerchants':_0x4ea175,'totalAmountUSDT':Math[_0x4ba58e(0x141)](_0x126234*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x4ba58e(0x141)](_0x356f27*0x64)/0x64}};}async[a35_0x40908e(0x1b3)](_0x38fbf9){const _0x1f8945=a35_0x40908e,{shopId:_0x9cac06,amount:_0x558427,network:_0x3a665b,notes:_0x20201c,periodFrom:_0x5d176c,periodTo:_0x24223e}=_0x38fbf9,_0x2167bc=await database_1[_0x1f8945(0x1ba)][_0x1f8945(0x1c9)](async _0x4e26c9=>{const _0x1ff16f=_0x1f8945,_0x5f4344=await _0x4e26c9[_0x1ff16f(0x211)][_0x1ff16f(0x1ef)]({'where':{'id':_0x9cac06},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x5f4344)throw new Error(_0x1ff16f(0x179));console['log'](_0x1ff16f(0x155)+_0x5f4344[_0x1ff16f(0x182)]+':'),console['log'](_0x1ff16f(0x1c8)+_0x5f4344[_0x1ff16f(0x1bd)][_0x1ff16f(0x1b2)](0x6)+_0x1ff16f(0x1b8)),console[_0x1ff16f(0x174)](_0x1ff16f(0x151)+_0x558427['toFixed'](0x6)+_0x1ff16f(0x1b8)),console[_0x1ff16f(0x174)](_0x1ff16f(0x165)+_0x5f4344[_0x1ff16f(0x187)]['toFixed'](0x6)+_0x1ff16f(0x1b8));if(_0x5f4344[_0x1ff16f(0x1bd)]<_0x558427)throw new Error(_0x1ff16f(0x20c)+_0x5f4344[_0x1ff16f(0x1bd)][_0x1ff16f(0x1b2)](0x6)+'\x20USDT,\x20Requested:\x20'+_0x558427[_0x1ff16f(0x1b2)](0x6)+'\x20USDT');const _0x2fafaf=await _0x4e26c9[_0x1ff16f(0x13d)][_0x1ff16f(0x1dd)]({'data':{'shopId':_0x9cac06,'amount':_0x558427,'network':_0x3a665b,'status':_0x1ff16f(0x13f),'notes':_0x20201c,'periodFrom':_0x5d176c?new Date(_0x5d176c):null,'periodTo':_0x24223e?new Date(_0x24223e):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x292b9b=_0x5f4344['balance']-_0x558427,_0x553553=_0x5f4344[_0x1ff16f(0x187)]+_0x558427;return await _0x4e26c9[_0x1ff16f(0x211)][_0x1ff16f(0x1b0)]({'where':{'id':_0x9cac06},'data':{'balance':_0x292b9b,'totalPaidOut':_0x553553}}),console[_0x1ff16f(0x174)](_0x1ff16f(0x1e6)+_0x5f4344[_0x1ff16f(0x182)]+_0x1ff16f(0x1e8)),console[_0x1ff16f(0x174)](_0x1ff16f(0x1d3)+_0x5f4344[_0x1ff16f(0x1bd)][_0x1ff16f(0x1b2)](0x6)+_0x1ff16f(0x184)+_0x292b9b[_0x1ff16f(0x1b2)](0x6)+_0x1ff16f(0x142)+_0x558427[_0x1ff16f(0x1b2)](0x6)+')'),console['log'](_0x1ff16f(0x216)+_0x5f4344[_0x1ff16f(0x187)]['toFixed'](0x6)+_0x1ff16f(0x184)+_0x553553['toFixed'](0x6)+_0x1ff16f(0x148)+_0x558427[_0x1ff16f(0x1b2)](0x6)+')'),{'payout':_0x2fafaf,'shop':_0x5f4344};});return console[_0x1f8945(0x174)](_0x1f8945(0x1f5)+_0x2167bc[_0x1f8945(0x13d)]['id']+_0x1f8945(0x1dc)+_0x2167bc[_0x1f8945(0x211)][_0x1f8945(0x182)]+'\x20('+_0x558427+_0x1f8945(0x153)),{'id':_0x2167bc[_0x1f8945(0x13d)]['id'],'shopId':_0x2167bc['payout'][_0x1f8945(0x1ae)],'shopName':_0x2167bc[_0x1f8945(0x211)][_0x1f8945(0x171)],'shopUsername':_0x2167bc[_0x1f8945(0x211)][_0x1f8945(0x182)],'amount':_0x2167bc[_0x1f8945(0x13d)][_0x1f8945(0x214)],'network':_0x2167bc[_0x1f8945(0x13d)][_0x1f8945(0x189)],'status':_0x2167bc['payout']['status'],'txid':_0x2167bc[_0x1f8945(0x13d)][_0x1f8945(0x149)],'notes':_0x2167bc[_0x1f8945(0x13d)][_0x1f8945(0x1a3)],'periodFrom':_0x2167bc['payout'][_0x1f8945(0x204)],'periodTo':_0x2167bc['payout']['periodTo'],'createdAt':_0x2167bc[_0x1f8945(0x13d)]['createdAt'],'paidAt':_0x2167bc[_0x1f8945(0x13d)]['paidAt']};}async[a35_0x40908e(0x206)](_0x55ebde){const _0x2a6cc4=a35_0x40908e,{page:_0x455006,limit:_0x3da1e3,shopId:_0x2354b2,network:_0x41eba3,dateFrom:_0xcb0364,dateTo:_0x4e3efc,search:_0x21d594}=_0x55ebde,_0x2fe886=(_0x455006-0x1)*_0x3da1e3,_0x4b5420={};_0x2354b2&&(_0x4b5420[_0x2a6cc4(0x1ae)]=_0x2354b2);_0x41eba3&&(_0x4b5420[_0x2a6cc4(0x189)]=_0x41eba3);(_0xcb0364||_0x4e3efc)&&(_0x4b5420[_0x2a6cc4(0x1fb)]={},_0xcb0364&&(_0x4b5420[_0x2a6cc4(0x1fb)]['gte']=new Date(_0xcb0364)),_0x4e3efc&&(_0x4b5420[_0x2a6cc4(0x1fb)][_0x2a6cc4(0x18f)]=new Date(_0x4e3efc)));_0x21d594&&(_0x4b5420['OR']=[{'shop':{'name':{'contains':_0x21d594,'mode':_0x2a6cc4(0x20a)}}},{'shop':{'username':{'contains':_0x21d594,'mode':'insensitive'}}},{'notes':{'contains':_0x21d594,'mode':'insensitive'}}]);const [_0x5e71a8,_0x457b7a]=await Promise[_0x2a6cc4(0x1c7)]([database_1[_0x2a6cc4(0x1ba)][_0x2a6cc4(0x13d)][_0x2a6cc4(0x1a5)]({'where':_0x4b5420,'skip':_0x2fe886,'take':_0x3da1e3,'orderBy':{'createdAt':_0x2a6cc4(0x17a)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x2a6cc4(0x1ba)][_0x2a6cc4(0x13d)][_0x2a6cc4(0x1d6)]({'where':_0x4b5420})]);return{'payouts':_0x5e71a8[_0x2a6cc4(0x1fd)](_0x9bbfe7=>({'id':_0x9bbfe7['id'],'shopId':_0x9bbfe7[_0x2a6cc4(0x1ae)],'shopName':_0x9bbfe7[_0x2a6cc4(0x211)][_0x2a6cc4(0x171)],'shopUsername':_0x9bbfe7[_0x2a6cc4(0x211)][_0x2a6cc4(0x182)],'amount':_0x9bbfe7[_0x2a6cc4(0x214)],'network':_0x9bbfe7[_0x2a6cc4(0x189)],'status':_0x9bbfe7['status'],'txid':_0x9bbfe7['txid'],'notes':_0x9bbfe7['notes'],'periodFrom':_0x9bbfe7[_0x2a6cc4(0x204)],'periodTo':_0x9bbfe7[_0x2a6cc4(0x1f2)],'createdAt':_0x9bbfe7['createdAt'],'paidAt':_0x9bbfe7[_0x2a6cc4(0x1b5)]})),'pagination':{'page':_0x455006,'limit':_0x3da1e3,'total':_0x457b7a,'totalPages':Math[_0x2a6cc4(0x1f3)](_0x457b7a/_0x3da1e3)}};}async[a35_0x40908e(0x199)](_0x17c182){const _0xebe4f5=a35_0x40908e,_0x3ecfb5=await database_1['default'][_0xebe4f5(0x13d)][_0xebe4f5(0x1ef)]({'where':{'id':_0x17c182},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x3ecfb5)return null;return{'id':_0x3ecfb5['id'],'shopId':_0x3ecfb5['shopId'],'shopName':_0x3ecfb5[_0xebe4f5(0x211)][_0xebe4f5(0x171)],'shopUsername':_0x3ecfb5['shop']['username'],'amount':_0x3ecfb5[_0xebe4f5(0x214)],'network':_0x3ecfb5[_0xebe4f5(0x189)],'status':_0x3ecfb5[_0xebe4f5(0x1ea)],'txid':_0x3ecfb5[_0xebe4f5(0x149)],'notes':_0x3ecfb5[_0xebe4f5(0x1a3)],'periodFrom':_0x3ecfb5[_0xebe4f5(0x204)],'periodTo':_0x3ecfb5[_0xebe4f5(0x1f2)],'createdAt':_0x3ecfb5[_0xebe4f5(0x1fb)],'paidAt':_0x3ecfb5[_0xebe4f5(0x1b5)]};}async[a35_0x40908e(0x1a9)](_0x3b596e){const _0x5c49d7=a35_0x40908e;await database_1[_0x5c49d7(0x1ba)]['payout'][_0x5c49d7(0x1ce)]({'where':{'id':_0x3b596e}});}async['getAllPayments'](_0x1d0933){const _0xf11d19=a35_0x40908e,{page:_0x4269d7,limit:_0x49e168,status:_0x2c699c,gateway:_0x425174,shopId:_0x4027ce,dateFrom:_0x132433,dateTo:_0x5b9beb,search:_0x6ab3fc}=_0x1d0933,_0x43d211=(_0x4269d7-0x1)*_0x49e168,_0xb88a24={};_0x2c699c&&(_0xb88a24[_0xf11d19(0x1ea)]=_0x2c699c[_0xf11d19(0x191)]());_0x425174&&(_0xb88a24[_0xf11d19(0x158)]=_0x425174[_0xf11d19(0x15c)]());_0xb88a24[_0xf11d19(0x158)]=_0xb88a24[_0xf11d19(0x158)]?_0xb88a24['gateway']:{'not':_0xf11d19(0x209)};if(typeof _0xb88a24[_0xf11d19(0x158)]==='string'&&_0xb88a24[_0xf11d19(0x158)]!==_0xf11d19(0x209)){}else{if(typeof _0xb88a24[_0xf11d19(0x158)]===_0xf11d19(0x1c6)&&_0xb88a24[_0xf11d19(0x158)]==='test_gateway'){}else _0xb88a24[_0xf11d19(0x158)]={'not':'test_gateway'};}_0x4027ce&&(_0xb88a24[_0xf11d19(0x1ae)]=_0x4027ce);(_0x132433||_0x5b9beb)&&(_0xb88a24['createdAt']={},_0x132433&&(_0xb88a24[_0xf11d19(0x1fb)][_0xf11d19(0x15d)]=new Date(_0x132433)),_0x5b9beb&&(_0xb88a24[_0xf11d19(0x1fb)][_0xf11d19(0x18f)]=new Date(_0x5b9beb)));_0x6ab3fc&&(_0xb88a24['OR']=[{'orderId':{'contains':_0x6ab3fc,'mode':_0xf11d19(0x20a)}},{'gatewayOrderId':{'contains':_0x6ab3fc,'mode':_0xf11d19(0x20a)}},{'customerEmail':{'contains':_0x6ab3fc,'mode':_0xf11d19(0x20a)}},{'shop':{'name':{'contains':_0x6ab3fc,'mode':_0xf11d19(0x20a)}}},{'shop':{'username':{'contains':_0x6ab3fc,'mode':_0xf11d19(0x20a)}}}]);const [_0x539d96,_0x595260]=await Promise[_0xf11d19(0x1c7)]([database_1['default'][_0xf11d19(0x198)][_0xf11d19(0x1a5)]({'where':_0xb88a24,'skip':_0x43d211,'take':_0x49e168,'orderBy':{'createdAt':_0xf11d19(0x17a)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0xf11d19(0x1ba)][_0xf11d19(0x198)][_0xf11d19(0x1d6)]({'where':_0xb88a24})]);return{'payments':_0x539d96[_0xf11d19(0x1fd)](_0x444153=>({'id':_0x444153['id'],'shopId':_0x444153[_0xf11d19(0x1ae)],'gateway':_0x444153[_0xf11d19(0x158)],'amount':_0x444153[_0xf11d19(0x214)],'currency':_0x444153[_0xf11d19(0x1d9)],'status':_0x444153[_0xf11d19(0x1ea)],'orderId':_0x444153[_0xf11d19(0x1fa)],'gatewayOrderId':_0x444153[_0xf11d19(0x1ad)],'customerEmail':_0x444153[_0xf11d19(0x169)],'customerName':_0x444153[_0xf11d19(0x1bc)],'customerCountry':_0x444153['customerCountry'],'customerIp':_0x444153[_0xf11d19(0x172)],'customerUa':_0x444153[_0xf11d19(0x183)],'failureMessage':_0x444153[_0xf11d19(0x16e)],'createdAt':_0x444153[_0xf11d19(0x1fb)],'updatedAt':_0x444153[_0xf11d19(0x1fc)],'shop':_0x444153[_0xf11d19(0x211)]})),'pagination':{'page':_0x4269d7,'limit':_0x49e168,'total':_0x595260,'totalPages':Math[_0xf11d19(0x1f3)](_0x595260/_0x49e168)}};}async['getPaymentById'](_0x3ff812){const _0x19eeee=a35_0x40908e,_0x2745f0=await database_1['default'][_0x19eeee(0x198)][_0x19eeee(0x1ef)]({'where':{'id':_0x3ff812},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x2745f0)return null;return{'id':_0x2745f0['id'],'shopId':_0x2745f0[_0x19eeee(0x1ae)],'gateway':_0x2745f0[_0x19eeee(0x158)],'amount':_0x2745f0['amount'],'currency':_0x2745f0[_0x19eeee(0x1d9)],'status':_0x2745f0['status'],'orderId':_0x2745f0[_0x19eeee(0x1fa)],'gatewayOrderId':_0x2745f0[_0x19eeee(0x1ad)],'customerEmail':_0x2745f0[_0x19eeee(0x169)],'customerName':_0x2745f0[_0x19eeee(0x1bc)],'customerCountry':_0x2745f0['customerCountry'],'customerIp':_0x2745f0[_0x19eeee(0x172)],'customerUa':_0x2745f0[_0x19eeee(0x183)],'failureMessage':_0x2745f0['failureMessage'],'externalPaymentUrl':_0x2745f0[_0x19eeee(0x17f)],'successUrl':_0x2745f0[_0x19eeee(0x176)],'failUrl':_0x2745f0[_0x19eeee(0x1cd)],'pendingUrl':_0x2745f0[_0x19eeee(0x1c3)],'whiteUrl':_0x2745f0[_0x19eeee(0x14a)],'createdAt':_0x2745f0['createdAt'],'updatedAt':_0x2745f0[_0x19eeee(0x1fc)],'shop':_0x2745f0[_0x19eeee(0x211)]};}async[a35_0x40908e(0x1d4)](_0x495f25,_0x320bb5,_0x602e40,_0x38c168){const _0x3bcf3e=a35_0x40908e,_0x23d518=await database_1[_0x3bcf3e(0x1ba)][_0x3bcf3e(0x1c9)](async _0x48f575=>{const _0xf63201=_0x3bcf3e,_0x1e8f0a=await _0x48f575[_0xf63201(0x198)][_0xf63201(0x1ef)]({'where':{'id':_0x495f25},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x1e8f0a)throw new Error(_0xf63201(0x1a7));const _0x72cc4c=_0x1e8f0a[_0xf63201(0x1ea)],_0x2d874a=_0x320bb5[_0xf63201(0x191)]();console[_0xf63201(0x174)](_0xf63201(0x1f0)+_0x495f25+'\x20status:\x20'+_0x72cc4c+_0xf63201(0x184)+_0x2d874a),console['log']('💰\x20Current\x20shop\x20balance:\x20'+_0x1e8f0a[_0xf63201(0x211)][_0xf63201(0x1bd)]+'\x20USDT');const _0x11ab04={'status':_0x2d874a,'updatedAt':new Date(),'statusChangedBy':_0xf63201(0x170),'statusChangedAt':new Date()};_0x602e40&&(_0x11ab04[_0xf63201(0x210)]=_0x602e40);_0x2d874a===_0xf63201(0x207)&&_0x38c168&&(_0x11ab04['chargebackAmount']=_0x38c168);let _0x10a1be=0x0,_0x26ce8b=_0x1e8f0a[_0xf63201(0x211)]['balance'];if(_0x2d874a===_0xf63201(0x1a1)&&_0x72cc4c!==_0xf63201(0x1a1)){_0x11ab04[_0xf63201(0x1b5)]=new Date();const _0x293383=await currencyService_1['currencyService'][_0xf63201(0x202)](_0x1e8f0a['amount'],_0x1e8f0a[_0xf63201(0x1d9)]);_0x11ab04['amountUSDT']=_0x293383,_0x10a1be=_0x293383,_0x26ce8b+=_0x293383,console[_0xf63201(0x174)](_0xf63201(0x219)+_0x495f25+_0xf63201(0x167)+_0x293383['toFixed'](0x6)+_0xf63201(0x1bf));}else _0x72cc4c===_0xf63201(0x1a1)&&_0x2d874a!==_0xf63201(0x1a1)&&(_0x1e8f0a[_0xf63201(0x1c5)]&&(_0x10a1be=-_0x1e8f0a[_0xf63201(0x1c5)],_0x26ce8b-=_0x1e8f0a[_0xf63201(0x1c5)],_0x11ab04[_0xf63201(0x1c5)]=null,console['log'](_0xf63201(0x219)+_0x495f25+'\x20no\x20longer\x20PAID:\x20-'+_0x1e8f0a[_0xf63201(0x1c5)][_0xf63201(0x1b2)](0x6)+'\x20USDT\x20from\x20balance')));if(_0x2d874a===_0xf63201(0x207)){if(_0x72cc4c===_0xf63201(0x1a1)&&_0x1e8f0a[_0xf63201(0x1c5)]){}_0x38c168&&_0x38c168>0x0&&(_0x10a1be-=_0x38c168,_0x26ce8b-=_0x38c168,console[_0xf63201(0x174)](_0xf63201(0x1bb)+_0x38c168[_0xf63201(0x1b2)](0x6)+_0xf63201(0x147)));}_0x2d874a===_0xf63201(0x1ab)&&_0x72cc4c==='PAID'&&console[_0xf63201(0x174)](_0xf63201(0x19d));const _0x5e6f16=await _0x48f575[_0xf63201(0x198)]['update']({'where':{'id':_0x495f25},'data':_0x11ab04,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x10a1be!==0x0&&(await _0x48f575[_0xf63201(0x211)][_0xf63201(0x1b0)]({'where':{'id':_0x1e8f0a[_0xf63201(0x1ae)]},'data':{'balance':_0x26ce8b}}),console[_0xf63201(0x174)](_0xf63201(0x1e6)+_0x1e8f0a[_0xf63201(0x1ae)]+_0xf63201(0x1f8)+_0x1e8f0a[_0xf63201(0x211)]['balance']['toFixed'](0x6)+_0xf63201(0x184)+_0x26ce8b[_0xf63201(0x1b2)](0x6)+_0xf63201(0x20e)+(_0x10a1be>0x0?'+':'')+_0x10a1be[_0xf63201(0x1b2)](0x6)+')')),_0x5e6f16;});return{'id':_0x23d518['id'],'shopId':_0x23d518[_0x3bcf3e(0x1ae)],'gateway':_0x23d518[_0x3bcf3e(0x158)],'amount':_0x23d518['amount'],'currency':_0x23d518['currency'],'status':_0x23d518['status'],'orderId':_0x23d518[_0x3bcf3e(0x1fa)],'gatewayOrderId':_0x23d518['gatewayOrderId'],'customerEmail':_0x23d518['customerEmail'],'customerName':_0x23d518[_0x3bcf3e(0x1bc)],'customerCountry':_0x23d518[_0x3bcf3e(0x208)],'customerIp':_0x23d518[_0x3bcf3e(0x172)],'customerUa':_0x23d518['customerUa'],'failureMessage':_0x23d518[_0x3bcf3e(0x16e)],'adminNotes':_0x23d518['adminNotes'],'chargebackAmount':_0x23d518[_0x3bcf3e(0x1e1)],'statusChangedBy':_0x23d518[_0x3bcf3e(0x1aa)],'statusChangedAt':_0x23d518['statusChangedAt'],'createdAt':_0x23d518[_0x3bcf3e(0x1fb)],'updatedAt':_0x23d518[_0x3bcf3e(0x1fc)],'shop':_0x23d518['shop']};}async[a35_0x40908e(0x1e5)](_0x543a92,_0x2a5825){const _0x4dd807=a35_0x40908e,_0x109eb7={..._0x2a5825};_0x2a5825[_0x4dd807(0x19c)]&&(_0x109eb7[_0x4dd807(0x19c)]=await bcryptjs_1['default']['hash'](_0x2a5825[_0x4dd807(0x19c)],0xc));_0x2a5825[_0x4dd807(0x168)]&&(_0x109eb7['name']=_0x2a5825[_0x4dd807(0x168)],delete _0x109eb7[_0x4dd807(0x168)]);_0x2a5825['telegramId']&&(_0x109eb7['telegram']=_0x2a5825[_0x4dd807(0x1b6)],delete _0x109eb7[_0x4dd807(0x1b6)]);_0x2a5825['merchantUrl']&&(_0x109eb7[_0x4dd807(0x1cc)]=_0x2a5825[_0x4dd807(0x1a2)],delete _0x109eb7[_0x4dd807(0x1a2)]);_0x2a5825[_0x4dd807(0x163)]&&(_0x109eb7[_0x4dd807(0x18d)]=JSON[_0x4dd807(0x200)](_0x2a5825[_0x4dd807(0x163)]),delete _0x109eb7[_0x4dd807(0x163)]);_0x2a5825[_0x4dd807(0x13e)]&&(_0x109eb7[_0x4dd807(0x13e)]=JSON[_0x4dd807(0x200)](_0x2a5825['gatewaySettings']),delete _0x109eb7['gatewaySettings']);_0x2a5825['wallets']&&(_0x2a5825[_0x4dd807(0x166)][_0x4dd807(0x162)]!==undefined&&(_0x109eb7['usdtPolygonWallet']=_0x2a5825[_0x4dd807(0x166)][_0x4dd807(0x162)]||null),_0x2a5825[_0x4dd807(0x166)][_0x4dd807(0x1e7)]!==undefined&&(_0x109eb7[_0x4dd807(0x1e7)]=_0x2a5825[_0x4dd807(0x166)][_0x4dd807(0x1e7)]||null),_0x2a5825[_0x4dd807(0x166)]['usdtErcWallet']!==undefined&&(_0x109eb7[_0x4dd807(0x18c)]=_0x2a5825[_0x4dd807(0x166)][_0x4dd807(0x18c)]||null),_0x2a5825[_0x4dd807(0x166)]['usdcPolygonWallet']!==undefined&&(_0x109eb7[_0x4dd807(0x218)]=_0x2a5825[_0x4dd807(0x166)][_0x4dd807(0x218)]||null),delete _0x109eb7[_0x4dd807(0x166)]);const _0x16fbac=await database_1['default']['shop'][_0x4dd807(0x1b0)]({'where':{'id':_0x543a92},'data':_0x109eb7,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x16fbac['id'],'fullName':_0x16fbac[_0x4dd807(0x171)],'username':_0x16fbac[_0x4dd807(0x182)],'telegramId':_0x16fbac['telegram'],'merchantUrl':_0x16fbac['shopUrl'],'gateways':_0x16fbac['paymentGateways']?JSON[_0x4dd807(0x212)](_0x16fbac[_0x4dd807(0x18d)]):null,'gatewaySettings':_0x16fbac[_0x4dd807(0x13e)]?JSON[_0x4dd807(0x212)](_0x16fbac['gatewaySettings']):null,'publicKey':_0x16fbac[_0x4dd807(0x1d2)],'wallets':{'usdtPolygonWallet':_0x16fbac[_0x4dd807(0x162)],'usdtTrcWallet':_0x16fbac[_0x4dd807(0x1e7)],'usdtErcWallet':_0x16fbac['usdtErcWallet'],'usdcPolygonWallet':_0x16fbac['usdcPolygonWallet']},'status':_0x16fbac[_0x4dd807(0x1ea)],'createdAt':_0x16fbac[_0x4dd807(0x1fb)]};}async[a35_0x40908e(0x1a6)](_0xedb6bc){const _0x1c161e=a35_0x40908e,_0x287691=await database_1[_0x1c161e(0x1ba)][_0x1c161e(0x211)][_0x1c161e(0x1b0)]({'where':{'id':_0xedb6bc},'data':{'status':'SUSPENDED'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x287691['id'],'fullName':_0x287691[_0x1c161e(0x171)],'username':_0x287691[_0x1c161e(0x182)],'telegramId':_0x287691[_0x1c161e(0x1af)],'merchantUrl':_0x287691['shopUrl'],'gateways':_0x287691[_0x1c161e(0x18d)]?JSON[_0x1c161e(0x212)](_0x287691[_0x1c161e(0x18d)]):null,'gatewaySettings':_0x287691[_0x1c161e(0x13e)]?JSON[_0x1c161e(0x212)](_0x287691[_0x1c161e(0x13e)]):null,'publicKey':_0x287691[_0x1c161e(0x1d2)],'wallets':{'usdtPolygonWallet':_0x287691[_0x1c161e(0x162)],'usdtTrcWallet':_0x287691[_0x1c161e(0x1e7)],'usdtErcWallet':_0x287691['usdtErcWallet'],'usdcPolygonWallet':_0x287691[_0x1c161e(0x218)]},'status':_0x287691[_0x1c161e(0x1ea)],'createdAt':_0x287691[_0x1c161e(0x1fb)]};}async['activateUser'](_0x3186f7){const _0x87cfc3=a35_0x40908e,_0x3e925f=await database_1[_0x87cfc3(0x1ba)]['shop'][_0x87cfc3(0x1b0)]({'where':{'id':_0x3186f7},'data':{'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x3e925f['id'],'fullName':_0x3e925f[_0x87cfc3(0x171)],'username':_0x3e925f['username'],'telegramId':_0x3e925f[_0x87cfc3(0x1af)],'merchantUrl':_0x3e925f['shopUrl'],'gateways':_0x3e925f[_0x87cfc3(0x18d)]?JSON[_0x87cfc3(0x212)](_0x3e925f[_0x87cfc3(0x18d)]):null,'gatewaySettings':_0x3e925f[_0x87cfc3(0x13e)]?JSON[_0x87cfc3(0x212)](_0x3e925f['gatewaySettings']):null,'publicKey':_0x3e925f[_0x87cfc3(0x1d2)],'wallets':{'usdtPolygonWallet':_0x3e925f[_0x87cfc3(0x162)],'usdtTrcWallet':_0x3e925f[_0x87cfc3(0x1e7)],'usdtErcWallet':_0x3e925f[_0x87cfc3(0x18c)],'usdcPolygonWallet':_0x3e925f[_0x87cfc3(0x218)]},'status':_0x3e925f[_0x87cfc3(0x1ea)],'createdAt':_0x3e925f[_0x87cfc3(0x1fb)]};}async['getAllUsers'](_0x147779){const _0x5ceeba=a35_0x40908e,{page:_0x4a4c45,limit:_0x386a00,status:_0x5c604c}=_0x147779,_0x42b81b=(_0x4a4c45-0x1)*_0x386a00,_0x599344={};_0x5c604c&&(_0x599344[_0x5ceeba(0x1ea)]=_0x5c604c[_0x5ceeba(0x191)]());const [_0x315770,_0x55b80c]=await Promise[_0x5ceeba(0x1c7)]([database_1['default']['shop'][_0x5ceeba(0x1a5)]({'where':_0x599344,'skip':_0x42b81b,'take':_0x386a00,'orderBy':{'createdAt':_0x5ceeba(0x17a)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x5ceeba(0x1ba)][_0x5ceeba(0x211)]['count']({'where':_0x599344})]);return{'users':_0x315770[_0x5ceeba(0x1fd)](_0x4a866a=>({'id':_0x4a866a['id'],'fullName':_0x4a866a[_0x5ceeba(0x171)],'username':_0x4a866a[_0x5ceeba(0x182)],'telegramId':_0x4a866a[_0x5ceeba(0x1af)],'merchantUrl':_0x4a866a[_0x5ceeba(0x1cc)],'gateways':_0x4a866a[_0x5ceeba(0x18d)]?JSON[_0x5ceeba(0x212)](_0x4a866a[_0x5ceeba(0x18d)]):null,'gatewaySettings':_0x4a866a['gatewaySettings']?JSON[_0x5ceeba(0x212)](_0x4a866a[_0x5ceeba(0x13e)]):null,'publicKey':_0x4a866a[_0x5ceeba(0x1d2)],'wallets':{'usdtPolygonWallet':_0x4a866a[_0x5ceeba(0x162)],'usdtTrcWallet':_0x4a866a[_0x5ceeba(0x1e7)],'usdtErcWallet':_0x4a866a[_0x5ceeba(0x18c)],'usdcPolygonWallet':_0x4a866a['usdcPolygonWallet']},'status':_0x4a866a[_0x5ceeba(0x1ea)],'createdAt':_0x4a866a['createdAt']})),'pagination':{'page':_0x4a4c45,'limit':_0x386a00,'total':_0x55b80c,'totalPages':Math['ceil'](_0x55b80c/_0x386a00)}};}async['getUserById'](_0x579692){const _0x55cdc1=a35_0x40908e,_0x28245d=await database_1[_0x55cdc1(0x1ba)][_0x55cdc1(0x211)][_0x55cdc1(0x1ef)]({'where':{'id':_0x579692},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x28245d)return null;return{'id':_0x28245d['id'],'fullName':_0x28245d[_0x55cdc1(0x171)],'username':_0x28245d[_0x55cdc1(0x182)],'telegramId':_0x28245d['telegram'],'merchantUrl':_0x28245d[_0x55cdc1(0x1cc)],'gateways':_0x28245d[_0x55cdc1(0x18d)]?JSON[_0x55cdc1(0x212)](_0x28245d[_0x55cdc1(0x18d)]):null,'gatewaySettings':_0x28245d[_0x55cdc1(0x13e)]?JSON['parse'](_0x28245d[_0x55cdc1(0x13e)]):null,'publicKey':_0x28245d['publicKey'],'wallets':{'usdtPolygonWallet':_0x28245d[_0x55cdc1(0x162)],'usdtTrcWallet':_0x28245d['usdtTrcWallet'],'usdtErcWallet':_0x28245d[_0x55cdc1(0x18c)],'usdcPolygonWallet':_0x28245d['usdcPolygonWallet']},'status':_0x28245d['status'],'createdAt':_0x28245d[_0x55cdc1(0x1fb)]};}async['createUser'](_0x536648){const _0x4bb373=a35_0x40908e,{fullName:_0x58201d,username:_0x4e5f1b,password:_0x2887d2,telegramId:_0x533d16,merchantUrl:_0x42b0ed,gateways:_0x102263,gatewaySettings:_0x7e76c4,wallets:_0x105af2}=_0x536648,_0xea1935=await database_1['default'][_0x4bb373(0x211)][_0x4bb373(0x1ef)]({'where':{'username':_0x4e5f1b}});if(_0xea1935)throw new Error('Username\x20already\x20exists');if(_0x533d16){const _0x57906a=await database_1[_0x4bb373(0x1ba)][_0x4bb373(0x211)]['findUnique']({'where':{'telegram':_0x533d16}});if(_0x57906a)throw new Error('Telegram\x20username\x20already\x20exists');}const _0x53a08a=await bcryptjs_1[_0x4bb373(0x1ba)][_0x4bb373(0x1b9)](_0x2887d2,0xc),_0x1342c8=_0x4bb373(0x175)+crypto_1[_0x4bb373(0x1ba)][_0x4bb373(0x177)](0x20)[_0x4bb373(0x152)]('hex'),_0x240f83=_0x4bb373(0x20b)+crypto_1['default'][_0x4bb373(0x177)](0x20)['toString'](_0x4bb373(0x1df)),_0x366237=await database_1['default'][_0x4bb373(0x211)][_0x4bb373(0x1dd)]({'data':{'name':_0x58201d,'username':_0x4e5f1b,'password':_0x53a08a,'telegram':_0x533d16,'shopUrl':_0x42b0ed,'paymentGateways':_0x102263?JSON[_0x4bb373(0x200)](_0x102263):null,'gatewaySettings':_0x7e76c4?JSON[_0x4bb373(0x200)](_0x7e76c4):null,'usdtPolygonWallet':_0x105af2?.['usdtPolygonWallet']||null,'usdtTrcWallet':_0x105af2?.['usdtTrcWallet']||null,'usdtErcWallet':_0x105af2?.[_0x4bb373(0x18c)]||null,'usdcPolygonWallet':_0x105af2?.[_0x4bb373(0x218)]||null,'publicKey':_0x1342c8,'secretKey':_0x240f83,'status':_0x4bb373(0x180)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x366237['id'],'fullName':_0x366237['name'],'username':_0x366237[_0x4bb373(0x182)],'telegramId':_0x366237[_0x4bb373(0x1af)],'merchantUrl':_0x366237[_0x4bb373(0x1cc)],'gateways':_0x366237[_0x4bb373(0x18d)]?JSON['parse'](_0x366237[_0x4bb373(0x18d)]):null,'gatewaySettings':_0x366237['gatewaySettings']?JSON[_0x4bb373(0x212)](_0x366237[_0x4bb373(0x13e)]):null,'publicKey':_0x366237['publicKey'],'wallets':{'usdtPolygonWallet':_0x366237[_0x4bb373(0x162)],'usdtTrcWallet':_0x366237[_0x4bb373(0x1e7)],'usdtErcWallet':_0x366237[_0x4bb373(0x18c)],'usdcPolygonWallet':_0x366237[_0x4bb373(0x218)]},'status':_0x366237[_0x4bb373(0x1ea)],'createdAt':_0x366237['createdAt']};}async[a35_0x40908e(0x143)](_0x39a2fd){const _0x3e035d=a35_0x40908e;await database_1[_0x3e035d(0x1ba)][_0x3e035d(0x211)][_0x3e035d(0x1ce)]({'where':{'id':_0x39a2fd}});}}function a35_0x1f4b(){const _0x344793=['59660Tpiqrh','month','currencyService','externalPaymentUrl','ACTIVE','error','username','customerUa','\x20->\x20','_count','totalTurnover','totalPaidOut','getMerchantsAwaitingPayout','network','totalCommissionRate','findFirst','usdtErcWallet','paymentGateways','toISOString','lte','defineProperty','toUpperCase','Noda','\x20USDT\x20(total\x20paid\x20to\x20merchants)','Test\x20Gateway','commissionUSDT','getTime','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','payment','getPayoutById','paymentsCount','updateCustomerData','password','🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','2020-01-01','\x20\x20\x20💵\x20Available\x20balance:\x20','30d','PAID','merchantUrl','notes','getGatewayDisplayName','findMany','suspendUser','Payment\x20not\x20found','sort','deletePayout','statusChangedBy','REFUND','2180QpjmDr','gatewayOrderId','shopId','telegram','update','gatewayEarnings','toFixed','createPayout','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','paidAt','telegramId','__importDefault','\x20USDT','hash','default','💸\x20CHARGEBACK\x20penalty:\x20-','customerName','balance','186481rALHKN','\x20USDT\x20to\x20balance','merchantEarningsUSDT','averageCheckUSDT','24dkiBDc','pendingUrl','9604176vlHmdj','amountUSDT','string','all','\x20\x20\x20Current\x20balance:\x20','$transaction','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','\x20\x20\x20🖥️\x20User\x20Agent:\x20','shopUrl','failUrl','delete','\x20\x20\x20📅\x20This\x20month:\x20','./currencyService','week','publicKey','\x20\x20\x20Balance:\x20','updatePaymentStatus','reduce','count','commission','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','currency','8517573CNYyjY','aggregate','\x20for\x20shop\x20','create','dateTo','hex','\x20USDT\x20total','chargebackAmount','💰\x20Found\x20','set','📊\x20Merchants\x20awaiting\x20payout:\x20','updateUser','💰\x20Shop\x20','usdtTrcWallet','\x20balance\x20updated:','\x20merchants\x20with\x20positive\x20balance','status','values','Error\x20processing\x20payment\x20','turnoverUSDT','3501jZDiwy','findUnique','🔄\x20Admin\x20updating\x20payment\x20','not\x20set','periodTo','ceil','turnover','✅\x20Payout\x20created:\x20','\x20USDT\x20(same\x20as\x20awaiting)','forEach','\x20balance\x20updated:\x20','groupBy','orderId','createdAt','updatedAt','map','\x20paid\x20payments\x20for\x20analysis','getMerchantStatistics','stringify','\x20USDT\x20(total\x20merchant\x20balances)','convertToUSDT','averageCommissionRate','periodFrom','merchantEarnings','getAllPayouts','CHARGEBACK','customerCountry','test_gateway','insensitive','sk_','Insufficient\x20balance.\x20Available:\x20','custom','\x20USDT\x20(','_sum','adminNotes','shop','parse','split','amount','\x20\x20\x20💰\x20Total\x20payout:\x20','\x20\x20\x20Total\x20paid\x20out:\x20','totalPayout','usdcPolygonWallet','💰\x20Payment\x20','📊\x20Calculating\x20payout\x20statistics...','📊\x20Merchant\x20statistics\x20calculated:','payout','gatewaySettings','COMPLETED','\x20to\x20','round','\x20USDT\x20(-','deleteUser','dateFrom','\x20\x20\x20🌐\x20IP:\x20','getFullYear','\x20USDT\x20from\x20balance','\x20USDT\x20(+','txid','whiteUrl','6299867RvSuuj','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','\x20\x20\x20💰\x20Total\x20turnover:\x20','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','asc','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','\x20\x20\x20Payout\x20amount:\x20','toString','\x20USDT)','totalPayments','💰\x20Creating\x20payout\x20for\x20shop\x20','\x20merchants,\x20','AdminService','gateway','KLYME\x20DE','../config/database','8659140SWrFmX','toLowerCase','gte','KLYME\x20EU','\x20\x20\x20📊\x20Total\x20payments:\x20','year','__esModule','usdtPolygonWallet','gateways','availableBalance','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','wallets','\x20became\x20PAID:\x20+','fullName','customerEmail','getMonth','getSystemStatistics','localeCompare','📅\x20Period:\x20','failureMessage','length','admin','name','customerIp','period','log','pk_','successUrl','randomBytes','KLYME\x20GB','Shop\x20not\x20found','desc','📊\x20Payout\x20statistics\x20calculated:'];a35_0x1f4b=function(){return _0x344793;};return a35_0x1f4b();}exports['AdminService']=AdminService;