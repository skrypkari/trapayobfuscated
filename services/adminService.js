'use strict';const a33_0x2b9ffc=a33_0x3548;function a33_0x3548(_0x4b4f4d,_0x3a8f6d){const _0x8d89e=a33_0x8d89();return a33_0x3548=function(_0x3548a6,_0x3390aa){_0x3548a6=_0x3548a6-0x1c6;let _0x3041cc=_0x8d89e[_0x3548a6];return _0x3041cc;},a33_0x3548(_0x4b4f4d,_0x3a8f6d);}(function(_0x2ee35d,_0x4be302){const _0xad8d40=a33_0x3548,_0xa19c69=_0x2ee35d();while(!![]){try{const _0x307e4e=-parseInt(_0xad8d40(0x26b))/0x1*(parseInt(_0xad8d40(0x23a))/0x2)+-parseInt(_0xad8d40(0x25a))/0x3+parseInt(_0xad8d40(0x201))/0x4+-parseInt(_0xad8d40(0x1e0))/0x5*(parseInt(_0xad8d40(0x218))/0x6)+parseInt(_0xad8d40(0x299))/0x7*(parseInt(_0xad8d40(0x1d9))/0x8)+parseInt(_0xad8d40(0x247))/0x9+parseInt(_0xad8d40(0x262))/0xa*(parseInt(_0xad8d40(0x26a))/0xb);if(_0x307e4e===_0x4be302)break;else _0xa19c69['push'](_0xa19c69['shift']());}catch(_0x41655f){_0xa19c69['push'](_0xa19c69['shift']());}}}(a33_0x8d89,0xb1a4d));var __importDefault=this&&this[a33_0x2b9ffc(0x234)]||function(_0x5e8410){return _0x5e8410&&_0x5e8410['__esModule']?_0x5e8410:{'default':_0x5e8410};};function a33_0x8d89(){const _0x5a5b8c=['\x20USDT\x20via\x20','User\x20not\x20found','delete','externalPaymentUrl','getMonth','getPayoutStats','shopId','üîÑ\x20Marking\x20payments\x20as\x20paid\x20out\x20for\x20shop\x20','totalAmountAfterCommissionUSDT','COMPLETED','üìä\x20Calculating\x20admin\x20payout\x20statistics...','2381226WBeNyt','awaitingPayout','getAllUsers','payoutDelay','findUnique','remitterName','join','üè™\x20Found\x20','sourceCurrency','‚úÖ\x20Marked\x20','üìä\x20Daily\x20revenue\x20entries:\x20','usdtPolygonWallet','üí∏\x20Chargeback\x20amount:\x20','status','reduce','txid','ceil','\x20suspended\x20successfully','Payment\x20not\x20found','\x20deleted\x20successfully','activateUser','AdminService','getTime','stringify','\x20merchants\x20with\x20eligible\x20PAID\x20payments','üîç\x20Getting\x20payment\x20by\x20ID:\x20','default','deletePayout','__importDefault','amountUSDT','üóëÔ∏è\x20Deleting\x20payout:\x20','entries','length','get','910686xDIlOF','createdAt','payment','setDate','admin','sendPayoutNotification','statusChangedAt','totalPayout','gateway','isEligibleForPayout','\x20total','convertToUSDT','expiresAt','6330492noFcId','isValidGatewayId','payout','chargebackAmount','30d','User\x20is\x20already\x20active','amount','Shop\x20is\x20not\x20active','shopUrl','üìã\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','toFixed','count','\x20USDT\x20(','üìÖ\x20This\x20Month:\x20','adminNotes','üìä\x20Found\x20','\x20USDT\x20(penalty\x20amount)','paidAt','usdcPolygonWallet','2014299RRukza','\x20USDT\x20after\x20commission)','\x20status\x20updated\x20from\x20','\x20merchants\x20out\x20of\x20','‚úÖ\x20Returning\x20','updatedAt','\x20to\x20','webhookLog','9980SGxFVH','name','gatewayPaymentId','cardLast4','notes','findMany','includes','../config/database','12782tTsOpv','1DvHmST','push','ACTIVE','statusChangedBy',',\x20amount:\x20','getDate','paymentGateways','\x20payments\x20as\x20paid\x20out','generateDateRange','orderId','‚úÖ\x20User\x20','log','‚úÖ\x20Found\x20payment:\x20','REFUND','‚úÖ\x20Payout\x20','Invalid\x20status.\x20Valid\x20statuses:\x20','SUSPENDED','usdtErcWallet','bankId','payments','createUser','üí∞\x20Total\x20amount:\x20','CHARGEBACK','\x20days','paymentMethod','gatewaySettings','\x20eligible\x20PAID\x20payments\x20for\x20payout\x20analysis','updateUser','üö´\x20Suspending\x20user:\x20','amountAfterCommissionUSDT','insensitive','üí∞\x20Found\x20','toLowerCase','username','map','lte','./telegramBotService','\x20USDT\x20(–≤–∫–ª—é—á–∞—è\x20—à—Ç—Ä–∞—Ñ—ã\x20chargeback)','webhookLogs','usage','getAllPayouts','parse','charAt','üí∞\x20Available\x20Balance:\x20','‚úÖ\x20Found\x20payout:\x20','shop','4313687psSLhF','getFullYear','\x20users\x20out\x20of\x20','create','updateMany','‚úÖ\x20Payout\x20created\x20successfully:\x20','remitterIban','currency','PAID','\x20days)','network','\x20payments\x20for\x20revenue\x20calculation\x20(PAID/REFUND/CHARGEBACK)','update','üìÖ\x20Processing\x20daily\x20stats\x20for\x20','getSystemStatistics','‚úÖ\x20Activating\x20user:\x20','toISOString','\x20USDT','getPaymentById','üîÑ\x20Admin\x20updating\x20payment\x20','./userService','__esModule','customerName','UserService','8HbzQOU','\x20activated\x20successfully','all','getGatewayNameById','üí≥\x20Total\x20payments:\x20','‚ùå\x20Payment\x20not\x20found:\x20','createPayout','10IkbQFn','deleteUser','üí∏\x20Chargeback\x20penalty:\x20','customerEmail','abs','totalAmountUSDT','gatewayOrderId','slice','getPeriodDays','User\x20is\x20already\x20suspended','calculateEffectiveAmount','asc','completed','from','getGatewaySettings','desc','round','Payout\x20not\x20found','Shop\x20not\x20found','üìã\x20Getting\x20payouts\x20with\x20filters:','userService','toUpperCase','EXPIRED','telegram','currencyService','size','\x20USDT\x20(will\x20be\x20deducted\x20from\x20merchant\x20balance)','admin_status_update','updatePaymentStatus','markPaymentsAsPaidOut','has','Error\x20parsing\x20gateway\x20settings:','‚è≥\x20Awaiting\x20Payout:\x20','675368afjkcV','availableBalance','merchantPaid','gte','error','date','Chargeback\x20amount\x20is\x20required\x20and\x20must\x20be\x20positive\x20(amount\x20in\x20USDT)','commission','üíµ\x20Total\x20revenue:\x20','set','‚úÖ\x20Payment\x20','üìã\x20Getting\x20users\x20with\x20filters:'];a33_0x8d89=function(){return _0x5a5b8c;};return a33_0x8d89();}Object['defineProperty'](exports,a33_0x2b9ffc(0x1d6),{'value':!![]}),exports[a33_0x2b9ffc(0x22d)]=void 0x0;const database_1=__importDefault(require(a33_0x2b9ffc(0x269))),currencyService_1=require('./currencyService'),userService_1=require(a33_0x2b9ffc(0x1d5)),telegramBotService_1=require(a33_0x2b9ffc(0x28f)),gateway_1=require('../types/gateway');class AdminService{constructor(){const _0x4f81fc=a33_0x2b9ffc;this[_0x4f81fc(0x1f4)]=new userService_1[(_0x4f81fc(0x1d8))]();}[a33_0x2b9ffc(0x1e8)](_0x45b061){const _0x384540=a33_0x2b9ffc;switch(_0x45b061){case'7d':return 0x7;case _0x384540(0x24b):return 0x1e;case'90d':return 0x5a;case'1y':return 0x16d;default:return 0x1e;}}[a33_0x2b9ffc(0x273)](_0x12e6d9,_0x406aba){const _0x35fcac=a33_0x2b9ffc,_0x176889=[],_0x11bb98=new Date(_0x12e6d9);while(_0x11bb98<=_0x406aba){_0x176889[_0x35fcac(0x26c)](_0x11bb98[_0x35fcac(0x1d1)]()['split']('T')[0x0]),_0x11bb98[_0x35fcac(0x23d)](_0x11bb98['getDate']()+0x1);}return _0x176889;}[a33_0x2b9ffc(0x1ee)](_0x43b1f7,_0x12028c){const _0x3ce7b4=a33_0x2b9ffc;if(!_0x43b1f7[_0x3ce7b4(0x284)])return{'commission':0x0,'payoutDelay':0x0};try{const _0x23280f=JSON[_0x3ce7b4(0x294)](_0x43b1f7[_0x3ce7b4(0x284)]),_0x20062b=_0x12028c['charAt'](0x0)[_0x3ce7b4(0x1f5)]()+_0x12028c[_0x3ce7b4(0x1e7)](0x1)['toLowerCase']();if(_0x23280f&&_0x23280f[_0x20062b])return{'commission':_0x23280f[_0x20062b][_0x3ce7b4(0x208)]||0x0,'payoutDelay':_0x23280f[_0x20062b][_0x3ce7b4(0x21b)]||0x0};}catch(_0xeaa7c6){console[_0x3ce7b4(0x205)](_0x3ce7b4(0x1ff),_0xeaa7c6);}return{'commission':0x0,'payoutDelay':0x0};}[a33_0x2b9ffc(0x243)](_0x38e511){const _0x330835=a33_0x2b9ffc;if(_0x38e511['status']!==_0x330835(0x1c9)||_0x38e511[_0x330835(0x203)]||!_0x38e511[_0x330835(0x258)])return![];const _0x24e66c=this[_0x330835(0x1ee)](_0x38e511[_0x330835(0x298)],_0x38e511['gateway']),_0x26e382=_0x24e66c[_0x330835(0x21b)]*0x18*0x3c*0x3c*0x3e8,_0x562d04=new Date(_0x38e511[_0x330835(0x258)][_0x330835(0x22e)]()+_0x26e382);return new Date()>_0x562d04;}['calculateAmountAfterCommission'](_0xb4a2b1,_0x3e3e34){return _0xb4a2b1*(0x1-_0x3e3e34/0x64);}['calculateEffectiveAmount'](_0x180e1b){const _0x2e0e0a=a33_0x2b9ffc;switch(_0x180e1b['status']){case _0x2e0e0a(0x1c9):return _0x180e1b[_0x2e0e0a(0x24d)];case _0x2e0e0a(0x281):return-(_0x180e1b['chargebackAmount']||0x0);case _0x2e0e0a(0x278):return 0x0;default:return 0x0;}}async[a33_0x2b9ffc(0x1df)](_0x1275a9){const _0x18ec82=a33_0x2b9ffc,{shopId:_0x3f2058,amount:_0x30f218,network:_0x10e0bf,notes:_0x3397ed}=_0x1275a9;console[_0x18ec82(0x276)]('üí∏\x20Creating\x20payout\x20for\x20shop\x20'+_0x3f2058+':\x20'+_0x30f218+_0x18ec82(0x20d)+_0x10e0bf);const _0x422d82=await database_1[_0x18ec82(0x232)][_0x18ec82(0x298)][_0x18ec82(0x21c)]({'where':{'id':_0x3f2058},'select':{'id':!![],'name':!![],'username':!![],'status':!![]}});if(!_0x422d82)throw new Error(_0x18ec82(0x1f2));if(_0x422d82[_0x18ec82(0x225)]!==_0x18ec82(0x26d))throw new Error(_0x18ec82(0x24e));const _0x3f7b98=await database_1['default'][_0x18ec82(0x249)][_0x18ec82(0x29c)]({'data':{'shopId':_0x3f2058,'amount':_0x30f218,'network':_0x10e0bf,'status':_0x18ec82(0x216),'notes':_0x3397ed||null,'paidAt':new Date()},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});await this[_0x18ec82(0x1fd)](_0x3f2058,_0x30f218);try{await telegramBotService_1['telegramBotService'][_0x18ec82(0x23f)](_0x3f2058,_0x3f7b98,_0x18ec82(0x1ec));}catch(_0x30b765){console[_0x18ec82(0x205)]('Failed\x20to\x20send\x20Telegram\x20payout\x20notification:',_0x30b765);}return console[_0x18ec82(0x276)](_0x18ec82(0x1c6)+_0x3f7b98['id']),{'id':_0x3f7b98['id'],'shopId':_0x3f7b98[_0x18ec82(0x213)],'shopName':_0x3f7b98[_0x18ec82(0x298)][_0x18ec82(0x263)],'shopUsername':_0x3f7b98[_0x18ec82(0x298)][_0x18ec82(0x28c)],'amount':_0x3f7b98['amount'],'network':_0x3f7b98[_0x18ec82(0x1cb)],'status':_0x3f7b98[_0x18ec82(0x225)],'txid':_0x3f7b98[_0x18ec82(0x227)],'notes':_0x3f7b98[_0x18ec82(0x266)],'createdAt':_0x3f7b98[_0x18ec82(0x23b)],'paidAt':_0x3f7b98[_0x18ec82(0x258)]};}async[a33_0x2b9ffc(0x1fd)](_0x110616,_0x5df06a){const _0x2b2cf9=a33_0x2b9ffc;console[_0x2b2cf9(0x276)](_0x2b2cf9(0x214)+_0x110616+_0x2b2cf9(0x26f)+_0x5df06a+_0x2b2cf9(0x1d2));const _0x2606a0=await database_1['default'][_0x2b2cf9(0x23c)][_0x2b2cf9(0x267)]({'where':{'shopId':_0x110616,'status':_0x2b2cf9(0x1c9),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'shop':{'select':{'gatewaySettings':!![]}}},'orderBy':{'paidAt':_0x2b2cf9(0x1eb)}});let _0x45dbbe=_0x5df06a;const _0x5d39b4=[];for(const _0x3451b6 of _0x2606a0){const _0x200de4={..._0x3451b6,'status':_0x2b2cf9(0x1c9),'merchantPaid':![],'shop':{'gatewaySettings':_0x3451b6[_0x2b2cf9(0x298)][_0x2b2cf9(0x284)]}};if(!this['isEligibleForPayout'](_0x200de4))continue;const _0x2c85b4=await currencyService_1[_0x2b2cf9(0x1f8)]['convertToUSDT'](_0x3451b6[_0x2b2cf9(0x24d)],_0x3451b6[_0x2b2cf9(0x1c8)]),_0x45a744=this[_0x2b2cf9(0x1ee)](_0x3451b6['shop'],_0x3451b6[_0x2b2cf9(0x242)]),_0x999f5b=this['calculateAmountAfterCommission'](_0x2c85b4,_0x45a744[_0x2b2cf9(0x208)]);if(_0x999f5b<=_0x45dbbe){_0x5d39b4[_0x2b2cf9(0x26c)](_0x3451b6['id']),_0x45dbbe-=_0x999f5b;if(_0x45dbbe<=0.01)break;}}_0x5d39b4[_0x2b2cf9(0x238)]>0x0&&(await database_1[_0x2b2cf9(0x232)][_0x2b2cf9(0x23c)][_0x2b2cf9(0x29d)]({'where':{'id':{'in':_0x5d39b4}},'data':{'merchantPaid':!![]}}),console[_0x2b2cf9(0x276)](_0x2b2cf9(0x221)+_0x5d39b4[_0x2b2cf9(0x238)]+_0x2b2cf9(0x272)));}async[a33_0x2b9ffc(0x293)](_0x1f2a83){const _0x17f76e=a33_0x2b9ffc,{page:_0xb22cd9,limit:_0x2452b6,shopId:_0xaebb9d,network:_0x328633,dateFrom:_0x38f978,dateTo:_0x103dbc,search:_0x475249}=_0x1f2a83,_0x53a32a=(_0xb22cd9-0x1)*_0x2452b6;console['log'](_0x17f76e(0x1f3),_0x1f2a83);const _0x3601e1={};_0xaebb9d&&(_0x3601e1[_0x17f76e(0x213)]=_0xaebb9d);_0x328633&&(_0x3601e1[_0x17f76e(0x1cb)]=_0x328633);(_0x38f978||_0x103dbc)&&(_0x3601e1[_0x17f76e(0x23b)]={},_0x38f978&&(_0x3601e1[_0x17f76e(0x23b)]['gte']=new Date(_0x38f978)),_0x103dbc&&(_0x3601e1[_0x17f76e(0x23b)][_0x17f76e(0x28e)]=new Date(_0x103dbc)));_0x475249&&(_0x3601e1['OR']=[{'txid':{'contains':_0x475249,'mode':'insensitive'}},{'notes':{'contains':_0x475249,'mode':_0x17f76e(0x289)}},{'shop':{'name':{'contains':_0x475249,'mode':_0x17f76e(0x289)}}},{'shop':{'username':{'contains':_0x475249,'mode':'insensitive'}}}]);const [_0xd72b82,_0x5aa537]=await Promise['all']([database_1[_0x17f76e(0x232)][_0x17f76e(0x249)][_0x17f76e(0x267)]({'where':_0x3601e1,'skip':_0x53a32a,'take':_0x2452b6,'orderBy':{'createdAt':_0x17f76e(0x1ef)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x17f76e(0x249)][_0x17f76e(0x252)]({'where':_0x3601e1})]);console[_0x17f76e(0x276)](_0x17f76e(0x256)+_0xd72b82['length']+'\x20payouts\x20out\x20of\x20'+_0x5aa537+'\x20total');const _0x530ed8=_0xd72b82['map'](_0x40ed8b=>({'id':_0x40ed8b['id'],'shopId':_0x40ed8b[_0x17f76e(0x213)],'shopName':_0x40ed8b[_0x17f76e(0x298)][_0x17f76e(0x263)],'shopUsername':_0x40ed8b[_0x17f76e(0x298)]['username'],'amount':_0x40ed8b[_0x17f76e(0x24d)],'network':_0x40ed8b['network'],'status':_0x40ed8b[_0x17f76e(0x225)],'txid':_0x40ed8b[_0x17f76e(0x227)],'notes':_0x40ed8b[_0x17f76e(0x266)],'createdAt':_0x40ed8b[_0x17f76e(0x23b)],'paidAt':_0x40ed8b[_0x17f76e(0x258)]}));return{'payouts':_0x530ed8,'pagination':{'page':_0xb22cd9,'limit':_0x2452b6,'total':_0x5aa537,'totalPages':Math[_0x17f76e(0x228)](_0x5aa537/_0x2452b6)}};}async['getPayoutById'](_0x2a7a70){const _0x123517=a33_0x2b9ffc;console[_0x123517(0x276)]('üîç\x20Getting\x20payout\x20by\x20ID:\x20'+_0x2a7a70);const _0x574222=await database_1[_0x123517(0x232)]['payout'][_0x123517(0x21c)]({'where':{'id':_0x2a7a70},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x574222)return console[_0x123517(0x276)]('‚ùå\x20Payout\x20not\x20found:\x20'+_0x2a7a70),null;return console[_0x123517(0x276)](_0x123517(0x297)+_0x574222[_0x123517(0x24d)]+_0x123517(0x20d)+_0x574222[_0x123517(0x1cb)]),{'id':_0x574222['id'],'shopId':_0x574222[_0x123517(0x213)],'shopName':_0x574222[_0x123517(0x298)]['name'],'shopUsername':_0x574222[_0x123517(0x298)][_0x123517(0x28c)],'amount':_0x574222[_0x123517(0x24d)],'network':_0x574222['network'],'status':_0x574222['status'],'txid':_0x574222[_0x123517(0x227)],'notes':_0x574222[_0x123517(0x266)],'createdAt':_0x574222['createdAt'],'paidAt':_0x574222[_0x123517(0x258)]};}async[a33_0x2b9ffc(0x233)](_0x33c116){const _0x391a61=a33_0x2b9ffc;console['log'](_0x391a61(0x236)+_0x33c116);const _0x1f382e=await database_1[_0x391a61(0x232)][_0x391a61(0x249)]['findUnique']({'where':{'id':_0x33c116},'select':{'id':!![],'shopId':!![],'amount':!![]}});if(!_0x1f382e)throw new Error(_0x391a61(0x1f1));await database_1[_0x391a61(0x232)][_0x391a61(0x249)][_0x391a61(0x20f)]({'where':{'id':_0x33c116}}),console[_0x391a61(0x276)](_0x391a61(0x279)+_0x33c116+_0x391a61(0x22b));}async['getMerchantsAwaitingPayout'](_0x3cef66){const _0x143dc2=a33_0x2b9ffc,{page:_0x5b7051,limit:_0x25bd69,minAmount:_0x29eac0,search:_0x70fea8}=_0x3cef66;console['log'](_0x143dc2(0x250),_0x3cef66);const _0x420714=await database_1[_0x143dc2(0x232)][_0x143dc2(0x23c)][_0x143dc2(0x267)]({'where':{'status':_0x143dc2(0x1c9),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'createdAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'gatewaySettings':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}});console[_0x143dc2(0x276)]('üí∞\x20Found\x20'+_0x420714[_0x143dc2(0x238)]+_0x143dc2(0x285));const _0x26a679=new Map();for(const _0x33849b of _0x420714){const _0x18fcba={..._0x33849b,'status':_0x143dc2(0x1c9),'merchantPaid':![],'shop':{'gatewaySettings':_0x33849b[_0x143dc2(0x298)]['gatewaySettings']}},_0x2d726c=this[_0x143dc2(0x243)](_0x18fcba);if(!_0x2d726c)continue;const _0x1c581e=await currencyService_1['currencyService']['convertToUSDT'](_0x33849b[_0x143dc2(0x24d)],_0x33849b[_0x143dc2(0x1c8)]),_0xdda06f=this['getGatewaySettings'](_0x33849b[_0x143dc2(0x298)],_0x33849b[_0x143dc2(0x242)]),_0xf390b4=this['calculateAmountAfterCommission'](_0x1c581e,_0xdda06f['commission']),_0x42340d=_0x33849b[_0x143dc2(0x213)];!_0x26a679[_0x143dc2(0x1fe)](_0x42340d)&&_0x26a679['set'](_0x42340d,{'shop':_0x33849b[_0x143dc2(0x298)],'payments':[]}),_0x26a679['get'](_0x42340d)[_0x143dc2(0x27e)][_0x143dc2(0x26c)]({'id':_0x33849b['id'],'amount':_0x33849b[_0x143dc2(0x24d)],'currency':_0x33849b[_0x143dc2(0x1c8)],'gateway':_0x33849b[_0x143dc2(0x242)],'paidAt':_0x33849b[_0x143dc2(0x258)],'createdAt':_0x33849b[_0x143dc2(0x23b)],'amountUSDT':_0x1c581e,'commission':_0xdda06f['commission'],'amountAfterCommissionUSDT':_0xf390b4,'isEligible':!![]});}console['log'](_0x143dc2(0x21f)+_0x26a679[_0x143dc2(0x1f9)]+_0x143dc2(0x230));const _0x1841fd=[];for(const [_0x5e16a3,_0x418ed9]of _0x26a679){const {shop:_0x3b3d93,payments:_0x4cbca1}=_0x418ed9,_0x1cb5c2=_0x4cbca1[_0x143dc2(0x226)]((_0xb83fad,_0x289012)=>_0xb83fad+_0x289012[_0x143dc2(0x235)],0x0),_0x3049e2=_0x4cbca1['reduce']((_0x63e091,_0x2e5f32)=>_0x63e091+_0x2e5f32[_0x143dc2(0x288)],0x0);if(_0x29eac0&&_0x3049e2<_0x29eac0)continue;if(_0x70fea8){const _0x2a1495=_0x70fea8[_0x143dc2(0x28b)](),_0xb80fe1=_0x3b3d93[_0x143dc2(0x263)][_0x143dc2(0x28b)]()[_0x143dc2(0x268)](_0x2a1495)||_0x3b3d93[_0x143dc2(0x28c)][_0x143dc2(0x28b)]()[_0x143dc2(0x268)](_0x2a1495)||_0x3b3d93['telegram']&&_0x3b3d93['telegram'][_0x143dc2(0x28b)]()[_0x143dc2(0x268)](_0x2a1495);if(!_0xb80fe1)continue;}const _0x486729=new Map();for(const _0x257f38 of _0x4cbca1){const _0x1a46e5=_0x257f38[_0x143dc2(0x242)];!_0x486729[_0x143dc2(0x1fe)](_0x1a46e5)&&_0x486729[_0x143dc2(0x20a)](_0x1a46e5,{'count':0x0,'amountUSDT':0x0,'amountAfterCommissionUSDT':0x0,'commission':_0x257f38[_0x143dc2(0x208)]});const _0x416575=_0x486729['get'](_0x1a46e5);_0x416575[_0x143dc2(0x252)]++,_0x416575[_0x143dc2(0x235)]+=_0x257f38[_0x143dc2(0x235)],_0x416575['amountAfterCommissionUSDT']+=_0x257f38[_0x143dc2(0x288)];}const _0x528ed3=Array[_0x143dc2(0x1ed)](_0x486729[_0x143dc2(0x237)]())[_0x143dc2(0x28d)](([_0x1a9223,_0x21a6e4])=>({'gateway':_0x1a9223[_0x143dc2(0x295)](0x0)['toUpperCase']()+_0x1a9223[_0x143dc2(0x1e7)](0x1),'count':_0x21a6e4[_0x143dc2(0x252)],'amountUSDT':Math[_0x143dc2(0x1f0)](_0x21a6e4[_0x143dc2(0x235)]*0x64)/0x64,'amountAfterCommissionUSDT':Math['round'](_0x21a6e4[_0x143dc2(0x288)]*0x64)/0x64,'commission':_0x21a6e4[_0x143dc2(0x208)]})),_0x40a410=_0x4cbca1[_0x143dc2(0x226)]((_0x246775,_0x4f2773)=>{const _0x25a448=_0x143dc2;return _0x4f2773[_0x25a448(0x258)]<_0x246775?_0x4f2773['paidAt']:_0x246775;},_0x4cbca1[0x0][_0x143dc2(0x258)]);_0x1841fd[_0x143dc2(0x26c)]({'id':_0x3b3d93['id'],'fullName':_0x3b3d93[_0x143dc2(0x263)],'username':_0x3b3d93[_0x143dc2(0x28c)],'telegramId':_0x3b3d93[_0x143dc2(0x1f7)],'merchantUrl':_0x3b3d93[_0x143dc2(0x24f)],'wallets':{'usdtPolygonWallet':_0x3b3d93[_0x143dc2(0x223)],'usdtTrcWallet':_0x3b3d93['usdtTrcWallet'],'usdtErcWallet':_0x3b3d93[_0x143dc2(0x27c)],'usdcPolygonWallet':_0x3b3d93[_0x143dc2(0x259)]},'totalAmountUSDT':Math[_0x143dc2(0x1f0)](_0x1cb5c2*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x143dc2(0x1f0)](_0x3049e2*0x64)/0x64,'paymentsCount':_0x4cbca1[_0x143dc2(0x238)],'oldestPaymentDate':_0x40a410,'gatewayBreakdown':_0x528ed3});}_0x1841fd['sort']((_0x1317bc,_0x36c8b6)=>_0x36c8b6[_0x143dc2(0x215)]-_0x1317bc[_0x143dc2(0x215)]);const _0x58f61e=_0x1841fd[_0x143dc2(0x238)],_0x36a027=_0x1841fd[_0x143dc2(0x226)]((_0x1d2452,_0x414d33)=>_0x1d2452+_0x414d33[_0x143dc2(0x1e5)],0x0),_0x1741c0=_0x1841fd[_0x143dc2(0x226)]((_0x530445,_0x186572)=>_0x530445+_0x186572[_0x143dc2(0x215)],0x0),_0x571b53=(_0x5b7051-0x1)*_0x25bd69,_0x4e6944=_0x1841fd['slice'](_0x571b53,_0x571b53+_0x25bd69);return console[_0x143dc2(0x276)](_0x143dc2(0x25e)+_0x4e6944[_0x143dc2(0x238)]+_0x143dc2(0x25d)+_0x58f61e+_0x143dc2(0x244)),console['log'](_0x143dc2(0x280)+_0x36a027[_0x143dc2(0x251)](0x2)+_0x143dc2(0x253)+_0x1741c0['toFixed'](0x2)+_0x143dc2(0x25b)),{'merchants':_0x4e6944,'pagination':{'page':_0x5b7051,'limit':_0x25bd69,'total':_0x58f61e,'totalPages':Math['ceil'](_0x58f61e/_0x25bd69)},'summary':{'totalMerchants':_0x58f61e,'totalAmountUSDT':Math[_0x143dc2(0x1f0)](_0x36a027*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x143dc2(0x1f0)](_0x1741c0*0x64)/0x64}};}async[a33_0x2b9ffc(0x212)](){const _0x225b0b=a33_0x2b9ffc;console[_0x225b0b(0x276)](_0x225b0b(0x217));const _0x5d94ad=await database_1[_0x225b0b(0x232)][_0x225b0b(0x23c)][_0x225b0b(0x267)]({'where':{'status':{'in':[_0x225b0b(0x1c9),_0x225b0b(0x278),'CHARGEBACK']}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'status':!![],'gateway':!![],'paidAt':!![],'merchantPaid':!![],'createdAt':!![],'chargebackAmount':!![],'shop':{'select':{'gatewaySettings':!![]}}}});console[_0x225b0b(0x276)]('üí∞\x20Found\x20'+_0x5d94ad['length']+'\x20payments\x20for\x20analysis\x20(PAID/REFUND/CHARGEBACK)');const _0x3cdaed=new Date(),_0x21b676=new Date(_0x3cdaed[_0x225b0b(0x29a)](),_0x3cdaed[_0x225b0b(0x211)](),0x1),_0xcfb1ab=new Date(_0x3cdaed[_0x225b0b(0x29a)](),_0x3cdaed[_0x225b0b(0x211)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7);let _0x72c0f5=0x0,_0x1c292f=0x0,_0x810ad9=0x0,_0x58e85f=0x0;for(const _0x3d14bc of _0x5d94ad){const _0x4810f7=this[_0x225b0b(0x1ea)](_0x3d14bc);if(_0x4810f7===0x0)continue;let _0x381331,_0x3e1e8c;if(_0x3d14bc[_0x225b0b(0x225)]===_0x225b0b(0x281))_0x381331=Math[_0x225b0b(0x1e4)](_0x4810f7),_0x3e1e8c=-_0x381331;else{_0x381331=await currencyService_1[_0x225b0b(0x1f8)]['convertToUSDT'](_0x3d14bc[_0x225b0b(0x24d)],_0x3d14bc['currency']);const _0x2e4b02=this[_0x225b0b(0x1ee)](_0x3d14bc[_0x225b0b(0x298)],_0x3d14bc[_0x225b0b(0x242)]);_0x3e1e8c=this['calculateAmountAfterCommission'](_0x381331,_0x2e4b02[_0x225b0b(0x208)]);}_0x3d14bc['merchantPaid']&&(_0x72c0f5+=_0x3e1e8c,_0x3d14bc[_0x225b0b(0x258)]&&_0x3d14bc['paidAt']>=_0x21b676&&_0x3d14bc['paidAt']<=_0xcfb1ab&&(_0x810ad9+=_0x3e1e8c)),_0x3d14bc[_0x225b0b(0x225)]===_0x225b0b(0x1c9)&&this[_0x225b0b(0x243)](_0x3d14bc)&&(_0x1c292f+=_0x3e1e8c,_0x58e85f+=_0x381331);}const _0x281d8d={'totalPayout':Math['round'](_0x72c0f5*0x64)/0x64,'awaitingPayout':Math[_0x225b0b(0x1f0)](_0x1c292f*0x64)/0x64,'thisMonth':Math[_0x225b0b(0x1f0)](_0x810ad9*0x64)/0x64,'availableBalance':Math['round'](_0x58e85f*0x64)/0x64};return console['log']('‚úÖ\x20Payout\x20statistics\x20calculated:'),console['log']('üí∏\x20Total\x20Payout:\x20'+_0x281d8d[_0x225b0b(0x241)]+_0x225b0b(0x290)),console['log'](_0x225b0b(0x200)+_0x281d8d[_0x225b0b(0x219)]+'\x20USDT\x20(—Ç–æ–ª—å–∫–æ\x20PAID\x20–ø–ª–∞—Ç–µ–∂–∏)'),console['log'](_0x225b0b(0x254)+_0x281d8d['thisMonth']+'\x20USDT'),console[_0x225b0b(0x276)](_0x225b0b(0x296)+_0x281d8d[_0x225b0b(0x202)]+_0x225b0b(0x1d2)),_0x281d8d;}async[a33_0x2b9ffc(0x1cf)](_0x4537db){const _0x55cfe6=a33_0x2b9ffc,_0x59a63f=this[_0x55cfe6(0x1e8)](_0x4537db),_0x1e4297=new Date();_0x1e4297[_0x55cfe6(0x23d)](_0x1e4297[_0x55cfe6(0x270)]()-_0x59a63f),console[_0x55cfe6(0x276)]('üìä\x20Generating\x20admin\x20statistics\x20for\x20period:\x20'+_0x4537db+'\x20('+_0x59a63f+_0x55cfe6(0x1ca));const _0x39d65d=await database_1['default'][_0x55cfe6(0x298)]['count']({'where':{'status':_0x55cfe6(0x26d)}}),_0x2cf68a=await database_1[_0x55cfe6(0x232)][_0x55cfe6(0x23c)][_0x55cfe6(0x252)](),_0x4c6e86=await database_1['default']['payment']['findMany']({'where':{'status':{'in':[_0x55cfe6(0x1c9),_0x55cfe6(0x278),_0x55cfe6(0x281)]}},'select':{'amount':!![],'currency':!![],'status':!![],'chargebackAmount':!![],'createdAt':!![]}});console[_0x55cfe6(0x276)](_0x55cfe6(0x28a)+_0x4c6e86[_0x55cfe6(0x238)]+_0x55cfe6(0x1cc));const _0x3ce918=await Promise[_0x55cfe6(0x1db)](_0x4c6e86[_0x55cfe6(0x28d)](async _0x21016c=>{const _0x2ff608=_0x55cfe6,_0x4d9a6d=this[_0x2ff608(0x1ea)](_0x21016c);if(_0x4d9a6d===0x0)return{'amount':0x0,'createdAt':_0x21016c[_0x2ff608(0x23b)]};let _0x44350f;return _0x21016c[_0x2ff608(0x225)]==='CHARGEBACK'?_0x44350f=-Math[_0x2ff608(0x1e4)](_0x4d9a6d):_0x44350f=await currencyService_1[_0x2ff608(0x1f8)][_0x2ff608(0x245)](_0x21016c[_0x2ff608(0x24d)],_0x21016c[_0x2ff608(0x1c8)]),{'amount':_0x44350f,'createdAt':_0x21016c['createdAt']};})),_0x219343=_0x3ce918[_0x55cfe6(0x226)]((_0x5b218f,_0x5944df)=>_0x5b218f+_0x5944df[_0x55cfe6(0x24d)],0x0),_0x40140f=_0x2cf68a>0x0?_0x219343/_0x2cf68a:0x0;console[_0x55cfe6(0x276)](_0x55cfe6(0x209)+_0x219343[_0x55cfe6(0x251)](0x2)+_0x55cfe6(0x290)),console[_0x55cfe6(0x276)]('üìà\x20Average\x20payment:\x20'+_0x40140f[_0x55cfe6(0x251)](0x2)+_0x55cfe6(0x1d2));const _0x2cb298=await database_1[_0x55cfe6(0x232)]['$queryRaw']`
      SELECT 
        DATE(created_at) as date,
        array_agg(
          json_build_object(
            'amount', amount,
            'currency', currency,
            'status', status,
            'chargeback_amount', chargeback_amount
          )
        ) as payments
      FROM payments 
      WHERE created_at >= ${_0x1e4297}
        AND status IN ('PAID', 'REFUND', 'CHARGEBACK')
      GROUP BY DATE(created_at)
      ORDER BY date ASC
    `;console[_0x55cfe6(0x276)](_0x55cfe6(0x1ce)+_0x2cb298[_0x55cfe6(0x238)]+_0x55cfe6(0x282));const _0x40d78e=await Promise[_0x55cfe6(0x1db)](_0x2cb298[_0x55cfe6(0x28d)](async _0x4524ee=>{const _0xc8469c=_0x55cfe6,_0x4acf47=await Promise[_0xc8469c(0x1db)](_0x4524ee[_0xc8469c(0x27e)][_0xc8469c(0x28d)](async _0x48418f=>{const _0xb186d4=_0xc8469c,_0x16d8d2=this['calculateEffectiveAmount'](_0x48418f);if(_0x16d8d2===0x0)return 0x0;return _0x48418f['status']===_0xb186d4(0x281)?-Math[_0xb186d4(0x1e4)](_0x16d8d2):await currencyService_1['currencyService'][_0xb186d4(0x245)](_0x48418f[_0xb186d4(0x24d)],_0x48418f[_0xb186d4(0x1c8)]);})),_0x319c64=_0x4acf47['reduce']((_0x5b7d97,_0x52db6a)=>_0x5b7d97+_0x52db6a,0x0);return{'date':_0x4524ee[_0xc8469c(0x206)]['toISOString']()['split']('T')[0x0],'amount':_0x319c64};})),_0x5e74b9=this[_0x55cfe6(0x273)](_0x1e4297,new Date()),_0x414c59=new Map(_0x40d78e[_0x55cfe6(0x28d)](_0x31b6e1=>[_0x31b6e1[_0x55cfe6(0x206)],_0x31b6e1[_0x55cfe6(0x24d)]])),_0x57a07a=_0x5e74b9[_0x55cfe6(0x28d)](_0x1a4ee2=>({'date':_0x1a4ee2,'amount':_0x414c59[_0x55cfe6(0x239)](_0x1a4ee2)||0x0}));return console[_0x55cfe6(0x276)]('‚úÖ\x20Admin\x20statistics\x20generated\x20successfully'),console[_0x55cfe6(0x276)]('üë•\x20Total\x20users:\x20'+_0x39d65d),console[_0x55cfe6(0x276)](_0x55cfe6(0x1dd)+_0x2cf68a),console[_0x55cfe6(0x276)](_0x55cfe6(0x222)+_0x57a07a[_0x55cfe6(0x238)]),{'totalRevenue':Math[_0x55cfe6(0x1f0)](_0x219343*0x64)/0x64,'totalUsers':_0x39d65d,'totalPayments':_0x2cf68a,'averagePayment':Math['round'](_0x40140f*0x64)/0x64,'dailyRevenue':_0x57a07a};}async['getAllPayments'](_0x2ad2a0){const _0x29d46a=a33_0x2b9ffc,{page:_0x4fab5e,limit:_0xa5fa6a,status:_0x494a61,gateway:_0x6b4aac,shopId:_0x400c63,dateFrom:_0x4a1ce1,dateTo:_0x58ab0f,search:_0x2d6568}=_0x2ad2a0,_0x49d50f=(_0x4fab5e-0x1)*_0xa5fa6a;console[_0x29d46a(0x276)]('üìã\x20Getting\x20payments\x20with\x20filters:',_0x2ad2a0);const _0x34c402={};_0x494a61&&(_0x34c402[_0x29d46a(0x225)]=_0x494a61['toUpperCase']());if(_0x6b4aac){if((0x0,gateway_1[_0x29d46a(0x248)])(_0x6b4aac)){const _0x16d808=(0x0,gateway_1[_0x29d46a(0x1dc)])(_0x6b4aac);_0x16d808&&(_0x34c402['gateway']=_0x16d808);}else _0x34c402[_0x29d46a(0x242)]=_0x6b4aac[_0x29d46a(0x28b)]();}_0x400c63&&(_0x34c402['shopId']=_0x400c63);(_0x4a1ce1||_0x58ab0f)&&(_0x34c402['createdAt']={},_0x4a1ce1&&(_0x34c402[_0x29d46a(0x23b)][_0x29d46a(0x204)]=new Date(_0x4a1ce1)),_0x58ab0f&&(_0x34c402[_0x29d46a(0x23b)][_0x29d46a(0x28e)]=new Date(_0x58ab0f)));_0x2d6568&&(_0x34c402['OR']=[{'orderId':{'contains':_0x2d6568,'mode':_0x29d46a(0x289)}},{'gatewayOrderId':{'contains':_0x2d6568,'mode':_0x29d46a(0x289)}},{'gatewayPaymentId':{'contains':_0x2d6568,'mode':_0x29d46a(0x289)}},{'customerEmail':{'contains':_0x2d6568,'mode':_0x29d46a(0x289)}},{'customerName':{'contains':_0x2d6568,'mode':_0x29d46a(0x289)}},{'shop':{'name':{'contains':_0x2d6568,'mode':_0x29d46a(0x289)}}},{'shop':{'username':{'contains':_0x2d6568,'mode':_0x29d46a(0x289)}}}]);const [_0xf239aa,_0x5a804b]=await Promise[_0x29d46a(0x1db)]([database_1[_0x29d46a(0x232)][_0x29d46a(0x23c)][_0x29d46a(0x267)]({'where':_0x34c402,'skip':_0x49d50f,'take':_0xa5fa6a,'orderBy':{'createdAt':_0x29d46a(0x1ef)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default'][_0x29d46a(0x23c)][_0x29d46a(0x252)]({'where':_0x34c402})]);console[_0x29d46a(0x276)](_0x29d46a(0x256)+_0xf239aa[_0x29d46a(0x238)]+'\x20payments\x20out\x20of\x20'+_0x5a804b+_0x29d46a(0x244));const _0x2e18cb=_0xf239aa[_0x29d46a(0x28d)](_0x573cde=>({'id':_0x573cde['id'],'shopId':_0x573cde[_0x29d46a(0x213)],'shopName':_0x573cde[_0x29d46a(0x298)]['name'],'shopUsername':_0x573cde[_0x29d46a(0x298)][_0x29d46a(0x28c)],'gateway':_0x573cde[_0x29d46a(0x242)],'orderId':_0x573cde[_0x29d46a(0x274)],'gatewayOrderId':_0x573cde[_0x29d46a(0x1e6)],'amount':_0x573cde[_0x29d46a(0x24d)],'currency':_0x573cde['currency'],'sourceCurrency':_0x573cde[_0x29d46a(0x220)],'status':_0x573cde['status'],'usage':_0x573cde[_0x29d46a(0x292)],'externalPaymentUrl':_0x573cde[_0x29d46a(0x210)],'gatewayPaymentId':_0x573cde[_0x29d46a(0x264)],'customerEmail':_0x573cde[_0x29d46a(0x1e3)],'customerName':_0x573cde[_0x29d46a(0x1d7)],'cardLast4':_0x573cde[_0x29d46a(0x265)],'paymentMethod':_0x573cde[_0x29d46a(0x283)],'bankId':_0x573cde[_0x29d46a(0x27d)],'remitterIban':_0x573cde[_0x29d46a(0x1c7)],'remitterName':_0x573cde['remitterName'],'chargebackAmount':_0x573cde[_0x29d46a(0x24a)],'adminNotes':_0x573cde[_0x29d46a(0x255)],'statusChangedBy':_0x573cde[_0x29d46a(0x26e)],'statusChangedAt':_0x573cde[_0x29d46a(0x240)],'createdAt':_0x573cde[_0x29d46a(0x23b)],'updatedAt':_0x573cde['updatedAt'],'expiresAt':_0x573cde[_0x29d46a(0x246)]}));return{'payments':_0x2e18cb,'pagination':{'page':_0x4fab5e,'limit':_0xa5fa6a,'total':_0x5a804b,'totalPages':Math[_0x29d46a(0x228)](_0x5a804b/_0xa5fa6a)}};}async[a33_0x2b9ffc(0x1d3)](_0x21f434){const _0xa0159c=a33_0x2b9ffc;console['log'](_0xa0159c(0x231)+_0x21f434);const _0x3b8df0=await database_1['default']['payment'][_0xa0159c(0x21c)]({'where':{'id':_0x21f434},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}},'webhookLogs':{'orderBy':{'createdAt':_0xa0159c(0x1ef)},'take':0xa,'select':{'id':!![],'event':!![],'statusCode':!![],'retryCount':!![],'createdAt':!![]}}}});if(!_0x3b8df0)return console[_0xa0159c(0x276)](_0xa0159c(0x1de)+_0x21f434),null;return console[_0xa0159c(0x276)](_0xa0159c(0x277)+_0x3b8df0['orderId']+'\x20('+_0x3b8df0[_0xa0159c(0x225)]+')'),{'id':_0x3b8df0['id'],'shopId':_0x3b8df0['shopId'],'shopName':_0x3b8df0[_0xa0159c(0x298)][_0xa0159c(0x263)],'shopUsername':_0x3b8df0[_0xa0159c(0x298)][_0xa0159c(0x28c)],'gateway':_0x3b8df0[_0xa0159c(0x242)],'orderId':_0x3b8df0[_0xa0159c(0x274)],'gatewayOrderId':_0x3b8df0[_0xa0159c(0x1e6)],'amount':_0x3b8df0[_0xa0159c(0x24d)],'currency':_0x3b8df0['currency'],'sourceCurrency':_0x3b8df0[_0xa0159c(0x220)],'status':_0x3b8df0['status'],'usage':_0x3b8df0['usage'],'externalPaymentUrl':_0x3b8df0[_0xa0159c(0x210)],'gatewayPaymentId':_0x3b8df0[_0xa0159c(0x264)],'customerEmail':_0x3b8df0[_0xa0159c(0x1e3)],'customerName':_0x3b8df0[_0xa0159c(0x1d7)],'cardLast4':_0x3b8df0[_0xa0159c(0x265)],'paymentMethod':_0x3b8df0[_0xa0159c(0x283)],'bankId':_0x3b8df0[_0xa0159c(0x27d)],'remitterIban':_0x3b8df0[_0xa0159c(0x1c7)],'remitterName':_0x3b8df0[_0xa0159c(0x21d)],'chargebackAmount':_0x3b8df0['chargebackAmount'],'adminNotes':_0x3b8df0[_0xa0159c(0x255)],'statusChangedBy':_0x3b8df0[_0xa0159c(0x26e)],'statusChangedAt':_0x3b8df0[_0xa0159c(0x240)],'createdAt':_0x3b8df0['createdAt'],'updatedAt':_0x3b8df0['updatedAt'],'expiresAt':_0x3b8df0[_0xa0159c(0x246)],'webhookLogs':_0x3b8df0[_0xa0159c(0x291)]};}async[a33_0x2b9ffc(0x1fc)](_0x313c30,_0x107851,_0x40b9bd,_0x5f01f2){const _0x9c214=a33_0x2b9ffc;console[_0x9c214(0x276)](_0x9c214(0x1d4)+_0x313c30+'\x20status\x20to:\x20'+_0x107851);const _0x2b0649=['PENDING',_0x9c214(0x1c9),_0x9c214(0x1f6),'FAILED',_0x9c214(0x278),'CHARGEBACK'];if(!_0x2b0649[_0x9c214(0x268)](_0x107851['toUpperCase']()))throw new Error(_0x9c214(0x27a)+_0x2b0649[_0x9c214(0x21e)](',\x20'));const _0x1dd35c=await database_1['default'][_0x9c214(0x23c)][_0x9c214(0x21c)]({'where':{'id':_0x313c30},'select':{'id':!![],'status':!![],'orderId':!![]}});if(!_0x1dd35c)throw new Error(_0x9c214(0x22a));if(_0x107851[_0x9c214(0x1f5)]()==='CHARGEBACK'){if(!_0x5f01f2||_0x5f01f2<=0x0)throw new Error(_0x9c214(0x207));console[_0x9c214(0x276)](_0x9c214(0x224)+_0x5f01f2+_0x9c214(0x257));}const _0x426200={'status':_0x107851[_0x9c214(0x1f5)](),'updatedAt':new Date(),'statusChangedBy':_0x9c214(0x23e),'statusChangedAt':new Date()};_0x40b9bd&&(_0x426200['adminNotes']=_0x40b9bd);_0x107851[_0x9c214(0x1f5)]()===_0x9c214(0x281)&&_0x5f01f2&&(_0x426200[_0x9c214(0x24a)]=_0x5f01f2);const _0x45daa8=await database_1[_0x9c214(0x232)]['payment'][_0x9c214(0x1cd)]({'where':{'id':_0x313c30},'data':_0x426200,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});return await database_1[_0x9c214(0x232)][_0x9c214(0x261)][_0x9c214(0x29c)]({'data':{'paymentId':_0x313c30,'shopId':_0x45daa8['shopId'],'event':_0x9c214(0x1fb),'statusCode':0xc8,'responseBody':JSON[_0x9c214(0x22f)]({'oldStatus':_0x1dd35c[_0x9c214(0x225)],'newStatus':_0x107851[_0x9c214(0x1f5)](),'notes':_0x40b9bd||null,'chargebackAmount':_0x5f01f2||null,'updatedBy':'admin','timestamp':new Date()[_0x9c214(0x1d1)]()})}}),console[_0x9c214(0x276)](_0x9c214(0x20b)+_0x1dd35c['orderId']+_0x9c214(0x25c)+_0x1dd35c['status']+_0x9c214(0x260)+_0x107851[_0x9c214(0x1f5)]()),_0x107851[_0x9c214(0x1f5)]()===_0x9c214(0x281)&&console[_0x9c214(0x276)](_0x9c214(0x1e2)+_0x5f01f2+_0x9c214(0x1fa)),{'id':_0x45daa8['id'],'shopId':_0x45daa8[_0x9c214(0x213)],'shopName':_0x45daa8[_0x9c214(0x298)]['name'],'shopUsername':_0x45daa8['shop'][_0x9c214(0x28c)],'gateway':_0x45daa8['gateway'],'orderId':_0x45daa8[_0x9c214(0x274)],'gatewayOrderId':_0x45daa8[_0x9c214(0x1e6)],'amount':_0x45daa8[_0x9c214(0x24d)],'currency':_0x45daa8[_0x9c214(0x1c8)],'sourceCurrency':_0x45daa8[_0x9c214(0x220)],'status':_0x45daa8[_0x9c214(0x225)],'usage':_0x45daa8[_0x9c214(0x292)],'externalPaymentUrl':_0x45daa8['externalPaymentUrl'],'gatewayPaymentId':_0x45daa8['gatewayPaymentId'],'customerEmail':_0x45daa8[_0x9c214(0x1e3)],'customerName':_0x45daa8[_0x9c214(0x1d7)],'cardLast4':_0x45daa8['cardLast4'],'paymentMethod':_0x45daa8[_0x9c214(0x283)],'bankId':_0x45daa8['bankId'],'remitterIban':_0x45daa8[_0x9c214(0x1c7)],'remitterName':_0x45daa8['remitterName'],'chargebackAmount':_0x45daa8[_0x9c214(0x24a)],'adminNotes':_0x45daa8[_0x9c214(0x255)],'statusChangedBy':_0x45daa8[_0x9c214(0x26e)],'statusChangedAt':_0x45daa8[_0x9c214(0x240)],'createdAt':_0x45daa8[_0x9c214(0x23b)],'updatedAt':_0x45daa8[_0x9c214(0x25f)],'expiresAt':_0x45daa8[_0x9c214(0x246)]};}async[a33_0x2b9ffc(0x21a)](_0xa819ec){const _0x43ce32=a33_0x2b9ffc,{page:_0x576693,limit:_0x416d73,status:_0x956fd0}=_0xa819ec,_0x1ffa73=(_0x576693-0x1)*_0x416d73,_0x4832e9={};_0x956fd0&&(_0x4832e9[_0x43ce32(0x225)]=_0x956fd0[_0x43ce32(0x1f5)]());console[_0x43ce32(0x276)](_0x43ce32(0x20c),{'page':_0x576693,'limit':_0x416d73,'status':_0x956fd0,'where':_0x4832e9});const [_0x21a069,_0x1fd89c]=await Promise[_0x43ce32(0x1db)]([database_1[_0x43ce32(0x232)]['shop'][_0x43ce32(0x267)]({'where':_0x4832e9,'skip':_0x1ffa73,'take':_0x416d73,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':'desc'}}),database_1[_0x43ce32(0x232)][_0x43ce32(0x298)][_0x43ce32(0x252)]({'where':_0x4832e9})]);console[_0x43ce32(0x276)](_0x43ce32(0x256)+_0x21a069[_0x43ce32(0x238)]+_0x43ce32(0x29b)+_0x1fd89c+'\x20total');const _0x1be0bb=_0x21a069['map'](_0x1bd191=>({'id':_0x1bd191['id'],'fullName':_0x1bd191['name'],'username':_0x1bd191[_0x43ce32(0x28c)],'telegramId':_0x1bd191['telegram'],'merchantUrl':_0x1bd191[_0x43ce32(0x24f)],'gateways':_0x1bd191[_0x43ce32(0x271)]?JSON[_0x43ce32(0x294)](_0x1bd191[_0x43ce32(0x271)]):null,'gatewaySettings':_0x1bd191[_0x43ce32(0x284)]?JSON[_0x43ce32(0x294)](_0x1bd191[_0x43ce32(0x284)]):null,'publicKey':_0x1bd191['publicKey'],'wallets':{'usdtPolygonWallet':_0x1bd191[_0x43ce32(0x223)],'usdtTrcWallet':_0x1bd191['usdtTrcWallet'],'usdtErcWallet':_0x1bd191['usdtErcWallet'],'usdcPolygonWallet':_0x1bd191[_0x43ce32(0x259)]},'status':_0x1bd191[_0x43ce32(0x225)],'createdAt':_0x1bd191[_0x43ce32(0x23b)]}));return{'users':_0x1be0bb,'pagination':{'page':_0x576693,'limit':_0x416d73,'total':_0x1fd89c,'totalPages':Math['ceil'](_0x1fd89c/_0x416d73)}};}async['getUserById'](_0xfdf48){const _0x1e8cdd=a33_0x2b9ffc;return await this[_0x1e8cdd(0x1f4)]['getUserById'](_0xfdf48);}async['createUser'](_0x5be43b){const _0x7cd57d=a33_0x2b9ffc;return await this[_0x7cd57d(0x1f4)][_0x7cd57d(0x27f)](_0x5be43b);}async['updateUser'](_0x518158,_0x403cd4){const _0x3fe0ac=a33_0x2b9ffc;return await this[_0x3fe0ac(0x1f4)][_0x3fe0ac(0x286)](_0x518158,_0x403cd4);}async['deleteUser'](_0x105f32){const _0x186315=a33_0x2b9ffc;return await this[_0x186315(0x1f4)][_0x186315(0x1e1)](_0x105f32);}async['suspendUser'](_0x31428a){const _0x4931f6=a33_0x2b9ffc;console['log'](_0x4931f6(0x287)+_0x31428a);const _0x462b47=await database_1[_0x4931f6(0x232)][_0x4931f6(0x298)]['findUnique']({'where':{'id':_0x31428a},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x462b47)throw new Error(_0x4931f6(0x20e));if(_0x462b47['status']==='SUSPENDED')throw new Error(_0x4931f6(0x1e9));const _0x361e08=await this[_0x4931f6(0x1f4)]['updateUser'](_0x31428a,{'status':_0x4931f6(0x27b)});return console['log']('‚úÖ\x20User\x20'+_0x462b47[_0x4931f6(0x28c)]+_0x4931f6(0x229)),_0x361e08;}async[a33_0x2b9ffc(0x22c)](_0x3e03f9){const _0x56d14a=a33_0x2b9ffc;console[_0x56d14a(0x276)](_0x56d14a(0x1d0)+_0x3e03f9);const _0x3f3f42=await database_1['default']['shop'][_0x56d14a(0x21c)]({'where':{'id':_0x3e03f9},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x3f3f42)throw new Error(_0x56d14a(0x20e));if(_0x3f3f42['status']===_0x56d14a(0x26d))throw new Error(_0x56d14a(0x24c));const _0x172311=await this[_0x56d14a(0x1f4)]['updateUser'](_0x3e03f9,{'status':_0x56d14a(0x26d)});return console[_0x56d14a(0x276)](_0x56d14a(0x275)+_0x3f3f42['username']+_0x56d14a(0x1da)),_0x172311;}}exports[a33_0x2b9ffc(0x22d)]=AdminService;