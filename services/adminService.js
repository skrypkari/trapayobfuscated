'use strict';const a36_0x2950f0=a36_0x9d7f;(function(_0xa25ba0,_0x41b6cb){const _0x2f4ae5=a36_0x9d7f,_0x17f418=_0xa25ba0();while(!![]){try{const _0x29763e=parseInt(_0x2f4ae5(0x1ba))/0x1*(-parseInt(_0x2f4ae5(0x121))/0x2)+parseInt(_0x2f4ae5(0x105))/0x3+parseInt(_0x2f4ae5(0x17f))/0x4*(-parseInt(_0x2f4ae5(0xfa))/0x5)+-parseInt(_0x2f4ae5(0xb4))/0x6+-parseInt(_0x2f4ae5(0x1e0))/0x7+-parseInt(_0x2f4ae5(0xca))/0x8*(parseInt(_0x2f4ae5(0xfc))/0x9)+parseInt(_0x2f4ae5(0x124))/0xa*(parseInt(_0x2f4ae5(0x12c))/0xb);if(_0x29763e===_0x41b6cb)break;else _0x17f418['push'](_0x17f418['shift']());}catch(_0xeef245){_0x17f418['push'](_0x17f418['shift']());}}}(a36_0x3202,0x1d9c6));function a36_0x9d7f(_0x1bcfa9,_0x13a464){const _0x320208=a36_0x3202();return a36_0x9d7f=function(_0x9d7fd5,_0xb25a19){_0x9d7fd5=_0x9d7fd5-0xa3;let _0x5254dd=_0x320208[_0x9d7fd5];return _0x5254dd;},a36_0x9d7f(_0x1bcfa9,_0x13a464);}var __importDefault=this&&this[a36_0x2950f0(0xd2)]||function(_0x223b76){const _0x3e6d18=a36_0x2950f0;return _0x223b76&&_0x223b76[_0x3e6d18(0x19d)]?_0x223b76:{'default':_0x223b76};};Object[a36_0x2950f0(0x181)](exports,'__esModule',{'value':!![]}),exports['AdminService']=void 0x0;function a36_0x3202(){const _0x100537=['getMonth','randomBytes','\x20\x20\x20✅\x20Actual\x20available\x20balance:\x20','customerCountry','\x20became\x20PAID:','sk_','lte','COMPLETED','merchantUrl','username','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','periodFrom','getSystemStatistics','usdtTrcWallet','\x20\x20\x20💰\x20Total\x20turnover:\x20','\x20\x20\x20📅\x20Total\x20payouts\x20(this\x20month):\x20','network','warn','getPaymentById','getGatewayNameById','📊\x20Final\x20WHERE\x20conditions:','paymentsCount','Rapyd','push','📊\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20','0000','availableBalance','🔧\x20[','Payment\x20not\x20found','\x20\x20\x20🌐\x20IP:\x20','696054zlwlac','30d','dailyRevenue','hash','create','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','split','Shop\x20not\x20found','set','getAllUsers','substr','\x27\x20not\x20found.\x20Available\x20gateways:\x20','currencyService','klyme_eu','\x20\x20\x20Transaction\x20hash:\x20','\x20\x20\x20🔍\x20Calculated\x20after\x20commission:\x20',',\x20successful:\x20','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','year','revenue','Test\x20Gateway','totalPayout','408aoVdvZ','values','getAllPayments','\x20PAID\x20payments',',\x20userId:\x20','getPayoutById','turnover','\x20\x20\x20Balance:\x20','__importDefault','\x20USDT','🎯\x20[','\x20to\x20','chargebackAmount','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','amountAfterGatewayCommissionUSDT','activateUser','wallets','merchantEarningsUSDT','\x20\x20\x20📊\x20Commission\x20difference:\x20','\x20\x20\x20Total\x20paid\x20out:\x20','test_gateway','\x20\x20\x20✅\x20Total\x20available\x20for\x20payout:\x20','amountAfterCommissionUSDT','currency','reduce','getMerchantStatistics','\x20\x20\x20🌍\x20Country:\x20','toLowerCase','not\x20set','parse','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','🔄\x20Gateway\x20mapping\x20(get):','updateUser','customerName','totalPaidOut','💰\x20Shop\x20','\x20USDT\x20(actual\x20balances)','admin','📊\x20Payout\x20statistics\x20calculated:','date','toUpperCase','periodTo','shopUrl','getFullYear','paidAt','averageCheckUSDT','CHARGEBACK','stringify','45bTSMsG','\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...','27963GlsEBU','usdtErcWallet','../config/database','\x20\x20\x20📅\x20This\x20month:\x20','log','\x20USDT,\x20merchant:\x20','_sum','payment','failUrl','717648UImcRD','asc','createdAt','getPayoutStats','update','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','hex','dateFrom','gatewayOrderId','\x20USDT,\x20Requested:\x20','💰\x20Current\x20shop\x20balance:\x20',']\x20Updating\x20password\x20for\x20user\x20','\x20active\x20merchants\x20for\x20selection','delete','📊\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','usdcPolygonWallet','getGatewayIdByName','getGatewayDisplayName','join','Username\x20already\x20exists','statusChangedAt','thisMonth','password','commissionUSDT','shop','setHours','rapyd','🔄\x20Admin\x20updating\x20payment\x20','6GyqyCM','getMerchantsSelection','gatewaySettings','10FCAYiR','error',',\x20Commission:\x20','totalTurnover','findMany','totalCommissionRate','findUnique','💰\x20[PAYOUT]\x20Merchant\x20','7967234flipFK','successUrl','forEach','\x20->\x20','\x20\x20\x20💰\x20Total\x20payout:\x20','getMerchantsAwaitingPayout','getGatewayInternalName','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','plisio','gatewayCommissionRate','\x20balance\x20updated:','\x20\x20\x20Payout\x20amount:\x20','shopId','90d','totalAmountUSDT','💰\x20Payment\x20','toString','\x20USDT\x20for\x20payment\x20','ACTIVE','status','usdtPolygonWallet','pendingUrl','adminNotes','📊\x20Available\x20gateways\x20in\x20database:','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','getAllPayouts','\x20in\x20','💰\x20Creating\x20payout\x20for\x20shop\x20','totalPayments','klyme_gb','📅\x20Period:\x20','🔐\x20[','\x20USDT)','trim','\x20for\x20shop\x20','random','💱\x20Currency\x20filter\x20applied:\x20','commission','all','REFUND','pendingPayout','failureMessage','dateTo','name','⚠️\x20Gateway\x20\x27','insensitive','\x20\x20\x20Gateway:\x20','💰\x20Found\x20','gateway','\x20USDT\x20(same\x20as\x20awaiting)','%\x20from\x20','AdminService','suspendUser','\x27\x20(from\x20\x27','count','balance','telegramId','📊\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','gte','yesterday','awaitingPayout','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','🔄\x20Gateway\x20mapping\x20(create):','crypto','📊\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','orderId','updatePaymentStatus','default','round','some','cointopay2','\x20\x20\x20Full\x20amount:\x20','convertToUSDT','💸\x20CHARGEBACK\x20penalty:\x20-','\x20USDT\x20(with\x20commission\x20deducted)','\x20USDT\x20(after\x20payouts)','map','noda','2020-01-01','🎯\x20updateUser\x20called\x20with\x20ID:\x20',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','📋\x20Found\x20','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','64364dWtUFA','\x20USDT\x20(-','defineProperty','localeCompare','\x20\x20\x20Merchant\x20loses:\x20','\x20no\x20longer\x20PAID:','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','../types/gateway','\x20\x20\x20🔍\x20Raw\x20balance\x20sum:\x20','deleteUser','whiteUrl','averageCommissionRate','externalPaymentUrl','_count','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','\x20\x20\x20💵\x20Available\x20balance:\x20','\x20balance\x20updated:\x20',']\x20Gateway\x20settings\x20JSON\x20string:','gatewayEarnings','amount','paymentGateways','Error\x20processing\x20payment\x20','toISOString','✅\x20Using\x20gateway\x20filter:\x20\x27','turnoverUSDT','customerEmail','customerIp','getTime','\x20USDT\x20(+','updatedAt','__esModule','NONEXISTENT_GATEWAY_FILTER','\x20\x20\x20💰\x20Total\x20payments\x20turnover:\x20','aggregate','desc','erc20','custom','\x20USDT\x20(total\x20paid\x20to\x20merchants)','generateDailyStatistics','📊\x20Calculating\x20payout\x20statistics...','\x27\x20to\x20name\x20\x27','\x20USDT\x20(','\x20\x20\x20⏳\x20Pending\x20payout:\x20','📊\x20Sorting\x20payments\x20by\x20','polygon_usdc','day','length','week','createUser','\x20\x20\x20Current\x20balance:\x20','getUserById','getDate','trc20','💸\x20CHARGEBACK:\x20Merchant\x20amount\x20already\x20deducted\x20from\x20balance','\x20payments)','\x20\x20\x20�\x20Total\x20paid\x20out:\x20','Insufficient\x20balance.\x20Available:\x20','publicKey','notes','76894fptoGy','\x20status:\x20','fullName','\x20USDT\x20(gross\x20revenue)','CoinToPay','PAID','pk_','groupBy',':\x20commission\x20=\x20','📊\x20Using\x20saved\x20values\x20for\x20payment\x20','setDate','period','gateways','updateCustomerData','month','ceil','./currencyService','txid','telegram','\x20merchants','\x20USDT\x20(after\x20','cointopay','payout','findFirst','🔄\x20Converted\x20gateway\x20name\x20\x27','toFixed','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','entries','⚠️\x20Payment\x20','merchantEarnings','amountUSDT','🔄\x20Converted\x20gateway\x20ID\x20\x27','✅\x20Payout\x20created:\x20','customerUa','statusChangedBy','SUSPENDED','🔄\x20Gateway\x20mapping:','\x20\x20\x20�\x20Total\x20payments\x20turnover:\x20','1345799AAXTue','totalAmountAfterCommissionUSDT'];a36_0x3202=function(){return _0x100537;};return a36_0x3202();}const database_1=__importDefault(require(a36_0x2950f0(0xfe))),bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a36_0x2950f0(0x16b))),currencyService_1=require(a36_0x2950f0(0x1ca)),gateway_1=require(a36_0x2950f0(0x186));class AdminService{async[a36_0x2950f0(0x108)](){const _0xecec62=a36_0x2950f0;console[_0xecec62(0x100)](_0xecec62(0x1a6));const _0x5ceb23=await database_1[_0xecec62(0x16f)][_0xecec62(0x11d)][_0xecec62(0x1a0)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':'ACTIVE'}}),_0x1375f8=await this[_0xecec62(0x131)]({'page':0x1,'limit':0x3e8}),_0x40a687=await database_1['default'][_0xecec62(0x103)][_0xecec62(0x162)]({'where':{'status':_0xecec62(0x1bf),'gateway':{'not':_0xecec62(0xde)}}}),_0x32475f=new Date(),_0x1bde63=new Date(_0x32475f[_0xecec62(0xf5)](),_0x32475f[_0xecec62(0x1e2)](),0x1),_0x232cad=new Date(_0x32475f[_0xecec62(0xf5)](),_0x32475f[_0xecec62(0x1e2)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x403f7c=await database_1[_0xecec62(0x16f)][_0xecec62(0x1d0)][_0xecec62(0x1a0)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x1bde63,'lte':_0x232cad},'status':_0xecec62(0x1e9)}}),_0x48ebef=_0x5ceb23[_0xecec62(0x102)][_0xecec62(0xec)]||0x0,_0x42bc7c=_0x1375f8['summary'][_0xecec62(0x1e1)],_0x123020=_0x403f7c['_sum'][_0xecec62(0x192)]||0x0,_0x2013a6={'totalPayout':Math['round'](_0x48ebef*0x64)/0x64,'awaitingPayout':Math[_0xecec62(0x170)](_0x42bc7c*0x64)/0x64,'thisMonth':Math['round'](_0x123020*0x64)/0x64,'availableBalance':Math[_0xecec62(0x170)](_0x42bc7c*0x64)/0x64,'totalPayments':_0x40a687};return console[_0xecec62(0x100)](_0xecec62(0xf0)),console[_0xecec62(0x100)](_0xecec62(0x130)+_0x2013a6[_0xecec62(0xc9)]+_0xecec62(0x1a4)),console[_0xecec62(0x100)](_0xecec62(0x133)+_0x2013a6[_0xecec62(0x168)]+_0xecec62(0x176)),console[_0xecec62(0x100)](_0xecec62(0x18e)+_0x2013a6[_0xecec62(0xb0)]+_0xecec62(0x15d)),console[_0xecec62(0x100)](_0xecec62(0xff)+_0x2013a6[_0xecec62(0x11a)]+'\x20USDT'),console[_0xecec62(0x100)]('\x20\x20\x20💳\x20Total\x20payments:\x20'+_0x2013a6['totalPayments']+_0xecec62(0xcd)),console[_0xecec62(0x100)](_0xecec62(0x187)+(_0x5ceb23[_0xecec62(0x102)][_0xecec62(0x163)]||0x0)[_0xecec62(0x1d3)](0x2)+'\x20USDT\x20(without\x20commission)'),console['log'](_0xecec62(0xdc)+((_0x5ceb23['_sum'][_0xecec62(0x163)]||0x0)-_0x42bc7c)['toFixed'](0x2)+'\x20USDT'),_0x2013a6;}async[a36_0x2950f0(0x1c7)](_0x174cfa,_0x41b7ee){const _0x5677bb=a36_0x2950f0;console[_0x5677bb(0x100)](_0x5677bb(0x1d4)+_0x174cfa+':',_0x41b7ee);const _0x42e792=await database_1[_0x5677bb(0x16f)][_0x5677bb(0x103)][_0x5677bb(0x12a)]({'where':{'id':_0x174cfa},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x42e792)throw new Error(_0x5677bb(0xb2));const _0x41306a={};_0x41b7ee[_0x5677bb(0x1e5)]!==undefined&&(_0x41306a['customerCountry']=_0x41b7ee[_0x5677bb(0x1e5)]||null);_0x41b7ee[_0x5677bb(0x199)]!==undefined&&(_0x41306a[_0x5677bb(0x199)]=_0x41b7ee[_0x5677bb(0x199)]||null);_0x41b7ee['customerUa']!==undefined&&(_0x41306a['customerUa']=_0x41b7ee['customerUa']||null);const _0x221de4=await database_1[_0x5677bb(0x16f)][_0x5677bb(0x103)][_0x5677bb(0x109)]({'where':{'id':_0x174cfa},'data':{..._0x41306a,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x5677bb(0x100)](_0x5677bb(0xb9)+_0x174cfa),console[_0x5677bb(0x100)](_0x5677bb(0xe4)+_0x42e792[_0x5677bb(0x1e5)]+_0x5677bb(0x12f)+_0x221de4[_0x5677bb(0x1e5)]),console[_0x5677bb(0x100)](_0x5677bb(0xb3)+_0x42e792['customerIp']+_0x5677bb(0x12f)+_0x221de4[_0x5677bb(0x199)]),console[_0x5677bb(0x100)]('\x20\x20\x20🖥️\x20User\x20Agent:\x20'+(_0x42e792[_0x5677bb(0x1db)]?_0x5677bb(0xbc):_0x5677bb(0xe6))+_0x5677bb(0x12f)+(_0x221de4[_0x5677bb(0x1db)]?_0x5677bb(0xbc):_0x5677bb(0xe6))),_0x221de4;}async[a36_0x2950f0(0x1ee)](_0x117706){const _0x34e37d=a36_0x2950f0,_0x2009dd=new Date();let _0x4c2ba7;switch(_0x117706['toLowerCase']()){case _0x34e37d(0x1ac):_0x4c2ba7=new Date(_0x2009dd[_0x34e37d(0xf5)](),_0x2009dd[_0x34e37d(0x1e2)](),_0x2009dd['getDate'](),0x0,0x0,0x0,0x0);break;case _0x34e37d(0x167):const _0x15e17f=new Date(_0x2009dd);_0x15e17f[_0x34e37d(0x1c4)](_0x15e17f[_0x34e37d(0x1b2)]()-0x1),_0x4c2ba7=new Date(_0x15e17f[_0x34e37d(0xf5)](),_0x15e17f[_0x34e37d(0x1e2)](),_0x15e17f[_0x34e37d(0x1b2)](),0x0,0x0,0x0,0x0);break;case'7d':_0x4c2ba7=new Date(_0x2009dd[_0x34e37d(0x19a)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x34e37d(0xb5):_0x4c2ba7=new Date(_0x2009dd[_0x34e37d(0x19a)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x34e37d(0x139):_0x4c2ba7=new Date(_0x2009dd[_0x34e37d(0x19a)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case'all':const _0x32b337=await database_1[_0x34e37d(0x16f)]['payment']['findFirst']({'where':{'gateway':{'not':_0x34e37d(0xde)}},'orderBy':{'createdAt':_0x34e37d(0x106)},'select':{'createdAt':!![]}});_0x4c2ba7=_0x32b337?_0x32b337[_0x34e37d(0x107)]:new Date(_0x34e37d(0x17a));break;default:_0x4c2ba7=new Date(_0x2009dd[_0x34e37d(0x19a)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}_0x4c2ba7[_0x34e37d(0x11e)](0x0,0x0,0x0,0x0);let _0x32b732;if(_0x117706[_0x34e37d(0xe5)]()===_0x34e37d(0x167)){const _0x5c8ac1=new Date(_0x2009dd);_0x5c8ac1['setDate'](_0x5c8ac1[_0x34e37d(0x1b2)]()-0x1),_0x32b732=new Date(_0x5c8ac1['getFullYear'](),_0x5c8ac1[_0x34e37d(0x1e2)](),_0x5c8ac1[_0x34e37d(0x1b2)](),0x17,0x3b,0x3b,0x3e7);}const _0x235913={'gte':_0x4c2ba7};_0x32b732&&(_0x235913[_0x34e37d(0x1e8)]=_0x32b732);const [_0x1e0350,_0x59c586,_0x18bfe0,_0x507006,_0x2fb62d,_0x41112c]=await Promise[_0x34e37d(0x152)]([database_1[_0x34e37d(0x16f)]['shop'][_0x34e37d(0x162)](),database_1[_0x34e37d(0x16f)]['shop'][_0x34e37d(0x162)]({'where':{'status':_0x34e37d(0x13e)}}),database_1['default'][_0x34e37d(0x103)][_0x34e37d(0x162)]({'where':{'status':_0x34e37d(0x1bf),'createdAt':_0x235913,'gateway':{'not':_0x34e37d(0xde)}}}),database_1[_0x34e37d(0x16f)][_0x34e37d(0x103)]['findMany']({'where':{'status':'PAID','createdAt':_0x235913,'gateway':{'not':_0x34e37d(0xde)}},'select':{'amount':!![],'currency':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x34e37d(0x16f)][_0x34e37d(0x103)][_0x34e37d(0x128)]({'where':{'gateway':{'not':_0x34e37d(0xde)}},'take':0xa,'orderBy':{'createdAt':_0x34e37d(0x1a1)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x34e37d(0x16f)]['payment'][_0x34e37d(0x128)]({'where':{'createdAt':_0x235913,'gateway':{'not':_0x34e37d(0xde)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x5d84ac=0x0,_0x58c932=0x0;for(const _0xf66b2f of _0x507006){const _0x33507a=await currencyService_1['currencyService'][_0x34e37d(0x174)](_0xf66b2f[_0x34e37d(0x192)],_0xf66b2f['currency']);_0x5d84ac+=_0x33507a;if(_0xf66b2f['amountAfterGatewayCommissionUSDT']){const _0xa3f5d6=await currencyService_1[_0x34e37d(0xc0)]['convertToUSDT'](_0xf66b2f[_0x34e37d(0x192)],_0xf66b2f[_0x34e37d(0xe1)]),_0x580f97=_0xf66b2f[_0x34e37d(0xd8)],_0x27c9fd=_0xa3f5d6-_0x580f97;_0x58c932+=_0x27c9fd;}}const _0x7fcb1c=_0x18bfe0>0x0?_0x5d84ac/_0x18bfe0:0x0,_0x482839=this['generateDailyStatistics'](_0x41112c,_0x4c2ba7,_0x32b732||_0x2009dd),_0x552008=await database_1[_0x34e37d(0x16f)]['payment']['count']({'where':{'createdAt':_0x235913,'gateway':{'not':_0x34e37d(0xde)}}}),_0x5e2185=_0x552008>0x0?_0x18bfe0/_0x552008*0x64:0x0;return{'totalShops':_0x1e0350,'activeShops':_0x59c586,'totalPayments':_0x18bfe0,'successfulPayments':_0x18bfe0,'totalAttempts':_0x552008,'totalRevenue':Math[_0x34e37d(0x170)](_0x5d84ac*0x64)/0x64,'trapayEarnings':Math[_0x34e37d(0x170)](_0x58c932*0x64)/0x64,'averagePaymentAmount':Math[_0x34e37d(0x170)](_0x7fcb1c*0x64)/0x64,'conversionRate':Math[_0x34e37d(0x170)](_0x5e2185*0x64)/0x64,'dailyRevenue':_0x482839[_0x34e37d(0xb6)],'dailyPayments':_0x482839['dailyPayments'],'recentPayments':_0x2fb62d[_0x34e37d(0x178)](_0x3e7af7=>({'id':_0x3e7af7['id'],'amount':_0x3e7af7[_0x34e37d(0x192)],'currency':_0x3e7af7[_0x34e37d(0xe1)],'status':_0x3e7af7[_0x34e37d(0x13f)],'gateway':_0x3e7af7[_0x34e37d(0x15c)],'shop':_0x3e7af7[_0x34e37d(0x11d)],'createdAt':_0x3e7af7[_0x34e37d(0x107)]}))};}async[a36_0x2950f0(0xe3)](_0x2a7c4a){const _0x2ccde3=a36_0x2950f0;console[_0x2ccde3(0x100)]('📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:',_0x2a7c4a);let _0xfd6e77,_0x3999d6=new Date();if(_0x2a7c4a[_0x2ccde3(0x1c5)]===_0x2ccde3(0x1a3)&&_0x2a7c4a[_0x2ccde3(0x10c)]&&_0x2a7c4a['dateTo'])_0xfd6e77=new Date(_0x2a7c4a[_0x2ccde3(0x10c)]),_0x3999d6=new Date(_0x2a7c4a[_0x2ccde3(0x156)]),_0xfd6e77['setHours'](0x0,0x0,0x0,0x0),_0x3999d6[_0x2ccde3(0x11e)](0x17,0x3b,0x3b,0x3e7);else{const _0x2db617=new Date();switch(_0x2a7c4a[_0x2ccde3(0x1c5)]){case _0x2ccde3(0x1ae):_0xfd6e77=new Date(_0x2db617[_0x2ccde3(0x19a)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x2ccde3(0x1c8):_0xfd6e77=new Date(_0x2db617[_0x2ccde3(0x19a)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x2ccde3(0xc6):_0xfd6e77=new Date(_0x2db617[_0x2ccde3(0x19a)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case'all':default:_0xfd6e77=new Date(_0x2ccde3(0x17a));break;}_0xfd6e77[_0x2ccde3(0x11e)](0x0,0x0,0x0,0x0),_0x3999d6[_0x2ccde3(0x11e)](0x17,0x3b,0x3b,0x3e7);}console[_0x2ccde3(0x100)](_0x2ccde3(0x14a)+_0xfd6e77[_0x2ccde3(0x195)]()+_0x2ccde3(0xd5)+_0x3999d6[_0x2ccde3(0x195)]());const _0x146d6b={'status':_0x2ccde3(0x1bf),'gateway':{'not':_0x2ccde3(0xde)},'paidAt':{'gte':_0xfd6e77,'lte':_0x3999d6}};_0x2a7c4a[_0x2ccde3(0x138)]&&(_0x146d6b['shopId']=_0x2a7c4a[_0x2ccde3(0x138)]);const _0xc1203c=await database_1[_0x2ccde3(0x16f)][_0x2ccde3(0x103)][_0x2ccde3(0x128)]({'where':_0x146d6b,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x2ccde3(0x100)](_0x2ccde3(0x15b)+_0xc1203c['length']+'\x20paid\x20payments\x20for\x20analysis');const _0x42745d={'gateway':{'not':'test_gateway'},'createdAt':{'gte':_0xfd6e77,'lte':_0x3999d6}};_0x2a7c4a[_0x2ccde3(0x138)]&&(_0x42745d[_0x2ccde3(0x138)]=_0x2a7c4a[_0x2ccde3(0x138)]);const _0x4e09d2=await database_1[_0x2ccde3(0x16f)][_0x2ccde3(0x103)][_0x2ccde3(0x162)]({'where':_0x42745d});console[_0x2ccde3(0x100)]('📊\x20Total\x20payments\x20(including\x20failed):\x20'+_0x4e09d2+_0x2ccde3(0xc4)+_0xc1203c[_0x2ccde3(0x1ad)]);let _0x56b851=0x0,_0x51b5f8=0x0,_0x585caa=0x0;const _0x4dd98e={},_0x57005d={},_0x1fe6b2={};for(const _0x8ac923 of _0xc1203c){try{const _0x4681db=_0x8ac923[_0x2ccde3(0x1d8)]||0x0;if(_0x4681db<=0x0){console[_0x2ccde3(0xa7)](_0x2ccde3(0x1d6)+_0x8ac923['id']+_0x2ccde3(0xfb));continue;}let _0x3695c8,_0x59ccac;if(_0x8ac923['amountAfterGatewayCommissionUSDT']!==null&&_0x8ac923['amountAfterGatewayCommissionUSDT']!==undefined)_0x3695c8=_0x8ac923['amountAfterGatewayCommissionUSDT'],_0x59ccac=_0x4681db-_0x3695c8,console[_0x2ccde3(0x100)](_0x2ccde3(0x1c3)+_0x8ac923['id']+':\x20'+_0x4681db[_0x2ccde3(0x1d3)](0x6)+_0x2ccde3(0x101)+_0x3695c8[_0x2ccde3(0x1d3)](0x6)+'\x20USDT');else{let _0x3aeaf6={};if(_0x8ac923['shop'][_0x2ccde3(0x123)])try{_0x3aeaf6=JSON[_0x2ccde3(0xe7)](_0x8ac923[_0x2ccde3(0x11d)][_0x2ccde3(0x123)]);}catch(_0xa40d80){console['error'](_0x2ccde3(0x169)+_0x8ac923[_0x2ccde3(0x138)]+':',_0xa40d80);}let _0x168e4a=0x2d;for(const [_0x3071f1,_0x5aa009]of Object[_0x2ccde3(0x1d5)](_0x3aeaf6)){if(_0x3071f1['toLowerCase']()===_0x8ac923[_0x2ccde3(0x15c)][_0x2ccde3(0xe5)]()){_0x168e4a=_0x5aa009[_0x2ccde3(0x151)]||0x2d;break;}}_0x59ccac=_0x4681db*(_0x168e4a/0x64),_0x3695c8=_0x4681db-_0x59ccac,console[_0x2ccde3(0x100)](_0x2ccde3(0x113)+_0x8ac923['id']+':\x20'+_0x168e4a+_0x2ccde3(0x15e)+_0x4681db[_0x2ccde3(0x1d3)](0x6)+_0x2ccde3(0xd3));}_0x56b851+=_0x4681db,_0x51b5f8+=_0x3695c8,_0x585caa+=_0x59ccac;let _0x2aee30;_0x8ac923['gatewayCommissionRate']!==null&&_0x8ac923[_0x2ccde3(0x135)]!==undefined?(_0x2aee30=_0x8ac923[_0x2ccde3(0x135)],console[_0x2ccde3(0x100)](_0x2ccde3(0xae)+_0x8ac923['id']+':\x20'+_0x2aee30+'%')):(_0x2aee30=_0x4681db>0x0?_0x59ccac/_0x4681db*0x64:0x0,console['log']('📊\x20Calculated\x20commission\x20rate\x20for\x20payment\x20'+_0x8ac923['id']+':\x20'+_0x2aee30['toFixed'](0x2)+'%'));!_0x4dd98e[_0x8ac923['gateway']]&&(_0x4dd98e[_0x8ac923[_0x2ccde3(0x15c)]]={'gateway':_0x8ac923[_0x2ccde3(0x15c)],'gatewayDisplayName':this[_0x2ccde3(0x116)](_0x8ac923[_0x2ccde3(0x15c)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x4dd98e[_0x8ac923['gateway']][_0x2ccde3(0xab)]++,_0x4dd98e[_0x8ac923[_0x2ccde3(0x15c)]][_0x2ccde3(0x197)]+=_0x4681db,_0x4dd98e[_0x8ac923[_0x2ccde3(0x15c)]][_0x2ccde3(0x11c)]+=_0x59ccac,_0x4dd98e[_0x8ac923[_0x2ccde3(0x15c)]][_0x2ccde3(0xdb)]+=_0x3695c8,_0x4dd98e[_0x8ac923[_0x2ccde3(0x15c)]][_0x2ccde3(0x129)]+=_0x2aee30;!_0x2a7c4a[_0x2ccde3(0x138)]&&(!_0x57005d[_0x8ac923[_0x2ccde3(0x138)]]&&(_0x57005d[_0x8ac923[_0x2ccde3(0x138)]]={'shopId':_0x8ac923[_0x2ccde3(0x138)],'shopName':_0x8ac923[_0x2ccde3(0x11d)][_0x2ccde3(0x157)],'shopUsername':_0x8ac923[_0x2ccde3(0x11d)][_0x2ccde3(0x1eb)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x57005d[_0x8ac923[_0x2ccde3(0x138)]][_0x2ccde3(0xab)]++,_0x57005d[_0x8ac923[_0x2ccde3(0x138)]]['turnoverUSDT']+=_0x4681db,_0x57005d[_0x8ac923['shopId']][_0x2ccde3(0x11c)]+=_0x59ccac,_0x57005d[_0x8ac923[_0x2ccde3(0x138)]][_0x2ccde3(0xdb)]+=_0x3695c8);const _0x352c07=_0x8ac923[_0x2ccde3(0xf6)][_0x2ccde3(0x195)]()[_0x2ccde3(0xba)]('T')[0x0];!_0x1fe6b2[_0x352c07]&&(_0x1fe6b2[_0x352c07]={'date':_0x352c07,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x1fe6b2[_0x352c07][_0x2ccde3(0xd0)]+=_0x4681db,_0x1fe6b2[_0x352c07][_0x2ccde3(0x1d7)]+=_0x3695c8,_0x1fe6b2[_0x352c07][_0x2ccde3(0x191)]+=_0x59ccac,_0x1fe6b2[_0x352c07]['paymentsCount']++;}catch(_0x1643fb){console[_0x2ccde3(0x125)](_0x2ccde3(0x194)+_0x8ac923['id']+':',_0x1643fb);}}Object[_0x2ccde3(0xcb)](_0x4dd98e)['forEach'](_0x2a32fe=>{const _0x4fe055=_0x2ccde3;_0x2a32fe[_0x4fe055(0x18a)]=_0x2a32fe[_0x4fe055(0xab)]>0x0?_0x2a32fe['totalCommissionRate']/_0x2a32fe[_0x4fe055(0xab)]:0x0,delete _0x2a32fe[_0x4fe055(0x129)];}),Object[_0x2ccde3(0xcb)](_0x57005d)[_0x2ccde3(0x12e)](_0x3b6019=>{const _0x18b27c=_0x2ccde3;_0x3b6019[_0x18b27c(0xf7)]=_0x3b6019[_0x18b27c(0xab)]>0x0?_0x3b6019['turnoverUSDT']/_0x3b6019[_0x18b27c(0xab)]:0x0;});let _0x164912=0x0,_0x39c414=0x0;if(_0x2a7c4a[_0x2ccde3(0x138)]){const _0x146105=await database_1['default'][_0x2ccde3(0x1d0)][_0x2ccde3(0x128)]({'where':{'shopId':_0x2a7c4a[_0x2ccde3(0x138)],'status':_0x2ccde3(0x1e9),'createdAt':{'gte':_0xfd6e77,'lte':_0x3999d6}},'select':{'amount':!![]}});_0x164912=_0x146105['reduce']((_0x21b23c,_0x3a8198)=>_0x21b23c+_0x3a8198[_0x2ccde3(0x192)],0x0);const _0x27ab3a=await database_1[_0x2ccde3(0x16f)][_0x2ccde3(0x1d0)]['findMany']({'where':{'shopId':_0x2a7c4a[_0x2ccde3(0x138)],'status':'PENDING','createdAt':{'gte':_0xfd6e77,'lte':_0x3999d6}},'select':{'amount':!![]}});_0x39c414=_0x27ab3a['reduce']((_0x24647c,_0x5792ec)=>_0x24647c+_0x5792ec['amount'],0x0);}const _0x447e31=_0x4e09d2,_0x4b16fd=_0xc1203c[_0x2ccde3(0x1ad)],_0x2e0a93=_0x4b16fd>0x0?_0x56b851/_0x4b16fd:0x0,_0x4f69d7=_0x447e31>0x0?Math['round'](_0x4b16fd/_0x447e31*0x2710)/0x64:0x0,_0x32b2d2=Math[_0x2ccde3(0x1c9)]((_0x3999d6[_0x2ccde3(0x19a)]()-_0xfd6e77[_0x2ccde3(0x19a)]())/(0x3e8*0x3c*0x3c*0x18)),_0x1f2245={'totalTurnover':Math[_0x2ccde3(0x170)](_0x56b851*0x64)/0x64,'merchantEarnings':Math[_0x2ccde3(0x170)](_0x51b5f8*0x64)/0x64,'gatewayEarnings':Math['round'](_0x585caa*0x64)/0x64,'totalPaidOut':Math[_0x2ccde3(0x170)](_0x164912*0x64)/0x64,'pendingPayout':Math[_0x2ccde3(0x170)](_0x39c414*0x64)/0x64,'averageCheck':Math['round'](_0x2e0a93*0x64)/0x64,'totalPayments':_0x447e31,'successfulPayments':_0x4b16fd,'conversionRate':_0x4f69d7,'gatewayBreakdown':Object[_0x2ccde3(0xcb)](_0x4dd98e)['map'](_0x5564d1=>({..._0x5564d1,'turnoverUSDT':Math[_0x2ccde3(0x170)](_0x5564d1['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x2ccde3(0x170)](_0x5564d1[_0x2ccde3(0x11c)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x2ccde3(0x170)](_0x5564d1['merchantEarningsUSDT']*0x64)/0x64,'averageCommissionRate':Math['round'](_0x5564d1[_0x2ccde3(0x18a)]*0x64)/0x64})),'merchantBreakdown':_0x2a7c4a[_0x2ccde3(0x138)]?undefined:Object[_0x2ccde3(0xcb)](_0x57005d)[_0x2ccde3(0x178)](_0xdbcc49=>({..._0xdbcc49,'turnoverUSDT':Math[_0x2ccde3(0x170)](_0xdbcc49['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x2ccde3(0x170)](_0xdbcc49[_0x2ccde3(0x11c)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0xdbcc49['merchantEarningsUSDT']*0x64)/0x64,'paidOutUSDT':Math['round'](_0xdbcc49['paidOutUSDT']*0x64)/0x64,'averageCheckUSDT':Math[_0x2ccde3(0x170)](_0xdbcc49[_0x2ccde3(0xf7)]*0x64)/0x64})),'dailyData':Object[_0x2ccde3(0xcb)](_0x1fe6b2)[_0x2ccde3(0x178)](_0x58dfd6=>({..._0x58dfd6,'turnover':Math[_0x2ccde3(0x170)](_0x58dfd6['turnover']*0x64)/0x64,'merchantEarnings':Math['round'](_0x58dfd6[_0x2ccde3(0x1d7)]*0x64)/0x64,'gatewayEarnings':Math[_0x2ccde3(0x170)](_0x58dfd6['gatewayEarnings']*0x64)/0x64}))['sort']((_0x945213,_0x1ff2b4)=>_0x945213[_0x2ccde3(0xf1)][_0x2ccde3(0x182)](_0x1ff2b4['date'])),'periodInfo':{'from':_0xfd6e77,'to':_0x3999d6,'periodType':_0x2a7c4a[_0x2ccde3(0x1c5)]||_0x2ccde3(0x1a3),'daysCount':_0x32b2d2}};return console[_0x2ccde3(0x100)]('📊\x20Merchant\x20statistics\x20calculated:'),console['log'](_0x2ccde3(0xa4)+_0x1f2245[_0x2ccde3(0x127)]+_0x2ccde3(0xd3)),console['log'](_0x2ccde3(0xc5)+_0x1f2245[_0x2ccde3(0x1d7)]+_0x2ccde3(0xd3)),console[_0x2ccde3(0x100)](_0x2ccde3(0x17e)+_0x1f2245['gatewayEarnings']+_0x2ccde3(0xd3)),console[_0x2ccde3(0x100)](_0x2ccde3(0x1b6)+_0x1f2245['totalPaidOut']+'\x20USDT'),console[_0x2ccde3(0x100)](_0x2ccde3(0x1a9)+_0x1f2245[_0x2ccde3(0x154)]+'\x20USDT'),console[_0x2ccde3(0x100)]('\x20\x20\x20�📊\x20Total\x20payments:\x20'+_0x1f2245[_0x2ccde3(0x148)]),_0x1f2245;}async[a36_0x2950f0(0x122)](){const _0x508820=a36_0x2950f0;console[_0x508820(0x100)]('📋\x20Getting\x20merchants\x20selection\x20list...');const _0x47328a=await database_1[_0x508820(0x16f)][_0x508820(0x11d)][_0x508820(0x128)]({'where':{'status':'ACTIVE'},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x508820(0x106)}});return console[_0x508820(0x100)](_0x508820(0x17d)+_0x47328a[_0x508820(0x1ad)]+_0x508820(0x111)),_0x47328a[_0x508820(0x178)](_0x3e8a8e=>({'id':_0x3e8a8e['id'],'username':_0x3e8a8e[_0x508820(0x1eb)],'name':_0x3e8a8e[_0x508820(0x157)]}));}[a36_0x2950f0(0x116)](_0x2e466c){const _0x62aa2=a36_0x2950f0,_0x39798a={'test_gateway':_0x62aa2(0xc8),'plisio':'Plisio','rapyd':_0x62aa2(0xac),'noda':'Noda','cointopay':_0x62aa2(0x1be),'cointopay2':'Open\x20Banking\x202','klyme_eu':'KLYME\x20EU','klyme_gb':'KLYME\x20GB','klyme_de':'KLYME\x20DE','mastercard':'MasterCard'};return _0x39798a[_0x2e466c]||_0x2e466c;}[a36_0x2950f0(0x132)](_0x2bc420){const _0x2eb6d2=a36_0x2950f0,_0x4ca98f={'Test\x20Gateway':_0x2eb6d2(0xde),'Plisio':_0x2eb6d2(0x134),'Rapyd':_0x2eb6d2(0x11f),'Noda':_0x2eb6d2(0x179),'CoinToPay':_0x2eb6d2(0x1cf),'CoinToPay2':_0x2eb6d2(0x172),'KLYME\x20EU':_0x2eb6d2(0xc1),'KLYME\x20GB':_0x2eb6d2(0x149),'KLYME\x20DE':'klyme_de','MasterCard':'mastercard'};return _0x4ca98f[_0x2bc420]||_0x2bc420['toLowerCase']();}async['getMerchantsAwaitingPayout'](_0x5f19c5){const _0x2310a6=a36_0x2950f0,{page:_0x21e43d,limit:_0x3b40f8,minAmount:_0x577217,search:_0x3d4724}=_0x5f19c5,_0x5f0580=(_0x21e43d-0x1)*_0x3b40f8;console[_0x2310a6(0x100)](_0x2310a6(0x18d),_0x5f19c5);const _0x3438e5={'balance':{'gt':0x0},'status':_0x2310a6(0x13e)};_0x577217&&(_0x3438e5[_0x2310a6(0x163)][_0x2310a6(0x166)]=_0x577217);_0x3d4724&&(_0x3438e5['name']={'contains':_0x3d4724,'mode':_0x2310a6(0x159)});const [_0x35bd09,_0x20b03c]=await Promise[_0x2310a6(0x152)]([database_1[_0x2310a6(0x16f)][_0x2310a6(0x11d)]['findMany']({'where':_0x3438e5,'skip':_0x5f0580,'take':_0x3b40f8,'orderBy':{'balance':_0x2310a6(0x1a1)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1['default'][_0x2310a6(0x11d)]['count']({'where':_0x3438e5})]);console[_0x2310a6(0x100)]('💰\x20Found\x20'+_0x35bd09[_0x2310a6(0x1ad)]+'\x20merchants\x20with\x20positive\x20balance');const _0x4fa5cc=await Promise[_0x2310a6(0x152)](_0x35bd09[_0x2310a6(0x178)](async _0x51dc8e=>{const _0x2c82fd=_0x2310a6,[_0x2f7571,_0x3c0336,_0x423e34]=await Promise[_0x2c82fd(0x152)]([database_1[_0x2c82fd(0x16f)][_0x2c82fd(0x103)]['count']({'where':{'shopId':_0x51dc8e['id'],'status':_0x2c82fd(0x1bf),'gateway':{'not':_0x2c82fd(0xde)}}}),database_1[_0x2c82fd(0x16f)][_0x2c82fd(0x103)][_0x2c82fd(0x1d1)]({'where':{'shopId':_0x51dc8e['id'],'status':_0x2c82fd(0x1bf),'gateway':{'not':_0x2c82fd(0xde)}},'orderBy':{'paidAt':_0x2c82fd(0x106)},'select':{'paidAt':!![]}}),database_1[_0x2c82fd(0x16f)][_0x2c82fd(0x103)][_0x2c82fd(0x1c1)]({'by':[_0x2c82fd(0x15c)],'where':{'shopId':_0x51dc8e['id'],'status':_0x2c82fd(0x1bf),'gateway':{'not':_0x2c82fd(0xde)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x144df5=new Date(),_0x268b80=new Date(_0x144df5[_0x2c82fd(0xf5)](),_0x144df5[_0x2c82fd(0x1e2)](),0x1),_0x2891c7=new Date(_0x144df5[_0x2c82fd(0xf5)](),_0x144df5[_0x2c82fd(0x1e2)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x4d796b,_0x2ce852]=await Promise[_0x2c82fd(0x152)]([database_1[_0x2c82fd(0x16f)][_0x2c82fd(0x1d0)][_0x2c82fd(0x1a0)]({'_sum':{'amount':!![]},'where':{'shopId':_0x51dc8e['id'],'status':_0x2c82fd(0x1e9)}}),database_1[_0x2c82fd(0x16f)][_0x2c82fd(0x1d0)][_0x2c82fd(0x1a0)]({'_sum':{'amount':!![]},'where':{'shopId':_0x51dc8e['id'],'status':_0x2c82fd(0x1e9),'createdAt':{'gte':_0x268b80,'lte':_0x2891c7}}})]),_0x3ae37a=_0x4d796b[_0x2c82fd(0x102)][_0x2c82fd(0x192)]||0x0,_0xb451b0=_0x2ce852[_0x2c82fd(0x102)][_0x2c82fd(0x192)]||0x0,_0x23c21e=await Promise[_0x2c82fd(0x152)](_0x423e34['map'](async _0xf5f1a5=>{const _0x109ad8=_0x2c82fd;let _0x5492ff=0x2d;if(_0x51dc8e[_0x109ad8(0x123)])try{const _0x38ffb2=JSON[_0x109ad8(0xe7)](_0x51dc8e[_0x109ad8(0x123)]);for(const [_0x1ef55d,_0xa2d456]of Object[_0x109ad8(0x1d5)](_0x38ffb2)){if(_0x1ef55d[_0x109ad8(0xe5)]()===_0xf5f1a5[_0x109ad8(0x15c)][_0x109ad8(0xe5)]()){_0x5492ff=_0xa2d456[_0x109ad8(0x151)]||0xa,console[_0x109ad8(0x100)]('💰\x20[PAYOUT]\x20Gateway\x20'+_0xf5f1a5[_0x109ad8(0x15c)]+_0x109ad8(0x14e)+_0x51dc8e['id']+_0x109ad8(0x1c2)+_0x5492ff+'%');break;}}}catch(_0x2fbb74){console[_0x109ad8(0x125)]('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x51dc8e['id']+':',_0x2fbb74);}const _0x14fb5f=_0xf5f1a5[_0x109ad8(0x102)]?.[_0x109ad8(0x1d8)]||0x0,_0x4d7b9b=_0x14fb5f*(0x1-_0x5492ff/0x64);return{'gateway':_0xf5f1a5['gateway'],'count':_0xf5f1a5['_count']?.['id']||0x0,'amountUSDT':Math[_0x109ad8(0x170)](_0x14fb5f*0x64)/0x64,'amountAfterCommissionUSDT':Math['round'](_0x4d7b9b*0x64)/0x64,'commission':_0x5492ff};})),_0x75a4c5=_0x23c21e[_0x2c82fd(0xe2)]((_0x422580,_0x1af3a5)=>_0x422580+_0x1af3a5[_0x2c82fd(0x1d8)],0x0),_0x4fb348=_0x51dc8e[_0x2c82fd(0x163)];return console[_0x2c82fd(0x100)](_0x2c82fd(0x12b)+_0x51dc8e[_0x2c82fd(0x1eb)]+':'),console[_0x2c82fd(0x100)](_0x2c82fd(0x1df)+_0x75a4c5[_0x2c82fd(0x1d3)](0x2)+'\x20USDT\x20(gross\x20revenue)'),console[_0x2c82fd(0x100)](_0x2c82fd(0xc3)+_0x23c21e['reduce']((_0x38c3e1,_0xacdc06)=>_0x38c3e1+_0xacdc06[_0x2c82fd(0xe0)],0x0)[_0x2c82fd(0x1d3)](0x2)+'\x20USDT\x20(theoretical\x20net)'),console[_0x2c82fd(0x100)](_0x2c82fd(0x1e4)+_0x4fb348[_0x2c82fd(0x1d3)](0x2)+_0x2c82fd(0x177)),{'id':_0x51dc8e['id'],'fullName':_0x51dc8e['name'],'username':_0x51dc8e[_0x2c82fd(0x1eb)],'telegramId':_0x51dc8e[_0x2c82fd(0x1cc)],'merchantUrl':_0x51dc8e['shopUrl'],'wallets':{'usdtPolygonWallet':_0x51dc8e['usdtPolygonWallet'],'usdtTrcWallet':_0x51dc8e[_0x2c82fd(0xa3)],'usdtErcWallet':_0x51dc8e[_0x2c82fd(0xfd)],'usdcPolygonWallet':_0x51dc8e['usdcPolygonWallet']},'totalAmountUSDT':Math[_0x2c82fd(0x170)](_0x75a4c5*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x2c82fd(0x170)](_0x4fb348*0x64)/0x64,'totalPayout':Math['round'](_0x3ae37a*0x64)/0x64,'thisMonth':Math[_0x2c82fd(0x170)](_0xb451b0*0x64)/0x64,'paymentsCount':_0x2f7571,'oldestPaymentDate':_0x3c0336?.[_0x2c82fd(0xf6)]||_0x51dc8e['createdAt'],'gatewayBreakdown':_0x23c21e};})),_0xb5563a=_0x4fa5cc[_0x2310a6(0xe2)]((_0x50de36,_0x37b112)=>_0x50de36+_0x37b112[_0x2310a6(0x13a)],0x0),_0x1a0739=_0x4fa5cc['reduce']((_0x2a2b13,_0x4dd6c6)=>_0x2a2b13+_0x4dd6c6[_0x2310a6(0x1e1)],0x0),_0x337d7a=_0x4fa5cc[_0x2310a6(0xe2)]((_0x1618cd,_0x12c436)=>_0x1618cd+_0x12c436[_0x2310a6(0xc9)],0x0),_0x22719f=_0x4fa5cc[_0x2310a6(0xe2)]((_0x40ea17,_0x114b44)=>_0x40ea17+_0x114b44[_0x2310a6(0x11a)],0x0);return console[_0x2310a6(0x100)]('📊\x20Merchants\x20awaiting\x20payout:\x20'+_0x20b03c+_0x2310a6(0x1cd)),console['log'](_0x2310a6(0x19f)+Math[_0x2310a6(0x170)](_0xb5563a*0x64)/0x64+_0x2310a6(0x1bd)),console[_0x2310a6(0x100)](_0x2310a6(0xdf)+Math[_0x2310a6(0x170)](_0x1a0739*0x64)/0x64+_0x2310a6(0xee)),console['log']('\x20\x20\x20💸\x20Total\x20payouts\x20(all\x20time):\x20'+Math[_0x2310a6(0x170)](_0x337d7a*0x64)/0x64+_0x2310a6(0xd3)),console[_0x2310a6(0x100)](_0x2310a6(0xa5)+Math[_0x2310a6(0x170)](_0x22719f*0x64)/0x64+'\x20USDT'),{'merchants':_0x4fa5cc,'pagination':{'page':_0x21e43d,'limit':_0x3b40f8,'total':_0x20b03c,'totalPages':Math[_0x2310a6(0x1c9)](_0x20b03c/_0x3b40f8)},'summary':{'totalMerchants':_0x20b03c,'totalAmountUSDT':Math[_0x2310a6(0x170)](_0xb5563a*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x2310a6(0x170)](_0x1a0739*0x64)/0x64,'totalPayout':Math[_0x2310a6(0x170)](_0x337d7a*0x64)/0x64,'thisMonth':Math[_0x2310a6(0x170)](_0x22719f*0x64)/0x64}};}async['createPayout'](_0x3e80a0){const _0x217485=a36_0x2950f0,{shopId:_0x5745e0,amount:_0xec7daf,network:_0x35f4fc,wallet:_0x7042fc,notes:_0x511ec1,txid:_0x53291e,periodFrom:_0x197aa3,periodTo:_0x5a1fc6}=_0x3e80a0,_0x53937d=await database_1[_0x217485(0x16f)]['$transaction'](async _0x45f5cf=>{const _0x34a4c3=_0x217485,_0x435dcb=await _0x45f5cf[_0x34a4c3(0x11d)][_0x34a4c3(0x12a)]({'where':{'id':_0x5745e0},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x435dcb)throw new Error(_0x34a4c3(0xbb));console['log'](_0x34a4c3(0x147)+_0x435dcb[_0x34a4c3(0x1eb)]+':'),console[_0x34a4c3(0x100)](_0x34a4c3(0x1b0)+_0x435dcb['balance'][_0x34a4c3(0x1d3)](0x6)+'\x20USDT'),console[_0x34a4c3(0x100)](_0x34a4c3(0x137)+_0xec7daf['toFixed'](0x6)+'\x20USDT'),console[_0x34a4c3(0x100)](_0x34a4c3(0xe8)+_0x435dcb[_0x34a4c3(0xec)][_0x34a4c3(0x1d3)](0x6)+_0x34a4c3(0xd3));if(_0x53291e)console[_0x34a4c3(0x100)](_0x34a4c3(0xc2)+_0x53291e);if(_0x435dcb[_0x34a4c3(0x163)]<_0xec7daf)throw new Error(_0x34a4c3(0x1b7)+_0x435dcb['balance'][_0x34a4c3(0x1d3)](0x6)+_0x34a4c3(0x10e)+_0xec7daf[_0x34a4c3(0x1d3)](0x6)+_0x34a4c3(0xd3));let _0x45cc99=_0x7042fc;if(!_0x45cc99){const _0x39536a=await _0x45f5cf[_0x34a4c3(0x11d)][_0x34a4c3(0x12a)]({'where':{'id':_0x5745e0},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x39536a)switch(_0x35f4fc){case'polygon':_0x45cc99=_0x39536a[_0x34a4c3(0x140)]||undefined;break;case _0x34a4c3(0x1b3):_0x45cc99=_0x39536a['usdtTrcWallet']||undefined;break;case _0x34a4c3(0x1a2):_0x45cc99=_0x39536a[_0x34a4c3(0xfd)]||undefined;break;case _0x34a4c3(0x1ab):_0x45cc99=_0x39536a[_0x34a4c3(0x114)]||undefined;break;}}console[_0x34a4c3(0x100)]('💳\x20Payout\x20wallet\x20for\x20'+_0x35f4fc+':\x20'+(_0x45cc99||'not\x20specified'));const _0x175e09=await _0x45f5cf[_0x34a4c3(0x1d0)]['create']({'data':{'shopId':_0x5745e0,'amount':_0xec7daf,'network':_0x35f4fc,'status':_0x34a4c3(0x1e9),'txid':_0x53291e,'notes':_0x511ec1,'periodFrom':_0x197aa3?new Date(_0x197aa3):null,'periodTo':_0x5a1fc6?new Date(_0x5a1fc6):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x3bdbc3=_0x435dcb['balance']-_0xec7daf,_0x29826f=_0x435dcb[_0x34a4c3(0xec)]+_0xec7daf;return await _0x45f5cf['shop'][_0x34a4c3(0x109)]({'where':{'id':_0x5745e0},'data':{'balance':_0x3bdbc3,'totalPaidOut':_0x29826f}}),console[_0x34a4c3(0x100)](_0x34a4c3(0xed)+_0x435dcb[_0x34a4c3(0x1eb)]+_0x34a4c3(0x136)),console[_0x34a4c3(0x100)](_0x34a4c3(0xd1)+_0x435dcb[_0x34a4c3(0x163)][_0x34a4c3(0x1d3)](0x6)+_0x34a4c3(0x12f)+_0x3bdbc3[_0x34a4c3(0x1d3)](0x6)+_0x34a4c3(0x180)+_0xec7daf[_0x34a4c3(0x1d3)](0x6)+')'),console[_0x34a4c3(0x100)](_0x34a4c3(0xdd)+_0x435dcb[_0x34a4c3(0xec)][_0x34a4c3(0x1d3)](0x6)+_0x34a4c3(0x12f)+_0x29826f['toFixed'](0x6)+_0x34a4c3(0x19b)+_0xec7daf['toFixed'](0x6)+')'),{'payout':_0x175e09,'shop':_0x435dcb};});return console[_0x217485(0x100)](_0x217485(0x1da)+_0x53937d['payout']['id']+'\x20for\x20shop\x20'+_0x53937d[_0x217485(0x11d)][_0x217485(0x1eb)]+'\x20('+_0xec7daf+_0x217485(0x14c)),{'id':_0x53937d[_0x217485(0x1d0)]['id'],'shopId':_0x53937d['payout'][_0x217485(0x138)],'shopName':_0x53937d[_0x217485(0x11d)][_0x217485(0x157)],'shopUsername':_0x53937d['shop']['username'],'amount':_0x53937d[_0x217485(0x1d0)][_0x217485(0x192)],'network':_0x53937d[_0x217485(0x1d0)][_0x217485(0xa6)],'status':_0x53937d[_0x217485(0x1d0)]['status'],'txid':_0x53937d['payout']['txid'],'notes':_0x53937d[_0x217485(0x1d0)][_0x217485(0x1b9)],'periodFrom':_0x53937d[_0x217485(0x1d0)][_0x217485(0x1ed)],'periodTo':_0x53937d['payout'][_0x217485(0xf3)],'createdAt':_0x53937d[_0x217485(0x1d0)][_0x217485(0x107)],'paidAt':_0x53937d[_0x217485(0x1d0)][_0x217485(0xf6)]};}async[a36_0x2950f0(0x145)](_0x83270){const _0x112797=a36_0x2950f0,{page:_0x595d0c,limit:_0x2a2c73,shopId:_0x1b371c,network:_0x1686e4,dateFrom:_0x2f1ee7,dateTo:_0x5d77e0,search:_0x38952c}=_0x83270,_0x39eb8c=(_0x595d0c-0x1)*_0x2a2c73,_0x774d9={};_0x1b371c&&(_0x774d9[_0x112797(0x138)]=_0x1b371c);_0x1686e4&&(_0x774d9['network']=_0x1686e4);(_0x2f1ee7||_0x5d77e0)&&(_0x774d9[_0x112797(0x107)]={},_0x2f1ee7&&(_0x774d9[_0x112797(0x107)][_0x112797(0x166)]=new Date(_0x2f1ee7)),_0x5d77e0&&(_0x774d9['createdAt'][_0x112797(0x1e8)]=new Date(_0x5d77e0)));_0x38952c&&(_0x774d9['OR']=[{'shop':{'name':{'contains':_0x38952c,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x38952c,'mode':_0x112797(0x159)}}},{'notes':{'contains':_0x38952c,'mode':'insensitive'}}]);const [_0x29aa14,_0x168bc7]=await Promise[_0x112797(0x152)]([database_1['default'][_0x112797(0x1d0)]['findMany']({'where':_0x774d9,'skip':_0x39eb8c,'take':_0x2a2c73,'orderBy':{'createdAt':_0x112797(0x1a1)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x112797(0x1d0)][_0x112797(0x162)]({'where':_0x774d9})]);return{'payouts':_0x29aa14[_0x112797(0x178)](_0x335fcb=>({'id':_0x335fcb['id'],'shopId':_0x335fcb[_0x112797(0x138)],'shopName':_0x335fcb[_0x112797(0x11d)][_0x112797(0x157)],'shopUsername':_0x335fcb[_0x112797(0x11d)][_0x112797(0x1eb)],'amount':_0x335fcb[_0x112797(0x192)],'network':_0x335fcb[_0x112797(0xa6)],'status':_0x335fcb[_0x112797(0x13f)],'txid':_0x335fcb[_0x112797(0x1cb)],'notes':_0x335fcb[_0x112797(0x1b9)],'periodFrom':_0x335fcb['periodFrom'],'periodTo':_0x335fcb[_0x112797(0xf3)],'createdAt':_0x335fcb[_0x112797(0x107)],'paidAt':_0x335fcb['paidAt']})),'pagination':{'page':_0x595d0c,'limit':_0x2a2c73,'total':_0x168bc7,'totalPages':Math[_0x112797(0x1c9)](_0x168bc7/_0x2a2c73)}};}async[a36_0x2950f0(0xcf)](_0x316f93){const _0x2998db=a36_0x2950f0,_0x199376=await database_1['default']['payout'][_0x2998db(0x12a)]({'where':{'id':_0x316f93},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x199376)return null;return{'id':_0x199376['id'],'shopId':_0x199376[_0x2998db(0x138)],'shopName':_0x199376[_0x2998db(0x11d)][_0x2998db(0x157)],'shopUsername':_0x199376[_0x2998db(0x11d)]['username'],'amount':_0x199376[_0x2998db(0x192)],'network':_0x199376[_0x2998db(0xa6)],'status':_0x199376[_0x2998db(0x13f)],'txid':_0x199376[_0x2998db(0x1cb)],'notes':_0x199376[_0x2998db(0x1b9)],'periodFrom':_0x199376[_0x2998db(0x1ed)],'periodTo':_0x199376[_0x2998db(0xf3)],'createdAt':_0x199376[_0x2998db(0x107)],'paidAt':_0x199376['paidAt']};}async['deletePayout'](_0x45d7eb){const _0x390268=a36_0x2950f0;await database_1[_0x390268(0x16f)][_0x390268(0x1d0)][_0x390268(0x112)]({'where':{'id':_0x45d7eb}});}async[a36_0x2950f0(0xcc)](_0xffc898){const _0x2f805=a36_0x2950f0,{page:_0x6abb8e,limit:_0x18c170,status:_0x461b12,gateway:_0x152d91,shopId:_0x7e36be,dateFrom:_0x4c945d,dateTo:_0x137718,search:_0x5011f8,currency:_0x46a2b6,sortBy:_0x44187d,sortOrder:_0x15b7a3}=_0xffc898,_0x59b338=(_0x6abb8e-0x1)*_0x18c170;console[_0x2f805(0x100)]('📊\x20Getting\x20payments\x20with\x20filters:',_0xffc898);const _0x324868=await database_1['default'][_0x2f805(0x103)]['groupBy']({'by':[_0x2f805(0x15c)],'_count':{'gateway':!![]}});console[_0x2f805(0x100)](_0x2f805(0x143),_0x324868[_0x2f805(0x178)](_0x3b0170=>_0x3b0170[_0x2f805(0x15c)]+'\x20('+_0x3b0170[_0x2f805(0x18c)][_0x2f805(0x15c)]+_0x2f805(0x1b5)));if(_0x152d91){const _0x4d2487=_0x324868[_0x2f805(0x171)](_0x1f7d6d=>_0x1f7d6d['gateway'][_0x2f805(0xe5)]()===_0x152d91[_0x2f805(0xe5)]());!_0x4d2487&&_0x152d91['toLowerCase']()!==_0x2f805(0xde)&&console['log']('⚠️\x20Requested\x20gateway\x20\x27'+_0x152d91+_0x2f805(0xbf)+_0x324868[_0x2f805(0x178)](_0x528f91=>_0x528f91[_0x2f805(0x15c)])[_0x2f805(0x117)](',\x20'));}const _0x172fb0={};_0x461b12&&(_0x172fb0[_0x2f805(0x13f)]=_0x461b12[_0x2f805(0xf2)]());if(!_0x152d91)_0x172fb0['gateway']={'not':_0x2f805(0xde)};else{if(_0x152d91&&(_0x152d91[_0x2f805(0xe5)]()===_0x2f805(0xde)||_0x152d91===_0x2f805(0xaf)))_0x172fb0['gateway']=_0x2f805(0xde);else{let _0x374726=_0x152d91;const _0x456e79=(0x0,gateway_1[_0x2f805(0xa9)])(_0x152d91);if(_0x456e79)_0x374726=_0x456e79,console[_0x2f805(0x100)](_0x2f805(0x1d9)+_0x152d91+_0x2f805(0x1a7)+_0x374726+'\x27');else{const _0xcddc69=(0x0,gateway_1[_0x2f805(0x115)])(_0x152d91);if(_0xcddc69){const _0x2d9c78=(0x0,gateway_1[_0x2f805(0xa9)])(_0xcddc69);_0x2d9c78&&(_0x374726=_0x2d9c78,console['log'](_0x2f805(0x1d2)+_0x152d91+'\x27\x20->\x20ID\x20\x27'+_0xcddc69+'\x27\x20->\x20name\x20\x27'+_0x374726+'\x27'));}else console['log']('🔍\x20Using\x20gateway\x20\x27'+_0x152d91+_0x2f805(0x185));}const _0x3307d4=await database_1[_0x2f805(0x16f)]['payment']['count']({'where':{'gateway':_0x374726[_0x2f805(0xe5)]()},'take':0x1});_0x3307d4===0x0?(console[_0x2f805(0x100)](_0x2f805(0x158)+_0x374726+_0x2f805(0x161)+_0x152d91+_0x2f805(0x144)),_0x172fb0[_0x2f805(0x15c)]=_0x2f805(0x19e)):(_0x172fb0[_0x2f805(0x15c)]=_0x374726[_0x2f805(0xe5)](),console[_0x2f805(0x100)](_0x2f805(0x196)+_0x374726+_0x2f805(0x161)+_0x152d91+'\x27)'));}}console['log']('📊\x20Gateway\x20filter\x20applied:',_0x172fb0[_0x2f805(0x15c)]);_0x7e36be&&(_0x172fb0[_0x2f805(0x138)]=_0x7e36be);_0x46a2b6&&(_0x172fb0[_0x2f805(0xe1)]=_0x46a2b6[_0x2f805(0xf2)](),console[_0x2f805(0x100)](_0x2f805(0x150)+_0x46a2b6[_0x2f805(0xf2)]()));(_0x4c945d||_0x137718)&&(_0x172fb0[_0x2f805(0x107)]={},_0x4c945d&&(_0x172fb0[_0x2f805(0x107)][_0x2f805(0x166)]=new Date(_0x4c945d)),_0x137718&&(_0x172fb0[_0x2f805(0x107)][_0x2f805(0x1e8)]=new Date(_0x137718)));_0x5011f8&&(_0x172fb0['OR']=[{'id':{'contains':_0x5011f8,'mode':'insensitive'}},{'orderId':{'contains':_0x5011f8,'mode':_0x2f805(0x159)}},{'gatewayOrderId':{'contains':_0x5011f8,'mode':_0x2f805(0x159)}},{'customerEmail':{'contains':_0x5011f8,'mode':'insensitive'}},{'shop':{'name':{'contains':_0x5011f8,'mode':_0x2f805(0x159)}}},{'shop':{'username':{'contains':_0x5011f8,'mode':_0x2f805(0x159)}}}]);console['log'](_0x2f805(0xaa),JSON['stringify'](_0x172fb0,null,0x2));let _0x21a261={'createdAt':'desc'};if(_0x44187d){const _0x460b71=['amount',_0x2f805(0x107),_0x2f805(0x19c),_0x2f805(0x13f),_0x2f805(0x15c),_0x2f805(0xe1)],_0x116445=[_0x2f805(0x106),'desc'];if(_0x460b71['includes'](_0x44187d)){const _0x35d428=_0x116445['includes'](_0x15b7a3)?_0x15b7a3:_0x2f805(0x1a1);_0x21a261={[_0x44187d]:_0x35d428},console[_0x2f805(0x100)](_0x2f805(0x1aa)+_0x44187d+_0x2f805(0x146)+_0x35d428+'\x20order');}}const [_0x2991c7,_0x4ba088]=await Promise[_0x2f805(0x152)]([database_1[_0x2f805(0x16f)]['payment']['findMany']({'where':_0x172fb0,'skip':_0x59b338,'take':_0x18c170,'orderBy':_0x21a261,'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x2f805(0x16f)][_0x2f805(0x103)][_0x2f805(0x162)]({'where':_0x172fb0})]);return{'payments':_0x2991c7,'pagination':{'page':_0x6abb8e,'limit':_0x18c170,'total':_0x4ba088,'totalPages':Math[_0x2f805(0x1c9)](_0x4ba088/_0x18c170)}};}async[a36_0x2950f0(0xa8)](_0x23d6a4){const _0x69e9d2=a36_0x2950f0,_0x486807=await database_1[_0x69e9d2(0x16f)][_0x69e9d2(0x103)]['findUnique']({'where':{'id':_0x23d6a4},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x486807)return null;return{'id':_0x486807['id'],'shopId':_0x486807[_0x69e9d2(0x138)],'gateway':_0x486807['gateway'],'amount':_0x486807[_0x69e9d2(0x192)],'currency':_0x486807[_0x69e9d2(0xe1)],'status':_0x486807[_0x69e9d2(0x13f)],'orderId':_0x486807[_0x69e9d2(0x16d)],'gatewayOrderId':_0x486807['gatewayOrderId'],'customerEmail':_0x486807[_0x69e9d2(0x198)],'customerName':_0x486807['customerName'],'customerCountry':_0x486807[_0x69e9d2(0x1e5)],'customerIp':_0x486807[_0x69e9d2(0x199)],'customerUa':_0x486807['customerUa'],'failureMessage':_0x486807[_0x69e9d2(0x155)],'externalPaymentUrl':_0x486807[_0x69e9d2(0x18b)],'successUrl':_0x486807[_0x69e9d2(0x12d)],'failUrl':_0x486807[_0x69e9d2(0x104)],'pendingUrl':_0x486807[_0x69e9d2(0x141)],'whiteUrl':_0x486807[_0x69e9d2(0x189)],'createdAt':_0x486807[_0x69e9d2(0x107)],'updatedAt':_0x486807[_0x69e9d2(0x19c)],'shop':_0x486807['shop']};}async[a36_0x2950f0(0x16e)](_0x235c32,_0x5709e9,_0x92856a,_0x26fb2d){const _0x16ac43=a36_0x2950f0,_0x1bace9=await database_1['default']['$transaction'](async _0x242e18=>{const _0x45363=a36_0x9d7f,_0x4b8eed=await _0x242e18[_0x45363(0x103)][_0x45363(0x12a)]({'where':{'id':_0x235c32},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x4b8eed)throw new Error(_0x45363(0xb2));const _0x5a03b0=_0x4b8eed[_0x45363(0x13f)],_0x45aca4=_0x5709e9[_0x45363(0xf2)]();console[_0x45363(0x100)](_0x45363(0x120)+_0x235c32+_0x45363(0x1bb)+_0x5a03b0+'\x20->\x20'+_0x45aca4),console[_0x45363(0x100)](_0x45363(0x10f)+_0x4b8eed[_0x45363(0x11d)][_0x45363(0x163)]+_0x45363(0xd3));const _0x3e35fa={'status':_0x45aca4,'updatedAt':new Date(),'statusChangedBy':_0x45363(0xef),'statusChangedAt':new Date()};_0x92856a&&(_0x3e35fa[_0x45363(0x142)]=_0x92856a);_0x45aca4===_0x45363(0xf8)&&_0x26fb2d&&(_0x3e35fa[_0x45363(0xd6)]=_0x26fb2d);let _0x4b1ab6=0x0,_0x491780=_0x4b8eed['shop']['balance'];if(_0x45aca4===_0x45363(0x1bf)&&_0x5a03b0!==_0x45363(0x1bf)){_0x3e35fa['paidAt']=new Date();const _0x24eccf=await currencyService_1[_0x45363(0xc0)][_0x45363(0x174)](_0x4b8eed[_0x45363(0x192)],_0x4b8eed[_0x45363(0xe1)]);_0x3e35fa[_0x45363(0x1d8)]=_0x24eccf;let _0x102b30=0x2d;const _0x20eed1=await _0x242e18[_0x45363(0x11d)]['findUnique']({'where':{'id':_0x4b8eed[_0x45363(0x138)]},'select':{'gatewaySettings':!![]}});if(_0x20eed1?.['gatewaySettings'])try{const _0x41ed4f=JSON['parse'](_0x20eed1[_0x45363(0x123)]);for(const [_0x3e497e,_0x49aa74]of Object[_0x45363(0x1d5)](_0x41ed4f)){if(_0x3e497e[_0x45363(0xe5)]()===_0x4b8eed[_0x45363(0x15c)]['toLowerCase']()){_0x102b30=_0x49aa74[_0x45363(0x151)]||0xa;break;}}}catch(_0xaf4864){console['error'](_0x45363(0xd7)+_0x235c32+':',_0xaf4864);}let _0x267e9c;_0x4b8eed['amountAfterGatewayCommissionUSDT']!==null&&_0x4b8eed[_0x45363(0xd8)]!==undefined?(_0x267e9c=_0x4b8eed[_0x45363(0xd8)],console[_0x45363(0x100)](_0x45363(0x16c)+_0x267e9c[_0x45363(0x1d3)](0x6)+_0x45363(0x13d)+_0x235c32)):(_0x267e9c=_0x24eccf*(0x1-_0x102b30/0x64),console[_0x45363(0x100)](_0x45363(0x165)+_0x235c32+':\x20'+_0x102b30+_0x45363(0x15e)+_0x24eccf[_0x45363(0x1d3)](0x6)+_0x45363(0xd3)),_0x3e35fa[_0x45363(0xd8)]=_0x267e9c,_0x3e35fa['gatewayCommissionRate']=_0x102b30),_0x4b1ab6=_0x267e9c,_0x491780+=_0x267e9c,console[_0x45363(0x100)](_0x45363(0x13b)+_0x235c32+_0x45363(0x1e6)),console[_0x45363(0x100)]('\x20\x20\x20Full\x20amount:\x20'+_0x24eccf['toFixed'](0x6)+_0x45363(0xd3)),console[_0x45363(0x100)](_0x45363(0x15a)+_0x4b8eed[_0x45363(0x15c)]+_0x45363(0x126)+_0x102b30+'%'),console[_0x45363(0x100)]('\x20\x20\x20Merchant\x20gets:\x20'+_0x267e9c[_0x45363(0x1d3)](0x6)+_0x45363(0x1ce)+_0x102b30+'%\x20commission)'),console[_0x45363(0x100)]('\x20\x20\x20Added\x20to\x20balance:\x20+'+_0x267e9c[_0x45363(0x1d3)](0x6)+'\x20USDT');}else{if(_0x5a03b0===_0x45363(0x1bf)&&_0x45aca4!==_0x45363(0x1bf)){if(_0x4b8eed['amountUSDT']){let _0x4ece0=0x2d;const _0x21e522=await _0x242e18[_0x45363(0x11d)][_0x45363(0x12a)]({'where':{'id':_0x4b8eed[_0x45363(0x138)]},'select':{'gatewaySettings':!![]}});if(_0x21e522?.[_0x45363(0x123)])try{const _0x45bd9c=JSON[_0x45363(0xe7)](_0x21e522[_0x45363(0x123)]);for(const [_0x5eb00a,_0x32c20c]of Object['entries'](_0x45bd9c)){if(_0x5eb00a[_0x45363(0xe5)]()===_0x4b8eed['gateway'][_0x45363(0xe5)]()){_0x4ece0=_0x32c20c[_0x45363(0x151)]||0xa;break;}}}catch(_0x59b122){console[_0x45363(0x125)](_0x45363(0xd7)+_0x235c32+':',_0x59b122);}const _0x20b028=_0x4b8eed['amountUSDT']*(0x1-_0x4ece0/0x64);_0x4b1ab6=-_0x20b028,_0x491780-=_0x20b028,_0x3e35fa[_0x45363(0x1d8)]=null,_0x3e35fa[_0x45363(0xd8)]=null,console[_0x45363(0x100)]('💰\x20Payment\x20'+_0x235c32+_0x45363(0x184)),console[_0x45363(0x100)](_0x45363(0x173)+_0x4b8eed[_0x45363(0x1d8)][_0x45363(0x1d3)](0x6)+_0x45363(0xd3)),console[_0x45363(0x100)](_0x45363(0x15a)+_0x4b8eed['gateway']+',\x20Commission:\x20'+_0x4ece0+'%'),console['log'](_0x45363(0x183)+_0x20b028[_0x45363(0x1d3)](0x6)+_0x45363(0x1ce)+_0x4ece0+'%\x20commission)'),console[_0x45363(0x100)](_0x45363(0x10a)+_0x20b028['toFixed'](0x6)+'\x20USDT');}}}_0x45aca4===_0x45363(0xf8)&&(_0x5a03b0===_0x45363(0x1bf)&&_0x4b8eed[_0x45363(0x1d8)]&&console[_0x45363(0x100)](_0x45363(0x1b4)),_0x26fb2d&&_0x26fb2d>0x0&&(_0x4b1ab6-=_0x26fb2d,_0x491780-=_0x26fb2d,console[_0x45363(0x100)](_0x45363(0x175)+_0x26fb2d[_0x45363(0x1d3)](0x6)+'\x20USDT\x20from\x20balance')));_0x45aca4===_0x45363(0x153)&&_0x5a03b0===_0x45363(0x1bf)&&console[_0x45363(0x100)]('🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance');const _0x2e633c=await _0x242e18[_0x45363(0x103)][_0x45363(0x109)]({'where':{'id':_0x235c32},'data':_0x3e35fa,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x4b1ab6!==0x0&&(await _0x242e18[_0x45363(0x11d)]['update']({'where':{'id':_0x4b8eed[_0x45363(0x138)]},'data':{'balance':_0x491780}}),console[_0x45363(0x100)]('💰\x20Shop\x20'+_0x4b8eed[_0x45363(0x138)]+_0x45363(0x18f)+_0x4b8eed[_0x45363(0x11d)][_0x45363(0x163)][_0x45363(0x1d3)](0x6)+_0x45363(0x12f)+_0x491780[_0x45363(0x1d3)](0x6)+_0x45363(0x1a8)+(_0x4b1ab6>0x0?'+':'')+_0x4b1ab6[_0x45363(0x1d3)](0x6)+')')),_0x2e633c;});return{'id':_0x1bace9['id'],'shopId':_0x1bace9[_0x16ac43(0x138)],'gateway':_0x1bace9[_0x16ac43(0x15c)],'amount':_0x1bace9[_0x16ac43(0x192)],'currency':_0x1bace9[_0x16ac43(0xe1)],'status':_0x1bace9[_0x16ac43(0x13f)],'orderId':_0x1bace9[_0x16ac43(0x16d)],'gatewayOrderId':_0x1bace9[_0x16ac43(0x10d)],'customerEmail':_0x1bace9[_0x16ac43(0x198)],'customerName':_0x1bace9[_0x16ac43(0xeb)],'customerCountry':_0x1bace9[_0x16ac43(0x1e5)],'customerIp':_0x1bace9[_0x16ac43(0x199)],'customerUa':_0x1bace9['customerUa'],'failureMessage':_0x1bace9['failureMessage'],'adminNotes':_0x1bace9['adminNotes'],'chargebackAmount':_0x1bace9['chargebackAmount'],'statusChangedBy':_0x1bace9[_0x16ac43(0x1dc)],'statusChangedAt':_0x1bace9[_0x16ac43(0x119)],'createdAt':_0x1bace9[_0x16ac43(0x107)],'updatedAt':_0x1bace9['updatedAt'],'shop':_0x1bace9[_0x16ac43(0x11d)]};}async[a36_0x2950f0(0xea)](_0x48bc09,_0x4fbf98){const _0x19aa00=a36_0x2950f0,_0x2a0231=Math[_0x19aa00(0x14f)]()['toString'](0x24)[_0x19aa00(0xbe)](0x2,0x9);console[_0x19aa00(0x100)](_0x19aa00(0x17b)+_0x2a0231+_0x19aa00(0xce)+_0x48bc09);const _0x548521={..._0x4fbf98};_0x4fbf98['password']&&_0x4fbf98[_0x19aa00(0x11b)][_0x19aa00(0x14d)]()!==''?(console['log'](_0x19aa00(0x14b)+_0x2a0231+_0x19aa00(0x110)+_0x48bc09),_0x548521[_0x19aa00(0x11b)]=await bcryptjs_1[_0x19aa00(0x16f)][_0x19aa00(0xb7)](_0x4fbf98[_0x19aa00(0x11b)],0xc)):(console['log'](_0x19aa00(0x14b)+_0x2a0231+_0x19aa00(0x17c)),delete _0x548521[_0x19aa00(0x11b)]);_0x4fbf98[_0x19aa00(0x1bc)]&&(_0x548521[_0x19aa00(0x157)]=_0x4fbf98[_0x19aa00(0x1bc)],delete _0x548521[_0x19aa00(0x1bc)]);_0x4fbf98[_0x19aa00(0x164)]&&(_0x548521['telegram']=_0x4fbf98[_0x19aa00(0x164)],delete _0x548521[_0x19aa00(0x164)]);_0x4fbf98[_0x19aa00(0x1ea)]&&(_0x548521[_0x19aa00(0xf4)]=_0x4fbf98[_0x19aa00(0x1ea)],delete _0x548521[_0x19aa00(0x1ea)]);if(_0x4fbf98[_0x19aa00(0x1c6)]){const _0x3991da=_0x4fbf98[_0x19aa00(0x1c6)][_0x19aa00(0x178)](_0x342501=>this[_0x19aa00(0x132)](_0x342501));console[_0x19aa00(0x100)](_0x19aa00(0x1de),_0x4fbf98['gateways'],'->',_0x3991da),_0x548521[_0x19aa00(0x193)]=JSON['stringify'](_0x3991da),delete _0x548521['gateways'];}_0x4fbf98[_0x19aa00(0x123)]&&(console[_0x19aa00(0x100)](_0x19aa00(0xb1)+_0x2a0231+']\x20Gateway\x20settings\x20before\x20saving:',_0x4fbf98[_0x19aa00(0x123)]),_0x548521['gatewaySettings']=JSON['stringify'](_0x4fbf98[_0x19aa00(0x123)]),console[_0x19aa00(0x100)](_0x19aa00(0xb1)+_0x2a0231+_0x19aa00(0x190),_0x548521['gatewaySettings']));_0x4fbf98[_0x19aa00(0xda)]&&(_0x4fbf98[_0x19aa00(0xda)][_0x19aa00(0x140)]!==undefined&&(_0x548521[_0x19aa00(0x140)]=_0x4fbf98['wallets'][_0x19aa00(0x140)]||null),_0x4fbf98[_0x19aa00(0xda)][_0x19aa00(0xa3)]!==undefined&&(_0x548521[_0x19aa00(0xa3)]=_0x4fbf98['wallets']['usdtTrcWallet']||null),_0x4fbf98[_0x19aa00(0xda)]['usdtErcWallet']!==undefined&&(_0x548521[_0x19aa00(0xfd)]=_0x4fbf98['wallets'][_0x19aa00(0xfd)]||null),_0x4fbf98['wallets'][_0x19aa00(0x114)]!==undefined&&(_0x548521[_0x19aa00(0x114)]=_0x4fbf98[_0x19aa00(0xda)][_0x19aa00(0x114)]||null),delete _0x548521['wallets']);const _0x3841e5=await database_1[_0x19aa00(0x16f)][_0x19aa00(0x11d)][_0x19aa00(0x109)]({'where':{'id':_0x48bc09},'data':_0x548521,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console['log'](_0x19aa00(0xd4)+_0x2a0231+']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:',_0x3841e5['gatewaySettings']),{'id':_0x3841e5['id'],'fullName':_0x3841e5[_0x19aa00(0x157)],'username':_0x3841e5[_0x19aa00(0x1eb)],'telegramId':_0x3841e5['telegram'],'merchantUrl':_0x3841e5[_0x19aa00(0xf4)],'gateways':_0x3841e5['paymentGateways']?JSON[_0x19aa00(0xe7)](_0x3841e5[_0x19aa00(0x193)]):null,'gatewaySettings':_0x3841e5['gatewaySettings']?JSON[_0x19aa00(0xe7)](_0x3841e5[_0x19aa00(0x123)]):null,'publicKey':_0x3841e5[_0x19aa00(0x1b8)],'wallets':{'usdtPolygonWallet':_0x3841e5[_0x19aa00(0x140)],'usdtTrcWallet':_0x3841e5[_0x19aa00(0xa3)],'usdtErcWallet':_0x3841e5[_0x19aa00(0xfd)],'usdcPolygonWallet':_0x3841e5[_0x19aa00(0x114)]},'status':_0x3841e5[_0x19aa00(0x13f)],'createdAt':_0x3841e5['createdAt']};}async[a36_0x2950f0(0x160)](_0x4e354a){const _0x49eb89=a36_0x2950f0,_0x10d99e=await database_1[_0x49eb89(0x16f)]['shop'][_0x49eb89(0x109)]({'where':{'id':_0x4e354a},'data':{'status':_0x49eb89(0x1dd)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x10d99e['id'],'fullName':_0x10d99e['name'],'username':_0x10d99e[_0x49eb89(0x1eb)],'telegramId':_0x10d99e[_0x49eb89(0x1cc)],'merchantUrl':_0x10d99e[_0x49eb89(0xf4)],'gateways':_0x10d99e[_0x49eb89(0x193)]?JSON[_0x49eb89(0xe7)](_0x10d99e[_0x49eb89(0x193)]):null,'gatewaySettings':_0x10d99e[_0x49eb89(0x123)]?JSON[_0x49eb89(0xe7)](_0x10d99e[_0x49eb89(0x123)]):null,'publicKey':_0x10d99e[_0x49eb89(0x1b8)],'wallets':{'usdtPolygonWallet':_0x10d99e[_0x49eb89(0x140)],'usdtTrcWallet':_0x10d99e['usdtTrcWallet'],'usdtErcWallet':_0x10d99e[_0x49eb89(0xfd)],'usdcPolygonWallet':_0x10d99e['usdcPolygonWallet']},'status':_0x10d99e[_0x49eb89(0x13f)],'createdAt':_0x10d99e[_0x49eb89(0x107)]};}async[a36_0x2950f0(0xd9)](_0x577238){const _0xcff5e0=a36_0x2950f0,_0x354ce1=await database_1['default'][_0xcff5e0(0x11d)][_0xcff5e0(0x109)]({'where':{'id':_0x577238},'data':{'status':_0xcff5e0(0x13e)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x354ce1['id'],'fullName':_0x354ce1[_0xcff5e0(0x157)],'username':_0x354ce1['username'],'telegramId':_0x354ce1['telegram'],'merchantUrl':_0x354ce1[_0xcff5e0(0xf4)],'gateways':_0x354ce1['paymentGateways']?JSON['parse'](_0x354ce1[_0xcff5e0(0x193)]):null,'gatewaySettings':_0x354ce1[_0xcff5e0(0x123)]?JSON['parse'](_0x354ce1[_0xcff5e0(0x123)]):null,'publicKey':_0x354ce1[_0xcff5e0(0x1b8)],'wallets':{'usdtPolygonWallet':_0x354ce1[_0xcff5e0(0x140)],'usdtTrcWallet':_0x354ce1[_0xcff5e0(0xa3)],'usdtErcWallet':_0x354ce1['usdtErcWallet'],'usdcPolygonWallet':_0x354ce1[_0xcff5e0(0x114)]},'status':_0x354ce1[_0xcff5e0(0x13f)],'createdAt':_0x354ce1['createdAt']};}async[a36_0x2950f0(0xbd)](_0x3f1c10){const _0x20d2db=a36_0x2950f0,{page:_0x35f9ca,limit:_0x188233,status:_0x34fbeb}=_0x3f1c10,_0x5562a7=(_0x35f9ca-0x1)*_0x188233,_0x512f30={};_0x34fbeb&&(_0x512f30['status']=_0x34fbeb[_0x20d2db(0xf2)]());const [_0x3232b0,_0x1d7b8c]=await Promise[_0x20d2db(0x152)]([database_1[_0x20d2db(0x16f)]['shop'][_0x20d2db(0x128)]({'where':_0x512f30,'skip':_0x5562a7,'take':_0x188233,'orderBy':{'createdAt':_0x20d2db(0x1a1)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1['default'][_0x20d2db(0x11d)][_0x20d2db(0x162)]({'where':_0x512f30})]);return{'users':_0x3232b0[_0x20d2db(0x178)](_0x3e0fc9=>{const _0x2dfcae=_0x20d2db,_0x4ee27f=_0x3e0fc9['paymentGateways']?JSON[_0x2dfcae(0xe7)](_0x3e0fc9[_0x2dfcae(0x193)]):null,_0x48193b=_0x4ee27f?_0x4ee27f[_0x2dfcae(0x178)](_0xba4bef=>this[_0x2dfcae(0x116)](_0xba4bef)):null;return{'id':_0x3e0fc9['id'],'fullName':_0x3e0fc9[_0x2dfcae(0x157)],'username':_0x3e0fc9[_0x2dfcae(0x1eb)],'telegramId':_0x3e0fc9[_0x2dfcae(0x1cc)],'merchantUrl':_0x3e0fc9[_0x2dfcae(0xf4)],'gateways':_0x48193b,'gatewaySettings':_0x3e0fc9['gatewaySettings']?JSON['parse'](_0x3e0fc9[_0x2dfcae(0x123)]):null,'publicKey':_0x3e0fc9[_0x2dfcae(0x1b8)],'wallets':{'usdtPolygonWallet':_0x3e0fc9['usdtPolygonWallet'],'usdtTrcWallet':_0x3e0fc9[_0x2dfcae(0xa3)],'usdtErcWallet':_0x3e0fc9['usdtErcWallet'],'usdcPolygonWallet':_0x3e0fc9[_0x2dfcae(0x114)]},'status':_0x3e0fc9[_0x2dfcae(0x13f)],'createdAt':_0x3e0fc9[_0x2dfcae(0x107)]};}),'pagination':{'page':_0x35f9ca,'limit':_0x188233,'total':_0x1d7b8c,'totalPages':Math[_0x20d2db(0x1c9)](_0x1d7b8c/_0x188233)}};}async[a36_0x2950f0(0x1b1)](_0x5d1f66){const _0x4d1989=a36_0x2950f0,_0x2ad67a=await database_1[_0x4d1989(0x16f)][_0x4d1989(0x11d)][_0x4d1989(0x12a)]({'where':{'id':_0x5d1f66},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x2ad67a)return null;const _0x29c141=_0x2ad67a[_0x4d1989(0x193)]?JSON[_0x4d1989(0xe7)](_0x2ad67a['paymentGateways']):null,_0x16700d=_0x29c141?_0x29c141[_0x4d1989(0x178)](_0x11ada3=>this[_0x4d1989(0x116)](_0x11ada3)):null;return _0x29c141&&_0x16700d&&console[_0x4d1989(0x100)](_0x4d1989(0xe9),_0x29c141,'->',_0x16700d),{'id':_0x2ad67a['id'],'fullName':_0x2ad67a[_0x4d1989(0x157)],'username':_0x2ad67a['username'],'telegramId':_0x2ad67a['telegram'],'merchantUrl':_0x2ad67a[_0x4d1989(0xf4)],'gateways':_0x16700d,'gatewaySettings':_0x2ad67a[_0x4d1989(0x123)]?JSON[_0x4d1989(0xe7)](_0x2ad67a[_0x4d1989(0x123)]):null,'publicKey':_0x2ad67a['publicKey'],'wallets':{'usdtPolygonWallet':_0x2ad67a[_0x4d1989(0x140)],'usdtTrcWallet':_0x2ad67a['usdtTrcWallet'],'usdtErcWallet':_0x2ad67a['usdtErcWallet'],'usdcPolygonWallet':_0x2ad67a['usdcPolygonWallet']},'status':_0x2ad67a[_0x4d1989(0x13f)],'createdAt':_0x2ad67a[_0x4d1989(0x107)]};}async[a36_0x2950f0(0x1af)](_0xaf64ed){const _0x2f5df6=a36_0x2950f0,{fullName:_0x3631cc,username:_0x312a01,password:_0x13d771,telegramId:_0x179d2d,merchantUrl:_0x1cc900,gateways:_0x228591,gatewaySettings:_0x2d158c,wallets:_0x2c81be}=_0xaf64ed,_0xd934c7=await database_1[_0x2f5df6(0x16f)][_0x2f5df6(0x11d)][_0x2f5df6(0x12a)]({'where':{'username':_0x312a01}});if(_0xd934c7)throw new Error(_0x2f5df6(0x118));if(_0x179d2d){const _0x4b09ce=await database_1['default'][_0x2f5df6(0x11d)][_0x2f5df6(0x12a)]({'where':{'telegram':_0x179d2d}});if(_0x4b09ce)throw new Error('Telegram\x20username\x20already\x20exists');}const _0x535765=await bcryptjs_1['default'][_0x2f5df6(0xb7)](_0x13d771,0xc),_0x556349=_0x2f5df6(0x1c0)+crypto_1['default'][_0x2f5df6(0x1e3)](0x20)[_0x2f5df6(0x13c)](_0x2f5df6(0x10b)),_0x395e92=_0x2f5df6(0x1e7)+crypto_1['default'][_0x2f5df6(0x1e3)](0x20)[_0x2f5df6(0x13c)](_0x2f5df6(0x10b)),_0x3898e7=_0x228591?_0x228591[_0x2f5df6(0x178)](_0x1c9979=>this[_0x2f5df6(0x132)](_0x1c9979)):null;_0x228591&&_0x3898e7&&console[_0x2f5df6(0x100)](_0x2f5df6(0x16a),_0x228591,'->',_0x3898e7);const _0x199b65=await database_1['default'][_0x2f5df6(0x11d)][_0x2f5df6(0xb8)]({'data':{'name':_0x3631cc,'username':_0x312a01,'password':_0x535765,'telegram':_0x179d2d,'shopUrl':_0x1cc900,'paymentGateways':_0x3898e7?JSON[_0x2f5df6(0xf9)](_0x3898e7):null,'gatewaySettings':_0x2d158c?JSON[_0x2f5df6(0xf9)](_0x2d158c):null,'usdtPolygonWallet':_0x2c81be?.[_0x2f5df6(0x140)]||null,'usdtTrcWallet':_0x2c81be?.[_0x2f5df6(0xa3)]||null,'usdtErcWallet':_0x2c81be?.[_0x2f5df6(0xfd)]||null,'usdcPolygonWallet':_0x2c81be?.[_0x2f5df6(0x114)]||null,'publicKey':_0x556349,'secretKey':_0x395e92,'status':_0x2f5df6(0x13e)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x199b65['id'],'fullName':_0x199b65[_0x2f5df6(0x157)],'username':_0x199b65[_0x2f5df6(0x1eb)],'telegramId':_0x199b65[_0x2f5df6(0x1cc)],'merchantUrl':_0x199b65[_0x2f5df6(0xf4)],'gateways':_0x199b65[_0x2f5df6(0x193)]?JSON[_0x2f5df6(0xe7)](_0x199b65['paymentGateways']):null,'gatewaySettings':_0x199b65['gatewaySettings']?JSON['parse'](_0x199b65[_0x2f5df6(0x123)]):null,'publicKey':_0x199b65[_0x2f5df6(0x1b8)],'wallets':{'usdtPolygonWallet':_0x199b65[_0x2f5df6(0x140)],'usdtTrcWallet':_0x199b65[_0x2f5df6(0xa3)],'usdtErcWallet':_0x199b65[_0x2f5df6(0xfd)],'usdcPolygonWallet':_0x199b65[_0x2f5df6(0x114)]},'status':_0x199b65[_0x2f5df6(0x13f)],'createdAt':_0x199b65[_0x2f5df6(0x107)]};}async[a36_0x2950f0(0x188)](_0x597286){const _0x4c6fb7=a36_0x2950f0;await database_1[_0x4c6fb7(0x16f)]['shop'][_0x4c6fb7(0x112)]({'where':{'id':_0x597286}});}[a36_0x2950f0(0x1a5)](_0x1711da,_0x3ec909,_0x5cb7df){const _0x43a177=a36_0x2950f0,_0x596f48=new Map(),_0x5c2b05=new Date(_0x3ec909);while(_0x5c2b05<=_0x5cb7df){const _0xd28106=_0x5c2b05[_0x43a177(0x195)]()[_0x43a177(0xba)]('T')[0x0];_0x596f48[_0x43a177(0xbc)](_0xd28106,{'revenue':0x0,'count':0x0}),_0x5c2b05['setDate'](_0x5c2b05[_0x43a177(0x1b2)]()+0x1);}for(const _0x3ce09d of _0x1711da){const _0x557e52=_0x3ce09d['createdAt']['toISOString']()[_0x43a177(0xba)]('T')[0x0],_0x8616db=_0x596f48['get'](_0x557e52);_0x8616db&&(_0x8616db[_0x43a177(0x162)]+=0x1,_0x3ce09d[_0x43a177(0x13f)]==='PAID'&&(_0x3ce09d[_0x43a177(0x1d8)]?_0x8616db[_0x43a177(0xc7)]+=_0x3ce09d[_0x43a177(0x1d8)]:console[_0x43a177(0x100)](_0x43a177(0x1d6)+_0x3ce09d['id']+_0x43a177(0x1ec))));}const _0x221b4c=[],_0x340f34=[];for(const [_0x52eb14,_0x3abd84]of _0x596f48){_0x221b4c['push']({'date':_0x52eb14,'amount':Math[_0x43a177(0x170)](_0x3abd84[_0x43a177(0xc7)]*0x64)/0x64}),_0x340f34[_0x43a177(0xad)]({'date':_0x52eb14,'count':_0x3abd84['count']});}return{'dailyRevenue':_0x221b4c,'dailyPayments':_0x340f34};}}exports[a36_0x2950f0(0x15f)]=AdminService;