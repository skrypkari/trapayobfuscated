'use strict';const a40_0x33a3e4=a40_0x35be;(function(_0x38ffce,_0x4eb226){const _0x25909f=a40_0x35be,_0x5de878=_0x38ffce();while(!![]){try{const _0x5d848b=parseInt(_0x25909f(0x10e))/0x1*(parseInt(_0x25909f(0x116))/0x2)+parseInt(_0x25909f(0x1bf))/0x3+-parseInt(_0x25909f(0x12e))/0x4*(-parseInt(_0x25909f(0xdd))/0x5)+parseInt(_0x25909f(0x202))/0x6+-parseInt(_0x25909f(0x185))/0x7*(-parseInt(_0x25909f(0x17a))/0x8)+parseInt(_0x25909f(0x186))/0x9*(-parseInt(_0x25909f(0xfa))/0xa)+parseInt(_0x25909f(0x1da))/0xb*(-parseInt(_0x25909f(0x178))/0xc);if(_0x5d848b===_0x4eb226)break;else _0x5de878['push'](_0x5de878['shift']());}catch(_0x44ea70){_0x5de878['push'](_0x5de878['shift']());}}}(a40_0x4cfa,0x4037d));function a40_0x4cfa(){const _0x3fc600=['\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)','AdminService','toLocaleDateString','balance','slice','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','\x20merchants\x20with\x20rounded\x20balance\x20!=\x200.00\x20(excluding\x20balances\x20that\x20round\x20to\x200.00)','REFUND','\x20->\x20','notes','date','📊\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','90d','KLYME\x20GB','📊\x20Final\x20WHERE\x20conditions:','toISOString','updatedAt','usdtTrcWallet','payouts','createdAt','\x20\x20\x20Added\x20to\x20balance:\x20+','totalPaidOut','💸\x20CHARGEBACK:\x20Processing\x20penalty-only\x20deduction','totalPayments','delete','💸\x20CHARGEBACK\x20penalty\x20ONLY:\x20-','\x20\x20\x20Payout\x20amount:\x20','\x20USDT\x20(after\x20','orderId','../config/database','🔍\x20Selected\x20erc20\x20wallet:\x20','\x20\x20\x20🖥️\x20User\x20Agent:\x20','🔄\x20Gateway\x20mapping:','25CKCawD','Shop\x20not\x20found','year','_sum','suspendUser','📅\x20Date\x20from\x20filter:\x20','erc20','txid','📅\x20Date\x20to\x20filter:\x20','getTime','averageCommissionRate','dateFrom','random','🔍\x20Selected\x20polygon\x20wallet:\x20','getPaymentById','\x20PAID\x20payments','cointopay2','pendingUrl','stringify','\x20\x20\x20Full\x20amount:\x20','Username\x20already\x20exists','NONEXISTENT_GATEWAY_FILTER','gatewayCommissionRate','telegramId','\x27\x20to\x20name\x20\x27','adminNotes','name','chargebackAmount','\x20\x20\x20Available\x20(raw):\x20','10csOgfA','usdcErcWallet','💰\x20[PAYOUT]\x20Merchant\x20','password',',\x20Commission:\x20','totalAmountUSDT','Не\x20указан','custom','default','🔄\x20Admin\x20updating\x20payment\x20','\x20USDT\x20(+','amountAfterCommissionUSDT','fullName','\x20\x20\x20💰\x20Total\x20turnover:\x20','\x20\x20\x20🌍\x20Country:\x20','shopUrl','0000','🔧\x20[','failureMessage','🔄\x20Gateway\x20mapping\x20(get):','1omfmUt','\x20\x20\x20Requested\x20(number):\x20','getGatewayDisplayName','\x27\x20->\x20name\x20\x27','🔍\x20Initial\x20wallet\x20from\x20request:\x20','\x20\x20\x20💰\x20Total\x20payments\x20turnover:\x20','month','\x20in\x20','1027298BsOcep','💰\x20Current\x20shop\x20balance:\x20','📊\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','warn','⚠️\x20Gateway\x20\x27','\x20\x20\x20🤔\x20Difference:\x20','set','\x20USDT','admin','parse','toFixed','wallets','\x20\x20\x20Current\x20balance:\x20','turnover','customerName','⚠️\x20CHARGEBACK\x20without\x20penalty\x20amount\x20-\x20no\x20balance\x20change','📅\x20Payout\x20date\x20to\x20filter:\x20','\x20\x20\x20Gateway:\x20','\x20USDT\x20(already\x20paid\x20out)','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','🔄\x20Converted\x20gateway\x20ID\x20\x27','getGatewayInternalName','\x20balance\x20updated:\x20','\x20USDT\x20(-','361996fkUaxR','thisMonth','__importDefault','externalPaymentUrl','usdtErcWallet','\x20USDT\x20(total\x20paid\x20to\x20merchants)','📊\x20Available\x20gateways\x20in\x20database:','\x20\x20\x20🌐\x20IP:\x20','🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','updateUser','\x20USDT,\x20Requested:\x20','status','🔍\x20No\x20wallet\x20provided,\x20looking\x20up\x20from\x20shop\x20settings...','customerIp','📱\x20Telegram\x20notification\x20sent\x20for\x20payout\x20','toLowerCase','CoinToPay','sort',',\x20successful:\x20','createUser','%\x20commission)','\x20status:\x20','\x20\x20\x20📅\x20This\x20month:\x20','__esModule','deletePayout','\x20\x20\x20�📊\x20Total\x20payments:\x20','setDate','customerUa','periodTo','\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)','merchantEarnings','\x20USDT\x20for\x20payment\x20','💰\x20Creating\x20payout\x20for\x20shop\x20','successUrl','Noda','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','commission','merchantEarningsUSDT','length','findUnique',']\x20Gateway\x20settings\x20JSON\x20string:','\x20USDT\x20from\x20balance','✅\x20Payout\x20created:\x20','\x27\x20->\x20ID\x20\x27','lte','COMPLETED','paymentsCount','gateway','dateTo','\x20balance\x20updated:','filter','getGatewayNameById','🔍\x20Using\x20gateway\x20\x27','paidOutUSDT','getMonth','ru-RU','\x20USDT)',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','✅\x20Balance\x20check\x20passed\x20(with\x20tolerance)','📊\x20Sorting\x20payments\x20by\x20','mastercard','📊\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','\x20\x20\x20�\x20Total\x20payments\x20turnover:\x20','min','\x27\x20(from\x20\x27','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','periodFrom','toUpperCase','paidAt','CHARGEBACK','desc','\x20\x20\x20⏳\x20Pending\x20payout:\x20','revenue','gateways','15815940zpeTxd','forEach','72lgDkCs','\x20\x20\x20✅\x20Total\x20net\x20balances:\x20','username','getAllPayments','\x20\x20\x20🔍\x20Calculated\x20after\x20commission:\x20','setHours','\x20order','customerCountry','groupBy','getFullYear','📊\x20Gateway\x20filter\x20applied:','196259nlPTYF','711405knJbPE','getAllPayouts','📊\x20Merchant\x20statistics\x20calculated:','PENDING','📊\x20Calculated\x20commission\x20rate\x20for\x20payment\x20','\x20paid\x20payments\x20for\x20analysis','🔄\x20Converted\x20gateway\x20name\x20\x27','amountAfterGatewayCommissionUSDT','getPayoutStats','💰\x20Payment\x20amount\x20is\x20NOT\x20deducted\x20(chargeback\x20penalty\x20only)','awaitingPayout','\x20USDT\x20(current\x20balance\x20in\x20DB)','📋\x20Found\x20','KLYME\x20EU','crypto','gatewayOrderId','⚠️\x20Requested\x20gateway\x20\x27','getGatewayIdByName','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','convertToUSDT','averageCheckUSDT','includes','\x20payments)','test_gateway','%\x20from\x20','randomBytes','gte','erc20_usdc','🎯\x20[','reduce','plisio','\x20\x20\x20💵\x20Available\x20balance:\x20','usdcPolygonWallet','./telegramBotService','create','merchantUrl','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','payout','bcryptjs','amountUSDT','localeCompare','\x20\x20\x20💰\x20Total\x20payout:\x20','💳\x20Final\x20payout\x20wallet\x20for\x20','currency','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','split','📅\x20Period:\x20','\x20\x20\x20💸\x20Total\x20payouts:\x20','error','\x20\x20\x20Transaction\x20hash:\x20','publicKey','💱\x20Currency\x20filter\x20applied:\x20','2020-01-01','Error\x20processing\x20payment\x20','statusChangedAt','yesterday','getAllUsers','660288VcikpL','shopId','Rapyd','currencyService','substr','\x27\x20not\x20found.\x20Available\x20gateways:\x20','customerEmail','dailyRevenue','not\x20set','gatewaySettings','🔍\x20Shop\x20wallets:','getDate','generateDailyStatistics','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','🎯\x20updateUser\x20called\x20with\x20ID:\x20','cointopay','✅\x20Using\x20gateway\x20filter:\x20\x27',']\x20Gateway\x20settings\x20before\x20saving:','statusChangedBy','paymentGateways','MasterCard','📅\x20Payout\x20date\x20from\x20filter:\x20','gatewayEarnings','availableBalance','shop','aggregate','findMany','11qTKnZU','📊\x20Merchants\x20with\x20rounded\x20balance\x20!=\x200.00:\x20','📋\x20Getting\x20merchants\x20selection\x20list...',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','telegram','log','round','_count','period','week','defineProperty','totalAmountAfterCommissionUSDT','sk_','wallet','\x20USDT\x20(same\x20as\x20awaiting)','createPayout','network','💰\x20Shop\x20','insensitive','update','klyme_eu','not\x20specified','usdtPolygonWallet','\x20\x20\x20Balance:\x20','push','entries','🔍\x20Balance\x20check\x20details:','payment','\x20for\x20shop\x20','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','📊\x20Total\x20payments\x20(including\x20failed):\x20','count','\x20USDT,\x20Difference:\x20','getUserById','\x20active\x20merchants\x20for\x20selection','values','getMerchantsSelection','all','\x20USDT\x20(gross\x20revenue)','asc','1329024XXvuwW','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','toString','totalCommissionRate','totalPayout','\x20USDT\x20(','📊\x20Payout\x20statistics\x20calculated:','ACTIVE','⚠️\x20Payment\x20','Payment\x20not\x20found','turnoverUSDT','amount','getMerchantStatistics','PAID','Open\x20Banking\x202','findFirst','💰\x20Found\x20','map','❌\x20Failed\x20to\x20send\x20Telegram\x20notification\x20for\x20payout\x20','day','🔍\x20Creating\x20payout\x20with\x20data:','pendingPayout','totalTurnover','failUrl','polygon','🔍\x20Selected\x20polygon_usdc\x20wallet:\x20','commissionUSDT','some','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','hash',',\x20userId:\x20','ceil','rapyd','hex'];a40_0x4cfa=function(){return _0x3fc600;};return a40_0x4cfa();}var __importDefault=this&&this[a40_0x33a3e4(0x130)]||function(_0xcae8e0){const _0x17c5c6=a40_0x33a3e4;return _0xcae8e0&&_0xcae8e0[_0x17c5c6(0x145)]?_0xcae8e0:{'default':_0xcae8e0};};Object[a40_0x33a3e4(0x1e4)](exports,a40_0x33a3e4(0x145),{'value':!![]}),exports[a40_0x33a3e4(0xbd)]=void 0x0;function a40_0x35be(_0x41abd6,_0x2ba868){const _0x4cfadb=a40_0x4cfa();return a40_0x35be=function(_0x35bebf,_0x592625){_0x35bebf=_0x35bebf-0xad;let _0x1ed6f7=_0x4cfadb[_0x35bebf];return _0x1ed6f7;},a40_0x35be(_0x41abd6,_0x2ba868);}const database_1=__importDefault(require(a40_0x33a3e4(0xd9))),bcryptjs_1=__importDefault(require(a40_0x33a3e4(0x1ac))),crypto_1=__importDefault(require(a40_0x33a3e4(0x194))),currencyService_1=require('./currencyService'),telegramBotService_1=require(a40_0x33a3e4(0x1a7)),gateway_1=require('../types/gateway');class AdminService{async[a40_0x33a3e4(0x18e)](){const _0x509dda=a40_0x33a3e4;console[_0x509dda(0x1df)]('📊\x20Calculating\x20payout\x20statistics...');const _0xf22b22=await database_1[_0x509dda(0x102)][_0x509dda(0x1d7)][_0x509dda(0x1d8)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x509dda(0x20a)}}),_0x53433c=await database_1[_0x509dda(0x102)][_0x509dda(0x1f5)][_0x509dda(0x1f9)]({'where':{'status':_0x509dda(0x210),'gateway':{'not':'test_gateway'}}}),_0x3f66d8=new Date(),_0x11be07=new Date(_0x3f66d8['getFullYear'](),_0x3f66d8[_0x509dda(0x164)](),0x1),_0x18c425=new Date(_0x3f66d8[_0x509dda(0x183)](),_0x3f66d8['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x101359=await database_1[_0x509dda(0x102)][_0x509dda(0x1ab)][_0x509dda(0x1d8)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x11be07,'lte':_0x18c425},'status':'COMPLETED'}}),_0x38a812=_0xf22b22[_0x509dda(0xe0)]['totalPaidOut']||0x0,_0x52545a=_0xf22b22[_0x509dda(0xe0)][_0x509dda(0xbf)]||0x0,_0x4c13c1=_0x101359[_0x509dda(0xe0)]['amount']||0x0,_0x4ab220={'totalPayout':Math[_0x509dda(0x1e0)](_0x38a812*0x64)/0x64,'awaitingPayout':Math[_0x509dda(0x1e0)](_0x52545a*0x64)/0x64,'thisMonth':Math[_0x509dda(0x1e0)](_0x4c13c1*0x64)/0x64,'availableBalance':Math[_0x509dda(0x1e0)](_0x52545a*0x64)/0x64,'totalPayments':_0x53433c};return console[_0x509dda(0x1df)](_0x509dda(0x209)),console[_0x509dda(0x1df)](_0x509dda(0x1af)+_0x4ab220[_0x509dda(0x207)]+_0x509dda(0x133)),console[_0x509dda(0x1df)](_0x509dda(0x151)+_0x4ab220[_0x509dda(0x190)]+_0x509dda(0x14b)),console[_0x509dda(0x1df)](_0x509dda(0x1a5)+_0x4ab220[_0x509dda(0x1d6)]+_0x509dda(0x1e8)),console[_0x509dda(0x1df)](_0x509dda(0x144)+_0x4ab220[_0x509dda(0x12f)]+_0x509dda(0x11d)),console['log']('\x20\x20\x20💳\x20Total\x20payments:\x20'+_0x4ab220[_0x509dda(0xd3)]+_0x509dda(0xec)),_0x4ab220;}async['updateCustomerData'](_0x3e40fd,_0x51dcc1){const _0x573a5f=a40_0x33a3e4;console[_0x573a5f(0x1df)]('🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20'+_0x3e40fd+':',_0x51dcc1);const _0x3a64b8=await database_1[_0x573a5f(0x102)][_0x573a5f(0x1f5)]['findUnique']({'where':{'id':_0x3e40fd},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x3a64b8)throw new Error(_0x573a5f(0x20c));const _0xa70787={};_0x51dcc1[_0x573a5f(0x181)]!==undefined&&(_0xa70787[_0x573a5f(0x181)]=_0x51dcc1[_0x573a5f(0x181)]||null);_0x51dcc1[_0x573a5f(0x13b)]!==undefined&&(_0xa70787[_0x573a5f(0x13b)]=_0x51dcc1[_0x573a5f(0x13b)]||null);_0x51dcc1['customerUa']!==undefined&&(_0xa70787[_0x573a5f(0x149)]=_0x51dcc1[_0x573a5f(0x149)]||null);const _0x1b34f9=await database_1[_0x573a5f(0x102)][_0x573a5f(0x1f5)]['update']({'where':{'id':_0x3e40fd},'data':{..._0xa70787,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x573a5f(0x1df)](_0x573a5f(0x1b2)+_0x3e40fd),console[_0x573a5f(0x1df)](_0x573a5f(0x108)+_0x3a64b8['customerCountry']+_0x573a5f(0xc4)+_0x1b34f9[_0x573a5f(0x181)]),console['log'](_0x573a5f(0x135)+_0x3a64b8[_0x573a5f(0x13b)]+'\x20->\x20'+_0x1b34f9[_0x573a5f(0x13b)]),console[_0x573a5f(0x1df)](_0x573a5f(0xdb)+(_0x3a64b8[_0x573a5f(0x149)]?_0x573a5f(0x11c):_0x573a5f(0x1c7))+'\x20->\x20'+(_0x1b34f9['customerUa']?_0x573a5f(0x11c):_0x573a5f(0x1c7))),_0x1b34f9;}async['getSystemStatistics'](_0x3e9537){const _0x161ae1=a40_0x33a3e4,_0xfd5f21=new Date();let _0xb046b7;switch(_0x3e9537['toLowerCase']()){case _0x161ae1(0xad):_0xb046b7=new Date(_0xfd5f21[_0x161ae1(0x183)](),_0xfd5f21[_0x161ae1(0x164)](),_0xfd5f21[_0x161ae1(0x1ca)](),0x0,0x0,0x0,0x0);break;case'yesterday':const _0x438fa2=new Date(_0xfd5f21);_0x438fa2[_0x161ae1(0x148)](_0x438fa2['getDate']()-0x1),_0xb046b7=new Date(_0x438fa2[_0x161ae1(0x183)](),_0x438fa2['getMonth'](),_0x438fa2[_0x161ae1(0x1ca)](),0x0,0x0,0x0,0x0);break;case'7d':_0xb046b7=new Date(_0xfd5f21[_0x161ae1(0xe6)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0xb046b7=new Date(_0xfd5f21[_0x161ae1(0xe6)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x161ae1(0xc8):_0xb046b7=new Date(_0xfd5f21[_0x161ae1(0xe6)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x161ae1(0x1ff):const _0xba7191=await database_1[_0x161ae1(0x102)][_0x161ae1(0x1f5)][_0x161ae1(0x212)]({'where':{'gateway':{'not':'test_gateway'}},'orderBy':{'createdAt':_0x161ae1(0x201)},'select':{'createdAt':!![]}});_0xb046b7=_0xba7191?_0xba7191['createdAt']:new Date(_0x161ae1(0x1ba));break;default:_0xb046b7=new Date(_0xfd5f21['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}_0xb046b7[_0x161ae1(0x17f)](0x0,0x0,0x0,0x0);let _0x5ca63d;if(_0x3e9537['toLowerCase']()===_0x161ae1(0x1bd)){const _0x3919b7=new Date(_0xfd5f21);_0x3919b7[_0x161ae1(0x148)](_0x3919b7[_0x161ae1(0x1ca)]()-0x1),_0x5ca63d=new Date(_0x3919b7['getFullYear'](),_0x3919b7[_0x161ae1(0x164)](),_0x3919b7[_0x161ae1(0x1ca)](),0x17,0x3b,0x3b,0x3e7);}const _0x3cfd4={'gte':_0xb046b7};_0x5ca63d&&(_0x3cfd4[_0x161ae1(0x15a)]=_0x5ca63d);const [_0x5a6064,_0x28b097,_0x5c65a9,_0x263662,_0x22db36,_0x31f741]=await Promise[_0x161ae1(0x1ff)]([database_1[_0x161ae1(0x102)][_0x161ae1(0x1d7)]['count'](),database_1[_0x161ae1(0x102)][_0x161ae1(0x1d7)]['count']({'where':{'status':_0x161ae1(0x20a)}}),database_1[_0x161ae1(0x102)][_0x161ae1(0x1f5)][_0x161ae1(0x1f9)]({'where':{'status':'PAID','createdAt':_0x3cfd4,'gateway':{'not':_0x161ae1(0x19d)}}}),database_1[_0x161ae1(0x102)][_0x161ae1(0x1f5)]['findMany']({'where':{'status':'PAID','createdAt':_0x3cfd4,'gateway':{'not':_0x161ae1(0x19d)}},'select':{'amount':!![],'currency':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x161ae1(0x102)][_0x161ae1(0x1f5)]['findMany']({'where':{'gateway':{'not':_0x161ae1(0x19d)}},'take':0xa,'orderBy':{'createdAt':_0x161ae1(0x174)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x161ae1(0x102)][_0x161ae1(0x1f5)][_0x161ae1(0x1d9)]({'where':{'createdAt':_0x3cfd4,'gateway':{'not':_0x161ae1(0x19d)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x46dd5e=0x0,_0x28a226=0x0;for(const _0xab3be5 of _0x263662){const _0x44aa66=await currencyService_1['currencyService']['convertToUSDT'](_0xab3be5[_0x161ae1(0x20e)],_0xab3be5['currency']);_0x46dd5e+=_0x44aa66;if(_0xab3be5['amountAfterGatewayCommissionUSDT']){const _0x621201=await currencyService_1[_0x161ae1(0x1c2)]['convertToUSDT'](_0xab3be5[_0x161ae1(0x20e)],_0xab3be5[_0x161ae1(0x1b1)]),_0x2cfd04=_0xab3be5[_0x161ae1(0x18d)],_0x489b6c=_0x621201-_0x2cfd04;_0x28a226+=_0x489b6c;}}const _0x28d00c=_0x5c65a9>0x0?_0x46dd5e/_0x5c65a9:0x0,_0x58ece1=this[_0x161ae1(0x1cb)](_0x31f741,_0xb046b7,_0x5ca63d||_0xfd5f21),_0x5cc2f2=await database_1[_0x161ae1(0x102)][_0x161ae1(0x1f5)][_0x161ae1(0x1f9)]({'where':{'createdAt':_0x3cfd4,'gateway':{'not':_0x161ae1(0x19d)}}}),_0x274b3e=_0x5cc2f2>0x0?_0x5c65a9/_0x5cc2f2*0x64:0x0;return{'totalShops':_0x5a6064,'activeShops':_0x28b097,'totalPayments':_0x5c65a9,'successfulPayments':_0x5c65a9,'totalAttempts':_0x5cc2f2,'totalRevenue':Math[_0x161ae1(0x1e0)](_0x46dd5e*0x64)/0x64,'trapayEarnings':Math[_0x161ae1(0x1e0)](_0x28a226*0x64)/0x64,'averagePaymentAmount':Math['round'](_0x28d00c*0x64)/0x64,'conversionRate':Math[_0x161ae1(0x1e0)](_0x274b3e*0x64)/0x64,'dailyRevenue':_0x58ece1[_0x161ae1(0x1c6)],'dailyPayments':_0x58ece1['dailyPayments'],'recentPayments':_0x22db36[_0x161ae1(0x214)](_0x28c4ef=>({'id':_0x28c4ef['id'],'amount':_0x28c4ef['amount'],'currency':_0x28c4ef['currency'],'status':_0x28c4ef[_0x161ae1(0x139)],'gateway':_0x28c4ef[_0x161ae1(0x15d)],'shop':_0x28c4ef[_0x161ae1(0x1d7)],'createdAt':_0x28c4ef['createdAt']}))};}async[a40_0x33a3e4(0x20f)](_0x1be6d8){const _0x221ed9=a40_0x33a3e4;console[_0x221ed9(0x1df)](_0x221ed9(0xb6),_0x1be6d8);let _0x3ce79b,_0xd0c451=new Date();if(_0x1be6d8[_0x221ed9(0x1e2)]===_0x221ed9(0x101)&&_0x1be6d8[_0x221ed9(0xe8)]&&_0x1be6d8[_0x221ed9(0x15e)])_0x3ce79b=new Date(_0x1be6d8[_0x221ed9(0xe8)]),_0xd0c451=new Date(_0x1be6d8[_0x221ed9(0x15e)]),_0x3ce79b['setHours'](0x0,0x0,0x0,0x0),_0xd0c451[_0x221ed9(0x17f)](0x17,0x3b,0x3b,0x3e7);else{const _0x3c8688=new Date();switch(_0x1be6d8['period']){case _0x221ed9(0x1e3):_0x3ce79b=new Date(_0x3c8688['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x221ed9(0x114):_0x3ce79b=new Date(_0x3c8688['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x221ed9(0xdf):_0x3ce79b=new Date(_0x3c8688[_0x221ed9(0xe6)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x221ed9(0x1ff):default:_0x3ce79b=new Date('2020-01-01');break;}_0x3ce79b[_0x221ed9(0x17f)](0x0,0x0,0x0,0x0),_0xd0c451['setHours'](0x17,0x3b,0x3b,0x3e7);}console['log'](_0x221ed9(0x1b4)+_0x3ce79b[_0x221ed9(0xcb)]()+'\x20to\x20'+_0xd0c451[_0x221ed9(0xcb)]());const _0x1a0cea={'status':'PAID','gateway':{'not':_0x221ed9(0x19d)},'paidAt':{'gte':_0x3ce79b,'lte':_0xd0c451}};_0x1be6d8[_0x221ed9(0x1c0)]&&(_0x1a0cea['shopId']=_0x1be6d8[_0x221ed9(0x1c0)]);const _0x42e9a0=await database_1['default'][_0x221ed9(0x1f5)][_0x221ed9(0x1d9)]({'where':_0x1a0cea,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x221ed9(0x1df)](_0x221ed9(0x213)+_0x42e9a0[_0x221ed9(0x154)]+_0x221ed9(0x18b));const _0x1f56f3={'gateway':{'not':_0x221ed9(0x19d)},'createdAt':{'gte':_0x3ce79b,'lte':_0xd0c451}};_0x1be6d8['shopId']&&(_0x1f56f3[_0x221ed9(0x1c0)]=_0x1be6d8['shopId']);const _0x300e7f=await database_1[_0x221ed9(0x102)]['payment'][_0x221ed9(0x1f9)]({'where':_0x1f56f3});console[_0x221ed9(0x1df)](_0x221ed9(0x1f8)+_0x300e7f+_0x221ed9(0x140)+_0x42e9a0['length']);let _0x4580ae=0x0,_0x20e04c=0x0,_0x47b7c0=0x0;const _0x3b7f7a={},_0x366929={},_0x758b09={};for(const _0x401d3c of _0x42e9a0){try{const _0x38855e=_0x401d3c['amountUSDT']||0x0;if(_0x38855e<=0x0){console[_0x221ed9(0x119)](_0x221ed9(0x20b)+_0x401d3c['id']+'\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...');continue;}let _0x33cf48,_0x5d89da;if(_0x401d3c['amountAfterGatewayCommissionUSDT']!==null&&_0x401d3c['amountAfterGatewayCommissionUSDT']!==undefined)_0x33cf48=_0x401d3c[_0x221ed9(0x18d)],_0x5d89da=_0x38855e-_0x33cf48,console[_0x221ed9(0x1df)]('📊\x20Using\x20saved\x20values\x20for\x20payment\x20'+_0x401d3c['id']+':\x20'+_0x38855e['toFixed'](0x6)+'\x20USDT,\x20merchant:\x20'+_0x33cf48[_0x221ed9(0x120)](0x6)+_0x221ed9(0x11d));else{let _0x379f63={};if(_0x401d3c[_0x221ed9(0x1d7)]['gatewaySettings'])try{_0x379f63=JSON['parse'](_0x401d3c[_0x221ed9(0x1d7)][_0x221ed9(0x1c8)]);}catch(_0x41bbd9){console[_0x221ed9(0x1b6)](_0x221ed9(0x1f7)+_0x401d3c[_0x221ed9(0x1c0)]+':',_0x41bbd9);}let _0x3f50c2=0x2d;for(const [_0x3d869e,_0x5eb064]of Object[_0x221ed9(0x1f3)](_0x379f63)){if(_0x3d869e[_0x221ed9(0x13d)]()===_0x401d3c[_0x221ed9(0x15d)][_0x221ed9(0x13d)]()){_0x3f50c2=_0x5eb064[_0x221ed9(0x152)]||0x2d;break;}}_0x5d89da=_0x38855e*(_0x3f50c2/0x64),_0x33cf48=_0x38855e-_0x5d89da,console[_0x221ed9(0x1df)](_0x221ed9(0x118)+_0x401d3c['id']+':\x20'+_0x3f50c2+_0x221ed9(0x19e)+_0x38855e[_0x221ed9(0x120)](0x6)+_0x221ed9(0x11d));}_0x4580ae+=_0x38855e,_0x20e04c+=_0x33cf48,_0x47b7c0+=_0x5d89da;let _0x55de15;_0x401d3c[_0x221ed9(0xf3)]!==null&&_0x401d3c['gatewayCommissionRate']!==undefined?(_0x55de15=_0x401d3c[_0x221ed9(0xf3)],console[_0x221ed9(0x1df)]('📊\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20'+_0x401d3c['id']+':\x20'+_0x55de15+'%')):(_0x55de15=_0x38855e>0x0?_0x5d89da/_0x38855e*0x64:0x0,console[_0x221ed9(0x1df)](_0x221ed9(0x18a)+_0x401d3c['id']+':\x20'+_0x55de15[_0x221ed9(0x120)](0x2)+'%'));!_0x3b7f7a[_0x401d3c[_0x221ed9(0x15d)]]&&(_0x3b7f7a[_0x401d3c[_0x221ed9(0x15d)]]={'gateway':_0x401d3c[_0x221ed9(0x15d)],'gatewayDisplayName':this[_0x221ed9(0x110)](_0x401d3c[_0x221ed9(0x15d)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x3b7f7a[_0x401d3c[_0x221ed9(0x15d)]][_0x221ed9(0x15c)]++,_0x3b7f7a[_0x401d3c[_0x221ed9(0x15d)]][_0x221ed9(0x20d)]+=_0x38855e,_0x3b7f7a[_0x401d3c[_0x221ed9(0x15d)]][_0x221ed9(0xb4)]+=_0x5d89da,_0x3b7f7a[_0x401d3c[_0x221ed9(0x15d)]][_0x221ed9(0x153)]+=_0x33cf48,_0x3b7f7a[_0x401d3c[_0x221ed9(0x15d)]][_0x221ed9(0x206)]+=_0x55de15;!_0x1be6d8['shopId']&&(!_0x366929[_0x401d3c[_0x221ed9(0x1c0)]]&&(_0x366929[_0x401d3c[_0x221ed9(0x1c0)]]={'shopId':_0x401d3c['shopId'],'shopName':_0x401d3c[_0x221ed9(0x1d7)]['name'],'shopUsername':_0x401d3c['shop'][_0x221ed9(0x17c)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x366929[_0x401d3c[_0x221ed9(0x1c0)]][_0x221ed9(0x15c)]++,_0x366929[_0x401d3c[_0x221ed9(0x1c0)]]['turnoverUSDT']+=_0x38855e,_0x366929[_0x401d3c[_0x221ed9(0x1c0)]][_0x221ed9(0xb4)]+=_0x5d89da,_0x366929[_0x401d3c['shopId']][_0x221ed9(0x153)]+=_0x33cf48);const _0x38447c=_0x401d3c[_0x221ed9(0x172)]['toISOString']()[_0x221ed9(0x1b3)]('T')[0x0];!_0x758b09[_0x38447c]&&(_0x758b09[_0x38447c]={'date':_0x38447c,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x758b09[_0x38447c][_0x221ed9(0x123)]+=_0x38855e,_0x758b09[_0x38447c]['merchantEarnings']+=_0x33cf48,_0x758b09[_0x38447c]['gatewayEarnings']+=_0x5d89da,_0x758b09[_0x38447c][_0x221ed9(0x15c)]++;}catch(_0x9c50e2){console[_0x221ed9(0x1b6)](_0x221ed9(0x1bb)+_0x401d3c['id']+':',_0x9c50e2);}}Object[_0x221ed9(0x1fd)](_0x3b7f7a)[_0x221ed9(0x179)](_0x467c13=>{const _0x57dfc5=_0x221ed9;_0x467c13[_0x57dfc5(0xe7)]=_0x467c13[_0x57dfc5(0x15c)]>0x0?_0x467c13[_0x57dfc5(0x206)]/_0x467c13[_0x57dfc5(0x15c)]:0x0,delete _0x467c13[_0x57dfc5(0x206)];}),Object['values'](_0x366929)[_0x221ed9(0x179)](_0x33675d=>{const _0x3b042c=_0x221ed9;_0x33675d[_0x3b042c(0x19a)]=_0x33675d[_0x3b042c(0x15c)]>0x0?_0x33675d[_0x3b042c(0x20d)]/_0x33675d[_0x3b042c(0x15c)]:0x0;});let _0x87ac84=0x0,_0x4c60b5=0x0;if(_0x1be6d8[_0x221ed9(0x1c0)]){const _0x27be84=await database_1[_0x221ed9(0x102)][_0x221ed9(0x1ab)][_0x221ed9(0x1d9)]({'where':{'shopId':_0x1be6d8['shopId'],'status':'COMPLETED','createdAt':{'gte':_0x3ce79b,'lte':_0xd0c451}},'select':{'amount':!![]}});_0x87ac84=_0x27be84[_0x221ed9(0x1a3)]((_0x486082,_0x504cd8)=>_0x486082+_0x504cd8[_0x221ed9(0x20e)],0x0);const _0x3a21dd=await database_1[_0x221ed9(0x102)][_0x221ed9(0x1ab)][_0x221ed9(0x1d9)]({'where':{'shopId':_0x1be6d8[_0x221ed9(0x1c0)],'status':_0x221ed9(0x189),'createdAt':{'gte':_0x3ce79b,'lte':_0xd0c451}},'select':{'amount':!![]}});_0x4c60b5=_0x3a21dd['reduce']((_0x61750b,_0x597086)=>_0x61750b+_0x597086[_0x221ed9(0x20e)],0x0);}const _0x225ae0=_0x300e7f,_0x198e6a=_0x42e9a0['length'],_0x9b5112=_0x198e6a>0x0?_0x4580ae/_0x198e6a:0x0,_0x583d43=_0x225ae0>0x0?Math[_0x221ed9(0x1e0)](_0x198e6a/_0x225ae0*0x2710)/0x64:0x0,_0x2ea4a5=Math[_0x221ed9(0xb9)]((_0xd0c451[_0x221ed9(0xe6)]()-_0x3ce79b[_0x221ed9(0xe6)]())/(0x3e8*0x3c*0x3c*0x18)),_0x2aa3ea={'totalTurnover':Math[_0x221ed9(0x1e0)](_0x4580ae*0x64)/0x64,'merchantEarnings':Math[_0x221ed9(0x1e0)](_0x20e04c*0x64)/0x64,'gatewayEarnings':Math[_0x221ed9(0x1e0)](_0x47b7c0*0x64)/0x64,'totalPaidOut':Math[_0x221ed9(0x1e0)](_0x87ac84*0x64)/0x64,'pendingPayout':Math[_0x221ed9(0x1e0)](_0x4c60b5*0x64)/0x64,'averageCheck':Math['round'](_0x9b5112*0x64)/0x64,'totalPayments':_0x225ae0,'successfulPayments':_0x198e6a,'conversionRate':_0x583d43,'gatewayBreakdown':Object[_0x221ed9(0x1fd)](_0x3b7f7a)[_0x221ed9(0x214)](_0x1951ee=>({..._0x1951ee,'turnoverUSDT':Math[_0x221ed9(0x1e0)](_0x1951ee[_0x221ed9(0x20d)]*0x64)/0x64,'commissionUSDT':Math[_0x221ed9(0x1e0)](_0x1951ee[_0x221ed9(0xb4)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x221ed9(0x1e0)](_0x1951ee[_0x221ed9(0x153)]*0x64)/0x64,'averageCommissionRate':Math[_0x221ed9(0x1e0)](_0x1951ee['averageCommissionRate']*0x64)/0x64})),'merchantBreakdown':_0x1be6d8[_0x221ed9(0x1c0)]?undefined:Object[_0x221ed9(0x1fd)](_0x366929)['map'](_0x50dd01=>({..._0x50dd01,'turnoverUSDT':Math[_0x221ed9(0x1e0)](_0x50dd01[_0x221ed9(0x20d)]*0x64)/0x64,'commissionUSDT':Math[_0x221ed9(0x1e0)](_0x50dd01['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x221ed9(0x1e0)](_0x50dd01[_0x221ed9(0x153)]*0x64)/0x64,'paidOutUSDT':Math[_0x221ed9(0x1e0)](_0x50dd01[_0x221ed9(0x163)]*0x64)/0x64,'averageCheckUSDT':Math[_0x221ed9(0x1e0)](_0x50dd01['averageCheckUSDT']*0x64)/0x64})),'dailyData':Object[_0x221ed9(0x1fd)](_0x758b09)[_0x221ed9(0x214)](_0x51a0e1=>({..._0x51a0e1,'turnover':Math[_0x221ed9(0x1e0)](_0x51a0e1[_0x221ed9(0x123)]*0x64)/0x64,'merchantEarnings':Math[_0x221ed9(0x1e0)](_0x51a0e1[_0x221ed9(0x14c)]*0x64)/0x64,'gatewayEarnings':Math['round'](_0x51a0e1[_0x221ed9(0x1d5)]*0x64)/0x64}))[_0x221ed9(0x13f)]((_0x136506,_0x31af24)=>_0x136506[_0x221ed9(0xc6)][_0x221ed9(0x1ae)](_0x31af24[_0x221ed9(0xc6)])),'periodInfo':{'from':_0x3ce79b,'to':_0xd0c451,'periodType':_0x1be6d8[_0x221ed9(0x1e2)]||_0x221ed9(0x101),'daysCount':_0x2ea4a5}};return console['log'](_0x221ed9(0x188)),console['log'](_0x221ed9(0x107)+_0x2aa3ea[_0x221ed9(0xb0)]+_0x221ed9(0x11d)),console['log'](_0x221ed9(0x204)+_0x2aa3ea[_0x221ed9(0x14c)]+'\x20USDT'),console[_0x221ed9(0x1df)](_0x221ed9(0x129)+_0x2aa3ea['gatewayEarnings']+_0x221ed9(0x11d)),console[_0x221ed9(0x1df)]('\x20\x20\x20�\x20Total\x20paid\x20out:\x20'+_0x2aa3ea['totalPaidOut']+_0x221ed9(0x11d)),console[_0x221ed9(0x1df)](_0x221ed9(0x175)+_0x2aa3ea[_0x221ed9(0xaf)]+_0x221ed9(0x11d)),console[_0x221ed9(0x1df)](_0x221ed9(0x147)+_0x2aa3ea[_0x221ed9(0xd3)]),_0x2aa3ea;}async[a40_0x33a3e4(0x1fe)](_0x40984b){const _0x382ee4=a40_0x33a3e4;console[_0x382ee4(0x1df)](_0x382ee4(0x1dc),{'hasPayoutHistory':_0x40984b});let _0x2f2fe1={'status':_0x382ee4(0x20a)};_0x40984b&&(_0x2f2fe1[_0x382ee4(0xce)]={'some':{}});const _0x173796=await database_1[_0x382ee4(0x102)][_0x382ee4(0x1d7)]['findMany']({'where':_0x2f2fe1,'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':'asc'}});return console[_0x382ee4(0x1df)](_0x382ee4(0x192)+_0x173796[_0x382ee4(0x154)]+_0x382ee4(0x1fc)+(_0x40984b?'\x20with\x20payout\x20history':'')),_0x173796[_0x382ee4(0x214)](_0x3063e4=>({'id':_0x3063e4['id'],'username':_0x3063e4[_0x382ee4(0x17c)],'name':_0x3063e4[_0x382ee4(0xf7)]}));}[a40_0x33a3e4(0x110)](_0x30a81c){const _0x184333=a40_0x33a3e4,_0x2eed07={'test_gateway':'Test\x20Gateway','plisio':'Plisio','rapyd':_0x184333(0x1c1),'noda':_0x184333(0x150),'cointopay':_0x184333(0x13e),'cointopay2':_0x184333(0x211),'klyme_eu':_0x184333(0x193),'klyme_gb':_0x184333(0xc9),'klyme_de':'KLYME\x20DE','mastercard':_0x184333(0x1d3)};return _0x2eed07[_0x30a81c]||_0x30a81c;}[a40_0x33a3e4(0x12b)](_0xe304fa){const _0x535f82=a40_0x33a3e4,_0x2782e4={'Test\x20Gateway':'test_gateway','Plisio':_0x535f82(0x1a4),'Rapyd':_0x535f82(0xba),'Noda':'noda','CoinToPay':_0x535f82(0x1ce),'CoinToPay2':_0x535f82(0xed),'KLYME\x20EU':_0x535f82(0x1ee),'KLYME\x20GB':'klyme_gb','KLYME\x20DE':'klyme_de','MasterCard':_0x535f82(0x16a)};return _0x2782e4[_0xe304fa]||_0xe304fa[_0x535f82(0x13d)]();}async['getMerchantsAwaitingPayout'](_0x38dd5e){const _0x378f6b=a40_0x33a3e4,{page:_0x30a9e8,limit:_0x53dc69,minAmount:_0x4e670a,search:_0x33e66b}=_0x38dd5e;console[_0x378f6b(0x1df)](_0x378f6b(0xc1),_0x38dd5e);let _0x598afa={'status':'ACTIVE'};_0x33e66b&&(_0x598afa[_0x378f6b(0xf7)]={'contains':_0x33e66b,'mode':_0x378f6b(0x1ec)});const _0x4e07ef=await database_1[_0x378f6b(0x102)][_0x378f6b(0x1d7)]['findMany']({'where':_0x598afa,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),_0x415d4a=_0x4e07ef[_0x378f6b(0x160)](_0x56a4b1=>{const _0x525f6f=_0x378f6b,_0x2d20d3=Math[_0x525f6f(0x1e0)](_0x56a4b1[_0x525f6f(0xbf)]*0x64)/0x64;if(_0x4e670a&&_0x2d20d3<_0x4e670a)return![];return _0x2d20d3!==0x0;});_0x415d4a[_0x378f6b(0x13f)]((_0x3b000a,_0x2cfa88)=>_0x2cfa88[_0x378f6b(0xbf)]-_0x3b000a[_0x378f6b(0xbf)]);const _0x32ab91=_0x415d4a[_0x378f6b(0x154)],_0x15aeda=(_0x30a9e8-0x1)*_0x53dc69,_0x2e73f6=_0x415d4a[_0x378f6b(0xc0)](_0x15aeda,_0x15aeda+_0x53dc69);console[_0x378f6b(0x1df)](_0x378f6b(0x213)+_0x2e73f6[_0x378f6b(0x154)]+_0x378f6b(0xc2));const _0x7a4e1e=await Promise[_0x378f6b(0x1ff)](_0x2e73f6[_0x378f6b(0x214)](async _0x21abc1=>{const _0x3eeffa=_0x378f6b,[_0x5ef783,_0x36aab2,_0x1020a5]=await Promise[_0x3eeffa(0x1ff)]([database_1[_0x3eeffa(0x102)]['payment'][_0x3eeffa(0x1f9)]({'where':{'shopId':_0x21abc1['id'],'status':_0x3eeffa(0x210),'gateway':{'not':'test_gateway'}}}),database_1[_0x3eeffa(0x102)][_0x3eeffa(0x1f5)][_0x3eeffa(0x212)]({'where':{'shopId':_0x21abc1['id'],'status':_0x3eeffa(0x210),'gateway':{'not':'test_gateway'}},'orderBy':{'paidAt':'asc'},'select':{'paidAt':!![]}}),database_1[_0x3eeffa(0x102)][_0x3eeffa(0x1f5)][_0x3eeffa(0x182)]({'by':[_0x3eeffa(0x15d)],'where':{'shopId':_0x21abc1['id'],'status':_0x3eeffa(0x210),'gateway':{'not':_0x3eeffa(0x19d)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x263e33=new Date(),_0x1268b2=new Date(_0x263e33[_0x3eeffa(0x183)](),_0x263e33[_0x3eeffa(0x164)](),0x1),_0x1607e3=new Date(_0x263e33[_0x3eeffa(0x183)](),_0x263e33[_0x3eeffa(0x164)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x11c6c4,_0x4ba43e]=await Promise['all']([database_1['default'][_0x3eeffa(0x1ab)][_0x3eeffa(0x1d8)]({'_sum':{'amount':!![]},'where':{'shopId':_0x21abc1['id'],'status':_0x3eeffa(0x15b)}}),database_1[_0x3eeffa(0x102)][_0x3eeffa(0x1ab)][_0x3eeffa(0x1d8)]({'_sum':{'amount':!![]},'where':{'shopId':_0x21abc1['id'],'status':_0x3eeffa(0x15b),'createdAt':{'gte':_0x1268b2,'lte':_0x1607e3}}})]),_0x262c33=_0x11c6c4[_0x3eeffa(0xe0)][_0x3eeffa(0x20e)]||0x0,_0x1d8a17=_0x4ba43e[_0x3eeffa(0xe0)][_0x3eeffa(0x20e)]||0x0,_0x195b1=await Promise['all'](_0x1020a5[_0x3eeffa(0x214)](async _0x237d29=>{const _0x3d3dcb=_0x3eeffa;let _0x4318e5=0x2d;if(_0x21abc1[_0x3d3dcb(0x1c8)])try{const _0x39f726=JSON[_0x3d3dcb(0x11f)](_0x21abc1[_0x3d3dcb(0x1c8)]);for(const [_0x3934c7,_0x456c5e]of Object[_0x3d3dcb(0x1f3)](_0x39f726)){if(_0x3934c7[_0x3d3dcb(0x13d)]()===_0x237d29['gateway']['toLowerCase']()){_0x4318e5=_0x456c5e[_0x3d3dcb(0x152)]||0xa,console['log']('💰\x20[PAYOUT]\x20Gateway\x20'+_0x237d29[_0x3d3dcb(0x15d)]+'\x20for\x20shop\x20'+_0x21abc1['id']+':\x20commission\x20=\x20'+_0x4318e5+'%');break;}}}catch(_0x268285){console[_0x3d3dcb(0x1b6)]('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x21abc1['id']+':',_0x268285);}const _0x3440fd=_0x237d29['_sum']?.[_0x3d3dcb(0x1ad)]||0x0,_0x897b62=_0x3440fd*(0x1-_0x4318e5/0x64);return{'gateway':_0x237d29['gateway'],'count':_0x237d29[_0x3d3dcb(0x1e1)]?.['id']||0x0,'amountUSDT':Math[_0x3d3dcb(0x1e0)](_0x3440fd*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x3d3dcb(0x1e0)](_0x897b62*0x64)/0x64,'commission':_0x4318e5};})),_0x2f0751=_0x195b1[_0x3eeffa(0x1a3)]((_0x560252,_0x1c0af1)=>_0x560252+_0x1c0af1[_0x3eeffa(0x1ad)],0x0),_0x225621=_0x195b1[_0x3eeffa(0x1a3)]((_0x368b30,_0xd0094a)=>_0x368b30+_0xd0094a[_0x3eeffa(0x105)],0x0),_0x260ea2=_0x21abc1[_0x3eeffa(0xbf)];return console[_0x3eeffa(0x1df)](_0x3eeffa(0xfc)+_0x21abc1[_0x3eeffa(0x17c)]+':'),console[_0x3eeffa(0x1df)](_0x3eeffa(0x16c)+_0x2f0751[_0x3eeffa(0x120)](0x2)+_0x3eeffa(0x200)),console['log'](_0x3eeffa(0x17e)+_0x225621[_0x3eeffa(0x120)](0x2)+'\x20USDT\x20(theoretical\x20net)'),console['log']('\x20\x20\x20✅\x20Actual\x20available\x20balance:\x20'+_0x260ea2[_0x3eeffa(0x120)](0x2)+_0x3eeffa(0x191)),console[_0x3eeffa(0x1df)](_0x3eeffa(0x1b5)+_0x262c33[_0x3eeffa(0x120)](0x2)+_0x3eeffa(0x128)),console[_0x3eeffa(0x1df)](_0x3eeffa(0x11b)+(_0x225621-_0x262c33-_0x260ea2)[_0x3eeffa(0x120)](0x2)+_0x3eeffa(0xbc)),{'id':_0x21abc1['id'],'fullName':_0x21abc1[_0x3eeffa(0xf7)],'username':_0x21abc1[_0x3eeffa(0x17c)],'telegramId':_0x21abc1[_0x3eeffa(0x1de)],'merchantUrl':_0x21abc1[_0x3eeffa(0x109)],'wallets':{'usdtPolygonWallet':_0x21abc1[_0x3eeffa(0x1f0)],'usdtTrcWallet':_0x21abc1[_0x3eeffa(0xcd)],'usdtErcWallet':_0x21abc1[_0x3eeffa(0x132)],'usdcPolygonWallet':_0x21abc1['usdcPolygonWallet'],'usdcErcWallet':_0x21abc1[_0x3eeffa(0xfb)]},'totalAmountUSDT':Math['round'](_0x2f0751*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x3eeffa(0x1e0)](_0x225621*0x64)/0x64,'currentBalance':Math[_0x3eeffa(0x1e0)](_0x260ea2*0x64)/0x64,'totalPayout':Math[_0x3eeffa(0x1e0)](_0x262c33*0x64)/0x64,'thisMonth':Math[_0x3eeffa(0x1e0)](_0x1d8a17*0x64)/0x64,'paymentsCount':_0x5ef783,'oldestPaymentDate':_0x36aab2?.['paidAt']||_0x21abc1[_0x3eeffa(0xcf)],'gatewayBreakdown':_0x195b1};})),_0x137825=_0x7a4e1e[_0x378f6b(0x1a3)]((_0x2a18b1,_0x7359b2)=>_0x2a18b1+_0x7359b2[_0x378f6b(0xff)],0x0),_0x5c899b=_0x7a4e1e[_0x378f6b(0x1a3)]((_0x4180df,_0xaccad5)=>_0x4180df+_0xaccad5[_0x378f6b(0x1e5)],0x0),_0x4cad67=_0x7a4e1e[_0x378f6b(0x1a3)]((_0x5caf01,_0x18fad6)=>_0x5caf01+_0x18fad6[_0x378f6b(0x207)],0x0),_0x20954a=_0x7a4e1e[_0x378f6b(0x1a3)]((_0x4e8a74,_0x15f20e)=>_0x4e8a74+_0x15f20e[_0x378f6b(0x12f)],0x0);return console['log'](_0x378f6b(0x1db)+_0x32ab91+'\x20merchants'),console['log'](_0x378f6b(0x113)+Math['round'](_0x137825*0x64)/0x64+_0x378f6b(0x200)),console[_0x378f6b(0x1df)](_0x378f6b(0x17b)+Math[_0x378f6b(0x1e0)](_0x5c899b*0x64)/0x64+'\x20USDT\x20(rounded\x20to\x202\x20decimal\x20places)'),console[_0x378f6b(0x1df)]('\x20\x20\x20💸\x20Total\x20payouts\x20(all\x20time):\x20'+Math['round'](_0x4cad67*0x64)/0x64+_0x378f6b(0x11d)),console['log']('\x20\x20\x20📅\x20Total\x20payouts\x20(this\x20month):\x20'+Math[_0x378f6b(0x1e0)](_0x20954a*0x64)/0x64+_0x378f6b(0x11d)),{'merchants':_0x7a4e1e,'pagination':{'page':_0x30a9e8,'limit':_0x53dc69,'total':_0x32ab91,'totalPages':Math[_0x378f6b(0xb9)](_0x32ab91/_0x53dc69)},'summary':{'totalMerchants':_0x32ab91,'totalAmountUSDT':Math[_0x378f6b(0x1e0)](_0x137825*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x378f6b(0x1e0)](_0x5c899b*0x64)/0x64,'totalPayout':Math['round'](_0x4cad67*0x64)/0x64,'thisMonth':Math[_0x378f6b(0x1e0)](_0x20954a*0x64)/0x64}};}async[a40_0x33a3e4(0x1e9)](_0x1b1518){const _0x442ed2=a40_0x33a3e4,{shopId:_0x21dcbd,amount:_0x49f67f,network:_0x1f49c0,wallet:_0xfc5a8b,notes:_0x5c55c6,txid:_0x4765f1,periodFrom:_0x2d00c8,periodTo:_0x42ae57}=_0x1b1518,_0x3807bc=await database_1[_0x442ed2(0x102)]['$transaction'](async _0x477c1e=>{const _0x564ba5=_0x442ed2,_0x18766f=await _0x477c1e[_0x564ba5(0x1d7)][_0x564ba5(0x155)]({'where':{'id':_0x21dcbd},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x18766f)throw new Error(_0x564ba5(0xde));console['log'](_0x564ba5(0x14e)+_0x18766f['username']+':'),console[_0x564ba5(0x1df)](_0x564ba5(0x122)+_0x18766f[_0x564ba5(0xbf)][_0x564ba5(0x120)](0x6)+_0x564ba5(0x11d)),console[_0x564ba5(0x1df)](_0x564ba5(0xd6)+_0x49f67f[_0x564ba5(0x120)](0x6)+_0x564ba5(0x11d)),console[_0x564ba5(0x1df)](_0x564ba5(0x1aa)+_0x18766f[_0x564ba5(0xd1)][_0x564ba5(0x120)](0x6)+'\x20USDT');if(_0x4765f1)console[_0x564ba5(0x1df)](_0x564ba5(0x1b7)+_0x4765f1);const _0x1d811e=0.000001,_0x2f9a7a=Number(_0x18766f[_0x564ba5(0xbf)]),_0x1ea85a=Number(_0x49f67f);console[_0x564ba5(0x1df)](_0x564ba5(0x1f4)),console[_0x564ba5(0x1df)](_0x564ba5(0xf9)+_0x18766f[_0x564ba5(0xbf)]),console[_0x564ba5(0x1df)]('\x20\x20\x20Available\x20(number):\x20'+_0x2f9a7a),console[_0x564ba5(0x1df)](_0x564ba5(0x10f)+_0x1ea85a),console[_0x564ba5(0x1df)]('\x20\x20\x20Difference:\x20'+(_0x2f9a7a-_0x1ea85a)),console[_0x564ba5(0x1df)]('\x20\x20\x20Tolerance:\x20'+_0x1d811e);if(_0x2f9a7a<_0x1ea85a-_0x1d811e)throw new Error('Insufficient\x20balance.\x20Available:\x20'+_0x2f9a7a['toFixed'](0x6)+_0x564ba5(0x138)+_0x1ea85a[_0x564ba5(0x120)](0x6)+_0x564ba5(0x1fa)+(_0x2f9a7a-_0x1ea85a)[_0x564ba5(0x120)](0x8)+_0x564ba5(0x11d));console[_0x564ba5(0x1df)](_0x564ba5(0x168));const _0x1fe266=Math[_0x564ba5(0x16d)](_0x2f9a7a,_0x1ea85a);let _0xbb715e=_0xfc5a8b;console['log'](_0x564ba5(0x112)+(_0xfc5a8b||'not\x20provided'));if(!_0xbb715e){console[_0x564ba5(0x1df)](_0x564ba5(0x13a));const _0x1ae409=await _0x477c1e[_0x564ba5(0x1d7)][_0x564ba5(0x155)]({'where':{'id':_0x21dcbd},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});console[_0x564ba5(0x1df)](_0x564ba5(0x1c9),_0x1ae409);if(_0x1ae409)switch(_0x1f49c0){case _0x564ba5(0xb2):_0xbb715e=_0x1ae409[_0x564ba5(0x1f0)]||undefined,console['log'](_0x564ba5(0xea)+_0xbb715e);break;case'trc20':_0xbb715e=_0x1ae409[_0x564ba5(0xcd)]||undefined,console['log']('🔍\x20Selected\x20trc20\x20wallet:\x20'+_0xbb715e);break;case _0x564ba5(0xe3):_0xbb715e=_0x1ae409[_0x564ba5(0x132)]||undefined,console[_0x564ba5(0x1df)](_0x564ba5(0xda)+_0xbb715e);break;case'polygon_usdc':_0xbb715e=_0x1ae409[_0x564ba5(0x1a6)]||undefined,console[_0x564ba5(0x1df)](_0x564ba5(0xb3)+_0xbb715e);break;case _0x564ba5(0x1a1):_0xbb715e=_0x1ae409[_0x564ba5(0xfb)]||undefined,console[_0x564ba5(0x1df)]('🔍\x20Selected\x20erc20_usdc\x20wallet:\x20'+_0xbb715e);break;}}else console[_0x564ba5(0x1df)]('✅\x20Using\x20wallet\x20from\x20request:\x20'+_0xbb715e);console['log'](_0x564ba5(0x1b0)+_0x1f49c0+':\x20'+(_0xbb715e||_0x564ba5(0x1ef))),console[_0x564ba5(0x1df)](_0x564ba5(0xae),{'shopId':_0x21dcbd,'amount':_0x1fe266,'network':_0x1f49c0,'wallet':_0xbb715e,'status':_0x564ba5(0x15b),'txid':_0x4765f1,'notes':_0x5c55c6,'periodFrom':_0x2d00c8?new Date(_0x2d00c8):null,'periodTo':_0x42ae57?new Date(_0x42ae57):null});const _0x410d20=await _0x477c1e[_0x564ba5(0x1ab)][_0x564ba5(0x1a8)]({'data':{'shopId':_0x21dcbd,'amount':_0x1fe266,'network':_0x1f49c0,'wallet':_0xbb715e,'status':_0x564ba5(0x15b),'txid':_0x4765f1,'notes':_0x5c55c6,'periodFrom':_0x2d00c8?new Date(_0x2d00c8):null,'periodTo':_0x42ae57?new Date(_0x42ae57):null,'createdAt':new Date(),'paidAt':new Date()}});console[_0x564ba5(0x1df)]('✅\x20Payout\x20created\x20in\x20DB:',{'id':_0x410d20['id'],'wallet':_0x410d20[_0x564ba5(0x1e7)],'network':_0x410d20[_0x564ba5(0x1ea)],'amount':_0x410d20[_0x564ba5(0x20e)]});const _0x1028e8=_0x2f9a7a-_0x1fe266,_0x1057e0=Number(_0x18766f['totalPaidOut'])+_0x1fe266;return await _0x477c1e[_0x564ba5(0x1d7)][_0x564ba5(0x1ed)]({'where':{'id':_0x21dcbd},'data':{'balance':_0x1028e8,'totalPaidOut':_0x1057e0}}),console[_0x564ba5(0x1df)](_0x564ba5(0x1eb)+_0x18766f[_0x564ba5(0x17c)]+_0x564ba5(0x15f)),console[_0x564ba5(0x1df)](_0x564ba5(0x1f1)+_0x2f9a7a[_0x564ba5(0x120)](0x6)+_0x564ba5(0xc4)+_0x1028e8[_0x564ba5(0x120)](0x6)+_0x564ba5(0x12d)+_0x1fe266[_0x564ba5(0x120)](0x6)+')'),console[_0x564ba5(0x1df)]('\x20\x20\x20Total\x20paid\x20out:\x20'+_0x18766f[_0x564ba5(0xd1)]['toFixed'](0x6)+_0x564ba5(0xc4)+_0x1057e0['toFixed'](0x6)+_0x564ba5(0x104)+_0x1fe266[_0x564ba5(0x120)](0x6)+')'),console[_0x564ba5(0x1df)]('\x20\x20\x20Final\x20payout\x20amount\x20used:\x20'+_0x1fe266[_0x564ba5(0x120)](0x6)+_0x564ba5(0x11d)),{'payout':_0x410d20,'shop':_0x18766f};});console['log'](_0x442ed2(0x158)+_0x3807bc[_0x442ed2(0x1ab)]['id']+_0x442ed2(0x1f6)+_0x3807bc[_0x442ed2(0x1d7)][_0x442ed2(0x17c)]+'\x20('+_0x3807bc['payout'][_0x442ed2(0x20e)]['toFixed'](0x6)+_0x442ed2(0x166));try{let _0x45cc4d=_0x442ed2(0x100);if(_0x3807bc[_0x442ed2(0x1ab)][_0x442ed2(0x170)]&&_0x3807bc[_0x442ed2(0x1ab)][_0x442ed2(0x14a)]){const _0x4f9bf6=new Date(_0x3807bc['payout'][_0x442ed2(0x170)])[_0x442ed2(0xbe)]('ru-RU'),_0x4126e4=new Date(_0x3807bc['payout'][_0x442ed2(0x14a)])[_0x442ed2(0xbe)](_0x442ed2(0x165));_0x45cc4d=_0x4f9bf6+'\x20-\x20'+_0x4126e4;}await telegramBotService_1['telegramBotService']['sendPayoutNotification'](_0x3807bc['payout']['shopId'],{'id':_0x3807bc['payout']['id'],'amount':_0x3807bc['payout'][_0x442ed2(0x20e)],'network':_0x3807bc[_0x442ed2(0x1ab)][_0x442ed2(0x1ea)],'wallet':_0x3807bc[_0x442ed2(0x1ab)]['wallet'],'period':_0x45cc4d,'createdAt':_0x3807bc['payout'][_0x442ed2(0xcf)],'txid':_0x3807bc['payout']['txid']}),console[_0x442ed2(0x1df)](_0x442ed2(0x13c)+_0x3807bc[_0x442ed2(0x1ab)]['id']);}catch(_0x346f6f){console[_0x442ed2(0x1b6)](_0x442ed2(0x215)+_0x3807bc['payout']['id']+':',_0x346f6f);}return{'id':_0x3807bc[_0x442ed2(0x1ab)]['id'],'shopId':_0x3807bc[_0x442ed2(0x1ab)][_0x442ed2(0x1c0)],'shopName':_0x3807bc['shop'][_0x442ed2(0xf7)],'shopUsername':_0x3807bc['shop'][_0x442ed2(0x17c)],'amount':_0x3807bc[_0x442ed2(0x1ab)][_0x442ed2(0x20e)],'network':_0x3807bc['payout'][_0x442ed2(0x1ea)],'wallet':_0x3807bc['payout']['wallet'],'status':_0x3807bc[_0x442ed2(0x1ab)][_0x442ed2(0x139)],'txid':_0x3807bc[_0x442ed2(0x1ab)][_0x442ed2(0xe4)],'notes':_0x3807bc['payout']['notes'],'periodFrom':_0x3807bc[_0x442ed2(0x1ab)][_0x442ed2(0x170)],'periodTo':_0x3807bc[_0x442ed2(0x1ab)][_0x442ed2(0x14a)],'createdAt':_0x3807bc[_0x442ed2(0x1ab)]['createdAt'],'paidAt':_0x3807bc['payout'][_0x442ed2(0x172)]};}async[a40_0x33a3e4(0x187)](_0x245360){const _0x524fad=a40_0x33a3e4,{page:_0x32259e,limit:_0x432108,shopId:_0xef40a7,network:_0x1b4b4a,dateFrom:_0x56dbe9,dateTo:_0x3a9b6d,search:_0x6baea}=_0x245360,_0x7b835c=(_0x32259e-0x1)*_0x432108,_0x446ee1={};_0xef40a7&&(_0x446ee1[_0x524fad(0x1c0)]=_0xef40a7);_0x1b4b4a&&(_0x446ee1[_0x524fad(0x1ea)]=_0x1b4b4a);if(_0x56dbe9||_0x3a9b6d){_0x446ee1[_0x524fad(0xcf)]={};if(_0x56dbe9){const _0x1ae92e=new Date(_0x56dbe9);_0x1ae92e[_0x524fad(0x17f)](0x0,0x0,0x0,0x1),_0x446ee1[_0x524fad(0xcf)]['gte']=_0x1ae92e,console['log'](_0x524fad(0x1d4)+_0x1ae92e[_0x524fad(0xcb)]());}if(_0x3a9b6d){const _0x37d09b=new Date(_0x3a9b6d);_0x37d09b[_0x524fad(0x17f)](0x17,0x3b,0x3b,0x3e7),_0x446ee1[_0x524fad(0xcf)]['lte']=_0x37d09b,console[_0x524fad(0x1df)](_0x524fad(0x126)+_0x37d09b[_0x524fad(0xcb)]());}}_0x6baea&&(_0x446ee1['OR']=[{'shop':{'name':{'contains':_0x6baea,'mode':_0x524fad(0x1ec)}}},{'shop':{'username':{'contains':_0x6baea,'mode':_0x524fad(0x1ec)}}},{'notes':{'contains':_0x6baea,'mode':_0x524fad(0x1ec)}}]);const [_0x28473a,_0x54d486]=await Promise['all']([database_1[_0x524fad(0x102)][_0x524fad(0x1ab)][_0x524fad(0x1d9)]({'where':_0x446ee1,'skip':_0x7b835c,'take':_0x432108,'orderBy':{'createdAt':_0x524fad(0x174)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'wallet':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x524fad(0x102)][_0x524fad(0x1ab)][_0x524fad(0x1f9)]({'where':_0x446ee1})]);return{'payouts':_0x28473a[_0x524fad(0x214)](_0x110d07=>({'id':_0x110d07['id'],'shopId':_0x110d07[_0x524fad(0x1c0)],'shopName':_0x110d07['shop'][_0x524fad(0xf7)],'shopUsername':_0x110d07[_0x524fad(0x1d7)][_0x524fad(0x17c)],'amount':_0x110d07[_0x524fad(0x20e)],'network':_0x110d07[_0x524fad(0x1ea)],'wallet':_0x110d07[_0x524fad(0x1e7)],'status':_0x110d07[_0x524fad(0x139)],'txid':_0x110d07[_0x524fad(0xe4)],'notes':_0x110d07[_0x524fad(0xc5)],'periodFrom':_0x110d07[_0x524fad(0x170)],'periodTo':_0x110d07[_0x524fad(0x14a)],'createdAt':_0x110d07[_0x524fad(0xcf)],'paidAt':_0x110d07[_0x524fad(0x172)]})),'pagination':{'page':_0x32259e,'limit':_0x432108,'total':_0x54d486,'totalPages':Math[_0x524fad(0xb9)](_0x54d486/_0x432108)}};}async['getPayoutById'](_0x28a3fc){const _0x21d2a1=a40_0x33a3e4,_0x51d217=await database_1[_0x21d2a1(0x102)][_0x21d2a1(0x1ab)][_0x21d2a1(0x155)]({'where':{'id':_0x28a3fc},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x51d217)return null;return{'id':_0x51d217['id'],'shopId':_0x51d217[_0x21d2a1(0x1c0)],'shopName':_0x51d217['shop'][_0x21d2a1(0xf7)],'shopUsername':_0x51d217[_0x21d2a1(0x1d7)][_0x21d2a1(0x17c)],'amount':_0x51d217['amount'],'network':_0x51d217[_0x21d2a1(0x1ea)],'wallet':_0x51d217['wallet'],'status':_0x51d217['status'],'txid':_0x51d217['txid'],'notes':_0x51d217['notes'],'periodFrom':_0x51d217['periodFrom'],'periodTo':_0x51d217[_0x21d2a1(0x14a)],'createdAt':_0x51d217[_0x21d2a1(0xcf)],'paidAt':_0x51d217[_0x21d2a1(0x172)]};}async[a40_0x33a3e4(0x146)](_0x3c2310){const _0x287e67=a40_0x33a3e4;await database_1[_0x287e67(0x102)][_0x287e67(0x1ab)][_0x287e67(0xd4)]({'where':{'id':_0x3c2310}});}async[a40_0x33a3e4(0x17d)](_0x31d7b9){const _0x19bd46=a40_0x33a3e4,{page:_0x2735c4,limit:_0x38cb6a,status:_0x348073,gateway:_0x23b06b,shopId:_0x4517bd,dateFrom:_0x2ff1ca,dateTo:_0xba67bb,search:_0x1fe1d8,currency:_0x482300,sortBy:_0x1146cf,sortOrder:_0x20af1d}=_0x31d7b9,_0x4bd2ca=(_0x2735c4-0x1)*_0x38cb6a;console[_0x19bd46(0x1df)]('📊\x20Getting\x20payments\x20with\x20filters:',_0x31d7b9);const _0x49a4a7=await database_1[_0x19bd46(0x102)][_0x19bd46(0x1f5)]['groupBy']({'by':['gateway'],'_count':{'gateway':!![]}});console[_0x19bd46(0x1df)](_0x19bd46(0x134),_0x49a4a7[_0x19bd46(0x214)](_0x56d70f=>_0x56d70f['gateway']+'\x20('+_0x56d70f[_0x19bd46(0x1e1)][_0x19bd46(0x15d)]+_0x19bd46(0x19c)));if(_0x23b06b){const _0x627d11=_0x49a4a7[_0x19bd46(0xb5)](_0x277a70=>_0x277a70['gateway']['toLowerCase']()===_0x23b06b['toLowerCase']());!_0x627d11&&_0x23b06b[_0x19bd46(0x13d)]()!=='test_gateway'&&console[_0x19bd46(0x1df)](_0x19bd46(0x196)+_0x23b06b+_0x19bd46(0x1c4)+_0x49a4a7[_0x19bd46(0x214)](_0x3ea219=>_0x3ea219[_0x19bd46(0x15d)])['join'](',\x20'));}const _0x53eea5={};_0x348073&&(_0x53eea5[_0x19bd46(0x139)]=_0x348073[_0x19bd46(0x171)]());if(!_0x23b06b)_0x53eea5['gateway']={'not':'test_gateway'};else{if(_0x23b06b&&(_0x23b06b['toLowerCase']()===_0x19bd46(0x19d)||_0x23b06b===_0x19bd46(0x10a)))_0x53eea5['gateway']='test_gateway';else{let _0x303e03=_0x23b06b;const _0xb2a662=(0x0,gateway_1['getGatewayNameById'])(_0x23b06b);if(_0xb2a662)_0x303e03=_0xb2a662,console[_0x19bd46(0x1df)](_0x19bd46(0x12a)+_0x23b06b+_0x19bd46(0xf5)+_0x303e03+'\x27');else{const _0x16100b=(0x0,gateway_1[_0x19bd46(0x197)])(_0x23b06b);if(_0x16100b){const _0x586207=(0x0,gateway_1[_0x19bd46(0x161)])(_0x16100b);_0x586207&&(_0x303e03=_0x586207,console['log'](_0x19bd46(0x18c)+_0x23b06b+_0x19bd46(0x159)+_0x16100b+_0x19bd46(0x111)+_0x303e03+'\x27'));}else console[_0x19bd46(0x1df)](_0x19bd46(0x162)+_0x23b06b+'\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)');}const _0x5a4762=await database_1['default'][_0x19bd46(0x1f5)][_0x19bd46(0x1f9)]({'where':{'gateway':_0x303e03[_0x19bd46(0x13d)]()},'take':0x1});_0x5a4762===0x0?(console[_0x19bd46(0x1df)](_0x19bd46(0x11a)+_0x303e03+_0x19bd46(0x16e)+_0x23b06b+_0x19bd46(0x1cc)),_0x53eea5[_0x19bd46(0x15d)]=_0x19bd46(0xf2)):(_0x53eea5['gateway']=_0x303e03[_0x19bd46(0x13d)](),console[_0x19bd46(0x1df)](_0x19bd46(0x1cf)+_0x303e03+'\x27\x20(from\x20\x27'+_0x23b06b+'\x27)'));}}console['log'](_0x19bd46(0x184),_0x53eea5[_0x19bd46(0x15d)]);_0x4517bd&&(_0x53eea5[_0x19bd46(0x1c0)]=_0x4517bd);_0x482300&&(_0x53eea5[_0x19bd46(0x1b1)]=_0x482300['toUpperCase'](),console[_0x19bd46(0x1df)](_0x19bd46(0x1b9)+_0x482300[_0x19bd46(0x171)]()));if(_0x2ff1ca||_0xba67bb){_0x53eea5['createdAt']={};if(_0x2ff1ca){const _0x56a3f1=new Date(_0x2ff1ca);_0x56a3f1[_0x19bd46(0x17f)](0x0,0x0,0x0,0x1),_0x53eea5[_0x19bd46(0xcf)][_0x19bd46(0x1a0)]=_0x56a3f1,console['log'](_0x19bd46(0xe2)+_0x56a3f1['toISOString']());}if(_0xba67bb){const _0x57b9a7=new Date(_0xba67bb);_0x57b9a7[_0x19bd46(0x17f)](0x17,0x3b,0x3b,0x3e7),_0x53eea5[_0x19bd46(0xcf)][_0x19bd46(0x15a)]=_0x57b9a7,console[_0x19bd46(0x1df)](_0x19bd46(0xe5)+_0x57b9a7[_0x19bd46(0xcb)]());}}_0x1fe1d8&&(_0x53eea5['OR']=[{'id':{'contains':_0x1fe1d8,'mode':_0x19bd46(0x1ec)}},{'orderId':{'contains':_0x1fe1d8,'mode':_0x19bd46(0x1ec)}},{'gatewayOrderId':{'contains':_0x1fe1d8,'mode':'insensitive'}},{'customerEmail':{'contains':_0x1fe1d8,'mode':_0x19bd46(0x1ec)}},{'shop':{'name':{'contains':_0x1fe1d8,'mode':_0x19bd46(0x1ec)}}},{'shop':{'username':{'contains':_0x1fe1d8,'mode':_0x19bd46(0x1ec)}}}]);console[_0x19bd46(0x1df)](_0x19bd46(0xca),JSON['stringify'](_0x53eea5,null,0x2));let _0xb77a71={'createdAt':_0x19bd46(0x174)};if(_0x1146cf){const _0x138090=[_0x19bd46(0x20e),_0x19bd46(0xcf),_0x19bd46(0xcc),_0x19bd46(0x139),_0x19bd46(0x15d),'currency'],_0x3253d8=[_0x19bd46(0x201),'desc'];if(_0x138090[_0x19bd46(0x19b)](_0x1146cf)){const _0x9447d0=_0x3253d8['includes'](_0x20af1d)?_0x20af1d:_0x19bd46(0x174);_0xb77a71={[_0x1146cf]:_0x9447d0},console[_0x19bd46(0x1df)](_0x19bd46(0x169)+_0x1146cf+_0x19bd46(0x115)+_0x9447d0+_0x19bd46(0x180));}}const [_0x53a603,_0x3269d1]=await Promise[_0x19bd46(0x1ff)]([database_1[_0x19bd46(0x102)][_0x19bd46(0x1f5)][_0x19bd46(0x1d9)]({'where':_0x53eea5,'skip':_0x4bd2ca,'take':_0x38cb6a,'orderBy':_0xb77a71,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default']['payment']['count']({'where':_0x53eea5})]);return{'payments':_0x53a603,'pagination':{'page':_0x2735c4,'limit':_0x38cb6a,'total':_0x3269d1,'totalPages':Math['ceil'](_0x3269d1/_0x38cb6a)}};}async[a40_0x33a3e4(0xeb)](_0x59f95e){const _0x5556f8=a40_0x33a3e4,_0x287567=await database_1[_0x5556f8(0x102)]['payment'][_0x5556f8(0x155)]({'where':{'id':_0x59f95e},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x287567)return null;return{'id':_0x287567['id'],'shopId':_0x287567[_0x5556f8(0x1c0)],'gateway':_0x287567[_0x5556f8(0x15d)],'amount':_0x287567[_0x5556f8(0x20e)],'currency':_0x287567[_0x5556f8(0x1b1)],'status':_0x287567['status'],'orderId':_0x287567[_0x5556f8(0xd8)],'gatewayOrderId':_0x287567[_0x5556f8(0x195)],'customerEmail':_0x287567['customerEmail'],'customerName':_0x287567[_0x5556f8(0x124)],'customerCountry':_0x287567[_0x5556f8(0x181)],'customerIp':_0x287567[_0x5556f8(0x13b)],'customerUa':_0x287567[_0x5556f8(0x149)],'failureMessage':_0x287567[_0x5556f8(0x10c)],'externalPaymentUrl':_0x287567[_0x5556f8(0x131)],'successUrl':_0x287567[_0x5556f8(0x14f)],'failUrl':_0x287567[_0x5556f8(0xb1)],'pendingUrl':_0x287567[_0x5556f8(0xee)],'whiteUrl':_0x287567['whiteUrl'],'createdAt':_0x287567[_0x5556f8(0xcf)],'updatedAt':_0x287567[_0x5556f8(0xcc)],'shop':_0x287567[_0x5556f8(0x1d7)]};}async['updatePaymentStatus'](_0x15d8a5,_0x23a6f1,_0x1c5f14,_0x4e1f2f){const _0x336694=a40_0x33a3e4,_0x1d8b72=await database_1[_0x336694(0x102)]['$transaction'](async _0x436889=>{const _0x103c53=_0x336694,_0x422bc6=await _0x436889['payment'][_0x103c53(0x155)]({'where':{'id':_0x15d8a5},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x422bc6)throw new Error(_0x103c53(0x20c));const _0x1994d0=_0x422bc6[_0x103c53(0x139)],_0x784344=_0x23a6f1[_0x103c53(0x171)]();console[_0x103c53(0x1df)](_0x103c53(0x103)+_0x15d8a5+_0x103c53(0x143)+_0x1994d0+'\x20->\x20'+_0x784344),console[_0x103c53(0x1df)](_0x103c53(0x117)+_0x422bc6[_0x103c53(0x1d7)][_0x103c53(0xbf)]+_0x103c53(0x11d));const _0x354d25={'status':_0x784344,'updatedAt':new Date(),'statusChangedBy':_0x103c53(0x11e),'statusChangedAt':new Date()};_0x1c5f14&&(_0x354d25['adminNotes']=_0x1c5f14);_0x784344==='CHARGEBACK'&&_0x4e1f2f&&(_0x354d25[_0x103c53(0xf8)]=_0x4e1f2f);let _0x4edfdf=0x0,_0x16402a=_0x422bc6[_0x103c53(0x1d7)][_0x103c53(0xbf)];if(_0x784344==='PAID'&&_0x1994d0!=='PAID'){_0x354d25[_0x103c53(0x172)]=new Date();const _0x8f78d4=await currencyService_1['currencyService'][_0x103c53(0x199)](_0x422bc6[_0x103c53(0x20e)],_0x422bc6[_0x103c53(0x1b1)]);_0x354d25[_0x103c53(0x1ad)]=_0x8f78d4;let _0x44f706=0x2d;const _0xef1e20=await _0x436889[_0x103c53(0x1d7)][_0x103c53(0x155)]({'where':{'id':_0x422bc6[_0x103c53(0x1c0)]},'select':{'gatewaySettings':!![]}});if(_0xef1e20?.[_0x103c53(0x1c8)])try{const _0x33cc95=JSON['parse'](_0xef1e20[_0x103c53(0x1c8)]);for(const [_0x53d277,_0x3db6f1]of Object[_0x103c53(0x1f3)](_0x33cc95)){if(_0x53d277[_0x103c53(0x13d)]()===_0x422bc6[_0x103c53(0x15d)]['toLowerCase']()){_0x44f706=_0x3db6f1[_0x103c53(0x152)]||0xa;break;}}}catch(_0x39b516){console['error'](_0x103c53(0x16f)+_0x15d8a5+':',_0x39b516);}let _0x5b4531;_0x422bc6[_0x103c53(0x18d)]!==null&&_0x422bc6[_0x103c53(0x18d)]!==undefined?(_0x5b4531=_0x422bc6[_0x103c53(0x18d)],console[_0x103c53(0x1df)](_0x103c53(0xc7)+_0x5b4531[_0x103c53(0x120)](0x6)+_0x103c53(0x14d)+_0x15d8a5)):(_0x5b4531=_0x8f78d4*(0x1-_0x44f706/0x64),console[_0x103c53(0x1df)](_0x103c53(0x16b)+_0x15d8a5+':\x20'+_0x44f706+_0x103c53(0x19e)+_0x8f78d4[_0x103c53(0x120)](0x6)+_0x103c53(0x11d)),_0x354d25[_0x103c53(0x18d)]=_0x5b4531,_0x354d25[_0x103c53(0xf3)]=_0x44f706),_0x4edfdf=_0x5b4531,_0x16402a+=_0x5b4531,console[_0x103c53(0x1df)]('💰\x20Payment\x20'+_0x15d8a5+'\x20became\x20PAID:'),console[_0x103c53(0x1df)](_0x103c53(0xf0)+_0x8f78d4[_0x103c53(0x120)](0x6)+'\x20USDT'),console[_0x103c53(0x1df)](_0x103c53(0x127)+_0x422bc6[_0x103c53(0x15d)]+_0x103c53(0xfe)+_0x44f706+'%'),console['log']('\x20\x20\x20Merchant\x20gets:\x20'+_0x5b4531[_0x103c53(0x120)](0x6)+_0x103c53(0xd7)+_0x44f706+_0x103c53(0x142)),console[_0x103c53(0x1df)](_0x103c53(0xd0)+_0x5b4531[_0x103c53(0x120)](0x6)+_0x103c53(0x11d));}else{if(_0x1994d0===_0x103c53(0x210)&&_0x784344!==_0x103c53(0x210)&&_0x784344!==_0x103c53(0x173)){if(_0x422bc6[_0x103c53(0x1ad)]){let _0x3fd975=0x2d;const _0x2da6c7=await _0x436889[_0x103c53(0x1d7)][_0x103c53(0x155)]({'where':{'id':_0x422bc6[_0x103c53(0x1c0)]},'select':{'gatewaySettings':!![]}});if(_0x2da6c7?.[_0x103c53(0x1c8)])try{const _0xf8c63=JSON['parse'](_0x2da6c7['gatewaySettings']);for(const [_0x4719f9,_0xc2196d]of Object[_0x103c53(0x1f3)](_0xf8c63)){if(_0x4719f9[_0x103c53(0x13d)]()===_0x422bc6['gateway'][_0x103c53(0x13d)]()){_0x3fd975=_0xc2196d[_0x103c53(0x152)]||0xa;break;}}}catch(_0x57e25a){console[_0x103c53(0x1b6)]('Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20'+_0x15d8a5+':',_0x57e25a);}const _0x5a390f=_0x422bc6[_0x103c53(0x1ad)]*(0x1-_0x3fd975/0x64);_0x4edfdf=-_0x5a390f,_0x16402a-=_0x5a390f,console['log'](_0x103c53(0xf0)+_0x422bc6[_0x103c53(0x1ad)][_0x103c53(0x120)](0x6)+_0x103c53(0x11d)),console['log']('\x20\x20\x20Gateway:\x20'+_0x422bc6[_0x103c53(0x15d)]+_0x103c53(0xfe)+_0x3fd975+'%'),console[_0x103c53(0x1df)]('\x20\x20\x20Merchant\x20loses:\x20'+_0x5a390f[_0x103c53(0x120)](0x6)+_0x103c53(0xd7)+_0x3fd975+_0x103c53(0x142)),console['log'](_0x103c53(0x198)+_0x5a390f[_0x103c53(0x120)](0x6)+'\x20USDT');}}}_0x784344===_0x103c53(0x173)&&(console[_0x103c53(0x1df)](_0x103c53(0xd2)),_0x4e1f2f&&_0x4e1f2f>0x0?(_0x4edfdf=-_0x4e1f2f,_0x16402a-=_0x4e1f2f,console[_0x103c53(0x1df)](_0x103c53(0xd5)+_0x4e1f2f['toFixed'](0x6)+_0x103c53(0x157)),console[_0x103c53(0x1df)](_0x103c53(0x18f))):console['log'](_0x103c53(0x125)),_0x354d25[_0x103c53(0xf8)]=_0x4e1f2f||0x0);_0x784344===_0x103c53(0xc3)&&_0x1994d0===_0x103c53(0x210)&&console[_0x103c53(0x1df)](_0x103c53(0x136));const _0x57c0a1=await _0x436889[_0x103c53(0x1f5)][_0x103c53(0x1ed)]({'where':{'id':_0x15d8a5},'data':_0x354d25,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x4edfdf!==0x0&&(await _0x436889[_0x103c53(0x1d7)][_0x103c53(0x1ed)]({'where':{'id':_0x422bc6[_0x103c53(0x1c0)]},'data':{'balance':_0x16402a}}),console[_0x103c53(0x1df)](_0x103c53(0x1eb)+_0x422bc6[_0x103c53(0x1c0)]+_0x103c53(0x12c)+_0x422bc6['shop'][_0x103c53(0xbf)]['toFixed'](0x6)+_0x103c53(0xc4)+_0x16402a['toFixed'](0x6)+_0x103c53(0x208)+(_0x4edfdf>0x0?'+':'')+_0x4edfdf['toFixed'](0x6)+')')),_0x57c0a1;});return{'id':_0x1d8b72['id'],'shopId':_0x1d8b72[_0x336694(0x1c0)],'gateway':_0x1d8b72[_0x336694(0x15d)],'amount':_0x1d8b72[_0x336694(0x20e)],'currency':_0x1d8b72[_0x336694(0x1b1)],'status':_0x1d8b72['status'],'orderId':_0x1d8b72['orderId'],'gatewayOrderId':_0x1d8b72[_0x336694(0x195)],'customerEmail':_0x1d8b72[_0x336694(0x1c5)],'customerName':_0x1d8b72[_0x336694(0x124)],'customerCountry':_0x1d8b72[_0x336694(0x181)],'customerIp':_0x1d8b72[_0x336694(0x13b)],'customerUa':_0x1d8b72[_0x336694(0x149)],'failureMessage':_0x1d8b72[_0x336694(0x10c)],'adminNotes':_0x1d8b72[_0x336694(0xf6)],'chargebackAmount':_0x1d8b72[_0x336694(0xf8)],'statusChangedBy':_0x1d8b72[_0x336694(0x1d1)],'statusChangedAt':_0x1d8b72[_0x336694(0x1bc)],'createdAt':_0x1d8b72[_0x336694(0xcf)],'updatedAt':_0x1d8b72[_0x336694(0xcc)],'shop':_0x1d8b72[_0x336694(0x1d7)]};}async[a40_0x33a3e4(0x137)](_0x133b18,_0x57d4d3){const _0x4dff81=a40_0x33a3e4,_0x1f130d=Math[_0x4dff81(0xe9)]()[_0x4dff81(0x205)](0x24)[_0x4dff81(0x1c3)](0x2,0x9);console[_0x4dff81(0x1df)](_0x4dff81(0x1cd)+_0x1f130d+_0x4dff81(0xb8)+_0x133b18);const _0x2b0ee7={..._0x57d4d3};_0x57d4d3['password']&&_0x57d4d3['password']['trim']()!==''?(console[_0x4dff81(0x1df)]('🔐\x20['+_0x1f130d+']\x20Updating\x20password\x20for\x20user\x20'+_0x133b18),_0x2b0ee7[_0x4dff81(0xfd)]=await bcryptjs_1[_0x4dff81(0x102)][_0x4dff81(0xb7)](_0x57d4d3[_0x4dff81(0xfd)],0xc)):(console['log']('🔐\x20['+_0x1f130d+_0x4dff81(0x1dd)),delete _0x2b0ee7[_0x4dff81(0xfd)]);_0x57d4d3[_0x4dff81(0x106)]&&(_0x2b0ee7[_0x4dff81(0xf7)]=_0x57d4d3[_0x4dff81(0x106)],delete _0x2b0ee7[_0x4dff81(0x106)]);_0x57d4d3[_0x4dff81(0xf4)]&&(_0x2b0ee7[_0x4dff81(0x1de)]=_0x57d4d3[_0x4dff81(0xf4)],delete _0x2b0ee7[_0x4dff81(0xf4)]);_0x57d4d3[_0x4dff81(0x1a9)]&&(_0x2b0ee7['shopUrl']=_0x57d4d3[_0x4dff81(0x1a9)],delete _0x2b0ee7['merchantUrl']);if(_0x57d4d3[_0x4dff81(0x177)]){const _0x2251fb=_0x57d4d3[_0x4dff81(0x177)]['map'](_0x17636f=>this[_0x4dff81(0x12b)](_0x17636f));console[_0x4dff81(0x1df)](_0x4dff81(0xdc),_0x57d4d3[_0x4dff81(0x177)],'->',_0x2251fb),_0x2b0ee7[_0x4dff81(0x1d2)]=JSON[_0x4dff81(0xef)](_0x2251fb),delete _0x2b0ee7[_0x4dff81(0x177)];}_0x57d4d3[_0x4dff81(0x1c8)]&&(console[_0x4dff81(0x1df)]('🔧\x20['+_0x1f130d+_0x4dff81(0x1d0),_0x57d4d3[_0x4dff81(0x1c8)]),_0x2b0ee7['gatewaySettings']=JSON[_0x4dff81(0xef)](_0x57d4d3[_0x4dff81(0x1c8)]),console['log'](_0x4dff81(0x10b)+_0x1f130d+_0x4dff81(0x156),_0x2b0ee7[_0x4dff81(0x1c8)]));_0x57d4d3[_0x4dff81(0x121)]&&(_0x57d4d3[_0x4dff81(0x121)][_0x4dff81(0x1f0)]!==undefined&&(_0x2b0ee7[_0x4dff81(0x1f0)]=_0x57d4d3[_0x4dff81(0x121)][_0x4dff81(0x1f0)]||null),_0x57d4d3[_0x4dff81(0x121)][_0x4dff81(0xcd)]!==undefined&&(_0x2b0ee7[_0x4dff81(0xcd)]=_0x57d4d3[_0x4dff81(0x121)][_0x4dff81(0xcd)]||null),_0x57d4d3[_0x4dff81(0x121)][_0x4dff81(0x132)]!==undefined&&(_0x2b0ee7[_0x4dff81(0x132)]=_0x57d4d3[_0x4dff81(0x121)][_0x4dff81(0x132)]||null),_0x57d4d3[_0x4dff81(0x121)][_0x4dff81(0x1a6)]!==undefined&&(_0x2b0ee7[_0x4dff81(0x1a6)]=_0x57d4d3['wallets'][_0x4dff81(0x1a6)]||null),delete _0x2b0ee7[_0x4dff81(0x121)]);const _0x14bd90=await database_1[_0x4dff81(0x102)][_0x4dff81(0x1d7)][_0x4dff81(0x1ed)]({'where':{'id':_0x133b18},'data':_0x2b0ee7,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0x4dff81(0x1df)](_0x4dff81(0x1a2)+_0x1f130d+_0x4dff81(0x167),_0x14bd90[_0x4dff81(0x1c8)]),{'id':_0x14bd90['id'],'fullName':_0x14bd90['name'],'username':_0x14bd90[_0x4dff81(0x17c)],'telegramId':_0x14bd90[_0x4dff81(0x1de)],'merchantUrl':_0x14bd90[_0x4dff81(0x109)],'gateways':_0x14bd90[_0x4dff81(0x1d2)]?JSON[_0x4dff81(0x11f)](_0x14bd90[_0x4dff81(0x1d2)]):null,'gatewaySettings':_0x14bd90[_0x4dff81(0x1c8)]?JSON[_0x4dff81(0x11f)](_0x14bd90[_0x4dff81(0x1c8)]):null,'publicKey':_0x14bd90[_0x4dff81(0x1b8)],'wallets':{'usdtPolygonWallet':_0x14bd90['usdtPolygonWallet'],'usdtTrcWallet':_0x14bd90[_0x4dff81(0xcd)],'usdtErcWallet':_0x14bd90['usdtErcWallet'],'usdcPolygonWallet':_0x14bd90[_0x4dff81(0x1a6)]},'status':_0x14bd90[_0x4dff81(0x139)],'createdAt':_0x14bd90[_0x4dff81(0xcf)]};}async[a40_0x33a3e4(0xe1)](_0x2768ea){const _0x50b6bd=a40_0x33a3e4,_0x2e2cfe=await database_1['default'][_0x50b6bd(0x1d7)]['update']({'where':{'id':_0x2768ea},'data':{'status':'SUSPENDED'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2e2cfe['id'],'fullName':_0x2e2cfe[_0x50b6bd(0xf7)],'username':_0x2e2cfe['username'],'telegramId':_0x2e2cfe[_0x50b6bd(0x1de)],'merchantUrl':_0x2e2cfe['shopUrl'],'gateways':_0x2e2cfe[_0x50b6bd(0x1d2)]?JSON[_0x50b6bd(0x11f)](_0x2e2cfe['paymentGateways']):null,'gatewaySettings':_0x2e2cfe['gatewaySettings']?JSON[_0x50b6bd(0x11f)](_0x2e2cfe[_0x50b6bd(0x1c8)]):null,'publicKey':_0x2e2cfe['publicKey'],'wallets':{'usdtPolygonWallet':_0x2e2cfe[_0x50b6bd(0x1f0)],'usdtTrcWallet':_0x2e2cfe[_0x50b6bd(0xcd)],'usdtErcWallet':_0x2e2cfe[_0x50b6bd(0x132)],'usdcPolygonWallet':_0x2e2cfe[_0x50b6bd(0x1a6)]},'status':_0x2e2cfe['status'],'createdAt':_0x2e2cfe[_0x50b6bd(0xcf)]};}async['activateUser'](_0xe2b8b7){const _0x60d280=a40_0x33a3e4,_0x2990d6=await database_1['default']['shop'][_0x60d280(0x1ed)]({'where':{'id':_0xe2b8b7},'data':{'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2990d6['id'],'fullName':_0x2990d6[_0x60d280(0xf7)],'username':_0x2990d6[_0x60d280(0x17c)],'telegramId':_0x2990d6[_0x60d280(0x1de)],'merchantUrl':_0x2990d6[_0x60d280(0x109)],'gateways':_0x2990d6[_0x60d280(0x1d2)]?JSON['parse'](_0x2990d6['paymentGateways']):null,'gatewaySettings':_0x2990d6[_0x60d280(0x1c8)]?JSON[_0x60d280(0x11f)](_0x2990d6[_0x60d280(0x1c8)]):null,'publicKey':_0x2990d6[_0x60d280(0x1b8)],'wallets':{'usdtPolygonWallet':_0x2990d6[_0x60d280(0x1f0)],'usdtTrcWallet':_0x2990d6[_0x60d280(0xcd)],'usdtErcWallet':_0x2990d6[_0x60d280(0x132)],'usdcPolygonWallet':_0x2990d6[_0x60d280(0x1a6)]},'status':_0x2990d6[_0x60d280(0x139)],'createdAt':_0x2990d6[_0x60d280(0xcf)]};}async[a40_0x33a3e4(0x1be)](_0x4a413c){const _0x38e0fe=a40_0x33a3e4,{page:_0x14f68d,limit:_0x3d3362,status:_0x4247e2}=_0x4a413c,_0xc863f1=(_0x14f68d-0x1)*_0x3d3362,_0x4e9903={};_0x4247e2&&(_0x4e9903[_0x38e0fe(0x139)]=_0x4247e2[_0x38e0fe(0x171)]());const [_0x125883,_0x3db50f]=await Promise[_0x38e0fe(0x1ff)]([database_1[_0x38e0fe(0x102)][_0x38e0fe(0x1d7)][_0x38e0fe(0x1d9)]({'where':_0x4e9903,'skip':_0xc863f1,'take':_0x3d3362,'orderBy':{'createdAt':_0x38e0fe(0x174)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1['default'][_0x38e0fe(0x1d7)]['count']({'where':_0x4e9903})]);return{'users':_0x125883[_0x38e0fe(0x214)](_0x1e5bcc=>{const _0x1f9387=_0x38e0fe,_0xfedab=_0x1e5bcc[_0x1f9387(0x1d2)]?JSON[_0x1f9387(0x11f)](_0x1e5bcc['paymentGateways']):null,_0x2c0a92=_0xfedab?_0xfedab[_0x1f9387(0x214)](_0x1b6262=>this['getGatewayDisplayName'](_0x1b6262)):null;return{'id':_0x1e5bcc['id'],'fullName':_0x1e5bcc[_0x1f9387(0xf7)],'username':_0x1e5bcc['username'],'telegramId':_0x1e5bcc[_0x1f9387(0x1de)],'merchantUrl':_0x1e5bcc[_0x1f9387(0x109)],'gateways':_0x2c0a92,'gatewaySettings':_0x1e5bcc[_0x1f9387(0x1c8)]?JSON[_0x1f9387(0x11f)](_0x1e5bcc[_0x1f9387(0x1c8)]):null,'publicKey':_0x1e5bcc[_0x1f9387(0x1b8)],'wallets':{'usdtPolygonWallet':_0x1e5bcc['usdtPolygonWallet'],'usdtTrcWallet':_0x1e5bcc['usdtTrcWallet'],'usdtErcWallet':_0x1e5bcc[_0x1f9387(0x132)],'usdcPolygonWallet':_0x1e5bcc[_0x1f9387(0x1a6)]},'status':_0x1e5bcc[_0x1f9387(0x139)],'createdAt':_0x1e5bcc[_0x1f9387(0xcf)]};}),'pagination':{'page':_0x14f68d,'limit':_0x3d3362,'total':_0x3db50f,'totalPages':Math[_0x38e0fe(0xb9)](_0x3db50f/_0x3d3362)}};}async[a40_0x33a3e4(0x1fb)](_0x414023){const _0x5c700c=a40_0x33a3e4,_0x1feb71=await database_1[_0x5c700c(0x102)][_0x5c700c(0x1d7)]['findUnique']({'where':{'id':_0x414023},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x1feb71)return null;const _0x637edc=_0x1feb71[_0x5c700c(0x1d2)]?JSON[_0x5c700c(0x11f)](_0x1feb71[_0x5c700c(0x1d2)]):null,_0x3b85c2=_0x637edc?_0x637edc[_0x5c700c(0x214)](_0x4dbd5f=>this[_0x5c700c(0x110)](_0x4dbd5f)):null;return _0x637edc&&_0x3b85c2&&console[_0x5c700c(0x1df)](_0x5c700c(0x10d),_0x637edc,'->',_0x3b85c2),{'id':_0x1feb71['id'],'fullName':_0x1feb71[_0x5c700c(0xf7)],'username':_0x1feb71[_0x5c700c(0x17c)],'telegramId':_0x1feb71[_0x5c700c(0x1de)],'merchantUrl':_0x1feb71[_0x5c700c(0x109)],'gateways':_0x3b85c2,'gatewaySettings':_0x1feb71[_0x5c700c(0x1c8)]?JSON[_0x5c700c(0x11f)](_0x1feb71[_0x5c700c(0x1c8)]):null,'publicKey':_0x1feb71[_0x5c700c(0x1b8)],'wallets':{'usdtPolygonWallet':_0x1feb71[_0x5c700c(0x1f0)],'usdtTrcWallet':_0x1feb71[_0x5c700c(0xcd)],'usdtErcWallet':_0x1feb71['usdtErcWallet'],'usdcPolygonWallet':_0x1feb71[_0x5c700c(0x1a6)]},'status':_0x1feb71[_0x5c700c(0x139)],'createdAt':_0x1feb71[_0x5c700c(0xcf)]};}async[a40_0x33a3e4(0x141)](_0x216e83){const _0x536dcf=a40_0x33a3e4,{fullName:_0x34d1fc,username:_0x5b910b,password:_0x36d6f4,telegramId:_0x4844e4,merchantUrl:_0x6730d6,gateways:_0xb39667,gatewaySettings:_0x1be4eb,wallets:_0x5487e0}=_0x216e83,_0x5baabd=await database_1[_0x536dcf(0x102)][_0x536dcf(0x1d7)][_0x536dcf(0x155)]({'where':{'username':_0x5b910b}});if(_0x5baabd)throw new Error(_0x536dcf(0xf1));if(_0x4844e4){const _0xb30e4d=await database_1[_0x536dcf(0x102)]['shop'][_0x536dcf(0x155)]({'where':{'telegram':_0x4844e4}});if(_0xb30e4d)throw new Error('Telegram\x20username\x20already\x20exists');}const _0x3efb23=await bcryptjs_1['default'][_0x536dcf(0xb7)](_0x36d6f4,0xc),_0x2e1b65='pk_'+crypto_1['default'][_0x536dcf(0x19f)](0x20)[_0x536dcf(0x205)](_0x536dcf(0xbb)),_0x1f5566=_0x536dcf(0x1e6)+crypto_1[_0x536dcf(0x102)]['randomBytes'](0x20)[_0x536dcf(0x205)]('hex'),_0x19e2db=_0xb39667?_0xb39667[_0x536dcf(0x214)](_0x4e78f9=>this['getGatewayInternalName'](_0x4e78f9)):null;_0xb39667&&_0x19e2db&&console[_0x536dcf(0x1df)]('🔄\x20Gateway\x20mapping\x20(create):',_0xb39667,'->',_0x19e2db);const _0x2002e4=await database_1['default'][_0x536dcf(0x1d7)][_0x536dcf(0x1a8)]({'data':{'name':_0x34d1fc,'username':_0x5b910b,'password':_0x3efb23,'telegram':_0x4844e4,'shopUrl':_0x6730d6,'paymentGateways':_0x19e2db?JSON[_0x536dcf(0xef)](_0x19e2db):null,'gatewaySettings':_0x1be4eb?JSON[_0x536dcf(0xef)](_0x1be4eb):null,'usdtPolygonWallet':_0x5487e0?.['usdtPolygonWallet']||null,'usdtTrcWallet':_0x5487e0?.['usdtTrcWallet']||null,'usdtErcWallet':_0x5487e0?.[_0x536dcf(0x132)]||null,'usdcPolygonWallet':_0x5487e0?.[_0x536dcf(0x1a6)]||null,'publicKey':_0x2e1b65,'secretKey':_0x1f5566,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2002e4['id'],'fullName':_0x2002e4[_0x536dcf(0xf7)],'username':_0x2002e4[_0x536dcf(0x17c)],'telegramId':_0x2002e4[_0x536dcf(0x1de)],'merchantUrl':_0x2002e4['shopUrl'],'gateways':_0x2002e4['paymentGateways']?JSON[_0x536dcf(0x11f)](_0x2002e4['paymentGateways']):null,'gatewaySettings':_0x2002e4[_0x536dcf(0x1c8)]?JSON['parse'](_0x2002e4[_0x536dcf(0x1c8)]):null,'publicKey':_0x2002e4[_0x536dcf(0x1b8)],'wallets':{'usdtPolygonWallet':_0x2002e4[_0x536dcf(0x1f0)],'usdtTrcWallet':_0x2002e4[_0x536dcf(0xcd)],'usdtErcWallet':_0x2002e4[_0x536dcf(0x132)],'usdcPolygonWallet':_0x2002e4[_0x536dcf(0x1a6)]},'status':_0x2002e4['status'],'createdAt':_0x2002e4[_0x536dcf(0xcf)]};}async['deleteUser'](_0x425af3){const _0x4b4f11=a40_0x33a3e4;await database_1[_0x4b4f11(0x102)][_0x4b4f11(0x1d7)][_0x4b4f11(0xd4)]({'where':{'id':_0x425af3}});}[a40_0x33a3e4(0x1cb)](_0x28160f,_0x47ba73,_0x4f6e3b){const _0x5c4cc0=a40_0x33a3e4,_0x13b94d=new Map(),_0x12893f=new Date(_0x47ba73);while(_0x12893f<=_0x4f6e3b){const _0x54ddaf=_0x12893f[_0x5c4cc0(0xcb)]()['split']('T')[0x0];_0x13b94d[_0x5c4cc0(0x11c)](_0x54ddaf,{'revenue':0x0,'count':0x0}),_0x12893f[_0x5c4cc0(0x148)](_0x12893f[_0x5c4cc0(0x1ca)]()+0x1);}for(const _0x126ef9 of _0x28160f){const _0x1b7825=_0x126ef9[_0x5c4cc0(0xcf)][_0x5c4cc0(0xcb)]()[_0x5c4cc0(0x1b3)]('T')[0x0],_0x528637=_0x13b94d['get'](_0x1b7825);_0x528637&&(_0x528637[_0x5c4cc0(0x1f9)]+=0x1,_0x126ef9['status']===_0x5c4cc0(0x210)&&(_0x126ef9[_0x5c4cc0(0x1ad)]?_0x528637[_0x5c4cc0(0x176)]+=_0x126ef9[_0x5c4cc0(0x1ad)]:console[_0x5c4cc0(0x1df)](_0x5c4cc0(0x20b)+_0x126ef9['id']+_0x5c4cc0(0x203))));}const _0x163bc5=[],_0x3793cb=[];for(const [_0x19d7cd,_0x2e45a8]of _0x13b94d){_0x163bc5[_0x5c4cc0(0x1f2)]({'date':_0x19d7cd,'amount':Math[_0x5c4cc0(0x1e0)](_0x2e45a8[_0x5c4cc0(0x176)]*0x64)/0x64}),_0x3793cb[_0x5c4cc0(0x1f2)]({'date':_0x19d7cd,'count':_0x2e45a8[_0x5c4cc0(0x1f9)]});}return{'dailyRevenue':_0x163bc5,'dailyPayments':_0x3793cb};}}exports[a40_0x33a3e4(0xbd)]=AdminService;