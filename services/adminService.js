'use strict';const a35_0x5080cb=a35_0x3cc0;(function(_0x1e45dc,_0x3a1bb7){const _0x5f370c=a35_0x3cc0,_0x47d037=_0x1e45dc();while(!![]){try{const _0x37a23f=-parseInt(_0x5f370c(0x18a))/0x1+parseInt(_0x5f370c(0x15a))/0x2*(parseInt(_0x5f370c(0x180))/0x3)+parseInt(_0x5f370c(0x143))/0x4+parseInt(_0x5f370c(0xe8))/0x5*(parseInt(_0x5f370c(0xd1))/0x6)+-parseInt(_0x5f370c(0xe9))/0x7+parseInt(_0x5f370c(0xe2))/0x8*(-parseInt(_0x5f370c(0xdd))/0x9)+-parseInt(_0x5f370c(0xc3))/0xa*(-parseInt(_0x5f370c(0xb0))/0xb);if(_0x37a23f===_0x3a1bb7)break;else _0x47d037['push'](_0x47d037['shift']());}catch(_0x3110bd){_0x47d037['push'](_0x47d037['shift']());}}}(a35_0x5da4,0xc2175));function a35_0x5da4(){const _0x56c909=['CHARGEBACK','not\x20set','getSystemStatistics','getAllPayments','update','paymentGateways','üìÖ\x20Period:\x20','üí∞\x20Shop\x20','144YVsnMT','findMany','Error\x20processing\x20payment\x20','forEach','\x20balance\x20updated:\x20','availableBalance','round','reduce','updateUser','getTime','860720mYmGXY','statusChangedBy','name','\x20USDT\x20(','toFixed','insensitive','create','üîÑ\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','shopUrl','shop','adminNotes','totalTurnover','shopId','turnover','üí∞\x20Payment\x20','11dVrSQX','createdAt','\x20\x20\x20üìÖ\x20This\x20month:\x20','payout','notes','totalPaidOut','\x20became\x20PAID:\x20+','\x20merchants,\x20','usdtPolygonWallet','telegram','toString','merchantEarnings','./currencyService','paymentsCount','findUnique','all','pendingUrl','fullName','updatedAt','4934550IQLFim','year','date','network','\x20USDT\x20total','$transaction','activateUser','not\x20specified','txid','\x20\x20\x20Balance:\x20','getAllUsers','üìä\x20Total\x20payments\x20(including\x20failed):\x20','\x20->\x20','defineProperty','78hukDqL','Shop\x20not\x20found','toISOString','ceil','failureMessage','sort','period','‚úÖ\x20Customer\x20data\x20updated\x20for\x20payment\x20','\x20\x20\x20üí∞\x20Total\x20payout:\x20','hex','desc','updateCustomerData','7712514FeYCjF','polygon','getMonth','amountUSDT','default','8awBfBJ','‚úÖ\x20Payout\x20created:\x20','merchantEarningsUSDT','KLYME\x20GB','username','periodTo','560305TCjsEO','9227015MLZEdt','CoinToPay','üîÑ\x20Admin\x20updating\x20payment\x20','averageCheckUSDT','paidAt','log','üìä\x20Merchants\x20awaiting\x20payout:\x20','payment','customerName','2020-01-01','üìä\x20Getting\x20merchant\x20statistics\x20with\x20filters:','\x20USDT\x20(total\x20paid\x20to\x20merchants)','localeCompare','\x20USDT\x20(+','Telegram\x20username\x20already\x20exists','\x20USDT\x20to\x20balance','\x20\x20\x20Total\x20paid\x20out:\x20','getGatewayDisplayName','\x20USDT','\x20\x20\x20üí∞\x20Total\x20turnover:\x20','../config/database','test_gateway','periodFrom','usdtTrcWallet','COMPLETED','paidOutUSDT','__importDefault','customerCountry','Insufficient\x20balance.\x20Available:\x20','\x20to\x20','AdminService','failUrl','gte','usdcPolygonWallet','usdtErcWallet','totalCommissionRate','convertToUSDT','getPayoutById','chargebackAmount','successUrl','orderId','Payment\x20not\x20found','asc','üí∞\x20Current\x20shop\x20balance:\x20','randomBytes','dateFrom','Username\x20already\x20exists','gateways','_count','createUser','üí≥\x20Payout\x20wallet\x20for\x20','merchantUrl','deletePayout','_sum','averageCommissionRate','password','\x20\x20\x20Transaction\x20hash:\x20','toLowerCase','\x20USDT\x20from\x20balance','length','dateTo','\x20\x20\x20üìä\x20Total\x20payments:\x20','hash','set','count','status','lte','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','week','getUserById','\x20balance\x20updated:','crypto','month','delete','map','values','gatewaySettings','aggregate','üìä\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','__esModule','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','gatewayOrderId','toUpperCase','\x20merchants\x20with\x20positive\x20balance','KLYME\x20DE','Plisio','\x20USDT\x20(total\x20merchant\x20balances)','amount','publicKey','currency','3761536EEoJXt','parse','üí∏\x20CHARGEBACK\x20penalty:\x20-','30d','totalPayout','\x20\x20\x20Payout\x20amount:\x20','currencyService','getMerchantStatistics','customerUa','pk_','\x20USDT\x20(same\x20as\x20awaiting)','updatePaymentStatus','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','üí∞\x20Found\x20','Rapyd','gatewayEarnings','sk_','\x20USDT)','customerIp','getPayoutStats','custom','PAID','stringify','39174IVwuTQ','error','balance','getMerchantsAwaitingPayout','ACTIVE','commissionUSDT','\x20\x20\x20üåê\x20IP:\x20','SUSPENDED','entries','bcryptjs','KLYME\x20EU','externalPaymentUrl','\x20no\x20longer\x20PAID:\x20-','statusChangedAt','customerEmail','telegramId','Noda','groupBy','wallets','üìä\x20Payout\x20statistics\x20calculated:','getFullYear','\x20status:\x20','split','gateway','createPayout','trc20','turnoverUSDT','polygon_usdc','\x20\x20\x20üíµ\x20Available\x20balance:\x20','awaitingPayout'];a35_0x5da4=function(){return _0x56c909;};return a35_0x5da4();}var __importDefault=this&&this[a35_0x5080cb(0x103)]||function(_0x190975){const _0x342a81=a35_0x5080cb;return _0x190975&&_0x190975[_0x342a81(0x138)]?_0x190975:{'default':_0x190975};};Object[a35_0x5080cb(0xd0)](exports,a35_0x5080cb(0x138),{'value':!![]}),exports['AdminService']=void 0x0;const database_1=__importDefault(require(a35_0x5080cb(0xfd))),bcryptjs_1=__importDefault(require(a35_0x5080cb(0x163))),crypto_1=__importDefault(require(a35_0x5080cb(0x130))),currencyService_1=require(a35_0x5080cb(0xbc));class AdminService{async[a35_0x5080cb(0x156)](){const _0x45438a=a35_0x5080cb;console[_0x45438a(0xee)]('üìä\x20Calculating\x20payout\x20statistics...');const _0x193cbc=await database_1['default']['shop'][_0x45438a(0x136)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':'ACTIVE'}}),_0x11c2c0=new Date(),_0x21fd35=new Date(_0x11c2c0[_0x45438a(0x16e)](),_0x11c2c0[_0x45438a(0xdf)](),0x1),_0x2c4df6=new Date(_0x11c2c0[_0x45438a(0x16e)](),_0x11c2c0[_0x45438a(0xdf)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x55dd05=await database_1[_0x45438a(0xe1)]['payout'][_0x45438a(0x136)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x21fd35,'lte':_0x2c4df6},'status':_0x45438a(0x101)}}),_0x142cdb=_0x193cbc[_0x45438a(0x11e)][_0x45438a(0xb5)]||0x0,_0x4c3dc8=_0x193cbc[_0x45438a(0x11e)][_0x45438a(0x15c)]||0x0,_0x266954=_0x55dd05[_0x45438a(0x11e)][_0x45438a(0x140)]||0x0,_0x441c42={'totalPayout':Math[_0x45438a(0x186)](_0x142cdb*0x64)/0x64,'awaitingPayout':Math[_0x45438a(0x186)](_0x4c3dc8*0x64)/0x64,'thisMonth':Math[_0x45438a(0x186)](_0x266954*0x64)/0x64,'availableBalance':Math[_0x45438a(0x186)](_0x4c3dc8*0x64)/0x64};return console[_0x45438a(0xee)](_0x45438a(0x16d)),console[_0x45438a(0xee)](_0x45438a(0xd9)+_0x441c42[_0x45438a(0x147)]+_0x45438a(0xf4)),console[_0x45438a(0xee)](_0x45438a(0x14f)+_0x441c42[_0x45438a(0x177)]+_0x45438a(0x13f)),console[_0x45438a(0xee)](_0x45438a(0x176)+_0x441c42[_0x45438a(0x185)]+_0x45438a(0x14d)),console[_0x45438a(0xee)](_0x45438a(0xb2)+_0x441c42['thisMonth']+_0x45438a(0xfb)),_0x441c42;}async[a35_0x5080cb(0xdc)](_0xb38842,_0x11befb){const _0xaed0c3=a35_0x5080cb;console[_0xaed0c3(0xee)]('üîÑ\x20Updating\x20customer\x20data\x20for\x20payment\x20'+_0xb38842+':',_0x11befb);const _0x584b54=await database_1[_0xaed0c3(0xe1)][_0xaed0c3(0xf0)][_0xaed0c3(0xbe)]({'where':{'id':_0xb38842},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x584b54)throw new Error('Payment\x20not\x20found');const _0x54baf6={};_0x11befb[_0xaed0c3(0x104)]!==undefined&&(_0x54baf6[_0xaed0c3(0x104)]=_0x11befb[_0xaed0c3(0x104)]||null);_0x11befb[_0xaed0c3(0x155)]!==undefined&&(_0x54baf6[_0xaed0c3(0x155)]=_0x11befb[_0xaed0c3(0x155)]||null);_0x11befb[_0xaed0c3(0x14b)]!==undefined&&(_0x54baf6[_0xaed0c3(0x14b)]=_0x11befb[_0xaed0c3(0x14b)]||null);const _0x195adc=await database_1[_0xaed0c3(0xe1)][_0xaed0c3(0xf0)][_0xaed0c3(0x17c)]({'where':{'id':_0xb38842},'data':{..._0x54baf6,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0xaed0c3(0xee)](_0xaed0c3(0xd8)+_0xb38842),console['log']('\x20\x20\x20üåç\x20Country:\x20'+_0x584b54[_0xaed0c3(0x104)]+'\x20->\x20'+_0x195adc[_0xaed0c3(0x104)]),console[_0xaed0c3(0xee)](_0xaed0c3(0x160)+_0x584b54[_0xaed0c3(0x155)]+_0xaed0c3(0xcf)+_0x195adc[_0xaed0c3(0x155)]),console[_0xaed0c3(0xee)]('\x20\x20\x20üñ•Ô∏è\x20User\x20Agent:\x20'+(_0x584b54[_0xaed0c3(0x14b)]?_0xaed0c3(0x128):_0xaed0c3(0x179))+_0xaed0c3(0xcf)+(_0x195adc[_0xaed0c3(0x14b)]?_0xaed0c3(0x128):_0xaed0c3(0x179))),_0x195adc;}async[a35_0x5080cb(0x17a)](_0x2af9ac){const _0x4db9ef=a35_0x5080cb,_0x368082=new Date();let _0x2919e2;switch(_0x2af9ac){case'7d':_0x2919e2=new Date(_0x368082[_0x4db9ef(0x189)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x4db9ef(0x146):_0x2919e2=new Date(_0x368082[_0x4db9ef(0x189)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'90d':_0x2919e2=new Date(_0x368082[_0x4db9ef(0x189)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x2919e2=new Date(_0x368082['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x4dea79,_0x36a5f6,_0xe565d6,_0x351048,_0x343569,_0x730d4a]=await Promise[_0x4db9ef(0xbf)]([database_1[_0x4db9ef(0xe1)]['shop']['count'](),database_1['default']['shop'][_0x4db9ef(0x129)]({'where':{'status':'ACTIVE'}}),database_1[_0x4db9ef(0xe1)][_0x4db9ef(0xf0)]['count']({'where':{'createdAt':{'gte':_0x2919e2},'gateway':{'not':_0x4db9ef(0xfe)}}}),database_1['default'][_0x4db9ef(0xf0)][_0x4db9ef(0x129)]({'where':{'status':_0x4db9ef(0x158),'createdAt':{'gte':_0x2919e2},'gateway':{'not':'test_gateway'}}}),database_1[_0x4db9ef(0xe1)][_0x4db9ef(0xf0)][_0x4db9ef(0x181)]({'where':{'status':'PAID','createdAt':{'gte':_0x2919e2},'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![]}}),database_1[_0x4db9ef(0xe1)][_0x4db9ef(0xf0)][_0x4db9ef(0x181)]({'where':{'gateway':{'not':_0x4db9ef(0xfe)}},'take':0xa,'orderBy':{'createdAt':_0x4db9ef(0xdb)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}})]);let _0x47fd77=0x0;for(const _0x5eb12e of _0x343569){const _0x46909e=await currencyService_1[_0x4db9ef(0x149)][_0x4db9ef(0x10d)](_0x5eb12e[_0x4db9ef(0x140)],_0x5eb12e['currency']);_0x47fd77+=_0x46909e;}const _0x5e53db=_0xe565d6>0x0?_0x351048/_0xe565d6*0x64:0x0;return{'totalShops':_0x4dea79,'activeShops':_0x36a5f6,'totalPayments':_0xe565d6,'successfulPayments':_0x351048,'totalRevenue':Math['round'](_0x47fd77*0x64)/0x64,'conversionRate':Math[_0x4db9ef(0x186)](_0x5e53db*0x64)/0x64,'recentPayments':_0x730d4a[_0x4db9ef(0x133)](_0x37d7f5=>({'id':_0x37d7f5['id'],'amount':_0x37d7f5[_0x4db9ef(0x140)],'currency':_0x37d7f5[_0x4db9ef(0x142)],'status':_0x37d7f5[_0x4db9ef(0x12a)],'gateway':_0x37d7f5['gateway'],'shop':_0x37d7f5[_0x4db9ef(0xaa)],'createdAt':_0x37d7f5[_0x4db9ef(0xb1)]}))};}async[a35_0x5080cb(0x14a)](_0x4b75df){const _0x5c0b29=a35_0x5080cb;console[_0x5c0b29(0xee)](_0x5c0b29(0xf3),_0x4b75df);let _0x5a8086,_0x2f1e7e=new Date();if(_0x4b75df[_0x5c0b29(0xd7)]===_0x5c0b29(0x157)&&_0x4b75df[_0x5c0b29(0x116)]&&_0x4b75df[_0x5c0b29(0x125)])_0x5a8086=new Date(_0x4b75df[_0x5c0b29(0x116)]),_0x2f1e7e=new Date(_0x4b75df[_0x5c0b29(0x125)]);else{const _0x3839f8=new Date();switch(_0x4b75df[_0x5c0b29(0xd7)]){case _0x5c0b29(0x12d):_0x5a8086=new Date(_0x3839f8[_0x5c0b29(0x189)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x5c0b29(0x131):_0x5a8086=new Date(_0x3839f8[_0x5c0b29(0x189)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x5c0b29(0xc4):_0x5a8086=new Date(_0x3839f8[_0x5c0b29(0x189)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case'all':default:_0x5a8086=new Date(_0x5c0b29(0xf2));break;}}console[_0x5c0b29(0xee)](_0x5c0b29(0x17e)+_0x5a8086['toISOString']()+_0x5c0b29(0x106)+_0x2f1e7e['toISOString']());const _0x566c4f={'status':_0x5c0b29(0x158),'gateway':{'not':_0x5c0b29(0xfe)},'paidAt':{'gte':_0x5a8086,'lte':_0x2f1e7e}};_0x4b75df[_0x5c0b29(0xad)]&&(_0x566c4f[_0x5c0b29(0xad)]=_0x4b75df[_0x5c0b29(0xad)]);const _0x38bac2=await database_1[_0x5c0b29(0xe1)][_0x5c0b29(0xf0)][_0x5c0b29(0x181)]({'where':_0x566c4f,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x5c0b29(0xee)](_0x5c0b29(0x150)+_0x38bac2[_0x5c0b29(0x124)]+'\x20paid\x20payments\x20for\x20analysis');const _0x47903a={'gateway':{'not':_0x5c0b29(0xfe)},'createdAt':{'gte':_0x5a8086,'lte':_0x2f1e7e}};_0x4b75df[_0x5c0b29(0xad)]&&(_0x47903a['shopId']=_0x4b75df['shopId']);const _0x33b36e=await database_1['default'][_0x5c0b29(0xf0)]['count']({'where':_0x47903a});console[_0x5c0b29(0xee)](_0x5c0b29(0xce)+_0x33b36e+',\x20successful:\x20'+_0x38bac2[_0x5c0b29(0x124)]);let _0x2a9249=0x0,_0x57dd7b=0x0,_0x497af8=0x0;const _0x592c19={},_0x498c36={},_0x4b87a8={};for(const _0x5d2c4d of _0x38bac2){try{const _0xdb5eeb=await currencyService_1[_0x5c0b29(0x149)][_0x5c0b29(0x10d)](_0x5d2c4d['amount'],_0x5d2c4d[_0x5c0b29(0x142)]);let _0x1d60e2={};if(_0x5d2c4d[_0x5c0b29(0xaa)][_0x5c0b29(0x135)])try{_0x1d60e2=JSON['parse'](_0x5d2c4d[_0x5c0b29(0xaa)][_0x5c0b29(0x135)]);}catch(_0xf4f09d){console[_0x5c0b29(0x15b)](_0x5c0b29(0x12c)+_0x5d2c4d[_0x5c0b29(0xad)]+':',_0xf4f09d);}let _0x412dc0={},_0x371e65=0xa;for(const [_0x5a2438,_0x5cdc54]of Object[_0x5c0b29(0x162)](_0x1d60e2)){if(_0x5a2438['toLowerCase']()===_0x5d2c4d['gateway']['toLowerCase']()){_0x412dc0=_0x5cdc54,_0x371e65=_0x5cdc54['commission']||0xa;break;}}const _0x23a8ed=_0xdb5eeb*(_0x371e65/0x64),_0x32ade1=_0xdb5eeb-_0x23a8ed;_0x2a9249+=_0xdb5eeb,_0x57dd7b+=_0x32ade1,_0x497af8+=_0x23a8ed;!_0x592c19[_0x5d2c4d['gateway']]&&(_0x592c19[_0x5d2c4d[_0x5c0b29(0x171)]]={'gateway':_0x5d2c4d['gateway'],'gatewayDisplayName':this[_0x5c0b29(0xfa)](_0x5d2c4d[_0x5c0b29(0x171)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x592c19[_0x5d2c4d[_0x5c0b29(0x171)]][_0x5c0b29(0xbd)]++,_0x592c19[_0x5d2c4d[_0x5c0b29(0x171)]][_0x5c0b29(0x174)]+=_0xdb5eeb,_0x592c19[_0x5d2c4d['gateway']][_0x5c0b29(0x15f)]+=_0x23a8ed,_0x592c19[_0x5d2c4d[_0x5c0b29(0x171)]][_0x5c0b29(0xe4)]+=_0x32ade1,_0x592c19[_0x5d2c4d[_0x5c0b29(0x171)]][_0x5c0b29(0x10c)]+=_0x371e65;!_0x4b75df[_0x5c0b29(0xad)]&&(!_0x498c36[_0x5d2c4d[_0x5c0b29(0xad)]]&&(_0x498c36[_0x5d2c4d['shopId']]={'shopId':_0x5d2c4d[_0x5c0b29(0xad)],'shopName':_0x5d2c4d[_0x5c0b29(0xaa)]['name'],'shopUsername':_0x5d2c4d[_0x5c0b29(0xaa)][_0x5c0b29(0xe6)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x498c36[_0x5d2c4d['shopId']][_0x5c0b29(0xbd)]++,_0x498c36[_0x5d2c4d[_0x5c0b29(0xad)]][_0x5c0b29(0x174)]+=_0xdb5eeb,_0x498c36[_0x5d2c4d[_0x5c0b29(0xad)]][_0x5c0b29(0x15f)]+=_0x23a8ed,_0x498c36[_0x5d2c4d[_0x5c0b29(0xad)]]['merchantEarningsUSDT']+=_0x32ade1);const _0x5b0180=_0x5d2c4d[_0x5c0b29(0xed)][_0x5c0b29(0xd3)]()[_0x5c0b29(0x170)]('T')[0x0];!_0x4b87a8[_0x5b0180]&&(_0x4b87a8[_0x5b0180]={'date':_0x5b0180,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x4b87a8[_0x5b0180][_0x5c0b29(0xae)]+=_0xdb5eeb,_0x4b87a8[_0x5b0180][_0x5c0b29(0xbb)]+=_0x32ade1,_0x4b87a8[_0x5b0180]['gatewayEarnings']+=_0x23a8ed,_0x4b87a8[_0x5b0180][_0x5c0b29(0xbd)]++;}catch(_0x3c1a85){console['error'](_0x5c0b29(0x182)+_0x5d2c4d['id']+':',_0x3c1a85);}}Object[_0x5c0b29(0x134)](_0x592c19)[_0x5c0b29(0x183)](_0x549886=>{const _0xb26062=_0x5c0b29;_0x549886[_0xb26062(0x11f)]=_0x549886[_0xb26062(0xbd)]>0x0?_0x549886[_0xb26062(0x10c)]/_0x549886[_0xb26062(0xbd)]:0x0,delete _0x549886['totalCommissionRate'];}),Object[_0x5c0b29(0x134)](_0x498c36)[_0x5c0b29(0x183)](_0xb21c2e=>{const _0x282aac=_0x5c0b29;_0xb21c2e[_0x282aac(0xec)]=_0xb21c2e[_0x282aac(0xbd)]>0x0?_0xb21c2e[_0x282aac(0x174)]/_0xb21c2e[_0x282aac(0xbd)]:0x0;});let _0x3f17e6=0x0;if(_0x4b75df[_0x5c0b29(0xad)]){const _0x28fc64=await database_1[_0x5c0b29(0xe1)][_0x5c0b29(0xb3)]['findMany']({'where':{'shopId':_0x4b75df[_0x5c0b29(0xad)],'status':_0x5c0b29(0x101),'createdAt':{'gte':_0x5a8086,'lte':_0x2f1e7e}},'select':{'amount':!![]}});_0x3f17e6=_0x28fc64[_0x5c0b29(0x187)]((_0x521c0f,_0x3fcc4b)=>_0x521c0f+_0x3fcc4b[_0x5c0b29(0x140)],0x0);}const _0x25fb90=_0x33b36e,_0x25929a=_0x38bac2[_0x5c0b29(0x124)],_0xe81700=_0x25929a>0x0?_0x2a9249/_0x25929a:0x0,_0x3ee593=_0x25fb90>0x0?Math[_0x5c0b29(0x186)](_0x25929a/_0x25fb90*0x2710)/0x64:0x0,_0x8080a5=Math[_0x5c0b29(0xd4)]((_0x2f1e7e[_0x5c0b29(0x189)]()-_0x5a8086[_0x5c0b29(0x189)]())/(0x3e8*0x3c*0x3c*0x18)),_0x45dbb1={'totalTurnover':Math['round'](_0x2a9249*0x64)/0x64,'merchantEarnings':Math['round'](_0x57dd7b*0x64)/0x64,'gatewayEarnings':Math[_0x5c0b29(0x186)](_0x497af8*0x64)/0x64,'totalPaidOut':Math['round'](_0x3f17e6*0x64)/0x64,'averageCheck':Math[_0x5c0b29(0x186)](_0xe81700*0x64)/0x64,'totalPayments':_0x25fb90,'successfulPayments':_0x25929a,'conversionRate':_0x3ee593,'gatewayBreakdown':Object[_0x5c0b29(0x134)](_0x592c19)[_0x5c0b29(0x133)](_0x429dd4=>({..._0x429dd4,'turnoverUSDT':Math['round'](_0x429dd4[_0x5c0b29(0x174)]*0x64)/0x64,'commissionUSDT':Math[_0x5c0b29(0x186)](_0x429dd4['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x429dd4[_0x5c0b29(0xe4)]*0x64)/0x64,'averageCommissionRate':Math[_0x5c0b29(0x186)](_0x429dd4[_0x5c0b29(0x11f)]*0x64)/0x64})),'merchantBreakdown':_0x4b75df[_0x5c0b29(0xad)]?undefined:Object[_0x5c0b29(0x134)](_0x498c36)['map'](_0x430ae9=>({..._0x430ae9,'turnoverUSDT':Math[_0x5c0b29(0x186)](_0x430ae9['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x5c0b29(0x186)](_0x430ae9['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x5c0b29(0x186)](_0x430ae9[_0x5c0b29(0xe4)]*0x64)/0x64,'paidOutUSDT':Math[_0x5c0b29(0x186)](_0x430ae9[_0x5c0b29(0x102)]*0x64)/0x64,'averageCheckUSDT':Math[_0x5c0b29(0x186)](_0x430ae9['averageCheckUSDT']*0x64)/0x64})),'dailyData':Object[_0x5c0b29(0x134)](_0x4b87a8)[_0x5c0b29(0x133)](_0x40874c=>({..._0x40874c,'turnover':Math[_0x5c0b29(0x186)](_0x40874c[_0x5c0b29(0xae)]*0x64)/0x64,'merchantEarnings':Math[_0x5c0b29(0x186)](_0x40874c[_0x5c0b29(0xbb)]*0x64)/0x64,'gatewayEarnings':Math[_0x5c0b29(0x186)](_0x40874c[_0x5c0b29(0x152)]*0x64)/0x64}))[_0x5c0b29(0xd6)]((_0x470940,_0x450435)=>_0x470940['date'][_0x5c0b29(0xf5)](_0x450435[_0x5c0b29(0xc5)])),'periodInfo':{'from':_0x5a8086,'to':_0x2f1e7e,'periodType':_0x4b75df[_0x5c0b29(0xd7)]||_0x5c0b29(0x157),'daysCount':_0x8080a5}};return console[_0x5c0b29(0xee)]('üìä\x20Merchant\x20statistics\x20calculated:'),console[_0x5c0b29(0xee)](_0x5c0b29(0xfc)+_0x45dbb1[_0x5c0b29(0xac)]+_0x5c0b29(0xfb)),console[_0x5c0b29(0xee)]('\x20\x20\x20üë§\x20Merchant\x20earnings:\x20'+_0x45dbb1[_0x5c0b29(0xbb)]+'\x20USDT'),console[_0x5c0b29(0xee)]('\x20\x20\x20üè™\x20Gateway\x20earnings:\x20'+_0x45dbb1[_0x5c0b29(0x152)]+_0x5c0b29(0xfb)),console['log'](_0x5c0b29(0x126)+_0x45dbb1['totalPayments']),_0x45dbb1;}['getGatewayDisplayName'](_0x56a17e){const _0x1554e4=a35_0x5080cb,_0x389982={'test_gateway':'Test\x20Gateway','plisio':_0x1554e4(0x13e),'rapyd':_0x1554e4(0x151),'noda':_0x1554e4(0x16a),'cointopay':_0x1554e4(0xea),'klyme_eu':_0x1554e4(0x164),'klyme_gb':_0x1554e4(0xe5),'klyme_de':_0x1554e4(0x13d)};return _0x389982[_0x56a17e]||_0x56a17e;}async[a35_0x5080cb(0x15d)](_0x54d7c6){const _0x4075e4=a35_0x5080cb,{page:_0x1b2b8e,limit:_0x401372,minAmount:_0xc16fa1,search:_0x414c64}=_0x54d7c6,_0xa1c8b0=(_0x1b2b8e-0x1)*_0x401372;console[_0x4075e4(0xee)](_0x4075e4(0x137),_0x54d7c6);const _0x3cfaa1={'balance':{'gt':0x0},'status':_0x4075e4(0x15e)};_0xc16fa1&&(_0x3cfaa1[_0x4075e4(0x15c)][_0x4075e4(0x109)]=_0xc16fa1);_0x414c64&&(_0x3cfaa1['OR']=[{'name':{'contains':_0x414c64,'mode':_0x4075e4(0x18f)}},{'username':{'contains':_0x414c64,'mode':'insensitive'}}]);const [_0xd2fe2f,_0x5c40a7]=await Promise[_0x4075e4(0xbf)]([database_1[_0x4075e4(0xe1)]['shop'][_0x4075e4(0x181)]({'where':_0x3cfaa1,'skip':_0xa1c8b0,'take':_0x401372,'orderBy':{'balance':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'createdAt':!![]}}),database_1[_0x4075e4(0xe1)][_0x4075e4(0xaa)][_0x4075e4(0x129)]({'where':_0x3cfaa1})]);console['log'](_0x4075e4(0x150)+_0xd2fe2f[_0x4075e4(0x124)]+_0x4075e4(0x13c));const _0x503d68=await Promise[_0x4075e4(0xbf)](_0xd2fe2f[_0x4075e4(0x133)](async _0x4040c7=>{const _0x12ad3e=_0x4075e4,[_0x509a21,_0x3a698a,_0x3f6d1a]=await Promise['all']([database_1[_0x12ad3e(0xe1)]['payment'][_0x12ad3e(0x129)]({'where':{'shopId':_0x4040c7['id'],'status':_0x12ad3e(0x158),'amountUSDT':{'not':null}}}),database_1[_0x12ad3e(0xe1)][_0x12ad3e(0xf0)]['findFirst']({'where':{'shopId':_0x4040c7['id'],'status':_0x12ad3e(0x158),'amountUSDT':{'not':null}},'orderBy':{'paidAt':_0x12ad3e(0x113)},'select':{'paidAt':!![]}}),database_1[_0x12ad3e(0xe1)][_0x12ad3e(0xf0)][_0x12ad3e(0x16b)]({'by':['gateway'],'where':{'shopId':_0x4040c7['id'],'status':_0x12ad3e(0x158),'amountUSDT':{'not':null}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x42ef7f=_0x3f6d1a[_0x12ad3e(0x133)](_0x336c00=>({'gateway':_0x336c00['gateway'],'count':_0x336c00[_0x12ad3e(0x119)]['id'],'amountUSDT':_0x336c00[_0x12ad3e(0x11e)]['amountUSDT']||0x0,'amountAfterCommissionUSDT':_0x336c00[_0x12ad3e(0x11e)][_0x12ad3e(0xe0)]||0x0,'commission':0x0}));return{'id':_0x4040c7['id'],'fullName':_0x4040c7[_0x12ad3e(0x18c)],'username':_0x4040c7[_0x12ad3e(0xe6)],'telegramId':_0x4040c7[_0x12ad3e(0xb9)],'merchantUrl':_0x4040c7['shopUrl'],'wallets':{'usdtPolygonWallet':_0x4040c7[_0x12ad3e(0xb8)],'usdtTrcWallet':_0x4040c7['usdtTrcWallet'],'usdtErcWallet':_0x4040c7[_0x12ad3e(0x10b)],'usdcPolygonWallet':_0x4040c7[_0x12ad3e(0x10a)]},'totalAmountUSDT':_0x4040c7['balance'],'totalAmountAfterCommissionUSDT':_0x4040c7[_0x12ad3e(0x15c)],'paymentsCount':_0x509a21,'oldestPaymentDate':_0x3a698a?.['paidAt']||_0x4040c7['createdAt'],'gatewayBreakdown':_0x42ef7f};})),_0x2ed7ac=_0xd2fe2f[_0x4075e4(0x187)]((_0x36faba,_0x355d1f)=>_0x36faba+_0x355d1f[_0x4075e4(0x15c)],0x0),_0x4430d5=_0x2ed7ac;return console[_0x4075e4(0xee)](_0x4075e4(0xef)+_0x5c40a7+_0x4075e4(0xb7)+Math['round'](_0x4430d5*0x64)/0x64+_0x4075e4(0xc7)),{'merchants':_0x503d68,'pagination':{'page':_0x1b2b8e,'limit':_0x401372,'total':_0x5c40a7,'totalPages':Math[_0x4075e4(0xd4)](_0x5c40a7/_0x401372)},'summary':{'totalMerchants':_0x5c40a7,'totalAmountUSDT':Math[_0x4075e4(0x186)](_0x2ed7ac*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x4075e4(0x186)](_0x4430d5*0x64)/0x64}};}async[a35_0x5080cb(0x172)](_0x51ea69){const _0x51a6f7=a35_0x5080cb,{shopId:_0x7edbf2,amount:_0x198854,network:_0x3fcb91,wallet:_0x4acc01,notes:_0x352c16,txid:_0xf056df,periodFrom:_0x5d032b,periodTo:_0x181948}=_0x51ea69,_0x59a1b3=await database_1['default']['$transaction'](async _0x34d82c=>{const _0x1b5ee4=a35_0x3cc0,_0x288dfa=await _0x34d82c[_0x1b5ee4(0xaa)][_0x1b5ee4(0xbe)]({'where':{'id':_0x7edbf2},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x288dfa)throw new Error(_0x1b5ee4(0xd2));console[_0x1b5ee4(0xee)]('üí∞\x20Creating\x20payout\x20for\x20shop\x20'+_0x288dfa[_0x1b5ee4(0xe6)]+':'),console[_0x1b5ee4(0xee)]('\x20\x20\x20Current\x20balance:\x20'+_0x288dfa['balance']['toFixed'](0x6)+'\x20USDT'),console[_0x1b5ee4(0xee)](_0x1b5ee4(0x148)+_0x198854[_0x1b5ee4(0x18e)](0x6)+_0x1b5ee4(0xfb)),console[_0x1b5ee4(0xee)](_0x1b5ee4(0x139)+_0x288dfa['totalPaidOut']['toFixed'](0x6)+'\x20USDT');if(_0xf056df)console[_0x1b5ee4(0xee)](_0x1b5ee4(0x121)+_0xf056df);if(_0x288dfa[_0x1b5ee4(0x15c)]<_0x198854)throw new Error(_0x1b5ee4(0x105)+_0x288dfa['balance'][_0x1b5ee4(0x18e)](0x6)+'\x20USDT,\x20Requested:\x20'+_0x198854[_0x1b5ee4(0x18e)](0x6)+_0x1b5ee4(0xfb));let _0x3f5b3d=_0x4acc01;if(!_0x3f5b3d){const _0x32dd78=await _0x34d82c[_0x1b5ee4(0xaa)][_0x1b5ee4(0xbe)]({'where':{'id':_0x7edbf2},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x32dd78)switch(_0x3fcb91){case _0x1b5ee4(0xde):_0x3f5b3d=_0x32dd78[_0x1b5ee4(0xb8)]||undefined;break;case _0x1b5ee4(0x173):_0x3f5b3d=_0x32dd78[_0x1b5ee4(0x100)]||undefined;break;case'erc20':_0x3f5b3d=_0x32dd78[_0x1b5ee4(0x10b)]||undefined;break;case _0x1b5ee4(0x175):_0x3f5b3d=_0x32dd78['usdcPolygonWallet']||undefined;break;}}console[_0x1b5ee4(0xee)](_0x1b5ee4(0x11b)+_0x3fcb91+':\x20'+(_0x3f5b3d||_0x1b5ee4(0xca)));const _0x307131=await _0x34d82c['payout']['create']({'data':{'shopId':_0x7edbf2,'amount':_0x198854,'network':_0x3fcb91,'status':_0x1b5ee4(0x101),'txid':_0xf056df,'notes':_0x352c16,'periodFrom':_0x5d032b?new Date(_0x5d032b):null,'periodTo':_0x181948?new Date(_0x181948):null,'createdAt':new Date(),'paidAt':new Date()}}),_0xf9d764=_0x288dfa[_0x1b5ee4(0x15c)]-_0x198854,_0x8738a0=_0x288dfa['totalPaidOut']+_0x198854;return await _0x34d82c['shop'][_0x1b5ee4(0x17c)]({'where':{'id':_0x7edbf2},'data':{'balance':_0xf9d764,'totalPaidOut':_0x8738a0}}),console['log'](_0x1b5ee4(0x17f)+_0x288dfa[_0x1b5ee4(0xe6)]+_0x1b5ee4(0x12f)),console['log'](_0x1b5ee4(0xcc)+_0x288dfa[_0x1b5ee4(0x15c)][_0x1b5ee4(0x18e)](0x6)+'\x20->\x20'+_0xf9d764[_0x1b5ee4(0x18e)](0x6)+'\x20USDT\x20(-'+_0x198854[_0x1b5ee4(0x18e)](0x6)+')'),console['log'](_0x1b5ee4(0xf9)+_0x288dfa[_0x1b5ee4(0xb5)][_0x1b5ee4(0x18e)](0x6)+_0x1b5ee4(0xcf)+_0x8738a0[_0x1b5ee4(0x18e)](0x6)+_0x1b5ee4(0xf6)+_0x198854[_0x1b5ee4(0x18e)](0x6)+')'),{'payout':_0x307131,'shop':_0x288dfa};});return console[_0x51a6f7(0xee)](_0x51a6f7(0xe3)+_0x59a1b3[_0x51a6f7(0xb3)]['id']+'\x20for\x20shop\x20'+_0x59a1b3[_0x51a6f7(0xaa)][_0x51a6f7(0xe6)]+'\x20('+_0x198854+_0x51a6f7(0x154)),{'id':_0x59a1b3[_0x51a6f7(0xb3)]['id'],'shopId':_0x59a1b3['payout'][_0x51a6f7(0xad)],'shopName':_0x59a1b3[_0x51a6f7(0xaa)]['name'],'shopUsername':_0x59a1b3[_0x51a6f7(0xaa)][_0x51a6f7(0xe6)],'amount':_0x59a1b3[_0x51a6f7(0xb3)][_0x51a6f7(0x140)],'network':_0x59a1b3['payout']['network'],'status':_0x59a1b3[_0x51a6f7(0xb3)][_0x51a6f7(0x12a)],'txid':_0x59a1b3[_0x51a6f7(0xb3)][_0x51a6f7(0xcb)],'notes':_0x59a1b3[_0x51a6f7(0xb3)][_0x51a6f7(0xb4)],'periodFrom':_0x59a1b3[_0x51a6f7(0xb3)][_0x51a6f7(0xff)],'periodTo':_0x59a1b3[_0x51a6f7(0xb3)][_0x51a6f7(0xe7)],'createdAt':_0x59a1b3[_0x51a6f7(0xb3)]['createdAt'],'paidAt':_0x59a1b3[_0x51a6f7(0xb3)][_0x51a6f7(0xed)]};}async['getAllPayouts'](_0x347a42){const _0x454482=a35_0x5080cb,{page:_0x295f0b,limit:_0xe078a,shopId:_0x25549c,network:_0x2ed257,dateFrom:_0x3d8520,dateTo:_0x55ac72,search:_0x235f10}=_0x347a42,_0x210a18=(_0x295f0b-0x1)*_0xe078a,_0x5f3062={};_0x25549c&&(_0x5f3062[_0x454482(0xad)]=_0x25549c);_0x2ed257&&(_0x5f3062[_0x454482(0xc6)]=_0x2ed257);(_0x3d8520||_0x55ac72)&&(_0x5f3062['createdAt']={},_0x3d8520&&(_0x5f3062[_0x454482(0xb1)][_0x454482(0x109)]=new Date(_0x3d8520)),_0x55ac72&&(_0x5f3062[_0x454482(0xb1)][_0x454482(0x12b)]=new Date(_0x55ac72)));_0x235f10&&(_0x5f3062['OR']=[{'shop':{'name':{'contains':_0x235f10,'mode':_0x454482(0x18f)}}},{'shop':{'username':{'contains':_0x235f10,'mode':_0x454482(0x18f)}}},{'notes':{'contains':_0x235f10,'mode':'insensitive'}}]);const [_0x11ce2e,_0x46f025]=await Promise['all']([database_1[_0x454482(0xe1)][_0x454482(0xb3)][_0x454482(0x181)]({'where':_0x5f3062,'skip':_0x210a18,'take':_0xe078a,'orderBy':{'createdAt':_0x454482(0xdb)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x454482(0xe1)]['payout'][_0x454482(0x129)]({'where':_0x5f3062})]);return{'payouts':_0x11ce2e[_0x454482(0x133)](_0x499168=>({'id':_0x499168['id'],'shopId':_0x499168[_0x454482(0xad)],'shopName':_0x499168[_0x454482(0xaa)][_0x454482(0x18c)],'shopUsername':_0x499168['shop'][_0x454482(0xe6)],'amount':_0x499168[_0x454482(0x140)],'network':_0x499168[_0x454482(0xc6)],'status':_0x499168[_0x454482(0x12a)],'txid':_0x499168[_0x454482(0xcb)],'notes':_0x499168[_0x454482(0xb4)],'periodFrom':_0x499168[_0x454482(0xff)],'periodTo':_0x499168[_0x454482(0xe7)],'createdAt':_0x499168[_0x454482(0xb1)],'paidAt':_0x499168[_0x454482(0xed)]})),'pagination':{'page':_0x295f0b,'limit':_0xe078a,'total':_0x46f025,'totalPages':Math['ceil'](_0x46f025/_0xe078a)}};}async[a35_0x5080cb(0x10e)](_0x37624c){const _0x2deeea=a35_0x5080cb,_0x1a4d12=await database_1[_0x2deeea(0xe1)][_0x2deeea(0xb3)][_0x2deeea(0xbe)]({'where':{'id':_0x37624c},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x1a4d12)return null;return{'id':_0x1a4d12['id'],'shopId':_0x1a4d12[_0x2deeea(0xad)],'shopName':_0x1a4d12[_0x2deeea(0xaa)][_0x2deeea(0x18c)],'shopUsername':_0x1a4d12[_0x2deeea(0xaa)][_0x2deeea(0xe6)],'amount':_0x1a4d12[_0x2deeea(0x140)],'network':_0x1a4d12[_0x2deeea(0xc6)],'status':_0x1a4d12['status'],'txid':_0x1a4d12[_0x2deeea(0xcb)],'notes':_0x1a4d12['notes'],'periodFrom':_0x1a4d12[_0x2deeea(0xff)],'periodTo':_0x1a4d12[_0x2deeea(0xe7)],'createdAt':_0x1a4d12['createdAt'],'paidAt':_0x1a4d12['paidAt']};}async[a35_0x5080cb(0x11d)](_0x5554ac){const _0x18f503=a35_0x5080cb;await database_1[_0x18f503(0xe1)][_0x18f503(0xb3)][_0x18f503(0x132)]({'where':{'id':_0x5554ac}});}async[a35_0x5080cb(0x17b)](_0x2f4c2a){const _0x5fde2d=a35_0x5080cb,{page:_0x26283a,limit:_0x990182,status:_0x264243,gateway:_0x3e18f6,shopId:_0x695b6d,dateFrom:_0x14b3f3,dateTo:_0x394b6c,search:_0x45d9d5}=_0x2f4c2a,_0x53ab5a=(_0x26283a-0x1)*_0x990182,_0x2e45d4={};_0x264243&&(_0x2e45d4[_0x5fde2d(0x12a)]=_0x264243['toUpperCase']());_0x3e18f6&&(_0x2e45d4[_0x5fde2d(0x171)]=_0x3e18f6[_0x5fde2d(0x122)]());_0x2e45d4['gateway']=_0x2e45d4['gateway']?_0x2e45d4[_0x5fde2d(0x171)]:{'not':_0x5fde2d(0xfe)};if(typeof _0x2e45d4[_0x5fde2d(0x171)]==='string'&&_0x2e45d4[_0x5fde2d(0x171)]!=='test_gateway'){}else{if(typeof _0x2e45d4['gateway']==='string'&&_0x2e45d4[_0x5fde2d(0x171)]==='test_gateway'){}else _0x2e45d4[_0x5fde2d(0x171)]={'not':_0x5fde2d(0xfe)};}_0x695b6d&&(_0x2e45d4[_0x5fde2d(0xad)]=_0x695b6d);(_0x14b3f3||_0x394b6c)&&(_0x2e45d4[_0x5fde2d(0xb1)]={},_0x14b3f3&&(_0x2e45d4[_0x5fde2d(0xb1)]['gte']=new Date(_0x14b3f3)),_0x394b6c&&(_0x2e45d4[_0x5fde2d(0xb1)][_0x5fde2d(0x12b)]=new Date(_0x394b6c)));_0x45d9d5&&(_0x2e45d4['OR']=[{'orderId':{'contains':_0x45d9d5,'mode':'insensitive'}},{'gatewayOrderId':{'contains':_0x45d9d5,'mode':_0x5fde2d(0x18f)}},{'customerEmail':{'contains':_0x45d9d5,'mode':'insensitive'}},{'shop':{'name':{'contains':_0x45d9d5,'mode':_0x5fde2d(0x18f)}}},{'shop':{'username':{'contains':_0x45d9d5,'mode':_0x5fde2d(0x18f)}}}]);const [_0x3799d8,_0x2a1c2e]=await Promise[_0x5fde2d(0xbf)]([database_1[_0x5fde2d(0xe1)][_0x5fde2d(0xf0)]['findMany']({'where':_0x2e45d4,'skip':_0x53ab5a,'take':_0x990182,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x5fde2d(0xf0)]['count']({'where':_0x2e45d4})]);return{'payments':_0x3799d8[_0x5fde2d(0x133)](_0x3048df=>({'id':_0x3048df['id'],'shopId':_0x3048df[_0x5fde2d(0xad)],'gateway':_0x3048df[_0x5fde2d(0x171)],'amount':_0x3048df[_0x5fde2d(0x140)],'currency':_0x3048df[_0x5fde2d(0x142)],'status':_0x3048df[_0x5fde2d(0x12a)],'orderId':_0x3048df[_0x5fde2d(0x111)],'gatewayOrderId':_0x3048df['gatewayOrderId'],'customerEmail':_0x3048df['customerEmail'],'customerName':_0x3048df['customerName'],'customerCountry':_0x3048df[_0x5fde2d(0x104)],'customerIp':_0x3048df[_0x5fde2d(0x155)],'customerUa':_0x3048df['customerUa'],'failureMessage':_0x3048df['failureMessage'],'createdAt':_0x3048df['createdAt'],'updatedAt':_0x3048df[_0x5fde2d(0xc2)],'shop':_0x3048df[_0x5fde2d(0xaa)]})),'pagination':{'page':_0x26283a,'limit':_0x990182,'total':_0x2a1c2e,'totalPages':Math[_0x5fde2d(0xd4)](_0x2a1c2e/_0x990182)}};}async['getPaymentById'](_0x446d84){const _0x228fd0=a35_0x5080cb,_0x175633=await database_1[_0x228fd0(0xe1)][_0x228fd0(0xf0)]['findUnique']({'where':{'id':_0x446d84},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x175633)return null;return{'id':_0x175633['id'],'shopId':_0x175633[_0x228fd0(0xad)],'gateway':_0x175633['gateway'],'amount':_0x175633['amount'],'currency':_0x175633['currency'],'status':_0x175633[_0x228fd0(0x12a)],'orderId':_0x175633[_0x228fd0(0x111)],'gatewayOrderId':_0x175633[_0x228fd0(0x13a)],'customerEmail':_0x175633[_0x228fd0(0x168)],'customerName':_0x175633[_0x228fd0(0xf1)],'customerCountry':_0x175633[_0x228fd0(0x104)],'customerIp':_0x175633[_0x228fd0(0x155)],'customerUa':_0x175633[_0x228fd0(0x14b)],'failureMessage':_0x175633[_0x228fd0(0xd5)],'externalPaymentUrl':_0x175633[_0x228fd0(0x165)],'successUrl':_0x175633[_0x228fd0(0x110)],'failUrl':_0x175633[_0x228fd0(0x108)],'pendingUrl':_0x175633[_0x228fd0(0xc0)],'whiteUrl':_0x175633['whiteUrl'],'createdAt':_0x175633['createdAt'],'updatedAt':_0x175633[_0x228fd0(0xc2)],'shop':_0x175633[_0x228fd0(0xaa)]};}async[a35_0x5080cb(0x14e)](_0x5614c3,_0x505fd8,_0x4339ab,_0x3ca4da){const _0x55df72=a35_0x5080cb,_0x10b8b8=await database_1[_0x55df72(0xe1)][_0x55df72(0xc8)](async _0x4082b=>{const _0x471e93=_0x55df72,_0x14cbff=await _0x4082b[_0x471e93(0xf0)][_0x471e93(0xbe)]({'where':{'id':_0x5614c3},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x14cbff)throw new Error(_0x471e93(0x112));const _0x197a9b=_0x14cbff[_0x471e93(0x12a)],_0x3ad1b6=_0x505fd8['toUpperCase']();console[_0x471e93(0xee)](_0x471e93(0xeb)+_0x5614c3+_0x471e93(0x16f)+_0x197a9b+'\x20->\x20'+_0x3ad1b6),console[_0x471e93(0xee)](_0x471e93(0x114)+_0x14cbff['shop'][_0x471e93(0x15c)]+_0x471e93(0xfb));const _0x309503={'status':_0x3ad1b6,'updatedAt':new Date(),'statusChangedBy':'admin','statusChangedAt':new Date()};_0x4339ab&&(_0x309503[_0x471e93(0xab)]=_0x4339ab);_0x3ad1b6===_0x471e93(0x178)&&_0x3ca4da&&(_0x309503[_0x471e93(0x10f)]=_0x3ca4da);let _0xbf95d8=0x0,_0x235ad9=_0x14cbff[_0x471e93(0xaa)][_0x471e93(0x15c)];if(_0x3ad1b6===_0x471e93(0x158)&&_0x197a9b!==_0x471e93(0x158)){_0x309503[_0x471e93(0xed)]=new Date();const _0x22c657=await currencyService_1[_0x471e93(0x149)][_0x471e93(0x10d)](_0x14cbff['amount'],_0x14cbff[_0x471e93(0x142)]);_0x309503['amountUSDT']=_0x22c657,_0xbf95d8=_0x22c657,_0x235ad9+=_0x22c657,console['log']('üí∞\x20Payment\x20'+_0x5614c3+_0x471e93(0xb6)+_0x22c657[_0x471e93(0x18e)](0x6)+_0x471e93(0xf8));}else _0x197a9b==='PAID'&&_0x3ad1b6!==_0x471e93(0x158)&&(_0x14cbff[_0x471e93(0xe0)]&&(_0xbf95d8=-_0x14cbff['amountUSDT'],_0x235ad9-=_0x14cbff['amountUSDT'],_0x309503['amountUSDT']=null,console['log'](_0x471e93(0xaf)+_0x5614c3+_0x471e93(0x166)+_0x14cbff[_0x471e93(0xe0)][_0x471e93(0x18e)](0x6)+_0x471e93(0x123))));if(_0x3ad1b6===_0x471e93(0x178)){if(_0x197a9b===_0x471e93(0x158)&&_0x14cbff[_0x471e93(0xe0)]){}_0x3ca4da&&_0x3ca4da>0x0&&(_0xbf95d8-=_0x3ca4da,_0x235ad9-=_0x3ca4da,console[_0x471e93(0xee)](_0x471e93(0x145)+_0x3ca4da['toFixed'](0x6)+_0x471e93(0x123)));}_0x3ad1b6==='REFUND'&&_0x197a9b===_0x471e93(0x158)&&console['log'](_0x471e93(0x191));const _0x56738c=await _0x4082b[_0x471e93(0xf0)][_0x471e93(0x17c)]({'where':{'id':_0x5614c3},'data':_0x309503,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0xbf95d8!==0x0&&(await _0x4082b[_0x471e93(0xaa)][_0x471e93(0x17c)]({'where':{'id':_0x14cbff['shopId']},'data':{'balance':_0x235ad9}}),console[_0x471e93(0xee)]('üí∞\x20Shop\x20'+_0x14cbff[_0x471e93(0xad)]+_0x471e93(0x184)+_0x14cbff['shop'][_0x471e93(0x15c)][_0x471e93(0x18e)](0x6)+_0x471e93(0xcf)+_0x235ad9[_0x471e93(0x18e)](0x6)+_0x471e93(0x18d)+(_0xbf95d8>0x0?'+':'')+_0xbf95d8[_0x471e93(0x18e)](0x6)+')')),_0x56738c;});return{'id':_0x10b8b8['id'],'shopId':_0x10b8b8[_0x55df72(0xad)],'gateway':_0x10b8b8[_0x55df72(0x171)],'amount':_0x10b8b8[_0x55df72(0x140)],'currency':_0x10b8b8[_0x55df72(0x142)],'status':_0x10b8b8['status'],'orderId':_0x10b8b8[_0x55df72(0x111)],'gatewayOrderId':_0x10b8b8[_0x55df72(0x13a)],'customerEmail':_0x10b8b8[_0x55df72(0x168)],'customerName':_0x10b8b8[_0x55df72(0xf1)],'customerCountry':_0x10b8b8[_0x55df72(0x104)],'customerIp':_0x10b8b8['customerIp'],'customerUa':_0x10b8b8[_0x55df72(0x14b)],'failureMessage':_0x10b8b8[_0x55df72(0xd5)],'adminNotes':_0x10b8b8[_0x55df72(0xab)],'chargebackAmount':_0x10b8b8[_0x55df72(0x10f)],'statusChangedBy':_0x10b8b8[_0x55df72(0x18b)],'statusChangedAt':_0x10b8b8[_0x55df72(0x167)],'createdAt':_0x10b8b8[_0x55df72(0xb1)],'updatedAt':_0x10b8b8['updatedAt'],'shop':_0x10b8b8[_0x55df72(0xaa)]};}async[a35_0x5080cb(0x188)](_0x3b4fe2,_0x143b31){const _0x58ccc8=a35_0x5080cb,_0x3aa0b8={..._0x143b31};_0x143b31[_0x58ccc8(0x120)]&&(_0x3aa0b8['password']=await bcryptjs_1[_0x58ccc8(0xe1)][_0x58ccc8(0x127)](_0x143b31['password'],0xc));_0x143b31['fullName']&&(_0x3aa0b8[_0x58ccc8(0x18c)]=_0x143b31[_0x58ccc8(0xc1)],delete _0x3aa0b8[_0x58ccc8(0xc1)]);_0x143b31[_0x58ccc8(0x169)]&&(_0x3aa0b8[_0x58ccc8(0xb9)]=_0x143b31[_0x58ccc8(0x169)],delete _0x3aa0b8[_0x58ccc8(0x169)]);_0x143b31['merchantUrl']&&(_0x3aa0b8[_0x58ccc8(0xa9)]=_0x143b31['merchantUrl'],delete _0x3aa0b8[_0x58ccc8(0x11c)]);_0x143b31['gateways']&&(_0x3aa0b8[_0x58ccc8(0x17d)]=JSON['stringify'](_0x143b31[_0x58ccc8(0x118)]),delete _0x3aa0b8[_0x58ccc8(0x118)]);_0x143b31[_0x58ccc8(0x135)]&&(_0x3aa0b8[_0x58ccc8(0x135)]=JSON['stringify'](_0x143b31['gatewaySettings']),delete _0x3aa0b8[_0x58ccc8(0x135)]);_0x143b31['wallets']&&(_0x143b31[_0x58ccc8(0x16c)][_0x58ccc8(0xb8)]!==undefined&&(_0x3aa0b8[_0x58ccc8(0xb8)]=_0x143b31[_0x58ccc8(0x16c)][_0x58ccc8(0xb8)]||null),_0x143b31[_0x58ccc8(0x16c)][_0x58ccc8(0x100)]!==undefined&&(_0x3aa0b8[_0x58ccc8(0x100)]=_0x143b31[_0x58ccc8(0x16c)][_0x58ccc8(0x100)]||null),_0x143b31[_0x58ccc8(0x16c)][_0x58ccc8(0x10b)]!==undefined&&(_0x3aa0b8[_0x58ccc8(0x10b)]=_0x143b31[_0x58ccc8(0x16c)][_0x58ccc8(0x10b)]||null),_0x143b31['wallets'][_0x58ccc8(0x10a)]!==undefined&&(_0x3aa0b8[_0x58ccc8(0x10a)]=_0x143b31[_0x58ccc8(0x16c)][_0x58ccc8(0x10a)]||null),delete _0x3aa0b8[_0x58ccc8(0x16c)]);const _0x4ef4a0=await database_1[_0x58ccc8(0xe1)]['shop'][_0x58ccc8(0x17c)]({'where':{'id':_0x3b4fe2},'data':_0x3aa0b8,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4ef4a0['id'],'fullName':_0x4ef4a0[_0x58ccc8(0x18c)],'username':_0x4ef4a0['username'],'telegramId':_0x4ef4a0[_0x58ccc8(0xb9)],'merchantUrl':_0x4ef4a0[_0x58ccc8(0xa9)],'gateways':_0x4ef4a0[_0x58ccc8(0x17d)]?JSON[_0x58ccc8(0x144)](_0x4ef4a0[_0x58ccc8(0x17d)]):null,'gatewaySettings':_0x4ef4a0[_0x58ccc8(0x135)]?JSON[_0x58ccc8(0x144)](_0x4ef4a0[_0x58ccc8(0x135)]):null,'publicKey':_0x4ef4a0[_0x58ccc8(0x141)],'wallets':{'usdtPolygonWallet':_0x4ef4a0[_0x58ccc8(0xb8)],'usdtTrcWallet':_0x4ef4a0[_0x58ccc8(0x100)],'usdtErcWallet':_0x4ef4a0[_0x58ccc8(0x10b)],'usdcPolygonWallet':_0x4ef4a0[_0x58ccc8(0x10a)]},'status':_0x4ef4a0[_0x58ccc8(0x12a)],'createdAt':_0x4ef4a0[_0x58ccc8(0xb1)]};}async['suspendUser'](_0x142fcb){const _0xddcb=a35_0x5080cb,_0x4cd0cd=await database_1['default'][_0xddcb(0xaa)][_0xddcb(0x17c)]({'where':{'id':_0x142fcb},'data':{'status':_0xddcb(0x161)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4cd0cd['id'],'fullName':_0x4cd0cd[_0xddcb(0x18c)],'username':_0x4cd0cd['username'],'telegramId':_0x4cd0cd['telegram'],'merchantUrl':_0x4cd0cd[_0xddcb(0xa9)],'gateways':_0x4cd0cd['paymentGateways']?JSON[_0xddcb(0x144)](_0x4cd0cd[_0xddcb(0x17d)]):null,'gatewaySettings':_0x4cd0cd[_0xddcb(0x135)]?JSON[_0xddcb(0x144)](_0x4cd0cd[_0xddcb(0x135)]):null,'publicKey':_0x4cd0cd[_0xddcb(0x141)],'wallets':{'usdtPolygonWallet':_0x4cd0cd[_0xddcb(0xb8)],'usdtTrcWallet':_0x4cd0cd[_0xddcb(0x100)],'usdtErcWallet':_0x4cd0cd[_0xddcb(0x10b)],'usdcPolygonWallet':_0x4cd0cd[_0xddcb(0x10a)]},'status':_0x4cd0cd[_0xddcb(0x12a)],'createdAt':_0x4cd0cd[_0xddcb(0xb1)]};}async[a35_0x5080cb(0xc9)](_0x5a5adc){const _0x41debc=a35_0x5080cb,_0x576dac=await database_1[_0x41debc(0xe1)][_0x41debc(0xaa)][_0x41debc(0x17c)]({'where':{'id':_0x5a5adc},'data':{'status':_0x41debc(0x15e)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x576dac['id'],'fullName':_0x576dac[_0x41debc(0x18c)],'username':_0x576dac['username'],'telegramId':_0x576dac[_0x41debc(0xb9)],'merchantUrl':_0x576dac[_0x41debc(0xa9)],'gateways':_0x576dac[_0x41debc(0x17d)]?JSON['parse'](_0x576dac['paymentGateways']):null,'gatewaySettings':_0x576dac['gatewaySettings']?JSON[_0x41debc(0x144)](_0x576dac[_0x41debc(0x135)]):null,'publicKey':_0x576dac[_0x41debc(0x141)],'wallets':{'usdtPolygonWallet':_0x576dac[_0x41debc(0xb8)],'usdtTrcWallet':_0x576dac[_0x41debc(0x100)],'usdtErcWallet':_0x576dac['usdtErcWallet'],'usdcPolygonWallet':_0x576dac[_0x41debc(0x10a)]},'status':_0x576dac[_0x41debc(0x12a)],'createdAt':_0x576dac[_0x41debc(0xb1)]};}async[a35_0x5080cb(0xcd)](_0x296763){const _0x3265a0=a35_0x5080cb,{page:_0x4edf8a,limit:_0x2afd98,status:_0x3ac63f}=_0x296763,_0x244e6c=(_0x4edf8a-0x1)*_0x2afd98,_0x35f012={};_0x3ac63f&&(_0x35f012[_0x3265a0(0x12a)]=_0x3ac63f[_0x3265a0(0x13b)]());const [_0x519da0,_0x238fca]=await Promise[_0x3265a0(0xbf)]([database_1[_0x3265a0(0xe1)]['shop']['findMany']({'where':_0x35f012,'skip':_0x244e6c,'take':_0x2afd98,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x3265a0(0xe1)][_0x3265a0(0xaa)][_0x3265a0(0x129)]({'where':_0x35f012})]);return{'users':_0x519da0[_0x3265a0(0x133)](_0x317252=>({'id':_0x317252['id'],'fullName':_0x317252[_0x3265a0(0x18c)],'username':_0x317252['username'],'telegramId':_0x317252['telegram'],'merchantUrl':_0x317252['shopUrl'],'gateways':_0x317252[_0x3265a0(0x17d)]?JSON[_0x3265a0(0x144)](_0x317252[_0x3265a0(0x17d)]):null,'gatewaySettings':_0x317252[_0x3265a0(0x135)]?JSON['parse'](_0x317252[_0x3265a0(0x135)]):null,'publicKey':_0x317252['publicKey'],'wallets':{'usdtPolygonWallet':_0x317252[_0x3265a0(0xb8)],'usdtTrcWallet':_0x317252[_0x3265a0(0x100)],'usdtErcWallet':_0x317252[_0x3265a0(0x10b)],'usdcPolygonWallet':_0x317252[_0x3265a0(0x10a)]},'status':_0x317252['status'],'createdAt':_0x317252[_0x3265a0(0xb1)]})),'pagination':{'page':_0x4edf8a,'limit':_0x2afd98,'total':_0x238fca,'totalPages':Math['ceil'](_0x238fca/_0x2afd98)}};}async[a35_0x5080cb(0x12e)](_0x4fe92c){const _0x1c02ed=a35_0x5080cb,_0x206aa6=await database_1[_0x1c02ed(0xe1)]['shop'][_0x1c02ed(0xbe)]({'where':{'id':_0x4fe92c},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x206aa6)return null;return{'id':_0x206aa6['id'],'fullName':_0x206aa6[_0x1c02ed(0x18c)],'username':_0x206aa6['username'],'telegramId':_0x206aa6[_0x1c02ed(0xb9)],'merchantUrl':_0x206aa6[_0x1c02ed(0xa9)],'gateways':_0x206aa6[_0x1c02ed(0x17d)]?JSON[_0x1c02ed(0x144)](_0x206aa6[_0x1c02ed(0x17d)]):null,'gatewaySettings':_0x206aa6[_0x1c02ed(0x135)]?JSON[_0x1c02ed(0x144)](_0x206aa6[_0x1c02ed(0x135)]):null,'publicKey':_0x206aa6[_0x1c02ed(0x141)],'wallets':{'usdtPolygonWallet':_0x206aa6[_0x1c02ed(0xb8)],'usdtTrcWallet':_0x206aa6[_0x1c02ed(0x100)],'usdtErcWallet':_0x206aa6[_0x1c02ed(0x10b)],'usdcPolygonWallet':_0x206aa6[_0x1c02ed(0x10a)]},'status':_0x206aa6[_0x1c02ed(0x12a)],'createdAt':_0x206aa6[_0x1c02ed(0xb1)]};}async[a35_0x5080cb(0x11a)](_0x1bef22){const _0x30e77b=a35_0x5080cb,{fullName:_0x5ab6d9,username:_0x42fdb0,password:_0x28ccce,telegramId:_0x286185,merchantUrl:_0x2e0181,gateways:_0x575ea0,gatewaySettings:_0x17a33e,wallets:_0x4fc5f4}=_0x1bef22,_0x2324d5=await database_1[_0x30e77b(0xe1)][_0x30e77b(0xaa)][_0x30e77b(0xbe)]({'where':{'username':_0x42fdb0}});if(_0x2324d5)throw new Error(_0x30e77b(0x117));if(_0x286185){const _0x5588a5=await database_1[_0x30e77b(0xe1)]['shop'][_0x30e77b(0xbe)]({'where':{'telegram':_0x286185}});if(_0x5588a5)throw new Error(_0x30e77b(0xf7));}const _0x17b890=await bcryptjs_1['default'][_0x30e77b(0x127)](_0x28ccce,0xc),_0x468d28=_0x30e77b(0x14c)+crypto_1[_0x30e77b(0xe1)]['randomBytes'](0x20)[_0x30e77b(0xba)](_0x30e77b(0xda)),_0x573b7a=_0x30e77b(0x153)+crypto_1[_0x30e77b(0xe1)][_0x30e77b(0x115)](0x20)[_0x30e77b(0xba)](_0x30e77b(0xda)),_0x454a6d=await database_1[_0x30e77b(0xe1)][_0x30e77b(0xaa)][_0x30e77b(0x190)]({'data':{'name':_0x5ab6d9,'username':_0x42fdb0,'password':_0x17b890,'telegram':_0x286185,'shopUrl':_0x2e0181,'paymentGateways':_0x575ea0?JSON[_0x30e77b(0x159)](_0x575ea0):null,'gatewaySettings':_0x17a33e?JSON[_0x30e77b(0x159)](_0x17a33e):null,'usdtPolygonWallet':_0x4fc5f4?.[_0x30e77b(0xb8)]||null,'usdtTrcWallet':_0x4fc5f4?.[_0x30e77b(0x100)]||null,'usdtErcWallet':_0x4fc5f4?.['usdtErcWallet']||null,'usdcPolygonWallet':_0x4fc5f4?.[_0x30e77b(0x10a)]||null,'publicKey':_0x468d28,'secretKey':_0x573b7a,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x454a6d['id'],'fullName':_0x454a6d[_0x30e77b(0x18c)],'username':_0x454a6d[_0x30e77b(0xe6)],'telegramId':_0x454a6d[_0x30e77b(0xb9)],'merchantUrl':_0x454a6d[_0x30e77b(0xa9)],'gateways':_0x454a6d[_0x30e77b(0x17d)]?JSON[_0x30e77b(0x144)](_0x454a6d[_0x30e77b(0x17d)]):null,'gatewaySettings':_0x454a6d[_0x30e77b(0x135)]?JSON[_0x30e77b(0x144)](_0x454a6d['gatewaySettings']):null,'publicKey':_0x454a6d[_0x30e77b(0x141)],'wallets':{'usdtPolygonWallet':_0x454a6d[_0x30e77b(0xb8)],'usdtTrcWallet':_0x454a6d[_0x30e77b(0x100)],'usdtErcWallet':_0x454a6d[_0x30e77b(0x10b)],'usdcPolygonWallet':_0x454a6d[_0x30e77b(0x10a)]},'status':_0x454a6d[_0x30e77b(0x12a)],'createdAt':_0x454a6d[_0x30e77b(0xb1)]};}async['deleteUser'](_0x17055e){const _0x36312a=a35_0x5080cb;await database_1[_0x36312a(0xe1)]['shop'][_0x36312a(0x132)]({'where':{'id':_0x17055e}});}}function a35_0x3cc0(_0x3faf8a,_0x6b3e5c){const _0x5da422=a35_0x5da4();return a35_0x3cc0=function(_0x3cc084,_0x5cb618){_0x3cc084=_0x3cc084-0xa9;let _0x5b31de=_0x5da422[_0x3cc084];return _0x5b31de;},a35_0x3cc0(_0x3faf8a,_0x6b3e5c);}exports[a35_0x5080cb(0x107)]=AdminService;