'use strict';const a33_0x28acf0=a33_0x3b78;(function(_0x54f5fa,_0x44d015){const _0x31c65d=a33_0x3b78,_0x5218fe=_0x54f5fa();while(!![]){try{const _0x53b218=-parseInt(_0x31c65d(0x1d2))/0x1*(-parseInt(_0x31c65d(0x277))/0x2)+parseInt(_0x31c65d(0x226))/0x3*(-parseInt(_0x31c65d(0x1db))/0x4)+-parseInt(_0x31c65d(0x22f))/0x5*(-parseInt(_0x31c65d(0x1d0))/0x6)+-parseInt(_0x31c65d(0x1c8))/0x7*(-parseInt(_0x31c65d(0x1c5))/0x8)+parseInt(_0x31c65d(0x264))/0x9+parseInt(_0x31c65d(0x1e3))/0xa*(-parseInt(_0x31c65d(0x270))/0xb)+parseInt(_0x31c65d(0x1b1))/0xc*(-parseInt(_0x31c65d(0x1bb))/0xd);if(_0x53b218===_0x44d015)break;else _0x5218fe['push'](_0x5218fe['shift']());}catch(_0x2eb772){_0x5218fe['push'](_0x5218fe['shift']());}}}(a33_0x495d,0x61f01));var __importDefault=this&&this[a33_0x28acf0(0x1cb)]||function(_0x4a166b){const _0x564a7f=a33_0x28acf0;return _0x4a166b&&_0x4a166b[_0x564a7f(0x20d)]?_0x4a166b:{'default':_0x4a166b};};Object[a33_0x28acf0(0x1da)](exports,'__esModule',{'value':!![]}),exports['AdminService']=void 0x0;const database_1=__importDefault(require('../config/database')),currencyService_1=require(a33_0x28acf0(0x225)),userService_1=require(a33_0x28acf0(0x236)),telegramBotService_1=require(a33_0x28acf0(0x1f4)),gateway_1=require(a33_0x28acf0(0x250));function a33_0x3b78(_0x3685cd,_0x5e4860){const _0x495ddd=a33_0x495d();return a33_0x3b78=function(_0x3b781b,_0x8383cd){_0x3b781b=_0x3b781b-0x19e;let _0x2a045d=_0x495ddd[_0x3b781b];return _0x2a045d;},a33_0x3b78(_0x3685cd,_0x5e4860);}class AdminService{constructor(){const _0x2d99bd=a33_0x28acf0;this[_0x2d99bd(0x243)]=new userService_1['UserService']();}[a33_0x28acf0(0x220)](_0x427d5d){const _0x55c0a3=a33_0x28acf0;switch(_0x427d5d){case'7d':return 0x7;case _0x55c0a3(0x1ac):return 0x1e;case _0x55c0a3(0x23d):return 0x5a;case'1y':return 0x16d;default:return 0x1e;}}[a33_0x28acf0(0x22d)](_0x14c53f,_0x10eef3){const _0x2497a9=a33_0x28acf0,_0x45b833=[],_0x358954=new Date(_0x14c53f);while(_0x358954<=_0x10eef3){_0x45b833['push'](_0x358954[_0x2497a9(0x24f)]()[_0x2497a9(0x1fa)]('T')[0x0]),_0x358954[_0x2497a9(0x209)](_0x358954[_0x2497a9(0x26f)]()+0x1);}return _0x45b833;}[a33_0x28acf0(0x1e4)](_0x5a5eaa,_0x2ddd9a){const _0x26e655=a33_0x28acf0;if(!_0x5a5eaa[_0x26e655(0x237)])return{'commission':0x0,'payoutDelay':0x0};try{const _0x144f80=JSON[_0x26e655(0x1a2)](_0x5a5eaa[_0x26e655(0x237)]),_0x375f90=_0x2ddd9a[_0x26e655(0x207)](0x0)[_0x26e655(0x1f6)]()+_0x2ddd9a[_0x26e655(0x201)](0x1)[_0x26e655(0x1a3)]();if(_0x144f80&&_0x144f80[_0x375f90])return{'commission':_0x144f80[_0x375f90][_0x26e655(0x1a1)]||0x0,'payoutDelay':_0x144f80[_0x375f90][_0x26e655(0x21a)]||0x0};}catch(_0x4f444b){console['error'](_0x26e655(0x1c3),_0x4f444b);}return{'commission':0x0,'payoutDelay':0x0};}[a33_0x28acf0(0x25e)](_0x545a1d){const _0x2ec28c=a33_0x28acf0;if(_0x545a1d['status']!=='PAID'||_0x545a1d[_0x2ec28c(0x1e6)]||!_0x545a1d[_0x2ec28c(0x216)])return![];const _0x5765b1=this[_0x2ec28c(0x1e4)](_0x545a1d['shop'],_0x545a1d[_0x2ec28c(0x212)]),_0x26d49d=_0x5765b1[_0x2ec28c(0x21a)]*0x18*0x3c*0x3c*0x3e8,_0x338a71=new Date(_0x545a1d[_0x2ec28c(0x216)][_0x2ec28c(0x21b)]()+_0x26d49d);return new Date()>_0x338a71;}[a33_0x28acf0(0x232)](_0x40d500,_0x2c9111){return _0x40d500*(0x1-_0x2c9111/0x64);}[a33_0x28acf0(0x1ee)](_0x964172){const _0x5bad42=a33_0x28acf0;switch(_0x964172[_0x5bad42(0x205)]){case _0x5bad42(0x204):return _0x964172[_0x5bad42(0x1cd)];case _0x5bad42(0x1dc):return-(_0x964172[_0x5bad42(0x24b)]||0x0);case _0x5bad42(0x1c4):return 0x0;default:return 0x0;}}async['createPayout'](_0x50ae7c){const _0x52ba9c=a33_0x28acf0,{shopId:_0x4085f1,amount:_0x2724c2,network:_0x121b36,notes:_0x44f639}=_0x50ae7c;console[_0x52ba9c(0x229)]('üí∏\x20Creating\x20payout\x20for\x20shop\x20'+_0x4085f1+':\x20'+_0x2724c2+_0x52ba9c(0x1e7)+_0x121b36);const _0x5ddb7c=await database_1[_0x52ba9c(0x22c)][_0x52ba9c(0x219)][_0x52ba9c(0x26d)]({'where':{'id':_0x4085f1},'select':{'id':!![],'name':!![],'username':!![],'status':!![]}});if(!_0x5ddb7c)throw new Error(_0x52ba9c(0x278));if(_0x5ddb7c[_0x52ba9c(0x205)]!==_0x52ba9c(0x1ea))throw new Error(_0x52ba9c(0x261));const _0x2b8513=await database_1[_0x52ba9c(0x22c)]['payout'][_0x52ba9c(0x253)]({'data':{'shopId':_0x4085f1,'amount':_0x2724c2,'network':_0x121b36,'status':'COMPLETED','notes':_0x44f639||null,'paidAt':new Date()},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});await this[_0x52ba9c(0x265)](_0x4085f1,_0x2724c2);try{await telegramBotService_1['telegramBotService']['sendPayoutNotification'](_0x4085f1,_0x2b8513,'completed');}catch(_0x21a0ad){console[_0x52ba9c(0x1b5)](_0x52ba9c(0x25f),_0x21a0ad);}return console[_0x52ba9c(0x229)](_0x52ba9c(0x25b)+_0x2b8513['id']),{'id':_0x2b8513['id'],'shopId':_0x2b8513[_0x52ba9c(0x25c)],'shopName':_0x2b8513[_0x52ba9c(0x219)]['name'],'shopUsername':_0x2b8513['shop'][_0x52ba9c(0x1b7)],'amount':_0x2b8513[_0x52ba9c(0x1cd)],'network':_0x2b8513[_0x52ba9c(0x224)],'status':_0x2b8513[_0x52ba9c(0x205)],'txid':_0x2b8513['txid'],'notes':_0x2b8513[_0x52ba9c(0x230)],'createdAt':_0x2b8513[_0x52ba9c(0x238)],'paidAt':_0x2b8513[_0x52ba9c(0x216)]};}async[a33_0x28acf0(0x265)](_0x241049,_0x41afed){const _0x53accb=a33_0x28acf0;console[_0x53accb(0x229)](_0x53accb(0x20e)+_0x241049+_0x53accb(0x1a5)+_0x41afed+'\x20USDT');const _0xe5621e=await database_1[_0x53accb(0x22c)][_0x53accb(0x21f)][_0x53accb(0x262)]({'where':{'shopId':_0x241049,'status':_0x53accb(0x204),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'shop':{'select':{'gatewaySettings':!![]}}},'orderBy':{'paidAt':_0x53accb(0x19f)}});let _0x1c33a5=_0x41afed;const _0x2cca85=[];for(const _0x325131 of _0xe5621e){const _0x50f0fd={..._0x325131,'status':'PAID','merchantPaid':![],'shop':{'gatewaySettings':_0x325131[_0x53accb(0x219)]['gatewaySettings']}};if(!this[_0x53accb(0x25e)](_0x50f0fd))continue;const _0x494950=await currencyService_1['currencyService'][_0x53accb(0x23a)](_0x325131['amount'],_0x325131['currency']),_0x5f2907=this[_0x53accb(0x1e4)](_0x325131[_0x53accb(0x219)],_0x325131[_0x53accb(0x212)]),_0x25dea2=this['calculateAmountAfterCommission'](_0x494950,_0x5f2907['commission']);if(_0x25dea2<=_0x1c33a5){_0x2cca85[_0x53accb(0x20c)](_0x325131['id']),_0x1c33a5-=_0x25dea2;if(_0x1c33a5<=0.01)break;}}_0x2cca85[_0x53accb(0x227)]>0x0&&(await database_1[_0x53accb(0x22c)][_0x53accb(0x21f)][_0x53accb(0x25a)]({'where':{'id':{'in':_0x2cca85}},'data':{'merchantPaid':!![]}}),console[_0x53accb(0x229)](_0x53accb(0x1f2)+_0x2cca85[_0x53accb(0x227)]+_0x53accb(0x1df)));}async[a33_0x28acf0(0x279)](_0x1d9850){const _0x2661fe=a33_0x28acf0,{page:_0x151bd3,limit:_0x4ec613,shopId:_0x522eaa,network:_0x73b23a,dateFrom:_0x7742c4,dateTo:_0x51a3a5,search:_0x42c68d}=_0x1d9850,_0x17f8be=(_0x151bd3-0x1)*_0x4ec613;console['log'](_0x2661fe(0x211),_0x1d9850);const _0x9306e9={};_0x522eaa&&(_0x9306e9[_0x2661fe(0x25c)]=_0x522eaa);_0x73b23a&&(_0x9306e9['network']=_0x73b23a);(_0x7742c4||_0x51a3a5)&&(_0x9306e9[_0x2661fe(0x238)]={},_0x7742c4&&(_0x9306e9[_0x2661fe(0x238)][_0x2661fe(0x1de)]=new Date(_0x7742c4)),_0x51a3a5&&(_0x9306e9[_0x2661fe(0x238)][_0x2661fe(0x222)]=new Date(_0x51a3a5)));_0x42c68d&&(_0x9306e9['OR']=[{'txid':{'contains':_0x42c68d,'mode':'insensitive'}},{'notes':{'contains':_0x42c68d,'mode':'insensitive'}},{'shop':{'name':{'contains':_0x42c68d,'mode':_0x2661fe(0x24a)}}},{'shop':{'username':{'contains':_0x42c68d,'mode':_0x2661fe(0x24a)}}}]);const [_0x4f0946,_0x50a2e0]=await Promise['all']([database_1[_0x2661fe(0x22c)]['payout']['findMany']({'where':_0x9306e9,'skip':_0x17f8be,'take':_0x4ec613,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x2661fe(0x22c)][_0x2661fe(0x21d)][_0x2661fe(0x22e)]({'where':_0x9306e9})]);console[_0x2661fe(0x229)](_0x2661fe(0x233)+_0x4f0946[_0x2661fe(0x227)]+_0x2661fe(0x1d9)+_0x50a2e0+_0x2661fe(0x246));const _0x240e59=_0x4f0946[_0x2661fe(0x1c1)](_0x13d73e=>({'id':_0x13d73e['id'],'shopId':_0x13d73e[_0x2661fe(0x25c)],'shopName':_0x13d73e[_0x2661fe(0x219)]['name'],'shopUsername':_0x13d73e[_0x2661fe(0x219)][_0x2661fe(0x1b7)],'amount':_0x13d73e[_0x2661fe(0x1cd)],'network':_0x13d73e[_0x2661fe(0x224)],'status':_0x13d73e['status'],'txid':_0x13d73e['txid'],'notes':_0x13d73e['notes'],'createdAt':_0x13d73e[_0x2661fe(0x238)],'paidAt':_0x13d73e['paidAt']}));return{'payouts':_0x240e59,'pagination':{'page':_0x151bd3,'limit':_0x4ec613,'total':_0x50a2e0,'totalPages':Math['ceil'](_0x50a2e0/_0x4ec613)}};}async['getPayoutById'](_0x531a3d){const _0x4eaceb=a33_0x28acf0;console[_0x4eaceb(0x229)](_0x4eaceb(0x27b)+_0x531a3d);const _0x11b648=await database_1['default'][_0x4eaceb(0x21d)][_0x4eaceb(0x26d)]({'where':{'id':_0x531a3d},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x11b648)return console[_0x4eaceb(0x229)](_0x4eaceb(0x1fe)+_0x531a3d),null;return console[_0x4eaceb(0x229)]('‚úÖ\x20Found\x20payout:\x20'+_0x11b648[_0x4eaceb(0x1cd)]+_0x4eaceb(0x1e7)+_0x11b648['network']),{'id':_0x11b648['id'],'shopId':_0x11b648[_0x4eaceb(0x25c)],'shopName':_0x11b648[_0x4eaceb(0x219)]['name'],'shopUsername':_0x11b648[_0x4eaceb(0x219)][_0x4eaceb(0x1b7)],'amount':_0x11b648[_0x4eaceb(0x1cd)],'network':_0x11b648['network'],'status':_0x11b648[_0x4eaceb(0x205)],'txid':_0x11b648[_0x4eaceb(0x1bd)],'notes':_0x11b648[_0x4eaceb(0x230)],'createdAt':_0x11b648['createdAt'],'paidAt':_0x11b648[_0x4eaceb(0x216)]};}async[a33_0x28acf0(0x1b0)](_0x36385e){const _0x2134d2=a33_0x28acf0;console[_0x2134d2(0x229)](_0x2134d2(0x1ec)+_0x36385e);const _0x49c8ef=await database_1[_0x2134d2(0x22c)][_0x2134d2(0x21d)]['findUnique']({'where':{'id':_0x36385e},'select':{'id':!![],'shopId':!![],'amount':!![]}});if(!_0x49c8ef)throw new Error(_0x2134d2(0x1b4));await database_1[_0x2134d2(0x22c)][_0x2134d2(0x21d)][_0x2134d2(0x1ff)]({'where':{'id':_0x36385e}}),console[_0x2134d2(0x229)](_0x2134d2(0x1b8)+_0x36385e+_0x2134d2(0x244));}async['getMerchantsAwaitingPayout'](_0x471333){const _0xda22b2=a33_0x28acf0,{page:_0x3066cb,limit:_0x1a6ac5,minAmount:_0x455850,search:_0x562e32}=_0x471333;console['log'](_0xda22b2(0x267),_0x471333);const _0x2158ea=await database_1[_0xda22b2(0x22c)][_0xda22b2(0x21f)][_0xda22b2(0x262)]({'where':{'status':_0xda22b2(0x204),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'createdAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'gatewaySettings':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}});console[_0xda22b2(0x229)]('üí∞\x20Found\x20'+_0x2158ea[_0xda22b2(0x227)]+'\x20eligible\x20PAID\x20payments\x20for\x20payout\x20analysis');const _0x1ba45d=new Map();for(const _0x5826e9 of _0x2158ea){const _0x1b24df={..._0x5826e9,'status':'PAID','merchantPaid':![],'shop':{'gatewaySettings':_0x5826e9[_0xda22b2(0x219)][_0xda22b2(0x237)]}},_0x11f7b7=this[_0xda22b2(0x25e)](_0x1b24df);if(!_0x11f7b7)continue;const _0x282ac9=await currencyService_1[_0xda22b2(0x1e0)][_0xda22b2(0x23a)](_0x5826e9[_0xda22b2(0x1cd)],_0x5826e9[_0xda22b2(0x26c)]),_0xa1494c=this[_0xda22b2(0x1e4)](_0x5826e9[_0xda22b2(0x219)],_0x5826e9['gateway']),_0x2c556a=this['calculateAmountAfterCommission'](_0x282ac9,_0xa1494c[_0xda22b2(0x1a1)]),_0x4f1160=_0x5826e9[_0xda22b2(0x25c)];!_0x1ba45d[_0xda22b2(0x25d)](_0x4f1160)&&_0x1ba45d[_0xda22b2(0x20a)](_0x4f1160,{'shop':_0x5826e9['shop'],'payments':[]}),_0x1ba45d[_0xda22b2(0x210)](_0x4f1160)[_0xda22b2(0x1f0)]['push']({'id':_0x5826e9['id'],'amount':_0x5826e9[_0xda22b2(0x1cd)],'currency':_0x5826e9[_0xda22b2(0x26c)],'gateway':_0x5826e9[_0xda22b2(0x212)],'paidAt':_0x5826e9[_0xda22b2(0x216)],'createdAt':_0x5826e9[_0xda22b2(0x238)],'amountUSDT':_0x282ac9,'commission':_0xa1494c[_0xda22b2(0x1a1)],'amountAfterCommissionUSDT':_0x2c556a,'isEligible':!![]});}console[_0xda22b2(0x229)](_0xda22b2(0x1e9)+_0x1ba45d[_0xda22b2(0x19e)]+_0xda22b2(0x1b2));const _0x31138f=[];for(const [_0x486d49,_0xa9254b]of _0x1ba45d){const {shop:_0x50b6eb,payments:_0x560025}=_0xa9254b,_0x71bbbb=_0x560025[_0xda22b2(0x206)]((_0x2ae8d8,_0x16730b)=>_0x2ae8d8+_0x16730b[_0xda22b2(0x1f9)],0x0),_0x3e7728=_0x560025[_0xda22b2(0x206)]((_0x81eddc,_0x2bb233)=>_0x81eddc+_0x2bb233[_0xda22b2(0x215)],0x0);if(_0x455850&&_0x3e7728<_0x455850)continue;if(_0x562e32){const _0x5bfcb9=_0x562e32[_0xda22b2(0x1a3)](),_0x34b653=_0x50b6eb[_0xda22b2(0x22b)]['toLowerCase']()[_0xda22b2(0x24e)](_0x5bfcb9)||_0x50b6eb[_0xda22b2(0x1b7)][_0xda22b2(0x1a3)]()[_0xda22b2(0x24e)](_0x5bfcb9)||_0x50b6eb['telegram']&&_0x50b6eb[_0xda22b2(0x1a0)][_0xda22b2(0x1a3)]()[_0xda22b2(0x24e)](_0x5bfcb9);if(!_0x34b653)continue;}const _0x47e853=new Map();for(const _0x52faff of _0x560025){const _0x138b73=_0x52faff[_0xda22b2(0x212)];!_0x47e853[_0xda22b2(0x25d)](_0x138b73)&&_0x47e853[_0xda22b2(0x20a)](_0x138b73,{'count':0x0,'amountUSDT':0x0,'amountAfterCommissionUSDT':0x0,'commission':_0x52faff[_0xda22b2(0x1a1)]});const _0x5b8b03=_0x47e853['get'](_0x138b73);_0x5b8b03[_0xda22b2(0x22e)]++,_0x5b8b03[_0xda22b2(0x1f9)]+=_0x52faff['amountUSDT'],_0x5b8b03[_0xda22b2(0x215)]+=_0x52faff[_0xda22b2(0x215)];}const _0x20b4d5=Array['from'](_0x47e853['entries']())[_0xda22b2(0x1c1)](([_0x452141,_0x2f0c1d])=>({'gateway':_0x452141[_0xda22b2(0x207)](0x0)[_0xda22b2(0x1f6)]()+_0x452141[_0xda22b2(0x201)](0x1),'count':_0x2f0c1d['count'],'amountUSDT':Math[_0xda22b2(0x1e5)](_0x2f0c1d['amountUSDT']*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0xda22b2(0x1e5)](_0x2f0c1d[_0xda22b2(0x215)]*0x64)/0x64,'commission':_0x2f0c1d[_0xda22b2(0x1a1)]})),_0x39c467=_0x560025[_0xda22b2(0x206)]((_0xc4f51b,_0xfb29eb)=>{return _0xfb29eb['paidAt']<_0xc4f51b?_0xfb29eb['paidAt']:_0xc4f51b;},_0x560025[0x0]['paidAt']);_0x31138f['push']({'id':_0x50b6eb['id'],'fullName':_0x50b6eb[_0xda22b2(0x22b)],'username':_0x50b6eb['username'],'telegramId':_0x50b6eb['telegram'],'merchantUrl':_0x50b6eb[_0xda22b2(0x23e)],'wallets':{'usdtPolygonWallet':_0x50b6eb[_0xda22b2(0x271)],'usdtTrcWallet':_0x50b6eb[_0xda22b2(0x27a)],'usdtErcWallet':_0x50b6eb[_0xda22b2(0x228)],'usdcPolygonWallet':_0x50b6eb[_0xda22b2(0x273)]},'totalAmountUSDT':Math[_0xda22b2(0x1e5)](_0x71bbbb*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x3e7728*0x64)/0x64,'paymentsCount':_0x560025[_0xda22b2(0x227)],'oldestPaymentDate':_0x39c467,'gatewayBreakdown':_0x20b4d5});}_0x31138f[_0xda22b2(0x1c0)]((_0x4beb97,_0x116ba8)=>_0x116ba8['totalAmountAfterCommissionUSDT']-_0x4beb97[_0xda22b2(0x20f)]);const _0x2e50de=_0x31138f[_0xda22b2(0x227)],_0xfddc07=_0x31138f['reduce']((_0x4713dc,_0x176998)=>_0x4713dc+_0x176998[_0xda22b2(0x1d5)],0x0),_0x2b553b=_0x31138f[_0xda22b2(0x206)]((_0x33ffa3,_0x372877)=>_0x33ffa3+_0x372877[_0xda22b2(0x20f)],0x0),_0x2a03fa=(_0x3066cb-0x1)*_0x1a6ac5,_0x3364dc=_0x31138f['slice'](_0x2a03fa,_0x2a03fa+_0x1a6ac5);return console[_0xda22b2(0x229)](_0xda22b2(0x1bc)+_0x3364dc[_0xda22b2(0x227)]+'\x20merchants\x20out\x20of\x20'+_0x2e50de+_0xda22b2(0x246)),console[_0xda22b2(0x229)]('üí∞\x20Total\x20amount:\x20'+_0xfddc07[_0xda22b2(0x248)](0x2)+'\x20USDT\x20('+_0x2b553b[_0xda22b2(0x248)](0x2)+_0xda22b2(0x1ae)),{'merchants':_0x3364dc,'pagination':{'page':_0x3066cb,'limit':_0x1a6ac5,'total':_0x2e50de,'totalPages':Math[_0xda22b2(0x239)](_0x2e50de/_0x1a6ac5)},'summary':{'totalMerchants':_0x2e50de,'totalAmountUSDT':Math['round'](_0xfddc07*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0xda22b2(0x1e5)](_0x2b553b*0x64)/0x64}};}async[a33_0x28acf0(0x214)](){const _0x1a5b6b=a33_0x28acf0;console[_0x1a5b6b(0x229)]('üìä\x20Calculating\x20admin\x20payout\x20statistics...');const _0x2df716=await database_1[_0x1a5b6b(0x22c)][_0x1a5b6b(0x21f)][_0x1a5b6b(0x262)]({'where':{'status':{'in':[_0x1a5b6b(0x204),'REFUND',_0x1a5b6b(0x1dc)]}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'status':!![],'gateway':!![],'paidAt':!![],'merchantPaid':!![],'createdAt':!![],'chargebackAmount':!![],'shop':{'select':{'gatewaySettings':!![]}}}});console[_0x1a5b6b(0x229)]('üí∞\x20Found\x20'+_0x2df716[_0x1a5b6b(0x227)]+'\x20payments\x20for\x20analysis\x20(PAID/REFUND/CHARGEBACK)');const _0x401716=new Date(),_0x150dda=new Date(_0x401716['getFullYear'](),_0x401716['getMonth'](),0x1),_0x4118b2=new Date(_0x401716[_0x1a5b6b(0x221)](),_0x401716[_0x1a5b6b(0x23f)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7);let _0x48662e=0x0,_0x3593af=0x0,_0x472b09=0x0,_0x48001e=0x0;for(const _0x5656c2 of _0x2df716){const _0x44e1db=this[_0x1a5b6b(0x1ee)](_0x5656c2);if(_0x44e1db===0x0)continue;let _0x59f907,_0x49ed96;if(_0x5656c2[_0x1a5b6b(0x205)]===_0x1a5b6b(0x1dc))_0x59f907=Math['abs'](_0x44e1db),_0x49ed96=-_0x59f907;else{_0x59f907=await currencyService_1[_0x1a5b6b(0x1e0)][_0x1a5b6b(0x23a)](_0x5656c2[_0x1a5b6b(0x1cd)],_0x5656c2['currency']);const _0x33a2a2=this[_0x1a5b6b(0x1e4)](_0x5656c2['shop'],_0x5656c2[_0x1a5b6b(0x212)]);_0x49ed96=this['calculateAmountAfterCommission'](_0x59f907,_0x33a2a2[_0x1a5b6b(0x1a1)]);}_0x5656c2[_0x1a5b6b(0x1e6)]&&(_0x48662e+=_0x49ed96,_0x5656c2[_0x1a5b6b(0x216)]&&_0x5656c2[_0x1a5b6b(0x216)]>=_0x150dda&&_0x5656c2['paidAt']<=_0x4118b2&&(_0x472b09+=_0x49ed96)),_0x5656c2[_0x1a5b6b(0x205)]===_0x1a5b6b(0x204)&&this[_0x1a5b6b(0x25e)](_0x5656c2)&&(_0x3593af+=_0x49ed96,_0x48001e+=_0x59f907);}const _0x5a8237={'totalPayout':Math['round'](_0x48662e*0x64)/0x64,'awaitingPayout':Math[_0x1a5b6b(0x1e5)](_0x3593af*0x64)/0x64,'thisMonth':Math['round'](_0x472b09*0x64)/0x64,'availableBalance':Math[_0x1a5b6b(0x1e5)](_0x48001e*0x64)/0x64};return console[_0x1a5b6b(0x229)](_0x1a5b6b(0x1aa)),console['log'](_0x1a5b6b(0x1d1)+_0x5a8237['totalPayout']+_0x1a5b6b(0x1e2)),console[_0x1a5b6b(0x229)](_0x1a5b6b(0x203)+_0x5a8237[_0x1a5b6b(0x1c7)]+_0x1a5b6b(0x263)),console['log'](_0x1a5b6b(0x257)+_0x5a8237[_0x1a5b6b(0x254)]+_0x1a5b6b(0x1cc)),console['log'](_0x1a5b6b(0x24c)+_0x5a8237['availableBalance']+'\x20USDT'),_0x5a8237;}async[a33_0x28acf0(0x1ba)](_0x5e698a){const _0x3fdcc8=a33_0x28acf0,_0xe1f151=this['getPeriodDays'](_0x5e698a),_0x1b6e19=new Date();_0x1b6e19[_0x3fdcc8(0x209)](_0x1b6e19[_0x3fdcc8(0x26f)]()-_0xe1f151),console[_0x3fdcc8(0x229)](_0x3fdcc8(0x1c9)+_0x5e698a+'\x20('+_0xe1f151+_0x3fdcc8(0x1e8));const _0x33f6c0=await database_1['default']['shop'][_0x3fdcc8(0x22e)]({'where':{'status':_0x3fdcc8(0x1ea)}}),_0x3bdf3c=await database_1[_0x3fdcc8(0x22c)][_0x3fdcc8(0x21f)][_0x3fdcc8(0x22e)](),_0x35b397=await database_1[_0x3fdcc8(0x22c)][_0x3fdcc8(0x21f)][_0x3fdcc8(0x262)]({'where':{'status':{'in':[_0x3fdcc8(0x204),_0x3fdcc8(0x1c4),_0x3fdcc8(0x1dc)]}},'select':{'amount':!![],'currency':!![],'status':!![],'chargebackAmount':!![],'createdAt':!![]}});console[_0x3fdcc8(0x229)](_0x3fdcc8(0x1d8)+_0x35b397[_0x3fdcc8(0x227)]+_0x3fdcc8(0x1fb));const _0x5de8ff=await Promise[_0x3fdcc8(0x260)](_0x35b397['map'](async _0x16ab26=>{const _0x1d35e3=_0x3fdcc8,_0x71ab46=this[_0x1d35e3(0x1ee)](_0x16ab26);if(_0x71ab46===0x0)return{'amount':0x0,'createdAt':_0x16ab26[_0x1d35e3(0x238)]};let _0x36b644;return _0x16ab26[_0x1d35e3(0x205)]===_0x1d35e3(0x1dc)?_0x36b644=-Math[_0x1d35e3(0x1b9)](_0x71ab46):_0x36b644=await currencyService_1[_0x1d35e3(0x1e0)]['convertToUSDT'](_0x16ab26['amount'],_0x16ab26[_0x1d35e3(0x26c)]),{'amount':_0x36b644,'createdAt':_0x16ab26['createdAt']};})),_0x422a09=_0x5de8ff[_0x3fdcc8(0x206)]((_0x488a6f,_0x2d2588)=>_0x488a6f+_0x2d2588[_0x3fdcc8(0x1cd)],0x0),_0x243f87=_0x3bdf3c>0x0?_0x422a09/_0x3bdf3c:0x0;console['log'](_0x3fdcc8(0x1be)+_0x422a09[_0x3fdcc8(0x248)](0x2)+_0x3fdcc8(0x1e2)),console[_0x3fdcc8(0x229)](_0x3fdcc8(0x234)+_0x243f87[_0x3fdcc8(0x248)](0x2)+'\x20USDT');const _0x569b2f=await database_1['default'][_0x3fdcc8(0x1ef)]`
      SELECT 
        DATE(created_at) as date,
        array_agg(
          json_build_object(
            'amount', amount,
            'currency', currency,
            'status', status,
            'chargeback_amount', chargeback_amount
          )
        ) as payments
      FROM payments 
      WHERE created_at >= ${_0x1b6e19}
        AND status IN ('PAID', 'REFUND', 'CHARGEBACK')
      GROUP BY DATE(created_at)
      ORDER BY date ASC
    `;console[_0x3fdcc8(0x229)]('üìÖ\x20Processing\x20daily\x20stats\x20for\x20'+_0x569b2f[_0x3fdcc8(0x227)]+_0x3fdcc8(0x1a8));const _0x1b6268=await Promise[_0x3fdcc8(0x260)](_0x569b2f[_0x3fdcc8(0x1c1)](async _0x1aaee3=>{const _0x4fc29e=_0x3fdcc8,_0x2b856e=await Promise[_0x4fc29e(0x260)](_0x1aaee3[_0x4fc29e(0x1f0)][_0x4fc29e(0x1c1)](async _0x1c77ba=>{const _0x581830=_0x4fc29e,_0x267f39=this[_0x581830(0x1ee)](_0x1c77ba);if(_0x267f39===0x0)return 0x0;return _0x1c77ba[_0x581830(0x205)]===_0x581830(0x1dc)?-Math[_0x581830(0x1b9)](_0x267f39):await currencyService_1[_0x581830(0x1e0)][_0x581830(0x23a)](_0x1c77ba[_0x581830(0x1cd)],_0x1c77ba[_0x581830(0x26c)]);})),_0x3f76ae=_0x2b856e[_0x4fc29e(0x206)]((_0x4dd1a0,_0xe2690a)=>_0x4dd1a0+_0xe2690a,0x0);return{'date':_0x1aaee3['date'][_0x4fc29e(0x24f)]()[_0x4fc29e(0x1fa)]('T')[0x0],'amount':_0x3f76ae};})),_0x1727ac=this[_0x3fdcc8(0x22d)](_0x1b6e19,new Date()),_0x3369e7=new Map(_0x1b6268[_0x3fdcc8(0x1c1)](_0x207ebb=>[_0x207ebb[_0x3fdcc8(0x1a4)],_0x207ebb[_0x3fdcc8(0x1cd)]])),_0x4d2bf3=_0x1727ac[_0x3fdcc8(0x1c1)](_0x1d8dbb=>({'date':_0x1d8dbb,'amount':_0x3369e7[_0x3fdcc8(0x210)](_0x1d8dbb)||0x0}));return console[_0x3fdcc8(0x229)](_0x3fdcc8(0x202)),console[_0x3fdcc8(0x229)](_0x3fdcc8(0x1bf)+_0x33f6c0),console[_0x3fdcc8(0x229)](_0x3fdcc8(0x1ad)+_0x3bdf3c),console['log']('üìä\x20Daily\x20revenue\x20entries:\x20'+_0x4d2bf3[_0x3fdcc8(0x227)]),{'totalRevenue':Math[_0x3fdcc8(0x1e5)](_0x422a09*0x64)/0x64,'totalUsers':_0x33f6c0,'totalPayments':_0x3bdf3c,'averagePayment':Math[_0x3fdcc8(0x1e5)](_0x243f87*0x64)/0x64,'dailyRevenue':_0x4d2bf3};}async[a33_0x28acf0(0x23b)](_0x356411){const _0xcde2df=a33_0x28acf0,{page:_0x28d39d,limit:_0x389e65,status:_0x169091,gateway:_0x1ed5dd,shopId:_0x22e426,dateFrom:_0x4bfcca,dateTo:_0x213b8e,search:_0x123d36}=_0x356411,_0xec44f0=(_0x28d39d-0x1)*_0x389e65;console[_0xcde2df(0x229)](_0xcde2df(0x231),_0x356411);const _0x4db7d7={};_0x169091&&(_0x4db7d7[_0xcde2df(0x205)]=_0x169091['toUpperCase']());if(_0x1ed5dd){if((0x0,gateway_1[_0xcde2df(0x20b)])(_0x1ed5dd)){const _0x31fce9=(0x0,gateway_1[_0xcde2df(0x252)])(_0x1ed5dd);_0x31fce9&&(_0x4db7d7[_0xcde2df(0x212)]=_0x31fce9);}else _0x4db7d7[_0xcde2df(0x212)]=_0x1ed5dd[_0xcde2df(0x1a3)]();}_0x22e426&&(_0x4db7d7[_0xcde2df(0x25c)]=_0x22e426);(_0x4bfcca||_0x213b8e)&&(_0x4db7d7[_0xcde2df(0x238)]={},_0x4bfcca&&(_0x4db7d7[_0xcde2df(0x238)]['gte']=new Date(_0x4bfcca)),_0x213b8e&&(_0x4db7d7['createdAt']['lte']=new Date(_0x213b8e)));_0x123d36&&(_0x4db7d7['OR']=[{'orderId':{'contains':_0x123d36,'mode':_0xcde2df(0x24a)}},{'gatewayOrderId':{'contains':_0x123d36,'mode':_0xcde2df(0x24a)}},{'gatewayPaymentId':{'contains':_0x123d36,'mode':'insensitive'}},{'customerEmail':{'contains':_0x123d36,'mode':'insensitive'}},{'customerName':{'contains':_0x123d36,'mode':_0xcde2df(0x24a)}},{'shop':{'name':{'contains':_0x123d36,'mode':_0xcde2df(0x24a)}}},{'shop':{'username':{'contains':_0x123d36,'mode':_0xcde2df(0x24a)}}}]);const [_0x1fba88,_0xe003cd]=await Promise[_0xcde2df(0x260)]([database_1['default']['payment'][_0xcde2df(0x262)]({'where':_0x4db7d7,'skip':_0xec44f0,'take':_0x389e65,'orderBy':{'createdAt':_0xcde2df(0x1ed)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0xcde2df(0x22c)][_0xcde2df(0x21f)][_0xcde2df(0x22e)]({'where':_0x4db7d7})]);console[_0xcde2df(0x229)](_0xcde2df(0x233)+_0x1fba88[_0xcde2df(0x227)]+_0xcde2df(0x22a)+_0xe003cd+_0xcde2df(0x246));const _0x2aa5e4=_0x1fba88[_0xcde2df(0x1c1)](_0x466d50=>({'id':_0x466d50['id'],'shopId':_0x466d50[_0xcde2df(0x25c)],'shopName':_0x466d50[_0xcde2df(0x219)]['name'],'shopUsername':_0x466d50[_0xcde2df(0x219)][_0xcde2df(0x1b7)],'gateway':_0x466d50['gateway'],'orderId':_0x466d50[_0xcde2df(0x1e1)],'gatewayOrderId':_0x466d50['gatewayOrderId'],'amount':_0x466d50[_0xcde2df(0x1cd)],'currency':_0x466d50[_0xcde2df(0x26c)],'sourceCurrency':_0x466d50[_0xcde2df(0x235)],'status':_0x466d50['status'],'usage':_0x466d50[_0xcde2df(0x1a7)],'externalPaymentUrl':_0x466d50[_0xcde2df(0x21c)],'gatewayPaymentId':_0x466d50[_0xcde2df(0x249)],'customerEmail':_0x466d50['customerEmail'],'customerName':_0x466d50['customerName'],'cardLast4':_0x466d50[_0xcde2df(0x1d4)],'paymentMethod':_0x466d50['paymentMethod'],'bankId':_0x466d50[_0xcde2df(0x245)],'remitterIban':_0x466d50[_0xcde2df(0x1a6)],'remitterName':_0x466d50[_0xcde2df(0x1c6)],'chargebackAmount':_0x466d50['chargebackAmount'],'adminNotes':_0x466d50[_0xcde2df(0x24d)],'statusChangedBy':_0x466d50[_0xcde2df(0x213)],'statusChangedAt':_0x466d50['statusChangedAt'],'createdAt':_0x466d50[_0xcde2df(0x238)],'updatedAt':_0x466d50[_0xcde2df(0x21e)],'expiresAt':_0x466d50['expiresAt']}));return{'payments':_0x2aa5e4,'pagination':{'page':_0x28d39d,'limit':_0x389e65,'total':_0xe003cd,'totalPages':Math[_0xcde2df(0x239)](_0xe003cd/_0x389e65)}};}async[a33_0x28acf0(0x223)](_0x45819e){const _0x27abe8=a33_0x28acf0;console[_0x27abe8(0x229)](_0x27abe8(0x258)+_0x45819e);const _0x2c76d1=await database_1[_0x27abe8(0x22c)][_0x27abe8(0x21f)][_0x27abe8(0x26d)]({'where':{'id':_0x45819e},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}},'webhookLogs':{'orderBy':{'createdAt':_0x27abe8(0x1ed)},'take':0xa,'select':{'id':!![],'event':!![],'statusCode':!![],'retryCount':!![],'createdAt':!![]}}}});if(!_0x2c76d1)return console[_0x27abe8(0x229)]('‚ùå\x20Payment\x20not\x20found:\x20'+_0x45819e),null;return console['log'](_0x27abe8(0x1f1)+_0x2c76d1['orderId']+'\x20('+_0x2c76d1[_0x27abe8(0x205)]+')'),{'id':_0x2c76d1['id'],'shopId':_0x2c76d1[_0x27abe8(0x25c)],'shopName':_0x2c76d1[_0x27abe8(0x219)]['name'],'shopUsername':_0x2c76d1[_0x27abe8(0x219)][_0x27abe8(0x1b7)],'gateway':_0x2c76d1['gateway'],'orderId':_0x2c76d1[_0x27abe8(0x1e1)],'gatewayOrderId':_0x2c76d1['gatewayOrderId'],'amount':_0x2c76d1[_0x27abe8(0x1cd)],'currency':_0x2c76d1['currency'],'sourceCurrency':_0x2c76d1[_0x27abe8(0x235)],'status':_0x2c76d1[_0x27abe8(0x205)],'usage':_0x2c76d1[_0x27abe8(0x1a7)],'externalPaymentUrl':_0x2c76d1[_0x27abe8(0x21c)],'gatewayPaymentId':_0x2c76d1[_0x27abe8(0x249)],'customerEmail':_0x2c76d1[_0x27abe8(0x251)],'customerName':_0x2c76d1[_0x27abe8(0x241)],'cardLast4':_0x2c76d1[_0x27abe8(0x1d4)],'paymentMethod':_0x2c76d1[_0x27abe8(0x208)],'bankId':_0x2c76d1[_0x27abe8(0x245)],'remitterIban':_0x2c76d1[_0x27abe8(0x1a6)],'remitterName':_0x2c76d1[_0x27abe8(0x1c6)],'chargebackAmount':_0x2c76d1[_0x27abe8(0x24b)],'adminNotes':_0x2c76d1[_0x27abe8(0x24d)],'statusChangedBy':_0x2c76d1[_0x27abe8(0x213)],'statusChangedAt':_0x2c76d1[_0x27abe8(0x1b3)],'createdAt':_0x2c76d1[_0x27abe8(0x238)],'updatedAt':_0x2c76d1[_0x27abe8(0x21e)],'expiresAt':_0x2c76d1[_0x27abe8(0x1eb)],'webhookLogs':_0x2c76d1[_0x27abe8(0x276)]};}async[a33_0x28acf0(0x1d3)](_0x59e7ba,_0x180172,_0x393833,_0x1600f0){const _0x180ba4=a33_0x28acf0;console['log']('üîÑ\x20Updating\x20payment\x20'+_0x59e7ba+_0x180ba4(0x1cf)+_0x180172);const _0x56325a=[_0x180ba4(0x247),_0x180ba4(0x1fc),_0x180ba4(0x204),_0x180ba4(0x269),_0x180ba4(0x23c),_0x180ba4(0x1c4),_0x180ba4(0x1dc)];if(!_0x56325a['includes'](_0x180172['toUpperCase']()))throw new Error(_0x180ba4(0x200)+_0x56325a[_0x180ba4(0x266)](',\x20'));const _0x39fc0d=await database_1[_0x180ba4(0x22c)][_0x180ba4(0x21f)][_0x180ba4(0x26d)]({'where':{'id':_0x59e7ba},'select':{'id':!![],'status':!![],'orderId':!![]}});if(!_0x39fc0d)throw new Error(_0x180ba4(0x218));if(_0x180172['toUpperCase']()==='CHARGEBACK'){if(!_0x1600f0||_0x1600f0<=0x0)throw new Error(_0x180ba4(0x1f3));console[_0x180ba4(0x229)](_0x180ba4(0x272)+_0x1600f0+_0x180ba4(0x259));}const _0x1401c3={'status':_0x180172[_0x180ba4(0x1f6)](),'updatedAt':new Date()};_0x393833&&(_0x1401c3[_0x180ba4(0x24d)]=_0x393833);_0x180172[_0x180ba4(0x1f6)]()===_0x180ba4(0x1dc)&&_0x1600f0&&(_0x1401c3[_0x180ba4(0x24b)]=_0x1600f0);const _0x5e0f85=await database_1[_0x180ba4(0x22c)]['payment'][_0x180ba4(0x268)]({'where':{'id':_0x59e7ba},'data':_0x1401c3,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});return await database_1[_0x180ba4(0x22c)][_0x180ba4(0x1dd)]['create']({'data':{'paymentId':_0x59e7ba,'shopId':_0x5e0f85['shopId'],'event':_0x180ba4(0x274),'statusCode':0xc8,'responseBody':JSON[_0x180ba4(0x1b6)]({'oldStatus':_0x39fc0d[_0x180ba4(0x205)],'newStatus':_0x180172[_0x180ba4(0x1f6)](),'notes':_0x393833||null,'chargebackAmount':_0x1600f0||null,'timestamp':new Date()[_0x180ba4(0x24f)]()})}}),console[_0x180ba4(0x229)]('‚úÖ\x20Payment\x20'+_0x39fc0d[_0x180ba4(0x1e1)]+_0x180ba4(0x1af)+_0x39fc0d['status']+'\x20to\x20'+_0x180172['toUpperCase']()),_0x180172[_0x180ba4(0x1f6)]()===_0x180ba4(0x1dc)&&console[_0x180ba4(0x229)](_0x180ba4(0x1fd)+_0x1600f0+_0x180ba4(0x1ca)),{'id':_0x5e0f85['id'],'shopId':_0x5e0f85['shopId'],'shopName':_0x5e0f85[_0x180ba4(0x219)]['name'],'shopUsername':_0x5e0f85[_0x180ba4(0x219)][_0x180ba4(0x1b7)],'gateway':_0x5e0f85[_0x180ba4(0x212)],'orderId':_0x5e0f85[_0x180ba4(0x1e1)],'gatewayOrderId':_0x5e0f85[_0x180ba4(0x242)],'amount':_0x5e0f85[_0x180ba4(0x1cd)],'currency':_0x5e0f85[_0x180ba4(0x26c)],'sourceCurrency':_0x5e0f85[_0x180ba4(0x235)],'status':_0x5e0f85['status'],'usage':_0x5e0f85[_0x180ba4(0x1a7)],'externalPaymentUrl':_0x5e0f85['externalPaymentUrl'],'gatewayPaymentId':_0x5e0f85[_0x180ba4(0x249)],'customerEmail':_0x5e0f85[_0x180ba4(0x251)],'customerName':_0x5e0f85[_0x180ba4(0x241)],'cardLast4':_0x5e0f85[_0x180ba4(0x1d4)],'paymentMethod':_0x5e0f85[_0x180ba4(0x208)],'bankId':_0x5e0f85[_0x180ba4(0x245)],'remitterIban':_0x5e0f85[_0x180ba4(0x1a6)],'remitterName':_0x5e0f85[_0x180ba4(0x1c6)],'chargebackAmount':_0x5e0f85[_0x180ba4(0x24b)],'adminNotes':_0x5e0f85[_0x180ba4(0x24d)],'statusChangedBy':_0x5e0f85[_0x180ba4(0x213)],'statusChangedAt':_0x5e0f85[_0x180ba4(0x1b3)],'createdAt':_0x5e0f85[_0x180ba4(0x238)],'updatedAt':_0x5e0f85[_0x180ba4(0x21e)],'expiresAt':_0x5e0f85['expiresAt']};}async[a33_0x28acf0(0x217)](_0xab5bdd){const _0x33d6f7=a33_0x28acf0,{page:_0x5ef330,limit:_0x744528,status:_0x1e4f44}=_0xab5bdd,_0x4e074a=(_0x5ef330-0x1)*_0x744528,_0x346c58={};_0x1e4f44&&(_0x346c58['status']=_0x1e4f44['toUpperCase']());console['log'](_0x33d6f7(0x26e),{'page':_0x5ef330,'limit':_0x744528,'status':_0x1e4f44,'where':_0x346c58});const [_0x54068b,_0x3176ca]=await Promise[_0x33d6f7(0x260)]([database_1[_0x33d6f7(0x22c)]['shop'][_0x33d6f7(0x262)]({'where':_0x346c58,'skip':_0x4e074a,'take':_0x744528,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':'desc'}}),database_1[_0x33d6f7(0x22c)][_0x33d6f7(0x219)][_0x33d6f7(0x22e)]({'where':_0x346c58})]);console['log'](_0x33d6f7(0x233)+_0x54068b['length']+'\x20users\x20out\x20of\x20'+_0x3176ca+'\x20total');const _0x4c0d44=_0x54068b[_0x33d6f7(0x1c1)](_0x1b338d=>({'id':_0x1b338d['id'],'fullName':_0x1b338d[_0x33d6f7(0x22b)],'username':_0x1b338d[_0x33d6f7(0x1b7)],'telegramId':_0x1b338d[_0x33d6f7(0x1a0)],'merchantUrl':_0x1b338d['shopUrl'],'gateways':_0x1b338d[_0x33d6f7(0x1d6)]?JSON[_0x33d6f7(0x1a2)](_0x1b338d['paymentGateways']):null,'gatewaySettings':_0x1b338d[_0x33d6f7(0x237)]?JSON[_0x33d6f7(0x1a2)](_0x1b338d['gatewaySettings']):null,'publicKey':_0x1b338d[_0x33d6f7(0x1d7)],'wallets':{'usdtPolygonWallet':_0x1b338d[_0x33d6f7(0x271)],'usdtTrcWallet':_0x1b338d[_0x33d6f7(0x27a)],'usdtErcWallet':_0x1b338d[_0x33d6f7(0x228)],'usdcPolygonWallet':_0x1b338d[_0x33d6f7(0x273)]},'status':_0x1b338d[_0x33d6f7(0x205)],'createdAt':_0x1b338d['createdAt']}));return{'users':_0x4c0d44,'pagination':{'page':_0x5ef330,'limit':_0x744528,'total':_0x3176ca,'totalPages':Math['ceil'](_0x3176ca/_0x744528)}};}async[a33_0x28acf0(0x1a9)](_0x3bc118){return await this['userService']['getUserById'](_0x3bc118);}async[a33_0x28acf0(0x1c2)](_0x12e8ae){const _0x1f89b5=a33_0x28acf0;return await this['userService'][_0x1f89b5(0x1c2)](_0x12e8ae);}async[a33_0x28acf0(0x240)](_0x452aeb,_0x74da44){const _0x24afa2=a33_0x28acf0;return await this[_0x24afa2(0x243)][_0x24afa2(0x240)](_0x452aeb,_0x74da44);}async[a33_0x28acf0(0x26a)](_0x57467b){const _0x313a8=a33_0x28acf0;return await this[_0x313a8(0x243)][_0x313a8(0x26a)](_0x57467b);}async[a33_0x28acf0(0x1f7)](_0x9f5ac8){const _0x24bff8=a33_0x28acf0;console[_0x24bff8(0x229)]('üö´\x20Suspending\x20user:\x20'+_0x9f5ac8);const _0x1e9635=await database_1['default'][_0x24bff8(0x219)]['findUnique']({'where':{'id':_0x9f5ac8},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x1e9635)throw new Error(_0x24bff8(0x1ab));if(_0x1e9635['status']===_0x24bff8(0x255))throw new Error('User\x20is\x20already\x20suspended');const _0x4075ca=await this[_0x24bff8(0x243)]['updateUser'](_0x9f5ac8,{'status':_0x24bff8(0x255)});return console[_0x24bff8(0x229)](_0x24bff8(0x1ce)+_0x1e9635[_0x24bff8(0x1b7)]+_0x24bff8(0x1f5)),_0x4075ca;}async[a33_0x28acf0(0x256)](_0x2b7ba5){const _0x3a63b0=a33_0x28acf0;console['log'](_0x3a63b0(0x275)+_0x2b7ba5);const _0x4e693e=await database_1[_0x3a63b0(0x22c)]['shop'][_0x3a63b0(0x26d)]({'where':{'id':_0x2b7ba5},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x4e693e)throw new Error(_0x3a63b0(0x1ab));if(_0x4e693e[_0x3a63b0(0x205)]===_0x3a63b0(0x1ea))throw new Error('User\x20is\x20already\x20active');const _0x4a9f9f=await this[_0x3a63b0(0x243)]['updateUser'](_0x2b7ba5,{'status':_0x3a63b0(0x1ea)});return console[_0x3a63b0(0x229)]('‚úÖ\x20User\x20'+_0x4e693e['username']+_0x3a63b0(0x26b)),_0x4a9f9f;}}exports[a33_0x28acf0(0x1f8)]=AdminService;function a33_0x495d(){const _0x1d6276=['\x20activated\x20successfully','currency','findUnique','üìã\x20Getting\x20users\x20with\x20filters:','getDate','10945PYByLk','usdtPolygonWallet','üí∏\x20Chargeback\x20amount:\x20','usdcPolygonWallet','status_update','‚úÖ\x20Activating\x20user:\x20','webhookLogs','2eDtSAW','Shop\x20not\x20found','getAllPayouts','usdtTrcWallet','üîç\x20Getting\x20payout\x20by\x20ID:\x20','size','asc','telegram','commission','parse','toLowerCase','date',',\x20amount:\x20','remitterIban','usage','\x20days','getUserById','‚úÖ\x20Payout\x20statistics\x20calculated:','User\x20not\x20found','30d','üí≥\x20Total\x20payments:\x20','\x20USDT\x20after\x20commission)','\x20status\x20updated\x20from\x20','deletePayout','60oewWvC','\x20merchants\x20with\x20eligible\x20PAID\x20payments','statusChangedAt','Payout\x20not\x20found','error','stringify','username','‚úÖ\x20Payout\x20','abs','getSystemStatistics','709553mgIGyq','‚úÖ\x20Returning\x20','txid','üíµ\x20Total\x20revenue:\x20','üë•\x20Total\x20users:\x20','sort','map','createUser','Error\x20parsing\x20gateway\x20settings:','REFUND','160744wLDrhR','remitterName','awaitingPayout','119zvRCKi','üìä\x20Generating\x20admin\x20statistics\x20for\x20period:\x20','\x20USDT\x20(will\x20be\x20deducted\x20from\x20merchant\x20balance)','__importDefault','\x20USDT','amount','‚úÖ\x20User\x20','\x20status\x20to:\x20','18soOGJb','üí∏\x20Total\x20Payout:\x20','152973EkVTHl','updatePaymentStatus','cardLast4','totalAmountUSDT','paymentGateways','publicKey','üí∞\x20Found\x20','\x20payouts\x20out\x20of\x20','defineProperty','716KUKhcD','CHARGEBACK','webhookLog','gte','\x20payments\x20as\x20paid\x20out','currencyService','orderId','\x20USDT\x20(–≤–∫–ª—é—á–∞—è\x20—à—Ç—Ä–∞—Ñ—ã\x20chargeback)','1880PVxbCN','getGatewaySettings','round','merchantPaid','\x20USDT\x20via\x20','\x20days)','üè™\x20Found\x20','ACTIVE','expiresAt','üóëÔ∏è\x20Deleting\x20payout:\x20','desc','calculateEffectiveAmount','$queryRaw','payments','‚úÖ\x20Found\x20payment:\x20','‚úÖ\x20Marked\x20','Chargeback\x20amount\x20is\x20required\x20and\x20must\x20be\x20positive\x20(amount\x20in\x20USDT)','./telegramBotService','\x20suspended\x20successfully','toUpperCase','suspendUser','AdminService','amountUSDT','split','\x20payments\x20for\x20revenue\x20calculation\x20(PAID/REFUND/CHARGEBACK)','PROCESSING','üí∏\x20Chargeback\x20penalty:\x20','‚ùå\x20Payout\x20not\x20found:\x20','delete','Invalid\x20status.\x20Valid\x20statuses:\x20','slice','‚úÖ\x20Admin\x20statistics\x20generated\x20successfully','‚è≥\x20Awaiting\x20Payout:\x20','PAID','status','reduce','charAt','paymentMethod','setDate','set','isValidGatewayId','push','__esModule','üîÑ\x20Marking\x20payments\x20as\x20paid\x20out\x20for\x20shop\x20','totalAmountAfterCommissionUSDT','get','üìã\x20Getting\x20payouts\x20with\x20filters:','gateway','statusChangedBy','getPayoutStats','amountAfterCommissionUSDT','paidAt','getAllUsers','Payment\x20not\x20found','shop','payoutDelay','getTime','externalPaymentUrl','payout','updatedAt','payment','getPeriodDays','getFullYear','lte','getPaymentById','network','./currencyService','5898ljIvVx','length','usdtErcWallet','log','\x20payments\x20out\x20of\x20','name','default','generateDateRange','count','633405NgOtej','notes','üìã\x20Getting\x20payments\x20with\x20filters:','calculateAmountAfterCommission','üìä\x20Found\x20','üìà\x20Average\x20payment:\x20','sourceCurrency','./userService','gatewaySettings','createdAt','ceil','convertToUSDT','getAllPayments','FAILED','90d','shopUrl','getMonth','updateUser','customerName','gatewayOrderId','userService','\x20deleted\x20successfully','bankId','\x20total','PENDING','toFixed','gatewayPaymentId','insensitive','chargebackAmount','üí∞\x20Available\x20Balance:\x20','adminNotes','includes','toISOString','../types/gateway','customerEmail','getGatewayNameById','create','thisMonth','SUSPENDED','activateUser','üìÖ\x20This\x20Month:\x20','üîç\x20Getting\x20payment\x20by\x20ID:\x20','\x20USDT\x20(penalty\x20amount)','updateMany','‚úÖ\x20Payout\x20created\x20successfully:\x20','shopId','has','isEligibleForPayout','Failed\x20to\x20send\x20Telegram\x20payout\x20notification:','all','Shop\x20is\x20not\x20active','findMany','\x20USDT\x20(—Ç–æ–ª—å–∫–æ\x20PAID\x20–ø–ª–∞—Ç–µ–∂–∏)','3045915RwNsCB','markPaymentsAsPaidOut','join','üìã\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','update','EXPIRED','deleteUser'];a33_0x495d=function(){return _0x1d6276;};return a33_0x495d();}