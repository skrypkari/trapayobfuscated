'use strict';function a35_0x59e0(){const _0x3f6c4e=['amount','📊\x20Payment\x20','findUnique','\x20\x20\x20🌐\x20IP:\x20','totalPayments','totalTurnover','turnover','\x20USDT\x20(+','currencyService','dateFrom','customerUa','availableBalance','853868XDJwNs','9KvAqNA','toString','create','includes','month','week','\x20balance\x20updated:\x20','getGatewayDisplayName','error','round','dailyRevenue','\x20\x20\x20Successful\x20payments:\x20','__esModule','parse','\x20USDT\x20for\x20payment\x20on\x20','get','CoinToPay','✅\x20Payout\x20created:\x20','split','🔍\x20Direct\x20payment\x20check\x20for\x20ID\x20\x22','🔍\x20Search\x20results:\x20','not\x20set','log','stringify','📊\x20Total\x20payments\x20(all\x20statuses):\x20','updatedAt','getAllPayments','📊\x20First\x20payment\x20gateway:\x20','NOT\x20FOUND','\x20total','customerEmail','gatewayEarnings','bankId','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','\x20USDT)','setDate','2604495pSwoHL','🔍\x20Admin\x20search\x20query:\x20\x22','telegram','customerCountry','💰\x20Payment\x20','periodFrom','\x20payments\x20found','./currencyService','\x20\x20\x20Shop:\x20','totalPaidOut','usdtPolygonWallet','\x20USDT\x20for\x20','deletePayout','\x20\x20\x20Name:\x20','toFixed','\x20USDT\x20(','\x20\x20\x20💰\x20Total\x20payout:\x20','\x20\x20\x20Total\x20payments:\x20','generateDailyStatistics','periodTo','period','SUSPENDED','\x20USDT,\x20Requested:\x20','lte','password','awaitingPayout','Rapyd','📊\x20[ADMIN]\x20Processing\x20','../types/gateway','__importDefault','createUser','paymentsCount','290250suaicT','\x20to\x20name\x20','getWalletAddress','paidAt','values','createdAt','findMany','📊\x20All-time\x20statistics\x20from\x20first\x20payment:\x20','\x20\x20\x20Current\x20balance:\x20','reduce','merchantEarningsUSDT','\x20USDT\x20total','\x20became\x20PAID:\x20+','wallets','3684IgMDMX','💰\x20Shop\x20','shopId','test_gateway','getMonth','chargebackAmount','PAID','Plisio','admin','\x20paid\x20payments\x20for\x20analysis','50egdDOg','hex','test','INACTIVE','\x20USDT\x20(-','revenue','8052176Vcdmdo','turnoverUSDT','🔍\x20Admin\x20getAllPayments\x20sorting:\x20','usdcPolygonWallet','customerName','\x20\x20\x20Total\x20paid\x20out:\x20','asc','aggregate','averageCheckUSDT','commission','totalPayout','\x20(direct\x20amountUSDT)','FOUND','Insufficient\x20balance.\x20Available:\x20','📊\x20Merchants\x20awaiting\x20payout:\x20','randomBytes',',\x20gateway=','4397hfwjJW','\x20balance\x20updated:','⚠️\x20[DAILY]\x20Failed\x20to\x20convert\x20','📊\x20[DAILY]\x20Processed\x20','gte','💰\x20[DAILY]\x20Added\x20','\x20\x20\x20Current\x20total\x20paid\x20out:\x20',',\x20orderID=','keys','formatNetworkName','💰\x20Creating\x20payout\x20for\x20shop\x20','status','USDC\x20Polygon','\x20to\x20','gateway','🔄\x20Admin\x20updating\x20payment\x20','📋\x20Payment\x20details:\x20ID=','totalCommissionRate','10339GQxetW','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','📊\x20Conversion\x20rate\x20calculation:','merchantEarnings','orderId','amountUSDT','dailyPayments','CHARGEBACK','\x20USDT\x20(same\x20as\x20awaiting)','30d','gatewaySettings','customerIp','AdminService','\x20\x20\x20Balance:\x20','crypto','\x20items','remitterIban','\x20\x20\x20Payout\x20amount:\x20','getTime','KLYME\x20EU','paymentGateways','updateCustomerData','name','toLowerCase','count','Payment\x20not\x20found','all','getMerchantStatistics','shop','\x20\x20\x20Parsed\x20gatewaySettings:','createPayout','gateways','\x20as-is','convertToUSDT','map','USDT\x20Polygon','Username\x20already\x20exists','usdtTrcWallet','\x20\x20\x20🖥️\x20User\x20Agent:\x20','\x20\x20\x20📈\x20Conversion\x20rate:\x20','\x20payments\x20for\x20daily\x20statistics','whiteUrl','getMerchantsAwaitingPayout','date','Error\x20processing\x20payment\x20','getPaymentById','externalPaymentUrl','\x20\x20\x20Gateway\x20key\x20found:\x20','balance','cardLast4','not\x20found','\x20payments,\x20returning\x20','🔍\x20Admin\x20getAllPayments\x20query\x20filters:','getSystemStatistics','dateTo','push','getFullYear','Noda','ceil','statusChangedAt','localeCompare','bcryptjs','adminNotes','groupBy','defineProperty','alltime','merchantUrl','null','getDate','gatewayOrderId','✅\x20Successful\x20payments:\x20','forEach','\x20\x20\x20🌍\x20Country:\x20','🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','\x20\x20\x20💵\x20Available\x20balance:\x20','\x20->\x20','pendingUrl','414GSdgbb','$transaction','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','updatePaymentStatus','string','paidOutUSDT',',\x20gatewayOrderID=','length','username','🔍\x20Admin\x20payments\x20filter:\x20Converting\x20gateway\x20ID\x20','REFUND','📊\x20Shop\x20info\x20for\x20','default','network','publicKey','\x20\x20\x20📅\x20This\x20month:\x20','getUserById','txUrls','suspendUser','year','usdtErcWallet','📊\x20Payout\x20statistics\x20calculated:','currency','notes','custom','2020-01-01','remitterName','\x20\x20\x20💰\x20Total\x20turnover:\x20','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','insensitive','toUpperCase','find','📊\x20[ADMIN]\x20Status\x20breakdown:','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','Amer\x20Master','toISOString','pk_','paymentMethod','21750828XFrxgt','Telegram\x20username\x20already\x20exists','📊\x20Merchant\x20statistics\x20calculated:','payment','desc','set','💸\x20CHARGEBACK\x20penalty:\x20-','findFirst','telegramId','💰\x20Current\x20shop\x20balance:\x20','\x20status:\x20','getAllPayouts','payout','ACTIVE','fullName','\x20USDT','averageCommissionRate','COMPLETED','_sum','txid','update','💰\x20Found\x20','failureMessage','commissionUSDT',',\x20ID:\x20','delete','💱\x20[DAILY]\x20Converted\x20','\x20USDT\x20from\x20balance','📊\x20[DAILY]\x20Total\x20revenue\x20processed:\x20','shopUrl','\x20\x20\x20Raw\x20gatewaySettings:\x20','hash','USDT\x20ERC20','\x20\x20\x20Username:\x20','📊\x20[ADMIN]\x20Period:\x20'];a35_0x59e0=function(){return _0x3f6c4e;};return a35_0x59e0();}const a35_0xdeefb2=a35_0x1877;(function(_0x5036b2,_0x3affbe){const _0x15311a=a35_0x1877,_0x5d5c74=_0x5036b2();while(!![]){try{const _0x17a4b8=-parseInt(_0x15311a(0x1fa))/0x1*(-parseInt(_0x15311a(0x1e3))/0x2)+-parseInt(_0x15311a(0x187))/0x3*(-parseInt(_0x15311a(0x186))/0x4)+parseInt(_0x15311a(0x1ab))/0x5+-parseInt(_0x15311a(0x1d9))/0x6*(parseInt(_0x15311a(0x20c))/0x7)+parseInt(_0x15311a(0x1e9))/0x8+parseInt(_0x15311a(0x131))/0x9*(parseInt(_0x15311a(0x1cb))/0xa)+-parseInt(_0x15311a(0x157))/0xb;if(_0x17a4b8===_0x3affbe)break;else _0x5d5c74['push'](_0x5d5c74['shift']());}catch(_0x5e2b0e){_0x5d5c74['push'](_0x5d5c74['shift']());}}}(a35_0x59e0,0xb1e5f));var __importDefault=this&&this[a35_0xdeefb2(0x1c8)]||function(_0x54831e){return _0x54831e&&_0x54831e['__esModule']?_0x54831e:{'default':_0x54831e};};Object[a35_0xdeefb2(0x124)](exports,a35_0xdeefb2(0x193),{'value':!![]}),exports[a35_0xdeefb2(0xf0)]=void 0x0;const database_1=__importDefault(require('../config/database')),bcryptjs_1=__importDefault(require(a35_0xdeefb2(0x121))),crypto_1=__importDefault(require(a35_0xdeefb2(0xf2))),currencyService_1=require(a35_0xdeefb2(0x1b2));class AdminService{async['getPayoutStats'](){const _0x4c43b6=a35_0xdeefb2;console[_0x4c43b6(0x19d)]('📊\x20Calculating\x20payout\x20statistics...');const _0x2aa151=await database_1['default'][_0x4c43b6(0x100)][_0x4c43b6(0x1f0)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x4c43b6(0x164)}}),_0x35d11a=new Date(),_0x27e247=new Date(_0x35d11a[_0x4c43b6(0x11c)](),_0x35d11a[_0x4c43b6(0x1dd)](),0x1),_0x5d6c02=new Date(_0x35d11a[_0x4c43b6(0x11c)](),_0x35d11a[_0x4c43b6(0x1dd)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x5836dd=await database_1['default']['payout'][_0x4c43b6(0x1f0)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x27e247,'lte':_0x5d6c02},'status':_0x4c43b6(0x168)}}),_0x1ddc29=_0x2aa151[_0x4c43b6(0x169)][_0x4c43b6(0x1b4)]||0x0,_0x288aa1=_0x2aa151[_0x4c43b6(0x169)]['balance']||0x0,_0x42e63d=_0x5836dd['_sum'][_0x4c43b6(0x17a)]||0x0,_0x177949={'totalPayout':Math[_0x4c43b6(0x190)](_0x1ddc29*0x64)/0x64,'awaitingPayout':Math[_0x4c43b6(0x190)](_0x288aa1*0x64)/0x64,'thisMonth':Math['round'](_0x42e63d*0x64)/0x64,'availableBalance':Math[_0x4c43b6(0x190)](_0x288aa1*0x64)/0x64};return console[_0x4c43b6(0x19d)](_0x4c43b6(0x146)),console[_0x4c43b6(0x19d)](_0x4c43b6(0x1bb)+_0x177949[_0x4c43b6(0x1f3)]+'\x20USDT\x20(total\x20paid\x20to\x20merchants)'),console[_0x4c43b6(0x19d)]('\x20\x20\x20⏳\x20Awaiting\x20payout:\x20'+_0x177949[_0x4c43b6(0x1c4)]+'\x20USDT\x20(total\x20merchant\x20balances)'),console[_0x4c43b6(0x19d)](_0x4c43b6(0x12e)+_0x177949[_0x4c43b6(0x185)]+_0x4c43b6(0x214)),console[_0x4c43b6(0x19d)](_0x4c43b6(0x140)+_0x177949['thisMonth']+_0x4c43b6(0x166)),_0x177949;}async[a35_0xdeefb2(0xf9)](_0x5decaf,_0x5162ae){const _0x5990a3=a35_0xdeefb2;console['log'](_0x5990a3(0x1a8)+_0x5decaf+':',_0x5162ae);const _0x145a3c=await database_1[_0x5990a3(0x13d)][_0x5990a3(0x15a)][_0x5990a3(0x17c)]({'where':{'id':_0x5decaf},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x145a3c)throw new Error(_0x5990a3(0xfd));const _0x439c19={};_0x5162ae[_0x5990a3(0x1ae)]!==undefined&&(_0x439c19[_0x5990a3(0x1ae)]=_0x5162ae[_0x5990a3(0x1ae)]||null);_0x5162ae['customerIp']!==undefined&&(_0x439c19['customerIp']=_0x5162ae['customerIp']||null);_0x5162ae['customerUa']!==undefined&&(_0x439c19[_0x5990a3(0x184)]=_0x5162ae[_0x5990a3(0x184)]||null);const _0x35fde5=await database_1['default']['payment'][_0x5990a3(0x16b)]({'where':{'id':_0x5decaf},'data':{..._0x439c19,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x5990a3(0x19d)]('✅\x20Customer\x20data\x20updated\x20for\x20payment\x20'+_0x5decaf),console[_0x5990a3(0x19d)](_0x5990a3(0x12c)+_0x145a3c[_0x5990a3(0x1ae)]+_0x5990a3(0x12f)+_0x35fde5[_0x5990a3(0x1ae)]),console[_0x5990a3(0x19d)](_0x5990a3(0x17d)+_0x145a3c[_0x5990a3(0xef)]+'\x20->\x20'+_0x35fde5[_0x5990a3(0xef)]),console['log'](_0x5990a3(0x10a)+(_0x145a3c[_0x5990a3(0x184)]?_0x5990a3(0x15c):_0x5990a3(0x19c))+_0x5990a3(0x12f)+(_0x35fde5['customerUa']?_0x5990a3(0x15c):_0x5990a3(0x19c))),_0x35fde5;}async[a35_0xdeefb2(0x119)](_0x3c32f1){const _0x289e07=a35_0xdeefb2,_0x10c729=new Date();let _0x26556c;switch(_0x3c32f1){case'7d':_0x26556c=new Date(_0x10c729[_0x289e07(0xf6)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x289e07(0x215):_0x26556c=new Date(_0x10c729[_0x289e07(0xf6)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'90d':_0x26556c=new Date(_0x10c729[_0x289e07(0xf6)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case'all':case _0x289e07(0x125):case'lifetime':const _0x1f9c82=await database_1[_0x289e07(0x13d)][_0x289e07(0x15a)][_0x289e07(0x15e)]({'where':{'gateway':{'not':_0x289e07(0x1dc)}},'orderBy':{'createdAt':_0x289e07(0x1ef)},'select':{'createdAt':!![]}});_0x26556c=_0x1f9c82?_0x1f9c82['createdAt']:new Date(0x0),console[_0x289e07(0x19d)]('📊\x20All-time\x20statistics\x20from\x20first\x20payment:\x20'+_0x26556c['toISOString']());break;default:_0x26556c=new Date(_0x10c729['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x54928e,_0x5e8453,_0x454782,_0x3bad52,_0x2f09de,_0x56f453,_0x2e5b54]=await Promise[_0x289e07(0xfe)]([database_1[_0x289e07(0x13d)][_0x289e07(0x100)][_0x289e07(0xfc)](),database_1[_0x289e07(0x13d)][_0x289e07(0x100)][_0x289e07(0xfc)]({'where':{'status':'ACTIVE'}}),database_1[_0x289e07(0x13d)][_0x289e07(0x15a)][_0x289e07(0xfc)]({'where':{'createdAt':{'gte':_0x26556c},'gateway':{'not':_0x289e07(0x1dc)}}}),database_1[_0x289e07(0x13d)][_0x289e07(0x15a)][_0x289e07(0xfc)]({'where':{'status':_0x289e07(0x1df),'createdAt':{'gte':_0x26556c},'gateway':{'not':_0x289e07(0x1dc)}}}),database_1[_0x289e07(0x13d)][_0x289e07(0x15a)][_0x289e07(0x1d1)]({'where':{'status':'PAID','createdAt':{'gte':_0x26556c},'gateway':{'not':_0x289e07(0x1dc)}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x289e07(0x13d)][_0x289e07(0x15a)][_0x289e07(0x1d1)]({'where':{'gateway':{'not':_0x289e07(0x1dc)}},'take':0xa,'orderBy':{'createdAt':_0x289e07(0x15b)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x289e07(0x15a)][_0x289e07(0x1d1)]({'where':{'createdAt':{'gte':_0x26556c},'gateway':{'not':'test_gateway'}},'select':{'status':!![],'amountUSDT':!![],'amount':!![],'currency':!![],'createdAt':!![]},'orderBy':{'createdAt':'asc'}})]);let _0x373e5c=0x0;for(const _0x110d87 of _0x2f09de){if(_0x110d87[_0x289e07(0x211)])_0x373e5c+=_0x110d87[_0x289e07(0x211)];else{const _0x57969a=await currencyService_1[_0x289e07(0x182)]['convertToUSDT'](_0x110d87[_0x289e07(0x17a)],_0x110d87['currency']);_0x373e5c+=_0x57969a;}}console[_0x289e07(0x19d)](_0x289e07(0x1c6)+_0x2e5b54[_0x289e07(0x138)]+_0x289e07(0x10c)),console[_0x289e07(0x19d)](_0x289e07(0x179)+_0x26556c[_0x289e07(0x154)]()[_0x289e07(0x199)]('T')[0x0]+_0x289e07(0x207)+_0x10c729[_0x289e07(0x154)]()[_0x289e07(0x199)]('T')[0x0]);const _0x27a0fa=_0x2e5b54[_0x289e07(0x1d4)]((_0x328972,_0x134419)=>{return _0x328972[_0x134419['status']]=(_0x328972[_0x134419['status']]||0x0)+0x1,_0x328972;},{});console[_0x289e07(0x19d)](_0x289e07(0x151),_0x27a0fa);const _0x514603=await this['generateDailyStatistics'](_0x2e5b54,_0x26556c,_0x10c729),_0x14745a=_0x454782>0x0?_0x3bad52/_0x454782*0x64:0x0;return{'totalShops':_0x54928e,'activeShops':_0x5e8453,'totalPayments':_0x454782,'successfulPayments':_0x3bad52,'totalRevenue':Math[_0x289e07(0x190)](_0x373e5c*0x64)/0x64,'conversionRate':Math['round'](_0x14745a*0x64)/0x64,'dailyRevenue':_0x514603[_0x289e07(0x191)],'dailyPayments':_0x514603[_0x289e07(0x212)],'recentPayments':_0x56f453[_0x289e07(0x106)](_0x1a941a=>({'id':_0x1a941a['id'],'amount':_0x1a941a['amount'],'currency':_0x1a941a[_0x289e07(0x147)],'status':_0x1a941a[_0x289e07(0x205)],'gateway':_0x1a941a[_0x289e07(0x208)],'shop':_0x1a941a['shop'],'createdAt':_0x1a941a[_0x289e07(0x1d0)]}))};}async[a35_0xdeefb2(0x1bd)](_0x409e94,_0x564206,_0x5e040e){const _0x3c272d=a35_0xdeefb2,_0x435db8=new Map(),_0x4e8113=new Date(_0x564206);while(_0x4e8113<=_0x5e040e){const _0x24d1f1=_0x4e8113[_0x3c272d(0x154)]()[_0x3c272d(0x199)]('T')[0x0];_0x435db8[_0x3c272d(0x15c)](_0x24d1f1,{'revenue':0x0,'count':0x0}),_0x4e8113[_0x3c272d(0x1aa)](_0x4e8113[_0x3c272d(0x128)]()+0x1);}let _0x28a378=0x0,_0x4047a7=0x0;for(const _0x2fa6bd of _0x409e94){const _0x4ca3d5=_0x2fa6bd[_0x3c272d(0x1d0)]['toISOString']()[_0x3c272d(0x199)]('T')[0x0],_0x204ab9=_0x435db8[_0x3c272d(0x196)](_0x4ca3d5);if(_0x204ab9){_0x204ab9[_0x3c272d(0xfc)]+=0x1;if(_0x2fa6bd[_0x3c272d(0x205)]===_0x3c272d(0x1df)){_0x28a378++;if(_0x2fa6bd['amountUSDT'])_0x204ab9['revenue']+=_0x2fa6bd[_0x3c272d(0x211)],_0x4047a7+=_0x2fa6bd['amountUSDT'],console[_0x3c272d(0x19d)](_0x3c272d(0x1ff)+_0x2fa6bd['amountUSDT']+_0x3c272d(0x1b6)+_0x4ca3d5+_0x3c272d(0x1f4));else try{const _0x2998ec=await currencyService_1['currencyService'][_0x3c272d(0x105)](_0x2fa6bd[_0x3c272d(0x17a)],_0x2fa6bd['currency']);_0x204ab9['revenue']+=_0x2998ec,_0x4047a7+=_0x2998ec,console[_0x3c272d(0x19d)](_0x3c272d(0x171)+_0x2fa6bd[_0x3c272d(0x17a)]+'\x20'+_0x2fa6bd[_0x3c272d(0x147)]+_0x3c272d(0x207)+_0x2998ec+_0x3c272d(0x195)+_0x4ca3d5);}catch(_0x48c8ce){console['warn'](_0x3c272d(0x1fc)+_0x2fa6bd['amount']+'\x20'+_0x2fa6bd['currency']+'\x20for\x20payment\x20on\x20'+_0x4ca3d5+':',_0x48c8ce);}}}}console[_0x3c272d(0x19d)](_0x3c272d(0x1fd)+_0x28a378+'\x20PAID\x20payments\x20out\x20of\x20'+_0x409e94[_0x3c272d(0x138)]+_0x3c272d(0x1a4)),console[_0x3c272d(0x19d)](_0x3c272d(0x173)+_0x4047a7+'\x20USDT');const _0x4506fc=[],_0x52fbb3=[];for(const [_0x296129,_0x370de0]of _0x435db8){_0x4506fc[_0x3c272d(0x11b)]({'date':_0x296129,'amount':Math[_0x3c272d(0x190)](_0x370de0[_0x3c272d(0x1e8)]*0x64)/0x64}),_0x52fbb3[_0x3c272d(0x11b)]({'date':_0x296129,'count':_0x370de0[_0x3c272d(0xfc)]});}return{'dailyRevenue':_0x4506fc,'dailyPayments':_0x52fbb3};}async[a35_0xdeefb2(0xff)](_0x137afb){const _0x4b17fc=a35_0xdeefb2;console[_0x4b17fc(0x19d)](_0x4b17fc(0x152),_0x137afb);let _0x48db78,_0x2b3bdd=new Date();if(_0x137afb[_0x4b17fc(0x1bf)]===_0x4b17fc(0x149)&&_0x137afb[_0x4b17fc(0x183)]&&_0x137afb[_0x4b17fc(0x11a)])_0x48db78=new Date(_0x137afb['dateFrom']),_0x2b3bdd=new Date(_0x137afb['dateTo']);else{const _0x4f48f5=new Date();switch(_0x137afb['period']){case _0x4b17fc(0x18c):_0x48db78=new Date(_0x4f48f5[_0x4b17fc(0xf6)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x4b17fc(0x18b):_0x48db78=new Date(_0x4f48f5['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x4b17fc(0x144):_0x48db78=new Date(_0x4f48f5[_0x4b17fc(0xf6)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case'all':case _0x4b17fc(0x125):case'lifetime':const _0x31d039=_0x137afb[_0x4b17fc(0x1db)]?{'gateway':{'not':_0x4b17fc(0x1dc)},'shopId':_0x137afb[_0x4b17fc(0x1db)]}:{'gateway':{'not':'test_gateway'}},_0x83ec24=await database_1[_0x4b17fc(0x13d)][_0x4b17fc(0x15a)]['findFirst']({'where':_0x31d039,'orderBy':{'createdAt':_0x4b17fc(0x1ef)},'select':{'createdAt':!![]}});_0x48db78=_0x83ec24?_0x83ec24[_0x4b17fc(0x1d0)]:new Date(_0x4b17fc(0x14a)),console['log'](_0x4b17fc(0x1d2)+_0x48db78['toISOString']());break;default:const _0x4da8b8=await database_1[_0x4b17fc(0x13d)]['payment'][_0x4b17fc(0x15e)]({'where':{'gateway':{'not':'test_gateway'}},'orderBy':{'createdAt':'asc'},'select':{'createdAt':!![]}});_0x48db78=_0x4da8b8?_0x4da8b8[_0x4b17fc(0x1d0)]:new Date('2020-01-01');break;}}console[_0x4b17fc(0x19d)]('📅\x20Period:\x20'+_0x48db78[_0x4b17fc(0x154)]()+'\x20to\x20'+_0x2b3bdd['toISOString']());if(_0x137afb[_0x4b17fc(0x1db)]){const _0x16970e=await database_1['default'][_0x4b17fc(0x100)][_0x4b17fc(0x17c)]({'where':{'id':_0x137afb[_0x4b17fc(0x1db)]},'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}});console[_0x4b17fc(0x19d)](_0x4b17fc(0x13c)+_0x137afb[_0x4b17fc(0x1db)]+':'),console[_0x4b17fc(0x19d)](_0x4b17fc(0x1b8)+_0x16970e?.['name']),console[_0x4b17fc(0x19d)](_0x4b17fc(0x178)+_0x16970e?.[_0x4b17fc(0x139)]),console[_0x4b17fc(0x19d)](_0x4b17fc(0x175)+(_0x16970e?.[_0x4b17fc(0x216)]||_0x4b17fc(0x127)));if(_0x16970e?.[_0x4b17fc(0x216)])try{const _0x34548e=JSON[_0x4b17fc(0x194)](_0x16970e[_0x4b17fc(0x216)]);console[_0x4b17fc(0x19d)]('\x20\x20\x20Parsed\x20gatewaySettings:',_0x34548e),console[_0x4b17fc(0x19d)]('\x20\x20\x20Commission\x20from\x20shop\x20settings:\x20'+(_0x34548e[_0x4b17fc(0x1f2)]||'not\x20found'));}catch(_0x514dac){console[_0x4b17fc(0x19d)]('\x20\x20\x20Failed\x20to\x20parse\x20gatewaySettings:\x20'+_0x514dac);}}const _0x52d926={'status':_0x4b17fc(0x1df),'gateway':{'not':'test_gateway'},'paidAt':{'gte':_0x48db78,'lte':_0x2b3bdd}};_0x137afb[_0x4b17fc(0x1db)]&&(_0x52d926['shopId']=_0x137afb[_0x4b17fc(0x1db)]);const _0x1ee66b=await database_1[_0x4b17fc(0x13d)]['payment'][_0x4b17fc(0x1d1)]({'where':_0x52d926,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x4b17fc(0x19d)](_0x4b17fc(0x16c)+_0x1ee66b['length']+_0x4b17fc(0x1e2));const _0x6451aa={'gateway':{'not':_0x4b17fc(0x1dc)},'createdAt':{'gte':_0x48db78,'lte':_0x2b3bdd}};_0x137afb[_0x4b17fc(0x1db)]&&(_0x6451aa[_0x4b17fc(0x1db)]=_0x137afb[_0x4b17fc(0x1db)]);const _0xfa2b06=await database_1[_0x4b17fc(0x13d)][_0x4b17fc(0x15a)][_0x4b17fc(0xfc)]({'where':_0x6451aa});console[_0x4b17fc(0x19d)](_0x4b17fc(0x19f)+_0xfa2b06),console[_0x4b17fc(0x19d)](_0x4b17fc(0x12a)+_0x1ee66b[_0x4b17fc(0x138)]);let _0x4fe2f3=0x0,_0x4fa5db=0x0,_0x41b476=0x0;const _0xd717f3={},_0x2a6fa0={},_0x40c535={};for(const _0xe27d1c of _0x1ee66b){try{const _0x5cac76=await currencyService_1[_0x4b17fc(0x182)]['convertToUSDT'](_0xe27d1c[_0x4b17fc(0x17a)],_0xe27d1c['currency']);let _0x28b018={};if(_0xe27d1c[_0x4b17fc(0x100)][_0x4b17fc(0x216)])try{_0x28b018=JSON['parse'](_0xe27d1c[_0x4b17fc(0x100)]['gatewaySettings']);}catch(_0x59619c){console['error']('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0xe27d1c[_0x4b17fc(0x1db)]+':',_0x59619c);}let _0x333165=0xa;const _0x4818ee=Object[_0x4b17fc(0x202)](_0x28b018)[_0x4b17fc(0x150)](_0x4ea653=>_0x4ea653[_0x4b17fc(0xfb)]()===_0xe27d1c[_0x4b17fc(0x208)][_0x4b17fc(0xfb)]());_0x4818ee&&_0x28b018[_0x4818ee]&&_0x28b018[_0x4818ee][_0x4b17fc(0x1f2)]&&(_0x333165=_0x28b018[_0x4818ee][_0x4b17fc(0x1f2)]);console[_0x4b17fc(0x19d)](_0x4b17fc(0x17b)+_0xe27d1c['id']+'\x20commission\x20analysis:'),console[_0x4b17fc(0x19d)](_0x4b17fc(0x1b3)+_0xe27d1c[_0x4b17fc(0x100)][_0x4b17fc(0xfa)]+'\x20('+_0xe27d1c[_0x4b17fc(0x1db)]+')'),console[_0x4b17fc(0x19d)]('\x20\x20\x20Gateway:\x20'+_0xe27d1c[_0x4b17fc(0x208)]),console[_0x4b17fc(0x19d)](_0x4b17fc(0x175)+(_0xe27d1c[_0x4b17fc(0x100)]['gatewaySettings']||_0x4b17fc(0x127))),console[_0x4b17fc(0x19d)](_0x4b17fc(0x101),_0x28b018),console[_0x4b17fc(0x19d)](_0x4b17fc(0x113)+(_0x4818ee||_0x4b17fc(0x116))),console['log']('\x20\x20\x20Commission\x20from\x20settings:\x20'+(_0x4818ee&&_0x28b018[_0x4818ee]?_0x28b018[_0x4818ee]['commission']:'not\x20found')),console[_0x4b17fc(0x19d)]('\x20\x20\x20Final\x20commission\x20used:\x20'+_0x333165+'%');const _0x1ea757=_0x5cac76*(_0x333165/0x64),_0x1591ad=_0x5cac76-_0x1ea757;_0x4fe2f3+=_0x5cac76,_0x4fa5db+=_0x1591ad,_0x41b476+=_0x1ea757;!_0xd717f3[_0xe27d1c[_0x4b17fc(0x208)]]&&(_0xd717f3[_0xe27d1c[_0x4b17fc(0x208)]]={'gateway':_0xe27d1c[_0x4b17fc(0x208)],'gatewayDisplayName':this[_0x4b17fc(0x18e)](_0xe27d1c['gateway']),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0xd717f3[_0xe27d1c[_0x4b17fc(0x208)]][_0x4b17fc(0x1ca)]++,_0xd717f3[_0xe27d1c[_0x4b17fc(0x208)]]['turnoverUSDT']+=_0x5cac76,_0xd717f3[_0xe27d1c[_0x4b17fc(0x208)]][_0x4b17fc(0x16e)]+=_0x1ea757,_0xd717f3[_0xe27d1c[_0x4b17fc(0x208)]][_0x4b17fc(0x1d5)]+=_0x1591ad,_0xd717f3[_0xe27d1c['gateway']][_0x4b17fc(0x20b)]+=_0x333165;!_0x137afb[_0x4b17fc(0x1db)]&&(!_0x2a6fa0[_0xe27d1c[_0x4b17fc(0x1db)]]&&(_0x2a6fa0[_0xe27d1c[_0x4b17fc(0x1db)]]={'shopId':_0xe27d1c[_0x4b17fc(0x1db)],'shopName':_0xe27d1c[_0x4b17fc(0x100)][_0x4b17fc(0xfa)],'shopUsername':_0xe27d1c[_0x4b17fc(0x100)][_0x4b17fc(0x139)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x2a6fa0[_0xe27d1c['shopId']][_0x4b17fc(0x1ca)]++,_0x2a6fa0[_0xe27d1c[_0x4b17fc(0x1db)]]['turnoverUSDT']+=_0x5cac76,_0x2a6fa0[_0xe27d1c['shopId']]['commissionUSDT']+=_0x1ea757,_0x2a6fa0[_0xe27d1c[_0x4b17fc(0x1db)]][_0x4b17fc(0x1d5)]+=_0x1591ad);const _0x10e399=_0xe27d1c[_0x4b17fc(0x1ce)][_0x4b17fc(0x154)]()['split']('T')[0x0];!_0x40c535[_0x10e399]&&(_0x40c535[_0x10e399]={'date':_0x10e399,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x40c535[_0x10e399][_0x4b17fc(0x180)]+=_0x5cac76,_0x40c535[_0x10e399]['merchantEarnings']+=_0x1591ad,_0x40c535[_0x10e399]['gatewayEarnings']+=_0x1ea757,_0x40c535[_0x10e399][_0x4b17fc(0x1ca)]++;}catch(_0x17a46e){console[_0x4b17fc(0x18f)](_0x4b17fc(0x110)+_0xe27d1c['id']+':',_0x17a46e);}}Object[_0x4b17fc(0x1cf)](_0xd717f3)[_0x4b17fc(0x12b)](_0x268201=>{const _0x52f056=_0x4b17fc;_0x268201[_0x52f056(0x167)]=_0x268201[_0x52f056(0x1ca)]>0x0?_0x268201[_0x52f056(0x20b)]/_0x268201[_0x52f056(0x1ca)]:0x0,delete _0x268201[_0x52f056(0x20b)];}),Object[_0x4b17fc(0x1cf)](_0x2a6fa0)[_0x4b17fc(0x12b)](_0x526a93=>{const _0x1db582=_0x4b17fc;_0x526a93[_0x1db582(0x1f1)]=_0x526a93[_0x1db582(0x1ca)]>0x0?_0x526a93['turnoverUSDT']/_0x526a93['paymentsCount']:0x0;});let _0x4ff882=0x0;if(_0x137afb[_0x4b17fc(0x1db)]){const _0x4e05f6=await database_1[_0x4b17fc(0x13d)]['payout'][_0x4b17fc(0x1d1)]({'where':{'shopId':_0x137afb[_0x4b17fc(0x1db)],'status':_0x4b17fc(0x168),'createdAt':{'gte':_0x48db78,'lte':_0x2b3bdd}},'select':{'amount':!![]}});_0x4ff882=_0x4e05f6[_0x4b17fc(0x1d4)]((_0x10b099,_0x3bf5e4)=>_0x10b099+_0x3bf5e4[_0x4b17fc(0x17a)],0x0);}const _0x5cc023=_0xfa2b06,_0x553be7=_0x1ee66b['length'],_0x1b839f=_0x553be7>0x0?_0x4fe2f3/_0x553be7:0x0,_0x248e6f=_0x5cc023>0x0?_0x553be7/_0x5cc023*0x64:0x0;console['log'](_0x4b17fc(0x20e)),console[_0x4b17fc(0x19d)](_0x4b17fc(0x1bc)+_0x5cc023),console[_0x4b17fc(0x19d)](_0x4b17fc(0x192)+_0x553be7),console['log']('\x20\x20\x20Conversion\x20rate:\x20'+_0x248e6f[_0x4b17fc(0x1b9)](0x2)+'%');const _0x36b183=Math[_0x4b17fc(0x11e)]((_0x2b3bdd[_0x4b17fc(0xf6)]()-_0x48db78['getTime']())/(0x3e8*0x3c*0x3c*0x18)),_0x5e66e3={'totalTurnover':Math[_0x4b17fc(0x190)](_0x4fe2f3*0x64)/0x64,'merchantEarnings':Math[_0x4b17fc(0x190)](_0x4fa5db*0x64)/0x64,'gatewayEarnings':Math[_0x4b17fc(0x190)](_0x41b476*0x64)/0x64,'totalPaidOut':Math[_0x4b17fc(0x190)](_0x4ff882*0x64)/0x64,'averageCheck':Math[_0x4b17fc(0x190)](_0x1b839f*0x64)/0x64,'totalPayments':_0x5cc023,'successfulPayments':_0x553be7,'conversionRate':Math[_0x4b17fc(0x190)](_0x248e6f*0x64)/0x64,'gatewayBreakdown':Object['values'](_0xd717f3)['map'](_0xee413e=>({..._0xee413e,'turnoverUSDT':Math[_0x4b17fc(0x190)](_0xee413e[_0x4b17fc(0x1ea)]*0x64)/0x64,'commissionUSDT':Math[_0x4b17fc(0x190)](_0xee413e[_0x4b17fc(0x16e)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x4b17fc(0x190)](_0xee413e[_0x4b17fc(0x1d5)]*0x64)/0x64,'averageCommissionRate':Math['round'](_0xee413e[_0x4b17fc(0x167)]*0x64)/0x64})),'merchantBreakdown':_0x137afb[_0x4b17fc(0x1db)]?undefined:Object[_0x4b17fc(0x1cf)](_0x2a6fa0)[_0x4b17fc(0x106)](_0x1c90b5=>({..._0x1c90b5,'turnoverUSDT':Math[_0x4b17fc(0x190)](_0x1c90b5[_0x4b17fc(0x1ea)]*0x64)/0x64,'commissionUSDT':Math[_0x4b17fc(0x190)](_0x1c90b5[_0x4b17fc(0x16e)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x4b17fc(0x190)](_0x1c90b5[_0x4b17fc(0x1d5)]*0x64)/0x64,'paidOutUSDT':Math[_0x4b17fc(0x190)](_0x1c90b5[_0x4b17fc(0x136)]*0x64)/0x64,'averageCheckUSDT':Math[_0x4b17fc(0x190)](_0x1c90b5[_0x4b17fc(0x1f1)]*0x64)/0x64})),'dailyData':Object[_0x4b17fc(0x1cf)](_0x40c535)['map'](_0x1fd28d=>({..._0x1fd28d,'turnover':Math['round'](_0x1fd28d[_0x4b17fc(0x180)]*0x64)/0x64,'merchantEarnings':Math['round'](_0x1fd28d[_0x4b17fc(0x20f)]*0x64)/0x64,'gatewayEarnings':Math[_0x4b17fc(0x190)](_0x1fd28d['gatewayEarnings']*0x64)/0x64}))['sort']((_0x22a151,_0x582258)=>_0x22a151[_0x4b17fc(0x10f)][_0x4b17fc(0x120)](_0x582258[_0x4b17fc(0x10f)])),'periodInfo':{'from':_0x48db78,'to':_0x2b3bdd,'periodType':_0x137afb['period']||_0x4b17fc(0x149),'daysCount':_0x36b183}};return console[_0x4b17fc(0x19d)](_0x4b17fc(0x159)),console[_0x4b17fc(0x19d)](_0x4b17fc(0x14c)+_0x5e66e3[_0x4b17fc(0x17f)]+_0x4b17fc(0x166)),console['log'](_0x4b17fc(0x14d)+_0x5e66e3[_0x4b17fc(0x20f)]+_0x4b17fc(0x166)),console[_0x4b17fc(0x19d)](_0x4b17fc(0x20d)+_0x5e66e3[_0x4b17fc(0x1a6)]+_0x4b17fc(0x166)),console['log']('\x20\x20\x20📊\x20Total\x20payments:\x20'+_0x5e66e3[_0x4b17fc(0x17e)]),console[_0x4b17fc(0x19d)]('\x20\x20\x20✅\x20Successful\x20payments:\x20'+_0x5e66e3['successfulPayments']),console[_0x4b17fc(0x19d)](_0x4b17fc(0x10b)+_0x5e66e3['conversionRate']+'%'),_0x5e66e3;}[a35_0xdeefb2(0x18e)](_0x2b5ad7){const _0x57143f=a35_0xdeefb2,_0x5ad8db={'test_gateway':'Test\x20Gateway','plisio':_0x57143f(0x1e0),'rapyd':_0x57143f(0x1c5),'noda':_0x57143f(0x11d),'cointopay':_0x57143f(0x197),'mastercard':_0x57143f(0x153),'klyme_eu':_0x57143f(0xf7),'klyme_gb':'KLYME\x20GB','klyme_de':'KLYME\x20DE'};return _0x5ad8db[_0x2b5ad7]||_0x2b5ad7;}async[a35_0xdeefb2(0x10e)](_0x46bc63){const _0x516659=a35_0xdeefb2,{page:_0x29db97,limit:_0x1ab0f5,minAmount:_0x282db2,search:_0x545f50}=_0x46bc63,_0x483885=(_0x29db97-0x1)*_0x1ab0f5;console[_0x516659(0x19d)](_0x516659(0x133),_0x46bc63);const _0x2b8d7f={'balance':{'gt':0x0},'status':_0x516659(0x164)};_0x282db2&&(_0x2b8d7f[_0x516659(0x114)]['gte']=_0x282db2);_0x545f50&&(_0x2b8d7f['OR']=[{'name':{'contains':_0x545f50,'mode':_0x516659(0x14e)}},{'username':{'contains':_0x545f50,'mode':'insensitive'}}]);const [_0x1bb300,_0x220bda]=await Promise[_0x516659(0xfe)]([database_1[_0x516659(0x13d)][_0x516659(0x100)][_0x516659(0x1d1)]({'where':_0x2b8d7f,'skip':_0x483885,'take':_0x1ab0f5,'orderBy':{'balance':_0x516659(0x15b)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'createdAt':!![]}}),database_1[_0x516659(0x13d)][_0x516659(0x100)][_0x516659(0xfc)]({'where':_0x2b8d7f})]);console[_0x516659(0x19d)](_0x516659(0x16c)+_0x1bb300['length']+'\x20merchants\x20with\x20positive\x20balance');const _0x3e3702=await Promise['all'](_0x1bb300[_0x516659(0x106)](async _0x48e9e8=>{const _0xe39109=_0x516659,[_0x45f487,_0x150ef6,_0x44d355]=await Promise[_0xe39109(0xfe)]([database_1[_0xe39109(0x13d)][_0xe39109(0x15a)]['count']({'where':{'shopId':_0x48e9e8['id'],'status':_0xe39109(0x1df),'amountUSDT':{'not':null}}}),database_1[_0xe39109(0x13d)][_0xe39109(0x15a)]['findFirst']({'where':{'shopId':_0x48e9e8['id'],'status':_0xe39109(0x1df),'amountUSDT':{'not':null}},'orderBy':{'paidAt':_0xe39109(0x1ef)},'select':{'paidAt':!![]}}),database_1[_0xe39109(0x13d)][_0xe39109(0x15a)][_0xe39109(0x123)]({'by':['gateway'],'where':{'shopId':_0x48e9e8['id'],'status':'PAID','amountUSDT':{'not':null}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x3a3dc5=_0x44d355['map'](_0x35b450=>({'gateway':_0x35b450[_0xe39109(0x208)],'count':_0x35b450['_count']['id'],'amountUSDT':_0x35b450['_sum'][_0xe39109(0x211)]||0x0,'amountAfterCommissionUSDT':_0x35b450[_0xe39109(0x169)]['amountUSDT']||0x0,'commission':0x0}));return{'id':_0x48e9e8['id'],'fullName':_0x48e9e8['name'],'username':_0x48e9e8['username'],'telegramId':_0x48e9e8['telegram'],'merchantUrl':_0x48e9e8[_0xe39109(0x174)],'wallets':{'usdtPolygonWallet':_0x48e9e8[_0xe39109(0x1b5)],'usdtTrcWallet':_0x48e9e8[_0xe39109(0x109)],'usdtErcWallet':_0x48e9e8['usdtErcWallet'],'usdcPolygonWallet':_0x48e9e8[_0xe39109(0x1ec)]},'totalAmountUSDT':_0x48e9e8[_0xe39109(0x114)],'totalAmountAfterCommissionUSDT':_0x48e9e8['balance'],'paymentsCount':_0x45f487,'oldestPaymentDate':_0x150ef6?.['paidAt']||_0x48e9e8['createdAt'],'gatewayBreakdown':_0x3a3dc5};})),_0x2c35c7=_0x1bb300[_0x516659(0x1d4)]((_0x313a23,_0x4ce6fc)=>_0x313a23+_0x4ce6fc['balance'],0x0),_0x235eb6=_0x2c35c7;return console[_0x516659(0x19d)](_0x516659(0x1f7)+_0x220bda+'\x20merchants,\x20'+Math[_0x516659(0x190)](_0x235eb6*0x64)/0x64+_0x516659(0x1d6)),{'merchants':_0x3e3702,'pagination':{'page':_0x29db97,'limit':_0x1ab0f5,'total':_0x220bda,'totalPages':Math['ceil'](_0x220bda/_0x1ab0f5)},'summary':{'totalMerchants':_0x220bda,'totalAmountUSDT':Math[_0x516659(0x190)](_0x2c35c7*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x516659(0x190)](_0x235eb6*0x64)/0x64}};}async[a35_0xdeefb2(0x102)](_0x557201){const _0x84f93=a35_0xdeefb2,{shopId:_0x18edf5,amount:_0x5380f4,network:_0x4396a7,notes:_0x4396ea,periodFrom:_0x234c87,periodTo:_0x8e4a6}=_0x557201,_0x286b6c=await database_1['default'][_0x84f93(0x132)](async _0x132ab3=>{const _0x498991=_0x84f93,_0x5d0006=await _0x132ab3[_0x498991(0x100)][_0x498991(0x17c)]({'where':{'id':_0x18edf5},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x5d0006)throw new Error('Shop\x20not\x20found');console['log'](_0x498991(0x204)+_0x5d0006[_0x498991(0x139)]+':'),console[_0x498991(0x19d)](_0x498991(0x1d3)+_0x5d0006[_0x498991(0x114)][_0x498991(0x1b9)](0x6)+_0x498991(0x166)),console[_0x498991(0x19d)](_0x498991(0xf5)+_0x5380f4['toFixed'](0x6)+'\x20USDT'),console[_0x498991(0x19d)](_0x498991(0x200)+_0x5d0006['totalPaidOut']['toFixed'](0x6)+_0x498991(0x166));if(_0x5d0006['balance']<_0x5380f4)throw new Error(_0x498991(0x1f6)+_0x5d0006[_0x498991(0x114)][_0x498991(0x1b9)](0x6)+_0x498991(0x1c1)+_0x5380f4['toFixed'](0x6)+_0x498991(0x166));const _0x293dd9=await _0x132ab3[_0x498991(0x163)][_0x498991(0x189)]({'data':{'shopId':_0x18edf5,'amount':_0x5380f4,'network':_0x4396a7,'status':_0x498991(0x168),'notes':_0x4396ea,'periodFrom':_0x234c87?new Date(_0x234c87):null,'periodTo':_0x8e4a6?new Date(_0x8e4a6):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x2f23cb=_0x5d0006[_0x498991(0x114)]-_0x5380f4,_0x222739=_0x5d0006[_0x498991(0x1b4)]+_0x5380f4;return await _0x132ab3[_0x498991(0x100)][_0x498991(0x16b)]({'where':{'id':_0x18edf5},'data':{'balance':_0x2f23cb,'totalPaidOut':_0x222739}}),console[_0x498991(0x19d)]('💰\x20Shop\x20'+_0x5d0006[_0x498991(0x139)]+_0x498991(0x1fb)),console[_0x498991(0x19d)](_0x498991(0xf1)+_0x5d0006[_0x498991(0x114)][_0x498991(0x1b9)](0x6)+_0x498991(0x12f)+_0x2f23cb['toFixed'](0x6)+_0x498991(0x1e7)+_0x5380f4[_0x498991(0x1b9)](0x6)+')'),console['log'](_0x498991(0x1ee)+_0x5d0006[_0x498991(0x1b4)][_0x498991(0x1b9)](0x6)+_0x498991(0x12f)+_0x222739[_0x498991(0x1b9)](0x6)+_0x498991(0x181)+_0x5380f4['toFixed'](0x6)+')'),{'payout':_0x293dd9,'shop':_0x5d0006};});return console[_0x84f93(0x19d)](_0x84f93(0x198)+_0x286b6c[_0x84f93(0x163)]['id']+'\x20for\x20shop\x20'+_0x286b6c['shop'][_0x84f93(0x139)]+'\x20('+_0x5380f4+_0x84f93(0x1a9)),{'id':_0x286b6c[_0x84f93(0x163)]['id'],'shopId':_0x286b6c[_0x84f93(0x163)][_0x84f93(0x1db)],'shopName':_0x286b6c[_0x84f93(0x100)]['name'],'shopUsername':_0x286b6c[_0x84f93(0x100)][_0x84f93(0x139)],'amount':_0x286b6c[_0x84f93(0x163)][_0x84f93(0x17a)],'network':_0x286b6c[_0x84f93(0x163)]['network'],'status':_0x286b6c[_0x84f93(0x163)][_0x84f93(0x205)],'txid':_0x286b6c[_0x84f93(0x163)][_0x84f93(0x16a)],'notes':_0x286b6c['payout'][_0x84f93(0x148)],'periodFrom':_0x286b6c['payout'][_0x84f93(0x1b0)],'periodTo':_0x286b6c[_0x84f93(0x163)]['periodTo'],'createdAt':_0x286b6c[_0x84f93(0x163)]['createdAt'],'paidAt':_0x286b6c['payout'][_0x84f93(0x1ce)]};}['formatNetworkName'](_0x4807e1){const _0x17dd73=a35_0xdeefb2,_0x29c626={'polygon':_0x17dd73(0x107),'trc20':'USDT\x20TRC20','erc20':_0x17dd73(0x177),'polygon_usdc':_0x17dd73(0x206)};return _0x29c626[_0x4807e1]||_0x4807e1[_0x17dd73(0x14f)]();}['getWalletAddress'](_0x45d6a0,_0x5b9489){const _0x2b60a3=a35_0xdeefb2,_0x13f875={'polygon':_0x2b60a3(0x1b5),'trc20':_0x2b60a3(0x109),'erc20':_0x2b60a3(0x145),'polygon_usdc':_0x2b60a3(0x1ec)},_0x181d44=_0x13f875[_0x5b9489];return _0x181d44?_0x45d6a0[_0x181d44]:null;}async[a35_0xdeefb2(0x162)](_0xad035b){const _0xa937eb=a35_0xdeefb2,{page:_0x5812e6,limit:_0x41e87c,shopId:_0xf22d4f,network:_0x38b94c,dateFrom:_0x453bb5,dateTo:_0x5172c3,search:_0x3d3a1d}=_0xad035b,_0x4ed5c8=(_0x5812e6-0x1)*_0x41e87c,_0xde65ee={};_0xf22d4f&&(_0xde65ee[_0xa937eb(0x1db)]=_0xf22d4f);_0x38b94c&&(_0xde65ee[_0xa937eb(0x13e)]=_0x38b94c);(_0x453bb5||_0x5172c3)&&(_0xde65ee[_0xa937eb(0x1d0)]={},_0x453bb5&&(_0xde65ee[_0xa937eb(0x1d0)][_0xa937eb(0x1fe)]=new Date(_0x453bb5)),_0x5172c3&&(_0xde65ee['createdAt'][_0xa937eb(0x1c2)]=new Date(_0x5172c3)));_0x3d3a1d&&(_0xde65ee['OR']=[{'shop':{'name':{'contains':_0x3d3a1d,'mode':_0xa937eb(0x14e)}}},{'shop':{'username':{'contains':_0x3d3a1d,'mode':_0xa937eb(0x14e)}}},{'notes':{'contains':_0x3d3a1d,'mode':_0xa937eb(0x14e)}}]);const [_0xcadfc1,_0x54927b]=await Promise[_0xa937eb(0xfe)]([database_1[_0xa937eb(0x13d)][_0xa937eb(0x163)][_0xa937eb(0x1d1)]({'where':_0xde65ee,'skip':_0x4ed5c8,'take':_0x41e87c,'orderBy':{'createdAt':_0xa937eb(0x15b)},'include':{'shop':{'select':{'name':!![],'username':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}}),database_1[_0xa937eb(0x13d)][_0xa937eb(0x163)][_0xa937eb(0xfc)]({'where':_0xde65ee})]);return{'payouts':_0xcadfc1[_0xa937eb(0x106)](_0x3dc615=>({'id':_0x3dc615['id'],'shopId':_0x3dc615[_0xa937eb(0x1db)],'shopName':_0x3dc615[_0xa937eb(0x100)][_0xa937eb(0xfa)],'shopUsername':_0x3dc615[_0xa937eb(0x100)]['username'],'amount':_0x3dc615[_0xa937eb(0x17a)],'network':this[_0xa937eb(0x203)](_0x3dc615['network']),'networkTechnical':_0x3dc615['network'],'walletAddress':this[_0xa937eb(0x1cd)](_0x3dc615['shop'],_0x3dc615[_0xa937eb(0x13e)]),'status':_0x3dc615['status'],'txid':_0x3dc615[_0xa937eb(0x16a)],'notes':_0x3dc615['notes'],'periodFrom':_0x3dc615[_0xa937eb(0x1b0)],'periodTo':_0x3dc615[_0xa937eb(0x1be)],'createdAt':_0x3dc615['createdAt'],'paidAt':_0x3dc615['paidAt']})),'pagination':{'page':_0x5812e6,'limit':_0x41e87c,'total':_0x54927b,'totalPages':Math['ceil'](_0x54927b/_0x41e87c)}};}async['getPayoutById'](_0x349d70){const _0x50ba7c=a35_0xdeefb2,_0x5f138f=await database_1[_0x50ba7c(0x13d)][_0x50ba7c(0x163)][_0x50ba7c(0x17c)]({'where':{'id':_0x349d70},'include':{'shop':{'select':{'name':!![],'username':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}});if(!_0x5f138f)return null;return{'id':_0x5f138f['id'],'shopId':_0x5f138f[_0x50ba7c(0x1db)],'shopName':_0x5f138f[_0x50ba7c(0x100)]['name'],'shopUsername':_0x5f138f[_0x50ba7c(0x100)][_0x50ba7c(0x139)],'amount':_0x5f138f[_0x50ba7c(0x17a)],'network':this[_0x50ba7c(0x203)](_0x5f138f[_0x50ba7c(0x13e)]),'networkTechnical':_0x5f138f[_0x50ba7c(0x13e)],'walletAddress':this[_0x50ba7c(0x1cd)](_0x5f138f[_0x50ba7c(0x100)],_0x5f138f[_0x50ba7c(0x13e)]),'status':_0x5f138f['status'],'txid':_0x5f138f[_0x50ba7c(0x16a)],'notes':_0x5f138f[_0x50ba7c(0x148)],'periodFrom':_0x5f138f[_0x50ba7c(0x1b0)],'periodTo':_0x5f138f[_0x50ba7c(0x1be)],'createdAt':_0x5f138f[_0x50ba7c(0x1d0)],'paidAt':_0x5f138f[_0x50ba7c(0x1ce)]};}async[a35_0xdeefb2(0x1b7)](_0x2b28be){const _0x576ce7=a35_0xdeefb2;await database_1[_0x576ce7(0x13d)][_0x576ce7(0x163)][_0x576ce7(0x170)]({'where':{'id':_0x2b28be}});}async[a35_0xdeefb2(0x1a1)](_0x21e509){const _0x5de51e=a35_0xdeefb2,{page:_0x594267,limit:_0x5d78f9,status:_0x3b3f86,gateway:_0x12ef82,shopId:_0xc27f4b,dateFrom:_0x115493,dateTo:_0x2349ea,search:_0x1902f1,sortBy:sortBy=_0x5de51e(0x1d0),sortOrder:sortOrder='desc'}=_0x21e509,_0x28ef20=(_0x594267-0x1)*_0x5d78f9,_0x16e5bd={},_0x18bef9=['createdAt',_0x5de51e(0x17a),_0x5de51e(0x205),_0x5de51e(0x208)],_0x26e501=_0x18bef9['includes'](sortBy)?sortBy:'createdAt',_0x505bdc=['asc','desc']['includes'](sortOrder?.['toLowerCase']())?sortOrder[_0x5de51e(0xfb)]():_0x5de51e(0x15b);console[_0x5de51e(0x19d)](_0x5de51e(0x1eb)+_0x26e501+'\x20'+_0x505bdc);_0x3b3f86&&(_0x16e5bd[_0x5de51e(0x205)]=_0x3b3f86[_0x5de51e(0x14f)]());if(_0x12ef82){const {getGatewayNameById:_0x190611,isValidGatewayId:_0x4d15b0}=require(_0x5de51e(0x1c7)),_0x430a87=/^\d{4}$/[_0x5de51e(0x1e5)](_0x12ef82);if(_0x430a87&&_0x4d15b0(_0x12ef82)){const _0x4a0965=_0x190611(_0x12ef82);console[_0x5de51e(0x19d)](_0x5de51e(0x13a)+_0x12ef82+_0x5de51e(0x1cc)+_0x4a0965),_0x16e5bd[_0x5de51e(0x208)]=_0x4a0965;}else console[_0x5de51e(0x19d)]('🔍\x20Admin\x20payments\x20filter:\x20Using\x20gateway\x20name\x20'+_0x12ef82+_0x5de51e(0x104)),_0x16e5bd[_0x5de51e(0x208)]=_0x12ef82[_0x5de51e(0xfb)]();}_0x16e5bd[_0x5de51e(0x208)]=_0x16e5bd[_0x5de51e(0x208)]?_0x16e5bd['gateway']:{'not':_0x5de51e(0x1dc)};if(typeof _0x16e5bd['gateway']===_0x5de51e(0x135)&&_0x16e5bd[_0x5de51e(0x208)]!==_0x5de51e(0x1dc)){}else{if(typeof _0x16e5bd[_0x5de51e(0x208)]===_0x5de51e(0x135)&&_0x16e5bd[_0x5de51e(0x208)]===_0x5de51e(0x1dc)){}else _0x16e5bd[_0x5de51e(0x208)]={'not':_0x5de51e(0x1dc)};}_0xc27f4b&&(_0x16e5bd[_0x5de51e(0x1db)]=_0xc27f4b);(_0x115493||_0x2349ea)&&(_0x16e5bd[_0x5de51e(0x1d0)]={},_0x115493&&(_0x16e5bd['createdAt'][_0x5de51e(0x1fe)]=new Date(_0x115493)),_0x2349ea&&(_0x16e5bd[_0x5de51e(0x1d0)][_0x5de51e(0x1c2)]=new Date(_0x2349ea)));_0x1902f1&&(_0x16e5bd['OR']=[{'id':_0x1902f1},{'id':{'contains':_0x1902f1,'mode':_0x5de51e(0x14e)}},{'orderId':{'contains':_0x1902f1,'mode':_0x5de51e(0x14e)}},{'gatewayOrderId':{'contains':_0x1902f1,'mode':_0x5de51e(0x14e)}},{'customerEmail':{'contains':_0x1902f1,'mode':_0x5de51e(0x14e)}},{'shop':{'name':{'contains':_0x1902f1,'mode':_0x5de51e(0x14e)}}},{'shop':{'username':{'contains':_0x1902f1,'mode':_0x5de51e(0x14e)}}}],console[_0x5de51e(0x19d)](_0x5de51e(0x1ac)+_0x1902f1+'\x22'));console['log'](_0x5de51e(0x118),JSON['stringify'](_0x16e5bd,null,0x2));if(_0x1902f1&&_0x1902f1[_0x5de51e(0x138)]>0x14){const _0x283c65=await database_1[_0x5de51e(0x13d)][_0x5de51e(0x15a)]['findUnique']({'where':{'id':_0x1902f1},'select':{'id':!![],'orderId':!![],'gatewayOrderId':!![],'gateway':!![]}});console['log'](_0x5de51e(0x19a)+_0x1902f1+'\x22:',_0x283c65?_0x5de51e(0x1f5):_0x5de51e(0x1a3)),_0x283c65&&console['log'](_0x5de51e(0x20a)+_0x283c65['id']+_0x5de51e(0x201)+_0x283c65['orderId']+_0x5de51e(0x137)+_0x283c65[_0x5de51e(0x129)]+_0x5de51e(0x1f9)+_0x283c65[_0x5de51e(0x208)]);}const _0x568aaa={};_0x568aaa[_0x26e501]=_0x505bdc;const [_0x450da3,_0x39029e]=await Promise[_0x5de51e(0xfe)]([database_1[_0x5de51e(0x13d)][_0x5de51e(0x15a)][_0x5de51e(0x1d1)]({'where':_0x16e5bd,'skip':_0x28ef20,'take':_0x5d78f9,'orderBy':_0x568aaa,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x5de51e(0x13d)][_0x5de51e(0x15a)][_0x5de51e(0xfc)]({'where':_0x16e5bd})]);return console[_0x5de51e(0x19d)]('📊\x20Admin\x20getAllPayments\x20results:\x20found\x20'+_0x39029e+_0x5de51e(0x117)+_0x450da3[_0x5de51e(0x138)]+_0x5de51e(0xf3)),_0x1902f1&&(console[_0x5de51e(0x19d)]('🔍\x20Search\x20term:\x20\x22'+_0x1902f1+'\x22'),console[_0x5de51e(0x19d)](_0x5de51e(0x19b)+_0x450da3['length']+_0x5de51e(0x1b1))),_0x450da3[_0x5de51e(0x138)]>0x0&&console[_0x5de51e(0x19d)](_0x5de51e(0x1a2)+_0x450da3[0x0][_0x5de51e(0x208)]+_0x5de51e(0x16f)+_0x450da3[0x0]['id']),{'payments':_0x450da3[_0x5de51e(0x106)](_0x27b5a6=>({'id':_0x27b5a6['id'],'shopId':_0x27b5a6[_0x5de51e(0x1db)],'gateway':this[_0x5de51e(0x18e)](_0x27b5a6[_0x5de51e(0x208)]),'gatewayTechnical':_0x27b5a6['gateway'],'amount':_0x27b5a6[_0x5de51e(0x17a)],'currency':_0x27b5a6[_0x5de51e(0x147)],'status':_0x27b5a6[_0x5de51e(0x205)],'orderId':_0x27b5a6[_0x5de51e(0x210)],'gatewayOrderId':_0x27b5a6[_0x5de51e(0x129)],'customerEmail':_0x27b5a6[_0x5de51e(0x1a5)],'customerName':_0x27b5a6[_0x5de51e(0x1ed)],'customerCountry':_0x27b5a6[_0x5de51e(0x1ae)],'customerIp':_0x27b5a6['customerIp'],'customerUa':_0x27b5a6[_0x5de51e(0x184)],'failureMessage':_0x27b5a6[_0x5de51e(0x16d)],'cardLast4':_0x27b5a6['cardLast4'],'paymentMethod':_0x27b5a6[_0x5de51e(0x156)],'bankId':_0x27b5a6['bankId'],'remitterIban':_0x27b5a6[_0x5de51e(0xf4)],'remitterName':_0x27b5a6['remitterName'],'txUrls':_0x27b5a6[_0x5de51e(0x142)],'createdAt':_0x27b5a6[_0x5de51e(0x1d0)],'updatedAt':_0x27b5a6[_0x5de51e(0x1a0)],'shop':_0x27b5a6[_0x5de51e(0x100)]})),'pagination':{'page':_0x594267,'limit':_0x5d78f9,'total':_0x39029e,'totalPages':Math[_0x5de51e(0x11e)](_0x39029e/_0x5d78f9)}};}async[a35_0xdeefb2(0x111)](_0x2b9380){const _0x221a6a=a35_0xdeefb2,_0x15b84e=await database_1[_0x221a6a(0x13d)][_0x221a6a(0x15a)]['findUnique']({'where':{'id':_0x2b9380},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x15b84e)return null;return{'id':_0x15b84e['id'],'shopId':_0x15b84e['shopId'],'gateway':this[_0x221a6a(0x18e)](_0x15b84e[_0x221a6a(0x208)]),'gatewayTechnical':_0x15b84e[_0x221a6a(0x208)],'amount':_0x15b84e[_0x221a6a(0x17a)],'currency':_0x15b84e[_0x221a6a(0x147)],'status':_0x15b84e[_0x221a6a(0x205)],'orderId':_0x15b84e[_0x221a6a(0x210)],'gatewayOrderId':_0x15b84e['gatewayOrderId'],'customerEmail':_0x15b84e[_0x221a6a(0x1a5)],'customerName':_0x15b84e[_0x221a6a(0x1ed)],'customerCountry':_0x15b84e[_0x221a6a(0x1ae)],'customerIp':_0x15b84e[_0x221a6a(0xef)],'customerUa':_0x15b84e[_0x221a6a(0x184)],'failureMessage':_0x15b84e[_0x221a6a(0x16d)],'externalPaymentUrl':_0x15b84e[_0x221a6a(0x112)],'successUrl':_0x15b84e['successUrl'],'failUrl':_0x15b84e['failUrl'],'pendingUrl':_0x15b84e[_0x221a6a(0x130)],'whiteUrl':_0x15b84e[_0x221a6a(0x10d)],'cardLast4':_0x15b84e[_0x221a6a(0x115)],'paymentMethod':_0x15b84e[_0x221a6a(0x156)],'bankId':_0x15b84e[_0x221a6a(0x1a7)],'remitterIban':_0x15b84e[_0x221a6a(0xf4)],'remitterName':_0x15b84e[_0x221a6a(0x14b)],'txUrls':_0x15b84e[_0x221a6a(0x142)],'createdAt':_0x15b84e['createdAt'],'updatedAt':_0x15b84e[_0x221a6a(0x1a0)],'shop':_0x15b84e[_0x221a6a(0x100)]};}async[a35_0xdeefb2(0x134)](_0x2f8007,_0x37b4b3,_0x596066,_0x9a8f49){const _0x148017=a35_0xdeefb2,_0x3ec592=await database_1[_0x148017(0x13d)][_0x148017(0x132)](async _0x58d52e=>{const _0x4b3c1e=_0x148017,_0x526da6=await _0x58d52e[_0x4b3c1e(0x15a)][_0x4b3c1e(0x17c)]({'where':{'id':_0x2f8007},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x526da6)throw new Error(_0x4b3c1e(0xfd));const _0x2faf46=_0x526da6[_0x4b3c1e(0x205)],_0x420a98=_0x37b4b3[_0x4b3c1e(0x14f)]();console['log'](_0x4b3c1e(0x209)+_0x2f8007+_0x4b3c1e(0x161)+_0x2faf46+_0x4b3c1e(0x12f)+_0x420a98),console[_0x4b3c1e(0x19d)](_0x4b3c1e(0x160)+_0x526da6['shop'][_0x4b3c1e(0x114)]+_0x4b3c1e(0x166));const _0xa3846c={'status':_0x420a98,'updatedAt':new Date(),'statusChangedBy':_0x4b3c1e(0x1e1),'statusChangedAt':new Date()};_0x596066&&(_0xa3846c['adminNotes']=_0x596066);_0x420a98==='CHARGEBACK'&&_0x9a8f49&&(_0xa3846c[_0x4b3c1e(0x1de)]=_0x9a8f49);let _0x53b055=0x0,_0x3762f1=_0x526da6[_0x4b3c1e(0x100)][_0x4b3c1e(0x114)];if(_0x420a98===_0x4b3c1e(0x1df)&&_0x2faf46!==_0x4b3c1e(0x1df)){_0xa3846c['paidAt']=new Date();const _0x4aeed5=await currencyService_1[_0x4b3c1e(0x182)][_0x4b3c1e(0x105)](_0x526da6[_0x4b3c1e(0x17a)],_0x526da6['currency']);_0xa3846c[_0x4b3c1e(0x211)]=_0x4aeed5,_0x53b055=_0x4aeed5,_0x3762f1+=_0x4aeed5,console[_0x4b3c1e(0x19d)]('💰\x20Payment\x20'+_0x2f8007+_0x4b3c1e(0x1d7)+_0x4aeed5['toFixed'](0x6)+'\x20USDT\x20to\x20balance');}else _0x2faf46===_0x4b3c1e(0x1df)&&_0x420a98!==_0x4b3c1e(0x1df)&&(_0x526da6[_0x4b3c1e(0x211)]&&(_0x53b055=-_0x526da6['amountUSDT'],_0x3762f1-=_0x526da6[_0x4b3c1e(0x211)],_0xa3846c[_0x4b3c1e(0x211)]=null,console[_0x4b3c1e(0x19d)](_0x4b3c1e(0x1af)+_0x2f8007+'\x20no\x20longer\x20PAID:\x20-'+_0x526da6['amountUSDT']['toFixed'](0x6)+_0x4b3c1e(0x172))));if(_0x420a98===_0x4b3c1e(0x213)){if(_0x2faf46===_0x4b3c1e(0x1df)&&_0x526da6['amountUSDT']){}_0x9a8f49&&_0x9a8f49>0x0&&(_0x53b055-=_0x9a8f49,_0x3762f1-=_0x9a8f49,console[_0x4b3c1e(0x19d)](_0x4b3c1e(0x15d)+_0x9a8f49[_0x4b3c1e(0x1b9)](0x6)+_0x4b3c1e(0x172)));}_0x420a98===_0x4b3c1e(0x13b)&&_0x2faf46==='PAID'&&console[_0x4b3c1e(0x19d)](_0x4b3c1e(0x12d));const _0x41f37e=await _0x58d52e[_0x4b3c1e(0x15a)]['update']({'where':{'id':_0x2f8007},'data':_0xa3846c,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x53b055!==0x0&&(await _0x58d52e['shop'][_0x4b3c1e(0x16b)]({'where':{'id':_0x526da6[_0x4b3c1e(0x1db)]},'data':{'balance':_0x3762f1}}),console[_0x4b3c1e(0x19d)](_0x4b3c1e(0x1da)+_0x526da6[_0x4b3c1e(0x1db)]+_0x4b3c1e(0x18d)+_0x526da6[_0x4b3c1e(0x100)]['balance'][_0x4b3c1e(0x1b9)](0x6)+_0x4b3c1e(0x12f)+_0x3762f1[_0x4b3c1e(0x1b9)](0x6)+_0x4b3c1e(0x1ba)+(_0x53b055>0x0?'+':'')+_0x53b055[_0x4b3c1e(0x1b9)](0x6)+')')),_0x41f37e;});return{'id':_0x3ec592['id'],'shopId':_0x3ec592['shopId'],'gateway':_0x3ec592[_0x148017(0x208)],'amount':_0x3ec592[_0x148017(0x17a)],'currency':_0x3ec592['currency'],'status':_0x3ec592[_0x148017(0x205)],'orderId':_0x3ec592[_0x148017(0x210)],'gatewayOrderId':_0x3ec592[_0x148017(0x129)],'customerEmail':_0x3ec592[_0x148017(0x1a5)],'customerName':_0x3ec592[_0x148017(0x1ed)],'customerCountry':_0x3ec592['customerCountry'],'customerIp':_0x3ec592[_0x148017(0xef)],'customerUa':_0x3ec592[_0x148017(0x184)],'failureMessage':_0x3ec592[_0x148017(0x16d)],'adminNotes':_0x3ec592[_0x148017(0x122)],'chargebackAmount':_0x3ec592[_0x148017(0x1de)],'statusChangedBy':_0x3ec592['statusChangedBy'],'statusChangedAt':_0x3ec592[_0x148017(0x11f)],'createdAt':_0x3ec592[_0x148017(0x1d0)],'updatedAt':_0x3ec592[_0x148017(0x1a0)],'shop':_0x3ec592[_0x148017(0x100)]};}async['updateUser'](_0x117470,_0x49624f){const _0x4908a9=a35_0xdeefb2,_0x48a853={..._0x49624f};_0x49624f['password']&&(_0x48a853[_0x4908a9(0x1c3)]=await bcryptjs_1[_0x4908a9(0x13d)][_0x4908a9(0x176)](_0x49624f['password'],0xc));_0x49624f[_0x4908a9(0x165)]&&(_0x48a853['name']=_0x49624f[_0x4908a9(0x165)],delete _0x48a853[_0x4908a9(0x165)]);_0x49624f[_0x4908a9(0x15f)]&&(_0x48a853[_0x4908a9(0x1ad)]=_0x49624f['telegramId'],delete _0x48a853[_0x4908a9(0x15f)]);_0x49624f[_0x4908a9(0x126)]&&(_0x48a853[_0x4908a9(0x174)]=_0x49624f[_0x4908a9(0x126)],delete _0x48a853['merchantUrl']);_0x49624f[_0x4908a9(0x103)]&&(_0x48a853[_0x4908a9(0xf8)]=JSON[_0x4908a9(0x19e)](_0x49624f[_0x4908a9(0x103)]),delete _0x48a853[_0x4908a9(0x103)]);_0x49624f[_0x4908a9(0x216)]&&(_0x48a853[_0x4908a9(0x216)]=JSON[_0x4908a9(0x19e)](_0x49624f[_0x4908a9(0x216)]));_0x49624f[_0x4908a9(0x1d8)]&&(_0x49624f[_0x4908a9(0x1d8)][_0x4908a9(0x1b5)]!==undefined&&(_0x48a853['usdtPolygonWallet']=_0x49624f[_0x4908a9(0x1d8)][_0x4908a9(0x1b5)]||null),_0x49624f[_0x4908a9(0x1d8)]['usdtTrcWallet']!==undefined&&(_0x48a853[_0x4908a9(0x109)]=_0x49624f[_0x4908a9(0x1d8)][_0x4908a9(0x109)]||null),_0x49624f[_0x4908a9(0x1d8)][_0x4908a9(0x145)]!==undefined&&(_0x48a853[_0x4908a9(0x145)]=_0x49624f[_0x4908a9(0x1d8)][_0x4908a9(0x145)]||null),_0x49624f[_0x4908a9(0x1d8)]['usdcPolygonWallet']!==undefined&&(_0x48a853[_0x4908a9(0x1ec)]=_0x49624f[_0x4908a9(0x1d8)][_0x4908a9(0x1ec)]||null),delete _0x48a853[_0x4908a9(0x1d8)]);const _0x39d6eb=await database_1[_0x4908a9(0x13d)][_0x4908a9(0x100)][_0x4908a9(0x16b)]({'where':{'id':_0x117470},'data':_0x48a853,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x39d6eb['id'],'fullName':_0x39d6eb[_0x4908a9(0xfa)],'username':_0x39d6eb[_0x4908a9(0x139)],'telegramId':_0x39d6eb[_0x4908a9(0x1ad)],'merchantUrl':_0x39d6eb[_0x4908a9(0x174)],'gateways':_0x39d6eb[_0x4908a9(0xf8)]?JSON[_0x4908a9(0x194)](_0x39d6eb[_0x4908a9(0xf8)]):null,'gatewaySettings':_0x39d6eb[_0x4908a9(0x216)]?JSON['parse'](_0x39d6eb['gatewaySettings']):null,'publicKey':_0x39d6eb['publicKey'],'wallets':{'usdtPolygonWallet':_0x39d6eb[_0x4908a9(0x1b5)],'usdtTrcWallet':_0x39d6eb[_0x4908a9(0x109)],'usdtErcWallet':_0x39d6eb[_0x4908a9(0x145)],'usdcPolygonWallet':_0x39d6eb['usdcPolygonWallet']},'status':_0x39d6eb['status'],'createdAt':_0x39d6eb[_0x4908a9(0x1d0)]};}async[a35_0xdeefb2(0x143)](_0x3b57c4){const _0x12770d=a35_0xdeefb2,_0x2a628d=await database_1['default']['shop'][_0x12770d(0x16b)]({'where':{'id':_0x3b57c4},'data':{'status':_0x12770d(0x1c0)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2a628d['id'],'fullName':_0x2a628d[_0x12770d(0xfa)],'username':_0x2a628d['username'],'telegramId':_0x2a628d[_0x12770d(0x1ad)],'merchantUrl':_0x2a628d[_0x12770d(0x174)],'gateways':_0x2a628d[_0x12770d(0xf8)]?JSON['parse'](_0x2a628d['paymentGateways']):null,'gatewaySettings':_0x2a628d[_0x12770d(0x216)]?JSON[_0x12770d(0x194)](_0x2a628d['gatewaySettings']):null,'publicKey':_0x2a628d['publicKey'],'wallets':{'usdtPolygonWallet':_0x2a628d['usdtPolygonWallet'],'usdtTrcWallet':_0x2a628d['usdtTrcWallet'],'usdtErcWallet':_0x2a628d[_0x12770d(0x145)],'usdcPolygonWallet':_0x2a628d[_0x12770d(0x1ec)]},'status':_0x2a628d[_0x12770d(0x205)],'createdAt':_0x2a628d[_0x12770d(0x1d0)]};}async['activateUser'](_0x542b2c){const _0xb7e47a=a35_0xdeefb2,_0x1e604c=await database_1['default'][_0xb7e47a(0x100)]['update']({'where':{'id':_0x542b2c},'data':{'status':_0xb7e47a(0x164)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x1e604c['id'],'fullName':_0x1e604c[_0xb7e47a(0xfa)],'username':_0x1e604c[_0xb7e47a(0x139)],'telegramId':_0x1e604c[_0xb7e47a(0x1ad)],'merchantUrl':_0x1e604c[_0xb7e47a(0x174)],'gateways':_0x1e604c[_0xb7e47a(0xf8)]?JSON[_0xb7e47a(0x194)](_0x1e604c[_0xb7e47a(0xf8)]):null,'gatewaySettings':_0x1e604c[_0xb7e47a(0x216)]?JSON['parse'](_0x1e604c[_0xb7e47a(0x216)]):null,'publicKey':_0x1e604c[_0xb7e47a(0x13f)],'wallets':{'usdtPolygonWallet':_0x1e604c['usdtPolygonWallet'],'usdtTrcWallet':_0x1e604c[_0xb7e47a(0x109)],'usdtErcWallet':_0x1e604c[_0xb7e47a(0x145)],'usdcPolygonWallet':_0x1e604c[_0xb7e47a(0x1ec)]},'status':_0x1e604c['status'],'createdAt':_0x1e604c['createdAt']};}async['getAllUsers'](_0x25ab4c){const _0x22dfe0=a35_0xdeefb2,{page:_0x5d5e28,limit:_0xe90fd2,status:_0x35e361}=_0x25ab4c,_0x599359=(_0x5d5e28-0x1)*_0xe90fd2,_0x285a45={};_0x35e361&&(_0x285a45[_0x22dfe0(0x205)]=_0x35e361['toUpperCase']());const [_0x4665f4,_0x4212c5]=await Promise['all']([database_1[_0x22dfe0(0x13d)][_0x22dfe0(0x100)][_0x22dfe0(0x1d1)]({'where':_0x285a45,'skip':_0x599359,'take':_0xe90fd2,'orderBy':{'createdAt':_0x22dfe0(0x15b)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x22dfe0(0x13d)]['shop'][_0x22dfe0(0xfc)]({'where':_0x285a45})]);return{'users':_0x4665f4['map'](_0x5455d3=>({'id':_0x5455d3['id'],'fullName':_0x5455d3[_0x22dfe0(0xfa)],'username':_0x5455d3[_0x22dfe0(0x139)],'telegramId':_0x5455d3[_0x22dfe0(0x1ad)],'merchantUrl':_0x5455d3[_0x22dfe0(0x174)],'gateways':_0x5455d3['paymentGateways']?JSON['parse'](_0x5455d3[_0x22dfe0(0xf8)]):null,'gatewaySettings':_0x5455d3[_0x22dfe0(0x216)]?JSON[_0x22dfe0(0x194)](_0x5455d3[_0x22dfe0(0x216)]):null,'publicKey':_0x5455d3[_0x22dfe0(0x13f)],'wallets':{'usdtPolygonWallet':_0x5455d3['usdtPolygonWallet'],'usdtTrcWallet':_0x5455d3[_0x22dfe0(0x109)],'usdtErcWallet':_0x5455d3[_0x22dfe0(0x145)],'usdcPolygonWallet':_0x5455d3['usdcPolygonWallet']},'status':_0x5455d3[_0x22dfe0(0x205)],'createdAt':_0x5455d3[_0x22dfe0(0x1d0)]})),'pagination':{'page':_0x5d5e28,'limit':_0xe90fd2,'total':_0x4212c5,'totalPages':Math[_0x22dfe0(0x11e)](_0x4212c5/_0xe90fd2)}};}async[a35_0xdeefb2(0x141)](_0x2f642d){const _0x26926e=a35_0xdeefb2,_0x333c4c=await database_1[_0x26926e(0x13d)][_0x26926e(0x100)][_0x26926e(0x17c)]({'where':{'id':_0x2f642d},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x333c4c)return null;return{'id':_0x333c4c['id'],'fullName':_0x333c4c[_0x26926e(0xfa)],'username':_0x333c4c['username'],'telegramId':_0x333c4c['telegram'],'merchantUrl':_0x333c4c[_0x26926e(0x174)],'gateways':_0x333c4c['paymentGateways']?JSON[_0x26926e(0x194)](_0x333c4c['paymentGateways']):null,'gatewaySettings':_0x333c4c['gatewaySettings']?JSON[_0x26926e(0x194)](_0x333c4c['gatewaySettings']):null,'publicKey':_0x333c4c['publicKey'],'wallets':{'usdtPolygonWallet':_0x333c4c[_0x26926e(0x1b5)],'usdtTrcWallet':_0x333c4c[_0x26926e(0x109)],'usdtErcWallet':_0x333c4c[_0x26926e(0x145)],'usdcPolygonWallet':_0x333c4c[_0x26926e(0x1ec)]},'status':_0x333c4c[_0x26926e(0x205)],'createdAt':_0x333c4c[_0x26926e(0x1d0)]};}async[a35_0xdeefb2(0x1c9)](_0x379164){const _0x257285=a35_0xdeefb2,{fullName:_0x348af1,username:_0xd4fc0f,password:_0x3c9dd8,telegramId:_0x509af0,merchantUrl:_0x13a74a,gateways:_0x328c06,gatewaySettings:_0x4df651,wallets:_0x2326bc}=_0x379164,_0x3627ad=await database_1[_0x257285(0x13d)][_0x257285(0x100)][_0x257285(0x17c)]({'where':{'username':_0xd4fc0f}});if(_0x3627ad)throw new Error(_0x257285(0x108));if(_0x509af0){const _0x11661c=await database_1[_0x257285(0x13d)][_0x257285(0x100)]['findUnique']({'where':{'telegram':_0x509af0}});if(_0x11661c)throw new Error(_0x257285(0x158));}const _0x416eff=await bcryptjs_1[_0x257285(0x13d)][_0x257285(0x176)](_0x3c9dd8,0xc),_0x2cef80=_0x257285(0x155)+crypto_1['default']['randomBytes'](0x20)[_0x257285(0x188)]('hex'),_0x4f4e6f='sk_'+crypto_1[_0x257285(0x13d)][_0x257285(0x1f8)](0x20)[_0x257285(0x188)](_0x257285(0x1e4)),_0x5e08ad=await database_1[_0x257285(0x13d)]['shop'][_0x257285(0x189)]({'data':{'name':_0x348af1,'username':_0xd4fc0f,'password':_0x416eff,'telegram':_0x509af0,'shopUrl':_0x13a74a,'paymentGateways':_0x328c06?JSON['stringify'](_0x328c06):null,'gatewaySettings':_0x4df651?JSON[_0x257285(0x19e)](_0x4df651):null,'usdtPolygonWallet':_0x2326bc?.['usdtPolygonWallet']||null,'usdtTrcWallet':_0x2326bc?.[_0x257285(0x109)]||null,'usdtErcWallet':_0x2326bc?.[_0x257285(0x145)]||null,'usdcPolygonWallet':_0x2326bc?.[_0x257285(0x1ec)]||null,'publicKey':_0x2cef80,'secretKey':_0x4f4e6f,'status':_0x257285(0x164)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x5e08ad['id'],'fullName':_0x5e08ad[_0x257285(0xfa)],'username':_0x5e08ad[_0x257285(0x139)],'telegramId':_0x5e08ad[_0x257285(0x1ad)],'merchantUrl':_0x5e08ad[_0x257285(0x174)],'gateways':_0x5e08ad['paymentGateways']?JSON[_0x257285(0x194)](_0x5e08ad[_0x257285(0xf8)]):null,'gatewaySettings':_0x5e08ad[_0x257285(0x216)]?JSON[_0x257285(0x194)](_0x5e08ad[_0x257285(0x216)]):null,'publicKey':_0x5e08ad[_0x257285(0x13f)],'wallets':{'usdtPolygonWallet':_0x5e08ad[_0x257285(0x1b5)],'usdtTrcWallet':_0x5e08ad['usdtTrcWallet'],'usdtErcWallet':_0x5e08ad[_0x257285(0x145)],'usdcPolygonWallet':_0x5e08ad[_0x257285(0x1ec)]},'status':_0x5e08ad[_0x257285(0x205)],'createdAt':_0x5e08ad['createdAt']};}async['deleteUser'](_0x3d9f84){const _0x89cfd=a35_0xdeefb2;await database_1[_0x89cfd(0x13d)][_0x89cfd(0x100)][_0x89cfd(0x170)]({'where':{'id':_0x3d9f84}});}async['getMerchantsSelection'](_0x2519eb){const _0x379a5c=a35_0xdeefb2,_0x5ac3fa={};_0x2519eb&&[_0x379a5c(0x164),_0x379a5c(0x1e6),_0x379a5c(0x1c0)][_0x379a5c(0x18a)](_0x2519eb['toUpperCase']())&&(_0x5ac3fa[_0x379a5c(0x205)]=_0x2519eb[_0x379a5c(0x14f)]());const _0x222bce=await database_1[_0x379a5c(0x13d)][_0x379a5c(0x100)][_0x379a5c(0x1d1)]({'where':_0x5ac3fa,'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x379a5c(0x1ef)}});return _0x222bce;}}function a35_0x1877(_0x5764b8,_0x5ef9d4){const _0x59e05e=a35_0x59e0();return a35_0x1877=function(_0x187702,_0x5ccd7e){_0x187702=_0x187702-0xef;let _0x35c189=_0x59e05e[_0x187702];return _0x35c189;},a35_0x1877(_0x5764b8,_0x5ef9d4);}exports[a35_0xdeefb2(0xf0)]=AdminService;