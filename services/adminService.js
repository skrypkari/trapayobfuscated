'use strict';const a53_0x1045ef=a53_0x1f13;(function(_0x3c914f,_0x2e7ab2){const _0x59567b=a53_0x1f13,_0x4befef=_0x3c914f();while(!![]){try{const _0x37b892=-parseInt(_0x59567b(0x27e))/0x1*(parseInt(_0x59567b(0x2c7))/0x2)+parseInt(_0x59567b(0x2b6))/0x3+parseInt(_0x59567b(0x1f1))/0x4*(parseInt(_0x59567b(0x33a))/0x5)+-parseInt(_0x59567b(0x341))/0x6+-parseInt(_0x59567b(0x34e))/0x7+-parseInt(_0x59567b(0x230))/0x8+-parseInt(_0x59567b(0x2ed))/0x9*(-parseInt(_0x59567b(0x28c))/0xa);if(_0x37b892===_0x2e7ab2)break;else _0x4befef['push'](_0x4befef['shift']());}catch(_0x2a6cf7){_0x4befef['push'](_0x4befef['shift']());}}}(a53_0x2414,0xca5bb));var __importDefault=this&&this[a53_0x1045ef(0x1a8)]||function(_0x48567c){const _0x41533c=a53_0x1045ef;return _0x48567c&&_0x48567c[_0x41533c(0x1a7)]?_0x48567c:{'default':_0x48567c};};function a53_0x1f13(_0x3c0ec8,_0x597bf6){_0x3c0ec8=_0x3c0ec8-0x188;const _0x2414fe=a53_0x2414();let _0x1f1339=_0x2414fe[_0x3c0ec8];return _0x1f1339;}Object[a53_0x1045ef(0x2f8)](exports,a53_0x1045ef(0x1a7),{'value':!![]}),exports[a53_0x1045ef(0x1bb)]=void 0x0;const database_1=__importDefault(require(a53_0x1045ef(0x2da))),bcryptjs_1=__importDefault(require(a53_0x1045ef(0x22f))),crypto_1=__importDefault(require('crypto')),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a53_0x1045ef(0x344))),speakeasy_1=__importDefault(require(a53_0x1045ef(0x1ec))),qrcode_1=__importDefault(require('qrcode')),config_1=require(a53_0x1045ef(0x226)),currencyService_1=require('./currencyService'),telegramBotService_1=require(a53_0x1045ef(0x263)),gateway_1=require(a53_0x1045ef(0x223));class AdminService{async[a53_0x1045ef(0x1d3)](){const _0x151722=a53_0x1045ef;console[_0x151722(0x1ba)](_0x151722(0x360));const _0x2692b4=await database_1[_0x151722(0x1e9)][_0x151722(0x305)]['aggregate']({'_sum':{'balance':!![],'totalPaidOut':!![]}}),_0xb9e622=await database_1[_0x151722(0x1e9)][_0x151722(0x2fc)][_0x151722(0x1d4)]({'where':{'status':_0x151722(0x221),'gateway':{'not':_0x151722(0x20c)}}}),_0x4d1c94=new Date(),_0x3c274=new Date(_0x4d1c94[_0x151722(0x18c)](),_0x4d1c94[_0x151722(0x326)](),0x1),_0xbc8685=new Date(_0x4d1c94['getFullYear'](),_0x4d1c94[_0x151722(0x326)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x15c466=await database_1[_0x151722(0x1e9)][_0x151722(0x25e)]['aggregate']({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x3c274,'lte':_0xbc8685},'status':_0x151722(0x2eb)}}),_0x5b7457=_0x2692b4['_sum'][_0x151722(0x292)]||0x0,_0x288d18=_0x2692b4[_0x151722(0x21d)][_0x151722(0x1ab)]||0x0,_0x3331ac=_0x15c466[_0x151722(0x21d)][_0x151722(0x228)]||0x0,_0x212a69={'totalPayout':Math[_0x151722(0x197)](_0x5b7457*0x64)/0x64,'awaitingPayout':Math[_0x151722(0x197)](_0x288d18*0x64)/0x64,'thisMonth':Math['round'](_0x3331ac*0x64)/0x64,'availableBalance':Math[_0x151722(0x197)](_0x288d18*0x64)/0x64,'totalPayments':_0xb9e622};return console[_0x151722(0x1ba)](_0x151722(0x2d3)),console[_0x151722(0x1ba)](_0x151722(0x2e6)+_0x212a69[_0x151722(0x21b)]+'\x20USDT\x20(total\x20paid\x20to\x20merchants)'),console[_0x151722(0x1ba)](_0x151722(0x1f8)+_0x212a69[_0x151722(0x2d8)]+_0x151722(0x24f)),console[_0x151722(0x1ba)](_0x151722(0x2b0)+_0x212a69[_0x151722(0x2a3)]+_0x151722(0x2ca)),console[_0x151722(0x1ba)](_0x151722(0x1c4)+_0x212a69['thisMonth']+'\x20USDT'),console[_0x151722(0x1ba)](_0x151722(0x1cd)+_0x212a69[_0x151722(0x18b)]+_0x151722(0x350)),_0x212a69;}async[a53_0x1045ef(0x33b)](_0x304c7,_0x4b5d19){const _0x28016b=a53_0x1045ef;console['log'](_0x28016b(0x35a)+_0x304c7+':',_0x4b5d19);const _0x1c0062=await database_1[_0x28016b(0x1e9)][_0x28016b(0x2fc)][_0x28016b(0x283)]({'where':{'id':_0x304c7},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x1c0062)throw new Error(_0x28016b(0x2f3));const _0x18c626={};_0x4b5d19[_0x28016b(0x208)]!==undefined&&(_0x18c626['customerCountry']=_0x4b5d19['customerCountry']||null);_0x4b5d19[_0x28016b(0x351)]!==undefined&&(_0x18c626[_0x28016b(0x351)]=_0x4b5d19[_0x28016b(0x351)]||null);_0x4b5d19['customerUa']!==undefined&&(_0x18c626[_0x28016b(0x32e)]=_0x4b5d19[_0x28016b(0x32e)]||null);const _0x5960e4=await database_1[_0x28016b(0x1e9)]['payment'][_0x28016b(0x2f7)]({'where':{'id':_0x304c7},'data':{..._0x18c626,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x28016b(0x1ba)]('âœ…\x20Customer\x20data\x20updated\x20for\x20payment\x20'+_0x304c7),console[_0x28016b(0x1ba)](_0x28016b(0x23f)+_0x1c0062[_0x28016b(0x208)]+_0x28016b(0x1c3)+_0x5960e4[_0x28016b(0x208)]),console[_0x28016b(0x1ba)](_0x28016b(0x2b8)+_0x1c0062[_0x28016b(0x351)]+'\x20->\x20'+_0x5960e4['customerIp']),console[_0x28016b(0x1ba)]('\x20\x20\x20ðŸ–¥ï¸\x20User\x20Agent:\x20'+(_0x1c0062[_0x28016b(0x32e)]?_0x28016b(0x18d):_0x28016b(0x236))+_0x28016b(0x1c3)+(_0x5960e4[_0x28016b(0x32e)]?'set':'not\x20set')),_0x5960e4;}async[a53_0x1045ef(0x2d7)](_0x1bdb61,_0x46b602){const _0x250afc=a53_0x1045ef,_0x1ae785=_0x46b602?new Date(_0x46b602):new Date();let _0xd9f837,_0x54fd72;if(_0x1bdb61['startsWith'](_0x250afc(0x2ab))){const _0x34f390=_0x1bdb61['replace'](_0x250afc(0x2ab),'')[_0x250afc(0x2c8)]('_');if(_0x34f390['length']===0x2){const _0x27a558=new Date(_0x34f390[0x0]),_0x3a1063=new Date(_0x34f390[0x1]);_0xd9f837=new Date(Date[_0x250afc(0x315)](_0x27a558[_0x250afc(0x2b7)](),_0x27a558[_0x250afc(0x190)](),_0x27a558[_0x250afc(0x1d9)](),0x0,0x0,0x0,0x0)),_0x54fd72=new Date(Date[_0x250afc(0x315)](_0x3a1063[_0x250afc(0x2b7)](),_0x3a1063['getUTCMonth'](),_0x3a1063[_0x250afc(0x1d9)](),0x17,0x3b,0x3b,0x3e7));}else{const _0x4e07d1=new Date(Date[_0x250afc(0x315)](_0x1ae785[_0x250afc(0x2b7)](),_0x1ae785[_0x250afc(0x190)](),_0x1ae785['getUTCDate']()-0x1e));_0xd9f837=new Date(Date[_0x250afc(0x315)](_0x4e07d1[_0x250afc(0x2b7)](),_0x4e07d1[_0x250afc(0x190)](),_0x4e07d1[_0x250afc(0x1d9)](),0x0,0x0,0x0,0x0)),_0x54fd72=new Date(Date[_0x250afc(0x315)](_0x1ae785[_0x250afc(0x2b7)](),_0x1ae785[_0x250afc(0x190)](),_0x1ae785[_0x250afc(0x1d9)](),0x17,0x3b,0x3b,0x3e7));}}else{switch(_0x1bdb61[_0x250afc(0x269)]()){case _0x250afc(0x30c):_0xd9f837=new Date(Date['UTC'](_0x1ae785['getUTCFullYear'](),_0x1ae785[_0x250afc(0x190)](),_0x1ae785['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x54fd72=new Date(Date[_0x250afc(0x315)](_0x1ae785[_0x250afc(0x2b7)](),_0x1ae785[_0x250afc(0x190)](),_0x1ae785[_0x250afc(0x1d9)](),0x17,0x3b,0x3b,0x3e7));break;case _0x250afc(0x34d):const _0x1796d1=new Date(_0x1ae785);_0x1796d1['setUTCDate'](_0x1796d1[_0x250afc(0x1d9)]()-0x1),_0xd9f837=new Date(Date[_0x250afc(0x315)](_0x1796d1['getUTCFullYear'](),_0x1796d1['getUTCMonth'](),_0x1796d1[_0x250afc(0x1d9)](),0x0,0x0,0x0,0x0)),_0x54fd72=new Date(Date[_0x250afc(0x315)](_0x1796d1[_0x250afc(0x2b7)](),_0x1796d1[_0x250afc(0x190)](),_0x1796d1[_0x250afc(0x1d9)](),0x17,0x3b,0x3b,0x3e7));break;case _0x250afc(0x2ad):const _0x5aab74=_0x1ae785[_0x250afc(0x1f9)](),_0x443b16=_0x5aab74===0x0?-0x6:0x1-_0x5aab74,_0x2df643=_0x1ae785[_0x250afc(0x1d9)]()+_0x443b16;_0xd9f837=new Date(Date[_0x250afc(0x315)](_0x1ae785[_0x250afc(0x2b7)](),_0x1ae785[_0x250afc(0x190)](),_0x2df643,0x0,0x0,0x0,0x0)),_0x54fd72=new Date(Date[_0x250afc(0x315)](_0x1ae785[_0x250afc(0x2b7)](),_0x1ae785[_0x250afc(0x190)](),_0x1ae785[_0x250afc(0x1d9)](),0x17,0x3b,0x3b,0x3e7));break;case _0x250afc(0x334):const _0x3878f1=new Date(Date[_0x250afc(0x315)](_0x1ae785[_0x250afc(0x2b7)](),_0x1ae785[_0x250afc(0x190)](),_0x1ae785[_0x250afc(0x1d9)]()-0x7)),_0x30ed12=_0x3878f1[_0x250afc(0x1f9)](),_0x15017d=_0x30ed12===0x0?-0x6:0x1-_0x30ed12,_0x4dc9c5=_0x3878f1[_0x250afc(0x1d9)]()+_0x15017d;_0xd9f837=new Date(Date[_0x250afc(0x315)](_0x3878f1[_0x250afc(0x2b7)](),_0x3878f1[_0x250afc(0x190)](),_0x4dc9c5,0x0,0x0,0x0,0x0)),_0x54fd72=new Date(Date[_0x250afc(0x315)](_0x3878f1[_0x250afc(0x2b7)](),_0x3878f1[_0x250afc(0x190)](),_0x4dc9c5+0x6,0x17,0x3b,0x3b,0x3e7));break;case'this_month':_0xd9f837=new Date(Date[_0x250afc(0x315)](_0x1ae785[_0x250afc(0x2b7)](),_0x1ae785[_0x250afc(0x190)](),0x1,0x0,0x0,0x0,0x0)),_0x54fd72=new Date(Date[_0x250afc(0x315)](_0x1ae785[_0x250afc(0x2b7)](),_0x1ae785['getUTCMonth'](),_0x1ae785[_0x250afc(0x1d9)](),0x17,0x3b,0x3b,0x3e7));break;case _0x250afc(0x29c):_0xd9f837=new Date(Date[_0x250afc(0x315)](_0x1ae785[_0x250afc(0x2b7)](),_0x1ae785['getUTCMonth']()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x54fd72=new Date(Date[_0x250afc(0x315)](_0x1ae785[_0x250afc(0x2b7)](),_0x1ae785[_0x250afc(0x190)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x250afc(0x2a1):_0xd9f837=new Date(Date[_0x250afc(0x315)](0x7e9,0x5,0xe,0x0,0x0,0x0,0x0)),_0x54fd72=new Date(Date['UTC'](_0x1ae785[_0x250afc(0x2b7)](),_0x1ae785[_0x250afc(0x190)](),_0x1ae785[_0x250afc(0x1d9)](),0x17,0x3b,0x3b,0x3e7));break;default:_0xd9f837=new Date(_0x1ae785[_0x250afc(0x229)]()-0x1e*0x18*0x3c*0x3c*0x3e8);const _0x3835b7=new Date(Date[_0x250afc(0x315)](_0x1ae785[_0x250afc(0x2b7)](),_0x1ae785['getUTCMonth'](),_0x1ae785[_0x250afc(0x1d9)]()-0x1e));_0xd9f837=new Date(Date[_0x250afc(0x315)](_0x3835b7[_0x250afc(0x2b7)](),_0x3835b7[_0x250afc(0x190)](),_0x3835b7['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x54fd72=new Date(Date['UTC'](_0x1ae785[_0x250afc(0x2b7)](),_0x1ae785[_0x250afc(0x190)](),_0x1ae785[_0x250afc(0x1d9)](),0x17,0x3b,0x3b,0x3e7));}const _0x4b07bc={'gte':_0xd9f837,'lte':_0x54fd72};console[_0x250afc(0x1ba)](_0x250afc(0x1c5)+_0xd9f837['toISOString']()+_0x250afc(0x1e7)+_0x54fd72['toISOString']());const [_0x4f150b,_0x1663dd,_0x2f3ade,_0x18c569,_0x18439b,_0x5295f6,_0xb7ff91,_0xa3dd9d,_0x34d241]=await Promise[_0x250afc(0x20b)]([database_1[_0x250afc(0x1e9)][_0x250afc(0x305)][_0x250afc(0x1d4)](),database_1[_0x250afc(0x1e9)][_0x250afc(0x305)][_0x250afc(0x1d4)]({'where':{'status':_0x250afc(0x246)}}),database_1[_0x250afc(0x1e9)][_0x250afc(0x2fc)][_0x250afc(0x1d4)]({'where':{'status':_0x250afc(0x221),'createdAt':_0x4b07bc,'gateway':{'not':'test_gateway'}}}),database_1[_0x250afc(0x1e9)][_0x250afc(0x2fc)]['count']({'where':{'status':_0x250afc(0x24c),'createdAt':_0x4b07bc,'gateway':{'not':_0x250afc(0x20c)}}}),database_1['default'][_0x250afc(0x2fc)][_0x250afc(0x1d4)]({'where':{'status':_0x250afc(0x19b),'createdAt':_0x4b07bc,'gateway':{'not':_0x250afc(0x20c)}}}),database_1[_0x250afc(0x1e9)][_0x250afc(0x2fc)]['findMany']({'where':{'status':_0x250afc(0x221),'createdAt':_0x4b07bc,'gateway':{'not':_0x250afc(0x20c)}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x250afc(0x1e9)][_0x250afc(0x2fc)][_0x250afc(0x355)]({'where':{'gateway':{'not':_0x250afc(0x20c)}},'take':0xa,'orderBy':{'createdAt':_0x250afc(0x34c)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x250afc(0x1e9)][_0x250afc(0x2fc)]['findMany']({'where':{'createdAt':_0x4b07bc,'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1['default'][_0x250afc(0x2fc)][_0x250afc(0x355)]({'where':{'status':_0x250afc(0x221),'gateway':{'not':_0x250afc(0x20c)}},'select':{'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![]}})]);console[_0x250afc(0x1ba)]('ðŸ“Š\x20Statistics\x20PAID\x20payments\x20count:\x20'+_0x2f3ade);let _0x1a37ba=0x0,_0x487957=0x0;for(const _0x485084 of _0x5295f6){const _0x845816=_0x485084['amountUSDT']||0x0;_0x1a37ba+=_0x845816;if(_0x485084[_0x250afc(0x203)]&&_0x485084[_0x250afc(0x2cb)]){const _0x22ca67=_0x485084['amountUSDT']-_0x485084[_0x250afc(0x203)];_0x487957+=_0x22ca67;}}let _0x27c762=0x0;for(const _0x34fb46 of _0x34d241){if(_0x34fb46[_0x250afc(0x203)]&&_0x34fb46[_0x250afc(0x2cb)]){const _0x223820=_0x34fb46['amountUSDT']-_0x34fb46[_0x250afc(0x203)];_0x27c762+=_0x223820;}}const _0x4e2898=_0x2f3ade>0x0?_0x1a37ba/_0x2f3ade:0x0,_0x5d51cc=this[_0x250afc(0x1eb)](_0xa3dd9d,_0xd9f837,_0x54fd72),_0x47c107=await database_1['default'][_0x250afc(0x2fc)][_0x250afc(0x1d4)]({'where':{'createdAt':_0x4b07bc,'gateway':{'not':_0x250afc(0x20c)},'status':{'notIn':[_0x250afc(0x2a9),_0x250afc(0x1da)]}}}),_0x1779c0=_0x47c107>0x0?_0x2f3ade/_0x47c107*0x64:0x0;return{'totalShops':_0x4f150b,'activeShops':_0x1663dd,'totalPayments':_0x47c107,'successfulPayments':_0x2f3ade,'totalAttempts':_0x47c107,'chargebacks':_0x18c569,'refunds':_0x18439b,'totalRevenue':Math[_0x250afc(0x197)](_0x1a37ba*0x64)/0x64,'trapayEarnings':Math['round'](_0x487957*0x64)/0x64,'trapayEarningsAllTime':Math['round'](_0x27c762*0x64)/0x64,'averagePaymentAmount':Math[_0x250afc(0x197)](_0x4e2898*0x64)/0x64,'conversionRate':Math[_0x250afc(0x197)](_0x1779c0*0x64)/0x64,'dailyRevenue':_0x5d51cc[_0x250afc(0x1d2)],'dailyPayments':_0x5d51cc[_0x250afc(0x339)],'recentPayments':_0xb7ff91[_0x250afc(0x30d)](_0x4115a2=>({'id':_0x4115a2['id'],'amount':_0x4115a2['amount'],'currency':_0x4115a2['currency'],'status':_0x4115a2[_0x250afc(0x28b)],'gateway':_0x4115a2[_0x250afc(0x31d)],'shop':_0x4115a2[_0x250afc(0x305)],'createdAt':_0x4115a2[_0x250afc(0x324)]}))};}}async[a53_0x1045ef(0x34a)](_0x4abdd8){const _0x2e041b=a53_0x1045ef;console['log']('ðŸ“Š\x20Getting\x20merchant\x20statistics\x20with\x20filters:',_0x4abdd8);let _0x242495,_0x2d0af4=new Date();if(_0x4abdd8[_0x2e041b(0x1d8)]===_0x2e041b(0x32d)&&_0x4abdd8['dateFrom']&&_0x4abdd8['dateTo']){const _0x531962=new Date(_0x4abdd8[_0x2e041b(0x26e)]),_0x4bf8fa=new Date(_0x4abdd8[_0x2e041b(0x346)]);_0x242495=new Date(Date[_0x2e041b(0x315)](_0x531962['getUTCFullYear'](),_0x531962[_0x2e041b(0x190)](),_0x531962['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x2d0af4=new Date(Date['UTC'](_0x4bf8fa[_0x2e041b(0x2b7)](),_0x4bf8fa[_0x2e041b(0x190)](),_0x4bf8fa['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}else{const _0x3a6449=new Date();switch(_0x4abdd8[_0x2e041b(0x1d8)]){case _0x2e041b(0x27b):_0x242495=new Date(_0x3a6449['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8),_0x242495[_0x2e041b(0x250)](0x0,0x0,0x0,0x0),_0x2d0af4[_0x2e041b(0x250)](0x17,0x3b,0x3b,0x3e7);break;case _0x2e041b(0x262):_0x242495=new Date(Date[_0x2e041b(0x315)](_0x3a6449[_0x2e041b(0x2b7)](),_0x3a6449[_0x2e041b(0x190)](),0x1,0x0,0x0,0x0,0x0)),_0x2d0af4=new Date(Date[_0x2e041b(0x315)](_0x3a6449[_0x2e041b(0x2b7)](),_0x3a6449[_0x2e041b(0x190)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7));break;case'lastMonth':_0x242495=new Date(Date[_0x2e041b(0x315)](_0x3a6449[_0x2e041b(0x2b7)](),_0x3a6449['getUTCMonth']()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x2d0af4=new Date(Date[_0x2e041b(0x315)](_0x3a6449[_0x2e041b(0x2b7)](),_0x3a6449['getUTCMonth'](),0x0,0x17,0x3b,0x3b,0x3e7));break;case'year':_0x242495=new Date(_0x3a6449['getTime']()-0x16d*0x18*0x3c*0x3c*0x3e8),_0x242495['setHours'](0x0,0x0,0x0,0x0),_0x2d0af4[_0x2e041b(0x250)](0x17,0x3b,0x3b,0x3e7);break;case'all':default:_0x242495=new Date(_0x2e041b(0x26a)),_0x242495[_0x2e041b(0x250)](0x0,0x0,0x0,0x0),_0x2d0af4['setHours'](0x17,0x3b,0x3b,0x3e7);break;}}console[_0x2e041b(0x1ba)](_0x2e041b(0x27a)+_0x242495[_0x2e041b(0x312)]()+_0x2e041b(0x1e7)+_0x2d0af4[_0x2e041b(0x312)]());const _0x576672={'status':_0x2e041b(0x221),'gateway':{'not':_0x2e041b(0x20c)},'createdAt':{'gte':_0x242495,'lte':_0x2d0af4}};_0x4abdd8[_0x2e041b(0x18e)]&&(_0x576672[_0x2e041b(0x18e)]=_0x4abdd8[_0x2e041b(0x18e)]);const _0x51d7d8=await database_1[_0x2e041b(0x1e9)][_0x2e041b(0x2fc)][_0x2e041b(0x355)]({'where':_0x576672,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x2e041b(0x1ba)](_0x2e041b(0x2c1)+_0x51d7d8['length']+'\x20paid\x20payments\x20for\x20analysis');const _0x88b66f={'gateway':{'not':'test_gateway'},'status':{'notIn':[_0x2e041b(0x2a9),_0x2e041b(0x1da)]},'createdAt':{'gte':_0x242495,'lte':_0x2d0af4}};_0x4abdd8[_0x2e041b(0x18e)]&&(_0x88b66f[_0x2e041b(0x18e)]=_0x4abdd8[_0x2e041b(0x18e)]);const _0x231031=await database_1[_0x2e041b(0x1e9)][_0x2e041b(0x2fc)][_0x2e041b(0x1d4)]({'where':_0x88b66f}),_0x3a18fe={..._0x88b66f,'status':_0x2e041b(0x24c)},_0x7437fe={..._0x88b66f,'status':_0x2e041b(0x19b)},[_0x45fb23,_0x936b00]=await Promise[_0x2e041b(0x20b)]([database_1[_0x2e041b(0x1e9)][_0x2e041b(0x2fc)]['count']({'where':_0x3a18fe}),database_1[_0x2e041b(0x1e9)][_0x2e041b(0x2fc)]['count']({'where':_0x7437fe})]);console[_0x2e041b(0x1ba)](_0x2e041b(0x25d)+_0x231031+_0x2e041b(0x285)+_0x51d7d8[_0x2e041b(0x21f)]+_0x2e041b(0x20f)+_0x45fb23+_0x2e041b(0x238)+_0x936b00);let _0x51539e=0x0,_0x3a17fb=0x0,_0x1b2292=0x0;const _0x17bcdd={},_0x1e872d={},_0x5ee6fd={},_0x19ff74=new Date(_0x242495);while(_0x19ff74<=_0x2d0af4){const _0xc1dbc=_0x19ff74['toISOString']()[_0x2e041b(0x2c8)]('T')[0x0];_0x5ee6fd[_0xc1dbc]={'date':_0xc1dbc,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0},_0x19ff74[_0x2e041b(0x237)](_0x19ff74['getUTCDate']()+0x1);}for(const _0x4f9900 of _0x51d7d8){try{const _0x36f968=_0x4f9900[_0x2e041b(0x2cb)]||0x0;if(_0x36f968<=0x0){console[_0x2e041b(0x34f)](_0x2e041b(0x20a)+_0x4f9900['id']+_0x2e041b(0x213));continue;}let _0x2d6273,_0xc7910;if(_0x4f9900[_0x2e041b(0x203)]!==null&&_0x4f9900[_0x2e041b(0x203)]!==undefined)_0x2d6273=_0x4f9900[_0x2e041b(0x203)],_0xc7910=_0x36f968-_0x2d6273,console[_0x2e041b(0x1ba)](_0x2e041b(0x257)+_0x4f9900['id']+':\x20'+_0x36f968[_0x2e041b(0x2e5)](0x6)+_0x2e041b(0x258)+_0x2d6273[_0x2e041b(0x2e5)](0x6)+_0x2e041b(0x189));else{let _0x146139={};if(_0x4f9900[_0x2e041b(0x305)][_0x2e041b(0x265)])try{_0x146139=JSON[_0x2e041b(0x1d6)](_0x4f9900[_0x2e041b(0x305)][_0x2e041b(0x265)]);}catch(_0x5cf2ce){console['error']('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x4f9900['shopId']+':',_0x5cf2ce);}let _0x5ba1d7=0x2d;for(const [_0x3cde64,_0x54a3ff]of Object[_0x2e041b(0x298)](_0x146139)){if(_0x3cde64['toLowerCase']()===_0x4f9900[_0x2e041b(0x31d)]['toLowerCase']()){_0x5ba1d7=_0x54a3ff[_0x2e041b(0x1db)]||0x2d;break;}}_0xc7910=_0x36f968*(_0x5ba1d7/0x64),_0x2d6273=_0x36f968-_0xc7910,console['log']('ðŸ“Š\x20Calculating\x20commission\x20manually\x20for\x20payment\x20'+_0x4f9900['id']+':\x20'+_0x5ba1d7+_0x2e041b(0x1f6)+_0x36f968['toFixed'](0x6)+_0x2e041b(0x189));}_0x51539e+=_0x36f968,_0x3a17fb+=_0x2d6273,_0x1b2292+=_0xc7910;let _0x10db67;_0x4f9900[_0x2e041b(0x1f4)]!==null&&_0x4f9900['gatewayCommissionRate']!==undefined?(_0x10db67=_0x4f9900[_0x2e041b(0x1f4)],console[_0x2e041b(0x1ba)](_0x2e041b(0x289)+_0x4f9900['id']+':\x20'+_0x10db67+'%')):(_0x10db67=_0x36f968>0x0?_0xc7910/_0x36f968*0x64:0x0,console['log']('ðŸ“Š\x20Calculated\x20commission\x20rate\x20for\x20payment\x20'+_0x4f9900['id']+':\x20'+_0x10db67[_0x2e041b(0x2e5)](0x2)+'%'));!_0x17bcdd[_0x4f9900[_0x2e041b(0x31d)]]&&(_0x17bcdd[_0x4f9900[_0x2e041b(0x31d)]]={'gateway':_0x4f9900['gateway'],'gatewayDisplayName':this[_0x2e041b(0x29a)](_0x4f9900[_0x2e041b(0x31d)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x17bcdd[_0x4f9900[_0x2e041b(0x31d)]]['paymentsCount']++,_0x17bcdd[_0x4f9900[_0x2e041b(0x31d)]][_0x2e041b(0x1b7)]+=_0x36f968,_0x17bcdd[_0x4f9900[_0x2e041b(0x31d)]][_0x2e041b(0x2f9)]+=_0xc7910,_0x17bcdd[_0x4f9900['gateway']][_0x2e041b(0x1be)]+=_0x2d6273,_0x17bcdd[_0x4f9900[_0x2e041b(0x31d)]][_0x2e041b(0x295)]+=_0x10db67;!_0x4abdd8['shopId']&&(!_0x1e872d[_0x4f9900['shopId']]&&(_0x1e872d[_0x4f9900[_0x2e041b(0x18e)]]={'shopId':_0x4f9900[_0x2e041b(0x18e)],'shopName':_0x4f9900['shop'][_0x2e041b(0x31c)],'shopUsername':_0x4f9900[_0x2e041b(0x305)][_0x2e041b(0x302)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x1e872d[_0x4f9900[_0x2e041b(0x18e)]]['paymentsCount']++,_0x1e872d[_0x4f9900[_0x2e041b(0x18e)]][_0x2e041b(0x1b7)]+=_0x36f968,_0x1e872d[_0x4f9900['shopId']]['commissionUSDT']+=_0xc7910,_0x1e872d[_0x4f9900[_0x2e041b(0x18e)]]['merchantEarningsUSDT']+=_0x2d6273);const _0x219f69=_0x4f9900[_0x2e041b(0x316)][_0x2e041b(0x312)]()[_0x2e041b(0x2c8)]('T')[0x0];_0x5ee6fd[_0x219f69]&&(_0x5ee6fd[_0x219f69][_0x2e041b(0x1e1)]+=_0x36f968,_0x5ee6fd[_0x219f69]['merchantEarnings']+=_0x2d6273,_0x5ee6fd[_0x219f69][_0x2e041b(0x2c9)]+=_0xc7910,_0x5ee6fd[_0x219f69][_0x2e041b(0x261)]++);}catch(_0x39c124){console['error'](_0x2e041b(0x2b5)+_0x4f9900['id']+':',_0x39c124);}}Object[_0x2e041b(0x35f)](_0x17bcdd)[_0x2e041b(0x276)](_0x4b3bfd=>{const _0x277008=_0x2e041b;_0x4b3bfd[_0x277008(0x2a7)]=_0x4b3bfd[_0x277008(0x261)]>0x0?_0x4b3bfd[_0x277008(0x295)]/_0x4b3bfd[_0x277008(0x261)]:0x0,delete _0x4b3bfd[_0x277008(0x295)];}),Object[_0x2e041b(0x35f)](_0x1e872d)['forEach'](_0x3c55de=>{const _0x4e8c60=_0x2e041b;_0x3c55de[_0x4e8c60(0x1fb)]=_0x3c55de[_0x4e8c60(0x261)]>0x0?_0x3c55de[_0x4e8c60(0x1b7)]/_0x3c55de[_0x4e8c60(0x261)]:0x0;});let _0x33c223=0x0,_0x1d1875=0x0;if(_0x4abdd8[_0x2e041b(0x18e)]){const _0x27dbc2=await database_1[_0x2e041b(0x1e9)][_0x2e041b(0x25e)][_0x2e041b(0x355)]({'where':{'shopId':_0x4abdd8[_0x2e041b(0x18e)],'status':_0x2e041b(0x2eb),'createdAt':{'gte':_0x242495,'lte':_0x2d0af4}},'select':{'amount':!![]}});_0x33c223=_0x27dbc2['reduce']((_0x230d78,_0x1e5ede)=>_0x230d78+_0x1e5ede['amount'],0x0);const _0x39cc21=await database_1[_0x2e041b(0x1e9)][_0x2e041b(0x25e)][_0x2e041b(0x355)]({'where':{'shopId':_0x4abdd8[_0x2e041b(0x18e)],'status':_0x2e041b(0x2a9),'createdAt':{'gte':_0x242495,'lte':_0x2d0af4}},'select':{'amount':!![]}});_0x1d1875=_0x39cc21[_0x2e041b(0x278)]((_0x53a392,_0xbc27aa)=>_0x53a392+_0xbc27aa[_0x2e041b(0x228)],0x0);}const _0x462c8c=_0x231031,_0x25e4d=_0x51d7d8[_0x2e041b(0x21f)],_0x315012=_0x25e4d>0x0?_0x51539e/_0x25e4d:0x0,_0x368788=_0x462c8c>0x0?Math[_0x2e041b(0x197)](_0x25e4d/_0x462c8c*0x2710)/0x64:0x0,_0x3e8456=Math[_0x2e041b(0x34b)]((_0x2d0af4[_0x2e041b(0x229)]()-_0x242495['getTime']())/(0x3e8*0x3c*0x3c*0x18)),_0xabaa75={'totalTurnover':Math[_0x2e041b(0x197)](_0x51539e*0x64)/0x64,'merchantEarnings':Math[_0x2e041b(0x197)](_0x3a17fb*0x64)/0x64,'gatewayEarnings':Math['round'](_0x1b2292*0x64)/0x64,'totalPaidOut':Math[_0x2e041b(0x197)](_0x33c223*0x64)/0x64,'pendingPayout':Math[_0x2e041b(0x197)](_0x1d1875*0x64)/0x64,'averageCheck':Math[_0x2e041b(0x197)](_0x315012*0x64)/0x64,'totalPayments':_0x462c8c,'successfulPayments':_0x25e4d,'conversionRate':_0x368788,'chargebacks':_0x45fb23,'refunds':_0x936b00,'gatewayBreakdown':Object[_0x2e041b(0x35f)](_0x17bcdd)[_0x2e041b(0x30d)](_0x1d58fc=>({..._0x1d58fc,'turnoverUSDT':Math[_0x2e041b(0x197)](_0x1d58fc[_0x2e041b(0x1b7)]*0x64)/0x64,'commissionUSDT':Math[_0x2e041b(0x197)](_0x1d58fc[_0x2e041b(0x2f9)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x2e041b(0x197)](_0x1d58fc['merchantEarningsUSDT']*0x64)/0x64,'averageCommissionRate':Math[_0x2e041b(0x197)](_0x1d58fc[_0x2e041b(0x2a7)]*0x64)/0x64})),'merchantBreakdown':_0x4abdd8[_0x2e041b(0x18e)]?undefined:Object[_0x2e041b(0x35f)](_0x1e872d)['map'](_0x3b93a5=>({..._0x3b93a5,'turnoverUSDT':Math[_0x2e041b(0x197)](_0x3b93a5[_0x2e041b(0x1b7)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x3b93a5['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x3b93a5[_0x2e041b(0x1be)]*0x64)/0x64,'paidOutUSDT':Math[_0x2e041b(0x197)](_0x3b93a5[_0x2e041b(0x2c6)]*0x64)/0x64,'averageCheckUSDT':Math[_0x2e041b(0x197)](_0x3b93a5[_0x2e041b(0x1fb)]*0x64)/0x64})),'dailyData':Object['values'](_0x5ee6fd)['map'](_0x1ba20d=>({..._0x1ba20d,'turnover':Math['round'](_0x1ba20d['turnover']*0x64)/0x64,'merchantEarnings':Math[_0x2e041b(0x197)](_0x1ba20d[_0x2e041b(0x313)]*0x64)/0x64,'gatewayEarnings':Math[_0x2e041b(0x197)](_0x1ba20d[_0x2e041b(0x2c9)]*0x64)/0x64}))[_0x2e041b(0x1ef)]((_0x37f1a3,_0x3c8249)=>_0x37f1a3['date'][_0x2e041b(0x2fb)](_0x3c8249['date'])),'periodInfo':{'from':_0x242495,'to':_0x2d0af4,'periodType':_0x4abdd8[_0x2e041b(0x1d8)]||_0x2e041b(0x32d),'daysCount':_0x3e8456}};return console[_0x2e041b(0x1ba)]('ðŸ“Š\x20Merchant\x20statistics\x20calculated:'),console[_0x2e041b(0x1ba)](_0x2e041b(0x2d6)+_0xabaa75['totalTurnover']+_0x2e041b(0x189)),console[_0x2e041b(0x1ba)]('\x20\x20\x20ðŸ‘¤\x20Merchant\x20earnings:\x20'+_0xabaa75[_0x2e041b(0x313)]+_0x2e041b(0x189)),console[_0x2e041b(0x1ba)]('\x20\x20\x20ðŸª\x20Gateway\x20earnings:\x20'+_0xabaa75[_0x2e041b(0x2c9)]+'\x20USDT'),console['log'](_0x2e041b(0x1f2)+_0xabaa75['totalPaidOut']+_0x2e041b(0x189)),console[_0x2e041b(0x1ba)](_0x2e041b(0x1ac)+_0xabaa75[_0x2e041b(0x335)]+'\x20USDT'),console['log'](_0x2e041b(0x318)+_0xabaa75[_0x2e041b(0x18b)]),_0xabaa75;}async[a53_0x1045ef(0x200)](_0x16dbb1){const _0x2af43d=a53_0x1045ef;console[_0x2af43d(0x1ba)](_0x2af43d(0x1a4),{'hasPayoutHistory':_0x16dbb1});let _0x60c1fd={};_0x16dbb1&&(_0x60c1fd['payouts']={'some':{}});const _0xe92ab3=await database_1['default'][_0x2af43d(0x305)][_0x2af43d(0x355)]({'where':_0x60c1fd,'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x2af43d(0x19e)}});return console[_0x2af43d(0x1ba)](_0x2af43d(0x273)+_0xe92ab3[_0x2af43d(0x21f)]+_0x2af43d(0x1e2)+(_0x16dbb1?_0x2af43d(0x281):'')),_0xe92ab3[_0x2af43d(0x30d)](_0x463372=>({'id':_0x463372['id'],'username':_0x463372[_0x2af43d(0x302)],'name':_0x463372[_0x2af43d(0x31c)]}));}[a53_0x1045ef(0x29a)](_0xea7914){const _0x1bb7fd=a53_0x1045ef,_0x1dddd0={'test_gateway':_0x1bb7fd(0x20e),'plisio':_0x1bb7fd(0x1ea),'rapyd':_0x1bb7fd(0x321),'noda':_0x1bb7fd(0x35c),'cointopay':_0x1bb7fd(0x19d),'cointopay2':_0x1bb7fd(0x2bc),'klyme_eu':_0x1bb7fd(0x2dc),'klyme_gb':'KLYME\x20GB','klyme_de':_0x1bb7fd(0x1c2),'mastercard':_0x1bb7fd(0x1c6),'visa/mastercard':_0x1bb7fd(0x1fd),'amer':_0x1bb7fd(0x193),'myxspend':_0x1bb7fd(0x300),'ampay':_0x1bb7fd(0x2d9),'ampay_try':'AmPay\x20TRY','sepa':'Sepa','interac':_0x1bb7fd(0x26f),'onramp':_0x1bb7fd(0x22d),'squirrelpay':_0x1bb7fd(0x1c9),'maxpara':_0x1bb7fd(0x1b6),'instaxchange':_0x1bb7fd(0x314),'oxapay':_0x1bb7fd(0x244)};return _0x1dddd0[_0xea7914]||_0xea7914;}[a53_0x1045ef(0x31a)](_0x37658a){const _0xa28462=a53_0x1045ef,_0x216fcf={'Test\x20Gateway':_0xa28462(0x20c),'Plisio':_0xa28462(0x1b5),'Rapyd':'rapyd','Noda':_0xa28462(0x1bc),'CoinToPay':_0xa28462(0x1d7),'CoinToPay2':_0xa28462(0x2ba),'KLYME\x20EU':_0xa28462(0x31b),'KLYME\x20GB':_0xa28462(0x218),'KLYME\x20DE':_0xa28462(0x279),'MasterCard':'mastercard'};return _0x216fcf[_0x37658a]||_0x37658a[_0xa28462(0x269)]();}async[a53_0x1045ef(0x2fd)](_0x325bad){const _0x469be3=a53_0x1045ef,{page:_0x4de442,limit:_0x220c91,minAmount:_0x229112,search:_0x926764}=_0x325bad;console['log'](_0x469be3(0x215),_0x325bad);let _0xf49c28={};_0x926764&&(_0xf49c28[_0x469be3(0x31c)]={'contains':_0x926764,'mode':'insensitive'});const _0x35f283=await database_1[_0x469be3(0x1e9)]['shop'][_0x469be3(0x355)]({'where':_0xf49c28,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),_0x4fd586=_0x35f283['filter'](_0x2cf71b=>{const _0x32ae59=_0x469be3,_0x4b547b=Math[_0x32ae59(0x1e0)](_0x2cf71b['balance']*0x64)/0x64;if(_0x229112&&_0x4b547b<_0x229112)return![];return _0x4b547b!==0x0;});_0x4fd586[_0x469be3(0x1ef)]((_0x3acbe0,_0x211d42)=>_0x211d42[_0x469be3(0x1ab)]-_0x3acbe0[_0x469be3(0x1ab)]);const _0x565683=_0x4fd586[_0x469be3(0x21f)],_0x1db262=(_0x4de442-0x1)*_0x220c91,_0x3b4c06=_0x4fd586[_0x469be3(0x2e2)](_0x1db262,_0x1db262+_0x220c91);console[_0x469be3(0x1ba)]('ðŸ’°\x20Found\x20'+_0x3b4c06['length']+_0x469be3(0x1c0));const _0x53f717=await Promise[_0x469be3(0x20b)](_0x3b4c06['map'](async _0x5f1ce7=>{const _0x390916=_0x469be3,[_0x1de790,_0x2fe475,_0x34c621]=await Promise[_0x390916(0x20b)]([database_1[_0x390916(0x1e9)][_0x390916(0x2fc)]['count']({'where':{'shopId':_0x5f1ce7['id'],'status':_0x390916(0x221),'gateway':{'not':_0x390916(0x20c)}}}),database_1[_0x390916(0x1e9)][_0x390916(0x2fc)][_0x390916(0x2af)]({'where':{'shopId':_0x5f1ce7['id'],'status':'PAID','gateway':{'not':_0x390916(0x20c)}},'orderBy':{'paidAt':_0x390916(0x19e)},'select':{'paidAt':!![]}}),database_1[_0x390916(0x1e9)][_0x390916(0x2fc)][_0x390916(0x2df)]({'by':[_0x390916(0x31d)],'where':{'shopId':_0x5f1ce7['id'],'status':'PAID','gateway':{'not':'test_gateway'}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x2e791a=new Date(),_0x5237ef=new Date(_0x2e791a[_0x390916(0x18c)](),_0x2e791a['getMonth'](),0x1),_0x36608c=new Date(_0x2e791a[_0x390916(0x18c)](),_0x2e791a[_0x390916(0x326)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x2ce659,_0x1a92f8]=await Promise[_0x390916(0x20b)]([database_1['default']['payout'][_0x390916(0x32c)]({'_sum':{'amount':!![]},'where':{'shopId':_0x5f1ce7['id'],'status':_0x390916(0x2eb)}}),database_1[_0x390916(0x1e9)][_0x390916(0x25e)][_0x390916(0x32c)]({'_sum':{'amount':!![]},'where':{'shopId':_0x5f1ce7['id'],'status':_0x390916(0x2eb),'createdAt':{'gte':_0x5237ef,'lte':_0x36608c}}})]),_0x2d5ad8=_0x2ce659[_0x390916(0x21d)][_0x390916(0x228)]||0x0,_0x3f9aef=_0x1a92f8[_0x390916(0x21d)][_0x390916(0x228)]||0x0,_0x6ff0ef=await Promise[_0x390916(0x20b)](_0x34c621[_0x390916(0x30d)](async _0x3e6f0c=>{const _0x32862e=_0x390916,_0x28462f=await database_1[_0x32862e(0x1e9)][_0x32862e(0x2fc)]['findMany']({'where':{'shopId':_0x5f1ce7['id'],'status':_0x32862e(0x221),'gateway':_0x3e6f0c[_0x32862e(0x31d)]},'select':{'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![]}});let _0x266838=0x2d;if(_0x5f1ce7['gatewaySettings'])try{const _0x277e9e=JSON[_0x32862e(0x1d6)](_0x5f1ce7[_0x32862e(0x265)]);for(const [_0x35028f,_0x1d3fdb]of Object[_0x32862e(0x298)](_0x277e9e)){if(_0x35028f[_0x32862e(0x269)]()===_0x3e6f0c[_0x32862e(0x31d)][_0x32862e(0x269)]()){_0x266838=_0x1d3fdb['commission']||0xa,console[_0x32862e(0x1ba)](_0x32862e(0x2e8)+_0x3e6f0c[_0x32862e(0x31d)]+_0x32862e(0x319)+_0x5f1ce7['id']+_0x32862e(0x201)+_0x266838+'%');break;}}}catch(_0x107ea1){console[_0x32862e(0x31f)]('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x5f1ce7['id']+':',_0x107ea1);}const _0x40c9cc=_0x3e6f0c[_0x32862e(0x21d)]?.[_0x32862e(0x2cb)]||0x0;let _0x356a0d=0x0;for(const _0x50a39b of _0x28462f){if(_0x50a39b[_0x32862e(0x203)]!==null&&_0x50a39b['amountAfterGatewayCommissionUSDT']!==undefined)_0x356a0d+=_0x50a39b[_0x32862e(0x203)];else{const _0x5d3ad1=_0x50a39b[_0x32862e(0x2cb)]||0x0;_0x356a0d+=_0x5d3ad1*(0x1-_0x266838/0x64);}}return{'gateway':_0x3e6f0c[_0x32862e(0x31d)],'count':_0x3e6f0c[_0x32862e(0x287)]?.['id']||0x0,'amountUSDT':Math['round'](_0x40c9cc*0x64)/0x64,'amountAfterCommissionUSDT':Math['round'](_0x356a0d*0x64)/0x64,'commission':_0x266838};})),_0x4114c1=_0x6ff0ef['reduce']((_0x564f65,_0x5234d1)=>_0x564f65+_0x5234d1['amountUSDT'],0x0),_0x2605da=_0x6ff0ef[_0x390916(0x278)]((_0x589558,_0x35edc6)=>_0x589558+_0x35edc6[_0x390916(0x308)],0x0),_0xe095cf=_0x5f1ce7[_0x390916(0x1ab)];return console[_0x390916(0x1ba)]('ðŸ’°\x20[PAYOUT]\x20Merchant\x20'+_0x5f1ce7[_0x390916(0x302)]+':'),console['log'](_0x390916(0x222)+_0x4114c1['toFixed'](0x2)+'\x20USDT\x20(gross\x20revenue)'),console[_0x390916(0x1ba)](_0x390916(0x25b)+_0x2605da[_0x390916(0x2e5)](0x2)+'\x20USDT\x20(theoretical\x20net)'),console['log'](_0x390916(0x1f3)+_0xe095cf[_0x390916(0x2e5)](0x2)+_0x390916(0x293)),console[_0x390916(0x1ba)]('\x20\x20\x20ðŸ’¸\x20Total\x20payouts:\x20'+_0x2d5ad8[_0x390916(0x2e5)](0x2)+'\x20USDT\x20(already\x20paid\x20out)'),console['log'](_0x390916(0x2b3)+(_0x2605da-_0x2d5ad8-_0xe095cf)[_0x390916(0x2e5)](0x2)+_0x390916(0x33e)),{'id':_0x5f1ce7['id'],'fullName':_0x5f1ce7[_0x390916(0x31c)],'username':_0x5f1ce7[_0x390916(0x302)],'telegramId':_0x5f1ce7[_0x390916(0x195)],'merchantUrl':_0x5f1ce7['shopUrl'],'wallets':{'usdtPolygonWallet':_0x5f1ce7[_0x390916(0x2e3)],'usdtTrcWallet':_0x5f1ce7['usdtTrcWallet'],'usdtErcWallet':_0x5f1ce7[_0x390916(0x32b)],'usdcPolygonWallet':_0x5f1ce7['usdcPolygonWallet'],'usdcErcWallet':_0x5f1ce7[_0x390916(0x28d)]},'totalAmountUSDT':Math[_0x390916(0x197)](_0x4114c1*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x390916(0x197)](_0x2605da*0x64)/0x64,'currentBalance':Math[_0x390916(0x1e0)](_0xe095cf*0x64)/0x64,'totalPayout':Math['round'](_0x2d5ad8*0x64)/0x64,'thisMonth':Math['round'](_0x3f9aef*0x64)/0x64,'paymentsCount':_0x1de790,'oldestPaymentDate':_0x2fe475?.[_0x390916(0x316)]||_0x5f1ce7[_0x390916(0x324)],'gatewayBreakdown':_0x6ff0ef};})),_0x66474d=_0x53f717['reduce']((_0x2d71bf,_0x446852)=>_0x2d71bf+_0x446852[_0x469be3(0x264)],0x0),_0x4bedc1=_0x53f717['reduce']((_0x2d8d82,_0x3eccd8)=>_0x2d8d82+_0x3eccd8[_0x469be3(0x232)],0x0),_0x3972a3=_0x53f717['reduce']((_0x34aac7,_0x3acb77)=>_0x34aac7+_0x3acb77['totalPayout'],0x0),_0x3827d8=_0x53f717['reduce']((_0x1af86c,_0x312a2b)=>_0x1af86c+_0x312a2b[_0x469be3(0x1aa)],0x0);return console[_0x469be3(0x1ba)](_0x469be3(0x1dd)+_0x565683+'\x20merchants'),console[_0x469be3(0x1ba)](_0x469be3(0x2dd)+Math[_0x469be3(0x197)](_0x66474d*0x64)/0x64+'\x20USDT\x20(gross\x20revenue)'),console[_0x469be3(0x1ba)](_0x469be3(0x194)+Math[_0x469be3(0x197)](_0x4bedc1*0x64)/0x64+_0x469be3(0x22b)),console[_0x469be3(0x1ba)](_0x469be3(0x33c)+Math[_0x469be3(0x197)](_0x3972a3*0x64)/0x64+_0x469be3(0x189)),console[_0x469be3(0x1ba)](_0x469be3(0x25f)+Math[_0x469be3(0x197)](_0x3827d8*0x64)/0x64+'\x20USDT'),{'merchants':_0x53f717,'pagination':{'page':_0x4de442,'limit':_0x220c91,'total':_0x565683,'totalPages':Math[_0x469be3(0x34b)](_0x565683/_0x220c91)},'summary':{'totalMerchants':_0x565683,'totalAmountUSDT':Math['round'](_0x66474d*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x469be3(0x197)](_0x4bedc1*0x64)/0x64,'totalPayout':Math[_0x469be3(0x197)](_0x3972a3*0x64)/0x64,'thisMonth':Math[_0x469be3(0x197)](_0x3827d8*0x64)/0x64}};}async['createPayout'](_0x523041){const _0xaa5846=a53_0x1045ef,{shopId:_0x4aaabc,amount:_0x23981c,network:_0x6e7d9a,wallet:_0x349bbe,notes:_0x41e13e,txid:_0x3eee40,periodFrom:_0x32c342,periodTo:_0x250a01}=_0x523041,_0x5a5527=await database_1[_0xaa5846(0x1e9)][_0xaa5846(0x277)](async _0x3fcd9d=>{const _0xc6f2eb=_0xaa5846,_0xd73fd0=await _0x3fcd9d[_0xc6f2eb(0x305)][_0xc6f2eb(0x283)]({'where':{'id':_0x4aaabc},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0xd73fd0)throw new Error(_0xc6f2eb(0x345));console[_0xc6f2eb(0x1ba)](_0xc6f2eb(0x18f)+_0xd73fd0['username']+':'),console[_0xc6f2eb(0x1ba)](_0xc6f2eb(0x2fe)+_0xd73fd0['balance'][_0xc6f2eb(0x2e5)](0x6)+'\x20USDT'),console[_0xc6f2eb(0x1ba)](_0xc6f2eb(0x291)+_0x23981c[_0xc6f2eb(0x2e5)](0x6)+'\x20USDT'),console[_0xc6f2eb(0x1ba)]('\x20\x20\x20Current\x20total\x20paid\x20out:\x20'+_0xd73fd0['totalPaidOut'][_0xc6f2eb(0x2e5)](0x6)+_0xc6f2eb(0x189));if(_0x3eee40)console['log'](_0xc6f2eb(0x35e)+_0x3eee40);const _0x502d04=0.000001,_0x2ad2db=Number(_0xd73fd0[_0xc6f2eb(0x1ab)]),_0x348f42=Number(_0x23981c);console[_0xc6f2eb(0x1ba)](_0xc6f2eb(0x357)),console[_0xc6f2eb(0x1ba)](_0xc6f2eb(0x219)+_0xd73fd0[_0xc6f2eb(0x1ab)]),console[_0xc6f2eb(0x1ba)](_0xc6f2eb(0x220)+_0x2ad2db),console['log']('\x20\x20\x20Requested\x20(number):\x20'+_0x348f42),console[_0xc6f2eb(0x1ba)]('\x20\x20\x20Difference:\x20'+(_0x2ad2db-_0x348f42)),console[_0xc6f2eb(0x1ba)]('\x20\x20\x20Tolerance:\x20'+_0x502d04);if(_0x2ad2db<_0x348f42-_0x502d04)throw new Error(_0xc6f2eb(0x28e)+_0x2ad2db[_0xc6f2eb(0x2e5)](0x6)+_0xc6f2eb(0x248)+_0x348f42[_0xc6f2eb(0x2e5)](0x6)+_0xc6f2eb(0x253)+(_0x2ad2db-_0x348f42)[_0xc6f2eb(0x2e5)](0x8)+_0xc6f2eb(0x189));console[_0xc6f2eb(0x1ba)]('âœ…\x20Balance\x20check\x20passed\x20(with\x20tolerance)');const _0x5b4dcd=Math[_0xc6f2eb(0x1a0)](_0x2ad2db,_0x348f42);let _0x37b8f9=_0x349bbe;console[_0xc6f2eb(0x1ba)](_0xc6f2eb(0x297)+(_0x349bbe||_0xc6f2eb(0x336)));if(!_0x37b8f9){console[_0xc6f2eb(0x1ba)](_0xc6f2eb(0x274));const _0x12762a=await _0x3fcd9d[_0xc6f2eb(0x305)][_0xc6f2eb(0x283)]({'where':{'id':_0x4aaabc},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});console[_0xc6f2eb(0x1ba)](_0xc6f2eb(0x199),_0x12762a);if(_0x12762a)switch(_0x6e7d9a){case'polygon':_0x37b8f9=_0x12762a[_0xc6f2eb(0x2e3)]||undefined,console['log'](_0xc6f2eb(0x23a)+_0x37b8f9);break;case'trc20':_0x37b8f9=_0x12762a['usdtTrcWallet']||undefined,console['log']('ðŸ”\x20Selected\x20trc20\x20wallet:\x20'+_0x37b8f9);break;case _0xc6f2eb(0x224):_0x37b8f9=_0x12762a[_0xc6f2eb(0x32b)]||undefined,console[_0xc6f2eb(0x1ba)](_0xc6f2eb(0x2e4)+_0x37b8f9);break;case _0xc6f2eb(0x35b):_0x37b8f9=_0x12762a[_0xc6f2eb(0x1b4)]||undefined,console[_0xc6f2eb(0x1ba)]('ðŸ”\x20Selected\x20polygon_usdc\x20wallet:\x20'+_0x37b8f9);break;case _0xc6f2eb(0x24b):_0x37b8f9=_0x12762a[_0xc6f2eb(0x28d)]||undefined,console[_0xc6f2eb(0x1ba)](_0xc6f2eb(0x1a2)+_0x37b8f9);break;}}else console[_0xc6f2eb(0x1ba)](_0xc6f2eb(0x227)+_0x37b8f9);console['log']('ðŸ’³\x20Final\x20payout\x20wallet\x20for\x20'+_0x6e7d9a+':\x20'+(_0x37b8f9||_0xc6f2eb(0x2a4))),console[_0xc6f2eb(0x1ba)](_0xc6f2eb(0x301),{'shopId':_0x4aaabc,'amount':_0x5b4dcd,'network':_0x6e7d9a,'wallet':_0x37b8f9,'status':_0xc6f2eb(0x2eb),'txid':_0x3eee40,'notes':_0x41e13e,'periodFrom':_0x32c342?new Date(_0x32c342):null,'periodTo':_0x250a01?new Date(_0x250a01):null});const _0x222a3a=await _0x3fcd9d['payout'][_0xc6f2eb(0x2de)]({'data':{'shopId':_0x4aaabc,'amount':_0x5b4dcd,'network':_0x6e7d9a,'wallet':_0x37b8f9,'status':_0xc6f2eb(0x2eb),'txid':_0x3eee40,'notes':_0x41e13e,'periodFrom':_0x32c342?new Date(_0x32c342):null,'periodTo':_0x250a01?new Date(_0x250a01):null,'createdAt':new Date(),'paidAt':new Date()}});console['log'](_0xc6f2eb(0x296),{'id':_0x222a3a['id'],'wallet':_0x222a3a[_0xc6f2eb(0x1ca)],'network':_0x222a3a[_0xc6f2eb(0x29d)],'amount':_0x222a3a[_0xc6f2eb(0x228)]});const _0x5c8fd3=_0x2ad2db-_0x5b4dcd,_0x510f9a=Number(_0xd73fd0[_0xc6f2eb(0x292)])+_0x5b4dcd;return await _0x3fcd9d[_0xc6f2eb(0x305)]['update']({'where':{'id':_0x4aaabc},'data':{'balance':_0x5c8fd3,'totalPaidOut':_0x510f9a}}),console[_0xc6f2eb(0x1ba)]('ðŸ’°\x20Shop\x20'+_0xd73fd0[_0xc6f2eb(0x302)]+'\x20balance\x20updated:'),console[_0xc6f2eb(0x1ba)](_0xc6f2eb(0x209)+_0x2ad2db['toFixed'](0x6)+_0xc6f2eb(0x1c3)+_0x5c8fd3[_0xc6f2eb(0x2e5)](0x6)+_0xc6f2eb(0x212)+_0x5b4dcd[_0xc6f2eb(0x2e5)](0x6)+')'),console[_0xc6f2eb(0x1ba)](_0xc6f2eb(0x2c2)+_0xd73fd0[_0xc6f2eb(0x292)][_0xc6f2eb(0x2e5)](0x6)+_0xc6f2eb(0x1c3)+_0x510f9a[_0xc6f2eb(0x2e5)](0x6)+'\x20USDT\x20(+'+_0x5b4dcd[_0xc6f2eb(0x2e5)](0x6)+')'),console[_0xc6f2eb(0x1ba)]('\x20\x20\x20Final\x20payout\x20amount\x20used:\x20'+_0x5b4dcd[_0xc6f2eb(0x2e5)](0x6)+_0xc6f2eb(0x189)),{'payout':_0x222a3a,'shop':_0xd73fd0};});console[_0xaa5846(0x1ba)]('âœ…\x20Payout\x20created:\x20'+_0x5a5527[_0xaa5846(0x25e)]['id']+_0xaa5846(0x319)+_0x5a5527[_0xaa5846(0x305)][_0xaa5846(0x302)]+'\x20('+_0x5a5527[_0xaa5846(0x25e)][_0xaa5846(0x228)][_0xaa5846(0x2e5)](0x6)+'\x20USDT)');try{let _0x13b8e1=_0xaa5846(0x2c5);if(_0x5a5527[_0xaa5846(0x25e)][_0xaa5846(0x1ee)]&&_0x5a5527['payout'][_0xaa5846(0x268)]){const _0x2a8247=new Date(_0x5a5527[_0xaa5846(0x25e)]['periodFrom'])[_0xaa5846(0x249)]('ru-RU'),_0x52cf37=new Date(_0x5a5527[_0xaa5846(0x25e)][_0xaa5846(0x268)])['toLocaleDateString'](_0xaa5846(0x2a5));_0x13b8e1=_0x2a8247+_0xaa5846(0x25c)+_0x52cf37;}await telegramBotService_1['telegramBotService']['sendPayoutNotification'](_0x5a5527[_0xaa5846(0x25e)][_0xaa5846(0x18e)],{'id':_0x5a5527['payout']['id'],'amount':_0x5a5527[_0xaa5846(0x25e)][_0xaa5846(0x228)],'network':_0x5a5527['payout'][_0xaa5846(0x29d)],'wallet':_0x5a5527[_0xaa5846(0x25e)][_0xaa5846(0x1ca)],'period':_0x13b8e1,'createdAt':_0x5a5527['payout'][_0xaa5846(0x324)],'txid':_0x5a5527['payout']['txid']}),console['log']('ðŸ“±\x20Telegram\x20notification\x20sent\x20for\x20payout\x20'+_0x5a5527[_0xaa5846(0x25e)]['id']);}catch(_0x4b00e6){console['error'](_0xaa5846(0x331)+_0x5a5527[_0xaa5846(0x25e)]['id']+':',_0x4b00e6);}return{'id':_0x5a5527['payout']['id'],'shopId':_0x5a5527[_0xaa5846(0x25e)][_0xaa5846(0x18e)],'shopName':_0x5a5527[_0xaa5846(0x305)][_0xaa5846(0x31c)],'shopUsername':_0x5a5527['shop'][_0xaa5846(0x302)],'amount':_0x5a5527[_0xaa5846(0x25e)][_0xaa5846(0x228)],'network':_0x5a5527['payout']['network'],'wallet':_0x5a5527[_0xaa5846(0x25e)][_0xaa5846(0x1ca)],'status':_0x5a5527[_0xaa5846(0x25e)][_0xaa5846(0x28b)],'txid':_0x5a5527['payout']['txid'],'notes':_0x5a5527[_0xaa5846(0x25e)]['notes'],'periodFrom':_0x5a5527[_0xaa5846(0x25e)][_0xaa5846(0x1ee)],'periodTo':_0x5a5527['payout'][_0xaa5846(0x268)],'createdAt':_0x5a5527['payout']['createdAt'],'paidAt':_0x5a5527[_0xaa5846(0x25e)][_0xaa5846(0x316)]};}async[a53_0x1045ef(0x1af)](_0x4bcd53){const _0x3b014f=a53_0x1045ef,{page:_0x52988c,limit:_0x51c075,shopId:_0x468b50,network:_0x34a4b4,dateFrom:_0x3907ae,dateTo:_0x2e65dc,search:_0x3526e}=_0x4bcd53,_0x53beff=(_0x52988c-0x1)*_0x51c075,_0x3b0737={};_0x468b50&&(_0x3b0737[_0x3b014f(0x18e)]=_0x468b50);_0x34a4b4&&(_0x3b0737['network']=_0x34a4b4);if(_0x3907ae||_0x2e65dc){_0x3b0737['createdAt']={};if(_0x3907ae){const _0x4d0f86=new Date(_0x3907ae);_0x4d0f86[_0x3b014f(0x250)](0x0,0x0,0x0,0x1),_0x3b0737['createdAt'][_0x3b014f(0x205)]=_0x4d0f86,console['log'](_0x3b014f(0x240)+_0x4d0f86['toISOString']());}if(_0x2e65dc){const _0x5c6975=new Date(_0x2e65dc);_0x5c6975['setHours'](0x17,0x3b,0x3b,0x3e7),_0x3b0737[_0x3b014f(0x324)][_0x3b014f(0x328)]=_0x5c6975,console['log'](_0x3b014f(0x247)+_0x5c6975[_0x3b014f(0x312)]());}}_0x3526e&&(_0x3b0737['OR']=[{'shop':{'name':{'contains':_0x3526e,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x3526e,'mode':_0x3b014f(0x1e4)}}},{'notes':{'contains':_0x3526e,'mode':'insensitive'}}]);const [_0x5123cd,_0x5a3b60]=await Promise[_0x3b014f(0x20b)]([database_1['default'][_0x3b014f(0x25e)][_0x3b014f(0x355)]({'where':_0x3b0737,'skip':_0x53beff,'take':_0x51c075,'orderBy':{'createdAt':_0x3b014f(0x34c)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'wallet':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x3b014f(0x1e9)][_0x3b014f(0x25e)]['count']({'where':_0x3b0737})]);return{'payouts':_0x5123cd['map'](_0x153c5e=>({'id':_0x153c5e['id'],'shopId':_0x153c5e[_0x3b014f(0x18e)],'shopName':_0x153c5e[_0x3b014f(0x305)]['name'],'shopUsername':_0x153c5e[_0x3b014f(0x305)]['username'],'amount':_0x153c5e[_0x3b014f(0x228)],'network':_0x153c5e['network'],'wallet':_0x153c5e[_0x3b014f(0x1ca)],'status':_0x153c5e['status'],'txid':_0x153c5e[_0x3b014f(0x233)],'notes':_0x153c5e['notes'],'periodFrom':_0x153c5e['periodFrom'],'periodTo':_0x153c5e[_0x3b014f(0x268)],'createdAt':_0x153c5e[_0x3b014f(0x324)],'paidAt':_0x153c5e['paidAt']})),'pagination':{'page':_0x52988c,'limit':_0x51c075,'total':_0x5a3b60,'totalPages':Math['ceil'](_0x5a3b60/_0x51c075)}};}async['getPayoutById'](_0x520306){const _0x2213c4=a53_0x1045ef,_0x3a834d=await database_1[_0x2213c4(0x1e9)]['payout'][_0x2213c4(0x283)]({'where':{'id':_0x520306},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x3a834d)return null;return{'id':_0x3a834d['id'],'shopId':_0x3a834d[_0x2213c4(0x18e)],'shopName':_0x3a834d[_0x2213c4(0x305)][_0x2213c4(0x31c)],'shopUsername':_0x3a834d[_0x2213c4(0x305)]['username'],'amount':_0x3a834d[_0x2213c4(0x228)],'network':_0x3a834d[_0x2213c4(0x29d)],'wallet':_0x3a834d['wallet'],'status':_0x3a834d[_0x2213c4(0x28b)],'txid':_0x3a834d[_0x2213c4(0x233)],'notes':_0x3a834d[_0x2213c4(0x2bb)],'periodFrom':_0x3a834d[_0x2213c4(0x1ee)],'periodTo':_0x3a834d[_0x2213c4(0x268)],'createdAt':_0x3a834d[_0x2213c4(0x324)],'paidAt':_0x3a834d['paidAt']};}async[a53_0x1045ef(0x272)](_0x563c4b){const _0x4fab3e=a53_0x1045ef;await database_1[_0x4fab3e(0x1e9)][_0x4fab3e(0x25e)][_0x4fab3e(0x352)]({'where':{'id':_0x563c4b}});}async[a53_0x1045ef(0x1b9)](_0x5abbb0,_0x10498e){const _0x4c56df=a53_0x1045ef,_0x1179e5=await database_1[_0x4c56df(0x1e9)][_0x4c56df(0x277)](async _0x91abf5=>{const _0x2e6aae=_0x4c56df,_0x8731c0=await _0x91abf5['payout'][_0x2e6aae(0x283)]({'where':{'id':_0x5abbb0},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}}}});if(!_0x8731c0)throw new Error(_0x2e6aae(0x243));console[_0x2e6aae(0x1ba)]('ðŸ’°\x20Updating\x20payout\x20'+_0x5abbb0+_0x2e6aae(0x319)+_0x8731c0[_0x2e6aae(0x305)][_0x2e6aae(0x302)]+':'),console[_0x2e6aae(0x1ba)](_0x2e6aae(0x2f0)+_0x8731c0[_0x2e6aae(0x228)][_0x2e6aae(0x2e5)](0x6)+_0x2e6aae(0x189)),console[_0x2e6aae(0x1ba)](_0x2e6aae(0x33d)+_0x8731c0[_0x2e6aae(0x29d)]),console[_0x2e6aae(0x1ba)](_0x2e6aae(0x2fa)+_0x8731c0[_0x2e6aae(0x305)][_0x2e6aae(0x1ab)][_0x2e6aae(0x2e5)](0x6)+_0x2e6aae(0x189)),console[_0x2e6aae(0x1ba)]('\x20\x20\x20Shop\x20totalPaidOut:\x20'+_0x8731c0[_0x2e6aae(0x305)][_0x2e6aae(0x292)][_0x2e6aae(0x2e5)](0x6)+'\x20USDT');let _0x545144=0x0;if(_0x10498e['amount']!==undefined){const _0x3d632e=Number(_0x8731c0[_0x2e6aae(0x228)]),_0x2d7a0a=Number(_0x10498e['amount']);_0x545144=_0x2d7a0a-_0x3d632e,console[_0x2e6aae(0x1ba)](_0x2e6aae(0x32f)+_0x2d7a0a['toFixed'](0x6)+_0x2e6aae(0x189)),console[_0x2e6aae(0x1ba)](_0x2e6aae(0x2ea)+_0x545144[_0x2e6aae(0x2e5)](0x6)+'\x20USDT');if(_0x545144<0x0)console['log']('\x20\x20\x20Amount\x20decreased\x20by\x20'+Math['abs'](_0x545144)[_0x2e6aae(0x2e5)](0x6)+_0x2e6aae(0x2a2));else{if(_0x545144>0x0){const _0x4e340b=Number(_0x8731c0[_0x2e6aae(0x305)][_0x2e6aae(0x1ab)]);console[_0x2e6aae(0x1ba)]('\x20\x20\x20Amount\x20increased\x20by\x20'+_0x545144[_0x2e6aae(0x2e5)](0x6)+_0x2e6aae(0x354));if(_0x4e340b<_0x545144)throw new Error('Insufficient\x20balance\x20for\x20amount\x20increase.\x20Available:\x20'+_0x4e340b[_0x2e6aae(0x2e5)](0x6)+_0x2e6aae(0x1f7)+_0x545144['toFixed'](0x6)+_0x2e6aae(0x189));}}}const _0x559d03={};if(_0x10498e[_0x2e6aae(0x228)]!==undefined)_0x559d03['amount']=_0x10498e[_0x2e6aae(0x228)];if(_0x10498e[_0x2e6aae(0x29d)]!==undefined)_0x559d03[_0x2e6aae(0x29d)]=_0x10498e[_0x2e6aae(0x29d)];if(_0x10498e['wallet']!==undefined)_0x559d03[_0x2e6aae(0x1ca)]=_0x10498e['wallet']||null;if(_0x10498e[_0x2e6aae(0x2bb)]!==undefined)_0x559d03['notes']=_0x10498e[_0x2e6aae(0x2bb)]||null;if(_0x10498e[_0x2e6aae(0x233)]!==undefined)_0x559d03[_0x2e6aae(0x233)]=_0x10498e[_0x2e6aae(0x233)]||null;if(_0x10498e['periodFrom']!==undefined)_0x559d03['periodFrom']=_0x10498e['periodFrom']?new Date(_0x10498e[_0x2e6aae(0x1ee)]):null;if(_0x10498e['periodTo']!==undefined)_0x559d03[_0x2e6aae(0x268)]=_0x10498e[_0x2e6aae(0x268)]?new Date(_0x10498e[_0x2e6aae(0x268)]):null;const _0x5acee5=await _0x91abf5[_0x2e6aae(0x25e)][_0x2e6aae(0x2f7)]({'where':{'id':_0x5abbb0},'data':_0x559d03,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(_0x545144!==0x0){const _0x2f107b=Number(_0x8731c0[_0x2e6aae(0x305)][_0x2e6aae(0x1ab)]),_0x32552e=Number(_0x8731c0[_0x2e6aae(0x305)][_0x2e6aae(0x292)]),_0x57153c=_0x2f107b-_0x545144,_0x1dc69a=_0x32552e+_0x545144;await _0x91abf5['shop'][_0x2e6aae(0x2f7)]({'where':{'id':_0x8731c0[_0x2e6aae(0x18e)]},'data':{'balance':_0x57153c,'totalPaidOut':_0x1dc69a}}),console[_0x2e6aae(0x1ba)](_0x2e6aae(0x2aa)+_0x8731c0[_0x2e6aae(0x305)][_0x2e6aae(0x302)]+_0x2e6aae(0x256)),console[_0x2e6aae(0x1ba)](_0x2e6aae(0x209)+_0x2f107b[_0x2e6aae(0x2e5)](0x6)+'\x20->\x20'+_0x57153c[_0x2e6aae(0x2e5)](0x6)+_0x2e6aae(0x189)),console[_0x2e6aae(0x1ba)]('\x20\x20\x20Total\x20paid\x20out:\x20'+_0x32552e[_0x2e6aae(0x2e5)](0x6)+_0x2e6aae(0x1c3)+_0x1dc69a['toFixed'](0x6)+_0x2e6aae(0x189));}return console[_0x2e6aae(0x1ba)](_0x2e6aae(0x288)+_0x5abbb0+_0x2e6aae(0x25a)),_0x5acee5;});return{'id':_0x1179e5['id'],'shopId':_0x1179e5[_0x4c56df(0x18e)],'shopName':_0x1179e5[_0x4c56df(0x305)][_0x4c56df(0x31c)],'shopUsername':_0x1179e5[_0x4c56df(0x305)]['username'],'amount':Number(_0x1179e5[_0x4c56df(0x228)]),'network':_0x1179e5[_0x4c56df(0x29d)],'wallet':_0x1179e5[_0x4c56df(0x1ca)],'status':_0x1179e5['status'],'txid':_0x1179e5['txid'],'notes':_0x1179e5[_0x4c56df(0x2bb)],'periodFrom':_0x1179e5[_0x4c56df(0x1ee)],'periodTo':_0x1179e5[_0x4c56df(0x268)],'createdAt':_0x1179e5[_0x4c56df(0x324)],'paidAt':_0x1179e5[_0x4c56df(0x316)]};}async[a53_0x1045ef(0x267)](_0x43fa62){const _0x145299=a53_0x1045ef,{page:_0x290331,limit:_0x2ef3b2,status:_0x59b3bd,gateway:_0x2d0a47,shopId:_0x330787,dateFrom:_0x5c022d,dateTo:_0x28c150,search:_0x356b5e,currency:_0x106f5f,sortBy:_0x15c149,sortOrder:_0x2b6a14}=_0x43fa62,_0x3a229b=(_0x290331-0x1)*_0x2ef3b2;console[_0x145299(0x1ba)](_0x145299(0x202),_0x43fa62);const _0x2ed2c6=await database_1['default'][_0x145299(0x2fc)][_0x145299(0x2df)]({'by':[_0x145299(0x31d)],'_count':{'gateway':!![]}});console['log'](_0x145299(0x306),_0x2ed2c6['map'](_0x35af09=>_0x35af09[_0x145299(0x31d)]+'\x20('+_0x35af09['_count'][_0x145299(0x31d)]+_0x145299(0x307)));if(_0x2d0a47){const _0x2741fd=_0x2ed2c6[_0x145299(0x266)](_0x480e26=>_0x480e26[_0x145299(0x31d)][_0x145299(0x269)]()===_0x2d0a47[_0x145299(0x269)]());!_0x2741fd&&_0x2d0a47[_0x145299(0x269)]()!==_0x145299(0x20c)&&console[_0x145299(0x1ba)](_0x145299(0x255)+_0x2d0a47+_0x145299(0x211)+_0x2ed2c6[_0x145299(0x30d)](_0x4ba4a3=>_0x4ba4a3[_0x145299(0x31d)])[_0x145299(0x348)](',\x20'));}const _0x7b7df7={};_0x59b3bd&&(_0x7b7df7[_0x145299(0x28b)]=_0x59b3bd[_0x145299(0x2f5)]());if(!_0x2d0a47)_0x7b7df7[_0x145299(0x31d)]={'not':_0x145299(0x20c)};else{if(_0x2d0a47&&(_0x2d0a47['toLowerCase']()===_0x145299(0x20c)||_0x2d0a47==='0000'))_0x7b7df7[_0x145299(0x31d)]='test_gateway';else{let _0x417e36=_0x2d0a47;const _0x17c45f=(0x0,gateway_1[_0x145299(0x231)])(_0x2d0a47);if(_0x17c45f)_0x417e36=_0x17c45f,console[_0x145299(0x1ba)](_0x145299(0x1a6)+_0x2d0a47+_0x145299(0x28f)+_0x417e36+'\x27');else{const _0x1c5a9e=(0x0,gateway_1[_0x145299(0x1d1)])(_0x2d0a47);if(_0x1c5a9e){const _0x8152b5=(0x0,gateway_1['getGatewayNameById'])(_0x1c5a9e);_0x8152b5&&(_0x417e36=_0x8152b5,console[_0x145299(0x1ba)](_0x145299(0x210)+_0x2d0a47+'\x27\x20->\x20ID\x20\x27'+_0x1c5a9e+_0x145299(0x284)+_0x417e36+'\x27'));}else console['log'](_0x145299(0x29b)+_0x2d0a47+_0x145299(0x1cc));}const _0x5391d1=await database_1['default'][_0x145299(0x2fc)][_0x145299(0x1d4)]({'where':{'gateway':_0x417e36['toLowerCase']()},'take':0x1});_0x5391d1===0x0?(console[_0x145299(0x1ba)](_0x145299(0x347)+_0x417e36+_0x145299(0x270)+_0x2d0a47+_0x145299(0x275)),_0x7b7df7['gateway']='NONEXISTENT_GATEWAY_FILTER'):(_0x7b7df7[_0x145299(0x31d)]=_0x417e36[_0x145299(0x269)](),console[_0x145299(0x1ba)]('âœ…\x20Using\x20gateway\x20filter:\x20\x27'+_0x417e36+_0x145299(0x270)+_0x2d0a47+'\x27)'));}}console['log'](_0x145299(0x1b1),_0x7b7df7[_0x145299(0x31d)]);_0x330787&&(_0x7b7df7[_0x145299(0x18e)]=_0x330787);_0x106f5f&&(_0x7b7df7['currency']=_0x106f5f[_0x145299(0x2f5)](),console[_0x145299(0x1ba)]('ðŸ’±\x20Currency\x20filter\x20applied:\x20'+_0x106f5f[_0x145299(0x2f5)]()));if(_0x5c022d||_0x28c150){_0x7b7df7['createdAt']={};if(_0x5c022d){const _0x2b3ac1=new Date(_0x5c022d),_0x386389=new Date(Date[_0x145299(0x315)](_0x2b3ac1['getUTCFullYear'](),_0x2b3ac1[_0x145299(0x190)](),_0x2b3ac1[_0x145299(0x1d9)](),0x0,0x0,0x0,0x0));_0x7b7df7['createdAt']['gte']=_0x386389,console[_0x145299(0x1ba)](_0x145299(0x343)+_0x386389[_0x145299(0x312)]());}if(_0x28c150){const _0x972233=new Date(_0x28c150),_0x975516=new Date(Date['UTC'](_0x972233[_0x145299(0x2b7)](),_0x972233[_0x145299(0x190)](),_0x972233[_0x145299(0x1d9)](),0x17,0x3b,0x3b,0x3e7));_0x7b7df7[_0x145299(0x324)][_0x145299(0x328)]=_0x975516,console[_0x145299(0x1ba)](_0x145299(0x21a)+_0x975516[_0x145299(0x312)]());}}_0x356b5e&&(_0x7b7df7['OR']=[{'id':{'contains':_0x356b5e,'mode':_0x145299(0x1e4)}},{'orderId':{'contains':_0x356b5e,'mode':_0x145299(0x1e4)}},{'gatewayOrderId':{'contains':_0x356b5e,'mode':'insensitive'}},{'customerEmail':{'contains':_0x356b5e,'mode':_0x145299(0x1e4)}},{'shop':{'name':{'contains':_0x356b5e,'mode':_0x145299(0x1e4)}}},{'shop':{'username':{'contains':_0x356b5e,'mode':'insensitive'}}}]);console[_0x145299(0x1ba)](_0x145299(0x356),JSON['stringify'](_0x7b7df7,null,0x2));const _0x55531a=await database_1[_0x145299(0x1e9)]['payment']['count']({'where':_0x7b7df7});console['log'](_0x145299(0x260)+_0x55531a);let _0x58723e={'createdAt':_0x145299(0x34c)};if(_0x15c149){const _0x3b4943=[_0x145299(0x228),'createdAt',_0x145299(0x2d4),_0x145299(0x28b),'gateway',_0x145299(0x1f5)],_0x351001=[_0x145299(0x19e),_0x145299(0x34c)];if(_0x3b4943[_0x145299(0x1df)](_0x15c149)){const _0x3cbc5e=_0x351001[_0x145299(0x1df)](_0x2b6a14)?_0x2b6a14:_0x145299(0x34c);_0x58723e={[_0x15c149]:_0x3cbc5e},console[_0x145299(0x1ba)]('ðŸ“Š\x20Sorting\x20payments\x20by\x20'+_0x15c149+_0x145299(0x2ef)+_0x3cbc5e+'\x20order');}}const [_0x599367,_0x2c3430]=await Promise[_0x145299(0x20b)]([database_1[_0x145299(0x1e9)]['payment'][_0x145299(0x355)]({'where':_0x7b7df7,'skip':_0x3a229b,'take':_0x2ef3b2,'orderBy':_0x58723e,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x145299(0x1e9)][_0x145299(0x2fc)][_0x145299(0x1d4)]({'where':_0x7b7df7})]);let _0x4fe19d,_0x10a1db;if(_0x5c022d){const _0x51f160=new Date(_0x5c022d);_0x4fe19d=new Date(Date[_0x145299(0x315)](_0x51f160[_0x145299(0x2b7)](),_0x51f160[_0x145299(0x190)](),_0x51f160['getUTCDate'](),0x0,0x0,0x0,0x0));}else{const _0x22ae98=new Date();_0x4fe19d=new Date(Date[_0x145299(0x315)](_0x22ae98['getUTCFullYear'](),_0x22ae98[_0x145299(0x190)](),_0x22ae98[_0x145299(0x1d9)](),0x0,0x0,0x0,0x0));}if(_0x28c150){const _0x50ac5d=new Date(_0x28c150);_0x10a1db=new Date(Date[_0x145299(0x315)](_0x50ac5d[_0x145299(0x2b7)](),_0x50ac5d[_0x145299(0x190)](),_0x50ac5d['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}else{if(_0x5c022d){const _0x1d54f3=new Date(_0x5c022d);_0x10a1db=new Date(Date[_0x145299(0x315)](_0x1d54f3[_0x145299(0x2b7)](),_0x1d54f3[_0x145299(0x190)](),_0x1d54f3['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}else{const _0x229e07=new Date();_0x10a1db=new Date(Date[_0x145299(0x315)](_0x229e07[_0x145299(0x2b7)](),_0x229e07[_0x145299(0x190)](),_0x229e07[_0x145299(0x1d9)](),0x17,0x3b,0x3b,0x3e7));}}const _0x2be1c5={};{const _0x463977={'status':_0x59b3bd?_0x59b3bd['toUpperCase']():_0x145299(0x221),'createdAt':{'gte':_0x4fe19d,'lte':_0x10a1db}};_0x2d0a47?_0x463977[_0x145299(0x31d)]=_0x7b7df7['gateway']:_0x463977[_0x145299(0x31d)]={'not':'test_gateway'};_0x330787&&(_0x463977[_0x145299(0x18e)]=_0x330787);_0x106f5f&&(_0x463977[_0x145299(0x1f5)]=_0x106f5f[_0x145299(0x2f5)]());console[_0x145299(0x1ba)](_0x145299(0x2b1),JSON[_0x145299(0x2d5)](_0x463977,null,0x2));const _0x29045c=await database_1[_0x145299(0x1e9)][_0x145299(0x2fc)][_0x145299(0x355)]({'where':_0x463977,'select':{'amountUSDT':!![],'currency':!![],'amount':!![]}});let _0x4e7bd0=0x0;_0x29045c[_0x145299(0x276)](_0x4d3522=>{const _0x2ebdec=_0x145299;_0x4d3522[_0x2ebdec(0x2cb)]&&(_0x4e7bd0+=_0x4d3522[_0x2ebdec(0x2cb)]);if(_0x4d3522[_0x2ebdec(0x1f5)]){const _0x4e481b=_0x4d3522[_0x2ebdec(0x1f5)]['toUpperCase']();!_0x2be1c5[_0x4e481b]&&(_0x2be1c5[_0x4e481b]=0x0),_0x2be1c5[_0x4e481b]+=_0x4d3522[_0x2ebdec(0x228)];}}),_0x4e7bd0>0x0&&(_0x2be1c5[_0x145299(0x196)]=_0x4e7bd0);}return{'payments':_0x599367,'pagination':{'page':_0x290331,'limit':_0x2ef3b2,'total':_0x2c3430,'totalPages':Math[_0x145299(0x34b)](_0x2c3430/_0x2ef3b2)},'statistics':_0x2be1c5};}async[a53_0x1045ef(0x217)](_0x1e66d4){const _0x2a1c06=a53_0x1045ef,_0x98a06d=await database_1[_0x2a1c06(0x1e9)]['payment'][_0x2a1c06(0x283)]({'where':{'id':_0x1e66d4},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x98a06d)return null;return{'id':_0x98a06d['id'],'shopId':_0x98a06d[_0x2a1c06(0x18e)],'gateway':_0x98a06d[_0x2a1c06(0x31d)],'amount':_0x98a06d['amount'],'currency':_0x98a06d[_0x2a1c06(0x1f5)],'status':_0x98a06d['status'],'orderId':_0x98a06d[_0x2a1c06(0x294)],'gatewayOrderId':_0x98a06d[_0x2a1c06(0x2f2)],'customerEmail':_0x98a06d['customerEmail'],'customerName':_0x98a06d[_0x2a1c06(0x225)],'customerCountry':_0x98a06d[_0x2a1c06(0x208)],'customerIp':_0x98a06d['customerIp'],'customerUa':_0x98a06d[_0x2a1c06(0x32e)],'failureMessage':_0x98a06d[_0x2a1c06(0x1fc)],'externalPaymentUrl':_0x98a06d[_0x2a1c06(0x30b)],'successUrl':_0x98a06d[_0x2a1c06(0x1bf)],'failUrl':_0x98a06d[_0x2a1c06(0x252)],'pendingUrl':_0x98a06d[_0x2a1c06(0x251)],'whiteUrl':_0x98a06d[_0x2a1c06(0x27c)],'createdAt':_0x98a06d[_0x2a1c06(0x324)],'updatedAt':_0x98a06d['updatedAt'],'shop':_0x98a06d[_0x2a1c06(0x305)]};}async[a53_0x1045ef(0x362)](_0x52ff10,_0x500fc2,_0x5490a3,_0x4f4937){const _0x4c0f78=a53_0x1045ef,_0x525b73=await database_1[_0x4c0f78(0x1e9)][_0x4c0f78(0x277)](async _0x1a1003=>{const _0x46c1f5=_0x4c0f78,_0x5d1109=await _0x1a1003['payment']['findUnique']({'where':{'id':_0x52ff10},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x5d1109)throw new Error(_0x46c1f5(0x2f3));const _0x3c2007=_0x5d1109[_0x46c1f5(0x28b)],_0x648be1=_0x500fc2[_0x46c1f5(0x2f5)]();console['log'](_0x46c1f5(0x2e1)+_0x52ff10+_0x46c1f5(0x24a)+_0x3c2007+_0x46c1f5(0x1c3)+_0x648be1),console['log'](_0x46c1f5(0x19c)+_0x5d1109[_0x46c1f5(0x305)]['balance']+'\x20USDT');const _0xf0d0a6={'status':_0x648be1,'updatedAt':new Date(),'statusChangedBy':_0x46c1f5(0x2be),'statusChangedAt':new Date()};_0x5490a3&&(_0xf0d0a6['adminNotes']=_0x5490a3);_0x648be1==='CHARGEBACK'&&_0x4f4937&&(_0xf0d0a6['chargebackAmount']=_0x4f4937);let _0x4f677f=0x0,_0x536ac3=_0x5d1109[_0x46c1f5(0x305)][_0x46c1f5(0x1ab)];if(_0x648be1===_0x46c1f5(0x221)&&_0x3c2007!==_0x46c1f5(0x221)){_0xf0d0a6['paidAt']=new Date();const _0x8bc783=await currencyService_1[_0x46c1f5(0x1b8)][_0x46c1f5(0x327)](_0x5d1109[_0x46c1f5(0x228)],_0x5d1109[_0x46c1f5(0x1f5)]);_0xf0d0a6[_0x46c1f5(0x2cb)]=_0x8bc783;let _0x1f88d0=0x2d;const _0x474a4f=await _0x1a1003['shop'][_0x46c1f5(0x283)]({'where':{'id':_0x5d1109[_0x46c1f5(0x18e)]},'select':{'gatewaySettings':!![]}});if(_0x474a4f?.[_0x46c1f5(0x265)])try{const _0x194b33=JSON['parse'](_0x474a4f[_0x46c1f5(0x265)]);for(const [_0x8d3359,_0x134f9f]of Object['entries'](_0x194b33)){if(_0x8d3359[_0x46c1f5(0x269)]()===_0x5d1109[_0x46c1f5(0x31d)]['toLowerCase']()){_0x1f88d0=_0x134f9f['commission']||0xa;break;}}}catch(_0x2d592a){console['error'](_0x46c1f5(0x282)+_0x52ff10+':',_0x2d592a);}let _0x6d1f82;_0x5d1109['amountAfterGatewayCommissionUSDT']!==null&&_0x5d1109[_0x46c1f5(0x203)]!==undefined?(_0x6d1f82=_0x5d1109[_0x46c1f5(0x203)],console[_0x46c1f5(0x1ba)](_0x46c1f5(0x191)+_0x6d1f82[_0x46c1f5(0x2e5)](0x6)+_0x46c1f5(0x304)+_0x52ff10)):(_0x6d1f82=_0x8bc783*(0x1-_0x1f88d0/0x64),console[_0x46c1f5(0x1ba)](_0x46c1f5(0x20d)+_0x52ff10+':\x20'+_0x1f88d0+_0x46c1f5(0x1f6)+_0x8bc783['toFixed'](0x6)+'\x20USDT'),_0xf0d0a6[_0x46c1f5(0x203)]=_0x6d1f82,_0xf0d0a6[_0x46c1f5(0x1f4)]=_0x1f88d0),_0x4f677f=_0x6d1f82,_0x536ac3+=_0x6d1f82,console[_0x46c1f5(0x1ba)](_0x46c1f5(0x271)+_0x52ff10+_0x46c1f5(0x1ae)),console['log']('\x20\x20\x20Full\x20amount:\x20'+_0x8bc783['toFixed'](0x6)+_0x46c1f5(0x189)),console[_0x46c1f5(0x1ba)](_0x46c1f5(0x1a1)+_0x5d1109[_0x46c1f5(0x31d)]+_0x46c1f5(0x234)+_0x1f88d0+'%'),console[_0x46c1f5(0x1ba)](_0x46c1f5(0x2cc)+_0x6d1f82['toFixed'](0x6)+_0x46c1f5(0x2ec)+_0x1f88d0+_0x46c1f5(0x19f)),console[_0x46c1f5(0x1ba)](_0x46c1f5(0x338)+_0x6d1f82[_0x46c1f5(0x2e5)](0x6)+'\x20USDT');}else{if(_0x3c2007===_0x46c1f5(0x221)&&_0x648be1!==_0x46c1f5(0x221)&&_0x648be1!==_0x46c1f5(0x24c)){if(_0x5d1109[_0x46c1f5(0x2cb)]){let _0x549656=0x2d;const _0x324754=await _0x1a1003[_0x46c1f5(0x305)]['findUnique']({'where':{'id':_0x5d1109[_0x46c1f5(0x18e)]},'select':{'gatewaySettings':!![]}});if(_0x324754?.[_0x46c1f5(0x265)])try{const _0x4863c3=JSON[_0x46c1f5(0x1d6)](_0x324754['gatewaySettings']);for(const [_0x3201e1,_0x5642d0]of Object[_0x46c1f5(0x298)](_0x4863c3)){if(_0x3201e1[_0x46c1f5(0x269)]()===_0x5d1109[_0x46c1f5(0x31d)][_0x46c1f5(0x269)]()){_0x549656=_0x5642d0[_0x46c1f5(0x1db)]||0xa;break;}}}catch(_0x5af90e){console[_0x46c1f5(0x31f)]('Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20'+_0x52ff10+':',_0x5af90e);}const _0x127436=_0x5d1109[_0x46c1f5(0x2cb)]*(0x1-_0x549656/0x64);_0x4f677f=-_0x127436,_0x536ac3-=_0x127436,console[_0x46c1f5(0x1ba)](_0x46c1f5(0x206)+_0x5d1109[_0x46c1f5(0x2cb)][_0x46c1f5(0x2e5)](0x6)+_0x46c1f5(0x189)),console[_0x46c1f5(0x1ba)](_0x46c1f5(0x1a1)+_0x5d1109[_0x46c1f5(0x31d)]+',\x20Commission:\x20'+_0x549656+'%'),console[_0x46c1f5(0x1ba)]('\x20\x20\x20Merchant\x20loses:\x20'+_0x127436[_0x46c1f5(0x2e5)](0x6)+_0x46c1f5(0x2ec)+_0x549656+_0x46c1f5(0x19f)),console[_0x46c1f5(0x1ba)]('\x20\x20\x20Subtracted\x20from\x20balance:\x20-'+_0x127436['toFixed'](0x6)+_0x46c1f5(0x189));}}}_0x648be1==='CHARGEBACK'&&(console[_0x46c1f5(0x1ba)](_0x46c1f5(0x1de)),_0x4f4937&&_0x4f4937>0x0?(_0x4f677f=-_0x4f4937,_0x536ac3-=_0x4f4937,console[_0x46c1f5(0x1ba)](_0x46c1f5(0x333)+_0x4f4937['toFixed'](0x6)+_0x46c1f5(0x2a8)),console[_0x46c1f5(0x1ba)](_0x46c1f5(0x2e9))):console[_0x46c1f5(0x1ba)](_0x46c1f5(0x26c)),_0xf0d0a6[_0x46c1f5(0x332)]=_0x4f4937||0x0);_0x648be1===_0x46c1f5(0x19b)&&_0x3c2007==='PAID'&&console['log'](_0x46c1f5(0x242));const _0x5b7124=await _0x1a1003['payment'][_0x46c1f5(0x2f7)]({'where':{'id':_0x52ff10},'data':_0xf0d0a6,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x4f677f!==0x0&&(await _0x1a1003[_0x46c1f5(0x305)]['update']({'where':{'id':_0x5d1109[_0x46c1f5(0x18e)]},'data':{'balance':_0x536ac3}}),console[_0x46c1f5(0x1ba)](_0x46c1f5(0x2aa)+_0x5d1109['shopId']+_0x46c1f5(0x325)+_0x5d1109[_0x46c1f5(0x305)][_0x46c1f5(0x1ab)][_0x46c1f5(0x2e5)](0x6)+_0x46c1f5(0x1c3)+_0x536ac3['toFixed'](0x6)+_0x46c1f5(0x337)+(_0x4f677f>0x0?'+':'')+_0x4f677f[_0x46c1f5(0x2e5)](0x6)+')')),_0x5b7124;});return{'id':_0x525b73['id'],'shopId':_0x525b73[_0x4c0f78(0x18e)],'gateway':_0x525b73[_0x4c0f78(0x31d)],'amount':_0x525b73[_0x4c0f78(0x228)],'currency':_0x525b73[_0x4c0f78(0x1f5)],'status':_0x525b73['status'],'orderId':_0x525b73[_0x4c0f78(0x294)],'gatewayOrderId':_0x525b73[_0x4c0f78(0x2f2)],'customerEmail':_0x525b73[_0x4c0f78(0x2d1)],'customerName':_0x525b73[_0x4c0f78(0x225)],'customerCountry':_0x525b73['customerCountry'],'customerIp':_0x525b73[_0x4c0f78(0x351)],'customerUa':_0x525b73[_0x4c0f78(0x32e)],'failureMessage':_0x525b73[_0x4c0f78(0x1fc)],'adminNotes':_0x525b73[_0x4c0f78(0x1b0)],'chargebackAmount':_0x525b73['chargebackAmount'],'statusChangedBy':_0x525b73[_0x4c0f78(0x2ce)],'statusChangedAt':_0x525b73[_0x4c0f78(0x1dc)],'createdAt':_0x525b73[_0x4c0f78(0x324)],'updatedAt':_0x525b73[_0x4c0f78(0x2d4)],'shop':_0x525b73[_0x4c0f78(0x305)]};}async[a53_0x1045ef(0x235)](_0x8ed579,_0x2918e6){const _0x56e465=a53_0x1045ef,_0x5c09c9=Math['random']()[_0x56e465(0x323)](0x24)[_0x56e465(0x349)](0x2,0x9);console[_0x56e465(0x1ba)](_0x56e465(0x22c)+_0x5c09c9+_0x56e465(0x27d)+_0x8ed579);const _0x253f9f={..._0x2918e6};_0x2918e6[_0x56e465(0x30a)]&&_0x2918e6[_0x56e465(0x30a)][_0x56e465(0x1ad)]()!==''?(console['log'](_0x56e465(0x26d)+_0x5c09c9+']\x20Updating\x20password\x20for\x20user\x20'+_0x8ed579),_0x253f9f[_0x56e465(0x30a)]=await bcryptjs_1[_0x56e465(0x1e9)]['hash'](_0x2918e6['password'],0xc)):(console[_0x56e465(0x1ba)]('ðŸ”\x20['+_0x5c09c9+_0x56e465(0x21e)),delete _0x253f9f[_0x56e465(0x30a)]);_0x2918e6[_0x56e465(0x27f)]&&(_0x253f9f[_0x56e465(0x31c)]=_0x2918e6[_0x56e465(0x27f)],delete _0x253f9f[_0x56e465(0x27f)]);_0x2918e6[_0x56e465(0x320)]&&(_0x253f9f['telegram']=_0x2918e6[_0x56e465(0x320)],delete _0x253f9f[_0x56e465(0x320)]);_0x2918e6[_0x56e465(0x1e6)]&&(_0x253f9f['shopUrl']=_0x2918e6[_0x56e465(0x1e6)],delete _0x253f9f['merchantUrl']);if(_0x2918e6[_0x56e465(0x1c1)]){const _0x2175fb=_0x2918e6[_0x56e465(0x1c1)][_0x56e465(0x30d)](_0x3d8b96=>this[_0x56e465(0x31a)](_0x3d8b96));console[_0x56e465(0x1ba)](_0x56e465(0x1cb),_0x2918e6[_0x56e465(0x1c1)],'->',_0x2175fb),_0x253f9f['paymentGateways']=JSON['stringify'](_0x2175fb),delete _0x253f9f[_0x56e465(0x1c1)];}_0x2918e6[_0x56e465(0x265)]&&(console[_0x56e465(0x1ba)](_0x56e465(0x2b9)+_0x5c09c9+']\x20Gateway\x20settings\x20before\x20saving:',_0x2918e6[_0x56e465(0x265)]),_0x253f9f[_0x56e465(0x265)]=JSON['stringify'](_0x2918e6['gatewaySettings']),console[_0x56e465(0x1ba)](_0x56e465(0x2b9)+_0x5c09c9+_0x56e465(0x2c0),_0x253f9f[_0x56e465(0x265)]));_0x2918e6[_0x56e465(0x1c7)]&&(_0x2918e6[_0x56e465(0x1c7)][_0x56e465(0x2e3)]!==undefined&&(_0x253f9f[_0x56e465(0x2e3)]=_0x2918e6[_0x56e465(0x1c7)][_0x56e465(0x2e3)]||null),_0x2918e6[_0x56e465(0x1c7)][_0x56e465(0x32a)]!==undefined&&(_0x253f9f[_0x56e465(0x32a)]=_0x2918e6[_0x56e465(0x1c7)][_0x56e465(0x32a)]||null),_0x2918e6[_0x56e465(0x1c7)][_0x56e465(0x32b)]!==undefined&&(_0x253f9f[_0x56e465(0x32b)]=_0x2918e6[_0x56e465(0x1c7)][_0x56e465(0x32b)]||null),_0x2918e6[_0x56e465(0x1c7)][_0x56e465(0x1b4)]!==undefined&&(_0x253f9f[_0x56e465(0x1b4)]=_0x2918e6[_0x56e465(0x1c7)][_0x56e465(0x1b4)]||null),delete _0x253f9f[_0x56e465(0x1c7)]);const _0x3c0950=await database_1['default'][_0x56e465(0x305)][_0x56e465(0x2f7)]({'where':{'id':_0x8ed579},'data':_0x253f9f,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0x56e465(0x1ba)]('ðŸŽ¯\x20['+_0x5c09c9+_0x56e465(0x29f),_0x3c0950[_0x56e465(0x265)]),{'id':_0x3c0950['id'],'fullName':_0x3c0950[_0x56e465(0x31c)],'username':_0x3c0950[_0x56e465(0x302)],'telegramId':_0x3c0950[_0x56e465(0x195)],'merchantUrl':_0x3c0950['shopUrl'],'gateways':_0x3c0950['paymentGateways']?JSON[_0x56e465(0x1d6)](_0x3c0950[_0x56e465(0x2f6)]):null,'gatewaySettings':_0x3c0950['gatewaySettings']?JSON[_0x56e465(0x1d6)](_0x3c0950['gatewaySettings']):null,'publicKey':_0x3c0950[_0x56e465(0x2c3)],'wallets':{'usdtPolygonWallet':_0x3c0950[_0x56e465(0x2e3)],'usdtTrcWallet':_0x3c0950[_0x56e465(0x32a)],'usdtErcWallet':_0x3c0950[_0x56e465(0x32b)],'usdcPolygonWallet':_0x3c0950['usdcPolygonWallet']},'status':_0x3c0950[_0x56e465(0x28b)],'createdAt':_0x3c0950[_0x56e465(0x324)]};}async[a53_0x1045ef(0x311)](_0x4fb769){const _0x2e386a=a53_0x1045ef,_0x3a8c36=await database_1[_0x2e386a(0x1e9)][_0x2e386a(0x305)]['update']({'where':{'id':_0x4fb769},'data':{'status':_0x2e386a(0x1f0)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x3a8c36['id'],'fullName':_0x3a8c36[_0x2e386a(0x31c)],'username':_0x3a8c36[_0x2e386a(0x302)],'telegramId':_0x3a8c36['telegram'],'merchantUrl':_0x3a8c36[_0x2e386a(0x1fe)],'gateways':_0x3a8c36[_0x2e386a(0x2f6)]?JSON['parse'](_0x3a8c36[_0x2e386a(0x2f6)]):null,'gatewaySettings':_0x3a8c36[_0x2e386a(0x265)]?JSON[_0x2e386a(0x1d6)](_0x3a8c36[_0x2e386a(0x265)]):null,'publicKey':_0x3a8c36[_0x2e386a(0x2c3)],'wallets':{'usdtPolygonWallet':_0x3a8c36['usdtPolygonWallet'],'usdtTrcWallet':_0x3a8c36[_0x2e386a(0x32a)],'usdtErcWallet':_0x3a8c36[_0x2e386a(0x32b)],'usdcPolygonWallet':_0x3a8c36[_0x2e386a(0x1b4)]},'status':_0x3a8c36[_0x2e386a(0x28b)],'createdAt':_0x3a8c36['createdAt']};}async[a53_0x1045ef(0x2a0)](_0x3b14be){const _0xff673=a53_0x1045ef,_0xcb7d6b=await database_1[_0xff673(0x1e9)]['shop'][_0xff673(0x2f7)]({'where':{'id':_0x3b14be},'data':{'status':_0xff673(0x246)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0xcb7d6b['id'],'fullName':_0xcb7d6b[_0xff673(0x31c)],'username':_0xcb7d6b[_0xff673(0x302)],'telegramId':_0xcb7d6b[_0xff673(0x195)],'merchantUrl':_0xcb7d6b[_0xff673(0x1fe)],'gateways':_0xcb7d6b[_0xff673(0x2f6)]?JSON['parse'](_0xcb7d6b['paymentGateways']):null,'gatewaySettings':_0xcb7d6b[_0xff673(0x265)]?JSON[_0xff673(0x1d6)](_0xcb7d6b[_0xff673(0x265)]):null,'publicKey':_0xcb7d6b[_0xff673(0x2c3)],'wallets':{'usdtPolygonWallet':_0xcb7d6b[_0xff673(0x2e3)],'usdtTrcWallet':_0xcb7d6b[_0xff673(0x32a)],'usdtErcWallet':_0xcb7d6b[_0xff673(0x32b)],'usdcPolygonWallet':_0xcb7d6b[_0xff673(0x1b4)]},'status':_0xcb7d6b[_0xff673(0x28b)],'createdAt':_0xcb7d6b['createdAt']};}async[a53_0x1045ef(0x1ed)](_0x15d732){const _0x432e00=a53_0x1045ef,{page:_0x54017e,limit:_0x671290,status:_0x46b3cb,search:_0x4bbaae}=_0x15d732,_0x42ac6e=(_0x54017e-0x1)*_0x671290,_0x9a0c3b={};_0x46b3cb&&(_0x9a0c3b[_0x432e00(0x28b)]=_0x46b3cb[_0x432e00(0x2f5)]());_0x4bbaae&&(_0x9a0c3b['OR']=[{'name':{'contains':_0x4bbaae,'mode':_0x432e00(0x1e4)}},{'username':{'contains':_0x4bbaae,'mode':_0x432e00(0x1e4)}},{'telegram':{'contains':_0x4bbaae,'mode':_0x432e00(0x1e4)}},{'shopUrl':{'contains':_0x4bbaae,'mode':_0x432e00(0x1e4)}}]);const [_0x10b56c,_0xc5002b]=await Promise[_0x432e00(0x20b)]([database_1[_0x432e00(0x1e9)][_0x432e00(0x305)][_0x432e00(0x355)]({'where':_0x9a0c3b,'skip':_0x42ac6e,'take':_0x671290,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'twoFactorEnabled':!![],'createdAt':!![],'lastLoginAt':!![],'_count':{'select':{'telegramUsers':!![]}}}}),database_1[_0x432e00(0x1e9)][_0x432e00(0x305)][_0x432e00(0x1d4)]({'where':_0x9a0c3b})]);return{'users':_0x10b56c[_0x432e00(0x30d)](_0x3824b8=>{const _0x58daec=_0x432e00,_0x2161fb=_0x3824b8['paymentGateways']?JSON[_0x58daec(0x1d6)](_0x3824b8[_0x58daec(0x2f6)]):null,_0x15374d=_0x2161fb?_0x2161fb[_0x58daec(0x30d)](_0x535dfa=>this[_0x58daec(0x29a)](_0x535dfa)):null;return{'id':_0x3824b8['id'],'fullName':_0x3824b8[_0x58daec(0x31c)],'username':_0x3824b8[_0x58daec(0x302)],'telegramId':_0x3824b8[_0x58daec(0x195)],'merchantUrl':_0x3824b8[_0x58daec(0x1fe)],'gateways':_0x15374d,'gatewaySettings':_0x3824b8[_0x58daec(0x265)]?JSON['parse'](_0x3824b8[_0x58daec(0x265)]):null,'publicKey':_0x3824b8['publicKey'],'wallets':{'usdtPolygonWallet':_0x3824b8['usdtPolygonWallet'],'usdtTrcWallet':_0x3824b8['usdtTrcWallet'],'usdtErcWallet':_0x3824b8[_0x58daec(0x32b)],'usdcPolygonWallet':_0x3824b8[_0x58daec(0x1b4)],'usdcErcWallet':_0x3824b8[_0x58daec(0x28d)]},'status':_0x3824b8[_0x58daec(0x28b)],'twoFactorEnabled':_0x3824b8['twoFactorEnabled']||![],'telegramUsersCount':_0x3824b8[_0x58daec(0x287)][_0x58daec(0x188)],'createdAt':_0x3824b8['createdAt'],'lastLoginAt':_0x3824b8[_0x58daec(0x299)]};}),'pagination':{'page':_0x54017e,'limit':_0x671290,'total':_0xc5002b,'totalPages':Math[_0x432e00(0x34b)](_0xc5002b/_0x671290)}};}async[a53_0x1045ef(0x361)](_0x1fdea0){const _0x1ecb23=a53_0x1045ef,_0x218d77=await database_1[_0x1ecb23(0x1e9)][_0x1ecb23(0x305)][_0x1ecb23(0x283)]({'where':{'id':_0x1fdea0},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x218d77)return null;const _0x14a132=_0x218d77['paymentGateways']?JSON[_0x1ecb23(0x1d6)](_0x218d77[_0x1ecb23(0x2f6)]):null,_0x57c63a=_0x14a132?_0x14a132[_0x1ecb23(0x30d)](_0x13d385=>this[_0x1ecb23(0x29a)](_0x13d385)):null;return _0x14a132&&_0x57c63a&&console[_0x1ecb23(0x1ba)](_0x1ecb23(0x239),_0x14a132,'->',_0x57c63a),{'id':_0x218d77['id'],'fullName':_0x218d77[_0x1ecb23(0x31c)],'username':_0x218d77[_0x1ecb23(0x302)],'telegramId':_0x218d77[_0x1ecb23(0x195)],'merchantUrl':_0x218d77[_0x1ecb23(0x1fe)],'gateways':_0x57c63a,'gatewaySettings':_0x218d77['gatewaySettings']?JSON[_0x1ecb23(0x1d6)](_0x218d77[_0x1ecb23(0x265)]):null,'publicKey':_0x218d77[_0x1ecb23(0x2c3)],'wallets':{'usdtPolygonWallet':_0x218d77[_0x1ecb23(0x2e3)],'usdtTrcWallet':_0x218d77['usdtTrcWallet'],'usdtErcWallet':_0x218d77['usdtErcWallet'],'usdcPolygonWallet':_0x218d77[_0x1ecb23(0x1b4)],'usdcErcWallet':_0x218d77[_0x1ecb23(0x28d)]},'status':_0x218d77[_0x1ecb23(0x28b)],'createdAt':_0x218d77[_0x1ecb23(0x324)]};}async['createUser'](_0x56bee6){const _0x5f4a24=a53_0x1045ef,{fullName:_0x5052db,username:_0x3b179b,password:_0x5131c2,telegramId:_0x348a4c,merchantUrl:_0x4934e8,gateways:_0x4435dc,gatewaySettings:_0x29a4e,wallets:_0x5f0b15}=_0x56bee6,_0x2c65e9=await database_1['default'][_0x5f4a24(0x305)][_0x5f4a24(0x283)]({'where':{'username':_0x3b179b}});if(_0x2c65e9)throw new Error('Username\x20already\x20exists');if(_0x348a4c){const _0x40b908=await database_1[_0x5f4a24(0x1e9)]['shop'][_0x5f4a24(0x283)]({'where':{'telegram':_0x348a4c}});if(_0x40b908)throw new Error(_0x5f4a24(0x2db));}const _0x1fb6d7=await bcryptjs_1[_0x5f4a24(0x1e9)]['hash'](_0x5131c2,0xc),_0x165845=_0x5f4a24(0x2ac)+crypto_1[_0x5f4a24(0x1e9)][_0x5f4a24(0x23e)](0x20)[_0x5f4a24(0x323)]('hex'),_0x181bef=_0x5f4a24(0x2ff)+crypto_1[_0x5f4a24(0x1e9)][_0x5f4a24(0x23e)](0x20)['toString'](_0x5f4a24(0x1d0)),_0x483386=_0x4435dc?_0x4435dc[_0x5f4a24(0x30d)](_0x23fee6=>this[_0x5f4a24(0x31a)](_0x23fee6)):null;_0x4435dc&&_0x483386&&console['log'](_0x5f4a24(0x1e8),_0x4435dc,'->',_0x483386);const _0x398437=await database_1['default'][_0x5f4a24(0x305)][_0x5f4a24(0x2de)]({'data':{'name':_0x5052db,'username':_0x3b179b,'password':_0x1fb6d7,'telegram':_0x348a4c,'shopUrl':_0x4934e8,'paymentGateways':_0x483386?JSON['stringify'](_0x483386):null,'gatewaySettings':_0x29a4e?JSON[_0x5f4a24(0x2d5)](_0x29a4e):null,'usdtPolygonWallet':_0x5f0b15?.['usdtPolygonWallet']||null,'usdtTrcWallet':_0x5f0b15?.[_0x5f4a24(0x32a)]||null,'usdtErcWallet':_0x5f0b15?.[_0x5f4a24(0x32b)]||null,'usdcPolygonWallet':_0x5f0b15?.['usdcPolygonWallet']||null,'publicKey':_0x165845,'secretKey':_0x181bef,'status':_0x5f4a24(0x246)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x398437['id'],'fullName':_0x398437[_0x5f4a24(0x31c)],'username':_0x398437[_0x5f4a24(0x302)],'telegramId':_0x398437['telegram'],'merchantUrl':_0x398437['shopUrl'],'gateways':_0x398437[_0x5f4a24(0x2f6)]?JSON[_0x5f4a24(0x1d6)](_0x398437['paymentGateways']):null,'gatewaySettings':_0x398437[_0x5f4a24(0x265)]?JSON[_0x5f4a24(0x1d6)](_0x398437[_0x5f4a24(0x265)]):null,'publicKey':_0x398437[_0x5f4a24(0x2c3)],'wallets':{'usdtPolygonWallet':_0x398437[_0x5f4a24(0x2e3)],'usdtTrcWallet':_0x398437['usdtTrcWallet'],'usdtErcWallet':_0x398437[_0x5f4a24(0x32b)],'usdcPolygonWallet':_0x398437[_0x5f4a24(0x1b4)]},'status':_0x398437['status'],'createdAt':_0x398437['createdAt']};}async[a53_0x1045ef(0x24d)](_0x3ff57b,_0x231ee1){const _0x495865=a53_0x1045ef;if(config_1['config'][_0x495865(0x2be)][_0x495865(0x1a9)]){if(!_0x231ee1)throw new Error('2FA\x20token\x20is\x20required');const _0x24be27=speakeasy_1[_0x495865(0x1e9)][_0x495865(0x19a)][_0x495865(0x35d)]({'secret':config_1[_0x495865(0x1e5)][_0x495865(0x2be)][_0x495865(0x31e)],'encoding':_0x495865(0x23d),'token':_0x231ee1,'window':0x2});if(!_0x24be27){let _0x4b78a2=![];if(config_1[_0x495865(0x1e5)][_0x495865(0x2be)][_0x495865(0x22e)]){const _0x195b31=JSON[_0x495865(0x1d6)](config_1[_0x495865(0x1e5)][_0x495865(0x2be)]['backupCodes']);for(let _0x2952d4=0x0;_0x2952d4<_0x195b31[_0x495865(0x21f)];_0x2952d4++){const _0x55a04e=await bcryptjs_1[_0x495865(0x1e9)][_0x495865(0x204)](_0x231ee1,_0x195b31[_0x2952d4]);if(_0x55a04e){_0x4b78a2=!![],_0x195b31[_0x495865(0x198)](_0x2952d4,0x1),config_1[_0x495865(0x1e5)][_0x495865(0x2be)][_0x495865(0x22e)]=JSON['stringify'](_0x195b31);const _0x3489da=path_1[_0x495865(0x1e9)][_0x495865(0x348)](process[_0x495865(0x22a)](),_0x495865(0x216));if(fs_1[_0x495865(0x1e9)]['existsSync'](_0x3489da)){let _0x459c0c=fs_1[_0x495865(0x1e9)]['readFileSync'](_0x3489da,_0x495865(0x1d5));const _0x264a53=_0x459c0c[_0x495865(0x2c8)]('\x0a');for(let _0x4413ad=0x0;_0x4413ad<_0x264a53[_0x495865(0x21f)];_0x4413ad++){if(_0x264a53[_0x4413ad][_0x495865(0x2f1)](_0x495865(0x303))){_0x264a53[_0x4413ad]='ADMIN_BACKUP_CODES='+JSON[_0x495865(0x2d5)](_0x195b31);break;}}fs_1[_0x495865(0x1e9)][_0x495865(0x2bd)](_0x3489da,_0x264a53[_0x495865(0x348)]('\x0a'),_0x495865(0x1d5));}break;}}}if(!_0x4b78a2)throw new Error(_0x495865(0x241));}}await database_1[_0x495865(0x1e9)][_0x495865(0x305)][_0x495865(0x352)]({'where':{'id':_0x3ff57b}});}async['getShopWallets'](_0x5b4b8e){const _0x3c96e7=a53_0x1045ef,_0x1507d5=await database_1[_0x3c96e7(0x1e9)][_0x3c96e7(0x305)][_0x3c96e7(0x283)]({'where':{'id':_0x5b4b8e},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});if(!_0x1507d5)throw new Error(_0x3c96e7(0x345));return{'usdtPolygonWallet':_0x1507d5['usdtPolygonWallet'],'usdtTrcWallet':_0x1507d5[_0x3c96e7(0x32a)],'usdtErcWallet':_0x1507d5[_0x3c96e7(0x32b)],'usdcPolygonWallet':_0x1507d5[_0x3c96e7(0x1b4)],'usdcErcWallet':_0x1507d5['usdcErcWallet']};}['generateBackupCodes'](_0x1a3407=0x8){const _0x1cfea5=a53_0x1045ef,_0x3355ba=[];for(let _0xc33871=0x0;_0xc33871<_0x1a3407;_0xc33871++){const _0xeeae7a=crypto_1[_0x1cfea5(0x1e9)]['randomBytes'](0x4)['toString'](_0x1cfea5(0x1d0))[_0x1cfea5(0x2f5)]();_0x3355ba[_0x1cfea5(0x1bd)](_0xeeae7a);}return _0x3355ba;}async[a53_0x1045ef(0x1ce)](_0x525ce6){const _0x3cef89=a53_0x1045ef,_0x42326e=await database_1[_0x3cef89(0x1e9)]['shop'][_0x3cef89(0x283)]({'where':{'id':_0x525ce6},'select':{'id':!![],'name':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x42326e)throw new Error(_0x3cef89(0x345));const _0xedccde=speakeasy_1['default'][_0x3cef89(0x353)]({'name':'TrapaPay\x20('+_0x42326e[_0x3cef89(0x302)]+')','issuer':_0x3cef89(0x2b4),'length':0x20}),_0x1261f5=await qrcode_1[_0x3cef89(0x1e9)]['toDataURL'](_0xedccde['otpauth_url']),_0x2f1cdf=this[_0x3cef89(0x1c8)](0x8),_0x163095=await Promise[_0x3cef89(0x20b)](_0x2f1cdf['map'](_0x49f3bc=>bcryptjs_1['default'][_0x3cef89(0x2e0)](_0x49f3bc,0xa)));return await database_1[_0x3cef89(0x1e9)]['shop']['update']({'where':{'id':_0x525ce6},'data':{'twoFactorSecret':_0xedccde[_0x3cef89(0x23d)],'backupCodes':JSON[_0x3cef89(0x2d5)](_0x163095)}}),console['log'](_0x3cef89(0x359)+_0x42326e[_0x3cef89(0x302)]),console[_0x3cef89(0x1ba)](_0x3cef89(0x2cd)+_0x2f1cdf[_0x3cef89(0x21f)]+'\x20backup\x20codes'),{'secret':_0xedccde['base32'],'qrCode':_0x1261f5,'manualEntryKey':_0xedccde['base32'],'backupCodes':_0x2f1cdf};}async['enable2FA'](_0x576a83,_0x45c0b5){const _0x21d482=a53_0x1045ef,_0x16899a=await database_1[_0x21d482(0x1e9)]['shop'][_0x21d482(0x283)]({'where':{'id':_0x576a83},'select':{'id':!![],'username':!![],'twoFactorSecret':!![],'twoFactorEnabled':!![]}});if(!_0x16899a)throw new Error(_0x21d482(0x345));if(!_0x16899a[_0x21d482(0x31e)])throw new Error(_0x21d482(0x2d2));if(_0x16899a[_0x21d482(0x1a9)])throw new Error(_0x21d482(0x30f));const _0x4c2d93=speakeasy_1[_0x21d482(0x1e9)][_0x21d482(0x19a)][_0x21d482(0x35d)]({'secret':_0x16899a[_0x21d482(0x31e)],'encoding':_0x21d482(0x23d),'token':_0x45c0b5,'window':0x2});if(!_0x4c2d93)throw new Error(_0x21d482(0x290));return await database_1[_0x21d482(0x1e9)][_0x21d482(0x305)][_0x21d482(0x2f7)]({'where':{'id':_0x576a83},'data':{'twoFactorEnabled':!![]}}),console['log'](_0x21d482(0x1a3)+_0x16899a[_0x21d482(0x302)]),{'enabled':!![]};}async[a53_0x1045ef(0x340)](_0x421f45){const _0x4d4d31=a53_0x1045ef,_0xa51b3c=await database_1['default'][_0x4d4d31(0x305)]['findUnique']({'where':{'id':_0x421f45},'select':{'id':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0xa51b3c)throw new Error(_0x4d4d31(0x345));await database_1['default'][_0x4d4d31(0x305)]['update']({'where':{'id':_0x421f45},'data':{'twoFactorEnabled':![],'twoFactorSecret':null,'backupCodes':null}}),console[_0x4d4d31(0x1ba)](_0x4d4d31(0x2f4)+_0xa51b3c['username']);}async[a53_0x1045ef(0x192)](_0xf48d52,_0x6883cc,_0xf5ff04,_0x333760){const _0x4590ee=a53_0x1045ef;if(_0x6883cc!==_0xf5ff04)throw new Error('New\x20password\x20and\x20confirmation\x20do\x20not\x20match');if(_0x6883cc[_0x4590ee(0x21f)]<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0xd255ec=await bcryptjs_1[_0x4590ee(0x1e9)][_0x4590ee(0x204)](_0xf48d52,config_1[_0x4590ee(0x1e5)][_0x4590ee(0x2be)][_0x4590ee(0x18a)]);if(!_0xd255ec)throw new Error(_0x4590ee(0x330));if(config_1[_0x4590ee(0x1e5)][_0x4590ee(0x2be)][_0x4590ee(0x1a9)]){if(!_0x333760)throw new Error(_0x4590ee(0x33f));const _0x484bcd=speakeasy_1[_0x4590ee(0x1e9)]['totp'][_0x4590ee(0x35d)]({'secret':config_1[_0x4590ee(0x1e5)][_0x4590ee(0x2be)][_0x4590ee(0x31e)],'encoding':_0x4590ee(0x23d),'token':_0x333760,'window':0x2});if(!_0x484bcd){let _0x417e5f=![];if(config_1[_0x4590ee(0x1e5)][_0x4590ee(0x2be)][_0x4590ee(0x22e)]){const _0x33d1a2=JSON[_0x4590ee(0x1d6)](config_1['config'][_0x4590ee(0x2be)][_0x4590ee(0x22e)]);for(let _0x1d4431=0x0;_0x1d4431<_0x33d1a2['length'];_0x1d4431++){const _0x913e0f=await bcryptjs_1[_0x4590ee(0x1e9)]['compare'](_0x333760,_0x33d1a2[_0x1d4431]);if(_0x913e0f){_0x417e5f=!![],_0x33d1a2[_0x4590ee(0x198)](_0x1d4431,0x1),config_1[_0x4590ee(0x1e5)][_0x4590ee(0x2be)][_0x4590ee(0x22e)]=JSON[_0x4590ee(0x2d5)](_0x33d1a2);const _0x366fd6=path_1[_0x4590ee(0x1e9)][_0x4590ee(0x348)](process['cwd'](),'.env');if(fs_1[_0x4590ee(0x1e9)][_0x4590ee(0x29e)](_0x366fd6)){let _0x4ddc22=fs_1[_0x4590ee(0x1e9)][_0x4590ee(0x2e7)](_0x366fd6,_0x4590ee(0x1d5));const _0x54c782=_0x4ddc22[_0x4590ee(0x2c8)]('\x0a');for(let _0xb565f4=0x0;_0xb565f4<_0x54c782[_0x4590ee(0x21f)];_0xb565f4++){if(_0x54c782[_0xb565f4][_0x4590ee(0x2f1)]('ADMIN_BACKUP_CODES=')){_0x54c782[_0xb565f4]='ADMIN_BACKUP_CODES='+JSON[_0x4590ee(0x2d5)](_0x33d1a2);break;}}fs_1[_0x4590ee(0x1e9)][_0x4590ee(0x2bd)](_0x366fd6,_0x54c782[_0x4590ee(0x348)]('\x0a'),_0x4590ee(0x1d5));}break;}}}if(!_0x417e5f)throw new Error('Invalid\x202FA\x20token\x20or\x20backup\x20code');}}const _0xa0c44a=await bcryptjs_1[_0x4590ee(0x1e9)][_0x4590ee(0x2e0)](_0x6883cc,0xc);config_1[_0x4590ee(0x1e5)][_0x4590ee(0x2be)][_0x4590ee(0x18a)]=_0xa0c44a;const _0x54bc7a=path_1['default']['join'](process[_0x4590ee(0x22a)](),_0x4590ee(0x216));let _0x337103='';if(fs_1[_0x4590ee(0x1e9)][_0x4590ee(0x29e)](_0x54bc7a)){_0x337103=fs_1[_0x4590ee(0x1e9)][_0x4590ee(0x2e7)](_0x54bc7a,_0x4590ee(0x1d5));const _0x21cd30=_0x337103['split']('\x0a');let _0x257daf=![];for(let _0xe63bd6=0x0;_0xe63bd6<_0x21cd30['length'];_0xe63bd6++){if(_0x21cd30[_0xe63bd6]['startsWith'](_0x4590ee(0x24e))){_0x21cd30[_0xe63bd6]=_0x4590ee(0x24e)+_0xa0c44a,_0x257daf=!![];break;}}!_0x257daf&&_0x21cd30[_0x4590ee(0x1bd)]('ADMIN_PASSWORD_HASH='+_0xa0c44a),_0x337103=_0x21cd30[_0x4590ee(0x348)]('\x0a'),fs_1[_0x4590ee(0x1e9)][_0x4590ee(0x2bd)](_0x54bc7a,_0x337103,_0x4590ee(0x1d5));}console[_0x4590ee(0x1ba)](_0x4590ee(0x1b2));}async[a53_0x1045ef(0x207)](){const _0x17528e=a53_0x1045ef;let _0x3ae2e5=0x0;if(config_1[_0x17528e(0x1e5)][_0x17528e(0x2be)][_0x17528e(0x22e)])try{const _0x7554a3=JSON[_0x17528e(0x1d6)](config_1[_0x17528e(0x1e5)][_0x17528e(0x2be)][_0x17528e(0x22e)]);_0x3ae2e5=_0x7554a3[_0x17528e(0x21f)];}catch(_0x298f3e){console['error']('Error\x20parsing\x20backup\x20codes:',_0x298f3e);}return{'twoFactorEnabled':config_1['config'][_0x17528e(0x2be)][_0x17528e(0x1a9)],'backupCodesCount':_0x3ae2e5};}async[a53_0x1045ef(0x317)](){const _0x36fe98=a53_0x1045ef,_0x287b77=speakeasy_1[_0x36fe98(0x1e9)][_0x36fe98(0x353)]({'name':_0x36fe98(0x23c)+config_1[_0x36fe98(0x1e5)][_0x36fe98(0x2be)]['username']+')','issuer':_0x36fe98(0x2d0),'length':0x20}),_0x35e31f=await qrcode_1[_0x36fe98(0x1e9)][_0x36fe98(0x214)](_0x287b77[_0x36fe98(0x28a)]),_0xdbc8db=[];for(let _0x2efd1f=0x0;_0x2efd1f<0x8;_0x2efd1f++){const _0x59a199=crypto_1[_0x36fe98(0x1e9)][_0x36fe98(0x23e)](0x4)[_0x36fe98(0x323)](_0x36fe98(0x1d0))[_0x36fe98(0x2f5)]();_0xdbc8db['push'](_0x59a199);}const _0x2db685=await Promise[_0x36fe98(0x20b)](_0xdbc8db['map'](_0x2b898f=>bcryptjs_1[_0x36fe98(0x1e9)][_0x36fe98(0x2e0)](_0x2b898f,0xa)));config_1[_0x36fe98(0x1e5)]['admin']['twoFactorSecret']=_0x287b77[_0x36fe98(0x23d)],config_1[_0x36fe98(0x1e5)]['admin'][_0x36fe98(0x22e)]=JSON[_0x36fe98(0x2d5)](_0x2db685);const _0x47c7c5=path_1[_0x36fe98(0x1e9)][_0x36fe98(0x348)](process[_0x36fe98(0x22a)](),_0x36fe98(0x216));if(fs_1[_0x36fe98(0x1e9)][_0x36fe98(0x29e)](_0x47c7c5)){let _0x33e18d=fs_1[_0x36fe98(0x1e9)]['readFileSync'](_0x47c7c5,_0x36fe98(0x1d5));const _0xea4783=_0x33e18d[_0x36fe98(0x2c8)]('\x0a');let _0x34ae32=![],_0x58984d=![];for(let _0x3a0732=0x0;_0x3a0732<_0xea4783[_0x36fe98(0x21f)];_0x3a0732++){_0xea4783[_0x3a0732][_0x36fe98(0x2f1)]('ADMIN_2FA_SECRET=')&&(_0xea4783[_0x3a0732]='ADMIN_2FA_SECRET='+_0x287b77['base32'],_0x34ae32=!![]),_0xea4783[_0x3a0732]['startsWith'](_0x36fe98(0x303))&&(_0xea4783[_0x3a0732]=_0x36fe98(0x303)+JSON[_0x36fe98(0x2d5)](_0x2db685),_0x58984d=!![]);}if(!_0x34ae32)_0xea4783[_0x36fe98(0x1bd)](_0x36fe98(0x2ee)+_0x287b77[_0x36fe98(0x23d)]);if(!_0x58984d)_0xea4783[_0x36fe98(0x1bd)](_0x36fe98(0x303)+JSON[_0x36fe98(0x2d5)](_0x2db685));fs_1[_0x36fe98(0x1e9)][_0x36fe98(0x2bd)](_0x47c7c5,_0xea4783[_0x36fe98(0x348)]('\x0a'),'utf8');}return console[_0x36fe98(0x1ba)]('ðŸ”\x20Admin\x202FA\x20setup\x20initiated'),console['log']('ðŸ”‘\x20Generated\x20'+_0xdbc8db['length']+_0x36fe98(0x1cf)),{'secret':_0x287b77['base32'],'qrCode':_0x35e31f,'manualEntryKey':_0x287b77['base32'],'backupCodes':_0xdbc8db};}async[a53_0x1045ef(0x2a6)](_0x11e87b){const _0x22e17b=a53_0x1045ef;if(!config_1[_0x22e17b(0x1e5)][_0x22e17b(0x2be)]['twoFactorSecret'])throw new Error(_0x22e17b(0x2d2));if(config_1['config'][_0x22e17b(0x2be)][_0x22e17b(0x1a9)])throw new Error('2FA\x20is\x20already\x20enabled');const _0x16f4dc=speakeasy_1[_0x22e17b(0x1e9)]['totp']['verify']({'secret':config_1[_0x22e17b(0x1e5)][_0x22e17b(0x2be)][_0x22e17b(0x31e)],'encoding':_0x22e17b(0x23d),'token':_0x11e87b,'window':0x2});if(!_0x16f4dc)throw new Error(_0x22e17b(0x290));config_1[_0x22e17b(0x1e5)][_0x22e17b(0x2be)]['twoFactorEnabled']=!![];const _0x5c2431=path_1[_0x22e17b(0x1e9)]['join'](process[_0x22e17b(0x22a)](),'.env');if(fs_1[_0x22e17b(0x1e9)]['existsSync'](_0x5c2431)){let _0x29cdd8=fs_1[_0x22e17b(0x1e9)][_0x22e17b(0x2e7)](_0x5c2431,'utf8');const _0x469cd1=_0x29cdd8[_0x22e17b(0x2c8)]('\x0a');let _0x2846ad=![];for(let _0x5c8d25=0x0;_0x5c8d25<_0x469cd1['length'];_0x5c8d25++){if(_0x469cd1[_0x5c8d25][_0x22e17b(0x2f1)](_0x22e17b(0x2ae))){_0x469cd1[_0x5c8d25]=_0x22e17b(0x280),_0x2846ad=!![];break;}}if(!_0x2846ad)_0x469cd1[_0x22e17b(0x1bd)](_0x22e17b(0x280));fs_1['default']['writeFileSync'](_0x5c2431,_0x469cd1[_0x22e17b(0x348)]('\x0a'),_0x22e17b(0x1d5));}return console[_0x22e17b(0x1ba)](_0x22e17b(0x30e)),{'enabled':!![]};}async[a53_0x1045ef(0x286)](){const _0x3fadce=a53_0x1045ef;config_1[_0x3fadce(0x1e5)][_0x3fadce(0x2be)][_0x3fadce(0x1a9)]=![],config_1['config'][_0x3fadce(0x2be)]['twoFactorSecret']='',config_1['config'][_0x3fadce(0x2be)][_0x3fadce(0x22e)]='';const _0x4a46ca=path_1[_0x3fadce(0x1e9)][_0x3fadce(0x348)](process[_0x3fadce(0x22a)](),_0x3fadce(0x216));if(fs_1[_0x3fadce(0x1e9)]['existsSync'](_0x4a46ca)){let _0x16d8dc=fs_1[_0x3fadce(0x1e9)][_0x3fadce(0x2e7)](_0x4a46ca,'utf8');const _0x26d82b=_0x16d8dc['split']('\x0a');for(let _0x36230f=0x0;_0x36230f<_0x26d82b['length'];_0x36230f++){_0x26d82b[_0x36230f]['startsWith'](_0x3fadce(0x2ae))&&(_0x26d82b[_0x36230f]='ADMIN_2FA_ENABLED=false'),_0x26d82b[_0x36230f][_0x3fadce(0x2f1)](_0x3fadce(0x2ee))&&(_0x26d82b[_0x36230f]=_0x3fadce(0x2ee)),_0x26d82b[_0x36230f][_0x3fadce(0x2f1)](_0x3fadce(0x303))&&(_0x26d82b[_0x36230f]=_0x3fadce(0x303));}fs_1['default'][_0x3fadce(0x2bd)](_0x4a46ca,_0x26d82b['join']('\x0a'),_0x3fadce(0x1d5));}console[_0x3fadce(0x1ba)](_0x3fadce(0x1ff));}[a53_0x1045ef(0x1eb)](_0x3e1f51,_0x341e80,_0x19dd22){const _0x125d43=a53_0x1045ef,_0x11fefa=new Map(),_0x2b360c=new Date(_0x341e80);while(_0x2b360c<=_0x19dd22){const _0x20c9f3=_0x2b360c[_0x125d43(0x312)]()[_0x125d43(0x2c8)]('T')[0x0];_0x11fefa['set'](_0x20c9f3,{'revenue':0x0,'count':0x0}),_0x2b360c[_0x125d43(0x26b)](_0x2b360c[_0x125d43(0x309)]()+0x1);}for(const _0x404096 of _0x3e1f51){const _0x2eb088=_0x404096['createdAt'][_0x125d43(0x312)]()['split']('T')[0x0],_0x42ac72=_0x11fefa['get'](_0x2eb088);_0x42ac72&&(_0x42ac72[_0x125d43(0x1d4)]+=0x1,_0x404096[_0x125d43(0x28b)]===_0x125d43(0x221)&&(_0x404096[_0x125d43(0x2cb)]?_0x42ac72[_0x125d43(0x342)]+=_0x404096['amountUSDT']:console[_0x125d43(0x1ba)](_0x125d43(0x20a)+_0x404096['id']+'\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion')));}const _0x3b82c2=[],_0x16080d=[];for(const [_0x1be5d2,_0x4efc72]of _0x11fefa){_0x3b82c2[_0x125d43(0x1bd)]({'date':_0x1be5d2,'amount':Math['round'](_0x4efc72[_0x125d43(0x342)]*0x64)/0x64}),_0x16080d[_0x125d43(0x1bd)]({'date':_0x1be5d2,'count':_0x4efc72[_0x125d43(0x1d4)]});}return{'dailyRevenue':_0x3b82c2,'dailyPayments':_0x16080d};}async[a53_0x1045ef(0x2c4)](_0x42bf21){const _0x5213e6=a53_0x1045ef;console[_0x5213e6(0x1ba)]('ðŸ“Š\x20Getting\x20payout\x20reports\x20with\x20filters:',_0x42bf21);const _0x26ee6c=new Date(_0x42bf21[_0x5213e6(0x1ee)]),_0x355b94=new Date(_0x42bf21[_0x5213e6(0x268)]),_0x31a93f=new Date(Date[_0x5213e6(0x315)](_0x26ee6c[_0x5213e6(0x2b7)](),_0x26ee6c[_0x5213e6(0x190)](),_0x26ee6c[_0x5213e6(0x1d9)](),0x0,0x0,0x0,0x0)),_0x1e9cc5=new Date(Date[_0x5213e6(0x315)](_0x355b94[_0x5213e6(0x2b7)](),_0x355b94[_0x5213e6(0x190)](),_0x355b94['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));console[_0x5213e6(0x1ba)]('ðŸ“…\x20Period:\x20'+_0x31a93f[_0x5213e6(0x312)]()+_0x5213e6(0x1e7)+_0x1e9cc5['toISOString']()),console[_0x5213e6(0x1ba)](_0x5213e6(0x254)+_0x42bf21[_0x5213e6(0x31d)]);const _0x4a6973=await database_1['default'][_0x5213e6(0x2fc)][_0x5213e6(0x355)]({'where':{'status':'PAID','gateway':_0x42bf21['gateway'][_0x5213e6(0x269)](),'createdAt':{'gte':_0x31a93f,'lte':_0x1e9cc5}},'select':{'id':!![],'shopId':!![],'amountAfterGatewayCommissionUSDT':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console[_0x5213e6(0x1ba)](_0x5213e6(0x2c1)+_0x4a6973[_0x5213e6(0x21f)]+_0x5213e6(0x310)+_0x42bf21['gateway']);const _0x3a0208=new Map();for(const _0x4d155c of _0x4a6973){const _0x2ad33f=_0x4d155c[_0x5213e6(0x203)]||0x0;if(_0x2ad33f<=0x0){console[_0x5213e6(0x34f)](_0x5213e6(0x20a)+_0x4d155c['id']+_0x5213e6(0x23b));continue;}if(_0x3a0208[_0x5213e6(0x1a5)](_0x4d155c['shopId'])){const _0x2c1df9=_0x3a0208[_0x5213e6(0x1fa)](_0x4d155c[_0x5213e6(0x18e)]);_0x2c1df9['totalAmount']+=_0x2ad33f;}else _0x3a0208[_0x5213e6(0x18d)](_0x4d155c[_0x5213e6(0x18e)],{'merchantId':_0x4d155c[_0x5213e6(0x305)]['id'],'merchantName':_0x4d155c[_0x5213e6(0x305)]['name'],'merchantUsername':_0x4d155c[_0x5213e6(0x305)]['username'],'totalAmount':_0x2ad33f});}const _0x594021=Array[_0x5213e6(0x21c)](_0x3a0208['values']())[_0x5213e6(0x30d)](_0x38db9d=>({'merchantId':_0x38db9d['merchantId'],'merchantName':_0x38db9d['merchantName'],'merchantUsername':_0x38db9d[_0x5213e6(0x1b3)],'gateway':_0x42bf21[_0x5213e6(0x31d)],'periodFrom':_0x42bf21[_0x5213e6(0x1ee)],'periodTo':_0x42bf21[_0x5213e6(0x268)],'totalAmount':Math['round'](_0x38db9d[_0x5213e6(0x2bf)]*0x64)/0x64}));return _0x594021[_0x5213e6(0x1ef)]((_0x20e756,_0x252eb5)=>_0x252eb5[_0x5213e6(0x2bf)]-_0x20e756[_0x5213e6(0x2bf)]),console[_0x5213e6(0x1ba)]('ðŸ“Š\x20Generated\x20reports\x20for\x20'+_0x594021[_0x5213e6(0x21f)]+_0x5213e6(0x2b2)),_0x594021;}async[a53_0x1045ef(0x358)](_0x6c94be,_0x106494,_0x494eb9){const _0x92df73=a53_0x1045ef,_0x71cb79=await database_1[_0x92df73(0x1e9)][_0x92df73(0x305)][_0x92df73(0x283)]({'where':{'id':_0x6c94be}});if(!_0x71cb79)throw new Error(_0x92df73(0x329));await database_1[_0x92df73(0x1e9)][_0x92df73(0x277)](async _0x1fdd5b=>{const _0x107e04=_0x92df73;await _0x1fdd5b[_0x107e04(0x2fc)]['create']({'data':{'shopId':_0x71cb79['id'],'amount':_0x106494,'amountUSDT':_0x106494,'amountAfterGatewayCommissionUSDT':_0x106494,'sourceCurrency':_0x107e04(0x259),'currency':_0x107e04(0x259),'status':_0x107e04(0x221),'gateway':_0x107e04(0x322),'customerName':_0x71cb79[_0x107e04(0x302)],'customerEmail':'@'+_0x71cb79[_0x107e04(0x195)],'paymentMethod':_0x107e04(0x2cf),'adminNotes':_0x494eb9||null,'successUrl':'-','failUrl':'-','paidAt':new Date()}}),await _0x1fdd5b[_0x107e04(0x305)][_0x107e04(0x2f7)]({'where':{'id':_0x71cb79['id']},'data':{'balance':{'increment':_0x106494}}});}),console[_0x92df73(0x1ba)](_0x92df73(0x245)+_0x106494+_0x92df73(0x1e3)+_0x71cb79[_0x92df73(0x302)]);}}function a53_0x2414(){const _0x1492a3=['warn','\x20PAID\x20payments','customerIp','delete','generateSecret','\x20USDT\x20-\x20will\x20deduct\x20from\x20balance','findMany','ðŸ“Š\x20Final\x20WHERE\x20conditions:','ðŸ”\x20Balance\x20check\x20details:','depositBalance','ðŸ”\x202FA\x20setup\x20initiated\x20for\x20shop:\x20','ðŸ”„\x20Updating\x20customer\x20data\x20for\x20payment\x20','polygon_usdc','Noda','verify','\x20\x20\x20Transaction\x20hash:\x20','values','ðŸ“Š\x20Calculating\x20payout\x20statistics...','getUserById','updatePaymentStatus','telegramUsers','\x20USDT','passwordHash','totalPayments','getFullYear','set','shopId','ðŸ’°\x20Creating\x20payout\x20for\x20shop\x20','getUTCMonth','ðŸ“Š\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','changeAdminPassword','Amer','\x20\x20\x20âœ…\x20Total\x20net\x20balances:\x20','telegram','USDT','round','splice','ðŸ”\x20Shop\x20wallets:','totp','REFUND','ðŸ’°\x20Current\x20shop\x20balance:\x20','CoinToPay','asc','%\x20commission)','min','\x20\x20\x20Gateway:\x20','ðŸ”\x20Selected\x20erc20_usdc\x20wallet:\x20','ðŸ”\x202FA\x20enabled\x20for\x20shop:\x20','ðŸ“‹\x20Getting\x20merchants\x20selection\x20list...','has','ðŸ”„\x20Converted\x20gateway\x20ID\x20\x27','__esModule','__importDefault','twoFactorEnabled','thisMonth','balance','\x20\x20\x20â³\x20Pending\x20payout:\x20','trim','\x20became\x20PAID:','getAllPayouts','adminNotes','ðŸ“Š\x20Gateway\x20filter\x20applied:','ðŸ”\x20Admin\x20password\x20changed\x20successfully','merchantUsername','usdcPolygonWallet','plisio','MaxPara','turnoverUSDT','currencyService','updatePayout','log','AdminService','noda','push','merchantEarningsUSDT','successUrl','\x20merchants\x20with\x20rounded\x20balance\x20!=\x200.00\x20(excluding\x20balances\x20that\x20round\x20to\x200.00)','gateways','KLYME\x20DE','\x20->\x20','\x20\x20\x20ðŸ“…\x20This\x20month:\x20','ðŸ“Š\x20Statistics\x20date\x20range:\x20','MasterCard','wallets','generateBackupCodes','SquirrelPay','wallet','ðŸ”„\x20Gateway\x20mapping:','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','\x20\x20\x20ðŸ’³\x20Total\x20payments:\x20','setup2FA','\x20backup\x20codes','hex','getGatewayIdByName','dailyRevenue','getPayoutStats','count','utf8','parse','cointopay','period','getUTCDate','EXPIRED','commission','statusChangedAt','ðŸ“Š\x20Merchants\x20with\x20rounded\x20balance\x20!=\x200.00:\x20','ðŸ’¸\x20CHARGEBACK:\x20Processing\x20penalty-only\x20deduction','includes','floor','turnover','\x20merchants\x20for\x20selection','\x20USDC\x20to\x20merchant\x20','insensitive','config','merchantUrl','\x20to\x20','ðŸ”„\x20Gateway\x20mapping\x20(create):','default','Plisio','generateDailyStatistics','speakeasy','getAllUsers','periodFrom','sort','SUSPENDED','12mdpjmO','\x20\x20\x20ï¿½\x20Total\x20paid\x20out:\x20','\x20\x20\x20âœ…\x20Actual\x20available\x20balance:\x20','gatewayCommissionRate','currency','%\x20from\x20','\x20USDT,\x20Required:\x20','\x20\x20\x20â³\x20Awaiting\x20payout:\x20','getUTCDay','get','averageCheckUSDT','failureMessage','Visa/MasterCard','shopUrl','ðŸ”\x20Admin\x202FA\x20disabled','getMerchantsSelection',':\x20commission\x20=\x20','ðŸ“Š\x20Getting\x20payments\x20with\x20filters:','amountAfterGatewayCommissionUSDT','compare','gte','\x20\x20\x20Full\x20amount:\x20','get2FASettings','customerCountry','\x20\x20\x20Balance:\x20','âš ï¸\x20Payment\x20','all','test_gateway','ðŸ“Š\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','Test\x20Gateway',',\x20chargebacks:\x20','ðŸ”„\x20Converted\x20gateway\x20name\x20\x27','\x27\x20not\x20found.\x20Available\x20gateways:\x20','\x20USDT\x20(-','\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...','toDataURL','ðŸ“Š\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','.env','getPaymentById','klyme_gb','\x20\x20\x20Available\x20(raw):\x20','ðŸ“…\x20Date\x20to\x20filter:\x20','totalPayout','from','_sum',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','length','\x20\x20\x20Available\x20(number):\x20','PAID','\x20\x20\x20ï¿½\x20Total\x20payments\x20turnover:\x20','../types/gateway','erc20','customerName','../config/config','âœ…\x20Using\x20wallet\x20from\x20request:\x20','amount','getTime','cwd','\x20USDT\x20(rounded\x20to\x202\x20decimal\x20places)','ðŸŽ¯\x20updateUser\x20called\x20with\x20ID:\x20','OnRamp','backupCodes','bcryptjs','1829464kgQCTX','getGatewayNameById','totalAmountAfterCommissionUSDT','txid',',\x20Commission:\x20','updateUser','not\x20set','setUTCDate',',\x20refunds:\x20','ðŸ”„\x20Gateway\x20mapping\x20(get):','ðŸ”\x20Selected\x20polygon\x20wallet:\x20','\x20has\x20zero\x20or\x20null\x20merchant\x20amount,\x20skipping...','TrapaPay\x20Admin\x20(','base32','randomBytes','\x20\x20\x20ðŸŒ\x20Country:\x20','ðŸ“…\x20Payout\x20date\x20from\x20filter:\x20','Invalid\x202FA\x20token\x20or\x20backup\x20code','ðŸ”„\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','Payout\x20not\x20found','OxaPay','âœ…\x20Deposited\x20','ACTIVE','ðŸ“…\x20Payout\x20date\x20to\x20filter:\x20','\x20USDT,\x20Requested:\x20','toLocaleDateString','\x20status:\x20','erc20_usdc','CHARGEBACK','deleteUser','ADMIN_PASSWORD_HASH=','\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)','setHours','pendingUrl','failUrl','\x20USDT,\x20Difference:\x20','ðŸ”Œ\x20Gateway:\x20','âš ï¸\x20Requested\x20gateway\x20\x27','\x20balance\x20updated:','ðŸ“Š\x20Using\x20saved\x20values\x20for\x20payment\x20','\x20USDT,\x20merchant:\x20','USDC','\x20updated\x20successfully','\x20\x20\x20ðŸ”\x20Calculated\x20after\x20commission:\x20','\x20-\x20','ðŸ“Š\x20Total\x20payments\x20(including\x20failed):\x20','payout','\x20\x20\x20ðŸ“…\x20Total\x20payouts\x20(this\x20month):\x20','ðŸ”\x20Total\x20payments\x20matching\x20filters:\x20','paymentsCount','month','./telegramBotService','totalAmountUSDT','gatewaySettings','some','getAllPayments','periodTo','toLowerCase','2020-01-01','setDate','âš ï¸\x20CHARGEBACK\x20without\x20penalty\x20amount\x20-\x20no\x20balance\x20change','ðŸ”\x20[','dateFrom','Interac','\x27\x20(from\x20\x27','ðŸ’°\x20Payment\x20','deletePayout','ðŸ“‹\x20Found\x20','ðŸ”\x20No\x20wallet\x20provided,\x20looking\x20up\x20from\x20shop\x20settings...','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','forEach','$transaction','reduce','klyme_de','ðŸ“…\x20Period:\x20','week','whiteUrl',',\x20userId:\x20','79xHOwRe','fullName','ADMIN_2FA_ENABLED=true','\x20with\x20payout\x20history','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','findUnique','\x27\x20->\x20name\x20\x27',',\x20successful:\x20','disableAdmin2FA','_count','âœ…\x20Payout\x20','ðŸ“Š\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20','otpauth_url','status','100RdFdvq','usdcErcWallet','Insufficient\x20balance.\x20Available:\x20','\x27\x20to\x20name\x20\x27','Invalid\x202FA\x20token','\x20\x20\x20Payout\x20amount:\x20','totalPaidOut','\x20USDT\x20(current\x20balance\x20in\x20DB)','orderId','totalCommissionRate','âœ…\x20Payout\x20created\x20in\x20DB:','ðŸ”\x20Initial\x20wallet\x20from\x20request:\x20','entries','lastLoginAt','getGatewayDisplayName','ðŸ”\x20Using\x20gateway\x20\x27','last_month','network','existsSync',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','activateUser','all_time','\x20USDT\x20-\x20will\x20return\x20to\x20balance','availableBalance','not\x20specified','ru-RU','enableAdmin2FA','averageCommissionRate','\x20USDT\x20from\x20balance','PENDING','ðŸ’°\x20Shop\x20','custom_','pk_','this_week','ADMIN_2FA_ENABLED=','findFirst','\x20\x20\x20ðŸ’µ\x20Available\x20balance:\x20','ðŸ“Š\x20Statistics\x20WHERE\x20conditions:','\x20merchants','\x20\x20\x20ðŸ¤”\x20Difference:\x20','TrapaPay','Error\x20processing\x20payment\x20','3497775dNYSOO','getUTCFullYear','\x20\x20\x20ðŸŒ\x20IP:\x20','ðŸ”§\x20[','cointopay2','notes','CoinToPay2','writeFileSync','admin','totalAmount',']\x20Gateway\x20settings\x20JSON\x20string:','ðŸ’°\x20Found\x20','\x20\x20\x20Total\x20paid\x20out:\x20','publicKey','getPayoutReports','ÐÐµ\x20ÑƒÐºÐ°Ð·Ð°Ð½','paidOutUSDT','39502SGfNZb','split','gatewayEarnings','\x20USDT\x20(same\x20as\x20awaiting)','amountUSDT','\x20\x20\x20Merchant\x20gets:\x20','ðŸ”‘\x20Generated\x20','statusChangedBy','CRYPTO','TrapaPay\x20Admin','customerEmail','2FA\x20not\x20set\x20up.\x20Please\x20call\x20setup\x20endpoint\x20first','ðŸ“Š\x20Payout\x20statistics\x20calculated:','updatedAt','stringify','\x20\x20\x20ðŸ’°\x20Total\x20turnover:\x20','getSystemStatistics','awaitingPayout','AmPay','../config/database','Telegram\x20username\x20already\x20exists','KLYME\x20EU','\x20\x20\x20ðŸ’°\x20Total\x20payments\x20turnover:\x20','create','groupBy','hash','ðŸ”„\x20Admin\x20updating\x20payment\x20','slice','usdtPolygonWallet','ðŸ”\x20Selected\x20erc20\x20wallet:\x20','toFixed','\x20\x20\x20ðŸ’°\x20Total\x20payout:\x20','readFileSync','ðŸ’°\x20[PAYOUT]\x20Gateway\x20','ðŸ’°\x20Payment\x20amount\x20is\x20NOT\x20deducted\x20(chargeback\x20penalty\x20only)','\x20\x20\x20Amount\x20difference:\x20','COMPLETED','\x20USDT\x20(after\x20','1785501OTRxZO','ADMIN_2FA_SECRET=','\x20in\x20','\x20\x20\x20Current\x20amount:\x20','startsWith','gatewayOrderId','Payment\x20not\x20found','ðŸ”\x202FA\x20disabled\x20for\x20shop:\x20','toUpperCase','paymentGateways','update','defineProperty','commissionUSDT','\x20\x20\x20Shop\x20balance:\x20','localeCompare','payment','getMerchantsAwaitingPayout','\x20\x20\x20Current\x20balance:\x20','sk_','MyXSpend','ðŸ”\x20Creating\x20payout\x20with\x20data:','username','ADMIN_BACKUP_CODES=','\x20USDT\x20for\x20payment\x20','shop','ðŸ“Š\x20Available\x20gateways\x20in\x20database:','\x20payments)','amountAfterCommissionUSDT','getDate','password','externalPaymentUrl','today','map','ðŸ”\x20Admin\x202FA\x20enabled','2FA\x20is\x20already\x20enabled','\x20paid\x20payments\x20for\x20gateway\x20','suspendUser','toISOString','merchantEarnings','InstaXchange','UTC','paidAt','setupAdmin2FA','\x20\x20\x20ï¿½ðŸ“Š\x20Total\x20payments:\x20','\x20for\x20shop\x20','getGatewayInternalName','klyme_eu','name','gateway','twoFactorSecret','error','telegramId','Rapyd','Deposit','toString','createdAt','\x20balance\x20updated:\x20','getMonth','convertToUSDT','lte','Merchant\x20not\x20found','usdtTrcWallet','usdtErcWallet','aggregate','custom','customerUa','\x20\x20\x20New\x20amount:\x20','Current\x20password\x20is\x20incorrect','âŒ\x20Failed\x20to\x20send\x20Telegram\x20notification\x20for\x20payout\x20','chargebackAmount','ðŸ’¸\x20CHARGEBACK\x20penalty\x20ONLY:\x20-','last_week','pendingPayout','not\x20provided','\x20USDT\x20(','\x20\x20\x20Added\x20to\x20balance:\x20+','dailyPayments','2188695RYHkth','updateCustomerData','\x20\x20\x20ðŸ’¸\x20Total\x20payouts\x20(all\x20time):\x20','\x20\x20\x20Current\x20network:\x20','\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)','2FA\x20token\x20is\x20required','disable2FA','8494878rQNxZB','revenue','ðŸ“…\x20Date\x20from\x20filter:\x20','path','Shop\x20not\x20found','dateTo','âš ï¸\x20Gateway\x20\x27','join','substr','getMerchantStatistics','ceil','desc','yesterday','3005436IIWOcq'];a53_0x2414=function(){return _0x1492a3;};return a53_0x2414();}exports['AdminService']=AdminService;