'use strict';const a35_0xc6abd3=a35_0x1949;function a35_0x1949(_0x4f6a9f,_0x232515){const _0x2dc1ab=a35_0x2dc1();return a35_0x1949=function(_0x194960,_0x2b8d74){_0x194960=_0x194960-0xe4;let _0x503971=_0x2dc1ab[_0x194960];return _0x503971;},a35_0x1949(_0x4f6a9f,_0x232515);}(function(_0x186dc3,_0x270fe){const _0x41b86c=a35_0x1949,_0x57f141=_0x186dc3();while(!![]){try{const _0x477e8d=parseInt(_0x41b86c(0x17d))/0x1*(parseInt(_0x41b86c(0x130))/0x2)+-parseInt(_0x41b86c(0x100))/0x3+parseInt(_0x41b86c(0x174))/0x4*(parseInt(_0x41b86c(0x17e))/0x5)+parseInt(_0x41b86c(0x184))/0x6*(parseInt(_0x41b86c(0x11f))/0x7)+parseInt(_0x41b86c(0x18d))/0x8*(parseInt(_0x41b86c(0xfb))/0x9)+parseInt(_0x41b86c(0x1af))/0xa*(parseInt(_0x41b86c(0x136))/0xb)+-parseInt(_0x41b86c(0x104))/0xc;if(_0x477e8d===_0x270fe)break;else _0x57f141['push'](_0x57f141['shift']());}catch(_0x1537be){_0x57f141['push'](_0x57f141['shift']());}}}(a35_0x2dc1,0xee2e8));function a35_0x2dc1(){const _0x3df2fe=['gte','\x20USDT\x20(','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','PAID','📊\x20Getting\x20payments\x20with\x20filters:','\x20\x20\x20Gateway:\x20','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','test_gateway','round','\x20USDT\x20(with\x20commission\x20deducted)','💱\x20Currency\x20filter\x20applied:\x20','getPayoutById','amountUSDT','paidAt','totalPayout','📅\x20Period\x20\x27all\x27:\x20Using\x20start\x20date\x20from\x20first\x20payment:\x20','getFullYear','map','getPaymentById','delete','insensitive','🔄\x20Converted\x20gateway\x20ID\x20\x27','publicKey','getAllUsers','📊\x20Merchants\x20awaiting\x20payout:\x20','CHARGEBACK','⚠️\x20Requested\x20gateway\x20\x27','10SngxCK',':\x20commission\x20=\x20','\x20\x20\x20Merchant\x20gets:\x20','Username\x20already\x20exists','createPayout','set','\x20\x20\x20🌍\x20Country:\x20','Error\x20processing\x20payment\x20','lte','\x27\x20->\x20ID\x20\x27','hash','\x20active\x20merchants\x20for\x20selection','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','groupBy','customerIp','count','shopUrl','telegram','reduce','CoinToPay','_sum','__importDefault','whiteUrl','toString','\x20\x20\x20🖥️\x20User\x20Agent:\x20','username','\x20USDT\x20(gross\x20revenue)','\x20to\x20','\x20paid\x20payments\x20for\x20analysis','split','externalPaymentUrl','\x20USDT\x20(total\x20paid\x20to\x20merchants)','week','\x20status:\x20','entries','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','Telegram\x20username\x20already\x20exists','\x20\x20\x20✅\x20Total\x20available\x20for\x20payout:\x20','toUpperCase','💰\x20Found\x20','shopId','some','erc20','gateways','\x27\x20->\x20name\x20\x27','\x20USDT)','../types/gateway','revenue','📊\x20Payout\x20statistics\x20calculated:','gatewaySettings','forEach','orderId','📊\x20Final\x20WHERE\x20conditions:','\x20\x20\x20Balance:\x20','commissionUSDT','✅\x20Payout\x20created:\x20','toFixed','periodTo','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','getPayoutStats','randomBytes','\x20\x20\x20💰\x20Total\x20turnover:\x20','pk_','⚠️\x20Gateway\x20\x27','\x20\x20\x20💰\x20Total\x20payments\x20turnover:\x20','\x20\x20\x20💵\x20Available\x20balance:\x20','name','_count','getMerchantsSelection','usdtErcWallet','gateway','💸\x20CHARGEBACK\x20penalty:\x20-','KLYME\x20EU','\x20merchants\x20with\x20positive\x20balance','balance','dateTo','statusChangedBy','Payment\x20not\x20found','💸\x20CHARGEBACK:\x20Merchant\x20amount\x20already\x20deducted\x20from\x20balance','updatePaymentStatus','update','setDate','⚠️\x20Payment\x20','SUSPENDED','length','averageCheckUSDT','date','generateDailyStatistics','updateCustomerData','customerUa','pendingUrl','\x20\x20\x20📅\x20This\x20month:\x20','commission','suspendUser','month','📊\x20Sorting\x20payments\x20by\x20','period','custom','findFirst','not\x20set','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','getDate','Insufficient\x20balance.\x20Available:\x20','all','convertToUSDT','customerEmail','getGatewayIdByName','push','awaitingPayout','9USktyu','telegramId','NONEXISTENT_GATEWAY_FILTER','\x20\x20\x20📊\x20Total\x20payments:\x20','getMonth','5811210EvEwQe','💳\x20Payout\x20wallet\x20for\x20','parse','COMPLETED','51721740oilrRU','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','log','includes','📊\x20Total\x20payments\x20(including\x20failed):\x20','merchantEarnings','password','year','\x20USDT\x20from\x20balance','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','../config/database','\x20USDT\x20(same\x20as\x20awaiting)','totalCommissionRate','error','deleteUser','📋\x20Found\x20','summary','getAllPayouts','\x20for\x20shop\x20','\x20\x20\x20✅\x20Actual\x20available\x20balance:\x20','\x20in\x20','%\x20commission)','polygon_usdc','\x20\x20\x20🔍\x20Calculated\x20after\x20commission:\x20','totalAmountAfterCommissionUSDT','gatewayEarnings','$transaction','161sJfyHp','payment','\x20\x20\x20�\x20Total\x20payments\x20turnover:\x20','usdtTrcWallet','30d','paymentGateways','2020-01-01','getGatewayDisplayName','hex','0000','\x20\x20\x20🌐\x20IP:\x20','asc','status','successUrl','\x20payments)','📅\x20Period:\x20','updateUser','710diyHFk','crypto','paymentsCount','💰\x20[PAYOUT]\x20Merchant\x20','merchantUrl','merchantEarningsUSDT','16287139OyiBSK','payout','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','\x20USDT\x20(theoretical\x20net)','\x27\x20(from\x20\x27','totalAmountUSDT','adminNotes','💰\x20Creating\x20payout\x20for\x20shop\x20','getGatewayNameById','\x20\x20\x20Payout\x20amount:\x20','default','currency','wallets','periodFrom','📊\x20Available\x20gateways\x20in\x20database:','\x27\x20to\x20name\x20\x27','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','turnover','\x27\x20not\x20found.\x20Available\x20gateways:\x20','Test\x20Gateway','values','usdcPolygonWallet','ACTIVE','toLowerCase','paidOutUSDT','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','getUserById','aggregate','amount','getAllPayments','\x20USDT\x20(without\x20commission)','\x20no\x20longer\x20PAID:','totalPaidOut','\x20\x20\x20Full\x20amount:\x20','customerCountry','shop','findMany','currencyService','\x20\x20\x20🔍\x20Raw\x20balance\x20sum:\x20','\x20USDT','chargebackAmount','totalTurnover','🔄\x20Admin\x20updating\x20payment\x20','failureMessage','\x20merchants','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','\x20\x20\x20Total\x20paid\x20out:\x20','getTime','localeCompare','\x20\x20\x20Added\x20to\x20balance:\x20+','\x20\x20\x20💰\x20Total\x20payout:\x20','\x20USDT\x20(actual\x20balances)','\x20USDT\x20(-','\x20\x20\x20💸\x20Total\x20payouts\x20(all\x20time):\x20','Plisio','stringify','join','trc20','toISOString','Rapyd','notes','bcryptjs','12epxThy','ceil','createdAt','updatedAt',',\x20successful:\x20','usdtPolygonWallet','txid','customerName','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','1544vDxmnS','3139535VeoLfi','🔍\x20Using\x20gateway\x20\x27','desc','💰\x20Payment\x20','averageCommissionRate',',\x20Commission:\x20','479496EgcndA','gatewayOrderId','\x20order','turnoverUSDT','💰\x20Shop\x20','\x20->\x20','__esModule','📊\x20Gateway\x20filter\x20applied:','sk_','11777992kJJBzA','getMerchantsAwaitingPayout','AdminService','findUnique','thisMonth','fullName','Noda'];a35_0x2dc1=function(){return _0x3df2fe;};return a35_0x2dc1();}var __importDefault=this&&this[a35_0xc6abd3(0x1c4)]||function(_0x54eeae){const _0x2c3a09=a35_0xc6abd3;return _0x54eeae&&_0x54eeae[_0x2c3a09(0x18a)]?_0x54eeae:{'default':_0x54eeae};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a35_0xc6abd3(0x18f)]=void 0x0;const database_1=__importDefault(require(a35_0xc6abd3(0x10e))),bcryptjs_1=__importDefault(require(a35_0xc6abd3(0x173))),crypto_1=__importDefault(require(a35_0xc6abd3(0x131))),currencyService_1=require('./currencyService'),gateway_1=require(a35_0xc6abd3(0x1dd));class AdminService{async[a35_0xc6abd3(0x1ea)](){const _0x44a1a7=a35_0xc6abd3;console[_0x44a1a7(0x106)]('📊\x20Calculating\x20payout\x20statistics...');const _0x3eed40=await database_1[_0x44a1a7(0x140)][_0x44a1a7(0x159)][_0x44a1a7(0x151)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x44a1a7(0x14c)}}),_0x2b247b=await this[_0x44a1a7(0x18e)]({'page':0x1,'limit':0x3e8}),_0x4e3e55=new Date(),_0x39cd8d=new Date(_0x4e3e55['getFullYear'](),_0x4e3e55[_0x44a1a7(0xff)](),0x1),_0x1a4214=new Date(_0x4e3e55[_0x44a1a7(0x1a4)](),_0x4e3e55[_0x44a1a7(0xff)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x8405ce=await database_1['default'][_0x44a1a7(0x137)]['aggregate']({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x39cd8d,'lte':_0x1a4214},'status':_0x44a1a7(0x103)}}),_0xee5323=_0x3eed40[_0x44a1a7(0x1c3)][_0x44a1a7(0x156)]||0x0,_0x8b1e83=_0x2b247b[_0x44a1a7(0x114)][_0x44a1a7(0x11c)],_0x16b077=_0x8405ce[_0x44a1a7(0x1c3)]['amount']||0x0,_0x4e8d12={'totalPayout':Math[_0x44a1a7(0x19c)](_0xee5323*0x64)/0x64,'awaitingPayout':Math[_0x44a1a7(0x19c)](_0x8b1e83*0x64)/0x64,'thisMonth':Math[_0x44a1a7(0x19c)](_0x16b077*0x64)/0x64,'availableBalance':Math['round'](_0x8b1e83*0x64)/0x64};return console[_0x44a1a7(0x106)](_0x44a1a7(0x1df)),console['log'](_0x44a1a7(0x168)+_0x4e8d12[_0x44a1a7(0x1a2)]+_0x44a1a7(0x1ce)),console[_0x44a1a7(0x106)](_0x44a1a7(0x163)+_0x4e8d12[_0x44a1a7(0xfa)]+_0x44a1a7(0x19d)),console[_0x44a1a7(0x106)](_0x44a1a7(0x1f0)+_0x4e8d12['availableBalance']+_0x44a1a7(0x10f)),console['log'](_0x44a1a7(0xe9)+_0x4e8d12[_0x44a1a7(0x191)]+_0x44a1a7(0x15d)),console[_0x44a1a7(0x106)](_0x44a1a7(0x15c)+(_0x3eed40['_sum'][_0x44a1a7(0x1f9)]||0x0)['toFixed'](0x2)+_0x44a1a7(0x154)),console[_0x44a1a7(0x106)]('\x20\x20\x20📊\x20Commission\x20difference:\x20'+((_0x3eed40[_0x44a1a7(0x1c3)][_0x44a1a7(0x1f9)]||0x0)-_0x8b1e83)[_0x44a1a7(0x1e7)](0x2)+_0x44a1a7(0x15d)),_0x4e8d12;}async[a35_0xc6abd3(0xe6)](_0x1d403b,_0x15ae14){const _0x3c2b79=a35_0xc6abd3;console[_0x3c2b79(0x106)](_0x3c2b79(0x138)+_0x1d403b+':',_0x15ae14);const _0xaeb5eb=await database_1[_0x3c2b79(0x140)][_0x3c2b79(0x120)][_0x3c2b79(0x190)]({'where':{'id':_0x1d403b},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0xaeb5eb)throw new Error(_0x3c2b79(0x1fc));const _0x2f0967={};_0x15ae14[_0x3c2b79(0x158)]!==undefined&&(_0x2f0967[_0x3c2b79(0x158)]=_0x15ae14[_0x3c2b79(0x158)]||null);_0x15ae14[_0x3c2b79(0x1bd)]!==undefined&&(_0x2f0967[_0x3c2b79(0x1bd)]=_0x15ae14[_0x3c2b79(0x1bd)]||null);_0x15ae14[_0x3c2b79(0xe7)]!==undefined&&(_0x2f0967[_0x3c2b79(0xe7)]=_0x15ae14[_0x3c2b79(0xe7)]||null);const _0x544280=await database_1[_0x3c2b79(0x140)][_0x3c2b79(0x120)][_0x3c2b79(0x1ff)]({'where':{'id':_0x1d403b},'data':{..._0x2f0967,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x3c2b79(0x106)](_0x3c2b79(0x196)+_0x1d403b),console[_0x3c2b79(0x106)](_0x3c2b79(0x1b5)+_0xaeb5eb['customerCountry']+_0x3c2b79(0x189)+_0x544280['customerCountry']),console['log'](_0x3c2b79(0x129)+_0xaeb5eb[_0x3c2b79(0x1bd)]+_0x3c2b79(0x189)+_0x544280['customerIp']),console[_0x3c2b79(0x106)](_0x3c2b79(0x1c7)+(_0xaeb5eb[_0x3c2b79(0xe7)]?_0x3c2b79(0x1b4):_0x3c2b79(0xf1))+'\x20->\x20'+(_0x544280[_0x3c2b79(0xe7)]?_0x3c2b79(0x1b4):_0x3c2b79(0xf1))),_0x544280;}async['getSystemStatistics'](_0x53b1b2){const _0x5ca17b=a35_0xc6abd3,_0x232746=new Date();let _0x2e737c;switch(_0x53b1b2){case'7d':_0x2e737c=new Date(_0x232746['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x5ca17b(0x123):_0x2e737c=new Date(_0x232746[_0x5ca17b(0x165)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'90d':_0x2e737c=new Date(_0x232746[_0x5ca17b(0x165)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x5ca17b(0xf5):const _0x110360=await database_1[_0x5ca17b(0x140)][_0x5ca17b(0x120)][_0x5ca17b(0xf0)]({'where':{'gateway':{'not':'test_gateway'}},'orderBy':{'createdAt':'asc'},'select':{'createdAt':!![]}});_0x2e737c=_0x110360?_0x110360[_0x5ca17b(0x176)]:new Date(_0x5ca17b(0x125)),console['log'](_0x5ca17b(0x1a3)+_0x2e737c[_0x5ca17b(0x170)]());break;default:_0x2e737c=new Date(_0x232746[_0x5ca17b(0x165)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x178f7d,_0x1e2645,_0x26c542,_0x5f2089,_0x4a1250,_0x58d9ba,_0x3983e2]=await Promise[_0x5ca17b(0xf5)]([database_1[_0x5ca17b(0x140)][_0x5ca17b(0x159)][_0x5ca17b(0x1be)](),database_1[_0x5ca17b(0x140)]['shop'][_0x5ca17b(0x1be)]({'where':{'status':_0x5ca17b(0x14c)}}),database_1[_0x5ca17b(0x140)]['payment'][_0x5ca17b(0x1be)]({'where':{'createdAt':{'gte':_0x2e737c},'gateway':{'not':_0x5ca17b(0x19b)}}}),database_1['default'][_0x5ca17b(0x120)][_0x5ca17b(0x1be)]({'where':{'status':_0x5ca17b(0x197),'createdAt':{'gte':_0x2e737c},'gateway':{'not':_0x5ca17b(0x19b)}}}),database_1[_0x5ca17b(0x140)][_0x5ca17b(0x120)]['findMany']({'where':{'status':_0x5ca17b(0x197),'createdAt':{'gte':_0x2e737c},'gateway':{'not':_0x5ca17b(0x19b)}},'select':{'amount':!![],'currency':!![]}}),database_1['default'][_0x5ca17b(0x120)][_0x5ca17b(0x15a)]({'where':{'gateway':{'not':_0x5ca17b(0x19b)}},'take':0xa,'orderBy':{'createdAt':_0x5ca17b(0x180)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x5ca17b(0x140)]['payment'][_0x5ca17b(0x15a)]({'where':{'createdAt':{'gte':_0x2e737c},'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x4dd830=0x0;for(const _0x14c5a3 of _0x4a1250){const _0x4c91b7=await currencyService_1[_0x5ca17b(0x15b)][_0x5ca17b(0xf6)](_0x14c5a3['amount'],_0x14c5a3[_0x5ca17b(0x141)]);_0x4dd830+=_0x4c91b7;}const _0xc8ee84=this[_0x5ca17b(0xe5)](_0x3983e2,_0x2e737c,_0x232746),_0x50bc48=_0x26c542>0x0?_0x5f2089/_0x26c542*0x64:0x0;return{'totalShops':_0x178f7d,'activeShops':_0x1e2645,'totalPayments':_0x26c542,'successfulPayments':_0x5f2089,'totalRevenue':Math[_0x5ca17b(0x19c)](_0x4dd830*0x64)/0x64,'conversionRate':Math[_0x5ca17b(0x19c)](_0x50bc48*0x64)/0x64,'dailyRevenue':_0xc8ee84['dailyRevenue'],'dailyPayments':_0xc8ee84['dailyPayments'],'recentPayments':_0x58d9ba[_0x5ca17b(0x1a5)](_0x15adc3=>({'id':_0x15adc3['id'],'amount':_0x15adc3[_0x5ca17b(0x152)],'currency':_0x15adc3[_0x5ca17b(0x141)],'status':_0x15adc3[_0x5ca17b(0x12b)],'gateway':_0x15adc3[_0x5ca17b(0x1f5)],'shop':_0x15adc3['shop'],'createdAt':_0x15adc3[_0x5ca17b(0x176)]}))};}async['getMerchantStatistics'](_0x2db860){const _0x300920=a35_0xc6abd3;console[_0x300920(0x106)]('📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:',_0x2db860);let _0x5554d1,_0x4d27ed=new Date();if(_0x2db860[_0x300920(0xee)]===_0x300920(0xef)&&_0x2db860['dateFrom']&&_0x2db860[_0x300920(0x1fa)])_0x5554d1=new Date(_0x2db860['dateFrom']),_0x4d27ed=new Date(_0x2db860[_0x300920(0x1fa)]);else{const _0x1864b2=new Date();switch(_0x2db860[_0x300920(0xee)]){case _0x300920(0x1cf):_0x5554d1=new Date(_0x1864b2[_0x300920(0x165)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x300920(0xec):_0x5554d1=new Date(_0x1864b2[_0x300920(0x165)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x300920(0x10b):_0x5554d1=new Date(_0x1864b2['getTime']()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x300920(0xf5):default:_0x5554d1=new Date(_0x300920(0x125));break;}}console[_0x300920(0x106)](_0x300920(0x12e)+_0x5554d1[_0x300920(0x170)]()+_0x300920(0x1ca)+_0x4d27ed[_0x300920(0x170)]());const _0x22e3e7={'status':_0x300920(0x197),'gateway':{'not':_0x300920(0x19b)},'paidAt':{'gte':_0x5554d1,'lte':_0x4d27ed}};_0x2db860['shopId']&&(_0x22e3e7[_0x300920(0x1d7)]=_0x2db860[_0x300920(0x1d7)]);const _0x290e12=await database_1[_0x300920(0x140)][_0x300920(0x120)][_0x300920(0x15a)]({'where':_0x22e3e7,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console['log'](_0x300920(0x1d6)+_0x290e12['length']+_0x300920(0x1cb));const _0x460e04={'gateway':{'not':'test_gateway'},'createdAt':{'gte':_0x5554d1,'lte':_0x4d27ed}};_0x2db860[_0x300920(0x1d7)]&&(_0x460e04[_0x300920(0x1d7)]=_0x2db860['shopId']);const _0x314158=await database_1[_0x300920(0x140)][_0x300920(0x120)]['count']({'where':_0x460e04});console[_0x300920(0x106)](_0x300920(0x108)+_0x314158+_0x300920(0x178)+_0x290e12[_0x300920(0x203)]);let _0x3edb29=0x0,_0x12c10c=0x0,_0x4fcfab=0x0;const _0x35503b={},_0x676f80={},_0x257e83={};for(const _0x52f700 of _0x290e12){try{const _0x401fb0=await currencyService_1[_0x300920(0x15b)][_0x300920(0xf6)](_0x52f700[_0x300920(0x152)],_0x52f700['currency']);let _0x322983={};if(_0x52f700[_0x300920(0x159)][_0x300920(0x1e0)])try{_0x322983=JSON[_0x300920(0x102)](_0x52f700['shop'][_0x300920(0x1e0)]);}catch(_0x564c32){console[_0x300920(0x111)](_0x300920(0x17c)+_0x52f700[_0x300920(0x1d7)]+':',_0x564c32);}let _0x506db3={},_0x2136d4=0xa;for(const [_0x4f3837,_0x4dce2d]of Object[_0x300920(0x1d1)](_0x322983)){if(_0x4f3837[_0x300920(0x14d)]()===_0x52f700[_0x300920(0x1f5)][_0x300920(0x14d)]()){_0x506db3=_0x4dce2d,_0x2136d4=_0x4dce2d['commission']||0xa;break;}}const _0x4d9eef=_0x401fb0*(_0x2136d4/0x64),_0x55be3f=_0x401fb0-_0x4d9eef;_0x3edb29+=_0x401fb0,_0x12c10c+=_0x55be3f,_0x4fcfab+=_0x4d9eef;!_0x35503b[_0x52f700[_0x300920(0x1f5)]]&&(_0x35503b[_0x52f700['gateway']]={'gateway':_0x52f700['gateway'],'gatewayDisplayName':this['getGatewayDisplayName'](_0x52f700['gateway']),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x35503b[_0x52f700['gateway']][_0x300920(0x132)]++,_0x35503b[_0x52f700[_0x300920(0x1f5)]][_0x300920(0x187)]+=_0x401fb0,_0x35503b[_0x52f700[_0x300920(0x1f5)]][_0x300920(0x1e5)]+=_0x4d9eef,_0x35503b[_0x52f700[_0x300920(0x1f5)]][_0x300920(0x135)]+=_0x55be3f,_0x35503b[_0x52f700['gateway']][_0x300920(0x110)]+=_0x2136d4;!_0x2db860[_0x300920(0x1d7)]&&(!_0x676f80[_0x52f700[_0x300920(0x1d7)]]&&(_0x676f80[_0x52f700['shopId']]={'shopId':_0x52f700[_0x300920(0x1d7)],'shopName':_0x52f700[_0x300920(0x159)][_0x300920(0x1f1)],'shopUsername':_0x52f700['shop'][_0x300920(0x1c8)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x676f80[_0x52f700[_0x300920(0x1d7)]][_0x300920(0x132)]++,_0x676f80[_0x52f700[_0x300920(0x1d7)]][_0x300920(0x187)]+=_0x401fb0,_0x676f80[_0x52f700['shopId']][_0x300920(0x1e5)]+=_0x4d9eef,_0x676f80[_0x52f700[_0x300920(0x1d7)]]['merchantEarningsUSDT']+=_0x55be3f);const _0x4d8943=_0x52f700[_0x300920(0x1a1)]['toISOString']()['split']('T')[0x0];!_0x257e83[_0x4d8943]&&(_0x257e83[_0x4d8943]={'date':_0x4d8943,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x257e83[_0x4d8943]['turnover']+=_0x401fb0,_0x257e83[_0x4d8943][_0x300920(0x109)]+=_0x55be3f,_0x257e83[_0x4d8943][_0x300920(0x11d)]+=_0x4d9eef,_0x257e83[_0x4d8943]['paymentsCount']++;}catch(_0x71a39c){console[_0x300920(0x111)](_0x300920(0x1b6)+_0x52f700['id']+':',_0x71a39c);}}Object[_0x300920(0x14a)](_0x35503b)['forEach'](_0x1c1214=>{const _0x376f2c=_0x300920;_0x1c1214[_0x376f2c(0x182)]=_0x1c1214['paymentsCount']>0x0?_0x1c1214['totalCommissionRate']/_0x1c1214[_0x376f2c(0x132)]:0x0,delete _0x1c1214[_0x376f2c(0x110)];}),Object['values'](_0x676f80)[_0x300920(0x1e1)](_0x3e5f56=>{const _0x2a657d=_0x300920;_0x3e5f56[_0x2a657d(0x204)]=_0x3e5f56[_0x2a657d(0x132)]>0x0?_0x3e5f56[_0x2a657d(0x187)]/_0x3e5f56[_0x2a657d(0x132)]:0x0;});let _0x2c0a99=0x0;if(_0x2db860[_0x300920(0x1d7)]){const _0x4d133c=await database_1[_0x300920(0x140)]['payout']['findMany']({'where':{'shopId':_0x2db860[_0x300920(0x1d7)],'status':_0x300920(0x103),'createdAt':{'gte':_0x5554d1,'lte':_0x4d27ed}},'select':{'amount':!![]}});_0x2c0a99=_0x4d133c[_0x300920(0x1c1)]((_0x337d19,_0x2c480a)=>_0x337d19+_0x2c480a['amount'],0x0);}const _0x187ee6=_0x314158,_0x776d0f=_0x290e12[_0x300920(0x203)],_0x1903ef=_0x776d0f>0x0?_0x3edb29/_0x776d0f:0x0,_0x3c8124=_0x187ee6>0x0?Math['round'](_0x776d0f/_0x187ee6*0x2710)/0x64:0x0,_0x2a7168=Math[_0x300920(0x175)]((_0x4d27ed[_0x300920(0x165)]()-_0x5554d1[_0x300920(0x165)]())/(0x3e8*0x3c*0x3c*0x18)),_0x39b04f={'totalTurnover':Math[_0x300920(0x19c)](_0x3edb29*0x64)/0x64,'merchantEarnings':Math[_0x300920(0x19c)](_0x12c10c*0x64)/0x64,'gatewayEarnings':Math[_0x300920(0x19c)](_0x4fcfab*0x64)/0x64,'totalPaidOut':Math[_0x300920(0x19c)](_0x2c0a99*0x64)/0x64,'averageCheck':Math['round'](_0x1903ef*0x64)/0x64,'totalPayments':_0x187ee6,'successfulPayments':_0x776d0f,'conversionRate':_0x3c8124,'gatewayBreakdown':Object['values'](_0x35503b)[_0x300920(0x1a5)](_0x38e7cf=>({..._0x38e7cf,'turnoverUSDT':Math['round'](_0x38e7cf[_0x300920(0x187)]*0x64)/0x64,'commissionUSDT':Math[_0x300920(0x19c)](_0x38e7cf[_0x300920(0x1e5)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x300920(0x19c)](_0x38e7cf['merchantEarningsUSDT']*0x64)/0x64,'averageCommissionRate':Math['round'](_0x38e7cf['averageCommissionRate']*0x64)/0x64})),'merchantBreakdown':_0x2db860['shopId']?undefined:Object[_0x300920(0x14a)](_0x676f80)[_0x300920(0x1a5)](_0x157a52=>({..._0x157a52,'turnoverUSDT':Math[_0x300920(0x19c)](_0x157a52['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x300920(0x19c)](_0x157a52[_0x300920(0x1e5)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x300920(0x19c)](_0x157a52['merchantEarningsUSDT']*0x64)/0x64,'paidOutUSDT':Math[_0x300920(0x19c)](_0x157a52[_0x300920(0x14e)]*0x64)/0x64,'averageCheckUSDT':Math[_0x300920(0x19c)](_0x157a52[_0x300920(0x204)]*0x64)/0x64})),'dailyData':Object[_0x300920(0x14a)](_0x257e83)[_0x300920(0x1a5)](_0x313328=>({..._0x313328,'turnover':Math['round'](_0x313328[_0x300920(0x147)]*0x64)/0x64,'merchantEarnings':Math[_0x300920(0x19c)](_0x313328[_0x300920(0x109)]*0x64)/0x64,'gatewayEarnings':Math[_0x300920(0x19c)](_0x313328[_0x300920(0x11d)]*0x64)/0x64}))['sort']((_0x273980,_0x493779)=>_0x273980[_0x300920(0xe4)][_0x300920(0x166)](_0x493779[_0x300920(0xe4)])),'periodInfo':{'from':_0x5554d1,'to':_0x4d27ed,'periodType':_0x2db860['period']||_0x300920(0xef),'daysCount':_0x2a7168}};return console['log']('📊\x20Merchant\x20statistics\x20calculated:'),console['log'](_0x300920(0x1ec)+_0x39b04f[_0x300920(0x15f)]+_0x300920(0x15d)),console[_0x300920(0x106)](_0x300920(0x146)+_0x39b04f[_0x300920(0x109)]+'\x20USDT'),console['log'](_0x300920(0xf2)+_0x39b04f[_0x300920(0x11d)]+_0x300920(0x15d)),console[_0x300920(0x106)](_0x300920(0xfe)+_0x39b04f['totalPayments']),_0x39b04f;}async[a35_0xc6abd3(0x1f3)](){const _0x1019f8=a35_0xc6abd3;console[_0x1019f8(0x106)]('📋\x20Getting\x20merchants\x20selection\x20list...');const _0x56931c=await database_1[_0x1019f8(0x140)]['shop'][_0x1019f8(0x15a)]({'where':{'status':_0x1019f8(0x14c)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x1019f8(0x12a)}});return console['log'](_0x1019f8(0x113)+_0x56931c[_0x1019f8(0x203)]+_0x1019f8(0x1ba)),_0x56931c[_0x1019f8(0x1a5)](_0x57b1c3=>({'id':_0x57b1c3['id'],'username':_0x57b1c3['username'],'name':_0x57b1c3[_0x1019f8(0x1f1)]}));}[a35_0xc6abd3(0x126)](_0x1447b5){const _0x2723d7=a35_0xc6abd3,_0x3dc45d={'test_gateway':_0x2723d7(0x149),'plisio':_0x2723d7(0x16c),'rapyd':_0x2723d7(0x171),'noda':_0x2723d7(0x193),'cointopay':_0x2723d7(0x1c2),'klyme_eu':_0x2723d7(0x1f7),'klyme_gb':'KLYME\x20GB','klyme_de':'KLYME\x20DE'};return _0x3dc45d[_0x1447b5]||_0x1447b5;}async['getMerchantsAwaitingPayout'](_0x51b89c){const _0x1e6fc8=a35_0xc6abd3,{page:_0x107418,limit:_0x3d6730,minAmount:_0x436ac4,search:_0x25845e}=_0x51b89c,_0x4775d5=(_0x107418-0x1)*_0x3d6730;console['log'](_0x1e6fc8(0x1e9),_0x51b89c);const _0x3c509b={'balance':{'gt':0x0},'status':_0x1e6fc8(0x14c)};_0x436ac4&&(_0x3c509b[_0x1e6fc8(0x1f9)]['gte']=_0x436ac4);_0x25845e&&(_0x3c509b['OR']=[{'name':{'contains':_0x25845e,'mode':'insensitive'}},{'username':{'contains':_0x25845e,'mode':_0x1e6fc8(0x1a8)}}]);const [_0x332652,_0x29334f]=await Promise[_0x1e6fc8(0xf5)]([database_1[_0x1e6fc8(0x140)][_0x1e6fc8(0x159)][_0x1e6fc8(0x15a)]({'where':_0x3c509b,'skip':_0x4775d5,'take':_0x3d6730,'orderBy':{'balance':_0x1e6fc8(0x180)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1['default']['shop'][_0x1e6fc8(0x1be)]({'where':_0x3c509b})]);console['log']('💰\x20Found\x20'+_0x332652[_0x1e6fc8(0x203)]+_0x1e6fc8(0x1f8));const _0x1e7677=await Promise[_0x1e6fc8(0xf5)](_0x332652[_0x1e6fc8(0x1a5)](async _0x5b7eb3=>{const _0x529eeb=_0x1e6fc8,[_0x1dd6b6,_0x170fec,_0x29f9ae]=await Promise['all']([database_1[_0x529eeb(0x140)][_0x529eeb(0x120)]['count']({'where':{'shopId':_0x5b7eb3['id'],'status':'PAID','amountUSDT':{'not':null}}}),database_1['default'][_0x529eeb(0x120)][_0x529eeb(0xf0)]({'where':{'shopId':_0x5b7eb3['id'],'status':_0x529eeb(0x197),'amountUSDT':{'not':null}},'orderBy':{'paidAt':_0x529eeb(0x12a)},'select':{'paidAt':!![]}}),database_1[_0x529eeb(0x140)][_0x529eeb(0x120)][_0x529eeb(0x1bc)]({'by':[_0x529eeb(0x1f5)],'where':{'shopId':_0x5b7eb3['id'],'status':_0x529eeb(0x197),'amountUSDT':{'not':null}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x87271c=new Date(),_0x25b4a8=new Date(_0x87271c['getFullYear'](),_0x87271c[_0x529eeb(0xff)](),0x1),_0x59c3ae=new Date(_0x87271c[_0x529eeb(0x1a4)](),_0x87271c[_0x529eeb(0xff)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x21040d,_0x83176]=await Promise['all']([database_1[_0x529eeb(0x140)][_0x529eeb(0x137)][_0x529eeb(0x151)]({'_sum':{'amount':!![]},'where':{'shopId':_0x5b7eb3['id'],'status':_0x529eeb(0x103)}}),database_1[_0x529eeb(0x140)][_0x529eeb(0x137)][_0x529eeb(0x151)]({'_sum':{'amount':!![]},'where':{'shopId':_0x5b7eb3['id'],'status':_0x529eeb(0x103),'createdAt':{'gte':_0x25b4a8,'lte':_0x59c3ae}}})]),_0x1e3d19=_0x21040d[_0x529eeb(0x1c3)][_0x529eeb(0x152)]||0x0,_0x13581a=_0x83176[_0x529eeb(0x1c3)][_0x529eeb(0x152)]||0x0,_0x1bddcc=await Promise[_0x529eeb(0xf5)](_0x29f9ae[_0x529eeb(0x1a5)](async _0x596eb7=>{const _0x575271=_0x529eeb;let _0x4e7d7a=0xa;if(_0x5b7eb3[_0x575271(0x1e0)])try{const _0x47e351=JSON[_0x575271(0x102)](_0x5b7eb3[_0x575271(0x1e0)]);for(const [_0x90bfd,_0x4f9364]of Object[_0x575271(0x1d1)](_0x47e351)){if(_0x90bfd[_0x575271(0x14d)]()===_0x596eb7['gateway'][_0x575271(0x14d)]()){_0x4e7d7a=_0x4f9364[_0x575271(0xea)]||0xa,console[_0x575271(0x106)]('💰\x20[PAYOUT]\x20Gateway\x20'+_0x596eb7[_0x575271(0x1f5)]+_0x575271(0x116)+_0x5b7eb3['id']+_0x575271(0x1b0)+_0x4e7d7a+'%');break;}}}catch(_0x49a5ef){console[_0x575271(0x111)]('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x5b7eb3['id']+':',_0x49a5ef);}const _0x52e8bb=_0x596eb7[_0x575271(0x1c3)][_0x575271(0x1a0)]||0x0,_0x4bb58e=_0x52e8bb*(0x1-_0x4e7d7a/0x64);return{'gateway':_0x596eb7[_0x575271(0x1f5)],'count':_0x596eb7[_0x575271(0x1f2)]['id'],'amountUSDT':Math[_0x575271(0x19c)](_0x52e8bb*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x575271(0x19c)](_0x4bb58e*0x64)/0x64,'commission':_0x4e7d7a};})),_0x1f90bf=_0x1bddcc[_0x529eeb(0x1c1)]((_0xe4544b,_0x58cabe)=>_0xe4544b+_0x58cabe['amountUSDT'],0x0),_0x1709e2=_0x5b7eb3[_0x529eeb(0x1f9)];return console[_0x529eeb(0x106)](_0x529eeb(0x133)+_0x5b7eb3[_0x529eeb(0x1c8)]+':'),console[_0x529eeb(0x106)](_0x529eeb(0x121)+_0x1f90bf[_0x529eeb(0x1e7)](0x2)+_0x529eeb(0x1c9)),console[_0x529eeb(0x106)](_0x529eeb(0x11b)+_0x1bddcc['reduce']((_0x3d37f0,_0x3a914c)=>_0x3d37f0+_0x3a914c['amountAfterCommissionUSDT'],0x0)[_0x529eeb(0x1e7)](0x2)+_0x529eeb(0x139)),console[_0x529eeb(0x106)](_0x529eeb(0x117)+_0x1709e2[_0x529eeb(0x1e7)](0x2)+'\x20USDT\x20(after\x20payouts)'),{'id':_0x5b7eb3['id'],'fullName':_0x5b7eb3[_0x529eeb(0x1f1)],'username':_0x5b7eb3[_0x529eeb(0x1c8)],'telegramId':_0x5b7eb3[_0x529eeb(0x1c0)],'merchantUrl':_0x5b7eb3[_0x529eeb(0x1bf)],'wallets':{'usdtPolygonWallet':_0x5b7eb3[_0x529eeb(0x179)],'usdtTrcWallet':_0x5b7eb3[_0x529eeb(0x122)],'usdtErcWallet':_0x5b7eb3[_0x529eeb(0x1f4)],'usdcPolygonWallet':_0x5b7eb3[_0x529eeb(0x14b)]},'totalAmountUSDT':Math['round'](_0x1f90bf*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x529eeb(0x19c)](_0x1709e2*0x64)/0x64,'totalPayout':Math['round'](_0x1e3d19*0x64)/0x64,'thisMonth':Math[_0x529eeb(0x19c)](_0x13581a*0x64)/0x64,'paymentsCount':_0x1dd6b6,'oldestPaymentDate':_0x170fec?.['paidAt']||_0x5b7eb3[_0x529eeb(0x176)],'gatewayBreakdown':_0x1bddcc};})),_0x1f86ce=_0x1e7677[_0x1e6fc8(0x1c1)]((_0x2a68ee,_0x82b11c)=>_0x2a68ee+_0x82b11c[_0x1e6fc8(0x13b)],0x0),_0x333f21=_0x1e7677[_0x1e6fc8(0x1c1)]((_0x58a1bb,_0x39731e)=>_0x58a1bb+_0x39731e[_0x1e6fc8(0x11c)],0x0),_0x4281fd=_0x1e7677[_0x1e6fc8(0x1c1)]((_0x3d6152,_0x732d4e)=>_0x3d6152+_0x732d4e[_0x1e6fc8(0x1a2)],0x0),_0x185e29=_0x1e7677[_0x1e6fc8(0x1c1)]((_0x121136,_0x19757a)=>_0x121136+_0x19757a['thisMonth'],0x0);return console[_0x1e6fc8(0x106)](_0x1e6fc8(0x1ac)+_0x29334f+_0x1e6fc8(0x162)),console[_0x1e6fc8(0x106)](_0x1e6fc8(0x1ef)+Math[_0x1e6fc8(0x19c)](_0x1f86ce*0x64)/0x64+_0x1e6fc8(0x1c9)),console['log'](_0x1e6fc8(0x1d4)+Math[_0x1e6fc8(0x19c)](_0x333f21*0x64)/0x64+_0x1e6fc8(0x169)),console['log'](_0x1e6fc8(0x16b)+Math[_0x1e6fc8(0x19c)](_0x4281fd*0x64)/0x64+_0x1e6fc8(0x15d)),console[_0x1e6fc8(0x106)]('\x20\x20\x20📅\x20Total\x20payouts\x20(this\x20month):\x20'+Math[_0x1e6fc8(0x19c)](_0x185e29*0x64)/0x64+_0x1e6fc8(0x15d)),{'merchants':_0x1e7677,'pagination':{'page':_0x107418,'limit':_0x3d6730,'total':_0x29334f,'totalPages':Math[_0x1e6fc8(0x175)](_0x29334f/_0x3d6730)},'summary':{'totalMerchants':_0x29334f,'totalAmountUSDT':Math['round'](_0x1f86ce*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x1e6fc8(0x19c)](_0x333f21*0x64)/0x64,'totalPayout':Math[_0x1e6fc8(0x19c)](_0x4281fd*0x64)/0x64,'thisMonth':Math[_0x1e6fc8(0x19c)](_0x185e29*0x64)/0x64}};}async[a35_0xc6abd3(0x1b3)](_0x37f79c){const _0x4914f5=a35_0xc6abd3,{shopId:_0x1e7ebb,amount:_0x22b4c0,network:_0x2360a5,wallet:_0x54a69d,notes:_0x37a692,txid:_0x313110,periodFrom:_0x25ce50,periodTo:_0x1d2b3d}=_0x37f79c,_0x172742=await database_1['default'][_0x4914f5(0x11e)](async _0x365dab=>{const _0x1a5a03=_0x4914f5,_0x5a97bd=await _0x365dab[_0x1a5a03(0x159)][_0x1a5a03(0x190)]({'where':{'id':_0x1e7ebb},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x5a97bd)throw new Error('Shop\x20not\x20found');console[_0x1a5a03(0x106)](_0x1a5a03(0x13d)+_0x5a97bd[_0x1a5a03(0x1c8)]+':'),console['log']('\x20\x20\x20Current\x20balance:\x20'+_0x5a97bd[_0x1a5a03(0x1f9)][_0x1a5a03(0x1e7)](0x6)+'\x20USDT'),console[_0x1a5a03(0x106)](_0x1a5a03(0x13f)+_0x22b4c0[_0x1a5a03(0x1e7)](0x6)+_0x1a5a03(0x15d)),console[_0x1a5a03(0x106)](_0x1a5a03(0x10d)+_0x5a97bd[_0x1a5a03(0x156)][_0x1a5a03(0x1e7)](0x6)+_0x1a5a03(0x15d));if(_0x313110)console['log']('\x20\x20\x20Transaction\x20hash:\x20'+_0x313110);if(_0x5a97bd[_0x1a5a03(0x1f9)]<_0x22b4c0)throw new Error(_0x1a5a03(0xf4)+_0x5a97bd[_0x1a5a03(0x1f9)][_0x1a5a03(0x1e7)](0x6)+'\x20USDT,\x20Requested:\x20'+_0x22b4c0[_0x1a5a03(0x1e7)](0x6)+_0x1a5a03(0x15d));let _0x1d412b=_0x54a69d;if(!_0x1d412b){const _0xc592f9=await _0x365dab[_0x1a5a03(0x159)][_0x1a5a03(0x190)]({'where':{'id':_0x1e7ebb},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0xc592f9)switch(_0x2360a5){case'polygon':_0x1d412b=_0xc592f9['usdtPolygonWallet']||undefined;break;case _0x1a5a03(0x16f):_0x1d412b=_0xc592f9[_0x1a5a03(0x122)]||undefined;break;case _0x1a5a03(0x1d9):_0x1d412b=_0xc592f9['usdtErcWallet']||undefined;break;case _0x1a5a03(0x11a):_0x1d412b=_0xc592f9[_0x1a5a03(0x14b)]||undefined;break;}}console[_0x1a5a03(0x106)](_0x1a5a03(0x101)+_0x2360a5+':\x20'+(_0x1d412b||'not\x20specified'));const _0x2776fa=await _0x365dab[_0x1a5a03(0x137)]['create']({'data':{'shopId':_0x1e7ebb,'amount':_0x22b4c0,'network':_0x2360a5,'status':_0x1a5a03(0x103),'txid':_0x313110,'notes':_0x37a692,'periodFrom':_0x25ce50?new Date(_0x25ce50):null,'periodTo':_0x1d2b3d?new Date(_0x1d2b3d):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x920806=_0x5a97bd[_0x1a5a03(0x1f9)]-_0x22b4c0,_0x223d95=_0x5a97bd[_0x1a5a03(0x156)]+_0x22b4c0;return await _0x365dab[_0x1a5a03(0x159)][_0x1a5a03(0x1ff)]({'where':{'id':_0x1e7ebb},'data':{'balance':_0x920806,'totalPaidOut':_0x223d95}}),console[_0x1a5a03(0x106)](_0x1a5a03(0x188)+_0x5a97bd[_0x1a5a03(0x1c8)]+'\x20balance\x20updated:'),console[_0x1a5a03(0x106)](_0x1a5a03(0x1e4)+_0x5a97bd[_0x1a5a03(0x1f9)]['toFixed'](0x6)+'\x20->\x20'+_0x920806[_0x1a5a03(0x1e7)](0x6)+_0x1a5a03(0x16a)+_0x22b4c0['toFixed'](0x6)+')'),console[_0x1a5a03(0x106)](_0x1a5a03(0x164)+_0x5a97bd[_0x1a5a03(0x156)][_0x1a5a03(0x1e7)](0x6)+_0x1a5a03(0x189)+_0x223d95['toFixed'](0x6)+'\x20USDT\x20(+'+_0x22b4c0[_0x1a5a03(0x1e7)](0x6)+')'),{'payout':_0x2776fa,'shop':_0x5a97bd};});return console[_0x4914f5(0x106)](_0x4914f5(0x1e6)+_0x172742[_0x4914f5(0x137)]['id']+_0x4914f5(0x116)+_0x172742[_0x4914f5(0x159)][_0x4914f5(0x1c8)]+'\x20('+_0x22b4c0+_0x4914f5(0x1dc)),{'id':_0x172742[_0x4914f5(0x137)]['id'],'shopId':_0x172742[_0x4914f5(0x137)]['shopId'],'shopName':_0x172742[_0x4914f5(0x159)][_0x4914f5(0x1f1)],'shopUsername':_0x172742['shop']['username'],'amount':_0x172742[_0x4914f5(0x137)]['amount'],'network':_0x172742[_0x4914f5(0x137)]['network'],'status':_0x172742['payout'][_0x4914f5(0x12b)],'txid':_0x172742[_0x4914f5(0x137)][_0x4914f5(0x17a)],'notes':_0x172742[_0x4914f5(0x137)][_0x4914f5(0x172)],'periodFrom':_0x172742[_0x4914f5(0x137)][_0x4914f5(0x143)],'periodTo':_0x172742[_0x4914f5(0x137)]['periodTo'],'createdAt':_0x172742[_0x4914f5(0x137)][_0x4914f5(0x176)],'paidAt':_0x172742[_0x4914f5(0x137)][_0x4914f5(0x1a1)]};}async[a35_0xc6abd3(0x115)](_0x451f20){const _0x24fbb5=a35_0xc6abd3,{page:_0x168743,limit:_0x5b1a0a,shopId:_0x209600,network:_0x16eab8,dateFrom:_0x18a408,dateTo:_0x2e5368,search:_0x1c4ee5}=_0x451f20,_0xe635b3=(_0x168743-0x1)*_0x5b1a0a,_0x182a85={};_0x209600&&(_0x182a85[_0x24fbb5(0x1d7)]=_0x209600);_0x16eab8&&(_0x182a85['network']=_0x16eab8);(_0x18a408||_0x2e5368)&&(_0x182a85['createdAt']={},_0x18a408&&(_0x182a85['createdAt'][_0x24fbb5(0x194)]=new Date(_0x18a408)),_0x2e5368&&(_0x182a85[_0x24fbb5(0x176)]['lte']=new Date(_0x2e5368)));_0x1c4ee5&&(_0x182a85['OR']=[{'shop':{'name':{'contains':_0x1c4ee5,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x1c4ee5,'mode':'insensitive'}}},{'notes':{'contains':_0x1c4ee5,'mode':'insensitive'}}]);const [_0x8c9b21,_0xc8dd2a]=await Promise[_0x24fbb5(0xf5)]([database_1[_0x24fbb5(0x140)][_0x24fbb5(0x137)]['findMany']({'where':_0x182a85,'skip':_0xe635b3,'take':_0x5b1a0a,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default']['payout']['count']({'where':_0x182a85})]);return{'payouts':_0x8c9b21['map'](_0x3a9b50=>({'id':_0x3a9b50['id'],'shopId':_0x3a9b50[_0x24fbb5(0x1d7)],'shopName':_0x3a9b50[_0x24fbb5(0x159)][_0x24fbb5(0x1f1)],'shopUsername':_0x3a9b50[_0x24fbb5(0x159)][_0x24fbb5(0x1c8)],'amount':_0x3a9b50['amount'],'network':_0x3a9b50['network'],'status':_0x3a9b50[_0x24fbb5(0x12b)],'txid':_0x3a9b50[_0x24fbb5(0x17a)],'notes':_0x3a9b50[_0x24fbb5(0x172)],'periodFrom':_0x3a9b50[_0x24fbb5(0x143)],'periodTo':_0x3a9b50[_0x24fbb5(0x1e8)],'createdAt':_0x3a9b50[_0x24fbb5(0x176)],'paidAt':_0x3a9b50[_0x24fbb5(0x1a1)]})),'pagination':{'page':_0x168743,'limit':_0x5b1a0a,'total':_0xc8dd2a,'totalPages':Math[_0x24fbb5(0x175)](_0xc8dd2a/_0x5b1a0a)}};}async[a35_0xc6abd3(0x19f)](_0xfb5e58){const _0x55e59d=a35_0xc6abd3,_0x10aa65=await database_1[_0x55e59d(0x140)]['payout'][_0x55e59d(0x190)]({'where':{'id':_0xfb5e58},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x10aa65)return null;return{'id':_0x10aa65['id'],'shopId':_0x10aa65[_0x55e59d(0x1d7)],'shopName':_0x10aa65[_0x55e59d(0x159)][_0x55e59d(0x1f1)],'shopUsername':_0x10aa65[_0x55e59d(0x159)][_0x55e59d(0x1c8)],'amount':_0x10aa65['amount'],'network':_0x10aa65['network'],'status':_0x10aa65[_0x55e59d(0x12b)],'txid':_0x10aa65['txid'],'notes':_0x10aa65[_0x55e59d(0x172)],'periodFrom':_0x10aa65['periodFrom'],'periodTo':_0x10aa65[_0x55e59d(0x1e8)],'createdAt':_0x10aa65[_0x55e59d(0x176)],'paidAt':_0x10aa65['paidAt']};}async['deletePayout'](_0x31e7bc){const _0x5267d4=a35_0xc6abd3;await database_1[_0x5267d4(0x140)]['payout'][_0x5267d4(0x1a7)]({'where':{'id':_0x31e7bc}});}async[a35_0xc6abd3(0x153)](_0xd291d6){const _0x28d3a2=a35_0xc6abd3,{page:_0x38002f,limit:_0x5ce850,status:_0x23778e,gateway:_0x281959,shopId:_0xf75eb7,dateFrom:_0x30234b,dateTo:_0x216414,search:_0xec5d8f,currency:_0xfe2ebe,sortBy:_0x2df84f,sortOrder:_0x478bba}=_0xd291d6,_0x3051af=(_0x38002f-0x1)*_0x5ce850;console['log'](_0x28d3a2(0x198),_0xd291d6);const _0x3ab14c=await database_1[_0x28d3a2(0x140)][_0x28d3a2(0x120)][_0x28d3a2(0x1bc)]({'by':[_0x28d3a2(0x1f5)],'_count':{'gateway':!![]}});console['log'](_0x28d3a2(0x144),_0x3ab14c[_0x28d3a2(0x1a5)](_0xad1280=>_0xad1280[_0x28d3a2(0x1f5)]+'\x20('+_0xad1280['_count']['gateway']+_0x28d3a2(0x12d)));if(_0x281959){const _0x52411c=_0x3ab14c[_0x28d3a2(0x1d8)](_0x86fccf=>_0x86fccf[_0x28d3a2(0x1f5)]['toLowerCase']()===_0x281959[_0x28d3a2(0x14d)]());!_0x52411c&&_0x281959['toLowerCase']()!=='test_gateway'&&console[_0x28d3a2(0x106)](_0x28d3a2(0x1ae)+_0x281959+_0x28d3a2(0x148)+_0x3ab14c['map'](_0x275544=>_0x275544[_0x28d3a2(0x1f5)])[_0x28d3a2(0x16e)](',\x20'));}const _0x5597f9={};_0x23778e&&(_0x5597f9[_0x28d3a2(0x12b)]=_0x23778e[_0x28d3a2(0x1d5)]());if(!_0x281959)_0x5597f9['gateway']={'not':_0x28d3a2(0x19b)};else{if(_0x281959&&(_0x281959[_0x28d3a2(0x14d)]()===_0x28d3a2(0x19b)||_0x281959===_0x28d3a2(0x128)))_0x5597f9[_0x28d3a2(0x1f5)]=_0x28d3a2(0x19b);else{let _0x21abfb=_0x281959;const _0x1330fd=(0x0,gateway_1[_0x28d3a2(0x13e)])(_0x281959);if(_0x1330fd)_0x21abfb=_0x1330fd,console['log'](_0x28d3a2(0x1a9)+_0x281959+_0x28d3a2(0x145)+_0x21abfb+'\x27');else{const _0x152159=(0x0,gateway_1[_0x28d3a2(0xf8)])(_0x281959);if(_0x152159){const _0x56c83c=(0x0,gateway_1[_0x28d3a2(0x13e)])(_0x152159);_0x56c83c&&(_0x21abfb=_0x56c83c,console['log']('🔄\x20Converted\x20gateway\x20name\x20\x27'+_0x281959+_0x28d3a2(0x1b8)+_0x152159+_0x28d3a2(0x1db)+_0x21abfb+'\x27'));}else console['log'](_0x28d3a2(0x17f)+_0x281959+_0x28d3a2(0x19a));}const _0x5553cc=await database_1[_0x28d3a2(0x140)]['payment'][_0x28d3a2(0x1be)]({'where':{'gateway':_0x21abfb[_0x28d3a2(0x14d)]()},'take':0x1});_0x5553cc===0x0?(console[_0x28d3a2(0x106)](_0x28d3a2(0x1ee)+_0x21abfb+_0x28d3a2(0x13a)+_0x281959+_0x28d3a2(0x14f)),_0x5597f9[_0x28d3a2(0x1f5)]=_0x28d3a2(0xfd)):(_0x5597f9[_0x28d3a2(0x1f5)]=_0x21abfb[_0x28d3a2(0x14d)](),console[_0x28d3a2(0x106)]('✅\x20Using\x20gateway\x20filter:\x20\x27'+_0x21abfb+_0x28d3a2(0x13a)+_0x281959+'\x27)'));}}console['log'](_0x28d3a2(0x18b),_0x5597f9[_0x28d3a2(0x1f5)]);_0xf75eb7&&(_0x5597f9['shopId']=_0xf75eb7);_0xfe2ebe&&(_0x5597f9[_0x28d3a2(0x141)]=_0xfe2ebe['toUpperCase'](),console[_0x28d3a2(0x106)](_0x28d3a2(0x19e)+_0xfe2ebe['toUpperCase']()));(_0x30234b||_0x216414)&&(_0x5597f9['createdAt']={},_0x30234b&&(_0x5597f9['createdAt']['gte']=new Date(_0x30234b)),_0x216414&&(_0x5597f9[_0x28d3a2(0x176)][_0x28d3a2(0x1b7)]=new Date(_0x216414)));_0xec5d8f&&(_0x5597f9['OR']=[{'id':{'contains':_0xec5d8f,'mode':'insensitive'}},{'orderId':{'contains':_0xec5d8f,'mode':'insensitive'}},{'gatewayOrderId':{'contains':_0xec5d8f,'mode':_0x28d3a2(0x1a8)}},{'customerEmail':{'contains':_0xec5d8f,'mode':'insensitive'}},{'shop':{'name':{'contains':_0xec5d8f,'mode':_0x28d3a2(0x1a8)}}},{'shop':{'username':{'contains':_0xec5d8f,'mode':_0x28d3a2(0x1a8)}}}]);console[_0x28d3a2(0x106)](_0x28d3a2(0x1e3),JSON[_0x28d3a2(0x16d)](_0x5597f9,null,0x2));let _0x412872={'createdAt':_0x28d3a2(0x180)};if(_0x2df84f){const _0x337af6=[_0x28d3a2(0x152),_0x28d3a2(0x176),_0x28d3a2(0x177),_0x28d3a2(0x12b),_0x28d3a2(0x1f5),_0x28d3a2(0x141)],_0x33eee7=[_0x28d3a2(0x12a),_0x28d3a2(0x180)];if(_0x337af6[_0x28d3a2(0x107)](_0x2df84f)){const _0x568ecf=_0x33eee7[_0x28d3a2(0x107)](_0x478bba)?_0x478bba:_0x28d3a2(0x180);_0x412872={[_0x2df84f]:_0x568ecf},console[_0x28d3a2(0x106)](_0x28d3a2(0xed)+_0x2df84f+_0x28d3a2(0x118)+_0x568ecf+_0x28d3a2(0x186));}}const [_0x29f092,_0x15b217]=await Promise[_0x28d3a2(0xf5)]([database_1['default'][_0x28d3a2(0x120)][_0x28d3a2(0x15a)]({'where':_0x5597f9,'skip':_0x3051af,'take':_0x5ce850,'orderBy':_0x412872,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x28d3a2(0x140)][_0x28d3a2(0x120)]['count']({'where':_0x5597f9})]);return{'payments':_0x29f092[_0x28d3a2(0x1a5)](_0x58c994=>({'id':_0x58c994['id'],'shopId':_0x58c994['shopId'],'gateway':_0x58c994[_0x28d3a2(0x1f5)],'amount':_0x58c994[_0x28d3a2(0x152)],'currency':_0x58c994[_0x28d3a2(0x141)],'status':_0x58c994[_0x28d3a2(0x12b)],'orderId':_0x58c994[_0x28d3a2(0x1e2)],'gatewayOrderId':_0x58c994['gatewayOrderId'],'customerEmail':_0x58c994[_0x28d3a2(0xf7)],'customerName':_0x58c994[_0x28d3a2(0x17b)],'customerCountry':_0x58c994[_0x28d3a2(0x158)],'customerIp':_0x58c994[_0x28d3a2(0x1bd)],'customerUa':_0x58c994[_0x28d3a2(0xe7)],'failureMessage':_0x58c994['failureMessage'],'createdAt':_0x58c994[_0x28d3a2(0x176)],'updatedAt':_0x58c994[_0x28d3a2(0x177)],'shop':_0x58c994[_0x28d3a2(0x159)]})),'pagination':{'page':_0x38002f,'limit':_0x5ce850,'total':_0x15b217,'totalPages':Math['ceil'](_0x15b217/_0x5ce850)}};}async[a35_0xc6abd3(0x1a6)](_0x2241a5){const _0x289a78=a35_0xc6abd3,_0x10cadb=await database_1[_0x289a78(0x140)][_0x289a78(0x120)][_0x289a78(0x190)]({'where':{'id':_0x2241a5},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x10cadb)return null;return{'id':_0x10cadb['id'],'shopId':_0x10cadb['shopId'],'gateway':_0x10cadb[_0x289a78(0x1f5)],'amount':_0x10cadb[_0x289a78(0x152)],'currency':_0x10cadb[_0x289a78(0x141)],'status':_0x10cadb[_0x289a78(0x12b)],'orderId':_0x10cadb[_0x289a78(0x1e2)],'gatewayOrderId':_0x10cadb[_0x289a78(0x185)],'customerEmail':_0x10cadb[_0x289a78(0xf7)],'customerName':_0x10cadb[_0x289a78(0x17b)],'customerCountry':_0x10cadb[_0x289a78(0x158)],'customerIp':_0x10cadb[_0x289a78(0x1bd)],'customerUa':_0x10cadb[_0x289a78(0xe7)],'failureMessage':_0x10cadb[_0x289a78(0x161)],'externalPaymentUrl':_0x10cadb[_0x289a78(0x1cd)],'successUrl':_0x10cadb[_0x289a78(0x12c)],'failUrl':_0x10cadb['failUrl'],'pendingUrl':_0x10cadb[_0x289a78(0xe8)],'whiteUrl':_0x10cadb[_0x289a78(0x1c5)],'createdAt':_0x10cadb[_0x289a78(0x176)],'updatedAt':_0x10cadb[_0x289a78(0x177)],'shop':_0x10cadb[_0x289a78(0x159)]};}async[a35_0xc6abd3(0x1fe)](_0x5bb10a,_0x91fab6,_0x5313c0,_0x1b47f4){const _0x199568=a35_0xc6abd3,_0x3e6586=await database_1[_0x199568(0x140)][_0x199568(0x11e)](async _0x18ffd4=>{const _0x273fab=_0x199568,_0x53af77=await _0x18ffd4[_0x273fab(0x120)][_0x273fab(0x190)]({'where':{'id':_0x5bb10a},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x53af77)throw new Error(_0x273fab(0x1fc));const _0x40bd1e=_0x53af77[_0x273fab(0x12b)],_0x529456=_0x91fab6['toUpperCase']();console['log'](_0x273fab(0x160)+_0x5bb10a+_0x273fab(0x1d0)+_0x40bd1e+'\x20->\x20'+_0x529456),console[_0x273fab(0x106)]('💰\x20Current\x20shop\x20balance:\x20'+_0x53af77[_0x273fab(0x159)][_0x273fab(0x1f9)]+_0x273fab(0x15d));const _0x44226c={'status':_0x529456,'updatedAt':new Date(),'statusChangedBy':'admin','statusChangedAt':new Date()};_0x5313c0&&(_0x44226c[_0x273fab(0x13c)]=_0x5313c0);_0x529456==='CHARGEBACK'&&_0x1b47f4&&(_0x44226c['chargebackAmount']=_0x1b47f4);let _0x41f29b=0x0,_0x30c68c=_0x53af77[_0x273fab(0x159)]['balance'];if(_0x529456===_0x273fab(0x197)&&_0x40bd1e!==_0x273fab(0x197)){_0x44226c[_0x273fab(0x1a1)]=new Date();const _0x24f23=await currencyService_1[_0x273fab(0x15b)][_0x273fab(0xf6)](_0x53af77[_0x273fab(0x152)],_0x53af77[_0x273fab(0x141)]);_0x44226c['amountUSDT']=_0x24f23;let _0x1c5f4e=0xa;const _0x513811=await _0x18ffd4[_0x273fab(0x159)][_0x273fab(0x190)]({'where':{'id':_0x53af77[_0x273fab(0x1d7)]},'select':{'gatewaySettings':!![]}});if(_0x513811?.[_0x273fab(0x1e0)])try{const _0x1d0a80=JSON[_0x273fab(0x102)](_0x513811[_0x273fab(0x1e0)]);for(const [_0x398714,_0x51b315]of Object[_0x273fab(0x1d1)](_0x1d0a80)){if(_0x398714[_0x273fab(0x14d)]()===_0x53af77[_0x273fab(0x1f5)][_0x273fab(0x14d)]()){_0x1c5f4e=_0x51b315[_0x273fab(0xea)]||0xa;break;}}}catch(_0x2120b5){console[_0x273fab(0x111)](_0x273fab(0x1bb)+_0x5bb10a+':',_0x2120b5);}const _0x21a2fb=_0x24f23*(0x1-_0x1c5f4e/0x64);_0x41f29b=_0x21a2fb,_0x30c68c+=_0x21a2fb,console[_0x273fab(0x106)](_0x273fab(0x181)+_0x5bb10a+'\x20became\x20PAID:'),console[_0x273fab(0x106)](_0x273fab(0x157)+_0x24f23['toFixed'](0x6)+_0x273fab(0x15d)),console[_0x273fab(0x106)]('\x20\x20\x20Gateway:\x20'+_0x53af77[_0x273fab(0x1f5)]+_0x273fab(0x183)+_0x1c5f4e+'%'),console[_0x273fab(0x106)](_0x273fab(0x1b1)+_0x21a2fb[_0x273fab(0x1e7)](0x6)+'\x20USDT\x20(after\x20'+_0x1c5f4e+_0x273fab(0x119)),console['log'](_0x273fab(0x167)+_0x21a2fb[_0x273fab(0x1e7)](0x6)+_0x273fab(0x15d));}else{if(_0x40bd1e==='PAID'&&_0x529456!=='PAID'){if(_0x53af77['amountUSDT']){let _0x79a8d0=0xa;const _0x1f3449=await _0x18ffd4[_0x273fab(0x159)][_0x273fab(0x190)]({'where':{'id':_0x53af77[_0x273fab(0x1d7)]},'select':{'gatewaySettings':!![]}});if(_0x1f3449?.[_0x273fab(0x1e0)])try{const _0x227746=JSON[_0x273fab(0x102)](_0x1f3449['gatewaySettings']);for(const [_0x3b3b30,_0x538cd4]of Object['entries'](_0x227746)){if(_0x3b3b30['toLowerCase']()===_0x53af77[_0x273fab(0x1f5)][_0x273fab(0x14d)]()){_0x79a8d0=_0x538cd4['commission']||0xa;break;}}}catch(_0x5e6628){console[_0x273fab(0x111)](_0x273fab(0x1bb)+_0x5bb10a+':',_0x5e6628);}const _0x89af19=_0x53af77[_0x273fab(0x1a0)]*(0x1-_0x79a8d0/0x64);_0x41f29b=-_0x89af19,_0x30c68c-=_0x89af19,_0x44226c['amountUSDT']=null,console[_0x273fab(0x106)](_0x273fab(0x181)+_0x5bb10a+_0x273fab(0x155)),console[_0x273fab(0x106)]('\x20\x20\x20Full\x20amount:\x20'+_0x53af77['amountUSDT'][_0x273fab(0x1e7)](0x6)+'\x20USDT'),console[_0x273fab(0x106)](_0x273fab(0x199)+_0x53af77['gateway']+',\x20Commission:\x20'+_0x79a8d0+'%'),console[_0x273fab(0x106)]('\x20\x20\x20Merchant\x20loses:\x20'+_0x89af19[_0x273fab(0x1e7)](0x6)+'\x20USDT\x20(after\x20'+_0x79a8d0+_0x273fab(0x119)),console['log'](_0x273fab(0x1d2)+_0x89af19['toFixed'](0x6)+_0x273fab(0x15d));}}}_0x529456===_0x273fab(0x1ad)&&(_0x40bd1e==='PAID'&&_0x53af77['amountUSDT']&&console[_0x273fab(0x106)](_0x273fab(0x1fd)),_0x1b47f4&&_0x1b47f4>0x0&&(_0x41f29b-=_0x1b47f4,_0x30c68c-=_0x1b47f4,console[_0x273fab(0x106)](_0x273fab(0x1f6)+_0x1b47f4[_0x273fab(0x1e7)](0x6)+_0x273fab(0x10c))));_0x529456==='REFUND'&&_0x40bd1e==='PAID'&&console[_0x273fab(0x106)]('🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance');const _0x385d0d=await _0x18ffd4['payment'][_0x273fab(0x1ff)]({'where':{'id':_0x5bb10a},'data':_0x44226c,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x41f29b!==0x0&&(await _0x18ffd4[_0x273fab(0x159)]['update']({'where':{'id':_0x53af77['shopId']},'data':{'balance':_0x30c68c}}),console['log'](_0x273fab(0x188)+_0x53af77['shopId']+'\x20balance\x20updated:\x20'+_0x53af77[_0x273fab(0x159)][_0x273fab(0x1f9)][_0x273fab(0x1e7)](0x6)+'\x20->\x20'+_0x30c68c[_0x273fab(0x1e7)](0x6)+_0x273fab(0x195)+(_0x41f29b>0x0?'+':'')+_0x41f29b['toFixed'](0x6)+')')),_0x385d0d;});return{'id':_0x3e6586['id'],'shopId':_0x3e6586['shopId'],'gateway':_0x3e6586['gateway'],'amount':_0x3e6586['amount'],'currency':_0x3e6586[_0x199568(0x141)],'status':_0x3e6586[_0x199568(0x12b)],'orderId':_0x3e6586['orderId'],'gatewayOrderId':_0x3e6586[_0x199568(0x185)],'customerEmail':_0x3e6586[_0x199568(0xf7)],'customerName':_0x3e6586['customerName'],'customerCountry':_0x3e6586['customerCountry'],'customerIp':_0x3e6586['customerIp'],'customerUa':_0x3e6586['customerUa'],'failureMessage':_0x3e6586[_0x199568(0x161)],'adminNotes':_0x3e6586[_0x199568(0x13c)],'chargebackAmount':_0x3e6586[_0x199568(0x15e)],'statusChangedBy':_0x3e6586[_0x199568(0x1fb)],'statusChangedAt':_0x3e6586['statusChangedAt'],'createdAt':_0x3e6586[_0x199568(0x176)],'updatedAt':_0x3e6586['updatedAt'],'shop':_0x3e6586[_0x199568(0x159)]};}async[a35_0xc6abd3(0x12f)](_0x153281,_0x1775f0){const _0x1ec137=a35_0xc6abd3,_0x4e42a3={..._0x1775f0};_0x1775f0[_0x1ec137(0x10a)]&&(_0x4e42a3[_0x1ec137(0x10a)]=await bcryptjs_1[_0x1ec137(0x140)][_0x1ec137(0x1b9)](_0x1775f0[_0x1ec137(0x10a)],0xc));_0x1775f0[_0x1ec137(0x192)]&&(_0x4e42a3[_0x1ec137(0x1f1)]=_0x1775f0[_0x1ec137(0x192)],delete _0x4e42a3[_0x1ec137(0x192)]);_0x1775f0[_0x1ec137(0xfc)]&&(_0x4e42a3[_0x1ec137(0x1c0)]=_0x1775f0['telegramId'],delete _0x4e42a3[_0x1ec137(0xfc)]);_0x1775f0[_0x1ec137(0x134)]&&(_0x4e42a3[_0x1ec137(0x1bf)]=_0x1775f0['merchantUrl'],delete _0x4e42a3['merchantUrl']);_0x1775f0[_0x1ec137(0x1da)]&&(_0x4e42a3[_0x1ec137(0x124)]=JSON[_0x1ec137(0x16d)](_0x1775f0[_0x1ec137(0x1da)]),delete _0x4e42a3[_0x1ec137(0x1da)]);_0x1775f0['gatewaySettings']&&(_0x4e42a3['gatewaySettings']=JSON[_0x1ec137(0x16d)](_0x1775f0[_0x1ec137(0x1e0)]),delete _0x4e42a3['gatewaySettings']);_0x1775f0['wallets']&&(_0x1775f0[_0x1ec137(0x142)][_0x1ec137(0x179)]!==undefined&&(_0x4e42a3[_0x1ec137(0x179)]=_0x1775f0[_0x1ec137(0x142)][_0x1ec137(0x179)]||null),_0x1775f0[_0x1ec137(0x142)][_0x1ec137(0x122)]!==undefined&&(_0x4e42a3[_0x1ec137(0x122)]=_0x1775f0[_0x1ec137(0x142)][_0x1ec137(0x122)]||null),_0x1775f0[_0x1ec137(0x142)][_0x1ec137(0x1f4)]!==undefined&&(_0x4e42a3['usdtErcWallet']=_0x1775f0[_0x1ec137(0x142)]['usdtErcWallet']||null),_0x1775f0[_0x1ec137(0x142)][_0x1ec137(0x14b)]!==undefined&&(_0x4e42a3[_0x1ec137(0x14b)]=_0x1775f0[_0x1ec137(0x142)]['usdcPolygonWallet']||null),delete _0x4e42a3[_0x1ec137(0x142)]);const _0x38cd10=await database_1[_0x1ec137(0x140)][_0x1ec137(0x159)][_0x1ec137(0x1ff)]({'where':{'id':_0x153281},'data':_0x4e42a3,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x38cd10['id'],'fullName':_0x38cd10[_0x1ec137(0x1f1)],'username':_0x38cd10[_0x1ec137(0x1c8)],'telegramId':_0x38cd10[_0x1ec137(0x1c0)],'merchantUrl':_0x38cd10[_0x1ec137(0x1bf)],'gateways':_0x38cd10['paymentGateways']?JSON[_0x1ec137(0x102)](_0x38cd10[_0x1ec137(0x124)]):null,'gatewaySettings':_0x38cd10[_0x1ec137(0x1e0)]?JSON[_0x1ec137(0x102)](_0x38cd10[_0x1ec137(0x1e0)]):null,'publicKey':_0x38cd10[_0x1ec137(0x1aa)],'wallets':{'usdtPolygonWallet':_0x38cd10[_0x1ec137(0x179)],'usdtTrcWallet':_0x38cd10['usdtTrcWallet'],'usdtErcWallet':_0x38cd10[_0x1ec137(0x1f4)],'usdcPolygonWallet':_0x38cd10[_0x1ec137(0x14b)]},'status':_0x38cd10['status'],'createdAt':_0x38cd10[_0x1ec137(0x176)]};}async[a35_0xc6abd3(0xeb)](_0x5001a4){const _0x58ab54=a35_0xc6abd3,_0x1f2f8e=await database_1[_0x58ab54(0x140)][_0x58ab54(0x159)][_0x58ab54(0x1ff)]({'where':{'id':_0x5001a4},'data':{'status':_0x58ab54(0x202)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x1f2f8e['id'],'fullName':_0x1f2f8e[_0x58ab54(0x1f1)],'username':_0x1f2f8e['username'],'telegramId':_0x1f2f8e[_0x58ab54(0x1c0)],'merchantUrl':_0x1f2f8e[_0x58ab54(0x1bf)],'gateways':_0x1f2f8e[_0x58ab54(0x124)]?JSON[_0x58ab54(0x102)](_0x1f2f8e[_0x58ab54(0x124)]):null,'gatewaySettings':_0x1f2f8e[_0x58ab54(0x1e0)]?JSON[_0x58ab54(0x102)](_0x1f2f8e[_0x58ab54(0x1e0)]):null,'publicKey':_0x1f2f8e['publicKey'],'wallets':{'usdtPolygonWallet':_0x1f2f8e[_0x58ab54(0x179)],'usdtTrcWallet':_0x1f2f8e[_0x58ab54(0x122)],'usdtErcWallet':_0x1f2f8e[_0x58ab54(0x1f4)],'usdcPolygonWallet':_0x1f2f8e['usdcPolygonWallet']},'status':_0x1f2f8e[_0x58ab54(0x12b)],'createdAt':_0x1f2f8e[_0x58ab54(0x176)]};}async['activateUser'](_0x22994c){const _0x1c813c=a35_0xc6abd3,_0x41b523=await database_1['default']['shop'][_0x1c813c(0x1ff)]({'where':{'id':_0x22994c},'data':{'status':_0x1c813c(0x14c)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x41b523['id'],'fullName':_0x41b523[_0x1c813c(0x1f1)],'username':_0x41b523['username'],'telegramId':_0x41b523['telegram'],'merchantUrl':_0x41b523['shopUrl'],'gateways':_0x41b523[_0x1c813c(0x124)]?JSON[_0x1c813c(0x102)](_0x41b523[_0x1c813c(0x124)]):null,'gatewaySettings':_0x41b523[_0x1c813c(0x1e0)]?JSON[_0x1c813c(0x102)](_0x41b523[_0x1c813c(0x1e0)]):null,'publicKey':_0x41b523['publicKey'],'wallets':{'usdtPolygonWallet':_0x41b523[_0x1c813c(0x179)],'usdtTrcWallet':_0x41b523[_0x1c813c(0x122)],'usdtErcWallet':_0x41b523[_0x1c813c(0x1f4)],'usdcPolygonWallet':_0x41b523[_0x1c813c(0x14b)]},'status':_0x41b523[_0x1c813c(0x12b)],'createdAt':_0x41b523[_0x1c813c(0x176)]};}async[a35_0xc6abd3(0x1ab)](_0x37dbce){const _0x3aad77=a35_0xc6abd3,{page:_0x36b181,limit:_0x25add0,status:_0x4ece90}=_0x37dbce,_0x1071cd=(_0x36b181-0x1)*_0x25add0,_0x2e488d={};_0x4ece90&&(_0x2e488d[_0x3aad77(0x12b)]=_0x4ece90[_0x3aad77(0x1d5)]());const [_0x2e1673,_0x44cbe8]=await Promise[_0x3aad77(0xf5)]([database_1[_0x3aad77(0x140)][_0x3aad77(0x159)][_0x3aad77(0x15a)]({'where':_0x2e488d,'skip':_0x1071cd,'take':_0x25add0,'orderBy':{'createdAt':_0x3aad77(0x180)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x3aad77(0x140)][_0x3aad77(0x159)][_0x3aad77(0x1be)]({'where':_0x2e488d})]);return{'users':_0x2e1673[_0x3aad77(0x1a5)](_0x2a1e32=>({'id':_0x2a1e32['id'],'fullName':_0x2a1e32[_0x3aad77(0x1f1)],'username':_0x2a1e32[_0x3aad77(0x1c8)],'telegramId':_0x2a1e32[_0x3aad77(0x1c0)],'merchantUrl':_0x2a1e32[_0x3aad77(0x1bf)],'gateways':_0x2a1e32[_0x3aad77(0x124)]?JSON[_0x3aad77(0x102)](_0x2a1e32[_0x3aad77(0x124)]):null,'gatewaySettings':_0x2a1e32[_0x3aad77(0x1e0)]?JSON[_0x3aad77(0x102)](_0x2a1e32['gatewaySettings']):null,'publicKey':_0x2a1e32['publicKey'],'wallets':{'usdtPolygonWallet':_0x2a1e32['usdtPolygonWallet'],'usdtTrcWallet':_0x2a1e32[_0x3aad77(0x122)],'usdtErcWallet':_0x2a1e32[_0x3aad77(0x1f4)],'usdcPolygonWallet':_0x2a1e32['usdcPolygonWallet']},'status':_0x2a1e32[_0x3aad77(0x12b)],'createdAt':_0x2a1e32[_0x3aad77(0x176)]})),'pagination':{'page':_0x36b181,'limit':_0x25add0,'total':_0x44cbe8,'totalPages':Math[_0x3aad77(0x175)](_0x44cbe8/_0x25add0)}};}async[a35_0xc6abd3(0x150)](_0x175bd2){const _0x2a8d29=a35_0xc6abd3,_0x597344=await database_1[_0x2a8d29(0x140)][_0x2a8d29(0x159)]['findUnique']({'where':{'id':_0x175bd2},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x597344)return null;return{'id':_0x597344['id'],'fullName':_0x597344[_0x2a8d29(0x1f1)],'username':_0x597344['username'],'telegramId':_0x597344[_0x2a8d29(0x1c0)],'merchantUrl':_0x597344[_0x2a8d29(0x1bf)],'gateways':_0x597344[_0x2a8d29(0x124)]?JSON['parse'](_0x597344[_0x2a8d29(0x124)]):null,'gatewaySettings':_0x597344[_0x2a8d29(0x1e0)]?JSON['parse'](_0x597344[_0x2a8d29(0x1e0)]):null,'publicKey':_0x597344[_0x2a8d29(0x1aa)],'wallets':{'usdtPolygonWallet':_0x597344[_0x2a8d29(0x179)],'usdtTrcWallet':_0x597344[_0x2a8d29(0x122)],'usdtErcWallet':_0x597344[_0x2a8d29(0x1f4)],'usdcPolygonWallet':_0x597344[_0x2a8d29(0x14b)]},'status':_0x597344[_0x2a8d29(0x12b)],'createdAt':_0x597344[_0x2a8d29(0x176)]};}async['createUser'](_0x195b93){const _0x5ab8a0=a35_0xc6abd3,{fullName:_0x58d7b2,username:_0x3bd3d8,password:_0x787644,telegramId:_0x15dd2c,merchantUrl:_0x457f96,gateways:_0x2b67d7,gatewaySettings:_0x416ea3,wallets:_0x342ea9}=_0x195b93,_0x270fc3=await database_1[_0x5ab8a0(0x140)][_0x5ab8a0(0x159)]['findUnique']({'where':{'username':_0x3bd3d8}});if(_0x270fc3)throw new Error(_0x5ab8a0(0x1b2));if(_0x15dd2c){const _0x3fa2d2=await database_1[_0x5ab8a0(0x140)]['shop'][_0x5ab8a0(0x190)]({'where':{'telegram':_0x15dd2c}});if(_0x3fa2d2)throw new Error(_0x5ab8a0(0x1d3));}const _0xa4ae20=await bcryptjs_1[_0x5ab8a0(0x140)][_0x5ab8a0(0x1b9)](_0x787644,0xc),_0x1c7ff5=_0x5ab8a0(0x1ed)+crypto_1[_0x5ab8a0(0x140)][_0x5ab8a0(0x1eb)](0x20)[_0x5ab8a0(0x1c6)](_0x5ab8a0(0x127)),_0x3e068d=_0x5ab8a0(0x18c)+crypto_1[_0x5ab8a0(0x140)]['randomBytes'](0x20)[_0x5ab8a0(0x1c6)](_0x5ab8a0(0x127)),_0x3d0746=await database_1['default'][_0x5ab8a0(0x159)]['create']({'data':{'name':_0x58d7b2,'username':_0x3bd3d8,'password':_0xa4ae20,'telegram':_0x15dd2c,'shopUrl':_0x457f96,'paymentGateways':_0x2b67d7?JSON[_0x5ab8a0(0x16d)](_0x2b67d7):null,'gatewaySettings':_0x416ea3?JSON[_0x5ab8a0(0x16d)](_0x416ea3):null,'usdtPolygonWallet':_0x342ea9?.[_0x5ab8a0(0x179)]||null,'usdtTrcWallet':_0x342ea9?.['usdtTrcWallet']||null,'usdtErcWallet':_0x342ea9?.[_0x5ab8a0(0x1f4)]||null,'usdcPolygonWallet':_0x342ea9?.['usdcPolygonWallet']||null,'publicKey':_0x1c7ff5,'secretKey':_0x3e068d,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x3d0746['id'],'fullName':_0x3d0746[_0x5ab8a0(0x1f1)],'username':_0x3d0746['username'],'telegramId':_0x3d0746[_0x5ab8a0(0x1c0)],'merchantUrl':_0x3d0746[_0x5ab8a0(0x1bf)],'gateways':_0x3d0746['paymentGateways']?JSON['parse'](_0x3d0746[_0x5ab8a0(0x124)]):null,'gatewaySettings':_0x3d0746[_0x5ab8a0(0x1e0)]?JSON[_0x5ab8a0(0x102)](_0x3d0746[_0x5ab8a0(0x1e0)]):null,'publicKey':_0x3d0746[_0x5ab8a0(0x1aa)],'wallets':{'usdtPolygonWallet':_0x3d0746[_0x5ab8a0(0x179)],'usdtTrcWallet':_0x3d0746[_0x5ab8a0(0x122)],'usdtErcWallet':_0x3d0746['usdtErcWallet'],'usdcPolygonWallet':_0x3d0746[_0x5ab8a0(0x14b)]},'status':_0x3d0746[_0x5ab8a0(0x12b)],'createdAt':_0x3d0746[_0x5ab8a0(0x176)]};}async[a35_0xc6abd3(0x112)](_0x5a7f4a){const _0x51627c=a35_0xc6abd3;await database_1[_0x51627c(0x140)]['shop'][_0x51627c(0x1a7)]({'where':{'id':_0x5a7f4a}});}[a35_0xc6abd3(0xe5)](_0xffc839,_0xb5953f,_0x22a4e3){const _0x49d2f9=a35_0xc6abd3,_0x499d99=new Map(),_0x612681=new Date(_0xb5953f);while(_0x612681<=_0x22a4e3){const _0x5f21d3=_0x612681[_0x49d2f9(0x170)]()[_0x49d2f9(0x1cc)]('T')[0x0];_0x499d99['set'](_0x5f21d3,{'revenue':0x0,'count':0x0}),_0x612681[_0x49d2f9(0x200)](_0x612681[_0x49d2f9(0xf3)]()+0x1);}for(const _0x7e3837 of _0xffc839){const _0x537768=_0x7e3837['createdAt'][_0x49d2f9(0x170)]()[_0x49d2f9(0x1cc)]('T')[0x0],_0x591a5d=_0x499d99['get'](_0x537768);_0x591a5d&&(_0x591a5d[_0x49d2f9(0x1be)]+=0x1,_0x7e3837[_0x49d2f9(0x12b)]===_0x49d2f9(0x197)&&(_0x7e3837[_0x49d2f9(0x1a0)]?_0x591a5d[_0x49d2f9(0x1de)]+=_0x7e3837[_0x49d2f9(0x1a0)]:console[_0x49d2f9(0x106)](_0x49d2f9(0x201)+_0x7e3837['id']+_0x49d2f9(0x105))));}const _0x248da0=[],_0x424083=[];for(const [_0x3e2502,_0x450496]of _0x499d99){_0x248da0[_0x49d2f9(0xf9)]({'date':_0x3e2502,'amount':Math[_0x49d2f9(0x19c)](_0x450496[_0x49d2f9(0x1de)]*0x64)/0x64}),_0x424083[_0x49d2f9(0xf9)]({'date':_0x3e2502,'count':_0x450496[_0x49d2f9(0x1be)]});}return{'dailyRevenue':_0x248da0,'dailyPayments':_0x424083};}}exports[a35_0xc6abd3(0x18f)]=AdminService;