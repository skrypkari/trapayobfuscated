'use strict';const a46_0x5060ae=a46_0x65ed;(function(_0x7f0ed6,_0x12f641){const _0x3a45b6=a46_0x65ed,_0x54e762=_0x7f0ed6();while(!![]){try{const _0x9aa080=parseInt(_0x3a45b6(0x1b3))/0x1*(parseInt(_0x3a45b6(0xfa))/0x2)+parseInt(_0x3a45b6(0x128))/0x3*(-parseInt(_0x3a45b6(0x13d))/0x4)+-parseInt(_0x3a45b6(0x212))/0x5*(-parseInt(_0x3a45b6(0x265))/0x6)+parseInt(_0x3a45b6(0x26c))/0x7+parseInt(_0x3a45b6(0x252))/0x8*(parseInt(_0x3a45b6(0x220))/0x9)+-parseInt(_0x3a45b6(0x232))/0xa*(parseInt(_0x3a45b6(0x1c2))/0xb)+parseInt(_0x3a45b6(0x19c))/0xc*(-parseInt(_0x3a45b6(0x1b8))/0xd);if(_0x9aa080===_0x12f641)break;else _0x54e762['push'](_0x54e762['shift']());}catch(_0x1f33fb){_0x54e762['push'](_0x54e762['shift']());}}}(a46_0x42c5,0x8741d));var __importDefault=this&&this[a46_0x5060ae(0x1af)]||function(_0x6b53b3){const _0x180da1=a46_0x5060ae;return _0x6b53b3&&_0x6b53b3[_0x180da1(0x146)]?_0x6b53b3:{'default':_0x6b53b3};};Object[a46_0x5060ae(0x172)](exports,'__esModule',{'value':!![]}),exports['AdminService']=void 0x0;function a46_0x65ed(_0x5e26ca,_0x1a5678){_0x5e26ca=_0x5e26ca-0xf9;const _0x42c543=a46_0x42c5();let _0x65ed8b=_0x42c543[_0x5e26ca];return _0x65ed8b;}function a46_0x42c5(){const _0x22f6ec=['length','\x20\x20\x20ðŸ’°\x20Total\x20turnover:\x20','rapyd','\x20\x20\x20Payout\x20amount:\x20','commissionUSDT','ðŸ”\x20Selected\x20trc20\x20wallet:\x20','dateTo','warn','9kRJjSa','round','paidAt','updatedAt','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','0000','generateDailyStatistics','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','âœ…\x20Customer\x20data\x20updated\x20for\x20payment\x20','\x20merchants','toUpperCase','\x20USDT,\x20Requested:\x20','\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...','delete','findFirst','getMerchantsSelection','push','totalAmountAfterCommissionUSDT','\x20USDT\x20(+','failureMessage','\x20\x20\x20Current\x20balance:\x20','1291748kgOByy','period','publicKey','ðŸ“Š\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','\x20\x20\x20Gateway:\x20','amountAfterGatewayCommissionUSDT','ðŸ“Š\x20Using\x20saved\x20values\x20for\x20payment\x20','findUnique','set','__esModule','ðŸ”\x20Using\x20gateway\x20\x27','gatewaySettings','\x20merchants\x20for\x20selection','\x20\x20\x20ðŸ–¥ï¸\x20User\x20Agent:\x20','notes','admin','cointopay','\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)','toString',']\x20Gateway\x20settings\x20JSON\x20string:','mastercard','txid','count','status','hex','\x20\x20\x20ðŸ“…\x20This\x20month:\x20','\x20->\x20','ðŸ“…\x20Payout\x20date\x20to\x20filter:\x20','ðŸ“…\x20Payout\x20date\x20from\x20filter:\x20','ðŸ“Š\x20Calculating\x20payout\x20statistics...','periodTo','substr','asc','deletePayout','network','ðŸ“…\x20Period:\x20','createUser','ðŸ’°\x20Found\x20','\x20\x20\x20Tolerance:\x20','KLYME\x20EU','\x20became\x20PAID:','getSystemStatistics','_sum','\x20USDT\x20for\x20payment\x20','updatePaymentStatus','ðŸ’°\x20Payment\x20','Plisio','\x20USDT\x20(gross\x20revenue)','ACTIVE','getTime','usdcPolygonWallet','\x20USDT,\x20Difference:\x20','\x20\x20\x20ðŸŒ\x20IP:\x20','defineProperty','ðŸŽ¯\x20updateUser\x20called\x20with\x20ID:\x20','thisMonth','setHours','toLocaleDateString','\x20USDT\x20(after\x20','ðŸ”§\x20[','\x20for\x20shop\x20','all_time','ðŸ“Š\x20Calculated\x20commission\x20rate\x20for\x20payment\x20','username','failUrl','getMonth','\x20PAID\x20payments','\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)','reduce','entries','MasterCard','paymentGateways','UTC','\x20\x20\x20Transaction\x20hash:\x20','desc','ðŸ”\x20[','Rapyd','paymentsCount','ðŸ’°\x20Payment\x20amount\x20is\x20NOT\x20deducted\x20(chargeback\x20penalty\x20only)','ðŸ’°\x20Current\x20shop\x20balance:\x20','merchantEarnings',']\x20Updating\x20password\x20for\x20user\x20','\x20balance\x20updated:\x20','\x27\x20->\x20ID\x20\x27','name','dailyRevenue','customerEmail','setDate','amountUSDT','âœ…\x20Balance\x20check\x20passed\x20(with\x20tolerance)','min','\x20USDT\x20(already\x20paid\x20out)','wallets','ðŸ“Š\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','âš ï¸\x20Payment\x20','861432VKJKYc','slice','amountAfterCommissionUSDT','getFullYear','turnoverUSDT','includes','\x20\x20\x20ðŸ¤”\x20Difference:\x20','getPaymentById','\x20payments)','wallet','month','CHARGEBACK','totalTurnover','map','erc20','stringify','filter','\x20\x20\x20ï¿½ðŸ“Š\x20Total\x20payments:\x20','ðŸ”„\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','__importDefault','REFUND','this_week','\x20\x20\x20ðŸ’°\x20Total\x20payments\x20turnover:\x20','18cmMUJy','ðŸ“Š\x20Getting\x20payments\x20with\x20filters:','join','\x20USDT\x20(current\x20balance\x20in\x20DB)','deleteUser','13calOAZ','error','\x20\x20\x20â³\x20Pending\x20payout:\x20','ðŸ’°\x20Creating\x20payout\x20for\x20shop\x20','âœ…\x20Payout\x20created\x20in\x20DB:','\x27\x20->\x20name\x20\x27','ðŸ“Š\x20Sorting\x20payments\x20by\x20','\x20\x20\x20ðŸª\x20Gateway\x20earnings:\x20','statusChangedBy','Error\x20processing\x20payment\x20','2166109umXZhO','statusChangedAt','dateFrom','cointopay2','\x20USDT\x20(total\x20paid\x20to\x20merchants)','orderId','ðŸ’±\x20Currency\x20filter\x20applied:\x20','ðŸ“Š\x20Total\x20payments\x20(including\x20failed):\x20','âš ï¸\x20Requested\x20gateway\x20\x27','sort','ðŸ”\x20Shop\x20wallets:','currencyService','chargebackAmount','ðŸ’¸\x20CHARGEBACK\x20penalty\x20ONLY:\x20-','lte','customerName','insensitive','ðŸŽ¯\x20[','findMany','âŒ\x20Failed\x20to\x20send\x20Telegram\x20notification\x20for\x20payout\x20','ðŸ”„\x20Gateway\x20mapping\x20(get):','ðŸ”\x20Balance\x20check\x20details:','payment','CoinToPay','default','\x20\x20\x20Available\x20(raw):\x20','shopId','klyme_de','ðŸ’°\x20Shop\x20','getGatewayDisplayName','setUTCDate','noda','erc20_usdc','\x20\x20\x20âœ…\x20Total\x20net\x20balances:\x20','getGatewayIdByName','\x20\x20\x20Balance:\x20','gatewayEarnings','\x20\x20\x20Difference:\x20','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','\x20\x20\x20ðŸ“…\x20Total\x20payouts\x20(this\x20month):\x20','adminNotes','ceil','ðŸ”\x20Selected\x20polygon_usdc\x20wallet:\x20','bcryptjs','getGatewayInternalName','custom_',',\x20chargebacks:\x20','../config/database','\x20\x20\x20Merchant\x20loses:\x20','customerIp','\x20\x20\x20Merchant\x20gets:\x20','AdminService','ðŸ“Š\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20','ðŸ’³\x20Final\x20payout\x20wallet\x20for\x20','password','ðŸ“Š\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','gatewayCommissionRate','ðŸ“‹\x20Found\x20','toISOString','\x20to\x20','totalAmountUSDT',',\x20refunds:\x20','availableBalance','totalPayments','year','Payment\x20not\x20found','telegramId','payout','ðŸ”„\x20Gateway\x20mapping:','last_month','ÐÐµ\x20ÑƒÐºÐ°Ð·Ð°Ð½','ru-RU','localeCompare','Insufficient\x20balance.\x20Available:\x20','not\x20provided','gte','fullName','balance','\x20status:\x20','totalPaidOut','86015gamcKR','averageCheckUSDT','getUserById','sendPayoutNotification','\x20paid\x20payments\x20for\x20analysis','update','polygon','forEach','merchantUrl','not\x20set','PENDING','\x27\x20(from\x20\x27','polygon_usdc','currency','539433SAoZvi','aggregate','getDay','gateways','usdcErcWallet','ðŸ’¸\x20CHARGEBACK:\x20Processing\x20penalty-only\x20deduction','amount','activateUser','getMerchantStatistics','today','âš ï¸\x20Gateway\x20\x27','this_month','split','telegram',',\x20successful:\x20','test_gateway','ðŸ“Š\x20Available\x20gateways\x20in\x20database:','totalPayout','10yoIHnn','\x20\x20\x20Full\x20amount:\x20','values','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','some','PAID','getUTCMonth','toFixed','usdtTrcWallet','ðŸ“‹\x20Getting\x20merchants\x20selection\x20list...','pendingUrl','%\x20commission)','ðŸ“Š\x20Getting\x20merchant\x20statistics\x20with\x20filters:','\x20\x20\x20ðŸ”\x20Calculated\x20after\x20commission:\x20','Noda','createdAt','telegramBotService','whiteUrl','klyme_gb','successUrl','Telegram\x20username\x20already\x20exists','awaitingPayout','\x20\x20\x20ï¿½\x20Total\x20payments\x20turnover:\x20','Test\x20Gateway','suspendUser','_count','\x20\x20\x20ðŸ’°\x20Total\x20payout:\x20','getUTCDate',',\x20Commission:\x20','usdtPolygonWallet','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','Shop\x20not\x20found','88URdoqA','ðŸ”\x20Creating\x20payout\x20with\x20data:','\x20\x20\x20ðŸ’¸\x20Total\x20payouts:\x20','parse','\x20\x20\x20ðŸ’³\x20Total\x20payments:\x20','gatewayOrderId','\x20order','../types/gateway','dailyPayments','\x20USDT\x20(same\x20as\x20awaiting)','trim','sk_','revenue','COMPLETED','create','Username\x20already\x20exists','usdtErcWallet','hash','klyme_eu','246Ghlqok','createPayout','\x20in\x20','totalCommissionRate','ðŸ”„\x20Updating\x20customer\x20data\x20for\x20payment\x20','\x20USDT','ðŸ“Š\x20Payout\x20statistics\x20calculated:','310037qBKSJj','EXPIRED','merchantEarningsUSDT','42512DDrcBg','getDate','customerCountry','turnover','yesterday','\x20\x20\x20ðŸ’¸\x20Total\x20payouts\x20(all\x20time):\x20','pk_','\x20with\x20payout\x20history','date','getPayoutById','all','getUTCFullYear','periodFrom','pendingPayout','commission','\x27\x20to\x20name\x20\x27','not\x20specified','âœ…\x20Using\x20gateway\x20filter:\x20\x27','\x20\x20\x20ðŸ’µ\x20Available\x20balance:\x20','payouts','log','getGatewayNameById','gateway','\x20USDT\x20(-','toLowerCase','\x20balance\x20updated:','shopUrl','ðŸ”\x20Initial\x20wallet\x20from\x20request:\x20','\x20USDT\x20from\x20balance','%\x20from\x20','âš ï¸\x20CHARGEBACK\x20without\x20penalty\x20amount\x20-\x20no\x20balance\x20change','Open\x20Banking\x202','updateUser','$transaction','\x20USDT\x20(rounded\x20to\x202\x20decimal\x20places)','customerUa','shop','\x20USDT)'];a46_0x42c5=function(){return _0x22f6ec;};return a46_0x42c5();}const database_1=__importDefault(require(a46_0x5060ae(0x1f1))),bcryptjs_1=__importDefault(require(a46_0x5060ae(0x1ed))),crypto_1=__importDefault(require('crypto')),currencyService_1=require('./currencyService'),telegramBotService_1=require('./telegramBotService'),gateway_1=require(a46_0x5060ae(0x259));class AdminService{async['getPayoutStats'](){const _0x1aa989=a46_0x5060ae;console['log'](_0x1aa989(0x15a));const _0x4bcc10=await database_1[_0x1aa989(0x1da)]['shop'][_0x1aa989(0x221)]({'_sum':{'balance':!![],'totalPaidOut':!![]}}),_0x53c362=await database_1[_0x1aa989(0x1da)]['payment'][_0x1aa989(0x153)]({'where':{'status':'PAID','gateway':{'not':_0x1aa989(0x22f)}}}),_0x2adbbc=new Date(),_0x1c4b37=new Date(_0x2adbbc['getFullYear'](),_0x2adbbc[_0x1aa989(0x17e)](),0x1),_0x56a39f=new Date(_0x2adbbc['getFullYear'](),_0x2adbbc[_0x1aa989(0x17e)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x3f055f=await database_1['default'][_0x1aa989(0x205)][_0x1aa989(0x221)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x1c4b37,'lte':_0x56a39f},'status':_0x1aa989(0x25f)}}),_0x2a797a=_0x4bcc10[_0x1aa989(0x167)][_0x1aa989(0x211)]||0x0,_0x2f3686=_0x4bcc10['_sum'][_0x1aa989(0x20f)]||0x0,_0xbe5b1c=_0x3f055f[_0x1aa989(0x167)][_0x1aa989(0x226)]||0x0,_0x4d1c98={'totalPayout':Math[_0x1aa989(0x129)](_0x2a797a*0x64)/0x64,'awaitingPayout':Math[_0x1aa989(0x129)](_0x2f3686*0x64)/0x64,'thisMonth':Math[_0x1aa989(0x129)](_0xbe5b1c*0x64)/0x64,'availableBalance':Math[_0x1aa989(0x129)](_0x2f3686*0x64)/0x64,'totalPayments':_0x53c362};return console[_0x1aa989(0x10e)](_0x1aa989(0x26b)),console[_0x1aa989(0x10e)](_0x1aa989(0x24c)+_0x4d1c98[_0x1aa989(0x231)]+_0x1aa989(0x1c6)),console['log']('\x20\x20\x20â³\x20Awaiting\x20payout:\x20'+_0x4d1c98[_0x1aa989(0x247)]+_0x1aa989(0x14e)),console['log'](_0x1aa989(0x10c)+_0x4d1c98[_0x1aa989(0x200)]+_0x1aa989(0x25b)),console[_0x1aa989(0x10e)](_0x1aa989(0x156)+_0x4d1c98[_0x1aa989(0x174)]+'\x20USDT'),console[_0x1aa989(0x10e)](_0x1aa989(0x256)+_0x4d1c98[_0x1aa989(0x201)]+_0x1aa989(0x17f)),_0x4d1c98;}async['updateCustomerData'](_0x340277,_0x25c319){const _0x5d56d9=a46_0x5060ae;console[_0x5d56d9(0x10e)](_0x5d56d9(0x269)+_0x340277+':',_0x25c319);const _0x4fee9b=await database_1[_0x5d56d9(0x1da)][_0x5d56d9(0x1d8)][_0x5d56d9(0x144)]({'where':{'id':_0x340277},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x4fee9b)throw new Error('Payment\x20not\x20found');const _0x260a2b={};_0x25c319[_0x5d56d9(0xfc)]!==undefined&&(_0x260a2b[_0x5d56d9(0xfc)]=_0x25c319[_0x5d56d9(0xfc)]||null);_0x25c319['customerIp']!==undefined&&(_0x260a2b[_0x5d56d9(0x1f3)]=_0x25c319[_0x5d56d9(0x1f3)]||null);_0x25c319[_0x5d56d9(0x11d)]!==undefined&&(_0x260a2b[_0x5d56d9(0x11d)]=_0x25c319['customerUa']||null);const _0x425b7d=await database_1[_0x5d56d9(0x1da)][_0x5d56d9(0x1d8)]['update']({'where':{'id':_0x340277},'data':{..._0x260a2b,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console['log'](_0x5d56d9(0x130)+_0x340277),console[_0x5d56d9(0x10e)]('\x20\x20\x20ðŸŒ\x20Country:\x20'+_0x4fee9b['customerCountry']+_0x5d56d9(0x157)+_0x425b7d[_0x5d56d9(0xfc)]),console[_0x5d56d9(0x10e)](_0x5d56d9(0x171)+_0x4fee9b[_0x5d56d9(0x1f3)]+'\x20->\x20'+_0x425b7d[_0x5d56d9(0x1f3)]),console['log'](_0x5d56d9(0x14a)+(_0x4fee9b[_0x5d56d9(0x11d)]?_0x5d56d9(0x145):_0x5d56d9(0x21b))+'\x20->\x20'+(_0x425b7d[_0x5d56d9(0x11d)]?_0x5d56d9(0x145):_0x5d56d9(0x21b))),_0x425b7d;}async[a46_0x5060ae(0x166)](_0x13c9dc,_0x1ebdca){const _0x2c20c1=a46_0x5060ae,_0x360c34=_0x1ebdca?new Date(_0x1ebdca):new Date();let _0x2401a5,_0x430528;if(_0x13c9dc['startsWith'](_0x2c20c1(0x1ef))){const _0x3e26b6=_0x13c9dc['replace'](_0x2c20c1(0x1ef),'')[_0x2c20c1(0x22c)]('_');_0x3e26b6[_0x2c20c1(0x120)]===0x2?(_0x2401a5=new Date(_0x3e26b6[0x0]),_0x2401a5[_0x2c20c1(0x175)](0x0,0x0,0x0,0x0),_0x430528=new Date(_0x3e26b6[0x1]),_0x430528[_0x2c20c1(0x175)](0x17,0x3b,0x3b,0x3e7)):(_0x2401a5=new Date(_0x360c34[_0x2c20c1(0x16e)]()-0x1e*0x18*0x3c*0x3c*0x3e8),_0x2401a5['setHours'](0x0,0x0,0x0,0x0),_0x430528=new Date(),_0x430528[_0x2c20c1(0x175)](0x17,0x3b,0x3b,0x3e7));}else switch(_0x13c9dc['toLowerCase']()){case _0x2c20c1(0x229):_0x2401a5=new Date(Date['UTC'](_0x360c34['getUTCFullYear'](),_0x360c34[_0x2c20c1(0x238)](),_0x360c34[_0x2c20c1(0x24d)](),0x0,0x0,0x0,0x0)),_0x430528=new Date(Date['UTC'](_0x360c34[_0x2c20c1(0x105)](),_0x360c34[_0x2c20c1(0x238)](),_0x360c34[_0x2c20c1(0x24d)](),0x17,0x3b,0x3b,0x3e7));break;case _0x2c20c1(0xfe):const _0x52bd58=new Date(_0x360c34);_0x52bd58[_0x2c20c1(0x1e0)](_0x52bd58[_0x2c20c1(0x24d)]()-0x1),_0x2401a5=new Date(Date[_0x2c20c1(0x185)](_0x52bd58[_0x2c20c1(0x105)](),_0x52bd58['getUTCMonth'](),_0x52bd58[_0x2c20c1(0x24d)](),0x0,0x0,0x0,0x0)),_0x430528=new Date(Date[_0x2c20c1(0x185)](_0x52bd58[_0x2c20c1(0x105)](),_0x52bd58[_0x2c20c1(0x238)](),_0x52bd58[_0x2c20c1(0x24d)](),0x17,0x3b,0x3b,0x3e7));break;case _0x2c20c1(0x1b1):const _0xa01b49=_0x360c34[_0x2c20c1(0x222)](),_0x37b94b=_0xa01b49===0x0?-0x6:0x1-_0xa01b49;_0x2401a5=new Date(_0x360c34),_0x2401a5[_0x2c20c1(0x194)](_0x360c34[_0x2c20c1(0xfb)]()+_0x37b94b),_0x2401a5[_0x2c20c1(0x175)](0x0,0x0,0x0,0x0),_0x430528=new Date(_0x360c34[_0x2c20c1(0x19f)](),_0x360c34['getMonth'](),_0x360c34[_0x2c20c1(0xfb)](),0x17,0x3b,0x3b,0x3e7);break;case'last_week':const _0x5d1e19=new Date(_0x360c34);_0x5d1e19[_0x2c20c1(0x194)](_0x360c34[_0x2c20c1(0xfb)]()-0x7);const _0x2bb6d5=_0x5d1e19[_0x2c20c1(0x222)](),_0x4a3a4c=_0x2bb6d5===0x0?-0x6:0x1-_0x2bb6d5;_0x2401a5=new Date(_0x5d1e19),_0x2401a5['setDate'](_0x5d1e19[_0x2c20c1(0xfb)]()+_0x4a3a4c),_0x2401a5[_0x2c20c1(0x175)](0x0,0x0,0x0,0x0),_0x430528=new Date(_0x2401a5),_0x430528['setDate'](_0x2401a5['getDate']()+0x6),_0x430528[_0x2c20c1(0x175)](0x17,0x3b,0x3b,0x3e7);break;case _0x2c20c1(0x22b):_0x2401a5=new Date(Date[_0x2c20c1(0x185)](_0x360c34[_0x2c20c1(0x105)](),_0x360c34[_0x2c20c1(0x238)](),0x1,0x0,0x0,0x0,0x0)),_0x430528=new Date(Date[_0x2c20c1(0x185)](_0x360c34[_0x2c20c1(0x105)](),_0x360c34['getUTCMonth'](),_0x360c34[_0x2c20c1(0x24d)](),0x17,0x3b,0x3b,0x3e7));break;case _0x2c20c1(0x207):_0x2401a5=new Date(Date[_0x2c20c1(0x185)](_0x360c34[_0x2c20c1(0x105)](),_0x360c34[_0x2c20c1(0x238)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x430528=new Date(Date[_0x2c20c1(0x185)](_0x360c34[_0x2c20c1(0x105)](),_0x360c34[_0x2c20c1(0x238)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x2c20c1(0x17a):_0x2401a5=new Date(Date['UTC'](0x7e9,0x5,0xe,0x0,0x0,0x0,0x0)),_0x430528=new Date(Date['UTC'](_0x360c34[_0x2c20c1(0x105)](),_0x360c34['getUTCMonth'](),_0x360c34[_0x2c20c1(0x24d)](),0x17,0x3b,0x3b,0x3e7));break;default:_0x2401a5=new Date(_0x360c34[_0x2c20c1(0x16e)]()-0x1e*0x18*0x3c*0x3c*0x3e8),_0x2401a5[_0x2c20c1(0x175)](0x0,0x0,0x0,0x0),_0x430528=new Date(_0x360c34[_0x2c20c1(0x19f)](),_0x360c34[_0x2c20c1(0x17e)](),_0x360c34['getDate'](),0x17,0x3b,0x3b,0x3e7);}const _0x50c277={'gte':_0x2401a5,'lte':_0x430528},[_0x3a6c6c,_0x1a83c9,_0x59535a,_0x3ae4d7,_0x5666f3,_0x8841c1,_0x1fb8e3,_0x378421]=await Promise[_0x2c20c1(0x104)]([database_1[_0x2c20c1(0x1da)]['shop'][_0x2c20c1(0x153)](),database_1[_0x2c20c1(0x1da)][_0x2c20c1(0x11e)][_0x2c20c1(0x153)]({'where':{'status':_0x2c20c1(0x16d)}}),database_1[_0x2c20c1(0x1da)][_0x2c20c1(0x1d8)]['count']({'where':{'status':'PAID','createdAt':_0x50c277,'gateway':{'not':_0x2c20c1(0x22f)}}}),database_1[_0x2c20c1(0x1da)][_0x2c20c1(0x1d8)]['count']({'where':{'status':_0x2c20c1(0x1a7),'createdAt':_0x50c277,'gateway':{'not':_0x2c20c1(0x22f)}}}),database_1[_0x2c20c1(0x1da)][_0x2c20c1(0x1d8)][_0x2c20c1(0x153)]({'where':{'status':_0x2c20c1(0x1b0),'createdAt':_0x50c277,'gateway':{'not':_0x2c20c1(0x22f)}}}),database_1['default'][_0x2c20c1(0x1d8)]['findMany']({'where':{'status':_0x2c20c1(0x237),'createdAt':_0x50c277,'gateway':{'not':_0x2c20c1(0x22f)}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x2c20c1(0x1da)][_0x2c20c1(0x1d8)]['findMany']({'where':{'gateway':{'not':_0x2c20c1(0x22f)}},'take':0xa,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x2c20c1(0x1da)][_0x2c20c1(0x1d8)][_0x2c20c1(0x1d4)]({'where':{'createdAt':_0x50c277,'gateway':{'not':_0x2c20c1(0x22f)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x146cfa=0x0,_0xb5a71f=0x0;for(const _0x54b4ea of _0x8841c1){const _0xd356dd=_0x54b4ea[_0x2c20c1(0x195)]||0x0;_0x146cfa+=_0xd356dd;if(_0x54b4ea[_0x2c20c1(0x142)]&&_0x54b4ea[_0x2c20c1(0x195)]){const _0x3319c5=_0x54b4ea[_0x2c20c1(0x195)]-_0x54b4ea[_0x2c20c1(0x142)];_0xb5a71f+=_0x3319c5;}}const _0x16b8e9=_0x59535a>0x0?_0x146cfa/_0x59535a:0x0,_0x4dc05d=this[_0x2c20c1(0x12e)](_0x378421,_0x2401a5,_0x430528),_0x170b5b=await database_1[_0x2c20c1(0x1da)][_0x2c20c1(0x1d8)][_0x2c20c1(0x153)]({'where':{'createdAt':_0x50c277,'gateway':{'not':'test_gateway'},'status':{'notIn':['PENDING',_0x2c20c1(0x26d)]}}}),_0x252d4b=_0x170b5b>0x0?_0x59535a/_0x170b5b*0x64:0x0;return{'totalShops':_0x3a6c6c,'activeShops':_0x1a83c9,'totalPayments':_0x170b5b,'successfulPayments':_0x59535a,'totalAttempts':_0x170b5b,'chargebacks':_0x3ae4d7,'refunds':_0x5666f3,'totalRevenue':Math[_0x2c20c1(0x129)](_0x146cfa*0x64)/0x64,'trapayEarnings':Math['round'](_0xb5a71f*0x64)/0x64,'averagePaymentAmount':Math[_0x2c20c1(0x129)](_0x16b8e9*0x64)/0x64,'conversionRate':Math[_0x2c20c1(0x129)](_0x252d4b*0x64)/0x64,'dailyRevenue':_0x4dc05d[_0x2c20c1(0x192)],'dailyPayments':_0x4dc05d[_0x2c20c1(0x25a)],'recentPayments':_0x1fb8e3[_0x2c20c1(0x1a9)](_0x47852d=>({'id':_0x47852d['id'],'amount':_0x47852d[_0x2c20c1(0x226)],'currency':_0x47852d[_0x2c20c1(0x21f)],'status':_0x47852d[_0x2c20c1(0x154)],'gateway':_0x47852d[_0x2c20c1(0x110)],'shop':_0x47852d[_0x2c20c1(0x11e)],'createdAt':_0x47852d[_0x2c20c1(0x241)]}))};}async[a46_0x5060ae(0x228)](_0x1cb5e3){const _0xed7497=a46_0x5060ae;console[_0xed7497(0x10e)](_0xed7497(0x23e),_0x1cb5e3);let _0x337f70,_0x451981=new Date();if(_0x1cb5e3['period']==='custom'&&_0x1cb5e3[_0xed7497(0x1c4)]&&_0x1cb5e3[_0xed7497(0x126)])_0x337f70=new Date(_0x1cb5e3[_0xed7497(0x1c4)]),_0x451981=new Date(_0x1cb5e3[_0xed7497(0x126)]),_0x337f70[_0xed7497(0x175)](0x0,0x0,0x0,0x0),_0x451981[_0xed7497(0x175)](0x17,0x3b,0x3b,0x3e7);else{const _0x48b839=new Date();switch(_0x1cb5e3['period']){case'week':_0x337f70=new Date(_0x48b839['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0xed7497(0x1a6):_0x337f70=new Date(_0x48b839[_0xed7497(0x16e)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0xed7497(0x202):_0x337f70=new Date(_0x48b839[_0xed7497(0x16e)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0xed7497(0x104):default:_0x337f70=new Date('2020-01-01');break;}_0x337f70[_0xed7497(0x175)](0x0,0x0,0x0,0x0),_0x451981[_0xed7497(0x175)](0x17,0x3b,0x3b,0x3e7);}console['log'](_0xed7497(0x160)+_0x337f70[_0xed7497(0x1fc)]()+_0xed7497(0x1fd)+_0x451981[_0xed7497(0x1fc)]());const _0x132b30={'status':_0xed7497(0x237),'gateway':{'not':_0xed7497(0x22f)},'paidAt':{'gte':_0x337f70,'lte':_0x451981}};_0x1cb5e3['shopId']&&(_0x132b30[_0xed7497(0x1dc)]=_0x1cb5e3[_0xed7497(0x1dc)]);const _0x403dff=await database_1[_0xed7497(0x1da)][_0xed7497(0x1d8)][_0xed7497(0x1d4)]({'where':_0x132b30,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console['log']('ðŸ’°\x20Found\x20'+_0x403dff[_0xed7497(0x120)]+_0xed7497(0x216));const _0x3f6993={'gateway':{'not':_0xed7497(0x22f)},'status':{'notIn':[_0xed7497(0x21c),_0xed7497(0x26d)]},'createdAt':{'gte':_0x337f70,'lte':_0x451981}};_0x1cb5e3[_0xed7497(0x1dc)]&&(_0x3f6993[_0xed7497(0x1dc)]=_0x1cb5e3[_0xed7497(0x1dc)]);const _0x36ff1e=await database_1[_0xed7497(0x1da)]['payment'][_0xed7497(0x153)]({'where':_0x3f6993}),_0x136f33={..._0x3f6993,'status':_0xed7497(0x1a7)},_0x575b31={..._0x3f6993,'status':_0xed7497(0x1b0)},[_0x310d6d,_0x1161a9]=await Promise[_0xed7497(0x104)]([database_1[_0xed7497(0x1da)][_0xed7497(0x1d8)]['count']({'where':_0x136f33}),database_1[_0xed7497(0x1da)][_0xed7497(0x1d8)][_0xed7497(0x153)]({'where':_0x575b31})]);console[_0xed7497(0x10e)](_0xed7497(0x1c9)+_0x36ff1e+_0xed7497(0x22e)+_0x403dff[_0xed7497(0x120)]+_0xed7497(0x1f0)+_0x310d6d+_0xed7497(0x1ff)+_0x1161a9);let _0x1c898b=0x0,_0x31f4b2=0x0,_0x1fec80=0x0;const _0x574faf={},_0x433db0={},_0x1a97fa={};for(const _0x4b3c9e of _0x403dff){try{const _0x4745e7=_0x4b3c9e[_0xed7497(0x195)]||0x0;if(_0x4745e7<=0x0){console[_0xed7497(0x127)](_0xed7497(0x19b)+_0x4b3c9e['id']+_0xed7497(0x134));continue;}let _0x405085,_0x1f74e9;if(_0x4b3c9e['amountAfterGatewayCommissionUSDT']!==null&&_0x4b3c9e[_0xed7497(0x142)]!==undefined)_0x405085=_0x4b3c9e[_0xed7497(0x142)],_0x1f74e9=_0x4745e7-_0x405085,console[_0xed7497(0x10e)](_0xed7497(0x143)+_0x4b3c9e['id']+':\x20'+_0x4745e7[_0xed7497(0x239)](0x6)+'\x20USDT,\x20merchant:\x20'+_0x405085['toFixed'](0x6)+_0xed7497(0x26a));else{let _0x33cc44={};if(_0x4b3c9e[_0xed7497(0x11e)]['gatewaySettings'])try{_0x33cc44=JSON[_0xed7497(0x255)](_0x4b3c9e[_0xed7497(0x11e)][_0xed7497(0x148)]);}catch(_0x4ec1d2){console['error'](_0xed7497(0x1e8)+_0x4b3c9e[_0xed7497(0x1dc)]+':',_0x4ec1d2);}let _0x2ef526=0x2d;for(const [_0x2a28aa,_0x571934]of Object['entries'](_0x33cc44)){if(_0x2a28aa[_0xed7497(0x112)]()===_0x4b3c9e[_0xed7497(0x110)]['toLowerCase']()){_0x2ef526=_0x571934['commission']||0x2d;break;}}_0x1f74e9=_0x4745e7*(_0x2ef526/0x64),_0x405085=_0x4745e7-_0x1f74e9,console[_0xed7497(0x10e)](_0xed7497(0x1f9)+_0x4b3c9e['id']+':\x20'+_0x2ef526+_0xed7497(0x117)+_0x4745e7['toFixed'](0x6)+_0xed7497(0x26a));}_0x1c898b+=_0x4745e7,_0x31f4b2+=_0x405085,_0x1fec80+=_0x1f74e9;let _0x4381bd;_0x4b3c9e[_0xed7497(0x1fa)]!==null&&_0x4b3c9e[_0xed7497(0x1fa)]!==undefined?(_0x4381bd=_0x4b3c9e['gatewayCommissionRate'],console[_0xed7497(0x10e)](_0xed7497(0x1f6)+_0x4b3c9e['id']+':\x20'+_0x4381bd+'%')):(_0x4381bd=_0x4745e7>0x0?_0x1f74e9/_0x4745e7*0x64:0x0,console[_0xed7497(0x10e)](_0xed7497(0x17b)+_0x4b3c9e['id']+':\x20'+_0x4381bd[_0xed7497(0x239)](0x2)+'%'));!_0x574faf[_0x4b3c9e[_0xed7497(0x110)]]&&(_0x574faf[_0x4b3c9e[_0xed7497(0x110)]]={'gateway':_0x4b3c9e['gateway'],'gatewayDisplayName':this[_0xed7497(0x1df)](_0x4b3c9e[_0xed7497(0x110)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x574faf[_0x4b3c9e['gateway']][_0xed7497(0x18a)]++,_0x574faf[_0x4b3c9e['gateway']][_0xed7497(0x1a0)]+=_0x4745e7,_0x574faf[_0x4b3c9e[_0xed7497(0x110)]][_0xed7497(0x124)]+=_0x1f74e9,_0x574faf[_0x4b3c9e[_0xed7497(0x110)]]['merchantEarningsUSDT']+=_0x405085,_0x574faf[_0x4b3c9e[_0xed7497(0x110)]][_0xed7497(0x268)]+=_0x4381bd;!_0x1cb5e3[_0xed7497(0x1dc)]&&(!_0x433db0[_0x4b3c9e[_0xed7497(0x1dc)]]&&(_0x433db0[_0x4b3c9e[_0xed7497(0x1dc)]]={'shopId':_0x4b3c9e[_0xed7497(0x1dc)],'shopName':_0x4b3c9e['shop'][_0xed7497(0x191)],'shopUsername':_0x4b3c9e[_0xed7497(0x11e)][_0xed7497(0x17c)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x433db0[_0x4b3c9e[_0xed7497(0x1dc)]][_0xed7497(0x18a)]++,_0x433db0[_0x4b3c9e[_0xed7497(0x1dc)]][_0xed7497(0x1a0)]+=_0x4745e7,_0x433db0[_0x4b3c9e[_0xed7497(0x1dc)]]['commissionUSDT']+=_0x1f74e9,_0x433db0[_0x4b3c9e[_0xed7497(0x1dc)]][_0xed7497(0xf9)]+=_0x405085);const _0x21ca4e=_0x4b3c9e[_0xed7497(0x12a)][_0xed7497(0x1fc)]()[_0xed7497(0x22c)]('T')[0x0];!_0x1a97fa[_0x21ca4e]&&(_0x1a97fa[_0x21ca4e]={'date':_0x21ca4e,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x1a97fa[_0x21ca4e][_0xed7497(0xfd)]+=_0x4745e7,_0x1a97fa[_0x21ca4e][_0xed7497(0x18d)]+=_0x405085,_0x1a97fa[_0x21ca4e][_0xed7497(0x1e6)]+=_0x1f74e9,_0x1a97fa[_0x21ca4e][_0xed7497(0x18a)]++;}catch(_0x5ec2d5){console[_0xed7497(0x1b9)](_0xed7497(0x1c1)+_0x4b3c9e['id']+':',_0x5ec2d5);}}Object[_0xed7497(0x234)](_0x574faf)[_0xed7497(0x219)](_0x3cf2b9=>{const _0x586c01=_0xed7497;_0x3cf2b9['averageCommissionRate']=_0x3cf2b9[_0x586c01(0x18a)]>0x0?_0x3cf2b9[_0x586c01(0x268)]/_0x3cf2b9[_0x586c01(0x18a)]:0x0,delete _0x3cf2b9[_0x586c01(0x268)];}),Object['values'](_0x433db0)[_0xed7497(0x219)](_0x28cf8e=>{const _0x1556d1=_0xed7497;_0x28cf8e[_0x1556d1(0x213)]=_0x28cf8e[_0x1556d1(0x18a)]>0x0?_0x28cf8e[_0x1556d1(0x1a0)]/_0x28cf8e[_0x1556d1(0x18a)]:0x0;});let _0x5d1a07=0x0,_0x3c43c8=0x0;if(_0x1cb5e3['shopId']){const _0x597161=await database_1[_0xed7497(0x1da)][_0xed7497(0x205)][_0xed7497(0x1d4)]({'where':{'shopId':_0x1cb5e3[_0xed7497(0x1dc)],'status':_0xed7497(0x25f),'createdAt':{'gte':_0x337f70,'lte':_0x451981}},'select':{'amount':!![]}});_0x5d1a07=_0x597161[_0xed7497(0x181)]((_0x1496fd,_0x3da245)=>_0x1496fd+_0x3da245[_0xed7497(0x226)],0x0);const _0x445977=await database_1[_0xed7497(0x1da)][_0xed7497(0x205)]['findMany']({'where':{'shopId':_0x1cb5e3[_0xed7497(0x1dc)],'status':_0xed7497(0x21c),'createdAt':{'gte':_0x337f70,'lte':_0x451981}},'select':{'amount':!![]}});_0x3c43c8=_0x445977['reduce']((_0x20a042,_0x21bb68)=>_0x20a042+_0x21bb68[_0xed7497(0x226)],0x0);}const _0x285bfc=_0x36ff1e,_0x584979=_0x403dff['length'],_0x17f28f=_0x584979>0x0?_0x1c898b/_0x584979:0x0,_0x1ca168=_0x285bfc>0x0?Math[_0xed7497(0x129)](_0x584979/_0x285bfc*0x2710)/0x64:0x0,_0x5a52c8=Math[_0xed7497(0x1eb)]((_0x451981[_0xed7497(0x16e)]()-_0x337f70[_0xed7497(0x16e)]())/(0x3e8*0x3c*0x3c*0x18)),_0x471275={'totalTurnover':Math['round'](_0x1c898b*0x64)/0x64,'merchantEarnings':Math['round'](_0x31f4b2*0x64)/0x64,'gatewayEarnings':Math['round'](_0x1fec80*0x64)/0x64,'totalPaidOut':Math[_0xed7497(0x129)](_0x5d1a07*0x64)/0x64,'pendingPayout':Math[_0xed7497(0x129)](_0x3c43c8*0x64)/0x64,'averageCheck':Math[_0xed7497(0x129)](_0x17f28f*0x64)/0x64,'totalPayments':_0x285bfc,'successfulPayments':_0x584979,'conversionRate':_0x1ca168,'chargebacks':_0x310d6d,'refunds':_0x1161a9,'gatewayBreakdown':Object[_0xed7497(0x234)](_0x574faf)[_0xed7497(0x1a9)](_0x4977c5=>({..._0x4977c5,'turnoverUSDT':Math[_0xed7497(0x129)](_0x4977c5[_0xed7497(0x1a0)]*0x64)/0x64,'commissionUSDT':Math[_0xed7497(0x129)](_0x4977c5[_0xed7497(0x124)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0xed7497(0x129)](_0x4977c5['merchantEarningsUSDT']*0x64)/0x64,'averageCommissionRate':Math[_0xed7497(0x129)](_0x4977c5['averageCommissionRate']*0x64)/0x64})),'merchantBreakdown':_0x1cb5e3[_0xed7497(0x1dc)]?undefined:Object[_0xed7497(0x234)](_0x433db0)['map'](_0x3c91e2=>({..._0x3c91e2,'turnoverUSDT':Math['round'](_0x3c91e2[_0xed7497(0x1a0)]*0x64)/0x64,'commissionUSDT':Math[_0xed7497(0x129)](_0x3c91e2[_0xed7497(0x124)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0xed7497(0x129)](_0x3c91e2[_0xed7497(0xf9)]*0x64)/0x64,'paidOutUSDT':Math[_0xed7497(0x129)](_0x3c91e2['paidOutUSDT']*0x64)/0x64,'averageCheckUSDT':Math[_0xed7497(0x129)](_0x3c91e2[_0xed7497(0x213)]*0x64)/0x64})),'dailyData':Object['values'](_0x1a97fa)[_0xed7497(0x1a9)](_0x4878c2=>({..._0x4878c2,'turnover':Math[_0xed7497(0x129)](_0x4878c2[_0xed7497(0xfd)]*0x64)/0x64,'merchantEarnings':Math['round'](_0x4878c2['merchantEarnings']*0x64)/0x64,'gatewayEarnings':Math[_0xed7497(0x129)](_0x4878c2[_0xed7497(0x1e6)]*0x64)/0x64}))[_0xed7497(0x1cb)]((_0x57ee79,_0xdac93d)=>_0x57ee79[_0xed7497(0x102)][_0xed7497(0x20a)](_0xdac93d[_0xed7497(0x102)])),'periodInfo':{'from':_0x337f70,'to':_0x451981,'periodType':_0x1cb5e3[_0xed7497(0x13e)]||'custom','daysCount':_0x5a52c8}};return console[_0xed7497(0x10e)]('ðŸ“Š\x20Merchant\x20statistics\x20calculated:'),console['log'](_0xed7497(0x121)+_0x471275[_0xed7497(0x1a8)]+_0xed7497(0x26a)),console['log']('\x20\x20\x20ðŸ‘¤\x20Merchant\x20earnings:\x20'+_0x471275[_0xed7497(0x18d)]+_0xed7497(0x26a)),console[_0xed7497(0x10e)](_0xed7497(0x1bf)+_0x471275['gatewayEarnings']+_0xed7497(0x26a)),console[_0xed7497(0x10e)]('\x20\x20\x20ï¿½\x20Total\x20paid\x20out:\x20'+_0x471275['totalPaidOut']+'\x20USDT'),console[_0xed7497(0x10e)](_0xed7497(0x1ba)+_0x471275[_0xed7497(0x107)]+'\x20USDT'),console['log'](_0xed7497(0x1ad)+_0x471275['totalPayments']),_0x471275;}async[a46_0x5060ae(0x137)](_0x19d7a1){const _0x3c6d76=a46_0x5060ae;console[_0x3c6d76(0x10e)](_0x3c6d76(0x23b),{'hasPayoutHistory':_0x19d7a1});let _0x38fba7={};_0x19d7a1&&(_0x38fba7[_0x3c6d76(0x10d)]={'some':{}});const _0xd99ebe=await database_1[_0x3c6d76(0x1da)][_0x3c6d76(0x11e)]['findMany']({'where':_0x38fba7,'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x3c6d76(0x15d)}});return console[_0x3c6d76(0x10e)](_0x3c6d76(0x1fb)+_0xd99ebe[_0x3c6d76(0x120)]+_0x3c6d76(0x149)+(_0x19d7a1?_0x3c6d76(0x101):'')),_0xd99ebe['map'](_0x25d2da=>({'id':_0x25d2da['id'],'username':_0x25d2da[_0x3c6d76(0x17c)],'name':_0x25d2da[_0x3c6d76(0x191)]}));}[a46_0x5060ae(0x1df)](_0x28874b){const _0x259c7f=a46_0x5060ae,_0x451147={'test_gateway':_0x259c7f(0x249),'plisio':_0x259c7f(0x16b),'rapyd':_0x259c7f(0x189),'noda':_0x259c7f(0x240),'cointopay':_0x259c7f(0x1d9),'cointopay2':_0x259c7f(0x119),'klyme_eu':_0x259c7f(0x164),'klyme_gb':'KLYME\x20GB','klyme_de':'KLYME\x20DE','mastercard':_0x259c7f(0x183)};return _0x451147[_0x28874b]||_0x28874b;}[a46_0x5060ae(0x1ee)](_0x362ee3){const _0x5da58f=a46_0x5060ae,_0x4ee793={'Test\x20Gateway':_0x5da58f(0x22f),'Plisio':'plisio','Rapyd':_0x5da58f(0x122),'Noda':_0x5da58f(0x1e1),'CoinToPay':_0x5da58f(0x14d),'CoinToPay2':_0x5da58f(0x1c5),'KLYME\x20EU':_0x5da58f(0x264),'KLYME\x20GB':_0x5da58f(0x244),'KLYME\x20DE':_0x5da58f(0x1dd),'MasterCard':_0x5da58f(0x151)};return _0x4ee793[_0x362ee3]||_0x362ee3[_0x5da58f(0x112)]();}async['getMerchantsAwaitingPayout'](_0x458eb4){const _0x11f4eb=a46_0x5060ae,{page:_0x322ad2,limit:_0x3c3cb9,minAmount:_0x859013,search:_0x179f16}=_0x458eb4;console[_0x11f4eb(0x10e)](_0x11f4eb(0x19a),_0x458eb4);let _0x4905d5={};_0x179f16&&(_0x4905d5[_0x11f4eb(0x191)]={'contains':_0x179f16,'mode':'insensitive'});const _0x2af3b8=await database_1['default']['shop'][_0x11f4eb(0x1d4)]({'where':_0x4905d5,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),_0x57e1aa=_0x2af3b8[_0x11f4eb(0x1ac)](_0xb85d59=>{const _0x5c732c=Math['floor'](_0xb85d59['balance']*0x64)/0x64;if(_0x859013&&_0x5c732c<_0x859013)return![];return _0x5c732c!==0x0;});_0x57e1aa[_0x11f4eb(0x1cb)]((_0x522b27,_0x483132)=>_0x483132['balance']-_0x522b27[_0x11f4eb(0x20f)]);const _0x2ea160=_0x57e1aa['length'],_0x202b90=(_0x322ad2-0x1)*_0x3c3cb9,_0x79193b=_0x57e1aa[_0x11f4eb(0x19d)](_0x202b90,_0x202b90+_0x3c3cb9);console[_0x11f4eb(0x10e)](_0x11f4eb(0x162)+_0x79193b[_0x11f4eb(0x120)]+'\x20merchants\x20with\x20rounded\x20balance\x20!=\x200.00\x20(excluding\x20balances\x20that\x20round\x20to\x200.00)');const _0x1e82b4=await Promise[_0x11f4eb(0x104)](_0x79193b[_0x11f4eb(0x1a9)](async _0x12d70c=>{const _0xd57f5d=_0x11f4eb,[_0x59d195,_0x3be34f,_0x437b10]=await Promise['all']([database_1['default'][_0xd57f5d(0x1d8)][_0xd57f5d(0x153)]({'where':{'shopId':_0x12d70c['id'],'status':_0xd57f5d(0x237),'gateway':{'not':_0xd57f5d(0x22f)}}}),database_1[_0xd57f5d(0x1da)]['payment'][_0xd57f5d(0x136)]({'where':{'shopId':_0x12d70c['id'],'status':_0xd57f5d(0x237),'gateway':{'not':_0xd57f5d(0x22f)}},'orderBy':{'paidAt':_0xd57f5d(0x15d)},'select':{'paidAt':!![]}}),database_1['default']['payment']['groupBy']({'by':['gateway'],'where':{'shopId':_0x12d70c['id'],'status':'PAID','gateway':{'not':'test_gateway'}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x1c4ab0=new Date(),_0x238fc3=new Date(_0x1c4ab0[_0xd57f5d(0x19f)](),_0x1c4ab0['getMonth'](),0x1),_0x2b9289=new Date(_0x1c4ab0['getFullYear'](),_0x1c4ab0[_0xd57f5d(0x17e)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x30bc0b,_0x24e197]=await Promise[_0xd57f5d(0x104)]([database_1[_0xd57f5d(0x1da)][_0xd57f5d(0x205)]['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x12d70c['id'],'status':_0xd57f5d(0x25f)}}),database_1[_0xd57f5d(0x1da)][_0xd57f5d(0x205)][_0xd57f5d(0x221)]({'_sum':{'amount':!![]},'where':{'shopId':_0x12d70c['id'],'status':_0xd57f5d(0x25f),'createdAt':{'gte':_0x238fc3,'lte':_0x2b9289}}})]),_0x1f1d1d=_0x30bc0b[_0xd57f5d(0x167)][_0xd57f5d(0x226)]||0x0,_0x32b8b1=_0x24e197[_0xd57f5d(0x167)][_0xd57f5d(0x226)]||0x0,_0x204fb7=await Promise[_0xd57f5d(0x104)](_0x437b10[_0xd57f5d(0x1a9)](async _0x437a33=>{const _0x4d1a60=_0xd57f5d;let _0x4ae4f3=0x2d;if(_0x12d70c[_0x4d1a60(0x148)])try{const _0x457ed9=JSON[_0x4d1a60(0x255)](_0x12d70c['gatewaySettings']);for(const [_0x29bd65,_0x482469]of Object[_0x4d1a60(0x182)](_0x457ed9)){if(_0x29bd65[_0x4d1a60(0x112)]()===_0x437a33[_0x4d1a60(0x110)][_0x4d1a60(0x112)]()){_0x4ae4f3=_0x482469[_0x4d1a60(0x108)]||0xa,console['log']('ðŸ’°\x20[PAYOUT]\x20Gateway\x20'+_0x437a33['gateway']+_0x4d1a60(0x179)+_0x12d70c['id']+':\x20commission\x20=\x20'+_0x4ae4f3+'%');break;}}}catch(_0xa76c48){console['error'](_0x4d1a60(0x1e8)+_0x12d70c['id']+':',_0xa76c48);}const _0x203f32=_0x437a33['_sum']?.[_0x4d1a60(0x195)]||0x0,_0x5035f1=_0x203f32*(0x1-_0x4ae4f3/0x64);return{'gateway':_0x437a33[_0x4d1a60(0x110)],'count':_0x437a33[_0x4d1a60(0x24b)]?.['id']||0x0,'amountUSDT':Math[_0x4d1a60(0x129)](_0x203f32*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x4d1a60(0x129)](_0x5035f1*0x64)/0x64,'commission':_0x4ae4f3};})),_0x2ac4c2=_0x204fb7[_0xd57f5d(0x181)]((_0x1980fb,_0x4d8dd9)=>_0x1980fb+_0x4d8dd9[_0xd57f5d(0x195)],0x0),_0x2e65f3=_0x204fb7[_0xd57f5d(0x181)]((_0x3b4ecc,_0x329929)=>_0x3b4ecc+_0x329929[_0xd57f5d(0x19e)],0x0),_0x3ccfe8=_0x12d70c[_0xd57f5d(0x20f)];return console[_0xd57f5d(0x10e)]('ðŸ’°\x20[PAYOUT]\x20Merchant\x20'+_0x12d70c['username']+':'),console[_0xd57f5d(0x10e)](_0xd57f5d(0x248)+_0x2ac4c2[_0xd57f5d(0x239)](0x2)+_0xd57f5d(0x16c)),console['log'](_0xd57f5d(0x23f)+_0x2e65f3[_0xd57f5d(0x239)](0x2)+'\x20USDT\x20(theoretical\x20net)'),console[_0xd57f5d(0x10e)]('\x20\x20\x20âœ…\x20Actual\x20available\x20balance:\x20'+_0x3ccfe8['toFixed'](0x2)+_0xd57f5d(0x1b6)),console[_0xd57f5d(0x10e)](_0xd57f5d(0x254)+_0x1f1d1d[_0xd57f5d(0x239)](0x2)+_0xd57f5d(0x198)),console[_0xd57f5d(0x10e)](_0xd57f5d(0x1a2)+(_0x2e65f3-_0x1f1d1d-_0x3ccfe8)['toFixed'](0x2)+_0xd57f5d(0x180)),{'id':_0x12d70c['id'],'fullName':_0x12d70c['name'],'username':_0x12d70c[_0xd57f5d(0x17c)],'telegramId':_0x12d70c[_0xd57f5d(0x22d)],'merchantUrl':_0x12d70c['shopUrl'],'wallets':{'usdtPolygonWallet':_0x12d70c['usdtPolygonWallet'],'usdtTrcWallet':_0x12d70c[_0xd57f5d(0x23a)],'usdtErcWallet':_0x12d70c[_0xd57f5d(0x262)],'usdcPolygonWallet':_0x12d70c[_0xd57f5d(0x16f)],'usdcErcWallet':_0x12d70c[_0xd57f5d(0x224)]},'totalAmountUSDT':Math[_0xd57f5d(0x129)](_0x2ac4c2*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x2e65f3*0x64)/0x64,'currentBalance':Math['floor'](_0x3ccfe8*0x64)/0x64,'totalPayout':Math[_0xd57f5d(0x129)](_0x1f1d1d*0x64)/0x64,'thisMonth':Math[_0xd57f5d(0x129)](_0x32b8b1*0x64)/0x64,'paymentsCount':_0x59d195,'oldestPaymentDate':_0x3be34f?.[_0xd57f5d(0x12a)]||_0x12d70c['createdAt'],'gatewayBreakdown':_0x204fb7};})),_0x2fc802=_0x1e82b4[_0x11f4eb(0x181)]((_0x524639,_0x6619ce)=>_0x524639+_0x6619ce[_0x11f4eb(0x1fe)],0x0),_0x370ecc=_0x1e82b4['reduce']((_0x1c4962,_0x5787df)=>_0x1c4962+_0x5787df[_0x11f4eb(0x139)],0x0),_0x38671a=_0x1e82b4[_0x11f4eb(0x181)]((_0x5b0846,_0x1cdf84)=>_0x5b0846+_0x1cdf84['totalPayout'],0x0),_0xfd0f87=_0x1e82b4[_0x11f4eb(0x181)]((_0x2ba7d9,_0x289041)=>_0x2ba7d9+_0x289041[_0x11f4eb(0x174)],0x0);return console[_0x11f4eb(0x10e)]('ðŸ“Š\x20Merchants\x20with\x20rounded\x20balance\x20!=\x200.00:\x20'+_0x2ea160+_0x11f4eb(0x131)),console[_0x11f4eb(0x10e)](_0x11f4eb(0x1b2)+Math[_0x11f4eb(0x129)](_0x2fc802*0x64)/0x64+_0x11f4eb(0x16c)),console['log'](_0x11f4eb(0x1e3)+Math[_0x11f4eb(0x129)](_0x370ecc*0x64)/0x64+_0x11f4eb(0x11c)),console[_0x11f4eb(0x10e)](_0x11f4eb(0xff)+Math[_0x11f4eb(0x129)](_0x38671a*0x64)/0x64+_0x11f4eb(0x26a)),console['log'](_0x11f4eb(0x1e9)+Math[_0x11f4eb(0x129)](_0xfd0f87*0x64)/0x64+_0x11f4eb(0x26a)),{'merchants':_0x1e82b4,'pagination':{'page':_0x322ad2,'limit':_0x3c3cb9,'total':_0x2ea160,'totalPages':Math[_0x11f4eb(0x1eb)](_0x2ea160/_0x3c3cb9)},'summary':{'totalMerchants':_0x2ea160,'totalAmountUSDT':Math[_0x11f4eb(0x129)](_0x2fc802*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x11f4eb(0x129)](_0x370ecc*0x64)/0x64,'totalPayout':Math[_0x11f4eb(0x129)](_0x38671a*0x64)/0x64,'thisMonth':Math[_0x11f4eb(0x129)](_0xfd0f87*0x64)/0x64}};}async[a46_0x5060ae(0x266)](_0x32c805){const _0x587bec=a46_0x5060ae,{shopId:_0x2b3145,amount:_0x4142c5,network:_0x28d96c,wallet:_0x5bec5c,notes:_0xf17303,txid:_0x34933c,periodFrom:_0x59a91e,periodTo:_0xa9304c}=_0x32c805,_0x272650=await database_1[_0x587bec(0x1da)][_0x587bec(0x11b)](async _0x3089bc=>{const _0x53a84a=_0x587bec,_0x4bca0d=await _0x3089bc[_0x53a84a(0x11e)]['findUnique']({'where':{'id':_0x2b3145},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x4bca0d)throw new Error(_0x53a84a(0x251));console[_0x53a84a(0x10e)](_0x53a84a(0x1bb)+_0x4bca0d[_0x53a84a(0x17c)]+':'),console[_0x53a84a(0x10e)](_0x53a84a(0x13c)+_0x4bca0d[_0x53a84a(0x20f)][_0x53a84a(0x239)](0x6)+_0x53a84a(0x26a)),console[_0x53a84a(0x10e)](_0x53a84a(0x123)+_0x4142c5[_0x53a84a(0x239)](0x6)+_0x53a84a(0x26a)),console[_0x53a84a(0x10e)](_0x53a84a(0x250)+_0x4bca0d[_0x53a84a(0x211)][_0x53a84a(0x239)](0x6)+_0x53a84a(0x26a));if(_0x34933c)console[_0x53a84a(0x10e)](_0x53a84a(0x186)+_0x34933c);const _0x81114a=0.000001,_0x253b70=Number(_0x4bca0d[_0x53a84a(0x20f)]),_0x43fd50=Number(_0x4142c5);console[_0x53a84a(0x10e)](_0x53a84a(0x1d7)),console['log'](_0x53a84a(0x1db)+_0x4bca0d[_0x53a84a(0x20f)]),console['log']('\x20\x20\x20Available\x20(number):\x20'+_0x253b70),console[_0x53a84a(0x10e)]('\x20\x20\x20Requested\x20(number):\x20'+_0x43fd50),console[_0x53a84a(0x10e)](_0x53a84a(0x1e7)+(_0x253b70-_0x43fd50)),console[_0x53a84a(0x10e)](_0x53a84a(0x163)+_0x81114a);if(_0x253b70<_0x43fd50-_0x81114a)throw new Error(_0x53a84a(0x20b)+_0x253b70[_0x53a84a(0x239)](0x6)+_0x53a84a(0x133)+_0x43fd50[_0x53a84a(0x239)](0x6)+_0x53a84a(0x170)+(_0x253b70-_0x43fd50)['toFixed'](0x8)+'\x20USDT');console[_0x53a84a(0x10e)](_0x53a84a(0x196));const _0x5571c6=Math[_0x53a84a(0x197)](_0x253b70,_0x43fd50);let _0x3a7349=_0x5bec5c;console[_0x53a84a(0x10e)](_0x53a84a(0x115)+(_0x5bec5c||_0x53a84a(0x20c)));if(!_0x3a7349){console[_0x53a84a(0x10e)]('ðŸ”\x20No\x20wallet\x20provided,\x20looking\x20up\x20from\x20shop\x20settings...');const _0x335b8a=await _0x3089bc[_0x53a84a(0x11e)][_0x53a84a(0x144)]({'where':{'id':_0x2b3145},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});console[_0x53a84a(0x10e)](_0x53a84a(0x1cc),_0x335b8a);if(_0x335b8a)switch(_0x28d96c){case _0x53a84a(0x218):_0x3a7349=_0x335b8a['usdtPolygonWallet']||undefined,console['log']('ðŸ”\x20Selected\x20polygon\x20wallet:\x20'+_0x3a7349);break;case'trc20':_0x3a7349=_0x335b8a[_0x53a84a(0x23a)]||undefined,console[_0x53a84a(0x10e)](_0x53a84a(0x125)+_0x3a7349);break;case _0x53a84a(0x1aa):_0x3a7349=_0x335b8a[_0x53a84a(0x262)]||undefined,console[_0x53a84a(0x10e)]('ðŸ”\x20Selected\x20erc20\x20wallet:\x20'+_0x3a7349);break;case _0x53a84a(0x21e):_0x3a7349=_0x335b8a['usdcPolygonWallet']||undefined,console[_0x53a84a(0x10e)](_0x53a84a(0x1ec)+_0x3a7349);break;case _0x53a84a(0x1e2):_0x3a7349=_0x335b8a['usdcErcWallet']||undefined,console[_0x53a84a(0x10e)]('ðŸ”\x20Selected\x20erc20_usdc\x20wallet:\x20'+_0x3a7349);break;}}else console[_0x53a84a(0x10e)]('âœ…\x20Using\x20wallet\x20from\x20request:\x20'+_0x3a7349);console[_0x53a84a(0x10e)](_0x53a84a(0x1f7)+_0x28d96c+':\x20'+(_0x3a7349||_0x53a84a(0x10a))),console[_0x53a84a(0x10e)](_0x53a84a(0x253),{'shopId':_0x2b3145,'amount':_0x5571c6,'network':_0x28d96c,'wallet':_0x3a7349,'status':_0x53a84a(0x25f),'txid':_0x34933c,'notes':_0xf17303,'periodFrom':_0x59a91e?new Date(_0x59a91e):null,'periodTo':_0xa9304c?new Date(_0xa9304c):null});const _0x297b8c=await _0x3089bc[_0x53a84a(0x205)][_0x53a84a(0x260)]({'data':{'shopId':_0x2b3145,'amount':_0x5571c6,'network':_0x28d96c,'wallet':_0x3a7349,'status':_0x53a84a(0x25f),'txid':_0x34933c,'notes':_0xf17303,'periodFrom':_0x59a91e?new Date(_0x59a91e):null,'periodTo':_0xa9304c?new Date(_0xa9304c):null,'createdAt':new Date(),'paidAt':new Date()}});console[_0x53a84a(0x10e)](_0x53a84a(0x1bc),{'id':_0x297b8c['id'],'wallet':_0x297b8c[_0x53a84a(0x1a5)],'network':_0x297b8c['network'],'amount':_0x297b8c[_0x53a84a(0x226)]});const _0x5d272d=_0x253b70-_0x5571c6,_0x2ff215=Number(_0x4bca0d[_0x53a84a(0x211)])+_0x5571c6;return await _0x3089bc[_0x53a84a(0x11e)][_0x53a84a(0x217)]({'where':{'id':_0x2b3145},'data':{'balance':_0x5d272d,'totalPaidOut':_0x2ff215}}),console[_0x53a84a(0x10e)](_0x53a84a(0x1de)+_0x4bca0d['username']+_0x53a84a(0x113)),console[_0x53a84a(0x10e)](_0x53a84a(0x1e5)+_0x253b70[_0x53a84a(0x239)](0x6)+_0x53a84a(0x157)+_0x5d272d[_0x53a84a(0x239)](0x6)+_0x53a84a(0x111)+_0x5571c6['toFixed'](0x6)+')'),console[_0x53a84a(0x10e)]('\x20\x20\x20Total\x20paid\x20out:\x20'+_0x4bca0d[_0x53a84a(0x211)]['toFixed'](0x6)+_0x53a84a(0x157)+_0x2ff215[_0x53a84a(0x239)](0x6)+_0x53a84a(0x13a)+_0x5571c6[_0x53a84a(0x239)](0x6)+')'),console[_0x53a84a(0x10e)]('\x20\x20\x20Final\x20payout\x20amount\x20used:\x20'+_0x5571c6[_0x53a84a(0x239)](0x6)+_0x53a84a(0x26a)),{'payout':_0x297b8c,'shop':_0x4bca0d};});console[_0x587bec(0x10e)]('âœ…\x20Payout\x20created:\x20'+_0x272650[_0x587bec(0x205)]['id']+_0x587bec(0x179)+_0x272650['shop'][_0x587bec(0x17c)]+'\x20('+_0x272650['payout'][_0x587bec(0x226)][_0x587bec(0x239)](0x6)+_0x587bec(0x11f));try{let _0x3ab79f=_0x587bec(0x208);if(_0x272650[_0x587bec(0x205)][_0x587bec(0x106)]&&_0x272650[_0x587bec(0x205)][_0x587bec(0x15b)]){const _0xf72e39=new Date(_0x272650[_0x587bec(0x205)]['periodFrom'])[_0x587bec(0x176)](_0x587bec(0x209)),_0x54a73f=new Date(_0x272650[_0x587bec(0x205)]['periodTo'])[_0x587bec(0x176)]('ru-RU');_0x3ab79f=_0xf72e39+'\x20-\x20'+_0x54a73f;}await telegramBotService_1[_0x587bec(0x242)][_0x587bec(0x215)](_0x272650[_0x587bec(0x205)]['shopId'],{'id':_0x272650[_0x587bec(0x205)]['id'],'amount':_0x272650[_0x587bec(0x205)]['amount'],'network':_0x272650[_0x587bec(0x205)][_0x587bec(0x15f)],'wallet':_0x272650[_0x587bec(0x205)][_0x587bec(0x1a5)],'period':_0x3ab79f,'createdAt':_0x272650[_0x587bec(0x205)]['createdAt'],'txid':_0x272650[_0x587bec(0x205)][_0x587bec(0x152)]}),console[_0x587bec(0x10e)]('ðŸ“±\x20Telegram\x20notification\x20sent\x20for\x20payout\x20'+_0x272650[_0x587bec(0x205)]['id']);}catch(_0xe01af4){console[_0x587bec(0x1b9)](_0x587bec(0x1d5)+_0x272650[_0x587bec(0x205)]['id']+':',_0xe01af4);}return{'id':_0x272650[_0x587bec(0x205)]['id'],'shopId':_0x272650[_0x587bec(0x205)][_0x587bec(0x1dc)],'shopName':_0x272650[_0x587bec(0x11e)]['name'],'shopUsername':_0x272650[_0x587bec(0x11e)][_0x587bec(0x17c)],'amount':_0x272650[_0x587bec(0x205)][_0x587bec(0x226)],'network':_0x272650[_0x587bec(0x205)][_0x587bec(0x15f)],'wallet':_0x272650[_0x587bec(0x205)]['wallet'],'status':_0x272650[_0x587bec(0x205)]['status'],'txid':_0x272650[_0x587bec(0x205)][_0x587bec(0x152)],'notes':_0x272650['payout'][_0x587bec(0x14b)],'periodFrom':_0x272650[_0x587bec(0x205)][_0x587bec(0x106)],'periodTo':_0x272650[_0x587bec(0x205)][_0x587bec(0x15b)],'createdAt':_0x272650[_0x587bec(0x205)][_0x587bec(0x241)],'paidAt':_0x272650[_0x587bec(0x205)][_0x587bec(0x12a)]};}async['getAllPayouts'](_0xa575e9){const _0x1767ec=a46_0x5060ae,{page:_0x30eebf,limit:_0xf993e3,shopId:_0x446c75,network:_0x42a7dc,dateFrom:_0x1145e2,dateTo:_0x5ae749,search:_0x17ff47}=_0xa575e9,_0x450e8d=(_0x30eebf-0x1)*_0xf993e3,_0x25422c={};_0x446c75&&(_0x25422c[_0x1767ec(0x1dc)]=_0x446c75);_0x42a7dc&&(_0x25422c[_0x1767ec(0x15f)]=_0x42a7dc);if(_0x1145e2||_0x5ae749){_0x25422c[_0x1767ec(0x241)]={};if(_0x1145e2){const _0x45e6ad=new Date(_0x1145e2);_0x45e6ad[_0x1767ec(0x175)](0x0,0x0,0x0,0x1),_0x25422c[_0x1767ec(0x241)][_0x1767ec(0x20d)]=_0x45e6ad,console[_0x1767ec(0x10e)](_0x1767ec(0x159)+_0x45e6ad['toISOString']());}if(_0x5ae749){const _0x33647e=new Date(_0x5ae749);_0x33647e['setHours'](0x17,0x3b,0x3b,0x3e7),_0x25422c[_0x1767ec(0x241)][_0x1767ec(0x1d0)]=_0x33647e,console[_0x1767ec(0x10e)](_0x1767ec(0x158)+_0x33647e['toISOString']());}}_0x17ff47&&(_0x25422c['OR']=[{'shop':{'name':{'contains':_0x17ff47,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x17ff47,'mode':_0x1767ec(0x1d2)}}},{'notes':{'contains':_0x17ff47,'mode':'insensitive'}}]);const [_0x4b98dc,_0x31d442]=await Promise[_0x1767ec(0x104)]([database_1[_0x1767ec(0x1da)][_0x1767ec(0x205)][_0x1767ec(0x1d4)]({'where':_0x25422c,'skip':_0x450e8d,'take':_0xf993e3,'orderBy':{'createdAt':_0x1767ec(0x187)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'wallet':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x1767ec(0x1da)][_0x1767ec(0x205)][_0x1767ec(0x153)]({'where':_0x25422c})]);return{'payouts':_0x4b98dc['map'](_0x177c39=>({'id':_0x177c39['id'],'shopId':_0x177c39[_0x1767ec(0x1dc)],'shopName':_0x177c39[_0x1767ec(0x11e)]['name'],'shopUsername':_0x177c39[_0x1767ec(0x11e)][_0x1767ec(0x17c)],'amount':_0x177c39['amount'],'network':_0x177c39[_0x1767ec(0x15f)],'wallet':_0x177c39['wallet'],'status':_0x177c39[_0x1767ec(0x154)],'txid':_0x177c39[_0x1767ec(0x152)],'notes':_0x177c39[_0x1767ec(0x14b)],'periodFrom':_0x177c39['periodFrom'],'periodTo':_0x177c39[_0x1767ec(0x15b)],'createdAt':_0x177c39[_0x1767ec(0x241)],'paidAt':_0x177c39['paidAt']})),'pagination':{'page':_0x30eebf,'limit':_0xf993e3,'total':_0x31d442,'totalPages':Math['ceil'](_0x31d442/_0xf993e3)}};}async[a46_0x5060ae(0x103)](_0x4b7aed){const _0x570b5b=a46_0x5060ae,_0x5e4948=await database_1[_0x570b5b(0x1da)]['payout'][_0x570b5b(0x144)]({'where':{'id':_0x4b7aed},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x5e4948)return null;return{'id':_0x5e4948['id'],'shopId':_0x5e4948[_0x570b5b(0x1dc)],'shopName':_0x5e4948[_0x570b5b(0x11e)][_0x570b5b(0x191)],'shopUsername':_0x5e4948[_0x570b5b(0x11e)]['username'],'amount':_0x5e4948['amount'],'network':_0x5e4948['network'],'wallet':_0x5e4948[_0x570b5b(0x1a5)],'status':_0x5e4948[_0x570b5b(0x154)],'txid':_0x5e4948[_0x570b5b(0x152)],'notes':_0x5e4948['notes'],'periodFrom':_0x5e4948['periodFrom'],'periodTo':_0x5e4948[_0x570b5b(0x15b)],'createdAt':_0x5e4948[_0x570b5b(0x241)],'paidAt':_0x5e4948[_0x570b5b(0x12a)]};}async[a46_0x5060ae(0x15e)](_0x54d529){const _0x2355ec=a46_0x5060ae;await database_1[_0x2355ec(0x1da)][_0x2355ec(0x205)][_0x2355ec(0x135)]({'where':{'id':_0x54d529}});}async['getAllPayments'](_0x1c27c4){const _0x103aad=a46_0x5060ae,{page:_0x2a0b7c,limit:_0x35d5c1,status:_0x4be427,gateway:_0xaff3e8,shopId:_0x37193c,dateFrom:_0x4f9e45,dateTo:_0x2d0d08,search:_0x153032,currency:_0x3f6d88,sortBy:_0x496cc8,sortOrder:_0x267cb3}=_0x1c27c4,_0x2eb502=(_0x2a0b7c-0x1)*_0x35d5c1;console[_0x103aad(0x10e)](_0x103aad(0x1b4),_0x1c27c4);const _0x536dab=await database_1['default'][_0x103aad(0x1d8)]['groupBy']({'by':[_0x103aad(0x110)],'_count':{'gateway':!![]}});console['log'](_0x103aad(0x230),_0x536dab[_0x103aad(0x1a9)](_0x21811b=>_0x21811b[_0x103aad(0x110)]+'\x20('+_0x21811b['_count'][_0x103aad(0x110)]+_0x103aad(0x1a4)));if(_0xaff3e8){const _0x5edf25=_0x536dab[_0x103aad(0x236)](_0x48b535=>_0x48b535[_0x103aad(0x110)][_0x103aad(0x112)]()===_0xaff3e8[_0x103aad(0x112)]());!_0x5edf25&&_0xaff3e8['toLowerCase']()!==_0x103aad(0x22f)&&console['log'](_0x103aad(0x1ca)+_0xaff3e8+'\x27\x20not\x20found.\x20Available\x20gateways:\x20'+_0x536dab[_0x103aad(0x1a9)](_0x2201fc=>_0x2201fc[_0x103aad(0x110)])[_0x103aad(0x1b5)](',\x20'));}const _0x586a4b={};_0x4be427&&(_0x586a4b['status']=_0x4be427[_0x103aad(0x132)]());if(!_0xaff3e8)_0x586a4b[_0x103aad(0x110)]={'not':_0x103aad(0x22f)};else{if(_0xaff3e8&&(_0xaff3e8[_0x103aad(0x112)]()===_0x103aad(0x22f)||_0xaff3e8===_0x103aad(0x12d)))_0x586a4b[_0x103aad(0x110)]=_0x103aad(0x22f);else{let _0x14b85e=_0xaff3e8;const _0x312cd1=(0x0,gateway_1[_0x103aad(0x10f)])(_0xaff3e8);if(_0x312cd1)_0x14b85e=_0x312cd1,console[_0x103aad(0x10e)]('ðŸ”„\x20Converted\x20gateway\x20ID\x20\x27'+_0xaff3e8+_0x103aad(0x109)+_0x14b85e+'\x27');else{const _0x4dfbe6=(0x0,gateway_1[_0x103aad(0x1e4)])(_0xaff3e8);if(_0x4dfbe6){const _0x8785b2=(0x0,gateway_1[_0x103aad(0x10f)])(_0x4dfbe6);_0x8785b2&&(_0x14b85e=_0x8785b2,console['log']('ðŸ”„\x20Converted\x20gateway\x20name\x20\x27'+_0xaff3e8+_0x103aad(0x190)+_0x4dfbe6+_0x103aad(0x1bd)+_0x14b85e+'\x27'));}else console[_0x103aad(0x10e)](_0x103aad(0x147)+_0xaff3e8+'\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)');}const _0x4d6763=await database_1[_0x103aad(0x1da)][_0x103aad(0x1d8)][_0x103aad(0x153)]({'where':{'gateway':_0x14b85e[_0x103aad(0x112)]()},'take':0x1});_0x4d6763===0x0?(console[_0x103aad(0x10e)](_0x103aad(0x22a)+_0x14b85e+_0x103aad(0x21d)+_0xaff3e8+_0x103aad(0x12f)),_0x586a4b[_0x103aad(0x110)]='NONEXISTENT_GATEWAY_FILTER'):(_0x586a4b[_0x103aad(0x110)]=_0x14b85e[_0x103aad(0x112)](),console[_0x103aad(0x10e)](_0x103aad(0x10b)+_0x14b85e+'\x27\x20(from\x20\x27'+_0xaff3e8+'\x27)'));}}console['log']('ðŸ“Š\x20Gateway\x20filter\x20applied:',_0x586a4b[_0x103aad(0x110)]);_0x37193c&&(_0x586a4b[_0x103aad(0x1dc)]=_0x37193c);_0x3f6d88&&(_0x586a4b[_0x103aad(0x21f)]=_0x3f6d88[_0x103aad(0x132)](),console[_0x103aad(0x10e)](_0x103aad(0x1c8)+_0x3f6d88[_0x103aad(0x132)]()));if(_0x4f9e45||_0x2d0d08){_0x586a4b[_0x103aad(0x241)]={};if(_0x4f9e45){const _0x445457=new Date(_0x4f9e45);_0x445457[_0x103aad(0x175)](0x0,0x0,0x0,0x1),_0x586a4b['createdAt'][_0x103aad(0x20d)]=_0x445457,console[_0x103aad(0x10e)]('ðŸ“…\x20Date\x20from\x20filter:\x20'+_0x445457['toISOString']());}if(_0x2d0d08){const _0x413352=new Date(_0x2d0d08);_0x413352['setHours'](0x17,0x3b,0x3b,0x3e7),_0x586a4b['createdAt'][_0x103aad(0x1d0)]=_0x413352,console[_0x103aad(0x10e)]('ðŸ“…\x20Date\x20to\x20filter:\x20'+_0x413352['toISOString']());}}_0x153032&&(_0x586a4b['OR']=[{'id':{'contains':_0x153032,'mode':_0x103aad(0x1d2)}},{'orderId':{'contains':_0x153032,'mode':'insensitive'}},{'gatewayOrderId':{'contains':_0x153032,'mode':_0x103aad(0x1d2)}},{'customerEmail':{'contains':_0x153032,'mode':_0x103aad(0x1d2)}},{'shop':{'name':{'contains':_0x153032,'mode':_0x103aad(0x1d2)}}},{'shop':{'username':{'contains':_0x153032,'mode':_0x103aad(0x1d2)}}}]);console[_0x103aad(0x10e)]('ðŸ“Š\x20Final\x20WHERE\x20conditions:',JSON['stringify'](_0x586a4b,null,0x2));let _0x55d4a0={'createdAt':_0x103aad(0x187)};if(_0x496cc8){const _0x3879b0=[_0x103aad(0x226),_0x103aad(0x241),_0x103aad(0x12b),_0x103aad(0x154),_0x103aad(0x110),_0x103aad(0x21f)],_0x44de96=[_0x103aad(0x15d),_0x103aad(0x187)];if(_0x3879b0[_0x103aad(0x1a1)](_0x496cc8)){const _0x57b4f0=_0x44de96[_0x103aad(0x1a1)](_0x267cb3)?_0x267cb3:_0x103aad(0x187);_0x55d4a0={[_0x496cc8]:_0x57b4f0},console['log'](_0x103aad(0x1be)+_0x496cc8+_0x103aad(0x267)+_0x57b4f0+_0x103aad(0x258));}}const [_0x3cab95,_0x2abd1b]=await Promise[_0x103aad(0x104)]([database_1[_0x103aad(0x1da)]['payment'][_0x103aad(0x1d4)]({'where':_0x586a4b,'skip':_0x2eb502,'take':_0x35d5c1,'orderBy':_0x55d4a0,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x103aad(0x1d8)][_0x103aad(0x153)]({'where':_0x586a4b})]);return{'payments':_0x3cab95,'pagination':{'page':_0x2a0b7c,'limit':_0x35d5c1,'total':_0x2abd1b,'totalPages':Math[_0x103aad(0x1eb)](_0x2abd1b/_0x35d5c1)}};}async[a46_0x5060ae(0x1a3)](_0x69631e){const _0x538509=a46_0x5060ae,_0x3cf492=await database_1[_0x538509(0x1da)][_0x538509(0x1d8)]['findUnique']({'where':{'id':_0x69631e},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x3cf492)return null;return{'id':_0x3cf492['id'],'shopId':_0x3cf492[_0x538509(0x1dc)],'gateway':_0x3cf492[_0x538509(0x110)],'amount':_0x3cf492[_0x538509(0x226)],'currency':_0x3cf492[_0x538509(0x21f)],'status':_0x3cf492[_0x538509(0x154)],'orderId':_0x3cf492[_0x538509(0x1c7)],'gatewayOrderId':_0x3cf492[_0x538509(0x257)],'customerEmail':_0x3cf492['customerEmail'],'customerName':_0x3cf492[_0x538509(0x1d1)],'customerCountry':_0x3cf492[_0x538509(0xfc)],'customerIp':_0x3cf492[_0x538509(0x1f3)],'customerUa':_0x3cf492[_0x538509(0x11d)],'failureMessage':_0x3cf492[_0x538509(0x13b)],'externalPaymentUrl':_0x3cf492['externalPaymentUrl'],'successUrl':_0x3cf492[_0x538509(0x245)],'failUrl':_0x3cf492[_0x538509(0x17d)],'pendingUrl':_0x3cf492[_0x538509(0x23c)],'whiteUrl':_0x3cf492[_0x538509(0x243)],'createdAt':_0x3cf492['createdAt'],'updatedAt':_0x3cf492['updatedAt'],'shop':_0x3cf492['shop']};}async[a46_0x5060ae(0x169)](_0x3d9736,_0x1d8c6a,_0x1aa96,_0x513f8f){const _0x5e85a2=a46_0x5060ae,_0x301e91=await database_1[_0x5e85a2(0x1da)][_0x5e85a2(0x11b)](async _0x28b3e1=>{const _0x378634=_0x5e85a2,_0x3cae21=await _0x28b3e1[_0x378634(0x1d8)][_0x378634(0x144)]({'where':{'id':_0x3d9736},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x3cae21)throw new Error(_0x378634(0x203));const _0x1d4d6f=_0x3cae21[_0x378634(0x154)],_0x292948=_0x1d8c6a[_0x378634(0x132)]();console[_0x378634(0x10e)]('ðŸ”„\x20Admin\x20updating\x20payment\x20'+_0x3d9736+_0x378634(0x210)+_0x1d4d6f+_0x378634(0x157)+_0x292948),console[_0x378634(0x10e)](_0x378634(0x18c)+_0x3cae21[_0x378634(0x11e)][_0x378634(0x20f)]+_0x378634(0x26a));const _0x148458={'status':_0x292948,'updatedAt':new Date(),'statusChangedBy':_0x378634(0x14c),'statusChangedAt':new Date()};_0x1aa96&&(_0x148458[_0x378634(0x1ea)]=_0x1aa96);_0x292948===_0x378634(0x1a7)&&_0x513f8f&&(_0x148458[_0x378634(0x1ce)]=_0x513f8f);let _0x32e27a=0x0,_0x5321d8=_0x3cae21[_0x378634(0x11e)][_0x378634(0x20f)];if(_0x292948==='PAID'&&_0x1d4d6f!=='PAID'){_0x148458['paidAt']=new Date();const _0xc30251=await currencyService_1[_0x378634(0x1cd)]['convertToUSDT'](_0x3cae21[_0x378634(0x226)],_0x3cae21[_0x378634(0x21f)]);_0x148458[_0x378634(0x195)]=_0xc30251;let _0x4647eb=0x2d;const _0x508503=await _0x28b3e1['shop']['findUnique']({'where':{'id':_0x3cae21[_0x378634(0x1dc)]},'select':{'gatewaySettings':!![]}});if(_0x508503?.[_0x378634(0x148)])try{const _0x35b998=JSON[_0x378634(0x255)](_0x508503[_0x378634(0x148)]);for(const [_0x26094e,_0x522425]of Object[_0x378634(0x182)](_0x35b998)){if(_0x26094e[_0x378634(0x112)]()===_0x3cae21[_0x378634(0x110)][_0x378634(0x112)]()){_0x4647eb=_0x522425['commission']||0xa;break;}}}catch(_0x569f37){console[_0x378634(0x1b9)](_0x378634(0x12c)+_0x3d9736+':',_0x569f37);}let _0x2cfdea;_0x3cae21[_0x378634(0x142)]!==null&&_0x3cae21[_0x378634(0x142)]!==undefined?(_0x2cfdea=_0x3cae21['amountAfterGatewayCommissionUSDT'],console[_0x378634(0x10e)]('ðŸ“Š\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20'+_0x2cfdea[_0x378634(0x239)](0x6)+_0x378634(0x168)+_0x3d9736)):(_0x2cfdea=_0xc30251*(0x1-_0x4647eb/0x64),console[_0x378634(0x10e)](_0x378634(0x140)+_0x3d9736+':\x20'+_0x4647eb+'%\x20from\x20'+_0xc30251[_0x378634(0x239)](0x6)+_0x378634(0x26a)),_0x148458['amountAfterGatewayCommissionUSDT']=_0x2cfdea,_0x148458['gatewayCommissionRate']=_0x4647eb),_0x32e27a=_0x2cfdea,_0x5321d8+=_0x2cfdea,console[_0x378634(0x10e)](_0x378634(0x16a)+_0x3d9736+_0x378634(0x165)),console[_0x378634(0x10e)](_0x378634(0x233)+_0xc30251[_0x378634(0x239)](0x6)+_0x378634(0x26a)),console[_0x378634(0x10e)](_0x378634(0x141)+_0x3cae21[_0x378634(0x110)]+_0x378634(0x24e)+_0x4647eb+'%'),console[_0x378634(0x10e)](_0x378634(0x1f4)+_0x2cfdea['toFixed'](0x6)+_0x378634(0x177)+_0x4647eb+_0x378634(0x23d)),console[_0x378634(0x10e)]('\x20\x20\x20Added\x20to\x20balance:\x20+'+_0x2cfdea[_0x378634(0x239)](0x6)+_0x378634(0x26a));}else{if(_0x1d4d6f===_0x378634(0x237)&&_0x292948!==_0x378634(0x237)&&_0x292948!=='CHARGEBACK'){if(_0x3cae21[_0x378634(0x195)]){let _0x3a9e7e=0x2d;const _0x40d0e4=await _0x28b3e1[_0x378634(0x11e)][_0x378634(0x144)]({'where':{'id':_0x3cae21[_0x378634(0x1dc)]},'select':{'gatewaySettings':!![]}});if(_0x40d0e4?.[_0x378634(0x148)])try{const _0x5b4dde=JSON['parse'](_0x40d0e4[_0x378634(0x148)]);for(const [_0x397573,_0x33966d]of Object['entries'](_0x5b4dde)){if(_0x397573[_0x378634(0x112)]()===_0x3cae21[_0x378634(0x110)][_0x378634(0x112)]()){_0x3a9e7e=_0x33966d['commission']||0xa;break;}}}catch(_0x4146d3){console[_0x378634(0x1b9)](_0x378634(0x12c)+_0x3d9736+':',_0x4146d3);}const _0x21b8fa=_0x3cae21[_0x378634(0x195)]*(0x1-_0x3a9e7e/0x64);_0x32e27a=-_0x21b8fa,_0x5321d8-=_0x21b8fa,console[_0x378634(0x10e)](_0x378634(0x233)+_0x3cae21[_0x378634(0x195)][_0x378634(0x239)](0x6)+_0x378634(0x26a)),console['log'](_0x378634(0x141)+_0x3cae21[_0x378634(0x110)]+',\x20Commission:\x20'+_0x3a9e7e+'%'),console[_0x378634(0x10e)](_0x378634(0x1f2)+_0x21b8fa[_0x378634(0x239)](0x6)+_0x378634(0x177)+_0x3a9e7e+_0x378634(0x23d)),console[_0x378634(0x10e)]('\x20\x20\x20Subtracted\x20from\x20balance:\x20-'+_0x21b8fa[_0x378634(0x239)](0x6)+_0x378634(0x26a));}}}_0x292948==='CHARGEBACK'&&(console[_0x378634(0x10e)](_0x378634(0x225)),_0x513f8f&&_0x513f8f>0x0?(_0x32e27a=-_0x513f8f,_0x5321d8-=_0x513f8f,console[_0x378634(0x10e)](_0x378634(0x1cf)+_0x513f8f[_0x378634(0x239)](0x6)+_0x378634(0x116)),console['log'](_0x378634(0x18b))):console['log'](_0x378634(0x118)),_0x148458['chargebackAmount']=_0x513f8f||0x0);_0x292948==='REFUND'&&_0x1d4d6f===_0x378634(0x237)&&console[_0x378634(0x10e)](_0x378634(0x1ae));const _0x1357f0=await _0x28b3e1[_0x378634(0x1d8)]['update']({'where':{'id':_0x3d9736},'data':_0x148458,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x32e27a!==0x0&&(await _0x28b3e1[_0x378634(0x11e)]['update']({'where':{'id':_0x3cae21['shopId']},'data':{'balance':_0x5321d8}}),console[_0x378634(0x10e)](_0x378634(0x1de)+_0x3cae21['shopId']+_0x378634(0x18f)+_0x3cae21[_0x378634(0x11e)][_0x378634(0x20f)][_0x378634(0x239)](0x6)+'\x20->\x20'+_0x5321d8[_0x378634(0x239)](0x6)+'\x20USDT\x20('+(_0x32e27a>0x0?'+':'')+_0x32e27a[_0x378634(0x239)](0x6)+')')),_0x1357f0;});return{'id':_0x301e91['id'],'shopId':_0x301e91[_0x5e85a2(0x1dc)],'gateway':_0x301e91[_0x5e85a2(0x110)],'amount':_0x301e91['amount'],'currency':_0x301e91[_0x5e85a2(0x21f)],'status':_0x301e91[_0x5e85a2(0x154)],'orderId':_0x301e91[_0x5e85a2(0x1c7)],'gatewayOrderId':_0x301e91[_0x5e85a2(0x257)],'customerEmail':_0x301e91[_0x5e85a2(0x193)],'customerName':_0x301e91[_0x5e85a2(0x1d1)],'customerCountry':_0x301e91['customerCountry'],'customerIp':_0x301e91[_0x5e85a2(0x1f3)],'customerUa':_0x301e91['customerUa'],'failureMessage':_0x301e91[_0x5e85a2(0x13b)],'adminNotes':_0x301e91[_0x5e85a2(0x1ea)],'chargebackAmount':_0x301e91[_0x5e85a2(0x1ce)],'statusChangedBy':_0x301e91[_0x5e85a2(0x1c0)],'statusChangedAt':_0x301e91[_0x5e85a2(0x1c3)],'createdAt':_0x301e91[_0x5e85a2(0x241)],'updatedAt':_0x301e91[_0x5e85a2(0x12b)],'shop':_0x301e91[_0x5e85a2(0x11e)]};}async[a46_0x5060ae(0x11a)](_0x218ae8,_0x539d11){const _0x4ddac0=a46_0x5060ae,_0x33af9f=Math['random']()[_0x4ddac0(0x14f)](0x24)[_0x4ddac0(0x15c)](0x2,0x9);console[_0x4ddac0(0x10e)](_0x4ddac0(0x173)+_0x33af9f+',\x20userId:\x20'+_0x218ae8);const _0x4c613a={..._0x539d11};_0x539d11['password']&&_0x539d11[_0x4ddac0(0x1f8)][_0x4ddac0(0x25c)]()!==''?(console['log'](_0x4ddac0(0x188)+_0x33af9f+_0x4ddac0(0x18e)+_0x218ae8),_0x4c613a[_0x4ddac0(0x1f8)]=await bcryptjs_1[_0x4ddac0(0x1da)][_0x4ddac0(0x263)](_0x539d11[_0x4ddac0(0x1f8)],0xc)):(console[_0x4ddac0(0x10e)](_0x4ddac0(0x188)+_0x33af9f+']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update'),delete _0x4c613a[_0x4ddac0(0x1f8)]);_0x539d11['fullName']&&(_0x4c613a[_0x4ddac0(0x191)]=_0x539d11[_0x4ddac0(0x20e)],delete _0x4c613a[_0x4ddac0(0x20e)]);_0x539d11['telegramId']&&(_0x4c613a[_0x4ddac0(0x22d)]=_0x539d11[_0x4ddac0(0x204)],delete _0x4c613a[_0x4ddac0(0x204)]);_0x539d11[_0x4ddac0(0x21a)]&&(_0x4c613a[_0x4ddac0(0x114)]=_0x539d11[_0x4ddac0(0x21a)],delete _0x4c613a[_0x4ddac0(0x21a)]);if(_0x539d11[_0x4ddac0(0x223)]){const _0x40fe16=_0x539d11[_0x4ddac0(0x223)][_0x4ddac0(0x1a9)](_0x446da2=>this[_0x4ddac0(0x1ee)](_0x446da2));console[_0x4ddac0(0x10e)](_0x4ddac0(0x206),_0x539d11[_0x4ddac0(0x223)],'->',_0x40fe16),_0x4c613a[_0x4ddac0(0x184)]=JSON[_0x4ddac0(0x1ab)](_0x40fe16),delete _0x4c613a[_0x4ddac0(0x223)];}_0x539d11[_0x4ddac0(0x148)]&&(console[_0x4ddac0(0x10e)](_0x4ddac0(0x178)+_0x33af9f+']\x20Gateway\x20settings\x20before\x20saving:',_0x539d11['gatewaySettings']),_0x4c613a[_0x4ddac0(0x148)]=JSON[_0x4ddac0(0x1ab)](_0x539d11[_0x4ddac0(0x148)]),console[_0x4ddac0(0x10e)](_0x4ddac0(0x178)+_0x33af9f+_0x4ddac0(0x150),_0x4c613a[_0x4ddac0(0x148)]));_0x539d11[_0x4ddac0(0x199)]&&(_0x539d11[_0x4ddac0(0x199)][_0x4ddac0(0x24f)]!==undefined&&(_0x4c613a[_0x4ddac0(0x24f)]=_0x539d11[_0x4ddac0(0x199)]['usdtPolygonWallet']||null),_0x539d11[_0x4ddac0(0x199)][_0x4ddac0(0x23a)]!==undefined&&(_0x4c613a[_0x4ddac0(0x23a)]=_0x539d11[_0x4ddac0(0x199)][_0x4ddac0(0x23a)]||null),_0x539d11[_0x4ddac0(0x199)][_0x4ddac0(0x262)]!==undefined&&(_0x4c613a['usdtErcWallet']=_0x539d11[_0x4ddac0(0x199)][_0x4ddac0(0x262)]||null),_0x539d11[_0x4ddac0(0x199)][_0x4ddac0(0x16f)]!==undefined&&(_0x4c613a['usdcPolygonWallet']=_0x539d11['wallets'][_0x4ddac0(0x16f)]||null),delete _0x4c613a[_0x4ddac0(0x199)]);const _0x4a5bed=await database_1[_0x4ddac0(0x1da)][_0x4ddac0(0x11e)][_0x4ddac0(0x217)]({'where':{'id':_0x218ae8},'data':_0x4c613a,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0x4ddac0(0x10e)](_0x4ddac0(0x1d3)+_0x33af9f+']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:',_0x4a5bed[_0x4ddac0(0x148)]),{'id':_0x4a5bed['id'],'fullName':_0x4a5bed[_0x4ddac0(0x191)],'username':_0x4a5bed[_0x4ddac0(0x17c)],'telegramId':_0x4a5bed[_0x4ddac0(0x22d)],'merchantUrl':_0x4a5bed[_0x4ddac0(0x114)],'gateways':_0x4a5bed[_0x4ddac0(0x184)]?JSON['parse'](_0x4a5bed['paymentGateways']):null,'gatewaySettings':_0x4a5bed[_0x4ddac0(0x148)]?JSON['parse'](_0x4a5bed[_0x4ddac0(0x148)]):null,'publicKey':_0x4a5bed[_0x4ddac0(0x13f)],'wallets':{'usdtPolygonWallet':_0x4a5bed[_0x4ddac0(0x24f)],'usdtTrcWallet':_0x4a5bed[_0x4ddac0(0x23a)],'usdtErcWallet':_0x4a5bed[_0x4ddac0(0x262)],'usdcPolygonWallet':_0x4a5bed[_0x4ddac0(0x16f)]},'status':_0x4a5bed[_0x4ddac0(0x154)],'createdAt':_0x4a5bed[_0x4ddac0(0x241)]};}async[a46_0x5060ae(0x24a)](_0x3cf0e8){const _0x516d20=a46_0x5060ae,_0x4f8931=await database_1[_0x516d20(0x1da)][_0x516d20(0x11e)]['update']({'where':{'id':_0x3cf0e8},'data':{'status':'SUSPENDED'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4f8931['id'],'fullName':_0x4f8931[_0x516d20(0x191)],'username':_0x4f8931[_0x516d20(0x17c)],'telegramId':_0x4f8931[_0x516d20(0x22d)],'merchantUrl':_0x4f8931['shopUrl'],'gateways':_0x4f8931[_0x516d20(0x184)]?JSON[_0x516d20(0x255)](_0x4f8931[_0x516d20(0x184)]):null,'gatewaySettings':_0x4f8931[_0x516d20(0x148)]?JSON['parse'](_0x4f8931['gatewaySettings']):null,'publicKey':_0x4f8931[_0x516d20(0x13f)],'wallets':{'usdtPolygonWallet':_0x4f8931[_0x516d20(0x24f)],'usdtTrcWallet':_0x4f8931['usdtTrcWallet'],'usdtErcWallet':_0x4f8931[_0x516d20(0x262)],'usdcPolygonWallet':_0x4f8931[_0x516d20(0x16f)]},'status':_0x4f8931[_0x516d20(0x154)],'createdAt':_0x4f8931[_0x516d20(0x241)]};}async[a46_0x5060ae(0x227)](_0x440aa2){const _0x2a6add=a46_0x5060ae,_0x26d91a=await database_1['default'][_0x2a6add(0x11e)][_0x2a6add(0x217)]({'where':{'id':_0x440aa2},'data':{'status':_0x2a6add(0x16d)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x26d91a['id'],'fullName':_0x26d91a[_0x2a6add(0x191)],'username':_0x26d91a[_0x2a6add(0x17c)],'telegramId':_0x26d91a['telegram'],'merchantUrl':_0x26d91a['shopUrl'],'gateways':_0x26d91a[_0x2a6add(0x184)]?JSON['parse'](_0x26d91a[_0x2a6add(0x184)]):null,'gatewaySettings':_0x26d91a[_0x2a6add(0x148)]?JSON[_0x2a6add(0x255)](_0x26d91a[_0x2a6add(0x148)]):null,'publicKey':_0x26d91a['publicKey'],'wallets':{'usdtPolygonWallet':_0x26d91a[_0x2a6add(0x24f)],'usdtTrcWallet':_0x26d91a[_0x2a6add(0x23a)],'usdtErcWallet':_0x26d91a['usdtErcWallet'],'usdcPolygonWallet':_0x26d91a[_0x2a6add(0x16f)]},'status':_0x26d91a[_0x2a6add(0x154)],'createdAt':_0x26d91a[_0x2a6add(0x241)]};}async['getAllUsers'](_0x32a510){const _0xd26eba=a46_0x5060ae,{page:_0x56f088,limit:_0x3f0368,status:_0x31a2ab}=_0x32a510,_0x1cf036=(_0x56f088-0x1)*_0x3f0368,_0x465a1c={};_0x31a2ab&&(_0x465a1c['status']=_0x31a2ab[_0xd26eba(0x132)]());const [_0x4bd84d,_0x3827d4]=await Promise[_0xd26eba(0x104)]([database_1[_0xd26eba(0x1da)][_0xd26eba(0x11e)]['findMany']({'where':_0x465a1c,'skip':_0x1cf036,'take':_0x3f0368,'orderBy':{'createdAt':_0xd26eba(0x187)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0xd26eba(0x1da)][_0xd26eba(0x11e)][_0xd26eba(0x153)]({'where':_0x465a1c})]);return{'users':_0x4bd84d[_0xd26eba(0x1a9)](_0x12ffd=>{const _0x4b99ea=_0xd26eba,_0x51e5fc=_0x12ffd[_0x4b99ea(0x184)]?JSON[_0x4b99ea(0x255)](_0x12ffd[_0x4b99ea(0x184)]):null,_0x22050c=_0x51e5fc?_0x51e5fc[_0x4b99ea(0x1a9)](_0x490c45=>this[_0x4b99ea(0x1df)](_0x490c45)):null;return{'id':_0x12ffd['id'],'fullName':_0x12ffd[_0x4b99ea(0x191)],'username':_0x12ffd['username'],'telegramId':_0x12ffd['telegram'],'merchantUrl':_0x12ffd[_0x4b99ea(0x114)],'gateways':_0x22050c,'gatewaySettings':_0x12ffd[_0x4b99ea(0x148)]?JSON['parse'](_0x12ffd[_0x4b99ea(0x148)]):null,'publicKey':_0x12ffd[_0x4b99ea(0x13f)],'wallets':{'usdtPolygonWallet':_0x12ffd[_0x4b99ea(0x24f)],'usdtTrcWallet':_0x12ffd[_0x4b99ea(0x23a)],'usdtErcWallet':_0x12ffd[_0x4b99ea(0x262)],'usdcPolygonWallet':_0x12ffd[_0x4b99ea(0x16f)]},'status':_0x12ffd[_0x4b99ea(0x154)],'createdAt':_0x12ffd[_0x4b99ea(0x241)]};}),'pagination':{'page':_0x56f088,'limit':_0x3f0368,'total':_0x3827d4,'totalPages':Math[_0xd26eba(0x1eb)](_0x3827d4/_0x3f0368)}};}async[a46_0x5060ae(0x214)](_0x3ec5c5){const _0x424a74=a46_0x5060ae,_0x4222ab=await database_1['default'][_0x424a74(0x11e)]['findUnique']({'where':{'id':_0x3ec5c5},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x4222ab)return null;const _0x100a64=_0x4222ab['paymentGateways']?JSON['parse'](_0x4222ab[_0x424a74(0x184)]):null,_0x599e9d=_0x100a64?_0x100a64[_0x424a74(0x1a9)](_0xea1949=>this[_0x424a74(0x1df)](_0xea1949)):null;return _0x100a64&&_0x599e9d&&console[_0x424a74(0x10e)](_0x424a74(0x1d6),_0x100a64,'->',_0x599e9d),{'id':_0x4222ab['id'],'fullName':_0x4222ab['name'],'username':_0x4222ab[_0x424a74(0x17c)],'telegramId':_0x4222ab[_0x424a74(0x22d)],'merchantUrl':_0x4222ab[_0x424a74(0x114)],'gateways':_0x599e9d,'gatewaySettings':_0x4222ab[_0x424a74(0x148)]?JSON[_0x424a74(0x255)](_0x4222ab[_0x424a74(0x148)]):null,'publicKey':_0x4222ab[_0x424a74(0x13f)],'wallets':{'usdtPolygonWallet':_0x4222ab[_0x424a74(0x24f)],'usdtTrcWallet':_0x4222ab['usdtTrcWallet'],'usdtErcWallet':_0x4222ab[_0x424a74(0x262)],'usdcPolygonWallet':_0x4222ab['usdcPolygonWallet']},'status':_0x4222ab['status'],'createdAt':_0x4222ab[_0x424a74(0x241)]};}async[a46_0x5060ae(0x161)](_0x207783){const _0x5a43da=a46_0x5060ae,{fullName:_0x22a7aa,username:_0x3f0f0e,password:_0x4d1630,telegramId:_0x235452,merchantUrl:_0x4d96e4,gateways:_0x1056b9,gatewaySettings:_0x1138f3,wallets:_0x35973c}=_0x207783,_0x2ba752=await database_1['default'][_0x5a43da(0x11e)][_0x5a43da(0x144)]({'where':{'username':_0x3f0f0e}});if(_0x2ba752)throw new Error(_0x5a43da(0x261));if(_0x235452){const _0x32efe7=await database_1[_0x5a43da(0x1da)][_0x5a43da(0x11e)][_0x5a43da(0x144)]({'where':{'telegram':_0x235452}});if(_0x32efe7)throw new Error(_0x5a43da(0x246));}const _0x1a7e83=await bcryptjs_1[_0x5a43da(0x1da)]['hash'](_0x4d1630,0xc),_0x223e23=_0x5a43da(0x100)+crypto_1[_0x5a43da(0x1da)]['randomBytes'](0x20)[_0x5a43da(0x14f)](_0x5a43da(0x155)),_0x2b092d=_0x5a43da(0x25d)+crypto_1['default']['randomBytes'](0x20)[_0x5a43da(0x14f)](_0x5a43da(0x155)),_0xa59dfd=_0x1056b9?_0x1056b9[_0x5a43da(0x1a9)](_0xc52b18=>this['getGatewayInternalName'](_0xc52b18)):null;_0x1056b9&&_0xa59dfd&&console['log']('ðŸ”„\x20Gateway\x20mapping\x20(create):',_0x1056b9,'->',_0xa59dfd);const _0x42f36e=await database_1[_0x5a43da(0x1da)][_0x5a43da(0x11e)][_0x5a43da(0x260)]({'data':{'name':_0x22a7aa,'username':_0x3f0f0e,'password':_0x1a7e83,'telegram':_0x235452,'shopUrl':_0x4d96e4,'paymentGateways':_0xa59dfd?JSON[_0x5a43da(0x1ab)](_0xa59dfd):null,'gatewaySettings':_0x1138f3?JSON[_0x5a43da(0x1ab)](_0x1138f3):null,'usdtPolygonWallet':_0x35973c?.[_0x5a43da(0x24f)]||null,'usdtTrcWallet':_0x35973c?.['usdtTrcWallet']||null,'usdtErcWallet':_0x35973c?.[_0x5a43da(0x262)]||null,'usdcPolygonWallet':_0x35973c?.[_0x5a43da(0x16f)]||null,'publicKey':_0x223e23,'secretKey':_0x2b092d,'status':_0x5a43da(0x16d)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x42f36e['id'],'fullName':_0x42f36e[_0x5a43da(0x191)],'username':_0x42f36e['username'],'telegramId':_0x42f36e[_0x5a43da(0x22d)],'merchantUrl':_0x42f36e[_0x5a43da(0x114)],'gateways':_0x42f36e['paymentGateways']?JSON['parse'](_0x42f36e[_0x5a43da(0x184)]):null,'gatewaySettings':_0x42f36e['gatewaySettings']?JSON[_0x5a43da(0x255)](_0x42f36e[_0x5a43da(0x148)]):null,'publicKey':_0x42f36e[_0x5a43da(0x13f)],'wallets':{'usdtPolygonWallet':_0x42f36e[_0x5a43da(0x24f)],'usdtTrcWallet':_0x42f36e[_0x5a43da(0x23a)],'usdtErcWallet':_0x42f36e[_0x5a43da(0x262)],'usdcPolygonWallet':_0x42f36e[_0x5a43da(0x16f)]},'status':_0x42f36e[_0x5a43da(0x154)],'createdAt':_0x42f36e[_0x5a43da(0x241)]};}async[a46_0x5060ae(0x1b7)](_0x2037ee){const _0x1e960d=a46_0x5060ae;await database_1[_0x1e960d(0x1da)][_0x1e960d(0x11e)]['delete']({'where':{'id':_0x2037ee}});}['generateDailyStatistics'](_0x22f29f,_0x51c266,_0x5167ad){const _0x4f5cd6=a46_0x5060ae,_0x4be2c8=new Map(),_0x2ae77d=new Date(_0x51c266);while(_0x2ae77d<=_0x5167ad){const _0x3381ed=_0x2ae77d[_0x4f5cd6(0x1fc)]()[_0x4f5cd6(0x22c)]('T')[0x0];_0x4be2c8[_0x4f5cd6(0x145)](_0x3381ed,{'revenue':0x0,'count':0x0}),_0x2ae77d[_0x4f5cd6(0x194)](_0x2ae77d['getDate']()+0x1);}for(const _0x4084a2 of _0x22f29f){const _0x5f26df=_0x4084a2[_0x4f5cd6(0x241)][_0x4f5cd6(0x1fc)]()[_0x4f5cd6(0x22c)]('T')[0x0],_0x3dfc1d=_0x4be2c8['get'](_0x5f26df);_0x3dfc1d&&(_0x3dfc1d[_0x4f5cd6(0x153)]+=0x1,_0x4084a2[_0x4f5cd6(0x154)]===_0x4f5cd6(0x237)&&(_0x4084a2[_0x4f5cd6(0x195)]?_0x3dfc1d[_0x4f5cd6(0x25e)]+=_0x4084a2['amountUSDT']:console[_0x4f5cd6(0x10e)](_0x4f5cd6(0x19b)+_0x4084a2['id']+_0x4f5cd6(0x235))));}const _0xa4a7aa=[],_0x28f3e1=[];for(const [_0x4c4e12,_0x407e10]of _0x4be2c8){_0xa4a7aa[_0x4f5cd6(0x138)]({'date':_0x4c4e12,'amount':Math[_0x4f5cd6(0x129)](_0x407e10[_0x4f5cd6(0x25e)]*0x64)/0x64}),_0x28f3e1[_0x4f5cd6(0x138)]({'date':_0x4c4e12,'count':_0x407e10[_0x4f5cd6(0x153)]});}return{'dailyRevenue':_0xa4a7aa,'dailyPayments':_0x28f3e1};}}exports[a46_0x5060ae(0x1f5)]=AdminService;