'use strict';const a38_0x4a5945=a38_0x4979;(function(_0x41784a,_0x13aed1){const _0x2469c3=a38_0x4979,_0x347922=_0x41784a();while(!![]){try{const _0x483428=-parseInt(_0x2469c3(0x126))/0x1+-parseInt(_0x2469c3(0xf7))/0x2+parseInt(_0x2469c3(0x179))/0x3*(-parseInt(_0x2469c3(0x120))/0x4)+-parseInt(_0x2469c3(0x1b8))/0x5+parseInt(_0x2469c3(0x114))/0x6+parseInt(_0x2469c3(0xf1))/0x7+-parseInt(_0x2469c3(0xcb))/0x8*(-parseInt(_0x2469c3(0xc5))/0x9);if(_0x483428===_0x13aed1)break;else _0x347922['push'](_0x347922['shift']());}catch(_0x4d4205){_0x347922['push'](_0x347922['shift']());}}}(a38_0x394b,0xe7bc9));var __importDefault=this&&this[a38_0x4a5945(0x129)]||function(_0x11f7d1){const _0x14829f=a38_0x4a5945;return _0x11f7d1&&_0x11f7d1[_0x14829f(0xae)]?_0x11f7d1:{'default':_0x11f7d1};};function a38_0x4979(_0x2f5859,_0x1fbf57){const _0x394be9=a38_0x394b();return a38_0x4979=function(_0x49794e,_0x4b0278){_0x49794e=_0x49794e-0x9e;let _0x35c573=_0x394be9[_0x49794e];return _0x35c573;},a38_0x4979(_0x2f5859,_0x1fbf57);}Object['defineProperty'](exports,a38_0x4a5945(0xae),{'value':!![]}),exports[a38_0x4a5945(0x10e)]=void 0x0;const database_1=__importDefault(require('../config/database')),bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a38_0x4a5945(0xf4))),currencyService_1=require(a38_0x4a5945(0x1e3)),gateway_1=require(a38_0x4a5945(0x110));class AdminService{async[a38_0x4a5945(0x1e7)](){const _0x1d6be4=a38_0x4a5945;console['log'](_0x1d6be4(0x11d));const _0x54f45e=await database_1[_0x1d6be4(0x105)][_0x1d6be4(0xa1)]['aggregate']({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':'ACTIVE'}}),_0x284970=await database_1[_0x1d6be4(0x105)]['payment']['count']({'where':{'status':'PAID','gateway':{'not':_0x1d6be4(0xce)}}}),_0x3b1d1=new Date(),_0x51c541=new Date(_0x3b1d1[_0x1d6be4(0xd6)](),_0x3b1d1['getMonth'](),0x1),_0x16ca86=new Date(_0x3b1d1[_0x1d6be4(0xd6)](),_0x3b1d1['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0xd1c6e6=await database_1[_0x1d6be4(0x105)][_0x1d6be4(0x9e)][_0x1d6be4(0x131)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x51c541,'lte':_0x16ca86},'status':_0x1d6be4(0x199)}}),_0x5679a4=_0x54f45e[_0x1d6be4(0x12e)]['totalPaidOut']||0x0,_0x438b3a=_0x54f45e[_0x1d6be4(0x12e)]['balance']||0x0,_0x14f4cb=_0xd1c6e6['_sum'][_0x1d6be4(0x1ac)]||0x0,_0x39f840={'totalPayout':Math[_0x1d6be4(0x139)](_0x5679a4*0x64)/0x64,'awaitingPayout':Math[_0x1d6be4(0x139)](_0x438b3a*0x64)/0x64,'thisMonth':Math[_0x1d6be4(0x139)](_0x14f4cb*0x64)/0x64,'availableBalance':Math[_0x1d6be4(0x139)](_0x438b3a*0x64)/0x64,'totalPayments':_0x284970};return console['log']('📊\x20Payout\x20statistics\x20calculated:'),console[_0x1d6be4(0x143)](_0x1d6be4(0x123)+_0x39f840[_0x1d6be4(0x172)]+_0x1d6be4(0x136)),console[_0x1d6be4(0x143)](_0x1d6be4(0x186)+_0x39f840[_0x1d6be4(0x165)]+'\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)'),console[_0x1d6be4(0x143)]('\x20\x20\x20💵\x20Available\x20balance:\x20'+_0x39f840['availableBalance']+_0x1d6be4(0x1bb)),console[_0x1d6be4(0x143)](_0x1d6be4(0x1cd)+_0x39f840[_0x1d6be4(0x1a1)]+_0x1d6be4(0x13a)),console['log'](_0x1d6be4(0xef)+_0x39f840['totalPayments']+_0x1d6be4(0xd5)),_0x39f840;}async['updateCustomerData'](_0x336fac,_0x4d3183){const _0x220429=a38_0x4a5945;console['log'](_0x220429(0x12d)+_0x336fac+':',_0x4d3183);const _0x31a45c=await database_1[_0x220429(0x105)][_0x220429(0x10b)][_0x220429(0x1de)]({'where':{'id':_0x336fac},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x31a45c)throw new Error(_0x220429(0x14a));const _0x5a58af={};_0x4d3183[_0x220429(0x1b7)]!==undefined&&(_0x5a58af[_0x220429(0x1b7)]=_0x4d3183['customerCountry']||null);_0x4d3183[_0x220429(0x1cb)]!==undefined&&(_0x5a58af['customerIp']=_0x4d3183[_0x220429(0x1cb)]||null);_0x4d3183['customerUa']!==undefined&&(_0x5a58af[_0x220429(0xc4)]=_0x4d3183['customerUa']||null);const _0x556617=await database_1[_0x220429(0x105)][_0x220429(0x10b)][_0x220429(0x1cf)]({'where':{'id':_0x336fac},'data':{..._0x5a58af,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x220429(0x143)](_0x220429(0xed)+_0x336fac),console[_0x220429(0x143)](_0x220429(0x1a0)+_0x31a45c[_0x220429(0x1b7)]+_0x220429(0x174)+_0x556617['customerCountry']),console[_0x220429(0x143)]('\x20\x20\x20🌐\x20IP:\x20'+_0x31a45c[_0x220429(0x1cb)]+_0x220429(0x174)+_0x556617['customerIp']),console[_0x220429(0x143)](_0x220429(0x146)+(_0x31a45c['customerUa']?_0x220429(0x19c):_0x220429(0x1cc))+_0x220429(0x174)+(_0x556617['customerUa']?_0x220429(0x19c):'not\x20set')),_0x556617;}async['getSystemStatistics'](_0x124e17){const _0x4045b7=a38_0x4a5945,_0x5c23f3=new Date();let _0x2b60c7;switch(_0x124e17[_0x4045b7(0x181)]()){case _0x4045b7(0x138):_0x2b60c7=new Date(_0x5c23f3['getFullYear'](),_0x5c23f3[_0x4045b7(0x1dc)](),_0x5c23f3[_0x4045b7(0xe2)](),0x0,0x0,0x0,0x0);break;case'yesterday':const _0x293f0f=new Date(_0x5c23f3);_0x293f0f['setDate'](_0x293f0f[_0x4045b7(0xe2)]()-0x1),_0x2b60c7=new Date(_0x293f0f[_0x4045b7(0xd6)](),_0x293f0f[_0x4045b7(0x1dc)](),_0x293f0f['getDate'](),0x0,0x0,0x0,0x0);break;case'7d':_0x2b60c7=new Date(_0x5c23f3[_0x4045b7(0x1e0)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x4045b7(0x1c6):_0x2b60c7=new Date(_0x5c23f3[_0x4045b7(0x1e0)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x4045b7(0x18f):_0x2b60c7=new Date(_0x5c23f3[_0x4045b7(0x1e0)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x4045b7(0x19e):const _0x2b03c0=await database_1[_0x4045b7(0x105)][_0x4045b7(0x10b)][_0x4045b7(0x1e9)]({'where':{'gateway':{'not':_0x4045b7(0xce)}},'orderBy':{'createdAt':_0x4045b7(0x1b6)},'select':{'createdAt':!![]}});_0x2b60c7=_0x2b03c0?_0x2b03c0[_0x4045b7(0xd0)]:new Date(_0x4045b7(0x118));break;default:_0x2b60c7=new Date(_0x5c23f3['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}_0x2b60c7[_0x4045b7(0xc7)](0x0,0x0,0x0,0x0);let _0x196b7a;if(_0x124e17['toLowerCase']()===_0x4045b7(0x19b)){const _0x5d77fc=new Date(_0x5c23f3);_0x5d77fc[_0x4045b7(0x164)](_0x5d77fc['getDate']()-0x1),_0x196b7a=new Date(_0x5d77fc[_0x4045b7(0xd6)](),_0x5d77fc[_0x4045b7(0x1dc)](),_0x5d77fc[_0x4045b7(0xe2)](),0x17,0x3b,0x3b,0x3e7);}const _0xb6b7d7={'gte':_0x2b60c7};_0x196b7a&&(_0xb6b7d7[_0x4045b7(0xbb)]=_0x196b7a);const [_0x3debee,_0x12bd6d,_0x5d9340,_0x11bad7,_0x59ea6e,_0x3243c5]=await Promise[_0x4045b7(0x19e)]([database_1[_0x4045b7(0x105)]['shop'][_0x4045b7(0x13e)](),database_1[_0x4045b7(0x105)][_0x4045b7(0xa1)][_0x4045b7(0x13e)]({'where':{'status':_0x4045b7(0xe5)}}),database_1[_0x4045b7(0x105)][_0x4045b7(0x10b)][_0x4045b7(0x13e)]({'where':{'status':'PAID','createdAt':_0xb6b7d7,'gateway':{'not':_0x4045b7(0xce)}}}),database_1[_0x4045b7(0x105)]['payment'][_0x4045b7(0x1d8)]({'where':{'status':_0x4045b7(0x16f),'createdAt':_0xb6b7d7,'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x4045b7(0x105)][_0x4045b7(0x10b)][_0x4045b7(0x1d8)]({'where':{'gateway':{'not':_0x4045b7(0xce)}},'take':0xa,'orderBy':{'createdAt':_0x4045b7(0xe1)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x4045b7(0x105)][_0x4045b7(0x10b)][_0x4045b7(0x1d8)]({'where':{'createdAt':_0xb6b7d7,'gateway':{'not':_0x4045b7(0xce)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x48dd43=0x0,_0x77705=0x0;for(const _0x30e541 of _0x11bad7){const _0x3c4708=await currencyService_1['currencyService'][_0x4045b7(0x15a)](_0x30e541[_0x4045b7(0x1ac)],_0x30e541[_0x4045b7(0xb6)]);_0x48dd43+=_0x3c4708;if(_0x30e541['amountAfterGatewayCommissionUSDT']){const _0x24afdc=await currencyService_1['currencyService']['convertToUSDT'](_0x30e541[_0x4045b7(0x1ac)],_0x30e541[_0x4045b7(0xb6)]),_0x47bc19=_0x30e541[_0x4045b7(0x149)],_0x53ae01=_0x24afdc-_0x47bc19;_0x77705+=_0x53ae01;}}const _0x212617=_0x5d9340>0x0?_0x48dd43/_0x5d9340:0x0,_0x230ae2=this[_0x4045b7(0x9f)](_0x3243c5,_0x2b60c7,_0x196b7a||_0x5c23f3),_0x1acee2=await database_1[_0x4045b7(0x105)]['payment'][_0x4045b7(0x13e)]({'where':{'createdAt':_0xb6b7d7,'gateway':{'not':_0x4045b7(0xce)}}}),_0x4dd51f=_0x1acee2>0x0?_0x5d9340/_0x1acee2*0x64:0x0;return{'totalShops':_0x3debee,'activeShops':_0x12bd6d,'totalPayments':_0x5d9340,'successfulPayments':_0x5d9340,'totalAttempts':_0x1acee2,'totalRevenue':Math[_0x4045b7(0x139)](_0x48dd43*0x64)/0x64,'trapayEarnings':Math[_0x4045b7(0x139)](_0x77705*0x64)/0x64,'averagePaymentAmount':Math[_0x4045b7(0x139)](_0x212617*0x64)/0x64,'conversionRate':Math[_0x4045b7(0x139)](_0x4dd51f*0x64)/0x64,'dailyRevenue':_0x230ae2['dailyRevenue'],'dailyPayments':_0x230ae2[_0x4045b7(0x103)],'recentPayments':_0x59ea6e[_0x4045b7(0x1c1)](_0x4cb2eb=>({'id':_0x4cb2eb['id'],'amount':_0x4cb2eb[_0x4045b7(0x1ac)],'currency':_0x4cb2eb['currency'],'status':_0x4cb2eb['status'],'gateway':_0x4cb2eb['gateway'],'shop':_0x4cb2eb[_0x4045b7(0xa1)],'createdAt':_0x4cb2eb['createdAt']}))};}async[a38_0x4a5945(0x11c)](_0x247167){const _0x3d93e7=a38_0x4a5945;console[_0x3d93e7(0x143)]('📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:',_0x247167);let _0x28bbf4,_0x4467b3=new Date();if(_0x247167[_0x3d93e7(0x112)]===_0x3d93e7(0x15c)&&_0x247167[_0x3d93e7(0x107)]&&_0x247167[_0x3d93e7(0x10d)])_0x28bbf4=new Date(_0x247167['dateFrom']),_0x4467b3=new Date(_0x247167[_0x3d93e7(0x10d)]),_0x28bbf4['setHours'](0x0,0x0,0x0,0x0),_0x4467b3[_0x3d93e7(0xc7)](0x17,0x3b,0x3b,0x3e7);else{const _0x492b20=new Date();switch(_0x247167[_0x3d93e7(0x112)]){case _0x3d93e7(0x1ca):_0x28bbf4=new Date(_0x492b20[_0x3d93e7(0x1e0)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'month':_0x28bbf4=new Date(_0x492b20['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x3d93e7(0xe0):_0x28bbf4=new Date(_0x492b20[_0x3d93e7(0x1e0)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case'all':default:_0x28bbf4=new Date(_0x3d93e7(0x118));break;}_0x28bbf4['setHours'](0x0,0x0,0x0,0x0),_0x4467b3['setHours'](0x17,0x3b,0x3b,0x3e7);}console[_0x3d93e7(0x143)](_0x3d93e7(0x115)+_0x28bbf4[_0x3d93e7(0x1d7)]()+_0x3d93e7(0x177)+_0x4467b3['toISOString']());const _0x5ceab1={'status':'PAID','gateway':{'not':'test_gateway'},'paidAt':{'gte':_0x28bbf4,'lte':_0x4467b3}};_0x247167['shopId']&&(_0x5ceab1[_0x3d93e7(0xe7)]=_0x247167[_0x3d93e7(0xe7)]);const _0x56ef0e=await database_1[_0x3d93e7(0x105)][_0x3d93e7(0x10b)]['findMany']({'where':_0x5ceab1,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x3d93e7(0x143)](_0x3d93e7(0x15f)+_0x56ef0e[_0x3d93e7(0x15d)]+_0x3d93e7(0xf0));const _0x3c6b86={'gateway':{'not':'test_gateway'},'createdAt':{'gte':_0x28bbf4,'lte':_0x4467b3}};_0x247167[_0x3d93e7(0xe7)]&&(_0x3c6b86[_0x3d93e7(0xe7)]=_0x247167['shopId']);const _0x436b08=await database_1[_0x3d93e7(0x105)]['payment'][_0x3d93e7(0x13e)]({'where':_0x3c6b86});console[_0x3d93e7(0x143)](_0x3d93e7(0x121)+_0x436b08+_0x3d93e7(0x134)+_0x56ef0e[_0x3d93e7(0x15d)]);let _0x18b53b=0x0,_0x467651=0x0,_0x5e4cbc=0x0;const _0xfe91b={},_0x5b5e5c={},_0x41c1f1={};for(const _0x3b4b20 of _0x56ef0e){try{const _0x399270=_0x3b4b20[_0x3d93e7(0xa3)]||0x0;if(_0x399270<=0x0){console[_0x3d93e7(0x1d2)](_0x3d93e7(0xaa)+_0x3b4b20['id']+_0x3d93e7(0xd9));continue;}let _0xc9caeb,_0x1cd206;if(_0x3b4b20[_0x3d93e7(0x149)]!==null&&_0x3b4b20['amountAfterGatewayCommissionUSDT']!==undefined)_0xc9caeb=_0x3b4b20[_0x3d93e7(0x149)],_0x1cd206=_0x399270-_0xc9caeb,console[_0x3d93e7(0x143)](_0x3d93e7(0x1b2)+_0x3b4b20['id']+':\x20'+_0x399270[_0x3d93e7(0x1c3)](0x6)+_0x3d93e7(0x173)+_0xc9caeb['toFixed'](0x6)+'\x20USDT');else{let _0x67b230={};if(_0x3b4b20[_0x3d93e7(0xa1)]['gatewaySettings'])try{_0x67b230=JSON[_0x3d93e7(0xb8)](_0x3b4b20[_0x3d93e7(0xa1)]['gatewaySettings']);}catch(_0x41a770){console['error'](_0x3d93e7(0x1a2)+_0x3b4b20[_0x3d93e7(0xe7)]+':',_0x41a770);}let _0x543dbf=0x2d;for(const [_0x23589b,_0x25a81c]of Object['entries'](_0x67b230)){if(_0x23589b[_0x3d93e7(0x181)]()===_0x3b4b20[_0x3d93e7(0xe3)][_0x3d93e7(0x181)]()){_0x543dbf=_0x25a81c[_0x3d93e7(0x1bf)]||0x2d;break;}}_0x1cd206=_0x399270*(_0x543dbf/0x64),_0xc9caeb=_0x399270-_0x1cd206,console['log'](_0x3d93e7(0xfe)+_0x3b4b20['id']+':\x20'+_0x543dbf+_0x3d93e7(0x17d)+_0x399270['toFixed'](0x6)+_0x3d93e7(0x13a));}_0x18b53b+=_0x399270,_0x467651+=_0xc9caeb,_0x5e4cbc+=_0x1cd206;let _0x3f16a7;_0x3b4b20[_0x3d93e7(0xb0)]!==null&&_0x3b4b20['gatewayCommissionRate']!==undefined?(_0x3f16a7=_0x3b4b20[_0x3d93e7(0xb0)],console[_0x3d93e7(0x143)]('📊\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20'+_0x3b4b20['id']+':\x20'+_0x3f16a7+'%')):(_0x3f16a7=_0x399270>0x0?_0x1cd206/_0x399270*0x64:0x0,console[_0x3d93e7(0x143)](_0x3d93e7(0x189)+_0x3b4b20['id']+':\x20'+_0x3f16a7[_0x3d93e7(0x1c3)](0x2)+'%'));!_0xfe91b[_0x3b4b20[_0x3d93e7(0xe3)]]&&(_0xfe91b[_0x3b4b20[_0x3d93e7(0xe3)]]={'gateway':_0x3b4b20[_0x3d93e7(0xe3)],'gatewayDisplayName':this['getGatewayDisplayName'](_0x3b4b20[_0x3d93e7(0xe3)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0xfe91b[_0x3b4b20[_0x3d93e7(0xe3)]][_0x3d93e7(0xfd)]++,_0xfe91b[_0x3b4b20[_0x3d93e7(0xe3)]][_0x3d93e7(0x163)]+=_0x399270,_0xfe91b[_0x3b4b20[_0x3d93e7(0xe3)]]['commissionUSDT']+=_0x1cd206,_0xfe91b[_0x3b4b20[_0x3d93e7(0xe3)]][_0x3d93e7(0xdc)]+=_0xc9caeb,_0xfe91b[_0x3b4b20[_0x3d93e7(0xe3)]]['totalCommissionRate']+=_0x3f16a7;!_0x247167[_0x3d93e7(0xe7)]&&(!_0x5b5e5c[_0x3b4b20['shopId']]&&(_0x5b5e5c[_0x3b4b20[_0x3d93e7(0xe7)]]={'shopId':_0x3b4b20[_0x3d93e7(0xe7)],'shopName':_0x3b4b20[_0x3d93e7(0xa1)][_0x3d93e7(0x17e)],'shopUsername':_0x3b4b20['shop'][_0x3d93e7(0x166)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x5b5e5c[_0x3b4b20[_0x3d93e7(0xe7)]][_0x3d93e7(0xfd)]++,_0x5b5e5c[_0x3b4b20['shopId']]['turnoverUSDT']+=_0x399270,_0x5b5e5c[_0x3b4b20[_0x3d93e7(0xe7)]][_0x3d93e7(0xf9)]+=_0x1cd206,_0x5b5e5c[_0x3b4b20[_0x3d93e7(0xe7)]][_0x3d93e7(0xdc)]+=_0xc9caeb);const _0xc7eb8e=_0x3b4b20['paidAt']['toISOString']()[_0x3d93e7(0xde)]('T')[0x0];!_0x41c1f1[_0xc7eb8e]&&(_0x41c1f1[_0xc7eb8e]={'date':_0xc7eb8e,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x41c1f1[_0xc7eb8e][_0x3d93e7(0xd4)]+=_0x399270,_0x41c1f1[_0xc7eb8e][_0x3d93e7(0xfa)]+=_0xc9caeb,_0x41c1f1[_0xc7eb8e][_0x3d93e7(0x10c)]+=_0x1cd206,_0x41c1f1[_0xc7eb8e][_0x3d93e7(0xfd)]++;}catch(_0x36ea07){console['error'](_0x3d93e7(0x1d9)+_0x3b4b20['id']+':',_0x36ea07);}}Object[_0x3d93e7(0x1ce)](_0xfe91b)[_0x3d93e7(0x12f)](_0x21923a=>{const _0x23365e=_0x3d93e7;_0x21923a[_0x23365e(0x191)]=_0x21923a['paymentsCount']>0x0?_0x21923a[_0x23365e(0x125)]/_0x21923a['paymentsCount']:0x0,delete _0x21923a['totalCommissionRate'];}),Object[_0x3d93e7(0x1ce)](_0x5b5e5c)[_0x3d93e7(0x12f)](_0x4d6cf9=>{const _0x3efd5c=_0x3d93e7;_0x4d6cf9[_0x3efd5c(0x16b)]=_0x4d6cf9[_0x3efd5c(0xfd)]>0x0?_0x4d6cf9[_0x3efd5c(0x163)]/_0x4d6cf9[_0x3efd5c(0xfd)]:0x0;});let _0x285be4=0x0,_0x2387f9=0x0;if(_0x247167['shopId']){const _0x35fe0f=await database_1[_0x3d93e7(0x105)]['payout'][_0x3d93e7(0x1d8)]({'where':{'shopId':_0x247167[_0x3d93e7(0xe7)],'status':_0x3d93e7(0x199),'createdAt':{'gte':_0x28bbf4,'lte':_0x4467b3}},'select':{'amount':!![]}});_0x285be4=_0x35fe0f[_0x3d93e7(0xc1)]((_0x493756,_0x2c0b8a)=>_0x493756+_0x2c0b8a[_0x3d93e7(0x1ac)],0x0);const _0x3a84ed=await database_1['default']['payout'][_0x3d93e7(0x1d8)]({'where':{'shopId':_0x247167[_0x3d93e7(0xe7)],'status':_0x3d93e7(0x1a8),'createdAt':{'gte':_0x28bbf4,'lte':_0x4467b3}},'select':{'amount':!![]}});_0x2387f9=_0x3a84ed[_0x3d93e7(0xc1)]((_0x3d4337,_0x253297)=>_0x3d4337+_0x253297[_0x3d93e7(0x1ac)],0x0);}const _0x1721e9=_0x436b08,_0x3dae1f=_0x56ef0e[_0x3d93e7(0x15d)],_0x2131c8=_0x3dae1f>0x0?_0x18b53b/_0x3dae1f:0x0,_0x196187=_0x1721e9>0x0?Math[_0x3d93e7(0x139)](_0x3dae1f/_0x1721e9*0x2710)/0x64:0x0,_0x57b1fb=Math[_0x3d93e7(0xff)]((_0x4467b3[_0x3d93e7(0x1e0)]()-_0x28bbf4[_0x3d93e7(0x1e0)]())/(0x3e8*0x3c*0x3c*0x18)),_0x50ee6a={'totalTurnover':Math[_0x3d93e7(0x139)](_0x18b53b*0x64)/0x64,'merchantEarnings':Math[_0x3d93e7(0x139)](_0x467651*0x64)/0x64,'gatewayEarnings':Math['round'](_0x5e4cbc*0x64)/0x64,'totalPaidOut':Math[_0x3d93e7(0x139)](_0x285be4*0x64)/0x64,'pendingPayout':Math[_0x3d93e7(0x139)](_0x2387f9*0x64)/0x64,'averageCheck':Math['round'](_0x2131c8*0x64)/0x64,'totalPayments':_0x1721e9,'successfulPayments':_0x3dae1f,'conversionRate':_0x196187,'gatewayBreakdown':Object[_0x3d93e7(0x1ce)](_0xfe91b)['map'](_0x19c142=>({..._0x19c142,'turnoverUSDT':Math[_0x3d93e7(0x139)](_0x19c142['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x3d93e7(0x139)](_0x19c142['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x3d93e7(0x139)](_0x19c142[_0x3d93e7(0xdc)]*0x64)/0x64,'averageCommissionRate':Math[_0x3d93e7(0x139)](_0x19c142['averageCommissionRate']*0x64)/0x64})),'merchantBreakdown':_0x247167[_0x3d93e7(0xe7)]?undefined:Object[_0x3d93e7(0x1ce)](_0x5b5e5c)[_0x3d93e7(0x1c1)](_0x5988ac=>({..._0x5988ac,'turnoverUSDT':Math[_0x3d93e7(0x139)](_0x5988ac['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x3d93e7(0x139)](_0x5988ac[_0x3d93e7(0xf9)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x5988ac['merchantEarningsUSDT']*0x64)/0x64,'paidOutUSDT':Math[_0x3d93e7(0x139)](_0x5988ac[_0x3d93e7(0xb7)]*0x64)/0x64,'averageCheckUSDT':Math[_0x3d93e7(0x139)](_0x5988ac['averageCheckUSDT']*0x64)/0x64})),'dailyData':Object['values'](_0x41c1f1)[_0x3d93e7(0x1c1)](_0x2315fd=>({..._0x2315fd,'turnover':Math[_0x3d93e7(0x139)](_0x2315fd[_0x3d93e7(0xd4)]*0x64)/0x64,'merchantEarnings':Math[_0x3d93e7(0x139)](_0x2315fd[_0x3d93e7(0xfa)]*0x64)/0x64,'gatewayEarnings':Math[_0x3d93e7(0x139)](_0x2315fd[_0x3d93e7(0x10c)]*0x64)/0x64}))[_0x3d93e7(0x1c7)]((_0x48bf75,_0x1dbb02)=>_0x48bf75[_0x3d93e7(0xba)][_0x3d93e7(0xdd)](_0x1dbb02[_0x3d93e7(0xba)])),'periodInfo':{'from':_0x28bbf4,'to':_0x4467b3,'periodType':_0x247167[_0x3d93e7(0x112)]||_0x3d93e7(0x15c),'daysCount':_0x57b1fb}};return console[_0x3d93e7(0x143)]('📊\x20Merchant\x20statistics\x20calculated:'),console[_0x3d93e7(0x143)](_0x3d93e7(0x1a6)+_0x50ee6a[_0x3d93e7(0x135)]+_0x3d93e7(0x13a)),console['log'](_0x3d93e7(0x142)+_0x50ee6a['merchantEarnings']+_0x3d93e7(0x13a)),console[_0x3d93e7(0x143)](_0x3d93e7(0x122)+_0x50ee6a[_0x3d93e7(0x10c)]+_0x3d93e7(0x13a)),console[_0x3d93e7(0x143)](_0x3d93e7(0xe4)+_0x50ee6a[_0x3d93e7(0x13d)]+'\x20USDT'),console[_0x3d93e7(0x143)](_0x3d93e7(0x184)+_0x50ee6a[_0x3d93e7(0x14b)]+_0x3d93e7(0x13a)),console[_0x3d93e7(0x143)](_0x3d93e7(0x156)+_0x50ee6a['totalPayments']),_0x50ee6a;}async['getMerchantsSelection'](){const _0x4f5c0f=a38_0x4a5945;console[_0x4f5c0f(0x143)](_0x4f5c0f(0x17c));const _0x41193e=await database_1[_0x4f5c0f(0x105)][_0x4f5c0f(0xa1)][_0x4f5c0f(0x1d8)]({'where':{'status':_0x4f5c0f(0xe5)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x4f5c0f(0x1b6)}});return console[_0x4f5c0f(0x143)](_0x4f5c0f(0x100)+_0x41193e[_0x4f5c0f(0x15d)]+'\x20active\x20merchants\x20for\x20selection'),_0x41193e[_0x4f5c0f(0x1c1)](_0x1d123b=>({'id':_0x1d123b['id'],'username':_0x1d123b[_0x4f5c0f(0x166)],'name':_0x1d123b[_0x4f5c0f(0x17e)]}));}['getGatewayDisplayName'](_0x315f56){const _0x37738b=a38_0x4a5945,_0x3fbb70={'test_gateway':'Test\x20Gateway','plisio':_0x37738b(0x192),'rapyd':_0x37738b(0x111),'noda':_0x37738b(0xac),'cointopay':'CoinToPay','cointopay2':'Open\x20Banking\x202','klyme_eu':_0x37738b(0xf2),'klyme_gb':'KLYME\x20GB','klyme_de':_0x37738b(0x109),'mastercard':_0x37738b(0x175)};return _0x3fbb70[_0x315f56]||_0x315f56;}['getGatewayInternalName'](_0x27f961){const _0x5c5714=a38_0x4a5945,_0x472d2d={'Test\x20Gateway':_0x5c5714(0xce),'Plisio':_0x5c5714(0x1a9),'Rapyd':_0x5c5714(0x144),'Noda':_0x5c5714(0xe9),'CoinToPay':_0x5c5714(0xa8),'CoinToPay2':'cointopay2','KLYME\x20EU':_0x5c5714(0x1d6),'KLYME\x20GB':_0x5c5714(0x130),'KLYME\x20DE':_0x5c5714(0x1a5),'MasterCard':_0x5c5714(0x171)};return _0x472d2d[_0x27f961]||_0x27f961[_0x5c5714(0x181)]();}async[a38_0x4a5945(0x132)](_0x14c120){const _0x28f9c5=a38_0x4a5945,{page:_0x2a7ab3,limit:_0x2275a1,minAmount:_0x1030b6,search:_0x2f45b9}=_0x14c120,_0x592685=(_0x2a7ab3-0x1)*_0x2275a1;console[_0x28f9c5(0x143)](_0x28f9c5(0xd1),_0x14c120);const _0x637ed4={'balance':{'gt':0x0},'status':'ACTIVE'};_0x1030b6&&(_0x637ed4[_0x28f9c5(0x19d)][_0x28f9c5(0x108)]=_0x1030b6);_0x2f45b9&&(_0x637ed4['name']={'contains':_0x2f45b9,'mode':_0x28f9c5(0x1c4)});const [_0x5315c4,_0x4c1fee]=await Promise[_0x28f9c5(0x19e)]([database_1[_0x28f9c5(0x105)][_0x28f9c5(0xa1)]['findMany']({'where':_0x637ed4,'skip':_0x592685,'take':_0x2275a1,'orderBy':{'balance':_0x28f9c5(0xe1)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1[_0x28f9c5(0x105)]['shop'][_0x28f9c5(0x13e)]({'where':_0x637ed4})]);console[_0x28f9c5(0x143)](_0x28f9c5(0x15f)+_0x5315c4['length']+'\x20merchants\x20with\x20positive\x20balance');const _0x15bf44=await Promise['all'](_0x5315c4['map'](async _0x2251f8=>{const _0x4674b9=_0x28f9c5,[_0x1120ac,_0x2d7b48,_0x303b36]=await Promise[_0x4674b9(0x19e)]([database_1[_0x4674b9(0x105)][_0x4674b9(0x10b)][_0x4674b9(0x13e)]({'where':{'shopId':_0x2251f8['id'],'status':_0x4674b9(0x16f),'gateway':{'not':_0x4674b9(0xce)}}}),database_1[_0x4674b9(0x105)]['payment'][_0x4674b9(0x1e9)]({'where':{'shopId':_0x2251f8['id'],'status':'PAID','gateway':{'not':_0x4674b9(0xce)}},'orderBy':{'paidAt':'asc'},'select':{'paidAt':!![]}}),database_1[_0x4674b9(0x105)][_0x4674b9(0x10b)][_0x4674b9(0x18e)]({'by':[_0x4674b9(0xe3)],'where':{'shopId':_0x2251f8['id'],'status':_0x4674b9(0x16f),'gateway':{'not':_0x4674b9(0xce)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x833e7f=new Date(),_0x394a58=new Date(_0x833e7f[_0x4674b9(0xd6)](),_0x833e7f[_0x4674b9(0x1dc)](),0x1),_0x51b55b=new Date(_0x833e7f['getFullYear'](),_0x833e7f[_0x4674b9(0x1dc)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x3b5988,_0x35ceb4]=await Promise[_0x4674b9(0x19e)]([database_1[_0x4674b9(0x105)][_0x4674b9(0x9e)][_0x4674b9(0x131)]({'_sum':{'amount':!![]},'where':{'shopId':_0x2251f8['id'],'status':'COMPLETED'}}),database_1[_0x4674b9(0x105)][_0x4674b9(0x9e)][_0x4674b9(0x131)]({'_sum':{'amount':!![]},'where':{'shopId':_0x2251f8['id'],'status':_0x4674b9(0x199),'createdAt':{'gte':_0x394a58,'lte':_0x51b55b}}})]),_0x2d3111=_0x3b5988[_0x4674b9(0x12e)]['amount']||0x0,_0x4ce445=_0x35ceb4[_0x4674b9(0x12e)][_0x4674b9(0x1ac)]||0x0,_0x3bae64=await Promise[_0x4674b9(0x19e)](_0x303b36[_0x4674b9(0x1c1)](async _0x2e3797=>{const _0x1029cc=_0x4674b9;let _0x5179b9=0x2d;if(_0x2251f8[_0x1029cc(0x183)])try{const _0x246af5=JSON[_0x1029cc(0xb8)](_0x2251f8[_0x1029cc(0x183)]);for(const [_0x2fae0d,_0x115ba2]of Object[_0x1029cc(0x11f)](_0x246af5)){if(_0x2fae0d['toLowerCase']()===_0x2e3797[_0x1029cc(0xe3)][_0x1029cc(0x181)]()){_0x5179b9=_0x115ba2['commission']||0xa,console['log'](_0x1029cc(0xbe)+_0x2e3797['gateway']+_0x1029cc(0xea)+_0x2251f8['id']+':\x20commission\x20=\x20'+_0x5179b9+'%');break;}}}catch(_0xbeffee){console[_0x1029cc(0x17b)](_0x1029cc(0x1a2)+_0x2251f8['id']+':',_0xbeffee);}const _0x39689a=_0x2e3797['_sum']?.[_0x1029cc(0xa3)]||0x0,_0x389103=_0x39689a*(0x1-_0x5179b9/0x64);return{'gateway':_0x2e3797[_0x1029cc(0xe3)],'count':_0x2e3797[_0x1029cc(0x178)]?.['id']||0x0,'amountUSDT':Math[_0x1029cc(0x139)](_0x39689a*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x1029cc(0x139)](_0x389103*0x64)/0x64,'commission':_0x5179b9};})),_0x11fb28=_0x3bae64[_0x4674b9(0xc1)]((_0x24981d,_0x30118f)=>_0x24981d+_0x30118f[_0x4674b9(0xa3)],0x0),_0x21dfd5=_0x3bae64[_0x4674b9(0xc1)]((_0x1b1fc6,_0x48fc19)=>_0x1b1fc6+_0x48fc19[_0x4674b9(0x145)],0x0),_0x39e519=_0x2251f8[_0x4674b9(0x19d)];return console[_0x4674b9(0x143)](_0x4674b9(0x1a3)+_0x2251f8[_0x4674b9(0x166)]+':'),console[_0x4674b9(0x143)](_0x4674b9(0x197)+_0x11fb28[_0x4674b9(0x1c3)](0x2)+_0x4674b9(0x152)),console['log'](_0x4674b9(0x128)+_0x21dfd5[_0x4674b9(0x1c3)](0x2)+_0x4674b9(0x13b)),console[_0x4674b9(0x143)](_0x4674b9(0x106)+_0x39e519['toFixed'](0x2)+_0x4674b9(0xfb)),console[_0x4674b9(0x143)](_0x4674b9(0x116)+_0x2d3111[_0x4674b9(0x1c3)](0x2)+_0x4674b9(0x176)),console[_0x4674b9(0x143)](_0x4674b9(0x13c)+(_0x21dfd5-_0x2d3111-_0x39e519)[_0x4674b9(0x1c3)](0x2)+_0x4674b9(0x1d1)),{'id':_0x2251f8['id'],'fullName':_0x2251f8[_0x4674b9(0x17e)],'username':_0x2251f8[_0x4674b9(0x166)],'telegramId':_0x2251f8[_0x4674b9(0x1ab)],'merchantUrl':_0x2251f8[_0x4674b9(0x158)],'wallets':{'usdtPolygonWallet':_0x2251f8['usdtPolygonWallet'],'usdtTrcWallet':_0x2251f8[_0x4674b9(0x195)],'usdtErcWallet':_0x2251f8['usdtErcWallet'],'usdcPolygonWallet':_0x2251f8[_0x4674b9(0x16c)]},'totalAmountUSDT':Math[_0x4674b9(0x139)](_0x11fb28*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x21dfd5*0x64)/0x64,'currentBalance':Math[_0x4674b9(0x139)](_0x39e519*0x64)/0x64,'totalPayout':Math[_0x4674b9(0x139)](_0x2d3111*0x64)/0x64,'thisMonth':Math['round'](_0x4ce445*0x64)/0x64,'paymentsCount':_0x1120ac,'oldestPaymentDate':_0x2d7b48?.[_0x4674b9(0x104)]||_0x2251f8[_0x4674b9(0xd0)],'gatewayBreakdown':_0x3bae64};})),_0x15729e=_0x15bf44['reduce']((_0x51d7db,_0x45ea35)=>_0x51d7db+_0x45ea35[_0x28f9c5(0x1aa)],0x0),_0x365472=_0x15bf44[_0x28f9c5(0xc1)]((_0x2bd640,_0x275824)=>_0x2bd640+_0x275824['totalAmountAfterCommissionUSDT'],0x0),_0x3acff3=_0x15bf44[_0x28f9c5(0xc1)]((_0x4ed151,_0x53da9a)=>_0x4ed151+_0x53da9a['totalPayout'],0x0),_0x471bd1=_0x15bf44[_0x28f9c5(0xc1)]((_0x3270de,_0xfd0a13)=>_0x3270de+_0xfd0a13['thisMonth'],0x0);return console[_0x28f9c5(0x143)](_0x28f9c5(0x13f)+_0x4c1fee+_0x28f9c5(0xda)),console[_0x28f9c5(0x143)](_0x28f9c5(0x14c)+Math['round'](_0x15729e*0x64)/0x64+_0x28f9c5(0x152)),console[_0x28f9c5(0x143)](_0x28f9c5(0x1dd)+Math[_0x28f9c5(0x139)](_0x365472*0x64)/0x64+'\x20USDT\x20(actual\x20balances)'),console[_0x28f9c5(0x143)](_0x28f9c5(0x12b)+Math[_0x28f9c5(0x139)](_0x3acff3*0x64)/0x64+_0x28f9c5(0x13a)),console['log']('\x20\x20\x20📅\x20Total\x20payouts\x20(this\x20month):\x20'+Math['round'](_0x471bd1*0x64)/0x64+'\x20USDT'),{'merchants':_0x15bf44,'pagination':{'page':_0x2a7ab3,'limit':_0x2275a1,'total':_0x4c1fee,'totalPages':Math['ceil'](_0x4c1fee/_0x2275a1)},'summary':{'totalMerchants':_0x4c1fee,'totalAmountUSDT':Math[_0x28f9c5(0x139)](_0x15729e*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x28f9c5(0x139)](_0x365472*0x64)/0x64,'totalPayout':Math[_0x28f9c5(0x139)](_0x3acff3*0x64)/0x64,'thisMonth':Math['round'](_0x471bd1*0x64)/0x64}};}async[a38_0x4a5945(0x11e)](_0x3bb650){const _0x370227=a38_0x4a5945,{shopId:_0x3fccb1,amount:_0x38d86f,network:_0x48bc61,wallet:_0x4abf6d,notes:_0x5bdfc7,txid:_0x26039d,periodFrom:_0x534b52,periodTo:_0xf54d38}=_0x3bb650,_0x1916a7=await database_1[_0x370227(0x105)][_0x370227(0x119)](async _0x11ab7d=>{const _0x545110=_0x370227,_0xf15b1b=await _0x11ab7d[_0x545110(0xa1)][_0x545110(0x1de)]({'where':{'id':_0x3fccb1},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0xf15b1b)throw new Error(_0x545110(0x11b));console[_0x545110(0x143)](_0x545110(0x162)+_0xf15b1b['username']+':'),console[_0x545110(0x143)](_0x545110(0xbf)+_0xf15b1b[_0x545110(0x19d)]['toFixed'](0x6)+_0x545110(0x13a)),console[_0x545110(0x143)](_0x545110(0xd8)+_0x38d86f[_0x545110(0x1c3)](0x6)+_0x545110(0x13a)),console[_0x545110(0x143)](_0x545110(0x1ae)+_0xf15b1b[_0x545110(0x13d)][_0x545110(0x1c3)](0x6)+_0x545110(0x13a));if(_0x26039d)console[_0x545110(0x143)](_0x545110(0xa0)+_0x26039d);if(_0xf15b1b[_0x545110(0x19d)]<_0x38d86f)throw new Error(_0x545110(0x16d)+_0xf15b1b[_0x545110(0x19d)][_0x545110(0x1c3)](0x6)+_0x545110(0x1da)+_0x38d86f[_0x545110(0x1c3)](0x6)+_0x545110(0x13a));let _0x5ad787=_0x4abf6d;if(!_0x5ad787){const _0x5c8e64=await _0x11ab7d['shop']['findUnique']({'where':{'id':_0x3fccb1},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x5c8e64)switch(_0x48bc61){case _0x545110(0x1b9):_0x5ad787=_0x5c8e64[_0x545110(0xcf)]||undefined;break;case _0x545110(0xd7):_0x5ad787=_0x5c8e64['usdtTrcWallet']||undefined;break;case _0x545110(0xa4):_0x5ad787=_0x5c8e64[_0x545110(0x187)]||undefined;break;case _0x545110(0x1b1):_0x5ad787=_0x5c8e64[_0x545110(0x16c)]||undefined;break;}}console[_0x545110(0x143)](_0x545110(0x1d3)+_0x48bc61+':\x20'+(_0x5ad787||'not\x20specified'));const _0x3c8c9b=await _0x11ab7d[_0x545110(0x9e)][_0x545110(0xb9)]({'data':{'shopId':_0x3fccb1,'amount':_0x38d86f,'network':_0x48bc61,'status':_0x545110(0x199),'txid':_0x26039d,'notes':_0x5bdfc7,'periodFrom':_0x534b52?new Date(_0x534b52):null,'periodTo':_0xf54d38?new Date(_0xf54d38):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x22be1c=_0xf15b1b['balance']-_0x38d86f,_0x1f4194=_0xf15b1b[_0x545110(0x13d)]+_0x38d86f;return await _0x11ab7d[_0x545110(0xa1)][_0x545110(0x1cf)]({'where':{'id':_0x3fccb1},'data':{'balance':_0x22be1c,'totalPaidOut':_0x1f4194}}),console['log'](_0x545110(0x127)+_0xf15b1b[_0x545110(0x166)]+_0x545110(0x14f)),console[_0x545110(0x143)](_0x545110(0x148)+_0xf15b1b['balance']['toFixed'](0x6)+_0x545110(0x174)+_0x22be1c[_0x545110(0x1c3)](0x6)+_0x545110(0x1e1)+_0x38d86f[_0x545110(0x1c3)](0x6)+')'),console[_0x545110(0x143)]('\x20\x20\x20Total\x20paid\x20out:\x20'+_0xf15b1b[_0x545110(0x13d)][_0x545110(0x1c3)](0x6)+_0x545110(0x174)+_0x1f4194['toFixed'](0x6)+_0x545110(0xa5)+_0x38d86f[_0x545110(0x1c3)](0x6)+')'),{'payout':_0x3c8c9b,'shop':_0xf15b1b};});return console[_0x370227(0x143)](_0x370227(0x182)+_0x1916a7[_0x370227(0x9e)]['id']+'\x20for\x20shop\x20'+_0x1916a7[_0x370227(0xa1)][_0x370227(0x166)]+'\x20('+_0x38d86f+_0x370227(0xe8)),{'id':_0x1916a7[_0x370227(0x9e)]['id'],'shopId':_0x1916a7[_0x370227(0x9e)][_0x370227(0xe7)],'shopName':_0x1916a7['shop'][_0x370227(0x17e)],'shopUsername':_0x1916a7[_0x370227(0xa1)]['username'],'amount':_0x1916a7[_0x370227(0x9e)][_0x370227(0x1ac)],'network':_0x1916a7[_0x370227(0x9e)][_0x370227(0x1c2)],'status':_0x1916a7[_0x370227(0x9e)][_0x370227(0x12a)],'txid':_0x1916a7[_0x370227(0x9e)][_0x370227(0x1c9)],'notes':_0x1916a7[_0x370227(0x9e)][_0x370227(0x1e2)],'periodFrom':_0x1916a7[_0x370227(0x9e)]['periodFrom'],'periodTo':_0x1916a7[_0x370227(0x9e)][_0x370227(0x168)],'createdAt':_0x1916a7[_0x370227(0x9e)][_0x370227(0xd0)],'paidAt':_0x1916a7[_0x370227(0x9e)][_0x370227(0x104)]};}async[a38_0x4a5945(0x153)](_0x7ec703){const _0x3cf9a8=a38_0x4a5945,{page:_0x548716,limit:_0x192038,shopId:_0x49504f,network:_0x2ed423,dateFrom:_0x4d39cc,dateTo:_0x296734,search:_0x3feb0d}=_0x7ec703,_0x356cdb=(_0x548716-0x1)*_0x192038,_0xfb7fad={};_0x49504f&&(_0xfb7fad[_0x3cf9a8(0xe7)]=_0x49504f);_0x2ed423&&(_0xfb7fad[_0x3cf9a8(0x1c2)]=_0x2ed423);(_0x4d39cc||_0x296734)&&(_0xfb7fad[_0x3cf9a8(0xd0)]={},_0x4d39cc&&(_0xfb7fad[_0x3cf9a8(0xd0)][_0x3cf9a8(0x108)]=new Date(_0x4d39cc)),_0x296734&&(_0xfb7fad['createdAt'][_0x3cf9a8(0xbb)]=new Date(_0x296734)));_0x3feb0d&&(_0xfb7fad['OR']=[{'shop':{'name':{'contains':_0x3feb0d,'mode':_0x3cf9a8(0x1c4)}}},{'shop':{'username':{'contains':_0x3feb0d,'mode':'insensitive'}}},{'notes':{'contains':_0x3feb0d,'mode':_0x3cf9a8(0x1c4)}}]);const [_0x39fad7,_0x3647ea]=await Promise[_0x3cf9a8(0x19e)]([database_1[_0x3cf9a8(0x105)][_0x3cf9a8(0x9e)][_0x3cf9a8(0x1d8)]({'where':_0xfb7fad,'skip':_0x356cdb,'take':_0x192038,'orderBy':{'createdAt':_0x3cf9a8(0xe1)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x3cf9a8(0x105)]['payout'][_0x3cf9a8(0x13e)]({'where':_0xfb7fad})]);return{'payouts':_0x39fad7[_0x3cf9a8(0x1c1)](_0x43c01c=>({'id':_0x43c01c['id'],'shopId':_0x43c01c[_0x3cf9a8(0xe7)],'shopName':_0x43c01c[_0x3cf9a8(0xa1)][_0x3cf9a8(0x17e)],'shopUsername':_0x43c01c[_0x3cf9a8(0xa1)][_0x3cf9a8(0x166)],'amount':_0x43c01c[_0x3cf9a8(0x1ac)],'network':_0x43c01c['network'],'status':_0x43c01c[_0x3cf9a8(0x12a)],'txid':_0x43c01c[_0x3cf9a8(0x1c9)],'notes':_0x43c01c[_0x3cf9a8(0x1e2)],'periodFrom':_0x43c01c['periodFrom'],'periodTo':_0x43c01c[_0x3cf9a8(0x168)],'createdAt':_0x43c01c[_0x3cf9a8(0xd0)],'paidAt':_0x43c01c['paidAt']})),'pagination':{'page':_0x548716,'limit':_0x192038,'total':_0x3647ea,'totalPages':Math['ceil'](_0x3647ea/_0x192038)}};}async[a38_0x4a5945(0x1bd)](_0x24e485){const _0x7829c0=a38_0x4a5945,_0x2fb462=await database_1[_0x7829c0(0x105)][_0x7829c0(0x9e)][_0x7829c0(0x1de)]({'where':{'id':_0x24e485},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x2fb462)return null;return{'id':_0x2fb462['id'],'shopId':_0x2fb462[_0x7829c0(0xe7)],'shopName':_0x2fb462[_0x7829c0(0xa1)][_0x7829c0(0x17e)],'shopUsername':_0x2fb462[_0x7829c0(0xa1)][_0x7829c0(0x166)],'amount':_0x2fb462[_0x7829c0(0x1ac)],'network':_0x2fb462['network'],'status':_0x2fb462['status'],'txid':_0x2fb462['txid'],'notes':_0x2fb462[_0x7829c0(0x1e2)],'periodFrom':_0x2fb462[_0x7829c0(0x18b)],'periodTo':_0x2fb462[_0x7829c0(0x168)],'createdAt':_0x2fb462[_0x7829c0(0xd0)],'paidAt':_0x2fb462['paidAt']};}async['deletePayout'](_0x5ba97d){const _0x227d6b=a38_0x4a5945;await database_1[_0x227d6b(0x105)][_0x227d6b(0x9e)]['delete']({'where':{'id':_0x5ba97d}});}async[a38_0x4a5945(0xb1)](_0x3a7270){const _0x5c0dc3=a38_0x4a5945,{page:_0x5d116d,limit:_0x3d75d5,status:_0x30bc63,gateway:_0x5d4d8a,shopId:_0x46964c,dateFrom:_0x39bfed,dateTo:_0x14ed1e,search:_0x183387,currency:_0x2a35b,sortBy:_0x509e71,sortOrder:_0x3e0737}=_0x3a7270,_0x32982a=(_0x5d116d-0x1)*_0x3d75d5;console[_0x5c0dc3(0x143)](_0x5c0dc3(0xee),_0x3a7270);const _0x3ddc1e=await database_1['default'][_0x5c0dc3(0x10b)][_0x5c0dc3(0x18e)]({'by':['gateway'],'_count':{'gateway':!![]}});console['log'](_0x5c0dc3(0xec),_0x3ddc1e[_0x5c0dc3(0x1c1)](_0x535754=>_0x535754[_0x5c0dc3(0xe3)]+'\x20('+_0x535754[_0x5c0dc3(0x178)][_0x5c0dc3(0xe3)]+_0x5c0dc3(0x10a)));if(_0x5d4d8a){const _0x63582e=_0x3ddc1e[_0x5c0dc3(0x161)](_0x382057=>_0x382057[_0x5c0dc3(0xe3)][_0x5c0dc3(0x181)]()===_0x5d4d8a[_0x5c0dc3(0x181)]());!_0x63582e&&_0x5d4d8a[_0x5c0dc3(0x181)]()!==_0x5c0dc3(0xce)&&console[_0x5c0dc3(0x143)](_0x5c0dc3(0xcc)+_0x5d4d8a+_0x5c0dc3(0x1df)+_0x3ddc1e[_0x5c0dc3(0x1c1)](_0x5b474b=>_0x5b474b[_0x5c0dc3(0xe3)])[_0x5c0dc3(0x180)](',\x20'));}const _0x22e884={};_0x30bc63&&(_0x22e884[_0x5c0dc3(0x12a)]=_0x30bc63[_0x5c0dc3(0x133)]());if(!_0x5d4d8a)_0x22e884[_0x5c0dc3(0xe3)]={'not':'test_gateway'};else{if(_0x5d4d8a&&(_0x5d4d8a[_0x5c0dc3(0x181)]()==='test_gateway'||_0x5d4d8a===_0x5c0dc3(0x1d4)))_0x22e884[_0x5c0dc3(0xe3)]=_0x5c0dc3(0xce);else{let _0x29e723=_0x5d4d8a;const _0x32970b=(0x0,gateway_1['getGatewayNameById'])(_0x5d4d8a);if(_0x32970b)_0x29e723=_0x32970b,console[_0x5c0dc3(0x143)](_0x5c0dc3(0x159)+_0x5d4d8a+_0x5c0dc3(0x1b5)+_0x29e723+'\x27');else{const _0x176d08=(0x0,gateway_1[_0x5c0dc3(0x1e8)])(_0x5d4d8a);if(_0x176d08){const _0x40ee1f=(0x0,gateway_1[_0x5c0dc3(0xcd)])(_0x176d08);_0x40ee1f&&(_0x29e723=_0x40ee1f,console[_0x5c0dc3(0x143)](_0x5c0dc3(0x1c8)+_0x5d4d8a+_0x5c0dc3(0xd3)+_0x176d08+_0x5c0dc3(0x154)+_0x29e723+'\x27'));}else console[_0x5c0dc3(0x143)](_0x5c0dc3(0x18c)+_0x5d4d8a+'\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)');}const _0x890452=await database_1[_0x5c0dc3(0x105)][_0x5c0dc3(0x10b)][_0x5c0dc3(0x13e)]({'where':{'gateway':_0x29e723[_0x5c0dc3(0x181)]()},'take':0x1});_0x890452===0x0?(console['log']('⚠️\x20Gateway\x20\x27'+_0x29e723+'\x27\x20(from\x20\x27'+_0x5d4d8a+_0x5c0dc3(0xfc)),_0x22e884[_0x5c0dc3(0xe3)]='NONEXISTENT_GATEWAY_FILTER'):(_0x22e884[_0x5c0dc3(0xe3)]=_0x29e723['toLowerCase'](),console[_0x5c0dc3(0x143)](_0x5c0dc3(0x1bc)+_0x29e723+_0x5c0dc3(0x16a)+_0x5d4d8a+'\x27)'));}}console[_0x5c0dc3(0x143)](_0x5c0dc3(0x17f),_0x22e884[_0x5c0dc3(0xe3)]);_0x46964c&&(_0x22e884[_0x5c0dc3(0xe7)]=_0x46964c);_0x2a35b&&(_0x22e884['currency']=_0x2a35b[_0x5c0dc3(0x133)](),console[_0x5c0dc3(0x143)](_0x5c0dc3(0xa6)+_0x2a35b[_0x5c0dc3(0x133)]()));(_0x39bfed||_0x14ed1e)&&(_0x22e884[_0x5c0dc3(0xd0)]={},_0x39bfed&&(_0x22e884[_0x5c0dc3(0xd0)][_0x5c0dc3(0x108)]=new Date(_0x39bfed)),_0x14ed1e&&(_0x22e884[_0x5c0dc3(0xd0)][_0x5c0dc3(0xbb)]=new Date(_0x14ed1e)));_0x183387&&(_0x22e884['OR']=[{'id':{'contains':_0x183387,'mode':_0x5c0dc3(0x1c4)}},{'orderId':{'contains':_0x183387,'mode':_0x5c0dc3(0x1c4)}},{'gatewayOrderId':{'contains':_0x183387,'mode':_0x5c0dc3(0x1c4)}},{'customerEmail':{'contains':_0x183387,'mode':_0x5c0dc3(0x1c4)}},{'shop':{'name':{'contains':_0x183387,'mode':_0x5c0dc3(0x1c4)}}},{'shop':{'username':{'contains':_0x183387,'mode':_0x5c0dc3(0x1c4)}}}]);console[_0x5c0dc3(0x143)](_0x5c0dc3(0x193),JSON['stringify'](_0x22e884,null,0x2));let _0x24ec44={'createdAt':_0x5c0dc3(0xe1)};if(_0x509e71){const _0x523b0a=[_0x5c0dc3(0x1ac),_0x5c0dc3(0xd0),_0x5c0dc3(0x1b4),_0x5c0dc3(0x12a),_0x5c0dc3(0xe3),_0x5c0dc3(0xb6)],_0x3e0688=['asc',_0x5c0dc3(0xe1)];if(_0x523b0a[_0x5c0dc3(0x1db)](_0x509e71)){const _0x5e0830=_0x3e0688['includes'](_0x3e0737)?_0x3e0737:'desc';_0x24ec44={[_0x509e71]:_0x5e0830},console[_0x5c0dc3(0x143)](_0x5c0dc3(0xa7)+_0x509e71+_0x5c0dc3(0x170)+_0x5e0830+_0x5c0dc3(0xf6));}}const [_0x585cea,_0x32c11f]=await Promise[_0x5c0dc3(0x19e)]([database_1[_0x5c0dc3(0x105)][_0x5c0dc3(0x10b)][_0x5c0dc3(0x1d8)]({'where':_0x22e884,'skip':_0x32982a,'take':_0x3d75d5,'orderBy':_0x24ec44,'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x5c0dc3(0x105)]['payment']['count']({'where':_0x22e884})]);return{'payments':_0x585cea,'pagination':{'page':_0x5d116d,'limit':_0x3d75d5,'total':_0x32c11f,'totalPages':Math[_0x5c0dc3(0xff)](_0x32c11f/_0x3d75d5)}};}async[a38_0x4a5945(0x1a7)](_0x5766e1){const _0x1c90b0=a38_0x4a5945,_0x57f9eb=await database_1[_0x1c90b0(0x105)][_0x1c90b0(0x10b)][_0x1c90b0(0x1de)]({'where':{'id':_0x5766e1},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x57f9eb)return null;return{'id':_0x57f9eb['id'],'shopId':_0x57f9eb[_0x1c90b0(0xe7)],'gateway':_0x57f9eb[_0x1c90b0(0xe3)],'amount':_0x57f9eb['amount'],'currency':_0x57f9eb[_0x1c90b0(0xb6)],'status':_0x57f9eb[_0x1c90b0(0x12a)],'orderId':_0x57f9eb[_0x1c90b0(0x157)],'gatewayOrderId':_0x57f9eb[_0x1c90b0(0xf8)],'customerEmail':_0x57f9eb[_0x1c90b0(0x15e)],'customerName':_0x57f9eb[_0x1c90b0(0x16e)],'customerCountry':_0x57f9eb[_0x1c90b0(0x1b7)],'customerIp':_0x57f9eb['customerIp'],'customerUa':_0x57f9eb[_0x1c90b0(0xc4)],'failureMessage':_0x57f9eb['failureMessage'],'externalPaymentUrl':_0x57f9eb['externalPaymentUrl'],'successUrl':_0x57f9eb['successUrl'],'failUrl':_0x57f9eb[_0x1c90b0(0x1e5)],'pendingUrl':_0x57f9eb[_0x1c90b0(0xa2)],'whiteUrl':_0x57f9eb[_0x1c90b0(0x11a)],'createdAt':_0x57f9eb[_0x1c90b0(0xd0)],'updatedAt':_0x57f9eb[_0x1c90b0(0x1b4)],'shop':_0x57f9eb['shop']};}async['updatePaymentStatus'](_0x5ae41b,_0x59b861,_0x836ce9,_0x30d6c2){const _0x56afc3=a38_0x4a5945,_0x9c0e2d=await database_1[_0x56afc3(0x105)][_0x56afc3(0x119)](async _0x370632=>{const _0x37d54f=_0x56afc3,_0x577776=await _0x370632[_0x37d54f(0x10b)][_0x37d54f(0x1de)]({'where':{'id':_0x5ae41b},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x577776)throw new Error(_0x37d54f(0x14a));const _0x35e5b5=_0x577776[_0x37d54f(0x12a)],_0x248125=_0x59b861[_0x37d54f(0x133)]();console[_0x37d54f(0x143)](_0x37d54f(0x10f)+_0x5ae41b+'\x20status:\x20'+_0x35e5b5+'\x20->\x20'+_0x248125),console[_0x37d54f(0x143)](_0x37d54f(0x101)+_0x577776['shop'][_0x37d54f(0x19d)]+_0x37d54f(0x13a));const _0x59dc2f={'status':_0x248125,'updatedAt':new Date(),'statusChangedBy':_0x37d54f(0x140),'statusChangedAt':new Date()};_0x836ce9&&(_0x59dc2f[_0x37d54f(0xbc)]=_0x836ce9);_0x248125==='CHARGEBACK'&&_0x30d6c2&&(_0x59dc2f[_0x37d54f(0x124)]=_0x30d6c2);let _0x9eba42=0x0,_0x38d288=_0x577776['shop'][_0x37d54f(0x19d)];if(_0x248125==='PAID'&&_0x35e5b5!==_0x37d54f(0x16f)){_0x59dc2f[_0x37d54f(0x104)]=new Date();const _0x3b5e6d=await currencyService_1[_0x37d54f(0x1c0)][_0x37d54f(0x15a)](_0x577776[_0x37d54f(0x1ac)],_0x577776[_0x37d54f(0xb6)]);_0x59dc2f['amountUSDT']=_0x3b5e6d;let _0x3621d4=0x2d;const _0x499d6d=await _0x370632[_0x37d54f(0xa1)][_0x37d54f(0x1de)]({'where':{'id':_0x577776[_0x37d54f(0xe7)]},'select':{'gatewaySettings':!![]}});if(_0x499d6d?.[_0x37d54f(0x183)])try{const _0x570748=JSON[_0x37d54f(0xb8)](_0x499d6d['gatewaySettings']);for(const [_0x3b8ffd,_0x4903e0]of Object['entries'](_0x570748)){if(_0x3b8ffd['toLowerCase']()===_0x577776['gateway']['toLowerCase']()){_0x3621d4=_0x4903e0['commission']||0xa;break;}}}catch(_0xbb72fa){console[_0x37d54f(0x17b)]('Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20'+_0x5ae41b+':',_0xbb72fa);}let _0x153019;_0x577776[_0x37d54f(0x149)]!==null&&_0x577776[_0x37d54f(0x149)]!==undefined?(_0x153019=_0x577776[_0x37d54f(0x149)],console[_0x37d54f(0x143)](_0x37d54f(0x19f)+_0x153019[_0x37d54f(0x1c3)](0x6)+_0x37d54f(0x14e)+_0x5ae41b)):(_0x153019=_0x3b5e6d*(0x1-_0x3621d4/0x64),console['log'](_0x37d54f(0xdf)+_0x5ae41b+':\x20'+_0x3621d4+_0x37d54f(0x17d)+_0x3b5e6d['toFixed'](0x6)+'\x20USDT'),_0x59dc2f[_0x37d54f(0x149)]=_0x153019,_0x59dc2f['gatewayCommissionRate']=_0x3621d4),_0x9eba42=_0x153019,_0x38d288+=_0x153019,console[_0x37d54f(0x143)]('💰\x20Payment\x20'+_0x5ae41b+_0x37d54f(0x141)),console[_0x37d54f(0x143)]('\x20\x20\x20Full\x20amount:\x20'+_0x3b5e6d[_0x37d54f(0x1c3)](0x6)+_0x37d54f(0x13a)),console[_0x37d54f(0x143)](_0x37d54f(0xab)+_0x577776[_0x37d54f(0xe3)]+_0x37d54f(0x194)+_0x3621d4+'%'),console[_0x37d54f(0x143)](_0x37d54f(0x1d0)+_0x153019[_0x37d54f(0x1c3)](0x6)+_0x37d54f(0x1d5)+_0x3621d4+_0x37d54f(0xb4)),console[_0x37d54f(0x143)](_0x37d54f(0xb5)+_0x153019[_0x37d54f(0x1c3)](0x6)+_0x37d54f(0x13a));}else{if(_0x35e5b5===_0x37d54f(0x16f)&&_0x248125!==_0x37d54f(0x16f)){if(_0x577776[_0x37d54f(0xa3)]){let _0x57428f=0x2d;const _0x545657=await _0x370632['shop'][_0x37d54f(0x1de)]({'where':{'id':_0x577776[_0x37d54f(0xe7)]},'select':{'gatewaySettings':!![]}});if(_0x545657?.[_0x37d54f(0x183)])try{const _0x2d734b=JSON[_0x37d54f(0xb8)](_0x545657['gatewaySettings']);for(const [_0x12a9b0,_0x13730e]of Object['entries'](_0x2d734b)){if(_0x12a9b0['toLowerCase']()===_0x577776[_0x37d54f(0xe3)][_0x37d54f(0x181)]()){_0x57428f=_0x13730e[_0x37d54f(0x1bf)]||0xa;break;}}}catch(_0x4479b8){console[_0x37d54f(0x17b)]('Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20'+_0x5ae41b+':',_0x4479b8);}const _0x42186c=_0x577776[_0x37d54f(0xa3)]*(0x1-_0x57428f/0x64);_0x9eba42=-_0x42186c,_0x38d288-=_0x42186c,_0x59dc2f['amountUSDT']=null,_0x59dc2f[_0x37d54f(0x149)]=null,console[_0x37d54f(0x143)](_0x37d54f(0x18d)+_0x5ae41b+_0x37d54f(0x1af)),console[_0x37d54f(0x143)](_0x37d54f(0x14d)+_0x577776[_0x37d54f(0xa3)][_0x37d54f(0x1c3)](0x6)+_0x37d54f(0x13a)),console[_0x37d54f(0x143)](_0x37d54f(0xab)+_0x577776['gateway']+_0x37d54f(0x194)+_0x57428f+'%'),console[_0x37d54f(0x143)](_0x37d54f(0x147)+_0x42186c[_0x37d54f(0x1c3)](0x6)+_0x37d54f(0x1d5)+_0x57428f+_0x37d54f(0xb4)),console[_0x37d54f(0x143)](_0x37d54f(0x1b3)+_0x42186c[_0x37d54f(0x1c3)](0x6)+_0x37d54f(0x13a));}}}_0x248125===_0x37d54f(0xc3)&&(_0x35e5b5===_0x37d54f(0x16f)&&_0x577776['amountUSDT']&&console[_0x37d54f(0x143)](_0x37d54f(0xbd)),_0x30d6c2&&_0x30d6c2>0x0&&(_0x9eba42-=_0x30d6c2,_0x38d288-=_0x30d6c2,console[_0x37d54f(0x143)](_0x37d54f(0x160)+_0x30d6c2['toFixed'](0x6)+_0x37d54f(0x17a))));_0x248125===_0x37d54f(0xb2)&&_0x35e5b5===_0x37d54f(0x16f)&&console['log']('🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance');const _0xac1315=await _0x370632[_0x37d54f(0x10b)]['update']({'where':{'id':_0x5ae41b},'data':_0x59dc2f,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x9eba42!==0x0&&(await _0x370632[_0x37d54f(0xa1)][_0x37d54f(0x1cf)]({'where':{'id':_0x577776[_0x37d54f(0xe7)]},'data':{'balance':_0x38d288}}),console[_0x37d54f(0x143)](_0x37d54f(0x127)+_0x577776['shopId']+_0x37d54f(0x19a)+_0x577776['shop']['balance'][_0x37d54f(0x1c3)](0x6)+_0x37d54f(0x174)+_0x38d288['toFixed'](0x6)+'\x20USDT\x20('+(_0x9eba42>0x0?'+':'')+_0x9eba42[_0x37d54f(0x1c3)](0x6)+')')),_0xac1315;});return{'id':_0x9c0e2d['id'],'shopId':_0x9c0e2d[_0x56afc3(0xe7)],'gateway':_0x9c0e2d['gateway'],'amount':_0x9c0e2d[_0x56afc3(0x1ac)],'currency':_0x9c0e2d[_0x56afc3(0xb6)],'status':_0x9c0e2d['status'],'orderId':_0x9c0e2d[_0x56afc3(0x157)],'gatewayOrderId':_0x9c0e2d['gatewayOrderId'],'customerEmail':_0x9c0e2d['customerEmail'],'customerName':_0x9c0e2d[_0x56afc3(0x16e)],'customerCountry':_0x9c0e2d[_0x56afc3(0x1b7)],'customerIp':_0x9c0e2d[_0x56afc3(0x1cb)],'customerUa':_0x9c0e2d[_0x56afc3(0xc4)],'failureMessage':_0x9c0e2d['failureMessage'],'adminNotes':_0x9c0e2d['adminNotes'],'chargebackAmount':_0x9c0e2d['chargebackAmount'],'statusChangedBy':_0x9c0e2d[_0x56afc3(0xf5)],'statusChangedAt':_0x9c0e2d['statusChangedAt'],'createdAt':_0x9c0e2d['createdAt'],'updatedAt':_0x9c0e2d[_0x56afc3(0x1b4)],'shop':_0x9c0e2d[_0x56afc3(0xa1)]};}async[a38_0x4a5945(0x188)](_0x3375ee,_0x1c0f88){const _0x32c8e4=a38_0x4a5945,_0x1b0d33=Math[_0x32c8e4(0x113)]()['toString'](0x24)['substr'](0x2,0x9);console[_0x32c8e4(0x143)](_0x32c8e4(0x1be)+_0x1b0d33+_0x32c8e4(0xe6)+_0x3375ee);const _0x1ded0d={..._0x1c0f88};_0x1c0f88[_0x32c8e4(0xa9)]&&_0x1c0f88[_0x32c8e4(0xa9)]['trim']()!==''?(console['log']('🔐\x20['+_0x1b0d33+']\x20Updating\x20password\x20for\x20user\x20'+_0x3375ee),_0x1ded0d[_0x32c8e4(0xa9)]=await bcryptjs_1[_0x32c8e4(0x105)]['hash'](_0x1c0f88[_0x32c8e4(0xa9)],0xc)):(console[_0x32c8e4(0x143)](_0x32c8e4(0xad)+_0x1b0d33+_0x32c8e4(0x15b)),delete _0x1ded0d[_0x32c8e4(0xa9)]);_0x1c0f88['fullName']&&(_0x1ded0d['name']=_0x1c0f88[_0x32c8e4(0xaf)],delete _0x1ded0d[_0x32c8e4(0xaf)]);_0x1c0f88[_0x32c8e4(0x102)]&&(_0x1ded0d['telegram']=_0x1c0f88[_0x32c8e4(0x102)],delete _0x1ded0d[_0x32c8e4(0x102)]);_0x1c0f88[_0x32c8e4(0x190)]&&(_0x1ded0d['shopUrl']=_0x1c0f88[_0x32c8e4(0x190)],delete _0x1ded0d[_0x32c8e4(0x190)]);if(_0x1c0f88['gateways']){const _0x4af5d0=_0x1c0f88['gateways'][_0x32c8e4(0x1c1)](_0x54bccd=>this['getGatewayInternalName'](_0x54bccd));console[_0x32c8e4(0x143)](_0x32c8e4(0x185),_0x1c0f88[_0x32c8e4(0x1c5)],'->',_0x4af5d0),_0x1ded0d[_0x32c8e4(0x12c)]=JSON[_0x32c8e4(0xb3)](_0x4af5d0),delete _0x1ded0d[_0x32c8e4(0x1c5)];}_0x1c0f88[_0x32c8e4(0x183)]&&(console[_0x32c8e4(0x143)](_0x32c8e4(0x18a)+_0x1b0d33+']\x20Gateway\x20settings\x20before\x20saving:',_0x1c0f88[_0x32c8e4(0x183)]),_0x1ded0d[_0x32c8e4(0x183)]=JSON['stringify'](_0x1c0f88[_0x32c8e4(0x183)]),console[_0x32c8e4(0x143)](_0x32c8e4(0x18a)+_0x1b0d33+_0x32c8e4(0x198),_0x1ded0d['gatewaySettings']));_0x1c0f88[_0x32c8e4(0x150)]&&(_0x1c0f88[_0x32c8e4(0x150)][_0x32c8e4(0xcf)]!==undefined&&(_0x1ded0d[_0x32c8e4(0xcf)]=_0x1c0f88[_0x32c8e4(0x150)][_0x32c8e4(0xcf)]||null),_0x1c0f88[_0x32c8e4(0x150)][_0x32c8e4(0x195)]!==undefined&&(_0x1ded0d['usdtTrcWallet']=_0x1c0f88[_0x32c8e4(0x150)][_0x32c8e4(0x195)]||null),_0x1c0f88[_0x32c8e4(0x150)][_0x32c8e4(0x187)]!==undefined&&(_0x1ded0d[_0x32c8e4(0x187)]=_0x1c0f88[_0x32c8e4(0x150)][_0x32c8e4(0x187)]||null),_0x1c0f88['wallets'][_0x32c8e4(0x16c)]!==undefined&&(_0x1ded0d[_0x32c8e4(0x16c)]=_0x1c0f88[_0x32c8e4(0x150)][_0x32c8e4(0x16c)]||null),delete _0x1ded0d['wallets']);const _0x4f63ae=await database_1[_0x32c8e4(0x105)]['shop']['update']({'where':{'id':_0x3375ee},'data':_0x1ded0d,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0x32c8e4(0x143)](_0x32c8e4(0xc8)+_0x1b0d33+_0x32c8e4(0x1ad),_0x4f63ae[_0x32c8e4(0x183)]),{'id':_0x4f63ae['id'],'fullName':_0x4f63ae[_0x32c8e4(0x17e)],'username':_0x4f63ae['username'],'telegramId':_0x4f63ae[_0x32c8e4(0x1ab)],'merchantUrl':_0x4f63ae[_0x32c8e4(0x158)],'gateways':_0x4f63ae['paymentGateways']?JSON[_0x32c8e4(0xb8)](_0x4f63ae[_0x32c8e4(0x12c)]):null,'gatewaySettings':_0x4f63ae[_0x32c8e4(0x183)]?JSON[_0x32c8e4(0xb8)](_0x4f63ae[_0x32c8e4(0x183)]):null,'publicKey':_0x4f63ae[_0x32c8e4(0xc2)],'wallets':{'usdtPolygonWallet':_0x4f63ae[_0x32c8e4(0xcf)],'usdtTrcWallet':_0x4f63ae['usdtTrcWallet'],'usdtErcWallet':_0x4f63ae[_0x32c8e4(0x187)],'usdcPolygonWallet':_0x4f63ae['usdcPolygonWallet']},'status':_0x4f63ae[_0x32c8e4(0x12a)],'createdAt':_0x4f63ae[_0x32c8e4(0xd0)]};}async[a38_0x4a5945(0x151)](_0x1363f3){const _0x3a0874=a38_0x4a5945,_0xbb4967=await database_1[_0x3a0874(0x105)][_0x3a0874(0xa1)]['update']({'where':{'id':_0x1363f3},'data':{'status':'SUSPENDED'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0xbb4967['id'],'fullName':_0xbb4967[_0x3a0874(0x17e)],'username':_0xbb4967[_0x3a0874(0x166)],'telegramId':_0xbb4967[_0x3a0874(0x1ab)],'merchantUrl':_0xbb4967[_0x3a0874(0x158)],'gateways':_0xbb4967[_0x3a0874(0x12c)]?JSON[_0x3a0874(0xb8)](_0xbb4967['paymentGateways']):null,'gatewaySettings':_0xbb4967[_0x3a0874(0x183)]?JSON['parse'](_0xbb4967[_0x3a0874(0x183)]):null,'publicKey':_0xbb4967[_0x3a0874(0xc2)],'wallets':{'usdtPolygonWallet':_0xbb4967['usdtPolygonWallet'],'usdtTrcWallet':_0xbb4967['usdtTrcWallet'],'usdtErcWallet':_0xbb4967[_0x3a0874(0x187)],'usdcPolygonWallet':_0xbb4967[_0x3a0874(0x16c)]},'status':_0xbb4967[_0x3a0874(0x12a)],'createdAt':_0xbb4967['createdAt']};}async[a38_0x4a5945(0xc6)](_0x2140ea){const _0x5c5942=a38_0x4a5945,_0x5f8b2e=await database_1[_0x5c5942(0x105)][_0x5c5942(0xa1)][_0x5c5942(0x1cf)]({'where':{'id':_0x2140ea},'data':{'status':_0x5c5942(0xe5)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x5f8b2e['id'],'fullName':_0x5f8b2e[_0x5c5942(0x17e)],'username':_0x5f8b2e[_0x5c5942(0x166)],'telegramId':_0x5f8b2e[_0x5c5942(0x1ab)],'merchantUrl':_0x5f8b2e[_0x5c5942(0x158)],'gateways':_0x5f8b2e[_0x5c5942(0x12c)]?JSON[_0x5c5942(0xb8)](_0x5f8b2e[_0x5c5942(0x12c)]):null,'gatewaySettings':_0x5f8b2e[_0x5c5942(0x183)]?JSON['parse'](_0x5f8b2e['gatewaySettings']):null,'publicKey':_0x5f8b2e['publicKey'],'wallets':{'usdtPolygonWallet':_0x5f8b2e[_0x5c5942(0xcf)],'usdtTrcWallet':_0x5f8b2e[_0x5c5942(0x195)],'usdtErcWallet':_0x5f8b2e[_0x5c5942(0x187)],'usdcPolygonWallet':_0x5f8b2e[_0x5c5942(0x16c)]},'status':_0x5f8b2e[_0x5c5942(0x12a)],'createdAt':_0x5f8b2e[_0x5c5942(0xd0)]};}async[a38_0x4a5945(0x1e6)](_0x22aca6){const _0x294de6=a38_0x4a5945,{page:_0x53bf1b,limit:_0x233f16,status:_0x2144a5}=_0x22aca6,_0x4ca6fc=(_0x53bf1b-0x1)*_0x233f16,_0x7fb984={};_0x2144a5&&(_0x7fb984[_0x294de6(0x12a)]=_0x2144a5[_0x294de6(0x133)]());const [_0x1c9dd2,_0x4fc436]=await Promise[_0x294de6(0x19e)]([database_1[_0x294de6(0x105)][_0x294de6(0xa1)]['findMany']({'where':_0x7fb984,'skip':_0x4ca6fc,'take':_0x233f16,'orderBy':{'createdAt':_0x294de6(0xe1)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x294de6(0x105)]['shop'][_0x294de6(0x13e)]({'where':_0x7fb984})]);return{'users':_0x1c9dd2['map'](_0x15e66e=>{const _0x4c5eed=_0x294de6,_0x3f302d=_0x15e66e[_0x4c5eed(0x12c)]?JSON[_0x4c5eed(0xb8)](_0x15e66e[_0x4c5eed(0x12c)]):null,_0x32c8c8=_0x3f302d?_0x3f302d[_0x4c5eed(0x1c1)](_0xe040f1=>this[_0x4c5eed(0x155)](_0xe040f1)):null;return{'id':_0x15e66e['id'],'fullName':_0x15e66e[_0x4c5eed(0x17e)],'username':_0x15e66e[_0x4c5eed(0x166)],'telegramId':_0x15e66e['telegram'],'merchantUrl':_0x15e66e[_0x4c5eed(0x158)],'gateways':_0x32c8c8,'gatewaySettings':_0x15e66e[_0x4c5eed(0x183)]?JSON[_0x4c5eed(0xb8)](_0x15e66e[_0x4c5eed(0x183)]):null,'publicKey':_0x15e66e[_0x4c5eed(0xc2)],'wallets':{'usdtPolygonWallet':_0x15e66e[_0x4c5eed(0xcf)],'usdtTrcWallet':_0x15e66e[_0x4c5eed(0x195)],'usdtErcWallet':_0x15e66e[_0x4c5eed(0x187)],'usdcPolygonWallet':_0x15e66e['usdcPolygonWallet']},'status':_0x15e66e[_0x4c5eed(0x12a)],'createdAt':_0x15e66e[_0x4c5eed(0xd0)]};}),'pagination':{'page':_0x53bf1b,'limit':_0x233f16,'total':_0x4fc436,'totalPages':Math[_0x294de6(0xff)](_0x4fc436/_0x233f16)}};}async['getUserById'](_0x5104ec){const _0x38fa27=a38_0x4a5945,_0x136105=await database_1[_0x38fa27(0x105)][_0x38fa27(0xa1)][_0x38fa27(0x1de)]({'where':{'id':_0x5104ec},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x136105)return null;const _0x5b9328=_0x136105['paymentGateways']?JSON[_0x38fa27(0xb8)](_0x136105['paymentGateways']):null,_0xe71f3a=_0x5b9328?_0x5b9328['map'](_0x466c74=>this['getGatewayDisplayName'](_0x466c74)):null;return _0x5b9328&&_0xe71f3a&&console[_0x38fa27(0x143)](_0x38fa27(0x196),_0x5b9328,'->',_0xe71f3a),{'id':_0x136105['id'],'fullName':_0x136105[_0x38fa27(0x17e)],'username':_0x136105[_0x38fa27(0x166)],'telegramId':_0x136105[_0x38fa27(0x1ab)],'merchantUrl':_0x136105['shopUrl'],'gateways':_0xe71f3a,'gatewaySettings':_0x136105[_0x38fa27(0x183)]?JSON[_0x38fa27(0xb8)](_0x136105[_0x38fa27(0x183)]):null,'publicKey':_0x136105[_0x38fa27(0xc2)],'wallets':{'usdtPolygonWallet':_0x136105[_0x38fa27(0xcf)],'usdtTrcWallet':_0x136105['usdtTrcWallet'],'usdtErcWallet':_0x136105[_0x38fa27(0x187)],'usdcPolygonWallet':_0x136105[_0x38fa27(0x16c)]},'status':_0x136105[_0x38fa27(0x12a)],'createdAt':_0x136105[_0x38fa27(0xd0)]};}async[a38_0x4a5945(0x167)](_0x543001){const _0x52eca5=a38_0x4a5945,{fullName:_0x524266,username:_0x276589,password:_0x4d8c81,telegramId:_0x44176a,merchantUrl:_0x5390e6,gateways:_0x29da28,gatewaySettings:_0x1329b7,wallets:_0xe8da70}=_0x543001,_0x4b342b=await database_1['default'][_0x52eca5(0xa1)]['findUnique']({'where':{'username':_0x276589}});if(_0x4b342b)throw new Error('Username\x20already\x20exists');if(_0x44176a){const _0x2a02bc=await database_1[_0x52eca5(0x105)][_0x52eca5(0xa1)]['findUnique']({'where':{'telegram':_0x44176a}});if(_0x2a02bc)throw new Error(_0x52eca5(0xeb));}const _0x202ac=await bcryptjs_1[_0x52eca5(0x105)][_0x52eca5(0xf3)](_0x4d8c81,0xc),_0x183baf=_0x52eca5(0xc9)+crypto_1[_0x52eca5(0x105)][_0x52eca5(0x1a4)](0x20)[_0x52eca5(0x117)](_0x52eca5(0x137)),_0xda5ed0=_0x52eca5(0xc0)+crypto_1[_0x52eca5(0x105)][_0x52eca5(0x1a4)](0x20)[_0x52eca5(0x117)]('hex'),_0x174a9=_0x29da28?_0x29da28[_0x52eca5(0x1c1)](_0x4395f8=>this[_0x52eca5(0xca)](_0x4395f8)):null;_0x29da28&&_0x174a9&&console[_0x52eca5(0x143)](_0x52eca5(0x1e4),_0x29da28,'->',_0x174a9);const _0x147722=await database_1[_0x52eca5(0x105)]['shop']['create']({'data':{'name':_0x524266,'username':_0x276589,'password':_0x202ac,'telegram':_0x44176a,'shopUrl':_0x5390e6,'paymentGateways':_0x174a9?JSON[_0x52eca5(0xb3)](_0x174a9):null,'gatewaySettings':_0x1329b7?JSON['stringify'](_0x1329b7):null,'usdtPolygonWallet':_0xe8da70?.['usdtPolygonWallet']||null,'usdtTrcWallet':_0xe8da70?.[_0x52eca5(0x195)]||null,'usdtErcWallet':_0xe8da70?.[_0x52eca5(0x187)]||null,'usdcPolygonWallet':_0xe8da70?.[_0x52eca5(0x16c)]||null,'publicKey':_0x183baf,'secretKey':_0xda5ed0,'status':_0x52eca5(0xe5)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x147722['id'],'fullName':_0x147722[_0x52eca5(0x17e)],'username':_0x147722[_0x52eca5(0x166)],'telegramId':_0x147722[_0x52eca5(0x1ab)],'merchantUrl':_0x147722[_0x52eca5(0x158)],'gateways':_0x147722[_0x52eca5(0x12c)]?JSON[_0x52eca5(0xb8)](_0x147722['paymentGateways']):null,'gatewaySettings':_0x147722['gatewaySettings']?JSON[_0x52eca5(0xb8)](_0x147722[_0x52eca5(0x183)]):null,'publicKey':_0x147722['publicKey'],'wallets':{'usdtPolygonWallet':_0x147722[_0x52eca5(0xcf)],'usdtTrcWallet':_0x147722['usdtTrcWallet'],'usdtErcWallet':_0x147722[_0x52eca5(0x187)],'usdcPolygonWallet':_0x147722['usdcPolygonWallet']},'status':_0x147722[_0x52eca5(0x12a)],'createdAt':_0x147722[_0x52eca5(0xd0)]};}async[a38_0x4a5945(0xdb)](_0x2a212d){const _0x12b316=a38_0x4a5945;await database_1[_0x12b316(0x105)][_0x12b316(0xa1)]['delete']({'where':{'id':_0x2a212d}});}[a38_0x4a5945(0x9f)](_0x386a61,_0xf9f7e2,_0x336774){const _0x256091=a38_0x4a5945,_0x539d0e=new Map(),_0x183414=new Date(_0xf9f7e2);while(_0x183414<=_0x336774){const _0x1df1cf=_0x183414[_0x256091(0x1d7)]()[_0x256091(0xde)]('T')[0x0];_0x539d0e[_0x256091(0x19c)](_0x1df1cf,{'revenue':0x0,'count':0x0}),_0x183414[_0x256091(0x164)](_0x183414[_0x256091(0xe2)]()+0x1);}for(const _0x46109c of _0x386a61){const _0x368142=_0x46109c[_0x256091(0xd0)][_0x256091(0x1d7)]()['split']('T')[0x0],_0x3a747b=_0x539d0e[_0x256091(0x1ba)](_0x368142);_0x3a747b&&(_0x3a747b['count']+=0x1,_0x46109c[_0x256091(0x12a)]===_0x256091(0x16f)&&(_0x46109c[_0x256091(0xa3)]?_0x3a747b[_0x256091(0xd2)]+=_0x46109c[_0x256091(0xa3)]:console[_0x256091(0x143)](_0x256091(0xaa)+_0x46109c['id']+_0x256091(0x1b0))));}const _0x4cec7c=[],_0x63187d=[];for(const [_0x4cfb41,_0xd3ae19]of _0x539d0e){_0x4cec7c[_0x256091(0x169)]({'date':_0x4cfb41,'amount':Math[_0x256091(0x139)](_0xd3ae19[_0x256091(0xd2)]*0x64)/0x64}),_0x63187d[_0x256091(0x169)]({'date':_0x4cfb41,'count':_0xd3ae19[_0x256091(0x13e)]});}return{'dailyRevenue':_0x4cec7c,'dailyPayments':_0x63187d};}}function a38_0x394b(){const _0x5f3e84=['thisMonth','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','💰\x20[PAYOUT]\x20Merchant\x20','randomBytes','klyme_de','\x20\x20\x20💰\x20Total\x20turnover:\x20','getPaymentById','PENDING','plisio','totalAmountUSDT','telegram','amount',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','\x20no\x20longer\x20PAID:','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','polygon_usdc','📊\x20Using\x20saved\x20values\x20for\x20payment\x20','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','updatedAt','\x27\x20to\x20name\x20\x27','asc','customerCountry','652090aAJtWp','polygon','get','\x20USDT\x20(same\x20as\x20awaiting)','✅\x20Using\x20gateway\x20filter:\x20\x27','getPayoutById','🎯\x20updateUser\x20called\x20with\x20ID:\x20','commission','currencyService','map','network','toFixed','insensitive','gateways','30d','sort','🔄\x20Converted\x20gateway\x20name\x20\x27','txid','week','customerIp','not\x20set','\x20\x20\x20📅\x20This\x20month:\x20','values','update','\x20\x20\x20Merchant\x20gets:\x20','\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)','warn','💳\x20Payout\x20wallet\x20for\x20','0000','\x20USDT\x20(after\x20','klyme_eu','toISOString','findMany','Error\x20processing\x20payment\x20','\x20USDT,\x20Requested:\x20','includes','getMonth','\x20\x20\x20✅\x20Total\x20available\x20for\x20payout:\x20','findUnique','\x27\x20not\x20found.\x20Available\x20gateways:\x20','getTime','\x20USDT\x20(-','notes','./currencyService','🔄\x20Gateway\x20mapping\x20(create):','failUrl','getAllUsers','getPayoutStats','getGatewayIdByName','findFirst','payout','generateDailyStatistics','\x20\x20\x20Transaction\x20hash:\x20','shop','pendingUrl','amountUSDT','erc20','\x20USDT\x20(+','💱\x20Currency\x20filter\x20applied:\x20','📊\x20Sorting\x20payments\x20by\x20','cointopay','password','⚠️\x20Payment\x20','\x20\x20\x20Gateway:\x20','Noda','🔐\x20[','__esModule','fullName','gatewayCommissionRate','getAllPayments','REFUND','stringify','%\x20commission)','\x20\x20\x20Added\x20to\x20balance:\x20+','currency','paidOutUSDT','parse','create','date','lte','adminNotes','💸\x20CHARGEBACK:\x20Merchant\x20amount\x20already\x20deducted\x20from\x20balance','💰\x20[PAYOUT]\x20Gateway\x20','\x20\x20\x20Current\x20balance:\x20','sk_','reduce','publicKey','CHARGEBACK','customerUa','153uNemyK','activateUser','setHours','🎯\x20[','pk_','getGatewayInternalName','1903856nMrmDl','⚠️\x20Requested\x20gateway\x20\x27','getGatewayNameById','test_gateway','usdtPolygonWallet','createdAt','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','revenue','\x27\x20->\x20ID\x20\x27','turnover','\x20PAID\x20payments','getFullYear','trc20','\x20\x20\x20Payout\x20amount:\x20','\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...','\x20merchants','deleteUser','merchantEarningsUSDT','localeCompare','split','📊\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','year','desc','getDate','gateway','\x20\x20\x20�\x20Total\x20paid\x20out:\x20','ACTIVE',',\x20userId:\x20','shopId','\x20USDT)','noda','\x20for\x20shop\x20','Telegram\x20username\x20already\x20exists','📊\x20Available\x20gateways\x20in\x20database:','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','📊\x20Getting\x20payments\x20with\x20filters:','\x20\x20\x20💳\x20Total\x20payments:\x20','\x20paid\x20payments\x20for\x20analysis','556815RvxzAg','KLYME\x20EU','hash','crypto','statusChangedBy','\x20order','2905256Oyeyjx','gatewayOrderId','commissionUSDT','merchantEarnings','\x20USDT\x20(current\x20balance\x20in\x20DB)','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','paymentsCount','📊\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','ceil','📋\x20Found\x20','💰\x20Current\x20shop\x20balance:\x20','telegramId','dailyPayments','paidAt','default','\x20\x20\x20✅\x20Actual\x20available\x20balance:\x20','dateFrom','gte','KLYME\x20DE','\x20payments)','payment','gatewayEarnings','dateTo','AdminService','🔄\x20Admin\x20updating\x20payment\x20','../types/gateway','Rapyd','period','random','2058516AsTMiH','📅\x20Period:\x20','\x20\x20\x20💸\x20Total\x20payouts:\x20','toString','2020-01-01','$transaction','whiteUrl','Shop\x20not\x20found','getMerchantStatistics','📊\x20Calculating\x20payout\x20statistics...','createPayout','entries','28916Mfsdkm','📊\x20Total\x20payments\x20(including\x20failed):\x20','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','\x20\x20\x20💰\x20Total\x20payout:\x20','chargebackAmount','totalCommissionRate','1307163xTgwgO','💰\x20Shop\x20','\x20\x20\x20🔍\x20Calculated\x20after\x20commission:\x20','__importDefault','status','\x20\x20\x20💸\x20Total\x20payouts\x20(all\x20time):\x20','paymentGateways','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','_sum','forEach','klyme_gb','aggregate','getMerchantsAwaitingPayout','toUpperCase',',\x20successful:\x20','totalTurnover','\x20USDT\x20(total\x20paid\x20to\x20merchants)','hex','day','round','\x20USDT','\x20USDT\x20(theoretical\x20net)','\x20\x20\x20🤔\x20Difference:\x20','totalPaidOut','count','📊\x20Merchants\x20awaiting\x20payout:\x20','admin','\x20became\x20PAID:','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','log','rapyd','amountAfterCommissionUSDT','\x20\x20\x20🖥️\x20User\x20Agent:\x20','\x20\x20\x20Merchant\x20loses:\x20','\x20\x20\x20Balance:\x20','amountAfterGatewayCommissionUSDT','Payment\x20not\x20found','pendingPayout','\x20\x20\x20💰\x20Total\x20payments\x20turnover:\x20','\x20\x20\x20Full\x20amount:\x20','\x20USDT\x20for\x20payment\x20','\x20balance\x20updated:','wallets','suspendUser','\x20USDT\x20(gross\x20revenue)','getAllPayouts','\x27\x20->\x20name\x20\x27','getGatewayDisplayName','\x20\x20\x20�📊\x20Total\x20payments:\x20','orderId','shopUrl','🔄\x20Converted\x20gateway\x20ID\x20\x27','convertToUSDT',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','custom','length','customerEmail','💰\x20Found\x20','💸\x20CHARGEBACK\x20penalty:\x20-','some','💰\x20Creating\x20payout\x20for\x20shop\x20','turnoverUSDT','setDate','awaitingPayout','username','createUser','periodTo','push','\x27\x20(from\x20\x27','averageCheckUSDT','usdcPolygonWallet','Insufficient\x20balance.\x20Available:\x20','customerName','PAID','\x20in\x20','mastercard','totalPayout','\x20USDT,\x20merchant:\x20','\x20->\x20','MasterCard','\x20USDT\x20(already\x20paid\x20out)','\x20to\x20','_count','261UCbHQH','\x20USDT\x20from\x20balance','error','📋\x20Getting\x20merchants\x20selection\x20list...','%\x20from\x20','name','📊\x20Gateway\x20filter\x20applied:','join','toLowerCase','✅\x20Payout\x20created:\x20','gatewaySettings','\x20\x20\x20⏳\x20Pending\x20payout:\x20','🔄\x20Gateway\x20mapping:','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','usdtErcWallet','updateUser','📊\x20Calculated\x20commission\x20rate\x20for\x20payment\x20','🔧\x20[','periodFrom','🔍\x20Using\x20gateway\x20\x27','💰\x20Payment\x20','groupBy','90d','merchantUrl','averageCommissionRate','Plisio','📊\x20Final\x20WHERE\x20conditions:',',\x20Commission:\x20','usdtTrcWallet','🔄\x20Gateway\x20mapping\x20(get):','\x20\x20\x20�\x20Total\x20payments\x20turnover:\x20',']\x20Gateway\x20settings\x20JSON\x20string:','COMPLETED','\x20balance\x20updated:\x20','yesterday','set','balance','all','📊\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','\x20\x20\x20🌍\x20Country:\x20'];a38_0x394b=function(){return _0x5f3e84;};return a38_0x394b();}exports[a38_0x4a5945(0x10e)]=AdminService;