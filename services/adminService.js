'use strict';const a35_0x33dfec=a35_0x5ab1;function a35_0x1dbd(){const _0x54c038=['cointopay','\x20\x20\x20Balance:\x20','createUser','klyme_de','KLYME\x20DE','\x20\x20\x20🔍\x20Calculated\x20after\x20commission:\x20','getPayoutStats','REFUND','paymentsCount','ACTIVE','Test\x20Gateway','\x20in\x20','🔄\x20Converted\x20gateway\x20name\x20\x27','toFixed','dateFrom','KLYME\x20EU','💰\x20Creating\x20payout\x20for\x20shop\x20','status','round','🔄\x20Converted\x20gateway\x20ID\x20\x27','Rapyd','publicKey','convertToUSDT','✅\x20Using\x20gateway\x20filter:\x20\x27','crypto','📊\x20Gateway\x20filter\x20applied:','\x20\x20\x20📊\x20Total\x20payments:\x20','💰\x20Payment\x20','rapyd','\x20USDT\x20(total\x20paid\x20to\x20merchants)','getMerchantStatistics','getGatewayInternalName','\x20\x20\x20🌐\x20IP:\x20','571542oXOHyH','4310514TDNArD','💰\x20[PAYOUT]\x20Gateway\x20','117190spQHoy',',\x20successful:\x20','trc20','turnover','7852792BJFYBs','3302725YIBqdO','../types/gateway','get','_sum','SUSPENDED','telegram','getMonth','amount','\x20\x20\x20📅\x20This\x20month:\x20','\x20\x20\x20🌍\x20Country:\x20','🔄\x20Gateway\x20mapping\x20(create):','\x20payments)',',\x20Commission:\x20','amountUSDT','shop','whiteUrl','getAllPayments','updatePaymentStatus','getDate','gte','admin','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','erc20','🔄\x20Gateway\x20mapping:','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','paidAt','name','randomBytes','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','telegramId','\x20\x20\x20Merchant\x20loses:\x20','__importDefault','totalPayments','parse','update','chargebackAmount','Telegram\x20username\x20already\x20exists','updateCustomerData','AdminService','map','\x20\x20\x20�\x20Total\x20payments\x20turnover:\x20','\x20USDT\x20(after\x20payouts)','set','fullName','ceil','\x20active\x20merchants\x20for\x20selection','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','payment','paymentGateways','\x20balance\x20updated:','shopId','shopUrl','CoinToPay','\x20\x20\x20Merchant\x20gets:\x20','toISOString','\x20USDT\x20(same\x20as\x20awaiting)','wallets','merchantUrl','totalAmountAfterCommissionUSDT','stringify','\x20\x20\x20Added\x20to\x20balance:\x20+','dailyPayments','dailyRevenue','\x20\x20\x20✅\x20Actual\x20available\x20balance:\x20','dateTo','reduce','defineProperty','findFirst','\x20\x20\x20Total\x20paid\x20out:\x20','createPayout','\x20USDT\x20from\x20balance','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','asc','📋\x20Found\x20','getSystemStatistics','totalCommissionRate','Open\x20Banking\x202','amountAfterCommissionUSDT','KLYME\x20GB','⚠️\x20Gateway\x20\x27','💰\x20Shop\x20','\x20merchants','split','create','%\x20commission)','period','hex','adminNotes','week','0000','💰\x20Found\x20','balance','\x20\x20\x20📊\x20Commission\x20difference:\x20','externalPaymentUrl','getMerchantsAwaitingPayout','getPaymentById','usdtErcWallet','🔄\x20Admin\x20updating\x20payment\x20','💸\x20CHARGEBACK:\x20Merchant\x20amount\x20already\x20deducted\x20from\x20balance','COMPLETED','network','commission','675776wyAiiN','count','failureMessage','📊\x20Final\x20WHERE\x20conditions:','customerIp','currencyService','__esModule','gatewayEarnings','\x20\x20\x20Gateway:\x20','\x20for\x20shop\x20','availableBalance','statusChangedBy','\x20USDT','../config/database','MasterCard','failUrl','orderId','pendingUrl','pk_','Error\x20processing\x20payment\x20','💸\x20CHARGEBACK\x20penalty:\x20-','notes','commissionUSDT','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','2020-01-01','\x20\x20\x20Transaction\x20hash:\x20','\x27\x20(from\x20\x27','hash','findUnique','txid','getTime','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','toLowerCase','periodTo','\x20\x20\x20Full\x20amount:\x20','insensitive','\x20balance\x20updated:\x20','generateDailyStatistics','lte','\x20USDT)','Username\x20already\x20exists','merchantEarnings','\x20USDT\x20(gross\x20revenue)','\x20\x20\x20Payout\x20amount:\x20','customerName','periodFrom','currency','_count','log','createdAt','password','totalPaidOut','34sVKIjm','\x20USDT\x20(after\x20','📊\x20Sorting\x20payments\x20by\x20','getGatewayNameById','gateways','\x20PAID\x20payments','localeCompare','customerUa','$transaction','getFullYear','toUpperCase','deletePayout','cointopay2','\x27\x20not\x20found.\x20Available\x20gateways:\x20','\x20\x20\x20💰\x20Total\x20turnover:\x20','desc','\x20\x20\x20💸\x20Total\x20payouts\x20(all\x20time):\x20','📊\x20Getting\x20payments\x20with\x20filters:','findMany','\x20\x20\x20💵\x20Available\x20balance:\x20','\x20USDT\x20(','\x27\x20to\x20name\x20\x27','test_gateway','✅\x20Payout\x20created:\x20','polygon','entries','\x20paid\x20payments\x20for\x20analysis','payout','./currencyService','\x20\x20\x20💰\x20Total\x20payout:\x20','gatewaySettings','\x20USDT\x20(without\x20commission)','values','\x20->\x20','gateway','delete','customerEmail','\x20USDT\x20(-','💰\x20Current\x20shop\x20balance:\x20','usdtPolygonWallet','📊\x20Calculating\x20payout\x20statistics...','⚠️\x20Payment\x20','usdcPolygonWallet','155241tuxDCh','📅\x20Period\x20\x27all\x27:\x20Using\x20start\x20date\x20from\x20first\x20payment:\x20','push','username','turnoverUSDT','\x27\x20->\x20ID\x20\x27','noda','\x20USDT\x20(actual\x20balances)','includes','Insufficient\x20balance.\x20Available:\x20','updatedAt','\x20\x20\x20Current\x20balance:\x20','📊\x20Merchant\x20statistics\x20calculated:','awaitingPayout','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','\x20\x20\x20📅\x20Total\x20payouts\x20(this\x20month):\x20','getGatewayDisplayName','Shop\x20not\x20found','gatewayOrderId','getAllUsers','4VrtiBX','sort','\x20\x20\x20💳\x20Total\x20payments:\x20','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','all','bcryptjs','paidOutUSDT','\x20\x20\x20💰\x20Total\x20payments\x20turnover:\x20','summary','\x20USDT\x20(+','📋\x20Getting\x20merchants\x20selection\x20list...','date','\x20status:\x20','toString','default','💱\x20Currency\x20filter\x20applied:\x20','💰\x20[PAYOUT]\x20Merchant\x20','averageCommissionRate','customerCountry','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','\x20\x20\x20✅\x20Total\x20available\x20for\x20payout:\x20','\x20to\x20','klyme_eu','error','deleteUser','Payment\x20not\x20found','merchantEarningsUSDT','usdtTrcWallet','\x20no\x20longer\x20PAID:','month','PAID','90d','length','getMerchantsSelection','🔄\x20Gateway\x20mapping\x20(get):','\x20USDT\x20(theoretical\x20net)','\x20became\x20PAID:',':\x20commission\x20=\x20','not\x20specified','not\x20set','groupBy','28PyFRCu','thisMonth','NONEXISTENT_GATEWAY_FILTER','totalAmountUSDT','📊\x20Available\x20gateways\x20in\x20database:','715mZILfI','aggregate','📊\x20Merchants\x20awaiting\x20payout:\x20','custom'];a35_0x1dbd=function(){return _0x54c038;};return a35_0x1dbd();}(function(_0x23dda4,_0x55f7ce){const _0x2dd16e=a35_0x5ab1,_0x15fef2=_0x23dda4();while(!![]){try{const _0x36d5d5=-parseInt(_0x2dd16e(0x198))/0x1+-parseInt(_0x2dd16e(0x1cc))/0x2*(-parseInt(_0x2dd16e(0x1f7))/0x3)+-parseInt(_0x2dd16e(0xd5))/0x4*(-parseInt(_0x2dd16e(0x130))/0x5)+parseInt(_0x2dd16e(0x128))/0x6*(parseInt(_0x2dd16e(0xfe))/0x7)+-parseInt(_0x2dd16e(0x12f))/0x8+-parseInt(_0x2dd16e(0x129))/0x9+parseInt(_0x2dd16e(0x12b))/0xa*(parseInt(_0x2dd16e(0x103))/0xb);if(_0x36d5d5===_0x55f7ce)break;else _0x15fef2['push'](_0x15fef2['shift']());}catch(_0x39d9b3){_0x15fef2['push'](_0x15fef2['shift']());}}}(a35_0x1dbd,0x8577e));var __importDefault=this&&this[a35_0x33dfec(0x150)]||function(_0x3c36b3){return _0x3c36b3&&_0x3c36b3['__esModule']?_0x3c36b3:{'default':_0x3c36b3};};Object[a35_0x33dfec(0x174)](exports,a35_0x33dfec(0x19e),{'value':!![]}),exports[a35_0x33dfec(0x157)]=void 0x0;const database_1=__importDefault(require(a35_0x33dfec(0x1a5))),bcryptjs_1=__importDefault(require(a35_0x33dfec(0xda))),crypto_1=__importDefault(require(a35_0x33dfec(0x11f))),currencyService_1=require(a35_0x33dfec(0x1e8)),gateway_1=require(a35_0x33dfec(0x131));function a35_0x5ab1(_0x112286,_0x2167a2){const _0x1dbd54=a35_0x1dbd();return a35_0x5ab1=function(_0x5ab1e3,_0x367de9){_0x5ab1e3=_0x5ab1e3-0xc6;let _0x29486e=_0x1dbd54[_0x5ab1e3];return _0x29486e;},a35_0x5ab1(_0x112286,_0x2167a2);}class AdminService{async[a35_0x33dfec(0x10d)](){const _0x4b0ef1=a35_0x33dfec;console[_0x4b0ef1(0x1c8)](_0x4b0ef1(0x1f4));const _0x338b27=await database_1['default']['shop'][_0x4b0ef1(0x104)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x4b0ef1(0x110)}}),_0x1e7c91=await this[_0x4b0ef1(0x190)]({'page':0x1,'limit':0x3e8}),_0x44753a=await database_1[_0x4b0ef1(0xe3)][_0x4b0ef1(0x161)]['count']({'where':{'status':_0x4b0ef1(0xf3),'gateway':{'not':_0x4b0ef1(0x1e2)}}}),_0x43b523=new Date(),_0x526f9c=new Date(_0x43b523[_0x4b0ef1(0x1d5)](),_0x43b523[_0x4b0ef1(0x136)](),0x1),_0x2077e9=new Date(_0x43b523[_0x4b0ef1(0x1d5)](),_0x43b523[_0x4b0ef1(0x136)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x1aa3e4=await database_1['default'][_0x4b0ef1(0x1e7)][_0x4b0ef1(0x104)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x526f9c,'lte':_0x2077e9},'status':'COMPLETED'}}),_0x23ff81=_0x338b27[_0x4b0ef1(0x133)][_0x4b0ef1(0x1cb)]||0x0,_0x5964af=_0x1e7c91[_0x4b0ef1(0xdd)][_0x4b0ef1(0x16c)],_0x53c1f9=_0x1aa3e4['_sum'][_0x4b0ef1(0x137)]||0x0,_0x2cba7f={'totalPayout':Math[_0x4b0ef1(0x119)](_0x23ff81*0x64)/0x64,'awaitingPayout':Math['round'](_0x5964af*0x64)/0x64,'thisMonth':Math[_0x4b0ef1(0x119)](_0x53c1f9*0x64)/0x64,'availableBalance':Math['round'](_0x5964af*0x64)/0x64,'totalPayments':_0x44753a};return console['log']('📊\x20Payout\x20statistics\x20calculated:'),console['log'](_0x4b0ef1(0x1e9)+_0x2cba7f['totalPayout']+_0x4b0ef1(0x124)),console[_0x4b0ef1(0x1c8)](_0x4b0ef1(0x145)+_0x2cba7f[_0x4b0ef1(0xce)]+'\x20USDT\x20(with\x20commission\x20deducted)'),console['log'](_0x4b0ef1(0x1df)+_0x2cba7f[_0x4b0ef1(0x1a2)]+_0x4b0ef1(0x169)),console[_0x4b0ef1(0x1c8)](_0x4b0ef1(0x138)+_0x2cba7f[_0x4b0ef1(0xff)]+'\x20USDT'),console[_0x4b0ef1(0x1c8)](_0x4b0ef1(0xd7)+_0x2cba7f[_0x4b0ef1(0x151)]+_0x4b0ef1(0x1d1)),console[_0x4b0ef1(0x1c8)]('\x20\x20\x20🔍\x20Raw\x20balance\x20sum:\x20'+(_0x338b27[_0x4b0ef1(0x133)][_0x4b0ef1(0x18d)]||0x0)['toFixed'](0x2)+_0x4b0ef1(0x1eb)),console[_0x4b0ef1(0x1c8)](_0x4b0ef1(0x18e)+((_0x338b27[_0x4b0ef1(0x133)][_0x4b0ef1(0x18d)]||0x0)-_0x5964af)[_0x4b0ef1(0x114)](0x2)+_0x4b0ef1(0x1a4)),_0x2cba7f;}async[a35_0x33dfec(0x156)](_0x2c0e62,_0x115b05){const _0x595504=a35_0x33dfec;console['log'](_0x595504(0x14d)+_0x2c0e62+':',_0x115b05);const _0x222726=await database_1[_0x595504(0xe3)][_0x595504(0x161)][_0x595504(0x1b4)]({'where':{'id':_0x2c0e62},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x222726)throw new Error(_0x595504(0xee));const _0x589add={};_0x115b05[_0x595504(0xe7)]!==undefined&&(_0x589add[_0x595504(0xe7)]=_0x115b05[_0x595504(0xe7)]||null);_0x115b05[_0x595504(0x19c)]!==undefined&&(_0x589add[_0x595504(0x19c)]=_0x115b05['customerIp']||null);_0x115b05['customerUa']!==undefined&&(_0x589add['customerUa']=_0x115b05[_0x595504(0x1d3)]||null);const _0x280ef1=await database_1['default'][_0x595504(0x161)][_0x595504(0x153)]({'where':{'id':_0x2c0e62},'data':{..._0x589add,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x595504(0x1c8)](_0x595504(0xe8)+_0x2c0e62),console[_0x595504(0x1c8)](_0x595504(0x139)+_0x222726[_0x595504(0xe7)]+_0x595504(0x1ed)+_0x280ef1[_0x595504(0xe7)]),console[_0x595504(0x1c8)](_0x595504(0x127)+_0x222726[_0x595504(0x19c)]+'\x20->\x20'+_0x280ef1[_0x595504(0x19c)]),console[_0x595504(0x1c8)]('\x20\x20\x20🖥️\x20User\x20Agent:\x20'+(_0x222726[_0x595504(0x1d3)]?_0x595504(0x15b):_0x595504(0xfc))+_0x595504(0x1ed)+(_0x280ef1[_0x595504(0x1d3)]?_0x595504(0x15b):_0x595504(0xfc))),_0x280ef1;}async[a35_0x33dfec(0x17c)](_0xeb0184){const _0x150952=a35_0x33dfec,_0x358956=new Date();let _0x5ed93e;switch(_0xeb0184){case'7d':_0x5ed93e=new Date(_0x358956[_0x150952(0x1b6)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x5ed93e=new Date(_0x358956[_0x150952(0x1b6)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x150952(0xf4):_0x5ed93e=new Date(_0x358956[_0x150952(0x1b6)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x150952(0xd9):const _0x54852e=await database_1['default']['payment'][_0x150952(0x175)]({'where':{'gateway':{'not':_0x150952(0x1e2)}},'orderBy':{'createdAt':_0x150952(0x17a)},'select':{'createdAt':!![]}});_0x5ed93e=_0x54852e?_0x54852e[_0x150952(0x1c9)]:new Date('2020-01-01'),console[_0x150952(0x1c8)](_0x150952(0x1f8)+_0x5ed93e[_0x150952(0x168)]());break;default:_0x5ed93e=new Date(_0x358956[_0x150952(0x1b6)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x4dfa88,_0x869dbe,_0x2a124e,_0x44eece,_0x1df435,_0x5f2fde,_0x270bb1]=await Promise[_0x150952(0xd9)]([database_1[_0x150952(0xe3)]['shop']['count'](),database_1[_0x150952(0xe3)]['shop'][_0x150952(0x199)]({'where':{'status':_0x150952(0x110)}}),database_1['default'][_0x150952(0x161)]['count']({'where':{'createdAt':{'gte':_0x5ed93e},'gateway':{'not':_0x150952(0x1e2)}}}),database_1[_0x150952(0xe3)]['payment'][_0x150952(0x199)]({'where':{'status':_0x150952(0xf3),'createdAt':{'gte':_0x5ed93e},'gateway':{'not':'test_gateway'}}}),database_1[_0x150952(0xe3)][_0x150952(0x161)]['findMany']({'where':{'status':_0x150952(0xf3),'createdAt':{'gte':_0x5ed93e},'gateway':{'not':_0x150952(0x1e2)}},'select':{'amount':!![],'currency':!![]}}),database_1[_0x150952(0xe3)][_0x150952(0x161)][_0x150952(0x1de)]({'where':{'gateway':{'not':_0x150952(0x1e2)}},'take':0xa,'orderBy':{'createdAt':_0x150952(0x1db)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x150952(0x161)][_0x150952(0x1de)]({'where':{'createdAt':{'gte':_0x5ed93e},'gateway':{'not':_0x150952(0x1e2)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x5b598a=0x0;for(const _0x1d8b7a of _0x1df435){const _0x4b5f5f=await currencyService_1[_0x150952(0x19d)][_0x150952(0x11d)](_0x1d8b7a[_0x150952(0x137)],_0x1d8b7a[_0x150952(0x1c6)]);_0x5b598a+=_0x4b5f5f;}const _0x173245=this[_0x150952(0x1bd)](_0x270bb1,_0x5ed93e,_0x358956),_0xc69509=_0x2a124e>0x0?_0x44eece/_0x2a124e*0x64:0x0;return{'totalShops':_0x4dfa88,'activeShops':_0x869dbe,'totalPayments':_0x2a124e,'successfulPayments':_0x44eece,'totalRevenue':Math[_0x150952(0x119)](_0x5b598a*0x64)/0x64,'conversionRate':Math[_0x150952(0x119)](_0xc69509*0x64)/0x64,'dailyRevenue':_0x173245[_0x150952(0x170)],'dailyPayments':_0x173245[_0x150952(0x16f)],'recentPayments':_0x5f2fde['map'](_0x1e716b=>({'id':_0x1e716b['id'],'amount':_0x1e716b[_0x150952(0x137)],'currency':_0x1e716b[_0x150952(0x1c6)],'status':_0x1e716b['status'],'gateway':_0x1e716b[_0x150952(0x1ee)],'shop':_0x1e716b[_0x150952(0x13e)],'createdAt':_0x1e716b[_0x150952(0x1c9)]}))};}async[a35_0x33dfec(0x125)](_0x272dd6){const _0x4fb0e2=a35_0x33dfec;console[_0x4fb0e2(0x1c8)]('📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:',_0x272dd6);let _0x377f4a,_0x4e8962=new Date();if(_0x272dd6[_0x4fb0e2(0x187)]===_0x4fb0e2(0x106)&&_0x272dd6[_0x4fb0e2(0x115)]&&_0x272dd6[_0x4fb0e2(0x172)])_0x377f4a=new Date(_0x272dd6[_0x4fb0e2(0x115)]),_0x4e8962=new Date(_0x272dd6['dateTo']);else{const _0x3a79d9=new Date();switch(_0x272dd6['period']){case _0x4fb0e2(0x18a):_0x377f4a=new Date(_0x3a79d9[_0x4fb0e2(0x1b6)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x4fb0e2(0xf2):_0x377f4a=new Date(_0x3a79d9[_0x4fb0e2(0x1b6)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'year':_0x377f4a=new Date(_0x3a79d9[_0x4fb0e2(0x1b6)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x4fb0e2(0xd9):default:_0x377f4a=new Date(_0x4fb0e2(0x1b0));break;}}console['log']('📅\x20Period:\x20'+_0x377f4a[_0x4fb0e2(0x168)]()+_0x4fb0e2(0xea)+_0x4e8962[_0x4fb0e2(0x168)]());const _0x3df466={'status':_0x4fb0e2(0xf3),'gateway':{'not':_0x4fb0e2(0x1e2)},'paidAt':{'gte':_0x377f4a,'lte':_0x4e8962}};_0x272dd6[_0x4fb0e2(0x164)]&&(_0x3df466['shopId']=_0x272dd6[_0x4fb0e2(0x164)]);const _0xa721a1=await database_1[_0x4fb0e2(0xe3)][_0x4fb0e2(0x161)]['findMany']({'where':_0x3df466,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x4fb0e2(0x1c8)](_0x4fb0e2(0x18c)+_0xa721a1['length']+_0x4fb0e2(0x1e6));const _0x45f3e8={'gateway':{'not':_0x4fb0e2(0x1e2)},'createdAt':{'gte':_0x377f4a,'lte':_0x4e8962}};_0x272dd6[_0x4fb0e2(0x164)]&&(_0x45f3e8['shopId']=_0x272dd6['shopId']);const _0x151e19=await database_1[_0x4fb0e2(0xe3)][_0x4fb0e2(0x161)][_0x4fb0e2(0x199)]({'where':_0x45f3e8});console['log']('📊\x20Total\x20payments\x20(including\x20failed):\x20'+_0x151e19+_0x4fb0e2(0x12c)+_0xa721a1[_0x4fb0e2(0xf5)]);let _0x268f8a=0x0,_0x1c8387=0x0,_0x145c65=0x0;const _0x1a00ac={},_0x25684b={},_0x4bcab5={};for(const _0xe80398 of _0xa721a1){try{const _0x2a0885=await currencyService_1[_0x4fb0e2(0x19d)]['convertToUSDT'](_0xe80398[_0x4fb0e2(0x137)],_0xe80398[_0x4fb0e2(0x1c6)]);let _0x25a6b4={};if(_0xe80398[_0x4fb0e2(0x13e)][_0x4fb0e2(0x1ea)])try{_0x25a6b4=JSON[_0x4fb0e2(0x152)](_0xe80398[_0x4fb0e2(0x13e)][_0x4fb0e2(0x1ea)]);}catch(_0x4d25d5){console[_0x4fb0e2(0xec)](_0x4fb0e2(0x14c)+_0xe80398[_0x4fb0e2(0x164)]+':',_0x4d25d5);}let _0x141289={},_0xf6b88c=0xa;for(const [_0x402d4e,_0x50d939]of Object['entries'](_0x25a6b4)){if(_0x402d4e[_0x4fb0e2(0x1b8)]()===_0xe80398['gateway'][_0x4fb0e2(0x1b8)]()){_0x141289=_0x50d939,_0xf6b88c=_0x50d939['commission']||0xa;break;}}const _0x309262=_0x2a0885*(_0xf6b88c/0x64),_0x671618=_0x2a0885-_0x309262;_0x268f8a+=_0x2a0885,_0x1c8387+=_0x671618,_0x145c65+=_0x309262;!_0x1a00ac[_0xe80398[_0x4fb0e2(0x1ee)]]&&(_0x1a00ac[_0xe80398['gateway']]={'gateway':_0xe80398[_0x4fb0e2(0x1ee)],'gatewayDisplayName':this[_0x4fb0e2(0xd1)](_0xe80398[_0x4fb0e2(0x1ee)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x1a00ac[_0xe80398['gateway']]['paymentsCount']++,_0x1a00ac[_0xe80398[_0x4fb0e2(0x1ee)]]['turnoverUSDT']+=_0x2a0885,_0x1a00ac[_0xe80398[_0x4fb0e2(0x1ee)]][_0x4fb0e2(0x1ae)]+=_0x309262,_0x1a00ac[_0xe80398[_0x4fb0e2(0x1ee)]][_0x4fb0e2(0xef)]+=_0x671618,_0x1a00ac[_0xe80398[_0x4fb0e2(0x1ee)]][_0x4fb0e2(0x17d)]+=_0xf6b88c;!_0x272dd6[_0x4fb0e2(0x164)]&&(!_0x25684b[_0xe80398[_0x4fb0e2(0x164)]]&&(_0x25684b[_0xe80398['shopId']]={'shopId':_0xe80398[_0x4fb0e2(0x164)],'shopName':_0xe80398[_0x4fb0e2(0x13e)][_0x4fb0e2(0x14a)],'shopUsername':_0xe80398[_0x4fb0e2(0x13e)][_0x4fb0e2(0x1fa)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x25684b[_0xe80398[_0x4fb0e2(0x164)]][_0x4fb0e2(0x10f)]++,_0x25684b[_0xe80398['shopId']][_0x4fb0e2(0x1fb)]+=_0x2a0885,_0x25684b[_0xe80398['shopId']][_0x4fb0e2(0x1ae)]+=_0x309262,_0x25684b[_0xe80398['shopId']][_0x4fb0e2(0xef)]+=_0x671618);const _0x4d4ee8=_0xe80398[_0x4fb0e2(0x149)][_0x4fb0e2(0x168)]()[_0x4fb0e2(0x184)]('T')[0x0];!_0x4bcab5[_0x4d4ee8]&&(_0x4bcab5[_0x4d4ee8]={'date':_0x4d4ee8,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x4bcab5[_0x4d4ee8]['turnover']+=_0x2a0885,_0x4bcab5[_0x4d4ee8][_0x4fb0e2(0x1c1)]+=_0x671618,_0x4bcab5[_0x4d4ee8][_0x4fb0e2(0x19f)]+=_0x309262,_0x4bcab5[_0x4d4ee8][_0x4fb0e2(0x10f)]++;}catch(_0x22d3ba){console[_0x4fb0e2(0xec)](_0x4fb0e2(0x1ab)+_0xe80398['id']+':',_0x22d3ba);}}Object[_0x4fb0e2(0x1ec)](_0x1a00ac)['forEach'](_0x57d3e4=>{const _0x276150=_0x4fb0e2;_0x57d3e4['averageCommissionRate']=_0x57d3e4[_0x276150(0x10f)]>0x0?_0x57d3e4[_0x276150(0x17d)]/_0x57d3e4[_0x276150(0x10f)]:0x0,delete _0x57d3e4['totalCommissionRate'];}),Object['values'](_0x25684b)['forEach'](_0x57f4ff=>{const _0x2bfe1a=_0x4fb0e2;_0x57f4ff['averageCheckUSDT']=_0x57f4ff[_0x2bfe1a(0x10f)]>0x0?_0x57f4ff[_0x2bfe1a(0x1fb)]/_0x57f4ff[_0x2bfe1a(0x10f)]:0x0;});let _0x290d43=0x0;if(_0x272dd6[_0x4fb0e2(0x164)]){const _0x4a9436=await database_1[_0x4fb0e2(0xe3)][_0x4fb0e2(0x1e7)][_0x4fb0e2(0x1de)]({'where':{'shopId':_0x272dd6[_0x4fb0e2(0x164)],'status':'COMPLETED','createdAt':{'gte':_0x377f4a,'lte':_0x4e8962}},'select':{'amount':!![]}});_0x290d43=_0x4a9436['reduce']((_0x21b12d,_0x579658)=>_0x21b12d+_0x579658[_0x4fb0e2(0x137)],0x0);}const _0x4856d4=_0x151e19,_0x33e6ce=_0xa721a1[_0x4fb0e2(0xf5)],_0x2037a2=_0x33e6ce>0x0?_0x268f8a/_0x33e6ce:0x0,_0x1682ce=_0x4856d4>0x0?Math[_0x4fb0e2(0x119)](_0x33e6ce/_0x4856d4*0x2710)/0x64:0x0,_0x116fbe=Math[_0x4fb0e2(0x15d)]((_0x4e8962[_0x4fb0e2(0x1b6)]()-_0x377f4a['getTime']())/(0x3e8*0x3c*0x3c*0x18)),_0x248da1={'totalTurnover':Math[_0x4fb0e2(0x119)](_0x268f8a*0x64)/0x64,'merchantEarnings':Math[_0x4fb0e2(0x119)](_0x1c8387*0x64)/0x64,'gatewayEarnings':Math['round'](_0x145c65*0x64)/0x64,'totalPaidOut':Math[_0x4fb0e2(0x119)](_0x290d43*0x64)/0x64,'averageCheck':Math[_0x4fb0e2(0x119)](_0x2037a2*0x64)/0x64,'totalPayments':_0x4856d4,'successfulPayments':_0x33e6ce,'conversionRate':_0x1682ce,'gatewayBreakdown':Object[_0x4fb0e2(0x1ec)](_0x1a00ac)['map'](_0x3fad65=>({..._0x3fad65,'turnoverUSDT':Math[_0x4fb0e2(0x119)](_0x3fad65[_0x4fb0e2(0x1fb)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x3fad65[_0x4fb0e2(0x1ae)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x3fad65[_0x4fb0e2(0xef)]*0x64)/0x64,'averageCommissionRate':Math['round'](_0x3fad65[_0x4fb0e2(0xe6)]*0x64)/0x64})),'merchantBreakdown':_0x272dd6[_0x4fb0e2(0x164)]?undefined:Object[_0x4fb0e2(0x1ec)](_0x25684b)['map'](_0x107b17=>({..._0x107b17,'turnoverUSDT':Math[_0x4fb0e2(0x119)](_0x107b17[_0x4fb0e2(0x1fb)]*0x64)/0x64,'commissionUSDT':Math[_0x4fb0e2(0x119)](_0x107b17[_0x4fb0e2(0x1ae)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x4fb0e2(0x119)](_0x107b17[_0x4fb0e2(0xef)]*0x64)/0x64,'paidOutUSDT':Math['round'](_0x107b17[_0x4fb0e2(0xdb)]*0x64)/0x64,'averageCheckUSDT':Math[_0x4fb0e2(0x119)](_0x107b17['averageCheckUSDT']*0x64)/0x64})),'dailyData':Object[_0x4fb0e2(0x1ec)](_0x4bcab5)[_0x4fb0e2(0x158)](_0x336d6f=>({..._0x336d6f,'turnover':Math['round'](_0x336d6f[_0x4fb0e2(0x12e)]*0x64)/0x64,'merchantEarnings':Math['round'](_0x336d6f[_0x4fb0e2(0x1c1)]*0x64)/0x64,'gatewayEarnings':Math[_0x4fb0e2(0x119)](_0x336d6f[_0x4fb0e2(0x19f)]*0x64)/0x64}))[_0x4fb0e2(0xd6)]((_0x1e17a2,_0x23dedb)=>_0x1e17a2[_0x4fb0e2(0xe0)][_0x4fb0e2(0x1d2)](_0x23dedb[_0x4fb0e2(0xe0)])),'periodInfo':{'from':_0x377f4a,'to':_0x4e8962,'periodType':_0x272dd6[_0x4fb0e2(0x187)]||'custom','daysCount':_0x116fbe}};return console['log'](_0x4fb0e2(0xcd)),console[_0x4fb0e2(0x1c8)](_0x4fb0e2(0x1da)+_0x248da1['totalTurnover']+_0x4fb0e2(0x1a4)),console[_0x4fb0e2(0x1c8)](_0x4fb0e2(0x179)+_0x248da1[_0x4fb0e2(0x1c1)]+_0x4fb0e2(0x1a4)),console[_0x4fb0e2(0x1c8)](_0x4fb0e2(0x148)+_0x248da1[_0x4fb0e2(0x19f)]+_0x4fb0e2(0x1a4)),console['log'](_0x4fb0e2(0x121)+_0x248da1[_0x4fb0e2(0x151)]),_0x248da1;}async[a35_0x33dfec(0xf6)](){const _0x35f0ea=a35_0x33dfec;console[_0x35f0ea(0x1c8)](_0x35f0ea(0xdf));const _0x8e22a1=await database_1[_0x35f0ea(0xe3)]['shop'][_0x35f0ea(0x1de)]({'where':{'status':_0x35f0ea(0x110)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x35f0ea(0x17a)}});return console['log'](_0x35f0ea(0x17b)+_0x8e22a1[_0x35f0ea(0xf5)]+_0x35f0ea(0x15e)),_0x8e22a1[_0x35f0ea(0x158)](_0x21ab8b=>({'id':_0x21ab8b['id'],'username':_0x21ab8b[_0x35f0ea(0x1fa)],'name':_0x21ab8b['name']}));}[a35_0x33dfec(0xd1)](_0x203b22){const _0x1edbba=a35_0x33dfec,_0xdad11b={'test_gateway':_0x1edbba(0x111),'plisio':'Plisio','rapyd':_0x1edbba(0x11b),'noda':'Noda','cointopay':_0x1edbba(0x166),'cointopay2':_0x1edbba(0x17e),'klyme_eu':_0x1edbba(0x116),'klyme_gb':_0x1edbba(0x180),'klyme_de':_0x1edbba(0x10b),'mastercard':_0x1edbba(0x1a6)};return _0xdad11b[_0x203b22]||_0x203b22;}['getGatewayInternalName'](_0x557f39){const _0xf76612=a35_0x33dfec,_0x373f07={'Test\x20Gateway':'test_gateway','Plisio':'plisio','Rapyd':_0xf76612(0x123),'Noda':_0xf76612(0xc7),'CoinToPay':_0xf76612(0x107),'CoinToPay2':_0xf76612(0x1d8),'KLYME\x20EU':_0xf76612(0xeb),'KLYME\x20GB':'klyme_gb','KLYME\x20DE':_0xf76612(0x10a),'MasterCard':'mastercard'};return _0x373f07[_0x557f39]||_0x557f39[_0xf76612(0x1b8)]();}async[a35_0x33dfec(0x190)](_0x18603d){const _0x381322=a35_0x33dfec,{page:_0x3869c4,limit:_0x4fba92,minAmount:_0x3718be,search:_0x5ac9af}=_0x18603d,_0x3962c3=(_0x3869c4-0x1)*_0x4fba92;console[_0x381322(0x1c8)](_0x381322(0x15f),_0x18603d);const _0x4f000b={'balance':{'gt':0x0},'status':_0x381322(0x110)};_0x3718be&&(_0x4f000b[_0x381322(0x18d)]['gte']=_0x3718be);_0x5ac9af&&(_0x4f000b['OR']=[{'name':{'contains':_0x5ac9af,'mode':_0x381322(0x1bb)}},{'username':{'contains':_0x5ac9af,'mode':_0x381322(0x1bb)}}]);const [_0x619b55,_0x31772a]=await Promise[_0x381322(0xd9)]([database_1[_0x381322(0xe3)][_0x381322(0x13e)][_0x381322(0x1de)]({'where':_0x4f000b,'skip':_0x3962c3,'take':_0x4fba92,'orderBy':{'balance':_0x381322(0x1db)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1[_0x381322(0xe3)][_0x381322(0x13e)][_0x381322(0x199)]({'where':_0x4f000b})]);console[_0x381322(0x1c8)]('💰\x20Found\x20'+_0x619b55[_0x381322(0xf5)]+'\x20merchants\x20with\x20positive\x20balance');const _0x49468a=await Promise['all'](_0x619b55['map'](async _0x2b096c=>{const _0x59a591=_0x381322,[_0x46087c,_0x4ae0af,_0x164b59]=await Promise[_0x59a591(0xd9)]([database_1[_0x59a591(0xe3)][_0x59a591(0x161)][_0x59a591(0x199)]({'where':{'shopId':_0x2b096c['id'],'status':_0x59a591(0xf3),'gateway':{'not':_0x59a591(0x1e2)}}}),database_1[_0x59a591(0xe3)][_0x59a591(0x161)][_0x59a591(0x175)]({'where':{'shopId':_0x2b096c['id'],'status':'PAID','gateway':{'not':'test_gateway'}},'orderBy':{'paidAt':_0x59a591(0x17a)},'select':{'paidAt':!![]}}),database_1['default']['payment']['groupBy']({'by':[_0x59a591(0x1ee)],'where':{'shopId':_0x2b096c['id'],'status':_0x59a591(0xf3),'gateway':{'not':_0x59a591(0x1e2)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x594a43=new Date(),_0xc108de=new Date(_0x594a43['getFullYear'](),_0x594a43[_0x59a591(0x136)](),0x1),_0x170c6c=new Date(_0x594a43[_0x59a591(0x1d5)](),_0x594a43[_0x59a591(0x136)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x35fa7d,_0xb02b77]=await Promise[_0x59a591(0xd9)]([database_1[_0x59a591(0xe3)][_0x59a591(0x1e7)][_0x59a591(0x104)]({'_sum':{'amount':!![]},'where':{'shopId':_0x2b096c['id'],'status':_0x59a591(0x195)}}),database_1[_0x59a591(0xe3)][_0x59a591(0x1e7)]['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x2b096c['id'],'status':_0x59a591(0x195),'createdAt':{'gte':_0xc108de,'lte':_0x170c6c}}})]),_0x3e7737=_0x35fa7d[_0x59a591(0x133)]['amount']||0x0,_0x39750a=_0xb02b77['_sum'][_0x59a591(0x137)]||0x0,_0x951f6a=await Promise[_0x59a591(0xd9)](_0x164b59['map'](async _0x1637a5=>{const _0xd69105=_0x59a591;let _0x4400af=0xa;if(_0x2b096c[_0xd69105(0x1ea)])try{const _0xd1aeba=JSON[_0xd69105(0x152)](_0x2b096c['gatewaySettings']);for(const [_0x167637,_0x2a0d13]of Object[_0xd69105(0x1e5)](_0xd1aeba)){if(_0x167637[_0xd69105(0x1b8)]()===_0x1637a5[_0xd69105(0x1ee)][_0xd69105(0x1b8)]()){_0x4400af=_0x2a0d13[_0xd69105(0x197)]||0xa,console['log'](_0xd69105(0x12a)+_0x1637a5[_0xd69105(0x1ee)]+'\x20for\x20shop\x20'+_0x2b096c['id']+_0xd69105(0xfa)+_0x4400af+'%');break;}}}catch(_0xfaa4ed){console[_0xd69105(0xec)](_0xd69105(0x14c)+_0x2b096c['id']+':',_0xfaa4ed);}const _0x482c1e=_0x1637a5[_0xd69105(0x133)][_0xd69105(0x13d)]||0x0,_0x35ac1e=_0x482c1e*(0x1-_0x4400af/0x64);return{'gateway':_0x1637a5[_0xd69105(0x1ee)],'count':_0x1637a5[_0xd69105(0x1c7)]['id'],'amountUSDT':Math['round'](_0x482c1e*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0xd69105(0x119)](_0x35ac1e*0x64)/0x64,'commission':_0x4400af};})),_0x2825a6=_0x951f6a[_0x59a591(0x173)]((_0x339e99,_0x8ef89e)=>_0x339e99+_0x8ef89e[_0x59a591(0x13d)],0x0),_0x2dd520=_0x2b096c[_0x59a591(0x18d)];return console[_0x59a591(0x1c8)](_0x59a591(0xe5)+_0x2b096c[_0x59a591(0x1fa)]+':'),console[_0x59a591(0x1c8)](_0x59a591(0x159)+_0x2825a6[_0x59a591(0x114)](0x2)+_0x59a591(0x1c2)),console[_0x59a591(0x1c8)](_0x59a591(0x10c)+_0x951f6a['reduce']((_0x40e450,_0x1e721b)=>_0x40e450+_0x1e721b[_0x59a591(0x17f)],0x0)[_0x59a591(0x114)](0x2)+_0x59a591(0xf8)),console[_0x59a591(0x1c8)](_0x59a591(0x171)+_0x2dd520[_0x59a591(0x114)](0x2)+_0x59a591(0x15a)),{'id':_0x2b096c['id'],'fullName':_0x2b096c[_0x59a591(0x14a)],'username':_0x2b096c[_0x59a591(0x1fa)],'telegramId':_0x2b096c[_0x59a591(0x135)],'merchantUrl':_0x2b096c[_0x59a591(0x165)],'wallets':{'usdtPolygonWallet':_0x2b096c['usdtPolygonWallet'],'usdtTrcWallet':_0x2b096c[_0x59a591(0xf0)],'usdtErcWallet':_0x2b096c[_0x59a591(0x192)],'usdcPolygonWallet':_0x2b096c[_0x59a591(0x1f6)]},'totalAmountUSDT':Math[_0x59a591(0x119)](_0x2825a6*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x59a591(0x119)](_0x2dd520*0x64)/0x64,'totalPayout':Math[_0x59a591(0x119)](_0x3e7737*0x64)/0x64,'thisMonth':Math[_0x59a591(0x119)](_0x39750a*0x64)/0x64,'paymentsCount':_0x46087c,'oldestPaymentDate':_0x4ae0af?.[_0x59a591(0x149)]||_0x2b096c[_0x59a591(0x1c9)],'gatewayBreakdown':_0x951f6a};})),_0xff135c=_0x49468a[_0x381322(0x173)]((_0x295d7b,_0xa5a71)=>_0x295d7b+_0xa5a71[_0x381322(0x101)],0x0),_0x2f19eb=_0x49468a[_0x381322(0x173)]((_0x37f80c,_0x94c8bc)=>_0x37f80c+_0x94c8bc[_0x381322(0x16c)],0x0),_0x13551a=_0x49468a[_0x381322(0x173)]((_0x295e87,_0x318eec)=>_0x295e87+_0x318eec['totalPayout'],0x0),_0xa17758=_0x49468a[_0x381322(0x173)]((_0x4a212d,_0xc65438)=>_0x4a212d+_0xc65438['thisMonth'],0x0);return console[_0x381322(0x1c8)](_0x381322(0x105)+_0x31772a+_0x381322(0x183)),console[_0x381322(0x1c8)](_0x381322(0xdc)+Math[_0x381322(0x119)](_0xff135c*0x64)/0x64+'\x20USDT\x20(gross\x20revenue)'),console[_0x381322(0x1c8)](_0x381322(0xe9)+Math['round'](_0x2f19eb*0x64)/0x64+_0x381322(0xc8)),console[_0x381322(0x1c8)](_0x381322(0x1dc)+Math[_0x381322(0x119)](_0x13551a*0x64)/0x64+_0x381322(0x1a4)),console[_0x381322(0x1c8)](_0x381322(0xd0)+Math[_0x381322(0x119)](_0xa17758*0x64)/0x64+'\x20USDT'),{'merchants':_0x49468a,'pagination':{'page':_0x3869c4,'limit':_0x4fba92,'total':_0x31772a,'totalPages':Math[_0x381322(0x15d)](_0x31772a/_0x4fba92)},'summary':{'totalMerchants':_0x31772a,'totalAmountUSDT':Math['round'](_0xff135c*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x2f19eb*0x64)/0x64,'totalPayout':Math[_0x381322(0x119)](_0x13551a*0x64)/0x64,'thisMonth':Math[_0x381322(0x119)](_0xa17758*0x64)/0x64}};}async[a35_0x33dfec(0x177)](_0x1d1527){const _0x52373c=a35_0x33dfec,{shopId:_0xd20596,amount:_0x3878ff,network:_0x2e1bc5,wallet:_0x15ad5a,notes:_0x4108e5,txid:_0x49e079,periodFrom:_0x43c919,periodTo:_0x33638b}=_0x1d1527,_0x14ffe5=await database_1[_0x52373c(0xe3)][_0x52373c(0x1d4)](async _0x43354e=>{const _0x1638c1=_0x52373c,_0x53e71a=await _0x43354e[_0x1638c1(0x13e)][_0x1638c1(0x1b4)]({'where':{'id':_0xd20596},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x53e71a)throw new Error(_0x1638c1(0xd2));console['log'](_0x1638c1(0x117)+_0x53e71a['username']+':'),console[_0x1638c1(0x1c8)](_0x1638c1(0xcc)+_0x53e71a[_0x1638c1(0x18d)][_0x1638c1(0x114)](0x6)+_0x1638c1(0x1a4)),console[_0x1638c1(0x1c8)](_0x1638c1(0x1c3)+_0x3878ff['toFixed'](0x6)+'\x20USDT'),console[_0x1638c1(0x1c8)](_0x1638c1(0xcf)+_0x53e71a[_0x1638c1(0x1cb)]['toFixed'](0x6)+_0x1638c1(0x1a4));if(_0x49e079)console[_0x1638c1(0x1c8)](_0x1638c1(0x1b1)+_0x49e079);if(_0x53e71a[_0x1638c1(0x18d)]<_0x3878ff)throw new Error(_0x1638c1(0xca)+_0x53e71a[_0x1638c1(0x18d)][_0x1638c1(0x114)](0x6)+'\x20USDT,\x20Requested:\x20'+_0x3878ff[_0x1638c1(0x114)](0x6)+_0x1638c1(0x1a4));let _0x5d10b2=_0x15ad5a;if(!_0x5d10b2){const _0x19c934=await _0x43354e[_0x1638c1(0x13e)][_0x1638c1(0x1b4)]({'where':{'id':_0xd20596},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x19c934)switch(_0x2e1bc5){case _0x1638c1(0x1e4):_0x5d10b2=_0x19c934[_0x1638c1(0x1f3)]||undefined;break;case _0x1638c1(0x12d):_0x5d10b2=_0x19c934[_0x1638c1(0xf0)]||undefined;break;case _0x1638c1(0x146):_0x5d10b2=_0x19c934[_0x1638c1(0x192)]||undefined;break;case'polygon_usdc':_0x5d10b2=_0x19c934['usdcPolygonWallet']||undefined;break;}}console[_0x1638c1(0x1c8)]('💳\x20Payout\x20wallet\x20for\x20'+_0x2e1bc5+':\x20'+(_0x5d10b2||_0x1638c1(0xfb)));const _0x52da25=await _0x43354e[_0x1638c1(0x1e7)][_0x1638c1(0x185)]({'data':{'shopId':_0xd20596,'amount':_0x3878ff,'network':_0x2e1bc5,'status':'COMPLETED','txid':_0x49e079,'notes':_0x4108e5,'periodFrom':_0x43c919?new Date(_0x43c919):null,'periodTo':_0x33638b?new Date(_0x33638b):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x2bcd91=_0x53e71a[_0x1638c1(0x18d)]-_0x3878ff,_0x2a098e=_0x53e71a[_0x1638c1(0x1cb)]+_0x3878ff;return await _0x43354e[_0x1638c1(0x13e)][_0x1638c1(0x153)]({'where':{'id':_0xd20596},'data':{'balance':_0x2bcd91,'totalPaidOut':_0x2a098e}}),console[_0x1638c1(0x1c8)]('💰\x20Shop\x20'+_0x53e71a[_0x1638c1(0x1fa)]+_0x1638c1(0x163)),console['log'](_0x1638c1(0x108)+_0x53e71a[_0x1638c1(0x18d)][_0x1638c1(0x114)](0x6)+'\x20->\x20'+_0x2bcd91[_0x1638c1(0x114)](0x6)+_0x1638c1(0x1f1)+_0x3878ff[_0x1638c1(0x114)](0x6)+')'),console[_0x1638c1(0x1c8)](_0x1638c1(0x176)+_0x53e71a['totalPaidOut']['toFixed'](0x6)+_0x1638c1(0x1ed)+_0x2a098e['toFixed'](0x6)+_0x1638c1(0xde)+_0x3878ff[_0x1638c1(0x114)](0x6)+')'),{'payout':_0x52da25,'shop':_0x53e71a};});return console[_0x52373c(0x1c8)](_0x52373c(0x1e3)+_0x14ffe5[_0x52373c(0x1e7)]['id']+_0x52373c(0x1a1)+_0x14ffe5[_0x52373c(0x13e)]['username']+'\x20('+_0x3878ff+_0x52373c(0x1bf)),{'id':_0x14ffe5[_0x52373c(0x1e7)]['id'],'shopId':_0x14ffe5[_0x52373c(0x1e7)][_0x52373c(0x164)],'shopName':_0x14ffe5[_0x52373c(0x13e)]['name'],'shopUsername':_0x14ffe5['shop']['username'],'amount':_0x14ffe5[_0x52373c(0x1e7)][_0x52373c(0x137)],'network':_0x14ffe5[_0x52373c(0x1e7)][_0x52373c(0x196)],'status':_0x14ffe5['payout'][_0x52373c(0x118)],'txid':_0x14ffe5[_0x52373c(0x1e7)][_0x52373c(0x1b5)],'notes':_0x14ffe5[_0x52373c(0x1e7)][_0x52373c(0x1ad)],'periodFrom':_0x14ffe5[_0x52373c(0x1e7)][_0x52373c(0x1c5)],'periodTo':_0x14ffe5[_0x52373c(0x1e7)]['periodTo'],'createdAt':_0x14ffe5[_0x52373c(0x1e7)][_0x52373c(0x1c9)],'paidAt':_0x14ffe5[_0x52373c(0x1e7)][_0x52373c(0x149)]};}async['getAllPayouts'](_0xf5bf9a){const _0x285534=a35_0x33dfec,{page:_0x373882,limit:_0x1fe7f5,shopId:_0x5180f1,network:_0xecb87c,dateFrom:_0x268fc4,dateTo:_0x350182,search:_0x5bbc3f}=_0xf5bf9a,_0xe80616=(_0x373882-0x1)*_0x1fe7f5,_0x3de411={};_0x5180f1&&(_0x3de411[_0x285534(0x164)]=_0x5180f1);_0xecb87c&&(_0x3de411[_0x285534(0x196)]=_0xecb87c);(_0x268fc4||_0x350182)&&(_0x3de411[_0x285534(0x1c9)]={},_0x268fc4&&(_0x3de411['createdAt']['gte']=new Date(_0x268fc4)),_0x350182&&(_0x3de411['createdAt'][_0x285534(0x1be)]=new Date(_0x350182)));_0x5bbc3f&&(_0x3de411['OR']=[{'shop':{'name':{'contains':_0x5bbc3f,'mode':_0x285534(0x1bb)}}},{'shop':{'username':{'contains':_0x5bbc3f,'mode':_0x285534(0x1bb)}}},{'notes':{'contains':_0x5bbc3f,'mode':_0x285534(0x1bb)}}]);const [_0x3185c7,_0x4050cf]=await Promise['all']([database_1['default']['payout']['findMany']({'where':_0x3de411,'skip':_0xe80616,'take':_0x1fe7f5,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x285534(0xe3)][_0x285534(0x1e7)]['count']({'where':_0x3de411})]);return{'payouts':_0x3185c7[_0x285534(0x158)](_0x205e23=>({'id':_0x205e23['id'],'shopId':_0x205e23[_0x285534(0x164)],'shopName':_0x205e23['shop'][_0x285534(0x14a)],'shopUsername':_0x205e23['shop']['username'],'amount':_0x205e23[_0x285534(0x137)],'network':_0x205e23['network'],'status':_0x205e23[_0x285534(0x118)],'txid':_0x205e23[_0x285534(0x1b5)],'notes':_0x205e23[_0x285534(0x1ad)],'periodFrom':_0x205e23[_0x285534(0x1c5)],'periodTo':_0x205e23[_0x285534(0x1b9)],'createdAt':_0x205e23[_0x285534(0x1c9)],'paidAt':_0x205e23[_0x285534(0x149)]})),'pagination':{'page':_0x373882,'limit':_0x1fe7f5,'total':_0x4050cf,'totalPages':Math['ceil'](_0x4050cf/_0x1fe7f5)}};}async['getPayoutById'](_0x5cc22a){const _0x53faf3=a35_0x33dfec,_0x47fcde=await database_1[_0x53faf3(0xe3)][_0x53faf3(0x1e7)][_0x53faf3(0x1b4)]({'where':{'id':_0x5cc22a},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x47fcde)return null;return{'id':_0x47fcde['id'],'shopId':_0x47fcde[_0x53faf3(0x164)],'shopName':_0x47fcde['shop'][_0x53faf3(0x14a)],'shopUsername':_0x47fcde[_0x53faf3(0x13e)]['username'],'amount':_0x47fcde[_0x53faf3(0x137)],'network':_0x47fcde['network'],'status':_0x47fcde['status'],'txid':_0x47fcde[_0x53faf3(0x1b5)],'notes':_0x47fcde[_0x53faf3(0x1ad)],'periodFrom':_0x47fcde[_0x53faf3(0x1c5)],'periodTo':_0x47fcde[_0x53faf3(0x1b9)],'createdAt':_0x47fcde[_0x53faf3(0x1c9)],'paidAt':_0x47fcde['paidAt']};}async[a35_0x33dfec(0x1d7)](_0x3960c6){const _0x36ca4d=a35_0x33dfec;await database_1[_0x36ca4d(0xe3)]['payout'][_0x36ca4d(0x1ef)]({'where':{'id':_0x3960c6}});}async[a35_0x33dfec(0x140)](_0x4515fc){const _0x50288f=a35_0x33dfec,{page:_0x25c8dc,limit:_0x3ecbb9,status:_0x819fae,gateway:_0x443647,shopId:_0x44163e,dateFrom:_0x1c2737,dateTo:_0x274e8e,search:_0x7a561a,currency:_0x1e3b23,sortBy:_0x2ae2c7,sortOrder:_0xbba059}=_0x4515fc,_0x461a90=(_0x25c8dc-0x1)*_0x3ecbb9;console['log'](_0x50288f(0x1dd),_0x4515fc);const _0x19bb93=await database_1[_0x50288f(0xe3)][_0x50288f(0x161)][_0x50288f(0xfd)]({'by':[_0x50288f(0x1ee)],'_count':{'gateway':!![]}});console[_0x50288f(0x1c8)](_0x50288f(0x102),_0x19bb93[_0x50288f(0x158)](_0x46d520=>_0x46d520['gateway']+'\x20('+_0x46d520[_0x50288f(0x1c7)][_0x50288f(0x1ee)]+_0x50288f(0x13b)));if(_0x443647){const _0x3eecfb=_0x19bb93['some'](_0x5253cd=>_0x5253cd[_0x50288f(0x1ee)][_0x50288f(0x1b8)]()===_0x443647[_0x50288f(0x1b8)]());!_0x3eecfb&&_0x443647[_0x50288f(0x1b8)]()!=='test_gateway'&&console[_0x50288f(0x1c8)]('⚠️\x20Requested\x20gateway\x20\x27'+_0x443647+_0x50288f(0x1d9)+_0x19bb93[_0x50288f(0x158)](_0x32f826=>_0x32f826['gateway'])['join'](',\x20'));}const _0x2025ac={};_0x819fae&&(_0x2025ac[_0x50288f(0x118)]=_0x819fae['toUpperCase']());if(!_0x443647)_0x2025ac[_0x50288f(0x1ee)]={'not':_0x50288f(0x1e2)};else{if(_0x443647&&(_0x443647[_0x50288f(0x1b8)]()===_0x50288f(0x1e2)||_0x443647===_0x50288f(0x18b)))_0x2025ac[_0x50288f(0x1ee)]=_0x50288f(0x1e2);else{let _0x1a4470=_0x443647;const _0xa82eb4=(0x0,gateway_1[_0x50288f(0x1cf)])(_0x443647);if(_0xa82eb4)_0x1a4470=_0xa82eb4,console[_0x50288f(0x1c8)](_0x50288f(0x11a)+_0x443647+_0x50288f(0x1e1)+_0x1a4470+'\x27');else{const _0x1312f8=(0x0,gateway_1['getGatewayIdByName'])(_0x443647);if(_0x1312f8){const _0x14c283=(0x0,gateway_1[_0x50288f(0x1cf)])(_0x1312f8);_0x14c283&&(_0x1a4470=_0x14c283,console[_0x50288f(0x1c8)](_0x50288f(0x113)+_0x443647+_0x50288f(0xc6)+_0x1312f8+'\x27\x20->\x20name\x20\x27'+_0x1a4470+'\x27'));}else console[_0x50288f(0x1c8)]('🔍\x20Using\x20gateway\x20\x27'+_0x443647+_0x50288f(0x1af));}const _0x4328c6=await database_1[_0x50288f(0xe3)]['payment'][_0x50288f(0x199)]({'where':{'gateway':_0x1a4470[_0x50288f(0x1b8)]()},'take':0x1});_0x4328c6===0x0?(console[_0x50288f(0x1c8)](_0x50288f(0x181)+_0x1a4470+'\x27\x20(from\x20\x27'+_0x443647+_0x50288f(0x1b7)),_0x2025ac['gateway']=_0x50288f(0x100)):(_0x2025ac[_0x50288f(0x1ee)]=_0x1a4470[_0x50288f(0x1b8)](),console[_0x50288f(0x1c8)](_0x50288f(0x11e)+_0x1a4470+_0x50288f(0x1b2)+_0x443647+'\x27)'));}}console['log'](_0x50288f(0x120),_0x2025ac['gateway']);_0x44163e&&(_0x2025ac[_0x50288f(0x164)]=_0x44163e);_0x1e3b23&&(_0x2025ac['currency']=_0x1e3b23['toUpperCase'](),console[_0x50288f(0x1c8)](_0x50288f(0xe4)+_0x1e3b23[_0x50288f(0x1d6)]()));(_0x1c2737||_0x274e8e)&&(_0x2025ac['createdAt']={},_0x1c2737&&(_0x2025ac['createdAt'][_0x50288f(0x143)]=new Date(_0x1c2737)),_0x274e8e&&(_0x2025ac['createdAt'][_0x50288f(0x1be)]=new Date(_0x274e8e)));_0x7a561a&&(_0x2025ac['OR']=[{'id':{'contains':_0x7a561a,'mode':_0x50288f(0x1bb)}},{'orderId':{'contains':_0x7a561a,'mode':'insensitive'}},{'gatewayOrderId':{'contains':_0x7a561a,'mode':_0x50288f(0x1bb)}},{'customerEmail':{'contains':_0x7a561a,'mode':_0x50288f(0x1bb)}},{'shop':{'name':{'contains':_0x7a561a,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x7a561a,'mode':'insensitive'}}}]);console[_0x50288f(0x1c8)](_0x50288f(0x19b),JSON[_0x50288f(0x16d)](_0x2025ac,null,0x2));let _0x3554ae={'createdAt':_0x50288f(0x1db)};if(_0x2ae2c7){const _0x3a58d5=[_0x50288f(0x137),_0x50288f(0x1c9),_0x50288f(0xcb),_0x50288f(0x118),'gateway',_0x50288f(0x1c6)],_0x2365d6=[_0x50288f(0x17a),'desc'];if(_0x3a58d5[_0x50288f(0xc9)](_0x2ae2c7)){const _0x378953=_0x2365d6[_0x50288f(0xc9)](_0xbba059)?_0xbba059:'desc';_0x3554ae={[_0x2ae2c7]:_0x378953},console[_0x50288f(0x1c8)](_0x50288f(0x1ce)+_0x2ae2c7+_0x50288f(0x112)+_0x378953+'\x20order');}}const [_0x1586bb,_0x1267bf]=await Promise[_0x50288f(0xd9)]([database_1['default'][_0x50288f(0x161)][_0x50288f(0x1de)]({'where':_0x2025ac,'skip':_0x461a90,'take':_0x3ecbb9,'orderBy':_0x3554ae,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x50288f(0xe3)]['payment'][_0x50288f(0x199)]({'where':_0x2025ac})]);return{'payments':_0x1586bb,'pagination':{'page':_0x25c8dc,'limit':_0x3ecbb9,'total':_0x1267bf,'totalPages':Math[_0x50288f(0x15d)](_0x1267bf/_0x3ecbb9)}};}async[a35_0x33dfec(0x191)](_0x44de29){const _0x3df68b=a35_0x33dfec,_0x45e136=await database_1[_0x3df68b(0xe3)][_0x3df68b(0x161)][_0x3df68b(0x1b4)]({'where':{'id':_0x44de29},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x45e136)return null;return{'id':_0x45e136['id'],'shopId':_0x45e136[_0x3df68b(0x164)],'gateway':_0x45e136[_0x3df68b(0x1ee)],'amount':_0x45e136[_0x3df68b(0x137)],'currency':_0x45e136['currency'],'status':_0x45e136[_0x3df68b(0x118)],'orderId':_0x45e136[_0x3df68b(0x1a8)],'gatewayOrderId':_0x45e136[_0x3df68b(0xd3)],'customerEmail':_0x45e136['customerEmail'],'customerName':_0x45e136[_0x3df68b(0x1c4)],'customerCountry':_0x45e136[_0x3df68b(0xe7)],'customerIp':_0x45e136[_0x3df68b(0x19c)],'customerUa':_0x45e136[_0x3df68b(0x1d3)],'failureMessage':_0x45e136['failureMessage'],'externalPaymentUrl':_0x45e136[_0x3df68b(0x18f)],'successUrl':_0x45e136['successUrl'],'failUrl':_0x45e136[_0x3df68b(0x1a7)],'pendingUrl':_0x45e136[_0x3df68b(0x1a9)],'whiteUrl':_0x45e136[_0x3df68b(0x13f)],'createdAt':_0x45e136[_0x3df68b(0x1c9)],'updatedAt':_0x45e136[_0x3df68b(0xcb)],'shop':_0x45e136[_0x3df68b(0x13e)]};}async[a35_0x33dfec(0x141)](_0x4bfa9b,_0x52aacd,_0x26c62c,_0x255f89){const _0x2230d0=a35_0x33dfec,_0x409e29=await database_1[_0x2230d0(0xe3)][_0x2230d0(0x1d4)](async _0x54a424=>{const _0x3d2b39=_0x2230d0,_0x293d76=await _0x54a424['payment'][_0x3d2b39(0x1b4)]({'where':{'id':_0x4bfa9b},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x293d76)throw new Error('Payment\x20not\x20found');const _0x47e25e=_0x293d76['status'],_0x33438c=_0x52aacd[_0x3d2b39(0x1d6)]();console[_0x3d2b39(0x1c8)](_0x3d2b39(0x193)+_0x4bfa9b+_0x3d2b39(0xe1)+_0x47e25e+_0x3d2b39(0x1ed)+_0x33438c),console[_0x3d2b39(0x1c8)](_0x3d2b39(0x1f2)+_0x293d76['shop'][_0x3d2b39(0x18d)]+'\x20USDT');const _0x4e246b={'status':_0x33438c,'updatedAt':new Date(),'statusChangedBy':_0x3d2b39(0x144),'statusChangedAt':new Date()};_0x26c62c&&(_0x4e246b['adminNotes']=_0x26c62c);_0x33438c==='CHARGEBACK'&&_0x255f89&&(_0x4e246b[_0x3d2b39(0x154)]=_0x255f89);let _0x36d655=0x0,_0x14dd87=_0x293d76[_0x3d2b39(0x13e)][_0x3d2b39(0x18d)];if(_0x33438c==='PAID'&&_0x47e25e!==_0x3d2b39(0xf3)){_0x4e246b[_0x3d2b39(0x149)]=new Date();const _0x753dba=await currencyService_1[_0x3d2b39(0x19d)][_0x3d2b39(0x11d)](_0x293d76['amount'],_0x293d76[_0x3d2b39(0x1c6)]);_0x4e246b[_0x3d2b39(0x13d)]=_0x753dba;let _0xc97690=0xa;const _0x437954=await _0x54a424[_0x3d2b39(0x13e)][_0x3d2b39(0x1b4)]({'where':{'id':_0x293d76[_0x3d2b39(0x164)]},'select':{'gatewaySettings':!![]}});if(_0x437954?.[_0x3d2b39(0x1ea)])try{const _0x48a7a2=JSON[_0x3d2b39(0x152)](_0x437954['gatewaySettings']);for(const [_0x10dbee,_0x482749]of Object['entries'](_0x48a7a2)){if(_0x10dbee['toLowerCase']()===_0x293d76[_0x3d2b39(0x1ee)][_0x3d2b39(0x1b8)]()){_0xc97690=_0x482749[_0x3d2b39(0x197)]||0xa;break;}}}catch(_0x3ae5e2){console[_0x3d2b39(0xec)]('Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20'+_0x4bfa9b+':',_0x3ae5e2);}const _0x136b20=_0x753dba*(0x1-_0xc97690/0x64);_0x36d655=_0x136b20,_0x14dd87+=_0x136b20,console['log']('💰\x20Payment\x20'+_0x4bfa9b+_0x3d2b39(0xf9)),console[_0x3d2b39(0x1c8)](_0x3d2b39(0x1ba)+_0x753dba[_0x3d2b39(0x114)](0x6)+_0x3d2b39(0x1a4)),console[_0x3d2b39(0x1c8)](_0x3d2b39(0x1a0)+_0x293d76[_0x3d2b39(0x1ee)]+_0x3d2b39(0x13c)+_0xc97690+'%'),console[_0x3d2b39(0x1c8)](_0x3d2b39(0x167)+_0x136b20['toFixed'](0x6)+_0x3d2b39(0x1cd)+_0xc97690+_0x3d2b39(0x186)),console[_0x3d2b39(0x1c8)](_0x3d2b39(0x16e)+_0x136b20['toFixed'](0x6)+_0x3d2b39(0x1a4));}else{if(_0x47e25e===_0x3d2b39(0xf3)&&_0x33438c!==_0x3d2b39(0xf3)){if(_0x293d76['amountUSDT']){let _0x378423=0xa;const _0x3d4845=await _0x54a424[_0x3d2b39(0x13e)]['findUnique']({'where':{'id':_0x293d76[_0x3d2b39(0x164)]},'select':{'gatewaySettings':!![]}});if(_0x3d4845?.[_0x3d2b39(0x1ea)])try{const _0x18ebd0=JSON[_0x3d2b39(0x152)](_0x3d4845['gatewaySettings']);for(const [_0x318f7b,_0x26e0e3]of Object[_0x3d2b39(0x1e5)](_0x18ebd0)){if(_0x318f7b[_0x3d2b39(0x1b8)]()===_0x293d76[_0x3d2b39(0x1ee)][_0x3d2b39(0x1b8)]()){_0x378423=_0x26e0e3[_0x3d2b39(0x197)]||0xa;break;}}}catch(_0x28b90b){console[_0x3d2b39(0xec)]('Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20'+_0x4bfa9b+':',_0x28b90b);}const _0x4ef272=_0x293d76[_0x3d2b39(0x13d)]*(0x1-_0x378423/0x64);_0x36d655=-_0x4ef272,_0x14dd87-=_0x4ef272,_0x4e246b[_0x3d2b39(0x13d)]=null,console['log'](_0x3d2b39(0x122)+_0x4bfa9b+_0x3d2b39(0xf1)),console[_0x3d2b39(0x1c8)](_0x3d2b39(0x1ba)+_0x293d76[_0x3d2b39(0x13d)]['toFixed'](0x6)+_0x3d2b39(0x1a4)),console[_0x3d2b39(0x1c8)]('\x20\x20\x20Gateway:\x20'+_0x293d76[_0x3d2b39(0x1ee)]+',\x20Commission:\x20'+_0x378423+'%'),console[_0x3d2b39(0x1c8)](_0x3d2b39(0x14f)+_0x4ef272[_0x3d2b39(0x114)](0x6)+'\x20USDT\x20(after\x20'+_0x378423+_0x3d2b39(0x186)),console[_0x3d2b39(0x1c8)](_0x3d2b39(0xd8)+_0x4ef272[_0x3d2b39(0x114)](0x6)+_0x3d2b39(0x1a4));}}}_0x33438c==='CHARGEBACK'&&(_0x47e25e===_0x3d2b39(0xf3)&&_0x293d76[_0x3d2b39(0x13d)]&&console[_0x3d2b39(0x1c8)](_0x3d2b39(0x194)),_0x255f89&&_0x255f89>0x0&&(_0x36d655-=_0x255f89,_0x14dd87-=_0x255f89,console[_0x3d2b39(0x1c8)](_0x3d2b39(0x1ac)+_0x255f89[_0x3d2b39(0x114)](0x6)+_0x3d2b39(0x178))));_0x33438c===_0x3d2b39(0x10e)&&_0x47e25e==='PAID'&&console[_0x3d2b39(0x1c8)]('🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance');const _0x1fc360=await _0x54a424[_0x3d2b39(0x161)][_0x3d2b39(0x153)]({'where':{'id':_0x4bfa9b},'data':_0x4e246b,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x36d655!==0x0&&(await _0x54a424['shop'][_0x3d2b39(0x153)]({'where':{'id':_0x293d76['shopId']},'data':{'balance':_0x14dd87}}),console[_0x3d2b39(0x1c8)](_0x3d2b39(0x182)+_0x293d76[_0x3d2b39(0x164)]+_0x3d2b39(0x1bc)+_0x293d76[_0x3d2b39(0x13e)][_0x3d2b39(0x18d)][_0x3d2b39(0x114)](0x6)+_0x3d2b39(0x1ed)+_0x14dd87[_0x3d2b39(0x114)](0x6)+_0x3d2b39(0x1e0)+(_0x36d655>0x0?'+':'')+_0x36d655['toFixed'](0x6)+')')),_0x1fc360;});return{'id':_0x409e29['id'],'shopId':_0x409e29[_0x2230d0(0x164)],'gateway':_0x409e29[_0x2230d0(0x1ee)],'amount':_0x409e29[_0x2230d0(0x137)],'currency':_0x409e29[_0x2230d0(0x1c6)],'status':_0x409e29[_0x2230d0(0x118)],'orderId':_0x409e29['orderId'],'gatewayOrderId':_0x409e29[_0x2230d0(0xd3)],'customerEmail':_0x409e29[_0x2230d0(0x1f0)],'customerName':_0x409e29[_0x2230d0(0x1c4)],'customerCountry':_0x409e29[_0x2230d0(0xe7)],'customerIp':_0x409e29['customerIp'],'customerUa':_0x409e29['customerUa'],'failureMessage':_0x409e29[_0x2230d0(0x19a)],'adminNotes':_0x409e29[_0x2230d0(0x189)],'chargebackAmount':_0x409e29[_0x2230d0(0x154)],'statusChangedBy':_0x409e29[_0x2230d0(0x1a3)],'statusChangedAt':_0x409e29['statusChangedAt'],'createdAt':_0x409e29[_0x2230d0(0x1c9)],'updatedAt':_0x409e29['updatedAt'],'shop':_0x409e29[_0x2230d0(0x13e)]};}async['updateUser'](_0x2cfef6,_0x46521d){const _0x545f0c=a35_0x33dfec,_0x1d4b23={..._0x46521d};_0x46521d[_0x545f0c(0x1ca)]&&(_0x1d4b23[_0x545f0c(0x1ca)]=await bcryptjs_1['default'][_0x545f0c(0x1b3)](_0x46521d['password'],0xc));_0x46521d['fullName']&&(_0x1d4b23[_0x545f0c(0x14a)]=_0x46521d[_0x545f0c(0x15c)],delete _0x1d4b23[_0x545f0c(0x15c)]);_0x46521d[_0x545f0c(0x14e)]&&(_0x1d4b23['telegram']=_0x46521d['telegramId'],delete _0x1d4b23[_0x545f0c(0x14e)]);_0x46521d[_0x545f0c(0x16b)]&&(_0x1d4b23[_0x545f0c(0x165)]=_0x46521d['merchantUrl'],delete _0x1d4b23[_0x545f0c(0x16b)]);if(_0x46521d[_0x545f0c(0x1d0)]){const _0xb9a2f6=_0x46521d[_0x545f0c(0x1d0)][_0x545f0c(0x158)](_0x8473c0=>this[_0x545f0c(0x126)](_0x8473c0));console[_0x545f0c(0x1c8)](_0x545f0c(0x147),_0x46521d[_0x545f0c(0x1d0)],'->',_0xb9a2f6),_0x1d4b23[_0x545f0c(0x162)]=JSON[_0x545f0c(0x16d)](_0xb9a2f6),delete _0x1d4b23[_0x545f0c(0x1d0)];}_0x46521d['gatewaySettings']&&(_0x1d4b23[_0x545f0c(0x1ea)]=JSON[_0x545f0c(0x16d)](_0x46521d['gatewaySettings']),delete _0x1d4b23[_0x545f0c(0x1ea)]);_0x46521d[_0x545f0c(0x16a)]&&(_0x46521d[_0x545f0c(0x16a)][_0x545f0c(0x1f3)]!==undefined&&(_0x1d4b23[_0x545f0c(0x1f3)]=_0x46521d[_0x545f0c(0x16a)][_0x545f0c(0x1f3)]||null),_0x46521d['wallets']['usdtTrcWallet']!==undefined&&(_0x1d4b23[_0x545f0c(0xf0)]=_0x46521d['wallets']['usdtTrcWallet']||null),_0x46521d[_0x545f0c(0x16a)][_0x545f0c(0x192)]!==undefined&&(_0x1d4b23[_0x545f0c(0x192)]=_0x46521d[_0x545f0c(0x16a)][_0x545f0c(0x192)]||null),_0x46521d[_0x545f0c(0x16a)][_0x545f0c(0x1f6)]!==undefined&&(_0x1d4b23[_0x545f0c(0x1f6)]=_0x46521d[_0x545f0c(0x16a)]['usdcPolygonWallet']||null),delete _0x1d4b23[_0x545f0c(0x16a)]);const _0x48285d=await database_1['default'][_0x545f0c(0x13e)]['update']({'where':{'id':_0x2cfef6},'data':_0x1d4b23,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x48285d['id'],'fullName':_0x48285d[_0x545f0c(0x14a)],'username':_0x48285d[_0x545f0c(0x1fa)],'telegramId':_0x48285d[_0x545f0c(0x135)],'merchantUrl':_0x48285d[_0x545f0c(0x165)],'gateways':_0x48285d[_0x545f0c(0x162)]?JSON[_0x545f0c(0x152)](_0x48285d['paymentGateways']):null,'gatewaySettings':_0x48285d['gatewaySettings']?JSON[_0x545f0c(0x152)](_0x48285d[_0x545f0c(0x1ea)]):null,'publicKey':_0x48285d['publicKey'],'wallets':{'usdtPolygonWallet':_0x48285d['usdtPolygonWallet'],'usdtTrcWallet':_0x48285d[_0x545f0c(0xf0)],'usdtErcWallet':_0x48285d[_0x545f0c(0x192)],'usdcPolygonWallet':_0x48285d['usdcPolygonWallet']},'status':_0x48285d[_0x545f0c(0x118)],'createdAt':_0x48285d['createdAt']};}async['suspendUser'](_0x456cef){const _0x4dbd40=a35_0x33dfec,_0x573bc6=await database_1['default']['shop'][_0x4dbd40(0x153)]({'where':{'id':_0x456cef},'data':{'status':_0x4dbd40(0x134)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x573bc6['id'],'fullName':_0x573bc6['name'],'username':_0x573bc6['username'],'telegramId':_0x573bc6[_0x4dbd40(0x135)],'merchantUrl':_0x573bc6['shopUrl'],'gateways':_0x573bc6[_0x4dbd40(0x162)]?JSON[_0x4dbd40(0x152)](_0x573bc6[_0x4dbd40(0x162)]):null,'gatewaySettings':_0x573bc6['gatewaySettings']?JSON[_0x4dbd40(0x152)](_0x573bc6['gatewaySettings']):null,'publicKey':_0x573bc6[_0x4dbd40(0x11c)],'wallets':{'usdtPolygonWallet':_0x573bc6['usdtPolygonWallet'],'usdtTrcWallet':_0x573bc6[_0x4dbd40(0xf0)],'usdtErcWallet':_0x573bc6[_0x4dbd40(0x192)],'usdcPolygonWallet':_0x573bc6[_0x4dbd40(0x1f6)]},'status':_0x573bc6[_0x4dbd40(0x118)],'createdAt':_0x573bc6[_0x4dbd40(0x1c9)]};}async['activateUser'](_0x3ef7a4){const _0x3347a5=a35_0x33dfec,_0x26d75e=await database_1['default'][_0x3347a5(0x13e)][_0x3347a5(0x153)]({'where':{'id':_0x3ef7a4},'data':{'status':_0x3347a5(0x110)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x26d75e['id'],'fullName':_0x26d75e[_0x3347a5(0x14a)],'username':_0x26d75e['username'],'telegramId':_0x26d75e[_0x3347a5(0x135)],'merchantUrl':_0x26d75e[_0x3347a5(0x165)],'gateways':_0x26d75e['paymentGateways']?JSON[_0x3347a5(0x152)](_0x26d75e['paymentGateways']):null,'gatewaySettings':_0x26d75e[_0x3347a5(0x1ea)]?JSON[_0x3347a5(0x152)](_0x26d75e[_0x3347a5(0x1ea)]):null,'publicKey':_0x26d75e['publicKey'],'wallets':{'usdtPolygonWallet':_0x26d75e[_0x3347a5(0x1f3)],'usdtTrcWallet':_0x26d75e['usdtTrcWallet'],'usdtErcWallet':_0x26d75e[_0x3347a5(0x192)],'usdcPolygonWallet':_0x26d75e[_0x3347a5(0x1f6)]},'status':_0x26d75e[_0x3347a5(0x118)],'createdAt':_0x26d75e[_0x3347a5(0x1c9)]};}async[a35_0x33dfec(0xd4)](_0x22e5f1){const _0x335abd=a35_0x33dfec,{page:_0x256a65,limit:_0x4213d5,status:_0x1aae84}=_0x22e5f1,_0x492223=(_0x256a65-0x1)*_0x4213d5,_0x22ef41={};_0x1aae84&&(_0x22ef41[_0x335abd(0x118)]=_0x1aae84[_0x335abd(0x1d6)]());const [_0x44b74b,_0xabbd14]=await Promise[_0x335abd(0xd9)]([database_1['default']['shop'][_0x335abd(0x1de)]({'where':_0x22ef41,'skip':_0x492223,'take':_0x4213d5,'orderBy':{'createdAt':_0x335abd(0x1db)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x335abd(0xe3)][_0x335abd(0x13e)]['count']({'where':_0x22ef41})]);return{'users':_0x44b74b[_0x335abd(0x158)](_0xda6a6a=>{const _0x515618=_0x335abd,_0x4fbd90=_0xda6a6a[_0x515618(0x162)]?JSON[_0x515618(0x152)](_0xda6a6a[_0x515618(0x162)]):null,_0x2033c5=_0x4fbd90?_0x4fbd90[_0x515618(0x158)](_0x50073c=>this[_0x515618(0xd1)](_0x50073c)):null;return{'id':_0xda6a6a['id'],'fullName':_0xda6a6a[_0x515618(0x14a)],'username':_0xda6a6a[_0x515618(0x1fa)],'telegramId':_0xda6a6a['telegram'],'merchantUrl':_0xda6a6a[_0x515618(0x165)],'gateways':_0x2033c5,'gatewaySettings':_0xda6a6a[_0x515618(0x1ea)]?JSON[_0x515618(0x152)](_0xda6a6a[_0x515618(0x1ea)]):null,'publicKey':_0xda6a6a['publicKey'],'wallets':{'usdtPolygonWallet':_0xda6a6a[_0x515618(0x1f3)],'usdtTrcWallet':_0xda6a6a[_0x515618(0xf0)],'usdtErcWallet':_0xda6a6a['usdtErcWallet'],'usdcPolygonWallet':_0xda6a6a[_0x515618(0x1f6)]},'status':_0xda6a6a['status'],'createdAt':_0xda6a6a['createdAt']};}),'pagination':{'page':_0x256a65,'limit':_0x4213d5,'total':_0xabbd14,'totalPages':Math[_0x335abd(0x15d)](_0xabbd14/_0x4213d5)}};}async['getUserById'](_0x16be2e){const _0x1516c2=a35_0x33dfec,_0x3beac4=await database_1[_0x1516c2(0xe3)][_0x1516c2(0x13e)]['findUnique']({'where':{'id':_0x16be2e},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x3beac4)return null;const _0x2e7f0c=_0x3beac4[_0x1516c2(0x162)]?JSON[_0x1516c2(0x152)](_0x3beac4[_0x1516c2(0x162)]):null,_0x17b805=_0x2e7f0c?_0x2e7f0c['map'](_0x2298e3=>this['getGatewayDisplayName'](_0x2298e3)):null;return _0x2e7f0c&&_0x17b805&&console[_0x1516c2(0x1c8)](_0x1516c2(0xf7),_0x2e7f0c,'->',_0x17b805),{'id':_0x3beac4['id'],'fullName':_0x3beac4['name'],'username':_0x3beac4[_0x1516c2(0x1fa)],'telegramId':_0x3beac4['telegram'],'merchantUrl':_0x3beac4[_0x1516c2(0x165)],'gateways':_0x17b805,'gatewaySettings':_0x3beac4[_0x1516c2(0x1ea)]?JSON['parse'](_0x3beac4[_0x1516c2(0x1ea)]):null,'publicKey':_0x3beac4[_0x1516c2(0x11c)],'wallets':{'usdtPolygonWallet':_0x3beac4[_0x1516c2(0x1f3)],'usdtTrcWallet':_0x3beac4[_0x1516c2(0xf0)],'usdtErcWallet':_0x3beac4[_0x1516c2(0x192)],'usdcPolygonWallet':_0x3beac4[_0x1516c2(0x1f6)]},'status':_0x3beac4[_0x1516c2(0x118)],'createdAt':_0x3beac4[_0x1516c2(0x1c9)]};}async[a35_0x33dfec(0x109)](_0x1064ed){const _0x406898=a35_0x33dfec,{fullName:_0x60c35a,username:_0x27d843,password:_0x1508eb,telegramId:_0x39b429,merchantUrl:_0x6f864,gateways:_0x4249f7,gatewaySettings:_0x2568d2,wallets:_0x32039b}=_0x1064ed,_0x85d09a=await database_1[_0x406898(0xe3)]['shop'][_0x406898(0x1b4)]({'where':{'username':_0x27d843}});if(_0x85d09a)throw new Error(_0x406898(0x1c0));if(_0x39b429){const _0x3c4c64=await database_1[_0x406898(0xe3)][_0x406898(0x13e)][_0x406898(0x1b4)]({'where':{'telegram':_0x39b429}});if(_0x3c4c64)throw new Error(_0x406898(0x155));}const _0x12ea71=await bcryptjs_1[_0x406898(0xe3)][_0x406898(0x1b3)](_0x1508eb,0xc),_0x537ac3=_0x406898(0x1aa)+crypto_1[_0x406898(0xe3)][_0x406898(0x14b)](0x20)['toString'](_0x406898(0x188)),_0x581b8c='sk_'+crypto_1[_0x406898(0xe3)][_0x406898(0x14b)](0x20)[_0x406898(0xe2)]('hex'),_0xcbe77=_0x4249f7?_0x4249f7[_0x406898(0x158)](_0x335346=>this[_0x406898(0x126)](_0x335346)):null;_0x4249f7&&_0xcbe77&&console['log'](_0x406898(0x13a),_0x4249f7,'->',_0xcbe77);const _0x4bb377=await database_1[_0x406898(0xe3)]['shop']['create']({'data':{'name':_0x60c35a,'username':_0x27d843,'password':_0x12ea71,'telegram':_0x39b429,'shopUrl':_0x6f864,'paymentGateways':_0xcbe77?JSON[_0x406898(0x16d)](_0xcbe77):null,'gatewaySettings':_0x2568d2?JSON[_0x406898(0x16d)](_0x2568d2):null,'usdtPolygonWallet':_0x32039b?.[_0x406898(0x1f3)]||null,'usdtTrcWallet':_0x32039b?.[_0x406898(0xf0)]||null,'usdtErcWallet':_0x32039b?.['usdtErcWallet']||null,'usdcPolygonWallet':_0x32039b?.['usdcPolygonWallet']||null,'publicKey':_0x537ac3,'secretKey':_0x581b8c,'status':_0x406898(0x110)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4bb377['id'],'fullName':_0x4bb377[_0x406898(0x14a)],'username':_0x4bb377[_0x406898(0x1fa)],'telegramId':_0x4bb377[_0x406898(0x135)],'merchantUrl':_0x4bb377['shopUrl'],'gateways':_0x4bb377[_0x406898(0x162)]?JSON[_0x406898(0x152)](_0x4bb377['paymentGateways']):null,'gatewaySettings':_0x4bb377[_0x406898(0x1ea)]?JSON[_0x406898(0x152)](_0x4bb377[_0x406898(0x1ea)]):null,'publicKey':_0x4bb377[_0x406898(0x11c)],'wallets':{'usdtPolygonWallet':_0x4bb377[_0x406898(0x1f3)],'usdtTrcWallet':_0x4bb377['usdtTrcWallet'],'usdtErcWallet':_0x4bb377['usdtErcWallet'],'usdcPolygonWallet':_0x4bb377[_0x406898(0x1f6)]},'status':_0x4bb377[_0x406898(0x118)],'createdAt':_0x4bb377['createdAt']};}async[a35_0x33dfec(0xed)](_0x265119){const _0x1bf27b=a35_0x33dfec;await database_1['default'][_0x1bf27b(0x13e)][_0x1bf27b(0x1ef)]({'where':{'id':_0x265119}});}['generateDailyStatistics'](_0x5434f2,_0x3f9559,_0x53a38b){const _0x427fd8=a35_0x33dfec,_0x3eff57=new Map(),_0x18efe8=new Date(_0x3f9559);while(_0x18efe8<=_0x53a38b){const _0x14cb3d=_0x18efe8[_0x427fd8(0x168)]()['split']('T')[0x0];_0x3eff57[_0x427fd8(0x15b)](_0x14cb3d,{'revenue':0x0,'count':0x0}),_0x18efe8['setDate'](_0x18efe8[_0x427fd8(0x142)]()+0x1);}for(const _0x31ac64 of _0x5434f2){const _0x37516f=_0x31ac64[_0x427fd8(0x1c9)]['toISOString']()['split']('T')[0x0],_0x1bfc54=_0x3eff57[_0x427fd8(0x132)](_0x37516f);_0x1bfc54&&(_0x1bfc54['count']+=0x1,_0x31ac64[_0x427fd8(0x118)]===_0x427fd8(0xf3)&&(_0x31ac64[_0x427fd8(0x13d)]?_0x1bfc54['revenue']+=_0x31ac64['amountUSDT']:console[_0x427fd8(0x1c8)](_0x427fd8(0x1f5)+_0x31ac64['id']+_0x427fd8(0x160))));}const _0x3b97f7=[],_0x1b1875=[];for(const [_0x1a2957,_0x23b5d8]of _0x3eff57){_0x3b97f7[_0x427fd8(0x1f9)]({'date':_0x1a2957,'amount':Math['round'](_0x23b5d8['revenue']*0x64)/0x64}),_0x1b1875[_0x427fd8(0x1f9)]({'date':_0x1a2957,'count':_0x23b5d8['count']});}return{'dailyRevenue':_0x3b97f7,'dailyPayments':_0x1b1875};}}exports[a35_0x33dfec(0x157)]=AdminService;