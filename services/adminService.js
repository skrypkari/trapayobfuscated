'use strict';function a35_0x3c47(){const _0xfbb005=['forEach',':\x20commission\x20=\x20','📊\x20Merchant\x20statistics\x20calculated:','telegramId','bcryptjs','stringify','gte','turnover','wallets','toLowerCase','createPayout','not\x20specified','currency','💰\x20Found\x20','all','\x20\x20\x20💵\x20Available\x20balance:\x20','\x20balance\x20updated:\x20','_sum','totalPayout','statusChangedBy','6064LihDbh','\x20USDT\x20(total\x20merchant\x20balances)','gateway','desc','🔧\x20Shop\x20','📊\x20Merchants\x20awaiting\x20payout:\x20','\x20USDT\x20(-','SUSPENDED','dateTo','updatePaymentStatus','591865NsxoVH','Noda','status','\x20\x20\x20Current\x20balance:\x20','Plisio','string','findUnique','usdtErcWallet','paidOutUSDT','\x20\x20\x20Balance:\x20','getMonth','payment','averageCheckUSDT','toISOString','💸\x20CHARGEBACK\x20penalty:\x20-','\x20USDT\x20total','📊\x20Payout\x20statistics\x20calculated:','findFirst','chargebackAmount','561297zNHOJX','default','getPaymentById','getPayoutById','merchantUrl','\x20status:\x20','CHARGEBACK','__importDefault','turnoverUSDT','currencyService','gateways','222662MGwDkw','hash','./currencyService','merchantEarnings','gatewayEarnings','\x20USDT\x20from\x20balance','paidAt','getUserById','custom','\x20->\x20','updateCustomerData','adminNotes','KLYME\x20DE','customerEmail','REFUND','values','\x20\x20\x20Total\x20paid\x20out:\x20','year','insensitive','ACTIVE','PAID','\x20gateway\x20settings:','Test\x20Gateway','notes','__esModule','\x20\x20\x20🌐\x20IP:\x20','periodFrom','\x20\x20\x20🌍\x20Country:\x20','totalCommissionRate','AdminService','map','amountUSDT','log','paymentGateways','commission','parse','toFixed','txid','password','56JccAgU','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','2020-01-01','💰\x20Payment\x20','reduce','customerUa','💰\x20Current\x20shop\x20balance:\x20','payout','pendingUrl','not\x20set','username','update','\x20USDT\x20(total\x20paid\x20to\x20merchants)','shopUrl','🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','totalPayments','round','190NEVJoA','💳\x20Payout\x20wallet\x20for\x20','getPayoutStats','delete','groupBy','getFullYear','fullName','sk_','customerIp','asc','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','\x20\x20\x20💰\x20Total\x20turnover:\x20','getGatewayDisplayName','212655MbpnjO','30d','Rapyd','error','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','periodTo','Payment\x20not\x20found','\x20\x20\x20Transaction\x20hash:\x20','\x20has\x20no\x20gateway\x20settings','totalPaidOut','dateFrom','create','KLYME\x20GB','getTime','⚠️\x20Shop\x20','\x20merchants,\x20','toUpperCase','findMany','month','period','convertToUSDT','customerCountry','\x20\x20\x20📊\x20Total\x20payments:\x20','lte','COMPLETED','set','\x20paid\x20payments\x20for\x20analysis','\x20for\x20shop\x20','orderId','\x20\x20\x20Payout\x20amount:\x20','usdcPolygonWallet','length','toString','../config/database','gatewayOrderId','availableBalance','\x20USDT\x20to\x20balance','\x20USDT','merchantEarningsUSDT','name','pk_','usdtPolygonWallet','totalTurnover','balance','📊\x20Total\x20payments\x20(including\x20failed):\x20','ceil','hex','publicKey','💰\x20Shop\x20','\x20USDT,\x20Requested:\x20','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','network','averageCommissionRate','aggregate','telegram','test_gateway','🔄\x20Admin\x20updating\x20payment\x20','$transaction','createdAt','\x20\x20\x20💰\x20Total\x20payout:\x20','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','shopId','10494LdeRJT','\x20\x20\x20🖥️\x20User\x20Agent:\x20','getMerchantStatistics','updateUser','917vcMqHD','commissionUSDT','randomBytes','4446qOspxm','customerName','getAllPayouts','thisMonth','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','erc20','Insufficient\x20balance.\x20Available:\x20','failureMessage','amount','getAllPayments','count','usdtTrcWallet','whiteUrl','paymentsCount','shop','date','defineProperty','getSystemStatistics','gatewaySettings','localeCompare','💰\x20Creating\x20payout\x20for\x20shop\x20','83469VBvYUj','split','deletePayout','successUrl','updatedAt','activateUser'];a35_0x3c47=function(){return _0xfbb005;};return a35_0x3c47();}const a35_0x5645db=a35_0x2d87;(function(_0x6e6f83,_0x2ef06b){const _0xaac795=a35_0x2d87,_0x86e7cc=_0x6e6f83();while(!![]){try{const _0x20ce34=-parseInt(_0xaac795(0x254))/0x1+-parseInt(_0xaac795(0x20f))/0x2+-parseInt(_0xaac795(0x1cd))/0x3*(parseInt(_0xaac795(0x236))/0x4)+parseInt(_0xaac795(0x1f1))/0x5+-parseInt(_0xaac795(0x292))/0x6*(-parseInt(_0xaac795(0x296))/0x7)+-parseInt(_0xaac795(0x1e7))/0x8*(parseInt(_0xaac795(0x299))/0x9)+-parseInt(_0xaac795(0x247))/0xa*(-parseInt(_0xaac795(0x204))/0xb);if(_0x20ce34===_0x2ef06b)break;else _0x86e7cc['push'](_0x86e7cc['shift']());}catch(_0x170c1b){_0x86e7cc['push'](_0x86e7cc['shift']());}}}(a35_0x3c47,0x37eb5));var __importDefault=this&&this[a35_0x5645db(0x20b)]||function(_0x51738b){const _0x4d6716=a35_0x5645db;return _0x51738b&&_0x51738b[_0x4d6716(0x227)]?_0x51738b:{'default':_0x51738b};};Object[a35_0x5645db(0x1c8)](exports,a35_0x5645db(0x227),{'value':!![]}),exports['AdminService']=void 0x0;const database_1=__importDefault(require(a35_0x5645db(0x275))),bcryptjs_1=__importDefault(require(a35_0x5645db(0x1d7))),crypto_1=__importDefault(require('crypto')),currencyService_1=require(a35_0x5645db(0x211));function a35_0x2d87(_0x157edb,_0x4f0e2a){const _0x3c4719=a35_0x3c47();return a35_0x2d87=function(_0x2d87eb,_0x2d2697){_0x2d87eb=_0x2d87eb-0x1be;let _0x7e8294=_0x3c4719[_0x2d87eb];return _0x7e8294;},a35_0x2d87(_0x157edb,_0x4f0e2a);}class AdminService{async[a35_0x5645db(0x249)](){const _0x24a5dc=a35_0x5645db;console[_0x24a5dc(0x22f)]('📊\x20Calculating\x20payout\x20statistics...');const _0x279bdc=await database_1[_0x24a5dc(0x205)][_0x24a5dc(0x1c6)][_0x24a5dc(0x289)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x24a5dc(0x222)}}),_0x3db23c=new Date(),_0x582781=new Date(_0x3db23c['getFullYear'](),_0x3db23c[_0x24a5dc(0x1fb)](),0x1),_0x4f5b8a=new Date(_0x3db23c[_0x24a5dc(0x24c)](),_0x3db23c[_0x24a5dc(0x1fb)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x22036b=await database_1[_0x24a5dc(0x205)][_0x24a5dc(0x23d)][_0x24a5dc(0x289)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x582781,'lte':_0x4f5b8a},'status':'COMPLETED'}}),_0x2d5f18=_0x279bdc['_sum'][_0x24a5dc(0x25d)]||0x0,_0x20ebe4=_0x279bdc[_0x24a5dc(0x1e4)][_0x24a5dc(0x27f)]||0x0,_0x51149b=_0x22036b[_0x24a5dc(0x1e4)][_0x24a5dc(0x1c0)]||0x0,_0x197d24={'totalPayout':Math['round'](_0x2d5f18*0x64)/0x64,'awaitingPayout':Math[_0x24a5dc(0x246)](_0x20ebe4*0x64)/0x64,'thisMonth':Math[_0x24a5dc(0x246)](_0x51149b*0x64)/0x64,'availableBalance':Math[_0x24a5dc(0x246)](_0x20ebe4*0x64)/0x64};return console[_0x24a5dc(0x22f)](_0x24a5dc(0x201)),console[_0x24a5dc(0x22f)](_0x24a5dc(0x28f)+_0x197d24[_0x24a5dc(0x1e5)]+_0x24a5dc(0x242)),console[_0x24a5dc(0x22f)](_0x24a5dc(0x290)+_0x197d24['awaitingPayout']+_0x24a5dc(0x1e8)),console[_0x24a5dc(0x22f)](_0x24a5dc(0x1e2)+_0x197d24[_0x24a5dc(0x277)]+'\x20USDT\x20(same\x20as\x20awaiting)'),console['log']('\x20\x20\x20📅\x20This\x20month:\x20'+_0x197d24[_0x24a5dc(0x29c)]+_0x24a5dc(0x279)),_0x197d24;}async[a35_0x5645db(0x219)](_0xfd1055,_0xaba45c){const _0x5dc5a0=a35_0x5645db;console['log']('🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20'+_0xfd1055+':',_0xaba45c);const _0x4e4cdc=await database_1[_0x5dc5a0(0x205)][_0x5dc5a0(0x1fc)]['findUnique']({'where':{'id':_0xfd1055},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x4e4cdc)throw new Error(_0x5dc5a0(0x25a));const _0x6f2fe4={};_0xaba45c[_0x5dc5a0(0x269)]!==undefined&&(_0x6f2fe4['customerCountry']=_0xaba45c[_0x5dc5a0(0x269)]||null);_0xaba45c[_0x5dc5a0(0x24f)]!==undefined&&(_0x6f2fe4[_0x5dc5a0(0x24f)]=_0xaba45c[_0x5dc5a0(0x24f)]||null);_0xaba45c[_0x5dc5a0(0x23b)]!==undefined&&(_0x6f2fe4[_0x5dc5a0(0x23b)]=_0xaba45c[_0x5dc5a0(0x23b)]||null);const _0x5461cf=await database_1[_0x5dc5a0(0x205)][_0x5dc5a0(0x1fc)][_0x5dc5a0(0x241)]({'where':{'id':_0xfd1055},'data':{..._0x6f2fe4,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x5dc5a0(0x22f)](_0x5dc5a0(0x286)+_0xfd1055),console[_0x5dc5a0(0x22f)](_0x5dc5a0(0x22a)+_0x4e4cdc[_0x5dc5a0(0x269)]+_0x5dc5a0(0x218)+_0x5461cf['customerCountry']),console['log'](_0x5dc5a0(0x228)+_0x4e4cdc[_0x5dc5a0(0x24f)]+'\x20->\x20'+_0x5461cf[_0x5dc5a0(0x24f)]),console['log'](_0x5dc5a0(0x293)+(_0x4e4cdc[_0x5dc5a0(0x23b)]?'set':_0x5dc5a0(0x23f))+_0x5dc5a0(0x218)+(_0x5461cf['customerUa']?_0x5dc5a0(0x26d):_0x5dc5a0(0x23f))),_0x5461cf;}async[a35_0x5645db(0x1c9)](_0xf1da31){const _0x50556f=a35_0x5645db,_0x50de87=new Date();let _0x2bbf54;switch(_0xf1da31){case'7d':_0x2bbf54=new Date(_0x50de87[_0x50556f(0x261)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x50556f(0x255):_0x2bbf54=new Date(_0x50de87[_0x50556f(0x261)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'90d':_0x2bbf54=new Date(_0x50de87[_0x50556f(0x261)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x2bbf54=new Date(_0x50de87[_0x50556f(0x261)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x219006,_0x26c23b,_0xf14d5b,_0x212dff,_0x2e5d7e,_0x483407]=await Promise['all']([database_1['default']['shop'][_0x50556f(0x1c2)](),database_1['default']['shop'][_0x50556f(0x1c2)]({'where':{'status':_0x50556f(0x222)}}),database_1[_0x50556f(0x205)][_0x50556f(0x1fc)][_0x50556f(0x1c2)]({'where':{'createdAt':{'gte':_0x2bbf54},'gateway':{'not':_0x50556f(0x28b)}}}),database_1[_0x50556f(0x205)][_0x50556f(0x1fc)][_0x50556f(0x1c2)]({'where':{'status':_0x50556f(0x223),'createdAt':{'gte':_0x2bbf54},'gateway':{'not':_0x50556f(0x28b)}}}),database_1[_0x50556f(0x205)][_0x50556f(0x1fc)][_0x50556f(0x265)]({'where':{'status':_0x50556f(0x223),'createdAt':{'gte':_0x2bbf54},'gateway':{'not':_0x50556f(0x28b)}},'select':{'amount':!![],'currency':!![]}}),database_1[_0x50556f(0x205)]['payment'][_0x50556f(0x265)]({'where':{'gateway':{'not':'test_gateway'}},'take':0xa,'orderBy':{'createdAt':_0x50556f(0x1ea)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}})]);let _0x3b3603=0x0;for(const _0x250f40 of _0x2e5d7e){const _0x24e293=await currencyService_1[_0x50556f(0x20d)][_0x50556f(0x268)](_0x250f40[_0x50556f(0x1c0)],_0x250f40[_0x50556f(0x1df)]);_0x3b3603+=_0x24e293;}const _0x560487=_0xf14d5b>0x0?_0x212dff/_0xf14d5b*0x64:0x0;return{'totalShops':_0x219006,'activeShops':_0x26c23b,'totalPayments':_0xf14d5b,'successfulPayments':_0x212dff,'totalRevenue':Math[_0x50556f(0x246)](_0x3b3603*0x64)/0x64,'conversionRate':Math[_0x50556f(0x246)](_0x560487*0x64)/0x64,'recentPayments':_0x483407['map'](_0x5e7c0d=>({'id':_0x5e7c0d['id'],'amount':_0x5e7c0d[_0x50556f(0x1c0)],'currency':_0x5e7c0d[_0x50556f(0x1df)],'status':_0x5e7c0d['status'],'gateway':_0x5e7c0d[_0x50556f(0x1e9)],'shop':_0x5e7c0d[_0x50556f(0x1c6)],'createdAt':_0x5e7c0d['createdAt']}))};}async[a35_0x5645db(0x294)](_0x166d66){const _0x17bc88=a35_0x5645db;console[_0x17bc88(0x22f)](_0x17bc88(0x251),_0x166d66);let _0x3ceda0,_0x3fdb01=new Date();if(_0x166d66[_0x17bc88(0x267)]===_0x17bc88(0x217)&&_0x166d66[_0x17bc88(0x25e)]&&_0x166d66[_0x17bc88(0x1ef)])_0x3ceda0=new Date(_0x166d66[_0x17bc88(0x25e)]),_0x3fdb01=new Date(_0x166d66[_0x17bc88(0x1ef)]);else{const _0x700a7f=new Date();switch(_0x166d66['period']){case'week':_0x3ceda0=new Date(_0x700a7f['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x17bc88(0x266):_0x3ceda0=new Date(_0x700a7f[_0x17bc88(0x261)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x17bc88(0x220):_0x3ceda0=new Date(_0x700a7f['getTime']()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case'all':default:_0x3ceda0=new Date(_0x17bc88(0x238));break;}}console['log']('📅\x20Period:\x20'+_0x3ceda0[_0x17bc88(0x1fe)]()+'\x20to\x20'+_0x3fdb01[_0x17bc88(0x1fe)]());const _0x437d9f={'status':_0x17bc88(0x223),'gateway':{'not':_0x17bc88(0x28b)},'paidAt':{'gte':_0x3ceda0,'lte':_0x3fdb01}};_0x166d66[_0x17bc88(0x291)]&&(_0x437d9f[_0x17bc88(0x291)]=_0x166d66['shopId']);const _0xa8629a=await database_1[_0x17bc88(0x205)][_0x17bc88(0x1fc)]['findMany']({'where':_0x437d9f,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x17bc88(0x22f)]('💰\x20Found\x20'+_0xa8629a[_0x17bc88(0x273)]+_0x17bc88(0x26e));const _0x1952e7={'gateway':{'not':_0x17bc88(0x28b)},'createdAt':{'gte':_0x3ceda0,'lte':_0x3fdb01}};_0x166d66[_0x17bc88(0x291)]&&(_0x1952e7[_0x17bc88(0x291)]=_0x166d66[_0x17bc88(0x291)]);const _0x35ae26=await database_1[_0x17bc88(0x205)][_0x17bc88(0x1fc)][_0x17bc88(0x1c2)]({'where':_0x1952e7});console['log'](_0x17bc88(0x280)+_0x35ae26+',\x20successful:\x20'+_0xa8629a[_0x17bc88(0x273)]);let _0x3d01f2=0x0,_0x550797=0x0,_0x248972=0x0;const _0x229a90={},_0x458728={},_0x3fa3b5={};for(const _0x1dd92a of _0xa8629a){try{const _0x353a9f=await currencyService_1['currencyService'][_0x17bc88(0x268)](_0x1dd92a['amount'],_0x1dd92a[_0x17bc88(0x1df)]);let _0x992bbc={};if(_0x1dd92a[_0x17bc88(0x1c6)]['gatewaySettings'])try{_0x992bbc=JSON[_0x17bc88(0x232)](_0x1dd92a[_0x17bc88(0x1c6)]['gatewaySettings']),console[_0x17bc88(0x22f)](_0x17bc88(0x1eb)+_0x1dd92a[_0x17bc88(0x291)]+_0x17bc88(0x224),_0x992bbc);}catch(_0x411e6e){console[_0x17bc88(0x257)]('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x1dd92a[_0x17bc88(0x291)]+':',_0x411e6e);}else console[_0x17bc88(0x22f)](_0x17bc88(0x262)+_0x1dd92a[_0x17bc88(0x291)]+_0x17bc88(0x25c));const _0x102629=_0x992bbc[_0x1dd92a[_0x17bc88(0x1e9)]]||{},_0x27b789=_0x102629[_0x17bc88(0x231)]||0xa;console['log']('💰\x20Gateway\x20'+_0x1dd92a[_0x17bc88(0x1e9)]+_0x17bc88(0x26f)+_0x1dd92a['shopId']+_0x17bc88(0x1d4)+_0x27b789+'%',_0x102629);const _0x50634e=_0x353a9f*(_0x27b789/0x64),_0x1a3b0a=_0x353a9f-_0x50634e;_0x3d01f2+=_0x353a9f,_0x550797+=_0x1a3b0a,_0x248972+=_0x50634e;!_0x229a90[_0x1dd92a[_0x17bc88(0x1e9)]]&&(_0x229a90[_0x1dd92a[_0x17bc88(0x1e9)]]={'gateway':_0x1dd92a[_0x17bc88(0x1e9)],'gatewayDisplayName':this[_0x17bc88(0x253)](_0x1dd92a['gateway']),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x229a90[_0x1dd92a['gateway']][_0x17bc88(0x1c5)]++,_0x229a90[_0x1dd92a[_0x17bc88(0x1e9)]]['turnoverUSDT']+=_0x353a9f,_0x229a90[_0x1dd92a[_0x17bc88(0x1e9)]][_0x17bc88(0x297)]+=_0x50634e,_0x229a90[_0x1dd92a[_0x17bc88(0x1e9)]][_0x17bc88(0x27a)]+=_0x1a3b0a,_0x229a90[_0x1dd92a[_0x17bc88(0x1e9)]][_0x17bc88(0x22b)]+=_0x27b789;!_0x166d66[_0x17bc88(0x291)]&&(!_0x458728[_0x1dd92a[_0x17bc88(0x291)]]&&(_0x458728[_0x1dd92a[_0x17bc88(0x291)]]={'shopId':_0x1dd92a['shopId'],'shopName':_0x1dd92a['shop'][_0x17bc88(0x27b)],'shopUsername':_0x1dd92a['shop'][_0x17bc88(0x240)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x458728[_0x1dd92a[_0x17bc88(0x291)]][_0x17bc88(0x1c5)]++,_0x458728[_0x1dd92a[_0x17bc88(0x291)]][_0x17bc88(0x20c)]+=_0x353a9f,_0x458728[_0x1dd92a['shopId']][_0x17bc88(0x297)]+=_0x50634e,_0x458728[_0x1dd92a['shopId']]['merchantEarningsUSDT']+=_0x1a3b0a);const _0x3ee892=_0x1dd92a[_0x17bc88(0x215)][_0x17bc88(0x1fe)]()[_0x17bc88(0x1ce)]('T')[0x0];!_0x3fa3b5[_0x3ee892]&&(_0x3fa3b5[_0x3ee892]={'date':_0x3ee892,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x3fa3b5[_0x3ee892][_0x17bc88(0x1da)]+=_0x353a9f,_0x3fa3b5[_0x3ee892][_0x17bc88(0x212)]+=_0x1a3b0a,_0x3fa3b5[_0x3ee892][_0x17bc88(0x213)]+=_0x50634e,_0x3fa3b5[_0x3ee892]['paymentsCount']++;}catch(_0x1fa052){console[_0x17bc88(0x257)]('Error\x20processing\x20payment\x20'+_0x1dd92a['id']+':',_0x1fa052);}}Object[_0x17bc88(0x21e)](_0x229a90)['forEach'](_0x3eef25=>{const _0x4293a9=_0x17bc88;_0x3eef25['averageCommissionRate']=_0x3eef25[_0x4293a9(0x1c5)]>0x0?_0x3eef25[_0x4293a9(0x22b)]/_0x3eef25[_0x4293a9(0x1c5)]:0x0,delete _0x3eef25['totalCommissionRate'];}),Object[_0x17bc88(0x21e)](_0x458728)[_0x17bc88(0x1d3)](_0x2f23bd=>{const _0x1a4aef=_0x17bc88;_0x2f23bd[_0x1a4aef(0x1fd)]=_0x2f23bd[_0x1a4aef(0x1c5)]>0x0?_0x2f23bd['turnoverUSDT']/_0x2f23bd['paymentsCount']:0x0;});let _0x153c17=0x0;if(_0x166d66['shopId']){const _0x135a1d=await database_1[_0x17bc88(0x205)][_0x17bc88(0x23d)]['findMany']({'where':{'shopId':_0x166d66[_0x17bc88(0x291)],'status':_0x17bc88(0x26c),'createdAt':{'gte':_0x3ceda0,'lte':_0x3fdb01}},'select':{'amount':!![]}});_0x153c17=_0x135a1d[_0x17bc88(0x23a)]((_0xe9aa2a,_0x5b5dff)=>_0xe9aa2a+_0x5b5dff[_0x17bc88(0x1c0)],0x0);}const _0x44993b=_0x35ae26,_0x308ea8=_0xa8629a[_0x17bc88(0x273)],_0x5d1760=_0x308ea8>0x0?_0x3d01f2/_0x308ea8:0x0,_0x46f38e=_0x44993b>0x0?Math['round'](_0x308ea8/_0x44993b*0x2710)/0x64:0x0,_0x1d87f4=Math[_0x17bc88(0x281)]((_0x3fdb01[_0x17bc88(0x261)]()-_0x3ceda0[_0x17bc88(0x261)]())/(0x3e8*0x3c*0x3c*0x18)),_0x3c1546={'totalTurnover':Math[_0x17bc88(0x246)](_0x3d01f2*0x64)/0x64,'merchantEarnings':Math[_0x17bc88(0x246)](_0x550797*0x64)/0x64,'gatewayEarnings':Math['round'](_0x248972*0x64)/0x64,'totalPaidOut':Math[_0x17bc88(0x246)](_0x153c17*0x64)/0x64,'averageCheck':Math['round'](_0x5d1760*0x64)/0x64,'totalPayments':_0x44993b,'successfulPayments':_0x308ea8,'conversionRate':_0x46f38e,'gatewayBreakdown':Object['values'](_0x229a90)[_0x17bc88(0x22d)](_0x3e7e7a=>({..._0x3e7e7a,'turnoverUSDT':Math[_0x17bc88(0x246)](_0x3e7e7a[_0x17bc88(0x20c)]*0x64)/0x64,'commissionUSDT':Math[_0x17bc88(0x246)](_0x3e7e7a['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x3e7e7a[_0x17bc88(0x27a)]*0x64)/0x64,'averageCommissionRate':Math[_0x17bc88(0x246)](_0x3e7e7a[_0x17bc88(0x288)]*0x64)/0x64})),'merchantBreakdown':_0x166d66[_0x17bc88(0x291)]?undefined:Object[_0x17bc88(0x21e)](_0x458728)[_0x17bc88(0x22d)](_0x392373=>({..._0x392373,'turnoverUSDT':Math['round'](_0x392373[_0x17bc88(0x20c)]*0x64)/0x64,'commissionUSDT':Math[_0x17bc88(0x246)](_0x392373[_0x17bc88(0x297)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x17bc88(0x246)](_0x392373['merchantEarningsUSDT']*0x64)/0x64,'paidOutUSDT':Math[_0x17bc88(0x246)](_0x392373[_0x17bc88(0x1f9)]*0x64)/0x64,'averageCheckUSDT':Math['round'](_0x392373[_0x17bc88(0x1fd)]*0x64)/0x64})),'dailyData':Object[_0x17bc88(0x21e)](_0x3fa3b5)['map'](_0x4e6a0a=>({..._0x4e6a0a,'turnover':Math[_0x17bc88(0x246)](_0x4e6a0a[_0x17bc88(0x1da)]*0x64)/0x64,'merchantEarnings':Math[_0x17bc88(0x246)](_0x4e6a0a[_0x17bc88(0x212)]*0x64)/0x64,'gatewayEarnings':Math['round'](_0x4e6a0a[_0x17bc88(0x213)]*0x64)/0x64}))['sort']((_0x24c882,_0xcd7a82)=>_0x24c882[_0x17bc88(0x1c7)][_0x17bc88(0x1cb)](_0xcd7a82[_0x17bc88(0x1c7)])),'periodInfo':{'from':_0x3ceda0,'to':_0x3fdb01,'periodType':_0x166d66[_0x17bc88(0x267)]||'custom','daysCount':_0x1d87f4}};return console[_0x17bc88(0x22f)](_0x17bc88(0x1d5)),console[_0x17bc88(0x22f)](_0x17bc88(0x252)+_0x3c1546[_0x17bc88(0x27e)]+'\x20USDT'),console[_0x17bc88(0x22f)](_0x17bc88(0x29d)+_0x3c1546[_0x17bc88(0x212)]+_0x17bc88(0x279)),console[_0x17bc88(0x22f)](_0x17bc88(0x237)+_0x3c1546[_0x17bc88(0x213)]+_0x17bc88(0x279)),console[_0x17bc88(0x22f)](_0x17bc88(0x26a)+_0x3c1546[_0x17bc88(0x245)]),_0x3c1546;}[a35_0x5645db(0x253)](_0x33af66){const _0x4ed750=a35_0x5645db,_0x3f7189={'test_gateway':_0x4ed750(0x225),'plisio':_0x4ed750(0x1f5),'rapyd':_0x4ed750(0x256),'noda':_0x4ed750(0x1f2),'cointopay':'CoinToPay','klyme_eu':'KLYME\x20EU','klyme_gb':_0x4ed750(0x260),'klyme_de':_0x4ed750(0x21b)};return _0x3f7189[_0x33af66]||_0x33af66;}async['getMerchantsAwaitingPayout'](_0x25ccdc){const _0x5a30fd=a35_0x5645db,{page:_0x2f1699,limit:_0x50bc6f,minAmount:_0x289ace,search:_0x113c5c}=_0x25ccdc,_0x129545=(_0x2f1699-0x1)*_0x50bc6f;console[_0x5a30fd(0x22f)]('📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:',_0x25ccdc);const _0xccb012={'balance':{'gt':0x0},'status':_0x5a30fd(0x222)};_0x289ace&&(_0xccb012[_0x5a30fd(0x27f)]['gte']=_0x289ace);_0x113c5c&&(_0xccb012['OR']=[{'name':{'contains':_0x113c5c,'mode':_0x5a30fd(0x221)}},{'username':{'contains':_0x113c5c,'mode':_0x5a30fd(0x221)}}]);const [_0x1e32c2,_0x470e85]=await Promise[_0x5a30fd(0x1e1)]([database_1[_0x5a30fd(0x205)][_0x5a30fd(0x1c6)][_0x5a30fd(0x265)]({'where':_0xccb012,'skip':_0x129545,'take':_0x50bc6f,'orderBy':{'balance':_0x5a30fd(0x1ea)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'createdAt':!![]}}),database_1['default'][_0x5a30fd(0x1c6)][_0x5a30fd(0x1c2)]({'where':_0xccb012})]);console[_0x5a30fd(0x22f)](_0x5a30fd(0x1e0)+_0x1e32c2['length']+'\x20merchants\x20with\x20positive\x20balance');const _0x4449e8=await Promise[_0x5a30fd(0x1e1)](_0x1e32c2['map'](async _0x3c18c7=>{const _0x32e4ec=_0x5a30fd,[_0x3efadc,_0x337ed6,_0x28b5e5]=await Promise[_0x32e4ec(0x1e1)]([database_1[_0x32e4ec(0x205)][_0x32e4ec(0x1fc)][_0x32e4ec(0x1c2)]({'where':{'shopId':_0x3c18c7['id'],'status':_0x32e4ec(0x223),'amountUSDT':{'not':null}}}),database_1[_0x32e4ec(0x205)][_0x32e4ec(0x1fc)][_0x32e4ec(0x202)]({'where':{'shopId':_0x3c18c7['id'],'status':_0x32e4ec(0x223),'amountUSDT':{'not':null}},'orderBy':{'paidAt':_0x32e4ec(0x250)},'select':{'paidAt':!![]}}),database_1[_0x32e4ec(0x205)]['payment'][_0x32e4ec(0x24b)]({'by':['gateway'],'where':{'shopId':_0x3c18c7['id'],'status':_0x32e4ec(0x223),'amountUSDT':{'not':null}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x4e5b9c=_0x28b5e5[_0x32e4ec(0x22d)](_0x1c2c01=>({'gateway':_0x1c2c01[_0x32e4ec(0x1e9)],'count':_0x1c2c01['_count']['id'],'amountUSDT':_0x1c2c01[_0x32e4ec(0x1e4)][_0x32e4ec(0x22e)]||0x0,'amountAfterCommissionUSDT':_0x1c2c01[_0x32e4ec(0x1e4)][_0x32e4ec(0x22e)]||0x0,'commission':0x0}));return{'id':_0x3c18c7['id'],'fullName':_0x3c18c7['name'],'username':_0x3c18c7['username'],'telegramId':_0x3c18c7[_0x32e4ec(0x28a)],'merchantUrl':_0x3c18c7['shopUrl'],'wallets':{'usdtPolygonWallet':_0x3c18c7[_0x32e4ec(0x27d)],'usdtTrcWallet':_0x3c18c7['usdtTrcWallet'],'usdtErcWallet':_0x3c18c7[_0x32e4ec(0x1f8)],'usdcPolygonWallet':_0x3c18c7[_0x32e4ec(0x272)]},'totalAmountUSDT':_0x3c18c7[_0x32e4ec(0x27f)],'totalAmountAfterCommissionUSDT':_0x3c18c7['balance'],'paymentsCount':_0x3efadc,'oldestPaymentDate':_0x337ed6?.[_0x32e4ec(0x215)]||_0x3c18c7['createdAt'],'gatewayBreakdown':_0x4e5b9c};})),_0x36e750=_0x1e32c2[_0x5a30fd(0x23a)]((_0x5ca50c,_0x30035a)=>_0x5ca50c+_0x30035a[_0x5a30fd(0x27f)],0x0),_0x3b6244=_0x36e750;return console[_0x5a30fd(0x22f)](_0x5a30fd(0x1ec)+_0x470e85+_0x5a30fd(0x263)+Math[_0x5a30fd(0x246)](_0x3b6244*0x64)/0x64+_0x5a30fd(0x200)),{'merchants':_0x4449e8,'pagination':{'page':_0x2f1699,'limit':_0x50bc6f,'total':_0x470e85,'totalPages':Math[_0x5a30fd(0x281)](_0x470e85/_0x50bc6f)},'summary':{'totalMerchants':_0x470e85,'totalAmountUSDT':Math[_0x5a30fd(0x246)](_0x36e750*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x5a30fd(0x246)](_0x3b6244*0x64)/0x64}};}async[a35_0x5645db(0x1dd)](_0x5deaf3){const _0x566280=a35_0x5645db,{shopId:_0x41ec60,amount:_0x1e1236,network:_0x302178,wallet:_0x158eb9,notes:_0x28e09d,txid:_0xe362d0,periodFrom:_0x467921,periodTo:_0x40248e}=_0x5deaf3,_0x1bb943=await database_1[_0x566280(0x205)][_0x566280(0x28d)](async _0x48ec76=>{const _0x599297=_0x566280,_0x441626=await _0x48ec76[_0x599297(0x1c6)][_0x599297(0x1f7)]({'where':{'id':_0x41ec60},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x441626)throw new Error('Shop\x20not\x20found');console[_0x599297(0x22f)](_0x599297(0x1cc)+_0x441626[_0x599297(0x240)]+':'),console[_0x599297(0x22f)](_0x599297(0x1f4)+_0x441626[_0x599297(0x27f)][_0x599297(0x233)](0x6)+_0x599297(0x279)),console['log'](_0x599297(0x271)+_0x1e1236[_0x599297(0x233)](0x6)+'\x20USDT'),console[_0x599297(0x22f)](_0x599297(0x258)+_0x441626[_0x599297(0x25d)][_0x599297(0x233)](0x6)+_0x599297(0x279));if(_0xe362d0)console[_0x599297(0x22f)](_0x599297(0x25b)+_0xe362d0);if(_0x441626['balance']<_0x1e1236)throw new Error(_0x599297(0x1be)+_0x441626[_0x599297(0x27f)]['toFixed'](0x6)+_0x599297(0x285)+_0x1e1236[_0x599297(0x233)](0x6)+_0x599297(0x279));let _0x47cdb9=_0x158eb9;if(!_0x47cdb9){const _0x4abea5=await _0x48ec76[_0x599297(0x1c6)][_0x599297(0x1f7)]({'where':{'id':_0x41ec60},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x4abea5)switch(_0x302178){case'polygon':_0x47cdb9=_0x4abea5[_0x599297(0x27d)]||undefined;break;case'trc20':_0x47cdb9=_0x4abea5['usdtTrcWallet']||undefined;break;case _0x599297(0x29e):_0x47cdb9=_0x4abea5[_0x599297(0x1f8)]||undefined;break;case'polygon_usdc':_0x47cdb9=_0x4abea5[_0x599297(0x272)]||undefined;break;}}console[_0x599297(0x22f)](_0x599297(0x248)+_0x302178+':\x20'+(_0x47cdb9||_0x599297(0x1de)));const _0x335c72=await _0x48ec76[_0x599297(0x23d)]['create']({'data':{'shopId':_0x41ec60,'amount':_0x1e1236,'network':_0x302178,'status':_0x599297(0x26c),'txid':_0xe362d0,'notes':_0x28e09d,'periodFrom':_0x467921?new Date(_0x467921):null,'periodTo':_0x40248e?new Date(_0x40248e):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x5a20cb=_0x441626[_0x599297(0x27f)]-_0x1e1236,_0xc485ee=_0x441626['totalPaidOut']+_0x1e1236;return await _0x48ec76['shop']['update']({'where':{'id':_0x41ec60},'data':{'balance':_0x5a20cb,'totalPaidOut':_0xc485ee}}),console[_0x599297(0x22f)](_0x599297(0x284)+_0x441626[_0x599297(0x240)]+'\x20balance\x20updated:'),console['log'](_0x599297(0x1fa)+_0x441626[_0x599297(0x27f)]['toFixed'](0x6)+'\x20->\x20'+_0x5a20cb[_0x599297(0x233)](0x6)+_0x599297(0x1ed)+_0x1e1236[_0x599297(0x233)](0x6)+')'),console[_0x599297(0x22f)](_0x599297(0x21f)+_0x441626['totalPaidOut'][_0x599297(0x233)](0x6)+_0x599297(0x218)+_0xc485ee[_0x599297(0x233)](0x6)+'\x20USDT\x20(+'+_0x1e1236[_0x599297(0x233)](0x6)+')'),{'payout':_0x335c72,'shop':_0x441626};});return console[_0x566280(0x22f)]('✅\x20Payout\x20created:\x20'+_0x1bb943[_0x566280(0x23d)]['id']+_0x566280(0x26f)+_0x1bb943['shop'][_0x566280(0x240)]+'\x20('+_0x1e1236+'\x20USDT)'),{'id':_0x1bb943[_0x566280(0x23d)]['id'],'shopId':_0x1bb943['payout'][_0x566280(0x291)],'shopName':_0x1bb943[_0x566280(0x1c6)][_0x566280(0x27b)],'shopUsername':_0x1bb943[_0x566280(0x1c6)][_0x566280(0x240)],'amount':_0x1bb943['payout'][_0x566280(0x1c0)],'network':_0x1bb943[_0x566280(0x23d)]['network'],'status':_0x1bb943[_0x566280(0x23d)][_0x566280(0x1f3)],'txid':_0x1bb943['payout'][_0x566280(0x234)],'notes':_0x1bb943['payout']['notes'],'periodFrom':_0x1bb943['payout'][_0x566280(0x229)],'periodTo':_0x1bb943[_0x566280(0x23d)][_0x566280(0x259)],'createdAt':_0x1bb943[_0x566280(0x23d)]['createdAt'],'paidAt':_0x1bb943['payout'][_0x566280(0x215)]};}async[a35_0x5645db(0x29b)](_0x131e71){const _0x2709e7=a35_0x5645db,{page:_0x51630b,limit:_0x1a92d2,shopId:_0x3aee7d,network:_0x36d342,dateFrom:_0x3ee7e7,dateTo:_0x344d76,search:_0x1ea336}=_0x131e71,_0x474c03=(_0x51630b-0x1)*_0x1a92d2,_0x518e48={};_0x3aee7d&&(_0x518e48['shopId']=_0x3aee7d);_0x36d342&&(_0x518e48['network']=_0x36d342);(_0x3ee7e7||_0x344d76)&&(_0x518e48[_0x2709e7(0x28e)]={},_0x3ee7e7&&(_0x518e48[_0x2709e7(0x28e)][_0x2709e7(0x1d9)]=new Date(_0x3ee7e7)),_0x344d76&&(_0x518e48[_0x2709e7(0x28e)][_0x2709e7(0x26b)]=new Date(_0x344d76)));_0x1ea336&&(_0x518e48['OR']=[{'shop':{'name':{'contains':_0x1ea336,'mode':_0x2709e7(0x221)}}},{'shop':{'username':{'contains':_0x1ea336,'mode':'insensitive'}}},{'notes':{'contains':_0x1ea336,'mode':'insensitive'}}]);const [_0x146587,_0x11abbf]=await Promise[_0x2709e7(0x1e1)]([database_1[_0x2709e7(0x205)][_0x2709e7(0x23d)]['findMany']({'where':_0x518e48,'skip':_0x474c03,'take':_0x1a92d2,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x2709e7(0x205)][_0x2709e7(0x23d)][_0x2709e7(0x1c2)]({'where':_0x518e48})]);return{'payouts':_0x146587['map'](_0x2dcc37=>({'id':_0x2dcc37['id'],'shopId':_0x2dcc37[_0x2709e7(0x291)],'shopName':_0x2dcc37[_0x2709e7(0x1c6)]['name'],'shopUsername':_0x2dcc37[_0x2709e7(0x1c6)][_0x2709e7(0x240)],'amount':_0x2dcc37[_0x2709e7(0x1c0)],'network':_0x2dcc37[_0x2709e7(0x287)],'status':_0x2dcc37['status'],'txid':_0x2dcc37[_0x2709e7(0x234)],'notes':_0x2dcc37[_0x2709e7(0x226)],'periodFrom':_0x2dcc37[_0x2709e7(0x229)],'periodTo':_0x2dcc37[_0x2709e7(0x259)],'createdAt':_0x2dcc37[_0x2709e7(0x28e)],'paidAt':_0x2dcc37['paidAt']})),'pagination':{'page':_0x51630b,'limit':_0x1a92d2,'total':_0x11abbf,'totalPages':Math[_0x2709e7(0x281)](_0x11abbf/_0x1a92d2)}};}async[a35_0x5645db(0x207)](_0x4f6d0a){const _0x4581e2=a35_0x5645db,_0x6beeff=await database_1[_0x4581e2(0x205)][_0x4581e2(0x23d)]['findUnique']({'where':{'id':_0x4f6d0a},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x6beeff)return null;return{'id':_0x6beeff['id'],'shopId':_0x6beeff[_0x4581e2(0x291)],'shopName':_0x6beeff[_0x4581e2(0x1c6)]['name'],'shopUsername':_0x6beeff[_0x4581e2(0x1c6)][_0x4581e2(0x240)],'amount':_0x6beeff[_0x4581e2(0x1c0)],'network':_0x6beeff[_0x4581e2(0x287)],'status':_0x6beeff[_0x4581e2(0x1f3)],'txid':_0x6beeff['txid'],'notes':_0x6beeff[_0x4581e2(0x226)],'periodFrom':_0x6beeff[_0x4581e2(0x229)],'periodTo':_0x6beeff['periodTo'],'createdAt':_0x6beeff[_0x4581e2(0x28e)],'paidAt':_0x6beeff['paidAt']};}async[a35_0x5645db(0x1cf)](_0x1a8add){const _0x3a684f=a35_0x5645db;await database_1[_0x3a684f(0x205)]['payout']['delete']({'where':{'id':_0x1a8add}});}async[a35_0x5645db(0x1c1)](_0x1300ac){const _0x4a1d51=a35_0x5645db,{page:_0x52f806,limit:_0x5252bf,status:_0x4ac5e3,gateway:_0x34ce80,shopId:_0x9b7934,dateFrom:_0x47154b,dateTo:_0x7960fd,search:_0x5dc7f8}=_0x1300ac,_0x6036=(_0x52f806-0x1)*_0x5252bf,_0x19c51e={};_0x4ac5e3&&(_0x19c51e[_0x4a1d51(0x1f3)]=_0x4ac5e3[_0x4a1d51(0x264)]());_0x34ce80&&(_0x19c51e['gateway']=_0x34ce80[_0x4a1d51(0x1dc)]());_0x19c51e[_0x4a1d51(0x1e9)]=_0x19c51e[_0x4a1d51(0x1e9)]?_0x19c51e['gateway']:{'not':_0x4a1d51(0x28b)};if(typeof _0x19c51e[_0x4a1d51(0x1e9)]===_0x4a1d51(0x1f6)&&_0x19c51e[_0x4a1d51(0x1e9)]!==_0x4a1d51(0x28b)){}else{if(typeof _0x19c51e['gateway']===_0x4a1d51(0x1f6)&&_0x19c51e[_0x4a1d51(0x1e9)]===_0x4a1d51(0x28b)){}else _0x19c51e[_0x4a1d51(0x1e9)]={'not':_0x4a1d51(0x28b)};}_0x9b7934&&(_0x19c51e[_0x4a1d51(0x291)]=_0x9b7934);(_0x47154b||_0x7960fd)&&(_0x19c51e['createdAt']={},_0x47154b&&(_0x19c51e[_0x4a1d51(0x28e)][_0x4a1d51(0x1d9)]=new Date(_0x47154b)),_0x7960fd&&(_0x19c51e[_0x4a1d51(0x28e)]['lte']=new Date(_0x7960fd)));_0x5dc7f8&&(_0x19c51e['OR']=[{'orderId':{'contains':_0x5dc7f8,'mode':_0x4a1d51(0x221)}},{'gatewayOrderId':{'contains':_0x5dc7f8,'mode':_0x4a1d51(0x221)}},{'customerEmail':{'contains':_0x5dc7f8,'mode':_0x4a1d51(0x221)}},{'shop':{'name':{'contains':_0x5dc7f8,'mode':_0x4a1d51(0x221)}}},{'shop':{'username':{'contains':_0x5dc7f8,'mode':'insensitive'}}}]);const [_0x1e510f,_0x518403]=await Promise[_0x4a1d51(0x1e1)]([database_1[_0x4a1d51(0x205)][_0x4a1d51(0x1fc)][_0x4a1d51(0x265)]({'where':_0x19c51e,'skip':_0x6036,'take':_0x5252bf,'orderBy':{'createdAt':_0x4a1d51(0x1ea)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x4a1d51(0x205)][_0x4a1d51(0x1fc)]['count']({'where':_0x19c51e})]);return{'payments':_0x1e510f[_0x4a1d51(0x22d)](_0x2ce75a=>({'id':_0x2ce75a['id'],'shopId':_0x2ce75a[_0x4a1d51(0x291)],'gateway':_0x2ce75a[_0x4a1d51(0x1e9)],'amount':_0x2ce75a[_0x4a1d51(0x1c0)],'currency':_0x2ce75a['currency'],'status':_0x2ce75a[_0x4a1d51(0x1f3)],'orderId':_0x2ce75a[_0x4a1d51(0x270)],'gatewayOrderId':_0x2ce75a[_0x4a1d51(0x276)],'customerEmail':_0x2ce75a[_0x4a1d51(0x21c)],'customerName':_0x2ce75a[_0x4a1d51(0x29a)],'customerCountry':_0x2ce75a[_0x4a1d51(0x269)],'customerIp':_0x2ce75a[_0x4a1d51(0x24f)],'customerUa':_0x2ce75a['customerUa'],'failureMessage':_0x2ce75a['failureMessage'],'createdAt':_0x2ce75a['createdAt'],'updatedAt':_0x2ce75a['updatedAt'],'shop':_0x2ce75a[_0x4a1d51(0x1c6)]})),'pagination':{'page':_0x52f806,'limit':_0x5252bf,'total':_0x518403,'totalPages':Math['ceil'](_0x518403/_0x5252bf)}};}async[a35_0x5645db(0x206)](_0x1659b1){const _0xf7cec9=a35_0x5645db,_0x59ed33=await database_1[_0xf7cec9(0x205)][_0xf7cec9(0x1fc)][_0xf7cec9(0x1f7)]({'where':{'id':_0x1659b1},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x59ed33)return null;return{'id':_0x59ed33['id'],'shopId':_0x59ed33['shopId'],'gateway':_0x59ed33[_0xf7cec9(0x1e9)],'amount':_0x59ed33['amount'],'currency':_0x59ed33[_0xf7cec9(0x1df)],'status':_0x59ed33['status'],'orderId':_0x59ed33[_0xf7cec9(0x270)],'gatewayOrderId':_0x59ed33[_0xf7cec9(0x276)],'customerEmail':_0x59ed33[_0xf7cec9(0x21c)],'customerName':_0x59ed33[_0xf7cec9(0x29a)],'customerCountry':_0x59ed33[_0xf7cec9(0x269)],'customerIp':_0x59ed33[_0xf7cec9(0x24f)],'customerUa':_0x59ed33[_0xf7cec9(0x23b)],'failureMessage':_0x59ed33[_0xf7cec9(0x1bf)],'externalPaymentUrl':_0x59ed33['externalPaymentUrl'],'successUrl':_0x59ed33[_0xf7cec9(0x1d0)],'failUrl':_0x59ed33['failUrl'],'pendingUrl':_0x59ed33[_0xf7cec9(0x23e)],'whiteUrl':_0x59ed33[_0xf7cec9(0x1c4)],'createdAt':_0x59ed33[_0xf7cec9(0x28e)],'updatedAt':_0x59ed33[_0xf7cec9(0x1d1)],'shop':_0x59ed33['shop']};}async[a35_0x5645db(0x1f0)](_0x3e8350,_0x34a2d4,_0x32c92a,_0x1e56f9){const _0x53ec6b=a35_0x5645db,_0x5231f2=await database_1[_0x53ec6b(0x205)]['$transaction'](async _0x1c7bca=>{const _0x515cfa=_0x53ec6b,_0x13d75d=await _0x1c7bca[_0x515cfa(0x1fc)][_0x515cfa(0x1f7)]({'where':{'id':_0x3e8350},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x13d75d)throw new Error(_0x515cfa(0x25a));const _0x1fadfd=_0x13d75d[_0x515cfa(0x1f3)],_0x4d6f95=_0x34a2d4[_0x515cfa(0x264)]();console[_0x515cfa(0x22f)](_0x515cfa(0x28c)+_0x3e8350+_0x515cfa(0x209)+_0x1fadfd+_0x515cfa(0x218)+_0x4d6f95),console[_0x515cfa(0x22f)](_0x515cfa(0x23c)+_0x13d75d[_0x515cfa(0x1c6)][_0x515cfa(0x27f)]+_0x515cfa(0x279));const _0xf59c08={'status':_0x4d6f95,'updatedAt':new Date(),'statusChangedBy':'admin','statusChangedAt':new Date()};_0x32c92a&&(_0xf59c08[_0x515cfa(0x21a)]=_0x32c92a);_0x4d6f95==='CHARGEBACK'&&_0x1e56f9&&(_0xf59c08[_0x515cfa(0x203)]=_0x1e56f9);let _0x139e81=0x0,_0x2ab3eb=_0x13d75d[_0x515cfa(0x1c6)]['balance'];if(_0x4d6f95===_0x515cfa(0x223)&&_0x1fadfd!==_0x515cfa(0x223)){_0xf59c08[_0x515cfa(0x215)]=new Date();const _0x4f6b9c=await currencyService_1[_0x515cfa(0x20d)][_0x515cfa(0x268)](_0x13d75d[_0x515cfa(0x1c0)],_0x13d75d[_0x515cfa(0x1df)]);_0xf59c08['amountUSDT']=_0x4f6b9c,_0x139e81=_0x4f6b9c,_0x2ab3eb+=_0x4f6b9c,console[_0x515cfa(0x22f)](_0x515cfa(0x239)+_0x3e8350+'\x20became\x20PAID:\x20+'+_0x4f6b9c[_0x515cfa(0x233)](0x6)+_0x515cfa(0x278));}else _0x1fadfd===_0x515cfa(0x223)&&_0x4d6f95!==_0x515cfa(0x223)&&(_0x13d75d[_0x515cfa(0x22e)]&&(_0x139e81=-_0x13d75d[_0x515cfa(0x22e)],_0x2ab3eb-=_0x13d75d[_0x515cfa(0x22e)],_0xf59c08['amountUSDT']=null,console[_0x515cfa(0x22f)](_0x515cfa(0x239)+_0x3e8350+'\x20no\x20longer\x20PAID:\x20-'+_0x13d75d[_0x515cfa(0x22e)]['toFixed'](0x6)+'\x20USDT\x20from\x20balance')));if(_0x4d6f95===_0x515cfa(0x20a)){if(_0x1fadfd===_0x515cfa(0x223)&&_0x13d75d['amountUSDT']){}_0x1e56f9&&_0x1e56f9>0x0&&(_0x139e81-=_0x1e56f9,_0x2ab3eb-=_0x1e56f9,console['log'](_0x515cfa(0x1ff)+_0x1e56f9[_0x515cfa(0x233)](0x6)+_0x515cfa(0x214)));}_0x4d6f95===_0x515cfa(0x21d)&&_0x1fadfd===_0x515cfa(0x223)&&console['log'](_0x515cfa(0x244));const _0x3df621=await _0x1c7bca[_0x515cfa(0x1fc)][_0x515cfa(0x241)]({'where':{'id':_0x3e8350},'data':_0xf59c08,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x139e81!==0x0&&(await _0x1c7bca['shop'][_0x515cfa(0x241)]({'where':{'id':_0x13d75d[_0x515cfa(0x291)]},'data':{'balance':_0x2ab3eb}}),console[_0x515cfa(0x22f)](_0x515cfa(0x284)+_0x13d75d[_0x515cfa(0x291)]+_0x515cfa(0x1e3)+_0x13d75d[_0x515cfa(0x1c6)][_0x515cfa(0x27f)][_0x515cfa(0x233)](0x6)+'\x20->\x20'+_0x2ab3eb[_0x515cfa(0x233)](0x6)+'\x20USDT\x20('+(_0x139e81>0x0?'+':'')+_0x139e81[_0x515cfa(0x233)](0x6)+')')),_0x3df621;});return{'id':_0x5231f2['id'],'shopId':_0x5231f2[_0x53ec6b(0x291)],'gateway':_0x5231f2[_0x53ec6b(0x1e9)],'amount':_0x5231f2[_0x53ec6b(0x1c0)],'currency':_0x5231f2[_0x53ec6b(0x1df)],'status':_0x5231f2[_0x53ec6b(0x1f3)],'orderId':_0x5231f2[_0x53ec6b(0x270)],'gatewayOrderId':_0x5231f2[_0x53ec6b(0x276)],'customerEmail':_0x5231f2[_0x53ec6b(0x21c)],'customerName':_0x5231f2[_0x53ec6b(0x29a)],'customerCountry':_0x5231f2[_0x53ec6b(0x269)],'customerIp':_0x5231f2[_0x53ec6b(0x24f)],'customerUa':_0x5231f2[_0x53ec6b(0x23b)],'failureMessage':_0x5231f2[_0x53ec6b(0x1bf)],'adminNotes':_0x5231f2['adminNotes'],'chargebackAmount':_0x5231f2[_0x53ec6b(0x203)],'statusChangedBy':_0x5231f2[_0x53ec6b(0x1e6)],'statusChangedAt':_0x5231f2['statusChangedAt'],'createdAt':_0x5231f2[_0x53ec6b(0x28e)],'updatedAt':_0x5231f2[_0x53ec6b(0x1d1)],'shop':_0x5231f2[_0x53ec6b(0x1c6)]};}async[a35_0x5645db(0x295)](_0x3ba3b8,_0x2c2010){const _0x397049=a35_0x5645db,_0x3f6cc7={..._0x2c2010};_0x2c2010['password']&&(_0x3f6cc7['password']=await bcryptjs_1[_0x397049(0x205)]['hash'](_0x2c2010[_0x397049(0x235)],0xc));_0x2c2010[_0x397049(0x24d)]&&(_0x3f6cc7[_0x397049(0x27b)]=_0x2c2010[_0x397049(0x24d)],delete _0x3f6cc7[_0x397049(0x24d)]);_0x2c2010[_0x397049(0x1d6)]&&(_0x3f6cc7['telegram']=_0x2c2010[_0x397049(0x1d6)],delete _0x3f6cc7[_0x397049(0x1d6)]);_0x2c2010[_0x397049(0x208)]&&(_0x3f6cc7['shopUrl']=_0x2c2010[_0x397049(0x208)],delete _0x3f6cc7['merchantUrl']);_0x2c2010[_0x397049(0x20e)]&&(_0x3f6cc7[_0x397049(0x230)]=JSON[_0x397049(0x1d8)](_0x2c2010['gateways']),delete _0x3f6cc7[_0x397049(0x20e)]);_0x2c2010['gatewaySettings']&&(_0x3f6cc7[_0x397049(0x1ca)]=JSON[_0x397049(0x1d8)](_0x2c2010[_0x397049(0x1ca)]),delete _0x3f6cc7[_0x397049(0x1ca)]);_0x2c2010['wallets']&&(_0x2c2010[_0x397049(0x1db)][_0x397049(0x27d)]!==undefined&&(_0x3f6cc7['usdtPolygonWallet']=_0x2c2010[_0x397049(0x1db)][_0x397049(0x27d)]||null),_0x2c2010[_0x397049(0x1db)]['usdtTrcWallet']!==undefined&&(_0x3f6cc7[_0x397049(0x1c3)]=_0x2c2010[_0x397049(0x1db)][_0x397049(0x1c3)]||null),_0x2c2010[_0x397049(0x1db)][_0x397049(0x1f8)]!==undefined&&(_0x3f6cc7[_0x397049(0x1f8)]=_0x2c2010[_0x397049(0x1db)]['usdtErcWallet']||null),_0x2c2010[_0x397049(0x1db)][_0x397049(0x272)]!==undefined&&(_0x3f6cc7[_0x397049(0x272)]=_0x2c2010[_0x397049(0x1db)]['usdcPolygonWallet']||null),delete _0x3f6cc7[_0x397049(0x1db)]);const _0x18e2c4=await database_1['default'][_0x397049(0x1c6)][_0x397049(0x241)]({'where':{'id':_0x3ba3b8},'data':_0x3f6cc7,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x18e2c4['id'],'fullName':_0x18e2c4[_0x397049(0x27b)],'username':_0x18e2c4[_0x397049(0x240)],'telegramId':_0x18e2c4['telegram'],'merchantUrl':_0x18e2c4[_0x397049(0x243)],'gateways':_0x18e2c4['paymentGateways']?JSON[_0x397049(0x232)](_0x18e2c4[_0x397049(0x230)]):null,'gatewaySettings':_0x18e2c4[_0x397049(0x1ca)]?JSON[_0x397049(0x232)](_0x18e2c4[_0x397049(0x1ca)]):null,'publicKey':_0x18e2c4[_0x397049(0x283)],'wallets':{'usdtPolygonWallet':_0x18e2c4[_0x397049(0x27d)],'usdtTrcWallet':_0x18e2c4['usdtTrcWallet'],'usdtErcWallet':_0x18e2c4[_0x397049(0x1f8)],'usdcPolygonWallet':_0x18e2c4[_0x397049(0x272)]},'status':_0x18e2c4['status'],'createdAt':_0x18e2c4['createdAt']};}async['suspendUser'](_0x149e34){const _0x217fdb=a35_0x5645db,_0x2f03cd=await database_1[_0x217fdb(0x205)][_0x217fdb(0x1c6)][_0x217fdb(0x241)]({'where':{'id':_0x149e34},'data':{'status':_0x217fdb(0x1ee)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2f03cd['id'],'fullName':_0x2f03cd[_0x217fdb(0x27b)],'username':_0x2f03cd[_0x217fdb(0x240)],'telegramId':_0x2f03cd[_0x217fdb(0x28a)],'merchantUrl':_0x2f03cd['shopUrl'],'gateways':_0x2f03cd[_0x217fdb(0x230)]?JSON[_0x217fdb(0x232)](_0x2f03cd[_0x217fdb(0x230)]):null,'gatewaySettings':_0x2f03cd['gatewaySettings']?JSON[_0x217fdb(0x232)](_0x2f03cd[_0x217fdb(0x1ca)]):null,'publicKey':_0x2f03cd[_0x217fdb(0x283)],'wallets':{'usdtPolygonWallet':_0x2f03cd[_0x217fdb(0x27d)],'usdtTrcWallet':_0x2f03cd[_0x217fdb(0x1c3)],'usdtErcWallet':_0x2f03cd[_0x217fdb(0x1f8)],'usdcPolygonWallet':_0x2f03cd[_0x217fdb(0x272)]},'status':_0x2f03cd[_0x217fdb(0x1f3)],'createdAt':_0x2f03cd[_0x217fdb(0x28e)]};}async[a35_0x5645db(0x1d2)](_0x19d2ef){const _0x2623b5=a35_0x5645db,_0x30a35e=await database_1[_0x2623b5(0x205)][_0x2623b5(0x1c6)][_0x2623b5(0x241)]({'where':{'id':_0x19d2ef},'data':{'status':_0x2623b5(0x222)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x30a35e['id'],'fullName':_0x30a35e['name'],'username':_0x30a35e[_0x2623b5(0x240)],'telegramId':_0x30a35e['telegram'],'merchantUrl':_0x30a35e['shopUrl'],'gateways':_0x30a35e['paymentGateways']?JSON[_0x2623b5(0x232)](_0x30a35e[_0x2623b5(0x230)]):null,'gatewaySettings':_0x30a35e['gatewaySettings']?JSON[_0x2623b5(0x232)](_0x30a35e['gatewaySettings']):null,'publicKey':_0x30a35e['publicKey'],'wallets':{'usdtPolygonWallet':_0x30a35e[_0x2623b5(0x27d)],'usdtTrcWallet':_0x30a35e[_0x2623b5(0x1c3)],'usdtErcWallet':_0x30a35e[_0x2623b5(0x1f8)],'usdcPolygonWallet':_0x30a35e[_0x2623b5(0x272)]},'status':_0x30a35e[_0x2623b5(0x1f3)],'createdAt':_0x30a35e[_0x2623b5(0x28e)]};}async['getAllUsers'](_0x3ead19){const _0x372a2b=a35_0x5645db,{page:_0x585d50,limit:_0x892d5c,status:_0x31bcfb}=_0x3ead19,_0x3c1749=(_0x585d50-0x1)*_0x892d5c,_0x32a844={};_0x31bcfb&&(_0x32a844[_0x372a2b(0x1f3)]=_0x31bcfb[_0x372a2b(0x264)]());const [_0x871523,_0x1699c0]=await Promise[_0x372a2b(0x1e1)]([database_1[_0x372a2b(0x205)][_0x372a2b(0x1c6)][_0x372a2b(0x265)]({'where':_0x32a844,'skip':_0x3c1749,'take':_0x892d5c,'orderBy':{'createdAt':_0x372a2b(0x1ea)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1['default'][_0x372a2b(0x1c6)][_0x372a2b(0x1c2)]({'where':_0x32a844})]);return{'users':_0x871523[_0x372a2b(0x22d)](_0x5246d3=>({'id':_0x5246d3['id'],'fullName':_0x5246d3[_0x372a2b(0x27b)],'username':_0x5246d3[_0x372a2b(0x240)],'telegramId':_0x5246d3[_0x372a2b(0x28a)],'merchantUrl':_0x5246d3[_0x372a2b(0x243)],'gateways':_0x5246d3[_0x372a2b(0x230)]?JSON[_0x372a2b(0x232)](_0x5246d3[_0x372a2b(0x230)]):null,'gatewaySettings':_0x5246d3['gatewaySettings']?JSON[_0x372a2b(0x232)](_0x5246d3[_0x372a2b(0x1ca)]):null,'publicKey':_0x5246d3[_0x372a2b(0x283)],'wallets':{'usdtPolygonWallet':_0x5246d3['usdtPolygonWallet'],'usdtTrcWallet':_0x5246d3['usdtTrcWallet'],'usdtErcWallet':_0x5246d3['usdtErcWallet'],'usdcPolygonWallet':_0x5246d3[_0x372a2b(0x272)]},'status':_0x5246d3[_0x372a2b(0x1f3)],'createdAt':_0x5246d3['createdAt']})),'pagination':{'page':_0x585d50,'limit':_0x892d5c,'total':_0x1699c0,'totalPages':Math[_0x372a2b(0x281)](_0x1699c0/_0x892d5c)}};}async[a35_0x5645db(0x216)](_0x14353e){const _0xadba26=a35_0x5645db,_0x4f2457=await database_1[_0xadba26(0x205)]['shop'][_0xadba26(0x1f7)]({'where':{'id':_0x14353e},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x4f2457)return null;return{'id':_0x4f2457['id'],'fullName':_0x4f2457['name'],'username':_0x4f2457['username'],'telegramId':_0x4f2457[_0xadba26(0x28a)],'merchantUrl':_0x4f2457[_0xadba26(0x243)],'gateways':_0x4f2457['paymentGateways']?JSON['parse'](_0x4f2457[_0xadba26(0x230)]):null,'gatewaySettings':_0x4f2457[_0xadba26(0x1ca)]?JSON[_0xadba26(0x232)](_0x4f2457[_0xadba26(0x1ca)]):null,'publicKey':_0x4f2457['publicKey'],'wallets':{'usdtPolygonWallet':_0x4f2457[_0xadba26(0x27d)],'usdtTrcWallet':_0x4f2457[_0xadba26(0x1c3)],'usdtErcWallet':_0x4f2457[_0xadba26(0x1f8)],'usdcPolygonWallet':_0x4f2457['usdcPolygonWallet']},'status':_0x4f2457[_0xadba26(0x1f3)],'createdAt':_0x4f2457[_0xadba26(0x28e)]};}async['createUser'](_0x21e64b){const _0x44e77c=a35_0x5645db,{fullName:_0x18cf9c,username:_0x488a4c,password:_0x4e3acf,telegramId:_0x4f1086,merchantUrl:_0x125d90,gateways:_0x5d2dc1,gatewaySettings:_0x3a07a6,wallets:_0x19f1ed}=_0x21e64b,_0x7c78e1=await database_1[_0x44e77c(0x205)][_0x44e77c(0x1c6)][_0x44e77c(0x1f7)]({'where':{'username':_0x488a4c}});if(_0x7c78e1)throw new Error('Username\x20already\x20exists');if(_0x4f1086){const _0x444e2e=await database_1[_0x44e77c(0x205)]['shop'][_0x44e77c(0x1f7)]({'where':{'telegram':_0x4f1086}});if(_0x444e2e)throw new Error('Telegram\x20username\x20already\x20exists');}const _0x113ae4=await bcryptjs_1[_0x44e77c(0x205)][_0x44e77c(0x210)](_0x4e3acf,0xc),_0x39ec7d=_0x44e77c(0x27c)+crypto_1[_0x44e77c(0x205)][_0x44e77c(0x298)](0x20)[_0x44e77c(0x274)](_0x44e77c(0x282)),_0x30ebc0=_0x44e77c(0x24e)+crypto_1[_0x44e77c(0x205)][_0x44e77c(0x298)](0x20)['toString']('hex'),_0x5dfd40=await database_1[_0x44e77c(0x205)][_0x44e77c(0x1c6)][_0x44e77c(0x25f)]({'data':{'name':_0x18cf9c,'username':_0x488a4c,'password':_0x113ae4,'telegram':_0x4f1086,'shopUrl':_0x125d90,'paymentGateways':_0x5d2dc1?JSON[_0x44e77c(0x1d8)](_0x5d2dc1):null,'gatewaySettings':_0x3a07a6?JSON[_0x44e77c(0x1d8)](_0x3a07a6):null,'usdtPolygonWallet':_0x19f1ed?.[_0x44e77c(0x27d)]||null,'usdtTrcWallet':_0x19f1ed?.[_0x44e77c(0x1c3)]||null,'usdtErcWallet':_0x19f1ed?.[_0x44e77c(0x1f8)]||null,'usdcPolygonWallet':_0x19f1ed?.['usdcPolygonWallet']||null,'publicKey':_0x39ec7d,'secretKey':_0x30ebc0,'status':_0x44e77c(0x222)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x5dfd40['id'],'fullName':_0x5dfd40['name'],'username':_0x5dfd40['username'],'telegramId':_0x5dfd40[_0x44e77c(0x28a)],'merchantUrl':_0x5dfd40['shopUrl'],'gateways':_0x5dfd40['paymentGateways']?JSON[_0x44e77c(0x232)](_0x5dfd40[_0x44e77c(0x230)]):null,'gatewaySettings':_0x5dfd40[_0x44e77c(0x1ca)]?JSON['parse'](_0x5dfd40['gatewaySettings']):null,'publicKey':_0x5dfd40[_0x44e77c(0x283)],'wallets':{'usdtPolygonWallet':_0x5dfd40['usdtPolygonWallet'],'usdtTrcWallet':_0x5dfd40['usdtTrcWallet'],'usdtErcWallet':_0x5dfd40[_0x44e77c(0x1f8)],'usdcPolygonWallet':_0x5dfd40[_0x44e77c(0x272)]},'status':_0x5dfd40[_0x44e77c(0x1f3)],'createdAt':_0x5dfd40[_0x44e77c(0x28e)]};}async['deleteUser'](_0x6fd367){const _0x5c25bb=a35_0x5645db;await database_1[_0x5c25bb(0x205)][_0x5c25bb(0x1c6)][_0x5c25bb(0x24a)]({'where':{'id':_0x6fd367}});}}exports[a35_0x5645db(0x22c)]=AdminService;