'use strict';const a40_0x373502=a40_0x49bf;(function(_0x35fbc7,_0x17dd0d){const _0x46bb63=a40_0x49bf,_0x708d65=_0x35fbc7();while(!![]){try{const _0x5334b1=-parseInt(_0x46bb63(0x2e7))/0x1*(-parseInt(_0x46bb63(0x315))/0x2)+-parseInt(_0x46bb63(0x22d))/0x3+parseInt(_0x46bb63(0x299))/0x4+parseInt(_0x46bb63(0x33d))/0x5*(parseInt(_0x46bb63(0x32f))/0x6)+-parseInt(_0x46bb63(0x2ca))/0x7*(-parseInt(_0x46bb63(0x200))/0x8)+parseInt(_0x46bb63(0x2d9))/0x9*(parseInt(_0x46bb63(0x31a))/0xa)+-parseInt(_0x46bb63(0x2aa))/0xb;if(_0x5334b1===_0x17dd0d)break;else _0x708d65['push'](_0x708d65['shift']());}catch(_0x4f0da0){_0x708d65['push'](_0x708d65['shift']());}}}(a40_0x58a4,0xd33a0));var __importDefault=this&&this[a40_0x373502(0x29e)]||function(_0x1092da){const _0xb0ea9f=a40_0x373502;return _0x1092da&&_0x1092da[_0xb0ea9f(0x222)]?_0x1092da:{'default':_0x1092da};};Object[a40_0x373502(0x224)](exports,a40_0x373502(0x222),{'value':!![]}),exports[a40_0x373502(0x2af)]=void 0x0;const database_1=__importDefault(require(a40_0x373502(0x339))),bcryptjs_1=__importDefault(require(a40_0x373502(0x287))),crypto_1=__importDefault(require(a40_0x373502(0x2de))),currencyService_1=require(a40_0x373502(0x286)),gateway_1=require('../types/gateway');class AdminService{async[a40_0x373502(0x2c9)](){const _0x12443f=a40_0x373502;console[_0x12443f(0x1f5)]('📊\x20Calculating\x20payout\x20statistics...');const _0x1405c6=await database_1[_0x12443f(0x247)]['shop']['aggregate']({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x12443f(0x223)}}),_0x1d0b68=await database_1[_0x12443f(0x247)][_0x12443f(0x2dd)]['count']({'where':{'status':_0x12443f(0x30a),'gateway':{'not':_0x12443f(0x225)}}}),_0x4e3145=new Date(),_0x45a974=new Date(_0x4e3145[_0x12443f(0x2bc)](),_0x4e3145['getMonth'](),0x1),_0x55144f=new Date(_0x4e3145[_0x12443f(0x2bc)](),_0x4e3145[_0x12443f(0x1f3)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x4a459c=await database_1[_0x12443f(0x247)][_0x12443f(0x25b)][_0x12443f(0x29b)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x45a974,'lte':_0x55144f},'status':_0x12443f(0x228)}}),_0x3254db=_0x1405c6['_sum'][_0x12443f(0x292)]||0x0,_0x3ab9ce=_0x1405c6['_sum'][_0x12443f(0x2c8)]||0x0,_0x5a1d93=_0x4a459c[_0x12443f(0x309)][_0x12443f(0x285)]||0x0,_0x4584ee={'totalPayout':Math[_0x12443f(0x248)](_0x3254db*0x64)/0x64,'awaitingPayout':Math[_0x12443f(0x248)](_0x3ab9ce*0x64)/0x64,'thisMonth':Math[_0x12443f(0x248)](_0x5a1d93*0x64)/0x64,'availableBalance':Math[_0x12443f(0x248)](_0x3ab9ce*0x64)/0x64,'totalPayments':_0x1d0b68};return console[_0x12443f(0x1f5)](_0x12443f(0x20a)),console[_0x12443f(0x1f5)](_0x12443f(0x324)+_0x4584ee[_0x12443f(0x290)]+_0x12443f(0x21f)),console['log'](_0x12443f(0x213)+_0x4584ee[_0x12443f(0x2b5)]+_0x12443f(0x2e5)),console[_0x12443f(0x1f5)]('\x20\x20\x20💵\x20Available\x20balance:\x20'+_0x4584ee[_0x12443f(0x289)]+'\x20USDT\x20(same\x20as\x20awaiting)'),console[_0x12443f(0x1f5)](_0x12443f(0x2d2)+_0x4584ee[_0x12443f(0x2f2)]+_0x12443f(0x240)),console[_0x12443f(0x1f5)](_0x12443f(0x2bb)+_0x4584ee[_0x12443f(0x30f)]+_0x12443f(0x1ff)),_0x4584ee;}async['updateCustomerData'](_0x2caf64,_0x5cf456){const _0x39889d=a40_0x373502;console['log'](_0x39889d(0x28c)+_0x2caf64+':',_0x5cf456);const _0x20c0cd=await database_1['default'][_0x39889d(0x2dd)][_0x39889d(0x296)]({'where':{'id':_0x2caf64},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x20c0cd)throw new Error('Payment\x20not\x20found');const _0x13583e={};_0x5cf456[_0x39889d(0x308)]!==undefined&&(_0x13583e[_0x39889d(0x308)]=_0x5cf456[_0x39889d(0x308)]||null);_0x5cf456[_0x39889d(0x2cd)]!==undefined&&(_0x13583e[_0x39889d(0x2cd)]=_0x5cf456[_0x39889d(0x2cd)]||null);_0x5cf456[_0x39889d(0x313)]!==undefined&&(_0x13583e[_0x39889d(0x313)]=_0x5cf456[_0x39889d(0x313)]||null);const _0x3f9c88=await database_1['default']['payment'][_0x39889d(0x1fe)]({'where':{'id':_0x2caf64},'data':{..._0x13583e,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console['log'](_0x39889d(0x26b)+_0x2caf64),console[_0x39889d(0x1f5)](_0x39889d(0x202)+_0x20c0cd[_0x39889d(0x308)]+_0x39889d(0x24d)+_0x3f9c88[_0x39889d(0x308)]),console[_0x39889d(0x1f5)]('\x20\x20\x20🌐\x20IP:\x20'+_0x20c0cd['customerIp']+_0x39889d(0x24d)+_0x3f9c88[_0x39889d(0x2cd)]),console['log'](_0x39889d(0x246)+(_0x20c0cd[_0x39889d(0x313)]?_0x39889d(0x2c7):'not\x20set')+_0x39889d(0x24d)+(_0x3f9c88[_0x39889d(0x313)]?'set':'not\x20set')),_0x3f9c88;}async[a40_0x373502(0x318)](_0x18001a){const _0x42d0d8=a40_0x373502,_0x347652=new Date();let _0x37d38f;switch(_0x18001a[_0x42d0d8(0x273)]()){case _0x42d0d8(0x1f4):_0x37d38f=new Date(_0x347652[_0x42d0d8(0x2bc)](),_0x347652[_0x42d0d8(0x1f3)](),_0x347652['getDate'](),0x0,0x0,0x0,0x0);break;case'yesterday':const _0x58e751=new Date(_0x347652);_0x58e751[_0x42d0d8(0x2fe)](_0x58e751['getDate']()-0x1),_0x37d38f=new Date(_0x58e751[_0x42d0d8(0x2bc)](),_0x58e751['getMonth'](),_0x58e751[_0x42d0d8(0x242)](),0x0,0x0,0x0,0x0);break;case'7d':_0x37d38f=new Date(_0x347652[_0x42d0d8(0x1f2)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x37d38f=new Date(_0x347652[_0x42d0d8(0x1f2)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'90d':_0x37d38f=new Date(_0x347652['getTime']()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case'all':const _0x4a55ae=await database_1[_0x42d0d8(0x247)][_0x42d0d8(0x2dd)][_0x42d0d8(0x211)]({'where':{'gateway':{'not':'test_gateway'}},'orderBy':{'createdAt':_0x42d0d8(0x2d4)},'select':{'createdAt':!![]}});_0x37d38f=_0x4a55ae?_0x4a55ae[_0x42d0d8(0x2a5)]:new Date(_0x42d0d8(0x30c));break;default:_0x37d38f=new Date(_0x347652[_0x42d0d8(0x1f2)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}_0x37d38f['setHours'](0x0,0x0,0x0,0x0);let _0x3e11e0;if(_0x18001a[_0x42d0d8(0x273)]()===_0x42d0d8(0x27f)){const _0x3ce982=new Date(_0x347652);_0x3ce982[_0x42d0d8(0x2fe)](_0x3ce982[_0x42d0d8(0x242)]()-0x1),_0x3e11e0=new Date(_0x3ce982['getFullYear'](),_0x3ce982[_0x42d0d8(0x1f3)](),_0x3ce982[_0x42d0d8(0x242)](),0x17,0x3b,0x3b,0x3e7);}const _0x36179e={'gte':_0x37d38f};_0x3e11e0&&(_0x36179e[_0x42d0d8(0x2ac)]=_0x3e11e0);const [_0x934ca,_0x1a409b,_0x3c51b9,_0x374a3f,_0x1806bf,_0x26669a]=await Promise[_0x42d0d8(0x322)]([database_1[_0x42d0d8(0x247)][_0x42d0d8(0x239)][_0x42d0d8(0x2ae)](),database_1['default'][_0x42d0d8(0x239)][_0x42d0d8(0x2ae)]({'where':{'status':_0x42d0d8(0x223)}}),database_1[_0x42d0d8(0x247)][_0x42d0d8(0x2dd)][_0x42d0d8(0x2ae)]({'where':{'status':_0x42d0d8(0x30a),'createdAt':_0x36179e,'gateway':{'not':_0x42d0d8(0x225)}}}),database_1[_0x42d0d8(0x247)]['payment']['findMany']({'where':{'status':_0x42d0d8(0x30a),'createdAt':_0x36179e,'gateway':{'not':_0x42d0d8(0x225)}},'select':{'amount':!![],'currency':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x42d0d8(0x247)][_0x42d0d8(0x2dd)][_0x42d0d8(0x330)]({'where':{'gateway':{'not':_0x42d0d8(0x225)}},'take':0xa,'orderBy':{'createdAt':_0x42d0d8(0x306)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x42d0d8(0x247)][_0x42d0d8(0x2dd)][_0x42d0d8(0x330)]({'where':{'createdAt':_0x36179e,'gateway':{'not':_0x42d0d8(0x225)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x4f61ae=0x0,_0x1efce8=0x0;for(const _0x42740d of _0x374a3f){const _0x1b518f=await currencyService_1[_0x42d0d8(0x23e)]['convertToUSDT'](_0x42740d[_0x42d0d8(0x285)],_0x42740d[_0x42d0d8(0x341)]);_0x4f61ae+=_0x1b518f;if(_0x42740d['amountAfterGatewayCommissionUSDT']){const _0x56f1ba=await currencyService_1[_0x42d0d8(0x23e)]['convertToUSDT'](_0x42740d[_0x42d0d8(0x285)],_0x42740d[_0x42d0d8(0x341)]),_0x199109=_0x42740d[_0x42d0d8(0x2ea)],_0xe8e4a3=_0x56f1ba-_0x199109;_0x1efce8+=_0xe8e4a3;}}const _0x400923=_0x3c51b9>0x0?_0x4f61ae/_0x3c51b9:0x0,_0x429993=this[_0x42d0d8(0x2c4)](_0x26669a,_0x37d38f,_0x3e11e0||_0x347652),_0x1d6ec0=await database_1[_0x42d0d8(0x247)][_0x42d0d8(0x2dd)][_0x42d0d8(0x2ae)]({'where':{'createdAt':_0x36179e,'gateway':{'not':'test_gateway'}}}),_0x458ba3=_0x1d6ec0>0x0?_0x3c51b9/_0x1d6ec0*0x64:0x0;return{'totalShops':_0x934ca,'activeShops':_0x1a409b,'totalPayments':_0x3c51b9,'successfulPayments':_0x3c51b9,'totalAttempts':_0x1d6ec0,'totalRevenue':Math[_0x42d0d8(0x248)](_0x4f61ae*0x64)/0x64,'trapayEarnings':Math[_0x42d0d8(0x248)](_0x1efce8*0x64)/0x64,'averagePaymentAmount':Math[_0x42d0d8(0x248)](_0x400923*0x64)/0x64,'conversionRate':Math['round'](_0x458ba3*0x64)/0x64,'dailyRevenue':_0x429993[_0x42d0d8(0x2e9)],'dailyPayments':_0x429993['dailyPayments'],'recentPayments':_0x1806bf[_0x42d0d8(0x2ad)](_0xf0df06=>({'id':_0xf0df06['id'],'amount':_0xf0df06[_0x42d0d8(0x285)],'currency':_0xf0df06[_0x42d0d8(0x341)],'status':_0xf0df06['status'],'gateway':_0xf0df06[_0x42d0d8(0x32e)],'shop':_0xf0df06[_0x42d0d8(0x239)],'createdAt':_0xf0df06['createdAt']}))};}async[a40_0x373502(0x266)](_0x4cbc25){const _0x5b2994=a40_0x373502;console[_0x5b2994(0x1f5)](_0x5b2994(0x244),_0x4cbc25);let _0x68908f,_0x2c6457=new Date();if(_0x4cbc25[_0x5b2994(0x253)]==='custom'&&_0x4cbc25[_0x5b2994(0x294)]&&_0x4cbc25[_0x5b2994(0x2d3)])_0x68908f=new Date(_0x4cbc25['dateFrom']),_0x2c6457=new Date(_0x4cbc25[_0x5b2994(0x2d3)]),_0x68908f[_0x5b2994(0x23d)](0x0,0x0,0x0,0x0),_0x2c6457[_0x5b2994(0x23d)](0x17,0x3b,0x3b,0x3e7);else{const _0x2743a2=new Date();switch(_0x4cbc25[_0x5b2994(0x253)]){case _0x5b2994(0x2fc):_0x68908f=new Date(_0x2743a2[_0x5b2994(0x1f2)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x5b2994(0x212):_0x68908f=new Date(_0x2743a2['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x5b2994(0x1fa):_0x68908f=new Date(_0x2743a2[_0x5b2994(0x1f2)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case'all':default:_0x68908f=new Date(_0x5b2994(0x30c));break;}_0x68908f[_0x5b2994(0x23d)](0x0,0x0,0x0,0x0),_0x2c6457['setHours'](0x17,0x3b,0x3b,0x3e7);}console[_0x5b2994(0x1f5)](_0x5b2994(0x236)+_0x68908f[_0x5b2994(0x209)]()+_0x5b2994(0x29a)+_0x2c6457[_0x5b2994(0x209)]());const _0x142af8={'status':_0x5b2994(0x30a),'gateway':{'not':_0x5b2994(0x225)},'paidAt':{'gte':_0x68908f,'lte':_0x2c6457}};_0x4cbc25['shopId']&&(_0x142af8[_0x5b2994(0x279)]=_0x4cbc25[_0x5b2994(0x279)]);const _0x444621=await database_1[_0x5b2994(0x247)][_0x5b2994(0x2dd)][_0x5b2994(0x330)]({'where':_0x142af8,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x5b2994(0x1f5)]('💰\x20Found\x20'+_0x444621['length']+_0x5b2994(0x27e));const _0x552ea1={'gateway':{'not':'test_gateway'},'createdAt':{'gte':_0x68908f,'lte':_0x2c6457}};_0x4cbc25[_0x5b2994(0x279)]&&(_0x552ea1['shopId']=_0x4cbc25[_0x5b2994(0x279)]);const _0x1cbada=await database_1[_0x5b2994(0x247)][_0x5b2994(0x2dd)][_0x5b2994(0x2ae)]({'where':_0x552ea1});console[_0x5b2994(0x1f5)](_0x5b2994(0x2f8)+_0x1cbada+_0x5b2994(0x2f9)+_0x444621[_0x5b2994(0x2a1)]);let _0x16e1f7=0x0,_0x21a8ba=0x0,_0x48e3da=0x0;const _0x313534={},_0x2e11da={},_0x5b368b={};for(const _0x162f52 of _0x444621){try{const _0x2caaad=_0x162f52['amountUSDT']||0x0;if(_0x2caaad<=0x0){console['warn'](_0x5b2994(0x250)+_0x162f52['id']+_0x5b2994(0x332));continue;}let _0x5a96fb,_0x20ea96;if(_0x162f52['amountAfterGatewayCommissionUSDT']!==null&&_0x162f52[_0x5b2994(0x2ea)]!==undefined)_0x5a96fb=_0x162f52[_0x5b2994(0x2ea)],_0x20ea96=_0x2caaad-_0x5a96fb,console[_0x5b2994(0x1f5)](_0x5b2994(0x1f7)+_0x162f52['id']+':\x20'+_0x2caaad['toFixed'](0x6)+'\x20USDT,\x20merchant:\x20'+_0x5a96fb['toFixed'](0x6)+_0x5b2994(0x240));else{let _0x415376={};if(_0x162f52[_0x5b2994(0x239)]['gatewaySettings'])try{_0x415376=JSON[_0x5b2994(0x23c)](_0x162f52['shop'][_0x5b2994(0x31f)]);}catch(_0x440b39){console[_0x5b2994(0x1fd)](_0x5b2994(0x205)+_0x162f52[_0x5b2994(0x279)]+':',_0x440b39);}let _0x4e2361=0x2d;for(const [_0x594ea5,_0x4667fb]of Object[_0x5b2994(0x261)](_0x415376)){if(_0x594ea5[_0x5b2994(0x273)]()===_0x162f52[_0x5b2994(0x32e)][_0x5b2994(0x273)]()){_0x4e2361=_0x4667fb[_0x5b2994(0x329)]||0x2d;break;}}_0x20ea96=_0x2caaad*(_0x4e2361/0x64),_0x5a96fb=_0x2caaad-_0x20ea96,console[_0x5b2994(0x1f5)](_0x5b2994(0x29c)+_0x162f52['id']+':\x20'+_0x4e2361+'%\x20from\x20'+_0x2caaad['toFixed'](0x6)+_0x5b2994(0x240));}_0x16e1f7+=_0x2caaad,_0x21a8ba+=_0x5a96fb,_0x48e3da+=_0x20ea96;let _0x257aa3;_0x162f52[_0x5b2994(0x2b0)]!==null&&_0x162f52[_0x5b2994(0x2b0)]!==undefined?(_0x257aa3=_0x162f52[_0x5b2994(0x2b0)],console[_0x5b2994(0x1f5)](_0x5b2994(0x30d)+_0x162f52['id']+':\x20'+_0x257aa3+'%')):(_0x257aa3=_0x2caaad>0x0?_0x20ea96/_0x2caaad*0x64:0x0,console[_0x5b2994(0x1f5)](_0x5b2994(0x2d7)+_0x162f52['id']+':\x20'+_0x257aa3[_0x5b2994(0x2eb)](0x2)+'%'));!_0x313534[_0x162f52[_0x5b2994(0x32e)]]&&(_0x313534[_0x162f52[_0x5b2994(0x32e)]]={'gateway':_0x162f52[_0x5b2994(0x32e)],'gatewayDisplayName':this[_0x5b2994(0x255)](_0x162f52[_0x5b2994(0x32e)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x313534[_0x162f52[_0x5b2994(0x32e)]][_0x5b2994(0x24a)]++,_0x313534[_0x162f52[_0x5b2994(0x32e)]][_0x5b2994(0x29f)]+=_0x2caaad,_0x313534[_0x162f52[_0x5b2994(0x32e)]][_0x5b2994(0x24f)]+=_0x20ea96,_0x313534[_0x162f52['gateway']][_0x5b2994(0x221)]+=_0x5a96fb,_0x313534[_0x162f52[_0x5b2994(0x32e)]][_0x5b2994(0x28b)]+=_0x257aa3;!_0x4cbc25[_0x5b2994(0x279)]&&(!_0x2e11da[_0x162f52[_0x5b2994(0x279)]]&&(_0x2e11da[_0x162f52[_0x5b2994(0x279)]]={'shopId':_0x162f52['shopId'],'shopName':_0x162f52[_0x5b2994(0x239)][_0x5b2994(0x2c5)],'shopUsername':_0x162f52[_0x5b2994(0x239)][_0x5b2994(0x230)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x2e11da[_0x162f52['shopId']]['paymentsCount']++,_0x2e11da[_0x162f52['shopId']][_0x5b2994(0x29f)]+=_0x2caaad,_0x2e11da[_0x162f52['shopId']][_0x5b2994(0x24f)]+=_0x20ea96,_0x2e11da[_0x162f52[_0x5b2994(0x279)]]['merchantEarningsUSDT']+=_0x5a96fb);const _0x57b106=_0x162f52[_0x5b2994(0x27d)][_0x5b2994(0x209)]()['split']('T')[0x0];!_0x5b368b[_0x57b106]&&(_0x5b368b[_0x57b106]={'date':_0x57b106,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x5b368b[_0x57b106][_0x5b2994(0x27b)]+=_0x2caaad,_0x5b368b[_0x57b106][_0x5b2994(0x2c3)]+=_0x5a96fb,_0x5b368b[_0x57b106][_0x5b2994(0x2b3)]+=_0x20ea96,_0x5b368b[_0x57b106][_0x5b2994(0x24a)]++;}catch(_0x19b00d){console[_0x5b2994(0x1fd)]('Error\x20processing\x20payment\x20'+_0x162f52['id']+':',_0x19b00d);}}Object[_0x5b2994(0x1ee)](_0x313534)[_0x5b2994(0x32b)](_0x2e5476=>{const _0x2cfb66=_0x5b2994;_0x2e5476['averageCommissionRate']=_0x2e5476[_0x2cfb66(0x24a)]>0x0?_0x2e5476[_0x2cfb66(0x28b)]/_0x2e5476[_0x2cfb66(0x24a)]:0x0,delete _0x2e5476[_0x2cfb66(0x28b)];}),Object[_0x5b2994(0x1ee)](_0x2e11da)[_0x5b2994(0x32b)](_0xcc6753=>{const _0x19495c=_0x5b2994;_0xcc6753[_0x19495c(0x2e1)]=_0xcc6753[_0x19495c(0x24a)]>0x0?_0xcc6753[_0x19495c(0x29f)]/_0xcc6753[_0x19495c(0x24a)]:0x0;});let _0x387935=0x0,_0xd9354=0x0;if(_0x4cbc25['shopId']){const _0x5c4af7=await database_1[_0x5b2994(0x247)][_0x5b2994(0x25b)][_0x5b2994(0x330)]({'where':{'shopId':_0x4cbc25[_0x5b2994(0x279)],'status':_0x5b2994(0x228),'createdAt':{'gte':_0x68908f,'lte':_0x2c6457}},'select':{'amount':!![]}});_0x387935=_0x5c4af7[_0x5b2994(0x1fb)]((_0x53f987,_0x381038)=>_0x53f987+_0x381038[_0x5b2994(0x285)],0x0);const _0x2d6882=await database_1['default'][_0x5b2994(0x25b)][_0x5b2994(0x330)]({'where':{'shopId':_0x4cbc25[_0x5b2994(0x279)],'status':_0x5b2994(0x270),'createdAt':{'gte':_0x68908f,'lte':_0x2c6457}},'select':{'amount':!![]}});_0xd9354=_0x2d6882['reduce']((_0x1c2377,_0x531e33)=>_0x1c2377+_0x531e33[_0x5b2994(0x285)],0x0);}const _0x568aae=_0x1cbada,_0x26f10f=_0x444621['length'],_0x91a951=_0x26f10f>0x0?_0x16e1f7/_0x26f10f:0x0,_0x807d27=_0x568aae>0x0?Math['round'](_0x26f10f/_0x568aae*0x2710)/0x64:0x0,_0x1130a0=Math[_0x5b2994(0x2a7)]((_0x2c6457[_0x5b2994(0x1f2)]()-_0x68908f['getTime']())/(0x3e8*0x3c*0x3c*0x18)),_0x5bb21f={'totalTurnover':Math[_0x5b2994(0x248)](_0x16e1f7*0x64)/0x64,'merchantEarnings':Math['round'](_0x21a8ba*0x64)/0x64,'gatewayEarnings':Math['round'](_0x48e3da*0x64)/0x64,'totalPaidOut':Math[_0x5b2994(0x248)](_0x387935*0x64)/0x64,'pendingPayout':Math['round'](_0xd9354*0x64)/0x64,'averageCheck':Math[_0x5b2994(0x248)](_0x91a951*0x64)/0x64,'totalPayments':_0x568aae,'successfulPayments':_0x26f10f,'conversionRate':_0x807d27,'gatewayBreakdown':Object[_0x5b2994(0x1ee)](_0x313534)[_0x5b2994(0x2ad)](_0x34a86=>({..._0x34a86,'turnoverUSDT':Math[_0x5b2994(0x248)](_0x34a86['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math['round'](_0x34a86[_0x5b2994(0x24f)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x5b2994(0x248)](_0x34a86['merchantEarningsUSDT']*0x64)/0x64,'averageCommissionRate':Math[_0x5b2994(0x248)](_0x34a86[_0x5b2994(0x215)]*0x64)/0x64})),'merchantBreakdown':_0x4cbc25['shopId']?undefined:Object[_0x5b2994(0x1ee)](_0x2e11da)['map'](_0x46ee1b=>({..._0x46ee1b,'turnoverUSDT':Math['round'](_0x46ee1b['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x5b2994(0x248)](_0x46ee1b[_0x5b2994(0x24f)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x5b2994(0x248)](_0x46ee1b[_0x5b2994(0x221)]*0x64)/0x64,'paidOutUSDT':Math[_0x5b2994(0x248)](_0x46ee1b[_0x5b2994(0x2a2)]*0x64)/0x64,'averageCheckUSDT':Math[_0x5b2994(0x248)](_0x46ee1b[_0x5b2994(0x2e1)]*0x64)/0x64})),'dailyData':Object[_0x5b2994(0x1ee)](_0x5b368b)[_0x5b2994(0x2ad)](_0x38b455=>({..._0x38b455,'turnover':Math[_0x5b2994(0x248)](_0x38b455['turnover']*0x64)/0x64,'merchantEarnings':Math[_0x5b2994(0x248)](_0x38b455[_0x5b2994(0x2c3)]*0x64)/0x64,'gatewayEarnings':Math[_0x5b2994(0x248)](_0x38b455[_0x5b2994(0x2b3)]*0x64)/0x64}))['sort']((_0x2d23c3,_0x38011d)=>_0x2d23c3[_0x5b2994(0x2c2)]['localeCompare'](_0x38011d[_0x5b2994(0x2c2)])),'periodInfo':{'from':_0x68908f,'to':_0x2c6457,'periodType':_0x4cbc25[_0x5b2994(0x253)]||_0x5b2994(0x258),'daysCount':_0x1130a0}};return console[_0x5b2994(0x1f5)](_0x5b2994(0x2df)),console['log'](_0x5b2994(0x312)+_0x5bb21f[_0x5b2994(0x2dc)]+_0x5b2994(0x240)),console['log'](_0x5b2994(0x23f)+_0x5bb21f['merchantEarnings']+'\x20USDT'),console[_0x5b2994(0x1f5)](_0x5b2994(0x25e)+_0x5bb21f[_0x5b2994(0x2b3)]+'\x20USDT'),console[_0x5b2994(0x1f5)]('\x20\x20\x20�\x20Total\x20paid\x20out:\x20'+_0x5bb21f['totalPaidOut']+_0x5b2994(0x240)),console[_0x5b2994(0x1f5)](_0x5b2994(0x238)+_0x5bb21f['pendingPayout']+_0x5b2994(0x240)),console[_0x5b2994(0x1f5)](_0x5b2994(0x303)+_0x5bb21f[_0x5b2994(0x30f)]),_0x5bb21f;}async[a40_0x373502(0x320)](){const _0x2a127a=a40_0x373502;console['log'](_0x2a127a(0x252));const _0x189db8=await database_1['default'][_0x2a127a(0x239)][_0x2a127a(0x330)]({'where':{'status':_0x2a127a(0x223)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x2a127a(0x2d4)}});return console['log'](_0x2a127a(0x291)+_0x189db8[_0x2a127a(0x2a1)]+_0x2a127a(0x2a0)),_0x189db8[_0x2a127a(0x2ad)](_0x38a6b1=>({'id':_0x38a6b1['id'],'username':_0x38a6b1[_0x2a127a(0x230)],'name':_0x38a6b1['name']}));}[a40_0x373502(0x255)](_0x234f6a){const _0x4e1ac2=a40_0x373502,_0x4ccb79={'test_gateway':_0x4e1ac2(0x235),'plisio':_0x4e1ac2(0x2c0),'rapyd':_0x4e1ac2(0x284),'noda':_0x4e1ac2(0x2ba),'cointopay':_0x4e1ac2(0x319),'cointopay2':_0x4e1ac2(0x2a3),'klyme_eu':_0x4e1ac2(0x31e),'klyme_gb':_0x4e1ac2(0x22c),'klyme_de':_0x4e1ac2(0x24b),'mastercard':_0x4e1ac2(0x28e)};return _0x4ccb79[_0x234f6a]||_0x234f6a;}[a40_0x373502(0x269)](_0x43c59a){const _0x4182e5=a40_0x373502,_0x316dec={'Test\x20Gateway':'test_gateway','Plisio':_0x4182e5(0x1fc),'Rapyd':'rapyd','Noda':_0x4182e5(0x28d),'CoinToPay':_0x4182e5(0x295),'CoinToPay2':_0x4182e5(0x218),'KLYME\x20EU':_0x4182e5(0x328),'KLYME\x20GB':'klyme_gb','KLYME\x20DE':_0x4182e5(0x254),'MasterCard':'mastercard'};return _0x316dec[_0x43c59a]||_0x43c59a[_0x4182e5(0x273)]();}async[a40_0x373502(0x26a)](_0x2523f0){const _0x2efa6e=a40_0x373502,{page:_0xb8e81,limit:_0x48e970,minAmount:_0x3883bd,search:_0x361946}=_0x2523f0,_0x2e2f16=(_0xb8e81-0x1)*_0x48e970;console[_0x2efa6e(0x1f5)](_0x2efa6e(0x251),_0x2523f0);const _0x1a39ca={'balance':{'gt':0x0},'status':_0x2efa6e(0x223)};_0x3883bd&&(_0x1a39ca[_0x2efa6e(0x2c8)][_0x2efa6e(0x2b6)]=_0x3883bd);_0x361946&&(_0x1a39ca[_0x2efa6e(0x2c5)]={'contains':_0x361946,'mode':'insensitive'});const [_0x2affb4,_0x501808]=await Promise[_0x2efa6e(0x322)]([database_1['default']['shop'][_0x2efa6e(0x330)]({'where':_0x1a39ca,'skip':_0x2e2f16,'take':_0x48e970,'orderBy':{'balance':_0x2efa6e(0x306)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1[_0x2efa6e(0x247)][_0x2efa6e(0x239)][_0x2efa6e(0x2ae)]({'where':_0x1a39ca})]);console['log']('💰\x20Found\x20'+_0x2affb4[_0x2efa6e(0x2a1)]+_0x2efa6e(0x217));const _0x1b0a11=await Promise[_0x2efa6e(0x322)](_0x2affb4['map'](async _0x52e010=>{const _0x1b1bde=_0x2efa6e,[_0x2cdf98,_0x13ae8a,_0xdf97ff]=await Promise[_0x1b1bde(0x322)]([database_1[_0x1b1bde(0x247)][_0x1b1bde(0x2dd)][_0x1b1bde(0x2ae)]({'where':{'shopId':_0x52e010['id'],'status':_0x1b1bde(0x30a),'gateway':{'not':_0x1b1bde(0x225)}}}),database_1[_0x1b1bde(0x247)][_0x1b1bde(0x2dd)][_0x1b1bde(0x211)]({'where':{'shopId':_0x52e010['id'],'status':_0x1b1bde(0x30a),'gateway':{'not':_0x1b1bde(0x225)}},'orderBy':{'paidAt':'asc'},'select':{'paidAt':!![]}}),database_1[_0x1b1bde(0x247)][_0x1b1bde(0x2dd)][_0x1b1bde(0x263)]({'by':[_0x1b1bde(0x32e)],'where':{'shopId':_0x52e010['id'],'status':_0x1b1bde(0x30a),'gateway':{'not':_0x1b1bde(0x225)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x1fd105=new Date(),_0x4c1cb2=new Date(_0x1fd105['getFullYear'](),_0x1fd105[_0x1b1bde(0x1f3)](),0x1),_0x1b2107=new Date(_0x1fd105['getFullYear'](),_0x1fd105[_0x1b1bde(0x1f3)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x3b5616,_0x113266]=await Promise['all']([database_1[_0x1b1bde(0x247)][_0x1b1bde(0x25b)][_0x1b1bde(0x29b)]({'_sum':{'amount':!![]},'where':{'shopId':_0x52e010['id'],'status':_0x1b1bde(0x228)}}),database_1[_0x1b1bde(0x247)][_0x1b1bde(0x25b)][_0x1b1bde(0x29b)]({'_sum':{'amount':!![]},'where':{'shopId':_0x52e010['id'],'status':_0x1b1bde(0x228),'createdAt':{'gte':_0x4c1cb2,'lte':_0x1b2107}}})]),_0x3c5b92=_0x3b5616[_0x1b1bde(0x309)][_0x1b1bde(0x285)]||0x0,_0x4ef124=_0x113266['_sum'][_0x1b1bde(0x285)]||0x0,_0x5dac56=await Promise[_0x1b1bde(0x322)](_0xdf97ff[_0x1b1bde(0x2ad)](async _0x3a069a=>{const _0x229d40=_0x1b1bde;let _0x401294=0x2d;if(_0x52e010['gatewaySettings'])try{const _0x152978=JSON['parse'](_0x52e010[_0x229d40(0x31f)]);for(const [_0x225d90,_0x58c106]of Object[_0x229d40(0x261)](_0x152978)){if(_0x225d90[_0x229d40(0x273)]()===_0x3a069a[_0x229d40(0x32e)][_0x229d40(0x273)]()){_0x401294=_0x58c106['commission']||0xa,console['log'](_0x229d40(0x20c)+_0x3a069a['gateway']+_0x229d40(0x2be)+_0x52e010['id']+_0x229d40(0x2f3)+_0x401294+'%');break;}}}catch(_0x1204da){console[_0x229d40(0x1fd)](_0x229d40(0x205)+_0x52e010['id']+':',_0x1204da);}const _0x42f789=_0x3a069a[_0x229d40(0x309)]?.['amountUSDT']||0x0,_0x33da55=_0x42f789*(0x1-_0x401294/0x64);return{'gateway':_0x3a069a[_0x229d40(0x32e)],'count':_0x3a069a[_0x229d40(0x201)]?.['id']||0x0,'amountUSDT':Math[_0x229d40(0x248)](_0x42f789*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x229d40(0x248)](_0x33da55*0x64)/0x64,'commission':_0x401294};})),_0x60d7dc=_0x5dac56[_0x1b1bde(0x1fb)]((_0x84f7a5,_0x4784c8)=>_0x84f7a5+_0x4784c8['amountUSDT'],0x0),_0x311bf8=_0x5dac56[_0x1b1bde(0x1fb)]((_0x4a8cb5,_0x29348c)=>_0x4a8cb5+_0x29348c[_0x1b1bde(0x281)],0x0),_0x228aed=_0x52e010['balance'];return console[_0x1b1bde(0x1f5)](_0x1b1bde(0x2ef)+_0x52e010[_0x1b1bde(0x230)]+':'),console['log'](_0x1b1bde(0x272)+_0x60d7dc[_0x1b1bde(0x2eb)](0x2)+_0x1b1bde(0x298)),console['log']('\x20\x20\x20🔍\x20Calculated\x20after\x20commission:\x20'+_0x311bf8[_0x1b1bde(0x2eb)](0x2)+'\x20USDT\x20(theoretical\x20net)'),console[_0x1b1bde(0x1f5)](_0x1b1bde(0x20b)+_0x228aed['toFixed'](0x2)+_0x1b1bde(0x2db)),console['log'](_0x1b1bde(0x33e)+_0x3c5b92[_0x1b1bde(0x2eb)](0x2)+_0x1b1bde(0x2ce)),console['log'](_0x1b1bde(0x33f)+(_0x311bf8-_0x3c5b92-_0x228aed)[_0x1b1bde(0x2eb)](0x2)+_0x1b1bde(0x231)),{'id':_0x52e010['id'],'fullName':_0x52e010[_0x1b1bde(0x2c5)],'username':_0x52e010[_0x1b1bde(0x230)],'telegramId':_0x52e010[_0x1b1bde(0x25f)],'merchantUrl':_0x52e010[_0x1b1bde(0x22e)],'wallets':{'usdtPolygonWallet':_0x52e010['usdtPolygonWallet'],'usdtTrcWallet':_0x52e010[_0x1b1bde(0x2e3)],'usdtErcWallet':_0x52e010[_0x1b1bde(0x2e6)],'usdcPolygonWallet':_0x52e010[_0x1b1bde(0x262)],'usdcErcWallet':_0x52e010[_0x1b1bde(0x219)]},'totalAmountUSDT':Math['round'](_0x60d7dc*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x1b1bde(0x248)](_0x311bf8*0x64)/0x64,'currentBalance':Math[_0x1b1bde(0x248)](_0x228aed*0x64)/0x64,'totalPayout':Math[_0x1b1bde(0x248)](_0x3c5b92*0x64)/0x64,'thisMonth':Math[_0x1b1bde(0x248)](_0x4ef124*0x64)/0x64,'paymentsCount':_0x2cdf98,'oldestPaymentDate':_0x13ae8a?.[_0x1b1bde(0x27d)]||_0x52e010[_0x1b1bde(0x2a5)],'gatewayBreakdown':_0x5dac56};})),_0x32ea7b=_0x1b0a11['reduce']((_0x5b24d3,_0x11a0f6)=>_0x5b24d3+_0x11a0f6[_0x2efa6e(0x336)],0x0),_0x271a86=_0x1b0a11['reduce']((_0x156a46,_0xb81313)=>_0x156a46+_0xb81313[_0x2efa6e(0x305)],0x0),_0x543505=_0x1b0a11['reduce']((_0x13998c,_0x1700ec)=>_0x13998c+_0x1700ec[_0x2efa6e(0x290)],0x0),_0x328682=_0x1b0a11['reduce']((_0x19a1d3,_0x178b97)=>_0x19a1d3+_0x178b97[_0x2efa6e(0x2f2)],0x0);return console[_0x2efa6e(0x1f5)](_0x2efa6e(0x282)+_0x501808+'\x20merchants'),console[_0x2efa6e(0x1f5)](_0x2efa6e(0x21d)+Math[_0x2efa6e(0x248)](_0x32ea7b*0x64)/0x64+'\x20USDT\x20(gross\x20revenue)'),console[_0x2efa6e(0x1f5)](_0x2efa6e(0x206)+Math[_0x2efa6e(0x248)](_0x271a86*0x64)/0x64+_0x2efa6e(0x27c)),console[_0x2efa6e(0x1f5)]('\x20\x20\x20💸\x20Total\x20payouts\x20(all\x20time):\x20'+Math[_0x2efa6e(0x248)](_0x543505*0x64)/0x64+'\x20USDT'),console['log'](_0x2efa6e(0x245)+Math[_0x2efa6e(0x248)](_0x328682*0x64)/0x64+'\x20USDT'),{'merchants':_0x1b0a11,'pagination':{'page':_0xb8e81,'limit':_0x48e970,'total':_0x501808,'totalPages':Math['ceil'](_0x501808/_0x48e970)},'summary':{'totalMerchants':_0x501808,'totalAmountUSDT':Math[_0x2efa6e(0x248)](_0x32ea7b*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x2efa6e(0x248)](_0x271a86*0x64)/0x64,'totalPayout':Math[_0x2efa6e(0x248)](_0x543505*0x64)/0x64,'thisMonth':Math[_0x2efa6e(0x248)](_0x328682*0x64)/0x64}};}async[a40_0x373502(0x21a)](_0x54d913){const _0xc9a104=a40_0x373502,{shopId:_0x5964ec,amount:_0xda00e9,network:_0x507e9a,wallet:_0xb15d41,notes:_0xd24e6e,txid:_0x34a1ad,periodFrom:_0x150358,periodTo:_0x581daa}=_0x54d913,_0x3dea98=await database_1[_0xc9a104(0x247)][_0xc9a104(0x32a)](async _0x22df1c=>{const _0x3156ac=_0xc9a104,_0x24b523=await _0x22df1c['shop']['findUnique']({'where':{'id':_0x5964ec},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x24b523)throw new Error('Shop\x20not\x20found');console['log'](_0x3156ac(0x2cb)+_0x24b523[_0x3156ac(0x230)]+':'),console[_0x3156ac(0x1f5)]('\x20\x20\x20Current\x20balance:\x20'+_0x24b523[_0x3156ac(0x2c8)][_0x3156ac(0x2eb)](0x6)+_0x3156ac(0x240)),console['log']('\x20\x20\x20Payout\x20amount:\x20'+_0xda00e9[_0x3156ac(0x2eb)](0x6)+'\x20USDT'),console[_0x3156ac(0x1f5)]('\x20\x20\x20Current\x20total\x20paid\x20out:\x20'+_0x24b523[_0x3156ac(0x292)]['toFixed'](0x6)+_0x3156ac(0x240));if(_0x34a1ad)console[_0x3156ac(0x1f5)](_0x3156ac(0x344)+_0x34a1ad);const _0x54e23d=0.000001,_0x6d4368=Number(_0x24b523['balance']),_0x4e1ca0=Number(_0xda00e9);console[_0x3156ac(0x1f5)](_0x3156ac(0x25d)),console['log'](_0x3156ac(0x301)+_0x24b523[_0x3156ac(0x2c8)]),console[_0x3156ac(0x1f5)](_0x3156ac(0x2f0)+_0x6d4368),console[_0x3156ac(0x1f5)](_0x3156ac(0x2f4)+_0x4e1ca0),console['log']('\x20\x20\x20Difference:\x20'+(_0x6d4368-_0x4e1ca0)),console['log'](_0x3156ac(0x208)+_0x54e23d);if(_0x6d4368<_0x4e1ca0-_0x54e23d)throw new Error(_0x3156ac(0x293)+_0x6d4368[_0x3156ac(0x2eb)](0x6)+_0x3156ac(0x21e)+_0x4e1ca0['toFixed'](0x6)+_0x3156ac(0x2bd)+(_0x6d4368-_0x4e1ca0)[_0x3156ac(0x2eb)](0x8)+_0x3156ac(0x240));console[_0x3156ac(0x1f5)](_0x3156ac(0x25c));const _0x4f2257=Math['min'](_0x6d4368,_0x4e1ca0);let _0x26824d=_0xb15d41;if(!_0x26824d){const _0x582ec9=await _0x22df1c[_0x3156ac(0x239)][_0x3156ac(0x296)]({'where':{'id':_0x5964ec},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});if(_0x582ec9)switch(_0x507e9a){case _0x3156ac(0x2c6):_0x26824d=_0x582ec9['usdtPolygonWallet']||undefined;break;case _0x3156ac(0x31d):_0x26824d=_0x582ec9[_0x3156ac(0x2e3)]||undefined;break;case'erc20':_0x26824d=_0x582ec9[_0x3156ac(0x2e6)]||undefined;break;case _0x3156ac(0x207):_0x26824d=_0x582ec9['usdcPolygonWallet']||undefined;break;case'erc20_usdc':_0x26824d=_0x582ec9[_0x3156ac(0x219)]||undefined;break;}}console[_0x3156ac(0x1f5)](_0x3156ac(0x2fb)+_0x507e9a+':\x20'+(_0x26824d||_0x3156ac(0x26f)));const _0xdd3d00=await _0x22df1c[_0x3156ac(0x25b)]['create']({'data':{'shopId':_0x5964ec,'amount':_0x4f2257,'network':_0x507e9a,'status':_0x3156ac(0x228),'txid':_0x34a1ad,'notes':_0xd24e6e,'periodFrom':_0x150358?new Date(_0x150358):null,'periodTo':_0x581daa?new Date(_0x581daa):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x10cd28=_0x6d4368-_0x4f2257,_0x2a6ec5=Number(_0x24b523['totalPaidOut'])+_0x4f2257;return await _0x22df1c['shop'][_0x3156ac(0x1fe)]({'where':{'id':_0x5964ec},'data':{'balance':_0x10cd28,'totalPaidOut':_0x2a6ec5}}),console[_0x3156ac(0x1f5)]('💰\x20Shop\x20'+_0x24b523[_0x3156ac(0x230)]+_0x3156ac(0x241)),console['log'](_0x3156ac(0x2b9)+_0x6d4368['toFixed'](0x6)+_0x3156ac(0x24d)+_0x10cd28[_0x3156ac(0x2eb)](0x6)+_0x3156ac(0x317)+_0x4f2257['toFixed'](0x6)+')'),console['log'](_0x3156ac(0x2e8)+_0x24b523[_0x3156ac(0x292)][_0x3156ac(0x2eb)](0x6)+_0x3156ac(0x24d)+_0x2a6ec5['toFixed'](0x6)+'\x20USDT\x20(+'+_0x4f2257['toFixed'](0x6)+')'),console['log'](_0x3156ac(0x2e4)+_0x4f2257[_0x3156ac(0x2eb)](0x6)+_0x3156ac(0x240)),{'payout':_0xdd3d00,'shop':_0x24b523};});return console[_0xc9a104(0x1f5)](_0xc9a104(0x2a9)+_0x3dea98[_0xc9a104(0x25b)]['id']+'\x20for\x20shop\x20'+_0x3dea98[_0xc9a104(0x239)][_0xc9a104(0x230)]+'\x20('+_0x3dea98[_0xc9a104(0x25b)][_0xc9a104(0x285)]['toFixed'](0x6)+_0xc9a104(0x268)),{'id':_0x3dea98[_0xc9a104(0x25b)]['id'],'shopId':_0x3dea98[_0xc9a104(0x25b)][_0xc9a104(0x279)],'shopName':_0x3dea98['shop'][_0xc9a104(0x2c5)],'shopUsername':_0x3dea98['shop']['username'],'amount':_0x3dea98[_0xc9a104(0x25b)]['amount'],'network':_0x3dea98[_0xc9a104(0x25b)][_0xc9a104(0x338)],'status':_0x3dea98[_0xc9a104(0x25b)][_0xc9a104(0x300)],'txid':_0x3dea98['payout'][_0xc9a104(0x275)],'notes':_0x3dea98[_0xc9a104(0x25b)]['notes'],'periodFrom':_0x3dea98[_0xc9a104(0x25b)][_0xc9a104(0x2e2)],'periodTo':_0x3dea98[_0xc9a104(0x25b)][_0xc9a104(0x342)],'createdAt':_0x3dea98[_0xc9a104(0x25b)]['createdAt'],'paidAt':_0x3dea98[_0xc9a104(0x25b)][_0xc9a104(0x27d)]};}async[a40_0x373502(0x277)](_0x4522ce){const _0x2648c3=a40_0x373502,{page:_0x39507f,limit:_0x43fb3b,shopId:_0x867ba5,network:_0x57788b,dateFrom:_0x3a25d6,dateTo:_0x50c572,search:_0x17c2b8}=_0x4522ce,_0x56862a=(_0x39507f-0x1)*_0x43fb3b,_0x3a9821={};_0x867ba5&&(_0x3a9821[_0x2648c3(0x279)]=_0x867ba5);_0x57788b&&(_0x3a9821[_0x2648c3(0x338)]=_0x57788b);(_0x3a25d6||_0x50c572)&&(_0x3a9821[_0x2648c3(0x2a5)]={},_0x3a25d6&&(_0x3a9821[_0x2648c3(0x2a5)][_0x2648c3(0x2b6)]=new Date(_0x3a25d6)),_0x50c572&&(_0x3a9821[_0x2648c3(0x2a5)][_0x2648c3(0x2ac)]=new Date(_0x50c572)));_0x17c2b8&&(_0x3a9821['OR']=[{'shop':{'name':{'contains':_0x17c2b8,'mode':_0x2648c3(0x1ed)}}},{'shop':{'username':{'contains':_0x17c2b8,'mode':'insensitive'}}},{'notes':{'contains':_0x17c2b8,'mode':'insensitive'}}]);const [_0x3e5dff,_0x29027e]=await Promise[_0x2648c3(0x322)]([database_1[_0x2648c3(0x247)][_0x2648c3(0x25b)][_0x2648c3(0x330)]({'where':_0x3a9821,'skip':_0x56862a,'take':_0x43fb3b,'orderBy':{'createdAt':_0x2648c3(0x306)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x2648c3(0x247)][_0x2648c3(0x25b)][_0x2648c3(0x2ae)]({'where':_0x3a9821})]);return{'payouts':_0x3e5dff[_0x2648c3(0x2ad)](_0x3484de=>({'id':_0x3484de['id'],'shopId':_0x3484de[_0x2648c3(0x279)],'shopName':_0x3484de[_0x2648c3(0x239)]['name'],'shopUsername':_0x3484de[_0x2648c3(0x239)][_0x2648c3(0x230)],'amount':_0x3484de[_0x2648c3(0x285)],'network':_0x3484de[_0x2648c3(0x338)],'status':_0x3484de[_0x2648c3(0x300)],'txid':_0x3484de['txid'],'notes':_0x3484de['notes'],'periodFrom':_0x3484de[_0x2648c3(0x2e2)],'periodTo':_0x3484de['periodTo'],'createdAt':_0x3484de[_0x2648c3(0x2a5)],'paidAt':_0x3484de[_0x2648c3(0x27d)]})),'pagination':{'page':_0x39507f,'limit':_0x43fb3b,'total':_0x29027e,'totalPages':Math['ceil'](_0x29027e/_0x43fb3b)}};}async[a40_0x373502(0x33a)](_0x506a91){const _0x1a9235=a40_0x373502,_0x2dad30=await database_1[_0x1a9235(0x247)][_0x1a9235(0x25b)][_0x1a9235(0x296)]({'where':{'id':_0x506a91},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x2dad30)return null;return{'id':_0x2dad30['id'],'shopId':_0x2dad30[_0x1a9235(0x279)],'shopName':_0x2dad30[_0x1a9235(0x239)][_0x1a9235(0x2c5)],'shopUsername':_0x2dad30['shop'][_0x1a9235(0x230)],'amount':_0x2dad30[_0x1a9235(0x285)],'network':_0x2dad30[_0x1a9235(0x338)],'status':_0x2dad30['status'],'txid':_0x2dad30[_0x1a9235(0x275)],'notes':_0x2dad30[_0x1a9235(0x24e)],'periodFrom':_0x2dad30[_0x1a9235(0x2e2)],'periodTo':_0x2dad30[_0x1a9235(0x342)],'createdAt':_0x2dad30[_0x1a9235(0x2a5)],'paidAt':_0x2dad30[_0x1a9235(0x27d)]};}async[a40_0x373502(0x2b1)](_0x2707eb){const _0x2056a7=a40_0x373502;await database_1['default'][_0x2056a7(0x25b)][_0x2056a7(0x23a)]({'where':{'id':_0x2707eb}});}async[a40_0x373502(0x260)](_0x21d3c5){const _0x594819=a40_0x373502,{page:_0x1730d4,limit:_0xff7e07,status:_0x4b1e01,gateway:_0x56b057,shopId:_0x430c22,dateFrom:_0xe7a3ba,dateTo:_0x25e280,search:_0xd28460,currency:_0xa04554,sortBy:_0x113585,sortOrder:_0xa7bc97}=_0x21d3c5,_0x1e2129=(_0x1730d4-0x1)*_0xff7e07;console[_0x594819(0x1f5)]('📊\x20Getting\x20payments\x20with\x20filters:',_0x21d3c5);const _0x293dad=await database_1['default']['payment']['groupBy']({'by':['gateway'],'_count':{'gateway':!![]}});console['log'](_0x594819(0x2f1),_0x293dad[_0x594819(0x2ad)](_0x5aacd9=>_0x5aacd9['gateway']+'\x20('+_0x5aacd9[_0x594819(0x201)][_0x594819(0x32e)]+_0x594819(0x264)));if(_0x56b057){const _0x2ebb9b=_0x293dad[_0x594819(0x2fa)](_0x379683=>_0x379683[_0x594819(0x32e)]['toLowerCase']()===_0x56b057[_0x594819(0x273)]());!_0x2ebb9b&&_0x56b057[_0x594819(0x273)]()!==_0x594819(0x225)&&console['log'](_0x594819(0x2d8)+_0x56b057+'\x27\x20not\x20found.\x20Available\x20gateways:\x20'+_0x293dad['map'](_0x44df69=>_0x44df69['gateway'])[_0x594819(0x33c)](',\x20'));}const _0x5cd195={};_0x4b1e01&&(_0x5cd195['status']=_0x4b1e01['toUpperCase']());if(!_0x56b057)_0x5cd195[_0x594819(0x32e)]={'not':_0x594819(0x225)};else{if(_0x56b057&&(_0x56b057[_0x594819(0x273)]()===_0x594819(0x225)||_0x56b057===_0x594819(0x229)))_0x5cd195[_0x594819(0x32e)]=_0x594819(0x225);else{let _0x31d915=_0x56b057;const _0x165107=(0x0,gateway_1[_0x594819(0x2d6)])(_0x56b057);if(_0x165107)_0x31d915=_0x165107,console[_0x594819(0x1f5)](_0x594819(0x335)+_0x56b057+_0x594819(0x257)+_0x31d915+'\x27');else{const _0x491569=(0x0,gateway_1['getGatewayIdByName'])(_0x56b057);if(_0x491569){const _0x1f58a4=(0x0,gateway_1['getGatewayNameById'])(_0x491569);_0x1f58a4&&(_0x31d915=_0x1f58a4,console[_0x594819(0x1f5)](_0x594819(0x2ed)+_0x56b057+_0x594819(0x297)+_0x491569+_0x594819(0x20e)+_0x31d915+'\x27'));}else console['log']('🔍\x20Using\x20gateway\x20\x27'+_0x56b057+_0x594819(0x288));}const _0x5b6782=await database_1['default'][_0x594819(0x2dd)]['count']({'where':{'gateway':_0x31d915[_0x594819(0x273)]()},'take':0x1});_0x5b6782===0x0?(console[_0x594819(0x1f5)](_0x594819(0x29d)+_0x31d915+'\x27\x20(from\x20\x27'+_0x56b057+'\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result'),_0x5cd195[_0x594819(0x32e)]=_0x594819(0x27a)):(_0x5cd195[_0x594819(0x32e)]=_0x31d915['toLowerCase'](),console[_0x594819(0x1f5)](_0x594819(0x2cf)+_0x31d915+_0x594819(0x26e)+_0x56b057+'\x27)'));}}console[_0x594819(0x1f5)](_0x594819(0x340),_0x5cd195[_0x594819(0x32e)]);_0x430c22&&(_0x5cd195[_0x594819(0x279)]=_0x430c22);_0xa04554&&(_0x5cd195[_0x594819(0x341)]=_0xa04554[_0x594819(0x22b)](),console[_0x594819(0x1f5)](_0x594819(0x283)+_0xa04554[_0x594819(0x22b)]()));(_0xe7a3ba||_0x25e280)&&(_0x5cd195['createdAt']={},_0xe7a3ba&&(_0x5cd195['createdAt'][_0x594819(0x2b6)]=new Date(_0xe7a3ba)),_0x25e280&&(_0x5cd195[_0x594819(0x2a5)][_0x594819(0x2ac)]=new Date(_0x25e280)));_0xd28460&&(_0x5cd195['OR']=[{'id':{'contains':_0xd28460,'mode':_0x594819(0x1ed)}},{'orderId':{'contains':_0xd28460,'mode':_0x594819(0x1ed)}},{'gatewayOrderId':{'contains':_0xd28460,'mode':'insensitive'}},{'customerEmail':{'contains':_0xd28460,'mode':_0x594819(0x1ed)}},{'shop':{'name':{'contains':_0xd28460,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0xd28460,'mode':'insensitive'}}}]);console[_0x594819(0x1f5)](_0x594819(0x2ee),JSON[_0x594819(0x310)](_0x5cd195,null,0x2));let _0xca82a5={'createdAt':_0x594819(0x306)};if(_0x113585){const _0x53128d=['amount',_0x594819(0x2a5),_0x594819(0x1f9),_0x594819(0x300),_0x594819(0x32e),'currency'],_0x3c46c6=[_0x594819(0x2d4),_0x594819(0x306)];if(_0x53128d[_0x594819(0x21c)](_0x113585)){const _0x33d2c8=_0x3c46c6['includes'](_0xa7bc97)?_0xa7bc97:_0x594819(0x306);_0xca82a5={[_0x113585]:_0x33d2c8},console['log'](_0x594819(0x20f)+_0x113585+'\x20in\x20'+_0x33d2c8+_0x594819(0x1f6));}}const [_0x5921e9,_0x24f92d]=await Promise['all']([database_1[_0x594819(0x247)]['payment'][_0x594819(0x330)]({'where':_0x5cd195,'skip':_0x1e2129,'take':_0xff7e07,'orderBy':_0xca82a5,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x594819(0x247)]['payment'][_0x594819(0x2ae)]({'where':_0x5cd195})]);return{'payments':_0x5921e9,'pagination':{'page':_0x1730d4,'limit':_0xff7e07,'total':_0x24f92d,'totalPages':Math['ceil'](_0x24f92d/_0xff7e07)}};}async[a40_0x373502(0x227)](_0x3b24f6){const _0x1c478b=a40_0x373502,_0x553002=await database_1['default']['payment'][_0x1c478b(0x296)]({'where':{'id':_0x3b24f6},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x553002)return null;return{'id':_0x553002['id'],'shopId':_0x553002['shopId'],'gateway':_0x553002[_0x1c478b(0x32e)],'amount':_0x553002['amount'],'currency':_0x553002[_0x1c478b(0x341)],'status':_0x553002[_0x1c478b(0x300)],'orderId':_0x553002[_0x1c478b(0x2b2)],'gatewayOrderId':_0x553002['gatewayOrderId'],'customerEmail':_0x553002[_0x1c478b(0x1f0)],'customerName':_0x553002[_0x1c478b(0x214)],'customerCountry':_0x553002[_0x1c478b(0x308)],'customerIp':_0x553002['customerIp'],'customerUa':_0x553002[_0x1c478b(0x313)],'failureMessage':_0x553002['failureMessage'],'externalPaymentUrl':_0x553002[_0x1c478b(0x337)],'successUrl':_0x553002[_0x1c478b(0x28f)],'failUrl':_0x553002['failUrl'],'pendingUrl':_0x553002['pendingUrl'],'whiteUrl':_0x553002[_0x1c478b(0x30b)],'createdAt':_0x553002[_0x1c478b(0x2a5)],'updatedAt':_0x553002[_0x1c478b(0x1f9)],'shop':_0x553002[_0x1c478b(0x239)]};}async[a40_0x373502(0x2f5)](_0x384b14,_0x35c187,_0x4273a6,_0x31dea7){const _0x2d0744=a40_0x373502,_0x5359c9=await database_1['default']['$transaction'](async _0x2524a9=>{const _0xfe9cdc=a40_0x49bf,_0x5b3b2d=await _0x2524a9[_0xfe9cdc(0x2dd)][_0xfe9cdc(0x296)]({'where':{'id':_0x384b14},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x5b3b2d)throw new Error(_0xfe9cdc(0x331));const _0x908392=_0x5b3b2d[_0xfe9cdc(0x300)],_0x41a3cc=_0x35c187[_0xfe9cdc(0x22b)]();console[_0xfe9cdc(0x1f5)](_0xfe9cdc(0x256)+_0x384b14+_0xfe9cdc(0x2e0)+_0x908392+_0xfe9cdc(0x24d)+_0x41a3cc),console[_0xfe9cdc(0x1f5)](_0xfe9cdc(0x265)+_0x5b3b2d[_0xfe9cdc(0x239)][_0xfe9cdc(0x2c8)]+_0xfe9cdc(0x240));const _0x53ca14={'status':_0x41a3cc,'updatedAt':new Date(),'statusChangedBy':_0xfe9cdc(0x323),'statusChangedAt':new Date()};_0x4273a6&&(_0x53ca14[_0xfe9cdc(0x2ab)]=_0x4273a6);_0x41a3cc===_0xfe9cdc(0x1ef)&&_0x31dea7&&(_0x53ca14['chargebackAmount']=_0x31dea7);let _0x85016e=0x0,_0x3d0a7f=_0x5b3b2d[_0xfe9cdc(0x239)]['balance'];if(_0x41a3cc===_0xfe9cdc(0x30a)&&_0x908392!==_0xfe9cdc(0x30a)){_0x53ca14[_0xfe9cdc(0x27d)]=new Date();const _0x1390fd=await currencyService_1['currencyService'][_0xfe9cdc(0x25a)](_0x5b3b2d[_0xfe9cdc(0x285)],_0x5b3b2d['currency']);_0x53ca14['amountUSDT']=_0x1390fd;let _0x135087=0x2d;const _0x22900e=await _0x2524a9[_0xfe9cdc(0x239)][_0xfe9cdc(0x296)]({'where':{'id':_0x5b3b2d[_0xfe9cdc(0x279)]},'select':{'gatewaySettings':!![]}});if(_0x22900e?.['gatewaySettings'])try{const _0x5e6e0c=JSON['parse'](_0x22900e[_0xfe9cdc(0x31f)]);for(const [_0x40206d,_0x22c74f]of Object[_0xfe9cdc(0x261)](_0x5e6e0c)){if(_0x40206d[_0xfe9cdc(0x273)]()===_0x5b3b2d[_0xfe9cdc(0x32e)][_0xfe9cdc(0x273)]()){_0x135087=_0x22c74f[_0xfe9cdc(0x329)]||0xa;break;}}}catch(_0x38a292){console[_0xfe9cdc(0x1fd)](_0xfe9cdc(0x304)+_0x384b14+':',_0x38a292);}let _0x292712;_0x5b3b2d[_0xfe9cdc(0x2ea)]!==null&&_0x5b3b2d[_0xfe9cdc(0x2ea)]!==undefined?(_0x292712=_0x5b3b2d['amountAfterGatewayCommissionUSDT'],console[_0xfe9cdc(0x1f5)](_0xfe9cdc(0x233)+_0x292712[_0xfe9cdc(0x2eb)](0x6)+'\x20USDT\x20for\x20payment\x20'+_0x384b14)):(_0x292712=_0x1390fd*(0x1-_0x135087/0x64),console[_0xfe9cdc(0x1f5)](_0xfe9cdc(0x2ec)+_0x384b14+':\x20'+_0x135087+_0xfe9cdc(0x334)+_0x1390fd[_0xfe9cdc(0x2eb)](0x6)+_0xfe9cdc(0x240)),_0x53ca14[_0xfe9cdc(0x2ea)]=_0x292712,_0x53ca14[_0xfe9cdc(0x2b0)]=_0x135087),_0x85016e=_0x292712,_0x3d0a7f+=_0x292712,console[_0xfe9cdc(0x1f5)](_0xfe9cdc(0x327)+_0x384b14+_0xfe9cdc(0x321)),console[_0xfe9cdc(0x1f5)]('\x20\x20\x20Full\x20amount:\x20'+_0x1390fd['toFixed'](0x6)+_0xfe9cdc(0x240)),console[_0xfe9cdc(0x1f5)](_0xfe9cdc(0x271)+_0x5b3b2d[_0xfe9cdc(0x32e)]+_0xfe9cdc(0x343)+_0x135087+'%'),console[_0xfe9cdc(0x1f5)]('\x20\x20\x20Merchant\x20gets:\x20'+_0x292712[_0xfe9cdc(0x2eb)](0x6)+_0xfe9cdc(0x280)+_0x135087+_0xfe9cdc(0x22a)),console['log'](_0xfe9cdc(0x2da)+_0x292712['toFixed'](0x6)+_0xfe9cdc(0x240));}else{if(_0x908392==='PAID'&&_0x41a3cc!=='PAID'&&_0x41a3cc!==_0xfe9cdc(0x1ef)){if(_0x5b3b2d[_0xfe9cdc(0x302)]){let _0x5275b3=0x2d;const _0x458f29=await _0x2524a9[_0xfe9cdc(0x239)][_0xfe9cdc(0x296)]({'where':{'id':_0x5b3b2d['shopId']},'select':{'gatewaySettings':!![]}});if(_0x458f29?.['gatewaySettings'])try{const _0x2e602c=JSON[_0xfe9cdc(0x23c)](_0x458f29[_0xfe9cdc(0x31f)]);for(const [_0x51f986,_0x17101c]of Object[_0xfe9cdc(0x261)](_0x2e602c)){if(_0x51f986[_0xfe9cdc(0x273)]()===_0x5b3b2d[_0xfe9cdc(0x32e)][_0xfe9cdc(0x273)]()){_0x5275b3=_0x17101c[_0xfe9cdc(0x329)]||0xa;break;}}}catch(_0x13fb7f){console[_0xfe9cdc(0x1fd)]('Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20'+_0x384b14+':',_0x13fb7f);}const _0x497f57=_0x5b3b2d['amountUSDT']*(0x1-_0x5275b3/0x64);_0x85016e=-_0x497f57,_0x3d0a7f-=_0x497f57,console['log'](_0xfe9cdc(0x278)+_0x5b3b2d[_0xfe9cdc(0x302)][_0xfe9cdc(0x2eb)](0x6)+_0xfe9cdc(0x240)),console[_0xfe9cdc(0x1f5)](_0xfe9cdc(0x271)+_0x5b3b2d['gateway']+',\x20Commission:\x20'+_0x5275b3+'%'),console[_0xfe9cdc(0x1f5)](_0xfe9cdc(0x24c)+_0x497f57['toFixed'](0x6)+_0xfe9cdc(0x280)+_0x5275b3+_0xfe9cdc(0x22a)),console['log']('\x20\x20\x20Subtracted\x20from\x20balance:\x20-'+_0x497f57[_0xfe9cdc(0x2eb)](0x6)+_0xfe9cdc(0x240));}}}_0x41a3cc==='CHARGEBACK'&&(console[_0xfe9cdc(0x1f5)]('💸\x20CHARGEBACK:\x20Processing\x20penalty-only\x20deduction'),_0x31dea7&&_0x31dea7>0x0?(_0x85016e=-_0x31dea7,_0x3d0a7f-=_0x31dea7,console[_0xfe9cdc(0x1f5)](_0xfe9cdc(0x1f1)+_0x31dea7['toFixed'](0x6)+_0xfe9cdc(0x216)),console[_0xfe9cdc(0x1f5)](_0xfe9cdc(0x2fd))):console['log'](_0xfe9cdc(0x326)),_0x53ca14[_0xfe9cdc(0x2b7)]=_0x31dea7||0x0);_0x41a3cc===_0xfe9cdc(0x2ff)&&_0x908392===_0xfe9cdc(0x30a)&&console[_0xfe9cdc(0x1f5)](_0xfe9cdc(0x232));const _0x491ca2=await _0x2524a9['payment'][_0xfe9cdc(0x1fe)]({'where':{'id':_0x384b14},'data':_0x53ca14,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x85016e!==0x0&&(await _0x2524a9[_0xfe9cdc(0x239)][_0xfe9cdc(0x1fe)]({'where':{'id':_0x5b3b2d['shopId']},'data':{'balance':_0x3d0a7f}}),console[_0xfe9cdc(0x1f5)](_0xfe9cdc(0x316)+_0x5b3b2d['shopId']+_0xfe9cdc(0x2a6)+_0x5b3b2d[_0xfe9cdc(0x239)][_0xfe9cdc(0x2c8)][_0xfe9cdc(0x2eb)](0x6)+_0xfe9cdc(0x24d)+_0x3d0a7f[_0xfe9cdc(0x2eb)](0x6)+_0xfe9cdc(0x2f7)+(_0x85016e>0x0?'+':'')+_0x85016e[_0xfe9cdc(0x2eb)](0x6)+')')),_0x491ca2;});return{'id':_0x5359c9['id'],'shopId':_0x5359c9[_0x2d0744(0x279)],'gateway':_0x5359c9['gateway'],'amount':_0x5359c9[_0x2d0744(0x285)],'currency':_0x5359c9['currency'],'status':_0x5359c9[_0x2d0744(0x300)],'orderId':_0x5359c9['orderId'],'gatewayOrderId':_0x5359c9[_0x2d0744(0x249)],'customerEmail':_0x5359c9['customerEmail'],'customerName':_0x5359c9['customerName'],'customerCountry':_0x5359c9[_0x2d0744(0x308)],'customerIp':_0x5359c9['customerIp'],'customerUa':_0x5359c9[_0x2d0744(0x313)],'failureMessage':_0x5359c9[_0x2d0744(0x267)],'adminNotes':_0x5359c9[_0x2d0744(0x2ab)],'chargebackAmount':_0x5359c9[_0x2d0744(0x2b7)],'statusChangedBy':_0x5359c9[_0x2d0744(0x210)],'statusChangedAt':_0x5359c9['statusChangedAt'],'createdAt':_0x5359c9['createdAt'],'updatedAt':_0x5359c9[_0x2d0744(0x1f9)],'shop':_0x5359c9[_0x2d0744(0x239)]};}async[a40_0x373502(0x23b)](_0x4d5027,_0x22c0d1){const _0x18e19d=a40_0x373502,_0x331645=Math[_0x18e19d(0x26c)]()['toString'](0x24)['substr'](0x2,0x9);console[_0x18e19d(0x1f5)](_0x18e19d(0x2b4)+_0x331645+_0x18e19d(0x2bf)+_0x4d5027);const _0x132eca={..._0x22c0d1};_0x22c0d1[_0x18e19d(0x259)]&&_0x22c0d1['password'][_0x18e19d(0x204)]()!==''?(console[_0x18e19d(0x1f5)](_0x18e19d(0x2a4)+_0x331645+_0x18e19d(0x2d1)+_0x4d5027),_0x132eca[_0x18e19d(0x259)]=await bcryptjs_1[_0x18e19d(0x247)][_0x18e19d(0x243)](_0x22c0d1[_0x18e19d(0x259)],0xc)):(console['log'](_0x18e19d(0x2a4)+_0x331645+_0x18e19d(0x2d5)),delete _0x132eca['password']);_0x22c0d1['fullName']&&(_0x132eca[_0x18e19d(0x2c5)]=_0x22c0d1[_0x18e19d(0x276)],delete _0x132eca[_0x18e19d(0x276)]);_0x22c0d1[_0x18e19d(0x31c)]&&(_0x132eca[_0x18e19d(0x25f)]=_0x22c0d1[_0x18e19d(0x31c)],delete _0x132eca[_0x18e19d(0x31c)]);_0x22c0d1['merchantUrl']&&(_0x132eca[_0x18e19d(0x22e)]=_0x22c0d1['merchantUrl'],delete _0x132eca[_0x18e19d(0x307)]);if(_0x22c0d1[_0x18e19d(0x2b8)]){const _0x1983af=_0x22c0d1[_0x18e19d(0x2b8)][_0x18e19d(0x2ad)](_0x31f4b2=>this[_0x18e19d(0x269)](_0x31f4b2));console[_0x18e19d(0x1f5)](_0x18e19d(0x1f8),_0x22c0d1[_0x18e19d(0x2b8)],'->',_0x1983af),_0x132eca[_0x18e19d(0x20d)]=JSON[_0x18e19d(0x310)](_0x1983af),delete _0x132eca['gateways'];}_0x22c0d1['gatewaySettings']&&(console[_0x18e19d(0x1f5)](_0x18e19d(0x237)+_0x331645+_0x18e19d(0x33b),_0x22c0d1[_0x18e19d(0x31f)]),_0x132eca[_0x18e19d(0x31f)]=JSON[_0x18e19d(0x310)](_0x22c0d1[_0x18e19d(0x31f)]),console[_0x18e19d(0x1f5)](_0x18e19d(0x237)+_0x331645+_0x18e19d(0x32d),_0x132eca[_0x18e19d(0x31f)]));_0x22c0d1[_0x18e19d(0x28a)]&&(_0x22c0d1[_0x18e19d(0x28a)]['usdtPolygonWallet']!==undefined&&(_0x132eca[_0x18e19d(0x314)]=_0x22c0d1[_0x18e19d(0x28a)][_0x18e19d(0x314)]||null),_0x22c0d1[_0x18e19d(0x28a)][_0x18e19d(0x2e3)]!==undefined&&(_0x132eca[_0x18e19d(0x2e3)]=_0x22c0d1['wallets'][_0x18e19d(0x2e3)]||null),_0x22c0d1[_0x18e19d(0x28a)][_0x18e19d(0x2e6)]!==undefined&&(_0x132eca['usdtErcWallet']=_0x22c0d1[_0x18e19d(0x28a)][_0x18e19d(0x2e6)]||null),_0x22c0d1[_0x18e19d(0x28a)]['usdcPolygonWallet']!==undefined&&(_0x132eca[_0x18e19d(0x262)]=_0x22c0d1[_0x18e19d(0x28a)][_0x18e19d(0x262)]||null),delete _0x132eca['wallets']);const _0x307f5b=await database_1[_0x18e19d(0x247)]['shop'][_0x18e19d(0x1fe)]({'where':{'id':_0x4d5027},'data':_0x132eca,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console['log'](_0x18e19d(0x311)+_0x331645+']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:',_0x307f5b[_0x18e19d(0x31f)]),{'id':_0x307f5b['id'],'fullName':_0x307f5b[_0x18e19d(0x2c5)],'username':_0x307f5b[_0x18e19d(0x230)],'telegramId':_0x307f5b[_0x18e19d(0x25f)],'merchantUrl':_0x307f5b[_0x18e19d(0x22e)],'gateways':_0x307f5b[_0x18e19d(0x20d)]?JSON[_0x18e19d(0x23c)](_0x307f5b[_0x18e19d(0x20d)]):null,'gatewaySettings':_0x307f5b['gatewaySettings']?JSON[_0x18e19d(0x23c)](_0x307f5b[_0x18e19d(0x31f)]):null,'publicKey':_0x307f5b[_0x18e19d(0x274)],'wallets':{'usdtPolygonWallet':_0x307f5b['usdtPolygonWallet'],'usdtTrcWallet':_0x307f5b['usdtTrcWallet'],'usdtErcWallet':_0x307f5b[_0x18e19d(0x2e6)],'usdcPolygonWallet':_0x307f5b[_0x18e19d(0x262)]},'status':_0x307f5b[_0x18e19d(0x300)],'createdAt':_0x307f5b[_0x18e19d(0x2a5)]};}async[a40_0x373502(0x21b)](_0x1cc50a){const _0x402b5=a40_0x373502,_0x3d7912=await database_1[_0x402b5(0x247)]['shop'][_0x402b5(0x1fe)]({'where':{'id':_0x1cc50a},'data':{'status':_0x402b5(0x333)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x3d7912['id'],'fullName':_0x3d7912[_0x402b5(0x2c5)],'username':_0x3d7912[_0x402b5(0x230)],'telegramId':_0x3d7912['telegram'],'merchantUrl':_0x3d7912[_0x402b5(0x22e)],'gateways':_0x3d7912['paymentGateways']?JSON['parse'](_0x3d7912[_0x402b5(0x20d)]):null,'gatewaySettings':_0x3d7912[_0x402b5(0x31f)]?JSON['parse'](_0x3d7912[_0x402b5(0x31f)]):null,'publicKey':_0x3d7912[_0x402b5(0x274)],'wallets':{'usdtPolygonWallet':_0x3d7912[_0x402b5(0x314)],'usdtTrcWallet':_0x3d7912[_0x402b5(0x2e3)],'usdtErcWallet':_0x3d7912[_0x402b5(0x2e6)],'usdcPolygonWallet':_0x3d7912[_0x402b5(0x262)]},'status':_0x3d7912[_0x402b5(0x300)],'createdAt':_0x3d7912[_0x402b5(0x2a5)]};}async['activateUser'](_0x434f24){const _0x3de97=a40_0x373502,_0x406d83=await database_1[_0x3de97(0x247)][_0x3de97(0x239)][_0x3de97(0x1fe)]({'where':{'id':_0x434f24},'data':{'status':_0x3de97(0x223)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x406d83['id'],'fullName':_0x406d83[_0x3de97(0x2c5)],'username':_0x406d83['username'],'telegramId':_0x406d83[_0x3de97(0x25f)],'merchantUrl':_0x406d83[_0x3de97(0x22e)],'gateways':_0x406d83[_0x3de97(0x20d)]?JSON[_0x3de97(0x23c)](_0x406d83['paymentGateways']):null,'gatewaySettings':_0x406d83[_0x3de97(0x31f)]?JSON[_0x3de97(0x23c)](_0x406d83['gatewaySettings']):null,'publicKey':_0x406d83['publicKey'],'wallets':{'usdtPolygonWallet':_0x406d83['usdtPolygonWallet'],'usdtTrcWallet':_0x406d83[_0x3de97(0x2e3)],'usdtErcWallet':_0x406d83[_0x3de97(0x2e6)],'usdcPolygonWallet':_0x406d83[_0x3de97(0x262)]},'status':_0x406d83[_0x3de97(0x300)],'createdAt':_0x406d83[_0x3de97(0x2a5)]};}async[a40_0x373502(0x2a8)](_0x485479){const _0x3f7a43=a40_0x373502,{page:_0x27e8b8,limit:_0x457d08,status:_0x3c6b47}=_0x485479,_0x45ee8f=(_0x27e8b8-0x1)*_0x457d08,_0x2309ef={};_0x3c6b47&&(_0x2309ef[_0x3f7a43(0x300)]=_0x3c6b47['toUpperCase']());const [_0x419c5f,_0x348da9]=await Promise[_0x3f7a43(0x322)]([database_1[_0x3f7a43(0x247)][_0x3f7a43(0x239)]['findMany']({'where':_0x2309ef,'skip':_0x45ee8f,'take':_0x457d08,'orderBy':{'createdAt':_0x3f7a43(0x306)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x3f7a43(0x247)]['shop'][_0x3f7a43(0x2ae)]({'where':_0x2309ef})]);return{'users':_0x419c5f['map'](_0x1e931a=>{const _0x3d9541=_0x3f7a43,_0x369ed4=_0x1e931a['paymentGateways']?JSON[_0x3d9541(0x23c)](_0x1e931a[_0x3d9541(0x20d)]):null,_0x4bf23=_0x369ed4?_0x369ed4[_0x3d9541(0x2ad)](_0x208c03=>this[_0x3d9541(0x255)](_0x208c03)):null;return{'id':_0x1e931a['id'],'fullName':_0x1e931a[_0x3d9541(0x2c5)],'username':_0x1e931a[_0x3d9541(0x230)],'telegramId':_0x1e931a['telegram'],'merchantUrl':_0x1e931a[_0x3d9541(0x22e)],'gateways':_0x4bf23,'gatewaySettings':_0x1e931a[_0x3d9541(0x31f)]?JSON[_0x3d9541(0x23c)](_0x1e931a[_0x3d9541(0x31f)]):null,'publicKey':_0x1e931a['publicKey'],'wallets':{'usdtPolygonWallet':_0x1e931a[_0x3d9541(0x314)],'usdtTrcWallet':_0x1e931a[_0x3d9541(0x2e3)],'usdtErcWallet':_0x1e931a[_0x3d9541(0x2e6)],'usdcPolygonWallet':_0x1e931a['usdcPolygonWallet']},'status':_0x1e931a['status'],'createdAt':_0x1e931a['createdAt']};}),'pagination':{'page':_0x27e8b8,'limit':_0x457d08,'total':_0x348da9,'totalPages':Math[_0x3f7a43(0x2a7)](_0x348da9/_0x457d08)}};}async[a40_0x373502(0x220)](_0x1e4549){const _0x17c10a=a40_0x373502,_0x53ee00=await database_1[_0x17c10a(0x247)][_0x17c10a(0x239)][_0x17c10a(0x296)]({'where':{'id':_0x1e4549},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x53ee00)return null;const _0x4f0b7d=_0x53ee00[_0x17c10a(0x20d)]?JSON[_0x17c10a(0x23c)](_0x53ee00[_0x17c10a(0x20d)]):null,_0x3c0fbb=_0x4f0b7d?_0x4f0b7d['map'](_0x118a89=>this[_0x17c10a(0x255)](_0x118a89)):null;return _0x4f0b7d&&_0x3c0fbb&&console[_0x17c10a(0x1f5)]('🔄\x20Gateway\x20mapping\x20(get):',_0x4f0b7d,'->',_0x3c0fbb),{'id':_0x53ee00['id'],'fullName':_0x53ee00[_0x17c10a(0x2c5)],'username':_0x53ee00['username'],'telegramId':_0x53ee00['telegram'],'merchantUrl':_0x53ee00[_0x17c10a(0x22e)],'gateways':_0x3c0fbb,'gatewaySettings':_0x53ee00[_0x17c10a(0x31f)]?JSON['parse'](_0x53ee00[_0x17c10a(0x31f)]):null,'publicKey':_0x53ee00[_0x17c10a(0x274)],'wallets':{'usdtPolygonWallet':_0x53ee00['usdtPolygonWallet'],'usdtTrcWallet':_0x53ee00[_0x17c10a(0x2e3)],'usdtErcWallet':_0x53ee00[_0x17c10a(0x2e6)],'usdcPolygonWallet':_0x53ee00[_0x17c10a(0x262)]},'status':_0x53ee00[_0x17c10a(0x300)],'createdAt':_0x53ee00[_0x17c10a(0x2a5)]};}async[a40_0x373502(0x2cc)](_0x137177){const _0x5d4517=a40_0x373502,{fullName:_0x13c216,username:_0x398200,password:_0x2282a7,telegramId:_0x143c80,merchantUrl:_0x1ecffd,gateways:_0x55595c,gatewaySettings:_0x58b90e,wallets:_0x1067eb}=_0x137177,_0x4cd5f2=await database_1[_0x5d4517(0x247)][_0x5d4517(0x239)][_0x5d4517(0x296)]({'where':{'username':_0x398200}});if(_0x4cd5f2)throw new Error(_0x5d4517(0x2f6));if(_0x143c80){const _0x7ab3a5=await database_1['default']['shop'][_0x5d4517(0x296)]({'where':{'telegram':_0x143c80}});if(_0x7ab3a5)throw new Error(_0x5d4517(0x226));}const _0x21e3e0=await bcryptjs_1[_0x5d4517(0x247)][_0x5d4517(0x243)](_0x2282a7,0xc),_0x3041b4='pk_'+crypto_1['default'][_0x5d4517(0x31b)](0x20)[_0x5d4517(0x22f)](_0x5d4517(0x203)),_0x1318e4=_0x5d4517(0x2d0)+crypto_1[_0x5d4517(0x247)][_0x5d4517(0x31b)](0x20)[_0x5d4517(0x22f)]('hex'),_0x579cca=_0x55595c?_0x55595c[_0x5d4517(0x2ad)](_0x15bd8b=>this[_0x5d4517(0x269)](_0x15bd8b)):null;_0x55595c&&_0x579cca&&console[_0x5d4517(0x1f5)](_0x5d4517(0x2c1),_0x55595c,'->',_0x579cca);const _0x30af3e=await database_1[_0x5d4517(0x247)][_0x5d4517(0x239)]['create']({'data':{'name':_0x13c216,'username':_0x398200,'password':_0x21e3e0,'telegram':_0x143c80,'shopUrl':_0x1ecffd,'paymentGateways':_0x579cca?JSON['stringify'](_0x579cca):null,'gatewaySettings':_0x58b90e?JSON[_0x5d4517(0x310)](_0x58b90e):null,'usdtPolygonWallet':_0x1067eb?.[_0x5d4517(0x314)]||null,'usdtTrcWallet':_0x1067eb?.[_0x5d4517(0x2e3)]||null,'usdtErcWallet':_0x1067eb?.[_0x5d4517(0x2e6)]||null,'usdcPolygonWallet':_0x1067eb?.['usdcPolygonWallet']||null,'publicKey':_0x3041b4,'secretKey':_0x1318e4,'status':_0x5d4517(0x223)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x30af3e['id'],'fullName':_0x30af3e[_0x5d4517(0x2c5)],'username':_0x30af3e[_0x5d4517(0x230)],'telegramId':_0x30af3e['telegram'],'merchantUrl':_0x30af3e[_0x5d4517(0x22e)],'gateways':_0x30af3e[_0x5d4517(0x20d)]?JSON[_0x5d4517(0x23c)](_0x30af3e[_0x5d4517(0x20d)]):null,'gatewaySettings':_0x30af3e['gatewaySettings']?JSON[_0x5d4517(0x23c)](_0x30af3e[_0x5d4517(0x31f)]):null,'publicKey':_0x30af3e[_0x5d4517(0x274)],'wallets':{'usdtPolygonWallet':_0x30af3e[_0x5d4517(0x314)],'usdtTrcWallet':_0x30af3e[_0x5d4517(0x2e3)],'usdtErcWallet':_0x30af3e[_0x5d4517(0x2e6)],'usdcPolygonWallet':_0x30af3e['usdcPolygonWallet']},'status':_0x30af3e['status'],'createdAt':_0x30af3e[_0x5d4517(0x2a5)]};}async[a40_0x373502(0x234)](_0x40e3d4){const _0x58d4d9=a40_0x373502;await database_1[_0x58d4d9(0x247)][_0x58d4d9(0x239)][_0x58d4d9(0x23a)]({'where':{'id':_0x40e3d4}});}['generateDailyStatistics'](_0x847703,_0x3e1271,_0x2e8e1d){const _0x267e68=a40_0x373502,_0x23f5ce=new Map(),_0x32d523=new Date(_0x3e1271);while(_0x32d523<=_0x2e8e1d){const _0x1fb611=_0x32d523[_0x267e68(0x209)]()[_0x267e68(0x1ec)]('T')[0x0];_0x23f5ce[_0x267e68(0x2c7)](_0x1fb611,{'revenue':0x0,'count':0x0}),_0x32d523[_0x267e68(0x2fe)](_0x32d523[_0x267e68(0x242)]()+0x1);}for(const _0x3ae465 of _0x847703){const _0x3209fa=_0x3ae465['createdAt']['toISOString']()[_0x267e68(0x1ec)]('T')[0x0],_0xd8408a=_0x23f5ce[_0x267e68(0x32c)](_0x3209fa);_0xd8408a&&(_0xd8408a[_0x267e68(0x2ae)]+=0x1,_0x3ae465[_0x267e68(0x300)]===_0x267e68(0x30a)&&(_0x3ae465[_0x267e68(0x302)]?_0xd8408a['revenue']+=_0x3ae465['amountUSDT']:console['log'](_0x267e68(0x250)+_0x3ae465['id']+_0x267e68(0x26d))));}const _0x35d202=[],_0x5a3d77=[];for(const [_0x989fd4,_0x26a1e6]of _0x23f5ce){_0x35d202[_0x267e68(0x30e)]({'date':_0x989fd4,'amount':Math[_0x267e68(0x248)](_0x26a1e6[_0x267e68(0x325)]*0x64)/0x64}),_0x5a3d77[_0x267e68(0x30e)]({'date':_0x989fd4,'count':_0x26a1e6[_0x267e68(0x2ae)]});}return{'dailyRevenue':_0x35d202,'dailyPayments':_0x5a3d77};}}function a40_0x49bf(_0x4f9372,_0x4d7c68){const _0x58a481=a40_0x58a4();return a40_0x49bf=function(_0x49bf6d,_0x1edb22){_0x49bf6d=_0x49bf6d-0x1ec;let _0xeea310=_0x58a481[_0x49bf6d];return _0xeea310;},a40_0x49bf(_0x4f9372,_0x4d7c68);}function a40_0x58a4(){const _0x579865=['getFullYear','\x20USDT,\x20Difference:\x20','\x20for\x20shop\x20',',\x20userId:\x20','Plisio','🔄\x20Gateway\x20mapping\x20(create):','date','merchantEarnings','generateDailyStatistics','name','polygon','set','balance','getPayoutStats','586649mMfEGm','💰\x20Creating\x20payout\x20for\x20shop\x20','createUser','customerIp','\x20USDT\x20(already\x20paid\x20out)','✅\x20Using\x20gateway\x20filter:\x20\x27','sk_',']\x20Updating\x20password\x20for\x20user\x20','\x20\x20\x20📅\x20This\x20month:\x20','dateTo','asc',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','getGatewayNameById','📊\x20Calculated\x20commission\x20rate\x20for\x20payment\x20','⚠️\x20Requested\x20gateway\x20\x27','153lBaHMz','\x20\x20\x20Added\x20to\x20balance:\x20+','\x20USDT\x20(current\x20balance\x20in\x20DB)','totalTurnover','payment','crypto','📊\x20Merchant\x20statistics\x20calculated:','\x20status:\x20','averageCheckUSDT','periodFrom','usdtTrcWallet','\x20\x20\x20Final\x20payout\x20amount\x20used:\x20','\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)','usdtErcWallet','348593CfouRZ','\x20\x20\x20Total\x20paid\x20out:\x20','dailyRevenue','amountAfterGatewayCommissionUSDT','toFixed','📊\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','🔄\x20Converted\x20gateway\x20name\x20\x27','📊\x20Final\x20WHERE\x20conditions:','💰\x20[PAYOUT]\x20Merchant\x20','\x20\x20\x20Available\x20(number):\x20','📊\x20Available\x20gateways\x20in\x20database:','thisMonth',':\x20commission\x20=\x20','\x20\x20\x20Requested\x20(number):\x20','updatePaymentStatus','Username\x20already\x20exists','\x20USDT\x20(','📊\x20Total\x20payments\x20(including\x20failed):\x20',',\x20successful:\x20','some','💳\x20Payout\x20wallet\x20for\x20','week','💰\x20Payment\x20amount\x20is\x20NOT\x20deducted\x20(chargeback\x20penalty\x20only)','setDate','REFUND','status','\x20\x20\x20Available\x20(raw):\x20','amountUSDT','\x20\x20\x20�📊\x20Total\x20payments:\x20','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','totalAmountAfterCommissionUSDT','desc','merchantUrl','customerCountry','_sum','PAID','whiteUrl','2020-01-01','📊\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20','push','totalPayments','stringify','🎯\x20[','\x20\x20\x20💰\x20Total\x20turnover:\x20','customerUa','usdtPolygonWallet','4HSYbVI','💰\x20Shop\x20','\x20USDT\x20(-','getSystemStatistics','CoinToPay','108010mnepUs','randomBytes','telegramId','trc20','KLYME\x20EU','gatewaySettings','getMerchantsSelection','\x20became\x20PAID:','all','admin','\x20\x20\x20💰\x20Total\x20payout:\x20','revenue','⚠️\x20CHARGEBACK\x20without\x20penalty\x20amount\x20-\x20no\x20balance\x20change','💰\x20Payment\x20','klyme_eu','commission','$transaction','forEach','get',']\x20Gateway\x20settings\x20JSON\x20string:','gateway','4977642XbAeei','findMany','Payment\x20not\x20found','\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...','SUSPENDED','%\x20from\x20','🔄\x20Converted\x20gateway\x20ID\x20\x27','totalAmountUSDT','externalPaymentUrl','network','../config/database','getPayoutById',']\x20Gateway\x20settings\x20before\x20saving:','join','5MLaeKU','\x20\x20\x20💸\x20Total\x20payouts:\x20','\x20\x20\x20🤔\x20Difference:\x20','📊\x20Gateway\x20filter\x20applied:','currency','periodTo',',\x20Commission:\x20','\x20\x20\x20Transaction\x20hash:\x20','split','insensitive','values','CHARGEBACK','customerEmail','💸\x20CHARGEBACK\x20penalty\x20ONLY:\x20-','getTime','getMonth','day','log','\x20order','📊\x20Using\x20saved\x20values\x20for\x20payment\x20','🔄\x20Gateway\x20mapping:','updatedAt','year','reduce','plisio','error','update','\x20PAID\x20payments','32LMPTBk','_count','\x20\x20\x20🌍\x20Country:\x20','hex','trim','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','\x20\x20\x20✅\x20Total\x20available\x20for\x20payout:\x20','polygon_usdc','\x20\x20\x20Tolerance:\x20','toISOString','📊\x20Payout\x20statistics\x20calculated:','\x20\x20\x20✅\x20Actual\x20available\x20balance:\x20','💰\x20[PAYOUT]\x20Gateway\x20','paymentGateways','\x27\x20->\x20name\x20\x27','📊\x20Sorting\x20payments\x20by\x20','statusChangedBy','findFirst','month','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','customerName','averageCommissionRate','\x20USDT\x20from\x20balance','\x20merchants\x20with\x20positive\x20balance','cointopay2','usdcErcWallet','createPayout','suspendUser','includes','\x20\x20\x20💰\x20Total\x20payments\x20turnover:\x20','\x20USDT,\x20Requested:\x20','\x20USDT\x20(total\x20paid\x20to\x20merchants)','getUserById','merchantEarningsUSDT','__esModule','ACTIVE','defineProperty','test_gateway','Telegram\x20username\x20already\x20exists','getPaymentById','COMPLETED','0000','%\x20commission)','toUpperCase','KLYME\x20GB','3958467ClQLXU','shopUrl','toString','username','\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)','🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','📊\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','deleteUser','Test\x20Gateway','📅\x20Period:\x20','🔧\x20[','\x20\x20\x20⏳\x20Pending\x20payout:\x20','shop','delete','updateUser','parse','setHours','currencyService','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','\x20USDT','\x20balance\x20updated:','getDate','hash','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','\x20\x20\x20📅\x20Total\x20payouts\x20(this\x20month):\x20','\x20\x20\x20🖥️\x20User\x20Agent:\x20','default','round','gatewayOrderId','paymentsCount','KLYME\x20DE','\x20\x20\x20Merchant\x20loses:\x20','\x20->\x20','notes','commissionUSDT','⚠️\x20Payment\x20','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','📋\x20Getting\x20merchants\x20selection\x20list...','period','klyme_de','getGatewayDisplayName','🔄\x20Admin\x20updating\x20payment\x20','\x27\x20to\x20name\x20\x27','custom','password','convertToUSDT','payout','✅\x20Balance\x20check\x20passed\x20(with\x20tolerance)','🔍\x20Balance\x20check\x20details:','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','telegram','getAllPayments','entries','usdcPolygonWallet','groupBy','\x20payments)','💰\x20Current\x20shop\x20balance:\x20','getMerchantStatistics','failureMessage','\x20USDT)','getGatewayInternalName','getMerchantsAwaitingPayout','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','random','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','\x27\x20(from\x20\x27','not\x20specified','PENDING','\x20\x20\x20Gateway:\x20','\x20\x20\x20�\x20Total\x20payments\x20turnover:\x20','toLowerCase','publicKey','txid','fullName','getAllPayouts','\x20\x20\x20Full\x20amount:\x20','shopId','NONEXISTENT_GATEWAY_FILTER','turnover','\x20USDT\x20(actual\x20balances)','paidAt','\x20paid\x20payments\x20for\x20analysis','yesterday','\x20USDT\x20(after\x20','amountAfterCommissionUSDT','📊\x20Merchants\x20awaiting\x20payout:\x20','💱\x20Currency\x20filter\x20applied:\x20','Rapyd','amount','./currencyService','bcryptjs','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','availableBalance','wallets','totalCommissionRate','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','noda','MasterCard','successUrl','totalPayout','📋\x20Found\x20','totalPaidOut','Insufficient\x20balance.\x20Available:\x20','dateFrom','cointopay','findUnique','\x27\x20->\x20ID\x20\x27','\x20USDT\x20(gross\x20revenue)','3026744hYSpHB','\x20to\x20','aggregate','📊\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','⚠️\x20Gateway\x20\x27','__importDefault','turnoverUSDT','\x20active\x20merchants\x20for\x20selection','length','paidOutUSDT','Open\x20Banking\x202','🔐\x20[','createdAt','\x20balance\x20updated:\x20','ceil','getAllUsers','✅\x20Payout\x20created:\x20','6794161DDCIPK','adminNotes','lte','map','count','AdminService','gatewayCommissionRate','deletePayout','orderId','gatewayEarnings','🎯\x20updateUser\x20called\x20with\x20ID:\x20','awaitingPayout','gte','chargebackAmount','gateways','\x20\x20\x20Balance:\x20','Noda','\x20\x20\x20💳\x20Total\x20payments:\x20'];a40_0x58a4=function(){return _0x579865;};return a40_0x58a4();}exports['AdminService']=AdminService;