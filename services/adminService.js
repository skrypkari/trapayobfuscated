'use strict';const a35_0x5ad2e2=a35_0x4ea0;(function(_0x205ed6,_0xf824cd){const _0x3f513c=a35_0x4ea0,_0x52f90d=_0x205ed6();while(!![]){try{const _0x1b4415=-parseInt(_0x3f513c(0x21e))/0x1*(-parseInt(_0x3f513c(0x1a0))/0x2)+-parseInt(_0x3f513c(0x172))/0x3+-parseInt(_0x3f513c(0x1db))/0x4+parseInt(_0x3f513c(0x1b1))/0x5*(-parseInt(_0x3f513c(0x1dd))/0x6)+parseInt(_0x3f513c(0x1c1))/0x7*(-parseInt(_0x3f513c(0x168))/0x8)+-parseInt(_0x3f513c(0x1ff))/0x9*(parseInt(_0x3f513c(0x1b3))/0xa)+parseInt(_0x3f513c(0x210))/0xb*(parseInt(_0x3f513c(0x182))/0xc);if(_0x1b4415===_0xf824cd)break;else _0x52f90d['push'](_0x52f90d['shift']());}catch(_0x4bdb27){_0x52f90d['push'](_0x52f90d['shift']());}}}(a35_0x5988,0xce2f5));var __importDefault=this&&this[a35_0x5ad2e2(0x1cd)]||function(_0x1127a8){const _0x5759c7=a35_0x5ad2e2;return _0x1127a8&&_0x1127a8[_0x5759c7(0x16c)]?_0x1127a8:{'default':_0x1127a8};};Object[a35_0x5ad2e2(0x251)](exports,a35_0x5ad2e2(0x16c),{'value':!![]}),exports[a35_0x5ad2e2(0x177)]=void 0x0;function a35_0x4ea0(_0x5d5d90,_0x2be2a6){const _0x5988a0=a35_0x5988();return a35_0x4ea0=function(_0x4ea0d2,_0x864a58){_0x4ea0d2=_0x4ea0d2-0x140;let _0x43685d=_0x5988a0[_0x4ea0d2];return _0x43685d;},a35_0x4ea0(_0x5d5d90,_0x2be2a6);}const database_1=__importDefault(require(a35_0x5ad2e2(0x1d3))),bcryptjs_1=__importDefault(require(a35_0x5ad2e2(0x212))),crypto_1=__importDefault(require(a35_0x5ad2e2(0x145))),currencyService_1=require(a35_0x5ad2e2(0x1c8)),gateway_1=require(a35_0x5ad2e2(0x249));function a35_0x5988(){const _0x2941c1=['\x20for\x20shop\x20','count','commission','merchantUrl','paymentGateways','\x20\x20\x20üíµ\x20Available\x20balance:\x20','availableBalance','statusChangedAt','usdtErcWallet','\x20\x20\x20Payout\x20amount:\x20','payout','findMany','toLowerCase','KLYME\x20GB','getMerchantsAwaitingPayout','üí∏\x20CHARGEBACK:\x20Merchant\x20amount\x20already\x20deducted\x20from\x20balance','updateCustomerData','period','_count','getFullYear','txid','sk_','month','hex','wallets','121689KCjcHz','dailyPayments','\x20\x20\x20Balance:\x20','activateUser','trc20','\x20\x20\x20üí∏\x20Total\x20payouts\x20(all\x20time):\x20','successUrl','set','\x20\x20\x20Merchant\x20loses:\x20','polygon','generateDailyStatistics','week','stringify','‚úÖ\x20Using\x20gateway\x20filter:\x20\x27','gatewayOrderId','\x20\x20\x20Total\x20paid\x20out:\x20','get','7689AZfbjz','\x20USDT,\x20Requested:\x20','bcryptjs','üìä\x20Getting\x20merchant\x20statistics\x20with\x20filters:','üîÑ\x20Converted\x20gateway\x20name\x20\x27','\x20paid\x20payments\x20for\x20analysis','commissionUSDT','%\x20commission)','KLYME\x20DE','üìä\x20Merchant\x20statistics\x20calculated:','amount','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','erc20','\x27\x20->\x20name\x20\x27','31392rchwNO','aggregate','Insufficient\x20balance.\x20Available:\x20','updatePaymentStatus','randomBytes','averageCheckUSDT','log','date','SUSPENDED','merchantEarnings','statusChangedBy','\x20\x20\x20üåç\x20Country:\x20','üí∞\x20[PAYOUT]\x20Merchant\x20','totalPaidOut','üí±\x20Currency\x20filter\x20applied:\x20','\x20USDT\x20(theoretical\x20net)','failureMessage','_sum','amountUSDT','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','asc','\x20USDT\x20(after\x20payouts)','updatedAt','deletePayout','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','dateTo','deleteUser','customerIp','üìä\x20Payout\x20statistics\x20calculated:','\x20merchants\x20with\x20positive\x20balance','desc','\x20no\x20longer\x20PAID:','totalPayout','map','\x20\x20\x20‚úÖ\x20Actual\x20available\x20balance:\x20','\x20\x20\x20üè™\x20Gateway\x20earnings:\x20','üìä\x20Available\x20gateways\x20in\x20database:','\x20\x20\x20üìÖ\x20This\x20month:\x20','custom','customerName','revenue','delete','gte','../types/gateway','\x20\x20\x20ÔøΩ\x20Total\x20payments\x20turnover:\x20','push','telegramId','\x20USDT\x20(-','whiteUrl','gatewayEarnings','üîÑ\x20Updating\x20customer\x20data\x20for\x20payment\x20','defineProperty','length','some','üìä\x20Gateway\x20filter\x20applied:','awaitingPayout','localeCompare','\x20\x20\x20üë§\x20Merchant\x20earnings:\x20','merchantEarningsUSDT','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','\x27\x20(from\x20\x27','convertToUSDT','CHARGEBACK','Plisio','admin','toUpperCase','totalAmountUSDT','dateFrom','not\x20set','getGatewayDisplayName','\x20\x20\x20üìÖ\x20Total\x20payouts\x20(this\x20month):\x20','üìã\x20Found\x20','publicKey','\x20order','crypto','test_gateway','üí∞\x20Payment\x20','notes','\x20USDT','getPayoutById','totalCommissionRate','30d','groupBy','üí∞\x20Creating\x20payout\x20for\x20shop\x20','usdtTrcWallet','üí∞\x20Shop\x20','\x20USDT)','reduce','üí∞\x20Found\x20','$transaction','\x20USDT\x20(total\x20paid\x20to\x20merchants)','create','Payment\x20not\x20found','\x20\x20\x20Current\x20balance:\x20','fullName','getMerchantsSelection','sort','\x20\x20\x20Added\x20to\x20balance:\x20+','findFirst','customerCountry','\x20\x20\x20üí∞\x20Total\x20payments\x20turnover:\x20','üîç\x20Using\x20gateway\x20\x27','üìÖ\x20Period\x20\x27all\x27:\x20Using\x20start\x20date\x20from\x20first\x20payment:\x20','insensitive','\x20USDT\x20(gross\x20revenue)','\x20payments)','round','üí∞\x20Current\x20shop\x20balance:\x20','adminNotes','8402088kbYCpi','entries','values','paidOutUSDT','__esModule','\x20\x20\x20Gateway:\x20','paidAt','setDate','\x20\x20\x20üí∞\x20Total\x20payout:\x20','üìä\x20Sorting\x20payments\x20by\x20','910131ldUnUW','pk_','üìã\x20Getting\x20merchants\x20selection\x20list...','findUnique','KLYME\x20EU','AdminService','\x20->\x20','updateUser','turnover','‚úÖ\x20Customer\x20data\x20updated\x20for\x20payment\x20','hash','username','turnoverUSDT','üìä\x20Calculating\x20payout\x20statistics...','forEach','Noda','49164lzqlGo','ceil','Test\x20Gateway','90d','totalAmountAfterCommissionUSDT','currency','‚ö†Ô∏è\x20Gateway\x20\x27','shop','\x20balance\x20updated:','\x20\x20\x20Transaction\x20hash:\x20','\x20USDT\x20(after\x20','name','getPaymentById','‚ö†Ô∏è\x20Requested\x20gateway\x20\x27','gateways','üîÑ\x20Admin\x20updating\x20payment\x20','\x20\x20\x20üîç\x20Raw\x20balance\x20sum:\x20','shopId','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','\x20USDT\x20(same\x20as\x20awaiting)','createUser','split','‚úÖ\x20Payout\x20created:\x20','all','\x20in\x20','createPayout','CoinToPay','üìä\x20Merchants\x20awaiting\x20payout:\x20','\x20to\x20','shopUrl','96kbpxwu','getTime','currencyService','amountAfterCommissionUSDT','Rapyd','getMerchantStatistics',':\x20commission\x20=\x20','\x20\x20\x20üñ•Ô∏è\x20User\x20Agent:\x20','customerEmail','paymentsCount','createdAt','\x20became\x20PAID:','toString','\x20USDT\x20(actual\x20balances)','periodTo','toFixed','getGatewayNameById','1221155conjge','telegram','10EqLjHu','getDate','REFUND','averageCommissionRate','\x20USDT\x20(+','\x20\x20\x20‚úÖ\x20Total\x20available\x20for\x20payout:\x20','periodFrom','includes','lte','polygon_usdc','update','customerUa','balance','2020-01-01','7NbEiNt','üìÖ\x20Period:\x20','default','gatewaySettings','PAID','COMPLETED','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','./currencyService','not\x20specified','getAllPayouts','payment','\x20\x20\x20üí≥\x20Total\x20payments:\x20','__importDefault','password','\x27\x20->\x20ID\x20\x27','status','usdtPolygonWallet','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','../config/database','üìä\x20Final\x20WHERE\x20conditions:','usdcPolygonWallet','\x20balance\x20updated:\x20','error',',\x20Commission:\x20','getMonth','ACTIVE','4728012XBUMtK','chargebackAmount','24BbMFad','gateway','\x20\x20\x20üìä\x20Commission\x20difference:\x20','parse','network','thisMonth','toISOString','\x20\x20\x20üåê\x20IP:\x20','\x20status:\x20'];a35_0x5988=function(){return _0x2941c1;};return a35_0x5988();}class AdminService{async['getPayoutStats'](){const _0x2ff9c6=a35_0x5ad2e2;console[_0x2ff9c6(0x224)](_0x2ff9c6(0x17f));const _0x1019d4=await database_1['default'][_0x2ff9c6(0x189)]['aggregate']({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x2ff9c6(0x1da)}}),_0x5439a3=await this[_0x2ff9c6(0x1f4)]({'page':0x1,'limit':0x3e8}),_0x5dc115=await database_1[_0x2ff9c6(0x1c3)][_0x2ff9c6(0x1cb)]['count']({'where':{'status':'PAID','gateway':{'not':_0x2ff9c6(0x146)}}}),_0x23bf06=new Date(),_0x4bfd24=new Date(_0x23bf06[_0x2ff9c6(0x1f9)](),_0x23bf06[_0x2ff9c6(0x1d9)](),0x1),_0x6dece0=new Date(_0x23bf06[_0x2ff9c6(0x1f9)](),_0x23bf06[_0x2ff9c6(0x1d9)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x435531=await database_1[_0x2ff9c6(0x1c3)]['payout'][_0x2ff9c6(0x21f)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x4bfd24,'lte':_0x6dece0},'status':_0x2ff9c6(0x1c6)}}),_0x4be09c=_0x1019d4[_0x2ff9c6(0x22f)][_0x2ff9c6(0x22b)]||0x0,_0x5a1931=_0x5439a3['summary'][_0x2ff9c6(0x186)],_0x4f54e3=_0x435531[_0x2ff9c6(0x22f)]['amount']||0x0,_0x1636e3={'totalPayout':Math[_0x2ff9c6(0x165)](_0x4be09c*0x64)/0x64,'awaitingPayout':Math[_0x2ff9c6(0x165)](_0x5a1931*0x64)/0x64,'thisMonth':Math[_0x2ff9c6(0x165)](_0x4f54e3*0x64)/0x64,'availableBalance':Math[_0x2ff9c6(0x165)](_0x5a1931*0x64)/0x64,'totalPayments':_0x5dc115};return console[_0x2ff9c6(0x224)](_0x2ff9c6(0x23a)),console['log'](_0x2ff9c6(0x170)+_0x1636e3[_0x2ff9c6(0x23e)]+_0x2ff9c6(0x155)),console[_0x2ff9c6(0x224)]('\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20'+_0x1636e3[_0x2ff9c6(0x255)]+'\x20USDT\x20(with\x20commission\x20deducted)'),console['log'](_0x2ff9c6(0x1eb)+_0x1636e3[_0x2ff9c6(0x1ec)]+_0x2ff9c6(0x195)),console[_0x2ff9c6(0x224)](_0x2ff9c6(0x243)+_0x1636e3[_0x2ff9c6(0x1e2)]+_0x2ff9c6(0x149)),console[_0x2ff9c6(0x224)](_0x2ff9c6(0x1cc)+_0x1636e3['totalPayments']+'\x20PAID\x20payments'),console[_0x2ff9c6(0x224)](_0x2ff9c6(0x192)+(_0x1019d4[_0x2ff9c6(0x22f)][_0x2ff9c6(0x1bf)]||0x0)[_0x2ff9c6(0x1af)](0x2)+'\x20USDT\x20(without\x20commission)'),console[_0x2ff9c6(0x224)](_0x2ff9c6(0x1df)+((_0x1019d4[_0x2ff9c6(0x22f)][_0x2ff9c6(0x1bf)]||0x0)-_0x5a1931)['toFixed'](0x2)+'\x20USDT'),_0x1636e3;}async[a35_0x5ad2e2(0x1f6)](_0x52de38,_0x1b06b8){const _0x3309c6=a35_0x5ad2e2;console[_0x3309c6(0x224)](_0x3309c6(0x250)+_0x52de38+':',_0x1b06b8);const _0x21b23e=await database_1['default']['payment'][_0x3309c6(0x175)]({'where':{'id':_0x52de38},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x21b23e)throw new Error(_0x3309c6(0x157));const _0x1cc0ed={};_0x1b06b8['customerCountry']!==undefined&&(_0x1cc0ed['customerCountry']=_0x1b06b8[_0x3309c6(0x15e)]||null);_0x1b06b8['customerIp']!==undefined&&(_0x1cc0ed[_0x3309c6(0x239)]=_0x1b06b8[_0x3309c6(0x239)]||null);_0x1b06b8[_0x3309c6(0x1be)]!==undefined&&(_0x1cc0ed[_0x3309c6(0x1be)]=_0x1b06b8[_0x3309c6(0x1be)]||null);const _0x42b4a7=await database_1['default']['payment'][_0x3309c6(0x1bd)]({'where':{'id':_0x52de38},'data':{..._0x1cc0ed,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x3309c6(0x224)](_0x3309c6(0x17b)+_0x52de38),console[_0x3309c6(0x224)](_0x3309c6(0x229)+_0x21b23e[_0x3309c6(0x15e)]+_0x3309c6(0x178)+_0x42b4a7['customerCountry']),console[_0x3309c6(0x224)](_0x3309c6(0x1e4)+_0x21b23e['customerIp']+'\x20->\x20'+_0x42b4a7[_0x3309c6(0x239)]),console['log'](_0x3309c6(0x1a7)+(_0x21b23e[_0x3309c6(0x1be)]?'set':_0x3309c6(0x262))+_0x3309c6(0x178)+(_0x42b4a7['customerUa']?_0x3309c6(0x206):_0x3309c6(0x262))),_0x42b4a7;}async['getSystemStatistics'](_0x14c79e){const _0xdba491=a35_0x5ad2e2,_0x23ea8d=new Date();let _0x1ba06f;switch(_0x14c79e){case'7d':_0x1ba06f=new Date(_0x23ea8d[_0xdba491(0x1a1)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0xdba491(0x14c):_0x1ba06f=new Date(_0x23ea8d[_0xdba491(0x1a1)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0xdba491(0x185):_0x1ba06f=new Date(_0x23ea8d['getTime']()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0xdba491(0x199):const _0x54a49a=await database_1[_0xdba491(0x1c3)][_0xdba491(0x1cb)][_0xdba491(0x15d)]({'where':{'gateway':{'not':'test_gateway'}},'orderBy':{'createdAt':_0xdba491(0x232)},'select':{'createdAt':!![]}});_0x1ba06f=_0x54a49a?_0x54a49a['createdAt']:new Date(_0xdba491(0x1c0)),console[_0xdba491(0x224)](_0xdba491(0x161)+_0x1ba06f[_0xdba491(0x1e3)]());break;default:_0x1ba06f=new Date(_0x23ea8d[_0xdba491(0x1a1)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x12b5a4,_0x20efb1,_0x6fb07f,_0xbf5500,_0x3f2b9b,_0x36e898,_0x2dee03]=await Promise['all']([database_1['default'][_0xdba491(0x189)][_0xdba491(0x1e7)](),database_1[_0xdba491(0x1c3)][_0xdba491(0x189)][_0xdba491(0x1e7)]({'where':{'status':_0xdba491(0x1da)}}),database_1[_0xdba491(0x1c3)]['payment'][_0xdba491(0x1e7)]({'where':{'createdAt':{'gte':_0x1ba06f},'gateway':{'not':_0xdba491(0x146)}}}),database_1[_0xdba491(0x1c3)][_0xdba491(0x1cb)][_0xdba491(0x1e7)]({'where':{'status':_0xdba491(0x1c5),'createdAt':{'gte':_0x1ba06f},'gateway':{'not':'test_gateway'}}}),database_1[_0xdba491(0x1c3)][_0xdba491(0x1cb)][_0xdba491(0x1f1)]({'where':{'status':'PAID','createdAt':{'gte':_0x1ba06f},'gateway':{'not':_0xdba491(0x146)}},'select':{'amount':!![],'currency':!![]}}),database_1[_0xdba491(0x1c3)]['payment'][_0xdba491(0x1f1)]({'where':{'gateway':{'not':_0xdba491(0x146)}},'take':0xa,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0xdba491(0x1c3)][_0xdba491(0x1cb)][_0xdba491(0x1f1)]({'where':{'createdAt':{'gte':_0x1ba06f},'gateway':{'not':_0xdba491(0x146)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x231182=0x0;for(const _0x2d05d0 of _0x3f2b9b){const _0x11cf08=await currencyService_1['currencyService'][_0xdba491(0x25b)](_0x2d05d0[_0xdba491(0x21a)],_0x2d05d0[_0xdba491(0x187)]);_0x231182+=_0x11cf08;}const _0x5f4426=this['generateDailyStatistics'](_0x2dee03,_0x1ba06f,_0x23ea8d),_0x1237e8=_0x6fb07f>0x0?_0xbf5500/_0x6fb07f*0x64:0x0;return{'totalShops':_0x12b5a4,'activeShops':_0x20efb1,'totalPayments':_0x6fb07f,'successfulPayments':_0xbf5500,'totalRevenue':Math['round'](_0x231182*0x64)/0x64,'conversionRate':Math[_0xdba491(0x165)](_0x1237e8*0x64)/0x64,'dailyRevenue':_0x5f4426['dailyRevenue'],'dailyPayments':_0x5f4426[_0xdba491(0x200)],'recentPayments':_0x36e898['map'](_0x5b5cef=>({'id':_0x5b5cef['id'],'amount':_0x5b5cef[_0xdba491(0x21a)],'currency':_0x5b5cef[_0xdba491(0x187)],'status':_0x5b5cef[_0xdba491(0x1d0)],'gateway':_0x5b5cef[_0xdba491(0x1de)],'shop':_0x5b5cef[_0xdba491(0x189)],'createdAt':_0x5b5cef[_0xdba491(0x1aa)]}))};}async[a35_0x5ad2e2(0x1a5)](_0x5bc686){const _0x4b1f8a=a35_0x5ad2e2;console['log'](_0x4b1f8a(0x213),_0x5bc686);let _0x4f4ec3,_0x43bee6=new Date();if(_0x5bc686[_0x4b1f8a(0x1f7)]===_0x4b1f8a(0x244)&&_0x5bc686[_0x4b1f8a(0x261)]&&_0x5bc686[_0x4b1f8a(0x237)])_0x4f4ec3=new Date(_0x5bc686[_0x4b1f8a(0x261)]),_0x43bee6=new Date(_0x5bc686['dateTo']);else{const _0x245d4e=new Date();switch(_0x5bc686[_0x4b1f8a(0x1f7)]){case _0x4b1f8a(0x20a):_0x4f4ec3=new Date(_0x245d4e[_0x4b1f8a(0x1a1)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x4b1f8a(0x1fc):_0x4f4ec3=new Date(_0x245d4e[_0x4b1f8a(0x1a1)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'year':_0x4f4ec3=new Date(_0x245d4e[_0x4b1f8a(0x1a1)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x4b1f8a(0x199):default:_0x4f4ec3=new Date(_0x4b1f8a(0x1c0));break;}}console[_0x4b1f8a(0x224)](_0x4b1f8a(0x1c2)+_0x4f4ec3['toISOString']()+_0x4b1f8a(0x19e)+_0x43bee6[_0x4b1f8a(0x1e3)]());const _0x310029={'status':_0x4b1f8a(0x1c5),'gateway':{'not':'test_gateway'},'paidAt':{'gte':_0x4f4ec3,'lte':_0x43bee6}};_0x5bc686[_0x4b1f8a(0x193)]&&(_0x310029[_0x4b1f8a(0x193)]=_0x5bc686[_0x4b1f8a(0x193)]);const _0xa5e60c=await database_1[_0x4b1f8a(0x1c3)][_0x4b1f8a(0x1cb)]['findMany']({'where':_0x310029,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console['log']('üí∞\x20Found\x20'+_0xa5e60c[_0x4b1f8a(0x252)]+_0x4b1f8a(0x215));const _0x3bc205={'gateway':{'not':_0x4b1f8a(0x146)},'createdAt':{'gte':_0x4f4ec3,'lte':_0x43bee6}};_0x5bc686['shopId']&&(_0x3bc205[_0x4b1f8a(0x193)]=_0x5bc686['shopId']);const _0x139322=await database_1[_0x4b1f8a(0x1c3)]['payment'][_0x4b1f8a(0x1e7)]({'where':_0x3bc205});console[_0x4b1f8a(0x224)]('üìä\x20Total\x20payments\x20(including\x20failed):\x20'+_0x139322+',\x20successful:\x20'+_0xa5e60c[_0x4b1f8a(0x252)]);let _0x43bb7e=0x0,_0x1dcf28=0x0,_0x2750f3=0x0;const _0x1026ec={},_0x547264={},_0x113994={};for(const _0x26165f of _0xa5e60c){try{const _0x1c8dfa=await currencyService_1['currencyService']['convertToUSDT'](_0x26165f['amount'],_0x26165f[_0x4b1f8a(0x187)]);let _0x3c5d22={};if(_0x26165f[_0x4b1f8a(0x189)][_0x4b1f8a(0x1c4)])try{_0x3c5d22=JSON[_0x4b1f8a(0x1e0)](_0x26165f['shop'][_0x4b1f8a(0x1c4)]);}catch(_0x38d319){console[_0x4b1f8a(0x1d7)](_0x4b1f8a(0x1c7)+_0x26165f[_0x4b1f8a(0x193)]+':',_0x38d319);}let _0x11c752={},_0x4d7be1=0xa;for(const [_0x4fb25c,_0x32de91]of Object[_0x4b1f8a(0x169)](_0x3c5d22)){if(_0x4fb25c[_0x4b1f8a(0x1f2)]()===_0x26165f['gateway'][_0x4b1f8a(0x1f2)]()){_0x11c752=_0x32de91,_0x4d7be1=_0x32de91['commission']||0xa;break;}}const _0x109532=_0x1c8dfa*(_0x4d7be1/0x64),_0x5a1388=_0x1c8dfa-_0x109532;_0x43bb7e+=_0x1c8dfa,_0x1dcf28+=_0x5a1388,_0x2750f3+=_0x109532;!_0x1026ec[_0x26165f[_0x4b1f8a(0x1de)]]&&(_0x1026ec[_0x26165f['gateway']]={'gateway':_0x26165f[_0x4b1f8a(0x1de)],'gatewayDisplayName':this[_0x4b1f8a(0x140)](_0x26165f[_0x4b1f8a(0x1de)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x1026ec[_0x26165f[_0x4b1f8a(0x1de)]]['paymentsCount']++,_0x1026ec[_0x26165f[_0x4b1f8a(0x1de)]]['turnoverUSDT']+=_0x1c8dfa,_0x1026ec[_0x26165f[_0x4b1f8a(0x1de)]][_0x4b1f8a(0x216)]+=_0x109532,_0x1026ec[_0x26165f['gateway']][_0x4b1f8a(0x258)]+=_0x5a1388,_0x1026ec[_0x26165f[_0x4b1f8a(0x1de)]][_0x4b1f8a(0x14b)]+=_0x4d7be1;!_0x5bc686[_0x4b1f8a(0x193)]&&(!_0x547264[_0x26165f['shopId']]&&(_0x547264[_0x26165f['shopId']]={'shopId':_0x26165f[_0x4b1f8a(0x193)],'shopName':_0x26165f[_0x4b1f8a(0x189)][_0x4b1f8a(0x18d)],'shopUsername':_0x26165f[_0x4b1f8a(0x189)]['username'],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x547264[_0x26165f[_0x4b1f8a(0x193)]]['paymentsCount']++,_0x547264[_0x26165f[_0x4b1f8a(0x193)]][_0x4b1f8a(0x17e)]+=_0x1c8dfa,_0x547264[_0x26165f['shopId']]['commissionUSDT']+=_0x109532,_0x547264[_0x26165f[_0x4b1f8a(0x193)]]['merchantEarningsUSDT']+=_0x5a1388);const _0xa9287c=_0x26165f[_0x4b1f8a(0x16e)][_0x4b1f8a(0x1e3)]()[_0x4b1f8a(0x197)]('T')[0x0];!_0x113994[_0xa9287c]&&(_0x113994[_0xa9287c]={'date':_0xa9287c,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x113994[_0xa9287c]['turnover']+=_0x1c8dfa,_0x113994[_0xa9287c][_0x4b1f8a(0x227)]+=_0x5a1388,_0x113994[_0xa9287c][_0x4b1f8a(0x24f)]+=_0x109532,_0x113994[_0xa9287c][_0x4b1f8a(0x1a9)]++;}catch(_0x2ca973){console[_0x4b1f8a(0x1d7)]('Error\x20processing\x20payment\x20'+_0x26165f['id']+':',_0x2ca973);}}Object['values'](_0x1026ec)[_0x4b1f8a(0x180)](_0x3a72c3=>{const _0x1cefd3=_0x4b1f8a;_0x3a72c3[_0x1cefd3(0x1b6)]=_0x3a72c3['paymentsCount']>0x0?_0x3a72c3[_0x1cefd3(0x14b)]/_0x3a72c3['paymentsCount']:0x0,delete _0x3a72c3[_0x1cefd3(0x14b)];}),Object[_0x4b1f8a(0x16a)](_0x547264)[_0x4b1f8a(0x180)](_0x333ace=>{const _0x10aff6=_0x4b1f8a;_0x333ace[_0x10aff6(0x223)]=_0x333ace[_0x10aff6(0x1a9)]>0x0?_0x333ace[_0x10aff6(0x17e)]/_0x333ace[_0x10aff6(0x1a9)]:0x0;});let _0x2f217b=0x0;if(_0x5bc686[_0x4b1f8a(0x193)]){const _0x443c65=await database_1['default']['payout'][_0x4b1f8a(0x1f1)]({'where':{'shopId':_0x5bc686[_0x4b1f8a(0x193)],'status':_0x4b1f8a(0x1c6),'createdAt':{'gte':_0x4f4ec3,'lte':_0x43bee6}},'select':{'amount':!![]}});_0x2f217b=_0x443c65['reduce']((_0x3085c3,_0x1058e9)=>_0x3085c3+_0x1058e9[_0x4b1f8a(0x21a)],0x0);}const _0x3fe463=_0x139322,_0x1e3445=_0xa5e60c['length'],_0x727207=_0x1e3445>0x0?_0x43bb7e/_0x1e3445:0x0,_0x5ddc10=_0x3fe463>0x0?Math[_0x4b1f8a(0x165)](_0x1e3445/_0x3fe463*0x2710)/0x64:0x0,_0x590b42=Math[_0x4b1f8a(0x183)]((_0x43bee6['getTime']()-_0x4f4ec3[_0x4b1f8a(0x1a1)]())/(0x3e8*0x3c*0x3c*0x18)),_0xa4fca3={'totalTurnover':Math[_0x4b1f8a(0x165)](_0x43bb7e*0x64)/0x64,'merchantEarnings':Math[_0x4b1f8a(0x165)](_0x1dcf28*0x64)/0x64,'gatewayEarnings':Math['round'](_0x2750f3*0x64)/0x64,'totalPaidOut':Math[_0x4b1f8a(0x165)](_0x2f217b*0x64)/0x64,'averageCheck':Math['round'](_0x727207*0x64)/0x64,'totalPayments':_0x3fe463,'successfulPayments':_0x1e3445,'conversionRate':_0x5ddc10,'gatewayBreakdown':Object[_0x4b1f8a(0x16a)](_0x1026ec)[_0x4b1f8a(0x23f)](_0x5e9e60=>({..._0x5e9e60,'turnoverUSDT':Math[_0x4b1f8a(0x165)](_0x5e9e60[_0x4b1f8a(0x17e)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x5e9e60[_0x4b1f8a(0x216)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x4b1f8a(0x165)](_0x5e9e60[_0x4b1f8a(0x258)]*0x64)/0x64,'averageCommissionRate':Math[_0x4b1f8a(0x165)](_0x5e9e60[_0x4b1f8a(0x1b6)]*0x64)/0x64})),'merchantBreakdown':_0x5bc686[_0x4b1f8a(0x193)]?undefined:Object[_0x4b1f8a(0x16a)](_0x547264)[_0x4b1f8a(0x23f)](_0x486fa2=>({..._0x486fa2,'turnoverUSDT':Math[_0x4b1f8a(0x165)](_0x486fa2[_0x4b1f8a(0x17e)]*0x64)/0x64,'commissionUSDT':Math[_0x4b1f8a(0x165)](_0x486fa2[_0x4b1f8a(0x216)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x486fa2['merchantEarningsUSDT']*0x64)/0x64,'paidOutUSDT':Math[_0x4b1f8a(0x165)](_0x486fa2[_0x4b1f8a(0x16b)]*0x64)/0x64,'averageCheckUSDT':Math['round'](_0x486fa2[_0x4b1f8a(0x223)]*0x64)/0x64})),'dailyData':Object[_0x4b1f8a(0x16a)](_0x113994)['map'](_0x2079e3=>({..._0x2079e3,'turnover':Math[_0x4b1f8a(0x165)](_0x2079e3[_0x4b1f8a(0x17a)]*0x64)/0x64,'merchantEarnings':Math[_0x4b1f8a(0x165)](_0x2079e3[_0x4b1f8a(0x227)]*0x64)/0x64,'gatewayEarnings':Math[_0x4b1f8a(0x165)](_0x2079e3[_0x4b1f8a(0x24f)]*0x64)/0x64}))[_0x4b1f8a(0x15b)]((_0x45b7d2,_0x49f97d)=>_0x45b7d2['date'][_0x4b1f8a(0x256)](_0x49f97d[_0x4b1f8a(0x225)])),'periodInfo':{'from':_0x4f4ec3,'to':_0x43bee6,'periodType':_0x5bc686[_0x4b1f8a(0x1f7)]||_0x4b1f8a(0x244),'daysCount':_0x590b42}};return console[_0x4b1f8a(0x224)](_0x4b1f8a(0x219)),console[_0x4b1f8a(0x224)]('\x20\x20\x20üí∞\x20Total\x20turnover:\x20'+_0xa4fca3['totalTurnover']+_0x4b1f8a(0x149)),console[_0x4b1f8a(0x224)](_0x4b1f8a(0x257)+_0xa4fca3[_0x4b1f8a(0x227)]+'\x20USDT'),console['log'](_0x4b1f8a(0x241)+_0xa4fca3[_0x4b1f8a(0x24f)]+_0x4b1f8a(0x149)),console[_0x4b1f8a(0x224)]('\x20\x20\x20üìä\x20Total\x20payments:\x20'+_0xa4fca3['totalPayments']),_0xa4fca3;}async[a35_0x5ad2e2(0x15a)](){const _0x4cc85d=a35_0x5ad2e2;console['log'](_0x4cc85d(0x174));const _0x1bd6ff=await database_1[_0x4cc85d(0x1c3)][_0x4cc85d(0x189)][_0x4cc85d(0x1f1)]({'where':{'status':_0x4cc85d(0x1da)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':'asc'}});return console[_0x4cc85d(0x224)](_0x4cc85d(0x142)+_0x1bd6ff[_0x4cc85d(0x252)]+'\x20active\x20merchants\x20for\x20selection'),_0x1bd6ff[_0x4cc85d(0x23f)](_0x17374b=>({'id':_0x17374b['id'],'username':_0x17374b[_0x4cc85d(0x17d)],'name':_0x17374b['name']}));}[a35_0x5ad2e2(0x140)](_0x4c5a4e){const _0x2cc53d=a35_0x5ad2e2,_0x5e864f={'test_gateway':_0x2cc53d(0x184),'plisio':_0x2cc53d(0x25d),'rapyd':_0x2cc53d(0x1a4),'noda':_0x2cc53d(0x181),'cointopay':_0x2cc53d(0x19c),'klyme_eu':_0x2cc53d(0x176),'klyme_gb':_0x2cc53d(0x1f3),'klyme_de':_0x2cc53d(0x218)};return _0x5e864f[_0x4c5a4e]||_0x4c5a4e;}async[a35_0x5ad2e2(0x1f4)](_0x79798f){const _0x4c2cee=a35_0x5ad2e2,{page:_0x57273e,limit:_0x31c94f,minAmount:_0x40d646,search:_0x57284e}=_0x79798f,_0x4dfb93=(_0x57273e-0x1)*_0x31c94f;console[_0x4c2cee(0x224)]('üìä\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:',_0x79798f);const _0x205490={'balance':{'gt':0x0},'status':_0x4c2cee(0x1da)};_0x40d646&&(_0x205490[_0x4c2cee(0x1bf)]['gte']=_0x40d646);_0x57284e&&(_0x205490['OR']=[{'name':{'contains':_0x57284e,'mode':_0x4c2cee(0x162)}},{'username':{'contains':_0x57284e,'mode':_0x4c2cee(0x162)}}]);const [_0x2dcf63,_0x1f10fb]=await Promise['all']([database_1[_0x4c2cee(0x1c3)][_0x4c2cee(0x189)][_0x4c2cee(0x1f1)]({'where':_0x205490,'skip':_0x4dfb93,'take':_0x31c94f,'orderBy':{'balance':_0x4c2cee(0x23c)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1[_0x4c2cee(0x1c3)][_0x4c2cee(0x189)][_0x4c2cee(0x1e7)]({'where':_0x205490})]);console[_0x4c2cee(0x224)](_0x4c2cee(0x153)+_0x2dcf63[_0x4c2cee(0x252)]+_0x4c2cee(0x23b));const _0x11359b=await Promise['all'](_0x2dcf63[_0x4c2cee(0x23f)](async _0x5f4c3a=>{const _0x1a1b6d=_0x4c2cee,[_0x5302dd,_0x45f1a3,_0x379e70]=await Promise[_0x1a1b6d(0x199)]([database_1[_0x1a1b6d(0x1c3)][_0x1a1b6d(0x1cb)][_0x1a1b6d(0x1e7)]({'where':{'shopId':_0x5f4c3a['id'],'status':_0x1a1b6d(0x1c5),'gateway':{'not':_0x1a1b6d(0x146)}}}),database_1[_0x1a1b6d(0x1c3)][_0x1a1b6d(0x1cb)][_0x1a1b6d(0x15d)]({'where':{'shopId':_0x5f4c3a['id'],'status':_0x1a1b6d(0x1c5),'gateway':{'not':_0x1a1b6d(0x146)}},'orderBy':{'paidAt':_0x1a1b6d(0x232)},'select':{'paidAt':!![]}}),database_1[_0x1a1b6d(0x1c3)][_0x1a1b6d(0x1cb)][_0x1a1b6d(0x14d)]({'by':[_0x1a1b6d(0x1de)],'where':{'shopId':_0x5f4c3a['id'],'status':_0x1a1b6d(0x1c5),'gateway':{'not':_0x1a1b6d(0x146)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x12c0a9=new Date(),_0x43fb0f=new Date(_0x12c0a9[_0x1a1b6d(0x1f9)](),_0x12c0a9[_0x1a1b6d(0x1d9)](),0x1),_0xb88a07=new Date(_0x12c0a9[_0x1a1b6d(0x1f9)](),_0x12c0a9[_0x1a1b6d(0x1d9)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x1b3f12,_0x428f1b]=await Promise[_0x1a1b6d(0x199)]([database_1[_0x1a1b6d(0x1c3)][_0x1a1b6d(0x1f0)][_0x1a1b6d(0x21f)]({'_sum':{'amount':!![]},'where':{'shopId':_0x5f4c3a['id'],'status':_0x1a1b6d(0x1c6)}}),database_1[_0x1a1b6d(0x1c3)][_0x1a1b6d(0x1f0)][_0x1a1b6d(0x21f)]({'_sum':{'amount':!![]},'where':{'shopId':_0x5f4c3a['id'],'status':_0x1a1b6d(0x1c6),'createdAt':{'gte':_0x43fb0f,'lte':_0xb88a07}}})]),_0x3a1568=_0x1b3f12[_0x1a1b6d(0x22f)][_0x1a1b6d(0x21a)]||0x0,_0x431e20=_0x428f1b[_0x1a1b6d(0x22f)]['amount']||0x0,_0x34a93b=await Promise[_0x1a1b6d(0x199)](_0x379e70[_0x1a1b6d(0x23f)](async _0x5ea72d=>{const _0x4e3822=_0x1a1b6d;let _0x3f1cee=0xa;if(_0x5f4c3a[_0x4e3822(0x1c4)])try{const _0x5169b8=JSON[_0x4e3822(0x1e0)](_0x5f4c3a[_0x4e3822(0x1c4)]);for(const [_0x508a88,_0x497cd1]of Object[_0x4e3822(0x169)](_0x5169b8)){if(_0x508a88['toLowerCase']()===_0x5ea72d[_0x4e3822(0x1de)][_0x4e3822(0x1f2)]()){_0x3f1cee=_0x497cd1[_0x4e3822(0x1e8)]||0xa,console[_0x4e3822(0x224)]('üí∞\x20[PAYOUT]\x20Gateway\x20'+_0x5ea72d['gateway']+_0x4e3822(0x1e6)+_0x5f4c3a['id']+_0x4e3822(0x1a6)+_0x3f1cee+'%');break;}}}catch(_0x348f22){console[_0x4e3822(0x1d7)](_0x4e3822(0x1c7)+_0x5f4c3a['id']+':',_0x348f22);}const _0x2a2237=_0x5ea72d[_0x4e3822(0x22f)][_0x4e3822(0x230)]||0x0,_0x3877f1=_0x2a2237*(0x1-_0x3f1cee/0x64);return{'gateway':_0x5ea72d[_0x4e3822(0x1de)],'count':_0x5ea72d[_0x4e3822(0x1f8)]['id'],'amountUSDT':Math[_0x4e3822(0x165)](_0x2a2237*0x64)/0x64,'amountAfterCommissionUSDT':Math['round'](_0x3877f1*0x64)/0x64,'commission':_0x3f1cee};})),_0x3da994=_0x34a93b[_0x1a1b6d(0x152)]((_0x2fd181,_0x5b25ba)=>_0x2fd181+_0x5b25ba[_0x1a1b6d(0x230)],0x0),_0x191ef7=_0x5f4c3a[_0x1a1b6d(0x1bf)];return console[_0x1a1b6d(0x224)](_0x1a1b6d(0x22a)+_0x5f4c3a[_0x1a1b6d(0x17d)]+':'),console['log'](_0x1a1b6d(0x24a)+_0x3da994[_0x1a1b6d(0x1af)](0x2)+_0x1a1b6d(0x163)),console[_0x1a1b6d(0x224)]('\x20\x20\x20üîç\x20Calculated\x20after\x20commission:\x20'+_0x34a93b[_0x1a1b6d(0x152)]((_0x4b47e3,_0x2001b9)=>_0x4b47e3+_0x2001b9[_0x1a1b6d(0x1a3)],0x0)[_0x1a1b6d(0x1af)](0x2)+_0x1a1b6d(0x22d)),console[_0x1a1b6d(0x224)](_0x1a1b6d(0x240)+_0x191ef7[_0x1a1b6d(0x1af)](0x2)+_0x1a1b6d(0x233)),{'id':_0x5f4c3a['id'],'fullName':_0x5f4c3a[_0x1a1b6d(0x18d)],'username':_0x5f4c3a[_0x1a1b6d(0x17d)],'telegramId':_0x5f4c3a['telegram'],'merchantUrl':_0x5f4c3a[_0x1a1b6d(0x19f)],'wallets':{'usdtPolygonWallet':_0x5f4c3a[_0x1a1b6d(0x1d1)],'usdtTrcWallet':_0x5f4c3a[_0x1a1b6d(0x14f)],'usdtErcWallet':_0x5f4c3a[_0x1a1b6d(0x1ee)],'usdcPolygonWallet':_0x5f4c3a['usdcPolygonWallet']},'totalAmountUSDT':Math[_0x1a1b6d(0x165)](_0x3da994*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x191ef7*0x64)/0x64,'totalPayout':Math[_0x1a1b6d(0x165)](_0x3a1568*0x64)/0x64,'thisMonth':Math[_0x1a1b6d(0x165)](_0x431e20*0x64)/0x64,'paymentsCount':_0x5302dd,'oldestPaymentDate':_0x45f1a3?.[_0x1a1b6d(0x16e)]||_0x5f4c3a[_0x1a1b6d(0x1aa)],'gatewayBreakdown':_0x34a93b};})),_0x1487f1=_0x11359b[_0x4c2cee(0x152)]((_0x19d3dc,_0x1d5b84)=>_0x19d3dc+_0x1d5b84[_0x4c2cee(0x260)],0x0),_0x207c26=_0x11359b[_0x4c2cee(0x152)]((_0x24bbc9,_0x3a76bb)=>_0x24bbc9+_0x3a76bb[_0x4c2cee(0x186)],0x0),_0xb0ec0=_0x11359b[_0x4c2cee(0x152)]((_0x1fc2d1,_0x39f819)=>_0x1fc2d1+_0x39f819[_0x4c2cee(0x23e)],0x0),_0x2eb61c=_0x11359b[_0x4c2cee(0x152)]((_0x2239b7,_0x34f8ed)=>_0x2239b7+_0x34f8ed[_0x4c2cee(0x1e2)],0x0);return console[_0x4c2cee(0x224)](_0x4c2cee(0x19d)+_0x1f10fb+'\x20merchants'),console[_0x4c2cee(0x224)](_0x4c2cee(0x15f)+Math['round'](_0x1487f1*0x64)/0x64+_0x4c2cee(0x163)),console[_0x4c2cee(0x224)](_0x4c2cee(0x1b8)+Math[_0x4c2cee(0x165)](_0x207c26*0x64)/0x64+_0x4c2cee(0x1ad)),console[_0x4c2cee(0x224)](_0x4c2cee(0x204)+Math[_0x4c2cee(0x165)](_0xb0ec0*0x64)/0x64+_0x4c2cee(0x149)),console[_0x4c2cee(0x224)](_0x4c2cee(0x141)+Math[_0x4c2cee(0x165)](_0x2eb61c*0x64)/0x64+_0x4c2cee(0x149)),{'merchants':_0x11359b,'pagination':{'page':_0x57273e,'limit':_0x31c94f,'total':_0x1f10fb,'totalPages':Math[_0x4c2cee(0x183)](_0x1f10fb/_0x31c94f)},'summary':{'totalMerchants':_0x1f10fb,'totalAmountUSDT':Math[_0x4c2cee(0x165)](_0x1487f1*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x207c26*0x64)/0x64,'totalPayout':Math['round'](_0xb0ec0*0x64)/0x64,'thisMonth':Math[_0x4c2cee(0x165)](_0x2eb61c*0x64)/0x64}};}async[a35_0x5ad2e2(0x19b)](_0x3e91cf){const _0x3b3a32=a35_0x5ad2e2,{shopId:_0xfc6c79,amount:_0x5a1a11,network:_0xd9885f,wallet:_0x266d90,notes:_0x3be136,txid:_0x564341,periodFrom:_0x3e5ff3,periodTo:_0x1893f8}=_0x3e91cf,_0x5bd0dc=await database_1[_0x3b3a32(0x1c3)][_0x3b3a32(0x154)](async _0x568bee=>{const _0x37d892=_0x3b3a32,_0x295a93=await _0x568bee[_0x37d892(0x189)][_0x37d892(0x175)]({'where':{'id':_0xfc6c79},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x295a93)throw new Error('Shop\x20not\x20found');console[_0x37d892(0x224)](_0x37d892(0x14e)+_0x295a93[_0x37d892(0x17d)]+':'),console['log'](_0x37d892(0x158)+_0x295a93['balance'][_0x37d892(0x1af)](0x6)+_0x37d892(0x149)),console[_0x37d892(0x224)](_0x37d892(0x1ef)+_0x5a1a11['toFixed'](0x6)+_0x37d892(0x149)),console[_0x37d892(0x224)](_0x37d892(0x194)+_0x295a93[_0x37d892(0x22b)][_0x37d892(0x1af)](0x6)+'\x20USDT');if(_0x564341)console[_0x37d892(0x224)](_0x37d892(0x18b)+_0x564341);if(_0x295a93['balance']<_0x5a1a11)throw new Error(_0x37d892(0x220)+_0x295a93['balance'][_0x37d892(0x1af)](0x6)+_0x37d892(0x211)+_0x5a1a11[_0x37d892(0x1af)](0x6)+_0x37d892(0x149));let _0x1d0886=_0x266d90;if(!_0x1d0886){const _0x305ed9=await _0x568bee['shop']['findUnique']({'where':{'id':_0xfc6c79},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x305ed9)switch(_0xd9885f){case _0x37d892(0x208):_0x1d0886=_0x305ed9['usdtPolygonWallet']||undefined;break;case _0x37d892(0x203):_0x1d0886=_0x305ed9[_0x37d892(0x14f)]||undefined;break;case _0x37d892(0x21c):_0x1d0886=_0x305ed9[_0x37d892(0x1ee)]||undefined;break;case _0x37d892(0x1bc):_0x1d0886=_0x305ed9['usdcPolygonWallet']||undefined;break;}}console[_0x37d892(0x224)]('üí≥\x20Payout\x20wallet\x20for\x20'+_0xd9885f+':\x20'+(_0x1d0886||_0x37d892(0x1c9)));const _0xf3a5d7=await _0x568bee[_0x37d892(0x1f0)]['create']({'data':{'shopId':_0xfc6c79,'amount':_0x5a1a11,'network':_0xd9885f,'status':_0x37d892(0x1c6),'txid':_0x564341,'notes':_0x3be136,'periodFrom':_0x3e5ff3?new Date(_0x3e5ff3):null,'periodTo':_0x1893f8?new Date(_0x1893f8):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x430fc3=_0x295a93[_0x37d892(0x1bf)]-_0x5a1a11,_0x2af200=_0x295a93['totalPaidOut']+_0x5a1a11;return await _0x568bee[_0x37d892(0x189)][_0x37d892(0x1bd)]({'where':{'id':_0xfc6c79},'data':{'balance':_0x430fc3,'totalPaidOut':_0x2af200}}),console[_0x37d892(0x224)](_0x37d892(0x150)+_0x295a93[_0x37d892(0x17d)]+_0x37d892(0x18a)),console[_0x37d892(0x224)](_0x37d892(0x201)+_0x295a93[_0x37d892(0x1bf)][_0x37d892(0x1af)](0x6)+_0x37d892(0x178)+_0x430fc3[_0x37d892(0x1af)](0x6)+_0x37d892(0x24d)+_0x5a1a11[_0x37d892(0x1af)](0x6)+')'),console[_0x37d892(0x224)](_0x37d892(0x20e)+_0x295a93['totalPaidOut'][_0x37d892(0x1af)](0x6)+_0x37d892(0x178)+_0x2af200['toFixed'](0x6)+_0x37d892(0x1b7)+_0x5a1a11[_0x37d892(0x1af)](0x6)+')'),{'payout':_0xf3a5d7,'shop':_0x295a93};});return console['log'](_0x3b3a32(0x198)+_0x5bd0dc[_0x3b3a32(0x1f0)]['id']+_0x3b3a32(0x1e6)+_0x5bd0dc[_0x3b3a32(0x189)][_0x3b3a32(0x17d)]+'\x20('+_0x5a1a11+_0x3b3a32(0x151)),{'id':_0x5bd0dc['payout']['id'],'shopId':_0x5bd0dc['payout'][_0x3b3a32(0x193)],'shopName':_0x5bd0dc[_0x3b3a32(0x189)]['name'],'shopUsername':_0x5bd0dc[_0x3b3a32(0x189)][_0x3b3a32(0x17d)],'amount':_0x5bd0dc[_0x3b3a32(0x1f0)][_0x3b3a32(0x21a)],'network':_0x5bd0dc[_0x3b3a32(0x1f0)][_0x3b3a32(0x1e1)],'status':_0x5bd0dc[_0x3b3a32(0x1f0)][_0x3b3a32(0x1d0)],'txid':_0x5bd0dc[_0x3b3a32(0x1f0)]['txid'],'notes':_0x5bd0dc[_0x3b3a32(0x1f0)][_0x3b3a32(0x148)],'periodFrom':_0x5bd0dc[_0x3b3a32(0x1f0)]['periodFrom'],'periodTo':_0x5bd0dc[_0x3b3a32(0x1f0)]['periodTo'],'createdAt':_0x5bd0dc[_0x3b3a32(0x1f0)][_0x3b3a32(0x1aa)],'paidAt':_0x5bd0dc[_0x3b3a32(0x1f0)][_0x3b3a32(0x16e)]};}async[a35_0x5ad2e2(0x1ca)](_0x55ab82){const _0xf37d28=a35_0x5ad2e2,{page:_0x318c6b,limit:_0x3f8d8f,shopId:_0x2fbf48,network:_0x2a394a,dateFrom:_0x58d4a0,dateTo:_0x2b4628,search:_0x124fef}=_0x55ab82,_0x5e1ab3=(_0x318c6b-0x1)*_0x3f8d8f,_0x1423df={};_0x2fbf48&&(_0x1423df[_0xf37d28(0x193)]=_0x2fbf48);_0x2a394a&&(_0x1423df['network']=_0x2a394a);(_0x58d4a0||_0x2b4628)&&(_0x1423df[_0xf37d28(0x1aa)]={},_0x58d4a0&&(_0x1423df[_0xf37d28(0x1aa)][_0xf37d28(0x248)]=new Date(_0x58d4a0)),_0x2b4628&&(_0x1423df[_0xf37d28(0x1aa)][_0xf37d28(0x1bb)]=new Date(_0x2b4628)));_0x124fef&&(_0x1423df['OR']=[{'shop':{'name':{'contains':_0x124fef,'mode':_0xf37d28(0x162)}}},{'shop':{'username':{'contains':_0x124fef,'mode':'insensitive'}}},{'notes':{'contains':_0x124fef,'mode':_0xf37d28(0x162)}}]);const [_0x410acc,_0x351e40]=await Promise[_0xf37d28(0x199)]([database_1[_0xf37d28(0x1c3)][_0xf37d28(0x1f0)][_0xf37d28(0x1f1)]({'where':_0x1423df,'skip':_0x5e1ab3,'take':_0x3f8d8f,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0xf37d28(0x1f0)]['count']({'where':_0x1423df})]);return{'payouts':_0x410acc[_0xf37d28(0x23f)](_0x308ad5=>({'id':_0x308ad5['id'],'shopId':_0x308ad5[_0xf37d28(0x193)],'shopName':_0x308ad5[_0xf37d28(0x189)][_0xf37d28(0x18d)],'shopUsername':_0x308ad5[_0xf37d28(0x189)][_0xf37d28(0x17d)],'amount':_0x308ad5[_0xf37d28(0x21a)],'network':_0x308ad5['network'],'status':_0x308ad5[_0xf37d28(0x1d0)],'txid':_0x308ad5[_0xf37d28(0x1fa)],'notes':_0x308ad5[_0xf37d28(0x148)],'periodFrom':_0x308ad5[_0xf37d28(0x1b9)],'periodTo':_0x308ad5[_0xf37d28(0x1ae)],'createdAt':_0x308ad5['createdAt'],'paidAt':_0x308ad5[_0xf37d28(0x16e)]})),'pagination':{'page':_0x318c6b,'limit':_0x3f8d8f,'total':_0x351e40,'totalPages':Math[_0xf37d28(0x183)](_0x351e40/_0x3f8d8f)}};}async[a35_0x5ad2e2(0x14a)](_0x41c12b){const _0x5744f9=a35_0x5ad2e2,_0x8b8975=await database_1[_0x5744f9(0x1c3)][_0x5744f9(0x1f0)]['findUnique']({'where':{'id':_0x41c12b},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x8b8975)return null;return{'id':_0x8b8975['id'],'shopId':_0x8b8975[_0x5744f9(0x193)],'shopName':_0x8b8975['shop'][_0x5744f9(0x18d)],'shopUsername':_0x8b8975['shop'][_0x5744f9(0x17d)],'amount':_0x8b8975[_0x5744f9(0x21a)],'network':_0x8b8975[_0x5744f9(0x1e1)],'status':_0x8b8975[_0x5744f9(0x1d0)],'txid':_0x8b8975['txid'],'notes':_0x8b8975[_0x5744f9(0x148)],'periodFrom':_0x8b8975[_0x5744f9(0x1b9)],'periodTo':_0x8b8975['periodTo'],'createdAt':_0x8b8975[_0x5744f9(0x1aa)],'paidAt':_0x8b8975[_0x5744f9(0x16e)]};}async[a35_0x5ad2e2(0x235)](_0x3a2391){const _0x232c5d=a35_0x5ad2e2;await database_1['default'][_0x232c5d(0x1f0)][_0x232c5d(0x247)]({'where':{'id':_0x3a2391}});}async['getAllPayments'](_0x54e657){const _0x26b004=a35_0x5ad2e2,{page:_0x3adeb3,limit:_0x57547c,status:_0x55a67e,gateway:_0x5e0b6e,shopId:_0x4c3320,dateFrom:_0x136ca1,dateTo:_0x20a52d,search:_0x3e7888,currency:_0x3e4bca,sortBy:_0x33768a,sortOrder:_0x16ea0a}=_0x54e657,_0x5691d3=(_0x3adeb3-0x1)*_0x57547c;console['log']('üìä\x20Getting\x20payments\x20with\x20filters:',_0x54e657);const _0x40fd29=await database_1['default'][_0x26b004(0x1cb)][_0x26b004(0x14d)]({'by':[_0x26b004(0x1de)],'_count':{'gateway':!![]}});console[_0x26b004(0x224)](_0x26b004(0x242),_0x40fd29[_0x26b004(0x23f)](_0x2b9d17=>_0x2b9d17[_0x26b004(0x1de)]+'\x20('+_0x2b9d17['_count'][_0x26b004(0x1de)]+_0x26b004(0x164)));if(_0x5e0b6e){const _0x3ca182=_0x40fd29[_0x26b004(0x253)](_0x21fc23=>_0x21fc23[_0x26b004(0x1de)][_0x26b004(0x1f2)]()===_0x5e0b6e[_0x26b004(0x1f2)]());!_0x3ca182&&_0x5e0b6e[_0x26b004(0x1f2)]()!=='test_gateway'&&console['log'](_0x26b004(0x18f)+_0x5e0b6e+'\x27\x20not\x20found.\x20Available\x20gateways:\x20'+_0x40fd29[_0x26b004(0x23f)](_0x1a27ee=>_0x1a27ee[_0x26b004(0x1de)])['join'](',\x20'));}const _0x48ded2={};_0x55a67e&&(_0x48ded2[_0x26b004(0x1d0)]=_0x55a67e[_0x26b004(0x25f)]());if(!_0x5e0b6e)_0x48ded2[_0x26b004(0x1de)]={'not':'test_gateway'};else{if(_0x5e0b6e&&(_0x5e0b6e['toLowerCase']()===_0x26b004(0x146)||_0x5e0b6e==='0000'))_0x48ded2['gateway']=_0x26b004(0x146);else{let _0xbddaa3=_0x5e0b6e;const _0x233373=(0x0,gateway_1[_0x26b004(0x1b0)])(_0x5e0b6e);if(_0x233373)_0xbddaa3=_0x233373,console['log']('üîÑ\x20Converted\x20gateway\x20ID\x20\x27'+_0x5e0b6e+'\x27\x20to\x20name\x20\x27'+_0xbddaa3+'\x27');else{const _0x1cda1c=(0x0,gateway_1['getGatewayIdByName'])(_0x5e0b6e);if(_0x1cda1c){const _0x2db84b=(0x0,gateway_1[_0x26b004(0x1b0)])(_0x1cda1c);_0x2db84b&&(_0xbddaa3=_0x2db84b,console[_0x26b004(0x224)](_0x26b004(0x214)+_0x5e0b6e+_0x26b004(0x1cf)+_0x1cda1c+_0x26b004(0x21d)+_0xbddaa3+'\x27'));}else console[_0x26b004(0x224)](_0x26b004(0x160)+_0x5e0b6e+_0x26b004(0x1d2));}const _0x3374a1=await database_1[_0x26b004(0x1c3)][_0x26b004(0x1cb)][_0x26b004(0x1e7)]({'where':{'gateway':_0xbddaa3[_0x26b004(0x1f2)]()},'take':0x1});_0x3374a1===0x0?(console[_0x26b004(0x224)](_0x26b004(0x188)+_0xbddaa3+_0x26b004(0x25a)+_0x5e0b6e+_0x26b004(0x231)),_0x48ded2[_0x26b004(0x1de)]='NONEXISTENT_GATEWAY_FILTER'):(_0x48ded2['gateway']=_0xbddaa3[_0x26b004(0x1f2)](),console[_0x26b004(0x224)](_0x26b004(0x20c)+_0xbddaa3+'\x27\x20(from\x20\x27'+_0x5e0b6e+'\x27)'));}}console[_0x26b004(0x224)](_0x26b004(0x254),_0x48ded2[_0x26b004(0x1de)]);_0x4c3320&&(_0x48ded2[_0x26b004(0x193)]=_0x4c3320);_0x3e4bca&&(_0x48ded2[_0x26b004(0x187)]=_0x3e4bca['toUpperCase'](),console['log'](_0x26b004(0x22c)+_0x3e4bca[_0x26b004(0x25f)]()));(_0x136ca1||_0x20a52d)&&(_0x48ded2[_0x26b004(0x1aa)]={},_0x136ca1&&(_0x48ded2[_0x26b004(0x1aa)]['gte']=new Date(_0x136ca1)),_0x20a52d&&(_0x48ded2[_0x26b004(0x1aa)][_0x26b004(0x1bb)]=new Date(_0x20a52d)));_0x3e7888&&(_0x48ded2['OR']=[{'id':{'contains':_0x3e7888,'mode':_0x26b004(0x162)}},{'orderId':{'contains':_0x3e7888,'mode':'insensitive'}},{'gatewayOrderId':{'contains':_0x3e7888,'mode':_0x26b004(0x162)}},{'customerEmail':{'contains':_0x3e7888,'mode':_0x26b004(0x162)}},{'shop':{'name':{'contains':_0x3e7888,'mode':_0x26b004(0x162)}}},{'shop':{'username':{'contains':_0x3e7888,'mode':'insensitive'}}}]);console['log'](_0x26b004(0x1d4),JSON[_0x26b004(0x20b)](_0x48ded2,null,0x2));let _0x203ad3={'createdAt':'desc'};if(_0x33768a){const _0x2ec8f5=[_0x26b004(0x21a),_0x26b004(0x1aa),'updatedAt',_0x26b004(0x1d0),_0x26b004(0x1de),_0x26b004(0x187)],_0x2aa1=[_0x26b004(0x232),_0x26b004(0x23c)];if(_0x2ec8f5[_0x26b004(0x1ba)](_0x33768a)){const _0x57c78a=_0x2aa1[_0x26b004(0x1ba)](_0x16ea0a)?_0x16ea0a:_0x26b004(0x23c);_0x203ad3={[_0x33768a]:_0x57c78a},console[_0x26b004(0x224)](_0x26b004(0x171)+_0x33768a+_0x26b004(0x19a)+_0x57c78a+_0x26b004(0x144));}}const [_0x3aaedc,_0x35075b]=await Promise[_0x26b004(0x199)]([database_1[_0x26b004(0x1c3)][_0x26b004(0x1cb)]['findMany']({'where':_0x48ded2,'skip':_0x5691d3,'take':_0x57547c,'orderBy':_0x203ad3,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x26b004(0x1c3)]['payment'][_0x26b004(0x1e7)]({'where':_0x48ded2})]);return{'payments':_0x3aaedc,'pagination':{'page':_0x3adeb3,'limit':_0x57547c,'total':_0x35075b,'totalPages':Math['ceil'](_0x35075b/_0x57547c)}};}async[a35_0x5ad2e2(0x18e)](_0x19ddb2){const _0x1dbf33=a35_0x5ad2e2,_0x1793c6=await database_1[_0x1dbf33(0x1c3)][_0x1dbf33(0x1cb)][_0x1dbf33(0x175)]({'where':{'id':_0x19ddb2},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x1793c6)return null;return{'id':_0x1793c6['id'],'shopId':_0x1793c6[_0x1dbf33(0x193)],'gateway':_0x1793c6[_0x1dbf33(0x1de)],'amount':_0x1793c6[_0x1dbf33(0x21a)],'currency':_0x1793c6[_0x1dbf33(0x187)],'status':_0x1793c6[_0x1dbf33(0x1d0)],'orderId':_0x1793c6['orderId'],'gatewayOrderId':_0x1793c6[_0x1dbf33(0x20d)],'customerEmail':_0x1793c6[_0x1dbf33(0x1a8)],'customerName':_0x1793c6[_0x1dbf33(0x245)],'customerCountry':_0x1793c6['customerCountry'],'customerIp':_0x1793c6[_0x1dbf33(0x239)],'customerUa':_0x1793c6[_0x1dbf33(0x1be)],'failureMessage':_0x1793c6[_0x1dbf33(0x22e)],'externalPaymentUrl':_0x1793c6['externalPaymentUrl'],'successUrl':_0x1793c6[_0x1dbf33(0x205)],'failUrl':_0x1793c6['failUrl'],'pendingUrl':_0x1793c6['pendingUrl'],'whiteUrl':_0x1793c6[_0x1dbf33(0x24e)],'createdAt':_0x1793c6['createdAt'],'updatedAt':_0x1793c6[_0x1dbf33(0x234)],'shop':_0x1793c6['shop']};}async[a35_0x5ad2e2(0x221)](_0x386a76,_0xb4ee8d,_0x3af063,_0x248e3d){const _0x577538=a35_0x5ad2e2,_0x32b7ea=await database_1[_0x577538(0x1c3)][_0x577538(0x154)](async _0x92362a=>{const _0x3ea0d4=_0x577538,_0x17d8c2=await _0x92362a['payment'][_0x3ea0d4(0x175)]({'where':{'id':_0x386a76},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x17d8c2)throw new Error('Payment\x20not\x20found');const _0xa25b28=_0x17d8c2['status'],_0x1f2fc3=_0xb4ee8d[_0x3ea0d4(0x25f)]();console[_0x3ea0d4(0x224)](_0x3ea0d4(0x191)+_0x386a76+_0x3ea0d4(0x1e5)+_0xa25b28+_0x3ea0d4(0x178)+_0x1f2fc3),console[_0x3ea0d4(0x224)](_0x3ea0d4(0x166)+_0x17d8c2[_0x3ea0d4(0x189)][_0x3ea0d4(0x1bf)]+_0x3ea0d4(0x149));const _0x5da34b={'status':_0x1f2fc3,'updatedAt':new Date(),'statusChangedBy':_0x3ea0d4(0x25e),'statusChangedAt':new Date()};_0x3af063&&(_0x5da34b[_0x3ea0d4(0x167)]=_0x3af063);_0x1f2fc3===_0x3ea0d4(0x25c)&&_0x248e3d&&(_0x5da34b[_0x3ea0d4(0x1dc)]=_0x248e3d);let _0x46ef3a=0x0,_0x30f036=_0x17d8c2[_0x3ea0d4(0x189)][_0x3ea0d4(0x1bf)];if(_0x1f2fc3===_0x3ea0d4(0x1c5)&&_0xa25b28!==_0x3ea0d4(0x1c5)){_0x5da34b[_0x3ea0d4(0x16e)]=new Date();const _0x14a4c8=await currencyService_1[_0x3ea0d4(0x1a2)][_0x3ea0d4(0x25b)](_0x17d8c2[_0x3ea0d4(0x21a)],_0x17d8c2[_0x3ea0d4(0x187)]);_0x5da34b['amountUSDT']=_0x14a4c8;let _0x23fea7=0xa;const _0x273342=await _0x92362a[_0x3ea0d4(0x189)][_0x3ea0d4(0x175)]({'where':{'id':_0x17d8c2[_0x3ea0d4(0x193)]},'select':{'gatewaySettings':!![]}});if(_0x273342?.[_0x3ea0d4(0x1c4)])try{const _0x22ae9a=JSON[_0x3ea0d4(0x1e0)](_0x273342['gatewaySettings']);for(const [_0x1f4c35,_0x495e53]of Object['entries'](_0x22ae9a)){if(_0x1f4c35[_0x3ea0d4(0x1f2)]()===_0x17d8c2['gateway'][_0x3ea0d4(0x1f2)]()){_0x23fea7=_0x495e53[_0x3ea0d4(0x1e8)]||0xa;break;}}}catch(_0x5545d8){console[_0x3ea0d4(0x1d7)](_0x3ea0d4(0x259)+_0x386a76+':',_0x5545d8);}const _0x27c109=_0x14a4c8*(0x1-_0x23fea7/0x64);_0x46ef3a=_0x27c109,_0x30f036+=_0x27c109,console[_0x3ea0d4(0x224)](_0x3ea0d4(0x147)+_0x386a76+_0x3ea0d4(0x1ab)),console[_0x3ea0d4(0x224)]('\x20\x20\x20Full\x20amount:\x20'+_0x14a4c8[_0x3ea0d4(0x1af)](0x6)+_0x3ea0d4(0x149)),console[_0x3ea0d4(0x224)]('\x20\x20\x20Gateway:\x20'+_0x17d8c2[_0x3ea0d4(0x1de)]+_0x3ea0d4(0x1d8)+_0x23fea7+'%'),console[_0x3ea0d4(0x224)]('\x20\x20\x20Merchant\x20gets:\x20'+_0x27c109[_0x3ea0d4(0x1af)](0x6)+'\x20USDT\x20(after\x20'+_0x23fea7+'%\x20commission)'),console[_0x3ea0d4(0x224)](_0x3ea0d4(0x15c)+_0x27c109[_0x3ea0d4(0x1af)](0x6)+_0x3ea0d4(0x149));}else{if(_0xa25b28===_0x3ea0d4(0x1c5)&&_0x1f2fc3!==_0x3ea0d4(0x1c5)){if(_0x17d8c2[_0x3ea0d4(0x230)]){let _0x13d332=0xa;const _0x2fc74d=await _0x92362a[_0x3ea0d4(0x189)][_0x3ea0d4(0x175)]({'where':{'id':_0x17d8c2[_0x3ea0d4(0x193)]},'select':{'gatewaySettings':!![]}});if(_0x2fc74d?.['gatewaySettings'])try{const _0x349c29=JSON[_0x3ea0d4(0x1e0)](_0x2fc74d[_0x3ea0d4(0x1c4)]);for(const [_0x5c89eb,_0x18aef8]of Object[_0x3ea0d4(0x169)](_0x349c29)){if(_0x5c89eb[_0x3ea0d4(0x1f2)]()===_0x17d8c2[_0x3ea0d4(0x1de)][_0x3ea0d4(0x1f2)]()){_0x13d332=_0x18aef8[_0x3ea0d4(0x1e8)]||0xa;break;}}}catch(_0x261fb3){console[_0x3ea0d4(0x1d7)]('Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20'+_0x386a76+':',_0x261fb3);}const _0x37e762=_0x17d8c2[_0x3ea0d4(0x230)]*(0x1-_0x13d332/0x64);_0x46ef3a=-_0x37e762,_0x30f036-=_0x37e762,_0x5da34b['amountUSDT']=null,console['log'](_0x3ea0d4(0x147)+_0x386a76+_0x3ea0d4(0x23d)),console[_0x3ea0d4(0x224)]('\x20\x20\x20Full\x20amount:\x20'+_0x17d8c2[_0x3ea0d4(0x230)][_0x3ea0d4(0x1af)](0x6)+'\x20USDT'),console[_0x3ea0d4(0x224)](_0x3ea0d4(0x16d)+_0x17d8c2[_0x3ea0d4(0x1de)]+_0x3ea0d4(0x1d8)+_0x13d332+'%'),console[_0x3ea0d4(0x224)](_0x3ea0d4(0x207)+_0x37e762[_0x3ea0d4(0x1af)](0x6)+_0x3ea0d4(0x18c)+_0x13d332+_0x3ea0d4(0x217)),console[_0x3ea0d4(0x224)](_0x3ea0d4(0x236)+_0x37e762[_0x3ea0d4(0x1af)](0x6)+_0x3ea0d4(0x149));}}}_0x1f2fc3===_0x3ea0d4(0x25c)&&(_0xa25b28===_0x3ea0d4(0x1c5)&&_0x17d8c2[_0x3ea0d4(0x230)]&&console[_0x3ea0d4(0x224)](_0x3ea0d4(0x1f5)),_0x248e3d&&_0x248e3d>0x0&&(_0x46ef3a-=_0x248e3d,_0x30f036-=_0x248e3d,console[_0x3ea0d4(0x224)]('üí∏\x20CHARGEBACK\x20penalty:\x20-'+_0x248e3d['toFixed'](0x6)+'\x20USDT\x20from\x20balance')));_0x1f2fc3===_0x3ea0d4(0x1b5)&&_0xa25b28===_0x3ea0d4(0x1c5)&&console[_0x3ea0d4(0x224)]('üîÑ\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance');const _0x2cd779=await _0x92362a['payment']['update']({'where':{'id':_0x386a76},'data':_0x5da34b,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x46ef3a!==0x0&&(await _0x92362a[_0x3ea0d4(0x189)][_0x3ea0d4(0x1bd)]({'where':{'id':_0x17d8c2[_0x3ea0d4(0x193)]},'data':{'balance':_0x30f036}}),console[_0x3ea0d4(0x224)](_0x3ea0d4(0x150)+_0x17d8c2['shopId']+_0x3ea0d4(0x1d6)+_0x17d8c2[_0x3ea0d4(0x189)][_0x3ea0d4(0x1bf)][_0x3ea0d4(0x1af)](0x6)+_0x3ea0d4(0x178)+_0x30f036[_0x3ea0d4(0x1af)](0x6)+'\x20USDT\x20('+(_0x46ef3a>0x0?'+':'')+_0x46ef3a['toFixed'](0x6)+')')),_0x2cd779;});return{'id':_0x32b7ea['id'],'shopId':_0x32b7ea[_0x577538(0x193)],'gateway':_0x32b7ea[_0x577538(0x1de)],'amount':_0x32b7ea[_0x577538(0x21a)],'currency':_0x32b7ea[_0x577538(0x187)],'status':_0x32b7ea[_0x577538(0x1d0)],'orderId':_0x32b7ea['orderId'],'gatewayOrderId':_0x32b7ea[_0x577538(0x20d)],'customerEmail':_0x32b7ea[_0x577538(0x1a8)],'customerName':_0x32b7ea[_0x577538(0x245)],'customerCountry':_0x32b7ea[_0x577538(0x15e)],'customerIp':_0x32b7ea[_0x577538(0x239)],'customerUa':_0x32b7ea[_0x577538(0x1be)],'failureMessage':_0x32b7ea['failureMessage'],'adminNotes':_0x32b7ea[_0x577538(0x167)],'chargebackAmount':_0x32b7ea['chargebackAmount'],'statusChangedBy':_0x32b7ea[_0x577538(0x228)],'statusChangedAt':_0x32b7ea[_0x577538(0x1ed)],'createdAt':_0x32b7ea['createdAt'],'updatedAt':_0x32b7ea[_0x577538(0x234)],'shop':_0x32b7ea[_0x577538(0x189)]};}async[a35_0x5ad2e2(0x179)](_0x194044,_0x3dcf8c){const _0x3ba986=a35_0x5ad2e2,_0x78711f={..._0x3dcf8c};_0x3dcf8c[_0x3ba986(0x1ce)]&&(_0x78711f[_0x3ba986(0x1ce)]=await bcryptjs_1[_0x3ba986(0x1c3)]['hash'](_0x3dcf8c['password'],0xc));_0x3dcf8c[_0x3ba986(0x159)]&&(_0x78711f[_0x3ba986(0x18d)]=_0x3dcf8c[_0x3ba986(0x159)],delete _0x78711f[_0x3ba986(0x159)]);_0x3dcf8c[_0x3ba986(0x24c)]&&(_0x78711f['telegram']=_0x3dcf8c[_0x3ba986(0x24c)],delete _0x78711f[_0x3ba986(0x24c)]);_0x3dcf8c[_0x3ba986(0x1e9)]&&(_0x78711f[_0x3ba986(0x19f)]=_0x3dcf8c[_0x3ba986(0x1e9)],delete _0x78711f[_0x3ba986(0x1e9)]);_0x3dcf8c[_0x3ba986(0x190)]&&(_0x78711f[_0x3ba986(0x1ea)]=JSON[_0x3ba986(0x20b)](_0x3dcf8c[_0x3ba986(0x190)]),delete _0x78711f[_0x3ba986(0x190)]);_0x3dcf8c[_0x3ba986(0x1c4)]&&(_0x78711f[_0x3ba986(0x1c4)]=JSON[_0x3ba986(0x20b)](_0x3dcf8c[_0x3ba986(0x1c4)]),delete _0x78711f[_0x3ba986(0x1c4)]);_0x3dcf8c[_0x3ba986(0x1fe)]&&(_0x3dcf8c[_0x3ba986(0x1fe)][_0x3ba986(0x1d1)]!==undefined&&(_0x78711f[_0x3ba986(0x1d1)]=_0x3dcf8c[_0x3ba986(0x1fe)][_0x3ba986(0x1d1)]||null),_0x3dcf8c[_0x3ba986(0x1fe)][_0x3ba986(0x14f)]!==undefined&&(_0x78711f[_0x3ba986(0x14f)]=_0x3dcf8c['wallets']['usdtTrcWallet']||null),_0x3dcf8c[_0x3ba986(0x1fe)]['usdtErcWallet']!==undefined&&(_0x78711f[_0x3ba986(0x1ee)]=_0x3dcf8c[_0x3ba986(0x1fe)][_0x3ba986(0x1ee)]||null),_0x3dcf8c[_0x3ba986(0x1fe)][_0x3ba986(0x1d5)]!==undefined&&(_0x78711f[_0x3ba986(0x1d5)]=_0x3dcf8c[_0x3ba986(0x1fe)][_0x3ba986(0x1d5)]||null),delete _0x78711f['wallets']);const _0x1931c4=await database_1[_0x3ba986(0x1c3)]['shop'][_0x3ba986(0x1bd)]({'where':{'id':_0x194044},'data':_0x78711f,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x1931c4['id'],'fullName':_0x1931c4[_0x3ba986(0x18d)],'username':_0x1931c4[_0x3ba986(0x17d)],'telegramId':_0x1931c4[_0x3ba986(0x1b2)],'merchantUrl':_0x1931c4['shopUrl'],'gateways':_0x1931c4[_0x3ba986(0x1ea)]?JSON[_0x3ba986(0x1e0)](_0x1931c4['paymentGateways']):null,'gatewaySettings':_0x1931c4[_0x3ba986(0x1c4)]?JSON[_0x3ba986(0x1e0)](_0x1931c4[_0x3ba986(0x1c4)]):null,'publicKey':_0x1931c4['publicKey'],'wallets':{'usdtPolygonWallet':_0x1931c4['usdtPolygonWallet'],'usdtTrcWallet':_0x1931c4[_0x3ba986(0x14f)],'usdtErcWallet':_0x1931c4['usdtErcWallet'],'usdcPolygonWallet':_0x1931c4[_0x3ba986(0x1d5)]},'status':_0x1931c4[_0x3ba986(0x1d0)],'createdAt':_0x1931c4[_0x3ba986(0x1aa)]};}async['suspendUser'](_0x4c0279){const _0x30f76c=a35_0x5ad2e2,_0x12face=await database_1[_0x30f76c(0x1c3)][_0x30f76c(0x189)][_0x30f76c(0x1bd)]({'where':{'id':_0x4c0279},'data':{'status':_0x30f76c(0x226)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x12face['id'],'fullName':_0x12face[_0x30f76c(0x18d)],'username':_0x12face['username'],'telegramId':_0x12face[_0x30f76c(0x1b2)],'merchantUrl':_0x12face[_0x30f76c(0x19f)],'gateways':_0x12face['paymentGateways']?JSON['parse'](_0x12face[_0x30f76c(0x1ea)]):null,'gatewaySettings':_0x12face['gatewaySettings']?JSON[_0x30f76c(0x1e0)](_0x12face[_0x30f76c(0x1c4)]):null,'publicKey':_0x12face[_0x30f76c(0x143)],'wallets':{'usdtPolygonWallet':_0x12face[_0x30f76c(0x1d1)],'usdtTrcWallet':_0x12face['usdtTrcWallet'],'usdtErcWallet':_0x12face[_0x30f76c(0x1ee)],'usdcPolygonWallet':_0x12face['usdcPolygonWallet']},'status':_0x12face[_0x30f76c(0x1d0)],'createdAt':_0x12face[_0x30f76c(0x1aa)]};}async[a35_0x5ad2e2(0x202)](_0x41a0b9){const _0x1fe5c9=a35_0x5ad2e2,_0x37ce24=await database_1[_0x1fe5c9(0x1c3)][_0x1fe5c9(0x189)]['update']({'where':{'id':_0x41a0b9},'data':{'status':_0x1fe5c9(0x1da)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x37ce24['id'],'fullName':_0x37ce24[_0x1fe5c9(0x18d)],'username':_0x37ce24['username'],'telegramId':_0x37ce24[_0x1fe5c9(0x1b2)],'merchantUrl':_0x37ce24[_0x1fe5c9(0x19f)],'gateways':_0x37ce24[_0x1fe5c9(0x1ea)]?JSON[_0x1fe5c9(0x1e0)](_0x37ce24['paymentGateways']):null,'gatewaySettings':_0x37ce24['gatewaySettings']?JSON[_0x1fe5c9(0x1e0)](_0x37ce24['gatewaySettings']):null,'publicKey':_0x37ce24[_0x1fe5c9(0x143)],'wallets':{'usdtPolygonWallet':_0x37ce24['usdtPolygonWallet'],'usdtTrcWallet':_0x37ce24['usdtTrcWallet'],'usdtErcWallet':_0x37ce24[_0x1fe5c9(0x1ee)],'usdcPolygonWallet':_0x37ce24[_0x1fe5c9(0x1d5)]},'status':_0x37ce24[_0x1fe5c9(0x1d0)],'createdAt':_0x37ce24[_0x1fe5c9(0x1aa)]};}async['getAllUsers'](_0x1ca551){const _0x227f8d=a35_0x5ad2e2,{page:_0x57bd95,limit:_0xe4ff7,status:_0x4ea7bc}=_0x1ca551,_0x7f5a2=(_0x57bd95-0x1)*_0xe4ff7,_0x4aaf5e={};_0x4ea7bc&&(_0x4aaf5e[_0x227f8d(0x1d0)]=_0x4ea7bc[_0x227f8d(0x25f)]());const [_0x186a0f,_0x23e43d]=await Promise[_0x227f8d(0x199)]([database_1[_0x227f8d(0x1c3)][_0x227f8d(0x189)][_0x227f8d(0x1f1)]({'where':_0x4aaf5e,'skip':_0x7f5a2,'take':_0xe4ff7,'orderBy':{'createdAt':_0x227f8d(0x23c)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1['default'][_0x227f8d(0x189)]['count']({'where':_0x4aaf5e})]);return{'users':_0x186a0f['map'](_0x20291=>({'id':_0x20291['id'],'fullName':_0x20291[_0x227f8d(0x18d)],'username':_0x20291[_0x227f8d(0x17d)],'telegramId':_0x20291[_0x227f8d(0x1b2)],'merchantUrl':_0x20291['shopUrl'],'gateways':_0x20291[_0x227f8d(0x1ea)]?JSON[_0x227f8d(0x1e0)](_0x20291[_0x227f8d(0x1ea)]):null,'gatewaySettings':_0x20291[_0x227f8d(0x1c4)]?JSON[_0x227f8d(0x1e0)](_0x20291[_0x227f8d(0x1c4)]):null,'publicKey':_0x20291[_0x227f8d(0x143)],'wallets':{'usdtPolygonWallet':_0x20291[_0x227f8d(0x1d1)],'usdtTrcWallet':_0x20291[_0x227f8d(0x14f)],'usdtErcWallet':_0x20291[_0x227f8d(0x1ee)],'usdcPolygonWallet':_0x20291['usdcPolygonWallet']},'status':_0x20291[_0x227f8d(0x1d0)],'createdAt':_0x20291['createdAt']})),'pagination':{'page':_0x57bd95,'limit':_0xe4ff7,'total':_0x23e43d,'totalPages':Math['ceil'](_0x23e43d/_0xe4ff7)}};}async['getUserById'](_0x16868a){const _0x2b32e6=a35_0x5ad2e2,_0xee0668=await database_1[_0x2b32e6(0x1c3)][_0x2b32e6(0x189)][_0x2b32e6(0x175)]({'where':{'id':_0x16868a},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0xee0668)return null;return{'id':_0xee0668['id'],'fullName':_0xee0668[_0x2b32e6(0x18d)],'username':_0xee0668[_0x2b32e6(0x17d)],'telegramId':_0xee0668[_0x2b32e6(0x1b2)],'merchantUrl':_0xee0668[_0x2b32e6(0x19f)],'gateways':_0xee0668[_0x2b32e6(0x1ea)]?JSON[_0x2b32e6(0x1e0)](_0xee0668[_0x2b32e6(0x1ea)]):null,'gatewaySettings':_0xee0668['gatewaySettings']?JSON['parse'](_0xee0668[_0x2b32e6(0x1c4)]):null,'publicKey':_0xee0668['publicKey'],'wallets':{'usdtPolygonWallet':_0xee0668[_0x2b32e6(0x1d1)],'usdtTrcWallet':_0xee0668[_0x2b32e6(0x14f)],'usdtErcWallet':_0xee0668[_0x2b32e6(0x1ee)],'usdcPolygonWallet':_0xee0668[_0x2b32e6(0x1d5)]},'status':_0xee0668['status'],'createdAt':_0xee0668[_0x2b32e6(0x1aa)]};}async[a35_0x5ad2e2(0x196)](_0x20c6d3){const _0x2d2934=a35_0x5ad2e2,{fullName:_0x293c15,username:_0x4ecd8a,password:_0x1b676d,telegramId:_0x1dac97,merchantUrl:_0x585042,gateways:_0x51f85e,gatewaySettings:_0x4d8600,wallets:_0x429f5a}=_0x20c6d3,_0x1cccdc=await database_1[_0x2d2934(0x1c3)][_0x2d2934(0x189)]['findUnique']({'where':{'username':_0x4ecd8a}});if(_0x1cccdc)throw new Error('Username\x20already\x20exists');if(_0x1dac97){const _0x38000a=await database_1[_0x2d2934(0x1c3)][_0x2d2934(0x189)]['findUnique']({'where':{'telegram':_0x1dac97}});if(_0x38000a)throw new Error('Telegram\x20username\x20already\x20exists');}const _0x57cfe6=await bcryptjs_1[_0x2d2934(0x1c3)][_0x2d2934(0x17c)](_0x1b676d,0xc),_0xea17a9=_0x2d2934(0x173)+crypto_1[_0x2d2934(0x1c3)]['randomBytes'](0x20)[_0x2d2934(0x1ac)](_0x2d2934(0x1fd)),_0x5f47a4=_0x2d2934(0x1fb)+crypto_1[_0x2d2934(0x1c3)][_0x2d2934(0x222)](0x20)[_0x2d2934(0x1ac)](_0x2d2934(0x1fd)),_0x99762b=await database_1['default'][_0x2d2934(0x189)][_0x2d2934(0x156)]({'data':{'name':_0x293c15,'username':_0x4ecd8a,'password':_0x57cfe6,'telegram':_0x1dac97,'shopUrl':_0x585042,'paymentGateways':_0x51f85e?JSON['stringify'](_0x51f85e):null,'gatewaySettings':_0x4d8600?JSON['stringify'](_0x4d8600):null,'usdtPolygonWallet':_0x429f5a?.['usdtPolygonWallet']||null,'usdtTrcWallet':_0x429f5a?.[_0x2d2934(0x14f)]||null,'usdtErcWallet':_0x429f5a?.['usdtErcWallet']||null,'usdcPolygonWallet':_0x429f5a?.[_0x2d2934(0x1d5)]||null,'publicKey':_0xea17a9,'secretKey':_0x5f47a4,'status':_0x2d2934(0x1da)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x99762b['id'],'fullName':_0x99762b[_0x2d2934(0x18d)],'username':_0x99762b[_0x2d2934(0x17d)],'telegramId':_0x99762b[_0x2d2934(0x1b2)],'merchantUrl':_0x99762b[_0x2d2934(0x19f)],'gateways':_0x99762b[_0x2d2934(0x1ea)]?JSON[_0x2d2934(0x1e0)](_0x99762b[_0x2d2934(0x1ea)]):null,'gatewaySettings':_0x99762b[_0x2d2934(0x1c4)]?JSON[_0x2d2934(0x1e0)](_0x99762b[_0x2d2934(0x1c4)]):null,'publicKey':_0x99762b[_0x2d2934(0x143)],'wallets':{'usdtPolygonWallet':_0x99762b[_0x2d2934(0x1d1)],'usdtTrcWallet':_0x99762b[_0x2d2934(0x14f)],'usdtErcWallet':_0x99762b['usdtErcWallet'],'usdcPolygonWallet':_0x99762b[_0x2d2934(0x1d5)]},'status':_0x99762b[_0x2d2934(0x1d0)],'createdAt':_0x99762b[_0x2d2934(0x1aa)]};}async[a35_0x5ad2e2(0x238)](_0x46da94){const _0x58558c=a35_0x5ad2e2;await database_1['default'][_0x58558c(0x189)][_0x58558c(0x247)]({'where':{'id':_0x46da94}});}[a35_0x5ad2e2(0x209)](_0xb0e7c9,_0x15eda8,_0x3ccd73){const _0x2d27fd=a35_0x5ad2e2,_0x257dd9=new Map(),_0x527bd5=new Date(_0x15eda8);while(_0x527bd5<=_0x3ccd73){const _0x44f107=_0x527bd5['toISOString']()[_0x2d27fd(0x197)]('T')[0x0];_0x257dd9[_0x2d27fd(0x206)](_0x44f107,{'revenue':0x0,'count':0x0}),_0x527bd5[_0x2d27fd(0x16f)](_0x527bd5[_0x2d27fd(0x1b4)]()+0x1);}for(const _0x22402a of _0xb0e7c9){const _0xabfbe5=_0x22402a[_0x2d27fd(0x1aa)][_0x2d27fd(0x1e3)]()[_0x2d27fd(0x197)]('T')[0x0],_0x4adc56=_0x257dd9[_0x2d27fd(0x20f)](_0xabfbe5);_0x4adc56&&(_0x4adc56[_0x2d27fd(0x1e7)]+=0x1,_0x22402a['status']==='PAID'&&(_0x22402a['amountUSDT']?_0x4adc56[_0x2d27fd(0x246)]+=_0x22402a[_0x2d27fd(0x230)]:console[_0x2d27fd(0x224)]('‚ö†Ô∏è\x20Payment\x20'+_0x22402a['id']+_0x2d27fd(0x21b))));}const _0x51ffac=[],_0x1addd2=[];for(const [_0x18d1f0,_0x10a45f]of _0x257dd9){_0x51ffac[_0x2d27fd(0x24b)]({'date':_0x18d1f0,'amount':Math[_0x2d27fd(0x165)](_0x10a45f[_0x2d27fd(0x246)]*0x64)/0x64}),_0x1addd2[_0x2d27fd(0x24b)]({'date':_0x18d1f0,'count':_0x10a45f[_0x2d27fd(0x1e7)]});}return{'dailyRevenue':_0x51ffac,'dailyPayments':_0x1addd2};}}exports[a35_0x5ad2e2(0x177)]=AdminService;