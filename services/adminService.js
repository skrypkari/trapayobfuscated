'use strict';const a35_0x29c225=a35_0x4d78;function a35_0x4d78(_0x47dd7b,_0x584f0f){const _0x1070a6=a35_0x1070();return a35_0x4d78=function(_0x4d7892,_0x2344be){_0x4d7892=_0x4d7892-0x1d6;let _0x32453f=_0x1070a6[_0x4d7892];return _0x32453f;},a35_0x4d78(_0x47dd7b,_0x584f0f);}(function(_0x5a635d,_0x235222){const _0x142ee0=a35_0x4d78,_0x1cdd21=_0x5a635d();while(!![]){try{const _0x1657df=parseInt(_0x142ee0(0x1fe))/0x1*(parseInt(_0x142ee0(0x284))/0x2)+-parseInt(_0x142ee0(0x1ef))/0x3*(-parseInt(_0x142ee0(0x2a0))/0x4)+parseInt(_0x142ee0(0x221))/0x5+-parseInt(_0x142ee0(0x1ff))/0x6*(-parseInt(_0x142ee0(0x288))/0x7)+-parseInt(_0x142ee0(0x23a))/0x8*(-parseInt(_0x142ee0(0x203))/0x9)+parseInt(_0x142ee0(0x280))/0xa+-parseInt(_0x142ee0(0x1ea))/0xb;if(_0x1657df===_0x235222)break;else _0x1cdd21['push'](_0x1cdd21['shift']());}catch(_0x21f79e){_0x1cdd21['push'](_0x1cdd21['shift']());}}}(a35_0x1070,0x2bad9));function a35_0x1070(){const _0x706ef7=['\x20\x20\x20Merchant\x20loses:\x20','statusChangedAt','usdtTrcWallet','\x20USDT\x20(gross\x20revenue)','amountAfterCommissionUSDT','findFirst','📊\x20Sorting\x20payments\x20by\x20','periodTo','updatePaymentStatus','\x20USDT,\x20Requested:\x20','length','dateTo','default','customerEmail','not\x20specified','groupBy','Telegram\x20username\x20already\x20exists','totalPayout','sk_','💸\x20CHARGEBACK:\x20Merchant\x20amount\x20already\x20deducted\x20from\x20balance','1236370ciWctl','ACTIVE','\x20USDT\x20(with\x20commission\x20deducted)','toUpperCase','4cIhCaT','KLYME\x20EU','SUSPENDED','sort','37793OTNXKm','⚠️\x20Requested\x20gateway\x20\x27','\x20USDT','currencyService','dailyPayments','\x20\x20\x20🖥️\x20User\x20Agent:\x20','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','averageCommissionRate','shopId','💰\x20Payment\x20','failureMessage','custom','password','usdtErcWallet','date','polygon','💰\x20Shop\x20','\x20USDT\x20(-','externalPaymentUrl','availableBalance','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','$transaction','COMPLETED','stringify','9076HuToBc','bcryptjs','\x20\x20\x20Transaction\x20hash:\x20','hex','getMonth','NONEXISTENT_GATEWAY_FILTER','getUserById','telegram','commissionUSDT','period','\x20\x20\x20💸\x20Total\x20payouts\x20(all\x20time):\x20','gte','gatewaySettings','\x20status:\x20','toLowerCase','./currencyService','paidAt','balance','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','publicKey','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','getMerchantsAwaitingPayout','month','\x27\x20(from\x20\x27','toISOString','year','customerIp','\x20USDT\x20(','txid','Noda','toFixed','dailyRevenue','totalAmountUSDT','randomBytes','\x20\x20\x20🔍\x20Raw\x20balance\x20sum:\x20','admin','CHARGEBACK','revenue','customerCountry','📊\x20Payout\x20statistics\x20calculated:','getPayoutById','notes','erc20','\x20USDT\x20(total\x20paid\x20to\x20merchants)','merchantEarnings',',\x20successful:\x20','90d','getAllPayments','\x20\x20\x20Full\x20amount:\x20','\x20->\x20','totalAmountAfterCommissionUSDT','getSystemStatistics','\x20became\x20PAID:','all','successUrl','__esModule','🔍\x20Using\x20gateway\x20\x27','gatewayEarnings','averageCheckUSDT','usdtPolygonWallet','30d','\x20\x20\x20📅\x20This\x20month:\x20','📊\x20Final\x20WHERE\x20conditions:','findMany','split','includes','\x20\x20\x20�\x20Total\x20payments\x20turnover:\x20','_count','insensitive','aggregate','customerUa','totalPayments','reduce','username','activateUser','createUser','adminNotes','💰\x20Found\x20','📊\x20Gateway\x20filter\x20applied:','map','\x20\x20\x20🌍\x20Country:\x20','💰\x20Creating\x20payout\x20for\x20shop\x20','get','commission','customerName','parse','\x20USDT\x20(same\x20as\x20awaiting)','asc','\x27\x20->\x20name\x20\x27','payment','💱\x20Currency\x20filter\x20applied:\x20','convertToUSDT','delete','create','payout','2020-01-01','fullName','\x20balance\x20updated:\x20','6510108AHrNOh','values','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','📊\x20Calculating\x20payout\x20statistics...','deleteUser','324NsmCiN','\x20\x20\x20💰\x20Total\x20payments\x20turnover:\x20','turnover','telegramId','set','\x20\x20\x20💳\x20Total\x20payments:\x20','merchantEarningsUSDT','\x20\x20\x20💰\x20Total\x20turnover:\x20','polygon_usdc','findUnique','\x20merchants','\x20\x20\x20🌐\x20IP:\x20',':\x20commission\x20=\x20','amountUSDT','defineProperty','34061gZtgtJ','72QAFTDx','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','📅\x20Period:\x20','usdcPolygonWallet','450jirmgU','deletePayout','../config/database','\x20\x20\x20📊\x20Total\x20payments:\x20','getAllUsers','suspendUser','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','Payment\x20not\x20found','log','📊\x20Total\x20payments\x20(including\x20failed):\x20','totalCommissionRate','update','orderId','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','\x20\x20\x20Current\x20balance:\x20','📅\x20Period\x20\x27all\x27:\x20Using\x20start\x20date\x20from\x20first\x20payment:\x20','\x20\x20\x20💵\x20Available\x20balance:\x20','\x20\x20\x20Payout\x20amount:\x20','\x20USDT\x20(after\x20','paymentsCount','gateway','getGatewayNameById','📊\x20Merchants\x20awaiting\x20payout:\x20','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','chargebackAmount','amount','\x20balance\x20updated:','count','Insufficient\x20balance.\x20Available:\x20','865170PSvlju','lte','forEach','merchantUrl','whiteUrl','\x20payments)','getFullYear','round','\x20for\x20shop\x20','ceil','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','_sum','dateFrom','\x27\x20not\x20found.\x20Available\x20gateways:\x20','PAID','totalPaidOut','getMerchantsSelection','\x20USDT\x20(+','currency','awaitingPayout','Username\x20already\x20exists','\x20\x20\x20📅\x20Total\x20payouts\x20(this\x20month):\x20','KLYME\x20GB','\x20\x20\x20Gateway:\x20','💸\x20CHARGEBACK\x20penalty:\x20-','15376gRAhVM','🔄\x20Converted\x20gateway\x20ID\x20\x27','gateways',',\x20Commission:\x20','CoinToPay','push','%\x20commission)','KLYME\x20DE','✅\x20Using\x20gateway\x20filter:\x20\x27','Rapyd','pendingUrl','wallets','desc','💰\x20[PAYOUT]\x20Gateway\x20','network','toString','thisMonth','AdminService','getTime','\x27\x20to\x20name\x20\x27','0000','name','updatedAt','shopUrl','\x20\x20\x20Balance:\x20','turnoverUSDT','\x20USDT\x20(theoretical\x20net)','error','periodFrom','\x20USDT\x20(actual\x20balances)','createdAt','week','updateCustomerData','📋\x20Found\x20','\x20\x20\x20Merchant\x20gets:\x20','getAllPayouts','\x20USDT\x20from\x20balance','status','🔄\x20Converted\x20gateway\x20name\x20\x27','gatewayOrderId','\x20active\x20merchants\x20for\x20selection','generateDailyStatistics','failUrl','\x20\x20\x20🔍\x20Calculated\x20after\x20commission:\x20','paymentGateways','updateUser','shop','entries','\x20\x20\x20✅\x20Total\x20available\x20for\x20payout:\x20','test_gateway'];a35_0x1070=function(){return _0x706ef7;};return a35_0x1070();}var __importDefault=this&&this['__importDefault']||function(_0x59293c){const _0x1a2bfa=a35_0x4d78;return _0x59293c&&_0x59293c[_0x1a2bfa(0x2d7)]?_0x59293c:{'default':_0x59293c};};Object[a35_0x29c225(0x1fd)](exports,a35_0x29c225(0x2d7),{'value':!![]}),exports[a35_0x29c225(0x24b)]=void 0x0;const database_1=__importDefault(require(a35_0x29c225(0x205))),bcryptjs_1=__importDefault(require(a35_0x29c225(0x2a1))),crypto_1=__importDefault(require('crypto')),currencyService_1=require(a35_0x29c225(0x2af)),gateway_1=require('../types/gateway');class AdminService{async['getPayoutStats'](){const _0x16b338=a35_0x29c225;console['log'](_0x16b338(0x1ed));const _0x4754a1=await database_1[_0x16b338(0x278)][_0x16b338(0x268)][_0x16b338(0x2e5)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':'ACTIVE'}}),_0x3483da=await this[_0x16b338(0x2b5)]({'page':0x1,'limit':0x3e8}),_0x2c395d=await database_1['default'][_0x16b338(0x1e1)][_0x16b338(0x21f)]({'where':{'status':'PAID','gateway':{'not':_0x16b338(0x26b)}}}),_0x32eb88=new Date(),_0x569dfd=new Date(_0x32eb88[_0x16b338(0x227)](),_0x32eb88[_0x16b338(0x2a4)](),0x1),_0x3c2d50=new Date(_0x32eb88[_0x16b338(0x227)](),_0x32eb88['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x2f0df5=await database_1[_0x16b338(0x278)][_0x16b338(0x1e6)][_0x16b338(0x2e5)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x569dfd,'lte':_0x3c2d50},'status':'COMPLETED'}}),_0x53a1b6=_0x4754a1[_0x16b338(0x22c)][_0x16b338(0x230)]||0x0,_0x3e7b45=_0x3483da['summary'][_0x16b338(0x2d2)],_0x23afb7=_0x2f0df5['_sum'][_0x16b338(0x21d)]||0x0,_0x2361eb={'totalPayout':Math[_0x16b338(0x228)](_0x53a1b6*0x64)/0x64,'awaitingPayout':Math[_0x16b338(0x228)](_0x3e7b45*0x64)/0x64,'thisMonth':Math[_0x16b338(0x228)](_0x23afb7*0x64)/0x64,'availableBalance':Math['round'](_0x3e7b45*0x64)/0x64,'totalPayments':_0x2c395d};return console[_0x16b338(0x20b)](_0x16b338(0x2c7)),console[_0x16b338(0x20b)]('\x20\x20\x20💰\x20Total\x20payout:\x20'+_0x2361eb[_0x16b338(0x27d)]+_0x16b338(0x2cb)),console[_0x16b338(0x20b)](_0x16b338(0x21a)+_0x2361eb[_0x16b338(0x234)]+_0x16b338(0x282)),console[_0x16b338(0x20b)](_0x16b338(0x213)+_0x2361eb[_0x16b338(0x29b)]+_0x16b338(0x1de)),console['log'](_0x16b338(0x2dd)+_0x2361eb['thisMonth']+_0x16b338(0x28a)),console['log'](_0x16b338(0x1f4)+_0x2361eb[_0x16b338(0x2e7)]+'\x20PAID\x20payments'),console[_0x16b338(0x20b)](_0x16b338(0x2c2)+(_0x4754a1[_0x16b338(0x22c)][_0x16b338(0x2b1)]||0x0)[_0x16b338(0x2be)](0x2)+'\x20USDT\x20(without\x20commission)'),console[_0x16b338(0x20b)]('\x20\x20\x20📊\x20Commission\x20difference:\x20'+((_0x4754a1[_0x16b338(0x22c)][_0x16b338(0x2b1)]||0x0)-_0x3e7b45)[_0x16b338(0x2be)](0x2)+_0x16b338(0x28a)),_0x2361eb;}async[a35_0x29c225(0x25a)](_0x9066a4,_0x3fec6c){const _0xee33d0=a35_0x29c225;console[_0xee33d0(0x20b)](_0xee33d0(0x1ec)+_0x9066a4+':',_0x3fec6c);const _0x431716=await database_1[_0xee33d0(0x278)][_0xee33d0(0x1e1)][_0xee33d0(0x1f8)]({'where':{'id':_0x9066a4},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x431716)throw new Error(_0xee33d0(0x20a));const _0x5bbec1={};_0x3fec6c[_0xee33d0(0x2c6)]!==undefined&&(_0x5bbec1[_0xee33d0(0x2c6)]=_0x3fec6c['customerCountry']||null);_0x3fec6c[_0xee33d0(0x2ba)]!==undefined&&(_0x5bbec1[_0xee33d0(0x2ba)]=_0x3fec6c['customerIp']||null);_0x3fec6c[_0xee33d0(0x2e6)]!==undefined&&(_0x5bbec1[_0xee33d0(0x2e6)]=_0x3fec6c['customerUa']||null);const _0x173459=await database_1[_0xee33d0(0x278)][_0xee33d0(0x1e1)][_0xee33d0(0x20e)]({'where':{'id':_0x9066a4},'data':{..._0x5bbec1,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0xee33d0(0x20b)](_0xee33d0(0x210)+_0x9066a4),console[_0xee33d0(0x20b)](_0xee33d0(0x1d8)+_0x431716['customerCountry']+_0xee33d0(0x2d1)+_0x173459['customerCountry']),console[_0xee33d0(0x20b)](_0xee33d0(0x1fa)+_0x431716[_0xee33d0(0x2ba)]+_0xee33d0(0x2d1)+_0x173459['customerIp']),console[_0xee33d0(0x20b)](_0xee33d0(0x28d)+(_0x431716[_0xee33d0(0x2e6)]?'set':'not\x20set')+_0xee33d0(0x2d1)+(_0x173459[_0xee33d0(0x2e6)]?_0xee33d0(0x1f3):'not\x20set')),_0x173459;}async[a35_0x29c225(0x2d3)](_0x4dad50){const _0x425509=a35_0x29c225,_0x4ff2d4=new Date();let _0x24ddb4;switch(_0x4dad50){case'7d':_0x24ddb4=new Date(_0x4ff2d4[_0x425509(0x24c)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x425509(0x2dc):_0x24ddb4=new Date(_0x4ff2d4[_0x425509(0x24c)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x425509(0x2ce):_0x24ddb4=new Date(_0x4ff2d4[_0x425509(0x24c)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x425509(0x2d5):const _0x1cc6f9=await database_1[_0x425509(0x278)][_0x425509(0x1e1)][_0x425509(0x271)]({'where':{'gateway':{'not':_0x425509(0x26b)}},'orderBy':{'createdAt':'asc'},'select':{'createdAt':!![]}});_0x24ddb4=_0x1cc6f9?_0x1cc6f9['createdAt']:new Date('2020-01-01'),console[_0x425509(0x20b)](_0x425509(0x212)+_0x24ddb4[_0x425509(0x2b8)]());break;default:_0x24ddb4=new Date(_0x4ff2d4[_0x425509(0x24c)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x1b9b10,_0x4a5730,_0x34d32f,_0x261a92,_0x10c7b1,_0x1d3f16,_0x4ac530]=await Promise[_0x425509(0x2d5)]([database_1[_0x425509(0x278)][_0x425509(0x268)][_0x425509(0x21f)](),database_1[_0x425509(0x278)]['shop'][_0x425509(0x21f)]({'where':{'status':_0x425509(0x281)}}),database_1[_0x425509(0x278)][_0x425509(0x1e1)][_0x425509(0x21f)]({'where':{'createdAt':{'gte':_0x24ddb4},'gateway':{'not':'test_gateway'}}}),database_1[_0x425509(0x278)]['payment'][_0x425509(0x21f)]({'where':{'status':_0x425509(0x22f),'createdAt':{'gte':_0x24ddb4},'gateway':{'not':_0x425509(0x26b)}}}),database_1['default'][_0x425509(0x1e1)][_0x425509(0x2df)]({'where':{'status':_0x425509(0x22f),'createdAt':{'gte':_0x24ddb4},'gateway':{'not':_0x425509(0x26b)}},'select':{'amount':!![],'currency':!![]}}),database_1[_0x425509(0x278)]['payment'][_0x425509(0x2df)]({'where':{'gateway':{'not':_0x425509(0x26b)}},'take':0xa,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x425509(0x278)][_0x425509(0x1e1)][_0x425509(0x2df)]({'where':{'createdAt':{'gte':_0x24ddb4},'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0xf5c1c0=0x0;for(const _0x20a4eb of _0x10c7b1){const _0x288480=await currencyService_1[_0x425509(0x28b)]['convertToUSDT'](_0x20a4eb[_0x425509(0x21d)],_0x20a4eb[_0x425509(0x233)]);_0xf5c1c0+=_0x288480;}const _0x25f002=this[_0x425509(0x263)](_0x4ac530,_0x24ddb4,_0x4ff2d4),_0xdf260c=_0x34d32f>0x0?_0x261a92/_0x34d32f*0x64:0x0;return{'totalShops':_0x1b9b10,'activeShops':_0x4a5730,'totalPayments':_0x34d32f,'successfulPayments':_0x261a92,'totalRevenue':Math[_0x425509(0x228)](_0xf5c1c0*0x64)/0x64,'conversionRate':Math[_0x425509(0x228)](_0xdf260c*0x64)/0x64,'dailyRevenue':_0x25f002[_0x425509(0x2bf)],'dailyPayments':_0x25f002[_0x425509(0x28c)],'recentPayments':_0x1d3f16[_0x425509(0x1d7)](_0x38709f=>({'id':_0x38709f['id'],'amount':_0x38709f['amount'],'currency':_0x38709f[_0x425509(0x233)],'status':_0x38709f[_0x425509(0x25f)],'gateway':_0x38709f[_0x425509(0x217)],'shop':_0x38709f[_0x425509(0x268)],'createdAt':_0x38709f[_0x425509(0x258)]}))};}async['getMerchantStatistics'](_0x406e63){const _0x1b991d=a35_0x29c225;console[_0x1b991d(0x20b)]('📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:',_0x406e63);let _0xd29969,_0x502661=new Date();if(_0x406e63[_0x1b991d(0x2a9)]===_0x1b991d(0x293)&&_0x406e63[_0x1b991d(0x22d)]&&_0x406e63[_0x1b991d(0x277)])_0xd29969=new Date(_0x406e63[_0x1b991d(0x22d)]),_0x502661=new Date(_0x406e63['dateTo']);else{const _0x471155=new Date();switch(_0x406e63[_0x1b991d(0x2a9)]){case _0x1b991d(0x259):_0xd29969=new Date(_0x471155[_0x1b991d(0x24c)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x1b991d(0x2b6):_0xd29969=new Date(_0x471155['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x1b991d(0x2b9):_0xd29969=new Date(_0x471155[_0x1b991d(0x24c)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x1b991d(0x2d5):default:_0xd29969=new Date(_0x1b991d(0x1e7));break;}}console['log'](_0x1b991d(0x201)+_0xd29969['toISOString']()+'\x20to\x20'+_0x502661[_0x1b991d(0x2b8)]());const _0x185995={'status':_0x1b991d(0x22f),'gateway':{'not':_0x1b991d(0x26b)},'paidAt':{'gte':_0xd29969,'lte':_0x502661}};_0x406e63[_0x1b991d(0x290)]&&(_0x185995[_0x1b991d(0x290)]=_0x406e63[_0x1b991d(0x290)]);const _0x5e664d=await database_1[_0x1b991d(0x278)]['payment'][_0x1b991d(0x2df)]({'where':_0x185995,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x1b991d(0x20b)](_0x1b991d(0x2ed)+_0x5e664d[_0x1b991d(0x276)]+'\x20paid\x20payments\x20for\x20analysis');const _0xe7ae6={'gateway':{'not':_0x1b991d(0x26b)},'createdAt':{'gte':_0xd29969,'lte':_0x502661}};_0x406e63[_0x1b991d(0x290)]&&(_0xe7ae6['shopId']=_0x406e63[_0x1b991d(0x290)]);const _0x18e4e4=await database_1[_0x1b991d(0x278)][_0x1b991d(0x1e1)][_0x1b991d(0x21f)]({'where':_0xe7ae6});console[_0x1b991d(0x20b)](_0x1b991d(0x20c)+_0x18e4e4+_0x1b991d(0x2cd)+_0x5e664d['length']);let _0x83b8d0=0x0,_0x1e9eb2=0x0,_0x1e7cb5=0x0;const _0x20ea61={},_0x803349={},_0x30b23e={};for(const _0x56de5d of _0x5e664d){try{const _0xed27c=await currencyService_1[_0x1b991d(0x28b)][_0x1b991d(0x1e3)](_0x56de5d[_0x1b991d(0x21d)],_0x56de5d[_0x1b991d(0x233)]);let _0x311ab1={};if(_0x56de5d['shop'][_0x1b991d(0x2ac)])try{_0x311ab1=JSON['parse'](_0x56de5d['shop'][_0x1b991d(0x2ac)]);}catch(_0x15f7e1){console[_0x1b991d(0x255)](_0x1b991d(0x29c)+_0x56de5d[_0x1b991d(0x290)]+':',_0x15f7e1);}let _0x247892={},_0x1dbe73=0xa;for(const [_0x6bc694,_0x54a0dc]of Object[_0x1b991d(0x269)](_0x311ab1)){if(_0x6bc694[_0x1b991d(0x2ae)]()===_0x56de5d[_0x1b991d(0x217)][_0x1b991d(0x2ae)]()){_0x247892=_0x54a0dc,_0x1dbe73=_0x54a0dc[_0x1b991d(0x1db)]||0xa;break;}}const _0x45c7b8=_0xed27c*(_0x1dbe73/0x64),_0x5346a0=_0xed27c-_0x45c7b8;_0x83b8d0+=_0xed27c,_0x1e9eb2+=_0x5346a0,_0x1e7cb5+=_0x45c7b8;!_0x20ea61[_0x56de5d[_0x1b991d(0x217)]]&&(_0x20ea61[_0x56de5d[_0x1b991d(0x217)]]={'gateway':_0x56de5d[_0x1b991d(0x217)],'gatewayDisplayName':this['getGatewayDisplayName'](_0x56de5d[_0x1b991d(0x217)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x20ea61[_0x56de5d[_0x1b991d(0x217)]][_0x1b991d(0x216)]++,_0x20ea61[_0x56de5d[_0x1b991d(0x217)]][_0x1b991d(0x253)]+=_0xed27c,_0x20ea61[_0x56de5d[_0x1b991d(0x217)]][_0x1b991d(0x2a8)]+=_0x45c7b8,_0x20ea61[_0x56de5d['gateway']][_0x1b991d(0x1f5)]+=_0x5346a0,_0x20ea61[_0x56de5d[_0x1b991d(0x217)]]['totalCommissionRate']+=_0x1dbe73;!_0x406e63[_0x1b991d(0x290)]&&(!_0x803349[_0x56de5d[_0x1b991d(0x290)]]&&(_0x803349[_0x56de5d['shopId']]={'shopId':_0x56de5d['shopId'],'shopName':_0x56de5d[_0x1b991d(0x268)]['name'],'shopUsername':_0x56de5d[_0x1b991d(0x268)]['username'],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x803349[_0x56de5d[_0x1b991d(0x290)]][_0x1b991d(0x216)]++,_0x803349[_0x56de5d[_0x1b991d(0x290)]][_0x1b991d(0x253)]+=_0xed27c,_0x803349[_0x56de5d[_0x1b991d(0x290)]][_0x1b991d(0x2a8)]+=_0x45c7b8,_0x803349[_0x56de5d[_0x1b991d(0x290)]][_0x1b991d(0x1f5)]+=_0x5346a0);const _0x3beb20=_0x56de5d[_0x1b991d(0x2b0)]['toISOString']()[_0x1b991d(0x2e0)]('T')[0x0];!_0x30b23e[_0x3beb20]&&(_0x30b23e[_0x3beb20]={'date':_0x3beb20,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x30b23e[_0x3beb20][_0x1b991d(0x1f1)]+=_0xed27c,_0x30b23e[_0x3beb20][_0x1b991d(0x2cc)]+=_0x5346a0,_0x30b23e[_0x3beb20]['gatewayEarnings']+=_0x45c7b8,_0x30b23e[_0x3beb20][_0x1b991d(0x216)]++;}catch(_0x272403){console[_0x1b991d(0x255)]('Error\x20processing\x20payment\x20'+_0x56de5d['id']+':',_0x272403);}}Object[_0x1b991d(0x1eb)](_0x20ea61)[_0x1b991d(0x223)](_0x4e7f25=>{const _0x16fea9=_0x1b991d;_0x4e7f25[_0x16fea9(0x28f)]=_0x4e7f25['paymentsCount']>0x0?_0x4e7f25['totalCommissionRate']/_0x4e7f25[_0x16fea9(0x216)]:0x0,delete _0x4e7f25[_0x16fea9(0x20d)];}),Object[_0x1b991d(0x1eb)](_0x803349)[_0x1b991d(0x223)](_0x2ccf39=>{const _0x37fa5e=_0x1b991d;_0x2ccf39[_0x37fa5e(0x2da)]=_0x2ccf39[_0x37fa5e(0x216)]>0x0?_0x2ccf39[_0x37fa5e(0x253)]/_0x2ccf39[_0x37fa5e(0x216)]:0x0;});let _0x59e8b5=0x0;if(_0x406e63['shopId']){const _0x5a709f=await database_1[_0x1b991d(0x278)][_0x1b991d(0x1e6)]['findMany']({'where':{'shopId':_0x406e63[_0x1b991d(0x290)],'status':_0x1b991d(0x29e),'createdAt':{'gte':_0xd29969,'lte':_0x502661}},'select':{'amount':!![]}});_0x59e8b5=_0x5a709f[_0x1b991d(0x2e8)]((_0x5cf736,_0x555094)=>_0x5cf736+_0x555094[_0x1b991d(0x21d)],0x0);}const _0x36552c=_0x18e4e4,_0x1350d4=_0x5e664d[_0x1b991d(0x276)],_0x400d1e=_0x1350d4>0x0?_0x83b8d0/_0x1350d4:0x0,_0x75b269=_0x36552c>0x0?Math['round'](_0x1350d4/_0x36552c*0x2710)/0x64:0x0,_0x2f867c=Math['ceil']((_0x502661['getTime']()-_0xd29969[_0x1b991d(0x24c)]())/(0x3e8*0x3c*0x3c*0x18)),_0xb546fd={'totalTurnover':Math['round'](_0x83b8d0*0x64)/0x64,'merchantEarnings':Math[_0x1b991d(0x228)](_0x1e9eb2*0x64)/0x64,'gatewayEarnings':Math[_0x1b991d(0x228)](_0x1e7cb5*0x64)/0x64,'totalPaidOut':Math['round'](_0x59e8b5*0x64)/0x64,'averageCheck':Math['round'](_0x400d1e*0x64)/0x64,'totalPayments':_0x36552c,'successfulPayments':_0x1350d4,'conversionRate':_0x75b269,'gatewayBreakdown':Object[_0x1b991d(0x1eb)](_0x20ea61)['map'](_0x4955a7=>({..._0x4955a7,'turnoverUSDT':Math['round'](_0x4955a7[_0x1b991d(0x253)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x4955a7[_0x1b991d(0x2a8)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x1b991d(0x228)](_0x4955a7[_0x1b991d(0x1f5)]*0x64)/0x64,'averageCommissionRate':Math[_0x1b991d(0x228)](_0x4955a7[_0x1b991d(0x28f)]*0x64)/0x64})),'merchantBreakdown':_0x406e63['shopId']?undefined:Object[_0x1b991d(0x1eb)](_0x803349)[_0x1b991d(0x1d7)](_0x17ef64=>({..._0x17ef64,'turnoverUSDT':Math[_0x1b991d(0x228)](_0x17ef64['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x1b991d(0x228)](_0x17ef64[_0x1b991d(0x2a8)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x17ef64['merchantEarningsUSDT']*0x64)/0x64,'paidOutUSDT':Math[_0x1b991d(0x228)](_0x17ef64['paidOutUSDT']*0x64)/0x64,'averageCheckUSDT':Math[_0x1b991d(0x228)](_0x17ef64[_0x1b991d(0x2da)]*0x64)/0x64})),'dailyData':Object['values'](_0x30b23e)[_0x1b991d(0x1d7)](_0x2fcb04=>({..._0x2fcb04,'turnover':Math[_0x1b991d(0x228)](_0x2fcb04[_0x1b991d(0x1f1)]*0x64)/0x64,'merchantEarnings':Math['round'](_0x2fcb04[_0x1b991d(0x2cc)]*0x64)/0x64,'gatewayEarnings':Math[_0x1b991d(0x228)](_0x2fcb04[_0x1b991d(0x2d9)]*0x64)/0x64}))[_0x1b991d(0x287)]((_0x24955d,_0x4654c5)=>_0x24955d[_0x1b991d(0x296)]['localeCompare'](_0x4654c5[_0x1b991d(0x296)])),'periodInfo':{'from':_0xd29969,'to':_0x502661,'periodType':_0x406e63[_0x1b991d(0x2a9)]||_0x1b991d(0x293),'daysCount':_0x2f867c}};return console[_0x1b991d(0x20b)]('📊\x20Merchant\x20statistics\x20calculated:'),console[_0x1b991d(0x20b)](_0x1b991d(0x1f6)+_0xb546fd['totalTurnover']+_0x1b991d(0x28a)),console[_0x1b991d(0x20b)](_0x1b991d(0x200)+_0xb546fd[_0x1b991d(0x2cc)]+_0x1b991d(0x28a)),console['log'](_0x1b991d(0x2b2)+_0xb546fd[_0x1b991d(0x2d9)]+'\x20USDT'),console[_0x1b991d(0x20b)](_0x1b991d(0x206)+_0xb546fd[_0x1b991d(0x2e7)]),_0xb546fd;}async[a35_0x29c225(0x231)](){const _0x1bfb6d=a35_0x29c225;console[_0x1bfb6d(0x20b)]('📋\x20Getting\x20merchants\x20selection\x20list...');const _0x44144f=await database_1[_0x1bfb6d(0x278)][_0x1bfb6d(0x268)][_0x1bfb6d(0x2df)]({'where':{'status':_0x1bfb6d(0x281)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x1bfb6d(0x1df)}});return console[_0x1bfb6d(0x20b)](_0x1bfb6d(0x25b)+_0x44144f[_0x1bfb6d(0x276)]+_0x1bfb6d(0x262)),_0x44144f[_0x1bfb6d(0x1d7)](_0x2a3180=>({'id':_0x2a3180['id'],'username':_0x2a3180['username'],'name':_0x2a3180[_0x1bfb6d(0x24f)]}));}['getGatewayDisplayName'](_0x91807b){const _0x36c9c4=a35_0x29c225,_0x591086={'test_gateway':'Test\x20Gateway','plisio':'Plisio','rapyd':_0x36c9c4(0x243),'noda':_0x36c9c4(0x2bd),'cointopay':_0x36c9c4(0x23e),'klyme_eu':_0x36c9c4(0x285),'klyme_gb':_0x36c9c4(0x237),'klyme_de':_0x36c9c4(0x241)};return _0x591086[_0x91807b]||_0x91807b;}async['getMerchantsAwaitingPayout'](_0x3355b6){const _0x118c7e=a35_0x29c225,{page:_0x7d636c,limit:_0x4e8e5a,minAmount:_0x4ac5c8,search:_0x121847}=_0x3355b6,_0x1a05cf=(_0x7d636c-0x1)*_0x4e8e5a;console['log'](_0x118c7e(0x21b),_0x3355b6);const _0x1ca1aa={'balance':{'gt':0x0},'status':'ACTIVE'};_0x4ac5c8&&(_0x1ca1aa['balance'][_0x118c7e(0x2ab)]=_0x4ac5c8);_0x121847&&(_0x1ca1aa['OR']=[{'name':{'contains':_0x121847,'mode':'insensitive'}},{'username':{'contains':_0x121847,'mode':_0x118c7e(0x2e4)}}]);const [_0x3e4e9e,_0x56dbd0]=await Promise[_0x118c7e(0x2d5)]([database_1['default']['shop']['findMany']({'where':_0x1ca1aa,'skip':_0x1a05cf,'take':_0x4e8e5a,'orderBy':{'balance':_0x118c7e(0x246)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1['default']['shop']['count']({'where':_0x1ca1aa})]);console[_0x118c7e(0x20b)](_0x118c7e(0x2ed)+_0x3e4e9e[_0x118c7e(0x276)]+'\x20merchants\x20with\x20positive\x20balance');const _0x2d78d2=await Promise[_0x118c7e(0x2d5)](_0x3e4e9e[_0x118c7e(0x1d7)](async _0x5786c8=>{const _0x4a7572=_0x118c7e,[_0x1982e3,_0x3b3abd,_0x52c09a]=await Promise['all']([database_1[_0x4a7572(0x278)][_0x4a7572(0x1e1)][_0x4a7572(0x21f)]({'where':{'shopId':_0x5786c8['id'],'status':'PAID','amountUSDT':{'not':null}}}),database_1[_0x4a7572(0x278)][_0x4a7572(0x1e1)]['findFirst']({'where':{'shopId':_0x5786c8['id'],'status':_0x4a7572(0x22f),'amountUSDT':{'not':null}},'orderBy':{'paidAt':_0x4a7572(0x1df)},'select':{'paidAt':!![]}}),database_1[_0x4a7572(0x278)][_0x4a7572(0x1e1)][_0x4a7572(0x27b)]({'by':[_0x4a7572(0x217)],'where':{'shopId':_0x5786c8['id'],'status':_0x4a7572(0x22f),'amountUSDT':{'not':null}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x4eff65=new Date(),_0x1f2b5a=new Date(_0x4eff65['getFullYear'](),_0x4eff65[_0x4a7572(0x2a4)](),0x1),_0x4a85ae=new Date(_0x4eff65[_0x4a7572(0x227)](),_0x4eff65['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x455498,_0x4f8ae7]=await Promise[_0x4a7572(0x2d5)]([database_1[_0x4a7572(0x278)][_0x4a7572(0x1e6)]['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x5786c8['id'],'status':_0x4a7572(0x29e)}}),database_1['default'][_0x4a7572(0x1e6)]['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x5786c8['id'],'status':_0x4a7572(0x29e),'createdAt':{'gte':_0x1f2b5a,'lte':_0x4a85ae}}})]),_0x262d65=_0x455498[_0x4a7572(0x22c)][_0x4a7572(0x21d)]||0x0,_0x5a0500=_0x4f8ae7['_sum'][_0x4a7572(0x21d)]||0x0,_0x223a70=await Promise[_0x4a7572(0x2d5)](_0x52c09a[_0x4a7572(0x1d7)](async _0x532c14=>{const _0x185b47=_0x4a7572;let _0x4e62c1=0xa;if(_0x5786c8[_0x185b47(0x2ac)])try{const _0x4717fd=JSON[_0x185b47(0x1dd)](_0x5786c8[_0x185b47(0x2ac)]);for(const [_0x14cd3f,_0x5c34e0]of Object[_0x185b47(0x269)](_0x4717fd)){if(_0x14cd3f[_0x185b47(0x2ae)]()===_0x532c14['gateway'][_0x185b47(0x2ae)]()){_0x4e62c1=_0x5c34e0['commission']||0xa,console['log'](_0x185b47(0x247)+_0x532c14[_0x185b47(0x217)]+_0x185b47(0x229)+_0x5786c8['id']+_0x185b47(0x1fb)+_0x4e62c1+'%');break;}}}catch(_0x7f6810){console[_0x185b47(0x255)](_0x185b47(0x29c)+_0x5786c8['id']+':',_0x7f6810);}const _0x4a725f=_0x532c14['_sum'][_0x185b47(0x1fc)]||0x0,_0x4aaab7=_0x4a725f*(0x1-_0x4e62c1/0x64);return{'gateway':_0x532c14[_0x185b47(0x217)],'count':_0x532c14[_0x185b47(0x2e3)]['id'],'amountUSDT':Math[_0x185b47(0x228)](_0x4a725f*0x64)/0x64,'amountAfterCommissionUSDT':Math['round'](_0x4aaab7*0x64)/0x64,'commission':_0x4e62c1};})),_0x53b1cf=_0x223a70['reduce']((_0x124a6c,_0x4ac8cd)=>_0x124a6c+_0x4ac8cd[_0x4a7572(0x1fc)],0x0),_0x4f7bb5=_0x5786c8[_0x4a7572(0x2b1)];return console[_0x4a7572(0x20b)]('💰\x20[PAYOUT]\x20Merchant\x20'+_0x5786c8['username']+':'),console[_0x4a7572(0x20b)](_0x4a7572(0x2e2)+_0x53b1cf[_0x4a7572(0x2be)](0x2)+_0x4a7572(0x26f)),console[_0x4a7572(0x20b)](_0x4a7572(0x265)+_0x223a70['reduce']((_0x31cf7e,_0xba379c)=>_0x31cf7e+_0xba379c[_0x4a7572(0x270)],0x0)[_0x4a7572(0x2be)](0x2)+_0x4a7572(0x254)),console[_0x4a7572(0x20b)]('\x20\x20\x20✅\x20Actual\x20available\x20balance:\x20'+_0x4f7bb5[_0x4a7572(0x2be)](0x2)+'\x20USDT\x20(after\x20payouts)'),{'id':_0x5786c8['id'],'fullName':_0x5786c8['name'],'username':_0x5786c8['username'],'telegramId':_0x5786c8['telegram'],'merchantUrl':_0x5786c8[_0x4a7572(0x251)],'wallets':{'usdtPolygonWallet':_0x5786c8['usdtPolygonWallet'],'usdtTrcWallet':_0x5786c8[_0x4a7572(0x26e)],'usdtErcWallet':_0x5786c8[_0x4a7572(0x295)],'usdcPolygonWallet':_0x5786c8[_0x4a7572(0x202)]},'totalAmountUSDT':Math[_0x4a7572(0x228)](_0x53b1cf*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x4a7572(0x228)](_0x4f7bb5*0x64)/0x64,'totalPayout':Math['round'](_0x262d65*0x64)/0x64,'thisMonth':Math[_0x4a7572(0x228)](_0x5a0500*0x64)/0x64,'paymentsCount':_0x1982e3,'oldestPaymentDate':_0x3b3abd?.[_0x4a7572(0x2b0)]||_0x5786c8[_0x4a7572(0x258)],'gatewayBreakdown':_0x223a70};})),_0x2e5713=_0x2d78d2['reduce']((_0x5eee3b,_0x4225b3)=>_0x5eee3b+_0x4225b3[_0x118c7e(0x2c0)],0x0),_0x2396b1=_0x2d78d2['reduce']((_0x328810,_0x965b94)=>_0x328810+_0x965b94[_0x118c7e(0x2d2)],0x0),_0xb315c1=_0x2d78d2[_0x118c7e(0x2e8)]((_0x47e928,_0xe167e0)=>_0x47e928+_0xe167e0[_0x118c7e(0x27d)],0x0),_0x1e0718=_0x2d78d2[_0x118c7e(0x2e8)]((_0x20acd3,_0x373732)=>_0x20acd3+_0x373732[_0x118c7e(0x24a)],0x0);return console[_0x118c7e(0x20b)](_0x118c7e(0x219)+_0x56dbd0+_0x118c7e(0x1f9)),console[_0x118c7e(0x20b)](_0x118c7e(0x1f0)+Math[_0x118c7e(0x228)](_0x2e5713*0x64)/0x64+'\x20USDT\x20(gross\x20revenue)'),console['log'](_0x118c7e(0x26a)+Math[_0x118c7e(0x228)](_0x2396b1*0x64)/0x64+_0x118c7e(0x257)),console[_0x118c7e(0x20b)](_0x118c7e(0x2aa)+Math['round'](_0xb315c1*0x64)/0x64+_0x118c7e(0x28a)),console[_0x118c7e(0x20b)](_0x118c7e(0x236)+Math[_0x118c7e(0x228)](_0x1e0718*0x64)/0x64+'\x20USDT'),{'merchants':_0x2d78d2,'pagination':{'page':_0x7d636c,'limit':_0x4e8e5a,'total':_0x56dbd0,'totalPages':Math[_0x118c7e(0x22a)](_0x56dbd0/_0x4e8e5a)},'summary':{'totalMerchants':_0x56dbd0,'totalAmountUSDT':Math[_0x118c7e(0x228)](_0x2e5713*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x118c7e(0x228)](_0x2396b1*0x64)/0x64,'totalPayout':Math[_0x118c7e(0x228)](_0xb315c1*0x64)/0x64,'thisMonth':Math[_0x118c7e(0x228)](_0x1e0718*0x64)/0x64}};}async['createPayout'](_0xb9bf84){const _0x2376f2=a35_0x29c225,{shopId:_0x207edf,amount:_0x2c0844,network:_0x409f7c,wallet:_0x43e8bb,notes:_0x2b7e21,txid:_0x3b08e3,periodFrom:_0x384f24,periodTo:_0x215f29}=_0xb9bf84,_0x3ddfe3=await database_1[_0x2376f2(0x278)][_0x2376f2(0x29d)](async _0x507e70=>{const _0x19ad87=_0x2376f2,_0x4638ab=await _0x507e70[_0x19ad87(0x268)][_0x19ad87(0x1f8)]({'where':{'id':_0x207edf},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x4638ab)throw new Error('Shop\x20not\x20found');console[_0x19ad87(0x20b)](_0x19ad87(0x1d9)+_0x4638ab[_0x19ad87(0x2e9)]+':'),console[_0x19ad87(0x20b)](_0x19ad87(0x211)+_0x4638ab[_0x19ad87(0x2b1)]['toFixed'](0x6)+'\x20USDT'),console[_0x19ad87(0x20b)](_0x19ad87(0x214)+_0x2c0844[_0x19ad87(0x2be)](0x6)+_0x19ad87(0x28a)),console[_0x19ad87(0x20b)](_0x19ad87(0x209)+_0x4638ab[_0x19ad87(0x230)][_0x19ad87(0x2be)](0x6)+_0x19ad87(0x28a));if(_0x3b08e3)console['log'](_0x19ad87(0x2a2)+_0x3b08e3);if(_0x4638ab[_0x19ad87(0x2b1)]<_0x2c0844)throw new Error(_0x19ad87(0x220)+_0x4638ab[_0x19ad87(0x2b1)]['toFixed'](0x6)+_0x19ad87(0x275)+_0x2c0844[_0x19ad87(0x2be)](0x6)+_0x19ad87(0x28a));let _0x3f6e08=_0x43e8bb;if(!_0x3f6e08){const _0x17ad31=await _0x507e70[_0x19ad87(0x268)][_0x19ad87(0x1f8)]({'where':{'id':_0x207edf},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x17ad31)switch(_0x409f7c){case _0x19ad87(0x297):_0x3f6e08=_0x17ad31[_0x19ad87(0x2db)]||undefined;break;case'trc20':_0x3f6e08=_0x17ad31[_0x19ad87(0x26e)]||undefined;break;case _0x19ad87(0x2ca):_0x3f6e08=_0x17ad31[_0x19ad87(0x295)]||undefined;break;case _0x19ad87(0x1f7):_0x3f6e08=_0x17ad31[_0x19ad87(0x202)]||undefined;break;}}console[_0x19ad87(0x20b)]('💳\x20Payout\x20wallet\x20for\x20'+_0x409f7c+':\x20'+(_0x3f6e08||_0x19ad87(0x27a)));const _0x1da8c1=await _0x507e70[_0x19ad87(0x1e6)]['create']({'data':{'shopId':_0x207edf,'amount':_0x2c0844,'network':_0x409f7c,'status':_0x19ad87(0x29e),'txid':_0x3b08e3,'notes':_0x2b7e21,'periodFrom':_0x384f24?new Date(_0x384f24):null,'periodTo':_0x215f29?new Date(_0x215f29):null,'createdAt':new Date(),'paidAt':new Date()}}),_0xae2799=_0x4638ab[_0x19ad87(0x2b1)]-_0x2c0844,_0x83f8d2=_0x4638ab[_0x19ad87(0x230)]+_0x2c0844;return await _0x507e70[_0x19ad87(0x268)][_0x19ad87(0x20e)]({'where':{'id':_0x207edf},'data':{'balance':_0xae2799,'totalPaidOut':_0x83f8d2}}),console[_0x19ad87(0x20b)]('💰\x20Shop\x20'+_0x4638ab['username']+_0x19ad87(0x21e)),console[_0x19ad87(0x20b)](_0x19ad87(0x252)+_0x4638ab[_0x19ad87(0x2b1)][_0x19ad87(0x2be)](0x6)+_0x19ad87(0x2d1)+_0xae2799[_0x19ad87(0x2be)](0x6)+_0x19ad87(0x299)+_0x2c0844['toFixed'](0x6)+')'),console[_0x19ad87(0x20b)]('\x20\x20\x20Total\x20paid\x20out:\x20'+_0x4638ab[_0x19ad87(0x230)][_0x19ad87(0x2be)](0x6)+'\x20->\x20'+_0x83f8d2['toFixed'](0x6)+_0x19ad87(0x232)+_0x2c0844[_0x19ad87(0x2be)](0x6)+')'),{'payout':_0x1da8c1,'shop':_0x4638ab};});return console[_0x2376f2(0x20b)]('✅\x20Payout\x20created:\x20'+_0x3ddfe3['payout']['id']+_0x2376f2(0x229)+_0x3ddfe3[_0x2376f2(0x268)][_0x2376f2(0x2e9)]+'\x20('+_0x2c0844+'\x20USDT)'),{'id':_0x3ddfe3[_0x2376f2(0x1e6)]['id'],'shopId':_0x3ddfe3[_0x2376f2(0x1e6)][_0x2376f2(0x290)],'shopName':_0x3ddfe3[_0x2376f2(0x268)][_0x2376f2(0x24f)],'shopUsername':_0x3ddfe3[_0x2376f2(0x268)][_0x2376f2(0x2e9)],'amount':_0x3ddfe3[_0x2376f2(0x1e6)][_0x2376f2(0x21d)],'network':_0x3ddfe3['payout'][_0x2376f2(0x248)],'status':_0x3ddfe3['payout'][_0x2376f2(0x25f)],'txid':_0x3ddfe3[_0x2376f2(0x1e6)][_0x2376f2(0x2bc)],'notes':_0x3ddfe3[_0x2376f2(0x1e6)][_0x2376f2(0x2c9)],'periodFrom':_0x3ddfe3[_0x2376f2(0x1e6)][_0x2376f2(0x256)],'periodTo':_0x3ddfe3[_0x2376f2(0x1e6)][_0x2376f2(0x273)],'createdAt':_0x3ddfe3['payout'][_0x2376f2(0x258)],'paidAt':_0x3ddfe3[_0x2376f2(0x1e6)][_0x2376f2(0x2b0)]};}async[a35_0x29c225(0x25d)](_0x4f699e){const _0x5740fc=a35_0x29c225,{page:_0x2b7026,limit:_0xf9c36f,shopId:_0x2733ed,network:_0x38319c,dateFrom:_0x340ea5,dateTo:_0x2617e6,search:_0x2447d0}=_0x4f699e,_0x28b694=(_0x2b7026-0x1)*_0xf9c36f,_0x3ee7b4={};_0x2733ed&&(_0x3ee7b4[_0x5740fc(0x290)]=_0x2733ed);_0x38319c&&(_0x3ee7b4[_0x5740fc(0x248)]=_0x38319c);(_0x340ea5||_0x2617e6)&&(_0x3ee7b4[_0x5740fc(0x258)]={},_0x340ea5&&(_0x3ee7b4[_0x5740fc(0x258)]['gte']=new Date(_0x340ea5)),_0x2617e6&&(_0x3ee7b4[_0x5740fc(0x258)][_0x5740fc(0x222)]=new Date(_0x2617e6)));_0x2447d0&&(_0x3ee7b4['OR']=[{'shop':{'name':{'contains':_0x2447d0,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x2447d0,'mode':_0x5740fc(0x2e4)}}},{'notes':{'contains':_0x2447d0,'mode':_0x5740fc(0x2e4)}}]);const [_0x53030a,_0x505f55]=await Promise['all']([database_1[_0x5740fc(0x278)][_0x5740fc(0x1e6)][_0x5740fc(0x2df)]({'where':_0x3ee7b4,'skip':_0x28b694,'take':_0xf9c36f,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x5740fc(0x1e6)][_0x5740fc(0x21f)]({'where':_0x3ee7b4})]);return{'payouts':_0x53030a['map'](_0x322d12=>({'id':_0x322d12['id'],'shopId':_0x322d12[_0x5740fc(0x290)],'shopName':_0x322d12[_0x5740fc(0x268)]['name'],'shopUsername':_0x322d12[_0x5740fc(0x268)]['username'],'amount':_0x322d12[_0x5740fc(0x21d)],'network':_0x322d12['network'],'status':_0x322d12['status'],'txid':_0x322d12[_0x5740fc(0x2bc)],'notes':_0x322d12[_0x5740fc(0x2c9)],'periodFrom':_0x322d12[_0x5740fc(0x256)],'periodTo':_0x322d12['periodTo'],'createdAt':_0x322d12[_0x5740fc(0x258)],'paidAt':_0x322d12['paidAt']})),'pagination':{'page':_0x2b7026,'limit':_0xf9c36f,'total':_0x505f55,'totalPages':Math['ceil'](_0x505f55/_0xf9c36f)}};}async[a35_0x29c225(0x2c8)](_0x461c30){const _0x13dbf6=a35_0x29c225,_0x2ff580=await database_1[_0x13dbf6(0x278)][_0x13dbf6(0x1e6)][_0x13dbf6(0x1f8)]({'where':{'id':_0x461c30},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x2ff580)return null;return{'id':_0x2ff580['id'],'shopId':_0x2ff580[_0x13dbf6(0x290)],'shopName':_0x2ff580[_0x13dbf6(0x268)][_0x13dbf6(0x24f)],'shopUsername':_0x2ff580['shop'][_0x13dbf6(0x2e9)],'amount':_0x2ff580['amount'],'network':_0x2ff580[_0x13dbf6(0x248)],'status':_0x2ff580['status'],'txid':_0x2ff580['txid'],'notes':_0x2ff580[_0x13dbf6(0x2c9)],'periodFrom':_0x2ff580[_0x13dbf6(0x256)],'periodTo':_0x2ff580[_0x13dbf6(0x273)],'createdAt':_0x2ff580[_0x13dbf6(0x258)],'paidAt':_0x2ff580[_0x13dbf6(0x2b0)]};}async[a35_0x29c225(0x204)](_0x31349f){const _0x15b95d=a35_0x29c225;await database_1[_0x15b95d(0x278)][_0x15b95d(0x1e6)][_0x15b95d(0x1e4)]({'where':{'id':_0x31349f}});}async[a35_0x29c225(0x2cf)](_0x2e6d2f){const _0x2ed730=a35_0x29c225,{page:_0x899238,limit:_0x4600c0,status:_0x57a67e,gateway:_0x253783,shopId:_0x42263b,dateFrom:_0x2e952a,dateTo:_0x34e544,search:_0xa78154,currency:_0x29ec81,sortBy:_0x1a3785,sortOrder:_0x29570e}=_0x2e6d2f,_0x54a4e8=(_0x899238-0x1)*_0x4600c0;console[_0x2ed730(0x20b)]('📊\x20Getting\x20payments\x20with\x20filters:',_0x2e6d2f);const _0x478cdc=await database_1[_0x2ed730(0x278)][_0x2ed730(0x1e1)][_0x2ed730(0x27b)]({'by':[_0x2ed730(0x217)],'_count':{'gateway':!![]}});console['log']('📊\x20Available\x20gateways\x20in\x20database:',_0x478cdc['map'](_0x51f2e9=>_0x51f2e9['gateway']+'\x20('+_0x51f2e9[_0x2ed730(0x2e3)][_0x2ed730(0x217)]+_0x2ed730(0x226)));if(_0x253783){const _0x54957e=_0x478cdc['some'](_0x22ab4d=>_0x22ab4d['gateway'][_0x2ed730(0x2ae)]()===_0x253783['toLowerCase']());!_0x54957e&&_0x253783[_0x2ed730(0x2ae)]()!==_0x2ed730(0x26b)&&console['log'](_0x2ed730(0x289)+_0x253783+_0x2ed730(0x22e)+_0x478cdc[_0x2ed730(0x1d7)](_0x11b690=>_0x11b690[_0x2ed730(0x217)])['join'](',\x20'));}const _0x4e7880={};_0x57a67e&&(_0x4e7880['status']=_0x57a67e['toUpperCase']());if(!_0x253783)_0x4e7880[_0x2ed730(0x217)]={'not':_0x2ed730(0x26b)};else{if(_0x253783&&(_0x253783['toLowerCase']()===_0x2ed730(0x26b)||_0x253783===_0x2ed730(0x24e)))_0x4e7880['gateway']='test_gateway';else{let _0x320cc3=_0x253783;const _0x107b87=(0x0,gateway_1['getGatewayNameById'])(_0x253783);if(_0x107b87)_0x320cc3=_0x107b87,console['log'](_0x2ed730(0x23b)+_0x253783+_0x2ed730(0x24d)+_0x320cc3+'\x27');else{const _0x5d0aa4=(0x0,gateway_1['getGatewayIdByName'])(_0x253783);if(_0x5d0aa4){const _0x2b3c66=(0x0,gateway_1[_0x2ed730(0x218)])(_0x5d0aa4);_0x2b3c66&&(_0x320cc3=_0x2b3c66,console[_0x2ed730(0x20b)](_0x2ed730(0x260)+_0x253783+'\x27\x20->\x20ID\x20\x27'+_0x5d0aa4+_0x2ed730(0x1e0)+_0x320cc3+'\x27'));}else console[_0x2ed730(0x20b)](_0x2ed730(0x2d8)+_0x253783+'\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)');}const _0x1c140a=await database_1[_0x2ed730(0x278)][_0x2ed730(0x1e1)][_0x2ed730(0x21f)]({'where':{'gateway':_0x320cc3[_0x2ed730(0x2ae)]()},'take':0x1});_0x1c140a===0x0?(console[_0x2ed730(0x20b)]('⚠️\x20Gateway\x20\x27'+_0x320cc3+_0x2ed730(0x2b7)+_0x253783+'\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result'),_0x4e7880[_0x2ed730(0x217)]=_0x2ed730(0x2a5)):(_0x4e7880[_0x2ed730(0x217)]=_0x320cc3[_0x2ed730(0x2ae)](),console[_0x2ed730(0x20b)](_0x2ed730(0x242)+_0x320cc3+_0x2ed730(0x2b7)+_0x253783+'\x27)'));}}console[_0x2ed730(0x20b)](_0x2ed730(0x1d6),_0x4e7880[_0x2ed730(0x217)]);_0x42263b&&(_0x4e7880[_0x2ed730(0x290)]=_0x42263b);_0x29ec81&&(_0x4e7880['currency']=_0x29ec81[_0x2ed730(0x283)](),console['log'](_0x2ed730(0x1e2)+_0x29ec81[_0x2ed730(0x283)]()));(_0x2e952a||_0x34e544)&&(_0x4e7880[_0x2ed730(0x258)]={},_0x2e952a&&(_0x4e7880[_0x2ed730(0x258)][_0x2ed730(0x2ab)]=new Date(_0x2e952a)),_0x34e544&&(_0x4e7880[_0x2ed730(0x258)][_0x2ed730(0x222)]=new Date(_0x34e544)));_0xa78154&&(_0x4e7880['OR']=[{'id':{'contains':_0xa78154,'mode':_0x2ed730(0x2e4)}},{'orderId':{'contains':_0xa78154,'mode':'insensitive'}},{'gatewayOrderId':{'contains':_0xa78154,'mode':_0x2ed730(0x2e4)}},{'customerEmail':{'contains':_0xa78154,'mode':'insensitive'}},{'shop':{'name':{'contains':_0xa78154,'mode':_0x2ed730(0x2e4)}}},{'shop':{'username':{'contains':_0xa78154,'mode':_0x2ed730(0x2e4)}}}]);console[_0x2ed730(0x20b)](_0x2ed730(0x2de),JSON['stringify'](_0x4e7880,null,0x2));let _0x21938b={'createdAt':'desc'};if(_0x1a3785){const _0x3e7842=[_0x2ed730(0x21d),_0x2ed730(0x258),'updatedAt',_0x2ed730(0x25f),_0x2ed730(0x217),'currency'],_0x1b0182=[_0x2ed730(0x1df),_0x2ed730(0x246)];if(_0x3e7842[_0x2ed730(0x2e1)](_0x1a3785)){const _0x36bbb7=_0x1b0182[_0x2ed730(0x2e1)](_0x29570e)?_0x29570e:_0x2ed730(0x246);_0x21938b={[_0x1a3785]:_0x36bbb7},console[_0x2ed730(0x20b)](_0x2ed730(0x272)+_0x1a3785+'\x20in\x20'+_0x36bbb7+'\x20order');}}const [_0x21121f,_0x19eb71]=await Promise[_0x2ed730(0x2d5)]([database_1[_0x2ed730(0x278)][_0x2ed730(0x1e1)][_0x2ed730(0x2df)]({'where':_0x4e7880,'skip':_0x54a4e8,'take':_0x4600c0,'orderBy':_0x21938b,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x2ed730(0x278)][_0x2ed730(0x1e1)][_0x2ed730(0x21f)]({'where':_0x4e7880})]);return{'payments':_0x21121f[_0x2ed730(0x1d7)](_0x10e72a=>({'id':_0x10e72a['id'],'shopId':_0x10e72a[_0x2ed730(0x290)],'gateway':_0x10e72a['gateway'],'amount':_0x10e72a['amount'],'currency':_0x10e72a[_0x2ed730(0x233)],'status':_0x10e72a[_0x2ed730(0x25f)],'orderId':_0x10e72a[_0x2ed730(0x20f)],'gatewayOrderId':_0x10e72a[_0x2ed730(0x261)],'customerEmail':_0x10e72a[_0x2ed730(0x279)],'customerName':_0x10e72a['customerName'],'customerCountry':_0x10e72a[_0x2ed730(0x2c6)],'customerIp':_0x10e72a[_0x2ed730(0x2ba)],'customerUa':_0x10e72a['customerUa'],'failureMessage':_0x10e72a[_0x2ed730(0x292)],'createdAt':_0x10e72a['createdAt'],'updatedAt':_0x10e72a['updatedAt'],'shop':_0x10e72a['shop']})),'pagination':{'page':_0x899238,'limit':_0x4600c0,'total':_0x19eb71,'totalPages':Math[_0x2ed730(0x22a)](_0x19eb71/_0x4600c0)}};}async['getPaymentById'](_0x5436ca){const _0x5e7756=a35_0x29c225,_0xb32f6c=await database_1[_0x5e7756(0x278)][_0x5e7756(0x1e1)][_0x5e7756(0x1f8)]({'where':{'id':_0x5436ca},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0xb32f6c)return null;return{'id':_0xb32f6c['id'],'shopId':_0xb32f6c[_0x5e7756(0x290)],'gateway':_0xb32f6c[_0x5e7756(0x217)],'amount':_0xb32f6c[_0x5e7756(0x21d)],'currency':_0xb32f6c[_0x5e7756(0x233)],'status':_0xb32f6c[_0x5e7756(0x25f)],'orderId':_0xb32f6c[_0x5e7756(0x20f)],'gatewayOrderId':_0xb32f6c[_0x5e7756(0x261)],'customerEmail':_0xb32f6c[_0x5e7756(0x279)],'customerName':_0xb32f6c[_0x5e7756(0x1dc)],'customerCountry':_0xb32f6c[_0x5e7756(0x2c6)],'customerIp':_0xb32f6c['customerIp'],'customerUa':_0xb32f6c[_0x5e7756(0x2e6)],'failureMessage':_0xb32f6c[_0x5e7756(0x292)],'externalPaymentUrl':_0xb32f6c[_0x5e7756(0x29a)],'successUrl':_0xb32f6c[_0x5e7756(0x2d6)],'failUrl':_0xb32f6c[_0x5e7756(0x264)],'pendingUrl':_0xb32f6c[_0x5e7756(0x244)],'whiteUrl':_0xb32f6c[_0x5e7756(0x225)],'createdAt':_0xb32f6c[_0x5e7756(0x258)],'updatedAt':_0xb32f6c[_0x5e7756(0x250)],'shop':_0xb32f6c[_0x5e7756(0x268)]};}async[a35_0x29c225(0x274)](_0x294b28,_0x502f6e,_0x23d539,_0x46eb86){const _0x39bb8f=a35_0x29c225,_0x468058=await database_1[_0x39bb8f(0x278)][_0x39bb8f(0x29d)](async _0x29d2b9=>{const _0x540f1f=_0x39bb8f,_0x2dcbf6=await _0x29d2b9[_0x540f1f(0x1e1)][_0x540f1f(0x1f8)]({'where':{'id':_0x294b28},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x2dcbf6)throw new Error(_0x540f1f(0x20a));const _0x56140a=_0x2dcbf6[_0x540f1f(0x25f)],_0x52a76a=_0x502f6e[_0x540f1f(0x283)]();console[_0x540f1f(0x20b)]('🔄\x20Admin\x20updating\x20payment\x20'+_0x294b28+_0x540f1f(0x2ad)+_0x56140a+_0x540f1f(0x2d1)+_0x52a76a),console['log']('💰\x20Current\x20shop\x20balance:\x20'+_0x2dcbf6[_0x540f1f(0x268)][_0x540f1f(0x2b1)]+_0x540f1f(0x28a));const _0x3f582c={'status':_0x52a76a,'updatedAt':new Date(),'statusChangedBy':_0x540f1f(0x2c3),'statusChangedAt':new Date()};_0x23d539&&(_0x3f582c[_0x540f1f(0x2ec)]=_0x23d539);_0x52a76a===_0x540f1f(0x2c4)&&_0x46eb86&&(_0x3f582c[_0x540f1f(0x21c)]=_0x46eb86);let _0xc2095f=0x0,_0x597197=_0x2dcbf6[_0x540f1f(0x268)][_0x540f1f(0x2b1)];if(_0x52a76a===_0x540f1f(0x22f)&&_0x56140a!==_0x540f1f(0x22f)){_0x3f582c[_0x540f1f(0x2b0)]=new Date();const _0x42326e=await currencyService_1[_0x540f1f(0x28b)][_0x540f1f(0x1e3)](_0x2dcbf6['amount'],_0x2dcbf6['currency']);_0x3f582c[_0x540f1f(0x1fc)]=_0x42326e;let _0x118d43=0xa;const _0x359f31=await _0x29d2b9['shop']['findUnique']({'where':{'id':_0x2dcbf6[_0x540f1f(0x290)]},'select':{'gatewaySettings':!![]}});if(_0x359f31?.[_0x540f1f(0x2ac)])try{const _0x257dd9=JSON['parse'](_0x359f31[_0x540f1f(0x2ac)]);for(const [_0x43bf98,_0x3974a6]of Object[_0x540f1f(0x269)](_0x257dd9)){if(_0x43bf98[_0x540f1f(0x2ae)]()===_0x2dcbf6[_0x540f1f(0x217)]['toLowerCase']()){_0x118d43=_0x3974a6[_0x540f1f(0x1db)]||0xa;break;}}}catch(_0x49c0c8){console[_0x540f1f(0x255)](_0x540f1f(0x28e)+_0x294b28+':',_0x49c0c8);}const _0x2e2bcd=_0x42326e*(0x1-_0x118d43/0x64);_0xc2095f=_0x2e2bcd,_0x597197+=_0x2e2bcd,console[_0x540f1f(0x20b)](_0x540f1f(0x291)+_0x294b28+_0x540f1f(0x2d4)),console[_0x540f1f(0x20b)](_0x540f1f(0x2d0)+_0x42326e[_0x540f1f(0x2be)](0x6)+_0x540f1f(0x28a)),console[_0x540f1f(0x20b)]('\x20\x20\x20Gateway:\x20'+_0x2dcbf6[_0x540f1f(0x217)]+',\x20Commission:\x20'+_0x118d43+'%'),console[_0x540f1f(0x20b)](_0x540f1f(0x25c)+_0x2e2bcd[_0x540f1f(0x2be)](0x6)+'\x20USDT\x20(after\x20'+_0x118d43+_0x540f1f(0x240)),console[_0x540f1f(0x20b)]('\x20\x20\x20Added\x20to\x20balance:\x20+'+_0x2e2bcd['toFixed'](0x6)+_0x540f1f(0x28a));}else{if(_0x56140a===_0x540f1f(0x22f)&&_0x52a76a!=='PAID'){if(_0x2dcbf6['amountUSDT']){let _0x1ed3e6=0xa;const _0xe3ba0b=await _0x29d2b9[_0x540f1f(0x268)]['findUnique']({'where':{'id':_0x2dcbf6[_0x540f1f(0x290)]},'select':{'gatewaySettings':!![]}});if(_0xe3ba0b?.[_0x540f1f(0x2ac)])try{const _0x280ccf=JSON[_0x540f1f(0x1dd)](_0xe3ba0b[_0x540f1f(0x2ac)]);for(const [_0x4b6806,_0x5d339b]of Object[_0x540f1f(0x269)](_0x280ccf)){if(_0x4b6806['toLowerCase']()===_0x2dcbf6[_0x540f1f(0x217)][_0x540f1f(0x2ae)]()){_0x1ed3e6=_0x5d339b[_0x540f1f(0x1db)]||0xa;break;}}}catch(_0x4ae4bb){console[_0x540f1f(0x255)](_0x540f1f(0x28e)+_0x294b28+':',_0x4ae4bb);}const _0x22c29f=_0x2dcbf6[_0x540f1f(0x1fc)]*(0x1-_0x1ed3e6/0x64);_0xc2095f=-_0x22c29f,_0x597197-=_0x22c29f,_0x3f582c[_0x540f1f(0x1fc)]=null,console[_0x540f1f(0x20b)]('💰\x20Payment\x20'+_0x294b28+'\x20no\x20longer\x20PAID:'),console[_0x540f1f(0x20b)](_0x540f1f(0x2d0)+_0x2dcbf6[_0x540f1f(0x1fc)][_0x540f1f(0x2be)](0x6)+_0x540f1f(0x28a)),console[_0x540f1f(0x20b)](_0x540f1f(0x238)+_0x2dcbf6[_0x540f1f(0x217)]+_0x540f1f(0x23d)+_0x1ed3e6+'%'),console['log'](_0x540f1f(0x26c)+_0x22c29f[_0x540f1f(0x2be)](0x6)+_0x540f1f(0x215)+_0x1ed3e6+_0x540f1f(0x240)),console[_0x540f1f(0x20b)](_0x540f1f(0x2b4)+_0x22c29f[_0x540f1f(0x2be)](0x6)+_0x540f1f(0x28a));}}}_0x52a76a===_0x540f1f(0x2c4)&&(_0x56140a==='PAID'&&_0x2dcbf6[_0x540f1f(0x1fc)]&&console[_0x540f1f(0x20b)](_0x540f1f(0x27f)),_0x46eb86&&_0x46eb86>0x0&&(_0xc2095f-=_0x46eb86,_0x597197-=_0x46eb86,console[_0x540f1f(0x20b)](_0x540f1f(0x239)+_0x46eb86[_0x540f1f(0x2be)](0x6)+_0x540f1f(0x25e))));_0x52a76a==='REFUND'&&_0x56140a===_0x540f1f(0x22f)&&console[_0x540f1f(0x20b)]('🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance');const _0xe54eb2=await _0x29d2b9[_0x540f1f(0x1e1)][_0x540f1f(0x20e)]({'where':{'id':_0x294b28},'data':_0x3f582c,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0xc2095f!==0x0&&(await _0x29d2b9[_0x540f1f(0x268)][_0x540f1f(0x20e)]({'where':{'id':_0x2dcbf6[_0x540f1f(0x290)]},'data':{'balance':_0x597197}}),console[_0x540f1f(0x20b)](_0x540f1f(0x298)+_0x2dcbf6[_0x540f1f(0x290)]+_0x540f1f(0x1e9)+_0x2dcbf6['shop'][_0x540f1f(0x2b1)][_0x540f1f(0x2be)](0x6)+'\x20->\x20'+_0x597197[_0x540f1f(0x2be)](0x6)+_0x540f1f(0x2bb)+(_0xc2095f>0x0?'+':'')+_0xc2095f[_0x540f1f(0x2be)](0x6)+')')),_0xe54eb2;});return{'id':_0x468058['id'],'shopId':_0x468058[_0x39bb8f(0x290)],'gateway':_0x468058[_0x39bb8f(0x217)],'amount':_0x468058[_0x39bb8f(0x21d)],'currency':_0x468058[_0x39bb8f(0x233)],'status':_0x468058[_0x39bb8f(0x25f)],'orderId':_0x468058[_0x39bb8f(0x20f)],'gatewayOrderId':_0x468058[_0x39bb8f(0x261)],'customerEmail':_0x468058[_0x39bb8f(0x279)],'customerName':_0x468058[_0x39bb8f(0x1dc)],'customerCountry':_0x468058[_0x39bb8f(0x2c6)],'customerIp':_0x468058['customerIp'],'customerUa':_0x468058[_0x39bb8f(0x2e6)],'failureMessage':_0x468058[_0x39bb8f(0x292)],'adminNotes':_0x468058[_0x39bb8f(0x2ec)],'chargebackAmount':_0x468058[_0x39bb8f(0x21c)],'statusChangedBy':_0x468058['statusChangedBy'],'statusChangedAt':_0x468058[_0x39bb8f(0x26d)],'createdAt':_0x468058['createdAt'],'updatedAt':_0x468058[_0x39bb8f(0x250)],'shop':_0x468058[_0x39bb8f(0x268)]};}async[a35_0x29c225(0x267)](_0x3cea5d,_0x337f73){const _0x198dec=a35_0x29c225,_0x1d3366={..._0x337f73};_0x337f73[_0x198dec(0x294)]&&(_0x1d3366[_0x198dec(0x294)]=await bcryptjs_1[_0x198dec(0x278)]['hash'](_0x337f73[_0x198dec(0x294)],0xc));_0x337f73[_0x198dec(0x1e8)]&&(_0x1d3366[_0x198dec(0x24f)]=_0x337f73[_0x198dec(0x1e8)],delete _0x1d3366[_0x198dec(0x1e8)]);_0x337f73[_0x198dec(0x1f2)]&&(_0x1d3366['telegram']=_0x337f73[_0x198dec(0x1f2)],delete _0x1d3366[_0x198dec(0x1f2)]);_0x337f73[_0x198dec(0x224)]&&(_0x1d3366[_0x198dec(0x251)]=_0x337f73[_0x198dec(0x224)],delete _0x1d3366[_0x198dec(0x224)]);_0x337f73['gateways']&&(_0x1d3366['paymentGateways']=JSON[_0x198dec(0x29f)](_0x337f73[_0x198dec(0x23c)]),delete _0x1d3366['gateways']);_0x337f73[_0x198dec(0x2ac)]&&(_0x1d3366[_0x198dec(0x2ac)]=JSON['stringify'](_0x337f73[_0x198dec(0x2ac)]),delete _0x1d3366['gatewaySettings']);_0x337f73['wallets']&&(_0x337f73[_0x198dec(0x245)][_0x198dec(0x2db)]!==undefined&&(_0x1d3366[_0x198dec(0x2db)]=_0x337f73[_0x198dec(0x245)][_0x198dec(0x2db)]||null),_0x337f73[_0x198dec(0x245)][_0x198dec(0x26e)]!==undefined&&(_0x1d3366[_0x198dec(0x26e)]=_0x337f73[_0x198dec(0x245)]['usdtTrcWallet']||null),_0x337f73[_0x198dec(0x245)]['usdtErcWallet']!==undefined&&(_0x1d3366[_0x198dec(0x295)]=_0x337f73[_0x198dec(0x245)]['usdtErcWallet']||null),_0x337f73['wallets']['usdcPolygonWallet']!==undefined&&(_0x1d3366[_0x198dec(0x202)]=_0x337f73['wallets'][_0x198dec(0x202)]||null),delete _0x1d3366[_0x198dec(0x245)]);const _0x17a456=await database_1[_0x198dec(0x278)][_0x198dec(0x268)]['update']({'where':{'id':_0x3cea5d},'data':_0x1d3366,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x17a456['id'],'fullName':_0x17a456[_0x198dec(0x24f)],'username':_0x17a456[_0x198dec(0x2e9)],'telegramId':_0x17a456[_0x198dec(0x2a7)],'merchantUrl':_0x17a456[_0x198dec(0x251)],'gateways':_0x17a456['paymentGateways']?JSON['parse'](_0x17a456[_0x198dec(0x266)]):null,'gatewaySettings':_0x17a456[_0x198dec(0x2ac)]?JSON['parse'](_0x17a456[_0x198dec(0x2ac)]):null,'publicKey':_0x17a456['publicKey'],'wallets':{'usdtPolygonWallet':_0x17a456['usdtPolygonWallet'],'usdtTrcWallet':_0x17a456[_0x198dec(0x26e)],'usdtErcWallet':_0x17a456[_0x198dec(0x295)],'usdcPolygonWallet':_0x17a456['usdcPolygonWallet']},'status':_0x17a456['status'],'createdAt':_0x17a456[_0x198dec(0x258)]};}async[a35_0x29c225(0x208)](_0x2bdfc7){const _0x3a636c=a35_0x29c225,_0x40be07=await database_1[_0x3a636c(0x278)][_0x3a636c(0x268)][_0x3a636c(0x20e)]({'where':{'id':_0x2bdfc7},'data':{'status':_0x3a636c(0x286)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x40be07['id'],'fullName':_0x40be07[_0x3a636c(0x24f)],'username':_0x40be07[_0x3a636c(0x2e9)],'telegramId':_0x40be07[_0x3a636c(0x2a7)],'merchantUrl':_0x40be07[_0x3a636c(0x251)],'gateways':_0x40be07[_0x3a636c(0x266)]?JSON[_0x3a636c(0x1dd)](_0x40be07['paymentGateways']):null,'gatewaySettings':_0x40be07[_0x3a636c(0x2ac)]?JSON['parse'](_0x40be07[_0x3a636c(0x2ac)]):null,'publicKey':_0x40be07['publicKey'],'wallets':{'usdtPolygonWallet':_0x40be07[_0x3a636c(0x2db)],'usdtTrcWallet':_0x40be07[_0x3a636c(0x26e)],'usdtErcWallet':_0x40be07[_0x3a636c(0x295)],'usdcPolygonWallet':_0x40be07[_0x3a636c(0x202)]},'status':_0x40be07[_0x3a636c(0x25f)],'createdAt':_0x40be07['createdAt']};}async[a35_0x29c225(0x2ea)](_0x1e9838){const _0x2381d2=a35_0x29c225,_0x5398be=await database_1[_0x2381d2(0x278)][_0x2381d2(0x268)][_0x2381d2(0x20e)]({'where':{'id':_0x1e9838},'data':{'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x5398be['id'],'fullName':_0x5398be[_0x2381d2(0x24f)],'username':_0x5398be[_0x2381d2(0x2e9)],'telegramId':_0x5398be[_0x2381d2(0x2a7)],'merchantUrl':_0x5398be[_0x2381d2(0x251)],'gateways':_0x5398be['paymentGateways']?JSON['parse'](_0x5398be[_0x2381d2(0x266)]):null,'gatewaySettings':_0x5398be['gatewaySettings']?JSON[_0x2381d2(0x1dd)](_0x5398be[_0x2381d2(0x2ac)]):null,'publicKey':_0x5398be[_0x2381d2(0x2b3)],'wallets':{'usdtPolygonWallet':_0x5398be['usdtPolygonWallet'],'usdtTrcWallet':_0x5398be[_0x2381d2(0x26e)],'usdtErcWallet':_0x5398be[_0x2381d2(0x295)],'usdcPolygonWallet':_0x5398be['usdcPolygonWallet']},'status':_0x5398be[_0x2381d2(0x25f)],'createdAt':_0x5398be[_0x2381d2(0x258)]};}async[a35_0x29c225(0x207)](_0x361b83){const _0x360b61=a35_0x29c225,{page:_0x42dccf,limit:_0x451cbe,status:_0xb170d2}=_0x361b83,_0x3dfe3b=(_0x42dccf-0x1)*_0x451cbe,_0x6a4c2e={};_0xb170d2&&(_0x6a4c2e['status']=_0xb170d2[_0x360b61(0x283)]());const [_0x2a1219,_0x520371]=await Promise['all']([database_1['default'][_0x360b61(0x268)][_0x360b61(0x2df)]({'where':_0x6a4c2e,'skip':_0x3dfe3b,'take':_0x451cbe,'orderBy':{'createdAt':_0x360b61(0x246)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x360b61(0x278)]['shop']['count']({'where':_0x6a4c2e})]);return{'users':_0x2a1219[_0x360b61(0x1d7)](_0x291171=>({'id':_0x291171['id'],'fullName':_0x291171[_0x360b61(0x24f)],'username':_0x291171[_0x360b61(0x2e9)],'telegramId':_0x291171[_0x360b61(0x2a7)],'merchantUrl':_0x291171['shopUrl'],'gateways':_0x291171[_0x360b61(0x266)]?JSON[_0x360b61(0x1dd)](_0x291171[_0x360b61(0x266)]):null,'gatewaySettings':_0x291171[_0x360b61(0x2ac)]?JSON[_0x360b61(0x1dd)](_0x291171['gatewaySettings']):null,'publicKey':_0x291171[_0x360b61(0x2b3)],'wallets':{'usdtPolygonWallet':_0x291171[_0x360b61(0x2db)],'usdtTrcWallet':_0x291171[_0x360b61(0x26e)],'usdtErcWallet':_0x291171[_0x360b61(0x295)],'usdcPolygonWallet':_0x291171[_0x360b61(0x202)]},'status':_0x291171[_0x360b61(0x25f)],'createdAt':_0x291171[_0x360b61(0x258)]})),'pagination':{'page':_0x42dccf,'limit':_0x451cbe,'total':_0x520371,'totalPages':Math[_0x360b61(0x22a)](_0x520371/_0x451cbe)}};}async[a35_0x29c225(0x2a6)](_0x20ea5a){const _0x418598=a35_0x29c225,_0x4fcc71=await database_1[_0x418598(0x278)][_0x418598(0x268)][_0x418598(0x1f8)]({'where':{'id':_0x20ea5a},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x4fcc71)return null;return{'id':_0x4fcc71['id'],'fullName':_0x4fcc71[_0x418598(0x24f)],'username':_0x4fcc71['username'],'telegramId':_0x4fcc71['telegram'],'merchantUrl':_0x4fcc71['shopUrl'],'gateways':_0x4fcc71['paymentGateways']?JSON[_0x418598(0x1dd)](_0x4fcc71[_0x418598(0x266)]):null,'gatewaySettings':_0x4fcc71[_0x418598(0x2ac)]?JSON['parse'](_0x4fcc71[_0x418598(0x2ac)]):null,'publicKey':_0x4fcc71[_0x418598(0x2b3)],'wallets':{'usdtPolygonWallet':_0x4fcc71[_0x418598(0x2db)],'usdtTrcWallet':_0x4fcc71[_0x418598(0x26e)],'usdtErcWallet':_0x4fcc71['usdtErcWallet'],'usdcPolygonWallet':_0x4fcc71['usdcPolygonWallet']},'status':_0x4fcc71[_0x418598(0x25f)],'createdAt':_0x4fcc71['createdAt']};}async[a35_0x29c225(0x2eb)](_0x485e99){const _0x77d007=a35_0x29c225,{fullName:_0x3959c7,username:_0x13990f,password:_0x3cce9c,telegramId:_0x295be3,merchantUrl:_0x5b71bd,gateways:_0xd386d2,gatewaySettings:_0x2473c6,wallets:_0x423301}=_0x485e99,_0x5730c8=await database_1[_0x77d007(0x278)][_0x77d007(0x268)][_0x77d007(0x1f8)]({'where':{'username':_0x13990f}});if(_0x5730c8)throw new Error(_0x77d007(0x235));if(_0x295be3){const _0x25d519=await database_1['default']['shop'][_0x77d007(0x1f8)]({'where':{'telegram':_0x295be3}});if(_0x25d519)throw new Error(_0x77d007(0x27c));}const _0x193dd8=await bcryptjs_1[_0x77d007(0x278)]['hash'](_0x3cce9c,0xc),_0x263770='pk_'+crypto_1[_0x77d007(0x278)]['randomBytes'](0x20)[_0x77d007(0x249)](_0x77d007(0x2a3)),_0x477cda=_0x77d007(0x27e)+crypto_1[_0x77d007(0x278)][_0x77d007(0x2c1)](0x20)[_0x77d007(0x249)](_0x77d007(0x2a3)),_0x12ee79=await database_1[_0x77d007(0x278)][_0x77d007(0x268)][_0x77d007(0x1e5)]({'data':{'name':_0x3959c7,'username':_0x13990f,'password':_0x193dd8,'telegram':_0x295be3,'shopUrl':_0x5b71bd,'paymentGateways':_0xd386d2?JSON[_0x77d007(0x29f)](_0xd386d2):null,'gatewaySettings':_0x2473c6?JSON[_0x77d007(0x29f)](_0x2473c6):null,'usdtPolygonWallet':_0x423301?.['usdtPolygonWallet']||null,'usdtTrcWallet':_0x423301?.[_0x77d007(0x26e)]||null,'usdtErcWallet':_0x423301?.['usdtErcWallet']||null,'usdcPolygonWallet':_0x423301?.[_0x77d007(0x202)]||null,'publicKey':_0x263770,'secretKey':_0x477cda,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x12ee79['id'],'fullName':_0x12ee79[_0x77d007(0x24f)],'username':_0x12ee79[_0x77d007(0x2e9)],'telegramId':_0x12ee79[_0x77d007(0x2a7)],'merchantUrl':_0x12ee79[_0x77d007(0x251)],'gateways':_0x12ee79[_0x77d007(0x266)]?JSON[_0x77d007(0x1dd)](_0x12ee79[_0x77d007(0x266)]):null,'gatewaySettings':_0x12ee79[_0x77d007(0x2ac)]?JSON[_0x77d007(0x1dd)](_0x12ee79[_0x77d007(0x2ac)]):null,'publicKey':_0x12ee79[_0x77d007(0x2b3)],'wallets':{'usdtPolygonWallet':_0x12ee79[_0x77d007(0x2db)],'usdtTrcWallet':_0x12ee79[_0x77d007(0x26e)],'usdtErcWallet':_0x12ee79[_0x77d007(0x295)],'usdcPolygonWallet':_0x12ee79[_0x77d007(0x202)]},'status':_0x12ee79[_0x77d007(0x25f)],'createdAt':_0x12ee79[_0x77d007(0x258)]};}async[a35_0x29c225(0x1ee)](_0x5daae){const _0x3a5703=a35_0x29c225;await database_1[_0x3a5703(0x278)][_0x3a5703(0x268)][_0x3a5703(0x1e4)]({'where':{'id':_0x5daae}});}[a35_0x29c225(0x263)](_0x47262a,_0x192aba,_0x6c89ef){const _0x26079f=a35_0x29c225,_0x594ec0=new Map(),_0x456596=new Date(_0x192aba);while(_0x456596<=_0x6c89ef){const _0x72729e=_0x456596[_0x26079f(0x2b8)]()['split']('T')[0x0];_0x594ec0[_0x26079f(0x1f3)](_0x72729e,{'revenue':0x0,'count':0x0}),_0x456596['setDate'](_0x456596['getDate']()+0x1);}for(const _0x15190e of _0x47262a){const _0x15d9f4=_0x15190e[_0x26079f(0x258)][_0x26079f(0x2b8)]()[_0x26079f(0x2e0)]('T')[0x0],_0x3b01d8=_0x594ec0[_0x26079f(0x1da)](_0x15d9f4);_0x3b01d8&&(_0x3b01d8['count']+=0x1,_0x15190e[_0x26079f(0x25f)]===_0x26079f(0x22f)&&(_0x15190e[_0x26079f(0x1fc)]?_0x3b01d8[_0x26079f(0x2c5)]+=_0x15190e['amountUSDT']:console[_0x26079f(0x20b)]('⚠️\x20Payment\x20'+_0x15190e['id']+_0x26079f(0x22b))));}const _0x550cce=[],_0x5c4a03=[];for(const [_0x442e7a,_0xe59087]of _0x594ec0){_0x550cce[_0x26079f(0x23f)]({'date':_0x442e7a,'amount':Math['round'](_0xe59087[_0x26079f(0x2c5)]*0x64)/0x64}),_0x5c4a03[_0x26079f(0x23f)]({'date':_0x442e7a,'count':_0xe59087[_0x26079f(0x21f)]});}return{'dailyRevenue':_0x550cce,'dailyPayments':_0x5c4a03};}}exports[a35_0x29c225(0x24b)]=AdminService;