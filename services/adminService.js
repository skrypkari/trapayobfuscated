'use strict';function a35_0x408b(_0x230b1f,_0x56d5cf){const _0xee0b79=a35_0xee0b();return a35_0x408b=function(_0x408bb2,_0x52cdad){_0x408bb2=_0x408bb2-0x6f;let _0x51014a=_0xee0b79[_0x408bb2];return _0x51014a;},a35_0x408b(_0x230b1f,_0x56d5cf);}const a35_0x35e0f0=a35_0x408b;(function(_0x42d9e7,_0x12aed2){const _0x3f5cc3=a35_0x408b,_0x198c10=_0x42d9e7();while(!![]){try{const _0x5c8dc2=parseInt(_0x3f5cc3(0x12b))/0x1*(-parseInt(_0x3f5cc3(0x96))/0x2)+-parseInt(_0x3f5cc3(0xaf))/0x3*(parseInt(_0x3f5cc3(0x18b))/0x4)+parseInt(_0x3f5cc3(0x117))/0x5+-parseInt(_0x3f5cc3(0x123))/0x6+-parseInt(_0x3f5cc3(0x11e))/0x7+parseInt(_0x3f5cc3(0x186))/0x8+parseInt(_0x3f5cc3(0xd4))/0x9;if(_0x5c8dc2===_0x12aed2)break;else _0x198c10['push'](_0x198c10['shift']());}catch(_0x11c835){_0x198c10['push'](_0x198c10['shift']());}}}(a35_0xee0b,0xee529));var __importDefault=this&&this['__importDefault']||function(_0x3aae93){const _0x583613=a35_0x408b;return _0x3aae93&&_0x3aae93[_0x583613(0x12f)]?_0x3aae93:{'default':_0x3aae93};};Object[a35_0x35e0f0(0x125)](exports,a35_0x35e0f0(0x12f),{'value':!![]}),exports[a35_0x35e0f0(0xd3)]=void 0x0;const database_1=__importDefault(require(a35_0x35e0f0(0xb1))),bcryptjs_1=__importDefault(require(a35_0x35e0f0(0x174))),crypto_1=__importDefault(require(a35_0x35e0f0(0x129))),currencyService_1=require(a35_0x35e0f0(0x115)),gateway_1=require(a35_0x35e0f0(0x179));function a35_0xee0b(){const _0x25106e=['merchantEarningsUSDT','totalPayments','\x20USDT\x20(with\x20commission\x20deducted)','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','reduce','usdtErcWallet','./currencyService','polygon_usdc','6981805DSemdq','\x20PAID\x20payments','customerEmail','dailyRevenue','groupBy','date','summary','3219020bIrEJx','getMerchantsAwaitingPayout','\x20paid\x20payments\x20for\x20analysis','\x20to\x20','🔄\x20Gateway\x20mapping\x20(get):','11347698yUJtNf','failUrl','defineProperty','default','⚠️\x20Requested\x20gateway\x20\x27','\x20merchants\x20with\x20positive\x20balance','crypto','KLYME\x20EU','43vAJAEf','totalCommissionRate','averageCommissionRate','\x20\x20\x20💳\x20Total\x20payments:\x20','__esModule','📊\x20Payout\x20statistics\x20calculated:','getGatewayDisplayName','adminNotes','dailyPayments','findUnique','status','🔍\x20Using\x20gateway\x20\x27','\x20became\x20PAID:','txid','publicKey','toLowerCase','delete','stringify','password','\x20active\x20merchants\x20for\x20selection','test_gateway','Test\x20Gateway','Payment\x20not\x20found','getGatewayIdByName','ACTIVE','not\x20specified','set','getPayoutById','period','\x20in\x20','fullName','rapyd','getAllUsers','📊\x20Sorting\x20payments\x20by\x20','totalTurnover',',\x20successful:\x20','cointopay2','\x20\x20\x20💵\x20Available\x20balance:\x20','💰\x20[PAYOUT]\x20Gateway\x20','findFirst','network','_sum','klyme_de','statusChangedBy','orderId','PAID','\x20\x20\x20🖥️\x20User\x20Agent:\x20','toString','90d','\x20\x20\x20💸\x20Total\x20payouts\x20(all\x20time):\x20','length','✅\x20Using\x20gateway\x20filter:\x20\x27','\x20\x20\x20Total\x20paid\x20out:\x20','sort','randomBytes','getPaymentById','📅\x20Period:\x20','parse','Username\x20already\x20exists','error','CHARGEBACK','usdtPolygonWallet','awaitingPayout','amountUSDT','findMany','\x27\x20(from\x20\x27','\x20payments)','push','thisMonth','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','💸\x20CHARGEBACK\x20penalty:\x20-','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','getDate','bcryptjs','\x20\x20\x20🔍\x20Calculated\x20after\x20commission:\x20','\x20status:\x20','usdtTrcWallet','payment','../types/gateway','📅\x20Period\x20\x27all\x27:\x20Using\x20start\x20date\x20from\x20first\x20payment:\x20','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','revenue','averageCheckUSDT','not\x20set','round','noda','\x20\x20\x20🌐\x20IP:\x20','💱\x20Currency\x20filter\x20applied:\x20','toUpperCase','\x20USDT','log','13977880NYRfQu','🔄\x20Gateway\x20mapping:','chargebackAmount','getPayoutStats','2020-01-01','1592260SAsNNo','createUser','gatewaySettings','telegramId','wallets','shop','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','\x20\x20\x20Merchant\x20loses:\x20','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','📊\x20Final\x20WHERE\x20conditions:','getMerchantsSelection','getTime','📊\x20Total\x20payments\x20(including\x20failed):\x20','\x20\x20\x20Merchant\x20gets:\x20','\x20balance\x20updated:\x20','\x20for\x20shop\x20','shopUrl','getUserById','Error\x20processing\x20payment\x20','📊\x20Getting\x20payments\x20with\x20filters:','telegram','_count','forEach','getMonth','\x20USDT\x20(after\x20','create','split','entries','🔄\x20Converted\x20gateway\x20ID\x20\x27','klyme_eu','dateFrom','\x20USDT\x20(','\x20USDT\x20(same\x20as\x20awaiting)','username','\x20\x20\x20📅\x20Total\x20payouts\x20(this\x20month):\x20','hex','usdcPolygonWallet','\x20\x20\x20📊\x20Total\x20payments:\x20','\x20merchants','merchantEarnings','lte','\x20\x20\x20Added\x20to\x20balance:\x20+','getFullYear','gatewayEarnings','ceil','Plisio','\x20\x20\x20🌍\x20Country:\x20','sk_','\x20USDT\x20(-','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','14750MUvgBY','\x20\x20\x20💰\x20Total\x20payout:\x20','gateways','📊\x20Merchants\x20awaiting\x20payout:\x20','$transaction','admin','values','successUrl','customerIp','paymentsCount','\x20\x20\x20💰\x20Total\x20turnover:\x20','0000','\x20USDT\x20(without\x20commission)','\x20USDT\x20(theoretical\x20net)','🔄\x20Converted\x20gateway\x20name\x20\x27','insensitive','💰\x20Shop\x20','📊\x20Calculating\x20payout\x20statistics...','\x20USDT\x20(+','shopId','turnover','30d','🔄\x20Gateway\x20mapping\x20(create):','hash','\x20->\x20','12tGLeLo','deleteUser','../config/database','\x27\x20->\x20ID\x20\x27','💰\x20Found\x20','\x20no\x20longer\x20PAID:','periodFrom','generateDailyStatistics','\x20\x20\x20Balance:\x20',',\x20Commission:\x20','payout','updatePaymentStatus','polygon','\x20\x20\x20Full\x20amount:\x20','\x20\x20\x20💰\x20Total\x20payments\x20turnover:\x20','\x20\x20\x20🔍\x20Raw\x20balance\x20sum:\x20','aggregate','asc','Noda','createdAt','\x20\x20\x20�\x20Total\x20payments\x20turnover:\x20','suspendUser','some','whiteUrl','commission','toFixed','custom','Rapyd','gateway','deletePayout','failureMessage','customerCountry','count','gatewayOrderId','toISOString','currencyService','AdminService','18837909bHEPZG','name','KLYME\x20DE','gte','cointopay','setDate','desc','⚠️\x20Payment\x20','getAllPayments','\x27\x20not\x20found.\x20Available\x20gateways:\x20','update',':\x20commission\x20=\x20','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','getSystemStatistics','\x20USDT\x20(gross\x20revenue)','getAllPayouts','updatedAt','💰\x20[PAYOUT]\x20Merchant\x20','balance','totalPayout','\x20\x20\x20✅\x20Total\x20available\x20for\x20payout:\x20','includes','all','pk_','paidAt','convertToUSDT','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','get','COMPLETED','\x20USDT\x20from\x20balance','📋\x20Getting\x20merchants\x20selection\x20list...','KLYME\x20GB','✅\x20Payout\x20created:\x20','customerUa','customerName','currency','%\x20commission)','turnoverUSDT','merchantUrl','map','totalAmountAfterCommissionUSDT','MasterCard','paymentGateways','periodTo','commissionUSDT','trc20','\x20\x20\x20✅\x20Actual\x20available\x20balance:\x20','💰\x20Payment\x20','totalPaidOut','amount','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','totalAmountUSDT','\x20\x20\x20Current\x20balance:\x20','\x27\x20->\x20name\x20\x27','updateCustomerData','week','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','month','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'];a35_0xee0b=function(){return _0x25106e;};return a35_0xee0b();}class AdminService{async[a35_0x35e0f0(0x189)](){const _0x373922=a35_0x35e0f0;console[_0x373922(0x185)](_0x373922(0xa7));const _0x5c2e9a=await database_1[_0x373922(0x126)][_0x373922(0x190)]['aggregate']({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x373922(0x143)}}),_0x3e9f33=await this[_0x373922(0x11f)]({'page':0x1,'limit':0x3e8}),_0x4580d4=await database_1['default'][_0x373922(0x178)][_0x373922(0xcf)]({'where':{'status':_0x373922(0x158),'gateway':{'not':_0x373922(0x13f)}}}),_0x23ab92=new Date(),_0x34d390=new Date(_0x23ab92[_0x373922(0x8e)](),_0x23ab92[_0x373922(0x7b)](),0x1),_0x5d737d=new Date(_0x23ab92[_0x373922(0x8e)](),_0x23ab92[_0x373922(0x7b)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x2a07d8=await database_1[_0x373922(0x126)][_0x373922(0xb9)]['aggregate']({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x34d390,'lte':_0x5d737d},'status':_0x373922(0xf0)}}),_0x438f9a=_0x5c2e9a[_0x373922(0x154)][_0x373922(0x104)]||0x0,_0x5c28fc=_0x3e9f33[_0x373922(0x11d)][_0x373922(0xfc)],_0x498d90=_0x2a07d8[_0x373922(0x154)][_0x373922(0x105)]||0x0,_0x10a2cc={'totalPayout':Math[_0x373922(0x17f)](_0x438f9a*0x64)/0x64,'awaitingPayout':Math[_0x373922(0x17f)](_0x5c28fc*0x64)/0x64,'thisMonth':Math[_0x373922(0x17f)](_0x498d90*0x64)/0x64,'availableBalance':Math[_0x373922(0x17f)](_0x5c28fc*0x64)/0x64,'totalPayments':_0x4580d4};return console[_0x373922(0x185)](_0x373922(0x130)),console[_0x373922(0x185)](_0x373922(0x97)+_0x10a2cc[_0x373922(0xe7)]+'\x20USDT\x20(total\x20paid\x20to\x20merchants)'),console['log'](_0x373922(0x106)+_0x10a2cc[_0x373922(0x169)]+_0x373922(0x111)),console[_0x373922(0x185)](_0x373922(0x150)+_0x10a2cc['availableBalance']+_0x373922(0x84)),console[_0x373922(0x185)]('\x20\x20\x20📅\x20This\x20month:\x20'+_0x10a2cc['thisMonth']+'\x20USDT'),console[_0x373922(0x185)](_0x373922(0x12e)+_0x10a2cc[_0x373922(0x110)]+_0x373922(0x118)),console[_0x373922(0x185)](_0x373922(0xbe)+(_0x5c2e9a['_sum'][_0x373922(0xe6)]||0x0)[_0x373922(0xc8)](0x2)+_0x373922(0xa2)),console[_0x373922(0x185)]('\x20\x20\x20📊\x20Commission\x20difference:\x20'+((_0x5c2e9a['_sum'][_0x373922(0xe6)]||0x0)-_0x5c28fc)['toFixed'](0x2)+_0x373922(0x184)),_0x10a2cc;}async[a35_0x35e0f0(0x10a)](_0x455a6f,_0x445bcb){const _0x5eafd7=a35_0x35e0f0;console[_0x5eafd7(0x185)](_0x5eafd7(0xee)+_0x455a6f+':',_0x445bcb);const _0x2a9881=await database_1[_0x5eafd7(0x126)]['payment'][_0x5eafd7(0x134)]({'where':{'id':_0x455a6f},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x2a9881)throw new Error(_0x5eafd7(0x141));const _0x393c6d={};_0x445bcb[_0x5eafd7(0xce)]!==undefined&&(_0x393c6d[_0x5eafd7(0xce)]=_0x445bcb[_0x5eafd7(0xce)]||null);_0x445bcb[_0x5eafd7(0x9e)]!==undefined&&(_0x393c6d[_0x5eafd7(0x9e)]=_0x445bcb[_0x5eafd7(0x9e)]||null);_0x445bcb[_0x5eafd7(0xf5)]!==undefined&&(_0x393c6d[_0x5eafd7(0xf5)]=_0x445bcb['customerUa']||null);const _0x11c580=await database_1[_0x5eafd7(0x126)][_0x5eafd7(0x178)][_0x5eafd7(0xde)]({'where':{'id':_0x455a6f},'data':{..._0x393c6d,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x5eafd7(0x185)](_0x5eafd7(0xe0)+_0x455a6f),console[_0x5eafd7(0x185)](_0x5eafd7(0x92)+_0x2a9881[_0x5eafd7(0xce)]+_0x5eafd7(0xae)+_0x11c580[_0x5eafd7(0xce)]),console[_0x5eafd7(0x185)](_0x5eafd7(0x181)+_0x2a9881[_0x5eafd7(0x9e)]+_0x5eafd7(0xae)+_0x11c580[_0x5eafd7(0x9e)]),console['log'](_0x5eafd7(0x159)+(_0x2a9881[_0x5eafd7(0xf5)]?'set':_0x5eafd7(0x17e))+_0x5eafd7(0xae)+(_0x11c580[_0x5eafd7(0xf5)]?'set':_0x5eafd7(0x17e))),_0x11c580;}async[a35_0x35e0f0(0xe1)](_0x3e1004){const _0x2872ff=a35_0x35e0f0,_0x12c411=new Date();let _0x168b94;switch(_0x3e1004){case'7d':_0x168b94=new Date(_0x12c411[_0x2872ff(0x6f)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x2872ff(0xab):_0x168b94=new Date(_0x12c411[_0x2872ff(0x6f)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x2872ff(0x15b):_0x168b94=new Date(_0x12c411[_0x2872ff(0x6f)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x2872ff(0xea):const _0x26a3ea=await database_1[_0x2872ff(0x126)][_0x2872ff(0x178)][_0x2872ff(0x152)]({'where':{'gateway':{'not':_0x2872ff(0x13f)}},'orderBy':{'createdAt':_0x2872ff(0xc0)},'select':{'createdAt':!![]}});_0x168b94=_0x26a3ea?_0x26a3ea[_0x2872ff(0xc2)]:new Date(_0x2872ff(0x18a)),console[_0x2872ff(0x185)](_0x2872ff(0x17a)+_0x168b94[_0x2872ff(0xd1)]());break;default:_0x168b94=new Date(_0x12c411[_0x2872ff(0x6f)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x47d230,_0x4eb3c4,_0x3930f8,_0x125a5c,_0x4ea350,_0x1aa4ff,_0x69f1ba]=await Promise[_0x2872ff(0xea)]([database_1['default'][_0x2872ff(0x190)][_0x2872ff(0xcf)](),database_1[_0x2872ff(0x126)][_0x2872ff(0x190)][_0x2872ff(0xcf)]({'where':{'status':_0x2872ff(0x143)}}),database_1[_0x2872ff(0x126)][_0x2872ff(0x178)][_0x2872ff(0xcf)]({'where':{'createdAt':{'gte':_0x168b94},'gateway':{'not':_0x2872ff(0x13f)}}}),database_1[_0x2872ff(0x126)][_0x2872ff(0x178)][_0x2872ff(0xcf)]({'where':{'status':_0x2872ff(0x158),'createdAt':{'gte':_0x168b94},'gateway':{'not':_0x2872ff(0x13f)}}}),database_1['default'][_0x2872ff(0x178)][_0x2872ff(0x16b)]({'where':{'status':_0x2872ff(0x158),'createdAt':{'gte':_0x168b94},'gateway':{'not':_0x2872ff(0x13f)}},'select':{'amount':!![],'currency':!![]}}),database_1[_0x2872ff(0x126)][_0x2872ff(0x178)][_0x2872ff(0x16b)]({'where':{'gateway':{'not':_0x2872ff(0x13f)}},'take':0xa,'orderBy':{'createdAt':_0x2872ff(0xda)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x2872ff(0x126)]['payment'][_0x2872ff(0x16b)]({'where':{'createdAt':{'gte':_0x168b94},'gateway':{'not':_0x2872ff(0x13f)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x318787=0x0;for(const _0x33eaae of _0x4ea350){const _0x4078b8=await currencyService_1[_0x2872ff(0xd2)]['convertToUSDT'](_0x33eaae['amount'],_0x33eaae[_0x2872ff(0xf7)]);_0x318787+=_0x4078b8;}const _0x2fd5f1=this[_0x2872ff(0xb6)](_0x69f1ba,_0x168b94,_0x12c411),_0x3493fa=_0x3930f8>0x0?_0x125a5c/_0x3930f8*0x64:0x0;return{'totalShops':_0x47d230,'activeShops':_0x4eb3c4,'totalPayments':_0x3930f8,'successfulPayments':_0x125a5c,'totalRevenue':Math[_0x2872ff(0x17f)](_0x318787*0x64)/0x64,'conversionRate':Math[_0x2872ff(0x17f)](_0x3493fa*0x64)/0x64,'dailyRevenue':_0x2fd5f1[_0x2872ff(0x11a)],'dailyPayments':_0x2fd5f1[_0x2872ff(0x133)],'recentPayments':_0x1aa4ff[_0x2872ff(0xfb)](_0xd0a69f=>({'id':_0xd0a69f['id'],'amount':_0xd0a69f[_0x2872ff(0x105)],'currency':_0xd0a69f[_0x2872ff(0xf7)],'status':_0xd0a69f['status'],'gateway':_0xd0a69f[_0x2872ff(0xcb)],'shop':_0xd0a69f['shop'],'createdAt':_0xd0a69f[_0x2872ff(0xc2)]}))};}async['getMerchantStatistics'](_0x472c90){const _0x645625=a35_0x35e0f0;console[_0x645625(0x185)](_0x645625(0x170),_0x472c90);let _0x3fda2f,_0x5db7e6=new Date();if(_0x472c90[_0x645625(0x147)]===_0x645625(0xc9)&&_0x472c90[_0x645625(0x82)]&&_0x472c90['dateTo'])_0x3fda2f=new Date(_0x472c90[_0x645625(0x82)]),_0x5db7e6=new Date(_0x472c90['dateTo']);else{const _0x2e3012=new Date();switch(_0x472c90[_0x645625(0x147)]){case _0x645625(0x10b):_0x3fda2f=new Date(_0x2e3012['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x645625(0x10d):_0x3fda2f=new Date(_0x2e3012['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'year':_0x3fda2f=new Date(_0x2e3012[_0x645625(0x6f)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x645625(0xea):default:_0x3fda2f=new Date(_0x645625(0x18a));break;}}console[_0x645625(0x185)](_0x645625(0x163)+_0x3fda2f[_0x645625(0xd1)]()+_0x645625(0x121)+_0x5db7e6[_0x645625(0xd1)]());const _0x3634c8={'status':_0x645625(0x158),'gateway':{'not':_0x645625(0x13f)},'paidAt':{'gte':_0x3fda2f,'lte':_0x5db7e6}};_0x472c90[_0x645625(0xa9)]&&(_0x3634c8[_0x645625(0xa9)]=_0x472c90['shopId']);const _0x4239ba=await database_1[_0x645625(0x126)]['payment']['findMany']({'where':_0x3634c8,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x645625(0x185)](_0x645625(0xb3)+_0x4239ba[_0x645625(0x15d)]+_0x645625(0x120));const _0x3f5535={'gateway':{'not':'test_gateway'},'createdAt':{'gte':_0x3fda2f,'lte':_0x5db7e6}};_0x472c90[_0x645625(0xa9)]&&(_0x3f5535[_0x645625(0xa9)]=_0x472c90[_0x645625(0xa9)]);const _0x13f0c6=await database_1['default'][_0x645625(0x178)][_0x645625(0xcf)]({'where':_0x3f5535});console[_0x645625(0x185)](_0x645625(0x70)+_0x13f0c6+_0x645625(0x14e)+_0x4239ba[_0x645625(0x15d)]);let _0x45076a=0x0,_0x3eb6a7=0x0,_0x2b4991=0x0;const _0x351130={},_0x305e43={},_0x1410de={};for(const _0x5af107 of _0x4239ba){try{const _0x5db148=await currencyService_1[_0x645625(0xd2)][_0x645625(0xed)](_0x5af107['amount'],_0x5af107[_0x645625(0xf7)]);let _0x5de775={};if(_0x5af107[_0x645625(0x190)][_0x645625(0x18d)])try{_0x5de775=JSON[_0x645625(0x164)](_0x5af107['shop'][_0x645625(0x18d)]);}catch(_0x1c57d2){console[_0x645625(0x166)](_0x645625(0x10e)+_0x5af107[_0x645625(0xa9)]+':',_0x1c57d2);}let _0x21895d={},_0x19b107=0xa;for(const [_0x51627c,_0x57ae49]of Object[_0x645625(0x7f)](_0x5de775)){if(_0x51627c['toLowerCase']()===_0x5af107[_0x645625(0xcb)][_0x645625(0x13a)]()){_0x21895d=_0x57ae49,_0x19b107=_0x57ae49[_0x645625(0xc7)]||0xa;break;}}const _0xb625c8=_0x5db148*(_0x19b107/0x64),_0xa442b7=_0x5db148-_0xb625c8;_0x45076a+=_0x5db148,_0x3eb6a7+=_0xa442b7,_0x2b4991+=_0xb625c8;!_0x351130[_0x5af107['gateway']]&&(_0x351130[_0x5af107[_0x645625(0xcb)]]={'gateway':_0x5af107[_0x645625(0xcb)],'gatewayDisplayName':this[_0x645625(0x131)](_0x5af107[_0x645625(0xcb)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x351130[_0x5af107['gateway']]['paymentsCount']++,_0x351130[_0x5af107[_0x645625(0xcb)]][_0x645625(0xf9)]+=_0x5db148,_0x351130[_0x5af107['gateway']]['commissionUSDT']+=_0xb625c8,_0x351130[_0x5af107[_0x645625(0xcb)]][_0x645625(0x10f)]+=_0xa442b7,_0x351130[_0x5af107[_0x645625(0xcb)]][_0x645625(0x12c)]+=_0x19b107;!_0x472c90[_0x645625(0xa9)]&&(!_0x305e43[_0x5af107['shopId']]&&(_0x305e43[_0x5af107['shopId']]={'shopId':_0x5af107[_0x645625(0xa9)],'shopName':_0x5af107[_0x645625(0x190)][_0x645625(0xd5)],'shopUsername':_0x5af107[_0x645625(0x190)][_0x645625(0x85)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x305e43[_0x5af107[_0x645625(0xa9)]]['paymentsCount']++,_0x305e43[_0x5af107[_0x645625(0xa9)]][_0x645625(0xf9)]+=_0x5db148,_0x305e43[_0x5af107[_0x645625(0xa9)]]['commissionUSDT']+=_0xb625c8,_0x305e43[_0x5af107[_0x645625(0xa9)]][_0x645625(0x10f)]+=_0xa442b7);const _0x1b10a5=_0x5af107[_0x645625(0xec)]['toISOString']()[_0x645625(0x7e)]('T')[0x0];!_0x1410de[_0x1b10a5]&&(_0x1410de[_0x1b10a5]={'date':_0x1b10a5,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x1410de[_0x1b10a5][_0x645625(0xaa)]+=_0x5db148,_0x1410de[_0x1b10a5][_0x645625(0x8b)]+=_0xa442b7,_0x1410de[_0x1b10a5][_0x645625(0x8f)]+=_0xb625c8,_0x1410de[_0x1b10a5][_0x645625(0x9f)]++;}catch(_0x2e55e6){console['error'](_0x645625(0x76)+_0x5af107['id']+':',_0x2e55e6);}}Object[_0x645625(0x9c)](_0x351130)[_0x645625(0x7a)](_0x754908=>{const _0x126c1f=_0x645625;_0x754908[_0x126c1f(0x12d)]=_0x754908[_0x126c1f(0x9f)]>0x0?_0x754908[_0x126c1f(0x12c)]/_0x754908[_0x126c1f(0x9f)]:0x0,delete _0x754908[_0x126c1f(0x12c)];}),Object[_0x645625(0x9c)](_0x305e43)[_0x645625(0x7a)](_0x4f8626=>{const _0x5a48b=_0x645625;_0x4f8626[_0x5a48b(0x17d)]=_0x4f8626[_0x5a48b(0x9f)]>0x0?_0x4f8626['turnoverUSDT']/_0x4f8626[_0x5a48b(0x9f)]:0x0;});let _0x537683=0x0;if(_0x472c90[_0x645625(0xa9)]){const _0x40a109=await database_1['default'][_0x645625(0xb9)][_0x645625(0x16b)]({'where':{'shopId':_0x472c90[_0x645625(0xa9)],'status':_0x645625(0xf0),'createdAt':{'gte':_0x3fda2f,'lte':_0x5db7e6}},'select':{'amount':!![]}});_0x537683=_0x40a109[_0x645625(0x113)]((_0x533b78,_0x4d0021)=>_0x533b78+_0x4d0021['amount'],0x0);}const _0x197900=_0x13f0c6,_0x973ff2=_0x4239ba[_0x645625(0x15d)],_0xf79fc9=_0x973ff2>0x0?_0x45076a/_0x973ff2:0x0,_0x2586c5=_0x197900>0x0?Math[_0x645625(0x17f)](_0x973ff2/_0x197900*0x2710)/0x64:0x0,_0x169477=Math[_0x645625(0x90)]((_0x5db7e6[_0x645625(0x6f)]()-_0x3fda2f['getTime']())/(0x3e8*0x3c*0x3c*0x18)),_0x57171e={'totalTurnover':Math[_0x645625(0x17f)](_0x45076a*0x64)/0x64,'merchantEarnings':Math[_0x645625(0x17f)](_0x3eb6a7*0x64)/0x64,'gatewayEarnings':Math[_0x645625(0x17f)](_0x2b4991*0x64)/0x64,'totalPaidOut':Math[_0x645625(0x17f)](_0x537683*0x64)/0x64,'averageCheck':Math[_0x645625(0x17f)](_0xf79fc9*0x64)/0x64,'totalPayments':_0x197900,'successfulPayments':_0x973ff2,'conversionRate':_0x2586c5,'gatewayBreakdown':Object['values'](_0x351130)[_0x645625(0xfb)](_0x414330=>({..._0x414330,'turnoverUSDT':Math[_0x645625(0x17f)](_0x414330[_0x645625(0xf9)]*0x64)/0x64,'commissionUSDT':Math[_0x645625(0x17f)](_0x414330[_0x645625(0x100)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x645625(0x17f)](_0x414330[_0x645625(0x10f)]*0x64)/0x64,'averageCommissionRate':Math['round'](_0x414330[_0x645625(0x12d)]*0x64)/0x64})),'merchantBreakdown':_0x472c90[_0x645625(0xa9)]?undefined:Object[_0x645625(0x9c)](_0x305e43)[_0x645625(0xfb)](_0x56b9da=>({..._0x56b9da,'turnoverUSDT':Math['round'](_0x56b9da[_0x645625(0xf9)]*0x64)/0x64,'commissionUSDT':Math[_0x645625(0x17f)](_0x56b9da[_0x645625(0x100)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x56b9da['merchantEarningsUSDT']*0x64)/0x64,'paidOutUSDT':Math[_0x645625(0x17f)](_0x56b9da['paidOutUSDT']*0x64)/0x64,'averageCheckUSDT':Math['round'](_0x56b9da[_0x645625(0x17d)]*0x64)/0x64})),'dailyData':Object[_0x645625(0x9c)](_0x1410de)[_0x645625(0xfb)](_0x56ddff=>({..._0x56ddff,'turnover':Math[_0x645625(0x17f)](_0x56ddff['turnover']*0x64)/0x64,'merchantEarnings':Math['round'](_0x56ddff[_0x645625(0x8b)]*0x64)/0x64,'gatewayEarnings':Math['round'](_0x56ddff[_0x645625(0x8f)]*0x64)/0x64}))[_0x645625(0x160)]((_0x26c8ea,_0x1ad5bd)=>_0x26c8ea[_0x645625(0x11c)]['localeCompare'](_0x1ad5bd[_0x645625(0x11c)])),'periodInfo':{'from':_0x3fda2f,'to':_0x5db7e6,'periodType':_0x472c90[_0x645625(0x147)]||_0x645625(0xc9),'daysCount':_0x169477}};return console[_0x645625(0x185)]('📊\x20Merchant\x20statistics\x20calculated:'),console['log'](_0x645625(0xa0)+_0x57171e[_0x645625(0x14d)]+_0x645625(0x184)),console[_0x645625(0x185)](_0x645625(0x193)+_0x57171e[_0x645625(0x8b)]+_0x645625(0x184)),console[_0x645625(0x185)](_0x645625(0x112)+_0x57171e[_0x645625(0x8f)]+_0x645625(0x184)),console[_0x645625(0x185)](_0x645625(0x89)+_0x57171e[_0x645625(0x110)]),_0x57171e;}async[a35_0x35e0f0(0x195)](){const _0x13ec78=a35_0x35e0f0;console[_0x13ec78(0x185)](_0x13ec78(0xf2));const _0x2ef0d6=await database_1[_0x13ec78(0x126)]['shop'][_0x13ec78(0x16b)]({'where':{'status':_0x13ec78(0x143)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x13ec78(0xc0)}});return console[_0x13ec78(0x185)]('📋\x20Found\x20'+_0x2ef0d6['length']+_0x13ec78(0x13e)),_0x2ef0d6[_0x13ec78(0xfb)](_0x11fff0=>({'id':_0x11fff0['id'],'username':_0x11fff0[_0x13ec78(0x85)],'name':_0x11fff0[_0x13ec78(0xd5)]}));}[a35_0x35e0f0(0x131)](_0xee38e1){const _0x7f00d=a35_0x35e0f0,_0x58dd89={'test_gateway':_0x7f00d(0x140),'plisio':_0x7f00d(0x91),'rapyd':_0x7f00d(0xca),'noda':_0x7f00d(0xc1),'cointopay':'CoinToPay','cointopay2':'Open\x20Banking\x202','klyme_eu':_0x7f00d(0x12a),'klyme_gb':_0x7f00d(0xf3),'klyme_de':_0x7f00d(0xd6),'mastercard':_0x7f00d(0xfd)};return _0x58dd89[_0xee38e1]||_0xee38e1;}['getGatewayInternalName'](_0xc2e135){const _0x4597ce=a35_0x35e0f0,_0x4ea447={'Test\x20Gateway':_0x4597ce(0x13f),'Plisio':'plisio','Rapyd':_0x4597ce(0x14a),'Noda':_0x4597ce(0x180),'CoinToPay':_0x4597ce(0xd8),'CoinToPay2':_0x4597ce(0x14f),'KLYME\x20EU':_0x4597ce(0x81),'KLYME\x20GB':'klyme_gb','KLYME\x20DE':_0x4597ce(0x155),'MasterCard':'mastercard'};return _0x4ea447[_0xc2e135]||_0xc2e135[_0x4597ce(0x13a)]();}async[a35_0x35e0f0(0x11f)](_0x1d7c01){const _0x96ec2e=a35_0x35e0f0,{page:_0x21c25b,limit:_0x56a63f,minAmount:_0x45e633,search:_0x6dfe7e}=_0x1d7c01,_0x19a3f5=(_0x21c25b-0x1)*_0x56a63f;console['log'](_0x96ec2e(0x191),_0x1d7c01);const _0x4f7868={'balance':{'gt':0x0},'status':_0x96ec2e(0x143)};_0x45e633&&(_0x4f7868[_0x96ec2e(0xe6)][_0x96ec2e(0xd7)]=_0x45e633);_0x6dfe7e&&(_0x4f7868['OR']=[{'name':{'contains':_0x6dfe7e,'mode':_0x96ec2e(0xa5)}},{'username':{'contains':_0x6dfe7e,'mode':'insensitive'}}]);const [_0x44338a,_0x20c2a4]=await Promise[_0x96ec2e(0xea)]([database_1[_0x96ec2e(0x126)][_0x96ec2e(0x190)][_0x96ec2e(0x16b)]({'where':_0x4f7868,'skip':_0x19a3f5,'take':_0x56a63f,'orderBy':{'balance':_0x96ec2e(0xda)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1['default']['shop'][_0x96ec2e(0xcf)]({'where':_0x4f7868})]);console[_0x96ec2e(0x185)]('💰\x20Found\x20'+_0x44338a[_0x96ec2e(0x15d)]+_0x96ec2e(0x128));const _0x13dcc8=await Promise['all'](_0x44338a['map'](async _0x54eb56=>{const _0x215aac=_0x96ec2e,[_0x49d229,_0x4c55c7,_0x4096f1]=await Promise['all']([database_1[_0x215aac(0x126)][_0x215aac(0x178)][_0x215aac(0xcf)]({'where':{'shopId':_0x54eb56['id'],'status':_0x215aac(0x158),'gateway':{'not':'test_gateway'}}}),database_1[_0x215aac(0x126)][_0x215aac(0x178)][_0x215aac(0x152)]({'where':{'shopId':_0x54eb56['id'],'status':_0x215aac(0x158),'gateway':{'not':_0x215aac(0x13f)}},'orderBy':{'paidAt':_0x215aac(0xc0)},'select':{'paidAt':!![]}}),database_1[_0x215aac(0x126)]['payment'][_0x215aac(0x11b)]({'by':['gateway'],'where':{'shopId':_0x54eb56['id'],'status':'PAID','gateway':{'not':_0x215aac(0x13f)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x2356fb=new Date(),_0x591bfe=new Date(_0x2356fb['getFullYear'](),_0x2356fb[_0x215aac(0x7b)](),0x1),_0x348064=new Date(_0x2356fb['getFullYear'](),_0x2356fb[_0x215aac(0x7b)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x467227,_0x2b13b7]=await Promise[_0x215aac(0xea)]([database_1[_0x215aac(0x126)][_0x215aac(0xb9)][_0x215aac(0xbf)]({'_sum':{'amount':!![]},'where':{'shopId':_0x54eb56['id'],'status':_0x215aac(0xf0)}}),database_1['default'][_0x215aac(0xb9)][_0x215aac(0xbf)]({'_sum':{'amount':!![]},'where':{'shopId':_0x54eb56['id'],'status':_0x215aac(0xf0),'createdAt':{'gte':_0x591bfe,'lte':_0x348064}}})]),_0x3b4235=_0x467227[_0x215aac(0x154)][_0x215aac(0x105)]||0x0,_0x50fc88=_0x2b13b7[_0x215aac(0x154)][_0x215aac(0x105)]||0x0,_0x31142d=await Promise[_0x215aac(0xea)](_0x4096f1[_0x215aac(0xfb)](async _0x14429d=>{const _0x830b2b=_0x215aac;let _0x471219=0xa;if(_0x54eb56[_0x830b2b(0x18d)])try{const _0x267baa=JSON[_0x830b2b(0x164)](_0x54eb56[_0x830b2b(0x18d)]);for(const [_0x3bc26a,_0x41e81f]of Object['entries'](_0x267baa)){if(_0x3bc26a[_0x830b2b(0x13a)]()===_0x14429d[_0x830b2b(0xcb)][_0x830b2b(0x13a)]()){_0x471219=_0x41e81f[_0x830b2b(0xc7)]||0xa,console[_0x830b2b(0x185)](_0x830b2b(0x151)+_0x14429d[_0x830b2b(0xcb)]+_0x830b2b(0x73)+_0x54eb56['id']+_0x830b2b(0xdf)+_0x471219+'%');break;}}}catch(_0x1bb012){console[_0x830b2b(0x166)](_0x830b2b(0x10e)+_0x54eb56['id']+':',_0x1bb012);}const _0x152ce4=_0x14429d['_sum'][_0x830b2b(0x16a)]||0x0,_0x27d87b=_0x152ce4*(0x1-_0x471219/0x64);return{'gateway':_0x14429d[_0x830b2b(0xcb)],'count':_0x14429d[_0x830b2b(0x79)]['id'],'amountUSDT':Math[_0x830b2b(0x17f)](_0x152ce4*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x830b2b(0x17f)](_0x27d87b*0x64)/0x64,'commission':_0x471219};})),_0x13547c=_0x31142d[_0x215aac(0x113)]((_0x24022d,_0x76358e)=>_0x24022d+_0x76358e[_0x215aac(0x16a)],0x0),_0x322a6d=_0x54eb56['balance'];return console[_0x215aac(0x185)](_0x215aac(0xe5)+_0x54eb56['username']+':'),console[_0x215aac(0x185)](_0x215aac(0xc3)+_0x13547c[_0x215aac(0xc8)](0x2)+_0x215aac(0xe2)),console[_0x215aac(0x185)](_0x215aac(0x175)+_0x31142d[_0x215aac(0x113)]((_0x242c3d,_0x1eb170)=>_0x242c3d+_0x1eb170['amountAfterCommissionUSDT'],0x0)[_0x215aac(0xc8)](0x2)+_0x215aac(0xa3)),console[_0x215aac(0x185)](_0x215aac(0x102)+_0x322a6d['toFixed'](0x2)+'\x20USDT\x20(after\x20payouts)'),{'id':_0x54eb56['id'],'fullName':_0x54eb56[_0x215aac(0xd5)],'username':_0x54eb56[_0x215aac(0x85)],'telegramId':_0x54eb56[_0x215aac(0x78)],'merchantUrl':_0x54eb56['shopUrl'],'wallets':{'usdtPolygonWallet':_0x54eb56[_0x215aac(0x168)],'usdtTrcWallet':_0x54eb56[_0x215aac(0x177)],'usdtErcWallet':_0x54eb56[_0x215aac(0x114)],'usdcPolygonWallet':_0x54eb56[_0x215aac(0x88)]},'totalAmountUSDT':Math['round'](_0x13547c*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x215aac(0x17f)](_0x322a6d*0x64)/0x64,'totalPayout':Math[_0x215aac(0x17f)](_0x3b4235*0x64)/0x64,'thisMonth':Math[_0x215aac(0x17f)](_0x50fc88*0x64)/0x64,'paymentsCount':_0x49d229,'oldestPaymentDate':_0x4c55c7?.['paidAt']||_0x54eb56[_0x215aac(0xc2)],'gatewayBreakdown':_0x31142d};})),_0x441b31=_0x13dcc8['reduce']((_0x4126dd,_0x5b1195)=>_0x4126dd+_0x5b1195[_0x96ec2e(0x107)],0x0),_0x2b802d=_0x13dcc8[_0x96ec2e(0x113)]((_0x8a4670,_0x1b4d7e)=>_0x8a4670+_0x1b4d7e[_0x96ec2e(0xfc)],0x0),_0x4e2aef=_0x13dcc8[_0x96ec2e(0x113)]((_0x2eb4a4,_0x5ce983)=>_0x2eb4a4+_0x5ce983[_0x96ec2e(0xe7)],0x0),_0x9cd855=_0x13dcc8[_0x96ec2e(0x113)]((_0x403fe8,_0x50a89e)=>_0x403fe8+_0x50a89e[_0x96ec2e(0x16f)],0x0);return console['log'](_0x96ec2e(0x99)+_0x20c2a4+_0x96ec2e(0x8a)),console[_0x96ec2e(0x185)](_0x96ec2e(0xbd)+Math['round'](_0x441b31*0x64)/0x64+_0x96ec2e(0xe2)),console['log'](_0x96ec2e(0xe8)+Math['round'](_0x2b802d*0x64)/0x64+'\x20USDT\x20(actual\x20balances)'),console['log'](_0x96ec2e(0x15c)+Math[_0x96ec2e(0x17f)](_0x4e2aef*0x64)/0x64+_0x96ec2e(0x184)),console[_0x96ec2e(0x185)](_0x96ec2e(0x86)+Math[_0x96ec2e(0x17f)](_0x9cd855*0x64)/0x64+_0x96ec2e(0x184)),{'merchants':_0x13dcc8,'pagination':{'page':_0x21c25b,'limit':_0x56a63f,'total':_0x20c2a4,'totalPages':Math[_0x96ec2e(0x90)](_0x20c2a4/_0x56a63f)},'summary':{'totalMerchants':_0x20c2a4,'totalAmountUSDT':Math[_0x96ec2e(0x17f)](_0x441b31*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x96ec2e(0x17f)](_0x2b802d*0x64)/0x64,'totalPayout':Math[_0x96ec2e(0x17f)](_0x4e2aef*0x64)/0x64,'thisMonth':Math[_0x96ec2e(0x17f)](_0x9cd855*0x64)/0x64}};}async['createPayout'](_0x28f4cf){const _0x216b37=a35_0x35e0f0,{shopId:_0x554e88,amount:_0x4a161e,network:_0x4583c8,wallet:_0x438e90,notes:_0x52bbe3,txid:_0x56f0e3,periodFrom:_0x1307b0,periodTo:_0x26b6c0}=_0x28f4cf,_0x21ce07=await database_1[_0x216b37(0x126)][_0x216b37(0x9a)](async _0x2fd052=>{const _0x193437=_0x216b37,_0x2f2ae6=await _0x2fd052['shop'][_0x193437(0x134)]({'where':{'id':_0x554e88},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x2f2ae6)throw new Error('Shop\x20not\x20found');console[_0x193437(0x185)]('💰\x20Creating\x20payout\x20for\x20shop\x20'+_0x2f2ae6[_0x193437(0x85)]+':'),console[_0x193437(0x185)](_0x193437(0x108)+_0x2f2ae6[_0x193437(0xe6)][_0x193437(0xc8)](0x6)+_0x193437(0x184)),console[_0x193437(0x185)]('\x20\x20\x20Payout\x20amount:\x20'+_0x4a161e[_0x193437(0xc8)](0x6)+_0x193437(0x184)),console[_0x193437(0x185)]('\x20\x20\x20Current\x20total\x20paid\x20out:\x20'+_0x2f2ae6[_0x193437(0x104)]['toFixed'](0x6)+_0x193437(0x184));if(_0x56f0e3)console[_0x193437(0x185)]('\x20\x20\x20Transaction\x20hash:\x20'+_0x56f0e3);if(_0x2f2ae6[_0x193437(0xe6)]<_0x4a161e)throw new Error('Insufficient\x20balance.\x20Available:\x20'+_0x2f2ae6[_0x193437(0xe6)][_0x193437(0xc8)](0x6)+'\x20USDT,\x20Requested:\x20'+_0x4a161e['toFixed'](0x6)+_0x193437(0x184));let _0x4874a2=_0x438e90;if(!_0x4874a2){const _0x3cbd1f=await _0x2fd052['shop'][_0x193437(0x134)]({'where':{'id':_0x554e88},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x3cbd1f)switch(_0x4583c8){case _0x193437(0xbb):_0x4874a2=_0x3cbd1f[_0x193437(0x168)]||undefined;break;case _0x193437(0x101):_0x4874a2=_0x3cbd1f[_0x193437(0x177)]||undefined;break;case'erc20':_0x4874a2=_0x3cbd1f[_0x193437(0x114)]||undefined;break;case _0x193437(0x116):_0x4874a2=_0x3cbd1f[_0x193437(0x88)]||undefined;break;}}console[_0x193437(0x185)]('💳\x20Payout\x20wallet\x20for\x20'+_0x4583c8+':\x20'+(_0x4874a2||_0x193437(0x144)));const _0x40c905=await _0x2fd052[_0x193437(0xb9)][_0x193437(0x7d)]({'data':{'shopId':_0x554e88,'amount':_0x4a161e,'network':_0x4583c8,'status':_0x193437(0xf0),'txid':_0x56f0e3,'notes':_0x52bbe3,'periodFrom':_0x1307b0?new Date(_0x1307b0):null,'periodTo':_0x26b6c0?new Date(_0x26b6c0):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x15b7c1=_0x2f2ae6[_0x193437(0xe6)]-_0x4a161e,_0x371645=_0x2f2ae6[_0x193437(0x104)]+_0x4a161e;return await _0x2fd052[_0x193437(0x190)][_0x193437(0xde)]({'where':{'id':_0x554e88},'data':{'balance':_0x15b7c1,'totalPaidOut':_0x371645}}),console[_0x193437(0x185)](_0x193437(0xa6)+_0x2f2ae6[_0x193437(0x85)]+'\x20balance\x20updated:'),console[_0x193437(0x185)](_0x193437(0xb7)+_0x2f2ae6[_0x193437(0xe6)][_0x193437(0xc8)](0x6)+'\x20->\x20'+_0x15b7c1[_0x193437(0xc8)](0x6)+_0x193437(0x94)+_0x4a161e[_0x193437(0xc8)](0x6)+')'),console[_0x193437(0x185)](_0x193437(0x15f)+_0x2f2ae6[_0x193437(0x104)][_0x193437(0xc8)](0x6)+_0x193437(0xae)+_0x371645['toFixed'](0x6)+_0x193437(0xa8)+_0x4a161e[_0x193437(0xc8)](0x6)+')'),{'payout':_0x40c905,'shop':_0x2f2ae6};});return console[_0x216b37(0x185)](_0x216b37(0xf4)+_0x21ce07[_0x216b37(0xb9)]['id']+_0x216b37(0x73)+_0x21ce07[_0x216b37(0x190)][_0x216b37(0x85)]+'\x20('+_0x4a161e+'\x20USDT)'),{'id':_0x21ce07[_0x216b37(0xb9)]['id'],'shopId':_0x21ce07[_0x216b37(0xb9)]['shopId'],'shopName':_0x21ce07[_0x216b37(0x190)][_0x216b37(0xd5)],'shopUsername':_0x21ce07['shop'][_0x216b37(0x85)],'amount':_0x21ce07[_0x216b37(0xb9)][_0x216b37(0x105)],'network':_0x21ce07[_0x216b37(0xb9)][_0x216b37(0x153)],'status':_0x21ce07[_0x216b37(0xb9)]['status'],'txid':_0x21ce07[_0x216b37(0xb9)][_0x216b37(0x138)],'notes':_0x21ce07['payout']['notes'],'periodFrom':_0x21ce07[_0x216b37(0xb9)][_0x216b37(0xb5)],'periodTo':_0x21ce07[_0x216b37(0xb9)]['periodTo'],'createdAt':_0x21ce07['payout'][_0x216b37(0xc2)],'paidAt':_0x21ce07[_0x216b37(0xb9)][_0x216b37(0xec)]};}async[a35_0x35e0f0(0xe3)](_0x20aa00){const _0x4f92cd=a35_0x35e0f0,{page:_0x7ef36b,limit:_0x4ed9c0,shopId:_0x25e6a3,network:_0x2e6478,dateFrom:_0x55e609,dateTo:_0x23bb88,search:_0x13e0b9}=_0x20aa00,_0x45e47a=(_0x7ef36b-0x1)*_0x4ed9c0,_0x3a63c8={};_0x25e6a3&&(_0x3a63c8[_0x4f92cd(0xa9)]=_0x25e6a3);_0x2e6478&&(_0x3a63c8[_0x4f92cd(0x153)]=_0x2e6478);(_0x55e609||_0x23bb88)&&(_0x3a63c8[_0x4f92cd(0xc2)]={},_0x55e609&&(_0x3a63c8[_0x4f92cd(0xc2)]['gte']=new Date(_0x55e609)),_0x23bb88&&(_0x3a63c8[_0x4f92cd(0xc2)][_0x4f92cd(0x8c)]=new Date(_0x23bb88)));_0x13e0b9&&(_0x3a63c8['OR']=[{'shop':{'name':{'contains':_0x13e0b9,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x13e0b9,'mode':_0x4f92cd(0xa5)}}},{'notes':{'contains':_0x13e0b9,'mode':_0x4f92cd(0xa5)}}]);const [_0x45e52d,_0x511dc6]=await Promise[_0x4f92cd(0xea)]([database_1['default']['payout']['findMany']({'where':_0x3a63c8,'skip':_0x45e47a,'take':_0x4ed9c0,'orderBy':{'createdAt':_0x4f92cd(0xda)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x4f92cd(0x126)][_0x4f92cd(0xb9)][_0x4f92cd(0xcf)]({'where':_0x3a63c8})]);return{'payouts':_0x45e52d['map'](_0x3a9e0c=>({'id':_0x3a9e0c['id'],'shopId':_0x3a9e0c[_0x4f92cd(0xa9)],'shopName':_0x3a9e0c['shop'][_0x4f92cd(0xd5)],'shopUsername':_0x3a9e0c[_0x4f92cd(0x190)][_0x4f92cd(0x85)],'amount':_0x3a9e0c['amount'],'network':_0x3a9e0c['network'],'status':_0x3a9e0c['status'],'txid':_0x3a9e0c[_0x4f92cd(0x138)],'notes':_0x3a9e0c['notes'],'periodFrom':_0x3a9e0c[_0x4f92cd(0xb5)],'periodTo':_0x3a9e0c[_0x4f92cd(0xff)],'createdAt':_0x3a9e0c[_0x4f92cd(0xc2)],'paidAt':_0x3a9e0c[_0x4f92cd(0xec)]})),'pagination':{'page':_0x7ef36b,'limit':_0x4ed9c0,'total':_0x511dc6,'totalPages':Math[_0x4f92cd(0x90)](_0x511dc6/_0x4ed9c0)}};}async[a35_0x35e0f0(0x146)](_0x3938ff){const _0xd2771d=a35_0x35e0f0,_0x5a457c=await database_1[_0xd2771d(0x126)][_0xd2771d(0xb9)][_0xd2771d(0x134)]({'where':{'id':_0x3938ff},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x5a457c)return null;return{'id':_0x5a457c['id'],'shopId':_0x5a457c[_0xd2771d(0xa9)],'shopName':_0x5a457c[_0xd2771d(0x190)][_0xd2771d(0xd5)],'shopUsername':_0x5a457c[_0xd2771d(0x190)][_0xd2771d(0x85)],'amount':_0x5a457c[_0xd2771d(0x105)],'network':_0x5a457c['network'],'status':_0x5a457c[_0xd2771d(0x135)],'txid':_0x5a457c[_0xd2771d(0x138)],'notes':_0x5a457c['notes'],'periodFrom':_0x5a457c['periodFrom'],'periodTo':_0x5a457c['periodTo'],'createdAt':_0x5a457c['createdAt'],'paidAt':_0x5a457c['paidAt']};}async[a35_0x35e0f0(0xcc)](_0x2851f1){await database_1['default']['payout']['delete']({'where':{'id':_0x2851f1}});}async[a35_0x35e0f0(0xdc)](_0x6388c9){const _0xf3280=a35_0x35e0f0,{page:_0x14a5db,limit:_0x160f3b,status:_0x3f102e,gateway:_0x485e52,shopId:_0x587087,dateFrom:_0x5549b7,dateTo:_0x53d3b9,search:_0xbd6e05,currency:_0x67b45c,sortBy:_0x2e6c8e,sortOrder:_0x591974}=_0x6388c9,_0x4eb27f=(_0x14a5db-0x1)*_0x160f3b;console['log'](_0xf3280(0x77),_0x6388c9);const _0x3cfe2e=await database_1[_0xf3280(0x126)][_0xf3280(0x178)][_0xf3280(0x11b)]({'by':['gateway'],'_count':{'gateway':!![]}});console[_0xf3280(0x185)]('📊\x20Available\x20gateways\x20in\x20database:',_0x3cfe2e[_0xf3280(0xfb)](_0x55f546=>_0x55f546[_0xf3280(0xcb)]+'\x20('+_0x55f546[_0xf3280(0x79)][_0xf3280(0xcb)]+_0xf3280(0x16d)));if(_0x485e52){const _0x418756=_0x3cfe2e[_0xf3280(0xc5)](_0x4b8f1d=>_0x4b8f1d[_0xf3280(0xcb)]['toLowerCase']()===_0x485e52['toLowerCase']());!_0x418756&&_0x485e52[_0xf3280(0x13a)]()!==_0xf3280(0x13f)&&console[_0xf3280(0x185)](_0xf3280(0x127)+_0x485e52+_0xf3280(0xdd)+_0x3cfe2e['map'](_0x2aabbf=>_0x2aabbf['gateway'])['join'](',\x20'));}const _0x678e90={};_0x3f102e&&(_0x678e90[_0xf3280(0x135)]=_0x3f102e[_0xf3280(0x183)]());if(!_0x485e52)_0x678e90['gateway']={'not':_0xf3280(0x13f)};else{if(_0x485e52&&(_0x485e52['toLowerCase']()===_0xf3280(0x13f)||_0x485e52===_0xf3280(0xa1)))_0x678e90[_0xf3280(0xcb)]=_0xf3280(0x13f);else{let _0x501968=_0x485e52;const _0x3dcc89=(0x0,gateway_1['getGatewayNameById'])(_0x485e52);if(_0x3dcc89)_0x501968=_0x3dcc89,console['log'](_0xf3280(0x80)+_0x485e52+'\x27\x20to\x20name\x20\x27'+_0x501968+'\x27');else{const _0x113a60=(0x0,gateway_1[_0xf3280(0x142)])(_0x485e52);if(_0x113a60){const _0x262f01=(0x0,gateway_1['getGatewayNameById'])(_0x113a60);_0x262f01&&(_0x501968=_0x262f01,console['log'](_0xf3280(0xa4)+_0x485e52+_0xf3280(0xb2)+_0x113a60+_0xf3280(0x109)+_0x501968+'\x27'));}else console[_0xf3280(0x185)](_0xf3280(0x136)+_0x485e52+_0xf3280(0x17b));}const _0x5eef43=await database_1['default'][_0xf3280(0x178)][_0xf3280(0xcf)]({'where':{'gateway':_0x501968[_0xf3280(0x13a)]()},'take':0x1});_0x5eef43===0x0?(console['log']('⚠️\x20Gateway\x20\x27'+_0x501968+'\x27\x20(from\x20\x27'+_0x485e52+_0xf3280(0x172)),_0x678e90['gateway']='NONEXISTENT_GATEWAY_FILTER'):(_0x678e90[_0xf3280(0xcb)]=_0x501968[_0xf3280(0x13a)](),console[_0xf3280(0x185)](_0xf3280(0x15e)+_0x501968+_0xf3280(0x16c)+_0x485e52+'\x27)'));}}console[_0xf3280(0x185)]('📊\x20Gateway\x20filter\x20applied:',_0x678e90[_0xf3280(0xcb)]);_0x587087&&(_0x678e90[_0xf3280(0xa9)]=_0x587087);_0x67b45c&&(_0x678e90['currency']=_0x67b45c[_0xf3280(0x183)](),console['log'](_0xf3280(0x182)+_0x67b45c['toUpperCase']()));(_0x5549b7||_0x53d3b9)&&(_0x678e90[_0xf3280(0xc2)]={},_0x5549b7&&(_0x678e90[_0xf3280(0xc2)][_0xf3280(0xd7)]=new Date(_0x5549b7)),_0x53d3b9&&(_0x678e90[_0xf3280(0xc2)]['lte']=new Date(_0x53d3b9)));_0xbd6e05&&(_0x678e90['OR']=[{'id':{'contains':_0xbd6e05,'mode':_0xf3280(0xa5)}},{'orderId':{'contains':_0xbd6e05,'mode':_0xf3280(0xa5)}},{'gatewayOrderId':{'contains':_0xbd6e05,'mode':'insensitive'}},{'customerEmail':{'contains':_0xbd6e05,'mode':'insensitive'}},{'shop':{'name':{'contains':_0xbd6e05,'mode':_0xf3280(0xa5)}}},{'shop':{'username':{'contains':_0xbd6e05,'mode':'insensitive'}}}]);console[_0xf3280(0x185)](_0xf3280(0x194),JSON[_0xf3280(0x13c)](_0x678e90,null,0x2));let _0x255bd8={'createdAt':_0xf3280(0xda)};if(_0x2e6c8e){const _0x4fcc97=['amount',_0xf3280(0xc2),_0xf3280(0xe4),'status',_0xf3280(0xcb),_0xf3280(0xf7)],_0x4198a1=[_0xf3280(0xc0),'desc'];if(_0x4fcc97['includes'](_0x2e6c8e)){const _0x2490d7=_0x4198a1[_0xf3280(0xe9)](_0x591974)?_0x591974:_0xf3280(0xda);_0x255bd8={[_0x2e6c8e]:_0x2490d7},console[_0xf3280(0x185)](_0xf3280(0x14c)+_0x2e6c8e+_0xf3280(0x148)+_0x2490d7+'\x20order');}}const [_0x410446,_0x6e543c]=await Promise[_0xf3280(0xea)]([database_1[_0xf3280(0x126)][_0xf3280(0x178)][_0xf3280(0x16b)]({'where':_0x678e90,'skip':_0x4eb27f,'take':_0x160f3b,'orderBy':_0x255bd8,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0xf3280(0x126)][_0xf3280(0x178)][_0xf3280(0xcf)]({'where':_0x678e90})]);return{'payments':_0x410446,'pagination':{'page':_0x14a5db,'limit':_0x160f3b,'total':_0x6e543c,'totalPages':Math[_0xf3280(0x90)](_0x6e543c/_0x160f3b)}};}async[a35_0x35e0f0(0x162)](_0x5e4a46){const _0x27e7da=a35_0x35e0f0,_0x2083b6=await database_1[_0x27e7da(0x126)]['payment'][_0x27e7da(0x134)]({'where':{'id':_0x5e4a46},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x2083b6)return null;return{'id':_0x2083b6['id'],'shopId':_0x2083b6[_0x27e7da(0xa9)],'gateway':_0x2083b6[_0x27e7da(0xcb)],'amount':_0x2083b6['amount'],'currency':_0x2083b6[_0x27e7da(0xf7)],'status':_0x2083b6[_0x27e7da(0x135)],'orderId':_0x2083b6[_0x27e7da(0x157)],'gatewayOrderId':_0x2083b6[_0x27e7da(0xd0)],'customerEmail':_0x2083b6[_0x27e7da(0x119)],'customerName':_0x2083b6[_0x27e7da(0xf6)],'customerCountry':_0x2083b6[_0x27e7da(0xce)],'customerIp':_0x2083b6['customerIp'],'customerUa':_0x2083b6[_0x27e7da(0xf5)],'failureMessage':_0x2083b6[_0x27e7da(0xcd)],'externalPaymentUrl':_0x2083b6['externalPaymentUrl'],'successUrl':_0x2083b6[_0x27e7da(0x9d)],'failUrl':_0x2083b6[_0x27e7da(0x124)],'pendingUrl':_0x2083b6['pendingUrl'],'whiteUrl':_0x2083b6[_0x27e7da(0xc6)],'createdAt':_0x2083b6[_0x27e7da(0xc2)],'updatedAt':_0x2083b6[_0x27e7da(0xe4)],'shop':_0x2083b6[_0x27e7da(0x190)]};}async[a35_0x35e0f0(0xba)](_0xfa7d15,_0x2d1825,_0x117038,_0xb659a7){const _0x5939f8=a35_0x35e0f0,_0x42fda3=await database_1[_0x5939f8(0x126)][_0x5939f8(0x9a)](async _0x1cb811=>{const _0x3b2279=_0x5939f8,_0x22a3ae=await _0x1cb811[_0x3b2279(0x178)][_0x3b2279(0x134)]({'where':{'id':_0xfa7d15},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x22a3ae)throw new Error(_0x3b2279(0x141));const _0x33f85d=_0x22a3ae[_0x3b2279(0x135)],_0x18780e=_0x2d1825['toUpperCase']();console[_0x3b2279(0x185)]('🔄\x20Admin\x20updating\x20payment\x20'+_0xfa7d15+_0x3b2279(0x176)+_0x33f85d+_0x3b2279(0xae)+_0x18780e),console[_0x3b2279(0x185)]('💰\x20Current\x20shop\x20balance:\x20'+_0x22a3ae[_0x3b2279(0x190)][_0x3b2279(0xe6)]+'\x20USDT');const _0x4d4169={'status':_0x18780e,'updatedAt':new Date(),'statusChangedBy':_0x3b2279(0x9b),'statusChangedAt':new Date()};_0x117038&&(_0x4d4169[_0x3b2279(0x132)]=_0x117038);_0x18780e===_0x3b2279(0x167)&&_0xb659a7&&(_0x4d4169[_0x3b2279(0x188)]=_0xb659a7);let _0x18ad07=0x0,_0x5f1380=_0x22a3ae[_0x3b2279(0x190)][_0x3b2279(0xe6)];if(_0x18780e==='PAID'&&_0x33f85d!==_0x3b2279(0x158)){_0x4d4169['paidAt']=new Date();const _0x472f81=await currencyService_1[_0x3b2279(0xd2)][_0x3b2279(0xed)](_0x22a3ae[_0x3b2279(0x105)],_0x22a3ae[_0x3b2279(0xf7)]);_0x4d4169[_0x3b2279(0x16a)]=_0x472f81;let _0x56db03=0xa;const _0x50a402=await _0x1cb811['shop'][_0x3b2279(0x134)]({'where':{'id':_0x22a3ae[_0x3b2279(0xa9)]},'select':{'gatewaySettings':!![]}});if(_0x50a402?.[_0x3b2279(0x18d)])try{const _0xc4cdcf=JSON[_0x3b2279(0x164)](_0x50a402[_0x3b2279(0x18d)]);for(const [_0x55879b,_0x599c5c]of Object[_0x3b2279(0x7f)](_0xc4cdcf)){if(_0x55879b[_0x3b2279(0x13a)]()===_0x22a3ae['gateway'][_0x3b2279(0x13a)]()){_0x56db03=_0x599c5c[_0x3b2279(0xc7)]||0xa;break;}}}catch(_0x40791e){console['error'](_0x3b2279(0x10c)+_0xfa7d15+':',_0x40791e);}const _0x3d0d09=_0x472f81*(0x1-_0x56db03/0x64);_0x18ad07=_0x3d0d09,_0x5f1380+=_0x3d0d09,console[_0x3b2279(0x185)](_0x3b2279(0x103)+_0xfa7d15+_0x3b2279(0x137)),console['log'](_0x3b2279(0xbc)+_0x472f81[_0x3b2279(0xc8)](0x6)+'\x20USDT'),console[_0x3b2279(0x185)]('\x20\x20\x20Gateway:\x20'+_0x22a3ae[_0x3b2279(0xcb)]+',\x20Commission:\x20'+_0x56db03+'%'),console[_0x3b2279(0x185)](_0x3b2279(0x71)+_0x3d0d09[_0x3b2279(0xc8)](0x6)+_0x3b2279(0x7c)+_0x56db03+'%\x20commission)'),console['log'](_0x3b2279(0x8d)+_0x3d0d09['toFixed'](0x6)+_0x3b2279(0x184));}else{if(_0x33f85d===_0x3b2279(0x158)&&_0x18780e!==_0x3b2279(0x158)){if(_0x22a3ae[_0x3b2279(0x16a)]){let _0x30da2e=0xa;const _0x1fe902=await _0x1cb811[_0x3b2279(0x190)][_0x3b2279(0x134)]({'where':{'id':_0x22a3ae[_0x3b2279(0xa9)]},'select':{'gatewaySettings':!![]}});if(_0x1fe902?.[_0x3b2279(0x18d)])try{const _0x590217=JSON['parse'](_0x1fe902[_0x3b2279(0x18d)]);for(const [_0x59b5ce,_0x334c90]of Object['entries'](_0x590217)){if(_0x59b5ce[_0x3b2279(0x13a)]()===_0x22a3ae[_0x3b2279(0xcb)][_0x3b2279(0x13a)]()){_0x30da2e=_0x334c90[_0x3b2279(0xc7)]||0xa;break;}}}catch(_0x4ab96d){console['error']('Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20'+_0xfa7d15+':',_0x4ab96d);}const _0x2ae0fd=_0x22a3ae[_0x3b2279(0x16a)]*(0x1-_0x30da2e/0x64);_0x18ad07=-_0x2ae0fd,_0x5f1380-=_0x2ae0fd,_0x4d4169[_0x3b2279(0x16a)]=null,console[_0x3b2279(0x185)](_0x3b2279(0x103)+_0xfa7d15+_0x3b2279(0xb4)),console['log']('\x20\x20\x20Full\x20amount:\x20'+_0x22a3ae[_0x3b2279(0x16a)][_0x3b2279(0xc8)](0x6)+_0x3b2279(0x184)),console[_0x3b2279(0x185)]('\x20\x20\x20Gateway:\x20'+_0x22a3ae[_0x3b2279(0xcb)]+_0x3b2279(0xb8)+_0x30da2e+'%'),console['log'](_0x3b2279(0x192)+_0x2ae0fd[_0x3b2279(0xc8)](0x6)+_0x3b2279(0x7c)+_0x30da2e+_0x3b2279(0xf8)),console['log']('\x20\x20\x20Subtracted\x20from\x20balance:\x20-'+_0x2ae0fd[_0x3b2279(0xc8)](0x6)+_0x3b2279(0x184));}}}_0x18780e===_0x3b2279(0x167)&&(_0x33f85d===_0x3b2279(0x158)&&_0x22a3ae['amountUSDT']&&console[_0x3b2279(0x185)]('💸\x20CHARGEBACK:\x20Merchant\x20amount\x20already\x20deducted\x20from\x20balance'),_0xb659a7&&_0xb659a7>0x0&&(_0x18ad07-=_0xb659a7,_0x5f1380-=_0xb659a7,console[_0x3b2279(0x185)](_0x3b2279(0x171)+_0xb659a7[_0x3b2279(0xc8)](0x6)+_0x3b2279(0xf1))));_0x18780e==='REFUND'&&_0x33f85d===_0x3b2279(0x158)&&console[_0x3b2279(0x185)]('🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance');const _0x167a0e=await _0x1cb811[_0x3b2279(0x178)][_0x3b2279(0xde)]({'where':{'id':_0xfa7d15},'data':_0x4d4169,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x18ad07!==0x0&&(await _0x1cb811[_0x3b2279(0x190)][_0x3b2279(0xde)]({'where':{'id':_0x22a3ae[_0x3b2279(0xa9)]},'data':{'balance':_0x5f1380}}),console['log'](_0x3b2279(0xa6)+_0x22a3ae['shopId']+_0x3b2279(0x72)+_0x22a3ae[_0x3b2279(0x190)][_0x3b2279(0xe6)]['toFixed'](0x6)+_0x3b2279(0xae)+_0x5f1380[_0x3b2279(0xc8)](0x6)+_0x3b2279(0x83)+(_0x18ad07>0x0?'+':'')+_0x18ad07[_0x3b2279(0xc8)](0x6)+')')),_0x167a0e;});return{'id':_0x42fda3['id'],'shopId':_0x42fda3[_0x5939f8(0xa9)],'gateway':_0x42fda3[_0x5939f8(0xcb)],'amount':_0x42fda3[_0x5939f8(0x105)],'currency':_0x42fda3[_0x5939f8(0xf7)],'status':_0x42fda3[_0x5939f8(0x135)],'orderId':_0x42fda3[_0x5939f8(0x157)],'gatewayOrderId':_0x42fda3[_0x5939f8(0xd0)],'customerEmail':_0x42fda3[_0x5939f8(0x119)],'customerName':_0x42fda3[_0x5939f8(0xf6)],'customerCountry':_0x42fda3[_0x5939f8(0xce)],'customerIp':_0x42fda3[_0x5939f8(0x9e)],'customerUa':_0x42fda3[_0x5939f8(0xf5)],'failureMessage':_0x42fda3[_0x5939f8(0xcd)],'adminNotes':_0x42fda3[_0x5939f8(0x132)],'chargebackAmount':_0x42fda3[_0x5939f8(0x188)],'statusChangedBy':_0x42fda3[_0x5939f8(0x156)],'statusChangedAt':_0x42fda3['statusChangedAt'],'createdAt':_0x42fda3[_0x5939f8(0xc2)],'updatedAt':_0x42fda3[_0x5939f8(0xe4)],'shop':_0x42fda3[_0x5939f8(0x190)]};}async['updateUser'](_0x3a9f54,_0x544126){const _0x2bed4d=a35_0x35e0f0,_0x4b66f7={..._0x544126};_0x544126[_0x2bed4d(0x13d)]&&(_0x4b66f7[_0x2bed4d(0x13d)]=await bcryptjs_1[_0x2bed4d(0x126)][_0x2bed4d(0xad)](_0x544126[_0x2bed4d(0x13d)],0xc));_0x544126[_0x2bed4d(0x149)]&&(_0x4b66f7[_0x2bed4d(0xd5)]=_0x544126[_0x2bed4d(0x149)],delete _0x4b66f7['fullName']);_0x544126[_0x2bed4d(0x18e)]&&(_0x4b66f7[_0x2bed4d(0x78)]=_0x544126[_0x2bed4d(0x18e)],delete _0x4b66f7[_0x2bed4d(0x18e)]);_0x544126[_0x2bed4d(0xfa)]&&(_0x4b66f7[_0x2bed4d(0x74)]=_0x544126['merchantUrl'],delete _0x4b66f7[_0x2bed4d(0xfa)]);if(_0x544126['gateways']){const _0x29ef1f=_0x544126[_0x2bed4d(0x98)][_0x2bed4d(0xfb)](_0x3fceb7=>this['getGatewayInternalName'](_0x3fceb7));console[_0x2bed4d(0x185)](_0x2bed4d(0x187),_0x544126[_0x2bed4d(0x98)],'->',_0x29ef1f),_0x4b66f7[_0x2bed4d(0xfe)]=JSON[_0x2bed4d(0x13c)](_0x29ef1f),delete _0x4b66f7[_0x2bed4d(0x98)];}_0x544126[_0x2bed4d(0x18d)]&&(_0x4b66f7[_0x2bed4d(0x18d)]=JSON[_0x2bed4d(0x13c)](_0x544126[_0x2bed4d(0x18d)]),delete _0x4b66f7[_0x2bed4d(0x18d)]);_0x544126[_0x2bed4d(0x18f)]&&(_0x544126[_0x2bed4d(0x18f)][_0x2bed4d(0x168)]!==undefined&&(_0x4b66f7[_0x2bed4d(0x168)]=_0x544126[_0x2bed4d(0x18f)][_0x2bed4d(0x168)]||null),_0x544126[_0x2bed4d(0x18f)][_0x2bed4d(0x177)]!==undefined&&(_0x4b66f7[_0x2bed4d(0x177)]=_0x544126['wallets'][_0x2bed4d(0x177)]||null),_0x544126['wallets'][_0x2bed4d(0x114)]!==undefined&&(_0x4b66f7[_0x2bed4d(0x114)]=_0x544126[_0x2bed4d(0x18f)][_0x2bed4d(0x114)]||null),_0x544126['wallets']['usdcPolygonWallet']!==undefined&&(_0x4b66f7[_0x2bed4d(0x88)]=_0x544126[_0x2bed4d(0x18f)]['usdcPolygonWallet']||null),delete _0x4b66f7[_0x2bed4d(0x18f)]);const _0x98dc4b=await database_1['default'][_0x2bed4d(0x190)][_0x2bed4d(0xde)]({'where':{'id':_0x3a9f54},'data':_0x4b66f7,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x98dc4b['id'],'fullName':_0x98dc4b[_0x2bed4d(0xd5)],'username':_0x98dc4b[_0x2bed4d(0x85)],'telegramId':_0x98dc4b['telegram'],'merchantUrl':_0x98dc4b['shopUrl'],'gateways':_0x98dc4b[_0x2bed4d(0xfe)]?JSON[_0x2bed4d(0x164)](_0x98dc4b[_0x2bed4d(0xfe)]):null,'gatewaySettings':_0x98dc4b[_0x2bed4d(0x18d)]?JSON[_0x2bed4d(0x164)](_0x98dc4b[_0x2bed4d(0x18d)]):null,'publicKey':_0x98dc4b[_0x2bed4d(0x139)],'wallets':{'usdtPolygonWallet':_0x98dc4b[_0x2bed4d(0x168)],'usdtTrcWallet':_0x98dc4b[_0x2bed4d(0x177)],'usdtErcWallet':_0x98dc4b[_0x2bed4d(0x114)],'usdcPolygonWallet':_0x98dc4b[_0x2bed4d(0x88)]},'status':_0x98dc4b['status'],'createdAt':_0x98dc4b['createdAt']};}async[a35_0x35e0f0(0xc4)](_0x2495bd){const _0x573bdf=a35_0x35e0f0,_0x17133b=await database_1[_0x573bdf(0x126)][_0x573bdf(0x190)][_0x573bdf(0xde)]({'where':{'id':_0x2495bd},'data':{'status':'SUSPENDED'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x17133b['id'],'fullName':_0x17133b[_0x573bdf(0xd5)],'username':_0x17133b['username'],'telegramId':_0x17133b[_0x573bdf(0x78)],'merchantUrl':_0x17133b[_0x573bdf(0x74)],'gateways':_0x17133b[_0x573bdf(0xfe)]?JSON[_0x573bdf(0x164)](_0x17133b['paymentGateways']):null,'gatewaySettings':_0x17133b[_0x573bdf(0x18d)]?JSON[_0x573bdf(0x164)](_0x17133b[_0x573bdf(0x18d)]):null,'publicKey':_0x17133b[_0x573bdf(0x139)],'wallets':{'usdtPolygonWallet':_0x17133b[_0x573bdf(0x168)],'usdtTrcWallet':_0x17133b[_0x573bdf(0x177)],'usdtErcWallet':_0x17133b[_0x573bdf(0x114)],'usdcPolygonWallet':_0x17133b[_0x573bdf(0x88)]},'status':_0x17133b[_0x573bdf(0x135)],'createdAt':_0x17133b[_0x573bdf(0xc2)]};}async['activateUser'](_0x38004d){const _0x1a5a48=a35_0x35e0f0,_0x70e78=await database_1[_0x1a5a48(0x126)]['shop'][_0x1a5a48(0xde)]({'where':{'id':_0x38004d},'data':{'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x70e78['id'],'fullName':_0x70e78[_0x1a5a48(0xd5)],'username':_0x70e78[_0x1a5a48(0x85)],'telegramId':_0x70e78[_0x1a5a48(0x78)],'merchantUrl':_0x70e78[_0x1a5a48(0x74)],'gateways':_0x70e78[_0x1a5a48(0xfe)]?JSON[_0x1a5a48(0x164)](_0x70e78[_0x1a5a48(0xfe)]):null,'gatewaySettings':_0x70e78[_0x1a5a48(0x18d)]?JSON['parse'](_0x70e78[_0x1a5a48(0x18d)]):null,'publicKey':_0x70e78['publicKey'],'wallets':{'usdtPolygonWallet':_0x70e78[_0x1a5a48(0x168)],'usdtTrcWallet':_0x70e78[_0x1a5a48(0x177)],'usdtErcWallet':_0x70e78[_0x1a5a48(0x114)],'usdcPolygonWallet':_0x70e78['usdcPolygonWallet']},'status':_0x70e78[_0x1a5a48(0x135)],'createdAt':_0x70e78[_0x1a5a48(0xc2)]};}async[a35_0x35e0f0(0x14b)](_0x5bbae7){const _0x17a859=a35_0x35e0f0,{page:_0x19c3b1,limit:_0x4b2104,status:_0x18399d}=_0x5bbae7,_0x4b9238=(_0x19c3b1-0x1)*_0x4b2104,_0x2acab7={};_0x18399d&&(_0x2acab7[_0x17a859(0x135)]=_0x18399d[_0x17a859(0x183)]());const [_0x3388b4,_0x5db971]=await Promise[_0x17a859(0xea)]([database_1[_0x17a859(0x126)][_0x17a859(0x190)][_0x17a859(0x16b)]({'where':_0x2acab7,'skip':_0x4b9238,'take':_0x4b2104,'orderBy':{'createdAt':_0x17a859(0xda)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1['default'][_0x17a859(0x190)][_0x17a859(0xcf)]({'where':_0x2acab7})]);return{'users':_0x3388b4['map'](_0x421c5b=>{const _0x1208df=_0x17a859,_0x1027ef=_0x421c5b[_0x1208df(0xfe)]?JSON[_0x1208df(0x164)](_0x421c5b[_0x1208df(0xfe)]):null,_0x18e035=_0x1027ef?_0x1027ef[_0x1208df(0xfb)](_0x493bb5=>this[_0x1208df(0x131)](_0x493bb5)):null;return{'id':_0x421c5b['id'],'fullName':_0x421c5b[_0x1208df(0xd5)],'username':_0x421c5b[_0x1208df(0x85)],'telegramId':_0x421c5b[_0x1208df(0x78)],'merchantUrl':_0x421c5b[_0x1208df(0x74)],'gateways':_0x18e035,'gatewaySettings':_0x421c5b[_0x1208df(0x18d)]?JSON['parse'](_0x421c5b['gatewaySettings']):null,'publicKey':_0x421c5b[_0x1208df(0x139)],'wallets':{'usdtPolygonWallet':_0x421c5b[_0x1208df(0x168)],'usdtTrcWallet':_0x421c5b['usdtTrcWallet'],'usdtErcWallet':_0x421c5b['usdtErcWallet'],'usdcPolygonWallet':_0x421c5b[_0x1208df(0x88)]},'status':_0x421c5b[_0x1208df(0x135)],'createdAt':_0x421c5b['createdAt']};}),'pagination':{'page':_0x19c3b1,'limit':_0x4b2104,'total':_0x5db971,'totalPages':Math[_0x17a859(0x90)](_0x5db971/_0x4b2104)}};}async[a35_0x35e0f0(0x75)](_0x41ab38){const _0x40dd26=a35_0x35e0f0,_0xed8348=await database_1[_0x40dd26(0x126)][_0x40dd26(0x190)][_0x40dd26(0x134)]({'where':{'id':_0x41ab38},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0xed8348)return null;const _0x5d3425=_0xed8348[_0x40dd26(0xfe)]?JSON[_0x40dd26(0x164)](_0xed8348[_0x40dd26(0xfe)]):null,_0x4c0c57=_0x5d3425?_0x5d3425[_0x40dd26(0xfb)](_0x2bfeb9=>this[_0x40dd26(0x131)](_0x2bfeb9)):null;return _0x5d3425&&_0x4c0c57&&console['log'](_0x40dd26(0x122),_0x5d3425,'->',_0x4c0c57),{'id':_0xed8348['id'],'fullName':_0xed8348[_0x40dd26(0xd5)],'username':_0xed8348['username'],'telegramId':_0xed8348[_0x40dd26(0x78)],'merchantUrl':_0xed8348[_0x40dd26(0x74)],'gateways':_0x4c0c57,'gatewaySettings':_0xed8348[_0x40dd26(0x18d)]?JSON[_0x40dd26(0x164)](_0xed8348[_0x40dd26(0x18d)]):null,'publicKey':_0xed8348['publicKey'],'wallets':{'usdtPolygonWallet':_0xed8348[_0x40dd26(0x168)],'usdtTrcWallet':_0xed8348[_0x40dd26(0x177)],'usdtErcWallet':_0xed8348[_0x40dd26(0x114)],'usdcPolygonWallet':_0xed8348[_0x40dd26(0x88)]},'status':_0xed8348['status'],'createdAt':_0xed8348[_0x40dd26(0xc2)]};}async[a35_0x35e0f0(0x18c)](_0x18974b){const _0x4f5301=a35_0x35e0f0,{fullName:_0x336918,username:_0x122465,password:_0x3ec595,telegramId:_0x444340,merchantUrl:_0x5c4c27,gateways:_0x325c40,gatewaySettings:_0x12d1ff,wallets:_0x1c5494}=_0x18974b,_0xd0eae0=await database_1[_0x4f5301(0x126)][_0x4f5301(0x190)][_0x4f5301(0x134)]({'where':{'username':_0x122465}});if(_0xd0eae0)throw new Error(_0x4f5301(0x165));if(_0x444340){const _0x3b5331=await database_1[_0x4f5301(0x126)][_0x4f5301(0x190)][_0x4f5301(0x134)]({'where':{'telegram':_0x444340}});if(_0x3b5331)throw new Error('Telegram\x20username\x20already\x20exists');}const _0x2d3c7d=await bcryptjs_1[_0x4f5301(0x126)][_0x4f5301(0xad)](_0x3ec595,0xc),_0x385345=_0x4f5301(0xeb)+crypto_1[_0x4f5301(0x126)][_0x4f5301(0x161)](0x20)[_0x4f5301(0x15a)](_0x4f5301(0x87)),_0x262b53=_0x4f5301(0x93)+crypto_1['default'][_0x4f5301(0x161)](0x20)[_0x4f5301(0x15a)](_0x4f5301(0x87)),_0x3943c8=_0x325c40?_0x325c40[_0x4f5301(0xfb)](_0x22cbdc=>this['getGatewayInternalName'](_0x22cbdc)):null;_0x325c40&&_0x3943c8&&console[_0x4f5301(0x185)](_0x4f5301(0xac),_0x325c40,'->',_0x3943c8);const _0x43955a=await database_1[_0x4f5301(0x126)][_0x4f5301(0x190)][_0x4f5301(0x7d)]({'data':{'name':_0x336918,'username':_0x122465,'password':_0x2d3c7d,'telegram':_0x444340,'shopUrl':_0x5c4c27,'paymentGateways':_0x3943c8?JSON[_0x4f5301(0x13c)](_0x3943c8):null,'gatewaySettings':_0x12d1ff?JSON[_0x4f5301(0x13c)](_0x12d1ff):null,'usdtPolygonWallet':_0x1c5494?.['usdtPolygonWallet']||null,'usdtTrcWallet':_0x1c5494?.[_0x4f5301(0x177)]||null,'usdtErcWallet':_0x1c5494?.[_0x4f5301(0x114)]||null,'usdcPolygonWallet':_0x1c5494?.[_0x4f5301(0x88)]||null,'publicKey':_0x385345,'secretKey':_0x262b53,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x43955a['id'],'fullName':_0x43955a[_0x4f5301(0xd5)],'username':_0x43955a[_0x4f5301(0x85)],'telegramId':_0x43955a[_0x4f5301(0x78)],'merchantUrl':_0x43955a[_0x4f5301(0x74)],'gateways':_0x43955a[_0x4f5301(0xfe)]?JSON[_0x4f5301(0x164)](_0x43955a[_0x4f5301(0xfe)]):null,'gatewaySettings':_0x43955a[_0x4f5301(0x18d)]?JSON['parse'](_0x43955a[_0x4f5301(0x18d)]):null,'publicKey':_0x43955a['publicKey'],'wallets':{'usdtPolygonWallet':_0x43955a[_0x4f5301(0x168)],'usdtTrcWallet':_0x43955a[_0x4f5301(0x177)],'usdtErcWallet':_0x43955a[_0x4f5301(0x114)],'usdcPolygonWallet':_0x43955a[_0x4f5301(0x88)]},'status':_0x43955a[_0x4f5301(0x135)],'createdAt':_0x43955a[_0x4f5301(0xc2)]};}async[a35_0x35e0f0(0xb0)](_0x182bd3){const _0x293d56=a35_0x35e0f0;await database_1['default'][_0x293d56(0x190)][_0x293d56(0x13b)]({'where':{'id':_0x182bd3}});}['generateDailyStatistics'](_0xf80f68,_0x4360f4,_0x1117cc){const _0x59b10c=a35_0x35e0f0,_0x221ac1=new Map(),_0x12d32f=new Date(_0x4360f4);while(_0x12d32f<=_0x1117cc){const _0x1c9b52=_0x12d32f[_0x59b10c(0xd1)]()[_0x59b10c(0x7e)]('T')[0x0];_0x221ac1[_0x59b10c(0x145)](_0x1c9b52,{'revenue':0x0,'count':0x0}),_0x12d32f[_0x59b10c(0xd9)](_0x12d32f[_0x59b10c(0x173)]()+0x1);}for(const _0x5c78db of _0xf80f68){const _0x4b6afc=_0x5c78db['createdAt']['toISOString']()['split']('T')[0x0],_0x28a4d0=_0x221ac1[_0x59b10c(0xef)](_0x4b6afc);_0x28a4d0&&(_0x28a4d0[_0x59b10c(0xcf)]+=0x1,_0x5c78db[_0x59b10c(0x135)]===_0x59b10c(0x158)&&(_0x5c78db[_0x59b10c(0x16a)]?_0x28a4d0[_0x59b10c(0x17c)]+=_0x5c78db['amountUSDT']:console['log'](_0x59b10c(0xdb)+_0x5c78db['id']+_0x59b10c(0x95))));}const _0x1215e0=[],_0x2a715d=[];for(const [_0x3a2d0b,_0x1306c4]of _0x221ac1){_0x1215e0[_0x59b10c(0x16e)]({'date':_0x3a2d0b,'amount':Math[_0x59b10c(0x17f)](_0x1306c4[_0x59b10c(0x17c)]*0x64)/0x64}),_0x2a715d[_0x59b10c(0x16e)]({'date':_0x3a2d0b,'count':_0x1306c4['count']});}return{'dailyRevenue':_0x1215e0,'dailyPayments':_0x2a715d};}}exports[a35_0x35e0f0(0xd3)]=AdminService;