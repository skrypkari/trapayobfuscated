'use strict';function a46_0xf4c9(){const _0x53345c=['ðŸ“Š\x20Calculating\x20payout\x20statistics...','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','getGatewayNameById','polygon_usdc','ðŸ”§\x20[','status','4603608wwEwbB','\x20USDT\x20(after\x20','paymentsCount','ðŸ“Š\x20Total\x20payments\x20(including\x20failed):\x20','CHARGEBACK','setUTCDate','paidOutUSDT','publicKey','delete','\x20USDT\x20(+','commissionUSDT','getMonth','network','getAllPayouts','create','sendPayoutNotification','\x20with\x20payout\x20history',',\x20refunds:\x20','entries','pendingUrl','findMany','ðŸ”„\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','deletePayout','__esModule','\x20payments)','ðŸ”\x20No\x20wallet\x20provided,\x20looking\x20up\x20from\x20shop\x20settings...','custom','values','\x20\x20\x20Final\x20payout\x20amount\x20used:\x20','custom_','%\x20from\x20','30bOBHvF','7lscOjZ','\x20\x20\x20ðŸŒ\x20Country:\x20','\x27\x20->\x20name\x20\x27','revenue','polygon','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','ðŸ“Š\x20Merchant\x20statistics\x20calculated:','ðŸ”„\x20Gateway\x20mapping\x20(get):','ceil','\x20\x20\x20Current\x20balance:\x20','\x20\x20\x20Merchant\x20loses:\x20','\x20for\x20shop\x20','Telegram\x20username\x20already\x20exists','\x20\x20\x20Available\x20(raw):\x20','ðŸ’¸\x20CHARGEBACK\x20penalty\x20ONLY:\x20-','\x20\x20\x20Difference:\x20','all','\x20\x20\x20ðŸ’µ\x20Available\x20balance:\x20','stringify','getDay','usdtPolygonWallet','ðŸŽ¯\x20updateUser\x20called\x20with\x20ID:\x20','year','customerEmail','deleteUser','dateTo','groupBy','Rapyd','usdtErcWallet','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','payouts','failureMessage','join','updatePaymentStatus','hex','8511438pNtWTg','\x20status:\x20','split','\x20to\x20','asc','getUTCDate','UTC','trc20','âœ…\x20Balance\x20check\x20passed\x20(with\x20tolerance)','getGatewayDisplayName','ðŸ“Š\x20Sorting\x20payments\x20by\x20','ru-RU','payout','ðŸ’¸\x20CHARGEBACK:\x20Processing\x20penalty-only\x20deduction','paymentGateways','ðŸ”\x20Using\x20gateway\x20\x27','parse','payment','lte','toLocaleDateString','ðŸ’³\x20Final\x20payout\x20wallet\x20for\x20','yesterday','\x20USDT','customerIp','totalPaidOut','customerUa','period','random','518nXOzNS','\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)','sort','thisMonth','\x20\x20\x20Available\x20(number):\x20','âŒ\x20Failed\x20to\x20send\x20Telegram\x20notification\x20for\x20payout\x20','username','ðŸ“Š\x20Final\x20WHERE\x20conditions:','setHours','ðŸ“…\x20Date\x20from\x20filter:\x20','\x20\x20\x20Requested\x20(number):\x20','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','\x20USDT\x20(-','wallets','periodTo','gateway','insensitive','amount','wallet','ðŸ“Š\x20Available\x20gateways\x20in\x20database:','turnover','1581283ulCYKK','getPayoutStats','toLowerCase','ðŸ“…\x20Period:\x20','notes','paidAt','âš ï¸\x20Payment\x20','localeCompare','klyme_gb','periodFrom','externalPaymentUrl','\x20USDT\x20(theoretical\x20net)','\x20USDT\x20(gross\x20revenue)','\x20\x20\x20Added\x20to\x20balance:\x20+','NONEXISTENT_GATEWAY_FILTER','week','\x20\x20\x20Merchant\x20gets:\x20','\x20\x20\x20ðŸ’¸\x20Total\x20payouts:\x20','MasterCard','getGatewayInternalName','defineProperty','ðŸ”\x20Selected\x20polygon\x20wallet:\x20','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','desc','admin','getAllPayments','\x20\x20\x20ðŸ‘¤\x20Merchant\x20earnings:\x20','\x20\x20\x20Tolerance:\x20','ðŸ”\x20[','160nsDwwO','default','âš ï¸\x20CHARGEBACK\x20without\x20penalty\x20amount\x20-\x20no\x20balance\x20change','ðŸ“Š\x20Gateway\x20filter\x20applied:','ðŸ”„\x20Admin\x20updating\x20payment\x20','\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...','all_time','month','klyme_de','_sum','gatewaySettings','dateFrom','\x20USDT\x20for\x20payment\x20','test_gateway','\x20USDT\x20(current\x20balance\x20in\x20DB)','ðŸ’°\x20Current\x20shop\x20balance:\x20','currency','ðŸ”\x20Selected\x20erc20\x20wallet:\x20','\x20\x20\x20ðŸ’°\x20Total\x20payments\x20turnover:\x20','rapyd','./telegramBotService','KLYME\x20DE','\x20\x20\x20Gateway:\x20','âœ…\x20Customer\x20data\x20updated\x20for\x20payment\x20','KLYME\x20EU','cointopay2','\x20\x20\x20ðŸ“…\x20Total\x20payouts\x20(this\x20month):\x20','\x27\x20(from\x20\x27','COMPLETED','\x20paid\x20payments\x20for\x20analysis',',\x20userId:\x20','turnoverUSDT','activateUser','ðŸ“Š\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','telegramId','ðŸ“Š\x20Calculated\x20commission\x20rate\x20for\x20payment\x20','\x20\x20\x20Transaction\x20hash:\x20','getAllUsers','findUnique','getSystemStatistics','toFixed','usdcErcWallet','PENDING','customerName','ðŸ”\x20Balance\x20check\x20details:','\x20\x20\x20ï¿½\x20Total\x20payments\x20turnover:\x20','\x20merchants\x20for\x20selection','availableBalance',',\x20successful:\x20','map','\x20became\x20PAID:','_count','statusChangedAt','date','\x20\x20\x20Balance:\x20','EXPIRED','bcryptjs','âœ…\x20Using\x20gateway\x20filter:\x20\x27','\x20USDT)','awaitingPayout','\x20PAID\x20payments','ðŸ”„\x20Updating\x20customer\x20data\x20for\x20payment\x20','ðŸ’°\x20Found\x20','\x20USDT\x20(','chargebackAmount','\x20USDT,\x20Difference:\x20','pendingPayout','gte','Payment\x20not\x20found','\x20merchants','getUTCMonth','ðŸ”\x20Shop\x20wallets:','plisio','\x20USDT\x20(already\x20paid\x20out)','shopUrl','fullName','\x20\x20\x20Payout\x20amount:\x20','totalAmountUSDT','ðŸ”\x20Selected\x20erc20_usdc\x20wallet:\x20','today','ðŸ’°\x20Creating\x20payout\x20for\x20shop\x20','\x20merchants\x20with\x20rounded\x20balance\x20!=\x200.00\x20(excluding\x20balances\x20that\x20round\x20to\x200.00)','cointopay','\x20\x20\x20Full\x20amount:\x20','createdAt','\x20USDT\x20from\x20balance','ðŸ“Š\x20Payout\x20statistics\x20calculated:','toUpperCase',',\x20Commission:\x20','aggregate','Open\x20Banking\x202','getMerchantStatistics','\x27\x20not\x20found.\x20Available\x20gateways:\x20','merchantEarningsUSDT','26982HXUlnh','randomBytes','hash','telegramBotService','floor','getTime','setDate','totalCommissionRate','startsWith','gatewayOrderId','not\x20provided','averageCheckUSDT','totalPayments','Username\x20already\x20exists','erc20','commission','Shop\x20not\x20found','$transaction','0000','\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)','\x20balance\x20updated:','getMerchantsAwaitingPayout','forEach','ðŸ”„\x20Converted\x20gateway\x20name\x20\x27','AdminService','customerCountry','ðŸ“…\x20Payout\x20date\x20from\x20filter:\x20','ðŸ“Š\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','ðŸ’°\x20Shop\x20','CoinToPay','updateCustomerData','noda','password','gatewayCommissionRate','name','Noda','round','updatedAt','adminNotes','dailyRevenue','gatewayEarnings','getUserById','telegram','usdcPolygonWallet','shopId','PAID','3608298JuSzXI','last_month','\x20balance\x20updated:\x20','amountAfterGatewayCommissionUSDT','generateDailyStatistics','\x20USDT\x20(rounded\x20to\x202\x20decimal\x20places)','gateways',']\x20Updating\x20password\x20for\x20user\x20','ðŸŽ¯\x20[','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','mastercard','txid',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','getDate','amountUSDT','totalPayout','dailyPayments','length','SUSPENDED','toISOString','not\x20specified','balance','ÐÐµ\x20ÑƒÐºÐ°Ð·Ð°Ð½','filter','replace','getPaymentById','update','ðŸ“Š\x20Using\x20saved\x20values\x20for\x20payment\x20','getFullYear','log','âš ï¸\x20Requested\x20gateway\x20\x27','set','\x20order','ðŸ’°\x20[PAYOUT]\x20Merchant\x20','REFUND','reduce','usdtTrcWallet','get','ðŸ’±\x20Currency\x20filter\x20applied:\x20','ðŸ“Š\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20','\x20->\x20','averageCommissionRate','some','toString','%\x20commission)','getMerchantsSelection','\x20\x20\x20ðŸ’¸\x20Total\x20payouts\x20(all\x20time):\x20','ðŸ”\x20Initial\x20wallet\x20from\x20request:\x20','\x20USDT,\x20merchant:\x20',']\x20Gateway\x20settings\x20JSON\x20string:','successUrl','\x20\x20\x20ðŸ–¥ï¸\x20User\x20Agent:\x20','totalAmountAfterCommissionUSDT','\x20\x20\x20ðŸŒ\x20IP:\x20','orderId','merchantEarnings','count','push','substr','totalTurnover','error','\x27\x20to\x20name\x20\x27','\x27\x20->\x20ID\x20\x27','getGatewayIdByName','last_week','ðŸ“Š\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','sk_','Error\x20processing\x20payment\x20',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','this_month','4322235SjOiFF','currencyService','âœ…\x20Payout\x20created:\x20','ðŸ“Š\x20Merchants\x20with\x20rounded\x20balance\x20!=\x200.00:\x20','ACTIVE','\x20\x20\x20ðŸª\x20Gateway\x20earnings:\x20','shop','âš ï¸\x20Gateway\x20\x27','1303JUwpMu','convertToUSDT','ðŸ”„\x20Converted\x20gateway\x20ID\x20\x27','statusChangedBy','includes','getUTCFullYear'];a46_0xf4c9=function(){return _0x53345c;};return a46_0xf4c9();}const a46_0x55b484=a46_0x296d;(function(_0x2641d7,_0x39e5c5){const _0x2e6b54=a46_0x296d,_0x31acf2=_0x2641d7();while(!![]){try{const _0x5153a3=-parseInt(_0x2e6b54(0x193))/0x1*(-parseInt(_0x2e6b54(0x1fe))/0x2)+-parseInt(_0x2e6b54(0x117))/0x3*(-parseInt(_0x2e6b54(0x230))/0x4)+-parseInt(_0x2e6b54(0x18b))/0x5+parseInt(_0x2e6b54(0x1e2))/0x6*(parseInt(_0x2e6b54(0x1bf))/0x7)+parseInt(_0x2e6b54(0x19f))/0x8+parseInt(_0x2e6b54(0x145))/0x9*(-parseInt(_0x2e6b54(0x1be))/0xa)+parseInt(_0x2e6b54(0x213))/0xb;if(_0x5153a3===_0x39e5c5)break;else _0x31acf2['push'](_0x31acf2['shift']());}catch(_0x36f508){_0x31acf2['push'](_0x31acf2['shift']());}}}(a46_0xf4c9,0xbb739));function a46_0x296d(_0x55d264,_0x4c9469){_0x55d264=_0x55d264-0x117;const _0xf4c969=a46_0xf4c9();let _0x296d75=_0xf4c969[_0x55d264];return _0x296d75;}var __importDefault=this&&this['__importDefault']||function(_0x15db35){return _0x15db35&&_0x15db35['__esModule']?_0x15db35:{'default':_0x15db35};};Object[a46_0x55b484(0x227)](exports,a46_0x55b484(0x1b6),{'value':!![]}),exports[a46_0x55b484(0x12f)]=void 0x0;const database_1=__importDefault(require('../config/database')),bcryptjs_1=__importDefault(require(a46_0x55b484(0x268))),crypto_1=__importDefault(require('crypto')),currencyService_1=require('./currencyService'),telegramBotService_1=require(a46_0x55b484(0x244)),gateway_1=require('../types/gateway');class AdminService{async[a46_0x55b484(0x214)](){const _0x1533c0=a46_0x55b484;console[_0x1533c0(0x162)](_0x1533c0(0x199));const _0x4ee5f2=await database_1[_0x1533c0(0x231)][_0x1533c0(0x191)][_0x1533c0(0x289)]({'_sum':{'balance':!![],'totalPaidOut':!![]}}),_0x46032f=await database_1[_0x1533c0(0x231)]['payment'][_0x1533c0(0x17d)]({'where':{'status':'PAID','gateway':{'not':'test_gateway'}}}),_0x3b8784=new Date(),_0x555151=new Date(_0x3b8784[_0x1533c0(0x161)](),_0x3b8784[_0x1533c0(0x1aa)](),0x1),_0x40f2a9=new Date(_0x3b8784['getFullYear'](),_0x3b8784[_0x1533c0(0x1aa)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0xfc0f5a=await database_1[_0x1533c0(0x231)][_0x1533c0(0x1ee)][_0x1533c0(0x289)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x555151,'lte':_0x40f2a9},'status':_0x1533c0(0x24c)}}),_0xfacbb1=_0x4ee5f2[_0x1533c0(0x239)][_0x1533c0(0x1fa)]||0x0,_0x41db88=_0x4ee5f2[_0x1533c0(0x239)][_0x1533c0(0x15a)]||0x0,_0x27629f=_0xfc0f5a[_0x1533c0(0x239)][_0x1533c0(0x20f)]||0x0,_0x39cfc2={'totalPayout':Math[_0x1533c0(0x13b)](_0xfacbb1*0x64)/0x64,'awaitingPayout':Math[_0x1533c0(0x13b)](_0x41db88*0x64)/0x64,'thisMonth':Math[_0x1533c0(0x13b)](_0x27629f*0x64)/0x64,'availableBalance':Math[_0x1533c0(0x13b)](_0x41db88*0x64)/0x64,'totalPayments':_0x46032f};return console[_0x1533c0(0x162)](_0x1533c0(0x286)),console[_0x1533c0(0x162)]('\x20\x20\x20ðŸ’°\x20Total\x20payout:\x20'+_0x39cfc2[_0x1533c0(0x154)]+'\x20USDT\x20(total\x20paid\x20to\x20merchants)'),console[_0x1533c0(0x162)]('\x20\x20\x20â³\x20Awaiting\x20payout:\x20'+_0x39cfc2[_0x1533c0(0x26b)]+_0x1533c0(0x1ff)),console[_0x1533c0(0x162)](_0x1533c0(0x1d0)+_0x39cfc2[_0x1533c0(0x25f)]+'\x20USDT\x20(same\x20as\x20awaiting)'),console[_0x1533c0(0x162)]('\x20\x20\x20ðŸ“…\x20This\x20month:\x20'+_0x39cfc2['thisMonth']+_0x1533c0(0x1f8)),console[_0x1533c0(0x162)]('\x20\x20\x20ðŸ’³\x20Total\x20payments:\x20'+_0x39cfc2[_0x1533c0(0x123)]+_0x1533c0(0x26c)),_0x39cfc2;}async[a46_0x55b484(0x135)](_0x2b2ce3,_0x2e913b){const _0x19f958=a46_0x55b484;console[_0x19f958(0x162)](_0x19f958(0x26d)+_0x2b2ce3+':',_0x2e913b);const _0x327185=await database_1[_0x19f958(0x231)][_0x19f958(0x1f3)][_0x19f958(0x256)]({'where':{'id':_0x2b2ce3},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x327185)throw new Error('Payment\x20not\x20found');const _0x37a26b={};_0x2e913b[_0x19f958(0x130)]!==undefined&&(_0x37a26b[_0x19f958(0x130)]=_0x2e913b[_0x19f958(0x130)]||null);_0x2e913b[_0x19f958(0x1f9)]!==undefined&&(_0x37a26b['customerIp']=_0x2e913b[_0x19f958(0x1f9)]||null);_0x2e913b[_0x19f958(0x1fb)]!==undefined&&(_0x37a26b[_0x19f958(0x1fb)]=_0x2e913b['customerUa']||null);const _0x202e45=await database_1[_0x19f958(0x231)][_0x19f958(0x1f3)][_0x19f958(0x15f)]({'where':{'id':_0x2b2ce3},'data':{..._0x37a26b,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x19f958(0x162)](_0x19f958(0x247)+_0x2b2ce3),console[_0x19f958(0x162)](_0x19f958(0x1c0)+_0x327185['customerCountry']+'\x20->\x20'+_0x202e45[_0x19f958(0x130)]),console[_0x19f958(0x162)](_0x19f958(0x17a)+_0x327185[_0x19f958(0x1f9)]+_0x19f958(0x16d)+_0x202e45[_0x19f958(0x1f9)]),console[_0x19f958(0x162)](_0x19f958(0x178)+(_0x327185[_0x19f958(0x1fb)]?_0x19f958(0x164):'not\x20set')+_0x19f958(0x16d)+(_0x202e45[_0x19f958(0x1fb)]?'set':'not\x20set')),_0x202e45;}async[a46_0x55b484(0x257)](_0x1ebec0,_0x3347b2){const _0x55f8af=a46_0x55b484,_0x19a7d7=_0x3347b2?new Date(_0x3347b2):new Date();let _0x138f4f,_0x33268a;if(_0x1ebec0[_0x55f8af(0x11f)](_0x55f8af(0x1bc))){const _0x20645d=_0x1ebec0[_0x55f8af(0x15d)](_0x55f8af(0x1bc),'')[_0x55f8af(0x1e4)]('_');_0x20645d[_0x55f8af(0x156)]===0x2?(_0x138f4f=new Date(_0x20645d[0x0]),_0x138f4f['setHours'](0x0,0x0,0x0,0x0),_0x33268a=new Date(_0x20645d[0x1]),_0x33268a[_0x55f8af(0x206)](0x17,0x3b,0x3b,0x3e7)):(_0x138f4f=new Date(_0x19a7d7[_0x55f8af(0x11c)]()-0x1e*0x18*0x3c*0x3c*0x3e8),_0x138f4f[_0x55f8af(0x206)](0x0,0x0,0x0,0x0),_0x33268a=new Date(),_0x33268a['setHours'](0x17,0x3b,0x3b,0x3e7));}else switch(_0x1ebec0[_0x55f8af(0x215)]()){case _0x55f8af(0x27f):_0x138f4f=new Date(Date[_0x55f8af(0x1e8)](_0x19a7d7['getUTCFullYear'](),_0x19a7d7[_0x55f8af(0x276)](),_0x19a7d7['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x33268a=new Date(Date['UTC'](_0x19a7d7[_0x55f8af(0x198)](),_0x19a7d7[_0x55f8af(0x276)](),_0x19a7d7['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case _0x55f8af(0x1f7):const _0x52424d=new Date(_0x19a7d7);_0x52424d[_0x55f8af(0x1a4)](_0x52424d[_0x55f8af(0x1e7)]()-0x1),_0x138f4f=new Date(Date[_0x55f8af(0x1e8)](_0x52424d[_0x55f8af(0x198)](),_0x52424d[_0x55f8af(0x276)](),_0x52424d['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x33268a=new Date(Date[_0x55f8af(0x1e8)](_0x52424d[_0x55f8af(0x198)](),_0x52424d['getUTCMonth'](),_0x52424d[_0x55f8af(0x1e7)](),0x17,0x3b,0x3b,0x3e7));break;case'this_week':const _0x5bbac8=_0x19a7d7[_0x55f8af(0x1d2)](),_0x22dccd=_0x5bbac8===0x0?-0x6:0x1-_0x5bbac8;_0x138f4f=new Date(_0x19a7d7),_0x138f4f[_0x55f8af(0x11d)](_0x19a7d7[_0x55f8af(0x152)]()+_0x22dccd),_0x138f4f[_0x55f8af(0x206)](0x0,0x0,0x0,0x0),_0x33268a=new Date(_0x19a7d7[_0x55f8af(0x161)](),_0x19a7d7[_0x55f8af(0x1aa)](),_0x19a7d7[_0x55f8af(0x152)](),0x17,0x3b,0x3b,0x3e7);break;case _0x55f8af(0x185):const _0x327b85=new Date(_0x19a7d7);_0x327b85[_0x55f8af(0x11d)](_0x19a7d7['getDate']()-0x7);const _0x1ae009=_0x327b85[_0x55f8af(0x1d2)](),_0x4ddb69=_0x1ae009===0x0?-0x6:0x1-_0x1ae009;_0x138f4f=new Date(_0x327b85),_0x138f4f[_0x55f8af(0x11d)](_0x327b85['getDate']()+_0x4ddb69),_0x138f4f['setHours'](0x0,0x0,0x0,0x0),_0x33268a=new Date(_0x138f4f),_0x33268a[_0x55f8af(0x11d)](_0x138f4f[_0x55f8af(0x152)]()+0x6),_0x33268a[_0x55f8af(0x206)](0x17,0x3b,0x3b,0x3e7);break;case _0x55f8af(0x18a):_0x138f4f=new Date(Date[_0x55f8af(0x1e8)](_0x19a7d7[_0x55f8af(0x198)](),_0x19a7d7[_0x55f8af(0x276)](),0x1,0x0,0x0,0x0,0x0)),_0x33268a=new Date(Date[_0x55f8af(0x1e8)](_0x19a7d7['getUTCFullYear'](),_0x19a7d7[_0x55f8af(0x276)](),_0x19a7d7['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case _0x55f8af(0x146):_0x138f4f=new Date(Date['UTC'](_0x19a7d7['getUTCFullYear'](),_0x19a7d7['getUTCMonth']()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x33268a=new Date(Date[_0x55f8af(0x1e8)](_0x19a7d7[_0x55f8af(0x198)](),_0x19a7d7['getUTCMonth'](),0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x55f8af(0x236):_0x138f4f=new Date(Date[_0x55f8af(0x1e8)](0x7e9,0x5,0xe,0x0,0x0,0x0,0x0)),_0x33268a=new Date(Date[_0x55f8af(0x1e8)](_0x19a7d7[_0x55f8af(0x198)](),_0x19a7d7['getUTCMonth'](),_0x19a7d7['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;default:_0x138f4f=new Date(_0x19a7d7['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8),_0x138f4f[_0x55f8af(0x206)](0x0,0x0,0x0,0x0),_0x33268a=new Date(_0x19a7d7['getFullYear'](),_0x19a7d7['getMonth'](),_0x19a7d7[_0x55f8af(0x152)](),0x17,0x3b,0x3b,0x3e7);}const _0x114424={'gte':_0x138f4f,'lte':_0x33268a},[_0x2498ee,_0x5630b0,_0x17cbec,_0x45b585,_0x4d341a,_0xa11271,_0x3ee84f,_0x4bd80a]=await Promise['all']([database_1[_0x55f8af(0x231)][_0x55f8af(0x191)][_0x55f8af(0x17d)](),database_1[_0x55f8af(0x231)][_0x55f8af(0x191)][_0x55f8af(0x17d)]({'where':{'status':'ACTIVE'}}),database_1[_0x55f8af(0x231)][_0x55f8af(0x1f3)][_0x55f8af(0x17d)]({'where':{'status':_0x55f8af(0x144),'createdAt':_0x114424,'gateway':{'not':_0x55f8af(0x23d)}}}),database_1[_0x55f8af(0x231)][_0x55f8af(0x1f3)]['count']({'where':{'status':_0x55f8af(0x1a3),'createdAt':_0x114424,'gateway':{'not':_0x55f8af(0x23d)}}}),database_1[_0x55f8af(0x231)]['payment'][_0x55f8af(0x17d)]({'where':{'status':'REFUND','createdAt':_0x114424,'gateway':{'not':'test_gateway'}}}),database_1[_0x55f8af(0x231)]['payment']['findMany']({'where':{'status':_0x55f8af(0x144),'createdAt':_0x114424,'gateway':{'not':_0x55f8af(0x23d)}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x55f8af(0x231)]['payment']['findMany']({'where':{'gateway':{'not':'test_gateway'}},'take':0xa,'orderBy':{'createdAt':_0x55f8af(0x22a)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x55f8af(0x1f3)][_0x55f8af(0x1b3)]({'where':{'createdAt':_0x114424,'gateway':{'not':_0x55f8af(0x23d)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x590538=0x0,_0xb8f879=0x0;for(const _0x48742e of _0xa11271){const _0x4ab3f8=_0x48742e[_0x55f8af(0x153)]||0x0;_0x590538+=_0x4ab3f8;if(_0x48742e[_0x55f8af(0x148)]&&_0x48742e[_0x55f8af(0x153)]){const _0x1ee456=_0x48742e['amountUSDT']-_0x48742e[_0x55f8af(0x148)];_0xb8f879+=_0x1ee456;}}const _0x2c6f66=_0x17cbec>0x0?_0x590538/_0x17cbec:0x0,_0x299e35=this['generateDailyStatistics'](_0x4bd80a,_0x138f4f,_0x33268a),_0x4cf78a=await database_1[_0x55f8af(0x231)][_0x55f8af(0x1f3)]['count']({'where':{'createdAt':_0x114424,'gateway':{'not':_0x55f8af(0x23d)},'status':{'notIn':[_0x55f8af(0x25a),_0x55f8af(0x267)]}}}),_0x270080=_0x4cf78a>0x0?_0x17cbec/_0x4cf78a*0x64:0x0;return{'totalShops':_0x2498ee,'activeShops':_0x5630b0,'totalPayments':_0x4cf78a,'successfulPayments':_0x17cbec,'totalAttempts':_0x4cf78a,'chargebacks':_0x45b585,'refunds':_0x4d341a,'totalRevenue':Math[_0x55f8af(0x13b)](_0x590538*0x64)/0x64,'trapayEarnings':Math[_0x55f8af(0x13b)](_0xb8f879*0x64)/0x64,'averagePaymentAmount':Math['round'](_0x2c6f66*0x64)/0x64,'conversionRate':Math[_0x55f8af(0x13b)](_0x270080*0x64)/0x64,'dailyRevenue':_0x299e35[_0x55f8af(0x13e)],'dailyPayments':_0x299e35[_0x55f8af(0x155)],'recentPayments':_0x3ee84f[_0x55f8af(0x261)](_0x1f0354=>({'id':_0x1f0354['id'],'amount':_0x1f0354[_0x55f8af(0x20f)],'currency':_0x1f0354[_0x55f8af(0x240)],'status':_0x1f0354[_0x55f8af(0x19e)],'gateway':_0x1f0354[_0x55f8af(0x20d)],'shop':_0x1f0354[_0x55f8af(0x191)],'createdAt':_0x1f0354[_0x55f8af(0x284)]}))};}async[a46_0x55b484(0x28b)](_0x4ab8b1){const _0x378748=a46_0x55b484;console[_0x378748(0x162)]('ðŸ“Š\x20Getting\x20merchant\x20statistics\x20with\x20filters:',_0x4ab8b1);let _0x3c0aae,_0x1e20cb=new Date();if(_0x4ab8b1[_0x378748(0x1fc)]===_0x378748(0x1b9)&&_0x4ab8b1[_0x378748(0x23b)]&&_0x4ab8b1[_0x378748(0x1d8)])_0x3c0aae=new Date(_0x4ab8b1[_0x378748(0x23b)]),_0x1e20cb=new Date(_0x4ab8b1['dateTo']),_0x3c0aae[_0x378748(0x206)](0x0,0x0,0x0,0x0),_0x1e20cb[_0x378748(0x206)](0x17,0x3b,0x3b,0x3e7);else{const _0x418780=new Date();switch(_0x4ab8b1[_0x378748(0x1fc)]){case _0x378748(0x222):_0x3c0aae=new Date(_0x418780['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x378748(0x237):_0x3c0aae=new Date(_0x418780[_0x378748(0x11c)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x378748(0x1d5):_0x3c0aae=new Date(_0x418780['getTime']()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x378748(0x1cf):default:_0x3c0aae=new Date('2020-01-01');break;}_0x3c0aae[_0x378748(0x206)](0x0,0x0,0x0,0x0),_0x1e20cb[_0x378748(0x206)](0x17,0x3b,0x3b,0x3e7);}console[_0x378748(0x162)](_0x378748(0x216)+_0x3c0aae[_0x378748(0x158)]()+_0x378748(0x1e5)+_0x1e20cb['toISOString']());const _0xc21cc0={'status':'PAID','gateway':{'not':_0x378748(0x23d)},'paidAt':{'gte':_0x3c0aae,'lte':_0x1e20cb}};_0x4ab8b1[_0x378748(0x143)]&&(_0xc21cc0['shopId']=_0x4ab8b1[_0x378748(0x143)]);const _0x4df556=await database_1[_0x378748(0x231)][_0x378748(0x1f3)][_0x378748(0x1b3)]({'where':_0xc21cc0,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x378748(0x162)](_0x378748(0x26e)+_0x4df556['length']+_0x378748(0x24d));const _0x1d7b34={'gateway':{'not':_0x378748(0x23d)},'status':{'notIn':[_0x378748(0x25a),_0x378748(0x267)]},'createdAt':{'gte':_0x3c0aae,'lte':_0x1e20cb}};_0x4ab8b1['shopId']&&(_0x1d7b34['shopId']=_0x4ab8b1['shopId']);const _0x2d6278=await database_1[_0x378748(0x231)][_0x378748(0x1f3)][_0x378748(0x17d)]({'where':_0x1d7b34}),_0x2dfe37={..._0x1d7b34,'status':_0x378748(0x1a3)},_0x41ac82={..._0x1d7b34,'status':'REFUND'},[_0x2948f4,_0x55434e]=await Promise['all']([database_1[_0x378748(0x231)][_0x378748(0x1f3)][_0x378748(0x17d)]({'where':_0x2dfe37}),database_1[_0x378748(0x231)][_0x378748(0x1f3)]['count']({'where':_0x41ac82})]);console[_0x378748(0x162)](_0x378748(0x1a2)+_0x2d6278+_0x378748(0x260)+_0x4df556['length']+',\x20chargebacks:\x20'+_0x2948f4+_0x378748(0x1b0)+_0x55434e);let _0x492342=0x0,_0x194c5a=0x0,_0x5df54d=0x0;const _0x3628f5={},_0x3b2f6a={},_0x32182c={};for(const _0x4d7393 of _0x4df556){try{const _0x5d7ff3=_0x4d7393[_0x378748(0x153)]||0x0;if(_0x5d7ff3<=0x0){console['warn']('âš ï¸\x20Payment\x20'+_0x4d7393['id']+_0x378748(0x235));continue;}let _0x1ff98e,_0x312332;if(_0x4d7393[_0x378748(0x148)]!==null&&_0x4d7393[_0x378748(0x148)]!==undefined)_0x1ff98e=_0x4d7393['amountAfterGatewayCommissionUSDT'],_0x312332=_0x5d7ff3-_0x1ff98e,console[_0x378748(0x162)](_0x378748(0x160)+_0x4d7393['id']+':\x20'+_0x5d7ff3[_0x378748(0x258)](0x6)+_0x378748(0x175)+_0x1ff98e[_0x378748(0x258)](0x6)+'\x20USDT');else{let _0x1b5440={};if(_0x4d7393[_0x378748(0x191)][_0x378748(0x23a)])try{_0x1b5440=JSON['parse'](_0x4d7393[_0x378748(0x191)][_0x378748(0x23a)]);}catch(_0x5e7b89){console[_0x378748(0x181)](_0x378748(0x14e)+_0x4d7393[_0x378748(0x143)]+':',_0x5e7b89);}let _0x181bc1=0x2d;for(const [_0x461e9f,_0xf1c18a]of Object[_0x378748(0x1b1)](_0x1b5440)){if(_0x461e9f['toLowerCase']()===_0x4d7393[_0x378748(0x20d)][_0x378748(0x215)]()){_0x181bc1=_0xf1c18a[_0x378748(0x126)]||0x2d;break;}}_0x312332=_0x5d7ff3*(_0x181bc1/0x64),_0x1ff98e=_0x5d7ff3-_0x312332,console[_0x378748(0x162)]('ðŸ“Š\x20Calculating\x20commission\x20manually\x20for\x20payment\x20'+_0x4d7393['id']+':\x20'+_0x181bc1+_0x378748(0x1bd)+_0x5d7ff3['toFixed'](0x6)+'\x20USDT');}_0x492342+=_0x5d7ff3,_0x194c5a+=_0x1ff98e,_0x5df54d+=_0x312332;let _0xfe1269;_0x4d7393[_0x378748(0x138)]!==null&&_0x4d7393[_0x378748(0x138)]!==undefined?(_0xfe1269=_0x4d7393[_0x378748(0x138)],console['log'](_0x378748(0x16c)+_0x4d7393['id']+':\x20'+_0xfe1269+'%')):(_0xfe1269=_0x5d7ff3>0x0?_0x312332/_0x5d7ff3*0x64:0x0,console['log'](_0x378748(0x253)+_0x4d7393['id']+':\x20'+_0xfe1269[_0x378748(0x258)](0x2)+'%'));!_0x3628f5[_0x4d7393['gateway']]&&(_0x3628f5[_0x4d7393[_0x378748(0x20d)]]={'gateway':_0x4d7393[_0x378748(0x20d)],'gatewayDisplayName':this[_0x378748(0x1eb)](_0x4d7393['gateway']),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x3628f5[_0x4d7393[_0x378748(0x20d)]]['paymentsCount']++,_0x3628f5[_0x4d7393['gateway']][_0x378748(0x24f)]+=_0x5d7ff3,_0x3628f5[_0x4d7393[_0x378748(0x20d)]][_0x378748(0x1a9)]+=_0x312332,_0x3628f5[_0x4d7393[_0x378748(0x20d)]][_0x378748(0x28d)]+=_0x1ff98e,_0x3628f5[_0x4d7393[_0x378748(0x20d)]]['totalCommissionRate']+=_0xfe1269;!_0x4ab8b1[_0x378748(0x143)]&&(!_0x3b2f6a[_0x4d7393[_0x378748(0x143)]]&&(_0x3b2f6a[_0x4d7393[_0x378748(0x143)]]={'shopId':_0x4d7393[_0x378748(0x143)],'shopName':_0x4d7393[_0x378748(0x191)][_0x378748(0x139)],'shopUsername':_0x4d7393['shop']['username'],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x3b2f6a[_0x4d7393[_0x378748(0x143)]]['paymentsCount']++,_0x3b2f6a[_0x4d7393[_0x378748(0x143)]][_0x378748(0x24f)]+=_0x5d7ff3,_0x3b2f6a[_0x4d7393['shopId']][_0x378748(0x1a9)]+=_0x312332,_0x3b2f6a[_0x4d7393[_0x378748(0x143)]][_0x378748(0x28d)]+=_0x1ff98e);const _0xd312d9=_0x4d7393[_0x378748(0x218)][_0x378748(0x158)]()[_0x378748(0x1e4)]('T')[0x0];!_0x32182c[_0xd312d9]&&(_0x32182c[_0xd312d9]={'date':_0xd312d9,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x32182c[_0xd312d9][_0x378748(0x212)]+=_0x5d7ff3,_0x32182c[_0xd312d9][_0x378748(0x17c)]+=_0x1ff98e,_0x32182c[_0xd312d9][_0x378748(0x13f)]+=_0x312332,_0x32182c[_0xd312d9]['paymentsCount']++;}catch(_0x310639){console[_0x378748(0x181)](_0x378748(0x188)+_0x4d7393['id']+':',_0x310639);}}Object['values'](_0x3628f5)[_0x378748(0x12d)](_0x3d0f4a=>{const _0x15bc72=_0x378748;_0x3d0f4a[_0x15bc72(0x16e)]=_0x3d0f4a[_0x15bc72(0x1a1)]>0x0?_0x3d0f4a[_0x15bc72(0x11e)]/_0x3d0f4a[_0x15bc72(0x1a1)]:0x0,delete _0x3d0f4a['totalCommissionRate'];}),Object[_0x378748(0x1ba)](_0x3b2f6a)[_0x378748(0x12d)](_0x4a15d9=>{const _0x394d82=_0x378748;_0x4a15d9['averageCheckUSDT']=_0x4a15d9['paymentsCount']>0x0?_0x4a15d9[_0x394d82(0x24f)]/_0x4a15d9[_0x394d82(0x1a1)]:0x0;});let _0x4827b3=0x0,_0x152ef2=0x0;if(_0x4ab8b1['shopId']){const _0xc47af3=await database_1['default'][_0x378748(0x1ee)][_0x378748(0x1b3)]({'where':{'shopId':_0x4ab8b1['shopId'],'status':_0x378748(0x24c),'createdAt':{'gte':_0x3c0aae,'lte':_0x1e20cb}},'select':{'amount':!![]}});_0x4827b3=_0xc47af3['reduce']((_0x109211,_0x6bcc1c)=>_0x109211+_0x6bcc1c['amount'],0x0);const _0x588521=await database_1[_0x378748(0x231)][_0x378748(0x1ee)][_0x378748(0x1b3)]({'where':{'shopId':_0x4ab8b1[_0x378748(0x143)],'status':_0x378748(0x25a),'createdAt':{'gte':_0x3c0aae,'lte':_0x1e20cb}},'select':{'amount':!![]}});_0x152ef2=_0x588521[_0x378748(0x168)]((_0x198895,_0x185e2f)=>_0x198895+_0x185e2f[_0x378748(0x20f)],0x0);}const _0x557d66=_0x2d6278,_0x7398cc=_0x4df556[_0x378748(0x156)],_0x874a52=_0x7398cc>0x0?_0x492342/_0x7398cc:0x0,_0x5bee47=_0x557d66>0x0?Math['round'](_0x7398cc/_0x557d66*0x2710)/0x64:0x0,_0xe47b20=Math['ceil']((_0x1e20cb[_0x378748(0x11c)]()-_0x3c0aae[_0x378748(0x11c)]())/(0x3e8*0x3c*0x3c*0x18)),_0x5b71b7={'totalTurnover':Math[_0x378748(0x13b)](_0x492342*0x64)/0x64,'merchantEarnings':Math[_0x378748(0x13b)](_0x194c5a*0x64)/0x64,'gatewayEarnings':Math[_0x378748(0x13b)](_0x5df54d*0x64)/0x64,'totalPaidOut':Math[_0x378748(0x13b)](_0x4827b3*0x64)/0x64,'pendingPayout':Math[_0x378748(0x13b)](_0x152ef2*0x64)/0x64,'averageCheck':Math['round'](_0x874a52*0x64)/0x64,'totalPayments':_0x557d66,'successfulPayments':_0x7398cc,'conversionRate':_0x5bee47,'chargebacks':_0x2948f4,'refunds':_0x55434e,'gatewayBreakdown':Object['values'](_0x3628f5)[_0x378748(0x261)](_0x24166e=>({..._0x24166e,'turnoverUSDT':Math[_0x378748(0x13b)](_0x24166e[_0x378748(0x24f)]*0x64)/0x64,'commissionUSDT':Math[_0x378748(0x13b)](_0x24166e[_0x378748(0x1a9)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x24166e[_0x378748(0x28d)]*0x64)/0x64,'averageCommissionRate':Math[_0x378748(0x13b)](_0x24166e[_0x378748(0x16e)]*0x64)/0x64})),'merchantBreakdown':_0x4ab8b1['shopId']?undefined:Object[_0x378748(0x1ba)](_0x3b2f6a)[_0x378748(0x261)](_0xbb1689=>({..._0xbb1689,'turnoverUSDT':Math[_0x378748(0x13b)](_0xbb1689[_0x378748(0x24f)]*0x64)/0x64,'commissionUSDT':Math[_0x378748(0x13b)](_0xbb1689[_0x378748(0x1a9)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x378748(0x13b)](_0xbb1689[_0x378748(0x28d)]*0x64)/0x64,'paidOutUSDT':Math[_0x378748(0x13b)](_0xbb1689[_0x378748(0x1a5)]*0x64)/0x64,'averageCheckUSDT':Math[_0x378748(0x13b)](_0xbb1689[_0x378748(0x122)]*0x64)/0x64})),'dailyData':Object[_0x378748(0x1ba)](_0x32182c)[_0x378748(0x261)](_0x72a552=>({..._0x72a552,'turnover':Math[_0x378748(0x13b)](_0x72a552[_0x378748(0x212)]*0x64)/0x64,'merchantEarnings':Math[_0x378748(0x13b)](_0x72a552['merchantEarnings']*0x64)/0x64,'gatewayEarnings':Math[_0x378748(0x13b)](_0x72a552[_0x378748(0x13f)]*0x64)/0x64}))[_0x378748(0x200)]((_0x57bcfb,_0x44e4f9)=>_0x57bcfb[_0x378748(0x265)][_0x378748(0x21a)](_0x44e4f9[_0x378748(0x265)])),'periodInfo':{'from':_0x3c0aae,'to':_0x1e20cb,'periodType':_0x4ab8b1[_0x378748(0x1fc)]||_0x378748(0x1b9),'daysCount':_0xe47b20}};return console[_0x378748(0x162)](_0x378748(0x1c5)),console[_0x378748(0x162)]('\x20\x20\x20ðŸ’°\x20Total\x20turnover:\x20'+_0x5b71b7[_0x378748(0x180)]+_0x378748(0x1f8)),console['log'](_0x378748(0x22d)+_0x5b71b7[_0x378748(0x17c)]+_0x378748(0x1f8)),console[_0x378748(0x162)](_0x378748(0x190)+_0x5b71b7[_0x378748(0x13f)]+_0x378748(0x1f8)),console[_0x378748(0x162)]('\x20\x20\x20ï¿½\x20Total\x20paid\x20out:\x20'+_0x5b71b7[_0x378748(0x1fa)]+_0x378748(0x1f8)),console[_0x378748(0x162)]('\x20\x20\x20â³\x20Pending\x20payout:\x20'+_0x5b71b7[_0x378748(0x272)]+'\x20USDT'),console['log']('\x20\x20\x20ï¿½ðŸ“Š\x20Total\x20payments:\x20'+_0x5b71b7[_0x378748(0x123)]),_0x5b71b7;}async[a46_0x55b484(0x172)](_0x4f0a2f){const _0x3c5edc=a46_0x55b484;console['log']('ðŸ“‹\x20Getting\x20merchants\x20selection\x20list...',{'hasPayoutHistory':_0x4f0a2f});let _0x52e51d={};_0x4f0a2f&&(_0x52e51d[_0x3c5edc(0x1dd)]={'some':{}});const _0x32f9de=await database_1[_0x3c5edc(0x231)][_0x3c5edc(0x191)][_0x3c5edc(0x1b3)]({'where':_0x52e51d,'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x3c5edc(0x1e6)}});return console[_0x3c5edc(0x162)]('ðŸ“‹\x20Found\x20'+_0x32f9de[_0x3c5edc(0x156)]+_0x3c5edc(0x25e)+(_0x4f0a2f?_0x3c5edc(0x1af):'')),_0x32f9de[_0x3c5edc(0x261)](_0x573851=>({'id':_0x573851['id'],'username':_0x573851[_0x3c5edc(0x204)],'name':_0x573851['name']}));}['getGatewayDisplayName'](_0x3c1f61){const _0x5bcade=a46_0x55b484,_0x20d19b={'test_gateway':'Test\x20Gateway','plisio':'Plisio','rapyd':_0x5bcade(0x1da),'noda':_0x5bcade(0x13a),'cointopay':_0x5bcade(0x134),'cointopay2':_0x5bcade(0x28a),'klyme_eu':_0x5bcade(0x248),'klyme_gb':'KLYME\x20GB','klyme_de':_0x5bcade(0x245),'mastercard':_0x5bcade(0x225)};return _0x20d19b[_0x3c1f61]||_0x3c1f61;}['getGatewayInternalName'](_0x1c5da4){const _0x16177b=a46_0x55b484,_0x7aac3e={'Test\x20Gateway':_0x16177b(0x23d),'Plisio':_0x16177b(0x278),'Rapyd':_0x16177b(0x243),'Noda':_0x16177b(0x136),'CoinToPay':_0x16177b(0x282),'CoinToPay2':_0x16177b(0x249),'KLYME\x20EU':'klyme_eu','KLYME\x20GB':_0x16177b(0x21b),'KLYME\x20DE':_0x16177b(0x238),'MasterCard':_0x16177b(0x14f)};return _0x7aac3e[_0x1c5da4]||_0x1c5da4[_0x16177b(0x215)]();}async[a46_0x55b484(0x12c)](_0x1ece86){const _0x198a62=a46_0x55b484,{page:_0x875711,limit:_0x44701f,minAmount:_0x490a51,search:_0x5ecc2f}=_0x1ece86;console[_0x198a62(0x162)](_0x198a62(0x132),_0x1ece86);let _0x20e810={};_0x5ecc2f&&(_0x20e810[_0x198a62(0x139)]={'contains':_0x5ecc2f,'mode':_0x198a62(0x20e)});const _0x8dfde=await database_1[_0x198a62(0x231)][_0x198a62(0x191)]['findMany']({'where':_0x20e810,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),_0xa813c6=_0x8dfde[_0x198a62(0x15c)](_0x513be6=>{const _0x236d51=_0x198a62,_0x4e6393=Math[_0x236d51(0x11b)](_0x513be6[_0x236d51(0x15a)]*0x64)/0x64;if(_0x490a51&&_0x4e6393<_0x490a51)return![];return _0x4e6393!==0x0;});_0xa813c6['sort']((_0x16a851,_0x120789)=>_0x120789['balance']-_0x16a851[_0x198a62(0x15a)]);const _0x11470e=_0xa813c6[_0x198a62(0x156)],_0x546b4a=(_0x875711-0x1)*_0x44701f,_0x34f018=_0xa813c6['slice'](_0x546b4a,_0x546b4a+_0x44701f);console[_0x198a62(0x162)](_0x198a62(0x26e)+_0x34f018[_0x198a62(0x156)]+_0x198a62(0x281));const _0x31f12b=await Promise['all'](_0x34f018['map'](async _0x44fcee=>{const _0x16ff5d=_0x198a62,[_0x1244ee,_0x48ed07,_0x38d73c]=await Promise[_0x16ff5d(0x1cf)]([database_1[_0x16ff5d(0x231)][_0x16ff5d(0x1f3)][_0x16ff5d(0x17d)]({'where':{'shopId':_0x44fcee['id'],'status':_0x16ff5d(0x144),'gateway':{'not':_0x16ff5d(0x23d)}}}),database_1[_0x16ff5d(0x231)]['payment']['findFirst']({'where':{'shopId':_0x44fcee['id'],'status':_0x16ff5d(0x144),'gateway':{'not':'test_gateway'}},'orderBy':{'paidAt':_0x16ff5d(0x1e6)},'select':{'paidAt':!![]}}),database_1[_0x16ff5d(0x231)][_0x16ff5d(0x1f3)]['groupBy']({'by':[_0x16ff5d(0x20d)],'where':{'shopId':_0x44fcee['id'],'status':'PAID','gateway':{'not':_0x16ff5d(0x23d)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x30e3ea=new Date(),_0x43ed43=new Date(_0x30e3ea[_0x16ff5d(0x161)](),_0x30e3ea[_0x16ff5d(0x1aa)](),0x1),_0x23c929=new Date(_0x30e3ea[_0x16ff5d(0x161)](),_0x30e3ea[_0x16ff5d(0x1aa)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x370fda,_0x5a1031]=await Promise[_0x16ff5d(0x1cf)]([database_1['default'][_0x16ff5d(0x1ee)][_0x16ff5d(0x289)]({'_sum':{'amount':!![]},'where':{'shopId':_0x44fcee['id'],'status':_0x16ff5d(0x24c)}}),database_1[_0x16ff5d(0x231)]['payout']['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x44fcee['id'],'status':_0x16ff5d(0x24c),'createdAt':{'gte':_0x43ed43,'lte':_0x23c929}}})]),_0x1d7be7=_0x370fda[_0x16ff5d(0x239)][_0x16ff5d(0x20f)]||0x0,_0x31ee7e=_0x5a1031[_0x16ff5d(0x239)][_0x16ff5d(0x20f)]||0x0,_0x327cc9=await Promise[_0x16ff5d(0x1cf)](_0x38d73c['map'](async _0x3a46aa=>{const _0x1a9fec=_0x16ff5d;let _0x33fa72=0x2d;if(_0x44fcee[_0x1a9fec(0x23a)])try{const _0x2c732b=JSON['parse'](_0x44fcee[_0x1a9fec(0x23a)]);for(const [_0x3b28d7,_0x262ddb]of Object[_0x1a9fec(0x1b1)](_0x2c732b)){if(_0x3b28d7[_0x1a9fec(0x215)]()===_0x3a46aa['gateway']['toLowerCase']()){_0x33fa72=_0x262ddb[_0x1a9fec(0x126)]||0xa,console[_0x1a9fec(0x162)]('ðŸ’°\x20[PAYOUT]\x20Gateway\x20'+_0x3a46aa['gateway']+_0x1a9fec(0x1ca)+_0x44fcee['id']+':\x20commission\x20=\x20'+_0x33fa72+'%');break;}}}catch(_0x529177){console[_0x1a9fec(0x181)](_0x1a9fec(0x14e)+_0x44fcee['id']+':',_0x529177);}const _0x152e9b=_0x3a46aa[_0x1a9fec(0x239)]?.[_0x1a9fec(0x153)]||0x0,_0xcbbb4a=_0x152e9b*(0x1-_0x33fa72/0x64);return{'gateway':_0x3a46aa[_0x1a9fec(0x20d)],'count':_0x3a46aa['_count']?.['id']||0x0,'amountUSDT':Math['round'](_0x152e9b*0x64)/0x64,'amountAfterCommissionUSDT':Math['round'](_0xcbbb4a*0x64)/0x64,'commission':_0x33fa72};})),_0x39acd6=_0x327cc9[_0x16ff5d(0x168)]((_0x5f1e24,_0x4fd074)=>_0x5f1e24+_0x4fd074[_0x16ff5d(0x153)],0x0),_0x3064e6=_0x327cc9[_0x16ff5d(0x168)]((_0x461b0b,_0x86b84c)=>_0x461b0b+_0x86b84c['amountAfterCommissionUSDT'],0x0),_0x211d92=_0x44fcee[_0x16ff5d(0x15a)];return console[_0x16ff5d(0x162)](_0x16ff5d(0x166)+_0x44fcee[_0x16ff5d(0x204)]+':'),console[_0x16ff5d(0x162)](_0x16ff5d(0x25d)+_0x39acd6['toFixed'](0x2)+_0x16ff5d(0x21f)),console[_0x16ff5d(0x162)]('\x20\x20\x20ðŸ”\x20Calculated\x20after\x20commission:\x20'+_0x3064e6[_0x16ff5d(0x258)](0x2)+_0x16ff5d(0x21e)),console[_0x16ff5d(0x162)]('\x20\x20\x20âœ…\x20Actual\x20available\x20balance:\x20'+_0x211d92[_0x16ff5d(0x258)](0x2)+_0x16ff5d(0x23e)),console[_0x16ff5d(0x162)](_0x16ff5d(0x224)+_0x1d7be7[_0x16ff5d(0x258)](0x2)+_0x16ff5d(0x279)),console[_0x16ff5d(0x162)]('\x20\x20\x20ðŸ¤”\x20Difference:\x20'+(_0x3064e6-_0x1d7be7-_0x211d92)[_0x16ff5d(0x258)](0x2)+_0x16ff5d(0x12a)),{'id':_0x44fcee['id'],'fullName':_0x44fcee[_0x16ff5d(0x139)],'username':_0x44fcee[_0x16ff5d(0x204)],'telegramId':_0x44fcee[_0x16ff5d(0x141)],'merchantUrl':_0x44fcee['shopUrl'],'wallets':{'usdtPolygonWallet':_0x44fcee[_0x16ff5d(0x1d3)],'usdtTrcWallet':_0x44fcee['usdtTrcWallet'],'usdtErcWallet':_0x44fcee[_0x16ff5d(0x1db)],'usdcPolygonWallet':_0x44fcee[_0x16ff5d(0x142)],'usdcErcWallet':_0x44fcee[_0x16ff5d(0x259)]},'totalAmountUSDT':Math['round'](_0x39acd6*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x16ff5d(0x13b)](_0x3064e6*0x64)/0x64,'currentBalance':Math[_0x16ff5d(0x11b)](_0x211d92*0x64)/0x64,'totalPayout':Math[_0x16ff5d(0x13b)](_0x1d7be7*0x64)/0x64,'thisMonth':Math[_0x16ff5d(0x13b)](_0x31ee7e*0x64)/0x64,'paymentsCount':_0x1244ee,'oldestPaymentDate':_0x48ed07?.[_0x16ff5d(0x218)]||_0x44fcee[_0x16ff5d(0x284)],'gatewayBreakdown':_0x327cc9};})),_0x2880a=_0x31f12b[_0x198a62(0x168)]((_0x27aeda,_0x51a7a3)=>_0x27aeda+_0x51a7a3[_0x198a62(0x27d)],0x0),_0x15de1d=_0x31f12b[_0x198a62(0x168)]((_0x555a4e,_0x54ac55)=>_0x555a4e+_0x54ac55[_0x198a62(0x179)],0x0),_0x56ddc2=_0x31f12b[_0x198a62(0x168)]((_0x1f3509,_0x67c56a)=>_0x1f3509+_0x67c56a['totalPayout'],0x0),_0xb04207=_0x31f12b[_0x198a62(0x168)]((_0x2baa27,_0x3cc421)=>_0x2baa27+_0x3cc421[_0x198a62(0x201)],0x0);return console['log'](_0x198a62(0x18e)+_0x11470e+_0x198a62(0x275)),console[_0x198a62(0x162)](_0x198a62(0x242)+Math[_0x198a62(0x13b)](_0x2880a*0x64)/0x64+_0x198a62(0x21f)),console[_0x198a62(0x162)]('\x20\x20\x20âœ…\x20Total\x20net\x20balances:\x20'+Math['round'](_0x15de1d*0x64)/0x64+_0x198a62(0x14a)),console[_0x198a62(0x162)](_0x198a62(0x173)+Math['round'](_0x56ddc2*0x64)/0x64+_0x198a62(0x1f8)),console[_0x198a62(0x162)](_0x198a62(0x24a)+Math['round'](_0xb04207*0x64)/0x64+_0x198a62(0x1f8)),{'merchants':_0x31f12b,'pagination':{'page':_0x875711,'limit':_0x44701f,'total':_0x11470e,'totalPages':Math['ceil'](_0x11470e/_0x44701f)},'summary':{'totalMerchants':_0x11470e,'totalAmountUSDT':Math[_0x198a62(0x13b)](_0x2880a*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x15de1d*0x64)/0x64,'totalPayout':Math[_0x198a62(0x13b)](_0x56ddc2*0x64)/0x64,'thisMonth':Math[_0x198a62(0x13b)](_0xb04207*0x64)/0x64}};}async['createPayout'](_0x9c5c3b){const _0x4015b9=a46_0x55b484,{shopId:_0x2f2d06,amount:_0x4de5fa,network:_0x2c6089,wallet:_0x39bcd6,notes:_0x1366b6,txid:_0x1436e9,periodFrom:_0x571495,periodTo:_0x3ddfb9}=_0x9c5c3b,_0x19816b=await database_1[_0x4015b9(0x231)][_0x4015b9(0x128)](async _0x1a6d1f=>{const _0x3d9277=_0x4015b9,_0x45f0ca=await _0x1a6d1f[_0x3d9277(0x191)]['findUnique']({'where':{'id':_0x2f2d06},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x45f0ca)throw new Error(_0x3d9277(0x127));console[_0x3d9277(0x162)](_0x3d9277(0x280)+_0x45f0ca[_0x3d9277(0x204)]+':'),console['log'](_0x3d9277(0x1c8)+_0x45f0ca[_0x3d9277(0x15a)][_0x3d9277(0x258)](0x6)+_0x3d9277(0x1f8)),console[_0x3d9277(0x162)](_0x3d9277(0x27c)+_0x4de5fa[_0x3d9277(0x258)](0x6)+_0x3d9277(0x1f8)),console[_0x3d9277(0x162)]('\x20\x20\x20Current\x20total\x20paid\x20out:\x20'+_0x45f0ca['totalPaidOut'][_0x3d9277(0x258)](0x6)+'\x20USDT');if(_0x1436e9)console['log'](_0x3d9277(0x254)+_0x1436e9);const _0x8c1137=0.000001,_0x5ab0e6=Number(_0x45f0ca[_0x3d9277(0x15a)]),_0x1a332d=Number(_0x4de5fa);console['log'](_0x3d9277(0x25c)),console[_0x3d9277(0x162)](_0x3d9277(0x1cc)+_0x45f0ca[_0x3d9277(0x15a)]),console['log'](_0x3d9277(0x202)+_0x5ab0e6),console[_0x3d9277(0x162)](_0x3d9277(0x208)+_0x1a332d),console[_0x3d9277(0x162)](_0x3d9277(0x1ce)+(_0x5ab0e6-_0x1a332d)),console[_0x3d9277(0x162)](_0x3d9277(0x22e)+_0x8c1137);if(_0x5ab0e6<_0x1a332d-_0x8c1137)throw new Error('Insufficient\x20balance.\x20Available:\x20'+_0x5ab0e6[_0x3d9277(0x258)](0x6)+'\x20USDT,\x20Requested:\x20'+_0x1a332d[_0x3d9277(0x258)](0x6)+_0x3d9277(0x271)+(_0x5ab0e6-_0x1a332d)['toFixed'](0x8)+_0x3d9277(0x1f8));console['log'](_0x3d9277(0x1ea));const _0x303003=Math['min'](_0x5ab0e6,_0x1a332d);let _0x48e8c=_0x39bcd6;console['log'](_0x3d9277(0x174)+(_0x39bcd6||_0x3d9277(0x121)));if(!_0x48e8c){console[_0x3d9277(0x162)](_0x3d9277(0x1b8));const _0x28fe6d=await _0x1a6d1f[_0x3d9277(0x191)][_0x3d9277(0x256)]({'where':{'id':_0x2f2d06},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});console[_0x3d9277(0x162)](_0x3d9277(0x277),_0x28fe6d);if(_0x28fe6d)switch(_0x2c6089){case _0x3d9277(0x1c3):_0x48e8c=_0x28fe6d[_0x3d9277(0x1d3)]||undefined,console[_0x3d9277(0x162)](_0x3d9277(0x228)+_0x48e8c);break;case _0x3d9277(0x1e9):_0x48e8c=_0x28fe6d['usdtTrcWallet']||undefined,console[_0x3d9277(0x162)]('ðŸ”\x20Selected\x20trc20\x20wallet:\x20'+_0x48e8c);break;case _0x3d9277(0x125):_0x48e8c=_0x28fe6d['usdtErcWallet']||undefined,console['log'](_0x3d9277(0x241)+_0x48e8c);break;case _0x3d9277(0x19c):_0x48e8c=_0x28fe6d[_0x3d9277(0x142)]||undefined,console[_0x3d9277(0x162)]('ðŸ”\x20Selected\x20polygon_usdc\x20wallet:\x20'+_0x48e8c);break;case'erc20_usdc':_0x48e8c=_0x28fe6d['usdcErcWallet']||undefined,console[_0x3d9277(0x162)](_0x3d9277(0x27e)+_0x48e8c);break;}}else console[_0x3d9277(0x162)]('âœ…\x20Using\x20wallet\x20from\x20request:\x20'+_0x48e8c);console['log'](_0x3d9277(0x1f6)+_0x2c6089+':\x20'+(_0x48e8c||_0x3d9277(0x159))),console[_0x3d9277(0x162)]('ðŸ”\x20Creating\x20payout\x20with\x20data:',{'shopId':_0x2f2d06,'amount':_0x303003,'network':_0x2c6089,'wallet':_0x48e8c,'status':_0x3d9277(0x24c),'txid':_0x1436e9,'notes':_0x1366b6,'periodFrom':_0x571495?new Date(_0x571495):null,'periodTo':_0x3ddfb9?new Date(_0x3ddfb9):null});const _0x22cc1a=await _0x1a6d1f[_0x3d9277(0x1ee)]['create']({'data':{'shopId':_0x2f2d06,'amount':_0x303003,'network':_0x2c6089,'wallet':_0x48e8c,'status':_0x3d9277(0x24c),'txid':_0x1436e9,'notes':_0x1366b6,'periodFrom':_0x571495?new Date(_0x571495):null,'periodTo':_0x3ddfb9?new Date(_0x3ddfb9):null,'createdAt':new Date(),'paidAt':new Date()}});console[_0x3d9277(0x162)]('âœ…\x20Payout\x20created\x20in\x20DB:',{'id':_0x22cc1a['id'],'wallet':_0x22cc1a['wallet'],'network':_0x22cc1a[_0x3d9277(0x1ab)],'amount':_0x22cc1a[_0x3d9277(0x20f)]});const _0x36f57e=_0x5ab0e6-_0x303003,_0x441c30=Number(_0x45f0ca[_0x3d9277(0x1fa)])+_0x303003;return await _0x1a6d1f[_0x3d9277(0x191)][_0x3d9277(0x15f)]({'where':{'id':_0x2f2d06},'data':{'balance':_0x36f57e,'totalPaidOut':_0x441c30}}),console[_0x3d9277(0x162)](_0x3d9277(0x133)+_0x45f0ca['username']+_0x3d9277(0x12b)),console[_0x3d9277(0x162)](_0x3d9277(0x266)+_0x5ab0e6[_0x3d9277(0x258)](0x6)+_0x3d9277(0x16d)+_0x36f57e[_0x3d9277(0x258)](0x6)+_0x3d9277(0x20a)+_0x303003[_0x3d9277(0x258)](0x6)+')'),console[_0x3d9277(0x162)]('\x20\x20\x20Total\x20paid\x20out:\x20'+_0x45f0ca[_0x3d9277(0x1fa)][_0x3d9277(0x258)](0x6)+'\x20->\x20'+_0x441c30[_0x3d9277(0x258)](0x6)+_0x3d9277(0x1a8)+_0x303003[_0x3d9277(0x258)](0x6)+')'),console[_0x3d9277(0x162)](_0x3d9277(0x1bb)+_0x303003['toFixed'](0x6)+_0x3d9277(0x1f8)),{'payout':_0x22cc1a,'shop':_0x45f0ca};});console[_0x4015b9(0x162)](_0x4015b9(0x18d)+_0x19816b[_0x4015b9(0x1ee)]['id']+_0x4015b9(0x1ca)+_0x19816b[_0x4015b9(0x191)][_0x4015b9(0x204)]+'\x20('+_0x19816b[_0x4015b9(0x1ee)][_0x4015b9(0x20f)][_0x4015b9(0x258)](0x6)+_0x4015b9(0x26a));try{let _0x109b9f=_0x4015b9(0x15b);if(_0x19816b[_0x4015b9(0x1ee)]['periodFrom']&&_0x19816b['payout'][_0x4015b9(0x20c)]){const _0x497e67=new Date(_0x19816b['payout']['periodFrom'])[_0x4015b9(0x1f5)](_0x4015b9(0x1ed)),_0x14adc7=new Date(_0x19816b['payout'][_0x4015b9(0x20c)])[_0x4015b9(0x1f5)](_0x4015b9(0x1ed));_0x109b9f=_0x497e67+'\x20-\x20'+_0x14adc7;}await telegramBotService_1[_0x4015b9(0x11a)][_0x4015b9(0x1ae)](_0x19816b[_0x4015b9(0x1ee)]['shopId'],{'id':_0x19816b[_0x4015b9(0x1ee)]['id'],'amount':_0x19816b[_0x4015b9(0x1ee)][_0x4015b9(0x20f)],'network':_0x19816b[_0x4015b9(0x1ee)]['network'],'wallet':_0x19816b[_0x4015b9(0x1ee)]['wallet'],'period':_0x109b9f,'createdAt':_0x19816b['payout'][_0x4015b9(0x284)],'txid':_0x19816b[_0x4015b9(0x1ee)]['txid']}),console[_0x4015b9(0x162)]('ðŸ“±\x20Telegram\x20notification\x20sent\x20for\x20payout\x20'+_0x19816b[_0x4015b9(0x1ee)]['id']);}catch(_0x1549d9){console[_0x4015b9(0x181)](_0x4015b9(0x203)+_0x19816b['payout']['id']+':',_0x1549d9);}return{'id':_0x19816b['payout']['id'],'shopId':_0x19816b[_0x4015b9(0x1ee)][_0x4015b9(0x143)],'shopName':_0x19816b[_0x4015b9(0x191)][_0x4015b9(0x139)],'shopUsername':_0x19816b[_0x4015b9(0x191)][_0x4015b9(0x204)],'amount':_0x19816b[_0x4015b9(0x1ee)][_0x4015b9(0x20f)],'network':_0x19816b[_0x4015b9(0x1ee)][_0x4015b9(0x1ab)],'wallet':_0x19816b[_0x4015b9(0x1ee)][_0x4015b9(0x210)],'status':_0x19816b[_0x4015b9(0x1ee)][_0x4015b9(0x19e)],'txid':_0x19816b[_0x4015b9(0x1ee)]['txid'],'notes':_0x19816b['payout'][_0x4015b9(0x217)],'periodFrom':_0x19816b[_0x4015b9(0x1ee)]['periodFrom'],'periodTo':_0x19816b[_0x4015b9(0x1ee)][_0x4015b9(0x20c)],'createdAt':_0x19816b[_0x4015b9(0x1ee)][_0x4015b9(0x284)],'paidAt':_0x19816b[_0x4015b9(0x1ee)][_0x4015b9(0x218)]};}async[a46_0x55b484(0x1ac)](_0x34574a){const _0x4c7b1d=a46_0x55b484,{page:_0x422e99,limit:_0x20c65f,shopId:_0x8d20cc,network:_0x136d34,dateFrom:_0x538a1a,dateTo:_0x5e2378,search:_0x4a79c0}=_0x34574a,_0x2a0b9d=(_0x422e99-0x1)*_0x20c65f,_0x4cd6fb={};_0x8d20cc&&(_0x4cd6fb[_0x4c7b1d(0x143)]=_0x8d20cc);_0x136d34&&(_0x4cd6fb[_0x4c7b1d(0x1ab)]=_0x136d34);if(_0x538a1a||_0x5e2378){_0x4cd6fb[_0x4c7b1d(0x284)]={};if(_0x538a1a){const _0x278a14=new Date(_0x538a1a);_0x278a14[_0x4c7b1d(0x206)](0x0,0x0,0x0,0x1),_0x4cd6fb[_0x4c7b1d(0x284)][_0x4c7b1d(0x273)]=_0x278a14,console[_0x4c7b1d(0x162)](_0x4c7b1d(0x131)+_0x278a14[_0x4c7b1d(0x158)]());}if(_0x5e2378){const _0x2d2f9a=new Date(_0x5e2378);_0x2d2f9a[_0x4c7b1d(0x206)](0x17,0x3b,0x3b,0x3e7),_0x4cd6fb[_0x4c7b1d(0x284)][_0x4c7b1d(0x1f4)]=_0x2d2f9a,console['log']('ðŸ“…\x20Payout\x20date\x20to\x20filter:\x20'+_0x2d2f9a[_0x4c7b1d(0x158)]());}}_0x4a79c0&&(_0x4cd6fb['OR']=[{'shop':{'name':{'contains':_0x4a79c0,'mode':_0x4c7b1d(0x20e)}}},{'shop':{'username':{'contains':_0x4a79c0,'mode':_0x4c7b1d(0x20e)}}},{'notes':{'contains':_0x4a79c0,'mode':_0x4c7b1d(0x20e)}}]);const [_0x2d2e35,_0x162915]=await Promise[_0x4c7b1d(0x1cf)]([database_1[_0x4c7b1d(0x231)][_0x4c7b1d(0x1ee)][_0x4c7b1d(0x1b3)]({'where':_0x4cd6fb,'skip':_0x2a0b9d,'take':_0x20c65f,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'wallet':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x4c7b1d(0x231)][_0x4c7b1d(0x1ee)][_0x4c7b1d(0x17d)]({'where':_0x4cd6fb})]);return{'payouts':_0x2d2e35[_0x4c7b1d(0x261)](_0x30b4d5=>({'id':_0x30b4d5['id'],'shopId':_0x30b4d5[_0x4c7b1d(0x143)],'shopName':_0x30b4d5['shop']['name'],'shopUsername':_0x30b4d5[_0x4c7b1d(0x191)][_0x4c7b1d(0x204)],'amount':_0x30b4d5[_0x4c7b1d(0x20f)],'network':_0x30b4d5[_0x4c7b1d(0x1ab)],'wallet':_0x30b4d5[_0x4c7b1d(0x210)],'status':_0x30b4d5[_0x4c7b1d(0x19e)],'txid':_0x30b4d5[_0x4c7b1d(0x150)],'notes':_0x30b4d5[_0x4c7b1d(0x217)],'periodFrom':_0x30b4d5['periodFrom'],'periodTo':_0x30b4d5[_0x4c7b1d(0x20c)],'createdAt':_0x30b4d5[_0x4c7b1d(0x284)],'paidAt':_0x30b4d5[_0x4c7b1d(0x218)]})),'pagination':{'page':_0x422e99,'limit':_0x20c65f,'total':_0x162915,'totalPages':Math[_0x4c7b1d(0x1c7)](_0x162915/_0x20c65f)}};}async['getPayoutById'](_0x333d66){const _0xf34ebd=a46_0x55b484,_0x5db6b9=await database_1['default']['payout'][_0xf34ebd(0x256)]({'where':{'id':_0x333d66},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x5db6b9)return null;return{'id':_0x5db6b9['id'],'shopId':_0x5db6b9[_0xf34ebd(0x143)],'shopName':_0x5db6b9[_0xf34ebd(0x191)]['name'],'shopUsername':_0x5db6b9[_0xf34ebd(0x191)]['username'],'amount':_0x5db6b9[_0xf34ebd(0x20f)],'network':_0x5db6b9[_0xf34ebd(0x1ab)],'wallet':_0x5db6b9['wallet'],'status':_0x5db6b9[_0xf34ebd(0x19e)],'txid':_0x5db6b9[_0xf34ebd(0x150)],'notes':_0x5db6b9['notes'],'periodFrom':_0x5db6b9[_0xf34ebd(0x21c)],'periodTo':_0x5db6b9[_0xf34ebd(0x20c)],'createdAt':_0x5db6b9['createdAt'],'paidAt':_0x5db6b9[_0xf34ebd(0x218)]};}async[a46_0x55b484(0x1b5)](_0x2e6980){const _0x36e766=a46_0x55b484;await database_1[_0x36e766(0x231)][_0x36e766(0x1ee)][_0x36e766(0x1a7)]({'where':{'id':_0x2e6980}});}async[a46_0x55b484(0x22c)](_0x555619){const _0x4ce4df=a46_0x55b484,{page:_0x48110b,limit:_0x42eafa,status:_0x2b0818,gateway:_0x4e1898,shopId:_0x1cad08,dateFrom:_0x4a6de9,dateTo:_0x61c5c5,search:_0x749adb,currency:_0x3864ec,sortBy:_0x1d426d,sortOrder:_0xd8d725}=_0x555619,_0x9654c4=(_0x48110b-0x1)*_0x42eafa;console['log']('ðŸ“Š\x20Getting\x20payments\x20with\x20filters:',_0x555619);const _0x26a9f4=await database_1[_0x4ce4df(0x231)][_0x4ce4df(0x1f3)][_0x4ce4df(0x1d9)]({'by':[_0x4ce4df(0x20d)],'_count':{'gateway':!![]}});console[_0x4ce4df(0x162)](_0x4ce4df(0x211),_0x26a9f4['map'](_0x230087=>_0x230087[_0x4ce4df(0x20d)]+'\x20('+_0x230087[_0x4ce4df(0x263)][_0x4ce4df(0x20d)]+_0x4ce4df(0x1b7)));if(_0x4e1898){const _0x3d1f8f=_0x26a9f4[_0x4ce4df(0x16f)](_0x5aee92=>_0x5aee92[_0x4ce4df(0x20d)][_0x4ce4df(0x215)]()===_0x4e1898[_0x4ce4df(0x215)]());!_0x3d1f8f&&_0x4e1898[_0x4ce4df(0x215)]()!=='test_gateway'&&console['log'](_0x4ce4df(0x163)+_0x4e1898+_0x4ce4df(0x28c)+_0x26a9f4[_0x4ce4df(0x261)](_0x24b13f=>_0x24b13f[_0x4ce4df(0x20d)])[_0x4ce4df(0x1df)](',\x20'));}const _0x40a439={};_0x2b0818&&(_0x40a439[_0x4ce4df(0x19e)]=_0x2b0818[_0x4ce4df(0x287)]());if(!_0x4e1898)_0x40a439[_0x4ce4df(0x20d)]={'not':_0x4ce4df(0x23d)};else{if(_0x4e1898&&(_0x4e1898[_0x4ce4df(0x215)]()===_0x4ce4df(0x23d)||_0x4e1898===_0x4ce4df(0x129)))_0x40a439[_0x4ce4df(0x20d)]=_0x4ce4df(0x23d);else{let _0x2de9df=_0x4e1898;const _0x13a1f1=(0x0,gateway_1['getGatewayNameById'])(_0x4e1898);if(_0x13a1f1)_0x2de9df=_0x13a1f1,console[_0x4ce4df(0x162)](_0x4ce4df(0x195)+_0x4e1898+_0x4ce4df(0x182)+_0x2de9df+'\x27');else{const _0x52d054=(0x0,gateway_1[_0x4ce4df(0x184)])(_0x4e1898);if(_0x52d054){const _0x2d96ed=(0x0,gateway_1[_0x4ce4df(0x19b)])(_0x52d054);_0x2d96ed&&(_0x2de9df=_0x2d96ed,console[_0x4ce4df(0x162)](_0x4ce4df(0x12e)+_0x4e1898+_0x4ce4df(0x183)+_0x52d054+_0x4ce4df(0x1c1)+_0x2de9df+'\x27'));}else console[_0x4ce4df(0x162)](_0x4ce4df(0x1f1)+_0x4e1898+_0x4ce4df(0x209));}const _0x309b88=await database_1[_0x4ce4df(0x231)]['payment'][_0x4ce4df(0x17d)]({'where':{'gateway':_0x2de9df[_0x4ce4df(0x215)]()},'take':0x1});_0x309b88===0x0?(console[_0x4ce4df(0x162)](_0x4ce4df(0x192)+_0x2de9df+_0x4ce4df(0x24b)+_0x4e1898+_0x4ce4df(0x229)),_0x40a439['gateway']=_0x4ce4df(0x221)):(_0x40a439['gateway']=_0x2de9df[_0x4ce4df(0x215)](),console[_0x4ce4df(0x162)](_0x4ce4df(0x269)+_0x2de9df+'\x27\x20(from\x20\x27'+_0x4e1898+'\x27)'));}}console['log'](_0x4ce4df(0x233),_0x40a439[_0x4ce4df(0x20d)]);_0x1cad08&&(_0x40a439[_0x4ce4df(0x143)]=_0x1cad08);_0x3864ec&&(_0x40a439[_0x4ce4df(0x240)]=_0x3864ec['toUpperCase'](),console[_0x4ce4df(0x162)](_0x4ce4df(0x16b)+_0x3864ec[_0x4ce4df(0x287)]()));if(_0x4a6de9||_0x61c5c5){_0x40a439['createdAt']={};if(_0x4a6de9){const _0x5e6aca=new Date(_0x4a6de9);_0x5e6aca[_0x4ce4df(0x206)](0x0,0x0,0x0,0x1),_0x40a439[_0x4ce4df(0x284)][_0x4ce4df(0x273)]=_0x5e6aca,console[_0x4ce4df(0x162)](_0x4ce4df(0x207)+_0x5e6aca[_0x4ce4df(0x158)]());}if(_0x61c5c5){const _0x262281=new Date(_0x61c5c5);_0x262281[_0x4ce4df(0x206)](0x17,0x3b,0x3b,0x3e7),_0x40a439[_0x4ce4df(0x284)][_0x4ce4df(0x1f4)]=_0x262281,console[_0x4ce4df(0x162)]('ðŸ“…\x20Date\x20to\x20filter:\x20'+_0x262281[_0x4ce4df(0x158)]());}}_0x749adb&&(_0x40a439['OR']=[{'id':{'contains':_0x749adb,'mode':_0x4ce4df(0x20e)}},{'orderId':{'contains':_0x749adb,'mode':_0x4ce4df(0x20e)}},{'gatewayOrderId':{'contains':_0x749adb,'mode':_0x4ce4df(0x20e)}},{'customerEmail':{'contains':_0x749adb,'mode':_0x4ce4df(0x20e)}},{'shop':{'name':{'contains':_0x749adb,'mode':_0x4ce4df(0x20e)}}},{'shop':{'username':{'contains':_0x749adb,'mode':_0x4ce4df(0x20e)}}}]);console[_0x4ce4df(0x162)](_0x4ce4df(0x205),JSON[_0x4ce4df(0x1d1)](_0x40a439,null,0x2));let _0x54620d={'createdAt':_0x4ce4df(0x22a)};if(_0x1d426d){const _0x3b5ce8=['amount',_0x4ce4df(0x284),'updatedAt',_0x4ce4df(0x19e),_0x4ce4df(0x20d),_0x4ce4df(0x240)],_0x6f8c95=[_0x4ce4df(0x1e6),'desc'];if(_0x3b5ce8[_0x4ce4df(0x197)](_0x1d426d)){const _0x758698=_0x6f8c95[_0x4ce4df(0x197)](_0xd8d725)?_0xd8d725:'desc';_0x54620d={[_0x1d426d]:_0x758698},console['log'](_0x4ce4df(0x1ec)+_0x1d426d+'\x20in\x20'+_0x758698+_0x4ce4df(0x165));}}const [_0x9a5922,_0x10117e]=await Promise[_0x4ce4df(0x1cf)]([database_1[_0x4ce4df(0x231)]['payment'][_0x4ce4df(0x1b3)]({'where':_0x40a439,'skip':_0x9654c4,'take':_0x42eafa,'orderBy':_0x54620d,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x4ce4df(0x231)][_0x4ce4df(0x1f3)]['count']({'where':_0x40a439})]);return{'payments':_0x9a5922,'pagination':{'page':_0x48110b,'limit':_0x42eafa,'total':_0x10117e,'totalPages':Math[_0x4ce4df(0x1c7)](_0x10117e/_0x42eafa)}};}async[a46_0x55b484(0x15e)](_0x4ad3df){const _0x1ddb0b=a46_0x55b484,_0x103ec5=await database_1['default'][_0x1ddb0b(0x1f3)]['findUnique']({'where':{'id':_0x4ad3df},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x103ec5)return null;return{'id':_0x103ec5['id'],'shopId':_0x103ec5[_0x1ddb0b(0x143)],'gateway':_0x103ec5[_0x1ddb0b(0x20d)],'amount':_0x103ec5['amount'],'currency':_0x103ec5[_0x1ddb0b(0x240)],'status':_0x103ec5['status'],'orderId':_0x103ec5[_0x1ddb0b(0x17b)],'gatewayOrderId':_0x103ec5['gatewayOrderId'],'customerEmail':_0x103ec5[_0x1ddb0b(0x1d6)],'customerName':_0x103ec5[_0x1ddb0b(0x25b)],'customerCountry':_0x103ec5[_0x1ddb0b(0x130)],'customerIp':_0x103ec5[_0x1ddb0b(0x1f9)],'customerUa':_0x103ec5[_0x1ddb0b(0x1fb)],'failureMessage':_0x103ec5[_0x1ddb0b(0x1de)],'externalPaymentUrl':_0x103ec5[_0x1ddb0b(0x21d)],'successUrl':_0x103ec5[_0x1ddb0b(0x177)],'failUrl':_0x103ec5['failUrl'],'pendingUrl':_0x103ec5[_0x1ddb0b(0x1b2)],'whiteUrl':_0x103ec5['whiteUrl'],'createdAt':_0x103ec5[_0x1ddb0b(0x284)],'updatedAt':_0x103ec5[_0x1ddb0b(0x13c)],'shop':_0x103ec5[_0x1ddb0b(0x191)]};}async[a46_0x55b484(0x1e0)](_0x15d468,_0x210f36,_0x4ac458,_0x32a6b4){const _0x151a28=a46_0x55b484,_0x432fee=await database_1[_0x151a28(0x231)]['$transaction'](async _0x9bdf8c=>{const _0x2acc06=_0x151a28,_0x424334=await _0x9bdf8c[_0x2acc06(0x1f3)][_0x2acc06(0x256)]({'where':{'id':_0x15d468},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x424334)throw new Error(_0x2acc06(0x274));const _0x2d9115=_0x424334[_0x2acc06(0x19e)],_0x3af82e=_0x210f36[_0x2acc06(0x287)]();console['log'](_0x2acc06(0x234)+_0x15d468+_0x2acc06(0x1e3)+_0x2d9115+_0x2acc06(0x16d)+_0x3af82e),console[_0x2acc06(0x162)](_0x2acc06(0x23f)+_0x424334['shop'][_0x2acc06(0x15a)]+_0x2acc06(0x1f8));const _0x4dd1a6={'status':_0x3af82e,'updatedAt':new Date(),'statusChangedBy':_0x2acc06(0x22b),'statusChangedAt':new Date()};_0x4ac458&&(_0x4dd1a6[_0x2acc06(0x13d)]=_0x4ac458);_0x3af82e==='CHARGEBACK'&&_0x32a6b4&&(_0x4dd1a6['chargebackAmount']=_0x32a6b4);let _0x216be9=0x0,_0x38946c=_0x424334[_0x2acc06(0x191)][_0x2acc06(0x15a)];if(_0x3af82e===_0x2acc06(0x144)&&_0x2d9115!==_0x2acc06(0x144)){_0x4dd1a6['paidAt']=new Date();const _0x13d91b=await currencyService_1[_0x2acc06(0x18c)][_0x2acc06(0x194)](_0x424334[_0x2acc06(0x20f)],_0x424334[_0x2acc06(0x240)]);_0x4dd1a6[_0x2acc06(0x153)]=_0x13d91b;let _0x29501b=0x2d;const _0x301493=await _0x9bdf8c[_0x2acc06(0x191)][_0x2acc06(0x256)]({'where':{'id':_0x424334['shopId']},'select':{'gatewaySettings':!![]}});if(_0x301493?.['gatewaySettings'])try{const _0x85bf59=JSON['parse'](_0x301493[_0x2acc06(0x23a)]);for(const [_0x4a5775,_0x1bc078]of Object[_0x2acc06(0x1b1)](_0x85bf59)){if(_0x4a5775['toLowerCase']()===_0x424334['gateway'][_0x2acc06(0x215)]()){_0x29501b=_0x1bc078['commission']||0xa;break;}}}catch(_0x34ca61){console[_0x2acc06(0x181)](_0x2acc06(0x19a)+_0x15d468+':',_0x34ca61);}let _0x53feb2;_0x424334[_0x2acc06(0x148)]!==null&&_0x424334[_0x2acc06(0x148)]!==undefined?(_0x53feb2=_0x424334[_0x2acc06(0x148)],console[_0x2acc06(0x162)](_0x2acc06(0x251)+_0x53feb2[_0x2acc06(0x258)](0x6)+_0x2acc06(0x23c)+_0x15d468)):(_0x53feb2=_0x13d91b*(0x1-_0x29501b/0x64),console['log'](_0x2acc06(0x186)+_0x15d468+':\x20'+_0x29501b+_0x2acc06(0x1bd)+_0x13d91b['toFixed'](0x6)+'\x20USDT'),_0x4dd1a6[_0x2acc06(0x148)]=_0x53feb2,_0x4dd1a6[_0x2acc06(0x138)]=_0x29501b),_0x216be9=_0x53feb2,_0x38946c+=_0x53feb2,console[_0x2acc06(0x162)]('ðŸ’°\x20Payment\x20'+_0x15d468+_0x2acc06(0x262)),console[_0x2acc06(0x162)](_0x2acc06(0x283)+_0x13d91b['toFixed'](0x6)+_0x2acc06(0x1f8)),console[_0x2acc06(0x162)](_0x2acc06(0x246)+_0x424334[_0x2acc06(0x20d)]+_0x2acc06(0x288)+_0x29501b+'%'),console[_0x2acc06(0x162)](_0x2acc06(0x223)+_0x53feb2[_0x2acc06(0x258)](0x6)+'\x20USDT\x20(after\x20'+_0x29501b+'%\x20commission)'),console[_0x2acc06(0x162)](_0x2acc06(0x220)+_0x53feb2[_0x2acc06(0x258)](0x6)+'\x20USDT');}else{if(_0x2d9115===_0x2acc06(0x144)&&_0x3af82e!=='PAID'&&_0x3af82e!==_0x2acc06(0x1a3)){if(_0x424334['amountUSDT']){let _0x56f893=0x2d;const _0x22a76f=await _0x9bdf8c['shop'][_0x2acc06(0x256)]({'where':{'id':_0x424334[_0x2acc06(0x143)]},'select':{'gatewaySettings':!![]}});if(_0x22a76f?.['gatewaySettings'])try{const _0x56e3a2=JSON['parse'](_0x22a76f[_0x2acc06(0x23a)]);for(const [_0x2e998b,_0x200ccb]of Object[_0x2acc06(0x1b1)](_0x56e3a2)){if(_0x2e998b[_0x2acc06(0x215)]()===_0x424334[_0x2acc06(0x20d)][_0x2acc06(0x215)]()){_0x56f893=_0x200ccb['commission']||0xa;break;}}}catch(_0x1df8ec){console[_0x2acc06(0x181)](_0x2acc06(0x19a)+_0x15d468+':',_0x1df8ec);}const _0x3ca772=_0x424334['amountUSDT']*(0x1-_0x56f893/0x64);_0x216be9=-_0x3ca772,_0x38946c-=_0x3ca772,console[_0x2acc06(0x162)](_0x2acc06(0x283)+_0x424334[_0x2acc06(0x153)]['toFixed'](0x6)+_0x2acc06(0x1f8)),console[_0x2acc06(0x162)](_0x2acc06(0x246)+_0x424334[_0x2acc06(0x20d)]+_0x2acc06(0x288)+_0x56f893+'%'),console['log'](_0x2acc06(0x1c9)+_0x3ca772['toFixed'](0x6)+_0x2acc06(0x1a0)+_0x56f893+_0x2acc06(0x171)),console[_0x2acc06(0x162)](_0x2acc06(0x1dc)+_0x3ca772['toFixed'](0x6)+'\x20USDT');}}}_0x3af82e==='CHARGEBACK'&&(console[_0x2acc06(0x162)](_0x2acc06(0x1ef)),_0x32a6b4&&_0x32a6b4>0x0?(_0x216be9=-_0x32a6b4,_0x38946c-=_0x32a6b4,console[_0x2acc06(0x162)](_0x2acc06(0x1cd)+_0x32a6b4[_0x2acc06(0x258)](0x6)+_0x2acc06(0x285)),console[_0x2acc06(0x162)]('ðŸ’°\x20Payment\x20amount\x20is\x20NOT\x20deducted\x20(chargeback\x20penalty\x20only)')):console[_0x2acc06(0x162)](_0x2acc06(0x232)),_0x4dd1a6[_0x2acc06(0x270)]=_0x32a6b4||0x0);_0x3af82e===_0x2acc06(0x167)&&_0x2d9115===_0x2acc06(0x144)&&console[_0x2acc06(0x162)](_0x2acc06(0x1b4));const _0x5ad857=await _0x9bdf8c[_0x2acc06(0x1f3)][_0x2acc06(0x15f)]({'where':{'id':_0x15d468},'data':_0x4dd1a6,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x216be9!==0x0&&(await _0x9bdf8c[_0x2acc06(0x191)]['update']({'where':{'id':_0x424334[_0x2acc06(0x143)]},'data':{'balance':_0x38946c}}),console['log']('ðŸ’°\x20Shop\x20'+_0x424334[_0x2acc06(0x143)]+_0x2acc06(0x147)+_0x424334['shop'][_0x2acc06(0x15a)][_0x2acc06(0x258)](0x6)+_0x2acc06(0x16d)+_0x38946c['toFixed'](0x6)+_0x2acc06(0x26f)+(_0x216be9>0x0?'+':'')+_0x216be9['toFixed'](0x6)+')')),_0x5ad857;});return{'id':_0x432fee['id'],'shopId':_0x432fee[_0x151a28(0x143)],'gateway':_0x432fee[_0x151a28(0x20d)],'amount':_0x432fee[_0x151a28(0x20f)],'currency':_0x432fee[_0x151a28(0x240)],'status':_0x432fee['status'],'orderId':_0x432fee['orderId'],'gatewayOrderId':_0x432fee[_0x151a28(0x120)],'customerEmail':_0x432fee[_0x151a28(0x1d6)],'customerName':_0x432fee[_0x151a28(0x25b)],'customerCountry':_0x432fee['customerCountry'],'customerIp':_0x432fee[_0x151a28(0x1f9)],'customerUa':_0x432fee[_0x151a28(0x1fb)],'failureMessage':_0x432fee[_0x151a28(0x1de)],'adminNotes':_0x432fee[_0x151a28(0x13d)],'chargebackAmount':_0x432fee[_0x151a28(0x270)],'statusChangedBy':_0x432fee[_0x151a28(0x196)],'statusChangedAt':_0x432fee[_0x151a28(0x264)],'createdAt':_0x432fee[_0x151a28(0x284)],'updatedAt':_0x432fee[_0x151a28(0x13c)],'shop':_0x432fee[_0x151a28(0x191)]};}async['updateUser'](_0xfd26f3,_0x1d3d66){const _0x38e694=a46_0x55b484,_0x338b62=Math[_0x38e694(0x1fd)]()[_0x38e694(0x170)](0x24)[_0x38e694(0x17f)](0x2,0x9);console[_0x38e694(0x162)](_0x38e694(0x1d4)+_0x338b62+_0x38e694(0x24e)+_0xfd26f3);const _0x37b30f={..._0x1d3d66};_0x1d3d66[_0x38e694(0x137)]&&_0x1d3d66[_0x38e694(0x137)]['trim']()!==''?(console['log']('ðŸ”\x20['+_0x338b62+_0x38e694(0x14c)+_0xfd26f3),_0x37b30f[_0x38e694(0x137)]=await bcryptjs_1[_0x38e694(0x231)][_0x38e694(0x119)](_0x1d3d66[_0x38e694(0x137)],0xc)):(console['log'](_0x38e694(0x22f)+_0x338b62+_0x38e694(0x189)),delete _0x37b30f[_0x38e694(0x137)]);_0x1d3d66[_0x38e694(0x27b)]&&(_0x37b30f[_0x38e694(0x139)]=_0x1d3d66[_0x38e694(0x27b)],delete _0x37b30f['fullName']);_0x1d3d66[_0x38e694(0x252)]&&(_0x37b30f['telegram']=_0x1d3d66[_0x38e694(0x252)],delete _0x37b30f['telegramId']);_0x1d3d66['merchantUrl']&&(_0x37b30f[_0x38e694(0x27a)]=_0x1d3d66['merchantUrl'],delete _0x37b30f['merchantUrl']);if(_0x1d3d66[_0x38e694(0x14b)]){const _0x28ff2b=_0x1d3d66[_0x38e694(0x14b)][_0x38e694(0x261)](_0x19eef3=>this[_0x38e694(0x226)](_0x19eef3));console['log']('ðŸ”„\x20Gateway\x20mapping:',_0x1d3d66[_0x38e694(0x14b)],'->',_0x28ff2b),_0x37b30f[_0x38e694(0x1f0)]=JSON[_0x38e694(0x1d1)](_0x28ff2b),delete _0x37b30f[_0x38e694(0x14b)];}_0x1d3d66[_0x38e694(0x23a)]&&(console['log'](_0x38e694(0x19d)+_0x338b62+']\x20Gateway\x20settings\x20before\x20saving:',_0x1d3d66[_0x38e694(0x23a)]),_0x37b30f[_0x38e694(0x23a)]=JSON[_0x38e694(0x1d1)](_0x1d3d66[_0x38e694(0x23a)]),console[_0x38e694(0x162)](_0x38e694(0x19d)+_0x338b62+_0x38e694(0x176),_0x37b30f[_0x38e694(0x23a)]));_0x1d3d66['wallets']&&(_0x1d3d66['wallets']['usdtPolygonWallet']!==undefined&&(_0x37b30f['usdtPolygonWallet']=_0x1d3d66[_0x38e694(0x20b)][_0x38e694(0x1d3)]||null),_0x1d3d66['wallets'][_0x38e694(0x169)]!==undefined&&(_0x37b30f[_0x38e694(0x169)]=_0x1d3d66[_0x38e694(0x20b)][_0x38e694(0x169)]||null),_0x1d3d66['wallets'][_0x38e694(0x1db)]!==undefined&&(_0x37b30f[_0x38e694(0x1db)]=_0x1d3d66[_0x38e694(0x20b)][_0x38e694(0x1db)]||null),_0x1d3d66[_0x38e694(0x20b)]['usdcPolygonWallet']!==undefined&&(_0x37b30f[_0x38e694(0x142)]=_0x1d3d66[_0x38e694(0x20b)][_0x38e694(0x142)]||null),delete _0x37b30f['wallets']);const _0x284083=await database_1[_0x38e694(0x231)]['shop']['update']({'where':{'id':_0xfd26f3},'data':_0x37b30f,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0x38e694(0x162)](_0x38e694(0x14d)+_0x338b62+_0x38e694(0x151),_0x284083[_0x38e694(0x23a)]),{'id':_0x284083['id'],'fullName':_0x284083['name'],'username':_0x284083[_0x38e694(0x204)],'telegramId':_0x284083['telegram'],'merchantUrl':_0x284083[_0x38e694(0x27a)],'gateways':_0x284083[_0x38e694(0x1f0)]?JSON[_0x38e694(0x1f2)](_0x284083[_0x38e694(0x1f0)]):null,'gatewaySettings':_0x284083[_0x38e694(0x23a)]?JSON[_0x38e694(0x1f2)](_0x284083[_0x38e694(0x23a)]):null,'publicKey':_0x284083['publicKey'],'wallets':{'usdtPolygonWallet':_0x284083[_0x38e694(0x1d3)],'usdtTrcWallet':_0x284083[_0x38e694(0x169)],'usdtErcWallet':_0x284083[_0x38e694(0x1db)],'usdcPolygonWallet':_0x284083[_0x38e694(0x142)]},'status':_0x284083['status'],'createdAt':_0x284083[_0x38e694(0x284)]};}async['suspendUser'](_0xd5e776){const _0x38c573=a46_0x55b484,_0x174155=await database_1[_0x38c573(0x231)]['shop']['update']({'where':{'id':_0xd5e776},'data':{'status':_0x38c573(0x157)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x174155['id'],'fullName':_0x174155[_0x38c573(0x139)],'username':_0x174155[_0x38c573(0x204)],'telegramId':_0x174155[_0x38c573(0x141)],'merchantUrl':_0x174155[_0x38c573(0x27a)],'gateways':_0x174155[_0x38c573(0x1f0)]?JSON[_0x38c573(0x1f2)](_0x174155[_0x38c573(0x1f0)]):null,'gatewaySettings':_0x174155[_0x38c573(0x23a)]?JSON['parse'](_0x174155[_0x38c573(0x23a)]):null,'publicKey':_0x174155[_0x38c573(0x1a6)],'wallets':{'usdtPolygonWallet':_0x174155[_0x38c573(0x1d3)],'usdtTrcWallet':_0x174155['usdtTrcWallet'],'usdtErcWallet':_0x174155[_0x38c573(0x1db)],'usdcPolygonWallet':_0x174155['usdcPolygonWallet']},'status':_0x174155['status'],'createdAt':_0x174155[_0x38c573(0x284)]};}async[a46_0x55b484(0x250)](_0x846fff){const _0x14c01f=a46_0x55b484,_0x20f3d8=await database_1[_0x14c01f(0x231)][_0x14c01f(0x191)][_0x14c01f(0x15f)]({'where':{'id':_0x846fff},'data':{'status':_0x14c01f(0x18f)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x20f3d8['id'],'fullName':_0x20f3d8[_0x14c01f(0x139)],'username':_0x20f3d8['username'],'telegramId':_0x20f3d8[_0x14c01f(0x141)],'merchantUrl':_0x20f3d8[_0x14c01f(0x27a)],'gateways':_0x20f3d8[_0x14c01f(0x1f0)]?JSON[_0x14c01f(0x1f2)](_0x20f3d8['paymentGateways']):null,'gatewaySettings':_0x20f3d8[_0x14c01f(0x23a)]?JSON[_0x14c01f(0x1f2)](_0x20f3d8[_0x14c01f(0x23a)]):null,'publicKey':_0x20f3d8[_0x14c01f(0x1a6)],'wallets':{'usdtPolygonWallet':_0x20f3d8['usdtPolygonWallet'],'usdtTrcWallet':_0x20f3d8[_0x14c01f(0x169)],'usdtErcWallet':_0x20f3d8['usdtErcWallet'],'usdcPolygonWallet':_0x20f3d8[_0x14c01f(0x142)]},'status':_0x20f3d8[_0x14c01f(0x19e)],'createdAt':_0x20f3d8[_0x14c01f(0x284)]};}async[a46_0x55b484(0x255)](_0x29ed19){const _0x42656b=a46_0x55b484,{page:_0x48f152,limit:_0x2d92c3,status:_0xbd80c3}=_0x29ed19,_0x33bac1=(_0x48f152-0x1)*_0x2d92c3,_0x4eb967={};_0xbd80c3&&(_0x4eb967[_0x42656b(0x19e)]=_0xbd80c3[_0x42656b(0x287)]());const [_0x14265a,_0x210a8f]=await Promise[_0x42656b(0x1cf)]([database_1[_0x42656b(0x231)][_0x42656b(0x191)]['findMany']({'where':_0x4eb967,'skip':_0x33bac1,'take':_0x2d92c3,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1['default'][_0x42656b(0x191)][_0x42656b(0x17d)]({'where':_0x4eb967})]);return{'users':_0x14265a[_0x42656b(0x261)](_0x160ea6=>{const _0x2f57f1=_0x42656b,_0x35c10b=_0x160ea6[_0x2f57f1(0x1f0)]?JSON['parse'](_0x160ea6['paymentGateways']):null,_0x409429=_0x35c10b?_0x35c10b[_0x2f57f1(0x261)](_0x624671=>this[_0x2f57f1(0x1eb)](_0x624671)):null;return{'id':_0x160ea6['id'],'fullName':_0x160ea6[_0x2f57f1(0x139)],'username':_0x160ea6[_0x2f57f1(0x204)],'telegramId':_0x160ea6[_0x2f57f1(0x141)],'merchantUrl':_0x160ea6[_0x2f57f1(0x27a)],'gateways':_0x409429,'gatewaySettings':_0x160ea6[_0x2f57f1(0x23a)]?JSON[_0x2f57f1(0x1f2)](_0x160ea6[_0x2f57f1(0x23a)]):null,'publicKey':_0x160ea6[_0x2f57f1(0x1a6)],'wallets':{'usdtPolygonWallet':_0x160ea6[_0x2f57f1(0x1d3)],'usdtTrcWallet':_0x160ea6['usdtTrcWallet'],'usdtErcWallet':_0x160ea6['usdtErcWallet'],'usdcPolygonWallet':_0x160ea6[_0x2f57f1(0x142)]},'status':_0x160ea6[_0x2f57f1(0x19e)],'createdAt':_0x160ea6[_0x2f57f1(0x284)]};}),'pagination':{'page':_0x48f152,'limit':_0x2d92c3,'total':_0x210a8f,'totalPages':Math[_0x42656b(0x1c7)](_0x210a8f/_0x2d92c3)}};}async[a46_0x55b484(0x140)](_0x516347){const _0x2bc5c4=a46_0x55b484,_0x37c79c=await database_1['default'][_0x2bc5c4(0x191)]['findUnique']({'where':{'id':_0x516347},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x37c79c)return null;const _0xd08bd1=_0x37c79c[_0x2bc5c4(0x1f0)]?JSON[_0x2bc5c4(0x1f2)](_0x37c79c[_0x2bc5c4(0x1f0)]):null,_0x2b1a78=_0xd08bd1?_0xd08bd1[_0x2bc5c4(0x261)](_0x5fe738=>this[_0x2bc5c4(0x1eb)](_0x5fe738)):null;return _0xd08bd1&&_0x2b1a78&&console[_0x2bc5c4(0x162)](_0x2bc5c4(0x1c6),_0xd08bd1,'->',_0x2b1a78),{'id':_0x37c79c['id'],'fullName':_0x37c79c[_0x2bc5c4(0x139)],'username':_0x37c79c['username'],'telegramId':_0x37c79c[_0x2bc5c4(0x141)],'merchantUrl':_0x37c79c['shopUrl'],'gateways':_0x2b1a78,'gatewaySettings':_0x37c79c[_0x2bc5c4(0x23a)]?JSON[_0x2bc5c4(0x1f2)](_0x37c79c[_0x2bc5c4(0x23a)]):null,'publicKey':_0x37c79c[_0x2bc5c4(0x1a6)],'wallets':{'usdtPolygonWallet':_0x37c79c[_0x2bc5c4(0x1d3)],'usdtTrcWallet':_0x37c79c['usdtTrcWallet'],'usdtErcWallet':_0x37c79c[_0x2bc5c4(0x1db)],'usdcPolygonWallet':_0x37c79c['usdcPolygonWallet']},'status':_0x37c79c[_0x2bc5c4(0x19e)],'createdAt':_0x37c79c['createdAt']};}async['createUser'](_0x5e63f0){const _0x261c7c=a46_0x55b484,{fullName:_0x47cbab,username:_0x2c5238,password:_0x35fb31,telegramId:_0x3fac64,merchantUrl:_0x1956f5,gateways:_0x4770d7,gatewaySettings:_0x410735,wallets:_0x427320}=_0x5e63f0,_0x99e2fa=await database_1['default']['shop'][_0x261c7c(0x256)]({'where':{'username':_0x2c5238}});if(_0x99e2fa)throw new Error(_0x261c7c(0x124));if(_0x3fac64){const _0x2e4481=await database_1[_0x261c7c(0x231)]['shop'][_0x261c7c(0x256)]({'where':{'telegram':_0x3fac64}});if(_0x2e4481)throw new Error(_0x261c7c(0x1cb));}const _0x1a328e=await bcryptjs_1['default'][_0x261c7c(0x119)](_0x35fb31,0xc),_0x317557='pk_'+crypto_1[_0x261c7c(0x231)][_0x261c7c(0x118)](0x20)[_0x261c7c(0x170)](_0x261c7c(0x1e1)),_0x4de505=_0x261c7c(0x187)+crypto_1[_0x261c7c(0x231)]['randomBytes'](0x20)['toString']('hex'),_0x1a7c74=_0x4770d7?_0x4770d7['map'](_0x170c13=>this[_0x261c7c(0x226)](_0x170c13)):null;_0x4770d7&&_0x1a7c74&&console[_0x261c7c(0x162)]('ðŸ”„\x20Gateway\x20mapping\x20(create):',_0x4770d7,'->',_0x1a7c74);const _0x299135=await database_1['default'][_0x261c7c(0x191)][_0x261c7c(0x1ad)]({'data':{'name':_0x47cbab,'username':_0x2c5238,'password':_0x1a328e,'telegram':_0x3fac64,'shopUrl':_0x1956f5,'paymentGateways':_0x1a7c74?JSON[_0x261c7c(0x1d1)](_0x1a7c74):null,'gatewaySettings':_0x410735?JSON[_0x261c7c(0x1d1)](_0x410735):null,'usdtPolygonWallet':_0x427320?.[_0x261c7c(0x1d3)]||null,'usdtTrcWallet':_0x427320?.[_0x261c7c(0x169)]||null,'usdtErcWallet':_0x427320?.[_0x261c7c(0x1db)]||null,'usdcPolygonWallet':_0x427320?.[_0x261c7c(0x142)]||null,'publicKey':_0x317557,'secretKey':_0x4de505,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x299135['id'],'fullName':_0x299135[_0x261c7c(0x139)],'username':_0x299135[_0x261c7c(0x204)],'telegramId':_0x299135['telegram'],'merchantUrl':_0x299135[_0x261c7c(0x27a)],'gateways':_0x299135[_0x261c7c(0x1f0)]?JSON[_0x261c7c(0x1f2)](_0x299135[_0x261c7c(0x1f0)]):null,'gatewaySettings':_0x299135['gatewaySettings']?JSON[_0x261c7c(0x1f2)](_0x299135[_0x261c7c(0x23a)]):null,'publicKey':_0x299135['publicKey'],'wallets':{'usdtPolygonWallet':_0x299135[_0x261c7c(0x1d3)],'usdtTrcWallet':_0x299135[_0x261c7c(0x169)],'usdtErcWallet':_0x299135['usdtErcWallet'],'usdcPolygonWallet':_0x299135['usdcPolygonWallet']},'status':_0x299135['status'],'createdAt':_0x299135[_0x261c7c(0x284)]};}async[a46_0x55b484(0x1d7)](_0x28dcdf){const _0x295fc6=a46_0x55b484;await database_1[_0x295fc6(0x231)][_0x295fc6(0x191)][_0x295fc6(0x1a7)]({'where':{'id':_0x28dcdf}});}[a46_0x55b484(0x149)](_0x528090,_0x25d581,_0x424f27){const _0x47a85d=a46_0x55b484,_0x4c7009=new Map(),_0x7e24c=new Date(_0x25d581);while(_0x7e24c<=_0x424f27){const _0x21aa0b=_0x7e24c[_0x47a85d(0x158)]()[_0x47a85d(0x1e4)]('T')[0x0];_0x4c7009[_0x47a85d(0x164)](_0x21aa0b,{'revenue':0x0,'count':0x0}),_0x7e24c['setDate'](_0x7e24c['getDate']()+0x1);}for(const _0x53f010 of _0x528090){const _0x1d5268=_0x53f010[_0x47a85d(0x284)]['toISOString']()[_0x47a85d(0x1e4)]('T')[0x0],_0x1e8c27=_0x4c7009[_0x47a85d(0x16a)](_0x1d5268);_0x1e8c27&&(_0x1e8c27[_0x47a85d(0x17d)]+=0x1,_0x53f010['status']===_0x47a85d(0x144)&&(_0x53f010['amountUSDT']?_0x1e8c27[_0x47a85d(0x1c2)]+=_0x53f010['amountUSDT']:console[_0x47a85d(0x162)](_0x47a85d(0x219)+_0x53f010['id']+_0x47a85d(0x1c4))));}const _0x4b8f=[],_0x41d1bc=[];for(const [_0x278f4d,_0x29ae0c]of _0x4c7009){_0x4b8f[_0x47a85d(0x17e)]({'date':_0x278f4d,'amount':Math[_0x47a85d(0x13b)](_0x29ae0c[_0x47a85d(0x1c2)]*0x64)/0x64}),_0x41d1bc['push']({'date':_0x278f4d,'count':_0x29ae0c[_0x47a85d(0x17d)]});}return{'dailyRevenue':_0x4b8f,'dailyPayments':_0x41d1bc};}}exports[a46_0x55b484(0x12f)]=AdminService;