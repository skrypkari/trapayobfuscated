'use strict';const a35_0x4c5d4c=a35_0x1426;(function(_0x2aeec6,_0x2d6692){const _0x47c66e=a35_0x1426,_0x49261f=_0x2aeec6();while(!![]){try{const _0x1f9eb2=-parseInt(_0x47c66e(0x1c9))/0x1+-parseInt(_0x47c66e(0x157))/0x2+-parseInt(_0x47c66e(0x13d))/0x3*(parseInt(_0x47c66e(0x1a4))/0x4)+-parseInt(_0x47c66e(0x16a))/0x5*(parseInt(_0x47c66e(0x179))/0x6)+parseInt(_0x47c66e(0xfd))/0x7*(parseInt(_0x47c66e(0x1d4))/0x8)+parseInt(_0x47c66e(0x1b6))/0x9+parseInt(_0x47c66e(0x102))/0xa*(parseInt(_0x47c66e(0x18c))/0xb);if(_0x1f9eb2===_0x2d6692)break;else _0x49261f['push'](_0x49261f['shift']());}catch(_0xb539d1){_0x49261f['push'](_0x49261f['shift']());}}}(a35_0x2913,0xe70cc));function a35_0x1426(_0x5e1c8b,_0x45b6fc){const _0x291360=a35_0x2913();return a35_0x1426=function(_0x1426bf,_0x348360){_0x1426bf=_0x1426bf-0xf9;let _0x5d3e74=_0x291360[_0x1426bf];return _0x5d3e74;},a35_0x1426(_0x5e1c8b,_0x45b6fc);}var __importDefault=this&&this[a35_0x4c5d4c(0x1a1)]||function(_0x58b9ca){const _0x5f3323=a35_0x4c5d4c;return _0x58b9ca&&_0x58b9ca[_0x5f3323(0x1d2)]?_0x58b9ca:{'default':_0x58b9ca};};function a35_0x2913(){const _0x34c608=['default','create','findFirst','sort','custom','set','telegramId','customerName','2887402nedDfo','pk_','\x20USDT\x20from\x20balance','commissionUSDT','status','\x20USDT','getFullYear','\x20\x20\x20🌍\x20Country:\x20','\x20\x20\x20Current\x20balance:\x20','💸\x20CHARGEBACK\x20penalty:\x20-','hex','Shop\x20not\x20found','getUserById','90d','../config/database','AdminService','aggregate','paidOutUSDT','wallets','440QkJTVY','fullName','amount','usdcPolygonWallet','updateCustomerData','totalPaidOut','balance','REFUND','\x20to\x20','failureMessage','Noda','network','getPayoutById','\x20\x20\x20💵\x20Available\x20balance:\x20','\x20\x20\x20🌐\x20IP:\x20','86520zYWYMe','📊\x20Calculating\x20payout\x20statistics...','successUrl','periodTo','gateway','Rapyd','groupBy','getSystemStatistics','paymentsCount','💰\x20Current\x20shop\x20balance:\x20','COMPLETED','KLYME\x20GB','totalPayout','getAllUsers','gte','gatewayOrderId','getAllPayouts','\x20USDT\x20(-','publicKey','33OkvmAZ','not\x20set','Test\x20Gateway','update','test_gateway','_count','stringify','admin','💰\x20Found\x20','toISOString','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','gatewaySettings','password','📊\x20Merchants\x20awaiting\x20payout:\x20','txid','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','createPayout','customerCountry','usdtErcWallet','customerEmail','\x20status:\x20','__importDefault','week','getTime','1175320jjYWdB','getMerchantsAwaitingPayout','currency','name','length','toLowerCase','toUpperCase','getGatewayDisplayName','turnoverUSDT','externalPaymentUrl','failUrl','usdtTrcWallet','Error\x20processing\x20payment\x20','Payment\x20not\x20found','🔄\x20Admin\x20updating\x20payment\x20','forEach','getAllPayments','values','5824161FIwAEO','getPaymentById','deleteUser','averageCheckUSDT','merchantUrl','📅\x20Period:\x20','deletePayout','\x20\x20\x20💰\x20Total\x20turnover:\x20','\x20balance\x20updated:','\x20became\x20PAID:\x20+','turnover','toFixed','toString','asc','\x20USDT)','log','suspendUser','randomBytes','30d','1294678wroQys','usdtPolygonWallet','💰\x20Shop\x20','adminNotes','orderId','insensitive','\x20no\x20longer\x20PAID:\x20-','period','dateTo','__esModule','findUnique','8WooRay','currencyService','month','updateUser','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','\x20merchants\x20with\x20positive\x20balance','activateUser','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','6581596uGbypW','paidAt','paymentGateways','ceil','$transaction','15138940snacBW','merchantEarnings','\x20\x20\x20🖥️\x20User\x20Agent:\x20','updatePaymentStatus','amountUSDT','💰\x20Payment\x20','gateways','2020-01-01','hash','\x20balance\x20updated:\x20','username','findMany','\x20->\x20','reduce','customerIp','gatewayEarnings','awaitingPayout','map','all','telegram','merchantEarningsUSDT','📊\x20Payout\x20statistics\x20calculated:','shopId','periodFrom','createUser','split','localeCompare','customerUa','shop','count','lte','\x20\x20\x20💰\x20Total\x20payout:\x20','SUSPENDED','CHARGEBACK','date','delete','chargebackAmount','payout','round','getMonth','Username\x20already\x20exists','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','crypto','\x20USDT,\x20Requested:\x20','\x20\x20\x20📊\x20Total\x20payments:\x20','statusChangedBy','dateFrom','\x20for\x20shop\x20','payment','\x20\x20\x20Payout\x20amount:\x20','whiteUrl','averageCommissionRate','string','Plisio','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','parse','createdAt','totalCommissionRate','desc','12MBIyaZ','bcryptjs','updatedAt','ACTIVE','shopUrl','year','\x20USDT\x20to\x20balance','🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','PAID','convertToUSDT','totalPayments','📊\x20Merchant\x20statistics\x20calculated:','✅\x20Payout\x20created:\x20','KLYME\x20EU','Insufficient\x20balance.\x20Available:\x20','_sum','\x20USDT\x20(','notes'];a35_0x2913=function(){return _0x34c608;};return a35_0x2913();}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a35_0x4c5d4c(0x166)]=void 0x0;const database_1=__importDefault(require(a35_0x4c5d4c(0x165))),bcryptjs_1=__importDefault(require(a35_0x4c5d4c(0x13e))),crypto_1=__importDefault(require(a35_0x4c5d4c(0x12c))),currencyService_1=require('./currencyService');class AdminService{async['getPayoutStats'](){const _0x2c09ac=a35_0x4c5d4c;console[_0x2c09ac(0x1c5)](_0x2c09ac(0x17a));const _0x39eaf3=await database_1[_0x2c09ac(0x14f)][_0x2c09ac(0x11e)][_0x2c09ac(0x167)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x2c09ac(0x140)}}),_0x2ccc90=new Date(),_0x10fd27=new Date(_0x2ccc90[_0x2c09ac(0x15d)](),_0x2ccc90[_0x2c09ac(0x129)](),0x1),_0x155f3b=new Date(_0x2ccc90[_0x2c09ac(0x15d)](),_0x2ccc90[_0x2c09ac(0x129)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x21b431=await database_1[_0x2c09ac(0x14f)][_0x2c09ac(0x127)][_0x2c09ac(0x167)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x10fd27,'lte':_0x155f3b},'status':_0x2c09ac(0x183)}}),_0x4ed1d9=_0x39eaf3[_0x2c09ac(0x14c)][_0x2c09ac(0x16f)]||0x0,_0x44cf03=_0x39eaf3[_0x2c09ac(0x14c)][_0x2c09ac(0x170)]||0x0,_0x2f5282=_0x21b431[_0x2c09ac(0x14c)]['amount']||0x0,_0x54288e={'totalPayout':Math['round'](_0x4ed1d9*0x64)/0x64,'awaitingPayout':Math[_0x2c09ac(0x128)](_0x44cf03*0x64)/0x64,'thisMonth':Math['round'](_0x2f5282*0x64)/0x64,'availableBalance':Math[_0x2c09ac(0x128)](_0x44cf03*0x64)/0x64};return console[_0x2c09ac(0x1c5)](_0x2c09ac(0x117)),console[_0x2c09ac(0x1c5)](_0x2c09ac(0x121)+_0x54288e[_0x2c09ac(0x185)]+'\x20USDT\x20(total\x20paid\x20to\x20merchants)'),console[_0x2c09ac(0x1c5)](_0x2c09ac(0xfb)+_0x54288e[_0x2c09ac(0x112)]+'\x20USDT\x20(total\x20merchant\x20balances)'),console[_0x2c09ac(0x1c5)](_0x2c09ac(0x177)+_0x54288e['availableBalance']+'\x20USDT\x20(same\x20as\x20awaiting)'),console['log']('\x20\x20\x20📅\x20This\x20month:\x20'+_0x54288e['thisMonth']+_0x2c09ac(0x15c)),_0x54288e;}async[a35_0x4c5d4c(0x16e)](_0x51425b,_0x1aecf6){const _0xe1fbb0=a35_0x4c5d4c;console['log'](_0xe1fbb0(0x1d8)+_0x51425b+':',_0x1aecf6);const _0x177cbc=await database_1[_0xe1fbb0(0x14f)]['payment'][_0xe1fbb0(0x1d3)]({'where':{'id':_0x51425b},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x177cbc)throw new Error(_0xe1fbb0(0x1b1));const _0x367b61={};_0x1aecf6[_0xe1fbb0(0x19d)]!==undefined&&(_0x367b61[_0xe1fbb0(0x19d)]=_0x1aecf6[_0xe1fbb0(0x19d)]||null);_0x1aecf6[_0xe1fbb0(0x110)]!==undefined&&(_0x367b61[_0xe1fbb0(0x110)]=_0x1aecf6['customerIp']||null);_0x1aecf6[_0xe1fbb0(0x11d)]!==undefined&&(_0x367b61[_0xe1fbb0(0x11d)]=_0x1aecf6[_0xe1fbb0(0x11d)]||null);const _0x195358=await database_1[_0xe1fbb0(0x14f)]['payment']['update']({'where':{'id':_0x51425b},'data':{..._0x367b61,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0xe1fbb0(0x1c5)]('✅\x20Customer\x20data\x20updated\x20for\x20payment\x20'+_0x51425b),console[_0xe1fbb0(0x1c5)](_0xe1fbb0(0x15e)+_0x177cbc[_0xe1fbb0(0x19d)]+_0xe1fbb0(0x10e)+_0x195358[_0xe1fbb0(0x19d)]),console[_0xe1fbb0(0x1c5)](_0xe1fbb0(0x178)+_0x177cbc[_0xe1fbb0(0x110)]+_0xe1fbb0(0x10e)+_0x195358['customerIp']),console[_0xe1fbb0(0x1c5)](_0xe1fbb0(0x104)+(_0x177cbc[_0xe1fbb0(0x11d)]?_0xe1fbb0(0x154):_0xe1fbb0(0x18d))+_0xe1fbb0(0x10e)+(_0x195358[_0xe1fbb0(0x11d)]?_0xe1fbb0(0x154):_0xe1fbb0(0x18d))),_0x195358;}async[a35_0x4c5d4c(0x180)](_0x36a9b7){const _0x16efe4=a35_0x4c5d4c,_0x51fb1c=new Date();let _0x507231;switch(_0x36a9b7){case'7d':_0x507231=new Date(_0x51fb1c[_0x16efe4(0x1a3)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x16efe4(0x1c8):_0x507231=new Date(_0x51fb1c[_0x16efe4(0x1a3)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x16efe4(0x164):_0x507231=new Date(_0x51fb1c[_0x16efe4(0x1a3)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x507231=new Date(_0x51fb1c[_0x16efe4(0x1a3)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x34269f,_0x1af7d7,_0x19a7fa,_0x9c3403,_0x82595f,_0xe31863]=await Promise[_0x16efe4(0x114)]([database_1[_0x16efe4(0x14f)][_0x16efe4(0x11e)][_0x16efe4(0x11f)](),database_1[_0x16efe4(0x14f)][_0x16efe4(0x11e)][_0x16efe4(0x11f)]({'where':{'status':_0x16efe4(0x140)}}),database_1[_0x16efe4(0x14f)][_0x16efe4(0x132)][_0x16efe4(0x11f)]({'where':{'createdAt':{'gte':_0x507231},'gateway':{'not':_0x16efe4(0x190)}}}),database_1[_0x16efe4(0x14f)]['payment'][_0x16efe4(0x11f)]({'where':{'status':_0x16efe4(0x145),'createdAt':{'gte':_0x507231},'gateway':{'not':'test_gateway'}}}),database_1[_0x16efe4(0x14f)][_0x16efe4(0x132)][_0x16efe4(0x10d)]({'where':{'status':_0x16efe4(0x145),'createdAt':{'gte':_0x507231},'gateway':{'not':_0x16efe4(0x190)}},'select':{'amount':!![],'currency':!![]}}),database_1[_0x16efe4(0x14f)]['payment'][_0x16efe4(0x10d)]({'where':{'gateway':{'not':_0x16efe4(0x190)}},'take':0xa,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}})]);let _0x6111d=0x0;for(const _0x344cd9 of _0x82595f){const _0x238446=await currencyService_1[_0x16efe4(0x1d5)]['convertToUSDT'](_0x344cd9[_0x16efe4(0x16c)],_0x344cd9[_0x16efe4(0x1a6)]);_0x6111d+=_0x238446;}const _0x301319=_0x19a7fa>0x0?_0x9c3403/_0x19a7fa*0x64:0x0;return{'totalShops':_0x34269f,'activeShops':_0x1af7d7,'totalPayments':_0x19a7fa,'successfulPayments':_0x9c3403,'totalRevenue':Math['round'](_0x6111d*0x64)/0x64,'conversionRate':Math[_0x16efe4(0x128)](_0x301319*0x64)/0x64,'recentPayments':_0xe31863['map'](_0x1b0475=>({'id':_0x1b0475['id'],'amount':_0x1b0475[_0x16efe4(0x16c)],'currency':_0x1b0475['currency'],'status':_0x1b0475['status'],'gateway':_0x1b0475[_0x16efe4(0x17d)],'shop':_0x1b0475[_0x16efe4(0x11e)],'createdAt':_0x1b0475['createdAt']}))};}async['getMerchantStatistics'](_0x4b0044){const _0x301e36=a35_0x4c5d4c;console['log'](_0x301e36(0x196),_0x4b0044);let _0x13d8b8,_0x594cfb=new Date();if(_0x4b0044[_0x301e36(0x1d0)]==='custom'&&_0x4b0044[_0x301e36(0x130)]&&_0x4b0044[_0x301e36(0x1d1)])_0x13d8b8=new Date(_0x4b0044[_0x301e36(0x130)]),_0x594cfb=new Date(_0x4b0044[_0x301e36(0x1d1)]);else{const _0x3d1316=new Date();switch(_0x4b0044['period']){case _0x301e36(0x1a2):_0x13d8b8=new Date(_0x3d1316[_0x301e36(0x1a3)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x301e36(0x1d6):_0x13d8b8=new Date(_0x3d1316[_0x301e36(0x1a3)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x301e36(0x142):_0x13d8b8=new Date(_0x3d1316[_0x301e36(0x1a3)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case'all':default:_0x13d8b8=new Date(_0x301e36(0x109));break;}}console[_0x301e36(0x1c5)](_0x301e36(0x1bb)+_0x13d8b8[_0x301e36(0x195)]()+_0x301e36(0x172)+_0x594cfb[_0x301e36(0x195)]());const _0x29cb12={'status':_0x301e36(0x145),'gateway':{'not':_0x301e36(0x190)},'paidAt':{'gte':_0x13d8b8,'lte':_0x594cfb}};_0x4b0044[_0x301e36(0x118)]&&(_0x29cb12[_0x301e36(0x118)]=_0x4b0044['shopId']);const _0x5ca4db=await database_1[_0x301e36(0x14f)][_0x301e36(0x132)]['findMany']({'where':_0x29cb12,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x301e36(0x1c5)]('💰\x20Found\x20'+_0x5ca4db[_0x301e36(0x1a8)]+'\x20paid\x20payments\x20for\x20analysis');let _0x33d21f=0x0,_0x58c9d6=0x0,_0x3ad531=0x0;const _0x5e203d={},_0x42769d={},_0x58aaf8={};for(const _0x2ed5d1 of _0x5ca4db){try{const _0x13e7e7=await currencyService_1[_0x301e36(0x1d5)][_0x301e36(0x146)](_0x2ed5d1[_0x301e36(0x16c)],_0x2ed5d1[_0x301e36(0x1a6)]);let _0x451381={};if(_0x2ed5d1[_0x301e36(0x11e)][_0x301e36(0x197)])try{_0x451381=JSON[_0x301e36(0x139)](_0x2ed5d1[_0x301e36(0x11e)][_0x301e36(0x197)]);}catch(_0x2d15c8){console['error'](_0x301e36(0x19b)+_0x2ed5d1[_0x301e36(0x118)]+':',_0x2d15c8);}const _0x51aadd=_0x451381['commission']||0xa,_0x42b80=_0x13e7e7*(_0x51aadd/0x64),_0x518737=_0x13e7e7-_0x42b80;_0x33d21f+=_0x13e7e7,_0x58c9d6+=_0x518737,_0x3ad531+=_0x42b80;!_0x5e203d[_0x2ed5d1['gateway']]&&(_0x5e203d[_0x2ed5d1[_0x301e36(0x17d)]]={'gateway':_0x2ed5d1[_0x301e36(0x17d)],'gatewayDisplayName':this[_0x301e36(0x1ab)](_0x2ed5d1[_0x301e36(0x17d)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x5e203d[_0x2ed5d1[_0x301e36(0x17d)]][_0x301e36(0x181)]++,_0x5e203d[_0x2ed5d1[_0x301e36(0x17d)]][_0x301e36(0x1ac)]+=_0x13e7e7,_0x5e203d[_0x2ed5d1[_0x301e36(0x17d)]][_0x301e36(0x15a)]+=_0x42b80,_0x5e203d[_0x2ed5d1['gateway']][_0x301e36(0x116)]+=_0x518737,_0x5e203d[_0x2ed5d1[_0x301e36(0x17d)]][_0x301e36(0x13b)]+=_0x51aadd;!_0x4b0044[_0x301e36(0x118)]&&(!_0x42769d[_0x2ed5d1[_0x301e36(0x118)]]&&(_0x42769d[_0x2ed5d1['shopId']]={'shopId':_0x2ed5d1[_0x301e36(0x118)],'shopName':_0x2ed5d1[_0x301e36(0x11e)][_0x301e36(0x1a7)],'shopUsername':_0x2ed5d1['shop'][_0x301e36(0x10c)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x42769d[_0x2ed5d1[_0x301e36(0x118)]][_0x301e36(0x181)]++,_0x42769d[_0x2ed5d1[_0x301e36(0x118)]]['turnoverUSDT']+=_0x13e7e7,_0x42769d[_0x2ed5d1[_0x301e36(0x118)]]['commissionUSDT']+=_0x42b80,_0x42769d[_0x2ed5d1[_0x301e36(0x118)]][_0x301e36(0x116)]+=_0x518737);const _0x5a6eff=_0x2ed5d1['paidAt'][_0x301e36(0x195)]()[_0x301e36(0x11b)]('T')[0x0];!_0x58aaf8[_0x5a6eff]&&(_0x58aaf8[_0x5a6eff]={'date':_0x5a6eff,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x58aaf8[_0x5a6eff][_0x301e36(0x1c0)]+=_0x13e7e7,_0x58aaf8[_0x5a6eff]['merchantEarnings']+=_0x518737,_0x58aaf8[_0x5a6eff][_0x301e36(0x111)]+=_0x42b80,_0x58aaf8[_0x5a6eff][_0x301e36(0x181)]++;}catch(_0x514cc7){console['error'](_0x301e36(0x1b0)+_0x2ed5d1['id']+':',_0x514cc7);}}Object['values'](_0x5e203d)[_0x301e36(0x1b3)](_0x214d32=>{const _0x3aad98=_0x301e36;_0x214d32['averageCommissionRate']=_0x214d32[_0x3aad98(0x181)]>0x0?_0x214d32['totalCommissionRate']/_0x214d32[_0x3aad98(0x181)]:0x0,delete _0x214d32[_0x3aad98(0x13b)];}),Object[_0x301e36(0x1b5)](_0x42769d)[_0x301e36(0x1b3)](_0x5da281=>{const _0x5a9e87=_0x301e36;_0x5da281[_0x5a9e87(0x1b9)]=_0x5da281['paymentsCount']>0x0?_0x5da281[_0x5a9e87(0x1ac)]/_0x5da281['paymentsCount']:0x0;});let _0x44074a=0x0;if(_0x4b0044[_0x301e36(0x118)]){const _0x14de80=await database_1[_0x301e36(0x14f)][_0x301e36(0x127)]['findMany']({'where':{'shopId':_0x4b0044[_0x301e36(0x118)],'status':_0x301e36(0x183),'createdAt':{'gte':_0x13d8b8,'lte':_0x594cfb}},'select':{'amount':!![]}});_0x44074a=_0x14de80[_0x301e36(0x10f)]((_0x105ab9,_0x17eb3f)=>_0x105ab9+_0x17eb3f[_0x301e36(0x16c)],0x0);}const _0x5de280=_0x5ca4db[_0x301e36(0x1a8)],_0x2d6e74=_0x5ca4db['length'],_0x4c8947=_0x5de280>0x0?_0x33d21f/_0x5de280:0x0,_0x27dacc=0x64,_0x4de5ec=Math['ceil']((_0x594cfb['getTime']()-_0x13d8b8[_0x301e36(0x1a3)]())/(0x3e8*0x3c*0x3c*0x18)),_0x1006ab={'totalTurnover':Math['round'](_0x33d21f*0x64)/0x64,'merchantEarnings':Math[_0x301e36(0x128)](_0x58c9d6*0x64)/0x64,'gatewayEarnings':Math[_0x301e36(0x128)](_0x3ad531*0x64)/0x64,'totalPaidOut':Math[_0x301e36(0x128)](_0x44074a*0x64)/0x64,'averageCheck':Math['round'](_0x4c8947*0x64)/0x64,'totalPayments':_0x5de280,'successfulPayments':_0x2d6e74,'conversionRate':_0x27dacc,'gatewayBreakdown':Object[_0x301e36(0x1b5)](_0x5e203d)[_0x301e36(0x113)](_0x50a95a=>({..._0x50a95a,'turnoverUSDT':Math[_0x301e36(0x128)](_0x50a95a[_0x301e36(0x1ac)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x50a95a[_0x301e36(0x15a)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x301e36(0x128)](_0x50a95a[_0x301e36(0x116)]*0x64)/0x64,'averageCommissionRate':Math['round'](_0x50a95a[_0x301e36(0x135)]*0x64)/0x64})),'merchantBreakdown':_0x4b0044[_0x301e36(0x118)]?undefined:Object[_0x301e36(0x1b5)](_0x42769d)[_0x301e36(0x113)](_0x2a7169=>({..._0x2a7169,'turnoverUSDT':Math['round'](_0x2a7169[_0x301e36(0x1ac)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x2a7169[_0x301e36(0x15a)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x301e36(0x128)](_0x2a7169['merchantEarningsUSDT']*0x64)/0x64,'paidOutUSDT':Math[_0x301e36(0x128)](_0x2a7169[_0x301e36(0x168)]*0x64)/0x64,'averageCheckUSDT':Math[_0x301e36(0x128)](_0x2a7169[_0x301e36(0x1b9)]*0x64)/0x64})),'dailyData':Object[_0x301e36(0x1b5)](_0x58aaf8)[_0x301e36(0x113)](_0x49cc80=>({..._0x49cc80,'turnover':Math[_0x301e36(0x128)](_0x49cc80[_0x301e36(0x1c0)]*0x64)/0x64,'merchantEarnings':Math[_0x301e36(0x128)](_0x49cc80[_0x301e36(0x103)]*0x64)/0x64,'gatewayEarnings':Math[_0x301e36(0x128)](_0x49cc80[_0x301e36(0x111)]*0x64)/0x64}))[_0x301e36(0x152)]((_0x107846,_0x82430a)=>_0x107846[_0x301e36(0x124)][_0x301e36(0x11c)](_0x82430a[_0x301e36(0x124)])),'periodInfo':{'from':_0x13d8b8,'to':_0x594cfb,'periodType':_0x4b0044[_0x301e36(0x1d0)]||_0x301e36(0x153),'daysCount':_0x4de5ec}};return console[_0x301e36(0x1c5)](_0x301e36(0x148)),console[_0x301e36(0x1c5)](_0x301e36(0x1bd)+_0x1006ab['totalTurnover']+_0x301e36(0x15c)),console[_0x301e36(0x1c5)](_0x301e36(0x138)+_0x1006ab[_0x301e36(0x103)]+_0x301e36(0x15c)),console[_0x301e36(0x1c5)](_0x301e36(0xfc)+_0x1006ab['gatewayEarnings']+_0x301e36(0x15c)),console[_0x301e36(0x1c5)](_0x301e36(0x12e)+_0x1006ab[_0x301e36(0x147)]),_0x1006ab;}[a35_0x4c5d4c(0x1ab)](_0xef4cdc){const _0x8ddecc=a35_0x4c5d4c,_0x4bc285={'test_gateway':_0x8ddecc(0x18e),'plisio':_0x8ddecc(0x137),'rapyd':_0x8ddecc(0x17e),'noda':_0x8ddecc(0x174),'cointopay':'CoinToPay','klyme_eu':_0x8ddecc(0x14a),'klyme_gb':_0x8ddecc(0x184),'klyme_de':'KLYME\x20DE'};return _0x4bc285[_0xef4cdc]||_0xef4cdc;}async[a35_0x4c5d4c(0x1a5)](_0x3d8533){const _0x88e9f1=a35_0x4c5d4c,{page:_0x28d983,limit:_0x44c8dc,minAmount:_0x30a263,search:_0x1c5e2c}=_0x3d8533,_0x43bbaa=(_0x28d983-0x1)*_0x44c8dc;console[_0x88e9f1(0x1c5)]('📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:',_0x3d8533);const _0xef13d={'balance':{'gt':0x0},'status':_0x88e9f1(0x140)};_0x30a263&&(_0xef13d[_0x88e9f1(0x170)]['gte']=_0x30a263);_0x1c5e2c&&(_0xef13d['OR']=[{'name':{'contains':_0x1c5e2c,'mode':_0x88e9f1(0x1ce)}},{'username':{'contains':_0x1c5e2c,'mode':_0x88e9f1(0x1ce)}}]);const [_0x509c35,_0x36275a]=await Promise[_0x88e9f1(0x114)]([database_1[_0x88e9f1(0x14f)]['shop'][_0x88e9f1(0x10d)]({'where':_0xef13d,'skip':_0x43bbaa,'take':_0x44c8dc,'orderBy':{'balance':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'createdAt':!![]}}),database_1['default'][_0x88e9f1(0x11e)][_0x88e9f1(0x11f)]({'where':_0xef13d})]);console[_0x88e9f1(0x1c5)](_0x88e9f1(0x194)+_0x509c35['length']+_0x88e9f1(0xf9));const _0x56a928=await Promise['all'](_0x509c35[_0x88e9f1(0x113)](async _0x1dadb1=>{const _0x19bff8=_0x88e9f1,[_0x2a1ee0,_0x381538,_0xd3ac2e]=await Promise['all']([database_1[_0x19bff8(0x14f)]['payment']['count']({'where':{'shopId':_0x1dadb1['id'],'status':_0x19bff8(0x145),'amountUSDT':{'not':null}}}),database_1[_0x19bff8(0x14f)][_0x19bff8(0x132)][_0x19bff8(0x151)]({'where':{'shopId':_0x1dadb1['id'],'status':_0x19bff8(0x145),'amountUSDT':{'not':null}},'orderBy':{'paidAt':_0x19bff8(0x1c3)},'select':{'paidAt':!![]}}),database_1['default']['payment'][_0x19bff8(0x17f)]({'by':['gateway'],'where':{'shopId':_0x1dadb1['id'],'status':_0x19bff8(0x145),'amountUSDT':{'not':null}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x462f72=_0xd3ac2e[_0x19bff8(0x113)](_0x2e969a=>({'gateway':_0x2e969a[_0x19bff8(0x17d)],'count':_0x2e969a[_0x19bff8(0x191)]['id'],'amountUSDT':_0x2e969a[_0x19bff8(0x14c)]['amountUSDT']||0x0,'amountAfterCommissionUSDT':_0x2e969a['_sum'][_0x19bff8(0x106)]||0x0,'commission':0x0}));return{'id':_0x1dadb1['id'],'fullName':_0x1dadb1['name'],'username':_0x1dadb1['username'],'telegramId':_0x1dadb1[_0x19bff8(0x115)],'merchantUrl':_0x1dadb1['shopUrl'],'wallets':{'usdtPolygonWallet':_0x1dadb1[_0x19bff8(0x1ca)],'usdtTrcWallet':_0x1dadb1['usdtTrcWallet'],'usdtErcWallet':_0x1dadb1[_0x19bff8(0x19e)],'usdcPolygonWallet':_0x1dadb1[_0x19bff8(0x16d)]},'totalAmountUSDT':_0x1dadb1[_0x19bff8(0x170)],'totalAmountAfterCommissionUSDT':_0x1dadb1[_0x19bff8(0x170)],'paymentsCount':_0x2a1ee0,'oldestPaymentDate':_0x381538?.[_0x19bff8(0xfe)]||_0x1dadb1[_0x19bff8(0x13a)],'gatewayBreakdown':_0x462f72};})),_0x5dca40=_0x509c35[_0x88e9f1(0x10f)]((_0x3341db,_0x28d1c3)=>_0x3341db+_0x28d1c3[_0x88e9f1(0x170)],0x0),_0x498da2=_0x5dca40;return console['log'](_0x88e9f1(0x199)+_0x36275a+'\x20merchants,\x20'+Math[_0x88e9f1(0x128)](_0x498da2*0x64)/0x64+'\x20USDT\x20total'),{'merchants':_0x56a928,'pagination':{'page':_0x28d983,'limit':_0x44c8dc,'total':_0x36275a,'totalPages':Math['ceil'](_0x36275a/_0x44c8dc)},'summary':{'totalMerchants':_0x36275a,'totalAmountUSDT':Math[_0x88e9f1(0x128)](_0x5dca40*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x88e9f1(0x128)](_0x498da2*0x64)/0x64}};}async[a35_0x4c5d4c(0x19c)](_0x1c3cf2){const _0x5df3a8=a35_0x4c5d4c,{shopId:_0x5cfc65,amount:_0x3b1b89,network:_0x348ce4,notes:_0x18dbc7,periodFrom:_0x54f494,periodTo:_0x381b0f}=_0x1c3cf2,_0x3a99cc=await database_1[_0x5df3a8(0x14f)][_0x5df3a8(0x101)](async _0x36c659=>{const _0x337ace=_0x5df3a8,_0x515f9b=await _0x36c659['shop'][_0x337ace(0x1d3)]({'where':{'id':_0x5cfc65},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x515f9b)throw new Error(_0x337ace(0x162));console['log']('💰\x20Creating\x20payout\x20for\x20shop\x20'+_0x515f9b[_0x337ace(0x10c)]+':'),console[_0x337ace(0x1c5)](_0x337ace(0x15f)+_0x515f9b[_0x337ace(0x170)][_0x337ace(0x1c1)](0x6)+_0x337ace(0x15c)),console[_0x337ace(0x1c5)](_0x337ace(0x133)+_0x3b1b89['toFixed'](0x6)+'\x20USDT'),console[_0x337ace(0x1c5)](_0x337ace(0x12b)+_0x515f9b[_0x337ace(0x16f)][_0x337ace(0x1c1)](0x6)+_0x337ace(0x15c));if(_0x515f9b[_0x337ace(0x170)]<_0x3b1b89)throw new Error(_0x337ace(0x14b)+_0x515f9b['balance'][_0x337ace(0x1c1)](0x6)+_0x337ace(0x12d)+_0x3b1b89['toFixed'](0x6)+'\x20USDT');const _0x208035=await _0x36c659[_0x337ace(0x127)][_0x337ace(0x150)]({'data':{'shopId':_0x5cfc65,'amount':_0x3b1b89,'network':_0x348ce4,'status':_0x337ace(0x183),'notes':_0x18dbc7,'periodFrom':_0x54f494?new Date(_0x54f494):null,'periodTo':_0x381b0f?new Date(_0x381b0f):null,'createdAt':new Date(),'paidAt':new Date()}}),_0xf15a45=_0x515f9b[_0x337ace(0x170)]-_0x3b1b89,_0x19c2a7=_0x515f9b['totalPaidOut']+_0x3b1b89;return await _0x36c659[_0x337ace(0x11e)]['update']({'where':{'id':_0x5cfc65},'data':{'balance':_0xf15a45,'totalPaidOut':_0x19c2a7}}),console[_0x337ace(0x1c5)]('💰\x20Shop\x20'+_0x515f9b[_0x337ace(0x10c)]+_0x337ace(0x1be)),console['log']('\x20\x20\x20Balance:\x20'+_0x515f9b[_0x337ace(0x170)][_0x337ace(0x1c1)](0x6)+_0x337ace(0x10e)+_0xf15a45[_0x337ace(0x1c1)](0x6)+_0x337ace(0x18a)+_0x3b1b89[_0x337ace(0x1c1)](0x6)+')'),console['log']('\x20\x20\x20Total\x20paid\x20out:\x20'+_0x515f9b[_0x337ace(0x16f)][_0x337ace(0x1c1)](0x6)+_0x337ace(0x10e)+_0x19c2a7[_0x337ace(0x1c1)](0x6)+'\x20USDT\x20(+'+_0x3b1b89['toFixed'](0x6)+')'),{'payout':_0x208035,'shop':_0x515f9b};});return console['log'](_0x5df3a8(0x149)+_0x3a99cc[_0x5df3a8(0x127)]['id']+_0x5df3a8(0x131)+_0x3a99cc[_0x5df3a8(0x11e)][_0x5df3a8(0x10c)]+'\x20('+_0x3b1b89+_0x5df3a8(0x1c4)),{'id':_0x3a99cc[_0x5df3a8(0x127)]['id'],'shopId':_0x3a99cc[_0x5df3a8(0x127)][_0x5df3a8(0x118)],'shopName':_0x3a99cc[_0x5df3a8(0x11e)][_0x5df3a8(0x1a7)],'shopUsername':_0x3a99cc['shop'][_0x5df3a8(0x10c)],'amount':_0x3a99cc[_0x5df3a8(0x127)]['amount'],'network':_0x3a99cc[_0x5df3a8(0x127)][_0x5df3a8(0x175)],'status':_0x3a99cc[_0x5df3a8(0x127)]['status'],'txid':_0x3a99cc[_0x5df3a8(0x127)][_0x5df3a8(0x19a)],'notes':_0x3a99cc[_0x5df3a8(0x127)][_0x5df3a8(0x14e)],'periodFrom':_0x3a99cc[_0x5df3a8(0x127)][_0x5df3a8(0x119)],'periodTo':_0x3a99cc['payout'][_0x5df3a8(0x17c)],'createdAt':_0x3a99cc['payout'][_0x5df3a8(0x13a)],'paidAt':_0x3a99cc[_0x5df3a8(0x127)]['paidAt']};}async[a35_0x4c5d4c(0x189)](_0x5a66be){const _0x531dc6=a35_0x4c5d4c,{page:_0x4c5163,limit:_0x44d2a0,shopId:_0x4c4ff8,network:_0x27c1bf,dateFrom:_0x169f7f,dateTo:_0x2c893a,search:_0x4cb446}=_0x5a66be,_0x43bd81=(_0x4c5163-0x1)*_0x44d2a0,_0x4b1804={};_0x4c4ff8&&(_0x4b1804['shopId']=_0x4c4ff8);_0x27c1bf&&(_0x4b1804[_0x531dc6(0x175)]=_0x27c1bf);(_0x169f7f||_0x2c893a)&&(_0x4b1804[_0x531dc6(0x13a)]={},_0x169f7f&&(_0x4b1804[_0x531dc6(0x13a)][_0x531dc6(0x187)]=new Date(_0x169f7f)),_0x2c893a&&(_0x4b1804[_0x531dc6(0x13a)][_0x531dc6(0x120)]=new Date(_0x2c893a)));_0x4cb446&&(_0x4b1804['OR']=[{'shop':{'name':{'contains':_0x4cb446,'mode':_0x531dc6(0x1ce)}}},{'shop':{'username':{'contains':_0x4cb446,'mode':_0x531dc6(0x1ce)}}},{'notes':{'contains':_0x4cb446,'mode':'insensitive'}}]);const [_0x378d11,_0x9a3261]=await Promise['all']([database_1['default'][_0x531dc6(0x127)][_0x531dc6(0x10d)]({'where':_0x4b1804,'skip':_0x43bd81,'take':_0x44d2a0,'orderBy':{'createdAt':_0x531dc6(0x13c)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x531dc6(0x127)][_0x531dc6(0x11f)]({'where':_0x4b1804})]);return{'payouts':_0x378d11['map'](_0xad6f00=>({'id':_0xad6f00['id'],'shopId':_0xad6f00[_0x531dc6(0x118)],'shopName':_0xad6f00[_0x531dc6(0x11e)][_0x531dc6(0x1a7)],'shopUsername':_0xad6f00[_0x531dc6(0x11e)][_0x531dc6(0x10c)],'amount':_0xad6f00[_0x531dc6(0x16c)],'network':_0xad6f00[_0x531dc6(0x175)],'status':_0xad6f00[_0x531dc6(0x15b)],'txid':_0xad6f00[_0x531dc6(0x19a)],'notes':_0xad6f00['notes'],'periodFrom':_0xad6f00[_0x531dc6(0x119)],'periodTo':_0xad6f00[_0x531dc6(0x17c)],'createdAt':_0xad6f00['createdAt'],'paidAt':_0xad6f00[_0x531dc6(0xfe)]})),'pagination':{'page':_0x4c5163,'limit':_0x44d2a0,'total':_0x9a3261,'totalPages':Math[_0x531dc6(0x100)](_0x9a3261/_0x44d2a0)}};}async[a35_0x4c5d4c(0x176)](_0x28cdbc){const _0x5a9c6a=a35_0x4c5d4c,_0x426708=await database_1[_0x5a9c6a(0x14f)][_0x5a9c6a(0x127)][_0x5a9c6a(0x1d3)]({'where':{'id':_0x28cdbc},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x426708)return null;return{'id':_0x426708['id'],'shopId':_0x426708[_0x5a9c6a(0x118)],'shopName':_0x426708[_0x5a9c6a(0x11e)][_0x5a9c6a(0x1a7)],'shopUsername':_0x426708[_0x5a9c6a(0x11e)][_0x5a9c6a(0x10c)],'amount':_0x426708['amount'],'network':_0x426708[_0x5a9c6a(0x175)],'status':_0x426708[_0x5a9c6a(0x15b)],'txid':_0x426708[_0x5a9c6a(0x19a)],'notes':_0x426708[_0x5a9c6a(0x14e)],'periodFrom':_0x426708[_0x5a9c6a(0x119)],'periodTo':_0x426708[_0x5a9c6a(0x17c)],'createdAt':_0x426708[_0x5a9c6a(0x13a)],'paidAt':_0x426708['paidAt']};}async[a35_0x4c5d4c(0x1bc)](_0x4a7028){const _0xa2f970=a35_0x4c5d4c;await database_1[_0xa2f970(0x14f)][_0xa2f970(0x127)][_0xa2f970(0x125)]({'where':{'id':_0x4a7028}});}async[a35_0x4c5d4c(0x1b4)](_0x9c8340){const _0x34f58b=a35_0x4c5d4c,{page:_0x5a8ebb,limit:_0xbe2901,status:_0x4d26b8,gateway:_0x30a78d,shopId:_0x3fc8c1,dateFrom:_0x33f200,dateTo:_0x26c570,search:_0x2ecaf8}=_0x9c8340,_0x4f0e74=(_0x5a8ebb-0x1)*_0xbe2901,_0x1b2229={};_0x4d26b8&&(_0x1b2229['status']=_0x4d26b8[_0x34f58b(0x1aa)]());_0x30a78d&&(_0x1b2229[_0x34f58b(0x17d)]=_0x30a78d[_0x34f58b(0x1a9)]());_0x1b2229['gateway']=_0x1b2229[_0x34f58b(0x17d)]?_0x1b2229[_0x34f58b(0x17d)]:{'not':'test_gateway'};if(typeof _0x1b2229[_0x34f58b(0x17d)]==='string'&&_0x1b2229[_0x34f58b(0x17d)]!==_0x34f58b(0x190)){}else{if(typeof _0x1b2229['gateway']===_0x34f58b(0x136)&&_0x1b2229['gateway']==='test_gateway'){}else _0x1b2229[_0x34f58b(0x17d)]={'not':_0x34f58b(0x190)};}_0x3fc8c1&&(_0x1b2229[_0x34f58b(0x118)]=_0x3fc8c1);(_0x33f200||_0x26c570)&&(_0x1b2229[_0x34f58b(0x13a)]={},_0x33f200&&(_0x1b2229[_0x34f58b(0x13a)][_0x34f58b(0x187)]=new Date(_0x33f200)),_0x26c570&&(_0x1b2229[_0x34f58b(0x13a)][_0x34f58b(0x120)]=new Date(_0x26c570)));_0x2ecaf8&&(_0x1b2229['OR']=[{'orderId':{'contains':_0x2ecaf8,'mode':_0x34f58b(0x1ce)}},{'gatewayOrderId':{'contains':_0x2ecaf8,'mode':_0x34f58b(0x1ce)}},{'customerEmail':{'contains':_0x2ecaf8,'mode':_0x34f58b(0x1ce)}},{'shop':{'name':{'contains':_0x2ecaf8,'mode':_0x34f58b(0x1ce)}}},{'shop':{'username':{'contains':_0x2ecaf8,'mode':_0x34f58b(0x1ce)}}}]);const [_0x2248e7,_0x267a80]=await Promise['all']([database_1[_0x34f58b(0x14f)][_0x34f58b(0x132)]['findMany']({'where':_0x1b2229,'skip':_0x4f0e74,'take':_0xbe2901,'orderBy':{'createdAt':_0x34f58b(0x13c)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x34f58b(0x132)][_0x34f58b(0x11f)]({'where':_0x1b2229})]);return{'payments':_0x2248e7['map'](_0x248a70=>({'id':_0x248a70['id'],'shopId':_0x248a70['shopId'],'gateway':_0x248a70[_0x34f58b(0x17d)],'amount':_0x248a70[_0x34f58b(0x16c)],'currency':_0x248a70[_0x34f58b(0x1a6)],'status':_0x248a70[_0x34f58b(0x15b)],'orderId':_0x248a70[_0x34f58b(0x1cd)],'gatewayOrderId':_0x248a70[_0x34f58b(0x188)],'customerEmail':_0x248a70[_0x34f58b(0x19f)],'customerName':_0x248a70[_0x34f58b(0x156)],'customerCountry':_0x248a70[_0x34f58b(0x19d)],'customerIp':_0x248a70[_0x34f58b(0x110)],'customerUa':_0x248a70['customerUa'],'failureMessage':_0x248a70[_0x34f58b(0x173)],'createdAt':_0x248a70[_0x34f58b(0x13a)],'updatedAt':_0x248a70['updatedAt'],'shop':_0x248a70[_0x34f58b(0x11e)]})),'pagination':{'page':_0x5a8ebb,'limit':_0xbe2901,'total':_0x267a80,'totalPages':Math[_0x34f58b(0x100)](_0x267a80/_0xbe2901)}};}async[a35_0x4c5d4c(0x1b7)](_0x3f5311){const _0x6587cb=a35_0x4c5d4c,_0x4560e6=await database_1['default'][_0x6587cb(0x132)][_0x6587cb(0x1d3)]({'where':{'id':_0x3f5311},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x4560e6)return null;return{'id':_0x4560e6['id'],'shopId':_0x4560e6[_0x6587cb(0x118)],'gateway':_0x4560e6['gateway'],'amount':_0x4560e6[_0x6587cb(0x16c)],'currency':_0x4560e6[_0x6587cb(0x1a6)],'status':_0x4560e6[_0x6587cb(0x15b)],'orderId':_0x4560e6[_0x6587cb(0x1cd)],'gatewayOrderId':_0x4560e6['gatewayOrderId'],'customerEmail':_0x4560e6[_0x6587cb(0x19f)],'customerName':_0x4560e6[_0x6587cb(0x156)],'customerCountry':_0x4560e6['customerCountry'],'customerIp':_0x4560e6[_0x6587cb(0x110)],'customerUa':_0x4560e6[_0x6587cb(0x11d)],'failureMessage':_0x4560e6['failureMessage'],'externalPaymentUrl':_0x4560e6[_0x6587cb(0x1ad)],'successUrl':_0x4560e6[_0x6587cb(0x17b)],'failUrl':_0x4560e6[_0x6587cb(0x1ae)],'pendingUrl':_0x4560e6['pendingUrl'],'whiteUrl':_0x4560e6[_0x6587cb(0x134)],'createdAt':_0x4560e6[_0x6587cb(0x13a)],'updatedAt':_0x4560e6['updatedAt'],'shop':_0x4560e6[_0x6587cb(0x11e)]};}async[a35_0x4c5d4c(0x105)](_0xa47f76,_0x356b0c,_0x2e8617,_0x3e44eb){const _0x3a0a7a=a35_0x4c5d4c,_0x299b2b=await database_1[_0x3a0a7a(0x14f)][_0x3a0a7a(0x101)](async _0x4a0b6f=>{const _0x4bd0b8=_0x3a0a7a,_0x3729ea=await _0x4a0b6f[_0x4bd0b8(0x132)][_0x4bd0b8(0x1d3)]({'where':{'id':_0xa47f76},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x3729ea)throw new Error(_0x4bd0b8(0x1b1));const _0x28c36b=_0x3729ea[_0x4bd0b8(0x15b)],_0x3569d8=_0x356b0c[_0x4bd0b8(0x1aa)]();console[_0x4bd0b8(0x1c5)](_0x4bd0b8(0x1b2)+_0xa47f76+_0x4bd0b8(0x1a0)+_0x28c36b+_0x4bd0b8(0x10e)+_0x3569d8),console[_0x4bd0b8(0x1c5)](_0x4bd0b8(0x182)+_0x3729ea[_0x4bd0b8(0x11e)][_0x4bd0b8(0x170)]+'\x20USDT');const _0x52b194={'status':_0x3569d8,'updatedAt':new Date(),'statusChangedBy':_0x4bd0b8(0x193),'statusChangedAt':new Date()};_0x2e8617&&(_0x52b194[_0x4bd0b8(0x1cc)]=_0x2e8617);_0x3569d8===_0x4bd0b8(0x123)&&_0x3e44eb&&(_0x52b194[_0x4bd0b8(0x126)]=_0x3e44eb);let _0x5d6b63=0x0,_0x590032=_0x3729ea['shop']['balance'];if(_0x3569d8==='PAID'&&_0x28c36b!==_0x4bd0b8(0x145)){_0x52b194[_0x4bd0b8(0xfe)]=new Date();const _0x4b5c15=await currencyService_1[_0x4bd0b8(0x1d5)][_0x4bd0b8(0x146)](_0x3729ea['amount'],_0x3729ea[_0x4bd0b8(0x1a6)]);_0x52b194['amountUSDT']=_0x4b5c15,_0x5d6b63=_0x4b5c15,_0x590032+=_0x4b5c15,console[_0x4bd0b8(0x1c5)]('💰\x20Payment\x20'+_0xa47f76+_0x4bd0b8(0x1bf)+_0x4b5c15[_0x4bd0b8(0x1c1)](0x6)+_0x4bd0b8(0x143));}else _0x28c36b===_0x4bd0b8(0x145)&&_0x3569d8!==_0x4bd0b8(0x145)&&(_0x3729ea[_0x4bd0b8(0x106)]&&(_0x5d6b63=-_0x3729ea[_0x4bd0b8(0x106)],_0x590032-=_0x3729ea[_0x4bd0b8(0x106)],_0x52b194['amountUSDT']=null,console[_0x4bd0b8(0x1c5)](_0x4bd0b8(0x107)+_0xa47f76+_0x4bd0b8(0x1cf)+_0x3729ea[_0x4bd0b8(0x106)]['toFixed'](0x6)+_0x4bd0b8(0x159))));if(_0x3569d8==='CHARGEBACK'){if(_0x28c36b===_0x4bd0b8(0x145)&&_0x3729ea[_0x4bd0b8(0x106)]){}_0x3e44eb&&_0x3e44eb>0x0&&(_0x5d6b63-=_0x3e44eb,_0x590032-=_0x3e44eb,console[_0x4bd0b8(0x1c5)](_0x4bd0b8(0x160)+_0x3e44eb[_0x4bd0b8(0x1c1)](0x6)+_0x4bd0b8(0x159)));}_0x3569d8===_0x4bd0b8(0x171)&&_0x28c36b===_0x4bd0b8(0x145)&&console[_0x4bd0b8(0x1c5)](_0x4bd0b8(0x144));const _0x36783c=await _0x4a0b6f[_0x4bd0b8(0x132)]['update']({'where':{'id':_0xa47f76},'data':_0x52b194,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x5d6b63!==0x0&&(await _0x4a0b6f[_0x4bd0b8(0x11e)][_0x4bd0b8(0x18f)]({'where':{'id':_0x3729ea['shopId']},'data':{'balance':_0x590032}}),console[_0x4bd0b8(0x1c5)](_0x4bd0b8(0x1cb)+_0x3729ea[_0x4bd0b8(0x118)]+_0x4bd0b8(0x10b)+_0x3729ea[_0x4bd0b8(0x11e)][_0x4bd0b8(0x170)][_0x4bd0b8(0x1c1)](0x6)+_0x4bd0b8(0x10e)+_0x590032['toFixed'](0x6)+_0x4bd0b8(0x14d)+(_0x5d6b63>0x0?'+':'')+_0x5d6b63[_0x4bd0b8(0x1c1)](0x6)+')')),_0x36783c;});return{'id':_0x299b2b['id'],'shopId':_0x299b2b[_0x3a0a7a(0x118)],'gateway':_0x299b2b[_0x3a0a7a(0x17d)],'amount':_0x299b2b[_0x3a0a7a(0x16c)],'currency':_0x299b2b[_0x3a0a7a(0x1a6)],'status':_0x299b2b['status'],'orderId':_0x299b2b[_0x3a0a7a(0x1cd)],'gatewayOrderId':_0x299b2b[_0x3a0a7a(0x188)],'customerEmail':_0x299b2b[_0x3a0a7a(0x19f)],'customerName':_0x299b2b[_0x3a0a7a(0x156)],'customerCountry':_0x299b2b[_0x3a0a7a(0x19d)],'customerIp':_0x299b2b[_0x3a0a7a(0x110)],'customerUa':_0x299b2b['customerUa'],'failureMessage':_0x299b2b['failureMessage'],'adminNotes':_0x299b2b[_0x3a0a7a(0x1cc)],'chargebackAmount':_0x299b2b[_0x3a0a7a(0x126)],'statusChangedBy':_0x299b2b[_0x3a0a7a(0x12f)],'statusChangedAt':_0x299b2b['statusChangedAt'],'createdAt':_0x299b2b['createdAt'],'updatedAt':_0x299b2b[_0x3a0a7a(0x13f)],'shop':_0x299b2b[_0x3a0a7a(0x11e)]};}async[a35_0x4c5d4c(0x1d7)](_0xfb66ac,_0x4dc385){const _0x2a9c1e=a35_0x4c5d4c,_0x7435b3={..._0x4dc385};_0x4dc385[_0x2a9c1e(0x198)]&&(_0x7435b3[_0x2a9c1e(0x198)]=await bcryptjs_1[_0x2a9c1e(0x14f)][_0x2a9c1e(0x10a)](_0x4dc385[_0x2a9c1e(0x198)],0xc));_0x4dc385[_0x2a9c1e(0x16b)]&&(_0x7435b3[_0x2a9c1e(0x1a7)]=_0x4dc385[_0x2a9c1e(0x16b)],delete _0x7435b3[_0x2a9c1e(0x16b)]);_0x4dc385['telegramId']&&(_0x7435b3['telegram']=_0x4dc385[_0x2a9c1e(0x155)],delete _0x7435b3[_0x2a9c1e(0x155)]);_0x4dc385[_0x2a9c1e(0x1ba)]&&(_0x7435b3[_0x2a9c1e(0x141)]=_0x4dc385[_0x2a9c1e(0x1ba)],delete _0x7435b3['merchantUrl']);_0x4dc385[_0x2a9c1e(0x108)]&&(_0x7435b3[_0x2a9c1e(0xff)]=JSON['stringify'](_0x4dc385[_0x2a9c1e(0x108)]),delete _0x7435b3[_0x2a9c1e(0x108)]);_0x4dc385[_0x2a9c1e(0x197)]&&(_0x7435b3['gatewaySettings']=JSON[_0x2a9c1e(0x192)](_0x4dc385[_0x2a9c1e(0x197)]),delete _0x7435b3['gatewaySettings']);_0x4dc385[_0x2a9c1e(0x169)]&&(_0x4dc385[_0x2a9c1e(0x169)][_0x2a9c1e(0x1ca)]!==undefined&&(_0x7435b3[_0x2a9c1e(0x1ca)]=_0x4dc385['wallets']['usdtPolygonWallet']||null),_0x4dc385[_0x2a9c1e(0x169)][_0x2a9c1e(0x1af)]!==undefined&&(_0x7435b3[_0x2a9c1e(0x1af)]=_0x4dc385[_0x2a9c1e(0x169)][_0x2a9c1e(0x1af)]||null),_0x4dc385[_0x2a9c1e(0x169)]['usdtErcWallet']!==undefined&&(_0x7435b3[_0x2a9c1e(0x19e)]=_0x4dc385[_0x2a9c1e(0x169)][_0x2a9c1e(0x19e)]||null),_0x4dc385[_0x2a9c1e(0x169)][_0x2a9c1e(0x16d)]!==undefined&&(_0x7435b3[_0x2a9c1e(0x16d)]=_0x4dc385['wallets']['usdcPolygonWallet']||null),delete _0x7435b3['wallets']);const _0x59fc14=await database_1[_0x2a9c1e(0x14f)][_0x2a9c1e(0x11e)][_0x2a9c1e(0x18f)]({'where':{'id':_0xfb66ac},'data':_0x7435b3,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x59fc14['id'],'fullName':_0x59fc14[_0x2a9c1e(0x1a7)],'username':_0x59fc14[_0x2a9c1e(0x10c)],'telegramId':_0x59fc14['telegram'],'merchantUrl':_0x59fc14['shopUrl'],'gateways':_0x59fc14[_0x2a9c1e(0xff)]?JSON['parse'](_0x59fc14['paymentGateways']):null,'gatewaySettings':_0x59fc14[_0x2a9c1e(0x197)]?JSON[_0x2a9c1e(0x139)](_0x59fc14['gatewaySettings']):null,'publicKey':_0x59fc14[_0x2a9c1e(0x18b)],'wallets':{'usdtPolygonWallet':_0x59fc14[_0x2a9c1e(0x1ca)],'usdtTrcWallet':_0x59fc14[_0x2a9c1e(0x1af)],'usdtErcWallet':_0x59fc14[_0x2a9c1e(0x19e)],'usdcPolygonWallet':_0x59fc14['usdcPolygonWallet']},'status':_0x59fc14[_0x2a9c1e(0x15b)],'createdAt':_0x59fc14[_0x2a9c1e(0x13a)]};}async[a35_0x4c5d4c(0x1c6)](_0x47a20e){const _0x3fdbae=a35_0x4c5d4c,_0x260683=await database_1['default'][_0x3fdbae(0x11e)][_0x3fdbae(0x18f)]({'where':{'id':_0x47a20e},'data':{'status':_0x3fdbae(0x122)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x260683['id'],'fullName':_0x260683[_0x3fdbae(0x1a7)],'username':_0x260683['username'],'telegramId':_0x260683[_0x3fdbae(0x115)],'merchantUrl':_0x260683[_0x3fdbae(0x141)],'gateways':_0x260683[_0x3fdbae(0xff)]?JSON[_0x3fdbae(0x139)](_0x260683['paymentGateways']):null,'gatewaySettings':_0x260683[_0x3fdbae(0x197)]?JSON[_0x3fdbae(0x139)](_0x260683[_0x3fdbae(0x197)]):null,'publicKey':_0x260683[_0x3fdbae(0x18b)],'wallets':{'usdtPolygonWallet':_0x260683[_0x3fdbae(0x1ca)],'usdtTrcWallet':_0x260683[_0x3fdbae(0x1af)],'usdtErcWallet':_0x260683['usdtErcWallet'],'usdcPolygonWallet':_0x260683[_0x3fdbae(0x16d)]},'status':_0x260683['status'],'createdAt':_0x260683['createdAt']};}async[a35_0x4c5d4c(0xfa)](_0x611d68){const _0x20a391=a35_0x4c5d4c,_0x140b76=await database_1[_0x20a391(0x14f)][_0x20a391(0x11e)][_0x20a391(0x18f)]({'where':{'id':_0x611d68},'data':{'status':_0x20a391(0x140)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x140b76['id'],'fullName':_0x140b76[_0x20a391(0x1a7)],'username':_0x140b76[_0x20a391(0x10c)],'telegramId':_0x140b76['telegram'],'merchantUrl':_0x140b76['shopUrl'],'gateways':_0x140b76[_0x20a391(0xff)]?JSON[_0x20a391(0x139)](_0x140b76[_0x20a391(0xff)]):null,'gatewaySettings':_0x140b76['gatewaySettings']?JSON[_0x20a391(0x139)](_0x140b76[_0x20a391(0x197)]):null,'publicKey':_0x140b76[_0x20a391(0x18b)],'wallets':{'usdtPolygonWallet':_0x140b76[_0x20a391(0x1ca)],'usdtTrcWallet':_0x140b76[_0x20a391(0x1af)],'usdtErcWallet':_0x140b76[_0x20a391(0x19e)],'usdcPolygonWallet':_0x140b76[_0x20a391(0x16d)]},'status':_0x140b76[_0x20a391(0x15b)],'createdAt':_0x140b76['createdAt']};}async[a35_0x4c5d4c(0x186)](_0x501764){const _0x84bab3=a35_0x4c5d4c,{page:_0x1bcc44,limit:_0x1dc9bc,status:_0x23a040}=_0x501764,_0x2ce4b5=(_0x1bcc44-0x1)*_0x1dc9bc,_0x53549b={};_0x23a040&&(_0x53549b[_0x84bab3(0x15b)]=_0x23a040[_0x84bab3(0x1aa)]());const [_0x1dfaee,_0x2fafa2]=await Promise[_0x84bab3(0x114)]([database_1[_0x84bab3(0x14f)][_0x84bab3(0x11e)][_0x84bab3(0x10d)]({'where':_0x53549b,'skip':_0x2ce4b5,'take':_0x1dc9bc,'orderBy':{'createdAt':_0x84bab3(0x13c)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x84bab3(0x14f)][_0x84bab3(0x11e)][_0x84bab3(0x11f)]({'where':_0x53549b})]);return{'users':_0x1dfaee[_0x84bab3(0x113)](_0x56feed=>({'id':_0x56feed['id'],'fullName':_0x56feed['name'],'username':_0x56feed[_0x84bab3(0x10c)],'telegramId':_0x56feed[_0x84bab3(0x115)],'merchantUrl':_0x56feed[_0x84bab3(0x141)],'gateways':_0x56feed[_0x84bab3(0xff)]?JSON['parse'](_0x56feed['paymentGateways']):null,'gatewaySettings':_0x56feed['gatewaySettings']?JSON[_0x84bab3(0x139)](_0x56feed['gatewaySettings']):null,'publicKey':_0x56feed[_0x84bab3(0x18b)],'wallets':{'usdtPolygonWallet':_0x56feed['usdtPolygonWallet'],'usdtTrcWallet':_0x56feed[_0x84bab3(0x1af)],'usdtErcWallet':_0x56feed[_0x84bab3(0x19e)],'usdcPolygonWallet':_0x56feed['usdcPolygonWallet']},'status':_0x56feed[_0x84bab3(0x15b)],'createdAt':_0x56feed[_0x84bab3(0x13a)]})),'pagination':{'page':_0x1bcc44,'limit':_0x1dc9bc,'total':_0x2fafa2,'totalPages':Math[_0x84bab3(0x100)](_0x2fafa2/_0x1dc9bc)}};}async[a35_0x4c5d4c(0x163)](_0x12292c){const _0x216634=a35_0x4c5d4c,_0x2ba69d=await database_1['default'][_0x216634(0x11e)]['findUnique']({'where':{'id':_0x12292c},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x2ba69d)return null;return{'id':_0x2ba69d['id'],'fullName':_0x2ba69d[_0x216634(0x1a7)],'username':_0x2ba69d[_0x216634(0x10c)],'telegramId':_0x2ba69d[_0x216634(0x115)],'merchantUrl':_0x2ba69d[_0x216634(0x141)],'gateways':_0x2ba69d['paymentGateways']?JSON[_0x216634(0x139)](_0x2ba69d[_0x216634(0xff)]):null,'gatewaySettings':_0x2ba69d[_0x216634(0x197)]?JSON['parse'](_0x2ba69d[_0x216634(0x197)]):null,'publicKey':_0x2ba69d[_0x216634(0x18b)],'wallets':{'usdtPolygonWallet':_0x2ba69d['usdtPolygonWallet'],'usdtTrcWallet':_0x2ba69d[_0x216634(0x1af)],'usdtErcWallet':_0x2ba69d['usdtErcWallet'],'usdcPolygonWallet':_0x2ba69d[_0x216634(0x16d)]},'status':_0x2ba69d['status'],'createdAt':_0x2ba69d[_0x216634(0x13a)]};}async[a35_0x4c5d4c(0x11a)](_0x2c3d1f){const _0x1b48d9=a35_0x4c5d4c,{fullName:_0xfb1ddd,username:_0x232003,password:_0x42282f,telegramId:_0x4528a8,merchantUrl:_0x593cde,gateways:_0x4b7431,gatewaySettings:_0x3e2a44,wallets:_0x7b5f70}=_0x2c3d1f,_0x307499=await database_1[_0x1b48d9(0x14f)]['shop'][_0x1b48d9(0x1d3)]({'where':{'username':_0x232003}});if(_0x307499)throw new Error(_0x1b48d9(0x12a));if(_0x4528a8){const _0x47c7e5=await database_1['default'][_0x1b48d9(0x11e)]['findUnique']({'where':{'telegram':_0x4528a8}});if(_0x47c7e5)throw new Error('Telegram\x20username\x20already\x20exists');}const _0x203a83=await bcryptjs_1['default'][_0x1b48d9(0x10a)](_0x42282f,0xc),_0x7fd220=_0x1b48d9(0x158)+crypto_1['default'][_0x1b48d9(0x1c7)](0x20)[_0x1b48d9(0x1c2)](_0x1b48d9(0x161)),_0x1d0af8='sk_'+crypto_1[_0x1b48d9(0x14f)][_0x1b48d9(0x1c7)](0x20)[_0x1b48d9(0x1c2)](_0x1b48d9(0x161)),_0x2e221d=await database_1[_0x1b48d9(0x14f)][_0x1b48d9(0x11e)]['create']({'data':{'name':_0xfb1ddd,'username':_0x232003,'password':_0x203a83,'telegram':_0x4528a8,'shopUrl':_0x593cde,'paymentGateways':_0x4b7431?JSON[_0x1b48d9(0x192)](_0x4b7431):null,'gatewaySettings':_0x3e2a44?JSON[_0x1b48d9(0x192)](_0x3e2a44):null,'usdtPolygonWallet':_0x7b5f70?.[_0x1b48d9(0x1ca)]||null,'usdtTrcWallet':_0x7b5f70?.[_0x1b48d9(0x1af)]||null,'usdtErcWallet':_0x7b5f70?.[_0x1b48d9(0x19e)]||null,'usdcPolygonWallet':_0x7b5f70?.[_0x1b48d9(0x16d)]||null,'publicKey':_0x7fd220,'secretKey':_0x1d0af8,'status':_0x1b48d9(0x140)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2e221d['id'],'fullName':_0x2e221d[_0x1b48d9(0x1a7)],'username':_0x2e221d[_0x1b48d9(0x10c)],'telegramId':_0x2e221d['telegram'],'merchantUrl':_0x2e221d[_0x1b48d9(0x141)],'gateways':_0x2e221d[_0x1b48d9(0xff)]?JSON[_0x1b48d9(0x139)](_0x2e221d['paymentGateways']):null,'gatewaySettings':_0x2e221d['gatewaySettings']?JSON[_0x1b48d9(0x139)](_0x2e221d[_0x1b48d9(0x197)]):null,'publicKey':_0x2e221d[_0x1b48d9(0x18b)],'wallets':{'usdtPolygonWallet':_0x2e221d[_0x1b48d9(0x1ca)],'usdtTrcWallet':_0x2e221d[_0x1b48d9(0x1af)],'usdtErcWallet':_0x2e221d[_0x1b48d9(0x19e)],'usdcPolygonWallet':_0x2e221d[_0x1b48d9(0x16d)]},'status':_0x2e221d[_0x1b48d9(0x15b)],'createdAt':_0x2e221d['createdAt']};}async[a35_0x4c5d4c(0x1b8)](_0x1826bb){const _0x1f7cfd=a35_0x4c5d4c;await database_1['default'][_0x1f7cfd(0x11e)][_0x1f7cfd(0x125)]({'where':{'id':_0x1826bb}});}}exports[a35_0x4c5d4c(0x166)]=AdminService;