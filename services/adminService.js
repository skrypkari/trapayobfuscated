'use strict';function a48_0x1a35(_0xb6cae4,_0x586013){_0xb6cae4=_0xb6cae4-0x1e2;const _0x4f87ff=a48_0x4f87();let _0x1a3589=_0x4f87ff[_0xb6cae4];return _0x1a3589;}const a48_0xf5dcd9=a48_0x1a35;(function(_0x1045f7,_0x127cf4){const _0x1df4a6=a48_0x1a35,_0x5c39b6=_0x1045f7();while(!![]){try{const _0x39d658=parseInt(_0x1df4a6(0x2f1))/0x1+parseInt(_0x1df4a6(0x239))/0x2*(parseInt(_0x1df4a6(0x202))/0x3)+-parseInt(_0x1df4a6(0x293))/0x4+parseInt(_0x1df4a6(0x234))/0x5+-parseInt(_0x1df4a6(0x2b2))/0x6*(-parseInt(_0x1df4a6(0x2cd))/0x7)+-parseInt(_0x1df4a6(0x30b))/0x8*(-parseInt(_0x1df4a6(0x25a))/0x9)+parseInt(_0x1df4a6(0x1e6))/0xa*(-parseInt(_0x1df4a6(0x240))/0xb);if(_0x39d658===_0x127cf4)break;else _0x5c39b6['push'](_0x5c39b6['shift']());}catch(_0x519c1a){_0x5c39b6['push'](_0x5c39b6['shift']());}}}(a48_0x4f87,0x6dd6b));var __importDefault=this&&this[a48_0xf5dcd9(0x2c8)]||function(_0xcf0ca){return _0xcf0ca&&_0xcf0ca['__esModule']?_0xcf0ca:{'default':_0xcf0ca};};Object[a48_0xf5dcd9(0x2ee)](exports,'__esModule',{'value':!![]}),exports[a48_0xf5dcd9(0x32d)]=void 0x0;const database_1=__importDefault(require(a48_0xf5dcd9(0x1f3))),bcryptjs_1=__importDefault(require(a48_0xf5dcd9(0x2bd))),crypto_1=__importDefault(require(a48_0xf5dcd9(0x33e))),speakeasy_1=__importDefault(require(a48_0xf5dcd9(0x279))),qrcode_1=__importDefault(require('qrcode')),currencyService_1=require(a48_0xf5dcd9(0x27e)),telegramBotService_1=require(a48_0xf5dcd9(0x348)),gateway_1=require('../types/gateway');function a48_0x4f87(){const _0x53b663=['wallet','amountAfterCommissionUSDT','not\x20specified','\x20paid\x20payments\x20for\x20analysis','Shop\x20not\x20found','CoinToPay','\x20\x20\x20ðŸ–¥ï¸\x20User\x20Agent:\x20','statusChangedBy','ðŸŽ¯\x20[','ðŸ’°\x20Current\x20shop\x20balance:\x20','toString','telegram','stringify','Error\x20processing\x20payment\x20','\x20\x20\x20Merchant\x20loses:\x20','entries','toFixed','ðŸ”\x20Balance\x20check\x20details:','amountAfterGatewayCommissionUSDT','defineProperty','\x20became\x20PAID:','âœ…\x20Payout\x20created:\x20','52805gcKQSU','\x20USDT\x20(gross\x20revenue)','gatewayEarnings','ðŸ”„\x20Gateway\x20mapping\x20(get):','chargebackAmount','includes','totalAmountAfterCommissionUSDT','\x20\x20\x20ðŸ’°\x20Total\x20payout:\x20','txid',',\x20Commission:\x20','AmPay','publicKey','\x20USDT\x20(after\x20','UTC','ðŸ”\x202FA\x20setup\x20initiated\x20for\x20shop:\x20','\x20\x20\x20Available\x20(raw):\x20','length','disable2FA','ðŸ’³\x20Final\x20payout\x20wallet\x20for\x20','abs','generateSecret','failureMessage','\x20USDT\x20-\x20will\x20deduct\x20from\x20balance','today','localeCompare','COMPLETED','6240328qGNCxa','network','\x20PAID\x20payments',',\x20userId:\x20','\x20USDT,\x20Difference:\x20','groupBy','Noda','wallets','merchantEarnings','setup2FA','generateBackupCodes','ðŸ“Š\x20Sorting\x20payments\x20by\x20','ðŸ“‹\x20Getting\x20merchants\x20selection\x20list...','enable2FA','month','replace','yesterday','gte','ceil','getGatewayInternalName','\x20USDT\x20(current\x20balance\x20in\x20DB)','\x27\x20->\x20name\x20\x27','getPaymentById','\x20\x20\x20âœ…\x20Total\x20net\x20balances:\x20','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','ðŸ”\x20No\x20wallet\x20provided,\x20looking\x20up\x20from\x20shop\x20settings...','$transaction','notes','toDataURL','gatewayCommissionRate','this_month','custom','\x20\x20\x20ðŸŒ\x20Country:\x20','some','AdminService','ACTIVE','ðŸ“±\x20Telegram\x20notification\x20sent\x20for\x20payout\x20',']\x20Gateway\x20settings\x20JSON\x20string:','updatedAt','ðŸ”\x20Total\x20payments\x20matching\x20filters:\x20','\x20\x20\x20ðŸŒ\x20IP:\x20','\x20\x20\x20Full\x20amount:\x20','all_time','\x20\x20\x20Merchant\x20gets:\x20','EXPIRED','\x20USDT','\x20to\x20','\x20merchants\x20with\x20rounded\x20balance\x20!=\x200.00\x20(excluding\x20balances\x20that\x20round\x20to\x200.00)','trc20','dailyRevenue','username','crypto','ðŸ“Š\x20Merchant\x20statistics\x20calculated:','\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...','ðŸ“Š\x20Getting\x20payments\x20with\x20filters:','\x20\x20\x20âœ…\x20Actual\x20available\x20balance:\x20','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','periodTo','averageCommissionRate','turnover','erc20_usdc','./telegramBotService','filter','getSystemStatistics','ðŸ”\x20Selected\x20polygon\x20wallet:\x20','getMerchantStatistics','\x20\x20\x20Tolerance:\x20','warn','%\x20commission)',':\x20commission\x20=\x20','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','usdtErcWallet','\x20USDT\x20(+','\x20\x20\x20Total\x20paid\x20out:\x20','2020-01-01','commission','usdcErcWallet','\x20\x20\x20Payout\x20amount:\x20','ru-RU','getMerchantsAwaitingPayout','sort','\x20\x20\x20Amount\x20difference:\x20','ðŸ’°\x20Payment\x20amount\x20is\x20NOT\x20deducted\x20(chargeback\x20penalty\x20only)','awaitingPayout','ðŸ“Š\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','successUrl','ðŸ“Š\x20Calculating\x20payout\x20statistics...','getUTCFullYear','usdtPolygonWallet','Payout\x20not\x20found','payout','ðŸ’°\x20Updating\x20payout\x20','\x20balance\x20updated:','ðŸ”\x20Selected\x20trc20\x20wallet:\x20','gatewayOrderId','last_month','OnRamp','map','\x20\x20\x20Current\x20network:\x20','usdtTrcWallet','turnoverUSDT','slice','not\x20set','toISOString','\x20updated\x20successfully','balance','dateTo','\x20payments)','erc20','dailyPayments',']\x20Updating\x20password\x20for\x20user\x20','totalPayments','values','revenue','SquirrelPay','Visa/MasterCard','KLYME\x20GB','260vQWttX','\x20for\x20shop\x20','\x20USDT\x20(-','Plisio','\x20\x20\x20ðŸ“…\x20This\x20month:\x20','âŒ\x20Failed\x20to\x20send\x20Telegram\x20notification\x20for\x20payout\x20','\x20USDT\x20(total\x20paid\x20to\x20merchants)','pendingUrl','base32','ðŸ’°\x20Payment\x20','generateDailyStatistics','count','lte','../config/database','toLocaleDateString','\x20USDT,\x20merchant:\x20','0000','sk_','Payment\x20not\x20found','2FA\x20is\x20already\x20enabled','Interac','getUTCDate','\x20->\x20','trim','\x20\x20\x20Requested\x20(number):\x20','admin','deletePayout','polygon','7323emCJun','cointopay','totalPayout','\x20\x20\x20ðŸ’¸\x20Total\x20payouts\x20(all\x20time):\x20','this_week','customerIp','totalPaidOut','gateways','customerCountry','setDate','status','periodFrom','âœ…\x20Payout\x20created\x20in\x20DB:','\x20\x20\x20ðŸ’³\x20Total\x20payments:\x20','ðŸ“…\x20Period:\x20','year','\x20balance\x20updated:\x20','âš ï¸\x20Requested\x20gateway\x20\x27','\x20USDT\x20for\x20payment\x20','insensitive','ðŸ“Š\x20Statistics\x20WHERE\x20conditions:','split','\x20USDT\x20from\x20balance','getGatewayDisplayName','forEach','orderId','create','Rapyd','âœ…\x20Using\x20gateway\x20filter:\x20\x27','ðŸ“Š\x20Statistics\x20date\x20range:\x20','Insufficient\x20balance.\x20Available:\x20','delete','\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)',',\x20refunds:\x20','PAID','\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)','\x27\x20->\x20ID\x20\x27','TrapaPay\x20(','findMany','Username\x20already\x20exists','usdcPolygonWallet','getFullYear','\x20USDT\x20(rounded\x20to\x202\x20decimal\x20places)','2FA\x20not\x20set\x20up.\x20Please\x20call\x20setup\x20endpoint\x20first','commissionUSDT','ðŸ“Š\x20Using\x20saved\x20values\x20for\x20payment\x20','ðŸ“Š\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','getUTCDay','customerEmail','telegramBotService','3833805MkPiQp','\x20\x20\x20Available\x20(number):\x20','\x20\x20\x20ðŸ‘¤\x20Merchant\x20earnings:\x20','MaxPara','\x20\x20\x20ðŸ”\x20Calculated\x20after\x20commission:\x20','286PlPOXt','\x20USDT\x20(','ðŸ”\x20Selected\x20polygon_usdc\x20wallet:\x20','\x20\x20\x20Balance:\x20','findFirst','gatewaySettings','âœ…\x20Using\x20wallet\x20from\x20request:\x20','408573pREOuX','password','shopUrl','payment','plisio','error','\x20\x20\x20Difference:\x20','\x20USDT\x20(same\x20as\x20awaiting)','\x27\x20to\x20name\x20\x27','createdAt','customerUa','verify','week','thisMonth','ðŸ“Š\x20Payout\x20statistics\x20calculated:','paymentGateways','setHours','get','aggregate','ðŸ’°\x20Found\x20','noda','parse','reduce','updatePayout','\x20\x20\x20ðŸ¤”\x20Difference:\x20','telegramId','9XripkH','round','\x20\x20\x20Gateway:\x20','updatePaymentStatus','\x20USDT\x20(theoretical\x20net)','\x20\x20\x20â³\x20Awaiting\x20payout:\x20','amount','\x20-\x20','\x20with\x20payout\x20history','\x20\x20\x20Shop\x20totalPaidOut:\x20','ðŸ’¸\x20CHARGEBACK:\x20Processing\x20penalty-only\x20deduction','ðŸŽ¯\x20updateUser\x20called\x20with\x20ID:\x20','ðŸ”„\x20Gateway\x20mapping:','createUser','\x20merchants\x20for\x20selection','\x20\x20\x20Current\x20amount:\x20','twoFactorSecret','default','deleteUser','AmPay\x20TRY','paidAt','âœ…\x20Payout\x20','\x20\x20\x20ðŸ“…\x20Total\x20payouts\x20(this\x20month):\x20','_sum','amountUSDT','ðŸ’°\x20[PAYOUT]\x20Merchant\x20','fullName','\x20\x20\x20Shop\x20balance:\x20','InstaXchange','customerName','dateFrom','speakeasy','getMonth','pk_','statusChangedAt','ðŸ“Š\x20Merchants\x20with\x20rounded\x20balance\x20!=\x200.00:\x20','./currencyService','set','ðŸ”\x20[','push','min','custom_',']\x20Gateway\x20settings\x20before\x20saving:','toUpperCase','totalCommissionRate','hex','shopId','ðŸ“‹\x20Found\x20','_count','join','getAllPayouts','update','paymentsCount','merchantEarningsUSDT','log','randomBytes','createPayout','2313800rHlSWY','suspendUser','\x20\x20\x20Current\x20balance:\x20','ðŸ”‘\x20Generated\x20','desc','CHARGEBACK','cointopay2','\x20\x20\x20Amount\x20increased\x20by\x20','averageCheckUSDT','gateway','ðŸ“Š\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20','\x20\x20\x20ðŸ’µ\x20Available\x20balance:\x20','ðŸ“Š\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','NONEXISTENT_GATEWAY_FILTER','toLowerCase','ðŸ’°\x20Creating\x20payout\x20for\x20shop\x20','Sepa','availableBalance','name','ðŸ’°\x20[PAYOUT]\x20Gateway\x20','updateCustomerData','merchantUrl','getPayoutById','\x20\x20\x20ï¿½ðŸ“Š\x20Total\x20payments:\x20','ðŸ“Š\x20Total\x20payments\x20(including\x20failed):\x20','\x20USDT\x20-\x20will\x20return\x20to\x20balance','âœ…\x20Balance\x20check\x20passed\x20(with\x20tolerance)','\x20\x20\x20Amount\x20decreased\x20by\x20','paidOutUSDT','REFUND','date','272382xlRHAZ',',\x20successful:\x20','pendingPayout','getTime','currency','updateUser','ðŸ”\x20Creating\x20payout\x20with\x20data:','floor','random','getAllUsers','\x20\x20\x20â³\x20Pending\x20payout:\x20','bcryptjs','\x20\x20\x20ðŸ’°\x20Total\x20payments\x20turnover:\x20','hash','CoinToPay2','Insufficient\x20balance\x20for\x20amount\x20increase.\x20Available:\x20','getUTCMonth','polygon_usdc','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','mastercard','ðŸ”„\x20Converted\x20gateway\x20name\x20\x27','getGatewayIdByName','__importDefault','asc','activateUser','%\x20from\x20','ðŸ’°\x20Shop\x20','7EDEUDC','findUnique','shop','getGatewayNameById','period','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','Telegram\x20username\x20already\x20exists','ðŸ“Š\x20Available\x20gateways\x20in\x20database:','\x27\x20(from\x20\x27','getShopWallets','ðŸ”§\x20[','test_gateway','all','\x20USDT,\x20Requested:\x20'];a48_0x4f87=function(){return _0x53b663;};return a48_0x4f87();}class AdminService{async['getPayoutStats'](){const _0x2c74c8=a48_0xf5dcd9;console[_0x2c74c8(0x290)](_0x2c74c8(0x361));const _0x3437b5=await database_1[_0x2c74c8(0x26b)]['shop'][_0x2c74c8(0x252)]({'_sum':{'balance':!![],'totalPaidOut':!![]}}),_0x55ea7a=await database_1[_0x2c74c8(0x26b)][_0x2c74c8(0x243)][_0x2c74c8(0x1f1)]({'where':{'status':'PAID','gateway':{'not':_0x2c74c8(0x2d8)}}}),_0x59786f=new Date(),_0x3dc9df=new Date(_0x59786f[_0x2c74c8(0x22b)](),_0x59786f[_0x2c74c8(0x27a)](),0x1),_0x21cd93=new Date(_0x59786f[_0x2c74c8(0x22b)](),_0x59786f[_0x2c74c8(0x27a)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x2cb688=await database_1[_0x2c74c8(0x26b)]['payout'][_0x2c74c8(0x252)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x3dc9df,'lte':_0x21cd93},'status':_0x2c74c8(0x30a)}}),_0x412fed=_0x3437b5['_sum']['totalPaidOut']||0x0,_0x5db1a2=_0x3437b5[_0x2c74c8(0x271)][_0x2c74c8(0x374)]||0x0,_0x142053=_0x2cb688['_sum']['amount']||0x0,_0x175951={'totalPayout':Math[_0x2c74c8(0x25b)](_0x412fed*0x64)/0x64,'awaitingPayout':Math[_0x2c74c8(0x25b)](_0x5db1a2*0x64)/0x64,'thisMonth':Math[_0x2c74c8(0x25b)](_0x142053*0x64)/0x64,'availableBalance':Math[_0x2c74c8(0x25b)](_0x5db1a2*0x64)/0x64,'totalPayments':_0x55ea7a};return console[_0x2c74c8(0x290)](_0x2c74c8(0x24e)),console[_0x2c74c8(0x290)](_0x2c74c8(0x2f8)+_0x175951[_0x2c74c8(0x204)]+_0x2c74c8(0x1ec)),console[_0x2c74c8(0x290)](_0x2c74c8(0x25f)+_0x175951[_0x2c74c8(0x35e)]+_0x2c74c8(0x225)),console[_0x2c74c8(0x290)](_0x2c74c8(0x29e)+_0x175951[_0x2c74c8(0x2a4)]+_0x2c74c8(0x247)),console[_0x2c74c8(0x290)](_0x2c74c8(0x1ea)+_0x175951['thisMonth']+_0x2c74c8(0x338)),console['log'](_0x2c74c8(0x20f)+_0x175951[_0x2c74c8(0x37a)]+_0x2c74c8(0x30d)),_0x175951;}async[a48_0xf5dcd9(0x2a7)](_0x371dc5,_0x4819b4){const _0x135587=a48_0xf5dcd9;console[_0x135587(0x290)]('ðŸ”„\x20Updating\x20customer\x20data\x20for\x20payment\x20'+_0x371dc5+':',_0x4819b4);const _0x48f35f=await database_1['default'][_0x135587(0x243)][_0x135587(0x2ce)]({'where':{'id':_0x371dc5},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x48f35f)throw new Error(_0x135587(0x1f8));const _0x35f0b4={};_0x4819b4[_0x135587(0x20a)]!==undefined&&(_0x35f0b4['customerCountry']=_0x4819b4['customerCountry']||null);_0x4819b4[_0x135587(0x207)]!==undefined&&(_0x35f0b4['customerIp']=_0x4819b4[_0x135587(0x207)]||null);_0x4819b4[_0x135587(0x24a)]!==undefined&&(_0x35f0b4[_0x135587(0x24a)]=_0x4819b4[_0x135587(0x24a)]||null);const _0x44e9c3=await database_1[_0x135587(0x26b)][_0x135587(0x243)][_0x135587(0x28d)]({'where':{'id':_0x371dc5},'data':{..._0x35f0b4,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x135587(0x290)]('âœ…\x20Customer\x20data\x20updated\x20for\x20payment\x20'+_0x371dc5),console[_0x135587(0x290)](_0x135587(0x32b)+_0x48f35f['customerCountry']+_0x135587(0x1fc)+_0x44e9c3[_0x135587(0x20a)]),console['log'](_0x135587(0x333)+_0x48f35f[_0x135587(0x207)]+_0x135587(0x1fc)+_0x44e9c3['customerIp']),console[_0x135587(0x290)](_0x135587(0x2e1)+(_0x48f35f['customerUa']?_0x135587(0x27f):'not\x20set')+_0x135587(0x1fc)+(_0x44e9c3[_0x135587(0x24a)]?_0x135587(0x27f):_0x135587(0x371))),_0x44e9c3;}async[a48_0xf5dcd9(0x34a)](_0x53ffa0,_0x207b46){const _0x766be6=a48_0xf5dcd9,_0x208a9e=_0x207b46?new Date(_0x207b46):new Date();let _0x11a612,_0x18731a;if(_0x53ffa0['startsWith'](_0x766be6(0x283))){const _0x4868d4=_0x53ffa0[_0x766be6(0x31a)]('custom_','')[_0x766be6(0x217)]('_');if(_0x4868d4['length']===0x2){const _0x34dcec=new Date(_0x4868d4[0x0]),_0x39d464=new Date(_0x4868d4[0x1]);_0x11a612=new Date(Date[_0x766be6(0x2fe)](_0x34dcec[_0x766be6(0x362)](),_0x34dcec['getUTCMonth'](),_0x34dcec[_0x766be6(0x1fb)](),0x0,0x0,0x0,0x0)),_0x18731a=new Date(Date[_0x766be6(0x2fe)](_0x39d464[_0x766be6(0x362)](),_0x39d464['getUTCMonth'](),_0x39d464[_0x766be6(0x1fb)](),0x17,0x3b,0x3b,0x3e7));}else{const _0x4a0d6d=new Date(Date['UTC'](_0x208a9e[_0x766be6(0x362)](),_0x208a9e[_0x766be6(0x2c2)](),_0x208a9e[_0x766be6(0x1fb)]()-0x1e));_0x11a612=new Date(Date[_0x766be6(0x2fe)](_0x4a0d6d['getUTCFullYear'](),_0x4a0d6d['getUTCMonth'](),_0x4a0d6d[_0x766be6(0x1fb)](),0x0,0x0,0x0,0x0)),_0x18731a=new Date(Date[_0x766be6(0x2fe)](_0x208a9e['getUTCFullYear'](),_0x208a9e[_0x766be6(0x2c2)](),_0x208a9e[_0x766be6(0x1fb)](),0x17,0x3b,0x3b,0x3e7));}}else{switch(_0x53ffa0[_0x766be6(0x2a1)]()){case _0x766be6(0x308):_0x11a612=new Date(Date['UTC'](_0x208a9e[_0x766be6(0x362)](),_0x208a9e[_0x766be6(0x2c2)](),_0x208a9e[_0x766be6(0x1fb)](),0x0,0x0,0x0,0x0)),_0x18731a=new Date(Date[_0x766be6(0x2fe)](_0x208a9e[_0x766be6(0x362)](),_0x208a9e['getUTCMonth'](),_0x208a9e['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case _0x766be6(0x31b):const _0x5cd726=new Date(_0x208a9e);_0x5cd726['setUTCDate'](_0x5cd726[_0x766be6(0x1fb)]()-0x1),_0x11a612=new Date(Date[_0x766be6(0x2fe)](_0x5cd726[_0x766be6(0x362)](),_0x5cd726[_0x766be6(0x2c2)](),_0x5cd726[_0x766be6(0x1fb)](),0x0,0x0,0x0,0x0)),_0x18731a=new Date(Date['UTC'](_0x5cd726[_0x766be6(0x362)](),_0x5cd726['getUTCMonth'](),_0x5cd726[_0x766be6(0x1fb)](),0x17,0x3b,0x3b,0x3e7));break;case _0x766be6(0x206):const _0x265e62=_0x208a9e[_0x766be6(0x231)](),_0x590d18=_0x265e62===0x0?-0x6:0x1-_0x265e62,_0x17c2ef=_0x208a9e[_0x766be6(0x1fb)]()+_0x590d18;_0x11a612=new Date(Date[_0x766be6(0x2fe)](_0x208a9e[_0x766be6(0x362)](),_0x208a9e[_0x766be6(0x2c2)](),_0x17c2ef,0x0,0x0,0x0,0x0)),_0x18731a=new Date(Date['UTC'](_0x208a9e[_0x766be6(0x362)](),_0x208a9e[_0x766be6(0x2c2)](),_0x208a9e[_0x766be6(0x1fb)](),0x17,0x3b,0x3b,0x3e7));break;case'last_week':const _0x3f18c9=new Date(Date['UTC'](_0x208a9e[_0x766be6(0x362)](),_0x208a9e[_0x766be6(0x2c2)](),_0x208a9e[_0x766be6(0x1fb)]()-0x7)),_0x34cfb5=_0x3f18c9[_0x766be6(0x231)](),_0x109b53=_0x34cfb5===0x0?-0x6:0x1-_0x34cfb5,_0x44b43d=_0x3f18c9[_0x766be6(0x1fb)]()+_0x109b53;_0x11a612=new Date(Date['UTC'](_0x3f18c9[_0x766be6(0x362)](),_0x3f18c9[_0x766be6(0x2c2)](),_0x44b43d,0x0,0x0,0x0,0x0)),_0x18731a=new Date(Date[_0x766be6(0x2fe)](_0x3f18c9[_0x766be6(0x362)](),_0x3f18c9[_0x766be6(0x2c2)](),_0x44b43d+0x6,0x17,0x3b,0x3b,0x3e7));break;case _0x766be6(0x329):_0x11a612=new Date(Date[_0x766be6(0x2fe)](_0x208a9e[_0x766be6(0x362)](),_0x208a9e[_0x766be6(0x2c2)](),0x1,0x0,0x0,0x0,0x0)),_0x18731a=new Date(Date[_0x766be6(0x2fe)](_0x208a9e['getUTCFullYear'](),_0x208a9e[_0x766be6(0x2c2)](),_0x208a9e[_0x766be6(0x1fb)](),0x17,0x3b,0x3b,0x3e7));break;case _0x766be6(0x36a):_0x11a612=new Date(Date[_0x766be6(0x2fe)](_0x208a9e['getUTCFullYear'](),_0x208a9e['getUTCMonth']()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x18731a=new Date(Date[_0x766be6(0x2fe)](_0x208a9e[_0x766be6(0x362)](),_0x208a9e[_0x766be6(0x2c2)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x766be6(0x335):_0x11a612=new Date(Date[_0x766be6(0x2fe)](0x7e9,0x5,0xe,0x0,0x0,0x0,0x0)),_0x18731a=new Date(Date[_0x766be6(0x2fe)](_0x208a9e[_0x766be6(0x362)](),_0x208a9e[_0x766be6(0x2c2)](),_0x208a9e[_0x766be6(0x1fb)](),0x17,0x3b,0x3b,0x3e7));break;default:_0x11a612=new Date(_0x208a9e[_0x766be6(0x2b5)]()-0x1e*0x18*0x3c*0x3c*0x3e8);const _0x25375a=new Date(Date['UTC'](_0x208a9e[_0x766be6(0x362)](),_0x208a9e[_0x766be6(0x2c2)](),_0x208a9e['getUTCDate']()-0x1e));_0x11a612=new Date(Date[_0x766be6(0x2fe)](_0x25375a[_0x766be6(0x362)](),_0x25375a[_0x766be6(0x2c2)](),_0x25375a['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x18731a=new Date(Date[_0x766be6(0x2fe)](_0x208a9e[_0x766be6(0x362)](),_0x208a9e[_0x766be6(0x2c2)](),_0x208a9e[_0x766be6(0x1fb)](),0x17,0x3b,0x3b,0x3e7));}const _0x4e844a={'gte':_0x11a612,'lte':_0x18731a};console['log'](_0x766be6(0x21f)+_0x11a612['toISOString']()+'\x20to\x20'+_0x18731a['toISOString']());const [_0x1af97d,_0x3e457b,_0x1e8422,_0x43d7d0,_0x226980,_0x2c8d1f,_0xccf368,_0x5effd9,_0x1603bb]=await Promise['all']([database_1['default'][_0x766be6(0x2cf)][_0x766be6(0x1f1)](),database_1['default'][_0x766be6(0x2cf)][_0x766be6(0x1f1)]({'where':{'status':_0x766be6(0x32e)}}),database_1[_0x766be6(0x26b)]['payment'][_0x766be6(0x1f1)]({'where':{'status':_0x766be6(0x224),'createdAt':_0x4e844a,'gateway':{'not':_0x766be6(0x2d8)}}}),database_1[_0x766be6(0x26b)][_0x766be6(0x243)][_0x766be6(0x1f1)]({'where':{'status':_0x766be6(0x298),'createdAt':_0x4e844a,'gateway':{'not':_0x766be6(0x2d8)}}}),database_1[_0x766be6(0x26b)][_0x766be6(0x243)][_0x766be6(0x1f1)]({'where':{'status':'REFUND','createdAt':_0x4e844a,'gateway':{'not':_0x766be6(0x2d8)}}}),database_1['default']['payment'][_0x766be6(0x228)]({'where':{'status':_0x766be6(0x224),'createdAt':_0x4e844a,'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x766be6(0x26b)][_0x766be6(0x243)]['findMany']({'where':{'gateway':{'not':_0x766be6(0x2d8)}},'take':0xa,'orderBy':{'createdAt':_0x766be6(0x297)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default']['payment'][_0x766be6(0x228)]({'where':{'createdAt':_0x4e844a,'gateway':{'not':_0x766be6(0x2d8)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x766be6(0x26b)][_0x766be6(0x243)][_0x766be6(0x228)]({'where':{'status':'PAID','gateway':{'not':_0x766be6(0x2d8)}},'select':{'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![]}})]);console[_0x766be6(0x290)]('ðŸ“Š\x20Statistics\x20PAID\x20payments\x20count:\x20'+_0x1e8422);let _0x313dfc=0x0,_0x2ad6ce=0x0;for(const _0x58dd7d of _0x2c8d1f){const _0x1f2dc8=_0x58dd7d[_0x766be6(0x272)]||0x0;_0x313dfc+=_0x1f2dc8;if(_0x58dd7d[_0x766be6(0x2ed)]&&_0x58dd7d['amountUSDT']){const _0x4c2bc=_0x58dd7d[_0x766be6(0x272)]-_0x58dd7d['amountAfterGatewayCommissionUSDT'];_0x2ad6ce+=_0x4c2bc;}}let _0x5bc4bd=0x0;for(const _0x14f1fa of _0x1603bb){if(_0x14f1fa['amountAfterGatewayCommissionUSDT']&&_0x14f1fa[_0x766be6(0x272)]){const _0x462796=_0x14f1fa[_0x766be6(0x272)]-_0x14f1fa['amountAfterGatewayCommissionUSDT'];_0x5bc4bd+=_0x462796;}}const _0x144f91=_0x1e8422>0x0?_0x313dfc/_0x1e8422:0x0,_0x5cca86=this['generateDailyStatistics'](_0x5effd9,_0x11a612,_0x18731a),_0x1a4b6a=await database_1[_0x766be6(0x26b)][_0x766be6(0x243)][_0x766be6(0x1f1)]({'where':{'createdAt':_0x4e844a,'gateway':{'not':_0x766be6(0x2d8)},'status':{'notIn':['PENDING',_0x766be6(0x337)]}}}),_0x2d7cb4=_0x1a4b6a>0x0?_0x1e8422/_0x1a4b6a*0x64:0x0;return{'totalShops':_0x1af97d,'activeShops':_0x3e457b,'totalPayments':_0x1a4b6a,'successfulPayments':_0x1e8422,'totalAttempts':_0x1a4b6a,'chargebacks':_0x43d7d0,'refunds':_0x226980,'totalRevenue':Math[_0x766be6(0x25b)](_0x313dfc*0x64)/0x64,'trapayEarnings':Math[_0x766be6(0x25b)](_0x2ad6ce*0x64)/0x64,'trapayEarningsAllTime':Math['round'](_0x5bc4bd*0x64)/0x64,'averagePaymentAmount':Math[_0x766be6(0x25b)](_0x144f91*0x64)/0x64,'conversionRate':Math['round'](_0x2d7cb4*0x64)/0x64,'dailyRevenue':_0x5cca86[_0x766be6(0x33c)],'dailyPayments':_0x5cca86[_0x766be6(0x378)],'recentPayments':_0xccf368[_0x766be6(0x36c)](_0x3dd36a=>({'id':_0x3dd36a['id'],'amount':_0x3dd36a[_0x766be6(0x260)],'currency':_0x3dd36a[_0x766be6(0x2b6)],'status':_0x3dd36a['status'],'gateway':_0x3dd36a[_0x766be6(0x29c)],'shop':_0x3dd36a[_0x766be6(0x2cf)],'createdAt':_0x3dd36a[_0x766be6(0x249)]}))};}}async[a48_0xf5dcd9(0x34c)](_0x59eb67){const _0x2d3f12=a48_0xf5dcd9;console[_0x2d3f12(0x290)]('ðŸ“Š\x20Getting\x20merchant\x20statistics\x20with\x20filters:',_0x59eb67);let _0x496af5,_0x38cd96=new Date();if(_0x59eb67[_0x2d3f12(0x2d1)]===_0x2d3f12(0x32a)&&_0x59eb67[_0x2d3f12(0x278)]&&_0x59eb67[_0x2d3f12(0x375)]){const _0x90a434=new Date(_0x59eb67[_0x2d3f12(0x278)]),_0x596f43=new Date(_0x59eb67[_0x2d3f12(0x375)]);_0x496af5=new Date(Date['UTC'](_0x90a434[_0x2d3f12(0x362)](),_0x90a434[_0x2d3f12(0x2c2)](),_0x90a434['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x38cd96=new Date(Date[_0x2d3f12(0x2fe)](_0x596f43[_0x2d3f12(0x362)](),_0x596f43[_0x2d3f12(0x2c2)](),_0x596f43[_0x2d3f12(0x1fb)](),0x17,0x3b,0x3b,0x3e7));}else{const _0x418854=new Date();switch(_0x59eb67[_0x2d3f12(0x2d1)]){case _0x2d3f12(0x24c):_0x496af5=new Date(_0x418854[_0x2d3f12(0x2b5)]()-0x7*0x18*0x3c*0x3c*0x3e8),_0x496af5[_0x2d3f12(0x250)](0x0,0x0,0x0,0x0),_0x38cd96[_0x2d3f12(0x250)](0x17,0x3b,0x3b,0x3e7);break;case _0x2d3f12(0x319):_0x496af5=new Date(Date['UTC'](_0x418854[_0x2d3f12(0x362)](),_0x418854['getUTCMonth'](),0x1,0x0,0x0,0x0,0x0)),_0x38cd96=new Date(Date[_0x2d3f12(0x2fe)](_0x418854[_0x2d3f12(0x362)](),_0x418854['getUTCMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7));break;case'lastMonth':_0x496af5=new Date(Date['UTC'](_0x418854[_0x2d3f12(0x362)](),_0x418854[_0x2d3f12(0x2c2)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x38cd96=new Date(Date[_0x2d3f12(0x2fe)](_0x418854['getUTCFullYear'](),_0x418854[_0x2d3f12(0x2c2)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x2d3f12(0x211):_0x496af5=new Date(_0x418854['getTime']()-0x16d*0x18*0x3c*0x3c*0x3e8),_0x496af5[_0x2d3f12(0x250)](0x0,0x0,0x0,0x0),_0x38cd96[_0x2d3f12(0x250)](0x17,0x3b,0x3b,0x3e7);break;case'all':default:_0x496af5=new Date(_0x2d3f12(0x355)),_0x496af5['setHours'](0x0,0x0,0x0,0x0),_0x38cd96[_0x2d3f12(0x250)](0x17,0x3b,0x3b,0x3e7);break;}}console[_0x2d3f12(0x290)](_0x2d3f12(0x210)+_0x496af5['toISOString']()+_0x2d3f12(0x339)+_0x38cd96[_0x2d3f12(0x372)]());const _0x18117f={'status':_0x2d3f12(0x224),'gateway':{'not':_0x2d3f12(0x2d8)},'createdAt':{'gte':_0x496af5,'lte':_0x38cd96}};_0x59eb67['shopId']&&(_0x18117f[_0x2d3f12(0x288)]=_0x59eb67['shopId']);const _0x10e001=await database_1[_0x2d3f12(0x26b)][_0x2d3f12(0x243)]['findMany']({'where':_0x18117f,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x2d3f12(0x290)](_0x2d3f12(0x253)+_0x10e001['length']+_0x2d3f12(0x2de));const _0x24ab9c={'gateway':{'not':_0x2d3f12(0x2d8)},'status':{'notIn':['PENDING',_0x2d3f12(0x337)]},'createdAt':{'gte':_0x496af5,'lte':_0x38cd96}};_0x59eb67[_0x2d3f12(0x288)]&&(_0x24ab9c[_0x2d3f12(0x288)]=_0x59eb67[_0x2d3f12(0x288)]);const _0x21c466=await database_1[_0x2d3f12(0x26b)][_0x2d3f12(0x243)]['count']({'where':_0x24ab9c}),_0x3b2a11={..._0x24ab9c,'status':_0x2d3f12(0x298)},_0x57bb46={..._0x24ab9c,'status':_0x2d3f12(0x2b0)},[_0x592341,_0x403695]=await Promise['all']([database_1[_0x2d3f12(0x26b)]['payment']['count']({'where':_0x3b2a11}),database_1[_0x2d3f12(0x26b)]['payment'][_0x2d3f12(0x1f1)]({'where':_0x57bb46})]);console[_0x2d3f12(0x290)](_0x2d3f12(0x2ab)+_0x21c466+_0x2d3f12(0x2b3)+_0x10e001[_0x2d3f12(0x301)]+',\x20chargebacks:\x20'+_0x592341+_0x2d3f12(0x223)+_0x403695);let _0x33a2ac=0x0,_0x1a9a63=0x0,_0x19b82d=0x0;const _0x15cea7={},_0x4194fb={},_0x29f4f6={},_0x26b9f2=new Date(_0x496af5);while(_0x26b9f2<=_0x38cd96){const _0x235b4f=_0x26b9f2[_0x2d3f12(0x372)]()['split']('T')[0x0];_0x29f4f6[_0x235b4f]={'date':_0x235b4f,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0},_0x26b9f2['setUTCDate'](_0x26b9f2[_0x2d3f12(0x1fb)]()+0x1);}for(const _0x1754ba of _0x10e001){try{const _0x37e875=_0x1754ba[_0x2d3f12(0x272)]||0x0;if(_0x37e875<=0x0){console[_0x2d3f12(0x34e)]('âš ï¸\x20Payment\x20'+_0x1754ba['id']+_0x2d3f12(0x340));continue;}let _0x35f9f6,_0x34b7aa;if(_0x1754ba[_0x2d3f12(0x2ed)]!==null&&_0x1754ba[_0x2d3f12(0x2ed)]!==undefined)_0x35f9f6=_0x1754ba['amountAfterGatewayCommissionUSDT'],_0x34b7aa=_0x37e875-_0x35f9f6,console[_0x2d3f12(0x290)](_0x2d3f12(0x22f)+_0x1754ba['id']+':\x20'+_0x37e875[_0x2d3f12(0x2eb)](0x6)+_0x2d3f12(0x1f5)+_0x35f9f6['toFixed'](0x6)+'\x20USDT');else{let _0x172729={};if(_0x1754ba[_0x2d3f12(0x2cf)][_0x2d3f12(0x23e)])try{_0x172729=JSON['parse'](_0x1754ba[_0x2d3f12(0x2cf)]['gatewaySettings']);}catch(_0xf393b6){console[_0x2d3f12(0x245)](_0x2d3f12(0x2d2)+_0x1754ba[_0x2d3f12(0x288)]+':',_0xf393b6);}let _0x33660f=0x2d;for(const [_0x10585a,_0x585490]of Object[_0x2d3f12(0x2ea)](_0x172729)){if(_0x10585a[_0x2d3f12(0x2a1)]()===_0x1754ba[_0x2d3f12(0x29c)][_0x2d3f12(0x2a1)]()){_0x33660f=_0x585490[_0x2d3f12(0x356)]||0x2d;break;}}_0x34b7aa=_0x37e875*(_0x33660f/0x64),_0x35f9f6=_0x37e875-_0x34b7aa,console[_0x2d3f12(0x290)](_0x2d3f12(0x230)+_0x1754ba['id']+':\x20'+_0x33660f+_0x2d3f12(0x2cb)+_0x37e875[_0x2d3f12(0x2eb)](0x6)+_0x2d3f12(0x338));}_0x33a2ac+=_0x37e875,_0x1a9a63+=_0x35f9f6,_0x19b82d+=_0x34b7aa;let _0x558cd3;_0x1754ba['gatewayCommissionRate']!==null&&_0x1754ba[_0x2d3f12(0x328)]!==undefined?(_0x558cd3=_0x1754ba['gatewayCommissionRate'],console[_0x2d3f12(0x290)](_0x2d3f12(0x29d)+_0x1754ba['id']+':\x20'+_0x558cd3+'%')):(_0x558cd3=_0x37e875>0x0?_0x34b7aa/_0x37e875*0x64:0x0,console[_0x2d3f12(0x290)]('ðŸ“Š\x20Calculated\x20commission\x20rate\x20for\x20payment\x20'+_0x1754ba['id']+':\x20'+_0x558cd3[_0x2d3f12(0x2eb)](0x2)+'%'));!_0x15cea7[_0x1754ba[_0x2d3f12(0x29c)]]&&(_0x15cea7[_0x1754ba[_0x2d3f12(0x29c)]]={'gateway':_0x1754ba[_0x2d3f12(0x29c)],'gatewayDisplayName':this['getGatewayDisplayName'](_0x1754ba['gateway']),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x15cea7[_0x1754ba['gateway']][_0x2d3f12(0x28e)]++,_0x15cea7[_0x1754ba['gateway']][_0x2d3f12(0x36f)]+=_0x37e875,_0x15cea7[_0x1754ba[_0x2d3f12(0x29c)]][_0x2d3f12(0x22e)]+=_0x34b7aa,_0x15cea7[_0x1754ba[_0x2d3f12(0x29c)]]['merchantEarningsUSDT']+=_0x35f9f6,_0x15cea7[_0x1754ba['gateway']][_0x2d3f12(0x286)]+=_0x558cd3;!_0x59eb67[_0x2d3f12(0x288)]&&(!_0x4194fb[_0x1754ba[_0x2d3f12(0x288)]]&&(_0x4194fb[_0x1754ba[_0x2d3f12(0x288)]]={'shopId':_0x1754ba['shopId'],'shopName':_0x1754ba[_0x2d3f12(0x2cf)]['name'],'shopUsername':_0x1754ba[_0x2d3f12(0x2cf)]['username'],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x4194fb[_0x1754ba[_0x2d3f12(0x288)]][_0x2d3f12(0x28e)]++,_0x4194fb[_0x1754ba[_0x2d3f12(0x288)]][_0x2d3f12(0x36f)]+=_0x37e875,_0x4194fb[_0x1754ba[_0x2d3f12(0x288)]][_0x2d3f12(0x22e)]+=_0x34b7aa,_0x4194fb[_0x1754ba[_0x2d3f12(0x288)]][_0x2d3f12(0x28f)]+=_0x35f9f6);const _0x201978=_0x1754ba[_0x2d3f12(0x26e)]['toISOString']()[_0x2d3f12(0x217)]('T')[0x0];_0x29f4f6[_0x201978]&&(_0x29f4f6[_0x201978][_0x2d3f12(0x346)]+=_0x37e875,_0x29f4f6[_0x201978][_0x2d3f12(0x313)]+=_0x35f9f6,_0x29f4f6[_0x201978][_0x2d3f12(0x2f3)]+=_0x34b7aa,_0x29f4f6[_0x201978]['paymentsCount']++);}catch(_0x2d05eb){console['error'](_0x2d3f12(0x2e8)+_0x1754ba['id']+':',_0x2d05eb);}}Object[_0x2d3f12(0x37b)](_0x15cea7)[_0x2d3f12(0x21a)](_0x47c4a0=>{const _0x4c07f2=_0x2d3f12;_0x47c4a0[_0x4c07f2(0x345)]=_0x47c4a0['paymentsCount']>0x0?_0x47c4a0[_0x4c07f2(0x286)]/_0x47c4a0['paymentsCount']:0x0,delete _0x47c4a0[_0x4c07f2(0x286)];}),Object[_0x2d3f12(0x37b)](_0x4194fb)[_0x2d3f12(0x21a)](_0x14b8d4=>{const _0x35e460=_0x2d3f12;_0x14b8d4[_0x35e460(0x29b)]=_0x14b8d4[_0x35e460(0x28e)]>0x0?_0x14b8d4[_0x35e460(0x36f)]/_0x14b8d4[_0x35e460(0x28e)]:0x0;});let _0x278492=0x0,_0x7e1deb=0x0;if(_0x59eb67[_0x2d3f12(0x288)]){const _0x25fb05=await database_1[_0x2d3f12(0x26b)][_0x2d3f12(0x365)][_0x2d3f12(0x228)]({'where':{'shopId':_0x59eb67[_0x2d3f12(0x288)],'status':_0x2d3f12(0x30a),'createdAt':{'gte':_0x496af5,'lte':_0x38cd96}},'select':{'amount':!![]}});_0x278492=_0x25fb05[_0x2d3f12(0x256)]((_0xdfd54a,_0x5b3544)=>_0xdfd54a+_0x5b3544['amount'],0x0);const _0xcfa565=await database_1[_0x2d3f12(0x26b)][_0x2d3f12(0x365)]['findMany']({'where':{'shopId':_0x59eb67[_0x2d3f12(0x288)],'status':'PENDING','createdAt':{'gte':_0x496af5,'lte':_0x38cd96}},'select':{'amount':!![]}});_0x7e1deb=_0xcfa565[_0x2d3f12(0x256)]((_0xf8307f,_0x352554)=>_0xf8307f+_0x352554[_0x2d3f12(0x260)],0x0);}const _0x48147c=_0x21c466,_0x18ade3=_0x10e001[_0x2d3f12(0x301)],_0x538610=_0x18ade3>0x0?_0x33a2ac/_0x18ade3:0x0,_0x95f605=_0x48147c>0x0?Math[_0x2d3f12(0x25b)](_0x18ade3/_0x48147c*0x2710)/0x64:0x0,_0x11bff6=Math[_0x2d3f12(0x31d)]((_0x38cd96[_0x2d3f12(0x2b5)]()-_0x496af5[_0x2d3f12(0x2b5)]())/(0x3e8*0x3c*0x3c*0x18)),_0x145168={'totalTurnover':Math[_0x2d3f12(0x25b)](_0x33a2ac*0x64)/0x64,'merchantEarnings':Math['round'](_0x1a9a63*0x64)/0x64,'gatewayEarnings':Math[_0x2d3f12(0x25b)](_0x19b82d*0x64)/0x64,'totalPaidOut':Math[_0x2d3f12(0x25b)](_0x278492*0x64)/0x64,'pendingPayout':Math[_0x2d3f12(0x25b)](_0x7e1deb*0x64)/0x64,'averageCheck':Math['round'](_0x538610*0x64)/0x64,'totalPayments':_0x48147c,'successfulPayments':_0x18ade3,'conversionRate':_0x95f605,'chargebacks':_0x592341,'refunds':_0x403695,'gatewayBreakdown':Object[_0x2d3f12(0x37b)](_0x15cea7)['map'](_0x981155=>({..._0x981155,'turnoverUSDT':Math[_0x2d3f12(0x25b)](_0x981155[_0x2d3f12(0x36f)]*0x64)/0x64,'commissionUSDT':Math[_0x2d3f12(0x25b)](_0x981155[_0x2d3f12(0x22e)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x981155['merchantEarningsUSDT']*0x64)/0x64,'averageCommissionRate':Math[_0x2d3f12(0x25b)](_0x981155[_0x2d3f12(0x345)]*0x64)/0x64})),'merchantBreakdown':_0x59eb67['shopId']?undefined:Object['values'](_0x4194fb)[_0x2d3f12(0x36c)](_0x3f843f=>({..._0x3f843f,'turnoverUSDT':Math[_0x2d3f12(0x25b)](_0x3f843f['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x2d3f12(0x25b)](_0x3f843f['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x2d3f12(0x25b)](_0x3f843f['merchantEarningsUSDT']*0x64)/0x64,'paidOutUSDT':Math[_0x2d3f12(0x25b)](_0x3f843f[_0x2d3f12(0x2af)]*0x64)/0x64,'averageCheckUSDT':Math[_0x2d3f12(0x25b)](_0x3f843f[_0x2d3f12(0x29b)]*0x64)/0x64})),'dailyData':Object[_0x2d3f12(0x37b)](_0x29f4f6)[_0x2d3f12(0x36c)](_0x2a0514=>({..._0x2a0514,'turnover':Math[_0x2d3f12(0x25b)](_0x2a0514[_0x2d3f12(0x346)]*0x64)/0x64,'merchantEarnings':Math[_0x2d3f12(0x25b)](_0x2a0514['merchantEarnings']*0x64)/0x64,'gatewayEarnings':Math['round'](_0x2a0514[_0x2d3f12(0x2f3)]*0x64)/0x64}))['sort']((_0x26ed59,_0x5afd8f)=>_0x26ed59[_0x2d3f12(0x2b1)][_0x2d3f12(0x309)](_0x5afd8f['date'])),'periodInfo':{'from':_0x496af5,'to':_0x38cd96,'periodType':_0x59eb67[_0x2d3f12(0x2d1)]||_0x2d3f12(0x32a),'daysCount':_0x11bff6}};return console['log'](_0x2d3f12(0x33f)),console['log']('\x20\x20\x20ðŸ’°\x20Total\x20turnover:\x20'+_0x145168['totalTurnover']+_0x2d3f12(0x338)),console[_0x2d3f12(0x290)](_0x2d3f12(0x236)+_0x145168['merchantEarnings']+_0x2d3f12(0x338)),console['log']('\x20\x20\x20ðŸª\x20Gateway\x20earnings:\x20'+_0x145168[_0x2d3f12(0x2f3)]+_0x2d3f12(0x338)),console[_0x2d3f12(0x290)]('\x20\x20\x20ï¿½\x20Total\x20paid\x20out:\x20'+_0x145168[_0x2d3f12(0x208)]+_0x2d3f12(0x338)),console[_0x2d3f12(0x290)](_0x2d3f12(0x2bc)+_0x145168[_0x2d3f12(0x2b4)]+'\x20USDT'),console['log'](_0x2d3f12(0x2aa)+_0x145168['totalPayments']),_0x145168;}async['getMerchantsSelection'](_0x239adf){const _0x479294=a48_0xf5dcd9;console[_0x479294(0x290)](_0x479294(0x317),{'hasPayoutHistory':_0x239adf});let _0x22338b={};_0x239adf&&(_0x22338b['payouts']={'some':{}});const _0x2471b2=await database_1['default'][_0x479294(0x2cf)][_0x479294(0x228)]({'where':_0x22338b,'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x479294(0x2c9)}});return console[_0x479294(0x290)](_0x479294(0x289)+_0x2471b2[_0x479294(0x301)]+_0x479294(0x268)+(_0x239adf?_0x479294(0x262):'')),_0x2471b2['map'](_0x20c181=>({'id':_0x20c181['id'],'username':_0x20c181[_0x479294(0x33d)],'name':_0x20c181[_0x479294(0x2a5)]}));}[a48_0xf5dcd9(0x219)](_0x15c648){const _0x9e0fc0=a48_0xf5dcd9,_0x29d213={'test_gateway':'Test\x20Gateway','plisio':_0x9e0fc0(0x1e9),'rapyd':_0x9e0fc0(0x21d),'noda':_0x9e0fc0(0x311),'cointopay':_0x9e0fc0(0x2e0),'cointopay2':_0x9e0fc0(0x2c0),'klyme_eu':'KLYME\x20EU','klyme_gb':_0x9e0fc0(0x1e5),'klyme_de':'KLYME\x20DE','mastercard':'MasterCard','visa/mastercard':_0x9e0fc0(0x1e4),'amer':'Amer','myxspend':'MyXSpend','ampay':_0x9e0fc0(0x2fb),'ampay_try':_0x9e0fc0(0x26d),'sepa':_0x9e0fc0(0x2a3),'interac':_0x9e0fc0(0x1fa),'onramp':_0x9e0fc0(0x36b),'squirrelpay':_0x9e0fc0(0x1e3),'maxpara':_0x9e0fc0(0x237),'instaxchange':_0x9e0fc0(0x276),'oxapay':'OxaPay'};return _0x29d213[_0x15c648]||_0x15c648;}['getGatewayInternalName'](_0x28a4d3){const _0x16a11f=a48_0xf5dcd9,_0x424bcb={'Test\x20Gateway':_0x16a11f(0x2d8),'Plisio':_0x16a11f(0x244),'Rapyd':'rapyd','Noda':_0x16a11f(0x254),'CoinToPay':_0x16a11f(0x203),'CoinToPay2':_0x16a11f(0x299),'KLYME\x20EU':'klyme_eu','KLYME\x20GB':'klyme_gb','KLYME\x20DE':'klyme_de','MasterCard':_0x16a11f(0x2c5)};return _0x424bcb[_0x28a4d3]||_0x28a4d3[_0x16a11f(0x2a1)]();}async[a48_0xf5dcd9(0x35a)](_0x248072){const _0xa68cb2=a48_0xf5dcd9,{page:_0x2e268c,limit:_0x281fac,minAmount:_0x8f379,search:_0xbbfbea}=_0x248072;console[_0xa68cb2(0x290)](_0xa68cb2(0x29f),_0x248072);let _0x472b0d={};_0xbbfbea&&(_0x472b0d[_0xa68cb2(0x2a5)]={'contains':_0xbbfbea,'mode':_0xa68cb2(0x215)});const _0x55fda=await database_1[_0xa68cb2(0x26b)]['shop'][_0xa68cb2(0x228)]({'where':_0x472b0d,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),_0x36fedf=_0x55fda[_0xa68cb2(0x349)](_0x87ad45=>{const _0x3a4bea=_0xa68cb2,_0x41a123=Math[_0x3a4bea(0x2b9)](_0x87ad45[_0x3a4bea(0x374)]*0x64)/0x64;if(_0x8f379&&_0x41a123<_0x8f379)return![];return _0x41a123!==0x0;});_0x36fedf[_0xa68cb2(0x35b)]((_0x4beec4,_0x1b3094)=>_0x1b3094[_0xa68cb2(0x374)]-_0x4beec4[_0xa68cb2(0x374)]);const _0x2562da=_0x36fedf[_0xa68cb2(0x301)],_0x2954bb=(_0x2e268c-0x1)*_0x281fac,_0x1ddd62=_0x36fedf[_0xa68cb2(0x370)](_0x2954bb,_0x2954bb+_0x281fac);console[_0xa68cb2(0x290)](_0xa68cb2(0x253)+_0x1ddd62[_0xa68cb2(0x301)]+_0xa68cb2(0x33a));const _0x235a7c=await Promise['all'](_0x1ddd62[_0xa68cb2(0x36c)](async _0x169e28=>{const _0x17bb16=_0xa68cb2,[_0x2a0d05,_0x181ecc,_0x540622]=await Promise[_0x17bb16(0x2d9)]([database_1[_0x17bb16(0x26b)][_0x17bb16(0x243)]['count']({'where':{'shopId':_0x169e28['id'],'status':_0x17bb16(0x224),'gateway':{'not':_0x17bb16(0x2d8)}}}),database_1[_0x17bb16(0x26b)][_0x17bb16(0x243)][_0x17bb16(0x23d)]({'where':{'shopId':_0x169e28['id'],'status':'PAID','gateway':{'not':_0x17bb16(0x2d8)}},'orderBy':{'paidAt':'asc'},'select':{'paidAt':!![]}}),database_1[_0x17bb16(0x26b)]['payment'][_0x17bb16(0x310)]({'by':[_0x17bb16(0x29c)],'where':{'shopId':_0x169e28['id'],'status':_0x17bb16(0x224),'gateway':{'not':_0x17bb16(0x2d8)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x4431f5=new Date(),_0x551d57=new Date(_0x4431f5[_0x17bb16(0x22b)](),_0x4431f5[_0x17bb16(0x27a)](),0x1),_0x3e990f=new Date(_0x4431f5['getFullYear'](),_0x4431f5['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x5dfe98,_0x361333]=await Promise[_0x17bb16(0x2d9)]([database_1[_0x17bb16(0x26b)][_0x17bb16(0x365)][_0x17bb16(0x252)]({'_sum':{'amount':!![]},'where':{'shopId':_0x169e28['id'],'status':'COMPLETED'}}),database_1[_0x17bb16(0x26b)][_0x17bb16(0x365)][_0x17bb16(0x252)]({'_sum':{'amount':!![]},'where':{'shopId':_0x169e28['id'],'status':_0x17bb16(0x30a),'createdAt':{'gte':_0x551d57,'lte':_0x3e990f}}})]),_0x38901a=_0x5dfe98[_0x17bb16(0x271)][_0x17bb16(0x260)]||0x0,_0x4e1abc=_0x361333[_0x17bb16(0x271)][_0x17bb16(0x260)]||0x0,_0x2eb98d=await Promise[_0x17bb16(0x2d9)](_0x540622[_0x17bb16(0x36c)](async _0x3fd736=>{const _0x32877=_0x17bb16;let _0x184601=0x2d;if(_0x169e28[_0x32877(0x23e)])try{const _0x1b6321=JSON[_0x32877(0x255)](_0x169e28[_0x32877(0x23e)]);for(const [_0x576c0b,_0x58a39d]of Object[_0x32877(0x2ea)](_0x1b6321)){if(_0x576c0b[_0x32877(0x2a1)]()===_0x3fd736[_0x32877(0x29c)][_0x32877(0x2a1)]()){_0x184601=_0x58a39d[_0x32877(0x356)]||0xa,console[_0x32877(0x290)](_0x32877(0x2a6)+_0x3fd736[_0x32877(0x29c)]+_0x32877(0x1e7)+_0x169e28['id']+_0x32877(0x350)+_0x184601+'%');break;}}}catch(_0x1d284e){console[_0x32877(0x245)](_0x32877(0x2d2)+_0x169e28['id']+':',_0x1d284e);}const _0x349172=_0x3fd736[_0x32877(0x271)]?.[_0x32877(0x272)]||0x0,_0x1dae62=_0x349172*(0x1-_0x184601/0x64);return{'gateway':_0x3fd736[_0x32877(0x29c)],'count':_0x3fd736[_0x32877(0x28a)]?.['id']||0x0,'amountUSDT':Math['round'](_0x349172*0x64)/0x64,'amountAfterCommissionUSDT':Math['round'](_0x1dae62*0x64)/0x64,'commission':_0x184601};})),_0x801fab=_0x2eb98d['reduce']((_0x5843ff,_0x380370)=>_0x5843ff+_0x380370[_0x17bb16(0x272)],0x0),_0x3de80a=_0x2eb98d['reduce']((_0x34894d,_0x117107)=>_0x34894d+_0x117107[_0x17bb16(0x2dc)],0x0),_0x119930=_0x169e28[_0x17bb16(0x374)];return console[_0x17bb16(0x290)](_0x17bb16(0x273)+_0x169e28[_0x17bb16(0x33d)]+':'),console[_0x17bb16(0x290)]('\x20\x20\x20ï¿½\x20Total\x20payments\x20turnover:\x20'+_0x801fab['toFixed'](0x2)+_0x17bb16(0x2f2)),console[_0x17bb16(0x290)](_0x17bb16(0x238)+_0x3de80a['toFixed'](0x2)+_0x17bb16(0x25e)),console[_0x17bb16(0x290)](_0x17bb16(0x342)+_0x119930[_0x17bb16(0x2eb)](0x2)+_0x17bb16(0x31f)),console['log']('\x20\x20\x20ðŸ’¸\x20Total\x20payouts:\x20'+_0x38901a[_0x17bb16(0x2eb)](0x2)+'\x20USDT\x20(already\x20paid\x20out)'),console['log'](_0x17bb16(0x258)+(_0x3de80a-_0x38901a-_0x119930)[_0x17bb16(0x2eb)](0x2)+_0x17bb16(0x222)),{'id':_0x169e28['id'],'fullName':_0x169e28[_0x17bb16(0x2a5)],'username':_0x169e28[_0x17bb16(0x33d)],'telegramId':_0x169e28[_0x17bb16(0x2e6)],'merchantUrl':_0x169e28[_0x17bb16(0x242)],'wallets':{'usdtPolygonWallet':_0x169e28['usdtPolygonWallet'],'usdtTrcWallet':_0x169e28[_0x17bb16(0x36e)],'usdtErcWallet':_0x169e28[_0x17bb16(0x352)],'usdcPolygonWallet':_0x169e28[_0x17bb16(0x22a)],'usdcErcWallet':_0x169e28[_0x17bb16(0x357)]},'totalAmountUSDT':Math[_0x17bb16(0x25b)](_0x801fab*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x17bb16(0x25b)](_0x3de80a*0x64)/0x64,'currentBalance':Math[_0x17bb16(0x2b9)](_0x119930*0x64)/0x64,'totalPayout':Math[_0x17bb16(0x25b)](_0x38901a*0x64)/0x64,'thisMonth':Math['round'](_0x4e1abc*0x64)/0x64,'paymentsCount':_0x2a0d05,'oldestPaymentDate':_0x181ecc?.['paidAt']||_0x169e28[_0x17bb16(0x249)],'gatewayBreakdown':_0x2eb98d};})),_0x29d763=_0x235a7c[_0xa68cb2(0x256)]((_0x552012,_0x3eee77)=>_0x552012+_0x3eee77['totalAmountUSDT'],0x0),_0x245045=_0x235a7c[_0xa68cb2(0x256)]((_0x36ddef,_0x289308)=>_0x36ddef+_0x289308[_0xa68cb2(0x2f7)],0x0),_0xb48544=_0x235a7c[_0xa68cb2(0x256)]((_0x4b39af,_0x51d7c5)=>_0x4b39af+_0x51d7c5[_0xa68cb2(0x204)],0x0),_0x5d1ae7=_0x235a7c['reduce']((_0x21c4b1,_0x9e9c92)=>_0x21c4b1+_0x9e9c92[_0xa68cb2(0x24d)],0x0);return console['log'](_0xa68cb2(0x27d)+_0x2562da+'\x20merchants'),console['log'](_0xa68cb2(0x2be)+Math[_0xa68cb2(0x25b)](_0x29d763*0x64)/0x64+_0xa68cb2(0x2f2)),console['log'](_0xa68cb2(0x322)+Math[_0xa68cb2(0x25b)](_0x245045*0x64)/0x64+_0xa68cb2(0x22c)),console[_0xa68cb2(0x290)](_0xa68cb2(0x205)+Math[_0xa68cb2(0x25b)](_0xb48544*0x64)/0x64+'\x20USDT'),console[_0xa68cb2(0x290)](_0xa68cb2(0x270)+Math[_0xa68cb2(0x25b)](_0x5d1ae7*0x64)/0x64+_0xa68cb2(0x338)),{'merchants':_0x235a7c,'pagination':{'page':_0x2e268c,'limit':_0x281fac,'total':_0x2562da,'totalPages':Math[_0xa68cb2(0x31d)](_0x2562da/_0x281fac)},'summary':{'totalMerchants':_0x2562da,'totalAmountUSDT':Math[_0xa68cb2(0x25b)](_0x29d763*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0xa68cb2(0x25b)](_0x245045*0x64)/0x64,'totalPayout':Math[_0xa68cb2(0x25b)](_0xb48544*0x64)/0x64,'thisMonth':Math[_0xa68cb2(0x25b)](_0x5d1ae7*0x64)/0x64}};}async[a48_0xf5dcd9(0x292)](_0x4f3c75){const _0x87d0be=a48_0xf5dcd9,{shopId:_0x2184c2,amount:_0xa88ab3,network:_0x49d87f,wallet:_0x54b65e,notes:_0x543608,txid:_0x305017,periodFrom:_0x530b6f,periodTo:_0x4268b8}=_0x4f3c75,_0x2b40b8=await database_1['default'][_0x87d0be(0x325)](async _0x4537c8=>{const _0x1feb2b=_0x87d0be,_0x32fb93=await _0x4537c8[_0x1feb2b(0x2cf)][_0x1feb2b(0x2ce)]({'where':{'id':_0x2184c2},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x32fb93)throw new Error(_0x1feb2b(0x2df));console[_0x1feb2b(0x290)](_0x1feb2b(0x2a2)+_0x32fb93[_0x1feb2b(0x33d)]+':'),console[_0x1feb2b(0x290)](_0x1feb2b(0x295)+_0x32fb93['balance'][_0x1feb2b(0x2eb)](0x6)+_0x1feb2b(0x338)),console[_0x1feb2b(0x290)](_0x1feb2b(0x358)+_0xa88ab3[_0x1feb2b(0x2eb)](0x6)+_0x1feb2b(0x338)),console[_0x1feb2b(0x290)]('\x20\x20\x20Current\x20total\x20paid\x20out:\x20'+_0x32fb93['totalPaidOut'][_0x1feb2b(0x2eb)](0x6)+_0x1feb2b(0x338));if(_0x305017)console[_0x1feb2b(0x290)]('\x20\x20\x20Transaction\x20hash:\x20'+_0x305017);const _0x712caa=0.000001,_0x1a909c=Number(_0x32fb93[_0x1feb2b(0x374)]),_0x434537=Number(_0xa88ab3);console[_0x1feb2b(0x290)](_0x1feb2b(0x2ec)),console[_0x1feb2b(0x290)](_0x1feb2b(0x300)+_0x32fb93[_0x1feb2b(0x374)]),console[_0x1feb2b(0x290)](_0x1feb2b(0x235)+_0x1a909c),console[_0x1feb2b(0x290)](_0x1feb2b(0x1fe)+_0x434537),console[_0x1feb2b(0x290)](_0x1feb2b(0x246)+(_0x1a909c-_0x434537)),console[_0x1feb2b(0x290)](_0x1feb2b(0x34d)+_0x712caa);if(_0x1a909c<_0x434537-_0x712caa)throw new Error(_0x1feb2b(0x220)+_0x1a909c[_0x1feb2b(0x2eb)](0x6)+_0x1feb2b(0x2da)+_0x434537[_0x1feb2b(0x2eb)](0x6)+_0x1feb2b(0x30f)+(_0x1a909c-_0x434537)[_0x1feb2b(0x2eb)](0x8)+_0x1feb2b(0x338));console['log'](_0x1feb2b(0x2ad));const _0x512e69=Math[_0x1feb2b(0x282)](_0x1a909c,_0x434537);let _0x18f165=_0x54b65e;console['log']('ðŸ”\x20Initial\x20wallet\x20from\x20request:\x20'+(_0x54b65e||'not\x20provided'));if(!_0x18f165){console[_0x1feb2b(0x290)](_0x1feb2b(0x324));const _0x519ce4=await _0x4537c8[_0x1feb2b(0x2cf)][_0x1feb2b(0x2ce)]({'where':{'id':_0x2184c2},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});console[_0x1feb2b(0x290)]('ðŸ”\x20Shop\x20wallets:',_0x519ce4);if(_0x519ce4)switch(_0x49d87f){case _0x1feb2b(0x201):_0x18f165=_0x519ce4[_0x1feb2b(0x363)]||undefined,console[_0x1feb2b(0x290)](_0x1feb2b(0x34b)+_0x18f165);break;case _0x1feb2b(0x33b):_0x18f165=_0x519ce4['usdtTrcWallet']||undefined,console[_0x1feb2b(0x290)](_0x1feb2b(0x368)+_0x18f165);break;case _0x1feb2b(0x377):_0x18f165=_0x519ce4[_0x1feb2b(0x352)]||undefined,console['log']('ðŸ”\x20Selected\x20erc20\x20wallet:\x20'+_0x18f165);break;case _0x1feb2b(0x2c3):_0x18f165=_0x519ce4[_0x1feb2b(0x22a)]||undefined,console[_0x1feb2b(0x290)](_0x1feb2b(0x23b)+_0x18f165);break;case _0x1feb2b(0x347):_0x18f165=_0x519ce4[_0x1feb2b(0x357)]||undefined,console[_0x1feb2b(0x290)]('ðŸ”\x20Selected\x20erc20_usdc\x20wallet:\x20'+_0x18f165);break;}}else console[_0x1feb2b(0x290)](_0x1feb2b(0x23f)+_0x18f165);console['log'](_0x1feb2b(0x303)+_0x49d87f+':\x20'+(_0x18f165||_0x1feb2b(0x2dd))),console['log'](_0x1feb2b(0x2b8),{'shopId':_0x2184c2,'amount':_0x512e69,'network':_0x49d87f,'wallet':_0x18f165,'status':_0x1feb2b(0x30a),'txid':_0x305017,'notes':_0x543608,'periodFrom':_0x530b6f?new Date(_0x530b6f):null,'periodTo':_0x4268b8?new Date(_0x4268b8):null});const _0x4bb399=await _0x4537c8[_0x1feb2b(0x365)][_0x1feb2b(0x21c)]({'data':{'shopId':_0x2184c2,'amount':_0x512e69,'network':_0x49d87f,'wallet':_0x18f165,'status':'COMPLETED','txid':_0x305017,'notes':_0x543608,'periodFrom':_0x530b6f?new Date(_0x530b6f):null,'periodTo':_0x4268b8?new Date(_0x4268b8):null,'createdAt':new Date(),'paidAt':new Date()}});console[_0x1feb2b(0x290)](_0x1feb2b(0x20e),{'id':_0x4bb399['id'],'wallet':_0x4bb399[_0x1feb2b(0x2db)],'network':_0x4bb399[_0x1feb2b(0x30c)],'amount':_0x4bb399[_0x1feb2b(0x260)]});const _0x933f88=_0x1a909c-_0x512e69,_0x186d52=Number(_0x32fb93['totalPaidOut'])+_0x512e69;return await _0x4537c8[_0x1feb2b(0x2cf)][_0x1feb2b(0x28d)]({'where':{'id':_0x2184c2},'data':{'balance':_0x933f88,'totalPaidOut':_0x186d52}}),console[_0x1feb2b(0x290)](_0x1feb2b(0x2cc)+_0x32fb93[_0x1feb2b(0x33d)]+_0x1feb2b(0x367)),console[_0x1feb2b(0x290)](_0x1feb2b(0x23c)+_0x1a909c[_0x1feb2b(0x2eb)](0x6)+_0x1feb2b(0x1fc)+_0x933f88['toFixed'](0x6)+_0x1feb2b(0x1e8)+_0x512e69[_0x1feb2b(0x2eb)](0x6)+')'),console['log'](_0x1feb2b(0x354)+_0x32fb93[_0x1feb2b(0x208)][_0x1feb2b(0x2eb)](0x6)+_0x1feb2b(0x1fc)+_0x186d52[_0x1feb2b(0x2eb)](0x6)+_0x1feb2b(0x353)+_0x512e69[_0x1feb2b(0x2eb)](0x6)+')'),console[_0x1feb2b(0x290)]('\x20\x20\x20Final\x20payout\x20amount\x20used:\x20'+_0x512e69[_0x1feb2b(0x2eb)](0x6)+'\x20USDT'),{'payout':_0x4bb399,'shop':_0x32fb93};});console[_0x87d0be(0x290)](_0x87d0be(0x2f0)+_0x2b40b8[_0x87d0be(0x365)]['id']+'\x20for\x20shop\x20'+_0x2b40b8[_0x87d0be(0x2cf)][_0x87d0be(0x33d)]+'\x20('+_0x2b40b8[_0x87d0be(0x365)]['amount']['toFixed'](0x6)+'\x20USDT)');try{let _0x5f336f='ÐÐµ\x20ÑƒÐºÐ°Ð·Ð°Ð½';if(_0x2b40b8[_0x87d0be(0x365)][_0x87d0be(0x20d)]&&_0x2b40b8['payout'][_0x87d0be(0x344)]){const _0xceee51=new Date(_0x2b40b8[_0x87d0be(0x365)][_0x87d0be(0x20d)])[_0x87d0be(0x1f4)]('ru-RU'),_0x7c39a5=new Date(_0x2b40b8[_0x87d0be(0x365)][_0x87d0be(0x344)])['toLocaleDateString'](_0x87d0be(0x359));_0x5f336f=_0xceee51+_0x87d0be(0x261)+_0x7c39a5;}await telegramBotService_1[_0x87d0be(0x233)]['sendPayoutNotification'](_0x2b40b8[_0x87d0be(0x365)][_0x87d0be(0x288)],{'id':_0x2b40b8[_0x87d0be(0x365)]['id'],'amount':_0x2b40b8[_0x87d0be(0x365)]['amount'],'network':_0x2b40b8[_0x87d0be(0x365)]['network'],'wallet':_0x2b40b8[_0x87d0be(0x365)][_0x87d0be(0x2db)],'period':_0x5f336f,'createdAt':_0x2b40b8[_0x87d0be(0x365)]['createdAt'],'txid':_0x2b40b8[_0x87d0be(0x365)][_0x87d0be(0x2f9)]}),console[_0x87d0be(0x290)](_0x87d0be(0x32f)+_0x2b40b8[_0x87d0be(0x365)]['id']);}catch(_0x53b017){console[_0x87d0be(0x245)](_0x87d0be(0x1eb)+_0x2b40b8[_0x87d0be(0x365)]['id']+':',_0x53b017);}return{'id':_0x2b40b8[_0x87d0be(0x365)]['id'],'shopId':_0x2b40b8[_0x87d0be(0x365)]['shopId'],'shopName':_0x2b40b8[_0x87d0be(0x2cf)][_0x87d0be(0x2a5)],'shopUsername':_0x2b40b8[_0x87d0be(0x2cf)][_0x87d0be(0x33d)],'amount':_0x2b40b8[_0x87d0be(0x365)][_0x87d0be(0x260)],'network':_0x2b40b8[_0x87d0be(0x365)]['network'],'wallet':_0x2b40b8[_0x87d0be(0x365)][_0x87d0be(0x2db)],'status':_0x2b40b8[_0x87d0be(0x365)][_0x87d0be(0x20c)],'txid':_0x2b40b8['payout'][_0x87d0be(0x2f9)],'notes':_0x2b40b8[_0x87d0be(0x365)][_0x87d0be(0x326)],'periodFrom':_0x2b40b8[_0x87d0be(0x365)]['periodFrom'],'periodTo':_0x2b40b8[_0x87d0be(0x365)][_0x87d0be(0x344)],'createdAt':_0x2b40b8[_0x87d0be(0x365)][_0x87d0be(0x249)],'paidAt':_0x2b40b8['payout'][_0x87d0be(0x26e)]};}async[a48_0xf5dcd9(0x28c)](_0x517bf6){const _0x480512=a48_0xf5dcd9,{page:_0x36c76d,limit:_0x98d5f8,shopId:_0x23051b,network:_0x1a6c5d,dateFrom:_0x13acc8,dateTo:_0x4de06b,search:_0x190ec8}=_0x517bf6,_0x49dd1c=(_0x36c76d-0x1)*_0x98d5f8,_0x2b92ae={};_0x23051b&&(_0x2b92ae[_0x480512(0x288)]=_0x23051b);_0x1a6c5d&&(_0x2b92ae[_0x480512(0x30c)]=_0x1a6c5d);if(_0x13acc8||_0x4de06b){_0x2b92ae[_0x480512(0x249)]={};if(_0x13acc8){const _0x48b0c9=new Date(_0x13acc8);_0x48b0c9[_0x480512(0x250)](0x0,0x0,0x0,0x1),_0x2b92ae[_0x480512(0x249)]['gte']=_0x48b0c9,console[_0x480512(0x290)]('ðŸ“…\x20Payout\x20date\x20from\x20filter:\x20'+_0x48b0c9[_0x480512(0x372)]());}if(_0x4de06b){const _0x378499=new Date(_0x4de06b);_0x378499[_0x480512(0x250)](0x17,0x3b,0x3b,0x3e7),_0x2b92ae[_0x480512(0x249)][_0x480512(0x1f2)]=_0x378499,console[_0x480512(0x290)]('ðŸ“…\x20Payout\x20date\x20to\x20filter:\x20'+_0x378499[_0x480512(0x372)]());}}_0x190ec8&&(_0x2b92ae['OR']=[{'shop':{'name':{'contains':_0x190ec8,'mode':_0x480512(0x215)}}},{'shop':{'username':{'contains':_0x190ec8,'mode':_0x480512(0x215)}}},{'notes':{'contains':_0x190ec8,'mode':'insensitive'}}]);const [_0x428cdb,_0x27edc2]=await Promise[_0x480512(0x2d9)]([database_1['default'][_0x480512(0x365)]['findMany']({'where':_0x2b92ae,'skip':_0x49dd1c,'take':_0x98d5f8,'orderBy':{'createdAt':_0x480512(0x297)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'wallet':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x480512(0x26b)]['payout'][_0x480512(0x1f1)]({'where':_0x2b92ae})]);return{'payouts':_0x428cdb[_0x480512(0x36c)](_0x16731f=>({'id':_0x16731f['id'],'shopId':_0x16731f[_0x480512(0x288)],'shopName':_0x16731f[_0x480512(0x2cf)][_0x480512(0x2a5)],'shopUsername':_0x16731f[_0x480512(0x2cf)][_0x480512(0x33d)],'amount':_0x16731f[_0x480512(0x260)],'network':_0x16731f[_0x480512(0x30c)],'wallet':_0x16731f[_0x480512(0x2db)],'status':_0x16731f['status'],'txid':_0x16731f[_0x480512(0x2f9)],'notes':_0x16731f[_0x480512(0x326)],'periodFrom':_0x16731f[_0x480512(0x20d)],'periodTo':_0x16731f[_0x480512(0x344)],'createdAt':_0x16731f[_0x480512(0x249)],'paidAt':_0x16731f[_0x480512(0x26e)]})),'pagination':{'page':_0x36c76d,'limit':_0x98d5f8,'total':_0x27edc2,'totalPages':Math[_0x480512(0x31d)](_0x27edc2/_0x98d5f8)}};}async[a48_0xf5dcd9(0x2a9)](_0x1a8988){const _0x1f2612=a48_0xf5dcd9,_0x29a45c=await database_1['default'][_0x1f2612(0x365)][_0x1f2612(0x2ce)]({'where':{'id':_0x1a8988},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x29a45c)return null;return{'id':_0x29a45c['id'],'shopId':_0x29a45c[_0x1f2612(0x288)],'shopName':_0x29a45c[_0x1f2612(0x2cf)][_0x1f2612(0x2a5)],'shopUsername':_0x29a45c['shop'][_0x1f2612(0x33d)],'amount':_0x29a45c[_0x1f2612(0x260)],'network':_0x29a45c[_0x1f2612(0x30c)],'wallet':_0x29a45c[_0x1f2612(0x2db)],'status':_0x29a45c[_0x1f2612(0x20c)],'txid':_0x29a45c['txid'],'notes':_0x29a45c['notes'],'periodFrom':_0x29a45c[_0x1f2612(0x20d)],'periodTo':_0x29a45c['periodTo'],'createdAt':_0x29a45c[_0x1f2612(0x249)],'paidAt':_0x29a45c[_0x1f2612(0x26e)]};}async[a48_0xf5dcd9(0x200)](_0x3528e2){const _0x59fa96=a48_0xf5dcd9;await database_1['default'][_0x59fa96(0x365)]['delete']({'where':{'id':_0x3528e2}});}async[a48_0xf5dcd9(0x257)](_0x15f1e8,_0x1af174){const _0x523f06=a48_0xf5dcd9,_0x4347c4=await database_1[_0x523f06(0x26b)][_0x523f06(0x325)](async _0x22b685=>{const _0x79712e=_0x523f06,_0x8d54ab=await _0x22b685['payout'][_0x79712e(0x2ce)]({'where':{'id':_0x15f1e8},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}}}});if(!_0x8d54ab)throw new Error(_0x79712e(0x364));console[_0x79712e(0x290)](_0x79712e(0x366)+_0x15f1e8+_0x79712e(0x1e7)+_0x8d54ab[_0x79712e(0x2cf)][_0x79712e(0x33d)]+':'),console[_0x79712e(0x290)](_0x79712e(0x269)+_0x8d54ab[_0x79712e(0x260)][_0x79712e(0x2eb)](0x6)+'\x20USDT'),console[_0x79712e(0x290)](_0x79712e(0x36d)+_0x8d54ab[_0x79712e(0x30c)]),console[_0x79712e(0x290)](_0x79712e(0x275)+_0x8d54ab[_0x79712e(0x2cf)]['balance']['toFixed'](0x6)+_0x79712e(0x338)),console['log'](_0x79712e(0x263)+_0x8d54ab[_0x79712e(0x2cf)][_0x79712e(0x208)][_0x79712e(0x2eb)](0x6)+'\x20USDT');let _0xc5512c=0x0;if(_0x1af174['amount']!==undefined){const _0xca74e2=Number(_0x8d54ab[_0x79712e(0x260)]),_0x2d3188=Number(_0x1af174[_0x79712e(0x260)]);_0xc5512c=_0x2d3188-_0xca74e2,console[_0x79712e(0x290)]('\x20\x20\x20New\x20amount:\x20'+_0x2d3188[_0x79712e(0x2eb)](0x6)+_0x79712e(0x338)),console[_0x79712e(0x290)](_0x79712e(0x35c)+_0xc5512c[_0x79712e(0x2eb)](0x6)+_0x79712e(0x338));if(_0xc5512c<0x0)console[_0x79712e(0x290)](_0x79712e(0x2ae)+Math[_0x79712e(0x304)](_0xc5512c)[_0x79712e(0x2eb)](0x6)+_0x79712e(0x2ac));else{if(_0xc5512c>0x0){const _0x5dbdf9=Number(_0x8d54ab['shop'][_0x79712e(0x374)]);console[_0x79712e(0x290)](_0x79712e(0x29a)+_0xc5512c[_0x79712e(0x2eb)](0x6)+_0x79712e(0x307));if(_0x5dbdf9<_0xc5512c)throw new Error(_0x79712e(0x2c1)+_0x5dbdf9[_0x79712e(0x2eb)](0x6)+'\x20USDT,\x20Required:\x20'+_0xc5512c[_0x79712e(0x2eb)](0x6)+'\x20USDT');}}}const _0x2a51c5={};if(_0x1af174[_0x79712e(0x260)]!==undefined)_0x2a51c5[_0x79712e(0x260)]=_0x1af174[_0x79712e(0x260)];if(_0x1af174[_0x79712e(0x30c)]!==undefined)_0x2a51c5[_0x79712e(0x30c)]=_0x1af174['network'];if(_0x1af174[_0x79712e(0x2db)]!==undefined)_0x2a51c5[_0x79712e(0x2db)]=_0x1af174[_0x79712e(0x2db)]||null;if(_0x1af174['notes']!==undefined)_0x2a51c5[_0x79712e(0x326)]=_0x1af174[_0x79712e(0x326)]||null;if(_0x1af174[_0x79712e(0x2f9)]!==undefined)_0x2a51c5[_0x79712e(0x2f9)]=_0x1af174[_0x79712e(0x2f9)]||null;if(_0x1af174[_0x79712e(0x20d)]!==undefined)_0x2a51c5[_0x79712e(0x20d)]=_0x1af174[_0x79712e(0x20d)]?new Date(_0x1af174[_0x79712e(0x20d)]):null;if(_0x1af174[_0x79712e(0x344)]!==undefined)_0x2a51c5['periodTo']=_0x1af174['periodTo']?new Date(_0x1af174[_0x79712e(0x344)]):null;const _0xf1815f=await _0x22b685[_0x79712e(0x365)][_0x79712e(0x28d)]({'where':{'id':_0x15f1e8},'data':_0x2a51c5,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(_0xc5512c!==0x0){const _0x59bfd6=Number(_0x8d54ab['shop']['balance']),_0x3a4b9e=Number(_0x8d54ab[_0x79712e(0x2cf)][_0x79712e(0x208)]),_0x5a2596=_0x59bfd6-_0xc5512c,_0x38ffe8=_0x3a4b9e+_0xc5512c;await _0x22b685[_0x79712e(0x2cf)][_0x79712e(0x28d)]({'where':{'id':_0x8d54ab[_0x79712e(0x288)]},'data':{'balance':_0x5a2596,'totalPaidOut':_0x38ffe8}}),console[_0x79712e(0x290)]('ðŸ’°\x20Shop\x20'+_0x8d54ab[_0x79712e(0x2cf)]['username']+_0x79712e(0x367)),console['log']('\x20\x20\x20Balance:\x20'+_0x59bfd6['toFixed'](0x6)+_0x79712e(0x1fc)+_0x5a2596[_0x79712e(0x2eb)](0x6)+_0x79712e(0x338)),console[_0x79712e(0x290)](_0x79712e(0x354)+_0x3a4b9e[_0x79712e(0x2eb)](0x6)+_0x79712e(0x1fc)+_0x38ffe8[_0x79712e(0x2eb)](0x6)+_0x79712e(0x338));}return console[_0x79712e(0x290)](_0x79712e(0x26f)+_0x15f1e8+_0x79712e(0x373)),_0xf1815f;});return{'id':_0x4347c4['id'],'shopId':_0x4347c4[_0x523f06(0x288)],'shopName':_0x4347c4[_0x523f06(0x2cf)][_0x523f06(0x2a5)],'shopUsername':_0x4347c4['shop'][_0x523f06(0x33d)],'amount':Number(_0x4347c4[_0x523f06(0x260)]),'network':_0x4347c4[_0x523f06(0x30c)],'wallet':_0x4347c4['wallet'],'status':_0x4347c4[_0x523f06(0x20c)],'txid':_0x4347c4[_0x523f06(0x2f9)],'notes':_0x4347c4[_0x523f06(0x326)],'periodFrom':_0x4347c4[_0x523f06(0x20d)],'periodTo':_0x4347c4[_0x523f06(0x344)],'createdAt':_0x4347c4[_0x523f06(0x249)],'paidAt':_0x4347c4[_0x523f06(0x26e)]};}async['getAllPayments'](_0x43246d){const _0x8477ba=a48_0xf5dcd9,{page:_0x1b8795,limit:_0x44c7f8,status:_0x19cbe2,gateway:_0x4b406b,shopId:_0x38feee,dateFrom:_0x1b76fc,dateTo:_0x152640,search:_0x197783,currency:_0x434c67,sortBy:_0x214173,sortOrder:_0x1a1411}=_0x43246d,_0x44d2e4=(_0x1b8795-0x1)*_0x44c7f8;console[_0x8477ba(0x290)](_0x8477ba(0x341),_0x43246d);const _0x441b6f=await database_1[_0x8477ba(0x26b)][_0x8477ba(0x243)][_0x8477ba(0x310)]({'by':[_0x8477ba(0x29c)],'_count':{'gateway':!![]}});console[_0x8477ba(0x290)](_0x8477ba(0x2d4),_0x441b6f[_0x8477ba(0x36c)](_0x4426b1=>_0x4426b1[_0x8477ba(0x29c)]+'\x20('+_0x4426b1[_0x8477ba(0x28a)][_0x8477ba(0x29c)]+_0x8477ba(0x376)));if(_0x4b406b){const _0x5ed30e=_0x441b6f[_0x8477ba(0x32c)](_0x2a6576=>_0x2a6576[_0x8477ba(0x29c)][_0x8477ba(0x2a1)]()===_0x4b406b['toLowerCase']());!_0x5ed30e&&_0x4b406b[_0x8477ba(0x2a1)]()!==_0x8477ba(0x2d8)&&console[_0x8477ba(0x290)](_0x8477ba(0x213)+_0x4b406b+'\x27\x20not\x20found.\x20Available\x20gateways:\x20'+_0x441b6f['map'](_0x8aa6a1=>_0x8aa6a1[_0x8477ba(0x29c)])[_0x8477ba(0x28b)](',\x20'));}const _0x34598e={};_0x19cbe2&&(_0x34598e[_0x8477ba(0x20c)]=_0x19cbe2[_0x8477ba(0x285)]());if(!_0x4b406b)_0x34598e[_0x8477ba(0x29c)]={'not':_0x8477ba(0x2d8)};else{if(_0x4b406b&&(_0x4b406b['toLowerCase']()===_0x8477ba(0x2d8)||_0x4b406b===_0x8477ba(0x1f6)))_0x34598e['gateway']=_0x8477ba(0x2d8);else{let _0xb11097=_0x4b406b;const _0x399d33=(0x0,gateway_1['getGatewayNameById'])(_0x4b406b);if(_0x399d33)_0xb11097=_0x399d33,console['log']('ðŸ”„\x20Converted\x20gateway\x20ID\x20\x27'+_0x4b406b+_0x8477ba(0x248)+_0xb11097+'\x27');else{const _0x36e141=(0x0,gateway_1[_0x8477ba(0x2c7)])(_0x4b406b);if(_0x36e141){const _0x20130d=(0x0,gateway_1[_0x8477ba(0x2d0)])(_0x36e141);_0x20130d&&(_0xb11097=_0x20130d,console[_0x8477ba(0x290)](_0x8477ba(0x2c6)+_0x4b406b+_0x8477ba(0x226)+_0x36e141+_0x8477ba(0x320)+_0xb11097+'\x27'));}else console[_0x8477ba(0x290)]('ðŸ”\x20Using\x20gateway\x20\x27'+_0x4b406b+_0x8477ba(0x343));}const _0x2f6455=await database_1['default'][_0x8477ba(0x243)][_0x8477ba(0x1f1)]({'where':{'gateway':_0xb11097[_0x8477ba(0x2a1)]()},'take':0x1});_0x2f6455===0x0?(console[_0x8477ba(0x290)]('âš ï¸\x20Gateway\x20\x27'+_0xb11097+_0x8477ba(0x2d5)+_0x4b406b+_0x8477ba(0x351)),_0x34598e[_0x8477ba(0x29c)]=_0x8477ba(0x2a0)):(_0x34598e[_0x8477ba(0x29c)]=_0xb11097[_0x8477ba(0x2a1)](),console[_0x8477ba(0x290)](_0x8477ba(0x21e)+_0xb11097+_0x8477ba(0x2d5)+_0x4b406b+'\x27)'));}}console[_0x8477ba(0x290)]('ðŸ“Š\x20Gateway\x20filter\x20applied:',_0x34598e[_0x8477ba(0x29c)]);_0x38feee&&(_0x34598e[_0x8477ba(0x288)]=_0x38feee);_0x434c67&&(_0x34598e[_0x8477ba(0x2b6)]=_0x434c67[_0x8477ba(0x285)](),console[_0x8477ba(0x290)]('ðŸ’±\x20Currency\x20filter\x20applied:\x20'+_0x434c67[_0x8477ba(0x285)]()));if(_0x1b76fc||_0x152640){_0x34598e[_0x8477ba(0x249)]={};if(_0x1b76fc){const _0x5457b4=new Date(_0x1b76fc),_0x13b8f9=new Date(Date[_0x8477ba(0x2fe)](_0x5457b4[_0x8477ba(0x362)](),_0x5457b4['getUTCMonth'](),_0x5457b4[_0x8477ba(0x1fb)](),0x0,0x0,0x0,0x0));_0x34598e['createdAt'][_0x8477ba(0x31c)]=_0x13b8f9,console[_0x8477ba(0x290)]('ðŸ“…\x20Date\x20from\x20filter:\x20'+_0x13b8f9[_0x8477ba(0x372)]());}if(_0x152640){const _0x1529f0=new Date(_0x152640),_0x24e117=new Date(Date[_0x8477ba(0x2fe)](_0x1529f0[_0x8477ba(0x362)](),_0x1529f0[_0x8477ba(0x2c2)](),_0x1529f0[_0x8477ba(0x1fb)](),0x17,0x3b,0x3b,0x3e7));_0x34598e[_0x8477ba(0x249)][_0x8477ba(0x1f2)]=_0x24e117,console[_0x8477ba(0x290)]('ðŸ“…\x20Date\x20to\x20filter:\x20'+_0x24e117[_0x8477ba(0x372)]());}}_0x197783&&(_0x34598e['OR']=[{'id':{'contains':_0x197783,'mode':_0x8477ba(0x215)}},{'orderId':{'contains':_0x197783,'mode':_0x8477ba(0x215)}},{'gatewayOrderId':{'contains':_0x197783,'mode':_0x8477ba(0x215)}},{'customerEmail':{'contains':_0x197783,'mode':'insensitive'}},{'shop':{'name':{'contains':_0x197783,'mode':_0x8477ba(0x215)}}},{'shop':{'username':{'contains':_0x197783,'mode':_0x8477ba(0x215)}}}]);console[_0x8477ba(0x290)]('ðŸ“Š\x20Final\x20WHERE\x20conditions:',JSON[_0x8477ba(0x2e7)](_0x34598e,null,0x2));const _0x2e01cb=await database_1['default'][_0x8477ba(0x243)]['count']({'where':_0x34598e});console[_0x8477ba(0x290)](_0x8477ba(0x332)+_0x2e01cb);let _0x46b674={'createdAt':_0x8477ba(0x297)};if(_0x214173){const _0x1297b=[_0x8477ba(0x260),'createdAt','updatedAt',_0x8477ba(0x20c),'gateway',_0x8477ba(0x2b6)],_0x44ab83=['asc',_0x8477ba(0x297)];if(_0x1297b[_0x8477ba(0x2f6)](_0x214173)){const _0xc4e492=_0x44ab83[_0x8477ba(0x2f6)](_0x1a1411)?_0x1a1411:'desc';_0x46b674={[_0x214173]:_0xc4e492},console['log'](_0x8477ba(0x316)+_0x214173+'\x20in\x20'+_0xc4e492+'\x20order');}}const [_0x33171e,_0x1503e2]=await Promise['all']([database_1[_0x8477ba(0x26b)][_0x8477ba(0x243)][_0x8477ba(0x228)]({'where':_0x34598e,'skip':_0x44d2e4,'take':_0x44c7f8,'orderBy':_0x46b674,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x8477ba(0x26b)][_0x8477ba(0x243)][_0x8477ba(0x1f1)]({'where':_0x34598e})]);let _0x34eb8d,_0x5c1153;if(_0x1b76fc){const _0x505cf1=new Date(_0x1b76fc);_0x34eb8d=new Date(Date[_0x8477ba(0x2fe)](_0x505cf1[_0x8477ba(0x362)](),_0x505cf1[_0x8477ba(0x2c2)](),_0x505cf1[_0x8477ba(0x1fb)](),0x0,0x0,0x0,0x0));}else{const _0x7de1b4=new Date();_0x34eb8d=new Date(Date[_0x8477ba(0x2fe)](_0x7de1b4[_0x8477ba(0x362)](),_0x7de1b4['getUTCMonth'](),_0x7de1b4['getUTCDate'](),0x0,0x0,0x0,0x0));}if(_0x152640){const _0x1a15c4=new Date(_0x152640);_0x5c1153=new Date(Date['UTC'](_0x1a15c4[_0x8477ba(0x362)](),_0x1a15c4[_0x8477ba(0x2c2)](),_0x1a15c4[_0x8477ba(0x1fb)](),0x17,0x3b,0x3b,0x3e7));}else{if(_0x1b76fc){const _0x3cabeb=new Date(_0x1b76fc);_0x5c1153=new Date(Date[_0x8477ba(0x2fe)](_0x3cabeb['getUTCFullYear'](),_0x3cabeb['getUTCMonth'](),_0x3cabeb[_0x8477ba(0x1fb)](),0x17,0x3b,0x3b,0x3e7));}else{const _0xfc1ce=new Date();_0x5c1153=new Date(Date[_0x8477ba(0x2fe)](_0xfc1ce[_0x8477ba(0x362)](),_0xfc1ce[_0x8477ba(0x2c2)](),_0xfc1ce[_0x8477ba(0x1fb)](),0x17,0x3b,0x3b,0x3e7));}}const _0x71dfe6={'status':_0x8477ba(0x224),'createdAt':{'gte':_0x34eb8d,'lte':_0x5c1153}};_0x4b406b?_0x71dfe6[_0x8477ba(0x29c)]=_0x34598e['gateway']:_0x71dfe6[_0x8477ba(0x29c)]={'not':_0x8477ba(0x2d8)};_0x38feee&&(_0x71dfe6[_0x8477ba(0x288)]=_0x38feee);_0x434c67&&(_0x71dfe6['currency']=_0x434c67['toUpperCase']());console[_0x8477ba(0x290)](_0x8477ba(0x216),JSON[_0x8477ba(0x2e7)](_0x71dfe6,null,0x2));const _0xf18013=await database_1[_0x8477ba(0x26b)][_0x8477ba(0x243)]['findMany']({'where':_0x71dfe6,'select':{'amountUSDT':!![],'currency':!![],'amount':!![]}}),_0x50f258={};let _0x320dbc=0x0;return _0xf18013['forEach'](_0xfd81d7=>{const _0x4bcb41=_0x8477ba;_0xfd81d7[_0x4bcb41(0x272)]&&(_0x320dbc+=_0xfd81d7['amountUSDT']);if(_0xfd81d7[_0x4bcb41(0x2b6)]){const _0xa5155a=_0xfd81d7[_0x4bcb41(0x2b6)]['toUpperCase']();!_0x50f258[_0xa5155a]&&(_0x50f258[_0xa5155a]=0x0),_0x50f258[_0xa5155a]+=_0xfd81d7[_0x4bcb41(0x260)];}}),_0x320dbc>0x0&&(_0x50f258['USDT']=_0x320dbc),{'payments':_0x33171e,'pagination':{'page':_0x1b8795,'limit':_0x44c7f8,'total':_0x1503e2,'totalPages':Math['ceil'](_0x1503e2/_0x44c7f8)},'statistics':_0x50f258};}async[a48_0xf5dcd9(0x321)](_0x2c6c7a){const _0x4fb51a=a48_0xf5dcd9,_0x46fe4f=await database_1[_0x4fb51a(0x26b)][_0x4fb51a(0x243)]['findUnique']({'where':{'id':_0x2c6c7a},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x46fe4f)return null;return{'id':_0x46fe4f['id'],'shopId':_0x46fe4f['shopId'],'gateway':_0x46fe4f['gateway'],'amount':_0x46fe4f[_0x4fb51a(0x260)],'currency':_0x46fe4f['currency'],'status':_0x46fe4f[_0x4fb51a(0x20c)],'orderId':_0x46fe4f[_0x4fb51a(0x21b)],'gatewayOrderId':_0x46fe4f['gatewayOrderId'],'customerEmail':_0x46fe4f[_0x4fb51a(0x232)],'customerName':_0x46fe4f[_0x4fb51a(0x277)],'customerCountry':_0x46fe4f[_0x4fb51a(0x20a)],'customerIp':_0x46fe4f[_0x4fb51a(0x207)],'customerUa':_0x46fe4f['customerUa'],'failureMessage':_0x46fe4f[_0x4fb51a(0x306)],'externalPaymentUrl':_0x46fe4f['externalPaymentUrl'],'successUrl':_0x46fe4f[_0x4fb51a(0x360)],'failUrl':_0x46fe4f['failUrl'],'pendingUrl':_0x46fe4f[_0x4fb51a(0x1ed)],'whiteUrl':_0x46fe4f['whiteUrl'],'createdAt':_0x46fe4f['createdAt'],'updatedAt':_0x46fe4f[_0x4fb51a(0x331)],'shop':_0x46fe4f[_0x4fb51a(0x2cf)]};}async[a48_0xf5dcd9(0x25d)](_0xff0df9,_0x1904ad,_0x5b6b03,_0x5d4214){const _0x56bc63=a48_0xf5dcd9,_0x167dac=await database_1['default'][_0x56bc63(0x325)](async _0x1c493f=>{const _0x510abd=_0x56bc63,_0x123742=await _0x1c493f[_0x510abd(0x243)][_0x510abd(0x2ce)]({'where':{'id':_0xff0df9},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x123742)throw new Error(_0x510abd(0x1f8));const _0x17da5d=_0x123742[_0x510abd(0x20c)],_0xbca2e9=_0x1904ad[_0x510abd(0x285)]();console[_0x510abd(0x290)]('ðŸ”„\x20Admin\x20updating\x20payment\x20'+_0xff0df9+'\x20status:\x20'+_0x17da5d+_0x510abd(0x1fc)+_0xbca2e9),console[_0x510abd(0x290)](_0x510abd(0x2e4)+_0x123742[_0x510abd(0x2cf)]['balance']+'\x20USDT');const _0x4357b8={'status':_0xbca2e9,'updatedAt':new Date(),'statusChangedBy':_0x510abd(0x1ff),'statusChangedAt':new Date()};_0x5b6b03&&(_0x4357b8['adminNotes']=_0x5b6b03);_0xbca2e9===_0x510abd(0x298)&&_0x5d4214&&(_0x4357b8[_0x510abd(0x2f5)]=_0x5d4214);let _0xc5ee7c=0x0,_0x36912f=_0x123742[_0x510abd(0x2cf)][_0x510abd(0x374)];if(_0xbca2e9===_0x510abd(0x224)&&_0x17da5d!==_0x510abd(0x224)){_0x4357b8[_0x510abd(0x26e)]=new Date();const _0xb9ef24=await currencyService_1['currencyService']['convertToUSDT'](_0x123742[_0x510abd(0x260)],_0x123742[_0x510abd(0x2b6)]);_0x4357b8[_0x510abd(0x272)]=_0xb9ef24;let _0x3ea7f5=0x2d;const _0x5bbe97=await _0x1c493f[_0x510abd(0x2cf)]['findUnique']({'where':{'id':_0x123742[_0x510abd(0x288)]},'select':{'gatewaySettings':!![]}});if(_0x5bbe97?.[_0x510abd(0x23e)])try{const _0x5a45c8=JSON[_0x510abd(0x255)](_0x5bbe97[_0x510abd(0x23e)]);for(const [_0x22c1e8,_0x3479d5]of Object[_0x510abd(0x2ea)](_0x5a45c8)){if(_0x22c1e8[_0x510abd(0x2a1)]()===_0x123742[_0x510abd(0x29c)]['toLowerCase']()){_0x3ea7f5=_0x3479d5[_0x510abd(0x356)]||0xa;break;}}}catch(_0xf41e59){console[_0x510abd(0x245)](_0x510abd(0x323)+_0xff0df9+':',_0xf41e59);}let _0x27a0e9;_0x123742[_0x510abd(0x2ed)]!==null&&_0x123742['amountAfterGatewayCommissionUSDT']!==undefined?(_0x27a0e9=_0x123742[_0x510abd(0x2ed)],console[_0x510abd(0x290)]('ðŸ“Š\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20'+_0x27a0e9[_0x510abd(0x2eb)](0x6)+_0x510abd(0x214)+_0xff0df9)):(_0x27a0e9=_0xb9ef24*(0x1-_0x3ea7f5/0x64),console[_0x510abd(0x290)](_0x510abd(0x35f)+_0xff0df9+':\x20'+_0x3ea7f5+_0x510abd(0x2cb)+_0xb9ef24[_0x510abd(0x2eb)](0x6)+'\x20USDT'),_0x4357b8[_0x510abd(0x2ed)]=_0x27a0e9,_0x4357b8[_0x510abd(0x328)]=_0x3ea7f5),_0xc5ee7c=_0x27a0e9,_0x36912f+=_0x27a0e9,console[_0x510abd(0x290)](_0x510abd(0x1ef)+_0xff0df9+_0x510abd(0x2ef)),console[_0x510abd(0x290)]('\x20\x20\x20Full\x20amount:\x20'+_0xb9ef24['toFixed'](0x6)+'\x20USDT'),console[_0x510abd(0x290)](_0x510abd(0x25c)+_0x123742[_0x510abd(0x29c)]+_0x510abd(0x2fa)+_0x3ea7f5+'%'),console[_0x510abd(0x290)](_0x510abd(0x336)+_0x27a0e9[_0x510abd(0x2eb)](0x6)+_0x510abd(0x2fd)+_0x3ea7f5+_0x510abd(0x34f)),console[_0x510abd(0x290)]('\x20\x20\x20Added\x20to\x20balance:\x20+'+_0x27a0e9['toFixed'](0x6)+_0x510abd(0x338));}else{if(_0x17da5d===_0x510abd(0x224)&&_0xbca2e9!==_0x510abd(0x224)&&_0xbca2e9!==_0x510abd(0x298)){if(_0x123742[_0x510abd(0x272)]){let _0x56ad18=0x2d;const _0x4b7616=await _0x1c493f[_0x510abd(0x2cf)]['findUnique']({'where':{'id':_0x123742[_0x510abd(0x288)]},'select':{'gatewaySettings':!![]}});if(_0x4b7616?.[_0x510abd(0x23e)])try{const _0x5d9850=JSON[_0x510abd(0x255)](_0x4b7616[_0x510abd(0x23e)]);for(const [_0x1b5af9,_0x4f70e3]of Object[_0x510abd(0x2ea)](_0x5d9850)){if(_0x1b5af9[_0x510abd(0x2a1)]()===_0x123742['gateway'][_0x510abd(0x2a1)]()){_0x56ad18=_0x4f70e3[_0x510abd(0x356)]||0xa;break;}}}catch(_0x1cbc96){console[_0x510abd(0x245)](_0x510abd(0x323)+_0xff0df9+':',_0x1cbc96);}const _0x1dee0d=_0x123742[_0x510abd(0x272)]*(0x1-_0x56ad18/0x64);_0xc5ee7c=-_0x1dee0d,_0x36912f-=_0x1dee0d,console[_0x510abd(0x290)](_0x510abd(0x334)+_0x123742[_0x510abd(0x272)]['toFixed'](0x6)+'\x20USDT'),console[_0x510abd(0x290)](_0x510abd(0x25c)+_0x123742['gateway']+_0x510abd(0x2fa)+_0x56ad18+'%'),console[_0x510abd(0x290)](_0x510abd(0x2e9)+_0x1dee0d[_0x510abd(0x2eb)](0x6)+'\x20USDT\x20(after\x20'+_0x56ad18+_0x510abd(0x34f)),console['log'](_0x510abd(0x2c4)+_0x1dee0d['toFixed'](0x6)+_0x510abd(0x338));}}}_0xbca2e9==='CHARGEBACK'&&(console['log'](_0x510abd(0x264)),_0x5d4214&&_0x5d4214>0x0?(_0xc5ee7c=-_0x5d4214,_0x36912f-=_0x5d4214,console[_0x510abd(0x290)]('ðŸ’¸\x20CHARGEBACK\x20penalty\x20ONLY:\x20-'+_0x5d4214[_0x510abd(0x2eb)](0x6)+_0x510abd(0x218)),console[_0x510abd(0x290)](_0x510abd(0x35d))):console[_0x510abd(0x290)]('âš ï¸\x20CHARGEBACK\x20without\x20penalty\x20amount\x20-\x20no\x20balance\x20change'),_0x4357b8['chargebackAmount']=_0x5d4214||0x0);_0xbca2e9===_0x510abd(0x2b0)&&_0x17da5d===_0x510abd(0x224)&&console[_0x510abd(0x290)]('ðŸ”„\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance');const _0x5ef7af=await _0x1c493f['payment'][_0x510abd(0x28d)]({'where':{'id':_0xff0df9},'data':_0x4357b8,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0xc5ee7c!==0x0&&(await _0x1c493f[_0x510abd(0x2cf)]['update']({'where':{'id':_0x123742['shopId']},'data':{'balance':_0x36912f}}),console[_0x510abd(0x290)](_0x510abd(0x2cc)+_0x123742[_0x510abd(0x288)]+_0x510abd(0x212)+_0x123742[_0x510abd(0x2cf)]['balance']['toFixed'](0x6)+'\x20->\x20'+_0x36912f['toFixed'](0x6)+_0x510abd(0x23a)+(_0xc5ee7c>0x0?'+':'')+_0xc5ee7c[_0x510abd(0x2eb)](0x6)+')')),_0x5ef7af;});return{'id':_0x167dac['id'],'shopId':_0x167dac[_0x56bc63(0x288)],'gateway':_0x167dac[_0x56bc63(0x29c)],'amount':_0x167dac[_0x56bc63(0x260)],'currency':_0x167dac[_0x56bc63(0x2b6)],'status':_0x167dac[_0x56bc63(0x20c)],'orderId':_0x167dac[_0x56bc63(0x21b)],'gatewayOrderId':_0x167dac[_0x56bc63(0x369)],'customerEmail':_0x167dac[_0x56bc63(0x232)],'customerName':_0x167dac[_0x56bc63(0x277)],'customerCountry':_0x167dac[_0x56bc63(0x20a)],'customerIp':_0x167dac[_0x56bc63(0x207)],'customerUa':_0x167dac[_0x56bc63(0x24a)],'failureMessage':_0x167dac[_0x56bc63(0x306)],'adminNotes':_0x167dac['adminNotes'],'chargebackAmount':_0x167dac[_0x56bc63(0x2f5)],'statusChangedBy':_0x167dac[_0x56bc63(0x2e2)],'statusChangedAt':_0x167dac[_0x56bc63(0x27c)],'createdAt':_0x167dac['createdAt'],'updatedAt':_0x167dac['updatedAt'],'shop':_0x167dac[_0x56bc63(0x2cf)]};}async[a48_0xf5dcd9(0x2b7)](_0x195288,_0x333d74){const _0x1ea943=a48_0xf5dcd9,_0x3c4384=Math[_0x1ea943(0x2ba)]()[_0x1ea943(0x2e5)](0x24)['substr'](0x2,0x9);console[_0x1ea943(0x290)](_0x1ea943(0x265)+_0x3c4384+_0x1ea943(0x30e)+_0x195288);const _0x339446={..._0x333d74};_0x333d74['password']&&_0x333d74['password'][_0x1ea943(0x1fd)]()!==''?(console['log'](_0x1ea943(0x280)+_0x3c4384+_0x1ea943(0x379)+_0x195288),_0x339446[_0x1ea943(0x241)]=await bcryptjs_1['default'][_0x1ea943(0x2bf)](_0x333d74[_0x1ea943(0x241)],0xc)):(console[_0x1ea943(0x290)](_0x1ea943(0x280)+_0x3c4384+']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update'),delete _0x339446[_0x1ea943(0x241)]);_0x333d74[_0x1ea943(0x274)]&&(_0x339446[_0x1ea943(0x2a5)]=_0x333d74[_0x1ea943(0x274)],delete _0x339446['fullName']);_0x333d74['telegramId']&&(_0x339446[_0x1ea943(0x2e6)]=_0x333d74['telegramId'],delete _0x339446[_0x1ea943(0x259)]);_0x333d74[_0x1ea943(0x2a8)]&&(_0x339446[_0x1ea943(0x242)]=_0x333d74[_0x1ea943(0x2a8)],delete _0x339446['merchantUrl']);if(_0x333d74['gateways']){const _0x1fb3ef=_0x333d74[_0x1ea943(0x209)]['map'](_0x1a83d2=>this['getGatewayInternalName'](_0x1a83d2));console[_0x1ea943(0x290)](_0x1ea943(0x266),_0x333d74[_0x1ea943(0x209)],'->',_0x1fb3ef),_0x339446['paymentGateways']=JSON[_0x1ea943(0x2e7)](_0x1fb3ef),delete _0x339446[_0x1ea943(0x209)];}_0x333d74[_0x1ea943(0x23e)]&&(console[_0x1ea943(0x290)](_0x1ea943(0x2d7)+_0x3c4384+_0x1ea943(0x284),_0x333d74['gatewaySettings']),_0x339446['gatewaySettings']=JSON[_0x1ea943(0x2e7)](_0x333d74[_0x1ea943(0x23e)]),console[_0x1ea943(0x290)](_0x1ea943(0x2d7)+_0x3c4384+_0x1ea943(0x330),_0x339446[_0x1ea943(0x23e)]));_0x333d74[_0x1ea943(0x312)]&&(_0x333d74[_0x1ea943(0x312)][_0x1ea943(0x363)]!==undefined&&(_0x339446['usdtPolygonWallet']=_0x333d74[_0x1ea943(0x312)][_0x1ea943(0x363)]||null),_0x333d74[_0x1ea943(0x312)][_0x1ea943(0x36e)]!==undefined&&(_0x339446[_0x1ea943(0x36e)]=_0x333d74[_0x1ea943(0x312)][_0x1ea943(0x36e)]||null),_0x333d74[_0x1ea943(0x312)][_0x1ea943(0x352)]!==undefined&&(_0x339446[_0x1ea943(0x352)]=_0x333d74[_0x1ea943(0x312)][_0x1ea943(0x352)]||null),_0x333d74[_0x1ea943(0x312)][_0x1ea943(0x22a)]!==undefined&&(_0x339446[_0x1ea943(0x22a)]=_0x333d74[_0x1ea943(0x312)][_0x1ea943(0x22a)]||null),delete _0x339446[_0x1ea943(0x312)]);const _0x3f7543=await database_1['default']['shop'][_0x1ea943(0x28d)]({'where':{'id':_0x195288},'data':_0x339446,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0x1ea943(0x290)](_0x1ea943(0x2e3)+_0x3c4384+']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:',_0x3f7543[_0x1ea943(0x23e)]),{'id':_0x3f7543['id'],'fullName':_0x3f7543['name'],'username':_0x3f7543['username'],'telegramId':_0x3f7543[_0x1ea943(0x2e6)],'merchantUrl':_0x3f7543[_0x1ea943(0x242)],'gateways':_0x3f7543['paymentGateways']?JSON[_0x1ea943(0x255)](_0x3f7543[_0x1ea943(0x24f)]):null,'gatewaySettings':_0x3f7543['gatewaySettings']?JSON[_0x1ea943(0x255)](_0x3f7543[_0x1ea943(0x23e)]):null,'publicKey':_0x3f7543[_0x1ea943(0x2fc)],'wallets':{'usdtPolygonWallet':_0x3f7543[_0x1ea943(0x363)],'usdtTrcWallet':_0x3f7543[_0x1ea943(0x36e)],'usdtErcWallet':_0x3f7543[_0x1ea943(0x352)],'usdcPolygonWallet':_0x3f7543[_0x1ea943(0x22a)]},'status':_0x3f7543[_0x1ea943(0x20c)],'createdAt':_0x3f7543['createdAt']};}async[a48_0xf5dcd9(0x294)](_0x411d0e){const _0x4c01e9=a48_0xf5dcd9,_0x1686ea=await database_1[_0x4c01e9(0x26b)][_0x4c01e9(0x2cf)][_0x4c01e9(0x28d)]({'where':{'id':_0x411d0e},'data':{'status':'SUSPENDED'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x1686ea['id'],'fullName':_0x1686ea[_0x4c01e9(0x2a5)],'username':_0x1686ea[_0x4c01e9(0x33d)],'telegramId':_0x1686ea['telegram'],'merchantUrl':_0x1686ea[_0x4c01e9(0x242)],'gateways':_0x1686ea['paymentGateways']?JSON[_0x4c01e9(0x255)](_0x1686ea[_0x4c01e9(0x24f)]):null,'gatewaySettings':_0x1686ea[_0x4c01e9(0x23e)]?JSON[_0x4c01e9(0x255)](_0x1686ea['gatewaySettings']):null,'publicKey':_0x1686ea['publicKey'],'wallets':{'usdtPolygonWallet':_0x1686ea[_0x4c01e9(0x363)],'usdtTrcWallet':_0x1686ea[_0x4c01e9(0x36e)],'usdtErcWallet':_0x1686ea[_0x4c01e9(0x352)],'usdcPolygonWallet':_0x1686ea[_0x4c01e9(0x22a)]},'status':_0x1686ea[_0x4c01e9(0x20c)],'createdAt':_0x1686ea[_0x4c01e9(0x249)]};}async[a48_0xf5dcd9(0x2ca)](_0x21f061){const _0x315449=a48_0xf5dcd9,_0x5a5b2b=await database_1['default'][_0x315449(0x2cf)][_0x315449(0x28d)]({'where':{'id':_0x21f061},'data':{'status':_0x315449(0x32e)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x5a5b2b['id'],'fullName':_0x5a5b2b[_0x315449(0x2a5)],'username':_0x5a5b2b['username'],'telegramId':_0x5a5b2b[_0x315449(0x2e6)],'merchantUrl':_0x5a5b2b[_0x315449(0x242)],'gateways':_0x5a5b2b[_0x315449(0x24f)]?JSON[_0x315449(0x255)](_0x5a5b2b[_0x315449(0x24f)]):null,'gatewaySettings':_0x5a5b2b['gatewaySettings']?JSON['parse'](_0x5a5b2b['gatewaySettings']):null,'publicKey':_0x5a5b2b['publicKey'],'wallets':{'usdtPolygonWallet':_0x5a5b2b[_0x315449(0x363)],'usdtTrcWallet':_0x5a5b2b[_0x315449(0x36e)],'usdtErcWallet':_0x5a5b2b[_0x315449(0x352)],'usdcPolygonWallet':_0x5a5b2b[_0x315449(0x22a)]},'status':_0x5a5b2b[_0x315449(0x20c)],'createdAt':_0x5a5b2b['createdAt']};}async[a48_0xf5dcd9(0x2bb)](_0x50fa1e){const _0x8a66b=a48_0xf5dcd9,{page:_0x5e485f,limit:_0x3cd142,status:_0x5e761f}=_0x50fa1e,_0x577166=(_0x5e485f-0x1)*_0x3cd142,_0x5662b7={};_0x5e761f&&(_0x5662b7[_0x8a66b(0x20c)]=_0x5e761f[_0x8a66b(0x285)]());const [_0x51015a,_0x4f2afd]=await Promise[_0x8a66b(0x2d9)]([database_1[_0x8a66b(0x26b)][_0x8a66b(0x2cf)]['findMany']({'where':_0x5662b7,'skip':_0x577166,'take':_0x3cd142,'orderBy':{'createdAt':_0x8a66b(0x297)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'twoFactorEnabled':!![],'createdAt':!![]}}),database_1[_0x8a66b(0x26b)]['shop'][_0x8a66b(0x1f1)]({'where':_0x5662b7})]);return{'users':_0x51015a[_0x8a66b(0x36c)](_0x37798a=>{const _0x586335=_0x8a66b,_0x2d8d9d=_0x37798a[_0x586335(0x24f)]?JSON[_0x586335(0x255)](_0x37798a['paymentGateways']):null,_0x201189=_0x2d8d9d?_0x2d8d9d['map'](_0x15cbd5=>this[_0x586335(0x219)](_0x15cbd5)):null;return{'id':_0x37798a['id'],'fullName':_0x37798a[_0x586335(0x2a5)],'username':_0x37798a[_0x586335(0x33d)],'telegramId':_0x37798a['telegram'],'merchantUrl':_0x37798a[_0x586335(0x242)],'gateways':_0x201189,'gatewaySettings':_0x37798a[_0x586335(0x23e)]?JSON['parse'](_0x37798a[_0x586335(0x23e)]):null,'publicKey':_0x37798a[_0x586335(0x2fc)],'wallets':{'usdtPolygonWallet':_0x37798a[_0x586335(0x363)],'usdtTrcWallet':_0x37798a[_0x586335(0x36e)],'usdtErcWallet':_0x37798a[_0x586335(0x352)],'usdcPolygonWallet':_0x37798a['usdcPolygonWallet'],'usdcErcWallet':_0x37798a[_0x586335(0x357)]},'status':_0x37798a[_0x586335(0x20c)],'twoFactorEnabled':_0x37798a['twoFactorEnabled']||![],'createdAt':_0x37798a[_0x586335(0x249)]};}),'pagination':{'page':_0x5e485f,'limit':_0x3cd142,'total':_0x4f2afd,'totalPages':Math[_0x8a66b(0x31d)](_0x4f2afd/_0x3cd142)}};}async['getUserById'](_0x31e2b9){const _0x5eb36c=a48_0xf5dcd9,_0xc08cdf=await database_1[_0x5eb36c(0x26b)][_0x5eb36c(0x2cf)]['findUnique']({'where':{'id':_0x31e2b9},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![]}});if(!_0xc08cdf)return null;const _0x31f729=_0xc08cdf[_0x5eb36c(0x24f)]?JSON['parse'](_0xc08cdf[_0x5eb36c(0x24f)]):null,_0x4a4a11=_0x31f729?_0x31f729['map'](_0x355a6b=>this[_0x5eb36c(0x219)](_0x355a6b)):null;return _0x31f729&&_0x4a4a11&&console[_0x5eb36c(0x290)](_0x5eb36c(0x2f4),_0x31f729,'->',_0x4a4a11),{'id':_0xc08cdf['id'],'fullName':_0xc08cdf[_0x5eb36c(0x2a5)],'username':_0xc08cdf[_0x5eb36c(0x33d)],'telegramId':_0xc08cdf[_0x5eb36c(0x2e6)],'merchantUrl':_0xc08cdf[_0x5eb36c(0x242)],'gateways':_0x4a4a11,'gatewaySettings':_0xc08cdf[_0x5eb36c(0x23e)]?JSON[_0x5eb36c(0x255)](_0xc08cdf[_0x5eb36c(0x23e)]):null,'publicKey':_0xc08cdf[_0x5eb36c(0x2fc)],'wallets':{'usdtPolygonWallet':_0xc08cdf[_0x5eb36c(0x363)],'usdtTrcWallet':_0xc08cdf['usdtTrcWallet'],'usdtErcWallet':_0xc08cdf[_0x5eb36c(0x352)],'usdcPolygonWallet':_0xc08cdf[_0x5eb36c(0x22a)],'usdcErcWallet':_0xc08cdf[_0x5eb36c(0x357)]},'status':_0xc08cdf[_0x5eb36c(0x20c)],'createdAt':_0xc08cdf['createdAt']};}async[a48_0xf5dcd9(0x267)](_0x2e4cdd){const _0x57a1d5=a48_0xf5dcd9,{fullName:_0x28ad72,username:_0x4ed029,password:_0x2abf3e,telegramId:_0x3af818,merchantUrl:_0x620ddc,gateways:_0x3afe41,gatewaySettings:_0x5c64a8,wallets:_0x55be08}=_0x2e4cdd,_0x46e7ae=await database_1[_0x57a1d5(0x26b)][_0x57a1d5(0x2cf)]['findUnique']({'where':{'username':_0x4ed029}});if(_0x46e7ae)throw new Error(_0x57a1d5(0x229));if(_0x3af818){const _0x15212c=await database_1[_0x57a1d5(0x26b)][_0x57a1d5(0x2cf)][_0x57a1d5(0x2ce)]({'where':{'telegram':_0x3af818}});if(_0x15212c)throw new Error(_0x57a1d5(0x2d3));}const _0x631e57=await bcryptjs_1[_0x57a1d5(0x26b)][_0x57a1d5(0x2bf)](_0x2abf3e,0xc),_0x50a5e1=_0x57a1d5(0x27b)+crypto_1['default'][_0x57a1d5(0x291)](0x20)['toString']('hex'),_0x5c7fe5=_0x57a1d5(0x1f7)+crypto_1[_0x57a1d5(0x26b)][_0x57a1d5(0x291)](0x20)[_0x57a1d5(0x2e5)](_0x57a1d5(0x287)),_0x28b3e9=_0x3afe41?_0x3afe41[_0x57a1d5(0x36c)](_0x3dcd2e=>this[_0x57a1d5(0x31e)](_0x3dcd2e)):null;_0x3afe41&&_0x28b3e9&&console[_0x57a1d5(0x290)]('ðŸ”„\x20Gateway\x20mapping\x20(create):',_0x3afe41,'->',_0x28b3e9);const _0x557076=await database_1[_0x57a1d5(0x26b)][_0x57a1d5(0x2cf)]['create']({'data':{'name':_0x28ad72,'username':_0x4ed029,'password':_0x631e57,'telegram':_0x3af818,'shopUrl':_0x620ddc,'paymentGateways':_0x28b3e9?JSON[_0x57a1d5(0x2e7)](_0x28b3e9):null,'gatewaySettings':_0x5c64a8?JSON[_0x57a1d5(0x2e7)](_0x5c64a8):null,'usdtPolygonWallet':_0x55be08?.['usdtPolygonWallet']||null,'usdtTrcWallet':_0x55be08?.[_0x57a1d5(0x36e)]||null,'usdtErcWallet':_0x55be08?.['usdtErcWallet']||null,'usdcPolygonWallet':_0x55be08?.['usdcPolygonWallet']||null,'publicKey':_0x50a5e1,'secretKey':_0x5c7fe5,'status':_0x57a1d5(0x32e)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x557076['id'],'fullName':_0x557076['name'],'username':_0x557076[_0x57a1d5(0x33d)],'telegramId':_0x557076[_0x57a1d5(0x2e6)],'merchantUrl':_0x557076[_0x57a1d5(0x242)],'gateways':_0x557076[_0x57a1d5(0x24f)]?JSON[_0x57a1d5(0x255)](_0x557076[_0x57a1d5(0x24f)]):null,'gatewaySettings':_0x557076[_0x57a1d5(0x23e)]?JSON[_0x57a1d5(0x255)](_0x557076[_0x57a1d5(0x23e)]):null,'publicKey':_0x557076[_0x57a1d5(0x2fc)],'wallets':{'usdtPolygonWallet':_0x557076['usdtPolygonWallet'],'usdtTrcWallet':_0x557076[_0x57a1d5(0x36e)],'usdtErcWallet':_0x557076[_0x57a1d5(0x352)],'usdcPolygonWallet':_0x557076[_0x57a1d5(0x22a)]},'status':_0x557076[_0x57a1d5(0x20c)],'createdAt':_0x557076[_0x57a1d5(0x249)]};}async[a48_0xf5dcd9(0x26c)](_0xd298a6){const _0x1fb7e4=a48_0xf5dcd9;await database_1[_0x1fb7e4(0x26b)][_0x1fb7e4(0x2cf)][_0x1fb7e4(0x221)]({'where':{'id':_0xd298a6}});}async[a48_0xf5dcd9(0x2d6)](_0x34c038){const _0x1e0702=a48_0xf5dcd9,_0x1f7399=await database_1[_0x1e0702(0x26b)][_0x1e0702(0x2cf)][_0x1e0702(0x2ce)]({'where':{'id':_0x34c038},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});if(!_0x1f7399)throw new Error(_0x1e0702(0x2df));return{'usdtPolygonWallet':_0x1f7399['usdtPolygonWallet'],'usdtTrcWallet':_0x1f7399['usdtTrcWallet'],'usdtErcWallet':_0x1f7399[_0x1e0702(0x352)],'usdcPolygonWallet':_0x1f7399[_0x1e0702(0x22a)],'usdcErcWallet':_0x1f7399[_0x1e0702(0x357)]};}[a48_0xf5dcd9(0x315)](_0x4580c4=0x8){const _0x33388d=a48_0xf5dcd9,_0x2e2818=[];for(let _0x491aa2=0x0;_0x491aa2<_0x4580c4;_0x491aa2++){const _0x7dde6c=crypto_1[_0x33388d(0x26b)]['randomBytes'](0x4)[_0x33388d(0x2e5)](_0x33388d(0x287))[_0x33388d(0x285)]();_0x2e2818[_0x33388d(0x281)](_0x7dde6c);}return _0x2e2818;}async[a48_0xf5dcd9(0x314)](_0x272d87){const _0x27bd23=a48_0xf5dcd9,_0x4bf7e2=await database_1['default']['shop'][_0x27bd23(0x2ce)]({'where':{'id':_0x272d87},'select':{'id':!![],'name':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x4bf7e2)throw new Error(_0x27bd23(0x2df));const _0x5f0b39=speakeasy_1[_0x27bd23(0x26b)][_0x27bd23(0x305)]({'name':_0x27bd23(0x227)+_0x4bf7e2[_0x27bd23(0x33d)]+')','issuer':'TrapaPay','length':0x20}),_0x3ee200=await qrcode_1[_0x27bd23(0x26b)][_0x27bd23(0x327)](_0x5f0b39['otpauth_url']),_0x4bec12=this['generateBackupCodes'](0x8),_0x173a1d=await Promise[_0x27bd23(0x2d9)](_0x4bec12[_0x27bd23(0x36c)](_0x142b33=>bcryptjs_1['default'][_0x27bd23(0x2bf)](_0x142b33,0xa)));return await database_1[_0x27bd23(0x26b)][_0x27bd23(0x2cf)][_0x27bd23(0x28d)]({'where':{'id':_0x272d87},'data':{'twoFactorSecret':_0x5f0b39[_0x27bd23(0x1ee)],'backupCodes':JSON[_0x27bd23(0x2e7)](_0x173a1d)}}),console[_0x27bd23(0x290)](_0x27bd23(0x2ff)+_0x4bf7e2[_0x27bd23(0x33d)]),console[_0x27bd23(0x290)](_0x27bd23(0x296)+_0x4bec12[_0x27bd23(0x301)]+'\x20backup\x20codes'),{'secret':_0x5f0b39[_0x27bd23(0x1ee)],'qrCode':_0x3ee200,'manualEntryKey':_0x5f0b39[_0x27bd23(0x1ee)],'backupCodes':_0x4bec12};}async[a48_0xf5dcd9(0x318)](_0x2f328b,_0x58c228){const _0x14eb12=a48_0xf5dcd9,_0x3c8216=await database_1[_0x14eb12(0x26b)][_0x14eb12(0x2cf)][_0x14eb12(0x2ce)]({'where':{'id':_0x2f328b},'select':{'id':!![],'username':!![],'twoFactorSecret':!![],'twoFactorEnabled':!![]}});if(!_0x3c8216)throw new Error(_0x14eb12(0x2df));if(!_0x3c8216[_0x14eb12(0x26a)])throw new Error(_0x14eb12(0x22d));if(_0x3c8216['twoFactorEnabled'])throw new Error(_0x14eb12(0x1f9));const _0x1b5ac0=speakeasy_1[_0x14eb12(0x26b)]['totp'][_0x14eb12(0x24b)]({'secret':_0x3c8216[_0x14eb12(0x26a)],'encoding':_0x14eb12(0x1ee),'token':_0x58c228,'window':0x2});if(!_0x1b5ac0)throw new Error('Invalid\x202FA\x20token');return await database_1['default']['shop']['update']({'where':{'id':_0x2f328b},'data':{'twoFactorEnabled':!![]}}),console[_0x14eb12(0x290)]('ðŸ”\x202FA\x20enabled\x20for\x20shop:\x20'+_0x3c8216['username']),{'enabled':!![]};}async[a48_0xf5dcd9(0x302)](_0x57aefd){const _0x48e0fd=a48_0xf5dcd9,_0x1f9771=await database_1['default']['shop'][_0x48e0fd(0x2ce)]({'where':{'id':_0x57aefd},'select':{'id':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x1f9771)throw new Error(_0x48e0fd(0x2df));await database_1[_0x48e0fd(0x26b)][_0x48e0fd(0x2cf)]['update']({'where':{'id':_0x57aefd},'data':{'twoFactorEnabled':![],'twoFactorSecret':null,'backupCodes':null}}),console[_0x48e0fd(0x290)]('ðŸ”\x202FA\x20disabled\x20for\x20shop:\x20'+_0x1f9771[_0x48e0fd(0x33d)]);}[a48_0xf5dcd9(0x1f0)](_0x2c2671,_0x520014,_0x31c334){const _0x28408c=a48_0xf5dcd9,_0x1536e6=new Map(),_0x5a5892=new Date(_0x520014);while(_0x5a5892<=_0x31c334){const _0x11dcc3=_0x5a5892[_0x28408c(0x372)]()['split']('T')[0x0];_0x1536e6[_0x28408c(0x27f)](_0x11dcc3,{'revenue':0x0,'count':0x0}),_0x5a5892[_0x28408c(0x20b)](_0x5a5892['getDate']()+0x1);}for(const _0x32d712 of _0x2c2671){const _0x23118a=_0x32d712['createdAt']['toISOString']()[_0x28408c(0x217)]('T')[0x0],_0x3b9ca2=_0x1536e6[_0x28408c(0x251)](_0x23118a);_0x3b9ca2&&(_0x3b9ca2[_0x28408c(0x1f1)]+=0x1,_0x32d712['status']==='PAID'&&(_0x32d712[_0x28408c(0x272)]?_0x3b9ca2[_0x28408c(0x1e2)]+=_0x32d712['amountUSDT']:console[_0x28408c(0x290)]('âš ï¸\x20Payment\x20'+_0x32d712['id']+'\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion')));}const _0x4f5d39=[],_0x3c3778=[];for(const [_0x2b23ab,_0xefb05]of _0x1536e6){_0x4f5d39[_0x28408c(0x281)]({'date':_0x2b23ab,'amount':Math[_0x28408c(0x25b)](_0xefb05[_0x28408c(0x1e2)]*0x64)/0x64}),_0x3c3778[_0x28408c(0x281)]({'date':_0x2b23ab,'count':_0xefb05[_0x28408c(0x1f1)]});}return{'dailyRevenue':_0x4f5d39,'dailyPayments':_0x3c3778};}}exports[a48_0xf5dcd9(0x32d)]=AdminService;