'use strict';const a33_0x32f77c=a33_0x3911;function a33_0x3da0(){const _0x1b5edc=['\x20suspended\x20successfully','all','default','updatedAt','Shop\x20not\x20found','\x20total','gatewayOrderId','User\x20is\x20already\x20suspended','findUnique','üîç\x20Getting\x20payout\x20by\x20ID:\x20','status','currencyService','‚ùå\x20Payment\x20not\x20found:\x20','has','sourceCurrency','length','16aeJQlf','generateDateRange','entries','txid','üë•\x20Total\x20users:\x20','üìä\x20Calculating\x20admin\x20payout\x20statistics...','../types/gateway','EXPIRED','chargebackAmount','üìã\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','getAllPayouts','7053255kQgOKK','usdtPolygonWallet','toFixed','$queryRaw','‚úÖ\x20Payout\x20statistics\x20calculated:','\x20payouts\x20out\x20of\x20','delete','amountAfterCommissionUSDT','üí∏\x20Chargeback\x20amount:\x20','abs','bankId','\x20deleted\x20successfully','get','toISOString','\x20merchants\x20out\x20of\x20','amount','convertToUSDT','thisMonth','payment','üìã\x20Getting\x20payments\x20with\x20filters:','üìä\x20Found\x20','cardLast4','push','üìã\x20Getting\x20users\x20with\x20filters:','‚úÖ\x20Payout\x20created\x20successfully:\x20','insensitive','PAID','defineProperty','\x20USDT\x20(will\x20be\x20deducted\x20from\x20merchant\x20balance)','\x20users\x20out\x20of\x20','üìÖ\x20Processing\x20daily\x20stats\x20for\x20','gatewayPaymentId','222IYLybO','deletePayout','log','includes','\x20days','‚úÖ\x20Returning\x20','./userService','createdAt','\x20USDT\x20(penalty\x20amount)','slice','desc','‚úÖ\x20Marked\x20','üìä\x20Generating\x20admin\x20statistics\x20for\x20period:\x20','orderId','updateMany','totalAmountUSDT','üí∏\x20Total\x20Payout:\x20','paymentMethod','customerEmail','split','üîÑ\x20Marking\x20payments\x20as\x20paid\x20out\x20for\x20shop\x20','8825560cJSRsj','createUser','üìã\x20Getting\x20payouts\x20with\x20filters:','ceil','name','313482vXvgRf','getGatewayNameById','üìà\x20Average\x20payment:\x20','completed','./telegramBotService','‚ùå\x20Payout\x20not\x20found:\x20','map','üîÑ\x20Updating\x20payment\x20','telegram','getUserById','\x20activated\x20successfully','charAt','getGatewaySettings','network','205dRGuKZ','shop','‚è≥\x20Awaiting\x20Payout:\x20','\x20USDT\x20via\x20','commission','findMany','isEligibleForPayout','\x20payments\x20as\x20paid\x20out','markPaymentsAsPaidOut','currency','üö´\x20Suspending\x20user:\x20','from','Failed\x20to\x20send\x20Telegram\x20payout\x20notification:','‚úÖ\x20Activating\x20user:\x20','publicKey','‚úÖ\x20Found\x20payout:\x20','updatePaymentStatus','üí∏\x20Chargeback\x20penalty:\x20','getPaymentById','PENDING','getPayoutById','‚úÖ\x20User\x20','106309CSbGoT','Invalid\x20status.\x20Valid\x20statuses:\x20','update','payout','usage','\x20USDT\x20(–≤–∫–ª—é—á–∞—è\x20—à—Ç—Ä–∞—Ñ—ã\x20chargeback)','statusChangedBy','PROCESSING','\x20payments\x20for\x20analysis\x20(PAID/REFUND/CHARGEBACK)','paidAt','7694522yLVZsi','./currencyService','remitterIban','calculateEffectiveAmount','254zYgZyV','customerName','usdtErcWallet','REFUND','üí∞\x20Available\x20Balance:\x20','round','set','usdtTrcWallet','SUSPENDED','‚úÖ\x20Payout\x20','‚úÖ\x20Admin\x20statistics\x20generated\x20successfully','availableBalance','join','13012omdYsn','date','updateUser','User\x20not\x20found','sort','merchantPaid','Error\x20parsing\x20gateway\x20settings:','getSystemStatistics','üí∞\x20Total\x20amount:\x20','üîç\x20Getting\x20payment\x20by\x20ID:\x20','getMerchantsAwaitingPayout','getFullYear','üìÖ\x20This\x20Month:\x20','awaitingPayout','üìä\x20Daily\x20revenue\x20entries:\x20','getAllUsers','FAILED','gatewaySettings','isValidGatewayId','setDate','__esModule','reduce','amountUSDT','Payout\x20not\x20found','__importDefault','137452IhmyIK','../config/database','getDate','notes','activateUser','üè™\x20Found\x20','username','count','payoutDelay','üíµ\x20Total\x20revenue:\x20','getPayoutStats','\x20USDT\x20(—Ç–æ–ª—å–∫–æ\x20PAID\x20–ø–ª–∞—Ç–µ–∂–∏)','getPeriodDays','status_update','getAllPayments','ACTIVE','statusChangedAt','create','paymentGateways','payments','sendPayoutNotification','getTime','expiresAt','externalPaymentUrl','telegramBotService','userService','toLowerCase','CHARGEBACK','size','\x20USDT','\x20payments\x20out\x20of\x20','getMonth','\x20USDT\x20(','User\x20is\x20already\x20active','gateway','remitterName','parse','deleteUser','toUpperCase','calculateAmountAfterCommission','totalAmountAfterCommissionUSDT','shopUrl','adminNotes','shopId'];a33_0x3da0=function(){return _0x1b5edc;};return a33_0x3da0();}function a33_0x3911(_0x570b17,_0x3c7c79){const _0x3da0b9=a33_0x3da0();return a33_0x3911=function(_0x39113c,_0x19a8e2){_0x39113c=_0x39113c-0x7d;let _0x478965=_0x3da0b9[_0x39113c];return _0x478965;},a33_0x3911(_0x570b17,_0x3c7c79);}(function(_0x2a1534,_0xc8af7c){const _0x430ab5=a33_0x3911,_0x512131=_0x2a1534();while(!![]){try{const _0x5bdf77=-parseInt(_0x430ab5(0x105))/0x1*(-parseInt(_0x430ab5(0x112))/0x2)+parseInt(_0x430ab5(0xd3))/0x3+-parseInt(_0x430ab5(0x12b))/0x4*(parseInt(_0x430ab5(0xe1))/0x5)+-parseInt(_0x430ab5(0xb9))/0x6*(-parseInt(_0x430ab5(0xf7))/0x7)+parseInt(_0x430ab5(0x8e))/0x8*(-parseInt(_0x430ab5(0x99))/0x9)+parseInt(_0x430ab5(0xce))/0xa+parseInt(_0x430ab5(0x101))/0xb;if(_0x5bdf77===_0xc8af7c)break;else _0x512131['push'](_0x512131['shift']());}catch(_0x4e99cd){_0x512131['push'](_0x512131['shift']());}}}(a33_0x3da0,0xe1c32));var __importDefault=this&&this[a33_0x32f77c(0x12a)]||function(_0x241657){const _0x27cc67=a33_0x32f77c;return _0x241657&&_0x241657[_0x27cc67(0x126)]?_0x241657:{'default':_0x241657};};Object[a33_0x32f77c(0xb4)](exports,a33_0x32f77c(0x126),{'value':!![]}),exports['AdminService']=void 0x0;const database_1=__importDefault(require(a33_0x32f77c(0x12c))),currencyService_1=require(a33_0x32f77c(0x102)),userService_1=require(a33_0x32f77c(0xbf)),telegramBotService_1=require(a33_0x32f77c(0xd7)),gateway_1=require(a33_0x32f77c(0x94));class AdminService{constructor(){const _0x222614=a33_0x32f77c;this[_0x222614(0x144)]=new userService_1['UserService']();}[a33_0x32f77c(0x137)](_0x8f8cda){switch(_0x8f8cda){case'7d':return 0x7;case'30d':return 0x1e;case'90d':return 0x5a;case'1y':return 0x16d;default:return 0x1e;}}[a33_0x32f77c(0x8f)](_0x407171,_0x55787a){const _0x23f4a7=a33_0x32f77c,_0x11b7ea=[],_0x7ce52d=new Date(_0x407171);while(_0x7ce52d<=_0x55787a){_0x11b7ea['push'](_0x7ce52d[_0x23f4a7(0xa6)]()[_0x23f4a7(0xcc)]('T')[0x0]),_0x7ce52d[_0x23f4a7(0x125)](_0x7ce52d[_0x23f4a7(0x12d)]()+0x1);}return _0x11b7ea;}[a33_0x32f77c(0xdf)](_0x8589ba,_0x1e1a21){const _0x2d80ef=a33_0x32f77c;if(!_0x8589ba[_0x2d80ef(0x123)])return{'commission':0x0,'payoutDelay':0x0};try{const _0x3ecf0e=JSON['parse'](_0x8589ba['gatewaySettings']),_0x272662=_0x1e1a21[_0x2d80ef(0xde)](0x0)['toUpperCase']()+_0x1e1a21[_0x2d80ef(0xc2)](0x1)[_0x2d80ef(0x145)]();if(_0x3ecf0e&&_0x3ecf0e[_0x272662])return{'commission':_0x3ecf0e[_0x272662]['commission']||0x0,'payoutDelay':_0x3ecf0e[_0x272662][_0x2d80ef(0x133)]||0x0};}catch(_0xcdfac5){console['error'](_0x2d80ef(0x118),_0xcdfac5);}return{'commission':0x0,'payoutDelay':0x0};}['isEligibleForPayout'](_0x2fe92d){const _0x507af2=a33_0x32f77c;if(_0x2fe92d[_0x507af2(0x88)]!=='PAID'||_0x2fe92d[_0x507af2(0x117)]||!_0x2fe92d[_0x507af2(0x100)])return![];const _0x40c420=this['getGatewaySettings'](_0x2fe92d['shop'],_0x2fe92d[_0x507af2(0x14d)]),_0x2f9ceb=_0x40c420[_0x507af2(0x133)]*0x18*0x3c*0x3c*0x3e8,_0x2cc363=new Date(_0x2fe92d[_0x507af2(0x100)][_0x507af2(0x140)]()+_0x2f9ceb);return new Date()>_0x2cc363;}[a33_0x32f77c(0x152)](_0x2fb0dc,_0x5eb1b4){return _0x2fb0dc*(0x1-_0x5eb1b4/0x64);}[a33_0x32f77c(0x104)](_0x4843ff){const _0x1a988a=a33_0x32f77c;switch(_0x4843ff[_0x1a988a(0x88)]){case _0x1a988a(0xb3):return _0x4843ff[_0x1a988a(0xa8)];case _0x1a988a(0x146):return-(_0x4843ff['chargebackAmount']||0x0);case'REFUND':return 0x0;default:return 0x0;}}async['createPayout'](_0x59547d){const _0x56b9ff=a33_0x32f77c,{shopId:_0x206845,amount:_0x55dacd,network:_0x53b777,notes:_0x2787c6}=_0x59547d;console[_0x56b9ff(0xbb)]('üí∏\x20Creating\x20payout\x20for\x20shop\x20'+_0x206845+':\x20'+_0x55dacd+'\x20USDT\x20via\x20'+_0x53b777);const _0x12229a=await database_1[_0x56b9ff(0x80)][_0x56b9ff(0xe2)][_0x56b9ff(0x86)]({'where':{'id':_0x206845},'select':{'id':!![],'name':!![],'username':!![],'status':!![]}});if(!_0x12229a)throw new Error(_0x56b9ff(0x82));if(_0x12229a['status']!==_0x56b9ff(0x13a))throw new Error('Shop\x20is\x20not\x20active');const _0x576d11=await database_1[_0x56b9ff(0x80)]['payout'][_0x56b9ff(0x13c)]({'data':{'shopId':_0x206845,'amount':_0x55dacd,'network':_0x53b777,'status':'COMPLETED','notes':_0x2787c6||null,'paidAt':new Date()},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});await this[_0x56b9ff(0xe9)](_0x206845,_0x55dacd);try{await telegramBotService_1[_0x56b9ff(0x143)][_0x56b9ff(0x13f)](_0x206845,_0x576d11,_0x56b9ff(0xd6));}catch(_0x11381d){console['error'](_0x56b9ff(0xed),_0x11381d);}return console['log'](_0x56b9ff(0xb1)+_0x576d11['id']),{'id':_0x576d11['id'],'shopId':_0x576d11[_0x56b9ff(0x7d)],'shopName':_0x576d11[_0x56b9ff(0xe2)][_0x56b9ff(0xd2)],'shopUsername':_0x576d11[_0x56b9ff(0xe2)][_0x56b9ff(0x131)],'amount':_0x576d11[_0x56b9ff(0xa8)],'network':_0x576d11[_0x56b9ff(0xe0)],'status':_0x576d11[_0x56b9ff(0x88)],'txid':_0x576d11['txid'],'notes':_0x576d11[_0x56b9ff(0x12e)],'createdAt':_0x576d11['createdAt'],'paidAt':_0x576d11[_0x56b9ff(0x100)]};}async['markPaymentsAsPaidOut'](_0x4a0c7d,_0xb82440){const _0x2d8fdb=a33_0x32f77c;console['log'](_0x2d8fdb(0xcd)+_0x4a0c7d+',\x20amount:\x20'+_0xb82440+_0x2d8fdb(0x148));const _0x3417e7=await database_1[_0x2d8fdb(0x80)][_0x2d8fdb(0xab)][_0x2d8fdb(0xe6)]({'where':{'shopId':_0x4a0c7d,'status':'PAID','merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'shop':{'select':{'gatewaySettings':!![]}}},'orderBy':{'paidAt':'asc'}});let _0x3b9470=_0xb82440;const _0x35d66a=[];for(const _0x5f3e43 of _0x3417e7){const _0x1ba75a={..._0x5f3e43,'status':_0x2d8fdb(0xb3),'merchantPaid':![],'shop':{'gatewaySettings':_0x5f3e43[_0x2d8fdb(0xe2)][_0x2d8fdb(0x123)]}};if(!this['isEligibleForPayout'](_0x1ba75a))continue;const _0x26c71c=await currencyService_1[_0x2d8fdb(0x89)]['convertToUSDT'](_0x5f3e43[_0x2d8fdb(0xa8)],_0x5f3e43['currency']),_0xda392b=this[_0x2d8fdb(0xdf)](_0x5f3e43[_0x2d8fdb(0xe2)],_0x5f3e43[_0x2d8fdb(0x14d)]),_0x40830b=this[_0x2d8fdb(0x152)](_0x26c71c,_0xda392b['commission']);if(_0x40830b<=_0x3b9470){_0x35d66a[_0x2d8fdb(0xaf)](_0x5f3e43['id']),_0x3b9470-=_0x40830b;if(_0x3b9470<=0.01)break;}}_0x35d66a[_0x2d8fdb(0x8d)]>0x0&&(await database_1[_0x2d8fdb(0x80)][_0x2d8fdb(0xab)][_0x2d8fdb(0xc7)]({'where':{'id':{'in':_0x35d66a}},'data':{'merchantPaid':!![]}}),console[_0x2d8fdb(0xbb)](_0x2d8fdb(0xc4)+_0x35d66a['length']+_0x2d8fdb(0xe8)));}async[a33_0x32f77c(0x98)](_0x4acbf7){const _0x556ccd=a33_0x32f77c,{page:_0x10cdc2,limit:_0x34ed27,shopId:_0x504f7f,network:_0x533259,dateFrom:_0x2a4d74,dateTo:_0x43bf10,search:_0x1a2cb8}=_0x4acbf7,_0x4fd17b=(_0x10cdc2-0x1)*_0x34ed27;console[_0x556ccd(0xbb)](_0x556ccd(0xd0),_0x4acbf7);const _0x28f383={};_0x504f7f&&(_0x28f383[_0x556ccd(0x7d)]=_0x504f7f);_0x533259&&(_0x28f383[_0x556ccd(0xe0)]=_0x533259);(_0x2a4d74||_0x43bf10)&&(_0x28f383[_0x556ccd(0xc0)]={},_0x2a4d74&&(_0x28f383['createdAt']['gte']=new Date(_0x2a4d74)),_0x43bf10&&(_0x28f383[_0x556ccd(0xc0)]['lte']=new Date(_0x43bf10)));_0x1a2cb8&&(_0x28f383['OR']=[{'txid':{'contains':_0x1a2cb8,'mode':_0x556ccd(0xb2)}},{'notes':{'contains':_0x1a2cb8,'mode':_0x556ccd(0xb2)}},{'shop':{'name':{'contains':_0x1a2cb8,'mode':_0x556ccd(0xb2)}}},{'shop':{'username':{'contains':_0x1a2cb8,'mode':_0x556ccd(0xb2)}}}]);const [_0x567cb4,_0x1016da]=await Promise[_0x556ccd(0x7f)]([database_1[_0x556ccd(0x80)]['payout']['findMany']({'where':_0x28f383,'skip':_0x4fd17b,'take':_0x34ed27,'orderBy':{'createdAt':_0x556ccd(0xc3)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x556ccd(0x80)][_0x556ccd(0xfa)]['count']({'where':_0x28f383})]);console['log']('üìä\x20Found\x20'+_0x567cb4['length']+_0x556ccd(0x9e)+_0x1016da+_0x556ccd(0x83));const _0x524d2c=_0x567cb4['map'](_0x3f6bf2=>({'id':_0x3f6bf2['id'],'shopId':_0x3f6bf2[_0x556ccd(0x7d)],'shopName':_0x3f6bf2[_0x556ccd(0xe2)][_0x556ccd(0xd2)],'shopUsername':_0x3f6bf2['shop'][_0x556ccd(0x131)],'amount':_0x3f6bf2[_0x556ccd(0xa8)],'network':_0x3f6bf2[_0x556ccd(0xe0)],'status':_0x3f6bf2[_0x556ccd(0x88)],'txid':_0x3f6bf2[_0x556ccd(0x91)],'notes':_0x3f6bf2[_0x556ccd(0x12e)],'createdAt':_0x3f6bf2['createdAt'],'paidAt':_0x3f6bf2[_0x556ccd(0x100)]}));return{'payouts':_0x524d2c,'pagination':{'page':_0x10cdc2,'limit':_0x34ed27,'total':_0x1016da,'totalPages':Math['ceil'](_0x1016da/_0x34ed27)}};}async[a33_0x32f77c(0xf5)](_0x26e170){const _0x2852be=a33_0x32f77c;console[_0x2852be(0xbb)](_0x2852be(0x87)+_0x26e170);const _0x4ea8f1=await database_1[_0x2852be(0x80)][_0x2852be(0xfa)][_0x2852be(0x86)]({'where':{'id':_0x26e170},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x4ea8f1)return console[_0x2852be(0xbb)](_0x2852be(0xd8)+_0x26e170),null;return console[_0x2852be(0xbb)](_0x2852be(0xf0)+_0x4ea8f1[_0x2852be(0xa8)]+_0x2852be(0xe4)+_0x4ea8f1[_0x2852be(0xe0)]),{'id':_0x4ea8f1['id'],'shopId':_0x4ea8f1[_0x2852be(0x7d)],'shopName':_0x4ea8f1[_0x2852be(0xe2)][_0x2852be(0xd2)],'shopUsername':_0x4ea8f1[_0x2852be(0xe2)]['username'],'amount':_0x4ea8f1['amount'],'network':_0x4ea8f1['network'],'status':_0x4ea8f1[_0x2852be(0x88)],'txid':_0x4ea8f1[_0x2852be(0x91)],'notes':_0x4ea8f1[_0x2852be(0x12e)],'createdAt':_0x4ea8f1['createdAt'],'paidAt':_0x4ea8f1[_0x2852be(0x100)]};}async[a33_0x32f77c(0xba)](_0x28cf7b){const _0x4adb91=a33_0x32f77c;console['log']('üóëÔ∏è\x20Deleting\x20payout:\x20'+_0x28cf7b);const _0x54175b=await database_1[_0x4adb91(0x80)][_0x4adb91(0xfa)]['findUnique']({'where':{'id':_0x28cf7b},'select':{'id':!![],'shopId':!![],'amount':!![]}});if(!_0x54175b)throw new Error(_0x4adb91(0x129));await database_1['default']['payout'][_0x4adb91(0x9f)]({'where':{'id':_0x28cf7b}}),console[_0x4adb91(0xbb)](_0x4adb91(0x10e)+_0x28cf7b+_0x4adb91(0xa4));}async[a33_0x32f77c(0x11c)](_0x23ca78){const _0x2108a9=a33_0x32f77c,{page:_0x1e3639,limit:_0xbc475c,minAmount:_0x1c63c3,search:_0x5bbe4b}=_0x23ca78;console[_0x2108a9(0xbb)](_0x2108a9(0x97),_0x23ca78);const _0x24cb7a=await database_1['default'][_0x2108a9(0xab)][_0x2108a9(0xe6)]({'where':{'status':_0x2108a9(0xb3),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'createdAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'gatewaySettings':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}});console['log']('üí∞\x20Found\x20'+_0x24cb7a[_0x2108a9(0x8d)]+'\x20eligible\x20PAID\x20payments\x20for\x20payout\x20analysis');const _0x19434a=new Map();for(const _0x307d9d of _0x24cb7a){const _0x5a212e={..._0x307d9d,'status':_0x2108a9(0xb3),'merchantPaid':![],'shop':{'gatewaySettings':_0x307d9d[_0x2108a9(0xe2)]['gatewaySettings']}},_0x383516=this[_0x2108a9(0xe7)](_0x5a212e);if(!_0x383516)continue;const _0x401418=await currencyService_1[_0x2108a9(0x89)]['convertToUSDT'](_0x307d9d[_0x2108a9(0xa8)],_0x307d9d[_0x2108a9(0xea)]),_0x216606=this[_0x2108a9(0xdf)](_0x307d9d[_0x2108a9(0xe2)],_0x307d9d[_0x2108a9(0x14d)]),_0x14ac95=this[_0x2108a9(0x152)](_0x401418,_0x216606[_0x2108a9(0xe5)]),_0x4b02fc=_0x307d9d['shopId'];!_0x19434a[_0x2108a9(0x8b)](_0x4b02fc)&&_0x19434a['set'](_0x4b02fc,{'shop':_0x307d9d[_0x2108a9(0xe2)],'payments':[]}),_0x19434a['get'](_0x4b02fc)['payments'][_0x2108a9(0xaf)]({'id':_0x307d9d['id'],'amount':_0x307d9d[_0x2108a9(0xa8)],'currency':_0x307d9d[_0x2108a9(0xea)],'gateway':_0x307d9d[_0x2108a9(0x14d)],'paidAt':_0x307d9d[_0x2108a9(0x100)],'createdAt':_0x307d9d[_0x2108a9(0xc0)],'amountUSDT':_0x401418,'commission':_0x216606['commission'],'amountAfterCommissionUSDT':_0x14ac95,'isEligible':!![]});}console[_0x2108a9(0xbb)](_0x2108a9(0x130)+_0x19434a[_0x2108a9(0x147)]+'\x20merchants\x20with\x20eligible\x20PAID\x20payments');const _0x1bbd3a=[];for(const [_0x549d7f,_0x1a27f8]of _0x19434a){const {shop:_0xe60c4c,payments:_0x24557e}=_0x1a27f8,_0x5df3fe=_0x24557e['reduce']((_0x1be9b5,_0x359450)=>_0x1be9b5+_0x359450[_0x2108a9(0x128)],0x0),_0xa37f3c=_0x24557e[_0x2108a9(0x127)]((_0x255493,_0x213092)=>_0x255493+_0x213092['amountAfterCommissionUSDT'],0x0);if(_0x1c63c3&&_0xa37f3c<_0x1c63c3)continue;if(_0x5bbe4b){const _0x4d36a4=_0x5bbe4b['toLowerCase'](),_0x1e2424=_0xe60c4c['name']['toLowerCase']()['includes'](_0x4d36a4)||_0xe60c4c[_0x2108a9(0x131)][_0x2108a9(0x145)]()['includes'](_0x4d36a4)||_0xe60c4c[_0x2108a9(0xdb)]&&_0xe60c4c[_0x2108a9(0xdb)][_0x2108a9(0x145)]()[_0x2108a9(0xbc)](_0x4d36a4);if(!_0x1e2424)continue;}const _0x6bc59f=new Map();for(const _0x5b39f9 of _0x24557e){const _0x19eb06=_0x5b39f9[_0x2108a9(0x14d)];!_0x6bc59f[_0x2108a9(0x8b)](_0x19eb06)&&_0x6bc59f[_0x2108a9(0x10b)](_0x19eb06,{'count':0x0,'amountUSDT':0x0,'amountAfterCommissionUSDT':0x0,'commission':_0x5b39f9[_0x2108a9(0xe5)]});const _0x1abb1e=_0x6bc59f['get'](_0x19eb06);_0x1abb1e[_0x2108a9(0x132)]++,_0x1abb1e[_0x2108a9(0x128)]+=_0x5b39f9[_0x2108a9(0x128)],_0x1abb1e[_0x2108a9(0xa0)]+=_0x5b39f9['amountAfterCommissionUSDT'];}const _0x5319bb=Array[_0x2108a9(0xec)](_0x6bc59f[_0x2108a9(0x90)]())[_0x2108a9(0xd9)](([_0x33e5c2,_0x5a0ec0])=>({'gateway':_0x33e5c2[_0x2108a9(0xde)](0x0)[_0x2108a9(0x151)]()+_0x33e5c2[_0x2108a9(0xc2)](0x1),'count':_0x5a0ec0[_0x2108a9(0x132)],'amountUSDT':Math[_0x2108a9(0x10a)](_0x5a0ec0[_0x2108a9(0x128)]*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x2108a9(0x10a)](_0x5a0ec0[_0x2108a9(0xa0)]*0x64)/0x64,'commission':_0x5a0ec0[_0x2108a9(0xe5)]})),_0x27d46c=_0x24557e[_0x2108a9(0x127)]((_0x4b70dd,_0x2cd84c)=>{const _0x51300f=_0x2108a9;return _0x2cd84c[_0x51300f(0x100)]<_0x4b70dd?_0x2cd84c[_0x51300f(0x100)]:_0x4b70dd;},_0x24557e[0x0][_0x2108a9(0x100)]);_0x1bbd3a[_0x2108a9(0xaf)]({'id':_0xe60c4c['id'],'fullName':_0xe60c4c[_0x2108a9(0xd2)],'username':_0xe60c4c['username'],'telegramId':_0xe60c4c['telegram'],'merchantUrl':_0xe60c4c[_0x2108a9(0x154)],'wallets':{'usdtPolygonWallet':_0xe60c4c[_0x2108a9(0x9a)],'usdtTrcWallet':_0xe60c4c[_0x2108a9(0x10c)],'usdtErcWallet':_0xe60c4c[_0x2108a9(0x107)],'usdcPolygonWallet':_0xe60c4c['usdcPolygonWallet']},'totalAmountUSDT':Math[_0x2108a9(0x10a)](_0x5df3fe*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x2108a9(0x10a)](_0xa37f3c*0x64)/0x64,'paymentsCount':_0x24557e[_0x2108a9(0x8d)],'oldestPaymentDate':_0x27d46c,'gatewayBreakdown':_0x5319bb});}_0x1bbd3a[_0x2108a9(0x116)]((_0xa81f88,_0x5df570)=>_0x5df570[_0x2108a9(0x153)]-_0xa81f88['totalAmountAfterCommissionUSDT']);const _0x30e31c=_0x1bbd3a[_0x2108a9(0x8d)],_0x51b196=_0x1bbd3a[_0x2108a9(0x127)]((_0x4f58d4,_0x30dd42)=>_0x4f58d4+_0x30dd42[_0x2108a9(0xc8)],0x0),_0x10d126=_0x1bbd3a['reduce']((_0x4fbe77,_0x301572)=>_0x4fbe77+_0x301572['totalAmountAfterCommissionUSDT'],0x0),_0x166263=(_0x1e3639-0x1)*_0xbc475c,_0x4a5c67=_0x1bbd3a[_0x2108a9(0xc2)](_0x166263,_0x166263+_0xbc475c);return console[_0x2108a9(0xbb)](_0x2108a9(0xbe)+_0x4a5c67[_0x2108a9(0x8d)]+_0x2108a9(0xa7)+_0x30e31c+_0x2108a9(0x83)),console[_0x2108a9(0xbb)](_0x2108a9(0x11a)+_0x51b196[_0x2108a9(0x9b)](0x2)+_0x2108a9(0x14b)+_0x10d126[_0x2108a9(0x9b)](0x2)+'\x20USDT\x20after\x20commission)'),{'merchants':_0x4a5c67,'pagination':{'page':_0x1e3639,'limit':_0xbc475c,'total':_0x30e31c,'totalPages':Math[_0x2108a9(0xd1)](_0x30e31c/_0xbc475c)},'summary':{'totalMerchants':_0x30e31c,'totalAmountUSDT':Math['round'](_0x51b196*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x10d126*0x64)/0x64}};}async[a33_0x32f77c(0x135)](){const _0x38b158=a33_0x32f77c;console[_0x38b158(0xbb)](_0x38b158(0x93));const _0x5001c9=await database_1['default'][_0x38b158(0xab)][_0x38b158(0xe6)]({'where':{'status':{'in':[_0x38b158(0xb3),_0x38b158(0x108),_0x38b158(0x146)]}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'status':!![],'gateway':!![],'paidAt':!![],'merchantPaid':!![],'createdAt':!![],'chargebackAmount':!![],'shop':{'select':{'gatewaySettings':!![]}}}});console[_0x38b158(0xbb)]('üí∞\x20Found\x20'+_0x5001c9['length']+_0x38b158(0xff));const _0x121697=new Date(),_0x5db207=new Date(_0x121697[_0x38b158(0x11d)](),_0x121697['getMonth'](),0x1),_0x5469d3=new Date(_0x121697['getFullYear'](),_0x121697[_0x38b158(0x14a)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7);let _0x15e469=0x0,_0x4a00ca=0x0,_0x5976b4=0x0,_0x2a974f=0x0;for(const _0x5d091a of _0x5001c9){const _0x226fc7=this[_0x38b158(0x104)](_0x5d091a);if(_0x226fc7===0x0)continue;let _0xab4f5d,_0x10dcad;if(_0x5d091a[_0x38b158(0x88)]===_0x38b158(0x146))_0xab4f5d=Math[_0x38b158(0xa2)](_0x226fc7),_0x10dcad=-_0xab4f5d;else{_0xab4f5d=await currencyService_1[_0x38b158(0x89)][_0x38b158(0xa9)](_0x5d091a[_0x38b158(0xa8)],_0x5d091a[_0x38b158(0xea)]);const _0x1e9e17=this[_0x38b158(0xdf)](_0x5d091a[_0x38b158(0xe2)],_0x5d091a['gateway']);_0x10dcad=this[_0x38b158(0x152)](_0xab4f5d,_0x1e9e17['commission']);}_0x5d091a[_0x38b158(0x117)]&&(_0x15e469+=_0x10dcad,_0x5d091a[_0x38b158(0x100)]&&_0x5d091a[_0x38b158(0x100)]>=_0x5db207&&_0x5d091a[_0x38b158(0x100)]<=_0x5469d3&&(_0x5976b4+=_0x10dcad)),_0x5d091a[_0x38b158(0x88)]==='PAID'&&this['isEligibleForPayout'](_0x5d091a)&&(_0x4a00ca+=_0x10dcad,_0x2a974f+=_0xab4f5d);}const _0x46b8ab={'totalPayout':Math[_0x38b158(0x10a)](_0x15e469*0x64)/0x64,'awaitingPayout':Math[_0x38b158(0x10a)](_0x4a00ca*0x64)/0x64,'thisMonth':Math[_0x38b158(0x10a)](_0x5976b4*0x64)/0x64,'availableBalance':Math[_0x38b158(0x10a)](_0x2a974f*0x64)/0x64};return console[_0x38b158(0xbb)](_0x38b158(0x9d)),console[_0x38b158(0xbb)](_0x38b158(0xc9)+_0x46b8ab['totalPayout']+_0x38b158(0xfc)),console[_0x38b158(0xbb)](_0x38b158(0xe3)+_0x46b8ab[_0x38b158(0x11f)]+_0x38b158(0x136)),console[_0x38b158(0xbb)](_0x38b158(0x11e)+_0x46b8ab[_0x38b158(0xaa)]+'\x20USDT'),console[_0x38b158(0xbb)](_0x38b158(0x109)+_0x46b8ab[_0x38b158(0x110)]+_0x38b158(0x148)),_0x46b8ab;}async[a33_0x32f77c(0x119)](_0x5d1460){const _0xd79cf1=a33_0x32f77c,_0x3fc32c=this[_0xd79cf1(0x137)](_0x5d1460),_0x59de5b=new Date();_0x59de5b[_0xd79cf1(0x125)](_0x59de5b[_0xd79cf1(0x12d)]()-_0x3fc32c),console[_0xd79cf1(0xbb)](_0xd79cf1(0xc5)+_0x5d1460+'\x20('+_0x3fc32c+'\x20days)');const _0x13eeb4=await database_1['default']['shop'][_0xd79cf1(0x132)]({'where':{'status':'ACTIVE'}}),_0xf1d6f0=await database_1[_0xd79cf1(0x80)][_0xd79cf1(0xab)][_0xd79cf1(0x132)](),_0x2c48f4=await database_1[_0xd79cf1(0x80)]['payment'][_0xd79cf1(0xe6)]({'where':{'status':{'in':[_0xd79cf1(0xb3),_0xd79cf1(0x108),_0xd79cf1(0x146)]}},'select':{'amount':!![],'currency':!![],'status':!![],'chargebackAmount':!![],'createdAt':!![]}});console[_0xd79cf1(0xbb)]('üí∞\x20Found\x20'+_0x2c48f4[_0xd79cf1(0x8d)]+'\x20payments\x20for\x20revenue\x20calculation\x20(PAID/REFUND/CHARGEBACK)');const _0x3f3dbc=await Promise[_0xd79cf1(0x7f)](_0x2c48f4[_0xd79cf1(0xd9)](async _0xe4f35d=>{const _0x193266=_0xd79cf1,_0x50c175=this['calculateEffectiveAmount'](_0xe4f35d);if(_0x50c175===0x0)return{'amount':0x0,'createdAt':_0xe4f35d[_0x193266(0xc0)]};let _0x164dc6;return _0xe4f35d[_0x193266(0x88)]===_0x193266(0x146)?_0x164dc6=-Math[_0x193266(0xa2)](_0x50c175):_0x164dc6=await currencyService_1[_0x193266(0x89)]['convertToUSDT'](_0xe4f35d[_0x193266(0xa8)],_0xe4f35d[_0x193266(0xea)]),{'amount':_0x164dc6,'createdAt':_0xe4f35d[_0x193266(0xc0)]};})),_0x7896fa=_0x3f3dbc['reduce']((_0x3d6c02,_0x3d1d55)=>_0x3d6c02+_0x3d1d55['amount'],0x0),_0x6cb77d=_0xf1d6f0>0x0?_0x7896fa/_0xf1d6f0:0x0;console[_0xd79cf1(0xbb)](_0xd79cf1(0x134)+_0x7896fa[_0xd79cf1(0x9b)](0x2)+_0xd79cf1(0xfc)),console[_0xd79cf1(0xbb)](_0xd79cf1(0xd5)+_0x6cb77d['toFixed'](0x2)+'\x20USDT');const _0x40ef39=await database_1[_0xd79cf1(0x80)][_0xd79cf1(0x9c)]`
      SELECT 
        DATE(created_at) as date,
        array_agg(
          json_build_object(
            'amount', amount,
            'currency', currency,
            'status', status,
            'chargeback_amount', chargeback_amount
          )
        ) as payments
      FROM payments 
      WHERE created_at >= ${_0x59de5b}
        AND status IN ('PAID', 'REFUND', 'CHARGEBACK')
      GROUP BY DATE(created_at)
      ORDER BY date ASC
    `;console[_0xd79cf1(0xbb)](_0xd79cf1(0xb7)+_0x40ef39[_0xd79cf1(0x8d)]+_0xd79cf1(0xbd));const _0x591f4a=await Promise[_0xd79cf1(0x7f)](_0x40ef39[_0xd79cf1(0xd9)](async _0x2e8b26=>{const _0x1d2fa9=_0xd79cf1,_0x35ef43=await Promise[_0x1d2fa9(0x7f)](_0x2e8b26[_0x1d2fa9(0x13e)][_0x1d2fa9(0xd9)](async _0x370213=>{const _0x2e1b68=_0x1d2fa9,_0x3dcf21=this[_0x2e1b68(0x104)](_0x370213);if(_0x3dcf21===0x0)return 0x0;return _0x370213[_0x2e1b68(0x88)]===_0x2e1b68(0x146)?-Math[_0x2e1b68(0xa2)](_0x3dcf21):await currencyService_1[_0x2e1b68(0x89)][_0x2e1b68(0xa9)](_0x370213['amount'],_0x370213[_0x2e1b68(0xea)]);})),_0x41ffe6=_0x35ef43['reduce']((_0x5ba8cb,_0x1bbcf5)=>_0x5ba8cb+_0x1bbcf5,0x0);return{'date':_0x2e8b26[_0x1d2fa9(0x113)]['toISOString']()[_0x1d2fa9(0xcc)]('T')[0x0],'amount':_0x41ffe6};})),_0x419079=this[_0xd79cf1(0x8f)](_0x59de5b,new Date()),_0x16efd9=new Map(_0x591f4a[_0xd79cf1(0xd9)](_0x266ff3=>[_0x266ff3[_0xd79cf1(0x113)],_0x266ff3[_0xd79cf1(0xa8)]])),_0x1c9e08=_0x419079[_0xd79cf1(0xd9)](_0x267c7f=>({'date':_0x267c7f,'amount':_0x16efd9[_0xd79cf1(0xa5)](_0x267c7f)||0x0}));return console[_0xd79cf1(0xbb)](_0xd79cf1(0x10f)),console['log'](_0xd79cf1(0x92)+_0x13eeb4),console[_0xd79cf1(0xbb)]('üí≥\x20Total\x20payments:\x20'+_0xf1d6f0),console[_0xd79cf1(0xbb)](_0xd79cf1(0x120)+_0x1c9e08['length']),{'totalRevenue':Math[_0xd79cf1(0x10a)](_0x7896fa*0x64)/0x64,'totalUsers':_0x13eeb4,'totalPayments':_0xf1d6f0,'averagePayment':Math['round'](_0x6cb77d*0x64)/0x64,'dailyRevenue':_0x1c9e08};}async[a33_0x32f77c(0x139)](_0x3d0210){const _0x5040ba=a33_0x32f77c,{page:_0x5e8039,limit:_0x53348f,status:_0x4dbbe6,gateway:_0x58620e,shopId:_0xdde649,dateFrom:_0x2451fb,dateTo:_0x3af9ef,search:_0x3dbe47}=_0x3d0210,_0x4d0292=(_0x5e8039-0x1)*_0x53348f;console[_0x5040ba(0xbb)](_0x5040ba(0xac),_0x3d0210);const _0x154aca={};_0x4dbbe6&&(_0x154aca['status']=_0x4dbbe6[_0x5040ba(0x151)]());if(_0x58620e){if((0x0,gateway_1[_0x5040ba(0x124)])(_0x58620e)){const _0x5d1dd9=(0x0,gateway_1[_0x5040ba(0xd4)])(_0x58620e);_0x5d1dd9&&(_0x154aca[_0x5040ba(0x14d)]=_0x5d1dd9);}else _0x154aca[_0x5040ba(0x14d)]=_0x58620e[_0x5040ba(0x145)]();}_0xdde649&&(_0x154aca['shopId']=_0xdde649);(_0x2451fb||_0x3af9ef)&&(_0x154aca[_0x5040ba(0xc0)]={},_0x2451fb&&(_0x154aca[_0x5040ba(0xc0)]['gte']=new Date(_0x2451fb)),_0x3af9ef&&(_0x154aca['createdAt']['lte']=new Date(_0x3af9ef)));_0x3dbe47&&(_0x154aca['OR']=[{'orderId':{'contains':_0x3dbe47,'mode':_0x5040ba(0xb2)}},{'gatewayOrderId':{'contains':_0x3dbe47,'mode':_0x5040ba(0xb2)}},{'gatewayPaymentId':{'contains':_0x3dbe47,'mode':_0x5040ba(0xb2)}},{'customerEmail':{'contains':_0x3dbe47,'mode':_0x5040ba(0xb2)}},{'customerName':{'contains':_0x3dbe47,'mode':_0x5040ba(0xb2)}},{'shop':{'name':{'contains':_0x3dbe47,'mode':_0x5040ba(0xb2)}}},{'shop':{'username':{'contains':_0x3dbe47,'mode':'insensitive'}}}]);const [_0x34036c,_0x4dda54]=await Promise[_0x5040ba(0x7f)]([database_1[_0x5040ba(0x80)][_0x5040ba(0xab)][_0x5040ba(0xe6)]({'where':_0x154aca,'skip':_0x4d0292,'take':_0x53348f,'orderBy':{'createdAt':_0x5040ba(0xc3)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x5040ba(0x80)]['payment'][_0x5040ba(0x132)]({'where':_0x154aca})]);console[_0x5040ba(0xbb)](_0x5040ba(0xad)+_0x34036c[_0x5040ba(0x8d)]+_0x5040ba(0x149)+_0x4dda54+_0x5040ba(0x83));const _0x3c6423=_0x34036c[_0x5040ba(0xd9)](_0x41d5d6=>({'id':_0x41d5d6['id'],'shopId':_0x41d5d6[_0x5040ba(0x7d)],'shopName':_0x41d5d6[_0x5040ba(0xe2)][_0x5040ba(0xd2)],'shopUsername':_0x41d5d6['shop'][_0x5040ba(0x131)],'gateway':_0x41d5d6[_0x5040ba(0x14d)],'orderId':_0x41d5d6[_0x5040ba(0xc6)],'gatewayOrderId':_0x41d5d6[_0x5040ba(0x84)],'amount':_0x41d5d6[_0x5040ba(0xa8)],'currency':_0x41d5d6[_0x5040ba(0xea)],'sourceCurrency':_0x41d5d6['sourceCurrency'],'status':_0x41d5d6['status'],'usage':_0x41d5d6[_0x5040ba(0xfb)],'externalPaymentUrl':_0x41d5d6[_0x5040ba(0x142)],'gatewayPaymentId':_0x41d5d6[_0x5040ba(0xb8)],'customerEmail':_0x41d5d6[_0x5040ba(0xcb)],'customerName':_0x41d5d6[_0x5040ba(0x106)],'cardLast4':_0x41d5d6[_0x5040ba(0xae)],'paymentMethod':_0x41d5d6[_0x5040ba(0xca)],'bankId':_0x41d5d6['bankId'],'remitterIban':_0x41d5d6[_0x5040ba(0x103)],'remitterName':_0x41d5d6[_0x5040ba(0x14e)],'chargebackAmount':_0x41d5d6['chargebackAmount'],'adminNotes':_0x41d5d6[_0x5040ba(0x155)],'statusChangedBy':_0x41d5d6[_0x5040ba(0xfd)],'statusChangedAt':_0x41d5d6[_0x5040ba(0x13b)],'createdAt':_0x41d5d6[_0x5040ba(0xc0)],'updatedAt':_0x41d5d6[_0x5040ba(0x81)],'expiresAt':_0x41d5d6[_0x5040ba(0x141)]}));return{'payments':_0x3c6423,'pagination':{'page':_0x5e8039,'limit':_0x53348f,'total':_0x4dda54,'totalPages':Math[_0x5040ba(0xd1)](_0x4dda54/_0x53348f)}};}async[a33_0x32f77c(0xf3)](_0x2f927c){const _0x4d32a2=a33_0x32f77c;console['log'](_0x4d32a2(0x11b)+_0x2f927c);const _0x1d44df=await database_1[_0x4d32a2(0x80)][_0x4d32a2(0xab)][_0x4d32a2(0x86)]({'where':{'id':_0x2f927c},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}},'webhookLogs':{'orderBy':{'createdAt':_0x4d32a2(0xc3)},'take':0xa,'select':{'id':!![],'event':!![],'statusCode':!![],'retryCount':!![],'createdAt':!![]}}}});if(!_0x1d44df)return console[_0x4d32a2(0xbb)](_0x4d32a2(0x8a)+_0x2f927c),null;return console[_0x4d32a2(0xbb)]('‚úÖ\x20Found\x20payment:\x20'+_0x1d44df[_0x4d32a2(0xc6)]+'\x20('+_0x1d44df[_0x4d32a2(0x88)]+')'),{'id':_0x1d44df['id'],'shopId':_0x1d44df['shopId'],'shopName':_0x1d44df[_0x4d32a2(0xe2)][_0x4d32a2(0xd2)],'shopUsername':_0x1d44df[_0x4d32a2(0xe2)]['username'],'gateway':_0x1d44df[_0x4d32a2(0x14d)],'orderId':_0x1d44df[_0x4d32a2(0xc6)],'gatewayOrderId':_0x1d44df[_0x4d32a2(0x84)],'amount':_0x1d44df['amount'],'currency':_0x1d44df[_0x4d32a2(0xea)],'sourceCurrency':_0x1d44df[_0x4d32a2(0x8c)],'status':_0x1d44df[_0x4d32a2(0x88)],'usage':_0x1d44df[_0x4d32a2(0xfb)],'externalPaymentUrl':_0x1d44df[_0x4d32a2(0x142)],'gatewayPaymentId':_0x1d44df['gatewayPaymentId'],'customerEmail':_0x1d44df[_0x4d32a2(0xcb)],'customerName':_0x1d44df[_0x4d32a2(0x106)],'cardLast4':_0x1d44df[_0x4d32a2(0xae)],'paymentMethod':_0x1d44df['paymentMethod'],'bankId':_0x1d44df[_0x4d32a2(0xa3)],'remitterIban':_0x1d44df[_0x4d32a2(0x103)],'remitterName':_0x1d44df['remitterName'],'chargebackAmount':_0x1d44df['chargebackAmount'],'adminNotes':_0x1d44df[_0x4d32a2(0x155)],'statusChangedBy':_0x1d44df[_0x4d32a2(0xfd)],'statusChangedAt':_0x1d44df[_0x4d32a2(0x13b)],'createdAt':_0x1d44df[_0x4d32a2(0xc0)],'updatedAt':_0x1d44df[_0x4d32a2(0x81)],'expiresAt':_0x1d44df[_0x4d32a2(0x141)],'webhookLogs':_0x1d44df['webhookLogs']};}async[a33_0x32f77c(0xf1)](_0x1357f7,_0x468351,_0x2436c0,_0x2df905){const _0x3656ec=a33_0x32f77c;console[_0x3656ec(0xbb)](_0x3656ec(0xda)+_0x1357f7+'\x20status\x20to:\x20'+_0x468351);const _0x20e719=[_0x3656ec(0xf4),_0x3656ec(0xfe),_0x3656ec(0xb3),_0x3656ec(0x95),_0x3656ec(0x122),_0x3656ec(0x108),'CHARGEBACK'];if(!_0x20e719[_0x3656ec(0xbc)](_0x468351['toUpperCase']()))throw new Error(_0x3656ec(0xf8)+_0x20e719[_0x3656ec(0x111)](',\x20'));const _0x3a10bd=await database_1[_0x3656ec(0x80)][_0x3656ec(0xab)]['findUnique']({'where':{'id':_0x1357f7},'select':{'id':!![],'status':!![],'orderId':!![]}});if(!_0x3a10bd)throw new Error('Payment\x20not\x20found');if(_0x468351[_0x3656ec(0x151)]()==='CHARGEBACK'){if(!_0x2df905||_0x2df905<=0x0)throw new Error('Chargeback\x20amount\x20is\x20required\x20and\x20must\x20be\x20positive\x20(amount\x20in\x20USDT)');console[_0x3656ec(0xbb)](_0x3656ec(0xa1)+_0x2df905+_0x3656ec(0xc1));}const _0x4b6e95={'status':_0x468351[_0x3656ec(0x151)](),'updatedAt':new Date()};_0x2436c0&&(_0x4b6e95[_0x3656ec(0x155)]=_0x2436c0);_0x468351[_0x3656ec(0x151)]()===_0x3656ec(0x146)&&_0x2df905&&(_0x4b6e95[_0x3656ec(0x96)]=_0x2df905);const _0x16d0ec=await database_1[_0x3656ec(0x80)]['payment'][_0x3656ec(0xf9)]({'where':{'id':_0x1357f7},'data':_0x4b6e95,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});return await database_1[_0x3656ec(0x80)]['webhookLog'][_0x3656ec(0x13c)]({'data':{'paymentId':_0x1357f7,'shopId':_0x16d0ec[_0x3656ec(0x7d)],'event':_0x3656ec(0x138),'statusCode':0xc8,'responseBody':JSON['stringify']({'oldStatus':_0x3a10bd['status'],'newStatus':_0x468351['toUpperCase'](),'notes':_0x2436c0||null,'chargebackAmount':_0x2df905||null,'timestamp':new Date()['toISOString']()})}}),console['log']('‚úÖ\x20Payment\x20'+_0x3a10bd[_0x3656ec(0xc6)]+'\x20status\x20updated\x20from\x20'+_0x3a10bd[_0x3656ec(0x88)]+'\x20to\x20'+_0x468351[_0x3656ec(0x151)]()),_0x468351[_0x3656ec(0x151)]()===_0x3656ec(0x146)&&console[_0x3656ec(0xbb)](_0x3656ec(0xf2)+_0x2df905+_0x3656ec(0xb5)),{'id':_0x16d0ec['id'],'shopId':_0x16d0ec[_0x3656ec(0x7d)],'shopName':_0x16d0ec[_0x3656ec(0xe2)]['name'],'shopUsername':_0x16d0ec[_0x3656ec(0xe2)][_0x3656ec(0x131)],'gateway':_0x16d0ec[_0x3656ec(0x14d)],'orderId':_0x16d0ec[_0x3656ec(0xc6)],'gatewayOrderId':_0x16d0ec[_0x3656ec(0x84)],'amount':_0x16d0ec[_0x3656ec(0xa8)],'currency':_0x16d0ec[_0x3656ec(0xea)],'sourceCurrency':_0x16d0ec[_0x3656ec(0x8c)],'status':_0x16d0ec[_0x3656ec(0x88)],'usage':_0x16d0ec[_0x3656ec(0xfb)],'externalPaymentUrl':_0x16d0ec[_0x3656ec(0x142)],'gatewayPaymentId':_0x16d0ec[_0x3656ec(0xb8)],'customerEmail':_0x16d0ec[_0x3656ec(0xcb)],'customerName':_0x16d0ec[_0x3656ec(0x106)],'cardLast4':_0x16d0ec['cardLast4'],'paymentMethod':_0x16d0ec['paymentMethod'],'bankId':_0x16d0ec['bankId'],'remitterIban':_0x16d0ec['remitterIban'],'remitterName':_0x16d0ec[_0x3656ec(0x14e)],'chargebackAmount':_0x16d0ec[_0x3656ec(0x96)],'adminNotes':_0x16d0ec[_0x3656ec(0x155)],'statusChangedBy':_0x16d0ec[_0x3656ec(0xfd)],'statusChangedAt':_0x16d0ec[_0x3656ec(0x13b)],'createdAt':_0x16d0ec[_0x3656ec(0xc0)],'updatedAt':_0x16d0ec[_0x3656ec(0x81)],'expiresAt':_0x16d0ec['expiresAt']};}async[a33_0x32f77c(0x121)](_0x214858){const _0x21c643=a33_0x32f77c,{page:_0x545de3,limit:_0x6f349a,status:_0x2c9e73}=_0x214858,_0x4c800a=(_0x545de3-0x1)*_0x6f349a,_0x3813d3={};_0x2c9e73&&(_0x3813d3['status']=_0x2c9e73[_0x21c643(0x151)]());console[_0x21c643(0xbb)](_0x21c643(0xb0),{'page':_0x545de3,'limit':_0x6f349a,'status':_0x2c9e73,'where':_0x3813d3});const [_0x49bd98,_0x5e3700]=await Promise['all']([database_1[_0x21c643(0x80)][_0x21c643(0xe2)][_0x21c643(0xe6)]({'where':_0x3813d3,'skip':_0x4c800a,'take':_0x6f349a,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x21c643(0xc3)}}),database_1[_0x21c643(0x80)][_0x21c643(0xe2)]['count']({'where':_0x3813d3})]);console[_0x21c643(0xbb)](_0x21c643(0xad)+_0x49bd98[_0x21c643(0x8d)]+_0x21c643(0xb6)+_0x5e3700+'\x20total');const _0x41a4c7=_0x49bd98[_0x21c643(0xd9)](_0x25e99e=>({'id':_0x25e99e['id'],'fullName':_0x25e99e[_0x21c643(0xd2)],'username':_0x25e99e['username'],'telegramId':_0x25e99e[_0x21c643(0xdb)],'merchantUrl':_0x25e99e[_0x21c643(0x154)],'gateways':_0x25e99e[_0x21c643(0x13d)]?JSON[_0x21c643(0x14f)](_0x25e99e[_0x21c643(0x13d)]):null,'gatewaySettings':_0x25e99e[_0x21c643(0x123)]?JSON[_0x21c643(0x14f)](_0x25e99e[_0x21c643(0x123)]):null,'publicKey':_0x25e99e[_0x21c643(0xef)],'wallets':{'usdtPolygonWallet':_0x25e99e[_0x21c643(0x9a)],'usdtTrcWallet':_0x25e99e[_0x21c643(0x10c)],'usdtErcWallet':_0x25e99e[_0x21c643(0x107)],'usdcPolygonWallet':_0x25e99e['usdcPolygonWallet']},'status':_0x25e99e['status'],'createdAt':_0x25e99e[_0x21c643(0xc0)]}));return{'users':_0x41a4c7,'pagination':{'page':_0x545de3,'limit':_0x6f349a,'total':_0x5e3700,'totalPages':Math['ceil'](_0x5e3700/_0x6f349a)}};}async[a33_0x32f77c(0xdc)](_0x35bd68){const _0x46fd23=a33_0x32f77c;return await this[_0x46fd23(0x144)]['getUserById'](_0x35bd68);}async[a33_0x32f77c(0xcf)](_0x1361e8){const _0x248878=a33_0x32f77c;return await this['userService'][_0x248878(0xcf)](_0x1361e8);}async[a33_0x32f77c(0x114)](_0xb58961,_0x3a688a){const _0x3d8412=a33_0x32f77c;return await this[_0x3d8412(0x144)]['updateUser'](_0xb58961,_0x3a688a);}async[a33_0x32f77c(0x150)](_0x1185e1){const _0x1e6aba=a33_0x32f77c;return await this[_0x1e6aba(0x144)][_0x1e6aba(0x150)](_0x1185e1);}async['suspendUser'](_0x3670b4){const _0x50b9d0=a33_0x32f77c;console[_0x50b9d0(0xbb)](_0x50b9d0(0xeb)+_0x3670b4);const _0x26c122=await database_1[_0x50b9d0(0x80)][_0x50b9d0(0xe2)][_0x50b9d0(0x86)]({'where':{'id':_0x3670b4},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x26c122)throw new Error('User\x20not\x20found');if(_0x26c122['status']===_0x50b9d0(0x10d))throw new Error(_0x50b9d0(0x85));const _0x153f24=await this[_0x50b9d0(0x144)][_0x50b9d0(0x114)](_0x3670b4,{'status':'SUSPENDED'});return console[_0x50b9d0(0xbb)](_0x50b9d0(0xf6)+_0x26c122['username']+_0x50b9d0(0x7e)),_0x153f24;}async[a33_0x32f77c(0x12f)](_0x53b74b){const _0x2d8400=a33_0x32f77c;console[_0x2d8400(0xbb)](_0x2d8400(0xee)+_0x53b74b);const _0x404199=await database_1['default']['shop']['findUnique']({'where':{'id':_0x53b74b},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x404199)throw new Error(_0x2d8400(0x115));if(_0x404199['status']===_0x2d8400(0x13a))throw new Error(_0x2d8400(0x14c));const _0x3b2f15=await this[_0x2d8400(0x144)]['updateUser'](_0x53b74b,{'status':'ACTIVE'});return console[_0x2d8400(0xbb)]('‚úÖ\x20User\x20'+_0x404199[_0x2d8400(0x131)]+_0x2d8400(0xdd)),_0x3b2f15;}}exports['AdminService']=AdminService;