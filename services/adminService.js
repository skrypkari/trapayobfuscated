'use strict';const a50_0xedf481=a50_0x4ce0;(function(_0x32052c,_0x4ad7e2){const _0x358976=a50_0x4ce0,_0x3c2a0f=_0x32052c();while(!![]){try{const _0x95cbb=-parseInt(_0x358976(0x216))/0x1+-parseInt(_0x358976(0x285))/0x2+-parseInt(_0x358976(0x328))/0x3+parseInt(_0x358976(0x326))/0x4+parseInt(_0x358976(0x19d))/0x5*(parseInt(_0x358976(0x1f6))/0x6)+-parseInt(_0x358976(0x294))/0x7*(-parseInt(_0x358976(0x2e6))/0x8)+parseInt(_0x358976(0x1d4))/0x9;if(_0x95cbb===_0x4ad7e2)break;else _0x3c2a0f['push'](_0x3c2a0f['shift']());}catch(_0x85c43a){_0x3c2a0f['push'](_0x3c2a0f['shift']());}}}(a50_0x5e88,0xb992b));var __importDefault=this&&this[a50_0xedf481(0x223)]||function(_0x4ef3df){const _0x4dd0e6=a50_0xedf481;return _0x4ef3df&&_0x4ef3df[_0x4dd0e6(0x316)]?_0x4ef3df:{'default':_0x4ef3df};};Object[a50_0xedf481(0x2c0)](exports,'__esModule',{'value':!![]}),exports[a50_0xedf481(0x1c2)]=void 0x0;const database_1=__importDefault(require(a50_0xedf481(0x23a))),bcryptjs_1=__importDefault(require(a50_0xedf481(0x276))),crypto_1=__importDefault(require(a50_0xedf481(0x277))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a50_0xedf481(0x1a5))),speakeasy_1=__importDefault(require(a50_0xedf481(0x1b0))),qrcode_1=__importDefault(require(a50_0xedf481(0x303))),config_1=require(a50_0xedf481(0x2b4)),currencyService_1=require(a50_0xedf481(0x1eb)),telegramBotService_1=require(a50_0xedf481(0x31c)),gateway_1=require(a50_0xedf481(0x182));function a50_0x5e88(){const _0x360f62=['lastLoginAt','klyme_de','ðŸ“…\x20Date\x20from\x20filter:\x20','\x20\x20\x20ðŸ‘¤\x20Merchant\x20earnings:\x20','âœ…\x20Customer\x20data\x20updated\x20for\x20payment\x20','ru-RU','totalPayout','statusChangedBy','startsWith','ðŸ“‹\x20Found\x20','COMPLETED','getDate','ðŸ“Š\x20Calculated\x20commission\x20rate\x20for\x20payment\x20','MasterCard','sort','findUnique','count','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','OxaPay','toUpperCase','round','gatewayCommissionRate','ðŸ”\x20Initial\x20wallet\x20from\x20request:\x20','toString','../config/config','EXPIRED','setupAdmin2FA','txid','default','ðŸ“Š\x20Sorting\x20payments\x20by\x20','totalCommissionRate','lte','insensitive','failureMessage',',\x20successful:\x20','dailyRevenue','defineProperty','generateSecret','polygon_usdc','ADMIN_2FA_ENABLED=true','\x27\x20->\x20ID\x20\x27','\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)','map','ðŸ“Š\x20Total\x20payments\x20(including\x20failed):\x20','âš ï¸\x20CHARGEBACK\x20without\x20penalty\x20amount\x20-\x20no\x20balance\x20change','ðŸ’°\x20[PAYOUT]\x20Merchant\x20',']\x20Gateway\x20settings\x20JSON\x20string:','2020-01-01','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','amountAfterGatewayCommissionUSDT','not\x20provided','%\x20from\x20','dailyPayments','balance','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','amountUSDT','\x20backup\x20codes','filter','erc20_usdc','\x20became\x20PAID:','customerCountry','entries','has','\x20updated\x20successfully','ðŸ”\x202FA\x20setup\x20initiated\x20for\x20shop:\x20','getMerchantsSelection','ðŸ“Š\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','0000','totalTurnover','ðŸ’¸\x20CHARGEBACK\x20penalty\x20ONLY:\x20-','ðŸ“Š\x20Statistics\x20PAID\x20payments\x20count:\x20','totp','âš ï¸\x20Gateway\x20\x27','getMonth','3476656fjxZXK','custom','base32','averageCommissionRate','\x20USDT\x20-\x20will\x20return\x20to\x20balance','ðŸ“Š\x20Getting\x20payments\x20with\x20filters:','ADMIN_2FA_SECRET=','\x20paid\x20payments\x20for\x20gateway\x20','convertToUSDT','ðŸ”\x20Selected\x20polygon\x20wallet:\x20','payout','\x20\x20\x20Tolerance:\x20','awaitingPayout','ðŸ’³\x20Final\x20payout\x20wallet\x20for\x20','\x20USDT,\x20Difference:\x20','Error\x20processing\x20payment\x20','split','ðŸ”\x20[','getMerchantStatistics','Rapyd','ðŸ”\x20No\x20wallet\x20provided,\x20looking\x20up\x20from\x20shop\x20settings...','date','generateDailyStatistics','shopUrl','Merchant\x20not\x20found','turnoverUSDT','\x20\x20\x20Amount\x20decreased\x20by\x20','deletePayout','NONEXISTENT_GATEWAY_FILTER','qrcode','sendPayoutNotification','config','ðŸŽ¯\x20updateUser\x20called\x20with\x20ID:\x20','mastercard','localeCompare','thisMonth','\x27\x20to\x20name\x20\x27','ðŸ”„\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','statusChangedAt','ADMIN_2FA_ENABLED=false','\x20\x20\x20ðŸ’µ\x20Available\x20balance:\x20','\x20\x20\x20Final\x20payout\x20amount\x20used:\x20','Invalid\x202FA\x20token\x20or\x20backup\x20code','\x20\x20\x20â³\x20Pending\x20payout:\x20','updatedAt','\x20\x20\x20Current\x20amount:\x20','externalPaymentUrl','groupBy','__esModule',']\x20Gateway\x20settings\x20before\x20saving:','ðŸ“Š\x20Payout\x20statistics\x20calculated:','wallet','\x20\x20\x20ï¿½ðŸ“Š\x20Total\x20payments:\x20','getGatewayDisplayName','./telegramBotService','âœ…\x20Using\x20wallet\x20from\x20request:\x20','backupCodes','test_gateway','\x20\x20\x20ðŸ’°\x20Total\x20turnover:\x20','updateCustomerData','amount','getUTCFullYear','Error\x20parsing\x20backup\x20codes:','includes','3995104nCjWpU','\x20with\x20payout\x20history','3139650xyScIy','getGatewayNameById','\x20USDT\x20(theoretical\x20net)','dateFrom','ðŸ“Š\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','publicKey','\x20order','merchantEarningsUSDT','telegram','enableAdmin2FA','\x20USDT\x20(same\x20as\x20awaiting)','\x20USDT\x20from\x20balance','AmPay\x20TRY','orderId','ðŸ”\x20Selected\x20polygon_usdc\x20wallet:\x20','totalAmount','\x20PAID\x20payments','getShopWallets','\x20\x20\x20ðŸ–¥ï¸\x20User\x20Agent:\x20','error','\x20->\x20','updatePayout','merchantId','\x20\x20\x20Amount\x20difference:\x20','currency','push','splice','OnRamp','floor','klyme_eu','week','ÐÐµ\x20ÑƒÐºÐ°Ð·Ð°Ð½','whiteUrl','admin','ðŸ”\x20Selected\x20trc20\x20wallet:\x20','toLocaleDateString','ðŸ“Š\x20Calculating\x20payout\x20statistics...','merchantEarnings','noda','CHARGEBACK','shopId','ðŸ’°\x20Payment\x20amount\x20is\x20NOT\x20deducted\x20(chargeback\x20penalty\x20only)','ðŸ”\x20Shop\x20wallets:','\x20\x20\x20ðŸª\x20Gateway\x20earnings:\x20','\x20\x20\x20ðŸŒ\x20Country:\x20','ðŸ”„\x20Gateway\x20mapping\x20(get):','âš ï¸\x20Payment\x20','Invalid\x202FA\x20token','CoinToPay2','notes','getGatewayInternalName','usdcErcWallet','../types/gateway','randomBytes','lastMonth','Shop\x20not\x20found','\x20\x20\x20Merchant\x20gets:\x20','âœ…\x20Payout\x20created:\x20',',\x20Commission:\x20','period','ðŸ”„\x20Admin\x20updating\x20payment\x20','PENDING','Payment\x20not\x20found','payment','\x20\x20\x20Shop\x20totalPaidOut:\x20','twoFactorSecret','ðŸ”\x20Creating\x20payout\x20with\x20data:','getUTCDay','Telegram\x20username\x20already\x20exists','ðŸ“Š\x20Statistics\x20date\x20range:\x20','join','$transaction','gateway','revenue','totalPayments','updatePaymentStatus',',\x20userId:\x20','MyXSpend','currencyService','1633865dZrZcB','create','\x20\x20\x20Added\x20to\x20balance:\x20+','readFileSync','KLYME\x20EU','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','passwordHash','\x20\x20\x20ðŸ’³\x20Total\x20payments:\x20','path','ðŸ’°\x20[PAYOUT]\x20Gateway\x20','getPayoutReports','this_week','customerUa','InstaXchange','getUTCMonth','2FA\x20not\x20set\x20up.\x20Please\x20call\x20setup\x20endpoint\x20first','telegramBotService','TrapaPay\x20Admin','\x20\x20\x20ðŸ¤”\x20Difference:\x20','speakeasy','ðŸ“…\x20Date\x20to\x20filter:\x20','not\x20specified','createUser','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','\x20\x20\x20Amount\x20increased\x20by\x20','gatewaySettings','getFullYear','custom_','successUrl','2FA\x20token\x20is\x20required','\x20to\x20','forEach','getUTCDate','getTime','ðŸ”\x20Selected\x20erc20\x20wallet:\x20','year','some','AdminService','\x20in\x20','\x20\x20\x20Shop\x20balance:\x20','verify','aggregate','findFirst','getSystemStatistics','SquirrelPay','\x27\x20not\x20found.\x20Available\x20gateways:\x20','turnover','\x20\x20\x20ðŸ“…\x20Total\x20payouts\x20(this\x20month):\x20','âœ…\x20Balance\x20check\x20passed\x20(with\x20tolerance)','telegramId','min','\x20\x20\x20â³\x20Awaiting\x20payout:\x20','toDataURL','\x20\x20\x20Difference:\x20','\x20status:\x20','1284417dotmta','ðŸ”\x20Balance\x20check\x20details:','from','cointopay','username','ðŸ”\x20Selected\x20erc20_usdc\x20wallet:\x20','âœ…\x20Payout\x20','ADMIN_PASSWORD_HASH=','\x20USDC\x20to\x20merchant\x20','ðŸ”\x202FA\x20disabled\x20for\x20shop:\x20','\x20USDT)','pendingPayout','paidAt','\x20\x20\x20ðŸ“…\x20This\x20month:\x20','\x20\x20\x20Balance:\x20','\x20balance\x20updated:\x20','CRYPTO','length','parse','Test\x20Gateway','_count','warn','toFixed','./currencyService','Plisio','totalAmountUSDT','wallets','\x20\x20\x20New\x20amount:\x20','\x20\x20\x20Transaction\x20hash:\x20','ðŸ”‘\x20Generated\x20','gateways','REFUND','Insufficient\x20balance.\x20Available:\x20','getPaymentById','6xjRzKv','writeFileSync','.env','Amer','rapyd','ðŸ’¸\x20CHARGEBACK:\x20Processing\x20penalty-only\x20deduction','createPayout','\x20\x20\x20Requested\x20(number):\x20','network','ðŸ”„\x20Converted\x20gateway\x20ID\x20\x27','deleteUser','periodTo','random','hex','existsSync','AmPay','ðŸ“Š\x20Getting\x20payout\x20reports\x20with\x20filters:','chargebackAmount','ðŸ”\x20Using\x20gateway\x20\x27','âš ï¸\x20Requested\x20gateway\x20\x27','adminNotes','âœ…\x20Using\x20gateway\x20filter:\x20\x27','ðŸ“Š\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','ðŸ“…\x20Payout\x20date\x20to\x20filter:\x20','last_week','payouts','setup2FA','updateUser','\x20for\x20shop\x20','\x20\x20\x20ðŸŒ\x20IP:\x20','\x20\x20\x20Full\x20amount:\x20','all','380169Cfuwew','polygon','paymentsCount','usdtPolygonWallet','ðŸ’±\x20Currency\x20filter\x20applied:\x20','set','\x20\x20\x20Merchant\x20loses:\x20','reduce','KLYME\x20DE','\x20USDT\x20(gross\x20revenue)','ðŸ”„\x20Gateway\x20mapping:','month','\x27\x20->\x20name\x20\x27','__importDefault','twoFactorEnabled','customerEmail','hash','amountAfterCommissionUSDT','averageCheckUSDT','ACTIVE','replace','Visa/MasterCard','log','\x20USDT\x20(after\x20','get','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','asc','name','\x20USDT\x20for\x20payment\x20','ðŸ”\x20Admin\x20password\x20changed\x20successfully','KLYME\x20GB','ðŸ’°\x20Updating\x20payout\x20','ðŸ“Š\x20Gateway\x20filter\x20applied:',']\x20Updating\x20password\x20for\x20user\x20','toLowerCase','findMany','../config/database','\x20USDT\x20(total\x20paid\x20to\x20merchants)','ðŸ“Š\x20Using\x20saved\x20values\x20for\x20payment\x20','setUTCDate','abs','getPayoutById','ðŸ“…\x20Period:\x20','\x20USDT','\x20\x20\x20ðŸ”\x20Calculated\x20after\x20commission:\x20','\x20\x20\x20âœ…\x20Total\x20net\x20balances:\x20','customerIp','\x20\x20\x20Payout\x20amount:\x20','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','stringify',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','UTC','totalAmountAfterCommissionUSDT','\x27\x20(from\x20\x27','merchantUrl','\x20-\x20','update','substr','availableBalance','shop','dateTo','last_month','gatewayOrderId','ðŸ”\x20Admin\x202FA\x20setup\x20initiated','\x20merchants','periodFrom','ðŸ”„\x20Gateway\x20mapping\x20(create):','\x20USDT,\x20merchant:\x20','ðŸ”§\x20[','usdtErcWallet','usdtTrcWallet','ðŸ“Š\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','cointopay2','ðŸ’°\x20Found\x20','\x20payments)','utf8','compare','fullName','ceil','disableAdmin2FA','USDC','ðŸ”\x20Total\x20payments\x20matching\x20filters:\x20','\x20\x20\x20ðŸ’°\x20Total\x20payout:\x20','ðŸ“…\x20Payout\x20date\x20from\x20filter:\x20',':\x20commission\x20=\x20','ðŸ”\x20Admin\x202FA\x20enabled','toISOString','depositBalance','changeAdminPassword',',\x20refunds:\x20','\x20merchants\x20with\x20rounded\x20balance\x20!=\x200.00\x20(excluding\x20balances\x20that\x20round\x20to\x200.00)','commission','\x20USDT,\x20Requested:\x20','\x20has\x20zero\x20or\x20null\x20merchant\x20amount,\x20skipping...','totalPaidOut','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','bcryptjs','crypto','ðŸ”Œ\x20Gateway:\x20','values','ADMIN_BACKUP_CODES=','createdAt','\x20\x20\x20ðŸ’°\x20Total\x20payments\x20turnover:\x20','ðŸ’°\x20Payment\x20','ðŸ’°\x20Shop\x20','ðŸ”\x20Admin\x202FA\x20disabled','_sum','cwd','\x20\x20\x20ðŸ’¸\x20Total\x20payouts\x20(all\x20time):\x20','commissionUSDT','gte','1170364mhfYqW','PAID','password','\x20\x20\x20Total\x20paid\x20out:\x20','status','sk_','ðŸ“Š\x20Available\x20gateways\x20in\x20database:','setHours',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','merchantUsername','generateBackupCodes','yesterday','gatewayEarnings','ADMIN_2FA_ENABLED=','paymentGateways','21TyZvYE','usdcPolygonWallet','âœ…\x20Payout\x20created\x20in\x20DB:','\x20\x20\x20Gateway:\x20','desc','\x20\x20\x20Current\x20balance:\x20','2FA\x20is\x20already\x20enabled','\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)'];a50_0x5e88=function(){return _0x360f62;};return a50_0x5e88();}function a50_0x4ce0(_0x637282,_0x41be01){_0x637282=_0x637282-0x16b;const _0x5e884b=a50_0x5e88();let _0x4ce017=_0x5e884b[_0x637282];return _0x4ce017;}class AdminService{async['getPayoutStats'](){const _0x2f259f=a50_0xedf481;console['log'](_0x2f259f(0x172));const _0x1748c0=await database_1[_0x2f259f(0x2b8)][_0x2f259f(0x251)]['aggregate']({'_sum':{'balance':!![],'totalPaidOut':!![]}}),_0x2b7be5=await database_1['default'][_0x2f259f(0x18d)][_0x2f259f(0x2ac)]({'where':{'status':_0x2f259f(0x286),'gateway':{'not':_0x2f259f(0x31f)}}}),_0x220115=new Date(),_0x52af17=new Date(_0x220115[_0x2f259f(0x1b7)](),_0x220115[_0x2f259f(0x2e5)](),0x1),_0x234793=new Date(_0x220115[_0x2f259f(0x1b7)](),_0x220115[_0x2f259f(0x2e5)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x52726f=await database_1[_0x2f259f(0x2b8)][_0x2f259f(0x2f0)][_0x2f259f(0x1c6)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x52af17,'lte':_0x234793},'status':_0x2f259f(0x2a6)}}),_0x2c24a2=_0x1748c0[_0x2f259f(0x280)][_0x2f259f(0x274)]||0x0,_0x1d5289=_0x1748c0['_sum'][_0x2f259f(0x2d1)]||0x0,_0x57f84a=_0x52726f[_0x2f259f(0x280)]['amount']||0x0,_0x2edb18={'totalPayout':Math['round'](_0x2c24a2*0x64)/0x64,'awaitingPayout':Math[_0x2f259f(0x2b0)](_0x1d5289*0x64)/0x64,'thisMonth':Math['round'](_0x57f84a*0x64)/0x64,'availableBalance':Math[_0x2f259f(0x2b0)](_0x1d5289*0x64)/0x64,'totalPayments':_0x2b7be5};return console[_0x2f259f(0x22c)](_0x2f259f(0x318)),console[_0x2f259f(0x22c)](_0x2f259f(0x268)+_0x2edb18[_0x2f259f(0x2a2)]+_0x2f259f(0x23b)),console[_0x2f259f(0x22c)](_0x2f259f(0x1d0)+_0x2edb18[_0x2f259f(0x2f2)]+_0x2f259f(0x2c5)),console[_0x2f259f(0x22c)](_0x2f259f(0x30e)+_0x2edb18[_0x2f259f(0x250)]+_0x2f259f(0x332)),console[_0x2f259f(0x22c)](_0x2f259f(0x1e1)+_0x2edb18[_0x2f259f(0x309)]+_0x2f259f(0x241)),console[_0x2f259f(0x22c)](_0x2f259f(0x1a4)+_0x2edb18[_0x2f259f(0x198)]+_0x2f259f(0x338)),_0x2edb18;}async[a50_0xedf481(0x321)](_0x95a024,_0x23eade){const _0x160382=a50_0xedf481;console[_0x160382(0x22c)]('ðŸ”„\x20Updating\x20customer\x20data\x20for\x20payment\x20'+_0x95a024+':',_0x23eade);const _0x2086d9=await database_1[_0x160382(0x2b8)][_0x160382(0x18d)][_0x160382(0x2ab)]({'where':{'id':_0x95a024},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x2086d9)throw new Error(_0x160382(0x18c));const _0xba2164={};_0x23eade['customerCountry']!==undefined&&(_0xba2164['customerCountry']=_0x23eade['customerCountry']||null);_0x23eade[_0x160382(0x244)]!==undefined&&(_0xba2164['customerIp']=_0x23eade[_0x160382(0x244)]||null);_0x23eade[_0x160382(0x1a9)]!==undefined&&(_0xba2164[_0x160382(0x1a9)]=_0x23eade['customerUa']||null);const _0x394012=await database_1[_0x160382(0x2b8)][_0x160382(0x18d)][_0x160382(0x24e)]({'where':{'id':_0x95a024},'data':{..._0xba2164,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x160382(0x22c)](_0x160382(0x2a0)+_0x95a024),console[_0x160382(0x22c)](_0x160382(0x17a)+_0x2086d9[_0x160382(0x2d8)]+_0x160382(0x33c)+_0x394012[_0x160382(0x2d8)]),console[_0x160382(0x22c)](_0x160382(0x213)+_0x2086d9[_0x160382(0x244)]+_0x160382(0x33c)+_0x394012[_0x160382(0x244)]),console['log'](_0x160382(0x33a)+(_0x2086d9[_0x160382(0x1a9)]?'set':'not\x20set')+_0x160382(0x33c)+(_0x394012[_0x160382(0x1a9)]?_0x160382(0x21b):'not\x20set')),_0x394012;}async[a50_0xedf481(0x1c8)](_0x3f2bec,_0x593dbe){const _0x546702=a50_0xedf481,_0x3668ed=_0x593dbe?new Date(_0x593dbe):new Date();let _0x57f80b,_0x8f98ae;if(_0x3f2bec[_0x546702(0x2a4)](_0x546702(0x1b8))){const _0x248384=_0x3f2bec[_0x546702(0x22a)](_0x546702(0x1b8),'')[_0x546702(0x2f6)]('_');if(_0x248384[_0x546702(0x1e5)]===0x2){const _0x557500=new Date(_0x248384[0x0]),_0x462f2e=new Date(_0x248384[0x1]);_0x57f80b=new Date(Date[_0x546702(0x249)](_0x557500[_0x546702(0x323)](),_0x557500[_0x546702(0x1ab)](),_0x557500['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x8f98ae=new Date(Date['UTC'](_0x462f2e['getUTCFullYear'](),_0x462f2e[_0x546702(0x1ab)](),_0x462f2e['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}else{const _0x8388d6=new Date(Date[_0x546702(0x249)](_0x3668ed[_0x546702(0x323)](),_0x3668ed[_0x546702(0x1ab)](),_0x3668ed[_0x546702(0x1bd)]()-0x1e));_0x57f80b=new Date(Date[_0x546702(0x249)](_0x8388d6[_0x546702(0x323)](),_0x8388d6[_0x546702(0x1ab)](),_0x8388d6[_0x546702(0x1bd)](),0x0,0x0,0x0,0x0)),_0x8f98ae=new Date(Date[_0x546702(0x249)](_0x3668ed[_0x546702(0x323)](),_0x3668ed['getUTCMonth'](),_0x3668ed[_0x546702(0x1bd)](),0x17,0x3b,0x3b,0x3e7));}}else{switch(_0x3f2bec[_0x546702(0x238)]()){case'today':_0x57f80b=new Date(Date[_0x546702(0x249)](_0x3668ed[_0x546702(0x323)](),_0x3668ed[_0x546702(0x1ab)](),_0x3668ed[_0x546702(0x1bd)](),0x0,0x0,0x0,0x0)),_0x8f98ae=new Date(Date['UTC'](_0x3668ed['getUTCFullYear'](),_0x3668ed[_0x546702(0x1ab)](),_0x3668ed[_0x546702(0x1bd)](),0x17,0x3b,0x3b,0x3e7));break;case _0x546702(0x290):const _0x4fff63=new Date(_0x3668ed);_0x4fff63[_0x546702(0x23d)](_0x4fff63[_0x546702(0x1bd)]()-0x1),_0x57f80b=new Date(Date['UTC'](_0x4fff63[_0x546702(0x323)](),_0x4fff63[_0x546702(0x1ab)](),_0x4fff63['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x8f98ae=new Date(Date['UTC'](_0x4fff63[_0x546702(0x323)](),_0x4fff63[_0x546702(0x1ab)](),_0x4fff63['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case _0x546702(0x1a8):const _0x186a0f=_0x3668ed[_0x546702(0x191)](),_0x395d0b=_0x186a0f===0x0?-0x6:0x1-_0x186a0f,_0x2b7331=_0x3668ed['getUTCDate']()+_0x395d0b;_0x57f80b=new Date(Date[_0x546702(0x249)](_0x3668ed[_0x546702(0x323)](),_0x3668ed[_0x546702(0x1ab)](),_0x2b7331,0x0,0x0,0x0,0x0)),_0x8f98ae=new Date(Date[_0x546702(0x249)](_0x3668ed['getUTCFullYear'](),_0x3668ed['getUTCMonth'](),_0x3668ed[_0x546702(0x1bd)](),0x17,0x3b,0x3b,0x3e7));break;case _0x546702(0x20e):const _0x4a5390=new Date(Date['UTC'](_0x3668ed['getUTCFullYear'](),_0x3668ed[_0x546702(0x1ab)](),_0x3668ed[_0x546702(0x1bd)]()-0x7)),_0x388a53=_0x4a5390[_0x546702(0x191)](),_0x3c6b74=_0x388a53===0x0?-0x6:0x1-_0x388a53,_0x295bf9=_0x4a5390[_0x546702(0x1bd)]()+_0x3c6b74;_0x57f80b=new Date(Date[_0x546702(0x249)](_0x4a5390[_0x546702(0x323)](),_0x4a5390[_0x546702(0x1ab)](),_0x295bf9,0x0,0x0,0x0,0x0)),_0x8f98ae=new Date(Date[_0x546702(0x249)](_0x4a5390[_0x546702(0x323)](),_0x4a5390[_0x546702(0x1ab)](),_0x295bf9+0x6,0x17,0x3b,0x3b,0x3e7));break;case'this_month':_0x57f80b=new Date(Date['UTC'](_0x3668ed[_0x546702(0x323)](),_0x3668ed[_0x546702(0x1ab)](),0x1,0x0,0x0,0x0,0x0)),_0x8f98ae=new Date(Date[_0x546702(0x249)](_0x3668ed[_0x546702(0x323)](),_0x3668ed[_0x546702(0x1ab)](),_0x3668ed['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case _0x546702(0x253):_0x57f80b=new Date(Date[_0x546702(0x249)](_0x3668ed[_0x546702(0x323)](),_0x3668ed[_0x546702(0x1ab)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x8f98ae=new Date(Date[_0x546702(0x249)](_0x3668ed['getUTCFullYear'](),_0x3668ed[_0x546702(0x1ab)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case'all_time':_0x57f80b=new Date(Date[_0x546702(0x249)](0x7e9,0x5,0xe,0x0,0x0,0x0,0x0)),_0x8f98ae=new Date(Date[_0x546702(0x249)](_0x3668ed[_0x546702(0x323)](),_0x3668ed['getUTCMonth'](),_0x3668ed[_0x546702(0x1bd)](),0x17,0x3b,0x3b,0x3e7));break;default:_0x57f80b=new Date(_0x3668ed[_0x546702(0x1be)]()-0x1e*0x18*0x3c*0x3c*0x3e8);const _0x4b8dc3=new Date(Date[_0x546702(0x249)](_0x3668ed[_0x546702(0x323)](),_0x3668ed['getUTCMonth'](),_0x3668ed['getUTCDate']()-0x1e));_0x57f80b=new Date(Date[_0x546702(0x249)](_0x4b8dc3[_0x546702(0x323)](),_0x4b8dc3['getUTCMonth'](),_0x4b8dc3[_0x546702(0x1bd)](),0x0,0x0,0x0,0x0)),_0x8f98ae=new Date(Date[_0x546702(0x249)](_0x3668ed['getUTCFullYear'](),_0x3668ed[_0x546702(0x1ab)](),_0x3668ed['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}const _0x462393={'gte':_0x57f80b,'lte':_0x8f98ae};console['log'](_0x546702(0x193)+_0x57f80b[_0x546702(0x26c)]()+_0x546702(0x1bb)+_0x8f98ae[_0x546702(0x26c)]());const [_0x587012,_0x1a3f44,_0x585ce4,_0x5bdac9,_0x53e6af,_0x5b394e,_0x586dcd,_0x1c1175,_0x37253b]=await Promise[_0x546702(0x215)]([database_1[_0x546702(0x2b8)]['shop'][_0x546702(0x2ac)](),database_1[_0x546702(0x2b8)][_0x546702(0x251)][_0x546702(0x2ac)]({'where':{'status':_0x546702(0x229)}}),database_1[_0x546702(0x2b8)]['payment'][_0x546702(0x2ac)]({'where':{'status':'PAID','createdAt':_0x462393,'gateway':{'not':_0x546702(0x31f)}}}),database_1[_0x546702(0x2b8)][_0x546702(0x18d)]['count']({'where':{'status':_0x546702(0x175),'createdAt':_0x462393,'gateway':{'not':_0x546702(0x31f)}}}),database_1[_0x546702(0x2b8)][_0x546702(0x18d)][_0x546702(0x2ac)]({'where':{'status':_0x546702(0x1f3),'createdAt':_0x462393,'gateway':{'not':'test_gateway'}}}),database_1[_0x546702(0x2b8)]['payment']['findMany']({'where':{'status':_0x546702(0x286),'createdAt':_0x462393,'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x546702(0x2b8)]['payment'][_0x546702(0x239)]({'where':{'gateway':{'not':_0x546702(0x31f)}},'take':0xa,'orderBy':{'createdAt':_0x546702(0x298)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x546702(0x2b8)][_0x546702(0x18d)][_0x546702(0x239)]({'where':{'createdAt':_0x462393,'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x546702(0x2b8)][_0x546702(0x18d)][_0x546702(0x239)]({'where':{'status':_0x546702(0x286),'gateway':{'not':_0x546702(0x31f)}},'select':{'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![]}})]);console[_0x546702(0x22c)](_0x546702(0x2e2)+_0x585ce4);let _0x5ae31b=0x0,_0x3a2098=0x0;for(const _0x59af2d of _0x5b394e){const _0x592703=_0x59af2d['amountUSDT']||0x0;_0x5ae31b+=_0x592703;if(_0x59af2d[_0x546702(0x2cd)]&&_0x59af2d[_0x546702(0x2d3)]){const _0x380c8e=_0x59af2d[_0x546702(0x2d3)]-_0x59af2d[_0x546702(0x2cd)];_0x3a2098+=_0x380c8e;}}let _0x10c65c=0x0;for(const _0x3c5a0e of _0x37253b){if(_0x3c5a0e['amountAfterGatewayCommissionUSDT']&&_0x3c5a0e[_0x546702(0x2d3)]){const _0x18a2d5=_0x3c5a0e[_0x546702(0x2d3)]-_0x3c5a0e[_0x546702(0x2cd)];_0x10c65c+=_0x18a2d5;}}const _0x311c31=_0x585ce4>0x0?_0x5ae31b/_0x585ce4:0x0,_0x27c540=this[_0x546702(0x2fc)](_0x1c1175,_0x57f80b,_0x8f98ae),_0x972e86=await database_1[_0x546702(0x2b8)][_0x546702(0x18d)]['count']({'where':{'createdAt':_0x462393,'gateway':{'not':_0x546702(0x31f)},'status':{'notIn':[_0x546702(0x18b),_0x546702(0x2b5)]}}}),_0x16b585=_0x972e86>0x0?_0x585ce4/_0x972e86*0x64:0x0;return{'totalShops':_0x587012,'activeShops':_0x1a3f44,'totalPayments':_0x972e86,'successfulPayments':_0x585ce4,'totalAttempts':_0x972e86,'chargebacks':_0x5bdac9,'refunds':_0x53e6af,'totalRevenue':Math['round'](_0x5ae31b*0x64)/0x64,'trapayEarnings':Math[_0x546702(0x2b0)](_0x3a2098*0x64)/0x64,'trapayEarningsAllTime':Math[_0x546702(0x2b0)](_0x10c65c*0x64)/0x64,'averagePaymentAmount':Math['round'](_0x311c31*0x64)/0x64,'conversionRate':Math[_0x546702(0x2b0)](_0x16b585*0x64)/0x64,'dailyRevenue':_0x27c540[_0x546702(0x2bf)],'dailyPayments':_0x27c540[_0x546702(0x2d0)],'recentPayments':_0x586dcd['map'](_0x40b70e=>({'id':_0x40b70e['id'],'amount':_0x40b70e[_0x546702(0x322)],'currency':_0x40b70e['currency'],'status':_0x40b70e[_0x546702(0x289)],'gateway':_0x40b70e[_0x546702(0x196)],'shop':_0x40b70e[_0x546702(0x251)],'createdAt':_0x40b70e[_0x546702(0x27b)]}))};}}async[a50_0xedf481(0x2f8)](_0x45bfad){const _0x1c5e3b=a50_0xedf481;console['log']('ðŸ“Š\x20Getting\x20merchant\x20statistics\x20with\x20filters:',_0x45bfad);let _0x45424c,_0x25d964=new Date();if(_0x45bfad[_0x1c5e3b(0x189)]===_0x1c5e3b(0x2e7)&&_0x45bfad[_0x1c5e3b(0x32b)]&&_0x45bfad[_0x1c5e3b(0x252)]){const _0x3c34ad=new Date(_0x45bfad['dateFrom']),_0x129811=new Date(_0x45bfad['dateTo']);_0x45424c=new Date(Date[_0x1c5e3b(0x249)](_0x3c34ad[_0x1c5e3b(0x323)](),_0x3c34ad['getUTCMonth'](),_0x3c34ad[_0x1c5e3b(0x1bd)](),0x0,0x0,0x0,0x0)),_0x25d964=new Date(Date[_0x1c5e3b(0x249)](_0x129811[_0x1c5e3b(0x323)](),_0x129811[_0x1c5e3b(0x1ab)](),_0x129811['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}else{const _0x5b7014=new Date();switch(_0x45bfad[_0x1c5e3b(0x189)]){case _0x1c5e3b(0x16c):_0x45424c=new Date(_0x5b7014[_0x1c5e3b(0x1be)]()-0x7*0x18*0x3c*0x3c*0x3e8),_0x45424c[_0x1c5e3b(0x28c)](0x0,0x0,0x0,0x0),_0x25d964[_0x1c5e3b(0x28c)](0x17,0x3b,0x3b,0x3e7);break;case _0x1c5e3b(0x221):_0x45424c=new Date(Date[_0x1c5e3b(0x249)](_0x5b7014[_0x1c5e3b(0x323)](),_0x5b7014[_0x1c5e3b(0x1ab)](),0x1,0x0,0x0,0x0,0x0)),_0x25d964=new Date(Date['UTC'](_0x5b7014[_0x1c5e3b(0x323)](),_0x5b7014[_0x1c5e3b(0x1ab)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x1c5e3b(0x184):_0x45424c=new Date(Date['UTC'](_0x5b7014['getUTCFullYear'](),_0x5b7014[_0x1c5e3b(0x1ab)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x25d964=new Date(Date[_0x1c5e3b(0x249)](_0x5b7014[_0x1c5e3b(0x323)](),_0x5b7014[_0x1c5e3b(0x1ab)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x1c5e3b(0x1c0):_0x45424c=new Date(_0x5b7014[_0x1c5e3b(0x1be)]()-0x16d*0x18*0x3c*0x3c*0x3e8),_0x45424c[_0x1c5e3b(0x28c)](0x0,0x0,0x0,0x0),_0x25d964['setHours'](0x17,0x3b,0x3b,0x3e7);break;case _0x1c5e3b(0x215):default:_0x45424c=new Date(_0x1c5e3b(0x2cb)),_0x45424c[_0x1c5e3b(0x28c)](0x0,0x0,0x0,0x0),_0x25d964[_0x1c5e3b(0x28c)](0x17,0x3b,0x3b,0x3e7);break;}}console['log'](_0x1c5e3b(0x240)+_0x45424c[_0x1c5e3b(0x26c)]()+'\x20to\x20'+_0x25d964[_0x1c5e3b(0x26c)]());const _0x542570={'status':'PAID','gateway':{'not':'test_gateway'},'createdAt':{'gte':_0x45424c,'lte':_0x25d964}};_0x45bfad[_0x1c5e3b(0x176)]&&(_0x542570[_0x1c5e3b(0x176)]=_0x45bfad[_0x1c5e3b(0x176)]);const _0xac85c2=await database_1['default'][_0x1c5e3b(0x18d)]['findMany']({'where':_0x542570,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x1c5e3b(0x22c)](_0x1c5e3b(0x25f)+_0xac85c2[_0x1c5e3b(0x1e5)]+'\x20paid\x20payments\x20for\x20analysis');const _0x3c2b83={'gateway':{'not':_0x1c5e3b(0x31f)},'status':{'notIn':[_0x1c5e3b(0x18b),'EXPIRED']},'createdAt':{'gte':_0x45424c,'lte':_0x25d964}};_0x45bfad[_0x1c5e3b(0x176)]&&(_0x3c2b83[_0x1c5e3b(0x176)]=_0x45bfad[_0x1c5e3b(0x176)]);const _0x43bcfc=await database_1['default'][_0x1c5e3b(0x18d)][_0x1c5e3b(0x2ac)]({'where':_0x3c2b83}),_0x2cc266={..._0x3c2b83,'status':_0x1c5e3b(0x175)},_0x13ff4={..._0x3c2b83,'status':'REFUND'},[_0x5bf7e1,_0x105fe0]=await Promise[_0x1c5e3b(0x215)]([database_1[_0x1c5e3b(0x2b8)]['payment'][_0x1c5e3b(0x2ac)]({'where':_0x2cc266}),database_1['default'][_0x1c5e3b(0x18d)][_0x1c5e3b(0x2ac)]({'where':_0x13ff4})]);console['log'](_0x1c5e3b(0x2c7)+_0x43bcfc+_0x1c5e3b(0x2be)+_0xac85c2[_0x1c5e3b(0x1e5)]+',\x20chargebacks:\x20'+_0x5bf7e1+_0x1c5e3b(0x26f)+_0x105fe0);let _0x3a8d93=0x0,_0x1a097f=0x0,_0x49c294=0x0;const _0xc2facc={},_0x3d8031={},_0x4b15b3={},_0x45bf6c=new Date(_0x45424c);while(_0x45bf6c<=_0x25d964){const _0x19cc61=_0x45bf6c[_0x1c5e3b(0x26c)]()[_0x1c5e3b(0x2f6)]('T')[0x0];_0x4b15b3[_0x19cc61]={'date':_0x19cc61,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0},_0x45bf6c[_0x1c5e3b(0x23d)](_0x45bf6c[_0x1c5e3b(0x1bd)]()+0x1);}for(const _0x2621dc of _0xac85c2){try{const _0x44220b=_0x2621dc[_0x1c5e3b(0x2d3)]||0x0;if(_0x44220b<=0x0){console[_0x1c5e3b(0x1e9)](_0x1c5e3b(0x17c)+_0x2621dc['id']+'\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...');continue;}let _0x331554,_0x49b948;if(_0x2621dc[_0x1c5e3b(0x2cd)]!==null&&_0x2621dc[_0x1c5e3b(0x2cd)]!==undefined)_0x331554=_0x2621dc['amountAfterGatewayCommissionUSDT'],_0x49b948=_0x44220b-_0x331554,console['log'](_0x1c5e3b(0x23c)+_0x2621dc['id']+':\x20'+_0x44220b['toFixed'](0x6)+_0x1c5e3b(0x259)+_0x331554[_0x1c5e3b(0x1ea)](0x6)+_0x1c5e3b(0x241));else{let _0x1621a3={};if(_0x2621dc[_0x1c5e3b(0x251)]['gatewaySettings'])try{_0x1621a3=JSON[_0x1c5e3b(0x1e6)](_0x2621dc[_0x1c5e3b(0x251)][_0x1c5e3b(0x1b6)]);}catch(_0x2d9876){console['error'](_0x1c5e3b(0x1a2)+_0x2621dc[_0x1c5e3b(0x176)]+':',_0x2d9876);}let _0x1a5b76=0x2d;for(const [_0x18a66a,_0x2a8b36]of Object[_0x1c5e3b(0x2d9)](_0x1621a3)){if(_0x18a66a['toLowerCase']()===_0x2621dc['gateway'][_0x1c5e3b(0x238)]()){_0x1a5b76=_0x2a8b36[_0x1c5e3b(0x271)]||0x2d;break;}}_0x49b948=_0x44220b*(_0x1a5b76/0x64),_0x331554=_0x44220b-_0x49b948,console['log'](_0x1c5e3b(0x25d)+_0x2621dc['id']+':\x20'+_0x1a5b76+_0x1c5e3b(0x2cf)+_0x44220b['toFixed'](0x6)+_0x1c5e3b(0x241));}_0x3a8d93+=_0x44220b,_0x1a097f+=_0x331554,_0x49c294+=_0x49b948;let _0x465d60;_0x2621dc[_0x1c5e3b(0x2b1)]!==null&&_0x2621dc[_0x1c5e3b(0x2b1)]!==undefined?(_0x465d60=_0x2621dc[_0x1c5e3b(0x2b1)],console['log']('ðŸ“Š\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20'+_0x2621dc['id']+':\x20'+_0x465d60+'%')):(_0x465d60=_0x44220b>0x0?_0x49b948/_0x44220b*0x64:0x0,console['log'](_0x1c5e3b(0x2a8)+_0x2621dc['id']+':\x20'+_0x465d60[_0x1c5e3b(0x1ea)](0x2)+'%'));!_0xc2facc[_0x2621dc[_0x1c5e3b(0x196)]]&&(_0xc2facc[_0x2621dc[_0x1c5e3b(0x196)]]={'gateway':_0x2621dc[_0x1c5e3b(0x196)],'gatewayDisplayName':this[_0x1c5e3b(0x31b)](_0x2621dc[_0x1c5e3b(0x196)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0xc2facc[_0x2621dc['gateway']]['paymentsCount']++,_0xc2facc[_0x2621dc[_0x1c5e3b(0x196)]][_0x1c5e3b(0x2ff)]+=_0x44220b,_0xc2facc[_0x2621dc[_0x1c5e3b(0x196)]][_0x1c5e3b(0x283)]+=_0x49b948,_0xc2facc[_0x2621dc[_0x1c5e3b(0x196)]][_0x1c5e3b(0x32f)]+=_0x331554,_0xc2facc[_0x2621dc['gateway']]['totalCommissionRate']+=_0x465d60;!_0x45bfad[_0x1c5e3b(0x176)]&&(!_0x3d8031[_0x2621dc[_0x1c5e3b(0x176)]]&&(_0x3d8031[_0x2621dc[_0x1c5e3b(0x176)]]={'shopId':_0x2621dc[_0x1c5e3b(0x176)],'shopName':_0x2621dc[_0x1c5e3b(0x251)][_0x1c5e3b(0x231)],'shopUsername':_0x2621dc[_0x1c5e3b(0x251)]['username'],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x3d8031[_0x2621dc['shopId']][_0x1c5e3b(0x218)]++,_0x3d8031[_0x2621dc[_0x1c5e3b(0x176)]][_0x1c5e3b(0x2ff)]+=_0x44220b,_0x3d8031[_0x2621dc[_0x1c5e3b(0x176)]][_0x1c5e3b(0x283)]+=_0x49b948,_0x3d8031[_0x2621dc[_0x1c5e3b(0x176)]][_0x1c5e3b(0x32f)]+=_0x331554);const _0x1ac6d1=_0x2621dc['paidAt'][_0x1c5e3b(0x26c)]()[_0x1c5e3b(0x2f6)]('T')[0x0];_0x4b15b3[_0x1ac6d1]&&(_0x4b15b3[_0x1ac6d1][_0x1c5e3b(0x1cb)]+=_0x44220b,_0x4b15b3[_0x1ac6d1][_0x1c5e3b(0x173)]+=_0x331554,_0x4b15b3[_0x1ac6d1][_0x1c5e3b(0x291)]+=_0x49b948,_0x4b15b3[_0x1ac6d1][_0x1c5e3b(0x218)]++);}catch(_0x55fe83){console[_0x1c5e3b(0x33b)](_0x1c5e3b(0x2f5)+_0x2621dc['id']+':',_0x55fe83);}}Object[_0x1c5e3b(0x279)](_0xc2facc)[_0x1c5e3b(0x1bc)](_0x5b6c38=>{const _0x54d111=_0x1c5e3b;_0x5b6c38[_0x54d111(0x2e9)]=_0x5b6c38['paymentsCount']>0x0?_0x5b6c38[_0x54d111(0x2ba)]/_0x5b6c38[_0x54d111(0x218)]:0x0,delete _0x5b6c38['totalCommissionRate'];}),Object[_0x1c5e3b(0x279)](_0x3d8031)['forEach'](_0x101450=>{const _0x202d9d=_0x1c5e3b;_0x101450['averageCheckUSDT']=_0x101450[_0x202d9d(0x218)]>0x0?_0x101450[_0x202d9d(0x2ff)]/_0x101450[_0x202d9d(0x218)]:0x0;});let _0x3c82f6=0x0,_0x4128c9=0x0;if(_0x45bfad[_0x1c5e3b(0x176)]){const _0xcbe15d=await database_1[_0x1c5e3b(0x2b8)][_0x1c5e3b(0x2f0)][_0x1c5e3b(0x239)]({'where':{'shopId':_0x45bfad['shopId'],'status':_0x1c5e3b(0x2a6),'createdAt':{'gte':_0x45424c,'lte':_0x25d964}},'select':{'amount':!![]}});_0x3c82f6=_0xcbe15d['reduce']((_0xe9e981,_0xdbb734)=>_0xe9e981+_0xdbb734[_0x1c5e3b(0x322)],0x0);const _0x43965b=await database_1[_0x1c5e3b(0x2b8)]['payout'][_0x1c5e3b(0x239)]({'where':{'shopId':_0x45bfad['shopId'],'status':_0x1c5e3b(0x18b),'createdAt':{'gte':_0x45424c,'lte':_0x25d964}},'select':{'amount':!![]}});_0x4128c9=_0x43965b[_0x1c5e3b(0x21d)]((_0x1f72e0,_0x23e61d)=>_0x1f72e0+_0x23e61d[_0x1c5e3b(0x322)],0x0);}const _0x109220=_0x43bcfc,_0x34961a=_0xac85c2['length'],_0x2ff449=_0x34961a>0x0?_0x3a8d93/_0x34961a:0x0,_0x1fc8bd=_0x109220>0x0?Math[_0x1c5e3b(0x2b0)](_0x34961a/_0x109220*0x2710)/0x64:0x0,_0x4ba0bb=Math['ceil']((_0x25d964[_0x1c5e3b(0x1be)]()-_0x45424c[_0x1c5e3b(0x1be)]())/(0x3e8*0x3c*0x3c*0x18)),_0xaf9730={'totalTurnover':Math[_0x1c5e3b(0x2b0)](_0x3a8d93*0x64)/0x64,'merchantEarnings':Math[_0x1c5e3b(0x2b0)](_0x1a097f*0x64)/0x64,'gatewayEarnings':Math[_0x1c5e3b(0x2b0)](_0x49c294*0x64)/0x64,'totalPaidOut':Math[_0x1c5e3b(0x2b0)](_0x3c82f6*0x64)/0x64,'pendingPayout':Math[_0x1c5e3b(0x2b0)](_0x4128c9*0x64)/0x64,'averageCheck':Math[_0x1c5e3b(0x2b0)](_0x2ff449*0x64)/0x64,'totalPayments':_0x109220,'successfulPayments':_0x34961a,'conversionRate':_0x1fc8bd,'chargebacks':_0x5bf7e1,'refunds':_0x105fe0,'gatewayBreakdown':Object[_0x1c5e3b(0x279)](_0xc2facc)[_0x1c5e3b(0x2c6)](_0x15af85=>({..._0x15af85,'turnoverUSDT':Math[_0x1c5e3b(0x2b0)](_0x15af85[_0x1c5e3b(0x2ff)]*0x64)/0x64,'commissionUSDT':Math[_0x1c5e3b(0x2b0)](_0x15af85[_0x1c5e3b(0x283)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x15af85[_0x1c5e3b(0x32f)]*0x64)/0x64,'averageCommissionRate':Math['round'](_0x15af85[_0x1c5e3b(0x2e9)]*0x64)/0x64})),'merchantBreakdown':_0x45bfad[_0x1c5e3b(0x176)]?undefined:Object['values'](_0x3d8031)[_0x1c5e3b(0x2c6)](_0x6989e8=>({..._0x6989e8,'turnoverUSDT':Math[_0x1c5e3b(0x2b0)](_0x6989e8[_0x1c5e3b(0x2ff)]*0x64)/0x64,'commissionUSDT':Math[_0x1c5e3b(0x2b0)](_0x6989e8[_0x1c5e3b(0x283)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x1c5e3b(0x2b0)](_0x6989e8[_0x1c5e3b(0x32f)]*0x64)/0x64,'paidOutUSDT':Math[_0x1c5e3b(0x2b0)](_0x6989e8['paidOutUSDT']*0x64)/0x64,'averageCheckUSDT':Math[_0x1c5e3b(0x2b0)](_0x6989e8[_0x1c5e3b(0x228)]*0x64)/0x64})),'dailyData':Object['values'](_0x4b15b3)['map'](_0x5290d3=>({..._0x5290d3,'turnover':Math[_0x1c5e3b(0x2b0)](_0x5290d3['turnover']*0x64)/0x64,'merchantEarnings':Math[_0x1c5e3b(0x2b0)](_0x5290d3[_0x1c5e3b(0x173)]*0x64)/0x64,'gatewayEarnings':Math[_0x1c5e3b(0x2b0)](_0x5290d3[_0x1c5e3b(0x291)]*0x64)/0x64}))[_0x1c5e3b(0x2aa)]((_0x201266,_0x43aabd)=>_0x201266[_0x1c5e3b(0x2fb)][_0x1c5e3b(0x308)](_0x43aabd['date'])),'periodInfo':{'from':_0x45424c,'to':_0x25d964,'periodType':_0x45bfad[_0x1c5e3b(0x189)]||_0x1c5e3b(0x2e7),'daysCount':_0x4ba0bb}};return console[_0x1c5e3b(0x22c)]('ðŸ“Š\x20Merchant\x20statistics\x20calculated:'),console[_0x1c5e3b(0x22c)](_0x1c5e3b(0x320)+_0xaf9730[_0x1c5e3b(0x2e0)]+_0x1c5e3b(0x241)),console[_0x1c5e3b(0x22c)](_0x1c5e3b(0x29f)+_0xaf9730[_0x1c5e3b(0x173)]+_0x1c5e3b(0x241)),console[_0x1c5e3b(0x22c)](_0x1c5e3b(0x179)+_0xaf9730[_0x1c5e3b(0x291)]+'\x20USDT'),console[_0x1c5e3b(0x22c)]('\x20\x20\x20ï¿½\x20Total\x20paid\x20out:\x20'+_0xaf9730['totalPaidOut']+'\x20USDT'),console[_0x1c5e3b(0x22c)](_0x1c5e3b(0x311)+_0xaf9730[_0x1c5e3b(0x1df)]+'\x20USDT'),console['log'](_0x1c5e3b(0x31a)+_0xaf9730[_0x1c5e3b(0x198)]),_0xaf9730;}async[a50_0xedf481(0x2dd)](_0x4cdc0f){const _0x36b0cf=a50_0xedf481;console[_0x36b0cf(0x22c)]('ðŸ“‹\x20Getting\x20merchants\x20selection\x20list...',{'hasPayoutHistory':_0x4cdc0f});let _0x564697={};_0x4cdc0f&&(_0x564697[_0x36b0cf(0x20f)]={'some':{}});const _0x349859=await database_1['default'][_0x36b0cf(0x251)][_0x36b0cf(0x239)]({'where':_0x564697,'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':'asc'}});return console[_0x36b0cf(0x22c)](_0x36b0cf(0x2a5)+_0x349859[_0x36b0cf(0x1e5)]+'\x20merchants\x20for\x20selection'+(_0x4cdc0f?_0x36b0cf(0x327):'')),_0x349859[_0x36b0cf(0x2c6)](_0x1dcce2=>({'id':_0x1dcce2['id'],'username':_0x1dcce2[_0x36b0cf(0x1d8)],'name':_0x1dcce2[_0x36b0cf(0x231)]}));}['getGatewayDisplayName'](_0x2856b6){const _0x10e67=a50_0xedf481,_0x6281d9={'test_gateway':_0x10e67(0x1e7),'plisio':_0x10e67(0x1ec),'rapyd':_0x10e67(0x2f9),'noda':'Noda','cointopay':'CoinToPay','cointopay2':_0x10e67(0x17e),'klyme_eu':_0x10e67(0x1a1),'klyme_gb':_0x10e67(0x234),'klyme_de':_0x10e67(0x21e),'mastercard':_0x10e67(0x2a9),'visa/mastercard':_0x10e67(0x22b),'amer':_0x10e67(0x1f9),'myxspend':_0x10e67(0x19b),'ampay':_0x10e67(0x205),'ampay_try':_0x10e67(0x334),'sepa':'Sepa','interac':'Interac','onramp':_0x10e67(0x343),'squirrelpay':_0x10e67(0x1c9),'maxpara':'MaxPara','instaxchange':_0x10e67(0x1aa),'oxapay':_0x10e67(0x2ae)};return _0x6281d9[_0x2856b6]||_0x2856b6;}['getGatewayInternalName'](_0x4220c8){const _0x3e3b13=a50_0xedf481,_0x286f5f={'Test\x20Gateway':'test_gateway','Plisio':'plisio','Rapyd':_0x3e3b13(0x1fa),'Noda':_0x3e3b13(0x174),'CoinToPay':_0x3e3b13(0x1d7),'CoinToPay2':_0x3e3b13(0x25e),'KLYME\x20EU':_0x3e3b13(0x16b),'KLYME\x20GB':'klyme_gb','KLYME\x20DE':_0x3e3b13(0x29d),'MasterCard':_0x3e3b13(0x307)};return _0x286f5f[_0x4220c8]||_0x4220c8[_0x3e3b13(0x238)]();}async['getMerchantsAwaitingPayout'](_0x254712){const _0x125124=a50_0xedf481,{page:_0x5659b9,limit:_0x4e2b29,minAmount:_0x1ec600,search:_0x4172ca}=_0x254712;console[_0x125124(0x22c)](_0x125124(0x2de),_0x254712);let _0x460c60={};_0x4172ca&&(_0x460c60[_0x125124(0x231)]={'contains':_0x4172ca,'mode':_0x125124(0x2bc)});const _0x118d77=await database_1['default'][_0x125124(0x251)][_0x125124(0x239)]({'where':_0x460c60,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),_0x5c43af=_0x118d77[_0x125124(0x2d5)](_0x15ff8f=>{const _0x48c4a5=_0x125124,_0x286354=Math[_0x48c4a5(0x344)](_0x15ff8f[_0x48c4a5(0x2d1)]*0x64)/0x64;if(_0x1ec600&&_0x286354<_0x1ec600)return![];return _0x286354!==0x0;});_0x5c43af['sort']((_0x3675d6,_0x3bad26)=>_0x3bad26[_0x125124(0x2d1)]-_0x3675d6[_0x125124(0x2d1)]);const _0x838a26=_0x5c43af[_0x125124(0x1e5)],_0x471738=(_0x5659b9-0x1)*_0x4e2b29,_0x5401e0=_0x5c43af['slice'](_0x471738,_0x471738+_0x4e2b29);console[_0x125124(0x22c)]('ðŸ’°\x20Found\x20'+_0x5401e0['length']+_0x125124(0x270));const _0x3a68d8=await Promise[_0x125124(0x215)](_0x5401e0['map'](async _0x46249e=>{const _0xa78bb6=_0x125124,[_0x3200d8,_0x53c484,_0xbf0a10]=await Promise[_0xa78bb6(0x215)]([database_1[_0xa78bb6(0x2b8)][_0xa78bb6(0x18d)][_0xa78bb6(0x2ac)]({'where':{'shopId':_0x46249e['id'],'status':_0xa78bb6(0x286),'gateway':{'not':_0xa78bb6(0x31f)}}}),database_1[_0xa78bb6(0x2b8)][_0xa78bb6(0x18d)][_0xa78bb6(0x1c7)]({'where':{'shopId':_0x46249e['id'],'status':_0xa78bb6(0x286),'gateway':{'not':_0xa78bb6(0x31f)}},'orderBy':{'paidAt':_0xa78bb6(0x230)},'select':{'paidAt':!![]}}),database_1[_0xa78bb6(0x2b8)][_0xa78bb6(0x18d)][_0xa78bb6(0x315)]({'by':[_0xa78bb6(0x196)],'where':{'shopId':_0x46249e['id'],'status':_0xa78bb6(0x286),'gateway':{'not':_0xa78bb6(0x31f)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x384c31=new Date(),_0x3db984=new Date(_0x384c31['getFullYear'](),_0x384c31[_0xa78bb6(0x2e5)](),0x1),_0x29950f=new Date(_0x384c31[_0xa78bb6(0x1b7)](),_0x384c31[_0xa78bb6(0x2e5)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x1a9d6a,_0x264cf7]=await Promise[_0xa78bb6(0x215)]([database_1[_0xa78bb6(0x2b8)][_0xa78bb6(0x2f0)][_0xa78bb6(0x1c6)]({'_sum':{'amount':!![]},'where':{'shopId':_0x46249e['id'],'status':_0xa78bb6(0x2a6)}}),database_1['default'][_0xa78bb6(0x2f0)]['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x46249e['id'],'status':_0xa78bb6(0x2a6),'createdAt':{'gte':_0x3db984,'lte':_0x29950f}}})]),_0x12fd8d=_0x1a9d6a[_0xa78bb6(0x280)]['amount']||0x0,_0x10641c=_0x264cf7['_sum']['amount']||0x0,_0x18c647=await Promise['all'](_0xbf0a10[_0xa78bb6(0x2c6)](async _0x2777cb=>{const _0x17eb31=_0xa78bb6,_0x40e8ca=await database_1[_0x17eb31(0x2b8)][_0x17eb31(0x18d)][_0x17eb31(0x239)]({'where':{'shopId':_0x46249e['id'],'status':_0x17eb31(0x286),'gateway':_0x2777cb['gateway']},'select':{'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![]}});let _0x409eb8=0x2d;if(_0x46249e['gatewaySettings'])try{const _0x4c25b4=JSON[_0x17eb31(0x1e6)](_0x46249e[_0x17eb31(0x1b6)]);for(const [_0x5a8e0f,_0x475e69]of Object[_0x17eb31(0x2d9)](_0x4c25b4)){if(_0x5a8e0f[_0x17eb31(0x238)]()===_0x2777cb[_0x17eb31(0x196)][_0x17eb31(0x238)]()){_0x409eb8=_0x475e69[_0x17eb31(0x271)]||0xa,console[_0x17eb31(0x22c)](_0x17eb31(0x1a6)+_0x2777cb[_0x17eb31(0x196)]+_0x17eb31(0x212)+_0x46249e['id']+_0x17eb31(0x26a)+_0x409eb8+'%');break;}}}catch(_0x58226c){console[_0x17eb31(0x33b)](_0x17eb31(0x1a2)+_0x46249e['id']+':',_0x58226c);}const _0x56c400=_0x2777cb['_sum']?.['amountUSDT']||0x0;let _0x587a67=0x0;for(const _0x549c07 of _0x40e8ca){if(_0x549c07['amountAfterGatewayCommissionUSDT']!==null&&_0x549c07['amountAfterGatewayCommissionUSDT']!==undefined)_0x587a67+=_0x549c07['amountAfterGatewayCommissionUSDT'];else{const _0x1155c4=_0x549c07[_0x17eb31(0x2d3)]||0x0;_0x587a67+=_0x1155c4*(0x1-_0x409eb8/0x64);}}return{'gateway':_0x2777cb['gateway'],'count':_0x2777cb[_0x17eb31(0x1e8)]?.['id']||0x0,'amountUSDT':Math[_0x17eb31(0x2b0)](_0x56c400*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x17eb31(0x2b0)](_0x587a67*0x64)/0x64,'commission':_0x409eb8};})),_0x169c6f=_0x18c647[_0xa78bb6(0x21d)]((_0xa06b70,_0x4429df)=>_0xa06b70+_0x4429df[_0xa78bb6(0x2d3)],0x0),_0x23f9e3=_0x18c647[_0xa78bb6(0x21d)]((_0x5eb816,_0x43adef)=>_0x5eb816+_0x43adef[_0xa78bb6(0x227)],0x0),_0xe82585=_0x46249e[_0xa78bb6(0x2d1)];return console[_0xa78bb6(0x22c)](_0xa78bb6(0x2c9)+_0x46249e[_0xa78bb6(0x1d8)]+':'),console['log']('\x20\x20\x20ï¿½\x20Total\x20payments\x20turnover:\x20'+_0x169c6f[_0xa78bb6(0x1ea)](0x2)+_0xa78bb6(0x21f)),console[_0xa78bb6(0x22c)](_0xa78bb6(0x242)+_0x23f9e3[_0xa78bb6(0x1ea)](0x2)+_0xa78bb6(0x32a)),console[_0xa78bb6(0x22c)]('\x20\x20\x20âœ…\x20Actual\x20available\x20balance:\x20'+_0xe82585[_0xa78bb6(0x1ea)](0x2)+'\x20USDT\x20(current\x20balance\x20in\x20DB)'),console[_0xa78bb6(0x22c)]('\x20\x20\x20ðŸ’¸\x20Total\x20payouts:\x20'+_0x12fd8d[_0xa78bb6(0x1ea)](0x2)+'\x20USDT\x20(already\x20paid\x20out)'),console[_0xa78bb6(0x22c)](_0xa78bb6(0x1af)+(_0x23f9e3-_0x12fd8d-_0xe82585)[_0xa78bb6(0x1ea)](0x2)+_0xa78bb6(0x29b)),{'id':_0x46249e['id'],'fullName':_0x46249e[_0xa78bb6(0x231)],'username':_0x46249e[_0xa78bb6(0x1d8)],'telegramId':_0x46249e[_0xa78bb6(0x330)],'merchantUrl':_0x46249e['shopUrl'],'wallets':{'usdtPolygonWallet':_0x46249e['usdtPolygonWallet'],'usdtTrcWallet':_0x46249e[_0xa78bb6(0x25c)],'usdtErcWallet':_0x46249e[_0xa78bb6(0x25b)],'usdcPolygonWallet':_0x46249e[_0xa78bb6(0x295)],'usdcErcWallet':_0x46249e[_0xa78bb6(0x181)]},'totalAmountUSDT':Math[_0xa78bb6(0x2b0)](_0x169c6f*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x23f9e3*0x64)/0x64,'currentBalance':Math[_0xa78bb6(0x344)](_0xe82585*0x64)/0x64,'totalPayout':Math[_0xa78bb6(0x2b0)](_0x12fd8d*0x64)/0x64,'thisMonth':Math[_0xa78bb6(0x2b0)](_0x10641c*0x64)/0x64,'paymentsCount':_0x3200d8,'oldestPaymentDate':_0x53c484?.['paidAt']||_0x46249e[_0xa78bb6(0x27b)],'gatewayBreakdown':_0x18c647};})),_0x41376a=_0x3a68d8[_0x125124(0x21d)]((_0x3943a2,_0x511436)=>_0x3943a2+_0x511436[_0x125124(0x1ed)],0x0),_0x4a2235=_0x3a68d8[_0x125124(0x21d)]((_0x11bb69,_0x24131e)=>_0x11bb69+_0x24131e[_0x125124(0x24a)],0x0),_0x20e05a=_0x3a68d8[_0x125124(0x21d)]((_0x32f6d1,_0x24bb9b)=>_0x32f6d1+_0x24bb9b[_0x125124(0x2a2)],0x0),_0x2eae4b=_0x3a68d8[_0x125124(0x21d)]((_0x579b5f,_0x446834)=>_0x579b5f+_0x446834['thisMonth'],0x0);return console['log']('ðŸ“Š\x20Merchants\x20with\x20rounded\x20balance\x20!=\x200.00:\x20'+_0x838a26+'\x20merchants'),console[_0x125124(0x22c)](_0x125124(0x27c)+Math[_0x125124(0x2b0)](_0x41376a*0x64)/0x64+'\x20USDT\x20(gross\x20revenue)'),console[_0x125124(0x22c)](_0x125124(0x243)+Math['round'](_0x4a2235*0x64)/0x64+'\x20USDT\x20(rounded\x20to\x202\x20decimal\x20places)'),console[_0x125124(0x22c)](_0x125124(0x282)+Math[_0x125124(0x2b0)](_0x20e05a*0x64)/0x64+_0x125124(0x241)),console[_0x125124(0x22c)](_0x125124(0x1cc)+Math[_0x125124(0x2b0)](_0x2eae4b*0x64)/0x64+'\x20USDT'),{'merchants':_0x3a68d8,'pagination':{'page':_0x5659b9,'limit':_0x4e2b29,'total':_0x838a26,'totalPages':Math[_0x125124(0x264)](_0x838a26/_0x4e2b29)},'summary':{'totalMerchants':_0x838a26,'totalAmountUSDT':Math[_0x125124(0x2b0)](_0x41376a*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x125124(0x2b0)](_0x4a2235*0x64)/0x64,'totalPayout':Math[_0x125124(0x2b0)](_0x20e05a*0x64)/0x64,'thisMonth':Math['round'](_0x2eae4b*0x64)/0x64}};}async[a50_0xedf481(0x1fc)](_0x52e4b3){const _0x158598=a50_0xedf481,{shopId:_0x54aaee,amount:_0x5a7392,network:_0xbba30d,wallet:_0x3b51d3,notes:_0xc8b0,txid:_0x195e7b,periodFrom:_0x2683e0,periodTo:_0x411bab}=_0x52e4b3,_0x5c793a=await database_1['default'][_0x158598(0x195)](async _0xbd0ad=>{const _0x275e12=_0x158598,_0x55652d=await _0xbd0ad[_0x275e12(0x251)][_0x275e12(0x2ab)]({'where':{'id':_0x54aaee},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x55652d)throw new Error('Shop\x20not\x20found');console[_0x275e12(0x22c)]('ðŸ’°\x20Creating\x20payout\x20for\x20shop\x20'+_0x55652d[_0x275e12(0x1d8)]+':'),console['log'](_0x275e12(0x299)+_0x55652d[_0x275e12(0x2d1)][_0x275e12(0x1ea)](0x6)+_0x275e12(0x241)),console[_0x275e12(0x22c)](_0x275e12(0x245)+_0x5a7392['toFixed'](0x6)+'\x20USDT'),console[_0x275e12(0x22c)]('\x20\x20\x20Current\x20total\x20paid\x20out:\x20'+_0x55652d[_0x275e12(0x274)][_0x275e12(0x1ea)](0x6)+_0x275e12(0x241));if(_0x195e7b)console[_0x275e12(0x22c)](_0x275e12(0x1f0)+_0x195e7b);const _0x1c3f34=0.000001,_0x14e04b=Number(_0x55652d[_0x275e12(0x2d1)]),_0x3be30e=Number(_0x5a7392);console[_0x275e12(0x22c)](_0x275e12(0x1d5)),console['log']('\x20\x20\x20Available\x20(raw):\x20'+_0x55652d[_0x275e12(0x2d1)]),console[_0x275e12(0x22c)]('\x20\x20\x20Available\x20(number):\x20'+_0x14e04b),console[_0x275e12(0x22c)](_0x275e12(0x1fd)+_0x3be30e),console[_0x275e12(0x22c)](_0x275e12(0x1d2)+(_0x14e04b-_0x3be30e)),console[_0x275e12(0x22c)](_0x275e12(0x2f1)+_0x1c3f34);if(_0x14e04b<_0x3be30e-_0x1c3f34)throw new Error(_0x275e12(0x1f4)+_0x14e04b[_0x275e12(0x1ea)](0x6)+_0x275e12(0x272)+_0x3be30e[_0x275e12(0x1ea)](0x6)+_0x275e12(0x2f4)+(_0x14e04b-_0x3be30e)[_0x275e12(0x1ea)](0x8)+'\x20USDT');console[_0x275e12(0x22c)](_0x275e12(0x1cd));const _0x5a5f54=Math[_0x275e12(0x1cf)](_0x14e04b,_0x3be30e);let _0x3263de=_0x3b51d3;console['log'](_0x275e12(0x2b2)+(_0x3b51d3||_0x275e12(0x2ce)));if(!_0x3263de){console['log'](_0x275e12(0x2fa));const _0x47544d=await _0xbd0ad['shop']['findUnique']({'where':{'id':_0x54aaee},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});console[_0x275e12(0x22c)](_0x275e12(0x178),_0x47544d);if(_0x47544d)switch(_0xbba30d){case _0x275e12(0x217):_0x3263de=_0x47544d[_0x275e12(0x219)]||undefined,console[_0x275e12(0x22c)](_0x275e12(0x2ef)+_0x3263de);break;case'trc20':_0x3263de=_0x47544d[_0x275e12(0x25c)]||undefined,console['log'](_0x275e12(0x170)+_0x3263de);break;case'erc20':_0x3263de=_0x47544d[_0x275e12(0x25b)]||undefined,console[_0x275e12(0x22c)](_0x275e12(0x1bf)+_0x3263de);break;case _0x275e12(0x2c2):_0x3263de=_0x47544d['usdcPolygonWallet']||undefined,console[_0x275e12(0x22c)](_0x275e12(0x336)+_0x3263de);break;case _0x275e12(0x2d6):_0x3263de=_0x47544d[_0x275e12(0x181)]||undefined,console[_0x275e12(0x22c)](_0x275e12(0x1d9)+_0x3263de);break;}}else console[_0x275e12(0x22c)](_0x275e12(0x31d)+_0x3263de);console[_0x275e12(0x22c)](_0x275e12(0x2f3)+_0xbba30d+':\x20'+(_0x3263de||_0x275e12(0x1b2))),console[_0x275e12(0x22c)](_0x275e12(0x190),{'shopId':_0x54aaee,'amount':_0x5a5f54,'network':_0xbba30d,'wallet':_0x3263de,'status':'COMPLETED','txid':_0x195e7b,'notes':_0xc8b0,'periodFrom':_0x2683e0?new Date(_0x2683e0):null,'periodTo':_0x411bab?new Date(_0x411bab):null});const _0xfec07c=await _0xbd0ad['payout'][_0x275e12(0x19e)]({'data':{'shopId':_0x54aaee,'amount':_0x5a5f54,'network':_0xbba30d,'wallet':_0x3263de,'status':_0x275e12(0x2a6),'txid':_0x195e7b,'notes':_0xc8b0,'periodFrom':_0x2683e0?new Date(_0x2683e0):null,'periodTo':_0x411bab?new Date(_0x411bab):null,'createdAt':new Date(),'paidAt':new Date()}});console[_0x275e12(0x22c)](_0x275e12(0x296),{'id':_0xfec07c['id'],'wallet':_0xfec07c[_0x275e12(0x319)],'network':_0xfec07c[_0x275e12(0x1fe)],'amount':_0xfec07c[_0x275e12(0x322)]});const _0x584b1e=_0x14e04b-_0x5a5f54,_0x514b10=Number(_0x55652d['totalPaidOut'])+_0x5a5f54;return await _0xbd0ad['shop'][_0x275e12(0x24e)]({'where':{'id':_0x54aaee},'data':{'balance':_0x584b1e,'totalPaidOut':_0x514b10}}),console[_0x275e12(0x22c)]('ðŸ’°\x20Shop\x20'+_0x55652d[_0x275e12(0x1d8)]+'\x20balance\x20updated:'),console['log']('\x20\x20\x20Balance:\x20'+_0x14e04b[_0x275e12(0x1ea)](0x6)+_0x275e12(0x33c)+_0x584b1e[_0x275e12(0x1ea)](0x6)+'\x20USDT\x20(-'+_0x5a5f54[_0x275e12(0x1ea)](0x6)+')'),console['log'](_0x275e12(0x288)+_0x55652d[_0x275e12(0x274)]['toFixed'](0x6)+'\x20->\x20'+_0x514b10['toFixed'](0x6)+'\x20USDT\x20(+'+_0x5a5f54[_0x275e12(0x1ea)](0x6)+')'),console[_0x275e12(0x22c)](_0x275e12(0x30f)+_0x5a5f54[_0x275e12(0x1ea)](0x6)+_0x275e12(0x241)),{'payout':_0xfec07c,'shop':_0x55652d};});console[_0x158598(0x22c)](_0x158598(0x187)+_0x5c793a[_0x158598(0x2f0)]['id']+_0x158598(0x212)+_0x5c793a[_0x158598(0x251)][_0x158598(0x1d8)]+'\x20('+_0x5c793a['payout'][_0x158598(0x322)][_0x158598(0x1ea)](0x6)+_0x158598(0x1de));try{let _0x1a3e8c=_0x158598(0x16d);if(_0x5c793a[_0x158598(0x2f0)]['periodFrom']&&_0x5c793a['payout'][_0x158598(0x201)]){const _0xa560f3=new Date(_0x5c793a[_0x158598(0x2f0)][_0x158598(0x257)])[_0x158598(0x171)]('ru-RU'),_0x3407a1=new Date(_0x5c793a[_0x158598(0x2f0)][_0x158598(0x201)])['toLocaleDateString'](_0x158598(0x2a1));_0x1a3e8c=_0xa560f3+_0x158598(0x24d)+_0x3407a1;}await telegramBotService_1[_0x158598(0x1ad)][_0x158598(0x304)](_0x5c793a[_0x158598(0x2f0)]['shopId'],{'id':_0x5c793a[_0x158598(0x2f0)]['id'],'amount':_0x5c793a[_0x158598(0x2f0)][_0x158598(0x322)],'network':_0x5c793a[_0x158598(0x2f0)]['network'],'wallet':_0x5c793a['payout'][_0x158598(0x319)],'period':_0x1a3e8c,'createdAt':_0x5c793a[_0x158598(0x2f0)][_0x158598(0x27b)],'txid':_0x5c793a[_0x158598(0x2f0)][_0x158598(0x2b7)]}),console[_0x158598(0x22c)]('ðŸ“±\x20Telegram\x20notification\x20sent\x20for\x20payout\x20'+_0x5c793a[_0x158598(0x2f0)]['id']);}catch(_0x183e2f){console[_0x158598(0x33b)]('âŒ\x20Failed\x20to\x20send\x20Telegram\x20notification\x20for\x20payout\x20'+_0x5c793a[_0x158598(0x2f0)]['id']+':',_0x183e2f);}return{'id':_0x5c793a[_0x158598(0x2f0)]['id'],'shopId':_0x5c793a[_0x158598(0x2f0)][_0x158598(0x176)],'shopName':_0x5c793a[_0x158598(0x251)][_0x158598(0x231)],'shopUsername':_0x5c793a['shop']['username'],'amount':_0x5c793a['payout'][_0x158598(0x322)],'network':_0x5c793a[_0x158598(0x2f0)][_0x158598(0x1fe)],'wallet':_0x5c793a[_0x158598(0x2f0)][_0x158598(0x319)],'status':_0x5c793a[_0x158598(0x2f0)][_0x158598(0x289)],'txid':_0x5c793a[_0x158598(0x2f0)][_0x158598(0x2b7)],'notes':_0x5c793a['payout'][_0x158598(0x17f)],'periodFrom':_0x5c793a['payout'][_0x158598(0x257)],'periodTo':_0x5c793a[_0x158598(0x2f0)]['periodTo'],'createdAt':_0x5c793a[_0x158598(0x2f0)][_0x158598(0x27b)],'paidAt':_0x5c793a[_0x158598(0x2f0)][_0x158598(0x1e0)]};}async['getAllPayouts'](_0x22ea6f){const _0x4d7dd0=a50_0xedf481,{page:_0x1c5b47,limit:_0x5520a2,shopId:_0x531b6b,network:_0x177f6e,dateFrom:_0x51b96e,dateTo:_0x4340d4,search:_0x410983}=_0x22ea6f,_0x1fb368=(_0x1c5b47-0x1)*_0x5520a2,_0x5721f5={};_0x531b6b&&(_0x5721f5[_0x4d7dd0(0x176)]=_0x531b6b);_0x177f6e&&(_0x5721f5[_0x4d7dd0(0x1fe)]=_0x177f6e);if(_0x51b96e||_0x4340d4){_0x5721f5[_0x4d7dd0(0x27b)]={};if(_0x51b96e){const _0x32818e=new Date(_0x51b96e);_0x32818e['setHours'](0x0,0x0,0x0,0x1),_0x5721f5[_0x4d7dd0(0x27b)]['gte']=_0x32818e,console[_0x4d7dd0(0x22c)](_0x4d7dd0(0x269)+_0x32818e[_0x4d7dd0(0x26c)]());}if(_0x4340d4){const _0x18e08c=new Date(_0x4340d4);_0x18e08c[_0x4d7dd0(0x28c)](0x17,0x3b,0x3b,0x3e7),_0x5721f5['createdAt'][_0x4d7dd0(0x2bb)]=_0x18e08c,console['log'](_0x4d7dd0(0x20d)+_0x18e08c[_0x4d7dd0(0x26c)]());}}_0x410983&&(_0x5721f5['OR']=[{'shop':{'name':{'contains':_0x410983,'mode':_0x4d7dd0(0x2bc)}}},{'shop':{'username':{'contains':_0x410983,'mode':_0x4d7dd0(0x2bc)}}},{'notes':{'contains':_0x410983,'mode':_0x4d7dd0(0x2bc)}}]);const [_0x436f95,_0x5c8636]=await Promise['all']([database_1[_0x4d7dd0(0x2b8)]['payout'][_0x4d7dd0(0x239)]({'where':_0x5721f5,'skip':_0x1fb368,'take':_0x5520a2,'orderBy':{'createdAt':_0x4d7dd0(0x298)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'wallet':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x4d7dd0(0x2b8)]['payout'][_0x4d7dd0(0x2ac)]({'where':_0x5721f5})]);return{'payouts':_0x436f95['map'](_0x362251=>({'id':_0x362251['id'],'shopId':_0x362251[_0x4d7dd0(0x176)],'shopName':_0x362251[_0x4d7dd0(0x251)][_0x4d7dd0(0x231)],'shopUsername':_0x362251['shop']['username'],'amount':_0x362251[_0x4d7dd0(0x322)],'network':_0x362251['network'],'wallet':_0x362251[_0x4d7dd0(0x319)],'status':_0x362251['status'],'txid':_0x362251[_0x4d7dd0(0x2b7)],'notes':_0x362251[_0x4d7dd0(0x17f)],'periodFrom':_0x362251[_0x4d7dd0(0x257)],'periodTo':_0x362251[_0x4d7dd0(0x201)],'createdAt':_0x362251[_0x4d7dd0(0x27b)],'paidAt':_0x362251[_0x4d7dd0(0x1e0)]})),'pagination':{'page':_0x1c5b47,'limit':_0x5520a2,'total':_0x5c8636,'totalPages':Math[_0x4d7dd0(0x264)](_0x5c8636/_0x5520a2)}};}async[a50_0xedf481(0x23f)](_0x4a9214){const _0x5cb4ad=a50_0xedf481,_0x12b142=await database_1[_0x5cb4ad(0x2b8)][_0x5cb4ad(0x2f0)][_0x5cb4ad(0x2ab)]({'where':{'id':_0x4a9214},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x12b142)return null;return{'id':_0x12b142['id'],'shopId':_0x12b142['shopId'],'shopName':_0x12b142['shop'][_0x5cb4ad(0x231)],'shopUsername':_0x12b142[_0x5cb4ad(0x251)][_0x5cb4ad(0x1d8)],'amount':_0x12b142[_0x5cb4ad(0x322)],'network':_0x12b142[_0x5cb4ad(0x1fe)],'wallet':_0x12b142[_0x5cb4ad(0x319)],'status':_0x12b142['status'],'txid':_0x12b142['txid'],'notes':_0x12b142['notes'],'periodFrom':_0x12b142[_0x5cb4ad(0x257)],'periodTo':_0x12b142['periodTo'],'createdAt':_0x12b142[_0x5cb4ad(0x27b)],'paidAt':_0x12b142[_0x5cb4ad(0x1e0)]};}async[a50_0xedf481(0x301)](_0x249f77){const _0x39f1c5=a50_0xedf481;await database_1[_0x39f1c5(0x2b8)][_0x39f1c5(0x2f0)]['delete']({'where':{'id':_0x249f77}});}async[a50_0xedf481(0x33d)](_0x273048,_0xbff07e){const _0x1a4deb=a50_0xedf481,_0x59d3bb=await database_1[_0x1a4deb(0x2b8)]['$transaction'](async _0x10eece=>{const _0x559d0b=_0x1a4deb,_0x55af06=await _0x10eece[_0x559d0b(0x2f0)][_0x559d0b(0x2ab)]({'where':{'id':_0x273048},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}}}});if(!_0x55af06)throw new Error('Payout\x20not\x20found');console['log'](_0x559d0b(0x235)+_0x273048+_0x559d0b(0x212)+_0x55af06[_0x559d0b(0x251)][_0x559d0b(0x1d8)]+':'),console[_0x559d0b(0x22c)](_0x559d0b(0x313)+_0x55af06[_0x559d0b(0x322)][_0x559d0b(0x1ea)](0x6)+'\x20USDT'),console['log']('\x20\x20\x20Current\x20network:\x20'+_0x55af06['network']),console[_0x559d0b(0x22c)](_0x559d0b(0x1c4)+_0x55af06[_0x559d0b(0x251)][_0x559d0b(0x2d1)]['toFixed'](0x6)+_0x559d0b(0x241)),console[_0x559d0b(0x22c)](_0x559d0b(0x18e)+_0x55af06['shop'][_0x559d0b(0x274)][_0x559d0b(0x1ea)](0x6)+'\x20USDT');let _0x314bfb=0x0;if(_0xbff07e[_0x559d0b(0x322)]!==undefined){const _0x4cfdce=Number(_0x55af06['amount']),_0x3664e9=Number(_0xbff07e['amount']);_0x314bfb=_0x3664e9-_0x4cfdce,console[_0x559d0b(0x22c)](_0x559d0b(0x1ef)+_0x3664e9[_0x559d0b(0x1ea)](0x6)+_0x559d0b(0x241)),console[_0x559d0b(0x22c)](_0x559d0b(0x33f)+_0x314bfb[_0x559d0b(0x1ea)](0x6)+_0x559d0b(0x241));if(_0x314bfb<0x0)console[_0x559d0b(0x22c)](_0x559d0b(0x300)+Math[_0x559d0b(0x23e)](_0x314bfb)['toFixed'](0x6)+_0x559d0b(0x2ea));else{if(_0x314bfb>0x0){const _0xf189ec=Number(_0x55af06[_0x559d0b(0x251)][_0x559d0b(0x2d1)]);console['log'](_0x559d0b(0x1b5)+_0x314bfb[_0x559d0b(0x1ea)](0x6)+'\x20USDT\x20-\x20will\x20deduct\x20from\x20balance');if(_0xf189ec<_0x314bfb)throw new Error('Insufficient\x20balance\x20for\x20amount\x20increase.\x20Available:\x20'+_0xf189ec[_0x559d0b(0x1ea)](0x6)+'\x20USDT,\x20Required:\x20'+_0x314bfb[_0x559d0b(0x1ea)](0x6)+_0x559d0b(0x241));}}}const _0x4a8f8b={};if(_0xbff07e[_0x559d0b(0x322)]!==undefined)_0x4a8f8b['amount']=_0xbff07e[_0x559d0b(0x322)];if(_0xbff07e[_0x559d0b(0x1fe)]!==undefined)_0x4a8f8b['network']=_0xbff07e[_0x559d0b(0x1fe)];if(_0xbff07e[_0x559d0b(0x319)]!==undefined)_0x4a8f8b['wallet']=_0xbff07e['wallet']||null;if(_0xbff07e['notes']!==undefined)_0x4a8f8b[_0x559d0b(0x17f)]=_0xbff07e[_0x559d0b(0x17f)]||null;if(_0xbff07e[_0x559d0b(0x2b7)]!==undefined)_0x4a8f8b[_0x559d0b(0x2b7)]=_0xbff07e['txid']||null;if(_0xbff07e[_0x559d0b(0x257)]!==undefined)_0x4a8f8b[_0x559d0b(0x257)]=_0xbff07e['periodFrom']?new Date(_0xbff07e[_0x559d0b(0x257)]):null;if(_0xbff07e[_0x559d0b(0x201)]!==undefined)_0x4a8f8b[_0x559d0b(0x201)]=_0xbff07e['periodTo']?new Date(_0xbff07e[_0x559d0b(0x201)]):null;const _0x4b9b07=await _0x10eece[_0x559d0b(0x2f0)][_0x559d0b(0x24e)]({'where':{'id':_0x273048},'data':_0x4a8f8b,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(_0x314bfb!==0x0){const _0x3f621c=Number(_0x55af06[_0x559d0b(0x251)][_0x559d0b(0x2d1)]),_0x1629a3=Number(_0x55af06['shop'][_0x559d0b(0x274)]),_0x549cbd=_0x3f621c-_0x314bfb,_0x2d1d81=_0x1629a3+_0x314bfb;await _0x10eece['shop']['update']({'where':{'id':_0x55af06[_0x559d0b(0x176)]},'data':{'balance':_0x549cbd,'totalPaidOut':_0x2d1d81}}),console[_0x559d0b(0x22c)]('ðŸ’°\x20Shop\x20'+_0x55af06[_0x559d0b(0x251)][_0x559d0b(0x1d8)]+'\x20balance\x20updated:'),console['log'](_0x559d0b(0x1e2)+_0x3f621c[_0x559d0b(0x1ea)](0x6)+_0x559d0b(0x33c)+_0x549cbd[_0x559d0b(0x1ea)](0x6)+'\x20USDT'),console[_0x559d0b(0x22c)](_0x559d0b(0x288)+_0x1629a3[_0x559d0b(0x1ea)](0x6)+_0x559d0b(0x33c)+_0x2d1d81['toFixed'](0x6)+_0x559d0b(0x241));}return console[_0x559d0b(0x22c)](_0x559d0b(0x1da)+_0x273048+_0x559d0b(0x2db)),_0x4b9b07;});return{'id':_0x59d3bb['id'],'shopId':_0x59d3bb[_0x1a4deb(0x176)],'shopName':_0x59d3bb[_0x1a4deb(0x251)][_0x1a4deb(0x231)],'shopUsername':_0x59d3bb[_0x1a4deb(0x251)][_0x1a4deb(0x1d8)],'amount':Number(_0x59d3bb[_0x1a4deb(0x322)]),'network':_0x59d3bb[_0x1a4deb(0x1fe)],'wallet':_0x59d3bb['wallet'],'status':_0x59d3bb[_0x1a4deb(0x289)],'txid':_0x59d3bb['txid'],'notes':_0x59d3bb[_0x1a4deb(0x17f)],'periodFrom':_0x59d3bb[_0x1a4deb(0x257)],'periodTo':_0x59d3bb[_0x1a4deb(0x201)],'createdAt':_0x59d3bb[_0x1a4deb(0x27b)],'paidAt':_0x59d3bb[_0x1a4deb(0x1e0)]};}async['getAllPayments'](_0x49b446){const _0x578e39=a50_0xedf481,{page:_0x521793,limit:_0x56c41d,status:_0x10d2a4,gateway:_0x5053b9,shopId:_0x43b452,dateFrom:_0x16e4be,dateTo:_0x225932,search:_0x5606ad,currency:_0x4f0281,sortBy:_0x6c962b,sortOrder:_0x5d6546}=_0x49b446,_0x22fc1d=(_0x521793-0x1)*_0x56c41d;console[_0x578e39(0x22c)](_0x578e39(0x2eb),_0x49b446);const _0x2e8481=await database_1[_0x578e39(0x2b8)]['payment'][_0x578e39(0x315)]({'by':[_0x578e39(0x196)],'_count':{'gateway':!![]}});console['log'](_0x578e39(0x28b),_0x2e8481[_0x578e39(0x2c6)](_0xcb3f60=>_0xcb3f60[_0x578e39(0x196)]+'\x20('+_0xcb3f60['_count']['gateway']+_0x578e39(0x260)));if(_0x5053b9){const _0xe43755=_0x2e8481[_0x578e39(0x1c1)](_0x20a06d=>_0x20a06d[_0x578e39(0x196)][_0x578e39(0x238)]()===_0x5053b9[_0x578e39(0x238)]());!_0xe43755&&_0x5053b9[_0x578e39(0x238)]()!==_0x578e39(0x31f)&&console['log'](_0x578e39(0x209)+_0x5053b9+_0x578e39(0x1ca)+_0x2e8481['map'](_0x216ca0=>_0x216ca0['gateway'])[_0x578e39(0x194)](',\x20'));}const _0x116715={};_0x10d2a4&&(_0x116715['status']=_0x10d2a4[_0x578e39(0x2af)]());if(!_0x5053b9)_0x116715[_0x578e39(0x196)]={'not':_0x578e39(0x31f)};else{if(_0x5053b9&&(_0x5053b9[_0x578e39(0x238)]()===_0x578e39(0x31f)||_0x5053b9===_0x578e39(0x2df)))_0x116715[_0x578e39(0x196)]=_0x578e39(0x31f);else{let _0x1f4326=_0x5053b9;const _0x37f6e8=(0x0,gateway_1[_0x578e39(0x329)])(_0x5053b9);if(_0x37f6e8)_0x1f4326=_0x37f6e8,console[_0x578e39(0x22c)](_0x578e39(0x1ff)+_0x5053b9+_0x578e39(0x30a)+_0x1f4326+'\x27');else{const _0x29fab4=(0x0,gateway_1['getGatewayIdByName'])(_0x5053b9);if(_0x29fab4){const _0x2b3277=(0x0,gateway_1['getGatewayNameById'])(_0x29fab4);_0x2b3277&&(_0x1f4326=_0x2b3277,console[_0x578e39(0x22c)]('ðŸ”„\x20Converted\x20gateway\x20name\x20\x27'+_0x5053b9+_0x578e39(0x2c4)+_0x29fab4+_0x578e39(0x222)+_0x1f4326+'\x27'));}else console[_0x578e39(0x22c)](_0x578e39(0x208)+_0x5053b9+_0x578e39(0x275));}const _0x269fd6=await database_1[_0x578e39(0x2b8)][_0x578e39(0x18d)]['count']({'where':{'gateway':_0x1f4326['toLowerCase']()},'take':0x1});_0x269fd6===0x0?(console[_0x578e39(0x22c)](_0x578e39(0x2e4)+_0x1f4326+'\x27\x20(from\x20\x27'+_0x5053b9+_0x578e39(0x2ad)),_0x116715['gateway']=_0x578e39(0x302)):(_0x116715[_0x578e39(0x196)]=_0x1f4326[_0x578e39(0x238)](),console[_0x578e39(0x22c)](_0x578e39(0x20b)+_0x1f4326+_0x578e39(0x24b)+_0x5053b9+'\x27)'));}}console[_0x578e39(0x22c)](_0x578e39(0x236),_0x116715[_0x578e39(0x196)]);_0x43b452&&(_0x116715['shopId']=_0x43b452);_0x4f0281&&(_0x116715['currency']=_0x4f0281[_0x578e39(0x2af)](),console[_0x578e39(0x22c)](_0x578e39(0x21a)+_0x4f0281['toUpperCase']()));if(_0x16e4be||_0x225932){_0x116715[_0x578e39(0x27b)]={};if(_0x16e4be){const _0x21f9e6=new Date(_0x16e4be),_0x352a48=new Date(Date[_0x578e39(0x249)](_0x21f9e6[_0x578e39(0x323)](),_0x21f9e6[_0x578e39(0x1ab)](),_0x21f9e6[_0x578e39(0x1bd)](),0x0,0x0,0x0,0x0));_0x116715[_0x578e39(0x27b)][_0x578e39(0x284)]=_0x352a48,console['log'](_0x578e39(0x29e)+_0x352a48[_0x578e39(0x26c)]());}if(_0x225932){const _0x39726a=new Date(_0x225932),_0x5d4733=new Date(Date[_0x578e39(0x249)](_0x39726a['getUTCFullYear'](),_0x39726a[_0x578e39(0x1ab)](),_0x39726a[_0x578e39(0x1bd)](),0x17,0x3b,0x3b,0x3e7));_0x116715[_0x578e39(0x27b)][_0x578e39(0x2bb)]=_0x5d4733,console['log'](_0x578e39(0x1b1)+_0x5d4733[_0x578e39(0x26c)]());}}_0x5606ad&&(_0x116715['OR']=[{'id':{'contains':_0x5606ad,'mode':'insensitive'}},{'orderId':{'contains':_0x5606ad,'mode':'insensitive'}},{'gatewayOrderId':{'contains':_0x5606ad,'mode':_0x578e39(0x2bc)}},{'customerEmail':{'contains':_0x5606ad,'mode':_0x578e39(0x2bc)}},{'shop':{'name':{'contains':_0x5606ad,'mode':_0x578e39(0x2bc)}}},{'shop':{'username':{'contains':_0x5606ad,'mode':_0x578e39(0x2bc)}}}]);console[_0x578e39(0x22c)]('ðŸ“Š\x20Final\x20WHERE\x20conditions:',JSON[_0x578e39(0x247)](_0x116715,null,0x2));const _0x32ac56=await database_1[_0x578e39(0x2b8)][_0x578e39(0x18d)][_0x578e39(0x2ac)]({'where':_0x116715});console[_0x578e39(0x22c)](_0x578e39(0x267)+_0x32ac56);let _0x1132d4={'createdAt':'desc'};if(_0x6c962b){const _0x2d9ec7=['amount',_0x578e39(0x27b),_0x578e39(0x312),_0x578e39(0x289),_0x578e39(0x196),'currency'],_0x2905de=[_0x578e39(0x230),_0x578e39(0x298)];if(_0x2d9ec7[_0x578e39(0x325)](_0x6c962b)){const _0x44b8d0=_0x2905de[_0x578e39(0x325)](_0x5d6546)?_0x5d6546:'desc';_0x1132d4={[_0x6c962b]:_0x44b8d0},console[_0x578e39(0x22c)](_0x578e39(0x2b9)+_0x6c962b+_0x578e39(0x1c3)+_0x44b8d0+_0x578e39(0x32e));}}const [_0x8a8483,_0x29cf8f]=await Promise['all']([database_1[_0x578e39(0x2b8)]['payment'][_0x578e39(0x239)]({'where':_0x116715,'skip':_0x22fc1d,'take':_0x56c41d,'orderBy':_0x1132d4,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x578e39(0x18d)][_0x578e39(0x2ac)]({'where':_0x116715})]);let _0x29f3b2,_0x227215;if(_0x16e4be){const _0x39a9da=new Date(_0x16e4be);_0x29f3b2=new Date(Date['UTC'](_0x39a9da['getUTCFullYear'](),_0x39a9da[_0x578e39(0x1ab)](),_0x39a9da[_0x578e39(0x1bd)](),0x0,0x0,0x0,0x0));}else{const _0x2ffdc2=new Date();_0x29f3b2=new Date(Date[_0x578e39(0x249)](_0x2ffdc2[_0x578e39(0x323)](),_0x2ffdc2[_0x578e39(0x1ab)](),_0x2ffdc2[_0x578e39(0x1bd)](),0x0,0x0,0x0,0x0));}if(_0x225932){const _0x204c34=new Date(_0x225932);_0x227215=new Date(Date[_0x578e39(0x249)](_0x204c34[_0x578e39(0x323)](),_0x204c34[_0x578e39(0x1ab)](),_0x204c34[_0x578e39(0x1bd)](),0x17,0x3b,0x3b,0x3e7));}else{if(_0x16e4be){const _0x495c52=new Date(_0x16e4be);_0x227215=new Date(Date[_0x578e39(0x249)](_0x495c52[_0x578e39(0x323)](),_0x495c52[_0x578e39(0x1ab)](),_0x495c52['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}else{const _0x4fcc4b=new Date();_0x227215=new Date(Date[_0x578e39(0x249)](_0x4fcc4b[_0x578e39(0x323)](),_0x4fcc4b[_0x578e39(0x1ab)](),_0x4fcc4b[_0x578e39(0x1bd)](),0x17,0x3b,0x3b,0x3e7));}}const _0x1d40ff={};{const _0x12d415={'status':_0x10d2a4?_0x10d2a4['toUpperCase']():_0x578e39(0x286),'createdAt':{'gte':_0x29f3b2,'lte':_0x227215}};_0x5053b9?_0x12d415[_0x578e39(0x196)]=_0x116715[_0x578e39(0x196)]:_0x12d415[_0x578e39(0x196)]={'not':'test_gateway'};_0x43b452&&(_0x12d415[_0x578e39(0x176)]=_0x43b452);_0x4f0281&&(_0x12d415[_0x578e39(0x340)]=_0x4f0281[_0x578e39(0x2af)]());console[_0x578e39(0x22c)]('ðŸ“Š\x20Statistics\x20WHERE\x20conditions:',JSON[_0x578e39(0x247)](_0x12d415,null,0x2));const _0x4d46dc=await database_1[_0x578e39(0x2b8)][_0x578e39(0x18d)][_0x578e39(0x239)]({'where':_0x12d415,'select':{'amountUSDT':!![],'currency':!![],'amount':!![]}});let _0x37d14f=0x0;_0x4d46dc[_0x578e39(0x1bc)](_0x12e2c7=>{const _0x468d4f=_0x578e39;_0x12e2c7['amountUSDT']&&(_0x37d14f+=_0x12e2c7[_0x468d4f(0x2d3)]);if(_0x12e2c7[_0x468d4f(0x340)]){const _0x264ced=_0x12e2c7[_0x468d4f(0x340)][_0x468d4f(0x2af)]();!_0x1d40ff[_0x264ced]&&(_0x1d40ff[_0x264ced]=0x0),_0x1d40ff[_0x264ced]+=_0x12e2c7[_0x468d4f(0x322)];}}),_0x37d14f>0x0&&(_0x1d40ff['USDT']=_0x37d14f);}return{'payments':_0x8a8483,'pagination':{'page':_0x521793,'limit':_0x56c41d,'total':_0x29cf8f,'totalPages':Math[_0x578e39(0x264)](_0x29cf8f/_0x56c41d)},'statistics':_0x1d40ff};}async[a50_0xedf481(0x1f5)](_0x3ec60d){const _0x4fbe1a=a50_0xedf481,_0x123db7=await database_1[_0x4fbe1a(0x2b8)]['payment'][_0x4fbe1a(0x2ab)]({'where':{'id':_0x3ec60d},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x123db7)return null;return{'id':_0x123db7['id'],'shopId':_0x123db7[_0x4fbe1a(0x176)],'gateway':_0x123db7['gateway'],'amount':_0x123db7[_0x4fbe1a(0x322)],'currency':_0x123db7[_0x4fbe1a(0x340)],'status':_0x123db7[_0x4fbe1a(0x289)],'orderId':_0x123db7[_0x4fbe1a(0x335)],'gatewayOrderId':_0x123db7[_0x4fbe1a(0x254)],'customerEmail':_0x123db7[_0x4fbe1a(0x225)],'customerName':_0x123db7['customerName'],'customerCountry':_0x123db7[_0x4fbe1a(0x2d8)],'customerIp':_0x123db7[_0x4fbe1a(0x244)],'customerUa':_0x123db7[_0x4fbe1a(0x1a9)],'failureMessage':_0x123db7[_0x4fbe1a(0x2bd)],'externalPaymentUrl':_0x123db7[_0x4fbe1a(0x314)],'successUrl':_0x123db7[_0x4fbe1a(0x1b9)],'failUrl':_0x123db7['failUrl'],'pendingUrl':_0x123db7['pendingUrl'],'whiteUrl':_0x123db7[_0x4fbe1a(0x16e)],'createdAt':_0x123db7['createdAt'],'updatedAt':_0x123db7[_0x4fbe1a(0x312)],'shop':_0x123db7[_0x4fbe1a(0x251)]};}async[a50_0xedf481(0x199)](_0x3557e5,_0x3725d0,_0x207aa8,_0xb65f82){const _0x4cc61e=a50_0xedf481,_0x1e4509=await database_1['default'][_0x4cc61e(0x195)](async _0xb1eb5b=>{const _0x5bd459=_0x4cc61e,_0xe68af4=await _0xb1eb5b['payment'][_0x5bd459(0x2ab)]({'where':{'id':_0x3557e5},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0xe68af4)throw new Error(_0x5bd459(0x18c));const _0x4f49dd=_0xe68af4['status'],_0x4c6393=_0x3725d0[_0x5bd459(0x2af)]();console[_0x5bd459(0x22c)](_0x5bd459(0x18a)+_0x3557e5+_0x5bd459(0x1d3)+_0x4f49dd+'\x20->\x20'+_0x4c6393),console[_0x5bd459(0x22c)]('ðŸ’°\x20Current\x20shop\x20balance:\x20'+_0xe68af4[_0x5bd459(0x251)][_0x5bd459(0x2d1)]+_0x5bd459(0x241));const _0x3e79bd={'status':_0x4c6393,'updatedAt':new Date(),'statusChangedBy':_0x5bd459(0x16f),'statusChangedAt':new Date()};_0x207aa8&&(_0x3e79bd[_0x5bd459(0x20a)]=_0x207aa8);_0x4c6393===_0x5bd459(0x175)&&_0xb65f82&&(_0x3e79bd[_0x5bd459(0x207)]=_0xb65f82);let _0x398e9f=0x0,_0x42cec2=_0xe68af4['shop'][_0x5bd459(0x2d1)];if(_0x4c6393===_0x5bd459(0x286)&&_0x4f49dd!==_0x5bd459(0x286)){_0x3e79bd['paidAt']=new Date();const _0x5bb704=await currencyService_1[_0x5bd459(0x19c)][_0x5bd459(0x2ee)](_0xe68af4['amount'],_0xe68af4['currency']);_0x3e79bd[_0x5bd459(0x2d3)]=_0x5bb704;let _0x275ffc=0x2d;const _0x76a335=await _0xb1eb5b[_0x5bd459(0x251)][_0x5bd459(0x2ab)]({'where':{'id':_0xe68af4[_0x5bd459(0x176)]},'select':{'gatewaySettings':!![]}});if(_0x76a335?.[_0x5bd459(0x1b6)])try{const _0x3e32c3=JSON[_0x5bd459(0x1e6)](_0x76a335['gatewaySettings']);for(const [_0x5793b9,_0x54b1ba]of Object[_0x5bd459(0x2d9)](_0x3e32c3)){if(_0x5793b9[_0x5bd459(0x238)]()===_0xe68af4['gateway'][_0x5bd459(0x238)]()){_0x275ffc=_0x54b1ba[_0x5bd459(0x271)]||0xa;break;}}}catch(_0x6ae9e7){console[_0x5bd459(0x33b)](_0x5bd459(0x246)+_0x3557e5+':',_0x6ae9e7);}let _0x4fb2cf;_0xe68af4['amountAfterGatewayCommissionUSDT']!==null&&_0xe68af4[_0x5bd459(0x2cd)]!==undefined?(_0x4fb2cf=_0xe68af4[_0x5bd459(0x2cd)],console[_0x5bd459(0x22c)](_0x5bd459(0x32c)+_0x4fb2cf[_0x5bd459(0x1ea)](0x6)+_0x5bd459(0x232)+_0x3557e5)):(_0x4fb2cf=_0x5bb704*(0x1-_0x275ffc/0x64),console[_0x5bd459(0x22c)](_0x5bd459(0x20c)+_0x3557e5+':\x20'+_0x275ffc+_0x5bd459(0x2cf)+_0x5bb704[_0x5bd459(0x1ea)](0x6)+_0x5bd459(0x241)),_0x3e79bd[_0x5bd459(0x2cd)]=_0x4fb2cf,_0x3e79bd[_0x5bd459(0x2b1)]=_0x275ffc),_0x398e9f=_0x4fb2cf,_0x42cec2+=_0x4fb2cf,console['log'](_0x5bd459(0x27d)+_0x3557e5+_0x5bd459(0x2d7)),console[_0x5bd459(0x22c)](_0x5bd459(0x214)+_0x5bb704[_0x5bd459(0x1ea)](0x6)+'\x20USDT'),console[_0x5bd459(0x22c)](_0x5bd459(0x297)+_0xe68af4[_0x5bd459(0x196)]+_0x5bd459(0x188)+_0x275ffc+'%'),console[_0x5bd459(0x22c)](_0x5bd459(0x186)+_0x4fb2cf[_0x5bd459(0x1ea)](0x6)+_0x5bd459(0x22d)+_0x275ffc+'%\x20commission)'),console['log'](_0x5bd459(0x19f)+_0x4fb2cf[_0x5bd459(0x1ea)](0x6)+_0x5bd459(0x241));}else{if(_0x4f49dd===_0x5bd459(0x286)&&_0x4c6393!==_0x5bd459(0x286)&&_0x4c6393!==_0x5bd459(0x175)){if(_0xe68af4[_0x5bd459(0x2d3)]){let _0xfef885=0x2d;const _0x3000ff=await _0xb1eb5b[_0x5bd459(0x251)]['findUnique']({'where':{'id':_0xe68af4['shopId']},'select':{'gatewaySettings':!![]}});if(_0x3000ff?.[_0x5bd459(0x1b6)])try{const _0xd76329=JSON[_0x5bd459(0x1e6)](_0x3000ff[_0x5bd459(0x1b6)]);for(const [_0x52446a,_0x5e13e6]of Object[_0x5bd459(0x2d9)](_0xd76329)){if(_0x52446a[_0x5bd459(0x238)]()===_0xe68af4[_0x5bd459(0x196)][_0x5bd459(0x238)]()){_0xfef885=_0x5e13e6[_0x5bd459(0x271)]||0xa;break;}}}catch(_0x33b021){console[_0x5bd459(0x33b)]('Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20'+_0x3557e5+':',_0x33b021);}const _0x160e2e=_0xe68af4[_0x5bd459(0x2d3)]*(0x1-_0xfef885/0x64);_0x398e9f=-_0x160e2e,_0x42cec2-=_0x160e2e,console[_0x5bd459(0x22c)](_0x5bd459(0x214)+_0xe68af4['amountUSDT'][_0x5bd459(0x1ea)](0x6)+_0x5bd459(0x241)),console[_0x5bd459(0x22c)](_0x5bd459(0x297)+_0xe68af4[_0x5bd459(0x196)]+_0x5bd459(0x188)+_0xfef885+'%'),console[_0x5bd459(0x22c)](_0x5bd459(0x21c)+_0x160e2e[_0x5bd459(0x1ea)](0x6)+_0x5bd459(0x22d)+_0xfef885+'%\x20commission)'),console[_0x5bd459(0x22c)](_0x5bd459(0x22f)+_0x160e2e[_0x5bd459(0x1ea)](0x6)+_0x5bd459(0x241));}}}_0x4c6393===_0x5bd459(0x175)&&(console[_0x5bd459(0x22c)](_0x5bd459(0x1fb)),_0xb65f82&&_0xb65f82>0x0?(_0x398e9f=-_0xb65f82,_0x42cec2-=_0xb65f82,console[_0x5bd459(0x22c)](_0x5bd459(0x2e1)+_0xb65f82[_0x5bd459(0x1ea)](0x6)+_0x5bd459(0x333)),console[_0x5bd459(0x22c)](_0x5bd459(0x177))):console[_0x5bd459(0x22c)](_0x5bd459(0x2c8)),_0x3e79bd[_0x5bd459(0x207)]=_0xb65f82||0x0);_0x4c6393===_0x5bd459(0x1f3)&&_0x4f49dd===_0x5bd459(0x286)&&console['log'](_0x5bd459(0x30b));const _0x322794=await _0xb1eb5b[_0x5bd459(0x18d)][_0x5bd459(0x24e)]({'where':{'id':_0x3557e5},'data':_0x3e79bd,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x398e9f!==0x0&&(await _0xb1eb5b[_0x5bd459(0x251)][_0x5bd459(0x24e)]({'where':{'id':_0xe68af4['shopId']},'data':{'balance':_0x42cec2}}),console[_0x5bd459(0x22c)](_0x5bd459(0x27e)+_0xe68af4['shopId']+_0x5bd459(0x1e3)+_0xe68af4[_0x5bd459(0x251)][_0x5bd459(0x2d1)]['toFixed'](0x6)+_0x5bd459(0x33c)+_0x42cec2[_0x5bd459(0x1ea)](0x6)+'\x20USDT\x20('+(_0x398e9f>0x0?'+':'')+_0x398e9f['toFixed'](0x6)+')')),_0x322794;});return{'id':_0x1e4509['id'],'shopId':_0x1e4509[_0x4cc61e(0x176)],'gateway':_0x1e4509[_0x4cc61e(0x196)],'amount':_0x1e4509[_0x4cc61e(0x322)],'currency':_0x1e4509[_0x4cc61e(0x340)],'status':_0x1e4509[_0x4cc61e(0x289)],'orderId':_0x1e4509[_0x4cc61e(0x335)],'gatewayOrderId':_0x1e4509[_0x4cc61e(0x254)],'customerEmail':_0x1e4509[_0x4cc61e(0x225)],'customerName':_0x1e4509['customerName'],'customerCountry':_0x1e4509[_0x4cc61e(0x2d8)],'customerIp':_0x1e4509[_0x4cc61e(0x244)],'customerUa':_0x1e4509[_0x4cc61e(0x1a9)],'failureMessage':_0x1e4509[_0x4cc61e(0x2bd)],'adminNotes':_0x1e4509[_0x4cc61e(0x20a)],'chargebackAmount':_0x1e4509[_0x4cc61e(0x207)],'statusChangedBy':_0x1e4509[_0x4cc61e(0x2a3)],'statusChangedAt':_0x1e4509[_0x4cc61e(0x30c)],'createdAt':_0x1e4509['createdAt'],'updatedAt':_0x1e4509[_0x4cc61e(0x312)],'shop':_0x1e4509[_0x4cc61e(0x251)]};}async[a50_0xedf481(0x211)](_0x30ff23,_0x40acf9){const _0x48dce5=a50_0xedf481,_0x436345=Math[_0x48dce5(0x202)]()['toString'](0x24)[_0x48dce5(0x24f)](0x2,0x9);console['log'](_0x48dce5(0x306)+_0x436345+_0x48dce5(0x19a)+_0x30ff23);const _0x2f3a5a={..._0x40acf9};_0x40acf9[_0x48dce5(0x287)]&&_0x40acf9[_0x48dce5(0x287)]['trim']()!==''?(console[_0x48dce5(0x22c)](_0x48dce5(0x2f7)+_0x436345+_0x48dce5(0x237)+_0x30ff23),_0x2f3a5a[_0x48dce5(0x287)]=await bcryptjs_1[_0x48dce5(0x2b8)][_0x48dce5(0x226)](_0x40acf9[_0x48dce5(0x287)],0xc)):(console[_0x48dce5(0x22c)](_0x48dce5(0x2f7)+_0x436345+_0x48dce5(0x248)),delete _0x2f3a5a[_0x48dce5(0x287)]);_0x40acf9[_0x48dce5(0x263)]&&(_0x2f3a5a[_0x48dce5(0x231)]=_0x40acf9['fullName'],delete _0x2f3a5a[_0x48dce5(0x263)]);_0x40acf9[_0x48dce5(0x1ce)]&&(_0x2f3a5a[_0x48dce5(0x330)]=_0x40acf9[_0x48dce5(0x1ce)],delete _0x2f3a5a['telegramId']);_0x40acf9[_0x48dce5(0x24c)]&&(_0x2f3a5a['shopUrl']=_0x40acf9[_0x48dce5(0x24c)],delete _0x2f3a5a['merchantUrl']);if(_0x40acf9[_0x48dce5(0x1f2)]){const _0x3e593f=_0x40acf9[_0x48dce5(0x1f2)][_0x48dce5(0x2c6)](_0x89b3ed=>this['getGatewayInternalName'](_0x89b3ed));console[_0x48dce5(0x22c)](_0x48dce5(0x220),_0x40acf9['gateways'],'->',_0x3e593f),_0x2f3a5a[_0x48dce5(0x293)]=JSON[_0x48dce5(0x247)](_0x3e593f),delete _0x2f3a5a['gateways'];}_0x40acf9[_0x48dce5(0x1b6)]&&(console['log'](_0x48dce5(0x25a)+_0x436345+_0x48dce5(0x317),_0x40acf9['gatewaySettings']),_0x2f3a5a[_0x48dce5(0x1b6)]=JSON[_0x48dce5(0x247)](_0x40acf9['gatewaySettings']),console[_0x48dce5(0x22c)](_0x48dce5(0x25a)+_0x436345+_0x48dce5(0x2ca),_0x2f3a5a[_0x48dce5(0x1b6)]));_0x40acf9[_0x48dce5(0x1ee)]&&(_0x40acf9[_0x48dce5(0x1ee)][_0x48dce5(0x219)]!==undefined&&(_0x2f3a5a[_0x48dce5(0x219)]=_0x40acf9['wallets'][_0x48dce5(0x219)]||null),_0x40acf9['wallets']['usdtTrcWallet']!==undefined&&(_0x2f3a5a[_0x48dce5(0x25c)]=_0x40acf9[_0x48dce5(0x1ee)][_0x48dce5(0x25c)]||null),_0x40acf9[_0x48dce5(0x1ee)][_0x48dce5(0x25b)]!==undefined&&(_0x2f3a5a['usdtErcWallet']=_0x40acf9[_0x48dce5(0x1ee)][_0x48dce5(0x25b)]||null),_0x40acf9[_0x48dce5(0x1ee)]['usdcPolygonWallet']!==undefined&&(_0x2f3a5a[_0x48dce5(0x295)]=_0x40acf9[_0x48dce5(0x1ee)][_0x48dce5(0x295)]||null),delete _0x2f3a5a[_0x48dce5(0x1ee)]);const _0x2db4ed=await database_1[_0x48dce5(0x2b8)][_0x48dce5(0x251)][_0x48dce5(0x24e)]({'where':{'id':_0x30ff23},'data':_0x2f3a5a,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0x48dce5(0x22c)]('ðŸŽ¯\x20['+_0x436345+_0x48dce5(0x28d),_0x2db4ed[_0x48dce5(0x1b6)]),{'id':_0x2db4ed['id'],'fullName':_0x2db4ed[_0x48dce5(0x231)],'username':_0x2db4ed[_0x48dce5(0x1d8)],'telegramId':_0x2db4ed['telegram'],'merchantUrl':_0x2db4ed[_0x48dce5(0x2fd)],'gateways':_0x2db4ed['paymentGateways']?JSON[_0x48dce5(0x1e6)](_0x2db4ed[_0x48dce5(0x293)]):null,'gatewaySettings':_0x2db4ed[_0x48dce5(0x1b6)]?JSON['parse'](_0x2db4ed[_0x48dce5(0x1b6)]):null,'publicKey':_0x2db4ed[_0x48dce5(0x32d)],'wallets':{'usdtPolygonWallet':_0x2db4ed[_0x48dce5(0x219)],'usdtTrcWallet':_0x2db4ed[_0x48dce5(0x25c)],'usdtErcWallet':_0x2db4ed['usdtErcWallet'],'usdcPolygonWallet':_0x2db4ed['usdcPolygonWallet']},'status':_0x2db4ed['status'],'createdAt':_0x2db4ed['createdAt']};}async['suspendUser'](_0x225970){const _0x204222=a50_0xedf481,_0xdceb05=await database_1[_0x204222(0x2b8)][_0x204222(0x251)][_0x204222(0x24e)]({'where':{'id':_0x225970},'data':{'status':'SUSPENDED'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0xdceb05['id'],'fullName':_0xdceb05[_0x204222(0x231)],'username':_0xdceb05[_0x204222(0x1d8)],'telegramId':_0xdceb05[_0x204222(0x330)],'merchantUrl':_0xdceb05['shopUrl'],'gateways':_0xdceb05[_0x204222(0x293)]?JSON[_0x204222(0x1e6)](_0xdceb05[_0x204222(0x293)]):null,'gatewaySettings':_0xdceb05[_0x204222(0x1b6)]?JSON[_0x204222(0x1e6)](_0xdceb05[_0x204222(0x1b6)]):null,'publicKey':_0xdceb05['publicKey'],'wallets':{'usdtPolygonWallet':_0xdceb05[_0x204222(0x219)],'usdtTrcWallet':_0xdceb05[_0x204222(0x25c)],'usdtErcWallet':_0xdceb05[_0x204222(0x25b)],'usdcPolygonWallet':_0xdceb05[_0x204222(0x295)]},'status':_0xdceb05[_0x204222(0x289)],'createdAt':_0xdceb05[_0x204222(0x27b)]};}async['activateUser'](_0x2896f4){const _0x461406=a50_0xedf481,_0x584be3=await database_1[_0x461406(0x2b8)][_0x461406(0x251)][_0x461406(0x24e)]({'where':{'id':_0x2896f4},'data':{'status':_0x461406(0x229)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x584be3['id'],'fullName':_0x584be3[_0x461406(0x231)],'username':_0x584be3[_0x461406(0x1d8)],'telegramId':_0x584be3[_0x461406(0x330)],'merchantUrl':_0x584be3[_0x461406(0x2fd)],'gateways':_0x584be3[_0x461406(0x293)]?JSON['parse'](_0x584be3[_0x461406(0x293)]):null,'gatewaySettings':_0x584be3[_0x461406(0x1b6)]?JSON[_0x461406(0x1e6)](_0x584be3[_0x461406(0x1b6)]):null,'publicKey':_0x584be3[_0x461406(0x32d)],'wallets':{'usdtPolygonWallet':_0x584be3[_0x461406(0x219)],'usdtTrcWallet':_0x584be3['usdtTrcWallet'],'usdtErcWallet':_0x584be3[_0x461406(0x25b)],'usdcPolygonWallet':_0x584be3['usdcPolygonWallet']},'status':_0x584be3[_0x461406(0x289)],'createdAt':_0x584be3[_0x461406(0x27b)]};}async['getAllUsers'](_0x4b596b){const _0x2758a1=a50_0xedf481,{page:_0x66816f,limit:_0x524d05,status:_0x10acae,search:_0x53a61d}=_0x4b596b,_0xc7469f=(_0x66816f-0x1)*_0x524d05,_0xd291f5={};_0x10acae&&(_0xd291f5[_0x2758a1(0x289)]=_0x10acae['toUpperCase']());_0x53a61d&&(_0xd291f5['OR']=[{'name':{'contains':_0x53a61d,'mode':_0x2758a1(0x2bc)}},{'username':{'contains':_0x53a61d,'mode':_0x2758a1(0x2bc)}},{'telegram':{'contains':_0x53a61d,'mode':_0x2758a1(0x2bc)}},{'shopUrl':{'contains':_0x53a61d,'mode':_0x2758a1(0x2bc)}}]);const [_0x9015ab,_0x225543]=await Promise['all']([database_1[_0x2758a1(0x2b8)][_0x2758a1(0x251)]['findMany']({'where':_0xd291f5,'skip':_0xc7469f,'take':_0x524d05,'orderBy':{'createdAt':_0x2758a1(0x298)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'twoFactorEnabled':!![],'createdAt':!![],'lastLoginAt':!![],'_count':{'select':{'telegramUsers':!![]}}}}),database_1[_0x2758a1(0x2b8)]['shop'][_0x2758a1(0x2ac)]({'where':_0xd291f5})]);return{'users':_0x9015ab['map'](_0x4cdb37=>{const _0x3d5b77=_0x2758a1,_0x51397a=_0x4cdb37[_0x3d5b77(0x293)]?JSON[_0x3d5b77(0x1e6)](_0x4cdb37[_0x3d5b77(0x293)]):null,_0x22b5d6=_0x51397a?_0x51397a[_0x3d5b77(0x2c6)](_0x5c59f9=>this['getGatewayDisplayName'](_0x5c59f9)):null;return{'id':_0x4cdb37['id'],'fullName':_0x4cdb37[_0x3d5b77(0x231)],'username':_0x4cdb37[_0x3d5b77(0x1d8)],'telegramId':_0x4cdb37[_0x3d5b77(0x330)],'merchantUrl':_0x4cdb37['shopUrl'],'gateways':_0x22b5d6,'gatewaySettings':_0x4cdb37[_0x3d5b77(0x1b6)]?JSON[_0x3d5b77(0x1e6)](_0x4cdb37[_0x3d5b77(0x1b6)]):null,'publicKey':_0x4cdb37['publicKey'],'wallets':{'usdtPolygonWallet':_0x4cdb37['usdtPolygonWallet'],'usdtTrcWallet':_0x4cdb37[_0x3d5b77(0x25c)],'usdtErcWallet':_0x4cdb37[_0x3d5b77(0x25b)],'usdcPolygonWallet':_0x4cdb37[_0x3d5b77(0x295)],'usdcErcWallet':_0x4cdb37[_0x3d5b77(0x181)]},'status':_0x4cdb37['status'],'twoFactorEnabled':_0x4cdb37[_0x3d5b77(0x224)]||![],'telegramUsersCount':_0x4cdb37[_0x3d5b77(0x1e8)]['telegramUsers'],'createdAt':_0x4cdb37[_0x3d5b77(0x27b)],'lastLoginAt':_0x4cdb37[_0x3d5b77(0x29c)]};}),'pagination':{'page':_0x66816f,'limit':_0x524d05,'total':_0x225543,'totalPages':Math[_0x2758a1(0x264)](_0x225543/_0x524d05)}};}async['getUserById'](_0x285af5){const _0x4c5f8=a50_0xedf481,_0x4f97ec=await database_1[_0x4c5f8(0x2b8)][_0x4c5f8(0x251)]['findUnique']({'where':{'id':_0x285af5},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x4f97ec)return null;const _0xe56514=_0x4f97ec[_0x4c5f8(0x293)]?JSON['parse'](_0x4f97ec[_0x4c5f8(0x293)]):null,_0xf4efa8=_0xe56514?_0xe56514[_0x4c5f8(0x2c6)](_0x5b167a=>this['getGatewayDisplayName'](_0x5b167a)):null;return _0xe56514&&_0xf4efa8&&console[_0x4c5f8(0x22c)](_0x4c5f8(0x17b),_0xe56514,'->',_0xf4efa8),{'id':_0x4f97ec['id'],'fullName':_0x4f97ec[_0x4c5f8(0x231)],'username':_0x4f97ec[_0x4c5f8(0x1d8)],'telegramId':_0x4f97ec['telegram'],'merchantUrl':_0x4f97ec[_0x4c5f8(0x2fd)],'gateways':_0xf4efa8,'gatewaySettings':_0x4f97ec[_0x4c5f8(0x1b6)]?JSON[_0x4c5f8(0x1e6)](_0x4f97ec[_0x4c5f8(0x1b6)]):null,'publicKey':_0x4f97ec[_0x4c5f8(0x32d)],'wallets':{'usdtPolygonWallet':_0x4f97ec['usdtPolygonWallet'],'usdtTrcWallet':_0x4f97ec[_0x4c5f8(0x25c)],'usdtErcWallet':_0x4f97ec['usdtErcWallet'],'usdcPolygonWallet':_0x4f97ec[_0x4c5f8(0x295)],'usdcErcWallet':_0x4f97ec['usdcErcWallet']},'status':_0x4f97ec[_0x4c5f8(0x289)],'createdAt':_0x4f97ec[_0x4c5f8(0x27b)]};}async[a50_0xedf481(0x1b3)](_0x9a4b3e){const _0x2530b2=a50_0xedf481,{fullName:_0x2f7177,username:_0x5c8a0a,password:_0x4aedfe,telegramId:_0xe9e990,merchantUrl:_0x36b783,gateways:_0x254221,gatewaySettings:_0x392e08,wallets:_0x4649d3}=_0x9a4b3e,_0x1064fd=await database_1[_0x2530b2(0x2b8)][_0x2530b2(0x251)][_0x2530b2(0x2ab)]({'where':{'username':_0x5c8a0a}});if(_0x1064fd)throw new Error('Username\x20already\x20exists');if(_0xe9e990){const _0x44b3c5=await database_1[_0x2530b2(0x2b8)]['shop']['findUnique']({'where':{'telegram':_0xe9e990}});if(_0x44b3c5)throw new Error(_0x2530b2(0x192));}const _0xac2166=await bcryptjs_1[_0x2530b2(0x2b8)][_0x2530b2(0x226)](_0x4aedfe,0xc),_0x4bb6da='pk_'+crypto_1[_0x2530b2(0x2b8)][_0x2530b2(0x183)](0x20)[_0x2530b2(0x2b3)]('hex'),_0x3f6b83=_0x2530b2(0x28a)+crypto_1[_0x2530b2(0x2b8)][_0x2530b2(0x183)](0x20)[_0x2530b2(0x2b3)]('hex'),_0x3e253a=_0x254221?_0x254221[_0x2530b2(0x2c6)](_0x10023=>this[_0x2530b2(0x180)](_0x10023)):null;_0x254221&&_0x3e253a&&console['log'](_0x2530b2(0x258),_0x254221,'->',_0x3e253a);const _0x5491b6=await database_1['default'][_0x2530b2(0x251)][_0x2530b2(0x19e)]({'data':{'name':_0x2f7177,'username':_0x5c8a0a,'password':_0xac2166,'telegram':_0xe9e990,'shopUrl':_0x36b783,'paymentGateways':_0x3e253a?JSON[_0x2530b2(0x247)](_0x3e253a):null,'gatewaySettings':_0x392e08?JSON[_0x2530b2(0x247)](_0x392e08):null,'usdtPolygonWallet':_0x4649d3?.['usdtPolygonWallet']||null,'usdtTrcWallet':_0x4649d3?.[_0x2530b2(0x25c)]||null,'usdtErcWallet':_0x4649d3?.[_0x2530b2(0x25b)]||null,'usdcPolygonWallet':_0x4649d3?.[_0x2530b2(0x295)]||null,'publicKey':_0x4bb6da,'secretKey':_0x3f6b83,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x5491b6['id'],'fullName':_0x5491b6[_0x2530b2(0x231)],'username':_0x5491b6[_0x2530b2(0x1d8)],'telegramId':_0x5491b6['telegram'],'merchantUrl':_0x5491b6[_0x2530b2(0x2fd)],'gateways':_0x5491b6[_0x2530b2(0x293)]?JSON[_0x2530b2(0x1e6)](_0x5491b6[_0x2530b2(0x293)]):null,'gatewaySettings':_0x5491b6[_0x2530b2(0x1b6)]?JSON[_0x2530b2(0x1e6)](_0x5491b6[_0x2530b2(0x1b6)]):null,'publicKey':_0x5491b6[_0x2530b2(0x32d)],'wallets':{'usdtPolygonWallet':_0x5491b6['usdtPolygonWallet'],'usdtTrcWallet':_0x5491b6[_0x2530b2(0x25c)],'usdtErcWallet':_0x5491b6[_0x2530b2(0x25b)],'usdcPolygonWallet':_0x5491b6[_0x2530b2(0x295)]},'status':_0x5491b6['status'],'createdAt':_0x5491b6['createdAt']};}async[a50_0xedf481(0x200)](_0xa42d0d,_0x46d25c){const _0x574c92=a50_0xedf481;if(config_1[_0x574c92(0x305)]['admin'][_0x574c92(0x224)]){if(!_0x46d25c)throw new Error(_0x574c92(0x1ba));const _0x5de246=speakeasy_1[_0x574c92(0x2b8)]['totp'][_0x574c92(0x1c5)]({'secret':config_1[_0x574c92(0x305)][_0x574c92(0x16f)][_0x574c92(0x18f)],'encoding':_0x574c92(0x2e8),'token':_0x46d25c,'window':0x2});if(!_0x5de246){let _0x5c1fbd=![];if(config_1['config'][_0x574c92(0x16f)][_0x574c92(0x31e)]){const _0x49c4a6=JSON['parse'](config_1['config'][_0x574c92(0x16f)][_0x574c92(0x31e)]);for(let _0x2d9430=0x0;_0x2d9430<_0x49c4a6[_0x574c92(0x1e5)];_0x2d9430++){const _0x4910be=await bcryptjs_1[_0x574c92(0x2b8)]['compare'](_0x46d25c,_0x49c4a6[_0x2d9430]);if(_0x4910be){_0x5c1fbd=!![],_0x49c4a6[_0x574c92(0x342)](_0x2d9430,0x1),config_1['config']['admin'][_0x574c92(0x31e)]=JSON[_0x574c92(0x247)](_0x49c4a6);const _0x48ab83=path_1[_0x574c92(0x2b8)]['join'](process[_0x574c92(0x281)](),_0x574c92(0x1f8));if(fs_1['default'][_0x574c92(0x204)](_0x48ab83)){let _0x20146c=fs_1[_0x574c92(0x2b8)][_0x574c92(0x1a0)](_0x48ab83,_0x574c92(0x261));const _0x40e125=_0x20146c['split']('\x0a');for(let _0x1957dc=0x0;_0x1957dc<_0x40e125[_0x574c92(0x1e5)];_0x1957dc++){if(_0x40e125[_0x1957dc][_0x574c92(0x2a4)]('ADMIN_BACKUP_CODES=')){_0x40e125[_0x1957dc]=_0x574c92(0x27a)+JSON[_0x574c92(0x247)](_0x49c4a6);break;}}fs_1[_0x574c92(0x2b8)]['writeFileSync'](_0x48ab83,_0x40e125[_0x574c92(0x194)]('\x0a'),_0x574c92(0x261));}break;}}}if(!_0x5c1fbd)throw new Error('Invalid\x202FA\x20token\x20or\x20backup\x20code');}}await database_1['default'][_0x574c92(0x251)]['delete']({'where':{'id':_0xa42d0d}});}async[a50_0xedf481(0x339)](_0x1496b3){const _0x44676a=a50_0xedf481,_0x4a4297=await database_1[_0x44676a(0x2b8)][_0x44676a(0x251)][_0x44676a(0x2ab)]({'where':{'id':_0x1496b3},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});if(!_0x4a4297)throw new Error(_0x44676a(0x185));return{'usdtPolygonWallet':_0x4a4297[_0x44676a(0x219)],'usdtTrcWallet':_0x4a4297['usdtTrcWallet'],'usdtErcWallet':_0x4a4297[_0x44676a(0x25b)],'usdcPolygonWallet':_0x4a4297['usdcPolygonWallet'],'usdcErcWallet':_0x4a4297[_0x44676a(0x181)]};}[a50_0xedf481(0x28f)](_0x151236=0x8){const _0x73c2ce=a50_0xedf481,_0x3fb73b=[];for(let _0x315bc7=0x0;_0x315bc7<_0x151236;_0x315bc7++){const _0x31fd00=crypto_1[_0x73c2ce(0x2b8)][_0x73c2ce(0x183)](0x4)[_0x73c2ce(0x2b3)](_0x73c2ce(0x203))['toUpperCase']();_0x3fb73b['push'](_0x31fd00);}return _0x3fb73b;}async[a50_0xedf481(0x210)](_0x126013){const _0x3b60a2=a50_0xedf481,_0x1754d5=await database_1[_0x3b60a2(0x2b8)]['shop'][_0x3b60a2(0x2ab)]({'where':{'id':_0x126013},'select':{'id':!![],'name':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x1754d5)throw new Error('Shop\x20not\x20found');const _0x2774c3=speakeasy_1[_0x3b60a2(0x2b8)]['generateSecret']({'name':'TrapaPay\x20('+_0x1754d5[_0x3b60a2(0x1d8)]+')','issuer':'TrapaPay','length':0x20}),_0x3cf848=await qrcode_1[_0x3b60a2(0x2b8)][_0x3b60a2(0x1d1)](_0x2774c3['otpauth_url']),_0x6ea53a=this[_0x3b60a2(0x28f)](0x8),_0x4dfbed=await Promise[_0x3b60a2(0x215)](_0x6ea53a[_0x3b60a2(0x2c6)](_0x197cff=>bcryptjs_1[_0x3b60a2(0x2b8)][_0x3b60a2(0x226)](_0x197cff,0xa)));return await database_1[_0x3b60a2(0x2b8)]['shop']['update']({'where':{'id':_0x126013},'data':{'twoFactorSecret':_0x2774c3[_0x3b60a2(0x2e8)],'backupCodes':JSON[_0x3b60a2(0x247)](_0x4dfbed)}}),console[_0x3b60a2(0x22c)](_0x3b60a2(0x2dc)+_0x1754d5['username']),console['log'](_0x3b60a2(0x1f1)+_0x6ea53a[_0x3b60a2(0x1e5)]+_0x3b60a2(0x2d4)),{'secret':_0x2774c3['base32'],'qrCode':_0x3cf848,'manualEntryKey':_0x2774c3['base32'],'backupCodes':_0x6ea53a};}async['enable2FA'](_0x57d416,_0x4bb1b4){const _0x5038c6=a50_0xedf481,_0xf09c6f=await database_1[_0x5038c6(0x2b8)][_0x5038c6(0x251)][_0x5038c6(0x2ab)]({'where':{'id':_0x57d416},'select':{'id':!![],'username':!![],'twoFactorSecret':!![],'twoFactorEnabled':!![]}});if(!_0xf09c6f)throw new Error(_0x5038c6(0x185));if(!_0xf09c6f[_0x5038c6(0x18f)])throw new Error('2FA\x20not\x20set\x20up.\x20Please\x20call\x20setup\x20endpoint\x20first');if(_0xf09c6f['twoFactorEnabled'])throw new Error(_0x5038c6(0x29a));const _0x427a14=speakeasy_1['default']['totp']['verify']({'secret':_0xf09c6f[_0x5038c6(0x18f)],'encoding':_0x5038c6(0x2e8),'token':_0x4bb1b4,'window':0x2});if(!_0x427a14)throw new Error(_0x5038c6(0x17d));return await database_1['default'][_0x5038c6(0x251)][_0x5038c6(0x24e)]({'where':{'id':_0x57d416},'data':{'twoFactorEnabled':!![]}}),console[_0x5038c6(0x22c)]('ðŸ”\x202FA\x20enabled\x20for\x20shop:\x20'+_0xf09c6f[_0x5038c6(0x1d8)]),{'enabled':!![]};}async['disable2FA'](_0x12690b){const _0x1c457a=a50_0xedf481,_0x5489c=await database_1[_0x1c457a(0x2b8)][_0x1c457a(0x251)]['findUnique']({'where':{'id':_0x12690b},'select':{'id':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x5489c)throw new Error('Shop\x20not\x20found');await database_1[_0x1c457a(0x2b8)][_0x1c457a(0x251)][_0x1c457a(0x24e)]({'where':{'id':_0x12690b},'data':{'twoFactorEnabled':![],'twoFactorSecret':null,'backupCodes':null}}),console[_0x1c457a(0x22c)](_0x1c457a(0x1dd)+_0x5489c[_0x1c457a(0x1d8)]);}async[a50_0xedf481(0x26e)](_0x1aabe2,_0x2b0255,_0x597df0,_0x18e083){const _0x518b91=a50_0xedf481;if(_0x2b0255!==_0x597df0)throw new Error(_0x518b91(0x2d2));if(_0x2b0255['length']<0x6)throw new Error(_0x518b91(0x2cc));const _0x38ed5f=await bcryptjs_1[_0x518b91(0x2b8)][_0x518b91(0x262)](_0x1aabe2,config_1['config']['admin'][_0x518b91(0x1a3)]);if(!_0x38ed5f)throw new Error('Current\x20password\x20is\x20incorrect');if(config_1[_0x518b91(0x305)][_0x518b91(0x16f)]['twoFactorEnabled']){if(!_0x18e083)throw new Error(_0x518b91(0x1ba));const _0x1c3663=speakeasy_1[_0x518b91(0x2b8)][_0x518b91(0x2e3)][_0x518b91(0x1c5)]({'secret':config_1[_0x518b91(0x305)][_0x518b91(0x16f)][_0x518b91(0x18f)],'encoding':_0x518b91(0x2e8),'token':_0x18e083,'window':0x2});if(!_0x1c3663){let _0x2bb3d1=![];if(config_1['config'][_0x518b91(0x16f)][_0x518b91(0x31e)]){const _0x30a2be=JSON[_0x518b91(0x1e6)](config_1[_0x518b91(0x305)][_0x518b91(0x16f)]['backupCodes']);for(let _0x3d06e7=0x0;_0x3d06e7<_0x30a2be['length'];_0x3d06e7++){const _0x1f4b67=await bcryptjs_1[_0x518b91(0x2b8)]['compare'](_0x18e083,_0x30a2be[_0x3d06e7]);if(_0x1f4b67){_0x2bb3d1=!![],_0x30a2be[_0x518b91(0x342)](_0x3d06e7,0x1),config_1['config']['admin'][_0x518b91(0x31e)]=JSON[_0x518b91(0x247)](_0x30a2be);const _0x4aae8e=path_1[_0x518b91(0x2b8)][_0x518b91(0x194)](process[_0x518b91(0x281)](),_0x518b91(0x1f8));if(fs_1['default']['existsSync'](_0x4aae8e)){let _0x3929cc=fs_1[_0x518b91(0x2b8)]['readFileSync'](_0x4aae8e,_0x518b91(0x261));const _0x245b9d=_0x3929cc[_0x518b91(0x2f6)]('\x0a');for(let _0x1bbfdd=0x0;_0x1bbfdd<_0x245b9d[_0x518b91(0x1e5)];_0x1bbfdd++){if(_0x245b9d[_0x1bbfdd][_0x518b91(0x2a4)](_0x518b91(0x27a))){_0x245b9d[_0x1bbfdd]='ADMIN_BACKUP_CODES='+JSON['stringify'](_0x30a2be);break;}}fs_1[_0x518b91(0x2b8)][_0x518b91(0x1f7)](_0x4aae8e,_0x245b9d[_0x518b91(0x194)]('\x0a'),_0x518b91(0x261));}break;}}}if(!_0x2bb3d1)throw new Error(_0x518b91(0x310));}}const _0x5262bf=await bcryptjs_1[_0x518b91(0x2b8)][_0x518b91(0x226)](_0x2b0255,0xc);config_1[_0x518b91(0x305)][_0x518b91(0x16f)]['passwordHash']=_0x5262bf;const _0x3378f5=path_1['default']['join'](process[_0x518b91(0x281)](),_0x518b91(0x1f8));let _0x3ffe62='';if(fs_1['default'][_0x518b91(0x204)](_0x3378f5)){_0x3ffe62=fs_1['default'][_0x518b91(0x1a0)](_0x3378f5,_0x518b91(0x261));const _0x4ebf96=_0x3ffe62['split']('\x0a');let _0x5de8f6=![];for(let _0x4c59fe=0x0;_0x4c59fe<_0x4ebf96[_0x518b91(0x1e5)];_0x4c59fe++){if(_0x4ebf96[_0x4c59fe][_0x518b91(0x2a4)](_0x518b91(0x1db))){_0x4ebf96[_0x4c59fe]='ADMIN_PASSWORD_HASH='+_0x5262bf,_0x5de8f6=!![];break;}}!_0x5de8f6&&_0x4ebf96[_0x518b91(0x341)]('ADMIN_PASSWORD_HASH='+_0x5262bf),_0x3ffe62=_0x4ebf96[_0x518b91(0x194)]('\x0a'),fs_1[_0x518b91(0x2b8)][_0x518b91(0x1f7)](_0x3378f5,_0x3ffe62,'utf8');}console[_0x518b91(0x22c)](_0x518b91(0x233));}async['get2FASettings'](){const _0x2526de=a50_0xedf481;let _0x3bc2db=0x0;if(config_1[_0x2526de(0x305)][_0x2526de(0x16f)][_0x2526de(0x31e)])try{const _0x24e53b=JSON[_0x2526de(0x1e6)](config_1[_0x2526de(0x305)][_0x2526de(0x16f)][_0x2526de(0x31e)]);_0x3bc2db=_0x24e53b[_0x2526de(0x1e5)];}catch(_0x5c974e){console[_0x2526de(0x33b)](_0x2526de(0x324),_0x5c974e);}return{'twoFactorEnabled':config_1[_0x2526de(0x305)][_0x2526de(0x16f)][_0x2526de(0x224)],'backupCodesCount':_0x3bc2db};}async[a50_0xedf481(0x2b6)](){const _0x29fc53=a50_0xedf481,_0x41b647=speakeasy_1[_0x29fc53(0x2b8)][_0x29fc53(0x2c1)]({'name':'TrapaPay\x20Admin\x20('+config_1[_0x29fc53(0x305)][_0x29fc53(0x16f)]['username']+')','issuer':_0x29fc53(0x1ae),'length':0x20}),_0x176e73=await qrcode_1['default'][_0x29fc53(0x1d1)](_0x41b647['otpauth_url']),_0x58be6a=[];for(let _0xf5ed2f=0x0;_0xf5ed2f<0x8;_0xf5ed2f++){const _0x3c0023=crypto_1[_0x29fc53(0x2b8)][_0x29fc53(0x183)](0x4)['toString']('hex')['toUpperCase']();_0x58be6a['push'](_0x3c0023);}const _0x484503=await Promise[_0x29fc53(0x215)](_0x58be6a[_0x29fc53(0x2c6)](_0x32d64f=>bcryptjs_1[_0x29fc53(0x2b8)][_0x29fc53(0x226)](_0x32d64f,0xa)));config_1[_0x29fc53(0x305)][_0x29fc53(0x16f)][_0x29fc53(0x18f)]=_0x41b647['base32'],config_1[_0x29fc53(0x305)]['admin']['backupCodes']=JSON[_0x29fc53(0x247)](_0x484503);const _0x299a84=path_1[_0x29fc53(0x2b8)][_0x29fc53(0x194)](process[_0x29fc53(0x281)](),_0x29fc53(0x1f8));if(fs_1[_0x29fc53(0x2b8)][_0x29fc53(0x204)](_0x299a84)){let _0x360182=fs_1[_0x29fc53(0x2b8)][_0x29fc53(0x1a0)](_0x299a84,_0x29fc53(0x261));const _0x5ad4b1=_0x360182[_0x29fc53(0x2f6)]('\x0a');let _0x4f8b25=![],_0x5ae901=![];for(let _0x58e01e=0x0;_0x58e01e<_0x5ad4b1[_0x29fc53(0x1e5)];_0x58e01e++){_0x5ad4b1[_0x58e01e][_0x29fc53(0x2a4)](_0x29fc53(0x2ec))&&(_0x5ad4b1[_0x58e01e]=_0x29fc53(0x2ec)+_0x41b647[_0x29fc53(0x2e8)],_0x4f8b25=!![]),_0x5ad4b1[_0x58e01e][_0x29fc53(0x2a4)](_0x29fc53(0x27a))&&(_0x5ad4b1[_0x58e01e]=_0x29fc53(0x27a)+JSON[_0x29fc53(0x247)](_0x484503),_0x5ae901=!![]);}if(!_0x4f8b25)_0x5ad4b1['push']('ADMIN_2FA_SECRET='+_0x41b647['base32']);if(!_0x5ae901)_0x5ad4b1[_0x29fc53(0x341)](_0x29fc53(0x27a)+JSON[_0x29fc53(0x247)](_0x484503));fs_1[_0x29fc53(0x2b8)][_0x29fc53(0x1f7)](_0x299a84,_0x5ad4b1['join']('\x0a'),_0x29fc53(0x261));}return console[_0x29fc53(0x22c)](_0x29fc53(0x255)),console['log'](_0x29fc53(0x1f1)+_0x58be6a[_0x29fc53(0x1e5)]+_0x29fc53(0x2d4)),{'secret':_0x41b647['base32'],'qrCode':_0x176e73,'manualEntryKey':_0x41b647[_0x29fc53(0x2e8)],'backupCodes':_0x58be6a};}async[a50_0xedf481(0x331)](_0x1acd73){const _0x591c80=a50_0xedf481;if(!config_1[_0x591c80(0x305)][_0x591c80(0x16f)]['twoFactorSecret'])throw new Error(_0x591c80(0x1ac));if(config_1[_0x591c80(0x305)][_0x591c80(0x16f)]['twoFactorEnabled'])throw new Error(_0x591c80(0x29a));const _0x2f72d5=speakeasy_1[_0x591c80(0x2b8)][_0x591c80(0x2e3)][_0x591c80(0x1c5)]({'secret':config_1['config'][_0x591c80(0x16f)][_0x591c80(0x18f)],'encoding':_0x591c80(0x2e8),'token':_0x1acd73,'window':0x2});if(!_0x2f72d5)throw new Error(_0x591c80(0x17d));config_1[_0x591c80(0x305)][_0x591c80(0x16f)][_0x591c80(0x224)]=!![];const _0x1bc877=path_1[_0x591c80(0x2b8)][_0x591c80(0x194)](process['cwd'](),_0x591c80(0x1f8));if(fs_1[_0x591c80(0x2b8)]['existsSync'](_0x1bc877)){let _0x3e21b7=fs_1[_0x591c80(0x2b8)][_0x591c80(0x1a0)](_0x1bc877,'utf8');const _0x4748fa=_0x3e21b7[_0x591c80(0x2f6)]('\x0a');let _0x506c96=![];for(let _0x221289=0x0;_0x221289<_0x4748fa['length'];_0x221289++){if(_0x4748fa[_0x221289][_0x591c80(0x2a4)](_0x591c80(0x292))){_0x4748fa[_0x221289]=_0x591c80(0x2c3),_0x506c96=!![];break;}}if(!_0x506c96)_0x4748fa[_0x591c80(0x341)](_0x591c80(0x2c3));fs_1['default']['writeFileSync'](_0x1bc877,_0x4748fa['join']('\x0a'),_0x591c80(0x261));}return console['log'](_0x591c80(0x26b)),{'enabled':!![]};}async[a50_0xedf481(0x265)](){const _0x39ed03=a50_0xedf481;config_1[_0x39ed03(0x305)][_0x39ed03(0x16f)][_0x39ed03(0x224)]=![],config_1[_0x39ed03(0x305)]['admin']['twoFactorSecret']='',config_1[_0x39ed03(0x305)]['admin']['backupCodes']='';const _0x4ec31f=path_1[_0x39ed03(0x2b8)]['join'](process[_0x39ed03(0x281)](),_0x39ed03(0x1f8));if(fs_1[_0x39ed03(0x2b8)]['existsSync'](_0x4ec31f)){let _0x471989=fs_1[_0x39ed03(0x2b8)][_0x39ed03(0x1a0)](_0x4ec31f,_0x39ed03(0x261));const _0xebdba3=_0x471989['split']('\x0a');for(let _0x22d8cb=0x0;_0x22d8cb<_0xebdba3['length'];_0x22d8cb++){_0xebdba3[_0x22d8cb][_0x39ed03(0x2a4)](_0x39ed03(0x292))&&(_0xebdba3[_0x22d8cb]=_0x39ed03(0x30d)),_0xebdba3[_0x22d8cb]['startsWith'](_0x39ed03(0x2ec))&&(_0xebdba3[_0x22d8cb]=_0x39ed03(0x2ec)),_0xebdba3[_0x22d8cb]['startsWith']('ADMIN_BACKUP_CODES=')&&(_0xebdba3[_0x22d8cb]=_0x39ed03(0x27a));}fs_1[_0x39ed03(0x2b8)][_0x39ed03(0x1f7)](_0x4ec31f,_0xebdba3['join']('\x0a'),'utf8');}console['log'](_0x39ed03(0x27f));}[a50_0xedf481(0x2fc)](_0x37d592,_0x5809be,_0x367089){const _0x185fc9=a50_0xedf481,_0x46a3ed=new Map(),_0x1a59dc=new Date(_0x5809be);while(_0x1a59dc<=_0x367089){const _0x4ea95d=_0x1a59dc[_0x185fc9(0x26c)]()[_0x185fc9(0x2f6)]('T')[0x0];_0x46a3ed[_0x185fc9(0x21b)](_0x4ea95d,{'revenue':0x0,'count':0x0}),_0x1a59dc['setDate'](_0x1a59dc[_0x185fc9(0x2a7)]()+0x1);}for(const _0xabf9a6 of _0x37d592){const _0x82a429=_0xabf9a6[_0x185fc9(0x27b)][_0x185fc9(0x26c)]()[_0x185fc9(0x2f6)]('T')[0x0],_0x320bcd=_0x46a3ed['get'](_0x82a429);_0x320bcd&&(_0x320bcd[_0x185fc9(0x2ac)]+=0x1,_0xabf9a6[_0x185fc9(0x289)]===_0x185fc9(0x286)&&(_0xabf9a6[_0x185fc9(0x2d3)]?_0x320bcd[_0x185fc9(0x197)]+=_0xabf9a6[_0x185fc9(0x2d3)]:console[_0x185fc9(0x22c)](_0x185fc9(0x17c)+_0xabf9a6['id']+_0x185fc9(0x1b4))));}const _0x517a17=[],_0x1a06f0=[];for(const [_0x4e4fdf,_0x4b2cd0]of _0x46a3ed){_0x517a17[_0x185fc9(0x341)]({'date':_0x4e4fdf,'amount':Math[_0x185fc9(0x2b0)](_0x4b2cd0[_0x185fc9(0x197)]*0x64)/0x64}),_0x1a06f0[_0x185fc9(0x341)]({'date':_0x4e4fdf,'count':_0x4b2cd0[_0x185fc9(0x2ac)]});}return{'dailyRevenue':_0x517a17,'dailyPayments':_0x1a06f0};}async[a50_0xedf481(0x1a7)](_0x5932c7){const _0x3ffec8=a50_0xedf481;console[_0x3ffec8(0x22c)](_0x3ffec8(0x206),_0x5932c7);const _0x18da93=new Date(_0x5932c7[_0x3ffec8(0x257)]),_0x25ab1d=new Date(_0x5932c7[_0x3ffec8(0x201)]),_0x18973c=new Date(Date['UTC'](_0x18da93[_0x3ffec8(0x323)](),_0x18da93[_0x3ffec8(0x1ab)](),_0x18da93[_0x3ffec8(0x1bd)](),0x0,0x0,0x0,0x0)),_0x403bbb=new Date(Date[_0x3ffec8(0x249)](_0x25ab1d['getUTCFullYear'](),_0x25ab1d[_0x3ffec8(0x1ab)](),_0x25ab1d['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));console[_0x3ffec8(0x22c)](_0x3ffec8(0x240)+_0x18973c[_0x3ffec8(0x26c)]()+_0x3ffec8(0x1bb)+_0x403bbb[_0x3ffec8(0x26c)]()),console['log'](_0x3ffec8(0x278)+_0x5932c7['gateway']);const _0x3392c9=await database_1[_0x3ffec8(0x2b8)]['payment'][_0x3ffec8(0x239)]({'where':{'status':_0x3ffec8(0x286),'gateway':_0x5932c7[_0x3ffec8(0x196)][_0x3ffec8(0x238)](),'createdAt':{'gte':_0x18973c,'lte':_0x403bbb}},'select':{'id':!![],'shopId':!![],'amountAfterGatewayCommissionUSDT':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console[_0x3ffec8(0x22c)](_0x3ffec8(0x25f)+_0x3392c9[_0x3ffec8(0x1e5)]+_0x3ffec8(0x2ed)+_0x5932c7[_0x3ffec8(0x196)]);const _0x2f18fb=new Map();for(const _0x39daa9 of _0x3392c9){const _0x3d0ccf=_0x39daa9['amountAfterGatewayCommissionUSDT']||0x0;if(_0x3d0ccf<=0x0){console[_0x3ffec8(0x1e9)](_0x3ffec8(0x17c)+_0x39daa9['id']+_0x3ffec8(0x273));continue;}if(_0x2f18fb[_0x3ffec8(0x2da)](_0x39daa9['shopId'])){const _0x2a86b4=_0x2f18fb[_0x3ffec8(0x22e)](_0x39daa9[_0x3ffec8(0x176)]);_0x2a86b4[_0x3ffec8(0x337)]+=_0x3d0ccf;}else _0x2f18fb[_0x3ffec8(0x21b)](_0x39daa9[_0x3ffec8(0x176)],{'merchantId':_0x39daa9[_0x3ffec8(0x251)]['id'],'merchantName':_0x39daa9[_0x3ffec8(0x251)][_0x3ffec8(0x231)],'merchantUsername':_0x39daa9['shop']['username'],'totalAmount':_0x3d0ccf});}const _0xe48a0d=Array[_0x3ffec8(0x1d6)](_0x2f18fb[_0x3ffec8(0x279)]())[_0x3ffec8(0x2c6)](_0x111a85=>({'merchantId':_0x111a85[_0x3ffec8(0x33e)],'merchantName':_0x111a85['merchantName'],'merchantUsername':_0x111a85[_0x3ffec8(0x28e)],'gateway':_0x5932c7[_0x3ffec8(0x196)],'periodFrom':_0x5932c7[_0x3ffec8(0x257)],'periodTo':_0x5932c7[_0x3ffec8(0x201)],'totalAmount':Math[_0x3ffec8(0x2b0)](_0x111a85[_0x3ffec8(0x337)]*0x64)/0x64}));return _0xe48a0d[_0x3ffec8(0x2aa)]((_0x50bd14,_0x5dca6a)=>_0x5dca6a['totalAmount']-_0x50bd14[_0x3ffec8(0x337)]),console[_0x3ffec8(0x22c)]('ðŸ“Š\x20Generated\x20reports\x20for\x20'+_0xe48a0d[_0x3ffec8(0x1e5)]+_0x3ffec8(0x256)),_0xe48a0d;}async[a50_0xedf481(0x26d)](_0xca41b9,_0x5630d5,_0x3fc839){const _0x255a15=a50_0xedf481,_0x2cd490=await database_1[_0x255a15(0x2b8)][_0x255a15(0x251)][_0x255a15(0x2ab)]({'where':{'id':_0xca41b9}});if(!_0x2cd490)throw new Error(_0x255a15(0x2fe));await database_1[_0x255a15(0x2b8)][_0x255a15(0x195)](async _0x14d971=>{const _0x12a760=_0x255a15;await _0x14d971['payment'][_0x12a760(0x19e)]({'data':{'shopId':_0x2cd490['id'],'amount':_0x5630d5,'amountUSDT':_0x5630d5,'amountAfterGatewayCommissionUSDT':_0x5630d5,'sourceCurrency':_0x12a760(0x266),'currency':_0x12a760(0x266),'status':_0x12a760(0x286),'gateway':'Deposit','customerName':_0x2cd490[_0x12a760(0x1d8)],'customerEmail':'@'+_0x2cd490['telegram'],'paymentMethod':_0x12a760(0x1e4),'adminNotes':_0x3fc839||null,'successUrl':'-','failUrl':'-','paidAt':new Date()}}),await _0x14d971[_0x12a760(0x251)][_0x12a760(0x24e)]({'where':{'id':_0x2cd490['id']},'data':{'balance':{'increment':_0x5630d5}}});}),console[_0x255a15(0x22c)]('âœ…\x20Deposited\x20'+_0x5630d5+_0x255a15(0x1dc)+_0x2cd490[_0x255a15(0x1d8)]);}}exports[a50_0xedf481(0x1c2)]=AdminService;