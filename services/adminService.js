'use strict';function a35_0x3b2e(_0x1f7170,_0x3704a3){const _0x3ce912=a35_0x3ce9();return a35_0x3b2e=function(_0x3b2e8d,_0x2bff0f){_0x3b2e8d=_0x3b2e8d-0x64;let _0x372248=_0x3ce912[_0x3b2e8d];return _0x372248;},a35_0x3b2e(_0x1f7170,_0x3704a3);}function a35_0x3ce9(){const _0x224b4b=['toFixed','not\x20set','merchantUrl','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','findFirst','\x20merchants\x20with\x20positive\x20balance','stringify','paymentsCount','createPayout','updatedAt','amount','getAllPayouts','customerName','parse','update','💰\x20Found\x20','21roPeSI','\x20USDT\x20from\x20balance','createUser','toISOString','customerUa','dateTo','randomBytes','getPayoutById','gatewayEarnings','AdminService','1179942FzCBVE','\x20\x20\x20📊\x20Total\x20payments:\x20','createdAt','getFullYear','year','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','\x20USDT\x20(same\x20as\x20awaiting)','thisMonth','REFUND','week','txid','gateways','\x20\x20\x20💰\x20Total\x20payout:\x20','amountUSDT','crypto','\x20USDT\x20total','notes','./currencyService','turnoverUSDT','map','name','username','statusChangedBy','split','ceil','CoinToPay','💰\x20Current\x20shop\x20balance:\x20','updatePaymentStatus','orderId','set','2424696SAcwBM','lte','Insufficient\x20balance.\x20Available:\x20','localeCompare','averageCheckUSDT','usdtTrcWallet','network','values','Username\x20already\x20exists','status','sk_','totalCommissionRate','customerEmail','💸\x20CHARGEBACK\x20penalty:\x20-','customerIp','CHARGEBACK','\x20\x20\x20Current\x20balance:\x20','\x20\x20\x20🌐\x20IP:\x20','password','14676540oBdkWz','Error\x20processing\x20payment\x20','failUrl','customerCountry','\x20\x20\x20Balance:\x20','Rapyd','failureMessage','❌\x20Failed\x20to\x20send\x20Telegram\x20notification\x20for\x20payout\x20','\x20->\x20','📊\x20Payout\x20statistics\x20calculated:','length','toUpperCase','activateUser','forEach','awaitingPayout','\x20USDT)','month','totalPaidOut','\x20\x20\x20Payout\x20amount:\x20','30d','telegram','deletePayout','\x20balance\x20updated:\x20','\x20no\x20longer\x20PAID:\x20-','Shop\x20not\x20found','\x20\x20\x20🌍\x20Country:\x20','defineProperty','\x20merchants,\x20','KLYME\x20GB','all','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','totalTurnover','./telegramBotService','57cvOtUD','KLYME\x20EU','Test\x20Gateway','round','usdtPolygonWallet','getSystemStatistics','findUnique','90d','chargebackAmount','gte','💰\x20Creating\x20payout\x20for\x20shop\x20','publicKey','$transaction','ACTIVE','shop','💰\x20Payment\x20','default','\x20USDT\x20(-','averageCommissionRate','\x20USDT,\x20Requested:\x20','gatewayOrderId','📊\x20Merchants\x20awaiting\x20payout:\x20','fullName','\x20USDT','balance','usdtErcWallet','test_gateway','paymentGateways','bcryptjs','13276HUYnuM','payment','\x20USDT\x20to\x20balance','turnover','merchantEarnings','\x20USDT\x20(+','commission','period','successUrl','convertToUSDT','suspendUser','SUSPENDED','desc','getMerchantStatistics','reduce','periodFrom','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','shopUrl','toString','date','\x20USDT\x20(total\x20merchant\x20balances)','💰\x20Shop\x20','updateCustomerData','wallets','\x20status:\x20','hex','81TZLcvK','statusChangedAt','adminNotes','\x20\x20\x20📅\x20This\x20month:\x20','__esModule','externalPaymentUrl','getPaymentById','25958tDvMAe','COMPLETED','count','log','📊\x20Merchant\x20statistics\x20calculated:','usdcPolygonWallet','totalPayout','\x20became\x20PAID:\x20+','1125168JayiKE','PAID','error','\x20\x20\x20💰\x20Total\x20turnover:\x20','11zMLcqa','paidAt','availableBalance','shopId','pk_','Plisio','Telegram\x20username\x20already\x20exists','gatewaySettings','Payment\x20not\x20found','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','merchantEarningsUSDT','_count','aggregate','delete','currencyService','pendingUrl','hash','\x20\x20\x20Total\x20paid\x20out:\x20','getUserById','findMany','dateFrom','commissionUSDT','payout','telegramId','KLYME\x20DE','Noda','560wncPEm','getMonth','getTime','string','gateway','deleteUser','currency','_sum','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','📱\x20Telegram\x20notification\x20sent\x20for\x20payout\x20','create','getMerchantsAwaitingPayout','2020-01-01','1585930WKiJxj','insensitive','📊\x20Calculating\x20payout\x20statistics...','periodTo','\x20for\x20shop\x20','\x20USDT\x20('];a35_0x3ce9=function(){return _0x224b4b;};return a35_0x3ce9();}const a35_0x50c9ca=a35_0x3b2e;(function(_0x1803b1,_0x48a241){const _0x210673=a35_0x3b2e,_0x38e461=_0x1803b1();while(!![]){try{const _0x13ec21=-parseInt(_0x210673(0x114))/0x1*(parseInt(_0x210673(0x6f))/0x2)+parseInt(_0x210673(0xc2))/0x3+-parseInt(_0x210673(0x131))/0x4*(parseInt(_0x210673(0x95))/0x5)+-parseInt(_0x210673(0xe0))/0x6*(parseInt(_0x210673(0xb8))/0x7)+-parseInt(_0x210673(0x77))/0x8*(-parseInt(_0x210673(0x68))/0x9)+parseInt(_0x210673(0xa2))/0xa+parseInt(_0x210673(0x7b))/0xb*(parseInt(_0x210673(0xf3))/0xc);if(_0x13ec21===_0x48a241)break;else _0x38e461['push'](_0x38e461['shift']());}catch(_0x44c26e){_0x38e461['push'](_0x38e461['shift']());}}}(a35_0x3ce9,0xaf057));var __importDefault=this&&this['__importDefault']||function(_0x441c5d){const _0x1c3f5f=a35_0x3b2e;return _0x441c5d&&_0x441c5d[_0x1c3f5f(0x6c)]?_0x441c5d:{'default':_0x441c5d};};Object[a35_0x50c9ca(0x10d)](exports,'__esModule',{'value':!![]}),exports[a35_0x50c9ca(0xc1)]=void 0x0;const database_1=__importDefault(require('../config/database')),bcryptjs_1=__importDefault(require(a35_0x50c9ca(0x130))),crypto_1=__importDefault(require(a35_0x50c9ca(0xd0))),currencyService_1=require(a35_0x50c9ca(0xd3)),telegramBotService_1=require(a35_0x50c9ca(0x113));class AdminService{async['getPayoutStats'](){const _0x3edc7a=a35_0x50c9ca;console[_0x3edc7a(0x72)](_0x3edc7a(0xa4));const _0x2ce0e9=await database_1[_0x3edc7a(0x124)][_0x3edc7a(0x122)][_0x3edc7a(0x87)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':'ACTIVE'}}),_0xe5caf6=new Date(),_0x5db7a0=new Date(_0xe5caf6[_0x3edc7a(0xc5)](),_0xe5caf6[_0x3edc7a(0x96)](),0x1),_0x2428a2=new Date(_0xe5caf6[_0x3edc7a(0xc5)](),_0xe5caf6[_0x3edc7a(0x96)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x1b2241=await database_1['default']['payout'][_0x3edc7a(0x87)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x5db7a0,'lte':_0x2428a2},'status':_0x3edc7a(0x70)}}),_0x2cf31e=_0x2ce0e9[_0x3edc7a(0x9c)][_0x3edc7a(0x104)]||0x0,_0x12e2e6=_0x2ce0e9[_0x3edc7a(0x9c)][_0x3edc7a(0x12c)]||0x0,_0x12460a=_0x1b2241[_0x3edc7a(0x9c)]['amount']||0x0,_0x450b62={'totalPayout':Math[_0x3edc7a(0x117)](_0x2cf31e*0x64)/0x64,'awaitingPayout':Math[_0x3edc7a(0x117)](_0x12e2e6*0x64)/0x64,'thisMonth':Math[_0x3edc7a(0x117)](_0x12460a*0x64)/0x64,'availableBalance':Math[_0x3edc7a(0x117)](_0x12e2e6*0x64)/0x64};return console[_0x3edc7a(0x72)](_0x3edc7a(0xfc)),console[_0x3edc7a(0x72)](_0x3edc7a(0xce)+_0x450b62[_0x3edc7a(0x75)]+'\x20USDT\x20(total\x20paid\x20to\x20merchants)'),console['log']('\x20\x20\x20⏳\x20Awaiting\x20payout:\x20'+_0x450b62[_0x3edc7a(0x101)]+_0x3edc7a(0x145)),console[_0x3edc7a(0x72)]('\x20\x20\x20💵\x20Available\x20balance:\x20'+_0x450b62[_0x3edc7a(0x7d)]+_0x3edc7a(0xc8)),console[_0x3edc7a(0x72)](_0x3edc7a(0x6b)+_0x450b62[_0x3edc7a(0xc9)]+_0x3edc7a(0x12b)),_0x450b62;}async[a35_0x50c9ca(0x64)](_0x4cd6d6,_0x2fae0b){const _0x2cad70=a35_0x50c9ca;console[_0x2cad70(0x72)](_0x2cad70(0x111)+_0x4cd6d6+':',_0x2fae0b);const _0x509c30=await database_1[_0x2cad70(0x124)][_0x2cad70(0x132)][_0x2cad70(0x11a)]({'where':{'id':_0x4cd6d6},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x509c30)throw new Error('Payment\x20not\x20found');const _0x1acde6={};_0x2fae0b[_0x2cad70(0xf6)]!==undefined&&(_0x1acde6[_0x2cad70(0xf6)]=_0x2fae0b[_0x2cad70(0xf6)]||null);_0x2fae0b[_0x2cad70(0xee)]!==undefined&&(_0x1acde6['customerIp']=_0x2fae0b[_0x2cad70(0xee)]||null);_0x2fae0b[_0x2cad70(0xbc)]!==undefined&&(_0x1acde6[_0x2cad70(0xbc)]=_0x2fae0b[_0x2cad70(0xbc)]||null);const _0x5f715c=await database_1[_0x2cad70(0x124)][_0x2cad70(0x132)]['update']({'where':{'id':_0x4cd6d6},'data':{..._0x1acde6,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x2cad70(0x72)](_0x2cad70(0x141)+_0x4cd6d6),console[_0x2cad70(0x72)](_0x2cad70(0x10c)+_0x509c30['customerCountry']+'\x20->\x20'+_0x5f715c[_0x2cad70(0xf6)]),console[_0x2cad70(0x72)](_0x2cad70(0xf1)+_0x509c30[_0x2cad70(0xee)]+_0x2cad70(0xfb)+_0x5f715c['customerIp']),console[_0x2cad70(0x72)]('\x20\x20\x20🖥️\x20User\x20Agent:\x20'+(_0x509c30['customerUa']?_0x2cad70(0xdf):_0x2cad70(0xa9))+'\x20->\x20'+(_0x5f715c[_0x2cad70(0xbc)]?_0x2cad70(0xdf):_0x2cad70(0xa9))),_0x5f715c;}async[a35_0x50c9ca(0x119)](_0x7fd93d){const _0x5817c2=a35_0x50c9ca,_0x1bc514=new Date();let _0x346098;switch(_0x7fd93d){case'7d':_0x346098=new Date(_0x1bc514[_0x5817c2(0x97)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x5817c2(0x106):_0x346098=new Date(_0x1bc514[_0x5817c2(0x97)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x5817c2(0x11b):_0x346098=new Date(_0x1bc514[_0x5817c2(0x97)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x346098=new Date(_0x1bc514[_0x5817c2(0x97)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x33eaea,_0xfe38cd,_0x55ddcc,_0x2db6c9,_0x449ea0,_0x4e8d82]=await Promise[_0x5817c2(0x110)]([database_1[_0x5817c2(0x124)][_0x5817c2(0x122)][_0x5817c2(0x71)](),database_1['default'][_0x5817c2(0x122)][_0x5817c2(0x71)]({'where':{'status':_0x5817c2(0x121)}}),database_1[_0x5817c2(0x124)][_0x5817c2(0x132)][_0x5817c2(0x71)]({'where':{'createdAt':{'gte':_0x346098},'gateway':{'not':'test_gateway'}}}),database_1[_0x5817c2(0x124)]['payment']['count']({'where':{'status':_0x5817c2(0x78),'createdAt':{'gte':_0x346098},'gateway':{'not':'test_gateway'}}}),database_1['default'][_0x5817c2(0x132)][_0x5817c2(0x8e)]({'where':{'status':_0x5817c2(0x78),'createdAt':{'gte':_0x346098},'gateway':{'not':_0x5817c2(0x12e)}},'select':{'amount':!![],'currency':!![]}}),database_1['default'][_0x5817c2(0x132)][_0x5817c2(0x8e)]({'where':{'gateway':{'not':_0x5817c2(0x12e)}},'take':0xa,'orderBy':{'createdAt':_0x5817c2(0x13d)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}})]);let _0x51b881=0x0;for(const _0x598660 of _0x449ea0){const _0x48023e=await currencyService_1[_0x5817c2(0x89)][_0x5817c2(0x13a)](_0x598660[_0x5817c2(0xb2)],_0x598660['currency']);_0x51b881+=_0x48023e;}const _0x563414=_0x55ddcc>0x0?_0x2db6c9/_0x55ddcc*0x64:0x0;return{'totalShops':_0x33eaea,'activeShops':_0xfe38cd,'totalPayments':_0x55ddcc,'successfulPayments':_0x2db6c9,'totalRevenue':Math['round'](_0x51b881*0x64)/0x64,'conversionRate':Math['round'](_0x563414*0x64)/0x64,'recentPayments':_0x4e8d82[_0x5817c2(0xd5)](_0x4801ab=>({'id':_0x4801ab['id'],'amount':_0x4801ab[_0x5817c2(0xb2)],'currency':_0x4801ab[_0x5817c2(0x9b)],'status':_0x4801ab[_0x5817c2(0xe9)],'gateway':_0x4801ab[_0x5817c2(0x99)],'shop':_0x4801ab[_0x5817c2(0x122)],'createdAt':_0x4801ab[_0x5817c2(0xc4)]}))};}async[a35_0x50c9ca(0x13e)](_0x531c1a){const _0x2ea962=a35_0x50c9ca;console['log'](_0x2ea962(0x9d),_0x531c1a);let _0x1698ea,_0xb3fded=new Date();if(_0x531c1a[_0x2ea962(0x138)]==='custom'&&_0x531c1a[_0x2ea962(0x8f)]&&_0x531c1a[_0x2ea962(0xbd)])_0x1698ea=new Date(_0x531c1a[_0x2ea962(0x8f)]),_0xb3fded=new Date(_0x531c1a[_0x2ea962(0xbd)]);else{const _0xba6f4f=new Date();switch(_0x531c1a[_0x2ea962(0x138)]){case _0x2ea962(0xcb):_0x1698ea=new Date(_0xba6f4f['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x2ea962(0x103):_0x1698ea=new Date(_0xba6f4f[_0x2ea962(0x97)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x2ea962(0xc6):_0x1698ea=new Date(_0xba6f4f[_0x2ea962(0x97)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x2ea962(0x110):default:_0x1698ea=new Date(_0x2ea962(0xa1));break;}}console[_0x2ea962(0x72)]('📅\x20Period:\x20'+_0x1698ea['toISOString']()+'\x20to\x20'+_0xb3fded[_0x2ea962(0xbb)]());const _0x30a21a={'status':_0x2ea962(0x78),'gateway':{'not':'test_gateway'},'paidAt':{'gte':_0x1698ea,'lte':_0xb3fded}};_0x531c1a[_0x2ea962(0x7e)]&&(_0x30a21a[_0x2ea962(0x7e)]=_0x531c1a[_0x2ea962(0x7e)]);const _0x3a2943=await database_1[_0x2ea962(0x124)][_0x2ea962(0x132)]['findMany']({'where':_0x30a21a,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x2ea962(0x72)](_0x2ea962(0xb7)+_0x3a2943[_0x2ea962(0xfd)]+'\x20paid\x20payments\x20for\x20analysis');let _0xb51b03=0x0,_0x2c4488=0x0,_0x21d858=0x0;const _0x6c4858={},_0x297fdd={},_0x4beb5d={};for(const _0x3ea915 of _0x3a2943){try{const _0x4f1055=await currencyService_1[_0x2ea962(0x89)]['convertToUSDT'](_0x3ea915[_0x2ea962(0xb2)],_0x3ea915[_0x2ea962(0x9b)]);let _0x1ac9b3={};if(_0x3ea915[_0x2ea962(0x122)][_0x2ea962(0x82)])try{_0x1ac9b3=JSON[_0x2ea962(0xb5)](_0x3ea915[_0x2ea962(0x122)]['gatewaySettings']);}catch(_0x4e26d1){console['error']('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x3ea915[_0x2ea962(0x7e)]+':',_0x4e26d1);}const _0x2836a9=_0x1ac9b3[_0x2ea962(0x137)]||0xa,_0x46c0f6=_0x4f1055*(_0x2836a9/0x64),_0x49ef45=_0x4f1055-_0x46c0f6;_0xb51b03+=_0x4f1055,_0x2c4488+=_0x49ef45,_0x21d858+=_0x46c0f6;!_0x6c4858[_0x3ea915[_0x2ea962(0x99)]]&&(_0x6c4858[_0x3ea915['gateway']]={'gateway':_0x3ea915[_0x2ea962(0x99)],'gatewayDisplayName':this['getGatewayDisplayName'](_0x3ea915[_0x2ea962(0x99)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x6c4858[_0x3ea915['gateway']][_0x2ea962(0xaf)]++,_0x6c4858[_0x3ea915[_0x2ea962(0x99)]][_0x2ea962(0xd4)]+=_0x4f1055,_0x6c4858[_0x3ea915['gateway']][_0x2ea962(0x90)]+=_0x46c0f6,_0x6c4858[_0x3ea915['gateway']][_0x2ea962(0x85)]+=_0x49ef45,_0x6c4858[_0x3ea915[_0x2ea962(0x99)]][_0x2ea962(0xeb)]+=_0x2836a9;!_0x531c1a[_0x2ea962(0x7e)]&&(!_0x297fdd[_0x3ea915['shopId']]&&(_0x297fdd[_0x3ea915['shopId']]={'shopId':_0x3ea915[_0x2ea962(0x7e)],'shopName':_0x3ea915['shop'][_0x2ea962(0xd6)],'shopUsername':_0x3ea915[_0x2ea962(0x122)][_0x2ea962(0xd7)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x297fdd[_0x3ea915['shopId']]['paymentsCount']++,_0x297fdd[_0x3ea915[_0x2ea962(0x7e)]]['turnoverUSDT']+=_0x4f1055,_0x297fdd[_0x3ea915[_0x2ea962(0x7e)]][_0x2ea962(0x90)]+=_0x46c0f6,_0x297fdd[_0x3ea915[_0x2ea962(0x7e)]][_0x2ea962(0x85)]+=_0x49ef45);const _0x3a84e2=_0x3ea915[_0x2ea962(0x7c)][_0x2ea962(0xbb)]()[_0x2ea962(0xd9)]('T')[0x0];!_0x4beb5d[_0x3a84e2]&&(_0x4beb5d[_0x3a84e2]={'date':_0x3a84e2,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x4beb5d[_0x3a84e2][_0x2ea962(0x134)]+=_0x4f1055,_0x4beb5d[_0x3a84e2][_0x2ea962(0x135)]+=_0x49ef45,_0x4beb5d[_0x3a84e2][_0x2ea962(0xc0)]+=_0x46c0f6,_0x4beb5d[_0x3a84e2]['paymentsCount']++;}catch(_0x17c01d){console[_0x2ea962(0x79)](_0x2ea962(0xf4)+_0x3ea915['id']+':',_0x17c01d);}}Object['values'](_0x6c4858)[_0x2ea962(0x100)](_0x1bd9c7=>{const _0x52387e=_0x2ea962;_0x1bd9c7[_0x52387e(0x126)]=_0x1bd9c7[_0x52387e(0xaf)]>0x0?_0x1bd9c7['totalCommissionRate']/_0x1bd9c7[_0x52387e(0xaf)]:0x0,delete _0x1bd9c7['totalCommissionRate'];}),Object[_0x2ea962(0xe7)](_0x297fdd)[_0x2ea962(0x100)](_0x31a424=>{const _0x49ff6a=_0x2ea962;_0x31a424[_0x49ff6a(0xe4)]=_0x31a424[_0x49ff6a(0xaf)]>0x0?_0x31a424[_0x49ff6a(0xd4)]/_0x31a424['paymentsCount']:0x0;});let _0x7b5064=0x0;if(_0x531c1a[_0x2ea962(0x7e)]){const _0xab41ff=await database_1[_0x2ea962(0x124)][_0x2ea962(0x91)]['findMany']({'where':{'shopId':_0x531c1a[_0x2ea962(0x7e)],'status':_0x2ea962(0x70),'createdAt':{'gte':_0x1698ea,'lte':_0xb3fded}},'select':{'amount':!![]}});_0x7b5064=_0xab41ff[_0x2ea962(0x13f)]((_0x51a2c7,_0x4f4c42)=>_0x51a2c7+_0x4f4c42[_0x2ea962(0xb2)],0x0);}const _0x45293e=_0x3a2943[_0x2ea962(0xfd)],_0x50cc58=_0x3a2943[_0x2ea962(0xfd)],_0x535e82=_0x45293e>0x0?_0xb51b03/_0x45293e:0x0,_0x3da1a5=0x64,_0x20d7f7=Math[_0x2ea962(0xda)]((_0xb3fded[_0x2ea962(0x97)]()-_0x1698ea[_0x2ea962(0x97)]())/(0x3e8*0x3c*0x3c*0x18)),_0x403888={'totalTurnover':Math[_0x2ea962(0x117)](_0xb51b03*0x64)/0x64,'merchantEarnings':Math[_0x2ea962(0x117)](_0x2c4488*0x64)/0x64,'gatewayEarnings':Math['round'](_0x21d858*0x64)/0x64,'totalPaidOut':Math['round'](_0x7b5064*0x64)/0x64,'averageCheck':Math[_0x2ea962(0x117)](_0x535e82*0x64)/0x64,'totalPayments':_0x45293e,'successfulPayments':_0x50cc58,'conversionRate':_0x3da1a5,'gatewayBreakdown':Object[_0x2ea962(0xe7)](_0x6c4858)[_0x2ea962(0xd5)](_0x2c25c3=>({..._0x2c25c3,'turnoverUSDT':Math[_0x2ea962(0x117)](_0x2c25c3['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x2ea962(0x117)](_0x2c25c3[_0x2ea962(0x90)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x2ea962(0x117)](_0x2c25c3[_0x2ea962(0x85)]*0x64)/0x64,'averageCommissionRate':Math[_0x2ea962(0x117)](_0x2c25c3['averageCommissionRate']*0x64)/0x64})),'merchantBreakdown':_0x531c1a[_0x2ea962(0x7e)]?undefined:Object[_0x2ea962(0xe7)](_0x297fdd)['map'](_0x452c23=>({..._0x452c23,'turnoverUSDT':Math[_0x2ea962(0x117)](_0x452c23[_0x2ea962(0xd4)]*0x64)/0x64,'commissionUSDT':Math[_0x2ea962(0x117)](_0x452c23['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x452c23['merchantEarningsUSDT']*0x64)/0x64,'paidOutUSDT':Math[_0x2ea962(0x117)](_0x452c23['paidOutUSDT']*0x64)/0x64,'averageCheckUSDT':Math[_0x2ea962(0x117)](_0x452c23[_0x2ea962(0xe4)]*0x64)/0x64})),'dailyData':Object['values'](_0x4beb5d)[_0x2ea962(0xd5)](_0x4140db=>({..._0x4140db,'turnover':Math[_0x2ea962(0x117)](_0x4140db[_0x2ea962(0x134)]*0x64)/0x64,'merchantEarnings':Math[_0x2ea962(0x117)](_0x4140db[_0x2ea962(0x135)]*0x64)/0x64,'gatewayEarnings':Math[_0x2ea962(0x117)](_0x4140db['gatewayEarnings']*0x64)/0x64}))['sort']((_0x1cdaa7,_0x3d6b20)=>_0x1cdaa7['date'][_0x2ea962(0xe3)](_0x3d6b20[_0x2ea962(0x144)])),'periodInfo':{'from':_0x1698ea,'to':_0xb3fded,'periodType':_0x531c1a[_0x2ea962(0x138)]||'custom','daysCount':_0x20d7f7}};return console[_0x2ea962(0x72)](_0x2ea962(0x73)),console[_0x2ea962(0x72)](_0x2ea962(0x7a)+_0x403888[_0x2ea962(0x112)]+_0x2ea962(0x12b)),console[_0x2ea962(0x72)](_0x2ea962(0xab)+_0x403888[_0x2ea962(0x135)]+_0x2ea962(0x12b)),console['log']('\x20\x20\x20🏪\x20Gateway\x20earnings:\x20'+_0x403888[_0x2ea962(0xc0)]+_0x2ea962(0x12b)),console['log'](_0x2ea962(0xc3)+_0x403888['totalPayments']),_0x403888;}['getGatewayDisplayName'](_0x5bcc5e){const _0x351c0e=a35_0x50c9ca,_0x2ed730={'test_gateway':_0x351c0e(0x116),'plisio':_0x351c0e(0x80),'rapyd':_0x351c0e(0xf8),'noda':_0x351c0e(0x94),'cointopay':_0x351c0e(0xdb),'klyme_eu':_0x351c0e(0x115),'klyme_gb':_0x351c0e(0x10f),'klyme_de':_0x351c0e(0x93)};return _0x2ed730[_0x5bcc5e]||_0x5bcc5e;}async[a35_0x50c9ca(0xa0)](_0x409ac0){const _0x2c79bf=a35_0x50c9ca,{page:_0x42184a,limit:_0x5000a0,minAmount:_0x2ae124,search:_0x4e27c4}=_0x409ac0,_0x1869ef=(_0x42184a-0x1)*_0x5000a0;console['log'](_0x2c79bf(0x84),_0x409ac0);const _0x2f1114={'balance':{'gt':0x0},'status':_0x2c79bf(0x121)};_0x2ae124&&(_0x2f1114[_0x2c79bf(0x12c)][_0x2c79bf(0x11d)]=_0x2ae124);_0x4e27c4&&(_0x2f1114['OR']=[{'name':{'contains':_0x4e27c4,'mode':_0x2c79bf(0xa3)}},{'username':{'contains':_0x4e27c4,'mode':_0x2c79bf(0xa3)}}]);const [_0x2f0141,_0x28d8ab]=await Promise[_0x2c79bf(0x110)]([database_1[_0x2c79bf(0x124)][_0x2c79bf(0x122)]['findMany']({'where':_0x2f1114,'skip':_0x1869ef,'take':_0x5000a0,'orderBy':{'balance':_0x2c79bf(0x13d)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'createdAt':!![]}}),database_1[_0x2c79bf(0x124)][_0x2c79bf(0x122)]['count']({'where':_0x2f1114})]);console[_0x2c79bf(0x72)]('💰\x20Found\x20'+_0x2f0141[_0x2c79bf(0xfd)]+_0x2c79bf(0xad));const _0x5b4375=await Promise[_0x2c79bf(0x110)](_0x2f0141[_0x2c79bf(0xd5)](async _0x449050=>{const _0xc902f4=_0x2c79bf,[_0x4407fe,_0x4935ba,_0x428a8d]=await Promise[_0xc902f4(0x110)]([database_1['default']['payment'][_0xc902f4(0x71)]({'where':{'shopId':_0x449050['id'],'status':_0xc902f4(0x78),'amountUSDT':{'not':null}}}),database_1[_0xc902f4(0x124)][_0xc902f4(0x132)][_0xc902f4(0xac)]({'where':{'shopId':_0x449050['id'],'status':_0xc902f4(0x78),'amountUSDT':{'not':null}},'orderBy':{'paidAt':'asc'},'select':{'paidAt':!![]}}),database_1[_0xc902f4(0x124)]['payment']['groupBy']({'by':[_0xc902f4(0x99)],'where':{'shopId':_0x449050['id'],'status':_0xc902f4(0x78),'amountUSDT':{'not':null}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x511f85=_0x428a8d[_0xc902f4(0xd5)](_0x3cd42b=>({'gateway':_0x3cd42b[_0xc902f4(0x99)],'count':_0x3cd42b[_0xc902f4(0x86)]['id'],'amountUSDT':_0x3cd42b[_0xc902f4(0x9c)][_0xc902f4(0xcf)]||0x0,'amountAfterCommissionUSDT':_0x3cd42b[_0xc902f4(0x9c)][_0xc902f4(0xcf)]||0x0,'commission':0x0}));return{'id':_0x449050['id'],'fullName':_0x449050[_0xc902f4(0xd6)],'username':_0x449050['username'],'telegramId':_0x449050['telegram'],'merchantUrl':_0x449050['shopUrl'],'wallets':{'usdtPolygonWallet':_0x449050['usdtPolygonWallet'],'usdtTrcWallet':_0x449050['usdtTrcWallet'],'usdtErcWallet':_0x449050[_0xc902f4(0x12d)],'usdcPolygonWallet':_0x449050[_0xc902f4(0x74)]},'totalAmountUSDT':_0x449050[_0xc902f4(0x12c)],'totalAmountAfterCommissionUSDT':_0x449050[_0xc902f4(0x12c)],'paymentsCount':_0x4407fe,'oldestPaymentDate':_0x4935ba?.[_0xc902f4(0x7c)]||_0x449050[_0xc902f4(0xc4)],'gatewayBreakdown':_0x511f85};})),_0x10bcb4=_0x2f0141['reduce']((_0x286d59,_0x43fe82)=>_0x286d59+_0x43fe82['balance'],0x0),_0x3a23c7=_0x10bcb4;return console[_0x2c79bf(0x72)](_0x2c79bf(0x129)+_0x28d8ab+_0x2c79bf(0x10e)+Math['round'](_0x3a23c7*0x64)/0x64+_0x2c79bf(0xd1)),{'merchants':_0x5b4375,'pagination':{'page':_0x42184a,'limit':_0x5000a0,'total':_0x28d8ab,'totalPages':Math[_0x2c79bf(0xda)](_0x28d8ab/_0x5000a0)},'summary':{'totalMerchants':_0x28d8ab,'totalAmountUSDT':Math[_0x2c79bf(0x117)](_0x10bcb4*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x3a23c7*0x64)/0x64}};}async[a35_0x50c9ca(0xb0)](_0x1ed195){const _0x36c426=a35_0x50c9ca,{shopId:_0x2cde9d,amount:_0xeca7fa,network:_0x1b7156,notes:_0xda1c96,txid:_0x1b982b,periodFrom:_0x286b8c,periodTo:_0x4a4d65}=_0x1ed195,_0x43532e=await database_1[_0x36c426(0x124)][_0x36c426(0x120)](async _0x15158a=>{const _0x3b234b=_0x36c426,_0x4bf54a=await _0x15158a[_0x3b234b(0x122)]['findUnique']({'where':{'id':_0x2cde9d},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x4bf54a)throw new Error(_0x3b234b(0x10b));console[_0x3b234b(0x72)](_0x3b234b(0x11e)+_0x4bf54a[_0x3b234b(0xd7)]+':'),console['log'](_0x3b234b(0xf0)+_0x4bf54a['balance'][_0x3b234b(0xa8)](0x6)+'\x20USDT'),console['log'](_0x3b234b(0x105)+_0xeca7fa['toFixed'](0x6)+_0x3b234b(0x12b)),console[_0x3b234b(0x72)](_0x3b234b(0xc7)+_0x4bf54a[_0x3b234b(0x104)]['toFixed'](0x6)+_0x3b234b(0x12b));if(_0x1b982b)console[_0x3b234b(0x72)]('\x20\x20\x20Transaction\x20hash:\x20'+_0x1b982b);if(_0x4bf54a[_0x3b234b(0x12c)]<_0xeca7fa)throw new Error(_0x3b234b(0xe2)+_0x4bf54a['balance'][_0x3b234b(0xa8)](0x6)+_0x3b234b(0x127)+_0xeca7fa[_0x3b234b(0xa8)](0x6)+_0x3b234b(0x12b));const _0x1cc13d=await _0x15158a[_0x3b234b(0x91)][_0x3b234b(0x9f)]({'data':{'shopId':_0x2cde9d,'amount':_0xeca7fa,'network':_0x1b7156,'status':_0x3b234b(0x70),'txid':_0x1b982b,'notes':_0xda1c96,'periodFrom':_0x286b8c?new Date(_0x286b8c):null,'periodTo':_0x4a4d65?new Date(_0x4a4d65):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x46a198=_0x4bf54a[_0x3b234b(0x12c)]-_0xeca7fa,_0x22f397=_0x4bf54a[_0x3b234b(0x104)]+_0xeca7fa;return await _0x15158a['shop'][_0x3b234b(0xb6)]({'where':{'id':_0x2cde9d},'data':{'balance':_0x46a198,'totalPaidOut':_0x22f397}}),console[_0x3b234b(0x72)]('💰\x20Shop\x20'+_0x4bf54a[_0x3b234b(0xd7)]+'\x20balance\x20updated:'),console[_0x3b234b(0x72)](_0x3b234b(0xf7)+_0x4bf54a[_0x3b234b(0x12c)][_0x3b234b(0xa8)](0x6)+_0x3b234b(0xfb)+_0x46a198[_0x3b234b(0xa8)](0x6)+_0x3b234b(0x125)+_0xeca7fa[_0x3b234b(0xa8)](0x6)+')'),console[_0x3b234b(0x72)](_0x3b234b(0x8c)+_0x4bf54a['totalPaidOut'][_0x3b234b(0xa8)](0x6)+'\x20->\x20'+_0x22f397[_0x3b234b(0xa8)](0x6)+_0x3b234b(0x136)+_0xeca7fa[_0x3b234b(0xa8)](0x6)+')'),{'payout':_0x1cc13d,'shop':_0x4bf54a};});console[_0x36c426(0x72)]('✅\x20Payout\x20created:\x20'+_0x43532e[_0x36c426(0x91)]['id']+_0x36c426(0xa6)+_0x43532e[_0x36c426(0x122)][_0x36c426(0xd7)]+'\x20('+_0xeca7fa+_0x36c426(0x102));try{await telegramBotService_1['telegramBotService']['sendPayoutNotification'](_0x2cde9d,{'id':_0x43532e[_0x36c426(0x91)]['id'],'amount':_0x43532e['payout'][_0x36c426(0xb2)],'method':_0x43532e[_0x36c426(0x91)][_0x36c426(0xe6)],'txid':_0x43532e[_0x36c426(0x91)][_0x36c426(0xcc)],'createdAt':_0x43532e[_0x36c426(0x91)][_0x36c426(0xc4)]},'created'),console[_0x36c426(0x72)](_0x36c426(0x9e)+_0x43532e['payout']['id']);}catch(_0x29978b){console[_0x36c426(0x79)](_0x36c426(0xfa)+_0x43532e[_0x36c426(0x91)]['id']+':',_0x29978b);}return{'id':_0x43532e['payout']['id'],'shopId':_0x43532e[_0x36c426(0x91)]['shopId'],'shopName':_0x43532e['shop'][_0x36c426(0xd6)],'shopUsername':_0x43532e[_0x36c426(0x122)][_0x36c426(0xd7)],'amount':_0x43532e[_0x36c426(0x91)][_0x36c426(0xb2)],'network':_0x43532e['payout'][_0x36c426(0xe6)],'status':_0x43532e[_0x36c426(0x91)][_0x36c426(0xe9)],'txid':_0x43532e[_0x36c426(0x91)][_0x36c426(0xcc)],'notes':_0x43532e['payout'][_0x36c426(0xd2)],'periodFrom':_0x43532e[_0x36c426(0x91)]['periodFrom'],'periodTo':_0x43532e['payout'][_0x36c426(0xa5)],'createdAt':_0x43532e[_0x36c426(0x91)][_0x36c426(0xc4)],'paidAt':_0x43532e[_0x36c426(0x91)][_0x36c426(0x7c)]};}async[a35_0x50c9ca(0xb3)](_0x5be1c7){const _0x5e92f2=a35_0x50c9ca,{page:_0xeff140,limit:_0x4c04f5,shopId:_0x34f7ba,network:_0x279c76,dateFrom:_0x5c3981,dateTo:_0x4fd075,search:_0x3461ee}=_0x5be1c7,_0x2d708c=(_0xeff140-0x1)*_0x4c04f5,_0x15f9be={};_0x34f7ba&&(_0x15f9be[_0x5e92f2(0x7e)]=_0x34f7ba);_0x279c76&&(_0x15f9be[_0x5e92f2(0xe6)]=_0x279c76);(_0x5c3981||_0x4fd075)&&(_0x15f9be['createdAt']={},_0x5c3981&&(_0x15f9be['createdAt'][_0x5e92f2(0x11d)]=new Date(_0x5c3981)),_0x4fd075&&(_0x15f9be[_0x5e92f2(0xc4)][_0x5e92f2(0xe1)]=new Date(_0x4fd075)));_0x3461ee&&(_0x15f9be['OR']=[{'shop':{'name':{'contains':_0x3461ee,'mode':_0x5e92f2(0xa3)}}},{'shop':{'username':{'contains':_0x3461ee,'mode':_0x5e92f2(0xa3)}}},{'notes':{'contains':_0x3461ee,'mode':'insensitive'}}]);const [_0x1bf08e,_0x39052a]=await Promise['all']([database_1['default'][_0x5e92f2(0x91)]['findMany']({'where':_0x15f9be,'skip':_0x2d708c,'take':_0x4c04f5,'orderBy':{'createdAt':_0x5e92f2(0x13d)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x5e92f2(0x124)][_0x5e92f2(0x91)][_0x5e92f2(0x71)]({'where':_0x15f9be})]);return{'payouts':_0x1bf08e[_0x5e92f2(0xd5)](_0xc2c58a=>({'id':_0xc2c58a['id'],'shopId':_0xc2c58a[_0x5e92f2(0x7e)],'shopName':_0xc2c58a[_0x5e92f2(0x122)][_0x5e92f2(0xd6)],'shopUsername':_0xc2c58a[_0x5e92f2(0x122)][_0x5e92f2(0xd7)],'amount':_0xc2c58a['amount'],'network':_0xc2c58a['network'],'status':_0xc2c58a[_0x5e92f2(0xe9)],'txid':_0xc2c58a['txid'],'notes':_0xc2c58a['notes'],'periodFrom':_0xc2c58a[_0x5e92f2(0x140)],'periodTo':_0xc2c58a[_0x5e92f2(0xa5)],'createdAt':_0xc2c58a[_0x5e92f2(0xc4)],'paidAt':_0xc2c58a[_0x5e92f2(0x7c)]})),'pagination':{'page':_0xeff140,'limit':_0x4c04f5,'total':_0x39052a,'totalPages':Math[_0x5e92f2(0xda)](_0x39052a/_0x4c04f5)}};}async[a35_0x50c9ca(0xbf)](_0x4b080e){const _0x4949f1=a35_0x50c9ca,_0x45d56f=await database_1['default'][_0x4949f1(0x91)][_0x4949f1(0x11a)]({'where':{'id':_0x4b080e},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x45d56f)return null;return{'id':_0x45d56f['id'],'shopId':_0x45d56f[_0x4949f1(0x7e)],'shopName':_0x45d56f[_0x4949f1(0x122)][_0x4949f1(0xd6)],'shopUsername':_0x45d56f[_0x4949f1(0x122)][_0x4949f1(0xd7)],'amount':_0x45d56f[_0x4949f1(0xb2)],'network':_0x45d56f[_0x4949f1(0xe6)],'status':_0x45d56f[_0x4949f1(0xe9)],'txid':_0x45d56f['txid'],'notes':_0x45d56f[_0x4949f1(0xd2)],'periodFrom':_0x45d56f[_0x4949f1(0x140)],'periodTo':_0x45d56f['periodTo'],'createdAt':_0x45d56f[_0x4949f1(0xc4)],'paidAt':_0x45d56f[_0x4949f1(0x7c)]};}async[a35_0x50c9ca(0x108)](_0x593104){const _0xf90b5e=a35_0x50c9ca;await database_1[_0xf90b5e(0x124)][_0xf90b5e(0x91)]['delete']({'where':{'id':_0x593104}});}async['getAllPayments'](_0x57c1f7){const _0x4a5e1a=a35_0x50c9ca,{page:_0x252ec5,limit:_0x4f4cd8,status:_0x4b9107,gateway:_0x2281b1,shopId:_0x31504d,dateFrom:_0x2ec8ff,dateTo:_0x5f1dd6,search:_0x23464d}=_0x57c1f7,_0x501fc3=(_0x252ec5-0x1)*_0x4f4cd8,_0x2e2641={};_0x4b9107&&(_0x2e2641[_0x4a5e1a(0xe9)]=_0x4b9107[_0x4a5e1a(0xfe)]());_0x2281b1&&(_0x2e2641['gateway']=_0x2281b1['toLowerCase']());_0x2e2641[_0x4a5e1a(0x99)]=_0x2e2641['gateway']?_0x2e2641[_0x4a5e1a(0x99)]:{'not':_0x4a5e1a(0x12e)};if(typeof _0x2e2641[_0x4a5e1a(0x99)]===_0x4a5e1a(0x98)&&_0x2e2641['gateway']!==_0x4a5e1a(0x12e)){}else{if(typeof _0x2e2641[_0x4a5e1a(0x99)]===_0x4a5e1a(0x98)&&_0x2e2641[_0x4a5e1a(0x99)]==='test_gateway'){}else _0x2e2641[_0x4a5e1a(0x99)]={'not':_0x4a5e1a(0x12e)};}_0x31504d&&(_0x2e2641[_0x4a5e1a(0x7e)]=_0x31504d);(_0x2ec8ff||_0x5f1dd6)&&(_0x2e2641[_0x4a5e1a(0xc4)]={},_0x2ec8ff&&(_0x2e2641['createdAt'][_0x4a5e1a(0x11d)]=new Date(_0x2ec8ff)),_0x5f1dd6&&(_0x2e2641['createdAt']['lte']=new Date(_0x5f1dd6)));_0x23464d&&(_0x2e2641['OR']=[{'orderId':{'contains':_0x23464d,'mode':'insensitive'}},{'gatewayOrderId':{'contains':_0x23464d,'mode':'insensitive'}},{'customerEmail':{'contains':_0x23464d,'mode':_0x4a5e1a(0xa3)}},{'shop':{'name':{'contains':_0x23464d,'mode':_0x4a5e1a(0xa3)}}},{'shop':{'username':{'contains':_0x23464d,'mode':_0x4a5e1a(0xa3)}}}]);const [_0x33a15b,_0x4ceec9]=await Promise[_0x4a5e1a(0x110)]([database_1['default'][_0x4a5e1a(0x132)][_0x4a5e1a(0x8e)]({'where':_0x2e2641,'skip':_0x501fc3,'take':_0x4f4cd8,'orderBy':{'createdAt':_0x4a5e1a(0x13d)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x4a5e1a(0x132)][_0x4a5e1a(0x71)]({'where':_0x2e2641})]);return{'payments':_0x33a15b[_0x4a5e1a(0xd5)](_0x432bef=>({'id':_0x432bef['id'],'shopId':_0x432bef[_0x4a5e1a(0x7e)],'gateway':_0x432bef[_0x4a5e1a(0x99)],'amount':_0x432bef['amount'],'currency':_0x432bef[_0x4a5e1a(0x9b)],'status':_0x432bef[_0x4a5e1a(0xe9)],'orderId':_0x432bef[_0x4a5e1a(0xde)],'gatewayOrderId':_0x432bef[_0x4a5e1a(0x128)],'customerEmail':_0x432bef[_0x4a5e1a(0xec)],'customerName':_0x432bef[_0x4a5e1a(0xb4)],'customerCountry':_0x432bef[_0x4a5e1a(0xf6)],'customerIp':_0x432bef[_0x4a5e1a(0xee)],'customerUa':_0x432bef[_0x4a5e1a(0xbc)],'failureMessage':_0x432bef['failureMessage'],'createdAt':_0x432bef[_0x4a5e1a(0xc4)],'updatedAt':_0x432bef[_0x4a5e1a(0xb1)],'shop':_0x432bef['shop']})),'pagination':{'page':_0x252ec5,'limit':_0x4f4cd8,'total':_0x4ceec9,'totalPages':Math[_0x4a5e1a(0xda)](_0x4ceec9/_0x4f4cd8)}};}async[a35_0x50c9ca(0x6e)](_0x2e2164){const _0x36d9b9=a35_0x50c9ca,_0x6585f1=await database_1['default'][_0x36d9b9(0x132)][_0x36d9b9(0x11a)]({'where':{'id':_0x2e2164},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x6585f1)return null;return{'id':_0x6585f1['id'],'shopId':_0x6585f1['shopId'],'gateway':_0x6585f1[_0x36d9b9(0x99)],'amount':_0x6585f1[_0x36d9b9(0xb2)],'currency':_0x6585f1[_0x36d9b9(0x9b)],'status':_0x6585f1[_0x36d9b9(0xe9)],'orderId':_0x6585f1[_0x36d9b9(0xde)],'gatewayOrderId':_0x6585f1['gatewayOrderId'],'customerEmail':_0x6585f1[_0x36d9b9(0xec)],'customerName':_0x6585f1['customerName'],'customerCountry':_0x6585f1[_0x36d9b9(0xf6)],'customerIp':_0x6585f1['customerIp'],'customerUa':_0x6585f1['customerUa'],'failureMessage':_0x6585f1[_0x36d9b9(0xf9)],'externalPaymentUrl':_0x6585f1[_0x36d9b9(0x6d)],'successUrl':_0x6585f1[_0x36d9b9(0x139)],'failUrl':_0x6585f1[_0x36d9b9(0xf5)],'pendingUrl':_0x6585f1[_0x36d9b9(0x8a)],'whiteUrl':_0x6585f1['whiteUrl'],'createdAt':_0x6585f1[_0x36d9b9(0xc4)],'updatedAt':_0x6585f1[_0x36d9b9(0xb1)],'shop':_0x6585f1[_0x36d9b9(0x122)]};}async[a35_0x50c9ca(0xdd)](_0x5d23d4,_0x380a75,_0x4819e6,_0x44f3ea){const _0x3ad4ac=a35_0x50c9ca,_0x2bcf6f=await database_1['default'][_0x3ad4ac(0x120)](async _0x419882=>{const _0x162fa6=_0x3ad4ac,_0x4c259f=await _0x419882[_0x162fa6(0x132)][_0x162fa6(0x11a)]({'where':{'id':_0x5d23d4},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x4c259f)throw new Error(_0x162fa6(0x83));const _0x2fa006=_0x4c259f[_0x162fa6(0xe9)],_0x2f8905=_0x380a75['toUpperCase']();console[_0x162fa6(0x72)]('🔄\x20Admin\x20updating\x20payment\x20'+_0x5d23d4+_0x162fa6(0x66)+_0x2fa006+_0x162fa6(0xfb)+_0x2f8905),console[_0x162fa6(0x72)](_0x162fa6(0xdc)+_0x4c259f[_0x162fa6(0x122)][_0x162fa6(0x12c)]+_0x162fa6(0x12b));const _0x2c4773={'status':_0x2f8905,'updatedAt':new Date(),'statusChangedBy':'admin','statusChangedAt':new Date()};_0x4819e6&&(_0x2c4773[_0x162fa6(0x6a)]=_0x4819e6);_0x2f8905===_0x162fa6(0xef)&&_0x44f3ea&&(_0x2c4773[_0x162fa6(0x11c)]=_0x44f3ea);let _0x346627=0x0,_0x42f98a=_0x4c259f[_0x162fa6(0x122)]['balance'];if(_0x2f8905===_0x162fa6(0x78)&&_0x2fa006!==_0x162fa6(0x78)){_0x2c4773[_0x162fa6(0x7c)]=new Date();const _0x591b3c=await currencyService_1['currencyService']['convertToUSDT'](_0x4c259f[_0x162fa6(0xb2)],_0x4c259f[_0x162fa6(0x9b)]);_0x2c4773[_0x162fa6(0xcf)]=_0x591b3c,_0x346627=_0x591b3c,_0x42f98a+=_0x591b3c,console['log'](_0x162fa6(0x123)+_0x5d23d4+_0x162fa6(0x76)+_0x591b3c[_0x162fa6(0xa8)](0x6)+_0x162fa6(0x133));}else _0x2fa006==='PAID'&&_0x2f8905!==_0x162fa6(0x78)&&(_0x4c259f[_0x162fa6(0xcf)]&&(_0x346627=-_0x4c259f[_0x162fa6(0xcf)],_0x42f98a-=_0x4c259f[_0x162fa6(0xcf)],_0x2c4773[_0x162fa6(0xcf)]=null,console[_0x162fa6(0x72)]('💰\x20Payment\x20'+_0x5d23d4+_0x162fa6(0x10a)+_0x4c259f[_0x162fa6(0xcf)][_0x162fa6(0xa8)](0x6)+'\x20USDT\x20from\x20balance')));if(_0x2f8905===_0x162fa6(0xef)){if(_0x2fa006===_0x162fa6(0x78)&&_0x4c259f[_0x162fa6(0xcf)]){}_0x44f3ea&&_0x44f3ea>0x0&&(_0x346627-=_0x44f3ea,_0x42f98a-=_0x44f3ea,console[_0x162fa6(0x72)](_0x162fa6(0xed)+_0x44f3ea[_0x162fa6(0xa8)](0x6)+_0x162fa6(0xb9)));}_0x2f8905===_0x162fa6(0xca)&&_0x2fa006===_0x162fa6(0x78)&&console[_0x162fa6(0x72)]('🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance');const _0x1a4a0f=await _0x419882[_0x162fa6(0x132)][_0x162fa6(0xb6)]({'where':{'id':_0x5d23d4},'data':_0x2c4773,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x346627!==0x0&&(await _0x419882[_0x162fa6(0x122)]['update']({'where':{'id':_0x4c259f[_0x162fa6(0x7e)]},'data':{'balance':_0x42f98a}}),console['log'](_0x162fa6(0x146)+_0x4c259f[_0x162fa6(0x7e)]+_0x162fa6(0x109)+_0x4c259f[_0x162fa6(0x122)][_0x162fa6(0x12c)]['toFixed'](0x6)+_0x162fa6(0xfb)+_0x42f98a[_0x162fa6(0xa8)](0x6)+_0x162fa6(0xa7)+(_0x346627>0x0?'+':'')+_0x346627[_0x162fa6(0xa8)](0x6)+')')),_0x1a4a0f;});return{'id':_0x2bcf6f['id'],'shopId':_0x2bcf6f[_0x3ad4ac(0x7e)],'gateway':_0x2bcf6f[_0x3ad4ac(0x99)],'amount':_0x2bcf6f[_0x3ad4ac(0xb2)],'currency':_0x2bcf6f[_0x3ad4ac(0x9b)],'status':_0x2bcf6f[_0x3ad4ac(0xe9)],'orderId':_0x2bcf6f[_0x3ad4ac(0xde)],'gatewayOrderId':_0x2bcf6f['gatewayOrderId'],'customerEmail':_0x2bcf6f['customerEmail'],'customerName':_0x2bcf6f[_0x3ad4ac(0xb4)],'customerCountry':_0x2bcf6f[_0x3ad4ac(0xf6)],'customerIp':_0x2bcf6f[_0x3ad4ac(0xee)],'customerUa':_0x2bcf6f[_0x3ad4ac(0xbc)],'failureMessage':_0x2bcf6f[_0x3ad4ac(0xf9)],'adminNotes':_0x2bcf6f['adminNotes'],'chargebackAmount':_0x2bcf6f[_0x3ad4ac(0x11c)],'statusChangedBy':_0x2bcf6f[_0x3ad4ac(0xd8)],'statusChangedAt':_0x2bcf6f[_0x3ad4ac(0x69)],'createdAt':_0x2bcf6f[_0x3ad4ac(0xc4)],'updatedAt':_0x2bcf6f[_0x3ad4ac(0xb1)],'shop':_0x2bcf6f[_0x3ad4ac(0x122)]};}async['updateUser'](_0x566960,_0x41c211){const _0x2d084c=a35_0x50c9ca,_0x314d2a={..._0x41c211};_0x41c211['password']&&(_0x314d2a[_0x2d084c(0xf2)]=await bcryptjs_1[_0x2d084c(0x124)]['hash'](_0x41c211[_0x2d084c(0xf2)],0xc));_0x41c211[_0x2d084c(0x12a)]&&(_0x314d2a[_0x2d084c(0xd6)]=_0x41c211[_0x2d084c(0x12a)],delete _0x314d2a[_0x2d084c(0x12a)]);_0x41c211[_0x2d084c(0x92)]&&(_0x314d2a[_0x2d084c(0x107)]=_0x41c211['telegramId'],delete _0x314d2a[_0x2d084c(0x92)]);_0x41c211[_0x2d084c(0xaa)]&&(_0x314d2a[_0x2d084c(0x142)]=_0x41c211['merchantUrl'],delete _0x314d2a[_0x2d084c(0xaa)]);_0x41c211[_0x2d084c(0xcd)]&&(_0x314d2a[_0x2d084c(0x12f)]=JSON[_0x2d084c(0xae)](_0x41c211['gateways']),delete _0x314d2a[_0x2d084c(0xcd)]);_0x41c211[_0x2d084c(0x82)]&&(_0x314d2a['gatewaySettings']=JSON[_0x2d084c(0xae)](_0x41c211[_0x2d084c(0x82)]),delete _0x314d2a[_0x2d084c(0x82)]);_0x41c211[_0x2d084c(0x65)]&&(_0x41c211[_0x2d084c(0x65)][_0x2d084c(0x118)]!==undefined&&(_0x314d2a[_0x2d084c(0x118)]=_0x41c211[_0x2d084c(0x65)][_0x2d084c(0x118)]||null),_0x41c211[_0x2d084c(0x65)][_0x2d084c(0xe5)]!==undefined&&(_0x314d2a[_0x2d084c(0xe5)]=_0x41c211[_0x2d084c(0x65)][_0x2d084c(0xe5)]||null),_0x41c211[_0x2d084c(0x65)][_0x2d084c(0x12d)]!==undefined&&(_0x314d2a[_0x2d084c(0x12d)]=_0x41c211[_0x2d084c(0x65)][_0x2d084c(0x12d)]||null),_0x41c211[_0x2d084c(0x65)][_0x2d084c(0x74)]!==undefined&&(_0x314d2a['usdcPolygonWallet']=_0x41c211[_0x2d084c(0x65)][_0x2d084c(0x74)]||null),delete _0x314d2a[_0x2d084c(0x65)]);const _0x2033e3=await database_1['default'][_0x2d084c(0x122)][_0x2d084c(0xb6)]({'where':{'id':_0x566960},'data':_0x314d2a,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2033e3['id'],'fullName':_0x2033e3[_0x2d084c(0xd6)],'username':_0x2033e3[_0x2d084c(0xd7)],'telegramId':_0x2033e3[_0x2d084c(0x107)],'merchantUrl':_0x2033e3[_0x2d084c(0x142)],'gateways':_0x2033e3[_0x2d084c(0x12f)]?JSON['parse'](_0x2033e3[_0x2d084c(0x12f)]):null,'gatewaySettings':_0x2033e3['gatewaySettings']?JSON[_0x2d084c(0xb5)](_0x2033e3['gatewaySettings']):null,'publicKey':_0x2033e3[_0x2d084c(0x11f)],'wallets':{'usdtPolygonWallet':_0x2033e3[_0x2d084c(0x118)],'usdtTrcWallet':_0x2033e3[_0x2d084c(0xe5)],'usdtErcWallet':_0x2033e3[_0x2d084c(0x12d)],'usdcPolygonWallet':_0x2033e3['usdcPolygonWallet']},'status':_0x2033e3[_0x2d084c(0xe9)],'createdAt':_0x2033e3[_0x2d084c(0xc4)]};}async[a35_0x50c9ca(0x13b)](_0x58e52e){const _0x173166=a35_0x50c9ca,_0x49efe8=await database_1[_0x173166(0x124)][_0x173166(0x122)][_0x173166(0xb6)]({'where':{'id':_0x58e52e},'data':{'status':_0x173166(0x13c)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x49efe8['id'],'fullName':_0x49efe8[_0x173166(0xd6)],'username':_0x49efe8['username'],'telegramId':_0x49efe8['telegram'],'merchantUrl':_0x49efe8[_0x173166(0x142)],'gateways':_0x49efe8[_0x173166(0x12f)]?JSON[_0x173166(0xb5)](_0x49efe8[_0x173166(0x12f)]):null,'gatewaySettings':_0x49efe8[_0x173166(0x82)]?JSON[_0x173166(0xb5)](_0x49efe8['gatewaySettings']):null,'publicKey':_0x49efe8[_0x173166(0x11f)],'wallets':{'usdtPolygonWallet':_0x49efe8[_0x173166(0x118)],'usdtTrcWallet':_0x49efe8['usdtTrcWallet'],'usdtErcWallet':_0x49efe8[_0x173166(0x12d)],'usdcPolygonWallet':_0x49efe8[_0x173166(0x74)]},'status':_0x49efe8[_0x173166(0xe9)],'createdAt':_0x49efe8[_0x173166(0xc4)]};}async[a35_0x50c9ca(0xff)](_0x27f87f){const _0x12bc79=a35_0x50c9ca,_0x3df76b=await database_1['default'][_0x12bc79(0x122)][_0x12bc79(0xb6)]({'where':{'id':_0x27f87f},'data':{'status':_0x12bc79(0x121)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x3df76b['id'],'fullName':_0x3df76b[_0x12bc79(0xd6)],'username':_0x3df76b['username'],'telegramId':_0x3df76b['telegram'],'merchantUrl':_0x3df76b['shopUrl'],'gateways':_0x3df76b[_0x12bc79(0x12f)]?JSON['parse'](_0x3df76b[_0x12bc79(0x12f)]):null,'gatewaySettings':_0x3df76b[_0x12bc79(0x82)]?JSON[_0x12bc79(0xb5)](_0x3df76b['gatewaySettings']):null,'publicKey':_0x3df76b[_0x12bc79(0x11f)],'wallets':{'usdtPolygonWallet':_0x3df76b[_0x12bc79(0x118)],'usdtTrcWallet':_0x3df76b[_0x12bc79(0xe5)],'usdtErcWallet':_0x3df76b[_0x12bc79(0x12d)],'usdcPolygonWallet':_0x3df76b[_0x12bc79(0x74)]},'status':_0x3df76b[_0x12bc79(0xe9)],'createdAt':_0x3df76b[_0x12bc79(0xc4)]};}async['getAllUsers'](_0x3cd27f){const _0x34e87b=a35_0x50c9ca,{page:_0x3cbfa0,limit:_0x3fd3af,status:_0x3e35cd}=_0x3cd27f,_0x688419=(_0x3cbfa0-0x1)*_0x3fd3af,_0x291767={};_0x3e35cd&&(_0x291767[_0x34e87b(0xe9)]=_0x3e35cd[_0x34e87b(0xfe)]());const [_0x48de92,_0x1477e3]=await Promise['all']([database_1[_0x34e87b(0x124)][_0x34e87b(0x122)][_0x34e87b(0x8e)]({'where':_0x291767,'skip':_0x688419,'take':_0x3fd3af,'orderBy':{'createdAt':_0x34e87b(0x13d)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x34e87b(0x124)]['shop'][_0x34e87b(0x71)]({'where':_0x291767})]);return{'users':_0x48de92['map'](_0x301988=>({'id':_0x301988['id'],'fullName':_0x301988[_0x34e87b(0xd6)],'username':_0x301988[_0x34e87b(0xd7)],'telegramId':_0x301988[_0x34e87b(0x107)],'merchantUrl':_0x301988[_0x34e87b(0x142)],'gateways':_0x301988[_0x34e87b(0x12f)]?JSON[_0x34e87b(0xb5)](_0x301988[_0x34e87b(0x12f)]):null,'gatewaySettings':_0x301988[_0x34e87b(0x82)]?JSON['parse'](_0x301988[_0x34e87b(0x82)]):null,'publicKey':_0x301988[_0x34e87b(0x11f)],'wallets':{'usdtPolygonWallet':_0x301988['usdtPolygonWallet'],'usdtTrcWallet':_0x301988[_0x34e87b(0xe5)],'usdtErcWallet':_0x301988[_0x34e87b(0x12d)],'usdcPolygonWallet':_0x301988[_0x34e87b(0x74)]},'status':_0x301988[_0x34e87b(0xe9)],'createdAt':_0x301988[_0x34e87b(0xc4)]})),'pagination':{'page':_0x3cbfa0,'limit':_0x3fd3af,'total':_0x1477e3,'totalPages':Math[_0x34e87b(0xda)](_0x1477e3/_0x3fd3af)}};}async[a35_0x50c9ca(0x8d)](_0x3dd828){const _0x405075=a35_0x50c9ca,_0x27669b=await database_1[_0x405075(0x124)]['shop']['findUnique']({'where':{'id':_0x3dd828},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x27669b)return null;return{'id':_0x27669b['id'],'fullName':_0x27669b['name'],'username':_0x27669b[_0x405075(0xd7)],'telegramId':_0x27669b[_0x405075(0x107)],'merchantUrl':_0x27669b[_0x405075(0x142)],'gateways':_0x27669b['paymentGateways']?JSON[_0x405075(0xb5)](_0x27669b[_0x405075(0x12f)]):null,'gatewaySettings':_0x27669b[_0x405075(0x82)]?JSON[_0x405075(0xb5)](_0x27669b[_0x405075(0x82)]):null,'publicKey':_0x27669b[_0x405075(0x11f)],'wallets':{'usdtPolygonWallet':_0x27669b['usdtPolygonWallet'],'usdtTrcWallet':_0x27669b[_0x405075(0xe5)],'usdtErcWallet':_0x27669b['usdtErcWallet'],'usdcPolygonWallet':_0x27669b[_0x405075(0x74)]},'status':_0x27669b[_0x405075(0xe9)],'createdAt':_0x27669b[_0x405075(0xc4)]};}async[a35_0x50c9ca(0xba)](_0x5c6e56){const _0x1a726=a35_0x50c9ca,{fullName:_0x5ab3e3,username:_0x44a10e,password:_0xf0cf22,telegramId:_0x4340ed,merchantUrl:_0x4b6b7,gateways:_0x41b0a5,gatewaySettings:_0x4c28fb,wallets:_0x355405}=_0x5c6e56,_0x5d893f=await database_1[_0x1a726(0x124)]['shop'][_0x1a726(0x11a)]({'where':{'username':_0x44a10e}});if(_0x5d893f)throw new Error(_0x1a726(0xe8));if(_0x4340ed){const _0x55efe5=await database_1[_0x1a726(0x124)]['shop'][_0x1a726(0x11a)]({'where':{'telegram':_0x4340ed}});if(_0x55efe5)throw new Error(_0x1a726(0x81));}const _0x3b8565=await bcryptjs_1[_0x1a726(0x124)][_0x1a726(0x8b)](_0xf0cf22,0xc),_0x118299=_0x1a726(0x7f)+crypto_1[_0x1a726(0x124)][_0x1a726(0xbe)](0x20)['toString'](_0x1a726(0x67)),_0x524e2d=_0x1a726(0xea)+crypto_1[_0x1a726(0x124)]['randomBytes'](0x20)[_0x1a726(0x143)]('hex'),_0x43db6a=await database_1[_0x1a726(0x124)][_0x1a726(0x122)][_0x1a726(0x9f)]({'data':{'name':_0x5ab3e3,'username':_0x44a10e,'password':_0x3b8565,'telegram':_0x4340ed,'shopUrl':_0x4b6b7,'paymentGateways':_0x41b0a5?JSON[_0x1a726(0xae)](_0x41b0a5):null,'gatewaySettings':_0x4c28fb?JSON['stringify'](_0x4c28fb):null,'usdtPolygonWallet':_0x355405?.[_0x1a726(0x118)]||null,'usdtTrcWallet':_0x355405?.[_0x1a726(0xe5)]||null,'usdtErcWallet':_0x355405?.[_0x1a726(0x12d)]||null,'usdcPolygonWallet':_0x355405?.[_0x1a726(0x74)]||null,'publicKey':_0x118299,'secretKey':_0x524e2d,'status':_0x1a726(0x121)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x43db6a['id'],'fullName':_0x43db6a['name'],'username':_0x43db6a[_0x1a726(0xd7)],'telegramId':_0x43db6a[_0x1a726(0x107)],'merchantUrl':_0x43db6a[_0x1a726(0x142)],'gateways':_0x43db6a[_0x1a726(0x12f)]?JSON[_0x1a726(0xb5)](_0x43db6a[_0x1a726(0x12f)]):null,'gatewaySettings':_0x43db6a[_0x1a726(0x82)]?JSON[_0x1a726(0xb5)](_0x43db6a[_0x1a726(0x82)]):null,'publicKey':_0x43db6a[_0x1a726(0x11f)],'wallets':{'usdtPolygonWallet':_0x43db6a[_0x1a726(0x118)],'usdtTrcWallet':_0x43db6a[_0x1a726(0xe5)],'usdtErcWallet':_0x43db6a['usdtErcWallet'],'usdcPolygonWallet':_0x43db6a[_0x1a726(0x74)]},'status':_0x43db6a['status'],'createdAt':_0x43db6a[_0x1a726(0xc4)]};}async[a35_0x50c9ca(0x9a)](_0x29904c){const _0x38efbf=a35_0x50c9ca;await database_1[_0x38efbf(0x124)][_0x38efbf(0x122)][_0x38efbf(0x88)]({'where':{'id':_0x29904c}});}}exports[a35_0x50c9ca(0xc1)]=AdminService;