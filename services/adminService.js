'use strict';function a46_0xc94e(){const _0x3aa2cc=[']\x20Gateway\x20settings\x20before\x20saving:','ðŸ”\x20Using\x20gateway\x20\x27','\x20USDT\x20(theoretical\x20net)','hash','\x20\x20\x20â³\x20Awaiting\x20payout:\x20','ÐÐµ\x20ÑƒÐºÐ°Ð·Ð°Ð½','ðŸ’¸\x20CHARGEBACK:\x20Processing\x20penalty-only\x20deduction','map','klyme_gb','custom','ðŸ”\x20Selected\x20trc20\x20wallet:\x20','shopUrl','usdtPolygonWallet','round','Username\x20already\x20exists','Plisio','convertToUSDT','\x20balance\x20updated:\x20','\x20\x20\x20Transaction\x20hash:\x20','merchantEarningsUSDT','year','paidAt','month','\x20USDT\x20from\x20balance','ðŸ”\x20Shop\x20wallets:','ðŸ“…\x20Payout\x20date\x20to\x20filter:\x20','getFullYear','orderId','totalAmountUSDT','periodTo','getTime','\x20\x20\x20ðŸ’°\x20Total\x20turnover:\x20','KLYME\x20GB','COMPLETED','ðŸ’°\x20[PAYOUT]\x20Gateway\x20','create','PAID','paidOutUSDT','day','ðŸ“…\x20Date\x20from\x20filter:\x20','dailyRevenue','\x20\x20\x20ðŸ‘¤\x20Merchant\x20earnings:\x20','ðŸ“Š\x20Using\x20saved\x20values\x20for\x20payment\x20','stringify','password','Open\x20Banking\x202','reduce','gte','wallet','erc20_usdc','CHARGEBACK','\x20USDT\x20(rounded\x20to\x202\x20decimal\x20places)','toString','balance','\x20with\x20payout\x20history','ðŸ”\x20Balance\x20check\x20details:','\x20USDT\x20(gross\x20revenue)','58370RfhAYo','usdtTrcWallet','\x20USDT\x20(already\x20paid\x20out)','noda','âœ…\x20Using\x20wallet\x20from\x20request:\x20','telegramId','totalPaidOut','ðŸ”§\x20[','ðŸ’°\x20Shop\x20','slice','\x27\x20not\x20found.\x20Available\x20gateways:\x20','\x20\x20\x20ðŸŒ\x20Country:\x20','âš ï¸\x20Payment\x20','txid','ðŸ“Š\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','customerEmail','Insufficient\x20balance.\x20Available:\x20','telegram','lte','Test\x20Gateway','_sum','gatewayEarnings','status','ðŸ”„\x20Admin\x20updating\x20payment\x20','\x20merchants\x20for\x20selection','ðŸ”\x20Selected\x20erc20\x20wallet:\x20','776182qIAfgB','ðŸ“Š\x20Final\x20WHERE\x20conditions:','_count','ðŸ”„\x20Updating\x20customer\x20data\x20for\x20payment\x20','updateUser','ðŸ”„\x20Gateway\x20mapping\x20(create):','pendingUrl','setDate','./currencyService','\x20USDT\x20(-','ðŸ“Š\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','entries','\x20for\x20shop\x20','forEach','toLowerCase','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','Rapyd','\x20\x20\x20Added\x20to\x20balance:\x20+','deleteUser','generateDailyStatistics','revenue','AdminService','__esModule','ðŸ“Š\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','createUser','ðŸ“‹\x20Found\x20','commissionUSDT','\x20\x20\x20ðŸ”\x20Calculated\x20after\x20commission:\x20','test_gateway','turnover','name','2816562XGZtnn','\x27\x20(from\x20\x27','error','yesterday','bcryptjs','2020-01-01','getDate','ðŸ“±\x20Telegram\x20notification\x20sent\x20for\x20payout\x20','parse','\x20\x20\x20Balance:\x20','\x20\x20\x20ðŸ“…\x20This\x20month:\x20','ðŸ“Š\x20Available\x20gateways\x20in\x20database:','ðŸŽ¯\x20updateUser\x20called\x20with\x20ID:\x20','suspendUser','publicKey','\x20\x20\x20Available\x20(raw):\x20','Noda','trc20','shop','totalCommissionRate','ðŸ”\x20[','customerName',']\x20Updating\x20password\x20for\x20user\x20','toFixed','âŒ\x20Failed\x20to\x20send\x20Telegram\x20notification\x20for\x20payout\x20','payment','defineProperty','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','erc20','getMerchantsAwaitingPayout',',\x20Commission:\x20','ðŸ“Š\x20Payout\x20statistics\x20calculated:','ðŸ”\x20Selected\x20polygon\x20wallet:\x20','\x20\x20\x20ï¿½\x20Total\x20paid\x20out:\x20','log','activateUser','\x20\x20\x20Difference:\x20','paymentGateways','statusChangedBy','ðŸ“‹\x20Getting\x20merchants\x20selection\x20list...','1bXqBKM','\x20\x20\x20ðŸ¤”\x20Difference:\x20','ðŸ“…\x20Period:\x20','chargebackAmount','ðŸ’±\x20Currency\x20filter\x20applied:\x20','wallets','updatedAt','KLYME\x20EU','ðŸ“Š\x20Calculated\x20commission\x20rate\x20for\x20payment\x20','warn','averageCheckUSDT','set','not\x20set','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','âœ…\x20Using\x20gateway\x20filter:\x20\x27','getPayoutStats','\x20payments)','ðŸ“Š\x20Calculating\x20payout\x20statistics...','\x20USDT\x20(','network','week','insensitive','\x20\x20\x20âœ…\x20Actual\x20available\x20balance:\x20','30d','90d','\x20PAID\x20payments','ðŸ”„\x20Converted\x20gateway\x20ID\x20\x27','hex','totalTurnover','ðŸ’°\x20Payment\x20','failureMessage','getAllPayments','\x27\x20->\x20ID\x20\x27','groupBy','findMany','KLYME\x20DE','desc','dailyPayments','cointopay','gatewayOrderId','some','âœ…\x20Payout\x20created:\x20','\x20\x20\x20ðŸ’°\x20Total\x20payments\x20turnover:\x20','deletePayout','ðŸ”\x20Selected\x20erc20_usdc\x20wallet:\x20','\x20\x20\x20Merchant\x20gets:\x20','\x20\x20\x20â³\x20Pending\x20payout:\x20','getMerchantStatistics','customerIp','\x20\x20\x20Requested\x20(number):\x20','ðŸ“…\x20Date\x20to\x20filter:\x20',',\x20successful:\x20','getMerchantsSelection','âš ï¸\x20CHARGEBACK\x20without\x20penalty\x20amount\x20-\x20no\x20balance\x20change','âš ï¸\x20Requested\x20gateway\x20\x27','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','../types/gateway','amountAfterGatewayCommissionUSDT','ðŸ“Š\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20','availableBalance','\x20\x20\x20ðŸ“…\x20Total\x20payouts\x20(this\x20month):\x20','length','%\x20commission)','join','\x20USDT','../config/database','crypto','ðŸ”„\x20Gateway\x20mapping\x20(get):','CoinToPay','randomBytes','\x20\x20\x20Total\x20paid\x20out:\x20','gatewaySettings','dateFrom','\x20\x20\x20Tolerance:\x20','split','aggregate','\x20USDT\x20(same\x20as\x20awaiting)','failUrl','\x20-\x20','\x20\x20\x20ï¿½ðŸ“Š\x20Total\x20payments:\x20','period','toLocaleDateString','\x20status:\x20','\x20USDT)','âš ï¸\x20Gateway\x20\x27','getSystemStatistics','\x20\x20\x20ðŸ’µ\x20Available\x20balance:\x20','ðŸ“Š\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','count','getMonth','getGatewayNameById','3536580lDwvfQ','usdcErcWallet','merchantUrl','Error\x20processing\x20payment\x20','default','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','ðŸ’°\x20[PAYOUT]\x20Merchant\x20','amount','payout','ðŸ”„\x20Converted\x20gateway\x20name\x20\x27','notes','findUnique','usdcPolygonWallet','toISOString','telegramBotService','ru-RU','SUSPENDED','filter','\x20USDT,\x20Requested:\x20','\x20USDT,\x20merchant:\x20','includes','getGatewayDisplayName','admin','\x20\x20\x20ðŸ–¥ï¸\x20User\x20Agent:\x20',',\x20chargebacks:\x20','findFirst','Payment\x20not\x20found','\x20\x20\x20âœ…\x20Total\x20net\x20balances:\x20','merchantEarnings',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','periodFrom','getAllUsers','\x20->\x20','pk_','ðŸŽ¯\x20[','\x20\x20\x20Available\x20(number):\x20','0000','ðŸ’°\x20Payment\x20amount\x20is\x20NOT\x20deducted\x20(chargeback\x20penalty\x20only)','MasterCard','âœ…\x20Balance\x20check\x20passed\x20(with\x20tolerance)','ACTIVE','\x20\x20\x20ï¿½\x20Total\x20payments\x20turnover:\x20','\x20\x20\x20Payout\x20amount:\x20','getPayoutById','averageCommissionRate','ðŸ’°\x20Creating\x20payout\x20for\x20shop\x20','setHours','totalPayments','substr','1790164kBBxyh','createdAt','ðŸ“Š\x20Merchants\x20with\x20rounded\x20balance\x20!=\x200.00:\x20','ðŸ’³\x20Final\x20payout\x20wallet\x20for\x20','ðŸ“Š\x20Sorting\x20payments\x20by\x20','updateCustomerData','currency','turnoverUSDT','localeCompare','not\x20provided','\x20\x20\x20Gateway:\x20','usdtErcWallet','\x20\x20\x20ðŸ’¸\x20Total\x20payouts:\x20','fullName','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','rapyd','\x20\x20\x20Full\x20amount:\x20','amountUSDT','ðŸ”\x20Creating\x20payout\x20with\x20data:','gatewayCommissionRate','\x20\x20\x20ðŸ’°\x20Total\x20payout:\x20','ðŸ“Š\x20Gateway\x20filter\x20applied:','ðŸ”\x20Initial\x20wallet\x20from\x20request:\x20','âœ…\x20Customer\x20data\x20updated\x20for\x20payment\x20','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','push','payouts','PENDING','ðŸ’°\x20Found\x20','asc','gateway','shopId','all','\x20USDT\x20(after\x20','delete','floor','$transaction','min','successUrl','%\x20from\x20','ceil','currencyService','adminNotes','update','âœ…\x20Payout\x20created\x20in\x20DB:','pendingPayout','amountAfterCommissionUSDT','getGatewayIdByName','getAllPayouts','klyme_de','\x27\x20->\x20name\x20\x27','\x20paid\x20payments\x20for\x20analysis','\x20\x20\x20Merchant\x20loses:\x20','commission','\x27\x20to\x20name\x20\x27','paymentsCount','username','951168DVBGEp','customerUa','updatePaymentStatus','values','totalPayout','\x20\x20\x20Final\x20payout\x20amount\x20used:\x20','\x20\x20\x20ðŸ’¸\x20Total\x20payouts\x20(all\x20time):\x20','REFUND','toUpperCase','not\x20specified','ðŸ“Š\x20Getting\x20payments\x20with\x20filters:','\x20\x20\x20ðŸ’³\x20Total\x20payments:\x20','2843368gauuTU','getGatewayInternalName','__importDefault','gateways','\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)','customerCountry'];a46_0xc94e=function(){return _0x3aa2cc;};return a46_0xc94e();}function a46_0x53de(_0x25ff5a,_0x3f3a56){_0x25ff5a=_0x25ff5a-0x15b;const _0xc94edb=a46_0xc94e();let _0x53dea3=_0xc94edb[_0x25ff5a];return _0x53dea3;}const a46_0x515ad2=a46_0x53de;(function(_0x4981c1,_0x52bbc5){const _0x23d604=a46_0x53de,_0x19d036=_0x4981c1();while(!![]){try{const _0x4f3bcd=parseInt(_0x23d604(0x1d6))/0x1*(-parseInt(_0x23d604(0x18f))/0x2)+-parseInt(_0x23d604(0x29b))/0x3+parseInt(_0x23d604(0x262))/0x4+parseInt(_0x23d604(0x175))/0x5+parseInt(_0x23d604(0x231))/0x6+-parseInt(_0x23d604(0x1ae))/0x7+parseInt(_0x23d604(0x2a7))/0x8;if(_0x4f3bcd===_0x52bbc5)break;else _0x19d036['push'](_0x19d036['shift']());}catch(_0x1037cf){_0x19d036['push'](_0x19d036['shift']());}}}(a46_0xc94e,0x48669));var __importDefault=this&&this[a46_0x515ad2(0x2a9)]||function(_0x3f8e2f){const _0x3857b8=a46_0x515ad2;return _0x3f8e2f&&_0x3f8e2f[_0x3857b8(0x1a5)]?_0x3f8e2f:{'default':_0x3f8e2f};};Object[a46_0x515ad2(0x1c8)](exports,'__esModule',{'value':!![]}),exports[a46_0x515ad2(0x1a4)]=void 0x0;const database_1=__importDefault(require(a46_0x515ad2(0x217))),bcryptjs_1=__importDefault(require(a46_0x515ad2(0x1b2))),crypto_1=__importDefault(require(a46_0x515ad2(0x218))),currencyService_1=require(a46_0x515ad2(0x197)),telegramBotService_1=require('./telegramBotService'),gateway_1=require(a46_0x515ad2(0x20e));class AdminService{async[a46_0x515ad2(0x1e5)](){const _0x5e71fb=a46_0x515ad2;console[_0x5e71fb(0x1d0)](_0x5e71fb(0x1e7));const _0x2bc426=await database_1[_0x5e71fb(0x235)]['shop'][_0x5e71fb(0x221)]({'_sum':{'balance':!![],'totalPaidOut':!![]}}),_0x3a0fae=await database_1[_0x5e71fb(0x235)]['payment'][_0x5e71fb(0x22e)]({'where':{'status':_0x5e71fb(0x160),'gateway':{'not':'test_gateway'}}}),_0x12293e=new Date(),_0x486c66=new Date(_0x12293e[_0x5e71fb(0x2c7)](),_0x12293e[_0x5e71fb(0x22f)](),0x1),_0x323547=new Date(_0x12293e['getFullYear'](),_0x12293e['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x384d84=await database_1[_0x5e71fb(0x235)][_0x5e71fb(0x239)][_0x5e71fb(0x221)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x486c66,'lte':_0x323547},'status':_0x5e71fb(0x15d)}}),_0x377a3e=_0x2bc426[_0x5e71fb(0x189)][_0x5e71fb(0x17b)]||0x0,_0x288cb8=_0x2bc426[_0x5e71fb(0x189)][_0x5e71fb(0x171)]||0x0,_0x48178e=_0x384d84[_0x5e71fb(0x189)][_0x5e71fb(0x238)]||0x0,_0x43f3b7={'totalPayout':Math[_0x5e71fb(0x2ba)](_0x377a3e*0x64)/0x64,'awaitingPayout':Math[_0x5e71fb(0x2ba)](_0x288cb8*0x64)/0x64,'thisMonth':Math[_0x5e71fb(0x2ba)](_0x48178e*0x64)/0x64,'availableBalance':Math[_0x5e71fb(0x2ba)](_0x288cb8*0x64)/0x64,'totalPayments':_0x3a0fae};return console[_0x5e71fb(0x1d0)](_0x5e71fb(0x1cd)),console[_0x5e71fb(0x1d0)](_0x5e71fb(0x276)+_0x43f3b7[_0x5e71fb(0x29f)]+'\x20USDT\x20(total\x20paid\x20to\x20merchants)'),console[_0x5e71fb(0x1d0)](_0x5e71fb(0x2b1)+_0x43f3b7['awaitingPayout']+'\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)'),console['log'](_0x5e71fb(0x22c)+_0x43f3b7[_0x5e71fb(0x211)]+_0x5e71fb(0x222)),console['log'](_0x5e71fb(0x1b8)+_0x43f3b7['thisMonth']+'\x20USDT'),console[_0x5e71fb(0x1d0)](_0x5e71fb(0x2a6)+_0x43f3b7[_0x5e71fb(0x260)]+_0x5e71fb(0x1ef)),_0x43f3b7;}async[a46_0x515ad2(0x267)](_0x59af80,_0x1bc7af){const _0x432a59=a46_0x515ad2;console[_0x432a59(0x1d0)](_0x432a59(0x192)+_0x59af80+':',_0x1bc7af);const _0x1d64e4=await database_1['default']['payment'][_0x432a59(0x23c)]({'where':{'id':_0x59af80},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x1d64e4)throw new Error(_0x432a59(0x24b));const _0x5cd444={};_0x1bc7af[_0x432a59(0x2ac)]!==undefined&&(_0x5cd444[_0x432a59(0x2ac)]=_0x1bc7af['customerCountry']||null);_0x1bc7af['customerIp']!==undefined&&(_0x5cd444['customerIp']=_0x1bc7af['customerIp']||null);_0x1bc7af[_0x432a59(0x29c)]!==undefined&&(_0x5cd444[_0x432a59(0x29c)]=_0x1bc7af[_0x432a59(0x29c)]||null);const _0x5c157a=await database_1[_0x432a59(0x235)][_0x432a59(0x1c7)][_0x432a59(0x28d)]({'where':{'id':_0x59af80},'data':{..._0x5cd444,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console['log'](_0x432a59(0x279)+_0x59af80),console[_0x432a59(0x1d0)](_0x432a59(0x180)+_0x1d64e4['customerCountry']+_0x432a59(0x251)+_0x5c157a[_0x432a59(0x2ac)]),console['log']('\x20\x20\x20ðŸŒ\x20IP:\x20'+_0x1d64e4[_0x432a59(0x206)]+_0x432a59(0x251)+_0x5c157a['customerIp']),console[_0x432a59(0x1d0)](_0x432a59(0x248)+(_0x1d64e4[_0x432a59(0x29c)]?_0x432a59(0x1e1):'not\x20set')+'\x20->\x20'+(_0x5c157a[_0x432a59(0x29c)]?_0x432a59(0x1e1):_0x432a59(0x1e2))),_0x5c157a;}async[a46_0x515ad2(0x22b)](_0x36e160){const _0xc0ff6=a46_0x515ad2,_0x2d4dae=new Date();let _0x393bc8;switch(_0x36e160['toLowerCase']()){case _0xc0ff6(0x162):_0x393bc8=new Date(_0x2d4dae[_0xc0ff6(0x2c7)](),_0x2d4dae[_0xc0ff6(0x22f)](),_0x2d4dae['getDate'](),0x0,0x0,0x0,0x0);break;case'yesterday':const _0x3082eb=new Date(_0x2d4dae);_0x3082eb[_0xc0ff6(0x196)](_0x3082eb[_0xc0ff6(0x1b4)]()-0x1),_0x393bc8=new Date(_0x3082eb[_0xc0ff6(0x2c7)](),_0x3082eb['getMonth'](),_0x3082eb[_0xc0ff6(0x1b4)](),0x0,0x0,0x0,0x0);break;case'7d':_0x393bc8=new Date(_0x2d4dae[_0xc0ff6(0x2cb)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0xc0ff6(0x1ed):_0x393bc8=new Date(_0x2d4dae[_0xc0ff6(0x2cb)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0xc0ff6(0x1ee):_0x393bc8=new Date(_0x2d4dae[_0xc0ff6(0x2cb)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0xc0ff6(0x282):const _0x59aedd=await database_1[_0xc0ff6(0x235)]['payment'][_0xc0ff6(0x24a)]({'where':{'gateway':{'not':'test_gateway'}},'orderBy':{'createdAt':_0xc0ff6(0x27f)},'select':{'createdAt':!![]}});_0x393bc8=_0x59aedd?_0x59aedd['createdAt']:new Date(_0xc0ff6(0x1b3));break;default:_0x393bc8=new Date(_0x2d4dae[_0xc0ff6(0x2cb)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}_0x393bc8[_0xc0ff6(0x25f)](0x0,0x0,0x0,0x0);let _0x480a10;if(_0x36e160[_0xc0ff6(0x19d)]()===_0xc0ff6(0x1b1)){const _0x2f8685=new Date(_0x2d4dae);_0x2f8685[_0xc0ff6(0x196)](_0x2f8685[_0xc0ff6(0x1b4)]()-0x1),_0x480a10=new Date(_0x2f8685['getFullYear'](),_0x2f8685[_0xc0ff6(0x22f)](),_0x2f8685[_0xc0ff6(0x1b4)](),0x17,0x3b,0x3b,0x3e7);}const _0x39677a={'gte':_0x393bc8};_0x480a10&&(_0x39677a['lte']=_0x480a10);const [_0x47a8b1,_0x458270,_0x401f07,_0x2d1734,_0x43e588,_0x28b172,_0x2763c8,_0x27bb49]=await Promise[_0xc0ff6(0x282)]([database_1['default'][_0xc0ff6(0x1c0)][_0xc0ff6(0x22e)](),database_1[_0xc0ff6(0x235)][_0xc0ff6(0x1c0)][_0xc0ff6(0x22e)]({'where':{'status':_0xc0ff6(0x259)}}),database_1[_0xc0ff6(0x235)][_0xc0ff6(0x1c7)]['count']({'where':{'status':'PAID','createdAt':_0x39677a,'gateway':{'not':_0xc0ff6(0x1ab)}}}),database_1[_0xc0ff6(0x235)][_0xc0ff6(0x1c7)][_0xc0ff6(0x22e)]({'where':{'status':_0xc0ff6(0x16e),'createdAt':_0x39677a,'gateway':{'not':_0xc0ff6(0x1ab)}}}),database_1['default'][_0xc0ff6(0x1c7)]['count']({'where':{'status':_0xc0ff6(0x2a2),'createdAt':_0x39677a,'gateway':{'not':_0xc0ff6(0x1ab)}}}),database_1[_0xc0ff6(0x235)][_0xc0ff6(0x1c7)][_0xc0ff6(0x1f8)]({'where':{'status':_0xc0ff6(0x160),'createdAt':_0x39677a,'gateway':{'not':_0xc0ff6(0x1ab)}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0xc0ff6(0x235)][_0xc0ff6(0x1c7)][_0xc0ff6(0x1f8)]({'where':{'gateway':{'not':_0xc0ff6(0x1ab)}},'take':0xa,'orderBy':{'createdAt':_0xc0ff6(0x1fa)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0xc0ff6(0x235)][_0xc0ff6(0x1c7)][_0xc0ff6(0x1f8)]({'where':{'createdAt':_0x39677a,'gateway':{'not':_0xc0ff6(0x1ab)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x3cebda=0x0,_0x42eec1=0x0;for(const _0x1e42ec of _0x28b172){const _0x192210=_0x1e42ec[_0xc0ff6(0x273)]||0x0;_0x3cebda+=_0x192210;if(_0x1e42ec[_0xc0ff6(0x20f)]&&_0x1e42ec[_0xc0ff6(0x273)]){const _0x24c7b6=_0x1e42ec[_0xc0ff6(0x273)]-_0x1e42ec[_0xc0ff6(0x20f)];_0x42eec1+=_0x24c7b6;}}const _0x437768=_0x401f07>0x0?_0x3cebda/_0x401f07:0x0,_0x7b273d=this['generateDailyStatistics'](_0x27bb49,_0x393bc8,_0x480a10||_0x2d4dae),_0x22de5f=await database_1[_0xc0ff6(0x235)][_0xc0ff6(0x1c7)]['count']({'where':{'createdAt':_0x39677a,'gateway':{'not':_0xc0ff6(0x1ab)}}}),_0xef2754=_0x22de5f>0x0?_0x401f07/_0x22de5f*0x64:0x0;return{'totalShops':_0x47a8b1,'activeShops':_0x458270,'totalPayments':_0x401f07,'successfulPayments':_0x401f07,'totalAttempts':_0x22de5f,'chargebacks':_0x2d1734,'refunds':_0x43e588,'totalRevenue':Math[_0xc0ff6(0x2ba)](_0x3cebda*0x64)/0x64,'trapayEarnings':Math[_0xc0ff6(0x2ba)](_0x42eec1*0x64)/0x64,'averagePaymentAmount':Math[_0xc0ff6(0x2ba)](_0x437768*0x64)/0x64,'conversionRate':Math['round'](_0xef2754*0x64)/0x64,'dailyRevenue':_0x7b273d[_0xc0ff6(0x164)],'dailyPayments':_0x7b273d[_0xc0ff6(0x1fb)],'recentPayments':_0x2763c8[_0xc0ff6(0x2b4)](_0x76432=>({'id':_0x76432['id'],'amount':_0x76432[_0xc0ff6(0x238)],'currency':_0x76432[_0xc0ff6(0x268)],'status':_0x76432['status'],'gateway':_0x76432[_0xc0ff6(0x280)],'shop':_0x76432[_0xc0ff6(0x1c0)],'createdAt':_0x76432[_0xc0ff6(0x263)]}))};}async[a46_0x515ad2(0x205)](_0x2b9dbd){const _0x3e1a64=a46_0x515ad2;console[_0x3e1a64(0x1d0)]('ðŸ“Š\x20Getting\x20merchant\x20statistics\x20with\x20filters:',_0x2b9dbd);let _0x49d6b0,_0x33e2f7=new Date();if(_0x2b9dbd[_0x3e1a64(0x226)]===_0x3e1a64(0x2b6)&&_0x2b9dbd[_0x3e1a64(0x21e)]&&_0x2b9dbd['dateTo'])_0x49d6b0=new Date(_0x2b9dbd[_0x3e1a64(0x21e)]),_0x33e2f7=new Date(_0x2b9dbd['dateTo']),_0x49d6b0[_0x3e1a64(0x25f)](0x0,0x0,0x0,0x0),_0x33e2f7[_0x3e1a64(0x25f)](0x17,0x3b,0x3b,0x3e7);else{const _0x1113b9=new Date();switch(_0x2b9dbd[_0x3e1a64(0x226)]){case _0x3e1a64(0x1ea):_0x49d6b0=new Date(_0x1113b9[_0x3e1a64(0x2cb)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x3e1a64(0x2c3):_0x49d6b0=new Date(_0x1113b9[_0x3e1a64(0x2cb)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x3e1a64(0x2c1):_0x49d6b0=new Date(_0x1113b9[_0x3e1a64(0x2cb)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case'all':default:_0x49d6b0=new Date(_0x3e1a64(0x1b3));break;}_0x49d6b0[_0x3e1a64(0x25f)](0x0,0x0,0x0,0x0),_0x33e2f7[_0x3e1a64(0x25f)](0x17,0x3b,0x3b,0x3e7);}console[_0x3e1a64(0x1d0)](_0x3e1a64(0x1d8)+_0x49d6b0[_0x3e1a64(0x23e)]()+'\x20to\x20'+_0x33e2f7['toISOString']());const _0x4e24c1={'status':'PAID','gateway':{'not':'test_gateway'},'paidAt':{'gte':_0x49d6b0,'lte':_0x33e2f7}};_0x2b9dbd[_0x3e1a64(0x281)]&&(_0x4e24c1[_0x3e1a64(0x281)]=_0x2b9dbd[_0x3e1a64(0x281)]);const _0x1b6b36=await database_1['default'][_0x3e1a64(0x1c7)]['findMany']({'where':_0x4e24c1,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console['log'](_0x3e1a64(0x27e)+_0x1b6b36[_0x3e1a64(0x213)]+_0x3e1a64(0x295));const _0xa99911={'gateway':{'not':_0x3e1a64(0x1ab)},'createdAt':{'gte':_0x49d6b0,'lte':_0x33e2f7}};_0x2b9dbd['shopId']&&(_0xa99911[_0x3e1a64(0x281)]=_0x2b9dbd[_0x3e1a64(0x281)]);const _0x68ea01=await database_1[_0x3e1a64(0x235)]['payment'][_0x3e1a64(0x22e)]({'where':_0xa99911}),_0x1bf747={..._0xa99911,'status':'CHARGEBACK'},_0x383cbb={..._0xa99911,'status':_0x3e1a64(0x2a2)},[_0x534ef9,_0x1b9db1]=await Promise['all']([database_1[_0x3e1a64(0x235)][_0x3e1a64(0x1c7)][_0x3e1a64(0x22e)]({'where':_0x1bf747}),database_1[_0x3e1a64(0x235)]['payment'][_0x3e1a64(0x22e)]({'where':_0x383cbb})]);console[_0x3e1a64(0x1d0)]('ðŸ“Š\x20Total\x20payments\x20(including\x20failed):\x20'+_0x68ea01+_0x3e1a64(0x209)+_0x1b6b36['length']+_0x3e1a64(0x249)+_0x534ef9+',\x20refunds:\x20'+_0x1b9db1);let _0x15ae4c=0x0,_0x2cd115=0x0,_0x1b8c1b=0x0;const _0x1273ab={},_0x5f4553={},_0x3c0964={};for(const _0xbe031a of _0x1b6b36){try{const _0x25f830=_0xbe031a[_0x3e1a64(0x273)]||0x0;if(_0x25f830<=0x0){console[_0x3e1a64(0x1df)](_0x3e1a64(0x181)+_0xbe031a['id']+'\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...');continue;}let _0x1c8eca,_0xd7dc1f;if(_0xbe031a[_0x3e1a64(0x20f)]!==null&&_0xbe031a[_0x3e1a64(0x20f)]!==undefined)_0x1c8eca=_0xbe031a[_0x3e1a64(0x20f)],_0xd7dc1f=_0x25f830-_0x1c8eca,console[_0x3e1a64(0x1d0)](_0x3e1a64(0x166)+_0xbe031a['id']+':\x20'+_0x25f830[_0x3e1a64(0x1c5)](0x6)+_0x3e1a64(0x244)+_0x1c8eca['toFixed'](0x6)+_0x3e1a64(0x216));else{let _0x18b381={};if(_0xbe031a['shop'][_0x3e1a64(0x21d)])try{_0x18b381=JSON[_0x3e1a64(0x1b6)](_0xbe031a[_0x3e1a64(0x1c0)][_0x3e1a64(0x21d)]);}catch(_0x30453f){console[_0x3e1a64(0x1b0)](_0x3e1a64(0x236)+_0xbe031a['shopId']+':',_0x30453f);}let _0x1d5777=0x2d;for(const [_0x1f4732,_0x3ae5fe]of Object[_0x3e1a64(0x19a)](_0x18b381)){if(_0x1f4732['toLowerCase']()===_0xbe031a[_0x3e1a64(0x280)]['toLowerCase']()){_0x1d5777=_0x3ae5fe[_0x3e1a64(0x297)]||0x2d;break;}}_0xd7dc1f=_0x25f830*(_0x1d5777/0x64),_0x1c8eca=_0x25f830-_0xd7dc1f,console[_0x3e1a64(0x1d0)](_0x3e1a64(0x22d)+_0xbe031a['id']+':\x20'+_0x1d5777+'%\x20from\x20'+_0x25f830[_0x3e1a64(0x1c5)](0x6)+'\x20USDT');}_0x15ae4c+=_0x25f830,_0x2cd115+=_0x1c8eca,_0x1b8c1b+=_0xd7dc1f;let _0x4b5a08;_0xbe031a[_0x3e1a64(0x275)]!==null&&_0xbe031a[_0x3e1a64(0x275)]!==undefined?(_0x4b5a08=_0xbe031a[_0x3e1a64(0x275)],console[_0x3e1a64(0x1d0)](_0x3e1a64(0x210)+_0xbe031a['id']+':\x20'+_0x4b5a08+'%')):(_0x4b5a08=_0x25f830>0x0?_0xd7dc1f/_0x25f830*0x64:0x0,console[_0x3e1a64(0x1d0)](_0x3e1a64(0x1de)+_0xbe031a['id']+':\x20'+_0x4b5a08[_0x3e1a64(0x1c5)](0x2)+'%'));!_0x1273ab[_0xbe031a[_0x3e1a64(0x280)]]&&(_0x1273ab[_0xbe031a['gateway']]={'gateway':_0xbe031a[_0x3e1a64(0x280)],'gatewayDisplayName':this['getGatewayDisplayName'](_0xbe031a['gateway']),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x1273ab[_0xbe031a[_0x3e1a64(0x280)]]['paymentsCount']++,_0x1273ab[_0xbe031a[_0x3e1a64(0x280)]][_0x3e1a64(0x269)]+=_0x25f830,_0x1273ab[_0xbe031a[_0x3e1a64(0x280)]][_0x3e1a64(0x1a9)]+=_0xd7dc1f,_0x1273ab[_0xbe031a[_0x3e1a64(0x280)]][_0x3e1a64(0x2c0)]+=_0x1c8eca,_0x1273ab[_0xbe031a[_0x3e1a64(0x280)]][_0x3e1a64(0x1c1)]+=_0x4b5a08;!_0x2b9dbd[_0x3e1a64(0x281)]&&(!_0x5f4553[_0xbe031a['shopId']]&&(_0x5f4553[_0xbe031a[_0x3e1a64(0x281)]]={'shopId':_0xbe031a[_0x3e1a64(0x281)],'shopName':_0xbe031a[_0x3e1a64(0x1c0)][_0x3e1a64(0x1ad)],'shopUsername':_0xbe031a['shop']['username'],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x5f4553[_0xbe031a[_0x3e1a64(0x281)]][_0x3e1a64(0x299)]++,_0x5f4553[_0xbe031a[_0x3e1a64(0x281)]][_0x3e1a64(0x269)]+=_0x25f830,_0x5f4553[_0xbe031a[_0x3e1a64(0x281)]][_0x3e1a64(0x1a9)]+=_0xd7dc1f,_0x5f4553[_0xbe031a[_0x3e1a64(0x281)]][_0x3e1a64(0x2c0)]+=_0x1c8eca);const _0x48bc18=_0xbe031a[_0x3e1a64(0x2c2)][_0x3e1a64(0x23e)]()['split']('T')[0x0];!_0x3c0964[_0x48bc18]&&(_0x3c0964[_0x48bc18]={'date':_0x48bc18,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x3c0964[_0x48bc18][_0x3e1a64(0x1ac)]+=_0x25f830,_0x3c0964[_0x48bc18][_0x3e1a64(0x24d)]+=_0x1c8eca,_0x3c0964[_0x48bc18]['gatewayEarnings']+=_0xd7dc1f,_0x3c0964[_0x48bc18][_0x3e1a64(0x299)]++;}catch(_0x447ecc){console[_0x3e1a64(0x1b0)](_0x3e1a64(0x234)+_0xbe031a['id']+':',_0x447ecc);}}Object[_0x3e1a64(0x29e)](_0x1273ab)[_0x3e1a64(0x19c)](_0x8faf82=>{const _0x5c743f=_0x3e1a64;_0x8faf82['averageCommissionRate']=_0x8faf82['paymentsCount']>0x0?_0x8faf82[_0x5c743f(0x1c1)]/_0x8faf82[_0x5c743f(0x299)]:0x0,delete _0x8faf82[_0x5c743f(0x1c1)];}),Object['values'](_0x5f4553)[_0x3e1a64(0x19c)](_0x39bc94=>{const _0x4b1aaa=_0x3e1a64;_0x39bc94[_0x4b1aaa(0x1e0)]=_0x39bc94['paymentsCount']>0x0?_0x39bc94[_0x4b1aaa(0x269)]/_0x39bc94['paymentsCount']:0x0;});let _0x439dee=0x0,_0x34ee96=0x0;if(_0x2b9dbd['shopId']){const _0x1da325=await database_1['default']['payout'][_0x3e1a64(0x1f8)]({'where':{'shopId':_0x2b9dbd[_0x3e1a64(0x281)],'status':_0x3e1a64(0x15d),'createdAt':{'gte':_0x49d6b0,'lte':_0x33e2f7}},'select':{'amount':!![]}});_0x439dee=_0x1da325['reduce']((_0x68071,_0x5c1dd0)=>_0x68071+_0x5c1dd0['amount'],0x0);const _0x5234b2=await database_1['default'][_0x3e1a64(0x239)][_0x3e1a64(0x1f8)]({'where':{'shopId':_0x2b9dbd[_0x3e1a64(0x281)],'status':_0x3e1a64(0x27d),'createdAt':{'gte':_0x49d6b0,'lte':_0x33e2f7}},'select':{'amount':!![]}});_0x34ee96=_0x5234b2[_0x3e1a64(0x16a)]((_0x3c8f6d,_0x5df0cf)=>_0x3c8f6d+_0x5df0cf[_0x3e1a64(0x238)],0x0);}const _0x1a68d6=_0x68ea01,_0x3b9c14=_0x1b6b36['length'],_0x2e51e2=_0x3b9c14>0x0?_0x15ae4c/_0x3b9c14:0x0,_0x4c13f1=_0x1a68d6>0x0?Math[_0x3e1a64(0x2ba)](_0x3b9c14/_0x1a68d6*0x2710)/0x64:0x0,_0x50f0f2=Math[_0x3e1a64(0x28a)]((_0x33e2f7[_0x3e1a64(0x2cb)]()-_0x49d6b0[_0x3e1a64(0x2cb)]())/(0x3e8*0x3c*0x3c*0x18)),_0x2234e6={'totalTurnover':Math['round'](_0x15ae4c*0x64)/0x64,'merchantEarnings':Math[_0x3e1a64(0x2ba)](_0x2cd115*0x64)/0x64,'gatewayEarnings':Math[_0x3e1a64(0x2ba)](_0x1b8c1b*0x64)/0x64,'totalPaidOut':Math[_0x3e1a64(0x2ba)](_0x439dee*0x64)/0x64,'pendingPayout':Math[_0x3e1a64(0x2ba)](_0x34ee96*0x64)/0x64,'averageCheck':Math[_0x3e1a64(0x2ba)](_0x2e51e2*0x64)/0x64,'totalPayments':_0x1a68d6,'successfulPayments':_0x3b9c14,'conversionRate':_0x4c13f1,'chargebacks':_0x534ef9,'refunds':_0x1b9db1,'gatewayBreakdown':Object[_0x3e1a64(0x29e)](_0x1273ab)[_0x3e1a64(0x2b4)](_0x368a9e=>({..._0x368a9e,'turnoverUSDT':Math[_0x3e1a64(0x2ba)](_0x368a9e[_0x3e1a64(0x269)]*0x64)/0x64,'commissionUSDT':Math[_0x3e1a64(0x2ba)](_0x368a9e[_0x3e1a64(0x1a9)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x3e1a64(0x2ba)](_0x368a9e['merchantEarningsUSDT']*0x64)/0x64,'averageCommissionRate':Math['round'](_0x368a9e[_0x3e1a64(0x25d)]*0x64)/0x64})),'merchantBreakdown':_0x2b9dbd['shopId']?undefined:Object[_0x3e1a64(0x29e)](_0x5f4553)[_0x3e1a64(0x2b4)](_0x15b91b=>({..._0x15b91b,'turnoverUSDT':Math[_0x3e1a64(0x2ba)](_0x15b91b[_0x3e1a64(0x269)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x15b91b[_0x3e1a64(0x1a9)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x3e1a64(0x2ba)](_0x15b91b[_0x3e1a64(0x2c0)]*0x64)/0x64,'paidOutUSDT':Math[_0x3e1a64(0x2ba)](_0x15b91b[_0x3e1a64(0x161)]*0x64)/0x64,'averageCheckUSDT':Math['round'](_0x15b91b[_0x3e1a64(0x1e0)]*0x64)/0x64})),'dailyData':Object[_0x3e1a64(0x29e)](_0x3c0964)[_0x3e1a64(0x2b4)](_0x3a34cf=>({..._0x3a34cf,'turnover':Math[_0x3e1a64(0x2ba)](_0x3a34cf['turnover']*0x64)/0x64,'merchantEarnings':Math['round'](_0x3a34cf[_0x3e1a64(0x24d)]*0x64)/0x64,'gatewayEarnings':Math[_0x3e1a64(0x2ba)](_0x3a34cf['gatewayEarnings']*0x64)/0x64}))['sort']((_0xc20325,_0x37ad46)=>_0xc20325['date'][_0x3e1a64(0x26a)](_0x37ad46['date'])),'periodInfo':{'from':_0x49d6b0,'to':_0x33e2f7,'periodType':_0x2b9dbd[_0x3e1a64(0x226)]||_0x3e1a64(0x2b6),'daysCount':_0x50f0f2}};return console[_0x3e1a64(0x1d0)]('ðŸ“Š\x20Merchant\x20statistics\x20calculated:'),console[_0x3e1a64(0x1d0)](_0x3e1a64(0x15b)+_0x2234e6[_0x3e1a64(0x1f2)]+_0x3e1a64(0x216)),console['log'](_0x3e1a64(0x165)+_0x2234e6['merchantEarnings']+_0x3e1a64(0x216)),console['log']('\x20\x20\x20ðŸª\x20Gateway\x20earnings:\x20'+_0x2234e6[_0x3e1a64(0x18a)]+'\x20USDT'),console[_0x3e1a64(0x1d0)](_0x3e1a64(0x1cf)+_0x2234e6[_0x3e1a64(0x17b)]+_0x3e1a64(0x216)),console[_0x3e1a64(0x1d0)](_0x3e1a64(0x204)+_0x2234e6[_0x3e1a64(0x28f)]+_0x3e1a64(0x216)),console[_0x3e1a64(0x1d0)](_0x3e1a64(0x225)+_0x2234e6['totalPayments']),_0x2234e6;}async[a46_0x515ad2(0x20a)](_0x4e48e0){const _0x465231=a46_0x515ad2;console['log'](_0x465231(0x1d5),{'hasPayoutHistory':_0x4e48e0});let _0x4ad8b0={};_0x4e48e0&&(_0x4ad8b0[_0x465231(0x27c)]={'some':{}});const _0x1d2fe1=await database_1[_0x465231(0x235)]['shop'][_0x465231(0x1f8)]({'where':_0x4ad8b0,'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':'asc'}});return console['log'](_0x465231(0x1a8)+_0x1d2fe1[_0x465231(0x213)]+_0x465231(0x18d)+(_0x4e48e0?_0x465231(0x172):'')),_0x1d2fe1[_0x465231(0x2b4)](_0x7e3059=>({'id':_0x7e3059['id'],'username':_0x7e3059['username'],'name':_0x7e3059[_0x465231(0x1ad)]}));}['getGatewayDisplayName'](_0x517578){const _0x4ce4fc=a46_0x515ad2,_0x37610d={'test_gateway':_0x4ce4fc(0x188),'plisio':_0x4ce4fc(0x2bc),'rapyd':_0x4ce4fc(0x19f),'noda':_0x4ce4fc(0x1be),'cointopay':_0x4ce4fc(0x21a),'cointopay2':_0x4ce4fc(0x169),'klyme_eu':_0x4ce4fc(0x1dd),'klyme_gb':_0x4ce4fc(0x15c),'klyme_de':_0x4ce4fc(0x1f9),'mastercard':_0x4ce4fc(0x257)};return _0x37610d[_0x517578]||_0x517578;}[a46_0x515ad2(0x2a8)](_0x2f34ee){const _0x491414=a46_0x515ad2,_0x4c0b57={'Test\x20Gateway':_0x491414(0x1ab),'Plisio':'plisio','Rapyd':_0x491414(0x271),'Noda':_0x491414(0x178),'CoinToPay':_0x491414(0x1fc),'CoinToPay2':'cointopay2','KLYME\x20EU':'klyme_eu','KLYME\x20GB':_0x491414(0x2b5),'KLYME\x20DE':_0x491414(0x293),'MasterCard':'mastercard'};return _0x4c0b57[_0x2f34ee]||_0x2f34ee[_0x491414(0x19d)]();}async[a46_0x515ad2(0x1cb)](_0x1805c4){const _0x175bdc=a46_0x515ad2,{page:_0x279311,limit:_0x4722bf,minAmount:_0x531ec4,search:_0x50fed9}=_0x1805c4;console[_0x175bdc(0x1d0)](_0x175bdc(0x1a6),_0x1805c4);let _0x5e0b57={};_0x50fed9&&(_0x5e0b57['name']={'contains':_0x50fed9,'mode':_0x175bdc(0x1eb)});const _0x519c17=await database_1[_0x175bdc(0x235)]['shop'][_0x175bdc(0x1f8)]({'where':_0x5e0b57,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),_0x13b777=_0x519c17[_0x175bdc(0x242)](_0x5c204c=>{const _0x21033d=_0x175bdc,_0x27ca76=Math[_0x21033d(0x285)](_0x5c204c['balance']*0x64)/0x64;if(_0x531ec4&&_0x27ca76<_0x531ec4)return![];return _0x27ca76!==0x0;});_0x13b777['sort']((_0x56393d,_0x307810)=>_0x307810['balance']-_0x56393d[_0x175bdc(0x171)]);const _0x338935=_0x13b777[_0x175bdc(0x213)],_0x1cd336=(_0x279311-0x1)*_0x4722bf,_0x83d13a=_0x13b777[_0x175bdc(0x17e)](_0x1cd336,_0x1cd336+_0x4722bf);console[_0x175bdc(0x1d0)](_0x175bdc(0x27e)+_0x83d13a[_0x175bdc(0x213)]+'\x20merchants\x20with\x20rounded\x20balance\x20!=\x200.00\x20(excluding\x20balances\x20that\x20round\x20to\x200.00)');const _0x5f3335=await Promise['all'](_0x83d13a[_0x175bdc(0x2b4)](async _0x54399c=>{const _0x4e0013=_0x175bdc,[_0x4309f6,_0xf5237a,_0x29970c]=await Promise[_0x4e0013(0x282)]([database_1[_0x4e0013(0x235)][_0x4e0013(0x1c7)]['count']({'where':{'shopId':_0x54399c['id'],'status':_0x4e0013(0x160),'gateway':{'not':_0x4e0013(0x1ab)}}}),database_1[_0x4e0013(0x235)]['payment'][_0x4e0013(0x24a)]({'where':{'shopId':_0x54399c['id'],'status':_0x4e0013(0x160),'gateway':{'not':_0x4e0013(0x1ab)}},'orderBy':{'paidAt':'asc'},'select':{'paidAt':!![]}}),database_1['default']['payment'][_0x4e0013(0x1f7)]({'by':[_0x4e0013(0x280)],'where':{'shopId':_0x54399c['id'],'status':_0x4e0013(0x160),'gateway':{'not':_0x4e0013(0x1ab)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x563b1e=new Date(),_0x32abe7=new Date(_0x563b1e[_0x4e0013(0x2c7)](),_0x563b1e[_0x4e0013(0x22f)](),0x1),_0x1e376d=new Date(_0x563b1e[_0x4e0013(0x2c7)](),_0x563b1e[_0x4e0013(0x22f)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x3b91cc,_0x26db06]=await Promise[_0x4e0013(0x282)]([database_1[_0x4e0013(0x235)]['payout'][_0x4e0013(0x221)]({'_sum':{'amount':!![]},'where':{'shopId':_0x54399c['id'],'status':_0x4e0013(0x15d)}}),database_1['default']['payout'][_0x4e0013(0x221)]({'_sum':{'amount':!![]},'where':{'shopId':_0x54399c['id'],'status':_0x4e0013(0x15d),'createdAt':{'gte':_0x32abe7,'lte':_0x1e376d}}})]),_0x15cdd0=_0x3b91cc[_0x4e0013(0x189)][_0x4e0013(0x238)]||0x0,_0x43e056=_0x26db06['_sum'][_0x4e0013(0x238)]||0x0,_0x282333=await Promise[_0x4e0013(0x282)](_0x29970c[_0x4e0013(0x2b4)](async _0x175a17=>{const _0x3b03d5=_0x4e0013;let _0x358940=0x2d;if(_0x54399c[_0x3b03d5(0x21d)])try{const _0x1a9dc6=JSON['parse'](_0x54399c[_0x3b03d5(0x21d)]);for(const [_0x4a5189,_0x5e0387]of Object[_0x3b03d5(0x19a)](_0x1a9dc6)){if(_0x4a5189[_0x3b03d5(0x19d)]()===_0x175a17[_0x3b03d5(0x280)][_0x3b03d5(0x19d)]()){_0x358940=_0x5e0387[_0x3b03d5(0x297)]||0xa,console[_0x3b03d5(0x1d0)](_0x3b03d5(0x15e)+_0x175a17[_0x3b03d5(0x280)]+_0x3b03d5(0x19b)+_0x54399c['id']+':\x20commission\x20=\x20'+_0x358940+'%');break;}}}catch(_0x2d13d4){console[_0x3b03d5(0x1b0)]('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x54399c['id']+':',_0x2d13d4);}const _0x5bd52b=_0x175a17['_sum']?.[_0x3b03d5(0x273)]||0x0,_0x50f7f0=_0x5bd52b*(0x1-_0x358940/0x64);return{'gateway':_0x175a17[_0x3b03d5(0x280)],'count':_0x175a17[_0x3b03d5(0x191)]?.['id']||0x0,'amountUSDT':Math[_0x3b03d5(0x2ba)](_0x5bd52b*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x3b03d5(0x2ba)](_0x50f7f0*0x64)/0x64,'commission':_0x358940};})),_0x43d4e1=_0x282333[_0x4e0013(0x16a)]((_0x537016,_0x388876)=>_0x537016+_0x388876[_0x4e0013(0x273)],0x0),_0x1a3597=_0x282333[_0x4e0013(0x16a)]((_0x26c529,_0x39c29f)=>_0x26c529+_0x39c29f[_0x4e0013(0x290)],0x0),_0x5c9c37=_0x54399c[_0x4e0013(0x171)];return console['log'](_0x4e0013(0x237)+_0x54399c[_0x4e0013(0x29a)]+':'),console['log'](_0x4e0013(0x25a)+_0x43d4e1['toFixed'](0x2)+_0x4e0013(0x174)),console[_0x4e0013(0x1d0)](_0x4e0013(0x1aa)+_0x1a3597['toFixed'](0x2)+_0x4e0013(0x2af)),console[_0x4e0013(0x1d0)](_0x4e0013(0x1ec)+_0x5c9c37[_0x4e0013(0x1c5)](0x2)+'\x20USDT\x20(current\x20balance\x20in\x20DB)'),console[_0x4e0013(0x1d0)](_0x4e0013(0x26e)+_0x15cdd0[_0x4e0013(0x1c5)](0x2)+_0x4e0013(0x177)),console['log'](_0x4e0013(0x1d7)+(_0x1a3597-_0x15cdd0-_0x5c9c37)[_0x4e0013(0x1c5)](0x2)+_0x4e0013(0x2ab)),{'id':_0x54399c['id'],'fullName':_0x54399c[_0x4e0013(0x1ad)],'username':_0x54399c[_0x4e0013(0x29a)],'telegramId':_0x54399c[_0x4e0013(0x186)],'merchantUrl':_0x54399c['shopUrl'],'wallets':{'usdtPolygonWallet':_0x54399c[_0x4e0013(0x2b9)],'usdtTrcWallet':_0x54399c[_0x4e0013(0x176)],'usdtErcWallet':_0x54399c[_0x4e0013(0x26d)],'usdcPolygonWallet':_0x54399c[_0x4e0013(0x23d)],'usdcErcWallet':_0x54399c['usdcErcWallet']},'totalAmountUSDT':Math[_0x4e0013(0x2ba)](_0x43d4e1*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x1a3597*0x64)/0x64,'currentBalance':Math[_0x4e0013(0x285)](_0x5c9c37*0x64)/0x64,'totalPayout':Math[_0x4e0013(0x2ba)](_0x15cdd0*0x64)/0x64,'thisMonth':Math['round'](_0x43e056*0x64)/0x64,'paymentsCount':_0x4309f6,'oldestPaymentDate':_0xf5237a?.[_0x4e0013(0x2c2)]||_0x54399c[_0x4e0013(0x263)],'gatewayBreakdown':_0x282333};})),_0x5629ed=_0x5f3335[_0x175bdc(0x16a)]((_0x1faaaf,_0x34007f)=>_0x1faaaf+_0x34007f[_0x175bdc(0x2c9)],0x0),_0xfa760=_0x5f3335['reduce']((_0x323a91,_0x5bb641)=>_0x323a91+_0x5bb641['totalAmountAfterCommissionUSDT'],0x0),_0x21eff4=_0x5f3335[_0x175bdc(0x16a)]((_0x32debd,_0x37af3f)=>_0x32debd+_0x37af3f[_0x175bdc(0x29f)],0x0),_0x12c951=_0x5f3335[_0x175bdc(0x16a)]((_0xa4d3d5,_0x28f675)=>_0xa4d3d5+_0x28f675['thisMonth'],0x0);return console[_0x175bdc(0x1d0)](_0x175bdc(0x264)+_0x338935+'\x20merchants'),console[_0x175bdc(0x1d0)](_0x175bdc(0x200)+Math[_0x175bdc(0x2ba)](_0x5629ed*0x64)/0x64+_0x175bdc(0x174)),console['log'](_0x175bdc(0x24c)+Math['round'](_0xfa760*0x64)/0x64+_0x175bdc(0x16f)),console[_0x175bdc(0x1d0)](_0x175bdc(0x2a1)+Math[_0x175bdc(0x2ba)](_0x21eff4*0x64)/0x64+'\x20USDT'),console[_0x175bdc(0x1d0)](_0x175bdc(0x212)+Math[_0x175bdc(0x2ba)](_0x12c951*0x64)/0x64+_0x175bdc(0x216)),{'merchants':_0x5f3335,'pagination':{'page':_0x279311,'limit':_0x4722bf,'total':_0x338935,'totalPages':Math[_0x175bdc(0x28a)](_0x338935/_0x4722bf)},'summary':{'totalMerchants':_0x338935,'totalAmountUSDT':Math[_0x175bdc(0x2ba)](_0x5629ed*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x175bdc(0x2ba)](_0xfa760*0x64)/0x64,'totalPayout':Math[_0x175bdc(0x2ba)](_0x21eff4*0x64)/0x64,'thisMonth':Math[_0x175bdc(0x2ba)](_0x12c951*0x64)/0x64}};}async['createPayout'](_0x53dadc){const _0x1699b5=a46_0x515ad2,{shopId:_0x440399,amount:_0x3bebe2,network:_0x35e628,wallet:_0x292ca3,notes:_0x419087,txid:_0x2a2791,periodFrom:_0x19a579,periodTo:_0x58eb2f}=_0x53dadc,_0x6bde6e=await database_1[_0x1699b5(0x235)]['$transaction'](async _0x246eca=>{const _0x240175=_0x1699b5,_0xb1f825=await _0x246eca[_0x240175(0x1c0)][_0x240175(0x23c)]({'where':{'id':_0x440399},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0xb1f825)throw new Error('Shop\x20not\x20found');console[_0x240175(0x1d0)](_0x240175(0x25e)+_0xb1f825['username']+':'),console['log']('\x20\x20\x20Current\x20balance:\x20'+_0xb1f825['balance'][_0x240175(0x1c5)](0x6)+_0x240175(0x216)),console['log'](_0x240175(0x25b)+_0x3bebe2[_0x240175(0x1c5)](0x6)+'\x20USDT'),console['log'](_0x240175(0x20d)+_0xb1f825[_0x240175(0x17b)]['toFixed'](0x6)+_0x240175(0x216));if(_0x2a2791)console['log'](_0x240175(0x2bf)+_0x2a2791);const _0x110a48=0.000001,_0x5c9472=Number(_0xb1f825[_0x240175(0x171)]),_0x4e840e=Number(_0x3bebe2);console[_0x240175(0x1d0)](_0x240175(0x173)),console[_0x240175(0x1d0)](_0x240175(0x1bd)+_0xb1f825[_0x240175(0x171)]),console[_0x240175(0x1d0)](_0x240175(0x254)+_0x5c9472),console[_0x240175(0x1d0)](_0x240175(0x207)+_0x4e840e),console[_0x240175(0x1d0)](_0x240175(0x1d2)+(_0x5c9472-_0x4e840e)),console[_0x240175(0x1d0)](_0x240175(0x21f)+_0x110a48);if(_0x5c9472<_0x4e840e-_0x110a48)throw new Error(_0x240175(0x185)+_0x5c9472[_0x240175(0x1c5)](0x6)+_0x240175(0x243)+_0x4e840e[_0x240175(0x1c5)](0x6)+'\x20USDT,\x20Difference:\x20'+(_0x5c9472-_0x4e840e)['toFixed'](0x8)+'\x20USDT');console['log'](_0x240175(0x258));const _0x275c0c=Math[_0x240175(0x287)](_0x5c9472,_0x4e840e);let _0x4955ad=_0x292ca3;console[_0x240175(0x1d0)](_0x240175(0x278)+(_0x292ca3||_0x240175(0x26b)));if(!_0x4955ad){console[_0x240175(0x1d0)]('ðŸ”\x20No\x20wallet\x20provided,\x20looking\x20up\x20from\x20shop\x20settings...');const _0xa70d95=await _0x246eca[_0x240175(0x1c0)][_0x240175(0x23c)]({'where':{'id':_0x440399},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});console['log'](_0x240175(0x2c5),_0xa70d95);if(_0xa70d95)switch(_0x35e628){case'polygon':_0x4955ad=_0xa70d95[_0x240175(0x2b9)]||undefined,console[_0x240175(0x1d0)](_0x240175(0x1ce)+_0x4955ad);break;case _0x240175(0x1bf):_0x4955ad=_0xa70d95[_0x240175(0x176)]||undefined,console[_0x240175(0x1d0)](_0x240175(0x2b7)+_0x4955ad);break;case _0x240175(0x1ca):_0x4955ad=_0xa70d95[_0x240175(0x26d)]||undefined,console[_0x240175(0x1d0)](_0x240175(0x18e)+_0x4955ad);break;case'polygon_usdc':_0x4955ad=_0xa70d95[_0x240175(0x23d)]||undefined,console[_0x240175(0x1d0)]('ðŸ”\x20Selected\x20polygon_usdc\x20wallet:\x20'+_0x4955ad);break;case _0x240175(0x16d):_0x4955ad=_0xa70d95[_0x240175(0x232)]||undefined,console[_0x240175(0x1d0)](_0x240175(0x202)+_0x4955ad);break;}}else console[_0x240175(0x1d0)](_0x240175(0x179)+_0x4955ad);console[_0x240175(0x1d0)](_0x240175(0x265)+_0x35e628+':\x20'+(_0x4955ad||_0x240175(0x2a4))),console[_0x240175(0x1d0)](_0x240175(0x274),{'shopId':_0x440399,'amount':_0x275c0c,'network':_0x35e628,'wallet':_0x4955ad,'status':_0x240175(0x15d),'txid':_0x2a2791,'notes':_0x419087,'periodFrom':_0x19a579?new Date(_0x19a579):null,'periodTo':_0x58eb2f?new Date(_0x58eb2f):null});const _0x23e52c=await _0x246eca['payout'][_0x240175(0x15f)]({'data':{'shopId':_0x440399,'amount':_0x275c0c,'network':_0x35e628,'wallet':_0x4955ad,'status':'COMPLETED','txid':_0x2a2791,'notes':_0x419087,'periodFrom':_0x19a579?new Date(_0x19a579):null,'periodTo':_0x58eb2f?new Date(_0x58eb2f):null,'createdAt':new Date(),'paidAt':new Date()}});console[_0x240175(0x1d0)](_0x240175(0x28e),{'id':_0x23e52c['id'],'wallet':_0x23e52c[_0x240175(0x16c)],'network':_0x23e52c[_0x240175(0x1e9)],'amount':_0x23e52c[_0x240175(0x238)]});const _0x327d04=_0x5c9472-_0x275c0c,_0x1041f2=Number(_0xb1f825[_0x240175(0x17b)])+_0x275c0c;return await _0x246eca[_0x240175(0x1c0)][_0x240175(0x28d)]({'where':{'id':_0x440399},'data':{'balance':_0x327d04,'totalPaidOut':_0x1041f2}}),console['log'](_0x240175(0x17d)+_0xb1f825[_0x240175(0x29a)]+'\x20balance\x20updated:'),console[_0x240175(0x1d0)](_0x240175(0x1b7)+_0x5c9472['toFixed'](0x6)+_0x240175(0x251)+_0x327d04[_0x240175(0x1c5)](0x6)+_0x240175(0x198)+_0x275c0c[_0x240175(0x1c5)](0x6)+')'),console[_0x240175(0x1d0)](_0x240175(0x21c)+_0xb1f825[_0x240175(0x17b)][_0x240175(0x1c5)](0x6)+_0x240175(0x251)+_0x1041f2[_0x240175(0x1c5)](0x6)+'\x20USDT\x20(+'+_0x275c0c[_0x240175(0x1c5)](0x6)+')'),console[_0x240175(0x1d0)](_0x240175(0x2a0)+_0x275c0c[_0x240175(0x1c5)](0x6)+_0x240175(0x216)),{'payout':_0x23e52c,'shop':_0xb1f825};});console['log'](_0x1699b5(0x1ff)+_0x6bde6e['payout']['id']+_0x1699b5(0x19b)+_0x6bde6e[_0x1699b5(0x1c0)][_0x1699b5(0x29a)]+'\x20('+_0x6bde6e[_0x1699b5(0x239)][_0x1699b5(0x238)][_0x1699b5(0x1c5)](0x6)+_0x1699b5(0x229));try{let _0x175c9a=_0x1699b5(0x2b2);if(_0x6bde6e[_0x1699b5(0x239)][_0x1699b5(0x24f)]&&_0x6bde6e[_0x1699b5(0x239)][_0x1699b5(0x2ca)]){const _0x5314d2=new Date(_0x6bde6e[_0x1699b5(0x239)]['periodFrom'])[_0x1699b5(0x227)]('ru-RU'),_0x427086=new Date(_0x6bde6e[_0x1699b5(0x239)][_0x1699b5(0x2ca)])['toLocaleDateString'](_0x1699b5(0x240));_0x175c9a=_0x5314d2+_0x1699b5(0x224)+_0x427086;}await telegramBotService_1[_0x1699b5(0x23f)]['sendPayoutNotification'](_0x6bde6e[_0x1699b5(0x239)][_0x1699b5(0x281)],{'id':_0x6bde6e[_0x1699b5(0x239)]['id'],'amount':_0x6bde6e[_0x1699b5(0x239)][_0x1699b5(0x238)],'network':_0x6bde6e['payout'][_0x1699b5(0x1e9)],'wallet':_0x6bde6e[_0x1699b5(0x239)][_0x1699b5(0x16c)],'period':_0x175c9a,'createdAt':_0x6bde6e['payout'][_0x1699b5(0x263)],'txid':_0x6bde6e[_0x1699b5(0x239)][_0x1699b5(0x182)]}),console['log'](_0x1699b5(0x1b5)+_0x6bde6e[_0x1699b5(0x239)]['id']);}catch(_0xcdbed0){console[_0x1699b5(0x1b0)](_0x1699b5(0x1c6)+_0x6bde6e[_0x1699b5(0x239)]['id']+':',_0xcdbed0);}return{'id':_0x6bde6e[_0x1699b5(0x239)]['id'],'shopId':_0x6bde6e[_0x1699b5(0x239)][_0x1699b5(0x281)],'shopName':_0x6bde6e['shop'][_0x1699b5(0x1ad)],'shopUsername':_0x6bde6e[_0x1699b5(0x1c0)][_0x1699b5(0x29a)],'amount':_0x6bde6e[_0x1699b5(0x239)][_0x1699b5(0x238)],'network':_0x6bde6e[_0x1699b5(0x239)][_0x1699b5(0x1e9)],'wallet':_0x6bde6e[_0x1699b5(0x239)]['wallet'],'status':_0x6bde6e[_0x1699b5(0x239)][_0x1699b5(0x18b)],'txid':_0x6bde6e[_0x1699b5(0x239)][_0x1699b5(0x182)],'notes':_0x6bde6e[_0x1699b5(0x239)][_0x1699b5(0x23b)],'periodFrom':_0x6bde6e[_0x1699b5(0x239)][_0x1699b5(0x24f)],'periodTo':_0x6bde6e[_0x1699b5(0x239)]['periodTo'],'createdAt':_0x6bde6e[_0x1699b5(0x239)]['createdAt'],'paidAt':_0x6bde6e[_0x1699b5(0x239)][_0x1699b5(0x2c2)]};}async[a46_0x515ad2(0x292)](_0x17febe){const _0x326ba8=a46_0x515ad2,{page:_0x1ba7fe,limit:_0x45393c,shopId:_0x47bf9e,network:_0x324390,dateFrom:_0x3b2b48,dateTo:_0x19f823,search:_0x5ba4bf}=_0x17febe,_0x439aa0=(_0x1ba7fe-0x1)*_0x45393c,_0x555302={};_0x47bf9e&&(_0x555302[_0x326ba8(0x281)]=_0x47bf9e);_0x324390&&(_0x555302['network']=_0x324390);if(_0x3b2b48||_0x19f823){_0x555302[_0x326ba8(0x263)]={};if(_0x3b2b48){const _0x11e2c5=new Date(_0x3b2b48);_0x11e2c5[_0x326ba8(0x25f)](0x0,0x0,0x0,0x1),_0x555302[_0x326ba8(0x263)][_0x326ba8(0x16b)]=_0x11e2c5,console[_0x326ba8(0x1d0)]('ðŸ“…\x20Payout\x20date\x20from\x20filter:\x20'+_0x11e2c5['toISOString']());}if(_0x19f823){const _0x562395=new Date(_0x19f823);_0x562395[_0x326ba8(0x25f)](0x17,0x3b,0x3b,0x3e7),_0x555302['createdAt'][_0x326ba8(0x187)]=_0x562395,console[_0x326ba8(0x1d0)](_0x326ba8(0x2c6)+_0x562395['toISOString']());}}_0x5ba4bf&&(_0x555302['OR']=[{'shop':{'name':{'contains':_0x5ba4bf,'mode':_0x326ba8(0x1eb)}}},{'shop':{'username':{'contains':_0x5ba4bf,'mode':_0x326ba8(0x1eb)}}},{'notes':{'contains':_0x5ba4bf,'mode':_0x326ba8(0x1eb)}}]);const [_0x312b7a,_0x1aaae3]=await Promise[_0x326ba8(0x282)]([database_1[_0x326ba8(0x235)][_0x326ba8(0x239)]['findMany']({'where':_0x555302,'skip':_0x439aa0,'take':_0x45393c,'orderBy':{'createdAt':_0x326ba8(0x1fa)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'wallet':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x326ba8(0x239)]['count']({'where':_0x555302})]);return{'payouts':_0x312b7a['map'](_0x310f7e=>({'id':_0x310f7e['id'],'shopId':_0x310f7e['shopId'],'shopName':_0x310f7e[_0x326ba8(0x1c0)][_0x326ba8(0x1ad)],'shopUsername':_0x310f7e[_0x326ba8(0x1c0)]['username'],'amount':_0x310f7e['amount'],'network':_0x310f7e['network'],'wallet':_0x310f7e[_0x326ba8(0x16c)],'status':_0x310f7e[_0x326ba8(0x18b)],'txid':_0x310f7e[_0x326ba8(0x182)],'notes':_0x310f7e[_0x326ba8(0x23b)],'periodFrom':_0x310f7e[_0x326ba8(0x24f)],'periodTo':_0x310f7e[_0x326ba8(0x2ca)],'createdAt':_0x310f7e[_0x326ba8(0x263)],'paidAt':_0x310f7e[_0x326ba8(0x2c2)]})),'pagination':{'page':_0x1ba7fe,'limit':_0x45393c,'total':_0x1aaae3,'totalPages':Math[_0x326ba8(0x28a)](_0x1aaae3/_0x45393c)}};}async[a46_0x515ad2(0x25c)](_0x14daba){const _0x25411b=a46_0x515ad2,_0x204d51=await database_1[_0x25411b(0x235)][_0x25411b(0x239)][_0x25411b(0x23c)]({'where':{'id':_0x14daba},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x204d51)return null;return{'id':_0x204d51['id'],'shopId':_0x204d51[_0x25411b(0x281)],'shopName':_0x204d51[_0x25411b(0x1c0)][_0x25411b(0x1ad)],'shopUsername':_0x204d51['shop'][_0x25411b(0x29a)],'amount':_0x204d51[_0x25411b(0x238)],'network':_0x204d51['network'],'wallet':_0x204d51[_0x25411b(0x16c)],'status':_0x204d51['status'],'txid':_0x204d51[_0x25411b(0x182)],'notes':_0x204d51[_0x25411b(0x23b)],'periodFrom':_0x204d51[_0x25411b(0x24f)],'periodTo':_0x204d51[_0x25411b(0x2ca)],'createdAt':_0x204d51['createdAt'],'paidAt':_0x204d51[_0x25411b(0x2c2)]};}async[a46_0x515ad2(0x201)](_0x37f841){const _0xbeb199=a46_0x515ad2;await database_1[_0xbeb199(0x235)][_0xbeb199(0x239)]['delete']({'where':{'id':_0x37f841}});}async[a46_0x515ad2(0x1f5)](_0x53f7d3){const _0x392122=a46_0x515ad2,{page:_0x16c9a7,limit:_0x17bd74,status:_0x51ae5c,gateway:_0x5ddf3e,shopId:_0x131f76,dateFrom:_0xd7ccb9,dateTo:_0x4ca955,search:_0x8c2b15,currency:_0xdd7564,sortBy:_0x36b015,sortOrder:_0x27999e}=_0x53f7d3,_0x5f05fe=(_0x16c9a7-0x1)*_0x17bd74;console[_0x392122(0x1d0)](_0x392122(0x2a5),_0x53f7d3);const _0xfc444f=await database_1[_0x392122(0x235)]['payment'][_0x392122(0x1f7)]({'by':[_0x392122(0x280)],'_count':{'gateway':!![]}});console[_0x392122(0x1d0)](_0x392122(0x1b9),_0xfc444f[_0x392122(0x2b4)](_0x50e218=>_0x50e218['gateway']+'\x20('+_0x50e218[_0x392122(0x191)]['gateway']+_0x392122(0x1e6)));if(_0x5ddf3e){const _0x2b7e8f=_0xfc444f[_0x392122(0x1fe)](_0x5d305b=>_0x5d305b['gateway']['toLowerCase']()===_0x5ddf3e[_0x392122(0x19d)]());!_0x2b7e8f&&_0x5ddf3e['toLowerCase']()!==_0x392122(0x1ab)&&console[_0x392122(0x1d0)](_0x392122(0x20c)+_0x5ddf3e+_0x392122(0x17f)+_0xfc444f[_0x392122(0x2b4)](_0x51d83b=>_0x51d83b['gateway'])[_0x392122(0x215)](',\x20'));}const _0x4e7bbb={};_0x51ae5c&&(_0x4e7bbb[_0x392122(0x18b)]=_0x51ae5c[_0x392122(0x2a3)]());if(!_0x5ddf3e)_0x4e7bbb['gateway']={'not':_0x392122(0x1ab)};else{if(_0x5ddf3e&&(_0x5ddf3e[_0x392122(0x19d)]()===_0x392122(0x1ab)||_0x5ddf3e===_0x392122(0x255)))_0x4e7bbb['gateway']=_0x392122(0x1ab);else{let _0x1ae5f1=_0x5ddf3e;const _0x57aad3=(0x0,gateway_1[_0x392122(0x230)])(_0x5ddf3e);if(_0x57aad3)_0x1ae5f1=_0x57aad3,console[_0x392122(0x1d0)](_0x392122(0x1f0)+_0x5ddf3e+_0x392122(0x298)+_0x1ae5f1+'\x27');else{const _0x54b8c6=(0x0,gateway_1[_0x392122(0x291)])(_0x5ddf3e);if(_0x54b8c6){const _0x369cca=(0x0,gateway_1[_0x392122(0x230)])(_0x54b8c6);_0x369cca&&(_0x1ae5f1=_0x369cca,console[_0x392122(0x1d0)](_0x392122(0x23a)+_0x5ddf3e+_0x392122(0x1f6)+_0x54b8c6+_0x392122(0x294)+_0x1ae5f1+'\x27'));}else console[_0x392122(0x1d0)](_0x392122(0x2ae)+_0x5ddf3e+_0x392122(0x27a));}const _0x5b1069=await database_1['default'][_0x392122(0x1c7)][_0x392122(0x22e)]({'where':{'gateway':_0x1ae5f1['toLowerCase']()},'take':0x1});_0x5b1069===0x0?(console['log'](_0x392122(0x22a)+_0x1ae5f1+_0x392122(0x1af)+_0x5ddf3e+_0x392122(0x1c9)),_0x4e7bbb[_0x392122(0x280)]='NONEXISTENT_GATEWAY_FILTER'):(_0x4e7bbb[_0x392122(0x280)]=_0x1ae5f1['toLowerCase'](),console[_0x392122(0x1d0)](_0x392122(0x1e4)+_0x1ae5f1+_0x392122(0x1af)+_0x5ddf3e+'\x27)'));}}console[_0x392122(0x1d0)](_0x392122(0x277),_0x4e7bbb[_0x392122(0x280)]);_0x131f76&&(_0x4e7bbb['shopId']=_0x131f76);_0xdd7564&&(_0x4e7bbb[_0x392122(0x268)]=_0xdd7564[_0x392122(0x2a3)](),console[_0x392122(0x1d0)](_0x392122(0x1da)+_0xdd7564[_0x392122(0x2a3)]()));if(_0xd7ccb9||_0x4ca955){_0x4e7bbb[_0x392122(0x263)]={};if(_0xd7ccb9){const _0x540c4d=new Date(_0xd7ccb9);_0x540c4d[_0x392122(0x25f)](0x0,0x0,0x0,0x1),_0x4e7bbb['createdAt']['gte']=_0x540c4d,console[_0x392122(0x1d0)](_0x392122(0x163)+_0x540c4d[_0x392122(0x23e)]());}if(_0x4ca955){const _0x24f4aa=new Date(_0x4ca955);_0x24f4aa['setHours'](0x17,0x3b,0x3b,0x3e7),_0x4e7bbb[_0x392122(0x263)][_0x392122(0x187)]=_0x24f4aa,console[_0x392122(0x1d0)](_0x392122(0x208)+_0x24f4aa[_0x392122(0x23e)]());}}_0x8c2b15&&(_0x4e7bbb['OR']=[{'id':{'contains':_0x8c2b15,'mode':'insensitive'}},{'orderId':{'contains':_0x8c2b15,'mode':_0x392122(0x1eb)}},{'gatewayOrderId':{'contains':_0x8c2b15,'mode':'insensitive'}},{'customerEmail':{'contains':_0x8c2b15,'mode':'insensitive'}},{'shop':{'name':{'contains':_0x8c2b15,'mode':_0x392122(0x1eb)}}},{'shop':{'username':{'contains':_0x8c2b15,'mode':_0x392122(0x1eb)}}}]);console[_0x392122(0x1d0)](_0x392122(0x190),JSON[_0x392122(0x167)](_0x4e7bbb,null,0x2));let _0x498ff7={'createdAt':_0x392122(0x1fa)};if(_0x36b015){const _0x3b7516=[_0x392122(0x238),_0x392122(0x263),_0x392122(0x1dc),_0x392122(0x18b),_0x392122(0x280),_0x392122(0x268)],_0x849770=[_0x392122(0x27f),_0x392122(0x1fa)];if(_0x3b7516[_0x392122(0x245)](_0x36b015)){const _0x24390d=_0x849770[_0x392122(0x245)](_0x27999e)?_0x27999e:_0x392122(0x1fa);_0x498ff7={[_0x36b015]:_0x24390d},console['log'](_0x392122(0x266)+_0x36b015+'\x20in\x20'+_0x24390d+'\x20order');}}const [_0x3534e2,_0x1641e1]=await Promise[_0x392122(0x282)]([database_1[_0x392122(0x235)][_0x392122(0x1c7)][_0x392122(0x1f8)]({'where':_0x4e7bbb,'skip':_0x5f05fe,'take':_0x17bd74,'orderBy':_0x498ff7,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x392122(0x235)][_0x392122(0x1c7)][_0x392122(0x22e)]({'where':_0x4e7bbb})]);return{'payments':_0x3534e2,'pagination':{'page':_0x16c9a7,'limit':_0x17bd74,'total':_0x1641e1,'totalPages':Math[_0x392122(0x28a)](_0x1641e1/_0x17bd74)}};}async['getPaymentById'](_0x4f4f65){const _0x42abb4=a46_0x515ad2,_0x186226=await database_1[_0x42abb4(0x235)][_0x42abb4(0x1c7)][_0x42abb4(0x23c)]({'where':{'id':_0x4f4f65},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x186226)return null;return{'id':_0x186226['id'],'shopId':_0x186226[_0x42abb4(0x281)],'gateway':_0x186226[_0x42abb4(0x280)],'amount':_0x186226[_0x42abb4(0x238)],'currency':_0x186226[_0x42abb4(0x268)],'status':_0x186226[_0x42abb4(0x18b)],'orderId':_0x186226[_0x42abb4(0x2c8)],'gatewayOrderId':_0x186226[_0x42abb4(0x1fd)],'customerEmail':_0x186226[_0x42abb4(0x184)],'customerName':_0x186226[_0x42abb4(0x1c3)],'customerCountry':_0x186226[_0x42abb4(0x2ac)],'customerIp':_0x186226[_0x42abb4(0x206)],'customerUa':_0x186226[_0x42abb4(0x29c)],'failureMessage':_0x186226['failureMessage'],'externalPaymentUrl':_0x186226['externalPaymentUrl'],'successUrl':_0x186226[_0x42abb4(0x288)],'failUrl':_0x186226[_0x42abb4(0x223)],'pendingUrl':_0x186226[_0x42abb4(0x195)],'whiteUrl':_0x186226['whiteUrl'],'createdAt':_0x186226['createdAt'],'updatedAt':_0x186226['updatedAt'],'shop':_0x186226[_0x42abb4(0x1c0)]};}async[a46_0x515ad2(0x29d)](_0x1b622b,_0x5f1c53,_0x2c673d,_0x9641bb){const _0xcf4970=a46_0x515ad2,_0x1e2946=await database_1[_0xcf4970(0x235)][_0xcf4970(0x286)](async _0x41e6de=>{const _0x5a9dd5=_0xcf4970,_0x360c80=await _0x41e6de[_0x5a9dd5(0x1c7)][_0x5a9dd5(0x23c)]({'where':{'id':_0x1b622b},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x360c80)throw new Error(_0x5a9dd5(0x24b));const _0x2aa71c=_0x360c80[_0x5a9dd5(0x18b)],_0x25e0e5=_0x5f1c53[_0x5a9dd5(0x2a3)]();console[_0x5a9dd5(0x1d0)](_0x5a9dd5(0x18c)+_0x1b622b+_0x5a9dd5(0x228)+_0x2aa71c+'\x20->\x20'+_0x25e0e5),console[_0x5a9dd5(0x1d0)]('ðŸ’°\x20Current\x20shop\x20balance:\x20'+_0x360c80[_0x5a9dd5(0x1c0)]['balance']+_0x5a9dd5(0x216));const _0x3c38bf={'status':_0x25e0e5,'updatedAt':new Date(),'statusChangedBy':_0x5a9dd5(0x247),'statusChangedAt':new Date()};_0x2c673d&&(_0x3c38bf[_0x5a9dd5(0x28c)]=_0x2c673d);_0x25e0e5===_0x5a9dd5(0x16e)&&_0x9641bb&&(_0x3c38bf[_0x5a9dd5(0x1d9)]=_0x9641bb);let _0x3071b7=0x0,_0x1479c1=_0x360c80[_0x5a9dd5(0x1c0)][_0x5a9dd5(0x171)];if(_0x25e0e5==='PAID'&&_0x2aa71c!==_0x5a9dd5(0x160)){_0x3c38bf[_0x5a9dd5(0x2c2)]=new Date();const _0x16d72d=await currencyService_1[_0x5a9dd5(0x28b)][_0x5a9dd5(0x2bd)](_0x360c80[_0x5a9dd5(0x238)],_0x360c80[_0x5a9dd5(0x268)]);_0x3c38bf['amountUSDT']=_0x16d72d;let _0x205dc2=0x2d;const _0x3806ef=await _0x41e6de[_0x5a9dd5(0x1c0)][_0x5a9dd5(0x23c)]({'where':{'id':_0x360c80['shopId']},'select':{'gatewaySettings':!![]}});if(_0x3806ef?.['gatewaySettings'])try{const _0x22282b=JSON[_0x5a9dd5(0x1b6)](_0x3806ef[_0x5a9dd5(0x21d)]);for(const [_0x289c30,_0x4dff32]of Object[_0x5a9dd5(0x19a)](_0x22282b)){if(_0x289c30['toLowerCase']()===_0x360c80[_0x5a9dd5(0x280)][_0x5a9dd5(0x19d)]()){_0x205dc2=_0x4dff32[_0x5a9dd5(0x297)]||0xa;break;}}}catch(_0x1ee633){console[_0x5a9dd5(0x1b0)]('Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20'+_0x1b622b+':',_0x1ee633);}let _0x57d275;_0x360c80[_0x5a9dd5(0x20f)]!==null&&_0x360c80[_0x5a9dd5(0x20f)]!==undefined?(_0x57d275=_0x360c80['amountAfterGatewayCommissionUSDT'],console[_0x5a9dd5(0x1d0)](_0x5a9dd5(0x183)+_0x57d275['toFixed'](0x6)+'\x20USDT\x20for\x20payment\x20'+_0x1b622b)):(_0x57d275=_0x16d72d*(0x1-_0x205dc2/0x64),console[_0x5a9dd5(0x1d0)](_0x5a9dd5(0x199)+_0x1b622b+':\x20'+_0x205dc2+_0x5a9dd5(0x289)+_0x16d72d[_0x5a9dd5(0x1c5)](0x6)+'\x20USDT'),_0x3c38bf[_0x5a9dd5(0x20f)]=_0x57d275,_0x3c38bf['gatewayCommissionRate']=_0x205dc2),_0x3071b7=_0x57d275,_0x1479c1+=_0x57d275,console['log'](_0x5a9dd5(0x1f3)+_0x1b622b+'\x20became\x20PAID:'),console[_0x5a9dd5(0x1d0)](_0x5a9dd5(0x272)+_0x16d72d[_0x5a9dd5(0x1c5)](0x6)+_0x5a9dd5(0x216)),console['log'](_0x5a9dd5(0x26c)+_0x360c80['gateway']+_0x5a9dd5(0x1cc)+_0x205dc2+'%'),console['log'](_0x5a9dd5(0x203)+_0x57d275[_0x5a9dd5(0x1c5)](0x6)+_0x5a9dd5(0x283)+_0x205dc2+'%\x20commission)'),console[_0x5a9dd5(0x1d0)](_0x5a9dd5(0x1a0)+_0x57d275[_0x5a9dd5(0x1c5)](0x6)+'\x20USDT');}else{if(_0x2aa71c===_0x5a9dd5(0x160)&&_0x25e0e5!==_0x5a9dd5(0x160)&&_0x25e0e5!==_0x5a9dd5(0x16e)){if(_0x360c80[_0x5a9dd5(0x273)]){let _0x4183b9=0x2d;const _0x7524ca=await _0x41e6de[_0x5a9dd5(0x1c0)][_0x5a9dd5(0x23c)]({'where':{'id':_0x360c80['shopId']},'select':{'gatewaySettings':!![]}});if(_0x7524ca?.[_0x5a9dd5(0x21d)])try{const _0x2d447d=JSON[_0x5a9dd5(0x1b6)](_0x7524ca[_0x5a9dd5(0x21d)]);for(const [_0x58308b,_0x528581]of Object[_0x5a9dd5(0x19a)](_0x2d447d)){if(_0x58308b[_0x5a9dd5(0x19d)]()===_0x360c80[_0x5a9dd5(0x280)]['toLowerCase']()){_0x4183b9=_0x528581[_0x5a9dd5(0x297)]||0xa;break;}}}catch(_0x7cc939){console['error'](_0x5a9dd5(0x1e3)+_0x1b622b+':',_0x7cc939);}const _0x48b76d=_0x360c80[_0x5a9dd5(0x273)]*(0x1-_0x4183b9/0x64);_0x3071b7=-_0x48b76d,_0x1479c1-=_0x48b76d,console['log']('\x20\x20\x20Full\x20amount:\x20'+_0x360c80[_0x5a9dd5(0x273)][_0x5a9dd5(0x1c5)](0x6)+_0x5a9dd5(0x216)),console[_0x5a9dd5(0x1d0)](_0x5a9dd5(0x26c)+_0x360c80[_0x5a9dd5(0x280)]+_0x5a9dd5(0x1cc)+_0x4183b9+'%'),console[_0x5a9dd5(0x1d0)](_0x5a9dd5(0x296)+_0x48b76d[_0x5a9dd5(0x1c5)](0x6)+_0x5a9dd5(0x283)+_0x4183b9+_0x5a9dd5(0x214)),console[_0x5a9dd5(0x1d0)](_0x5a9dd5(0x19e)+_0x48b76d[_0x5a9dd5(0x1c5)](0x6)+_0x5a9dd5(0x216));}}}_0x25e0e5===_0x5a9dd5(0x16e)&&(console[_0x5a9dd5(0x1d0)](_0x5a9dd5(0x2b3)),_0x9641bb&&_0x9641bb>0x0?(_0x3071b7=-_0x9641bb,_0x1479c1-=_0x9641bb,console[_0x5a9dd5(0x1d0)]('ðŸ’¸\x20CHARGEBACK\x20penalty\x20ONLY:\x20-'+_0x9641bb['toFixed'](0x6)+_0x5a9dd5(0x2c4)),console[_0x5a9dd5(0x1d0)](_0x5a9dd5(0x256))):console[_0x5a9dd5(0x1d0)](_0x5a9dd5(0x20b)),_0x3c38bf[_0x5a9dd5(0x1d9)]=_0x9641bb||0x0);_0x25e0e5===_0x5a9dd5(0x2a2)&&_0x2aa71c===_0x5a9dd5(0x160)&&console[_0x5a9dd5(0x1d0)]('ðŸ”„\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance');const _0x5f5d8f=await _0x41e6de[_0x5a9dd5(0x1c7)]['update']({'where':{'id':_0x1b622b},'data':_0x3c38bf,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x3071b7!==0x0&&(await _0x41e6de[_0x5a9dd5(0x1c0)]['update']({'where':{'id':_0x360c80[_0x5a9dd5(0x281)]},'data':{'balance':_0x1479c1}}),console[_0x5a9dd5(0x1d0)](_0x5a9dd5(0x17d)+_0x360c80[_0x5a9dd5(0x281)]+_0x5a9dd5(0x2be)+_0x360c80[_0x5a9dd5(0x1c0)]['balance'][_0x5a9dd5(0x1c5)](0x6)+'\x20->\x20'+_0x1479c1[_0x5a9dd5(0x1c5)](0x6)+_0x5a9dd5(0x1e8)+(_0x3071b7>0x0?'+':'')+_0x3071b7[_0x5a9dd5(0x1c5)](0x6)+')')),_0x5f5d8f;});return{'id':_0x1e2946['id'],'shopId':_0x1e2946['shopId'],'gateway':_0x1e2946[_0xcf4970(0x280)],'amount':_0x1e2946[_0xcf4970(0x238)],'currency':_0x1e2946['currency'],'status':_0x1e2946[_0xcf4970(0x18b)],'orderId':_0x1e2946['orderId'],'gatewayOrderId':_0x1e2946[_0xcf4970(0x1fd)],'customerEmail':_0x1e2946[_0xcf4970(0x184)],'customerName':_0x1e2946['customerName'],'customerCountry':_0x1e2946[_0xcf4970(0x2ac)],'customerIp':_0x1e2946['customerIp'],'customerUa':_0x1e2946[_0xcf4970(0x29c)],'failureMessage':_0x1e2946[_0xcf4970(0x1f4)],'adminNotes':_0x1e2946['adminNotes'],'chargebackAmount':_0x1e2946[_0xcf4970(0x1d9)],'statusChangedBy':_0x1e2946[_0xcf4970(0x1d4)],'statusChangedAt':_0x1e2946['statusChangedAt'],'createdAt':_0x1e2946[_0xcf4970(0x263)],'updatedAt':_0x1e2946[_0xcf4970(0x1dc)],'shop':_0x1e2946[_0xcf4970(0x1c0)]};}async[a46_0x515ad2(0x193)](_0x3abaf5,_0x25c208){const _0x2c68df=a46_0x515ad2,_0x2a61ca=Math['random']()['toString'](0x24)[_0x2c68df(0x261)](0x2,0x9);console['log'](_0x2c68df(0x1ba)+_0x2a61ca+',\x20userId:\x20'+_0x3abaf5);const _0x1471a4={..._0x25c208};_0x25c208['password']&&_0x25c208[_0x2c68df(0x168)]['trim']()!==''?(console[_0x2c68df(0x1d0)](_0x2c68df(0x1c2)+_0x2a61ca+_0x2c68df(0x1c4)+_0x3abaf5),_0x1471a4[_0x2c68df(0x168)]=await bcryptjs_1[_0x2c68df(0x235)][_0x2c68df(0x2b0)](_0x25c208['password'],0xc)):(console['log'](_0x2c68df(0x1c2)+_0x2a61ca+']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update'),delete _0x1471a4[_0x2c68df(0x168)]);_0x25c208[_0x2c68df(0x26f)]&&(_0x1471a4[_0x2c68df(0x1ad)]=_0x25c208['fullName'],delete _0x1471a4[_0x2c68df(0x26f)]);_0x25c208['telegramId']&&(_0x1471a4[_0x2c68df(0x186)]=_0x25c208[_0x2c68df(0x17a)],delete _0x1471a4['telegramId']);_0x25c208[_0x2c68df(0x233)]&&(_0x1471a4[_0x2c68df(0x2b8)]=_0x25c208[_0x2c68df(0x233)],delete _0x1471a4['merchantUrl']);if(_0x25c208[_0x2c68df(0x2aa)]){const _0x5394c3=_0x25c208['gateways'][_0x2c68df(0x2b4)](_0x1c50d3=>this[_0x2c68df(0x2a8)](_0x1c50d3));console[_0x2c68df(0x1d0)]('ðŸ”„\x20Gateway\x20mapping:',_0x25c208[_0x2c68df(0x2aa)],'->',_0x5394c3),_0x1471a4['paymentGateways']=JSON[_0x2c68df(0x167)](_0x5394c3),delete _0x1471a4['gateways'];}_0x25c208[_0x2c68df(0x21d)]&&(console['log'](_0x2c68df(0x17c)+_0x2a61ca+_0x2c68df(0x2ad),_0x25c208['gatewaySettings']),_0x1471a4['gatewaySettings']=JSON[_0x2c68df(0x167)](_0x25c208['gatewaySettings']),console[_0x2c68df(0x1d0)](_0x2c68df(0x17c)+_0x2a61ca+']\x20Gateway\x20settings\x20JSON\x20string:',_0x1471a4[_0x2c68df(0x21d)]));_0x25c208['wallets']&&(_0x25c208[_0x2c68df(0x1db)][_0x2c68df(0x2b9)]!==undefined&&(_0x1471a4[_0x2c68df(0x2b9)]=_0x25c208[_0x2c68df(0x1db)][_0x2c68df(0x2b9)]||null),_0x25c208['wallets'][_0x2c68df(0x176)]!==undefined&&(_0x1471a4[_0x2c68df(0x176)]=_0x25c208['wallets'][_0x2c68df(0x176)]||null),_0x25c208[_0x2c68df(0x1db)]['usdtErcWallet']!==undefined&&(_0x1471a4[_0x2c68df(0x26d)]=_0x25c208[_0x2c68df(0x1db)][_0x2c68df(0x26d)]||null),_0x25c208[_0x2c68df(0x1db)]['usdcPolygonWallet']!==undefined&&(_0x1471a4[_0x2c68df(0x23d)]=_0x25c208[_0x2c68df(0x1db)]['usdcPolygonWallet']||null),delete _0x1471a4['wallets']);const _0x4db79a=await database_1[_0x2c68df(0x235)][_0x2c68df(0x1c0)][_0x2c68df(0x28d)]({'where':{'id':_0x3abaf5},'data':_0x1471a4,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console['log'](_0x2c68df(0x253)+_0x2a61ca+_0x2c68df(0x24e),_0x4db79a['gatewaySettings']),{'id':_0x4db79a['id'],'fullName':_0x4db79a['name'],'username':_0x4db79a[_0x2c68df(0x29a)],'telegramId':_0x4db79a[_0x2c68df(0x186)],'merchantUrl':_0x4db79a[_0x2c68df(0x2b8)],'gateways':_0x4db79a[_0x2c68df(0x1d3)]?JSON['parse'](_0x4db79a[_0x2c68df(0x1d3)]):null,'gatewaySettings':_0x4db79a[_0x2c68df(0x21d)]?JSON[_0x2c68df(0x1b6)](_0x4db79a[_0x2c68df(0x21d)]):null,'publicKey':_0x4db79a[_0x2c68df(0x1bc)],'wallets':{'usdtPolygonWallet':_0x4db79a[_0x2c68df(0x2b9)],'usdtTrcWallet':_0x4db79a[_0x2c68df(0x176)],'usdtErcWallet':_0x4db79a['usdtErcWallet'],'usdcPolygonWallet':_0x4db79a['usdcPolygonWallet']},'status':_0x4db79a[_0x2c68df(0x18b)],'createdAt':_0x4db79a[_0x2c68df(0x263)]};}async[a46_0x515ad2(0x1bb)](_0x4787df){const _0x5bcedc=a46_0x515ad2,_0x3ce7c3=await database_1[_0x5bcedc(0x235)][_0x5bcedc(0x1c0)][_0x5bcedc(0x28d)]({'where':{'id':_0x4787df},'data':{'status':_0x5bcedc(0x241)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x3ce7c3['id'],'fullName':_0x3ce7c3[_0x5bcedc(0x1ad)],'username':_0x3ce7c3[_0x5bcedc(0x29a)],'telegramId':_0x3ce7c3['telegram'],'merchantUrl':_0x3ce7c3[_0x5bcedc(0x2b8)],'gateways':_0x3ce7c3[_0x5bcedc(0x1d3)]?JSON[_0x5bcedc(0x1b6)](_0x3ce7c3['paymentGateways']):null,'gatewaySettings':_0x3ce7c3['gatewaySettings']?JSON['parse'](_0x3ce7c3['gatewaySettings']):null,'publicKey':_0x3ce7c3[_0x5bcedc(0x1bc)],'wallets':{'usdtPolygonWallet':_0x3ce7c3[_0x5bcedc(0x2b9)],'usdtTrcWallet':_0x3ce7c3[_0x5bcedc(0x176)],'usdtErcWallet':_0x3ce7c3['usdtErcWallet'],'usdcPolygonWallet':_0x3ce7c3['usdcPolygonWallet']},'status':_0x3ce7c3[_0x5bcedc(0x18b)],'createdAt':_0x3ce7c3[_0x5bcedc(0x263)]};}async[a46_0x515ad2(0x1d1)](_0x3854b5){const _0x1181bc=a46_0x515ad2,_0x289ec7=await database_1['default'][_0x1181bc(0x1c0)][_0x1181bc(0x28d)]({'where':{'id':_0x3854b5},'data':{'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x289ec7['id'],'fullName':_0x289ec7[_0x1181bc(0x1ad)],'username':_0x289ec7['username'],'telegramId':_0x289ec7['telegram'],'merchantUrl':_0x289ec7[_0x1181bc(0x2b8)],'gateways':_0x289ec7['paymentGateways']?JSON[_0x1181bc(0x1b6)](_0x289ec7[_0x1181bc(0x1d3)]):null,'gatewaySettings':_0x289ec7[_0x1181bc(0x21d)]?JSON['parse'](_0x289ec7[_0x1181bc(0x21d)]):null,'publicKey':_0x289ec7[_0x1181bc(0x1bc)],'wallets':{'usdtPolygonWallet':_0x289ec7[_0x1181bc(0x2b9)],'usdtTrcWallet':_0x289ec7['usdtTrcWallet'],'usdtErcWallet':_0x289ec7[_0x1181bc(0x26d)],'usdcPolygonWallet':_0x289ec7[_0x1181bc(0x23d)]},'status':_0x289ec7[_0x1181bc(0x18b)],'createdAt':_0x289ec7['createdAt']};}async[a46_0x515ad2(0x250)](_0x5bac4f){const _0x5abab9=a46_0x515ad2,{page:_0x8cbc49,limit:_0x2c1039,status:_0x15bd75}=_0x5bac4f,_0x4c9540=(_0x8cbc49-0x1)*_0x2c1039,_0xfb5c32={};_0x15bd75&&(_0xfb5c32[_0x5abab9(0x18b)]=_0x15bd75[_0x5abab9(0x2a3)]());const [_0x3e569c,_0x660b36]=await Promise[_0x5abab9(0x282)]([database_1['default'][_0x5abab9(0x1c0)][_0x5abab9(0x1f8)]({'where':_0xfb5c32,'skip':_0x4c9540,'take':_0x2c1039,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x5abab9(0x235)][_0x5abab9(0x1c0)]['count']({'where':_0xfb5c32})]);return{'users':_0x3e569c['map'](_0x5cadb4=>{const _0x11c971=_0x5abab9,_0x4ac5ed=_0x5cadb4[_0x11c971(0x1d3)]?JSON[_0x11c971(0x1b6)](_0x5cadb4[_0x11c971(0x1d3)]):null,_0x57d418=_0x4ac5ed?_0x4ac5ed['map'](_0x3fd5ae=>this[_0x11c971(0x246)](_0x3fd5ae)):null;return{'id':_0x5cadb4['id'],'fullName':_0x5cadb4['name'],'username':_0x5cadb4[_0x11c971(0x29a)],'telegramId':_0x5cadb4[_0x11c971(0x186)],'merchantUrl':_0x5cadb4['shopUrl'],'gateways':_0x57d418,'gatewaySettings':_0x5cadb4['gatewaySettings']?JSON['parse'](_0x5cadb4['gatewaySettings']):null,'publicKey':_0x5cadb4[_0x11c971(0x1bc)],'wallets':{'usdtPolygonWallet':_0x5cadb4[_0x11c971(0x2b9)],'usdtTrcWallet':_0x5cadb4[_0x11c971(0x176)],'usdtErcWallet':_0x5cadb4[_0x11c971(0x26d)],'usdcPolygonWallet':_0x5cadb4[_0x11c971(0x23d)]},'status':_0x5cadb4[_0x11c971(0x18b)],'createdAt':_0x5cadb4[_0x11c971(0x263)]};}),'pagination':{'page':_0x8cbc49,'limit':_0x2c1039,'total':_0x660b36,'totalPages':Math['ceil'](_0x660b36/_0x2c1039)}};}async['getUserById'](_0x461803){const _0x172f7e=a46_0x515ad2,_0x3d7bcf=await database_1[_0x172f7e(0x235)]['shop'][_0x172f7e(0x23c)]({'where':{'id':_0x461803},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x3d7bcf)return null;const _0x52c059=_0x3d7bcf[_0x172f7e(0x1d3)]?JSON['parse'](_0x3d7bcf[_0x172f7e(0x1d3)]):null,_0x15dea7=_0x52c059?_0x52c059[_0x172f7e(0x2b4)](_0x941896=>this['getGatewayDisplayName'](_0x941896)):null;return _0x52c059&&_0x15dea7&&console['log'](_0x172f7e(0x219),_0x52c059,'->',_0x15dea7),{'id':_0x3d7bcf['id'],'fullName':_0x3d7bcf['name'],'username':_0x3d7bcf[_0x172f7e(0x29a)],'telegramId':_0x3d7bcf[_0x172f7e(0x186)],'merchantUrl':_0x3d7bcf['shopUrl'],'gateways':_0x15dea7,'gatewaySettings':_0x3d7bcf[_0x172f7e(0x21d)]?JSON[_0x172f7e(0x1b6)](_0x3d7bcf['gatewaySettings']):null,'publicKey':_0x3d7bcf[_0x172f7e(0x1bc)],'wallets':{'usdtPolygonWallet':_0x3d7bcf['usdtPolygonWallet'],'usdtTrcWallet':_0x3d7bcf[_0x172f7e(0x176)],'usdtErcWallet':_0x3d7bcf['usdtErcWallet'],'usdcPolygonWallet':_0x3d7bcf[_0x172f7e(0x23d)]},'status':_0x3d7bcf['status'],'createdAt':_0x3d7bcf[_0x172f7e(0x263)]};}async[a46_0x515ad2(0x1a7)](_0x36ab12){const _0x546e03=a46_0x515ad2,{fullName:_0x3ea962,username:_0x4d8096,password:_0xe9d7e6,telegramId:_0x1a83ec,merchantUrl:_0x2b172d,gateways:_0x130e7f,gatewaySettings:_0x24606b,wallets:_0x503b06}=_0x36ab12,_0x1be26e=await database_1[_0x546e03(0x235)][_0x546e03(0x1c0)][_0x546e03(0x23c)]({'where':{'username':_0x4d8096}});if(_0x1be26e)throw new Error(_0x546e03(0x2bb));if(_0x1a83ec){const _0x25e985=await database_1[_0x546e03(0x235)][_0x546e03(0x1c0)][_0x546e03(0x23c)]({'where':{'telegram':_0x1a83ec}});if(_0x25e985)throw new Error('Telegram\x20username\x20already\x20exists');}const _0x31f2ad=await bcryptjs_1['default'][_0x546e03(0x2b0)](_0xe9d7e6,0xc),_0x3666e9=_0x546e03(0x252)+crypto_1[_0x546e03(0x235)][_0x546e03(0x21b)](0x20)['toString'](_0x546e03(0x1f1)),_0x43b51e='sk_'+crypto_1[_0x546e03(0x235)][_0x546e03(0x21b)](0x20)[_0x546e03(0x170)](_0x546e03(0x1f1)),_0x3b72cc=_0x130e7f?_0x130e7f[_0x546e03(0x2b4)](_0x53dc26=>this[_0x546e03(0x2a8)](_0x53dc26)):null;_0x130e7f&&_0x3b72cc&&console['log'](_0x546e03(0x194),_0x130e7f,'->',_0x3b72cc);const _0x3860e7=await database_1['default']['shop'][_0x546e03(0x15f)]({'data':{'name':_0x3ea962,'username':_0x4d8096,'password':_0x31f2ad,'telegram':_0x1a83ec,'shopUrl':_0x2b172d,'paymentGateways':_0x3b72cc?JSON[_0x546e03(0x167)](_0x3b72cc):null,'gatewaySettings':_0x24606b?JSON[_0x546e03(0x167)](_0x24606b):null,'usdtPolygonWallet':_0x503b06?.[_0x546e03(0x2b9)]||null,'usdtTrcWallet':_0x503b06?.[_0x546e03(0x176)]||null,'usdtErcWallet':_0x503b06?.[_0x546e03(0x26d)]||null,'usdcPolygonWallet':_0x503b06?.[_0x546e03(0x23d)]||null,'publicKey':_0x3666e9,'secretKey':_0x43b51e,'status':_0x546e03(0x259)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x3860e7['id'],'fullName':_0x3860e7[_0x546e03(0x1ad)],'username':_0x3860e7[_0x546e03(0x29a)],'telegramId':_0x3860e7[_0x546e03(0x186)],'merchantUrl':_0x3860e7['shopUrl'],'gateways':_0x3860e7[_0x546e03(0x1d3)]?JSON[_0x546e03(0x1b6)](_0x3860e7[_0x546e03(0x1d3)]):null,'gatewaySettings':_0x3860e7[_0x546e03(0x21d)]?JSON['parse'](_0x3860e7[_0x546e03(0x21d)]):null,'publicKey':_0x3860e7['publicKey'],'wallets':{'usdtPolygonWallet':_0x3860e7[_0x546e03(0x2b9)],'usdtTrcWallet':_0x3860e7['usdtTrcWallet'],'usdtErcWallet':_0x3860e7['usdtErcWallet'],'usdcPolygonWallet':_0x3860e7[_0x546e03(0x23d)]},'status':_0x3860e7[_0x546e03(0x18b)],'createdAt':_0x3860e7[_0x546e03(0x263)]};}async[a46_0x515ad2(0x1a1)](_0xf610a0){const _0x268bbb=a46_0x515ad2;await database_1[_0x268bbb(0x235)]['shop'][_0x268bbb(0x284)]({'where':{'id':_0xf610a0}});}[a46_0x515ad2(0x1a2)](_0x32ae7c,_0x338e69,_0x22fbc4){const _0x368b58=a46_0x515ad2,_0x5b05c5=new Map(),_0x233d4a=new Date(_0x338e69);while(_0x233d4a<=_0x22fbc4){const _0x4e0e1c=_0x233d4a[_0x368b58(0x23e)]()['split']('T')[0x0];_0x5b05c5[_0x368b58(0x1e1)](_0x4e0e1c,{'revenue':0x0,'count':0x0}),_0x233d4a['setDate'](_0x233d4a['getDate']()+0x1);}for(const _0x302503 of _0x32ae7c){const _0x4a41f0=_0x302503['createdAt'][_0x368b58(0x23e)]()[_0x368b58(0x220)]('T')[0x0],_0x125f6f=_0x5b05c5['get'](_0x4a41f0);_0x125f6f&&(_0x125f6f[_0x368b58(0x22e)]+=0x1,_0x302503[_0x368b58(0x18b)]===_0x368b58(0x160)&&(_0x302503[_0x368b58(0x273)]?_0x125f6f[_0x368b58(0x1a3)]+=_0x302503[_0x368b58(0x273)]:console[_0x368b58(0x1d0)](_0x368b58(0x181)+_0x302503['id']+_0x368b58(0x270))));}const _0x447169=[],_0x18f886=[];for(const [_0x27b1a8,_0x93a704]of _0x5b05c5){_0x447169[_0x368b58(0x27b)]({'date':_0x27b1a8,'amount':Math[_0x368b58(0x2ba)](_0x93a704[_0x368b58(0x1a3)]*0x64)/0x64}),_0x18f886['push']({'date':_0x27b1a8,'count':_0x93a704[_0x368b58(0x22e)]});}return{'dailyRevenue':_0x447169,'dailyPayments':_0x18f886};}}exports['AdminService']=AdminService;