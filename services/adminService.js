'use strict';function a53_0x32b1(_0xa99e21,_0x3475fd){_0xa99e21=_0xa99e21-0x10d;const _0x55338b=a53_0x5533();let _0x32b11f=_0x55338b[_0xa99e21];return _0x32b11f;}const a53_0x4bdb09=a53_0x32b1;(function(_0xb2e4e5,_0xbd3114){const _0x4f2476=a53_0x32b1,_0x4d41d1=_0xb2e4e5();while(!![]){try{const _0x26c7b6=-parseInt(_0x4f2476(0x2bf))/0x1*(parseInt(_0x4f2476(0x11f))/0x2)+parseInt(_0x4f2476(0x200))/0x3*(-parseInt(_0x4f2476(0x20f))/0x4)+-parseInt(_0x4f2476(0x254))/0x5*(-parseInt(_0x4f2476(0x202))/0x6)+parseInt(_0x4f2476(0x238))/0x7+-parseInt(_0x4f2476(0x263))/0x8*(parseInt(_0x4f2476(0x235))/0x9)+-parseInt(_0x4f2476(0x222))/0xa*(-parseInt(_0x4f2476(0x157))/0xb)+parseInt(_0x4f2476(0x278))/0xc;if(_0x26c7b6===_0xbd3114)break;else _0x4d41d1['push'](_0x4d41d1['shift']());}catch(_0x11e8a9){_0x4d41d1['push'](_0x4d41d1['shift']());}}}(a53_0x5533,0x5aa28));function a53_0x5533(){const _0x1981fe=['today','Sepa','failureMessage','twoFactorEnabled','ðŸ“Š\x20Getting\x20payments\x20with\x20filters:','\x20USDT\x20(total\x20paid\x20to\x20merchants)','\x20USDT\x20-\x20will\x20return\x20to\x20balance','ðŸ’¸\x20CHARGEBACK\x20penalty\x20ONLY:\x20-','ðŸ“Š\x20Gateway\x20filter\x20applied:','ðŸ’°\x20Payment\x20amount\x20is\x20NOT\x20deducted\x20(chargeback\x20penalty\x20only)','getUserById','NONEXISTENT_GATEWAY_FILTER','\x20\x20\x20Amount\x20difference:\x20','floor','2412590lfCOIq','\x20\x20\x20ðŸ’¸\x20Total\x20payouts:\x20','setup2FA','%\x20commission)','\x20-\x20','paymentsCount','\x20\x20\x20ï¿½\x20Total\x20payments\x20turnover:\x20','telegram','klyme_eu','createPayout','status','gateways','get2FASettings','commission','existsSync','not\x20specified','getSystemStatistics','getPaymentById','delete','111168CmVofV','\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)','ðŸ“Š\x20Getting\x20merchant\x20statistics\x20with\x20filters:','1253728fKEWns','\x20order','OxaPay','yesterday','Test\x20Gateway','../config/config',',\x20Commission:\x20','MaxPara','\x20PAID\x20payments','ðŸ“Š\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','dateFrom','\x20USDT\x20(after\x20','ðŸ“‹\x20Found\x20','\x20status:\x20','ðŸ”\x20Admin\x202FA\x20setup\x20initiated','averageCommissionRate','OnRamp','externalPaymentUrl','customerName','getMerchantsSelection','updatePayout','verify','gatewayCommissionRate','shopId','ðŸ“…\x20Period:\x20','Invalid\x202FA\x20token\x20or\x20backup\x20code','dailyPayments','./currencyService','25FLplFo','ðŸ“Š\x20Merchant\x20statistics\x20calculated:','\x20\x20\x20New\x20amount:\x20','\x20\x20\x20ðŸŒ\x20Country:\x20','filter','toFixed','ðŸ”\x20Selected\x20erc20_usdc\x20wallet:\x20','ðŸ’°\x20[PAYOUT]\x20Merchant\x20','0000','generateDailyStatistics','random','polygon_usdc','getPayoutById','2020-01-01','ðŸ”\x20Initial\x20wallet\x20from\x20request:\x20','112ReFLal','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','base32','getUTCFullYear','\x20USDT\x20(','abs','ðŸ“Š\x20Available\x20gateways\x20in\x20database:','./telegramBotService','ADMIN_2FA_ENABLED=false','log','\x20\x20\x20Current\x20amount:\x20','âœ…\x20Using\x20gateway\x20filter:\x20\x27','\x20USDT,\x20Requested:\x20','suspendUser','adminNotes','week','min','\x20\x20\x20Difference:\x20','join','usdtErcWallet','payouts','208392jXcDNk','date','\x20paid\x20payments\x20for\x20gateway\x20','generateSecret','successUrl','month','Invalid\x202FA\x20token','customerCountry','\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...','ðŸ”\x20Selected\x20polygon_usdc\x20wallet:\x20','_sum','\x20\x20\x20ðŸ¤”\x20Difference:\x20','ðŸ’³\x20Final\x20payout\x20wallet\x20for\x20','periodFrom','otpauth_url','trc20','ðŸ”\x20Selected\x20erc20\x20wallet:\x20','activateUser','default','usdtTrcWallet','ðŸ’¸\x20CHARGEBACK:\x20Processing\x20penalty-only\x20deduction','\x20to\x20','AdminService','currencyService','âœ…\x20Payout\x20created:\x20','SquirrelPay','plisio','forEach','\x20in\x20','rapyd','length','dateTo','period','get','round','\x20USDT','paidAt','Noda','totalPayout','ðŸ”\x202FA\x20enabled\x20for\x20shop:\x20','\x20\x20\x20Full\x20amount:\x20','findUnique','includes','KLYME\x20GB','test_gateway','qrcode','ðŸ”\x20Admin\x202FA\x20enabled','setupAdmin2FA','balance',']\x20Gateway\x20settings\x20JSON\x20string:','getAllPayments','usdtPolygonWallet','\x20\x20\x20Gateway:\x20','âœ…\x20Payout\x20created\x20in\x20DB:','\x20\x20\x20ðŸ‘¤\x20Merchant\x20earnings:\x20','createUser','crypto','toLocaleDateString','Interac','config','aggregate','ðŸ”\x20Balance\x20check\x20details:','ðŸ”\x20[','totalTurnover','totalPayments','\x20\x20\x20ðŸ–¥ï¸\x20User\x20Agent:\x20','$transaction','\x20USDT\x20(rounded\x20to\x202\x20decimal\x20places)','notes','\x20\x20\x20Balance:\x20','\x20\x20\x20âœ…\x20Actual\x20available\x20balance:\x20','19161VwnQUp','\x27\x20->\x20ID\x20\x27','totp','whiteUrl','merchantEarnings','totalCommissionRate','customerIp','ðŸ”„\x20Converted\x20gateway\x20ID\x20\x27','amount','hex','ðŸ’°\x20Found\x20','create','last_week','ðŸ’°\x20Payment\x20','TrapaPay\x20Admin','update','PAID','awaitingPayout','commissionUSDT','turnover','\x20\x20\x20Payout\x20amount:\x20',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','getShopWallets','ðŸ“Š\x20Statistics\x20WHERE\x20conditions:','\x20\x20\x20ðŸŒ\x20IP:\x20','convertToUSDT','trim','dailyRevenue','averageCheckUSDT','defineProperty','Plisio','findMany','ðŸ”\x20Creating\x20payout\x20with\x20data:','\x20\x20\x20Merchant\x20loses:\x20','desc','\x20merchants\x20for\x20selection','ðŸ”„\x20Gateway\x20mapping:','bcryptjs','toDataURL','\x20\x20\x20Amount\x20decreased\x20by\x20','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','TrapaPay','ðŸ“Š\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','backupCodes','\x20USDT\x20-\x20will\x20deduct\x20from\x20balance','password','\x20\x20\x20ï¿½\x20Total\x20paid\x20out:\x20','CHARGEBACK','70VazxpW','gatewayOrderId','mastercard','Visa/MasterCard','\x20\x20\x20Available\x20(number):\x20','push','getGatewayNameById','erc20_usdc','toString','setUTCDate','count','publicKey','map','merchantEarningsUSDT','randomBytes','__esModule','getAllUsers','localeCompare','\x27\x20(from\x20\x27','\x20\x20\x20Total\x20paid\x20out:\x20','ðŸ”§\x20[','\x20\x20\x20Final\x20payout\x20amount\x20used:\x20','\x20paid\x20payments\x20for\x20analysis','\x20has\x20zero\x20or\x20null\x20merchant\x20amount,\x20skipping...','\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)','merchantUrl','gateway','MasterCard','ðŸ’°\x20Updating\x20payout\x20','\x20USDT\x20(-','wallet','ru-RU','_count','ðŸ“Š\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20','getGatewayIdByName','getMerchantsAwaitingPayout','customerEmail','readFileSync','admin','ACTIVE','cwd','totalAmountUSDT','payment','getPayoutReports','getFullYear','ðŸ“…\x20Date\x20to\x20filter:\x20','this_week','\x20->\x20','toLowerCase','ðŸ”„\x20Converted\x20gateway\x20name\x20\x27','\x20\x20\x20ðŸ“…\x20Total\x20payouts\x20(this\x20month):\x20','klyme_de','ceil','getUTCDate','ðŸ“Š\x20Payout\x20statistics\x20calculated:','\x20\x20\x20â³\x20Awaiting\x20payout:\x20','33LitROk','\x20\x20\x20ðŸ’°\x20Total\x20turnover:\x20','\x20\x20\x20ðŸª\x20Gateway\x20earnings:\x20','username','has','USDT','\x20\x20\x20ðŸ“…\x20This\x20month:\x20','ðŸ“Š\x20Statistics\x20date\x20range:\x20','ADMIN_2FA_SECRET=','ðŸ”\x20Selected\x20polygon\x20wallet:\x20','disable2FA','stringify','wallets','enableAdmin2FA','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','ðŸ”\x20Selected\x20trc20\x20wallet:\x20','insensitive','totalPaidOut','\x20USDT\x20(+','âš ï¸\x20Payment\x20','currency','ðŸŽ¯\x20updateUser\x20called\x20with\x20ID:\x20',',\x20userId:\x20','lastMonth','\x20\x20\x20Shop\x20totalPaidOut:\x20','klyme_gb','Shop\x20not\x20found','\x20updated\x20successfully','cointopay2','parse','%\x20from\x20','paymentGateways',',\x20refunds:\x20','PENDING','noda','shopUrl','reduce','last_month','getDate','\x27\x20to\x20name\x20\x27','\x20\x20\x20Requested\x20(number):\x20','EXPIRED','all','\x20backup\x20codes','USDC','toUpperCase','Insufficient\x20balance\x20for\x20amount\x20increase.\x20Available:\x20','\x20USDT,\x20merchant:\x20','ðŸ“±\x20Telegram\x20notification\x20sent\x20for\x20payout\x20','\x20for\x20shop\x20','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','Merchant\x20not\x20found','revenue','âŒ\x20Failed\x20to\x20send\x20Telegram\x20notification\x20for\x20payout\x20','ðŸ”„\x20Gateway\x20mapping\x20(create):','ðŸ“Š\x20Getting\x20payout\x20reports\x20with\x20filters:','warn','name','network','TrapaPay\x20(','totalAmountAfterCommissionUSDT','ðŸ’°\x20Shop\x20','TrapaPay\x20Admin\x20(','lte','getGatewayInternalName','setDate','totalAmount','\x20\x20\x20Merchant\x20gets:\x20','REFUND','sort','ADMIN_BACKUP_CODES=','usdcErcWallet','not\x20set','ðŸ”\x20Admin\x202FA\x20disabled','ðŸ’°\x20Current\x20shop\x20balance:\x20','ðŸ“Š\x20Total\x20payments\x20(including\x20failed):\x20','twoFactorSecret','getUTCDay','updatedAt','custom_','Error\x20parsing\x20backup\x20codes:','this_month','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','Payout\x20not\x20found','txid','2FA\x20token\x20is\x20required','orderId','Telegram\x20username\x20already\x20exists','AmPay\x20TRY','startsWith','split','writeFileSync','setHours','.env','thisMonth','gte','ADMIN_2FA_ENABLED=true','ðŸ”\x20Using\x20gateway\x20\x27','gatewaySettings','ADMIN_PASSWORD_HASH=','\x20balance\x20updated:','deleteUser',':\x20commission\x20=\x20','COMPLETED','payout','telegramId','amountUSDT','turnoverUSDT','âœ…\x20Customer\x20data\x20updated\x20for\x20payment\x20','\x20\x20\x20Amount\x20increased\x20by\x20','createdAt','getGatewayDisplayName','custom','shop','ðŸ”\x20No\x20wallet\x20provided,\x20looking\x20up\x20from\x20shop\x20settings...','not\x20provided','path','utf8','\x20USDT\x20for\x20payment\x20','toISOString','error','merchantName','\x20\x20\x20Available\x20(raw):\x20','ðŸ“Š\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','ðŸ’±\x20Currency\x20filter\x20applied:\x20','substr','statusChangedBy','getUTCMonth','amountAfterGatewayCommissionUSDT','\x20\x20\x20ðŸ’¸\x20Total\x20payouts\x20(all\x20time):\x20','splice','\x20\x20\x20ï¿½ðŸ“Š\x20Total\x20payments:\x20','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','compare','getMonth','âš ï¸\x20CHARGEBACK\x20without\x20penalty\x20amount\x20-\x20no\x20balance\x20change','ADMIN_2FA_ENABLED=','sk_','passwordHash','Username\x20already\x20exists','ÐÐµ\x20ÑƒÐºÐ°Ð·Ð°Ð½','merchantId','âœ…\x20Balance\x20check\x20passed\x20(with\x20tolerance)',']\x20Updating\x20password\x20for\x20user\x20','availableBalance','__importDefault','gatewayEarnings','KLYME\x20EU','values','chargebackAmount','speakeasy','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','updatePaymentStatus','amountAfterCommissionUSDT','asc','\x20\x20\x20Added\x20to\x20balance:\x20+','getTime','2FA\x20not\x20set\x20up.\x20Please\x20call\x20setup\x20endpoint\x20first','âœ…\x20Deposited\x20','set','ðŸ“Š\x20Calculating\x20payout\x20statistics...','\x20\x20\x20âœ…\x20Total\x20net\x20balances:\x20','ðŸ’°\x20[PAYOUT]\x20Gateway\x20','ðŸ”\x20Total\x20payments\x20matching\x20filters:\x20','\x20merchants','entries','\x20\x20\x20Transaction\x20hash:\x20','ðŸ“Š\x20Generated\x20reports\x20for\x20','ðŸ”‘\x20Generated\x20','9057AhYUwR','\x20\x20\x20â³\x20Pending\x20payout:\x20','502002MOBfnP','\x20became\x20PAID:','usdcPolygonWallet','../types/gateway','\x27\x20->\x20name\x20\x27','\x20USDC\x20to\x20merchant\x20',',\x20successful:\x20','groupBy','hash','some','periodTo','\x20USDT\x20from\x20balance','customerUa','164DPMFQD','ðŸŽ¯\x20[','2FA\x20is\x20already\x20enabled','UTC','ðŸ“Š\x20Using\x20saved\x20values\x20for\x20payment\x20'];a53_0x5533=function(){return _0x1981fe;};return a53_0x5533();}var __importDefault=this&&this[a53_0x4bdb09(0x1e8)]||function(_0x35b8d7){return _0x35b8d7&&_0x35b8d7['__esModule']?_0x35b8d7:{'default':_0x35b8d7};};Object[a53_0x4bdb09(0x2dc)](exports,a53_0x4bdb09(0x12e),{'value':!![]}),exports[a53_0x4bdb09(0x28e)]=void 0x0;const database_1=__importDefault(require('../config/database')),bcryptjs_1=__importDefault(require(a53_0x4bdb09(0x114))),crypto_1=__importDefault(require(a53_0x4bdb09(0x2b0))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a53_0x4bdb09(0x1cb))),speakeasy_1=__importDefault(require(a53_0x4bdb09(0x1ed))),qrcode_1=__importDefault(require(a53_0x4bdb09(0x2a5))),config_1=require(a53_0x4bdb09(0x23d)),currencyService_1=require(a53_0x4bdb09(0x253)),telegramBotService_1=require(a53_0x4bdb09(0x26a)),gateway_1=require(a53_0x4bdb09(0x205));class AdminService{async['getPayoutStats'](){const _0x3e935c=a53_0x4bdb09;console[_0x3e935c(0x26c)](_0x3e935c(0x1f7));const _0x4cdec2=await database_1['default']['shop'][_0x3e935c(0x2b4)]({'_sum':{'balance':!![],'totalPaidOut':!![]}}),_0x5609ca=await database_1[_0x3e935c(0x28a)]['payment'][_0x3e935c(0x129)]({'where':{'status':_0x3e935c(0x2cf),'gateway':{'not':_0x3e935c(0x2a4)}}}),_0x2c24b2=new Date(),_0x470cd4=new Date(_0x2c24b2[_0x3e935c(0x14b)](),_0x2c24b2[_0x3e935c(0x1dd)](),0x1),_0x12c6ed=new Date(_0x2c24b2[_0x3e935c(0x14b)](),_0x2c24b2[_0x3e935c(0x1dd)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x4a9c1b=await database_1[_0x3e935c(0x28a)][_0x3e935c(0x1bf)][_0x3e935c(0x2b4)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x470cd4,'lte':_0x12c6ed},'status':_0x3e935c(0x1be)}}),_0x313c38=_0x4cdec2[_0x3e935c(0x282)]['totalPaidOut']||0x0,_0xdce607=_0x4cdec2[_0x3e935c(0x282)][_0x3e935c(0x2a8)]||0x0,_0x3b17e3=_0x4a9c1b['_sum'][_0x3e935c(0x2c7)]||0x0,_0x2aca90={'totalPayout':Math['round'](_0x313c38*0x64)/0x64,'awaitingPayout':Math['round'](_0xdce607*0x64)/0x64,'thisMonth':Math[_0x3e935c(0x29a)](_0x3b17e3*0x64)/0x64,'availableBalance':Math[_0x3e935c(0x29a)](_0xdce607*0x64)/0x64,'totalPayments':_0x5609ca};return console['log'](_0x3e935c(0x155)),console[_0x3e935c(0x26c)]('\x20\x20\x20ðŸ’°\x20Total\x20payout:\x20'+_0x2aca90[_0x3e935c(0x29e)]+_0x3e935c(0x219)),console[_0x3e935c(0x26c)](_0x3e935c(0x156)+_0x2aca90[_0x3e935c(0x2d0)]+_0x3e935c(0x236)),console[_0x3e935c(0x26c)]('\x20\x20\x20ðŸ’µ\x20Available\x20balance:\x20'+_0x2aca90[_0x3e935c(0x1e7)]+'\x20USDT\x20(same\x20as\x20awaiting)'),console[_0x3e935c(0x26c)](_0x3e935c(0x15d)+_0x2aca90[_0x3e935c(0x1b5)]+'\x20USDT'),console[_0x3e935c(0x26c)]('\x20\x20\x20ðŸ’³\x20Total\x20payments:\x20'+_0x2aca90[_0x3e935c(0x2b8)]+_0x3e935c(0x240)),_0x2aca90;}async['updateCustomerData'](_0x5e8944,_0xe2974e){const _0x1bbd65=a53_0x4bdb09;console[_0x1bbd65(0x26c)]('ðŸ”„\x20Updating\x20customer\x20data\x20for\x20payment\x20'+_0x5e8944+':',_0xe2974e);const _0xacca40=await database_1[_0x1bbd65(0x28a)]['payment']['findUnique']({'where':{'id':_0x5e8944},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0xacca40)throw new Error('Payment\x20not\x20found');const _0x23ae06={};_0xe2974e['customerCountry']!==undefined&&(_0x23ae06[_0x1bbd65(0x27f)]=_0xe2974e[_0x1bbd65(0x27f)]||null);_0xe2974e[_0x1bbd65(0x2c5)]!==undefined&&(_0x23ae06['customerIp']=_0xe2974e[_0x1bbd65(0x2c5)]||null);_0xe2974e['customerUa']!==undefined&&(_0x23ae06[_0x1bbd65(0x20e)]=_0xe2974e[_0x1bbd65(0x20e)]||null);const _0x32f23d=await database_1[_0x1bbd65(0x28a)][_0x1bbd65(0x149)][_0x1bbd65(0x2ce)]({'where':{'id':_0x5e8944},'data':{..._0x23ae06,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x1bbd65(0x26c)](_0x1bbd65(0x1c3)+_0x5e8944),console[_0x1bbd65(0x26c)](_0x1bbd65(0x257)+_0xacca40['customerCountry']+_0x1bbd65(0x14e)+_0x32f23d['customerCountry']),console[_0x1bbd65(0x26c)](_0x1bbd65(0x2d7)+_0xacca40['customerIp']+_0x1bbd65(0x14e)+_0x32f23d[_0x1bbd65(0x2c5)]),console[_0x1bbd65(0x26c)](_0x1bbd65(0x2b9)+(_0xacca40['customerUa']?_0x1bbd65(0x1f6):_0x1bbd65(0x19f))+_0x1bbd65(0x14e)+(_0x32f23d[_0x1bbd65(0x20e)]?'set':_0x1bbd65(0x19f))),_0x32f23d;}async[a53_0x4bdb09(0x232)](_0x567609,_0x1b9903){const _0x2e9c2b=a53_0x4bdb09,_0x2472d3=_0x1b9903?new Date(_0x1b9903):new Date();let _0x3d831a,_0xe56b82;if(_0x567609['startsWith'](_0x2e9c2b(0x1a6))){const _0x288c6d=_0x567609['replace'](_0x2e9c2b(0x1a6),'')[_0x2e9c2b(0x1b1)]('_');if(_0x288c6d[_0x2e9c2b(0x296)]===0x2){const _0x14d0f6=new Date(_0x288c6d[0x0]),_0x4459be=new Date(_0x288c6d[0x1]);_0x3d831a=new Date(Date[_0x2e9c2b(0x212)](_0x14d0f6[_0x2e9c2b(0x266)](),_0x14d0f6['getUTCMonth'](),_0x14d0f6['getUTCDate'](),0x0,0x0,0x0,0x0)),_0xe56b82=new Date(Date[_0x2e9c2b(0x212)](_0x4459be[_0x2e9c2b(0x266)](),_0x4459be[_0x2e9c2b(0x1d6)](),_0x4459be[_0x2e9c2b(0x154)](),0x17,0x3b,0x3b,0x3e7));}else{const _0x290ef7=new Date(Date[_0x2e9c2b(0x212)](_0x2472d3[_0x2e9c2b(0x266)](),_0x2472d3['getUTCMonth'](),_0x2472d3[_0x2e9c2b(0x154)]()-0x1e));_0x3d831a=new Date(Date['UTC'](_0x290ef7[_0x2e9c2b(0x266)](),_0x290ef7['getUTCMonth'](),_0x290ef7['getUTCDate'](),0x0,0x0,0x0,0x0)),_0xe56b82=new Date(Date['UTC'](_0x2472d3[_0x2e9c2b(0x266)](),_0x2472d3['getUTCMonth'](),_0x2472d3[_0x2e9c2b(0x154)](),0x17,0x3b,0x3b,0x3e7));}}else{switch(_0x567609[_0x2e9c2b(0x14f)]()){case _0x2e9c2b(0x214):_0x3d831a=new Date(Date[_0x2e9c2b(0x212)](_0x2472d3[_0x2e9c2b(0x266)](),_0x2472d3['getUTCMonth'](),_0x2472d3[_0x2e9c2b(0x154)](),0x0,0x0,0x0,0x0)),_0xe56b82=new Date(Date[_0x2e9c2b(0x212)](_0x2472d3[_0x2e9c2b(0x266)](),_0x2472d3[_0x2e9c2b(0x1d6)](),_0x2472d3['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case _0x2e9c2b(0x23b):const _0x4f2f4d=new Date(_0x2472d3);_0x4f2f4d['setUTCDate'](_0x4f2f4d[_0x2e9c2b(0x154)]()-0x1),_0x3d831a=new Date(Date['UTC'](_0x4f2f4d[_0x2e9c2b(0x266)](),_0x4f2f4d[_0x2e9c2b(0x1d6)](),_0x4f2f4d['getUTCDate'](),0x0,0x0,0x0,0x0)),_0xe56b82=new Date(Date['UTC'](_0x4f2f4d[_0x2e9c2b(0x266)](),_0x4f2f4d[_0x2e9c2b(0x1d6)](),_0x4f2f4d[_0x2e9c2b(0x154)](),0x17,0x3b,0x3b,0x3e7));break;case _0x2e9c2b(0x14d):const _0x527a1f=_0x2472d3['getUTCDay'](),_0xeeb71a=_0x527a1f===0x0?-0x6:0x1-_0x527a1f,_0x2c157b=_0x2472d3[_0x2e9c2b(0x154)]()+_0xeeb71a;_0x3d831a=new Date(Date[_0x2e9c2b(0x212)](_0x2472d3['getUTCFullYear'](),_0x2472d3[_0x2e9c2b(0x1d6)](),_0x2c157b,0x0,0x0,0x0,0x0)),_0xe56b82=new Date(Date['UTC'](_0x2472d3[_0x2e9c2b(0x266)](),_0x2472d3[_0x2e9c2b(0x1d6)](),_0x2472d3[_0x2e9c2b(0x154)](),0x17,0x3b,0x3b,0x3e7));break;case _0x2e9c2b(0x2cb):const _0x2db664=new Date(Date[_0x2e9c2b(0x212)](_0x2472d3[_0x2e9c2b(0x266)](),_0x2472d3[_0x2e9c2b(0x1d6)](),_0x2472d3[_0x2e9c2b(0x154)]()-0x7)),_0x26f740=_0x2db664[_0x2e9c2b(0x1a4)](),_0x3e8ea7=_0x26f740===0x0?-0x6:0x1-_0x26f740,_0x3354ce=_0x2db664[_0x2e9c2b(0x154)]()+_0x3e8ea7;_0x3d831a=new Date(Date[_0x2e9c2b(0x212)](_0x2db664[_0x2e9c2b(0x266)](),_0x2db664[_0x2e9c2b(0x1d6)](),_0x3354ce,0x0,0x0,0x0,0x0)),_0xe56b82=new Date(Date[_0x2e9c2b(0x212)](_0x2db664['getUTCFullYear'](),_0x2db664[_0x2e9c2b(0x1d6)](),_0x3354ce+0x6,0x17,0x3b,0x3b,0x3e7));break;case _0x2e9c2b(0x1a8):_0x3d831a=new Date(Date['UTC'](_0x2472d3[_0x2e9c2b(0x266)](),_0x2472d3[_0x2e9c2b(0x1d6)](),0x1,0x0,0x0,0x0,0x0)),_0xe56b82=new Date(Date['UTC'](_0x2472d3[_0x2e9c2b(0x266)](),_0x2472d3[_0x2e9c2b(0x1d6)](),_0x2472d3[_0x2e9c2b(0x154)](),0x17,0x3b,0x3b,0x3e7));break;case _0x2e9c2b(0x17c):_0x3d831a=new Date(Date[_0x2e9c2b(0x212)](_0x2472d3[_0x2e9c2b(0x266)](),_0x2472d3[_0x2e9c2b(0x1d6)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0xe56b82=new Date(Date['UTC'](_0x2472d3[_0x2e9c2b(0x266)](),_0x2472d3[_0x2e9c2b(0x1d6)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case'all_time':_0x3d831a=new Date(Date[_0x2e9c2b(0x212)](0x7e9,0x5,0xe,0x0,0x0,0x0,0x0)),_0xe56b82=new Date(Date[_0x2e9c2b(0x212)](_0x2472d3[_0x2e9c2b(0x266)](),_0x2472d3[_0x2e9c2b(0x1d6)](),_0x2472d3[_0x2e9c2b(0x154)](),0x17,0x3b,0x3b,0x3e7));break;default:_0x3d831a=new Date(_0x2472d3[_0x2e9c2b(0x1f3)]()-0x1e*0x18*0x3c*0x3c*0x3e8);const _0x1a2fb0=new Date(Date[_0x2e9c2b(0x212)](_0x2472d3[_0x2e9c2b(0x266)](),_0x2472d3[_0x2e9c2b(0x1d6)](),_0x2472d3[_0x2e9c2b(0x154)]()-0x1e));_0x3d831a=new Date(Date['UTC'](_0x1a2fb0[_0x2e9c2b(0x266)](),_0x1a2fb0['getUTCMonth'](),_0x1a2fb0[_0x2e9c2b(0x154)](),0x0,0x0,0x0,0x0)),_0xe56b82=new Date(Date['UTC'](_0x2472d3[_0x2e9c2b(0x266)](),_0x2472d3['getUTCMonth'](),_0x2472d3['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}const _0x47da2f={'gte':_0x3d831a,'lte':_0xe56b82};console[_0x2e9c2b(0x26c)](_0x2e9c2b(0x15e)+_0x3d831a[_0x2e9c2b(0x1ce)]()+'\x20to\x20'+_0xe56b82[_0x2e9c2b(0x1ce)]());const [_0x3d73bb,_0x2f752a,_0x37c01b,_0x49a9b1,_0x378ca4,_0x1bf0e2,_0x529063,_0x176a6c,_0x2ab46b]=await Promise[_0x2e9c2b(0x181)]([database_1[_0x2e9c2b(0x28a)]['shop'][_0x2e9c2b(0x129)](),database_1[_0x2e9c2b(0x28a)]['shop'][_0x2e9c2b(0x129)]({'where':{'status':'ACTIVE'}}),database_1[_0x2e9c2b(0x28a)][_0x2e9c2b(0x149)][_0x2e9c2b(0x129)]({'where':{'status':_0x2e9c2b(0x2cf),'createdAt':_0x47da2f,'gateway':{'not':'test_gateway'}}}),database_1[_0x2e9c2b(0x28a)][_0x2e9c2b(0x149)]['count']({'where':{'status':_0x2e9c2b(0x11e),'createdAt':_0x47da2f,'gateway':{'not':_0x2e9c2b(0x2a4)}}}),database_1[_0x2e9c2b(0x28a)][_0x2e9c2b(0x149)][_0x2e9c2b(0x129)]({'where':{'status':_0x2e9c2b(0x19b),'createdAt':_0x47da2f,'gateway':{'not':_0x2e9c2b(0x2a4)}}}),database_1[_0x2e9c2b(0x28a)]['payment'][_0x2e9c2b(0x10e)]({'where':{'status':_0x2e9c2b(0x2cf),'createdAt':_0x47da2f,'gateway':{'not':_0x2e9c2b(0x2a4)}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x2e9c2b(0x28a)]['payment']['findMany']({'where':{'gateway':{'not':_0x2e9c2b(0x2a4)}},'take':0xa,'orderBy':{'createdAt':_0x2e9c2b(0x111)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x2e9c2b(0x28a)][_0x2e9c2b(0x149)][_0x2e9c2b(0x10e)]({'where':{'createdAt':_0x47da2f,'gateway':{'not':_0x2e9c2b(0x2a4)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x2e9c2b(0x28a)][_0x2e9c2b(0x149)]['findMany']({'where':{'status':_0x2e9c2b(0x2cf),'gateway':{'not':'test_gateway'}},'select':{'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![]}})]);console['log']('ðŸ“Š\x20Statistics\x20PAID\x20payments\x20count:\x20'+_0x37c01b);let _0x1b1aaf=0x0,_0x2eee75=0x0;for(const _0x3bfd4c of _0x1bf0e2){const _0x61f082=_0x3bfd4c[_0x2e9c2b(0x1c1)]||0x0;_0x1b1aaf+=_0x61f082;if(_0x3bfd4c[_0x2e9c2b(0x1d7)]&&_0x3bfd4c[_0x2e9c2b(0x1c1)]){const _0x317d1f=_0x3bfd4c[_0x2e9c2b(0x1c1)]-_0x3bfd4c['amountAfterGatewayCommissionUSDT'];_0x2eee75+=_0x317d1f;}}let _0xd12bd=0x0;for(const _0x1a35d9 of _0x2ab46b){if(_0x1a35d9[_0x2e9c2b(0x1d7)]&&_0x1a35d9['amountUSDT']){const _0x40e1d6=_0x1a35d9['amountUSDT']-_0x1a35d9[_0x2e9c2b(0x1d7)];_0xd12bd+=_0x40e1d6;}}const _0x2593f9=_0x37c01b>0x0?_0x1b1aaf/_0x37c01b:0x0,_0xdf15f3=this[_0x2e9c2b(0x25d)](_0x176a6c,_0x3d831a,_0xe56b82),_0x483979=await database_1['default']['payment']['count']({'where':{'createdAt':_0x47da2f,'gateway':{'not':_0x2e9c2b(0x2a4)},'status':{'notIn':[_0x2e9c2b(0x178),_0x2e9c2b(0x180)]}}}),_0x468a3c=_0x483979>0x0?_0x37c01b/_0x483979*0x64:0x0;return{'totalShops':_0x3d73bb,'activeShops':_0x2f752a,'totalPayments':_0x483979,'successfulPayments':_0x37c01b,'totalAttempts':_0x483979,'chargebacks':_0x49a9b1,'refunds':_0x378ca4,'totalRevenue':Math[_0x2e9c2b(0x29a)](_0x1b1aaf*0x64)/0x64,'trapayEarnings':Math[_0x2e9c2b(0x29a)](_0x2eee75*0x64)/0x64,'trapayEarningsAllTime':Math[_0x2e9c2b(0x29a)](_0xd12bd*0x64)/0x64,'averagePaymentAmount':Math[_0x2e9c2b(0x29a)](_0x2593f9*0x64)/0x64,'conversionRate':Math[_0x2e9c2b(0x29a)](_0x468a3c*0x64)/0x64,'dailyRevenue':_0xdf15f3[_0x2e9c2b(0x2da)],'dailyPayments':_0xdf15f3[_0x2e9c2b(0x252)],'recentPayments':_0x529063[_0x2e9c2b(0x12b)](_0x175795=>({'id':_0x175795['id'],'amount':_0x175795[_0x2e9c2b(0x2c7)],'currency':_0x175795[_0x2e9c2b(0x16b)],'status':_0x175795['status'],'gateway':_0x175795[_0x2e9c2b(0x139)],'shop':_0x175795[_0x2e9c2b(0x1c8)],'createdAt':_0x175795[_0x2e9c2b(0x1c5)]}))};}}async['getMerchantStatistics'](_0x2a0d8d){const _0x2987be=a53_0x4bdb09;console[_0x2987be(0x26c)](_0x2987be(0x237),_0x2a0d8d);let _0x119235,_0x28fc10=new Date();if(_0x2a0d8d['period']===_0x2987be(0x1c7)&&_0x2a0d8d[_0x2987be(0x242)]&&_0x2a0d8d[_0x2987be(0x297)]){const _0x5044fd=new Date(_0x2a0d8d[_0x2987be(0x242)]),_0x980f67=new Date(_0x2a0d8d[_0x2987be(0x297)]);_0x119235=new Date(Date[_0x2987be(0x212)](_0x5044fd[_0x2987be(0x266)](),_0x5044fd[_0x2987be(0x1d6)](),_0x5044fd[_0x2987be(0x154)](),0x0,0x0,0x0,0x0)),_0x28fc10=new Date(Date[_0x2987be(0x212)](_0x980f67['getUTCFullYear'](),_0x980f67[_0x2987be(0x1d6)](),_0x980f67['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}else{const _0x5bd394=new Date();switch(_0x2a0d8d['period']){case _0x2987be(0x272):_0x119235=new Date(_0x5bd394[_0x2987be(0x1f3)]()-0x7*0x18*0x3c*0x3c*0x3e8),_0x119235['setHours'](0x0,0x0,0x0,0x0),_0x28fc10[_0x2987be(0x1b3)](0x17,0x3b,0x3b,0x3e7);break;case _0x2987be(0x27d):_0x119235=new Date(Date[_0x2987be(0x212)](_0x5bd394[_0x2987be(0x266)](),_0x5bd394[_0x2987be(0x1d6)](),0x1,0x0,0x0,0x0,0x0)),_0x28fc10=new Date(Date[_0x2987be(0x212)](_0x5bd394['getUTCFullYear'](),_0x5bd394[_0x2987be(0x1d6)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x2987be(0x16e):_0x119235=new Date(Date['UTC'](_0x5bd394[_0x2987be(0x266)](),_0x5bd394['getUTCMonth']()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x28fc10=new Date(Date[_0x2987be(0x212)](_0x5bd394[_0x2987be(0x266)](),_0x5bd394['getUTCMonth'](),0x0,0x17,0x3b,0x3b,0x3e7));break;case'year':_0x119235=new Date(_0x5bd394['getTime']()-0x16d*0x18*0x3c*0x3c*0x3e8),_0x119235['setHours'](0x0,0x0,0x0,0x0),_0x28fc10[_0x2987be(0x1b3)](0x17,0x3b,0x3b,0x3e7);break;case _0x2987be(0x181):default:_0x119235=new Date(_0x2987be(0x261)),_0x119235[_0x2987be(0x1b3)](0x0,0x0,0x0,0x0),_0x28fc10[_0x2987be(0x1b3)](0x17,0x3b,0x3b,0x3e7);break;}}console[_0x2987be(0x26c)](_0x2987be(0x250)+_0x119235['toISOString']()+'\x20to\x20'+_0x28fc10['toISOString']());const _0x7cf2a={'status':_0x2987be(0x2cf),'gateway':{'not':_0x2987be(0x2a4)},'createdAt':{'gte':_0x119235,'lte':_0x28fc10}};_0x2a0d8d[_0x2987be(0x24f)]&&(_0x7cf2a['shopId']=_0x2a0d8d[_0x2987be(0x24f)]);const _0x338179=await database_1[_0x2987be(0x28a)][_0x2987be(0x149)][_0x2987be(0x10e)]({'where':_0x7cf2a,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x2987be(0x26c)](_0x2987be(0x2c9)+_0x338179['length']+_0x2987be(0x135));const _0x5b77b0={'gateway':{'not':_0x2987be(0x2a4)},'status':{'notIn':[_0x2987be(0x178),_0x2987be(0x180)]},'createdAt':{'gte':_0x119235,'lte':_0x28fc10}};_0x2a0d8d[_0x2987be(0x24f)]&&(_0x5b77b0['shopId']=_0x2a0d8d[_0x2987be(0x24f)]);const _0x292456=await database_1[_0x2987be(0x28a)][_0x2987be(0x149)]['count']({'where':_0x5b77b0}),_0x3bae19={..._0x5b77b0,'status':_0x2987be(0x11e)},_0x349c01={..._0x5b77b0,'status':_0x2987be(0x19b)},[_0x3c1af3,_0x282d80]=await Promise['all']([database_1[_0x2987be(0x28a)][_0x2987be(0x149)]['count']({'where':_0x3bae19}),database_1[_0x2987be(0x28a)][_0x2987be(0x149)]['count']({'where':_0x349c01})]);console[_0x2987be(0x26c)](_0x2987be(0x1a2)+_0x292456+_0x2987be(0x208)+_0x338179[_0x2987be(0x296)]+',\x20chargebacks:\x20'+_0x3c1af3+_0x2987be(0x177)+_0x282d80);let _0x4bf100=0x0,_0x56a061=0x0,_0xd2e76d=0x0;const _0x524f33={},_0x3c0c89={},_0x386501={},_0x10e0eb=new Date(_0x119235);while(_0x10e0eb<=_0x28fc10){const _0x566ed3=_0x10e0eb[_0x2987be(0x1ce)]()[_0x2987be(0x1b1)]('T')[0x0];_0x386501[_0x566ed3]={'date':_0x566ed3,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0},_0x10e0eb[_0x2987be(0x128)](_0x10e0eb[_0x2987be(0x154)]()+0x1);}for(const _0x43a3ab of _0x338179){try{const _0x493988=_0x43a3ab['amountUSDT']||0x0;if(_0x493988<=0x0){console['warn'](_0x2987be(0x16a)+_0x43a3ab['id']+_0x2987be(0x280));continue;}let _0x38b260,_0x26e6ab;if(_0x43a3ab[_0x2987be(0x1d7)]!==null&&_0x43a3ab[_0x2987be(0x1d7)]!==undefined)_0x38b260=_0x43a3ab[_0x2987be(0x1d7)],_0x26e6ab=_0x493988-_0x38b260,console[_0x2987be(0x26c)](_0x2987be(0x213)+_0x43a3ab['id']+':\x20'+_0x493988['toFixed'](0x6)+_0x2987be(0x186)+_0x38b260[_0x2987be(0x259)](0x6)+_0x2987be(0x29b));else{let _0x1252f0={};if(_0x43a3ab[_0x2987be(0x1c8)][_0x2987be(0x1b9)])try{_0x1252f0=JSON['parse'](_0x43a3ab['shop'][_0x2987be(0x1b9)]);}catch(_0x4aaa17){console[_0x2987be(0x1cf)](_0x2987be(0x117)+_0x43a3ab[_0x2987be(0x24f)]+':',_0x4aaa17);}let _0x179a6e=0x2d;for(const [_0x15169b,_0x32fede]of Object[_0x2987be(0x1fc)](_0x1252f0)){if(_0x15169b[_0x2987be(0x14f)]()===_0x43a3ab[_0x2987be(0x139)][_0x2987be(0x14f)]()){_0x179a6e=_0x32fede[_0x2987be(0x22f)]||0x2d;break;}}_0x26e6ab=_0x493988*(_0x179a6e/0x64),_0x38b260=_0x493988-_0x26e6ab,console[_0x2987be(0x26c)](_0x2987be(0x119)+_0x43a3ab['id']+':\x20'+_0x179a6e+_0x2987be(0x175)+_0x493988[_0x2987be(0x259)](0x6)+_0x2987be(0x29b));}_0x4bf100+=_0x493988,_0x56a061+=_0x38b260,_0xd2e76d+=_0x26e6ab;let _0x404b48;_0x43a3ab[_0x2987be(0x24e)]!==null&&_0x43a3ab[_0x2987be(0x24e)]!==undefined?(_0x404b48=_0x43a3ab[_0x2987be(0x24e)],console[_0x2987be(0x26c)](_0x2987be(0x140)+_0x43a3ab['id']+':\x20'+_0x404b48+'%')):(_0x404b48=_0x493988>0x0?_0x26e6ab/_0x493988*0x64:0x0,console['log']('ðŸ“Š\x20Calculated\x20commission\x20rate\x20for\x20payment\x20'+_0x43a3ab['id']+':\x20'+_0x404b48[_0x2987be(0x259)](0x2)+'%'));!_0x524f33[_0x43a3ab[_0x2987be(0x139)]]&&(_0x524f33[_0x43a3ab[_0x2987be(0x139)]]={'gateway':_0x43a3ab[_0x2987be(0x139)],'gatewayDisplayName':this[_0x2987be(0x1c6)](_0x43a3ab[_0x2987be(0x139)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x524f33[_0x43a3ab['gateway']][_0x2987be(0x227)]++,_0x524f33[_0x43a3ab[_0x2987be(0x139)]][_0x2987be(0x1c2)]+=_0x493988,_0x524f33[_0x43a3ab[_0x2987be(0x139)]][_0x2987be(0x2d1)]+=_0x26e6ab,_0x524f33[_0x43a3ab['gateway']][_0x2987be(0x12c)]+=_0x38b260,_0x524f33[_0x43a3ab['gateway']][_0x2987be(0x2c4)]+=_0x404b48;!_0x2a0d8d[_0x2987be(0x24f)]&&(!_0x3c0c89[_0x43a3ab[_0x2987be(0x24f)]]&&(_0x3c0c89[_0x43a3ab[_0x2987be(0x24f)]]={'shopId':_0x43a3ab[_0x2987be(0x24f)],'shopName':_0x43a3ab[_0x2987be(0x1c8)][_0x2987be(0x190)],'shopUsername':_0x43a3ab[_0x2987be(0x1c8)][_0x2987be(0x15a)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x3c0c89[_0x43a3ab[_0x2987be(0x24f)]][_0x2987be(0x227)]++,_0x3c0c89[_0x43a3ab[_0x2987be(0x24f)]][_0x2987be(0x1c2)]+=_0x493988,_0x3c0c89[_0x43a3ab[_0x2987be(0x24f)]][_0x2987be(0x2d1)]+=_0x26e6ab,_0x3c0c89[_0x43a3ab[_0x2987be(0x24f)]][_0x2987be(0x12c)]+=_0x38b260);const _0x1f40ee=_0x43a3ab[_0x2987be(0x29c)][_0x2987be(0x1ce)]()[_0x2987be(0x1b1)]('T')[0x0];_0x386501[_0x1f40ee]&&(_0x386501[_0x1f40ee][_0x2987be(0x2d2)]+=_0x493988,_0x386501[_0x1f40ee][_0x2987be(0x2c3)]+=_0x38b260,_0x386501[_0x1f40ee][_0x2987be(0x1e9)]+=_0x26e6ab,_0x386501[_0x1f40ee][_0x2987be(0x227)]++);}catch(_0x5e2b6c){console['error']('Error\x20processing\x20payment\x20'+_0x43a3ab['id']+':',_0x5e2b6c);}}Object[_0x2987be(0x1eb)](_0x524f33)['forEach'](_0xf0439e=>{const _0x3ab2b1=_0x2987be;_0xf0439e[_0x3ab2b1(0x247)]=_0xf0439e[_0x3ab2b1(0x227)]>0x0?_0xf0439e[_0x3ab2b1(0x2c4)]/_0xf0439e[_0x3ab2b1(0x227)]:0x0,delete _0xf0439e['totalCommissionRate'];}),Object[_0x2987be(0x1eb)](_0x3c0c89)[_0x2987be(0x293)](_0x2dd61c=>{const _0x5c36af=_0x2987be;_0x2dd61c[_0x5c36af(0x2db)]=_0x2dd61c[_0x5c36af(0x227)]>0x0?_0x2dd61c[_0x5c36af(0x1c2)]/_0x2dd61c[_0x5c36af(0x227)]:0x0;});let _0x719ae2=0x0,_0x11de46=0x0;if(_0x2a0d8d['shopId']){const _0x826ba8=await database_1[_0x2987be(0x28a)][_0x2987be(0x1bf)][_0x2987be(0x10e)]({'where':{'shopId':_0x2a0d8d[_0x2987be(0x24f)],'status':_0x2987be(0x1be),'createdAt':{'gte':_0x119235,'lte':_0x28fc10}},'select':{'amount':!![]}});_0x719ae2=_0x826ba8[_0x2987be(0x17b)]((_0x2e32b5,_0x35282b)=>_0x2e32b5+_0x35282b[_0x2987be(0x2c7)],0x0);const _0x3c0aa5=await database_1['default']['payout'][_0x2987be(0x10e)]({'where':{'shopId':_0x2a0d8d[_0x2987be(0x24f)],'status':_0x2987be(0x178),'createdAt':{'gte':_0x119235,'lte':_0x28fc10}},'select':{'amount':!![]}});_0x11de46=_0x3c0aa5[_0x2987be(0x17b)]((_0x201408,_0x5e7041)=>_0x201408+_0x5e7041[_0x2987be(0x2c7)],0x0);}const _0x3febe2=_0x292456,_0x392e14=_0x338179[_0x2987be(0x296)],_0x13e937=_0x392e14>0x0?_0x4bf100/_0x392e14:0x0,_0x2af488=_0x3febe2>0x0?Math[_0x2987be(0x29a)](_0x392e14/_0x3febe2*0x2710)/0x64:0x0,_0x149275=Math[_0x2987be(0x153)]((_0x28fc10[_0x2987be(0x1f3)]()-_0x119235[_0x2987be(0x1f3)]())/(0x3e8*0x3c*0x3c*0x18)),_0x1e9710={'totalTurnover':Math[_0x2987be(0x29a)](_0x4bf100*0x64)/0x64,'merchantEarnings':Math['round'](_0x56a061*0x64)/0x64,'gatewayEarnings':Math[_0x2987be(0x29a)](_0xd2e76d*0x64)/0x64,'totalPaidOut':Math[_0x2987be(0x29a)](_0x719ae2*0x64)/0x64,'pendingPayout':Math[_0x2987be(0x29a)](_0x11de46*0x64)/0x64,'averageCheck':Math['round'](_0x13e937*0x64)/0x64,'totalPayments':_0x3febe2,'successfulPayments':_0x392e14,'conversionRate':_0x2af488,'chargebacks':_0x3c1af3,'refunds':_0x282d80,'gatewayBreakdown':Object[_0x2987be(0x1eb)](_0x524f33)[_0x2987be(0x12b)](_0x44b853=>({..._0x44b853,'turnoverUSDT':Math[_0x2987be(0x29a)](_0x44b853[_0x2987be(0x1c2)]*0x64)/0x64,'commissionUSDT':Math[_0x2987be(0x29a)](_0x44b853[_0x2987be(0x2d1)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x2987be(0x29a)](_0x44b853[_0x2987be(0x12c)]*0x64)/0x64,'averageCommissionRate':Math[_0x2987be(0x29a)](_0x44b853[_0x2987be(0x247)]*0x64)/0x64})),'merchantBreakdown':_0x2a0d8d[_0x2987be(0x24f)]?undefined:Object['values'](_0x3c0c89)[_0x2987be(0x12b)](_0x526bf7=>({..._0x526bf7,'turnoverUSDT':Math[_0x2987be(0x29a)](_0x526bf7[_0x2987be(0x1c2)]*0x64)/0x64,'commissionUSDT':Math[_0x2987be(0x29a)](_0x526bf7[_0x2987be(0x2d1)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x2987be(0x29a)](_0x526bf7[_0x2987be(0x12c)]*0x64)/0x64,'paidOutUSDT':Math[_0x2987be(0x29a)](_0x526bf7['paidOutUSDT']*0x64)/0x64,'averageCheckUSDT':Math[_0x2987be(0x29a)](_0x526bf7['averageCheckUSDT']*0x64)/0x64})),'dailyData':Object[_0x2987be(0x1eb)](_0x386501)['map'](_0x2ec4e9=>({..._0x2ec4e9,'turnover':Math[_0x2987be(0x29a)](_0x2ec4e9[_0x2987be(0x2d2)]*0x64)/0x64,'merchantEarnings':Math['round'](_0x2ec4e9[_0x2987be(0x2c3)]*0x64)/0x64,'gatewayEarnings':Math[_0x2987be(0x29a)](_0x2ec4e9['gatewayEarnings']*0x64)/0x64}))[_0x2987be(0x19c)]((_0x22f4fc,_0x2b7989)=>_0x22f4fc[_0x2987be(0x279)][_0x2987be(0x130)](_0x2b7989['date'])),'periodInfo':{'from':_0x119235,'to':_0x28fc10,'periodType':_0x2a0d8d[_0x2987be(0x298)]||_0x2987be(0x1c7),'daysCount':_0x149275}};return console[_0x2987be(0x26c)](_0x2987be(0x255)),console[_0x2987be(0x26c)](_0x2987be(0x158)+_0x1e9710[_0x2987be(0x2b7)]+_0x2987be(0x29b)),console['log'](_0x2987be(0x2ae)+_0x1e9710['merchantEarnings']+_0x2987be(0x29b)),console[_0x2987be(0x26c)](_0x2987be(0x159)+_0x1e9710[_0x2987be(0x1e9)]+'\x20USDT'),console[_0x2987be(0x26c)](_0x2987be(0x11d)+_0x1e9710[_0x2987be(0x168)]+_0x2987be(0x29b)),console[_0x2987be(0x26c)](_0x2987be(0x201)+_0x1e9710['pendingPayout']+_0x2987be(0x29b)),console[_0x2987be(0x26c)](_0x2987be(0x1da)+_0x1e9710[_0x2987be(0x2b8)]),_0x1e9710;}async[a53_0x4bdb09(0x24b)](_0x440562){const _0x53fa20=a53_0x4bdb09;console['log']('ðŸ“‹\x20Getting\x20merchants\x20selection\x20list...',{'hasPayoutHistory':_0x440562});let _0x1b2111={};_0x440562&&(_0x1b2111[_0x53fa20(0x277)]={'some':{}});const _0x32a1af=await database_1[_0x53fa20(0x28a)][_0x53fa20(0x1c8)][_0x53fa20(0x10e)]({'where':_0x1b2111,'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x53fa20(0x1f1)}});return console[_0x53fa20(0x26c)](_0x53fa20(0x244)+_0x32a1af[_0x53fa20(0x296)]+_0x53fa20(0x112)+(_0x440562?'\x20with\x20payout\x20history':'')),_0x32a1af['map'](_0x1af733=>({'id':_0x1af733['id'],'username':_0x1af733[_0x53fa20(0x15a)],'name':_0x1af733['name']}));}[a53_0x4bdb09(0x1c6)](_0x17d115){const _0x1e42e1=a53_0x4bdb09,_0xf84520={'test_gateway':_0x1e42e1(0x23c),'plisio':_0x1e42e1(0x10d),'rapyd':'Rapyd','noda':_0x1e42e1(0x29d),'cointopay':'CoinToPay','cointopay2':'CoinToPay2','klyme_eu':_0x1e42e1(0x1ea),'klyme_gb':_0x1e42e1(0x2a3),'klyme_de':'KLYME\x20DE','mastercard':_0x1e42e1(0x13a),'visa/mastercard':_0x1e42e1(0x122),'amer':'Amer','myxspend':'MyXSpend','ampay':'AmPay','ampay_try':_0x1e42e1(0x1af),'sepa':_0x1e42e1(0x215),'interac':_0x1e42e1(0x2b2),'onramp':_0x1e42e1(0x248),'squirrelpay':_0x1e42e1(0x291),'maxpara':_0x1e42e1(0x23f),'instaxchange':'InstaXchange','oxapay':_0x1e42e1(0x23a)};return _0xf84520[_0x17d115]||_0x17d115;}[a53_0x4bdb09(0x197)](_0x3932c6){const _0x2ff393=a53_0x4bdb09,_0x36a053={'Test\x20Gateway':'test_gateway','Plisio':_0x2ff393(0x292),'Rapyd':_0x2ff393(0x295),'Noda':_0x2ff393(0x179),'CoinToPay':'cointopay','CoinToPay2':_0x2ff393(0x173),'KLYME\x20EU':_0x2ff393(0x22a),'KLYME\x20GB':_0x2ff393(0x170),'KLYME\x20DE':_0x2ff393(0x152),'MasterCard':_0x2ff393(0x121)};return _0x36a053[_0x3932c6]||_0x3932c6['toLowerCase']();}async[a53_0x4bdb09(0x142)](_0x1e133b){const _0x555b7a=a53_0x4bdb09,{page:_0x31b9de,limit:_0x388c28,minAmount:_0x5f1d74,search:_0x4765b9}=_0x1e133b;console[_0x555b7a(0x26c)]('ðŸ“Š\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:',_0x1e133b);let _0x21eb74={};_0x4765b9&&(_0x21eb74[_0x555b7a(0x190)]={'contains':_0x4765b9,'mode':'insensitive'});const _0x1fc882=await database_1[_0x555b7a(0x28a)][_0x555b7a(0x1c8)][_0x555b7a(0x10e)]({'where':_0x21eb74,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),_0x3346cf=_0x1fc882[_0x555b7a(0x258)](_0x1f85ba=>{const _0x496d9e=_0x555b7a,_0x4e84cf=Math[_0x496d9e(0x221)](_0x1f85ba[_0x496d9e(0x2a8)]*0x64)/0x64;if(_0x5f1d74&&_0x4e84cf<_0x5f1d74)return![];return _0x4e84cf!==0x0;});_0x3346cf[_0x555b7a(0x19c)]((_0x251935,_0x456519)=>_0x456519['balance']-_0x251935[_0x555b7a(0x2a8)]);const _0x206809=_0x3346cf[_0x555b7a(0x296)],_0x1a4df7=(_0x31b9de-0x1)*_0x388c28,_0x232ebf=_0x3346cf['slice'](_0x1a4df7,_0x1a4df7+_0x388c28);console[_0x555b7a(0x26c)](_0x555b7a(0x2c9)+_0x232ebf[_0x555b7a(0x296)]+'\x20merchants\x20with\x20rounded\x20balance\x20!=\x200.00\x20(excluding\x20balances\x20that\x20round\x20to\x200.00)');const _0x2f320f=await Promise['all'](_0x232ebf[_0x555b7a(0x12b)](async _0x285a77=>{const _0x4dd0a0=_0x555b7a,[_0x15022a,_0x38e795,_0x11d584]=await Promise[_0x4dd0a0(0x181)]([database_1[_0x4dd0a0(0x28a)]['payment'][_0x4dd0a0(0x129)]({'where':{'shopId':_0x285a77['id'],'status':_0x4dd0a0(0x2cf),'gateway':{'not':_0x4dd0a0(0x2a4)}}}),database_1[_0x4dd0a0(0x28a)]['payment']['findFirst']({'where':{'shopId':_0x285a77['id'],'status':_0x4dd0a0(0x2cf),'gateway':{'not':_0x4dd0a0(0x2a4)}},'orderBy':{'paidAt':'asc'},'select':{'paidAt':!![]}}),database_1[_0x4dd0a0(0x28a)]['payment'][_0x4dd0a0(0x209)]({'by':[_0x4dd0a0(0x139)],'where':{'shopId':_0x285a77['id'],'status':_0x4dd0a0(0x2cf),'gateway':{'not':_0x4dd0a0(0x2a4)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x694ecf=new Date(),_0x2974fb=new Date(_0x694ecf[_0x4dd0a0(0x14b)](),_0x694ecf[_0x4dd0a0(0x1dd)](),0x1),_0x36842a=new Date(_0x694ecf[_0x4dd0a0(0x14b)](),_0x694ecf['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x5a7354,_0x41b433]=await Promise[_0x4dd0a0(0x181)]([database_1[_0x4dd0a0(0x28a)][_0x4dd0a0(0x1bf)]['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x285a77['id'],'status':_0x4dd0a0(0x1be)}}),database_1[_0x4dd0a0(0x28a)]['payout'][_0x4dd0a0(0x2b4)]({'_sum':{'amount':!![]},'where':{'shopId':_0x285a77['id'],'status':_0x4dd0a0(0x1be),'createdAt':{'gte':_0x2974fb,'lte':_0x36842a}}})]),_0x55f246=_0x5a7354[_0x4dd0a0(0x282)]['amount']||0x0,_0x4e6078=_0x41b433[_0x4dd0a0(0x282)][_0x4dd0a0(0x2c7)]||0x0,_0x5d69ce=await Promise['all'](_0x11d584[_0x4dd0a0(0x12b)](async _0x435481=>{const _0x5f275d=_0x4dd0a0,_0x1fb7ab=await database_1[_0x5f275d(0x28a)]['payment'][_0x5f275d(0x10e)]({'where':{'shopId':_0x285a77['id'],'status':_0x5f275d(0x2cf),'gateway':_0x435481[_0x5f275d(0x139)]},'select':{'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![]}});let _0x1432a=0x2d;if(_0x285a77[_0x5f275d(0x1b9)])try{const _0x520e84=JSON[_0x5f275d(0x174)](_0x285a77[_0x5f275d(0x1b9)]);for(const [_0x4a0825,_0x1ec1a5]of Object['entries'](_0x520e84)){if(_0x4a0825['toLowerCase']()===_0x435481[_0x5f275d(0x139)][_0x5f275d(0x14f)]()){_0x1432a=_0x1ec1a5[_0x5f275d(0x22f)]||0xa,console[_0x5f275d(0x26c)](_0x5f275d(0x1f9)+_0x435481[_0x5f275d(0x139)]+_0x5f275d(0x188)+_0x285a77['id']+_0x5f275d(0x1bd)+_0x1432a+'%');break;}}}catch(_0x3a15e0){console[_0x5f275d(0x1cf)]('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x285a77['id']+':',_0x3a15e0);}const _0x26e164=_0x435481[_0x5f275d(0x282)]?.['amountUSDT']||0x0;let _0x1f4687=0x0;for(const _0xd0f84 of _0x1fb7ab){if(_0xd0f84[_0x5f275d(0x1d7)]!==null&&_0xd0f84[_0x5f275d(0x1d7)]!==undefined)_0x1f4687+=_0xd0f84[_0x5f275d(0x1d7)];else{const _0x5b2f0b=_0xd0f84['amountUSDT']||0x0;_0x1f4687+=_0x5b2f0b*(0x1-_0x1432a/0x64);}}return{'gateway':_0x435481['gateway'],'count':_0x435481[_0x5f275d(0x13f)]?.['id']||0x0,'amountUSDT':Math[_0x5f275d(0x29a)](_0x26e164*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x5f275d(0x29a)](_0x1f4687*0x64)/0x64,'commission':_0x1432a};})),_0x1c8a5e=_0x5d69ce[_0x4dd0a0(0x17b)]((_0x1ef410,_0x56a479)=>_0x1ef410+_0x56a479[_0x4dd0a0(0x1c1)],0x0),_0x24cbbf=_0x5d69ce[_0x4dd0a0(0x17b)]((_0x459672,_0x39cd44)=>_0x459672+_0x39cd44[_0x4dd0a0(0x1f0)],0x0),_0x28817c=_0x285a77['balance'];return console[_0x4dd0a0(0x26c)](_0x4dd0a0(0x25b)+_0x285a77[_0x4dd0a0(0x15a)]+':'),console['log'](_0x4dd0a0(0x228)+_0x1c8a5e['toFixed'](0x2)+'\x20USDT\x20(gross\x20revenue)'),console[_0x4dd0a0(0x26c)]('\x20\x20\x20ðŸ”\x20Calculated\x20after\x20commission:\x20'+_0x24cbbf[_0x4dd0a0(0x259)](0x2)+'\x20USDT\x20(theoretical\x20net)'),console[_0x4dd0a0(0x26c)](_0x4dd0a0(0x2be)+_0x28817c[_0x4dd0a0(0x259)](0x2)+'\x20USDT\x20(current\x20balance\x20in\x20DB)'),console[_0x4dd0a0(0x26c)](_0x4dd0a0(0x223)+_0x55f246['toFixed'](0x2)+'\x20USDT\x20(already\x20paid\x20out)'),console[_0x4dd0a0(0x26c)](_0x4dd0a0(0x283)+(_0x24cbbf-_0x55f246-_0x28817c)[_0x4dd0a0(0x259)](0x2)+_0x4dd0a0(0x137)),{'id':_0x285a77['id'],'fullName':_0x285a77['name'],'username':_0x285a77[_0x4dd0a0(0x15a)],'telegramId':_0x285a77[_0x4dd0a0(0x229)],'merchantUrl':_0x285a77[_0x4dd0a0(0x17a)],'wallets':{'usdtPolygonWallet':_0x285a77['usdtPolygonWallet'],'usdtTrcWallet':_0x285a77['usdtTrcWallet'],'usdtErcWallet':_0x285a77['usdtErcWallet'],'usdcPolygonWallet':_0x285a77[_0x4dd0a0(0x204)],'usdcErcWallet':_0x285a77[_0x4dd0a0(0x19e)]},'totalAmountUSDT':Math['round'](_0x1c8a5e*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x4dd0a0(0x29a)](_0x24cbbf*0x64)/0x64,'currentBalance':Math[_0x4dd0a0(0x221)](_0x28817c*0x64)/0x64,'totalPayout':Math[_0x4dd0a0(0x29a)](_0x55f246*0x64)/0x64,'thisMonth':Math[_0x4dd0a0(0x29a)](_0x4e6078*0x64)/0x64,'paymentsCount':_0x15022a,'oldestPaymentDate':_0x38e795?.[_0x4dd0a0(0x29c)]||_0x285a77['createdAt'],'gatewayBreakdown':_0x5d69ce};})),_0x43a520=_0x2f320f[_0x555b7a(0x17b)]((_0x3e4d83,_0x1ba3ba)=>_0x3e4d83+_0x1ba3ba[_0x555b7a(0x148)],0x0),_0x24f314=_0x2f320f['reduce']((_0xa078dd,_0x27b9fe)=>_0xa078dd+_0x27b9fe[_0x555b7a(0x193)],0x0),_0x27c0f4=_0x2f320f[_0x555b7a(0x17b)]((_0xe62438,_0x3091e4)=>_0xe62438+_0x3091e4['totalPayout'],0x0),_0x1b98d5=_0x2f320f[_0x555b7a(0x17b)]((_0x20bc02,_0x4cd4c8)=>_0x20bc02+_0x4cd4c8['thisMonth'],0x0);return console['log']('ðŸ“Š\x20Merchants\x20with\x20rounded\x20balance\x20!=\x200.00:\x20'+_0x206809+_0x555b7a(0x1fb)),console[_0x555b7a(0x26c)]('\x20\x20\x20ðŸ’°\x20Total\x20payments\x20turnover:\x20'+Math[_0x555b7a(0x29a)](_0x43a520*0x64)/0x64+'\x20USDT\x20(gross\x20revenue)'),console[_0x555b7a(0x26c)](_0x555b7a(0x1f8)+Math[_0x555b7a(0x29a)](_0x24f314*0x64)/0x64+_0x555b7a(0x2bb)),console[_0x555b7a(0x26c)](_0x555b7a(0x1d8)+Math[_0x555b7a(0x29a)](_0x27c0f4*0x64)/0x64+_0x555b7a(0x29b)),console[_0x555b7a(0x26c)](_0x555b7a(0x151)+Math[_0x555b7a(0x29a)](_0x1b98d5*0x64)/0x64+_0x555b7a(0x29b)),{'merchants':_0x2f320f,'pagination':{'page':_0x31b9de,'limit':_0x388c28,'total':_0x206809,'totalPages':Math[_0x555b7a(0x153)](_0x206809/_0x388c28)},'summary':{'totalMerchants':_0x206809,'totalAmountUSDT':Math[_0x555b7a(0x29a)](_0x43a520*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x555b7a(0x29a)](_0x24f314*0x64)/0x64,'totalPayout':Math['round'](_0x27c0f4*0x64)/0x64,'thisMonth':Math[_0x555b7a(0x29a)](_0x1b98d5*0x64)/0x64}};}async[a53_0x4bdb09(0x22b)](_0x3b47ba){const _0x45f8c5=a53_0x4bdb09,{shopId:_0x5d69aa,amount:_0x2c4d78,network:_0x24cc6e,wallet:_0xe50b09,notes:_0x1a61f3,txid:_0x347724,periodFrom:_0x383635,periodTo:_0x176cc1}=_0x3b47ba,_0x483953=await database_1[_0x45f8c5(0x28a)]['$transaction'](async _0x373e04=>{const _0xdafc35=_0x45f8c5,_0x414180=await _0x373e04[_0xdafc35(0x1c8)]['findUnique']({'where':{'id':_0x5d69aa},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x414180)throw new Error('Shop\x20not\x20found');console[_0xdafc35(0x26c)]('ðŸ’°\x20Creating\x20payout\x20for\x20shop\x20'+_0x414180[_0xdafc35(0x15a)]+':'),console[_0xdafc35(0x26c)]('\x20\x20\x20Current\x20balance:\x20'+_0x414180[_0xdafc35(0x2a8)][_0xdafc35(0x259)](0x6)+_0xdafc35(0x29b)),console['log'](_0xdafc35(0x2d3)+_0x2c4d78[_0xdafc35(0x259)](0x6)+_0xdafc35(0x29b)),console[_0xdafc35(0x26c)](_0xdafc35(0x1db)+_0x414180[_0xdafc35(0x168)][_0xdafc35(0x259)](0x6)+_0xdafc35(0x29b));if(_0x347724)console[_0xdafc35(0x26c)](_0xdafc35(0x1fd)+_0x347724);const _0x3f3db6=0.000001,_0x393c46=Number(_0x414180['balance']),_0x2b8a17=Number(_0x2c4d78);console[_0xdafc35(0x26c)](_0xdafc35(0x2b5)),console['log'](_0xdafc35(0x1d1)+_0x414180[_0xdafc35(0x2a8)]),console['log'](_0xdafc35(0x123)+_0x393c46),console[_0xdafc35(0x26c)](_0xdafc35(0x17f)+_0x2b8a17),console['log'](_0xdafc35(0x274)+(_0x393c46-_0x2b8a17)),console[_0xdafc35(0x26c)]('\x20\x20\x20Tolerance:\x20'+_0x3f3db6);if(_0x393c46<_0x2b8a17-_0x3f3db6)throw new Error('Insufficient\x20balance.\x20Available:\x20'+_0x393c46[_0xdafc35(0x259)](0x6)+_0xdafc35(0x26f)+_0x2b8a17[_0xdafc35(0x259)](0x6)+'\x20USDT,\x20Difference:\x20'+(_0x393c46-_0x2b8a17)[_0xdafc35(0x259)](0x8)+_0xdafc35(0x29b));console[_0xdafc35(0x26c)](_0xdafc35(0x1e5));const _0x5c907b=Math[_0xdafc35(0x273)](_0x393c46,_0x2b8a17);let _0x4f6ce4=_0xe50b09;console[_0xdafc35(0x26c)](_0xdafc35(0x262)+(_0xe50b09||_0xdafc35(0x1ca)));if(!_0x4f6ce4){console[_0xdafc35(0x26c)](_0xdafc35(0x1c9));const _0x140c56=await _0x373e04[_0xdafc35(0x1c8)][_0xdafc35(0x2a1)]({'where':{'id':_0x5d69aa},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});console[_0xdafc35(0x26c)]('ðŸ”\x20Shop\x20wallets:',_0x140c56);if(_0x140c56)switch(_0x24cc6e){case'polygon':_0x4f6ce4=_0x140c56[_0xdafc35(0x2ab)]||undefined,console[_0xdafc35(0x26c)](_0xdafc35(0x160)+_0x4f6ce4);break;case _0xdafc35(0x287):_0x4f6ce4=_0x140c56[_0xdafc35(0x28b)]||undefined,console['log'](_0xdafc35(0x166)+_0x4f6ce4);break;case'erc20':_0x4f6ce4=_0x140c56['usdtErcWallet']||undefined,console[_0xdafc35(0x26c)](_0xdafc35(0x288)+_0x4f6ce4);break;case _0xdafc35(0x25f):_0x4f6ce4=_0x140c56[_0xdafc35(0x204)]||undefined,console[_0xdafc35(0x26c)](_0xdafc35(0x281)+_0x4f6ce4);break;case _0xdafc35(0x126):_0x4f6ce4=_0x140c56[_0xdafc35(0x19e)]||undefined,console[_0xdafc35(0x26c)](_0xdafc35(0x25a)+_0x4f6ce4);break;}}else console[_0xdafc35(0x26c)]('âœ…\x20Using\x20wallet\x20from\x20request:\x20'+_0x4f6ce4);console[_0xdafc35(0x26c)](_0xdafc35(0x284)+_0x24cc6e+':\x20'+(_0x4f6ce4||_0xdafc35(0x231))),console[_0xdafc35(0x26c)](_0xdafc35(0x10f),{'shopId':_0x5d69aa,'amount':_0x5c907b,'network':_0x24cc6e,'wallet':_0x4f6ce4,'status':_0xdafc35(0x1be),'txid':_0x347724,'notes':_0x1a61f3,'periodFrom':_0x383635?new Date(_0x383635):null,'periodTo':_0x176cc1?new Date(_0x176cc1):null});const _0x1c09d2=await _0x373e04[_0xdafc35(0x1bf)]['create']({'data':{'shopId':_0x5d69aa,'amount':_0x5c907b,'network':_0x24cc6e,'wallet':_0x4f6ce4,'status':_0xdafc35(0x1be),'txid':_0x347724,'notes':_0x1a61f3,'periodFrom':_0x383635?new Date(_0x383635):null,'periodTo':_0x176cc1?new Date(_0x176cc1):null,'createdAt':new Date(),'paidAt':new Date()}});console[_0xdafc35(0x26c)](_0xdafc35(0x2ad),{'id':_0x1c09d2['id'],'wallet':_0x1c09d2['wallet'],'network':_0x1c09d2[_0xdafc35(0x191)],'amount':_0x1c09d2[_0xdafc35(0x2c7)]});const _0x182155=_0x393c46-_0x5c907b,_0x154828=Number(_0x414180[_0xdafc35(0x168)])+_0x5c907b;return await _0x373e04[_0xdafc35(0x1c8)]['update']({'where':{'id':_0x5d69aa},'data':{'balance':_0x182155,'totalPaidOut':_0x154828}}),console[_0xdafc35(0x26c)](_0xdafc35(0x194)+_0x414180[_0xdafc35(0x15a)]+_0xdafc35(0x1bb)),console[_0xdafc35(0x26c)](_0xdafc35(0x2bd)+_0x393c46['toFixed'](0x6)+_0xdafc35(0x14e)+_0x182155[_0xdafc35(0x259)](0x6)+_0xdafc35(0x13c)+_0x5c907b[_0xdafc35(0x259)](0x6)+')'),console[_0xdafc35(0x26c)]('\x20\x20\x20Total\x20paid\x20out:\x20'+_0x414180[_0xdafc35(0x168)][_0xdafc35(0x259)](0x6)+_0xdafc35(0x14e)+_0x154828['toFixed'](0x6)+_0xdafc35(0x169)+_0x5c907b['toFixed'](0x6)+')'),console[_0xdafc35(0x26c)](_0xdafc35(0x134)+_0x5c907b[_0xdafc35(0x259)](0x6)+_0xdafc35(0x29b)),{'payout':_0x1c09d2,'shop':_0x414180};});console['log'](_0x45f8c5(0x290)+_0x483953['payout']['id']+_0x45f8c5(0x188)+_0x483953['shop']['username']+'\x20('+_0x483953['payout']['amount']['toFixed'](0x6)+'\x20USDT)');try{let _0x36b4e0=_0x45f8c5(0x1e3);if(_0x483953['payout'][_0x45f8c5(0x285)]&&_0x483953['payout'][_0x45f8c5(0x20c)]){const _0x1e6b1e=new Date(_0x483953['payout'][_0x45f8c5(0x285)])['toLocaleDateString'](_0x45f8c5(0x13e)),_0x97f918=new Date(_0x483953[_0x45f8c5(0x1bf)][_0x45f8c5(0x20c)])[_0x45f8c5(0x2b1)](_0x45f8c5(0x13e));_0x36b4e0=_0x1e6b1e+_0x45f8c5(0x226)+_0x97f918;}await telegramBotService_1['telegramBotService']['sendPayoutNotification'](_0x483953['payout']['shopId'],{'id':_0x483953['payout']['id'],'amount':_0x483953['payout'][_0x45f8c5(0x2c7)],'network':_0x483953[_0x45f8c5(0x1bf)][_0x45f8c5(0x191)],'wallet':_0x483953[_0x45f8c5(0x1bf)][_0x45f8c5(0x13d)],'period':_0x36b4e0,'createdAt':_0x483953[_0x45f8c5(0x1bf)][_0x45f8c5(0x1c5)],'txid':_0x483953[_0x45f8c5(0x1bf)]['txid']}),console[_0x45f8c5(0x26c)](_0x45f8c5(0x187)+_0x483953[_0x45f8c5(0x1bf)]['id']);}catch(_0x53cdaf){console[_0x45f8c5(0x1cf)](_0x45f8c5(0x18c)+_0x483953[_0x45f8c5(0x1bf)]['id']+':',_0x53cdaf);}return{'id':_0x483953[_0x45f8c5(0x1bf)]['id'],'shopId':_0x483953[_0x45f8c5(0x1bf)][_0x45f8c5(0x24f)],'shopName':_0x483953['shop'][_0x45f8c5(0x190)],'shopUsername':_0x483953[_0x45f8c5(0x1c8)][_0x45f8c5(0x15a)],'amount':_0x483953['payout']['amount'],'network':_0x483953[_0x45f8c5(0x1bf)][_0x45f8c5(0x191)],'wallet':_0x483953[_0x45f8c5(0x1bf)][_0x45f8c5(0x13d)],'status':_0x483953['payout'][_0x45f8c5(0x22c)],'txid':_0x483953[_0x45f8c5(0x1bf)][_0x45f8c5(0x1ab)],'notes':_0x483953[_0x45f8c5(0x1bf)][_0x45f8c5(0x2bc)],'periodFrom':_0x483953[_0x45f8c5(0x1bf)][_0x45f8c5(0x285)],'periodTo':_0x483953['payout'][_0x45f8c5(0x20c)],'createdAt':_0x483953[_0x45f8c5(0x1bf)][_0x45f8c5(0x1c5)],'paidAt':_0x483953['payout'][_0x45f8c5(0x29c)]};}async['getAllPayouts'](_0x3e96a5){const _0x53fffb=a53_0x4bdb09,{page:_0x3c7dab,limit:_0x2aa8fd,shopId:_0x28316e,network:_0x3605c4,dateFrom:_0x3fca9e,dateTo:_0x5105a5,search:_0x42a336}=_0x3e96a5,_0x4bbd6e=(_0x3c7dab-0x1)*_0x2aa8fd,_0x41ccb6={};_0x28316e&&(_0x41ccb6['shopId']=_0x28316e);_0x3605c4&&(_0x41ccb6[_0x53fffb(0x191)]=_0x3605c4);if(_0x3fca9e||_0x5105a5){_0x41ccb6['createdAt']={};if(_0x3fca9e){const _0x222789=new Date(_0x3fca9e);_0x222789[_0x53fffb(0x1b3)](0x0,0x0,0x0,0x1),_0x41ccb6['createdAt'][_0x53fffb(0x1b6)]=_0x222789,console['log']('ðŸ“…\x20Payout\x20date\x20from\x20filter:\x20'+_0x222789['toISOString']());}if(_0x5105a5){const _0x3b40c7=new Date(_0x5105a5);_0x3b40c7[_0x53fffb(0x1b3)](0x17,0x3b,0x3b,0x3e7),_0x41ccb6[_0x53fffb(0x1c5)][_0x53fffb(0x196)]=_0x3b40c7,console[_0x53fffb(0x26c)]('ðŸ“…\x20Payout\x20date\x20to\x20filter:\x20'+_0x3b40c7[_0x53fffb(0x1ce)]());}}_0x42a336&&(_0x41ccb6['OR']=[{'shop':{'name':{'contains':_0x42a336,'mode':_0x53fffb(0x167)}}},{'shop':{'username':{'contains':_0x42a336,'mode':_0x53fffb(0x167)}}},{'notes':{'contains':_0x42a336,'mode':_0x53fffb(0x167)}}]);const [_0x1bf1ac,_0x4d485a]=await Promise[_0x53fffb(0x181)]([database_1[_0x53fffb(0x28a)]['payout'][_0x53fffb(0x10e)]({'where':_0x41ccb6,'skip':_0x4bbd6e,'take':_0x2aa8fd,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'wallet':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x53fffb(0x28a)][_0x53fffb(0x1bf)][_0x53fffb(0x129)]({'where':_0x41ccb6})]);return{'payouts':_0x1bf1ac[_0x53fffb(0x12b)](_0xe66303=>({'id':_0xe66303['id'],'shopId':_0xe66303[_0x53fffb(0x24f)],'shopName':_0xe66303[_0x53fffb(0x1c8)][_0x53fffb(0x190)],'shopUsername':_0xe66303[_0x53fffb(0x1c8)]['username'],'amount':_0xe66303[_0x53fffb(0x2c7)],'network':_0xe66303[_0x53fffb(0x191)],'wallet':_0xe66303[_0x53fffb(0x13d)],'status':_0xe66303['status'],'txid':_0xe66303[_0x53fffb(0x1ab)],'notes':_0xe66303[_0x53fffb(0x2bc)],'periodFrom':_0xe66303[_0x53fffb(0x285)],'periodTo':_0xe66303['periodTo'],'createdAt':_0xe66303[_0x53fffb(0x1c5)],'paidAt':_0xe66303[_0x53fffb(0x29c)]})),'pagination':{'page':_0x3c7dab,'limit':_0x2aa8fd,'total':_0x4d485a,'totalPages':Math['ceil'](_0x4d485a/_0x2aa8fd)}};}async[a53_0x4bdb09(0x260)](_0x37f384){const _0x1b69ee=a53_0x4bdb09,_0x3e1782=await database_1['default'][_0x1b69ee(0x1bf)]['findUnique']({'where':{'id':_0x37f384},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x3e1782)return null;return{'id':_0x3e1782['id'],'shopId':_0x3e1782[_0x1b69ee(0x24f)],'shopName':_0x3e1782[_0x1b69ee(0x1c8)][_0x1b69ee(0x190)],'shopUsername':_0x3e1782[_0x1b69ee(0x1c8)][_0x1b69ee(0x15a)],'amount':_0x3e1782['amount'],'network':_0x3e1782['network'],'wallet':_0x3e1782[_0x1b69ee(0x13d)],'status':_0x3e1782[_0x1b69ee(0x22c)],'txid':_0x3e1782['txid'],'notes':_0x3e1782[_0x1b69ee(0x2bc)],'periodFrom':_0x3e1782[_0x1b69ee(0x285)],'periodTo':_0x3e1782['periodTo'],'createdAt':_0x3e1782[_0x1b69ee(0x1c5)],'paidAt':_0x3e1782['paidAt']};}async['deletePayout'](_0xb606ad){const _0x1b0401=a53_0x4bdb09;await database_1[_0x1b0401(0x28a)]['payout'][_0x1b0401(0x234)]({'where':{'id':_0xb606ad}});}async[a53_0x4bdb09(0x24c)](_0x2820a8,_0x89d82d){const _0x532420=a53_0x4bdb09,_0x1a910c=await database_1['default'][_0x532420(0x2ba)](async _0x16bd82=>{const _0x1a5562=_0x532420,_0x5bcaba=await _0x16bd82[_0x1a5562(0x1bf)][_0x1a5562(0x2a1)]({'where':{'id':_0x2820a8},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}}}});if(!_0x5bcaba)throw new Error(_0x1a5562(0x1aa));console[_0x1a5562(0x26c)](_0x1a5562(0x13b)+_0x2820a8+_0x1a5562(0x188)+_0x5bcaba[_0x1a5562(0x1c8)][_0x1a5562(0x15a)]+':'),console[_0x1a5562(0x26c)](_0x1a5562(0x26d)+_0x5bcaba['amount'][_0x1a5562(0x259)](0x6)+_0x1a5562(0x29b)),console['log']('\x20\x20\x20Current\x20network:\x20'+_0x5bcaba[_0x1a5562(0x191)]),console[_0x1a5562(0x26c)]('\x20\x20\x20Shop\x20balance:\x20'+_0x5bcaba['shop'][_0x1a5562(0x2a8)][_0x1a5562(0x259)](0x6)+_0x1a5562(0x29b)),console[_0x1a5562(0x26c)](_0x1a5562(0x16f)+_0x5bcaba['shop']['totalPaidOut'][_0x1a5562(0x259)](0x6)+_0x1a5562(0x29b));let _0x2d8930=0x0;if(_0x89d82d[_0x1a5562(0x2c7)]!==undefined){const _0x3871fe=Number(_0x5bcaba['amount']),_0x2c4782=Number(_0x89d82d[_0x1a5562(0x2c7)]);_0x2d8930=_0x2c4782-_0x3871fe,console[_0x1a5562(0x26c)](_0x1a5562(0x256)+_0x2c4782[_0x1a5562(0x259)](0x6)+_0x1a5562(0x29b)),console[_0x1a5562(0x26c)](_0x1a5562(0x220)+_0x2d8930['toFixed'](0x6)+_0x1a5562(0x29b));if(_0x2d8930<0x0)console[_0x1a5562(0x26c)](_0x1a5562(0x116)+Math[_0x1a5562(0x268)](_0x2d8930)[_0x1a5562(0x259)](0x6)+_0x1a5562(0x21a));else{if(_0x2d8930>0x0){const _0x17e503=Number(_0x5bcaba['shop'][_0x1a5562(0x2a8)]);console[_0x1a5562(0x26c)](_0x1a5562(0x1c4)+_0x2d8930[_0x1a5562(0x259)](0x6)+_0x1a5562(0x11b));if(_0x17e503<_0x2d8930)throw new Error(_0x1a5562(0x185)+_0x17e503[_0x1a5562(0x259)](0x6)+'\x20USDT,\x20Required:\x20'+_0x2d8930['toFixed'](0x6)+_0x1a5562(0x29b));}}}const _0x3b2bc9={};if(_0x89d82d[_0x1a5562(0x2c7)]!==undefined)_0x3b2bc9[_0x1a5562(0x2c7)]=_0x89d82d[_0x1a5562(0x2c7)];if(_0x89d82d[_0x1a5562(0x191)]!==undefined)_0x3b2bc9['network']=_0x89d82d[_0x1a5562(0x191)];if(_0x89d82d[_0x1a5562(0x13d)]!==undefined)_0x3b2bc9[_0x1a5562(0x13d)]=_0x89d82d[_0x1a5562(0x13d)]||null;if(_0x89d82d[_0x1a5562(0x2bc)]!==undefined)_0x3b2bc9[_0x1a5562(0x2bc)]=_0x89d82d[_0x1a5562(0x2bc)]||null;if(_0x89d82d[_0x1a5562(0x1ab)]!==undefined)_0x3b2bc9[_0x1a5562(0x1ab)]=_0x89d82d[_0x1a5562(0x1ab)]||null;if(_0x89d82d['periodFrom']!==undefined)_0x3b2bc9[_0x1a5562(0x285)]=_0x89d82d[_0x1a5562(0x285)]?new Date(_0x89d82d[_0x1a5562(0x285)]):null;if(_0x89d82d[_0x1a5562(0x20c)]!==undefined)_0x3b2bc9[_0x1a5562(0x20c)]=_0x89d82d[_0x1a5562(0x20c)]?new Date(_0x89d82d[_0x1a5562(0x20c)]):null;const _0x1787d0=await _0x16bd82[_0x1a5562(0x1bf)][_0x1a5562(0x2ce)]({'where':{'id':_0x2820a8},'data':_0x3b2bc9,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(_0x2d8930!==0x0){const _0x43c6a7=Number(_0x5bcaba[_0x1a5562(0x1c8)][_0x1a5562(0x2a8)]),_0x5acfe7=Number(_0x5bcaba[_0x1a5562(0x1c8)][_0x1a5562(0x168)]),_0x1ffe18=_0x43c6a7-_0x2d8930,_0x22661a=_0x5acfe7+_0x2d8930;await _0x16bd82['shop'][_0x1a5562(0x2ce)]({'where':{'id':_0x5bcaba[_0x1a5562(0x24f)]},'data':{'balance':_0x1ffe18,'totalPaidOut':_0x22661a}}),console[_0x1a5562(0x26c)]('ðŸ’°\x20Shop\x20'+_0x5bcaba[_0x1a5562(0x1c8)][_0x1a5562(0x15a)]+_0x1a5562(0x1bb)),console[_0x1a5562(0x26c)]('\x20\x20\x20Balance:\x20'+_0x43c6a7[_0x1a5562(0x259)](0x6)+_0x1a5562(0x14e)+_0x1ffe18[_0x1a5562(0x259)](0x6)+_0x1a5562(0x29b)),console['log'](_0x1a5562(0x132)+_0x5acfe7[_0x1a5562(0x259)](0x6)+_0x1a5562(0x14e)+_0x22661a[_0x1a5562(0x259)](0x6)+_0x1a5562(0x29b));}return console['log']('âœ…\x20Payout\x20'+_0x2820a8+_0x1a5562(0x172)),_0x1787d0;});return{'id':_0x1a910c['id'],'shopId':_0x1a910c[_0x532420(0x24f)],'shopName':_0x1a910c['shop']['name'],'shopUsername':_0x1a910c[_0x532420(0x1c8)][_0x532420(0x15a)],'amount':Number(_0x1a910c['amount']),'network':_0x1a910c[_0x532420(0x191)],'wallet':_0x1a910c[_0x532420(0x13d)],'status':_0x1a910c['status'],'txid':_0x1a910c[_0x532420(0x1ab)],'notes':_0x1a910c[_0x532420(0x2bc)],'periodFrom':_0x1a910c[_0x532420(0x285)],'periodTo':_0x1a910c[_0x532420(0x20c)],'createdAt':_0x1a910c[_0x532420(0x1c5)],'paidAt':_0x1a910c[_0x532420(0x29c)]};}async[a53_0x4bdb09(0x2aa)](_0x4d05e1){const _0x2b78d2=a53_0x4bdb09,{page:_0x5123f1,limit:_0x44e308,status:_0x162e00,gateway:_0x1b28b6,shopId:_0xb5329e,dateFrom:_0x3e6786,dateTo:_0x3a86b0,search:_0x2adb89,currency:_0x159845,sortBy:_0x37ba49,sortOrder:_0x231646}=_0x4d05e1,_0xca03c7=(_0x5123f1-0x1)*_0x44e308;console[_0x2b78d2(0x26c)](_0x2b78d2(0x218),_0x4d05e1);const _0x51227a=await database_1[_0x2b78d2(0x28a)][_0x2b78d2(0x149)][_0x2b78d2(0x209)]({'by':['gateway'],'_count':{'gateway':!![]}});console[_0x2b78d2(0x26c)](_0x2b78d2(0x269),_0x51227a[_0x2b78d2(0x12b)](_0x3d7d1c=>_0x3d7d1c[_0x2b78d2(0x139)]+'\x20('+_0x3d7d1c[_0x2b78d2(0x13f)][_0x2b78d2(0x139)]+'\x20payments)'));if(_0x1b28b6){const _0x2d58bf=_0x51227a[_0x2b78d2(0x20b)](_0x1fb595=>_0x1fb595[_0x2b78d2(0x139)][_0x2b78d2(0x14f)]()===_0x1b28b6[_0x2b78d2(0x14f)]());!_0x2d58bf&&_0x1b28b6[_0x2b78d2(0x14f)]()!==_0x2b78d2(0x2a4)&&console[_0x2b78d2(0x26c)]('âš ï¸\x20Requested\x20gateway\x20\x27'+_0x1b28b6+'\x27\x20not\x20found.\x20Available\x20gateways:\x20'+_0x51227a['map'](_0x5e7929=>_0x5e7929[_0x2b78d2(0x139)])['join'](',\x20'));}const _0x965bd={};_0x162e00&&(_0x965bd[_0x2b78d2(0x22c)]=_0x162e00[_0x2b78d2(0x184)]());if(!_0x1b28b6)_0x965bd[_0x2b78d2(0x139)]={'not':_0x2b78d2(0x2a4)};else{if(_0x1b28b6&&(_0x1b28b6[_0x2b78d2(0x14f)]()===_0x2b78d2(0x2a4)||_0x1b28b6===_0x2b78d2(0x25c)))_0x965bd['gateway']=_0x2b78d2(0x2a4);else{let _0x46d628=_0x1b28b6;const _0x593427=(0x0,gateway_1[_0x2b78d2(0x125)])(_0x1b28b6);if(_0x593427)_0x46d628=_0x593427,console[_0x2b78d2(0x26c)](_0x2b78d2(0x2c6)+_0x1b28b6+_0x2b78d2(0x17e)+_0x46d628+'\x27');else{const _0xea4a85=(0x0,gateway_1[_0x2b78d2(0x141)])(_0x1b28b6);if(_0xea4a85){const _0x184662=(0x0,gateway_1[_0x2b78d2(0x125)])(_0xea4a85);_0x184662&&(_0x46d628=_0x184662,console[_0x2b78d2(0x26c)](_0x2b78d2(0x150)+_0x1b28b6+_0x2b78d2(0x2c0)+_0xea4a85+_0x2b78d2(0x206)+_0x46d628+'\x27'));}else console[_0x2b78d2(0x26c)](_0x2b78d2(0x1b8)+_0x1b28b6+_0x2b78d2(0x189));}const _0x4b4f34=await database_1[_0x2b78d2(0x28a)][_0x2b78d2(0x149)][_0x2b78d2(0x129)]({'where':{'gateway':_0x46d628['toLowerCase']()},'take':0x1});_0x4b4f34===0x0?(console[_0x2b78d2(0x26c)]('âš ï¸\x20Gateway\x20\x27'+_0x46d628+'\x27\x20(from\x20\x27'+_0x1b28b6+'\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result'),_0x965bd['gateway']=_0x2b78d2(0x21f)):(_0x965bd[_0x2b78d2(0x139)]=_0x46d628[_0x2b78d2(0x14f)](),console[_0x2b78d2(0x26c)](_0x2b78d2(0x26e)+_0x46d628+_0x2b78d2(0x131)+_0x1b28b6+'\x27)'));}}console[_0x2b78d2(0x26c)](_0x2b78d2(0x21c),_0x965bd[_0x2b78d2(0x139)]);_0xb5329e&&(_0x965bd['shopId']=_0xb5329e);_0x159845&&(_0x965bd[_0x2b78d2(0x16b)]=_0x159845[_0x2b78d2(0x184)](),console[_0x2b78d2(0x26c)](_0x2b78d2(0x1d3)+_0x159845[_0x2b78d2(0x184)]()));if(_0x3e6786||_0x3a86b0){_0x965bd[_0x2b78d2(0x1c5)]={};if(_0x3e6786){const _0x1e6dd4=new Date(_0x3e6786),_0x1e3bb6=new Date(Date[_0x2b78d2(0x212)](_0x1e6dd4[_0x2b78d2(0x266)](),_0x1e6dd4[_0x2b78d2(0x1d6)](),_0x1e6dd4[_0x2b78d2(0x154)](),0x0,0x0,0x0,0x0));_0x965bd[_0x2b78d2(0x1c5)]['gte']=_0x1e3bb6,console[_0x2b78d2(0x26c)]('ðŸ“…\x20Date\x20from\x20filter:\x20'+_0x1e3bb6[_0x2b78d2(0x1ce)]());}if(_0x3a86b0){const _0x197987=new Date(_0x3a86b0),_0xafea2f=new Date(Date[_0x2b78d2(0x212)](_0x197987[_0x2b78d2(0x266)](),_0x197987[_0x2b78d2(0x1d6)](),_0x197987[_0x2b78d2(0x154)](),0x17,0x3b,0x3b,0x3e7));_0x965bd[_0x2b78d2(0x1c5)][_0x2b78d2(0x196)]=_0xafea2f,console[_0x2b78d2(0x26c)](_0x2b78d2(0x14c)+_0xafea2f[_0x2b78d2(0x1ce)]());}}_0x2adb89&&(_0x965bd['OR']=[{'id':{'contains':_0x2adb89,'mode':'insensitive'}},{'orderId':{'contains':_0x2adb89,'mode':_0x2b78d2(0x167)}},{'gatewayOrderId':{'contains':_0x2adb89,'mode':_0x2b78d2(0x167)}},{'customerEmail':{'contains':_0x2adb89,'mode':_0x2b78d2(0x167)}},{'shop':{'name':{'contains':_0x2adb89,'mode':_0x2b78d2(0x167)}}},{'shop':{'username':{'contains':_0x2adb89,'mode':'insensitive'}}}]);console[_0x2b78d2(0x26c)]('ðŸ“Š\x20Final\x20WHERE\x20conditions:',JSON[_0x2b78d2(0x162)](_0x965bd,null,0x2));const _0x47cb18=await database_1[_0x2b78d2(0x28a)][_0x2b78d2(0x149)][_0x2b78d2(0x129)]({'where':_0x965bd});console[_0x2b78d2(0x26c)](_0x2b78d2(0x1fa)+_0x47cb18);let _0x4fe6f1={'createdAt':_0x2b78d2(0x111)};if(_0x37ba49){const _0x1c446c=[_0x2b78d2(0x2c7),_0x2b78d2(0x1c5),_0x2b78d2(0x1a5),_0x2b78d2(0x22c),_0x2b78d2(0x139),'currency'],_0x28e70d=[_0x2b78d2(0x1f1),'desc'];if(_0x1c446c['includes'](_0x37ba49)){const _0x40337c=_0x28e70d[_0x2b78d2(0x2a2)](_0x231646)?_0x231646:_0x2b78d2(0x111);_0x4fe6f1={[_0x37ba49]:_0x40337c},console[_0x2b78d2(0x26c)]('ðŸ“Š\x20Sorting\x20payments\x20by\x20'+_0x37ba49+_0x2b78d2(0x294)+_0x40337c+_0x2b78d2(0x239));}}const [_0x65fa1a,_0x531d00]=await Promise[_0x2b78d2(0x181)]([database_1[_0x2b78d2(0x28a)]['payment']['findMany']({'where':_0x965bd,'skip':_0xca03c7,'take':_0x44e308,'orderBy':_0x4fe6f1,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x2b78d2(0x28a)]['payment'][_0x2b78d2(0x129)]({'where':_0x965bd})]);let _0x3279ac,_0x2c53ee;if(_0x3e6786){const _0x2f13c3=new Date(_0x3e6786);_0x3279ac=new Date(Date['UTC'](_0x2f13c3['getUTCFullYear'](),_0x2f13c3[_0x2b78d2(0x1d6)](),_0x2f13c3[_0x2b78d2(0x154)](),0x0,0x0,0x0,0x0));}else{const _0x2d07ea=new Date();_0x3279ac=new Date(Date[_0x2b78d2(0x212)](_0x2d07ea[_0x2b78d2(0x266)](),_0x2d07ea[_0x2b78d2(0x1d6)](),_0x2d07ea[_0x2b78d2(0x154)](),0x0,0x0,0x0,0x0));}if(_0x3a86b0){const _0x3ad8eb=new Date(_0x3a86b0);_0x2c53ee=new Date(Date[_0x2b78d2(0x212)](_0x3ad8eb[_0x2b78d2(0x266)](),_0x3ad8eb[_0x2b78d2(0x1d6)](),_0x3ad8eb[_0x2b78d2(0x154)](),0x17,0x3b,0x3b,0x3e7));}else{if(_0x3e6786){const _0x3a27de=new Date(_0x3e6786);_0x2c53ee=new Date(Date[_0x2b78d2(0x212)](_0x3a27de[_0x2b78d2(0x266)](),_0x3a27de['getUTCMonth'](),_0x3a27de['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}else{const _0x570617=new Date();_0x2c53ee=new Date(Date[_0x2b78d2(0x212)](_0x570617[_0x2b78d2(0x266)](),_0x570617[_0x2b78d2(0x1d6)](),_0x570617[_0x2b78d2(0x154)](),0x17,0x3b,0x3b,0x3e7));}}const _0x22c7e5={};{const _0x52cd9b={'status':_0x162e00?_0x162e00[_0x2b78d2(0x184)]():_0x2b78d2(0x2cf),'createdAt':{'gte':_0x3279ac,'lte':_0x2c53ee}};_0x1b28b6?_0x52cd9b[_0x2b78d2(0x139)]=_0x965bd[_0x2b78d2(0x139)]:_0x52cd9b[_0x2b78d2(0x139)]={'not':_0x2b78d2(0x2a4)};_0xb5329e&&(_0x52cd9b['shopId']=_0xb5329e);_0x159845&&(_0x52cd9b[_0x2b78d2(0x16b)]=_0x159845[_0x2b78d2(0x184)]());console['log'](_0x2b78d2(0x2d6),JSON['stringify'](_0x52cd9b,null,0x2));const _0x581d87=await database_1[_0x2b78d2(0x28a)]['payment']['findMany']({'where':_0x52cd9b,'select':{'amountUSDT':!![],'currency':!![],'amount':!![]}});let _0x3bb368=0x0;_0x581d87[_0x2b78d2(0x293)](_0x3bc67d=>{const _0x59be8f=_0x2b78d2;_0x3bc67d['amountUSDT']&&(_0x3bb368+=_0x3bc67d[_0x59be8f(0x1c1)]);if(_0x3bc67d[_0x59be8f(0x16b)]){const _0x310f66=_0x3bc67d['currency'][_0x59be8f(0x184)]();!_0x22c7e5[_0x310f66]&&(_0x22c7e5[_0x310f66]=0x0),_0x22c7e5[_0x310f66]+=_0x3bc67d[_0x59be8f(0x2c7)];}}),_0x3bb368>0x0&&(_0x22c7e5[_0x2b78d2(0x15c)]=_0x3bb368);}return{'payments':_0x65fa1a,'pagination':{'page':_0x5123f1,'limit':_0x44e308,'total':_0x531d00,'totalPages':Math[_0x2b78d2(0x153)](_0x531d00/_0x44e308)},'statistics':_0x22c7e5};}async[a53_0x4bdb09(0x233)](_0x471003){const _0x31122e=a53_0x4bdb09,_0x33776a=await database_1[_0x31122e(0x28a)][_0x31122e(0x149)]['findUnique']({'where':{'id':_0x471003},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x33776a)return null;return{'id':_0x33776a['id'],'shopId':_0x33776a[_0x31122e(0x24f)],'gateway':_0x33776a['gateway'],'amount':_0x33776a['amount'],'currency':_0x33776a[_0x31122e(0x16b)],'status':_0x33776a[_0x31122e(0x22c)],'orderId':_0x33776a[_0x31122e(0x1ad)],'gatewayOrderId':_0x33776a[_0x31122e(0x120)],'customerEmail':_0x33776a[_0x31122e(0x143)],'customerName':_0x33776a[_0x31122e(0x24a)],'customerCountry':_0x33776a[_0x31122e(0x27f)],'customerIp':_0x33776a[_0x31122e(0x2c5)],'customerUa':_0x33776a[_0x31122e(0x20e)],'failureMessage':_0x33776a[_0x31122e(0x216)],'externalPaymentUrl':_0x33776a[_0x31122e(0x249)],'successUrl':_0x33776a[_0x31122e(0x27c)],'failUrl':_0x33776a['failUrl'],'pendingUrl':_0x33776a['pendingUrl'],'whiteUrl':_0x33776a[_0x31122e(0x2c2)],'createdAt':_0x33776a[_0x31122e(0x1c5)],'updatedAt':_0x33776a[_0x31122e(0x1a5)],'shop':_0x33776a[_0x31122e(0x1c8)]};}async[a53_0x4bdb09(0x1ef)](_0x172ce9,_0x2c0319,_0x291bc4,_0xe26993){const _0x517169=a53_0x4bdb09,_0x4b9fb4=await database_1[_0x517169(0x28a)][_0x517169(0x2ba)](async _0x3fc976=>{const _0x4a23cd=_0x517169,_0x27d303=await _0x3fc976[_0x4a23cd(0x149)][_0x4a23cd(0x2a1)]({'where':{'id':_0x172ce9},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x27d303)throw new Error('Payment\x20not\x20found');const _0x293009=_0x27d303[_0x4a23cd(0x22c)],_0x1da31c=_0x2c0319[_0x4a23cd(0x184)]();console['log']('ðŸ”„\x20Admin\x20updating\x20payment\x20'+_0x172ce9+_0x4a23cd(0x245)+_0x293009+_0x4a23cd(0x14e)+_0x1da31c),console[_0x4a23cd(0x26c)](_0x4a23cd(0x1a1)+_0x27d303[_0x4a23cd(0x1c8)][_0x4a23cd(0x2a8)]+_0x4a23cd(0x29b));const _0x5c43d9={'status':_0x1da31c,'updatedAt':new Date(),'statusChangedBy':_0x4a23cd(0x145),'statusChangedAt':new Date()};_0x291bc4&&(_0x5c43d9['adminNotes']=_0x291bc4);_0x1da31c===_0x4a23cd(0x11e)&&_0xe26993&&(_0x5c43d9['chargebackAmount']=_0xe26993);let _0x2e3111=0x0,_0x4b7385=_0x27d303['shop'][_0x4a23cd(0x2a8)];if(_0x1da31c==='PAID'&&_0x293009!==_0x4a23cd(0x2cf)){_0x5c43d9[_0x4a23cd(0x29c)]=new Date();const _0x1756c8=await currencyService_1[_0x4a23cd(0x28f)][_0x4a23cd(0x2d8)](_0x27d303[_0x4a23cd(0x2c7)],_0x27d303['currency']);_0x5c43d9['amountUSDT']=_0x1756c8;let _0x373213=0x2d;const _0x1e7b66=await _0x3fc976[_0x4a23cd(0x1c8)][_0x4a23cd(0x2a1)]({'where':{'id':_0x27d303[_0x4a23cd(0x24f)]},'select':{'gatewaySettings':!![]}});if(_0x1e7b66?.[_0x4a23cd(0x1b9)])try{const _0x5d2296=JSON[_0x4a23cd(0x174)](_0x1e7b66[_0x4a23cd(0x1b9)]);for(const [_0x4662bb,_0xebf15f]of Object[_0x4a23cd(0x1fc)](_0x5d2296)){if(_0x4662bb[_0x4a23cd(0x14f)]()===_0x27d303[_0x4a23cd(0x139)][_0x4a23cd(0x14f)]()){_0x373213=_0xebf15f[_0x4a23cd(0x22f)]||0xa;break;}}}catch(_0x15597b){console[_0x4a23cd(0x1cf)](_0x4a23cd(0x264)+_0x172ce9+':',_0x15597b);}let _0x20e903;_0x27d303[_0x4a23cd(0x1d7)]!==null&&_0x27d303[_0x4a23cd(0x1d7)]!==undefined?(_0x20e903=_0x27d303[_0x4a23cd(0x1d7)],console['log'](_0x4a23cd(0x1d2)+_0x20e903['toFixed'](0x6)+_0x4a23cd(0x1cd)+_0x172ce9)):(_0x20e903=_0x1756c8*(0x1-_0x373213/0x64),console[_0x4a23cd(0x26c)](_0x4a23cd(0x241)+_0x172ce9+':\x20'+_0x373213+_0x4a23cd(0x175)+_0x1756c8[_0x4a23cd(0x259)](0x6)+_0x4a23cd(0x29b)),_0x5c43d9[_0x4a23cd(0x1d7)]=_0x20e903,_0x5c43d9[_0x4a23cd(0x24e)]=_0x373213),_0x2e3111=_0x20e903,_0x4b7385+=_0x20e903,console[_0x4a23cd(0x26c)](_0x4a23cd(0x2cc)+_0x172ce9+_0x4a23cd(0x203)),console[_0x4a23cd(0x26c)](_0x4a23cd(0x2a0)+_0x1756c8[_0x4a23cd(0x259)](0x6)+_0x4a23cd(0x29b)),console[_0x4a23cd(0x26c)](_0x4a23cd(0x2ac)+_0x27d303[_0x4a23cd(0x139)]+',\x20Commission:\x20'+_0x373213+'%'),console[_0x4a23cd(0x26c)](_0x4a23cd(0x19a)+_0x20e903[_0x4a23cd(0x259)](0x6)+_0x4a23cd(0x243)+_0x373213+_0x4a23cd(0x225)),console['log'](_0x4a23cd(0x1f2)+_0x20e903['toFixed'](0x6)+_0x4a23cd(0x29b));}else{if(_0x293009===_0x4a23cd(0x2cf)&&_0x1da31c!=='PAID'&&_0x1da31c!==_0x4a23cd(0x11e)){if(_0x27d303[_0x4a23cd(0x1c1)]){let _0x322ff2=0x2d;const _0x2b1448=await _0x3fc976[_0x4a23cd(0x1c8)][_0x4a23cd(0x2a1)]({'where':{'id':_0x27d303[_0x4a23cd(0x24f)]},'select':{'gatewaySettings':!![]}});if(_0x2b1448?.['gatewaySettings'])try{const _0x1c213a=JSON['parse'](_0x2b1448[_0x4a23cd(0x1b9)]);for(const [_0x3bf5a2,_0x27864f]of Object[_0x4a23cd(0x1fc)](_0x1c213a)){if(_0x3bf5a2[_0x4a23cd(0x14f)]()===_0x27d303[_0x4a23cd(0x139)]['toLowerCase']()){_0x322ff2=_0x27864f[_0x4a23cd(0x22f)]||0xa;break;}}}catch(_0x531ec7){console[_0x4a23cd(0x1cf)](_0x4a23cd(0x264)+_0x172ce9+':',_0x531ec7);}const _0x1db305=_0x27d303['amountUSDT']*(0x1-_0x322ff2/0x64);_0x2e3111=-_0x1db305,_0x4b7385-=_0x1db305,console['log']('\x20\x20\x20Full\x20amount:\x20'+_0x27d303[_0x4a23cd(0x1c1)][_0x4a23cd(0x259)](0x6)+_0x4a23cd(0x29b)),console[_0x4a23cd(0x26c)](_0x4a23cd(0x2ac)+_0x27d303[_0x4a23cd(0x139)]+_0x4a23cd(0x23e)+_0x322ff2+'%'),console[_0x4a23cd(0x26c)](_0x4a23cd(0x110)+_0x1db305[_0x4a23cd(0x259)](0x6)+_0x4a23cd(0x243)+_0x322ff2+'%\x20commission)'),console[_0x4a23cd(0x26c)](_0x4a23cd(0x1a9)+_0x1db305[_0x4a23cd(0x259)](0x6)+_0x4a23cd(0x29b));}}}_0x1da31c===_0x4a23cd(0x11e)&&(console[_0x4a23cd(0x26c)](_0x4a23cd(0x28c)),_0xe26993&&_0xe26993>0x0?(_0x2e3111=-_0xe26993,_0x4b7385-=_0xe26993,console['log'](_0x4a23cd(0x21b)+_0xe26993[_0x4a23cd(0x259)](0x6)+_0x4a23cd(0x20d)),console[_0x4a23cd(0x26c)](_0x4a23cd(0x21d))):console[_0x4a23cd(0x26c)](_0x4a23cd(0x1de)),_0x5c43d9[_0x4a23cd(0x1ec)]=_0xe26993||0x0);_0x1da31c===_0x4a23cd(0x19b)&&_0x293009===_0x4a23cd(0x2cf)&&console[_0x4a23cd(0x26c)]('ðŸ”„\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance');const _0x3c8bea=await _0x3fc976[_0x4a23cd(0x149)][_0x4a23cd(0x2ce)]({'where':{'id':_0x172ce9},'data':_0x5c43d9,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x2e3111!==0x0&&(await _0x3fc976[_0x4a23cd(0x1c8)]['update']({'where':{'id':_0x27d303[_0x4a23cd(0x24f)]},'data':{'balance':_0x4b7385}}),console[_0x4a23cd(0x26c)]('ðŸ’°\x20Shop\x20'+_0x27d303[_0x4a23cd(0x24f)]+'\x20balance\x20updated:\x20'+_0x27d303[_0x4a23cd(0x1c8)][_0x4a23cd(0x2a8)][_0x4a23cd(0x259)](0x6)+'\x20->\x20'+_0x4b7385[_0x4a23cd(0x259)](0x6)+_0x4a23cd(0x267)+(_0x2e3111>0x0?'+':'')+_0x2e3111[_0x4a23cd(0x259)](0x6)+')')),_0x3c8bea;});return{'id':_0x4b9fb4['id'],'shopId':_0x4b9fb4['shopId'],'gateway':_0x4b9fb4['gateway'],'amount':_0x4b9fb4[_0x517169(0x2c7)],'currency':_0x4b9fb4['currency'],'status':_0x4b9fb4[_0x517169(0x22c)],'orderId':_0x4b9fb4['orderId'],'gatewayOrderId':_0x4b9fb4[_0x517169(0x120)],'customerEmail':_0x4b9fb4[_0x517169(0x143)],'customerName':_0x4b9fb4[_0x517169(0x24a)],'customerCountry':_0x4b9fb4['customerCountry'],'customerIp':_0x4b9fb4[_0x517169(0x2c5)],'customerUa':_0x4b9fb4[_0x517169(0x20e)],'failureMessage':_0x4b9fb4['failureMessage'],'adminNotes':_0x4b9fb4[_0x517169(0x271)],'chargebackAmount':_0x4b9fb4['chargebackAmount'],'statusChangedBy':_0x4b9fb4[_0x517169(0x1d5)],'statusChangedAt':_0x4b9fb4['statusChangedAt'],'createdAt':_0x4b9fb4[_0x517169(0x1c5)],'updatedAt':_0x4b9fb4[_0x517169(0x1a5)],'shop':_0x4b9fb4['shop']};}async['updateUser'](_0x4ece14,_0x5032e5){const _0x5882bc=a53_0x4bdb09,_0x397276=Math[_0x5882bc(0x25e)]()[_0x5882bc(0x127)](0x24)[_0x5882bc(0x1d4)](0x2,0x9);console[_0x5882bc(0x26c)](_0x5882bc(0x16c)+_0x397276+_0x5882bc(0x16d)+_0x4ece14);const _0x211e0a={..._0x5032e5};_0x5032e5[_0x5882bc(0x11c)]&&_0x5032e5['password'][_0x5882bc(0x2d9)]()!==''?(console['log']('ðŸ”\x20['+_0x397276+_0x5882bc(0x1e6)+_0x4ece14),_0x211e0a['password']=await bcryptjs_1['default'][_0x5882bc(0x20a)](_0x5032e5[_0x5882bc(0x11c)],0xc)):(console[_0x5882bc(0x26c)](_0x5882bc(0x2b6)+_0x397276+']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update'),delete _0x211e0a[_0x5882bc(0x11c)]);_0x5032e5['fullName']&&(_0x211e0a[_0x5882bc(0x190)]=_0x5032e5['fullName'],delete _0x211e0a['fullName']);_0x5032e5['telegramId']&&(_0x211e0a['telegram']=_0x5032e5[_0x5882bc(0x1c0)],delete _0x211e0a[_0x5882bc(0x1c0)]);_0x5032e5[_0x5882bc(0x138)]&&(_0x211e0a['shopUrl']=_0x5032e5['merchantUrl'],delete _0x211e0a['merchantUrl']);if(_0x5032e5[_0x5882bc(0x22d)]){const _0xf58d7e=_0x5032e5[_0x5882bc(0x22d)][_0x5882bc(0x12b)](_0x1e0a8a=>this['getGatewayInternalName'](_0x1e0a8a));console[_0x5882bc(0x26c)](_0x5882bc(0x113),_0x5032e5[_0x5882bc(0x22d)],'->',_0xf58d7e),_0x211e0a[_0x5882bc(0x176)]=JSON[_0x5882bc(0x162)](_0xf58d7e),delete _0x211e0a['gateways'];}_0x5032e5['gatewaySettings']&&(console['log'](_0x5882bc(0x133)+_0x397276+']\x20Gateway\x20settings\x20before\x20saving:',_0x5032e5[_0x5882bc(0x1b9)]),_0x211e0a[_0x5882bc(0x1b9)]=JSON[_0x5882bc(0x162)](_0x5032e5['gatewaySettings']),console[_0x5882bc(0x26c)](_0x5882bc(0x133)+_0x397276+_0x5882bc(0x2a9),_0x211e0a[_0x5882bc(0x1b9)]));_0x5032e5['wallets']&&(_0x5032e5[_0x5882bc(0x163)][_0x5882bc(0x2ab)]!==undefined&&(_0x211e0a[_0x5882bc(0x2ab)]=_0x5032e5['wallets'][_0x5882bc(0x2ab)]||null),_0x5032e5['wallets'][_0x5882bc(0x28b)]!==undefined&&(_0x211e0a[_0x5882bc(0x28b)]=_0x5032e5[_0x5882bc(0x163)]['usdtTrcWallet']||null),_0x5032e5[_0x5882bc(0x163)][_0x5882bc(0x276)]!==undefined&&(_0x211e0a['usdtErcWallet']=_0x5032e5['wallets'][_0x5882bc(0x276)]||null),_0x5032e5[_0x5882bc(0x163)][_0x5882bc(0x204)]!==undefined&&(_0x211e0a['usdcPolygonWallet']=_0x5032e5[_0x5882bc(0x163)][_0x5882bc(0x204)]||null),delete _0x211e0a['wallets']);const _0x2868db=await database_1[_0x5882bc(0x28a)]['shop']['update']({'where':{'id':_0x4ece14},'data':_0x211e0a,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0x5882bc(0x26c)](_0x5882bc(0x210)+_0x397276+_0x5882bc(0x2d4),_0x2868db[_0x5882bc(0x1b9)]),{'id':_0x2868db['id'],'fullName':_0x2868db[_0x5882bc(0x190)],'username':_0x2868db[_0x5882bc(0x15a)],'telegramId':_0x2868db[_0x5882bc(0x229)],'merchantUrl':_0x2868db[_0x5882bc(0x17a)],'gateways':_0x2868db['paymentGateways']?JSON['parse'](_0x2868db[_0x5882bc(0x176)]):null,'gatewaySettings':_0x2868db['gatewaySettings']?JSON[_0x5882bc(0x174)](_0x2868db[_0x5882bc(0x1b9)]):null,'publicKey':_0x2868db[_0x5882bc(0x12a)],'wallets':{'usdtPolygonWallet':_0x2868db['usdtPolygonWallet'],'usdtTrcWallet':_0x2868db['usdtTrcWallet'],'usdtErcWallet':_0x2868db[_0x5882bc(0x276)],'usdcPolygonWallet':_0x2868db[_0x5882bc(0x204)]},'status':_0x2868db['status'],'createdAt':_0x2868db['createdAt']};}async[a53_0x4bdb09(0x270)](_0x40c4bd){const _0x2ca28d=a53_0x4bdb09,_0x352de9=await database_1[_0x2ca28d(0x28a)][_0x2ca28d(0x1c8)]['update']({'where':{'id':_0x40c4bd},'data':{'status':'SUSPENDED'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x352de9['id'],'fullName':_0x352de9[_0x2ca28d(0x190)],'username':_0x352de9[_0x2ca28d(0x15a)],'telegramId':_0x352de9[_0x2ca28d(0x229)],'merchantUrl':_0x352de9[_0x2ca28d(0x17a)],'gateways':_0x352de9[_0x2ca28d(0x176)]?JSON[_0x2ca28d(0x174)](_0x352de9[_0x2ca28d(0x176)]):null,'gatewaySettings':_0x352de9[_0x2ca28d(0x1b9)]?JSON[_0x2ca28d(0x174)](_0x352de9[_0x2ca28d(0x1b9)]):null,'publicKey':_0x352de9[_0x2ca28d(0x12a)],'wallets':{'usdtPolygonWallet':_0x352de9['usdtPolygonWallet'],'usdtTrcWallet':_0x352de9[_0x2ca28d(0x28b)],'usdtErcWallet':_0x352de9['usdtErcWallet'],'usdcPolygonWallet':_0x352de9[_0x2ca28d(0x204)]},'status':_0x352de9[_0x2ca28d(0x22c)],'createdAt':_0x352de9['createdAt']};}async[a53_0x4bdb09(0x289)](_0x4af89d){const _0x21ae3d=a53_0x4bdb09,_0x2d7948=await database_1['default']['shop'][_0x21ae3d(0x2ce)]({'where':{'id':_0x4af89d},'data':{'status':_0x21ae3d(0x146)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2d7948['id'],'fullName':_0x2d7948[_0x21ae3d(0x190)],'username':_0x2d7948['username'],'telegramId':_0x2d7948[_0x21ae3d(0x229)],'merchantUrl':_0x2d7948[_0x21ae3d(0x17a)],'gateways':_0x2d7948['paymentGateways']?JSON['parse'](_0x2d7948[_0x21ae3d(0x176)]):null,'gatewaySettings':_0x2d7948[_0x21ae3d(0x1b9)]?JSON['parse'](_0x2d7948[_0x21ae3d(0x1b9)]):null,'publicKey':_0x2d7948['publicKey'],'wallets':{'usdtPolygonWallet':_0x2d7948[_0x21ae3d(0x2ab)],'usdtTrcWallet':_0x2d7948['usdtTrcWallet'],'usdtErcWallet':_0x2d7948[_0x21ae3d(0x276)],'usdcPolygonWallet':_0x2d7948['usdcPolygonWallet']},'status':_0x2d7948[_0x21ae3d(0x22c)],'createdAt':_0x2d7948[_0x21ae3d(0x1c5)]};}async[a53_0x4bdb09(0x12f)](_0x8c78c0){const _0xd650c1=a53_0x4bdb09,{page:_0x42d16e,limit:_0xfb6ff3,status:_0x1b7afd,search:_0x45bb12}=_0x8c78c0,_0x460ed8=(_0x42d16e-0x1)*_0xfb6ff3,_0x13bd77={};_0x1b7afd&&(_0x13bd77[_0xd650c1(0x22c)]=_0x1b7afd[_0xd650c1(0x184)]());_0x45bb12&&(_0x13bd77['OR']=[{'name':{'contains':_0x45bb12,'mode':'insensitive'}},{'username':{'contains':_0x45bb12,'mode':_0xd650c1(0x167)}},{'telegram':{'contains':_0x45bb12,'mode':'insensitive'}},{'shopUrl':{'contains':_0x45bb12,'mode':_0xd650c1(0x167)}}]);const [_0x392f6d,_0x35b89a]=await Promise[_0xd650c1(0x181)]([database_1[_0xd650c1(0x28a)][_0xd650c1(0x1c8)][_0xd650c1(0x10e)]({'where':_0x13bd77,'skip':_0x460ed8,'take':_0xfb6ff3,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'twoFactorEnabled':!![],'createdAt':!![],'lastLoginAt':!![],'_count':{'select':{'telegramUsers':!![]}}}}),database_1[_0xd650c1(0x28a)][_0xd650c1(0x1c8)][_0xd650c1(0x129)]({'where':_0x13bd77})]);return{'users':_0x392f6d[_0xd650c1(0x12b)](_0x553b18=>{const _0x394aef=_0xd650c1,_0x46c6dc=_0x553b18[_0x394aef(0x176)]?JSON['parse'](_0x553b18[_0x394aef(0x176)]):null,_0x56c92e=_0x46c6dc?_0x46c6dc[_0x394aef(0x12b)](_0x8b16df=>this[_0x394aef(0x1c6)](_0x8b16df)):null;return{'id':_0x553b18['id'],'fullName':_0x553b18['name'],'username':_0x553b18[_0x394aef(0x15a)],'telegramId':_0x553b18[_0x394aef(0x229)],'merchantUrl':_0x553b18['shopUrl'],'gateways':_0x56c92e,'gatewaySettings':_0x553b18[_0x394aef(0x1b9)]?JSON[_0x394aef(0x174)](_0x553b18[_0x394aef(0x1b9)]):null,'publicKey':_0x553b18[_0x394aef(0x12a)],'wallets':{'usdtPolygonWallet':_0x553b18[_0x394aef(0x2ab)],'usdtTrcWallet':_0x553b18[_0x394aef(0x28b)],'usdtErcWallet':_0x553b18[_0x394aef(0x276)],'usdcPolygonWallet':_0x553b18[_0x394aef(0x204)],'usdcErcWallet':_0x553b18[_0x394aef(0x19e)]},'status':_0x553b18[_0x394aef(0x22c)],'twoFactorEnabled':_0x553b18[_0x394aef(0x217)]||![],'telegramUsersCount':_0x553b18[_0x394aef(0x13f)]['telegramUsers'],'createdAt':_0x553b18[_0x394aef(0x1c5)],'lastLoginAt':_0x553b18['lastLoginAt']};}),'pagination':{'page':_0x42d16e,'limit':_0xfb6ff3,'total':_0x35b89a,'totalPages':Math[_0xd650c1(0x153)](_0x35b89a/_0xfb6ff3)}};}async[a53_0x4bdb09(0x21e)](_0x6091a4){const _0xf69e1f=a53_0x4bdb09,_0x4dae8d=await database_1[_0xf69e1f(0x28a)]['shop'][_0xf69e1f(0x2a1)]({'where':{'id':_0x6091a4},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x4dae8d)return null;const _0x4eebe6=_0x4dae8d[_0xf69e1f(0x176)]?JSON['parse'](_0x4dae8d[_0xf69e1f(0x176)]):null,_0x6fd4cd=_0x4eebe6?_0x4eebe6[_0xf69e1f(0x12b)](_0x5ea209=>this[_0xf69e1f(0x1c6)](_0x5ea209)):null;return _0x4eebe6&&_0x6fd4cd&&console[_0xf69e1f(0x26c)]('ðŸ”„\x20Gateway\x20mapping\x20(get):',_0x4eebe6,'->',_0x6fd4cd),{'id':_0x4dae8d['id'],'fullName':_0x4dae8d[_0xf69e1f(0x190)],'username':_0x4dae8d[_0xf69e1f(0x15a)],'telegramId':_0x4dae8d[_0xf69e1f(0x229)],'merchantUrl':_0x4dae8d['shopUrl'],'gateways':_0x6fd4cd,'gatewaySettings':_0x4dae8d[_0xf69e1f(0x1b9)]?JSON[_0xf69e1f(0x174)](_0x4dae8d[_0xf69e1f(0x1b9)]):null,'publicKey':_0x4dae8d[_0xf69e1f(0x12a)],'wallets':{'usdtPolygonWallet':_0x4dae8d[_0xf69e1f(0x2ab)],'usdtTrcWallet':_0x4dae8d['usdtTrcWallet'],'usdtErcWallet':_0x4dae8d[_0xf69e1f(0x276)],'usdcPolygonWallet':_0x4dae8d[_0xf69e1f(0x204)],'usdcErcWallet':_0x4dae8d[_0xf69e1f(0x19e)]},'status':_0x4dae8d[_0xf69e1f(0x22c)],'createdAt':_0x4dae8d[_0xf69e1f(0x1c5)]};}async[a53_0x4bdb09(0x2af)](_0x19eb3b){const _0x55a52a=a53_0x4bdb09,{fullName:_0x488ceb,username:_0x391eef,password:_0x48cada,telegramId:_0x2acab3,merchantUrl:_0x593453,gateways:_0x43ce43,gatewaySettings:_0x9ff9c5,wallets:_0x55c198}=_0x19eb3b,_0x28ce92=await database_1[_0x55a52a(0x28a)][_0x55a52a(0x1c8)][_0x55a52a(0x2a1)]({'where':{'username':_0x391eef}});if(_0x28ce92)throw new Error(_0x55a52a(0x1e2));if(_0x2acab3){const _0xfa6c=await database_1[_0x55a52a(0x28a)][_0x55a52a(0x1c8)][_0x55a52a(0x2a1)]({'where':{'telegram':_0x2acab3}});if(_0xfa6c)throw new Error(_0x55a52a(0x1ae));}const _0x1d2e20=await bcryptjs_1['default'][_0x55a52a(0x20a)](_0x48cada,0xc),_0x4b004e='pk_'+crypto_1['default']['randomBytes'](0x20)['toString'](_0x55a52a(0x2c8)),_0x272305=_0x55a52a(0x1e0)+crypto_1[_0x55a52a(0x28a)][_0x55a52a(0x12d)](0x20)[_0x55a52a(0x127)]('hex'),_0xb84a0e=_0x43ce43?_0x43ce43[_0x55a52a(0x12b)](_0x1d0607=>this[_0x55a52a(0x197)](_0x1d0607)):null;_0x43ce43&&_0xb84a0e&&console[_0x55a52a(0x26c)](_0x55a52a(0x18d),_0x43ce43,'->',_0xb84a0e);const _0x236014=await database_1[_0x55a52a(0x28a)][_0x55a52a(0x1c8)][_0x55a52a(0x2ca)]({'data':{'name':_0x488ceb,'username':_0x391eef,'password':_0x1d2e20,'telegram':_0x2acab3,'shopUrl':_0x593453,'paymentGateways':_0xb84a0e?JSON['stringify'](_0xb84a0e):null,'gatewaySettings':_0x9ff9c5?JSON[_0x55a52a(0x162)](_0x9ff9c5):null,'usdtPolygonWallet':_0x55c198?.[_0x55a52a(0x2ab)]||null,'usdtTrcWallet':_0x55c198?.[_0x55a52a(0x28b)]||null,'usdtErcWallet':_0x55c198?.[_0x55a52a(0x276)]||null,'usdcPolygonWallet':_0x55c198?.[_0x55a52a(0x204)]||null,'publicKey':_0x4b004e,'secretKey':_0x272305,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x236014['id'],'fullName':_0x236014[_0x55a52a(0x190)],'username':_0x236014[_0x55a52a(0x15a)],'telegramId':_0x236014['telegram'],'merchantUrl':_0x236014[_0x55a52a(0x17a)],'gateways':_0x236014['paymentGateways']?JSON[_0x55a52a(0x174)](_0x236014[_0x55a52a(0x176)]):null,'gatewaySettings':_0x236014[_0x55a52a(0x1b9)]?JSON[_0x55a52a(0x174)](_0x236014[_0x55a52a(0x1b9)]):null,'publicKey':_0x236014[_0x55a52a(0x12a)],'wallets':{'usdtPolygonWallet':_0x236014[_0x55a52a(0x2ab)],'usdtTrcWallet':_0x236014[_0x55a52a(0x28b)],'usdtErcWallet':_0x236014[_0x55a52a(0x276)],'usdcPolygonWallet':_0x236014[_0x55a52a(0x204)]},'status':_0x236014['status'],'createdAt':_0x236014[_0x55a52a(0x1c5)]};}async[a53_0x4bdb09(0x1bc)](_0xae31b5,_0x5e6c96){const _0x49d1d7=a53_0x4bdb09;if(config_1[_0x49d1d7(0x2b3)]['admin'][_0x49d1d7(0x217)]){if(!_0x5e6c96)throw new Error(_0x49d1d7(0x1ac));const _0x4887d6=speakeasy_1['default'][_0x49d1d7(0x2c1)][_0x49d1d7(0x24d)]({'secret':config_1[_0x49d1d7(0x2b3)]['admin'][_0x49d1d7(0x1a3)],'encoding':_0x49d1d7(0x265),'token':_0x5e6c96,'window':0x2});if(!_0x4887d6){let _0x125b05=![];if(config_1[_0x49d1d7(0x2b3)][_0x49d1d7(0x145)]['backupCodes']){const _0xfb789d=JSON[_0x49d1d7(0x174)](config_1[_0x49d1d7(0x2b3)][_0x49d1d7(0x145)][_0x49d1d7(0x11a)]);for(let _0x47ee3b=0x0;_0x47ee3b<_0xfb789d[_0x49d1d7(0x296)];_0x47ee3b++){const _0x51dd54=await bcryptjs_1[_0x49d1d7(0x28a)][_0x49d1d7(0x1dc)](_0x5e6c96,_0xfb789d[_0x47ee3b]);if(_0x51dd54){_0x125b05=!![],_0xfb789d[_0x49d1d7(0x1d9)](_0x47ee3b,0x1),config_1[_0x49d1d7(0x2b3)][_0x49d1d7(0x145)][_0x49d1d7(0x11a)]=JSON[_0x49d1d7(0x162)](_0xfb789d);const _0x1b32d0=path_1[_0x49d1d7(0x28a)][_0x49d1d7(0x275)](process[_0x49d1d7(0x147)](),_0x49d1d7(0x1b4));if(fs_1[_0x49d1d7(0x28a)][_0x49d1d7(0x230)](_0x1b32d0)){let _0x3ee454=fs_1[_0x49d1d7(0x28a)]['readFileSync'](_0x1b32d0,_0x49d1d7(0x1cc));const _0x1138a9=_0x3ee454[_0x49d1d7(0x1b1)]('\x0a');for(let _0x715229=0x0;_0x715229<_0x1138a9[_0x49d1d7(0x296)];_0x715229++){if(_0x1138a9[_0x715229][_0x49d1d7(0x1b0)](_0x49d1d7(0x19d))){_0x1138a9[_0x715229]='ADMIN_BACKUP_CODES='+JSON[_0x49d1d7(0x162)](_0xfb789d);break;}}fs_1[_0x49d1d7(0x28a)][_0x49d1d7(0x1b2)](_0x1b32d0,_0x1138a9['join']('\x0a'),_0x49d1d7(0x1cc));}break;}}}if(!_0x125b05)throw new Error(_0x49d1d7(0x251));}}await database_1[_0x49d1d7(0x28a)]['shop'][_0x49d1d7(0x234)]({'where':{'id':_0xae31b5}});}async[a53_0x4bdb09(0x2d5)](_0x131240){const _0x1dfd2e=a53_0x4bdb09,_0x4385c9=await database_1[_0x1dfd2e(0x28a)][_0x1dfd2e(0x1c8)][_0x1dfd2e(0x2a1)]({'where':{'id':_0x131240},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});if(!_0x4385c9)throw new Error(_0x1dfd2e(0x171));return{'usdtPolygonWallet':_0x4385c9['usdtPolygonWallet'],'usdtTrcWallet':_0x4385c9['usdtTrcWallet'],'usdtErcWallet':_0x4385c9[_0x1dfd2e(0x276)],'usdcPolygonWallet':_0x4385c9[_0x1dfd2e(0x204)],'usdcErcWallet':_0x4385c9[_0x1dfd2e(0x19e)]};}['generateBackupCodes'](_0x26413d=0x8){const _0x63eb5b=a53_0x4bdb09,_0xe61b81=[];for(let _0x1891e7=0x0;_0x1891e7<_0x26413d;_0x1891e7++){const _0x211267=crypto_1[_0x63eb5b(0x28a)][_0x63eb5b(0x12d)](0x4)[_0x63eb5b(0x127)](_0x63eb5b(0x2c8))[_0x63eb5b(0x184)]();_0xe61b81[_0x63eb5b(0x124)](_0x211267);}return _0xe61b81;}async[a53_0x4bdb09(0x224)](_0x974ef9){const _0x4fb503=a53_0x4bdb09,_0x14992a=await database_1['default'][_0x4fb503(0x1c8)]['findUnique']({'where':{'id':_0x974ef9},'select':{'id':!![],'name':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x14992a)throw new Error(_0x4fb503(0x171));const _0x15e126=speakeasy_1[_0x4fb503(0x28a)][_0x4fb503(0x27b)]({'name':_0x4fb503(0x192)+_0x14992a[_0x4fb503(0x15a)]+')','issuer':_0x4fb503(0x118),'length':0x20}),_0x1dd692=await qrcode_1['default'][_0x4fb503(0x115)](_0x15e126[_0x4fb503(0x286)]),_0x5d47b0=this['generateBackupCodes'](0x8),_0x44ca5b=await Promise[_0x4fb503(0x181)](_0x5d47b0[_0x4fb503(0x12b)](_0x3967ff=>bcryptjs_1[_0x4fb503(0x28a)]['hash'](_0x3967ff,0xa)));return await database_1[_0x4fb503(0x28a)]['shop'][_0x4fb503(0x2ce)]({'where':{'id':_0x974ef9},'data':{'twoFactorSecret':_0x15e126[_0x4fb503(0x265)],'backupCodes':JSON[_0x4fb503(0x162)](_0x44ca5b)}}),console[_0x4fb503(0x26c)]('ðŸ”\x202FA\x20setup\x20initiated\x20for\x20shop:\x20'+_0x14992a[_0x4fb503(0x15a)]),console[_0x4fb503(0x26c)](_0x4fb503(0x1ff)+_0x5d47b0['length']+_0x4fb503(0x182)),{'secret':_0x15e126[_0x4fb503(0x265)],'qrCode':_0x1dd692,'manualEntryKey':_0x15e126[_0x4fb503(0x265)],'backupCodes':_0x5d47b0};}async['enable2FA'](_0x150565,_0x2a4393){const _0x37d419=a53_0x4bdb09,_0xf92e18=await database_1[_0x37d419(0x28a)][_0x37d419(0x1c8)][_0x37d419(0x2a1)]({'where':{'id':_0x150565},'select':{'id':!![],'username':!![],'twoFactorSecret':!![],'twoFactorEnabled':!![]}});if(!_0xf92e18)throw new Error('Shop\x20not\x20found');if(!_0xf92e18[_0x37d419(0x1a3)])throw new Error('2FA\x20not\x20set\x20up.\x20Please\x20call\x20setup\x20endpoint\x20first');if(_0xf92e18[_0x37d419(0x217)])throw new Error(_0x37d419(0x211));const _0xd3f67d=speakeasy_1['default'][_0x37d419(0x2c1)][_0x37d419(0x24d)]({'secret':_0xf92e18[_0x37d419(0x1a3)],'encoding':_0x37d419(0x265),'token':_0x2a4393,'window':0x2});if(!_0xd3f67d)throw new Error(_0x37d419(0x27e));return await database_1[_0x37d419(0x28a)][_0x37d419(0x1c8)][_0x37d419(0x2ce)]({'where':{'id':_0x150565},'data':{'twoFactorEnabled':!![]}}),console[_0x37d419(0x26c)](_0x37d419(0x29f)+_0xf92e18[_0x37d419(0x15a)]),{'enabled':!![]};}async[a53_0x4bdb09(0x161)](_0x31fde3){const _0x2cbdef=a53_0x4bdb09,_0x3fd2c0=await database_1[_0x2cbdef(0x28a)][_0x2cbdef(0x1c8)][_0x2cbdef(0x2a1)]({'where':{'id':_0x31fde3},'select':{'id':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x3fd2c0)throw new Error(_0x2cbdef(0x171));await database_1['default']['shop'][_0x2cbdef(0x2ce)]({'where':{'id':_0x31fde3},'data':{'twoFactorEnabled':![],'twoFactorSecret':null,'backupCodes':null}}),console[_0x2cbdef(0x26c)]('ðŸ”\x202FA\x20disabled\x20for\x20shop:\x20'+_0x3fd2c0[_0x2cbdef(0x15a)]);}async['changeAdminPassword'](_0x2805d1,_0x3f7021,_0x150e27,_0x37ee56){const _0x4c130e=a53_0x4bdb09;if(_0x3f7021!==_0x150e27)throw new Error(_0x4c130e(0x165));if(_0x3f7021[_0x4c130e(0x296)]<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x2c3de7=await bcryptjs_1[_0x4c130e(0x28a)]['compare'](_0x2805d1,config_1[_0x4c130e(0x2b3)][_0x4c130e(0x145)][_0x4c130e(0x1e1)]);if(!_0x2c3de7)throw new Error('Current\x20password\x20is\x20incorrect');if(config_1[_0x4c130e(0x2b3)][_0x4c130e(0x145)]['twoFactorEnabled']){if(!_0x37ee56)throw new Error('2FA\x20token\x20is\x20required');const _0x248517=speakeasy_1[_0x4c130e(0x28a)][_0x4c130e(0x2c1)]['verify']({'secret':config_1[_0x4c130e(0x2b3)][_0x4c130e(0x145)][_0x4c130e(0x1a3)],'encoding':'base32','token':_0x37ee56,'window':0x2});if(!_0x248517){let _0x14cc14=![];if(config_1[_0x4c130e(0x2b3)][_0x4c130e(0x145)][_0x4c130e(0x11a)]){const _0x1fdbfb=JSON[_0x4c130e(0x174)](config_1[_0x4c130e(0x2b3)][_0x4c130e(0x145)][_0x4c130e(0x11a)]);for(let _0x4083f2=0x0;_0x4083f2<_0x1fdbfb['length'];_0x4083f2++){const _0xe8464d=await bcryptjs_1[_0x4c130e(0x28a)][_0x4c130e(0x1dc)](_0x37ee56,_0x1fdbfb[_0x4083f2]);if(_0xe8464d){_0x14cc14=!![],_0x1fdbfb[_0x4c130e(0x1d9)](_0x4083f2,0x1),config_1[_0x4c130e(0x2b3)][_0x4c130e(0x145)][_0x4c130e(0x11a)]=JSON[_0x4c130e(0x162)](_0x1fdbfb);const _0x378a63=path_1['default'][_0x4c130e(0x275)](process[_0x4c130e(0x147)](),_0x4c130e(0x1b4));if(fs_1[_0x4c130e(0x28a)][_0x4c130e(0x230)](_0x378a63)){let _0x7ba5fe=fs_1['default']['readFileSync'](_0x378a63,_0x4c130e(0x1cc));const _0x3c00cc=_0x7ba5fe[_0x4c130e(0x1b1)]('\x0a');for(let _0x10c533=0x0;_0x10c533<_0x3c00cc['length'];_0x10c533++){if(_0x3c00cc[_0x10c533]['startsWith'](_0x4c130e(0x19d))){_0x3c00cc[_0x10c533]=_0x4c130e(0x19d)+JSON[_0x4c130e(0x162)](_0x1fdbfb);break;}}fs_1[_0x4c130e(0x28a)]['writeFileSync'](_0x378a63,_0x3c00cc[_0x4c130e(0x275)]('\x0a'),'utf8');}break;}}}if(!_0x14cc14)throw new Error(_0x4c130e(0x251));}}const _0x4ec4bf=await bcryptjs_1['default']['hash'](_0x3f7021,0xc);config_1[_0x4c130e(0x2b3)][_0x4c130e(0x145)][_0x4c130e(0x1e1)]=_0x4ec4bf;const _0x4e1277=path_1[_0x4c130e(0x28a)][_0x4c130e(0x275)](process[_0x4c130e(0x147)](),'.env');let _0x3d15b6='';if(fs_1[_0x4c130e(0x28a)][_0x4c130e(0x230)](_0x4e1277)){_0x3d15b6=fs_1[_0x4c130e(0x28a)][_0x4c130e(0x144)](_0x4e1277,_0x4c130e(0x1cc));const _0x277336=_0x3d15b6['split']('\x0a');let _0x4a1f50=![];for(let _0x2ee943=0x0;_0x2ee943<_0x277336[_0x4c130e(0x296)];_0x2ee943++){if(_0x277336[_0x2ee943]['startsWith']('ADMIN_PASSWORD_HASH=')){_0x277336[_0x2ee943]=_0x4c130e(0x1ba)+_0x4ec4bf,_0x4a1f50=!![];break;}}!_0x4a1f50&&_0x277336[_0x4c130e(0x124)](_0x4c130e(0x1ba)+_0x4ec4bf),_0x3d15b6=_0x277336[_0x4c130e(0x275)]('\x0a'),fs_1[_0x4c130e(0x28a)][_0x4c130e(0x1b2)](_0x4e1277,_0x3d15b6,_0x4c130e(0x1cc));}console[_0x4c130e(0x26c)]('ðŸ”\x20Admin\x20password\x20changed\x20successfully');}async[a53_0x4bdb09(0x22e)](){const _0x54dcd8=a53_0x4bdb09;let _0x3913c1=0x0;if(config_1[_0x54dcd8(0x2b3)][_0x54dcd8(0x145)]['backupCodes'])try{const _0x2c4ba7=JSON[_0x54dcd8(0x174)](config_1[_0x54dcd8(0x2b3)][_0x54dcd8(0x145)][_0x54dcd8(0x11a)]);_0x3913c1=_0x2c4ba7[_0x54dcd8(0x296)];}catch(_0x4d98fb){console[_0x54dcd8(0x1cf)](_0x54dcd8(0x1a7),_0x4d98fb);}return{'twoFactorEnabled':config_1['config']['admin']['twoFactorEnabled'],'backupCodesCount':_0x3913c1};}async[a53_0x4bdb09(0x2a7)](){const _0x2cea3a=a53_0x4bdb09,_0x3c0b79=speakeasy_1[_0x2cea3a(0x28a)][_0x2cea3a(0x27b)]({'name':_0x2cea3a(0x195)+config_1[_0x2cea3a(0x2b3)][_0x2cea3a(0x145)][_0x2cea3a(0x15a)]+')','issuer':_0x2cea3a(0x2cd),'length':0x20}),_0x3cb98b=await qrcode_1[_0x2cea3a(0x28a)][_0x2cea3a(0x115)](_0x3c0b79[_0x2cea3a(0x286)]),_0x2b4c20=[];for(let _0x59926b=0x0;_0x59926b<0x8;_0x59926b++){const _0x57a91a=crypto_1[_0x2cea3a(0x28a)][_0x2cea3a(0x12d)](0x4)['toString'](_0x2cea3a(0x2c8))[_0x2cea3a(0x184)]();_0x2b4c20[_0x2cea3a(0x124)](_0x57a91a);}const _0x4ee4c7=await Promise['all'](_0x2b4c20[_0x2cea3a(0x12b)](_0x4c6e84=>bcryptjs_1[_0x2cea3a(0x28a)][_0x2cea3a(0x20a)](_0x4c6e84,0xa)));config_1[_0x2cea3a(0x2b3)]['admin']['twoFactorSecret']=_0x3c0b79['base32'],config_1[_0x2cea3a(0x2b3)]['admin'][_0x2cea3a(0x11a)]=JSON[_0x2cea3a(0x162)](_0x4ee4c7);const _0x36bf84=path_1[_0x2cea3a(0x28a)][_0x2cea3a(0x275)](process[_0x2cea3a(0x147)](),_0x2cea3a(0x1b4));if(fs_1['default'][_0x2cea3a(0x230)](_0x36bf84)){let _0x3fe046=fs_1[_0x2cea3a(0x28a)]['readFileSync'](_0x36bf84,_0x2cea3a(0x1cc));const _0x3fac93=_0x3fe046[_0x2cea3a(0x1b1)]('\x0a');let _0x2e06d4=![],_0x452a54=![];for(let _0x47ec79=0x0;_0x47ec79<_0x3fac93['length'];_0x47ec79++){_0x3fac93[_0x47ec79]['startsWith']('ADMIN_2FA_SECRET=')&&(_0x3fac93[_0x47ec79]='ADMIN_2FA_SECRET='+_0x3c0b79['base32'],_0x2e06d4=!![]),_0x3fac93[_0x47ec79][_0x2cea3a(0x1b0)](_0x2cea3a(0x19d))&&(_0x3fac93[_0x47ec79]=_0x2cea3a(0x19d)+JSON[_0x2cea3a(0x162)](_0x4ee4c7),_0x452a54=!![]);}if(!_0x2e06d4)_0x3fac93[_0x2cea3a(0x124)](_0x2cea3a(0x15f)+_0x3c0b79['base32']);if(!_0x452a54)_0x3fac93[_0x2cea3a(0x124)](_0x2cea3a(0x19d)+JSON[_0x2cea3a(0x162)](_0x4ee4c7));fs_1[_0x2cea3a(0x28a)][_0x2cea3a(0x1b2)](_0x36bf84,_0x3fac93[_0x2cea3a(0x275)]('\x0a'),'utf8');}return console[_0x2cea3a(0x26c)](_0x2cea3a(0x246)),console[_0x2cea3a(0x26c)](_0x2cea3a(0x1ff)+_0x2b4c20[_0x2cea3a(0x296)]+_0x2cea3a(0x182)),{'secret':_0x3c0b79[_0x2cea3a(0x265)],'qrCode':_0x3cb98b,'manualEntryKey':_0x3c0b79[_0x2cea3a(0x265)],'backupCodes':_0x2b4c20};}async[a53_0x4bdb09(0x164)](_0x3ad9a9){const _0x4a77ce=a53_0x4bdb09;if(!config_1[_0x4a77ce(0x2b3)]['admin']['twoFactorSecret'])throw new Error(_0x4a77ce(0x1f4));if(config_1['config'][_0x4a77ce(0x145)][_0x4a77ce(0x217)])throw new Error(_0x4a77ce(0x211));const _0x44bbb1=speakeasy_1[_0x4a77ce(0x28a)][_0x4a77ce(0x2c1)][_0x4a77ce(0x24d)]({'secret':config_1['config'][_0x4a77ce(0x145)]['twoFactorSecret'],'encoding':_0x4a77ce(0x265),'token':_0x3ad9a9,'window':0x2});if(!_0x44bbb1)throw new Error(_0x4a77ce(0x27e));config_1[_0x4a77ce(0x2b3)][_0x4a77ce(0x145)]['twoFactorEnabled']=!![];const _0x2c0e61=path_1[_0x4a77ce(0x28a)][_0x4a77ce(0x275)](process[_0x4a77ce(0x147)](),_0x4a77ce(0x1b4));if(fs_1[_0x4a77ce(0x28a)]['existsSync'](_0x2c0e61)){let _0x136c22=fs_1[_0x4a77ce(0x28a)][_0x4a77ce(0x144)](_0x2c0e61,_0x4a77ce(0x1cc));const _0x2a0358=_0x136c22[_0x4a77ce(0x1b1)]('\x0a');let _0x4ddcc8=![];for(let _0x567df8=0x0;_0x567df8<_0x2a0358[_0x4a77ce(0x296)];_0x567df8++){if(_0x2a0358[_0x567df8][_0x4a77ce(0x1b0)](_0x4a77ce(0x1df))){_0x2a0358[_0x567df8]=_0x4a77ce(0x1b7),_0x4ddcc8=!![];break;}}if(!_0x4ddcc8)_0x2a0358[_0x4a77ce(0x124)](_0x4a77ce(0x1b7));fs_1[_0x4a77ce(0x28a)][_0x4a77ce(0x1b2)](_0x2c0e61,_0x2a0358[_0x4a77ce(0x275)]('\x0a'),'utf8');}return console[_0x4a77ce(0x26c)](_0x4a77ce(0x2a6)),{'enabled':!![]};}async['disableAdmin2FA'](){const _0x5f36e0=a53_0x4bdb09;config_1[_0x5f36e0(0x2b3)][_0x5f36e0(0x145)][_0x5f36e0(0x217)]=![],config_1['config'][_0x5f36e0(0x145)][_0x5f36e0(0x1a3)]='',config_1[_0x5f36e0(0x2b3)][_0x5f36e0(0x145)][_0x5f36e0(0x11a)]='';const _0x10aa85=path_1[_0x5f36e0(0x28a)]['join'](process[_0x5f36e0(0x147)](),_0x5f36e0(0x1b4));if(fs_1[_0x5f36e0(0x28a)][_0x5f36e0(0x230)](_0x10aa85)){let _0x4cc395=fs_1[_0x5f36e0(0x28a)][_0x5f36e0(0x144)](_0x10aa85,_0x5f36e0(0x1cc));const _0x4a7103=_0x4cc395['split']('\x0a');for(let _0x32f2e8=0x0;_0x32f2e8<_0x4a7103[_0x5f36e0(0x296)];_0x32f2e8++){_0x4a7103[_0x32f2e8][_0x5f36e0(0x1b0)](_0x5f36e0(0x1df))&&(_0x4a7103[_0x32f2e8]=_0x5f36e0(0x26b)),_0x4a7103[_0x32f2e8][_0x5f36e0(0x1b0)](_0x5f36e0(0x15f))&&(_0x4a7103[_0x32f2e8]=_0x5f36e0(0x15f)),_0x4a7103[_0x32f2e8]['startsWith'](_0x5f36e0(0x19d))&&(_0x4a7103[_0x32f2e8]=_0x5f36e0(0x19d));}fs_1[_0x5f36e0(0x28a)][_0x5f36e0(0x1b2)](_0x10aa85,_0x4a7103[_0x5f36e0(0x275)]('\x0a'),_0x5f36e0(0x1cc));}console[_0x5f36e0(0x26c)](_0x5f36e0(0x1a0));}[a53_0x4bdb09(0x25d)](_0x550bc6,_0x5a7ce7,_0x150fad){const _0x4a9ac2=a53_0x4bdb09,_0x296045=new Map(),_0x1e38c9=new Date(_0x5a7ce7);while(_0x1e38c9<=_0x150fad){const _0x53e4f3=_0x1e38c9['toISOString']()[_0x4a9ac2(0x1b1)]('T')[0x0];_0x296045['set'](_0x53e4f3,{'revenue':0x0,'count':0x0}),_0x1e38c9[_0x4a9ac2(0x198)](_0x1e38c9[_0x4a9ac2(0x17d)]()+0x1);}for(const _0x1d12a7 of _0x550bc6){const _0x22bff0=_0x1d12a7['createdAt'][_0x4a9ac2(0x1ce)]()[_0x4a9ac2(0x1b1)]('T')[0x0],_0x3a3688=_0x296045[_0x4a9ac2(0x299)](_0x22bff0);_0x3a3688&&(_0x3a3688[_0x4a9ac2(0x129)]+=0x1,_0x1d12a7[_0x4a9ac2(0x22c)]===_0x4a9ac2(0x2cf)&&(_0x1d12a7[_0x4a9ac2(0x1c1)]?_0x3a3688[_0x4a9ac2(0x18b)]+=_0x1d12a7['amountUSDT']:console[_0x4a9ac2(0x26c)](_0x4a9ac2(0x16a)+_0x1d12a7['id']+_0x4a9ac2(0x1ee))));}const _0x2e91c6=[],_0x1b49b2=[];for(const [_0x55c930,_0x1f27fb]of _0x296045){_0x2e91c6[_0x4a9ac2(0x124)]({'date':_0x55c930,'amount':Math[_0x4a9ac2(0x29a)](_0x1f27fb[_0x4a9ac2(0x18b)]*0x64)/0x64}),_0x1b49b2['push']({'date':_0x55c930,'count':_0x1f27fb[_0x4a9ac2(0x129)]});}return{'dailyRevenue':_0x2e91c6,'dailyPayments':_0x1b49b2};}async[a53_0x4bdb09(0x14a)](_0x548301){const _0x464fb2=a53_0x4bdb09;console[_0x464fb2(0x26c)](_0x464fb2(0x18e),_0x548301);const _0x1f7792=new Date(_0x548301[_0x464fb2(0x285)]),_0xe19cfc=new Date(_0x548301[_0x464fb2(0x20c)]),_0x534cea=new Date(Date['UTC'](_0x1f7792[_0x464fb2(0x266)](),_0x1f7792[_0x464fb2(0x1d6)](),_0x1f7792['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x1af4f2=new Date(Date[_0x464fb2(0x212)](_0xe19cfc[_0x464fb2(0x266)](),_0xe19cfc[_0x464fb2(0x1d6)](),_0xe19cfc[_0x464fb2(0x154)](),0x17,0x3b,0x3b,0x3e7));console[_0x464fb2(0x26c)](_0x464fb2(0x250)+_0x534cea[_0x464fb2(0x1ce)]()+_0x464fb2(0x28d)+_0x1af4f2[_0x464fb2(0x1ce)]()),console['log']('ðŸ”Œ\x20Gateway:\x20'+_0x548301[_0x464fb2(0x139)]);const _0x146a2c=await database_1['default']['payment'][_0x464fb2(0x10e)]({'where':{'status':_0x464fb2(0x2cf),'gateway':_0x548301['gateway'][_0x464fb2(0x14f)](),'createdAt':{'gte':_0x534cea,'lte':_0x1af4f2}},'select':{'id':!![],'shopId':!![],'amountAfterGatewayCommissionUSDT':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console[_0x464fb2(0x26c)](_0x464fb2(0x2c9)+_0x146a2c['length']+_0x464fb2(0x27a)+_0x548301[_0x464fb2(0x139)]);const _0x5657ac=new Map();for(const _0x22efba of _0x146a2c){const _0x535514=_0x22efba[_0x464fb2(0x1d7)]||0x0;if(_0x535514<=0x0){console[_0x464fb2(0x18f)](_0x464fb2(0x16a)+_0x22efba['id']+_0x464fb2(0x136));continue;}if(_0x5657ac[_0x464fb2(0x15b)](_0x22efba[_0x464fb2(0x24f)])){const _0x1812ab=_0x5657ac[_0x464fb2(0x299)](_0x22efba['shopId']);_0x1812ab[_0x464fb2(0x199)]+=_0x535514;}else _0x5657ac[_0x464fb2(0x1f6)](_0x22efba[_0x464fb2(0x24f)],{'merchantId':_0x22efba[_0x464fb2(0x1c8)]['id'],'merchantName':_0x22efba[_0x464fb2(0x1c8)][_0x464fb2(0x190)],'merchantUsername':_0x22efba['shop'][_0x464fb2(0x15a)],'totalAmount':_0x535514});}const _0x418ce4=Array['from'](_0x5657ac[_0x464fb2(0x1eb)]())[_0x464fb2(0x12b)](_0x1a0cc2=>({'merchantId':_0x1a0cc2[_0x464fb2(0x1e4)],'merchantName':_0x1a0cc2[_0x464fb2(0x1d0)],'merchantUsername':_0x1a0cc2['merchantUsername'],'gateway':_0x548301[_0x464fb2(0x139)],'periodFrom':_0x548301['periodFrom'],'periodTo':_0x548301[_0x464fb2(0x20c)],'totalAmount':Math[_0x464fb2(0x29a)](_0x1a0cc2[_0x464fb2(0x199)]*0x64)/0x64}));return _0x418ce4[_0x464fb2(0x19c)]((_0x541d6e,_0x146584)=>_0x146584[_0x464fb2(0x199)]-_0x541d6e[_0x464fb2(0x199)]),console[_0x464fb2(0x26c)](_0x464fb2(0x1fe)+_0x418ce4['length']+_0x464fb2(0x1fb)),_0x418ce4;}async['depositBalance'](_0xd840e1,_0xe05b2a,_0x5c7c83){const _0x524843=a53_0x4bdb09,_0x22ab70=await database_1[_0x524843(0x28a)][_0x524843(0x1c8)][_0x524843(0x2a1)]({'where':{'id':_0xd840e1}});if(!_0x22ab70)throw new Error(_0x524843(0x18a));await database_1[_0x524843(0x28a)][_0x524843(0x2ba)](async _0x4bac9c=>{const _0x143d97=_0x524843;await _0x4bac9c[_0x143d97(0x149)][_0x143d97(0x2ca)]({'data':{'shopId':_0x22ab70['id'],'amount':_0xe05b2a,'amountUSDT':_0xe05b2a,'amountAfterGatewayCommissionUSDT':_0xe05b2a,'sourceCurrency':_0x143d97(0x183),'currency':'USDC','status':_0x143d97(0x2cf),'gateway':'Deposit','customerName':_0x22ab70[_0x143d97(0x15a)],'customerEmail':'@'+_0x22ab70[_0x143d97(0x229)],'paymentMethod':'CRYPTO','adminNotes':_0x5c7c83||null,'successUrl':'-','failUrl':'-','paidAt':new Date()}}),await _0x4bac9c[_0x143d97(0x1c8)][_0x143d97(0x2ce)]({'where':{'id':_0x22ab70['id']},'data':{'balance':{'increment':_0xe05b2a}}});}),console[_0x524843(0x26c)](_0x524843(0x1f5)+_0xe05b2a+_0x524843(0x207)+_0x22ab70['username']);}}exports[a53_0x4bdb09(0x28e)]=AdminService;