'use strict';const a33_0x1f23f3=a33_0x2253;(function(_0x4d1a78,_0x4e47dc){const _0x5bb470=a33_0x2253,_0x14feee=_0x4d1a78();while(!![]){try{const _0x49b8e=-parseInt(_0x5bb470(0x225))/0x1+-parseInt(_0x5bb470(0x192))/0x2+-parseInt(_0x5bb470(0x1ac))/0x3*(-parseInt(_0x5bb470(0x180))/0x4)+parseInt(_0x5bb470(0x243))/0x5+-parseInt(_0x5bb470(0x213))/0x6*(parseInt(_0x5bb470(0x1f6))/0x7)+parseInt(_0x5bb470(0x181))/0x8*(-parseInt(_0x5bb470(0x1fc))/0x9)+parseInt(_0x5bb470(0x1a9))/0xa*(parseInt(_0x5bb470(0x1a3))/0xb);if(_0x49b8e===_0x4e47dc)break;else _0x14feee['push'](_0x14feee['shift']());}catch(_0x5b818d){_0x14feee['push'](_0x14feee['shift']());}}}(a33_0x10e5,0x1c670));var __importDefault=this&&this[a33_0x1f23f3(0x1db)]||function(_0x3493fa){return _0x3493fa&&_0x3493fa['__esModule']?_0x3493fa:{'default':_0x3493fa};};Object['defineProperty'](exports,a33_0x1f23f3(0x248),{'value':!![]}),exports[a33_0x1f23f3(0x190)]=void 0x0;const database_1=__importDefault(require(a33_0x1f23f3(0x1ea))),bcryptjs_1=__importDefault(require(a33_0x1f23f3(0x1d0))),crypto_1=__importDefault(require('crypto')),currencyService_1=require('./currencyService');function a33_0x10e5(){const _0xf6a308=['\x20USDT','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','getPayoutById','590SEnVXZ','ceil','CHARGEBACK','1293jlfVjK','\x20payments\x20awaiting\x20payout','CoinToPay','getMerchantStatistics','customerEmail','filter','network','ACTIVE','2020-01-01','awaitingPayout','create','sort','deletePayout','totalPayout','\x20USDT\x20(paid\x20out)','reduce','payout','not\x20set','thisMonth','toISOString','payment','\x20->\x20','updateCustomerData','failUrl','turnover','shopId','KLYME\x20EU','createPayout','toUpperCase','gatewaySettings','📅\x20Period:\x20','\x20USDT\x20(pending\x20payout)','Error\x20processing\x20payment\x20','\x20\x20\x20💰\x20Total\x20turnover:\x20','getTime','findUnique','bcryptjs','getPayoutStats','paymentsCount','\x20\x20\x20🌍\x20Country:\x20','toString','\x20USDT\x20total','Rapyd','toLowerCase','hash','dateTo','\x20USDT\x20(after\x20commission)','__importDefault','paidAt','statusChangedBy','username','⏳\x20Payment\x20','usdtPolygonWallet','\x20merchants,\x20','\x20for\x20shop\x20','customerUa','Plisio','turnoverUSDT','oldestPaymentDate','merchantPaid','usdcPolygonWallet','30d','../config/database','periodFrom','parse','externalPaymentUrl','chargebackAmount','successUrl','amountAfterCommissionUSDT','all','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','activateUser','getMerchantsAwaitingPayout','deleteUser','3381jCWKPd','stringify','currencyService','update','totalAmountUSDT','KLYME\x20DE','1116mOtpus','insensitive','periodTo','pendingUrl','gatewayBreakdown','statusChangedAt','week','Shop\x20not\x20found','COMPLETED','gatewayEarnings','fullName','updateUser','getUserById','findMany','shopUrl','customerName','hex','\x20USDT)','\x20\x20\x20💰\x20Total\x20payout:\x20','paymentGateways','totalPayments','gte','amount','282uCsPVt','totalAmountAfterCommissionUSDT','txid','log','updatedAt','averageCheckUSDT','failureMessage','map','period','\x20\x20\x20🌐\x20IP:\x20','password','date','averageCommissionRate','convertToUSDT','📊\x20Merchants\x20awaiting\x20payout:\x20','\x20USDT\x20(before\x20commission)','\x20\x20\x20🖥️\x20User\x20Agent:\x20','includes','155890SUohky','getMonth','amountUSDT','getAllPayouts','gatewayOrderId','gateways','customerCountry','randomBytes','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','availableBalance','commission','Noda','usdtErcWallet','getGatewayDisplayName','commissionUSDT','usdtTrcWallet','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','length','createdAt','merchantEarnings','\x20paid\x20payments\x20for\x20analysis','SUSPENDED','whiteUrl','✅\x20Payout\x20created:\x20','set','lte','notes','name','\x20\x20\x20💵\x20Available\x20balance:\x20','wallets','1094255HuKsEY','toFixed','PAID','currency','📊\x20Calculating\x20payout\x20statistics...','__esModule','merchantEarningsUSDT','telegram','forEach','status','964TbAbyy','3000RZdIGd','year','merchantUrl','telegramId','adminNotes','customerIp','publicKey','slice','error','custom','round','paidOutUSDT','getAllPayments','\x20to\x20','✅\x20Payment\x20','AdminService','orderId','215700enBWum','desc','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','totalCommissionRate','default','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','values','Username\x20already\x20exists','💰\x20Found\x20','totalTurnover','dateFrom','suspendUser','getAllUsers','getFullYear','Telegram\x20username\x20already\x20exists','shop','count','23595VTmLkv','📊\x20Payout\x20statistics\x20calculated:','gateway'];a33_0x10e5=function(){return _0xf6a308;};return a33_0x10e5();}class AdminService{async[a33_0x1f23f3(0x1d1)](){const _0x5571e3=a33_0x1f23f3;console[_0x5571e3(0x216)](_0x5571e3(0x247));const _0x4f7370=await database_1[_0x5571e3(0x196)][_0x5571e3(0x1c0)][_0x5571e3(0x209)]({'where':{'status':_0x5571e3(0x245),'paidAt':{'not':null}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'merchantPaid':!![],'paidAt':!![],'createdAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x5571e3(0x216)](_0x5571e3(0x19a)+_0x4f7370['length']+'\x20paid\x20payments');let _0x577801=0x0,_0x18764a=0x0,_0x48ca4e=0x0;for(const _0x4af138 of _0x4f7370){try{const _0x269e3b=await currencyService_1[_0x5571e3(0x1f8)][_0x5571e3(0x220)](_0x4af138['amount'],_0x4af138[_0x5571e3(0x246)]);let _0x3ce55d={};if(_0x4af138['shop'][_0x5571e3(0x1c9)])try{_0x3ce55d=JSON[_0x5571e3(0x1ec)](_0x4af138[_0x5571e3(0x1a1)][_0x5571e3(0x1c9)]);}catch(_0x5f2478){console['error'](_0x5571e3(0x235)+_0x4af138[_0x5571e3(0x1c5)]+':',_0x5f2478);}const _0x221369=_0x3ce55d[_0x5571e3(0x22f)]||0xa,_0x42b39f=_0x269e3b*(0x1-_0x221369/0x64);_0x4af138[_0x5571e3(0x1e7)]?(_0x577801+=_0x42b39f,console[_0x5571e3(0x216)](_0x5571e3(0x18f)+_0x4af138['id']+':\x20'+_0x42b39f[_0x5571e3(0x244)](0x2)+_0x5571e3(0x1ba))):(_0x18764a+=_0x42b39f,_0x48ca4e+=_0x269e3b,console[_0x5571e3(0x216)](_0x5571e3(0x1df)+_0x4af138['id']+':\x20'+_0x42b39f['toFixed'](0x2)+_0x5571e3(0x1cb)));}catch(_0x1ce434){console[_0x5571e3(0x189)](_0x5571e3(0x1cc)+_0x4af138['id']+':',_0x1ce434);}}const _0x9b8cd1=new Date(),_0xf8ab28=new Date(_0x9b8cd1[_0x5571e3(0x19f)](),_0x9b8cd1[_0x5571e3(0x226)](),0x1),_0x3e2ab=new Date(_0x9b8cd1[_0x5571e3(0x19f)](),_0x9b8cd1[_0x5571e3(0x226)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x23f020=await database_1[_0x5571e3(0x196)][_0x5571e3(0x1bc)]['findMany']({'where':{'createdAt':{'gte':_0xf8ab28,'lte':_0x3e2ab},'status':_0x5571e3(0x204)},'select':{'amount':!![]}}),_0x3a8838=_0x23f020[_0x5571e3(0x1bb)]((_0x519c01,_0x23bfdc)=>_0x519c01+_0x23bfdc[_0x5571e3(0x212)],0x0),_0xdddec8={'totalPayout':Math[_0x5571e3(0x18b)](_0x577801*0x64)/0x64,'awaitingPayout':Math['round'](_0x18764a*0x64)/0x64,'thisMonth':Math[_0x5571e3(0x18b)](_0x3a8838*0x64)/0x64,'availableBalance':Math[_0x5571e3(0x18b)](_0x48ca4e*0x64)/0x64};return console['log'](_0x5571e3(0x1a4)),console[_0x5571e3(0x216)](_0x5571e3(0x20e)+_0xdddec8[_0x5571e3(0x1b9)]+'\x20USDT\x20(paid\x20to\x20merchants)'),console[_0x5571e3(0x216)](_0x5571e3(0x197)+_0xdddec8[_0x5571e3(0x1b5)]+_0x5571e3(0x1da)),console[_0x5571e3(0x216)](_0x5571e3(0x241)+_0xdddec8[_0x5571e3(0x22e)]+_0x5571e3(0x222)),console['log']('\x20\x20\x20📅\x20This\x20month:\x20'+_0xdddec8[_0x5571e3(0x1be)]+_0x5571e3(0x1a6)),_0xdddec8;}async[a33_0x1f23f3(0x1c2)](_0x5ba2a4,_0x4b7fc1){const _0x207745=a33_0x1f23f3;console[_0x207745(0x216)]('🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20'+_0x5ba2a4+':',_0x4b7fc1);const _0x5351e8=await database_1['default'][_0x207745(0x1c0)]['findUnique']({'where':{'id':_0x5ba2a4},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x5351e8)throw new Error('Payment\x20not\x20found');const _0x465532={};_0x4b7fc1[_0x207745(0x22b)]!==undefined&&(_0x465532[_0x207745(0x22b)]=_0x4b7fc1['customerCountry']||null);_0x4b7fc1['customerIp']!==undefined&&(_0x465532[_0x207745(0x186)]=_0x4b7fc1['customerIp']||null);_0x4b7fc1['customerUa']!==undefined&&(_0x465532[_0x207745(0x1e3)]=_0x4b7fc1[_0x207745(0x1e3)]||null);const _0x321e0c=await database_1[_0x207745(0x196)][_0x207745(0x1c0)]['update']({'where':{'id':_0x5ba2a4},'data':{..._0x465532,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x207745(0x216)](_0x207745(0x22d)+_0x5ba2a4),console[_0x207745(0x216)](_0x207745(0x1d3)+_0x5351e8[_0x207745(0x22b)]+'\x20->\x20'+_0x321e0c[_0x207745(0x22b)]),console['log'](_0x207745(0x21c)+_0x5351e8[_0x207745(0x186)]+'\x20->\x20'+_0x321e0c[_0x207745(0x186)]),console[_0x207745(0x216)](_0x207745(0x223)+(_0x5351e8[_0x207745(0x1e3)]?_0x207745(0x23d):_0x207745(0x1bd))+_0x207745(0x1c1)+(_0x321e0c[_0x207745(0x1e3)]?_0x207745(0x23d):_0x207745(0x1bd))),_0x321e0c;}async['getSystemStatistics'](_0x320b38){const _0x3a8ba5=a33_0x1f23f3,_0x22796e=new Date();let _0x30eb40;switch(_0x320b38){case'7d':_0x30eb40=new Date(_0x22796e['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x3a8ba5(0x1e9):_0x30eb40=new Date(_0x22796e[_0x3a8ba5(0x1ce)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'90d':_0x30eb40=new Date(_0x22796e[_0x3a8ba5(0x1ce)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x30eb40=new Date(_0x22796e[_0x3a8ba5(0x1ce)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x1999fa,_0x12c869,_0x3d382a,_0x2828d9,_0xa1bced,_0x131d30]=await Promise[_0x3a8ba5(0x1f1)]([database_1[_0x3a8ba5(0x196)][_0x3a8ba5(0x1a1)][_0x3a8ba5(0x1a2)](),database_1['default']['shop'][_0x3a8ba5(0x1a2)]({'where':{'status':'ACTIVE'}}),database_1['default'][_0x3a8ba5(0x1c0)]['count']({'where':{'createdAt':{'gte':_0x30eb40}}}),database_1[_0x3a8ba5(0x196)][_0x3a8ba5(0x1c0)]['count']({'where':{'status':'PAID','createdAt':{'gte':_0x30eb40}}}),database_1[_0x3a8ba5(0x196)][_0x3a8ba5(0x1c0)][_0x3a8ba5(0x209)]({'where':{'status':_0x3a8ba5(0x245),'createdAt':{'gte':_0x30eb40}},'select':{'amount':!![],'currency':!![]}}),database_1[_0x3a8ba5(0x196)][_0x3a8ba5(0x1c0)]['findMany']({'take':0xa,'orderBy':{'createdAt':_0x3a8ba5(0x193)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}})]);let _0x5865d0=0x0;for(const _0x5dd01e of _0xa1bced){const _0x5540b5=await currencyService_1[_0x3a8ba5(0x1f8)]['convertToUSDT'](_0x5dd01e[_0x3a8ba5(0x212)],_0x5dd01e[_0x3a8ba5(0x246)]);_0x5865d0+=_0x5540b5;}const _0x24ac25=_0x3d382a>0x0?_0x2828d9/_0x3d382a*0x64:0x0;return{'totalShops':_0x1999fa,'activeShops':_0x12c869,'totalPayments':_0x3d382a,'successfulPayments':_0x2828d9,'totalRevenue':Math[_0x3a8ba5(0x18b)](_0x5865d0*0x64)/0x64,'conversionRate':Math[_0x3a8ba5(0x18b)](_0x24ac25*0x64)/0x64,'recentPayments':_0x131d30[_0x3a8ba5(0x21a)](_0x56a8a7=>({'id':_0x56a8a7['id'],'amount':_0x56a8a7['amount'],'currency':_0x56a8a7[_0x3a8ba5(0x246)],'status':_0x56a8a7[_0x3a8ba5(0x24c)],'gateway':_0x56a8a7['gateway'],'shop':_0x56a8a7[_0x3a8ba5(0x1a1)],'createdAt':_0x56a8a7['createdAt']}))};}async[a33_0x1f23f3(0x1af)](_0x4994b0){const _0x5006ea=a33_0x1f23f3;console[_0x5006ea(0x216)](_0x5006ea(0x194),_0x4994b0);let _0x351b89,_0x449e94=new Date();if(_0x4994b0[_0x5006ea(0x21b)]===_0x5006ea(0x18a)&&_0x4994b0[_0x5006ea(0x19c)]&&_0x4994b0[_0x5006ea(0x1d9)])_0x351b89=new Date(_0x4994b0[_0x5006ea(0x19c)]),_0x449e94=new Date(_0x4994b0['dateTo']);else{const _0xdec8e9=new Date();switch(_0x4994b0[_0x5006ea(0x21b)]){case _0x5006ea(0x202):_0x351b89=new Date(_0xdec8e9[_0x5006ea(0x1ce)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'month':_0x351b89=new Date(_0xdec8e9[_0x5006ea(0x1ce)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x5006ea(0x182):_0x351b89=new Date(_0xdec8e9['getTime']()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x5006ea(0x1f1):default:_0x351b89=new Date(_0x5006ea(0x1b4));break;}}console[_0x5006ea(0x216)](_0x5006ea(0x1ca)+_0x351b89[_0x5006ea(0x1bf)]()+_0x5006ea(0x18e)+_0x449e94[_0x5006ea(0x1bf)]());const _0x42c424={'status':_0x5006ea(0x245),'paidAt':{'gte':_0x351b89,'lte':_0x449e94}};_0x4994b0[_0x5006ea(0x1c5)]&&(_0x42c424[_0x5006ea(0x1c5)]=_0x4994b0[_0x5006ea(0x1c5)]);const _0x388102=await database_1[_0x5006ea(0x196)][_0x5006ea(0x1c0)][_0x5006ea(0x209)]({'where':_0x42c424,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x5006ea(0x216)](_0x5006ea(0x19a)+_0x388102['length']+_0x5006ea(0x239));let _0x218d6c=0x0,_0x1c4cad=0x0,_0xd3e821=0x0;const _0x3cf677={},_0x148f6d={},_0x78d686={};for(const _0x2fb757 of _0x388102){try{const _0x449b25=await currencyService_1['currencyService'][_0x5006ea(0x220)](_0x2fb757['amount'],_0x2fb757['currency']);let _0x540942={};if(_0x2fb757[_0x5006ea(0x1a1)][_0x5006ea(0x1c9)])try{_0x540942=JSON[_0x5006ea(0x1ec)](_0x2fb757[_0x5006ea(0x1a1)][_0x5006ea(0x1c9)]);}catch(_0x2db9c9){console[_0x5006ea(0x189)]('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x2fb757['shopId']+':',_0x2db9c9);}const _0x57e8bd=_0x540942[_0x5006ea(0x22f)]||0xa,_0x40355f=_0x449b25*(_0x57e8bd/0x64),_0x44eedb=_0x449b25-_0x40355f;_0x218d6c+=_0x449b25,_0x1c4cad+=_0x44eedb,_0xd3e821+=_0x40355f;!_0x3cf677[_0x2fb757[_0x5006ea(0x1a5)]]&&(_0x3cf677[_0x2fb757[_0x5006ea(0x1a5)]]={'gateway':_0x2fb757[_0x5006ea(0x1a5)],'gatewayDisplayName':this[_0x5006ea(0x232)](_0x2fb757[_0x5006ea(0x1a5)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x3cf677[_0x2fb757[_0x5006ea(0x1a5)]][_0x5006ea(0x1d2)]++,_0x3cf677[_0x2fb757[_0x5006ea(0x1a5)]][_0x5006ea(0x1e5)]+=_0x449b25,_0x3cf677[_0x2fb757[_0x5006ea(0x1a5)]][_0x5006ea(0x233)]+=_0x40355f,_0x3cf677[_0x2fb757[_0x5006ea(0x1a5)]][_0x5006ea(0x249)]+=_0x44eedb,_0x3cf677[_0x2fb757[_0x5006ea(0x1a5)]][_0x5006ea(0x195)]+=_0x57e8bd;!_0x4994b0[_0x5006ea(0x1c5)]&&(!_0x148f6d[_0x2fb757[_0x5006ea(0x1c5)]]&&(_0x148f6d[_0x2fb757[_0x5006ea(0x1c5)]]={'shopId':_0x2fb757[_0x5006ea(0x1c5)],'shopName':_0x2fb757[_0x5006ea(0x1a1)]['name'],'shopUsername':_0x2fb757[_0x5006ea(0x1a1)]['username'],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x148f6d[_0x2fb757[_0x5006ea(0x1c5)]]['paymentsCount']++,_0x148f6d[_0x2fb757[_0x5006ea(0x1c5)]][_0x5006ea(0x1e5)]+=_0x449b25,_0x148f6d[_0x2fb757[_0x5006ea(0x1c5)]]['commissionUSDT']+=_0x40355f,_0x148f6d[_0x2fb757[_0x5006ea(0x1c5)]]['merchantEarningsUSDT']+=_0x44eedb);const _0xe3ad83=_0x2fb757[_0x5006ea(0x1dc)][_0x5006ea(0x1bf)]()['split']('T')[0x0];!_0x78d686[_0xe3ad83]&&(_0x78d686[_0xe3ad83]={'date':_0xe3ad83,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x78d686[_0xe3ad83]['turnover']+=_0x449b25,_0x78d686[_0xe3ad83]['merchantEarnings']+=_0x44eedb,_0x78d686[_0xe3ad83][_0x5006ea(0x205)]+=_0x40355f,_0x78d686[_0xe3ad83][_0x5006ea(0x1d2)]++;}catch(_0x5a89b5){console['error']('Error\x20processing\x20payment\x20'+_0x2fb757['id']+':',_0x5a89b5);}}Object[_0x5006ea(0x198)](_0x3cf677)[_0x5006ea(0x24b)](_0x30f0ac=>{const _0x24af11=_0x5006ea;_0x30f0ac['averageCommissionRate']=_0x30f0ac[_0x24af11(0x1d2)]>0x0?_0x30f0ac['totalCommissionRate']/_0x30f0ac[_0x24af11(0x1d2)]:0x0,delete _0x30f0ac[_0x24af11(0x195)];}),Object[_0x5006ea(0x198)](_0x148f6d)['forEach'](_0x39108e=>{const _0x1d161c=_0x5006ea;_0x39108e[_0x1d161c(0x218)]=_0x39108e['paymentsCount']>0x0?_0x39108e[_0x1d161c(0x1e5)]/_0x39108e[_0x1d161c(0x1d2)]:0x0;});let _0x44922b=0x0;if(_0x4994b0[_0x5006ea(0x1c5)]){const _0x8c0579=await database_1[_0x5006ea(0x196)][_0x5006ea(0x1bc)][_0x5006ea(0x209)]({'where':{'shopId':_0x4994b0[_0x5006ea(0x1c5)],'status':_0x5006ea(0x204),'createdAt':{'gte':_0x351b89,'lte':_0x449e94}},'select':{'amount':!![]}});_0x44922b=_0x8c0579[_0x5006ea(0x1bb)]((_0x2fae2e,_0x5310d5)=>_0x2fae2e+_0x5310d5[_0x5006ea(0x212)],0x0);}const _0x473b5d=_0x388102['length'],_0x364f93=_0x388102[_0x5006ea(0x236)],_0x502605=_0x473b5d>0x0?_0x218d6c/_0x473b5d:0x0,_0x170d49=0x64,_0x1821a3=Math[_0x5006ea(0x1aa)]((_0x449e94[_0x5006ea(0x1ce)]()-_0x351b89[_0x5006ea(0x1ce)]())/(0x3e8*0x3c*0x3c*0x18)),_0x31ca04={'totalTurnover':Math[_0x5006ea(0x18b)](_0x218d6c*0x64)/0x64,'merchantEarnings':Math[_0x5006ea(0x18b)](_0x1c4cad*0x64)/0x64,'gatewayEarnings':Math['round'](_0xd3e821*0x64)/0x64,'totalPaidOut':Math[_0x5006ea(0x18b)](_0x44922b*0x64)/0x64,'averageCheck':Math['round'](_0x502605*0x64)/0x64,'totalPayments':_0x473b5d,'successfulPayments':_0x364f93,'conversionRate':_0x170d49,'gatewayBreakdown':Object[_0x5006ea(0x198)](_0x3cf677)[_0x5006ea(0x21a)](_0xe86aaa=>({..._0xe86aaa,'turnoverUSDT':Math['round'](_0xe86aaa[_0x5006ea(0x1e5)]*0x64)/0x64,'commissionUSDT':Math[_0x5006ea(0x18b)](_0xe86aaa[_0x5006ea(0x233)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x5006ea(0x18b)](_0xe86aaa[_0x5006ea(0x249)]*0x64)/0x64,'averageCommissionRate':Math['round'](_0xe86aaa[_0x5006ea(0x21f)]*0x64)/0x64})),'merchantBreakdown':_0x4994b0[_0x5006ea(0x1c5)]?undefined:Object['values'](_0x148f6d)[_0x5006ea(0x21a)](_0x2906a0=>({..._0x2906a0,'turnoverUSDT':Math[_0x5006ea(0x18b)](_0x2906a0['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x5006ea(0x18b)](_0x2906a0['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x5006ea(0x18b)](_0x2906a0[_0x5006ea(0x249)]*0x64)/0x64,'paidOutUSDT':Math[_0x5006ea(0x18b)](_0x2906a0[_0x5006ea(0x18c)]*0x64)/0x64,'averageCheckUSDT':Math[_0x5006ea(0x18b)](_0x2906a0[_0x5006ea(0x218)]*0x64)/0x64})),'dailyData':Object['values'](_0x78d686)[_0x5006ea(0x21a)](_0x221268=>({..._0x221268,'turnover':Math['round'](_0x221268[_0x5006ea(0x1c4)]*0x64)/0x64,'merchantEarnings':Math[_0x5006ea(0x18b)](_0x221268[_0x5006ea(0x238)]*0x64)/0x64,'gatewayEarnings':Math[_0x5006ea(0x18b)](_0x221268[_0x5006ea(0x205)]*0x64)/0x64}))[_0x5006ea(0x1b7)]((_0x4a2bf2,_0x503f44)=>_0x4a2bf2['date']['localeCompare'](_0x503f44[_0x5006ea(0x21e)])),'periodInfo':{'from':_0x351b89,'to':_0x449e94,'periodType':_0x4994b0[_0x5006ea(0x21b)]||_0x5006ea(0x18a),'daysCount':_0x1821a3}};return console[_0x5006ea(0x216)]('📊\x20Merchant\x20statistics\x20calculated:'),console[_0x5006ea(0x216)](_0x5006ea(0x1cd)+_0x31ca04[_0x5006ea(0x19b)]+_0x5006ea(0x1a6)),console[_0x5006ea(0x216)](_0x5006ea(0x1f2)+_0x31ca04['merchantEarnings']+_0x5006ea(0x1a6)),console['log']('\x20\x20\x20🏪\x20Gateway\x20earnings:\x20'+_0x31ca04[_0x5006ea(0x205)]+_0x5006ea(0x1a6)),console[_0x5006ea(0x216)]('\x20\x20\x20📊\x20Total\x20payments:\x20'+_0x31ca04[_0x5006ea(0x210)]),_0x31ca04;}['getGatewayDisplayName'](_0x4c08c3){const _0x1bc127=a33_0x1f23f3,_0x1d6ce7={'plisio':_0x1bc127(0x1e4),'rapyd':_0x1bc127(0x1d6),'noda':_0x1bc127(0x230),'cointopay':_0x1bc127(0x1ae),'klyme_eu':_0x1bc127(0x1c6),'klyme_gb':'KLYME\x20GB','klyme_de':_0x1bc127(0x1fb)};return _0x1d6ce7[_0x4c08c3]||_0x4c08c3;}async[a33_0x1f23f3(0x1f4)](_0x101232){const _0x26b002=a33_0x1f23f3,{page:_0x4ac12a,limit:_0xac162d,minAmount:_0x529238,search:_0x140e1d}=_0x101232,_0x3723fd=(_0x4ac12a-0x1)*_0xac162d;console[_0x26b002(0x216)](_0x26b002(0x1a7),_0x101232);const _0x148394=await database_1[_0x26b002(0x196)][_0x26b002(0x1c0)]['findMany']({'where':{'status':'PAID','merchantPaid':![],'paidAt':{'not':null}},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'gatewaySettings':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}});console[_0x26b002(0x216)](_0x26b002(0x19a)+_0x148394[_0x26b002(0x236)]+_0x26b002(0x1ad));const _0x19a653={};for(const _0x139a4a of _0x148394){const _0x198fd4=_0x139a4a[_0x26b002(0x1c5)];!_0x19a653[_0x198fd4]&&(_0x19a653[_0x198fd4]={'id':_0x139a4a[_0x26b002(0x1a1)]['id'],'fullName':_0x139a4a['shop'][_0x26b002(0x240)],'username':_0x139a4a[_0x26b002(0x1a1)][_0x26b002(0x1de)],'telegramId':_0x139a4a[_0x26b002(0x1a1)]['telegram'],'merchantUrl':_0x139a4a[_0x26b002(0x1a1)][_0x26b002(0x20a)],'wallets':{'usdtPolygonWallet':_0x139a4a[_0x26b002(0x1a1)][_0x26b002(0x1e0)],'usdtTrcWallet':_0x139a4a[_0x26b002(0x1a1)][_0x26b002(0x234)],'usdtErcWallet':_0x139a4a['shop']['usdtErcWallet'],'usdcPolygonWallet':_0x139a4a[_0x26b002(0x1a1)][_0x26b002(0x1e8)]},'totalAmountUSDT':0x0,'totalAmountAfterCommissionUSDT':0x0,'paymentsCount':0x0,'oldestPaymentDate':_0x139a4a[_0x26b002(0x1dc)],'gatewayBreakdown':{},'gatewaySettings':_0x139a4a[_0x26b002(0x1a1)][_0x26b002(0x1c9)]});try{const _0x4a298a=await currencyService_1['currencyService'][_0x26b002(0x220)](_0x139a4a['amount'],_0x139a4a[_0x26b002(0x246)]);let _0x4dd5e3={};if(_0x139a4a['shop'][_0x26b002(0x1c9)])try{_0x4dd5e3=JSON[_0x26b002(0x1ec)](_0x139a4a[_0x26b002(0x1a1)][_0x26b002(0x1c9)]);}catch(_0x39ae16){console['error'](_0x26b002(0x235)+_0x198fd4+':',_0x39ae16);}const _0x258f85=_0x4dd5e3['commission']||0xa,_0x32f39f=_0x4a298a*(0x1-_0x258f85/0x64);_0x19a653[_0x198fd4][_0x26b002(0x1fa)]+=_0x4a298a,_0x19a653[_0x198fd4][_0x26b002(0x214)]+=_0x32f39f,_0x19a653[_0x198fd4][_0x26b002(0x1d2)]++,_0x139a4a[_0x26b002(0x1dc)]<_0x19a653[_0x198fd4]['oldestPaymentDate']&&(_0x19a653[_0x198fd4][_0x26b002(0x1e6)]=_0x139a4a[_0x26b002(0x1dc)]),!_0x19a653[_0x198fd4]['gatewayBreakdown'][_0x139a4a[_0x26b002(0x1a5)]]&&(_0x19a653[_0x198fd4]['gatewayBreakdown'][_0x139a4a[_0x26b002(0x1a5)]]={'gateway':_0x139a4a['gateway'],'count':0x0,'amountUSDT':0x0,'amountAfterCommissionUSDT':0x0,'commission':_0x258f85}),_0x19a653[_0x198fd4][_0x26b002(0x200)][_0x139a4a[_0x26b002(0x1a5)]][_0x26b002(0x1a2)]++,_0x19a653[_0x198fd4][_0x26b002(0x200)][_0x139a4a['gateway']]['amountUSDT']+=_0x4a298a,_0x19a653[_0x198fd4][_0x26b002(0x200)][_0x139a4a['gateway']]['amountAfterCommissionUSDT']+=_0x32f39f;}catch(_0x165018){console[_0x26b002(0x189)](_0x26b002(0x1cc)+_0x139a4a['id']+':',_0x165018);}}let _0x416313=Object[_0x26b002(0x198)](_0x19a653)[_0x26b002(0x21a)](_0x185f34=>({..._0x185f34,'totalAmountUSDT':Math[_0x26b002(0x18b)](_0x185f34[_0x26b002(0x1fa)]*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x185f34[_0x26b002(0x214)]*0x64)/0x64,'gatewayBreakdown':Object[_0x26b002(0x198)](_0x185f34[_0x26b002(0x200)])['map'](_0xb1224=>({..._0xb1224,'amountUSDT':Math[_0x26b002(0x18b)](_0xb1224[_0x26b002(0x227)]*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x26b002(0x18b)](_0xb1224[_0x26b002(0x1f0)]*0x64)/0x64}))}));_0x529238&&(_0x416313=_0x416313[_0x26b002(0x1b1)](_0x2ac0ff=>_0x2ac0ff[_0x26b002(0x214)]>=_0x529238));if(_0x140e1d){const _0x3d411e=_0x140e1d[_0x26b002(0x1d7)]();_0x416313=_0x416313['filter'](_0xeb0e15=>_0xeb0e15[_0x26b002(0x206)][_0x26b002(0x1d7)]()[_0x26b002(0x224)](_0x3d411e)||_0xeb0e15['username'][_0x26b002(0x1d7)]()['includes'](_0x3d411e));}_0x416313[_0x26b002(0x1b7)]((_0x5a0385,_0x53a4d1)=>_0x53a4d1[_0x26b002(0x214)]-_0x5a0385[_0x26b002(0x214)]);const _0x2e5e82=_0x416313[_0x26b002(0x236)],_0x34dd25=_0x416313[_0x26b002(0x188)](_0x3723fd,_0x3723fd+_0xac162d),_0x289fa8=_0x416313[_0x26b002(0x1bb)]((_0xf08155,_0x132b6b)=>_0xf08155+_0x132b6b[_0x26b002(0x1fa)],0x0),_0x4962c6=_0x416313['reduce']((_0x3b5de7,_0x4412b6)=>_0x3b5de7+_0x4412b6[_0x26b002(0x214)],0x0);return console[_0x26b002(0x216)](_0x26b002(0x221)+_0x2e5e82+_0x26b002(0x1e1)+Math['round'](_0x4962c6*0x64)/0x64+_0x26b002(0x1d5)),{'merchants':_0x34dd25,'pagination':{'page':_0x4ac12a,'limit':_0xac162d,'total':_0x2e5e82,'totalPages':Math[_0x26b002(0x1aa)](_0x2e5e82/_0xac162d)},'summary':{'totalMerchants':_0x2e5e82,'totalAmountUSDT':Math[_0x26b002(0x18b)](_0x289fa8*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x26b002(0x18b)](_0x4962c6*0x64)/0x64}};}async[a33_0x1f23f3(0x1c7)](_0x10c7ca){const _0xb842a1=a33_0x1f23f3,{shopId:_0x9b151b,amount:_0x1c64e6,network:_0x49d932,notes:_0x3bb9b1,periodFrom:_0x109c44,periodTo:_0x3c9db0}=_0x10c7ca,_0x54dfd9=await database_1[_0xb842a1(0x196)][_0xb842a1(0x1a1)][_0xb842a1(0x1cf)]({'where':{'id':_0x9b151b},'select':{'id':!![],'name':!![],'username':!![]}});if(!_0x54dfd9)throw new Error(_0xb842a1(0x203));const _0x5237ea=await database_1[_0xb842a1(0x196)][_0xb842a1(0x1bc)][_0xb842a1(0x1b6)]({'data':{'shopId':_0x9b151b,'amount':_0x1c64e6,'network':_0x49d932,'status':_0xb842a1(0x204),'notes':_0x3bb9b1,'periodFrom':_0x109c44?new Date(_0x109c44):null,'periodTo':_0x3c9db0?new Date(_0x3c9db0):null,'createdAt':new Date(),'paidAt':new Date()}});return console[_0xb842a1(0x216)](_0xb842a1(0x23c)+_0x5237ea['id']+_0xb842a1(0x1e2)+_0x54dfd9['username']+'\x20('+_0x1c64e6+_0xb842a1(0x20d)),{'id':_0x5237ea['id'],'shopId':_0x5237ea[_0xb842a1(0x1c5)],'shopName':_0x54dfd9[_0xb842a1(0x240)],'shopUsername':_0x54dfd9[_0xb842a1(0x1de)],'amount':_0x5237ea[_0xb842a1(0x212)],'network':_0x5237ea[_0xb842a1(0x1b2)],'status':_0x5237ea[_0xb842a1(0x24c)],'txid':_0x5237ea['txid'],'notes':_0x5237ea['notes'],'periodFrom':_0x5237ea[_0xb842a1(0x1eb)],'periodTo':_0x5237ea[_0xb842a1(0x1fe)],'createdAt':_0x5237ea[_0xb842a1(0x237)],'paidAt':_0x5237ea[_0xb842a1(0x1dc)]};}async[a33_0x1f23f3(0x228)](_0x41ce34){const _0x4fbbfd=a33_0x1f23f3,{page:_0x34bfc1,limit:_0x333b87,shopId:_0x1c8bd9,network:_0x3e96e3,dateFrom:_0x2880b3,dateTo:_0x1b636c,search:_0x37c8b3}=_0x41ce34,_0x39f5f2=(_0x34bfc1-0x1)*_0x333b87,_0x1be00c={};_0x1c8bd9&&(_0x1be00c[_0x4fbbfd(0x1c5)]=_0x1c8bd9);_0x3e96e3&&(_0x1be00c[_0x4fbbfd(0x1b2)]=_0x3e96e3);(_0x2880b3||_0x1b636c)&&(_0x1be00c[_0x4fbbfd(0x237)]={},_0x2880b3&&(_0x1be00c[_0x4fbbfd(0x237)][_0x4fbbfd(0x211)]=new Date(_0x2880b3)),_0x1b636c&&(_0x1be00c[_0x4fbbfd(0x237)][_0x4fbbfd(0x23e)]=new Date(_0x1b636c)));_0x37c8b3&&(_0x1be00c['OR']=[{'shop':{'name':{'contains':_0x37c8b3,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x37c8b3,'mode':_0x4fbbfd(0x1fd)}}},{'notes':{'contains':_0x37c8b3,'mode':'insensitive'}}]);const [_0x482429,_0x40ce3c]=await Promise[_0x4fbbfd(0x1f1)]([database_1[_0x4fbbfd(0x196)][_0x4fbbfd(0x1bc)][_0x4fbbfd(0x209)]({'where':_0x1be00c,'skip':_0x39f5f2,'take':_0x333b87,'orderBy':{'createdAt':_0x4fbbfd(0x193)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x4fbbfd(0x196)]['payout']['count']({'where':_0x1be00c})]);return{'payouts':_0x482429[_0x4fbbfd(0x21a)](_0x1e0b6f=>({'id':_0x1e0b6f['id'],'shopId':_0x1e0b6f[_0x4fbbfd(0x1c5)],'shopName':_0x1e0b6f[_0x4fbbfd(0x1a1)][_0x4fbbfd(0x240)],'shopUsername':_0x1e0b6f[_0x4fbbfd(0x1a1)][_0x4fbbfd(0x1de)],'amount':_0x1e0b6f[_0x4fbbfd(0x212)],'network':_0x1e0b6f['network'],'status':_0x1e0b6f[_0x4fbbfd(0x24c)],'txid':_0x1e0b6f[_0x4fbbfd(0x215)],'notes':_0x1e0b6f[_0x4fbbfd(0x23f)],'periodFrom':_0x1e0b6f[_0x4fbbfd(0x1eb)],'periodTo':_0x1e0b6f[_0x4fbbfd(0x1fe)],'createdAt':_0x1e0b6f[_0x4fbbfd(0x237)],'paidAt':_0x1e0b6f[_0x4fbbfd(0x1dc)]})),'pagination':{'page':_0x34bfc1,'limit':_0x333b87,'total':_0x40ce3c,'totalPages':Math[_0x4fbbfd(0x1aa)](_0x40ce3c/_0x333b87)}};}async[a33_0x1f23f3(0x1a8)](_0xbd117c){const _0x34d4df=a33_0x1f23f3,_0xcec8b8=await database_1[_0x34d4df(0x196)][_0x34d4df(0x1bc)]['findUnique']({'where':{'id':_0xbd117c},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0xcec8b8)return null;return{'id':_0xcec8b8['id'],'shopId':_0xcec8b8[_0x34d4df(0x1c5)],'shopName':_0xcec8b8['shop'][_0x34d4df(0x240)],'shopUsername':_0xcec8b8['shop']['username'],'amount':_0xcec8b8[_0x34d4df(0x212)],'network':_0xcec8b8['network'],'status':_0xcec8b8[_0x34d4df(0x24c)],'txid':_0xcec8b8[_0x34d4df(0x215)],'notes':_0xcec8b8['notes'],'periodFrom':_0xcec8b8[_0x34d4df(0x1eb)],'periodTo':_0xcec8b8[_0x34d4df(0x1fe)],'createdAt':_0xcec8b8['createdAt'],'paidAt':_0xcec8b8[_0x34d4df(0x1dc)]};}async[a33_0x1f23f3(0x1b8)](_0x325342){const _0x35f5d6=a33_0x1f23f3;await database_1['default'][_0x35f5d6(0x1bc)]['delete']({'where':{'id':_0x325342}});}async[a33_0x1f23f3(0x18d)](_0x99b65a){const _0x2b3b18=a33_0x1f23f3,{page:_0x5f0247,limit:_0x2eddbf,status:_0xf31660,gateway:_0x41ec14,shopId:_0x56df36,dateFrom:_0x59f6dd,dateTo:_0x26da90,search:_0x15ec51}=_0x99b65a,_0x3cfaa2=(_0x5f0247-0x1)*_0x2eddbf,_0x451684={};_0xf31660&&(_0x451684[_0x2b3b18(0x24c)]=_0xf31660[_0x2b3b18(0x1c8)]());_0x41ec14&&(_0x451684[_0x2b3b18(0x1a5)]=_0x41ec14[_0x2b3b18(0x1d7)]());_0x56df36&&(_0x451684[_0x2b3b18(0x1c5)]=_0x56df36);(_0x59f6dd||_0x26da90)&&(_0x451684[_0x2b3b18(0x237)]={},_0x59f6dd&&(_0x451684['createdAt'][_0x2b3b18(0x211)]=new Date(_0x59f6dd)),_0x26da90&&(_0x451684['createdAt'][_0x2b3b18(0x23e)]=new Date(_0x26da90)));_0x15ec51&&(_0x451684['OR']=[{'orderId':{'contains':_0x15ec51,'mode':_0x2b3b18(0x1fd)}},{'gatewayOrderId':{'contains':_0x15ec51,'mode':_0x2b3b18(0x1fd)}},{'customerEmail':{'contains':_0x15ec51,'mode':_0x2b3b18(0x1fd)}},{'shop':{'name':{'contains':_0x15ec51,'mode':_0x2b3b18(0x1fd)}}},{'shop':{'username':{'contains':_0x15ec51,'mode':'insensitive'}}}]);const [_0x4f847d,_0x3e583b]=await Promise[_0x2b3b18(0x1f1)]([database_1[_0x2b3b18(0x196)]['payment'][_0x2b3b18(0x209)]({'where':_0x451684,'skip':_0x3cfaa2,'take':_0x2eddbf,'orderBy':{'createdAt':_0x2b3b18(0x193)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x2b3b18(0x196)][_0x2b3b18(0x1c0)][_0x2b3b18(0x1a2)]({'where':_0x451684})]);return{'payments':_0x4f847d[_0x2b3b18(0x21a)](_0x177127=>({'id':_0x177127['id'],'shopId':_0x177127[_0x2b3b18(0x1c5)],'gateway':_0x177127['gateway'],'amount':_0x177127[_0x2b3b18(0x212)],'currency':_0x177127[_0x2b3b18(0x246)],'status':_0x177127['status'],'orderId':_0x177127[_0x2b3b18(0x191)],'gatewayOrderId':_0x177127[_0x2b3b18(0x229)],'customerEmail':_0x177127[_0x2b3b18(0x1b0)],'customerName':_0x177127[_0x2b3b18(0x20b)],'customerCountry':_0x177127[_0x2b3b18(0x22b)],'customerIp':_0x177127[_0x2b3b18(0x186)],'customerUa':_0x177127[_0x2b3b18(0x1e3)],'failureMessage':_0x177127[_0x2b3b18(0x219)],'createdAt':_0x177127[_0x2b3b18(0x237)],'updatedAt':_0x177127['updatedAt'],'shop':_0x177127[_0x2b3b18(0x1a1)]})),'pagination':{'page':_0x5f0247,'limit':_0x2eddbf,'total':_0x3e583b,'totalPages':Math['ceil'](_0x3e583b/_0x2eddbf)}};}async['getPaymentById'](_0x5e51e3){const _0x1bd6d1=a33_0x1f23f3,_0xfbbe53=await database_1[_0x1bd6d1(0x196)]['payment'][_0x1bd6d1(0x1cf)]({'where':{'id':_0x5e51e3},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0xfbbe53)return null;return{'id':_0xfbbe53['id'],'shopId':_0xfbbe53[_0x1bd6d1(0x1c5)],'gateway':_0xfbbe53[_0x1bd6d1(0x1a5)],'amount':_0xfbbe53[_0x1bd6d1(0x212)],'currency':_0xfbbe53[_0x1bd6d1(0x246)],'status':_0xfbbe53['status'],'orderId':_0xfbbe53['orderId'],'gatewayOrderId':_0xfbbe53[_0x1bd6d1(0x229)],'customerEmail':_0xfbbe53[_0x1bd6d1(0x1b0)],'customerName':_0xfbbe53[_0x1bd6d1(0x20b)],'customerCountry':_0xfbbe53[_0x1bd6d1(0x22b)],'customerIp':_0xfbbe53['customerIp'],'customerUa':_0xfbbe53['customerUa'],'failureMessage':_0xfbbe53[_0x1bd6d1(0x219)],'externalPaymentUrl':_0xfbbe53[_0x1bd6d1(0x1ed)],'successUrl':_0xfbbe53[_0x1bd6d1(0x1ef)],'failUrl':_0xfbbe53[_0x1bd6d1(0x1c3)],'pendingUrl':_0xfbbe53[_0x1bd6d1(0x1ff)],'whiteUrl':_0xfbbe53[_0x1bd6d1(0x23b)],'createdAt':_0xfbbe53[_0x1bd6d1(0x237)],'updatedAt':_0xfbbe53['updatedAt'],'shop':_0xfbbe53['shop']};}async['updatePaymentStatus'](_0x9285eb,_0x433d46,_0x49dc45,_0x2ef6de){const _0x52aed4=a33_0x1f23f3,_0x1f6445={'status':_0x433d46[_0x52aed4(0x1c8)](),'updatedAt':new Date(),'statusChangedBy':'admin','statusChangedAt':new Date()};_0x49dc45&&(_0x1f6445[_0x52aed4(0x185)]=_0x49dc45);_0x433d46['toUpperCase']()===_0x52aed4(0x1ab)&&_0x2ef6de&&(_0x1f6445[_0x52aed4(0x1ee)]=_0x2ef6de);_0x433d46[_0x52aed4(0x1c8)]()===_0x52aed4(0x245)&&(_0x1f6445[_0x52aed4(0x1dc)]=new Date());const _0x3ebc21=await database_1['default']['payment'][_0x52aed4(0x1f9)]({'where':{'id':_0x9285eb},'data':_0x1f6445,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return{'id':_0x3ebc21['id'],'shopId':_0x3ebc21[_0x52aed4(0x1c5)],'gateway':_0x3ebc21['gateway'],'amount':_0x3ebc21[_0x52aed4(0x212)],'currency':_0x3ebc21['currency'],'status':_0x3ebc21[_0x52aed4(0x24c)],'orderId':_0x3ebc21[_0x52aed4(0x191)],'gatewayOrderId':_0x3ebc21[_0x52aed4(0x229)],'customerEmail':_0x3ebc21[_0x52aed4(0x1b0)],'customerName':_0x3ebc21[_0x52aed4(0x20b)],'customerCountry':_0x3ebc21[_0x52aed4(0x22b)],'customerIp':_0x3ebc21[_0x52aed4(0x186)],'customerUa':_0x3ebc21[_0x52aed4(0x1e3)],'failureMessage':_0x3ebc21[_0x52aed4(0x219)],'adminNotes':_0x3ebc21[_0x52aed4(0x185)],'chargebackAmount':_0x3ebc21['chargebackAmount'],'statusChangedBy':_0x3ebc21[_0x52aed4(0x1dd)],'statusChangedAt':_0x3ebc21[_0x52aed4(0x201)],'createdAt':_0x3ebc21[_0x52aed4(0x237)],'updatedAt':_0x3ebc21[_0x52aed4(0x217)],'shop':_0x3ebc21[_0x52aed4(0x1a1)]};}async[a33_0x1f23f3(0x207)](_0x2abb5e,_0x25ba3e){const _0xad9737=a33_0x1f23f3,_0x29a873={..._0x25ba3e};_0x25ba3e[_0xad9737(0x21d)]&&(_0x29a873['password']=await bcryptjs_1[_0xad9737(0x196)][_0xad9737(0x1d8)](_0x25ba3e['password'],0xc));_0x25ba3e['fullName']&&(_0x29a873[_0xad9737(0x240)]=_0x25ba3e[_0xad9737(0x206)],delete _0x29a873[_0xad9737(0x206)]);_0x25ba3e[_0xad9737(0x184)]&&(_0x29a873['telegram']=_0x25ba3e['telegramId'],delete _0x29a873[_0xad9737(0x184)]);_0x25ba3e['merchantUrl']&&(_0x29a873[_0xad9737(0x20a)]=_0x25ba3e[_0xad9737(0x183)],delete _0x29a873['merchantUrl']);_0x25ba3e[_0xad9737(0x22a)]&&(_0x29a873[_0xad9737(0x20f)]=JSON[_0xad9737(0x1f7)](_0x25ba3e[_0xad9737(0x22a)]),delete _0x29a873[_0xad9737(0x22a)]);_0x25ba3e[_0xad9737(0x1c9)]&&(_0x29a873['gatewaySettings']=JSON[_0xad9737(0x1f7)](_0x25ba3e[_0xad9737(0x1c9)]),delete _0x29a873[_0xad9737(0x1c9)]);_0x25ba3e[_0xad9737(0x242)]&&(_0x25ba3e[_0xad9737(0x242)][_0xad9737(0x1e0)]!==undefined&&(_0x29a873[_0xad9737(0x1e0)]=_0x25ba3e[_0xad9737(0x242)][_0xad9737(0x1e0)]||null),_0x25ba3e['wallets'][_0xad9737(0x234)]!==undefined&&(_0x29a873[_0xad9737(0x234)]=_0x25ba3e[_0xad9737(0x242)]['usdtTrcWallet']||null),_0x25ba3e[_0xad9737(0x242)]['usdtErcWallet']!==undefined&&(_0x29a873['usdtErcWallet']=_0x25ba3e[_0xad9737(0x242)][_0xad9737(0x231)]||null),_0x25ba3e[_0xad9737(0x242)][_0xad9737(0x1e8)]!==undefined&&(_0x29a873['usdcPolygonWallet']=_0x25ba3e[_0xad9737(0x242)][_0xad9737(0x1e8)]||null),delete _0x29a873['wallets']);const _0x13408a=await database_1[_0xad9737(0x196)]['shop'][_0xad9737(0x1f9)]({'where':{'id':_0x2abb5e},'data':_0x29a873,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x13408a['id'],'fullName':_0x13408a[_0xad9737(0x240)],'username':_0x13408a[_0xad9737(0x1de)],'telegramId':_0x13408a['telegram'],'merchantUrl':_0x13408a[_0xad9737(0x20a)],'gateways':_0x13408a['paymentGateways']?JSON[_0xad9737(0x1ec)](_0x13408a[_0xad9737(0x20f)]):null,'gatewaySettings':_0x13408a[_0xad9737(0x1c9)]?JSON['parse'](_0x13408a[_0xad9737(0x1c9)]):null,'publicKey':_0x13408a[_0xad9737(0x187)],'wallets':{'usdtPolygonWallet':_0x13408a[_0xad9737(0x1e0)],'usdtTrcWallet':_0x13408a[_0xad9737(0x234)],'usdtErcWallet':_0x13408a[_0xad9737(0x231)],'usdcPolygonWallet':_0x13408a[_0xad9737(0x1e8)]},'status':_0x13408a[_0xad9737(0x24c)],'createdAt':_0x13408a[_0xad9737(0x237)]};}async[a33_0x1f23f3(0x19d)](_0xa6296f){const _0x5afac6=a33_0x1f23f3,_0x138035=await database_1[_0x5afac6(0x196)][_0x5afac6(0x1a1)][_0x5afac6(0x1f9)]({'where':{'id':_0xa6296f},'data':{'status':_0x5afac6(0x23a)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x138035['id'],'fullName':_0x138035[_0x5afac6(0x240)],'username':_0x138035[_0x5afac6(0x1de)],'telegramId':_0x138035[_0x5afac6(0x24a)],'merchantUrl':_0x138035[_0x5afac6(0x20a)],'gateways':_0x138035[_0x5afac6(0x20f)]?JSON['parse'](_0x138035['paymentGateways']):null,'gatewaySettings':_0x138035[_0x5afac6(0x1c9)]?JSON[_0x5afac6(0x1ec)](_0x138035['gatewaySettings']):null,'publicKey':_0x138035[_0x5afac6(0x187)],'wallets':{'usdtPolygonWallet':_0x138035['usdtPolygonWallet'],'usdtTrcWallet':_0x138035[_0x5afac6(0x234)],'usdtErcWallet':_0x138035[_0x5afac6(0x231)],'usdcPolygonWallet':_0x138035[_0x5afac6(0x1e8)]},'status':_0x138035['status'],'createdAt':_0x138035[_0x5afac6(0x237)]};}async[a33_0x1f23f3(0x1f3)](_0x2b7c9d){const _0x1998e8=a33_0x1f23f3,_0x3556ae=await database_1[_0x1998e8(0x196)][_0x1998e8(0x1a1)][_0x1998e8(0x1f9)]({'where':{'id':_0x2b7c9d},'data':{'status':_0x1998e8(0x1b3)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x3556ae['id'],'fullName':_0x3556ae[_0x1998e8(0x240)],'username':_0x3556ae[_0x1998e8(0x1de)],'telegramId':_0x3556ae[_0x1998e8(0x24a)],'merchantUrl':_0x3556ae['shopUrl'],'gateways':_0x3556ae['paymentGateways']?JSON['parse'](_0x3556ae[_0x1998e8(0x20f)]):null,'gatewaySettings':_0x3556ae['gatewaySettings']?JSON['parse'](_0x3556ae['gatewaySettings']):null,'publicKey':_0x3556ae[_0x1998e8(0x187)],'wallets':{'usdtPolygonWallet':_0x3556ae[_0x1998e8(0x1e0)],'usdtTrcWallet':_0x3556ae[_0x1998e8(0x234)],'usdtErcWallet':_0x3556ae[_0x1998e8(0x231)],'usdcPolygonWallet':_0x3556ae[_0x1998e8(0x1e8)]},'status':_0x3556ae[_0x1998e8(0x24c)],'createdAt':_0x3556ae[_0x1998e8(0x237)]};}async[a33_0x1f23f3(0x19e)](_0x1a888e){const _0x5b37b8=a33_0x1f23f3,{page:_0x2071df,limit:_0x4e00a3,status:_0x46212d}=_0x1a888e,_0x2338c4=(_0x2071df-0x1)*_0x4e00a3,_0x3c0dcc={};_0x46212d&&(_0x3c0dcc[_0x5b37b8(0x24c)]=_0x46212d[_0x5b37b8(0x1c8)]());const [_0xca5c7e,_0x2c9a78]=await Promise[_0x5b37b8(0x1f1)]([database_1[_0x5b37b8(0x196)][_0x5b37b8(0x1a1)]['findMany']({'where':_0x3c0dcc,'skip':_0x2338c4,'take':_0x4e00a3,'orderBy':{'createdAt':_0x5b37b8(0x193)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x5b37b8(0x196)]['shop'][_0x5b37b8(0x1a2)]({'where':_0x3c0dcc})]);return{'users':_0xca5c7e[_0x5b37b8(0x21a)](_0xd4a80b=>({'id':_0xd4a80b['id'],'fullName':_0xd4a80b[_0x5b37b8(0x240)],'username':_0xd4a80b['username'],'telegramId':_0xd4a80b[_0x5b37b8(0x24a)],'merchantUrl':_0xd4a80b['shopUrl'],'gateways':_0xd4a80b[_0x5b37b8(0x20f)]?JSON[_0x5b37b8(0x1ec)](_0xd4a80b[_0x5b37b8(0x20f)]):null,'gatewaySettings':_0xd4a80b['gatewaySettings']?JSON[_0x5b37b8(0x1ec)](_0xd4a80b[_0x5b37b8(0x1c9)]):null,'publicKey':_0xd4a80b[_0x5b37b8(0x187)],'wallets':{'usdtPolygonWallet':_0xd4a80b[_0x5b37b8(0x1e0)],'usdtTrcWallet':_0xd4a80b[_0x5b37b8(0x234)],'usdtErcWallet':_0xd4a80b['usdtErcWallet'],'usdcPolygonWallet':_0xd4a80b[_0x5b37b8(0x1e8)]},'status':_0xd4a80b['status'],'createdAt':_0xd4a80b['createdAt']})),'pagination':{'page':_0x2071df,'limit':_0x4e00a3,'total':_0x2c9a78,'totalPages':Math[_0x5b37b8(0x1aa)](_0x2c9a78/_0x4e00a3)}};}async[a33_0x1f23f3(0x208)](_0x3fe8ac){const _0x4b04af=a33_0x1f23f3,_0x105a0f=await database_1[_0x4b04af(0x196)][_0x4b04af(0x1a1)][_0x4b04af(0x1cf)]({'where':{'id':_0x3fe8ac},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x105a0f)return null;return{'id':_0x105a0f['id'],'fullName':_0x105a0f[_0x4b04af(0x240)],'username':_0x105a0f['username'],'telegramId':_0x105a0f[_0x4b04af(0x24a)],'merchantUrl':_0x105a0f[_0x4b04af(0x20a)],'gateways':_0x105a0f[_0x4b04af(0x20f)]?JSON[_0x4b04af(0x1ec)](_0x105a0f[_0x4b04af(0x20f)]):null,'gatewaySettings':_0x105a0f[_0x4b04af(0x1c9)]?JSON[_0x4b04af(0x1ec)](_0x105a0f['gatewaySettings']):null,'publicKey':_0x105a0f[_0x4b04af(0x187)],'wallets':{'usdtPolygonWallet':_0x105a0f[_0x4b04af(0x1e0)],'usdtTrcWallet':_0x105a0f['usdtTrcWallet'],'usdtErcWallet':_0x105a0f[_0x4b04af(0x231)],'usdcPolygonWallet':_0x105a0f[_0x4b04af(0x1e8)]},'status':_0x105a0f[_0x4b04af(0x24c)],'createdAt':_0x105a0f[_0x4b04af(0x237)]};}async['createUser'](_0x74f4d){const _0x2d8e0b=a33_0x1f23f3,{fullName:_0x3a7b3e,username:_0x55da97,password:_0x99c940,telegramId:_0x5898e7,merchantUrl:_0x30f3a3,gateways:_0x621ce,gatewaySettings:_0x434f81,wallets:_0x11dd2c}=_0x74f4d,_0x4ccf91=await database_1[_0x2d8e0b(0x196)]['shop']['findUnique']({'where':{'username':_0x55da97}});if(_0x4ccf91)throw new Error(_0x2d8e0b(0x199));if(_0x5898e7){const _0x1b467d=await database_1[_0x2d8e0b(0x196)][_0x2d8e0b(0x1a1)]['findUnique']({'where':{'telegram':_0x5898e7}});if(_0x1b467d)throw new Error(_0x2d8e0b(0x1a0));}const _0x2e7a1c=await bcryptjs_1['default'][_0x2d8e0b(0x1d8)](_0x99c940,0xc),_0x46f989='pk_'+crypto_1[_0x2d8e0b(0x196)][_0x2d8e0b(0x22c)](0x20)[_0x2d8e0b(0x1d4)](_0x2d8e0b(0x20c)),_0x3042f3='sk_'+crypto_1['default'][_0x2d8e0b(0x22c)](0x20)[_0x2d8e0b(0x1d4)](_0x2d8e0b(0x20c)),_0x5b1d9f=await database_1[_0x2d8e0b(0x196)][_0x2d8e0b(0x1a1)]['create']({'data':{'name':_0x3a7b3e,'username':_0x55da97,'password':_0x2e7a1c,'telegram':_0x5898e7,'shopUrl':_0x30f3a3,'paymentGateways':_0x621ce?JSON['stringify'](_0x621ce):null,'gatewaySettings':_0x434f81?JSON['stringify'](_0x434f81):null,'usdtPolygonWallet':_0x11dd2c?.[_0x2d8e0b(0x1e0)]||null,'usdtTrcWallet':_0x11dd2c?.[_0x2d8e0b(0x234)]||null,'usdtErcWallet':_0x11dd2c?.[_0x2d8e0b(0x231)]||null,'usdcPolygonWallet':_0x11dd2c?.[_0x2d8e0b(0x1e8)]||null,'publicKey':_0x46f989,'secretKey':_0x3042f3,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x5b1d9f['id'],'fullName':_0x5b1d9f['name'],'username':_0x5b1d9f[_0x2d8e0b(0x1de)],'telegramId':_0x5b1d9f[_0x2d8e0b(0x24a)],'merchantUrl':_0x5b1d9f['shopUrl'],'gateways':_0x5b1d9f[_0x2d8e0b(0x20f)]?JSON[_0x2d8e0b(0x1ec)](_0x5b1d9f[_0x2d8e0b(0x20f)]):null,'gatewaySettings':_0x5b1d9f[_0x2d8e0b(0x1c9)]?JSON[_0x2d8e0b(0x1ec)](_0x5b1d9f[_0x2d8e0b(0x1c9)]):null,'publicKey':_0x5b1d9f[_0x2d8e0b(0x187)],'wallets':{'usdtPolygonWallet':_0x5b1d9f[_0x2d8e0b(0x1e0)],'usdtTrcWallet':_0x5b1d9f[_0x2d8e0b(0x234)],'usdtErcWallet':_0x5b1d9f[_0x2d8e0b(0x231)],'usdcPolygonWallet':_0x5b1d9f[_0x2d8e0b(0x1e8)]},'status':_0x5b1d9f[_0x2d8e0b(0x24c)],'createdAt':_0x5b1d9f[_0x2d8e0b(0x237)]};}async[a33_0x1f23f3(0x1f5)](_0x2c493d){await database_1['default']['shop']['delete']({'where':{'id':_0x2c493d}});}}function a33_0x2253(_0x3269a0,_0x46b321){const _0x10e589=a33_0x10e5();return a33_0x2253=function(_0x225326,_0x468f6c){_0x225326=_0x225326-0x180;let _0x5e97bb=_0x10e589[_0x225326];return _0x5e97bb;},a33_0x2253(_0x3269a0,_0x46b321);}exports[a33_0x1f23f3(0x190)]=AdminService;