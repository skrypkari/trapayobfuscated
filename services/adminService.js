'use strict';function a36_0x45e5(){const _0x236498=['create','\x20->\x20','💱\x20Currency\x20filter\x20applied:\x20',']\x20Updating\x20password\x20for\x20user\x20','name','KLYME\x20GB','findMany','\x20USDT\x20(total\x20paid\x20to\x20merchants)','includes','\x27\x20->\x20ID\x20\x27','\x20order','gateway','\x20\x20\x20💸\x20Total\x20payouts\x20(all\x20time):\x20','7224230YpSSZp','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','date','merchantEarningsUSDT','Username\x20already\x20exists','usdtErcWallet','45EmeJdJ',',\x20Commission:\x20','\x20\x20\x20🖥️\x20User\x20Agent:\x20','Plisio','Open\x20Banking\x202','hex','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','lte','customerIp','💸\x20CHARGEBACK:\x20Merchant\x20amount\x20already\x20deducted\x20from\x20balance',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','📊\x20Getting\x20payments\x20with\x20filters:','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','join','AdminService','💰\x20Found\x20','\x20USDT\x20(theoretical\x20net)','year','periodTo','\x20status:\x20','\x20USDT\x20(after\x20payouts)','💰\x20Payment\x20','externalPaymentUrl','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','asc','getAllPayments','getGatewayNameById','suspendUser','polygon_usdc','summary','usdcPolygonWallet','🎯\x20updateUser\x20called\x20with\x20ID:\x20','\x20USDT\x20(after\x20','toISOString','36PJdGsW','PENDING','\x27\x20(from\x20\x27','📊\x20Final\x20WHERE\x20conditions:','paymentsCount','klyme_gb','updatedAt','\x20\x20\x20Current\x20balance:\x20','toLowerCase','shopId',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','turnover','getGatewayDisplayName','PAID','🔍\x20Using\x20gateway\x20\x27','$transaction','gatewaySettings','day','\x20USDT\x20(','map','REFUND','getMerchantsAwaitingPayout','48064NeSlbA','📋\x20Getting\x20merchants\x20selection\x20list...','\x20\x20\x20📅\x20This\x20month:\x20','\x20USDT\x20for\x20payment\x20','revenue','../config/database','log','random','\x20to\x20','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','update','\x27\x20to\x20name\x20\x27','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','statusChangedAt','\x20balance\x20updated:','📊\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','dailyRevenue','getFullYear','getPaymentById','split','not\x20set','amountAfterGatewayCommissionUSDT','📊\x20Calculating\x20payout\x20statistics...','\x20merchants','paidAt','customerCountry','entries','toString','failureMessage','paidOutUSDT','dateFrom','✅\x20Using\x20gateway\x20filter:\x20\x27','klyme_eu','test_gateway','Error\x20processing\x20payment\x20','NONEXISTENT_GATEWAY_FILTER','\x20USDT\x20from\x20balance','⚠️\x20Gateway\x20\x27','set','length','some','notes','error','\x20\x20\x20💰\x20Total\x20payments\x20turnover:\x20','get','CHARGEBACK','awaitingPayout','amount','🔄\x20Admin\x20updating\x20payment\x20','localeCompare','\x20\x20\x20Merchant\x20loses:\x20','count','Insufficient\x20balance.\x20Available:\x20','default',']\x20Gateway\x20settings\x20JSON\x20string:','reduce','ACTIVE','_count','thisMonth','\x20for\x20shop\x20','hash','wallets','getAllUsers','failUrl','customerEmail','defineProperty','txid','insensitive','randomBytes','publicKey','telegramId','groupBy','🔧\x20[','\x20active\x20merchants\x20for\x20selection','\x20USDT\x20(actual\x20balances)','noda','activateUser','shop','mastercard','🎯\x20[','\x20USDT\x20(+','gatewayEarnings','updateCustomerData','\x20\x20\x20🔍\x20Calculated\x20after\x20commission:\x20','totalCommissionRate','Rapyd','amountAfterCommissionUSDT','chargebackAmount','\x20USDT,\x20Requested:\x20','all','📊\x20Available\x20gateways\x20in\x20database:','period','🔐\x20[','⚠️\x20Requested\x20gateway\x20\x27','\x20USDT)','Noda','telegram','SUSPENDED','totalAmountAfterCommissionUSDT','commissionUSDT','deletePayout','\x20\x20\x20�\x20Total\x20paid\x20out:\x20','merchantEarnings','\x20\x20\x20✅\x20Actual\x20available\x20balance:\x20','parse','customerName','getTime','currencyService','commission','💰\x20[PAYOUT]\x20Gateway\x20','totalTurnover','round','merchantUrl','Telegram\x20username\x20already\x20exists','_sum','\x20in\x20','🔄\x20Gateway\x20mapping\x20(create):','paymentGateways','createdAt','\x20USDT\x20(gross\x20revenue)','gatewayOrderId','deleteUser','password',':\x20commission\x20=\x20','custom','totalPayments','sort','666AjyXAN','\x20USDT\x20(with\x20commission\x20deducted)','crypto','dailyPayments','getAllPayouts','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','gateways','📊\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','rapyd','usdtPolygonWallet','\x20no\x20longer\x20PAID:','\x20\x20\x20💰\x20Total\x20payout:\x20','not\x20specified','\x20USDT','\x20\x20\x20📅\x20Total\x20payouts\x20(this\x20month):\x20','cointopay2','\x20USDT\x20(-','toFixed','amountUSDT','status','getGatewayInternalName','90d','stringify','📊\x20Payout\x20statistics\x20calculated:','⚠️\x20Payment\x20','\x20\x20\x20Payout\x20amount:\x20','getMonth','updatePaymentStatus','dateTo','__esModule','CoinToPay','\x20\x20\x20Transaction\x20hash:\x20','substr','\x20payments)','delete','createUser','Shop\x20not\x20found','totalPaidOut','week','%\x20commission)','findFirst','pendingPayout','values','\x20\x20\x20✅\x20Total\x20available\x20for\x20payout:\x20','🔄\x20Gateway\x20mapping\x20(get):','167188oCTKpj','\x20\x20\x20�📊\x20Total\x20payments:\x20','shopUrl','username','getPayoutStats','adminNotes','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','payout','getPayoutById','💰\x20Shop\x20','117570CdFMLX','%\x20from\x20','📊\x20Sorting\x20payments\x20by\x20','statusChangedBy','💳\x20Payout\x20wallet\x20for\x20','payment','orderId','Payment\x20not\x20found','forEach','\x20became\x20PAID:','pendingUrl','currency','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','pk_','KLYME\x20EU','📊\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','setHours','convertToUSDT','periodFrom','📊\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','trim','gte','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','balance','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','usdtTrcWallet','./currencyService','\x20\x20\x20💰\x20Total\x20turnover:\x20','\x20USDT\x20(same\x20as\x20awaiting)','getGatewayIdByName','💰\x20Creating\x20payout\x20for\x20shop\x20','turnoverUSDT','2020-01-01','generateDailyStatistics','📊\x20Merchant\x20statistics\x20calculated:','144180QKmAIf','network','🔄\x20Converted\x20gateway\x20ID\x20\x27','🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','\x20\x20\x20💳\x20Total\x20payments:\x20','averageCommissionRate','COMPLETED','averageCheckUSDT','push','ceil','findUnique','successUrl','\x20\x20\x20💵\x20Available\x20balance:\x20','💸\x20CHARGEBACK\x20penalty:\x20-','fullName',',\x20userId:\x20','customerUa','\x20\x20\x20Added\x20to\x20balance:\x20+','1249626ESTvax','cointopay','getMerchantStatistics','updateUser','__importDefault','\x20\x20\x20Full\x20amount:\x20','toUpperCase','aggregate','getSystemStatistics','\x20\x20\x20Merchant\x20gets:\x20','76601yLpCPn','desc','klyme_de'];a36_0x45e5=function(){return _0x236498;};return a36_0x45e5();}const a36_0x355f44=a36_0x1364;function a36_0x1364(_0x23e64e,_0x238dba){const _0x45e540=a36_0x45e5();return a36_0x1364=function(_0x136455,_0x2dd5d9){_0x136455=_0x136455-0x182;let _0x423dad=_0x45e540[_0x136455];return _0x423dad;},a36_0x1364(_0x23e64e,_0x238dba);}(function(_0x931cad,_0x2c32fa){const _0x325cc8=a36_0x1364,_0x2c8423=_0x931cad();while(!![]){try{const _0x47619d=-parseInt(_0x325cc8(0x1c6))/0x1+parseInt(_0x325cc8(0x1d0))/0x2+-parseInt(_0x325cc8(0x205))/0x3+-parseInt(_0x325cc8(0x1f3))/0x4*(parseInt(_0x325cc8(0x225))/0x5)+parseInt(_0x325cc8(0x247))/0x6*(-parseInt(_0x325cc8(0x20f))/0x7)+parseInt(_0x325cc8(0x25d))/0x8*(parseInt(_0x325cc8(0x199))/0x9)+parseInt(_0x325cc8(0x21f))/0xa;if(_0x47619d===_0x2c32fa)break;else _0x2c8423['push'](_0x2c8423['shift']());}catch(_0xcb8768){_0x2c8423['push'](_0x2c8423['shift']());}}}(a36_0x45e5,0x3d867));var __importDefault=this&&this[a36_0x355f44(0x209)]||function(_0x26d45e){const _0xe18aa0=a36_0x355f44;return _0x26d45e&&_0x26d45e[_0xe18aa0(0x1b6)]?_0x26d45e:{'default':_0x26d45e};};Object[a36_0x355f44(0x29e)](exports,a36_0x355f44(0x1b6),{'value':!![]}),exports[a36_0x355f44(0x233)]=void 0x0;const database_1=__importDefault(require(a36_0x355f44(0x262))),bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a36_0x355f44(0x19b))),currencyService_1=require(a36_0x355f44(0x1ea)),gateway_1=require('../types/gateway');class AdminService{async[a36_0x355f44(0x1ca)](){const _0x2bb7ef=a36_0x355f44;console[_0x2bb7ef(0x263)](_0x2bb7ef(0x273));const _0x181510=await database_1[_0x2bb7ef(0x292)][_0x2bb7ef(0x2aa)][_0x2bb7ef(0x20c)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x2bb7ef(0x295)}}),_0x17bf90=await this[_0x2bb7ef(0x25c)]({'page':0x1,'limit':0x3e8}),_0xf8a28d=await database_1[_0x2bb7ef(0x292)][_0x2bb7ef(0x1d5)][_0x2bb7ef(0x290)]({'where':{'status':'PAID','gateway':{'not':_0x2bb7ef(0x27e)}}}),_0x17d96e=new Date(),_0x55bc0e=new Date(_0x17d96e['getFullYear'](),_0x17d96e[_0x2bb7ef(0x1b3)](),0x1),_0x4c637a=new Date(_0x17d96e[_0x2bb7ef(0x26e)](),_0x17d96e[_0x2bb7ef(0x1b3)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x3e6ba3=await database_1[_0x2bb7ef(0x292)][_0x2bb7ef(0x1cd)][_0x2bb7ef(0x20c)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x55bc0e,'lte':_0x4c637a},'status':'COMPLETED'}}),_0x2a234b=_0x181510[_0x2bb7ef(0x18c)][_0x2bb7ef(0x1be)]||0x0,_0x162ac2=_0x17bf90[_0x2bb7ef(0x242)][_0x2bb7ef(0x2bf)],_0x5b606d=_0x3e6ba3[_0x2bb7ef(0x18c)][_0x2bb7ef(0x28c)]||0x0,_0x5d6a34={'totalPayout':Math['round'](_0x2a234b*0x64)/0x64,'awaitingPayout':Math['round'](_0x162ac2*0x64)/0x64,'thisMonth':Math[_0x2bb7ef(0x189)](_0x5b606d*0x64)/0x64,'availableBalance':Math[_0x2bb7ef(0x189)](_0x162ac2*0x64)/0x64,'totalPayments':_0xf8a28d};return console[_0x2bb7ef(0x263)](_0x2bb7ef(0x1b0)),console[_0x2bb7ef(0x263)](_0x2bb7ef(0x1a4)+_0x5d6a34['totalPayout']+_0x2bb7ef(0x219)),console[_0x2bb7ef(0x263)](_0x2bb7ef(0x22b)+_0x5d6a34[_0x2bb7ef(0x28b)]+_0x2bb7ef(0x19a)),console[_0x2bb7ef(0x263)](_0x2bb7ef(0x1ff)+_0x5d6a34['availableBalance']+_0x2bb7ef(0x1ec)),console['log'](_0x2bb7ef(0x25f)+_0x5d6a34[_0x2bb7ef(0x297)]+_0x2bb7ef(0x1a6)),console[_0x2bb7ef(0x263)](_0x2bb7ef(0x1f7)+_0x5d6a34[_0x2bb7ef(0x197)]+'\x20PAID\x20payments'),console['log']('\x20\x20\x20🔍\x20Raw\x20balance\x20sum:\x20'+(_0x181510[_0x2bb7ef(0x18c)][_0x2bb7ef(0x1e7)]||0x0)[_0x2bb7ef(0x1aa)](0x2)+'\x20USDT\x20(without\x20commission)'),console[_0x2bb7ef(0x263)]('\x20\x20\x20📊\x20Commission\x20difference:\x20'+((_0x181510[_0x2bb7ef(0x18c)][_0x2bb7ef(0x1e7)]||0x0)-_0x162ac2)['toFixed'](0x2)+_0x2bb7ef(0x1a6)),_0x5d6a34;}async[a36_0x355f44(0x2af)](_0x4f0d5d,_0x1745cd){const _0x3c661c=a36_0x355f44;console[_0x3c661c(0x263)](_0x3c661c(0x269)+_0x4f0d5d+':',_0x1745cd);const _0x4fdcf5=await database_1[_0x3c661c(0x292)][_0x3c661c(0x1d5)]['findUnique']({'where':{'id':_0x4f0d5d},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x4fdcf5)throw new Error(_0x3c661c(0x1d7));const _0x46a7ae={};_0x1745cd[_0x3c661c(0x276)]!==undefined&&(_0x46a7ae[_0x3c661c(0x276)]=_0x1745cd[_0x3c661c(0x276)]||null);_0x1745cd[_0x3c661c(0x22d)]!==undefined&&(_0x46a7ae[_0x3c661c(0x22d)]=_0x1745cd[_0x3c661c(0x22d)]||null);_0x1745cd[_0x3c661c(0x203)]!==undefined&&(_0x46a7ae[_0x3c661c(0x203)]=_0x1745cd[_0x3c661c(0x203)]||null);const _0x4d62e0=await database_1[_0x3c661c(0x292)][_0x3c661c(0x1d5)]['update']({'where':{'id':_0x4f0d5d},'data':{..._0x46a7ae,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x3c661c(0x263)](_0x3c661c(0x1e8)+_0x4f0d5d),console[_0x3c661c(0x263)]('\x20\x20\x20🌍\x20Country:\x20'+_0x4fdcf5[_0x3c661c(0x276)]+_0x3c661c(0x213)+_0x4d62e0[_0x3c661c(0x276)]),console[_0x3c661c(0x263)]('\x20\x20\x20🌐\x20IP:\x20'+_0x4fdcf5['customerIp']+_0x3c661c(0x213)+_0x4d62e0[_0x3c661c(0x22d)]),console[_0x3c661c(0x263)](_0x3c661c(0x227)+(_0x4fdcf5['customerUa']?'set':'not\x20set')+_0x3c661c(0x213)+(_0x4d62e0['customerUa']?_0x3c661c(0x283):_0x3c661c(0x271))),_0x4d62e0;}async[a36_0x355f44(0x20d)](_0x31ea50){const _0x4b0435=a36_0x355f44,_0x1f64ed=new Date();let _0x235cce;switch(_0x31ea50['toLowerCase']()){case _0x4b0435(0x258):case'DAY':_0x235cce=new Date(_0x1f64ed[_0x4b0435(0x26e)](),_0x1f64ed[_0x4b0435(0x1b3)](),_0x1f64ed['getDate'](),0x0,0x0,0x0,0x0);break;case'7d':_0x235cce=new Date(_0x1f64ed[_0x4b0435(0x184)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x235cce=new Date(_0x1f64ed['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x4b0435(0x1ae):_0x235cce=new Date(_0x1f64ed[_0x4b0435(0x184)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case'all':const _0xd7c59d=await database_1[_0x4b0435(0x292)][_0x4b0435(0x1d5)][_0x4b0435(0x1c1)]({'where':{'gateway':{'not':_0x4b0435(0x27e)}},'orderBy':{'createdAt':'asc'},'select':{'createdAt':!![]}});_0x235cce=_0xd7c59d?_0xd7c59d['createdAt']:new Date(_0x4b0435(0x1f0));break;default:_0x235cce=new Date(_0x1f64ed['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}_0x235cce[_0x4b0435(0x1e0)](0x0,0x0,0x0,0x0);const [_0x53d158,_0xe68abf,_0x2ba30b,_0x51c4a7,_0x8e958c,_0x3174ba]=await Promise['all']([database_1['default'][_0x4b0435(0x2aa)][_0x4b0435(0x290)](),database_1[_0x4b0435(0x292)][_0x4b0435(0x2aa)][_0x4b0435(0x290)]({'where':{'status':_0x4b0435(0x295)}}),database_1[_0x4b0435(0x292)]['payment'][_0x4b0435(0x290)]({'where':{'status':_0x4b0435(0x254),'createdAt':{'gte':_0x235cce},'gateway':{'not':_0x4b0435(0x27e)}}}),database_1[_0x4b0435(0x292)]['payment'][_0x4b0435(0x218)]({'where':{'status':_0x4b0435(0x254),'createdAt':{'gte':_0x235cce},'gateway':{'not':_0x4b0435(0x27e)}},'select':{'amount':!![],'currency':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x4b0435(0x292)][_0x4b0435(0x1d5)][_0x4b0435(0x218)]({'where':{'gateway':{'not':_0x4b0435(0x27e)}},'take':0xa,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x4b0435(0x292)][_0x4b0435(0x1d5)][_0x4b0435(0x218)]({'where':{'createdAt':{'gte':_0x235cce},'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x5eb85c=0x0,_0x43b6d9=0x0;for(const _0x275a5b of _0x51c4a7){const _0x4e73f5=await currencyService_1[_0x4b0435(0x185)][_0x4b0435(0x1e1)](_0x275a5b[_0x4b0435(0x28c)],_0x275a5b[_0x4b0435(0x1db)]);_0x5eb85c+=_0x4e73f5;if(_0x275a5b[_0x4b0435(0x272)]){const _0x82ac0f=await currencyService_1[_0x4b0435(0x185)][_0x4b0435(0x1e1)](_0x275a5b[_0x4b0435(0x28c)],_0x275a5b[_0x4b0435(0x1db)]),_0x5b2d98=_0x275a5b['amountAfterGatewayCommissionUSDT'],_0x1b7238=_0x82ac0f-_0x5b2d98;_0x43b6d9+=_0x1b7238;}}const _0x11d512=_0x2ba30b>0x0?_0x5eb85c/_0x2ba30b:0x0,_0x3f7113=this[_0x4b0435(0x1f1)](_0x3174ba,_0x235cce,_0x1f64ed),_0x3d5772=await database_1[_0x4b0435(0x292)][_0x4b0435(0x1d5)][_0x4b0435(0x290)]({'where':{'createdAt':{'gte':_0x235cce},'gateway':{'not':_0x4b0435(0x27e)}}}),_0xb9b402=_0x3d5772>0x0?_0x2ba30b/_0x3d5772*0x64:0x0;return{'totalShops':_0x53d158,'activeShops':_0xe68abf,'totalPayments':_0x2ba30b,'successfulPayments':_0x2ba30b,'totalAttempts':_0x3d5772,'totalRevenue':Math['round'](_0x5eb85c*0x64)/0x64,'trapayEarnings':Math[_0x4b0435(0x189)](_0x43b6d9*0x64)/0x64,'averagePaymentAmount':Math[_0x4b0435(0x189)](_0x11d512*0x64)/0x64,'conversionRate':Math[_0x4b0435(0x189)](_0xb9b402*0x64)/0x64,'dailyRevenue':_0x3f7113[_0x4b0435(0x26d)],'dailyPayments':_0x3f7113[_0x4b0435(0x19c)],'recentPayments':_0x8e958c[_0x4b0435(0x25a)](_0x3ce996=>({'id':_0x3ce996['id'],'amount':_0x3ce996[_0x4b0435(0x28c)],'currency':_0x3ce996[_0x4b0435(0x1db)],'status':_0x3ce996[_0x4b0435(0x1ac)],'gateway':_0x3ce996[_0x4b0435(0x21d)],'shop':_0x3ce996[_0x4b0435(0x2aa)],'createdAt':_0x3ce996[_0x4b0435(0x190)]}))};}async[a36_0x355f44(0x207)](_0x4fa0fb){const _0x5e8fcc=a36_0x355f44;console[_0x5e8fcc(0x263)](_0x5e8fcc(0x1cc),_0x4fa0fb);let _0x3c5357,_0x3e4c38=new Date();if(_0x4fa0fb[_0x5e8fcc(0x2b8)]===_0x5e8fcc(0x196)&&_0x4fa0fb[_0x5e8fcc(0x27b)]&&_0x4fa0fb[_0x5e8fcc(0x1b5)])_0x3c5357=new Date(_0x4fa0fb[_0x5e8fcc(0x27b)]),_0x3e4c38=new Date(_0x4fa0fb['dateTo']),_0x3c5357['setHours'](0x0,0x0,0x0,0x0),_0x3e4c38[_0x5e8fcc(0x1e0)](0x17,0x3b,0x3b,0x3e7);else{const _0x4e82c4=new Date();switch(_0x4fa0fb[_0x5e8fcc(0x2b8)]){case _0x5e8fcc(0x1bf):_0x3c5357=new Date(_0x4e82c4[_0x5e8fcc(0x184)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'month':_0x3c5357=new Date(_0x4e82c4['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x5e8fcc(0x236):_0x3c5357=new Date(_0x4e82c4['getTime']()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x5e8fcc(0x2b6):default:_0x3c5357=new Date(_0x5e8fcc(0x1f0));break;}_0x3c5357[_0x5e8fcc(0x1e0)](0x0,0x0,0x0,0x0),_0x3e4c38[_0x5e8fcc(0x1e0)](0x17,0x3b,0x3b,0x3e7);}console[_0x5e8fcc(0x263)]('📅\x20Period:\x20'+_0x3c5357[_0x5e8fcc(0x246)]()+_0x5e8fcc(0x265)+_0x3e4c38['toISOString']());const _0x2c589a={'status':_0x5e8fcc(0x254),'gateway':{'not':_0x5e8fcc(0x27e)},'paidAt':{'gte':_0x3c5357,'lte':_0x3e4c38}};_0x4fa0fb[_0x5e8fcc(0x250)]&&(_0x2c589a['shopId']=_0x4fa0fb['shopId']);const _0x15bb5d=await database_1['default'][_0x5e8fcc(0x1d5)]['findMany']({'where':_0x2c589a,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x5e8fcc(0x263)](_0x5e8fcc(0x234)+_0x15bb5d[_0x5e8fcc(0x284)]+'\x20paid\x20payments\x20for\x20analysis');const _0x140d31={'gateway':{'not':'test_gateway'},'createdAt':{'gte':_0x3c5357,'lte':_0x3e4c38}};_0x4fa0fb[_0x5e8fcc(0x250)]&&(_0x140d31[_0x5e8fcc(0x250)]=_0x4fa0fb[_0x5e8fcc(0x250)]);const _0x58b9b6=await database_1[_0x5e8fcc(0x292)][_0x5e8fcc(0x1d5)][_0x5e8fcc(0x290)]({'where':_0x140d31});console['log']('📊\x20Total\x20payments\x20(including\x20failed):\x20'+_0x58b9b6+',\x20successful:\x20'+_0x15bb5d[_0x5e8fcc(0x284)]);let _0x3ccb76=0x0,_0x577195=0x0,_0x5db60a=0x0;const _0x4a369={},_0x1b4812={},_0x52eb16={};for(const _0x3fdfac of _0x15bb5d){try{const _0x3e7f69=await currencyService_1[_0x5e8fcc(0x185)]['convertToUSDT'](_0x3fdfac['amount'],_0x3fdfac['currency']);let _0x3f9a0a={};if(_0x3fdfac[_0x5e8fcc(0x2aa)]['gatewaySettings'])try{_0x3f9a0a=JSON[_0x5e8fcc(0x182)](_0x3fdfac[_0x5e8fcc(0x2aa)][_0x5e8fcc(0x257)]);}catch(_0x35b5bd){console[_0x5e8fcc(0x287)](_0x5e8fcc(0x23c)+_0x3fdfac[_0x5e8fcc(0x250)]+':',_0x35b5bd);}let _0x1b9ebf={},_0x44d32f=0xa;for(const [_0x437477,_0x46ff6d]of Object[_0x5e8fcc(0x277)](_0x3f9a0a)){if(_0x437477[_0x5e8fcc(0x24f)]()===_0x3fdfac['gateway']['toLowerCase']()){_0x1b9ebf=_0x46ff6d,_0x44d32f=_0x46ff6d['commission']||0xa;break;}}let _0x44cec5,_0x1833b2;_0x3fdfac[_0x5e8fcc(0x272)]!==null&&_0x3fdfac[_0x5e8fcc(0x272)]!==undefined?(_0x44cec5=_0x3fdfac[_0x5e8fcc(0x272)],_0x1833b2=_0x3e7f69-_0x44cec5,console['log'](_0x5e8fcc(0x26c)+_0x44cec5[_0x5e8fcc(0x1aa)](0x6)+_0x5e8fcc(0x260)+_0x3fdfac['id'])):(_0x1833b2=_0x3e7f69*(_0x44d32f/0x64),_0x44cec5=_0x3e7f69-_0x1833b2,console[_0x5e8fcc(0x263)](_0x5e8fcc(0x1df)+_0x3fdfac['id']+':\x20'+_0x44d32f+_0x5e8fcc(0x1d1)+_0x3e7f69[_0x5e8fcc(0x1aa)](0x6)+_0x5e8fcc(0x1a6)));_0x3ccb76+=_0x3e7f69,_0x577195+=_0x44cec5,_0x5db60a+=_0x1833b2;!_0x4a369[_0x3fdfac[_0x5e8fcc(0x21d)]]&&(_0x4a369[_0x3fdfac[_0x5e8fcc(0x21d)]]={'gateway':_0x3fdfac['gateway'],'gatewayDisplayName':this[_0x5e8fcc(0x253)](_0x3fdfac[_0x5e8fcc(0x21d)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x4a369[_0x3fdfac[_0x5e8fcc(0x21d)]]['paymentsCount']++,_0x4a369[_0x3fdfac['gateway']]['turnoverUSDT']+=_0x3e7f69,_0x4a369[_0x3fdfac['gateway']]['commissionUSDT']+=_0x1833b2,_0x4a369[_0x3fdfac['gateway']][_0x5e8fcc(0x222)]+=_0x44cec5,_0x4a369[_0x3fdfac['gateway']][_0x5e8fcc(0x2b1)]+=_0x44d32f;!_0x4fa0fb[_0x5e8fcc(0x250)]&&(!_0x1b4812[_0x3fdfac[_0x5e8fcc(0x250)]]&&(_0x1b4812[_0x3fdfac[_0x5e8fcc(0x250)]]={'shopId':_0x3fdfac[_0x5e8fcc(0x250)],'shopName':_0x3fdfac[_0x5e8fcc(0x2aa)][_0x5e8fcc(0x216)],'shopUsername':_0x3fdfac['shop'][_0x5e8fcc(0x1c9)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x1b4812[_0x3fdfac[_0x5e8fcc(0x250)]][_0x5e8fcc(0x24b)]++,_0x1b4812[_0x3fdfac[_0x5e8fcc(0x250)]][_0x5e8fcc(0x1ef)]+=_0x3e7f69,_0x1b4812[_0x3fdfac[_0x5e8fcc(0x250)]][_0x5e8fcc(0x2c0)]+=_0x1833b2,_0x1b4812[_0x3fdfac[_0x5e8fcc(0x250)]][_0x5e8fcc(0x222)]+=_0x44cec5);const _0x30527a=_0x3fdfac[_0x5e8fcc(0x275)][_0x5e8fcc(0x246)]()[_0x5e8fcc(0x270)]('T')[0x0];!_0x52eb16[_0x30527a]&&(_0x52eb16[_0x30527a]={'date':_0x30527a,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x52eb16[_0x30527a][_0x5e8fcc(0x252)]+=_0x3e7f69,_0x52eb16[_0x30527a]['merchantEarnings']+=_0x44cec5,_0x52eb16[_0x30527a][_0x5e8fcc(0x2ae)]+=_0x1833b2,_0x52eb16[_0x30527a][_0x5e8fcc(0x24b)]++;}catch(_0x3d8c26){console['error'](_0x5e8fcc(0x27f)+_0x3fdfac['id']+':',_0x3d8c26);}}Object['values'](_0x4a369)[_0x5e8fcc(0x1d8)](_0xe58923=>{const _0x37602d=_0x5e8fcc;_0xe58923[_0x37602d(0x1f8)]=_0xe58923[_0x37602d(0x24b)]>0x0?_0xe58923['totalCommissionRate']/_0xe58923[_0x37602d(0x24b)]:0x0,delete _0xe58923[_0x37602d(0x2b1)];}),Object[_0x5e8fcc(0x1c3)](_0x1b4812)[_0x5e8fcc(0x1d8)](_0x1e86e2=>{const _0x1cab5f=_0x5e8fcc;_0x1e86e2[_0x1cab5f(0x1fa)]=_0x1e86e2[_0x1cab5f(0x24b)]>0x0?_0x1e86e2[_0x1cab5f(0x1ef)]/_0x1e86e2[_0x1cab5f(0x24b)]:0x0;});let _0x3d6296=0x0,_0x1ff9ee=0x0;if(_0x4fa0fb[_0x5e8fcc(0x250)]){const _0x3dd57f=await database_1[_0x5e8fcc(0x292)][_0x5e8fcc(0x1cd)][_0x5e8fcc(0x218)]({'where':{'shopId':_0x4fa0fb['shopId'],'status':_0x5e8fcc(0x1f9),'createdAt':{'gte':_0x3c5357,'lte':_0x3e4c38}},'select':{'amount':!![]}});_0x3d6296=_0x3dd57f[_0x5e8fcc(0x294)]((_0x147b91,_0x5d2192)=>_0x147b91+_0x5d2192[_0x5e8fcc(0x28c)],0x0);const _0x4dc2a6=await database_1[_0x5e8fcc(0x292)][_0x5e8fcc(0x1cd)][_0x5e8fcc(0x218)]({'where':{'shopId':_0x4fa0fb[_0x5e8fcc(0x250)],'status':_0x5e8fcc(0x248),'createdAt':{'gte':_0x3c5357,'lte':_0x3e4c38}},'select':{'amount':!![]}});_0x1ff9ee=_0x4dc2a6[_0x5e8fcc(0x294)]((_0x5b0f90,_0x4ed575)=>_0x5b0f90+_0x4ed575['amount'],0x0);}const _0x42d9d0=_0x58b9b6,_0x2d49d7=_0x15bb5d[_0x5e8fcc(0x284)],_0x5a6f0c=_0x2d49d7>0x0?_0x3ccb76/_0x2d49d7:0x0,_0x4830d7=_0x42d9d0>0x0?Math['round'](_0x2d49d7/_0x42d9d0*0x2710)/0x64:0x0,_0x1f92aa=Math[_0x5e8fcc(0x1fc)]((_0x3e4c38[_0x5e8fcc(0x184)]()-_0x3c5357[_0x5e8fcc(0x184)]())/(0x3e8*0x3c*0x3c*0x18)),_0x400e90={'totalTurnover':Math[_0x5e8fcc(0x189)](_0x3ccb76*0x64)/0x64,'merchantEarnings':Math[_0x5e8fcc(0x189)](_0x577195*0x64)/0x64,'gatewayEarnings':Math[_0x5e8fcc(0x189)](_0x5db60a*0x64)/0x64,'totalPaidOut':Math['round'](_0x3d6296*0x64)/0x64,'pendingPayout':Math[_0x5e8fcc(0x189)](_0x1ff9ee*0x64)/0x64,'averageCheck':Math[_0x5e8fcc(0x189)](_0x5a6f0c*0x64)/0x64,'totalPayments':_0x42d9d0,'successfulPayments':_0x2d49d7,'conversionRate':_0x4830d7,'gatewayBreakdown':Object[_0x5e8fcc(0x1c3)](_0x4a369)[_0x5e8fcc(0x25a)](_0x3f3802=>({..._0x3f3802,'turnoverUSDT':Math['round'](_0x3f3802[_0x5e8fcc(0x1ef)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x3f3802[_0x5e8fcc(0x2c0)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x5e8fcc(0x189)](_0x3f3802[_0x5e8fcc(0x222)]*0x64)/0x64,'averageCommissionRate':Math[_0x5e8fcc(0x189)](_0x3f3802['averageCommissionRate']*0x64)/0x64})),'merchantBreakdown':_0x4fa0fb['shopId']?undefined:Object[_0x5e8fcc(0x1c3)](_0x1b4812)[_0x5e8fcc(0x25a)](_0x614180=>({..._0x614180,'turnoverUSDT':Math[_0x5e8fcc(0x189)](_0x614180[_0x5e8fcc(0x1ef)]*0x64)/0x64,'commissionUSDT':Math[_0x5e8fcc(0x189)](_0x614180[_0x5e8fcc(0x2c0)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x614180[_0x5e8fcc(0x222)]*0x64)/0x64,'paidOutUSDT':Math['round'](_0x614180[_0x5e8fcc(0x27a)]*0x64)/0x64,'averageCheckUSDT':Math[_0x5e8fcc(0x189)](_0x614180[_0x5e8fcc(0x1fa)]*0x64)/0x64})),'dailyData':Object['values'](_0x52eb16)['map'](_0x12e32e=>({..._0x12e32e,'turnover':Math[_0x5e8fcc(0x189)](_0x12e32e[_0x5e8fcc(0x252)]*0x64)/0x64,'merchantEarnings':Math[_0x5e8fcc(0x189)](_0x12e32e['merchantEarnings']*0x64)/0x64,'gatewayEarnings':Math['round'](_0x12e32e[_0x5e8fcc(0x2ae)]*0x64)/0x64}))[_0x5e8fcc(0x198)]((_0x116a1d,_0x317a7f)=>_0x116a1d[_0x5e8fcc(0x221)][_0x5e8fcc(0x28e)](_0x317a7f[_0x5e8fcc(0x221)])),'periodInfo':{'from':_0x3c5357,'to':_0x3e4c38,'periodType':_0x4fa0fb[_0x5e8fcc(0x2b8)]||_0x5e8fcc(0x196),'daysCount':_0x1f92aa}};return console['log'](_0x5e8fcc(0x1f2)),console[_0x5e8fcc(0x263)](_0x5e8fcc(0x1eb)+_0x400e90[_0x5e8fcc(0x188)]+_0x5e8fcc(0x1a6)),console[_0x5e8fcc(0x263)]('\x20\x20\x20👤\x20Merchant\x20earnings:\x20'+_0x400e90[_0x5e8fcc(0x2c3)]+_0x5e8fcc(0x1a6)),console[_0x5e8fcc(0x263)](_0x5e8fcc(0x231)+_0x400e90[_0x5e8fcc(0x2ae)]+_0x5e8fcc(0x1a6)),console[_0x5e8fcc(0x263)](_0x5e8fcc(0x2c2)+_0x400e90[_0x5e8fcc(0x1be)]+_0x5e8fcc(0x1a6)),console[_0x5e8fcc(0x263)]('\x20\x20\x20⏳\x20Pending\x20payout:\x20'+_0x400e90[_0x5e8fcc(0x1c2)]+_0x5e8fcc(0x1a6)),console[_0x5e8fcc(0x263)](_0x5e8fcc(0x1c7)+_0x400e90['totalPayments']),_0x400e90;}async['getMerchantsSelection'](){const _0x163148=a36_0x355f44;console[_0x163148(0x263)](_0x163148(0x25e));const _0x543f07=await database_1['default'][_0x163148(0x2aa)][_0x163148(0x218)]({'where':{'status':_0x163148(0x295)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x163148(0x23d)}});return console[_0x163148(0x263)]('📋\x20Found\x20'+_0x543f07[_0x163148(0x284)]+_0x163148(0x2a6)),_0x543f07[_0x163148(0x25a)](_0x2ab8c6=>({'id':_0x2ab8c6['id'],'username':_0x2ab8c6[_0x163148(0x1c9)],'name':_0x2ab8c6[_0x163148(0x216)]}));}[a36_0x355f44(0x253)](_0x2ee42e){const _0x3aa3d3=a36_0x355f44,_0xefe330={'test_gateway':'Test\x20Gateway','plisio':_0x3aa3d3(0x228),'rapyd':_0x3aa3d3(0x2b2),'noda':_0x3aa3d3(0x2bc),'cointopay':_0x3aa3d3(0x1b7),'cointopay2':_0x3aa3d3(0x229),'klyme_eu':_0x3aa3d3(0x1de),'klyme_gb':_0x3aa3d3(0x217),'klyme_de':'KLYME\x20DE','mastercard':'MasterCard'};return _0xefe330[_0x2ee42e]||_0x2ee42e;}[a36_0x355f44(0x1ad)](_0x2b750d){const _0x394692=a36_0x355f44,_0x47dfca={'Test\x20Gateway':_0x394692(0x27e),'Plisio':'plisio','Rapyd':_0x394692(0x1a1),'Noda':_0x394692(0x2a8),'CoinToPay':_0x394692(0x206),'CoinToPay2':_0x394692(0x1a8),'KLYME\x20EU':_0x394692(0x27d),'KLYME\x20GB':_0x394692(0x24c),'KLYME\x20DE':_0x394692(0x211),'MasterCard':_0x394692(0x2ab)};return _0x47dfca[_0x2b750d]||_0x2b750d[_0x394692(0x24f)]();}async[a36_0x355f44(0x25c)](_0x214faa){const _0x4b06f6=a36_0x355f44,{page:_0x41e66a,limit:_0x40be88,minAmount:_0x1ae31b,search:_0x18dd32}=_0x214faa,_0x140123=(_0x41e66a-0x1)*_0x40be88;console[_0x4b06f6(0x263)]('📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:',_0x214faa);const _0x283bee={'balance':{'gt':0x0},'status':'ACTIVE'};_0x1ae31b&&(_0x283bee['balance'][_0x4b06f6(0x1e5)]=_0x1ae31b);_0x18dd32&&(_0x283bee[_0x4b06f6(0x216)]={'contains':_0x18dd32,'mode':_0x4b06f6(0x2a0)});const [_0x371c26,_0x28a327]=await Promise['all']([database_1[_0x4b06f6(0x292)][_0x4b06f6(0x2aa)][_0x4b06f6(0x218)]({'where':_0x283bee,'skip':_0x140123,'take':_0x40be88,'orderBy':{'balance':_0x4b06f6(0x210)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1[_0x4b06f6(0x292)][_0x4b06f6(0x2aa)][_0x4b06f6(0x290)]({'where':_0x283bee})]);console['log']('💰\x20Found\x20'+_0x371c26[_0x4b06f6(0x284)]+'\x20merchants\x20with\x20positive\x20balance');const _0x2e26b5=await Promise['all'](_0x371c26[_0x4b06f6(0x25a)](async _0x51a6d0=>{const _0x1313b4=_0x4b06f6,[_0x596c1f,_0x46dceb,_0x488e03]=await Promise[_0x1313b4(0x2b6)]([database_1['default'][_0x1313b4(0x1d5)][_0x1313b4(0x290)]({'where':{'shopId':_0x51a6d0['id'],'status':_0x1313b4(0x254),'gateway':{'not':'test_gateway'}}}),database_1[_0x1313b4(0x292)][_0x1313b4(0x1d5)][_0x1313b4(0x1c1)]({'where':{'shopId':_0x51a6d0['id'],'status':'PAID','gateway':{'not':_0x1313b4(0x27e)}},'orderBy':{'paidAt':_0x1313b4(0x23d)},'select':{'paidAt':!![]}}),database_1[_0x1313b4(0x292)][_0x1313b4(0x1d5)][_0x1313b4(0x2a4)]({'by':['gateway'],'where':{'shopId':_0x51a6d0['id'],'status':_0x1313b4(0x254),'gateway':{'not':_0x1313b4(0x27e)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x5e26e1=new Date(),_0x471ca4=new Date(_0x5e26e1[_0x1313b4(0x26e)](),_0x5e26e1[_0x1313b4(0x1b3)](),0x1),_0x5a6987=new Date(_0x5e26e1[_0x1313b4(0x26e)](),_0x5e26e1[_0x1313b4(0x1b3)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x5532b4,_0xb83c53]=await Promise[_0x1313b4(0x2b6)]([database_1[_0x1313b4(0x292)][_0x1313b4(0x1cd)]['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x51a6d0['id'],'status':_0x1313b4(0x1f9)}}),database_1[_0x1313b4(0x292)][_0x1313b4(0x1cd)]['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x51a6d0['id'],'status':'COMPLETED','createdAt':{'gte':_0x471ca4,'lte':_0x5a6987}}})]),_0x699f4a=_0x5532b4['_sum'][_0x1313b4(0x28c)]||0x0,_0x23edf8=_0xb83c53[_0x1313b4(0x18c)]['amount']||0x0,_0x52c10a=await Promise['all'](_0x488e03[_0x1313b4(0x25a)](async _0x37c189=>{const _0x241515=_0x1313b4;let _0x214473=0xa;if(_0x51a6d0[_0x241515(0x257)])try{const _0x1efcfb=JSON[_0x241515(0x182)](_0x51a6d0['gatewaySettings']);for(const [_0x47a51d,_0x39e244]of Object[_0x241515(0x277)](_0x1efcfb)){if(_0x47a51d['toLowerCase']()===_0x37c189['gateway'][_0x241515(0x24f)]()){_0x214473=_0x39e244[_0x241515(0x186)]||0xa,console[_0x241515(0x263)](_0x241515(0x187)+_0x37c189[_0x241515(0x21d)]+_0x241515(0x298)+_0x51a6d0['id']+_0x241515(0x195)+_0x214473+'%');break;}}}catch(_0x11b757){console['error'](_0x241515(0x23c)+_0x51a6d0['id']+':',_0x11b757);}const _0x3391c8=_0x37c189[_0x241515(0x18c)]?.[_0x241515(0x1ab)]||0x0,_0x439887=_0x3391c8*(0x1-_0x214473/0x64);return{'gateway':_0x37c189[_0x241515(0x21d)],'count':_0x37c189[_0x241515(0x296)]?.['id']||0x0,'amountUSDT':Math['round'](_0x3391c8*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x241515(0x189)](_0x439887*0x64)/0x64,'commission':_0x214473};})),_0x4e6706=_0x52c10a[_0x1313b4(0x294)]((_0x24bb0f,_0x5738b5)=>_0x24bb0f+_0x5738b5[_0x1313b4(0x1ab)],0x0),_0x41e54a=_0x51a6d0[_0x1313b4(0x1e7)];return console[_0x1313b4(0x263)]('💰\x20[PAYOUT]\x20Merchant\x20'+_0x51a6d0[_0x1313b4(0x1c9)]+':'),console['log']('\x20\x20\x20�\x20Total\x20payments\x20turnover:\x20'+_0x4e6706[_0x1313b4(0x1aa)](0x2)+_0x1313b4(0x191)),console[_0x1313b4(0x263)](_0x1313b4(0x2b0)+_0x52c10a['reduce']((_0x32a35b,_0x1437c6)=>_0x32a35b+_0x1437c6[_0x1313b4(0x2b3)],0x0)[_0x1313b4(0x1aa)](0x2)+_0x1313b4(0x235)),console[_0x1313b4(0x263)](_0x1313b4(0x2c4)+_0x41e54a[_0x1313b4(0x1aa)](0x2)+_0x1313b4(0x239)),{'id':_0x51a6d0['id'],'fullName':_0x51a6d0[_0x1313b4(0x216)],'username':_0x51a6d0[_0x1313b4(0x1c9)],'telegramId':_0x51a6d0[_0x1313b4(0x2bd)],'merchantUrl':_0x51a6d0[_0x1313b4(0x1c8)],'wallets':{'usdtPolygonWallet':_0x51a6d0[_0x1313b4(0x1a2)],'usdtTrcWallet':_0x51a6d0[_0x1313b4(0x1e9)],'usdtErcWallet':_0x51a6d0[_0x1313b4(0x224)],'usdcPolygonWallet':_0x51a6d0['usdcPolygonWallet']},'totalAmountUSDT':Math['round'](_0x4e6706*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x1313b4(0x189)](_0x41e54a*0x64)/0x64,'totalPayout':Math['round'](_0x699f4a*0x64)/0x64,'thisMonth':Math[_0x1313b4(0x189)](_0x23edf8*0x64)/0x64,'paymentsCount':_0x596c1f,'oldestPaymentDate':_0x46dceb?.[_0x1313b4(0x275)]||_0x51a6d0[_0x1313b4(0x190)],'gatewayBreakdown':_0x52c10a};})),_0x234778=_0x2e26b5['reduce']((_0x56d114,_0x55c2f4)=>_0x56d114+_0x55c2f4['totalAmountUSDT'],0x0),_0x4ca60a=_0x2e26b5[_0x4b06f6(0x294)]((_0x37f07b,_0x5b08e2)=>_0x37f07b+_0x5b08e2[_0x4b06f6(0x2bf)],0x0),_0x55c1db=_0x2e26b5[_0x4b06f6(0x294)]((_0xabbc8d,_0x4c0d93)=>_0xabbc8d+_0x4c0d93['totalPayout'],0x0),_0x1f44b6=_0x2e26b5[_0x4b06f6(0x294)]((_0x45d3b5,_0x12d0f1)=>_0x45d3b5+_0x12d0f1[_0x4b06f6(0x297)],0x0);return console[_0x4b06f6(0x263)]('📊\x20Merchants\x20awaiting\x20payout:\x20'+_0x28a327+_0x4b06f6(0x274)),console[_0x4b06f6(0x263)](_0x4b06f6(0x288)+Math['round'](_0x234778*0x64)/0x64+_0x4b06f6(0x191)),console[_0x4b06f6(0x263)](_0x4b06f6(0x1c4)+Math['round'](_0x4ca60a*0x64)/0x64+_0x4b06f6(0x2a7)),console[_0x4b06f6(0x263)](_0x4b06f6(0x21e)+Math[_0x4b06f6(0x189)](_0x55c1db*0x64)/0x64+'\x20USDT'),console[_0x4b06f6(0x263)](_0x4b06f6(0x1a7)+Math['round'](_0x1f44b6*0x64)/0x64+_0x4b06f6(0x1a6)),{'merchants':_0x2e26b5,'pagination':{'page':_0x41e66a,'limit':_0x40be88,'total':_0x28a327,'totalPages':Math[_0x4b06f6(0x1fc)](_0x28a327/_0x40be88)},'summary':{'totalMerchants':_0x28a327,'totalAmountUSDT':Math[_0x4b06f6(0x189)](_0x234778*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x4b06f6(0x189)](_0x4ca60a*0x64)/0x64,'totalPayout':Math[_0x4b06f6(0x189)](_0x55c1db*0x64)/0x64,'thisMonth':Math[_0x4b06f6(0x189)](_0x1f44b6*0x64)/0x64}};}async['createPayout'](_0x32e617){const _0x3dc698=a36_0x355f44,{shopId:_0x3ece78,amount:_0x19eae4,network:_0x1d5527,wallet:_0x4beb54,notes:_0x5174ef,txid:_0x113cf4,periodFrom:_0xf3cd08,periodTo:_0x598a98}=_0x32e617,_0x17b9d8=await database_1[_0x3dc698(0x292)][_0x3dc698(0x256)](async _0x47620a=>{const _0x397c1d=_0x3dc698,_0x2fedb6=await _0x47620a['shop'][_0x397c1d(0x1fd)]({'where':{'id':_0x3ece78},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x2fedb6)throw new Error(_0x397c1d(0x1bd));console[_0x397c1d(0x263)](_0x397c1d(0x1ee)+_0x2fedb6[_0x397c1d(0x1c9)]+':'),console[_0x397c1d(0x263)](_0x397c1d(0x24e)+_0x2fedb6[_0x397c1d(0x1e7)]['toFixed'](0x6)+_0x397c1d(0x1a6)),console[_0x397c1d(0x263)](_0x397c1d(0x1b2)+_0x19eae4[_0x397c1d(0x1aa)](0x6)+'\x20USDT'),console[_0x397c1d(0x263)](_0x397c1d(0x220)+_0x2fedb6[_0x397c1d(0x1be)]['toFixed'](0x6)+_0x397c1d(0x1a6));if(_0x113cf4)console[_0x397c1d(0x263)](_0x397c1d(0x1b8)+_0x113cf4);if(_0x2fedb6['balance']<_0x19eae4)throw new Error(_0x397c1d(0x291)+_0x2fedb6[_0x397c1d(0x1e7)][_0x397c1d(0x1aa)](0x6)+_0x397c1d(0x2b5)+_0x19eae4[_0x397c1d(0x1aa)](0x6)+'\x20USDT');let _0x5e1d3a=_0x4beb54;if(!_0x5e1d3a){const _0x5b0f77=await _0x47620a[_0x397c1d(0x2aa)][_0x397c1d(0x1fd)]({'where':{'id':_0x3ece78},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x5b0f77)switch(_0x1d5527){case'polygon':_0x5e1d3a=_0x5b0f77[_0x397c1d(0x1a2)]||undefined;break;case'trc20':_0x5e1d3a=_0x5b0f77[_0x397c1d(0x1e9)]||undefined;break;case'erc20':_0x5e1d3a=_0x5b0f77[_0x397c1d(0x224)]||undefined;break;case _0x397c1d(0x241):_0x5e1d3a=_0x5b0f77[_0x397c1d(0x243)]||undefined;break;}}console[_0x397c1d(0x263)](_0x397c1d(0x1d4)+_0x1d5527+':\x20'+(_0x5e1d3a||_0x397c1d(0x1a5)));const _0x242946=await _0x47620a[_0x397c1d(0x1cd)]['create']({'data':{'shopId':_0x3ece78,'amount':_0x19eae4,'network':_0x1d5527,'status':_0x397c1d(0x1f9),'txid':_0x113cf4,'notes':_0x5174ef,'periodFrom':_0xf3cd08?new Date(_0xf3cd08):null,'periodTo':_0x598a98?new Date(_0x598a98):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x59f003=_0x2fedb6[_0x397c1d(0x1e7)]-_0x19eae4,_0x346065=_0x2fedb6['totalPaidOut']+_0x19eae4;return await _0x47620a[_0x397c1d(0x2aa)][_0x397c1d(0x267)]({'where':{'id':_0x3ece78},'data':{'balance':_0x59f003,'totalPaidOut':_0x346065}}),console[_0x397c1d(0x263)](_0x397c1d(0x1cf)+_0x2fedb6['username']+_0x397c1d(0x26b)),console['log']('\x20\x20\x20Balance:\x20'+_0x2fedb6[_0x397c1d(0x1e7)][_0x397c1d(0x1aa)](0x6)+_0x397c1d(0x213)+_0x59f003['toFixed'](0x6)+_0x397c1d(0x1a9)+_0x19eae4[_0x397c1d(0x1aa)](0x6)+')'),console['log']('\x20\x20\x20Total\x20paid\x20out:\x20'+_0x2fedb6[_0x397c1d(0x1be)][_0x397c1d(0x1aa)](0x6)+'\x20->\x20'+_0x346065[_0x397c1d(0x1aa)](0x6)+_0x397c1d(0x2ad)+_0x19eae4[_0x397c1d(0x1aa)](0x6)+')'),{'payout':_0x242946,'shop':_0x2fedb6};});return console[_0x3dc698(0x263)]('✅\x20Payout\x20created:\x20'+_0x17b9d8[_0x3dc698(0x1cd)]['id']+_0x3dc698(0x298)+_0x17b9d8['shop']['username']+'\x20('+_0x19eae4+_0x3dc698(0x2bb)),{'id':_0x17b9d8[_0x3dc698(0x1cd)]['id'],'shopId':_0x17b9d8[_0x3dc698(0x1cd)][_0x3dc698(0x250)],'shopName':_0x17b9d8[_0x3dc698(0x2aa)][_0x3dc698(0x216)],'shopUsername':_0x17b9d8[_0x3dc698(0x2aa)][_0x3dc698(0x1c9)],'amount':_0x17b9d8['payout'][_0x3dc698(0x28c)],'network':_0x17b9d8[_0x3dc698(0x1cd)][_0x3dc698(0x1f4)],'status':_0x17b9d8[_0x3dc698(0x1cd)][_0x3dc698(0x1ac)],'txid':_0x17b9d8[_0x3dc698(0x1cd)][_0x3dc698(0x29f)],'notes':_0x17b9d8[_0x3dc698(0x1cd)][_0x3dc698(0x286)],'periodFrom':_0x17b9d8['payout'][_0x3dc698(0x1e2)],'periodTo':_0x17b9d8['payout'][_0x3dc698(0x237)],'createdAt':_0x17b9d8[_0x3dc698(0x1cd)][_0x3dc698(0x190)],'paidAt':_0x17b9d8[_0x3dc698(0x1cd)][_0x3dc698(0x275)]};}async[a36_0x355f44(0x19d)](_0x59e86c){const _0x5bb09d=a36_0x355f44,{page:_0x4c9776,limit:_0x360cd6,shopId:_0x3442eb,network:_0x4205cc,dateFrom:_0x1373ad,dateTo:_0x53fee7,search:_0x3a5bee}=_0x59e86c,_0x20c296=(_0x4c9776-0x1)*_0x360cd6,_0x3f90e0={};_0x3442eb&&(_0x3f90e0[_0x5bb09d(0x250)]=_0x3442eb);_0x4205cc&&(_0x3f90e0[_0x5bb09d(0x1f4)]=_0x4205cc);(_0x1373ad||_0x53fee7)&&(_0x3f90e0[_0x5bb09d(0x190)]={},_0x1373ad&&(_0x3f90e0['createdAt'][_0x5bb09d(0x1e5)]=new Date(_0x1373ad)),_0x53fee7&&(_0x3f90e0[_0x5bb09d(0x190)][_0x5bb09d(0x22c)]=new Date(_0x53fee7)));_0x3a5bee&&(_0x3f90e0['OR']=[{'shop':{'name':{'contains':_0x3a5bee,'mode':_0x5bb09d(0x2a0)}}},{'shop':{'username':{'contains':_0x3a5bee,'mode':_0x5bb09d(0x2a0)}}},{'notes':{'contains':_0x3a5bee,'mode':'insensitive'}}]);const [_0x4886f4,_0x42e182]=await Promise[_0x5bb09d(0x2b6)]([database_1[_0x5bb09d(0x292)]['payout'][_0x5bb09d(0x218)]({'where':_0x3f90e0,'skip':_0x20c296,'take':_0x360cd6,'orderBy':{'createdAt':_0x5bb09d(0x210)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x5bb09d(0x292)]['payout']['count']({'where':_0x3f90e0})]);return{'payouts':_0x4886f4[_0x5bb09d(0x25a)](_0x7e18fe=>({'id':_0x7e18fe['id'],'shopId':_0x7e18fe[_0x5bb09d(0x250)],'shopName':_0x7e18fe['shop'][_0x5bb09d(0x216)],'shopUsername':_0x7e18fe[_0x5bb09d(0x2aa)]['username'],'amount':_0x7e18fe['amount'],'network':_0x7e18fe[_0x5bb09d(0x1f4)],'status':_0x7e18fe['status'],'txid':_0x7e18fe[_0x5bb09d(0x29f)],'notes':_0x7e18fe[_0x5bb09d(0x286)],'periodFrom':_0x7e18fe[_0x5bb09d(0x1e2)],'periodTo':_0x7e18fe[_0x5bb09d(0x237)],'createdAt':_0x7e18fe['createdAt'],'paidAt':_0x7e18fe['paidAt']})),'pagination':{'page':_0x4c9776,'limit':_0x360cd6,'total':_0x42e182,'totalPages':Math[_0x5bb09d(0x1fc)](_0x42e182/_0x360cd6)}};}async[a36_0x355f44(0x1ce)](_0x2342c1){const _0x30c7db=a36_0x355f44,_0x1bd0bb=await database_1[_0x30c7db(0x292)]['payout'][_0x30c7db(0x1fd)]({'where':{'id':_0x2342c1},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x1bd0bb)return null;return{'id':_0x1bd0bb['id'],'shopId':_0x1bd0bb[_0x30c7db(0x250)],'shopName':_0x1bd0bb[_0x30c7db(0x2aa)][_0x30c7db(0x216)],'shopUsername':_0x1bd0bb[_0x30c7db(0x2aa)][_0x30c7db(0x1c9)],'amount':_0x1bd0bb[_0x30c7db(0x28c)],'network':_0x1bd0bb[_0x30c7db(0x1f4)],'status':_0x1bd0bb[_0x30c7db(0x1ac)],'txid':_0x1bd0bb[_0x30c7db(0x29f)],'notes':_0x1bd0bb[_0x30c7db(0x286)],'periodFrom':_0x1bd0bb[_0x30c7db(0x1e2)],'periodTo':_0x1bd0bb['periodTo'],'createdAt':_0x1bd0bb[_0x30c7db(0x190)],'paidAt':_0x1bd0bb['paidAt']};}async[a36_0x355f44(0x2c1)](_0x4bcbad){const _0x20e4c5=a36_0x355f44;await database_1[_0x20e4c5(0x292)][_0x20e4c5(0x1cd)][_0x20e4c5(0x1bb)]({'where':{'id':_0x4bcbad}});}async[a36_0x355f44(0x23e)](_0x1ef1d4){const _0x1bc67b=a36_0x355f44,{page:_0x1b719b,limit:_0xebb67f,status:_0x26a902,gateway:_0x12e5c4,shopId:_0x4938c7,dateFrom:_0x4b4305,dateTo:_0xdc3d37,search:_0x599a36,currency:_0xe2dfd2,sortBy:_0x11f1ac,sortOrder:_0x8d66a5}=_0x1ef1d4,_0x12b12f=(_0x1b719b-0x1)*_0xebb67f;console[_0x1bc67b(0x263)](_0x1bc67b(0x230),_0x1ef1d4);const _0x5f0154=await database_1[_0x1bc67b(0x292)][_0x1bc67b(0x1d5)][_0x1bc67b(0x2a4)]({'by':['gateway'],'_count':{'gateway':!![]}});console['log'](_0x1bc67b(0x2b7),_0x5f0154[_0x1bc67b(0x25a)](_0x99a3c=>_0x99a3c['gateway']+'\x20('+_0x99a3c[_0x1bc67b(0x296)]['gateway']+_0x1bc67b(0x1ba)));if(_0x12e5c4){const _0x4d4d44=_0x5f0154[_0x1bc67b(0x285)](_0x2b360b=>_0x2b360b['gateway'][_0x1bc67b(0x24f)]()===_0x12e5c4[_0x1bc67b(0x24f)]());!_0x4d4d44&&_0x12e5c4[_0x1bc67b(0x24f)]()!==_0x1bc67b(0x27e)&&console['log'](_0x1bc67b(0x2ba)+_0x12e5c4+'\x27\x20not\x20found.\x20Available\x20gateways:\x20'+_0x5f0154[_0x1bc67b(0x25a)](_0x1dc85d=>_0x1dc85d[_0x1bc67b(0x21d)])[_0x1bc67b(0x232)](',\x20'));}const _0x535d53={};_0x26a902&&(_0x535d53['status']=_0x26a902[_0x1bc67b(0x20b)]());if(!_0x12e5c4)_0x535d53[_0x1bc67b(0x21d)]={'not':'test_gateway'};else{if(_0x12e5c4&&(_0x12e5c4['toLowerCase']()==='test_gateway'||_0x12e5c4==='0000'))_0x535d53[_0x1bc67b(0x21d)]='test_gateway';else{let _0x3d896d=_0x12e5c4;const _0x44336d=(0x0,gateway_1['getGatewayNameById'])(_0x12e5c4);if(_0x44336d)_0x3d896d=_0x44336d,console[_0x1bc67b(0x263)](_0x1bc67b(0x1f5)+_0x12e5c4+_0x1bc67b(0x268)+_0x3d896d+'\x27');else{const _0x5502ed=(0x0,gateway_1[_0x1bc67b(0x1ed)])(_0x12e5c4);if(_0x5502ed){const _0x51148b=(0x0,gateway_1[_0x1bc67b(0x23f)])(_0x5502ed);_0x51148b&&(_0x3d896d=_0x51148b,console[_0x1bc67b(0x263)]('🔄\x20Converted\x20gateway\x20name\x20\x27'+_0x12e5c4+_0x1bc67b(0x21b)+_0x5502ed+'\x27\x20->\x20name\x20\x27'+_0x3d896d+'\x27'));}else console['log'](_0x1bc67b(0x255)+_0x12e5c4+_0x1bc67b(0x1dc));}const _0x9be93e=await database_1[_0x1bc67b(0x292)][_0x1bc67b(0x1d5)]['count']({'where':{'gateway':_0x3d896d[_0x1bc67b(0x24f)]()},'take':0x1});_0x9be93e===0x0?(console[_0x1bc67b(0x263)](_0x1bc67b(0x282)+_0x3d896d+_0x1bc67b(0x249)+_0x12e5c4+'\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result'),_0x535d53['gateway']=_0x1bc67b(0x280)):(_0x535d53[_0x1bc67b(0x21d)]=_0x3d896d[_0x1bc67b(0x24f)](),console[_0x1bc67b(0x263)](_0x1bc67b(0x27c)+_0x3d896d+_0x1bc67b(0x249)+_0x12e5c4+'\x27)'));}}console[_0x1bc67b(0x263)]('📊\x20Gateway\x20filter\x20applied:',_0x535d53[_0x1bc67b(0x21d)]);_0x4938c7&&(_0x535d53['shopId']=_0x4938c7);_0xe2dfd2&&(_0x535d53['currency']=_0xe2dfd2[_0x1bc67b(0x20b)](),console[_0x1bc67b(0x263)](_0x1bc67b(0x214)+_0xe2dfd2[_0x1bc67b(0x20b)]()));(_0x4b4305||_0xdc3d37)&&(_0x535d53[_0x1bc67b(0x190)]={},_0x4b4305&&(_0x535d53['createdAt'][_0x1bc67b(0x1e5)]=new Date(_0x4b4305)),_0xdc3d37&&(_0x535d53['createdAt']['lte']=new Date(_0xdc3d37)));_0x599a36&&(_0x535d53['OR']=[{'id':{'contains':_0x599a36,'mode':_0x1bc67b(0x2a0)}},{'orderId':{'contains':_0x599a36,'mode':_0x1bc67b(0x2a0)}},{'gatewayOrderId':{'contains':_0x599a36,'mode':'insensitive'}},{'customerEmail':{'contains':_0x599a36,'mode':'insensitive'}},{'shop':{'name':{'contains':_0x599a36,'mode':_0x1bc67b(0x2a0)}}},{'shop':{'username':{'contains':_0x599a36,'mode':_0x1bc67b(0x2a0)}}}]);console[_0x1bc67b(0x263)](_0x1bc67b(0x24a),JSON[_0x1bc67b(0x1af)](_0x535d53,null,0x2));let _0x13e098={'createdAt':_0x1bc67b(0x210)};if(_0x11f1ac){const _0x1db07e=['amount',_0x1bc67b(0x190),_0x1bc67b(0x24d),_0x1bc67b(0x1ac),_0x1bc67b(0x21d),_0x1bc67b(0x1db)],_0x3e139b=[_0x1bc67b(0x23d),_0x1bc67b(0x210)];if(_0x1db07e[_0x1bc67b(0x21a)](_0x11f1ac)){const _0x51a271=_0x3e139b['includes'](_0x8d66a5)?_0x8d66a5:'desc';_0x13e098={[_0x11f1ac]:_0x51a271},console[_0x1bc67b(0x263)](_0x1bc67b(0x1d2)+_0x11f1ac+_0x1bc67b(0x18d)+_0x51a271+_0x1bc67b(0x21c));}}const [_0x47b482,_0x25a19d]=await Promise[_0x1bc67b(0x2b6)]([database_1[_0x1bc67b(0x292)][_0x1bc67b(0x1d5)]['findMany']({'where':_0x535d53,'skip':_0x12b12f,'take':_0xebb67f,'orderBy':_0x13e098,'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x1bc67b(0x1d5)][_0x1bc67b(0x290)]({'where':_0x535d53})]);return{'payments':_0x47b482,'pagination':{'page':_0x1b719b,'limit':_0xebb67f,'total':_0x25a19d,'totalPages':Math['ceil'](_0x25a19d/_0xebb67f)}};}async[a36_0x355f44(0x26f)](_0x5b2414){const _0x3e5ed2=a36_0x355f44,_0x31182f=await database_1['default']['payment']['findUnique']({'where':{'id':_0x5b2414},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x31182f)return null;return{'id':_0x31182f['id'],'shopId':_0x31182f[_0x3e5ed2(0x250)],'gateway':_0x31182f[_0x3e5ed2(0x21d)],'amount':_0x31182f['amount'],'currency':_0x31182f[_0x3e5ed2(0x1db)],'status':_0x31182f[_0x3e5ed2(0x1ac)],'orderId':_0x31182f[_0x3e5ed2(0x1d6)],'gatewayOrderId':_0x31182f['gatewayOrderId'],'customerEmail':_0x31182f[_0x3e5ed2(0x29d)],'customerName':_0x31182f[_0x3e5ed2(0x183)],'customerCountry':_0x31182f['customerCountry'],'customerIp':_0x31182f['customerIp'],'customerUa':_0x31182f['customerUa'],'failureMessage':_0x31182f[_0x3e5ed2(0x279)],'externalPaymentUrl':_0x31182f[_0x3e5ed2(0x23b)],'successUrl':_0x31182f[_0x3e5ed2(0x1fe)],'failUrl':_0x31182f[_0x3e5ed2(0x29c)],'pendingUrl':_0x31182f[_0x3e5ed2(0x1da)],'whiteUrl':_0x31182f['whiteUrl'],'createdAt':_0x31182f['createdAt'],'updatedAt':_0x31182f[_0x3e5ed2(0x24d)],'shop':_0x31182f[_0x3e5ed2(0x2aa)]};}async[a36_0x355f44(0x1b4)](_0x343956,_0x297d22,_0xa56d44,_0x435240){const _0x3450f1=a36_0x355f44,_0x47b8f0=await database_1[_0x3450f1(0x292)][_0x3450f1(0x256)](async _0x42c5b6=>{const _0x2f52d6=_0x3450f1,_0x4eb8ab=await _0x42c5b6[_0x2f52d6(0x1d5)][_0x2f52d6(0x1fd)]({'where':{'id':_0x343956},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x4eb8ab)throw new Error('Payment\x20not\x20found');const _0x1a596e=_0x4eb8ab[_0x2f52d6(0x1ac)],_0x1210cc=_0x297d22[_0x2f52d6(0x20b)]();console[_0x2f52d6(0x263)](_0x2f52d6(0x28d)+_0x343956+_0x2f52d6(0x238)+_0x1a596e+_0x2f52d6(0x213)+_0x1210cc),console['log']('💰\x20Current\x20shop\x20balance:\x20'+_0x4eb8ab[_0x2f52d6(0x2aa)]['balance']+_0x2f52d6(0x1a6));const _0x4d9f39={'status':_0x1210cc,'updatedAt':new Date(),'statusChangedBy':'admin','statusChangedAt':new Date()};_0xa56d44&&(_0x4d9f39[_0x2f52d6(0x1cb)]=_0xa56d44);_0x1210cc==='CHARGEBACK'&&_0x435240&&(_0x4d9f39[_0x2f52d6(0x2b4)]=_0x435240);let _0x4a2b7b=0x0,_0x3e4342=_0x4eb8ab[_0x2f52d6(0x2aa)][_0x2f52d6(0x1e7)];if(_0x1210cc==='PAID'&&_0x1a596e!==_0x2f52d6(0x254)){_0x4d9f39[_0x2f52d6(0x275)]=new Date();const _0xb7b593=await currencyService_1['currencyService'][_0x2f52d6(0x1e1)](_0x4eb8ab[_0x2f52d6(0x28c)],_0x4eb8ab['currency']);_0x4d9f39[_0x2f52d6(0x1ab)]=_0xb7b593;let _0x4a0f14=0xa;const _0x2316fc=await _0x42c5b6[_0x2f52d6(0x2aa)][_0x2f52d6(0x1fd)]({'where':{'id':_0x4eb8ab[_0x2f52d6(0x250)]},'select':{'gatewaySettings':!![]}});if(_0x2316fc?.[_0x2f52d6(0x257)])try{const _0x460199=JSON['parse'](_0x2316fc['gatewaySettings']);for(const [_0x155344,_0x237ce8]of Object[_0x2f52d6(0x277)](_0x460199)){if(_0x155344[_0x2f52d6(0x24f)]()===_0x4eb8ab[_0x2f52d6(0x21d)]['toLowerCase']()){_0x4a0f14=_0x237ce8[_0x2f52d6(0x186)]||0xa;break;}}}catch(_0x182895){console[_0x2f52d6(0x287)]('Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20'+_0x343956+':',_0x182895);}let _0x3be80d;_0x4eb8ab[_0x2f52d6(0x272)]!==null&&_0x4eb8ab[_0x2f52d6(0x272)]!==undefined?(_0x3be80d=_0x4eb8ab[_0x2f52d6(0x272)],console[_0x2f52d6(0x263)](_0x2f52d6(0x1e3)+_0x3be80d[_0x2f52d6(0x1aa)](0x6)+_0x2f52d6(0x260)+_0x343956)):(_0x3be80d=_0xb7b593*(0x1-_0x4a0f14/0x64),console[_0x2f52d6(0x263)](_0x2f52d6(0x1a0)+_0x343956+':\x20'+_0x4a0f14+_0x2f52d6(0x1d1)+_0xb7b593[_0x2f52d6(0x1aa)](0x6)+_0x2f52d6(0x1a6)),_0x4d9f39[_0x2f52d6(0x272)]=_0x3be80d),_0x4a2b7b=_0x3be80d,_0x3e4342+=_0x3be80d,console[_0x2f52d6(0x263)](_0x2f52d6(0x23a)+_0x343956+_0x2f52d6(0x1d9)),console[_0x2f52d6(0x263)](_0x2f52d6(0x20a)+_0xb7b593[_0x2f52d6(0x1aa)](0x6)+_0x2f52d6(0x1a6)),console[_0x2f52d6(0x263)]('\x20\x20\x20Gateway:\x20'+_0x4eb8ab[_0x2f52d6(0x21d)]+_0x2f52d6(0x226)+_0x4a0f14+'%'),console[_0x2f52d6(0x263)](_0x2f52d6(0x20e)+_0x3be80d['toFixed'](0x6)+_0x2f52d6(0x245)+_0x4a0f14+_0x2f52d6(0x1c0)),console['log'](_0x2f52d6(0x204)+_0x3be80d[_0x2f52d6(0x1aa)](0x6)+_0x2f52d6(0x1a6));}else{if(_0x1a596e===_0x2f52d6(0x254)&&_0x1210cc!==_0x2f52d6(0x254)){if(_0x4eb8ab[_0x2f52d6(0x1ab)]){let _0x377a27=0xa;const _0x4a5b96=await _0x42c5b6[_0x2f52d6(0x2aa)]['findUnique']({'where':{'id':_0x4eb8ab[_0x2f52d6(0x250)]},'select':{'gatewaySettings':!![]}});if(_0x4a5b96?.['gatewaySettings'])try{const _0x3091e9=JSON[_0x2f52d6(0x182)](_0x4a5b96[_0x2f52d6(0x257)]);for(const [_0x532266,_0x16ec84]of Object[_0x2f52d6(0x277)](_0x3091e9)){if(_0x532266['toLowerCase']()===_0x4eb8ab[_0x2f52d6(0x21d)]['toLowerCase']()){_0x377a27=_0x16ec84[_0x2f52d6(0x186)]||0xa;break;}}}catch(_0x1f4565){console[_0x2f52d6(0x287)](_0x2f52d6(0x1e6)+_0x343956+':',_0x1f4565);}const _0x548fa8=_0x4eb8ab[_0x2f52d6(0x1ab)]*(0x1-_0x377a27/0x64);_0x4a2b7b=-_0x548fa8,_0x3e4342-=_0x548fa8,_0x4d9f39['amountUSDT']=null,_0x4d9f39[_0x2f52d6(0x272)]=null,console[_0x2f52d6(0x263)](_0x2f52d6(0x23a)+_0x343956+_0x2f52d6(0x1a3)),console[_0x2f52d6(0x263)](_0x2f52d6(0x20a)+_0x4eb8ab[_0x2f52d6(0x1ab)][_0x2f52d6(0x1aa)](0x6)+_0x2f52d6(0x1a6)),console[_0x2f52d6(0x263)]('\x20\x20\x20Gateway:\x20'+_0x4eb8ab[_0x2f52d6(0x21d)]+_0x2f52d6(0x226)+_0x377a27+'%'),console[_0x2f52d6(0x263)](_0x2f52d6(0x28f)+_0x548fa8[_0x2f52d6(0x1aa)](0x6)+_0x2f52d6(0x245)+_0x377a27+_0x2f52d6(0x1c0)),console[_0x2f52d6(0x263)](_0x2f52d6(0x19e)+_0x548fa8[_0x2f52d6(0x1aa)](0x6)+_0x2f52d6(0x1a6));}}}_0x1210cc===_0x2f52d6(0x28a)&&(_0x1a596e==='PAID'&&_0x4eb8ab[_0x2f52d6(0x1ab)]&&console[_0x2f52d6(0x263)](_0x2f52d6(0x22e)),_0x435240&&_0x435240>0x0&&(_0x4a2b7b-=_0x435240,_0x3e4342-=_0x435240,console[_0x2f52d6(0x263)](_0x2f52d6(0x200)+_0x435240[_0x2f52d6(0x1aa)](0x6)+_0x2f52d6(0x281))));_0x1210cc===_0x2f52d6(0x25b)&&_0x1a596e===_0x2f52d6(0x254)&&console[_0x2f52d6(0x263)](_0x2f52d6(0x1f6));const _0x3c82ad=await _0x42c5b6['payment'][_0x2f52d6(0x267)]({'where':{'id':_0x343956},'data':_0x4d9f39,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x4a2b7b!==0x0&&(await _0x42c5b6[_0x2f52d6(0x2aa)][_0x2f52d6(0x267)]({'where':{'id':_0x4eb8ab[_0x2f52d6(0x250)]},'data':{'balance':_0x3e4342}}),console[_0x2f52d6(0x263)](_0x2f52d6(0x1cf)+_0x4eb8ab[_0x2f52d6(0x250)]+'\x20balance\x20updated:\x20'+_0x4eb8ab['shop'][_0x2f52d6(0x1e7)][_0x2f52d6(0x1aa)](0x6)+_0x2f52d6(0x213)+_0x3e4342['toFixed'](0x6)+_0x2f52d6(0x259)+(_0x4a2b7b>0x0?'+':'')+_0x4a2b7b[_0x2f52d6(0x1aa)](0x6)+')')),_0x3c82ad;});return{'id':_0x47b8f0['id'],'shopId':_0x47b8f0[_0x3450f1(0x250)],'gateway':_0x47b8f0['gateway'],'amount':_0x47b8f0[_0x3450f1(0x28c)],'currency':_0x47b8f0[_0x3450f1(0x1db)],'status':_0x47b8f0[_0x3450f1(0x1ac)],'orderId':_0x47b8f0['orderId'],'gatewayOrderId':_0x47b8f0[_0x3450f1(0x192)],'customerEmail':_0x47b8f0[_0x3450f1(0x29d)],'customerName':_0x47b8f0[_0x3450f1(0x183)],'customerCountry':_0x47b8f0[_0x3450f1(0x276)],'customerIp':_0x47b8f0['customerIp'],'customerUa':_0x47b8f0[_0x3450f1(0x203)],'failureMessage':_0x47b8f0[_0x3450f1(0x279)],'adminNotes':_0x47b8f0[_0x3450f1(0x1cb)],'chargebackAmount':_0x47b8f0['chargebackAmount'],'statusChangedBy':_0x47b8f0[_0x3450f1(0x1d3)],'statusChangedAt':_0x47b8f0[_0x3450f1(0x26a)],'createdAt':_0x47b8f0[_0x3450f1(0x190)],'updatedAt':_0x47b8f0[_0x3450f1(0x24d)],'shop':_0x47b8f0[_0x3450f1(0x2aa)]};}async[a36_0x355f44(0x208)](_0x27f443,_0x2dd4a5){const _0x4f8440=a36_0x355f44,_0x23bef9=Math[_0x4f8440(0x264)]()[_0x4f8440(0x278)](0x24)[_0x4f8440(0x1b9)](0x2,0x9);console[_0x4f8440(0x263)](_0x4f8440(0x244)+_0x23bef9+_0x4f8440(0x202)+_0x27f443);const _0x25390e={..._0x2dd4a5};_0x2dd4a5[_0x4f8440(0x194)]&&_0x2dd4a5['password'][_0x4f8440(0x1e4)]()!==''?(console[_0x4f8440(0x263)](_0x4f8440(0x2b9)+_0x23bef9+_0x4f8440(0x215)+_0x27f443),_0x25390e[_0x4f8440(0x194)]=await bcryptjs_1[_0x4f8440(0x292)]['hash'](_0x2dd4a5[_0x4f8440(0x194)],0xc)):(console[_0x4f8440(0x263)](_0x4f8440(0x2b9)+_0x23bef9+_0x4f8440(0x22f)),delete _0x25390e['password']);_0x2dd4a5[_0x4f8440(0x201)]&&(_0x25390e[_0x4f8440(0x216)]=_0x2dd4a5[_0x4f8440(0x201)],delete _0x25390e[_0x4f8440(0x201)]);_0x2dd4a5[_0x4f8440(0x2a3)]&&(_0x25390e['telegram']=_0x2dd4a5[_0x4f8440(0x2a3)],delete _0x25390e[_0x4f8440(0x2a3)]);_0x2dd4a5[_0x4f8440(0x18a)]&&(_0x25390e[_0x4f8440(0x1c8)]=_0x2dd4a5[_0x4f8440(0x18a)],delete _0x25390e['merchantUrl']);if(_0x2dd4a5[_0x4f8440(0x19f)]){const _0x3d8924=_0x2dd4a5[_0x4f8440(0x19f)][_0x4f8440(0x25a)](_0x29415a=>this['getGatewayInternalName'](_0x29415a));console[_0x4f8440(0x263)]('🔄\x20Gateway\x20mapping:',_0x2dd4a5[_0x4f8440(0x19f)],'->',_0x3d8924),_0x25390e[_0x4f8440(0x18f)]=JSON[_0x4f8440(0x1af)](_0x3d8924),delete _0x25390e[_0x4f8440(0x19f)];}_0x2dd4a5[_0x4f8440(0x257)]&&(console['log'](_0x4f8440(0x2a5)+_0x23bef9+']\x20Gateway\x20settings\x20before\x20saving:',_0x2dd4a5[_0x4f8440(0x257)]),_0x25390e[_0x4f8440(0x257)]=JSON['stringify'](_0x2dd4a5[_0x4f8440(0x257)]),console[_0x4f8440(0x263)](_0x4f8440(0x2a5)+_0x23bef9+_0x4f8440(0x293),_0x25390e[_0x4f8440(0x257)]));_0x2dd4a5[_0x4f8440(0x29a)]&&(_0x2dd4a5['wallets'][_0x4f8440(0x1a2)]!==undefined&&(_0x25390e['usdtPolygonWallet']=_0x2dd4a5['wallets'][_0x4f8440(0x1a2)]||null),_0x2dd4a5[_0x4f8440(0x29a)][_0x4f8440(0x1e9)]!==undefined&&(_0x25390e[_0x4f8440(0x1e9)]=_0x2dd4a5['wallets']['usdtTrcWallet']||null),_0x2dd4a5[_0x4f8440(0x29a)][_0x4f8440(0x224)]!==undefined&&(_0x25390e['usdtErcWallet']=_0x2dd4a5[_0x4f8440(0x29a)]['usdtErcWallet']||null),_0x2dd4a5[_0x4f8440(0x29a)][_0x4f8440(0x243)]!==undefined&&(_0x25390e[_0x4f8440(0x243)]=_0x2dd4a5[_0x4f8440(0x29a)]['usdcPolygonWallet']||null),delete _0x25390e[_0x4f8440(0x29a)]);const _0x2e286f=await database_1[_0x4f8440(0x292)][_0x4f8440(0x2aa)][_0x4f8440(0x267)]({'where':{'id':_0x27f443},'data':_0x25390e,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0x4f8440(0x263)](_0x4f8440(0x2ac)+_0x23bef9+_0x4f8440(0x251),_0x2e286f[_0x4f8440(0x257)]),{'id':_0x2e286f['id'],'fullName':_0x2e286f[_0x4f8440(0x216)],'username':_0x2e286f['username'],'telegramId':_0x2e286f[_0x4f8440(0x2bd)],'merchantUrl':_0x2e286f['shopUrl'],'gateways':_0x2e286f[_0x4f8440(0x18f)]?JSON['parse'](_0x2e286f[_0x4f8440(0x18f)]):null,'gatewaySettings':_0x2e286f[_0x4f8440(0x257)]?JSON[_0x4f8440(0x182)](_0x2e286f[_0x4f8440(0x257)]):null,'publicKey':_0x2e286f['publicKey'],'wallets':{'usdtPolygonWallet':_0x2e286f[_0x4f8440(0x1a2)],'usdtTrcWallet':_0x2e286f[_0x4f8440(0x1e9)],'usdtErcWallet':_0x2e286f[_0x4f8440(0x224)],'usdcPolygonWallet':_0x2e286f[_0x4f8440(0x243)]},'status':_0x2e286f[_0x4f8440(0x1ac)],'createdAt':_0x2e286f[_0x4f8440(0x190)]};}async[a36_0x355f44(0x240)](_0x28f241){const _0x3d2b8d=a36_0x355f44,_0x13f95d=await database_1[_0x3d2b8d(0x292)][_0x3d2b8d(0x2aa)][_0x3d2b8d(0x267)]({'where':{'id':_0x28f241},'data':{'status':_0x3d2b8d(0x2be)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x13f95d['id'],'fullName':_0x13f95d[_0x3d2b8d(0x216)],'username':_0x13f95d['username'],'telegramId':_0x13f95d[_0x3d2b8d(0x2bd)],'merchantUrl':_0x13f95d['shopUrl'],'gateways':_0x13f95d['paymentGateways']?JSON[_0x3d2b8d(0x182)](_0x13f95d[_0x3d2b8d(0x18f)]):null,'gatewaySettings':_0x13f95d['gatewaySettings']?JSON[_0x3d2b8d(0x182)](_0x13f95d[_0x3d2b8d(0x257)]):null,'publicKey':_0x13f95d[_0x3d2b8d(0x2a2)],'wallets':{'usdtPolygonWallet':_0x13f95d[_0x3d2b8d(0x1a2)],'usdtTrcWallet':_0x13f95d[_0x3d2b8d(0x1e9)],'usdtErcWallet':_0x13f95d[_0x3d2b8d(0x224)],'usdcPolygonWallet':_0x13f95d['usdcPolygonWallet']},'status':_0x13f95d[_0x3d2b8d(0x1ac)],'createdAt':_0x13f95d[_0x3d2b8d(0x190)]};}async[a36_0x355f44(0x2a9)](_0x5a39fe){const _0x5739f0=a36_0x355f44,_0x54c634=await database_1[_0x5739f0(0x292)][_0x5739f0(0x2aa)][_0x5739f0(0x267)]({'where':{'id':_0x5a39fe},'data':{'status':_0x5739f0(0x295)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x54c634['id'],'fullName':_0x54c634[_0x5739f0(0x216)],'username':_0x54c634[_0x5739f0(0x1c9)],'telegramId':_0x54c634[_0x5739f0(0x2bd)],'merchantUrl':_0x54c634[_0x5739f0(0x1c8)],'gateways':_0x54c634[_0x5739f0(0x18f)]?JSON[_0x5739f0(0x182)](_0x54c634['paymentGateways']):null,'gatewaySettings':_0x54c634[_0x5739f0(0x257)]?JSON[_0x5739f0(0x182)](_0x54c634[_0x5739f0(0x257)]):null,'publicKey':_0x54c634[_0x5739f0(0x2a2)],'wallets':{'usdtPolygonWallet':_0x54c634[_0x5739f0(0x1a2)],'usdtTrcWallet':_0x54c634[_0x5739f0(0x1e9)],'usdtErcWallet':_0x54c634[_0x5739f0(0x224)],'usdcPolygonWallet':_0x54c634[_0x5739f0(0x243)]},'status':_0x54c634[_0x5739f0(0x1ac)],'createdAt':_0x54c634[_0x5739f0(0x190)]};}async[a36_0x355f44(0x29b)](_0x1ecdd7){const _0x2e0c7e=a36_0x355f44,{page:_0x5454e9,limit:_0x2600c6,status:_0xfc60ba}=_0x1ecdd7,_0x60e15f=(_0x5454e9-0x1)*_0x2600c6,_0x4bc254={};_0xfc60ba&&(_0x4bc254[_0x2e0c7e(0x1ac)]=_0xfc60ba[_0x2e0c7e(0x20b)]());const [_0x40323c,_0x48155b]=await Promise[_0x2e0c7e(0x2b6)]([database_1['default'][_0x2e0c7e(0x2aa)]['findMany']({'where':_0x4bc254,'skip':_0x60e15f,'take':_0x2600c6,'orderBy':{'createdAt':_0x2e0c7e(0x210)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1['default'][_0x2e0c7e(0x2aa)][_0x2e0c7e(0x290)]({'where':_0x4bc254})]);return{'users':_0x40323c[_0x2e0c7e(0x25a)](_0x41d3a7=>{const _0x27a3e4=_0x2e0c7e,_0x2e5ec5=_0x41d3a7[_0x27a3e4(0x18f)]?JSON[_0x27a3e4(0x182)](_0x41d3a7[_0x27a3e4(0x18f)]):null,_0xcb108c=_0x2e5ec5?_0x2e5ec5[_0x27a3e4(0x25a)](_0x5c212a=>this[_0x27a3e4(0x253)](_0x5c212a)):null;return{'id':_0x41d3a7['id'],'fullName':_0x41d3a7[_0x27a3e4(0x216)],'username':_0x41d3a7[_0x27a3e4(0x1c9)],'telegramId':_0x41d3a7['telegram'],'merchantUrl':_0x41d3a7[_0x27a3e4(0x1c8)],'gateways':_0xcb108c,'gatewaySettings':_0x41d3a7['gatewaySettings']?JSON[_0x27a3e4(0x182)](_0x41d3a7[_0x27a3e4(0x257)]):null,'publicKey':_0x41d3a7[_0x27a3e4(0x2a2)],'wallets':{'usdtPolygonWallet':_0x41d3a7[_0x27a3e4(0x1a2)],'usdtTrcWallet':_0x41d3a7['usdtTrcWallet'],'usdtErcWallet':_0x41d3a7[_0x27a3e4(0x224)],'usdcPolygonWallet':_0x41d3a7[_0x27a3e4(0x243)]},'status':_0x41d3a7[_0x27a3e4(0x1ac)],'createdAt':_0x41d3a7[_0x27a3e4(0x190)]};}),'pagination':{'page':_0x5454e9,'limit':_0x2600c6,'total':_0x48155b,'totalPages':Math[_0x2e0c7e(0x1fc)](_0x48155b/_0x2600c6)}};}async['getUserById'](_0x48e6be){const _0x1971cb=a36_0x355f44,_0x1a8f36=await database_1[_0x1971cb(0x292)]['shop'][_0x1971cb(0x1fd)]({'where':{'id':_0x48e6be},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x1a8f36)return null;const _0x2a9312=_0x1a8f36['paymentGateways']?JSON['parse'](_0x1a8f36['paymentGateways']):null,_0x42c9b6=_0x2a9312?_0x2a9312[_0x1971cb(0x25a)](_0x49b393=>this['getGatewayDisplayName'](_0x49b393)):null;return _0x2a9312&&_0x42c9b6&&console[_0x1971cb(0x263)](_0x1971cb(0x1c5),_0x2a9312,'->',_0x42c9b6),{'id':_0x1a8f36['id'],'fullName':_0x1a8f36['name'],'username':_0x1a8f36['username'],'telegramId':_0x1a8f36['telegram'],'merchantUrl':_0x1a8f36[_0x1971cb(0x1c8)],'gateways':_0x42c9b6,'gatewaySettings':_0x1a8f36['gatewaySettings']?JSON['parse'](_0x1a8f36[_0x1971cb(0x257)]):null,'publicKey':_0x1a8f36[_0x1971cb(0x2a2)],'wallets':{'usdtPolygonWallet':_0x1a8f36[_0x1971cb(0x1a2)],'usdtTrcWallet':_0x1a8f36[_0x1971cb(0x1e9)],'usdtErcWallet':_0x1a8f36[_0x1971cb(0x224)],'usdcPolygonWallet':_0x1a8f36[_0x1971cb(0x243)]},'status':_0x1a8f36[_0x1971cb(0x1ac)],'createdAt':_0x1a8f36['createdAt']};}async[a36_0x355f44(0x1bc)](_0x40298a){const _0x54b3e5=a36_0x355f44,{fullName:_0x465b7c,username:_0x48f9b7,password:_0x5c732a,telegramId:_0x490379,merchantUrl:_0x5abadc,gateways:_0x5bace4,gatewaySettings:_0x3507c2,wallets:_0x39c9bf}=_0x40298a,_0x5e60ec=await database_1[_0x54b3e5(0x292)][_0x54b3e5(0x2aa)][_0x54b3e5(0x1fd)]({'where':{'username':_0x48f9b7}});if(_0x5e60ec)throw new Error(_0x54b3e5(0x223));if(_0x490379){const _0x246a3e=await database_1[_0x54b3e5(0x292)]['shop'][_0x54b3e5(0x1fd)]({'where':{'telegram':_0x490379}});if(_0x246a3e)throw new Error(_0x54b3e5(0x18b));}const _0x1f40b5=await bcryptjs_1[_0x54b3e5(0x292)][_0x54b3e5(0x299)](_0x5c732a,0xc),_0x2c2e44=_0x54b3e5(0x1dd)+crypto_1[_0x54b3e5(0x292)]['randomBytes'](0x20)['toString'](_0x54b3e5(0x22a)),_0x43eb3c='sk_'+crypto_1[_0x54b3e5(0x292)][_0x54b3e5(0x2a1)](0x20)['toString']('hex'),_0x4d7055=_0x5bace4?_0x5bace4[_0x54b3e5(0x25a)](_0x4f9f96=>this[_0x54b3e5(0x1ad)](_0x4f9f96)):null;_0x5bace4&&_0x4d7055&&console[_0x54b3e5(0x263)](_0x54b3e5(0x18e),_0x5bace4,'->',_0x4d7055);const _0x5aa33d=await database_1['default'][_0x54b3e5(0x2aa)][_0x54b3e5(0x212)]({'data':{'name':_0x465b7c,'username':_0x48f9b7,'password':_0x1f40b5,'telegram':_0x490379,'shopUrl':_0x5abadc,'paymentGateways':_0x4d7055?JSON[_0x54b3e5(0x1af)](_0x4d7055):null,'gatewaySettings':_0x3507c2?JSON[_0x54b3e5(0x1af)](_0x3507c2):null,'usdtPolygonWallet':_0x39c9bf?.['usdtPolygonWallet']||null,'usdtTrcWallet':_0x39c9bf?.[_0x54b3e5(0x1e9)]||null,'usdtErcWallet':_0x39c9bf?.[_0x54b3e5(0x224)]||null,'usdcPolygonWallet':_0x39c9bf?.[_0x54b3e5(0x243)]||null,'publicKey':_0x2c2e44,'secretKey':_0x43eb3c,'status':_0x54b3e5(0x295)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x5aa33d['id'],'fullName':_0x5aa33d[_0x54b3e5(0x216)],'username':_0x5aa33d[_0x54b3e5(0x1c9)],'telegramId':_0x5aa33d[_0x54b3e5(0x2bd)],'merchantUrl':_0x5aa33d[_0x54b3e5(0x1c8)],'gateways':_0x5aa33d[_0x54b3e5(0x18f)]?JSON[_0x54b3e5(0x182)](_0x5aa33d[_0x54b3e5(0x18f)]):null,'gatewaySettings':_0x5aa33d['gatewaySettings']?JSON[_0x54b3e5(0x182)](_0x5aa33d[_0x54b3e5(0x257)]):null,'publicKey':_0x5aa33d['publicKey'],'wallets':{'usdtPolygonWallet':_0x5aa33d[_0x54b3e5(0x1a2)],'usdtTrcWallet':_0x5aa33d['usdtTrcWallet'],'usdtErcWallet':_0x5aa33d[_0x54b3e5(0x224)],'usdcPolygonWallet':_0x5aa33d[_0x54b3e5(0x243)]},'status':_0x5aa33d['status'],'createdAt':_0x5aa33d[_0x54b3e5(0x190)]};}async[a36_0x355f44(0x193)](_0x2c7dc4){const _0x57abb8=a36_0x355f44;await database_1[_0x57abb8(0x292)][_0x57abb8(0x2aa)][_0x57abb8(0x1bb)]({'where':{'id':_0x2c7dc4}});}[a36_0x355f44(0x1f1)](_0x419627,_0x28594d,_0xd20b95){const _0x5ac933=a36_0x355f44,_0xf032e1=new Map(),_0x272022=new Date(_0x28594d);while(_0x272022<=_0xd20b95){const _0x3b7b20=_0x272022[_0x5ac933(0x246)]()[_0x5ac933(0x270)]('T')[0x0];_0xf032e1[_0x5ac933(0x283)](_0x3b7b20,{'revenue':0x0,'count':0x0}),_0x272022['setDate'](_0x272022['getDate']()+0x1);}for(const _0x354cc5 of _0x419627){const _0x5f64ce=_0x354cc5[_0x5ac933(0x190)][_0x5ac933(0x246)]()[_0x5ac933(0x270)]('T')[0x0],_0x56dcd2=_0xf032e1[_0x5ac933(0x289)](_0x5f64ce);_0x56dcd2&&(_0x56dcd2[_0x5ac933(0x290)]+=0x1,_0x354cc5[_0x5ac933(0x1ac)]==='PAID'&&(_0x354cc5[_0x5ac933(0x1ab)]?_0x56dcd2[_0x5ac933(0x261)]+=_0x354cc5['amountUSDT']:console[_0x5ac933(0x263)](_0x5ac933(0x1b1)+_0x354cc5['id']+_0x5ac933(0x266))));}const _0x1e71ad=[],_0x1c7d99=[];for(const [_0x3fb14b,_0x391e52]of _0xf032e1){_0x1e71ad[_0x5ac933(0x1fb)]({'date':_0x3fb14b,'amount':Math[_0x5ac933(0x189)](_0x391e52[_0x5ac933(0x261)]*0x64)/0x64}),_0x1c7d99['push']({'date':_0x3fb14b,'count':_0x391e52['count']});}return{'dailyRevenue':_0x1e71ad,'dailyPayments':_0x1c7d99};}}exports[a36_0x355f44(0x233)]=AdminService;