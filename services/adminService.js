'use strict';const a40_0x28ffbb=a40_0x4f9d;function a40_0x1e66(){const _0x2f87f6=['📊\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20','updatePaymentStatus','\x20\x20\x20Transaction\x20hash:\x20','usdtErcWallet','🔍\x20Selected\x20polygon_usdc\x20wallet:\x20','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','deleteUser','\x20USDT\x20(already\x20paid\x20out)','totalPayout','%\x20commission)','averageCheckUSDT','\x20paid\x20payments\x20for\x20analysis','default','51564uIXRbv','🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','💰\x20Current\x20shop\x20balance:\x20','groupBy','CoinToPay','✅\x20Payout\x20created\x20in\x20DB:','delete','\x27\x20->\x20ID\x20\x27','\x20\x20\x20Current\x20balance:\x20','\x20USDT,\x20Requested:\x20','sk_','activateUser','rapyd','chargebackAmount','password','🔍\x20Creating\x20payout\x20with\x20data:','totalAmountAfterCommissionUSDT','getGatewayInternalName','asc','679nHfBDl','randomBytes','periodFrom','split','statusChangedBy','\x20\x20\x20Difference:\x20','commission','availableBalance','\x20USDT\x20(total\x20paid\x20to\x20merchants)','Rapyd','klyme_de','🔍\x20Selected\x20erc20\x20wallet:\x20','totalAmountUSDT','getMerchantStatistics','🔍\x20No\x20wallet\x20provided,\x20looking\x20up\x20from\x20shop\x20settings...','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','hex','🔍\x20Balance\x20check\x20details:','map','desc','substr',',\x20Commission:\x20','Insufficient\x20balance.\x20Available:\x20','warn','count','💰\x20Shop\x20','\x20\x20\x20✅\x20Total\x20net\x20balances:\x20','amountUSDT','__importDefault',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','MasterCard','\x20\x20\x20Gateway:\x20','createUser','\x20\x20\x20💸\x20Total\x20payouts:\x20','txid','erc20','push','getTime','Shop\x20not\x20found','\x20USDT\x20(rounded\x20to\x202\x20decimal\x20places)','admin','failureMessage',',\x20refunds:\x20','\x20\x20\x20🖥️\x20User\x20Agent:\x20','\x20\x20\x20Full\x20amount:\x20','💸\x20CHARGEBACK\x20penalty\x20ONLY:\x20-','get','1990338iidxkP','toString','\x20USDT\x20(gross\x20revenue)','\x27\x20to\x20name\x20\x27','aggregate','getGatewayNameById','findMany','values','📱\x20Telegram\x20notification\x20sent\x20for\x20payout\x20','Username\x20already\x20exists','usdcPolygonWallet','paymentGateways','\x20\x20\x20💵\x20Available\x20balance:\x20','shopId','🔄\x20Gateway\x20mapping:','week','localeCompare','Open\x20Banking\x202','ACTIVE','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','usdcErcWallet','network','✅\x20Payout\x20created:\x20','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','pendingUrl','\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...','totalCommissionRate','convertToUSDT','\x20\x20\x20Balance:\x20','📋\x20Found\x20','username','name','📋\x20Getting\x20merchants\x20selection\x20list...','wallets','month','⚠️\x20CHARGEBACK\x20without\x20penalty\x20amount\x20-\x20no\x20balance\x20change','thisMonth','📊\x20Gateway\x20filter\x20applied:','./currencyService','payout','date','setDate','\x20USDT,\x20merchant:\x20','deletePayout','_count','defineProperty','🔄\x20Gateway\x20mapping\x20(create):','\x20\x20\x20💰\x20Total\x20turnover:\x20','usdtPolygonWallet','\x20USDT\x20(after\x20','toISOString','getMonth','klyme_gb','Error\x20processing\x20payment\x20','toUpperCase','entries','orderId','KLYME\x20GB','Payment\x20not\x20found','klyme_eu','notes','\x20\x20\x20💸\x20Total\x20payouts\x20(all\x20time):\x20','customerName','customerIp','\x20\x20\x20Merchant\x20loses:\x20','../config/database','period','\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)','forEach','getAllUsers','\x20USDT\x20for\x20payment\x20','💰\x20Found\x20','\x20\x20\x20�\x20Total\x20paid\x20out:\x20','✅\x20Using\x20wallet\x20from\x20request:\x20','90d','\x20\x20\x20�📊\x20Total\x20payments:\x20','merchantEarningsUSDT','./telegramBotService','trc20','gatewayCommissionRate','🔍\x20Shop\x20wallets:','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','\x20USDT\x20from\x20balance','getPayoutById','createdAt','customerEmail','💳\x20Final\x20payout\x20wallet\x20for\x20','\x20\x20\x20🌐\x20IP:\x20','📅\x20Payout\x20date\x20from\x20filter:\x20','📊\x20Using\x20saved\x20values\x20for\x20payment\x20','📊\x20Getting\x20payments\x20with\x20filters:','year','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','suspendUser','REFUND','revenue','\x20\x20\x20💰\x20Total\x20payout:\x20','successUrl',':\x20commission\x20=\x20','not\x20set','🔍\x20Using\x20gateway\x20\x27','\x20\x20\x20🤔\x20Difference:\x20','\x20with\x20payout\x20history','\x20balance\x20updated:','day','gatewayEarnings','telegramId','🔧\x20[','amount','📊\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','📊\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','status','turnover','🔄\x20Converted\x20gateway\x20ID\x20\x27','\x20\x20\x20💰\x20Total\x20payments\x20turnover:\x20','fullName','sendPayoutNotification','totalPayments','set','pk_','\x20\x20\x20🔍\x20Calculated\x20after\x20commission:\x20','wallet','erc20_usdc','../types/gateway',']\x20Updating\x20password\x20for\x20user\x20','\x20\x20\x20Merchant\x20gets:\x20','sort','commissionUSDT','plisio','📅\x20Payout\x20date\x20to\x20filter:\x20','totalPaidOut','0000','Noda','🔄\x20Admin\x20updating\x20payment\x20','📅\x20Date\x20from\x20filter:\x20','AdminService','failUrl','\x20->\x20','polygon','test_gateway','getFullYear','hash','985rPsgHU','gte','crypto','amountAfterCommissionUSDT','merchantEarnings','dailyPayments','customerUa','paidAt','insensitive','gatewaySettings','telegram','$transaction',',\x20chargebacks:\x20','length','📊\x20Final\x20WHERE\x20conditions:','awaitingPayout','whiteUrl','round','getMerchantsSelection','\x20\x20\x20Total\x20paid\x20out:\x20','paymentsCount','%\x20from\x20','merchantUrl','some','cointopay','random','stringify','\x20USDT\x20(same\x20as\x20awaiting)','log','Telegram\x20username\x20already\x20exists','\x20\x20\x20Requested\x20(number):\x20','parse',',\x20successful:\x20','🔍\x20Selected\x20polygon\x20wallet:\x20','🔐\x20[','\x20USDT\x20(-','dateTo','customerCountry','periodTo','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','\x20to\x20','95624GssAUf','lte','232815lEyEbD','⚠️\x20Payment\x20','\x20\x20\x20Added\x20to\x20balance:\x20+','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','💰\x20[PAYOUT]\x20Gateway\x20','Plisio','PAID','\x27\x20(from\x20\x27','pendingPayout','publicKey','\x20became\x20PAID:','5511240eTmryC','COMPLETED','🔍\x20Selected\x20erc20_usdc\x20wallet:\x20','createPayout','\x20\x20\x20�\x20Total\x20payments\x20turnover:\x20','✅\x20Balance\x20check\x20passed\x20(with\x20tolerance)','📊\x20Calculated\x20commission\x20rate\x20for\x20payment\x20','getDate','\x20USDT\x20(+','getAllPayments','turnoverUSDT','Не\x20указан','\x20in\x20','all','toLowerCase','\x20USDT','445397ipabah','balance','NONEXISTENT_GATEWAY_FILTER','includes','getGatewayIdByName','getPayoutStats','update','ceil','updateCustomerData','_sum','📊\x20Merchants\x20with\x20rounded\x20balance\x20!=\x200.00:\x20','__esModule','adminNotes','error','generateDailyStatistics','ru-RU','statusChangedAt','KLYME\x20EU','PENDING','telegramBotService','📊\x20Sorting\x20payments\x20by\x20','📊\x20Calculating\x20payout\x20statistics...','toFixed','\x20\x20\x20⏳\x20Pending\x20payout:\x20','usdtTrcWallet','\x20USDT\x20(current\x20balance\x20in\x20DB)','📊\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','🔄\x20Converted\x20gateway\x20name\x20\x27','amountAfterGatewayCommissionUSDT','\x20USDT,\x20Difference:\x20','trim','findFirst','📊\x20Merchant\x20statistics\x20calculated:','gateway','join','Test\x20Gateway','shopUrl','💱\x20Currency\x20filter\x20applied:\x20','reduce','\x20payments)','\x20\x20\x20Payout\x20amount:\x20','dateFrom','\x20merchants','shop','findUnique','\x20\x20\x20Tolerance:\x20','gateways','\x20USDT\x20(','gatewayOrderId','create','12859416Heyxkm','noda','currency',']\x20Gateway\x20settings\x20before\x20saving:','✅\x20Using\x20gateway\x20filter:\x20\x27','CHARGEBACK','getMerchantsAwaitingPayout','\x20status:\x20','yesterday','🎯\x20[','getAllPayouts','updatedAt','custom','getGatewayDisplayName','currencyService','📅\x20Period:\x20','💰\x20[PAYOUT]\x20Merchant\x20','📊\x20Available\x20gateways\x20in\x20database:','payment','52PvVNPN','averageCommissionRate',']\x20Gateway\x20settings\x20JSON\x20string:','setHours','\x20\x20\x20✅\x20Actual\x20available\x20balance:\x20'];a40_0x1e66=function(){return _0x2f87f6;};return a40_0x1e66();}(function(_0x5a019f,_0x6dffe1){const _0x5af12e=a40_0x4f9d,_0x128c44=_0x5a019f();while(!![]){try{const _0x133d53=-parseInt(_0x5af12e(0x229))/0x1+parseInt(_0x5af12e(0x2c2))/0x2+parseInt(_0x5af12e(0x20e))/0x3*(-parseInt(_0x5af12e(0x26e))/0x4)+-parseInt(_0x5af12e(0x1e3))/0x5*(-parseInt(_0x5af12e(0x280))/0x6)+-parseInt(_0x5af12e(0x293))/0x7*(parseInt(_0x5af12e(0x20c))/0x8)+parseInt(_0x5af12e(0x25b))/0x9+-parseInt(_0x5af12e(0x219))/0xa;if(_0x133d53===_0x6dffe1)break;else _0x128c44['push'](_0x128c44['shift']());}catch(_0x1a3e67){_0x128c44['push'](_0x128c44['shift']());}}}(a40_0x1e66,0xe8778));var __importDefault=this&&this[a40_0x28ffbb(0x2af)]||function(_0x3e8bef){const _0x120e6b=a40_0x28ffbb;return _0x3e8bef&&_0x3e8bef[_0x120e6b(0x234)]?_0x3e8bef:{'default':_0x3e8bef};};function a40_0x4f9d(_0x2ca637,_0x1824e4){const _0x1e6600=a40_0x1e66();return a40_0x4f9d=function(_0x4f9d80,_0x1bc3f7){_0x4f9d80=_0x4f9d80-0x19d;let _0x157d0b=_0x1e6600[_0x4f9d80];return _0x157d0b;},a40_0x4f9d(_0x2ca637,_0x1824e4);}Object[a40_0x28ffbb(0x2ef)](exports,a40_0x28ffbb(0x234),{'value':!![]}),exports['AdminService']=void 0x0;const database_1=__importDefault(require(a40_0x28ffbb(0x303))),bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a40_0x28ffbb(0x1e5))),currencyService_1=require(a40_0x28ffbb(0x2e8)),telegramBotService_1=require(a40_0x28ffbb(0x1a2)),gateway_1=require(a40_0x28ffbb(0x1d0));class AdminService{async[a40_0x28ffbb(0x22e)](){const _0x3fc309=a40_0x28ffbb;console[_0x3fc309(0x1ff)](_0x3fc309(0x23e));const _0x4f61e2=await database_1[_0x3fc309(0x27f)]['shop'][_0x3fc309(0x2c6)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x3fc309(0x2d4)}}),_0x11ea9a=await database_1[_0x3fc309(0x27f)][_0x3fc309(0x26d)][_0x3fc309(0x2ab)]({'where':{'status':_0x3fc309(0x214),'gateway':{'not':_0x3fc309(0x1e0)}}}),_0x3f7344=new Date(),_0x24eb49=new Date(_0x3f7344[_0x3fc309(0x1e1)](),_0x3f7344['getMonth'](),0x1),_0x2f44a9=new Date(_0x3f7344['getFullYear'](),_0x3f7344[_0x3fc309(0x2f5)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x269064=await database_1[_0x3fc309(0x27f)][_0x3fc309(0x2e9)][_0x3fc309(0x2c6)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x24eb49,'lte':_0x2f44a9},'status':_0x3fc309(0x21a)}}),_0x525bd0=_0x4f61e2['_sum'][_0x3fc309(0x1d7)]||0x0,_0x20a7d4=_0x4f61e2[_0x3fc309(0x232)][_0x3fc309(0x22a)]||0x0,_0x3ec3fa=_0x269064[_0x3fc309(0x232)][_0x3fc309(0x1c1)]||0x0,_0x34d148={'totalPayout':Math['round'](_0x525bd0*0x64)/0x64,'awaitingPayout':Math[_0x3fc309(0x1f4)](_0x20a7d4*0x64)/0x64,'thisMonth':Math['round'](_0x3ec3fa*0x64)/0x64,'availableBalance':Math['round'](_0x20a7d4*0x64)/0x64,'totalPayments':_0x11ea9a};return console[_0x3fc309(0x1ff)]('📊\x20Payout\x20statistics\x20calculated:'),console['log'](_0x3fc309(0x1b5)+_0x34d148[_0x3fc309(0x27b)]+_0x3fc309(0x29b)),console[_0x3fc309(0x1ff)]('\x20\x20\x20⏳\x20Awaiting\x20payout:\x20'+_0x34d148[_0x3fc309(0x1f2)]+_0x3fc309(0x305)),console[_0x3fc309(0x1ff)](_0x3fc309(0x2ce)+_0x34d148[_0x3fc309(0x29a)]+_0x3fc309(0x1fe)),console[_0x3fc309(0x1ff)]('\x20\x20\x20📅\x20This\x20month:\x20'+_0x34d148['thisMonth']+_0x3fc309(0x228)),console[_0x3fc309(0x1ff)]('\x20\x20\x20💳\x20Total\x20payments:\x20'+_0x34d148[_0x3fc309(0x1ca)]+'\x20PAID\x20payments'),_0x34d148;}async[a40_0x28ffbb(0x231)](_0xd67900,_0xc541f0){const _0x3fdf46=a40_0x28ffbb;console[_0x3fdf46(0x1ff)](_0x3fdf46(0x278)+_0xd67900+':',_0xc541f0);const _0x2f4e1d=await database_1[_0x3fdf46(0x27f)]['payment']['findUnique']({'where':{'id':_0xd67900},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x2f4e1d)throw new Error(_0x3fdf46(0x2fc));const _0x27a868={};_0xc541f0['customerCountry']!==undefined&&(_0x27a868[_0x3fdf46(0x208)]=_0xc541f0[_0x3fdf46(0x208)]||null);_0xc541f0[_0x3fdf46(0x301)]!==undefined&&(_0x27a868[_0x3fdf46(0x301)]=_0xc541f0[_0x3fdf46(0x301)]||null);_0xc541f0['customerUa']!==undefined&&(_0x27a868[_0x3fdf46(0x1e9)]=_0xc541f0[_0x3fdf46(0x1e9)]||null);const _0x251032=await database_1[_0x3fdf46(0x27f)]['payment']['update']({'where':{'id':_0xd67900},'data':{..._0x27a868,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console['log']('✅\x20Customer\x20data\x20updated\x20for\x20payment\x20'+_0xd67900),console[_0x3fdf46(0x1ff)]('\x20\x20\x20🌍\x20Country:\x20'+_0x2f4e1d[_0x3fdf46(0x208)]+_0x3fdf46(0x1de)+_0x251032[_0x3fdf46(0x208)]),console[_0x3fdf46(0x1ff)](_0x3fdf46(0x1ac)+_0x2f4e1d[_0x3fdf46(0x301)]+'\x20->\x20'+_0x251032[_0x3fdf46(0x301)]),console[_0x3fdf46(0x1ff)](_0x3fdf46(0x2be)+(_0x2f4e1d[_0x3fdf46(0x1e9)]?_0x3fdf46(0x1cb):_0x3fdf46(0x1b8))+_0x3fdf46(0x1de)+(_0x251032[_0x3fdf46(0x1e9)]?'set':'not\x20set')),_0x251032;}async['getSystemStatistics'](_0x51d6fe){const _0x5324ec=a40_0x28ffbb,_0xd6cb5d=new Date();let _0x5eee1c;switch(_0x51d6fe[_0x5324ec(0x227)]()){case _0x5324ec(0x1bd):_0x5eee1c=new Date(_0xd6cb5d[_0x5324ec(0x1e1)](),_0xd6cb5d[_0x5324ec(0x2f5)](),_0xd6cb5d[_0x5324ec(0x220)](),0x0,0x0,0x0,0x0);break;case _0x5324ec(0x263):const _0x450752=new Date(_0xd6cb5d);_0x450752[_0x5324ec(0x2eb)](_0x450752[_0x5324ec(0x220)]()-0x1),_0x5eee1c=new Date(_0x450752[_0x5324ec(0x1e1)](),_0x450752[_0x5324ec(0x2f5)](),_0x450752['getDate'](),0x0,0x0,0x0,0x0);break;case'7d':_0x5eee1c=new Date(_0xd6cb5d[_0x5324ec(0x2b8)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x5eee1c=new Date(_0xd6cb5d['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x5324ec(0x19f):_0x5eee1c=new Date(_0xd6cb5d[_0x5324ec(0x2b8)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x5324ec(0x226):const _0x14376c=await database_1[_0x5324ec(0x27f)][_0x5324ec(0x26d)]['findFirst']({'where':{'gateway':{'not':'test_gateway'}},'orderBy':{'createdAt':'asc'},'select':{'createdAt':!![]}});_0x5eee1c=_0x14376c?_0x14376c['createdAt']:new Date('2020-01-01');break;default:_0x5eee1c=new Date(_0xd6cb5d[_0x5324ec(0x2b8)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}_0x5eee1c[_0x5324ec(0x271)](0x0,0x0,0x0,0x0);let _0x4403c2;if(_0x51d6fe[_0x5324ec(0x227)]()===_0x5324ec(0x263)){const _0x58d690=new Date(_0xd6cb5d);_0x58d690['setDate'](_0x58d690[_0x5324ec(0x220)]()-0x1),_0x4403c2=new Date(_0x58d690[_0x5324ec(0x1e1)](),_0x58d690[_0x5324ec(0x2f5)](),_0x58d690['getDate'](),0x17,0x3b,0x3b,0x3e7);}const _0x3b486b={'gte':_0x5eee1c};_0x4403c2&&(_0x3b486b['lte']=_0x4403c2);const [_0x5e8bf9,_0x5c1633,_0x24590a,_0x1b511e,_0x5d2603,_0x38b91d]=await Promise[_0x5324ec(0x226)]([database_1['default'][_0x5324ec(0x254)][_0x5324ec(0x2ab)](),database_1[_0x5324ec(0x27f)][_0x5324ec(0x254)][_0x5324ec(0x2ab)]({'where':{'status':_0x5324ec(0x2d4)}}),database_1[_0x5324ec(0x27f)]['payment'][_0x5324ec(0x2ab)]({'where':{'status':_0x5324ec(0x214),'createdAt':_0x3b486b,'gateway':{'not':'test_gateway'}}}),database_1[_0x5324ec(0x27f)][_0x5324ec(0x26d)][_0x5324ec(0x2c8)]({'where':{'status':_0x5324ec(0x214),'createdAt':_0x3b486b,'gateway':{'not':_0x5324ec(0x1e0)}},'select':{'amount':!![],'currency':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1['default'][_0x5324ec(0x26d)][_0x5324ec(0x2c8)]({'where':{'gateway':{'not':_0x5324ec(0x1e0)}},'take':0xa,'orderBy':{'createdAt':_0x5324ec(0x2a6)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x5324ec(0x27f)]['payment'][_0x5324ec(0x2c8)]({'where':{'createdAt':_0x3b486b,'gateway':{'not':_0x5324ec(0x1e0)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x34616b=0x0,_0xe04d43=0x0;for(const _0x2c804a of _0x1b511e){const _0x36dd50=await currencyService_1[_0x5324ec(0x269)][_0x5324ec(0x2dd)](_0x2c804a[_0x5324ec(0x1c1)],_0x2c804a['currency']);_0x34616b+=_0x36dd50;if(_0x2c804a['amountAfterGatewayCommissionUSDT']){const _0x3f434f=await currencyService_1[_0x5324ec(0x269)][_0x5324ec(0x2dd)](_0x2c804a['amount'],_0x2c804a['currency']),_0x188590=_0x2c804a['amountAfterGatewayCommissionUSDT'],_0x4ce4a1=_0x3f434f-_0x188590;_0xe04d43+=_0x4ce4a1;}}const _0x3705b7=_0x24590a>0x0?_0x34616b/_0x24590a:0x0,_0x555a90=this[_0x5324ec(0x237)](_0x38b91d,_0x5eee1c,_0x4403c2||_0xd6cb5d),_0x12a9c6=await database_1['default'][_0x5324ec(0x26d)][_0x5324ec(0x2ab)]({'where':{'createdAt':_0x3b486b,'gateway':{'not':'test_gateway'}}}),_0x1a8d13=_0x12a9c6>0x0?_0x24590a/_0x12a9c6*0x64:0x0;return{'totalShops':_0x5e8bf9,'activeShops':_0x5c1633,'totalPayments':_0x24590a,'successfulPayments':_0x24590a,'totalAttempts':_0x12a9c6,'totalRevenue':Math[_0x5324ec(0x1f4)](_0x34616b*0x64)/0x64,'trapayEarnings':Math['round'](_0xe04d43*0x64)/0x64,'averagePaymentAmount':Math['round'](_0x3705b7*0x64)/0x64,'conversionRate':Math[_0x5324ec(0x1f4)](_0x1a8d13*0x64)/0x64,'dailyRevenue':_0x555a90['dailyRevenue'],'dailyPayments':_0x555a90[_0x5324ec(0x1e8)],'recentPayments':_0x5d2603[_0x5324ec(0x2a5)](_0x20be60=>({'id':_0x20be60['id'],'amount':_0x20be60['amount'],'currency':_0x20be60['currency'],'status':_0x20be60[_0x5324ec(0x1c4)],'gateway':_0x20be60[_0x5324ec(0x24a)],'shop':_0x20be60['shop'],'createdAt':_0x20be60[_0x5324ec(0x1a9)]}))};}async[a40_0x28ffbb(0x2a0)](_0x2329ca){const _0x512457=a40_0x28ffbb;console[_0x512457(0x1ff)](_0x512457(0x2d5),_0x2329ca);let _0x18d5a8,_0x1f4ddf=new Date();if(_0x2329ca['period']===_0x512457(0x267)&&_0x2329ca[_0x512457(0x252)]&&_0x2329ca[_0x512457(0x207)])_0x18d5a8=new Date(_0x2329ca[_0x512457(0x252)]),_0x1f4ddf=new Date(_0x2329ca['dateTo']),_0x18d5a8['setHours'](0x0,0x0,0x0,0x0),_0x1f4ddf[_0x512457(0x271)](0x17,0x3b,0x3b,0x3e7);else{const _0x3a6446=new Date();switch(_0x2329ca[_0x512457(0x304)]){case _0x512457(0x2d1):_0x18d5a8=new Date(_0x3a6446[_0x512457(0x2b8)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x512457(0x2e4):_0x18d5a8=new Date(_0x3a6446['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x512457(0x1b0):_0x18d5a8=new Date(_0x3a6446[_0x512457(0x2b8)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x512457(0x226):default:_0x18d5a8=new Date('2020-01-01');break;}_0x18d5a8['setHours'](0x0,0x0,0x0,0x0),_0x1f4ddf['setHours'](0x17,0x3b,0x3b,0x3e7);}console[_0x512457(0x1ff)](_0x512457(0x26a)+_0x18d5a8[_0x512457(0x2f4)]()+_0x512457(0x20b)+_0x1f4ddf['toISOString']());const _0x2337e1={'status':_0x512457(0x214),'gateway':{'not':_0x512457(0x1e0)},'paidAt':{'gte':_0x18d5a8,'lte':_0x1f4ddf}};_0x2329ca[_0x512457(0x2cf)]&&(_0x2337e1[_0x512457(0x2cf)]=_0x2329ca[_0x512457(0x2cf)]);const _0x27a3a5=await database_1[_0x512457(0x27f)][_0x512457(0x26d)][_0x512457(0x2c8)]({'where':_0x2337e1,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x512457(0x1ff)](_0x512457(0x309)+_0x27a3a5[_0x512457(0x1f0)]+_0x512457(0x27e));const _0x4c7817={'gateway':{'not':_0x512457(0x1e0)},'createdAt':{'gte':_0x18d5a8,'lte':_0x1f4ddf}};_0x2329ca[_0x512457(0x2cf)]&&(_0x4c7817[_0x512457(0x2cf)]=_0x2329ca['shopId']);const _0x52c6fa=await database_1[_0x512457(0x27f)]['payment'][_0x512457(0x2ab)]({'where':_0x4c7817}),_0x42c43a={..._0x4c7817,'status':_0x512457(0x260)},_0x20624b={..._0x4c7817,'status':_0x512457(0x1b3)},[_0x1a8be2,_0x52e58f]=await Promise['all']([database_1[_0x512457(0x27f)][_0x512457(0x26d)]['count']({'where':_0x42c43a}),database_1[_0x512457(0x27f)][_0x512457(0x26d)]['count']({'where':_0x20624b})]);console[_0x512457(0x1ff)]('📊\x20Total\x20payments\x20(including\x20failed):\x20'+_0x52c6fa+_0x512457(0x203)+_0x27a3a5[_0x512457(0x1f0)]+_0x512457(0x1ef)+_0x1a8be2+_0x512457(0x2bd)+_0x52e58f);let _0x48557b=0x0,_0x41c383=0x0,_0x315ed4=0x0;const _0x2a697a={},_0x13bb87={},_0x53fdd1={};for(const _0x24a0fd of _0x27a3a5){try{const _0x4b3b15=_0x24a0fd[_0x512457(0x2ae)]||0x0;if(_0x4b3b15<=0x0){console[_0x512457(0x2aa)](_0x512457(0x20f)+_0x24a0fd['id']+_0x512457(0x2db));continue;}let _0x2ce0f7,_0x56848b;if(_0x24a0fd[_0x512457(0x245)]!==null&&_0x24a0fd[_0x512457(0x245)]!==undefined)_0x2ce0f7=_0x24a0fd[_0x512457(0x245)],_0x56848b=_0x4b3b15-_0x2ce0f7,console[_0x512457(0x1ff)](_0x512457(0x1ae)+_0x24a0fd['id']+':\x20'+_0x4b3b15[_0x512457(0x23f)](0x6)+_0x512457(0x2ec)+_0x2ce0f7['toFixed'](0x6)+_0x512457(0x228));else{let _0x327716={};if(_0x24a0fd['shop'][_0x512457(0x1ec)])try{_0x327716=JSON[_0x512457(0x202)](_0x24a0fd[_0x512457(0x254)][_0x512457(0x1ec)]);}catch(_0xbc8811){console[_0x512457(0x236)]('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x24a0fd['shopId']+':',_0xbc8811);}let _0x344cf6=0x2d;for(const [_0x351526,_0x5c6b20]of Object[_0x512457(0x2f9)](_0x327716)){if(_0x351526['toLowerCase']()===_0x24a0fd[_0x512457(0x24a)][_0x512457(0x227)]()){_0x344cf6=_0x5c6b20['commission']||0x2d;break;}}_0x56848b=_0x4b3b15*(_0x344cf6/0x64),_0x2ce0f7=_0x4b3b15-_0x56848b,console[_0x512457(0x1ff)](_0x512457(0x243)+_0x24a0fd['id']+':\x20'+_0x344cf6+_0x512457(0x1f8)+_0x4b3b15[_0x512457(0x23f)](0x6)+'\x20USDT');}_0x48557b+=_0x4b3b15,_0x41c383+=_0x2ce0f7,_0x315ed4+=_0x56848b;let _0x1c23c5;_0x24a0fd[_0x512457(0x1a4)]!==null&&_0x24a0fd['gatewayCommissionRate']!==undefined?(_0x1c23c5=_0x24a0fd[_0x512457(0x1a4)],console[_0x512457(0x1ff)](_0x512457(0x273)+_0x24a0fd['id']+':\x20'+_0x1c23c5+'%')):(_0x1c23c5=_0x4b3b15>0x0?_0x56848b/_0x4b3b15*0x64:0x0,console['log'](_0x512457(0x21f)+_0x24a0fd['id']+':\x20'+_0x1c23c5[_0x512457(0x23f)](0x2)+'%'));!_0x2a697a[_0x24a0fd[_0x512457(0x24a)]]&&(_0x2a697a[_0x24a0fd[_0x512457(0x24a)]]={'gateway':_0x24a0fd['gateway'],'gatewayDisplayName':this[_0x512457(0x268)](_0x24a0fd[_0x512457(0x24a)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x2a697a[_0x24a0fd[_0x512457(0x24a)]]['paymentsCount']++,_0x2a697a[_0x24a0fd[_0x512457(0x24a)]][_0x512457(0x223)]+=_0x4b3b15,_0x2a697a[_0x24a0fd[_0x512457(0x24a)]][_0x512457(0x1d4)]+=_0x56848b,_0x2a697a[_0x24a0fd[_0x512457(0x24a)]][_0x512457(0x1a1)]+=_0x2ce0f7,_0x2a697a[_0x24a0fd[_0x512457(0x24a)]]['totalCommissionRate']+=_0x1c23c5;!_0x2329ca[_0x512457(0x2cf)]&&(!_0x13bb87[_0x24a0fd['shopId']]&&(_0x13bb87[_0x24a0fd[_0x512457(0x2cf)]]={'shopId':_0x24a0fd[_0x512457(0x2cf)],'shopName':_0x24a0fd[_0x512457(0x254)][_0x512457(0x2e1)],'shopUsername':_0x24a0fd[_0x512457(0x254)][_0x512457(0x2e0)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x13bb87[_0x24a0fd[_0x512457(0x2cf)]][_0x512457(0x1f7)]++,_0x13bb87[_0x24a0fd[_0x512457(0x2cf)]][_0x512457(0x223)]+=_0x4b3b15,_0x13bb87[_0x24a0fd['shopId']]['commissionUSDT']+=_0x56848b,_0x13bb87[_0x24a0fd['shopId']][_0x512457(0x1a1)]+=_0x2ce0f7);const _0x2ab288=_0x24a0fd[_0x512457(0x1ea)]['toISOString']()['split']('T')[0x0];!_0x53fdd1[_0x2ab288]&&(_0x53fdd1[_0x2ab288]={'date':_0x2ab288,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x53fdd1[_0x2ab288][_0x512457(0x1c5)]+=_0x4b3b15,_0x53fdd1[_0x2ab288][_0x512457(0x1e7)]+=_0x2ce0f7,_0x53fdd1[_0x2ab288]['gatewayEarnings']+=_0x56848b,_0x53fdd1[_0x2ab288]['paymentsCount']++;}catch(_0x25b236){console[_0x512457(0x236)](_0x512457(0x2f7)+_0x24a0fd['id']+':',_0x25b236);}}Object[_0x512457(0x2c9)](_0x2a697a)['forEach'](_0x2237aa=>{const _0xe1c40=_0x512457;_0x2237aa[_0xe1c40(0x26f)]=_0x2237aa[_0xe1c40(0x1f7)]>0x0?_0x2237aa[_0xe1c40(0x2dc)]/_0x2237aa['paymentsCount']:0x0,delete _0x2237aa['totalCommissionRate'];}),Object[_0x512457(0x2c9)](_0x13bb87)[_0x512457(0x306)](_0x2e45b8=>{const _0x8607f6=_0x512457;_0x2e45b8[_0x8607f6(0x27d)]=_0x2e45b8[_0x8607f6(0x1f7)]>0x0?_0x2e45b8['turnoverUSDT']/_0x2e45b8[_0x8607f6(0x1f7)]:0x0;});let _0x278262=0x0,_0x3c8883=0x0;if(_0x2329ca['shopId']){const _0x407c59=await database_1[_0x512457(0x27f)][_0x512457(0x2e9)][_0x512457(0x2c8)]({'where':{'shopId':_0x2329ca['shopId'],'status':'COMPLETED','createdAt':{'gte':_0x18d5a8,'lte':_0x1f4ddf}},'select':{'amount':!![]}});_0x278262=_0x407c59['reduce']((_0x35f702,_0x32d1e1)=>_0x35f702+_0x32d1e1[_0x512457(0x1c1)],0x0);const _0x2ff783=await database_1['default'][_0x512457(0x2e9)][_0x512457(0x2c8)]({'where':{'shopId':_0x2329ca[_0x512457(0x2cf)],'status':_0x512457(0x23b),'createdAt':{'gte':_0x18d5a8,'lte':_0x1f4ddf}},'select':{'amount':!![]}});_0x3c8883=_0x2ff783[_0x512457(0x24f)]((_0x345595,_0x21e517)=>_0x345595+_0x21e517[_0x512457(0x1c1)],0x0);}const _0x21ba8f=_0x52c6fa,_0x4b3852=_0x27a3a5[_0x512457(0x1f0)],_0x559573=_0x4b3852>0x0?_0x48557b/_0x4b3852:0x0,_0x3bc6bf=_0x21ba8f>0x0?Math[_0x512457(0x1f4)](_0x4b3852/_0x21ba8f*0x2710)/0x64:0x0,_0x47225a=Math['ceil']((_0x1f4ddf[_0x512457(0x2b8)]()-_0x18d5a8[_0x512457(0x2b8)]())/(0x3e8*0x3c*0x3c*0x18)),_0x233e00={'totalTurnover':Math['round'](_0x48557b*0x64)/0x64,'merchantEarnings':Math[_0x512457(0x1f4)](_0x41c383*0x64)/0x64,'gatewayEarnings':Math[_0x512457(0x1f4)](_0x315ed4*0x64)/0x64,'totalPaidOut':Math[_0x512457(0x1f4)](_0x278262*0x64)/0x64,'pendingPayout':Math['round'](_0x3c8883*0x64)/0x64,'averageCheck':Math[_0x512457(0x1f4)](_0x559573*0x64)/0x64,'totalPayments':_0x21ba8f,'successfulPayments':_0x4b3852,'conversionRate':_0x3bc6bf,'chargebacks':_0x1a8be2,'refunds':_0x52e58f,'gatewayBreakdown':Object[_0x512457(0x2c9)](_0x2a697a)[_0x512457(0x2a5)](_0x2d2ff5=>({..._0x2d2ff5,'turnoverUSDT':Math['round'](_0x2d2ff5[_0x512457(0x223)]*0x64)/0x64,'commissionUSDT':Math[_0x512457(0x1f4)](_0x2d2ff5[_0x512457(0x1d4)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x2d2ff5[_0x512457(0x1a1)]*0x64)/0x64,'averageCommissionRate':Math[_0x512457(0x1f4)](_0x2d2ff5[_0x512457(0x26f)]*0x64)/0x64})),'merchantBreakdown':_0x2329ca[_0x512457(0x2cf)]?undefined:Object[_0x512457(0x2c9)](_0x13bb87)['map'](_0x342a87=>({..._0x342a87,'turnoverUSDT':Math['round'](_0x342a87[_0x512457(0x223)]*0x64)/0x64,'commissionUSDT':Math[_0x512457(0x1f4)](_0x342a87[_0x512457(0x1d4)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x512457(0x1f4)](_0x342a87[_0x512457(0x1a1)]*0x64)/0x64,'paidOutUSDT':Math['round'](_0x342a87['paidOutUSDT']*0x64)/0x64,'averageCheckUSDT':Math[_0x512457(0x1f4)](_0x342a87[_0x512457(0x27d)]*0x64)/0x64})),'dailyData':Object[_0x512457(0x2c9)](_0x53fdd1)['map'](_0x5ae8bf=>({..._0x5ae8bf,'turnover':Math['round'](_0x5ae8bf[_0x512457(0x1c5)]*0x64)/0x64,'merchantEarnings':Math['round'](_0x5ae8bf['merchantEarnings']*0x64)/0x64,'gatewayEarnings':Math[_0x512457(0x1f4)](_0x5ae8bf['gatewayEarnings']*0x64)/0x64}))[_0x512457(0x1d3)]((_0x4f069a,_0x233cf9)=>_0x4f069a[_0x512457(0x2ea)][_0x512457(0x2d2)](_0x233cf9['date'])),'periodInfo':{'from':_0x18d5a8,'to':_0x1f4ddf,'periodType':_0x2329ca['period']||'custom','daysCount':_0x47225a}};return console['log'](_0x512457(0x249)),console[_0x512457(0x1ff)](_0x512457(0x2f1)+_0x233e00['totalTurnover']+_0x512457(0x228)),console[_0x512457(0x1ff)]('\x20\x20\x20👤\x20Merchant\x20earnings:\x20'+_0x233e00[_0x512457(0x1e7)]+'\x20USDT'),console[_0x512457(0x1ff)](_0x512457(0x1a6)+_0x233e00[_0x512457(0x1be)]+'\x20USDT'),console[_0x512457(0x1ff)](_0x512457(0x19d)+_0x233e00[_0x512457(0x1d7)]+'\x20USDT'),console[_0x512457(0x1ff)](_0x512457(0x240)+_0x233e00[_0x512457(0x216)]+_0x512457(0x228)),console['log'](_0x512457(0x1a0)+_0x233e00[_0x512457(0x1ca)]),_0x233e00;}async[a40_0x28ffbb(0x1f5)](_0x3376d9){const _0x5f1652=a40_0x28ffbb;console[_0x5f1652(0x1ff)](_0x5f1652(0x2e2),{'hasPayoutHistory':_0x3376d9});let _0x1d17d3={'status':_0x5f1652(0x2d4)};_0x3376d9&&(_0x1d17d3['payouts']={'some':{}});const _0x4aabad=await database_1[_0x5f1652(0x27f)][_0x5f1652(0x254)][_0x5f1652(0x2c8)]({'where':_0x1d17d3,'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':'asc'}});return console[_0x5f1652(0x1ff)](_0x5f1652(0x2df)+_0x4aabad['length']+'\x20active\x20merchants\x20for\x20selection'+(_0x3376d9?_0x5f1652(0x1bb):'')),_0x4aabad[_0x5f1652(0x2a5)](_0x458241=>({'id':_0x458241['id'],'username':_0x458241['username'],'name':_0x458241[_0x5f1652(0x2e1)]}));}[a40_0x28ffbb(0x268)](_0x449682){const _0x5454fb=a40_0x28ffbb,_0x1cde37={'test_gateway':_0x5454fb(0x24c),'plisio':_0x5454fb(0x213),'rapyd':_0x5454fb(0x29c),'noda':_0x5454fb(0x1d9),'cointopay':_0x5454fb(0x284),'cointopay2':_0x5454fb(0x2d3),'klyme_eu':_0x5454fb(0x23a),'klyme_gb':_0x5454fb(0x2fb),'klyme_de':'KLYME\x20DE','mastercard':_0x5454fb(0x2b1)};return _0x1cde37[_0x449682]||_0x449682;}[a40_0x28ffbb(0x291)](_0x50e277){const _0x32cdd7=a40_0x28ffbb,_0x34dea7={'Test\x20Gateway':_0x32cdd7(0x1e0),'Plisio':_0x32cdd7(0x1d5),'Rapyd':_0x32cdd7(0x28c),'Noda':_0x32cdd7(0x25c),'CoinToPay':_0x32cdd7(0x1fb),'CoinToPay2':'cointopay2','KLYME\x20EU':_0x32cdd7(0x2fd),'KLYME\x20GB':_0x32cdd7(0x2f6),'KLYME\x20DE':_0x32cdd7(0x29d),'MasterCard':'mastercard'};return _0x34dea7[_0x50e277]||_0x50e277[_0x32cdd7(0x227)]();}async[a40_0x28ffbb(0x261)](_0xb10b90){const _0x56fb2c=a40_0x28ffbb,{page:_0x1158ba,limit:_0x2b72bc,minAmount:_0x366965,search:_0x17a31c}=_0xb10b90;console[_0x56fb2c(0x1ff)](_0x56fb2c(0x20a),_0xb10b90);let _0x779276={'status':_0x56fb2c(0x2d4)};_0x17a31c&&(_0x779276[_0x56fb2c(0x2e1)]={'contains':_0x17a31c,'mode':_0x56fb2c(0x1eb)});const _0x418fc9=await database_1['default'][_0x56fb2c(0x254)]['findMany']({'where':_0x779276,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),_0x40b380=_0x418fc9['filter'](_0x3eb85a=>{const _0x4a9b42=Math['floor'](_0x3eb85a['balance']*0x64)/0x64;if(_0x366965&&_0x4a9b42<_0x366965)return![];return _0x4a9b42!==0x0;});_0x40b380['sort']((_0x43eb3e,_0x39d635)=>_0x39d635['balance']-_0x43eb3e[_0x56fb2c(0x22a)]);const _0x5d6376=_0x40b380[_0x56fb2c(0x1f0)],_0x19b8a1=(_0x1158ba-0x1)*_0x2b72bc,_0x237738=_0x40b380['slice'](_0x19b8a1,_0x19b8a1+_0x2b72bc);console[_0x56fb2c(0x1ff)](_0x56fb2c(0x309)+_0x237738[_0x56fb2c(0x1f0)]+'\x20merchants\x20with\x20rounded\x20balance\x20!=\x200.00\x20(excluding\x20balances\x20that\x20round\x20to\x200.00)');const _0x5b54d9=await Promise[_0x56fb2c(0x226)](_0x237738[_0x56fb2c(0x2a5)](async _0x243f4b=>{const _0x13b50a=_0x56fb2c,[_0x110160,_0x2cd278,_0x13d91b]=await Promise[_0x13b50a(0x226)]([database_1[_0x13b50a(0x27f)]['payment'][_0x13b50a(0x2ab)]({'where':{'shopId':_0x243f4b['id'],'status':_0x13b50a(0x214),'gateway':{'not':_0x13b50a(0x1e0)}}}),database_1[_0x13b50a(0x27f)][_0x13b50a(0x26d)][_0x13b50a(0x248)]({'where':{'shopId':_0x243f4b['id'],'status':_0x13b50a(0x214),'gateway':{'not':_0x13b50a(0x1e0)}},'orderBy':{'paidAt':_0x13b50a(0x292)},'select':{'paidAt':!![]}}),database_1[_0x13b50a(0x27f)][_0x13b50a(0x26d)][_0x13b50a(0x283)]({'by':['gateway'],'where':{'shopId':_0x243f4b['id'],'status':_0x13b50a(0x214),'gateway':{'not':_0x13b50a(0x1e0)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x174916=new Date(),_0x39a9f6=new Date(_0x174916[_0x13b50a(0x1e1)](),_0x174916[_0x13b50a(0x2f5)](),0x1),_0x124ea3=new Date(_0x174916['getFullYear'](),_0x174916['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x3459b2,_0x4bfd5b]=await Promise[_0x13b50a(0x226)]([database_1[_0x13b50a(0x27f)][_0x13b50a(0x2e9)]['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x243f4b['id'],'status':_0x13b50a(0x21a)}}),database_1[_0x13b50a(0x27f)]['payout'][_0x13b50a(0x2c6)]({'_sum':{'amount':!![]},'where':{'shopId':_0x243f4b['id'],'status':_0x13b50a(0x21a),'createdAt':{'gte':_0x39a9f6,'lte':_0x124ea3}}})]),_0x5b3872=_0x3459b2[_0x13b50a(0x232)]['amount']||0x0,_0x5420ab=_0x4bfd5b[_0x13b50a(0x232)]['amount']||0x0,_0x22c84f=await Promise[_0x13b50a(0x226)](_0x13d91b[_0x13b50a(0x2a5)](async _0x5a568d=>{const _0x593287=_0x13b50a;let _0x5dea02=0x2d;if(_0x243f4b[_0x593287(0x1ec)])try{const _0x554f91=JSON['parse'](_0x243f4b['gatewaySettings']);for(const [_0x4f85f3,_0x36c6af]of Object['entries'](_0x554f91)){if(_0x4f85f3[_0x593287(0x227)]()===_0x5a568d[_0x593287(0x24a)][_0x593287(0x227)]()){_0x5dea02=_0x36c6af[_0x593287(0x299)]||0xa,console['log'](_0x593287(0x212)+_0x5a568d[_0x593287(0x24a)]+'\x20for\x20shop\x20'+_0x243f4b['id']+_0x593287(0x1b7)+_0x5dea02+'%');break;}}}catch(_0x4448a5){console['error']('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x243f4b['id']+':',_0x4448a5);}const _0x381221=_0x5a568d[_0x593287(0x232)]?.[_0x593287(0x2ae)]||0x0,_0x2ac0ea=_0x381221*(0x1-_0x5dea02/0x64);return{'gateway':_0x5a568d['gateway'],'count':_0x5a568d[_0x593287(0x2ee)]?.['id']||0x0,'amountUSDT':Math[_0x593287(0x1f4)](_0x381221*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x593287(0x1f4)](_0x2ac0ea*0x64)/0x64,'commission':_0x5dea02};})),_0x5927a0=_0x22c84f['reduce']((_0x29fbe5,_0x3884fb)=>_0x29fbe5+_0x3884fb['amountUSDT'],0x0),_0x332e93=_0x22c84f[_0x13b50a(0x24f)]((_0xe4cf11,_0x33df3c)=>_0xe4cf11+_0x33df3c[_0x13b50a(0x1e6)],0x0),_0x3f14d6=_0x243f4b['balance'];return console['log'](_0x13b50a(0x26b)+_0x243f4b['username']+':'),console[_0x13b50a(0x1ff)](_0x13b50a(0x21d)+_0x5927a0[_0x13b50a(0x23f)](0x2)+_0x13b50a(0x2c4)),console[_0x13b50a(0x1ff)](_0x13b50a(0x1cd)+_0x332e93[_0x13b50a(0x23f)](0x2)+'\x20USDT\x20(theoretical\x20net)'),console[_0x13b50a(0x1ff)](_0x13b50a(0x272)+_0x3f14d6[_0x13b50a(0x23f)](0x2)+_0x13b50a(0x242)),console[_0x13b50a(0x1ff)](_0x13b50a(0x2b4)+_0x5b3872[_0x13b50a(0x23f)](0x2)+_0x13b50a(0x27a)),console[_0x13b50a(0x1ff)](_0x13b50a(0x1ba)+(_0x332e93-_0x5b3872-_0x3f14d6)[_0x13b50a(0x23f)](0x2)+'\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)'),{'id':_0x243f4b['id'],'fullName':_0x243f4b[_0x13b50a(0x2e1)],'username':_0x243f4b[_0x13b50a(0x2e0)],'telegramId':_0x243f4b[_0x13b50a(0x1ed)],'merchantUrl':_0x243f4b[_0x13b50a(0x24d)],'wallets':{'usdtPolygonWallet':_0x243f4b[_0x13b50a(0x2f2)],'usdtTrcWallet':_0x243f4b[_0x13b50a(0x241)],'usdtErcWallet':_0x243f4b[_0x13b50a(0x276)],'usdcPolygonWallet':_0x243f4b[_0x13b50a(0x2cc)],'usdcErcWallet':_0x243f4b[_0x13b50a(0x2d6)]},'totalAmountUSDT':Math[_0x13b50a(0x1f4)](_0x5927a0*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x13b50a(0x1f4)](_0x332e93*0x64)/0x64,'currentBalance':Math['floor'](_0x3f14d6*0x64)/0x64,'totalPayout':Math[_0x13b50a(0x1f4)](_0x5b3872*0x64)/0x64,'thisMonth':Math[_0x13b50a(0x1f4)](_0x5420ab*0x64)/0x64,'paymentsCount':_0x110160,'oldestPaymentDate':_0x2cd278?.[_0x13b50a(0x1ea)]||_0x243f4b['createdAt'],'gatewayBreakdown':_0x22c84f};})),_0xc31fe1=_0x5b54d9['reduce']((_0x317620,_0xe43596)=>_0x317620+_0xe43596[_0x56fb2c(0x29f)],0x0),_0x355d7c=_0x5b54d9['reduce']((_0xcac0dd,_0x5a1d89)=>_0xcac0dd+_0x5a1d89[_0x56fb2c(0x290)],0x0),_0x18f247=_0x5b54d9[_0x56fb2c(0x24f)]((_0x35c583,_0x2f927c)=>_0x35c583+_0x2f927c[_0x56fb2c(0x27b)],0x0),_0x38b91b=_0x5b54d9[_0x56fb2c(0x24f)]((_0x2120b1,_0x2ef82e)=>_0x2120b1+_0x2ef82e[_0x56fb2c(0x2e6)],0x0);return console['log'](_0x56fb2c(0x233)+_0x5d6376+_0x56fb2c(0x253)),console['log'](_0x56fb2c(0x1c7)+Math[_0x56fb2c(0x1f4)](_0xc31fe1*0x64)/0x64+_0x56fb2c(0x2c4)),console[_0x56fb2c(0x1ff)](_0x56fb2c(0x2ad)+Math[_0x56fb2c(0x1f4)](_0x355d7c*0x64)/0x64+_0x56fb2c(0x2ba)),console[_0x56fb2c(0x1ff)](_0x56fb2c(0x2ff)+Math[_0x56fb2c(0x1f4)](_0x18f247*0x64)/0x64+_0x56fb2c(0x228)),console['log']('\x20\x20\x20📅\x20Total\x20payouts\x20(this\x20month):\x20'+Math[_0x56fb2c(0x1f4)](_0x38b91b*0x64)/0x64+_0x56fb2c(0x228)),{'merchants':_0x5b54d9,'pagination':{'page':_0x1158ba,'limit':_0x2b72bc,'total':_0x5d6376,'totalPages':Math[_0x56fb2c(0x230)](_0x5d6376/_0x2b72bc)},'summary':{'totalMerchants':_0x5d6376,'totalAmountUSDT':Math[_0x56fb2c(0x1f4)](_0xc31fe1*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x355d7c*0x64)/0x64,'totalPayout':Math[_0x56fb2c(0x1f4)](_0x18f247*0x64)/0x64,'thisMonth':Math[_0x56fb2c(0x1f4)](_0x38b91b*0x64)/0x64}};}async[a40_0x28ffbb(0x21c)](_0x492045){const _0x24e9ae=a40_0x28ffbb,{shopId:_0xf47f07,amount:_0x1e0718,network:_0x7bd8ff,wallet:_0x4051cd,notes:_0x44254c,txid:_0x4494fa,periodFrom:_0x32e32a,periodTo:_0x2e5df9}=_0x492045,_0x190ea0=await database_1[_0x24e9ae(0x27f)][_0x24e9ae(0x1ee)](async _0x595d05=>{const _0x551dc7=_0x24e9ae,_0x1245cf=await _0x595d05['shop'][_0x551dc7(0x255)]({'where':{'id':_0xf47f07},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x1245cf)throw new Error(_0x551dc7(0x2b9));console[_0x551dc7(0x1ff)]('💰\x20Creating\x20payout\x20for\x20shop\x20'+_0x1245cf[_0x551dc7(0x2e0)]+':'),console['log'](_0x551dc7(0x288)+_0x1245cf[_0x551dc7(0x22a)]['toFixed'](0x6)+_0x551dc7(0x228)),console[_0x551dc7(0x1ff)](_0x551dc7(0x251)+_0x1e0718[_0x551dc7(0x23f)](0x6)+'\x20USDT'),console[_0x551dc7(0x1ff)]('\x20\x20\x20Current\x20total\x20paid\x20out:\x20'+_0x1245cf[_0x551dc7(0x1d7)][_0x551dc7(0x23f)](0x6)+_0x551dc7(0x228));if(_0x4494fa)console[_0x551dc7(0x1ff)](_0x551dc7(0x275)+_0x4494fa);const _0x1bd4b1=0.000001,_0x3ab779=Number(_0x1245cf['balance']),_0x251187=Number(_0x1e0718);console[_0x551dc7(0x1ff)](_0x551dc7(0x2a4)),console[_0x551dc7(0x1ff)]('\x20\x20\x20Available\x20(raw):\x20'+_0x1245cf['balance']),console['log']('\x20\x20\x20Available\x20(number):\x20'+_0x3ab779),console[_0x551dc7(0x1ff)](_0x551dc7(0x201)+_0x251187),console[_0x551dc7(0x1ff)](_0x551dc7(0x298)+(_0x3ab779-_0x251187)),console[_0x551dc7(0x1ff)](_0x551dc7(0x256)+_0x1bd4b1);if(_0x3ab779<_0x251187-_0x1bd4b1)throw new Error(_0x551dc7(0x2a9)+_0x3ab779[_0x551dc7(0x23f)](0x6)+_0x551dc7(0x289)+_0x251187[_0x551dc7(0x23f)](0x6)+_0x551dc7(0x246)+(_0x3ab779-_0x251187)[_0x551dc7(0x23f)](0x8)+_0x551dc7(0x228));console[_0x551dc7(0x1ff)](_0x551dc7(0x21e));const _0x5098ba=Math['min'](_0x3ab779,_0x251187);let _0x11b966=_0x4051cd;console[_0x551dc7(0x1ff)]('🔍\x20Initial\x20wallet\x20from\x20request:\x20'+(_0x4051cd||'not\x20provided'));if(!_0x11b966){console['log'](_0x551dc7(0x2a1));const _0x3c51ba=await _0x595d05[_0x551dc7(0x254)]['findUnique']({'where':{'id':_0xf47f07},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});console[_0x551dc7(0x1ff)](_0x551dc7(0x1a5),_0x3c51ba);if(_0x3c51ba)switch(_0x7bd8ff){case _0x551dc7(0x1df):_0x11b966=_0x3c51ba[_0x551dc7(0x2f2)]||undefined,console['log'](_0x551dc7(0x204)+_0x11b966);break;case _0x551dc7(0x1a3):_0x11b966=_0x3c51ba[_0x551dc7(0x241)]||undefined,console['log']('🔍\x20Selected\x20trc20\x20wallet:\x20'+_0x11b966);break;case _0x551dc7(0x2b6):_0x11b966=_0x3c51ba[_0x551dc7(0x276)]||undefined,console[_0x551dc7(0x1ff)](_0x551dc7(0x29e)+_0x11b966);break;case'polygon_usdc':_0x11b966=_0x3c51ba['usdcPolygonWallet']||undefined,console[_0x551dc7(0x1ff)](_0x551dc7(0x277)+_0x11b966);break;case _0x551dc7(0x1cf):_0x11b966=_0x3c51ba[_0x551dc7(0x2d6)]||undefined,console[_0x551dc7(0x1ff)](_0x551dc7(0x21b)+_0x11b966);break;}}else console[_0x551dc7(0x1ff)](_0x551dc7(0x19e)+_0x11b966);console[_0x551dc7(0x1ff)](_0x551dc7(0x1ab)+_0x7bd8ff+':\x20'+(_0x11b966||'not\x20specified')),console[_0x551dc7(0x1ff)](_0x551dc7(0x28f),{'shopId':_0xf47f07,'amount':_0x5098ba,'network':_0x7bd8ff,'wallet':_0x11b966,'status':_0x551dc7(0x21a),'txid':_0x4494fa,'notes':_0x44254c,'periodFrom':_0x32e32a?new Date(_0x32e32a):null,'periodTo':_0x2e5df9?new Date(_0x2e5df9):null});const _0x3c662b=await _0x595d05['payout'][_0x551dc7(0x25a)]({'data':{'shopId':_0xf47f07,'amount':_0x5098ba,'network':_0x7bd8ff,'wallet':_0x11b966,'status':'COMPLETED','txid':_0x4494fa,'notes':_0x44254c,'periodFrom':_0x32e32a?new Date(_0x32e32a):null,'periodTo':_0x2e5df9?new Date(_0x2e5df9):null,'createdAt':new Date(),'paidAt':new Date()}});console[_0x551dc7(0x1ff)](_0x551dc7(0x285),{'id':_0x3c662b['id'],'wallet':_0x3c662b[_0x551dc7(0x1ce)],'network':_0x3c662b[_0x551dc7(0x2d7)],'amount':_0x3c662b['amount']});const _0x4452d0=_0x3ab779-_0x5098ba,_0xa893e0=Number(_0x1245cf[_0x551dc7(0x1d7)])+_0x5098ba;return await _0x595d05[_0x551dc7(0x254)][_0x551dc7(0x22f)]({'where':{'id':_0xf47f07},'data':{'balance':_0x4452d0,'totalPaidOut':_0xa893e0}}),console[_0x551dc7(0x1ff)](_0x551dc7(0x2ac)+_0x1245cf[_0x551dc7(0x2e0)]+_0x551dc7(0x1bc)),console[_0x551dc7(0x1ff)](_0x551dc7(0x2de)+_0x3ab779[_0x551dc7(0x23f)](0x6)+'\x20->\x20'+_0x4452d0[_0x551dc7(0x23f)](0x6)+_0x551dc7(0x206)+_0x5098ba[_0x551dc7(0x23f)](0x6)+')'),console[_0x551dc7(0x1ff)](_0x551dc7(0x1f6)+_0x1245cf[_0x551dc7(0x1d7)][_0x551dc7(0x23f)](0x6)+_0x551dc7(0x1de)+_0xa893e0['toFixed'](0x6)+_0x551dc7(0x221)+_0x5098ba[_0x551dc7(0x23f)](0x6)+')'),console[_0x551dc7(0x1ff)]('\x20\x20\x20Final\x20payout\x20amount\x20used:\x20'+_0x5098ba[_0x551dc7(0x23f)](0x6)+_0x551dc7(0x228)),{'payout':_0x3c662b,'shop':_0x1245cf};});console[_0x24e9ae(0x1ff)](_0x24e9ae(0x2d8)+_0x190ea0['payout']['id']+'\x20for\x20shop\x20'+_0x190ea0[_0x24e9ae(0x254)][_0x24e9ae(0x2e0)]+'\x20('+_0x190ea0[_0x24e9ae(0x2e9)][_0x24e9ae(0x1c1)][_0x24e9ae(0x23f)](0x6)+'\x20USDT)');try{let _0x3cab6b=_0x24e9ae(0x224);if(_0x190ea0[_0x24e9ae(0x2e9)][_0x24e9ae(0x295)]&&_0x190ea0[_0x24e9ae(0x2e9)][_0x24e9ae(0x209)]){const _0x51d95a=new Date(_0x190ea0[_0x24e9ae(0x2e9)]['periodFrom'])['toLocaleDateString'](_0x24e9ae(0x238)),_0x1f69a=new Date(_0x190ea0[_0x24e9ae(0x2e9)]['periodTo'])['toLocaleDateString'](_0x24e9ae(0x238));_0x3cab6b=_0x51d95a+'\x20-\x20'+_0x1f69a;}await telegramBotService_1[_0x24e9ae(0x23c)][_0x24e9ae(0x1c9)](_0x190ea0[_0x24e9ae(0x2e9)][_0x24e9ae(0x2cf)],{'id':_0x190ea0[_0x24e9ae(0x2e9)]['id'],'amount':_0x190ea0[_0x24e9ae(0x2e9)][_0x24e9ae(0x1c1)],'network':_0x190ea0[_0x24e9ae(0x2e9)][_0x24e9ae(0x2d7)],'wallet':_0x190ea0[_0x24e9ae(0x2e9)]['wallet'],'period':_0x3cab6b,'createdAt':_0x190ea0[_0x24e9ae(0x2e9)]['createdAt'],'txid':_0x190ea0[_0x24e9ae(0x2e9)][_0x24e9ae(0x2b5)]}),console['log'](_0x24e9ae(0x2ca)+_0x190ea0[_0x24e9ae(0x2e9)]['id']);}catch(_0x435e15){console[_0x24e9ae(0x236)]('❌\x20Failed\x20to\x20send\x20Telegram\x20notification\x20for\x20payout\x20'+_0x190ea0['payout']['id']+':',_0x435e15);}return{'id':_0x190ea0['payout']['id'],'shopId':_0x190ea0[_0x24e9ae(0x2e9)][_0x24e9ae(0x2cf)],'shopName':_0x190ea0[_0x24e9ae(0x254)][_0x24e9ae(0x2e1)],'shopUsername':_0x190ea0['shop'][_0x24e9ae(0x2e0)],'amount':_0x190ea0[_0x24e9ae(0x2e9)]['amount'],'network':_0x190ea0[_0x24e9ae(0x2e9)][_0x24e9ae(0x2d7)],'wallet':_0x190ea0[_0x24e9ae(0x2e9)][_0x24e9ae(0x1ce)],'status':_0x190ea0[_0x24e9ae(0x2e9)][_0x24e9ae(0x1c4)],'txid':_0x190ea0[_0x24e9ae(0x2e9)][_0x24e9ae(0x2b5)],'notes':_0x190ea0[_0x24e9ae(0x2e9)][_0x24e9ae(0x2fe)],'periodFrom':_0x190ea0[_0x24e9ae(0x2e9)][_0x24e9ae(0x295)],'periodTo':_0x190ea0[_0x24e9ae(0x2e9)][_0x24e9ae(0x209)],'createdAt':_0x190ea0[_0x24e9ae(0x2e9)][_0x24e9ae(0x1a9)],'paidAt':_0x190ea0[_0x24e9ae(0x2e9)]['paidAt']};}async[a40_0x28ffbb(0x265)](_0x1acdb6){const _0x144f35=a40_0x28ffbb,{page:_0x1166bb,limit:_0x390a45,shopId:_0x407faf,network:_0xd5048c,dateFrom:_0xa20e72,dateTo:_0xebc741,search:_0x6862f5}=_0x1acdb6,_0x3612fd=(_0x1166bb-0x1)*_0x390a45,_0x16f70f={};_0x407faf&&(_0x16f70f[_0x144f35(0x2cf)]=_0x407faf);_0xd5048c&&(_0x16f70f[_0x144f35(0x2d7)]=_0xd5048c);if(_0xa20e72||_0xebc741){_0x16f70f[_0x144f35(0x1a9)]={};if(_0xa20e72){const _0x10b311=new Date(_0xa20e72);_0x10b311['setHours'](0x0,0x0,0x0,0x1),_0x16f70f[_0x144f35(0x1a9)][_0x144f35(0x1e4)]=_0x10b311,console['log'](_0x144f35(0x1ad)+_0x10b311[_0x144f35(0x2f4)]());}if(_0xebc741){const _0x198f4b=new Date(_0xebc741);_0x198f4b['setHours'](0x17,0x3b,0x3b,0x3e7),_0x16f70f['createdAt'][_0x144f35(0x20d)]=_0x198f4b,console['log'](_0x144f35(0x1d6)+_0x198f4b[_0x144f35(0x2f4)]());}}_0x6862f5&&(_0x16f70f['OR']=[{'shop':{'name':{'contains':_0x6862f5,'mode':_0x144f35(0x1eb)}}},{'shop':{'username':{'contains':_0x6862f5,'mode':_0x144f35(0x1eb)}}},{'notes':{'contains':_0x6862f5,'mode':_0x144f35(0x1eb)}}]);const [_0x3d9661,_0x5900ef]=await Promise[_0x144f35(0x226)]([database_1['default'][_0x144f35(0x2e9)][_0x144f35(0x2c8)]({'where':_0x16f70f,'skip':_0x3612fd,'take':_0x390a45,'orderBy':{'createdAt':_0x144f35(0x2a6)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'wallet':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x144f35(0x27f)][_0x144f35(0x2e9)][_0x144f35(0x2ab)]({'where':_0x16f70f})]);return{'payouts':_0x3d9661['map'](_0x1475fa=>({'id':_0x1475fa['id'],'shopId':_0x1475fa[_0x144f35(0x2cf)],'shopName':_0x1475fa[_0x144f35(0x254)]['name'],'shopUsername':_0x1475fa['shop']['username'],'amount':_0x1475fa[_0x144f35(0x1c1)],'network':_0x1475fa[_0x144f35(0x2d7)],'wallet':_0x1475fa['wallet'],'status':_0x1475fa[_0x144f35(0x1c4)],'txid':_0x1475fa[_0x144f35(0x2b5)],'notes':_0x1475fa[_0x144f35(0x2fe)],'periodFrom':_0x1475fa['periodFrom'],'periodTo':_0x1475fa[_0x144f35(0x209)],'createdAt':_0x1475fa[_0x144f35(0x1a9)],'paidAt':_0x1475fa[_0x144f35(0x1ea)]})),'pagination':{'page':_0x1166bb,'limit':_0x390a45,'total':_0x5900ef,'totalPages':Math[_0x144f35(0x230)](_0x5900ef/_0x390a45)}};}async[a40_0x28ffbb(0x1a8)](_0x5f38c1){const _0x1f2048=a40_0x28ffbb,_0x35fac9=await database_1[_0x1f2048(0x27f)]['payout'][_0x1f2048(0x255)]({'where':{'id':_0x5f38c1},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x35fac9)return null;return{'id':_0x35fac9['id'],'shopId':_0x35fac9[_0x1f2048(0x2cf)],'shopName':_0x35fac9[_0x1f2048(0x254)][_0x1f2048(0x2e1)],'shopUsername':_0x35fac9['shop']['username'],'amount':_0x35fac9[_0x1f2048(0x1c1)],'network':_0x35fac9[_0x1f2048(0x2d7)],'wallet':_0x35fac9['wallet'],'status':_0x35fac9['status'],'txid':_0x35fac9['txid'],'notes':_0x35fac9['notes'],'periodFrom':_0x35fac9['periodFrom'],'periodTo':_0x35fac9[_0x1f2048(0x209)],'createdAt':_0x35fac9[_0x1f2048(0x1a9)],'paidAt':_0x35fac9[_0x1f2048(0x1ea)]};}async[a40_0x28ffbb(0x2ed)](_0x3ae541){const _0x7f4db5=a40_0x28ffbb;await database_1[_0x7f4db5(0x27f)][_0x7f4db5(0x2e9)][_0x7f4db5(0x286)]({'where':{'id':_0x3ae541}});}async[a40_0x28ffbb(0x222)](_0x55abcb){const _0x1ad736=a40_0x28ffbb,{page:_0x48eee2,limit:_0x33be4a,status:_0x5d7413,gateway:_0x108cee,shopId:_0x234c00,dateFrom:_0x1a6db1,dateTo:_0xf586c4,search:_0x5f243f,currency:_0x7833d5,sortBy:_0x5dd3f6,sortOrder:_0x125282}=_0x55abcb,_0x14763d=(_0x48eee2-0x1)*_0x33be4a;console[_0x1ad736(0x1ff)](_0x1ad736(0x1af),_0x55abcb);const _0x3eae9d=await database_1[_0x1ad736(0x27f)][_0x1ad736(0x26d)][_0x1ad736(0x283)]({'by':[_0x1ad736(0x24a)],'_count':{'gateway':!![]}});console[_0x1ad736(0x1ff)](_0x1ad736(0x26c),_0x3eae9d[_0x1ad736(0x2a5)](_0x27be7f=>_0x27be7f[_0x1ad736(0x24a)]+'\x20('+_0x27be7f[_0x1ad736(0x2ee)][_0x1ad736(0x24a)]+_0x1ad736(0x250)));if(_0x108cee){const _0x53d0dd=_0x3eae9d[_0x1ad736(0x1fa)](_0x359d47=>_0x359d47[_0x1ad736(0x24a)][_0x1ad736(0x227)]()===_0x108cee['toLowerCase']());!_0x53d0dd&&_0x108cee[_0x1ad736(0x227)]()!==_0x1ad736(0x1e0)&&console['log']('⚠️\x20Requested\x20gateway\x20\x27'+_0x108cee+'\x27\x20not\x20found.\x20Available\x20gateways:\x20'+_0x3eae9d[_0x1ad736(0x2a5)](_0xeab63c=>_0xeab63c[_0x1ad736(0x24a)])[_0x1ad736(0x24b)](',\x20'));}const _0x3a82d5={};_0x5d7413&&(_0x3a82d5[_0x1ad736(0x1c4)]=_0x5d7413['toUpperCase']());if(!_0x108cee)_0x3a82d5['gateway']={'not':_0x1ad736(0x1e0)};else{if(_0x108cee&&(_0x108cee[_0x1ad736(0x227)]()===_0x1ad736(0x1e0)||_0x108cee===_0x1ad736(0x1d8)))_0x3a82d5[_0x1ad736(0x24a)]=_0x1ad736(0x1e0);else{let _0x581ee9=_0x108cee;const _0x3ad3c8=(0x0,gateway_1[_0x1ad736(0x2c7)])(_0x108cee);if(_0x3ad3c8)_0x581ee9=_0x3ad3c8,console[_0x1ad736(0x1ff)](_0x1ad736(0x1c6)+_0x108cee+_0x1ad736(0x2c5)+_0x581ee9+'\x27');else{const _0x514eb9=(0x0,gateway_1[_0x1ad736(0x22d)])(_0x108cee);if(_0x514eb9){const _0x40a696=(0x0,gateway_1['getGatewayNameById'])(_0x514eb9);_0x40a696&&(_0x581ee9=_0x40a696,console[_0x1ad736(0x1ff)](_0x1ad736(0x244)+_0x108cee+_0x1ad736(0x287)+_0x514eb9+'\x27\x20->\x20name\x20\x27'+_0x581ee9+'\x27'));}else console[_0x1ad736(0x1ff)](_0x1ad736(0x1b9)+_0x108cee+_0x1ad736(0x211));}const _0xf5be3f=await database_1['default'][_0x1ad736(0x26d)][_0x1ad736(0x2ab)]({'where':{'gateway':_0x581ee9[_0x1ad736(0x227)]()},'take':0x1});_0xf5be3f===0x0?(console[_0x1ad736(0x1ff)]('⚠️\x20Gateway\x20\x27'+_0x581ee9+_0x1ad736(0x215)+_0x108cee+_0x1ad736(0x2a2)),_0x3a82d5[_0x1ad736(0x24a)]=_0x1ad736(0x22b)):(_0x3a82d5[_0x1ad736(0x24a)]=_0x581ee9['toLowerCase'](),console[_0x1ad736(0x1ff)](_0x1ad736(0x25f)+_0x581ee9+'\x27\x20(from\x20\x27'+_0x108cee+'\x27)'));}}console[_0x1ad736(0x1ff)](_0x1ad736(0x2e7),_0x3a82d5[_0x1ad736(0x24a)]);_0x234c00&&(_0x3a82d5[_0x1ad736(0x2cf)]=_0x234c00);_0x7833d5&&(_0x3a82d5[_0x1ad736(0x25d)]=_0x7833d5[_0x1ad736(0x2f8)](),console[_0x1ad736(0x1ff)](_0x1ad736(0x24e)+_0x7833d5['toUpperCase']()));if(_0x1a6db1||_0xf586c4){_0x3a82d5[_0x1ad736(0x1a9)]={};if(_0x1a6db1){const _0x15d060=new Date(_0x1a6db1);_0x15d060['setHours'](0x0,0x0,0x0,0x1),_0x3a82d5['createdAt'][_0x1ad736(0x1e4)]=_0x15d060,console[_0x1ad736(0x1ff)](_0x1ad736(0x1db)+_0x15d060['toISOString']());}if(_0xf586c4){const _0x5a4cf9=new Date(_0xf586c4);_0x5a4cf9[_0x1ad736(0x271)](0x17,0x3b,0x3b,0x3e7),_0x3a82d5[_0x1ad736(0x1a9)][_0x1ad736(0x20d)]=_0x5a4cf9,console[_0x1ad736(0x1ff)]('📅\x20Date\x20to\x20filter:\x20'+_0x5a4cf9[_0x1ad736(0x2f4)]());}}_0x5f243f&&(_0x3a82d5['OR']=[{'id':{'contains':_0x5f243f,'mode':'insensitive'}},{'orderId':{'contains':_0x5f243f,'mode':_0x1ad736(0x1eb)}},{'gatewayOrderId':{'contains':_0x5f243f,'mode':'insensitive'}},{'customerEmail':{'contains':_0x5f243f,'mode':_0x1ad736(0x1eb)}},{'shop':{'name':{'contains':_0x5f243f,'mode':_0x1ad736(0x1eb)}}},{'shop':{'username':{'contains':_0x5f243f,'mode':_0x1ad736(0x1eb)}}}]);console[_0x1ad736(0x1ff)](_0x1ad736(0x1f1),JSON[_0x1ad736(0x1fd)](_0x3a82d5,null,0x2));let _0x69e06a={'createdAt':'desc'};if(_0x5dd3f6){const _0x53e863=[_0x1ad736(0x1c1),_0x1ad736(0x1a9),_0x1ad736(0x266),_0x1ad736(0x1c4),_0x1ad736(0x24a),_0x1ad736(0x25d)],_0x42e472=[_0x1ad736(0x292),'desc'];if(_0x53e863['includes'](_0x5dd3f6)){const _0x4093f8=_0x42e472[_0x1ad736(0x22c)](_0x125282)?_0x125282:_0x1ad736(0x2a6);_0x69e06a={[_0x5dd3f6]:_0x4093f8},console[_0x1ad736(0x1ff)](_0x1ad736(0x23d)+_0x5dd3f6+_0x1ad736(0x225)+_0x4093f8+'\x20order');}}const [_0x11fdfc,_0x5b3127]=await Promise[_0x1ad736(0x226)]([database_1[_0x1ad736(0x27f)][_0x1ad736(0x26d)][_0x1ad736(0x2c8)]({'where':_0x3a82d5,'skip':_0x14763d,'take':_0x33be4a,'orderBy':_0x69e06a,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x1ad736(0x26d)][_0x1ad736(0x2ab)]({'where':_0x3a82d5})]);return{'payments':_0x11fdfc,'pagination':{'page':_0x48eee2,'limit':_0x33be4a,'total':_0x5b3127,'totalPages':Math[_0x1ad736(0x230)](_0x5b3127/_0x33be4a)}};}async['getPaymentById'](_0x5ce2e5){const _0x897190=a40_0x28ffbb,_0x251ac3=await database_1[_0x897190(0x27f)][_0x897190(0x26d)][_0x897190(0x255)]({'where':{'id':_0x5ce2e5},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x251ac3)return null;return{'id':_0x251ac3['id'],'shopId':_0x251ac3[_0x897190(0x2cf)],'gateway':_0x251ac3[_0x897190(0x24a)],'amount':_0x251ac3[_0x897190(0x1c1)],'currency':_0x251ac3[_0x897190(0x25d)],'status':_0x251ac3[_0x897190(0x1c4)],'orderId':_0x251ac3[_0x897190(0x2fa)],'gatewayOrderId':_0x251ac3['gatewayOrderId'],'customerEmail':_0x251ac3[_0x897190(0x1aa)],'customerName':_0x251ac3[_0x897190(0x300)],'customerCountry':_0x251ac3[_0x897190(0x208)],'customerIp':_0x251ac3['customerIp'],'customerUa':_0x251ac3[_0x897190(0x1e9)],'failureMessage':_0x251ac3[_0x897190(0x2bc)],'externalPaymentUrl':_0x251ac3['externalPaymentUrl'],'successUrl':_0x251ac3[_0x897190(0x1b6)],'failUrl':_0x251ac3[_0x897190(0x1dd)],'pendingUrl':_0x251ac3[_0x897190(0x2da)],'whiteUrl':_0x251ac3[_0x897190(0x1f3)],'createdAt':_0x251ac3[_0x897190(0x1a9)],'updatedAt':_0x251ac3['updatedAt'],'shop':_0x251ac3['shop']};}async[a40_0x28ffbb(0x274)](_0x1f7779,_0x21a608,_0x55bd8c,_0x5c6d37){const _0x586599=a40_0x28ffbb,_0x609475=await database_1[_0x586599(0x27f)][_0x586599(0x1ee)](async _0x3fb8e3=>{const _0x415f9e=_0x586599,_0x4dffd4=await _0x3fb8e3[_0x415f9e(0x26d)][_0x415f9e(0x255)]({'where':{'id':_0x1f7779},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x4dffd4)throw new Error(_0x415f9e(0x2fc));const _0x4c58f7=_0x4dffd4[_0x415f9e(0x1c4)],_0x4717b2=_0x21a608[_0x415f9e(0x2f8)]();console['log'](_0x415f9e(0x1da)+_0x1f7779+_0x415f9e(0x262)+_0x4c58f7+'\x20->\x20'+_0x4717b2),console[_0x415f9e(0x1ff)](_0x415f9e(0x282)+_0x4dffd4[_0x415f9e(0x254)][_0x415f9e(0x22a)]+_0x415f9e(0x228));const _0x7d1426={'status':_0x4717b2,'updatedAt':new Date(),'statusChangedBy':_0x415f9e(0x2bb),'statusChangedAt':new Date()};_0x55bd8c&&(_0x7d1426['adminNotes']=_0x55bd8c);_0x4717b2===_0x415f9e(0x260)&&_0x5c6d37&&(_0x7d1426[_0x415f9e(0x28d)]=_0x5c6d37);let _0x485c7c=0x0,_0x10f7c9=_0x4dffd4[_0x415f9e(0x254)][_0x415f9e(0x22a)];if(_0x4717b2===_0x415f9e(0x214)&&_0x4c58f7!==_0x415f9e(0x214)){_0x7d1426[_0x415f9e(0x1ea)]=new Date();const _0x3b3f7b=await currencyService_1[_0x415f9e(0x269)]['convertToUSDT'](_0x4dffd4['amount'],_0x4dffd4[_0x415f9e(0x25d)]);_0x7d1426[_0x415f9e(0x2ae)]=_0x3b3f7b;let _0x46c67b=0x2d;const _0x57f1d7=await _0x3fb8e3['shop']['findUnique']({'where':{'id':_0x4dffd4[_0x415f9e(0x2cf)]},'select':{'gatewaySettings':!![]}});if(_0x57f1d7?.['gatewaySettings'])try{const _0x3cb2a9=JSON[_0x415f9e(0x202)](_0x57f1d7[_0x415f9e(0x1ec)]);for(const [_0x1350c3,_0x50df97]of Object['entries'](_0x3cb2a9)){if(_0x1350c3['toLowerCase']()===_0x4dffd4['gateway'][_0x415f9e(0x227)]()){_0x46c67b=_0x50df97[_0x415f9e(0x299)]||0xa;break;}}}catch(_0x5b1043){console['error']('Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20'+_0x1f7779+':',_0x5b1043);}let _0x158286;_0x4dffd4[_0x415f9e(0x245)]!==null&&_0x4dffd4[_0x415f9e(0x245)]!==undefined?(_0x158286=_0x4dffd4[_0x415f9e(0x245)],console[_0x415f9e(0x1ff)](_0x415f9e(0x1c3)+_0x158286[_0x415f9e(0x23f)](0x6)+_0x415f9e(0x308)+_0x1f7779)):(_0x158286=_0x3b3f7b*(0x1-_0x46c67b/0x64),console[_0x415f9e(0x1ff)](_0x415f9e(0x1c2)+_0x1f7779+':\x20'+_0x46c67b+_0x415f9e(0x1f8)+_0x3b3f7b[_0x415f9e(0x23f)](0x6)+_0x415f9e(0x228)),_0x7d1426['amountAfterGatewayCommissionUSDT']=_0x158286,_0x7d1426['gatewayCommissionRate']=_0x46c67b),_0x485c7c=_0x158286,_0x10f7c9+=_0x158286,console[_0x415f9e(0x1ff)]('💰\x20Payment\x20'+_0x1f7779+_0x415f9e(0x218)),console['log'](_0x415f9e(0x2bf)+_0x3b3f7b[_0x415f9e(0x23f)](0x6)+'\x20USDT'),console['log'](_0x415f9e(0x2b2)+_0x4dffd4[_0x415f9e(0x24a)]+_0x415f9e(0x2a8)+_0x46c67b+'%'),console[_0x415f9e(0x1ff)](_0x415f9e(0x1d2)+_0x158286[_0x415f9e(0x23f)](0x6)+_0x415f9e(0x2f3)+_0x46c67b+_0x415f9e(0x27c)),console['log'](_0x415f9e(0x210)+_0x158286[_0x415f9e(0x23f)](0x6)+_0x415f9e(0x228));}else{if(_0x4c58f7===_0x415f9e(0x214)&&_0x4717b2!==_0x415f9e(0x214)&&_0x4717b2!==_0x415f9e(0x260)){if(_0x4dffd4['amountUSDT']){let _0x1587c5=0x2d;const _0x69b9bc=await _0x3fb8e3[_0x415f9e(0x254)]['findUnique']({'where':{'id':_0x4dffd4[_0x415f9e(0x2cf)]},'select':{'gatewaySettings':!![]}});if(_0x69b9bc?.[_0x415f9e(0x1ec)])try{const _0x28253f=JSON[_0x415f9e(0x202)](_0x69b9bc['gatewaySettings']);for(const [_0x5d6677,_0x5f218e]of Object[_0x415f9e(0x2f9)](_0x28253f)){if(_0x5d6677[_0x415f9e(0x227)]()===_0x4dffd4[_0x415f9e(0x24a)][_0x415f9e(0x227)]()){_0x1587c5=_0x5f218e[_0x415f9e(0x299)]||0xa;break;}}}catch(_0x14ff70){console[_0x415f9e(0x236)](_0x415f9e(0x2d9)+_0x1f7779+':',_0x14ff70);}const _0x2cccd8=_0x4dffd4[_0x415f9e(0x2ae)]*(0x1-_0x1587c5/0x64);_0x485c7c=-_0x2cccd8,_0x10f7c9-=_0x2cccd8,console[_0x415f9e(0x1ff)]('\x20\x20\x20Full\x20amount:\x20'+_0x4dffd4[_0x415f9e(0x2ae)][_0x415f9e(0x23f)](0x6)+_0x415f9e(0x228)),console[_0x415f9e(0x1ff)](_0x415f9e(0x2b2)+_0x4dffd4['gateway']+_0x415f9e(0x2a8)+_0x1587c5+'%'),console[_0x415f9e(0x1ff)](_0x415f9e(0x302)+_0x2cccd8[_0x415f9e(0x23f)](0x6)+_0x415f9e(0x2f3)+_0x1587c5+_0x415f9e(0x27c)),console['log']('\x20\x20\x20Subtracted\x20from\x20balance:\x20-'+_0x2cccd8[_0x415f9e(0x23f)](0x6)+_0x415f9e(0x228));}}}_0x4717b2===_0x415f9e(0x260)&&(console['log']('💸\x20CHARGEBACK:\x20Processing\x20penalty-only\x20deduction'),_0x5c6d37&&_0x5c6d37>0x0?(_0x485c7c=-_0x5c6d37,_0x10f7c9-=_0x5c6d37,console['log'](_0x415f9e(0x2c0)+_0x5c6d37[_0x415f9e(0x23f)](0x6)+_0x415f9e(0x1a7)),console[_0x415f9e(0x1ff)]('💰\x20Payment\x20amount\x20is\x20NOT\x20deducted\x20(chargeback\x20penalty\x20only)')):console['log'](_0x415f9e(0x2e5)),_0x7d1426[_0x415f9e(0x28d)]=_0x5c6d37||0x0);_0x4717b2===_0x415f9e(0x1b3)&&_0x4c58f7==='PAID'&&console['log'](_0x415f9e(0x281));const _0x3e9883=await _0x3fb8e3[_0x415f9e(0x26d)][_0x415f9e(0x22f)]({'where':{'id':_0x1f7779},'data':_0x7d1426,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x485c7c!==0x0&&(await _0x3fb8e3[_0x415f9e(0x254)][_0x415f9e(0x22f)]({'where':{'id':_0x4dffd4[_0x415f9e(0x2cf)]},'data':{'balance':_0x10f7c9}}),console[_0x415f9e(0x1ff)](_0x415f9e(0x2ac)+_0x4dffd4[_0x415f9e(0x2cf)]+'\x20balance\x20updated:\x20'+_0x4dffd4[_0x415f9e(0x254)]['balance'][_0x415f9e(0x23f)](0x6)+_0x415f9e(0x1de)+_0x10f7c9[_0x415f9e(0x23f)](0x6)+_0x415f9e(0x258)+(_0x485c7c>0x0?'+':'')+_0x485c7c[_0x415f9e(0x23f)](0x6)+')')),_0x3e9883;});return{'id':_0x609475['id'],'shopId':_0x609475['shopId'],'gateway':_0x609475[_0x586599(0x24a)],'amount':_0x609475[_0x586599(0x1c1)],'currency':_0x609475[_0x586599(0x25d)],'status':_0x609475[_0x586599(0x1c4)],'orderId':_0x609475[_0x586599(0x2fa)],'gatewayOrderId':_0x609475[_0x586599(0x259)],'customerEmail':_0x609475[_0x586599(0x1aa)],'customerName':_0x609475[_0x586599(0x300)],'customerCountry':_0x609475['customerCountry'],'customerIp':_0x609475[_0x586599(0x301)],'customerUa':_0x609475['customerUa'],'failureMessage':_0x609475[_0x586599(0x2bc)],'adminNotes':_0x609475[_0x586599(0x235)],'chargebackAmount':_0x609475['chargebackAmount'],'statusChangedBy':_0x609475[_0x586599(0x297)],'statusChangedAt':_0x609475[_0x586599(0x239)],'createdAt':_0x609475['createdAt'],'updatedAt':_0x609475[_0x586599(0x266)],'shop':_0x609475[_0x586599(0x254)]};}async['updateUser'](_0x160569,_0x103f51){const _0xb1274a=a40_0x28ffbb,_0xeb6f00=Math[_0xb1274a(0x1fc)]()[_0xb1274a(0x2c3)](0x24)[_0xb1274a(0x2a7)](0x2,0x9);console[_0xb1274a(0x1ff)]('🎯\x20updateUser\x20called\x20with\x20ID:\x20'+_0xeb6f00+',\x20userId:\x20'+_0x160569);const _0x5721c1={..._0x103f51};_0x103f51['password']&&_0x103f51[_0xb1274a(0x28e)][_0xb1274a(0x247)]()!==''?(console[_0xb1274a(0x1ff)](_0xb1274a(0x205)+_0xeb6f00+_0xb1274a(0x1d1)+_0x160569),_0x5721c1[_0xb1274a(0x28e)]=await bcryptjs_1[_0xb1274a(0x27f)][_0xb1274a(0x1e2)](_0x103f51[_0xb1274a(0x28e)],0xc)):(console[_0xb1274a(0x1ff)](_0xb1274a(0x205)+_0xeb6f00+']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update'),delete _0x5721c1[_0xb1274a(0x28e)]);_0x103f51['fullName']&&(_0x5721c1[_0xb1274a(0x2e1)]=_0x103f51[_0xb1274a(0x1c8)],delete _0x5721c1['fullName']);_0x103f51[_0xb1274a(0x1bf)]&&(_0x5721c1[_0xb1274a(0x1ed)]=_0x103f51[_0xb1274a(0x1bf)],delete _0x5721c1['telegramId']);_0x103f51[_0xb1274a(0x1f9)]&&(_0x5721c1[_0xb1274a(0x24d)]=_0x103f51[_0xb1274a(0x1f9)],delete _0x5721c1[_0xb1274a(0x1f9)]);if(_0x103f51[_0xb1274a(0x257)]){const _0x2d1e45=_0x103f51[_0xb1274a(0x257)][_0xb1274a(0x2a5)](_0x27cedc=>this[_0xb1274a(0x291)](_0x27cedc));console[_0xb1274a(0x1ff)](_0xb1274a(0x2d0),_0x103f51['gateways'],'->',_0x2d1e45),_0x5721c1[_0xb1274a(0x2cd)]=JSON[_0xb1274a(0x1fd)](_0x2d1e45),delete _0x5721c1[_0xb1274a(0x257)];}_0x103f51[_0xb1274a(0x1ec)]&&(console[_0xb1274a(0x1ff)](_0xb1274a(0x1c0)+_0xeb6f00+_0xb1274a(0x25e),_0x103f51[_0xb1274a(0x1ec)]),_0x5721c1[_0xb1274a(0x1ec)]=JSON[_0xb1274a(0x1fd)](_0x103f51[_0xb1274a(0x1ec)]),console['log'](_0xb1274a(0x1c0)+_0xeb6f00+_0xb1274a(0x270),_0x5721c1[_0xb1274a(0x1ec)]));_0x103f51['wallets']&&(_0x103f51[_0xb1274a(0x2e3)][_0xb1274a(0x2f2)]!==undefined&&(_0x5721c1[_0xb1274a(0x2f2)]=_0x103f51[_0xb1274a(0x2e3)][_0xb1274a(0x2f2)]||null),_0x103f51[_0xb1274a(0x2e3)][_0xb1274a(0x241)]!==undefined&&(_0x5721c1[_0xb1274a(0x241)]=_0x103f51[_0xb1274a(0x2e3)]['usdtTrcWallet']||null),_0x103f51[_0xb1274a(0x2e3)]['usdtErcWallet']!==undefined&&(_0x5721c1[_0xb1274a(0x276)]=_0x103f51[_0xb1274a(0x2e3)][_0xb1274a(0x276)]||null),_0x103f51['wallets'][_0xb1274a(0x2cc)]!==undefined&&(_0x5721c1['usdcPolygonWallet']=_0x103f51['wallets'][_0xb1274a(0x2cc)]||null),delete _0x5721c1[_0xb1274a(0x2e3)]);const _0x38f121=await database_1[_0xb1274a(0x27f)]['shop'][_0xb1274a(0x22f)]({'where':{'id':_0x160569},'data':_0x5721c1,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0xb1274a(0x1ff)](_0xb1274a(0x264)+_0xeb6f00+_0xb1274a(0x2b0),_0x38f121[_0xb1274a(0x1ec)]),{'id':_0x38f121['id'],'fullName':_0x38f121[_0xb1274a(0x2e1)],'username':_0x38f121['username'],'telegramId':_0x38f121[_0xb1274a(0x1ed)],'merchantUrl':_0x38f121['shopUrl'],'gateways':_0x38f121['paymentGateways']?JSON[_0xb1274a(0x202)](_0x38f121[_0xb1274a(0x2cd)]):null,'gatewaySettings':_0x38f121[_0xb1274a(0x1ec)]?JSON[_0xb1274a(0x202)](_0x38f121['gatewaySettings']):null,'publicKey':_0x38f121[_0xb1274a(0x217)],'wallets':{'usdtPolygonWallet':_0x38f121[_0xb1274a(0x2f2)],'usdtTrcWallet':_0x38f121[_0xb1274a(0x241)],'usdtErcWallet':_0x38f121[_0xb1274a(0x276)],'usdcPolygonWallet':_0x38f121[_0xb1274a(0x2cc)]},'status':_0x38f121[_0xb1274a(0x1c4)],'createdAt':_0x38f121[_0xb1274a(0x1a9)]};}async[a40_0x28ffbb(0x1b2)](_0x12c333){const _0xd2a3b=a40_0x28ffbb,_0x40e6d7=await database_1[_0xd2a3b(0x27f)]['shop'][_0xd2a3b(0x22f)]({'where':{'id':_0x12c333},'data':{'status':'SUSPENDED'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x40e6d7['id'],'fullName':_0x40e6d7['name'],'username':_0x40e6d7[_0xd2a3b(0x2e0)],'telegramId':_0x40e6d7[_0xd2a3b(0x1ed)],'merchantUrl':_0x40e6d7['shopUrl'],'gateways':_0x40e6d7[_0xd2a3b(0x2cd)]?JSON[_0xd2a3b(0x202)](_0x40e6d7[_0xd2a3b(0x2cd)]):null,'gatewaySettings':_0x40e6d7[_0xd2a3b(0x1ec)]?JSON['parse'](_0x40e6d7[_0xd2a3b(0x1ec)]):null,'publicKey':_0x40e6d7[_0xd2a3b(0x217)],'wallets':{'usdtPolygonWallet':_0x40e6d7[_0xd2a3b(0x2f2)],'usdtTrcWallet':_0x40e6d7[_0xd2a3b(0x241)],'usdtErcWallet':_0x40e6d7[_0xd2a3b(0x276)],'usdcPolygonWallet':_0x40e6d7[_0xd2a3b(0x2cc)]},'status':_0x40e6d7[_0xd2a3b(0x1c4)],'createdAt':_0x40e6d7['createdAt']};}async[a40_0x28ffbb(0x28b)](_0x229ce5){const _0x5ef415=a40_0x28ffbb,_0x23d25d=await database_1[_0x5ef415(0x27f)][_0x5ef415(0x254)][_0x5ef415(0x22f)]({'where':{'id':_0x229ce5},'data':{'status':_0x5ef415(0x2d4)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x23d25d['id'],'fullName':_0x23d25d[_0x5ef415(0x2e1)],'username':_0x23d25d[_0x5ef415(0x2e0)],'telegramId':_0x23d25d[_0x5ef415(0x1ed)],'merchantUrl':_0x23d25d['shopUrl'],'gateways':_0x23d25d[_0x5ef415(0x2cd)]?JSON[_0x5ef415(0x202)](_0x23d25d[_0x5ef415(0x2cd)]):null,'gatewaySettings':_0x23d25d[_0x5ef415(0x1ec)]?JSON['parse'](_0x23d25d[_0x5ef415(0x1ec)]):null,'publicKey':_0x23d25d[_0x5ef415(0x217)],'wallets':{'usdtPolygonWallet':_0x23d25d[_0x5ef415(0x2f2)],'usdtTrcWallet':_0x23d25d[_0x5ef415(0x241)],'usdtErcWallet':_0x23d25d['usdtErcWallet'],'usdcPolygonWallet':_0x23d25d[_0x5ef415(0x2cc)]},'status':_0x23d25d['status'],'createdAt':_0x23d25d[_0x5ef415(0x1a9)]};}async[a40_0x28ffbb(0x307)](_0x5fe1ae){const _0x58082b=a40_0x28ffbb,{page:_0x47840e,limit:_0x226722,status:_0x49a4fa}=_0x5fe1ae,_0x187674=(_0x47840e-0x1)*_0x226722,_0x5a5558={};_0x49a4fa&&(_0x5a5558[_0x58082b(0x1c4)]=_0x49a4fa[_0x58082b(0x2f8)]());const [_0x58b627,_0x3c1c53]=await Promise[_0x58082b(0x226)]([database_1[_0x58082b(0x27f)]['shop']['findMany']({'where':_0x5a5558,'skip':_0x187674,'take':_0x226722,'orderBy':{'createdAt':_0x58082b(0x2a6)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x58082b(0x27f)][_0x58082b(0x254)][_0x58082b(0x2ab)]({'where':_0x5a5558})]);return{'users':_0x58b627[_0x58082b(0x2a5)](_0x422e6d=>{const _0x3005f4=_0x58082b,_0x50c4a8=_0x422e6d[_0x3005f4(0x2cd)]?JSON['parse'](_0x422e6d[_0x3005f4(0x2cd)]):null,_0x5048bb=_0x50c4a8?_0x50c4a8[_0x3005f4(0x2a5)](_0x90982c=>this[_0x3005f4(0x268)](_0x90982c)):null;return{'id':_0x422e6d['id'],'fullName':_0x422e6d[_0x3005f4(0x2e1)],'username':_0x422e6d[_0x3005f4(0x2e0)],'telegramId':_0x422e6d[_0x3005f4(0x1ed)],'merchantUrl':_0x422e6d[_0x3005f4(0x24d)],'gateways':_0x5048bb,'gatewaySettings':_0x422e6d[_0x3005f4(0x1ec)]?JSON[_0x3005f4(0x202)](_0x422e6d['gatewaySettings']):null,'publicKey':_0x422e6d[_0x3005f4(0x217)],'wallets':{'usdtPolygonWallet':_0x422e6d[_0x3005f4(0x2f2)],'usdtTrcWallet':_0x422e6d[_0x3005f4(0x241)],'usdtErcWallet':_0x422e6d[_0x3005f4(0x276)],'usdcPolygonWallet':_0x422e6d[_0x3005f4(0x2cc)]},'status':_0x422e6d['status'],'createdAt':_0x422e6d[_0x3005f4(0x1a9)]};}),'pagination':{'page':_0x47840e,'limit':_0x226722,'total':_0x3c1c53,'totalPages':Math[_0x58082b(0x230)](_0x3c1c53/_0x226722)}};}async['getUserById'](_0x6f8739){const _0x243be4=a40_0x28ffbb,_0x182dbe=await database_1[_0x243be4(0x27f)]['shop'][_0x243be4(0x255)]({'where':{'id':_0x6f8739},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x182dbe)return null;const _0x4149f9=_0x182dbe[_0x243be4(0x2cd)]?JSON[_0x243be4(0x202)](_0x182dbe[_0x243be4(0x2cd)]):null,_0x45421e=_0x4149f9?_0x4149f9[_0x243be4(0x2a5)](_0x5f38fd=>this[_0x243be4(0x268)](_0x5f38fd)):null;return _0x4149f9&&_0x45421e&&console[_0x243be4(0x1ff)]('🔄\x20Gateway\x20mapping\x20(get):',_0x4149f9,'->',_0x45421e),{'id':_0x182dbe['id'],'fullName':_0x182dbe[_0x243be4(0x2e1)],'username':_0x182dbe[_0x243be4(0x2e0)],'telegramId':_0x182dbe[_0x243be4(0x1ed)],'merchantUrl':_0x182dbe[_0x243be4(0x24d)],'gateways':_0x45421e,'gatewaySettings':_0x182dbe[_0x243be4(0x1ec)]?JSON['parse'](_0x182dbe['gatewaySettings']):null,'publicKey':_0x182dbe[_0x243be4(0x217)],'wallets':{'usdtPolygonWallet':_0x182dbe[_0x243be4(0x2f2)],'usdtTrcWallet':_0x182dbe[_0x243be4(0x241)],'usdtErcWallet':_0x182dbe['usdtErcWallet'],'usdcPolygonWallet':_0x182dbe[_0x243be4(0x2cc)]},'status':_0x182dbe[_0x243be4(0x1c4)],'createdAt':_0x182dbe[_0x243be4(0x1a9)]};}async[a40_0x28ffbb(0x2b3)](_0x4d0b82){const _0x56f842=a40_0x28ffbb,{fullName:_0x4f1d44,username:_0x12be1b,password:_0x45bfd3,telegramId:_0x3f623f,merchantUrl:_0x2a3311,gateways:_0x27f29a,gatewaySettings:_0x4a7930,wallets:_0x352e42}=_0x4d0b82,_0x5a50c8=await database_1['default'][_0x56f842(0x254)][_0x56f842(0x255)]({'where':{'username':_0x12be1b}});if(_0x5a50c8)throw new Error(_0x56f842(0x2cb));if(_0x3f623f){const _0x278502=await database_1[_0x56f842(0x27f)]['shop']['findUnique']({'where':{'telegram':_0x3f623f}});if(_0x278502)throw new Error(_0x56f842(0x200));}const _0x20fe99=await bcryptjs_1[_0x56f842(0x27f)][_0x56f842(0x1e2)](_0x45bfd3,0xc),_0x4f77a9=_0x56f842(0x1cc)+crypto_1[_0x56f842(0x27f)][_0x56f842(0x294)](0x20)[_0x56f842(0x2c3)]('hex'),_0x2dc7f2=_0x56f842(0x28a)+crypto_1['default'][_0x56f842(0x294)](0x20)[_0x56f842(0x2c3)](_0x56f842(0x2a3)),_0x5d35b0=_0x27f29a?_0x27f29a['map'](_0x47412d=>this[_0x56f842(0x291)](_0x47412d)):null;_0x27f29a&&_0x5d35b0&&console[_0x56f842(0x1ff)](_0x56f842(0x2f0),_0x27f29a,'->',_0x5d35b0);const _0x11bf98=await database_1[_0x56f842(0x27f)][_0x56f842(0x254)][_0x56f842(0x25a)]({'data':{'name':_0x4f1d44,'username':_0x12be1b,'password':_0x20fe99,'telegram':_0x3f623f,'shopUrl':_0x2a3311,'paymentGateways':_0x5d35b0?JSON[_0x56f842(0x1fd)](_0x5d35b0):null,'gatewaySettings':_0x4a7930?JSON[_0x56f842(0x1fd)](_0x4a7930):null,'usdtPolygonWallet':_0x352e42?.[_0x56f842(0x2f2)]||null,'usdtTrcWallet':_0x352e42?.['usdtTrcWallet']||null,'usdtErcWallet':_0x352e42?.[_0x56f842(0x276)]||null,'usdcPolygonWallet':_0x352e42?.[_0x56f842(0x2cc)]||null,'publicKey':_0x4f77a9,'secretKey':_0x2dc7f2,'status':_0x56f842(0x2d4)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x11bf98['id'],'fullName':_0x11bf98[_0x56f842(0x2e1)],'username':_0x11bf98[_0x56f842(0x2e0)],'telegramId':_0x11bf98[_0x56f842(0x1ed)],'merchantUrl':_0x11bf98[_0x56f842(0x24d)],'gateways':_0x11bf98[_0x56f842(0x2cd)]?JSON[_0x56f842(0x202)](_0x11bf98[_0x56f842(0x2cd)]):null,'gatewaySettings':_0x11bf98[_0x56f842(0x1ec)]?JSON['parse'](_0x11bf98['gatewaySettings']):null,'publicKey':_0x11bf98[_0x56f842(0x217)],'wallets':{'usdtPolygonWallet':_0x11bf98[_0x56f842(0x2f2)],'usdtTrcWallet':_0x11bf98[_0x56f842(0x241)],'usdtErcWallet':_0x11bf98[_0x56f842(0x276)],'usdcPolygonWallet':_0x11bf98[_0x56f842(0x2cc)]},'status':_0x11bf98[_0x56f842(0x1c4)],'createdAt':_0x11bf98['createdAt']};}async[a40_0x28ffbb(0x279)](_0x3cf05e){const _0x408eaf=a40_0x28ffbb;await database_1[_0x408eaf(0x27f)][_0x408eaf(0x254)][_0x408eaf(0x286)]({'where':{'id':_0x3cf05e}});}[a40_0x28ffbb(0x237)](_0xa22a7a,_0x1236ed,_0x289b00){const _0x23cd88=a40_0x28ffbb,_0x1b3d6b=new Map(),_0x1cf583=new Date(_0x1236ed);while(_0x1cf583<=_0x289b00){const _0x426992=_0x1cf583[_0x23cd88(0x2f4)]()[_0x23cd88(0x296)]('T')[0x0];_0x1b3d6b[_0x23cd88(0x1cb)](_0x426992,{'revenue':0x0,'count':0x0}),_0x1cf583[_0x23cd88(0x2eb)](_0x1cf583['getDate']()+0x1);}for(const _0x268c7c of _0xa22a7a){const _0x488d71=_0x268c7c[_0x23cd88(0x1a9)]['toISOString']()[_0x23cd88(0x296)]('T')[0x0],_0x3f3e8c=_0x1b3d6b[_0x23cd88(0x2c1)](_0x488d71);_0x3f3e8c&&(_0x3f3e8c['count']+=0x1,_0x268c7c[_0x23cd88(0x1c4)]===_0x23cd88(0x214)&&(_0x268c7c[_0x23cd88(0x2ae)]?_0x3f3e8c[_0x23cd88(0x1b4)]+=_0x268c7c[_0x23cd88(0x2ae)]:console[_0x23cd88(0x1ff)](_0x23cd88(0x20f)+_0x268c7c['id']+_0x23cd88(0x1b1))));}const _0x587ef2=[],_0x2d68e9=[];for(const [_0x4b1e51,_0x170d26]of _0x1b3d6b){_0x587ef2[_0x23cd88(0x2b7)]({'date':_0x4b1e51,'amount':Math['round'](_0x170d26['revenue']*0x64)/0x64}),_0x2d68e9['push']({'date':_0x4b1e51,'count':_0x170d26['count']});}return{'dailyRevenue':_0x587ef2,'dailyPayments':_0x2d68e9};}}exports[a40_0x28ffbb(0x1dc)]=AdminService;