'use strict';function a40_0x50de(_0x45c2f9,_0x2a0711){const _0x5a4b4c=a40_0x5a4b();return a40_0x50de=function(_0x50dee3,_0x1d6cd6){_0x50dee3=_0x50dee3-0x1f1;let _0x1fdcb1=_0x5a4b4c[_0x50dee3];return _0x1fdcb1;},a40_0x50de(_0x45c2f9,_0x2a0711);}const a40_0x9a8211=a40_0x50de;(function(_0x1b5e42,_0x48fb63){const _0x386781=a40_0x50de,_0x30f2e7=_0x1b5e42();while(!![]){try{const _0x483899=parseInt(_0x386781(0x2b2))/0x1+-parseInt(_0x386781(0x275))/0x2+parseInt(_0x386781(0x26b))/0x3*(parseInt(_0x386781(0x2ed))/0x4)+parseInt(_0x386781(0x23e))/0x5*(-parseInt(_0x386781(0x331))/0x6)+parseInt(_0x386781(0x26c))/0x7*(-parseInt(_0x386781(0x1fe))/0x8)+parseInt(_0x386781(0x288))/0x9+parseInt(_0x386781(0x26a))/0xa;if(_0x483899===_0x48fb63)break;else _0x30f2e7['push'](_0x30f2e7['shift']());}catch(_0x565be3){_0x30f2e7['push'](_0x30f2e7['shift']());}}}(a40_0x5a4b,0x4475c));var __importDefault=this&&this[a40_0x9a8211(0x294)]||function(_0x27a5bc){return _0x27a5bc&&_0x27a5bc['__esModule']?_0x27a5bc:{'default':_0x27a5bc};};function a40_0x5a4b(){const _0x323603=['📊\x20Calculating\x20payout\x20statistics...','week','statusChangedAt','aggregate','warn','Plisio',']\x20Updating\x20password\x20for\x20user\x20','paidAt','pendingPayout','KLYME\x20DE','\x20became\x20PAID:','📅\x20Payout\x20date\x20to\x20filter:\x20','\x20USDT\x20(total\x20paid\x20to\x20merchants)','toLowerCase','updateCustomerData','log','Username\x20already\x20exists','getAllUsers','custom','ceil','\x20\x20\x20✅\x20Actual\x20available\x20balance:\x20','📅\x20Date\x20from\x20filter:\x20','\x20\x20\x20💳\x20Total\x20payments:\x20','commissionUSDT','getTime','hash','merchantUrl','💳\x20Final\x20payout\x20wallet\x20for\x20','convertToUSDT','\x27\x20->\x20ID\x20\x27','noda','setHours','286424rZJchy','\x20merchants','lte','\x20\x20\x20Merchant\x20gets:\x20','balance','\x20\x20\x20Merchant\x20loses:\x20','count','totalCommissionRate',']\x20Gateway\x20settings\x20JSON\x20string:','turnoverUSDT','%\x20commission)','\x27\x20->\x20name\x20\x27','deleteUser','totalPaidOut','MasterCard','\x20USDT\x20(already\x20paid\x20out)','🎯\x20[','💰\x20Creating\x20payout\x20for\x20shop\x20','ACTIVE','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','publicKey','password','%\x20from\x20','shopId','NONEXISTENT_GATEWAY_FILTER','chargebackAmount','📊\x20Available\x20gateways\x20in\x20database:','customerName','not\x20set',',\x20Commission:\x20','🔐\x20[','failureMessage','REFUND','some','\x20order','cointopay2','mastercard','forEach','paidOutUSDT','💰\x20[PAYOUT]\x20Merchant\x20','payment','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','\x20USDT\x20(','shopUrl','dateTo','\x20PAID\x20payments','gatewayCommissionRate','\x20\x20\x20⏳\x20Pending\x20payout:\x20','🔍\x20Selected\x20erc20\x20wallet:\x20','💰\x20Shop\x20','\x20\x20\x20Current\x20balance:\x20','\x20\x20\x20💰\x20Total\x20payout:\x20','getPayoutStats','0000','whiteUrl','groupBy',',\x20successful:\x20','amount','🔍\x20Creating\x20payout\x20with\x20data:','amountAfterGatewayCommissionUSDT','\x20\x20\x20Full\x20amount:\x20','\x20USDT\x20(rounded\x20to\x202\x20decimal\x20places)','name','not\x20provided','revenue','default','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','klyme_de','614352YzqtTo','insensitive','polygon','CHARGEBACK','gateway','\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)','findMany','\x20\x20\x20🤔\x20Difference:\x20','\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...','generateDailyStatistics','getDate','not\x20specified','period','📊\x20Getting\x20payments\x20with\x20filters:','pendingUrl','🔍\x20Selected\x20erc20_usdc\x20wallet:\x20','PAID','\x20USDT\x20(+','__esModule','gatewayEarnings','amountUSDT','periodTo','reduce','\x20\x20\x20Payout\x20amount:\x20','customerIp','paymentsCount','orderId','Noda','🎯\x20updateUser\x20called\x20with\x20ID:\x20','$transaction','📊\x20Calculated\x20commission\x20rate\x20for\x20payment\x20','usdcErcWallet','_sum','💸\x20CHARGEBACK:\x20Processing\x20penalty-only\x20deduction','push','\x20\x20\x20🌍\x20Country:\x20','randomBytes','klyme_eu','⚠️\x20Payment\x20','🔍\x20Shop\x20wallets:','customerCountry','split','\x20\x20\x20Requested\x20(number):\x20','📋\x20Getting\x20merchants\x20selection\x20list...','getGatewayInternalName','📊\x20Merchant\x20statistics\x20calculated:','getMonth','🔍\x20Initial\x20wallet\x20from\x20request:\x20','join','17144ulOimm','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','year','commission','\x20\x20\x20�\x20Total\x20paid\x20out:\x20','totalPayout','✅\x20Using\x20wallet\x20from\x20request:\x20','\x20USDT\x20(theoretical\x20net)','asc','✅\x20Using\x20gateway\x20filter:\x20\x27','username','activateUser','Payment\x20not\x20found','getGatewayIdByName','\x20USDT,\x20merchant:\x20','adminNotes','KLYME\x20GB','toUpperCase','\x20\x20\x20Total\x20paid\x20out:\x20','findUnique','externalPaymentUrl','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','totalPayments','✅\x20Payout\x20created:\x20','localeCompare','\x20USDT)','usdcPolygonWallet','📋\x20Found\x20','📅\x20Date\x20to\x20filter:\x20','\x20USDT\x20from\x20balance','merchantEarningsUSDT','30d','SUSPENDED','getFullYear','\x20\x20\x20💵\x20Available\x20balance:\x20','\x20USDT\x20(after\x20','\x20payments)','plisio','🔄\x20Gateway\x20mapping\x20(get):','all','Telegram\x20username\x20already\x20exists','thisMonth','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','stringify','erc20_usdc','usdtTrcWallet','\x20USDT','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','usdtErcWallet','totalAmountAfterCommissionUSDT','values','\x20\x20\x20Gateway:\x20','payout','\x20\x20\x20Difference:\x20','\x20for\x20shop\x20','\x27\x20(from\x20\x27','wallet','merchantEarnings','dailyPayments','crypto','\x20->\x20','\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)','error','\x20\x20\x20📅\x20Total\x20payouts\x20(this\x20month):\x20','10pUJKBs','\x20\x20\x20🔍\x20Calculated\x20after\x20commission:\x20','turnover','🔧\x20[','KLYME\x20EU','telegramId','map','📊\x20Using\x20saved\x20values\x20for\x20payment\x20','update','📊\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','getAllPayouts','\x20USDT\x20(gross\x20revenue)','status',']\x20Gateway\x20settings\x20before\x20saving:','💱\x20Currency\x20filter\x20applied:\x20','substr','shop','hex','currency','Test\x20Gateway','test_gateway','setDate','../config/database','totalTurnover','\x20in\x20','slice','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','telegram','round','periodFrom','set','\x20\x20\x20�📊\x20Total\x20payments:\x20','cointopay','📊\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','⚠️\x20Gateway\x20\x27','\x20\x20\x20💰\x20Total\x20turnover:\x20','findFirst','totalAmountUSDT','getGatewayDisplayName','klyme_gb','toISOString','\x20USDT\x20(current\x20balance\x20in\x20DB)','\x20to\x20','📊\x20Gateway\x20filter\x20applied:','1377090sunvny','15MiwVID','70JwQIGM','network','💰\x20Found\x20','\x20USDT,\x20Requested:\x20',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','customerUa','includes','\x20merchants\x20with\x20rounded\x20balance\x20!=\x200.00\x20(excluding\x20balances\x20that\x20round\x20to\x200.00)','\x20\x20\x20💸\x20Total\x20payouts:\x20','538242tJenFz','notes','\x20\x20\x20✅\x20Total\x20net\x20balances:\x20','dateFrom','deletePayout','📊\x20Merchants\x20with\x20rounded\x20balance\x20!=\x200.00:\x20','🔍\x20Selected\x20polygon\x20wallet:\x20','random','day','create','updatedAt','Error\x20processing\x20payment\x20','parse','gatewayOrderId','entries','📅\x20Period:\x20','defineProperty','wallets','toFixed','1207359VPRviV','createdAt','getGatewayNameById','sort','📅\x20Payout\x20date\x20from\x20filter:\x20','suspendUser','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','min','Insufficient\x20balance.\x20Available:\x20','dailyRevenue','📊\x20Sorting\x20payments\x20by\x20','⚠️\x20Requested\x20gateway\x20\x27','__importDefault','🔍\x20Using\x20gateway\x20\x27','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','📊\x20Payout\x20statistics\x20calculated:','🔍\x20Balance\x20check\x20details:','\x20\x20\x20�\x20Total\x20payments\x20turnover:\x20','🔍\x20Selected\x20trc20\x20wallet:\x20','updatePaymentStatus','updateUser','COMPLETED','polygon_usdc','statusChangedBy','customerEmail','gateways','paymentGateways','🔄\x20Converted\x20gateway\x20ID\x20\x27','\x20\x20\x20Added\x20to\x20balance:\x20+','🔄\x20Gateway\x20mapping\x20(create):','toString','usdtPolygonWallet','amountAfterCommissionUSDT',':\x20commission\x20=\x20','CoinToPay','awaitingPayout','gatewaySettings','getMerchantStatistics','getUserById','delete','_count','averageCommissionRate','145857JcbmIn','\x27\x20to\x20name\x20\x27','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','✅\x20Payout\x20created\x20in\x20DB:','getMerchantsSelection','payouts','currencyService','gte','getAllPayments','\x20\x20\x20💸\x20Total\x20payouts\x20(all\x20time):\x20','\x20USDT\x20(same\x20as\x20awaiting)','\x20USDT\x20for\x20payment\x20','getPaymentById','availableBalance','txid','\x20balance\x20updated:\x20','\x20\x20\x20Tolerance:\x20','\x20\x20\x20📅\x20This\x20month:\x20','fullName','desc','\x20\x20\x20Final\x20payout\x20amount\x20used:\x20','yesterday','sk_','averageCheckUSDT','⚠️\x20CHARGEBACK\x20without\x20penalty\x20amount\x20-\x20no\x20balance\x20change','length','💰\x20Payment\x20'];a40_0x5a4b=function(){return _0x323603;};return a40_0x5a4b();}Object[a40_0x9a8211(0x285)](exports,a40_0x9a8211(0x343),{'value':!![]}),exports['AdminService']=void 0x0;const database_1=__importDefault(require(a40_0x9a8211(0x254))),bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a40_0x9a8211(0x239))),currencyService_1=require('./currencyService'),gateway_1=require('../types/gateway');class AdminService{async[a40_0x9a8211(0x321)](){const _0x3d663e=a40_0x9a8211;console['log'](_0x3d663e(0x2cd));const _0x4c07fd=await database_1[_0x3d663e(0x32e)][_0x3d663e(0x24e)][_0x3d663e(0x2d0)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x3d663e(0x2ff)}}),_0x167bdd=await database_1['default'][_0x3d663e(0x315)][_0x3d663e(0x2f3)]({'where':{'status':'PAID','gateway':{'not':_0x3d663e(0x252)}}}),_0x4db187=new Date(),_0x5d1694=new Date(_0x4db187[_0x3d663e(0x21f)](),_0x4db187[_0x3d663e(0x1fb)](),0x1),_0x2db46b=new Date(_0x4db187['getFullYear'](),_0x4db187[_0x3d663e(0x1fb)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0xedd7fb=await database_1[_0x3d663e(0x32e)][_0x3d663e(0x232)][_0x3d663e(0x2d0)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x5d1694,'lte':_0x2db46b},'status':_0x3d663e(0x29d)}}),_0x52ba05=_0x4c07fd[_0x3d663e(0x351)]['totalPaidOut']||0x0,_0x542ca8=_0x4c07fd[_0x3d663e(0x351)][_0x3d663e(0x2f1)]||0x0,_0x3b814a=_0xedd7fb[_0x3d663e(0x351)][_0x3d663e(0x326)]||0x0,_0x57bb92={'totalPayout':Math[_0x3d663e(0x25a)](_0x52ba05*0x64)/0x64,'awaitingPayout':Math[_0x3d663e(0x25a)](_0x542ca8*0x64)/0x64,'thisMonth':Math['round'](_0x3b814a*0x64)/0x64,'availableBalance':Math[_0x3d663e(0x25a)](_0x542ca8*0x64)/0x64,'totalPayments':_0x167bdd};return console[_0x3d663e(0x2dc)](_0x3d663e(0x297)),console['log'](_0x3d663e(0x320)+_0x57bb92[_0x3d663e(0x203)]+_0x3d663e(0x2d9)),console['log']('\x20\x20\x20⏳\x20Awaiting\x20payout:\x20'+_0x57bb92[_0x3d663e(0x2ab)]+_0x3d663e(0x23b)),console[_0x3d663e(0x2dc)](_0x3d663e(0x220)+_0x57bb92[_0x3d663e(0x2bf)]+_0x3d663e(0x2bc)),console[_0x3d663e(0x2dc)](_0x3d663e(0x2c3)+_0x57bb92[_0x3d663e(0x227)]+_0x3d663e(0x22c)),console[_0x3d663e(0x2dc)](_0x3d663e(0x2e3)+_0x57bb92[_0x3d663e(0x214)]+_0x3d663e(0x31a)),_0x57bb92;}async[a40_0x9a8211(0x2db)](_0x41e0c4,_0x5a02c9){const _0x18bd47=a40_0x9a8211;console[_0x18bd47(0x2dc)]('🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20'+_0x41e0c4+':',_0x5a02c9);const _0x157284=await database_1[_0x18bd47(0x32e)][_0x18bd47(0x315)][_0x18bd47(0x211)]({'where':{'id':_0x41e0c4},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x157284)throw new Error(_0x18bd47(0x20a));const _0x251b95={};_0x5a02c9[_0x18bd47(0x1f5)]!==undefined&&(_0x251b95[_0x18bd47(0x1f5)]=_0x5a02c9[_0x18bd47(0x1f5)]||null);_0x5a02c9[_0x18bd47(0x349)]!==undefined&&(_0x251b95[_0x18bd47(0x349)]=_0x5a02c9[_0x18bd47(0x349)]||null);_0x5a02c9[_0x18bd47(0x271)]!==undefined&&(_0x251b95[_0x18bd47(0x271)]=_0x5a02c9[_0x18bd47(0x271)]||null);const _0x4aab54=await database_1[_0x18bd47(0x32e)][_0x18bd47(0x315)][_0x18bd47(0x246)]({'where':{'id':_0x41e0c4},'data':{..._0x251b95,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x18bd47(0x2dc)](_0x18bd47(0x213)+_0x41e0c4),console[_0x18bd47(0x2dc)](_0x18bd47(0x354)+_0x157284[_0x18bd47(0x1f5)]+_0x18bd47(0x23a)+_0x4aab54[_0x18bd47(0x1f5)]),console['log']('\x20\x20\x20🌐\x20IP:\x20'+_0x157284[_0x18bd47(0x349)]+'\x20->\x20'+_0x4aab54[_0x18bd47(0x349)]),console['log']('\x20\x20\x20🖥️\x20User\x20Agent:\x20'+(_0x157284[_0x18bd47(0x271)]?_0x18bd47(0x25c):_0x18bd47(0x309))+_0x18bd47(0x23a)+(_0x4aab54[_0x18bd47(0x271)]?_0x18bd47(0x25c):_0x18bd47(0x309))),_0x4aab54;}async['getSystemStatistics'](_0x477071){const _0x286744=a40_0x9a8211,_0x503412=new Date();let _0x53308b;switch(_0x477071['toLowerCase']()){case _0x286744(0x27d):_0x53308b=new Date(_0x503412[_0x286744(0x21f)](),_0x503412[_0x286744(0x1fb)](),_0x503412[_0x286744(0x33b)](),0x0,0x0,0x0,0x0);break;case _0x286744(0x2c7):const _0xc5598e=new Date(_0x503412);_0xc5598e[_0x286744(0x253)](_0xc5598e['getDate']()-0x1),_0x53308b=new Date(_0xc5598e[_0x286744(0x21f)](),_0xc5598e[_0x286744(0x1fb)](),_0xc5598e[_0x286744(0x33b)](),0x0,0x0,0x0,0x0);break;case'7d':_0x53308b=new Date(_0x503412[_0x286744(0x2e5)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x286744(0x21d):_0x53308b=new Date(_0x503412[_0x286744(0x2e5)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'90d':_0x53308b=new Date(_0x503412[_0x286744(0x2e5)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x286744(0x225):const _0x4522da=await database_1[_0x286744(0x32e)][_0x286744(0x315)]['findFirst']({'where':{'gateway':{'not':_0x286744(0x252)}},'orderBy':{'createdAt':_0x286744(0x206)},'select':{'createdAt':!![]}});_0x53308b=_0x4522da?_0x4522da[_0x286744(0x289)]:new Date('2020-01-01');break;default:_0x53308b=new Date(_0x503412[_0x286744(0x2e5)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}_0x53308b[_0x286744(0x2ec)](0x0,0x0,0x0,0x0);let _0x2dfa14;if(_0x477071[_0x286744(0x2da)]()==='yesterday'){const _0x4bf2da=new Date(_0x503412);_0x4bf2da[_0x286744(0x253)](_0x4bf2da['getDate']()-0x1),_0x2dfa14=new Date(_0x4bf2da[_0x286744(0x21f)](),_0x4bf2da[_0x286744(0x1fb)](),_0x4bf2da[_0x286744(0x33b)](),0x17,0x3b,0x3b,0x3e7);}const _0x46e4cd={'gte':_0x53308b};_0x2dfa14&&(_0x46e4cd[_0x286744(0x2ef)]=_0x2dfa14);const [_0x194635,_0x5bf877,_0x1bfd0c,_0xd032fa,_0xf99495,_0x39ac4a]=await Promise['all']([database_1[_0x286744(0x32e)]['shop'][_0x286744(0x2f3)](),database_1['default'][_0x286744(0x24e)]['count']({'where':{'status':_0x286744(0x2ff)}}),database_1[_0x286744(0x32e)]['payment'][_0x286744(0x2f3)]({'where':{'status':_0x286744(0x341),'createdAt':_0x46e4cd,'gateway':{'not':_0x286744(0x252)}}}),database_1[_0x286744(0x32e)][_0x286744(0x315)][_0x286744(0x337)]({'where':{'status':_0x286744(0x341),'createdAt':_0x46e4cd,'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x286744(0x32e)][_0x286744(0x315)][_0x286744(0x337)]({'where':{'gateway':{'not':_0x286744(0x252)}},'take':0xa,'orderBy':{'createdAt':_0x286744(0x2c5)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x286744(0x32e)][_0x286744(0x315)][_0x286744(0x337)]({'where':{'createdAt':_0x46e4cd,'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x3cc2a8=0x0,_0x5b093f=0x0;for(const _0x22fc67 of _0xd032fa){const _0x3910e7=await currencyService_1[_0x286744(0x2b8)][_0x286744(0x2e9)](_0x22fc67[_0x286744(0x326)],_0x22fc67[_0x286744(0x250)]);_0x3cc2a8+=_0x3910e7;if(_0x22fc67['amountAfterGatewayCommissionUSDT']){const _0x1dbaef=await currencyService_1['currencyService'][_0x286744(0x2e9)](_0x22fc67['amount'],_0x22fc67[_0x286744(0x250)]),_0x5128fb=_0x22fc67['amountAfterGatewayCommissionUSDT'],_0x230f69=_0x1dbaef-_0x5128fb;_0x5b093f+=_0x230f69;}}const _0xea9a2f=_0x1bfd0c>0x0?_0x3cc2a8/_0x1bfd0c:0x0,_0x5abb65=this['generateDailyStatistics'](_0x39ac4a,_0x53308b,_0x2dfa14||_0x503412),_0x24715f=await database_1['default']['payment'][_0x286744(0x2f3)]({'where':{'createdAt':_0x46e4cd,'gateway':{'not':_0x286744(0x252)}}}),_0x32a436=_0x24715f>0x0?_0x1bfd0c/_0x24715f*0x64:0x0;return{'totalShops':_0x194635,'activeShops':_0x5bf877,'totalPayments':_0x1bfd0c,'successfulPayments':_0x1bfd0c,'totalAttempts':_0x24715f,'totalRevenue':Math['round'](_0x3cc2a8*0x64)/0x64,'trapayEarnings':Math[_0x286744(0x25a)](_0x5b093f*0x64)/0x64,'averagePaymentAmount':Math[_0x286744(0x25a)](_0xea9a2f*0x64)/0x64,'conversionRate':Math[_0x286744(0x25a)](_0x32a436*0x64)/0x64,'dailyRevenue':_0x5abb65[_0x286744(0x291)],'dailyPayments':_0x5abb65[_0x286744(0x238)],'recentPayments':_0xf99495['map'](_0x5a9ed2=>({'id':_0x5a9ed2['id'],'amount':_0x5a9ed2[_0x286744(0x326)],'currency':_0x5a9ed2[_0x286744(0x250)],'status':_0x5a9ed2[_0x286744(0x24a)],'gateway':_0x5a9ed2[_0x286744(0x335)],'shop':_0x5a9ed2[_0x286744(0x24e)],'createdAt':_0x5a9ed2[_0x286744(0x289)]}))};}async[a40_0x9a8211(0x2ad)](_0x5bd65f){const _0x392363=a40_0x9a8211;console[_0x392363(0x2dc)](_0x392363(0x316),_0x5bd65f);let _0x3dc1f4,_0x5807=new Date();if(_0x5bd65f[_0x392363(0x33d)]===_0x392363(0x2df)&&_0x5bd65f[_0x392363(0x278)]&&_0x5bd65f[_0x392363(0x319)])_0x3dc1f4=new Date(_0x5bd65f['dateFrom']),_0x5807=new Date(_0x5bd65f[_0x392363(0x319)]),_0x3dc1f4[_0x392363(0x2ec)](0x0,0x0,0x0,0x0),_0x5807[_0x392363(0x2ec)](0x17,0x3b,0x3b,0x3e7);else{const _0x29150d=new Date();switch(_0x5bd65f[_0x392363(0x33d)]){case _0x392363(0x2ce):_0x3dc1f4=new Date(_0x29150d[_0x392363(0x2e5)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'month':_0x3dc1f4=new Date(_0x29150d['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x392363(0x200):_0x3dc1f4=new Date(_0x29150d[_0x392363(0x2e5)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x392363(0x225):default:_0x3dc1f4=new Date('2020-01-01');break;}_0x3dc1f4[_0x392363(0x2ec)](0x0,0x0,0x0,0x0),_0x5807['setHours'](0x17,0x3b,0x3b,0x3e7);}console[_0x392363(0x2dc)](_0x392363(0x284)+_0x3dc1f4[_0x392363(0x266)]()+_0x392363(0x268)+_0x5807[_0x392363(0x266)]());const _0xe6346d={'status':'PAID','gateway':{'not':_0x392363(0x252)},'paidAt':{'gte':_0x3dc1f4,'lte':_0x5807}};_0x5bd65f[_0x392363(0x304)]&&(_0xe6346d[_0x392363(0x304)]=_0x5bd65f[_0x392363(0x304)]);const _0x4ae4d7=await database_1[_0x392363(0x32e)][_0x392363(0x315)][_0x392363(0x337)]({'where':_0xe6346d,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x392363(0x2dc)](_0x392363(0x26e)+_0x4ae4d7['length']+'\x20paid\x20payments\x20for\x20analysis');const _0x56ae41={'gateway':{'not':_0x392363(0x252)},'createdAt':{'gte':_0x3dc1f4,'lte':_0x5807}};_0x5bd65f[_0x392363(0x304)]&&(_0x56ae41[_0x392363(0x304)]=_0x5bd65f[_0x392363(0x304)]);const _0x20be62=await database_1['default']['payment'][_0x392363(0x2f3)]({'where':_0x56ae41});console[_0x392363(0x2dc)]('📊\x20Total\x20payments\x20(including\x20failed):\x20'+_0x20be62+_0x392363(0x325)+_0x4ae4d7['length']);let _0x27ed5b=0x0,_0x354632=0x0,_0x44338b=0x0;const _0x1a3336={},_0x6d9997={},_0x219caf={};for(const _0x3de1ab of _0x4ae4d7){try{const _0xc09494=_0x3de1ab[_0x392363(0x345)]||0x0;if(_0xc09494<=0x0){console[_0x392363(0x2d1)]('⚠️\x20Payment\x20'+_0x3de1ab['id']+_0x392363(0x339));continue;}let _0x5a33b3,_0x4a98d1;if(_0x3de1ab[_0x392363(0x328)]!==null&&_0x3de1ab[_0x392363(0x328)]!==undefined)_0x5a33b3=_0x3de1ab[_0x392363(0x328)],_0x4a98d1=_0xc09494-_0x5a33b3,console[_0x392363(0x2dc)](_0x392363(0x245)+_0x3de1ab['id']+':\x20'+_0xc09494[_0x392363(0x287)](0x6)+_0x392363(0x20c)+_0x5a33b3['toFixed'](0x6)+'\x20USDT');else{let _0x401f59={};if(_0x3de1ab[_0x392363(0x24e)]['gatewaySettings'])try{_0x401f59=JSON[_0x392363(0x281)](_0x3de1ab[_0x392363(0x24e)][_0x392363(0x2ac)]);}catch(_0x499445){console[_0x392363(0x23c)](_0x392363(0x258)+_0x3de1ab[_0x392363(0x304)]+':',_0x499445);}let _0x70ff8=0x2d;for(const [_0x426f1b,_0x1c223e]of Object[_0x392363(0x283)](_0x401f59)){if(_0x426f1b[_0x392363(0x2da)]()===_0x3de1ab['gateway'][_0x392363(0x2da)]()){_0x70ff8=_0x1c223e['commission']||0x2d;break;}}_0x4a98d1=_0xc09494*(_0x70ff8/0x64),_0x5a33b3=_0xc09494-_0x4a98d1,console[_0x392363(0x2dc)](_0x392363(0x25f)+_0x3de1ab['id']+':\x20'+_0x70ff8+_0x392363(0x303)+_0xc09494[_0x392363(0x287)](0x6)+'\x20USDT');}_0x27ed5b+=_0xc09494,_0x354632+=_0x5a33b3,_0x44338b+=_0x4a98d1;let _0x310e64;_0x3de1ab['gatewayCommissionRate']!==null&&_0x3de1ab[_0x392363(0x31b)]!==undefined?(_0x310e64=_0x3de1ab['gatewayCommissionRate'],console[_0x392363(0x2dc)]('📊\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20'+_0x3de1ab['id']+':\x20'+_0x310e64+'%')):(_0x310e64=_0xc09494>0x0?_0x4a98d1/_0xc09494*0x64:0x0,console[_0x392363(0x2dc)](_0x392363(0x34f)+_0x3de1ab['id']+':\x20'+_0x310e64[_0x392363(0x287)](0x2)+'%'));!_0x1a3336[_0x3de1ab[_0x392363(0x335)]]&&(_0x1a3336[_0x3de1ab['gateway']]={'gateway':_0x3de1ab[_0x392363(0x335)],'gatewayDisplayName':this[_0x392363(0x264)](_0x3de1ab['gateway']),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x1a3336[_0x3de1ab[_0x392363(0x335)]]['paymentsCount']++,_0x1a3336[_0x3de1ab[_0x392363(0x335)]][_0x392363(0x2f6)]+=_0xc09494,_0x1a3336[_0x3de1ab[_0x392363(0x335)]][_0x392363(0x2e4)]+=_0x4a98d1,_0x1a3336[_0x3de1ab[_0x392363(0x335)]]['merchantEarningsUSDT']+=_0x5a33b3,_0x1a3336[_0x3de1ab[_0x392363(0x335)]]['totalCommissionRate']+=_0x310e64;!_0x5bd65f[_0x392363(0x304)]&&(!_0x6d9997[_0x3de1ab['shopId']]&&(_0x6d9997[_0x3de1ab[_0x392363(0x304)]]={'shopId':_0x3de1ab[_0x392363(0x304)],'shopName':_0x3de1ab[_0x392363(0x24e)]['name'],'shopUsername':_0x3de1ab['shop'][_0x392363(0x208)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x6d9997[_0x3de1ab[_0x392363(0x304)]][_0x392363(0x34a)]++,_0x6d9997[_0x3de1ab['shopId']][_0x392363(0x2f6)]+=_0xc09494,_0x6d9997[_0x3de1ab[_0x392363(0x304)]][_0x392363(0x2e4)]+=_0x4a98d1,_0x6d9997[_0x3de1ab[_0x392363(0x304)]][_0x392363(0x21c)]+=_0x5a33b3);const _0x3d1780=_0x3de1ab[_0x392363(0x2d4)][_0x392363(0x266)]()[_0x392363(0x1f6)]('T')[0x0];!_0x219caf[_0x3d1780]&&(_0x219caf[_0x3d1780]={'date':_0x3d1780,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x219caf[_0x3d1780][_0x392363(0x240)]+=_0xc09494,_0x219caf[_0x3d1780]['merchantEarnings']+=_0x5a33b3,_0x219caf[_0x3d1780]['gatewayEarnings']+=_0x4a98d1,_0x219caf[_0x3d1780][_0x392363(0x34a)]++;}catch(_0x224fbf){console['error'](_0x392363(0x280)+_0x3de1ab['id']+':',_0x224fbf);}}Object[_0x392363(0x230)](_0x1a3336)[_0x392363(0x312)](_0x283fa8=>{const _0x3ac054=_0x392363;_0x283fa8['averageCommissionRate']=_0x283fa8[_0x3ac054(0x34a)]>0x0?_0x283fa8['totalCommissionRate']/_0x283fa8[_0x3ac054(0x34a)]:0x0,delete _0x283fa8[_0x3ac054(0x2f4)];}),Object['values'](_0x6d9997)[_0x392363(0x312)](_0x48905e=>{const _0x11d7da=_0x392363;_0x48905e[_0x11d7da(0x2c9)]=_0x48905e[_0x11d7da(0x34a)]>0x0?_0x48905e[_0x11d7da(0x2f6)]/_0x48905e[_0x11d7da(0x34a)]:0x0;});let _0x374f6d=0x0,_0x3e0698=0x0;if(_0x5bd65f['shopId']){const _0x12eb8d=await database_1[_0x392363(0x32e)][_0x392363(0x232)][_0x392363(0x337)]({'where':{'shopId':_0x5bd65f['shopId'],'status':_0x392363(0x29d),'createdAt':{'gte':_0x3dc1f4,'lte':_0x5807}},'select':{'amount':!![]}});_0x374f6d=_0x12eb8d[_0x392363(0x347)]((_0x2535a5,_0x26d6d2)=>_0x2535a5+_0x26d6d2[_0x392363(0x326)],0x0);const _0x280129=await database_1['default'][_0x392363(0x232)][_0x392363(0x337)]({'where':{'shopId':_0x5bd65f[_0x392363(0x304)],'status':'PENDING','createdAt':{'gte':_0x3dc1f4,'lte':_0x5807}},'select':{'amount':!![]}});_0x3e0698=_0x280129[_0x392363(0x347)]((_0x5095c5,_0x290fa4)=>_0x5095c5+_0x290fa4[_0x392363(0x326)],0x0);}const _0x2704e5=_0x20be62,_0x39ab53=_0x4ae4d7[_0x392363(0x2cb)],_0x4738de=_0x39ab53>0x0?_0x27ed5b/_0x39ab53:0x0,_0x5629cf=_0x2704e5>0x0?Math[_0x392363(0x25a)](_0x39ab53/_0x2704e5*0x2710)/0x64:0x0,_0x71f8bb=Math[_0x392363(0x2e0)]((_0x5807[_0x392363(0x2e5)]()-_0x3dc1f4[_0x392363(0x2e5)]())/(0x3e8*0x3c*0x3c*0x18)),_0x27058f={'totalTurnover':Math[_0x392363(0x25a)](_0x27ed5b*0x64)/0x64,'merchantEarnings':Math[_0x392363(0x25a)](_0x354632*0x64)/0x64,'gatewayEarnings':Math['round'](_0x44338b*0x64)/0x64,'totalPaidOut':Math[_0x392363(0x25a)](_0x374f6d*0x64)/0x64,'pendingPayout':Math['round'](_0x3e0698*0x64)/0x64,'averageCheck':Math[_0x392363(0x25a)](_0x4738de*0x64)/0x64,'totalPayments':_0x2704e5,'successfulPayments':_0x39ab53,'conversionRate':_0x5629cf,'gatewayBreakdown':Object[_0x392363(0x230)](_0x1a3336)[_0x392363(0x244)](_0x220011=>({..._0x220011,'turnoverUSDT':Math[_0x392363(0x25a)](_0x220011['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x392363(0x25a)](_0x220011[_0x392363(0x2e4)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x220011['merchantEarningsUSDT']*0x64)/0x64,'averageCommissionRate':Math[_0x392363(0x25a)](_0x220011[_0x392363(0x2b1)]*0x64)/0x64})),'merchantBreakdown':_0x5bd65f['shopId']?undefined:Object[_0x392363(0x230)](_0x6d9997)['map'](_0x33c803=>({..._0x33c803,'turnoverUSDT':Math[_0x392363(0x25a)](_0x33c803[_0x392363(0x2f6)]*0x64)/0x64,'commissionUSDT':Math[_0x392363(0x25a)](_0x33c803['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x33c803[_0x392363(0x21c)]*0x64)/0x64,'paidOutUSDT':Math[_0x392363(0x25a)](_0x33c803[_0x392363(0x313)]*0x64)/0x64,'averageCheckUSDT':Math[_0x392363(0x25a)](_0x33c803['averageCheckUSDT']*0x64)/0x64})),'dailyData':Object[_0x392363(0x230)](_0x219caf)[_0x392363(0x244)](_0x2adefd=>({..._0x2adefd,'turnover':Math[_0x392363(0x25a)](_0x2adefd['turnover']*0x64)/0x64,'merchantEarnings':Math[_0x392363(0x25a)](_0x2adefd['merchantEarnings']*0x64)/0x64,'gatewayEarnings':Math[_0x392363(0x25a)](_0x2adefd[_0x392363(0x344)]*0x64)/0x64}))[_0x392363(0x28b)]((_0x4167af,_0x50e373)=>_0x4167af['date'][_0x392363(0x216)](_0x50e373['date'])),'periodInfo':{'from':_0x3dc1f4,'to':_0x5807,'periodType':_0x5bd65f['period']||_0x392363(0x2df),'daysCount':_0x71f8bb}};return console[_0x392363(0x2dc)](_0x392363(0x1fa)),console[_0x392363(0x2dc)](_0x392363(0x261)+_0x27058f[_0x392363(0x255)]+_0x392363(0x22c)),console[_0x392363(0x2dc)](_0x392363(0x296)+_0x27058f[_0x392363(0x237)]+_0x392363(0x22c)),console[_0x392363(0x2dc)](_0x392363(0x300)+_0x27058f[_0x392363(0x344)]+_0x392363(0x22c)),console['log'](_0x392363(0x202)+_0x27058f[_0x392363(0x2fa)]+'\x20USDT'),console[_0x392363(0x2dc)](_0x392363(0x31c)+_0x27058f[_0x392363(0x2d5)]+_0x392363(0x22c)),console['log'](_0x392363(0x25d)+_0x27058f['totalPayments']),_0x27058f;}async[a40_0x9a8211(0x2b6)](_0x113fca){const _0x14e8eb=a40_0x9a8211;console[_0x14e8eb(0x2dc)](_0x14e8eb(0x1f8),{'hasPayoutHistory':_0x113fca});let _0x379617={'status':_0x14e8eb(0x2ff)};_0x113fca&&(_0x379617[_0x14e8eb(0x2b7)]={'some':{}});const _0x117619=await database_1['default']['shop']['findMany']({'where':_0x379617,'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x14e8eb(0x206)}});return console[_0x14e8eb(0x2dc)](_0x14e8eb(0x219)+_0x117619[_0x14e8eb(0x2cb)]+'\x20active\x20merchants\x20for\x20selection'+(_0x113fca?'\x20with\x20payout\x20history':'')),_0x117619[_0x14e8eb(0x244)](_0x161eeb=>({'id':_0x161eeb['id'],'username':_0x161eeb[_0x14e8eb(0x208)],'name':_0x161eeb['name']}));}[a40_0x9a8211(0x264)](_0x4690d8){const _0x6678f4=a40_0x9a8211,_0xc61617={'test_gateway':_0x6678f4(0x251),'plisio':_0x6678f4(0x2d2),'rapyd':'Rapyd','noda':_0x6678f4(0x34c),'cointopay':_0x6678f4(0x2aa),'cointopay2':'Open\x20Banking\x202','klyme_eu':_0x6678f4(0x242),'klyme_gb':_0x6678f4(0x20e),'klyme_de':_0x6678f4(0x2d6),'mastercard':_0x6678f4(0x2fb)};return _0xc61617[_0x4690d8]||_0x4690d8;}[a40_0x9a8211(0x1f9)](_0x4710e3){const _0x168994=a40_0x9a8211,_0x3488ff={'Test\x20Gateway':_0x168994(0x252),'Plisio':_0x168994(0x223),'Rapyd':'rapyd','Noda':_0x168994(0x2eb),'CoinToPay':_0x168994(0x25e),'CoinToPay2':_0x168994(0x310),'KLYME\x20EU':_0x168994(0x1f2),'KLYME\x20GB':_0x168994(0x265),'KLYME\x20DE':_0x168994(0x330),'MasterCard':_0x168994(0x311)};return _0x3488ff[_0x4710e3]||_0x4710e3[_0x168994(0x2da)]();}async['getMerchantsAwaitingPayout'](_0xa199f1){const _0x501459=a40_0x9a8211,{page:_0xca0d50,limit:_0x278f2d,minAmount:_0xe668d1,search:_0xf1db39}=_0xa199f1;console[_0x501459(0x2dc)](_0x501459(0x28e),_0xa199f1);let _0x2065a8={'status':'ACTIVE'};_0xf1db39&&(_0x2065a8[_0x501459(0x32b)]={'contains':_0xf1db39,'mode':_0x501459(0x332)});const _0x23fb0d=await database_1[_0x501459(0x32e)][_0x501459(0x24e)][_0x501459(0x337)]({'where':_0x2065a8,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),_0x23c9b4=_0x23fb0d['filter'](_0x4f6601=>{const _0x6d0cb8=Math['round'](_0x4f6601['balance']*0x64)/0x64;if(_0xe668d1&&_0x6d0cb8<_0xe668d1)return![];return _0x6d0cb8!==0x0;});_0x23c9b4['sort']((_0x434d7b,_0x3b891)=>_0x3b891[_0x501459(0x2f1)]-_0x434d7b[_0x501459(0x2f1)]);const _0xd11a6b=_0x23c9b4[_0x501459(0x2cb)],_0x170e26=(_0xca0d50-0x1)*_0x278f2d,_0xad0e14=_0x23c9b4[_0x501459(0x257)](_0x170e26,_0x170e26+_0x278f2d);console[_0x501459(0x2dc)]('💰\x20Found\x20'+_0xad0e14['length']+_0x501459(0x273));const _0x1d8479=await Promise['all'](_0xad0e14[_0x501459(0x244)](async _0x132e3f=>{const _0x33f136=_0x501459,[_0x1cfa31,_0x5586bb,_0x4519e8]=await Promise[_0x33f136(0x225)]([database_1[_0x33f136(0x32e)][_0x33f136(0x315)][_0x33f136(0x2f3)]({'where':{'shopId':_0x132e3f['id'],'status':_0x33f136(0x341),'gateway':{'not':_0x33f136(0x252)}}}),database_1[_0x33f136(0x32e)][_0x33f136(0x315)][_0x33f136(0x262)]({'where':{'shopId':_0x132e3f['id'],'status':_0x33f136(0x341),'gateway':{'not':'test_gateway'}},'orderBy':{'paidAt':'asc'},'select':{'paidAt':!![]}}),database_1[_0x33f136(0x32e)][_0x33f136(0x315)][_0x33f136(0x324)]({'by':['gateway'],'where':{'shopId':_0x132e3f['id'],'status':_0x33f136(0x341),'gateway':{'not':_0x33f136(0x252)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x2d891e=new Date(),_0xc8e17d=new Date(_0x2d891e['getFullYear'](),_0x2d891e[_0x33f136(0x1fb)](),0x1),_0x2f5100=new Date(_0x2d891e['getFullYear'](),_0x2d891e['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x533be8,_0x19aa0d]=await Promise['all']([database_1[_0x33f136(0x32e)][_0x33f136(0x232)][_0x33f136(0x2d0)]({'_sum':{'amount':!![]},'where':{'shopId':_0x132e3f['id'],'status':_0x33f136(0x29d)}}),database_1[_0x33f136(0x32e)][_0x33f136(0x232)][_0x33f136(0x2d0)]({'_sum':{'amount':!![]},'where':{'shopId':_0x132e3f['id'],'status':_0x33f136(0x29d),'createdAt':{'gte':_0xc8e17d,'lte':_0x2f5100}}})]),_0x3f779a=_0x533be8[_0x33f136(0x351)][_0x33f136(0x326)]||0x0,_0x13eea3=_0x19aa0d['_sum'][_0x33f136(0x326)]||0x0,_0x4b2446=await Promise[_0x33f136(0x225)](_0x4519e8[_0x33f136(0x244)](async _0x28ef73=>{const _0x373dcc=_0x33f136;let _0x18be38=0x2d;if(_0x132e3f[_0x373dcc(0x2ac)])try{const _0x259abf=JSON['parse'](_0x132e3f[_0x373dcc(0x2ac)]);for(const [_0x1443f0,_0x59f56a]of Object[_0x373dcc(0x283)](_0x259abf)){if(_0x1443f0[_0x373dcc(0x2da)]()===_0x28ef73[_0x373dcc(0x335)][_0x373dcc(0x2da)]()){_0x18be38=_0x59f56a[_0x373dcc(0x201)]||0xa,console[_0x373dcc(0x2dc)]('💰\x20[PAYOUT]\x20Gateway\x20'+_0x28ef73[_0x373dcc(0x335)]+_0x373dcc(0x234)+_0x132e3f['id']+_0x373dcc(0x2a9)+_0x18be38+'%');break;}}}catch(_0x3b0196){console[_0x373dcc(0x23c)](_0x373dcc(0x258)+_0x132e3f['id']+':',_0x3b0196);}const _0x764aac=_0x28ef73[_0x373dcc(0x351)]?.[_0x373dcc(0x345)]||0x0,_0x1150a2=_0x764aac*(0x1-_0x18be38/0x64);return{'gateway':_0x28ef73[_0x373dcc(0x335)],'count':_0x28ef73[_0x373dcc(0x2b0)]?.['id']||0x0,'amountUSDT':Math[_0x373dcc(0x25a)](_0x764aac*0x64)/0x64,'amountAfterCommissionUSDT':Math['round'](_0x1150a2*0x64)/0x64,'commission':_0x18be38};})),_0x604016=_0x4b2446[_0x33f136(0x347)]((_0x13adfd,_0x1a558a)=>_0x13adfd+_0x1a558a[_0x33f136(0x345)],0x0),_0x278f0f=_0x4b2446['reduce']((_0x55c5e0,_0x408e52)=>_0x55c5e0+_0x408e52[_0x33f136(0x2a8)],0x0),_0x3013b8=_0x132e3f[_0x33f136(0x2f1)];return console[_0x33f136(0x2dc)](_0x33f136(0x314)+_0x132e3f['username']+':'),console[_0x33f136(0x2dc)](_0x33f136(0x299)+_0x604016['toFixed'](0x2)+_0x33f136(0x249)),console[_0x33f136(0x2dc)](_0x33f136(0x23f)+_0x278f0f[_0x33f136(0x287)](0x2)+_0x33f136(0x205)),console[_0x33f136(0x2dc)](_0x33f136(0x2e1)+_0x3013b8[_0x33f136(0x287)](0x2)+_0x33f136(0x267)),console['log'](_0x33f136(0x274)+_0x3f779a[_0x33f136(0x287)](0x2)+_0x33f136(0x2fc)),console['log'](_0x33f136(0x338)+(_0x278f0f-_0x3f779a-_0x3013b8)[_0x33f136(0x287)](0x2)+_0x33f136(0x336)),{'id':_0x132e3f['id'],'fullName':_0x132e3f[_0x33f136(0x32b)],'username':_0x132e3f['username'],'telegramId':_0x132e3f[_0x33f136(0x259)],'merchantUrl':_0x132e3f[_0x33f136(0x318)],'wallets':{'usdtPolygonWallet':_0x132e3f['usdtPolygonWallet'],'usdtTrcWallet':_0x132e3f[_0x33f136(0x22b)],'usdtErcWallet':_0x132e3f[_0x33f136(0x22e)],'usdcPolygonWallet':_0x132e3f[_0x33f136(0x218)],'usdcErcWallet':_0x132e3f[_0x33f136(0x350)]},'totalAmountUSDT':Math['round'](_0x604016*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x33f136(0x25a)](_0x278f0f*0x64)/0x64,'currentBalance':Math[_0x33f136(0x25a)](_0x3013b8*0x64)/0x64,'totalPayout':Math[_0x33f136(0x25a)](_0x3f779a*0x64)/0x64,'thisMonth':Math[_0x33f136(0x25a)](_0x13eea3*0x64)/0x64,'paymentsCount':_0x1cfa31,'oldestPaymentDate':_0x5586bb?.[_0x33f136(0x2d4)]||_0x132e3f[_0x33f136(0x289)],'gatewayBreakdown':_0x4b2446};})),_0x36ead2=_0x1d8479['reduce']((_0x137ce7,_0x178bcc)=>_0x137ce7+_0x178bcc[_0x501459(0x263)],0x0),_0x26c4f3=_0x1d8479['reduce']((_0x45b963,_0x1d5920)=>_0x45b963+_0x1d5920[_0x501459(0x22f)],0x0),_0xb632d9=_0x1d8479['reduce']((_0x21fb1e,_0x415805)=>_0x21fb1e+_0x415805[_0x501459(0x203)],0x0),_0x2e1627=_0x1d8479[_0x501459(0x347)]((_0x43ac64,_0x55efeb)=>_0x43ac64+_0x55efeb['thisMonth'],0x0);return console[_0x501459(0x2dc)](_0x501459(0x27a)+_0xd11a6b+_0x501459(0x2ee)),console[_0x501459(0x2dc)]('\x20\x20\x20💰\x20Total\x20payments\x20turnover:\x20'+Math[_0x501459(0x25a)](_0x36ead2*0x64)/0x64+'\x20USDT\x20(gross\x20revenue)'),console[_0x501459(0x2dc)](_0x501459(0x277)+Math[_0x501459(0x25a)](_0x26c4f3*0x64)/0x64+_0x501459(0x32a)),console[_0x501459(0x2dc)](_0x501459(0x2bb)+Math[_0x501459(0x25a)](_0xb632d9*0x64)/0x64+_0x501459(0x22c)),console[_0x501459(0x2dc)](_0x501459(0x23d)+Math[_0x501459(0x25a)](_0x2e1627*0x64)/0x64+_0x501459(0x22c)),{'merchants':_0x1d8479,'pagination':{'page':_0xca0d50,'limit':_0x278f2d,'total':_0xd11a6b,'totalPages':Math[_0x501459(0x2e0)](_0xd11a6b/_0x278f2d)},'summary':{'totalMerchants':_0xd11a6b,'totalAmountUSDT':Math[_0x501459(0x25a)](_0x36ead2*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x26c4f3*0x64)/0x64,'totalPayout':Math[_0x501459(0x25a)](_0xb632d9*0x64)/0x64,'thisMonth':Math['round'](_0x2e1627*0x64)/0x64}};}async['createPayout'](_0x49bf2b){const _0x52607c=a40_0x9a8211,{shopId:_0x18de9b,amount:_0x47af11,network:_0x112a3b,wallet:_0x5f474b,notes:_0x1cb872,txid:_0x239fd6,periodFrom:_0x2ffa1a,periodTo:_0x2911b6}=_0x49bf2b,_0x25c3b8=await database_1[_0x52607c(0x32e)]['$transaction'](async _0x5569e7=>{const _0x404f0c=_0x52607c,_0x4f7066=await _0x5569e7[_0x404f0c(0x24e)][_0x404f0c(0x211)]({'where':{'id':_0x18de9b},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x4f7066)throw new Error('Shop\x20not\x20found');console[_0x404f0c(0x2dc)](_0x404f0c(0x2fe)+_0x4f7066[_0x404f0c(0x208)]+':'),console[_0x404f0c(0x2dc)](_0x404f0c(0x31f)+_0x4f7066[_0x404f0c(0x2f1)][_0x404f0c(0x287)](0x6)+'\x20USDT'),console[_0x404f0c(0x2dc)](_0x404f0c(0x348)+_0x47af11[_0x404f0c(0x287)](0x6)+'\x20USDT'),console[_0x404f0c(0x2dc)]('\x20\x20\x20Current\x20total\x20paid\x20out:\x20'+_0x4f7066[_0x404f0c(0x2fa)][_0x404f0c(0x287)](0x6)+_0x404f0c(0x22c));if(_0x239fd6)console[_0x404f0c(0x2dc)]('\x20\x20\x20Transaction\x20hash:\x20'+_0x239fd6);const _0x56c8c1=0.000001,_0x5e73bd=Number(_0x4f7066['balance']),_0x135f37=Number(_0x47af11);console[_0x404f0c(0x2dc)](_0x404f0c(0x298)),console[_0x404f0c(0x2dc)]('\x20\x20\x20Available\x20(raw):\x20'+_0x4f7066[_0x404f0c(0x2f1)]),console[_0x404f0c(0x2dc)]('\x20\x20\x20Available\x20(number):\x20'+_0x5e73bd),console[_0x404f0c(0x2dc)](_0x404f0c(0x1f7)+_0x135f37),console[_0x404f0c(0x2dc)](_0x404f0c(0x233)+(_0x5e73bd-_0x135f37)),console[_0x404f0c(0x2dc)](_0x404f0c(0x2c2)+_0x56c8c1);if(_0x5e73bd<_0x135f37-_0x56c8c1)throw new Error(_0x404f0c(0x290)+_0x5e73bd[_0x404f0c(0x287)](0x6)+_0x404f0c(0x26f)+_0x135f37[_0x404f0c(0x287)](0x6)+'\x20USDT,\x20Difference:\x20'+(_0x5e73bd-_0x135f37)['toFixed'](0x8)+_0x404f0c(0x22c));console['log']('✅\x20Balance\x20check\x20passed\x20(with\x20tolerance)');const _0x900392=Math[_0x404f0c(0x28f)](_0x5e73bd,_0x135f37);let _0x27d15d=_0x5f474b;console[_0x404f0c(0x2dc)](_0x404f0c(0x1fc)+(_0x5f474b||_0x404f0c(0x32c)));if(!_0x27d15d){console['log']('🔍\x20No\x20wallet\x20provided,\x20looking\x20up\x20from\x20shop\x20settings...');const _0x16e5e4=await _0x5569e7[_0x404f0c(0x24e)][_0x404f0c(0x211)]({'where':{'id':_0x18de9b},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});console['log'](_0x404f0c(0x1f4),_0x16e5e4);if(_0x16e5e4)switch(_0x112a3b){case _0x404f0c(0x333):_0x27d15d=_0x16e5e4[_0x404f0c(0x2a7)]||undefined,console[_0x404f0c(0x2dc)](_0x404f0c(0x27b)+_0x27d15d);break;case'trc20':_0x27d15d=_0x16e5e4[_0x404f0c(0x22b)]||undefined,console[_0x404f0c(0x2dc)](_0x404f0c(0x29a)+_0x27d15d);break;case'erc20':_0x27d15d=_0x16e5e4[_0x404f0c(0x22e)]||undefined,console[_0x404f0c(0x2dc)](_0x404f0c(0x31d)+_0x27d15d);break;case _0x404f0c(0x29e):_0x27d15d=_0x16e5e4[_0x404f0c(0x218)]||undefined,console[_0x404f0c(0x2dc)]('🔍\x20Selected\x20polygon_usdc\x20wallet:\x20'+_0x27d15d);break;case _0x404f0c(0x22a):_0x27d15d=_0x16e5e4['usdcErcWallet']||undefined,console[_0x404f0c(0x2dc)](_0x404f0c(0x340)+_0x27d15d);break;}}else console[_0x404f0c(0x2dc)](_0x404f0c(0x204)+_0x27d15d);console[_0x404f0c(0x2dc)](_0x404f0c(0x2e8)+_0x112a3b+':\x20'+(_0x27d15d||_0x404f0c(0x33c))),console[_0x404f0c(0x2dc)](_0x404f0c(0x327),{'shopId':_0x18de9b,'amount':_0x900392,'network':_0x112a3b,'wallet':_0x27d15d,'status':'COMPLETED','txid':_0x239fd6,'notes':_0x1cb872,'periodFrom':_0x2ffa1a?new Date(_0x2ffa1a):null,'periodTo':_0x2911b6?new Date(_0x2911b6):null});const _0x419981=await _0x5569e7[_0x404f0c(0x232)][_0x404f0c(0x27e)]({'data':{'shopId':_0x18de9b,'amount':_0x900392,'network':_0x112a3b,'wallet':_0x27d15d,'status':_0x404f0c(0x29d),'txid':_0x239fd6,'notes':_0x1cb872,'periodFrom':_0x2ffa1a?new Date(_0x2ffa1a):null,'periodTo':_0x2911b6?new Date(_0x2911b6):null,'createdAt':new Date(),'paidAt':new Date()}});console['log'](_0x404f0c(0x2b5),{'id':_0x419981['id'],'wallet':_0x419981[_0x404f0c(0x236)],'network':_0x419981[_0x404f0c(0x26d)],'amount':_0x419981[_0x404f0c(0x326)]});const _0x4db901=_0x5e73bd-_0x900392,_0x10168d=Number(_0x4f7066['totalPaidOut'])+_0x900392;return await _0x5569e7[_0x404f0c(0x24e)][_0x404f0c(0x246)]({'where':{'id':_0x18de9b},'data':{'balance':_0x4db901,'totalPaidOut':_0x10168d}}),console[_0x404f0c(0x2dc)](_0x404f0c(0x31e)+_0x4f7066[_0x404f0c(0x208)]+'\x20balance\x20updated:'),console[_0x404f0c(0x2dc)]('\x20\x20\x20Balance:\x20'+_0x5e73bd[_0x404f0c(0x287)](0x6)+_0x404f0c(0x23a)+_0x4db901[_0x404f0c(0x287)](0x6)+'\x20USDT\x20(-'+_0x900392[_0x404f0c(0x287)](0x6)+')'),console[_0x404f0c(0x2dc)](_0x404f0c(0x210)+_0x4f7066[_0x404f0c(0x2fa)][_0x404f0c(0x287)](0x6)+_0x404f0c(0x23a)+_0x10168d['toFixed'](0x6)+_0x404f0c(0x342)+_0x900392[_0x404f0c(0x287)](0x6)+')'),console[_0x404f0c(0x2dc)](_0x404f0c(0x2c6)+_0x900392[_0x404f0c(0x287)](0x6)+'\x20USDT'),{'payout':_0x419981,'shop':_0x4f7066};});return console[_0x52607c(0x2dc)](_0x52607c(0x215)+_0x25c3b8[_0x52607c(0x232)]['id']+'\x20for\x20shop\x20'+_0x25c3b8[_0x52607c(0x24e)]['username']+'\x20('+_0x25c3b8['payout'][_0x52607c(0x326)][_0x52607c(0x287)](0x6)+_0x52607c(0x217)),{'id':_0x25c3b8[_0x52607c(0x232)]['id'],'shopId':_0x25c3b8[_0x52607c(0x232)]['shopId'],'shopName':_0x25c3b8[_0x52607c(0x24e)]['name'],'shopUsername':_0x25c3b8[_0x52607c(0x24e)][_0x52607c(0x208)],'amount':_0x25c3b8[_0x52607c(0x232)]['amount'],'network':_0x25c3b8[_0x52607c(0x232)][_0x52607c(0x26d)],'wallet':_0x25c3b8[_0x52607c(0x232)][_0x52607c(0x236)],'status':_0x25c3b8[_0x52607c(0x232)]['status'],'txid':_0x25c3b8[_0x52607c(0x232)][_0x52607c(0x2c0)],'notes':_0x25c3b8[_0x52607c(0x232)][_0x52607c(0x276)],'periodFrom':_0x25c3b8['payout'][_0x52607c(0x25b)],'periodTo':_0x25c3b8[_0x52607c(0x232)][_0x52607c(0x346)],'createdAt':_0x25c3b8[_0x52607c(0x232)][_0x52607c(0x289)],'paidAt':_0x25c3b8[_0x52607c(0x232)]['paidAt']};}async[a40_0x9a8211(0x248)](_0x46f743){const _0x531f18=a40_0x9a8211,{page:_0xe36acc,limit:_0x54b237,shopId:_0x51399f,network:_0x41cf98,dateFrom:_0x444e0b,dateTo:_0x674f8a,search:_0x51afcf}=_0x46f743,_0x22415e=(_0xe36acc-0x1)*_0x54b237,_0x4193e8={};_0x51399f&&(_0x4193e8[_0x531f18(0x304)]=_0x51399f);_0x41cf98&&(_0x4193e8[_0x531f18(0x26d)]=_0x41cf98);if(_0x444e0b||_0x674f8a){_0x4193e8['createdAt']={};if(_0x444e0b){const _0x434c6d=new Date(_0x444e0b);_0x434c6d[_0x531f18(0x2ec)](0x0,0x0,0x0,0x1),_0x4193e8[_0x531f18(0x289)]['gte']=_0x434c6d,console['log'](_0x531f18(0x28c)+_0x434c6d['toISOString']());}if(_0x674f8a){const _0x5ea027=new Date(_0x674f8a);_0x5ea027['setHours'](0x17,0x3b,0x3b,0x3e7),_0x4193e8[_0x531f18(0x289)]['lte']=_0x5ea027,console[_0x531f18(0x2dc)](_0x531f18(0x2d8)+_0x5ea027[_0x531f18(0x266)]());}}_0x51afcf&&(_0x4193e8['OR']=[{'shop':{'name':{'contains':_0x51afcf,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x51afcf,'mode':_0x531f18(0x332)}}},{'notes':{'contains':_0x51afcf,'mode':_0x531f18(0x332)}}]);const [_0x72f120,_0xb0233e]=await Promise['all']([database_1[_0x531f18(0x32e)][_0x531f18(0x232)]['findMany']({'where':_0x4193e8,'skip':_0x22415e,'take':_0x54b237,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'wallet':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x531f18(0x32e)][_0x531f18(0x232)]['count']({'where':_0x4193e8})]);return{'payouts':_0x72f120['map'](_0x15c303=>({'id':_0x15c303['id'],'shopId':_0x15c303[_0x531f18(0x304)],'shopName':_0x15c303[_0x531f18(0x24e)][_0x531f18(0x32b)],'shopUsername':_0x15c303['shop'][_0x531f18(0x208)],'amount':_0x15c303[_0x531f18(0x326)],'network':_0x15c303['network'],'wallet':_0x15c303['wallet'],'status':_0x15c303[_0x531f18(0x24a)],'txid':_0x15c303['txid'],'notes':_0x15c303[_0x531f18(0x276)],'periodFrom':_0x15c303[_0x531f18(0x25b)],'periodTo':_0x15c303[_0x531f18(0x346)],'createdAt':_0x15c303[_0x531f18(0x289)],'paidAt':_0x15c303[_0x531f18(0x2d4)]})),'pagination':{'page':_0xe36acc,'limit':_0x54b237,'total':_0xb0233e,'totalPages':Math[_0x531f18(0x2e0)](_0xb0233e/_0x54b237)}};}async['getPayoutById'](_0x2c1ee0){const _0x2855be=a40_0x9a8211,_0x318a78=await database_1[_0x2855be(0x32e)][_0x2855be(0x232)][_0x2855be(0x211)]({'where':{'id':_0x2c1ee0},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x318a78)return null;return{'id':_0x318a78['id'],'shopId':_0x318a78[_0x2855be(0x304)],'shopName':_0x318a78[_0x2855be(0x24e)][_0x2855be(0x32b)],'shopUsername':_0x318a78[_0x2855be(0x24e)][_0x2855be(0x208)],'amount':_0x318a78[_0x2855be(0x326)],'network':_0x318a78[_0x2855be(0x26d)],'wallet':_0x318a78['wallet'],'status':_0x318a78[_0x2855be(0x24a)],'txid':_0x318a78[_0x2855be(0x2c0)],'notes':_0x318a78['notes'],'periodFrom':_0x318a78[_0x2855be(0x25b)],'periodTo':_0x318a78[_0x2855be(0x346)],'createdAt':_0x318a78['createdAt'],'paidAt':_0x318a78[_0x2855be(0x2d4)]};}async[a40_0x9a8211(0x279)](_0x4daba1){const _0x2f6a88=a40_0x9a8211;await database_1[_0x2f6a88(0x32e)][_0x2f6a88(0x232)][_0x2f6a88(0x2af)]({'where':{'id':_0x4daba1}});}async[a40_0x9a8211(0x2ba)](_0x486a70){const _0x31159f=a40_0x9a8211,{page:_0xd2c2fa,limit:_0x2658dd,status:_0x130f76,gateway:_0x278477,shopId:_0xe6b93c,dateFrom:_0x7c5939,dateTo:_0x5c03b3,search:_0x42fcbe,currency:_0x5c6ac9,sortBy:_0x25b708,sortOrder:_0x5f0b5e}=_0x486a70,_0x364f06=(_0xd2c2fa-0x1)*_0x2658dd;console[_0x31159f(0x2dc)](_0x31159f(0x33e),_0x486a70);const _0x1f58db=await database_1[_0x31159f(0x32e)][_0x31159f(0x315)]['groupBy']({'by':[_0x31159f(0x335)],'_count':{'gateway':!![]}});console[_0x31159f(0x2dc)](_0x31159f(0x307),_0x1f58db[_0x31159f(0x244)](_0x2c70e1=>_0x2c70e1[_0x31159f(0x335)]+'\x20('+_0x2c70e1[_0x31159f(0x2b0)][_0x31159f(0x335)]+_0x31159f(0x222)));if(_0x278477){const _0x36a977=_0x1f58db[_0x31159f(0x30e)](_0x873e4f=>_0x873e4f[_0x31159f(0x335)]['toLowerCase']()===_0x278477[_0x31159f(0x2da)]());!_0x36a977&&_0x278477[_0x31159f(0x2da)]()!==_0x31159f(0x252)&&console[_0x31159f(0x2dc)](_0x31159f(0x293)+_0x278477+'\x27\x20not\x20found.\x20Available\x20gateways:\x20'+_0x1f58db[_0x31159f(0x244)](_0x425ab2=>_0x425ab2[_0x31159f(0x335)])[_0x31159f(0x1fd)](',\x20'));}const _0x2f2374={};_0x130f76&&(_0x2f2374['status']=_0x130f76['toUpperCase']());if(!_0x278477)_0x2f2374[_0x31159f(0x335)]={'not':'test_gateway'};else{if(_0x278477&&(_0x278477[_0x31159f(0x2da)]()===_0x31159f(0x252)||_0x278477===_0x31159f(0x322)))_0x2f2374[_0x31159f(0x335)]=_0x31159f(0x252);else{let _0x43366e=_0x278477;const _0x5f5478=(0x0,gateway_1[_0x31159f(0x28a)])(_0x278477);if(_0x5f5478)_0x43366e=_0x5f5478,console['log'](_0x31159f(0x2a3)+_0x278477+_0x31159f(0x2b3)+_0x43366e+'\x27');else{const _0xe30cc4=(0x0,gateway_1[_0x31159f(0x20b)])(_0x278477);if(_0xe30cc4){const _0x5961ae=(0x0,gateway_1[_0x31159f(0x28a)])(_0xe30cc4);_0x5961ae&&(_0x43366e=_0x5961ae,console[_0x31159f(0x2dc)]('🔄\x20Converted\x20gateway\x20name\x20\x27'+_0x278477+_0x31159f(0x2ea)+_0xe30cc4+_0x31159f(0x2f8)+_0x43366e+'\x27'));}else console[_0x31159f(0x2dc)](_0x31159f(0x295)+_0x278477+_0x31159f(0x2b4));}const _0xdc9cac=await database_1[_0x31159f(0x32e)][_0x31159f(0x315)][_0x31159f(0x2f3)]({'where':{'gateway':_0x43366e[_0x31159f(0x2da)]()},'take':0x1});_0xdc9cac===0x0?(console[_0x31159f(0x2dc)](_0x31159f(0x260)+_0x43366e+_0x31159f(0x235)+_0x278477+_0x31159f(0x228)),_0x2f2374[_0x31159f(0x335)]=_0x31159f(0x305)):(_0x2f2374['gateway']=_0x43366e[_0x31159f(0x2da)](),console[_0x31159f(0x2dc)](_0x31159f(0x207)+_0x43366e+_0x31159f(0x235)+_0x278477+'\x27)'));}}console[_0x31159f(0x2dc)](_0x31159f(0x269),_0x2f2374[_0x31159f(0x335)]);_0xe6b93c&&(_0x2f2374['shopId']=_0xe6b93c);_0x5c6ac9&&(_0x2f2374[_0x31159f(0x250)]=_0x5c6ac9[_0x31159f(0x20f)](),console[_0x31159f(0x2dc)](_0x31159f(0x24c)+_0x5c6ac9['toUpperCase']()));if(_0x7c5939||_0x5c03b3){_0x2f2374[_0x31159f(0x289)]={};if(_0x7c5939){const _0x1ed3fd=new Date(_0x7c5939);_0x1ed3fd['setHours'](0x0,0x0,0x0,0x1),_0x2f2374[_0x31159f(0x289)][_0x31159f(0x2b9)]=_0x1ed3fd,console[_0x31159f(0x2dc)](_0x31159f(0x2e2)+_0x1ed3fd['toISOString']());}if(_0x5c03b3){const _0x6f09b7=new Date(_0x5c03b3);_0x6f09b7[_0x31159f(0x2ec)](0x17,0x3b,0x3b,0x3e7),_0x2f2374[_0x31159f(0x289)][_0x31159f(0x2ef)]=_0x6f09b7,console[_0x31159f(0x2dc)](_0x31159f(0x21a)+_0x6f09b7[_0x31159f(0x266)]());}}_0x42fcbe&&(_0x2f2374['OR']=[{'id':{'contains':_0x42fcbe,'mode':'insensitive'}},{'orderId':{'contains':_0x42fcbe,'mode':'insensitive'}},{'gatewayOrderId':{'contains':_0x42fcbe,'mode':_0x31159f(0x332)}},{'customerEmail':{'contains':_0x42fcbe,'mode':_0x31159f(0x332)}},{'shop':{'name':{'contains':_0x42fcbe,'mode':_0x31159f(0x332)}}},{'shop':{'username':{'contains':_0x42fcbe,'mode':'insensitive'}}}]);console[_0x31159f(0x2dc)]('📊\x20Final\x20WHERE\x20conditions:',JSON[_0x31159f(0x229)](_0x2f2374,null,0x2));let _0x6eb44b={'createdAt':'desc'};if(_0x25b708){const _0x4784ef=[_0x31159f(0x326),_0x31159f(0x289),_0x31159f(0x27f),_0x31159f(0x24a),_0x31159f(0x335),_0x31159f(0x250)],_0x10d994=[_0x31159f(0x206),_0x31159f(0x2c5)];if(_0x4784ef[_0x31159f(0x272)](_0x25b708)){const _0x3aa03d=_0x10d994[_0x31159f(0x272)](_0x5f0b5e)?_0x5f0b5e:_0x31159f(0x2c5);_0x6eb44b={[_0x25b708]:_0x3aa03d},console[_0x31159f(0x2dc)](_0x31159f(0x292)+_0x25b708+_0x31159f(0x256)+_0x3aa03d+_0x31159f(0x30f));}}const [_0x421fc2,_0x3a6ed4]=await Promise[_0x31159f(0x225)]([database_1[_0x31159f(0x32e)][_0x31159f(0x315)][_0x31159f(0x337)]({'where':_0x2f2374,'skip':_0x364f06,'take':_0x2658dd,'orderBy':_0x6eb44b,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x31159f(0x32e)][_0x31159f(0x315)][_0x31159f(0x2f3)]({'where':_0x2f2374})]);return{'payments':_0x421fc2,'pagination':{'page':_0xd2c2fa,'limit':_0x2658dd,'total':_0x3a6ed4,'totalPages':Math[_0x31159f(0x2e0)](_0x3a6ed4/_0x2658dd)}};}async[a40_0x9a8211(0x2be)](_0x24cdf1){const _0x4fe1d2=a40_0x9a8211,_0xc86869=await database_1['default'][_0x4fe1d2(0x315)][_0x4fe1d2(0x211)]({'where':{'id':_0x24cdf1},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0xc86869)return null;return{'id':_0xc86869['id'],'shopId':_0xc86869[_0x4fe1d2(0x304)],'gateway':_0xc86869[_0x4fe1d2(0x335)],'amount':_0xc86869[_0x4fe1d2(0x326)],'currency':_0xc86869['currency'],'status':_0xc86869['status'],'orderId':_0xc86869['orderId'],'gatewayOrderId':_0xc86869[_0x4fe1d2(0x282)],'customerEmail':_0xc86869[_0x4fe1d2(0x2a0)],'customerName':_0xc86869[_0x4fe1d2(0x308)],'customerCountry':_0xc86869[_0x4fe1d2(0x1f5)],'customerIp':_0xc86869[_0x4fe1d2(0x349)],'customerUa':_0xc86869[_0x4fe1d2(0x271)],'failureMessage':_0xc86869[_0x4fe1d2(0x30c)],'externalPaymentUrl':_0xc86869[_0x4fe1d2(0x212)],'successUrl':_0xc86869['successUrl'],'failUrl':_0xc86869['failUrl'],'pendingUrl':_0xc86869[_0x4fe1d2(0x33f)],'whiteUrl':_0xc86869[_0x4fe1d2(0x323)],'createdAt':_0xc86869[_0x4fe1d2(0x289)],'updatedAt':_0xc86869[_0x4fe1d2(0x27f)],'shop':_0xc86869[_0x4fe1d2(0x24e)]};}async[a40_0x9a8211(0x29b)](_0x4f7535,_0x453f70,_0x15b8f6,_0x5038af){const _0x357e4f=a40_0x9a8211,_0x34a7a8=await database_1[_0x357e4f(0x32e)][_0x357e4f(0x34e)](async _0x3a4f99=>{const _0x17f0fc=_0x357e4f,_0x17fc20=await _0x3a4f99[_0x17f0fc(0x315)][_0x17f0fc(0x211)]({'where':{'id':_0x4f7535},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x17fc20)throw new Error(_0x17f0fc(0x20a));const _0x41886f=_0x17fc20[_0x17f0fc(0x24a)],_0xb1a985=_0x453f70[_0x17f0fc(0x20f)]();console[_0x17f0fc(0x2dc)]('🔄\x20Admin\x20updating\x20payment\x20'+_0x4f7535+'\x20status:\x20'+_0x41886f+_0x17f0fc(0x23a)+_0xb1a985),console[_0x17f0fc(0x2dc)]('💰\x20Current\x20shop\x20balance:\x20'+_0x17fc20[_0x17f0fc(0x24e)]['balance']+_0x17f0fc(0x22c));const _0x16be75={'status':_0xb1a985,'updatedAt':new Date(),'statusChangedBy':'admin','statusChangedAt':new Date()};_0x15b8f6&&(_0x16be75[_0x17f0fc(0x20d)]=_0x15b8f6);_0xb1a985===_0x17f0fc(0x334)&&_0x5038af&&(_0x16be75[_0x17f0fc(0x306)]=_0x5038af);let _0x32497d=0x0,_0xb0ea2b=_0x17fc20[_0x17f0fc(0x24e)][_0x17f0fc(0x2f1)];if(_0xb1a985===_0x17f0fc(0x341)&&_0x41886f!=='PAID'){_0x16be75['paidAt']=new Date();const _0x201152=await currencyService_1['currencyService'][_0x17f0fc(0x2e9)](_0x17fc20['amount'],_0x17fc20[_0x17f0fc(0x250)]);_0x16be75[_0x17f0fc(0x345)]=_0x201152;let _0x668ba4=0x2d;const _0x522b5f=await _0x3a4f99['shop']['findUnique']({'where':{'id':_0x17fc20[_0x17f0fc(0x304)]},'select':{'gatewaySettings':!![]}});if(_0x522b5f?.['gatewaySettings'])try{const _0xe129a=JSON[_0x17f0fc(0x281)](_0x522b5f[_0x17f0fc(0x2ac)]);for(const [_0x48e5b6,_0x3f29d0]of Object[_0x17f0fc(0x283)](_0xe129a)){if(_0x48e5b6[_0x17f0fc(0x2da)]()===_0x17fc20[_0x17f0fc(0x335)][_0x17f0fc(0x2da)]()){_0x668ba4=_0x3f29d0[_0x17f0fc(0x201)]||0xa;break;}}}catch(_0x521869){console[_0x17f0fc(0x23c)](_0x17f0fc(0x32f)+_0x4f7535+':',_0x521869);}let _0x669f03;_0x17fc20[_0x17f0fc(0x328)]!==null&&_0x17fc20['amountAfterGatewayCommissionUSDT']!==undefined?(_0x669f03=_0x17fc20['amountAfterGatewayCommissionUSDT'],console[_0x17f0fc(0x2dc)]('📊\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20'+_0x669f03['toFixed'](0x6)+_0x17f0fc(0x2bd)+_0x4f7535)):(_0x669f03=_0x201152*(0x1-_0x668ba4/0x64),console[_0x17f0fc(0x2dc)](_0x17f0fc(0x247)+_0x4f7535+':\x20'+_0x668ba4+_0x17f0fc(0x303)+_0x201152[_0x17f0fc(0x287)](0x6)+_0x17f0fc(0x22c)),_0x16be75[_0x17f0fc(0x328)]=_0x669f03,_0x16be75[_0x17f0fc(0x31b)]=_0x668ba4),_0x32497d=_0x669f03,_0xb0ea2b+=_0x669f03,console['log'](_0x17f0fc(0x2cc)+_0x4f7535+_0x17f0fc(0x2d7)),console[_0x17f0fc(0x2dc)](_0x17f0fc(0x329)+_0x201152[_0x17f0fc(0x287)](0x6)+_0x17f0fc(0x22c)),console['log'](_0x17f0fc(0x231)+_0x17fc20[_0x17f0fc(0x335)]+',\x20Commission:\x20'+_0x668ba4+'%'),console['log'](_0x17f0fc(0x2f0)+_0x669f03[_0x17f0fc(0x287)](0x6)+_0x17f0fc(0x221)+_0x668ba4+_0x17f0fc(0x2f7)),console[_0x17f0fc(0x2dc)](_0x17f0fc(0x2a4)+_0x669f03[_0x17f0fc(0x287)](0x6)+'\x20USDT');}else{if(_0x41886f===_0x17f0fc(0x341)&&_0xb1a985!==_0x17f0fc(0x341)&&_0xb1a985!=='CHARGEBACK'){if(_0x17fc20[_0x17f0fc(0x345)]){let _0x15a8e3=0x2d;const _0x5cecb4=await _0x3a4f99[_0x17f0fc(0x24e)]['findUnique']({'where':{'id':_0x17fc20['shopId']},'select':{'gatewaySettings':!![]}});if(_0x5cecb4?.['gatewaySettings'])try{const _0x311a12=JSON[_0x17f0fc(0x281)](_0x5cecb4[_0x17f0fc(0x2ac)]);for(const [_0x356aa9,_0x52b668]of Object[_0x17f0fc(0x283)](_0x311a12)){if(_0x356aa9[_0x17f0fc(0x2da)]()===_0x17fc20['gateway']['toLowerCase']()){_0x15a8e3=_0x52b668[_0x17f0fc(0x201)]||0xa;break;}}}catch(_0x182b63){console[_0x17f0fc(0x23c)](_0x17f0fc(0x32f)+_0x4f7535+':',_0x182b63);}const _0xff6eab=_0x17fc20['amountUSDT']*(0x1-_0x15a8e3/0x64);_0x32497d=-_0xff6eab,_0xb0ea2b-=_0xff6eab,console['log'](_0x17f0fc(0x329)+_0x17fc20[_0x17f0fc(0x345)][_0x17f0fc(0x287)](0x6)+'\x20USDT'),console[_0x17f0fc(0x2dc)](_0x17f0fc(0x231)+_0x17fc20['gateway']+_0x17f0fc(0x30a)+_0x15a8e3+'%'),console['log'](_0x17f0fc(0x2f2)+_0xff6eab[_0x17f0fc(0x287)](0x6)+_0x17f0fc(0x221)+_0x15a8e3+_0x17f0fc(0x2f7)),console[_0x17f0fc(0x2dc)](_0x17f0fc(0x1ff)+_0xff6eab[_0x17f0fc(0x287)](0x6)+'\x20USDT');}}}_0xb1a985===_0x17f0fc(0x334)&&(console[_0x17f0fc(0x2dc)](_0x17f0fc(0x352)),_0x5038af&&_0x5038af>0x0?(_0x32497d=-_0x5038af,_0xb0ea2b-=_0x5038af,console[_0x17f0fc(0x2dc)]('💸\x20CHARGEBACK\x20penalty\x20ONLY:\x20-'+_0x5038af['toFixed'](0x6)+_0x17f0fc(0x21b)),console[_0x17f0fc(0x2dc)]('💰\x20Payment\x20amount\x20is\x20NOT\x20deducted\x20(chargeback\x20penalty\x20only)')):console[_0x17f0fc(0x2dc)](_0x17f0fc(0x2ca)),_0x16be75['chargebackAmount']=_0x5038af||0x0);_0xb1a985===_0x17f0fc(0x30d)&&_0x41886f==='PAID'&&console[_0x17f0fc(0x2dc)]('🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance');const _0x39f644=await _0x3a4f99[_0x17f0fc(0x315)]['update']({'where':{'id':_0x4f7535},'data':_0x16be75,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x32497d!==0x0&&(await _0x3a4f99['shop'][_0x17f0fc(0x246)]({'where':{'id':_0x17fc20[_0x17f0fc(0x304)]},'data':{'balance':_0xb0ea2b}}),console[_0x17f0fc(0x2dc)]('💰\x20Shop\x20'+_0x17fc20['shopId']+_0x17f0fc(0x2c1)+_0x17fc20[_0x17f0fc(0x24e)][_0x17f0fc(0x2f1)][_0x17f0fc(0x287)](0x6)+_0x17f0fc(0x23a)+_0xb0ea2b[_0x17f0fc(0x287)](0x6)+_0x17f0fc(0x317)+(_0x32497d>0x0?'+':'')+_0x32497d[_0x17f0fc(0x287)](0x6)+')')),_0x39f644;});return{'id':_0x34a7a8['id'],'shopId':_0x34a7a8[_0x357e4f(0x304)],'gateway':_0x34a7a8[_0x357e4f(0x335)],'amount':_0x34a7a8[_0x357e4f(0x326)],'currency':_0x34a7a8[_0x357e4f(0x250)],'status':_0x34a7a8[_0x357e4f(0x24a)],'orderId':_0x34a7a8[_0x357e4f(0x34b)],'gatewayOrderId':_0x34a7a8[_0x357e4f(0x282)],'customerEmail':_0x34a7a8[_0x357e4f(0x2a0)],'customerName':_0x34a7a8['customerName'],'customerCountry':_0x34a7a8['customerCountry'],'customerIp':_0x34a7a8[_0x357e4f(0x349)],'customerUa':_0x34a7a8[_0x357e4f(0x271)],'failureMessage':_0x34a7a8[_0x357e4f(0x30c)],'adminNotes':_0x34a7a8[_0x357e4f(0x20d)],'chargebackAmount':_0x34a7a8[_0x357e4f(0x306)],'statusChangedBy':_0x34a7a8[_0x357e4f(0x29f)],'statusChangedAt':_0x34a7a8[_0x357e4f(0x2cf)],'createdAt':_0x34a7a8[_0x357e4f(0x289)],'updatedAt':_0x34a7a8[_0x357e4f(0x27f)],'shop':_0x34a7a8[_0x357e4f(0x24e)]};}async[a40_0x9a8211(0x29c)](_0x497b9e,_0x4f4f2a){const _0x2a7bbd=a40_0x9a8211,_0x103f9e=Math[_0x2a7bbd(0x27c)]()[_0x2a7bbd(0x2a6)](0x24)[_0x2a7bbd(0x24d)](0x2,0x9);console[_0x2a7bbd(0x2dc)](_0x2a7bbd(0x34d)+_0x103f9e+',\x20userId:\x20'+_0x497b9e);const _0x453be1={..._0x4f4f2a};_0x4f4f2a[_0x2a7bbd(0x302)]&&_0x4f4f2a[_0x2a7bbd(0x302)]['trim']()!==''?(console[_0x2a7bbd(0x2dc)]('🔐\x20['+_0x103f9e+_0x2a7bbd(0x2d3)+_0x497b9e),_0x453be1['password']=await bcryptjs_1[_0x2a7bbd(0x32e)][_0x2a7bbd(0x2e6)](_0x4f4f2a[_0x2a7bbd(0x302)],0xc)):(console[_0x2a7bbd(0x2dc)](_0x2a7bbd(0x30b)+_0x103f9e+_0x2a7bbd(0x270)),delete _0x453be1[_0x2a7bbd(0x302)]);_0x4f4f2a[_0x2a7bbd(0x2c4)]&&(_0x453be1[_0x2a7bbd(0x32b)]=_0x4f4f2a['fullName'],delete _0x453be1[_0x2a7bbd(0x2c4)]);_0x4f4f2a[_0x2a7bbd(0x243)]&&(_0x453be1['telegram']=_0x4f4f2a['telegramId'],delete _0x453be1[_0x2a7bbd(0x243)]);_0x4f4f2a[_0x2a7bbd(0x2e7)]&&(_0x453be1[_0x2a7bbd(0x318)]=_0x4f4f2a[_0x2a7bbd(0x2e7)],delete _0x453be1[_0x2a7bbd(0x2e7)]);if(_0x4f4f2a['gateways']){const _0x5ce224=_0x4f4f2a[_0x2a7bbd(0x2a1)][_0x2a7bbd(0x244)](_0x5c3bd0=>this['getGatewayInternalName'](_0x5c3bd0));console[_0x2a7bbd(0x2dc)]('🔄\x20Gateway\x20mapping:',_0x4f4f2a[_0x2a7bbd(0x2a1)],'->',_0x5ce224),_0x453be1[_0x2a7bbd(0x2a2)]=JSON[_0x2a7bbd(0x229)](_0x5ce224),delete _0x453be1[_0x2a7bbd(0x2a1)];}_0x4f4f2a[_0x2a7bbd(0x2ac)]&&(console[_0x2a7bbd(0x2dc)]('🔧\x20['+_0x103f9e+_0x2a7bbd(0x24b),_0x4f4f2a[_0x2a7bbd(0x2ac)]),_0x453be1[_0x2a7bbd(0x2ac)]=JSON[_0x2a7bbd(0x229)](_0x4f4f2a[_0x2a7bbd(0x2ac)]),console[_0x2a7bbd(0x2dc)](_0x2a7bbd(0x241)+_0x103f9e+_0x2a7bbd(0x2f5),_0x453be1[_0x2a7bbd(0x2ac)]));_0x4f4f2a[_0x2a7bbd(0x286)]&&(_0x4f4f2a[_0x2a7bbd(0x286)]['usdtPolygonWallet']!==undefined&&(_0x453be1['usdtPolygonWallet']=_0x4f4f2a['wallets'][_0x2a7bbd(0x2a7)]||null),_0x4f4f2a[_0x2a7bbd(0x286)][_0x2a7bbd(0x22b)]!==undefined&&(_0x453be1[_0x2a7bbd(0x22b)]=_0x4f4f2a[_0x2a7bbd(0x286)][_0x2a7bbd(0x22b)]||null),_0x4f4f2a['wallets']['usdtErcWallet']!==undefined&&(_0x453be1[_0x2a7bbd(0x22e)]=_0x4f4f2a[_0x2a7bbd(0x286)][_0x2a7bbd(0x22e)]||null),_0x4f4f2a[_0x2a7bbd(0x286)][_0x2a7bbd(0x218)]!==undefined&&(_0x453be1[_0x2a7bbd(0x218)]=_0x4f4f2a[_0x2a7bbd(0x286)][_0x2a7bbd(0x218)]||null),delete _0x453be1[_0x2a7bbd(0x286)]);const _0x1010f3=await database_1['default'][_0x2a7bbd(0x24e)]['update']({'where':{'id':_0x497b9e},'data':_0x453be1,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0x2a7bbd(0x2dc)](_0x2a7bbd(0x2fd)+_0x103f9e+']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:',_0x1010f3[_0x2a7bbd(0x2ac)]),{'id':_0x1010f3['id'],'fullName':_0x1010f3[_0x2a7bbd(0x32b)],'username':_0x1010f3['username'],'telegramId':_0x1010f3[_0x2a7bbd(0x259)],'merchantUrl':_0x1010f3[_0x2a7bbd(0x318)],'gateways':_0x1010f3[_0x2a7bbd(0x2a2)]?JSON[_0x2a7bbd(0x281)](_0x1010f3[_0x2a7bbd(0x2a2)]):null,'gatewaySettings':_0x1010f3[_0x2a7bbd(0x2ac)]?JSON[_0x2a7bbd(0x281)](_0x1010f3[_0x2a7bbd(0x2ac)]):null,'publicKey':_0x1010f3[_0x2a7bbd(0x301)],'wallets':{'usdtPolygonWallet':_0x1010f3[_0x2a7bbd(0x2a7)],'usdtTrcWallet':_0x1010f3['usdtTrcWallet'],'usdtErcWallet':_0x1010f3[_0x2a7bbd(0x22e)],'usdcPolygonWallet':_0x1010f3[_0x2a7bbd(0x218)]},'status':_0x1010f3['status'],'createdAt':_0x1010f3['createdAt']};}async[a40_0x9a8211(0x28d)](_0x41c1dd){const _0x49caaa=a40_0x9a8211,_0x1ae7a2=await database_1['default']['shop']['update']({'where':{'id':_0x41c1dd},'data':{'status':_0x49caaa(0x21e)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x1ae7a2['id'],'fullName':_0x1ae7a2[_0x49caaa(0x32b)],'username':_0x1ae7a2[_0x49caaa(0x208)],'telegramId':_0x1ae7a2[_0x49caaa(0x259)],'merchantUrl':_0x1ae7a2[_0x49caaa(0x318)],'gateways':_0x1ae7a2[_0x49caaa(0x2a2)]?JSON['parse'](_0x1ae7a2['paymentGateways']):null,'gatewaySettings':_0x1ae7a2['gatewaySettings']?JSON[_0x49caaa(0x281)](_0x1ae7a2['gatewaySettings']):null,'publicKey':_0x1ae7a2[_0x49caaa(0x301)],'wallets':{'usdtPolygonWallet':_0x1ae7a2[_0x49caaa(0x2a7)],'usdtTrcWallet':_0x1ae7a2[_0x49caaa(0x22b)],'usdtErcWallet':_0x1ae7a2['usdtErcWallet'],'usdcPolygonWallet':_0x1ae7a2[_0x49caaa(0x218)]},'status':_0x1ae7a2[_0x49caaa(0x24a)],'createdAt':_0x1ae7a2[_0x49caaa(0x289)]};}async[a40_0x9a8211(0x209)](_0xe302b){const _0x58e3d6=a40_0x9a8211,_0x42c934=await database_1[_0x58e3d6(0x32e)]['shop'][_0x58e3d6(0x246)]({'where':{'id':_0xe302b},'data':{'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x42c934['id'],'fullName':_0x42c934['name'],'username':_0x42c934[_0x58e3d6(0x208)],'telegramId':_0x42c934[_0x58e3d6(0x259)],'merchantUrl':_0x42c934[_0x58e3d6(0x318)],'gateways':_0x42c934[_0x58e3d6(0x2a2)]?JSON[_0x58e3d6(0x281)](_0x42c934[_0x58e3d6(0x2a2)]):null,'gatewaySettings':_0x42c934[_0x58e3d6(0x2ac)]?JSON[_0x58e3d6(0x281)](_0x42c934[_0x58e3d6(0x2ac)]):null,'publicKey':_0x42c934[_0x58e3d6(0x301)],'wallets':{'usdtPolygonWallet':_0x42c934[_0x58e3d6(0x2a7)],'usdtTrcWallet':_0x42c934['usdtTrcWallet'],'usdtErcWallet':_0x42c934[_0x58e3d6(0x22e)],'usdcPolygonWallet':_0x42c934[_0x58e3d6(0x218)]},'status':_0x42c934[_0x58e3d6(0x24a)],'createdAt':_0x42c934[_0x58e3d6(0x289)]};}async[a40_0x9a8211(0x2de)](_0x5c667e){const _0x240160=a40_0x9a8211,{page:_0x1c84d5,limit:_0x1f52d3,status:_0x2e34a7}=_0x5c667e,_0x2895b1=(_0x1c84d5-0x1)*_0x1f52d3,_0x5dda74={};_0x2e34a7&&(_0x5dda74[_0x240160(0x24a)]=_0x2e34a7[_0x240160(0x20f)]());const [_0x46786a,_0x3819f9]=await Promise['all']([database_1['default'][_0x240160(0x24e)]['findMany']({'where':_0x5dda74,'skip':_0x2895b1,'take':_0x1f52d3,'orderBy':{'createdAt':_0x240160(0x2c5)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1['default'][_0x240160(0x24e)]['count']({'where':_0x5dda74})]);return{'users':_0x46786a[_0x240160(0x244)](_0x3fc19a=>{const _0x32fe0c=_0x240160,_0x1fa724=_0x3fc19a['paymentGateways']?JSON[_0x32fe0c(0x281)](_0x3fc19a['paymentGateways']):null,_0x2e10a8=_0x1fa724?_0x1fa724[_0x32fe0c(0x244)](_0x438140=>this['getGatewayDisplayName'](_0x438140)):null;return{'id':_0x3fc19a['id'],'fullName':_0x3fc19a[_0x32fe0c(0x32b)],'username':_0x3fc19a[_0x32fe0c(0x208)],'telegramId':_0x3fc19a[_0x32fe0c(0x259)],'merchantUrl':_0x3fc19a[_0x32fe0c(0x318)],'gateways':_0x2e10a8,'gatewaySettings':_0x3fc19a[_0x32fe0c(0x2ac)]?JSON['parse'](_0x3fc19a['gatewaySettings']):null,'publicKey':_0x3fc19a[_0x32fe0c(0x301)],'wallets':{'usdtPolygonWallet':_0x3fc19a['usdtPolygonWallet'],'usdtTrcWallet':_0x3fc19a[_0x32fe0c(0x22b)],'usdtErcWallet':_0x3fc19a[_0x32fe0c(0x22e)],'usdcPolygonWallet':_0x3fc19a[_0x32fe0c(0x218)]},'status':_0x3fc19a[_0x32fe0c(0x24a)],'createdAt':_0x3fc19a[_0x32fe0c(0x289)]};}),'pagination':{'page':_0x1c84d5,'limit':_0x1f52d3,'total':_0x3819f9,'totalPages':Math[_0x240160(0x2e0)](_0x3819f9/_0x1f52d3)}};}async[a40_0x9a8211(0x2ae)](_0x20e290){const _0x154a08=a40_0x9a8211,_0x31b040=await database_1['default'][_0x154a08(0x24e)][_0x154a08(0x211)]({'where':{'id':_0x20e290},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x31b040)return null;const _0x4c1306=_0x31b040[_0x154a08(0x2a2)]?JSON['parse'](_0x31b040[_0x154a08(0x2a2)]):null,_0x365d73=_0x4c1306?_0x4c1306[_0x154a08(0x244)](_0x150820=>this['getGatewayDisplayName'](_0x150820)):null;return _0x4c1306&&_0x365d73&&console['log'](_0x154a08(0x224),_0x4c1306,'->',_0x365d73),{'id':_0x31b040['id'],'fullName':_0x31b040[_0x154a08(0x32b)],'username':_0x31b040['username'],'telegramId':_0x31b040[_0x154a08(0x259)],'merchantUrl':_0x31b040[_0x154a08(0x318)],'gateways':_0x365d73,'gatewaySettings':_0x31b040[_0x154a08(0x2ac)]?JSON['parse'](_0x31b040[_0x154a08(0x2ac)]):null,'publicKey':_0x31b040['publicKey'],'wallets':{'usdtPolygonWallet':_0x31b040[_0x154a08(0x2a7)],'usdtTrcWallet':_0x31b040[_0x154a08(0x22b)],'usdtErcWallet':_0x31b040[_0x154a08(0x22e)],'usdcPolygonWallet':_0x31b040[_0x154a08(0x218)]},'status':_0x31b040[_0x154a08(0x24a)],'createdAt':_0x31b040[_0x154a08(0x289)]};}async['createUser'](_0x11396f){const _0x5c7b0f=a40_0x9a8211,{fullName:_0x4901cf,username:_0x3cf953,password:_0x31bfec,telegramId:_0x4a6189,merchantUrl:_0x2d7551,gateways:_0x2082ed,gatewaySettings:_0x344c1a,wallets:_0xa3e4b4}=_0x11396f,_0x55f571=await database_1[_0x5c7b0f(0x32e)]['shop'][_0x5c7b0f(0x211)]({'where':{'username':_0x3cf953}});if(_0x55f571)throw new Error(_0x5c7b0f(0x2dd));if(_0x4a6189){const _0x6eeb3e=await database_1[_0x5c7b0f(0x32e)][_0x5c7b0f(0x24e)]['findUnique']({'where':{'telegram':_0x4a6189}});if(_0x6eeb3e)throw new Error(_0x5c7b0f(0x226));}const _0x43d13d=await bcryptjs_1[_0x5c7b0f(0x32e)][_0x5c7b0f(0x2e6)](_0x31bfec,0xc),_0x3a71fb='pk_'+crypto_1[_0x5c7b0f(0x32e)]['randomBytes'](0x20)[_0x5c7b0f(0x2a6)](_0x5c7b0f(0x24f)),_0x19aa77=_0x5c7b0f(0x2c8)+crypto_1['default'][_0x5c7b0f(0x1f1)](0x20)[_0x5c7b0f(0x2a6)]('hex'),_0x401b46=_0x2082ed?_0x2082ed[_0x5c7b0f(0x244)](_0x340706=>this['getGatewayInternalName'](_0x340706)):null;_0x2082ed&&_0x401b46&&console[_0x5c7b0f(0x2dc)](_0x5c7b0f(0x2a5),_0x2082ed,'->',_0x401b46);const _0x3bb73d=await database_1[_0x5c7b0f(0x32e)][_0x5c7b0f(0x24e)][_0x5c7b0f(0x27e)]({'data':{'name':_0x4901cf,'username':_0x3cf953,'password':_0x43d13d,'telegram':_0x4a6189,'shopUrl':_0x2d7551,'paymentGateways':_0x401b46?JSON[_0x5c7b0f(0x229)](_0x401b46):null,'gatewaySettings':_0x344c1a?JSON[_0x5c7b0f(0x229)](_0x344c1a):null,'usdtPolygonWallet':_0xa3e4b4?.['usdtPolygonWallet']||null,'usdtTrcWallet':_0xa3e4b4?.[_0x5c7b0f(0x22b)]||null,'usdtErcWallet':_0xa3e4b4?.[_0x5c7b0f(0x22e)]||null,'usdcPolygonWallet':_0xa3e4b4?.['usdcPolygonWallet']||null,'publicKey':_0x3a71fb,'secretKey':_0x19aa77,'status':_0x5c7b0f(0x2ff)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x3bb73d['id'],'fullName':_0x3bb73d[_0x5c7b0f(0x32b)],'username':_0x3bb73d[_0x5c7b0f(0x208)],'telegramId':_0x3bb73d[_0x5c7b0f(0x259)],'merchantUrl':_0x3bb73d[_0x5c7b0f(0x318)],'gateways':_0x3bb73d[_0x5c7b0f(0x2a2)]?JSON[_0x5c7b0f(0x281)](_0x3bb73d['paymentGateways']):null,'gatewaySettings':_0x3bb73d['gatewaySettings']?JSON[_0x5c7b0f(0x281)](_0x3bb73d['gatewaySettings']):null,'publicKey':_0x3bb73d['publicKey'],'wallets':{'usdtPolygonWallet':_0x3bb73d[_0x5c7b0f(0x2a7)],'usdtTrcWallet':_0x3bb73d['usdtTrcWallet'],'usdtErcWallet':_0x3bb73d[_0x5c7b0f(0x22e)],'usdcPolygonWallet':_0x3bb73d[_0x5c7b0f(0x218)]},'status':_0x3bb73d[_0x5c7b0f(0x24a)],'createdAt':_0x3bb73d[_0x5c7b0f(0x289)]};}async[a40_0x9a8211(0x2f9)](_0x2e957a){const _0x44cb31=a40_0x9a8211;await database_1[_0x44cb31(0x32e)][_0x44cb31(0x24e)]['delete']({'where':{'id':_0x2e957a}});}[a40_0x9a8211(0x33a)](_0x34cfba,_0x499582,_0x43329e){const _0x398cbd=a40_0x9a8211,_0x51b578=new Map(),_0x2f68e9=new Date(_0x499582);while(_0x2f68e9<=_0x43329e){const _0x5c39fa=_0x2f68e9[_0x398cbd(0x266)]()[_0x398cbd(0x1f6)]('T')[0x0];_0x51b578['set'](_0x5c39fa,{'revenue':0x0,'count':0x0}),_0x2f68e9[_0x398cbd(0x253)](_0x2f68e9[_0x398cbd(0x33b)]()+0x1);}for(const _0x558947 of _0x34cfba){const _0x53671a=_0x558947[_0x398cbd(0x289)][_0x398cbd(0x266)]()[_0x398cbd(0x1f6)]('T')[0x0],_0x1523e4=_0x51b578['get'](_0x53671a);_0x1523e4&&(_0x1523e4[_0x398cbd(0x2f3)]+=0x1,_0x558947['status']===_0x398cbd(0x341)&&(_0x558947[_0x398cbd(0x345)]?_0x1523e4[_0x398cbd(0x32d)]+=_0x558947[_0x398cbd(0x345)]:console[_0x398cbd(0x2dc)](_0x398cbd(0x1f3)+_0x558947['id']+_0x398cbd(0x22d))));}const _0x588bcb=[],_0xe02e81=[];for(const [_0x4ce6e7,_0x384343]of _0x51b578){_0x588bcb[_0x398cbd(0x353)]({'date':_0x4ce6e7,'amount':Math['round'](_0x384343[_0x398cbd(0x32d)]*0x64)/0x64}),_0xe02e81['push']({'date':_0x4ce6e7,'count':_0x384343[_0x398cbd(0x2f3)]});}return{'dailyRevenue':_0x588bcb,'dailyPayments':_0xe02e81};}}exports['AdminService']=AdminService;