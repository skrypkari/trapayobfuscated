'use strict';const a33_0x4d1d7c=a33_0xcee4;(function(_0x2c3c17,_0x1e26f4){const _0x121288=a33_0xcee4,_0x51de72=_0x2c3c17();while(!![]){try{const _0x3ff6c0=-parseInt(_0x121288(0x186))/0x1+-parseInt(_0x121288(0x158))/0x2*(parseInt(_0x121288(0x154))/0x3)+parseInt(_0x121288(0x155))/0x4*(parseInt(_0x121288(0x13d))/0x5)+parseInt(_0x121288(0x15d))/0x6+parseInt(_0x121288(0x15b))/0x7*(-parseInt(_0x121288(0x1a2))/0x8)+parseInt(_0x121288(0x1c9))/0x9*(parseInt(_0x121288(0x1c4))/0xa)+parseInt(_0x121288(0x1b8))/0xb*(parseInt(_0x121288(0x114))/0xc);if(_0x3ff6c0===_0x1e26f4)break;else _0x51de72['push'](_0x51de72['shift']());}catch(_0x42de91){_0x51de72['push'](_0x51de72['shift']());}}}(a33_0xa6d7,0x9b4b5));function a33_0xcee4(_0x1cb7da,_0x409050){const _0xa6d788=a33_0xa6d7();return a33_0xcee4=function(_0xcee44d,_0x2c5d11){_0xcee44d=_0xcee44d-0x111;let _0x47bb93=_0xa6d788[_0xcee44d];return _0x47bb93;},a33_0xcee4(_0x1cb7da,_0x409050);}function a33_0xa6d7(){const _0x5a2c70=['\x20to\x20','90d','password','totalPayments','📊\x20Merchants\x20awaiting\x20payout:\x20','filter','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','reduce','lte','📅\x20Period:\x20','createUser','910CDwGde','shop','Telegram\x20username\x20already\x20exists','__esModule','toUpperCase','15786XxQQCa','usdtPolygonWallet','AdminService','wallets','sort','getPaymentById','getTime','split','ACTIVE','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','COMPLETED','telegramId','totalCommissionRate','📊\x20Calculating\x20payout\x20statistics...','ceil','toISOString','1233636DmcVjP','gatewayOrderId','turnoverUSDT','\x20USDT\x20(after\x20commission)','customerCountry','customerIp','customerName','delete','findUnique','averageCommissionRate','✅\x20Payment\x20','\x20\x20\x20💰\x20Total\x20turnover:\x20','orderId','telegram','hash','merchantPaid','log','notes','map','getUserById','getAllPayouts','dateFrom','Payment\x20not\x20found','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','sk_','createdAt','gatewayBreakdown','gateway','\x20USDT\x20(pending\x20payout)','date','defineProperty','\x20\x20\x20📅\x20This\x20month:\x20','\x20\x20\x20🌐\x20IP:\x20','commission','\x20\x20\x20💰\x20Total\x20payout:\x20','stringify','createPayout','externalPaymentUrl','CoinToPay','commissionUSDT','custom','5wRRQWv','periodTo','getMerchantStatistics','payout','dateTo','payment','toLowerCase','count','💰\x20Found\x20','shopId','parse','totalAmountUSDT','toString','\x20for\x20shop\x20','\x20\x20\x20📊\x20Total\x20payments:\x20','not\x20set','publicKey','statusChangedAt','\x20USDT\x20(before\x20commission)','week','gatewaySettings','adminNotes','desc','3tXtiXa','1849444PhFNif','merchantUrl','\x20->\x20','1309720YIAjAk','includes','getAllPayments','7IRvXyW','round','1092162CiBacZ','getAllUsers','usdtErcWallet','default','amountUSDT','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','all','Error\x20processing\x20payment\x20','⏳\x20Payment\x20','\x20USDT)','pk_','values','insensitive','\x20\x20\x20🖥️\x20User\x20Agent:\x20','period','name','username','currency','paymentGateways','year','KLYME\x20EU','getMonth','updatePaymentStatus','getFullYear','network','usdtTrcWallet','error','set','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','failUrl','paidAt','\x20\x20\x20🌍\x20Country:\x20','getMerchantsAwaitingPayout','gte','Plisio','getGatewayDisplayName','Shop\x20not\x20found','\x20USDT','create','PAID','bcryptjs','472575mGnGxF','📊\x20Merchant\x20statistics\x20calculated:','month','chargebackAmount','merchantEarningsUSDT','getSystemStatistics','Rapyd','Username\x20already\x20exists','gateways','currencyService','usdcPolygonWallet','totalAmountAfterCommissionUSDT','getPayoutById','txid','crypto','fullName','findMany','\x20merchants,\x20','paidOutUSDT','totalTurnover','convertToUSDT','KLYME\x20DE','2020-01-01','shopUrl','oldestPaymentDate','customerEmail','randomBytes','statusChangedBy','4660216RtHQOH','amountAfterCommissionUSDT','customerUa','status','length','successUrl','update','totalPayout','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','periodFrom','updateUser','toFixed','awaitingPayout','SUSPENDED','turnover','hex','failureMessage','updatedAt','paymentsCount','localeCompare','deletePayout','amount','165cNZyus'];a33_0xa6d7=function(){return _0x5a2c70;};return a33_0xa6d7();}var __importDefault=this&&this['__importDefault']||function(_0x599765){return _0x599765&&_0x599765['__esModule']?_0x599765:{'default':_0x599765};};Object[a33_0x4d1d7c(0x132)](exports,a33_0x4d1d7c(0x1c7),{'value':!![]}),exports[a33_0x4d1d7c(0x1cb)]=void 0x0;const database_1=__importDefault(require('../config/database')),bcryptjs_1=__importDefault(require(a33_0x4d1d7c(0x185))),crypto_1=__importDefault(require(a33_0x4d1d7c(0x194))),currencyService_1=require('./currencyService');class AdminService{async['getPayoutStats'](){const _0x3f9424=a33_0x4d1d7c;console['log'](_0x3f9424(0x111));const _0x1d1d7e=await database_1[_0x3f9424(0x160)][_0x3f9424(0x142)][_0x3f9424(0x196)]({'where':{'status':_0x3f9424(0x184),'paidAt':{'not':null}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'merchantPaid':!![],'paidAt':!![],'createdAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console['log']('💰\x20Found\x20'+_0x1d1d7e['length']+'\x20paid\x20payments');let _0x3f7f33=0x0,_0x17b5f9=0x0,_0x1cc2b1=0x0;for(const _0x5b76da of _0x1d1d7e){try{const _0x1df114=await currencyService_1['currencyService'][_0x3f9424(0x19a)](_0x5b76da[_0x3f9424(0x1b7)],_0x5b76da[_0x3f9424(0x16e)]);let _0x14a86a={};if(_0x5b76da[_0x3f9424(0x1c5)]['gatewaySettings'])try{_0x14a86a=JSON[_0x3f9424(0x147)](_0x5b76da[_0x3f9424(0x1c5)][_0x3f9424(0x151)]);}catch(_0x55fca9){console['error'](_0x3f9424(0x1d2)+_0x5b76da['shopId']+':',_0x55fca9);}const _0x25511f=_0x14a86a[_0x3f9424(0x135)]||0xa,_0x1fee9b=_0x1df114*(0x1-_0x25511f/0x64);_0x5b76da[_0x3f9424(0x123)]?(_0x3f7f33+=_0x1fee9b,console[_0x3f9424(0x124)](_0x3f9424(0x11e)+_0x5b76da['id']+':\x20'+_0x1fee9b[_0x3f9424(0x1ad)](0x2)+'\x20USDT\x20(paid\x20out)')):(_0x17b5f9+=_0x1fee9b,_0x1cc2b1+=_0x1df114,console[_0x3f9424(0x124)](_0x3f9424(0x165)+_0x5b76da['id']+':\x20'+_0x1fee9b[_0x3f9424(0x1ad)](0x2)+_0x3f9424(0x130)));}catch(_0x1b7d12){console[_0x3f9424(0x177)](_0x3f9424(0x164)+_0x5b76da['id']+':',_0x1b7d12);}}const _0x50cb7c=new Date(),_0x513ac7=new Date(_0x50cb7c[_0x3f9424(0x174)](),_0x50cb7c['getMonth'](),0x1),_0x40d866=new Date(_0x50cb7c[_0x3f9424(0x174)](),_0x50cb7c[_0x3f9424(0x172)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x33a486=await database_1[_0x3f9424(0x160)][_0x3f9424(0x140)][_0x3f9424(0x196)]({'where':{'createdAt':{'gte':_0x513ac7,'lte':_0x40d866},'status':'COMPLETED'},'select':{'amount':!![]}}),_0x34390f=_0x33a486[_0x3f9424(0x1c0)]((_0x44846b,_0x1e4a65)=>_0x44846b+_0x1e4a65[_0x3f9424(0x1b7)],0x0),_0x52d8f5={'totalPayout':Math['round'](_0x3f7f33*0x64)/0x64,'awaitingPayout':Math[_0x3f9424(0x15c)](_0x17b5f9*0x64)/0x64,'thisMonth':Math[_0x3f9424(0x15c)](_0x34390f*0x64)/0x64,'availableBalance':Math[_0x3f9424(0x15c)](_0x1cc2b1*0x64)/0x64};return console[_0x3f9424(0x124)]('📊\x20Payout\x20statistics\x20calculated:'),console[_0x3f9424(0x124)](_0x3f9424(0x136)+_0x52d8f5[_0x3f9424(0x1a9)]+'\x20USDT\x20(paid\x20to\x20merchants)'),console[_0x3f9424(0x124)](_0x3f9424(0x179)+_0x52d8f5[_0x3f9424(0x1ae)]+_0x3f9424(0x117)),console[_0x3f9424(0x124)]('\x20\x20\x20💵\x20Available\x20balance:\x20'+_0x52d8f5['availableBalance']+_0x3f9424(0x14f)),console[_0x3f9424(0x124)](_0x3f9424(0x133)+_0x52d8f5['thisMonth']+_0x3f9424(0x182)),_0x52d8f5;}async['updateCustomerData'](_0x5704ba,_0x3ebf8b){const _0x9d9e7=a33_0x4d1d7c;console['log'](_0x9d9e7(0x162)+_0x5704ba+':',_0x3ebf8b);const _0x2a7d76=await database_1['default'][_0x9d9e7(0x142)][_0x9d9e7(0x11c)]({'where':{'id':_0x5704ba},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x2a7d76)throw new Error(_0x9d9e7(0x12a));const _0x1e31f4={};_0x3ebf8b[_0x9d9e7(0x118)]!==undefined&&(_0x1e31f4[_0x9d9e7(0x118)]=_0x3ebf8b[_0x9d9e7(0x118)]||null);_0x3ebf8b['customerIp']!==undefined&&(_0x1e31f4[_0x9d9e7(0x119)]=_0x3ebf8b[_0x9d9e7(0x119)]||null);_0x3ebf8b[_0x9d9e7(0x1a4)]!==undefined&&(_0x1e31f4[_0x9d9e7(0x1a4)]=_0x3ebf8b[_0x9d9e7(0x1a4)]||null);const _0x277ba4=await database_1[_0x9d9e7(0x160)]['payment'][_0x9d9e7(0x1a8)]({'where':{'id':_0x5704ba},'data':{..._0x1e31f4,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x9d9e7(0x124)](_0x9d9e7(0x1bf)+_0x5704ba),console[_0x9d9e7(0x124)](_0x9d9e7(0x17c)+_0x2a7d76[_0x9d9e7(0x118)]+_0x9d9e7(0x157)+_0x277ba4[_0x9d9e7(0x118)]),console['log'](_0x9d9e7(0x134)+_0x2a7d76[_0x9d9e7(0x119)]+_0x9d9e7(0x157)+_0x277ba4[_0x9d9e7(0x119)]),console[_0x9d9e7(0x124)](_0x9d9e7(0x16a)+(_0x2a7d76[_0x9d9e7(0x1a4)]?'set':_0x9d9e7(0x14c))+_0x9d9e7(0x157)+(_0x277ba4['customerUa']?_0x9d9e7(0x178):_0x9d9e7(0x14c))),_0x277ba4;}async[a33_0x4d1d7c(0x18b)](_0x49241c){const _0x3d7f6f=a33_0x4d1d7c,_0x531554=new Date();let _0x5c2856;switch(_0x49241c){case'7d':_0x5c2856=new Date(_0x531554[_0x3d7f6f(0x1cf)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x5c2856=new Date(_0x531554['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x3d7f6f(0x1ba):_0x5c2856=new Date(_0x531554[_0x3d7f6f(0x1cf)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x5c2856=new Date(_0x531554[_0x3d7f6f(0x1cf)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x1b58b5,_0xe57f44,_0x4dce34,_0x3c5b67,_0x6c3005,_0x84365]=await Promise[_0x3d7f6f(0x163)]([database_1[_0x3d7f6f(0x160)][_0x3d7f6f(0x1c5)]['count'](),database_1[_0x3d7f6f(0x160)][_0x3d7f6f(0x1c5)]['count']({'where':{'status':_0x3d7f6f(0x1d1)}}),database_1[_0x3d7f6f(0x160)][_0x3d7f6f(0x142)][_0x3d7f6f(0x144)]({'where':{'createdAt':{'gte':_0x5c2856}}}),database_1[_0x3d7f6f(0x160)][_0x3d7f6f(0x142)]['count']({'where':{'status':'PAID','createdAt':{'gte':_0x5c2856}}}),database_1[_0x3d7f6f(0x160)][_0x3d7f6f(0x142)][_0x3d7f6f(0x196)]({'where':{'status':_0x3d7f6f(0x184),'createdAt':{'gte':_0x5c2856}},'select':{'amount':!![],'currency':!![]}}),database_1[_0x3d7f6f(0x160)][_0x3d7f6f(0x142)][_0x3d7f6f(0x196)]({'take':0xa,'orderBy':{'createdAt':_0x3d7f6f(0x153)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}})]);let _0x253cfe=0x0;for(const _0x10a085 of _0x6c3005){const _0xd5d6ac=await currencyService_1[_0x3d7f6f(0x18f)]['convertToUSDT'](_0x10a085[_0x3d7f6f(0x1b7)],_0x10a085[_0x3d7f6f(0x16e)]);_0x253cfe+=_0xd5d6ac;}const _0x555f5a=_0x4dce34>0x0?_0x3c5b67/_0x4dce34*0x64:0x0;return{'totalShops':_0x1b58b5,'activeShops':_0xe57f44,'totalPayments':_0x4dce34,'successfulPayments':_0x3c5b67,'totalRevenue':Math[_0x3d7f6f(0x15c)](_0x253cfe*0x64)/0x64,'conversionRate':Math[_0x3d7f6f(0x15c)](_0x555f5a*0x64)/0x64,'recentPayments':_0x84365[_0x3d7f6f(0x126)](_0xe69a00=>({'id':_0xe69a00['id'],'amount':_0xe69a00[_0x3d7f6f(0x1b7)],'currency':_0xe69a00[_0x3d7f6f(0x16e)],'status':_0xe69a00[_0x3d7f6f(0x1a5)],'gateway':_0xe69a00[_0x3d7f6f(0x12f)],'shop':_0xe69a00[_0x3d7f6f(0x1c5)],'createdAt':_0xe69a00[_0x3d7f6f(0x12d)]}))};}async[a33_0x4d1d7c(0x13f)](_0x108d35){const _0x35305f=a33_0x4d1d7c;console[_0x35305f(0x124)]('📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:',_0x108d35);let _0x205ac0,_0x453944=new Date();if(_0x108d35[_0x35305f(0x16b)]===_0x35305f(0x13c)&&_0x108d35[_0x35305f(0x129)]&&_0x108d35[_0x35305f(0x141)])_0x205ac0=new Date(_0x108d35[_0x35305f(0x129)]),_0x453944=new Date(_0x108d35[_0x35305f(0x141)]);else{const _0x5a0e24=new Date();switch(_0x108d35[_0x35305f(0x16b)]){case _0x35305f(0x150):_0x205ac0=new Date(_0x5a0e24[_0x35305f(0x1cf)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x35305f(0x188):_0x205ac0=new Date(_0x5a0e24[_0x35305f(0x1cf)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x35305f(0x170):_0x205ac0=new Date(_0x5a0e24[_0x35305f(0x1cf)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case'all':default:_0x205ac0=new Date(_0x35305f(0x19c));break;}}console[_0x35305f(0x124)](_0x35305f(0x1c2)+_0x205ac0[_0x35305f(0x113)]()+_0x35305f(0x1b9)+_0x453944['toISOString']());const _0x53770c={'status':_0x35305f(0x184),'paidAt':{'gte':_0x205ac0,'lte':_0x453944}};_0x108d35[_0x35305f(0x146)]&&(_0x53770c[_0x35305f(0x146)]=_0x108d35[_0x35305f(0x146)]);const _0x159254=await database_1['default']['payment']['findMany']({'where':_0x53770c,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x35305f(0x124)](_0x35305f(0x145)+_0x159254[_0x35305f(0x1a6)]+'\x20paid\x20payments\x20for\x20analysis');let _0x5f4be5=0x0,_0xb5c40d=0x0,_0x2277f3=0x0;const _0x328291={},_0x1a7c41={},_0x107d82={};for(const _0x1f60dd of _0x159254){try{const _0x54438c=await currencyService_1['currencyService']['convertToUSDT'](_0x1f60dd[_0x35305f(0x1b7)],_0x1f60dd['currency']);let _0x281f2f={};if(_0x1f60dd[_0x35305f(0x1c5)][_0x35305f(0x151)])try{_0x281f2f=JSON[_0x35305f(0x147)](_0x1f60dd[_0x35305f(0x1c5)][_0x35305f(0x151)]);}catch(_0x5a89a3){console[_0x35305f(0x177)]('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x1f60dd[_0x35305f(0x146)]+':',_0x5a89a3);}const _0x27a289=_0x281f2f[_0x35305f(0x135)]||0xa,_0x19e1bb=_0x54438c*(_0x27a289/0x64),_0x5e9db3=_0x54438c-_0x19e1bb;_0x5f4be5+=_0x54438c,_0xb5c40d+=_0x5e9db3,_0x2277f3+=_0x19e1bb;!_0x328291[_0x1f60dd['gateway']]&&(_0x328291[_0x1f60dd[_0x35305f(0x12f)]]={'gateway':_0x1f60dd[_0x35305f(0x12f)],'gatewayDisplayName':this['getGatewayDisplayName'](_0x1f60dd[_0x35305f(0x12f)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x328291[_0x1f60dd['gateway']][_0x35305f(0x1b4)]++,_0x328291[_0x1f60dd[_0x35305f(0x12f)]]['turnoverUSDT']+=_0x54438c,_0x328291[_0x1f60dd[_0x35305f(0x12f)]][_0x35305f(0x13b)]+=_0x19e1bb,_0x328291[_0x1f60dd[_0x35305f(0x12f)]][_0x35305f(0x18a)]+=_0x5e9db3,_0x328291[_0x1f60dd[_0x35305f(0x12f)]]['totalCommissionRate']+=_0x27a289;!_0x108d35[_0x35305f(0x146)]&&(!_0x1a7c41[_0x1f60dd['shopId']]&&(_0x1a7c41[_0x1f60dd['shopId']]={'shopId':_0x1f60dd[_0x35305f(0x146)],'shopName':_0x1f60dd['shop'][_0x35305f(0x16c)],'shopUsername':_0x1f60dd['shop']['username'],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x1a7c41[_0x1f60dd[_0x35305f(0x146)]][_0x35305f(0x1b4)]++,_0x1a7c41[_0x1f60dd[_0x35305f(0x146)]][_0x35305f(0x116)]+=_0x54438c,_0x1a7c41[_0x1f60dd['shopId']][_0x35305f(0x13b)]+=_0x19e1bb,_0x1a7c41[_0x1f60dd[_0x35305f(0x146)]][_0x35305f(0x18a)]+=_0x5e9db3);const _0x5bd766=_0x1f60dd[_0x35305f(0x17b)][_0x35305f(0x113)]()[_0x35305f(0x1d0)]('T')[0x0];!_0x107d82[_0x5bd766]&&(_0x107d82[_0x5bd766]={'date':_0x5bd766,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x107d82[_0x5bd766][_0x35305f(0x1b0)]+=_0x54438c,_0x107d82[_0x5bd766]['merchantEarnings']+=_0x5e9db3,_0x107d82[_0x5bd766]['gatewayEarnings']+=_0x19e1bb,_0x107d82[_0x5bd766][_0x35305f(0x1b4)]++;}catch(_0xf18ba1){console[_0x35305f(0x177)](_0x35305f(0x164)+_0x1f60dd['id']+':',_0xf18ba1);}}Object[_0x35305f(0x168)](_0x328291)['forEach'](_0x2e1ab4=>{const _0x2164e7=_0x35305f;_0x2e1ab4[_0x2164e7(0x11d)]=_0x2e1ab4['paymentsCount']>0x0?_0x2e1ab4[_0x2164e7(0x1d5)]/_0x2e1ab4[_0x2164e7(0x1b4)]:0x0,delete _0x2e1ab4[_0x2164e7(0x1d5)];}),Object[_0x35305f(0x168)](_0x1a7c41)['forEach'](_0x52875f=>{const _0x509953=_0x35305f;_0x52875f['averageCheckUSDT']=_0x52875f[_0x509953(0x1b4)]>0x0?_0x52875f[_0x509953(0x116)]/_0x52875f[_0x509953(0x1b4)]:0x0;});let _0x32b0c0=0x0;if(_0x108d35[_0x35305f(0x146)]){const _0x27d7fb=await database_1[_0x35305f(0x160)][_0x35305f(0x140)]['findMany']({'where':{'shopId':_0x108d35[_0x35305f(0x146)],'status':_0x35305f(0x1d3),'createdAt':{'gte':_0x205ac0,'lte':_0x453944}},'select':{'amount':!![]}});_0x32b0c0=_0x27d7fb[_0x35305f(0x1c0)]((_0x27a328,_0x33eef2)=>_0x27a328+_0x33eef2[_0x35305f(0x1b7)],0x0);}const _0x5376ea=_0x159254[_0x35305f(0x1a6)],_0x54f66f=_0x159254[_0x35305f(0x1a6)],_0x2dedb4=_0x5376ea>0x0?_0x5f4be5/_0x5376ea:0x0,_0x1cc458=0x64,_0x617ff4=Math[_0x35305f(0x112)]((_0x453944[_0x35305f(0x1cf)]()-_0x205ac0['getTime']())/(0x3e8*0x3c*0x3c*0x18)),_0x1e0f38={'totalTurnover':Math[_0x35305f(0x15c)](_0x5f4be5*0x64)/0x64,'merchantEarnings':Math[_0x35305f(0x15c)](_0xb5c40d*0x64)/0x64,'gatewayEarnings':Math[_0x35305f(0x15c)](_0x2277f3*0x64)/0x64,'totalPaidOut':Math[_0x35305f(0x15c)](_0x32b0c0*0x64)/0x64,'averageCheck':Math['round'](_0x2dedb4*0x64)/0x64,'totalPayments':_0x5376ea,'successfulPayments':_0x54f66f,'conversionRate':_0x1cc458,'gatewayBreakdown':Object[_0x35305f(0x168)](_0x328291)[_0x35305f(0x126)](_0x183044=>({..._0x183044,'turnoverUSDT':Math[_0x35305f(0x15c)](_0x183044[_0x35305f(0x116)]*0x64)/0x64,'commissionUSDT':Math[_0x35305f(0x15c)](_0x183044['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x183044[_0x35305f(0x18a)]*0x64)/0x64,'averageCommissionRate':Math['round'](_0x183044['averageCommissionRate']*0x64)/0x64})),'merchantBreakdown':_0x108d35[_0x35305f(0x146)]?undefined:Object['values'](_0x1a7c41)[_0x35305f(0x126)](_0x485b8c=>({..._0x485b8c,'turnoverUSDT':Math[_0x35305f(0x15c)](_0x485b8c[_0x35305f(0x116)]*0x64)/0x64,'commissionUSDT':Math[_0x35305f(0x15c)](_0x485b8c[_0x35305f(0x13b)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x35305f(0x15c)](_0x485b8c[_0x35305f(0x18a)]*0x64)/0x64,'paidOutUSDT':Math['round'](_0x485b8c[_0x35305f(0x198)]*0x64)/0x64,'averageCheckUSDT':Math[_0x35305f(0x15c)](_0x485b8c['averageCheckUSDT']*0x64)/0x64})),'dailyData':Object[_0x35305f(0x168)](_0x107d82)[_0x35305f(0x126)](_0x34cd0c=>({..._0x34cd0c,'turnover':Math['round'](_0x34cd0c[_0x35305f(0x1b0)]*0x64)/0x64,'merchantEarnings':Math[_0x35305f(0x15c)](_0x34cd0c['merchantEarnings']*0x64)/0x64,'gatewayEarnings':Math[_0x35305f(0x15c)](_0x34cd0c['gatewayEarnings']*0x64)/0x64}))[_0x35305f(0x1cd)]((_0x30e7dd,_0x27a789)=>_0x30e7dd[_0x35305f(0x131)][_0x35305f(0x1b5)](_0x27a789[_0x35305f(0x131)])),'periodInfo':{'from':_0x205ac0,'to':_0x453944,'periodType':_0x108d35[_0x35305f(0x16b)]||_0x35305f(0x13c),'daysCount':_0x617ff4}};return console[_0x35305f(0x124)](_0x35305f(0x187)),console[_0x35305f(0x124)](_0x35305f(0x11f)+_0x1e0f38[_0x35305f(0x199)]+_0x35305f(0x182)),console[_0x35305f(0x124)]('\x20\x20\x20👤\x20Merchant\x20earnings:\x20'+_0x1e0f38['merchantEarnings']+'\x20USDT'),console[_0x35305f(0x124)](_0x35305f(0x1aa)+_0x1e0f38['gatewayEarnings']+_0x35305f(0x182)),console['log'](_0x35305f(0x14b)+_0x1e0f38[_0x35305f(0x1bc)]),_0x1e0f38;}[a33_0x4d1d7c(0x180)](_0x1fa4be){const _0x3eb11e=a33_0x4d1d7c,_0x247fb1={'plisio':_0x3eb11e(0x17f),'rapyd':_0x3eb11e(0x18c),'noda':'Noda','cointopay':_0x3eb11e(0x13a),'klyme_eu':_0x3eb11e(0x171),'klyme_gb':'KLYME\x20GB','klyme_de':_0x3eb11e(0x19b)};return _0x247fb1[_0x1fa4be]||_0x1fa4be;}async[a33_0x4d1d7c(0x17d)](_0x3d4135){const _0x284792=a33_0x4d1d7c,{page:_0x362949,limit:_0x1fdffb,minAmount:_0x10d45f,search:_0xb90f12}=_0x3d4135,_0x2d09ca=(_0x362949-0x1)*_0x1fdffb;console[_0x284792(0x124)](_0x284792(0x12b),_0x3d4135);const _0x3ac5ad=await database_1[_0x284792(0x160)][_0x284792(0x142)][_0x284792(0x196)]({'where':{'status':_0x284792(0x184),'merchantPaid':![],'paidAt':{'not':null}},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'gatewaySettings':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}});console['log'](_0x284792(0x145)+_0x3ac5ad[_0x284792(0x1a6)]+'\x20payments\x20awaiting\x20payout');const _0x3dc9ac={};for(const _0x25488f of _0x3ac5ad){const _0x3508c0=_0x25488f['shopId'];!_0x3dc9ac[_0x3508c0]&&(_0x3dc9ac[_0x3508c0]={'id':_0x25488f[_0x284792(0x1c5)]['id'],'fullName':_0x25488f[_0x284792(0x1c5)][_0x284792(0x16c)],'username':_0x25488f[_0x284792(0x1c5)][_0x284792(0x16d)],'telegramId':_0x25488f[_0x284792(0x1c5)][_0x284792(0x121)],'merchantUrl':_0x25488f['shop'][_0x284792(0x19d)],'wallets':{'usdtPolygonWallet':_0x25488f['shop'][_0x284792(0x1ca)],'usdtTrcWallet':_0x25488f['shop'][_0x284792(0x176)],'usdtErcWallet':_0x25488f[_0x284792(0x1c5)][_0x284792(0x15f)],'usdcPolygonWallet':_0x25488f[_0x284792(0x1c5)][_0x284792(0x190)]},'totalAmountUSDT':0x0,'totalAmountAfterCommissionUSDT':0x0,'paymentsCount':0x0,'oldestPaymentDate':_0x25488f[_0x284792(0x17b)],'gatewayBreakdown':{},'gatewaySettings':_0x25488f[_0x284792(0x1c5)]['gatewaySettings']});try{const _0x1211c2=await currencyService_1['currencyService']['convertToUSDT'](_0x25488f[_0x284792(0x1b7)],_0x25488f[_0x284792(0x16e)]);let _0x30307c={};if(_0x25488f['shop'][_0x284792(0x151)])try{_0x30307c=JSON['parse'](_0x25488f[_0x284792(0x1c5)][_0x284792(0x151)]);}catch(_0x2a3331){console[_0x284792(0x177)](_0x284792(0x1d2)+_0x3508c0+':',_0x2a3331);}const _0x28f125=_0x30307c['commission']||0xa,_0x39e0e4=_0x1211c2*(0x1-_0x28f125/0x64);_0x3dc9ac[_0x3508c0]['totalAmountUSDT']+=_0x1211c2,_0x3dc9ac[_0x3508c0][_0x284792(0x191)]+=_0x39e0e4,_0x3dc9ac[_0x3508c0][_0x284792(0x1b4)]++,_0x25488f['paidAt']<_0x3dc9ac[_0x3508c0][_0x284792(0x19e)]&&(_0x3dc9ac[_0x3508c0]['oldestPaymentDate']=_0x25488f[_0x284792(0x17b)]),!_0x3dc9ac[_0x3508c0][_0x284792(0x12e)][_0x25488f['gateway']]&&(_0x3dc9ac[_0x3508c0][_0x284792(0x12e)][_0x25488f['gateway']]={'gateway':_0x25488f[_0x284792(0x12f)],'count':0x0,'amountUSDT':0x0,'amountAfterCommissionUSDT':0x0,'commission':_0x28f125}),_0x3dc9ac[_0x3508c0][_0x284792(0x12e)][_0x25488f['gateway']][_0x284792(0x144)]++,_0x3dc9ac[_0x3508c0][_0x284792(0x12e)][_0x25488f[_0x284792(0x12f)]][_0x284792(0x161)]+=_0x1211c2,_0x3dc9ac[_0x3508c0]['gatewayBreakdown'][_0x25488f[_0x284792(0x12f)]][_0x284792(0x1a3)]+=_0x39e0e4;}catch(_0x3a0e98){console['error'](_0x284792(0x164)+_0x25488f['id']+':',_0x3a0e98);}}let _0x128b9b=Object[_0x284792(0x168)](_0x3dc9ac)[_0x284792(0x126)](_0xe43324=>({..._0xe43324,'totalAmountUSDT':Math[_0x284792(0x15c)](_0xe43324['totalAmountUSDT']*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x284792(0x15c)](_0xe43324['totalAmountAfterCommissionUSDT']*0x64)/0x64,'gatewayBreakdown':Object[_0x284792(0x168)](_0xe43324[_0x284792(0x12e)])[_0x284792(0x126)](_0x514b96=>({..._0x514b96,'amountUSDT':Math[_0x284792(0x15c)](_0x514b96[_0x284792(0x161)]*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x284792(0x15c)](_0x514b96[_0x284792(0x1a3)]*0x64)/0x64}))}));_0x10d45f&&(_0x128b9b=_0x128b9b['filter'](_0x67630a=>_0x67630a[_0x284792(0x191)]>=_0x10d45f));if(_0xb90f12){const _0x359a64=_0xb90f12[_0x284792(0x143)]();_0x128b9b=_0x128b9b[_0x284792(0x1be)](_0x3aa364=>_0x3aa364[_0x284792(0x195)][_0x284792(0x143)]()['includes'](_0x359a64)||_0x3aa364['username'][_0x284792(0x143)]()[_0x284792(0x159)](_0x359a64));}_0x128b9b['sort']((_0x241f1e,_0x304494)=>_0x304494[_0x284792(0x191)]-_0x241f1e[_0x284792(0x191)]);const _0x562d32=_0x128b9b[_0x284792(0x1a6)],_0x310648=_0x128b9b['slice'](_0x2d09ca,_0x2d09ca+_0x1fdffb),_0x1fa3c9=_0x128b9b['reduce']((_0x686cc7,_0x580bcd)=>_0x686cc7+_0x580bcd[_0x284792(0x148)],0x0),_0x1b9dcc=_0x128b9b['reduce']((_0x2bcfc1,_0x4b8fe0)=>_0x2bcfc1+_0x4b8fe0[_0x284792(0x191)],0x0);return console['log'](_0x284792(0x1bd)+_0x562d32+_0x284792(0x197)+Math[_0x284792(0x15c)](_0x1b9dcc*0x64)/0x64+'\x20USDT\x20total'),{'merchants':_0x310648,'pagination':{'page':_0x362949,'limit':_0x1fdffb,'total':_0x562d32,'totalPages':Math['ceil'](_0x562d32/_0x1fdffb)},'summary':{'totalMerchants':_0x562d32,'totalAmountUSDT':Math['round'](_0x1fa3c9*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x1b9dcc*0x64)/0x64}};}async[a33_0x4d1d7c(0x138)](_0x3e2cc9){const _0xa9d030=a33_0x4d1d7c,{shopId:_0x51891d,amount:_0x20abfa,network:_0x3d9aed,notes:_0x285a93,periodFrom:_0x1943f2,periodTo:_0x30e3e2}=_0x3e2cc9,_0x46b992=await database_1[_0xa9d030(0x160)][_0xa9d030(0x1c5)][_0xa9d030(0x11c)]({'where':{'id':_0x51891d},'select':{'id':!![],'name':!![],'username':!![]}});if(!_0x46b992)throw new Error(_0xa9d030(0x181));const _0x34c935=await database_1[_0xa9d030(0x160)][_0xa9d030(0x140)][_0xa9d030(0x183)]({'data':{'shopId':_0x51891d,'amount':_0x20abfa,'network':_0x3d9aed,'status':'COMPLETED','notes':_0x285a93,'periodFrom':_0x1943f2?new Date(_0x1943f2):null,'periodTo':_0x30e3e2?new Date(_0x30e3e2):null,'createdAt':new Date(),'paidAt':new Date()}});return console['log']('✅\x20Payout\x20created:\x20'+_0x34c935['id']+_0xa9d030(0x14a)+_0x46b992[_0xa9d030(0x16d)]+'\x20('+_0x20abfa+_0xa9d030(0x166)),{'id':_0x34c935['id'],'shopId':_0x34c935[_0xa9d030(0x146)],'shopName':_0x46b992[_0xa9d030(0x16c)],'shopUsername':_0x46b992[_0xa9d030(0x16d)],'amount':_0x34c935[_0xa9d030(0x1b7)],'network':_0x34c935['network'],'status':_0x34c935[_0xa9d030(0x1a5)],'txid':_0x34c935[_0xa9d030(0x193)],'notes':_0x34c935['notes'],'periodFrom':_0x34c935[_0xa9d030(0x1ab)],'periodTo':_0x34c935['periodTo'],'createdAt':_0x34c935[_0xa9d030(0x12d)],'paidAt':_0x34c935[_0xa9d030(0x17b)]};}async[a33_0x4d1d7c(0x128)](_0x28f554){const _0x6c6259=a33_0x4d1d7c,{page:_0x1a8bce,limit:_0xb6a656,shopId:_0x41f4e2,network:_0x27275e,dateFrom:_0x3c0366,dateTo:_0x4cb77b,search:_0x16a2a6}=_0x28f554,_0x44ac1a=(_0x1a8bce-0x1)*_0xb6a656,_0x1a0dd7={};_0x41f4e2&&(_0x1a0dd7['shopId']=_0x41f4e2);_0x27275e&&(_0x1a0dd7[_0x6c6259(0x175)]=_0x27275e);(_0x3c0366||_0x4cb77b)&&(_0x1a0dd7[_0x6c6259(0x12d)]={},_0x3c0366&&(_0x1a0dd7['createdAt'][_0x6c6259(0x17e)]=new Date(_0x3c0366)),_0x4cb77b&&(_0x1a0dd7[_0x6c6259(0x12d)]['lte']=new Date(_0x4cb77b)));_0x16a2a6&&(_0x1a0dd7['OR']=[{'shop':{'name':{'contains':_0x16a2a6,'mode':_0x6c6259(0x169)}}},{'shop':{'username':{'contains':_0x16a2a6,'mode':_0x6c6259(0x169)}}},{'notes':{'contains':_0x16a2a6,'mode':'insensitive'}}]);const [_0x3d67ab,_0x379600]=await Promise[_0x6c6259(0x163)]([database_1[_0x6c6259(0x160)][_0x6c6259(0x140)][_0x6c6259(0x196)]({'where':_0x1a0dd7,'skip':_0x44ac1a,'take':_0xb6a656,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x6c6259(0x160)][_0x6c6259(0x140)]['count']({'where':_0x1a0dd7})]);return{'payouts':_0x3d67ab['map'](_0x33e671=>({'id':_0x33e671['id'],'shopId':_0x33e671['shopId'],'shopName':_0x33e671[_0x6c6259(0x1c5)]['name'],'shopUsername':_0x33e671['shop'][_0x6c6259(0x16d)],'amount':_0x33e671[_0x6c6259(0x1b7)],'network':_0x33e671[_0x6c6259(0x175)],'status':_0x33e671['status'],'txid':_0x33e671['txid'],'notes':_0x33e671[_0x6c6259(0x125)],'periodFrom':_0x33e671[_0x6c6259(0x1ab)],'periodTo':_0x33e671[_0x6c6259(0x13e)],'createdAt':_0x33e671[_0x6c6259(0x12d)],'paidAt':_0x33e671[_0x6c6259(0x17b)]})),'pagination':{'page':_0x1a8bce,'limit':_0xb6a656,'total':_0x379600,'totalPages':Math[_0x6c6259(0x112)](_0x379600/_0xb6a656)}};}async[a33_0x4d1d7c(0x192)](_0x124e4c){const _0x413e11=a33_0x4d1d7c,_0x228535=await database_1[_0x413e11(0x160)]['payout'][_0x413e11(0x11c)]({'where':{'id':_0x124e4c},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x228535)return null;return{'id':_0x228535['id'],'shopId':_0x228535[_0x413e11(0x146)],'shopName':_0x228535[_0x413e11(0x1c5)]['name'],'shopUsername':_0x228535[_0x413e11(0x1c5)]['username'],'amount':_0x228535[_0x413e11(0x1b7)],'network':_0x228535['network'],'status':_0x228535[_0x413e11(0x1a5)],'txid':_0x228535[_0x413e11(0x193)],'notes':_0x228535[_0x413e11(0x125)],'periodFrom':_0x228535[_0x413e11(0x1ab)],'periodTo':_0x228535['periodTo'],'createdAt':_0x228535[_0x413e11(0x12d)],'paidAt':_0x228535[_0x413e11(0x17b)]};}async[a33_0x4d1d7c(0x1b6)](_0x2c16e5){const _0x1ea45a=a33_0x4d1d7c;await database_1['default'][_0x1ea45a(0x140)]['delete']({'where':{'id':_0x2c16e5}});}async[a33_0x4d1d7c(0x15a)](_0x191458){const _0x5c31cf=a33_0x4d1d7c,{page:_0x18e131,limit:_0x354bc9,status:_0x28a100,gateway:_0x113023,shopId:_0x4ddf90,dateFrom:_0x40a52f,dateTo:_0x3ed012,search:_0x145a13}=_0x191458,_0x54391a=(_0x18e131-0x1)*_0x354bc9,_0x35b649={};_0x28a100&&(_0x35b649[_0x5c31cf(0x1a5)]=_0x28a100[_0x5c31cf(0x1c8)]());_0x113023&&(_0x35b649[_0x5c31cf(0x12f)]=_0x113023[_0x5c31cf(0x143)]());_0x4ddf90&&(_0x35b649[_0x5c31cf(0x146)]=_0x4ddf90);(_0x40a52f||_0x3ed012)&&(_0x35b649['createdAt']={},_0x40a52f&&(_0x35b649[_0x5c31cf(0x12d)][_0x5c31cf(0x17e)]=new Date(_0x40a52f)),_0x3ed012&&(_0x35b649['createdAt'][_0x5c31cf(0x1c1)]=new Date(_0x3ed012)));_0x145a13&&(_0x35b649['OR']=[{'orderId':{'contains':_0x145a13,'mode':_0x5c31cf(0x169)}},{'gatewayOrderId':{'contains':_0x145a13,'mode':_0x5c31cf(0x169)}},{'customerEmail':{'contains':_0x145a13,'mode':_0x5c31cf(0x169)}},{'shop':{'name':{'contains':_0x145a13,'mode':_0x5c31cf(0x169)}}},{'shop':{'username':{'contains':_0x145a13,'mode':_0x5c31cf(0x169)}}}]);const [_0x5d64cb,_0x21aa06]=await Promise[_0x5c31cf(0x163)]([database_1[_0x5c31cf(0x160)][_0x5c31cf(0x142)]['findMany']({'where':_0x35b649,'skip':_0x54391a,'take':_0x354bc9,'orderBy':{'createdAt':_0x5c31cf(0x153)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x5c31cf(0x160)]['payment']['count']({'where':_0x35b649})]);return{'payments':_0x5d64cb[_0x5c31cf(0x126)](_0x22fecc=>({'id':_0x22fecc['id'],'shopId':_0x22fecc['shopId'],'gateway':_0x22fecc[_0x5c31cf(0x12f)],'amount':_0x22fecc[_0x5c31cf(0x1b7)],'currency':_0x22fecc[_0x5c31cf(0x16e)],'status':_0x22fecc[_0x5c31cf(0x1a5)],'orderId':_0x22fecc[_0x5c31cf(0x120)],'gatewayOrderId':_0x22fecc[_0x5c31cf(0x115)],'customerEmail':_0x22fecc[_0x5c31cf(0x19f)],'customerName':_0x22fecc[_0x5c31cf(0x11a)],'customerCountry':_0x22fecc['customerCountry'],'customerIp':_0x22fecc[_0x5c31cf(0x119)],'customerUa':_0x22fecc[_0x5c31cf(0x1a4)],'failureMessage':_0x22fecc['failureMessage'],'createdAt':_0x22fecc[_0x5c31cf(0x12d)],'updatedAt':_0x22fecc[_0x5c31cf(0x1b3)],'shop':_0x22fecc['shop']})),'pagination':{'page':_0x18e131,'limit':_0x354bc9,'total':_0x21aa06,'totalPages':Math[_0x5c31cf(0x112)](_0x21aa06/_0x354bc9)}};}async[a33_0x4d1d7c(0x1ce)](_0x3caabc){const _0x49e2d2=a33_0x4d1d7c,_0x2f706f=await database_1[_0x49e2d2(0x160)][_0x49e2d2(0x142)]['findUnique']({'where':{'id':_0x3caabc},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x2f706f)return null;return{'id':_0x2f706f['id'],'shopId':_0x2f706f[_0x49e2d2(0x146)],'gateway':_0x2f706f[_0x49e2d2(0x12f)],'amount':_0x2f706f[_0x49e2d2(0x1b7)],'currency':_0x2f706f[_0x49e2d2(0x16e)],'status':_0x2f706f[_0x49e2d2(0x1a5)],'orderId':_0x2f706f[_0x49e2d2(0x120)],'gatewayOrderId':_0x2f706f[_0x49e2d2(0x115)],'customerEmail':_0x2f706f[_0x49e2d2(0x19f)],'customerName':_0x2f706f[_0x49e2d2(0x11a)],'customerCountry':_0x2f706f[_0x49e2d2(0x118)],'customerIp':_0x2f706f['customerIp'],'customerUa':_0x2f706f['customerUa'],'failureMessage':_0x2f706f[_0x49e2d2(0x1b2)],'externalPaymentUrl':_0x2f706f[_0x49e2d2(0x139)],'successUrl':_0x2f706f[_0x49e2d2(0x1a7)],'failUrl':_0x2f706f[_0x49e2d2(0x17a)],'pendingUrl':_0x2f706f['pendingUrl'],'whiteUrl':_0x2f706f['whiteUrl'],'createdAt':_0x2f706f[_0x49e2d2(0x12d)],'updatedAt':_0x2f706f[_0x49e2d2(0x1b3)],'shop':_0x2f706f[_0x49e2d2(0x1c5)]};}async[a33_0x4d1d7c(0x173)](_0x391ab7,_0x389657,_0x551203,_0x20cb74){const _0x1892cb=a33_0x4d1d7c,_0x3b5943={'status':_0x389657[_0x1892cb(0x1c8)](),'updatedAt':new Date(),'statusChangedBy':'admin','statusChangedAt':new Date()};_0x551203&&(_0x3b5943[_0x1892cb(0x152)]=_0x551203);_0x389657[_0x1892cb(0x1c8)]()==='CHARGEBACK'&&_0x20cb74&&(_0x3b5943[_0x1892cb(0x189)]=_0x20cb74);_0x389657[_0x1892cb(0x1c8)]()===_0x1892cb(0x184)&&(_0x3b5943[_0x1892cb(0x17b)]=new Date());const _0x2496b9=await database_1['default'][_0x1892cb(0x142)][_0x1892cb(0x1a8)]({'where':{'id':_0x391ab7},'data':_0x3b5943,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return{'id':_0x2496b9['id'],'shopId':_0x2496b9['shopId'],'gateway':_0x2496b9[_0x1892cb(0x12f)],'amount':_0x2496b9[_0x1892cb(0x1b7)],'currency':_0x2496b9['currency'],'status':_0x2496b9[_0x1892cb(0x1a5)],'orderId':_0x2496b9[_0x1892cb(0x120)],'gatewayOrderId':_0x2496b9[_0x1892cb(0x115)],'customerEmail':_0x2496b9[_0x1892cb(0x19f)],'customerName':_0x2496b9['customerName'],'customerCountry':_0x2496b9[_0x1892cb(0x118)],'customerIp':_0x2496b9[_0x1892cb(0x119)],'customerUa':_0x2496b9[_0x1892cb(0x1a4)],'failureMessage':_0x2496b9['failureMessage'],'adminNotes':_0x2496b9[_0x1892cb(0x152)],'chargebackAmount':_0x2496b9[_0x1892cb(0x189)],'statusChangedBy':_0x2496b9[_0x1892cb(0x1a1)],'statusChangedAt':_0x2496b9[_0x1892cb(0x14e)],'createdAt':_0x2496b9[_0x1892cb(0x12d)],'updatedAt':_0x2496b9[_0x1892cb(0x1b3)],'shop':_0x2496b9[_0x1892cb(0x1c5)]};}async[a33_0x4d1d7c(0x1ac)](_0x577b84,_0x36dba6){const _0x1e5d84=a33_0x4d1d7c,_0x4b330f={..._0x36dba6};_0x36dba6[_0x1e5d84(0x1bb)]&&(_0x4b330f['password']=await bcryptjs_1['default'][_0x1e5d84(0x122)](_0x36dba6[_0x1e5d84(0x1bb)],0xc));_0x36dba6['fullName']&&(_0x4b330f[_0x1e5d84(0x16c)]=_0x36dba6['fullName'],delete _0x4b330f[_0x1e5d84(0x195)]);_0x36dba6['telegramId']&&(_0x4b330f[_0x1e5d84(0x121)]=_0x36dba6[_0x1e5d84(0x1d4)],delete _0x4b330f[_0x1e5d84(0x1d4)]);_0x36dba6[_0x1e5d84(0x156)]&&(_0x4b330f[_0x1e5d84(0x19d)]=_0x36dba6['merchantUrl'],delete _0x4b330f[_0x1e5d84(0x156)]);_0x36dba6[_0x1e5d84(0x18e)]&&(_0x4b330f[_0x1e5d84(0x16f)]=JSON[_0x1e5d84(0x137)](_0x36dba6[_0x1e5d84(0x18e)]),delete _0x4b330f[_0x1e5d84(0x18e)]);_0x36dba6[_0x1e5d84(0x151)]&&(_0x4b330f['gatewaySettings']=JSON[_0x1e5d84(0x137)](_0x36dba6[_0x1e5d84(0x151)]),delete _0x4b330f[_0x1e5d84(0x151)]);_0x36dba6[_0x1e5d84(0x1cc)]&&(_0x36dba6[_0x1e5d84(0x1cc)][_0x1e5d84(0x1ca)]!==undefined&&(_0x4b330f[_0x1e5d84(0x1ca)]=_0x36dba6[_0x1e5d84(0x1cc)][_0x1e5d84(0x1ca)]||null),_0x36dba6[_0x1e5d84(0x1cc)][_0x1e5d84(0x176)]!==undefined&&(_0x4b330f[_0x1e5d84(0x176)]=_0x36dba6[_0x1e5d84(0x1cc)][_0x1e5d84(0x176)]||null),_0x36dba6[_0x1e5d84(0x1cc)]['usdtErcWallet']!==undefined&&(_0x4b330f[_0x1e5d84(0x15f)]=_0x36dba6[_0x1e5d84(0x1cc)]['usdtErcWallet']||null),_0x36dba6[_0x1e5d84(0x1cc)][_0x1e5d84(0x190)]!==undefined&&(_0x4b330f['usdcPolygonWallet']=_0x36dba6['wallets'][_0x1e5d84(0x190)]||null),delete _0x4b330f[_0x1e5d84(0x1cc)]);const _0x185166=await database_1[_0x1e5d84(0x160)][_0x1e5d84(0x1c5)][_0x1e5d84(0x1a8)]({'where':{'id':_0x577b84},'data':_0x4b330f,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x185166['id'],'fullName':_0x185166[_0x1e5d84(0x16c)],'username':_0x185166['username'],'telegramId':_0x185166['telegram'],'merchantUrl':_0x185166[_0x1e5d84(0x19d)],'gateways':_0x185166[_0x1e5d84(0x16f)]?JSON[_0x1e5d84(0x147)](_0x185166[_0x1e5d84(0x16f)]):null,'gatewaySettings':_0x185166['gatewaySettings']?JSON[_0x1e5d84(0x147)](_0x185166['gatewaySettings']):null,'publicKey':_0x185166['publicKey'],'wallets':{'usdtPolygonWallet':_0x185166[_0x1e5d84(0x1ca)],'usdtTrcWallet':_0x185166[_0x1e5d84(0x176)],'usdtErcWallet':_0x185166[_0x1e5d84(0x15f)],'usdcPolygonWallet':_0x185166['usdcPolygonWallet']},'status':_0x185166[_0x1e5d84(0x1a5)],'createdAt':_0x185166[_0x1e5d84(0x12d)]};}async['suspendUser'](_0x308a91){const _0x1529b0=a33_0x4d1d7c,_0x5af053=await database_1['default'][_0x1529b0(0x1c5)]['update']({'where':{'id':_0x308a91},'data':{'status':_0x1529b0(0x1af)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x5af053['id'],'fullName':_0x5af053[_0x1529b0(0x16c)],'username':_0x5af053[_0x1529b0(0x16d)],'telegramId':_0x5af053[_0x1529b0(0x121)],'merchantUrl':_0x5af053[_0x1529b0(0x19d)],'gateways':_0x5af053[_0x1529b0(0x16f)]?JSON[_0x1529b0(0x147)](_0x5af053[_0x1529b0(0x16f)]):null,'gatewaySettings':_0x5af053['gatewaySettings']?JSON[_0x1529b0(0x147)](_0x5af053[_0x1529b0(0x151)]):null,'publicKey':_0x5af053[_0x1529b0(0x14d)],'wallets':{'usdtPolygonWallet':_0x5af053[_0x1529b0(0x1ca)],'usdtTrcWallet':_0x5af053[_0x1529b0(0x176)],'usdtErcWallet':_0x5af053[_0x1529b0(0x15f)],'usdcPolygonWallet':_0x5af053[_0x1529b0(0x190)]},'status':_0x5af053[_0x1529b0(0x1a5)],'createdAt':_0x5af053[_0x1529b0(0x12d)]};}async['activateUser'](_0x53ab4b){const _0x21dd04=a33_0x4d1d7c,_0x289ba4=await database_1[_0x21dd04(0x160)][_0x21dd04(0x1c5)][_0x21dd04(0x1a8)]({'where':{'id':_0x53ab4b},'data':{'status':_0x21dd04(0x1d1)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x289ba4['id'],'fullName':_0x289ba4[_0x21dd04(0x16c)],'username':_0x289ba4['username'],'telegramId':_0x289ba4[_0x21dd04(0x121)],'merchantUrl':_0x289ba4[_0x21dd04(0x19d)],'gateways':_0x289ba4[_0x21dd04(0x16f)]?JSON['parse'](_0x289ba4['paymentGateways']):null,'gatewaySettings':_0x289ba4[_0x21dd04(0x151)]?JSON[_0x21dd04(0x147)](_0x289ba4[_0x21dd04(0x151)]):null,'publicKey':_0x289ba4[_0x21dd04(0x14d)],'wallets':{'usdtPolygonWallet':_0x289ba4[_0x21dd04(0x1ca)],'usdtTrcWallet':_0x289ba4[_0x21dd04(0x176)],'usdtErcWallet':_0x289ba4['usdtErcWallet'],'usdcPolygonWallet':_0x289ba4[_0x21dd04(0x190)]},'status':_0x289ba4[_0x21dd04(0x1a5)],'createdAt':_0x289ba4['createdAt']};}async[a33_0x4d1d7c(0x15e)](_0x4c6651){const _0x23ef12=a33_0x4d1d7c,{page:_0x24de8f,limit:_0x2d10da,status:_0x2369ef}=_0x4c6651,_0x5a6fbe=(_0x24de8f-0x1)*_0x2d10da,_0x48929d={};_0x2369ef&&(_0x48929d[_0x23ef12(0x1a5)]=_0x2369ef['toUpperCase']());const [_0x5598b,_0xe7df8c]=await Promise[_0x23ef12(0x163)]([database_1[_0x23ef12(0x160)]['shop'][_0x23ef12(0x196)]({'where':_0x48929d,'skip':_0x5a6fbe,'take':_0x2d10da,'orderBy':{'createdAt':_0x23ef12(0x153)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1['default'][_0x23ef12(0x1c5)]['count']({'where':_0x48929d})]);return{'users':_0x5598b['map'](_0x4b8fb6=>({'id':_0x4b8fb6['id'],'fullName':_0x4b8fb6['name'],'username':_0x4b8fb6[_0x23ef12(0x16d)],'telegramId':_0x4b8fb6['telegram'],'merchantUrl':_0x4b8fb6[_0x23ef12(0x19d)],'gateways':_0x4b8fb6['paymentGateways']?JSON[_0x23ef12(0x147)](_0x4b8fb6['paymentGateways']):null,'gatewaySettings':_0x4b8fb6['gatewaySettings']?JSON['parse'](_0x4b8fb6['gatewaySettings']):null,'publicKey':_0x4b8fb6['publicKey'],'wallets':{'usdtPolygonWallet':_0x4b8fb6[_0x23ef12(0x1ca)],'usdtTrcWallet':_0x4b8fb6[_0x23ef12(0x176)],'usdtErcWallet':_0x4b8fb6['usdtErcWallet'],'usdcPolygonWallet':_0x4b8fb6[_0x23ef12(0x190)]},'status':_0x4b8fb6['status'],'createdAt':_0x4b8fb6['createdAt']})),'pagination':{'page':_0x24de8f,'limit':_0x2d10da,'total':_0xe7df8c,'totalPages':Math[_0x23ef12(0x112)](_0xe7df8c/_0x2d10da)}};}async[a33_0x4d1d7c(0x127)](_0xd840a9){const _0x574b13=a33_0x4d1d7c,_0x12ae14=await database_1[_0x574b13(0x160)]['shop'][_0x574b13(0x11c)]({'where':{'id':_0xd840a9},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x12ae14)return null;return{'id':_0x12ae14['id'],'fullName':_0x12ae14[_0x574b13(0x16c)],'username':_0x12ae14[_0x574b13(0x16d)],'telegramId':_0x12ae14[_0x574b13(0x121)],'merchantUrl':_0x12ae14[_0x574b13(0x19d)],'gateways':_0x12ae14[_0x574b13(0x16f)]?JSON[_0x574b13(0x147)](_0x12ae14[_0x574b13(0x16f)]):null,'gatewaySettings':_0x12ae14[_0x574b13(0x151)]?JSON[_0x574b13(0x147)](_0x12ae14[_0x574b13(0x151)]):null,'publicKey':_0x12ae14['publicKey'],'wallets':{'usdtPolygonWallet':_0x12ae14[_0x574b13(0x1ca)],'usdtTrcWallet':_0x12ae14[_0x574b13(0x176)],'usdtErcWallet':_0x12ae14[_0x574b13(0x15f)],'usdcPolygonWallet':_0x12ae14['usdcPolygonWallet']},'status':_0x12ae14[_0x574b13(0x1a5)],'createdAt':_0x12ae14[_0x574b13(0x12d)]};}async[a33_0x4d1d7c(0x1c3)](_0x264677){const _0x56bc3c=a33_0x4d1d7c,{fullName:_0x2093b2,username:_0x5ba2a3,password:_0x13263d,telegramId:_0x5786c2,merchantUrl:_0x37fbf5,gateways:_0x523a82,gatewaySettings:_0x279495,wallets:_0x40a4d4}=_0x264677,_0x4c6fe3=await database_1['default'][_0x56bc3c(0x1c5)][_0x56bc3c(0x11c)]({'where':{'username':_0x5ba2a3}});if(_0x4c6fe3)throw new Error(_0x56bc3c(0x18d));if(_0x5786c2){const _0xb5d658=await database_1[_0x56bc3c(0x160)][_0x56bc3c(0x1c5)][_0x56bc3c(0x11c)]({'where':{'telegram':_0x5786c2}});if(_0xb5d658)throw new Error(_0x56bc3c(0x1c6));}const _0x23edc4=await bcryptjs_1[_0x56bc3c(0x160)]['hash'](_0x13263d,0xc),_0x57608b=_0x56bc3c(0x167)+crypto_1[_0x56bc3c(0x160)][_0x56bc3c(0x1a0)](0x20)[_0x56bc3c(0x149)](_0x56bc3c(0x1b1)),_0x2c6ad5=_0x56bc3c(0x12c)+crypto_1[_0x56bc3c(0x160)]['randomBytes'](0x20)['toString'](_0x56bc3c(0x1b1)),_0x54b2dd=await database_1[_0x56bc3c(0x160)]['shop'][_0x56bc3c(0x183)]({'data':{'name':_0x2093b2,'username':_0x5ba2a3,'password':_0x23edc4,'telegram':_0x5786c2,'shopUrl':_0x37fbf5,'paymentGateways':_0x523a82?JSON[_0x56bc3c(0x137)](_0x523a82):null,'gatewaySettings':_0x279495?JSON[_0x56bc3c(0x137)](_0x279495):null,'usdtPolygonWallet':_0x40a4d4?.[_0x56bc3c(0x1ca)]||null,'usdtTrcWallet':_0x40a4d4?.[_0x56bc3c(0x176)]||null,'usdtErcWallet':_0x40a4d4?.[_0x56bc3c(0x15f)]||null,'usdcPolygonWallet':_0x40a4d4?.[_0x56bc3c(0x190)]||null,'publicKey':_0x57608b,'secretKey':_0x2c6ad5,'status':_0x56bc3c(0x1d1)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x54b2dd['id'],'fullName':_0x54b2dd[_0x56bc3c(0x16c)],'username':_0x54b2dd[_0x56bc3c(0x16d)],'telegramId':_0x54b2dd['telegram'],'merchantUrl':_0x54b2dd[_0x56bc3c(0x19d)],'gateways':_0x54b2dd[_0x56bc3c(0x16f)]?JSON['parse'](_0x54b2dd[_0x56bc3c(0x16f)]):null,'gatewaySettings':_0x54b2dd['gatewaySettings']?JSON['parse'](_0x54b2dd[_0x56bc3c(0x151)]):null,'publicKey':_0x54b2dd['publicKey'],'wallets':{'usdtPolygonWallet':_0x54b2dd[_0x56bc3c(0x1ca)],'usdtTrcWallet':_0x54b2dd[_0x56bc3c(0x176)],'usdtErcWallet':_0x54b2dd[_0x56bc3c(0x15f)],'usdcPolygonWallet':_0x54b2dd['usdcPolygonWallet']},'status':_0x54b2dd[_0x56bc3c(0x1a5)],'createdAt':_0x54b2dd['createdAt']};}async['deleteUser'](_0x3d7ce6){const _0x139255=a33_0x4d1d7c;await database_1[_0x139255(0x160)][_0x139255(0x1c5)][_0x139255(0x11b)]({'where':{'id':_0x3d7ce6}});}}exports[a33_0x4d1d7c(0x1cb)]=AdminService;