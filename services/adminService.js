'use strict';const a53_0x3421aa=a53_0x3f27;(function(_0x2e1883,_0x43bd62){const _0x549a44=a53_0x3f27,_0x38e217=_0x2e1883();while(!![]){try{const _0xb38604=parseInt(_0x549a44(0x1f2))/0x1*(parseInt(_0x549a44(0x2e9))/0x2)+parseInt(_0x549a44(0x239))/0x3+-parseInt(_0x549a44(0x284))/0x4*(-parseInt(_0x549a44(0x2a0))/0x5)+parseInt(_0x549a44(0x295))/0x6+-parseInt(_0x549a44(0x18f))/0x7+-parseInt(_0x549a44(0x2a1))/0x8+-parseInt(_0x549a44(0x324))/0x9;if(_0xb38604===_0x43bd62)break;else _0x38e217['push'](_0x38e217['shift']());}catch(_0x19a93a){_0x38e217['push'](_0x38e217['shift']());}}}(a53_0x4ae2,0x5c766));var __importDefault=this&&this['__importDefault']||function(_0x5e6473){const _0x391702=a53_0x3f27;return _0x5e6473&&_0x5e6473[_0x391702(0x218)]?_0x5e6473:{'default':_0x5e6473};};function a53_0x3f27(_0x1d0544,_0x14b31d){_0x1d0544=_0x1d0544-0x15f;const _0x4ae241=a53_0x4ae2();let _0x3f27d8=_0x4ae241[_0x1d0544];return _0x3f27d8;}Object[a53_0x3421aa(0x17b)](exports,a53_0x3421aa(0x218),{'value':!![]}),exports[a53_0x3421aa(0x18a)]=void 0x0;const database_1=__importDefault(require('../config/database')),bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a53_0x3421aa(0x200))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path')),speakeasy_1=__importDefault(require('speakeasy')),qrcode_1=__importDefault(require(a53_0x3421aa(0x24b))),config_1=require(a53_0x3421aa(0x171)),currencyService_1=require(a53_0x3421aa(0x310)),telegramBotService_1=require(a53_0x3421aa(0x2b6)),gateway_1=require(a53_0x3421aa(0x2bd));class AdminService{async['getPayoutStats'](){const _0x339036=a53_0x3421aa;console[_0x339036(0x22a)](_0x339036(0x29a));const _0x7daf8c=await database_1[_0x339036(0x1c6)][_0x339036(0x293)][_0x339036(0x186)]({'_sum':{'balance':!![],'totalPaidOut':!![]}}),_0x3bcc5f=await database_1[_0x339036(0x1c6)][_0x339036(0x27a)][_0x339036(0x160)]({'where':{'status':_0x339036(0x225),'gateway':{'not':_0x339036(0x258)}}}),_0x4775eb=new Date(),_0x210aa0=new Date(_0x4775eb[_0x339036(0x297)](),_0x4775eb[_0x339036(0x19c)](),0x1),_0x1a15ed=new Date(_0x4775eb[_0x339036(0x297)](),_0x4775eb['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x2368e6=await database_1['default'][_0x339036(0x1f7)][_0x339036(0x186)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x210aa0,'lte':_0x1a15ed},'status':_0x339036(0x19d)}}),_0x1b102e=_0x7daf8c[_0x339036(0x1a0)][_0x339036(0x2d2)]||0x0,_0x3d479c=_0x7daf8c[_0x339036(0x1a0)][_0x339036(0x25c)]||0x0,_0x10e223=_0x2368e6[_0x339036(0x1a0)][_0x339036(0x165)]||0x0,_0x366d2c={'totalPayout':Math['round'](_0x1b102e*0x64)/0x64,'awaitingPayout':Math['round'](_0x3d479c*0x64)/0x64,'thisMonth':Math['round'](_0x10e223*0x64)/0x64,'availableBalance':Math[_0x339036(0x319)](_0x3d479c*0x64)/0x64,'totalPayments':_0x3bcc5f};return console[_0x339036(0x22a)](_0x339036(0x1f9)),console[_0x339036(0x22a)](_0x339036(0x263)+_0x366d2c[_0x339036(0x31d)]+_0x339036(0x314)),console[_0x339036(0x22a)]('\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20'+_0x366d2c['awaitingPayout']+'\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)'),console[_0x339036(0x22a)](_0x339036(0x1c7)+_0x366d2c['availableBalance']+_0x339036(0x202)),console[_0x339036(0x22a)]('\x20\x20\x20üìÖ\x20This\x20month:\x20'+_0x366d2c[_0x339036(0x2ac)]+_0x339036(0x1e9)),console[_0x339036(0x22a)](_0x339036(0x21b)+_0x366d2c[_0x339036(0x24c)]+'\x20PAID\x20payments'),_0x366d2c;}async['updateCustomerData'](_0x5efcd5,_0x4c200e){const _0x3480ef=a53_0x3421aa;console[_0x3480ef(0x22a)](_0x3480ef(0x29c)+_0x5efcd5+':',_0x4c200e);const _0x1d78e6=await database_1['default']['payment'][_0x3480ef(0x184)]({'where':{'id':_0x5efcd5},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x1d78e6)throw new Error(_0x3480ef(0x292));const _0x17c65c={};_0x4c200e[_0x3480ef(0x2a7)]!==undefined&&(_0x17c65c[_0x3480ef(0x2a7)]=_0x4c200e[_0x3480ef(0x2a7)]||null);_0x4c200e[_0x3480ef(0x19e)]!==undefined&&(_0x17c65c[_0x3480ef(0x19e)]=_0x4c200e['customerIp']||null);_0x4c200e[_0x3480ef(0x237)]!==undefined&&(_0x17c65c['customerUa']=_0x4c200e[_0x3480ef(0x237)]||null);const _0x43c491=await database_1[_0x3480ef(0x1c6)]['payment']['update']({'where':{'id':_0x5efcd5},'data':{..._0x17c65c,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x3480ef(0x22a)](_0x3480ef(0x1be)+_0x5efcd5),console[_0x3480ef(0x22a)](_0x3480ef(0x230)+_0x1d78e6[_0x3480ef(0x2a7)]+_0x3480ef(0x28d)+_0x43c491[_0x3480ef(0x2a7)]),console[_0x3480ef(0x22a)](_0x3480ef(0x299)+_0x1d78e6['customerIp']+'\x20->\x20'+_0x43c491[_0x3480ef(0x19e)]),console[_0x3480ef(0x22a)](_0x3480ef(0x2ce)+(_0x1d78e6[_0x3480ef(0x237)]?'set':_0x3480ef(0x1b2))+_0x3480ef(0x28d)+(_0x43c491[_0x3480ef(0x237)]?_0x3480ef(0x290):'not\x20set')),_0x43c491;}async[a53_0x3421aa(0x1a3)](_0x266bb4,_0x32c337){const _0x48eb2e=a53_0x3421aa,_0x16fadc=_0x32c337?new Date(_0x32c337):new Date();let _0x86876e,_0x42de55;if(_0x266bb4[_0x48eb2e(0x252)]('custom_')){const _0x3bdbe3=_0x266bb4[_0x48eb2e(0x2f5)](_0x48eb2e(0x173),'')[_0x48eb2e(0x2c9)]('_');if(_0x3bdbe3[_0x48eb2e(0x2ea)]===0x2){const _0x37fa5d=new Date(_0x3bdbe3[0x0]),_0x41beb0=new Date(_0x3bdbe3[0x1]);_0x86876e=new Date(Date['UTC'](_0x37fa5d[_0x48eb2e(0x1c0)](),_0x37fa5d[_0x48eb2e(0x313)](),_0x37fa5d[_0x48eb2e(0x211)](),0x0,0x0,0x0,0x0)),_0x42de55=new Date(Date[_0x48eb2e(0x2ff)](_0x41beb0[_0x48eb2e(0x1c0)](),_0x41beb0['getUTCMonth'](),_0x41beb0[_0x48eb2e(0x211)](),0x17,0x3b,0x3b,0x3e7));}else{const _0xd7d06b=new Date(Date['UTC'](_0x16fadc[_0x48eb2e(0x1c0)](),_0x16fadc[_0x48eb2e(0x313)](),_0x16fadc[_0x48eb2e(0x211)]()-0x1e));_0x86876e=new Date(Date[_0x48eb2e(0x2ff)](_0xd7d06b[_0x48eb2e(0x1c0)](),_0xd7d06b[_0x48eb2e(0x313)](),_0xd7d06b[_0x48eb2e(0x211)](),0x0,0x0,0x0,0x0)),_0x42de55=new Date(Date['UTC'](_0x16fadc[_0x48eb2e(0x1c0)](),_0x16fadc[_0x48eb2e(0x313)](),_0x16fadc['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}}else{switch(_0x266bb4[_0x48eb2e(0x1e7)]()){case _0x48eb2e(0x1e3):_0x86876e=new Date(Date['UTC'](_0x16fadc[_0x48eb2e(0x1c0)](),_0x16fadc['getUTCMonth'](),_0x16fadc['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x42de55=new Date(Date[_0x48eb2e(0x2ff)](_0x16fadc[_0x48eb2e(0x1c0)](),_0x16fadc[_0x48eb2e(0x313)](),_0x16fadc[_0x48eb2e(0x211)](),0x17,0x3b,0x3b,0x3e7));break;case _0x48eb2e(0x196):const _0x421438=new Date(_0x16fadc);_0x421438[_0x48eb2e(0x229)](_0x421438[_0x48eb2e(0x211)]()-0x1),_0x86876e=new Date(Date['UTC'](_0x421438[_0x48eb2e(0x1c0)](),_0x421438[_0x48eb2e(0x313)](),_0x421438['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x42de55=new Date(Date['UTC'](_0x421438[_0x48eb2e(0x1c0)](),_0x421438[_0x48eb2e(0x313)](),_0x421438[_0x48eb2e(0x211)](),0x17,0x3b,0x3b,0x3e7));break;case _0x48eb2e(0x2ef):const _0x4b770b=_0x16fadc[_0x48eb2e(0x1a5)](),_0x38db38=_0x4b770b===0x0?-0x6:0x1-_0x4b770b,_0x56029c=_0x16fadc[_0x48eb2e(0x211)]()+_0x38db38;_0x86876e=new Date(Date[_0x48eb2e(0x2ff)](_0x16fadc[_0x48eb2e(0x1c0)](),_0x16fadc[_0x48eb2e(0x313)](),_0x56029c,0x0,0x0,0x0,0x0)),_0x42de55=new Date(Date[_0x48eb2e(0x2ff)](_0x16fadc[_0x48eb2e(0x1c0)](),_0x16fadc[_0x48eb2e(0x313)](),_0x16fadc['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case _0x48eb2e(0x16c):const _0x3bff5f=new Date(Date[_0x48eb2e(0x2ff)](_0x16fadc['getUTCFullYear'](),_0x16fadc[_0x48eb2e(0x313)](),_0x16fadc[_0x48eb2e(0x211)]()-0x7)),_0x43b6bf=_0x3bff5f[_0x48eb2e(0x1a5)](),_0x572407=_0x43b6bf===0x0?-0x6:0x1-_0x43b6bf,_0x55c5bd=_0x3bff5f[_0x48eb2e(0x211)]()+_0x572407;_0x86876e=new Date(Date[_0x48eb2e(0x2ff)](_0x3bff5f['getUTCFullYear'](),_0x3bff5f[_0x48eb2e(0x313)](),_0x55c5bd,0x0,0x0,0x0,0x0)),_0x42de55=new Date(Date[_0x48eb2e(0x2ff)](_0x3bff5f[_0x48eb2e(0x1c0)](),_0x3bff5f[_0x48eb2e(0x313)](),_0x55c5bd+0x6,0x17,0x3b,0x3b,0x3e7));break;case _0x48eb2e(0x2fb):_0x86876e=new Date(Date[_0x48eb2e(0x2ff)](_0x16fadc['getUTCFullYear'](),_0x16fadc[_0x48eb2e(0x313)](),0x1,0x0,0x0,0x0,0x0)),_0x42de55=new Date(Date['UTC'](_0x16fadc[_0x48eb2e(0x1c0)](),_0x16fadc[_0x48eb2e(0x313)](),_0x16fadc[_0x48eb2e(0x211)](),0x17,0x3b,0x3b,0x3e7));break;case _0x48eb2e(0x1e2):_0x86876e=new Date(Date[_0x48eb2e(0x2ff)](_0x16fadc['getUTCFullYear'](),_0x16fadc[_0x48eb2e(0x313)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x42de55=new Date(Date[_0x48eb2e(0x2ff)](_0x16fadc[_0x48eb2e(0x1c0)](),_0x16fadc[_0x48eb2e(0x313)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case'all_time':_0x86876e=new Date(Date[_0x48eb2e(0x2ff)](0x7e9,0x5,0xe,0x0,0x0,0x0,0x0)),_0x42de55=new Date(Date[_0x48eb2e(0x2ff)](_0x16fadc[_0x48eb2e(0x1c0)](),_0x16fadc[_0x48eb2e(0x313)](),_0x16fadc[_0x48eb2e(0x211)](),0x17,0x3b,0x3b,0x3e7));break;default:_0x86876e=new Date(_0x16fadc[_0x48eb2e(0x30f)]()-0x1e*0x18*0x3c*0x3c*0x3e8);const _0x37919b=new Date(Date[_0x48eb2e(0x2ff)](_0x16fadc[_0x48eb2e(0x1c0)](),_0x16fadc[_0x48eb2e(0x313)](),_0x16fadc[_0x48eb2e(0x211)]()-0x1e));_0x86876e=new Date(Date[_0x48eb2e(0x2ff)](_0x37919b[_0x48eb2e(0x1c0)](),_0x37919b[_0x48eb2e(0x313)](),_0x37919b['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x42de55=new Date(Date[_0x48eb2e(0x2ff)](_0x16fadc['getUTCFullYear'](),_0x16fadc['getUTCMonth'](),_0x16fadc[_0x48eb2e(0x211)](),0x17,0x3b,0x3b,0x3e7));}const _0x37f2a1={'gte':_0x86876e,'lte':_0x42de55};console[_0x48eb2e(0x22a)]('üìä\x20Statistics\x20date\x20range:\x20'+_0x86876e[_0x48eb2e(0x2e3)]()+'\x20to\x20'+_0x42de55[_0x48eb2e(0x2e3)]());const [_0x15661c,_0x4a7be3,_0x497de3,_0x377bad,_0x129051,_0x148613,_0x547c33,_0x545912,_0x19df67]=await Promise['all']([database_1['default']['shop'][_0x48eb2e(0x160)](),database_1[_0x48eb2e(0x1c6)][_0x48eb2e(0x293)][_0x48eb2e(0x160)]({'where':{'status':_0x48eb2e(0x304)}}),database_1['default'][_0x48eb2e(0x27a)]['count']({'where':{'status':_0x48eb2e(0x225),'createdAt':_0x37f2a1,'gateway':{'not':'test_gateway'}}}),database_1[_0x48eb2e(0x1c6)][_0x48eb2e(0x27a)][_0x48eb2e(0x160)]({'where':{'status':'CHARGEBACK','createdAt':_0x37f2a1,'gateway':{'not':_0x48eb2e(0x258)}}}),database_1[_0x48eb2e(0x1c6)][_0x48eb2e(0x27a)][_0x48eb2e(0x160)]({'where':{'status':_0x48eb2e(0x1d9),'createdAt':_0x37f2a1,'gateway':{'not':_0x48eb2e(0x258)}}}),database_1[_0x48eb2e(0x1c6)][_0x48eb2e(0x27a)]['findMany']({'where':{'status':'PAID','createdAt':_0x37f2a1,'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1['default'][_0x48eb2e(0x27a)][_0x48eb2e(0x28e)]({'where':{'gateway':{'not':'test_gateway'}},'take':0xa,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x48eb2e(0x1c6)][_0x48eb2e(0x27a)][_0x48eb2e(0x28e)]({'where':{'createdAt':_0x37f2a1,'gateway':{'not':_0x48eb2e(0x258)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1['default']['payment'][_0x48eb2e(0x28e)]({'where':{'status':_0x48eb2e(0x225),'gateway':{'not':'test_gateway'}},'select':{'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![]}})]);console[_0x48eb2e(0x22a)](_0x48eb2e(0x21d)+_0x497de3);let _0x26c1f0=0x0,_0x1d164e=0x0;for(const _0x3fcd28 of _0x148613){const _0x818786=_0x3fcd28[_0x48eb2e(0x212)]||0x0;_0x26c1f0+=_0x818786;if(_0x3fcd28[_0x48eb2e(0x213)]&&_0x3fcd28[_0x48eb2e(0x212)]){const _0xcaecd2=_0x3fcd28['amountUSDT']-_0x3fcd28[_0x48eb2e(0x213)];_0x1d164e+=_0xcaecd2;}}let _0xd7f679=0x0;for(const _0x1028fc of _0x19df67){if(_0x1028fc[_0x48eb2e(0x213)]&&_0x1028fc[_0x48eb2e(0x212)]){const _0x272b6d=_0x1028fc[_0x48eb2e(0x212)]-_0x1028fc['amountAfterGatewayCommissionUSDT'];_0xd7f679+=_0x272b6d;}}const _0x1c2411=_0x497de3>0x0?_0x26c1f0/_0x497de3:0x0,_0x379932=this[_0x48eb2e(0x1ea)](_0x545912,_0x86876e,_0x42de55),_0x5c737d=await database_1[_0x48eb2e(0x1c6)]['payment']['count']({'where':{'createdAt':_0x37f2a1,'gateway':{'not':_0x48eb2e(0x258)},'status':{'notIn':['PENDING','EXPIRED']}}}),_0x4148b1=_0x5c737d>0x0?_0x497de3/_0x5c737d*0x64:0x0;return{'totalShops':_0x15661c,'activeShops':_0x4a7be3,'totalPayments':_0x5c737d,'successfulPayments':_0x497de3,'totalAttempts':_0x5c737d,'chargebacks':_0x377bad,'refunds':_0x129051,'totalRevenue':Math[_0x48eb2e(0x319)](_0x26c1f0*0x64)/0x64,'trapayEarnings':Math[_0x48eb2e(0x319)](_0x1d164e*0x64)/0x64,'trapayEarningsAllTime':Math[_0x48eb2e(0x319)](_0xd7f679*0x64)/0x64,'averagePaymentAmount':Math[_0x48eb2e(0x319)](_0x1c2411*0x64)/0x64,'conversionRate':Math[_0x48eb2e(0x319)](_0x4148b1*0x64)/0x64,'dailyRevenue':_0x379932['dailyRevenue'],'dailyPayments':_0x379932['dailyPayments'],'recentPayments':_0x547c33[_0x48eb2e(0x1af)](_0x3a8a26=>({'id':_0x3a8a26['id'],'amount':_0x3a8a26[_0x48eb2e(0x165)],'currency':_0x3a8a26[_0x48eb2e(0x1c3)],'status':_0x3a8a26[_0x48eb2e(0x29b)],'gateway':_0x3a8a26['gateway'],'shop':_0x3a8a26[_0x48eb2e(0x293)],'createdAt':_0x3a8a26[_0x48eb2e(0x1c2)]}))};}}async[a53_0x3421aa(0x220)](_0x497866){const _0x2a5634=a53_0x3421aa;console[_0x2a5634(0x22a)](_0x2a5634(0x2d7),_0x497866);let _0x25fdf4,_0x49bb33=new Date();if(_0x497866[_0x2a5634(0x2cd)]===_0x2a5634(0x308)&&_0x497866[_0x2a5634(0x2f3)]&&_0x497866[_0x2a5634(0x276)]){const _0x24e206=new Date(_0x497866['dateFrom']),_0x7d73ad=new Date(_0x497866['dateTo']);_0x25fdf4=new Date(Date[_0x2a5634(0x2ff)](_0x24e206[_0x2a5634(0x1c0)](),_0x24e206[_0x2a5634(0x313)](),_0x24e206[_0x2a5634(0x211)](),0x0,0x0,0x0,0x0)),_0x49bb33=new Date(Date['UTC'](_0x7d73ad[_0x2a5634(0x1c0)](),_0x7d73ad[_0x2a5634(0x313)](),_0x7d73ad['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}else{const _0x5aa3f4=new Date();switch(_0x497866['period']){case'week':_0x25fdf4=new Date(_0x5aa3f4['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8),_0x25fdf4['setHours'](0x0,0x0,0x0,0x0),_0x49bb33[_0x2a5634(0x27b)](0x17,0x3b,0x3b,0x3e7);break;case _0x2a5634(0x316):_0x25fdf4=new Date(Date[_0x2a5634(0x2ff)](_0x5aa3f4['getUTCFullYear'](),_0x5aa3f4[_0x2a5634(0x313)](),0x1,0x0,0x0,0x0,0x0)),_0x49bb33=new Date(Date[_0x2a5634(0x2ff)](_0x5aa3f4[_0x2a5634(0x1c0)](),_0x5aa3f4[_0x2a5634(0x313)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x2a5634(0x19b):_0x25fdf4=new Date(Date[_0x2a5634(0x2ff)](_0x5aa3f4[_0x2a5634(0x1c0)](),_0x5aa3f4[_0x2a5634(0x313)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x49bb33=new Date(Date[_0x2a5634(0x2ff)](_0x5aa3f4['getUTCFullYear'](),_0x5aa3f4['getUTCMonth'](),0x0,0x17,0x3b,0x3b,0x3e7));break;case'year':_0x25fdf4=new Date(_0x5aa3f4['getTime']()-0x16d*0x18*0x3c*0x3c*0x3e8),_0x25fdf4[_0x2a5634(0x27b)](0x0,0x0,0x0,0x0),_0x49bb33[_0x2a5634(0x27b)](0x17,0x3b,0x3b,0x3e7);break;case _0x2a5634(0x1cd):default:_0x25fdf4=new Date('2020-01-01'),_0x25fdf4[_0x2a5634(0x27b)](0x0,0x0,0x0,0x0),_0x49bb33[_0x2a5634(0x27b)](0x17,0x3b,0x3b,0x3e7);break;}}console['log'](_0x2a5634(0x1ba)+_0x25fdf4[_0x2a5634(0x2e3)]()+_0x2a5634(0x1a9)+_0x49bb33['toISOString']());const _0x41a545={'status':_0x2a5634(0x225),'gateway':{'not':'test_gateway'},'createdAt':{'gte':_0x25fdf4,'lte':_0x49bb33}};_0x497866['shopId']&&(_0x41a545[_0x2a5634(0x1a8)]=_0x497866[_0x2a5634(0x1a8)]);const _0x5ad342=await database_1[_0x2a5634(0x1c6)][_0x2a5634(0x27a)][_0x2a5634(0x28e)]({'where':_0x41a545,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console['log'](_0x2a5634(0x2a8)+_0x5ad342['length']+_0x2a5634(0x1f8));const _0x569ae6={'gateway':{'not':_0x2a5634(0x258)},'status':{'notIn':['PENDING','EXPIRED']},'createdAt':{'gte':_0x25fdf4,'lte':_0x49bb33}};_0x497866[_0x2a5634(0x1a8)]&&(_0x569ae6[_0x2a5634(0x1a8)]=_0x497866[_0x2a5634(0x1a8)]);const _0x3c4916=await database_1[_0x2a5634(0x1c6)][_0x2a5634(0x27a)]['count']({'where':_0x569ae6}),_0x5af767={..._0x569ae6,'status':_0x2a5634(0x203)},_0x3b9b9a={..._0x569ae6,'status':_0x2a5634(0x1d9)},[_0x373731,_0x57d20e]=await Promise[_0x2a5634(0x1cd)]([database_1[_0x2a5634(0x1c6)][_0x2a5634(0x27a)][_0x2a5634(0x160)]({'where':_0x5af767}),database_1[_0x2a5634(0x1c6)]['payment'][_0x2a5634(0x160)]({'where':_0x3b9b9a})]);console[_0x2a5634(0x22a)](_0x2a5634(0x312)+_0x3c4916+',\x20successful:\x20'+_0x5ad342[_0x2a5634(0x2ea)]+_0x2a5634(0x1b7)+_0x373731+_0x2a5634(0x18b)+_0x57d20e);let _0x234195=0x0,_0x12d642=0x0,_0x56acb2=0x0;const _0x530188={},_0x5d92ba={},_0x2b6197={},_0x2bb7e4=new Date(_0x25fdf4);while(_0x2bb7e4<=_0x49bb33){const _0x52d48c=_0x2bb7e4[_0x2a5634(0x2e3)]()['split']('T')[0x0];_0x2b6197[_0x52d48c]={'date':_0x52d48c,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0},_0x2bb7e4[_0x2a5634(0x229)](_0x2bb7e4['getUTCDate']()+0x1);}for(const _0x5b73b1 of _0x5ad342){try{const _0x1f1d6f=_0x5b73b1[_0x2a5634(0x212)]||0x0;if(_0x1f1d6f<=0x0){console[_0x2a5634(0x2d8)]('‚ö†Ô∏è\x20Payment\x20'+_0x5b73b1['id']+_0x2a5634(0x26c));continue;}let _0x17c5d1,_0x4cd29b;if(_0x5b73b1[_0x2a5634(0x213)]!==null&&_0x5b73b1['amountAfterGatewayCommissionUSDT']!==undefined)_0x17c5d1=_0x5b73b1[_0x2a5634(0x213)],_0x4cd29b=_0x1f1d6f-_0x17c5d1,console[_0x2a5634(0x22a)]('üìä\x20Using\x20saved\x20values\x20for\x20payment\x20'+_0x5b73b1['id']+':\x20'+_0x1f1d6f[_0x2a5634(0x25f)](0x6)+_0x2a5634(0x2fc)+_0x17c5d1['toFixed'](0x6)+_0x2a5634(0x1e9));else{let _0x11903a={};if(_0x5b73b1[_0x2a5634(0x293)][_0x2a5634(0x206)])try{_0x11903a=JSON['parse'](_0x5b73b1[_0x2a5634(0x293)][_0x2a5634(0x206)]);}catch(_0x311608){console[_0x2a5634(0x305)](_0x2a5634(0x2e7)+_0x5b73b1[_0x2a5634(0x1a8)]+':',_0x311608);}let _0x2d8d30=0x2d;for(const [_0xd022f7,_0x1eb9e1]of Object[_0x2a5634(0x2cc)](_0x11903a)){if(_0xd022f7[_0x2a5634(0x1e7)]()===_0x5b73b1[_0x2a5634(0x22c)][_0x2a5634(0x1e7)]()){_0x2d8d30=_0x1eb9e1[_0x2a5634(0x163)]||0x2d;break;}}_0x4cd29b=_0x1f1d6f*(_0x2d8d30/0x64),_0x17c5d1=_0x1f1d6f-_0x4cd29b,console[_0x2a5634(0x22a)](_0x2a5634(0x1dc)+_0x5b73b1['id']+':\x20'+_0x2d8d30+'%\x20from\x20'+_0x1f1d6f[_0x2a5634(0x25f)](0x6)+_0x2a5634(0x1e9));}_0x234195+=_0x1f1d6f,_0x12d642+=_0x17c5d1,_0x56acb2+=_0x4cd29b;let _0x257342;_0x5b73b1[_0x2a5634(0x188)]!==null&&_0x5b73b1[_0x2a5634(0x188)]!==undefined?(_0x257342=_0x5b73b1[_0x2a5634(0x188)],console[_0x2a5634(0x22a)](_0x2a5634(0x26a)+_0x5b73b1['id']+':\x20'+_0x257342+'%')):(_0x257342=_0x1f1d6f>0x0?_0x4cd29b/_0x1f1d6f*0x64:0x0,console[_0x2a5634(0x22a)](_0x2a5634(0x183)+_0x5b73b1['id']+':\x20'+_0x257342[_0x2a5634(0x25f)](0x2)+'%'));!_0x530188[_0x5b73b1['gateway']]&&(_0x530188[_0x5b73b1['gateway']]={'gateway':_0x5b73b1[_0x2a5634(0x22c)],'gatewayDisplayName':this[_0x2a5634(0x253)](_0x5b73b1[_0x2a5634(0x22c)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x530188[_0x5b73b1['gateway']][_0x2a5634(0x2b7)]++,_0x530188[_0x5b73b1['gateway']][_0x2a5634(0x26d)]+=_0x1f1d6f,_0x530188[_0x5b73b1[_0x2a5634(0x22c)]][_0x2a5634(0x241)]+=_0x4cd29b,_0x530188[_0x5b73b1[_0x2a5634(0x22c)]][_0x2a5634(0x2bc)]+=_0x17c5d1,_0x530188[_0x5b73b1['gateway']][_0x2a5634(0x1a2)]+=_0x257342;!_0x497866['shopId']&&(!_0x5d92ba[_0x5b73b1[_0x2a5634(0x1a8)]]&&(_0x5d92ba[_0x5b73b1[_0x2a5634(0x1a8)]]={'shopId':_0x5b73b1[_0x2a5634(0x1a8)],'shopName':_0x5b73b1['shop']['name'],'shopUsername':_0x5b73b1[_0x2a5634(0x293)][_0x2a5634(0x30c)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x5d92ba[_0x5b73b1[_0x2a5634(0x1a8)]][_0x2a5634(0x2b7)]++,_0x5d92ba[_0x5b73b1['shopId']]['turnoverUSDT']+=_0x1f1d6f,_0x5d92ba[_0x5b73b1[_0x2a5634(0x1a8)]][_0x2a5634(0x241)]+=_0x4cd29b,_0x5d92ba[_0x5b73b1[_0x2a5634(0x1a8)]]['merchantEarningsUSDT']+=_0x17c5d1);const _0x3db626=_0x5b73b1[_0x2a5634(0x2e0)]['toISOString']()[_0x2a5634(0x2c9)]('T')[0x0];_0x2b6197[_0x3db626]&&(_0x2b6197[_0x3db626]['turnover']+=_0x1f1d6f,_0x2b6197[_0x3db626][_0x2a5634(0x174)]+=_0x17c5d1,_0x2b6197[_0x3db626][_0x2a5634(0x322)]+=_0x4cd29b,_0x2b6197[_0x3db626][_0x2a5634(0x2b7)]++);}catch(_0x112843){console['error'](_0x2a5634(0x198)+_0x5b73b1['id']+':',_0x112843);}}Object[_0x2a5634(0x243)](_0x530188)[_0x2a5634(0x1ab)](_0x4aa340=>{const _0x4edf27=_0x2a5634;_0x4aa340[_0x4edf27(0x261)]=_0x4aa340[_0x4edf27(0x2b7)]>0x0?_0x4aa340[_0x4edf27(0x1a2)]/_0x4aa340[_0x4edf27(0x2b7)]:0x0,delete _0x4aa340[_0x4edf27(0x1a2)];}),Object[_0x2a5634(0x243)](_0x5d92ba)[_0x2a5634(0x1ab)](_0x310337=>{const _0x4e4aa5=_0x2a5634;_0x310337['averageCheckUSDT']=_0x310337[_0x4e4aa5(0x2b7)]>0x0?_0x310337[_0x4e4aa5(0x26d)]/_0x310337[_0x4e4aa5(0x2b7)]:0x0;});let _0x19891c=0x0,_0x5c2ba9=0x0;if(_0x497866[_0x2a5634(0x1a8)]){const _0x14c63d=await database_1['default'][_0x2a5634(0x1f7)]['findMany']({'where':{'shopId':_0x497866['shopId'],'status':_0x2a5634(0x19d),'createdAt':{'gte':_0x25fdf4,'lte':_0x49bb33}},'select':{'amount':!![]}});_0x19891c=_0x14c63d[_0x2a5634(0x1b1)]((_0x524e5c,_0x58192c)=>_0x524e5c+_0x58192c[_0x2a5634(0x165)],0x0);const _0x3762cd=await database_1[_0x2a5634(0x1c6)]['payout'][_0x2a5634(0x28e)]({'where':{'shopId':_0x497866['shopId'],'status':'PENDING','createdAt':{'gte':_0x25fdf4,'lte':_0x49bb33}},'select':{'amount':!![]}});_0x5c2ba9=_0x3762cd[_0x2a5634(0x1b1)]((_0x44c62e,_0x2d3d57)=>_0x44c62e+_0x2d3d57['amount'],0x0);}const _0x4aae44=_0x3c4916,_0x43c9a4=_0x5ad342[_0x2a5634(0x2ea)],_0x5539f1=_0x43c9a4>0x0?_0x234195/_0x43c9a4:0x0,_0x1df536=_0x4aae44>0x0?Math[_0x2a5634(0x319)](_0x43c9a4/_0x4aae44*0x2710)/0x64:0x0,_0x150bec=Math[_0x2a5634(0x19f)]((_0x49bb33['getTime']()-_0x25fdf4['getTime']())/(0x3e8*0x3c*0x3c*0x18)),_0x29b4c0={'totalTurnover':Math['round'](_0x234195*0x64)/0x64,'merchantEarnings':Math[_0x2a5634(0x319)](_0x12d642*0x64)/0x64,'gatewayEarnings':Math[_0x2a5634(0x319)](_0x56acb2*0x64)/0x64,'totalPaidOut':Math[_0x2a5634(0x319)](_0x19891c*0x64)/0x64,'pendingPayout':Math[_0x2a5634(0x319)](_0x5c2ba9*0x64)/0x64,'averageCheck':Math[_0x2a5634(0x319)](_0x5539f1*0x64)/0x64,'totalPayments':_0x4aae44,'successfulPayments':_0x43c9a4,'conversionRate':_0x1df536,'chargebacks':_0x373731,'refunds':_0x57d20e,'gatewayBreakdown':Object[_0x2a5634(0x243)](_0x530188)[_0x2a5634(0x1af)](_0x2c2513=>({..._0x2c2513,'turnoverUSDT':Math[_0x2a5634(0x319)](_0x2c2513['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x2a5634(0x319)](_0x2c2513[_0x2a5634(0x241)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x2a5634(0x319)](_0x2c2513[_0x2a5634(0x2bc)]*0x64)/0x64,'averageCommissionRate':Math[_0x2a5634(0x319)](_0x2c2513[_0x2a5634(0x261)]*0x64)/0x64})),'merchantBreakdown':_0x497866[_0x2a5634(0x1a8)]?undefined:Object[_0x2a5634(0x243)](_0x5d92ba)[_0x2a5634(0x1af)](_0x34dc06=>({..._0x34dc06,'turnoverUSDT':Math[_0x2a5634(0x319)](_0x34dc06['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x2a5634(0x319)](_0x34dc06['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x2a5634(0x319)](_0x34dc06['merchantEarningsUSDT']*0x64)/0x64,'paidOutUSDT':Math[_0x2a5634(0x319)](_0x34dc06[_0x2a5634(0x315)]*0x64)/0x64,'averageCheckUSDT':Math[_0x2a5634(0x319)](_0x34dc06[_0x2a5634(0x2bf)]*0x64)/0x64})),'dailyData':Object[_0x2a5634(0x243)](_0x2b6197)['map'](_0xc2794a=>({..._0xc2794a,'turnover':Math[_0x2a5634(0x319)](_0xc2794a[_0x2a5634(0x298)]*0x64)/0x64,'merchantEarnings':Math[_0x2a5634(0x319)](_0xc2794a[_0x2a5634(0x174)]*0x64)/0x64,'gatewayEarnings':Math[_0x2a5634(0x319)](_0xc2794a[_0x2a5634(0x322)]*0x64)/0x64}))[_0x2a5634(0x1fa)]((_0x530001,_0x227dec)=>_0x530001[_0x2a5634(0x2ba)][_0x2a5634(0x219)](_0x227dec[_0x2a5634(0x2ba)])),'periodInfo':{'from':_0x25fdf4,'to':_0x49bb33,'periodType':_0x497866[_0x2a5634(0x2cd)]||_0x2a5634(0x308),'daysCount':_0x150bec}};return console['log'](_0x2a5634(0x161)),console[_0x2a5634(0x22a)](_0x2a5634(0x1c4)+_0x29b4c0[_0x2a5634(0x27c)]+_0x2a5634(0x1e9)),console[_0x2a5634(0x22a)]('\x20\x20\x20üë§\x20Merchant\x20earnings:\x20'+_0x29b4c0[_0x2a5634(0x174)]+'\x20USDT'),console['log'](_0x2a5634(0x2a2)+_0x29b4c0[_0x2a5634(0x322)]+_0x2a5634(0x1e9)),console[_0x2a5634(0x22a)]('\x20\x20\x20ÔøΩ\x20Total\x20paid\x20out:\x20'+_0x29b4c0[_0x2a5634(0x2d2)]+_0x2a5634(0x1e9)),console[_0x2a5634(0x22a)](_0x2a5634(0x26e)+_0x29b4c0[_0x2a5634(0x1e8)]+_0x2a5634(0x1e9)),console['log'](_0x2a5634(0x210)+_0x29b4c0[_0x2a5634(0x24c)]),_0x29b4c0;}async[a53_0x3421aa(0x2d5)](_0x518b3e){const _0x324199=a53_0x3421aa;console[_0x324199(0x22a)](_0x324199(0x164),{'hasPayoutHistory':_0x518b3e});let _0x4efcb5={};_0x518b3e&&(_0x4efcb5['payouts']={'some':{}});const _0x1e0777=await database_1[_0x324199(0x1c6)][_0x324199(0x293)]['findMany']({'where':_0x4efcb5,'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x324199(0x271)}});return console[_0x324199(0x22a)](_0x324199(0x21a)+_0x1e0777['length']+_0x324199(0x270)+(_0x518b3e?_0x324199(0x2f1):'')),_0x1e0777[_0x324199(0x1af)](_0x287bcb=>({'id':_0x287bcb['id'],'username':_0x287bcb[_0x324199(0x30c)],'name':_0x287bcb[_0x324199(0x2b3)]}));}[a53_0x3421aa(0x253)](_0x5c7896){const _0x3ab18a=a53_0x3421aa,_0x37ef54={'test_gateway':_0x3ab18a(0x25d),'plisio':'Plisio','rapyd':_0x3ab18a(0x2fa),'noda':'Noda','cointopay':_0x3ab18a(0x1cc),'cointopay2':'CoinToPay2','klyme_eu':_0x3ab18a(0x25a),'klyme_gb':_0x3ab18a(0x209),'klyme_de':_0x3ab18a(0x307),'mastercard':_0x3ab18a(0x1a7),'visa/mastercard':_0x3ab18a(0x23f),'amer':_0x3ab18a(0x231),'myxspend':'MyXSpend','ampay':_0x3ab18a(0x16e),'ampay_try':_0x3ab18a(0x27d),'sepa':_0x3ab18a(0x1da),'interac':_0x3ab18a(0x181),'onramp':'OnRamp','squirrelpay':'SquirrelPay','maxpara':_0x3ab18a(0x176),'instaxchange':_0x3ab18a(0x1c9),'oxapay':_0x3ab18a(0x192)};return _0x37ef54[_0x5c7896]||_0x5c7896;}['getGatewayInternalName'](_0x38d62b){const _0x74a760=a53_0x3421aa,_0x11dde8={'Test\x20Gateway':_0x74a760(0x258),'Plisio':_0x74a760(0x2dc),'Rapyd':'rapyd','Noda':_0x74a760(0x228),'CoinToPay':'cointopay','CoinToPay2':_0x74a760(0x291),'KLYME\x20EU':_0x74a760(0x285),'KLYME\x20GB':_0x74a760(0x1b0),'KLYME\x20DE':_0x74a760(0x20e),'MasterCard':'mastercard'};return _0x11dde8[_0x38d62b]||_0x38d62b[_0x74a760(0x1e7)]();}async[a53_0x3421aa(0x29e)](_0x3c4baa){const _0x3ee657=a53_0x3421aa,{page:_0xd9ffef,limit:_0x208f00,minAmount:_0x11d309,search:_0x19e9bc}=_0x3c4baa;console[_0x3ee657(0x22a)](_0x3ee657(0x1ca),_0x3c4baa);let _0x1631b5={};_0x19e9bc&&(_0x1631b5[_0x3ee657(0x2b3)]={'contains':_0x19e9bc,'mode':_0x3ee657(0x26b)});const _0x5ae86e=await database_1[_0x3ee657(0x1c6)][_0x3ee657(0x293)][_0x3ee657(0x28e)]({'where':_0x1631b5,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),_0x78af13=_0x5ae86e[_0x3ee657(0x189)](_0x144625=>{const _0x20ca4e=_0x3ee657,_0x3627cd=Math[_0x20ca4e(0x22f)](_0x144625['balance']*0x64)/0x64;if(_0x11d309&&_0x3627cd<_0x11d309)return![];return _0x3627cd!==0x0;});_0x78af13[_0x3ee657(0x1fa)]((_0x45c2b4,_0x5e9dfb)=>_0x5e9dfb[_0x3ee657(0x25c)]-_0x45c2b4[_0x3ee657(0x25c)]);const _0x477ef6=_0x78af13['length'],_0x1be89f=(_0xd9ffef-0x1)*_0x208f00,_0xaff503=_0x78af13[_0x3ee657(0x224)](_0x1be89f,_0x1be89f+_0x208f00);console['log'](_0x3ee657(0x2a8)+_0xaff503[_0x3ee657(0x2ea)]+_0x3ee657(0x28b));const _0x40d797=await Promise['all'](_0xaff503[_0x3ee657(0x1af)](async _0x270a60=>{const _0x4b0c38=_0x3ee657,[_0x1c43bd,_0x4ec8be,_0x5ba96f]=await Promise[_0x4b0c38(0x1cd)]([database_1[_0x4b0c38(0x1c6)][_0x4b0c38(0x27a)][_0x4b0c38(0x160)]({'where':{'shopId':_0x270a60['id'],'status':_0x4b0c38(0x225),'gateway':{'not':_0x4b0c38(0x258)}}}),database_1['default'][_0x4b0c38(0x27a)][_0x4b0c38(0x1bb)]({'where':{'shopId':_0x270a60['id'],'status':_0x4b0c38(0x225),'gateway':{'not':_0x4b0c38(0x258)}},'orderBy':{'paidAt':_0x4b0c38(0x271)},'select':{'paidAt':!![]}}),database_1['default']['payment']['groupBy']({'by':['gateway'],'where':{'shopId':_0x270a60['id'],'status':_0x4b0c38(0x225),'gateway':{'not':'test_gateway'}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x3520c6=new Date(),_0x52d2d8=new Date(_0x3520c6[_0x4b0c38(0x297)](),_0x3520c6[_0x4b0c38(0x19c)](),0x1),_0x24ff8a=new Date(_0x3520c6[_0x4b0c38(0x297)](),_0x3520c6['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x4bea0a,_0x1e9074]=await Promise[_0x4b0c38(0x1cd)]([database_1[_0x4b0c38(0x1c6)][_0x4b0c38(0x1f7)][_0x4b0c38(0x186)]({'_sum':{'amount':!![]},'where':{'shopId':_0x270a60['id'],'status':_0x4b0c38(0x19d)}}),database_1[_0x4b0c38(0x1c6)][_0x4b0c38(0x1f7)][_0x4b0c38(0x186)]({'_sum':{'amount':!![]},'where':{'shopId':_0x270a60['id'],'status':_0x4b0c38(0x19d),'createdAt':{'gte':_0x52d2d8,'lte':_0x24ff8a}}})]),_0x1835b7=_0x4bea0a[_0x4b0c38(0x1a0)][_0x4b0c38(0x165)]||0x0,_0x1420fd=_0x1e9074[_0x4b0c38(0x1a0)][_0x4b0c38(0x165)]||0x0,_0xe2c373=await Promise['all'](_0x5ba96f[_0x4b0c38(0x1af)](async _0x7e1e58=>{const _0x4ff605=_0x4b0c38,_0x3e420b=await database_1[_0x4ff605(0x1c6)][_0x4ff605(0x27a)][_0x4ff605(0x28e)]({'where':{'shopId':_0x270a60['id'],'status':_0x4ff605(0x225),'gateway':_0x7e1e58['gateway']},'select':{'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![]}});let _0xfb13a9=0x2d;if(_0x270a60[_0x4ff605(0x206)])try{const _0x17877e=JSON[_0x4ff605(0x1d5)](_0x270a60[_0x4ff605(0x206)]);for(const [_0x23a889,_0xf171b5]of Object[_0x4ff605(0x2cc)](_0x17877e)){if(_0x23a889[_0x4ff605(0x1e7)]()===_0x7e1e58['gateway'][_0x4ff605(0x1e7)]()){_0xfb13a9=_0xf171b5[_0x4ff605(0x163)]||0xa,console[_0x4ff605(0x22a)](_0x4ff605(0x21f)+_0x7e1e58[_0x4ff605(0x22c)]+'\x20for\x20shop\x20'+_0x270a60['id']+_0x4ff605(0x1f5)+_0xfb13a9+'%');break;}}}catch(_0x4e956d){console['error'](_0x4ff605(0x2e7)+_0x270a60['id']+':',_0x4e956d);}const _0x43f2ea=_0x7e1e58[_0x4ff605(0x1a0)]?.[_0x4ff605(0x212)]||0x0;let _0x5c8ae2=0x0;for(const _0x70d7ca of _0x3e420b){if(_0x70d7ca[_0x4ff605(0x213)]!==null&&_0x70d7ca[_0x4ff605(0x213)]!==undefined)_0x5c8ae2+=_0x70d7ca[_0x4ff605(0x213)];else{const _0x2f5a01=_0x70d7ca['amountUSDT']||0x0;_0x5c8ae2+=_0x2f5a01*(0x1-_0xfb13a9/0x64);}}return{'gateway':_0x7e1e58[_0x4ff605(0x22c)],'count':_0x7e1e58[_0x4ff605(0x2c7)]?.['id']||0x0,'amountUSDT':Math[_0x4ff605(0x319)](_0x43f2ea*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x4ff605(0x319)](_0x5c8ae2*0x64)/0x64,'commission':_0xfb13a9};})),_0x428110=_0xe2c373[_0x4b0c38(0x1b1)]((_0x12d856,_0x232c50)=>_0x12d856+_0x232c50['amountUSDT'],0x0),_0x348f07=_0xe2c373['reduce']((_0x842b5c,_0x152e00)=>_0x842b5c+_0x152e00['amountAfterCommissionUSDT'],0x0),_0x4d9f6b=_0x270a60[_0x4b0c38(0x25c)];return console['log'](_0x4b0c38(0x2b1)+_0x270a60[_0x4b0c38(0x30c)]+':'),console[_0x4b0c38(0x22a)]('\x20\x20\x20ÔøΩ\x20Total\x20payments\x20turnover:\x20'+_0x428110[_0x4b0c38(0x25f)](0x2)+_0x4b0c38(0x236)),console[_0x4b0c38(0x22a)]('\x20\x20\x20üîç\x20Calculated\x20after\x20commission:\x20'+_0x348f07[_0x4b0c38(0x25f)](0x2)+_0x4b0c38(0x286)),console[_0x4b0c38(0x22a)]('\x20\x20\x20‚úÖ\x20Actual\x20available\x20balance:\x20'+_0x4d9f6b['toFixed'](0x2)+_0x4b0c38(0x177)),console[_0x4b0c38(0x22a)]('\x20\x20\x20üí∏\x20Total\x20payouts:\x20'+_0x1835b7['toFixed'](0x2)+_0x4b0c38(0x193)),console['log'](_0x4b0c38(0x25b)+(_0x348f07-_0x1835b7-_0x4d9f6b)[_0x4b0c38(0x25f)](0x2)+'\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)'),{'id':_0x270a60['id'],'fullName':_0x270a60['name'],'username':_0x270a60[_0x4b0c38(0x30c)],'telegramId':_0x270a60[_0x4b0c38(0x191)],'merchantUrl':_0x270a60[_0x4b0c38(0x216)],'wallets':{'usdtPolygonWallet':_0x270a60[_0x4b0c38(0x1e0)],'usdtTrcWallet':_0x270a60[_0x4b0c38(0x1f0)],'usdtErcWallet':_0x270a60[_0x4b0c38(0x185)],'usdcPolygonWallet':_0x270a60[_0x4b0c38(0x1b8)],'usdcErcWallet':_0x270a60['usdcErcWallet']},'totalAmountUSDT':Math['round'](_0x428110*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x4b0c38(0x319)](_0x348f07*0x64)/0x64,'currentBalance':Math[_0x4b0c38(0x22f)](_0x4d9f6b*0x64)/0x64,'totalPayout':Math['round'](_0x1835b7*0x64)/0x64,'thisMonth':Math[_0x4b0c38(0x319)](_0x1420fd*0x64)/0x64,'paymentsCount':_0x1c43bd,'oldestPaymentDate':_0x4ec8be?.[_0x4b0c38(0x2e0)]||_0x270a60['createdAt'],'gatewayBreakdown':_0xe2c373};})),_0x6c0c13=_0x40d797[_0x3ee657(0x1b1)]((_0x16c0d0,_0xe08978)=>_0x16c0d0+_0xe08978[_0x3ee657(0x2c3)],0x0),_0x4f72e7=_0x40d797[_0x3ee657(0x1b1)]((_0x2ac8bb,_0x4a9ee4)=>_0x2ac8bb+_0x4a9ee4[_0x3ee657(0x309)],0x0),_0x19e4df=_0x40d797[_0x3ee657(0x1b1)]((_0x4acac4,_0x336161)=>_0x4acac4+_0x336161[_0x3ee657(0x31d)],0x0),_0xc072c2=_0x40d797[_0x3ee657(0x1b1)]((_0x38bb9d,_0x9e5f52)=>_0x38bb9d+_0x9e5f52[_0x3ee657(0x2ac)],0x0);return console[_0x3ee657(0x22a)]('üìä\x20Merchants\x20with\x20rounded\x20balance\x20!=\x200.00:\x20'+_0x477ef6+_0x3ee657(0x221)),console[_0x3ee657(0x22a)]('\x20\x20\x20üí∞\x20Total\x20payments\x20turnover:\x20'+Math[_0x3ee657(0x319)](_0x6c0c13*0x64)/0x64+_0x3ee657(0x236)),console['log'](_0x3ee657(0x18d)+Math['round'](_0x4f72e7*0x64)/0x64+_0x3ee657(0x2eb)),console[_0x3ee657(0x22a)]('\x20\x20\x20üí∏\x20Total\x20payouts\x20(all\x20time):\x20'+Math[_0x3ee657(0x319)](_0x19e4df*0x64)/0x64+_0x3ee657(0x1e9)),console[_0x3ee657(0x22a)](_0x3ee657(0x2f0)+Math[_0x3ee657(0x319)](_0xc072c2*0x64)/0x64+_0x3ee657(0x1e9)),{'merchants':_0x40d797,'pagination':{'page':_0xd9ffef,'limit':_0x208f00,'total':_0x477ef6,'totalPages':Math['ceil'](_0x477ef6/_0x208f00)},'summary':{'totalMerchants':_0x477ef6,'totalAmountUSDT':Math[_0x3ee657(0x319)](_0x6c0c13*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x3ee657(0x319)](_0x4f72e7*0x64)/0x64,'totalPayout':Math['round'](_0x19e4df*0x64)/0x64,'thisMonth':Math[_0x3ee657(0x319)](_0xc072c2*0x64)/0x64}};}async['createPayout'](_0x520bcd){const _0x859a34=a53_0x3421aa,{shopId:_0x40eddb,amount:_0x2daa3b,network:_0x262b1b,wallet:_0x5ae954,notes:_0x312946,txid:_0x13c6fe,periodFrom:_0x235423,periodTo:_0x3d42e4}=_0x520bcd,_0x5d0a93=await database_1['default'][_0x859a34(0x275)](async _0xecd832=>{const _0x5acf67=_0x859a34,_0x1ed228=await _0xecd832[_0x5acf67(0x293)][_0x5acf67(0x184)]({'where':{'id':_0x40eddb},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x1ed228)throw new Error('Shop\x20not\x20found');console['log'](_0x5acf67(0x2c0)+_0x1ed228[_0x5acf67(0x30c)]+':'),console[_0x5acf67(0x22a)](_0x5acf67(0x2df)+_0x1ed228[_0x5acf67(0x25c)]['toFixed'](0x6)+_0x5acf67(0x1e9)),console['log']('\x20\x20\x20Payout\x20amount:\x20'+_0x2daa3b[_0x5acf67(0x25f)](0x6)+_0x5acf67(0x1e9)),console[_0x5acf67(0x22a)](_0x5acf67(0x16a)+_0x1ed228['totalPaidOut'][_0x5acf67(0x25f)](0x6)+_0x5acf67(0x1e9));if(_0x13c6fe)console[_0x5acf67(0x22a)](_0x5acf67(0x1c8)+_0x13c6fe);const _0x3264fa=0.000001,_0x9b2530=Number(_0x1ed228[_0x5acf67(0x25c)]),_0x33aa36=Number(_0x2daa3b);console['log'](_0x5acf67(0x255)),console['log'](_0x5acf67(0x296)+_0x1ed228[_0x5acf67(0x25c)]),console[_0x5acf67(0x22a)](_0x5acf67(0x234)+_0x9b2530),console[_0x5acf67(0x22a)](_0x5acf67(0x27f)+_0x33aa36),console[_0x5acf67(0x22a)]('\x20\x20\x20Difference:\x20'+(_0x9b2530-_0x33aa36)),console[_0x5acf67(0x22a)]('\x20\x20\x20Tolerance:\x20'+_0x3264fa);if(_0x9b2530<_0x33aa36-_0x3264fa)throw new Error(_0x5acf67(0x1c5)+_0x9b2530[_0x5acf67(0x25f)](0x6)+_0x5acf67(0x1f6)+_0x33aa36[_0x5acf67(0x25f)](0x6)+_0x5acf67(0x16b)+(_0x9b2530-_0x33aa36)['toFixed'](0x8)+'\x20USDT');console[_0x5acf67(0x22a)]('‚úÖ\x20Balance\x20check\x20passed\x20(with\x20tolerance)');const _0x2fc95c=Math[_0x5acf67(0x1ae)](_0x9b2530,_0x33aa36);let _0x405a07=_0x5ae954;console[_0x5acf67(0x22a)](_0x5acf67(0x302)+(_0x5ae954||_0x5acf67(0x31f)));if(!_0x405a07){console[_0x5acf67(0x22a)]('üîç\x20No\x20wallet\x20provided,\x20looking\x20up\x20from\x20shop\x20settings...');const _0x4937d9=await _0xecd832[_0x5acf67(0x293)][_0x5acf67(0x184)]({'where':{'id':_0x40eddb},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});console['log'](_0x5acf67(0x18e),_0x4937d9);if(_0x4937d9)switch(_0x262b1b){case'polygon':_0x405a07=_0x4937d9[_0x5acf67(0x1e0)]||undefined,console[_0x5acf67(0x22a)]('üîç\x20Selected\x20polygon\x20wallet:\x20'+_0x405a07);break;case _0x5acf67(0x280):_0x405a07=_0x4937d9['usdtTrcWallet']||undefined,console[_0x5acf67(0x22a)](_0x5acf67(0x2b0)+_0x405a07);break;case _0x5acf67(0x187):_0x405a07=_0x4937d9[_0x5acf67(0x185)]||undefined,console[_0x5acf67(0x22a)]('üîç\x20Selected\x20erc20\x20wallet:\x20'+_0x405a07);break;case'polygon_usdc':_0x405a07=_0x4937d9[_0x5acf67(0x1b8)]||undefined,console[_0x5acf67(0x22a)](_0x5acf67(0x1a1)+_0x405a07);break;case _0x5acf67(0x325):_0x405a07=_0x4937d9['usdcErcWallet']||undefined,console[_0x5acf67(0x22a)](_0x5acf67(0x208)+_0x405a07);break;}}else console[_0x5acf67(0x22a)](_0x5acf67(0x256)+_0x405a07);console[_0x5acf67(0x22a)](_0x5acf67(0x1f3)+_0x262b1b+':\x20'+(_0x405a07||_0x5acf67(0x1b6))),console[_0x5acf67(0x22a)]('üîç\x20Creating\x20payout\x20with\x20data:',{'shopId':_0x40eddb,'amount':_0x2fc95c,'network':_0x262b1b,'wallet':_0x405a07,'status':_0x5acf67(0x19d),'txid':_0x13c6fe,'notes':_0x312946,'periodFrom':_0x235423?new Date(_0x235423):null,'periodTo':_0x3d42e4?new Date(_0x3d42e4):null});const _0x4ec551=await _0xecd832[_0x5acf67(0x1f7)][_0x5acf67(0x23e)]({'data':{'shopId':_0x40eddb,'amount':_0x2fc95c,'network':_0x262b1b,'wallet':_0x405a07,'status':_0x5acf67(0x19d),'txid':_0x13c6fe,'notes':_0x312946,'periodFrom':_0x235423?new Date(_0x235423):null,'periodTo':_0x3d42e4?new Date(_0x3d42e4):null,'createdAt':new Date(),'paidAt':new Date()}});console[_0x5acf67(0x22a)](_0x5acf67(0x20d),{'id':_0x4ec551['id'],'wallet':_0x4ec551[_0x5acf67(0x269)],'network':_0x4ec551[_0x5acf67(0x2c1)],'amount':_0x4ec551[_0x5acf67(0x165)]});const _0x75fb19=_0x9b2530-_0x2fc95c,_0xb2436e=Number(_0x1ed228['totalPaidOut'])+_0x2fc95c;return await _0xecd832[_0x5acf67(0x293)][_0x5acf67(0x23a)]({'where':{'id':_0x40eddb},'data':{'balance':_0x75fb19,'totalPaidOut':_0xb2436e}}),console[_0x5acf67(0x22a)](_0x5acf67(0x1fb)+_0x1ed228[_0x5acf67(0x30c)]+'\x20balance\x20updated:'),console[_0x5acf67(0x22a)]('\x20\x20\x20Balance:\x20'+_0x9b2530[_0x5acf67(0x25f)](0x6)+_0x5acf67(0x28d)+_0x75fb19[_0x5acf67(0x25f)](0x6)+'\x20USDT\x20(-'+_0x2fc95c[_0x5acf67(0x25f)](0x6)+')'),console[_0x5acf67(0x22a)](_0x5acf67(0x2e2)+_0x1ed228['totalPaidOut'][_0x5acf67(0x25f)](0x6)+_0x5acf67(0x28d)+_0xb2436e['toFixed'](0x6)+_0x5acf67(0x2ad)+_0x2fc95c[_0x5acf67(0x25f)](0x6)+')'),console[_0x5acf67(0x22a)](_0x5acf67(0x1cf)+_0x2fc95c[_0x5acf67(0x25f)](0x6)+_0x5acf67(0x1e9)),{'payout':_0x4ec551,'shop':_0x1ed228};});console[_0x859a34(0x22a)](_0x859a34(0x2b2)+_0x5d0a93[_0x859a34(0x1f7)]['id']+'\x20for\x20shop\x20'+_0x5d0a93[_0x859a34(0x293)]['username']+'\x20('+_0x5d0a93['payout'][_0x859a34(0x165)][_0x859a34(0x25f)](0x6)+'\x20USDT)');try{let _0x52b819=_0x859a34(0x2c4);if(_0x5d0a93[_0x859a34(0x1f7)][_0x859a34(0x201)]&&_0x5d0a93['payout'][_0x859a34(0x23d)]){const _0x3c5c03=new Date(_0x5d0a93['payout'][_0x859a34(0x201)])[_0x859a34(0x232)]('ru-RU'),_0x500f28=new Date(_0x5d0a93['payout']['periodTo'])[_0x859a34(0x232)](_0x859a34(0x162));_0x52b819=_0x3c5c03+_0x859a34(0x223)+_0x500f28;}await telegramBotService_1[_0x859a34(0x168)][_0x859a34(0x26f)](_0x5d0a93[_0x859a34(0x1f7)][_0x859a34(0x1a8)],{'id':_0x5d0a93[_0x859a34(0x1f7)]['id'],'amount':_0x5d0a93['payout'][_0x859a34(0x165)],'network':_0x5d0a93[_0x859a34(0x1f7)][_0x859a34(0x2c1)],'wallet':_0x5d0a93[_0x859a34(0x1f7)][_0x859a34(0x269)],'period':_0x52b819,'createdAt':_0x5d0a93[_0x859a34(0x1f7)][_0x859a34(0x1c2)],'txid':_0x5d0a93['payout'][_0x859a34(0x2fe)]}),console[_0x859a34(0x22a)](_0x859a34(0x2f7)+_0x5d0a93[_0x859a34(0x1f7)]['id']);}catch(_0x59cc2f){console[_0x859a34(0x305)]('‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notification\x20for\x20payout\x20'+_0x5d0a93[_0x859a34(0x1f7)]['id']+':',_0x59cc2f);}return{'id':_0x5d0a93[_0x859a34(0x1f7)]['id'],'shopId':_0x5d0a93[_0x859a34(0x1f7)][_0x859a34(0x1a8)],'shopName':_0x5d0a93[_0x859a34(0x293)][_0x859a34(0x2b3)],'shopUsername':_0x5d0a93[_0x859a34(0x293)][_0x859a34(0x30c)],'amount':_0x5d0a93[_0x859a34(0x1f7)][_0x859a34(0x165)],'network':_0x5d0a93['payout'][_0x859a34(0x2c1)],'wallet':_0x5d0a93[_0x859a34(0x1f7)][_0x859a34(0x269)],'status':_0x5d0a93[_0x859a34(0x1f7)][_0x859a34(0x29b)],'txid':_0x5d0a93[_0x859a34(0x1f7)][_0x859a34(0x2fe)],'notes':_0x5d0a93['payout']['notes'],'periodFrom':_0x5d0a93[_0x859a34(0x1f7)][_0x859a34(0x201)],'periodTo':_0x5d0a93['payout']['periodTo'],'createdAt':_0x5d0a93[_0x859a34(0x1f7)][_0x859a34(0x1c2)],'paidAt':_0x5d0a93['payout']['paidAt']};}async['getAllPayouts'](_0x415e0f){const _0x18ba47=a53_0x3421aa,{page:_0x2e91e8,limit:_0x5f0a70,shopId:_0x3826fe,network:_0x32321a,dateFrom:_0x398206,dateTo:_0x57fad7,search:_0x5940e8}=_0x415e0f,_0x2b1e38=(_0x2e91e8-0x1)*_0x5f0a70,_0x461fe6={};_0x3826fe&&(_0x461fe6[_0x18ba47(0x1a8)]=_0x3826fe);_0x32321a&&(_0x461fe6['network']=_0x32321a);if(_0x398206||_0x57fad7){_0x461fe6['createdAt']={};if(_0x398206){const _0x1c6a41=new Date(_0x398206);_0x1c6a41[_0x18ba47(0x27b)](0x0,0x0,0x0,0x1),_0x461fe6[_0x18ba47(0x1c2)]['gte']=_0x1c6a41,console[_0x18ba47(0x22a)](_0x18ba47(0x1ed)+_0x1c6a41[_0x18ba47(0x2e3)]());}if(_0x57fad7){const _0x16c4da=new Date(_0x57fad7);_0x16c4da[_0x18ba47(0x27b)](0x17,0x3b,0x3b,0x3e7),_0x461fe6[_0x18ba47(0x1c2)][_0x18ba47(0x1aa)]=_0x16c4da,console[_0x18ba47(0x22a)](_0x18ba47(0x2af)+_0x16c4da[_0x18ba47(0x2e3)]());}}_0x5940e8&&(_0x461fe6['OR']=[{'shop':{'name':{'contains':_0x5940e8,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x5940e8,'mode':_0x18ba47(0x26b)}}},{'notes':{'contains':_0x5940e8,'mode':'insensitive'}}]);const [_0x3237f8,_0x1f993f]=await Promise[_0x18ba47(0x1cd)]([database_1['default']['payout'][_0x18ba47(0x28e)]({'where':_0x461fe6,'skip':_0x2b1e38,'take':_0x5f0a70,'orderBy':{'createdAt':_0x18ba47(0x2be)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'wallet':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x18ba47(0x1c6)][_0x18ba47(0x1f7)][_0x18ba47(0x160)]({'where':_0x461fe6})]);return{'payouts':_0x3237f8['map'](_0x2094fc=>({'id':_0x2094fc['id'],'shopId':_0x2094fc['shopId'],'shopName':_0x2094fc[_0x18ba47(0x293)]['name'],'shopUsername':_0x2094fc[_0x18ba47(0x293)][_0x18ba47(0x30c)],'amount':_0x2094fc['amount'],'network':_0x2094fc[_0x18ba47(0x2c1)],'wallet':_0x2094fc[_0x18ba47(0x269)],'status':_0x2094fc[_0x18ba47(0x29b)],'txid':_0x2094fc[_0x18ba47(0x2fe)],'notes':_0x2094fc['notes'],'periodFrom':_0x2094fc[_0x18ba47(0x201)],'periodTo':_0x2094fc[_0x18ba47(0x23d)],'createdAt':_0x2094fc[_0x18ba47(0x1c2)],'paidAt':_0x2094fc['paidAt']})),'pagination':{'page':_0x2e91e8,'limit':_0x5f0a70,'total':_0x1f993f,'totalPages':Math[_0x18ba47(0x19f)](_0x1f993f/_0x5f0a70)}};}async[a53_0x3421aa(0x2a9)](_0x4a3337){const _0x45c7fd=a53_0x3421aa,_0x41fa06=await database_1[_0x45c7fd(0x1c6)]['payout'][_0x45c7fd(0x184)]({'where':{'id':_0x4a3337},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x41fa06)return null;return{'id':_0x41fa06['id'],'shopId':_0x41fa06[_0x45c7fd(0x1a8)],'shopName':_0x41fa06[_0x45c7fd(0x293)][_0x45c7fd(0x2b3)],'shopUsername':_0x41fa06['shop'][_0x45c7fd(0x30c)],'amount':_0x41fa06[_0x45c7fd(0x165)],'network':_0x41fa06[_0x45c7fd(0x2c1)],'wallet':_0x41fa06[_0x45c7fd(0x269)],'status':_0x41fa06['status'],'txid':_0x41fa06['txid'],'notes':_0x41fa06[_0x45c7fd(0x2a5)],'periodFrom':_0x41fa06['periodFrom'],'periodTo':_0x41fa06[_0x45c7fd(0x23d)],'createdAt':_0x41fa06[_0x45c7fd(0x1c2)],'paidAt':_0x41fa06[_0x45c7fd(0x2e0)]};}async[a53_0x3421aa(0x1ac)](_0x395867){const _0x32d83a=a53_0x3421aa;await database_1[_0x32d83a(0x1c6)][_0x32d83a(0x1f7)][_0x32d83a(0x1f4)]({'where':{'id':_0x395867}});}async[a53_0x3421aa(0x217)](_0x12d320,_0x57093b){const _0x41eb0e=a53_0x3421aa,_0xaf31b4=await database_1[_0x41eb0e(0x1c6)][_0x41eb0e(0x275)](async _0x86e74d=>{const _0x2810d7=_0x41eb0e,_0x2fc517=await _0x86e74d[_0x2810d7(0x1f7)]['findUnique']({'where':{'id':_0x12d320},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}}}});if(!_0x2fc517)throw new Error('Payout\x20not\x20found');console['log'](_0x2810d7(0x251)+_0x12d320+_0x2810d7(0x29d)+_0x2fc517[_0x2810d7(0x293)]['username']+':'),console[_0x2810d7(0x22a)](_0x2810d7(0x22d)+_0x2fc517[_0x2810d7(0x165)][_0x2810d7(0x25f)](0x6)+'\x20USDT'),console[_0x2810d7(0x22a)](_0x2810d7(0x235)+_0x2fc517['network']),console[_0x2810d7(0x22a)]('\x20\x20\x20Shop\x20balance:\x20'+_0x2fc517['shop'][_0x2810d7(0x25c)]['toFixed'](0x6)+_0x2810d7(0x1e9)),console[_0x2810d7(0x22a)](_0x2810d7(0x22e)+_0x2fc517['shop']['totalPaidOut'][_0x2810d7(0x25f)](0x6)+_0x2810d7(0x1e9));let _0x1eea98=0x0;if(_0x57093b[_0x2810d7(0x165)]!==undefined){const _0x3ad08d=Number(_0x2fc517['amount']),_0x176d1=Number(_0x57093b[_0x2810d7(0x165)]);_0x1eea98=_0x176d1-_0x3ad08d,console['log'](_0x2810d7(0x31a)+_0x176d1[_0x2810d7(0x25f)](0x6)+_0x2810d7(0x1e9)),console['log'](_0x2810d7(0x1d0)+_0x1eea98[_0x2810d7(0x25f)](0x6)+_0x2810d7(0x1e9));if(_0x1eea98<0x0)console[_0x2810d7(0x22a)]('\x20\x20\x20Amount\x20decreased\x20by\x20'+Math[_0x2810d7(0x226)](_0x1eea98)[_0x2810d7(0x25f)](0x6)+_0x2810d7(0x320));else{if(_0x1eea98>0x0){const _0xa6a34d=Number(_0x2fc517[_0x2810d7(0x293)][_0x2810d7(0x25c)]);console[_0x2810d7(0x22a)](_0x2810d7(0x1e1)+_0x1eea98[_0x2810d7(0x25f)](0x6)+_0x2810d7(0x2cf));if(_0xa6a34d<_0x1eea98)throw new Error(_0x2810d7(0x17e)+_0xa6a34d[_0x2810d7(0x25f)](0x6)+'\x20USDT,\x20Required:\x20'+_0x1eea98[_0x2810d7(0x25f)](0x6)+_0x2810d7(0x1e9));}}}const _0x7c325e={};if(_0x57093b[_0x2810d7(0x165)]!==undefined)_0x7c325e[_0x2810d7(0x165)]=_0x57093b['amount'];if(_0x57093b[_0x2810d7(0x2c1)]!==undefined)_0x7c325e['network']=_0x57093b[_0x2810d7(0x2c1)];if(_0x57093b[_0x2810d7(0x269)]!==undefined)_0x7c325e[_0x2810d7(0x269)]=_0x57093b['wallet']||null;if(_0x57093b['notes']!==undefined)_0x7c325e[_0x2810d7(0x2a5)]=_0x57093b[_0x2810d7(0x2a5)]||null;if(_0x57093b[_0x2810d7(0x2fe)]!==undefined)_0x7c325e['txid']=_0x57093b[_0x2810d7(0x2fe)]||null;if(_0x57093b[_0x2810d7(0x201)]!==undefined)_0x7c325e[_0x2810d7(0x201)]=_0x57093b['periodFrom']?new Date(_0x57093b[_0x2810d7(0x201)]):null;if(_0x57093b[_0x2810d7(0x23d)]!==undefined)_0x7c325e[_0x2810d7(0x23d)]=_0x57093b[_0x2810d7(0x23d)]?new Date(_0x57093b['periodTo']):null;const _0x19a22f=await _0x86e74d[_0x2810d7(0x1f7)][_0x2810d7(0x23a)]({'where':{'id':_0x12d320},'data':_0x7c325e,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(_0x1eea98!==0x0){const _0x301fa6=Number(_0x2fc517[_0x2810d7(0x293)][_0x2810d7(0x25c)]),_0x2cd835=Number(_0x2fc517[_0x2810d7(0x293)][_0x2810d7(0x2d2)]),_0x1ee56a=_0x301fa6-_0x1eea98,_0x23241a=_0x2cd835+_0x1eea98;await _0x86e74d[_0x2810d7(0x293)][_0x2810d7(0x23a)]({'where':{'id':_0x2fc517['shopId']},'data':{'balance':_0x1ee56a,'totalPaidOut':_0x23241a}}),console['log'](_0x2810d7(0x1fb)+_0x2fc517[_0x2810d7(0x293)][_0x2810d7(0x30c)]+_0x2810d7(0x1b3)),console[_0x2810d7(0x22a)](_0x2810d7(0x2c6)+_0x301fa6[_0x2810d7(0x25f)](0x6)+_0x2810d7(0x28d)+_0x1ee56a['toFixed'](0x6)+_0x2810d7(0x1e9)),console['log'](_0x2810d7(0x2e2)+_0x2cd835[_0x2810d7(0x25f)](0x6)+_0x2810d7(0x28d)+_0x23241a[_0x2810d7(0x25f)](0x6)+_0x2810d7(0x1e9));}return console[_0x2810d7(0x22a)](_0x2810d7(0x287)+_0x12d320+'\x20updated\x20successfully'),_0x19a22f;});return{'id':_0xaf31b4['id'],'shopId':_0xaf31b4['shopId'],'shopName':_0xaf31b4[_0x41eb0e(0x293)]['name'],'shopUsername':_0xaf31b4[_0x41eb0e(0x293)]['username'],'amount':Number(_0xaf31b4[_0x41eb0e(0x165)]),'network':_0xaf31b4[_0x41eb0e(0x2c1)],'wallet':_0xaf31b4['wallet'],'status':_0xaf31b4['status'],'txid':_0xaf31b4[_0x41eb0e(0x2fe)],'notes':_0xaf31b4['notes'],'periodFrom':_0xaf31b4['periodFrom'],'periodTo':_0xaf31b4[_0x41eb0e(0x23d)],'createdAt':_0xaf31b4[_0x41eb0e(0x1c2)],'paidAt':_0xaf31b4['paidAt']};}async[a53_0x3421aa(0x24e)](_0x3b3380){const _0x6b6ff4=a53_0x3421aa,{page:_0x2bf197,limit:_0x107f6b,status:_0x40f55f,gateway:_0x4e4980,shopId:_0x120908,dateFrom:_0x3bd91c,dateTo:_0x4feb6b,search:_0x49cd85,currency:_0x1d882d,sortBy:_0x6c21b,sortOrder:_0x1ef64d}=_0x3b3380,_0x2acbcc=(_0x2bf197-0x1)*_0x107f6b;console['log'](_0x6b6ff4(0x1ce),_0x3b3380);const _0x397268=await database_1[_0x6b6ff4(0x1c6)][_0x6b6ff4(0x27a)][_0x6b6ff4(0x227)]({'by':[_0x6b6ff4(0x22c)],'_count':{'gateway':!![]}});console[_0x6b6ff4(0x22a)](_0x6b6ff4(0x317),_0x397268['map'](_0x340190=>_0x340190[_0x6b6ff4(0x22c)]+'\x20('+_0x340190[_0x6b6ff4(0x2c7)][_0x6b6ff4(0x22c)]+_0x6b6ff4(0x294)));if(_0x4e4980){const _0x456928=_0x397268[_0x6b6ff4(0x17c)](_0x4694ba=>_0x4694ba[_0x6b6ff4(0x22c)][_0x6b6ff4(0x1e7)]()===_0x4e4980[_0x6b6ff4(0x1e7)]());!_0x456928&&_0x4e4980[_0x6b6ff4(0x1e7)]()!==_0x6b6ff4(0x258)&&console[_0x6b6ff4(0x22a)](_0x6b6ff4(0x266)+_0x4e4980+_0x6b6ff4(0x1d6)+_0x397268[_0x6b6ff4(0x1af)](_0x108bdf=>_0x108bdf[_0x6b6ff4(0x22c)])[_0x6b6ff4(0x2e1)](',\x20'));}const _0xd19a59={};_0x40f55f&&(_0xd19a59[_0x6b6ff4(0x29b)]=_0x40f55f[_0x6b6ff4(0x2b9)]());if(!_0x4e4980)_0xd19a59[_0x6b6ff4(0x22c)]={'not':'test_gateway'};else{if(_0x4e4980&&(_0x4e4980[_0x6b6ff4(0x1e7)]()==='test_gateway'||_0x4e4980===_0x6b6ff4(0x250)))_0xd19a59[_0x6b6ff4(0x22c)]='test_gateway';else{let _0x3a410e=_0x4e4980;const _0x1d1760=(0x0,gateway_1[_0x6b6ff4(0x1dd)])(_0x4e4980);if(_0x1d1760)_0x3a410e=_0x1d1760,console[_0x6b6ff4(0x22a)](_0x6b6ff4(0x2c2)+_0x4e4980+_0x6b6ff4(0x246)+_0x3a410e+'\x27');else{const _0x32ebc2=(0x0,gateway_1[_0x6b6ff4(0x1ad)])(_0x4e4980);if(_0x32ebc2){const _0x2530d0=(0x0,gateway_1[_0x6b6ff4(0x1dd)])(_0x32ebc2);_0x2530d0&&(_0x3a410e=_0x2530d0,console[_0x6b6ff4(0x22a)](_0x6b6ff4(0x288)+_0x4e4980+_0x6b6ff4(0x180)+_0x32ebc2+_0x6b6ff4(0x2ab)+_0x3a410e+'\x27'));}else console[_0x6b6ff4(0x22a)](_0x6b6ff4(0x172)+_0x4e4980+_0x6b6ff4(0x277));}const _0x3c422c=await database_1[_0x6b6ff4(0x1c6)]['payment'][_0x6b6ff4(0x160)]({'where':{'gateway':_0x3a410e[_0x6b6ff4(0x1e7)]()},'take':0x1});_0x3c422c===0x0?(console[_0x6b6ff4(0x22a)]('‚ö†Ô∏è\x20Gateway\x20\x27'+_0x3a410e+_0x6b6ff4(0x30d)+_0x4e4980+_0x6b6ff4(0x260)),_0xd19a59[_0x6b6ff4(0x22c)]=_0x6b6ff4(0x1a4)):(_0xd19a59[_0x6b6ff4(0x22c)]=_0x3a410e[_0x6b6ff4(0x1e7)](),console[_0x6b6ff4(0x22a)](_0x6b6ff4(0x2f8)+_0x3a410e+'\x27\x20(from\x20\x27'+_0x4e4980+'\x27)'));}}console['log']('üìä\x20Gateway\x20filter\x20applied:',_0xd19a59[_0x6b6ff4(0x22c)]);_0x120908&&(_0xd19a59[_0x6b6ff4(0x1a8)]=_0x120908);_0x1d882d&&(_0xd19a59[_0x6b6ff4(0x1c3)]=_0x1d882d[_0x6b6ff4(0x2b9)](),console['log'](_0x6b6ff4(0x1d4)+_0x1d882d[_0x6b6ff4(0x2b9)]()));if(_0x3bd91c||_0x4feb6b){_0xd19a59['createdAt']={};if(_0x3bd91c){const _0x4cd616=new Date(_0x3bd91c),_0x2f32fb=new Date(Date[_0x6b6ff4(0x2ff)](_0x4cd616['getUTCFullYear'](),_0x4cd616[_0x6b6ff4(0x313)](),_0x4cd616[_0x6b6ff4(0x211)](),0x0,0x0,0x0,0x0));_0xd19a59['createdAt'][_0x6b6ff4(0x195)]=_0x2f32fb,console[_0x6b6ff4(0x22a)](_0x6b6ff4(0x2c8)+_0x2f32fb['toISOString']());}if(_0x4feb6b){const _0x113bf8=new Date(_0x4feb6b),_0x4601f8=new Date(Date[_0x6b6ff4(0x2ff)](_0x113bf8['getUTCFullYear'](),_0x113bf8[_0x6b6ff4(0x313)](),_0x113bf8[_0x6b6ff4(0x211)](),0x17,0x3b,0x3b,0x3e7));_0xd19a59[_0x6b6ff4(0x1c2)][_0x6b6ff4(0x1aa)]=_0x4601f8,console[_0x6b6ff4(0x22a)](_0x6b6ff4(0x2f2)+_0x4601f8[_0x6b6ff4(0x2e3)]());}}_0x49cd85&&(_0xd19a59['OR']=[{'id':{'contains':_0x49cd85,'mode':_0x6b6ff4(0x26b)}},{'orderId':{'contains':_0x49cd85,'mode':_0x6b6ff4(0x26b)}},{'gatewayOrderId':{'contains':_0x49cd85,'mode':_0x6b6ff4(0x26b)}},{'customerEmail':{'contains':_0x49cd85,'mode':_0x6b6ff4(0x26b)}},{'shop':{'name':{'contains':_0x49cd85,'mode':_0x6b6ff4(0x26b)}}},{'shop':{'username':{'contains':_0x49cd85,'mode':_0x6b6ff4(0x26b)}}}]);console[_0x6b6ff4(0x22a)](_0x6b6ff4(0x1b4),JSON[_0x6b6ff4(0x274)](_0xd19a59,null,0x2));const _0x3bc8ae=await database_1['default'][_0x6b6ff4(0x27a)][_0x6b6ff4(0x160)]({'where':_0xd19a59});console[_0x6b6ff4(0x22a)]('üîç\x20Total\x20payments\x20matching\x20filters:\x20'+_0x3bc8ae);let _0x4042ad={'createdAt':_0x6b6ff4(0x2be)};if(_0x6c21b){const _0x967714=['amount',_0x6b6ff4(0x1c2),'updatedAt',_0x6b6ff4(0x29b),_0x6b6ff4(0x22c),'currency'],_0x30ea1c=[_0x6b6ff4(0x271),'desc'];if(_0x967714[_0x6b6ff4(0x20f)](_0x6c21b)){const _0x26f779=_0x30ea1c[_0x6b6ff4(0x20f)](_0x1ef64d)?_0x1ef64d:_0x6b6ff4(0x2be);_0x4042ad={[_0x6c21b]:_0x26f779},console[_0x6b6ff4(0x22a)](_0x6b6ff4(0x279)+_0x6c21b+'\x20in\x20'+_0x26f779+'\x20order');}}const [_0x10dd57,_0x693885]=await Promise[_0x6b6ff4(0x1cd)]([database_1[_0x6b6ff4(0x1c6)][_0x6b6ff4(0x27a)][_0x6b6ff4(0x28e)]({'where':_0xd19a59,'skip':_0x2acbcc,'take':_0x107f6b,'orderBy':_0x4042ad,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x6b6ff4(0x1c6)]['payment'][_0x6b6ff4(0x160)]({'where':_0xd19a59})]);let _0x2ec73a,_0x767571;if(_0x3bd91c){const _0xf914ab=new Date(_0x3bd91c);_0x2ec73a=new Date(Date[_0x6b6ff4(0x2ff)](_0xf914ab[_0x6b6ff4(0x1c0)](),_0xf914ab[_0x6b6ff4(0x313)](),_0xf914ab[_0x6b6ff4(0x211)](),0x0,0x0,0x0,0x0));}else{const _0x35748b=new Date();_0x2ec73a=new Date(Date[_0x6b6ff4(0x2ff)](_0x35748b[_0x6b6ff4(0x1c0)](),_0x35748b[_0x6b6ff4(0x313)](),_0x35748b['getUTCDate'](),0x0,0x0,0x0,0x0));}if(_0x4feb6b){const _0x1d96d8=new Date(_0x4feb6b);_0x767571=new Date(Date['UTC'](_0x1d96d8[_0x6b6ff4(0x1c0)](),_0x1d96d8[_0x6b6ff4(0x313)](),_0x1d96d8['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}else{if(_0x3bd91c){const _0x8c32ca=new Date(_0x3bd91c);_0x767571=new Date(Date[_0x6b6ff4(0x2ff)](_0x8c32ca[_0x6b6ff4(0x1c0)](),_0x8c32ca[_0x6b6ff4(0x313)](),_0x8c32ca[_0x6b6ff4(0x211)](),0x17,0x3b,0x3b,0x3e7));}else{const _0xa51372=new Date();_0x767571=new Date(Date[_0x6b6ff4(0x2ff)](_0xa51372[_0x6b6ff4(0x1c0)](),_0xa51372[_0x6b6ff4(0x313)](),_0xa51372['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}}const _0x4a2d81={};{const _0x39e418={'status':_0x40f55f?_0x40f55f[_0x6b6ff4(0x2b9)]():_0x6b6ff4(0x225),'createdAt':{'gte':_0x2ec73a,'lte':_0x767571}};_0x4e4980?_0x39e418[_0x6b6ff4(0x22c)]=_0xd19a59[_0x6b6ff4(0x22c)]:_0x39e418[_0x6b6ff4(0x22c)]={'not':_0x6b6ff4(0x258)};_0x120908&&(_0x39e418[_0x6b6ff4(0x1a8)]=_0x120908);_0x1d882d&&(_0x39e418['currency']=_0x1d882d['toUpperCase']());console[_0x6b6ff4(0x22a)](_0x6b6ff4(0x278),JSON[_0x6b6ff4(0x274)](_0x39e418,null,0x2));const _0x3cb72f=await database_1[_0x6b6ff4(0x1c6)]['payment']['findMany']({'where':_0x39e418,'select':{'amountUSDT':!![],'currency':!![],'amount':!![]}});let _0x27db7a=0x0;_0x3cb72f['forEach'](_0x5c07f3=>{const _0x5335de=_0x6b6ff4;_0x5c07f3[_0x5335de(0x212)]&&(_0x27db7a+=_0x5c07f3[_0x5335de(0x212)]);if(_0x5c07f3['currency']){const _0x2be166=_0x5c07f3[_0x5335de(0x1c3)][_0x5335de(0x2b9)]();!_0x4a2d81[_0x2be166]&&(_0x4a2d81[_0x2be166]=0x0),_0x4a2d81[_0x2be166]+=_0x5c07f3[_0x5335de(0x165)];}}),_0x27db7a>0x0&&(_0x4a2d81[_0x6b6ff4(0x289)]=_0x27db7a);}return{'payments':_0x10dd57,'pagination':{'page':_0x2bf197,'limit':_0x107f6b,'total':_0x693885,'totalPages':Math[_0x6b6ff4(0x19f)](_0x693885/_0x107f6b)},'statistics':_0x4a2d81};}async['getPaymentById'](_0xfe7677){const _0x5a9c8a=a53_0x3421aa,_0xdee387=await database_1[_0x5a9c8a(0x1c6)][_0x5a9c8a(0x27a)][_0x5a9c8a(0x184)]({'where':{'id':_0xfe7677},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0xdee387)return null;return{'id':_0xdee387['id'],'shopId':_0xdee387['shopId'],'gateway':_0xdee387[_0x5a9c8a(0x22c)],'amount':_0xdee387[_0x5a9c8a(0x165)],'currency':_0xdee387['currency'],'status':_0xdee387[_0x5a9c8a(0x29b)],'orderId':_0xdee387[_0x5a9c8a(0x169)],'gatewayOrderId':_0xdee387['gatewayOrderId'],'customerEmail':_0xdee387[_0x5a9c8a(0x2a6)],'customerName':_0xdee387['customerName'],'customerCountry':_0xdee387['customerCountry'],'customerIp':_0xdee387[_0x5a9c8a(0x19e)],'customerUa':_0xdee387[_0x5a9c8a(0x237)],'failureMessage':_0xdee387['failureMessage'],'externalPaymentUrl':_0xdee387[_0x5a9c8a(0x1d7)],'successUrl':_0xdee387[_0x5a9c8a(0x28a)],'failUrl':_0xdee387[_0x5a9c8a(0x248)],'pendingUrl':_0xdee387[_0x5a9c8a(0x207)],'whiteUrl':_0xdee387['whiteUrl'],'createdAt':_0xdee387[_0x5a9c8a(0x1c2)],'updatedAt':_0xdee387[_0x5a9c8a(0x2ae)],'shop':_0xdee387[_0x5a9c8a(0x293)]};}async[a53_0x3421aa(0x233)](_0x38d6d8,_0x1e3025,_0x515aff,_0x3d61a8){const _0x272a89=a53_0x3421aa,_0x956daf=await database_1[_0x272a89(0x1c6)][_0x272a89(0x275)](async _0x21a383=>{const _0x57ee45=_0x272a89,_0x784d4b=await _0x21a383[_0x57ee45(0x27a)]['findUnique']({'where':{'id':_0x38d6d8},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x784d4b)throw new Error(_0x57ee45(0x292));const _0x39d012=_0x784d4b[_0x57ee45(0x29b)],_0x119409=_0x1e3025[_0x57ee45(0x2b9)]();console[_0x57ee45(0x22a)](_0x57ee45(0x222)+_0x38d6d8+'\x20status:\x20'+_0x39d012+_0x57ee45(0x28d)+_0x119409),console[_0x57ee45(0x22a)](_0x57ee45(0x247)+_0x784d4b[_0x57ee45(0x293)]['balance']+_0x57ee45(0x1e9));const _0x5729d6={'status':_0x119409,'updatedAt':new Date(),'statusChangedBy':_0x57ee45(0x15f),'statusChangedAt':new Date()};_0x515aff&&(_0x5729d6[_0x57ee45(0x1fe)]=_0x515aff);_0x119409==='CHARGEBACK'&&_0x3d61a8&&(_0x5729d6[_0x57ee45(0x318)]=_0x3d61a8);let _0x1cbd02=0x0,_0x3ce0d4=_0x784d4b[_0x57ee45(0x293)][_0x57ee45(0x25c)];if(_0x119409===_0x57ee45(0x225)&&_0x39d012!=='PAID'){_0x5729d6[_0x57ee45(0x2e0)]=new Date();const _0x510a2c=await currencyService_1[_0x57ee45(0x240)][_0x57ee45(0x1fc)](_0x784d4b[_0x57ee45(0x165)],_0x784d4b[_0x57ee45(0x1c3)]);_0x5729d6[_0x57ee45(0x212)]=_0x510a2c;let _0x155247=0x2d;const _0x39ec05=await _0x21a383[_0x57ee45(0x293)][_0x57ee45(0x184)]({'where':{'id':_0x784d4b[_0x57ee45(0x1a8)]},'select':{'gatewaySettings':!![]}});if(_0x39ec05?.[_0x57ee45(0x206)])try{const _0x584dae=JSON['parse'](_0x39ec05[_0x57ee45(0x206)]);for(const [_0x113c48,_0x52f02c]of Object[_0x57ee45(0x2cc)](_0x584dae)){if(_0x113c48[_0x57ee45(0x1e7)]()===_0x784d4b[_0x57ee45(0x22c)][_0x57ee45(0x1e7)]()){_0x155247=_0x52f02c[_0x57ee45(0x163)]||0xa;break;}}}catch(_0x30a3a3){console[_0x57ee45(0x305)]('Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20'+_0x38d6d8+':',_0x30a3a3);}let _0x2109c3;_0x784d4b['amountAfterGatewayCommissionUSDT']!==null&&_0x784d4b['amountAfterGatewayCommissionUSDT']!==undefined?(_0x2109c3=_0x784d4b[_0x57ee45(0x213)],console['log'](_0x57ee45(0x1df)+_0x2109c3['toFixed'](0x6)+_0x57ee45(0x283)+_0x38d6d8)):(_0x2109c3=_0x510a2c*(0x1-_0x155247/0x64),console['log'](_0x57ee45(0x204)+_0x38d6d8+':\x20'+_0x155247+'%\x20from\x20'+_0x510a2c[_0x57ee45(0x25f)](0x6)+_0x57ee45(0x1e9)),_0x5729d6['amountAfterGatewayCommissionUSDT']=_0x2109c3,_0x5729d6[_0x57ee45(0x188)]=_0x155247),_0x1cbd02=_0x2109c3,_0x3ce0d4+=_0x2109c3,console[_0x57ee45(0x22a)]('üí∞\x20Payment\x20'+_0x38d6d8+'\x20became\x20PAID:'),console['log'](_0x57ee45(0x28f)+_0x510a2c[_0x57ee45(0x25f)](0x6)+'\x20USDT'),console[_0x57ee45(0x22a)](_0x57ee45(0x254)+_0x784d4b['gateway']+_0x57ee45(0x1ee)+_0x155247+'%'),console[_0x57ee45(0x22a)]('\x20\x20\x20Merchant\x20gets:\x20'+_0x2109c3['toFixed'](0x6)+_0x57ee45(0x28c)+_0x155247+'%\x20commission)'),console[_0x57ee45(0x22a)](_0x57ee45(0x300)+_0x2109c3[_0x57ee45(0x25f)](0x6)+_0x57ee45(0x1e9));}else{if(_0x39d012===_0x57ee45(0x225)&&_0x119409!==_0x57ee45(0x225)&&_0x119409!==_0x57ee45(0x203)){if(_0x784d4b[_0x57ee45(0x212)]){let _0xfab7f3=0x2d;const _0x8b329e=await _0x21a383['shop']['findUnique']({'where':{'id':_0x784d4b[_0x57ee45(0x1a8)]},'select':{'gatewaySettings':!![]}});if(_0x8b329e?.[_0x57ee45(0x206)])try{const _0x3b3fc0=JSON[_0x57ee45(0x1d5)](_0x8b329e[_0x57ee45(0x206)]);for(const [_0x549293,_0x3c27a6]of Object[_0x57ee45(0x2cc)](_0x3b3fc0)){if(_0x549293[_0x57ee45(0x1e7)]()===_0x784d4b['gateway']['toLowerCase']()){_0xfab7f3=_0x3c27a6[_0x57ee45(0x163)]||0xa;break;}}}catch(_0x313c49){console['error'](_0x57ee45(0x2ed)+_0x38d6d8+':',_0x313c49);}const _0x4738f1=_0x784d4b[_0x57ee45(0x212)]*(0x1-_0xfab7f3/0x64);_0x1cbd02=-_0x4738f1,_0x3ce0d4-=_0x4738f1,console['log']('\x20\x20\x20Full\x20amount:\x20'+_0x784d4b[_0x57ee45(0x212)]['toFixed'](0x6)+'\x20USDT'),console['log'](_0x57ee45(0x254)+_0x784d4b[_0x57ee45(0x22c)]+_0x57ee45(0x1ee)+_0xfab7f3+'%'),console[_0x57ee45(0x22a)]('\x20\x20\x20Merchant\x20loses:\x20'+_0x4738f1[_0x57ee45(0x25f)](0x6)+'\x20USDT\x20(after\x20'+_0xfab7f3+_0x57ee45(0x167)),console[_0x57ee45(0x22a)](_0x57ee45(0x2d4)+_0x4738f1['toFixed'](0x6)+_0x57ee45(0x1e9));}}}_0x119409===_0x57ee45(0x203)&&(console[_0x57ee45(0x22a)]('üí∏\x20CHARGEBACK:\x20Processing\x20penalty-only\x20deduction'),_0x3d61a8&&_0x3d61a8>0x0?(_0x1cbd02=-_0x3d61a8,_0x3ce0d4-=_0x3d61a8,console[_0x57ee45(0x22a)](_0x57ee45(0x175)+_0x3d61a8[_0x57ee45(0x25f)](0x6)+_0x57ee45(0x2db)),console[_0x57ee45(0x22a)]('üí∞\x20Payment\x20amount\x20is\x20NOT\x20deducted\x20(chargeback\x20penalty\x20only)')):console['log'](_0x57ee45(0x2e4)),_0x5729d6[_0x57ee45(0x318)]=_0x3d61a8||0x0);_0x119409===_0x57ee45(0x1d9)&&_0x39d012==='PAID'&&console['log'](_0x57ee45(0x2c5));const _0x555a15=await _0x21a383['payment'][_0x57ee45(0x23a)]({'where':{'id':_0x38d6d8},'data':_0x5729d6,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x1cbd02!==0x0&&(await _0x21a383[_0x57ee45(0x293)][_0x57ee45(0x23a)]({'where':{'id':_0x784d4b[_0x57ee45(0x1a8)]},'data':{'balance':_0x3ce0d4}}),console[_0x57ee45(0x22a)](_0x57ee45(0x1fb)+_0x784d4b[_0x57ee45(0x1a8)]+_0x57ee45(0x17f)+_0x784d4b[_0x57ee45(0x293)][_0x57ee45(0x25c)][_0x57ee45(0x25f)](0x6)+_0x57ee45(0x28d)+_0x3ce0d4[_0x57ee45(0x25f)](0x6)+_0x57ee45(0x2b5)+(_0x1cbd02>0x0?'+':'')+_0x1cbd02[_0x57ee45(0x25f)](0x6)+')')),_0x555a15;});return{'id':_0x956daf['id'],'shopId':_0x956daf[_0x272a89(0x1a8)],'gateway':_0x956daf[_0x272a89(0x22c)],'amount':_0x956daf[_0x272a89(0x165)],'currency':_0x956daf[_0x272a89(0x1c3)],'status':_0x956daf['status'],'orderId':_0x956daf['orderId'],'gatewayOrderId':_0x956daf[_0x272a89(0x21c)],'customerEmail':_0x956daf[_0x272a89(0x2a6)],'customerName':_0x956daf[_0x272a89(0x20b)],'customerCountry':_0x956daf[_0x272a89(0x2a7)],'customerIp':_0x956daf[_0x272a89(0x19e)],'customerUa':_0x956daf[_0x272a89(0x237)],'failureMessage':_0x956daf[_0x272a89(0x18c)],'adminNotes':_0x956daf[_0x272a89(0x1fe)],'chargebackAmount':_0x956daf[_0x272a89(0x318)],'statusChangedBy':_0x956daf['statusChangedBy'],'statusChangedAt':_0x956daf[_0x272a89(0x179)],'createdAt':_0x956daf[_0x272a89(0x1c2)],'updatedAt':_0x956daf[_0x272a89(0x2ae)],'shop':_0x956daf['shop']};}async[a53_0x3421aa(0x2cb)](_0x2a357b,_0x429aca){const _0x1feb2b=a53_0x3421aa,_0x1257fd=Math[_0x1feb2b(0x1bd)]()[_0x1feb2b(0x1ef)](0x24)[_0x1feb2b(0x23c)](0x2,0x9);console[_0x1feb2b(0x22a)](_0x1feb2b(0x23b)+_0x1257fd+',\x20userId:\x20'+_0x2a357b);const _0x40ae6d={..._0x429aca};_0x429aca['password']&&_0x429aca['password']['trim']()!==''?(console[_0x1feb2b(0x22a)](_0x1feb2b(0x245)+_0x1257fd+_0x1feb2b(0x2aa)+_0x2a357b),_0x40ae6d['password']=await bcryptjs_1[_0x1feb2b(0x1c6)]['hash'](_0x429aca[_0x1feb2b(0x30a)],0xc)):(console[_0x1feb2b(0x22a)]('üîê\x20['+_0x1257fd+_0x1feb2b(0x24a)),delete _0x40ae6d['password']);_0x429aca['fullName']&&(_0x40ae6d[_0x1feb2b(0x2b3)]=_0x429aca[_0x1feb2b(0x17d)],delete _0x40ae6d['fullName']);_0x429aca[_0x1feb2b(0x267)]&&(_0x40ae6d[_0x1feb2b(0x191)]=_0x429aca['telegramId'],delete _0x40ae6d[_0x1feb2b(0x267)]);_0x429aca[_0x1feb2b(0x30b)]&&(_0x40ae6d[_0x1feb2b(0x216)]=_0x429aca[_0x1feb2b(0x30b)],delete _0x40ae6d[_0x1feb2b(0x30b)]);if(_0x429aca[_0x1feb2b(0x306)]){const _0x2ecf2f=_0x429aca[_0x1feb2b(0x306)][_0x1feb2b(0x1af)](_0x22362f=>this[_0x1feb2b(0x301)](_0x22362f));console['log'](_0x1feb2b(0x20a),_0x429aca[_0x1feb2b(0x306)],'->',_0x2ecf2f),_0x40ae6d[_0x1feb2b(0x27e)]=JSON[_0x1feb2b(0x274)](_0x2ecf2f),delete _0x40ae6d['gateways'];}_0x429aca[_0x1feb2b(0x206)]&&(console[_0x1feb2b(0x22a)]('üîß\x20['+_0x1257fd+']\x20Gateway\x20settings\x20before\x20saving:',_0x429aca[_0x1feb2b(0x206)]),_0x40ae6d[_0x1feb2b(0x206)]=JSON[_0x1feb2b(0x274)](_0x429aca[_0x1feb2b(0x206)]),console[_0x1feb2b(0x22a)]('üîß\x20['+_0x1257fd+_0x1feb2b(0x257),_0x40ae6d[_0x1feb2b(0x206)]));_0x429aca[_0x1feb2b(0x2a3)]&&(_0x429aca[_0x1feb2b(0x2a3)][_0x1feb2b(0x1e0)]!==undefined&&(_0x40ae6d['usdtPolygonWallet']=_0x429aca[_0x1feb2b(0x2a3)]['usdtPolygonWallet']||null),_0x429aca['wallets'][_0x1feb2b(0x1f0)]!==undefined&&(_0x40ae6d[_0x1feb2b(0x1f0)]=_0x429aca['wallets'][_0x1feb2b(0x1f0)]||null),_0x429aca[_0x1feb2b(0x2a3)][_0x1feb2b(0x185)]!==undefined&&(_0x40ae6d[_0x1feb2b(0x185)]=_0x429aca['wallets']['usdtErcWallet']||null),_0x429aca[_0x1feb2b(0x2a3)]['usdcPolygonWallet']!==undefined&&(_0x40ae6d[_0x1feb2b(0x1b8)]=_0x429aca[_0x1feb2b(0x2a3)]['usdcPolygonWallet']||null),delete _0x40ae6d[_0x1feb2b(0x2a3)]);const _0x2ae79a=await database_1[_0x1feb2b(0x1c6)][_0x1feb2b(0x293)][_0x1feb2b(0x23a)]({'where':{'id':_0x2a357b},'data':_0x40ae6d,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0x1feb2b(0x22a)]('üéØ\x20['+_0x1257fd+_0x1feb2b(0x31b),_0x2ae79a[_0x1feb2b(0x206)]),{'id':_0x2ae79a['id'],'fullName':_0x2ae79a['name'],'username':_0x2ae79a[_0x1feb2b(0x30c)],'telegramId':_0x2ae79a['telegram'],'merchantUrl':_0x2ae79a[_0x1feb2b(0x216)],'gateways':_0x2ae79a[_0x1feb2b(0x27e)]?JSON[_0x1feb2b(0x1d5)](_0x2ae79a['paymentGateways']):null,'gatewaySettings':_0x2ae79a[_0x1feb2b(0x206)]?JSON[_0x1feb2b(0x1d5)](_0x2ae79a[_0x1feb2b(0x206)]):null,'publicKey':_0x2ae79a[_0x1feb2b(0x31e)],'wallets':{'usdtPolygonWallet':_0x2ae79a['usdtPolygonWallet'],'usdtTrcWallet':_0x2ae79a[_0x1feb2b(0x1f0)],'usdtErcWallet':_0x2ae79a[_0x1feb2b(0x185)],'usdcPolygonWallet':_0x2ae79a[_0x1feb2b(0x1b8)]},'status':_0x2ae79a[_0x1feb2b(0x29b)],'createdAt':_0x2ae79a['createdAt']};}async[a53_0x3421aa(0x25e)](_0x488932){const _0x290cdc=a53_0x3421aa,_0x39c732=await database_1['default'][_0x290cdc(0x293)][_0x290cdc(0x23a)]({'where':{'id':_0x488932},'data':{'status':_0x290cdc(0x2d6)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x39c732['id'],'fullName':_0x39c732[_0x290cdc(0x2b3)],'username':_0x39c732[_0x290cdc(0x30c)],'telegramId':_0x39c732[_0x290cdc(0x191)],'merchantUrl':_0x39c732[_0x290cdc(0x216)],'gateways':_0x39c732[_0x290cdc(0x27e)]?JSON[_0x290cdc(0x1d5)](_0x39c732[_0x290cdc(0x27e)]):null,'gatewaySettings':_0x39c732[_0x290cdc(0x206)]?JSON[_0x290cdc(0x1d5)](_0x39c732[_0x290cdc(0x206)]):null,'publicKey':_0x39c732[_0x290cdc(0x31e)],'wallets':{'usdtPolygonWallet':_0x39c732[_0x290cdc(0x1e0)],'usdtTrcWallet':_0x39c732[_0x290cdc(0x1f0)],'usdtErcWallet':_0x39c732[_0x290cdc(0x185)],'usdcPolygonWallet':_0x39c732[_0x290cdc(0x1b8)]},'status':_0x39c732[_0x290cdc(0x29b)],'createdAt':_0x39c732[_0x290cdc(0x1c2)]};}async[a53_0x3421aa(0x197)](_0x4c12ea){const _0x44a5f0=a53_0x3421aa,_0x4838fe=await database_1['default'][_0x44a5f0(0x293)]['update']({'where':{'id':_0x4c12ea},'data':{'status':_0x44a5f0(0x304)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4838fe['id'],'fullName':_0x4838fe[_0x44a5f0(0x2b3)],'username':_0x4838fe[_0x44a5f0(0x30c)],'telegramId':_0x4838fe[_0x44a5f0(0x191)],'merchantUrl':_0x4838fe[_0x44a5f0(0x216)],'gateways':_0x4838fe['paymentGateways']?JSON[_0x44a5f0(0x1d5)](_0x4838fe[_0x44a5f0(0x27e)]):null,'gatewaySettings':_0x4838fe[_0x44a5f0(0x206)]?JSON['parse'](_0x4838fe[_0x44a5f0(0x206)]):null,'publicKey':_0x4838fe[_0x44a5f0(0x31e)],'wallets':{'usdtPolygonWallet':_0x4838fe[_0x44a5f0(0x1e0)],'usdtTrcWallet':_0x4838fe[_0x44a5f0(0x1f0)],'usdtErcWallet':_0x4838fe['usdtErcWallet'],'usdcPolygonWallet':_0x4838fe[_0x44a5f0(0x1b8)]},'status':_0x4838fe['status'],'createdAt':_0x4838fe['createdAt']};}async['getAllUsers'](_0x5591b4){const _0x49399d=a53_0x3421aa,{page:_0x36ab07,limit:_0x2489a6,status:_0x16d62e,search:_0x4e390e}=_0x5591b4,_0xcc3ef7=(_0x36ab07-0x1)*_0x2489a6,_0x1cde9a={};_0x16d62e&&(_0x1cde9a[_0x49399d(0x29b)]=_0x16d62e[_0x49399d(0x2b9)]());_0x4e390e&&(_0x1cde9a['OR']=[{'name':{'contains':_0x4e390e,'mode':_0x49399d(0x26b)}},{'username':{'contains':_0x4e390e,'mode':_0x49399d(0x26b)}},{'telegram':{'contains':_0x4e390e,'mode':_0x49399d(0x26b)}},{'shopUrl':{'contains':_0x4e390e,'mode':_0x49399d(0x26b)}}]);const [_0xca6096,_0x36cad1]=await Promise[_0x49399d(0x1cd)]([database_1[_0x49399d(0x1c6)][_0x49399d(0x293)]['findMany']({'where':_0x1cde9a,'skip':_0xcc3ef7,'take':_0x2489a6,'orderBy':{'createdAt':_0x49399d(0x2be)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'twoFactorEnabled':!![],'createdAt':!![],'lastLoginAt':!![],'_count':{'select':{'telegramUsers':!![]}}}}),database_1[_0x49399d(0x1c6)][_0x49399d(0x293)][_0x49399d(0x160)]({'where':_0x1cde9a})]);return{'users':_0xca6096[_0x49399d(0x1af)](_0x5ba728=>{const _0x16d00e=_0x49399d,_0x1f8561=_0x5ba728[_0x16d00e(0x27e)]?JSON[_0x16d00e(0x1d5)](_0x5ba728['paymentGateways']):null,_0x1bf00a=_0x1f8561?_0x1f8561[_0x16d00e(0x1af)](_0x2f7fcb=>this[_0x16d00e(0x253)](_0x2f7fcb)):null;return{'id':_0x5ba728['id'],'fullName':_0x5ba728[_0x16d00e(0x2b3)],'username':_0x5ba728[_0x16d00e(0x30c)],'telegramId':_0x5ba728[_0x16d00e(0x191)],'merchantUrl':_0x5ba728[_0x16d00e(0x216)],'gateways':_0x1bf00a,'gatewaySettings':_0x5ba728[_0x16d00e(0x206)]?JSON[_0x16d00e(0x1d5)](_0x5ba728[_0x16d00e(0x206)]):null,'publicKey':_0x5ba728[_0x16d00e(0x31e)],'wallets':{'usdtPolygonWallet':_0x5ba728[_0x16d00e(0x1e0)],'usdtTrcWallet':_0x5ba728[_0x16d00e(0x1f0)],'usdtErcWallet':_0x5ba728['usdtErcWallet'],'usdcPolygonWallet':_0x5ba728[_0x16d00e(0x1b8)],'usdcErcWallet':_0x5ba728[_0x16d00e(0x1d8)]},'status':_0x5ba728['status'],'twoFactorEnabled':_0x5ba728[_0x16d00e(0x265)]||![],'telegramUsersCount':_0x5ba728[_0x16d00e(0x2c7)][_0x16d00e(0x190)],'createdAt':_0x5ba728[_0x16d00e(0x1c2)],'lastLoginAt':_0x5ba728['lastLoginAt']};}),'pagination':{'page':_0x36ab07,'limit':_0x2489a6,'total':_0x36cad1,'totalPages':Math['ceil'](_0x36cad1/_0x2489a6)}};}async[a53_0x3421aa(0x1bc)](_0x3b1e00){const _0x353f56=a53_0x3421aa,_0x49e943=await database_1[_0x353f56(0x1c6)][_0x353f56(0x293)][_0x353f56(0x184)]({'where':{'id':_0x3b1e00},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x49e943)return null;const _0x50806c=_0x49e943['paymentGateways']?JSON[_0x353f56(0x1d5)](_0x49e943[_0x353f56(0x27e)]):null,_0x2c9144=_0x50806c?_0x50806c[_0x353f56(0x1af)](_0x5f1d71=>this[_0x353f56(0x253)](_0x5f1d71)):null;return _0x50806c&&_0x2c9144&&console[_0x353f56(0x22a)](_0x353f56(0x2e8),_0x50806c,'->',_0x2c9144),{'id':_0x49e943['id'],'fullName':_0x49e943['name'],'username':_0x49e943['username'],'telegramId':_0x49e943[_0x353f56(0x191)],'merchantUrl':_0x49e943[_0x353f56(0x216)],'gateways':_0x2c9144,'gatewaySettings':_0x49e943[_0x353f56(0x206)]?JSON[_0x353f56(0x1d5)](_0x49e943[_0x353f56(0x206)]):null,'publicKey':_0x49e943[_0x353f56(0x31e)],'wallets':{'usdtPolygonWallet':_0x49e943[_0x353f56(0x1e0)],'usdtTrcWallet':_0x49e943[_0x353f56(0x1f0)],'usdtErcWallet':_0x49e943[_0x353f56(0x185)],'usdcPolygonWallet':_0x49e943[_0x353f56(0x1b8)],'usdcErcWallet':_0x49e943[_0x353f56(0x1d8)]},'status':_0x49e943[_0x353f56(0x29b)],'createdAt':_0x49e943[_0x353f56(0x1c2)]};}async['createUser'](_0x32e4da){const _0x8219a3=a53_0x3421aa,{fullName:_0x1bf8ed,username:_0x31beb3,password:_0x4ff0a4,telegramId:_0x366f3d,merchantUrl:_0x144316,gateways:_0x250359,gatewaySettings:_0x404593,wallets:_0x4b92e9}=_0x32e4da,_0x1bdc4d=await database_1[_0x8219a3(0x1c6)][_0x8219a3(0x293)][_0x8219a3(0x184)]({'where':{'username':_0x31beb3}});if(_0x1bdc4d)throw new Error(_0x8219a3(0x2ca));if(_0x366f3d){const _0x982ed5=await database_1[_0x8219a3(0x1c6)][_0x8219a3(0x293)][_0x8219a3(0x184)]({'where':{'telegram':_0x366f3d}});if(_0x982ed5)throw new Error(_0x8219a3(0x323));}const _0xde7ca=await bcryptjs_1[_0x8219a3(0x1c6)][_0x8219a3(0x2b4)](_0x4ff0a4,0xc),_0x196228=_0x8219a3(0x24f)+crypto_1['default'][_0x8219a3(0x1d3)](0x20)[_0x8219a3(0x1ef)](_0x8219a3(0x1d1)),_0x2d162f=_0x8219a3(0x326)+crypto_1[_0x8219a3(0x1c6)][_0x8219a3(0x1d3)](0x20)['toString']('hex'),_0x5f2fa0=_0x250359?_0x250359[_0x8219a3(0x1af)](_0x5c41c2=>this[_0x8219a3(0x301)](_0x5c41c2)):null;_0x250359&&_0x5f2fa0&&console[_0x8219a3(0x22a)](_0x8219a3(0x282),_0x250359,'->',_0x5f2fa0);const _0x17d3c9=await database_1[_0x8219a3(0x1c6)]['shop']['create']({'data':{'name':_0x1bf8ed,'username':_0x31beb3,'password':_0xde7ca,'telegram':_0x366f3d,'shopUrl':_0x144316,'paymentGateways':_0x5f2fa0?JSON[_0x8219a3(0x274)](_0x5f2fa0):null,'gatewaySettings':_0x404593?JSON['stringify'](_0x404593):null,'usdtPolygonWallet':_0x4b92e9?.[_0x8219a3(0x1e0)]||null,'usdtTrcWallet':_0x4b92e9?.[_0x8219a3(0x1f0)]||null,'usdtErcWallet':_0x4b92e9?.[_0x8219a3(0x185)]||null,'usdcPolygonWallet':_0x4b92e9?.[_0x8219a3(0x1b8)]||null,'publicKey':_0x196228,'secretKey':_0x2d162f,'status':_0x8219a3(0x304)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x17d3c9['id'],'fullName':_0x17d3c9[_0x8219a3(0x2b3)],'username':_0x17d3c9[_0x8219a3(0x30c)],'telegramId':_0x17d3c9[_0x8219a3(0x191)],'merchantUrl':_0x17d3c9[_0x8219a3(0x216)],'gateways':_0x17d3c9['paymentGateways']?JSON[_0x8219a3(0x1d5)](_0x17d3c9[_0x8219a3(0x27e)]):null,'gatewaySettings':_0x17d3c9['gatewaySettings']?JSON[_0x8219a3(0x1d5)](_0x17d3c9[_0x8219a3(0x206)]):null,'publicKey':_0x17d3c9[_0x8219a3(0x31e)],'wallets':{'usdtPolygonWallet':_0x17d3c9[_0x8219a3(0x1e0)],'usdtTrcWallet':_0x17d3c9[_0x8219a3(0x1f0)],'usdtErcWallet':_0x17d3c9[_0x8219a3(0x185)],'usdcPolygonWallet':_0x17d3c9[_0x8219a3(0x1b8)]},'status':_0x17d3c9[_0x8219a3(0x29b)],'createdAt':_0x17d3c9['createdAt']};}async['deleteUser'](_0x505ae0,_0x16ff2f){const _0x160728=a53_0x3421aa;if(config_1['config'][_0x160728(0x15f)]['twoFactorEnabled']){if(!_0x16ff2f)throw new Error('2FA\x20token\x20is\x20required');const _0x3e839e=speakeasy_1[_0x160728(0x1c6)][_0x160728(0x17a)][_0x160728(0x2d1)]({'secret':config_1[_0x160728(0x2ee)]['admin']['twoFactorSecret'],'encoding':_0x160728(0x264),'token':_0x16ff2f,'window':0x2});if(!_0x3e839e){let _0xf1aa78=![];if(config_1[_0x160728(0x2ee)][_0x160728(0x15f)]['backupCodes']){const _0x78d6d0=JSON[_0x160728(0x1d5)](config_1[_0x160728(0x2ee)][_0x160728(0x15f)][_0x160728(0x31c)]);for(let _0x1a1c6d=0x0;_0x1a1c6d<_0x78d6d0['length'];_0x1a1c6d++){const _0x409afa=await bcryptjs_1[_0x160728(0x1c6)][_0x160728(0x311)](_0x16ff2f,_0x78d6d0[_0x1a1c6d]);if(_0x409afa){_0xf1aa78=!![],_0x78d6d0['splice'](_0x1a1c6d,0x1),config_1['config'][_0x160728(0x15f)][_0x160728(0x31c)]=JSON['stringify'](_0x78d6d0);const _0x3a691f=path_1[_0x160728(0x1c6)][_0x160728(0x2e1)](process[_0x160728(0x21e)](),_0x160728(0x249));if(fs_1[_0x160728(0x1c6)][_0x160728(0x1de)](_0x3a691f)){let _0x5929f2=fs_1[_0x160728(0x1c6)][_0x160728(0x1e5)](_0x3a691f,'utf8');const _0x345d92=_0x5929f2[_0x160728(0x2c9)]('\x0a');for(let _0x14937c=0x0;_0x14937c<_0x345d92[_0x160728(0x2ea)];_0x14937c++){if(_0x345d92[_0x14937c][_0x160728(0x252)](_0x160728(0x242))){_0x345d92[_0x14937c]=_0x160728(0x242)+JSON[_0x160728(0x274)](_0x78d6d0);break;}}fs_1['default'][_0x160728(0x19a)](_0x3a691f,_0x345d92[_0x160728(0x2e1)]('\x0a'),_0x160728(0x182));}break;}}}if(!_0xf1aa78)throw new Error('Invalid\x202FA\x20token\x20or\x20backup\x20code');}}await database_1[_0x160728(0x1c6)][_0x160728(0x293)][_0x160728(0x1f4)]({'where':{'id':_0x505ae0}});}async[a53_0x3421aa(0x1f1)](_0x2407a1){const _0x563e75=a53_0x3421aa,_0x39acf4=await database_1[_0x563e75(0x1c6)][_0x563e75(0x293)]['findUnique']({'where':{'id':_0x2407a1},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});if(!_0x39acf4)throw new Error(_0x563e75(0x281));return{'usdtPolygonWallet':_0x39acf4['usdtPolygonWallet'],'usdtTrcWallet':_0x39acf4[_0x563e75(0x1f0)],'usdtErcWallet':_0x39acf4[_0x563e75(0x185)],'usdcPolygonWallet':_0x39acf4[_0x563e75(0x1b8)],'usdcErcWallet':_0x39acf4[_0x563e75(0x1d8)]};}[a53_0x3421aa(0x16d)](_0x575971=0x8){const _0x5f158d=a53_0x3421aa,_0x59468b=[];for(let _0x5cd11b=0x0;_0x5cd11b<_0x575971;_0x5cd11b++){const _0x1f28fb=crypto_1[_0x5f158d(0x1c6)][_0x5f158d(0x1d3)](0x4)['toString'](_0x5f158d(0x1d1))[_0x5f158d(0x2b9)]();_0x59468b[_0x5f158d(0x272)](_0x1f28fb);}return _0x59468b;}async['setup2FA'](_0x1b8874){const _0x2a48e9=a53_0x3421aa,_0x5c1f0e=await database_1[_0x2a48e9(0x1c6)][_0x2a48e9(0x293)][_0x2a48e9(0x184)]({'where':{'id':_0x1b8874},'select':{'id':!![],'name':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x5c1f0e)throw new Error('Shop\x20not\x20found');const _0x51ea20=speakeasy_1[_0x2a48e9(0x1c6)][_0x2a48e9(0x321)]({'name':'TrapaPay\x20('+_0x5c1f0e[_0x2a48e9(0x30c)]+')','issuer':_0x2a48e9(0x166),'length':0x20}),_0x421f4e=await qrcode_1['default'][_0x2a48e9(0x262)](_0x51ea20[_0x2a48e9(0x2a4)]),_0x430b73=this[_0x2a48e9(0x16d)](0x8),_0x386eb7=await Promise[_0x2a48e9(0x1cd)](_0x430b73[_0x2a48e9(0x1af)](_0x58c117=>bcryptjs_1[_0x2a48e9(0x1c6)]['hash'](_0x58c117,0xa)));return await database_1[_0x2a48e9(0x1c6)][_0x2a48e9(0x293)]['update']({'where':{'id':_0x1b8874},'data':{'twoFactorSecret':_0x51ea20[_0x2a48e9(0x264)],'backupCodes':JSON['stringify'](_0x386eb7)}}),console[_0x2a48e9(0x22a)](_0x2a48e9(0x194)+_0x5c1f0e['username']),console[_0x2a48e9(0x22a)]('üîë\x20Generated\x20'+_0x430b73[_0x2a48e9(0x2ea)]+_0x2a48e9(0x2d9)),{'secret':_0x51ea20[_0x2a48e9(0x264)],'qrCode':_0x421f4e,'manualEntryKey':_0x51ea20['base32'],'backupCodes':_0x430b73};}async[a53_0x3421aa(0x2ec)](_0x464082,_0x4e0026){const _0x5232ac=a53_0x3421aa,_0x237584=await database_1[_0x5232ac(0x1c6)][_0x5232ac(0x293)]['findUnique']({'where':{'id':_0x464082},'select':{'id':!![],'username':!![],'twoFactorSecret':!![],'twoFactorEnabled':!![]}});if(!_0x237584)throw new Error(_0x5232ac(0x281));if(!_0x237584[_0x5232ac(0x244)])throw new Error(_0x5232ac(0x214));if(_0x237584[_0x5232ac(0x265)])throw new Error('2FA\x20is\x20already\x20enabled');const _0x58de04=speakeasy_1[_0x5232ac(0x1c6)][_0x5232ac(0x17a)][_0x5232ac(0x2d1)]({'secret':_0x237584[_0x5232ac(0x244)],'encoding':_0x5232ac(0x264),'token':_0x4e0026,'window':0x2});if(!_0x58de04)throw new Error(_0x5232ac(0x1b5));return await database_1['default'][_0x5232ac(0x293)][_0x5232ac(0x23a)]({'where':{'id':_0x464082},'data':{'twoFactorEnabled':!![]}}),console[_0x5232ac(0x22a)]('üîê\x202FA\x20enabled\x20for\x20shop:\x20'+_0x237584[_0x5232ac(0x30c)]),{'enabled':!![]};}async[a53_0x3421aa(0x2f9)](_0x1e1947){const _0x45fe9d=a53_0x3421aa,_0x381ee9=await database_1[_0x45fe9d(0x1c6)][_0x45fe9d(0x293)][_0x45fe9d(0x184)]({'where':{'id':_0x1e1947},'select':{'id':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x381ee9)throw new Error('Shop\x20not\x20found');await database_1[_0x45fe9d(0x1c6)][_0x45fe9d(0x293)][_0x45fe9d(0x23a)]({'where':{'id':_0x1e1947},'data':{'twoFactorEnabled':![],'twoFactorSecret':null,'backupCodes':null}}),console[_0x45fe9d(0x22a)]('üîê\x202FA\x20disabled\x20for\x20shop:\x20'+_0x381ee9[_0x45fe9d(0x30c)]);}async[a53_0x3421aa(0x22b)](_0x1dc83d,_0x57219c,_0x40e8d0,_0x2467f){const _0x379cbe=a53_0x3421aa;if(_0x57219c!==_0x40e8d0)throw new Error('New\x20password\x20and\x20confirmation\x20do\x20not\x20match');if(_0x57219c[_0x379cbe(0x2ea)]<0x6)throw new Error(_0x379cbe(0x1c1));const _0xfbbb5e=await bcryptjs_1[_0x379cbe(0x1c6)][_0x379cbe(0x311)](_0x1dc83d,config_1[_0x379cbe(0x2ee)][_0x379cbe(0x15f)][_0x379cbe(0x268)]);if(!_0xfbbb5e)throw new Error(_0x379cbe(0x29f));if(config_1['config'][_0x379cbe(0x15f)][_0x379cbe(0x265)]){if(!_0x2467f)throw new Error(_0x379cbe(0x2fd));const _0x4835d6=speakeasy_1[_0x379cbe(0x1c6)][_0x379cbe(0x17a)]['verify']({'secret':config_1[_0x379cbe(0x2ee)][_0x379cbe(0x15f)][_0x379cbe(0x244)],'encoding':_0x379cbe(0x264),'token':_0x2467f,'window':0x2});if(!_0x4835d6){let _0x3cce68=![];if(config_1[_0x379cbe(0x2ee)][_0x379cbe(0x15f)][_0x379cbe(0x31c)]){const _0x5e65e1=JSON[_0x379cbe(0x1d5)](config_1['config']['admin']['backupCodes']);for(let _0x26dc86=0x0;_0x26dc86<_0x5e65e1[_0x379cbe(0x2ea)];_0x26dc86++){const _0x3f3602=await bcryptjs_1[_0x379cbe(0x1c6)]['compare'](_0x2467f,_0x5e65e1[_0x26dc86]);if(_0x3f3602){_0x3cce68=!![],_0x5e65e1[_0x379cbe(0x1e6)](_0x26dc86,0x1),config_1[_0x379cbe(0x2ee)][_0x379cbe(0x15f)]['backupCodes']=JSON[_0x379cbe(0x274)](_0x5e65e1);const _0x553fee=path_1[_0x379cbe(0x1c6)][_0x379cbe(0x2e1)](process[_0x379cbe(0x21e)](),_0x379cbe(0x249));if(fs_1[_0x379cbe(0x1c6)]['existsSync'](_0x553fee)){let _0x2c4172=fs_1[_0x379cbe(0x1c6)]['readFileSync'](_0x553fee,_0x379cbe(0x182));const _0x218301=_0x2c4172[_0x379cbe(0x2c9)]('\x0a');for(let _0x1be4b6=0x0;_0x1be4b6<_0x218301['length'];_0x1be4b6++){if(_0x218301[_0x1be4b6]['startsWith']('ADMIN_BACKUP_CODES=')){_0x218301[_0x1be4b6]='ADMIN_BACKUP_CODES='+JSON['stringify'](_0x5e65e1);break;}}fs_1[_0x379cbe(0x1c6)]['writeFileSync'](_0x553fee,_0x218301[_0x379cbe(0x2e1)]('\x0a'),'utf8');}break;}}}if(!_0x3cce68)throw new Error(_0x379cbe(0x1bf));}}const _0x49a848=await bcryptjs_1['default'][_0x379cbe(0x2b4)](_0x57219c,0xc);config_1[_0x379cbe(0x2ee)][_0x379cbe(0x15f)][_0x379cbe(0x268)]=_0x49a848;const _0x32c157=path_1['default'][_0x379cbe(0x2e1)](process[_0x379cbe(0x21e)](),'.env');let _0x4a6bbc='';if(fs_1[_0x379cbe(0x1c6)][_0x379cbe(0x1de)](_0x32c157)){_0x4a6bbc=fs_1[_0x379cbe(0x1c6)][_0x379cbe(0x1e5)](_0x32c157,_0x379cbe(0x182));const _0xacf1f4=_0x4a6bbc['split']('\x0a');let _0x498caf=![];for(let _0x502491=0x0;_0x502491<_0xacf1f4['length'];_0x502491++){if(_0xacf1f4[_0x502491][_0x379cbe(0x252)]('ADMIN_PASSWORD_HASH=')){_0xacf1f4[_0x502491]=_0x379cbe(0x2bb)+_0x49a848,_0x498caf=!![];break;}}!_0x498caf&&_0xacf1f4[_0x379cbe(0x272)]('ADMIN_PASSWORD_HASH='+_0x49a848),_0x4a6bbc=_0xacf1f4[_0x379cbe(0x2e1)]('\x0a'),fs_1['default']['writeFileSync'](_0x32c157,_0x4a6bbc,_0x379cbe(0x182));}console[_0x379cbe(0x22a)](_0x379cbe(0x2d3));}async[a53_0x3421aa(0x20c)](){const _0x5568f6=a53_0x3421aa;let _0x19ecec=0x0;if(config_1[_0x5568f6(0x2ee)][_0x5568f6(0x15f)][_0x5568f6(0x31c)])try{const _0x293a0=JSON[_0x5568f6(0x1d5)](config_1[_0x5568f6(0x2ee)]['admin'][_0x5568f6(0x31c)]);_0x19ecec=_0x293a0[_0x5568f6(0x2ea)];}catch(_0x5d0153){console[_0x5568f6(0x305)]('Error\x20parsing\x20backup\x20codes:',_0x5d0153);}return{'twoFactorEnabled':config_1[_0x5568f6(0x2ee)][_0x5568f6(0x15f)]['twoFactorEnabled'],'backupCodesCount':_0x19ecec};}async[a53_0x3421aa(0x205)](){const _0x516ada=a53_0x3421aa,_0x4af85e=speakeasy_1[_0x516ada(0x1c6)][_0x516ada(0x321)]({'name':_0x516ada(0x303)+config_1[_0x516ada(0x2ee)][_0x516ada(0x15f)][_0x516ada(0x30c)]+')','issuer':_0x516ada(0x1ec),'length':0x20}),_0x9f43e4=await qrcode_1[_0x516ada(0x1c6)][_0x516ada(0x262)](_0x4af85e['otpauth_url']),_0x4ed44b=[];for(let _0x190cd5=0x0;_0x190cd5<0x8;_0x190cd5++){const _0x2a98cb=crypto_1['default']['randomBytes'](0x4)[_0x516ada(0x1ef)](_0x516ada(0x1d1))[_0x516ada(0x2b9)]();_0x4ed44b[_0x516ada(0x272)](_0x2a98cb);}const _0x3c62b6=await Promise[_0x516ada(0x1cd)](_0x4ed44b['map'](_0x269aa0=>bcryptjs_1[_0x516ada(0x1c6)][_0x516ada(0x2b4)](_0x269aa0,0xa)));config_1[_0x516ada(0x2ee)][_0x516ada(0x15f)]['twoFactorSecret']=_0x4af85e[_0x516ada(0x264)],config_1[_0x516ada(0x2ee)][_0x516ada(0x15f)]['backupCodes']=JSON['stringify'](_0x3c62b6);const _0x4ef3f7=path_1['default'][_0x516ada(0x2e1)](process[_0x516ada(0x21e)](),_0x516ada(0x249));if(fs_1[_0x516ada(0x1c6)][_0x516ada(0x1de)](_0x4ef3f7)){let _0x3a7afe=fs_1['default'][_0x516ada(0x1e5)](_0x4ef3f7,_0x516ada(0x182));const _0x21e218=_0x3a7afe[_0x516ada(0x2c9)]('\x0a');let _0x583a55=![],_0x3388da=![];for(let _0x314440=0x0;_0x314440<_0x21e218['length'];_0x314440++){_0x21e218[_0x314440][_0x516ada(0x252)](_0x516ada(0x1fd))&&(_0x21e218[_0x314440]=_0x516ada(0x1fd)+_0x4af85e[_0x516ada(0x264)],_0x583a55=!![]),_0x21e218[_0x314440][_0x516ada(0x252)](_0x516ada(0x242))&&(_0x21e218[_0x314440]=_0x516ada(0x242)+JSON[_0x516ada(0x274)](_0x3c62b6),_0x3388da=!![]);}if(!_0x583a55)_0x21e218[_0x516ada(0x272)](_0x516ada(0x1fd)+_0x4af85e[_0x516ada(0x264)]);if(!_0x3388da)_0x21e218[_0x516ada(0x272)](_0x516ada(0x242)+JSON[_0x516ada(0x274)](_0x3c62b6));fs_1[_0x516ada(0x1c6)][_0x516ada(0x19a)](_0x4ef3f7,_0x21e218[_0x516ada(0x2e1)]('\x0a'),_0x516ada(0x182));}return console['log']('üîê\x20Admin\x202FA\x20setup\x20initiated'),console['log']('üîë\x20Generated\x20'+_0x4ed44b[_0x516ada(0x2ea)]+'\x20backup\x20codes'),{'secret':_0x4af85e[_0x516ada(0x264)],'qrCode':_0x9f43e4,'manualEntryKey':_0x4af85e[_0x516ada(0x264)],'backupCodes':_0x4ed44b};}async[a53_0x3421aa(0x1cb)](_0x2b8741){const _0x5618bd=a53_0x3421aa;if(!config_1[_0x5618bd(0x2ee)]['admin']['twoFactorSecret'])throw new Error(_0x5618bd(0x214));if(config_1['config']['admin'][_0x5618bd(0x265)])throw new Error(_0x5618bd(0x1a6));const _0x5e02d6=speakeasy_1[_0x5618bd(0x1c6)][_0x5618bd(0x17a)]['verify']({'secret':config_1[_0x5618bd(0x2ee)][_0x5618bd(0x15f)]['twoFactorSecret'],'encoding':'base32','token':_0x2b8741,'window':0x2});if(!_0x5e02d6)throw new Error(_0x5618bd(0x1b5));config_1[_0x5618bd(0x2ee)][_0x5618bd(0x15f)][_0x5618bd(0x265)]=!![];const _0x2ab980=path_1[_0x5618bd(0x1c6)][_0x5618bd(0x2e1)](process[_0x5618bd(0x21e)](),_0x5618bd(0x249));if(fs_1[_0x5618bd(0x1c6)][_0x5618bd(0x1de)](_0x2ab980)){let _0x4914c8=fs_1[_0x5618bd(0x1c6)][_0x5618bd(0x1e5)](_0x2ab980,'utf8');const _0x3a320a=_0x4914c8[_0x5618bd(0x2c9)]('\x0a');let _0x546b5f=![];for(let _0x42f9bc=0x0;_0x42f9bc<_0x3a320a[_0x5618bd(0x2ea)];_0x42f9bc++){if(_0x3a320a[_0x42f9bc][_0x5618bd(0x252)](_0x5618bd(0x238))){_0x3a320a[_0x42f9bc]='ADMIN_2FA_ENABLED=true',_0x546b5f=!![];break;}}if(!_0x546b5f)_0x3a320a[_0x5618bd(0x272)](_0x5618bd(0x1ff));fs_1[_0x5618bd(0x1c6)][_0x5618bd(0x19a)](_0x2ab980,_0x3a320a['join']('\x0a'),'utf8');}return console[_0x5618bd(0x22a)]('üîê\x20Admin\x202FA\x20enabled'),{'enabled':!![]};}async[a53_0x3421aa(0x1d2)](){const _0xc3f060=a53_0x3421aa;config_1['config'][_0xc3f060(0x15f)]['twoFactorEnabled']=![],config_1[_0xc3f060(0x2ee)][_0xc3f060(0x15f)][_0xc3f060(0x244)]='',config_1['config'][_0xc3f060(0x15f)][_0xc3f060(0x31c)]='';const _0x3f01d9=path_1['default'][_0xc3f060(0x2e1)](process[_0xc3f060(0x21e)](),'.env');if(fs_1[_0xc3f060(0x1c6)][_0xc3f060(0x1de)](_0x3f01d9)){let _0x3c69a0=fs_1[_0xc3f060(0x1c6)][_0xc3f060(0x1e5)](_0x3f01d9,_0xc3f060(0x182));const _0x540401=_0x3c69a0[_0xc3f060(0x2c9)]('\x0a');for(let _0x25cd0b=0x0;_0x25cd0b<_0x540401[_0xc3f060(0x2ea)];_0x25cd0b++){_0x540401[_0x25cd0b][_0xc3f060(0x252)](_0xc3f060(0x238))&&(_0x540401[_0x25cd0b]=_0xc3f060(0x2dd)),_0x540401[_0x25cd0b][_0xc3f060(0x252)]('ADMIN_2FA_SECRET=')&&(_0x540401[_0x25cd0b]=_0xc3f060(0x1fd)),_0x540401[_0x25cd0b][_0xc3f060(0x252)](_0xc3f060(0x242))&&(_0x540401[_0x25cd0b]=_0xc3f060(0x242));}fs_1[_0xc3f060(0x1c6)]['writeFileSync'](_0x3f01d9,_0x540401[_0xc3f060(0x2e1)]('\x0a'),'utf8');}console['log'](_0xc3f060(0x199));}[a53_0x3421aa(0x1ea)](_0x3740a3,_0x2a2b3c,_0x221c89){const _0x5fa829=a53_0x3421aa,_0x2be85d=new Map(),_0x421498=new Date(_0x2a2b3c);while(_0x421498<=_0x221c89){const _0x43ec70=_0x421498[_0x5fa829(0x2e3)]()[_0x5fa829(0x2c9)]('T')[0x0];_0x2be85d[_0x5fa829(0x290)](_0x43ec70,{'revenue':0x0,'count':0x0}),_0x421498[_0x5fa829(0x16f)](_0x421498['getDate']()+0x1);}for(const _0x2e5293 of _0x3740a3){const _0x567cb9=_0x2e5293['createdAt']['toISOString']()[_0x5fa829(0x2c9)]('T')[0x0],_0x2c3fd6=_0x2be85d['get'](_0x567cb9);_0x2c3fd6&&(_0x2c3fd6[_0x5fa829(0x160)]+=0x1,_0x2e5293[_0x5fa829(0x29b)]===_0x5fa829(0x225)&&(_0x2e5293[_0x5fa829(0x212)]?_0x2c3fd6[_0x5fa829(0x1db)]+=_0x2e5293[_0x5fa829(0x212)]:console[_0x5fa829(0x22a)](_0x5fa829(0x2d0)+_0x2e5293['id']+_0x5fa829(0x24d))));}const _0xeefd70=[],_0xb23d2d=[];for(const [_0x49cc2b,_0x3da43e]of _0x2be85d){_0xeefd70['push']({'date':_0x49cc2b,'amount':Math['round'](_0x3da43e[_0x5fa829(0x1db)]*0x64)/0x64}),_0xb23d2d['push']({'date':_0x49cc2b,'count':_0x3da43e['count']});}return{'dailyRevenue':_0xeefd70,'dailyPayments':_0xb23d2d};}async[a53_0x3421aa(0x1e4)](_0x3cf34e){const _0x536903=a53_0x3421aa;console[_0x536903(0x22a)](_0x536903(0x30e),_0x3cf34e);const _0x56b4d8=new Date(_0x3cf34e[_0x536903(0x201)]),_0x26b66f=new Date(_0x3cf34e['periodTo']),_0x52a51a=new Date(Date['UTC'](_0x56b4d8[_0x536903(0x1c0)](),_0x56b4d8[_0x536903(0x313)](),_0x56b4d8['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x290976=new Date(Date[_0x536903(0x2ff)](_0x26b66f[_0x536903(0x1c0)](),_0x26b66f[_0x536903(0x313)](),_0x26b66f[_0x536903(0x211)](),0x17,0x3b,0x3b,0x3e7));console['log'](_0x536903(0x1ba)+_0x52a51a[_0x536903(0x2e3)]()+_0x536903(0x1a9)+_0x290976[_0x536903(0x2e3)]()),console[_0x536903(0x22a)]('üîå\x20Gateway:\x20'+_0x3cf34e[_0x536903(0x22c)]);const _0x123f10=await database_1[_0x536903(0x1c6)][_0x536903(0x27a)][_0x536903(0x28e)]({'where':{'status':_0x536903(0x225),'gateway':_0x3cf34e[_0x536903(0x22c)][_0x536903(0x1e7)](),'createdAt':{'gte':_0x52a51a,'lte':_0x290976}},'select':{'id':!![],'shopId':!![],'amountAfterGatewayCommissionUSDT':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console[_0x536903(0x22a)]('üí∞\x20Found\x20'+_0x123f10['length']+'\x20paid\x20payments\x20for\x20gateway\x20'+_0x3cf34e[_0x536903(0x22c)]);const _0x2e9c99=new Map();for(const _0x1c108d of _0x123f10){const _0x11e8ab=_0x1c108d[_0x536903(0x213)]||0x0;if(_0x11e8ab<=0x0){console[_0x536903(0x2d8)]('‚ö†Ô∏è\x20Payment\x20'+_0x1c108d['id']+'\x20has\x20zero\x20or\x20null\x20merchant\x20amount,\x20skipping...');continue;}if(_0x2e9c99[_0x536903(0x178)](_0x1c108d['shopId'])){const _0x50b0a6=_0x2e9c99[_0x536903(0x259)](_0x1c108d[_0x536903(0x1a8)]);_0x50b0a6[_0x536903(0x2e6)]+=_0x11e8ab;}else _0x2e9c99[_0x536903(0x290)](_0x1c108d[_0x536903(0x1a8)],{'merchantId':_0x1c108d[_0x536903(0x293)]['id'],'merchantName':_0x1c108d['shop']['name'],'merchantUsername':_0x1c108d[_0x536903(0x293)][_0x536903(0x30c)],'totalAmount':_0x11e8ab});}const _0x2f1c77=Array[_0x536903(0x170)](_0x2e9c99[_0x536903(0x243)]())[_0x536903(0x1af)](_0x59a6c1=>({'merchantId':_0x59a6c1[_0x536903(0x2da)],'merchantName':_0x59a6c1[_0x536903(0x2b8)],'merchantUsername':_0x59a6c1[_0x536903(0x2e5)],'gateway':_0x3cf34e[_0x536903(0x22c)],'periodFrom':_0x3cf34e[_0x536903(0x201)],'periodTo':_0x3cf34e['periodTo'],'totalAmount':Math['round'](_0x59a6c1['totalAmount']*0x64)/0x64}));return _0x2f1c77[_0x536903(0x1fa)]((_0x2ff9fc,_0x489ea2)=>_0x489ea2['totalAmount']-_0x2ff9fc[_0x536903(0x2e6)]),console[_0x536903(0x22a)](_0x536903(0x2f4)+_0x2f1c77['length']+_0x536903(0x221)),_0x2f1c77;}async[a53_0x3421aa(0x2f6)](_0x4f39ac,_0x1e9708,_0x27ee72){const _0x20d60b=a53_0x3421aa,_0x10ad2f=await database_1['default'][_0x20d60b(0x293)][_0x20d60b(0x184)]({'where':{'id':_0x4f39ac}});if(!_0x10ad2f)throw new Error(_0x20d60b(0x1eb));await database_1[_0x20d60b(0x1c6)][_0x20d60b(0x275)](async _0x5a244c=>{const _0x4a3901=_0x20d60b;await _0x5a244c[_0x4a3901(0x27a)][_0x4a3901(0x23e)]({'data':{'shopId':_0x10ad2f['id'],'amount':_0x1e9708,'amountUSDT':_0x1e9708,'amountAfterGatewayCommissionUSDT':_0x1e9708,'sourceCurrency':_0x4a3901(0x1b9),'currency':_0x4a3901(0x1b9),'status':_0x4a3901(0x225),'gateway':_0x4a3901(0x215),'customerName':_0x10ad2f[_0x4a3901(0x30c)],'customerEmail':'@'+_0x10ad2f['telegram'],'paymentMethod':'CRYPTO','adminNotes':_0x27ee72||null,'successUrl':'-','failUrl':'-','paidAt':new Date()}}),await _0x5a244c[_0x4a3901(0x293)][_0x4a3901(0x23a)]({'where':{'id':_0x10ad2f['id']},'data':{'balance':{'increment':_0x1e9708}}});}),console[_0x20d60b(0x22a)](_0x20d60b(0x2de)+_0x1e9708+_0x20d60b(0x273)+_0x10ad2f['username']);}}exports[a53_0x3421aa(0x18a)]=AdminService;function a53_0x4ae2(){const _0x404b4e=['pendingUrl','üîç\x20Selected\x20erc20_usdc\x20wallet:\x20','KLYME\x20GB','üîÑ\x20Gateway\x20mapping:','customerName','get2FASettings','‚úÖ\x20Payout\x20created\x20in\x20DB:','klyme_de','includes','\x20\x20\x20ÔøΩüìä\x20Total\x20payments:\x20','getUTCDate','amountUSDT','amountAfterGatewayCommissionUSDT','2FA\x20not\x20set\x20up.\x20Please\x20call\x20setup\x20endpoint\x20first','Deposit','shopUrl','updatePayout','__esModule','localeCompare','üìã\x20Found\x20','\x20\x20\x20üí≥\x20Total\x20payments:\x20','gatewayOrderId','üìä\x20Statistics\x20PAID\x20payments\x20count:\x20','cwd','üí∞\x20[PAYOUT]\x20Gateway\x20','getMerchantStatistics','\x20merchants','üîÑ\x20Admin\x20updating\x20payment\x20','\x20-\x20','slice','PAID','abs','groupBy','noda','setUTCDate','log','changeAdminPassword','gateway','\x20\x20\x20Current\x20amount:\x20','\x20\x20\x20Shop\x20totalPaidOut:\x20','floor','\x20\x20\x20üåç\x20Country:\x20','Amer','toLocaleDateString','updatePaymentStatus','\x20\x20\x20Available\x20(number):\x20','\x20\x20\x20Current\x20network:\x20','\x20USDT\x20(gross\x20revenue)','customerUa','ADMIN_2FA_ENABLED=','2195598dauPoi','update','üéØ\x20updateUser\x20called\x20with\x20ID:\x20','substr','periodTo','create','Visa/MasterCard','currencyService','commissionUSDT','ADMIN_BACKUP_CODES=','values','twoFactorSecret','üîê\x20[','\x27\x20to\x20name\x20\x27','üí∞\x20Current\x20shop\x20balance:\x20','failUrl','.env',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','qrcode','totalPayments','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','getAllPayments','pk_','0000','üí∞\x20Updating\x20payout\x20','startsWith','getGatewayDisplayName','\x20\x20\x20Gateway:\x20','üîç\x20Balance\x20check\x20details:','‚úÖ\x20Using\x20wallet\x20from\x20request:\x20',']\x20Gateway\x20settings\x20JSON\x20string:','test_gateway','get','KLYME\x20EU','\x20\x20\x20ü§î\x20Difference:\x20','balance','Test\x20Gateway','suspendUser','toFixed','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','averageCommissionRate','toDataURL','\x20\x20\x20üí∞\x20Total\x20payout:\x20','base32','twoFactorEnabled','‚ö†Ô∏è\x20Requested\x20gateway\x20\x27','telegramId','passwordHash','wallet','üìä\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20','insensitive','\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...','turnoverUSDT','\x20\x20\x20‚è≥\x20Pending\x20payout:\x20','sendPayoutNotification','\x20merchants\x20for\x20selection','asc','push','\x20USDC\x20to\x20merchant\x20','stringify','$transaction','dateTo','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','üìä\x20Statistics\x20WHERE\x20conditions:','üìä\x20Sorting\x20payments\x20by\x20','payment','setHours','totalTurnover','AmPay\x20TRY','paymentGateways','\x20\x20\x20Requested\x20(number):\x20','trc20','Shop\x20not\x20found','üîÑ\x20Gateway\x20mapping\x20(create):','\x20USDT\x20for\x20payment\x20','2428ngznZH','klyme_eu','\x20USDT\x20(theoretical\x20net)','‚úÖ\x20Payout\x20','üîÑ\x20Converted\x20gateway\x20name\x20\x27','USDT','successUrl','\x20merchants\x20with\x20rounded\x20balance\x20!=\x200.00\x20(excluding\x20balances\x20that\x20round\x20to\x200.00)','\x20USDT\x20(after\x20','\x20->\x20','findMany','\x20\x20\x20Full\x20amount:\x20','set','cointopay2','Payment\x20not\x20found','shop','\x20payments)','2036628bUWHEF','\x20\x20\x20Available\x20(raw):\x20','getFullYear','turnover','\x20\x20\x20üåê\x20IP:\x20','üìä\x20Calculating\x20payout\x20statistics...','status','üîÑ\x20Updating\x20customer\x20data\x20for\x20payment\x20','\x20for\x20shop\x20','getMerchantsAwaitingPayout','Current\x20password\x20is\x20incorrect','4635KNaCwe','2275656fSAEUq','\x20\x20\x20üè™\x20Gateway\x20earnings:\x20','wallets','otpauth_url','notes','customerEmail','customerCountry','üí∞\x20Found\x20','getPayoutById',']\x20Updating\x20password\x20for\x20user\x20','\x27\x20->\x20name\x20\x27','thisMonth','\x20USDT\x20(+','updatedAt','üìÖ\x20Payout\x20date\x20to\x20filter:\x20','üîç\x20Selected\x20trc20\x20wallet:\x20','üí∞\x20[PAYOUT]\x20Merchant\x20','‚úÖ\x20Payout\x20created:\x20','name','hash','\x20USDT\x20(','./telegramBotService','paymentsCount','merchantName','toUpperCase','date','ADMIN_PASSWORD_HASH=','merchantEarningsUSDT','../types/gateway','desc','averageCheckUSDT','üí∞\x20Creating\x20payout\x20for\x20shop\x20','network','üîÑ\x20Converted\x20gateway\x20ID\x20\x27','totalAmountUSDT','–ù–µ\x20—É–∫–∞–∑–∞–Ω','üîÑ\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','\x20\x20\x20Balance:\x20','_count','üìÖ\x20Date\x20from\x20filter:\x20','split','Username\x20already\x20exists','updateUser','entries','period','\x20\x20\x20üñ•Ô∏è\x20User\x20Agent:\x20','\x20USDT\x20-\x20will\x20deduct\x20from\x20balance','‚ö†Ô∏è\x20Payment\x20','verify','totalPaidOut','üîê\x20Admin\x20password\x20changed\x20successfully','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','getMerchantsSelection','SUSPENDED','üìä\x20Getting\x20merchant\x20statistics\x20with\x20filters:','warn','\x20backup\x20codes','merchantId','\x20USDT\x20from\x20balance','plisio','ADMIN_2FA_ENABLED=false','‚úÖ\x20Deposited\x20','\x20\x20\x20Current\x20balance:\x20','paidAt','join','\x20\x20\x20Total\x20paid\x20out:\x20','toISOString','‚ö†Ô∏è\x20CHARGEBACK\x20without\x20penalty\x20amount\x20-\x20no\x20balance\x20change','merchantUsername','totalAmount','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','üîÑ\x20Gateway\x20mapping\x20(get):','110CLgRCJ','length','\x20USDT\x20(rounded\x20to\x202\x20decimal\x20places)','enable2FA','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','config','this_week','\x20\x20\x20üìÖ\x20Total\x20payouts\x20(this\x20month):\x20','\x20with\x20payout\x20history','üìÖ\x20Date\x20to\x20filter:\x20','dateFrom','üìä\x20Generated\x20reports\x20for\x20','replace','depositBalance','üì±\x20Telegram\x20notification\x20sent\x20for\x20payout\x20','‚úÖ\x20Using\x20gateway\x20filter:\x20\x27','disable2FA','Rapyd','this_month','\x20USDT,\x20merchant:\x20','2FA\x20token\x20is\x20required','txid','UTC','\x20\x20\x20Added\x20to\x20balance:\x20+','getGatewayInternalName','üîç\x20Initial\x20wallet\x20from\x20request:\x20','TrapaPay\x20Admin\x20(','ACTIVE','error','gateways','KLYME\x20DE','custom','totalAmountAfterCommissionUSDT','password','merchantUrl','username','\x27\x20(from\x20\x27','üìä\x20Getting\x20payout\x20reports\x20with\x20filters:','getTime','./currencyService','compare','üìä\x20Total\x20payments\x20(including\x20failed):\x20','getUTCMonth','\x20USDT\x20(total\x20paid\x20to\x20merchants)','paidOutUSDT','month','üìä\x20Available\x20gateways\x20in\x20database:','chargebackAmount','round','\x20\x20\x20New\x20amount:\x20',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','backupCodes','totalPayout','publicKey','not\x20provided','\x20USDT\x20-\x20will\x20return\x20to\x20balance','generateSecret','gatewayEarnings','Telegram\x20username\x20already\x20exists','4201353qCTXdp','erc20_usdc','sk_','admin','count','üìä\x20Merchant\x20statistics\x20calculated:','ru-RU','commission','üìã\x20Getting\x20merchants\x20selection\x20list...','amount','TrapaPay','%\x20commission)','telegramBotService','orderId','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','\x20USDT,\x20Difference:\x20','last_week','generateBackupCodes','AmPay','setDate','from','../config/config','üîç\x20Using\x20gateway\x20\x27','custom_','merchantEarnings','üí∏\x20CHARGEBACK\x20penalty\x20ONLY:\x20-','MaxPara','\x20USDT\x20(current\x20balance\x20in\x20DB)','has','statusChangedAt','totp','defineProperty','some','fullName','Insufficient\x20balance\x20for\x20amount\x20increase.\x20Available:\x20','\x20balance\x20updated:\x20','\x27\x20->\x20ID\x20\x27','Interac','utf8','üìä\x20Calculated\x20commission\x20rate\x20for\x20payment\x20','findUnique','usdtErcWallet','aggregate','erc20','gatewayCommissionRate','filter','AdminService',',\x20refunds:\x20','failureMessage','\x20\x20\x20‚úÖ\x20Total\x20net\x20balances:\x20','üîç\x20Shop\x20wallets:','3746246eVdAMm','telegramUsers','telegram','OxaPay','\x20USDT\x20(already\x20paid\x20out)','üîê\x202FA\x20setup\x20initiated\x20for\x20shop:\x20','gte','yesterday','activateUser','Error\x20processing\x20payment\x20','üîê\x20Admin\x202FA\x20disabled','writeFileSync','lastMonth','getMonth','COMPLETED','customerIp','ceil','_sum','üîç\x20Selected\x20polygon_usdc\x20wallet:\x20','totalCommissionRate','getSystemStatistics','NONEXISTENT_GATEWAY_FILTER','getUTCDay','2FA\x20is\x20already\x20enabled','MasterCard','shopId','\x20to\x20','lte','forEach','deletePayout','getGatewayIdByName','min','map','klyme_gb','reduce','not\x20set','\x20balance\x20updated:','üìä\x20Final\x20WHERE\x20conditions:','Invalid\x202FA\x20token','not\x20specified',',\x20chargebacks:\x20','usdcPolygonWallet','USDC','üìÖ\x20Period:\x20','findFirst','getUserById','random','‚úÖ\x20Customer\x20data\x20updated\x20for\x20payment\x20','Invalid\x202FA\x20token\x20or\x20backup\x20code','getUTCFullYear','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','createdAt','currency','\x20\x20\x20üí∞\x20Total\x20turnover:\x20','Insufficient\x20balance.\x20Available:\x20','default','\x20\x20\x20üíµ\x20Available\x20balance:\x20','\x20\x20\x20Transaction\x20hash:\x20','InstaXchange','üìä\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','enableAdmin2FA','CoinToPay','all','üìä\x20Getting\x20payments\x20with\x20filters:','\x20\x20\x20Final\x20payout\x20amount\x20used:\x20','\x20\x20\x20Amount\x20difference:\x20','hex','disableAdmin2FA','randomBytes','üí±\x20Currency\x20filter\x20applied:\x20','parse','\x27\x20not\x20found.\x20Available\x20gateways:\x20','externalPaymentUrl','usdcErcWallet','REFUND','Sepa','revenue','üìä\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','getGatewayNameById','existsSync','üìä\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','usdtPolygonWallet','\x20\x20\x20Amount\x20increased\x20by\x20','last_month','today','getPayoutReports','readFileSync','splice','toLowerCase','pendingPayout','\x20USDT','generateDailyStatistics','Merchant\x20not\x20found','TrapaPay\x20Admin','üìÖ\x20Payout\x20date\x20from\x20filter:\x20',',\x20Commission:\x20','toString','usdtTrcWallet','getShopWallets','567RGVTRc','üí≥\x20Final\x20payout\x20wallet\x20for\x20','delete',':\x20commission\x20=\x20','\x20USDT,\x20Requested:\x20','payout','\x20paid\x20payments\x20for\x20analysis','üìä\x20Payout\x20statistics\x20calculated:','sort','üí∞\x20Shop\x20','convertToUSDT','ADMIN_2FA_SECRET=','adminNotes','ADMIN_2FA_ENABLED=true','crypto','periodFrom','\x20USDT\x20(same\x20as\x20awaiting)','CHARGEBACK','üìä\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','setupAdmin2FA','gatewaySettings'];a53_0x4ae2=function(){return _0x404b4e;};return a53_0x4ae2();}