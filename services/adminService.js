'use strict';function a35_0x10ca(_0x19463b,_0x551db6){const _0x41fffc=a35_0x41ff();return a35_0x10ca=function(_0x10caa2,_0x1d6331){_0x10caa2=_0x10caa2-0x14c;let _0x352ca3=_0x41fffc[_0x10caa2];return _0x352ca3;},a35_0x10ca(_0x19463b,_0x551db6);}const a35_0x5cf0fd=a35_0x10ca;(function(_0x2f5455,_0x838d73){const _0x2ca676=a35_0x10ca,_0x29607a=_0x2f5455();while(!![]){try{const _0xc4d592=-parseInt(_0x2ca676(0x201))/0x1+-parseInt(_0x2ca676(0x1c9))/0x2+parseInt(_0x2ca676(0x233))/0x3+-parseInt(_0x2ca676(0x25e))/0x4+-parseInt(_0x2ca676(0x238))/0x5*(parseInt(_0x2ca676(0x20e))/0x6)+parseInt(_0x2ca676(0x1e0))/0x7+parseInt(_0x2ca676(0x1fe))/0x8;if(_0xc4d592===_0x838d73)break;else _0x29607a['push'](_0x29607a['shift']());}catch(_0x25d3e9){_0x29607a['push'](_0x29607a['shift']());}}}(a35_0x41ff,0xd3835));var __importDefault=this&&this[a35_0x5cf0fd(0x25b)]||function(_0x264544){const _0x2cafb0=a35_0x5cf0fd;return _0x264544&&_0x264544[_0x2cafb0(0x205)]?_0x264544:{'default':_0x264544};};Object[a35_0x5cf0fd(0x207)](exports,a35_0x5cf0fd(0x205),{'value':!![]}),exports[a35_0x5cf0fd(0x21b)]=void 0x0;const database_1=__importDefault(require('../config/database')),bcryptjs_1=__importDefault(require(a35_0x5cf0fd(0x1fd))),crypto_1=__importDefault(require(a35_0x5cf0fd(0x204))),currencyService_1=require('./currencyService'),gateway_1=require(a35_0x5cf0fd(0x198));class AdminService{async['getPayoutStats'](){const _0xae4d04=a35_0x5cf0fd;console['log'](_0xae4d04(0x244));const _0x354623=await database_1[_0xae4d04(0x14c)][_0xae4d04(0x17b)]['aggregate']({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0xae4d04(0x25f)}}),_0x83e817=await this[_0xae4d04(0x24d)]({'page':0x1,'limit':0x3e8}),_0xdb6a4e=new Date(),_0x12169a=new Date(_0xdb6a4e['getFullYear'](),_0xdb6a4e[_0xae4d04(0x1d3)](),0x1),_0x24c2d7=new Date(_0xdb6a4e[_0xae4d04(0x1d0)](),_0xdb6a4e['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x168fce=await database_1[_0xae4d04(0x14c)][_0xae4d04(0x231)][_0xae4d04(0x1e8)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x12169a,'lte':_0x24c2d7},'status':_0xae4d04(0x22c)}}),_0x4abcee=_0x354623['_sum'][_0xae4d04(0x224)]||0x0,_0x11a981=_0x83e817[_0xae4d04(0x234)][_0xae4d04(0x1b7)],_0x348f5c=_0x168fce[_0xae4d04(0x1d8)][_0xae4d04(0x252)]||0x0,_0x34cd91={'totalPayout':Math[_0xae4d04(0x1b6)](_0x4abcee*0x64)/0x64,'awaitingPayout':Math[_0xae4d04(0x1b6)](_0x11a981*0x64)/0x64,'thisMonth':Math[_0xae4d04(0x1b6)](_0x348f5c*0x64)/0x64,'availableBalance':Math['round'](_0x11a981*0x64)/0x64};return console[_0xae4d04(0x191)]('📊\x20Payout\x20statistics\x20calculated:'),console[_0xae4d04(0x191)](_0xae4d04(0x1d7)+_0x34cd91['totalPayout']+_0xae4d04(0x1ad)),console[_0xae4d04(0x191)](_0xae4d04(0x154)+_0x34cd91[_0xae4d04(0x21a)]+'\x20USDT\x20(with\x20commission\x20deducted)'),console[_0xae4d04(0x191)](_0xae4d04(0x1bd)+_0x34cd91[_0xae4d04(0x219)]+'\x20USDT\x20(same\x20as\x20awaiting)'),console[_0xae4d04(0x191)](_0xae4d04(0x158)+_0x34cd91[_0xae4d04(0x180)]+_0xae4d04(0x1df)),console['log']('\x20\x20\x20🔍\x20Raw\x20balance\x20sum:\x20'+(_0x354623[_0xae4d04(0x1d8)]['balance']||0x0)[_0xae4d04(0x202)](0x2)+'\x20USDT\x20(without\x20commission)'),console['log'](_0xae4d04(0x19a)+((_0x354623['_sum'][_0xae4d04(0x1c3)]||0x0)-_0x11a981)[_0xae4d04(0x202)](0x2)+_0xae4d04(0x1df)),_0x34cd91;}async['updateCustomerData'](_0x5aa24b,_0x52d74b){const _0x5ef76e=a35_0x5cf0fd;console[_0x5ef76e(0x191)](_0x5ef76e(0x1be)+_0x5aa24b+':',_0x52d74b);const _0xa74ee1=await database_1[_0x5ef76e(0x14c)][_0x5ef76e(0x220)][_0x5ef76e(0x1ae)]({'where':{'id':_0x5aa24b},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0xa74ee1)throw new Error(_0x5ef76e(0x1f8));const _0x2fe1cf={};_0x52d74b['customerCountry']!==undefined&&(_0x2fe1cf['customerCountry']=_0x52d74b[_0x5ef76e(0x1ba)]||null);_0x52d74b['customerIp']!==undefined&&(_0x2fe1cf[_0x5ef76e(0x177)]=_0x52d74b[_0x5ef76e(0x177)]||null);_0x52d74b[_0x5ef76e(0x190)]!==undefined&&(_0x2fe1cf['customerUa']=_0x52d74b[_0x5ef76e(0x190)]||null);const _0x168883=await database_1[_0x5ef76e(0x14c)][_0x5ef76e(0x220)][_0x5ef76e(0x25a)]({'where':{'id':_0x5aa24b},'data':{..._0x2fe1cf,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x5ef76e(0x191)](_0x5ef76e(0x240)+_0x5aa24b),console[_0x5ef76e(0x191)](_0x5ef76e(0x255)+_0xa74ee1['customerCountry']+_0x5ef76e(0x1a2)+_0x168883[_0x5ef76e(0x1ba)]),console[_0x5ef76e(0x191)](_0x5ef76e(0x157)+_0xa74ee1[_0x5ef76e(0x177)]+_0x5ef76e(0x1a2)+_0x168883[_0x5ef76e(0x177)]),console['log']('\x20\x20\x20🖥️\x20User\x20Agent:\x20'+(_0xa74ee1[_0x5ef76e(0x190)]?_0x5ef76e(0x17f):'not\x20set')+_0x5ef76e(0x1a2)+(_0x168883[_0x5ef76e(0x190)]?'set':_0x5ef76e(0x229))),_0x168883;}async['getSystemStatistics'](_0x1eaf96){const _0x10ac00=a35_0x5cf0fd,_0x4b73ae=new Date();let _0x52003f;switch(_0x1eaf96){case'7d':_0x52003f=new Date(_0x4b73ae[_0x10ac00(0x14d)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x10ac00(0x214):_0x52003f=new Date(_0x4b73ae[_0x10ac00(0x14d)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'90d':_0x52003f=new Date(_0x4b73ae[_0x10ac00(0x14d)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x10ac00(0x151):const _0x33bb19=await database_1[_0x10ac00(0x14c)][_0x10ac00(0x220)][_0x10ac00(0x1b2)]({'where':{'gateway':{'not':_0x10ac00(0x218)}},'orderBy':{'createdAt':_0x10ac00(0x1ea)},'select':{'createdAt':!![]}});_0x52003f=_0x33bb19?_0x33bb19[_0x10ac00(0x172)]:new Date(_0x10ac00(0x1a6)),console[_0x10ac00(0x191)](_0x10ac00(0x1a5)+_0x52003f[_0x10ac00(0x19f)]());break;default:_0x52003f=new Date(_0x4b73ae['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x28f7aa,_0x112eec,_0x26ffde,_0xae1fa5,_0x1a8fa8,_0x544d9e,_0x26a08a]=await Promise['all']([database_1[_0x10ac00(0x14c)]['shop'][_0x10ac00(0x1db)](),database_1['default'][_0x10ac00(0x17b)][_0x10ac00(0x1db)]({'where':{'status':_0x10ac00(0x25f)}}),database_1[_0x10ac00(0x14c)][_0x10ac00(0x220)][_0x10ac00(0x1db)]({'where':{'createdAt':{'gte':_0x52003f},'gateway':{'not':_0x10ac00(0x218)}}}),database_1[_0x10ac00(0x14c)][_0x10ac00(0x220)][_0x10ac00(0x1db)]({'where':{'status':'PAID','createdAt':{'gte':_0x52003f},'gateway':{'not':_0x10ac00(0x218)}}}),database_1['default'][_0x10ac00(0x220)]['findMany']({'where':{'status':_0x10ac00(0x251),'createdAt':{'gte':_0x52003f},'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![]}}),database_1[_0x10ac00(0x14c)]['payment']['findMany']({'where':{'gateway':{'not':'test_gateway'}},'take':0xa,'orderBy':{'createdAt':_0x10ac00(0x259)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x10ac00(0x14c)][_0x10ac00(0x220)][_0x10ac00(0x1ee)]({'where':{'createdAt':{'gte':_0x52003f},'gateway':{'not':_0x10ac00(0x218)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x2921dd=0x0;for(const _0x5c497c of _0x1a8fa8){const _0x4881b1=await currencyService_1[_0x10ac00(0x155)]['convertToUSDT'](_0x5c497c[_0x10ac00(0x252)],_0x5c497c[_0x10ac00(0x1ce)]);_0x2921dd+=_0x4881b1;}const _0x582448=this[_0x10ac00(0x15d)](_0x26a08a,_0x52003f,_0x4b73ae),_0xa5a24a=_0x26ffde>0x0?_0xae1fa5/_0x26ffde*0x64:0x0;return{'totalShops':_0x28f7aa,'activeShops':_0x112eec,'totalPayments':_0x26ffde,'successfulPayments':_0xae1fa5,'totalRevenue':Math['round'](_0x2921dd*0x64)/0x64,'conversionRate':Math[_0x10ac00(0x1b6)](_0xa5a24a*0x64)/0x64,'dailyRevenue':_0x582448[_0x10ac00(0x15b)],'dailyPayments':_0x582448[_0x10ac00(0x175)],'recentPayments':_0x544d9e[_0x10ac00(0x1cb)](_0x1e7d24=>({'id':_0x1e7d24['id'],'amount':_0x1e7d24[_0x10ac00(0x252)],'currency':_0x1e7d24['currency'],'status':_0x1e7d24[_0x10ac00(0x1eb)],'gateway':_0x1e7d24[_0x10ac00(0x1a8)],'shop':_0x1e7d24['shop'],'createdAt':_0x1e7d24[_0x10ac00(0x172)]}))};}async[a35_0x5cf0fd(0x160)](_0x37fced){const _0x2333ad=a35_0x5cf0fd;console['log'](_0x2333ad(0x192),_0x37fced);let _0x568a4a,_0x1bd59c=new Date();if(_0x37fced[_0x2333ad(0x170)]===_0x2333ad(0x167)&&_0x37fced[_0x2333ad(0x245)]&&_0x37fced[_0x2333ad(0x236)])_0x568a4a=new Date(_0x37fced[_0x2333ad(0x245)]),_0x1bd59c=new Date(_0x37fced[_0x2333ad(0x236)]);else{const _0x42d1c5=new Date();switch(_0x37fced[_0x2333ad(0x170)]){case'week':_0x568a4a=new Date(_0x42d1c5[_0x2333ad(0x14d)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x2333ad(0x200):_0x568a4a=new Date(_0x42d1c5[_0x2333ad(0x14d)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x2333ad(0x1b8):_0x568a4a=new Date(_0x42d1c5[_0x2333ad(0x14d)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x2333ad(0x151):default:_0x568a4a=new Date(_0x2333ad(0x1a6));break;}}console[_0x2333ad(0x191)](_0x2333ad(0x18d)+_0x568a4a['toISOString']()+'\x20to\x20'+_0x1bd59c[_0x2333ad(0x19f)]());const _0x149c2a={'status':_0x2333ad(0x251),'gateway':{'not':_0x2333ad(0x218)},'paidAt':{'gte':_0x568a4a,'lte':_0x1bd59c}};_0x37fced[_0x2333ad(0x226)]&&(_0x149c2a[_0x2333ad(0x226)]=_0x37fced['shopId']);const _0xf6d278=await database_1[_0x2333ad(0x14c)][_0x2333ad(0x220)]['findMany']({'where':_0x149c2a,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console['log'](_0x2333ad(0x187)+_0xf6d278[_0x2333ad(0x16a)]+'\x20paid\x20payments\x20for\x20analysis');const _0x3eaf92={'gateway':{'not':_0x2333ad(0x218)},'createdAt':{'gte':_0x568a4a,'lte':_0x1bd59c}};_0x37fced[_0x2333ad(0x226)]&&(_0x3eaf92[_0x2333ad(0x226)]=_0x37fced[_0x2333ad(0x226)]);const _0x3955f8=await database_1[_0x2333ad(0x14c)][_0x2333ad(0x220)]['count']({'where':_0x3eaf92});console[_0x2333ad(0x191)]('📊\x20Total\x20payments\x20(including\x20failed):\x20'+_0x3955f8+',\x20successful:\x20'+_0xf6d278['length']);let _0x5e78cc=0x0,_0x16b102=0x0,_0x4f4ed4=0x0;const _0x20e130={},_0x309a7a={},_0xd786a={};for(const _0x447908 of _0xf6d278){try{const _0x164819=await currencyService_1['currencyService'][_0x2333ad(0x161)](_0x447908[_0x2333ad(0x252)],_0x447908[_0x2333ad(0x1ce)]);let _0x386b11={};if(_0x447908['shop'][_0x2333ad(0x14e)])try{_0x386b11=JSON['parse'](_0x447908[_0x2333ad(0x17b)][_0x2333ad(0x14e)]);}catch(_0x21ff32){console['error']('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x447908[_0x2333ad(0x226)]+':',_0x21ff32);}let _0x5ca59a={},_0x3caf1c=0xa;for(const [_0x453fe3,_0x5eca40]of Object['entries'](_0x386b11)){if(_0x453fe3[_0x2333ad(0x1f9)]()===_0x447908[_0x2333ad(0x1a8)][_0x2333ad(0x1f9)]()){_0x5ca59a=_0x5eca40,_0x3caf1c=_0x5eca40[_0x2333ad(0x19c)]||0xa;break;}}const _0x4e8e4f=_0x164819*(_0x3caf1c/0x64),_0x3d4a54=_0x164819-_0x4e8e4f;_0x5e78cc+=_0x164819,_0x16b102+=_0x3d4a54,_0x4f4ed4+=_0x4e8e4f;!_0x20e130[_0x447908['gateway']]&&(_0x20e130[_0x447908[_0x2333ad(0x1a8)]]={'gateway':_0x447908['gateway'],'gatewayDisplayName':this['getGatewayDisplayName'](_0x447908[_0x2333ad(0x1a8)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x20e130[_0x447908[_0x2333ad(0x1a8)]]['paymentsCount']++,_0x20e130[_0x447908[_0x2333ad(0x1a8)]][_0x2333ad(0x1a3)]+=_0x164819,_0x20e130[_0x447908['gateway']][_0x2333ad(0x1f2)]+=_0x4e8e4f,_0x20e130[_0x447908[_0x2333ad(0x1a8)]]['merchantEarningsUSDT']+=_0x3d4a54,_0x20e130[_0x447908[_0x2333ad(0x1a8)]][_0x2333ad(0x162)]+=_0x3caf1c;!_0x37fced[_0x2333ad(0x226)]&&(!_0x309a7a[_0x447908[_0x2333ad(0x226)]]&&(_0x309a7a[_0x447908[_0x2333ad(0x226)]]={'shopId':_0x447908[_0x2333ad(0x226)],'shopName':_0x447908[_0x2333ad(0x17b)][_0x2333ad(0x1e1)],'shopUsername':_0x447908[_0x2333ad(0x17b)][_0x2333ad(0x20b)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x309a7a[_0x447908[_0x2333ad(0x226)]]['paymentsCount']++,_0x309a7a[_0x447908[_0x2333ad(0x226)]]['turnoverUSDT']+=_0x164819,_0x309a7a[_0x447908[_0x2333ad(0x226)]][_0x2333ad(0x1f2)]+=_0x4e8e4f,_0x309a7a[_0x447908['shopId']][_0x2333ad(0x174)]+=_0x3d4a54);const _0xb4ebed=_0x447908['paidAt'][_0x2333ad(0x19f)]()[_0x2333ad(0x171)]('T')[0x0];!_0xd786a[_0xb4ebed]&&(_0xd786a[_0xb4ebed]={'date':_0xb4ebed,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0xd786a[_0xb4ebed][_0x2333ad(0x186)]+=_0x164819,_0xd786a[_0xb4ebed][_0x2333ad(0x230)]+=_0x3d4a54,_0xd786a[_0xb4ebed]['gatewayEarnings']+=_0x4e8e4f,_0xd786a[_0xb4ebed][_0x2333ad(0x19b)]++;}catch(_0x57e015){console[_0x2333ad(0x1b5)](_0x2333ad(0x20c)+_0x447908['id']+':',_0x57e015);}}Object['values'](_0x20e130)[_0x2333ad(0x222)](_0x308d0a=>{const _0x22bce0=_0x2333ad;_0x308d0a[_0x22bce0(0x22d)]=_0x308d0a[_0x22bce0(0x19b)]>0x0?_0x308d0a[_0x22bce0(0x162)]/_0x308d0a[_0x22bce0(0x19b)]:0x0,delete _0x308d0a[_0x22bce0(0x162)];}),Object['values'](_0x309a7a)[_0x2333ad(0x222)](_0xd7d1ed=>{const _0x126fd1=_0x2333ad;_0xd7d1ed['averageCheckUSDT']=_0xd7d1ed[_0x126fd1(0x19b)]>0x0?_0xd7d1ed[_0x126fd1(0x1a3)]/_0xd7d1ed['paymentsCount']:0x0;});let _0x16bcbb=0x0;if(_0x37fced[_0x2333ad(0x226)]){const _0xd0ebf1=await database_1[_0x2333ad(0x14c)][_0x2333ad(0x231)][_0x2333ad(0x1ee)]({'where':{'shopId':_0x37fced[_0x2333ad(0x226)],'status':_0x2333ad(0x22c),'createdAt':{'gte':_0x568a4a,'lte':_0x1bd59c}},'select':{'amount':!![]}});_0x16bcbb=_0xd0ebf1[_0x2333ad(0x1d4)]((_0x5a28b1,_0x3b5859)=>_0x5a28b1+_0x3b5859[_0x2333ad(0x252)],0x0);}const _0x30a419=_0x3955f8,_0x3f7a81=_0xf6d278[_0x2333ad(0x16a)],_0x69304c=_0x3f7a81>0x0?_0x5e78cc/_0x3f7a81:0x0,_0x37023d=_0x30a419>0x0?Math[_0x2333ad(0x1b6)](_0x3f7a81/_0x30a419*0x2710)/0x64:0x0,_0x5214a3=Math[_0x2333ad(0x242)]((_0x1bd59c['getTime']()-_0x568a4a['getTime']())/(0x3e8*0x3c*0x3c*0x18)),_0x5531ba={'totalTurnover':Math[_0x2333ad(0x1b6)](_0x5e78cc*0x64)/0x64,'merchantEarnings':Math[_0x2333ad(0x1b6)](_0x16b102*0x64)/0x64,'gatewayEarnings':Math[_0x2333ad(0x1b6)](_0x4f4ed4*0x64)/0x64,'totalPaidOut':Math[_0x2333ad(0x1b6)](_0x16bcbb*0x64)/0x64,'averageCheck':Math[_0x2333ad(0x1b6)](_0x69304c*0x64)/0x64,'totalPayments':_0x30a419,'successfulPayments':_0x3f7a81,'conversionRate':_0x37023d,'gatewayBreakdown':Object['values'](_0x20e130)[_0x2333ad(0x1cb)](_0x6b9795=>({..._0x6b9795,'turnoverUSDT':Math[_0x2333ad(0x1b6)](_0x6b9795['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math['round'](_0x6b9795[_0x2333ad(0x1f2)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x2333ad(0x1b6)](_0x6b9795[_0x2333ad(0x174)]*0x64)/0x64,'averageCommissionRate':Math[_0x2333ad(0x1b6)](_0x6b9795[_0x2333ad(0x22d)]*0x64)/0x64})),'merchantBreakdown':_0x37fced[_0x2333ad(0x226)]?undefined:Object[_0x2333ad(0x246)](_0x309a7a)[_0x2333ad(0x1cb)](_0x44cee1=>({..._0x44cee1,'turnoverUSDT':Math[_0x2333ad(0x1b6)](_0x44cee1['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x2333ad(0x1b6)](_0x44cee1[_0x2333ad(0x1f2)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x2333ad(0x1b6)](_0x44cee1[_0x2333ad(0x174)]*0x64)/0x64,'paidOutUSDT':Math[_0x2333ad(0x1b6)](_0x44cee1['paidOutUSDT']*0x64)/0x64,'averageCheckUSDT':Math[_0x2333ad(0x1b6)](_0x44cee1['averageCheckUSDT']*0x64)/0x64})),'dailyData':Object['values'](_0xd786a)[_0x2333ad(0x1cb)](_0x38c6af=>({..._0x38c6af,'turnover':Math[_0x2333ad(0x1b6)](_0x38c6af[_0x2333ad(0x186)]*0x64)/0x64,'merchantEarnings':Math['round'](_0x38c6af[_0x2333ad(0x230)]*0x64)/0x64,'gatewayEarnings':Math[_0x2333ad(0x1b6)](_0x38c6af[_0x2333ad(0x181)]*0x64)/0x64}))[_0x2333ad(0x17e)]((_0x2b4a06,_0x9ed90f)=>_0x2b4a06[_0x2333ad(0x223)][_0x2333ad(0x1a0)](_0x9ed90f[_0x2333ad(0x223)])),'periodInfo':{'from':_0x568a4a,'to':_0x1bd59c,'periodType':_0x37fced[_0x2333ad(0x170)]||'custom','daysCount':_0x5214a3}};return console[_0x2333ad(0x191)](_0x2333ad(0x1e5)),console[_0x2333ad(0x191)](_0x2333ad(0x173)+_0x5531ba['totalTurnover']+_0x2333ad(0x1df)),console['log'](_0x2333ad(0x17d)+_0x5531ba[_0x2333ad(0x230)]+_0x2333ad(0x1df)),console[_0x2333ad(0x191)]('\x20\x20\x20🏪\x20Gateway\x20earnings:\x20'+_0x5531ba[_0x2333ad(0x181)]+'\x20USDT'),console[_0x2333ad(0x191)](_0x2333ad(0x1b3)+_0x5531ba['totalPayments']),_0x5531ba;}async[a35_0x5cf0fd(0x18e)](){const _0x1d813d=a35_0x5cf0fd;console['log'](_0x1d813d(0x1cd));const _0x4637d6=await database_1[_0x1d813d(0x14c)]['shop'][_0x1d813d(0x1ee)]({'where':{'status':_0x1d813d(0x25f)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x1d813d(0x1ea)}});return console[_0x1d813d(0x191)]('📋\x20Found\x20'+_0x4637d6['length']+_0x1d813d(0x16d)),_0x4637d6[_0x1d813d(0x1cb)](_0x5f2b65=>({'id':_0x5f2b65['id'],'username':_0x5f2b65['username'],'name':_0x5f2b65[_0x1d813d(0x1e1)]}));}['getGatewayDisplayName'](_0x38ea2a){const _0x33e440=a35_0x5cf0fd,_0x4bbc8f={'test_gateway':_0x33e440(0x22a),'plisio':_0x33e440(0x1e7),'rapyd':_0x33e440(0x247),'noda':_0x33e440(0x1dc),'cointopay':_0x33e440(0x1fb),'klyme_eu':_0x33e440(0x183),'klyme_gb':'KLYME\x20GB','klyme_de':_0x33e440(0x217)};return _0x4bbc8f[_0x38ea2a]||_0x38ea2a;}async[a35_0x5cf0fd(0x24d)](_0x51cdf8){const _0x21113e=a35_0x5cf0fd,{page:_0x287b18,limit:_0x2d42fb,minAmount:_0x3d7c19,search:_0x16931e}=_0x51cdf8,_0x1c7f1e=(_0x287b18-0x1)*_0x2d42fb;console['log']('📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:',_0x51cdf8);const _0x1eac96={'balance':{'gt':0x0},'status':_0x21113e(0x25f)};_0x3d7c19&&(_0x1eac96[_0x21113e(0x1c3)][_0x21113e(0x210)]=_0x3d7c19);_0x16931e&&(_0x1eac96['OR']=[{'name':{'contains':_0x16931e,'mode':_0x21113e(0x18b)}},{'username':{'contains':_0x16931e,'mode':_0x21113e(0x18b)}}]);const [_0x42ac6f,_0xb33352]=await Promise[_0x21113e(0x151)]([database_1[_0x21113e(0x14c)]['shop'][_0x21113e(0x1ee)]({'where':_0x1eac96,'skip':_0x1c7f1e,'take':_0x2d42fb,'orderBy':{'balance':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1[_0x21113e(0x14c)][_0x21113e(0x17b)][_0x21113e(0x1db)]({'where':_0x1eac96})]);console['log']('💰\x20Found\x20'+_0x42ac6f[_0x21113e(0x16a)]+_0x21113e(0x1e3));const _0x3c6870=await Promise[_0x21113e(0x151)](_0x42ac6f['map'](async _0x5306a6=>{const _0x5274d3=_0x21113e,[_0x4cd37a,_0x53d4fd,_0x17f79e]=await Promise['all']([database_1[_0x5274d3(0x14c)]['payment'][_0x5274d3(0x1db)]({'where':{'shopId':_0x5306a6['id'],'status':'PAID','amountUSDT':{'not':null}}}),database_1[_0x5274d3(0x14c)]['payment'][_0x5274d3(0x1b2)]({'where':{'shopId':_0x5306a6['id'],'status':_0x5274d3(0x251),'amountUSDT':{'not':null}},'orderBy':{'paidAt':_0x5274d3(0x1ea)},'select':{'paidAt':!![]}}),database_1[_0x5274d3(0x14c)][_0x5274d3(0x220)][_0x5274d3(0x1b4)]({'by':[_0x5274d3(0x1a8)],'where':{'shopId':_0x5306a6['id'],'status':'PAID','amountUSDT':{'not':null}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x37146e=await Promise[_0x5274d3(0x151)](_0x17f79e[_0x5274d3(0x1cb)](async _0x2fef87=>{const _0x2dd4fc=_0x5274d3;let _0x5bdef9=0xa;if(_0x5306a6['gatewaySettings'])try{const _0x4f7b2c=JSON[_0x2dd4fc(0x249)](_0x5306a6[_0x2dd4fc(0x14e)]);for(const [_0x3296b7,_0xfad69d]of Object[_0x2dd4fc(0x195)](_0x4f7b2c)){if(_0x3296b7[_0x2dd4fc(0x1f9)]()===_0x2fef87['gateway'][_0x2dd4fc(0x1f9)]()){_0x5bdef9=_0xfad69d[_0x2dd4fc(0x19c)]||0xa,console[_0x2dd4fc(0x191)](_0x2dd4fc(0x23e)+_0x2fef87[_0x2dd4fc(0x1a8)]+_0x2dd4fc(0x15f)+_0x5306a6['id']+':\x20commission\x20=\x20'+_0x5bdef9+'%');break;}}}catch(_0x53df42){console[_0x2dd4fc(0x1b5)](_0x2dd4fc(0x1c4)+_0x5306a6['id']+':',_0x53df42);}const _0x148429=_0x2fef87[_0x2dd4fc(0x1d8)][_0x2dd4fc(0x159)]||0x0,_0x558ae8=_0x148429*(0x1-_0x5bdef9/0x64);return{'gateway':_0x2fef87[_0x2dd4fc(0x1a8)],'count':_0x2fef87[_0x2dd4fc(0x193)]['id'],'amountUSDT':Math[_0x2dd4fc(0x1b6)](_0x148429*0x64)/0x64,'amountAfterCommissionUSDT':Math['round'](_0x558ae8*0x64)/0x64,'commission':_0x5bdef9};})),_0x4cff12=_0x37146e[_0x5274d3(0x1d4)]((_0x3703c2,_0x152690)=>_0x3703c2+_0x152690[_0x5274d3(0x159)],0x0),_0x5d2a85=_0x5306a6[_0x5274d3(0x1c3)];return console[_0x5274d3(0x191)](_0x5274d3(0x1d1)+_0x5306a6[_0x5274d3(0x20b)]+':'),console[_0x5274d3(0x191)](_0x5274d3(0x1f6)+_0x4cff12[_0x5274d3(0x202)](0x2)+_0x5274d3(0x18a)),console[_0x5274d3(0x191)]('\x20\x20\x20🔍\x20Calculated\x20after\x20commission:\x20'+_0x37146e[_0x5274d3(0x1d4)]((_0x19dc66,_0x248f15)=>_0x19dc66+_0x248f15[_0x5274d3(0x1c2)],0x0)[_0x5274d3(0x202)](0x2)+'\x20USDT\x20(theoretical\x20net)'),console[_0x5274d3(0x191)](_0x5274d3(0x185)+_0x5d2a85['toFixed'](0x2)+_0x5274d3(0x225)),{'id':_0x5306a6['id'],'fullName':_0x5306a6['name'],'username':_0x5306a6[_0x5274d3(0x20b)],'telegramId':_0x5306a6[_0x5274d3(0x1c5)],'merchantUrl':_0x5306a6[_0x5274d3(0x15e)],'wallets':{'usdtPolygonWallet':_0x5306a6[_0x5274d3(0x250)],'usdtTrcWallet':_0x5306a6['usdtTrcWallet'],'usdtErcWallet':_0x5306a6[_0x5274d3(0x184)],'usdcPolygonWallet':_0x5306a6[_0x5274d3(0x188)]},'totalAmountUSDT':Math['round'](_0x4cff12*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x5d2a85*0x64)/0x64,'paymentsCount':_0x4cd37a,'oldestPaymentDate':_0x53d4fd?.[_0x5274d3(0x156)]||_0x5306a6[_0x5274d3(0x172)],'gatewayBreakdown':_0x37146e};})),_0x2bc995=_0x3c6870[_0x21113e(0x1d4)]((_0x322074,_0x48df63)=>_0x322074+_0x48df63[_0x21113e(0x1da)],0x0),_0x5963ab=_0x3c6870[_0x21113e(0x1d4)]((_0x3bc307,_0x442dc8)=>_0x3bc307+_0x442dc8[_0x21113e(0x1b7)],0x0);return console[_0x21113e(0x191)]('📊\x20Merchants\x20awaiting\x20payout:\x20'+_0xb33352+_0x21113e(0x1ac)),console[_0x21113e(0x191)](_0x21113e(0x254)+Math[_0x21113e(0x1b6)](_0x2bc995*0x64)/0x64+_0x21113e(0x18a)),console[_0x21113e(0x191)](_0x21113e(0x18f)+Math[_0x21113e(0x1b6)](_0x5963ab*0x64)/0x64+_0x21113e(0x16b)),{'merchants':_0x3c6870,'pagination':{'page':_0x287b18,'limit':_0x2d42fb,'total':_0xb33352,'totalPages':Math['ceil'](_0xb33352/_0x2d42fb)},'summary':{'totalMerchants':_0xb33352,'totalAmountUSDT':Math[_0x21113e(0x1b6)](_0x2bc995*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x5963ab*0x64)/0x64}};}async[a35_0x5cf0fd(0x152)](_0x12643c){const _0x326ad7=a35_0x5cf0fd,{shopId:_0x300b0a,amount:_0x3ff3bb,network:_0x2cc62d,wallet:_0x367984,notes:_0x183e21,txid:_0xcf30e7,periodFrom:_0x387433,periodTo:_0x4fd649}=_0x12643c,_0x149455=await database_1['default'][_0x326ad7(0x20a)](async _0x2abd2f=>{const _0x412b61=_0x326ad7,_0x2688b6=await _0x2abd2f[_0x412b61(0x17b)]['findUnique']({'where':{'id':_0x300b0a},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x2688b6)throw new Error(_0x412b61(0x25d));console['log'](_0x412b61(0x1e9)+_0x2688b6[_0x412b61(0x20b)]+':'),console['log']('\x20\x20\x20Current\x20balance:\x20'+_0x2688b6[_0x412b61(0x1c3)][_0x412b61(0x202)](0x6)+_0x412b61(0x1df)),console['log']('\x20\x20\x20Payout\x20amount:\x20'+_0x3ff3bb[_0x412b61(0x202)](0x6)+_0x412b61(0x1df)),console[_0x412b61(0x191)](_0x412b61(0x163)+_0x2688b6[_0x412b61(0x224)][_0x412b61(0x202)](0x6)+_0x412b61(0x1df));if(_0xcf30e7)console[_0x412b61(0x191)](_0x412b61(0x212)+_0xcf30e7);if(_0x2688b6[_0x412b61(0x1c3)]<_0x3ff3bb)throw new Error(_0x412b61(0x1d9)+_0x2688b6[_0x412b61(0x1c3)]['toFixed'](0x6)+_0x412b61(0x17a)+_0x3ff3bb[_0x412b61(0x202)](0x6)+_0x412b61(0x1df));let _0x397c8f=_0x367984;if(!_0x397c8f){const _0x42eba8=await _0x2abd2f[_0x412b61(0x17b)][_0x412b61(0x1ae)]({'where':{'id':_0x300b0a},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x42eba8)switch(_0x2cc62d){case'polygon':_0x397c8f=_0x42eba8[_0x412b61(0x250)]||undefined;break;case _0x412b61(0x1e4):_0x397c8f=_0x42eba8[_0x412b61(0x194)]||undefined;break;case _0x412b61(0x166):_0x397c8f=_0x42eba8[_0x412b61(0x184)]||undefined;break;case _0x412b61(0x189):_0x397c8f=_0x42eba8[_0x412b61(0x188)]||undefined;break;}}console['log'](_0x412b61(0x253)+_0x2cc62d+':\x20'+(_0x397c8f||_0x412b61(0x1af)));const _0x197d77=await _0x2abd2f[_0x412b61(0x231)]['create']({'data':{'shopId':_0x300b0a,'amount':_0x3ff3bb,'network':_0x2cc62d,'status':_0x412b61(0x22c),'txid':_0xcf30e7,'notes':_0x183e21,'periodFrom':_0x387433?new Date(_0x387433):null,'periodTo':_0x4fd649?new Date(_0x4fd649):null,'createdAt':new Date(),'paidAt':new Date()}}),_0xabd6b4=_0x2688b6[_0x412b61(0x1c3)]-_0x3ff3bb,_0x412f5a=_0x2688b6['totalPaidOut']+_0x3ff3bb;return await _0x2abd2f[_0x412b61(0x17b)][_0x412b61(0x25a)]({'where':{'id':_0x300b0a},'data':{'balance':_0xabd6b4,'totalPaidOut':_0x412f5a}}),console[_0x412b61(0x191)](_0x412b61(0x196)+_0x2688b6['username']+_0x412b61(0x215)),console['log'](_0x412b61(0x15a)+_0x2688b6[_0x412b61(0x1c3)][_0x412b61(0x202)](0x6)+_0x412b61(0x1a2)+_0xabd6b4['toFixed'](0x6)+'\x20USDT\x20(-'+_0x3ff3bb[_0x412b61(0x202)](0x6)+')'),console['log'](_0x412b61(0x24a)+_0x2688b6[_0x412b61(0x224)]['toFixed'](0x6)+'\x20->\x20'+_0x412f5a[_0x412b61(0x202)](0x6)+_0x412b61(0x206)+_0x3ff3bb[_0x412b61(0x202)](0x6)+')'),{'payout':_0x197d77,'shop':_0x2688b6};});return console['log'](_0x326ad7(0x21e)+_0x149455[_0x326ad7(0x231)]['id']+_0x326ad7(0x15f)+_0x149455[_0x326ad7(0x17b)][_0x326ad7(0x20b)]+'\x20('+_0x3ff3bb+'\x20USDT)'),{'id':_0x149455['payout']['id'],'shopId':_0x149455[_0x326ad7(0x231)]['shopId'],'shopName':_0x149455[_0x326ad7(0x17b)]['name'],'shopUsername':_0x149455['shop']['username'],'amount':_0x149455[_0x326ad7(0x231)][_0x326ad7(0x252)],'network':_0x149455[_0x326ad7(0x231)]['network'],'status':_0x149455[_0x326ad7(0x231)]['status'],'txid':_0x149455['payout'][_0x326ad7(0x1bc)],'notes':_0x149455[_0x326ad7(0x231)][_0x326ad7(0x153)],'periodFrom':_0x149455[_0x326ad7(0x231)][_0x326ad7(0x1c6)],'periodTo':_0x149455[_0x326ad7(0x231)][_0x326ad7(0x197)],'createdAt':_0x149455[_0x326ad7(0x231)][_0x326ad7(0x172)],'paidAt':_0x149455[_0x326ad7(0x231)][_0x326ad7(0x156)]};}async['getAllPayouts'](_0x51bfac){const _0x447de9=a35_0x5cf0fd,{page:_0x32434c,limit:_0x23b5d4,shopId:_0x5f45fe,network:_0x57c245,dateFrom:_0x288d1e,dateTo:_0x23bc13,search:_0x20d442}=_0x51bfac,_0x408402=(_0x32434c-0x1)*_0x23b5d4,_0x7b15c6={};_0x5f45fe&&(_0x7b15c6[_0x447de9(0x226)]=_0x5f45fe);_0x57c245&&(_0x7b15c6['network']=_0x57c245);(_0x288d1e||_0x23bc13)&&(_0x7b15c6[_0x447de9(0x172)]={},_0x288d1e&&(_0x7b15c6['createdAt'][_0x447de9(0x210)]=new Date(_0x288d1e)),_0x23bc13&&(_0x7b15c6[_0x447de9(0x172)]['lte']=new Date(_0x23bc13)));_0x20d442&&(_0x7b15c6['OR']=[{'shop':{'name':{'contains':_0x20d442,'mode':_0x447de9(0x18b)}}},{'shop':{'username':{'contains':_0x20d442,'mode':'insensitive'}}},{'notes':{'contains':_0x20d442,'mode':'insensitive'}}]);const [_0x59a91e,_0x2b5da5]=await Promise[_0x447de9(0x151)]([database_1[_0x447de9(0x14c)][_0x447de9(0x231)][_0x447de9(0x1ee)]({'where':_0x7b15c6,'skip':_0x408402,'take':_0x23b5d4,'orderBy':{'createdAt':_0x447de9(0x259)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x447de9(0x14c)][_0x447de9(0x231)][_0x447de9(0x1db)]({'where':_0x7b15c6})]);return{'payouts':_0x59a91e['map'](_0x4271fe=>({'id':_0x4271fe['id'],'shopId':_0x4271fe[_0x447de9(0x226)],'shopName':_0x4271fe[_0x447de9(0x17b)][_0x447de9(0x1e1)],'shopUsername':_0x4271fe[_0x447de9(0x17b)][_0x447de9(0x20b)],'amount':_0x4271fe[_0x447de9(0x252)],'network':_0x4271fe[_0x447de9(0x16e)],'status':_0x4271fe['status'],'txid':_0x4271fe[_0x447de9(0x1bc)],'notes':_0x4271fe[_0x447de9(0x153)],'periodFrom':_0x4271fe[_0x447de9(0x1c6)],'periodTo':_0x4271fe[_0x447de9(0x197)],'createdAt':_0x4271fe[_0x447de9(0x172)],'paidAt':_0x4271fe[_0x447de9(0x156)]})),'pagination':{'page':_0x32434c,'limit':_0x23b5d4,'total':_0x2b5da5,'totalPages':Math['ceil'](_0x2b5da5/_0x23b5d4)}};}async['getPayoutById'](_0x38f767){const _0x2d61dc=a35_0x5cf0fd,_0x4aa173=await database_1[_0x2d61dc(0x14c)]['payout'][_0x2d61dc(0x1ae)]({'where':{'id':_0x38f767},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x4aa173)return null;return{'id':_0x4aa173['id'],'shopId':_0x4aa173[_0x2d61dc(0x226)],'shopName':_0x4aa173[_0x2d61dc(0x17b)][_0x2d61dc(0x1e1)],'shopUsername':_0x4aa173[_0x2d61dc(0x17b)][_0x2d61dc(0x20b)],'amount':_0x4aa173[_0x2d61dc(0x252)],'network':_0x4aa173['network'],'status':_0x4aa173[_0x2d61dc(0x1eb)],'txid':_0x4aa173[_0x2d61dc(0x1bc)],'notes':_0x4aa173[_0x2d61dc(0x153)],'periodFrom':_0x4aa173[_0x2d61dc(0x1c6)],'periodTo':_0x4aa173[_0x2d61dc(0x197)],'createdAt':_0x4aa173['createdAt'],'paidAt':_0x4aa173['paidAt']};}async[a35_0x5cf0fd(0x24b)](_0x3c8015){const _0x2af656=a35_0x5cf0fd;await database_1[_0x2af656(0x14c)][_0x2af656(0x231)]['delete']({'where':{'id':_0x3c8015}});}async[a35_0x5cf0fd(0x1c1)](_0x354046){const _0x35327c=a35_0x5cf0fd,{page:_0x1f00d9,limit:_0x1bae4d,status:_0x5c5abe,gateway:_0x509400,shopId:_0x5f4814,dateFrom:_0x59a2f0,dateTo:_0x472528,search:_0x159c6c,currency:_0x264bbd,sortBy:_0x580681,sortOrder:_0x336062}=_0x354046,_0x3e1b6c=(_0x1f00d9-0x1)*_0x1bae4d;console[_0x35327c(0x191)](_0x35327c(0x179),_0x354046);const _0x25c46f=await database_1[_0x35327c(0x14c)][_0x35327c(0x220)][_0x35327c(0x1b4)]({'by':[_0x35327c(0x1a8)],'_count':{'gateway':!![]}});console[_0x35327c(0x191)](_0x35327c(0x209),_0x25c46f['map'](_0x1b3cf3=>_0x1b3cf3['gateway']+'\x20('+_0x1b3cf3['_count'][_0x35327c(0x1a8)]+_0x35327c(0x1b9)));if(_0x509400){const _0x38b639=_0x25c46f[_0x35327c(0x256)](_0x38a407=>_0x38a407[_0x35327c(0x1a8)]['toLowerCase']()===_0x509400['toLowerCase']());!_0x38b639&&_0x509400[_0x35327c(0x1f9)]()!==_0x35327c(0x218)&&console[_0x35327c(0x191)](_0x35327c(0x16f)+_0x509400+_0x35327c(0x19e)+_0x25c46f[_0x35327c(0x1cb)](_0x51fc3b=>_0x51fc3b[_0x35327c(0x1a8)])[_0x35327c(0x1d6)](',\x20'));}const _0x419a97={};_0x5c5abe&&(_0x419a97[_0x35327c(0x1eb)]=_0x5c5abe[_0x35327c(0x1bf)]());if(!_0x509400)_0x419a97['gateway']={'not':_0x35327c(0x218)};else{if(_0x509400&&(_0x509400[_0x35327c(0x1f9)]()===_0x35327c(0x218)||_0x509400===_0x35327c(0x24c)))_0x419a97[_0x35327c(0x1a8)]=_0x35327c(0x218);else{let _0x599de5=_0x509400;const _0x508084=(0x0,gateway_1['getGatewayNameById'])(_0x509400);if(_0x508084)_0x599de5=_0x508084,console['log'](_0x35327c(0x257)+_0x509400+_0x35327c(0x1c7)+_0x599de5+'\x27');else{const _0x2dd5fc=(0x0,gateway_1[_0x35327c(0x260)])(_0x509400);if(_0x2dd5fc){const _0x4c5f90=(0x0,gateway_1['getGatewayNameById'])(_0x2dd5fc);_0x4c5f90&&(_0x599de5=_0x4c5f90,console[_0x35327c(0x191)](_0x35327c(0x216)+_0x509400+_0x35327c(0x1c0)+_0x2dd5fc+_0x35327c(0x168)+_0x599de5+'\x27'));}else console[_0x35327c(0x191)](_0x35327c(0x1e2)+_0x509400+_0x35327c(0x14f));}const _0x12e30b=await database_1[_0x35327c(0x14c)]['payment']['count']({'where':{'gateway':_0x599de5['toLowerCase']()},'take':0x1});_0x12e30b===0x0?(console[_0x35327c(0x191)](_0x35327c(0x1ab)+_0x599de5+'\x27\x20(from\x20\x27'+_0x509400+_0x35327c(0x232)),_0x419a97[_0x35327c(0x1a8)]=_0x35327c(0x1a4)):(_0x419a97[_0x35327c(0x1a8)]=_0x599de5['toLowerCase'](),console[_0x35327c(0x191)](_0x35327c(0x1f0)+_0x599de5+_0x35327c(0x1a9)+_0x509400+'\x27)'));}}console['log'](_0x35327c(0x1ec),_0x419a97[_0x35327c(0x1a8)]);_0x5f4814&&(_0x419a97[_0x35327c(0x226)]=_0x5f4814);_0x264bbd&&(_0x419a97[_0x35327c(0x1ce)]=_0x264bbd[_0x35327c(0x1bf)](),console['log'](_0x35327c(0x25c)+_0x264bbd[_0x35327c(0x1bf)]()));(_0x59a2f0||_0x472528)&&(_0x419a97[_0x35327c(0x172)]={},_0x59a2f0&&(_0x419a97[_0x35327c(0x172)][_0x35327c(0x210)]=new Date(_0x59a2f0)),_0x472528&&(_0x419a97['createdAt'][_0x35327c(0x23b)]=new Date(_0x472528)));_0x159c6c&&(_0x419a97['OR']=[{'id':{'contains':_0x159c6c,'mode':_0x35327c(0x18b)}},{'orderId':{'contains':_0x159c6c,'mode':_0x35327c(0x18b)}},{'gatewayOrderId':{'contains':_0x159c6c,'mode':_0x35327c(0x18b)}},{'customerEmail':{'contains':_0x159c6c,'mode':_0x35327c(0x18b)}},{'shop':{'name':{'contains':_0x159c6c,'mode':_0x35327c(0x18b)}}},{'shop':{'username':{'contains':_0x159c6c,'mode':_0x35327c(0x18b)}}}]);console[_0x35327c(0x191)](_0x35327c(0x15c),JSON[_0x35327c(0x1dd)](_0x419a97,null,0x2));let _0x1ab4de={'createdAt':_0x35327c(0x259)};if(_0x580681){const _0x261c75=['amount',_0x35327c(0x172),_0x35327c(0x248),_0x35327c(0x1eb),'gateway',_0x35327c(0x1ce)],_0x1f1236=[_0x35327c(0x1ea),_0x35327c(0x259)];if(_0x261c75[_0x35327c(0x208)](_0x580681)){const _0x1e026c=_0x1f1236[_0x35327c(0x208)](_0x336062)?_0x336062:_0x35327c(0x259);_0x1ab4de={[_0x580681]:_0x1e026c},console[_0x35327c(0x191)](_0x35327c(0x19d)+_0x580681+_0x35327c(0x1f3)+_0x1e026c+_0x35327c(0x213));}}const [_0x192c7f,_0x242114]=await Promise['all']([database_1[_0x35327c(0x14c)][_0x35327c(0x220)][_0x35327c(0x1ee)]({'where':_0x419a97,'skip':_0x3e1b6c,'take':_0x1bae4d,'orderBy':_0x1ab4de,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x35327c(0x220)][_0x35327c(0x1db)]({'where':_0x419a97})]);return{'payments':_0x192c7f[_0x35327c(0x1cb)](_0x2ddee2=>({'id':_0x2ddee2['id'],'shopId':_0x2ddee2[_0x35327c(0x226)],'gateway':_0x2ddee2[_0x35327c(0x1a8)],'amount':_0x2ddee2[_0x35327c(0x252)],'currency':_0x2ddee2[_0x35327c(0x1ce)],'status':_0x2ddee2[_0x35327c(0x1eb)],'orderId':_0x2ddee2[_0x35327c(0x176)],'gatewayOrderId':_0x2ddee2[_0x35327c(0x150)],'customerEmail':_0x2ddee2['customerEmail'],'customerName':_0x2ddee2[_0x35327c(0x235)],'customerCountry':_0x2ddee2['customerCountry'],'customerIp':_0x2ddee2[_0x35327c(0x177)],'customerUa':_0x2ddee2[_0x35327c(0x190)],'failureMessage':_0x2ddee2[_0x35327c(0x178)],'createdAt':_0x2ddee2[_0x35327c(0x172)],'updatedAt':_0x2ddee2['updatedAt'],'shop':_0x2ddee2[_0x35327c(0x17b)]})),'pagination':{'page':_0x1f00d9,'limit':_0x1bae4d,'total':_0x242114,'totalPages':Math[_0x35327c(0x242)](_0x242114/_0x1bae4d)}};}async[a35_0x5cf0fd(0x1ef)](_0x24c391){const _0x2e15a7=a35_0x5cf0fd,_0x10e655=await database_1[_0x2e15a7(0x14c)]['payment'][_0x2e15a7(0x1ae)]({'where':{'id':_0x24c391},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x10e655)return null;return{'id':_0x10e655['id'],'shopId':_0x10e655[_0x2e15a7(0x226)],'gateway':_0x10e655[_0x2e15a7(0x1a8)],'amount':_0x10e655[_0x2e15a7(0x252)],'currency':_0x10e655['currency'],'status':_0x10e655[_0x2e15a7(0x1eb)],'orderId':_0x10e655[_0x2e15a7(0x176)],'gatewayOrderId':_0x10e655[_0x2e15a7(0x150)],'customerEmail':_0x10e655[_0x2e15a7(0x21f)],'customerName':_0x10e655[_0x2e15a7(0x235)],'customerCountry':_0x10e655[_0x2e15a7(0x1ba)],'customerIp':_0x10e655[_0x2e15a7(0x177)],'customerUa':_0x10e655[_0x2e15a7(0x190)],'failureMessage':_0x10e655[_0x2e15a7(0x178)],'externalPaymentUrl':_0x10e655[_0x2e15a7(0x1f1)],'successUrl':_0x10e655['successUrl'],'failUrl':_0x10e655['failUrl'],'pendingUrl':_0x10e655['pendingUrl'],'whiteUrl':_0x10e655[_0x2e15a7(0x203)],'createdAt':_0x10e655[_0x2e15a7(0x172)],'updatedAt':_0x10e655[_0x2e15a7(0x248)],'shop':_0x10e655[_0x2e15a7(0x17b)]};}async['updatePaymentStatus'](_0x46b4c0,_0x1d1527,_0xd40852,_0x17064c){const _0x39d7a0=a35_0x5cf0fd,_0x1a5d00=await database_1['default']['$transaction'](async _0x2326ae=>{const _0x33e64d=a35_0x10ca,_0x55fab1=await _0x2326ae[_0x33e64d(0x220)][_0x33e64d(0x1ae)]({'where':{'id':_0x46b4c0},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x55fab1)throw new Error(_0x33e64d(0x1f8));const _0x435c61=_0x55fab1[_0x33e64d(0x1eb)],_0x367ebd=_0x1d1527['toUpperCase']();console[_0x33e64d(0x191)](_0x33e64d(0x1ed)+_0x46b4c0+_0x33e64d(0x1de)+_0x435c61+_0x33e64d(0x1a2)+_0x367ebd),console[_0x33e64d(0x191)](_0x33e64d(0x1a1)+_0x55fab1['shop']['balance']+_0x33e64d(0x1df));const _0x10bd30={'status':_0x367ebd,'updatedAt':new Date(),'statusChangedBy':_0x33e64d(0x228),'statusChangedAt':new Date()};_0xd40852&&(_0x10bd30['adminNotes']=_0xd40852);_0x367ebd===_0x33e64d(0x1f5)&&_0x17064c&&(_0x10bd30[_0x33e64d(0x17c)]=_0x17064c);let _0xd14d6b=0x0,_0x358ce2=_0x55fab1['shop'][_0x33e64d(0x1c3)];if(_0x367ebd===_0x33e64d(0x251)&&_0x435c61!=='PAID'){_0x10bd30[_0x33e64d(0x156)]=new Date();const _0x5508c3=await currencyService_1[_0x33e64d(0x155)]['convertToUSDT'](_0x55fab1[_0x33e64d(0x252)],_0x55fab1['currency']);_0x10bd30[_0x33e64d(0x159)]=_0x5508c3;let _0x5a85b4=0xa;const _0x427600=await _0x2326ae[_0x33e64d(0x17b)][_0x33e64d(0x1ae)]({'where':{'id':_0x55fab1[_0x33e64d(0x226)]},'select':{'gatewaySettings':!![]}});if(_0x427600?.[_0x33e64d(0x14e)])try{const _0x455b4a=JSON[_0x33e64d(0x249)](_0x427600[_0x33e64d(0x14e)]);for(const [_0x12e0f8,_0x31897f]of Object[_0x33e64d(0x195)](_0x455b4a)){if(_0x12e0f8[_0x33e64d(0x1f9)]()===_0x55fab1[_0x33e64d(0x1a8)][_0x33e64d(0x1f9)]()){_0x5a85b4=_0x31897f[_0x33e64d(0x19c)]||0xa;break;}}}catch(_0x511583){console[_0x33e64d(0x1b5)](_0x33e64d(0x20f)+_0x46b4c0+':',_0x511583);}const _0x10c48d=_0x5508c3*(0x1-_0x5a85b4/0x64);_0xd14d6b=_0x10c48d,_0x358ce2+=_0x10c48d,console[_0x33e64d(0x191)](_0x33e64d(0x211)+_0x46b4c0+_0x33e64d(0x1cc)),console[_0x33e64d(0x191)](_0x33e64d(0x1ff)+_0x5508c3[_0x33e64d(0x202)](0x6)+'\x20USDT'),console['log'](_0x33e64d(0x1aa)+_0x55fab1[_0x33e64d(0x1a8)]+_0x33e64d(0x24e)+_0x5a85b4+'%'),console[_0x33e64d(0x191)](_0x33e64d(0x1fc)+_0x10c48d[_0x33e64d(0x202)](0x6)+_0x33e64d(0x21d)+_0x5a85b4+'%\x20commission)'),console['log'](_0x33e64d(0x1fa)+_0x10c48d[_0x33e64d(0x202)](0x6)+'\x20USDT');}else{if(_0x435c61===_0x33e64d(0x251)&&_0x367ebd!=='PAID'){if(_0x55fab1[_0x33e64d(0x159)]){let _0x1e5555=0xa;const _0x1e98cb=await _0x2326ae['shop'][_0x33e64d(0x1ae)]({'where':{'id':_0x55fab1['shopId']},'select':{'gatewaySettings':!![]}});if(_0x1e98cb?.['gatewaySettings'])try{const _0x370edc=JSON[_0x33e64d(0x249)](_0x1e98cb[_0x33e64d(0x14e)]);for(const [_0x120361,_0x40db69]of Object[_0x33e64d(0x195)](_0x370edc)){if(_0x120361[_0x33e64d(0x1f9)]()===_0x55fab1[_0x33e64d(0x1a8)]['toLowerCase']()){_0x1e5555=_0x40db69[_0x33e64d(0x19c)]||0xa;break;}}}catch(_0x394542){console[_0x33e64d(0x1b5)](_0x33e64d(0x20f)+_0x46b4c0+':',_0x394542);}const _0x1621d7=_0x55fab1[_0x33e64d(0x159)]*(0x1-_0x1e5555/0x64);_0xd14d6b=-_0x1621d7,_0x358ce2-=_0x1621d7,_0x10bd30[_0x33e64d(0x159)]=null,console[_0x33e64d(0x191)](_0x33e64d(0x211)+_0x46b4c0+_0x33e64d(0x227)),console[_0x33e64d(0x191)](_0x33e64d(0x1ff)+_0x55fab1['amountUSDT'][_0x33e64d(0x202)](0x6)+_0x33e64d(0x1df)),console[_0x33e64d(0x191)](_0x33e64d(0x1aa)+_0x55fab1['gateway']+_0x33e64d(0x24e)+_0x1e5555+'%'),console[_0x33e64d(0x191)]('\x20\x20\x20Merchant\x20loses:\x20'+_0x1621d7[_0x33e64d(0x202)](0x6)+_0x33e64d(0x21d)+_0x1e5555+_0x33e64d(0x261)),console['log'](_0x33e64d(0x1ca)+_0x1621d7[_0x33e64d(0x202)](0x6)+_0x33e64d(0x1df));}}}_0x367ebd===_0x33e64d(0x1f5)&&(_0x435c61===_0x33e64d(0x251)&&_0x55fab1[_0x33e64d(0x159)]&&console[_0x33e64d(0x191)](_0x33e64d(0x1a7)),_0x17064c&&_0x17064c>0x0&&(_0xd14d6b-=_0x17064c,_0x358ce2-=_0x17064c,console['log']('💸\x20CHARGEBACK\x20penalty:\x20-'+_0x17064c['toFixed'](0x6)+_0x33e64d(0x16c))));_0x367ebd==='REFUND'&&_0x435c61===_0x33e64d(0x251)&&console[_0x33e64d(0x191)]('🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance');const _0x30ba25=await _0x2326ae['payment'][_0x33e64d(0x25a)]({'where':{'id':_0x46b4c0},'data':_0x10bd30,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0xd14d6b!==0x0&&(await _0x2326ae['shop'][_0x33e64d(0x25a)]({'where':{'id':_0x55fab1[_0x33e64d(0x226)]},'data':{'balance':_0x358ce2}}),console[_0x33e64d(0x191)]('💰\x20Shop\x20'+_0x55fab1['shopId']+_0x33e64d(0x164)+_0x55fab1[_0x33e64d(0x17b)][_0x33e64d(0x1c3)][_0x33e64d(0x202)](0x6)+'\x20->\x20'+_0x358ce2[_0x33e64d(0x202)](0x6)+_0x33e64d(0x22f)+(_0xd14d6b>0x0?'+':'')+_0xd14d6b['toFixed'](0x6)+')')),_0x30ba25;});return{'id':_0x1a5d00['id'],'shopId':_0x1a5d00[_0x39d7a0(0x226)],'gateway':_0x1a5d00['gateway'],'amount':_0x1a5d00[_0x39d7a0(0x252)],'currency':_0x1a5d00[_0x39d7a0(0x1ce)],'status':_0x1a5d00['status'],'orderId':_0x1a5d00[_0x39d7a0(0x176)],'gatewayOrderId':_0x1a5d00[_0x39d7a0(0x150)],'customerEmail':_0x1a5d00[_0x39d7a0(0x21f)],'customerName':_0x1a5d00[_0x39d7a0(0x235)],'customerCountry':_0x1a5d00[_0x39d7a0(0x1ba)],'customerIp':_0x1a5d00[_0x39d7a0(0x177)],'customerUa':_0x1a5d00[_0x39d7a0(0x190)],'failureMessage':_0x1a5d00[_0x39d7a0(0x178)],'adminNotes':_0x1a5d00[_0x39d7a0(0x1bb)],'chargebackAmount':_0x1a5d00[_0x39d7a0(0x17c)],'statusChangedBy':_0x1a5d00[_0x39d7a0(0x23d)],'statusChangedAt':_0x1a5d00[_0x39d7a0(0x23f)],'createdAt':_0x1a5d00[_0x39d7a0(0x172)],'updatedAt':_0x1a5d00[_0x39d7a0(0x248)],'shop':_0x1a5d00[_0x39d7a0(0x17b)]};}async[a35_0x5cf0fd(0x182)](_0x4afb73,_0x2db211){const _0x435126=a35_0x5cf0fd,_0x4f92f0={..._0x2db211};_0x2db211[_0x435126(0x243)]&&(_0x4f92f0['password']=await bcryptjs_1['default'][_0x435126(0x258)](_0x2db211['password'],0xc));_0x2db211['fullName']&&(_0x4f92f0[_0x435126(0x1e1)]=_0x2db211[_0x435126(0x1d2)],delete _0x4f92f0[_0x435126(0x1d2)]);_0x2db211['telegramId']&&(_0x4f92f0[_0x435126(0x1c5)]=_0x2db211[_0x435126(0x221)],delete _0x4f92f0[_0x435126(0x221)]);_0x2db211[_0x435126(0x1f4)]&&(_0x4f92f0[_0x435126(0x15e)]=_0x2db211[_0x435126(0x1f4)],delete _0x4f92f0['merchantUrl']);_0x2db211[_0x435126(0x22b)]&&(_0x4f92f0[_0x435126(0x165)]=JSON[_0x435126(0x1dd)](_0x2db211['gateways']),delete _0x4f92f0[_0x435126(0x22b)]);_0x2db211[_0x435126(0x14e)]&&(_0x4f92f0[_0x435126(0x14e)]=JSON[_0x435126(0x1dd)](_0x2db211['gatewaySettings']),delete _0x4f92f0['gatewaySettings']);_0x2db211[_0x435126(0x237)]&&(_0x2db211[_0x435126(0x237)]['usdtPolygonWallet']!==undefined&&(_0x4f92f0['usdtPolygonWallet']=_0x2db211[_0x435126(0x237)][_0x435126(0x250)]||null),_0x2db211['wallets'][_0x435126(0x194)]!==undefined&&(_0x4f92f0[_0x435126(0x194)]=_0x2db211[_0x435126(0x237)]['usdtTrcWallet']||null),_0x2db211[_0x435126(0x237)][_0x435126(0x184)]!==undefined&&(_0x4f92f0[_0x435126(0x184)]=_0x2db211[_0x435126(0x237)][_0x435126(0x184)]||null),_0x2db211[_0x435126(0x237)][_0x435126(0x188)]!==undefined&&(_0x4f92f0[_0x435126(0x188)]=_0x2db211['wallets'][_0x435126(0x188)]||null),delete _0x4f92f0['wallets']);const _0x4ca8fb=await database_1[_0x435126(0x14c)]['shop'][_0x435126(0x25a)]({'where':{'id':_0x4afb73},'data':_0x4f92f0,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4ca8fb['id'],'fullName':_0x4ca8fb[_0x435126(0x1e1)],'username':_0x4ca8fb['username'],'telegramId':_0x4ca8fb['telegram'],'merchantUrl':_0x4ca8fb[_0x435126(0x15e)],'gateways':_0x4ca8fb[_0x435126(0x165)]?JSON[_0x435126(0x249)](_0x4ca8fb['paymentGateways']):null,'gatewaySettings':_0x4ca8fb[_0x435126(0x14e)]?JSON[_0x435126(0x249)](_0x4ca8fb['gatewaySettings']):null,'publicKey':_0x4ca8fb['publicKey'],'wallets':{'usdtPolygonWallet':_0x4ca8fb[_0x435126(0x250)],'usdtTrcWallet':_0x4ca8fb[_0x435126(0x194)],'usdtErcWallet':_0x4ca8fb[_0x435126(0x184)],'usdcPolygonWallet':_0x4ca8fb[_0x435126(0x188)]},'status':_0x4ca8fb[_0x435126(0x1eb)],'createdAt':_0x4ca8fb[_0x435126(0x172)]};}async[a35_0x5cf0fd(0x23c)](_0x3107c3){const _0x4d4ae3=a35_0x5cf0fd,_0x5b6eb6=await database_1[_0x4d4ae3(0x14c)]['shop'][_0x4d4ae3(0x25a)]({'where':{'id':_0x3107c3},'data':{'status':_0x4d4ae3(0x1b1)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x5b6eb6['id'],'fullName':_0x5b6eb6[_0x4d4ae3(0x1e1)],'username':_0x5b6eb6['username'],'telegramId':_0x5b6eb6[_0x4d4ae3(0x1c5)],'merchantUrl':_0x5b6eb6[_0x4d4ae3(0x15e)],'gateways':_0x5b6eb6['paymentGateways']?JSON[_0x4d4ae3(0x249)](_0x5b6eb6[_0x4d4ae3(0x165)]):null,'gatewaySettings':_0x5b6eb6['gatewaySettings']?JSON[_0x4d4ae3(0x249)](_0x5b6eb6[_0x4d4ae3(0x14e)]):null,'publicKey':_0x5b6eb6[_0x4d4ae3(0x1d5)],'wallets':{'usdtPolygonWallet':_0x5b6eb6[_0x4d4ae3(0x250)],'usdtTrcWallet':_0x5b6eb6[_0x4d4ae3(0x194)],'usdtErcWallet':_0x5b6eb6[_0x4d4ae3(0x184)],'usdcPolygonWallet':_0x5b6eb6['usdcPolygonWallet']},'status':_0x5b6eb6[_0x4d4ae3(0x1eb)],'createdAt':_0x5b6eb6[_0x4d4ae3(0x172)]};}async[a35_0x5cf0fd(0x23a)](_0x334905){const _0x35d8d1=a35_0x5cf0fd,_0xe040d=await database_1[_0x35d8d1(0x14c)][_0x35d8d1(0x17b)][_0x35d8d1(0x25a)]({'where':{'id':_0x334905},'data':{'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0xe040d['id'],'fullName':_0xe040d[_0x35d8d1(0x1e1)],'username':_0xe040d['username'],'telegramId':_0xe040d[_0x35d8d1(0x1c5)],'merchantUrl':_0xe040d['shopUrl'],'gateways':_0xe040d['paymentGateways']?JSON['parse'](_0xe040d['paymentGateways']):null,'gatewaySettings':_0xe040d[_0x35d8d1(0x14e)]?JSON['parse'](_0xe040d[_0x35d8d1(0x14e)]):null,'publicKey':_0xe040d[_0x35d8d1(0x1d5)],'wallets':{'usdtPolygonWallet':_0xe040d[_0x35d8d1(0x250)],'usdtTrcWallet':_0xe040d[_0x35d8d1(0x194)],'usdtErcWallet':_0xe040d[_0x35d8d1(0x184)],'usdcPolygonWallet':_0xe040d[_0x35d8d1(0x188)]},'status':_0xe040d[_0x35d8d1(0x1eb)],'createdAt':_0xe040d['createdAt']};}async[a35_0x5cf0fd(0x20d)](_0x3bac2a){const _0x2735b9=a35_0x5cf0fd,{page:_0x351cf1,limit:_0x2697f0,status:_0x3caa4f}=_0x3bac2a,_0x1b1a9a=(_0x351cf1-0x1)*_0x2697f0,_0x2d3db7={};_0x3caa4f&&(_0x2d3db7[_0x2735b9(0x1eb)]=_0x3caa4f[_0x2735b9(0x1bf)]());const [_0x5de23c,_0x8311ca]=await Promise[_0x2735b9(0x151)]([database_1[_0x2735b9(0x14c)]['shop'][_0x2735b9(0x1ee)]({'where':_0x2d3db7,'skip':_0x1b1a9a,'take':_0x2697f0,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1['default'][_0x2735b9(0x17b)]['count']({'where':_0x2d3db7})]);return{'users':_0x5de23c['map'](_0x4642f8=>({'id':_0x4642f8['id'],'fullName':_0x4642f8[_0x2735b9(0x1e1)],'username':_0x4642f8[_0x2735b9(0x20b)],'telegramId':_0x4642f8[_0x2735b9(0x1c5)],'merchantUrl':_0x4642f8['shopUrl'],'gateways':_0x4642f8[_0x2735b9(0x165)]?JSON['parse'](_0x4642f8[_0x2735b9(0x165)]):null,'gatewaySettings':_0x4642f8[_0x2735b9(0x14e)]?JSON[_0x2735b9(0x249)](_0x4642f8[_0x2735b9(0x14e)]):null,'publicKey':_0x4642f8[_0x2735b9(0x1d5)],'wallets':{'usdtPolygonWallet':_0x4642f8[_0x2735b9(0x250)],'usdtTrcWallet':_0x4642f8[_0x2735b9(0x194)],'usdtErcWallet':_0x4642f8[_0x2735b9(0x184)],'usdcPolygonWallet':_0x4642f8[_0x2735b9(0x188)]},'status':_0x4642f8['status'],'createdAt':_0x4642f8['createdAt']})),'pagination':{'page':_0x351cf1,'limit':_0x2697f0,'total':_0x8311ca,'totalPages':Math['ceil'](_0x8311ca/_0x2697f0)}};}async[a35_0x5cf0fd(0x1c8)](_0x4b3a47){const _0x50a412=a35_0x5cf0fd,_0x43fbf8=await database_1[_0x50a412(0x14c)][_0x50a412(0x17b)][_0x50a412(0x1ae)]({'where':{'id':_0x4b3a47},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x43fbf8)return null;return{'id':_0x43fbf8['id'],'fullName':_0x43fbf8[_0x50a412(0x1e1)],'username':_0x43fbf8[_0x50a412(0x20b)],'telegramId':_0x43fbf8[_0x50a412(0x1c5)],'merchantUrl':_0x43fbf8[_0x50a412(0x15e)],'gateways':_0x43fbf8[_0x50a412(0x165)]?JSON[_0x50a412(0x249)](_0x43fbf8['paymentGateways']):null,'gatewaySettings':_0x43fbf8[_0x50a412(0x14e)]?JSON[_0x50a412(0x249)](_0x43fbf8['gatewaySettings']):null,'publicKey':_0x43fbf8['publicKey'],'wallets':{'usdtPolygonWallet':_0x43fbf8[_0x50a412(0x250)],'usdtTrcWallet':_0x43fbf8[_0x50a412(0x194)],'usdtErcWallet':_0x43fbf8[_0x50a412(0x184)],'usdcPolygonWallet':_0x43fbf8[_0x50a412(0x188)]},'status':_0x43fbf8[_0x50a412(0x1eb)],'createdAt':_0x43fbf8[_0x50a412(0x172)]};}async['createUser'](_0x709bff){const _0xab82e=a35_0x5cf0fd,{fullName:_0x502a44,username:_0x136508,password:_0x574214,telegramId:_0x4d3e45,merchantUrl:_0x52f0b5,gateways:_0x559318,gatewaySettings:_0x554101,wallets:_0x1b9f2d}=_0x709bff,_0x2368dc=await database_1[_0xab82e(0x14c)][_0xab82e(0x17b)][_0xab82e(0x1ae)]({'where':{'username':_0x136508}});if(_0x2368dc)throw new Error(_0xab82e(0x239));if(_0x4d3e45){const _0x1cb810=await database_1[_0xab82e(0x14c)][_0xab82e(0x17b)][_0xab82e(0x1ae)]({'where':{'telegram':_0x4d3e45}});if(_0x1cb810)throw new Error(_0xab82e(0x21c));}const _0xdf9637=await bcryptjs_1[_0xab82e(0x14c)][_0xab82e(0x258)](_0x574214,0xc),_0x992d35='pk_'+crypto_1[_0xab82e(0x14c)][_0xab82e(0x169)](0x20)[_0xab82e(0x22e)](_0xab82e(0x24f)),_0x5d1285=_0xab82e(0x18c)+crypto_1[_0xab82e(0x14c)][_0xab82e(0x169)](0x20)['toString']('hex'),_0x5d7a0b=await database_1[_0xab82e(0x14c)][_0xab82e(0x17b)]['create']({'data':{'name':_0x502a44,'username':_0x136508,'password':_0xdf9637,'telegram':_0x4d3e45,'shopUrl':_0x52f0b5,'paymentGateways':_0x559318?JSON['stringify'](_0x559318):null,'gatewaySettings':_0x554101?JSON[_0xab82e(0x1dd)](_0x554101):null,'usdtPolygonWallet':_0x1b9f2d?.[_0xab82e(0x250)]||null,'usdtTrcWallet':_0x1b9f2d?.['usdtTrcWallet']||null,'usdtErcWallet':_0x1b9f2d?.[_0xab82e(0x184)]||null,'usdcPolygonWallet':_0x1b9f2d?.[_0xab82e(0x188)]||null,'publicKey':_0x992d35,'secretKey':_0x5d1285,'status':_0xab82e(0x25f)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x5d7a0b['id'],'fullName':_0x5d7a0b[_0xab82e(0x1e1)],'username':_0x5d7a0b[_0xab82e(0x20b)],'telegramId':_0x5d7a0b['telegram'],'merchantUrl':_0x5d7a0b['shopUrl'],'gateways':_0x5d7a0b[_0xab82e(0x165)]?JSON[_0xab82e(0x249)](_0x5d7a0b['paymentGateways']):null,'gatewaySettings':_0x5d7a0b[_0xab82e(0x14e)]?JSON[_0xab82e(0x249)](_0x5d7a0b[_0xab82e(0x14e)]):null,'publicKey':_0x5d7a0b[_0xab82e(0x1d5)],'wallets':{'usdtPolygonWallet':_0x5d7a0b[_0xab82e(0x250)],'usdtTrcWallet':_0x5d7a0b['usdtTrcWallet'],'usdtErcWallet':_0x5d7a0b[_0xab82e(0x184)],'usdcPolygonWallet':_0x5d7a0b[_0xab82e(0x188)]},'status':_0x5d7a0b[_0xab82e(0x1eb)],'createdAt':_0x5d7a0b[_0xab82e(0x172)]};}async[a35_0x5cf0fd(0x1cf)](_0x4660b8){const _0x3daa54=a35_0x5cf0fd;await database_1[_0x3daa54(0x14c)][_0x3daa54(0x17b)]['delete']({'where':{'id':_0x4660b8}});}[a35_0x5cf0fd(0x15d)](_0x2282d3,_0x1c3015,_0x46bd6a){const _0x110b1d=a35_0x5cf0fd,_0x290d95=new Map(),_0x283050=new Date(_0x1c3015);while(_0x283050<=_0x46bd6a){const _0x1595da=_0x283050[_0x110b1d(0x19f)]()[_0x110b1d(0x171)]('T')[0x0];_0x290d95[_0x110b1d(0x17f)](_0x1595da,{'revenue':0x0,'count':0x0}),_0x283050[_0x110b1d(0x241)](_0x283050[_0x110b1d(0x1f7)]()+0x1);}for(const _0x37b335 of _0x2282d3){const _0x4ee735=_0x37b335[_0x110b1d(0x172)][_0x110b1d(0x19f)]()['split']('T')[0x0],_0x29610d=_0x290d95['get'](_0x4ee735);_0x29610d&&(_0x29610d[_0x110b1d(0x1db)]+=0x1,_0x37b335[_0x110b1d(0x1eb)]===_0x110b1d(0x251)&&(_0x37b335[_0x110b1d(0x159)]?_0x29610d[_0x110b1d(0x199)]+=_0x37b335[_0x110b1d(0x159)]:console[_0x110b1d(0x191)](_0x110b1d(0x1e6)+_0x37b335['id']+_0x110b1d(0x1b0))));}const _0x55ec44=[],_0x186180=[];for(const [_0x37bb43,_0x4d2983]of _0x290d95){_0x55ec44['push']({'date':_0x37bb43,'amount':Math[_0x110b1d(0x1b6)](_0x4d2983[_0x110b1d(0x199)]*0x64)/0x64}),_0x186180['push']({'date':_0x37bb43,'count':_0x4d2983[_0x110b1d(0x1db)]});}return{'dailyRevenue':_0x55ec44,'dailyPayments':_0x186180};}}exports[a35_0x5cf0fd(0x21b)]=AdminService;function a35_0x41ff(){const _0x3584dc=['💰\x20[PAYOUT]\x20Merchant\x20','fullName','getMonth','reduce','publicKey','join','\x20\x20\x20💰\x20Total\x20payout:\x20','_sum','Insufficient\x20balance.\x20Available:\x20','totalAmountUSDT','count','Noda','stringify','\x20status:\x20','\x20USDT','8024107UsIMON','name','🔍\x20Using\x20gateway\x20\x27','\x20merchants\x20with\x20positive\x20balance','trc20','📊\x20Merchant\x20statistics\x20calculated:','⚠️\x20Payment\x20','Plisio','aggregate','💰\x20Creating\x20payout\x20for\x20shop\x20','asc','status','📊\x20Gateway\x20filter\x20applied:','🔄\x20Admin\x20updating\x20payment\x20','findMany','getPaymentById','✅\x20Using\x20gateway\x20filter:\x20\x27','externalPaymentUrl','commissionUSDT','\x20in\x20','merchantUrl','CHARGEBACK','\x20\x20\x20�\x20Total\x20payments\x20turnover:\x20','getDate','Payment\x20not\x20found','toLowerCase','\x20\x20\x20Added\x20to\x20balance:\x20+','CoinToPay','\x20\x20\x20Merchant\x20gets:\x20','bcryptjs','18398904eyjrUM','\x20\x20\x20Full\x20amount:\x20','month','811217YoHNLC','toFixed','whiteUrl','crypto','__esModule','\x20USDT\x20(+','defineProperty','includes','📊\x20Available\x20gateways\x20in\x20database:','$transaction','username','Error\x20processing\x20payment\x20','getAllUsers','6TBPgGR','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','gte','💰\x20Payment\x20','\x20\x20\x20Transaction\x20hash:\x20','\x20order','30d','\x20balance\x20updated:','🔄\x20Converted\x20gateway\x20name\x20\x27','KLYME\x20DE','test_gateway','availableBalance','awaitingPayout','AdminService','Telegram\x20username\x20already\x20exists','\x20USDT\x20(after\x20','✅\x20Payout\x20created:\x20','customerEmail','payment','telegramId','forEach','date','totalPaidOut','\x20USDT\x20(after\x20payouts)','shopId','\x20no\x20longer\x20PAID:','admin','not\x20set','Test\x20Gateway','gateways','COMPLETED','averageCommissionRate','toString','\x20USDT\x20(','merchantEarnings','payout','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','1338033SJKcPU','summary','customerName','dateTo','wallets','1110415xgCuQK','Username\x20already\x20exists','activateUser','lte','suspendUser','statusChangedBy','💰\x20[PAYOUT]\x20Gateway\x20','statusChangedAt','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','setDate','ceil','password','📊\x20Calculating\x20payout\x20statistics...','dateFrom','values','Rapyd','updatedAt','parse','\x20\x20\x20Total\x20paid\x20out:\x20','deletePayout','0000','getMerchantsAwaitingPayout',',\x20Commission:\x20','hex','usdtPolygonWallet','PAID','amount','💳\x20Payout\x20wallet\x20for\x20','\x20\x20\x20💰\x20Total\x20payments\x20turnover:\x20','\x20\x20\x20🌍\x20Country:\x20','some','🔄\x20Converted\x20gateway\x20ID\x20\x27','hash','desc','update','__importDefault','💱\x20Currency\x20filter\x20applied:\x20','Shop\x20not\x20found','5978948bIVBIq','ACTIVE','getGatewayIdByName','%\x20commission)','default','getTime','gatewaySettings','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','gatewayOrderId','all','createPayout','notes','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','currencyService','paidAt','\x20\x20\x20🌐\x20IP:\x20','\x20\x20\x20📅\x20This\x20month:\x20','amountUSDT','\x20\x20\x20Balance:\x20','dailyRevenue','📊\x20Final\x20WHERE\x20conditions:','generateDailyStatistics','shopUrl','\x20for\x20shop\x20','getMerchantStatistics','convertToUSDT','totalCommissionRate','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','\x20balance\x20updated:\x20','paymentGateways','erc20','custom','\x27\x20->\x20name\x20\x27','randomBytes','length','\x20USDT\x20(actual\x20balances)','\x20USDT\x20from\x20balance','\x20active\x20merchants\x20for\x20selection','network','⚠️\x20Requested\x20gateway\x20\x27','period','split','createdAt','\x20\x20\x20💰\x20Total\x20turnover:\x20','merchantEarningsUSDT','dailyPayments','orderId','customerIp','failureMessage','📊\x20Getting\x20payments\x20with\x20filters:','\x20USDT,\x20Requested:\x20','shop','chargebackAmount','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','sort','set','thisMonth','gatewayEarnings','updateUser','KLYME\x20EU','usdtErcWallet','\x20\x20\x20✅\x20Actual\x20available\x20balance:\x20','turnover','💰\x20Found\x20','usdcPolygonWallet','polygon_usdc','\x20USDT\x20(gross\x20revenue)','insensitive','sk_','📅\x20Period:\x20','getMerchantsSelection','\x20\x20\x20✅\x20Total\x20available\x20for\x20payout:\x20','customerUa','log','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','_count','usdtTrcWallet','entries','💰\x20Shop\x20','periodTo','../types/gateway','revenue','\x20\x20\x20📊\x20Commission\x20difference:\x20','paymentsCount','commission','📊\x20Sorting\x20payments\x20by\x20','\x27\x20not\x20found.\x20Available\x20gateways:\x20','toISOString','localeCompare','💰\x20Current\x20shop\x20balance:\x20','\x20->\x20','turnoverUSDT','NONEXISTENT_GATEWAY_FILTER','📅\x20Period\x20\x27all\x27:\x20Using\x20start\x20date\x20from\x20first\x20payment:\x20','2020-01-01','💸\x20CHARGEBACK:\x20Merchant\x20amount\x20already\x20deducted\x20from\x20balance','gateway','\x27\x20(from\x20\x27','\x20\x20\x20Gateway:\x20','⚠️\x20Gateway\x20\x27','\x20merchants','\x20USDT\x20(total\x20paid\x20to\x20merchants)','findUnique','not\x20specified','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','SUSPENDED','findFirst','\x20\x20\x20📊\x20Total\x20payments:\x20','groupBy','error','round','totalAmountAfterCommissionUSDT','year','\x20payments)','customerCountry','adminNotes','txid','\x20\x20\x20💵\x20Available\x20balance:\x20','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','toUpperCase','\x27\x20->\x20ID\x20\x27','getAllPayments','amountAfterCommissionUSDT','balance','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','telegram','periodFrom','\x27\x20to\x20name\x20\x27','getUserById','995562ouRPLl','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','map','\x20became\x20PAID:','📋\x20Getting\x20merchants\x20selection\x20list...','currency','deleteUser','getFullYear'];a35_0x41ff=function(){return _0x3584dc;};return a35_0x41ff();}