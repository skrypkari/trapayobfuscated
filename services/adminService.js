'use strict';const a35_0x310b69=a35_0x339e;function a35_0x16ec(){const _0x4a6cec=['✅\x20Using\x20gateway\x20filter:\x20\x27','customerIp','publicKey','usdtErcWallet','paymentsCount','gatewayOrderId','\x27\x20to\x20name\x20\x27','toString','map','\x20\x20\x20💰\x20Total\x20payout:\x20','AdminService','\x20payments)','currencyService','\x27\x20->\x20ID\x20\x27','paidOutUSDT','getMerchantsAwaitingPayout','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','\x20USDT,\x20Requested:\x20','\x27\x20->\x20name\x20\x27','\x20balance\x20updated:','totalPayments','usdcPolygonWallet','shopUrl','payment','default','CHARGEBACK','failUrl','error','\x20\x20\x20📅\x20This\x20month:\x20','📊\x20Gateway\x20filter\x20applied:','gatewaySettings','polygon_usdc','\x20paid\x20payments\x20for\x20analysis','crypto','join','fullName','totalCommissionRate','updatedAt','test_gateway','txid','toUpperCase','getPayoutById','getMerchantsSelection','\x20USDT\x20(same\x20as\x20awaiting)','network','admin','delete','deletePayout','forEach','values','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','currency','count','includes','amount','getMonth','💰\x20Current\x20shop\x20balance:\x20','\x20->\x20','gateway','createUser','reduce','\x20\x20\x20🌍\x20Country:\x20','round','⚠️\x20Payment\x20','deleteUser','adminNotes','usdtTrcWallet','getGatewayDisplayName','Test\x20Gateway','merchantEarningsUSDT','\x20USDT','statusChangedAt','turnoverUSDT','getAllPayments','custom','customerCountry','all','\x20to\x20','11463624ZedKhl','findMany','💸\x20CHARGEBACK\x20penalty:\x20-','update','\x20for\x20shop\x20','entries','getAllUsers','\x20USDT\x20(','randomBytes','parse','length','stringify','Telegram\x20username\x20already\x20exists','KLYME\x20GB','ceil','📊\x20Total\x20payments\x20(including\x20failed):\x20','COMPLETED','trc20','🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','orderId','customerName','paymentGateways','getAllPayouts','not\x20specified','32008870UIdAVA','../types/gateway','payout','createPayout','__esModule','paidAt','thisMonth','hex','telegram','week','status','chargebackAmount','\x20merchants,\x20','failureMessage','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','\x20USDT\x20(total\x20merchant\x20balances)','KLYME\x20DE','KLYME\x20EU','🔍\x20Using\x20gateway\x20\x27','sort','telegramId','\x20no\x20longer\x20PAID:\x20-','📊\x20Sorting\x20payments\x20by\x20','getPayoutStats','set','findUnique','1294168QSaAqv','activateUser','asc','\x20USDT\x20(total\x20paid\x20to\x20merchants)','date','../config/database','gateways','externalPaymentUrl','balance','create','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','erc20','\x20merchants\x20with\x20positive\x20balance','Noda','bcryptjs','averageCommissionRate','sk_','period','password','_sum','usdtPolygonWallet','commissionUSDT','successUrl','customerEmail','Payment\x20not\x20found','70259jiQEyb','updateUser','generateDailyStatistics','split','dailyPayments','📊\x20Getting\x20payments\x20with\x20filters:','username','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','gatewayEarnings','awaitingPayout','Rapyd','defineProperty','getTime','dailyRevenue','dateTo','\x20became\x20PAID:\x20+','getGatewayNameById','💰\x20Creating\x20payout\x20for\x20shop\x20','toLowerCase','shopId','1VQLSlb','findFirst','toISOString','insensitive','shop','get','createdAt','some','merchantUrl','REFUND','getFullYear','_count','4688424PriPoa','periodFrom','0000','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','totalAmountAfterCommissionUSDT','aggregate','revenue','90d','\x20in\x20','SUSPENDED','availableBalance','📊\x20Payout\x20statistics\x20calculated:','wallet','notes','30d','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','\x27\x20(from\x20\x27','Shop\x20not\x20found','NONEXISTENT_GATEWAY_FILTER','🔄\x20Admin\x20updating\x20payment\x20','polygon','2684kNEsnL','suspendUser','📊\x20Merchants\x20awaiting\x20payout:\x20','name',',\x20successful:\x20','merchantEarnings','desc','🔄\x20Converted\x20gateway\x20name\x20\x27','\x20\x20\x20💵\x20Available\x20balance:\x20','💳\x20Payout\x20wallet\x20for\x20','turnover','⚠️\x20Requested\x20gateway\x20\x27','Plisio','localeCompare','💰\x20Payment\x20','periodTo','amountUSDT','\x27\x20not\x20found.\x20Available\x20gateways:\x20','2020-01-01','✅\x20Payout\x20created:\x20','gte','\x20\x20\x20Current\x20balance:\x20','push','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','\x20\x20\x20🌐\x20IP:\x20','⚠️\x20Gateway\x20\x27','\x20USDT)','3705REPcoK','\x20USDT\x20to\x20balance','dateFrom','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','\x20USDT\x20(+','wallets','averageCheckUSDT','getMerchantStatistics','📊\x20Available\x20gateways\x20in\x20database:','📊\x20Merchant\x20statistics\x20calculated:','getSystemStatistics','💱\x20Currency\x20filter\x20applied:\x20','customerUa','PAID','CoinToPay','\x20\x20\x20🖥️\x20User\x20Agent:\x20','\x20active\x20merchants\x20for\x20selection','📅\x20Period:\x20','statusChangedBy','$transaction','totalTurnover','ACTIVE','totalPaidOut','pk_','whiteUrl','🔄\x20Converted\x20gateway\x20ID\x20\x27',':\x20commission\x20=\x20','commission','2824755McEqGX','📊\x20Final\x20WHERE\x20conditions:','💰\x20Shop\x20','💰\x20Found\x20','./currencyService','\x20USDT\x20(-','11WgcSBF','getGatewayIdByName','\x20USDT\x20from\x20balance','📊\x20Calculating\x20payout\x20statistics...','log','convertToUSDT','toFixed','464itDcFi'];a35_0x16ec=function(){return _0x4a6cec;};return a35_0x16ec();}(function(_0x517500,_0x3e9889){const _0x567e0d=a35_0x339e,_0x36667a=_0x517500();while(!![]){try{const _0x1b1b5a=-parseInt(_0x567e0d(0x1c2))/0x1*(-parseInt(_0x567e0d(0x2a9))/0x2)+-parseInt(_0x567e0d(0x21b))/0x3+-parseInt(_0x567e0d(0x1e4))/0x4*(-parseInt(_0x567e0d(0x1ff))/0x5)+-parseInt(_0x567e0d(0x1ce))/0x6+-parseInt(_0x567e0d(0x1ae))/0x7*(parseInt(_0x567e0d(0x228))/0x8)+-parseInt(_0x567e0d(0x277))/0x9+-parseInt(_0x567e0d(0x28f))/0xa*(-parseInt(_0x567e0d(0x221))/0xb);if(_0x1b1b5a===_0x3e9889)break;else _0x36667a['push'](_0x36667a['shift']());}catch(_0x11d41b){_0x36667a['push'](_0x36667a['shift']());}}}(a35_0x16ec,0xbb167));function a35_0x339e(_0x401959,_0xedb01d){const _0x16ecd3=a35_0x16ec();return a35_0x339e=function(_0x339eeb,_0xd5e5d){_0x339eeb=_0x339eeb-0x19d;let _0x17c645=_0x16ecd3[_0x339eeb];return _0x17c645;},a35_0x339e(_0x401959,_0xedb01d);}var __importDefault=this&&this['__importDefault']||function(_0x1f90a1){const _0x655032=a35_0x339e;return _0x1f90a1&&_0x1f90a1[_0x655032(0x293)]?_0x1f90a1:{'default':_0x1f90a1};};Object[a35_0x310b69(0x1b9)](exports,a35_0x310b69(0x293),{'value':!![]}),exports[a35_0x310b69(0x233)]=void 0x0;const database_1=__importDefault(require(a35_0x310b69(0x2ae))),bcryptjs_1=__importDefault(require(a35_0x310b69(0x1a3))),crypto_1=__importDefault(require(a35_0x310b69(0x24a))),currencyService_1=require(a35_0x310b69(0x21f)),gateway_1=require(a35_0x310b69(0x290));class AdminService{async[a35_0x310b69(0x2a6)](){const _0x21a713=a35_0x310b69;console['log'](_0x21a713(0x224));const _0x420931=await database_1[_0x21a713(0x241)][_0x21a713(0x1c6)][_0x21a713(0x1d3)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x21a713(0x214)}}),_0x5af71f=new Date(),_0x4b152e=new Date(_0x5af71f[_0x21a713(0x1cc)](),_0x5af71f[_0x21a713(0x260)](),0x1),_0x5a15c5=new Date(_0x5af71f[_0x21a713(0x1cc)](),_0x5af71f[_0x21a713(0x260)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0xaafec=await database_1[_0x21a713(0x241)][_0x21a713(0x291)][_0x21a713(0x1d3)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x4b152e,'lte':_0x5a15c5},'status':_0x21a713(0x287)}}),_0x1b5308=_0x420931[_0x21a713(0x1a8)]['totalPaidOut']||0x0,_0x28c58e=_0x420931['_sum']['balance']||0x0,_0x454531=_0xaafec[_0x21a713(0x1a8)][_0x21a713(0x25f)]||0x0,_0x4e603c={'totalPayout':Math['round'](_0x1b5308*0x64)/0x64,'awaitingPayout':Math[_0x21a713(0x267)](_0x28c58e*0x64)/0x64,'thisMonth':Math[_0x21a713(0x267)](_0x454531*0x64)/0x64,'availableBalance':Math[_0x21a713(0x267)](_0x28c58e*0x64)/0x64};return console[_0x21a713(0x225)](_0x21a713(0x1d9)),console[_0x21a713(0x225)](_0x21a713(0x232)+_0x4e603c['totalPayout']+_0x21a713(0x2ac)),console[_0x21a713(0x225)]('\x20\x20\x20⏳\x20Awaiting\x20payout:\x20'+_0x4e603c[_0x21a713(0x1b7)]+_0x21a713(0x29e)),console['log'](_0x21a713(0x1ec)+_0x4e603c[_0x21a713(0x1d8)]+_0x21a713(0x254)),console[_0x21a713(0x225)](_0x21a713(0x245)+_0x4e603c[_0x21a713(0x295)]+_0x21a713(0x26f)),_0x4e603c;}async['updateCustomerData'](_0x44b9dd,_0x23b2aa){const _0x24996=a35_0x310b69;console[_0x24996(0x225)](_0x24996(0x29d)+_0x44b9dd+':',_0x23b2aa);const _0xb4942a=await database_1[_0x24996(0x241)][_0x24996(0x240)][_0x24996(0x2a8)]({'where':{'id':_0x44b9dd},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0xb4942a)throw new Error('Payment\x20not\x20found');const _0x506add={};_0x23b2aa['customerCountry']!==undefined&&(_0x506add[_0x24996(0x274)]=_0x23b2aa[_0x24996(0x274)]||null);_0x23b2aa[_0x24996(0x22a)]!==undefined&&(_0x506add['customerIp']=_0x23b2aa[_0x24996(0x22a)]||null);_0x23b2aa['customerUa']!==undefined&&(_0x506add['customerUa']=_0x23b2aa['customerUa']||null);const _0x33255a=await database_1['default'][_0x24996(0x240)][_0x24996(0x27a)]({'where':{'id':_0x44b9dd},'data':{..._0x506add,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x24996(0x225)](_0x24996(0x19f)+_0x44b9dd),console[_0x24996(0x225)](_0x24996(0x266)+_0xb4942a[_0x24996(0x274)]+_0x24996(0x262)+_0x33255a['customerCountry']),console[_0x24996(0x225)](_0x24996(0x1fc)+_0xb4942a[_0x24996(0x22a)]+_0x24996(0x262)+_0x33255a[_0x24996(0x22a)]),console['log'](_0x24996(0x20e)+(_0xb4942a[_0x24996(0x20b)]?_0x24996(0x2a7):'not\x20set')+_0x24996(0x262)+(_0x33255a[_0x24996(0x20b)]?_0x24996(0x2a7):'not\x20set')),_0x33255a;}async[a35_0x310b69(0x209)](_0x14d934){const _0x233612=a35_0x310b69,_0x483e52=new Date();let _0x41a4a;switch(_0x14d934){case'7d':_0x41a4a=new Date(_0x483e52[_0x233612(0x1ba)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x233612(0x1dc):_0x41a4a=new Date(_0x483e52[_0x233612(0x1ba)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x233612(0x1d5):_0x41a4a=new Date(_0x483e52[_0x233612(0x1ba)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x233612(0x275):const _0x4da841=await database_1[_0x233612(0x241)][_0x233612(0x240)][_0x233612(0x1c3)]({'where':{'gateway':{'not':_0x233612(0x24f)}},'orderBy':{'createdAt':_0x233612(0x2ab)},'select':{'createdAt':!![]}});_0x41a4a=_0x4da841?_0x4da841['createdAt']:new Date('2020-01-01'),console[_0x233612(0x225)]('📅\x20Period\x20\x27all\x27:\x20Using\x20start\x20date\x20from\x20first\x20payment:\x20'+_0x41a4a[_0x233612(0x1c4)]());break;default:_0x41a4a=new Date(_0x483e52[_0x233612(0x1ba)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x1d8445,_0x2554aa,_0x485e07,_0x3c968d,_0x55b404,_0x390265,_0x165e1d]=await Promise[_0x233612(0x275)]([database_1['default']['shop']['count'](),database_1[_0x233612(0x241)]['shop'][_0x233612(0x25d)]({'where':{'status':_0x233612(0x214)}}),database_1[_0x233612(0x241)][_0x233612(0x240)][_0x233612(0x25d)]({'where':{'createdAt':{'gte':_0x41a4a},'gateway':{'not':_0x233612(0x24f)}}}),database_1['default'][_0x233612(0x240)]['count']({'where':{'status':_0x233612(0x20c),'createdAt':{'gte':_0x41a4a},'gateway':{'not':_0x233612(0x24f)}}}),database_1[_0x233612(0x241)][_0x233612(0x240)][_0x233612(0x278)]({'where':{'status':_0x233612(0x20c),'createdAt':{'gte':_0x41a4a},'gateway':{'not':_0x233612(0x24f)}},'select':{'amount':!![],'currency':!![]}}),database_1[_0x233612(0x241)][_0x233612(0x240)]['findMany']({'where':{'gateway':{'not':'test_gateway'}},'take':0xa,'orderBy':{'createdAt':_0x233612(0x1ea)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x233612(0x241)][_0x233612(0x240)][_0x233612(0x278)]({'where':{'createdAt':{'gte':_0x41a4a},'gateway':{'not':_0x233612(0x24f)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x418a56=0x0;for(const _0x47f831 of _0x55b404){const _0x103a7f=await currencyService_1[_0x233612(0x235)]['convertToUSDT'](_0x47f831['amount'],_0x47f831[_0x233612(0x25c)]);_0x418a56+=_0x103a7f;}const _0x418c77=this[_0x233612(0x1b0)](_0x165e1d,_0x41a4a,_0x483e52),_0x216806=_0x485e07>0x0?_0x3c968d/_0x485e07*0x64:0x0;return{'totalShops':_0x1d8445,'activeShops':_0x2554aa,'totalPayments':_0x485e07,'successfulPayments':_0x3c968d,'totalRevenue':Math[_0x233612(0x267)](_0x418a56*0x64)/0x64,'conversionRate':Math['round'](_0x216806*0x64)/0x64,'dailyRevenue':_0x418c77[_0x233612(0x1bb)],'dailyPayments':_0x418c77[_0x233612(0x1b2)],'recentPayments':_0x390265[_0x233612(0x231)](_0x57adaf=>({'id':_0x57adaf['id'],'amount':_0x57adaf[_0x233612(0x25f)],'currency':_0x57adaf['currency'],'status':_0x57adaf['status'],'gateway':_0x57adaf[_0x233612(0x263)],'shop':_0x57adaf[_0x233612(0x1c6)],'createdAt':_0x57adaf[_0x233612(0x1c8)]}))};}async[a35_0x310b69(0x206)](_0x4f9052){const _0x52fa1a=a35_0x310b69;console[_0x52fa1a(0x225)](_0x52fa1a(0x1b5),_0x4f9052);let _0x595de3,_0x292360=new Date();if(_0x4f9052[_0x52fa1a(0x1a6)]===_0x52fa1a(0x273)&&_0x4f9052[_0x52fa1a(0x201)]&&_0x4f9052[_0x52fa1a(0x1bc)])_0x595de3=new Date(_0x4f9052[_0x52fa1a(0x201)]),_0x292360=new Date(_0x4f9052[_0x52fa1a(0x1bc)]);else{const _0x48e806=new Date();switch(_0x4f9052[_0x52fa1a(0x1a6)]){case _0x52fa1a(0x298):_0x595de3=new Date(_0x48e806[_0x52fa1a(0x1ba)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'month':_0x595de3=new Date(_0x48e806[_0x52fa1a(0x1ba)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'year':_0x595de3=new Date(_0x48e806[_0x52fa1a(0x1ba)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x52fa1a(0x275):default:_0x595de3=new Date(_0x52fa1a(0x1f6));break;}}console['log'](_0x52fa1a(0x210)+_0x595de3['toISOString']()+_0x52fa1a(0x276)+_0x292360[_0x52fa1a(0x1c4)]());const _0x41bfdb={'status':_0x52fa1a(0x20c),'gateway':{'not':_0x52fa1a(0x24f)},'paidAt':{'gte':_0x595de3,'lte':_0x292360}};_0x4f9052['shopId']&&(_0x41bfdb[_0x52fa1a(0x1c1)]=_0x4f9052[_0x52fa1a(0x1c1)]);const _0x595f34=await database_1[_0x52fa1a(0x241)][_0x52fa1a(0x240)]['findMany']({'where':_0x41bfdb,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console['log'](_0x52fa1a(0x21e)+_0x595f34[_0x52fa1a(0x281)]+_0x52fa1a(0x249));const _0x230c5a={'gateway':{'not':_0x52fa1a(0x24f)},'createdAt':{'gte':_0x595de3,'lte':_0x292360}};_0x4f9052[_0x52fa1a(0x1c1)]&&(_0x230c5a[_0x52fa1a(0x1c1)]=_0x4f9052[_0x52fa1a(0x1c1)]);const _0x5cd5a7=await database_1['default']['payment'][_0x52fa1a(0x25d)]({'where':_0x230c5a});console[_0x52fa1a(0x225)](_0x52fa1a(0x286)+_0x5cd5a7+_0x52fa1a(0x1e8)+_0x595f34[_0x52fa1a(0x281)]);let _0x1b7889=0x0,_0x1de99f=0x0,_0x4d737b=0x0;const _0x477fa1={},_0x11dc08={},_0x1176e3={};for(const _0x28f2a6 of _0x595f34){try{const _0xd05aeb=await currencyService_1[_0x52fa1a(0x235)][_0x52fa1a(0x226)](_0x28f2a6[_0x52fa1a(0x25f)],_0x28f2a6[_0x52fa1a(0x25c)]);let _0x3bebfe={};if(_0x28f2a6[_0x52fa1a(0x1c6)][_0x52fa1a(0x247)])try{_0x3bebfe=JSON[_0x52fa1a(0x280)](_0x28f2a6[_0x52fa1a(0x1c6)][_0x52fa1a(0x247)]);}catch(_0x3997aa){console[_0x52fa1a(0x244)](_0x52fa1a(0x1fb)+_0x28f2a6['shopId']+':',_0x3997aa);}let _0x88d83d={},_0x208279=0xa;for(const [_0x12bd1b,_0x4d8572]of Object[_0x52fa1a(0x27c)](_0x3bebfe)){if(_0x12bd1b[_0x52fa1a(0x1c0)]()===_0x28f2a6[_0x52fa1a(0x263)][_0x52fa1a(0x1c0)]()){_0x88d83d=_0x4d8572,_0x208279=_0x4d8572['commission']||0xa;break;}}const _0x1af189=_0xd05aeb*(_0x208279/0x64),_0x339e46=_0xd05aeb-_0x1af189;_0x1b7889+=_0xd05aeb,_0x1de99f+=_0x339e46,_0x4d737b+=_0x1af189;!_0x477fa1[_0x28f2a6[_0x52fa1a(0x263)]]&&(_0x477fa1[_0x28f2a6[_0x52fa1a(0x263)]]={'gateway':_0x28f2a6[_0x52fa1a(0x263)],'gatewayDisplayName':this[_0x52fa1a(0x26c)](_0x28f2a6[_0x52fa1a(0x263)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x477fa1[_0x28f2a6['gateway']][_0x52fa1a(0x22d)]++,_0x477fa1[_0x28f2a6['gateway']][_0x52fa1a(0x271)]+=_0xd05aeb,_0x477fa1[_0x28f2a6['gateway']][_0x52fa1a(0x1aa)]+=_0x1af189,_0x477fa1[_0x28f2a6[_0x52fa1a(0x263)]][_0x52fa1a(0x26e)]+=_0x339e46,_0x477fa1[_0x28f2a6[_0x52fa1a(0x263)]][_0x52fa1a(0x24d)]+=_0x208279;!_0x4f9052['shopId']&&(!_0x11dc08[_0x28f2a6[_0x52fa1a(0x1c1)]]&&(_0x11dc08[_0x28f2a6[_0x52fa1a(0x1c1)]]={'shopId':_0x28f2a6[_0x52fa1a(0x1c1)],'shopName':_0x28f2a6[_0x52fa1a(0x1c6)][_0x52fa1a(0x1e7)],'shopUsername':_0x28f2a6[_0x52fa1a(0x1c6)][_0x52fa1a(0x1b4)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x11dc08[_0x28f2a6[_0x52fa1a(0x1c1)]][_0x52fa1a(0x22d)]++,_0x11dc08[_0x28f2a6[_0x52fa1a(0x1c1)]][_0x52fa1a(0x271)]+=_0xd05aeb,_0x11dc08[_0x28f2a6[_0x52fa1a(0x1c1)]][_0x52fa1a(0x1aa)]+=_0x1af189,_0x11dc08[_0x28f2a6[_0x52fa1a(0x1c1)]][_0x52fa1a(0x26e)]+=_0x339e46);const _0x2e45e1=_0x28f2a6[_0x52fa1a(0x294)][_0x52fa1a(0x1c4)]()['split']('T')[0x0];!_0x1176e3[_0x2e45e1]&&(_0x1176e3[_0x2e45e1]={'date':_0x2e45e1,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x1176e3[_0x2e45e1][_0x52fa1a(0x1ee)]+=_0xd05aeb,_0x1176e3[_0x2e45e1][_0x52fa1a(0x1e9)]+=_0x339e46,_0x1176e3[_0x2e45e1]['gatewayEarnings']+=_0x1af189,_0x1176e3[_0x2e45e1][_0x52fa1a(0x22d)]++;}catch(_0x55a7ae){console[_0x52fa1a(0x244)]('Error\x20processing\x20payment\x20'+_0x28f2a6['id']+':',_0x55a7ae);}}Object[_0x52fa1a(0x25a)](_0x477fa1)['forEach'](_0x5f0d1a=>{const _0x16bca0=_0x52fa1a;_0x5f0d1a[_0x16bca0(0x1a4)]=_0x5f0d1a['paymentsCount']>0x0?_0x5f0d1a[_0x16bca0(0x24d)]/_0x5f0d1a[_0x16bca0(0x22d)]:0x0,delete _0x5f0d1a['totalCommissionRate'];}),Object['values'](_0x11dc08)[_0x52fa1a(0x259)](_0x539103=>{const _0x42d672=_0x52fa1a;_0x539103['averageCheckUSDT']=_0x539103[_0x42d672(0x22d)]>0x0?_0x539103['turnoverUSDT']/_0x539103[_0x42d672(0x22d)]:0x0;});let _0xd9f8a0=0x0;if(_0x4f9052[_0x52fa1a(0x1c1)]){const _0x3ffccb=await database_1[_0x52fa1a(0x241)][_0x52fa1a(0x291)][_0x52fa1a(0x278)]({'where':{'shopId':_0x4f9052[_0x52fa1a(0x1c1)],'status':'COMPLETED','createdAt':{'gte':_0x595de3,'lte':_0x292360}},'select':{'amount':!![]}});_0xd9f8a0=_0x3ffccb[_0x52fa1a(0x265)]((_0x2272b2,_0x14f3d4)=>_0x2272b2+_0x14f3d4[_0x52fa1a(0x25f)],0x0);}const _0x598fc0=_0x5cd5a7,_0x8c81ef=_0x595f34[_0x52fa1a(0x281)],_0x339a21=_0x8c81ef>0x0?_0x1b7889/_0x8c81ef:0x0,_0x594127=_0x598fc0>0x0?Math[_0x52fa1a(0x267)](_0x8c81ef/_0x598fc0*0x2710)/0x64:0x0,_0x13d14a=Math[_0x52fa1a(0x285)]((_0x292360[_0x52fa1a(0x1ba)]()-_0x595de3['getTime']())/(0x3e8*0x3c*0x3c*0x18)),_0x1dbae1={'totalTurnover':Math[_0x52fa1a(0x267)](_0x1b7889*0x64)/0x64,'merchantEarnings':Math[_0x52fa1a(0x267)](_0x1de99f*0x64)/0x64,'gatewayEarnings':Math['round'](_0x4d737b*0x64)/0x64,'totalPaidOut':Math[_0x52fa1a(0x267)](_0xd9f8a0*0x64)/0x64,'averageCheck':Math[_0x52fa1a(0x267)](_0x339a21*0x64)/0x64,'totalPayments':_0x598fc0,'successfulPayments':_0x8c81ef,'conversionRate':_0x594127,'gatewayBreakdown':Object[_0x52fa1a(0x25a)](_0x477fa1)[_0x52fa1a(0x231)](_0x2323f0=>({..._0x2323f0,'turnoverUSDT':Math[_0x52fa1a(0x267)](_0x2323f0[_0x52fa1a(0x271)]*0x64)/0x64,'commissionUSDT':Math[_0x52fa1a(0x267)](_0x2323f0[_0x52fa1a(0x1aa)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x52fa1a(0x267)](_0x2323f0['merchantEarningsUSDT']*0x64)/0x64,'averageCommissionRate':Math[_0x52fa1a(0x267)](_0x2323f0[_0x52fa1a(0x1a4)]*0x64)/0x64})),'merchantBreakdown':_0x4f9052[_0x52fa1a(0x1c1)]?undefined:Object['values'](_0x11dc08)[_0x52fa1a(0x231)](_0x4eda56=>({..._0x4eda56,'turnoverUSDT':Math[_0x52fa1a(0x267)](_0x4eda56[_0x52fa1a(0x271)]*0x64)/0x64,'commissionUSDT':Math[_0x52fa1a(0x267)](_0x4eda56[_0x52fa1a(0x1aa)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x4eda56[_0x52fa1a(0x26e)]*0x64)/0x64,'paidOutUSDT':Math[_0x52fa1a(0x267)](_0x4eda56[_0x52fa1a(0x237)]*0x64)/0x64,'averageCheckUSDT':Math['round'](_0x4eda56[_0x52fa1a(0x205)]*0x64)/0x64})),'dailyData':Object[_0x52fa1a(0x25a)](_0x1176e3)[_0x52fa1a(0x231)](_0x5f00f1=>({..._0x5f00f1,'turnover':Math[_0x52fa1a(0x267)](_0x5f00f1[_0x52fa1a(0x1ee)]*0x64)/0x64,'merchantEarnings':Math[_0x52fa1a(0x267)](_0x5f00f1[_0x52fa1a(0x1e9)]*0x64)/0x64,'gatewayEarnings':Math[_0x52fa1a(0x267)](_0x5f00f1[_0x52fa1a(0x1b6)]*0x64)/0x64}))[_0x52fa1a(0x2a2)]((_0x257296,_0x4a4d18)=>_0x257296[_0x52fa1a(0x2ad)][_0x52fa1a(0x1f1)](_0x4a4d18['date'])),'periodInfo':{'from':_0x595de3,'to':_0x292360,'periodType':_0x4f9052[_0x52fa1a(0x1a6)]||'custom','daysCount':_0x13d14a}};return console[_0x52fa1a(0x225)](_0x52fa1a(0x208)),console[_0x52fa1a(0x225)]('\x20\x20\x20💰\x20Total\x20turnover:\x20'+_0x1dbae1[_0x52fa1a(0x213)]+_0x52fa1a(0x26f)),console[_0x52fa1a(0x225)](_0x52fa1a(0x1d1)+_0x1dbae1['merchantEarnings']+_0x52fa1a(0x26f)),console[_0x52fa1a(0x225)](_0x52fa1a(0x1de)+_0x1dbae1[_0x52fa1a(0x1b6)]+_0x52fa1a(0x26f)),console[_0x52fa1a(0x225)]('\x20\x20\x20📊\x20Total\x20payments:\x20'+_0x1dbae1[_0x52fa1a(0x23d)]),_0x1dbae1;}async[a35_0x310b69(0x253)](){const _0x4d5bcb=a35_0x310b69;console[_0x4d5bcb(0x225)]('📋\x20Getting\x20merchants\x20selection\x20list...');const _0x1babf3=await database_1['default'][_0x4d5bcb(0x1c6)][_0x4d5bcb(0x278)]({'where':{'status':_0x4d5bcb(0x214)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x4d5bcb(0x2ab)}});return console[_0x4d5bcb(0x225)]('📋\x20Found\x20'+_0x1babf3[_0x4d5bcb(0x281)]+_0x4d5bcb(0x20f)),_0x1babf3['map'](_0x455565=>({'id':_0x455565['id'],'username':_0x455565[_0x4d5bcb(0x1b4)],'name':_0x455565[_0x4d5bcb(0x1e7)]}));}[a35_0x310b69(0x26c)](_0x416f72){const _0x2e10a9=a35_0x310b69,_0x5c18b5={'test_gateway':_0x2e10a9(0x26d),'plisio':_0x2e10a9(0x1f0),'rapyd':_0x2e10a9(0x1b8),'noda':_0x2e10a9(0x1a2),'cointopay':_0x2e10a9(0x20d),'klyme_eu':_0x2e10a9(0x2a0),'klyme_gb':_0x2e10a9(0x284),'klyme_de':_0x2e10a9(0x29f)};return _0x5c18b5[_0x416f72]||_0x416f72;}async[a35_0x310b69(0x238)](_0x643968){const _0x1dc0c7=a35_0x310b69,{page:_0x419361,limit:_0xe7a431,minAmount:_0x525423,search:_0x2217f0}=_0x643968,_0x13284c=(_0x419361-0x1)*_0xe7a431;console[_0x1dc0c7(0x225)](_0x1dc0c7(0x1dd),_0x643968);const _0x490aba={'balance':{'gt':0x0},'status':_0x1dc0c7(0x214)};_0x525423&&(_0x490aba[_0x1dc0c7(0x19d)]['gte']=_0x525423);_0x2217f0&&(_0x490aba['OR']=[{'name':{'contains':_0x2217f0,'mode':'insensitive'}},{'username':{'contains':_0x2217f0,'mode':_0x1dc0c7(0x1c5)}}]);const [_0x596a23,_0x15f5a0]=await Promise[_0x1dc0c7(0x275)]([database_1[_0x1dc0c7(0x241)]['shop'][_0x1dc0c7(0x278)]({'where':_0x490aba,'skip':_0x13284c,'take':_0xe7a431,'orderBy':{'balance':_0x1dc0c7(0x1ea)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1[_0x1dc0c7(0x241)][_0x1dc0c7(0x1c6)][_0x1dc0c7(0x25d)]({'where':_0x490aba})]);console[_0x1dc0c7(0x225)](_0x1dc0c7(0x21e)+_0x596a23[_0x1dc0c7(0x281)]+_0x1dc0c7(0x1a1));const _0x267b66=await Promise['all'](_0x596a23[_0x1dc0c7(0x231)](async _0x117b84=>{const _0x4bf708=_0x1dc0c7,[_0x4a7c8e,_0x44bee1,_0x38cb39]=await Promise[_0x4bf708(0x275)]([database_1[_0x4bf708(0x241)]['payment'][_0x4bf708(0x25d)]({'where':{'shopId':_0x117b84['id'],'status':_0x4bf708(0x20c),'amountUSDT':{'not':null}}}),database_1[_0x4bf708(0x241)][_0x4bf708(0x240)][_0x4bf708(0x1c3)]({'where':{'shopId':_0x117b84['id'],'status':_0x4bf708(0x20c),'amountUSDT':{'not':null}},'orderBy':{'paidAt':_0x4bf708(0x2ab)},'select':{'paidAt':!![]}}),database_1[_0x4bf708(0x241)][_0x4bf708(0x240)]['groupBy']({'by':['gateway'],'where':{'shopId':_0x117b84['id'],'status':_0x4bf708(0x20c),'amountUSDT':{'not':null}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x5909ea=await Promise[_0x4bf708(0x275)](_0x38cb39[_0x4bf708(0x231)](async _0x16084c=>{const _0x3f1c80=_0x4bf708;let _0x4aa597=0xa;if(_0x117b84['gatewaySettings'])try{const _0x4837f0=JSON['parse'](_0x117b84[_0x3f1c80(0x247)]);for(const [_0x29839e,_0xbeb2b8]of Object[_0x3f1c80(0x27c)](_0x4837f0)){if(_0x29839e[_0x3f1c80(0x1c0)]()===_0x16084c[_0x3f1c80(0x263)][_0x3f1c80(0x1c0)]()){_0x4aa597=_0xbeb2b8[_0x3f1c80(0x21a)]||0xa,console[_0x3f1c80(0x225)]('💰\x20[PAYOUT]\x20Gateway\x20'+_0x16084c[_0x3f1c80(0x263)]+_0x3f1c80(0x27b)+_0x117b84['id']+_0x3f1c80(0x219)+_0x4aa597+'%');break;}}}catch(_0x49a1ef){console[_0x3f1c80(0x244)](_0x3f1c80(0x1fb)+_0x117b84['id']+':',_0x49a1ef);}const _0x1e2436=_0x16084c[_0x3f1c80(0x1a8)][_0x3f1c80(0x1f4)]||0x0,_0x4487ad=_0x1e2436*(0x1-_0x4aa597/0x64);return{'gateway':_0x16084c[_0x3f1c80(0x263)],'count':_0x16084c[_0x3f1c80(0x1cd)]['id'],'amountUSDT':Math[_0x3f1c80(0x267)](_0x1e2436*0x64)/0x64,'amountAfterCommissionUSDT':Math['round'](_0x4487ad*0x64)/0x64,'commission':_0x4aa597};})),_0x39353b=_0x5909ea['reduce']((_0xf31e4a,_0x377e1b)=>_0xf31e4a+_0x377e1b[_0x4bf708(0x1f4)],0x0),_0x2f1dc7=_0x5909ea[_0x4bf708(0x265)]((_0x55ce08,_0x3e363f)=>_0x55ce08+_0x3e363f['amountAfterCommissionUSDT'],0x0);return{'id':_0x117b84['id'],'fullName':_0x117b84['name'],'username':_0x117b84[_0x4bf708(0x1b4)],'telegramId':_0x117b84[_0x4bf708(0x297)],'merchantUrl':_0x117b84[_0x4bf708(0x23f)],'wallets':{'usdtPolygonWallet':_0x117b84[_0x4bf708(0x1a9)],'usdtTrcWallet':_0x117b84[_0x4bf708(0x26b)],'usdtErcWallet':_0x117b84['usdtErcWallet'],'usdcPolygonWallet':_0x117b84[_0x4bf708(0x23e)]},'totalAmountUSDT':Math['round'](_0x39353b*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x4bf708(0x267)](_0x2f1dc7*0x64)/0x64,'paymentsCount':_0x4a7c8e,'oldestPaymentDate':_0x44bee1?.[_0x4bf708(0x294)]||_0x117b84['createdAt'],'gatewayBreakdown':_0x5909ea};})),_0x309e6d=_0x267b66[_0x1dc0c7(0x265)]((_0x490365,_0x3fb8a6)=>_0x490365+_0x3fb8a6['totalAmountUSDT'],0x0),_0x4dd850=_0x267b66[_0x1dc0c7(0x265)]((_0x2006af,_0x5ce638)=>_0x2006af+_0x5ce638[_0x1dc0c7(0x1d2)],0x0);return console[_0x1dc0c7(0x225)](_0x1dc0c7(0x1e6)+_0x15f5a0+_0x1dc0c7(0x29b)+Math[_0x1dc0c7(0x267)](_0x4dd850*0x64)/0x64+'\x20USDT\x20total'),{'merchants':_0x267b66,'pagination':{'page':_0x419361,'limit':_0xe7a431,'total':_0x15f5a0,'totalPages':Math[_0x1dc0c7(0x285)](_0x15f5a0/_0xe7a431)},'summary':{'totalMerchants':_0x15f5a0,'totalAmountUSDT':Math['round'](_0x309e6d*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x4dd850*0x64)/0x64}};}async[a35_0x310b69(0x292)](_0x21ebc7){const _0x1493f0=a35_0x310b69,{shopId:_0x5063b6,amount:_0x14928a,network:_0x217e2f,wallet:_0x170c6a,notes:_0x435646,txid:_0x35537a,periodFrom:_0x437b87,periodTo:_0x1ececc}=_0x21ebc7,_0x21a9c2=await database_1[_0x1493f0(0x241)][_0x1493f0(0x212)](async _0x424900=>{const _0x4f7e41=_0x1493f0,_0x40cb6a=await _0x424900[_0x4f7e41(0x1c6)][_0x4f7e41(0x2a8)]({'where':{'id':_0x5063b6},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x40cb6a)throw new Error(_0x4f7e41(0x1e0));console[_0x4f7e41(0x225)](_0x4f7e41(0x1bf)+_0x40cb6a[_0x4f7e41(0x1b4)]+':'),console[_0x4f7e41(0x225)](_0x4f7e41(0x1f9)+_0x40cb6a['balance'][_0x4f7e41(0x227)](0x6)+_0x4f7e41(0x26f)),console['log']('\x20\x20\x20Payout\x20amount:\x20'+_0x14928a['toFixed'](0x6)+_0x4f7e41(0x26f)),console[_0x4f7e41(0x225)](_0x4f7e41(0x202)+_0x40cb6a['totalPaidOut'][_0x4f7e41(0x227)](0x6)+_0x4f7e41(0x26f));if(_0x35537a)console[_0x4f7e41(0x225)]('\x20\x20\x20Transaction\x20hash:\x20'+_0x35537a);if(_0x40cb6a[_0x4f7e41(0x19d)]<_0x14928a)throw new Error('Insufficient\x20balance.\x20Available:\x20'+_0x40cb6a[_0x4f7e41(0x19d)][_0x4f7e41(0x227)](0x6)+_0x4f7e41(0x23a)+_0x14928a[_0x4f7e41(0x227)](0x6)+_0x4f7e41(0x26f));let _0x35cd8e=_0x170c6a;if(!_0x35cd8e){const _0x27b90b=await _0x424900[_0x4f7e41(0x1c6)][_0x4f7e41(0x2a8)]({'where':{'id':_0x5063b6},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x27b90b)switch(_0x217e2f){case _0x4f7e41(0x1e3):_0x35cd8e=_0x27b90b[_0x4f7e41(0x1a9)]||undefined;break;case _0x4f7e41(0x288):_0x35cd8e=_0x27b90b[_0x4f7e41(0x26b)]||undefined;break;case _0x4f7e41(0x1a0):_0x35cd8e=_0x27b90b[_0x4f7e41(0x22c)]||undefined;break;case _0x4f7e41(0x248):_0x35cd8e=_0x27b90b[_0x4f7e41(0x23e)]||undefined;break;}}console[_0x4f7e41(0x225)](_0x4f7e41(0x1ed)+_0x217e2f+':\x20'+(_0x35cd8e||_0x4f7e41(0x28e)));const _0x112f07=await _0x424900[_0x4f7e41(0x291)][_0x4f7e41(0x19e)]({'data':{'shopId':_0x5063b6,'amount':_0x14928a,'network':_0x217e2f,'status':'COMPLETED','txid':_0x35537a,'notes':_0x435646,'periodFrom':_0x437b87?new Date(_0x437b87):null,'periodTo':_0x1ececc?new Date(_0x1ececc):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x26783e=_0x40cb6a[_0x4f7e41(0x19d)]-_0x14928a,_0x533a94=_0x40cb6a[_0x4f7e41(0x215)]+_0x14928a;return await _0x424900[_0x4f7e41(0x1c6)][_0x4f7e41(0x27a)]({'where':{'id':_0x5063b6},'data':{'balance':_0x26783e,'totalPaidOut':_0x533a94}}),console['log'](_0x4f7e41(0x21d)+_0x40cb6a['username']+_0x4f7e41(0x23c)),console['log']('\x20\x20\x20Balance:\x20'+_0x40cb6a[_0x4f7e41(0x19d)]['toFixed'](0x6)+_0x4f7e41(0x262)+_0x26783e[_0x4f7e41(0x227)](0x6)+_0x4f7e41(0x220)+_0x14928a['toFixed'](0x6)+')'),console[_0x4f7e41(0x225)]('\x20\x20\x20Total\x20paid\x20out:\x20'+_0x40cb6a[_0x4f7e41(0x215)]['toFixed'](0x6)+'\x20->\x20'+_0x533a94['toFixed'](0x6)+_0x4f7e41(0x203)+_0x14928a[_0x4f7e41(0x227)](0x6)+')'),{'payout':_0x112f07,'shop':_0x40cb6a};});return console['log'](_0x1493f0(0x1f7)+_0x21a9c2[_0x1493f0(0x291)]['id']+_0x1493f0(0x27b)+_0x21a9c2[_0x1493f0(0x1c6)][_0x1493f0(0x1b4)]+'\x20('+_0x14928a+_0x1493f0(0x1fe)),{'id':_0x21a9c2['payout']['id'],'shopId':_0x21a9c2[_0x1493f0(0x291)][_0x1493f0(0x1c1)],'shopName':_0x21a9c2[_0x1493f0(0x1c6)][_0x1493f0(0x1e7)],'shopUsername':_0x21a9c2[_0x1493f0(0x1c6)]['username'],'amount':_0x21a9c2[_0x1493f0(0x291)][_0x1493f0(0x25f)],'network':_0x21a9c2['payout'][_0x1493f0(0x255)],'status':_0x21a9c2[_0x1493f0(0x291)]['status'],'txid':_0x21a9c2[_0x1493f0(0x291)][_0x1493f0(0x250)],'notes':_0x21a9c2[_0x1493f0(0x291)][_0x1493f0(0x1db)],'periodFrom':_0x21a9c2['payout']['periodFrom'],'periodTo':_0x21a9c2[_0x1493f0(0x291)][_0x1493f0(0x1f3)],'createdAt':_0x21a9c2[_0x1493f0(0x291)][_0x1493f0(0x1c8)],'paidAt':_0x21a9c2[_0x1493f0(0x291)]['paidAt']};}async[a35_0x310b69(0x28d)](_0x512b7e){const _0x395651=a35_0x310b69,{page:_0x4c9de8,limit:_0x4b5e83,shopId:_0x3cf5c3,network:_0x2d562e,dateFrom:_0x1547e9,dateTo:_0x208dd9,search:_0x4cec43}=_0x512b7e,_0x4ed846=(_0x4c9de8-0x1)*_0x4b5e83,_0x53f6c3={};_0x3cf5c3&&(_0x53f6c3[_0x395651(0x1c1)]=_0x3cf5c3);_0x2d562e&&(_0x53f6c3['network']=_0x2d562e);(_0x1547e9||_0x208dd9)&&(_0x53f6c3[_0x395651(0x1c8)]={},_0x1547e9&&(_0x53f6c3[_0x395651(0x1c8)][_0x395651(0x1f8)]=new Date(_0x1547e9)),_0x208dd9&&(_0x53f6c3[_0x395651(0x1c8)]['lte']=new Date(_0x208dd9)));_0x4cec43&&(_0x53f6c3['OR']=[{'shop':{'name':{'contains':_0x4cec43,'mode':_0x395651(0x1c5)}}},{'shop':{'username':{'contains':_0x4cec43,'mode':_0x395651(0x1c5)}}},{'notes':{'contains':_0x4cec43,'mode':_0x395651(0x1c5)}}]);const [_0x406eb0,_0x4f7dd7]=await Promise[_0x395651(0x275)]([database_1[_0x395651(0x241)][_0x395651(0x291)][_0x395651(0x278)]({'where':_0x53f6c3,'skip':_0x4ed846,'take':_0x4b5e83,'orderBy':{'createdAt':_0x395651(0x1ea)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'wallet':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x395651(0x241)][_0x395651(0x291)][_0x395651(0x25d)]({'where':_0x53f6c3})]);return{'payouts':_0x406eb0[_0x395651(0x231)](_0xbce6fb=>({'id':_0xbce6fb['id'],'shopId':_0xbce6fb[_0x395651(0x1c1)],'shopName':_0xbce6fb[_0x395651(0x1c6)][_0x395651(0x1e7)],'shopUsername':_0xbce6fb[_0x395651(0x1c6)][_0x395651(0x1b4)],'amount':_0xbce6fb['amount'],'network':_0xbce6fb['network'],'wallet':_0xbce6fb[_0x395651(0x1da)],'status':_0xbce6fb[_0x395651(0x299)],'txid':_0xbce6fb[_0x395651(0x250)],'notes':_0xbce6fb[_0x395651(0x1db)],'periodFrom':_0xbce6fb[_0x395651(0x1cf)],'periodTo':_0xbce6fb[_0x395651(0x1f3)],'createdAt':_0xbce6fb[_0x395651(0x1c8)],'paidAt':_0xbce6fb['paidAt']})),'pagination':{'page':_0x4c9de8,'limit':_0x4b5e83,'total':_0x4f7dd7,'totalPages':Math[_0x395651(0x285)](_0x4f7dd7/_0x4b5e83)}};}async[a35_0x310b69(0x252)](_0x2f9d78){const _0x1445bd=a35_0x310b69,_0x5b6970=await database_1['default']['payout'][_0x1445bd(0x2a8)]({'where':{'id':_0x2f9d78},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x5b6970)return null;return{'id':_0x5b6970['id'],'shopId':_0x5b6970[_0x1445bd(0x1c1)],'shopName':_0x5b6970['shop']['name'],'shopUsername':_0x5b6970['shop'][_0x1445bd(0x1b4)],'amount':_0x5b6970[_0x1445bd(0x25f)],'network':_0x5b6970[_0x1445bd(0x255)],'status':_0x5b6970['status'],'txid':_0x5b6970[_0x1445bd(0x250)],'notes':_0x5b6970[_0x1445bd(0x1db)],'periodFrom':_0x5b6970['periodFrom'],'periodTo':_0x5b6970['periodTo'],'createdAt':_0x5b6970[_0x1445bd(0x1c8)],'paidAt':_0x5b6970[_0x1445bd(0x294)]};}async[a35_0x310b69(0x258)](_0x1c4edd){const _0x39cabe=a35_0x310b69;await database_1[_0x39cabe(0x241)][_0x39cabe(0x291)]['delete']({'where':{'id':_0x1c4edd}});}async[a35_0x310b69(0x272)](_0x4a8f89){const _0x50b2f4=a35_0x310b69,{page:_0x92c682,limit:_0x26dce7,status:_0x4a6404,gateway:_0x2c4470,shopId:_0x11a2ae,dateFrom:_0x215e15,dateTo:_0x43c8d9,search:_0xc22edb,currency:_0x12707d,sortBy:_0x43e136,sortOrder:_0x50dbfa}=_0x4a8f89,_0x58499b=(_0x92c682-0x1)*_0x26dce7;console[_0x50b2f4(0x225)](_0x50b2f4(0x1b3),_0x4a8f89);const _0x760864=await database_1['default'][_0x50b2f4(0x240)]['groupBy']({'by':[_0x50b2f4(0x263)],'_count':{'gateway':!![]}});console[_0x50b2f4(0x225)](_0x50b2f4(0x207),_0x760864['map'](_0x564560=>_0x564560[_0x50b2f4(0x263)]+'\x20('+_0x564560[_0x50b2f4(0x1cd)][_0x50b2f4(0x263)]+_0x50b2f4(0x234)));if(_0x2c4470){const _0x24f490=_0x760864[_0x50b2f4(0x1c9)](_0xb22636=>_0xb22636[_0x50b2f4(0x263)][_0x50b2f4(0x1c0)]()===_0x2c4470['toLowerCase']());!_0x24f490&&_0x2c4470[_0x50b2f4(0x1c0)]()!==_0x50b2f4(0x24f)&&console[_0x50b2f4(0x225)](_0x50b2f4(0x1ef)+_0x2c4470+_0x50b2f4(0x1f5)+_0x760864[_0x50b2f4(0x231)](_0x40a07d=>_0x40a07d[_0x50b2f4(0x263)])[_0x50b2f4(0x24b)](',\x20'));}const _0x20f232={};_0x4a6404&&(_0x20f232[_0x50b2f4(0x299)]=_0x4a6404['toUpperCase']());if(!_0x2c4470)_0x20f232[_0x50b2f4(0x263)]={'not':'test_gateway'};else{if(_0x2c4470&&(_0x2c4470[_0x50b2f4(0x1c0)]()===_0x50b2f4(0x24f)||_0x2c4470===_0x50b2f4(0x1d0)))_0x20f232[_0x50b2f4(0x263)]=_0x50b2f4(0x24f);else{let _0x38b80e=_0x2c4470;const _0x3402a9=(0x0,gateway_1[_0x50b2f4(0x1be)])(_0x2c4470);if(_0x3402a9)_0x38b80e=_0x3402a9,console[_0x50b2f4(0x225)](_0x50b2f4(0x218)+_0x2c4470+_0x50b2f4(0x22f)+_0x38b80e+'\x27');else{const _0x4ebf5b=(0x0,gateway_1[_0x50b2f4(0x222)])(_0x2c4470);if(_0x4ebf5b){const _0x22018b=(0x0,gateway_1[_0x50b2f4(0x1be)])(_0x4ebf5b);_0x22018b&&(_0x38b80e=_0x22018b,console[_0x50b2f4(0x225)](_0x50b2f4(0x1eb)+_0x2c4470+_0x50b2f4(0x236)+_0x4ebf5b+_0x50b2f4(0x23b)+_0x38b80e+'\x27'));}else console[_0x50b2f4(0x225)](_0x50b2f4(0x2a1)+_0x2c4470+_0x50b2f4(0x25b));}const _0x5adc55=await database_1[_0x50b2f4(0x241)]['payment']['count']({'where':{'gateway':_0x38b80e[_0x50b2f4(0x1c0)]()},'take':0x1});_0x5adc55===0x0?(console[_0x50b2f4(0x225)](_0x50b2f4(0x1fd)+_0x38b80e+_0x50b2f4(0x1df)+_0x2c4470+'\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result'),_0x20f232[_0x50b2f4(0x263)]=_0x50b2f4(0x1e1)):(_0x20f232[_0x50b2f4(0x263)]=_0x38b80e[_0x50b2f4(0x1c0)](),console[_0x50b2f4(0x225)](_0x50b2f4(0x229)+_0x38b80e+_0x50b2f4(0x1df)+_0x2c4470+'\x27)'));}}console[_0x50b2f4(0x225)](_0x50b2f4(0x246),_0x20f232['gateway']);_0x11a2ae&&(_0x20f232['shopId']=_0x11a2ae);_0x12707d&&(_0x20f232[_0x50b2f4(0x25c)]=_0x12707d['toUpperCase'](),console[_0x50b2f4(0x225)](_0x50b2f4(0x20a)+_0x12707d[_0x50b2f4(0x251)]()));(_0x215e15||_0x43c8d9)&&(_0x20f232[_0x50b2f4(0x1c8)]={},_0x215e15&&(_0x20f232['createdAt'][_0x50b2f4(0x1f8)]=new Date(_0x215e15)),_0x43c8d9&&(_0x20f232[_0x50b2f4(0x1c8)]['lte']=new Date(_0x43c8d9)));_0xc22edb&&(_0x20f232['OR']=[{'orderId':{'contains':_0xc22edb,'mode':'insensitive'}},{'gatewayOrderId':{'contains':_0xc22edb,'mode':_0x50b2f4(0x1c5)}},{'customerEmail':{'contains':_0xc22edb,'mode':_0x50b2f4(0x1c5)}},{'shop':{'name':{'contains':_0xc22edb,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0xc22edb,'mode':'insensitive'}}}]);console[_0x50b2f4(0x225)](_0x50b2f4(0x21c),JSON[_0x50b2f4(0x282)](_0x20f232,null,0x2));let _0x4b2ba1={'createdAt':_0x50b2f4(0x1ea)};if(_0x43e136){const _0x51df51=['amount',_0x50b2f4(0x1c8),_0x50b2f4(0x24e),_0x50b2f4(0x299),_0x50b2f4(0x263),'currency'],_0xe076aa=[_0x50b2f4(0x2ab),'desc'];if(_0x51df51['includes'](_0x43e136)){const _0x584981=_0xe076aa[_0x50b2f4(0x25e)](_0x50dbfa)?_0x50dbfa:_0x50b2f4(0x1ea);_0x4b2ba1={[_0x43e136]:_0x584981},console[_0x50b2f4(0x225)](_0x50b2f4(0x2a5)+_0x43e136+_0x50b2f4(0x1d6)+_0x584981+'\x20order');}}const [_0x27915a,_0x2bf3d3]=await Promise[_0x50b2f4(0x275)]([database_1[_0x50b2f4(0x241)]['payment'][_0x50b2f4(0x278)]({'where':_0x20f232,'skip':_0x58499b,'take':_0x26dce7,'orderBy':_0x4b2ba1,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x50b2f4(0x241)][_0x50b2f4(0x240)][_0x50b2f4(0x25d)]({'where':_0x20f232})]);return{'payments':_0x27915a[_0x50b2f4(0x231)](_0x5b9e5b=>({'id':_0x5b9e5b['id'],'shopId':_0x5b9e5b[_0x50b2f4(0x1c1)],'gateway':_0x5b9e5b[_0x50b2f4(0x263)],'amount':_0x5b9e5b[_0x50b2f4(0x25f)],'currency':_0x5b9e5b['currency'],'status':_0x5b9e5b['status'],'orderId':_0x5b9e5b['orderId'],'gatewayOrderId':_0x5b9e5b[_0x50b2f4(0x22e)],'customerEmail':_0x5b9e5b[_0x50b2f4(0x1ac)],'customerName':_0x5b9e5b[_0x50b2f4(0x28b)],'customerCountry':_0x5b9e5b[_0x50b2f4(0x274)],'customerIp':_0x5b9e5b[_0x50b2f4(0x22a)],'customerUa':_0x5b9e5b[_0x50b2f4(0x20b)],'failureMessage':_0x5b9e5b[_0x50b2f4(0x29c)],'createdAt':_0x5b9e5b['createdAt'],'updatedAt':_0x5b9e5b[_0x50b2f4(0x24e)],'shop':_0x5b9e5b['shop']})),'pagination':{'page':_0x92c682,'limit':_0x26dce7,'total':_0x2bf3d3,'totalPages':Math[_0x50b2f4(0x285)](_0x2bf3d3/_0x26dce7)}};}async['getPaymentById'](_0xeb40db){const _0x122a26=a35_0x310b69,_0x46640c=await database_1[_0x122a26(0x241)][_0x122a26(0x240)][_0x122a26(0x2a8)]({'where':{'id':_0xeb40db},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x46640c)return null;return{'id':_0x46640c['id'],'shopId':_0x46640c['shopId'],'gateway':_0x46640c[_0x122a26(0x263)],'amount':_0x46640c[_0x122a26(0x25f)],'currency':_0x46640c['currency'],'status':_0x46640c[_0x122a26(0x299)],'orderId':_0x46640c[_0x122a26(0x28a)],'gatewayOrderId':_0x46640c[_0x122a26(0x22e)],'customerEmail':_0x46640c[_0x122a26(0x1ac)],'customerName':_0x46640c[_0x122a26(0x28b)],'customerCountry':_0x46640c['customerCountry'],'customerIp':_0x46640c['customerIp'],'customerUa':_0x46640c[_0x122a26(0x20b)],'failureMessage':_0x46640c['failureMessage'],'externalPaymentUrl':_0x46640c[_0x122a26(0x2b0)],'successUrl':_0x46640c[_0x122a26(0x1ab)],'failUrl':_0x46640c[_0x122a26(0x243)],'pendingUrl':_0x46640c['pendingUrl'],'whiteUrl':_0x46640c[_0x122a26(0x217)],'createdAt':_0x46640c['createdAt'],'updatedAt':_0x46640c[_0x122a26(0x24e)],'shop':_0x46640c[_0x122a26(0x1c6)]};}async['updatePaymentStatus'](_0x52c7f3,_0x646f0f,_0x596755,_0x4055d1){const _0x401399=a35_0x310b69,_0x3dd1f4=await database_1[_0x401399(0x241)][_0x401399(0x212)](async _0x52355a=>{const _0x49e2dc=_0x401399,_0x85c8cb=await _0x52355a[_0x49e2dc(0x240)][_0x49e2dc(0x2a8)]({'where':{'id':_0x52c7f3},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x85c8cb)throw new Error(_0x49e2dc(0x1ad));const _0x17e3f8=_0x85c8cb['status'],_0x40138d=_0x646f0f[_0x49e2dc(0x251)]();console[_0x49e2dc(0x225)](_0x49e2dc(0x1e2)+_0x52c7f3+'\x20status:\x20'+_0x17e3f8+_0x49e2dc(0x262)+_0x40138d),console[_0x49e2dc(0x225)](_0x49e2dc(0x261)+_0x85c8cb[_0x49e2dc(0x1c6)][_0x49e2dc(0x19d)]+'\x20USDT');const _0x3fbac7={'status':_0x40138d,'updatedAt':new Date(),'statusChangedBy':_0x49e2dc(0x256),'statusChangedAt':new Date()};_0x596755&&(_0x3fbac7[_0x49e2dc(0x26a)]=_0x596755);_0x40138d==='CHARGEBACK'&&_0x4055d1&&(_0x3fbac7[_0x49e2dc(0x29a)]=_0x4055d1);let _0x3b7451=0x0,_0x54c3f5=_0x85c8cb[_0x49e2dc(0x1c6)][_0x49e2dc(0x19d)];if(_0x40138d===_0x49e2dc(0x20c)&&_0x17e3f8!=='PAID'){_0x3fbac7['paidAt']=new Date();const _0x3745f3=await currencyService_1[_0x49e2dc(0x235)][_0x49e2dc(0x226)](_0x85c8cb[_0x49e2dc(0x25f)],_0x85c8cb[_0x49e2dc(0x25c)]);_0x3fbac7['amountUSDT']=_0x3745f3,_0x3b7451=_0x3745f3,_0x54c3f5+=_0x3745f3,console[_0x49e2dc(0x225)](_0x49e2dc(0x1f2)+_0x52c7f3+_0x49e2dc(0x1bd)+_0x3745f3[_0x49e2dc(0x227)](0x6)+_0x49e2dc(0x200));}else _0x17e3f8===_0x49e2dc(0x20c)&&_0x40138d!==_0x49e2dc(0x20c)&&(_0x85c8cb[_0x49e2dc(0x1f4)]&&(_0x3b7451=-_0x85c8cb[_0x49e2dc(0x1f4)],_0x54c3f5-=_0x85c8cb[_0x49e2dc(0x1f4)],_0x3fbac7[_0x49e2dc(0x1f4)]=null,console[_0x49e2dc(0x225)](_0x49e2dc(0x1f2)+_0x52c7f3+_0x49e2dc(0x2a4)+_0x85c8cb[_0x49e2dc(0x1f4)][_0x49e2dc(0x227)](0x6)+'\x20USDT\x20from\x20balance')));if(_0x40138d===_0x49e2dc(0x242)){if(_0x17e3f8===_0x49e2dc(0x20c)&&_0x85c8cb[_0x49e2dc(0x1f4)]){}_0x4055d1&&_0x4055d1>0x0&&(_0x3b7451-=_0x4055d1,_0x54c3f5-=_0x4055d1,console[_0x49e2dc(0x225)](_0x49e2dc(0x279)+_0x4055d1['toFixed'](0x6)+_0x49e2dc(0x223)));}_0x40138d===_0x49e2dc(0x1cb)&&_0x17e3f8===_0x49e2dc(0x20c)&&console['log'](_0x49e2dc(0x289));const _0x25e213=await _0x52355a[_0x49e2dc(0x240)][_0x49e2dc(0x27a)]({'where':{'id':_0x52c7f3},'data':_0x3fbac7,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x3b7451!==0x0&&(await _0x52355a[_0x49e2dc(0x1c6)][_0x49e2dc(0x27a)]({'where':{'id':_0x85c8cb[_0x49e2dc(0x1c1)]},'data':{'balance':_0x54c3f5}}),console[_0x49e2dc(0x225)](_0x49e2dc(0x21d)+_0x85c8cb[_0x49e2dc(0x1c1)]+'\x20balance\x20updated:\x20'+_0x85c8cb[_0x49e2dc(0x1c6)][_0x49e2dc(0x19d)][_0x49e2dc(0x227)](0x6)+_0x49e2dc(0x262)+_0x54c3f5[_0x49e2dc(0x227)](0x6)+_0x49e2dc(0x27e)+(_0x3b7451>0x0?'+':'')+_0x3b7451[_0x49e2dc(0x227)](0x6)+')')),_0x25e213;});return{'id':_0x3dd1f4['id'],'shopId':_0x3dd1f4[_0x401399(0x1c1)],'gateway':_0x3dd1f4[_0x401399(0x263)],'amount':_0x3dd1f4[_0x401399(0x25f)],'currency':_0x3dd1f4[_0x401399(0x25c)],'status':_0x3dd1f4[_0x401399(0x299)],'orderId':_0x3dd1f4['orderId'],'gatewayOrderId':_0x3dd1f4[_0x401399(0x22e)],'customerEmail':_0x3dd1f4[_0x401399(0x1ac)],'customerName':_0x3dd1f4[_0x401399(0x28b)],'customerCountry':_0x3dd1f4[_0x401399(0x274)],'customerIp':_0x3dd1f4[_0x401399(0x22a)],'customerUa':_0x3dd1f4[_0x401399(0x20b)],'failureMessage':_0x3dd1f4[_0x401399(0x29c)],'adminNotes':_0x3dd1f4[_0x401399(0x26a)],'chargebackAmount':_0x3dd1f4[_0x401399(0x29a)],'statusChangedBy':_0x3dd1f4[_0x401399(0x211)],'statusChangedAt':_0x3dd1f4[_0x401399(0x270)],'createdAt':_0x3dd1f4[_0x401399(0x1c8)],'updatedAt':_0x3dd1f4['updatedAt'],'shop':_0x3dd1f4[_0x401399(0x1c6)]};}async[a35_0x310b69(0x1af)](_0x50e739,_0x24e16f){const _0x21e1c7=a35_0x310b69,_0x2e557f={..._0x24e16f};_0x24e16f[_0x21e1c7(0x1a7)]&&(_0x2e557f[_0x21e1c7(0x1a7)]=await bcryptjs_1[_0x21e1c7(0x241)]['hash'](_0x24e16f[_0x21e1c7(0x1a7)],0xc));_0x24e16f[_0x21e1c7(0x24c)]&&(_0x2e557f[_0x21e1c7(0x1e7)]=_0x24e16f[_0x21e1c7(0x24c)],delete _0x2e557f[_0x21e1c7(0x24c)]);_0x24e16f['telegramId']&&(_0x2e557f[_0x21e1c7(0x297)]=_0x24e16f[_0x21e1c7(0x2a3)],delete _0x2e557f[_0x21e1c7(0x2a3)]);_0x24e16f[_0x21e1c7(0x1ca)]&&(_0x2e557f['shopUrl']=_0x24e16f[_0x21e1c7(0x1ca)],delete _0x2e557f[_0x21e1c7(0x1ca)]);_0x24e16f[_0x21e1c7(0x2af)]&&(_0x2e557f[_0x21e1c7(0x28c)]=JSON['stringify'](_0x24e16f[_0x21e1c7(0x2af)]),delete _0x2e557f[_0x21e1c7(0x2af)]);_0x24e16f[_0x21e1c7(0x247)]&&(_0x2e557f['gatewaySettings']=JSON[_0x21e1c7(0x282)](_0x24e16f[_0x21e1c7(0x247)]),delete _0x2e557f[_0x21e1c7(0x247)]);_0x24e16f[_0x21e1c7(0x204)]&&(_0x24e16f[_0x21e1c7(0x204)][_0x21e1c7(0x1a9)]!==undefined&&(_0x2e557f[_0x21e1c7(0x1a9)]=_0x24e16f[_0x21e1c7(0x204)][_0x21e1c7(0x1a9)]||null),_0x24e16f[_0x21e1c7(0x204)][_0x21e1c7(0x26b)]!==undefined&&(_0x2e557f['usdtTrcWallet']=_0x24e16f[_0x21e1c7(0x204)][_0x21e1c7(0x26b)]||null),_0x24e16f[_0x21e1c7(0x204)][_0x21e1c7(0x22c)]!==undefined&&(_0x2e557f[_0x21e1c7(0x22c)]=_0x24e16f[_0x21e1c7(0x204)][_0x21e1c7(0x22c)]||null),_0x24e16f['wallets'][_0x21e1c7(0x23e)]!==undefined&&(_0x2e557f[_0x21e1c7(0x23e)]=_0x24e16f[_0x21e1c7(0x204)]['usdcPolygonWallet']||null),delete _0x2e557f[_0x21e1c7(0x204)]);const _0x5a3f0d=await database_1[_0x21e1c7(0x241)][_0x21e1c7(0x1c6)][_0x21e1c7(0x27a)]({'where':{'id':_0x50e739},'data':_0x2e557f,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x5a3f0d['id'],'fullName':_0x5a3f0d[_0x21e1c7(0x1e7)],'username':_0x5a3f0d[_0x21e1c7(0x1b4)],'telegramId':_0x5a3f0d['telegram'],'merchantUrl':_0x5a3f0d['shopUrl'],'gateways':_0x5a3f0d[_0x21e1c7(0x28c)]?JSON[_0x21e1c7(0x280)](_0x5a3f0d[_0x21e1c7(0x28c)]):null,'gatewaySettings':_0x5a3f0d[_0x21e1c7(0x247)]?JSON['parse'](_0x5a3f0d[_0x21e1c7(0x247)]):null,'publicKey':_0x5a3f0d[_0x21e1c7(0x22b)],'wallets':{'usdtPolygonWallet':_0x5a3f0d[_0x21e1c7(0x1a9)],'usdtTrcWallet':_0x5a3f0d[_0x21e1c7(0x26b)],'usdtErcWallet':_0x5a3f0d[_0x21e1c7(0x22c)],'usdcPolygonWallet':_0x5a3f0d[_0x21e1c7(0x23e)]},'status':_0x5a3f0d['status'],'createdAt':_0x5a3f0d[_0x21e1c7(0x1c8)]};}async[a35_0x310b69(0x1e5)](_0x490cab){const _0x2150f8=a35_0x310b69,_0x210e2d=await database_1[_0x2150f8(0x241)]['shop'][_0x2150f8(0x27a)]({'where':{'id':_0x490cab},'data':{'status':_0x2150f8(0x1d7)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x210e2d['id'],'fullName':_0x210e2d[_0x2150f8(0x1e7)],'username':_0x210e2d[_0x2150f8(0x1b4)],'telegramId':_0x210e2d[_0x2150f8(0x297)],'merchantUrl':_0x210e2d['shopUrl'],'gateways':_0x210e2d['paymentGateways']?JSON[_0x2150f8(0x280)](_0x210e2d[_0x2150f8(0x28c)]):null,'gatewaySettings':_0x210e2d[_0x2150f8(0x247)]?JSON['parse'](_0x210e2d[_0x2150f8(0x247)]):null,'publicKey':_0x210e2d[_0x2150f8(0x22b)],'wallets':{'usdtPolygonWallet':_0x210e2d['usdtPolygonWallet'],'usdtTrcWallet':_0x210e2d['usdtTrcWallet'],'usdtErcWallet':_0x210e2d[_0x2150f8(0x22c)],'usdcPolygonWallet':_0x210e2d[_0x2150f8(0x23e)]},'status':_0x210e2d[_0x2150f8(0x299)],'createdAt':_0x210e2d['createdAt']};}async[a35_0x310b69(0x2aa)](_0x21a2cc){const _0x4ad224=a35_0x310b69,_0x38a264=await database_1[_0x4ad224(0x241)][_0x4ad224(0x1c6)][_0x4ad224(0x27a)]({'where':{'id':_0x21a2cc},'data':{'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x38a264['id'],'fullName':_0x38a264[_0x4ad224(0x1e7)],'username':_0x38a264[_0x4ad224(0x1b4)],'telegramId':_0x38a264[_0x4ad224(0x297)],'merchantUrl':_0x38a264['shopUrl'],'gateways':_0x38a264[_0x4ad224(0x28c)]?JSON[_0x4ad224(0x280)](_0x38a264[_0x4ad224(0x28c)]):null,'gatewaySettings':_0x38a264['gatewaySettings']?JSON[_0x4ad224(0x280)](_0x38a264[_0x4ad224(0x247)]):null,'publicKey':_0x38a264[_0x4ad224(0x22b)],'wallets':{'usdtPolygonWallet':_0x38a264[_0x4ad224(0x1a9)],'usdtTrcWallet':_0x38a264[_0x4ad224(0x26b)],'usdtErcWallet':_0x38a264[_0x4ad224(0x22c)],'usdcPolygonWallet':_0x38a264[_0x4ad224(0x23e)]},'status':_0x38a264['status'],'createdAt':_0x38a264[_0x4ad224(0x1c8)]};}async[a35_0x310b69(0x27d)](_0x5f214e){const _0x40102c=a35_0x310b69,{page:_0x5548ea,limit:_0x18b9b1,status:_0x24a6d5}=_0x5f214e,_0x4dbb8a=(_0x5548ea-0x1)*_0x18b9b1,_0x469dac={};_0x24a6d5&&(_0x469dac[_0x40102c(0x299)]=_0x24a6d5[_0x40102c(0x251)]());const [_0x165a75,_0x16b242]=await Promise['all']([database_1[_0x40102c(0x241)]['shop'][_0x40102c(0x278)]({'where':_0x469dac,'skip':_0x4dbb8a,'take':_0x18b9b1,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1['default'][_0x40102c(0x1c6)]['count']({'where':_0x469dac})]);return{'users':_0x165a75[_0x40102c(0x231)](_0x98a10d=>({'id':_0x98a10d['id'],'fullName':_0x98a10d[_0x40102c(0x1e7)],'username':_0x98a10d[_0x40102c(0x1b4)],'telegramId':_0x98a10d[_0x40102c(0x297)],'merchantUrl':_0x98a10d['shopUrl'],'gateways':_0x98a10d[_0x40102c(0x28c)]?JSON[_0x40102c(0x280)](_0x98a10d[_0x40102c(0x28c)]):null,'gatewaySettings':_0x98a10d[_0x40102c(0x247)]?JSON[_0x40102c(0x280)](_0x98a10d[_0x40102c(0x247)]):null,'publicKey':_0x98a10d[_0x40102c(0x22b)],'wallets':{'usdtPolygonWallet':_0x98a10d[_0x40102c(0x1a9)],'usdtTrcWallet':_0x98a10d['usdtTrcWallet'],'usdtErcWallet':_0x98a10d['usdtErcWallet'],'usdcPolygonWallet':_0x98a10d[_0x40102c(0x23e)]},'status':_0x98a10d['status'],'createdAt':_0x98a10d[_0x40102c(0x1c8)]})),'pagination':{'page':_0x5548ea,'limit':_0x18b9b1,'total':_0x16b242,'totalPages':Math[_0x40102c(0x285)](_0x16b242/_0x18b9b1)}};}async['getUserById'](_0x5892e6){const _0x163d73=a35_0x310b69,_0x4cbaed=await database_1['default']['shop'][_0x163d73(0x2a8)]({'where':{'id':_0x5892e6},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x4cbaed)return null;return{'id':_0x4cbaed['id'],'fullName':_0x4cbaed['name'],'username':_0x4cbaed['username'],'telegramId':_0x4cbaed[_0x163d73(0x297)],'merchantUrl':_0x4cbaed[_0x163d73(0x23f)],'gateways':_0x4cbaed['paymentGateways']?JSON[_0x163d73(0x280)](_0x4cbaed['paymentGateways']):null,'gatewaySettings':_0x4cbaed['gatewaySettings']?JSON[_0x163d73(0x280)](_0x4cbaed[_0x163d73(0x247)]):null,'publicKey':_0x4cbaed[_0x163d73(0x22b)],'wallets':{'usdtPolygonWallet':_0x4cbaed['usdtPolygonWallet'],'usdtTrcWallet':_0x4cbaed['usdtTrcWallet'],'usdtErcWallet':_0x4cbaed[_0x163d73(0x22c)],'usdcPolygonWallet':_0x4cbaed['usdcPolygonWallet']},'status':_0x4cbaed[_0x163d73(0x299)],'createdAt':_0x4cbaed[_0x163d73(0x1c8)]};}async[a35_0x310b69(0x264)](_0x251cc2){const _0x58501d=a35_0x310b69,{fullName:_0x222728,username:_0x44cff5,password:_0x1579df,telegramId:_0x57594f,merchantUrl:_0x2eb63c,gateways:_0x4e4890,gatewaySettings:_0x69e382,wallets:_0x45ff1f}=_0x251cc2,_0x3a99cf=await database_1[_0x58501d(0x241)][_0x58501d(0x1c6)][_0x58501d(0x2a8)]({'where':{'username':_0x44cff5}});if(_0x3a99cf)throw new Error('Username\x20already\x20exists');if(_0x57594f){const _0x370f89=await database_1[_0x58501d(0x241)]['shop']['findUnique']({'where':{'telegram':_0x57594f}});if(_0x370f89)throw new Error(_0x58501d(0x283));}const _0x247268=await bcryptjs_1[_0x58501d(0x241)]['hash'](_0x1579df,0xc),_0x4f6d8d=_0x58501d(0x216)+crypto_1[_0x58501d(0x241)]['randomBytes'](0x20)[_0x58501d(0x230)]('hex'),_0x54b977=_0x58501d(0x1a5)+crypto_1[_0x58501d(0x241)][_0x58501d(0x27f)](0x20)[_0x58501d(0x230)](_0x58501d(0x296)),_0x46a0a5=await database_1[_0x58501d(0x241)][_0x58501d(0x1c6)][_0x58501d(0x19e)]({'data':{'name':_0x222728,'username':_0x44cff5,'password':_0x247268,'telegram':_0x57594f,'shopUrl':_0x2eb63c,'paymentGateways':_0x4e4890?JSON[_0x58501d(0x282)](_0x4e4890):null,'gatewaySettings':_0x69e382?JSON[_0x58501d(0x282)](_0x69e382):null,'usdtPolygonWallet':_0x45ff1f?.[_0x58501d(0x1a9)]||null,'usdtTrcWallet':_0x45ff1f?.[_0x58501d(0x26b)]||null,'usdtErcWallet':_0x45ff1f?.[_0x58501d(0x22c)]||null,'usdcPolygonWallet':_0x45ff1f?.[_0x58501d(0x23e)]||null,'publicKey':_0x4f6d8d,'secretKey':_0x54b977,'status':_0x58501d(0x214)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x46a0a5['id'],'fullName':_0x46a0a5[_0x58501d(0x1e7)],'username':_0x46a0a5[_0x58501d(0x1b4)],'telegramId':_0x46a0a5[_0x58501d(0x297)],'merchantUrl':_0x46a0a5['shopUrl'],'gateways':_0x46a0a5[_0x58501d(0x28c)]?JSON['parse'](_0x46a0a5[_0x58501d(0x28c)]):null,'gatewaySettings':_0x46a0a5['gatewaySettings']?JSON['parse'](_0x46a0a5['gatewaySettings']):null,'publicKey':_0x46a0a5['publicKey'],'wallets':{'usdtPolygonWallet':_0x46a0a5['usdtPolygonWallet'],'usdtTrcWallet':_0x46a0a5[_0x58501d(0x26b)],'usdtErcWallet':_0x46a0a5[_0x58501d(0x22c)],'usdcPolygonWallet':_0x46a0a5['usdcPolygonWallet']},'status':_0x46a0a5[_0x58501d(0x299)],'createdAt':_0x46a0a5[_0x58501d(0x1c8)]};}async[a35_0x310b69(0x269)](_0xb3b176){const _0xf74e02=a35_0x310b69;await database_1[_0xf74e02(0x241)][_0xf74e02(0x1c6)][_0xf74e02(0x257)]({'where':{'id':_0xb3b176}});}[a35_0x310b69(0x1b0)](_0x56d74c,_0x119bd0,_0x2fdc2b){const _0x247a9e=a35_0x310b69,_0x19213b=new Map(),_0x718eeb=new Date(_0x119bd0);while(_0x718eeb<=_0x2fdc2b){const _0x4ce3a2=_0x718eeb['toISOString']()['split']('T')[0x0];_0x19213b[_0x247a9e(0x2a7)](_0x4ce3a2,{'revenue':0x0,'count':0x0}),_0x718eeb['setDate'](_0x718eeb['getDate']()+0x1);}for(const _0x451af3 of _0x56d74c){const _0x1b4a06=_0x451af3[_0x247a9e(0x1c8)]['toISOString']()[_0x247a9e(0x1b1)]('T')[0x0],_0x1f8541=_0x19213b[_0x247a9e(0x1c7)](_0x1b4a06);_0x1f8541&&(_0x1f8541[_0x247a9e(0x25d)]+=0x1,_0x451af3[_0x247a9e(0x299)]===_0x247a9e(0x20c)&&(_0x451af3[_0x247a9e(0x1f4)]?_0x1f8541[_0x247a9e(0x1d4)]+=_0x451af3[_0x247a9e(0x1f4)]:console['log'](_0x247a9e(0x268)+_0x451af3['id']+_0x247a9e(0x239))));}const _0x53dd22=[],_0x5e4f12=[];for(const [_0x540bc,_0x37af88]of _0x19213b){_0x53dd22[_0x247a9e(0x1fa)]({'date':_0x540bc,'amount':Math[_0x247a9e(0x267)](_0x37af88[_0x247a9e(0x1d4)]*0x64)/0x64}),_0x5e4f12[_0x247a9e(0x1fa)]({'date':_0x540bc,'count':_0x37af88['count']});}return{'dailyRevenue':_0x53dd22,'dailyPayments':_0x5e4f12};}}exports[a35_0x310b69(0x233)]=AdminService;