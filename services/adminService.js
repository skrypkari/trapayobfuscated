'use strict';function a40_0x52a4(){const _0x476061=['forEach','min','\x20payments)','\x20paid\x20payments\x20for\x20analysis','üîç\x20Using\x20gateway\x20\x27','currency','\x27\x20(from\x20\x27','üìä\x20Calculating\x20payout\x20statistics...','test_gateway','_sum','floor','\x20\x20\x20üìÖ\x20Total\x20payouts\x20(this\x20month):\x20','gatewaySettings','Telegram\x20username\x20already\x20exists','\x20\x20\x20Requested\x20(number):\x20','\x20USDT,\x20Difference:\x20','hex',':\x20commission\x20=\x20','\x20USDT\x20(after\x20','üìä\x20Getting\x20merchant\x20statistics\x20with\x20filters:','getAllPayouts','Username\x20already\x20exists','getGatewayInternalName','periodFrom','payment','\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)','usdtPolygonWallet','üìä\x20Merchant\x20statistics\x20calculated:','totalAmountUSDT','shop','localeCompare','round','Payment\x20not\x20found','periodTo',',\x20Commission:\x20','cointopay2','desc','lte','PENDING','name','üìä\x20Getting\x20payments\x20with\x20filters:','üìÖ\x20Date\x20from\x20filter:\x20','customerName',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','plisio','\x20\x20\x20üåê\x20IP:\x20','getGatewayDisplayName','map','\x27\x20->\x20name\x20\x27','password','\x20\x20\x20üí≥\x20Total\x20payments:\x20','‚úÖ\x20Balance\x20check\x20passed\x20(with\x20tolerance)','statusChangedBy','üí∞\x20Shop\x20','üìä\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','Rapyd','üìÖ\x20Payout\x20date\x20from\x20filter:\x20','convertToUSDT','deleteUser','2020-01-01','currencyService','erc20','toFixed','shopUrl','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','NONEXISTENT_GATEWAY_FILTER','createPayout','join','groupBy','getTime','\x20USDT,\x20Requested:\x20','customerEmail','thisMonth','CoinToPay','orderId','parse','get','\x20merchants\x20with\x20rounded\x20balance\x20!=\x200.00\x20(excluding\x20balances\x20that\x20round\x20to\x200.00)','dailyRevenue','üìä\x20Merchants\x20with\x20rounded\x20balance\x20!=\x200.00:\x20','üîÑ\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','error','üí∞\x20Current\x20shop\x20balance:\x20','\x20\x20\x20Balance:\x20','telegramId','gatewayEarnings','\x20\x20\x20üíµ\x20Available\x20balance:\x20','getDate','MasterCard','‚ö†Ô∏è\x20Requested\x20gateway\x20\x27',']\x20Gateway\x20settings\x20JSON\x20string:','\x20became\x20PAID:','failureMessage','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','üìä\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','üìä\x20Total\x20payments\x20(including\x20failed):\x20','gte','üí∞\x20Payment\x20amount\x20is\x20NOT\x20deducted\x20(chargeback\x20penalty\x20only)','day','log','\x20USDT\x20(same\x20as\x20awaiting)','dateTo','üîç\x20Selected\x20erc20\x20wallet:\x20','KLYME\x20DE','totalPayout','üìä\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','85QNBWAk','getSystemStatistics','entries','\x20USDT\x20(-','substr','merchantEarnings','2222732EQyhKd','\x20USDT\x20(already\x20paid\x20out)','\x20\x20\x20üîç\x20Calculated\x20after\x20commission:\x20','all','üîÑ\x20Converted\x20gateway\x20name\x20\x27','\x20USDT\x20(theoretical\x20net)','\x20USDT\x20(','gateway','../types/gateway','$transaction','fullName','CHARGEBACK','week','rapyd','\x20USDT\x20for\x20payment\x20','customerUa','üìä\x20Using\x20saved\x20values\x20for\x20payment\x20','getMerchantsAwaitingPayout','yesterday','telegram','wallets','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','klyme_de','üìä\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','__esModule','30d','turnover','./telegramBotService','getGatewayNameById','üí∞\x20Payment\x20','getPayoutById','üìÖ\x20Payout\x20date\x20to\x20filter:\x20','90d','ACTIVE','updatePaymentStatus','0000','status','totalCommissionRate','findMany','publicKey','amountAfterGatewayCommissionUSDT','aggregate','üìä\x20Final\x20WHERE\x20conditions:','period','Open\x20Banking\x202','totalAmountAfterCommissionUSDT','‚úÖ\x20Payout\x20created\x20in\x20DB:','üìÖ\x20Date\x20to\x20filter:\x20','customerIp','\x20\x20\x20Total\x20paid\x20out:\x20','klyme_eu','setHours','noda','updateUser','suspendUser','not\x20specified','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','averageCheckUSDT','üìä\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20',',\x20successful:\x20','üîç\x20Balance\x20check\x20details:','\x20\x20\x20üí∏\x20Total\x20payouts:\x20','customerCountry','\x20\x20\x20üìÖ\x20This\x20month:\x20','gatewayCommissionRate','getUserById','getMerchantsSelection','reduce','‚ö†Ô∏è\x20Gateway\x20\x27','custom','length','merchantEarningsUSDT','toString','successUrl','\x20\x20\x20üí∏\x20Total\x20payouts\x20(all\x20time):\x20','getPaymentById','üí≥\x20Final\x20payout\x20wallet\x20for\x20','üîÑ\x20Gateway\x20mapping\x20(create):','getGatewayIdByName','toUpperCase',',\x20userId:\x20','amount','\x20\x20\x20‚è≥\x20Pending\x20payout:\x20','\x20\x20\x20Final\x20payout\x20amount\x20used:\x20','‚úÖ\x20Customer\x20data\x20updated\x20for\x20payment\x20','whiteUrl','\x20\x20\x20üí∞\x20Total\x20turnover:\x20','\x20USDT\x20(total\x20paid\x20to\x20merchants)','\x20\x20\x20Difference:\x20','%\x20commission)','toISOString','\x20\x20\x20üí∞\x20Total\x20payments\x20turnover:\x20','\x20\x20\x20Available\x20(raw):\x20','\x20USDT\x20(+','getMerchantStatistics','paymentsCount','gateways','paidOutUSDT','commissionUSDT','totalTurnover','getFullYear','usdtErcWallet','asc','\x20balance\x20updated:\x20','findFirst','count','\x20status:\x20','sk_','mastercard','generateDailyStatistics',']\x20Gateway\x20settings\x20before\x20saving:','ceil','\x20for\x20shop\x20','\x20\x20\x20Transaction\x20hash:\x20','filter','push','getMonth','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','updatedAt','\x20\x20\x20ü§î\x20Difference:\x20','66329uPHsrj','\x20\x20\x20Available\x20(number):\x20','averageCommissionRate','amountAfterCommissionUSDT','slice','_count','10MmSqHu','totalPaidOut','\x20-\x20',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','üí∞\x20[PAYOUT]\x20Merchant\x20','3657032DeBpvL','toLocaleDateString','txid','–ù–µ\x20—É–∫–∞–∑–∞–Ω','usdcErcWallet','\x20order','trc20','merchantUrl','deletePayout','üìä\x20Gateway\x20filter\x20applied:','payout','notes','set','createdAt','toLowerCase','üîç\x20Initial\x20wallet\x20from\x20request:\x20','AdminService','split','month','updateCustomerData','üîÑ\x20Converted\x20gateway\x20ID\x20\x27','\x20\x20\x20Full\x20amount:\x20','some','\x20merchants','10034160xCIGZw','randomBytes','trim','Error\x20processing\x20payment\x20','üîç\x20Selected\x20polygon\x20wallet:\x20','154428FHOgBn','dateFrom','\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notification\x20for\x20payout\x20','üí∏\x20CHARGEBACK:\x20Processing\x20penalty-only\x20deduction','\x20\x20\x20Merchant\x20loses:\x20','‚ö†Ô∏è\x20Payment\x20','setDate','Plisio','ru-RU','üîê\x20[','\x20USDT\x20from\x20balance','availableBalance','\x20\x20\x20‚úÖ\x20Actual\x20available\x20balance:\x20','payouts','üìä\x20Payout\x20statistics\x20calculated:','usdcPolygonWallet','amountUSDT','‚úÖ\x20Using\x20wallet\x20from\x20request:\x20','balance','sort','REFUND','default','\x27\x20->\x20ID\x20\x27','findUnique','statusChangedAt',']\x20Updating\x20password\x20for\x20user\x20','paidAt','adminNotes','username','insensitive','date','update','network','üí∞\x20[PAYOUT]\x20Gateway\x20','includes','üîß\x20[','bcryptjs','PAID','awaitingPayout','not\x20provided','chargebackAmount','shopId','commission','üí∞\x20Found\x20','delete','COMPLETED','\x20\x20\x20üë§\x20Merchant\x20earnings:\x20','crypto','usdtTrcWallet','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','not\x20set','\x20\x20\x20Payout\x20amount:\x20','\x20\x20\x20Gateway:\x20','\x20USDT','paymentGateways','\x20USDT,\x20merchant:\x20','create','\x20->\x20','\x20USDT\x20(gross\x20revenue)','456825OCccpi','\x27\x20not\x20found.\x20Available\x20gateways:\x20','\x20in\x20','üîç\x20Shop\x20wallets:','\x20balance\x20updated:','\x20\x20\x20üñ•Ô∏è\x20User\x20Agent:\x20','values','üìä\x20Calculated\x20commission\x20rate\x20for\x20payment\x20','wallet','turnoverUSDT','gatewayOrderId','hash','stringify','\x20PAID\x20payments','üîç\x20No\x20wallet\x20provided,\x20looking\x20up\x20from\x20shop\x20settings...','\x20\x20\x20Merchant\x20gets:\x20','üéØ\x20updateUser\x20called\x20with\x20ID:\x20','3053358UhDhiK','9foTPPY'];a40_0x52a4=function(){return _0x476061;};return a40_0x52a4();}const a40_0x64d77e=a40_0x14fa;(function(_0x5a18a0,_0x370a0d){const _0x27fec1=a40_0x14fa,_0x4a3f0b=_0x5a18a0();while(!![]){try{const _0x150889=-parseInt(_0x27fec1(0x1f9))/0x1*(parseInt(_0x27fec1(0x1ff))/0x2)+-parseInt(_0x27fec1(0x25d))/0x3+parseInt(_0x27fec1(0x2e0))/0x4+parseInt(_0x27fec1(0x2da))/0x5*(parseInt(_0x27fec1(0x221))/0x6)+parseInt(_0x27fec1(0x26e))/0x7+-parseInt(_0x27fec1(0x204))/0x8*(-parseInt(_0x27fec1(0x26f))/0x9)+-parseInt(_0x27fec1(0x21c))/0xa;if(_0x150889===_0x370a0d)break;else _0x4a3f0b['push'](_0x4a3f0b['shift']());}catch(_0x416c1a){_0x4a3f0b['push'](_0x4a3f0b['shift']());}}}(a40_0x52a4,0x61770));var __importDefault=this&&this['__importDefault']||function(_0x407783){const _0x321238=a40_0x14fa;return _0x407783&&_0x407783[_0x321238(0x199)]?_0x407783:{'default':_0x407783};};Object['defineProperty'](exports,a40_0x64d77e(0x199),{'value':!![]}),exports[a40_0x64d77e(0x214)]=void 0x0;const database_1=__importDefault(require('../config/database')),bcryptjs_1=__importDefault(require(a40_0x64d77e(0x246))),crypto_1=__importDefault(require(a40_0x64d77e(0x251))),currencyService_1=require('./currencyService'),telegramBotService_1=require(a40_0x64d77e(0x19c)),gateway_1=require(a40_0x64d77e(0x2e8));class AdminService{async['getPayoutStats'](){const _0x30ed9d=a40_0x64d77e;console[_0x30ed9d(0x2d3)](_0x30ed9d(0x277));const _0x5d007c=await database_1['default'][_0x30ed9d(0x28d)][_0x30ed9d(0x1aa)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x30ed9d(0x1a2)}}),_0xb947b1=await database_1[_0x30ed9d(0x237)][_0x30ed9d(0x288)][_0x30ed9d(0x1ea)]({'where':{'status':_0x30ed9d(0x247),'gateway':{'not':'test_gateway'}}}),_0x5bb1e5=new Date(),_0x386288=new Date(_0x5bb1e5[_0x30ed9d(0x1e5)](),_0x5bb1e5[_0x30ed9d(0x1f5)](),0x1),_0x45271d=new Date(_0x5bb1e5[_0x30ed9d(0x1e5)](),_0x5bb1e5['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x61d4be=await database_1[_0x30ed9d(0x237)][_0x30ed9d(0x20e)]['aggregate']({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x386288,'lte':_0x45271d},'status':_0x30ed9d(0x24f)}}),_0x274b98=_0x5d007c[_0x30ed9d(0x279)][_0x30ed9d(0x200)]||0x0,_0x1c91bd=_0x5d007c[_0x30ed9d(0x279)]['balance']||0x0,_0x13a6a9=_0x61d4be[_0x30ed9d(0x279)]['amount']||0x0,_0x1c20da={'totalPayout':Math['round'](_0x274b98*0x64)/0x64,'awaitingPayout':Math[_0x30ed9d(0x28f)](_0x1c91bd*0x64)/0x64,'thisMonth':Math[_0x30ed9d(0x28f)](_0x13a6a9*0x64)/0x64,'availableBalance':Math['round'](_0x1c91bd*0x64)/0x64,'totalPayments':_0xb947b1};return console[_0x30ed9d(0x2d3)](_0x30ed9d(0x230)),console['log']('\x20\x20\x20üí∞\x20Total\x20payout:\x20'+_0x1c20da[_0x30ed9d(0x2d8)]+_0x30ed9d(0x1d8)),console['log'](_0x30ed9d(0x196)+_0x1c20da[_0x30ed9d(0x248)]+_0x30ed9d(0x289)),console[_0x30ed9d(0x2d3)](_0x30ed9d(0x2c6)+_0x1c20da[_0x30ed9d(0x22d)]+_0x30ed9d(0x2d4)),console[_0x30ed9d(0x2d3)](_0x30ed9d(0x1c0)+_0x1c20da[_0x30ed9d(0x2b8)]+_0x30ed9d(0x257)),console['log'](_0x30ed9d(0x2a2)+_0x1c20da['totalPayments']+_0x30ed9d(0x26a)),_0x1c20da;}async[a40_0x64d77e(0x217)](_0x3fbb64,_0x3e82ab){const _0x1a1dcf=a40_0x64d77e;console[_0x1a1dcf(0x2d3)]('üîÑ\x20Updating\x20customer\x20data\x20for\x20payment\x20'+_0x3fbb64+':',_0x3e82ab);const _0x39944d=await database_1[_0x1a1dcf(0x237)]['payment']['findUnique']({'where':{'id':_0x3fbb64},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x39944d)throw new Error(_0x1a1dcf(0x290));const _0x6008cb={};_0x3e82ab['customerCountry']!==undefined&&(_0x6008cb[_0x1a1dcf(0x1bf)]=_0x3e82ab[_0x1a1dcf(0x1bf)]||null);_0x3e82ab['customerIp']!==undefined&&(_0x6008cb[_0x1a1dcf(0x1b1)]=_0x3e82ab['customerIp']||null);_0x3e82ab[_0x1a1dcf(0x2ef)]!==undefined&&(_0x6008cb[_0x1a1dcf(0x2ef)]=_0x3e82ab[_0x1a1dcf(0x2ef)]||null);const _0x1ba22c=await database_1[_0x1a1dcf(0x237)][_0x1a1dcf(0x288)][_0x1a1dcf(0x241)]({'where':{'id':_0x3fbb64},'data':{..._0x6008cb,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x1a1dcf(0x2d3)](_0x1a1dcf(0x1d5)+_0x3fbb64),console['log']('\x20\x20\x20üåç\x20Country:\x20'+_0x39944d[_0x1a1dcf(0x1bf)]+'\x20->\x20'+_0x1ba22c[_0x1a1dcf(0x1bf)]),console[_0x1a1dcf(0x2d3)](_0x1a1dcf(0x29d)+_0x39944d[_0x1a1dcf(0x1b1)]+'\x20->\x20'+_0x1ba22c[_0x1a1dcf(0x1b1)]),console[_0x1a1dcf(0x2d3)](_0x1a1dcf(0x262)+(_0x39944d['customerUa']?'set':_0x1a1dcf(0x254))+_0x1a1dcf(0x25b)+(_0x1ba22c[_0x1a1dcf(0x2ef)]?'set':_0x1a1dcf(0x254))),_0x1ba22c;}async[a40_0x64d77e(0x2db)](_0x49a4b6){const _0x4d2414=a40_0x64d77e,_0x1b3052=new Date();let _0x258ea8;switch(_0x49a4b6[_0x4d2414(0x212)]()){case _0x4d2414(0x2d2):_0x258ea8=new Date(_0x1b3052[_0x4d2414(0x1e5)](),_0x1b3052[_0x4d2414(0x1f5)](),_0x1b3052[_0x4d2414(0x2c7)](),0x0,0x0,0x0,0x0);break;case'yesterday':const _0x1bb18e=new Date(_0x1b3052);_0x1bb18e[_0x4d2414(0x228)](_0x1bb18e[_0x4d2414(0x2c7)]()-0x1),_0x258ea8=new Date(_0x1bb18e[_0x4d2414(0x1e5)](),_0x1bb18e[_0x4d2414(0x1f5)](),_0x1bb18e[_0x4d2414(0x2c7)](),0x0,0x0,0x0,0x0);break;case'7d':_0x258ea8=new Date(_0x1b3052['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x4d2414(0x19a):_0x258ea8=new Date(_0x1b3052[_0x4d2414(0x2b5)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x4d2414(0x1a1):_0x258ea8=new Date(_0x1b3052[_0x4d2414(0x2b5)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x4d2414(0x2e3):const _0x2732b6=await database_1['default']['payment'][_0x4d2414(0x1e9)]({'where':{'gateway':{'not':'test_gateway'}},'orderBy':{'createdAt':_0x4d2414(0x1e7)},'select':{'createdAt':!![]}});_0x258ea8=_0x2732b6?_0x2732b6['createdAt']:new Date(_0x4d2414(0x2ab));break;default:_0x258ea8=new Date(_0x1b3052[_0x4d2414(0x2b5)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}_0x258ea8['setHours'](0x0,0x0,0x0,0x0);let _0x37a022;if(_0x49a4b6['toLowerCase']()===_0x4d2414(0x2f2)){const _0x320d57=new Date(_0x1b3052);_0x320d57['setDate'](_0x320d57[_0x4d2414(0x2c7)]()-0x1),_0x37a022=new Date(_0x320d57['getFullYear'](),_0x320d57[_0x4d2414(0x1f5)](),_0x320d57['getDate'](),0x17,0x3b,0x3b,0x3e7);}const _0x3681d4={'gte':_0x258ea8};_0x37a022&&(_0x3681d4[_0x4d2414(0x295)]=_0x37a022);const [_0x2f69ec,_0x4b2785,_0x8f0a,_0x5f47c6,_0x5ceb92,_0xe6db4b]=await Promise[_0x4d2414(0x2e3)]([database_1[_0x4d2414(0x237)][_0x4d2414(0x28d)]['count'](),database_1[_0x4d2414(0x237)][_0x4d2414(0x28d)][_0x4d2414(0x1ea)]({'where':{'status':_0x4d2414(0x1a2)}}),database_1[_0x4d2414(0x237)][_0x4d2414(0x288)][_0x4d2414(0x1ea)]({'where':{'status':_0x4d2414(0x247),'createdAt':_0x3681d4,'gateway':{'not':_0x4d2414(0x278)}}}),database_1['default'][_0x4d2414(0x288)][_0x4d2414(0x1a7)]({'where':{'status':'PAID','createdAt':_0x3681d4,'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x4d2414(0x237)][_0x4d2414(0x288)][_0x4d2414(0x1a7)]({'where':{'gateway':{'not':_0x4d2414(0x278)}},'take':0xa,'orderBy':{'createdAt':_0x4d2414(0x294)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x4d2414(0x237)][_0x4d2414(0x288)]['findMany']({'where':{'createdAt':_0x3681d4,'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0xbad61f=0x0,_0x2dc3cd=0x0;for(const _0x28cbee of _0x5f47c6){const _0x2c9b26=await currencyService_1[_0x4d2414(0x2ac)]['convertToUSDT'](_0x28cbee[_0x4d2414(0x1d2)],_0x28cbee[_0x4d2414(0x275)]);_0xbad61f+=_0x2c9b26;if(_0x28cbee[_0x4d2414(0x1a9)]){const _0x2a1813=await currencyService_1[_0x4d2414(0x2ac)][_0x4d2414(0x2a9)](_0x28cbee[_0x4d2414(0x1d2)],_0x28cbee[_0x4d2414(0x275)]),_0x186ae9=_0x28cbee[_0x4d2414(0x1a9)],_0x104352=_0x2a1813-_0x186ae9;_0x2dc3cd+=_0x104352;}}const _0x277fe5=_0x8f0a>0x0?_0xbad61f/_0x8f0a:0x0,_0x53ba66=this[_0x4d2414(0x1ee)](_0xe6db4b,_0x258ea8,_0x37a022||_0x1b3052),_0x4ab02e=await database_1[_0x4d2414(0x237)][_0x4d2414(0x288)][_0x4d2414(0x1ea)]({'where':{'createdAt':_0x3681d4,'gateway':{'not':_0x4d2414(0x278)}}}),_0x1dffa8=_0x4ab02e>0x0?_0x8f0a/_0x4ab02e*0x64:0x0;return{'totalShops':_0x2f69ec,'activeShops':_0x4b2785,'totalPayments':_0x8f0a,'successfulPayments':_0x8f0a,'totalAttempts':_0x4ab02e,'totalRevenue':Math['round'](_0xbad61f*0x64)/0x64,'trapayEarnings':Math[_0x4d2414(0x28f)](_0x2dc3cd*0x64)/0x64,'averagePaymentAmount':Math['round'](_0x277fe5*0x64)/0x64,'conversionRate':Math[_0x4d2414(0x28f)](_0x1dffa8*0x64)/0x64,'dailyRevenue':_0x53ba66[_0x4d2414(0x2be)],'dailyPayments':_0x53ba66['dailyPayments'],'recentPayments':_0x5ceb92[_0x4d2414(0x29f)](_0x4d5139=>({'id':_0x4d5139['id'],'amount':_0x4d5139[_0x4d2414(0x1d2)],'currency':_0x4d5139[_0x4d2414(0x275)],'status':_0x4d5139[_0x4d2414(0x1a5)],'gateway':_0x4d5139[_0x4d2414(0x2e7)],'shop':_0x4d5139[_0x4d2414(0x28d)],'createdAt':_0x4d5139[_0x4d2414(0x211)]}))};}async[a40_0x64d77e(0x1df)](_0x37c0c3){const _0x30a38b=a40_0x64d77e;console['log'](_0x30a38b(0x283),_0x37c0c3);let _0x10501e,_0x589fd0=new Date();if(_0x37c0c3[_0x30a38b(0x1ac)]===_0x30a38b(0x1c6)&&_0x37c0c3['dateFrom']&&_0x37c0c3[_0x30a38b(0x2d5)])_0x10501e=new Date(_0x37c0c3[_0x30a38b(0x222)]),_0x589fd0=new Date(_0x37c0c3['dateTo']),_0x10501e[_0x30a38b(0x1b4)](0x0,0x0,0x0,0x0),_0x589fd0[_0x30a38b(0x1b4)](0x17,0x3b,0x3b,0x3e7);else{const _0x2208bf=new Date();switch(_0x37c0c3[_0x30a38b(0x1ac)]){case _0x30a38b(0x2ec):_0x10501e=new Date(_0x2208bf[_0x30a38b(0x2b5)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x30a38b(0x216):_0x10501e=new Date(_0x2208bf[_0x30a38b(0x2b5)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'year':_0x10501e=new Date(_0x2208bf[_0x30a38b(0x2b5)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x30a38b(0x2e3):default:_0x10501e=new Date('2020-01-01');break;}_0x10501e[_0x30a38b(0x1b4)](0x0,0x0,0x0,0x0),_0x589fd0[_0x30a38b(0x1b4)](0x17,0x3b,0x3b,0x3e7);}console[_0x30a38b(0x2d3)]('üìÖ\x20Period:\x20'+_0x10501e['toISOString']()+'\x20to\x20'+_0x589fd0[_0x30a38b(0x1db)]());const _0x4f99bc={'status':'PAID','gateway':{'not':'test_gateway'},'paidAt':{'gte':_0x10501e,'lte':_0x589fd0}};_0x37c0c3[_0x30a38b(0x24b)]&&(_0x4f99bc[_0x30a38b(0x24b)]=_0x37c0c3[_0x30a38b(0x24b)]);const _0x40d7a4=await database_1[_0x30a38b(0x237)][_0x30a38b(0x288)][_0x30a38b(0x1a7)]({'where':_0x4f99bc,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x30a38b(0x2d3)]('üí∞\x20Found\x20'+_0x40d7a4[_0x30a38b(0x1c7)]+_0x30a38b(0x273));const _0x24198c={'gateway':{'not':_0x30a38b(0x278)},'createdAt':{'gte':_0x10501e,'lte':_0x589fd0}};_0x37c0c3[_0x30a38b(0x24b)]&&(_0x24198c[_0x30a38b(0x24b)]=_0x37c0c3['shopId']);const _0xca3cd3=await database_1[_0x30a38b(0x237)][_0x30a38b(0x288)][_0x30a38b(0x1ea)]({'where':_0x24198c});console[_0x30a38b(0x2d3)](_0x30a38b(0x2cf)+_0xca3cd3+_0x30a38b(0x1bc)+_0x40d7a4['length']);let _0xec0cb8=0x0,_0x49580b=0x0,_0x24aeb6=0x0;const _0x4b072d={},_0x31959d={},_0x35eb9f={};for(const _0x23fe8d of _0x40d7a4){try{const _0x42f776=_0x23fe8d[_0x30a38b(0x232)]||0x0;if(_0x42f776<=0x0){console['warn'](_0x30a38b(0x227)+_0x23fe8d['id']+'\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...');continue;}let _0x4b4a6b,_0x372c63;if(_0x23fe8d[_0x30a38b(0x1a9)]!==null&&_0x23fe8d[_0x30a38b(0x1a9)]!==undefined)_0x4b4a6b=_0x23fe8d[_0x30a38b(0x1a9)],_0x372c63=_0x42f776-_0x4b4a6b,console[_0x30a38b(0x2d3)](_0x30a38b(0x2f0)+_0x23fe8d['id']+':\x20'+_0x42f776[_0x30a38b(0x2ae)](0x6)+_0x30a38b(0x259)+_0x4b4a6b[_0x30a38b(0x2ae)](0x6)+_0x30a38b(0x257));else{let _0x74d2ac={};if(_0x23fe8d[_0x30a38b(0x28d)][_0x30a38b(0x27c)])try{_0x74d2ac=JSON[_0x30a38b(0x2bb)](_0x23fe8d['shop'][_0x30a38b(0x27c)]);}catch(_0x236414){console[_0x30a38b(0x2c1)](_0x30a38b(0x253)+_0x23fe8d['shopId']+':',_0x236414);}let _0x38760d=0x2d;for(const [_0xdaf3aa,_0x331c75]of Object[_0x30a38b(0x2dc)](_0x74d2ac)){if(_0xdaf3aa[_0x30a38b(0x212)]()===_0x23fe8d[_0x30a38b(0x2e7)][_0x30a38b(0x212)]()){_0x38760d=_0x331c75[_0x30a38b(0x24c)]||0x2d;break;}}_0x372c63=_0x42f776*(_0x38760d/0x64),_0x4b4a6b=_0x42f776-_0x372c63,console[_0x30a38b(0x2d3)](_0x30a38b(0x2ce)+_0x23fe8d['id']+':\x20'+_0x38760d+'%\x20from\x20'+_0x42f776[_0x30a38b(0x2ae)](0x6)+_0x30a38b(0x257));}_0xec0cb8+=_0x42f776,_0x49580b+=_0x4b4a6b,_0x24aeb6+=_0x372c63;let _0x4b79a2;_0x23fe8d[_0x30a38b(0x1c1)]!==null&&_0x23fe8d[_0x30a38b(0x1c1)]!==undefined?(_0x4b79a2=_0x23fe8d[_0x30a38b(0x1c1)],console[_0x30a38b(0x2d3)](_0x30a38b(0x1bb)+_0x23fe8d['id']+':\x20'+_0x4b79a2+'%')):(_0x4b79a2=_0x42f776>0x0?_0x372c63/_0x42f776*0x64:0x0,console[_0x30a38b(0x2d3)](_0x30a38b(0x264)+_0x23fe8d['id']+':\x20'+_0x4b79a2[_0x30a38b(0x2ae)](0x2)+'%'));!_0x4b072d[_0x23fe8d[_0x30a38b(0x2e7)]]&&(_0x4b072d[_0x23fe8d[_0x30a38b(0x2e7)]]={'gateway':_0x23fe8d[_0x30a38b(0x2e7)],'gatewayDisplayName':this[_0x30a38b(0x29e)](_0x23fe8d[_0x30a38b(0x2e7)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x4b072d[_0x23fe8d['gateway']]['paymentsCount']++,_0x4b072d[_0x23fe8d[_0x30a38b(0x2e7)]]['turnoverUSDT']+=_0x42f776,_0x4b072d[_0x23fe8d[_0x30a38b(0x2e7)]][_0x30a38b(0x1e3)]+=_0x372c63,_0x4b072d[_0x23fe8d[_0x30a38b(0x2e7)]][_0x30a38b(0x1c8)]+=_0x4b4a6b,_0x4b072d[_0x23fe8d[_0x30a38b(0x2e7)]][_0x30a38b(0x1a6)]+=_0x4b79a2;!_0x37c0c3[_0x30a38b(0x24b)]&&(!_0x31959d[_0x23fe8d[_0x30a38b(0x24b)]]&&(_0x31959d[_0x23fe8d[_0x30a38b(0x24b)]]={'shopId':_0x23fe8d[_0x30a38b(0x24b)],'shopName':_0x23fe8d[_0x30a38b(0x28d)][_0x30a38b(0x297)],'shopUsername':_0x23fe8d['shop']['username'],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x31959d[_0x23fe8d['shopId']][_0x30a38b(0x1e0)]++,_0x31959d[_0x23fe8d[_0x30a38b(0x24b)]][_0x30a38b(0x266)]+=_0x42f776,_0x31959d[_0x23fe8d['shopId']][_0x30a38b(0x1e3)]+=_0x372c63,_0x31959d[_0x23fe8d[_0x30a38b(0x24b)]][_0x30a38b(0x1c8)]+=_0x4b4a6b);const _0x3e7d19=_0x23fe8d[_0x30a38b(0x23c)][_0x30a38b(0x1db)]()[_0x30a38b(0x215)]('T')[0x0];!_0x35eb9f[_0x3e7d19]&&(_0x35eb9f[_0x3e7d19]={'date':_0x3e7d19,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x35eb9f[_0x3e7d19]['turnover']+=_0x42f776,_0x35eb9f[_0x3e7d19][_0x30a38b(0x2df)]+=_0x4b4a6b,_0x35eb9f[_0x3e7d19]['gatewayEarnings']+=_0x372c63,_0x35eb9f[_0x3e7d19][_0x30a38b(0x1e0)]++;}catch(_0x174ec9){console['error'](_0x30a38b(0x21f)+_0x23fe8d['id']+':',_0x174ec9);}}Object['values'](_0x4b072d)[_0x30a38b(0x270)](_0x1f3374=>{const _0x5bda2e=_0x30a38b;_0x1f3374['averageCommissionRate']=_0x1f3374[_0x5bda2e(0x1e0)]>0x0?_0x1f3374[_0x5bda2e(0x1a6)]/_0x1f3374[_0x5bda2e(0x1e0)]:0x0,delete _0x1f3374[_0x5bda2e(0x1a6)];}),Object[_0x30a38b(0x263)](_0x31959d)['forEach'](_0x3622c1=>{const _0x22a1e5=_0x30a38b;_0x3622c1[_0x22a1e5(0x1ba)]=_0x3622c1['paymentsCount']>0x0?_0x3622c1['turnoverUSDT']/_0x3622c1['paymentsCount']:0x0;});let _0x4a5ab7=0x0,_0x5ef657=0x0;if(_0x37c0c3[_0x30a38b(0x24b)]){const _0x2d9693=await database_1[_0x30a38b(0x237)][_0x30a38b(0x20e)]['findMany']({'where':{'shopId':_0x37c0c3['shopId'],'status':_0x30a38b(0x24f),'createdAt':{'gte':_0x10501e,'lte':_0x589fd0}},'select':{'amount':!![]}});_0x4a5ab7=_0x2d9693[_0x30a38b(0x1c4)]((_0x194497,_0x1272ff)=>_0x194497+_0x1272ff['amount'],0x0);const _0x23ba95=await database_1[_0x30a38b(0x237)][_0x30a38b(0x20e)]['findMany']({'where':{'shopId':_0x37c0c3['shopId'],'status':_0x30a38b(0x296),'createdAt':{'gte':_0x10501e,'lte':_0x589fd0}},'select':{'amount':!![]}});_0x5ef657=_0x23ba95['reduce']((_0x1d10ed,_0x5aaf0b)=>_0x1d10ed+_0x5aaf0b['amount'],0x0);}const _0x3a567a=_0xca3cd3,_0x11370e=_0x40d7a4[_0x30a38b(0x1c7)],_0x2d284d=_0x11370e>0x0?_0xec0cb8/_0x11370e:0x0,_0x4464b7=_0x3a567a>0x0?Math['round'](_0x11370e/_0x3a567a*0x2710)/0x64:0x0,_0x55ea0b=Math[_0x30a38b(0x1f0)]((_0x589fd0[_0x30a38b(0x2b5)]()-_0x10501e[_0x30a38b(0x2b5)]())/(0x3e8*0x3c*0x3c*0x18)),_0x148bb9={'totalTurnover':Math['round'](_0xec0cb8*0x64)/0x64,'merchantEarnings':Math[_0x30a38b(0x28f)](_0x49580b*0x64)/0x64,'gatewayEarnings':Math[_0x30a38b(0x28f)](_0x24aeb6*0x64)/0x64,'totalPaidOut':Math[_0x30a38b(0x28f)](_0x4a5ab7*0x64)/0x64,'pendingPayout':Math[_0x30a38b(0x28f)](_0x5ef657*0x64)/0x64,'averageCheck':Math[_0x30a38b(0x28f)](_0x2d284d*0x64)/0x64,'totalPayments':_0x3a567a,'successfulPayments':_0x11370e,'conversionRate':_0x4464b7,'gatewayBreakdown':Object['values'](_0x4b072d)[_0x30a38b(0x29f)](_0x1de237=>({..._0x1de237,'turnoverUSDT':Math[_0x30a38b(0x28f)](_0x1de237[_0x30a38b(0x266)]*0x64)/0x64,'commissionUSDT':Math[_0x30a38b(0x28f)](_0x1de237[_0x30a38b(0x1e3)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x30a38b(0x28f)](_0x1de237[_0x30a38b(0x1c8)]*0x64)/0x64,'averageCommissionRate':Math[_0x30a38b(0x28f)](_0x1de237[_0x30a38b(0x1fb)]*0x64)/0x64})),'merchantBreakdown':_0x37c0c3[_0x30a38b(0x24b)]?undefined:Object[_0x30a38b(0x263)](_0x31959d)['map'](_0x3262f4=>({..._0x3262f4,'turnoverUSDT':Math[_0x30a38b(0x28f)](_0x3262f4['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x30a38b(0x28f)](_0x3262f4[_0x30a38b(0x1e3)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x30a38b(0x28f)](_0x3262f4[_0x30a38b(0x1c8)]*0x64)/0x64,'paidOutUSDT':Math[_0x30a38b(0x28f)](_0x3262f4[_0x30a38b(0x1e2)]*0x64)/0x64,'averageCheckUSDT':Math[_0x30a38b(0x28f)](_0x3262f4[_0x30a38b(0x1ba)]*0x64)/0x64})),'dailyData':Object['values'](_0x35eb9f)['map'](_0x176f13=>({..._0x176f13,'turnover':Math[_0x30a38b(0x28f)](_0x176f13[_0x30a38b(0x19b)]*0x64)/0x64,'merchantEarnings':Math[_0x30a38b(0x28f)](_0x176f13[_0x30a38b(0x2df)]*0x64)/0x64,'gatewayEarnings':Math['round'](_0x176f13['gatewayEarnings']*0x64)/0x64}))[_0x30a38b(0x235)]((_0x191e24,_0x571e2e)=>_0x191e24[_0x30a38b(0x240)][_0x30a38b(0x28e)](_0x571e2e[_0x30a38b(0x240)])),'periodInfo':{'from':_0x10501e,'to':_0x589fd0,'periodType':_0x37c0c3[_0x30a38b(0x1ac)]||'custom','daysCount':_0x55ea0b}};return console[_0x30a38b(0x2d3)](_0x30a38b(0x28b)),console[_0x30a38b(0x2d3)](_0x30a38b(0x1d7)+_0x148bb9[_0x30a38b(0x1e4)]+_0x30a38b(0x257)),console['log'](_0x30a38b(0x250)+_0x148bb9[_0x30a38b(0x2df)]+'\x20USDT'),console['log']('\x20\x20\x20üè™\x20Gateway\x20earnings:\x20'+_0x148bb9[_0x30a38b(0x2c5)]+'\x20USDT'),console[_0x30a38b(0x2d3)]('\x20\x20\x20ÔøΩ\x20Total\x20paid\x20out:\x20'+_0x148bb9[_0x30a38b(0x200)]+_0x30a38b(0x257)),console[_0x30a38b(0x2d3)](_0x30a38b(0x1d3)+_0x148bb9['pendingPayout']+_0x30a38b(0x257)),console[_0x30a38b(0x2d3)]('\x20\x20\x20ÔøΩüìä\x20Total\x20payments:\x20'+_0x148bb9['totalPayments']),_0x148bb9;}async[a40_0x64d77e(0x1c3)](_0x48397f){const _0xda2df5=a40_0x64d77e;console[_0xda2df5(0x2d3)]('üìã\x20Getting\x20merchants\x20selection\x20list...',{'hasPayoutHistory':_0x48397f});let _0x42af18={'status':'ACTIVE'};_0x48397f&&(_0x42af18[_0xda2df5(0x22f)]={'some':{}});const _0x1a1ab7=await database_1[_0xda2df5(0x237)][_0xda2df5(0x28d)][_0xda2df5(0x1a7)]({'where':_0x42af18,'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0xda2df5(0x1e7)}});return console[_0xda2df5(0x2d3)]('üìã\x20Found\x20'+_0x1a1ab7[_0xda2df5(0x1c7)]+'\x20active\x20merchants\x20for\x20selection'+(_0x48397f?'\x20with\x20payout\x20history':'')),_0x1a1ab7[_0xda2df5(0x29f)](_0xfac759=>({'id':_0xfac759['id'],'username':_0xfac759['username'],'name':_0xfac759[_0xda2df5(0x297)]}));}[a40_0x64d77e(0x29e)](_0x4e5b81){const _0x58eb78=a40_0x64d77e,_0x51d019={'test_gateway':'Test\x20Gateway','plisio':_0x58eb78(0x229),'rapyd':_0x58eb78(0x2a7),'noda':'Noda','cointopay':_0x58eb78(0x2b9),'cointopay2':_0x58eb78(0x1ad),'klyme_eu':'KLYME\x20EU','klyme_gb':'KLYME\x20GB','klyme_de':_0x58eb78(0x2d7),'mastercard':_0x58eb78(0x2c8)};return _0x51d019[_0x4e5b81]||_0x4e5b81;}['getGatewayInternalName'](_0x5006b7){const _0x4f6653=a40_0x64d77e,_0x475db9={'Test\x20Gateway':_0x4f6653(0x278),'Plisio':_0x4f6653(0x29c),'Rapyd':_0x4f6653(0x2ed),'Noda':_0x4f6653(0x1b5),'CoinToPay':'cointopay','CoinToPay2':_0x4f6653(0x293),'KLYME\x20EU':_0x4f6653(0x1b3),'KLYME\x20GB':'klyme_gb','KLYME\x20DE':_0x4f6653(0x197),'MasterCard':_0x4f6653(0x1ed)};return _0x475db9[_0x5006b7]||_0x5006b7['toLowerCase']();}async[a40_0x64d77e(0x2f1)](_0x2c603e){const _0x4750d8=a40_0x64d77e,{page:_0x12bf80,limit:_0xb51b8d,minAmount:_0x18fc84,search:_0x549adb}=_0x2c603e;console[_0x4750d8(0x2d3)](_0x4750d8(0x2a6),_0x2c603e);let _0x535a8c={'status':_0x4750d8(0x1a2)};_0x549adb&&(_0x535a8c[_0x4750d8(0x297)]={'contains':_0x549adb,'mode':_0x4750d8(0x23f)});const _0x15fb34=await database_1[_0x4750d8(0x237)][_0x4750d8(0x28d)][_0x4750d8(0x1a7)]({'where':_0x535a8c,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),_0x1b4550=_0x15fb34[_0x4750d8(0x1f3)](_0x518450=>{const _0x58c015=_0x4750d8,_0x345298=Math[_0x58c015(0x27a)](_0x518450['balance']*0x64)/0x64;if(_0x18fc84&&_0x345298<_0x18fc84)return![];return _0x345298!==0x0;});_0x1b4550['sort']((_0x4e1a85,_0x18aef2)=>_0x18aef2[_0x4750d8(0x234)]-_0x4e1a85[_0x4750d8(0x234)]);const _0x3ff55e=_0x1b4550['length'],_0x50bb36=(_0x12bf80-0x1)*_0xb51b8d,_0x2d4f45=_0x1b4550[_0x4750d8(0x1fd)](_0x50bb36,_0x50bb36+_0xb51b8d);console[_0x4750d8(0x2d3)](_0x4750d8(0x24d)+_0x2d4f45['length']+_0x4750d8(0x2bd));const _0x20c4e9=await Promise['all'](_0x2d4f45[_0x4750d8(0x29f)](async _0x45a9f2=>{const _0x44a892=_0x4750d8,[_0x351575,_0x4b3eff,_0x14566e]=await Promise[_0x44a892(0x2e3)]([database_1[_0x44a892(0x237)][_0x44a892(0x288)][_0x44a892(0x1ea)]({'where':{'shopId':_0x45a9f2['id'],'status':_0x44a892(0x247),'gateway':{'not':_0x44a892(0x278)}}}),database_1[_0x44a892(0x237)][_0x44a892(0x288)]['findFirst']({'where':{'shopId':_0x45a9f2['id'],'status':_0x44a892(0x247),'gateway':{'not':_0x44a892(0x278)}},'orderBy':{'paidAt':_0x44a892(0x1e7)},'select':{'paidAt':!![]}}),database_1[_0x44a892(0x237)][_0x44a892(0x288)][_0x44a892(0x2b4)]({'by':[_0x44a892(0x2e7)],'where':{'shopId':_0x45a9f2['id'],'status':'PAID','gateway':{'not':_0x44a892(0x278)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x547796=new Date(),_0x53c9fa=new Date(_0x547796['getFullYear'](),_0x547796[_0x44a892(0x1f5)](),0x1),_0x5c7649=new Date(_0x547796[_0x44a892(0x1e5)](),_0x547796['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x506543,_0x51266d]=await Promise['all']([database_1[_0x44a892(0x237)][_0x44a892(0x20e)][_0x44a892(0x1aa)]({'_sum':{'amount':!![]},'where':{'shopId':_0x45a9f2['id'],'status':_0x44a892(0x24f)}}),database_1[_0x44a892(0x237)][_0x44a892(0x20e)][_0x44a892(0x1aa)]({'_sum':{'amount':!![]},'where':{'shopId':_0x45a9f2['id'],'status':_0x44a892(0x24f),'createdAt':{'gte':_0x53c9fa,'lte':_0x5c7649}}})]),_0x18f7e2=_0x506543[_0x44a892(0x279)][_0x44a892(0x1d2)]||0x0,_0x4061ab=_0x51266d['_sum'][_0x44a892(0x1d2)]||0x0,_0x1c41aa=await Promise[_0x44a892(0x2e3)](_0x14566e[_0x44a892(0x29f)](async _0x10b890=>{const _0x9fa5b3=_0x44a892;let _0x25f080=0x2d;if(_0x45a9f2[_0x9fa5b3(0x27c)])try{const _0x494ab4=JSON[_0x9fa5b3(0x2bb)](_0x45a9f2[_0x9fa5b3(0x27c)]);for(const [_0x203344,_0x115318]of Object['entries'](_0x494ab4)){if(_0x203344['toLowerCase']()===_0x10b890[_0x9fa5b3(0x2e7)][_0x9fa5b3(0x212)]()){_0x25f080=_0x115318['commission']||0xa,console[_0x9fa5b3(0x2d3)](_0x9fa5b3(0x243)+_0x10b890[_0x9fa5b3(0x2e7)]+_0x9fa5b3(0x1f1)+_0x45a9f2['id']+_0x9fa5b3(0x281)+_0x25f080+'%');break;}}}catch(_0x2e4bce){console['error'](_0x9fa5b3(0x253)+_0x45a9f2['id']+':',_0x2e4bce);}const _0xf76367=_0x10b890[_0x9fa5b3(0x279)]?.[_0x9fa5b3(0x232)]||0x0,_0x45515e=_0xf76367*(0x1-_0x25f080/0x64);return{'gateway':_0x10b890[_0x9fa5b3(0x2e7)],'count':_0x10b890[_0x9fa5b3(0x1fe)]?.['id']||0x0,'amountUSDT':Math['round'](_0xf76367*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x9fa5b3(0x28f)](_0x45515e*0x64)/0x64,'commission':_0x25f080};})),_0x265de3=_0x1c41aa['reduce']((_0x5e6edf,_0x5f06a3)=>_0x5e6edf+_0x5f06a3[_0x44a892(0x232)],0x0),_0x428943=_0x1c41aa['reduce']((_0x417870,_0x3336c4)=>_0x417870+_0x3336c4[_0x44a892(0x1fc)],0x0),_0x3b46c8=_0x45a9f2[_0x44a892(0x234)];return console[_0x44a892(0x2d3)](_0x44a892(0x203)+_0x45a9f2[_0x44a892(0x23e)]+':'),console['log']('\x20\x20\x20ÔøΩ\x20Total\x20payments\x20turnover:\x20'+_0x265de3[_0x44a892(0x2ae)](0x2)+_0x44a892(0x25c)),console[_0x44a892(0x2d3)](_0x44a892(0x2e2)+_0x428943[_0x44a892(0x2ae)](0x2)+_0x44a892(0x2e5)),console['log'](_0x44a892(0x22e)+_0x3b46c8[_0x44a892(0x2ae)](0x2)+'\x20USDT\x20(current\x20balance\x20in\x20DB)'),console[_0x44a892(0x2d3)](_0x44a892(0x1be)+_0x18f7e2[_0x44a892(0x2ae)](0x2)+_0x44a892(0x2e1)),console['log'](_0x44a892(0x1f8)+(_0x428943-_0x18f7e2-_0x3b46c8)[_0x44a892(0x2ae)](0x2)+_0x44a892(0x223)),{'id':_0x45a9f2['id'],'fullName':_0x45a9f2[_0x44a892(0x297)],'username':_0x45a9f2[_0x44a892(0x23e)],'telegramId':_0x45a9f2[_0x44a892(0x2f3)],'merchantUrl':_0x45a9f2[_0x44a892(0x2af)],'wallets':{'usdtPolygonWallet':_0x45a9f2[_0x44a892(0x28a)],'usdtTrcWallet':_0x45a9f2[_0x44a892(0x252)],'usdtErcWallet':_0x45a9f2['usdtErcWallet'],'usdcPolygonWallet':_0x45a9f2['usdcPolygonWallet'],'usdcErcWallet':_0x45a9f2[_0x44a892(0x208)]},'totalAmountUSDT':Math[_0x44a892(0x28f)](_0x265de3*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x44a892(0x28f)](_0x428943*0x64)/0x64,'currentBalance':Math['floor'](_0x3b46c8*0x64)/0x64,'totalPayout':Math[_0x44a892(0x28f)](_0x18f7e2*0x64)/0x64,'thisMonth':Math['round'](_0x4061ab*0x64)/0x64,'paymentsCount':_0x351575,'oldestPaymentDate':_0x4b3eff?.[_0x44a892(0x23c)]||_0x45a9f2[_0x44a892(0x211)],'gatewayBreakdown':_0x1c41aa};})),_0x4e6f6e=_0x20c4e9['reduce']((_0x539246,_0x44caf0)=>_0x539246+_0x44caf0[_0x4750d8(0x28c)],0x0),_0x5cb312=_0x20c4e9[_0x4750d8(0x1c4)]((_0x2723ad,_0x1d1faf)=>_0x2723ad+_0x1d1faf[_0x4750d8(0x1ae)],0x0),_0x16d52d=_0x20c4e9['reduce']((_0x1b0f7d,_0x524231)=>_0x1b0f7d+_0x524231[_0x4750d8(0x2d8)],0x0),_0x2bbba5=_0x20c4e9['reduce']((_0x1df640,_0x5609a6)=>_0x1df640+_0x5609a6[_0x4750d8(0x2b8)],0x0);return console[_0x4750d8(0x2d3)](_0x4750d8(0x2bf)+_0x3ff55e+_0x4750d8(0x21b)),console['log'](_0x4750d8(0x1dc)+Math[_0x4750d8(0x28f)](_0x4e6f6e*0x64)/0x64+_0x4750d8(0x25c)),console[_0x4750d8(0x2d3)]('\x20\x20\x20‚úÖ\x20Total\x20net\x20balances:\x20'+Math[_0x4750d8(0x28f)](_0x5cb312*0x64)/0x64+'\x20USDT\x20(rounded\x20to\x202\x20decimal\x20places)'),console['log'](_0x4750d8(0x1cb)+Math[_0x4750d8(0x28f)](_0x16d52d*0x64)/0x64+_0x4750d8(0x257)),console[_0x4750d8(0x2d3)](_0x4750d8(0x27b)+Math[_0x4750d8(0x28f)](_0x2bbba5*0x64)/0x64+_0x4750d8(0x257)),{'merchants':_0x20c4e9,'pagination':{'page':_0x12bf80,'limit':_0xb51b8d,'total':_0x3ff55e,'totalPages':Math[_0x4750d8(0x1f0)](_0x3ff55e/_0xb51b8d)},'summary':{'totalMerchants':_0x3ff55e,'totalAmountUSDT':Math[_0x4750d8(0x28f)](_0x4e6f6e*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x5cb312*0x64)/0x64,'totalPayout':Math[_0x4750d8(0x28f)](_0x16d52d*0x64)/0x64,'thisMonth':Math[_0x4750d8(0x28f)](_0x2bbba5*0x64)/0x64}};}async[a40_0x64d77e(0x2b2)](_0x1389f0){const _0xa5ebe9=a40_0x64d77e,{shopId:_0x49558a,amount:_0x121b30,network:_0x2c13fe,wallet:_0xe01799,notes:_0x5886df,txid:_0x5d7c23,periodFrom:_0x4d1457,periodTo:_0x2eab27}=_0x1389f0,_0x3afb0b=await database_1[_0xa5ebe9(0x237)][_0xa5ebe9(0x2e9)](async _0xf43d82=>{const _0x394b8f=_0xa5ebe9,_0x485b1d=await _0xf43d82[_0x394b8f(0x28d)][_0x394b8f(0x239)]({'where':{'id':_0x49558a},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x485b1d)throw new Error('Shop\x20not\x20found');console['log']('üí∞\x20Creating\x20payout\x20for\x20shop\x20'+_0x485b1d[_0x394b8f(0x23e)]+':'),console['log']('\x20\x20\x20Current\x20balance:\x20'+_0x485b1d['balance']['toFixed'](0x6)+'\x20USDT'),console[_0x394b8f(0x2d3)](_0x394b8f(0x255)+_0x121b30[_0x394b8f(0x2ae)](0x6)+_0x394b8f(0x257)),console[_0x394b8f(0x2d3)](_0x394b8f(0x2b0)+_0x485b1d[_0x394b8f(0x200)][_0x394b8f(0x2ae)](0x6)+_0x394b8f(0x257));if(_0x5d7c23)console['log'](_0x394b8f(0x1f2)+_0x5d7c23);const _0x7d89cd=0.000001,_0x5baec9=Number(_0x485b1d[_0x394b8f(0x234)]),_0x12467b=Number(_0x121b30);console['log'](_0x394b8f(0x1bd)),console[_0x394b8f(0x2d3)](_0x394b8f(0x1dd)+_0x485b1d[_0x394b8f(0x234)]),console['log'](_0x394b8f(0x1fa)+_0x5baec9),console[_0x394b8f(0x2d3)](_0x394b8f(0x27e)+_0x12467b),console[_0x394b8f(0x2d3)](_0x394b8f(0x1d9)+(_0x5baec9-_0x12467b)),console[_0x394b8f(0x2d3)]('\x20\x20\x20Tolerance:\x20'+_0x7d89cd);if(_0x5baec9<_0x12467b-_0x7d89cd)throw new Error('Insufficient\x20balance.\x20Available:\x20'+_0x5baec9[_0x394b8f(0x2ae)](0x6)+_0x394b8f(0x2b6)+_0x12467b['toFixed'](0x6)+_0x394b8f(0x27f)+(_0x5baec9-_0x12467b)[_0x394b8f(0x2ae)](0x8)+_0x394b8f(0x257));console[_0x394b8f(0x2d3)](_0x394b8f(0x2a3));const _0x5d8994=Math[_0x394b8f(0x271)](_0x5baec9,_0x12467b);let _0x17851a=_0xe01799;console['log'](_0x394b8f(0x213)+(_0xe01799||_0x394b8f(0x249)));if(!_0x17851a){console[_0x394b8f(0x2d3)](_0x394b8f(0x26b));const _0x3670c6=await _0xf43d82[_0x394b8f(0x28d)][_0x394b8f(0x239)]({'where':{'id':_0x49558a},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});console['log'](_0x394b8f(0x260),_0x3670c6);if(_0x3670c6)switch(_0x2c13fe){case'polygon':_0x17851a=_0x3670c6[_0x394b8f(0x28a)]||undefined,console[_0x394b8f(0x2d3)](_0x394b8f(0x220)+_0x17851a);break;case _0x394b8f(0x20a):_0x17851a=_0x3670c6['usdtTrcWallet']||undefined,console[_0x394b8f(0x2d3)]('üîç\x20Selected\x20trc20\x20wallet:\x20'+_0x17851a);break;case _0x394b8f(0x2ad):_0x17851a=_0x3670c6[_0x394b8f(0x1e6)]||undefined,console['log'](_0x394b8f(0x2d6)+_0x17851a);break;case'polygon_usdc':_0x17851a=_0x3670c6['usdcPolygonWallet']||undefined,console['log']('üîç\x20Selected\x20polygon_usdc\x20wallet:\x20'+_0x17851a);break;case'erc20_usdc':_0x17851a=_0x3670c6['usdcErcWallet']||undefined,console[_0x394b8f(0x2d3)]('üîç\x20Selected\x20erc20_usdc\x20wallet:\x20'+_0x17851a);break;}}else console[_0x394b8f(0x2d3)](_0x394b8f(0x233)+_0x17851a);console[_0x394b8f(0x2d3)](_0x394b8f(0x1cd)+_0x2c13fe+':\x20'+(_0x17851a||_0x394b8f(0x1b8))),console[_0x394b8f(0x2d3)]('üîç\x20Creating\x20payout\x20with\x20data:',{'shopId':_0x49558a,'amount':_0x5d8994,'network':_0x2c13fe,'wallet':_0x17851a,'status':_0x394b8f(0x24f),'txid':_0x5d7c23,'notes':_0x5886df,'periodFrom':_0x4d1457?new Date(_0x4d1457):null,'periodTo':_0x2eab27?new Date(_0x2eab27):null});const _0x5d0848=await _0xf43d82[_0x394b8f(0x20e)][_0x394b8f(0x25a)]({'data':{'shopId':_0x49558a,'amount':_0x5d8994,'network':_0x2c13fe,'wallet':_0x17851a,'status':_0x394b8f(0x24f),'txid':_0x5d7c23,'notes':_0x5886df,'periodFrom':_0x4d1457?new Date(_0x4d1457):null,'periodTo':_0x2eab27?new Date(_0x2eab27):null,'createdAt':new Date(),'paidAt':new Date()}});console['log'](_0x394b8f(0x1af),{'id':_0x5d0848['id'],'wallet':_0x5d0848[_0x394b8f(0x265)],'network':_0x5d0848[_0x394b8f(0x242)],'amount':_0x5d0848[_0x394b8f(0x1d2)]});const _0x692cb9=_0x5baec9-_0x5d8994,_0x19b20b=Number(_0x485b1d[_0x394b8f(0x200)])+_0x5d8994;return await _0xf43d82['shop']['update']({'where':{'id':_0x49558a},'data':{'balance':_0x692cb9,'totalPaidOut':_0x19b20b}}),console[_0x394b8f(0x2d3)](_0x394b8f(0x2a5)+_0x485b1d[_0x394b8f(0x23e)]+_0x394b8f(0x261)),console['log'](_0x394b8f(0x2c3)+_0x5baec9[_0x394b8f(0x2ae)](0x6)+_0x394b8f(0x25b)+_0x692cb9[_0x394b8f(0x2ae)](0x6)+_0x394b8f(0x2dd)+_0x5d8994[_0x394b8f(0x2ae)](0x6)+')'),console['log'](_0x394b8f(0x1b2)+_0x485b1d[_0x394b8f(0x200)][_0x394b8f(0x2ae)](0x6)+_0x394b8f(0x25b)+_0x19b20b['toFixed'](0x6)+_0x394b8f(0x1de)+_0x5d8994['toFixed'](0x6)+')'),console[_0x394b8f(0x2d3)](_0x394b8f(0x1d4)+_0x5d8994[_0x394b8f(0x2ae)](0x6)+'\x20USDT'),{'payout':_0x5d0848,'shop':_0x485b1d};});console[_0xa5ebe9(0x2d3)]('‚úÖ\x20Payout\x20created:\x20'+_0x3afb0b[_0xa5ebe9(0x20e)]['id']+'\x20for\x20shop\x20'+_0x3afb0b[_0xa5ebe9(0x28d)]['username']+'\x20('+_0x3afb0b[_0xa5ebe9(0x20e)][_0xa5ebe9(0x1d2)]['toFixed'](0x6)+'\x20USDT)');try{let _0x4c4ab2=_0xa5ebe9(0x207);if(_0x3afb0b[_0xa5ebe9(0x20e)][_0xa5ebe9(0x287)]&&_0x3afb0b[_0xa5ebe9(0x20e)][_0xa5ebe9(0x291)]){const _0x40fd37=new Date(_0x3afb0b[_0xa5ebe9(0x20e)][_0xa5ebe9(0x287)])[_0xa5ebe9(0x205)]('ru-RU'),_0x32dcfe=new Date(_0x3afb0b[_0xa5ebe9(0x20e)][_0xa5ebe9(0x291)])['toLocaleDateString'](_0xa5ebe9(0x22a));_0x4c4ab2=_0x40fd37+_0xa5ebe9(0x201)+_0x32dcfe;}await telegramBotService_1['telegramBotService']['sendPayoutNotification'](_0x3afb0b[_0xa5ebe9(0x20e)][_0xa5ebe9(0x24b)],{'id':_0x3afb0b[_0xa5ebe9(0x20e)]['id'],'amount':_0x3afb0b[_0xa5ebe9(0x20e)][_0xa5ebe9(0x1d2)],'network':_0x3afb0b[_0xa5ebe9(0x20e)][_0xa5ebe9(0x242)],'wallet':_0x3afb0b['payout'][_0xa5ebe9(0x265)],'period':_0x4c4ab2,'createdAt':_0x3afb0b[_0xa5ebe9(0x20e)]['createdAt'],'txid':_0x3afb0b[_0xa5ebe9(0x20e)][_0xa5ebe9(0x206)]}),console['log']('üì±\x20Telegram\x20notification\x20sent\x20for\x20payout\x20'+_0x3afb0b[_0xa5ebe9(0x20e)]['id']);}catch(_0x5b21db){console[_0xa5ebe9(0x2c1)](_0xa5ebe9(0x224)+_0x3afb0b[_0xa5ebe9(0x20e)]['id']+':',_0x5b21db);}return{'id':_0x3afb0b['payout']['id'],'shopId':_0x3afb0b[_0xa5ebe9(0x20e)][_0xa5ebe9(0x24b)],'shopName':_0x3afb0b[_0xa5ebe9(0x28d)]['name'],'shopUsername':_0x3afb0b[_0xa5ebe9(0x28d)][_0xa5ebe9(0x23e)],'amount':_0x3afb0b[_0xa5ebe9(0x20e)][_0xa5ebe9(0x1d2)],'network':_0x3afb0b[_0xa5ebe9(0x20e)]['network'],'wallet':_0x3afb0b['payout'][_0xa5ebe9(0x265)],'status':_0x3afb0b[_0xa5ebe9(0x20e)][_0xa5ebe9(0x1a5)],'txid':_0x3afb0b['payout']['txid'],'notes':_0x3afb0b[_0xa5ebe9(0x20e)][_0xa5ebe9(0x20f)],'periodFrom':_0x3afb0b[_0xa5ebe9(0x20e)][_0xa5ebe9(0x287)],'periodTo':_0x3afb0b['payout'][_0xa5ebe9(0x291)],'createdAt':_0x3afb0b[_0xa5ebe9(0x20e)][_0xa5ebe9(0x211)],'paidAt':_0x3afb0b[_0xa5ebe9(0x20e)]['paidAt']};}async[a40_0x64d77e(0x284)](_0x45928c){const _0x14f720=a40_0x64d77e,{page:_0x4661a0,limit:_0x3537e0,shopId:_0x292b3f,network:_0x11eb60,dateFrom:_0x54be94,dateTo:_0x32c7c2,search:_0x32198e}=_0x45928c,_0x4f47cb=(_0x4661a0-0x1)*_0x3537e0,_0x571f64={};_0x292b3f&&(_0x571f64[_0x14f720(0x24b)]=_0x292b3f);_0x11eb60&&(_0x571f64['network']=_0x11eb60);if(_0x54be94||_0x32c7c2){_0x571f64['createdAt']={};if(_0x54be94){const _0x13da32=new Date(_0x54be94);_0x13da32[_0x14f720(0x1b4)](0x0,0x0,0x0,0x1),_0x571f64[_0x14f720(0x211)]['gte']=_0x13da32,console[_0x14f720(0x2d3)](_0x14f720(0x2a8)+_0x13da32['toISOString']());}if(_0x32c7c2){const _0x3b6f4c=new Date(_0x32c7c2);_0x3b6f4c[_0x14f720(0x1b4)](0x17,0x3b,0x3b,0x3e7),_0x571f64['createdAt'][_0x14f720(0x295)]=_0x3b6f4c,console['log'](_0x14f720(0x1a0)+_0x3b6f4c[_0x14f720(0x1db)]());}}_0x32198e&&(_0x571f64['OR']=[{'shop':{'name':{'contains':_0x32198e,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x32198e,'mode':_0x14f720(0x23f)}}},{'notes':{'contains':_0x32198e,'mode':'insensitive'}}]);const [_0x2df1a0,_0x50af14]=await Promise[_0x14f720(0x2e3)]([database_1[_0x14f720(0x237)]['payout'][_0x14f720(0x1a7)]({'where':_0x571f64,'skip':_0x4f47cb,'take':_0x3537e0,'orderBy':{'createdAt':_0x14f720(0x294)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'wallet':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x14f720(0x237)]['payout']['count']({'where':_0x571f64})]);return{'payouts':_0x2df1a0['map'](_0x4e4546=>({'id':_0x4e4546['id'],'shopId':_0x4e4546[_0x14f720(0x24b)],'shopName':_0x4e4546[_0x14f720(0x28d)][_0x14f720(0x297)],'shopUsername':_0x4e4546['shop'][_0x14f720(0x23e)],'amount':_0x4e4546[_0x14f720(0x1d2)],'network':_0x4e4546['network'],'wallet':_0x4e4546[_0x14f720(0x265)],'status':_0x4e4546['status'],'txid':_0x4e4546[_0x14f720(0x206)],'notes':_0x4e4546['notes'],'periodFrom':_0x4e4546[_0x14f720(0x287)],'periodTo':_0x4e4546[_0x14f720(0x291)],'createdAt':_0x4e4546[_0x14f720(0x211)],'paidAt':_0x4e4546[_0x14f720(0x23c)]})),'pagination':{'page':_0x4661a0,'limit':_0x3537e0,'total':_0x50af14,'totalPages':Math[_0x14f720(0x1f0)](_0x50af14/_0x3537e0)}};}async[a40_0x64d77e(0x19f)](_0x2906d1){const _0x974116=a40_0x64d77e,_0x558781=await database_1[_0x974116(0x237)][_0x974116(0x20e)]['findUnique']({'where':{'id':_0x2906d1},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x558781)return null;return{'id':_0x558781['id'],'shopId':_0x558781[_0x974116(0x24b)],'shopName':_0x558781[_0x974116(0x28d)][_0x974116(0x297)],'shopUsername':_0x558781[_0x974116(0x28d)]['username'],'amount':_0x558781[_0x974116(0x1d2)],'network':_0x558781[_0x974116(0x242)],'wallet':_0x558781[_0x974116(0x265)],'status':_0x558781[_0x974116(0x1a5)],'txid':_0x558781[_0x974116(0x206)],'notes':_0x558781[_0x974116(0x20f)],'periodFrom':_0x558781[_0x974116(0x287)],'periodTo':_0x558781[_0x974116(0x291)],'createdAt':_0x558781[_0x974116(0x211)],'paidAt':_0x558781[_0x974116(0x23c)]};}async[a40_0x64d77e(0x20c)](_0x480285){const _0x185426=a40_0x64d77e;await database_1[_0x185426(0x237)][_0x185426(0x20e)][_0x185426(0x24e)]({'where':{'id':_0x480285}});}async['getAllPayments'](_0x4f5783){const _0x5cfce7=a40_0x64d77e,{page:_0x296312,limit:_0x3c3e95,status:_0x2d5aa8,gateway:_0x33fee2,shopId:_0x181503,dateFrom:_0x3343ec,dateTo:_0x4b041f,search:_0x33505b,currency:_0x197596,sortBy:_0x5dd588,sortOrder:_0x3075b5}=_0x4f5783,_0xbf5ebb=(_0x296312-0x1)*_0x3c3e95;console[_0x5cfce7(0x2d3)](_0x5cfce7(0x298),_0x4f5783);const _0x257f82=await database_1[_0x5cfce7(0x237)]['payment']['groupBy']({'by':[_0x5cfce7(0x2e7)],'_count':{'gateway':!![]}});console['log']('üìä\x20Available\x20gateways\x20in\x20database:',_0x257f82[_0x5cfce7(0x29f)](_0x22edb2=>_0x22edb2[_0x5cfce7(0x2e7)]+'\x20('+_0x22edb2[_0x5cfce7(0x1fe)]['gateway']+_0x5cfce7(0x272)));if(_0x33fee2){const _0x5184f8=_0x257f82[_0x5cfce7(0x21a)](_0x437f40=>_0x437f40[_0x5cfce7(0x2e7)]['toLowerCase']()===_0x33fee2['toLowerCase']());!_0x5184f8&&_0x33fee2[_0x5cfce7(0x212)]()!==_0x5cfce7(0x278)&&console['log'](_0x5cfce7(0x2c9)+_0x33fee2+_0x5cfce7(0x25e)+_0x257f82['map'](_0x34f161=>_0x34f161['gateway'])[_0x5cfce7(0x2b3)](',\x20'));}const _0xc7d240={};_0x2d5aa8&&(_0xc7d240[_0x5cfce7(0x1a5)]=_0x2d5aa8['toUpperCase']());if(!_0x33fee2)_0xc7d240[_0x5cfce7(0x2e7)]={'not':_0x5cfce7(0x278)};else{if(_0x33fee2&&(_0x33fee2['toLowerCase']()==='test_gateway'||_0x33fee2===_0x5cfce7(0x1a4)))_0xc7d240['gateway']='test_gateway';else{let _0x1ad8d0=_0x33fee2;const _0x3bdffa=(0x0,gateway_1[_0x5cfce7(0x19d)])(_0x33fee2);if(_0x3bdffa)_0x1ad8d0=_0x3bdffa,console[_0x5cfce7(0x2d3)](_0x5cfce7(0x218)+_0x33fee2+'\x27\x20to\x20name\x20\x27'+_0x1ad8d0+'\x27');else{const _0xe0ec10=(0x0,gateway_1[_0x5cfce7(0x1cf)])(_0x33fee2);if(_0xe0ec10){const _0x49762b=(0x0,gateway_1[_0x5cfce7(0x19d)])(_0xe0ec10);_0x49762b&&(_0x1ad8d0=_0x49762b,console[_0x5cfce7(0x2d3)](_0x5cfce7(0x2e4)+_0x33fee2+_0x5cfce7(0x238)+_0xe0ec10+_0x5cfce7(0x2a0)+_0x1ad8d0+'\x27'));}else console[_0x5cfce7(0x2d3)](_0x5cfce7(0x274)+_0x33fee2+_0x5cfce7(0x2cd));}const _0x28b2a4=await database_1['default'][_0x5cfce7(0x288)][_0x5cfce7(0x1ea)]({'where':{'gateway':_0x1ad8d0[_0x5cfce7(0x212)]()},'take':0x1});_0x28b2a4===0x0?(console[_0x5cfce7(0x2d3)](_0x5cfce7(0x1c5)+_0x1ad8d0+_0x5cfce7(0x276)+_0x33fee2+'\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result'),_0xc7d240[_0x5cfce7(0x2e7)]=_0x5cfce7(0x2b1)):(_0xc7d240[_0x5cfce7(0x2e7)]=_0x1ad8d0[_0x5cfce7(0x212)](),console['log']('‚úÖ\x20Using\x20gateway\x20filter:\x20\x27'+_0x1ad8d0+_0x5cfce7(0x276)+_0x33fee2+'\x27)'));}}console[_0x5cfce7(0x2d3)](_0x5cfce7(0x20d),_0xc7d240['gateway']);_0x181503&&(_0xc7d240['shopId']=_0x181503);_0x197596&&(_0xc7d240[_0x5cfce7(0x275)]=_0x197596[_0x5cfce7(0x1d0)](),console['log']('üí±\x20Currency\x20filter\x20applied:\x20'+_0x197596[_0x5cfce7(0x1d0)]()));if(_0x3343ec||_0x4b041f){_0xc7d240[_0x5cfce7(0x211)]={};if(_0x3343ec){const _0x5dcb0d=new Date(_0x3343ec);_0x5dcb0d[_0x5cfce7(0x1b4)](0x0,0x0,0x0,0x1),_0xc7d240[_0x5cfce7(0x211)][_0x5cfce7(0x2d0)]=_0x5dcb0d,console[_0x5cfce7(0x2d3)](_0x5cfce7(0x299)+_0x5dcb0d[_0x5cfce7(0x1db)]());}if(_0x4b041f){const _0x24d35d=new Date(_0x4b041f);_0x24d35d['setHours'](0x17,0x3b,0x3b,0x3e7),_0xc7d240['createdAt']['lte']=_0x24d35d,console['log'](_0x5cfce7(0x1b0)+_0x24d35d['toISOString']());}}_0x33505b&&(_0xc7d240['OR']=[{'id':{'contains':_0x33505b,'mode':_0x5cfce7(0x23f)}},{'orderId':{'contains':_0x33505b,'mode':_0x5cfce7(0x23f)}},{'gatewayOrderId':{'contains':_0x33505b,'mode':'insensitive'}},{'customerEmail':{'contains':_0x33505b,'mode':_0x5cfce7(0x23f)}},{'shop':{'name':{'contains':_0x33505b,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x33505b,'mode':_0x5cfce7(0x23f)}}}]);console[_0x5cfce7(0x2d3)](_0x5cfce7(0x1ab),JSON[_0x5cfce7(0x269)](_0xc7d240,null,0x2));let _0x15e5a8={'createdAt':_0x5cfce7(0x294)};if(_0x5dd588){const _0x1bf796=['amount','createdAt','updatedAt',_0x5cfce7(0x1a5),_0x5cfce7(0x2e7),_0x5cfce7(0x275)],_0x3af16e=[_0x5cfce7(0x1e7),_0x5cfce7(0x294)];if(_0x1bf796['includes'](_0x5dd588)){const _0xaceb9a=_0x3af16e[_0x5cfce7(0x244)](_0x3075b5)?_0x3075b5:'desc';_0x15e5a8={[_0x5dd588]:_0xaceb9a},console[_0x5cfce7(0x2d3)]('üìä\x20Sorting\x20payments\x20by\x20'+_0x5dd588+_0x5cfce7(0x25f)+_0xaceb9a+_0x5cfce7(0x209));}}const [_0x69e0bc,_0x76c490]=await Promise[_0x5cfce7(0x2e3)]([database_1[_0x5cfce7(0x237)]['payment'][_0x5cfce7(0x1a7)]({'where':_0xc7d240,'skip':_0xbf5ebb,'take':_0x3c3e95,'orderBy':_0x15e5a8,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x5cfce7(0x237)][_0x5cfce7(0x288)][_0x5cfce7(0x1ea)]({'where':_0xc7d240})]);return{'payments':_0x69e0bc,'pagination':{'page':_0x296312,'limit':_0x3c3e95,'total':_0x76c490,'totalPages':Math[_0x5cfce7(0x1f0)](_0x76c490/_0x3c3e95)}};}async[a40_0x64d77e(0x1cc)](_0x288f84){const _0x1266a4=a40_0x64d77e,_0x4bf40e=await database_1[_0x1266a4(0x237)][_0x1266a4(0x288)][_0x1266a4(0x239)]({'where':{'id':_0x288f84},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x4bf40e)return null;return{'id':_0x4bf40e['id'],'shopId':_0x4bf40e[_0x1266a4(0x24b)],'gateway':_0x4bf40e[_0x1266a4(0x2e7)],'amount':_0x4bf40e['amount'],'currency':_0x4bf40e[_0x1266a4(0x275)],'status':_0x4bf40e[_0x1266a4(0x1a5)],'orderId':_0x4bf40e[_0x1266a4(0x2ba)],'gatewayOrderId':_0x4bf40e[_0x1266a4(0x267)],'customerEmail':_0x4bf40e[_0x1266a4(0x2b7)],'customerName':_0x4bf40e[_0x1266a4(0x29a)],'customerCountry':_0x4bf40e[_0x1266a4(0x1bf)],'customerIp':_0x4bf40e['customerIp'],'customerUa':_0x4bf40e[_0x1266a4(0x2ef)],'failureMessage':_0x4bf40e[_0x1266a4(0x2cc)],'externalPaymentUrl':_0x4bf40e['externalPaymentUrl'],'successUrl':_0x4bf40e[_0x1266a4(0x1ca)],'failUrl':_0x4bf40e['failUrl'],'pendingUrl':_0x4bf40e['pendingUrl'],'whiteUrl':_0x4bf40e[_0x1266a4(0x1d6)],'createdAt':_0x4bf40e[_0x1266a4(0x211)],'updatedAt':_0x4bf40e[_0x1266a4(0x1f7)],'shop':_0x4bf40e[_0x1266a4(0x28d)]};}async[a40_0x64d77e(0x1a3)](_0x481f24,_0x4e114f,_0x12c9f2,_0x3590d7){const _0x4489a9=a40_0x64d77e,_0x567ee3=await database_1[_0x4489a9(0x237)][_0x4489a9(0x2e9)](async _0x480ab9=>{const _0x14ec0f=_0x4489a9,_0x202118=await _0x480ab9[_0x14ec0f(0x288)][_0x14ec0f(0x239)]({'where':{'id':_0x481f24},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x202118)throw new Error('Payment\x20not\x20found');const _0x137d92=_0x202118[_0x14ec0f(0x1a5)],_0x2aa666=_0x4e114f['toUpperCase']();console[_0x14ec0f(0x2d3)]('üîÑ\x20Admin\x20updating\x20payment\x20'+_0x481f24+_0x14ec0f(0x1eb)+_0x137d92+_0x14ec0f(0x25b)+_0x2aa666),console[_0x14ec0f(0x2d3)](_0x14ec0f(0x2c2)+_0x202118[_0x14ec0f(0x28d)][_0x14ec0f(0x234)]+_0x14ec0f(0x257));const _0xa39af={'status':_0x2aa666,'updatedAt':new Date(),'statusChangedBy':'admin','statusChangedAt':new Date()};_0x12c9f2&&(_0xa39af[_0x14ec0f(0x23d)]=_0x12c9f2);_0x2aa666===_0x14ec0f(0x2eb)&&_0x3590d7&&(_0xa39af[_0x14ec0f(0x24a)]=_0x3590d7);let _0x11b59e=0x0,_0x38103e=_0x202118['shop'][_0x14ec0f(0x234)];if(_0x2aa666===_0x14ec0f(0x247)&&_0x137d92!=='PAID'){_0xa39af['paidAt']=new Date();const _0x10b58c=await currencyService_1[_0x14ec0f(0x2ac)][_0x14ec0f(0x2a9)](_0x202118[_0x14ec0f(0x1d2)],_0x202118[_0x14ec0f(0x275)]);_0xa39af[_0x14ec0f(0x232)]=_0x10b58c;let _0xc28fc1=0x2d;const _0x21aba0=await _0x480ab9[_0x14ec0f(0x28d)][_0x14ec0f(0x239)]({'where':{'id':_0x202118[_0x14ec0f(0x24b)]},'select':{'gatewaySettings':!![]}});if(_0x21aba0?.['gatewaySettings'])try{const _0x5b189a=JSON[_0x14ec0f(0x2bb)](_0x21aba0[_0x14ec0f(0x27c)]);for(const [_0x518b92,_0x200520]of Object[_0x14ec0f(0x2dc)](_0x5b189a)){if(_0x518b92[_0x14ec0f(0x212)]()===_0x202118[_0x14ec0f(0x2e7)][_0x14ec0f(0x212)]()){_0xc28fc1=_0x200520[_0x14ec0f(0x24c)]||0xa;break;}}}catch(_0x2115fd){console[_0x14ec0f(0x2c1)](_0x14ec0f(0x1b9)+_0x481f24+':',_0x2115fd);}let _0x322726;_0x202118[_0x14ec0f(0x1a9)]!==null&&_0x202118['amountAfterGatewayCommissionUSDT']!==undefined?(_0x322726=_0x202118[_0x14ec0f(0x1a9)],console[_0x14ec0f(0x2d3)](_0x14ec0f(0x2d9)+_0x322726[_0x14ec0f(0x2ae)](0x6)+_0x14ec0f(0x2ee)+_0x481f24)):(_0x322726=_0x10b58c*(0x1-_0xc28fc1/0x64),console['log'](_0x14ec0f(0x198)+_0x481f24+':\x20'+_0xc28fc1+'%\x20from\x20'+_0x10b58c[_0x14ec0f(0x2ae)](0x6)+'\x20USDT'),_0xa39af[_0x14ec0f(0x1a9)]=_0x322726,_0xa39af[_0x14ec0f(0x1c1)]=_0xc28fc1),_0x11b59e=_0x322726,_0x38103e+=_0x322726,console[_0x14ec0f(0x2d3)](_0x14ec0f(0x19e)+_0x481f24+_0x14ec0f(0x2cb)),console['log'](_0x14ec0f(0x219)+_0x10b58c[_0x14ec0f(0x2ae)](0x6)+_0x14ec0f(0x257)),console['log'](_0x14ec0f(0x256)+_0x202118[_0x14ec0f(0x2e7)]+_0x14ec0f(0x292)+_0xc28fc1+'%'),console['log'](_0x14ec0f(0x26c)+_0x322726[_0x14ec0f(0x2ae)](0x6)+_0x14ec0f(0x282)+_0xc28fc1+_0x14ec0f(0x1da)),console[_0x14ec0f(0x2d3)]('\x20\x20\x20Added\x20to\x20balance:\x20+'+_0x322726[_0x14ec0f(0x2ae)](0x6)+_0x14ec0f(0x257));}else{if(_0x137d92===_0x14ec0f(0x247)&&_0x2aa666!==_0x14ec0f(0x247)&&_0x2aa666!==_0x14ec0f(0x2eb)){if(_0x202118[_0x14ec0f(0x232)]){let _0x52caef=0x2d;const _0x1db146=await _0x480ab9[_0x14ec0f(0x28d)][_0x14ec0f(0x239)]({'where':{'id':_0x202118[_0x14ec0f(0x24b)]},'select':{'gatewaySettings':!![]}});if(_0x1db146?.['gatewaySettings'])try{const _0x2e0eec=JSON['parse'](_0x1db146[_0x14ec0f(0x27c)]);for(const [_0x4b6d87,_0x39d185]of Object['entries'](_0x2e0eec)){if(_0x4b6d87['toLowerCase']()===_0x202118['gateway'][_0x14ec0f(0x212)]()){_0x52caef=_0x39d185[_0x14ec0f(0x24c)]||0xa;break;}}}catch(_0x6de813){console[_0x14ec0f(0x2c1)](_0x14ec0f(0x1b9)+_0x481f24+':',_0x6de813);}const _0x28ce7a=_0x202118['amountUSDT']*(0x1-_0x52caef/0x64);_0x11b59e=-_0x28ce7a,_0x38103e-=_0x28ce7a,console[_0x14ec0f(0x2d3)](_0x14ec0f(0x219)+_0x202118[_0x14ec0f(0x232)][_0x14ec0f(0x2ae)](0x6)+'\x20USDT'),console[_0x14ec0f(0x2d3)](_0x14ec0f(0x256)+_0x202118[_0x14ec0f(0x2e7)]+_0x14ec0f(0x292)+_0x52caef+'%'),console['log'](_0x14ec0f(0x226)+_0x28ce7a[_0x14ec0f(0x2ae)](0x6)+'\x20USDT\x20(after\x20'+_0x52caef+_0x14ec0f(0x1da)),console[_0x14ec0f(0x2d3)](_0x14ec0f(0x1f6)+_0x28ce7a[_0x14ec0f(0x2ae)](0x6)+_0x14ec0f(0x257));}}}_0x2aa666===_0x14ec0f(0x2eb)&&(console[_0x14ec0f(0x2d3)](_0x14ec0f(0x225)),_0x3590d7&&_0x3590d7>0x0?(_0x11b59e=-_0x3590d7,_0x38103e-=_0x3590d7,console[_0x14ec0f(0x2d3)]('üí∏\x20CHARGEBACK\x20penalty\x20ONLY:\x20-'+_0x3590d7[_0x14ec0f(0x2ae)](0x6)+_0x14ec0f(0x22c)),console[_0x14ec0f(0x2d3)](_0x14ec0f(0x2d1))):console[_0x14ec0f(0x2d3)]('‚ö†Ô∏è\x20CHARGEBACK\x20without\x20penalty\x20amount\x20-\x20no\x20balance\x20change'),_0xa39af[_0x14ec0f(0x24a)]=_0x3590d7||0x0);_0x2aa666===_0x14ec0f(0x236)&&_0x137d92===_0x14ec0f(0x247)&&console[_0x14ec0f(0x2d3)](_0x14ec0f(0x2c0));const _0xdc54f8=await _0x480ab9[_0x14ec0f(0x288)][_0x14ec0f(0x241)]({'where':{'id':_0x481f24},'data':_0xa39af,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x11b59e!==0x0&&(await _0x480ab9[_0x14ec0f(0x28d)][_0x14ec0f(0x241)]({'where':{'id':_0x202118[_0x14ec0f(0x24b)]},'data':{'balance':_0x38103e}}),console[_0x14ec0f(0x2d3)](_0x14ec0f(0x2a5)+_0x202118[_0x14ec0f(0x24b)]+_0x14ec0f(0x1e8)+_0x202118[_0x14ec0f(0x28d)][_0x14ec0f(0x234)]['toFixed'](0x6)+_0x14ec0f(0x25b)+_0x38103e['toFixed'](0x6)+_0x14ec0f(0x2e6)+(_0x11b59e>0x0?'+':'')+_0x11b59e[_0x14ec0f(0x2ae)](0x6)+')')),_0xdc54f8;});return{'id':_0x567ee3['id'],'shopId':_0x567ee3[_0x4489a9(0x24b)],'gateway':_0x567ee3[_0x4489a9(0x2e7)],'amount':_0x567ee3[_0x4489a9(0x1d2)],'currency':_0x567ee3[_0x4489a9(0x275)],'status':_0x567ee3['status'],'orderId':_0x567ee3[_0x4489a9(0x2ba)],'gatewayOrderId':_0x567ee3[_0x4489a9(0x267)],'customerEmail':_0x567ee3['customerEmail'],'customerName':_0x567ee3[_0x4489a9(0x29a)],'customerCountry':_0x567ee3[_0x4489a9(0x1bf)],'customerIp':_0x567ee3[_0x4489a9(0x1b1)],'customerUa':_0x567ee3['customerUa'],'failureMessage':_0x567ee3[_0x4489a9(0x2cc)],'adminNotes':_0x567ee3[_0x4489a9(0x23d)],'chargebackAmount':_0x567ee3[_0x4489a9(0x24a)],'statusChangedBy':_0x567ee3[_0x4489a9(0x2a4)],'statusChangedAt':_0x567ee3[_0x4489a9(0x23a)],'createdAt':_0x567ee3['createdAt'],'updatedAt':_0x567ee3[_0x4489a9(0x1f7)],'shop':_0x567ee3[_0x4489a9(0x28d)]};}async[a40_0x64d77e(0x1b6)](_0x3a1806,_0x38f5c7){const _0x4f04d3=a40_0x64d77e,_0x3babe7=Math['random']()[_0x4f04d3(0x1c9)](0x24)[_0x4f04d3(0x2de)](0x2,0x9);console[_0x4f04d3(0x2d3)](_0x4f04d3(0x26d)+_0x3babe7+_0x4f04d3(0x1d1)+_0x3a1806);const _0x65c0a={..._0x38f5c7};_0x38f5c7[_0x4f04d3(0x2a1)]&&_0x38f5c7[_0x4f04d3(0x2a1)][_0x4f04d3(0x21e)]()!==''?(console[_0x4f04d3(0x2d3)](_0x4f04d3(0x22b)+_0x3babe7+_0x4f04d3(0x23b)+_0x3a1806),_0x65c0a[_0x4f04d3(0x2a1)]=await bcryptjs_1[_0x4f04d3(0x237)][_0x4f04d3(0x268)](_0x38f5c7[_0x4f04d3(0x2a1)],0xc)):(console['log'](_0x4f04d3(0x22b)+_0x3babe7+_0x4f04d3(0x29b)),delete _0x65c0a[_0x4f04d3(0x2a1)]);_0x38f5c7[_0x4f04d3(0x2ea)]&&(_0x65c0a[_0x4f04d3(0x297)]=_0x38f5c7[_0x4f04d3(0x2ea)],delete _0x65c0a[_0x4f04d3(0x2ea)]);_0x38f5c7[_0x4f04d3(0x2c4)]&&(_0x65c0a[_0x4f04d3(0x2f3)]=_0x38f5c7[_0x4f04d3(0x2c4)],delete _0x65c0a[_0x4f04d3(0x2c4)]);_0x38f5c7[_0x4f04d3(0x20b)]&&(_0x65c0a[_0x4f04d3(0x2af)]=_0x38f5c7[_0x4f04d3(0x20b)],delete _0x65c0a[_0x4f04d3(0x20b)]);if(_0x38f5c7[_0x4f04d3(0x1e1)]){const _0x2639b8=_0x38f5c7[_0x4f04d3(0x1e1)]['map'](_0x272d0b=>this[_0x4f04d3(0x286)](_0x272d0b));console[_0x4f04d3(0x2d3)]('üîÑ\x20Gateway\x20mapping:',_0x38f5c7[_0x4f04d3(0x1e1)],'->',_0x2639b8),_0x65c0a['paymentGateways']=JSON[_0x4f04d3(0x269)](_0x2639b8),delete _0x65c0a[_0x4f04d3(0x1e1)];}_0x38f5c7['gatewaySettings']&&(console[_0x4f04d3(0x2d3)](_0x4f04d3(0x245)+_0x3babe7+_0x4f04d3(0x1ef),_0x38f5c7[_0x4f04d3(0x27c)]),_0x65c0a[_0x4f04d3(0x27c)]=JSON[_0x4f04d3(0x269)](_0x38f5c7[_0x4f04d3(0x27c)]),console[_0x4f04d3(0x2d3)](_0x4f04d3(0x245)+_0x3babe7+_0x4f04d3(0x2ca),_0x65c0a[_0x4f04d3(0x27c)]));_0x38f5c7['wallets']&&(_0x38f5c7['wallets'][_0x4f04d3(0x28a)]!==undefined&&(_0x65c0a[_0x4f04d3(0x28a)]=_0x38f5c7['wallets']['usdtPolygonWallet']||null),_0x38f5c7[_0x4f04d3(0x2f4)]['usdtTrcWallet']!==undefined&&(_0x65c0a[_0x4f04d3(0x252)]=_0x38f5c7['wallets']['usdtTrcWallet']||null),_0x38f5c7[_0x4f04d3(0x2f4)][_0x4f04d3(0x1e6)]!==undefined&&(_0x65c0a['usdtErcWallet']=_0x38f5c7[_0x4f04d3(0x2f4)][_0x4f04d3(0x1e6)]||null),_0x38f5c7[_0x4f04d3(0x2f4)]['usdcPolygonWallet']!==undefined&&(_0x65c0a[_0x4f04d3(0x231)]=_0x38f5c7[_0x4f04d3(0x2f4)][_0x4f04d3(0x231)]||null),delete _0x65c0a[_0x4f04d3(0x2f4)]);const _0x318c9e=await database_1[_0x4f04d3(0x237)]['shop']['update']({'where':{'id':_0x3a1806},'data':_0x65c0a,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0x4f04d3(0x2d3)]('üéØ\x20['+_0x3babe7+_0x4f04d3(0x202),_0x318c9e['gatewaySettings']),{'id':_0x318c9e['id'],'fullName':_0x318c9e[_0x4f04d3(0x297)],'username':_0x318c9e[_0x4f04d3(0x23e)],'telegramId':_0x318c9e[_0x4f04d3(0x2f3)],'merchantUrl':_0x318c9e[_0x4f04d3(0x2af)],'gateways':_0x318c9e[_0x4f04d3(0x258)]?JSON[_0x4f04d3(0x2bb)](_0x318c9e['paymentGateways']):null,'gatewaySettings':_0x318c9e[_0x4f04d3(0x27c)]?JSON[_0x4f04d3(0x2bb)](_0x318c9e[_0x4f04d3(0x27c)]):null,'publicKey':_0x318c9e[_0x4f04d3(0x1a8)],'wallets':{'usdtPolygonWallet':_0x318c9e[_0x4f04d3(0x28a)],'usdtTrcWallet':_0x318c9e[_0x4f04d3(0x252)],'usdtErcWallet':_0x318c9e[_0x4f04d3(0x1e6)],'usdcPolygonWallet':_0x318c9e[_0x4f04d3(0x231)]},'status':_0x318c9e[_0x4f04d3(0x1a5)],'createdAt':_0x318c9e[_0x4f04d3(0x211)]};}async[a40_0x64d77e(0x1b7)](_0x29e8c3){const _0x10bb83=a40_0x64d77e,_0x131674=await database_1[_0x10bb83(0x237)][_0x10bb83(0x28d)][_0x10bb83(0x241)]({'where':{'id':_0x29e8c3},'data':{'status':'SUSPENDED'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x131674['id'],'fullName':_0x131674['name'],'username':_0x131674[_0x10bb83(0x23e)],'telegramId':_0x131674[_0x10bb83(0x2f3)],'merchantUrl':_0x131674[_0x10bb83(0x2af)],'gateways':_0x131674[_0x10bb83(0x258)]?JSON['parse'](_0x131674['paymentGateways']):null,'gatewaySettings':_0x131674[_0x10bb83(0x27c)]?JSON['parse'](_0x131674['gatewaySettings']):null,'publicKey':_0x131674[_0x10bb83(0x1a8)],'wallets':{'usdtPolygonWallet':_0x131674[_0x10bb83(0x28a)],'usdtTrcWallet':_0x131674[_0x10bb83(0x252)],'usdtErcWallet':_0x131674[_0x10bb83(0x1e6)],'usdcPolygonWallet':_0x131674[_0x10bb83(0x231)]},'status':_0x131674[_0x10bb83(0x1a5)],'createdAt':_0x131674[_0x10bb83(0x211)]};}async['activateUser'](_0x5a7880){const _0x32d1fa=a40_0x64d77e,_0x2ee026=await database_1[_0x32d1fa(0x237)][_0x32d1fa(0x28d)][_0x32d1fa(0x241)]({'where':{'id':_0x5a7880},'data':{'status':_0x32d1fa(0x1a2)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2ee026['id'],'fullName':_0x2ee026[_0x32d1fa(0x297)],'username':_0x2ee026['username'],'telegramId':_0x2ee026[_0x32d1fa(0x2f3)],'merchantUrl':_0x2ee026[_0x32d1fa(0x2af)],'gateways':_0x2ee026[_0x32d1fa(0x258)]?JSON[_0x32d1fa(0x2bb)](_0x2ee026[_0x32d1fa(0x258)]):null,'gatewaySettings':_0x2ee026[_0x32d1fa(0x27c)]?JSON[_0x32d1fa(0x2bb)](_0x2ee026[_0x32d1fa(0x27c)]):null,'publicKey':_0x2ee026[_0x32d1fa(0x1a8)],'wallets':{'usdtPolygonWallet':_0x2ee026[_0x32d1fa(0x28a)],'usdtTrcWallet':_0x2ee026[_0x32d1fa(0x252)],'usdtErcWallet':_0x2ee026[_0x32d1fa(0x1e6)],'usdcPolygonWallet':_0x2ee026[_0x32d1fa(0x231)]},'status':_0x2ee026[_0x32d1fa(0x1a5)],'createdAt':_0x2ee026[_0x32d1fa(0x211)]};}async['getAllUsers'](_0x11b05a){const _0x9405fb=a40_0x64d77e,{page:_0x5e2f1d,limit:_0xdd042e,status:_0x256138}=_0x11b05a,_0x49e82d=(_0x5e2f1d-0x1)*_0xdd042e,_0x454c0c={};_0x256138&&(_0x454c0c[_0x9405fb(0x1a5)]=_0x256138[_0x9405fb(0x1d0)]());const [_0x19840a,_0x3cc85b]=await Promise[_0x9405fb(0x2e3)]([database_1[_0x9405fb(0x237)][_0x9405fb(0x28d)][_0x9405fb(0x1a7)]({'where':_0x454c0c,'skip':_0x49e82d,'take':_0xdd042e,'orderBy':{'createdAt':_0x9405fb(0x294)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1['default'][_0x9405fb(0x28d)][_0x9405fb(0x1ea)]({'where':_0x454c0c})]);return{'users':_0x19840a[_0x9405fb(0x29f)](_0x1c8c12=>{const _0x5c3661=_0x9405fb,_0x129595=_0x1c8c12[_0x5c3661(0x258)]?JSON[_0x5c3661(0x2bb)](_0x1c8c12['paymentGateways']):null,_0x223245=_0x129595?_0x129595['map'](_0x46b409=>this[_0x5c3661(0x29e)](_0x46b409)):null;return{'id':_0x1c8c12['id'],'fullName':_0x1c8c12['name'],'username':_0x1c8c12[_0x5c3661(0x23e)],'telegramId':_0x1c8c12[_0x5c3661(0x2f3)],'merchantUrl':_0x1c8c12[_0x5c3661(0x2af)],'gateways':_0x223245,'gatewaySettings':_0x1c8c12['gatewaySettings']?JSON[_0x5c3661(0x2bb)](_0x1c8c12[_0x5c3661(0x27c)]):null,'publicKey':_0x1c8c12[_0x5c3661(0x1a8)],'wallets':{'usdtPolygonWallet':_0x1c8c12[_0x5c3661(0x28a)],'usdtTrcWallet':_0x1c8c12['usdtTrcWallet'],'usdtErcWallet':_0x1c8c12[_0x5c3661(0x1e6)],'usdcPolygonWallet':_0x1c8c12[_0x5c3661(0x231)]},'status':_0x1c8c12[_0x5c3661(0x1a5)],'createdAt':_0x1c8c12[_0x5c3661(0x211)]};}),'pagination':{'page':_0x5e2f1d,'limit':_0xdd042e,'total':_0x3cc85b,'totalPages':Math[_0x9405fb(0x1f0)](_0x3cc85b/_0xdd042e)}};}async[a40_0x64d77e(0x1c2)](_0x27669d){const _0x384517=a40_0x64d77e,_0x49356a=await database_1[_0x384517(0x237)][_0x384517(0x28d)]['findUnique']({'where':{'id':_0x27669d},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x49356a)return null;const _0x184437=_0x49356a[_0x384517(0x258)]?JSON[_0x384517(0x2bb)](_0x49356a[_0x384517(0x258)]):null,_0x15b292=_0x184437?_0x184437[_0x384517(0x29f)](_0x4ba7ac=>this[_0x384517(0x29e)](_0x4ba7ac)):null;return _0x184437&&_0x15b292&&console[_0x384517(0x2d3)]('üîÑ\x20Gateway\x20mapping\x20(get):',_0x184437,'->',_0x15b292),{'id':_0x49356a['id'],'fullName':_0x49356a[_0x384517(0x297)],'username':_0x49356a[_0x384517(0x23e)],'telegramId':_0x49356a['telegram'],'merchantUrl':_0x49356a['shopUrl'],'gateways':_0x15b292,'gatewaySettings':_0x49356a[_0x384517(0x27c)]?JSON[_0x384517(0x2bb)](_0x49356a['gatewaySettings']):null,'publicKey':_0x49356a['publicKey'],'wallets':{'usdtPolygonWallet':_0x49356a[_0x384517(0x28a)],'usdtTrcWallet':_0x49356a[_0x384517(0x252)],'usdtErcWallet':_0x49356a['usdtErcWallet'],'usdcPolygonWallet':_0x49356a[_0x384517(0x231)]},'status':_0x49356a[_0x384517(0x1a5)],'createdAt':_0x49356a[_0x384517(0x211)]};}async['createUser'](_0x1272c6){const _0xe7f689=a40_0x64d77e,{fullName:_0x367279,username:_0x2292e5,password:_0x1691fc,telegramId:_0x1941f7,merchantUrl:_0x1ceebd,gateways:_0x2c585b,gatewaySettings:_0x12ae93,wallets:_0x2de491}=_0x1272c6,_0x573c04=await database_1[_0xe7f689(0x237)][_0xe7f689(0x28d)]['findUnique']({'where':{'username':_0x2292e5}});if(_0x573c04)throw new Error(_0xe7f689(0x285));if(_0x1941f7){const _0x3aa0d7=await database_1[_0xe7f689(0x237)][_0xe7f689(0x28d)][_0xe7f689(0x239)]({'where':{'telegram':_0x1941f7}});if(_0x3aa0d7)throw new Error(_0xe7f689(0x27d));}const _0x530429=await bcryptjs_1[_0xe7f689(0x237)][_0xe7f689(0x268)](_0x1691fc,0xc),_0x1b769d='pk_'+crypto_1[_0xe7f689(0x237)][_0xe7f689(0x21d)](0x20)[_0xe7f689(0x1c9)](_0xe7f689(0x280)),_0x2bb23e=_0xe7f689(0x1ec)+crypto_1['default']['randomBytes'](0x20)[_0xe7f689(0x1c9)](_0xe7f689(0x280)),_0x277a8e=_0x2c585b?_0x2c585b[_0xe7f689(0x29f)](_0x466c4b=>this[_0xe7f689(0x286)](_0x466c4b)):null;_0x2c585b&&_0x277a8e&&console[_0xe7f689(0x2d3)](_0xe7f689(0x1ce),_0x2c585b,'->',_0x277a8e);const _0x3a9035=await database_1['default'][_0xe7f689(0x28d)][_0xe7f689(0x25a)]({'data':{'name':_0x367279,'username':_0x2292e5,'password':_0x530429,'telegram':_0x1941f7,'shopUrl':_0x1ceebd,'paymentGateways':_0x277a8e?JSON[_0xe7f689(0x269)](_0x277a8e):null,'gatewaySettings':_0x12ae93?JSON[_0xe7f689(0x269)](_0x12ae93):null,'usdtPolygonWallet':_0x2de491?.[_0xe7f689(0x28a)]||null,'usdtTrcWallet':_0x2de491?.['usdtTrcWallet']||null,'usdtErcWallet':_0x2de491?.['usdtErcWallet']||null,'usdcPolygonWallet':_0x2de491?.['usdcPolygonWallet']||null,'publicKey':_0x1b769d,'secretKey':_0x2bb23e,'status':_0xe7f689(0x1a2)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x3a9035['id'],'fullName':_0x3a9035[_0xe7f689(0x297)],'username':_0x3a9035[_0xe7f689(0x23e)],'telegramId':_0x3a9035['telegram'],'merchantUrl':_0x3a9035[_0xe7f689(0x2af)],'gateways':_0x3a9035[_0xe7f689(0x258)]?JSON[_0xe7f689(0x2bb)](_0x3a9035[_0xe7f689(0x258)]):null,'gatewaySettings':_0x3a9035[_0xe7f689(0x27c)]?JSON[_0xe7f689(0x2bb)](_0x3a9035[_0xe7f689(0x27c)]):null,'publicKey':_0x3a9035[_0xe7f689(0x1a8)],'wallets':{'usdtPolygonWallet':_0x3a9035[_0xe7f689(0x28a)],'usdtTrcWallet':_0x3a9035[_0xe7f689(0x252)],'usdtErcWallet':_0x3a9035['usdtErcWallet'],'usdcPolygonWallet':_0x3a9035[_0xe7f689(0x231)]},'status':_0x3a9035[_0xe7f689(0x1a5)],'createdAt':_0x3a9035['createdAt']};}async[a40_0x64d77e(0x2aa)](_0x57d914){const _0x3db8f3=a40_0x64d77e;await database_1[_0x3db8f3(0x237)]['shop'][_0x3db8f3(0x24e)]({'where':{'id':_0x57d914}});}['generateDailyStatistics'](_0x4c1524,_0x499e1b,_0x20a5ee){const _0x366c78=a40_0x64d77e,_0x28fad7=new Map(),_0x4bdd52=new Date(_0x499e1b);while(_0x4bdd52<=_0x20a5ee){const _0x27059e=_0x4bdd52[_0x366c78(0x1db)]()[_0x366c78(0x215)]('T')[0x0];_0x28fad7[_0x366c78(0x210)](_0x27059e,{'revenue':0x0,'count':0x0}),_0x4bdd52[_0x366c78(0x228)](_0x4bdd52[_0x366c78(0x2c7)]()+0x1);}for(const _0x3d9d8d of _0x4c1524){const _0x27b69e=_0x3d9d8d['createdAt'][_0x366c78(0x1db)]()[_0x366c78(0x215)]('T')[0x0],_0x424b0a=_0x28fad7[_0x366c78(0x2bc)](_0x27b69e);_0x424b0a&&(_0x424b0a['count']+=0x1,_0x3d9d8d[_0x366c78(0x1a5)]==='PAID'&&(_0x3d9d8d[_0x366c78(0x232)]?_0x424b0a['revenue']+=_0x3d9d8d[_0x366c78(0x232)]:console[_0x366c78(0x2d3)](_0x366c78(0x227)+_0x3d9d8d['id']+'\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion')));}const _0x4b94ae=[],_0x4f8f01=[];for(const [_0x188112,_0xae338]of _0x28fad7){_0x4b94ae[_0x366c78(0x1f4)]({'date':_0x188112,'amount':Math[_0x366c78(0x28f)](_0xae338['revenue']*0x64)/0x64}),_0x4f8f01[_0x366c78(0x1f4)]({'date':_0x188112,'count':_0xae338[_0x366c78(0x1ea)]});}return{'dailyRevenue':_0x4b94ae,'dailyPayments':_0x4f8f01};}}function a40_0x14fa(_0x539f2d,_0x42940b){const _0x52a4c1=a40_0x52a4();return a40_0x14fa=function(_0x14fa18,_0x4edd18){_0x14fa18=_0x14fa18-0x196;let _0x3d2f38=_0x52a4c1[_0x14fa18];return _0x3d2f38;},a40_0x14fa(_0x539f2d,_0x42940b);}exports[a40_0x64d77e(0x214)]=AdminService;