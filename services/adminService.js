'use strict';function a33_0x5051(_0x6520e9,_0x341751){const _0x3295a5=a33_0x3295();return a33_0x5051=function(_0x5051e3,_0x28656e){_0x5051e3=_0x5051e3-0x1a6;let _0x9a0f30=_0x3295a5[_0x5051e3];return _0x9a0f30;},a33_0x5051(_0x6520e9,_0x341751);}const a33_0x3ef1a0=a33_0x5051;(function(_0x40aa1b,_0x4f581){const _0x52e4f2=a33_0x5051,_0x9e06ab=_0x40aa1b();while(!![]){try{const _0x3b1283=parseInt(_0x52e4f2(0x22c))/0x1+parseInt(_0x52e4f2(0x23c))/0x2+parseInt(_0x52e4f2(0x22a))/0x3+parseInt(_0x52e4f2(0x257))/0x4+parseInt(_0x52e4f2(0x21f))/0x5*(-parseInt(_0x52e4f2(0x248))/0x6)+-parseInt(_0x52e4f2(0x233))/0x7+-parseInt(_0x52e4f2(0x244))/0x8*(parseInt(_0x52e4f2(0x20d))/0x9);if(_0x3b1283===_0x4f581)break;else _0x9e06ab['push'](_0x9e06ab['shift']());}catch(_0x4cf590){_0x9e06ab['push'](_0x9e06ab['shift']());}}}(a33_0x3295,0x3f005));function a33_0x3295(){const _0x953a0d=['cardLast4','commission','split','ceil','payment','defineProperty','ACTIVE','AdminService','952834rQShvX','payoutDelay','\x20to\x20','üí∏\x20Chargeback\x20amount:\x20','üìã\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','chargebackAmount','\x20eligible\x20PAID\x20payments\x20for\x20payout\x20analysis','getSystemStatistics','108136BtdGoi','abs','shopId','‚ùå\x20Payout\x20not\x20found:\x20','1698DzOCFO','‚úÖ\x20Payout\x20','findMany','‚úÖ\x20Returning\x20','includes','map','date','suspendUser','shop','üí∞\x20Found\x20','90d','toISOString','orderId','\x20USDT','üè™\x20Found\x20','137800RsndYJ','‚úÖ\x20Admin\x20statistics\x20generated\x20successfully','Payout\x20not\x20found','paymentMethod','üìã\x20Getting\x20payouts\x20with\x20filters:','remitterName','\x20merchants\x20out\x20of\x20','getAllUsers','network','\x20USDT\x20after\x20commission)','expiresAt','push','all','\x20days)','‚úÖ\x20User\x20','isValidGatewayId','userService','usdcPolygonWallet','üóëÔ∏è\x20Deleting\x20payout:\x20','üí∞\x20Total\x20amount:\x20','PAID','\x20users\x20out\x20of\x20','getMerchantsAwaitingPayout','statusChangedAt','\x20payments\x20for\x20analysis\x20(PAID/REFUND/CHARGEBACK)','desc','round','SUSPENDED','üìã\x20Getting\x20payments\x20with\x20filters:','remitterIban','reduce','getDate','‚úÖ\x20Found\x20payout:\x20','telegram','lte','sendPayoutNotification','__importDefault','paidAt','update','Payment\x20not\x20found','createUser','txid','create','../types/gateway','gatewayOrderId','getFullYear','getPayoutStats','Error\x20parsing\x20gateway\x20settings:','üí≥\x20Total\x20payments:\x20','\x20USDT\x20(','‚úÖ\x20Payout\x20statistics\x20calculated:','gatewayPaymentId','üë•\x20Total\x20users:\x20','telegramBotService','default','\x20payouts\x20out\x20of\x20','üîç\x20Getting\x20payout\x20by\x20ID:\x20','usdtTrcWallet','User\x20not\x20found','usage','updateUser','status_update','calculateAmountAfterCommission','length','get','asc','bankId','getPeriodDays','status','\x20total','./telegramBotService','getAllPayouts','\x20payments\x20as\x20paid\x20out','PROCESSING','‚è≥\x20Awaiting\x20Payout:\x20','gateway','customerEmail','generateDateRange','sourceCurrency','completed','paymentGateways','toLowerCase','toFixed','updatedAt','../config/database','currencyService','üìä\x20Found\x20',',\x20amount:\x20','\x20status\x20updated\x20from\x20','\x20merchants\x20with\x20eligible\x20PAID\x20payments','amountAfterCommissionUSDT','Chargeback\x20amount\x20is\x20required\x20and\x20must\x20be\x20positive\x20(amount\x20in\x20USDT)','\x20activated\x20successfully','\x20status\x20to:\x20','markPaymentsAsPaidOut','Shop\x20not\x20found','availableBalance','setDate','deleteUser','currency','name','username','REFUND','getGatewayNameById','webhookLog','deletePayout','getMonth','createdAt','externalPaymentUrl','\x20USDT\x20via\x20','üí∏\x20Creating\x20payout\x20for\x20shop\x20','üíµ\x20Total\x20revenue:\x20','totalAmountAfterCommissionUSDT','amount','adminNotes','30d','updateMany','insensitive','updatePaymentStatus','thisMonth','awaitingPayout','COMPLETED','log','payments','slice','getUserById','EXPIRED','\x20USDT\x20(—Ç–æ–ª—å–∫–æ\x20PAID\x20–ø–ª–∞—Ç–µ–∂–∏)','üö´\x20Suspending\x20user:\x20','usdtPolygonWallet','isEligibleForPayout','parse','payout','üí∏\x20Total\x20Payout:\x20','usdtErcWallet','charAt','‚úÖ\x20Activating\x20user:\x20','Shop\x20is\x20not\x20active','error','FAILED','\x20payments\x20for\x20revenue\x20calculation\x20(PAID/REFUND/CHARGEBACK)','üîÑ\x20Updating\x20payment\x20','\x20payments\x20out\x20of\x20','count','statusChangedBy','\x20USDT\x20(–≤–∫–ª—é—á–∞—è\x20—à—Ç—Ä–∞—Ñ—ã\x20chargeback)','261aWFZQv','\x20USDT\x20(will\x20be\x20deducted\x20from\x20merchant\x20balance)','toUpperCase','üí∞\x20Available\x20Balance:\x20','‚úÖ\x20Payment\x20','amountUSDT','createPayout','User\x20is\x20already\x20suspended','\x20days','UserService','üìÖ\x20Processing\x20daily\x20stats\x20for\x20','üìä\x20Calculating\x20admin\x20payout\x20statistics...','./userService','customerName','$queryRaw','üìä\x20Daily\x20revenue\x20entries:\x20','delete','CHARGEBACK','2355jMdnvP','sort','‚úÖ\x20Marked\x20','convertToUSDT','notes','\x20deleted\x20successfully','\x20suspended\x20successfully','findUnique','gte','getAllPayments','üîÑ\x20Marking\x20payments\x20as\x20paid\x20out\x20for\x20shop\x20','1310034oYJwMu','has','97930WYZTmb','getGatewaySettings','üîç\x20Getting\x20payment\x20by\x20ID:\x20','gatewaySettings','./currencyService','getPayoutById','calculateEffectiveAmount','1834952dIQMoP'];a33_0x3295=function(){return _0x953a0d;};return a33_0x3295();}var __importDefault=this&&this[a33_0x3ef1a0(0x27b)]||function(_0x58e192){return _0x58e192&&_0x58e192['__esModule']?_0x58e192:{'default':_0x58e192};};Object[a33_0x3ef1a0(0x239)](exports,'__esModule',{'value':!![]}),exports[a33_0x3ef1a0(0x23b)]=void 0x0;const database_1=__importDefault(require(a33_0x3ef1a0(0x1cf))),currencyService_1=require(a33_0x3ef1a0(0x230)),userService_1=require(a33_0x3ef1a0(0x219)),telegramBotService_1=require(a33_0x3ef1a0(0x1c1)),gateway_1=require(a33_0x3ef1a0(0x1a6));class AdminService{constructor(){const _0x449ddb=a33_0x3ef1a0;this[_0x449ddb(0x267)]=new userService_1[(_0x449ddb(0x216))]();}[a33_0x3ef1a0(0x1be)](_0x5cf9dc){const _0x1d27a8=a33_0x3ef1a0;switch(_0x5cf9dc){case'7d':return 0x7;case _0x1d27a8(0x1ee):return 0x1e;case _0x1d27a8(0x252):return 0x5a;case'1y':return 0x16d;default:return 0x1e;}}[a33_0x3ef1a0(0x1c8)](_0x7c26e3,_0x40f6b0){const _0x477364=a33_0x3ef1a0,_0x2b9428=[],_0x597323=new Date(_0x7c26e3);while(_0x597323<=_0x40f6b0){_0x2b9428[_0x477364(0x262)](_0x597323[_0x477364(0x253)]()[_0x477364(0x236)]('T')[0x0]),_0x597323[_0x477364(0x1dc)](_0x597323[_0x477364(0x276)]()+0x1);}return _0x2b9428;}[a33_0x3ef1a0(0x22d)](_0x13c9ee,_0x27c8a7){const _0x54116c=a33_0x3ef1a0;if(!_0x13c9ee[_0x54116c(0x22f)])return{'commission':0x0,'payoutDelay':0x0};try{const _0x3eb668=JSON[_0x54116c(0x1fe)](_0x13c9ee['gatewaySettings']),_0x113e38=_0x27c8a7['charAt'](0x0)[_0x54116c(0x20f)]()+_0x27c8a7[_0x54116c(0x1f7)](0x1)[_0x54116c(0x1cc)]();if(_0x3eb668&&_0x3eb668[_0x113e38])return{'commission':_0x3eb668[_0x113e38][_0x54116c(0x235)]||0x0,'payoutDelay':_0x3eb668[_0x113e38][_0x54116c(0x23d)]||0x0};}catch(_0x23d6bc){console[_0x54116c(0x205)](_0x54116c(0x1aa),_0x23d6bc);}return{'commission':0x0,'payoutDelay':0x0};}[a33_0x3ef1a0(0x1fd)](_0x359565){const _0x1bf58a=a33_0x3ef1a0;if(_0x359565[_0x1bf58a(0x1bf)]!==_0x1bf58a(0x26b)||_0x359565['merchantPaid']||!_0x359565[_0x1bf58a(0x27c)])return![];const _0x51637a=this[_0x1bf58a(0x22d)](_0x359565['shop'],_0x359565['gateway']),_0x347709=_0x51637a[_0x1bf58a(0x23d)]*0x18*0x3c*0x3c*0x3e8,_0x265aba=new Date(_0x359565[_0x1bf58a(0x27c)]['getTime']()+_0x347709);return new Date()>_0x265aba;}[a33_0x3ef1a0(0x1b9)](_0x42ef33,_0x104bf0){return _0x42ef33*(0x1-_0x104bf0/0x64);}[a33_0x3ef1a0(0x232)](_0x106096){const _0x3f0b79=a33_0x3ef1a0;switch(_0x106096['status']){case _0x3f0b79(0x26b):return _0x106096[_0x3f0b79(0x1ec)];case'CHARGEBACK':return-(_0x106096['chargebackAmount']||0x0);case _0x3f0b79(0x1e1):return 0x0;default:return 0x0;}}async[a33_0x3ef1a0(0x213)](_0x17ad33){const _0x80b7fa=a33_0x3ef1a0,{shopId:_0x4b2faa,amount:_0x27f1ae,network:_0x6b5e8,notes:_0x20a2bf}=_0x17ad33;console[_0x80b7fa(0x1f5)](_0x80b7fa(0x1e9)+_0x4b2faa+':\x20'+_0x27f1ae+_0x80b7fa(0x1e8)+_0x6b5e8);const _0x53d8cd=await database_1['default'][_0x80b7fa(0x250)][_0x80b7fa(0x226)]({'where':{'id':_0x4b2faa},'select':{'id':!![],'name':!![],'username':!![],'status':!![]}});if(!_0x53d8cd)throw new Error(_0x80b7fa(0x1da));if(_0x53d8cd[_0x80b7fa(0x1bf)]!==_0x80b7fa(0x23a))throw new Error(_0x80b7fa(0x204));const _0x2d070c=await database_1['default']['payout'][_0x80b7fa(0x281)]({'data':{'shopId':_0x4b2faa,'amount':_0x27f1ae,'network':_0x6b5e8,'status':_0x80b7fa(0x1f4),'notes':_0x20a2bf||null,'paidAt':new Date()},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});await this[_0x80b7fa(0x1d9)](_0x4b2faa,_0x27f1ae);try{await telegramBotService_1[_0x80b7fa(0x1b0)][_0x80b7fa(0x27a)](_0x4b2faa,_0x2d070c,_0x80b7fa(0x1ca));}catch(_0x20b85a){console[_0x80b7fa(0x205)]('Failed\x20to\x20send\x20Telegram\x20payout\x20notification:',_0x20b85a);}return console[_0x80b7fa(0x1f5)]('‚úÖ\x20Payout\x20created\x20successfully:\x20'+_0x2d070c['id']),{'id':_0x2d070c['id'],'shopId':_0x2d070c[_0x80b7fa(0x246)],'shopName':_0x2d070c[_0x80b7fa(0x250)][_0x80b7fa(0x1df)],'shopUsername':_0x2d070c['shop'][_0x80b7fa(0x1e0)],'amount':_0x2d070c['amount'],'network':_0x2d070c[_0x80b7fa(0x25f)],'status':_0x2d070c[_0x80b7fa(0x1bf)],'txid':_0x2d070c[_0x80b7fa(0x280)],'notes':_0x2d070c['notes'],'createdAt':_0x2d070c[_0x80b7fa(0x1e6)],'paidAt':_0x2d070c[_0x80b7fa(0x27c)]};}async[a33_0x3ef1a0(0x1d9)](_0x2a10be,_0x3072bd){const _0x167e37=a33_0x3ef1a0;console[_0x167e37(0x1f5)](_0x167e37(0x229)+_0x2a10be+_0x167e37(0x1d2)+_0x3072bd+_0x167e37(0x255));const _0x157737=await database_1[_0x167e37(0x1b1)][_0x167e37(0x238)][_0x167e37(0x24a)]({'where':{'shopId':_0x2a10be,'status':_0x167e37(0x26b),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'shop':{'select':{'gatewaySettings':!![]}}},'orderBy':{'paidAt':_0x167e37(0x1bc)}});let _0x4a1fe3=_0x3072bd;const _0x322054=[];for(const _0x1f2116 of _0x157737){const _0xc1ddd2={..._0x1f2116,'status':_0x167e37(0x26b),'merchantPaid':![],'shop':{'gatewaySettings':_0x1f2116[_0x167e37(0x250)][_0x167e37(0x22f)]}};if(!this[_0x167e37(0x1fd)](_0xc1ddd2))continue;const _0x1aa9bd=await currencyService_1[_0x167e37(0x1d0)][_0x167e37(0x222)](_0x1f2116[_0x167e37(0x1ec)],_0x1f2116[_0x167e37(0x1de)]),_0x121659=this[_0x167e37(0x22d)](_0x1f2116[_0x167e37(0x250)],_0x1f2116['gateway']),_0x574e65=this[_0x167e37(0x1b9)](_0x1aa9bd,_0x121659[_0x167e37(0x235)]);if(_0x574e65<=_0x4a1fe3){_0x322054[_0x167e37(0x262)](_0x1f2116['id']),_0x4a1fe3-=_0x574e65;if(_0x4a1fe3<=0.01)break;}}_0x322054[_0x167e37(0x1ba)]>0x0&&(await database_1[_0x167e37(0x1b1)][_0x167e37(0x238)][_0x167e37(0x1ef)]({'where':{'id':{'in':_0x322054}},'data':{'merchantPaid':!![]}}),console['log'](_0x167e37(0x221)+_0x322054[_0x167e37(0x1ba)]+_0x167e37(0x1c3)));}async[a33_0x3ef1a0(0x1c2)](_0x471259){const _0x5f06fa=a33_0x3ef1a0,{page:_0x37be56,limit:_0x1a3eb5,shopId:_0x163190,network:_0x3fd35c,dateFrom:_0x4dd236,dateTo:_0x350828,search:_0x5cd5a6}=_0x471259,_0x553107=(_0x37be56-0x1)*_0x1a3eb5;console['log'](_0x5f06fa(0x25b),_0x471259);const _0x5c2952={};_0x163190&&(_0x5c2952[_0x5f06fa(0x246)]=_0x163190);_0x3fd35c&&(_0x5c2952[_0x5f06fa(0x25f)]=_0x3fd35c);(_0x4dd236||_0x350828)&&(_0x5c2952[_0x5f06fa(0x1e6)]={},_0x4dd236&&(_0x5c2952[_0x5f06fa(0x1e6)][_0x5f06fa(0x227)]=new Date(_0x4dd236)),_0x350828&&(_0x5c2952[_0x5f06fa(0x1e6)]['lte']=new Date(_0x350828)));_0x5cd5a6&&(_0x5c2952['OR']=[{'txid':{'contains':_0x5cd5a6,'mode':_0x5f06fa(0x1f0)}},{'notes':{'contains':_0x5cd5a6,'mode':_0x5f06fa(0x1f0)}},{'shop':{'name':{'contains':_0x5cd5a6,'mode':_0x5f06fa(0x1f0)}}},{'shop':{'username':{'contains':_0x5cd5a6,'mode':_0x5f06fa(0x1f0)}}}]);const [_0x366872,_0xa02c28]=await Promise[_0x5f06fa(0x263)]([database_1['default'][_0x5f06fa(0x1ff)][_0x5f06fa(0x24a)]({'where':_0x5c2952,'skip':_0x553107,'take':_0x1a3eb5,'orderBy':{'createdAt':_0x5f06fa(0x270)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x5f06fa(0x1b1)][_0x5f06fa(0x1ff)][_0x5f06fa(0x20a)]({'where':_0x5c2952})]);console[_0x5f06fa(0x1f5)]('üìä\x20Found\x20'+_0x366872[_0x5f06fa(0x1ba)]+_0x5f06fa(0x1b2)+_0xa02c28+_0x5f06fa(0x1c0));const _0x31667c=_0x366872[_0x5f06fa(0x24d)](_0x46930d=>({'id':_0x46930d['id'],'shopId':_0x46930d[_0x5f06fa(0x246)],'shopName':_0x46930d[_0x5f06fa(0x250)][_0x5f06fa(0x1df)],'shopUsername':_0x46930d[_0x5f06fa(0x250)][_0x5f06fa(0x1e0)],'amount':_0x46930d[_0x5f06fa(0x1ec)],'network':_0x46930d[_0x5f06fa(0x25f)],'status':_0x46930d['status'],'txid':_0x46930d[_0x5f06fa(0x280)],'notes':_0x46930d[_0x5f06fa(0x223)],'createdAt':_0x46930d['createdAt'],'paidAt':_0x46930d[_0x5f06fa(0x27c)]}));return{'payouts':_0x31667c,'pagination':{'page':_0x37be56,'limit':_0x1a3eb5,'total':_0xa02c28,'totalPages':Math['ceil'](_0xa02c28/_0x1a3eb5)}};}async[a33_0x3ef1a0(0x231)](_0x30629e){const _0x1b6bf7=a33_0x3ef1a0;console['log'](_0x1b6bf7(0x1b3)+_0x30629e);const _0xb18e06=await database_1[_0x1b6bf7(0x1b1)]['payout'][_0x1b6bf7(0x226)]({'where':{'id':_0x30629e},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0xb18e06)return console[_0x1b6bf7(0x1f5)](_0x1b6bf7(0x247)+_0x30629e),null;return console['log'](_0x1b6bf7(0x277)+_0xb18e06[_0x1b6bf7(0x1ec)]+_0x1b6bf7(0x1e8)+_0xb18e06[_0x1b6bf7(0x25f)]),{'id':_0xb18e06['id'],'shopId':_0xb18e06[_0x1b6bf7(0x246)],'shopName':_0xb18e06[_0x1b6bf7(0x250)][_0x1b6bf7(0x1df)],'shopUsername':_0xb18e06['shop']['username'],'amount':_0xb18e06[_0x1b6bf7(0x1ec)],'network':_0xb18e06[_0x1b6bf7(0x25f)],'status':_0xb18e06[_0x1b6bf7(0x1bf)],'txid':_0xb18e06[_0x1b6bf7(0x280)],'notes':_0xb18e06['notes'],'createdAt':_0xb18e06[_0x1b6bf7(0x1e6)],'paidAt':_0xb18e06[_0x1b6bf7(0x27c)]};}async[a33_0x3ef1a0(0x1e4)](_0x53f17b){const _0x214c80=a33_0x3ef1a0;console[_0x214c80(0x1f5)](_0x214c80(0x269)+_0x53f17b);const _0x590079=await database_1['default'][_0x214c80(0x1ff)][_0x214c80(0x226)]({'where':{'id':_0x53f17b},'select':{'id':!![],'shopId':!![],'amount':!![]}});if(!_0x590079)throw new Error(_0x214c80(0x259));await database_1['default'][_0x214c80(0x1ff)][_0x214c80(0x21d)]({'where':{'id':_0x53f17b}}),console[_0x214c80(0x1f5)](_0x214c80(0x249)+_0x53f17b+_0x214c80(0x224));}async[a33_0x3ef1a0(0x26d)](_0x1686ee){const _0x359492=a33_0x3ef1a0,{page:_0x2d66e9,limit:_0x1a26df,minAmount:_0x30f2e4,search:_0x1b1b52}=_0x1686ee;console[_0x359492(0x1f5)](_0x359492(0x240),_0x1686ee);const _0x5d55b4=await database_1[_0x359492(0x1b1)][_0x359492(0x238)]['findMany']({'where':{'status':_0x359492(0x26b),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'createdAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'gatewaySettings':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}});console[_0x359492(0x1f5)](_0x359492(0x251)+_0x5d55b4[_0x359492(0x1ba)]+_0x359492(0x242));const _0x216683=new Map();for(const _0x11a4c9 of _0x5d55b4){const _0x5c20ff={..._0x11a4c9,'status':_0x359492(0x26b),'merchantPaid':![],'shop':{'gatewaySettings':_0x11a4c9[_0x359492(0x250)][_0x359492(0x22f)]}},_0x1f9840=this[_0x359492(0x1fd)](_0x5c20ff);if(!_0x1f9840)continue;const _0x2bf8ab=await currencyService_1[_0x359492(0x1d0)][_0x359492(0x222)](_0x11a4c9[_0x359492(0x1ec)],_0x11a4c9[_0x359492(0x1de)]),_0x56cc5e=this[_0x359492(0x22d)](_0x11a4c9[_0x359492(0x250)],_0x11a4c9['gateway']),_0x5e3aa4=this['calculateAmountAfterCommission'](_0x2bf8ab,_0x56cc5e[_0x359492(0x235)]),_0x4c3962=_0x11a4c9[_0x359492(0x246)];!_0x216683[_0x359492(0x22b)](_0x4c3962)&&_0x216683['set'](_0x4c3962,{'shop':_0x11a4c9[_0x359492(0x250)],'payments':[]}),_0x216683[_0x359492(0x1bb)](_0x4c3962)[_0x359492(0x1f6)][_0x359492(0x262)]({'id':_0x11a4c9['id'],'amount':_0x11a4c9['amount'],'currency':_0x11a4c9[_0x359492(0x1de)],'gateway':_0x11a4c9[_0x359492(0x1c6)],'paidAt':_0x11a4c9['paidAt'],'createdAt':_0x11a4c9[_0x359492(0x1e6)],'amountUSDT':_0x2bf8ab,'commission':_0x56cc5e[_0x359492(0x235)],'amountAfterCommissionUSDT':_0x5e3aa4,'isEligible':!![]});}console['log'](_0x359492(0x256)+_0x216683['size']+_0x359492(0x1d4));const _0x3ef87b=[];for(const [_0x2347d2,_0x21c6e4]of _0x216683){const {shop:_0x4c5ffc,payments:_0x23b6b6}=_0x21c6e4,_0x26deca=_0x23b6b6[_0x359492(0x275)]((_0x39b1f8,_0x50a100)=>_0x39b1f8+_0x50a100[_0x359492(0x212)],0x0),_0x5ea5b9=_0x23b6b6[_0x359492(0x275)]((_0xa31b17,_0x40a389)=>_0xa31b17+_0x40a389[_0x359492(0x1d5)],0x0);if(_0x30f2e4&&_0x5ea5b9<_0x30f2e4)continue;if(_0x1b1b52){const _0x2066a0=_0x1b1b52[_0x359492(0x1cc)](),_0x36d8dc=_0x4c5ffc['name'][_0x359492(0x1cc)]()[_0x359492(0x24c)](_0x2066a0)||_0x4c5ffc[_0x359492(0x1e0)][_0x359492(0x1cc)]()[_0x359492(0x24c)](_0x2066a0)||_0x4c5ffc[_0x359492(0x278)]&&_0x4c5ffc['telegram'][_0x359492(0x1cc)]()[_0x359492(0x24c)](_0x2066a0);if(!_0x36d8dc)continue;}const _0x524005=new Map();for(const _0x338d87 of _0x23b6b6){const _0x1720b2=_0x338d87[_0x359492(0x1c6)];!_0x524005[_0x359492(0x22b)](_0x1720b2)&&_0x524005['set'](_0x1720b2,{'count':0x0,'amountUSDT':0x0,'amountAfterCommissionUSDT':0x0,'commission':_0x338d87['commission']});const _0x270059=_0x524005['get'](_0x1720b2);_0x270059[_0x359492(0x20a)]++,_0x270059[_0x359492(0x212)]+=_0x338d87['amountUSDT'],_0x270059[_0x359492(0x1d5)]+=_0x338d87[_0x359492(0x1d5)];}const _0x503d4c=Array['from'](_0x524005['entries']())[_0x359492(0x24d)](([_0x365879,_0x4a92f4])=>({'gateway':_0x365879[_0x359492(0x202)](0x0)[_0x359492(0x20f)]()+_0x365879[_0x359492(0x1f7)](0x1),'count':_0x4a92f4[_0x359492(0x20a)],'amountUSDT':Math['round'](_0x4a92f4[_0x359492(0x212)]*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x359492(0x271)](_0x4a92f4['amountAfterCommissionUSDT']*0x64)/0x64,'commission':_0x4a92f4['commission']})),_0x4f1659=_0x23b6b6[_0x359492(0x275)]((_0x473bd1,_0x214434)=>{const _0x1152c3=_0x359492;return _0x214434[_0x1152c3(0x27c)]<_0x473bd1?_0x214434['paidAt']:_0x473bd1;},_0x23b6b6[0x0][_0x359492(0x27c)]);_0x3ef87b[_0x359492(0x262)]({'id':_0x4c5ffc['id'],'fullName':_0x4c5ffc[_0x359492(0x1df)],'username':_0x4c5ffc[_0x359492(0x1e0)],'telegramId':_0x4c5ffc[_0x359492(0x278)],'merchantUrl':_0x4c5ffc['shopUrl'],'wallets':{'usdtPolygonWallet':_0x4c5ffc[_0x359492(0x1fc)],'usdtTrcWallet':_0x4c5ffc['usdtTrcWallet'],'usdtErcWallet':_0x4c5ffc['usdtErcWallet'],'usdcPolygonWallet':_0x4c5ffc[_0x359492(0x268)]},'totalAmountUSDT':Math['round'](_0x26deca*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x5ea5b9*0x64)/0x64,'paymentsCount':_0x23b6b6[_0x359492(0x1ba)],'oldestPaymentDate':_0x4f1659,'gatewayBreakdown':_0x503d4c});}_0x3ef87b[_0x359492(0x220)]((_0x4e035e,_0x41838e)=>_0x41838e[_0x359492(0x1eb)]-_0x4e035e['totalAmountAfterCommissionUSDT']);const _0x5a14c6=_0x3ef87b[_0x359492(0x1ba)],_0x2500af=_0x3ef87b[_0x359492(0x275)]((_0x2e9338,_0x533304)=>_0x2e9338+_0x533304['totalAmountUSDT'],0x0),_0x5aa4a0=_0x3ef87b[_0x359492(0x275)]((_0x335ed8,_0x59ff71)=>_0x335ed8+_0x59ff71[_0x359492(0x1eb)],0x0),_0x247ed3=(_0x2d66e9-0x1)*_0x1a26df,_0x4ca1e2=_0x3ef87b[_0x359492(0x1f7)](_0x247ed3,_0x247ed3+_0x1a26df);return console[_0x359492(0x1f5)](_0x359492(0x24b)+_0x4ca1e2[_0x359492(0x1ba)]+_0x359492(0x25d)+_0x5a14c6+'\x20total'),console[_0x359492(0x1f5)](_0x359492(0x26a)+_0x2500af[_0x359492(0x1cd)](0x2)+_0x359492(0x1ac)+_0x5aa4a0[_0x359492(0x1cd)](0x2)+_0x359492(0x260)),{'merchants':_0x4ca1e2,'pagination':{'page':_0x2d66e9,'limit':_0x1a26df,'total':_0x5a14c6,'totalPages':Math[_0x359492(0x237)](_0x5a14c6/_0x1a26df)},'summary':{'totalMerchants':_0x5a14c6,'totalAmountUSDT':Math[_0x359492(0x271)](_0x2500af*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x5aa4a0*0x64)/0x64}};}async[a33_0x3ef1a0(0x1a9)](){const _0x352c8a=a33_0x3ef1a0;console[_0x352c8a(0x1f5)](_0x352c8a(0x218));const _0xa26750=await database_1[_0x352c8a(0x1b1)][_0x352c8a(0x238)][_0x352c8a(0x24a)]({'where':{'status':{'in':[_0x352c8a(0x26b),_0x352c8a(0x1e1),_0x352c8a(0x21e)]}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'status':!![],'gateway':!![],'paidAt':!![],'merchantPaid':!![],'createdAt':!![],'chargebackAmount':!![],'shop':{'select':{'gatewaySettings':!![]}}}});console[_0x352c8a(0x1f5)](_0x352c8a(0x251)+_0xa26750[_0x352c8a(0x1ba)]+_0x352c8a(0x26f));const _0x50efd4=new Date(),_0x5a2339=new Date(_0x50efd4[_0x352c8a(0x1a8)](),_0x50efd4[_0x352c8a(0x1e5)](),0x1),_0x61a4be=new Date(_0x50efd4[_0x352c8a(0x1a8)](),_0x50efd4['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7);let _0x330eec=0x0,_0x3d8bfc=0x0,_0x5f0d80=0x0,_0x591972=0x0;for(const _0x1bfbca of _0xa26750){const _0x442b19=this['calculateEffectiveAmount'](_0x1bfbca);if(_0x442b19===0x0)continue;let _0x77b357,_0x2d7596;if(_0x1bfbca[_0x352c8a(0x1bf)]===_0x352c8a(0x21e))_0x77b357=Math[_0x352c8a(0x245)](_0x442b19),_0x2d7596=-_0x77b357;else{_0x77b357=await currencyService_1[_0x352c8a(0x1d0)][_0x352c8a(0x222)](_0x1bfbca[_0x352c8a(0x1ec)],_0x1bfbca[_0x352c8a(0x1de)]);const _0x2b0a53=this[_0x352c8a(0x22d)](_0x1bfbca[_0x352c8a(0x250)],_0x1bfbca[_0x352c8a(0x1c6)]);_0x2d7596=this[_0x352c8a(0x1b9)](_0x77b357,_0x2b0a53[_0x352c8a(0x235)]);}_0x1bfbca['merchantPaid']&&(_0x330eec+=_0x2d7596,_0x1bfbca[_0x352c8a(0x27c)]&&_0x1bfbca[_0x352c8a(0x27c)]>=_0x5a2339&&_0x1bfbca['paidAt']<=_0x61a4be&&(_0x5f0d80+=_0x2d7596)),_0x1bfbca['status']===_0x352c8a(0x26b)&&this[_0x352c8a(0x1fd)](_0x1bfbca)&&(_0x3d8bfc+=_0x2d7596,_0x591972+=_0x77b357);}const _0x175aa7={'totalPayout':Math[_0x352c8a(0x271)](_0x330eec*0x64)/0x64,'awaitingPayout':Math[_0x352c8a(0x271)](_0x3d8bfc*0x64)/0x64,'thisMonth':Math[_0x352c8a(0x271)](_0x5f0d80*0x64)/0x64,'availableBalance':Math['round'](_0x591972*0x64)/0x64};return console[_0x352c8a(0x1f5)](_0x352c8a(0x1ad)),console[_0x352c8a(0x1f5)](_0x352c8a(0x200)+_0x175aa7['totalPayout']+_0x352c8a(0x20c)),console[_0x352c8a(0x1f5)](_0x352c8a(0x1c5)+_0x175aa7[_0x352c8a(0x1f3)]+_0x352c8a(0x1fa)),console['log']('üìÖ\x20This\x20Month:\x20'+_0x175aa7[_0x352c8a(0x1f2)]+_0x352c8a(0x255)),console[_0x352c8a(0x1f5)](_0x352c8a(0x210)+_0x175aa7[_0x352c8a(0x1db)]+_0x352c8a(0x255)),_0x175aa7;}async[a33_0x3ef1a0(0x243)](_0x389e68){const _0x3fe733=a33_0x3ef1a0,_0x20b8e2=this['getPeriodDays'](_0x389e68),_0x4cf05b=new Date();_0x4cf05b[_0x3fe733(0x1dc)](_0x4cf05b[_0x3fe733(0x276)]()-_0x20b8e2),console[_0x3fe733(0x1f5)]('üìä\x20Generating\x20admin\x20statistics\x20for\x20period:\x20'+_0x389e68+'\x20('+_0x20b8e2+_0x3fe733(0x264));const _0x44dd90=await database_1[_0x3fe733(0x1b1)]['shop'][_0x3fe733(0x20a)]({'where':{'status':_0x3fe733(0x23a)}}),_0x2bfca6=await database_1[_0x3fe733(0x1b1)][_0x3fe733(0x238)]['count'](),_0x465636=await database_1[_0x3fe733(0x1b1)][_0x3fe733(0x238)]['findMany']({'where':{'status':{'in':[_0x3fe733(0x26b),_0x3fe733(0x1e1),_0x3fe733(0x21e)]}},'select':{'amount':!![],'currency':!![],'status':!![],'chargebackAmount':!![],'createdAt':!![]}});console['log'](_0x3fe733(0x251)+_0x465636['length']+_0x3fe733(0x207));const _0x513005=await Promise[_0x3fe733(0x263)](_0x465636[_0x3fe733(0x24d)](async _0x5f35e9=>{const _0x270036=_0x3fe733,_0x35bbbc=this[_0x270036(0x232)](_0x5f35e9);if(_0x35bbbc===0x0)return{'amount':0x0,'createdAt':_0x5f35e9[_0x270036(0x1e6)]};let _0x2102b8;return _0x5f35e9[_0x270036(0x1bf)]===_0x270036(0x21e)?_0x2102b8=-Math[_0x270036(0x245)](_0x35bbbc):_0x2102b8=await currencyService_1['currencyService'][_0x270036(0x222)](_0x5f35e9[_0x270036(0x1ec)],_0x5f35e9[_0x270036(0x1de)]),{'amount':_0x2102b8,'createdAt':_0x5f35e9['createdAt']};})),_0x449c37=_0x513005[_0x3fe733(0x275)]((_0x15d2ec,_0x5f5214)=>_0x15d2ec+_0x5f5214[_0x3fe733(0x1ec)],0x0),_0x23eadc=_0x2bfca6>0x0?_0x449c37/_0x2bfca6:0x0;console[_0x3fe733(0x1f5)](_0x3fe733(0x1ea)+_0x449c37[_0x3fe733(0x1cd)](0x2)+_0x3fe733(0x20c)),console[_0x3fe733(0x1f5)]('üìà\x20Average\x20payment:\x20'+_0x23eadc[_0x3fe733(0x1cd)](0x2)+'\x20USDT');const _0x5d25a1=await database_1['default'][_0x3fe733(0x21b)]`
      SELECT 
        DATE(created_at) as date,
        array_agg(
          json_build_object(
            'amount', amount,
            'currency', currency,
            'status', status,
            'chargeback_amount', chargeback_amount
          )
        ) as payments
      FROM payments 
      WHERE created_at >= ${_0x4cf05b}
        AND status IN ('PAID', 'REFUND', 'CHARGEBACK')
      GROUP BY DATE(created_at)
      ORDER BY date ASC
    `;console[_0x3fe733(0x1f5)](_0x3fe733(0x217)+_0x5d25a1[_0x3fe733(0x1ba)]+_0x3fe733(0x215));const _0x305381=await Promise['all'](_0x5d25a1[_0x3fe733(0x24d)](async _0x1af08b=>{const _0x164742=_0x3fe733,_0x2bdf3e=await Promise[_0x164742(0x263)](_0x1af08b[_0x164742(0x1f6)][_0x164742(0x24d)](async _0x45cedc=>{const _0x3a52a5=_0x164742,_0x4c9db3=this['calculateEffectiveAmount'](_0x45cedc);if(_0x4c9db3===0x0)return 0x0;return _0x45cedc[_0x3a52a5(0x1bf)]==='CHARGEBACK'?-Math[_0x3a52a5(0x245)](_0x4c9db3):await currencyService_1[_0x3a52a5(0x1d0)][_0x3a52a5(0x222)](_0x45cedc['amount'],_0x45cedc[_0x3a52a5(0x1de)]);})),_0x4e1cc2=_0x2bdf3e['reduce']((_0x5e4995,_0x2deb54)=>_0x5e4995+_0x2deb54,0x0);return{'date':_0x1af08b[_0x164742(0x24e)][_0x164742(0x253)]()[_0x164742(0x236)]('T')[0x0],'amount':_0x4e1cc2};})),_0x4093fa=this[_0x3fe733(0x1c8)](_0x4cf05b,new Date()),_0x1e8efd=new Map(_0x305381[_0x3fe733(0x24d)](_0x479aba=>[_0x479aba[_0x3fe733(0x24e)],_0x479aba['amount']])),_0x101a1e=_0x4093fa[_0x3fe733(0x24d)](_0x15c126=>({'date':_0x15c126,'amount':_0x1e8efd[_0x3fe733(0x1bb)](_0x15c126)||0x0}));return console[_0x3fe733(0x1f5)](_0x3fe733(0x258)),console[_0x3fe733(0x1f5)](_0x3fe733(0x1af)+_0x44dd90),console[_0x3fe733(0x1f5)](_0x3fe733(0x1ab)+_0x2bfca6),console['log'](_0x3fe733(0x21c)+_0x101a1e[_0x3fe733(0x1ba)]),{'totalRevenue':Math[_0x3fe733(0x271)](_0x449c37*0x64)/0x64,'totalUsers':_0x44dd90,'totalPayments':_0x2bfca6,'averagePayment':Math['round'](_0x23eadc*0x64)/0x64,'dailyRevenue':_0x101a1e};}async[a33_0x3ef1a0(0x228)](_0x16137e){const _0x5c3499=a33_0x3ef1a0,{page:_0x402709,limit:_0x5f2fc2,status:_0x34b21c,gateway:_0x59c604,shopId:_0x14d13b,dateFrom:_0x5decbb,dateTo:_0x453536,search:_0x4d4737}=_0x16137e,_0x1af24e=(_0x402709-0x1)*_0x5f2fc2;console[_0x5c3499(0x1f5)](_0x5c3499(0x273),_0x16137e);const _0x309d45={};_0x34b21c&&(_0x309d45[_0x5c3499(0x1bf)]=_0x34b21c[_0x5c3499(0x20f)]());if(_0x59c604){if((0x0,gateway_1[_0x5c3499(0x266)])(_0x59c604)){const _0x4c0ca7=(0x0,gateway_1[_0x5c3499(0x1e2)])(_0x59c604);_0x4c0ca7&&(_0x309d45[_0x5c3499(0x1c6)]=_0x4c0ca7);}else _0x309d45['gateway']=_0x59c604['toLowerCase']();}_0x14d13b&&(_0x309d45[_0x5c3499(0x246)]=_0x14d13b);(_0x5decbb||_0x453536)&&(_0x309d45[_0x5c3499(0x1e6)]={},_0x5decbb&&(_0x309d45[_0x5c3499(0x1e6)][_0x5c3499(0x227)]=new Date(_0x5decbb)),_0x453536&&(_0x309d45[_0x5c3499(0x1e6)][_0x5c3499(0x279)]=new Date(_0x453536)));_0x4d4737&&(_0x309d45['OR']=[{'orderId':{'contains':_0x4d4737,'mode':_0x5c3499(0x1f0)}},{'gatewayOrderId':{'contains':_0x4d4737,'mode':_0x5c3499(0x1f0)}},{'gatewayPaymentId':{'contains':_0x4d4737,'mode':_0x5c3499(0x1f0)}},{'customerEmail':{'contains':_0x4d4737,'mode':'insensitive'}},{'customerName':{'contains':_0x4d4737,'mode':_0x5c3499(0x1f0)}},{'shop':{'name':{'contains':_0x4d4737,'mode':_0x5c3499(0x1f0)}}},{'shop':{'username':{'contains':_0x4d4737,'mode':'insensitive'}}}]);const [_0x12dd20,_0x2a512a]=await Promise[_0x5c3499(0x263)]([database_1['default'][_0x5c3499(0x238)][_0x5c3499(0x24a)]({'where':_0x309d45,'skip':_0x1af24e,'take':_0x5f2fc2,'orderBy':{'createdAt':_0x5c3499(0x270)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default'][_0x5c3499(0x238)]['count']({'where':_0x309d45})]);console[_0x5c3499(0x1f5)]('üìä\x20Found\x20'+_0x12dd20[_0x5c3499(0x1ba)]+_0x5c3499(0x209)+_0x2a512a+_0x5c3499(0x1c0));const _0x24da80=_0x12dd20['map'](_0x134674=>({'id':_0x134674['id'],'shopId':_0x134674[_0x5c3499(0x246)],'shopName':_0x134674['shop'][_0x5c3499(0x1df)],'shopUsername':_0x134674['shop'][_0x5c3499(0x1e0)],'gateway':_0x134674[_0x5c3499(0x1c6)],'orderId':_0x134674[_0x5c3499(0x254)],'gatewayOrderId':_0x134674[_0x5c3499(0x1a7)],'amount':_0x134674[_0x5c3499(0x1ec)],'currency':_0x134674['currency'],'sourceCurrency':_0x134674[_0x5c3499(0x1c9)],'status':_0x134674[_0x5c3499(0x1bf)],'usage':_0x134674['usage'],'externalPaymentUrl':_0x134674[_0x5c3499(0x1e7)],'gatewayPaymentId':_0x134674[_0x5c3499(0x1ae)],'customerEmail':_0x134674[_0x5c3499(0x1c7)],'customerName':_0x134674[_0x5c3499(0x21a)],'cardLast4':_0x134674[_0x5c3499(0x234)],'paymentMethod':_0x134674['paymentMethod'],'bankId':_0x134674[_0x5c3499(0x1bd)],'remitterIban':_0x134674[_0x5c3499(0x274)],'remitterName':_0x134674[_0x5c3499(0x25c)],'chargebackAmount':_0x134674[_0x5c3499(0x241)],'adminNotes':_0x134674[_0x5c3499(0x1ed)],'statusChangedBy':_0x134674['statusChangedBy'],'statusChangedAt':_0x134674['statusChangedAt'],'createdAt':_0x134674[_0x5c3499(0x1e6)],'updatedAt':_0x134674[_0x5c3499(0x1ce)],'expiresAt':_0x134674[_0x5c3499(0x261)]}));return{'payments':_0x24da80,'pagination':{'page':_0x402709,'limit':_0x5f2fc2,'total':_0x2a512a,'totalPages':Math[_0x5c3499(0x237)](_0x2a512a/_0x5f2fc2)}};}async['getPaymentById'](_0x3b14a3){const _0x4e6280=a33_0x3ef1a0;console['log'](_0x4e6280(0x22e)+_0x3b14a3);const _0xe72b3=await database_1['default'][_0x4e6280(0x238)][_0x4e6280(0x226)]({'where':{'id':_0x3b14a3},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}},'webhookLogs':{'orderBy':{'createdAt':_0x4e6280(0x270)},'take':0xa,'select':{'id':!![],'event':!![],'statusCode':!![],'retryCount':!![],'createdAt':!![]}}}});if(!_0xe72b3)return console[_0x4e6280(0x1f5)]('‚ùå\x20Payment\x20not\x20found:\x20'+_0x3b14a3),null;return console[_0x4e6280(0x1f5)]('‚úÖ\x20Found\x20payment:\x20'+_0xe72b3[_0x4e6280(0x254)]+'\x20('+_0xe72b3[_0x4e6280(0x1bf)]+')'),{'id':_0xe72b3['id'],'shopId':_0xe72b3[_0x4e6280(0x246)],'shopName':_0xe72b3[_0x4e6280(0x250)][_0x4e6280(0x1df)],'shopUsername':_0xe72b3[_0x4e6280(0x250)][_0x4e6280(0x1e0)],'gateway':_0xe72b3['gateway'],'orderId':_0xe72b3[_0x4e6280(0x254)],'gatewayOrderId':_0xe72b3[_0x4e6280(0x1a7)],'amount':_0xe72b3[_0x4e6280(0x1ec)],'currency':_0xe72b3['currency'],'sourceCurrency':_0xe72b3['sourceCurrency'],'status':_0xe72b3[_0x4e6280(0x1bf)],'usage':_0xe72b3[_0x4e6280(0x1b6)],'externalPaymentUrl':_0xe72b3[_0x4e6280(0x1e7)],'gatewayPaymentId':_0xe72b3[_0x4e6280(0x1ae)],'customerEmail':_0xe72b3[_0x4e6280(0x1c7)],'customerName':_0xe72b3[_0x4e6280(0x21a)],'cardLast4':_0xe72b3[_0x4e6280(0x234)],'paymentMethod':_0xe72b3[_0x4e6280(0x25a)],'bankId':_0xe72b3[_0x4e6280(0x1bd)],'remitterIban':_0xe72b3[_0x4e6280(0x274)],'remitterName':_0xe72b3[_0x4e6280(0x25c)],'chargebackAmount':_0xe72b3[_0x4e6280(0x241)],'adminNotes':_0xe72b3[_0x4e6280(0x1ed)],'statusChangedBy':_0xe72b3['statusChangedBy'],'statusChangedAt':_0xe72b3[_0x4e6280(0x26e)],'createdAt':_0xe72b3[_0x4e6280(0x1e6)],'updatedAt':_0xe72b3[_0x4e6280(0x1ce)],'expiresAt':_0xe72b3[_0x4e6280(0x261)],'webhookLogs':_0xe72b3['webhookLogs']};}async[a33_0x3ef1a0(0x1f1)](_0x5d313d,_0x19c7e5,_0x488006,_0x5e6eb4){const _0x52304f=a33_0x3ef1a0;console[_0x52304f(0x1f5)](_0x52304f(0x208)+_0x5d313d+_0x52304f(0x1d8)+_0x19c7e5);const _0x497b2b=['PENDING',_0x52304f(0x1c4),_0x52304f(0x26b),_0x52304f(0x1f9),_0x52304f(0x206),_0x52304f(0x1e1),_0x52304f(0x21e)];if(!_0x497b2b['includes'](_0x19c7e5['toUpperCase']()))throw new Error('Invalid\x20status.\x20Valid\x20statuses:\x20'+_0x497b2b['join'](',\x20'));const _0x5428cc=await database_1[_0x52304f(0x1b1)]['payment'][_0x52304f(0x226)]({'where':{'id':_0x5d313d},'select':{'id':!![],'status':!![],'orderId':!![]}});if(!_0x5428cc)throw new Error(_0x52304f(0x27e));if(_0x19c7e5[_0x52304f(0x20f)]()==='CHARGEBACK'){if(!_0x5e6eb4||_0x5e6eb4<=0x0)throw new Error(_0x52304f(0x1d6));console['log'](_0x52304f(0x23f)+_0x5e6eb4+'\x20USDT\x20(penalty\x20amount)');}const _0x16bba9={'status':_0x19c7e5[_0x52304f(0x20f)](),'updatedAt':new Date()};_0x488006&&(_0x16bba9['adminNotes']=_0x488006);_0x19c7e5[_0x52304f(0x20f)]()===_0x52304f(0x21e)&&_0x5e6eb4&&(_0x16bba9[_0x52304f(0x241)]=_0x5e6eb4);const _0x47df2e=await database_1[_0x52304f(0x1b1)][_0x52304f(0x238)][_0x52304f(0x27d)]({'where':{'id':_0x5d313d},'data':_0x16bba9,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});return await database_1[_0x52304f(0x1b1)][_0x52304f(0x1e3)]['create']({'data':{'paymentId':_0x5d313d,'shopId':_0x47df2e[_0x52304f(0x246)],'event':_0x52304f(0x1b8),'statusCode':0xc8,'responseBody':JSON['stringify']({'oldStatus':_0x5428cc['status'],'newStatus':_0x19c7e5[_0x52304f(0x20f)](),'notes':_0x488006||null,'chargebackAmount':_0x5e6eb4||null,'timestamp':new Date()[_0x52304f(0x253)]()})}}),console['log'](_0x52304f(0x211)+_0x5428cc[_0x52304f(0x254)]+_0x52304f(0x1d3)+_0x5428cc[_0x52304f(0x1bf)]+_0x52304f(0x23e)+_0x19c7e5[_0x52304f(0x20f)]()),_0x19c7e5[_0x52304f(0x20f)]()===_0x52304f(0x21e)&&console['log']('üí∏\x20Chargeback\x20penalty:\x20'+_0x5e6eb4+_0x52304f(0x20e)),{'id':_0x47df2e['id'],'shopId':_0x47df2e[_0x52304f(0x246)],'shopName':_0x47df2e[_0x52304f(0x250)]['name'],'shopUsername':_0x47df2e[_0x52304f(0x250)][_0x52304f(0x1e0)],'gateway':_0x47df2e['gateway'],'orderId':_0x47df2e['orderId'],'gatewayOrderId':_0x47df2e['gatewayOrderId'],'amount':_0x47df2e[_0x52304f(0x1ec)],'currency':_0x47df2e[_0x52304f(0x1de)],'sourceCurrency':_0x47df2e[_0x52304f(0x1c9)],'status':_0x47df2e[_0x52304f(0x1bf)],'usage':_0x47df2e[_0x52304f(0x1b6)],'externalPaymentUrl':_0x47df2e['externalPaymentUrl'],'gatewayPaymentId':_0x47df2e[_0x52304f(0x1ae)],'customerEmail':_0x47df2e['customerEmail'],'customerName':_0x47df2e[_0x52304f(0x21a)],'cardLast4':_0x47df2e[_0x52304f(0x234)],'paymentMethod':_0x47df2e[_0x52304f(0x25a)],'bankId':_0x47df2e[_0x52304f(0x1bd)],'remitterIban':_0x47df2e[_0x52304f(0x274)],'remitterName':_0x47df2e[_0x52304f(0x25c)],'chargebackAmount':_0x47df2e[_0x52304f(0x241)],'adminNotes':_0x47df2e[_0x52304f(0x1ed)],'statusChangedBy':_0x47df2e[_0x52304f(0x20b)],'statusChangedAt':_0x47df2e[_0x52304f(0x26e)],'createdAt':_0x47df2e[_0x52304f(0x1e6)],'updatedAt':_0x47df2e[_0x52304f(0x1ce)],'expiresAt':_0x47df2e['expiresAt']};}async[a33_0x3ef1a0(0x25e)](_0x143545){const _0x3e591d=a33_0x3ef1a0,{page:_0x1c25c0,limit:_0x33829a,status:_0x5e140f}=_0x143545,_0x48fc57=(_0x1c25c0-0x1)*_0x33829a,_0x29f9c7={};_0x5e140f&&(_0x29f9c7['status']=_0x5e140f[_0x3e591d(0x20f)]());console['log']('üìã\x20Getting\x20users\x20with\x20filters:',{'page':_0x1c25c0,'limit':_0x33829a,'status':_0x5e140f,'where':_0x29f9c7});const [_0x35cb30,_0x4147c7]=await Promise[_0x3e591d(0x263)]([database_1[_0x3e591d(0x1b1)][_0x3e591d(0x250)][_0x3e591d(0x24a)]({'where':_0x29f9c7,'skip':_0x48fc57,'take':_0x33829a,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x3e591d(0x270)}}),database_1[_0x3e591d(0x1b1)][_0x3e591d(0x250)][_0x3e591d(0x20a)]({'where':_0x29f9c7})]);console[_0x3e591d(0x1f5)](_0x3e591d(0x1d1)+_0x35cb30[_0x3e591d(0x1ba)]+_0x3e591d(0x26c)+_0x4147c7+'\x20total');const _0x932dbb=_0x35cb30[_0x3e591d(0x24d)](_0x23e2e6=>({'id':_0x23e2e6['id'],'fullName':_0x23e2e6[_0x3e591d(0x1df)],'username':_0x23e2e6[_0x3e591d(0x1e0)],'telegramId':_0x23e2e6[_0x3e591d(0x278)],'merchantUrl':_0x23e2e6['shopUrl'],'gateways':_0x23e2e6['paymentGateways']?JSON[_0x3e591d(0x1fe)](_0x23e2e6[_0x3e591d(0x1cb)]):null,'gatewaySettings':_0x23e2e6['gatewaySettings']?JSON[_0x3e591d(0x1fe)](_0x23e2e6[_0x3e591d(0x22f)]):null,'publicKey':_0x23e2e6['publicKey'],'wallets':{'usdtPolygonWallet':_0x23e2e6['usdtPolygonWallet'],'usdtTrcWallet':_0x23e2e6[_0x3e591d(0x1b4)],'usdtErcWallet':_0x23e2e6[_0x3e591d(0x201)],'usdcPolygonWallet':_0x23e2e6[_0x3e591d(0x268)]},'status':_0x23e2e6['status'],'createdAt':_0x23e2e6[_0x3e591d(0x1e6)]}));return{'users':_0x932dbb,'pagination':{'page':_0x1c25c0,'limit':_0x33829a,'total':_0x4147c7,'totalPages':Math[_0x3e591d(0x237)](_0x4147c7/_0x33829a)}};}async[a33_0x3ef1a0(0x1f8)](_0x535703){const _0x21c577=a33_0x3ef1a0;return await this[_0x21c577(0x267)][_0x21c577(0x1f8)](_0x535703);}async[a33_0x3ef1a0(0x27f)](_0x2db48d){const _0x338234=a33_0x3ef1a0;return await this[_0x338234(0x267)][_0x338234(0x27f)](_0x2db48d);}async[a33_0x3ef1a0(0x1b7)](_0x2f56b0,_0x46f60b){const _0x37b583=a33_0x3ef1a0;return await this[_0x37b583(0x267)][_0x37b583(0x1b7)](_0x2f56b0,_0x46f60b);}async['deleteUser'](_0x1016d4){const _0x335d41=a33_0x3ef1a0;return await this[_0x335d41(0x267)][_0x335d41(0x1dd)](_0x1016d4);}async[a33_0x3ef1a0(0x24f)](_0x5d7d30){const _0x2fd9fb=a33_0x3ef1a0;console[_0x2fd9fb(0x1f5)](_0x2fd9fb(0x1fb)+_0x5d7d30);const _0x22e124=await database_1[_0x2fd9fb(0x1b1)]['shop'][_0x2fd9fb(0x226)]({'where':{'id':_0x5d7d30},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x22e124)throw new Error(_0x2fd9fb(0x1b5));if(_0x22e124[_0x2fd9fb(0x1bf)]===_0x2fd9fb(0x272))throw new Error(_0x2fd9fb(0x214));const _0x27cd6d=await this[_0x2fd9fb(0x267)][_0x2fd9fb(0x1b7)](_0x5d7d30,{'status':_0x2fd9fb(0x272)});return console[_0x2fd9fb(0x1f5)](_0x2fd9fb(0x265)+_0x22e124[_0x2fd9fb(0x1e0)]+_0x2fd9fb(0x225)),_0x27cd6d;}async['activateUser'](_0xb6618a){const _0x522b0f=a33_0x3ef1a0;console[_0x522b0f(0x1f5)](_0x522b0f(0x203)+_0xb6618a);const _0x2b430e=await database_1['default']['shop'][_0x522b0f(0x226)]({'where':{'id':_0xb6618a},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x2b430e)throw new Error(_0x522b0f(0x1b5));if(_0x2b430e[_0x522b0f(0x1bf)]===_0x522b0f(0x23a))throw new Error('User\x20is\x20already\x20active');const _0x501ecd=await this[_0x522b0f(0x267)]['updateUser'](_0xb6618a,{'status':'ACTIVE'});return console[_0x522b0f(0x1f5)]('‚úÖ\x20User\x20'+_0x2b430e['username']+_0x522b0f(0x1d7)),_0x501ecd;}}exports[a33_0x3ef1a0(0x23b)]=AdminService;