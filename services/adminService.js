'use strict';const a53_0x3f9d8e=a53_0x1d06;(function(_0x520084,_0x4e26d8){const _0x560d62=a53_0x1d06,_0x2f2d1d=_0x520084();while(!![]){try{const _0x342b91=parseInt(_0x560d62(0x282))/0x1+-parseInt(_0x560d62(0x297))/0x2*(-parseInt(_0x560d62(0x22e))/0x3)+-parseInt(_0x560d62(0x21d))/0x4*(-parseInt(_0x560d62(0x25b))/0x5)+-parseInt(_0x560d62(0x2cd))/0x6+-parseInt(_0x560d62(0x1f5))/0x7*(-parseInt(_0x560d62(0x311))/0x8)+parseInt(_0x560d62(0x1b4))/0x9+parseInt(_0x560d62(0x27a))/0xa*(-parseInt(_0x560d62(0x1e0))/0xb);if(_0x342b91===_0x4e26d8)break;else _0x2f2d1d['push'](_0x2f2d1d['shift']());}catch(_0x1d1602){_0x2f2d1d['push'](_0x2f2d1d['shift']());}}}(a53_0x1b88,0xe0e78));var __createBinding=this&&this[a53_0x3f9d8e(0x169)]||(Object[a53_0x3f9d8e(0x1d2)]?function(_0x2598bb,_0x5672c0,_0x5811f6,_0x53114b){const _0x47fa19=a53_0x3f9d8e;if(_0x53114b===undefined)_0x53114b=_0x5811f6;var _0x25c2f4=Object[_0x47fa19(0x1b9)](_0x5672c0,_0x5811f6);(!_0x25c2f4||('get'in _0x25c2f4?!_0x5672c0['__esModule']:_0x25c2f4['writable']||_0x25c2f4['configurable']))&&(_0x25c2f4={'enumerable':!![],'get':function(){return _0x5672c0[_0x5811f6];}}),Object['defineProperty'](_0x2598bb,_0x53114b,_0x25c2f4);}:function(_0x47279c,_0x1128e8,_0x1dd466,_0x4a7d32){if(_0x4a7d32===undefined)_0x4a7d32=_0x1dd466;_0x47279c[_0x4a7d32]=_0x1128e8[_0x1dd466];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a53_0x3f9d8e(0x1d2)]?function(_0x179d31,_0x147a05){const _0x264ad1=a53_0x3f9d8e;Object[_0x264ad1(0x278)](_0x179d31,'default',{'enumerable':!![],'value':_0x147a05});}:function(_0x2adcda,_0x60e54b){const _0x20c38d=a53_0x3f9d8e;_0x2adcda[_0x20c38d(0x194)]=_0x60e54b;}),__importStar=this&&this[a53_0x3f9d8e(0x2df)]||(function(){var _0x30d033=function(_0x195bb9){const _0x3b9326=a53_0x1d06;return _0x30d033=Object[_0x3b9326(0x21b)]||function(_0xfda395){const _0x353277=_0x3b9326;var _0x537a7f=[];for(var _0x40df60 in _0xfda395)if(Object[_0x353277(0x185)][_0x353277(0x1cb)]['call'](_0xfda395,_0x40df60))_0x537a7f[_0x537a7f[_0x353277(0x239)]]=_0x40df60;return _0x537a7f;},_0x30d033(_0x195bb9);};return function(_0x55b602){const _0x365cfc=a53_0x1d06;if(_0x55b602&&_0x55b602[_0x365cfc(0x1b3)])return _0x55b602;var _0x1334df={};if(_0x55b602!=null){for(var _0x2b788e=_0x30d033(_0x55b602),_0x3228bf=0x0;_0x3228bf<_0x2b788e[_0x365cfc(0x239)];_0x3228bf++)if(_0x2b788e[_0x3228bf]!==_0x365cfc(0x194))__createBinding(_0x1334df,_0x55b602,_0x2b788e[_0x3228bf]);}return __setModuleDefault(_0x1334df,_0x55b602),_0x1334df;};}()),__importDefault=this&&this[a53_0x3f9d8e(0x1ee)]||function(_0x5cff0c){const _0x5e2564=a53_0x3f9d8e;return _0x5cff0c&&_0x5cff0c[_0x5e2564(0x1b3)]?_0x5cff0c:{'default':_0x5cff0c};};Object['defineProperty'](exports,a53_0x3f9d8e(0x1b3),{'value':!![]}),exports['AdminService']=void 0x0;function a53_0x1b88(){const _0xdbaf05=['desc','ðŸ’³\x20Final\x20payout\x20wallet\x20for\x20','commissionUSDT','\x20\x20\x20Payout\x20amount:\x20','lastMonth','\x20USDT\x20(after\x20','passwordHash','\x20\x20\x20ðŸ’°\x20Total\x20turnover:\x20','findUnique','\x20-\x20','asc','ADMIN_2FA_ENABLED=','month','notes','\x20USDT','ðŸ“…\x20Date\x20from\x20filter:\x20','createUser','CHARGEBACK','getMonth','ðŸ”\x20Balance\x20check\x20details:','toDataURL','bcryptjs','USDT',',\x20chargebacks:\x20','password','\x20\x20\x20â³\x20Awaiting\x20payout:\x20','map','mastercard','\x20USDT\x20(current\x20balance\x20in\x20DB)','./currencyService','../types/gateway','âš ï¸\x20CHARGEBACK\x20without\x20penalty\x20amount\x20-\x20no\x20balance\x20change','Interac','getSettingsByGatewayId','OnRamp','gatewayCommission','shopUrl','turnover','substr','âœ…\x20Customer\x20data\x20updated\x20for\x20payment\x20','âš ï¸\x20Payment\x20','base32','$transaction','3939360PWSwpH','ADMIN_2FA_SECRET=','\x20\x20\x20Total\x20paid\x20out:\x20','toString','floor','hex','Amer',']\x20Updating\x20password\x20for\x20user\x20','min','_count','../config/database','config','ðŸ“…\x20Date\x20to\x20filter:\x20','\x20backup\x20codes','ðŸ”§\x20[','klyme_gb','Deposit','round','__importStar','InstaXchange','ðŸ”\x20Admin\x202FA\x20disabled','\x20\x20\x20ðŸª\x20Gateway\x20earnings:\x20','last_month','Noda','\x20has\x20zero\x20or\x20null\x20merchant\x20amount,\x20skipping...','entries','shopUrl4','Merchant\x20not\x20found','ðŸ”\x20Selected\x20erc20_usdc\x20wallet:\x20','paymentsCount','getUTCFullYear','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','\x20USDT\x20(rounded\x20to\x202\x20decimal\x20places)','Insufficient\x20balance.\x20Available:\x20','âœ…\x20Payout\x20created\x20in\x20DB:','ðŸ“Š\x20Gateway\x20filter\x20applied:','periodTo','\x20USDT\x20for\x20payment\x20','reduce','REFUND','\x20\x20\x20Added\x20to\x20balance:\x20+','Payment\x20not\x20found','ðŸ”\x20No\x20wallet\x20provided,\x20looking\x20up\x20from\x20shop\x20settings...','deletePayout','\x20USDT\x20from\x20balance','toLowerCase','ðŸ“Š\x20Merchants\x20with\x20rounded\x20balance\x20!=\x200.00:\x20','ðŸ“Š\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','\x20\x20\x20Shop\x20totalPaidOut:\x20','updateCustomerData','suspendUser','ðŸ“Š\x20Getting\x20merchant\x20statistics\x20with\x20filters:','SUSPENDED','paidOutUSDT','%\x20from\x20','paymentGateways','ðŸ“±\x20Telegram\x20notification\x20sent\x20for\x20payout\x20','\x20status:\x20','thisMonth','\x20paid\x20payments\x20for\x20gateway\x20','toISOString','period','revenue','Plisio','ðŸ’°\x20Shop\x20','\x20\x20\x20ðŸ“…\x20Total\x20payouts\x20(this\x20month):\x20','\x20\x20\x20Balance:\x20','Telegram\x20username\x20already\x20exists','392dIMKne','generateSecret','generateBackupCodes','merchantEarnings','PENDING','createdAt','values','customerName','insensitive','disable2FA','includes','random','\x20\x20\x20âœ…\x20Total\x20net\x20balances:\x20','shop','ðŸ”\x202FA\x20enabled\x20for\x20shop:\x20','Test\x20Gateway','getMerchantsSelection','ðŸŽ¯\x20updateUser\x20called\x20with\x20ID:\x20','customerIp','set','\x27\x20to\x20name\x20\x27','\x20\x20\x20Amount\x20increased\x20by\x20','amountUSDT','\x20\x20\x20Current\x20balance:\x20','\x20USDT\x20(gross\x20revenue)','Shop\x20not\x20found','Insufficient\x20balance\x20for\x20amount\x20increase.\x20Available:\x20','trc20','totalAmountUSDT','setupAdmin2FA','adminNotes','toUpperCase','\x20\x20\x20New\x20amount:\x20','USDC','getUTCMonth','ðŸ”‘\x20Generated\x20','otpauth_url','\x20\x20\x20Amount\x20difference:\x20','\x20balance\x20updated:\x20','convertToUSDT','setHours','ðŸ“Š\x20Getting\x20payout\x20reports\x20with\x20filters:','awaitingPayout','âœ…\x20Deposited\x20','enableAdmin2FA','\x20USDT\x20(total\x20paid\x20to\x20merchants)','getGatewayDisplayName','ðŸ’¸\x20CHARGEBACK:\x20Processing\x20penalty-only\x20deduction','\x20\x20\x20ðŸ–¥ï¸\x20User\x20Agent:\x20','ADMIN_PASSWORD_HASH=','startsWith','ceil','ðŸ’°\x20Creating\x20payout\x20for\x20shop\x20','cointopay2','\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)','publicKey','verify','gatewayCommissionRate','__createBinding','network','ðŸ’°\x20Found\x20','totalPayout','gatewayEarnings','.env','getPayoutById','\x27\x20not\x20found.\x20Available\x20gateways:\x20',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','Error\x20processing\x20payment\x20','OxaPay','\x20\x20\x20Available\x20(number):\x20','Error\x20parsing\x20backup\x20codes:',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','error','usdtTrcWallet','\x20\x20\x20Merchant\x20loses:\x20','getPayoutStats','customerCountry','shopId','ðŸ“‹\x20Found\x20','\x27\x20->\x20ID\x20\x27','all_time','ðŸ’°\x20Payment\x20amount\x20is\x20NOT\x20deducted\x20(chargeback\x20penalty\x20only)','delete','txid','ðŸ“Š\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20','some','prototype','Visa/MasterCard','setUTCDate','get2FASettings','\x20USDT\x20-\x20will\x20return\x20to\x20balance','whiteUrl','ðŸ”„\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','log','Invalid\x202FA\x20token','merchantId','MasterCard','usdtPolygonWallet','merchantUrl4','sendPayoutNotification','getUTCDate','default','totp','resolve','twoFactorSecret','\x20\x20\x20ðŸŒ\x20IP:\x20','polygon_usdc','ðŸ“Š\x20Payout\x20statistics\x20calculated:',',\x20refunds:\x20','ðŸŽ¯\x20[','2FA\x20is\x20already\x20enabled','readFileSync','getShopWallets','twoFactorEnabled','lastLoginAt','updatedAt','gatewayOrderId','findFirst','status','ðŸ”„\x20Gateway\x20mapping\x20(get):','0000','compare','\x20\x20\x20ï¿½\x20Total\x20payments\x20turnover:\x20','payout',',\x20Commission:\x20','setDate','\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...','\x20balance\x20updated:','count','totalAmountAfterCommissionUSDT','getTime','totalAmount','__esModule','4805397QFnRSq','splice','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','âš ï¸\x20Gateway\x20\x27','\x20PAID\x20payments','getOwnPropertyDescriptor','averageCheckUSDT','telegramId','\x20USDT\x20(already\x20paid\x20out)','periodFrom','Invalid\x202FA\x20token\x20or\x20backup\x20code','not\x20set','custom_','ðŸ”„\x20Converted\x20gateway\x20name\x20\x27','backupCodes','custom','toFixed','gateway','gatewaySettings','\x20USDT,\x20merchant:\x20','merchantUrl2','customerUa','statusChangedBy','hasOwnProperty','\x20\x20\x20ðŸ’µ\x20Available\x20balance:\x20','ðŸ’°\x20[PAYOUT]\x20Gateway\x20','ðŸ“…\x20Payout\x20date\x20to\x20filter:\x20','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','commission','\x20USDT,\x20Requested:\x20','create','ðŸ”\x20Admin\x202FA\x20setup\x20initiated','wallet','\x20\x20\x20ðŸ’³\x20Total\x20payments:\x20','ðŸ“Š\x20Calculating\x20payout\x20statistics...','\x20to\x20','all','\x20\x20\x20ðŸ‘¤\x20Merchant\x20earnings:\x20','ðŸ”\x20Creating\x20payout\x20with\x20data:','wallets','disableAdmin2FA','ðŸ”„\x20Updating\x20customer\x20data\x20for\x20payment\x20','\x20for\x20shop\x20','ðŸ“Š\x20Statistics\x20PAID\x20payments\x20count:\x20','16357SKfkgb','\x20\x20\x20Final\x20payout\x20amount\x20used:\x20','TrapaPay\x20Admin\x20(','ðŸ“…\x20Period:\x20','Payout\x20not\x20found','AmPay','yesterday','âœ…\x20Payout\x20created:\x20','usdcPolygonWallet','getGatewayInternalName','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','ðŸ“Š\x20Merchant\x20statistics\x20calculated:','totalCommissionRate','merchantUrl','__importDefault','ðŸ“Š\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','Rapyd','ðŸ”\x20[','\x20->\x20','amount','cointopay','182987RelhWO','\x20\x20\x20Gateway:\x20','averageCommissionRate','getGatewayNameById','ru-RU','push','amountAfterGatewayCommissionUSDT','getMerchantStatistics','groupBy','\x27\x20->\x20name\x20\x27','name','totalTurnover','replace','date','./gatewaySettingsService','\x20USDT\x20(+','getAllPayments','customerEmail','lte','\x20\x20\x20ðŸ“…\x20This\x20month:\x20','then','fullName','UTC','\x20merchants','successUrl','split','parse','existsSync','2FA\x20not\x20set\x20up.\x20Please\x20call\x20setup\x20endpoint\x20first','failureMessage','\x20\x20\x20Full\x20amount:\x20','\x20\x20\x20â³\x20Pending\x20payout:\x20','totalPaidOut','ðŸ”\x20Selected\x20erc20\x20wallet:\x20','findMany','merchantEarningsUSDT','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','get','getOwnPropertyNames','last_week','2485528EbAIUT','enable2FA','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','ADMIN_2FA_ENABLED=false','getSystemStatistics','ðŸ”\x20Selected\x20trc20\x20wallet:\x20','activateUser','ðŸ”\x20Using\x20gateway\x20\x27','createPayout','erc20_usdc','admin','abs','ðŸ“Š\x20Generated\x20reports\x20for\x20','paidAt','generateDailyStatistics','\x20payments)','EXPIRED','2094324Ctfrww','hash','getUserById','gte','toLocaleDateString','test_gateway','externalPaymentUrl','turnoverUSDT','getAllPayouts','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','utf8','length','usdtErcWallet','\x20USDT\x20(','getDate','TrapaPay','\x20order','shopUrl3','update','ðŸ”\x20Admin\x202FA\x20enabled','setup2FA','cwd','forEach','CRYPTO','\x27\x20(from\x20\x27','âš ï¸\x20Requested\x20gateway\x20\x27','âœ…\x20Using\x20wallet\x20from\x20request:\x20','payment','balance','ðŸ“Š\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','ðŸ“Š\x20Sorting\x20payments\x20by\x20','\x20\x20\x20ðŸ’°\x20Total\x20payments\x20turnover:\x20','sort','stringify','ðŸ“Š\x20Total\x20payments\x20(including\x20failed):\x20','writeFileSync','\x20USDC\x20to\x20merchant\x20','gateways','getPayoutReports','year','NONEXISTENT_GATEWAY_FILTER','getFullYear','orderId','ðŸ“…\x20Payout\x20date\x20from\x20filter:\x20','\x20\x20\x20ðŸ’°\x20Total\x20payout:\x20','10xZJGdp','\x20\x20\x20ðŸ’¸\x20Total\x20payouts\x20(all\x20time):\x20','pendingUrl','merchantUrl3','\x20paid\x20payments\x20for\x20analysis','ADMIN_BACKUP_CODES=','qrcode','ðŸ”\x20Total\x20payments\x20matching\x20filters:\x20','\x20\x20\x20Requested\x20(number):\x20','telegram','%\x20commission)','\x20\x20\x20Merchant\x20gets:\x20','ðŸ“Š\x20Available\x20gateways\x20in\x20database:','amountAfterCommissionUSDT','ðŸ“Š\x20Getting\x20payments\x20with\x20filters:','\x20\x20\x20Transaction\x20hash:\x20','COMPLETED','sk_','Sepa','\x20USDT,\x20Required:\x20','ðŸ“Š\x20Using\x20saved\x20values\x20for\x20payment\x20','ADMIN_2FA_ENABLED=true','2FA\x20token\x20is\x20required','usdcErcWallet','dateFrom','\x20\x20\x20ðŸŒ\x20Country:\x20',']\x20Gateway\x20settings\x20JSON\x20string:','ðŸ’±\x20Currency\x20filter\x20applied:\x20','noda','defineProperty','telegramBotService','20770qBnfYi','MaxPara','erc20','ðŸ’°\x20[PAYOUT]\x20Merchant\x20','shopUrl2','crypto','warn','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','212445WsjgeA','statusChangedAt','currency','username','getAllUsers','ACTIVE','Current\x20password\x20is\x20incorrect','availableBalance','ðŸ”\x20Admin\x20password\x20changed\x20successfully','\x20\x20\x20âœ…\x20Actual\x20available\x20balance:\x20','Username\x20already\x20exists','_sum','âŒ\x20Failed\x20to\x20send\x20Telegram\x20notification\x20for\x20payout\x20','pk_','\x20\x20\x20ðŸ¤”\x20Difference:\x20','KLYME\x20GB','ðŸ“Š\x20Statistics\x20date\x20range:\x20','getUTCDay','join','KLYME\x20EU','KLYME\x20DE','4TYXbwp','\x20\x20\x20ðŸ”\x20Calculated\x20after\x20commission:\x20','dailyPayments','from','chargebackAmount','\x20\x20\x20Current\x20amount:\x20','randomBytes','âœ…\x20Using\x20gateway\x20filter:\x20\x27','aggregate','has','PAID'];a53_0x1b88=function(){return _0xdbaf05;};return a53_0x1b88();}const database_1=__importDefault(require(a53_0x3f9d8e(0x2d7))),bcryptjs_1=__importDefault(require(a53_0x3f9d8e(0x2b7))),crypto_1=__importDefault(require(a53_0x3f9d8e(0x27f))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path')),speakeasy_1=__importDefault(require('speakeasy')),qrcode_1=__importDefault(require(a53_0x3f9d8e(0x261))),config_1=require('../config/config'),currencyService_1=require(a53_0x3f9d8e(0x2bf)),telegramBotService_1=require('./telegramBotService'),gateway_1=require(a53_0x3f9d8e(0x2c0));function a53_0x1d06(_0x2fb9fa,_0x23f4be){_0x2fb9fa=_0x2fb9fa-0x137;const _0x1b8863=a53_0x1b88();let _0x1d064a=_0x1b8863[_0x2fb9fa];return _0x1d064a;}class AdminService{async[a53_0x3f9d8e(0x17a)](){const _0xa3cb73=a53_0x3f9d8e;console[_0xa3cb73(0x18c)](_0xa3cb73(0x1d6));const _0x2fefe4=await database_1['default']['shop']['aggregate']({'_sum':{'balance':!![],'totalPaidOut':!![]}}),_0x48208d=await database_1[_0xa3cb73(0x194)][_0xa3cb73(0x249)][_0xa3cb73(0x1af)]({'where':{'status':'PAID','gateway':{'not':'test_gateway'}}}),_0x387899=new Date(),_0x46b701=new Date(_0x387899[_0xa3cb73(0x257)](),_0x387899[_0xa3cb73(0x2b4)](),0x1),_0x1bf3d6=new Date(_0x387899['getFullYear'](),_0x387899[_0xa3cb73(0x2b4)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x5e77ed=await database_1['default'][_0xa3cb73(0x1aa)]['aggregate']({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x46b701,'lte':_0x1bf3d6},'status':_0xa3cb73(0x26b)}}),_0x3edb81=_0x2fefe4[_0xa3cb73(0x28d)][_0xa3cb73(0x215)]||0x0,_0x1d7011=_0x2fefe4[_0xa3cb73(0x28d)][_0xa3cb73(0x24a)]||0x0,_0x225b9f=_0x5e77ed[_0xa3cb73(0x28d)][_0xa3cb73(0x1f3)]||0x0,_0x35fa3e={'totalPayout':Math[_0xa3cb73(0x2de)](_0x3edb81*0x64)/0x64,'awaitingPayout':Math[_0xa3cb73(0x2de)](_0x1d7011*0x64)/0x64,'thisMonth':Math[_0xa3cb73(0x2de)](_0x225b9f*0x64)/0x64,'availableBalance':Math[_0xa3cb73(0x2de)](_0x1d7011*0x64)/0x64,'totalPayments':_0x48208d};return console[_0xa3cb73(0x18c)](_0xa3cb73(0x19a)),console[_0xa3cb73(0x18c)](_0xa3cb73(0x25a)+_0x35fa3e['totalPayout']+_0xa3cb73(0x15c)),console[_0xa3cb73(0x18c)](_0xa3cb73(0x2bb)+_0x35fa3e[_0xa3cb73(0x159)]+'\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)'),console[_0xa3cb73(0x18c)](_0xa3cb73(0x1cc)+_0x35fa3e[_0xa3cb73(0x289)]+'\x20USDT\x20(same\x20as\x20awaiting)'),console[_0xa3cb73(0x18c)](_0xa3cb73(0x208)+_0x35fa3e[_0xa3cb73(0x307)]+_0xa3cb73(0x2b0)),console[_0xa3cb73(0x18c)](_0xa3cb73(0x1d5)+_0x35fa3e['totalPayments']+_0xa3cb73(0x1b8)),_0x35fa3e;}async[a53_0x3f9d8e(0x2fe)](_0x3bbbb5,_0x330b96){const _0x24e0cb=a53_0x3f9d8e;console[_0x24e0cb(0x18c)](_0x24e0cb(0x1dd)+_0x3bbbb5+':',_0x330b96);const _0x5a2164=await database_1[_0x24e0cb(0x194)][_0x24e0cb(0x249)][_0x24e0cb(0x2aa)]({'where':{'id':_0x3bbbb5},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x5a2164)throw new Error(_0x24e0cb(0x2f6));const _0x384b78={};_0x330b96[_0x24e0cb(0x17b)]!==undefined&&(_0x384b78[_0x24e0cb(0x17b)]=_0x330b96['customerCountry']||null);_0x330b96[_0x24e0cb(0x141)]!==undefined&&(_0x384b78['customerIp']=_0x330b96[_0x24e0cb(0x141)]||null);_0x330b96[_0x24e0cb(0x1c9)]!==undefined&&(_0x384b78[_0x24e0cb(0x1c9)]=_0x330b96[_0x24e0cb(0x1c9)]||null);const _0x36b65e=await database_1[_0x24e0cb(0x194)][_0x24e0cb(0x249)][_0x24e0cb(0x240)]({'where':{'id':_0x3bbbb5},'data':{..._0x384b78,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x24e0cb(0x18c)](_0x24e0cb(0x2c9)+_0x3bbbb5),console[_0x24e0cb(0x18c)](_0x24e0cb(0x274)+_0x5a2164[_0x24e0cb(0x17b)]+_0x24e0cb(0x1f2)+_0x36b65e[_0x24e0cb(0x17b)]),console[_0x24e0cb(0x18c)](_0x24e0cb(0x198)+_0x5a2164['customerIp']+_0x24e0cb(0x1f2)+_0x36b65e[_0x24e0cb(0x141)]),console['log'](_0x24e0cb(0x15f)+(_0x5a2164['customerUa']?_0x24e0cb(0x142):_0x24e0cb(0x1bf))+_0x24e0cb(0x1f2)+(_0x36b65e[_0x24e0cb(0x1c9)]?_0x24e0cb(0x142):_0x24e0cb(0x1bf))),_0x36b65e;}async[a53_0x3f9d8e(0x221)](_0x31b654,_0x320974){const _0x4d7e0a=a53_0x3f9d8e,_0x3cadb6=_0x320974?new Date(_0x320974):new Date();let _0x13f7fa,_0xed111b;if(_0x31b654[_0x4d7e0a(0x161)](_0x4d7e0a(0x1c0))){const _0x316605=_0x31b654[_0x4d7e0a(0x201)](_0x4d7e0a(0x1c0),'')[_0x4d7e0a(0x20e)]('_');if(_0x316605[_0x4d7e0a(0x239)]===0x2){const _0x2fd2a9=new Date(_0x316605[0x0]),_0x338f3f=new Date(_0x316605[0x1]);_0x13f7fa=new Date(Date[_0x4d7e0a(0x20b)](_0x2fd2a9['getUTCFullYear'](),_0x2fd2a9[_0x4d7e0a(0x151)](),_0x2fd2a9[_0x4d7e0a(0x193)](),0x0,0x0,0x0,0x0)),_0xed111b=new Date(Date[_0x4d7e0a(0x20b)](_0x338f3f[_0x4d7e0a(0x2eb)](),_0x338f3f[_0x4d7e0a(0x151)](),_0x338f3f[_0x4d7e0a(0x193)](),0x17,0x3b,0x3b,0x3e7));}else{const _0x36d362=new Date(Date['UTC'](_0x3cadb6[_0x4d7e0a(0x2eb)](),_0x3cadb6[_0x4d7e0a(0x151)](),_0x3cadb6['getUTCDate']()-0x1e));_0x13f7fa=new Date(Date[_0x4d7e0a(0x20b)](_0x36d362[_0x4d7e0a(0x2eb)](),_0x36d362[_0x4d7e0a(0x151)](),_0x36d362['getUTCDate'](),0x0,0x0,0x0,0x0)),_0xed111b=new Date(Date['UTC'](_0x3cadb6[_0x4d7e0a(0x2eb)](),_0x3cadb6['getUTCMonth'](),_0x3cadb6[_0x4d7e0a(0x193)](),0x17,0x3b,0x3b,0x3e7));}}else{switch(_0x31b654[_0x4d7e0a(0x2fa)]()){case'today':_0x13f7fa=new Date(Date[_0x4d7e0a(0x20b)](_0x3cadb6['getUTCFullYear'](),_0x3cadb6['getUTCMonth'](),_0x3cadb6[_0x4d7e0a(0x193)](),0x0,0x0,0x0,0x0)),_0xed111b=new Date(Date[_0x4d7e0a(0x20b)](_0x3cadb6[_0x4d7e0a(0x2eb)](),_0x3cadb6[_0x4d7e0a(0x151)](),_0x3cadb6['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case _0x4d7e0a(0x1e6):const _0x2c37e3=new Date(_0x3cadb6);_0x2c37e3['setUTCDate'](_0x2c37e3[_0x4d7e0a(0x193)]()-0x1),_0x13f7fa=new Date(Date['UTC'](_0x2c37e3[_0x4d7e0a(0x2eb)](),_0x2c37e3[_0x4d7e0a(0x151)](),_0x2c37e3['getUTCDate'](),0x0,0x0,0x0,0x0)),_0xed111b=new Date(Date[_0x4d7e0a(0x20b)](_0x2c37e3[_0x4d7e0a(0x2eb)](),_0x2c37e3[_0x4d7e0a(0x151)](),_0x2c37e3[_0x4d7e0a(0x193)](),0x17,0x3b,0x3b,0x3e7));break;case'this_week':const _0x2f6487=_0x3cadb6[_0x4d7e0a(0x293)](),_0x49704a=_0x2f6487===0x0?-0x6:0x1-_0x2f6487,_0x5cd11a=_0x3cadb6[_0x4d7e0a(0x193)]()+_0x49704a;_0x13f7fa=new Date(Date[_0x4d7e0a(0x20b)](_0x3cadb6['getUTCFullYear'](),_0x3cadb6[_0x4d7e0a(0x151)](),_0x5cd11a,0x0,0x0,0x0,0x0)),_0xed111b=new Date(Date[_0x4d7e0a(0x20b)](_0x3cadb6[_0x4d7e0a(0x2eb)](),_0x3cadb6[_0x4d7e0a(0x151)](),_0x3cadb6[_0x4d7e0a(0x193)](),0x17,0x3b,0x3b,0x3e7));break;case _0x4d7e0a(0x21c):const _0x41db16=new Date(Date[_0x4d7e0a(0x20b)](_0x3cadb6['getUTCFullYear'](),_0x3cadb6[_0x4d7e0a(0x151)](),_0x3cadb6[_0x4d7e0a(0x193)]()-0x7)),_0x523005=_0x41db16[_0x4d7e0a(0x293)](),_0x6dd364=_0x523005===0x0?-0x6:0x1-_0x523005,_0x20c220=_0x41db16[_0x4d7e0a(0x193)]()+_0x6dd364;_0x13f7fa=new Date(Date[_0x4d7e0a(0x20b)](_0x41db16[_0x4d7e0a(0x2eb)](),_0x41db16[_0x4d7e0a(0x151)](),_0x20c220,0x0,0x0,0x0,0x0)),_0xed111b=new Date(Date[_0x4d7e0a(0x20b)](_0x41db16[_0x4d7e0a(0x2eb)](),_0x41db16[_0x4d7e0a(0x151)](),_0x20c220+0x6,0x17,0x3b,0x3b,0x3e7));break;case'this_month':_0x13f7fa=new Date(Date[_0x4d7e0a(0x20b)](_0x3cadb6['getUTCFullYear'](),_0x3cadb6[_0x4d7e0a(0x151)](),0x1,0x0,0x0,0x0,0x0)),_0xed111b=new Date(Date[_0x4d7e0a(0x20b)](_0x3cadb6[_0x4d7e0a(0x2eb)](),_0x3cadb6['getUTCMonth'](),_0x3cadb6[_0x4d7e0a(0x193)](),0x17,0x3b,0x3b,0x3e7));break;case _0x4d7e0a(0x2e3):_0x13f7fa=new Date(Date[_0x4d7e0a(0x20b)](_0x3cadb6[_0x4d7e0a(0x2eb)](),_0x3cadb6[_0x4d7e0a(0x151)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0xed111b=new Date(Date[_0x4d7e0a(0x20b)](_0x3cadb6[_0x4d7e0a(0x2eb)](),_0x3cadb6['getUTCMonth'](),0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x4d7e0a(0x17f):_0x13f7fa=new Date(Date['UTC'](0x7e9,0x5,0xe,0x0,0x0,0x0,0x0)),_0xed111b=new Date(Date[_0x4d7e0a(0x20b)](_0x3cadb6[_0x4d7e0a(0x2eb)](),_0x3cadb6[_0x4d7e0a(0x151)](),_0x3cadb6[_0x4d7e0a(0x193)](),0x17,0x3b,0x3b,0x3e7));break;default:_0x13f7fa=new Date(_0x3cadb6[_0x4d7e0a(0x1b1)]()-0x1e*0x18*0x3c*0x3c*0x3e8);const _0x48a004=new Date(Date['UTC'](_0x3cadb6[_0x4d7e0a(0x2eb)](),_0x3cadb6[_0x4d7e0a(0x151)](),_0x3cadb6['getUTCDate']()-0x1e));_0x13f7fa=new Date(Date[_0x4d7e0a(0x20b)](_0x48a004[_0x4d7e0a(0x2eb)](),_0x48a004[_0x4d7e0a(0x151)](),_0x48a004[_0x4d7e0a(0x193)](),0x0,0x0,0x0,0x0)),_0xed111b=new Date(Date[_0x4d7e0a(0x20b)](_0x3cadb6[_0x4d7e0a(0x2eb)](),_0x3cadb6[_0x4d7e0a(0x151)](),_0x3cadb6[_0x4d7e0a(0x193)](),0x17,0x3b,0x3b,0x3e7));}const _0x15c27c={'gte':_0x13f7fa,'lte':_0xed111b};console[_0x4d7e0a(0x18c)](_0x4d7e0a(0x292)+_0x13f7fa[_0x4d7e0a(0x309)]()+_0x4d7e0a(0x1d7)+_0xed111b[_0x4d7e0a(0x309)]());const [_0x279832,_0x356b9c,_0x500f73,_0x41c219,_0x39ba99,_0x3f9ae6,_0x4e07a4,_0x4afb6e,_0x2497db]=await Promise[_0x4d7e0a(0x1d8)]([database_1[_0x4d7e0a(0x194)][_0x4d7e0a(0x13c)]['count'](),database_1[_0x4d7e0a(0x194)]['shop'][_0x4d7e0a(0x1af)]({'where':{'status':_0x4d7e0a(0x287)}}),database_1['default']['payment'][_0x4d7e0a(0x1af)]({'where':{'status':_0x4d7e0a(0x2a1),'createdAt':_0x15c27c,'gateway':{'not':_0x4d7e0a(0x233)}}}),database_1['default']['payment']['count']({'where':{'status':_0x4d7e0a(0x2b3),'createdAt':_0x15c27c,'gateway':{'not':_0x4d7e0a(0x233)}}}),database_1[_0x4d7e0a(0x194)][_0x4d7e0a(0x249)][_0x4d7e0a(0x1af)]({'where':{'status':_0x4d7e0a(0x2f4),'createdAt':_0x15c27c,'gateway':{'not':_0x4d7e0a(0x233)}}}),database_1['default'][_0x4d7e0a(0x249)][_0x4d7e0a(0x217)]({'where':{'status':_0x4d7e0a(0x2a1),'createdAt':_0x15c27c,'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gateway':!![]}}),database_1[_0x4d7e0a(0x194)][_0x4d7e0a(0x249)][_0x4d7e0a(0x217)]({'where':{'gateway':{'not':_0x4d7e0a(0x233)}},'take':0xa,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x4d7e0a(0x194)][_0x4d7e0a(0x249)][_0x4d7e0a(0x217)]({'where':{'createdAt':_0x15c27c,'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x4d7e0a(0x194)][_0x4d7e0a(0x249)][_0x4d7e0a(0x217)]({'where':{'status':_0x4d7e0a(0x2a1),'gateway':{'not':_0x4d7e0a(0x233)}},'select':{'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gateway':!![]}})]);console[_0x4d7e0a(0x18c)](_0x4d7e0a(0x1df)+_0x500f73);let _0x2f0dca=0x0,_0x505d8e=0x0;for(const _0x26d290 of _0x3f9ae6){const _0x2b8be9=_0x26d290['amountUSDT']||0x0;_0x2f0dca+=_0x2b8be9;if(_0x26d290['amountAfterGatewayCommissionUSDT']&&_0x26d290['amountUSDT']){const _0x3e4d3a=_0x26d290[_0x4d7e0a(0x145)]-_0x26d290['amountAfterGatewayCommissionUSDT'];_0x505d8e+=_0x3e4d3a;}}const {gatewaySettingsService:_0x182f01}=await Promise[_0x4d7e0a(0x196)]()[_0x4d7e0a(0x209)](()=>__importStar(require(_0x4d7e0a(0x203)))),{getGatewayIdByName:_0x40e83b}=await Promise[_0x4d7e0a(0x196)]()[_0x4d7e0a(0x209)](()=>__importStar(require(_0x4d7e0a(0x2c0))));let _0x11e2d2=0x0;for(const _0x1e9ba0 of _0x3f9ae6){const _0x3bf48f=_0x40e83b(_0x1e9ba0[_0x4d7e0a(0x1c5)]);if(_0x3bf48f){const _0x1b2b2f=_0x182f01[_0x4d7e0a(0x2c3)](_0x3bf48f),_0x9c9a9f=_0x1b2b2f?.[_0x4d7e0a(0x2c5)]||0x0,_0x444c35=_0x1e9ba0[_0x4d7e0a(0x145)]||0x0,_0x49b5aa=_0x444c35*(_0x9c9a9f/0x64);_0x11e2d2+=_0x49b5aa;}}_0x505d8e-=_0x11e2d2;let _0x1ca766=0x0,_0x5537cd=0x0;for(const _0x18e56c of _0x2497db){if(_0x18e56c[_0x4d7e0a(0x1fb)]&&_0x18e56c[_0x4d7e0a(0x145)]){const _0x5da222=_0x18e56c[_0x4d7e0a(0x145)]-_0x18e56c[_0x4d7e0a(0x1fb)];_0x1ca766+=_0x5da222;}const _0x2a27bd=_0x40e83b(_0x18e56c[_0x4d7e0a(0x1c5)]);if(_0x2a27bd){const _0x2cdefc=_0x182f01[_0x4d7e0a(0x2c3)](_0x2a27bd),_0x378e36=_0x2cdefc?.[_0x4d7e0a(0x2c5)]||0x0,_0x382b40=_0x18e56c[_0x4d7e0a(0x145)]||0x0,_0x408ff4=_0x382b40*(_0x378e36/0x64);_0x5537cd+=_0x408ff4;}}_0x1ca766-=_0x5537cd;const _0x31d1d0=_0x500f73>0x0?_0x2f0dca/_0x500f73:0x0,_0x582c73=this[_0x4d7e0a(0x22b)](_0x4afb6e,_0x13f7fa,_0xed111b),_0x55f0ae=await database_1[_0x4d7e0a(0x194)][_0x4d7e0a(0x249)][_0x4d7e0a(0x1af)]({'where':{'createdAt':_0x15c27c,'gateway':{'not':_0x4d7e0a(0x233)},'status':{'notIn':[_0x4d7e0a(0x315),_0x4d7e0a(0x22d)]}}}),_0x220263=_0x55f0ae>0x0?_0x500f73/_0x55f0ae*0x64:0x0;return{'totalShops':_0x279832,'activeShops':_0x356b9c,'totalPayments':_0x55f0ae,'successfulPayments':_0x500f73,'totalAttempts':_0x55f0ae,'chargebacks':_0x41c219,'refunds':_0x39ba99,'totalRevenue':Math['round'](_0x2f0dca*0x64)/0x64,'trapayEarnings':Math[_0x4d7e0a(0x2de)](_0x505d8e*0x64)/0x64,'trapayEarningsAllTime':Math[_0x4d7e0a(0x2de)](_0x1ca766*0x64)/0x64,'averagePaymentAmount':Math[_0x4d7e0a(0x2de)](_0x31d1d0*0x64)/0x64,'conversionRate':Math['round'](_0x220263*0x64)/0x64,'dailyRevenue':_0x582c73['dailyRevenue'],'dailyPayments':_0x582c73[_0x4d7e0a(0x299)],'recentPayments':_0x4e07a4[_0x4d7e0a(0x2bc)](_0x297864=>({'id':_0x297864['id'],'amount':_0x297864[_0x4d7e0a(0x1f3)],'currency':_0x297864[_0x4d7e0a(0x284)],'status':_0x297864[_0x4d7e0a(0x1a5)],'gateway':_0x297864['gateway'],'shop':_0x297864['shop'],'createdAt':_0x297864[_0x4d7e0a(0x316)]}))};}}async[a53_0x3f9d8e(0x1fc)](_0x349ddb){const _0x1ff4a4=a53_0x3f9d8e;console[_0x1ff4a4(0x18c)](_0x1ff4a4(0x300),_0x349ddb);let _0x1e86c0,_0xd95233=new Date();if(_0x349ddb[_0x1ff4a4(0x30a)]===_0x1ff4a4(0x1c3)&&_0x349ddb['dateFrom']&&_0x349ddb['dateTo']){const _0x408872=new Date(_0x349ddb[_0x1ff4a4(0x273)]),_0xe7470e=new Date(_0x349ddb['dateTo']);_0x1e86c0=new Date(Date[_0x1ff4a4(0x20b)](_0x408872[_0x1ff4a4(0x2eb)](),_0x408872[_0x1ff4a4(0x151)](),_0x408872['getUTCDate'](),0x0,0x0,0x0,0x0)),_0xd95233=new Date(Date[_0x1ff4a4(0x20b)](_0xe7470e[_0x1ff4a4(0x2eb)](),_0xe7470e[_0x1ff4a4(0x151)](),_0xe7470e[_0x1ff4a4(0x193)](),0x17,0x3b,0x3b,0x3e7));}else{const _0x166b36=new Date();switch(_0x349ddb['period']){case'week':_0x1e86c0=new Date(_0x166b36[_0x1ff4a4(0x1b1)]()-0x7*0x18*0x3c*0x3c*0x3e8),_0x1e86c0[_0x1ff4a4(0x157)](0x0,0x0,0x0,0x0),_0xd95233[_0x1ff4a4(0x157)](0x17,0x3b,0x3b,0x3e7);break;case _0x1ff4a4(0x2ae):_0x1e86c0=new Date(Date[_0x1ff4a4(0x20b)](_0x166b36['getUTCFullYear'](),_0x166b36[_0x1ff4a4(0x151)](),0x1,0x0,0x0,0x0,0x0)),_0xd95233=new Date(Date[_0x1ff4a4(0x20b)](_0x166b36['getUTCFullYear'](),_0x166b36[_0x1ff4a4(0x151)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x1ff4a4(0x2a6):_0x1e86c0=new Date(Date[_0x1ff4a4(0x20b)](_0x166b36['getUTCFullYear'](),_0x166b36['getUTCMonth']()-0x1,0x1,0x0,0x0,0x0,0x0)),_0xd95233=new Date(Date[_0x1ff4a4(0x20b)](_0x166b36[_0x1ff4a4(0x2eb)](),_0x166b36[_0x1ff4a4(0x151)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x1ff4a4(0x255):_0x1e86c0=new Date(_0x166b36[_0x1ff4a4(0x1b1)]()-0x16d*0x18*0x3c*0x3c*0x3e8),_0x1e86c0[_0x1ff4a4(0x157)](0x0,0x0,0x0,0x0),_0xd95233[_0x1ff4a4(0x157)](0x17,0x3b,0x3b,0x3e7);break;case _0x1ff4a4(0x1d8):default:_0x1e86c0=new Date('2020-01-01'),_0x1e86c0[_0x1ff4a4(0x157)](0x0,0x0,0x0,0x0),_0xd95233[_0x1ff4a4(0x157)](0x17,0x3b,0x3b,0x3e7);break;}}console['log'](_0x1ff4a4(0x1e3)+_0x1e86c0[_0x1ff4a4(0x309)]()+'\x20to\x20'+_0xd95233['toISOString']());const _0x38860={'status':_0x1ff4a4(0x2a1),'gateway':{'not':_0x1ff4a4(0x233)},'createdAt':{'gte':_0x1e86c0,'lte':_0xd95233}};_0x349ddb[_0x1ff4a4(0x17c)]&&(_0x38860[_0x1ff4a4(0x17c)]=_0x349ddb['shopId']);const _0x4cadcd=await database_1[_0x1ff4a4(0x194)]['payment']['findMany']({'where':_0x38860,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x1ff4a4(0x18c)](_0x1ff4a4(0x16b)+_0x4cadcd[_0x1ff4a4(0x239)]+_0x1ff4a4(0x25f));const _0x5ccc6c={'gateway':{'not':_0x1ff4a4(0x233)},'status':{'notIn':[_0x1ff4a4(0x315),_0x1ff4a4(0x22d)]},'createdAt':{'gte':_0x1e86c0,'lte':_0xd95233}};_0x349ddb[_0x1ff4a4(0x17c)]&&(_0x5ccc6c[_0x1ff4a4(0x17c)]=_0x349ddb[_0x1ff4a4(0x17c)]);const _0x2710a4=await database_1[_0x1ff4a4(0x194)][_0x1ff4a4(0x249)][_0x1ff4a4(0x1af)]({'where':_0x5ccc6c}),_0x5f029a={..._0x5ccc6c,'status':_0x1ff4a4(0x2b3)},_0x5230ab={..._0x5ccc6c,'status':_0x1ff4a4(0x2f4)},[_0x1d5e83,_0x44696d]=await Promise[_0x1ff4a4(0x1d8)]([database_1[_0x1ff4a4(0x194)][_0x1ff4a4(0x249)][_0x1ff4a4(0x1af)]({'where':_0x5f029a}),database_1[_0x1ff4a4(0x194)][_0x1ff4a4(0x249)][_0x1ff4a4(0x1af)]({'where':_0x5230ab})]);console[_0x1ff4a4(0x18c)](_0x1ff4a4(0x250)+_0x2710a4+',\x20successful:\x20'+_0x4cadcd['length']+_0x1ff4a4(0x2b9)+_0x1d5e83+_0x1ff4a4(0x19b)+_0x44696d);let _0x429162=0x0,_0x1bbd16=0x0,_0x323211=0x0;const _0x56a950={},_0x2d3661={},_0x2118fb={},_0x5171e9=new Date(_0x1e86c0);while(_0x5171e9<=_0xd95233){const _0x236101=_0x5171e9[_0x1ff4a4(0x309)]()[_0x1ff4a4(0x20e)]('T')[0x0];_0x2118fb[_0x236101]={'date':_0x236101,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0},_0x5171e9[_0x1ff4a4(0x187)](_0x5171e9[_0x1ff4a4(0x193)]()+0x1);}for(const _0x1b7282 of _0x4cadcd){try{const _0x6aab0e=_0x1b7282[_0x1ff4a4(0x145)]||0x0;if(_0x6aab0e<=0x0){console[_0x1ff4a4(0x280)](_0x1ff4a4(0x2ca)+_0x1b7282['id']+_0x1ff4a4(0x1ad));continue;}let _0x277de2,_0x1ada1f;if(_0x1b7282[_0x1ff4a4(0x1fb)]!==null&&_0x1b7282[_0x1ff4a4(0x1fb)]!==undefined)_0x277de2=_0x1b7282[_0x1ff4a4(0x1fb)],_0x1ada1f=_0x6aab0e-_0x277de2,console[_0x1ff4a4(0x18c)](_0x1ff4a4(0x26f)+_0x1b7282['id']+':\x20'+_0x6aab0e['toFixed'](0x6)+_0x1ff4a4(0x1c7)+_0x277de2['toFixed'](0x6)+_0x1ff4a4(0x2b0));else{let _0x423a4f={};if(_0x1b7282[_0x1ff4a4(0x13c)][_0x1ff4a4(0x1c6)])try{_0x423a4f=JSON[_0x1ff4a4(0x20f)](_0x1b7282[_0x1ff4a4(0x13c)][_0x1ff4a4(0x1c6)]);}catch(_0x3a6c75){console['error']('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x1b7282[_0x1ff4a4(0x17c)]+':',_0x3a6c75);}let _0x1a18ea=0x2d;for(const [_0x3cc0bc,_0xd45543]of Object['entries'](_0x423a4f)){if(_0x3cc0bc['toLowerCase']()===_0x1b7282[_0x1ff4a4(0x1c5)][_0x1ff4a4(0x2fa)]()){_0x1a18ea=_0xd45543['commission']||0x2d;break;}}_0x1ada1f=_0x6aab0e*(_0x1a18ea/0x64),_0x277de2=_0x6aab0e-_0x1ada1f,console[_0x1ff4a4(0x18c)]('ðŸ“Š\x20Calculating\x20commission\x20manually\x20for\x20payment\x20'+_0x1b7282['id']+':\x20'+_0x1a18ea+'%\x20from\x20'+_0x6aab0e['toFixed'](0x6)+_0x1ff4a4(0x2b0));}_0x429162+=_0x6aab0e,_0x1bbd16+=_0x277de2,_0x323211+=_0x1ada1f;let _0x2f96fb;_0x1b7282[_0x1ff4a4(0x168)]!==null&&_0x1b7282[_0x1ff4a4(0x168)]!==undefined?(_0x2f96fb=_0x1b7282['gatewayCommissionRate'],console[_0x1ff4a4(0x18c)](_0x1ff4a4(0x183)+_0x1b7282['id']+':\x20'+_0x2f96fb+'%')):(_0x2f96fb=_0x6aab0e>0x0?_0x1ada1f/_0x6aab0e*0x64:0x0,console[_0x1ff4a4(0x18c)]('ðŸ“Š\x20Calculated\x20commission\x20rate\x20for\x20payment\x20'+_0x1b7282['id']+':\x20'+_0x2f96fb['toFixed'](0x2)+'%'));!_0x56a950[_0x1b7282[_0x1ff4a4(0x1c5)]]&&(_0x56a950[_0x1b7282[_0x1ff4a4(0x1c5)]]={'gateway':_0x1b7282[_0x1ff4a4(0x1c5)],'gatewayDisplayName':this[_0x1ff4a4(0x15d)](_0x1b7282[_0x1ff4a4(0x1c5)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x56a950[_0x1b7282[_0x1ff4a4(0x1c5)]][_0x1ff4a4(0x2ea)]++,_0x56a950[_0x1b7282[_0x1ff4a4(0x1c5)]][_0x1ff4a4(0x235)]+=_0x6aab0e,_0x56a950[_0x1b7282['gateway']][_0x1ff4a4(0x2a4)]+=_0x1ada1f,_0x56a950[_0x1b7282[_0x1ff4a4(0x1c5)]][_0x1ff4a4(0x218)]+=_0x277de2,_0x56a950[_0x1b7282[_0x1ff4a4(0x1c5)]][_0x1ff4a4(0x1ec)]+=_0x2f96fb;!_0x349ddb['shopId']&&(!_0x2d3661[_0x1b7282['shopId']]&&(_0x2d3661[_0x1b7282[_0x1ff4a4(0x17c)]]={'shopId':_0x1b7282[_0x1ff4a4(0x17c)],'shopName':_0x1b7282[_0x1ff4a4(0x13c)][_0x1ff4a4(0x1ff)],'shopUsername':_0x1b7282[_0x1ff4a4(0x13c)][_0x1ff4a4(0x285)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x2d3661[_0x1b7282[_0x1ff4a4(0x17c)]]['paymentsCount']++,_0x2d3661[_0x1b7282['shopId']][_0x1ff4a4(0x235)]+=_0x6aab0e,_0x2d3661[_0x1b7282[_0x1ff4a4(0x17c)]][_0x1ff4a4(0x2a4)]+=_0x1ada1f,_0x2d3661[_0x1b7282[_0x1ff4a4(0x17c)]][_0x1ff4a4(0x218)]+=_0x277de2);const _0x39698d=_0x1b7282[_0x1ff4a4(0x22a)][_0x1ff4a4(0x309)]()[_0x1ff4a4(0x20e)]('T')[0x0];_0x2118fb[_0x39698d]&&(_0x2118fb[_0x39698d][_0x1ff4a4(0x2c7)]+=_0x6aab0e,_0x2118fb[_0x39698d][_0x1ff4a4(0x314)]+=_0x277de2,_0x2118fb[_0x39698d]['gatewayEarnings']+=_0x1ada1f,_0x2118fb[_0x39698d]['paymentsCount']++);}catch(_0x17655f){console[_0x1ff4a4(0x177)](_0x1ff4a4(0x172)+_0x1b7282['id']+':',_0x17655f);}}Object['values'](_0x56a950)[_0x1ff4a4(0x244)](_0xa2893e=>{const _0xa5525c=_0x1ff4a4;_0xa2893e['averageCommissionRate']=_0xa2893e[_0xa5525c(0x2ea)]>0x0?_0xa2893e['totalCommissionRate']/_0xa2893e[_0xa5525c(0x2ea)]:0x0,delete _0xa2893e[_0xa5525c(0x1ec)];}),Object[_0x1ff4a4(0x317)](_0x2d3661)[_0x1ff4a4(0x244)](_0x2af634=>{const _0x43b89e=_0x1ff4a4;_0x2af634[_0x43b89e(0x1ba)]=_0x2af634[_0x43b89e(0x2ea)]>0x0?_0x2af634[_0x43b89e(0x235)]/_0x2af634[_0x43b89e(0x2ea)]:0x0;});let _0x54d6bb=0x0,_0x164e3d=0x0;if(_0x349ddb[_0x1ff4a4(0x17c)]){const _0x17c6dd=await database_1[_0x1ff4a4(0x194)][_0x1ff4a4(0x1aa)]['findMany']({'where':{'shopId':_0x349ddb['shopId'],'status':_0x1ff4a4(0x26b),'createdAt':{'gte':_0x1e86c0,'lte':_0xd95233}},'select':{'amount':!![]}});_0x54d6bb=_0x17c6dd['reduce']((_0x4fdf88,_0x3947b0)=>_0x4fdf88+_0x3947b0[_0x1ff4a4(0x1f3)],0x0);const _0x3114af=await database_1[_0x1ff4a4(0x194)][_0x1ff4a4(0x1aa)]['findMany']({'where':{'shopId':_0x349ddb['shopId'],'status':'PENDING','createdAt':{'gte':_0x1e86c0,'lte':_0xd95233}},'select':{'amount':!![]}});_0x164e3d=_0x3114af[_0x1ff4a4(0x2f3)]((_0x1fda2a,_0x301e45)=>_0x1fda2a+_0x301e45[_0x1ff4a4(0x1f3)],0x0);}const _0x196be8=_0x2710a4,_0x140391=_0x4cadcd[_0x1ff4a4(0x239)],_0x483ced=_0x140391>0x0?_0x429162/_0x140391:0x0,_0x190420=_0x196be8>0x0?Math[_0x1ff4a4(0x2de)](_0x140391/_0x196be8*0x2710)/0x64:0x0,_0x10fef3=Math[_0x1ff4a4(0x162)]((_0xd95233[_0x1ff4a4(0x1b1)]()-_0x1e86c0[_0x1ff4a4(0x1b1)]())/(0x3e8*0x3c*0x3c*0x18)),_0x4e9d50={'totalTurnover':Math[_0x1ff4a4(0x2de)](_0x429162*0x64)/0x64,'merchantEarnings':Math['round'](_0x1bbd16*0x64)/0x64,'gatewayEarnings':Math[_0x1ff4a4(0x2de)](_0x323211*0x64)/0x64,'totalPaidOut':Math[_0x1ff4a4(0x2de)](_0x54d6bb*0x64)/0x64,'pendingPayout':Math[_0x1ff4a4(0x2de)](_0x164e3d*0x64)/0x64,'averageCheck':Math[_0x1ff4a4(0x2de)](_0x483ced*0x64)/0x64,'totalPayments':_0x196be8,'successfulPayments':_0x140391,'conversionRate':_0x190420,'chargebacks':_0x1d5e83,'refunds':_0x44696d,'gatewayBreakdown':Object[_0x1ff4a4(0x317)](_0x56a950)[_0x1ff4a4(0x2bc)](_0x380c9=>({..._0x380c9,'turnoverUSDT':Math['round'](_0x380c9[_0x1ff4a4(0x235)]*0x64)/0x64,'commissionUSDT':Math[_0x1ff4a4(0x2de)](_0x380c9['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x1ff4a4(0x2de)](_0x380c9[_0x1ff4a4(0x218)]*0x64)/0x64,'averageCommissionRate':Math[_0x1ff4a4(0x2de)](_0x380c9[_0x1ff4a4(0x1f7)]*0x64)/0x64})),'merchantBreakdown':_0x349ddb['shopId']?undefined:Object[_0x1ff4a4(0x317)](_0x2d3661)[_0x1ff4a4(0x2bc)](_0x325b72=>({..._0x325b72,'turnoverUSDT':Math[_0x1ff4a4(0x2de)](_0x325b72[_0x1ff4a4(0x235)]*0x64)/0x64,'commissionUSDT':Math[_0x1ff4a4(0x2de)](_0x325b72['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x1ff4a4(0x2de)](_0x325b72['merchantEarningsUSDT']*0x64)/0x64,'paidOutUSDT':Math[_0x1ff4a4(0x2de)](_0x325b72[_0x1ff4a4(0x302)]*0x64)/0x64,'averageCheckUSDT':Math[_0x1ff4a4(0x2de)](_0x325b72[_0x1ff4a4(0x1ba)]*0x64)/0x64})),'dailyData':Object[_0x1ff4a4(0x317)](_0x2118fb)[_0x1ff4a4(0x2bc)](_0x13af50=>({..._0x13af50,'turnover':Math['round'](_0x13af50['turnover']*0x64)/0x64,'merchantEarnings':Math[_0x1ff4a4(0x2de)](_0x13af50[_0x1ff4a4(0x314)]*0x64)/0x64,'gatewayEarnings':Math[_0x1ff4a4(0x2de)](_0x13af50[_0x1ff4a4(0x16d)]*0x64)/0x64}))['sort']((_0x419475,_0x1f0d55)=>_0x419475['date']['localeCompare'](_0x1f0d55[_0x1ff4a4(0x202)])),'periodInfo':{'from':_0x1e86c0,'to':_0xd95233,'periodType':_0x349ddb['period']||_0x1ff4a4(0x1c3),'daysCount':_0x10fef3}};return console[_0x1ff4a4(0x18c)](_0x1ff4a4(0x1eb)),console['log'](_0x1ff4a4(0x2a9)+_0x4e9d50[_0x1ff4a4(0x200)]+'\x20USDT'),console[_0x1ff4a4(0x18c)](_0x1ff4a4(0x1d9)+_0x4e9d50['merchantEarnings']+'\x20USDT'),console[_0x1ff4a4(0x18c)](_0x1ff4a4(0x2e2)+_0x4e9d50[_0x1ff4a4(0x16d)]+_0x1ff4a4(0x2b0)),console[_0x1ff4a4(0x18c)]('\x20\x20\x20ï¿½\x20Total\x20paid\x20out:\x20'+_0x4e9d50[_0x1ff4a4(0x215)]+'\x20USDT'),console[_0x1ff4a4(0x18c)](_0x1ff4a4(0x214)+_0x4e9d50['pendingPayout']+_0x1ff4a4(0x2b0)),console[_0x1ff4a4(0x18c)]('\x20\x20\x20ï¿½ðŸ“Š\x20Total\x20payments:\x20'+_0x4e9d50['totalPayments']),_0x4e9d50;}async[a53_0x3f9d8e(0x13f)](_0x31b782){const _0x174c82=a53_0x3f9d8e;console[_0x174c82(0x18c)]('ðŸ“‹\x20Getting\x20merchants\x20selection\x20list...',{'hasPayoutHistory':_0x31b782});let _0x5cfce3={};_0x31b782&&(_0x5cfce3['payouts']={'some':{}});const _0x382aba=await database_1['default']['shop']['findMany']({'where':_0x5cfce3,'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x174c82(0x2ac)}});return console['log'](_0x174c82(0x17d)+_0x382aba[_0x174c82(0x239)]+'\x20merchants\x20for\x20selection'+(_0x31b782?'\x20with\x20payout\x20history':'')),_0x382aba[_0x174c82(0x2bc)](_0x56b53b=>({'id':_0x56b53b['id'],'username':_0x56b53b['username'],'name':_0x56b53b[_0x174c82(0x1ff)]}));}[a53_0x3f9d8e(0x15d)](_0x11c9bb){const _0x5daae5=a53_0x3f9d8e,_0x3765f1={'test_gateway':_0x5daae5(0x13e),'plisio':_0x5daae5(0x30c),'rapyd':_0x5daae5(0x1f0),'noda':_0x5daae5(0x2e4),'cointopay':'CoinToPay','cointopay2':'CoinToPay2','klyme_eu':_0x5daae5(0x295),'klyme_gb':_0x5daae5(0x291),'klyme_de':_0x5daae5(0x296),'mastercard':_0x5daae5(0x18f),'visa/mastercard':_0x5daae5(0x186),'amer':_0x5daae5(0x2d3),'myxspend':'MyXSpend','ampay':_0x5daae5(0x1e5),'ampay_try':'AmPay\x20TRY','sepa':_0x5daae5(0x26d),'interac':_0x5daae5(0x2c2),'onramp':_0x5daae5(0x2c4),'squirrelpay':'SquirrelPay','maxpara':_0x5daae5(0x27b),'instaxchange':_0x5daae5(0x2e0),'oxapay':_0x5daae5(0x173)};return _0x3765f1[_0x11c9bb]||_0x11c9bb;}[a53_0x3f9d8e(0x1e9)](_0x4b00f2){const _0x29b396=a53_0x3f9d8e,_0x29ed68={'Test\x20Gateway':'test_gateway','Plisio':'plisio','Rapyd':'rapyd','Noda':_0x29b396(0x277),'CoinToPay':_0x29b396(0x1f4),'CoinToPay2':_0x29b396(0x164),'KLYME\x20EU':'klyme_eu','KLYME\x20GB':_0x29b396(0x2dc),'KLYME\x20DE':'klyme_de','MasterCard':_0x29b396(0x2bd)};return _0x29ed68[_0x4b00f2]||_0x4b00f2[_0x29b396(0x2fa)]();}async['getMerchantsAwaitingPayout'](_0x17f7f7){const _0x194bd0=a53_0x3f9d8e,{page:_0x468c63,limit:_0x1511ba,minAmount:_0x2e40e7,search:_0xcb893d}=_0x17f7f7;console[_0x194bd0(0x18c)](_0x194bd0(0x24b),_0x17f7f7);let _0x3fdc2d={};_0xcb893d&&(_0x3fdc2d[_0x194bd0(0x1ff)]={'contains':_0xcb893d,'mode':_0x194bd0(0x137)});const _0x348191=await database_1[_0x194bd0(0x194)]['shop']['findMany']({'where':_0x3fdc2d,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),_0x10adce=_0x348191['filter'](_0x3bb156=>{const _0x3b0f4e=_0x194bd0,_0x2c55b9=Math[_0x3b0f4e(0x2d1)](_0x3bb156[_0x3b0f4e(0x24a)]*0x64)/0x64;if(_0x2e40e7&&_0x2c55b9<_0x2e40e7)return![];return _0x2c55b9!==0x0;});_0x10adce[_0x194bd0(0x24e)]((_0x322ef7,_0x15974f)=>_0x15974f[_0x194bd0(0x24a)]-_0x322ef7['balance']);const _0x33fd7b=_0x10adce[_0x194bd0(0x239)],_0x404709=(_0x468c63-0x1)*_0x1511ba,_0x2bf911=_0x10adce['slice'](_0x404709,_0x404709+_0x1511ba);console[_0x194bd0(0x18c)](_0x194bd0(0x16b)+_0x2bf911[_0x194bd0(0x239)]+'\x20merchants\x20with\x20rounded\x20balance\x20!=\x200.00\x20(excluding\x20balances\x20that\x20round\x20to\x200.00)');const _0x2758a1=await Promise[_0x194bd0(0x1d8)](_0x2bf911['map'](async _0x4a09e9=>{const _0x57ee8d=_0x194bd0,[_0x33bbaf,_0x30e35f,_0x1ef9c9]=await Promise[_0x57ee8d(0x1d8)]([database_1[_0x57ee8d(0x194)][_0x57ee8d(0x249)][_0x57ee8d(0x1af)]({'where':{'shopId':_0x4a09e9['id'],'status':_0x57ee8d(0x2a1),'gateway':{'not':_0x57ee8d(0x233)}}}),database_1['default'][_0x57ee8d(0x249)][_0x57ee8d(0x1a4)]({'where':{'shopId':_0x4a09e9['id'],'status':_0x57ee8d(0x2a1),'gateway':{'not':_0x57ee8d(0x233)}},'orderBy':{'paidAt':_0x57ee8d(0x2ac)},'select':{'paidAt':!![]}}),database_1[_0x57ee8d(0x194)][_0x57ee8d(0x249)][_0x57ee8d(0x1fd)]({'by':['gateway'],'where':{'shopId':_0x4a09e9['id'],'status':_0x57ee8d(0x2a1),'gateway':{'not':_0x57ee8d(0x233)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x3dc45d=new Date(),_0x48240f=new Date(_0x3dc45d[_0x57ee8d(0x257)](),_0x3dc45d[_0x57ee8d(0x2b4)](),0x1),_0x608816=new Date(_0x3dc45d[_0x57ee8d(0x257)](),_0x3dc45d[_0x57ee8d(0x2b4)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x5612c4,_0x44c07f]=await Promise[_0x57ee8d(0x1d8)]([database_1[_0x57ee8d(0x194)]['payout'][_0x57ee8d(0x29f)]({'_sum':{'amount':!![]},'where':{'shopId':_0x4a09e9['id'],'status':_0x57ee8d(0x26b)}}),database_1[_0x57ee8d(0x194)]['payout'][_0x57ee8d(0x29f)]({'_sum':{'amount':!![]},'where':{'shopId':_0x4a09e9['id'],'status':'COMPLETED','createdAt':{'gte':_0x48240f,'lte':_0x608816}}})]),_0x2e6225=_0x5612c4[_0x57ee8d(0x28d)][_0x57ee8d(0x1f3)]||0x0,_0x1ea821=_0x44c07f[_0x57ee8d(0x28d)]['amount']||0x0,_0x468f28=await Promise['all'](_0x1ef9c9[_0x57ee8d(0x2bc)](async _0xb435a8=>{const _0x328761=_0x57ee8d,_0x23da90=await database_1[_0x328761(0x194)][_0x328761(0x249)][_0x328761(0x217)]({'where':{'shopId':_0x4a09e9['id'],'status':'PAID','gateway':_0xb435a8['gateway']},'select':{'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![]}});let _0x4fea8f=0x2d;if(_0x4a09e9[_0x328761(0x1c6)])try{const _0x2eb930=JSON[_0x328761(0x20f)](_0x4a09e9[_0x328761(0x1c6)]);for(const [_0x1f1e2f,_0x12be2a]of Object[_0x328761(0x2e6)](_0x2eb930)){if(_0x1f1e2f[_0x328761(0x2fa)]()===_0xb435a8['gateway'][_0x328761(0x2fa)]()){_0x4fea8f=_0x12be2a[_0x328761(0x1d0)]||0xa,console[_0x328761(0x18c)](_0x328761(0x1cd)+_0xb435a8['gateway']+_0x328761(0x1de)+_0x4a09e9['id']+':\x20commission\x20=\x20'+_0x4fea8f+'%');break;}}}catch(_0x52f181){console[_0x328761(0x177)](_0x328761(0x1ea)+_0x4a09e9['id']+':',_0x52f181);}const _0x36088e=_0xb435a8[_0x328761(0x28d)]?.[_0x328761(0x145)]||0x0;let _0x2ad163=0x0;for(const _0x8358e4 of _0x23da90){if(_0x8358e4[_0x328761(0x1fb)]!==null&&_0x8358e4['amountAfterGatewayCommissionUSDT']!==undefined)_0x2ad163+=_0x8358e4[_0x328761(0x1fb)];else{const _0x45843d=_0x8358e4[_0x328761(0x145)]||0x0;_0x2ad163+=_0x45843d*(0x1-_0x4fea8f/0x64);}}return{'gateway':_0xb435a8[_0x328761(0x1c5)],'count':_0xb435a8[_0x328761(0x2d6)]?.['id']||0x0,'amountUSDT':Math[_0x328761(0x2de)](_0x36088e*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x328761(0x2de)](_0x2ad163*0x64)/0x64,'commission':_0x4fea8f};})),_0x2d4808=_0x468f28[_0x57ee8d(0x2f3)]((_0x60f9f1,_0x50bee1)=>_0x60f9f1+_0x50bee1[_0x57ee8d(0x145)],0x0),_0x11e47f=_0x468f28[_0x57ee8d(0x2f3)]((_0x168478,_0x29c463)=>_0x168478+_0x29c463[_0x57ee8d(0x268)],0x0),_0x4fbef1=_0x4a09e9['balance'];return console['log'](_0x57ee8d(0x27d)+_0x4a09e9['username']+':'),console[_0x57ee8d(0x18c)](_0x57ee8d(0x1a9)+_0x2d4808[_0x57ee8d(0x1c4)](0x2)+_0x57ee8d(0x147)),console[_0x57ee8d(0x18c)](_0x57ee8d(0x298)+_0x11e47f['toFixed'](0x2)+'\x20USDT\x20(theoretical\x20net)'),console['log'](_0x57ee8d(0x28b)+_0x4fbef1[_0x57ee8d(0x1c4)](0x2)+_0x57ee8d(0x2be)),console[_0x57ee8d(0x18c)]('\x20\x20\x20ðŸ’¸\x20Total\x20payouts:\x20'+_0x2e6225['toFixed'](0x2)+_0x57ee8d(0x1bc)),console[_0x57ee8d(0x18c)](_0x57ee8d(0x290)+(_0x11e47f-_0x2e6225-_0x4fbef1)[_0x57ee8d(0x1c4)](0x2)+_0x57ee8d(0x165)),{'id':_0x4a09e9['id'],'fullName':_0x4a09e9[_0x57ee8d(0x1ff)],'username':_0x4a09e9['username'],'telegramId':_0x4a09e9[_0x57ee8d(0x264)],'merchantUrl':_0x4a09e9[_0x57ee8d(0x2c6)],'wallets':{'usdtPolygonWallet':_0x4a09e9[_0x57ee8d(0x190)],'usdtTrcWallet':_0x4a09e9[_0x57ee8d(0x178)],'usdtErcWallet':_0x4a09e9[_0x57ee8d(0x23a)],'usdcPolygonWallet':_0x4a09e9[_0x57ee8d(0x1e8)],'usdcErcWallet':_0x4a09e9['usdcErcWallet']},'totalAmountUSDT':Math['round'](_0x2d4808*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x57ee8d(0x2de)](_0x11e47f*0x64)/0x64,'currentBalance':Math[_0x57ee8d(0x2d1)](_0x4fbef1*0x64)/0x64,'totalPayout':Math['round'](_0x2e6225*0x64)/0x64,'thisMonth':Math[_0x57ee8d(0x2de)](_0x1ea821*0x64)/0x64,'paymentsCount':_0x33bbaf,'oldestPaymentDate':_0x30e35f?.[_0x57ee8d(0x22a)]||_0x4a09e9[_0x57ee8d(0x316)],'gatewayBreakdown':_0x468f28};})),_0x219412=_0x2758a1[_0x194bd0(0x2f3)]((_0x4130ea,_0xee9899)=>_0x4130ea+_0xee9899[_0x194bd0(0x14b)],0x0),_0x3818ec=_0x2758a1[_0x194bd0(0x2f3)]((_0x55ab70,_0x3edbb2)=>_0x55ab70+_0x3edbb2[_0x194bd0(0x1b0)],0x0),_0x2f735b=_0x2758a1[_0x194bd0(0x2f3)]((_0x4ac557,_0x13a3da)=>_0x4ac557+_0x13a3da[_0x194bd0(0x16c)],0x0),_0x3604a0=_0x2758a1[_0x194bd0(0x2f3)]((_0x408ca2,_0x636b15)=>_0x408ca2+_0x636b15[_0x194bd0(0x307)],0x0);return console[_0x194bd0(0x18c)](_0x194bd0(0x2fb)+_0x33fd7b+_0x194bd0(0x20c)),console[_0x194bd0(0x18c)](_0x194bd0(0x24d)+Math[_0x194bd0(0x2de)](_0x219412*0x64)/0x64+'\x20USDT\x20(gross\x20revenue)'),console[_0x194bd0(0x18c)](_0x194bd0(0x13b)+Math['round'](_0x3818ec*0x64)/0x64+_0x194bd0(0x2ed)),console['log'](_0x194bd0(0x25c)+Math[_0x194bd0(0x2de)](_0x2f735b*0x64)/0x64+_0x194bd0(0x2b0)),console[_0x194bd0(0x18c)](_0x194bd0(0x30e)+Math['round'](_0x3604a0*0x64)/0x64+_0x194bd0(0x2b0)),{'merchants':_0x2758a1,'pagination':{'page':_0x468c63,'limit':_0x1511ba,'total':_0x33fd7b,'totalPages':Math[_0x194bd0(0x162)](_0x33fd7b/_0x1511ba)},'summary':{'totalMerchants':_0x33fd7b,'totalAmountUSDT':Math[_0x194bd0(0x2de)](_0x219412*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x3818ec*0x64)/0x64,'totalPayout':Math[_0x194bd0(0x2de)](_0x2f735b*0x64)/0x64,'thisMonth':Math[_0x194bd0(0x2de)](_0x3604a0*0x64)/0x64}};}async[a53_0x3f9d8e(0x225)](_0xd14a96){const _0x52c652=a53_0x3f9d8e,{shopId:_0x2f35c5,amount:_0x1f412c,network:_0x1cb5eb,wallet:_0x1d643a,notes:_0x7c7bff,txid:_0x3a2bf5,periodFrom:_0x4df783,periodTo:_0x126f45}=_0xd14a96,_0x2f8b16=await database_1[_0x52c652(0x194)][_0x52c652(0x2cc)](async _0x29e5e0=>{const _0x2a26c6=_0x52c652,_0x3793cc=await _0x29e5e0[_0x2a26c6(0x13c)][_0x2a26c6(0x2aa)]({'where':{'id':_0x2f35c5},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x3793cc)throw new Error(_0x2a26c6(0x148));console[_0x2a26c6(0x18c)](_0x2a26c6(0x163)+_0x3793cc[_0x2a26c6(0x285)]+':'),console[_0x2a26c6(0x18c)](_0x2a26c6(0x146)+_0x3793cc[_0x2a26c6(0x24a)][_0x2a26c6(0x1c4)](0x6)+_0x2a26c6(0x2b0)),console[_0x2a26c6(0x18c)](_0x2a26c6(0x2a5)+_0x1f412c[_0x2a26c6(0x1c4)](0x6)+_0x2a26c6(0x2b0)),console['log'](_0x2a26c6(0x2ec)+_0x3793cc[_0x2a26c6(0x215)][_0x2a26c6(0x1c4)](0x6)+'\x20USDT');if(_0x3a2bf5)console[_0x2a26c6(0x18c)](_0x2a26c6(0x26a)+_0x3a2bf5);const _0x3f69b1=0.000001,_0x44f807=Number(_0x3793cc[_0x2a26c6(0x24a)]),_0x54cc7c=Number(_0x1f412c);console[_0x2a26c6(0x18c)](_0x2a26c6(0x2b5)),console[_0x2a26c6(0x18c)]('\x20\x20\x20Available\x20(raw):\x20'+_0x3793cc[_0x2a26c6(0x24a)]),console['log'](_0x2a26c6(0x174)+_0x44f807),console['log'](_0x2a26c6(0x263)+_0x54cc7c),console[_0x2a26c6(0x18c)]('\x20\x20\x20Difference:\x20'+(_0x44f807-_0x54cc7c)),console[_0x2a26c6(0x18c)]('\x20\x20\x20Tolerance:\x20'+_0x3f69b1);if(_0x44f807<_0x54cc7c-_0x3f69b1)throw new Error(_0x2a26c6(0x2ee)+_0x44f807[_0x2a26c6(0x1c4)](0x6)+_0x2a26c6(0x1d1)+_0x54cc7c[_0x2a26c6(0x1c4)](0x6)+'\x20USDT,\x20Difference:\x20'+(_0x44f807-_0x54cc7c)[_0x2a26c6(0x1c4)](0x8)+_0x2a26c6(0x2b0));console[_0x2a26c6(0x18c)]('âœ…\x20Balance\x20check\x20passed\x20(with\x20tolerance)');const _0x3bf019=Math[_0x2a26c6(0x2d5)](_0x44f807,_0x54cc7c);let _0x5ae8fb=_0x1d643a;console[_0x2a26c6(0x18c)]('ðŸ”\x20Initial\x20wallet\x20from\x20request:\x20'+(_0x1d643a||'not\x20provided'));if(!_0x5ae8fb){console[_0x2a26c6(0x18c)](_0x2a26c6(0x2f7));const _0xd77983=await _0x29e5e0[_0x2a26c6(0x13c)][_0x2a26c6(0x2aa)]({'where':{'id':_0x2f35c5},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});console['log']('ðŸ”\x20Shop\x20wallets:',_0xd77983);if(_0xd77983)switch(_0x1cb5eb){case'polygon':_0x5ae8fb=_0xd77983[_0x2a26c6(0x190)]||undefined,console[_0x2a26c6(0x18c)]('ðŸ”\x20Selected\x20polygon\x20wallet:\x20'+_0x5ae8fb);break;case _0x2a26c6(0x14a):_0x5ae8fb=_0xd77983[_0x2a26c6(0x178)]||undefined,console[_0x2a26c6(0x18c)](_0x2a26c6(0x222)+_0x5ae8fb);break;case _0x2a26c6(0x27c):_0x5ae8fb=_0xd77983[_0x2a26c6(0x23a)]||undefined,console[_0x2a26c6(0x18c)](_0x2a26c6(0x216)+_0x5ae8fb);break;case _0x2a26c6(0x199):_0x5ae8fb=_0xd77983[_0x2a26c6(0x1e8)]||undefined,console[_0x2a26c6(0x18c)]('ðŸ”\x20Selected\x20polygon_usdc\x20wallet:\x20'+_0x5ae8fb);break;case _0x2a26c6(0x226):_0x5ae8fb=_0xd77983[_0x2a26c6(0x272)]||undefined,console[_0x2a26c6(0x18c)](_0x2a26c6(0x2e9)+_0x5ae8fb);break;}}else console[_0x2a26c6(0x18c)](_0x2a26c6(0x248)+_0x5ae8fb);console[_0x2a26c6(0x18c)](_0x2a26c6(0x2a3)+_0x1cb5eb+':\x20'+(_0x5ae8fb||'not\x20specified')),console[_0x2a26c6(0x18c)](_0x2a26c6(0x1da),{'shopId':_0x2f35c5,'amount':_0x3bf019,'network':_0x1cb5eb,'wallet':_0x5ae8fb,'status':_0x2a26c6(0x26b),'txid':_0x3a2bf5,'notes':_0x7c7bff,'periodFrom':_0x4df783?new Date(_0x4df783):null,'periodTo':_0x126f45?new Date(_0x126f45):null});const _0x5bc077=await _0x29e5e0[_0x2a26c6(0x1aa)]['create']({'data':{'shopId':_0x2f35c5,'amount':_0x3bf019,'network':_0x1cb5eb,'wallet':_0x5ae8fb,'status':_0x2a26c6(0x26b),'txid':_0x3a2bf5,'notes':_0x7c7bff,'periodFrom':_0x4df783?new Date(_0x4df783):null,'periodTo':_0x126f45?new Date(_0x126f45):null,'createdAt':new Date(),'paidAt':new Date()}});console['log'](_0x2a26c6(0x2ef),{'id':_0x5bc077['id'],'wallet':_0x5bc077[_0x2a26c6(0x1d4)],'network':_0x5bc077[_0x2a26c6(0x16a)],'amount':_0x5bc077[_0x2a26c6(0x1f3)]});const _0x5a1de2=_0x44f807-_0x3bf019,_0x5c02d3=Number(_0x3793cc['totalPaidOut'])+_0x3bf019;return await _0x29e5e0[_0x2a26c6(0x13c)][_0x2a26c6(0x240)]({'where':{'id':_0x2f35c5},'data':{'balance':_0x5a1de2,'totalPaidOut':_0x5c02d3}}),console[_0x2a26c6(0x18c)](_0x2a26c6(0x30d)+_0x3793cc[_0x2a26c6(0x285)]+_0x2a26c6(0x1ae)),console[_0x2a26c6(0x18c)](_0x2a26c6(0x30f)+_0x44f807[_0x2a26c6(0x1c4)](0x6)+_0x2a26c6(0x1f2)+_0x5a1de2['toFixed'](0x6)+'\x20USDT\x20(-'+_0x3bf019[_0x2a26c6(0x1c4)](0x6)+')'),console[_0x2a26c6(0x18c)](_0x2a26c6(0x2cf)+_0x3793cc[_0x2a26c6(0x215)][_0x2a26c6(0x1c4)](0x6)+_0x2a26c6(0x1f2)+_0x5c02d3[_0x2a26c6(0x1c4)](0x6)+_0x2a26c6(0x204)+_0x3bf019[_0x2a26c6(0x1c4)](0x6)+')'),console['log'](_0x2a26c6(0x1e1)+_0x3bf019['toFixed'](0x6)+_0x2a26c6(0x2b0)),{'payout':_0x5bc077,'shop':_0x3793cc};});console[_0x52c652(0x18c)](_0x52c652(0x1e7)+_0x2f8b16[_0x52c652(0x1aa)]['id']+_0x52c652(0x1de)+_0x2f8b16[_0x52c652(0x13c)][_0x52c652(0x285)]+'\x20('+_0x2f8b16[_0x52c652(0x1aa)]['amount'][_0x52c652(0x1c4)](0x6)+'\x20USDT)');try{let _0x12da51='ÐÐµ\x20ÑƒÐºÐ°Ð·Ð°Ð½';if(_0x2f8b16[_0x52c652(0x1aa)]['periodFrom']&&_0x2f8b16[_0x52c652(0x1aa)][_0x52c652(0x2f1)]){const _0x3eef96=new Date(_0x2f8b16[_0x52c652(0x1aa)][_0x52c652(0x1bd)])[_0x52c652(0x232)](_0x52c652(0x1f9)),_0x94941a=new Date(_0x2f8b16[_0x52c652(0x1aa)][_0x52c652(0x2f1)])['toLocaleDateString'](_0x52c652(0x1f9));_0x12da51=_0x3eef96+_0x52c652(0x2ab)+_0x94941a;}await telegramBotService_1[_0x52c652(0x279)][_0x52c652(0x192)](_0x2f8b16[_0x52c652(0x1aa)][_0x52c652(0x17c)],{'id':_0x2f8b16[_0x52c652(0x1aa)]['id'],'amount':_0x2f8b16[_0x52c652(0x1aa)][_0x52c652(0x1f3)],'network':_0x2f8b16[_0x52c652(0x1aa)]['network'],'wallet':_0x2f8b16['payout'][_0x52c652(0x1d4)],'period':_0x12da51,'createdAt':_0x2f8b16[_0x52c652(0x1aa)][_0x52c652(0x316)],'txid':_0x2f8b16['payout']['txid']}),console[_0x52c652(0x18c)](_0x52c652(0x305)+_0x2f8b16['payout']['id']);}catch(_0x10efe9){console[_0x52c652(0x177)](_0x52c652(0x28e)+_0x2f8b16[_0x52c652(0x1aa)]['id']+':',_0x10efe9);}return{'id':_0x2f8b16[_0x52c652(0x1aa)]['id'],'shopId':_0x2f8b16[_0x52c652(0x1aa)]['shopId'],'shopName':_0x2f8b16[_0x52c652(0x13c)][_0x52c652(0x1ff)],'shopUsername':_0x2f8b16['shop'][_0x52c652(0x285)],'amount':_0x2f8b16[_0x52c652(0x1aa)][_0x52c652(0x1f3)],'network':_0x2f8b16[_0x52c652(0x1aa)][_0x52c652(0x16a)],'wallet':_0x2f8b16[_0x52c652(0x1aa)][_0x52c652(0x1d4)],'status':_0x2f8b16[_0x52c652(0x1aa)]['status'],'txid':_0x2f8b16['payout'][_0x52c652(0x182)],'notes':_0x2f8b16[_0x52c652(0x1aa)][_0x52c652(0x2af)],'periodFrom':_0x2f8b16[_0x52c652(0x1aa)][_0x52c652(0x1bd)],'periodTo':_0x2f8b16[_0x52c652(0x1aa)][_0x52c652(0x2f1)],'createdAt':_0x2f8b16['payout']['createdAt'],'paidAt':_0x2f8b16[_0x52c652(0x1aa)][_0x52c652(0x22a)]};}async[a53_0x3f9d8e(0x236)](_0xffac09){const _0x37badb=a53_0x3f9d8e,{page:_0x4304bd,limit:_0x584872,shopId:_0x2ab30e,network:_0x47ab61,dateFrom:_0x5606e8,dateTo:_0x2cacdc,search:_0x77e9ee}=_0xffac09,_0x6badf2=(_0x4304bd-0x1)*_0x584872,_0x32845c={};_0x2ab30e&&(_0x32845c[_0x37badb(0x17c)]=_0x2ab30e);_0x47ab61&&(_0x32845c[_0x37badb(0x16a)]=_0x47ab61);if(_0x5606e8||_0x2cacdc){_0x32845c[_0x37badb(0x316)]={};if(_0x5606e8){const _0x2b0ef0=new Date(_0x5606e8);_0x2b0ef0[_0x37badb(0x157)](0x0,0x0,0x0,0x1),_0x32845c[_0x37badb(0x316)]['gte']=_0x2b0ef0,console[_0x37badb(0x18c)](_0x37badb(0x259)+_0x2b0ef0[_0x37badb(0x309)]());}if(_0x2cacdc){const _0x3d099d=new Date(_0x2cacdc);_0x3d099d['setHours'](0x17,0x3b,0x3b,0x3e7),_0x32845c[_0x37badb(0x316)][_0x37badb(0x207)]=_0x3d099d,console[_0x37badb(0x18c)](_0x37badb(0x1ce)+_0x3d099d[_0x37badb(0x309)]());}}_0x77e9ee&&(_0x32845c['OR']=[{'shop':{'name':{'contains':_0x77e9ee,'mode':_0x37badb(0x137)}}},{'shop':{'username':{'contains':_0x77e9ee,'mode':_0x37badb(0x137)}}},{'notes':{'contains':_0x77e9ee,'mode':_0x37badb(0x137)}}]);const [_0x36234d,_0x41bb00]=await Promise[_0x37badb(0x1d8)]([database_1[_0x37badb(0x194)][_0x37badb(0x1aa)][_0x37badb(0x217)]({'where':_0x32845c,'skip':_0x6badf2,'take':_0x584872,'orderBy':{'createdAt':_0x37badb(0x2a2)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'wallet':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x37badb(0x194)][_0x37badb(0x1aa)][_0x37badb(0x1af)]({'where':_0x32845c})]);return{'payouts':_0x36234d['map'](_0x84c536=>({'id':_0x84c536['id'],'shopId':_0x84c536[_0x37badb(0x17c)],'shopName':_0x84c536[_0x37badb(0x13c)][_0x37badb(0x1ff)],'shopUsername':_0x84c536[_0x37badb(0x13c)][_0x37badb(0x285)],'amount':_0x84c536[_0x37badb(0x1f3)],'network':_0x84c536[_0x37badb(0x16a)],'wallet':_0x84c536[_0x37badb(0x1d4)],'status':_0x84c536[_0x37badb(0x1a5)],'txid':_0x84c536[_0x37badb(0x182)],'notes':_0x84c536['notes'],'periodFrom':_0x84c536[_0x37badb(0x1bd)],'periodTo':_0x84c536['periodTo'],'createdAt':_0x84c536[_0x37badb(0x316)],'paidAt':_0x84c536['paidAt']})),'pagination':{'page':_0x4304bd,'limit':_0x584872,'total':_0x41bb00,'totalPages':Math[_0x37badb(0x162)](_0x41bb00/_0x584872)}};}async[a53_0x3f9d8e(0x16f)](_0x59d101){const _0x43c580=a53_0x3f9d8e,_0x81c798=await database_1[_0x43c580(0x194)][_0x43c580(0x1aa)][_0x43c580(0x2aa)]({'where':{'id':_0x59d101},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x81c798)return null;return{'id':_0x81c798['id'],'shopId':_0x81c798[_0x43c580(0x17c)],'shopName':_0x81c798['shop']['name'],'shopUsername':_0x81c798[_0x43c580(0x13c)][_0x43c580(0x285)],'amount':_0x81c798[_0x43c580(0x1f3)],'network':_0x81c798[_0x43c580(0x16a)],'wallet':_0x81c798[_0x43c580(0x1d4)],'status':_0x81c798[_0x43c580(0x1a5)],'txid':_0x81c798[_0x43c580(0x182)],'notes':_0x81c798[_0x43c580(0x2af)],'periodFrom':_0x81c798[_0x43c580(0x1bd)],'periodTo':_0x81c798[_0x43c580(0x2f1)],'createdAt':_0x81c798[_0x43c580(0x316)],'paidAt':_0x81c798[_0x43c580(0x22a)]};}async[a53_0x3f9d8e(0x2f8)](_0x35f260){const _0x3c86be=a53_0x3f9d8e;await database_1['default']['payout'][_0x3c86be(0x181)]({'where':{'id':_0x35f260}});}async['updatePayout'](_0x4579f5,_0x195dad){const _0x21228c=a53_0x3f9d8e,_0x5a0ea9=await database_1[_0x21228c(0x194)][_0x21228c(0x2cc)](async _0x403349=>{const _0xa4dd4b=_0x21228c,_0x590ee9=await _0x403349[_0xa4dd4b(0x1aa)][_0xa4dd4b(0x2aa)]({'where':{'id':_0x4579f5},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}}}});if(!_0x590ee9)throw new Error(_0xa4dd4b(0x1e4));console['log']('ðŸ’°\x20Updating\x20payout\x20'+_0x4579f5+_0xa4dd4b(0x1de)+_0x590ee9[_0xa4dd4b(0x13c)][_0xa4dd4b(0x285)]+':'),console[_0xa4dd4b(0x18c)](_0xa4dd4b(0x29c)+_0x590ee9[_0xa4dd4b(0x1f3)][_0xa4dd4b(0x1c4)](0x6)+_0xa4dd4b(0x2b0)),console['log']('\x20\x20\x20Current\x20network:\x20'+_0x590ee9[_0xa4dd4b(0x16a)]),console[_0xa4dd4b(0x18c)]('\x20\x20\x20Shop\x20balance:\x20'+_0x590ee9[_0xa4dd4b(0x13c)]['balance'][_0xa4dd4b(0x1c4)](0x6)+_0xa4dd4b(0x2b0)),console[_0xa4dd4b(0x18c)](_0xa4dd4b(0x2fd)+_0x590ee9[_0xa4dd4b(0x13c)]['totalPaidOut'][_0xa4dd4b(0x1c4)](0x6)+'\x20USDT');let _0x1fe84e=0x0;if(_0x195dad['amount']!==undefined){const _0x23f7a2=Number(_0x590ee9[_0xa4dd4b(0x1f3)]),_0x3426b7=Number(_0x195dad[_0xa4dd4b(0x1f3)]);_0x1fe84e=_0x3426b7-_0x23f7a2,console[_0xa4dd4b(0x18c)](_0xa4dd4b(0x14f)+_0x3426b7[_0xa4dd4b(0x1c4)](0x6)+_0xa4dd4b(0x2b0)),console[_0xa4dd4b(0x18c)](_0xa4dd4b(0x154)+_0x1fe84e['toFixed'](0x6)+_0xa4dd4b(0x2b0));if(_0x1fe84e<0x0)console[_0xa4dd4b(0x18c)]('\x20\x20\x20Amount\x20decreased\x20by\x20'+Math[_0xa4dd4b(0x228)](_0x1fe84e)[_0xa4dd4b(0x1c4)](0x6)+_0xa4dd4b(0x189));else{if(_0x1fe84e>0x0){const _0x258bff=Number(_0x590ee9['shop'][_0xa4dd4b(0x24a)]);console[_0xa4dd4b(0x18c)](_0xa4dd4b(0x144)+_0x1fe84e['toFixed'](0x6)+'\x20USDT\x20-\x20will\x20deduct\x20from\x20balance');if(_0x258bff<_0x1fe84e)throw new Error(_0xa4dd4b(0x149)+_0x258bff[_0xa4dd4b(0x1c4)](0x6)+_0xa4dd4b(0x26e)+_0x1fe84e[_0xa4dd4b(0x1c4)](0x6)+_0xa4dd4b(0x2b0));}}}const _0x5e9436={};if(_0x195dad[_0xa4dd4b(0x1f3)]!==undefined)_0x5e9436[_0xa4dd4b(0x1f3)]=_0x195dad[_0xa4dd4b(0x1f3)];if(_0x195dad[_0xa4dd4b(0x16a)]!==undefined)_0x5e9436[_0xa4dd4b(0x16a)]=_0x195dad[_0xa4dd4b(0x16a)];if(_0x195dad[_0xa4dd4b(0x1d4)]!==undefined)_0x5e9436[_0xa4dd4b(0x1d4)]=_0x195dad[_0xa4dd4b(0x1d4)]||null;if(_0x195dad[_0xa4dd4b(0x2af)]!==undefined)_0x5e9436[_0xa4dd4b(0x2af)]=_0x195dad[_0xa4dd4b(0x2af)]||null;if(_0x195dad['txid']!==undefined)_0x5e9436[_0xa4dd4b(0x182)]=_0x195dad[_0xa4dd4b(0x182)]||null;if(_0x195dad['periodFrom']!==undefined)_0x5e9436[_0xa4dd4b(0x1bd)]=_0x195dad['periodFrom']?new Date(_0x195dad[_0xa4dd4b(0x1bd)]):null;if(_0x195dad[_0xa4dd4b(0x2f1)]!==undefined)_0x5e9436[_0xa4dd4b(0x2f1)]=_0x195dad[_0xa4dd4b(0x2f1)]?new Date(_0x195dad[_0xa4dd4b(0x2f1)]):null;const _0x29f613=await _0x403349[_0xa4dd4b(0x1aa)][_0xa4dd4b(0x240)]({'where':{'id':_0x4579f5},'data':_0x5e9436,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(_0x1fe84e!==0x0){const _0x57615f=Number(_0x590ee9[_0xa4dd4b(0x13c)][_0xa4dd4b(0x24a)]),_0x2dc307=Number(_0x590ee9[_0xa4dd4b(0x13c)][_0xa4dd4b(0x215)]),_0x185646=_0x57615f-_0x1fe84e,_0x22c15c=_0x2dc307+_0x1fe84e;await _0x403349[_0xa4dd4b(0x13c)][_0xa4dd4b(0x240)]({'where':{'id':_0x590ee9[_0xa4dd4b(0x17c)]},'data':{'balance':_0x185646,'totalPaidOut':_0x22c15c}}),console['log']('ðŸ’°\x20Shop\x20'+_0x590ee9[_0xa4dd4b(0x13c)][_0xa4dd4b(0x285)]+_0xa4dd4b(0x1ae)),console['log'](_0xa4dd4b(0x30f)+_0x57615f[_0xa4dd4b(0x1c4)](0x6)+_0xa4dd4b(0x1f2)+_0x185646['toFixed'](0x6)+_0xa4dd4b(0x2b0)),console[_0xa4dd4b(0x18c)](_0xa4dd4b(0x2cf)+_0x2dc307['toFixed'](0x6)+'\x20->\x20'+_0x22c15c[_0xa4dd4b(0x1c4)](0x6)+_0xa4dd4b(0x2b0));}return console[_0xa4dd4b(0x18c)]('âœ…\x20Payout\x20'+_0x4579f5+'\x20updated\x20successfully'),_0x29f613;});return{'id':_0x5a0ea9['id'],'shopId':_0x5a0ea9['shopId'],'shopName':_0x5a0ea9[_0x21228c(0x13c)]['name'],'shopUsername':_0x5a0ea9[_0x21228c(0x13c)][_0x21228c(0x285)],'amount':Number(_0x5a0ea9[_0x21228c(0x1f3)]),'network':_0x5a0ea9['network'],'wallet':_0x5a0ea9[_0x21228c(0x1d4)],'status':_0x5a0ea9['status'],'txid':_0x5a0ea9[_0x21228c(0x182)],'notes':_0x5a0ea9['notes'],'periodFrom':_0x5a0ea9[_0x21228c(0x1bd)],'periodTo':_0x5a0ea9['periodTo'],'createdAt':_0x5a0ea9['createdAt'],'paidAt':_0x5a0ea9['paidAt']};}async[a53_0x3f9d8e(0x205)](_0x502a73){const _0x48e559=a53_0x3f9d8e,{page:_0x2b5e71,limit:_0x46cfe7,status:_0x3fbda0,gateway:_0x19065a,shopId:_0x141fad,dateFrom:_0x2dad0c,dateTo:_0x4c9cb3,search:_0x59e7b7,currency:_0x79dbee,sortBy:_0x5d6e5a,sortOrder:_0x302ccc}=_0x502a73,_0x597e1a=(_0x2b5e71-0x1)*_0x46cfe7;console[_0x48e559(0x18c)](_0x48e559(0x269),_0x502a73);const _0x15e633=await database_1[_0x48e559(0x194)]['payment'][_0x48e559(0x1fd)]({'by':['gateway'],'_count':{'gateway':!![]}});console['log'](_0x48e559(0x267),_0x15e633['map'](_0x142e5d=>_0x142e5d[_0x48e559(0x1c5)]+'\x20('+_0x142e5d[_0x48e559(0x2d6)][_0x48e559(0x1c5)]+_0x48e559(0x22c)));if(_0x19065a){const _0x2eec3d=_0x15e633[_0x48e559(0x184)](_0x4426a5=>_0x4426a5[_0x48e559(0x1c5)][_0x48e559(0x2fa)]()===_0x19065a[_0x48e559(0x2fa)]());!_0x2eec3d&&_0x19065a[_0x48e559(0x2fa)]()!=='test_gateway'&&console['log'](_0x48e559(0x247)+_0x19065a+_0x48e559(0x170)+_0x15e633['map'](_0x414e38=>_0x414e38['gateway'])['join'](',\x20'));}const _0x19322a={};_0x3fbda0&&(_0x19322a['status']=_0x3fbda0[_0x48e559(0x14e)]());if(!_0x19065a)_0x19322a[_0x48e559(0x1c5)]={'not':_0x48e559(0x233)};else{if(_0x19065a&&(_0x19065a[_0x48e559(0x2fa)]()===_0x48e559(0x233)||_0x19065a===_0x48e559(0x1a7)))_0x19322a[_0x48e559(0x1c5)]=_0x48e559(0x233);else{let _0x399ed3=_0x19065a;const _0x4dc074=(0x0,gateway_1[_0x48e559(0x1f8)])(_0x19065a);if(_0x4dc074)_0x399ed3=_0x4dc074,console[_0x48e559(0x18c)]('ðŸ”„\x20Converted\x20gateway\x20ID\x20\x27'+_0x19065a+_0x48e559(0x143)+_0x399ed3+'\x27');else{const _0x82ec3e=(0x0,gateway_1['getGatewayIdByName'])(_0x19065a);if(_0x82ec3e){const _0x2434c5=(0x0,gateway_1[_0x48e559(0x1f8)])(_0x82ec3e);_0x2434c5&&(_0x399ed3=_0x2434c5,console[_0x48e559(0x18c)](_0x48e559(0x1c1)+_0x19065a+_0x48e559(0x17e)+_0x82ec3e+_0x48e559(0x1fe)+_0x399ed3+'\x27'));}else console['log'](_0x48e559(0x224)+_0x19065a+'\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)');}const _0x4da586=await database_1[_0x48e559(0x194)]['payment'][_0x48e559(0x1af)]({'where':{'gateway':_0x399ed3[_0x48e559(0x2fa)]()},'take':0x1});_0x4da586===0x0?(console[_0x48e559(0x18c)](_0x48e559(0x1b7)+_0x399ed3+_0x48e559(0x246)+_0x19065a+_0x48e559(0x237)),_0x19322a[_0x48e559(0x1c5)]=_0x48e559(0x256)):(_0x19322a['gateway']=_0x399ed3[_0x48e559(0x2fa)](),console['log'](_0x48e559(0x29e)+_0x399ed3+'\x27\x20(from\x20\x27'+_0x19065a+'\x27)'));}}console['log'](_0x48e559(0x2f0),_0x19322a[_0x48e559(0x1c5)]);_0x141fad&&(_0x19322a[_0x48e559(0x17c)]=_0x141fad);_0x79dbee&&(_0x19322a[_0x48e559(0x284)]=_0x79dbee['toUpperCase'](),console['log'](_0x48e559(0x276)+_0x79dbee[_0x48e559(0x14e)]()));if(_0x2dad0c||_0x4c9cb3){_0x19322a['createdAt']={};if(_0x2dad0c){const _0xf57418=new Date(_0x2dad0c),_0xcb68e1=new Date(Date[_0x48e559(0x20b)](_0xf57418[_0x48e559(0x2eb)](),_0xf57418[_0x48e559(0x151)](),_0xf57418[_0x48e559(0x193)](),0x0,0x0,0x0,0x0));_0x19322a[_0x48e559(0x316)][_0x48e559(0x231)]=_0xcb68e1,console['log'](_0x48e559(0x2b1)+_0xcb68e1[_0x48e559(0x309)]());}if(_0x4c9cb3){const _0x2ff05c=new Date(_0x4c9cb3),_0x3e66e1=new Date(Date[_0x48e559(0x20b)](_0x2ff05c[_0x48e559(0x2eb)](),_0x2ff05c[_0x48e559(0x151)](),_0x2ff05c[_0x48e559(0x193)](),0x17,0x3b,0x3b,0x3e7));_0x19322a[_0x48e559(0x316)][_0x48e559(0x207)]=_0x3e66e1,console[_0x48e559(0x18c)](_0x48e559(0x2d9)+_0x3e66e1[_0x48e559(0x309)]());}}_0x59e7b7&&(_0x19322a['OR']=[{'id':{'contains':_0x59e7b7,'mode':'insensitive'}},{'orderId':{'contains':_0x59e7b7,'mode':_0x48e559(0x137)}},{'gatewayOrderId':{'contains':_0x59e7b7,'mode':_0x48e559(0x137)}},{'customerEmail':{'contains':_0x59e7b7,'mode':_0x48e559(0x137)}},{'shop':{'name':{'contains':_0x59e7b7,'mode':_0x48e559(0x137)}}},{'shop':{'username':{'contains':_0x59e7b7,'mode':_0x48e559(0x137)}}}]);console[_0x48e559(0x18c)]('ðŸ“Š\x20Final\x20WHERE\x20conditions:',JSON['stringify'](_0x19322a,null,0x2));const _0x52dcd5=await database_1['default']['payment']['count']({'where':_0x19322a});console['log'](_0x48e559(0x262)+_0x52dcd5);let _0x166aff={'createdAt':_0x48e559(0x2a2)};if(_0x5d6e5a){const _0x257246=['amount',_0x48e559(0x316),_0x48e559(0x1a2),_0x48e559(0x1a5),_0x48e559(0x1c5),_0x48e559(0x284)],_0x32a558=[_0x48e559(0x2ac),_0x48e559(0x2a2)];if(_0x257246['includes'](_0x5d6e5a)){const _0x4d91e6=_0x32a558[_0x48e559(0x139)](_0x302ccc)?_0x302ccc:_0x48e559(0x2a2);_0x166aff={[_0x5d6e5a]:_0x4d91e6},console[_0x48e559(0x18c)](_0x48e559(0x24c)+_0x5d6e5a+'\x20in\x20'+_0x4d91e6+_0x48e559(0x23e));}}const [_0x5d6c5a,_0x5c41b7]=await Promise[_0x48e559(0x1d8)]([database_1['default']['payment'][_0x48e559(0x217)]({'where':_0x19322a,'skip':_0x597e1a,'take':_0x46cfe7,'orderBy':_0x166aff,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x48e559(0x194)][_0x48e559(0x249)]['count']({'where':_0x19322a})]);let _0x4ea4bf,_0x234566;if(_0x2dad0c){const _0x5a11e2=new Date(_0x2dad0c);_0x4ea4bf=new Date(Date[_0x48e559(0x20b)](_0x5a11e2[_0x48e559(0x2eb)](),_0x5a11e2[_0x48e559(0x151)](),_0x5a11e2[_0x48e559(0x193)](),0x0,0x0,0x0,0x0));}else{const _0x777d60=new Date();_0x4ea4bf=new Date(Date[_0x48e559(0x20b)](_0x777d60['getUTCFullYear'](),_0x777d60[_0x48e559(0x151)](),_0x777d60[_0x48e559(0x193)](),0x0,0x0,0x0,0x0));}if(_0x4c9cb3){const _0x428ffb=new Date(_0x4c9cb3);_0x234566=new Date(Date[_0x48e559(0x20b)](_0x428ffb['getUTCFullYear'](),_0x428ffb[_0x48e559(0x151)](),_0x428ffb[_0x48e559(0x193)](),0x17,0x3b,0x3b,0x3e7));}else{if(_0x2dad0c){const _0x64437d=new Date(_0x2dad0c);_0x234566=new Date(Date[_0x48e559(0x20b)](_0x64437d[_0x48e559(0x2eb)](),_0x64437d[_0x48e559(0x151)](),_0x64437d[_0x48e559(0x193)](),0x17,0x3b,0x3b,0x3e7));}else{const _0x43651d=new Date();_0x234566=new Date(Date['UTC'](_0x43651d[_0x48e559(0x2eb)](),_0x43651d[_0x48e559(0x151)](),_0x43651d['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}}const _0x5ea061={};{const _0x301c53={'status':_0x3fbda0?_0x3fbda0['toUpperCase']():_0x48e559(0x2a1),'createdAt':{'gte':_0x4ea4bf,'lte':_0x234566}};_0x19065a?_0x301c53[_0x48e559(0x1c5)]=_0x19322a[_0x48e559(0x1c5)]:_0x301c53[_0x48e559(0x1c5)]={'not':_0x48e559(0x233)};_0x141fad&&(_0x301c53['shopId']=_0x141fad);_0x79dbee&&(_0x301c53[_0x48e559(0x284)]=_0x79dbee[_0x48e559(0x14e)]());console[_0x48e559(0x18c)]('ðŸ“Š\x20Statistics\x20WHERE\x20conditions:',JSON['stringify'](_0x301c53,null,0x2));const _0xff7d17=await database_1[_0x48e559(0x194)]['payment'][_0x48e559(0x217)]({'where':_0x301c53,'select':{'amountUSDT':!![],'currency':!![],'amount':!![]}});let _0x30e759=0x0;_0xff7d17['forEach'](_0x47ac57=>{const _0x30a9e0=_0x48e559;_0x47ac57[_0x30a9e0(0x145)]&&(_0x30e759+=_0x47ac57[_0x30a9e0(0x145)]);if(_0x47ac57[_0x30a9e0(0x284)]){const _0x17c24f=_0x47ac57['currency']['toUpperCase']();!_0x5ea061[_0x17c24f]&&(_0x5ea061[_0x17c24f]=0x0),_0x5ea061[_0x17c24f]+=_0x47ac57[_0x30a9e0(0x1f3)];}}),_0x30e759>0x0&&(_0x5ea061[_0x48e559(0x2b8)]=_0x30e759);}return{'payments':_0x5d6c5a,'pagination':{'page':_0x2b5e71,'limit':_0x46cfe7,'total':_0x5c41b7,'totalPages':Math[_0x48e559(0x162)](_0x5c41b7/_0x46cfe7)},'statistics':_0x5ea061};}async['getPaymentById'](_0x2b8b95){const _0x51a65d=a53_0x3f9d8e,_0x46ad56=await database_1['default']['payment'][_0x51a65d(0x2aa)]({'where':{'id':_0x2b8b95},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x46ad56)return null;return{'id':_0x46ad56['id'],'shopId':_0x46ad56['shopId'],'gateway':_0x46ad56[_0x51a65d(0x1c5)],'amount':_0x46ad56['amount'],'currency':_0x46ad56[_0x51a65d(0x284)],'status':_0x46ad56[_0x51a65d(0x1a5)],'orderId':_0x46ad56[_0x51a65d(0x258)],'gatewayOrderId':_0x46ad56[_0x51a65d(0x1a3)],'customerEmail':_0x46ad56[_0x51a65d(0x206)],'customerName':_0x46ad56['customerName'],'customerCountry':_0x46ad56[_0x51a65d(0x17b)],'customerIp':_0x46ad56[_0x51a65d(0x141)],'customerUa':_0x46ad56[_0x51a65d(0x1c9)],'failureMessage':_0x46ad56[_0x51a65d(0x212)],'externalPaymentUrl':_0x46ad56[_0x51a65d(0x234)],'successUrl':_0x46ad56[_0x51a65d(0x20d)],'failUrl':_0x46ad56['failUrl'],'pendingUrl':_0x46ad56[_0x51a65d(0x25d)],'whiteUrl':_0x46ad56[_0x51a65d(0x18a)],'createdAt':_0x46ad56[_0x51a65d(0x316)],'updatedAt':_0x46ad56['updatedAt'],'shop':_0x46ad56['shop']};}async['updatePaymentStatus'](_0x1ffc89,_0x451d82,_0x1ad355,_0x1c12bd){const _0x3fff2e=a53_0x3f9d8e,_0x95b8a6=await database_1[_0x3fff2e(0x194)][_0x3fff2e(0x2cc)](async _0x37b440=>{const _0x4b4584=_0x3fff2e,_0x45dac3=await _0x37b440[_0x4b4584(0x249)][_0x4b4584(0x2aa)]({'where':{'id':_0x1ffc89},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x45dac3)throw new Error(_0x4b4584(0x2f6));const _0x52d4b3=_0x45dac3[_0x4b4584(0x1a5)],_0x2d3edf=_0x451d82[_0x4b4584(0x14e)]();console[_0x4b4584(0x18c)]('ðŸ”„\x20Admin\x20updating\x20payment\x20'+_0x1ffc89+_0x4b4584(0x306)+_0x52d4b3+_0x4b4584(0x1f2)+_0x2d3edf),console[_0x4b4584(0x18c)]('ðŸ’°\x20Current\x20shop\x20balance:\x20'+_0x45dac3[_0x4b4584(0x13c)][_0x4b4584(0x24a)]+_0x4b4584(0x2b0));const _0x229814={'status':_0x2d3edf,'updatedAt':new Date(),'statusChangedBy':_0x4b4584(0x227),'statusChangedAt':new Date()};_0x1ad355&&(_0x229814[_0x4b4584(0x14d)]=_0x1ad355);_0x2d3edf===_0x4b4584(0x2b3)&&_0x1c12bd&&(_0x229814[_0x4b4584(0x29b)]=_0x1c12bd);let _0x2cc6df=0x0,_0x2e5e92=_0x45dac3[_0x4b4584(0x13c)]['balance'];if(_0x2d3edf===_0x4b4584(0x2a1)&&_0x52d4b3!==_0x4b4584(0x2a1)){_0x229814[_0x4b4584(0x22a)]=new Date();const _0x218705=await currencyService_1['currencyService'][_0x4b4584(0x156)](_0x45dac3[_0x4b4584(0x1f3)],_0x45dac3[_0x4b4584(0x284)]);_0x229814[_0x4b4584(0x145)]=_0x218705;let _0x6e406=0x2d;const _0x16c459=await _0x37b440[_0x4b4584(0x13c)][_0x4b4584(0x2aa)]({'where':{'id':_0x45dac3[_0x4b4584(0x17c)]},'select':{'gatewaySettings':!![]}});if(_0x16c459?.[_0x4b4584(0x1c6)])try{const _0xdbea2e=JSON[_0x4b4584(0x20f)](_0x16c459[_0x4b4584(0x1c6)]);for(const [_0x11fb39,_0x1ab5f7]of Object[_0x4b4584(0x2e6)](_0xdbea2e)){if(_0x11fb39[_0x4b4584(0x2fa)]()===_0x45dac3['gateway'][_0x4b4584(0x2fa)]()){_0x6e406=_0x1ab5f7[_0x4b4584(0x1d0)]||0xa;break;}}}catch(_0x4dd9a6){console[_0x4b4584(0x177)](_0x4b4584(0x1b6)+_0x1ffc89+':',_0x4dd9a6);}let _0x14bdef;_0x45dac3[_0x4b4584(0x1fb)]!==null&&_0x45dac3[_0x4b4584(0x1fb)]!==undefined?(_0x14bdef=_0x45dac3['amountAfterGatewayCommissionUSDT'],console[_0x4b4584(0x18c)](_0x4b4584(0x2fc)+_0x14bdef['toFixed'](0x6)+_0x4b4584(0x2f2)+_0x1ffc89)):(_0x14bdef=_0x218705*(0x1-_0x6e406/0x64),console[_0x4b4584(0x18c)](_0x4b4584(0x1ef)+_0x1ffc89+':\x20'+_0x6e406+_0x4b4584(0x303)+_0x218705[_0x4b4584(0x1c4)](0x6)+'\x20USDT'),_0x229814[_0x4b4584(0x1fb)]=_0x14bdef,_0x229814[_0x4b4584(0x168)]=_0x6e406),_0x2cc6df=_0x14bdef,_0x2e5e92+=_0x14bdef,console[_0x4b4584(0x18c)]('ðŸ’°\x20Payment\x20'+_0x1ffc89+'\x20became\x20PAID:'),console[_0x4b4584(0x18c)](_0x4b4584(0x213)+_0x218705[_0x4b4584(0x1c4)](0x6)+_0x4b4584(0x2b0)),console[_0x4b4584(0x18c)](_0x4b4584(0x1f6)+_0x45dac3[_0x4b4584(0x1c5)]+_0x4b4584(0x1ab)+_0x6e406+'%'),console['log'](_0x4b4584(0x266)+_0x14bdef[_0x4b4584(0x1c4)](0x6)+_0x4b4584(0x2a7)+_0x6e406+'%\x20commission)'),console['log'](_0x4b4584(0x2f5)+_0x14bdef[_0x4b4584(0x1c4)](0x6)+_0x4b4584(0x2b0));}else{if(_0x52d4b3===_0x4b4584(0x2a1)&&_0x2d3edf!==_0x4b4584(0x2a1)&&_0x2d3edf!=='CHARGEBACK'){if(_0x45dac3[_0x4b4584(0x145)]){let _0xcedc86=0x2d;const _0xf70608=await _0x37b440[_0x4b4584(0x13c)]['findUnique']({'where':{'id':_0x45dac3[_0x4b4584(0x17c)]},'select':{'gatewaySettings':!![]}});if(_0xf70608?.[_0x4b4584(0x1c6)])try{const _0x58514e=JSON[_0x4b4584(0x20f)](_0xf70608['gatewaySettings']);for(const [_0x145465,_0x2cc47f]of Object[_0x4b4584(0x2e6)](_0x58514e)){if(_0x145465['toLowerCase']()===_0x45dac3['gateway'][_0x4b4584(0x2fa)]()){_0xcedc86=_0x2cc47f[_0x4b4584(0x1d0)]||0xa;break;}}}catch(_0x16ec51){console[_0x4b4584(0x177)](_0x4b4584(0x1b6)+_0x1ffc89+':',_0x16ec51);}const _0x4ce6f4=_0x45dac3[_0x4b4584(0x145)]*(0x1-_0xcedc86/0x64);_0x2cc6df=-_0x4ce6f4,_0x2e5e92-=_0x4ce6f4,console[_0x4b4584(0x18c)](_0x4b4584(0x213)+_0x45dac3[_0x4b4584(0x145)]['toFixed'](0x6)+_0x4b4584(0x2b0)),console['log'](_0x4b4584(0x1f6)+_0x45dac3[_0x4b4584(0x1c5)]+',\x20Commission:\x20'+_0xcedc86+'%'),console['log'](_0x4b4584(0x179)+_0x4ce6f4[_0x4b4584(0x1c4)](0x6)+_0x4b4584(0x2a7)+_0xcedc86+_0x4b4584(0x265)),console[_0x4b4584(0x18c)](_0x4b4584(0x1cf)+_0x4ce6f4[_0x4b4584(0x1c4)](0x6)+_0x4b4584(0x2b0));}}}_0x2d3edf===_0x4b4584(0x2b3)&&(console[_0x4b4584(0x18c)](_0x4b4584(0x15e)),_0x1c12bd&&_0x1c12bd>0x0?(_0x2cc6df=-_0x1c12bd,_0x2e5e92-=_0x1c12bd,console['log']('ðŸ’¸\x20CHARGEBACK\x20penalty\x20ONLY:\x20-'+_0x1c12bd[_0x4b4584(0x1c4)](0x6)+_0x4b4584(0x2f9)),console[_0x4b4584(0x18c)](_0x4b4584(0x180))):console[_0x4b4584(0x18c)](_0x4b4584(0x2c1)),_0x229814[_0x4b4584(0x29b)]=_0x1c12bd||0x0);_0x2d3edf===_0x4b4584(0x2f4)&&_0x52d4b3==='PAID'&&console['log'](_0x4b4584(0x18b));const _0x357f7b=await _0x37b440[_0x4b4584(0x249)][_0x4b4584(0x240)]({'where':{'id':_0x1ffc89},'data':_0x229814,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x2cc6df!==0x0&&(await _0x37b440[_0x4b4584(0x13c)][_0x4b4584(0x240)]({'where':{'id':_0x45dac3['shopId']},'data':{'balance':_0x2e5e92}}),console['log'](_0x4b4584(0x30d)+_0x45dac3['shopId']+_0x4b4584(0x155)+_0x45dac3[_0x4b4584(0x13c)][_0x4b4584(0x24a)][_0x4b4584(0x1c4)](0x6)+_0x4b4584(0x1f2)+_0x2e5e92[_0x4b4584(0x1c4)](0x6)+_0x4b4584(0x23b)+(_0x2cc6df>0x0?'+':'')+_0x2cc6df[_0x4b4584(0x1c4)](0x6)+')')),_0x357f7b;});return{'id':_0x95b8a6['id'],'shopId':_0x95b8a6['shopId'],'gateway':_0x95b8a6[_0x3fff2e(0x1c5)],'amount':_0x95b8a6[_0x3fff2e(0x1f3)],'currency':_0x95b8a6['currency'],'status':_0x95b8a6['status'],'orderId':_0x95b8a6[_0x3fff2e(0x258)],'gatewayOrderId':_0x95b8a6[_0x3fff2e(0x1a3)],'customerEmail':_0x95b8a6[_0x3fff2e(0x206)],'customerName':_0x95b8a6[_0x3fff2e(0x318)],'customerCountry':_0x95b8a6['customerCountry'],'customerIp':_0x95b8a6[_0x3fff2e(0x141)],'customerUa':_0x95b8a6[_0x3fff2e(0x1c9)],'failureMessage':_0x95b8a6[_0x3fff2e(0x212)],'adminNotes':_0x95b8a6[_0x3fff2e(0x14d)],'chargebackAmount':_0x95b8a6['chargebackAmount'],'statusChangedBy':_0x95b8a6[_0x3fff2e(0x1ca)],'statusChangedAt':_0x95b8a6[_0x3fff2e(0x283)],'createdAt':_0x95b8a6['createdAt'],'updatedAt':_0x95b8a6[_0x3fff2e(0x1a2)],'shop':_0x95b8a6['shop']};}async['updateUser'](_0xf49ce9,_0x31dead){const _0x4e8e4f=a53_0x3f9d8e,_0x17eaed=Math[_0x4e8e4f(0x13a)]()[_0x4e8e4f(0x2d0)](0x24)[_0x4e8e4f(0x2c8)](0x2,0x9);console[_0x4e8e4f(0x18c)](_0x4e8e4f(0x140)+_0x17eaed+',\x20userId:\x20'+_0xf49ce9);const _0x2c3cec={..._0x31dead};_0x31dead[_0x4e8e4f(0x2ba)]&&_0x31dead[_0x4e8e4f(0x2ba)]['trim']()!==''?(console[_0x4e8e4f(0x18c)](_0x4e8e4f(0x1f1)+_0x17eaed+_0x4e8e4f(0x2d4)+_0xf49ce9),_0x2c3cec['password']=await bcryptjs_1[_0x4e8e4f(0x194)][_0x4e8e4f(0x22f)](_0x31dead[_0x4e8e4f(0x2ba)],0xc)):(console[_0x4e8e4f(0x18c)]('ðŸ”\x20['+_0x17eaed+_0x4e8e4f(0x171)),delete _0x2c3cec[_0x4e8e4f(0x2ba)]);_0x31dead[_0x4e8e4f(0x20a)]&&(_0x2c3cec[_0x4e8e4f(0x1ff)]=_0x31dead[_0x4e8e4f(0x20a)],delete _0x2c3cec[_0x4e8e4f(0x20a)]);_0x31dead[_0x4e8e4f(0x1bb)]&&(_0x2c3cec[_0x4e8e4f(0x264)]=_0x31dead[_0x4e8e4f(0x1bb)],delete _0x2c3cec['telegramId']);_0x31dead[_0x4e8e4f(0x1ed)]!==undefined&&(_0x2c3cec[_0x4e8e4f(0x2c6)]=_0x31dead[_0x4e8e4f(0x1ed)]||null,delete _0x2c3cec['merchantUrl']);_0x31dead['merchantUrl2']!==undefined&&(_0x2c3cec[_0x4e8e4f(0x27e)]=_0x31dead[_0x4e8e4f(0x1c8)]||null,delete _0x2c3cec[_0x4e8e4f(0x1c8)]);_0x31dead['merchantUrl3']!==undefined&&(_0x2c3cec[_0x4e8e4f(0x23f)]=_0x31dead['merchantUrl3']||null,delete _0x2c3cec[_0x4e8e4f(0x25e)]);_0x31dead[_0x4e8e4f(0x191)]!==undefined&&(_0x2c3cec[_0x4e8e4f(0x2e7)]=_0x31dead['merchantUrl4']||null,delete _0x2c3cec[_0x4e8e4f(0x191)]);if(_0x31dead[_0x4e8e4f(0x253)]){const _0x3723ed=_0x31dead[_0x4e8e4f(0x253)][_0x4e8e4f(0x2bc)](_0x465874=>this[_0x4e8e4f(0x1e9)](_0x465874));console[_0x4e8e4f(0x18c)]('ðŸ”„\x20Gateway\x20mapping:',_0x31dead[_0x4e8e4f(0x253)],'->',_0x3723ed),_0x2c3cec[_0x4e8e4f(0x304)]=JSON['stringify'](_0x3723ed),delete _0x2c3cec[_0x4e8e4f(0x253)];}_0x31dead[_0x4e8e4f(0x1c6)]&&(console[_0x4e8e4f(0x18c)](_0x4e8e4f(0x2db)+_0x17eaed+']\x20Gateway\x20settings\x20before\x20saving:',_0x31dead[_0x4e8e4f(0x1c6)]),_0x2c3cec[_0x4e8e4f(0x1c6)]=JSON['stringify'](_0x31dead[_0x4e8e4f(0x1c6)]),console['log'](_0x4e8e4f(0x2db)+_0x17eaed+_0x4e8e4f(0x275),_0x2c3cec[_0x4e8e4f(0x1c6)]));_0x31dead[_0x4e8e4f(0x1db)]&&(_0x31dead['wallets']['usdtPolygonWallet']!==undefined&&(_0x2c3cec[_0x4e8e4f(0x190)]=_0x31dead[_0x4e8e4f(0x1db)][_0x4e8e4f(0x190)]||null),_0x31dead[_0x4e8e4f(0x1db)]['usdtTrcWallet']!==undefined&&(_0x2c3cec['usdtTrcWallet']=_0x31dead[_0x4e8e4f(0x1db)][_0x4e8e4f(0x178)]||null),_0x31dead[_0x4e8e4f(0x1db)][_0x4e8e4f(0x23a)]!==undefined&&(_0x2c3cec['usdtErcWallet']=_0x31dead[_0x4e8e4f(0x1db)][_0x4e8e4f(0x23a)]||null),_0x31dead[_0x4e8e4f(0x1db)][_0x4e8e4f(0x1e8)]!==undefined&&(_0x2c3cec[_0x4e8e4f(0x1e8)]=_0x31dead[_0x4e8e4f(0x1db)][_0x4e8e4f(0x1e8)]||null),delete _0x2c3cec[_0x4e8e4f(0x1db)]);const _0x2ffb01=await database_1[_0x4e8e4f(0x194)][_0x4e8e4f(0x13c)][_0x4e8e4f(0x240)]({'where':{'id':_0xf49ce9},'data':_0x2c3cec,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'shopUrl2':!![],'shopUrl3':!![],'shopUrl4':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0x4e8e4f(0x18c)](_0x4e8e4f(0x19c)+_0x17eaed+_0x4e8e4f(0x176),_0x2ffb01[_0x4e8e4f(0x1c6)]),{'id':_0x2ffb01['id'],'fullName':_0x2ffb01[_0x4e8e4f(0x1ff)],'username':_0x2ffb01['username'],'telegramId':_0x2ffb01['telegram'],'merchantUrl':_0x2ffb01['shopUrl'],'merchantUrl2':_0x2ffb01['shopUrl2'],'merchantUrl3':_0x2ffb01[_0x4e8e4f(0x23f)],'merchantUrl4':_0x2ffb01[_0x4e8e4f(0x2e7)],'gateways':_0x2ffb01[_0x4e8e4f(0x304)]?JSON[_0x4e8e4f(0x20f)](_0x2ffb01[_0x4e8e4f(0x304)]):null,'gatewaySettings':_0x2ffb01[_0x4e8e4f(0x1c6)]?JSON[_0x4e8e4f(0x20f)](_0x2ffb01[_0x4e8e4f(0x1c6)]):null,'publicKey':_0x2ffb01['publicKey'],'wallets':{'usdtPolygonWallet':_0x2ffb01[_0x4e8e4f(0x190)],'usdtTrcWallet':_0x2ffb01[_0x4e8e4f(0x178)],'usdtErcWallet':_0x2ffb01[_0x4e8e4f(0x23a)],'usdcPolygonWallet':_0x2ffb01[_0x4e8e4f(0x1e8)]},'status':_0x2ffb01[_0x4e8e4f(0x1a5)],'createdAt':_0x2ffb01[_0x4e8e4f(0x316)]};}async[a53_0x3f9d8e(0x2ff)](_0x33781a){const _0x4302b5=a53_0x3f9d8e,_0x15d2eb=await database_1['default'][_0x4302b5(0x13c)][_0x4302b5(0x240)]({'where':{'id':_0x33781a},'data':{'status':_0x4302b5(0x301)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'shopUrl2':!![],'shopUrl3':!![],'shopUrl4':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x15d2eb['id'],'fullName':_0x15d2eb[_0x4302b5(0x1ff)],'username':_0x15d2eb[_0x4302b5(0x285)],'telegramId':_0x15d2eb['telegram'],'merchantUrl':_0x15d2eb[_0x4302b5(0x2c6)],'merchantUrl2':_0x15d2eb[_0x4302b5(0x27e)],'merchantUrl3':_0x15d2eb[_0x4302b5(0x23f)],'merchantUrl4':_0x15d2eb[_0x4302b5(0x2e7)],'gateways':_0x15d2eb[_0x4302b5(0x304)]?JSON['parse'](_0x15d2eb[_0x4302b5(0x304)]):null,'gatewaySettings':_0x15d2eb[_0x4302b5(0x1c6)]?JSON['parse'](_0x15d2eb[_0x4302b5(0x1c6)]):null,'publicKey':_0x15d2eb[_0x4302b5(0x166)],'wallets':{'usdtPolygonWallet':_0x15d2eb[_0x4302b5(0x190)],'usdtTrcWallet':_0x15d2eb[_0x4302b5(0x178)],'usdtErcWallet':_0x15d2eb[_0x4302b5(0x23a)],'usdcPolygonWallet':_0x15d2eb[_0x4302b5(0x1e8)]},'status':_0x15d2eb[_0x4302b5(0x1a5)],'createdAt':_0x15d2eb['createdAt']};}async[a53_0x3f9d8e(0x223)](_0x1aa8ad){const _0x5e23aa=a53_0x3f9d8e,_0x1cde85=await database_1['default'][_0x5e23aa(0x13c)][_0x5e23aa(0x240)]({'where':{'id':_0x1aa8ad},'data':{'status':_0x5e23aa(0x287)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'shopUrl2':!![],'shopUrl3':!![],'shopUrl4':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x1cde85['id'],'fullName':_0x1cde85[_0x5e23aa(0x1ff)],'username':_0x1cde85[_0x5e23aa(0x285)],'telegramId':_0x1cde85[_0x5e23aa(0x264)],'merchantUrl':_0x1cde85[_0x5e23aa(0x2c6)],'merchantUrl2':_0x1cde85[_0x5e23aa(0x27e)],'merchantUrl3':_0x1cde85[_0x5e23aa(0x23f)],'merchantUrl4':_0x1cde85[_0x5e23aa(0x2e7)],'gateways':_0x1cde85[_0x5e23aa(0x304)]?JSON[_0x5e23aa(0x20f)](_0x1cde85[_0x5e23aa(0x304)]):null,'gatewaySettings':_0x1cde85[_0x5e23aa(0x1c6)]?JSON[_0x5e23aa(0x20f)](_0x1cde85[_0x5e23aa(0x1c6)]):null,'publicKey':_0x1cde85[_0x5e23aa(0x166)],'wallets':{'usdtPolygonWallet':_0x1cde85['usdtPolygonWallet'],'usdtTrcWallet':_0x1cde85[_0x5e23aa(0x178)],'usdtErcWallet':_0x1cde85['usdtErcWallet'],'usdcPolygonWallet':_0x1cde85[_0x5e23aa(0x1e8)]},'status':_0x1cde85[_0x5e23aa(0x1a5)],'createdAt':_0x1cde85['createdAt']};}async[a53_0x3f9d8e(0x286)](_0x5a4ec6){const _0x4f5d38=a53_0x3f9d8e,{page:_0x7f6204,limit:_0x31af96,status:_0x2c1a52,search:_0x4604d8}=_0x5a4ec6,_0x17d6e6=(_0x7f6204-0x1)*_0x31af96,_0x98dab9={};_0x2c1a52&&(_0x98dab9[_0x4f5d38(0x1a5)]=_0x2c1a52['toUpperCase']());_0x4604d8&&(_0x98dab9['OR']=[{'name':{'contains':_0x4604d8,'mode':_0x4f5d38(0x137)}},{'username':{'contains':_0x4604d8,'mode':'insensitive'}},{'telegram':{'contains':_0x4604d8,'mode':_0x4f5d38(0x137)}},{'shopUrl':{'contains':_0x4604d8,'mode':_0x4f5d38(0x137)}}]);const [_0x529c75,_0x5f1b23]=await Promise[_0x4f5d38(0x1d8)]([database_1[_0x4f5d38(0x194)][_0x4f5d38(0x13c)][_0x4f5d38(0x217)]({'where':_0x98dab9,'skip':_0x17d6e6,'take':_0x31af96,'orderBy':{'createdAt':_0x4f5d38(0x2a2)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'shopUrl2':!![],'shopUrl3':!![],'shopUrl4':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'twoFactorEnabled':!![],'createdAt':!![],'lastLoginAt':!![],'_count':{'select':{'telegramUsers':!![]}}}}),database_1['default']['shop']['count']({'where':_0x98dab9})]);return{'users':_0x529c75['map'](_0x7f66f9=>{const _0x9b03a=_0x4f5d38,_0x5bf94f=_0x7f66f9[_0x9b03a(0x304)]?JSON[_0x9b03a(0x20f)](_0x7f66f9['paymentGateways']):null,_0x16e448=_0x5bf94f?_0x5bf94f[_0x9b03a(0x2bc)](_0x59847c=>this[_0x9b03a(0x15d)](_0x59847c)):null;return{'id':_0x7f66f9['id'],'fullName':_0x7f66f9[_0x9b03a(0x1ff)],'username':_0x7f66f9[_0x9b03a(0x285)],'telegramId':_0x7f66f9[_0x9b03a(0x264)],'merchantUrl':_0x7f66f9[_0x9b03a(0x2c6)],'merchantUrl2':_0x7f66f9[_0x9b03a(0x27e)],'merchantUrl3':_0x7f66f9[_0x9b03a(0x23f)],'merchantUrl4':_0x7f66f9[_0x9b03a(0x2e7)],'gateways':_0x16e448,'gatewaySettings':_0x7f66f9[_0x9b03a(0x1c6)]?JSON[_0x9b03a(0x20f)](_0x7f66f9[_0x9b03a(0x1c6)]):null,'publicKey':_0x7f66f9[_0x9b03a(0x166)],'wallets':{'usdtPolygonWallet':_0x7f66f9[_0x9b03a(0x190)],'usdtTrcWallet':_0x7f66f9[_0x9b03a(0x178)],'usdtErcWallet':_0x7f66f9[_0x9b03a(0x23a)],'usdcPolygonWallet':_0x7f66f9[_0x9b03a(0x1e8)],'usdcErcWallet':_0x7f66f9[_0x9b03a(0x272)]},'status':_0x7f66f9['status'],'twoFactorEnabled':_0x7f66f9[_0x9b03a(0x1a0)]||![],'telegramUsersCount':_0x7f66f9[_0x9b03a(0x2d6)]['telegramUsers'],'createdAt':_0x7f66f9['createdAt'],'lastLoginAt':_0x7f66f9[_0x9b03a(0x1a1)]};}),'pagination':{'page':_0x7f6204,'limit':_0x31af96,'total':_0x5f1b23,'totalPages':Math[_0x4f5d38(0x162)](_0x5f1b23/_0x31af96)}};}async[a53_0x3f9d8e(0x230)](_0x5a43e5){const _0x4bb1da=a53_0x3f9d8e,_0x4fdb3b=await database_1['default']['shop'][_0x4bb1da(0x2aa)]({'where':{'id':_0x5a43e5},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'shopUrl2':!![],'shopUrl3':!![],'shopUrl4':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x4fdb3b)return null;const _0x499e28=_0x4fdb3b[_0x4bb1da(0x304)]?JSON['parse'](_0x4fdb3b[_0x4bb1da(0x304)]):null,_0x3af9c3=_0x499e28?_0x499e28[_0x4bb1da(0x2bc)](_0x44bcef=>this['getGatewayDisplayName'](_0x44bcef)):null;return _0x499e28&&_0x3af9c3&&console[_0x4bb1da(0x18c)](_0x4bb1da(0x1a6),_0x499e28,'->',_0x3af9c3),{'id':_0x4fdb3b['id'],'fullName':_0x4fdb3b[_0x4bb1da(0x1ff)],'username':_0x4fdb3b[_0x4bb1da(0x285)],'telegramId':_0x4fdb3b['telegram'],'merchantUrl':_0x4fdb3b[_0x4bb1da(0x2c6)],'merchantUrl2':_0x4fdb3b[_0x4bb1da(0x27e)],'merchantUrl3':_0x4fdb3b[_0x4bb1da(0x23f)],'merchantUrl4':_0x4fdb3b['shopUrl4'],'gateways':_0x3af9c3,'gatewaySettings':_0x4fdb3b['gatewaySettings']?JSON[_0x4bb1da(0x20f)](_0x4fdb3b[_0x4bb1da(0x1c6)]):null,'publicKey':_0x4fdb3b['publicKey'],'wallets':{'usdtPolygonWallet':_0x4fdb3b[_0x4bb1da(0x190)],'usdtTrcWallet':_0x4fdb3b['usdtTrcWallet'],'usdtErcWallet':_0x4fdb3b[_0x4bb1da(0x23a)],'usdcPolygonWallet':_0x4fdb3b[_0x4bb1da(0x1e8)],'usdcErcWallet':_0x4fdb3b[_0x4bb1da(0x272)]},'status':_0x4fdb3b['status'],'createdAt':_0x4fdb3b[_0x4bb1da(0x316)]};}async[a53_0x3f9d8e(0x2b2)](_0x362d03){const _0x1463a3=a53_0x3f9d8e,{fullName:_0x22a1cd,username:_0x4c7db9,password:_0x205fec,telegramId:_0x4d2901,merchantUrl:_0x1ec248,gateways:_0x1c80c3,gatewaySettings:_0x3ed539,wallets:_0x5f3647}=_0x362d03,_0x16fc61=await database_1[_0x1463a3(0x194)]['shop'][_0x1463a3(0x2aa)]({'where':{'username':_0x4c7db9}});if(_0x16fc61)throw new Error(_0x1463a3(0x28c));if(_0x4d2901){const _0x2aa7da=await database_1['default'][_0x1463a3(0x13c)][_0x1463a3(0x2aa)]({'where':{'telegram':_0x4d2901}});if(_0x2aa7da)throw new Error(_0x1463a3(0x310));}const _0x4e870a=await bcryptjs_1[_0x1463a3(0x194)][_0x1463a3(0x22f)](_0x205fec,0xc),_0x2842e7=_0x1463a3(0x28f)+crypto_1['default']['randomBytes'](0x20)[_0x1463a3(0x2d0)](_0x1463a3(0x2d2)),_0x38d55e=_0x1463a3(0x26c)+crypto_1['default'][_0x1463a3(0x29d)](0x20)[_0x1463a3(0x2d0)](_0x1463a3(0x2d2)),_0x4322bd=_0x1c80c3?_0x1c80c3['map'](_0x342cf6=>this['getGatewayInternalName'](_0x342cf6)):null;_0x1c80c3&&_0x4322bd&&console[_0x1463a3(0x18c)]('ðŸ”„\x20Gateway\x20mapping\x20(create):',_0x1c80c3,'->',_0x4322bd);const _0x319e0d=await database_1[_0x1463a3(0x194)][_0x1463a3(0x13c)][_0x1463a3(0x1d2)]({'data':{'name':_0x22a1cd,'username':_0x4c7db9,'password':_0x4e870a,'telegram':_0x4d2901,'shopUrl':_0x1ec248,'shopUrl2':_0x362d03[_0x1463a3(0x1c8)]||null,'shopUrl3':_0x362d03[_0x1463a3(0x25e)]||null,'shopUrl4':_0x362d03[_0x1463a3(0x191)]||null,'paymentGateways':_0x4322bd?JSON[_0x1463a3(0x24f)](_0x4322bd):null,'gatewaySettings':_0x3ed539?JSON[_0x1463a3(0x24f)](_0x3ed539):null,'usdtPolygonWallet':_0x5f3647?.[_0x1463a3(0x190)]||null,'usdtTrcWallet':_0x5f3647?.[_0x1463a3(0x178)]||null,'usdtErcWallet':_0x5f3647?.[_0x1463a3(0x23a)]||null,'usdcPolygonWallet':_0x5f3647?.[_0x1463a3(0x1e8)]||null,'publicKey':_0x2842e7,'secretKey':_0x38d55e,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'shopUrl2':!![],'shopUrl3':!![],'shopUrl4':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x319e0d['id'],'fullName':_0x319e0d['name'],'username':_0x319e0d[_0x1463a3(0x285)],'telegramId':_0x319e0d['telegram'],'merchantUrl':_0x319e0d['shopUrl'],'merchantUrl2':_0x319e0d[_0x1463a3(0x27e)],'merchantUrl3':_0x319e0d[_0x1463a3(0x23f)],'merchantUrl4':_0x319e0d[_0x1463a3(0x2e7)],'gateways':_0x319e0d['paymentGateways']?JSON[_0x1463a3(0x20f)](_0x319e0d[_0x1463a3(0x304)]):null,'gatewaySettings':_0x319e0d[_0x1463a3(0x1c6)]?JSON['parse'](_0x319e0d['gatewaySettings']):null,'publicKey':_0x319e0d[_0x1463a3(0x166)],'wallets':{'usdtPolygonWallet':_0x319e0d['usdtPolygonWallet'],'usdtTrcWallet':_0x319e0d['usdtTrcWallet'],'usdtErcWallet':_0x319e0d[_0x1463a3(0x23a)],'usdcPolygonWallet':_0x319e0d[_0x1463a3(0x1e8)]},'status':_0x319e0d[_0x1463a3(0x1a5)],'createdAt':_0x319e0d[_0x1463a3(0x316)]};}async['deleteUser'](_0x14b722,_0x40e664){const _0x5e9f36=a53_0x3f9d8e;if(config_1['config'][_0x5e9f36(0x227)][_0x5e9f36(0x1a0)]){if(!_0x40e664)throw new Error(_0x5e9f36(0x271));const _0x303e32=speakeasy_1[_0x5e9f36(0x194)][_0x5e9f36(0x195)][_0x5e9f36(0x167)]({'secret':config_1[_0x5e9f36(0x2d8)][_0x5e9f36(0x227)]['twoFactorSecret'],'encoding':_0x5e9f36(0x2cb),'token':_0x40e664,'window':0x2});if(!_0x303e32){let _0x554775=![];if(config_1['config'][_0x5e9f36(0x227)][_0x5e9f36(0x1c2)]){const _0x1732bb=JSON[_0x5e9f36(0x20f)](config_1['config'][_0x5e9f36(0x227)]['backupCodes']);for(let _0x588b19=0x0;_0x588b19<_0x1732bb[_0x5e9f36(0x239)];_0x588b19++){const _0xf91115=await bcryptjs_1[_0x5e9f36(0x194)]['compare'](_0x40e664,_0x1732bb[_0x588b19]);if(_0xf91115){_0x554775=!![],_0x1732bb[_0x5e9f36(0x1b5)](_0x588b19,0x1),config_1['config'][_0x5e9f36(0x227)]['backupCodes']=JSON[_0x5e9f36(0x24f)](_0x1732bb);const _0x1cd901=path_1[_0x5e9f36(0x194)][_0x5e9f36(0x294)](process['cwd'](),_0x5e9f36(0x16e));if(fs_1[_0x5e9f36(0x194)][_0x5e9f36(0x210)](_0x1cd901)){let _0x1748b5=fs_1[_0x5e9f36(0x194)][_0x5e9f36(0x19e)](_0x1cd901,_0x5e9f36(0x238));const _0x5e9fcf=_0x1748b5['split']('\x0a');for(let _0x3bc517=0x0;_0x3bc517<_0x5e9fcf[_0x5e9f36(0x239)];_0x3bc517++){if(_0x5e9fcf[_0x3bc517][_0x5e9f36(0x161)](_0x5e9f36(0x260))){_0x5e9fcf[_0x3bc517]='ADMIN_BACKUP_CODES='+JSON[_0x5e9f36(0x24f)](_0x1732bb);break;}}fs_1[_0x5e9f36(0x194)][_0x5e9f36(0x251)](_0x1cd901,_0x5e9fcf['join']('\x0a'),'utf8');}break;}}}if(!_0x554775)throw new Error('Invalid\x202FA\x20token\x20or\x20backup\x20code');}}await database_1[_0x5e9f36(0x194)][_0x5e9f36(0x13c)][_0x5e9f36(0x181)]({'where':{'id':_0x14b722}});}async[a53_0x3f9d8e(0x19f)](_0xcf7a2d){const _0x4311ce=a53_0x3f9d8e,_0x291212=await database_1['default'][_0x4311ce(0x13c)][_0x4311ce(0x2aa)]({'where':{'id':_0xcf7a2d},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});if(!_0x291212)throw new Error(_0x4311ce(0x148));return{'usdtPolygonWallet':_0x291212[_0x4311ce(0x190)],'usdtTrcWallet':_0x291212[_0x4311ce(0x178)],'usdtErcWallet':_0x291212[_0x4311ce(0x23a)],'usdcPolygonWallet':_0x291212[_0x4311ce(0x1e8)],'usdcErcWallet':_0x291212['usdcErcWallet']};}[a53_0x3f9d8e(0x313)](_0x376a15=0x8){const _0x417fc9=a53_0x3f9d8e,_0xb87863=[];for(let _0x175ca0=0x0;_0x175ca0<_0x376a15;_0x175ca0++){const _0x30f9dc=crypto_1[_0x417fc9(0x194)][_0x417fc9(0x29d)](0x4)[_0x417fc9(0x2d0)](_0x417fc9(0x2d2))[_0x417fc9(0x14e)]();_0xb87863[_0x417fc9(0x1fa)](_0x30f9dc);}return _0xb87863;}async[a53_0x3f9d8e(0x242)](_0x46eb16){const _0x54f60d=a53_0x3f9d8e,_0x30149f=await database_1[_0x54f60d(0x194)][_0x54f60d(0x13c)]['findUnique']({'where':{'id':_0x46eb16},'select':{'id':!![],'name':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x30149f)throw new Error(_0x54f60d(0x148));const _0x586d6c=speakeasy_1['default'][_0x54f60d(0x312)]({'name':'TrapaPay\x20('+_0x30149f['username']+')','issuer':_0x54f60d(0x23d),'length':0x20}),_0x49d6ba=await qrcode_1[_0x54f60d(0x194)]['toDataURL'](_0x586d6c['otpauth_url']),_0x4b0a6a=this[_0x54f60d(0x313)](0x8),_0x497fdf=await Promise[_0x54f60d(0x1d8)](_0x4b0a6a[_0x54f60d(0x2bc)](_0x1958d6=>bcryptjs_1[_0x54f60d(0x194)][_0x54f60d(0x22f)](_0x1958d6,0xa)));return await database_1['default'][_0x54f60d(0x13c)][_0x54f60d(0x240)]({'where':{'id':_0x46eb16},'data':{'twoFactorSecret':_0x586d6c[_0x54f60d(0x2cb)],'backupCodes':JSON[_0x54f60d(0x24f)](_0x497fdf)}}),console[_0x54f60d(0x18c)]('ðŸ”\x202FA\x20setup\x20initiated\x20for\x20shop:\x20'+_0x30149f[_0x54f60d(0x285)]),console[_0x54f60d(0x18c)](_0x54f60d(0x152)+_0x4b0a6a['length']+_0x54f60d(0x2da)),{'secret':_0x586d6c[_0x54f60d(0x2cb)],'qrCode':_0x49d6ba,'manualEntryKey':_0x586d6c['base32'],'backupCodes':_0x4b0a6a};}async[a53_0x3f9d8e(0x21e)](_0x46e71b,_0x3999fb){const _0x2cffc5=a53_0x3f9d8e,_0x12cce9=await database_1['default']['shop']['findUnique']({'where':{'id':_0x46e71b},'select':{'id':!![],'username':!![],'twoFactorSecret':!![],'twoFactorEnabled':!![]}});if(!_0x12cce9)throw new Error(_0x2cffc5(0x148));if(!_0x12cce9[_0x2cffc5(0x197)])throw new Error(_0x2cffc5(0x211));if(_0x12cce9[_0x2cffc5(0x1a0)])throw new Error(_0x2cffc5(0x19d));const _0xce4282=speakeasy_1['default'][_0x2cffc5(0x195)][_0x2cffc5(0x167)]({'secret':_0x12cce9['twoFactorSecret'],'encoding':'base32','token':_0x3999fb,'window':0x2});if(!_0xce4282)throw new Error(_0x2cffc5(0x18d));return await database_1['default']['shop']['update']({'where':{'id':_0x46e71b},'data':{'twoFactorEnabled':!![]}}),console['log'](_0x2cffc5(0x13d)+_0x12cce9[_0x2cffc5(0x285)]),{'enabled':!![]};}async[a53_0x3f9d8e(0x138)](_0x34c634){const _0x3bc0e4=a53_0x3f9d8e,_0x35592e=await database_1[_0x3bc0e4(0x194)][_0x3bc0e4(0x13c)]['findUnique']({'where':{'id':_0x34c634},'select':{'id':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x35592e)throw new Error(_0x3bc0e4(0x148));await database_1['default']['shop'][_0x3bc0e4(0x240)]({'where':{'id':_0x34c634},'data':{'twoFactorEnabled':![],'twoFactorSecret':null,'backupCodes':null}}),console[_0x3bc0e4(0x18c)]('ðŸ”\x202FA\x20disabled\x20for\x20shop:\x20'+_0x35592e['username']);}async['changeAdminPassword'](_0x323e15,_0x40a921,_0x59b0d6,_0x1fc08b){const _0x2a4bc4=a53_0x3f9d8e;if(_0x40a921!==_0x59b0d6)throw new Error(_0x2a4bc4(0x281));if(_0x40a921[_0x2a4bc4(0x239)]<0x6)throw new Error(_0x2a4bc4(0x21f));const _0x412a9f=await bcryptjs_1['default']['compare'](_0x323e15,config_1[_0x2a4bc4(0x2d8)][_0x2a4bc4(0x227)][_0x2a4bc4(0x2a8)]);if(!_0x412a9f)throw new Error(_0x2a4bc4(0x288));if(config_1[_0x2a4bc4(0x2d8)][_0x2a4bc4(0x227)][_0x2a4bc4(0x1a0)]){if(!_0x1fc08b)throw new Error(_0x2a4bc4(0x271));const _0x563574=speakeasy_1[_0x2a4bc4(0x194)][_0x2a4bc4(0x195)]['verify']({'secret':config_1[_0x2a4bc4(0x2d8)]['admin'][_0x2a4bc4(0x197)],'encoding':_0x2a4bc4(0x2cb),'token':_0x1fc08b,'window':0x2});if(!_0x563574){let _0x542ac4=![];if(config_1[_0x2a4bc4(0x2d8)]['admin'][_0x2a4bc4(0x1c2)]){const _0x6f9e25=JSON[_0x2a4bc4(0x20f)](config_1[_0x2a4bc4(0x2d8)][_0x2a4bc4(0x227)][_0x2a4bc4(0x1c2)]);for(let _0x10de6f=0x0;_0x10de6f<_0x6f9e25[_0x2a4bc4(0x239)];_0x10de6f++){const _0x4b3793=await bcryptjs_1[_0x2a4bc4(0x194)][_0x2a4bc4(0x1a8)](_0x1fc08b,_0x6f9e25[_0x10de6f]);if(_0x4b3793){_0x542ac4=!![],_0x6f9e25[_0x2a4bc4(0x1b5)](_0x10de6f,0x1),config_1[_0x2a4bc4(0x2d8)][_0x2a4bc4(0x227)][_0x2a4bc4(0x1c2)]=JSON[_0x2a4bc4(0x24f)](_0x6f9e25);const _0x386153=path_1[_0x2a4bc4(0x194)][_0x2a4bc4(0x294)](process[_0x2a4bc4(0x243)](),_0x2a4bc4(0x16e));if(fs_1[_0x2a4bc4(0x194)][_0x2a4bc4(0x210)](_0x386153)){let _0x171bf2=fs_1['default']['readFileSync'](_0x386153,_0x2a4bc4(0x238));const _0x13f1d0=_0x171bf2[_0x2a4bc4(0x20e)]('\x0a');for(let _0x3a4a97=0x0;_0x3a4a97<_0x13f1d0['length'];_0x3a4a97++){if(_0x13f1d0[_0x3a4a97]['startsWith'](_0x2a4bc4(0x260))){_0x13f1d0[_0x3a4a97]=_0x2a4bc4(0x260)+JSON[_0x2a4bc4(0x24f)](_0x6f9e25);break;}}fs_1['default']['writeFileSync'](_0x386153,_0x13f1d0[_0x2a4bc4(0x294)]('\x0a'),'utf8');}break;}}}if(!_0x542ac4)throw new Error(_0x2a4bc4(0x1be));}}const _0x59d8f6=await bcryptjs_1['default'][_0x2a4bc4(0x22f)](_0x40a921,0xc);config_1['config'][_0x2a4bc4(0x227)][_0x2a4bc4(0x2a8)]=_0x59d8f6;const _0x37dfea=path_1[_0x2a4bc4(0x194)][_0x2a4bc4(0x294)](process[_0x2a4bc4(0x243)](),_0x2a4bc4(0x16e));let _0x14fdeb='';if(fs_1[_0x2a4bc4(0x194)][_0x2a4bc4(0x210)](_0x37dfea)){_0x14fdeb=fs_1[_0x2a4bc4(0x194)][_0x2a4bc4(0x19e)](_0x37dfea,_0x2a4bc4(0x238));const _0x26391b=_0x14fdeb['split']('\x0a');let _0x4f1f4b=![];for(let _0x452d07=0x0;_0x452d07<_0x26391b['length'];_0x452d07++){if(_0x26391b[_0x452d07][_0x2a4bc4(0x161)](_0x2a4bc4(0x160))){_0x26391b[_0x452d07]=_0x2a4bc4(0x160)+_0x59d8f6,_0x4f1f4b=!![];break;}}!_0x4f1f4b&&_0x26391b[_0x2a4bc4(0x1fa)](_0x2a4bc4(0x160)+_0x59d8f6),_0x14fdeb=_0x26391b[_0x2a4bc4(0x294)]('\x0a'),fs_1[_0x2a4bc4(0x194)][_0x2a4bc4(0x251)](_0x37dfea,_0x14fdeb,_0x2a4bc4(0x238));}console[_0x2a4bc4(0x18c)](_0x2a4bc4(0x28a));}async[a53_0x3f9d8e(0x188)](){const _0x3b913c=a53_0x3f9d8e;let _0x4dbabf=0x0;if(config_1[_0x3b913c(0x2d8)][_0x3b913c(0x227)][_0x3b913c(0x1c2)])try{const _0x4edf21=JSON[_0x3b913c(0x20f)](config_1['config'][_0x3b913c(0x227)][_0x3b913c(0x1c2)]);_0x4dbabf=_0x4edf21[_0x3b913c(0x239)];}catch(_0x21e309){console[_0x3b913c(0x177)](_0x3b913c(0x175),_0x21e309);}return{'twoFactorEnabled':config_1[_0x3b913c(0x2d8)][_0x3b913c(0x227)][_0x3b913c(0x1a0)],'backupCodesCount':_0x4dbabf};}async[a53_0x3f9d8e(0x14c)](){const _0x2c7494=a53_0x3f9d8e,_0x180c00=speakeasy_1[_0x2c7494(0x194)][_0x2c7494(0x312)]({'name':_0x2c7494(0x1e2)+config_1[_0x2c7494(0x2d8)][_0x2c7494(0x227)][_0x2c7494(0x285)]+')','issuer':'TrapaPay\x20Admin','length':0x20}),_0x1770b7=await qrcode_1[_0x2c7494(0x194)][_0x2c7494(0x2b6)](_0x180c00[_0x2c7494(0x153)]),_0x18d03b=[];for(let _0x5df3f9=0x0;_0x5df3f9<0x8;_0x5df3f9++){const _0x2abeef=crypto_1[_0x2c7494(0x194)][_0x2c7494(0x29d)](0x4)[_0x2c7494(0x2d0)](_0x2c7494(0x2d2))[_0x2c7494(0x14e)]();_0x18d03b[_0x2c7494(0x1fa)](_0x2abeef);}const _0x5e1cd2=await Promise['all'](_0x18d03b[_0x2c7494(0x2bc)](_0xd72d2c=>bcryptjs_1['default']['hash'](_0xd72d2c,0xa)));config_1['config'][_0x2c7494(0x227)][_0x2c7494(0x197)]=_0x180c00[_0x2c7494(0x2cb)],config_1[_0x2c7494(0x2d8)][_0x2c7494(0x227)]['backupCodes']=JSON[_0x2c7494(0x24f)](_0x5e1cd2);const _0x46d2be=path_1['default'][_0x2c7494(0x294)](process[_0x2c7494(0x243)](),_0x2c7494(0x16e));if(fs_1[_0x2c7494(0x194)][_0x2c7494(0x210)](_0x46d2be)){let _0x3eeb2f=fs_1[_0x2c7494(0x194)]['readFileSync'](_0x46d2be,_0x2c7494(0x238));const _0x3d2b2=_0x3eeb2f[_0x2c7494(0x20e)]('\x0a');let _0x23db61=![],_0x12bdd5=![];for(let _0x3bee25=0x0;_0x3bee25<_0x3d2b2[_0x2c7494(0x239)];_0x3bee25++){_0x3d2b2[_0x3bee25]['startsWith'](_0x2c7494(0x2ce))&&(_0x3d2b2[_0x3bee25]=_0x2c7494(0x2ce)+_0x180c00[_0x2c7494(0x2cb)],_0x23db61=!![]),_0x3d2b2[_0x3bee25][_0x2c7494(0x161)]('ADMIN_BACKUP_CODES=')&&(_0x3d2b2[_0x3bee25]=_0x2c7494(0x260)+JSON[_0x2c7494(0x24f)](_0x5e1cd2),_0x12bdd5=!![]);}if(!_0x23db61)_0x3d2b2[_0x2c7494(0x1fa)](_0x2c7494(0x2ce)+_0x180c00[_0x2c7494(0x2cb)]);if(!_0x12bdd5)_0x3d2b2[_0x2c7494(0x1fa)](_0x2c7494(0x260)+JSON[_0x2c7494(0x24f)](_0x5e1cd2));fs_1[_0x2c7494(0x194)][_0x2c7494(0x251)](_0x46d2be,_0x3d2b2[_0x2c7494(0x294)]('\x0a'),_0x2c7494(0x238));}return console['log'](_0x2c7494(0x1d3)),console['log'](_0x2c7494(0x152)+_0x18d03b[_0x2c7494(0x239)]+_0x2c7494(0x2da)),{'secret':_0x180c00['base32'],'qrCode':_0x1770b7,'manualEntryKey':_0x180c00[_0x2c7494(0x2cb)],'backupCodes':_0x18d03b};}async[a53_0x3f9d8e(0x15b)](_0x38732b){const _0x567c2d=a53_0x3f9d8e;if(!config_1[_0x567c2d(0x2d8)][_0x567c2d(0x227)][_0x567c2d(0x197)])throw new Error(_0x567c2d(0x211));if(config_1[_0x567c2d(0x2d8)]['admin'][_0x567c2d(0x1a0)])throw new Error(_0x567c2d(0x19d));const _0x1b6b6f=speakeasy_1[_0x567c2d(0x194)][_0x567c2d(0x195)]['verify']({'secret':config_1[_0x567c2d(0x2d8)][_0x567c2d(0x227)][_0x567c2d(0x197)],'encoding':_0x567c2d(0x2cb),'token':_0x38732b,'window':0x2});if(!_0x1b6b6f)throw new Error(_0x567c2d(0x18d));config_1[_0x567c2d(0x2d8)][_0x567c2d(0x227)][_0x567c2d(0x1a0)]=!![];const _0x5ac416=path_1[_0x567c2d(0x194)][_0x567c2d(0x294)](process[_0x567c2d(0x243)](),'.env');if(fs_1[_0x567c2d(0x194)][_0x567c2d(0x210)](_0x5ac416)){let _0x19d5c1=fs_1[_0x567c2d(0x194)][_0x567c2d(0x19e)](_0x5ac416,'utf8');const _0x4b8a00=_0x19d5c1[_0x567c2d(0x20e)]('\x0a');let _0x15f7fb=![];for(let _0x5da847=0x0;_0x5da847<_0x4b8a00[_0x567c2d(0x239)];_0x5da847++){if(_0x4b8a00[_0x5da847][_0x567c2d(0x161)](_0x567c2d(0x2ad))){_0x4b8a00[_0x5da847]=_0x567c2d(0x270),_0x15f7fb=!![];break;}}if(!_0x15f7fb)_0x4b8a00[_0x567c2d(0x1fa)](_0x567c2d(0x270));fs_1[_0x567c2d(0x194)]['writeFileSync'](_0x5ac416,_0x4b8a00[_0x567c2d(0x294)]('\x0a'),'utf8');}return console[_0x567c2d(0x18c)](_0x567c2d(0x241)),{'enabled':!![]};}async[a53_0x3f9d8e(0x1dc)](){const _0xfb6aa0=a53_0x3f9d8e;config_1[_0xfb6aa0(0x2d8)][_0xfb6aa0(0x227)][_0xfb6aa0(0x1a0)]=![],config_1[_0xfb6aa0(0x2d8)]['admin'][_0xfb6aa0(0x197)]='',config_1['config'][_0xfb6aa0(0x227)][_0xfb6aa0(0x1c2)]='';const _0x2ac959=path_1[_0xfb6aa0(0x194)][_0xfb6aa0(0x294)](process[_0xfb6aa0(0x243)](),'.env');if(fs_1[_0xfb6aa0(0x194)][_0xfb6aa0(0x210)](_0x2ac959)){let _0x2e5dc9=fs_1[_0xfb6aa0(0x194)][_0xfb6aa0(0x19e)](_0x2ac959,_0xfb6aa0(0x238));const _0x105012=_0x2e5dc9[_0xfb6aa0(0x20e)]('\x0a');for(let _0x18f740=0x0;_0x18f740<_0x105012[_0xfb6aa0(0x239)];_0x18f740++){_0x105012[_0x18f740][_0xfb6aa0(0x161)](_0xfb6aa0(0x2ad))&&(_0x105012[_0x18f740]=_0xfb6aa0(0x220)),_0x105012[_0x18f740][_0xfb6aa0(0x161)](_0xfb6aa0(0x2ce))&&(_0x105012[_0x18f740]=_0xfb6aa0(0x2ce)),_0x105012[_0x18f740][_0xfb6aa0(0x161)](_0xfb6aa0(0x260))&&(_0x105012[_0x18f740]='ADMIN_BACKUP_CODES=');}fs_1[_0xfb6aa0(0x194)][_0xfb6aa0(0x251)](_0x2ac959,_0x105012[_0xfb6aa0(0x294)]('\x0a'),_0xfb6aa0(0x238));}console[_0xfb6aa0(0x18c)](_0xfb6aa0(0x2e1));}[a53_0x3f9d8e(0x22b)](_0x4be241,_0x11695b,_0x49a96c){const _0x19cb29=a53_0x3f9d8e,_0x58b0f9=new Map(),_0x114b8b=new Date(_0x11695b);while(_0x114b8b<=_0x49a96c){const _0x100efd=_0x114b8b[_0x19cb29(0x309)]()[_0x19cb29(0x20e)]('T')[0x0];_0x58b0f9[_0x19cb29(0x142)](_0x100efd,{'revenue':0x0,'count':0x0}),_0x114b8b[_0x19cb29(0x1ac)](_0x114b8b[_0x19cb29(0x23c)]()+0x1);}for(const _0x46e401 of _0x4be241){const _0x7617a=_0x46e401[_0x19cb29(0x316)][_0x19cb29(0x309)]()[_0x19cb29(0x20e)]('T')[0x0],_0x26ddd2=_0x58b0f9[_0x19cb29(0x21a)](_0x7617a);_0x26ddd2&&(_0x26ddd2['count']+=0x1,_0x46e401[_0x19cb29(0x1a5)]===_0x19cb29(0x2a1)&&(_0x46e401[_0x19cb29(0x145)]?_0x26ddd2[_0x19cb29(0x30b)]+=_0x46e401[_0x19cb29(0x145)]:console[_0x19cb29(0x18c)](_0x19cb29(0x2ca)+_0x46e401['id']+_0x19cb29(0x219))));}const _0x4090de=[],_0xac43fe=[];for(const [_0x41cdd2,_0x11a1da]of _0x58b0f9){_0x4090de['push']({'date':_0x41cdd2,'amount':Math[_0x19cb29(0x2de)](_0x11a1da['revenue']*0x64)/0x64}),_0xac43fe['push']({'date':_0x41cdd2,'count':_0x11a1da[_0x19cb29(0x1af)]});}return{'dailyRevenue':_0x4090de,'dailyPayments':_0xac43fe};}async[a53_0x3f9d8e(0x254)](_0x1afa6b){const _0xc2fb1a=a53_0x3f9d8e;console[_0xc2fb1a(0x18c)](_0xc2fb1a(0x158),_0x1afa6b);const _0x31e485=new Date(_0x1afa6b[_0xc2fb1a(0x1bd)]),_0x510ed9=new Date(_0x1afa6b[_0xc2fb1a(0x2f1)]),_0x2cdecd=new Date(Date['UTC'](_0x31e485[_0xc2fb1a(0x2eb)](),_0x31e485[_0xc2fb1a(0x151)](),_0x31e485[_0xc2fb1a(0x193)](),0x0,0x0,0x0,0x0)),_0x278f67=new Date(Date[_0xc2fb1a(0x20b)](_0x510ed9[_0xc2fb1a(0x2eb)](),_0x510ed9[_0xc2fb1a(0x151)](),_0x510ed9[_0xc2fb1a(0x193)](),0x17,0x3b,0x3b,0x3e7));console[_0xc2fb1a(0x18c)](_0xc2fb1a(0x1e3)+_0x2cdecd[_0xc2fb1a(0x309)]()+_0xc2fb1a(0x1d7)+_0x278f67['toISOString']()),console[_0xc2fb1a(0x18c)]('ðŸ”Œ\x20Gateway:\x20'+_0x1afa6b[_0xc2fb1a(0x1c5)]);const _0x450a5c=await database_1[_0xc2fb1a(0x194)][_0xc2fb1a(0x249)]['findMany']({'where':{'status':_0xc2fb1a(0x2a1),'gateway':_0x1afa6b[_0xc2fb1a(0x1c5)]['toLowerCase'](),'createdAt':{'gte':_0x2cdecd,'lte':_0x278f67}},'select':{'id':!![],'shopId':!![],'amountAfterGatewayCommissionUSDT':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console[_0xc2fb1a(0x18c)](_0xc2fb1a(0x16b)+_0x450a5c[_0xc2fb1a(0x239)]+_0xc2fb1a(0x308)+_0x1afa6b[_0xc2fb1a(0x1c5)]);const _0x607972=new Map();for(const _0x2b5b85 of _0x450a5c){const _0x54991e=_0x2b5b85[_0xc2fb1a(0x1fb)]||0x0;if(_0x54991e<=0x0){console['warn'](_0xc2fb1a(0x2ca)+_0x2b5b85['id']+_0xc2fb1a(0x2e5));continue;}if(_0x607972[_0xc2fb1a(0x2a0)](_0x2b5b85['shopId'])){const _0xa85996=_0x607972['get'](_0x2b5b85[_0xc2fb1a(0x17c)]);_0xa85996[_0xc2fb1a(0x1b2)]+=_0x54991e;}else _0x607972[_0xc2fb1a(0x142)](_0x2b5b85[_0xc2fb1a(0x17c)],{'merchantId':_0x2b5b85['shop']['id'],'merchantName':_0x2b5b85[_0xc2fb1a(0x13c)][_0xc2fb1a(0x1ff)],'merchantUsername':_0x2b5b85[_0xc2fb1a(0x13c)][_0xc2fb1a(0x285)],'totalAmount':_0x54991e});}const _0x2d5e5d=Array[_0xc2fb1a(0x29a)](_0x607972[_0xc2fb1a(0x317)]())[_0xc2fb1a(0x2bc)](_0x22e1a5=>({'merchantId':_0x22e1a5[_0xc2fb1a(0x18e)],'merchantName':_0x22e1a5['merchantName'],'merchantUsername':_0x22e1a5['merchantUsername'],'gateway':_0x1afa6b['gateway'],'periodFrom':_0x1afa6b[_0xc2fb1a(0x1bd)],'periodTo':_0x1afa6b['periodTo'],'totalAmount':Math[_0xc2fb1a(0x2de)](_0x22e1a5[_0xc2fb1a(0x1b2)]*0x64)/0x64}));return _0x2d5e5d[_0xc2fb1a(0x24e)]((_0x2974b6,_0x23413e)=>_0x23413e['totalAmount']-_0x2974b6[_0xc2fb1a(0x1b2)]),console['log'](_0xc2fb1a(0x229)+_0x2d5e5d[_0xc2fb1a(0x239)]+'\x20merchants'),_0x2d5e5d;}async['depositBalance'](_0x22557d,_0x486c5f,_0x36bf90){const _0x111ef6=a53_0x3f9d8e,_0xd20158=await database_1[_0x111ef6(0x194)][_0x111ef6(0x13c)][_0x111ef6(0x2aa)]({'where':{'id':_0x22557d}});if(!_0xd20158)throw new Error(_0x111ef6(0x2e8));await database_1[_0x111ef6(0x194)][_0x111ef6(0x2cc)](async _0x11f721=>{const _0x353467=_0x111ef6;await _0x11f721[_0x353467(0x249)][_0x353467(0x1d2)]({'data':{'shopId':_0xd20158['id'],'amount':_0x486c5f,'amountUSDT':_0x486c5f,'amountAfterGatewayCommissionUSDT':_0x486c5f,'sourceCurrency':_0x353467(0x150),'currency':_0x353467(0x150),'status':_0x353467(0x2a1),'gateway':_0x353467(0x2dd),'customerName':_0xd20158[_0x353467(0x285)],'customerEmail':'@'+_0xd20158[_0x353467(0x264)],'paymentMethod':_0x353467(0x245),'adminNotes':_0x36bf90||null,'successUrl':'-','failUrl':'-','paidAt':new Date()}}),await _0x11f721[_0x353467(0x13c)]['update']({'where':{'id':_0xd20158['id']},'data':{'balance':{'increment':_0x486c5f}}});}),console[_0x111ef6(0x18c)](_0x111ef6(0x15a)+_0x486c5f+_0x111ef6(0x252)+_0xd20158[_0x111ef6(0x285)]);}}exports['AdminService']=AdminService;