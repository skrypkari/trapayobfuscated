'use strict';function a35_0x4d4e(){const _0x5defee=['30d','üîÑ\x20Converted\x20gateway\x20ID\x20\x27','stringify','createPayout','totalPaidOut','1035270DNfHFO','__esModule','Noda','telegram','sort','revenue','customerCountry','getMerchantsAwaitingPayout','üìÖ\x20Period:\x20','asc','payment','gateways','üìä\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','awaitingPayout','\x20USDT','all','name','customerUa','thisMonth','AdminService','deleteUser','fullName','some','üìä\x20Merchant\x20statistics\x20calculated:','toFixed','not\x20specified','CHARGEBACK','Username\x20already\x20exists','periodTo','\x20\x20\x20üîç\x20Raw\x20balance\x20sum:\x20','‚úÖ\x20Payout\x20created:\x20','\x20for\x20shop\x20','totalAmountUSDT','min','üìã\x20Found\x20','\x20USDT\x20total','updatePaymentStatus','network','\x20USDT\x20to\x20balance','gte','0000','Rapyd','\x20USDT\x20(total\x20paid\x20to\x20merchants)','üìã\x20Getting\x20merchants\x20selection\x20list...','usdtPolygonWallet','\x20\x20\x20Payout\x20amount:\x20','\x20\x20\x20üí∞\x20Total\x20payout:\x20','usdtErcWallet','\x20->\x20','usdcPolygonWallet','getGatewayDisplayName','\x20balance\x20updated:\x20','shopUrl','üí∞\x20Shop\x20','pk_','paidOutUSDT','pendingUrl','password','getTime','gateway','convertToUSDT','\x27\x20(from\x20\x27','\x20to\x20','Insufficient\x20balance.\x20Available:\x20','2020-01-01','trc20','1kipPOZ','\x20\x20\x20Transaction\x20hash:\x20','totalTurnover','findUnique','\x20\x20\x20‚úÖ\x20Using\x20actual\x20balance:\x20','failUrl','orderId','customerIp','update','merchantEarningsUSDT','notes','üìä\x20Getting\x20payments\x20with\x20filters:','üí±\x20Currency\x20filter\x20applied:\x20','\x20\x20\x20‚ö†Ô∏è\x20\x20Balance\x20is\x20less\x20than\x20calculated\x20-\x20payouts\x20detected','getGatewayNameById','getMonth','Telegram\x20username\x20already\x20exists','üìä\x20Final\x20WHERE\x20conditions:','wallet','üîç\x20Using\x20gateway\x20\x27','findMany','../types/gateway','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','publicKey','values','period','üí∏\x20CHARGEBACK\x20penalty:\x20-','gatewayEarnings','failureMessage','üí∞\x20Found\x20','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','gatewaySettings','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','üìä\x20Sorting\x20payments\x20by\x20','updateCustomerData','getPaymentById','averageCommissionRate','updatedAt','status','_sum','üí∞\x20Creating\x20payout\x20for\x20shop\x20','üí∞\x20Payment\x20','deletePayout','\x20no\x20longer\x20PAID:\x20-','ceil','getAllUsers','successUrl','balance','900518nbGAZn','get','./currencyService','chargebackAmount','reduce','count','gatewayOrderId','\x20\x20\x20Calculated\x20after\x20commission:\x20','NONEXISTENT_GATEWAY_FILTER','wallets','txid','getMerchantStatistics','\x27\x20not\x20found.\x20Available\x20gateways:\x20','merchantEarnings','üí≥\x20Payout\x20wallet\x20for\x20','username','\x20merchants\x20with\x20positive\x20balance','\x20\x20\x20üåê\x20IP:\x20','split','test_gateway','PAID','shop','statusChangedBy','sk_','getDate','amountUSDT','KLYME\x20EU','üí∞\x20Current\x20shop\x20balance:\x20','generateDailyStatistics','\x20\x20\x20üñ•Ô∏è\x20User\x20Agent:\x20','\x20balance\x20updated:','availableBalance','\x27\x20->\x20ID\x20\x27','createUser','push','month','\x20\x20\x20üí∞\x20Total\x20turnover:\x20','externalPaymentUrl','63423InXBOn','commissionUSDT','currency','getGatewayIdByName','Test\x20Gateway','updateUser','amount','date','merchantUrl','\x20USDT)','4751776rGqNIg','üîÑ\x20Converted\x20gateway\x20name\x20\x27','üìä\x20Available\x20gateways\x20in\x20database:','COMPLETED','createdAt','\x20\x20\x20üë§\x20Merchant\x20earnings:\x20','crypto','KLYME\x20DE','custom','‚ö†Ô∏è\x20Requested\x20gateway\x20\x27','paidAt','\x20\x20\x20Raw\x20total\x20from\x20payments:\x20','\x20USDT\x20from\x20balance','getUserById','../config/database',':\x20commission\x20=\x20','110780waqgPp','\x20payments)','aggregate','__importDefault','üìä\x20Getting\x20merchant\x20statistics\x20with\x20filters:','toUpperCase','SUSPENDED','polygon','\x20\x20\x20üìÖ\x20This\x20month:\x20','Shop\x20not\x20found','telegramId','findFirst','üìÖ\x20Period\x20\x27all\x27:\x20Using\x20start\x20date\x20from\x20first\x20payment:\x20','getFullYear','‚ö†Ô∏è\x20Gateway\x20\x27','\x20\x20\x20Balance:\x20','1261482QOiEif','usdtTrcWallet','default','turnover','\x20order','dateTo','üîÑ\x20Updating\x20customer\x20data\x20for\x20payment\x20','map','log','getSystemStatistics','$transaction','toLowerCase','dateFrom','payout','desc','paymentGateways','join','set','create','entries','\x20\x20\x20üíµ\x20Available\x20balance:\x20','\x27\x20to\x20name\x20\x27','\x20merchants,\x20','shopId','9IFjUPJ','üìä\x20Total\x20payments\x20(including\x20failed):\x20','REFUND','hex','hash','paymentsCount','summary','\x20USDT\x20(without\x20commission)','üìä\x20Payout\x20statistics\x20calculated:','14541810GXAwTD','\x20USDT\x20(after\x20payouts)','forEach','\x20USDT\x20(with\x20commission\x20deducted)','parse','\x20\x20\x20Total\x20paid\x20out:\x20','\x20\x20\x20üìä\x20Total\x20payments:\x20','21XElSvF','amountAfterCommissionUSDT','getAllPayouts','totalAmountAfterCommissionUSDT','\x20\x20\x20Current\x20balance:\x20','setDate','dailyRevenue','_count','customerName','currencyService','whiteUrl','randomBytes','includes','lte','‚úÖ\x20Using\x20gateway\x20filter:\x20\x27','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','\x20USDT\x20(same\x20as\x20awaiting)','year','üìä\x20Merchants\x20awaiting\x20payout:\x20','activateUser','\x20USDT\x20(','\x20became\x20PAID:\x20+','CoinToPay','commission','toISOString','length','not\x20set','insensitive','delete','error','getAllPayments','suspendUser','round','üí∞\x20[PAYOUT]\x20Merchant\x20','customerEmail','periodFrom','\x20in\x20','ACTIVE','week','getPayoutStats','toString','\x20paid\x20payments\x20for\x20analysis','groupBy','statusChangedAt','\x20active\x20merchants\x20for\x20selection','turnoverUSDT','Payment\x20not\x20found','averageCheckUSDT','totalCommissionRate'];a35_0x4d4e=function(){return _0x5defee;};return a35_0x4d4e();}const a35_0x16eb82=a35_0xeff8;(function(_0x4b9a0b,_0x355ffb){const _0x517f4a=a35_0xeff8,_0x15ca97=_0x4b9a0b();while(!![]){try{const _0x4469d8=parseInt(_0x517f4a(0x1b7))/0x1*(parseInt(_0x517f4a(0x1e7))/0x2)+-parseInt(_0x517f4a(0xed))/0x3+parseInt(_0x517f4a(0x107))/0x4+parseInt(_0x517f4a(0x175))/0x5+parseInt(_0x517f4a(0x117))/0x6*(parseInt(_0x517f4a(0x13f))/0x7)+parseInt(_0x517f4a(0xf7))/0x8+parseInt(_0x517f4a(0x12f))/0x9*(-parseInt(_0x517f4a(0x138))/0xa);if(_0x4469d8===_0x355ffb)break;else _0x15ca97['push'](_0x15ca97['shift']());}catch(_0x583aa7){_0x15ca97['push'](_0x15ca97['shift']());}}}(a35_0x4d4e,0x6a0df));var __importDefault=this&&this[a35_0x16eb82(0x10a)]||function(_0x573168){const _0x2f469e=a35_0x16eb82;return _0x573168&&_0x573168[_0x2f469e(0x176)]?_0x573168:{'default':_0x573168};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['AdminService']=void 0x0;const database_1=__importDefault(require(a35_0x16eb82(0x105))),bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a35_0x16eb82(0xfd))),currencyService_1=require(a35_0x16eb82(0x1e9)),gateway_1=require(a35_0x16eb82(0x1cc));function a35_0xeff8(_0x49c1e2,_0x5620a5){const _0x4d4e36=a35_0x4d4e();return a35_0xeff8=function(_0xeff8a1,_0x1993a9){_0xeff8a1=_0xeff8a1-0xd4;let _0x500e98=_0x4d4e36[_0xeff8a1];return _0x500e98;},a35_0xeff8(_0x49c1e2,_0x5620a5);}class AdminService{async[a35_0x16eb82(0x166)](){const _0x2e3d42=a35_0x16eb82;console[_0x2e3d42(0x11f)]('üìä\x20Calculating\x20payout\x20statistics...');const _0x694c59=await database_1[_0x2e3d42(0x119)][_0x2e3d42(0xdc)]['aggregate']({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':'ACTIVE'}}),_0x48c123=await this[_0x2e3d42(0x17c)]({'page':0x1,'limit':0x3e8}),_0x374beb=new Date(),_0x2d09d3=new Date(_0x374beb[_0x2e3d42(0x114)](),_0x374beb[_0x2e3d42(0x1c6)](),0x1),_0xa0acf9=new Date(_0x374beb['getFullYear'](),_0x374beb[_0x2e3d42(0x1c6)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x54f6c9=await database_1[_0x2e3d42(0x119)][_0x2e3d42(0x124)][_0x2e3d42(0x109)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x2d09d3,'lte':_0xa0acf9},'status':_0x2e3d42(0xfa)}}),_0x4339ac=_0x694c59['_sum'][_0x2e3d42(0x174)]||0x0,_0x221fe5=_0x48c123[_0x2e3d42(0x135)][_0x2e3d42(0x142)],_0x2c46a5=_0x54f6c9[_0x2e3d42(0x1de)][_0x2e3d42(0xf3)]||0x0,_0x535824={'totalPayout':Math['round'](_0x4339ac*0x64)/0x64,'awaitingPayout':Math['round'](_0x221fe5*0x64)/0x64,'thisMonth':Math[_0x2e3d42(0x15f)](_0x2c46a5*0x64)/0x64,'availableBalance':Math[_0x2e3d42(0x15f)](_0x221fe5*0x64)/0x64};return console[_0x2e3d42(0x11f)](_0x2e3d42(0x137)),console['log'](_0x2e3d42(0x1a3)+_0x535824['totalPayout']+_0x2e3d42(0x19f)),console[_0x2e3d42(0x11f)](_0x2e3d42(0x1d5)+_0x535824[_0x2e3d42(0x182)]+_0x2e3d42(0x13b)),console[_0x2e3d42(0x11f)](_0x2e3d42(0x12b)+_0x535824[_0x2e3d42(0xe6)]+_0x2e3d42(0x14f)),console['log'](_0x2e3d42(0x10f)+_0x535824[_0x2e3d42(0x187)]+_0x2e3d42(0x183)),console[_0x2e3d42(0x11f)](_0x2e3d42(0x192)+(_0x694c59[_0x2e3d42(0x1de)][_0x2e3d42(0x1e6)]||0x0)['toFixed'](0x2)+_0x2e3d42(0x136)),console[_0x2e3d42(0x11f)]('\x20\x20\x20üìä\x20Commission\x20difference:\x20'+((_0x694c59[_0x2e3d42(0x1de)][_0x2e3d42(0x1e6)]||0x0)-_0x221fe5)[_0x2e3d42(0x18d)](0x2)+_0x2e3d42(0x183)),_0x535824;}async[a35_0x16eb82(0x1d9)](_0x5a4ffe,_0x3aa09c){const _0x3004ce=a35_0x16eb82;console[_0x3004ce(0x11f)](_0x3004ce(0x11d)+_0x5a4ffe+':',_0x3aa09c);const _0x10d243=await database_1[_0x3004ce(0x119)][_0x3004ce(0x17f)]['findUnique']({'where':{'id':_0x5a4ffe},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x10d243)throw new Error(_0x3004ce(0x16d));const _0x4d23eb={};_0x3aa09c[_0x3004ce(0x17b)]!==undefined&&(_0x4d23eb[_0x3004ce(0x17b)]=_0x3aa09c['customerCountry']||null);_0x3aa09c[_0x3004ce(0x1be)]!==undefined&&(_0x4d23eb[_0x3004ce(0x1be)]=_0x3aa09c[_0x3004ce(0x1be)]||null);_0x3aa09c['customerUa']!==undefined&&(_0x4d23eb[_0x3004ce(0x186)]=_0x3aa09c[_0x3004ce(0x186)]||null);const _0x4e5114=await database_1['default'][_0x3004ce(0x17f)][_0x3004ce(0x1bf)]({'where':{'id':_0x5a4ffe},'data':{..._0x4d23eb,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console['log']('‚úÖ\x20Customer\x20data\x20updated\x20for\x20payment\x20'+_0x5a4ffe),console['log']('\x20\x20\x20üåç\x20Country:\x20'+_0x10d243[_0x3004ce(0x17b)]+_0x3004ce(0x1a5)+_0x4e5114['customerCountry']),console[_0x3004ce(0x11f)](_0x3004ce(0xd8)+_0x10d243[_0x3004ce(0x1be)]+'\x20->\x20'+_0x4e5114[_0x3004ce(0x1be)]),console[_0x3004ce(0x11f)](_0x3004ce(0xe4)+(_0x10d243[_0x3004ce(0x186)]?_0x3004ce(0x128):_0x3004ce(0x159))+_0x3004ce(0x1a5)+(_0x4e5114[_0x3004ce(0x186)]?_0x3004ce(0x128):_0x3004ce(0x159))),_0x4e5114;}async[a35_0x16eb82(0x120)](_0x28a888){const _0x1a087c=a35_0x16eb82,_0x3b6239=new Date();let _0x3726ae;switch(_0x28a888){case'7d':_0x3726ae=new Date(_0x3b6239[_0x1a087c(0x1af)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x1a087c(0x170):_0x3726ae=new Date(_0x3b6239[_0x1a087c(0x1af)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'90d':_0x3726ae=new Date(_0x3b6239[_0x1a087c(0x1af)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x1a087c(0x184):const _0x1abc04=await database_1[_0x1a087c(0x119)][_0x1a087c(0x17f)][_0x1a087c(0x112)]({'where':{'gateway':{'not':_0x1a087c(0xda)}},'orderBy':{'createdAt':_0x1a087c(0x17e)},'select':{'createdAt':!![]}});_0x3726ae=_0x1abc04?_0x1abc04[_0x1a087c(0xfb)]:new Date(_0x1a087c(0x1b5)),console[_0x1a087c(0x11f)](_0x1a087c(0x113)+_0x3726ae[_0x1a087c(0x157)]());break;default:_0x3726ae=new Date(_0x3b6239[_0x1a087c(0x1af)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x4ea8c8,_0x55bec8,_0x4a7b37,_0xf5a86f,_0x49c1d2,_0x426cd8,_0x214596]=await Promise['all']([database_1[_0x1a087c(0x119)][_0x1a087c(0xdc)]['count'](),database_1[_0x1a087c(0x119)][_0x1a087c(0xdc)][_0x1a087c(0x1ec)]({'where':{'status':_0x1a087c(0x164)}}),database_1[_0x1a087c(0x119)][_0x1a087c(0x17f)][_0x1a087c(0x1ec)]({'where':{'createdAt':{'gte':_0x3726ae},'gateway':{'not':_0x1a087c(0xda)}}}),database_1[_0x1a087c(0x119)]['payment'][_0x1a087c(0x1ec)]({'where':{'status':_0x1a087c(0xdb),'createdAt':{'gte':_0x3726ae},'gateway':{'not':_0x1a087c(0xda)}}}),database_1[_0x1a087c(0x119)][_0x1a087c(0x17f)]['findMany']({'where':{'status':_0x1a087c(0xdb),'createdAt':{'gte':_0x3726ae},'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![]}}),database_1['default'][_0x1a087c(0x17f)]['findMany']({'where':{'gateway':{'not':_0x1a087c(0xda)}},'take':0xa,'orderBy':{'createdAt':_0x1a087c(0x125)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x1a087c(0x119)][_0x1a087c(0x17f)]['findMany']({'where':{'createdAt':{'gte':_0x3726ae},'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x3bedd8=0x0;for(const _0x2315f7 of _0x49c1d2){const _0x52f11e=await currencyService_1[_0x1a087c(0x148)][_0x1a087c(0x1b1)](_0x2315f7['amount'],_0x2315f7['currency']);_0x3bedd8+=_0x52f11e;}const _0x5118c3=this[_0x1a087c(0xe3)](_0x214596,_0x3726ae,_0x3b6239),_0x4dc1cc=_0x4a7b37>0x0?_0xf5a86f/_0x4a7b37*0x64:0x0;return{'totalShops':_0x4ea8c8,'activeShops':_0x55bec8,'totalPayments':_0x4a7b37,'successfulPayments':_0xf5a86f,'totalRevenue':Math[_0x1a087c(0x15f)](_0x3bedd8*0x64)/0x64,'conversionRate':Math[_0x1a087c(0x15f)](_0x4dc1cc*0x64)/0x64,'dailyRevenue':_0x5118c3[_0x1a087c(0x145)],'dailyPayments':_0x5118c3['dailyPayments'],'recentPayments':_0x426cd8[_0x1a087c(0x11e)](_0x48b7b4=>({'id':_0x48b7b4['id'],'amount':_0x48b7b4[_0x1a087c(0xf3)],'currency':_0x48b7b4[_0x1a087c(0xef)],'status':_0x48b7b4[_0x1a087c(0x1dd)],'gateway':_0x48b7b4['gateway'],'shop':_0x48b7b4[_0x1a087c(0xdc)],'createdAt':_0x48b7b4['createdAt']}))};}async[a35_0x16eb82(0x1f2)](_0x1e56ab){const _0x334988=a35_0x16eb82;console[_0x334988(0x11f)](_0x334988(0x10b),_0x1e56ab);let _0x1c9a9d,_0x344353=new Date();if(_0x1e56ab[_0x334988(0x1d0)]===_0x334988(0xff)&&_0x1e56ab[_0x334988(0x123)]&&_0x1e56ab[_0x334988(0x11c)])_0x1c9a9d=new Date(_0x1e56ab[_0x334988(0x123)]),_0x344353=new Date(_0x1e56ab[_0x334988(0x11c)]);else{const _0x985dc6=new Date();switch(_0x1e56ab[_0x334988(0x1d0)]){case _0x334988(0x165):_0x1c9a9d=new Date(_0x985dc6[_0x334988(0x1af)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x334988(0xea):_0x1c9a9d=new Date(_0x985dc6[_0x334988(0x1af)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x334988(0x150):_0x1c9a9d=new Date(_0x985dc6[_0x334988(0x1af)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case'all':default:_0x1c9a9d=new Date(_0x334988(0x1b5));break;}}console[_0x334988(0x11f)](_0x334988(0x17d)+_0x1c9a9d[_0x334988(0x157)]()+_0x334988(0x1b3)+_0x344353['toISOString']());const _0xdee956={'status':'PAID','gateway':{'not':_0x334988(0xda)},'paidAt':{'gte':_0x1c9a9d,'lte':_0x344353}};_0x1e56ab[_0x334988(0x12e)]&&(_0xdee956[_0x334988(0x12e)]=_0x1e56ab[_0x334988(0x12e)]);const _0x4bc55b=await database_1[_0x334988(0x119)][_0x334988(0x17f)][_0x334988(0x1cb)]({'where':_0xdee956,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x334988(0x11f)](_0x334988(0x1d4)+_0x4bc55b['length']+_0x334988(0x168));const _0x4538d7={'gateway':{'not':'test_gateway'},'createdAt':{'gte':_0x1c9a9d,'lte':_0x344353}};_0x1e56ab[_0x334988(0x12e)]&&(_0x4538d7[_0x334988(0x12e)]=_0x1e56ab['shopId']);const _0x2d2838=await database_1[_0x334988(0x119)][_0x334988(0x17f)][_0x334988(0x1ec)]({'where':_0x4538d7});console[_0x334988(0x11f)](_0x334988(0x130)+_0x2d2838+',\x20successful:\x20'+_0x4bc55b[_0x334988(0x158)]);let _0x2042c8=0x0,_0x51a861=0x0,_0x1c35ec=0x0;const _0x5a92ff={},_0x2de8d9={},_0x46e83a={};for(const _0x21fa6c of _0x4bc55b){try{const _0x54036d=await currencyService_1[_0x334988(0x148)][_0x334988(0x1b1)](_0x21fa6c[_0x334988(0xf3)],_0x21fa6c['currency']);let _0x4a2764={};if(_0x21fa6c[_0x334988(0xdc)][_0x334988(0x1d6)])try{_0x4a2764=JSON[_0x334988(0x13c)](_0x21fa6c['shop'][_0x334988(0x1d6)]);}catch(_0x4a8618){console[_0x334988(0x15c)](_0x334988(0x1d7)+_0x21fa6c[_0x334988(0x12e)]+':',_0x4a8618);}let _0x46e25d={},_0x58fbeb=0xa;for(const [_0x51792b,_0xbb75b1]of Object[_0x334988(0x12a)](_0x4a2764)){if(_0x51792b[_0x334988(0x122)]()===_0x21fa6c['gateway'][_0x334988(0x122)]()){_0x46e25d=_0xbb75b1,_0x58fbeb=_0xbb75b1['commission']||0xa;break;}}const _0x396280=_0x54036d*(_0x58fbeb/0x64),_0x176d7d=_0x54036d-_0x396280;_0x2042c8+=_0x54036d,_0x51a861+=_0x176d7d,_0x1c35ec+=_0x396280;!_0x5a92ff[_0x21fa6c['gateway']]&&(_0x5a92ff[_0x21fa6c[_0x334988(0x1b0)]]={'gateway':_0x21fa6c['gateway'],'gatewayDisplayName':this[_0x334988(0x1a7)](_0x21fa6c['gateway']),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x5a92ff[_0x21fa6c[_0x334988(0x1b0)]][_0x334988(0x134)]++,_0x5a92ff[_0x21fa6c[_0x334988(0x1b0)]][_0x334988(0x16c)]+=_0x54036d,_0x5a92ff[_0x21fa6c[_0x334988(0x1b0)]]['commissionUSDT']+=_0x396280,_0x5a92ff[_0x21fa6c['gateway']][_0x334988(0x1c0)]+=_0x176d7d,_0x5a92ff[_0x21fa6c[_0x334988(0x1b0)]][_0x334988(0x16f)]+=_0x58fbeb;!_0x1e56ab['shopId']&&(!_0x2de8d9[_0x21fa6c['shopId']]&&(_0x2de8d9[_0x21fa6c[_0x334988(0x12e)]]={'shopId':_0x21fa6c[_0x334988(0x12e)],'shopName':_0x21fa6c[_0x334988(0xdc)][_0x334988(0x185)],'shopUsername':_0x21fa6c[_0x334988(0xdc)][_0x334988(0xd6)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x2de8d9[_0x21fa6c['shopId']][_0x334988(0x134)]++,_0x2de8d9[_0x21fa6c['shopId']]['turnoverUSDT']+=_0x54036d,_0x2de8d9[_0x21fa6c['shopId']][_0x334988(0xee)]+=_0x396280,_0x2de8d9[_0x21fa6c[_0x334988(0x12e)]][_0x334988(0x1c0)]+=_0x176d7d);const _0x3dd16d=_0x21fa6c[_0x334988(0x101)][_0x334988(0x157)]()[_0x334988(0xd9)]('T')[0x0];!_0x46e83a[_0x3dd16d]&&(_0x46e83a[_0x3dd16d]={'date':_0x3dd16d,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x46e83a[_0x3dd16d]['turnover']+=_0x54036d,_0x46e83a[_0x3dd16d][_0x334988(0xd4)]+=_0x176d7d,_0x46e83a[_0x3dd16d]['gatewayEarnings']+=_0x396280,_0x46e83a[_0x3dd16d][_0x334988(0x134)]++;}catch(_0xb88b07){console[_0x334988(0x15c)]('Error\x20processing\x20payment\x20'+_0x21fa6c['id']+':',_0xb88b07);}}Object[_0x334988(0x1cf)](_0x5a92ff)['forEach'](_0x222736=>{const _0x626cc9=_0x334988;_0x222736[_0x626cc9(0x1db)]=_0x222736[_0x626cc9(0x134)]>0x0?_0x222736[_0x626cc9(0x16f)]/_0x222736[_0x626cc9(0x134)]:0x0,delete _0x222736[_0x626cc9(0x16f)];}),Object[_0x334988(0x1cf)](_0x2de8d9)[_0x334988(0x13a)](_0x11e26e=>{const _0x3fdcfb=_0x334988;_0x11e26e[_0x3fdcfb(0x16e)]=_0x11e26e['paymentsCount']>0x0?_0x11e26e[_0x3fdcfb(0x16c)]/_0x11e26e[_0x3fdcfb(0x134)]:0x0;});let _0x35ba22=0x0;if(_0x1e56ab[_0x334988(0x12e)]){const _0x7814c8=await database_1['default'][_0x334988(0x124)][_0x334988(0x1cb)]({'where':{'shopId':_0x1e56ab[_0x334988(0x12e)],'status':_0x334988(0xfa),'createdAt':{'gte':_0x1c9a9d,'lte':_0x344353}},'select':{'amount':!![]}});_0x35ba22=_0x7814c8[_0x334988(0x1eb)]((_0x39b689,_0x348353)=>_0x39b689+_0x348353[_0x334988(0xf3)],0x0);}const _0x246540=_0x2d2838,_0x5086bd=_0x4bc55b[_0x334988(0x158)],_0x429a02=_0x5086bd>0x0?_0x2042c8/_0x5086bd:0x0,_0x17d19c=_0x246540>0x0?Math[_0x334988(0x15f)](_0x5086bd/_0x246540*0x2710)/0x64:0x0,_0x58141a=Math['ceil']((_0x344353['getTime']()-_0x1c9a9d[_0x334988(0x1af)]())/(0x3e8*0x3c*0x3c*0x18)),_0x4e1f88={'totalTurnover':Math[_0x334988(0x15f)](_0x2042c8*0x64)/0x64,'merchantEarnings':Math['round'](_0x51a861*0x64)/0x64,'gatewayEarnings':Math[_0x334988(0x15f)](_0x1c35ec*0x64)/0x64,'totalPaidOut':Math[_0x334988(0x15f)](_0x35ba22*0x64)/0x64,'averageCheck':Math['round'](_0x429a02*0x64)/0x64,'totalPayments':_0x246540,'successfulPayments':_0x5086bd,'conversionRate':_0x17d19c,'gatewayBreakdown':Object[_0x334988(0x1cf)](_0x5a92ff)[_0x334988(0x11e)](_0x224a9a=>({..._0x224a9a,'turnoverUSDT':Math[_0x334988(0x15f)](_0x224a9a[_0x334988(0x16c)]*0x64)/0x64,'commissionUSDT':Math[_0x334988(0x15f)](_0x224a9a[_0x334988(0xee)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x334988(0x15f)](_0x224a9a[_0x334988(0x1c0)]*0x64)/0x64,'averageCommissionRate':Math[_0x334988(0x15f)](_0x224a9a[_0x334988(0x1db)]*0x64)/0x64})),'merchantBreakdown':_0x1e56ab['shopId']?undefined:Object[_0x334988(0x1cf)](_0x2de8d9)[_0x334988(0x11e)](_0x3da275=>({..._0x3da275,'turnoverUSDT':Math[_0x334988(0x15f)](_0x3da275[_0x334988(0x16c)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x3da275['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x334988(0x15f)](_0x3da275[_0x334988(0x1c0)]*0x64)/0x64,'paidOutUSDT':Math['round'](_0x3da275[_0x334988(0x1ac)]*0x64)/0x64,'averageCheckUSDT':Math[_0x334988(0x15f)](_0x3da275[_0x334988(0x16e)]*0x64)/0x64})),'dailyData':Object[_0x334988(0x1cf)](_0x46e83a)[_0x334988(0x11e)](_0x565439=>({..._0x565439,'turnover':Math['round'](_0x565439[_0x334988(0x11a)]*0x64)/0x64,'merchantEarnings':Math['round'](_0x565439[_0x334988(0xd4)]*0x64)/0x64,'gatewayEarnings':Math[_0x334988(0x15f)](_0x565439[_0x334988(0x1d2)]*0x64)/0x64}))[_0x334988(0x179)]((_0x4a3c29,_0x1dea31)=>_0x4a3c29[_0x334988(0xf4)]['localeCompare'](_0x1dea31[_0x334988(0xf4)])),'periodInfo':{'from':_0x1c9a9d,'to':_0x344353,'periodType':_0x1e56ab['period']||_0x334988(0xff),'daysCount':_0x58141a}};return console[_0x334988(0x11f)](_0x334988(0x18c)),console['log'](_0x334988(0xeb)+_0x4e1f88[_0x334988(0x1b9)]+'\x20USDT'),console['log'](_0x334988(0xfc)+_0x4e1f88[_0x334988(0xd4)]+_0x334988(0x183)),console['log']('\x20\x20\x20üè™\x20Gateway\x20earnings:\x20'+_0x4e1f88[_0x334988(0x1d2)]+_0x334988(0x183)),console[_0x334988(0x11f)](_0x334988(0x13e)+_0x4e1f88['totalPayments']),_0x4e1f88;}async['getMerchantsSelection'](){const _0x56b265=a35_0x16eb82;console[_0x56b265(0x11f)](_0x56b265(0x1a0));const _0x5ad9c8=await database_1[_0x56b265(0x119)][_0x56b265(0xdc)]['findMany']({'where':{'status':_0x56b265(0x164)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x56b265(0x17e)}});return console['log'](_0x56b265(0x197)+_0x5ad9c8['length']+_0x56b265(0x16b)),_0x5ad9c8[_0x56b265(0x11e)](_0x7fcefd=>({'id':_0x7fcefd['id'],'username':_0x7fcefd[_0x56b265(0xd6)],'name':_0x7fcefd[_0x56b265(0x185)]}));}[a35_0x16eb82(0x1a7)](_0x5798ab){const _0x208586=a35_0x16eb82,_0x49045d={'test_gateway':_0x208586(0xf1),'plisio':'Plisio','rapyd':_0x208586(0x19e),'noda':_0x208586(0x177),'cointopay':_0x208586(0x155),'klyme_eu':_0x208586(0xe1),'klyme_gb':'KLYME\x20GB','klyme_de':_0x208586(0xfe)};return _0x49045d[_0x5798ab]||_0x5798ab;}async[a35_0x16eb82(0x17c)](_0x35a925){const _0x392989=a35_0x16eb82,{page:_0x53adf6,limit:_0x591b81,minAmount:_0x7d6ca7,search:_0x5a27f2}=_0x35a925,_0x1dd67c=(_0x53adf6-0x1)*_0x591b81;console[_0x392989(0x11f)](_0x392989(0x181),_0x35a925);const _0x56c14={'balance':{'gt':0x0},'status':_0x392989(0x164)};_0x7d6ca7&&(_0x56c14['balance'][_0x392989(0x19c)]=_0x7d6ca7);_0x5a27f2&&(_0x56c14['OR']=[{'name':{'contains':_0x5a27f2,'mode':_0x392989(0x15a)}},{'username':{'contains':_0x5a27f2,'mode':'insensitive'}}]);const [_0x2ab53b,_0x4537be]=await Promise[_0x392989(0x184)]([database_1[_0x392989(0x119)]['shop'][_0x392989(0x1cb)]({'where':_0x56c14,'skip':_0x1dd67c,'take':_0x591b81,'orderBy':{'balance':_0x392989(0x125)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1[_0x392989(0x119)][_0x392989(0xdc)][_0x392989(0x1ec)]({'where':_0x56c14})]);console[_0x392989(0x11f)](_0x392989(0x1d4)+_0x2ab53b[_0x392989(0x158)]+_0x392989(0xd7));const _0x28da59=await Promise[_0x392989(0x184)](_0x2ab53b[_0x392989(0x11e)](async _0x4ce1d3=>{const _0x25ec9c=_0x392989,[_0x226dcd,_0x3c33c0,_0x3b09f4]=await Promise['all']([database_1[_0x25ec9c(0x119)][_0x25ec9c(0x17f)][_0x25ec9c(0x1ec)]({'where':{'shopId':_0x4ce1d3['id'],'status':_0x25ec9c(0xdb),'amountUSDT':{'not':null}}}),database_1[_0x25ec9c(0x119)][_0x25ec9c(0x17f)][_0x25ec9c(0x112)]({'where':{'shopId':_0x4ce1d3['id'],'status':'PAID','amountUSDT':{'not':null}},'orderBy':{'paidAt':_0x25ec9c(0x17e)},'select':{'paidAt':!![]}}),database_1['default'][_0x25ec9c(0x17f)][_0x25ec9c(0x169)]({'by':[_0x25ec9c(0x1b0)],'where':{'shopId':_0x4ce1d3['id'],'status':_0x25ec9c(0xdb),'amountUSDT':{'not':null}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x16caf2=await Promise[_0x25ec9c(0x184)](_0x3b09f4[_0x25ec9c(0x11e)](async _0x3e19bf=>{const _0x11bcc7=_0x25ec9c;let _0x1c898d=0xa;if(_0x4ce1d3['gatewaySettings'])try{const _0x2cf907=JSON[_0x11bcc7(0x13c)](_0x4ce1d3[_0x11bcc7(0x1d6)]);for(const [_0x54c307,_0x534770]of Object[_0x11bcc7(0x12a)](_0x2cf907)){if(_0x54c307[_0x11bcc7(0x122)]()===_0x3e19bf[_0x11bcc7(0x1b0)]['toLowerCase']()){_0x1c898d=_0x534770[_0x11bcc7(0x156)]||0xa,console[_0x11bcc7(0x11f)]('üí∞\x20[PAYOUT]\x20Gateway\x20'+_0x3e19bf[_0x11bcc7(0x1b0)]+_0x11bcc7(0x194)+_0x4ce1d3['id']+_0x11bcc7(0x106)+_0x1c898d+'%');break;}}}catch(_0x466add){console[_0x11bcc7(0x15c)](_0x11bcc7(0x1d7)+_0x4ce1d3['id']+':',_0x466add);}const _0x3e15fa=_0x3e19bf[_0x11bcc7(0x1de)][_0x11bcc7(0xe0)]||0x0,_0x370fac=_0x3e15fa*(0x1-_0x1c898d/0x64);return{'gateway':_0x3e19bf[_0x11bcc7(0x1b0)],'count':_0x3e19bf[_0x11bcc7(0x146)]['id'],'amountUSDT':Math['round'](_0x3e15fa*0x64)/0x64,'amountAfterCommissionUSDT':Math['round'](_0x370fac*0x64)/0x64,'commission':_0x1c898d};})),_0x52ce1c=_0x16caf2[_0x25ec9c(0x1eb)]((_0x3cb468,_0x418e83)=>_0x3cb468+_0x418e83['amountUSDT'],0x0),_0x951bcd=_0x16caf2[_0x25ec9c(0x1eb)]((_0x558729,_0x2ab5ec)=>_0x558729+_0x2ab5ec[_0x25ec9c(0x140)],0x0),_0x2520f5=_0x4ce1d3[_0x25ec9c(0x1e6)];console[_0x25ec9c(0x11f)](_0x25ec9c(0x160)+_0x4ce1d3[_0x25ec9c(0xd6)]+':'),console[_0x25ec9c(0x11f)](_0x25ec9c(0x102)+Math['round'](_0x52ce1c*0x64)/0x64+_0x25ec9c(0x183)),console[_0x25ec9c(0x11f)](_0x25ec9c(0x1ee)+Math[_0x25ec9c(0x15f)](_0x951bcd*0x64)/0x64+_0x25ec9c(0x183)),console[_0x25ec9c(0x11f)]('\x20\x20\x20Actual\x20balance\x20from\x20DB:\x20'+_0x2520f5+_0x25ec9c(0x139));const _0x215e33=Math[_0x25ec9c(0x196)](_0x951bcd,_0x2520f5);return _0x2520f5<_0x951bcd&&(console[_0x25ec9c(0x11f)](_0x25ec9c(0x1c4)),console[_0x25ec9c(0x11f)](_0x25ec9c(0x1bb)+_0x2520f5+'\x20USDT\x20instead\x20of\x20calculated:\x20'+Math['round'](_0x951bcd*0x64)/0x64+'\x20USDT')),{'id':_0x4ce1d3['id'],'fullName':_0x4ce1d3[_0x25ec9c(0x185)],'username':_0x4ce1d3[_0x25ec9c(0xd6)],'telegramId':_0x4ce1d3[_0x25ec9c(0x178)],'merchantUrl':_0x4ce1d3['shopUrl'],'wallets':{'usdtPolygonWallet':_0x4ce1d3['usdtPolygonWallet'],'usdtTrcWallet':_0x4ce1d3[_0x25ec9c(0x118)],'usdtErcWallet':_0x4ce1d3['usdtErcWallet'],'usdcPolygonWallet':_0x4ce1d3[_0x25ec9c(0x1a6)]},'totalAmountUSDT':Math[_0x25ec9c(0x15f)](_0x52ce1c*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x25ec9c(0x15f)](_0x215e33*0x64)/0x64,'paymentsCount':_0x226dcd,'oldestPaymentDate':_0x3c33c0?.[_0x25ec9c(0x101)]||_0x4ce1d3['createdAt'],'gatewayBreakdown':_0x16caf2};})),_0x3b68d4=_0x28da59[_0x392989(0x1eb)]((_0x367810,_0x5a2542)=>_0x367810+_0x5a2542[_0x392989(0x195)],0x0),_0x30aee0=_0x28da59[_0x392989(0x1eb)]((_0x2ce456,_0x7da1cc)=>_0x2ce456+_0x7da1cc['totalAmountAfterCommissionUSDT'],0x0);return console['log'](_0x392989(0x151)+_0x4537be+_0x392989(0x12d)+Math[_0x392989(0x15f)](_0x30aee0*0x64)/0x64+_0x392989(0x198)),{'merchants':_0x28da59,'pagination':{'page':_0x53adf6,'limit':_0x591b81,'total':_0x4537be,'totalPages':Math[_0x392989(0x1e3)](_0x4537be/_0x591b81)},'summary':{'totalMerchants':_0x4537be,'totalAmountUSDT':Math[_0x392989(0x15f)](_0x3b68d4*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x30aee0*0x64)/0x64}};}async[a35_0x16eb82(0x173)](_0x10d6d9){const _0x5e9fe7=a35_0x16eb82,{shopId:_0x2dc197,amount:_0x1e0b1a,network:_0x3e71b6,wallet:_0x357ea5,notes:_0x3d26e5,txid:_0x20cb80,periodFrom:_0x2f93a6,periodTo:_0x1e1bbf}=_0x10d6d9,_0x191395=await database_1['default'][_0x5e9fe7(0x121)](async _0x4fb44f=>{const _0x25fcd5=_0x5e9fe7,_0x1efa2a=await _0x4fb44f[_0x25fcd5(0xdc)][_0x25fcd5(0x1ba)]({'where':{'id':_0x2dc197},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x1efa2a)throw new Error(_0x25fcd5(0x110));console['log'](_0x25fcd5(0x1df)+_0x1efa2a[_0x25fcd5(0xd6)]+':'),console[_0x25fcd5(0x11f)](_0x25fcd5(0x143)+_0x1efa2a['balance'][_0x25fcd5(0x18d)](0x6)+_0x25fcd5(0x183)),console['log'](_0x25fcd5(0x1a2)+_0x1e0b1a[_0x25fcd5(0x18d)](0x6)+_0x25fcd5(0x183)),console[_0x25fcd5(0x11f)](_0x25fcd5(0x1cd)+_0x1efa2a[_0x25fcd5(0x174)]['toFixed'](0x6)+_0x25fcd5(0x183));if(_0x20cb80)console[_0x25fcd5(0x11f)](_0x25fcd5(0x1b8)+_0x20cb80);if(_0x1efa2a[_0x25fcd5(0x1e6)]<_0x1e0b1a)throw new Error(_0x25fcd5(0x1b4)+_0x1efa2a[_0x25fcd5(0x1e6)][_0x25fcd5(0x18d)](0x6)+'\x20USDT,\x20Requested:\x20'+_0x1e0b1a['toFixed'](0x6)+_0x25fcd5(0x183));let _0x441be3=_0x357ea5;if(!_0x441be3){const _0x14ca3f=await _0x4fb44f[_0x25fcd5(0xdc)]['findUnique']({'where':{'id':_0x2dc197},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x14ca3f)switch(_0x3e71b6){case _0x25fcd5(0x10e):_0x441be3=_0x14ca3f[_0x25fcd5(0x1a1)]||undefined;break;case _0x25fcd5(0x1b6):_0x441be3=_0x14ca3f[_0x25fcd5(0x118)]||undefined;break;case'erc20':_0x441be3=_0x14ca3f[_0x25fcd5(0x1a4)]||undefined;break;case'polygon_usdc':_0x441be3=_0x14ca3f[_0x25fcd5(0x1a6)]||undefined;break;}}console[_0x25fcd5(0x11f)](_0x25fcd5(0xd5)+_0x3e71b6+':\x20'+(_0x441be3||_0x25fcd5(0x18e)));const _0x36695a=await _0x4fb44f[_0x25fcd5(0x124)][_0x25fcd5(0x129)]({'data':{'shopId':_0x2dc197,'amount':_0x1e0b1a,'network':_0x3e71b6,'status':_0x25fcd5(0xfa),'txid':_0x20cb80,'notes':_0x3d26e5,'periodFrom':_0x2f93a6?new Date(_0x2f93a6):null,'periodTo':_0x1e1bbf?new Date(_0x1e1bbf):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x5a86a1=_0x1efa2a[_0x25fcd5(0x1e6)]-_0x1e0b1a,_0x7fd3dd=_0x1efa2a[_0x25fcd5(0x174)]+_0x1e0b1a;return await _0x4fb44f[_0x25fcd5(0xdc)][_0x25fcd5(0x1bf)]({'where':{'id':_0x2dc197},'data':{'balance':_0x5a86a1,'totalPaidOut':_0x7fd3dd}}),console[_0x25fcd5(0x11f)](_0x25fcd5(0x1aa)+_0x1efa2a[_0x25fcd5(0xd6)]+_0x25fcd5(0xe5)),console['log'](_0x25fcd5(0x116)+_0x1efa2a[_0x25fcd5(0x1e6)][_0x25fcd5(0x18d)](0x6)+_0x25fcd5(0x1a5)+_0x5a86a1[_0x25fcd5(0x18d)](0x6)+'\x20USDT\x20(-'+_0x1e0b1a[_0x25fcd5(0x18d)](0x6)+')'),console[_0x25fcd5(0x11f)](_0x25fcd5(0x13d)+_0x1efa2a[_0x25fcd5(0x174)][_0x25fcd5(0x18d)](0x6)+_0x25fcd5(0x1a5)+_0x7fd3dd['toFixed'](0x6)+'\x20USDT\x20(+'+_0x1e0b1a[_0x25fcd5(0x18d)](0x6)+')'),{'payout':_0x36695a,'shop':_0x1efa2a};});return console['log'](_0x5e9fe7(0x193)+_0x191395[_0x5e9fe7(0x124)]['id']+'\x20for\x20shop\x20'+_0x191395[_0x5e9fe7(0xdc)][_0x5e9fe7(0xd6)]+'\x20('+_0x1e0b1a+_0x5e9fe7(0xf6)),{'id':_0x191395['payout']['id'],'shopId':_0x191395['payout'][_0x5e9fe7(0x12e)],'shopName':_0x191395[_0x5e9fe7(0xdc)]['name'],'shopUsername':_0x191395['shop']['username'],'amount':_0x191395[_0x5e9fe7(0x124)][_0x5e9fe7(0xf3)],'network':_0x191395['payout'][_0x5e9fe7(0x19a)],'status':_0x191395[_0x5e9fe7(0x124)][_0x5e9fe7(0x1dd)],'txid':_0x191395[_0x5e9fe7(0x124)][_0x5e9fe7(0x1f1)],'notes':_0x191395['payout'][_0x5e9fe7(0x1c1)],'periodFrom':_0x191395['payout']['periodFrom'],'periodTo':_0x191395[_0x5e9fe7(0x124)]['periodTo'],'createdAt':_0x191395[_0x5e9fe7(0x124)][_0x5e9fe7(0xfb)],'paidAt':_0x191395[_0x5e9fe7(0x124)]['paidAt']};}async[a35_0x16eb82(0x141)](_0x47034b){const _0x20ea8a=a35_0x16eb82,{page:_0x21b979,limit:_0x596bbe,shopId:_0x785203,network:_0x15e149,dateFrom:_0x19457e,dateTo:_0x500f00,search:_0x420442}=_0x47034b,_0x1d4353=(_0x21b979-0x1)*_0x596bbe,_0x2fee64={};_0x785203&&(_0x2fee64['shopId']=_0x785203);_0x15e149&&(_0x2fee64[_0x20ea8a(0x19a)]=_0x15e149);(_0x19457e||_0x500f00)&&(_0x2fee64[_0x20ea8a(0xfb)]={},_0x19457e&&(_0x2fee64[_0x20ea8a(0xfb)][_0x20ea8a(0x19c)]=new Date(_0x19457e)),_0x500f00&&(_0x2fee64[_0x20ea8a(0xfb)][_0x20ea8a(0x14c)]=new Date(_0x500f00)));_0x420442&&(_0x2fee64['OR']=[{'shop':{'name':{'contains':_0x420442,'mode':_0x20ea8a(0x15a)}}},{'shop':{'username':{'contains':_0x420442,'mode':_0x20ea8a(0x15a)}}},{'notes':{'contains':_0x420442,'mode':_0x20ea8a(0x15a)}}]);const [_0x5ddbde,_0x3dab67]=await Promise[_0x20ea8a(0x184)]([database_1[_0x20ea8a(0x119)]['payout'][_0x20ea8a(0x1cb)]({'where':_0x2fee64,'skip':_0x1d4353,'take':_0x596bbe,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'wallet':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x20ea8a(0x119)][_0x20ea8a(0x124)][_0x20ea8a(0x1ec)]({'where':_0x2fee64})]);return{'payouts':_0x5ddbde[_0x20ea8a(0x11e)](_0x2edc83=>({'id':_0x2edc83['id'],'shopId':_0x2edc83['shopId'],'shopName':_0x2edc83[_0x20ea8a(0xdc)][_0x20ea8a(0x185)],'shopUsername':_0x2edc83[_0x20ea8a(0xdc)][_0x20ea8a(0xd6)],'amount':_0x2edc83['amount'],'network':_0x2edc83[_0x20ea8a(0x19a)],'wallet':_0x2edc83[_0x20ea8a(0x1c9)],'status':_0x2edc83['status'],'txid':_0x2edc83[_0x20ea8a(0x1f1)],'notes':_0x2edc83['notes'],'periodFrom':_0x2edc83[_0x20ea8a(0x162)],'periodTo':_0x2edc83[_0x20ea8a(0x191)],'createdAt':_0x2edc83[_0x20ea8a(0xfb)],'paidAt':_0x2edc83[_0x20ea8a(0x101)]})),'pagination':{'page':_0x21b979,'limit':_0x596bbe,'total':_0x3dab67,'totalPages':Math[_0x20ea8a(0x1e3)](_0x3dab67/_0x596bbe)}};}async['getPayoutById'](_0x2a559b){const _0x2cafbc=a35_0x16eb82,_0xa313c=await database_1[_0x2cafbc(0x119)]['payout'][_0x2cafbc(0x1ba)]({'where':{'id':_0x2a559b},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0xa313c)return null;return{'id':_0xa313c['id'],'shopId':_0xa313c[_0x2cafbc(0x12e)],'shopName':_0xa313c[_0x2cafbc(0xdc)][_0x2cafbc(0x185)],'shopUsername':_0xa313c['shop']['username'],'amount':_0xa313c[_0x2cafbc(0xf3)],'network':_0xa313c[_0x2cafbc(0x19a)],'status':_0xa313c[_0x2cafbc(0x1dd)],'txid':_0xa313c[_0x2cafbc(0x1f1)],'notes':_0xa313c[_0x2cafbc(0x1c1)],'periodFrom':_0xa313c['periodFrom'],'periodTo':_0xa313c[_0x2cafbc(0x191)],'createdAt':_0xa313c[_0x2cafbc(0xfb)],'paidAt':_0xa313c[_0x2cafbc(0x101)]};}async[a35_0x16eb82(0x1e1)](_0x3f7fb4){const _0x3e3687=a35_0x16eb82;await database_1[_0x3e3687(0x119)][_0x3e3687(0x124)][_0x3e3687(0x15b)]({'where':{'id':_0x3f7fb4}});}async[a35_0x16eb82(0x15d)](_0x34674b){const _0x231930=a35_0x16eb82,{page:_0x3471d1,limit:_0x246355,status:_0x3a87db,gateway:_0x54e988,shopId:_0x18d9a9,dateFrom:_0x2ec3cb,dateTo:_0x5c1052,search:_0x5c6495,currency:_0x5627d1,sortBy:_0x5f3557,sortOrder:_0x2b4f3f}=_0x34674b,_0x182178=(_0x3471d1-0x1)*_0x246355;console[_0x231930(0x11f)](_0x231930(0x1c2),_0x34674b);const _0x3c4695=await database_1[_0x231930(0x119)]['payment'][_0x231930(0x169)]({'by':[_0x231930(0x1b0)],'_count':{'gateway':!![]}});console[_0x231930(0x11f)](_0x231930(0xf9),_0x3c4695['map'](_0x43cc13=>_0x43cc13[_0x231930(0x1b0)]+'\x20('+_0x43cc13['_count'][_0x231930(0x1b0)]+_0x231930(0x108)));if(_0x54e988){const _0x2ba6f7=_0x3c4695[_0x231930(0x18b)](_0x4c86d1=>_0x4c86d1['gateway'][_0x231930(0x122)]()===_0x54e988['toLowerCase']());!_0x2ba6f7&&_0x54e988[_0x231930(0x122)]()!==_0x231930(0xda)&&console[_0x231930(0x11f)](_0x231930(0x100)+_0x54e988+_0x231930(0x1f3)+_0x3c4695[_0x231930(0x11e)](_0x4a9257=>_0x4a9257[_0x231930(0x1b0)])[_0x231930(0x127)](',\x20'));}const _0x2c449a={};_0x3a87db&&(_0x2c449a[_0x231930(0x1dd)]=_0x3a87db[_0x231930(0x10c)]());if(!_0x54e988)_0x2c449a[_0x231930(0x1b0)]={'not':'test_gateway'};else{if(_0x54e988&&(_0x54e988[_0x231930(0x122)]()==='test_gateway'||_0x54e988===_0x231930(0x19d)))_0x2c449a[_0x231930(0x1b0)]=_0x231930(0xda);else{let _0x40ef60=_0x54e988;const _0x241e3c=(0x0,gateway_1[_0x231930(0x1c5)])(_0x54e988);if(_0x241e3c)_0x40ef60=_0x241e3c,console['log'](_0x231930(0x171)+_0x54e988+_0x231930(0x12c)+_0x40ef60+'\x27');else{const _0x5d0ff7=(0x0,gateway_1[_0x231930(0xf0)])(_0x54e988);if(_0x5d0ff7){const _0x5877d6=(0x0,gateway_1['getGatewayNameById'])(_0x5d0ff7);_0x5877d6&&(_0x40ef60=_0x5877d6,console['log'](_0x231930(0xf8)+_0x54e988+_0x231930(0xe7)+_0x5d0ff7+'\x27\x20->\x20name\x20\x27'+_0x40ef60+'\x27'));}else console[_0x231930(0x11f)](_0x231930(0x1ca)+_0x54e988+'\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)');}const _0x1c633e=await database_1['default']['payment'][_0x231930(0x1ec)]({'where':{'gateway':_0x40ef60[_0x231930(0x122)]()},'take':0x1});_0x1c633e===0x0?(console[_0x231930(0x11f)](_0x231930(0x115)+_0x40ef60+_0x231930(0x1b2)+_0x54e988+_0x231930(0x14e)),_0x2c449a[_0x231930(0x1b0)]=_0x231930(0x1ef)):(_0x2c449a[_0x231930(0x1b0)]=_0x40ef60[_0x231930(0x122)](),console['log'](_0x231930(0x14d)+_0x40ef60+'\x27\x20(from\x20\x27'+_0x54e988+'\x27)'));}}console['log']('üìä\x20Gateway\x20filter\x20applied:',_0x2c449a['gateway']);_0x18d9a9&&(_0x2c449a[_0x231930(0x12e)]=_0x18d9a9);_0x5627d1&&(_0x2c449a[_0x231930(0xef)]=_0x5627d1['toUpperCase'](),console[_0x231930(0x11f)](_0x231930(0x1c3)+_0x5627d1[_0x231930(0x10c)]()));(_0x2ec3cb||_0x5c1052)&&(_0x2c449a[_0x231930(0xfb)]={},_0x2ec3cb&&(_0x2c449a[_0x231930(0xfb)][_0x231930(0x19c)]=new Date(_0x2ec3cb)),_0x5c1052&&(_0x2c449a[_0x231930(0xfb)][_0x231930(0x14c)]=new Date(_0x5c1052)));_0x5c6495&&(_0x2c449a['OR']=[{'id':{'contains':_0x5c6495,'mode':_0x231930(0x15a)}},{'orderId':{'contains':_0x5c6495,'mode':_0x231930(0x15a)}},{'gatewayOrderId':{'contains':_0x5c6495,'mode':_0x231930(0x15a)}},{'customerEmail':{'contains':_0x5c6495,'mode':_0x231930(0x15a)}},{'shop':{'name':{'contains':_0x5c6495,'mode':_0x231930(0x15a)}}},{'shop':{'username':{'contains':_0x5c6495,'mode':'insensitive'}}}]);console['log'](_0x231930(0x1c8),JSON[_0x231930(0x172)](_0x2c449a,null,0x2));let _0x14873b={'createdAt':_0x231930(0x125)};if(_0x5f3557){const _0x21124d=[_0x231930(0xf3),'createdAt',_0x231930(0x1dc),'status',_0x231930(0x1b0),_0x231930(0xef)],_0x235746=[_0x231930(0x17e),_0x231930(0x125)];if(_0x21124d[_0x231930(0x14b)](_0x5f3557)){const _0x5211b9=_0x235746[_0x231930(0x14b)](_0x2b4f3f)?_0x2b4f3f:_0x231930(0x125);_0x14873b={[_0x5f3557]:_0x5211b9},console[_0x231930(0x11f)](_0x231930(0x1d8)+_0x5f3557+_0x231930(0x163)+_0x5211b9+_0x231930(0x11b));}}const [_0x2a51a3,_0x29995f]=await Promise[_0x231930(0x184)]([database_1[_0x231930(0x119)][_0x231930(0x17f)][_0x231930(0x1cb)]({'where':_0x2c449a,'skip':_0x182178,'take':_0x246355,'orderBy':_0x14873b,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x231930(0x119)]['payment'][_0x231930(0x1ec)]({'where':_0x2c449a})]);return{'payments':_0x2a51a3['map'](_0x55f0c3=>({'id':_0x55f0c3['id'],'shopId':_0x55f0c3[_0x231930(0x12e)],'gateway':_0x55f0c3[_0x231930(0x1b0)],'amount':_0x55f0c3[_0x231930(0xf3)],'currency':_0x55f0c3[_0x231930(0xef)],'status':_0x55f0c3[_0x231930(0x1dd)],'orderId':_0x55f0c3[_0x231930(0x1bd)],'gatewayOrderId':_0x55f0c3['gatewayOrderId'],'customerEmail':_0x55f0c3['customerEmail'],'customerName':_0x55f0c3[_0x231930(0x147)],'customerCountry':_0x55f0c3[_0x231930(0x17b)],'customerIp':_0x55f0c3['customerIp'],'customerUa':_0x55f0c3[_0x231930(0x186)],'failureMessage':_0x55f0c3[_0x231930(0x1d3)],'createdAt':_0x55f0c3['createdAt'],'updatedAt':_0x55f0c3['updatedAt'],'shop':_0x55f0c3['shop']})),'pagination':{'page':_0x3471d1,'limit':_0x246355,'total':_0x29995f,'totalPages':Math[_0x231930(0x1e3)](_0x29995f/_0x246355)}};}async[a35_0x16eb82(0x1da)](_0x28f6d1){const _0x85f299=a35_0x16eb82,_0x4f2496=await database_1['default'][_0x85f299(0x17f)][_0x85f299(0x1ba)]({'where':{'id':_0x28f6d1},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x4f2496)return null;return{'id':_0x4f2496['id'],'shopId':_0x4f2496[_0x85f299(0x12e)],'gateway':_0x4f2496[_0x85f299(0x1b0)],'amount':_0x4f2496[_0x85f299(0xf3)],'currency':_0x4f2496[_0x85f299(0xef)],'status':_0x4f2496['status'],'orderId':_0x4f2496[_0x85f299(0x1bd)],'gatewayOrderId':_0x4f2496[_0x85f299(0x1ed)],'customerEmail':_0x4f2496[_0x85f299(0x161)],'customerName':_0x4f2496[_0x85f299(0x147)],'customerCountry':_0x4f2496[_0x85f299(0x17b)],'customerIp':_0x4f2496['customerIp'],'customerUa':_0x4f2496[_0x85f299(0x186)],'failureMessage':_0x4f2496[_0x85f299(0x1d3)],'externalPaymentUrl':_0x4f2496[_0x85f299(0xec)],'successUrl':_0x4f2496[_0x85f299(0x1e5)],'failUrl':_0x4f2496[_0x85f299(0x1bc)],'pendingUrl':_0x4f2496[_0x85f299(0x1ad)],'whiteUrl':_0x4f2496[_0x85f299(0x149)],'createdAt':_0x4f2496[_0x85f299(0xfb)],'updatedAt':_0x4f2496[_0x85f299(0x1dc)],'shop':_0x4f2496[_0x85f299(0xdc)]};}async[a35_0x16eb82(0x199)](_0x13792f,_0x5bfc60,_0x2113c3,_0x41a198){const _0x50c144=a35_0x16eb82,_0x2e4f42=await database_1[_0x50c144(0x119)][_0x50c144(0x121)](async _0x443d8e=>{const _0x10f55f=_0x50c144,_0x59750f=await _0x443d8e[_0x10f55f(0x17f)][_0x10f55f(0x1ba)]({'where':{'id':_0x13792f},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x59750f)throw new Error('Payment\x20not\x20found');const _0x45905d=_0x59750f[_0x10f55f(0x1dd)],_0x7ba978=_0x5bfc60[_0x10f55f(0x10c)]();console['log']('üîÑ\x20Admin\x20updating\x20payment\x20'+_0x13792f+'\x20status:\x20'+_0x45905d+_0x10f55f(0x1a5)+_0x7ba978),console[_0x10f55f(0x11f)](_0x10f55f(0xe2)+_0x59750f['shop']['balance']+_0x10f55f(0x183));const _0x37cc8b={'status':_0x7ba978,'updatedAt':new Date(),'statusChangedBy':'admin','statusChangedAt':new Date()};_0x2113c3&&(_0x37cc8b['adminNotes']=_0x2113c3);_0x7ba978==='CHARGEBACK'&&_0x41a198&&(_0x37cc8b['chargebackAmount']=_0x41a198);let _0x32f34f=0x0,_0x291fe5=_0x59750f['shop'][_0x10f55f(0x1e6)];if(_0x7ba978===_0x10f55f(0xdb)&&_0x45905d!==_0x10f55f(0xdb)){_0x37cc8b[_0x10f55f(0x101)]=new Date();const _0xe24e14=await currencyService_1[_0x10f55f(0x148)]['convertToUSDT'](_0x59750f[_0x10f55f(0xf3)],_0x59750f[_0x10f55f(0xef)]);_0x37cc8b['amountUSDT']=_0xe24e14,_0x32f34f=_0xe24e14,_0x291fe5+=_0xe24e14,console['log'](_0x10f55f(0x1e0)+_0x13792f+_0x10f55f(0x154)+_0xe24e14[_0x10f55f(0x18d)](0x6)+_0x10f55f(0x19b));}else _0x45905d===_0x10f55f(0xdb)&&_0x7ba978!==_0x10f55f(0xdb)&&(_0x59750f[_0x10f55f(0xe0)]&&(_0x32f34f=-_0x59750f[_0x10f55f(0xe0)],_0x291fe5-=_0x59750f['amountUSDT'],_0x37cc8b['amountUSDT']=null,console[_0x10f55f(0x11f)](_0x10f55f(0x1e0)+_0x13792f+_0x10f55f(0x1e2)+_0x59750f[_0x10f55f(0xe0)][_0x10f55f(0x18d)](0x6)+_0x10f55f(0x103))));if(_0x7ba978===_0x10f55f(0x18f)){if(_0x45905d===_0x10f55f(0xdb)&&_0x59750f['amountUSDT']){}_0x41a198&&_0x41a198>0x0&&(_0x32f34f-=_0x41a198,_0x291fe5-=_0x41a198,console[_0x10f55f(0x11f)](_0x10f55f(0x1d1)+_0x41a198['toFixed'](0x6)+_0x10f55f(0x103)));}_0x7ba978===_0x10f55f(0x131)&&_0x45905d===_0x10f55f(0xdb)&&console['log']('üîÑ\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance');const _0x1fc376=await _0x443d8e[_0x10f55f(0x17f)][_0x10f55f(0x1bf)]({'where':{'id':_0x13792f},'data':_0x37cc8b,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x32f34f!==0x0&&(await _0x443d8e[_0x10f55f(0xdc)][_0x10f55f(0x1bf)]({'where':{'id':_0x59750f['shopId']},'data':{'balance':_0x291fe5}}),console[_0x10f55f(0x11f)](_0x10f55f(0x1aa)+_0x59750f['shopId']+_0x10f55f(0x1a8)+_0x59750f[_0x10f55f(0xdc)][_0x10f55f(0x1e6)][_0x10f55f(0x18d)](0x6)+_0x10f55f(0x1a5)+_0x291fe5['toFixed'](0x6)+_0x10f55f(0x153)+(_0x32f34f>0x0?'+':'')+_0x32f34f[_0x10f55f(0x18d)](0x6)+')')),_0x1fc376;});return{'id':_0x2e4f42['id'],'shopId':_0x2e4f42[_0x50c144(0x12e)],'gateway':_0x2e4f42[_0x50c144(0x1b0)],'amount':_0x2e4f42[_0x50c144(0xf3)],'currency':_0x2e4f42[_0x50c144(0xef)],'status':_0x2e4f42['status'],'orderId':_0x2e4f42['orderId'],'gatewayOrderId':_0x2e4f42['gatewayOrderId'],'customerEmail':_0x2e4f42[_0x50c144(0x161)],'customerName':_0x2e4f42[_0x50c144(0x147)],'customerCountry':_0x2e4f42[_0x50c144(0x17b)],'customerIp':_0x2e4f42[_0x50c144(0x1be)],'customerUa':_0x2e4f42[_0x50c144(0x186)],'failureMessage':_0x2e4f42[_0x50c144(0x1d3)],'adminNotes':_0x2e4f42['adminNotes'],'chargebackAmount':_0x2e4f42[_0x50c144(0x1ea)],'statusChangedBy':_0x2e4f42[_0x50c144(0xdd)],'statusChangedAt':_0x2e4f42[_0x50c144(0x16a)],'createdAt':_0x2e4f42['createdAt'],'updatedAt':_0x2e4f42['updatedAt'],'shop':_0x2e4f42['shop']};}async[a35_0x16eb82(0xf2)](_0x2682b0,_0x130b08){const _0x47b36c=a35_0x16eb82,_0x2bb67c={..._0x130b08};_0x130b08[_0x47b36c(0x1ae)]&&(_0x2bb67c['password']=await bcryptjs_1[_0x47b36c(0x119)][_0x47b36c(0x133)](_0x130b08[_0x47b36c(0x1ae)],0xc));_0x130b08[_0x47b36c(0x18a)]&&(_0x2bb67c[_0x47b36c(0x185)]=_0x130b08['fullName'],delete _0x2bb67c[_0x47b36c(0x18a)]);_0x130b08['telegramId']&&(_0x2bb67c['telegram']=_0x130b08[_0x47b36c(0x111)],delete _0x2bb67c[_0x47b36c(0x111)]);_0x130b08[_0x47b36c(0xf5)]&&(_0x2bb67c[_0x47b36c(0x1a9)]=_0x130b08[_0x47b36c(0xf5)],delete _0x2bb67c['merchantUrl']);_0x130b08['gateways']&&(_0x2bb67c[_0x47b36c(0x126)]=JSON[_0x47b36c(0x172)](_0x130b08[_0x47b36c(0x180)]),delete _0x2bb67c[_0x47b36c(0x180)]);_0x130b08[_0x47b36c(0x1d6)]&&(_0x2bb67c[_0x47b36c(0x1d6)]=JSON[_0x47b36c(0x172)](_0x130b08[_0x47b36c(0x1d6)]),delete _0x2bb67c[_0x47b36c(0x1d6)]);_0x130b08[_0x47b36c(0x1f0)]&&(_0x130b08['wallets'][_0x47b36c(0x1a1)]!==undefined&&(_0x2bb67c['usdtPolygonWallet']=_0x130b08[_0x47b36c(0x1f0)][_0x47b36c(0x1a1)]||null),_0x130b08['wallets']['usdtTrcWallet']!==undefined&&(_0x2bb67c['usdtTrcWallet']=_0x130b08[_0x47b36c(0x1f0)][_0x47b36c(0x118)]||null),_0x130b08[_0x47b36c(0x1f0)][_0x47b36c(0x1a4)]!==undefined&&(_0x2bb67c[_0x47b36c(0x1a4)]=_0x130b08['wallets'][_0x47b36c(0x1a4)]||null),_0x130b08['wallets'][_0x47b36c(0x1a6)]!==undefined&&(_0x2bb67c[_0x47b36c(0x1a6)]=_0x130b08[_0x47b36c(0x1f0)]['usdcPolygonWallet']||null),delete _0x2bb67c[_0x47b36c(0x1f0)]);const _0x5721ba=await database_1[_0x47b36c(0x119)][_0x47b36c(0xdc)][_0x47b36c(0x1bf)]({'where':{'id':_0x2682b0},'data':_0x2bb67c,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x5721ba['id'],'fullName':_0x5721ba[_0x47b36c(0x185)],'username':_0x5721ba['username'],'telegramId':_0x5721ba[_0x47b36c(0x178)],'merchantUrl':_0x5721ba['shopUrl'],'gateways':_0x5721ba['paymentGateways']?JSON[_0x47b36c(0x13c)](_0x5721ba[_0x47b36c(0x126)]):null,'gatewaySettings':_0x5721ba[_0x47b36c(0x1d6)]?JSON[_0x47b36c(0x13c)](_0x5721ba[_0x47b36c(0x1d6)]):null,'publicKey':_0x5721ba[_0x47b36c(0x1ce)],'wallets':{'usdtPolygonWallet':_0x5721ba[_0x47b36c(0x1a1)],'usdtTrcWallet':_0x5721ba[_0x47b36c(0x118)],'usdtErcWallet':_0x5721ba[_0x47b36c(0x1a4)],'usdcPolygonWallet':_0x5721ba[_0x47b36c(0x1a6)]},'status':_0x5721ba[_0x47b36c(0x1dd)],'createdAt':_0x5721ba[_0x47b36c(0xfb)]};}async[a35_0x16eb82(0x15e)](_0x26a299){const _0x11b246=a35_0x16eb82,_0x452a33=await database_1[_0x11b246(0x119)][_0x11b246(0xdc)][_0x11b246(0x1bf)]({'where':{'id':_0x26a299},'data':{'status':_0x11b246(0x10d)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x452a33['id'],'fullName':_0x452a33[_0x11b246(0x185)],'username':_0x452a33[_0x11b246(0xd6)],'telegramId':_0x452a33['telegram'],'merchantUrl':_0x452a33[_0x11b246(0x1a9)],'gateways':_0x452a33[_0x11b246(0x126)]?JSON[_0x11b246(0x13c)](_0x452a33[_0x11b246(0x126)]):null,'gatewaySettings':_0x452a33[_0x11b246(0x1d6)]?JSON['parse'](_0x452a33['gatewaySettings']):null,'publicKey':_0x452a33[_0x11b246(0x1ce)],'wallets':{'usdtPolygonWallet':_0x452a33['usdtPolygonWallet'],'usdtTrcWallet':_0x452a33[_0x11b246(0x118)],'usdtErcWallet':_0x452a33['usdtErcWallet'],'usdcPolygonWallet':_0x452a33[_0x11b246(0x1a6)]},'status':_0x452a33[_0x11b246(0x1dd)],'createdAt':_0x452a33[_0x11b246(0xfb)]};}async[a35_0x16eb82(0x152)](_0x43e8b6){const _0x3a0be4=a35_0x16eb82,_0xbe405b=await database_1[_0x3a0be4(0x119)]['shop']['update']({'where':{'id':_0x43e8b6},'data':{'status':_0x3a0be4(0x164)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0xbe405b['id'],'fullName':_0xbe405b[_0x3a0be4(0x185)],'username':_0xbe405b[_0x3a0be4(0xd6)],'telegramId':_0xbe405b[_0x3a0be4(0x178)],'merchantUrl':_0xbe405b[_0x3a0be4(0x1a9)],'gateways':_0xbe405b[_0x3a0be4(0x126)]?JSON[_0x3a0be4(0x13c)](_0xbe405b[_0x3a0be4(0x126)]):null,'gatewaySettings':_0xbe405b['gatewaySettings']?JSON[_0x3a0be4(0x13c)](_0xbe405b[_0x3a0be4(0x1d6)]):null,'publicKey':_0xbe405b[_0x3a0be4(0x1ce)],'wallets':{'usdtPolygonWallet':_0xbe405b['usdtPolygonWallet'],'usdtTrcWallet':_0xbe405b[_0x3a0be4(0x118)],'usdtErcWallet':_0xbe405b[_0x3a0be4(0x1a4)],'usdcPolygonWallet':_0xbe405b[_0x3a0be4(0x1a6)]},'status':_0xbe405b['status'],'createdAt':_0xbe405b[_0x3a0be4(0xfb)]};}async[a35_0x16eb82(0x1e4)](_0x1d2da9){const _0x613a07=a35_0x16eb82,{page:_0x240493,limit:_0x4e4247,status:_0xca6dd3}=_0x1d2da9,_0x1961d3=(_0x240493-0x1)*_0x4e4247,_0x50837d={};_0xca6dd3&&(_0x50837d[_0x613a07(0x1dd)]=_0xca6dd3[_0x613a07(0x10c)]());const [_0x3d9ad9,_0x1c1e02]=await Promise[_0x613a07(0x184)]([database_1['default'][_0x613a07(0xdc)]['findMany']({'where':_0x50837d,'skip':_0x1961d3,'take':_0x4e4247,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1['default'][_0x613a07(0xdc)][_0x613a07(0x1ec)]({'where':_0x50837d})]);return{'users':_0x3d9ad9[_0x613a07(0x11e)](_0x4945ff=>({'id':_0x4945ff['id'],'fullName':_0x4945ff[_0x613a07(0x185)],'username':_0x4945ff[_0x613a07(0xd6)],'telegramId':_0x4945ff['telegram'],'merchantUrl':_0x4945ff[_0x613a07(0x1a9)],'gateways':_0x4945ff['paymentGateways']?JSON[_0x613a07(0x13c)](_0x4945ff[_0x613a07(0x126)]):null,'gatewaySettings':_0x4945ff[_0x613a07(0x1d6)]?JSON[_0x613a07(0x13c)](_0x4945ff['gatewaySettings']):null,'publicKey':_0x4945ff['publicKey'],'wallets':{'usdtPolygonWallet':_0x4945ff[_0x613a07(0x1a1)],'usdtTrcWallet':_0x4945ff[_0x613a07(0x118)],'usdtErcWallet':_0x4945ff['usdtErcWallet'],'usdcPolygonWallet':_0x4945ff['usdcPolygonWallet']},'status':_0x4945ff[_0x613a07(0x1dd)],'createdAt':_0x4945ff[_0x613a07(0xfb)]})),'pagination':{'page':_0x240493,'limit':_0x4e4247,'total':_0x1c1e02,'totalPages':Math['ceil'](_0x1c1e02/_0x4e4247)}};}async[a35_0x16eb82(0x104)](_0x19590b){const _0x1c529a=a35_0x16eb82,_0xb4d07b=await database_1[_0x1c529a(0x119)][_0x1c529a(0xdc)]['findUnique']({'where':{'id':_0x19590b},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0xb4d07b)return null;return{'id':_0xb4d07b['id'],'fullName':_0xb4d07b[_0x1c529a(0x185)],'username':_0xb4d07b[_0x1c529a(0xd6)],'telegramId':_0xb4d07b[_0x1c529a(0x178)],'merchantUrl':_0xb4d07b[_0x1c529a(0x1a9)],'gateways':_0xb4d07b[_0x1c529a(0x126)]?JSON[_0x1c529a(0x13c)](_0xb4d07b[_0x1c529a(0x126)]):null,'gatewaySettings':_0xb4d07b[_0x1c529a(0x1d6)]?JSON[_0x1c529a(0x13c)](_0xb4d07b[_0x1c529a(0x1d6)]):null,'publicKey':_0xb4d07b[_0x1c529a(0x1ce)],'wallets':{'usdtPolygonWallet':_0xb4d07b[_0x1c529a(0x1a1)],'usdtTrcWallet':_0xb4d07b[_0x1c529a(0x118)],'usdtErcWallet':_0xb4d07b['usdtErcWallet'],'usdcPolygonWallet':_0xb4d07b[_0x1c529a(0x1a6)]},'status':_0xb4d07b[_0x1c529a(0x1dd)],'createdAt':_0xb4d07b[_0x1c529a(0xfb)]};}async[a35_0x16eb82(0xe8)](_0x269d02){const _0x144e0c=a35_0x16eb82,{fullName:_0x1bc4ed,username:_0x288b47,password:_0x193364,telegramId:_0x36deb9,merchantUrl:_0x4755f8,gateways:_0x2605dd,gatewaySettings:_0x48732d,wallets:_0x245958}=_0x269d02,_0x2bd1f0=await database_1[_0x144e0c(0x119)][_0x144e0c(0xdc)][_0x144e0c(0x1ba)]({'where':{'username':_0x288b47}});if(_0x2bd1f0)throw new Error(_0x144e0c(0x190));if(_0x36deb9){const _0x18b0fc=await database_1[_0x144e0c(0x119)][_0x144e0c(0xdc)][_0x144e0c(0x1ba)]({'where':{'telegram':_0x36deb9}});if(_0x18b0fc)throw new Error(_0x144e0c(0x1c7));}const _0x2a15b1=await bcryptjs_1['default'][_0x144e0c(0x133)](_0x193364,0xc),_0xcb13a6=_0x144e0c(0x1ab)+crypto_1[_0x144e0c(0x119)][_0x144e0c(0x14a)](0x20)['toString'](_0x144e0c(0x132)),_0x59661a=_0x144e0c(0xde)+crypto_1[_0x144e0c(0x119)][_0x144e0c(0x14a)](0x20)[_0x144e0c(0x167)](_0x144e0c(0x132)),_0x5d811e=await database_1[_0x144e0c(0x119)]['shop'][_0x144e0c(0x129)]({'data':{'name':_0x1bc4ed,'username':_0x288b47,'password':_0x2a15b1,'telegram':_0x36deb9,'shopUrl':_0x4755f8,'paymentGateways':_0x2605dd?JSON[_0x144e0c(0x172)](_0x2605dd):null,'gatewaySettings':_0x48732d?JSON['stringify'](_0x48732d):null,'usdtPolygonWallet':_0x245958?.['usdtPolygonWallet']||null,'usdtTrcWallet':_0x245958?.['usdtTrcWallet']||null,'usdtErcWallet':_0x245958?.[_0x144e0c(0x1a4)]||null,'usdcPolygonWallet':_0x245958?.['usdcPolygonWallet']||null,'publicKey':_0xcb13a6,'secretKey':_0x59661a,'status':_0x144e0c(0x164)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x5d811e['id'],'fullName':_0x5d811e[_0x144e0c(0x185)],'username':_0x5d811e[_0x144e0c(0xd6)],'telegramId':_0x5d811e[_0x144e0c(0x178)],'merchantUrl':_0x5d811e[_0x144e0c(0x1a9)],'gateways':_0x5d811e[_0x144e0c(0x126)]?JSON['parse'](_0x5d811e[_0x144e0c(0x126)]):null,'gatewaySettings':_0x5d811e[_0x144e0c(0x1d6)]?JSON[_0x144e0c(0x13c)](_0x5d811e[_0x144e0c(0x1d6)]):null,'publicKey':_0x5d811e[_0x144e0c(0x1ce)],'wallets':{'usdtPolygonWallet':_0x5d811e['usdtPolygonWallet'],'usdtTrcWallet':_0x5d811e[_0x144e0c(0x118)],'usdtErcWallet':_0x5d811e[_0x144e0c(0x1a4)],'usdcPolygonWallet':_0x5d811e[_0x144e0c(0x1a6)]},'status':_0x5d811e['status'],'createdAt':_0x5d811e['createdAt']};}async[a35_0x16eb82(0x189)](_0x4d5064){const _0x5acd32=a35_0x16eb82;await database_1[_0x5acd32(0x119)][_0x5acd32(0xdc)][_0x5acd32(0x15b)]({'where':{'id':_0x4d5064}});}['generateDailyStatistics'](_0x44abfc,_0x5584ef,_0x4a72f2){const _0x315596=a35_0x16eb82,_0x35f212=new Map(),_0x1bfbe3=new Date(_0x5584ef);while(_0x1bfbe3<=_0x4a72f2){const _0x892d1e=_0x1bfbe3[_0x315596(0x157)]()[_0x315596(0xd9)]('T')[0x0];_0x35f212[_0x315596(0x128)](_0x892d1e,{'revenue':0x0,'count':0x0}),_0x1bfbe3[_0x315596(0x144)](_0x1bfbe3[_0x315596(0xdf)]()+0x1);}for(const _0x24041c of _0x44abfc){const _0x211153=_0x24041c['createdAt'][_0x315596(0x157)]()[_0x315596(0xd9)]('T')[0x0],_0x56eb50=_0x35f212[_0x315596(0x1e8)](_0x211153);_0x56eb50&&(_0x56eb50['count']+=0x1,_0x24041c[_0x315596(0x1dd)]===_0x315596(0xdb)&&(_0x24041c['amountUSDT']?_0x56eb50['revenue']+=_0x24041c[_0x315596(0xe0)]:console['log']('‚ö†Ô∏è\x20Payment\x20'+_0x24041c['id']+'\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion')));}const _0x6bcc76=[],_0x5221d7=[];for(const [_0x4cfb3d,_0x10d487]of _0x35f212){_0x6bcc76['push']({'date':_0x4cfb3d,'amount':Math['round'](_0x10d487[_0x315596(0x17a)]*0x64)/0x64}),_0x5221d7[_0x315596(0xe9)]({'date':_0x4cfb3d,'count':_0x10d487[_0x315596(0x1ec)]});}return{'dailyRevenue':_0x6bcc76,'dailyPayments':_0x5221d7};}}exports[a35_0x16eb82(0x188)]=AdminService;