'use strict';const a38_0xb47e75=a38_0x5709;(function(_0x154a4b,_0x40c050){const _0x52a807=a38_0x5709,_0x1d63aa=_0x154a4b();while(!![]){try{const _0x394f06=-parseInt(_0x52a807(0x19d))/0x1*(parseInt(_0x52a807(0x1df))/0x2)+parseInt(_0x52a807(0x1aa))/0x3*(-parseInt(_0x52a807(0x149))/0x4)+-parseInt(_0x52a807(0x1ae))/0x5*(parseInt(_0x52a807(0x11d))/0x6)+-parseInt(_0x52a807(0x113))/0x7+-parseInt(_0x52a807(0x17d))/0x8*(-parseInt(_0x52a807(0x14c))/0x9)+parseInt(_0x52a807(0x115))/0xa+parseInt(_0x52a807(0xd5))/0xb;if(_0x394f06===_0x40c050)break;else _0x1d63aa['push'](_0x1d63aa['shift']());}catch(_0x17735f){_0x1d63aa['push'](_0x1d63aa['shift']());}}}(a38_0x5728,0xcb0b4));function a38_0x5728(){const _0x5b17e1=['split','entries','\x20\x20\x20Transaction\x20hash:\x20','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','stringify','\x20\x20\x20Added\x20to\x20balance:\x20+','CoinToPay','crypto','default','chargebackAmount','ceil','findFirst','updateUser','asc','💸\x20CHARGEBACK:\x20Merchant\x20amount\x20already\x20deducted\x20from\x20balance','📊\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','\x20\x20\x20💰\x20Total\x20turnover:\x20','\x20USDT\x20from\x20balance','averageCommissionRate','\x20USDT,\x20merchant:\x20','gatewayCommissionRate','periodFrom','30d','2020-01-01','\x20in\x20','🔄\x20Admin\x20updating\x20payment\x20','updatePaymentStatus',',\x20userId:\x20','customerUa','Shop\x20not\x20found','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','⚠️\x20Gateway\x20\x27','📊\x20Gateway\x20filter\x20applied:','🔄\x20Converted\x20gateway\x20ID\x20\x27','trc20','🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','\x20merchants\x20with\x20positive\x20balance','Error\x20processing\x20payment\x20','warn',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','orderId','Payment\x20not\x20found','successUrl','\x20\x20\x20💸\x20Total\x20payouts:\x20','payment','averageCheckUSDT',',\x20Commission:\x20','📊\x20Final\x20WHERE\x20conditions:','paidAt','\x20\x20\x20Balance:\x20','revenue','\x20\x20\x20💰\x20Total\x20payments\x20turnover:\x20','💱\x20Currency\x20filter\x20applied:\x20','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','\x20\x20\x20�\x20Total\x20payments\x20turnover:\x20','COMPLETED','month','dailyPayments','polygon_usdc','\x20USDT,\x20Requested:\x20','🔄\x20Converted\x20gateway\x20name\x20\x27','41915720eQxBsF','adminNotes','pendingPayout','📊\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','status','error','commission','update','./currencyService','suspendUser','hex','toFixed','REFUND','getMerchantStatistics','periodTo','period','payout','\x20\x20\x20💰\x20Total\x20payout:\x20','week','random','0000','currency',']\x20Gateway\x20settings\x20JSON\x20string:','noda','rapyd','getGatewayInternalName','dailyRevenue','usdcPolygonWallet','setHours','\x20payments)','count','randomBytes','Rapyd','date','usdtErcWallet','\x20->\x20','📊\x20Calculated\x20commission\x20rate\x20for\x20payment\x20','round','insensitive','pk_','dateTo','toString','📊\x20Payout\x20statistics\x20calculated:','commissionUSDT','\x20\x20\x20�\x20Total\x20paid\x20out:\x20','year','_count','getPayoutStats','\x20order','some','desc','\x20\x20\x20🤔\x20Difference:\x20','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','90d','\x20\x20\x20📅\x20Total\x20payouts\x20(this\x20month):\x20','AdminService','%\x20from\x20','telegram','generateDailyStatistics','\x20USDT','statusChangedAt','merchantEarnings','4460134thkscd','usdcErcWallet','3741250LoFsjz','\x20USDT\x20(-','failureMessage','Insufficient\x20balance.\x20Available:\x20','📊\x20Total\x20payments\x20(including\x20failed):\x20','⚠️\x20Requested\x20gateway\x20\x27','klyme_eu','PAID','6HZUraU','parse','usdtPolygonWallet','KLYME\x20DE','all','telegramId','\x20for\x20shop\x20','currencyService','turnover','lte','totalPayout','totalPaidOut','statusChangedBy','💰\x20Current\x20shop\x20balance:\x20','ACTIVE','SUSPENDED','password','usdtTrcWallet','getAllPayouts','length','admin','getAllPayments','findUnique','gte','defineProperty','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','🔧\x20[','gateways','day','getGatewayIdByName','log','paymentGateways','\x20USDT\x20(total\x20paid\x20to\x20merchants)','Telegram\x20username\x20already\x20exists','\x20\x20\x20Payout\x20amount:\x20','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','amountAfterGatewayCommissionUSDT',':\x20commission\x20=\x20','createdAt','💰\x20Shop\x20','wallets','substr','getGatewayDisplayName','💰\x20Payment\x20','2078212yQqZKx',']\x20Gateway\x20settings\x20before\x20saving:','\x20USDT\x20(gross\x20revenue)','839961oNJlMA','\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)','\x20\x20\x20�📊\x20Total\x20payments:\x20','\x20balance\x20updated:','totalTurnover','activateUser','\x20PAID\x20payments','\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...','cointopay2','klyme_gb','🔐\x20[','convertToUSDT','\x20\x20\x20🖥️\x20User\x20Agent:\x20','includes','\x20\x20\x20🌍\x20Country:\x20','cointopay','\x20\x20\x20Gateway:\x20','getPayoutById','\x20USDT\x20(','\x20USDT\x20(theoretical\x20net)','forEach','\x20USDT\x20for\x20payment\x20','totalAmountAfterCommissionUSDT','\x20USDT\x20(already\x20paid\x20out)','custom','__esModule','network','customerEmail','gateway','🔄\x20Gateway\x20mapping\x20(create):','deletePayout','🎯\x20[','\x27\x20->\x20name\x20\x27','amountUSDT','toUpperCase','polygon','gatewayEarnings','publicKey','🔍\x20Using\x20gateway\x20\x27','\x20\x20\x20📅\x20This\x20month:\x20','whiteUrl','getAllUsers','\x20USDT\x20(+','Open\x20Banking\x202','shopId','\x20paid\x20payments\x20for\x20analysis','\x20became\x20PAID:','getTime','\x20USDT\x20(current\x20balance\x20in\x20DB)','8nOnYBS','totalCommissionRate','paidOutUSDT','%\x20commission)','setDate','plisio','📊\x20Getting\x20payments\x20with\x20filters:','💰\x20[PAYOUT]\x20Merchant\x20','\x27\x20(from\x20\x27','\x20to\x20','getDate','updateCustomerData','getUserById','totalPayments','customerIp','merchantUrl','pendingUrl','gatewayOrderId','map','updatedAt','shop','\x27\x20->\x20ID\x20\x27','customerCountry','gatewaySettings','🔄\x20Gateway\x20mapping:','trim','get','getMerchantsAwaitingPayout','test_gateway','txid','⚠️\x20Payment\x20','totalAmountUSDT','63818DWrjOV','\x20merchants','_sum','\x20\x20\x20💳\x20Total\x20payments:\x20','\x20status:\x20',',\x20successful:\x20','\x20\x20\x20Total\x20paid\x20out:\x20','📊\x20Calculating\x20payout\x20statistics...','delete','getMonth','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','name','aggregate','9kFUikG','erc20','💰\x20Found\x20','set','189715SSTcIb','balance','failUrl','hash','fullName','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','findMany','merchantEarningsUSDT','getFullYear','🔄\x20Gateway\x20mapping\x20(get):','\x20\x20\x20Merchant\x20loses:\x20','\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)','💸\x20CHARGEBACK\x20penalty:\x20-','💰\x20Creating\x20payout\x20for\x20shop\x20','dateFrom','CHARGEBACK',']\x20Updating\x20password\x20for\x20user\x20','$transaction','notes','reduce','groupBy','create','\x20\x20\x20⏳\x20Pending\x20payout:\x20','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','getGatewayNameById','../config/database','Test\x20Gateway','amount','\x20USDT\x20(after\x20','📊\x20Sorting\x20payments\x20by\x20','\x20\x20\x20Full\x20amount:\x20','createUser','\x20\x20\x20🔍\x20Calculated\x20after\x20commission:\x20','thisMonth','Plisio','toLowerCase','💰\x20[PAYOUT]\x20Gateway\x20','values','MasterCard','turnoverUSDT','💳\x20Payout\x20wallet\x20for\x20','username','customerName','shopUrl','toISOString','paymentsCount','localeCompare','\x27\x20not\x20found.\x20Available\x20gateways:\x20','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','38XjCOlj','bcryptjs','KLYME\x20GB','📊\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20','push','\x20\x20\x20Current\x20balance:\x20'];a38_0x5728=function(){return _0x5b17e1;};return a38_0x5728();}function a38_0x5709(_0x5f1bbc,_0xcdc522){const _0x5728c2=a38_0x5728();return a38_0x5709=function(_0x5709cf,_0x5ab950){_0x5709cf=_0x5709cf-0x9f;let _0x2a3630=_0x5728c2[_0x5709cf];return _0x2a3630;},a38_0x5709(_0x5f1bbc,_0xcdc522);}var __importDefault=this&&this['__importDefault']||function(_0x1c3841){const _0x3f4071=a38_0x5709;return _0x1c3841&&_0x1c3841[_0x3f4071(0x165)]?_0x1c3841:{'default':_0x1c3841};};Object[a38_0xb47e75(0x135)](exports,a38_0xb47e75(0x165),{'value':!![]}),exports[a38_0xb47e75(0x10c)]=void 0x0;const database_1=__importDefault(require(a38_0xb47e75(0x1c7))),bcryptjs_1=__importDefault(require(a38_0xb47e75(0x1e0))),crypto_1=__importDefault(require(a38_0xb47e75(0x9f))),currencyService_1=require(a38_0xb47e75(0xdd)),gateway_1=require('../types/gateway');class AdminService{async[a38_0xb47e75(0x104)](){const _0x432910=a38_0xb47e75;console[_0x432910(0x13b)](_0x432910(0x1a4));const _0x2b9389=await database_1['default'][_0x432910(0x191)][_0x432910(0x1a9)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':'ACTIVE'}}),_0x201267=await database_1[_0x432910(0xa0)][_0x432910(0xc4)][_0x432910(0xf3)]({'where':{'status':_0x432910(0x11c),'gateway':{'not':_0x432910(0x199)}}}),_0x302fa9=new Date(),_0x1b100a=new Date(_0x302fa9['getFullYear'](),_0x302fa9['getMonth'](),0x1),_0x4b0922=new Date(_0x302fa9[_0x432910(0x1b6)](),_0x302fa9[_0x432910(0x1a6)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x1625b0=await database_1['default'][_0x432910(0xe5)]['aggregate']({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x1b100a,'lte':_0x4b0922},'status':_0x432910(0xcf)}}),_0x4cc21d=_0x2b9389[_0x432910(0x19f)][_0x432910(0x128)]||0x0,_0x5375ba=_0x2b9389[_0x432910(0x19f)][_0x432910(0x1af)]||0x0,_0x3edec5=_0x1625b0[_0x432910(0x19f)]['amount']||0x0,_0xc5043c={'totalPayout':Math['round'](_0x4cc21d*0x64)/0x64,'awaitingPayout':Math['round'](_0x5375ba*0x64)/0x64,'thisMonth':Math[_0x432910(0xfa)](_0x3edec5*0x64)/0x64,'availableBalance':Math[_0x432910(0xfa)](_0x5375ba*0x64)/0x64,'totalPayments':_0x201267};return console[_0x432910(0x13b)](_0x432910(0xff)),console[_0x432910(0x13b)](_0x432910(0xe6)+_0xc5043c[_0x432910(0x127)]+_0x432910(0x13d)),console[_0x432910(0x13b)](_0x432910(0x1b3)+_0xc5043c['awaitingPayout']+_0x432910(0x14d)),console[_0x432910(0x13b)]('\x20\x20\x20💵\x20Available\x20balance:\x20'+_0xc5043c['availableBalance']+'\x20USDT\x20(same\x20as\x20awaiting)'),console[_0x432910(0x13b)](_0x432910(0x173)+_0xc5043c['thisMonth']+_0x432910(0x110)),console['log'](_0x432910(0x1a0)+_0xc5043c[_0x432910(0x18a)]+_0x432910(0x152)),_0xc5043c;}async[a38_0xb47e75(0x188)](_0x5d9599,_0x1b2c7d){const _0x359dab=a38_0xb47e75;console[_0x359dab(0x13b)](_0x359dab(0x136)+_0x5d9599+':',_0x1b2c7d);const _0x37f6d9=await database_1[_0x359dab(0xa0)]['payment'][_0x359dab(0x133)]({'where':{'id':_0x5d9599},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x37f6d9)throw new Error(_0x359dab(0xc1));const _0x326b98={};_0x1b2c7d[_0x359dab(0x193)]!==undefined&&(_0x326b98[_0x359dab(0x193)]=_0x1b2c7d[_0x359dab(0x193)]||null);_0x1b2c7d[_0x359dab(0x18b)]!==undefined&&(_0x326b98['customerIp']=_0x1b2c7d[_0x359dab(0x18b)]||null);_0x1b2c7d[_0x359dab(0xb4)]!==undefined&&(_0x326b98[_0x359dab(0xb4)]=_0x1b2c7d[_0x359dab(0xb4)]||null);const _0x3a69ed=await database_1[_0x359dab(0xa0)]['payment']['update']({'where':{'id':_0x5d9599},'data':{..._0x326b98,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x359dab(0x13b)](_0x359dab(0xb6)+_0x5d9599),console[_0x359dab(0x13b)](_0x359dab(0x15a)+_0x37f6d9[_0x359dab(0x193)]+'\x20->\x20'+_0x3a69ed[_0x359dab(0x193)]),console[_0x359dab(0x13b)]('\x20\x20\x20🌐\x20IP:\x20'+_0x37f6d9['customerIp']+_0x359dab(0xf8)+_0x3a69ed[_0x359dab(0x18b)]),console[_0x359dab(0x13b)](_0x359dab(0x158)+(_0x37f6d9[_0x359dab(0xb4)]?_0x359dab(0x1ad):'not\x20set')+_0x359dab(0xf8)+(_0x3a69ed['customerUa']?_0x359dab(0x1ad):'not\x20set')),_0x3a69ed;}async['getSystemStatistics'](_0x418e6e){const _0x2f9eac=a38_0xb47e75,_0x32b19c=new Date();let _0x19e1c7;switch(_0x418e6e[_0x2f9eac(0x1d1)]()){case _0x2f9eac(0x139):_0x19e1c7=new Date(_0x32b19c[_0x2f9eac(0x1b6)](),_0x32b19c[_0x2f9eac(0x1a6)](),_0x32b19c[_0x2f9eac(0x187)](),0x0,0x0,0x0,0x0);break;case'yesterday':const _0x50c16c=new Date(_0x32b19c);_0x50c16c[_0x2f9eac(0x181)](_0x50c16c[_0x2f9eac(0x187)]()-0x1),_0x19e1c7=new Date(_0x50c16c[_0x2f9eac(0x1b6)](),_0x50c16c[_0x2f9eac(0x1a6)](),_0x50c16c['getDate'](),0x0,0x0,0x0,0x0);break;case'7d':_0x19e1c7=new Date(_0x32b19c['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x2f9eac(0xae):_0x19e1c7=new Date(_0x32b19c[_0x2f9eac(0x17b)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x2f9eac(0x10a):_0x19e1c7=new Date(_0x32b19c['getTime']()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x2f9eac(0x121):const _0x5c85a4=await database_1[_0x2f9eac(0xa0)][_0x2f9eac(0xc4)][_0x2f9eac(0xa3)]({'where':{'gateway':{'not':_0x2f9eac(0x199)}},'orderBy':{'createdAt':'asc'},'select':{'createdAt':!![]}});_0x19e1c7=_0x5c85a4?_0x5c85a4[_0x2f9eac(0x143)]:new Date(_0x2f9eac(0xaf));break;default:_0x19e1c7=new Date(_0x32b19c[_0x2f9eac(0x17b)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}_0x19e1c7['setHours'](0x0,0x0,0x0,0x0);let _0xc28fe1;if(_0x418e6e[_0x2f9eac(0x1d1)]()==='yesterday'){const _0xfc518b=new Date(_0x32b19c);_0xfc518b[_0x2f9eac(0x181)](_0xfc518b['getDate']()-0x1),_0xc28fe1=new Date(_0xfc518b['getFullYear'](),_0xfc518b[_0x2f9eac(0x1a6)](),_0xfc518b[_0x2f9eac(0x187)](),0x17,0x3b,0x3b,0x3e7);}const _0x128c02={'gte':_0x19e1c7};_0xc28fe1&&(_0x128c02['lte']=_0xc28fe1);const [_0xa04d01,_0x84dd57,_0x109bc8,_0x2b091c,_0x506342,_0x4fa6ee]=await Promise[_0x2f9eac(0x121)]([database_1[_0x2f9eac(0xa0)][_0x2f9eac(0x191)][_0x2f9eac(0xf3)](),database_1[_0x2f9eac(0xa0)][_0x2f9eac(0x191)][_0x2f9eac(0xf3)]({'where':{'status':_0x2f9eac(0x12b)}}),database_1[_0x2f9eac(0xa0)][_0x2f9eac(0xc4)]['count']({'where':{'status':_0x2f9eac(0x11c),'createdAt':_0x128c02,'gateway':{'not':_0x2f9eac(0x199)}}}),database_1[_0x2f9eac(0xa0)][_0x2f9eac(0xc4)][_0x2f9eac(0x1b4)]({'where':{'status':'PAID','createdAt':_0x128c02,'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x2f9eac(0xa0)]['payment'][_0x2f9eac(0x1b4)]({'where':{'gateway':{'not':_0x2f9eac(0x199)}},'take':0xa,'orderBy':{'createdAt':_0x2f9eac(0x107)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x2f9eac(0xc4)][_0x2f9eac(0x1b4)]({'where':{'createdAt':_0x128c02,'gateway':{'not':_0x2f9eac(0x199)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x2ca8b1=0x0,_0x21a97f=0x0;for(const _0x4b821a of _0x2b091c){const _0x51bb78=await currencyService_1[_0x2f9eac(0x124)][_0x2f9eac(0x157)](_0x4b821a[_0x2f9eac(0x1c9)],_0x4b821a[_0x2f9eac(0xea)]);_0x2ca8b1+=_0x51bb78;if(_0x4b821a[_0x2f9eac(0x141)]){const _0x4ff700=await currencyService_1[_0x2f9eac(0x124)][_0x2f9eac(0x157)](_0x4b821a[_0x2f9eac(0x1c9)],_0x4b821a[_0x2f9eac(0xea)]),_0x49919b=_0x4b821a['amountAfterGatewayCommissionUSDT'],_0x1b43e7=_0x4ff700-_0x49919b;_0x21a97f+=_0x1b43e7;}}const _0x282699=_0x109bc8>0x0?_0x2ca8b1/_0x109bc8:0x0,_0x381f6c=this[_0x2f9eac(0x10f)](_0x4fa6ee,_0x19e1c7,_0xc28fe1||_0x32b19c),_0x93049f=await database_1['default'][_0x2f9eac(0xc4)][_0x2f9eac(0xf3)]({'where':{'createdAt':_0x128c02,'gateway':{'not':_0x2f9eac(0x199)}}}),_0x131abd=_0x93049f>0x0?_0x109bc8/_0x93049f*0x64:0x0;return{'totalShops':_0xa04d01,'activeShops':_0x84dd57,'totalPayments':_0x109bc8,'successfulPayments':_0x109bc8,'totalAttempts':_0x93049f,'totalRevenue':Math['round'](_0x2ca8b1*0x64)/0x64,'trapayEarnings':Math[_0x2f9eac(0xfa)](_0x21a97f*0x64)/0x64,'averagePaymentAmount':Math['round'](_0x282699*0x64)/0x64,'conversionRate':Math['round'](_0x131abd*0x64)/0x64,'dailyRevenue':_0x381f6c[_0x2f9eac(0xef)],'dailyPayments':_0x381f6c[_0x2f9eac(0xd1)],'recentPayments':_0x506342[_0x2f9eac(0x18f)](_0x6e45ea=>({'id':_0x6e45ea['id'],'amount':_0x6e45ea[_0x2f9eac(0x1c9)],'currency':_0x6e45ea[_0x2f9eac(0xea)],'status':_0x6e45ea[_0x2f9eac(0xd9)],'gateway':_0x6e45ea[_0x2f9eac(0x168)],'shop':_0x6e45ea[_0x2f9eac(0x191)],'createdAt':_0x6e45ea['createdAt']}))};}async[a38_0xb47e75(0xe2)](_0x3e4656){const _0x3695f6=a38_0xb47e75;console['log'](_0x3695f6(0x1de),_0x3e4656);let _0x106fae,_0x3fb5d7=new Date();if(_0x3e4656['period']===_0x3695f6(0x164)&&_0x3e4656[_0x3695f6(0x1bc)]&&_0x3e4656[_0x3695f6(0xfd)])_0x106fae=new Date(_0x3e4656['dateFrom']),_0x3fb5d7=new Date(_0x3e4656['dateTo']),_0x106fae[_0x3695f6(0xf1)](0x0,0x0,0x0,0x0),_0x3fb5d7['setHours'](0x17,0x3b,0x3b,0x3e7);else{const _0x35072f=new Date();switch(_0x3e4656[_0x3695f6(0xe4)]){case _0x3695f6(0xe7):_0x106fae=new Date(_0x35072f['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x3695f6(0xd0):_0x106fae=new Date(_0x35072f[_0x3695f6(0x17b)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x3695f6(0x102):_0x106fae=new Date(_0x35072f['getTime']()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x3695f6(0x121):default:_0x106fae=new Date(_0x3695f6(0xaf));break;}_0x106fae[_0x3695f6(0xf1)](0x0,0x0,0x0,0x0),_0x3fb5d7[_0x3695f6(0xf1)](0x17,0x3b,0x3b,0x3e7);}console[_0x3695f6(0x13b)]('📅\x20Period:\x20'+_0x106fae['toISOString']()+_0x3695f6(0x186)+_0x3fb5d7['toISOString']());const _0xe33dbd={'status':_0x3695f6(0x11c),'gateway':{'not':_0x3695f6(0x199)},'paidAt':{'gte':_0x106fae,'lte':_0x3fb5d7}};_0x3e4656[_0x3695f6(0x178)]&&(_0xe33dbd[_0x3695f6(0x178)]=_0x3e4656['shopId']);const _0x180dcb=await database_1['default'][_0x3695f6(0xc4)][_0x3695f6(0x1b4)]({'where':_0xe33dbd,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x3695f6(0x13b)](_0x3695f6(0x1ac)+_0x180dcb[_0x3695f6(0x130)]+_0x3695f6(0x179));const _0xf7c453={'gateway':{'not':_0x3695f6(0x199)},'createdAt':{'gte':_0x106fae,'lte':_0x3fb5d7}};_0x3e4656[_0x3695f6(0x178)]&&(_0xf7c453['shopId']=_0x3e4656[_0x3695f6(0x178)]);const _0x44472a=await database_1[_0x3695f6(0xa0)]['payment']['count']({'where':_0xf7c453});console[_0x3695f6(0x13b)](_0x3695f6(0x119)+_0x44472a+_0x3695f6(0x1a2)+_0x180dcb[_0x3695f6(0x130)]);let _0x531e8b=0x0,_0x44e2c8=0x0,_0x181ac5=0x0;const _0x37fd1e={},_0x48f9be={},_0x2f63ef={};for(const _0x4c9cd2 of _0x180dcb){try{const _0x1f091f=_0x4c9cd2['amountUSDT']||0x0;if(_0x1f091f<=0x0){console[_0x3695f6(0xbe)](_0x3695f6(0x19b)+_0x4c9cd2['id']+_0x3695f6(0x153));continue;}let _0x587971,_0x50b0ca;if(_0x4c9cd2[_0x3695f6(0x141)]!==null&&_0x4c9cd2[_0x3695f6(0x141)]!==undefined)_0x587971=_0x4c9cd2[_0x3695f6(0x141)],_0x50b0ca=_0x1f091f-_0x587971,console[_0x3695f6(0x13b)]('📊\x20Using\x20saved\x20values\x20for\x20payment\x20'+_0x4c9cd2['id']+':\x20'+_0x1f091f[_0x3695f6(0xe0)](0x6)+_0x3695f6(0xab)+_0x587971['toFixed'](0x6)+_0x3695f6(0x110));else{let _0x201e83={};if(_0x4c9cd2['shop'][_0x3695f6(0x194)])try{_0x201e83=JSON['parse'](_0x4c9cd2[_0x3695f6(0x191)][_0x3695f6(0x194)]);}catch(_0x1ac548){console[_0x3695f6(0xda)](_0x3695f6(0x1e8)+_0x4c9cd2['shopId']+':',_0x1ac548);}let _0xbb63a6=0x2d;for(const [_0x4113e9,_0x176b6f]of Object['entries'](_0x201e83)){if(_0x4113e9[_0x3695f6(0x1d1)]()===_0x4c9cd2[_0x3695f6(0x168)][_0x3695f6(0x1d1)]()){_0xbb63a6=_0x176b6f['commission']||0x2d;break;}}_0x50b0ca=_0x1f091f*(_0xbb63a6/0x64),_0x587971=_0x1f091f-_0x50b0ca,console[_0x3695f6(0x13b)](_0x3695f6(0xd8)+_0x4c9cd2['id']+':\x20'+_0xbb63a6+'%\x20from\x20'+_0x1f091f[_0x3695f6(0xe0)](0x6)+_0x3695f6(0x110));}_0x531e8b+=_0x1f091f,_0x44e2c8+=_0x587971,_0x181ac5+=_0x50b0ca;let _0x29c536;_0x4c9cd2[_0x3695f6(0xac)]!==null&&_0x4c9cd2[_0x3695f6(0xac)]!==undefined?(_0x29c536=_0x4c9cd2[_0x3695f6(0xac)],console[_0x3695f6(0x13b)](_0x3695f6(0x1e2)+_0x4c9cd2['id']+':\x20'+_0x29c536+'%')):(_0x29c536=_0x1f091f>0x0?_0x50b0ca/_0x1f091f*0x64:0x0,console[_0x3695f6(0x13b)](_0x3695f6(0xf9)+_0x4c9cd2['id']+':\x20'+_0x29c536[_0x3695f6(0xe0)](0x2)+'%'));!_0x37fd1e[_0x4c9cd2[_0x3695f6(0x168)]]&&(_0x37fd1e[_0x4c9cd2[_0x3695f6(0x168)]]={'gateway':_0x4c9cd2[_0x3695f6(0x168)],'gatewayDisplayName':this[_0x3695f6(0x147)](_0x4c9cd2[_0x3695f6(0x168)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x37fd1e[_0x4c9cd2['gateway']]['paymentsCount']++,_0x37fd1e[_0x4c9cd2['gateway']]['turnoverUSDT']+=_0x1f091f,_0x37fd1e[_0x4c9cd2[_0x3695f6(0x168)]][_0x3695f6(0x100)]+=_0x50b0ca,_0x37fd1e[_0x4c9cd2[_0x3695f6(0x168)]][_0x3695f6(0x1b5)]+=_0x587971,_0x37fd1e[_0x4c9cd2[_0x3695f6(0x168)]][_0x3695f6(0x17e)]+=_0x29c536;!_0x3e4656[_0x3695f6(0x178)]&&(!_0x48f9be[_0x4c9cd2[_0x3695f6(0x178)]]&&(_0x48f9be[_0x4c9cd2[_0x3695f6(0x178)]]={'shopId':_0x4c9cd2[_0x3695f6(0x178)],'shopName':_0x4c9cd2['shop'][_0x3695f6(0x1a8)],'shopUsername':_0x4c9cd2[_0x3695f6(0x191)][_0x3695f6(0x1d7)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x48f9be[_0x4c9cd2[_0x3695f6(0x178)]][_0x3695f6(0x1db)]++,_0x48f9be[_0x4c9cd2['shopId']][_0x3695f6(0x1d5)]+=_0x1f091f,_0x48f9be[_0x4c9cd2[_0x3695f6(0x178)]][_0x3695f6(0x100)]+=_0x50b0ca,_0x48f9be[_0x4c9cd2[_0x3695f6(0x178)]]['merchantEarningsUSDT']+=_0x587971);const _0x1d7538=_0x4c9cd2[_0x3695f6(0xc8)][_0x3695f6(0x1da)]()['split']('T')[0x0];!_0x2f63ef[_0x1d7538]&&(_0x2f63ef[_0x1d7538]={'date':_0x1d7538,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x2f63ef[_0x1d7538]['turnover']+=_0x1f091f,_0x2f63ef[_0x1d7538][_0x3695f6(0x112)]+=_0x587971,_0x2f63ef[_0x1d7538][_0x3695f6(0x170)]+=_0x50b0ca,_0x2f63ef[_0x1d7538][_0x3695f6(0x1db)]++;}catch(_0x48d1a1){console['error'](_0x3695f6(0xbd)+_0x4c9cd2['id']+':',_0x48d1a1);}}Object[_0x3695f6(0x1d3)](_0x37fd1e)[_0x3695f6(0x160)](_0x21f266=>{const _0x5cf05a=_0x3695f6;_0x21f266[_0x5cf05a(0xaa)]=_0x21f266['paymentsCount']>0x0?_0x21f266[_0x5cf05a(0x17e)]/_0x21f266['paymentsCount']:0x0,delete _0x21f266[_0x5cf05a(0x17e)];}),Object['values'](_0x48f9be)[_0x3695f6(0x160)](_0x5a2890=>{const _0x799ac5=_0x3695f6;_0x5a2890[_0x799ac5(0xc5)]=_0x5a2890['paymentsCount']>0x0?_0x5a2890[_0x799ac5(0x1d5)]/_0x5a2890[_0x799ac5(0x1db)]:0x0;});let _0x59c3d8=0x0,_0x5acfa5=0x0;if(_0x3e4656[_0x3695f6(0x178)]){const _0x566f6a=await database_1[_0x3695f6(0xa0)]['payout']['findMany']({'where':{'shopId':_0x3e4656[_0x3695f6(0x178)],'status':'COMPLETED','createdAt':{'gte':_0x106fae,'lte':_0x3fb5d7}},'select':{'amount':!![]}});_0x59c3d8=_0x566f6a['reduce']((_0x4c851c,_0x199ec9)=>_0x4c851c+_0x199ec9[_0x3695f6(0x1c9)],0x0);const _0x1c696c=await database_1['default'][_0x3695f6(0xe5)][_0x3695f6(0x1b4)]({'where':{'shopId':_0x3e4656[_0x3695f6(0x178)],'status':'PENDING','createdAt':{'gte':_0x106fae,'lte':_0x3fb5d7}},'select':{'amount':!![]}});_0x5acfa5=_0x1c696c[_0x3695f6(0x1c1)]((_0x14be0d,_0xdb1804)=>_0x14be0d+_0xdb1804[_0x3695f6(0x1c9)],0x0);}const _0x3ec970=_0x44472a,_0x58a21f=_0x180dcb[_0x3695f6(0x130)],_0x15d9f1=_0x58a21f>0x0?_0x531e8b/_0x58a21f:0x0,_0x2fb8e3=_0x3ec970>0x0?Math[_0x3695f6(0xfa)](_0x58a21f/_0x3ec970*0x2710)/0x64:0x0,_0x50c9a5=Math['ceil']((_0x3fb5d7['getTime']()-_0x106fae[_0x3695f6(0x17b)]())/(0x3e8*0x3c*0x3c*0x18)),_0x46ac73={'totalTurnover':Math[_0x3695f6(0xfa)](_0x531e8b*0x64)/0x64,'merchantEarnings':Math['round'](_0x44e2c8*0x64)/0x64,'gatewayEarnings':Math[_0x3695f6(0xfa)](_0x181ac5*0x64)/0x64,'totalPaidOut':Math[_0x3695f6(0xfa)](_0x59c3d8*0x64)/0x64,'pendingPayout':Math[_0x3695f6(0xfa)](_0x5acfa5*0x64)/0x64,'averageCheck':Math[_0x3695f6(0xfa)](_0x15d9f1*0x64)/0x64,'totalPayments':_0x3ec970,'successfulPayments':_0x58a21f,'conversionRate':_0x2fb8e3,'gatewayBreakdown':Object[_0x3695f6(0x1d3)](_0x37fd1e)['map'](_0xbc7988=>({..._0xbc7988,'turnoverUSDT':Math[_0x3695f6(0xfa)](_0xbc7988[_0x3695f6(0x1d5)]*0x64)/0x64,'commissionUSDT':Math[_0x3695f6(0xfa)](_0xbc7988[_0x3695f6(0x100)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x3695f6(0xfa)](_0xbc7988[_0x3695f6(0x1b5)]*0x64)/0x64,'averageCommissionRate':Math[_0x3695f6(0xfa)](_0xbc7988[_0x3695f6(0xaa)]*0x64)/0x64})),'merchantBreakdown':_0x3e4656[_0x3695f6(0x178)]?undefined:Object[_0x3695f6(0x1d3)](_0x48f9be)[_0x3695f6(0x18f)](_0x403086=>({..._0x403086,'turnoverUSDT':Math[_0x3695f6(0xfa)](_0x403086['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x3695f6(0xfa)](_0x403086[_0x3695f6(0x100)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x3695f6(0xfa)](_0x403086[_0x3695f6(0x1b5)]*0x64)/0x64,'paidOutUSDT':Math['round'](_0x403086[_0x3695f6(0x17f)]*0x64)/0x64,'averageCheckUSDT':Math[_0x3695f6(0xfa)](_0x403086[_0x3695f6(0xc5)]*0x64)/0x64})),'dailyData':Object[_0x3695f6(0x1d3)](_0x2f63ef)[_0x3695f6(0x18f)](_0x37eb70=>({..._0x37eb70,'turnover':Math[_0x3695f6(0xfa)](_0x37eb70[_0x3695f6(0x125)]*0x64)/0x64,'merchantEarnings':Math['round'](_0x37eb70['merchantEarnings']*0x64)/0x64,'gatewayEarnings':Math[_0x3695f6(0xfa)](_0x37eb70['gatewayEarnings']*0x64)/0x64}))['sort']((_0x1b964e,_0x3a03f0)=>_0x1b964e[_0x3695f6(0xf6)][_0x3695f6(0x1dc)](_0x3a03f0[_0x3695f6(0xf6)])),'periodInfo':{'from':_0x106fae,'to':_0x3fb5d7,'periodType':_0x3e4656['period']||_0x3695f6(0x164),'daysCount':_0x50c9a5}};return console[_0x3695f6(0x13b)]('📊\x20Merchant\x20statistics\x20calculated:'),console['log'](_0x3695f6(0xa8)+_0x46ac73[_0x3695f6(0x150)]+'\x20USDT'),console[_0x3695f6(0x13b)]('\x20\x20\x20👤\x20Merchant\x20earnings:\x20'+_0x46ac73['merchantEarnings']+_0x3695f6(0x110)),console['log'](_0x3695f6(0x1a7)+_0x46ac73[_0x3695f6(0x170)]+_0x3695f6(0x110)),console[_0x3695f6(0x13b)](_0x3695f6(0x101)+_0x46ac73[_0x3695f6(0x128)]+_0x3695f6(0x110)),console[_0x3695f6(0x13b)](_0x3695f6(0x1c4)+_0x46ac73[_0x3695f6(0xd7)]+_0x3695f6(0x110)),console[_0x3695f6(0x13b)](_0x3695f6(0x14e)+_0x46ac73[_0x3695f6(0x18a)]),_0x46ac73;}async['getMerchantsSelection'](){const _0x22b517=a38_0xb47e75;console['log']('📋\x20Getting\x20merchants\x20selection\x20list...');const _0x400d82=await database_1['default'][_0x22b517(0x191)][_0x22b517(0x1b4)]({'where':{'status':'ACTIVE'},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x22b517(0xa5)}});return console[_0x22b517(0x13b)]('📋\x20Found\x20'+_0x400d82[_0x22b517(0x130)]+'\x20active\x20merchants\x20for\x20selection'),_0x400d82['map'](_0x325b92=>({'id':_0x325b92['id'],'username':_0x325b92[_0x22b517(0x1d7)],'name':_0x325b92[_0x22b517(0x1a8)]}));}['getGatewayDisplayName'](_0x127a52){const _0x1deda4=a38_0xb47e75,_0x6ecea2={'test_gateway':_0x1deda4(0x1c8),'plisio':_0x1deda4(0x1d0),'rapyd':_0x1deda4(0xf5),'noda':'Noda','cointopay':_0x1deda4(0x1eb),'cointopay2':_0x1deda4(0x177),'klyme_eu':'KLYME\x20EU','klyme_gb':_0x1deda4(0x1e1),'klyme_de':_0x1deda4(0x120),'mastercard':_0x1deda4(0x1d4)};return _0x6ecea2[_0x127a52]||_0x127a52;}[a38_0xb47e75(0xee)](_0x35aea6){const _0x2672ec=a38_0xb47e75,_0x45c568={'Test\x20Gateway':_0x2672ec(0x199),'Plisio':_0x2672ec(0x182),'Rapyd':_0x2672ec(0xed),'Noda':_0x2672ec(0xec),'CoinToPay':_0x2672ec(0x15b),'CoinToPay2':_0x2672ec(0x154),'KLYME\x20EU':_0x2672ec(0x11b),'KLYME\x20GB':_0x2672ec(0x155),'KLYME\x20DE':'klyme_de','MasterCard':'mastercard'};return _0x45c568[_0x35aea6]||_0x35aea6[_0x2672ec(0x1d1)]();}async[a38_0xb47e75(0x198)](_0x127c9e){const _0x3732ea=a38_0xb47e75,{page:_0x295a13,limit:_0x37abcc,minAmount:_0xf2b5b7,search:_0x525a45}=_0x127c9e,_0x2d06c9=(_0x295a13-0x1)*_0x37abcc;console[_0x3732ea(0x13b)](_0x3732ea(0xcd),_0x127c9e);const _0x47ac32={'balance':{'gt':0x0},'status':_0x3732ea(0x12b)};_0xf2b5b7&&(_0x47ac32[_0x3732ea(0x1af)][_0x3732ea(0x134)]=_0xf2b5b7);_0x525a45&&(_0x47ac32[_0x3732ea(0x1a8)]={'contains':_0x525a45,'mode':'insensitive'});const [_0x975e83,_0x2aca90]=await Promise[_0x3732ea(0x121)]([database_1[_0x3732ea(0xa0)][_0x3732ea(0x191)]['findMany']({'where':_0x47ac32,'skip':_0x2d06c9,'take':_0x37abcc,'orderBy':{'balance':_0x3732ea(0x107)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1['default']['shop'][_0x3732ea(0xf3)]({'where':_0x47ac32})]);console['log']('💰\x20Found\x20'+_0x975e83[_0x3732ea(0x130)]+_0x3732ea(0xbc));const _0x206ed4=await Promise[_0x3732ea(0x121)](_0x975e83['map'](async _0x3f5657=>{const _0x4e4b66=_0x3732ea,[_0x1ffd06,_0x106f8f,_0x349555]=await Promise['all']([database_1[_0x4e4b66(0xa0)][_0x4e4b66(0xc4)][_0x4e4b66(0xf3)]({'where':{'shopId':_0x3f5657['id'],'status':_0x4e4b66(0x11c),'gateway':{'not':'test_gateway'}}}),database_1[_0x4e4b66(0xa0)][_0x4e4b66(0xc4)]['findFirst']({'where':{'shopId':_0x3f5657['id'],'status':_0x4e4b66(0x11c),'gateway':{'not':_0x4e4b66(0x199)}},'orderBy':{'paidAt':_0x4e4b66(0xa5)},'select':{'paidAt':!![]}}),database_1[_0x4e4b66(0xa0)][_0x4e4b66(0xc4)][_0x4e4b66(0x1c2)]({'by':[_0x4e4b66(0x168)],'where':{'shopId':_0x3f5657['id'],'status':_0x4e4b66(0x11c),'gateway':{'not':_0x4e4b66(0x199)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x140bd2=new Date(),_0x1da4df=new Date(_0x140bd2[_0x4e4b66(0x1b6)](),_0x140bd2[_0x4e4b66(0x1a6)](),0x1),_0x5edcb8=new Date(_0x140bd2[_0x4e4b66(0x1b6)](),_0x140bd2[_0x4e4b66(0x1a6)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x2a37c6,_0x1d17aa]=await Promise[_0x4e4b66(0x121)]([database_1['default'][_0x4e4b66(0xe5)][_0x4e4b66(0x1a9)]({'_sum':{'amount':!![]},'where':{'shopId':_0x3f5657['id'],'status':_0x4e4b66(0xcf)}}),database_1[_0x4e4b66(0xa0)][_0x4e4b66(0xe5)][_0x4e4b66(0x1a9)]({'_sum':{'amount':!![]},'where':{'shopId':_0x3f5657['id'],'status':_0x4e4b66(0xcf),'createdAt':{'gte':_0x1da4df,'lte':_0x5edcb8}}})]),_0x5c37ee=_0x2a37c6[_0x4e4b66(0x19f)][_0x4e4b66(0x1c9)]||0x0,_0x2e885c=_0x1d17aa['_sum'][_0x4e4b66(0x1c9)]||0x0,_0x16b20a=await Promise[_0x4e4b66(0x121)](_0x349555['map'](async _0x3c7dcd=>{const _0x2ffa03=_0x4e4b66;let _0x22d144=0x2d;if(_0x3f5657['gatewaySettings'])try{const _0x489c9e=JSON[_0x2ffa03(0x11e)](_0x3f5657[_0x2ffa03(0x194)]);for(const [_0x19c0ce,_0x49c065]of Object['entries'](_0x489c9e)){if(_0x19c0ce[_0x2ffa03(0x1d1)]()===_0x3c7dcd[_0x2ffa03(0x168)][_0x2ffa03(0x1d1)]()){_0x22d144=_0x49c065[_0x2ffa03(0xdb)]||0xa,console[_0x2ffa03(0x13b)](_0x2ffa03(0x1d2)+_0x3c7dcd['gateway']+_0x2ffa03(0x123)+_0x3f5657['id']+_0x2ffa03(0x142)+_0x22d144+'%');break;}}}catch(_0x24aa45){console['error'](_0x2ffa03(0x1e8)+_0x3f5657['id']+':',_0x24aa45);}const _0x2f9597=_0x3c7dcd['_sum']?.['amountUSDT']||0x0,_0x289538=_0x2f9597*(0x1-_0x22d144/0x64);return{'gateway':_0x3c7dcd[_0x2ffa03(0x168)],'count':_0x3c7dcd[_0x2ffa03(0x103)]?.['id']||0x0,'amountUSDT':Math[_0x2ffa03(0xfa)](_0x2f9597*0x64)/0x64,'amountAfterCommissionUSDT':Math['round'](_0x289538*0x64)/0x64,'commission':_0x22d144};})),_0x2bcf63=_0x16b20a[_0x4e4b66(0x1c1)]((_0x3801d6,_0x4434c5)=>_0x3801d6+_0x4434c5[_0x4e4b66(0x16d)],0x0),_0x54c70e=_0x16b20a['reduce']((_0x50bace,_0x133168)=>_0x50bace+_0x133168['amountAfterCommissionUSDT'],0x0),_0x3201af=_0x3f5657['balance'];return console[_0x4e4b66(0x13b)](_0x4e4b66(0x184)+_0x3f5657['username']+':'),console[_0x4e4b66(0x13b)](_0x4e4b66(0xce)+_0x2bcf63[_0x4e4b66(0xe0)](0x2)+_0x4e4b66(0x14b)),console['log'](_0x4e4b66(0x1ce)+_0x54c70e['toFixed'](0x2)+_0x4e4b66(0x15f)),console[_0x4e4b66(0x13b)]('\x20\x20\x20✅\x20Actual\x20available\x20balance:\x20'+_0x3201af[_0x4e4b66(0xe0)](0x2)+_0x4e4b66(0x17c)),console[_0x4e4b66(0x13b)](_0x4e4b66(0xc3)+_0x5c37ee[_0x4e4b66(0xe0)](0x2)+_0x4e4b66(0x163)),console[_0x4e4b66(0x13b)](_0x4e4b66(0x108)+(_0x54c70e-_0x5c37ee-_0x3201af)[_0x4e4b66(0xe0)](0x2)+_0x4e4b66(0x1b9)),{'id':_0x3f5657['id'],'fullName':_0x3f5657[_0x4e4b66(0x1a8)],'username':_0x3f5657['username'],'telegramId':_0x3f5657[_0x4e4b66(0x10e)],'merchantUrl':_0x3f5657[_0x4e4b66(0x1d9)],'wallets':{'usdtPolygonWallet':_0x3f5657['usdtPolygonWallet'],'usdtTrcWallet':_0x3f5657[_0x4e4b66(0x12e)],'usdtErcWallet':_0x3f5657[_0x4e4b66(0xf7)],'usdcPolygonWallet':_0x3f5657[_0x4e4b66(0xf0)],'usdcErcWallet':_0x3f5657[_0x4e4b66(0x114)]},'totalAmountUSDT':Math[_0x4e4b66(0xfa)](_0x2bcf63*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x4e4b66(0xfa)](_0x54c70e*0x64)/0x64,'currentBalance':Math['round'](_0x3201af*0x64)/0x64,'totalPayout':Math['round'](_0x5c37ee*0x64)/0x64,'thisMonth':Math[_0x4e4b66(0xfa)](_0x2e885c*0x64)/0x64,'paymentsCount':_0x1ffd06,'oldestPaymentDate':_0x106f8f?.[_0x4e4b66(0xc8)]||_0x3f5657[_0x4e4b66(0x143)],'gatewayBreakdown':_0x16b20a};})),_0x28b22c=_0x206ed4['reduce']((_0x187e57,_0x4453ca)=>_0x187e57+_0x4453ca[_0x3732ea(0x19c)],0x0),_0x4824cc=_0x206ed4['reduce']((_0x524c2b,_0x1f34e0)=>_0x524c2b+_0x1f34e0[_0x3732ea(0x162)],0x0),_0x57dbb2=_0x206ed4[_0x3732ea(0x1c1)]((_0x310d92,_0xf03ef7)=>_0x310d92+_0xf03ef7[_0x3732ea(0x127)],0x0),_0x34fed5=_0x206ed4['reduce']((_0x3291d0,_0x3fe2d5)=>_0x3291d0+_0x3fe2d5[_0x3732ea(0x1cf)],0x0);return console[_0x3732ea(0x13b)]('📊\x20Merchants\x20awaiting\x20payout:\x20'+_0x2aca90+_0x3732ea(0x19e)),console['log'](_0x3732ea(0xcb)+Math[_0x3732ea(0xfa)](_0x28b22c*0x64)/0x64+_0x3732ea(0x14b)),console['log']('\x20\x20\x20✅\x20Total\x20available\x20for\x20payout:\x20'+Math[_0x3732ea(0xfa)](_0x4824cc*0x64)/0x64+'\x20USDT\x20(actual\x20balances)'),console[_0x3732ea(0x13b)]('\x20\x20\x20💸\x20Total\x20payouts\x20(all\x20time):\x20'+Math[_0x3732ea(0xfa)](_0x57dbb2*0x64)/0x64+'\x20USDT'),console[_0x3732ea(0x13b)](_0x3732ea(0x10b)+Math[_0x3732ea(0xfa)](_0x34fed5*0x64)/0x64+_0x3732ea(0x110)),{'merchants':_0x206ed4,'pagination':{'page':_0x295a13,'limit':_0x37abcc,'total':_0x2aca90,'totalPages':Math[_0x3732ea(0xa2)](_0x2aca90/_0x37abcc)},'summary':{'totalMerchants':_0x2aca90,'totalAmountUSDT':Math[_0x3732ea(0xfa)](_0x28b22c*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x3732ea(0xfa)](_0x4824cc*0x64)/0x64,'totalPayout':Math[_0x3732ea(0xfa)](_0x57dbb2*0x64)/0x64,'thisMonth':Math[_0x3732ea(0xfa)](_0x34fed5*0x64)/0x64}};}async['createPayout'](_0x4b747a){const _0x316190=a38_0xb47e75,{shopId:_0x40e976,amount:_0x59f095,network:_0x55d60c,wallet:_0x108e1c,notes:_0x4cb88c,txid:_0x54771b,periodFrom:_0x456ae1,periodTo:_0x21b512}=_0x4b747a,_0x14a800=await database_1[_0x316190(0xa0)]['$transaction'](async _0x16ee52=>{const _0x1797d4=_0x316190,_0x21d2c9=await _0x16ee52[_0x1797d4(0x191)][_0x1797d4(0x133)]({'where':{'id':_0x40e976},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x21d2c9)throw new Error(_0x1797d4(0xb5));console[_0x1797d4(0x13b)](_0x1797d4(0x1bb)+_0x21d2c9[_0x1797d4(0x1d7)]+':'),console['log'](_0x1797d4(0x1e4)+_0x21d2c9[_0x1797d4(0x1af)]['toFixed'](0x6)+'\x20USDT'),console[_0x1797d4(0x13b)](_0x1797d4(0x13f)+_0x59f095[_0x1797d4(0xe0)](0x6)+_0x1797d4(0x110)),console[_0x1797d4(0x13b)](_0x1797d4(0x109)+_0x21d2c9[_0x1797d4(0x128)][_0x1797d4(0xe0)](0x6)+_0x1797d4(0x110));if(_0x54771b)console[_0x1797d4(0x13b)](_0x1797d4(0x1e7)+_0x54771b);if(_0x21d2c9['balance']<_0x59f095)throw new Error(_0x1797d4(0x118)+_0x21d2c9[_0x1797d4(0x1af)]['toFixed'](0x6)+_0x1797d4(0xd3)+_0x59f095[_0x1797d4(0xe0)](0x6)+'\x20USDT');let _0x1fa734=_0x108e1c;if(!_0x1fa734){const _0x13d638=await _0x16ee52[_0x1797d4(0x191)][_0x1797d4(0x133)]({'where':{'id':_0x40e976},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});if(_0x13d638)switch(_0x55d60c){case _0x1797d4(0x16f):_0x1fa734=_0x13d638[_0x1797d4(0x11f)]||undefined;break;case _0x1797d4(0xba):_0x1fa734=_0x13d638[_0x1797d4(0x12e)]||undefined;break;case _0x1797d4(0x1ab):_0x1fa734=_0x13d638[_0x1797d4(0xf7)]||undefined;break;case _0x1797d4(0xd2):_0x1fa734=_0x13d638[_0x1797d4(0xf0)]||undefined;break;case'erc20_usdc':_0x1fa734=_0x13d638[_0x1797d4(0x114)]||undefined;break;}}console[_0x1797d4(0x13b)](_0x1797d4(0x1d6)+_0x55d60c+':\x20'+(_0x1fa734||'not\x20specified'));const _0x3de12a=await _0x16ee52[_0x1797d4(0xe5)][_0x1797d4(0x1c3)]({'data':{'shopId':_0x40e976,'amount':_0x59f095,'network':_0x55d60c,'status':'COMPLETED','txid':_0x54771b,'notes':_0x4cb88c,'periodFrom':_0x456ae1?new Date(_0x456ae1):null,'periodTo':_0x21b512?new Date(_0x21b512):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x336a0a=_0x21d2c9[_0x1797d4(0x1af)]-_0x59f095,_0xece94c=_0x21d2c9[_0x1797d4(0x128)]+_0x59f095;return await _0x16ee52[_0x1797d4(0x191)][_0x1797d4(0xdc)]({'where':{'id':_0x40e976},'data':{'balance':_0x336a0a,'totalPaidOut':_0xece94c}}),console[_0x1797d4(0x13b)](_0x1797d4(0x144)+_0x21d2c9['username']+_0x1797d4(0x14f)),console['log'](_0x1797d4(0xc9)+_0x21d2c9['balance'][_0x1797d4(0xe0)](0x6)+_0x1797d4(0xf8)+_0x336a0a[_0x1797d4(0xe0)](0x6)+_0x1797d4(0x116)+_0x59f095[_0x1797d4(0xe0)](0x6)+')'),console[_0x1797d4(0x13b)](_0x1797d4(0x1a3)+_0x21d2c9[_0x1797d4(0x128)][_0x1797d4(0xe0)](0x6)+_0x1797d4(0xf8)+_0xece94c[_0x1797d4(0xe0)](0x6)+_0x1797d4(0x176)+_0x59f095['toFixed'](0x6)+')'),{'payout':_0x3de12a,'shop':_0x21d2c9};});return console['log']('✅\x20Payout\x20created:\x20'+_0x14a800[_0x316190(0xe5)]['id']+'\x20for\x20shop\x20'+_0x14a800[_0x316190(0x191)][_0x316190(0x1d7)]+'\x20('+_0x59f095+'\x20USDT)'),{'id':_0x14a800['payout']['id'],'shopId':_0x14a800[_0x316190(0xe5)][_0x316190(0x178)],'shopName':_0x14a800[_0x316190(0x191)][_0x316190(0x1a8)],'shopUsername':_0x14a800['shop'][_0x316190(0x1d7)],'amount':_0x14a800[_0x316190(0xe5)][_0x316190(0x1c9)],'network':_0x14a800[_0x316190(0xe5)]['network'],'status':_0x14a800['payout'][_0x316190(0xd9)],'txid':_0x14a800['payout'][_0x316190(0x19a)],'notes':_0x14a800[_0x316190(0xe5)]['notes'],'periodFrom':_0x14a800[_0x316190(0xe5)][_0x316190(0xad)],'periodTo':_0x14a800['payout']['periodTo'],'createdAt':_0x14a800['payout'][_0x316190(0x143)],'paidAt':_0x14a800[_0x316190(0xe5)][_0x316190(0xc8)]};}async[a38_0xb47e75(0x12f)](_0x591e82){const _0x34ee4a=a38_0xb47e75,{page:_0x12bc62,limit:_0x2e5094,shopId:_0x58c9a4,network:_0x2e6ba1,dateFrom:_0x1c784e,dateTo:_0x3fb8da,search:_0x2114f8}=_0x591e82,_0xa98b0b=(_0x12bc62-0x1)*_0x2e5094,_0x36394d={};_0x58c9a4&&(_0x36394d[_0x34ee4a(0x178)]=_0x58c9a4);_0x2e6ba1&&(_0x36394d['network']=_0x2e6ba1);(_0x1c784e||_0x3fb8da)&&(_0x36394d[_0x34ee4a(0x143)]={},_0x1c784e&&(_0x36394d[_0x34ee4a(0x143)]['gte']=new Date(_0x1c784e)),_0x3fb8da&&(_0x36394d['createdAt'][_0x34ee4a(0x126)]=new Date(_0x3fb8da)));_0x2114f8&&(_0x36394d['OR']=[{'shop':{'name':{'contains':_0x2114f8,'mode':_0x34ee4a(0xfb)}}},{'shop':{'username':{'contains':_0x2114f8,'mode':_0x34ee4a(0xfb)}}},{'notes':{'contains':_0x2114f8,'mode':_0x34ee4a(0xfb)}}]);const [_0x189e2a,_0x45ee0e]=await Promise[_0x34ee4a(0x121)]([database_1[_0x34ee4a(0xa0)]['payout'][_0x34ee4a(0x1b4)]({'where':_0x36394d,'skip':_0xa98b0b,'take':_0x2e5094,'orderBy':{'createdAt':_0x34ee4a(0x107)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x34ee4a(0xa0)][_0x34ee4a(0xe5)][_0x34ee4a(0xf3)]({'where':_0x36394d})]);return{'payouts':_0x189e2a[_0x34ee4a(0x18f)](_0x4e3a32=>({'id':_0x4e3a32['id'],'shopId':_0x4e3a32[_0x34ee4a(0x178)],'shopName':_0x4e3a32[_0x34ee4a(0x191)][_0x34ee4a(0x1a8)],'shopUsername':_0x4e3a32['shop'][_0x34ee4a(0x1d7)],'amount':_0x4e3a32[_0x34ee4a(0x1c9)],'network':_0x4e3a32['network'],'status':_0x4e3a32[_0x34ee4a(0xd9)],'txid':_0x4e3a32[_0x34ee4a(0x19a)],'notes':_0x4e3a32['notes'],'periodFrom':_0x4e3a32[_0x34ee4a(0xad)],'periodTo':_0x4e3a32[_0x34ee4a(0xe3)],'createdAt':_0x4e3a32[_0x34ee4a(0x143)],'paidAt':_0x4e3a32[_0x34ee4a(0xc8)]})),'pagination':{'page':_0x12bc62,'limit':_0x2e5094,'total':_0x45ee0e,'totalPages':Math[_0x34ee4a(0xa2)](_0x45ee0e/_0x2e5094)}};}async[a38_0xb47e75(0x15d)](_0x484f38){const _0x3a7d5b=a38_0xb47e75,_0x2e78c9=await database_1['default'][_0x3a7d5b(0xe5)]['findUnique']({'where':{'id':_0x484f38},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x2e78c9)return null;return{'id':_0x2e78c9['id'],'shopId':_0x2e78c9['shopId'],'shopName':_0x2e78c9[_0x3a7d5b(0x191)]['name'],'shopUsername':_0x2e78c9['shop'][_0x3a7d5b(0x1d7)],'amount':_0x2e78c9[_0x3a7d5b(0x1c9)],'network':_0x2e78c9[_0x3a7d5b(0x166)],'status':_0x2e78c9['status'],'txid':_0x2e78c9[_0x3a7d5b(0x19a)],'notes':_0x2e78c9[_0x3a7d5b(0x1c0)],'periodFrom':_0x2e78c9[_0x3a7d5b(0xad)],'periodTo':_0x2e78c9[_0x3a7d5b(0xe3)],'createdAt':_0x2e78c9[_0x3a7d5b(0x143)],'paidAt':_0x2e78c9['paidAt']};}async[a38_0xb47e75(0x16a)](_0x5451a7){const _0x28f14f=a38_0xb47e75;await database_1[_0x28f14f(0xa0)][_0x28f14f(0xe5)][_0x28f14f(0x1a5)]({'where':{'id':_0x5451a7}});}async[a38_0xb47e75(0x132)](_0x5d573e){const _0xadcf53=a38_0xb47e75,{page:_0x35a339,limit:_0x42088f,status:_0x48e1a2,gateway:_0x1655d9,shopId:_0x49da38,dateFrom:_0x197f1f,dateTo:_0x1813f8,search:_0x1943ea,currency:_0x1d439a,sortBy:_0x2346cd,sortOrder:_0xb27d5}=_0x5d573e,_0x4189ca=(_0x35a339-0x1)*_0x42088f;console[_0xadcf53(0x13b)](_0xadcf53(0x183),_0x5d573e);const _0x29708a=await database_1[_0xadcf53(0xa0)][_0xadcf53(0xc4)][_0xadcf53(0x1c2)]({'by':[_0xadcf53(0x168)],'_count':{'gateway':!![]}});console[_0xadcf53(0x13b)]('📊\x20Available\x20gateways\x20in\x20database:',_0x29708a['map'](_0x465ccb=>_0x465ccb[_0xadcf53(0x168)]+'\x20('+_0x465ccb['_count']['gateway']+_0xadcf53(0xf2)));if(_0x1655d9){const _0x17ead4=_0x29708a[_0xadcf53(0x106)](_0x43465b=>_0x43465b['gateway']['toLowerCase']()===_0x1655d9[_0xadcf53(0x1d1)]());!_0x17ead4&&_0x1655d9[_0xadcf53(0x1d1)]()!==_0xadcf53(0x199)&&console['log'](_0xadcf53(0x11a)+_0x1655d9+_0xadcf53(0x1dd)+_0x29708a[_0xadcf53(0x18f)](_0x391847=>_0x391847['gateway'])['join'](',\x20'));}const _0x560e0e={};_0x48e1a2&&(_0x560e0e[_0xadcf53(0xd9)]=_0x48e1a2[_0xadcf53(0x16e)]());if(!_0x1655d9)_0x560e0e[_0xadcf53(0x168)]={'not':_0xadcf53(0x199)};else{if(_0x1655d9&&(_0x1655d9['toLowerCase']()===_0xadcf53(0x199)||_0x1655d9===_0xadcf53(0xe9)))_0x560e0e[_0xadcf53(0x168)]=_0xadcf53(0x199);else{let _0xf110f7=_0x1655d9;const _0x38fb8c=(0x0,gateway_1[_0xadcf53(0x1c6)])(_0x1655d9);if(_0x38fb8c)_0xf110f7=_0x38fb8c,console[_0xadcf53(0x13b)](_0xadcf53(0xb9)+_0x1655d9+'\x27\x20to\x20name\x20\x27'+_0xf110f7+'\x27');else{const _0x5a5861=(0x0,gateway_1[_0xadcf53(0x13a)])(_0x1655d9);if(_0x5a5861){const _0x22d51a=(0x0,gateway_1[_0xadcf53(0x1c6)])(_0x5a5861);_0x22d51a&&(_0xf110f7=_0x22d51a,console['log'](_0xadcf53(0xd4)+_0x1655d9+_0xadcf53(0x192)+_0x5a5861+_0xadcf53(0x16c)+_0xf110f7+'\x27'));}else console[_0xadcf53(0x13b)](_0xadcf53(0x172)+_0x1655d9+'\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)');}const _0x21cfb6=await database_1[_0xadcf53(0xa0)][_0xadcf53(0xc4)]['count']({'where':{'gateway':_0xf110f7[_0xadcf53(0x1d1)]()},'take':0x1});_0x21cfb6===0x0?(console['log'](_0xadcf53(0xb7)+_0xf110f7+_0xadcf53(0x185)+_0x1655d9+_0xadcf53(0x140)),_0x560e0e['gateway']='NONEXISTENT_GATEWAY_FILTER'):(_0x560e0e['gateway']=_0xf110f7[_0xadcf53(0x1d1)](),console['log']('✅\x20Using\x20gateway\x20filter:\x20\x27'+_0xf110f7+_0xadcf53(0x185)+_0x1655d9+'\x27)'));}}console[_0xadcf53(0x13b)](_0xadcf53(0xb8),_0x560e0e[_0xadcf53(0x168)]);_0x49da38&&(_0x560e0e[_0xadcf53(0x178)]=_0x49da38);_0x1d439a&&(_0x560e0e[_0xadcf53(0xea)]=_0x1d439a[_0xadcf53(0x16e)](),console[_0xadcf53(0x13b)](_0xadcf53(0xcc)+_0x1d439a['toUpperCase']()));(_0x197f1f||_0x1813f8)&&(_0x560e0e[_0xadcf53(0x143)]={},_0x197f1f&&(_0x560e0e[_0xadcf53(0x143)]['gte']=new Date(_0x197f1f)),_0x1813f8&&(_0x560e0e['createdAt'][_0xadcf53(0x126)]=new Date(_0x1813f8)));_0x1943ea&&(_0x560e0e['OR']=[{'id':{'contains':_0x1943ea,'mode':'insensitive'}},{'orderId':{'contains':_0x1943ea,'mode':_0xadcf53(0xfb)}},{'gatewayOrderId':{'contains':_0x1943ea,'mode':_0xadcf53(0xfb)}},{'customerEmail':{'contains':_0x1943ea,'mode':_0xadcf53(0xfb)}},{'shop':{'name':{'contains':_0x1943ea,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x1943ea,'mode':'insensitive'}}}]);console[_0xadcf53(0x13b)](_0xadcf53(0xc7),JSON['stringify'](_0x560e0e,null,0x2));let _0x47fb1b={'createdAt':'desc'};if(_0x2346cd){const _0x34c369=[_0xadcf53(0x1c9),_0xadcf53(0x143),'updatedAt',_0xadcf53(0xd9),_0xadcf53(0x168),_0xadcf53(0xea)],_0x4a4779=[_0xadcf53(0xa5),_0xadcf53(0x107)];if(_0x34c369[_0xadcf53(0x159)](_0x2346cd)){const _0x125629=_0x4a4779[_0xadcf53(0x159)](_0xb27d5)?_0xb27d5:'desc';_0x47fb1b={[_0x2346cd]:_0x125629},console['log'](_0xadcf53(0x1cb)+_0x2346cd+_0xadcf53(0xb0)+_0x125629+_0xadcf53(0x105));}}const [_0xd2babc,_0x431586]=await Promise[_0xadcf53(0x121)]([database_1[_0xadcf53(0xa0)][_0xadcf53(0xc4)]['findMany']({'where':_0x560e0e,'skip':_0x4189ca,'take':_0x42088f,'orderBy':_0x47fb1b,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0xadcf53(0xa0)][_0xadcf53(0xc4)][_0xadcf53(0xf3)]({'where':_0x560e0e})]);return{'payments':_0xd2babc,'pagination':{'page':_0x35a339,'limit':_0x42088f,'total':_0x431586,'totalPages':Math[_0xadcf53(0xa2)](_0x431586/_0x42088f)}};}async['getPaymentById'](_0x2d41b8){const _0x2baf87=a38_0xb47e75,_0x4a0f7f=await database_1['default'][_0x2baf87(0xc4)]['findUnique']({'where':{'id':_0x2d41b8},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x4a0f7f)return null;return{'id':_0x4a0f7f['id'],'shopId':_0x4a0f7f['shopId'],'gateway':_0x4a0f7f[_0x2baf87(0x168)],'amount':_0x4a0f7f['amount'],'currency':_0x4a0f7f[_0x2baf87(0xea)],'status':_0x4a0f7f[_0x2baf87(0xd9)],'orderId':_0x4a0f7f[_0x2baf87(0xc0)],'gatewayOrderId':_0x4a0f7f[_0x2baf87(0x18e)],'customerEmail':_0x4a0f7f[_0x2baf87(0x167)],'customerName':_0x4a0f7f[_0x2baf87(0x1d8)],'customerCountry':_0x4a0f7f[_0x2baf87(0x193)],'customerIp':_0x4a0f7f['customerIp'],'customerUa':_0x4a0f7f[_0x2baf87(0xb4)],'failureMessage':_0x4a0f7f[_0x2baf87(0x117)],'externalPaymentUrl':_0x4a0f7f['externalPaymentUrl'],'successUrl':_0x4a0f7f[_0x2baf87(0xc2)],'failUrl':_0x4a0f7f[_0x2baf87(0x1b0)],'pendingUrl':_0x4a0f7f[_0x2baf87(0x18d)],'whiteUrl':_0x4a0f7f[_0x2baf87(0x174)],'createdAt':_0x4a0f7f[_0x2baf87(0x143)],'updatedAt':_0x4a0f7f[_0x2baf87(0x190)],'shop':_0x4a0f7f['shop']};}async[a38_0xb47e75(0xb2)](_0x716cd7,_0x4f7001,_0x269142,_0x18f877){const _0x48e61b=a38_0xb47e75,_0x3b1a63=await database_1[_0x48e61b(0xa0)][_0x48e61b(0x1bf)](async _0x24529b=>{const _0xa5bc92=_0x48e61b,_0x300e8f=await _0x24529b[_0xa5bc92(0xc4)][_0xa5bc92(0x133)]({'where':{'id':_0x716cd7},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x300e8f)throw new Error(_0xa5bc92(0xc1));const _0x3ee56c=_0x300e8f['status'],_0x8ba539=_0x4f7001[_0xa5bc92(0x16e)]();console[_0xa5bc92(0x13b)](_0xa5bc92(0xb1)+_0x716cd7+_0xa5bc92(0x1a1)+_0x3ee56c+'\x20->\x20'+_0x8ba539),console[_0xa5bc92(0x13b)](_0xa5bc92(0x12a)+_0x300e8f['shop'][_0xa5bc92(0x1af)]+_0xa5bc92(0x110));const _0x31458a={'status':_0x8ba539,'updatedAt':new Date(),'statusChangedBy':_0xa5bc92(0x131),'statusChangedAt':new Date()};_0x269142&&(_0x31458a['adminNotes']=_0x269142);_0x8ba539===_0xa5bc92(0x1bd)&&_0x18f877&&(_0x31458a[_0xa5bc92(0xa1)]=_0x18f877);let _0x14fb30=0x0,_0x22945d=_0x300e8f[_0xa5bc92(0x191)][_0xa5bc92(0x1af)];if(_0x8ba539===_0xa5bc92(0x11c)&&_0x3ee56c!=='PAID'){_0x31458a[_0xa5bc92(0xc8)]=new Date();const _0xc71d49=await currencyService_1[_0xa5bc92(0x124)]['convertToUSDT'](_0x300e8f[_0xa5bc92(0x1c9)],_0x300e8f['currency']);_0x31458a['amountUSDT']=_0xc71d49;let _0x415104=0x2d;const _0x467f3c=await _0x24529b['shop'][_0xa5bc92(0x133)]({'where':{'id':_0x300e8f[_0xa5bc92(0x178)]},'select':{'gatewaySettings':!![]}});if(_0x467f3c?.[_0xa5bc92(0x194)])try{const _0x42905e=JSON[_0xa5bc92(0x11e)](_0x467f3c[_0xa5bc92(0x194)]);for(const [_0x39332e,_0x3f3132]of Object['entries'](_0x42905e)){if(_0x39332e[_0xa5bc92(0x1d1)]()===_0x300e8f[_0xa5bc92(0x168)][_0xa5bc92(0x1d1)]()){_0x415104=_0x3f3132['commission']||0xa;break;}}}catch(_0x4ef685){console[_0xa5bc92(0xda)](_0xa5bc92(0x1c5)+_0x716cd7+':',_0x4ef685);}let _0x416bbc;_0x300e8f['amountAfterGatewayCommissionUSDT']!==null&&_0x300e8f[_0xa5bc92(0x141)]!==undefined?(_0x416bbc=_0x300e8f[_0xa5bc92(0x141)],console['log'](_0xa5bc92(0xa7)+_0x416bbc['toFixed'](0x6)+_0xa5bc92(0x161)+_0x716cd7)):(_0x416bbc=_0xc71d49*(0x1-_0x415104/0x64),console[_0xa5bc92(0x13b)]('📊\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20'+_0x716cd7+':\x20'+_0x415104+_0xa5bc92(0x10d)+_0xc71d49[_0xa5bc92(0xe0)](0x6)+_0xa5bc92(0x110)),_0x31458a[_0xa5bc92(0x141)]=_0x416bbc,_0x31458a['gatewayCommissionRate']=_0x415104),_0x14fb30=_0x416bbc,_0x22945d+=_0x416bbc,console[_0xa5bc92(0x13b)](_0xa5bc92(0x148)+_0x716cd7+_0xa5bc92(0x17a)),console[_0xa5bc92(0x13b)](_0xa5bc92(0x1cc)+_0xc71d49[_0xa5bc92(0xe0)](0x6)+_0xa5bc92(0x110)),console[_0xa5bc92(0x13b)](_0xa5bc92(0x15c)+_0x300e8f[_0xa5bc92(0x168)]+_0xa5bc92(0xc6)+_0x415104+'%'),console[_0xa5bc92(0x13b)]('\x20\x20\x20Merchant\x20gets:\x20'+_0x416bbc[_0xa5bc92(0xe0)](0x6)+_0xa5bc92(0x1ca)+_0x415104+_0xa5bc92(0x180)),console[_0xa5bc92(0x13b)](_0xa5bc92(0x1ea)+_0x416bbc['toFixed'](0x6)+_0xa5bc92(0x110));}else{if(_0x3ee56c==='PAID'&&_0x8ba539!=='PAID'){if(_0x300e8f[_0xa5bc92(0x16d)]){let _0xa5ef23=0x2d;const _0x56ddb5=await _0x24529b[_0xa5bc92(0x191)]['findUnique']({'where':{'id':_0x300e8f[_0xa5bc92(0x178)]},'select':{'gatewaySettings':!![]}});if(_0x56ddb5?.[_0xa5bc92(0x194)])try{const _0x2fccbc=JSON[_0xa5bc92(0x11e)](_0x56ddb5[_0xa5bc92(0x194)]);for(const [_0x13a7c9,_0x122f3b]of Object[_0xa5bc92(0x1e6)](_0x2fccbc)){if(_0x13a7c9[_0xa5bc92(0x1d1)]()===_0x300e8f[_0xa5bc92(0x168)][_0xa5bc92(0x1d1)]()){_0xa5ef23=_0x122f3b[_0xa5bc92(0xdb)]||0xa;break;}}}catch(_0x3b127f){console['error'](_0xa5bc92(0x1c5)+_0x716cd7+':',_0x3b127f);}const _0x39ec65=_0x300e8f[_0xa5bc92(0x16d)]*(0x1-_0xa5ef23/0x64);_0x14fb30=-_0x39ec65,_0x22945d-=_0x39ec65,_0x31458a['amountUSDT']=null,_0x31458a[_0xa5bc92(0x141)]=null,console['log'](_0xa5bc92(0x148)+_0x716cd7+'\x20no\x20longer\x20PAID:'),console[_0xa5bc92(0x13b)](_0xa5bc92(0x1cc)+_0x300e8f[_0xa5bc92(0x16d)][_0xa5bc92(0xe0)](0x6)+_0xa5bc92(0x110)),console[_0xa5bc92(0x13b)]('\x20\x20\x20Gateway:\x20'+_0x300e8f['gateway']+',\x20Commission:\x20'+_0xa5ef23+'%'),console['log'](_0xa5bc92(0x1b8)+_0x39ec65[_0xa5bc92(0xe0)](0x6)+_0xa5bc92(0x1ca)+_0xa5ef23+_0xa5bc92(0x180)),console['log']('\x20\x20\x20Subtracted\x20from\x20balance:\x20-'+_0x39ec65['toFixed'](0x6)+_0xa5bc92(0x110));}}}_0x8ba539===_0xa5bc92(0x1bd)&&(_0x3ee56c==='PAID'&&_0x300e8f['amountUSDT']&&console['log'](_0xa5bc92(0xa6)),_0x18f877&&_0x18f877>0x0&&(_0x14fb30-=_0x18f877,_0x22945d-=_0x18f877,console['log'](_0xa5bc92(0x1ba)+_0x18f877['toFixed'](0x6)+_0xa5bc92(0xa9))));_0x8ba539===_0xa5bc92(0xe1)&&_0x3ee56c===_0xa5bc92(0x11c)&&console[_0xa5bc92(0x13b)](_0xa5bc92(0xbb));const _0x3ab12f=await _0x24529b['payment'][_0xa5bc92(0xdc)]({'where':{'id':_0x716cd7},'data':_0x31458a,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x14fb30!==0x0&&(await _0x24529b[_0xa5bc92(0x191)][_0xa5bc92(0xdc)]({'where':{'id':_0x300e8f['shopId']},'data':{'balance':_0x22945d}}),console[_0xa5bc92(0x13b)](_0xa5bc92(0x144)+_0x300e8f[_0xa5bc92(0x178)]+'\x20balance\x20updated:\x20'+_0x300e8f['shop'][_0xa5bc92(0x1af)][_0xa5bc92(0xe0)](0x6)+_0xa5bc92(0xf8)+_0x22945d[_0xa5bc92(0xe0)](0x6)+_0xa5bc92(0x15e)+(_0x14fb30>0x0?'+':'')+_0x14fb30[_0xa5bc92(0xe0)](0x6)+')')),_0x3ab12f;});return{'id':_0x3b1a63['id'],'shopId':_0x3b1a63[_0x48e61b(0x178)],'gateway':_0x3b1a63[_0x48e61b(0x168)],'amount':_0x3b1a63[_0x48e61b(0x1c9)],'currency':_0x3b1a63[_0x48e61b(0xea)],'status':_0x3b1a63[_0x48e61b(0xd9)],'orderId':_0x3b1a63[_0x48e61b(0xc0)],'gatewayOrderId':_0x3b1a63['gatewayOrderId'],'customerEmail':_0x3b1a63[_0x48e61b(0x167)],'customerName':_0x3b1a63['customerName'],'customerCountry':_0x3b1a63[_0x48e61b(0x193)],'customerIp':_0x3b1a63[_0x48e61b(0x18b)],'customerUa':_0x3b1a63[_0x48e61b(0xb4)],'failureMessage':_0x3b1a63[_0x48e61b(0x117)],'adminNotes':_0x3b1a63[_0x48e61b(0xd6)],'chargebackAmount':_0x3b1a63[_0x48e61b(0xa1)],'statusChangedBy':_0x3b1a63[_0x48e61b(0x129)],'statusChangedAt':_0x3b1a63[_0x48e61b(0x111)],'createdAt':_0x3b1a63['createdAt'],'updatedAt':_0x3b1a63[_0x48e61b(0x190)],'shop':_0x3b1a63['shop']};}async[a38_0xb47e75(0xa4)](_0x5a1142,_0x5086ac){const _0x78dbd8=a38_0xb47e75,_0x154de1=Math[_0x78dbd8(0xe8)]()[_0x78dbd8(0xfe)](0x24)[_0x78dbd8(0x146)](0x2,0x9);console[_0x78dbd8(0x13b)]('🎯\x20updateUser\x20called\x20with\x20ID:\x20'+_0x154de1+_0x78dbd8(0xb3)+_0x5a1142);const _0x2195c2={..._0x5086ac};_0x5086ac[_0x78dbd8(0x12d)]&&_0x5086ac[_0x78dbd8(0x12d)][_0x78dbd8(0x196)]()!==''?(console['log']('🔐\x20['+_0x154de1+_0x78dbd8(0x1be)+_0x5a1142),_0x2195c2[_0x78dbd8(0x12d)]=await bcryptjs_1[_0x78dbd8(0xa0)][_0x78dbd8(0x1b1)](_0x5086ac[_0x78dbd8(0x12d)],0xc)):(console[_0x78dbd8(0x13b)](_0x78dbd8(0x156)+_0x154de1+']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update'),delete _0x2195c2[_0x78dbd8(0x12d)]);_0x5086ac[_0x78dbd8(0x1b2)]&&(_0x2195c2[_0x78dbd8(0x1a8)]=_0x5086ac[_0x78dbd8(0x1b2)],delete _0x2195c2['fullName']);_0x5086ac[_0x78dbd8(0x122)]&&(_0x2195c2[_0x78dbd8(0x10e)]=_0x5086ac[_0x78dbd8(0x122)],delete _0x2195c2[_0x78dbd8(0x122)]);_0x5086ac[_0x78dbd8(0x18c)]&&(_0x2195c2[_0x78dbd8(0x1d9)]=_0x5086ac['merchantUrl'],delete _0x2195c2['merchantUrl']);if(_0x5086ac[_0x78dbd8(0x138)]){const _0x10c51a=_0x5086ac[_0x78dbd8(0x138)][_0x78dbd8(0x18f)](_0x5925ba=>this[_0x78dbd8(0xee)](_0x5925ba));console[_0x78dbd8(0x13b)](_0x78dbd8(0x195),_0x5086ac[_0x78dbd8(0x138)],'->',_0x10c51a),_0x2195c2[_0x78dbd8(0x13c)]=JSON[_0x78dbd8(0x1e9)](_0x10c51a),delete _0x2195c2['gateways'];}_0x5086ac[_0x78dbd8(0x194)]&&(console[_0x78dbd8(0x13b)](_0x78dbd8(0x137)+_0x154de1+_0x78dbd8(0x14a),_0x5086ac['gatewaySettings']),_0x2195c2[_0x78dbd8(0x194)]=JSON[_0x78dbd8(0x1e9)](_0x5086ac[_0x78dbd8(0x194)]),console[_0x78dbd8(0x13b)](_0x78dbd8(0x137)+_0x154de1+_0x78dbd8(0xeb),_0x2195c2[_0x78dbd8(0x194)]));_0x5086ac[_0x78dbd8(0x145)]&&(_0x5086ac[_0x78dbd8(0x145)][_0x78dbd8(0x11f)]!==undefined&&(_0x2195c2[_0x78dbd8(0x11f)]=_0x5086ac[_0x78dbd8(0x145)]['usdtPolygonWallet']||null),_0x5086ac['wallets'][_0x78dbd8(0x12e)]!==undefined&&(_0x2195c2['usdtTrcWallet']=_0x5086ac[_0x78dbd8(0x145)][_0x78dbd8(0x12e)]||null),_0x5086ac[_0x78dbd8(0x145)][_0x78dbd8(0xf7)]!==undefined&&(_0x2195c2[_0x78dbd8(0xf7)]=_0x5086ac[_0x78dbd8(0x145)]['usdtErcWallet']||null),_0x5086ac[_0x78dbd8(0x145)]['usdcPolygonWallet']!==undefined&&(_0x2195c2['usdcPolygonWallet']=_0x5086ac[_0x78dbd8(0x145)]['usdcPolygonWallet']||null),delete _0x2195c2[_0x78dbd8(0x145)]);const _0x1ca8a0=await database_1[_0x78dbd8(0xa0)][_0x78dbd8(0x191)]['update']({'where':{'id':_0x5a1142},'data':_0x2195c2,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console['log'](_0x78dbd8(0x16b)+_0x154de1+_0x78dbd8(0xbf),_0x1ca8a0['gatewaySettings']),{'id':_0x1ca8a0['id'],'fullName':_0x1ca8a0[_0x78dbd8(0x1a8)],'username':_0x1ca8a0[_0x78dbd8(0x1d7)],'telegramId':_0x1ca8a0['telegram'],'merchantUrl':_0x1ca8a0[_0x78dbd8(0x1d9)],'gateways':_0x1ca8a0[_0x78dbd8(0x13c)]?JSON['parse'](_0x1ca8a0['paymentGateways']):null,'gatewaySettings':_0x1ca8a0[_0x78dbd8(0x194)]?JSON['parse'](_0x1ca8a0[_0x78dbd8(0x194)]):null,'publicKey':_0x1ca8a0['publicKey'],'wallets':{'usdtPolygonWallet':_0x1ca8a0[_0x78dbd8(0x11f)],'usdtTrcWallet':_0x1ca8a0[_0x78dbd8(0x12e)],'usdtErcWallet':_0x1ca8a0[_0x78dbd8(0xf7)],'usdcPolygonWallet':_0x1ca8a0[_0x78dbd8(0xf0)]},'status':_0x1ca8a0[_0x78dbd8(0xd9)],'createdAt':_0x1ca8a0[_0x78dbd8(0x143)]};}async[a38_0xb47e75(0xde)](_0x12e2dc){const _0x583573=a38_0xb47e75,_0x5c6ebd=await database_1[_0x583573(0xa0)][_0x583573(0x191)][_0x583573(0xdc)]({'where':{'id':_0x12e2dc},'data':{'status':_0x583573(0x12c)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x5c6ebd['id'],'fullName':_0x5c6ebd[_0x583573(0x1a8)],'username':_0x5c6ebd['username'],'telegramId':_0x5c6ebd[_0x583573(0x10e)],'merchantUrl':_0x5c6ebd[_0x583573(0x1d9)],'gateways':_0x5c6ebd[_0x583573(0x13c)]?JSON[_0x583573(0x11e)](_0x5c6ebd[_0x583573(0x13c)]):null,'gatewaySettings':_0x5c6ebd[_0x583573(0x194)]?JSON['parse'](_0x5c6ebd['gatewaySettings']):null,'publicKey':_0x5c6ebd['publicKey'],'wallets':{'usdtPolygonWallet':_0x5c6ebd[_0x583573(0x11f)],'usdtTrcWallet':_0x5c6ebd[_0x583573(0x12e)],'usdtErcWallet':_0x5c6ebd[_0x583573(0xf7)],'usdcPolygonWallet':_0x5c6ebd['usdcPolygonWallet']},'status':_0x5c6ebd[_0x583573(0xd9)],'createdAt':_0x5c6ebd[_0x583573(0x143)]};}async[a38_0xb47e75(0x151)](_0x2279ef){const _0x108755=a38_0xb47e75,_0x147873=await database_1[_0x108755(0xa0)]['shop']['update']({'where':{'id':_0x2279ef},'data':{'status':_0x108755(0x12b)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x147873['id'],'fullName':_0x147873[_0x108755(0x1a8)],'username':_0x147873[_0x108755(0x1d7)],'telegramId':_0x147873[_0x108755(0x10e)],'merchantUrl':_0x147873[_0x108755(0x1d9)],'gateways':_0x147873[_0x108755(0x13c)]?JSON[_0x108755(0x11e)](_0x147873[_0x108755(0x13c)]):null,'gatewaySettings':_0x147873[_0x108755(0x194)]?JSON[_0x108755(0x11e)](_0x147873[_0x108755(0x194)]):null,'publicKey':_0x147873[_0x108755(0x171)],'wallets':{'usdtPolygonWallet':_0x147873[_0x108755(0x11f)],'usdtTrcWallet':_0x147873['usdtTrcWallet'],'usdtErcWallet':_0x147873[_0x108755(0xf7)],'usdcPolygonWallet':_0x147873[_0x108755(0xf0)]},'status':_0x147873[_0x108755(0xd9)],'createdAt':_0x147873[_0x108755(0x143)]};}async[a38_0xb47e75(0x175)](_0x3476bc){const _0x30cf66=a38_0xb47e75,{page:_0x584336,limit:_0x4336e7,status:_0x1591bc}=_0x3476bc,_0x443ad8=(_0x584336-0x1)*_0x4336e7,_0x4c06={};_0x1591bc&&(_0x4c06[_0x30cf66(0xd9)]=_0x1591bc['toUpperCase']());const [_0x582620,_0x19236f]=await Promise[_0x30cf66(0x121)]([database_1[_0x30cf66(0xa0)][_0x30cf66(0x191)][_0x30cf66(0x1b4)]({'where':_0x4c06,'skip':_0x443ad8,'take':_0x4336e7,'orderBy':{'createdAt':_0x30cf66(0x107)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1['default'][_0x30cf66(0x191)][_0x30cf66(0xf3)]({'where':_0x4c06})]);return{'users':_0x582620['map'](_0x30eb3d=>{const _0x5e123e=_0x30cf66,_0x452b32=_0x30eb3d[_0x5e123e(0x13c)]?JSON[_0x5e123e(0x11e)](_0x30eb3d[_0x5e123e(0x13c)]):null,_0x425614=_0x452b32?_0x452b32[_0x5e123e(0x18f)](_0xacc59a=>this[_0x5e123e(0x147)](_0xacc59a)):null;return{'id':_0x30eb3d['id'],'fullName':_0x30eb3d['name'],'username':_0x30eb3d[_0x5e123e(0x1d7)],'telegramId':_0x30eb3d[_0x5e123e(0x10e)],'merchantUrl':_0x30eb3d['shopUrl'],'gateways':_0x425614,'gatewaySettings':_0x30eb3d['gatewaySettings']?JSON[_0x5e123e(0x11e)](_0x30eb3d['gatewaySettings']):null,'publicKey':_0x30eb3d[_0x5e123e(0x171)],'wallets':{'usdtPolygonWallet':_0x30eb3d['usdtPolygonWallet'],'usdtTrcWallet':_0x30eb3d[_0x5e123e(0x12e)],'usdtErcWallet':_0x30eb3d[_0x5e123e(0xf7)],'usdcPolygonWallet':_0x30eb3d[_0x5e123e(0xf0)]},'status':_0x30eb3d[_0x5e123e(0xd9)],'createdAt':_0x30eb3d[_0x5e123e(0x143)]};}),'pagination':{'page':_0x584336,'limit':_0x4336e7,'total':_0x19236f,'totalPages':Math[_0x30cf66(0xa2)](_0x19236f/_0x4336e7)}};}async[a38_0xb47e75(0x189)](_0x4c4529){const _0x4780dd=a38_0xb47e75,_0x590a96=await database_1[_0x4780dd(0xa0)][_0x4780dd(0x191)][_0x4780dd(0x133)]({'where':{'id':_0x4c4529},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x590a96)return null;const _0x30e8de=_0x590a96[_0x4780dd(0x13c)]?JSON['parse'](_0x590a96[_0x4780dd(0x13c)]):null,_0x375a26=_0x30e8de?_0x30e8de['map'](_0x2fde85=>this[_0x4780dd(0x147)](_0x2fde85)):null;return _0x30e8de&&_0x375a26&&console[_0x4780dd(0x13b)](_0x4780dd(0x1b7),_0x30e8de,'->',_0x375a26),{'id':_0x590a96['id'],'fullName':_0x590a96[_0x4780dd(0x1a8)],'username':_0x590a96[_0x4780dd(0x1d7)],'telegramId':_0x590a96[_0x4780dd(0x10e)],'merchantUrl':_0x590a96['shopUrl'],'gateways':_0x375a26,'gatewaySettings':_0x590a96[_0x4780dd(0x194)]?JSON[_0x4780dd(0x11e)](_0x590a96['gatewaySettings']):null,'publicKey':_0x590a96[_0x4780dd(0x171)],'wallets':{'usdtPolygonWallet':_0x590a96[_0x4780dd(0x11f)],'usdtTrcWallet':_0x590a96[_0x4780dd(0x12e)],'usdtErcWallet':_0x590a96['usdtErcWallet'],'usdcPolygonWallet':_0x590a96[_0x4780dd(0xf0)]},'status':_0x590a96[_0x4780dd(0xd9)],'createdAt':_0x590a96[_0x4780dd(0x143)]};}async[a38_0xb47e75(0x1cd)](_0x55ab2c){const _0x34cb28=a38_0xb47e75,{fullName:_0x18fe3f,username:_0x4329a3,password:_0x39e9ad,telegramId:_0x278168,merchantUrl:_0x59b70a,gateways:_0x3e9e5d,gatewaySettings:_0x373ff9,wallets:_0x45dad9}=_0x55ab2c,_0x2a4616=await database_1[_0x34cb28(0xa0)][_0x34cb28(0x191)][_0x34cb28(0x133)]({'where':{'username':_0x4329a3}});if(_0x2a4616)throw new Error('Username\x20already\x20exists');if(_0x278168){const _0x3e29dc=await database_1[_0x34cb28(0xa0)][_0x34cb28(0x191)][_0x34cb28(0x133)]({'where':{'telegram':_0x278168}});if(_0x3e29dc)throw new Error(_0x34cb28(0x13e));}const _0x55675f=await bcryptjs_1[_0x34cb28(0xa0)][_0x34cb28(0x1b1)](_0x39e9ad,0xc),_0x449723=_0x34cb28(0xfc)+crypto_1[_0x34cb28(0xa0)][_0x34cb28(0xf4)](0x20)[_0x34cb28(0xfe)]('hex'),_0x5a65dc='sk_'+crypto_1[_0x34cb28(0xa0)][_0x34cb28(0xf4)](0x20)[_0x34cb28(0xfe)](_0x34cb28(0xdf)),_0x1416b8=_0x3e9e5d?_0x3e9e5d[_0x34cb28(0x18f)](_0x31eacc=>this[_0x34cb28(0xee)](_0x31eacc)):null;_0x3e9e5d&&_0x1416b8&&console[_0x34cb28(0x13b)](_0x34cb28(0x169),_0x3e9e5d,'->',_0x1416b8);const _0x413426=await database_1[_0x34cb28(0xa0)][_0x34cb28(0x191)][_0x34cb28(0x1c3)]({'data':{'name':_0x18fe3f,'username':_0x4329a3,'password':_0x55675f,'telegram':_0x278168,'shopUrl':_0x59b70a,'paymentGateways':_0x1416b8?JSON[_0x34cb28(0x1e9)](_0x1416b8):null,'gatewaySettings':_0x373ff9?JSON[_0x34cb28(0x1e9)](_0x373ff9):null,'usdtPolygonWallet':_0x45dad9?.[_0x34cb28(0x11f)]||null,'usdtTrcWallet':_0x45dad9?.[_0x34cb28(0x12e)]||null,'usdtErcWallet':_0x45dad9?.[_0x34cb28(0xf7)]||null,'usdcPolygonWallet':_0x45dad9?.['usdcPolygonWallet']||null,'publicKey':_0x449723,'secretKey':_0x5a65dc,'status':_0x34cb28(0x12b)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x413426['id'],'fullName':_0x413426['name'],'username':_0x413426[_0x34cb28(0x1d7)],'telegramId':_0x413426[_0x34cb28(0x10e)],'merchantUrl':_0x413426[_0x34cb28(0x1d9)],'gateways':_0x413426[_0x34cb28(0x13c)]?JSON[_0x34cb28(0x11e)](_0x413426[_0x34cb28(0x13c)]):null,'gatewaySettings':_0x413426[_0x34cb28(0x194)]?JSON['parse'](_0x413426['gatewaySettings']):null,'publicKey':_0x413426[_0x34cb28(0x171)],'wallets':{'usdtPolygonWallet':_0x413426[_0x34cb28(0x11f)],'usdtTrcWallet':_0x413426[_0x34cb28(0x12e)],'usdtErcWallet':_0x413426[_0x34cb28(0xf7)],'usdcPolygonWallet':_0x413426[_0x34cb28(0xf0)]},'status':_0x413426['status'],'createdAt':_0x413426[_0x34cb28(0x143)]};}async['deleteUser'](_0x41759c){const _0x26278b=a38_0xb47e75;await database_1[_0x26278b(0xa0)]['shop'][_0x26278b(0x1a5)]({'where':{'id':_0x41759c}});}[a38_0xb47e75(0x10f)](_0x54747a,_0x1c5d8f,_0x5c652b){const _0x77989c=a38_0xb47e75,_0x4fbed7=new Map(),_0x5cfafc=new Date(_0x1c5d8f);while(_0x5cfafc<=_0x5c652b){const _0x34f3a5=_0x5cfafc['toISOString']()[_0x77989c(0x1e5)]('T')[0x0];_0x4fbed7[_0x77989c(0x1ad)](_0x34f3a5,{'revenue':0x0,'count':0x0}),_0x5cfafc[_0x77989c(0x181)](_0x5cfafc[_0x77989c(0x187)]()+0x1);}for(const _0x32a877 of _0x54747a){const _0x2ca6e4=_0x32a877['createdAt'][_0x77989c(0x1da)]()['split']('T')[0x0],_0x53922d=_0x4fbed7[_0x77989c(0x197)](_0x2ca6e4);_0x53922d&&(_0x53922d['count']+=0x1,_0x32a877[_0x77989c(0xd9)]===_0x77989c(0x11c)&&(_0x32a877['amountUSDT']?_0x53922d[_0x77989c(0xca)]+=_0x32a877['amountUSDT']:console[_0x77989c(0x13b)]('⚠️\x20Payment\x20'+_0x32a877['id']+'\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion')));}const _0x3cedcb=[],_0x3a78c2=[];for(const [_0x14d25b,_0x2ad8ce]of _0x4fbed7){_0x3cedcb[_0x77989c(0x1e3)]({'date':_0x14d25b,'amount':Math['round'](_0x2ad8ce[_0x77989c(0xca)]*0x64)/0x64}),_0x3a78c2[_0x77989c(0x1e3)]({'date':_0x14d25b,'count':_0x2ad8ce[_0x77989c(0xf3)]});}return{'dailyRevenue':_0x3cedcb,'dailyPayments':_0x3a78c2};}}exports[a38_0xb47e75(0x10c)]=AdminService;