'use strict';function a33_0x5005(_0x2e20e7,_0x297e2b){const _0x4915e4=a33_0x4915();return a33_0x5005=function(_0x5005a6,_0x551373){_0x5005a6=_0x5005a6-0x163;let _0x9c813a=_0x4915e4[_0x5005a6];return _0x9c813a;},a33_0x5005(_0x2e20e7,_0x297e2b);}const a33_0x154fa1=a33_0x5005;(function(_0x428083,_0x5bbcf8){const _0x2b840f=a33_0x5005,_0x3ab8a2=_0x428083();while(!![]){try{const _0x5b9e20=-parseInt(_0x2b840f(0x1ce))/0x1+-parseInt(_0x2b840f(0x1ab))/0x2+-parseInt(_0x2b840f(0x1b5))/0x3*(-parseInt(_0x2b840f(0x198))/0x4)+-parseInt(_0x2b840f(0x177))/0x5+-parseInt(_0x2b840f(0x206))/0x6+parseInt(_0x2b840f(0x1a4))/0x7*(-parseInt(_0x2b840f(0x1fa))/0x8)+parseInt(_0x2b840f(0x195))/0x9;if(_0x5b9e20===_0x5bbcf8)break;else _0x3ab8a2['push'](_0x3ab8a2['shift']());}catch(_0x3eee31){_0x3ab8a2['push'](_0x3ab8a2['shift']());}}}(a33_0x4915,0x4c317));var __importDefault=this&&this[a33_0x154fa1(0x1c8)]||function(_0x3e096d){return _0x3e096d&&_0x3e096d['__esModule']?_0x3e096d:{'default':_0x3e096d};};Object[a33_0x154fa1(0x22c)](exports,a33_0x154fa1(0x1af),{'value':!![]}),exports[a33_0x154fa1(0x176)]=void 0x0;const database_1=__importDefault(require(a33_0x154fa1(0x200))),currencyService_1=require('./currencyService'),userService_1=require('./userService'),telegramBotService_1=require('./telegramBotService'),gateway_1=require(a33_0x154fa1(0x1e3));class AdminService{constructor(){const _0x44b69a=a33_0x154fa1;this[_0x44b69a(0x21e)]=new userService_1[(_0x44b69a(0x186))]();}[a33_0x154fa1(0x1fc)](_0x1cbcf9){const _0xf02545=a33_0x154fa1;switch(_0x1cbcf9){case'7d':return 0x7;case _0xf02545(0x1b0):return 0x1e;case _0xf02545(0x1cf):return 0x5a;case'1y':return 0x16d;default:return 0x1e;}}['generateDateRange'](_0x331042,_0x59b2a3){const _0x1e012f=a33_0x154fa1,_0x37c825=[],_0x730dff=new Date(_0x331042);while(_0x730dff<=_0x59b2a3){_0x37c825[_0x1e012f(0x232)](_0x730dff[_0x1e012f(0x181)]()[_0x1e012f(0x22b)]('T')[0x0]),_0x730dff['setDate'](_0x730dff[_0x1e012f(0x1a2)]()+0x1);}return _0x37c825;}[a33_0x154fa1(0x1a9)](_0x991823,_0x5bb584){const _0x5e1629=a33_0x154fa1;if(!_0x991823['gatewaySettings'])return{'commission':0x0,'payoutDelay':0x0};try{const _0x4f2761=JSON['parse'](_0x991823['gatewaySettings']),_0x2ed7c5=_0x5bb584[_0x5e1629(0x1c5)](0x0)[_0x5e1629(0x21d)]()+_0x5bb584[_0x5e1629(0x21c)](0x1)[_0x5e1629(0x1b7)]();if(_0x4f2761&&_0x4f2761[_0x2ed7c5])return{'commission':_0x4f2761[_0x2ed7c5][_0x5e1629(0x222)]||0x0,'payoutDelay':_0x4f2761[_0x2ed7c5][_0x5e1629(0x237)]||0x0};}catch(_0x1aaa28){console[_0x5e1629(0x163)](_0x5e1629(0x1ca),_0x1aaa28);}return{'commission':0x0,'payoutDelay':0x0};}['isEligibleForPayout'](_0x2236bb){const _0x2ed9b8=a33_0x154fa1;if(_0x2236bb['status']!==_0x2ed9b8(0x19e)||_0x2236bb[_0x2ed9b8(0x213)]||!_0x2236bb[_0x2ed9b8(0x1f0)])return![];const _0x53af7f=this[_0x2ed9b8(0x1a9)](_0x2236bb[_0x2ed9b8(0x182)],_0x2236bb[_0x2ed9b8(0x18c)]),_0x4ffc12=_0x53af7f[_0x2ed9b8(0x237)]*0x18*0x3c*0x3c*0x3e8,_0x229276=new Date(_0x2236bb[_0x2ed9b8(0x1f0)]['getTime']()+_0x4ffc12);return new Date()>_0x229276;}[a33_0x154fa1(0x208)](_0x197f00,_0x2f9d86){return _0x197f00*(0x1-_0x2f9d86/0x64);}[a33_0x154fa1(0x1b2)](_0xa96833){const _0x98e636=a33_0x154fa1;switch(_0xa96833[_0x98e636(0x203)]){case _0x98e636(0x19e):return _0xa96833[_0x98e636(0x1fb)];case _0x98e636(0x1d3):return-(_0xa96833[_0x98e636(0x1bb)]||0x0);case _0x98e636(0x193):return 0x0;default:return 0x0;}}async[a33_0x154fa1(0x1bc)](_0x4ce34c){const _0x47257c=a33_0x154fa1,{shopId:_0x3eb471,amount:_0x39502a,network:_0x232d41,notes:_0x46385c}=_0x4ce34c;console[_0x47257c(0x1f6)](_0x47257c(0x192)+_0x3eb471+':\x20'+_0x39502a+_0x47257c(0x178)+_0x232d41);const _0x5895ea=await database_1['default'][_0x47257c(0x182)][_0x47257c(0x1ea)]({'where':{'id':_0x3eb471},'select':{'id':!![],'name':!![],'username':!![],'status':!![]}});if(!_0x5895ea)throw new Error('Shop\x20not\x20found');if(_0x5895ea['status']!=='ACTIVE')throw new Error(_0x47257c(0x21b));const _0x49a60f=await database_1[_0x47257c(0x1db)]['payout'][_0x47257c(0x196)]({'data':{'shopId':_0x3eb471,'amount':_0x39502a,'network':_0x232d41,'status':_0x47257c(0x1d2),'notes':_0x46385c||null,'paidAt':new Date()},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});await this[_0x47257c(0x1e7)](_0x3eb471,_0x39502a);try{await telegramBotService_1['telegramBotService']['sendPayoutNotification'](_0x3eb471,_0x49a60f,_0x47257c(0x167));}catch(_0x49dca0){console[_0x47257c(0x163)]('Failed\x20to\x20send\x20Telegram\x20payout\x20notification:',_0x49dca0);}return console[_0x47257c(0x1f6)](_0x47257c(0x1e9)+_0x49a60f['id']),{'id':_0x49a60f['id'],'shopId':_0x49a60f[_0x47257c(0x1d4)],'shopName':_0x49a60f[_0x47257c(0x182)]['name'],'shopUsername':_0x49a60f['shop'][_0x47257c(0x225)],'amount':_0x49a60f[_0x47257c(0x1fb)],'network':_0x49a60f[_0x47257c(0x1c6)],'status':_0x49a60f[_0x47257c(0x203)],'txid':_0x49a60f[_0x47257c(0x179)],'notes':_0x49a60f[_0x47257c(0x1e1)],'createdAt':_0x49a60f[_0x47257c(0x1ed)],'paidAt':_0x49a60f[_0x47257c(0x1f0)]};}async[a33_0x154fa1(0x1e7)](_0x181d87,_0x3d2254){const _0x12ef3e=a33_0x154fa1;console['log'](_0x12ef3e(0x18b)+_0x181d87+_0x12ef3e(0x1d0)+_0x3d2254+_0x12ef3e(0x174));const _0x4c09a2=await database_1[_0x12ef3e(0x1db)]['payment'][_0x12ef3e(0x1de)]({'where':{'shopId':_0x181d87,'status':'PAID','merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'shop':{'select':{'gatewaySettings':!![]}}},'orderBy':{'paidAt':_0x12ef3e(0x17d)}});let _0x35bc35=_0x3d2254;const _0x29f9e3=[];for(const _0x866626 of _0x4c09a2){const _0x1b7474={..._0x866626,'status':_0x12ef3e(0x19e),'merchantPaid':![],'shop':{'gatewaySettings':_0x866626[_0x12ef3e(0x182)][_0x12ef3e(0x210)]}};if(!this[_0x12ef3e(0x1c4)](_0x1b7474))continue;const _0x11fb0e=await currencyService_1[_0x12ef3e(0x1a6)]['convertToUSDT'](_0x866626[_0x12ef3e(0x1fb)],_0x866626[_0x12ef3e(0x173)]),_0x37c642=this[_0x12ef3e(0x1a9)](_0x866626[_0x12ef3e(0x182)],_0x866626[_0x12ef3e(0x18c)]),_0x3e4f64=this[_0x12ef3e(0x208)](_0x11fb0e,_0x37c642[_0x12ef3e(0x222)]);if(_0x3e4f64<=_0x35bc35){_0x29f9e3[_0x12ef3e(0x232)](_0x866626['id']),_0x35bc35-=_0x3e4f64;if(_0x35bc35<=0.01)break;}}_0x29f9e3['length']>0x0&&(await database_1[_0x12ef3e(0x1db)][_0x12ef3e(0x16e)][_0x12ef3e(0x19a)]({'where':{'id':{'in':_0x29f9e3}},'data':{'merchantPaid':!![]}}),console[_0x12ef3e(0x1f6)]('✅\x20Marked\x20'+_0x29f9e3['length']+_0x12ef3e(0x1f9)));}async[a33_0x154fa1(0x214)](_0x575061){const _0x1493d5=a33_0x154fa1,{page:_0x3d552f,limit:_0x36d9c0,shopId:_0x5640b2,network:_0x2f60f9,dateFrom:_0x432d7f,dateTo:_0x570eb7,search:_0x550302}=_0x575061,_0x34f6a4=(_0x3d552f-0x1)*_0x36d9c0;console[_0x1493d5(0x1f6)]('📋\x20Getting\x20payouts\x20with\x20filters:',_0x575061);const _0x46b994={};_0x5640b2&&(_0x46b994[_0x1493d5(0x1d4)]=_0x5640b2);_0x2f60f9&&(_0x46b994[_0x1493d5(0x1c6)]=_0x2f60f9);(_0x432d7f||_0x570eb7)&&(_0x46b994[_0x1493d5(0x1ed)]={},_0x432d7f&&(_0x46b994['createdAt'][_0x1493d5(0x1cd)]=new Date(_0x432d7f)),_0x570eb7&&(_0x46b994[_0x1493d5(0x1ed)][_0x1493d5(0x22a)]=new Date(_0x570eb7)));_0x550302&&(_0x46b994['OR']=[{'txid':{'contains':_0x550302,'mode':_0x1493d5(0x189)}},{'notes':{'contains':_0x550302,'mode':_0x1493d5(0x189)}},{'shop':{'name':{'contains':_0x550302,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x550302,'mode':_0x1493d5(0x189)}}}]);const [_0x462d70,_0x4116fd]=await Promise[_0x1493d5(0x1ef)]([database_1[_0x1493d5(0x1db)][_0x1493d5(0x1d8)][_0x1493d5(0x1de)]({'where':_0x46b994,'skip':_0x34f6a4,'take':_0x36d9c0,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x1493d5(0x1db)][_0x1493d5(0x1d8)][_0x1493d5(0x21a)]({'where':_0x46b994})]);console['log'](_0x1493d5(0x219)+_0x462d70[_0x1493d5(0x1fe)]+_0x1493d5(0x1b6)+_0x4116fd+_0x1493d5(0x231));const _0x28089d=_0x462d70[_0x1493d5(0x1aa)](_0x2223be=>({'id':_0x2223be['id'],'shopId':_0x2223be[_0x1493d5(0x1d4)],'shopName':_0x2223be['shop']['name'],'shopUsername':_0x2223be[_0x1493d5(0x182)][_0x1493d5(0x225)],'amount':_0x2223be[_0x1493d5(0x1fb)],'network':_0x2223be['network'],'status':_0x2223be['status'],'txid':_0x2223be[_0x1493d5(0x179)],'notes':_0x2223be['notes'],'createdAt':_0x2223be[_0x1493d5(0x1ed)],'paidAt':_0x2223be[_0x1493d5(0x1f0)]}));return{'payouts':_0x28089d,'pagination':{'page':_0x3d552f,'limit':_0x36d9c0,'total':_0x4116fd,'totalPages':Math[_0x1493d5(0x1a5)](_0x4116fd/_0x36d9c0)}};}async['getPayoutById'](_0x246cce){const _0x1ed72f=a33_0x154fa1;console['log'](_0x1ed72f(0x16a)+_0x246cce);const _0x5ca353=await database_1[_0x1ed72f(0x1db)][_0x1ed72f(0x1d8)]['findUnique']({'where':{'id':_0x246cce},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x5ca353)return console[_0x1ed72f(0x1f6)](_0x1ed72f(0x185)+_0x246cce),null;return console['log'](_0x1ed72f(0x215)+_0x5ca353[_0x1ed72f(0x1fb)]+_0x1ed72f(0x178)+_0x5ca353[_0x1ed72f(0x1c6)]),{'id':_0x5ca353['id'],'shopId':_0x5ca353[_0x1ed72f(0x1d4)],'shopName':_0x5ca353[_0x1ed72f(0x182)][_0x1ed72f(0x1bf)],'shopUsername':_0x5ca353[_0x1ed72f(0x182)][_0x1ed72f(0x225)],'amount':_0x5ca353[_0x1ed72f(0x1fb)],'network':_0x5ca353[_0x1ed72f(0x1c6)],'status':_0x5ca353['status'],'txid':_0x5ca353[_0x1ed72f(0x179)],'notes':_0x5ca353[_0x1ed72f(0x1e1)],'createdAt':_0x5ca353[_0x1ed72f(0x1ed)],'paidAt':_0x5ca353[_0x1ed72f(0x1f0)]};}async[a33_0x154fa1(0x180)](_0x1371ad){const _0x539285=a33_0x154fa1;console[_0x539285(0x1f6)](_0x539285(0x169)+_0x1371ad);const _0x1452e0=await database_1[_0x539285(0x1db)][_0x539285(0x1d8)][_0x539285(0x1ea)]({'where':{'id':_0x1371ad},'select':{'id':!![],'shopId':!![],'amount':!![]}});if(!_0x1452e0)throw new Error(_0x539285(0x1d1));await database_1[_0x539285(0x1db)][_0x539285(0x1d8)][_0x539285(0x212)]({'where':{'id':_0x1371ad}}),console[_0x539285(0x1f6)]('✅\x20Payout\x20'+_0x1371ad+_0x539285(0x22f));}async[a33_0x154fa1(0x16d)](_0x5b89ac){const _0x8d9030=a33_0x154fa1,{page:_0x5444cd,limit:_0x432c02,minAmount:_0x107fc0,search:_0x392d30}=_0x5b89ac;console[_0x8d9030(0x1f6)]('📋\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:',_0x5b89ac);const _0x1379dc=await database_1[_0x8d9030(0x1db)][_0x8d9030(0x16e)][_0x8d9030(0x1de)]({'where':{'status':_0x8d9030(0x19e),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'createdAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'gatewaySettings':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}});console[_0x8d9030(0x1f6)](_0x8d9030(0x1f8)+_0x1379dc[_0x8d9030(0x1fe)]+_0x8d9030(0x16c));const _0x37c04a=new Map();for(const _0x17404d of _0x1379dc){const _0x5e5126={..._0x17404d,'status':_0x8d9030(0x19e),'merchantPaid':![],'shop':{'gatewaySettings':_0x17404d[_0x8d9030(0x182)][_0x8d9030(0x210)]}},_0x56c744=this['isEligibleForPayout'](_0x5e5126);if(!_0x56c744)continue;const _0x25a086=await currencyService_1[_0x8d9030(0x1a6)][_0x8d9030(0x1ac)](_0x17404d[_0x8d9030(0x1fb)],_0x17404d[_0x8d9030(0x173)]),_0x590a78=this[_0x8d9030(0x1a9)](_0x17404d[_0x8d9030(0x182)],_0x17404d[_0x8d9030(0x18c)]),_0x516503=this[_0x8d9030(0x208)](_0x25a086,_0x590a78[_0x8d9030(0x222)]),_0x15f4fc=_0x17404d['shopId'];!_0x37c04a[_0x8d9030(0x1e0)](_0x15f4fc)&&_0x37c04a[_0x8d9030(0x1dd)](_0x15f4fc,{'shop':_0x17404d[_0x8d9030(0x182)],'payments':[]}),_0x37c04a[_0x8d9030(0x1e8)](_0x15f4fc)[_0x8d9030(0x19c)][_0x8d9030(0x232)]({'id':_0x17404d['id'],'amount':_0x17404d['amount'],'currency':_0x17404d[_0x8d9030(0x173)],'gateway':_0x17404d[_0x8d9030(0x18c)],'paidAt':_0x17404d[_0x8d9030(0x1f0)],'createdAt':_0x17404d[_0x8d9030(0x1ed)],'amountUSDT':_0x25a086,'commission':_0x590a78['commission'],'amountAfterCommissionUSDT':_0x516503,'isEligible':!![]});}console[_0x8d9030(0x1f6)]('🏪\x20Found\x20'+_0x37c04a[_0x8d9030(0x165)]+_0x8d9030(0x22e));const _0x2d1f33=[];for(const [_0x1ad1a3,_0x58faa4]of _0x37c04a){const {shop:_0xd14b25,payments:_0x498110}=_0x58faa4,_0x4919da=_0x498110[_0x8d9030(0x202)]((_0x38fcbd,_0x361e68)=>_0x38fcbd+_0x361e68[_0x8d9030(0x1c0)],0x0),_0x13ec53=_0x498110['reduce']((_0x2c1923,_0x4a1fab)=>_0x2c1923+_0x4a1fab['amountAfterCommissionUSDT'],0x0);if(_0x107fc0&&_0x13ec53<_0x107fc0)continue;if(_0x392d30){const _0x5a3533=_0x392d30['toLowerCase'](),_0x5a21c1=_0xd14b25['name'][_0x8d9030(0x1b7)]()[_0x8d9030(0x1eb)](_0x5a3533)||_0xd14b25[_0x8d9030(0x225)][_0x8d9030(0x1b7)]()['includes'](_0x5a3533)||_0xd14b25['telegram']&&_0xd14b25[_0x8d9030(0x188)][_0x8d9030(0x1b7)]()[_0x8d9030(0x1eb)](_0x5a3533);if(!_0x5a21c1)continue;}const _0x5f0c5d=new Map();for(const _0x8042e8 of _0x498110){const _0x3ca36a=_0x8042e8[_0x8d9030(0x18c)];!_0x5f0c5d[_0x8d9030(0x1e0)](_0x3ca36a)&&_0x5f0c5d[_0x8d9030(0x1dd)](_0x3ca36a,{'count':0x0,'amountUSDT':0x0,'amountAfterCommissionUSDT':0x0,'commission':_0x8042e8[_0x8d9030(0x222)]});const _0x30f2de=_0x5f0c5d[_0x8d9030(0x1e8)](_0x3ca36a);_0x30f2de[_0x8d9030(0x21a)]++,_0x30f2de[_0x8d9030(0x1c0)]+=_0x8042e8[_0x8d9030(0x1c0)],_0x30f2de[_0x8d9030(0x17b)]+=_0x8042e8['amountAfterCommissionUSDT'];}const _0xab8dda=Array[_0x8d9030(0x1e6)](_0x5f0c5d[_0x8d9030(0x1ff)]())[_0x8d9030(0x1aa)](([_0x3e35e0,_0x217a94])=>({'gateway':_0x3e35e0[_0x8d9030(0x1c5)](0x0)[_0x8d9030(0x21d)]()+_0x3e35e0[_0x8d9030(0x21c)](0x1),'count':_0x217a94[_0x8d9030(0x21a)],'amountUSDT':Math[_0x8d9030(0x170)](_0x217a94[_0x8d9030(0x1c0)]*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x8d9030(0x170)](_0x217a94[_0x8d9030(0x17b)]*0x64)/0x64,'commission':_0x217a94[_0x8d9030(0x222)]})),_0x5197a2=_0x498110['reduce']((_0x64f96d,_0x3523ef)=>{const _0x3e6e3f=_0x8d9030;return _0x3523ef[_0x3e6e3f(0x1f0)]<_0x64f96d?_0x3523ef[_0x3e6e3f(0x1f0)]:_0x64f96d;},_0x498110[0x0][_0x8d9030(0x1f0)]);_0x2d1f33[_0x8d9030(0x232)]({'id':_0xd14b25['id'],'fullName':_0xd14b25[_0x8d9030(0x1bf)],'username':_0xd14b25[_0x8d9030(0x225)],'telegramId':_0xd14b25[_0x8d9030(0x188)],'merchantUrl':_0xd14b25['shopUrl'],'wallets':{'usdtPolygonWallet':_0xd14b25['usdtPolygonWallet'],'usdtTrcWallet':_0xd14b25[_0x8d9030(0x224)],'usdtErcWallet':_0xd14b25[_0x8d9030(0x171)],'usdcPolygonWallet':_0xd14b25[_0x8d9030(0x22d)]},'totalAmountUSDT':Math[_0x8d9030(0x170)](_0x4919da*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x8d9030(0x170)](_0x13ec53*0x64)/0x64,'paymentsCount':_0x498110[_0x8d9030(0x1fe)],'oldestPaymentDate':_0x5197a2,'gatewayBreakdown':_0xab8dda});}_0x2d1f33['sort']((_0x446d28,_0x787ea2)=>_0x787ea2[_0x8d9030(0x1b3)]-_0x446d28[_0x8d9030(0x1b3)]);const _0x4735d8=_0x2d1f33[_0x8d9030(0x1fe)],_0x2db443=_0x2d1f33[_0x8d9030(0x202)]((_0x12ce4e,_0x25e741)=>_0x12ce4e+_0x25e741[_0x8d9030(0x18e)],0x0),_0x5bd492=_0x2d1f33['reduce']((_0x54a2f2,_0x57e542)=>_0x54a2f2+_0x57e542['totalAmountAfterCommissionUSDT'],0x0),_0x2bcf05=(_0x5444cd-0x1)*_0x432c02,_0x59d5c6=_0x2d1f33[_0x8d9030(0x21c)](_0x2bcf05,_0x2bcf05+_0x432c02);return console['log']('✅\x20Returning\x20'+_0x59d5c6[_0x8d9030(0x1fe)]+_0x8d9030(0x1a3)+_0x4735d8+_0x8d9030(0x231)),console[_0x8d9030(0x1f6)](_0x8d9030(0x1f3)+_0x2db443[_0x8d9030(0x1c7)](0x2)+_0x8d9030(0x1df)+_0x5bd492['toFixed'](0x2)+'\x20USDT\x20after\x20commission)'),{'merchants':_0x59d5c6,'pagination':{'page':_0x5444cd,'limit':_0x432c02,'total':_0x4735d8,'totalPages':Math[_0x8d9030(0x1a5)](_0x4735d8/_0x432c02)},'summary':{'totalMerchants':_0x4735d8,'totalAmountUSDT':Math['round'](_0x2db443*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x8d9030(0x170)](_0x5bd492*0x64)/0x64}};}async[a33_0x154fa1(0x211)](){const _0x5be5d6=a33_0x154fa1;console['log'](_0x5be5d6(0x184));const _0x13ed27=await database_1[_0x5be5d6(0x1db)]['payment']['findMany']({'where':{'status':{'in':[_0x5be5d6(0x19e),_0x5be5d6(0x193),_0x5be5d6(0x1d3)]}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'status':!![],'gateway':!![],'paidAt':!![],'merchantPaid':!![],'createdAt':!![],'chargebackAmount':!![],'shop':{'select':{'gatewaySettings':!![]}}}});console[_0x5be5d6(0x1f6)]('💰\x20Found\x20'+_0x13ed27[_0x5be5d6(0x1fe)]+_0x5be5d6(0x1c9));const _0x42bb27=new Date(),_0x205ceb=new Date(_0x42bb27['getFullYear'](),_0x42bb27[_0x5be5d6(0x207)](),0x1),_0x47b5da=new Date(_0x42bb27[_0x5be5d6(0x1be)](),_0x42bb27[_0x5be5d6(0x207)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7);let _0x1df740=0x0,_0x47a160=0x0,_0xe5d542=0x0,_0x1b90f8=0x0;for(const _0x5343e7 of _0x13ed27){const _0x4ad225=this[_0x5be5d6(0x1b2)](_0x5343e7);if(_0x4ad225===0x0)continue;let _0x1ba516,_0x1a2845;if(_0x5343e7[_0x5be5d6(0x203)]===_0x5be5d6(0x1d3))_0x1ba516=Math['abs'](_0x4ad225),_0x1a2845=-_0x1ba516;else{_0x1ba516=await currencyService_1['currencyService'][_0x5be5d6(0x1ac)](_0x5343e7[_0x5be5d6(0x1fb)],_0x5343e7[_0x5be5d6(0x173)]);const _0x478472=this[_0x5be5d6(0x1a9)](_0x5343e7[_0x5be5d6(0x182)],_0x5343e7[_0x5be5d6(0x18c)]);_0x1a2845=this[_0x5be5d6(0x208)](_0x1ba516,_0x478472[_0x5be5d6(0x222)]);}_0x5343e7[_0x5be5d6(0x213)]&&(_0x1df740+=_0x1a2845,_0x5343e7[_0x5be5d6(0x1f0)]&&_0x5343e7[_0x5be5d6(0x1f0)]>=_0x205ceb&&_0x5343e7[_0x5be5d6(0x1f0)]<=_0x47b5da&&(_0xe5d542+=_0x1a2845)),_0x5343e7[_0x5be5d6(0x203)]===_0x5be5d6(0x19e)&&this[_0x5be5d6(0x1c4)](_0x5343e7)&&(_0x47a160+=_0x1a2845,_0x1b90f8+=_0x1ba516);}const _0x5e9fc4={'totalPayout':Math[_0x5be5d6(0x170)](_0x1df740*0x64)/0x64,'awaitingPayout':Math[_0x5be5d6(0x170)](_0x47a160*0x64)/0x64,'thisMonth':Math[_0x5be5d6(0x170)](_0xe5d542*0x64)/0x64,'availableBalance':Math[_0x5be5d6(0x170)](_0x1b90f8*0x64)/0x64};return console[_0x5be5d6(0x1f6)](_0x5be5d6(0x19b)),console[_0x5be5d6(0x1f6)]('💸\x20Total\x20Payout:\x20'+_0x5e9fc4[_0x5be5d6(0x1a0)]+_0x5be5d6(0x1e4)),console[_0x5be5d6(0x1f6)](_0x5be5d6(0x205)+_0x5e9fc4[_0x5be5d6(0x16b)]+_0x5be5d6(0x175)),console['log'](_0x5be5d6(0x1b4)+_0x5e9fc4['thisMonth']+_0x5be5d6(0x174)),console[_0x5be5d6(0x1f6)](_0x5be5d6(0x17e)+_0x5e9fc4[_0x5be5d6(0x183)]+_0x5be5d6(0x174)),_0x5e9fc4;}async[a33_0x154fa1(0x1d7)](_0xf6a18b){const _0x207a3e=a33_0x154fa1,_0x1460a3=this[_0x207a3e(0x1fc)](_0xf6a18b),_0x598bad=new Date();_0x598bad[_0x207a3e(0x1ee)](_0x598bad[_0x207a3e(0x1a2)]()-_0x1460a3),console[_0x207a3e(0x1f6)](_0x207a3e(0x20c)+_0xf6a18b+'\x20('+_0x1460a3+_0x207a3e(0x20b));const _0x261bd4=await database_1[_0x207a3e(0x1db)][_0x207a3e(0x182)][_0x207a3e(0x21a)]({'where':{'status':_0x207a3e(0x166)}}),_0xc28162=await database_1['default'][_0x207a3e(0x16e)]['count'](),_0x1a3ce8=await database_1[_0x207a3e(0x1db)][_0x207a3e(0x16e)][_0x207a3e(0x1de)]({'where':{'status':{'in':[_0x207a3e(0x19e),_0x207a3e(0x193),_0x207a3e(0x1d3)]}},'select':{'amount':!![],'currency':!![],'status':!![],'chargebackAmount':!![],'createdAt':!![]}});console[_0x207a3e(0x1f6)](_0x207a3e(0x1f8)+_0x1a3ce8[_0x207a3e(0x1fe)]+_0x207a3e(0x1f7));const _0x5f1092=await Promise[_0x207a3e(0x1ef)](_0x1a3ce8['map'](async _0x426b51=>{const _0x1e3836=_0x207a3e,_0x39da99=this[_0x1e3836(0x1b2)](_0x426b51);if(_0x39da99===0x0)return{'amount':0x0,'createdAt':_0x426b51[_0x1e3836(0x1ed)]};let _0x541ad9;return _0x426b51[_0x1e3836(0x203)]==='CHARGEBACK'?_0x541ad9=-Math[_0x1e3836(0x17f)](_0x39da99):_0x541ad9=await currencyService_1[_0x1e3836(0x1a6)][_0x1e3836(0x1ac)](_0x426b51[_0x1e3836(0x1fb)],_0x426b51[_0x1e3836(0x173)]),{'amount':_0x541ad9,'createdAt':_0x426b51[_0x1e3836(0x1ed)]};})),_0x28d8e2=_0x5f1092[_0x207a3e(0x202)]((_0x36ac13,_0x476c0d)=>_0x36ac13+_0x476c0d['amount'],0x0),_0x1eeead=_0xc28162>0x0?_0x28d8e2/_0xc28162:0x0;console['log']('💵\x20Total\x20revenue:\x20'+_0x28d8e2[_0x207a3e(0x1c7)](0x2)+'\x20USDT\x20(включая\x20штрафы\x20chargeback)'),console['log']('📈\x20Average\x20payment:\x20'+_0x1eeead[_0x207a3e(0x1c7)](0x2)+_0x207a3e(0x174));const _0x255bb1=await database_1[_0x207a3e(0x1db)]['$queryRaw']`
      SELECT 
        DATE(created_at) as date,
        array_agg(
          json_build_object(
            'amount', amount,
            'currency', currency,
            'status', status,
            'chargeback_amount', chargeback_amount
          )
        ) as payments
      FROM payments 
      WHERE created_at >= ${_0x598bad}
        AND status IN ('PAID', 'REFUND', 'CHARGEBACK')
      GROUP BY DATE(created_at)
      ORDER BY date ASC
    `;console['log'](_0x207a3e(0x1c2)+_0x255bb1['length']+'\x20days');const _0x296e41=await Promise[_0x207a3e(0x1ef)](_0x255bb1[_0x207a3e(0x1aa)](async _0x4e564e=>{const _0x2e6eb1=_0x207a3e,_0x1a0b19=await Promise[_0x2e6eb1(0x1ef)](_0x4e564e[_0x2e6eb1(0x19c)]['map'](async _0x325807=>{const _0x156941=_0x2e6eb1,_0x81446=this[_0x156941(0x1b2)](_0x325807);if(_0x81446===0x0)return 0x0;return _0x325807[_0x156941(0x203)]===_0x156941(0x1d3)?-Math[_0x156941(0x17f)](_0x81446):await currencyService_1[_0x156941(0x1a6)][_0x156941(0x1ac)](_0x325807['amount'],_0x325807[_0x156941(0x173)]);})),_0x59cbf7=_0x1a0b19['reduce']((_0x281234,_0x40e0ea)=>_0x281234+_0x40e0ea,0x0);return{'date':_0x4e564e[_0x2e6eb1(0x1b1)][_0x2e6eb1(0x181)]()[_0x2e6eb1(0x22b)]('T')[0x0],'amount':_0x59cbf7};})),_0x10d277=this['generateDateRange'](_0x598bad,new Date()),_0x2ec581=new Map(_0x296e41[_0x207a3e(0x1aa)](_0x3b7596=>[_0x3b7596[_0x207a3e(0x1b1)],_0x3b7596[_0x207a3e(0x1fb)]])),_0x352764=_0x10d277['map'](_0x4128e8=>({'date':_0x4128e8,'amount':_0x2ec581[_0x207a3e(0x1e8)](_0x4128e8)||0x0}));return console[_0x207a3e(0x1f6)](_0x207a3e(0x223)),console['log']('👥\x20Total\x20users:\x20'+_0x261bd4),console[_0x207a3e(0x1f6)](_0x207a3e(0x17a)+_0xc28162),console[_0x207a3e(0x1f6)](_0x207a3e(0x1b8)+_0x352764[_0x207a3e(0x1fe)]),{'totalRevenue':Math[_0x207a3e(0x170)](_0x28d8e2*0x64)/0x64,'totalUsers':_0x261bd4,'totalPayments':_0xc28162,'averagePayment':Math['round'](_0x1eeead*0x64)/0x64,'dailyRevenue':_0x352764};}async['getAllPayments'](_0x444404){const _0x2e735d=a33_0x154fa1,{page:_0x1e4b7f,limit:_0x4c74e3,status:_0x283994,gateway:_0x235e17,shopId:_0x397aba,dateFrom:_0xc9ac3,dateTo:_0x5c7bd2,search:_0x1c219a}=_0x444404,_0x3905a5=(_0x1e4b7f-0x1)*_0x4c74e3;console['log'](_0x2e735d(0x194),_0x444404);const _0x35a251={};_0x283994&&(_0x35a251[_0x2e735d(0x203)]=_0x283994['toUpperCase']());if(_0x235e17){if((0x0,gateway_1['isValidGatewayId'])(_0x235e17)){const _0x416678=(0x0,gateway_1[_0x2e735d(0x226)])(_0x235e17);_0x416678&&(_0x35a251[_0x2e735d(0x18c)]=_0x416678);}else _0x35a251[_0x2e735d(0x18c)]=_0x235e17['toLowerCase']();}_0x397aba&&(_0x35a251[_0x2e735d(0x1d4)]=_0x397aba);(_0xc9ac3||_0x5c7bd2)&&(_0x35a251[_0x2e735d(0x1ed)]={},_0xc9ac3&&(_0x35a251[_0x2e735d(0x1ed)][_0x2e735d(0x1cd)]=new Date(_0xc9ac3)),_0x5c7bd2&&(_0x35a251[_0x2e735d(0x1ed)][_0x2e735d(0x22a)]=new Date(_0x5c7bd2)));_0x1c219a&&(_0x35a251['OR']=[{'orderId':{'contains':_0x1c219a,'mode':'insensitive'}},{'gatewayOrderId':{'contains':_0x1c219a,'mode':_0x2e735d(0x189)}},{'gatewayPaymentId':{'contains':_0x1c219a,'mode':_0x2e735d(0x189)}},{'customerEmail':{'contains':_0x1c219a,'mode':_0x2e735d(0x189)}},{'customerName':{'contains':_0x1c219a,'mode':'insensitive'}},{'shop':{'name':{'contains':_0x1c219a,'mode':_0x2e735d(0x189)}}},{'shop':{'username':{'contains':_0x1c219a,'mode':_0x2e735d(0x189)}}}]);const [_0x184cae,_0x2daee7]=await Promise[_0x2e735d(0x1ef)]([database_1['default']['payment'][_0x2e735d(0x1de)]({'where':_0x35a251,'skip':_0x3905a5,'take':_0x4c74e3,'orderBy':{'createdAt':_0x2e735d(0x1cc)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x2e735d(0x1db)]['payment'][_0x2e735d(0x21a)]({'where':_0x35a251})]);console[_0x2e735d(0x1f6)](_0x2e735d(0x219)+_0x184cae[_0x2e735d(0x1fe)]+_0x2e735d(0x20a)+_0x2daee7+'\x20total');const _0x4fa779=_0x184cae['map'](_0x2df791=>({'id':_0x2df791['id'],'shopId':_0x2df791['shopId'],'shopName':_0x2df791[_0x2e735d(0x182)][_0x2e735d(0x1bf)],'shopUsername':_0x2df791[_0x2e735d(0x182)][_0x2e735d(0x225)],'gateway':_0x2df791[_0x2e735d(0x18c)],'orderId':_0x2df791[_0x2e735d(0x1a1)],'gatewayOrderId':_0x2df791['gatewayOrderId'],'amount':_0x2df791[_0x2e735d(0x1fb)],'currency':_0x2df791['currency'],'sourceCurrency':_0x2df791[_0x2e735d(0x18a)],'status':_0x2df791[_0x2e735d(0x203)],'usage':_0x2df791[_0x2e735d(0x197)],'externalPaymentUrl':_0x2df791[_0x2e735d(0x1bd)],'gatewayPaymentId':_0x2df791[_0x2e735d(0x228)],'customerEmail':_0x2df791[_0x2e735d(0x234)],'customerName':_0x2df791['customerName'],'cardLast4':_0x2df791[_0x2e735d(0x1c1)],'paymentMethod':_0x2df791[_0x2e735d(0x1ba)],'bankId':_0x2df791['bankId'],'remitterIban':_0x2df791[_0x2e735d(0x1cb)],'remitterName':_0x2df791[_0x2e735d(0x20d)],'chargebackAmount':_0x2df791[_0x2e735d(0x1bb)],'adminNotes':_0x2df791['adminNotes'],'statusChangedBy':_0x2df791['statusChangedBy'],'statusChangedAt':_0x2df791[_0x2e735d(0x221)],'createdAt':_0x2df791['createdAt'],'updatedAt':_0x2df791[_0x2e735d(0x19d)],'expiresAt':_0x2df791['expiresAt']}));return{'payments':_0x4fa779,'pagination':{'page':_0x1e4b7f,'limit':_0x4c74e3,'total':_0x2daee7,'totalPages':Math[_0x2e735d(0x1a5)](_0x2daee7/_0x4c74e3)}};}async[a33_0x154fa1(0x1d6)](_0x6145fe){const _0x276f71=a33_0x154fa1;console[_0x276f71(0x1f6)](_0x276f71(0x1f4)+_0x6145fe);const _0x5d7e44=await database_1[_0x276f71(0x1db)][_0x276f71(0x16e)][_0x276f71(0x1ea)]({'where':{'id':_0x6145fe},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}},'webhookLogs':{'orderBy':{'createdAt':'desc'},'take':0xa,'select':{'id':!![],'event':!![],'statusCode':!![],'retryCount':!![],'createdAt':!![]}}}});if(!_0x5d7e44)return console[_0x276f71(0x1f6)](_0x276f71(0x227)+_0x6145fe),null;return console[_0x276f71(0x1f6)]('✅\x20Found\x20payment:\x20'+_0x5d7e44[_0x276f71(0x1a1)]+'\x20('+_0x5d7e44[_0x276f71(0x203)]+')'),{'id':_0x5d7e44['id'],'shopId':_0x5d7e44['shopId'],'shopName':_0x5d7e44[_0x276f71(0x182)][_0x276f71(0x1bf)],'shopUsername':_0x5d7e44[_0x276f71(0x182)][_0x276f71(0x225)],'gateway':_0x5d7e44['gateway'],'orderId':_0x5d7e44['orderId'],'gatewayOrderId':_0x5d7e44[_0x276f71(0x1da)],'amount':_0x5d7e44['amount'],'currency':_0x5d7e44['currency'],'sourceCurrency':_0x5d7e44[_0x276f71(0x18a)],'status':_0x5d7e44[_0x276f71(0x203)],'usage':_0x5d7e44['usage'],'externalPaymentUrl':_0x5d7e44[_0x276f71(0x1bd)],'gatewayPaymentId':_0x5d7e44[_0x276f71(0x228)],'customerEmail':_0x5d7e44[_0x276f71(0x234)],'customerName':_0x5d7e44[_0x276f71(0x1ad)],'cardLast4':_0x5d7e44[_0x276f71(0x1c1)],'paymentMethod':_0x5d7e44['paymentMethod'],'bankId':_0x5d7e44['bankId'],'remitterIban':_0x5d7e44[_0x276f71(0x1cb)],'remitterName':_0x5d7e44[_0x276f71(0x20d)],'chargebackAmount':_0x5d7e44[_0x276f71(0x1bb)],'adminNotes':_0x5d7e44[_0x276f71(0x191)],'statusChangedBy':_0x5d7e44['statusChangedBy'],'statusChangedAt':_0x5d7e44[_0x276f71(0x221)],'createdAt':_0x5d7e44['createdAt'],'updatedAt':_0x5d7e44[_0x276f71(0x19d)],'expiresAt':_0x5d7e44[_0x276f71(0x218)],'webhookLogs':_0x5d7e44[_0x276f71(0x16f)]};}async[a33_0x154fa1(0x1b9)](_0x5e6407,_0x392ffe,_0x12f85d,_0x4ea20e){const _0x170f5d=a33_0x154fa1;console[_0x170f5d(0x1f6)]('🔄\x20Updating\x20payment\x20'+_0x5e6407+_0x170f5d(0x229)+_0x392ffe);const _0x5bc504=['PENDING',_0x170f5d(0x21f),'PAID',_0x170f5d(0x1ec),_0x170f5d(0x199),_0x170f5d(0x193),_0x170f5d(0x1d3)];if(!_0x5bc504[_0x170f5d(0x1eb)](_0x392ffe[_0x170f5d(0x21d)]()))throw new Error('Invalid\x20status.\x20Valid\x20statuses:\x20'+_0x5bc504[_0x170f5d(0x1a7)](',\x20'));const _0x7ab3df=await database_1[_0x170f5d(0x1db)][_0x170f5d(0x16e)][_0x170f5d(0x1ea)]({'where':{'id':_0x5e6407},'select':{'id':!![],'status':!![],'orderId':!![]}});if(!_0x7ab3df)throw new Error(_0x170f5d(0x230));if(_0x392ffe['toUpperCase']()===_0x170f5d(0x1d3)){if(!_0x4ea20e||_0x4ea20e<=0x0)throw new Error(_0x170f5d(0x20f));console['log'](_0x170f5d(0x1ae)+_0x4ea20e+'\x20USDT\x20(penalty\x20amount)');}const _0x2ed53c={'status':_0x392ffe[_0x170f5d(0x21d)](),'updatedAt':new Date()};_0x12f85d&&(_0x2ed53c[_0x170f5d(0x191)]=_0x12f85d);_0x392ffe[_0x170f5d(0x21d)]()===_0x170f5d(0x1d3)&&_0x4ea20e&&(_0x2ed53c[_0x170f5d(0x1bb)]=_0x4ea20e);const _0x2259bc=await database_1[_0x170f5d(0x1db)][_0x170f5d(0x16e)][_0x170f5d(0x187)]({'where':{'id':_0x5e6407},'data':_0x2ed53c,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});return await database_1['default'][_0x170f5d(0x20e)][_0x170f5d(0x196)]({'data':{'paymentId':_0x5e6407,'shopId':_0x2259bc['shopId'],'event':_0x170f5d(0x220),'statusCode':0xc8,'responseBody':JSON[_0x170f5d(0x1c3)]({'oldStatus':_0x7ab3df[_0x170f5d(0x203)],'newStatus':_0x392ffe[_0x170f5d(0x21d)](),'notes':_0x12f85d||null,'chargebackAmount':_0x4ea20e||null,'timestamp':new Date()[_0x170f5d(0x181)]()})}}),console['log'](_0x170f5d(0x235)+_0x7ab3df['orderId']+_0x170f5d(0x204)+_0x7ab3df['status']+'\x20to\x20'+_0x392ffe[_0x170f5d(0x21d)]()),_0x392ffe[_0x170f5d(0x21d)]()===_0x170f5d(0x1d3)&&console['log'](_0x170f5d(0x1f1)+_0x4ea20e+_0x170f5d(0x190)),{'id':_0x2259bc['id'],'shopId':_0x2259bc[_0x170f5d(0x1d4)],'shopName':_0x2259bc[_0x170f5d(0x182)][_0x170f5d(0x1bf)],'shopUsername':_0x2259bc[_0x170f5d(0x182)]['username'],'gateway':_0x2259bc[_0x170f5d(0x18c)],'orderId':_0x2259bc[_0x170f5d(0x1a1)],'gatewayOrderId':_0x2259bc['gatewayOrderId'],'amount':_0x2259bc[_0x170f5d(0x1fb)],'currency':_0x2259bc[_0x170f5d(0x173)],'sourceCurrency':_0x2259bc[_0x170f5d(0x18a)],'status':_0x2259bc[_0x170f5d(0x203)],'usage':_0x2259bc[_0x170f5d(0x197)],'externalPaymentUrl':_0x2259bc[_0x170f5d(0x1bd)],'gatewayPaymentId':_0x2259bc['gatewayPaymentId'],'customerEmail':_0x2259bc[_0x170f5d(0x234)],'customerName':_0x2259bc[_0x170f5d(0x1ad)],'cardLast4':_0x2259bc['cardLast4'],'paymentMethod':_0x2259bc[_0x170f5d(0x1ba)],'bankId':_0x2259bc[_0x170f5d(0x172)],'remitterIban':_0x2259bc[_0x170f5d(0x1cb)],'remitterName':_0x2259bc['remitterName'],'chargebackAmount':_0x2259bc[_0x170f5d(0x1bb)],'adminNotes':_0x2259bc[_0x170f5d(0x191)],'statusChangedBy':_0x2259bc[_0x170f5d(0x17c)],'statusChangedAt':_0x2259bc[_0x170f5d(0x221)],'createdAt':_0x2259bc[_0x170f5d(0x1ed)],'updatedAt':_0x2259bc[_0x170f5d(0x19d)],'expiresAt':_0x2259bc[_0x170f5d(0x218)]};}async[a33_0x154fa1(0x168)](_0x4f9403){const _0x50d4e4=a33_0x154fa1,{page:_0x1eb4a8,limit:_0x3d76a4,status:_0x1f5870}=_0x4f9403,_0x1cae55=(_0x1eb4a8-0x1)*_0x3d76a4,_0x5f57a9={};_0x1f5870&&(_0x5f57a9['status']=_0x1f5870[_0x50d4e4(0x21d)]());console[_0x50d4e4(0x1f6)](_0x50d4e4(0x201),{'page':_0x1eb4a8,'limit':_0x3d76a4,'status':_0x1f5870,'where':_0x5f57a9});const [_0x25e7f0,_0x352bf6]=await Promise[_0x50d4e4(0x1ef)]([database_1[_0x50d4e4(0x1db)][_0x50d4e4(0x182)][_0x50d4e4(0x1de)]({'where':_0x5f57a9,'skip':_0x1cae55,'take':_0x3d76a4,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x50d4e4(0x1cc)}}),database_1['default'][_0x50d4e4(0x182)][_0x50d4e4(0x21a)]({'where':_0x5f57a9})]);console[_0x50d4e4(0x1f6)](_0x50d4e4(0x219)+_0x25e7f0[_0x50d4e4(0x1fe)]+_0x50d4e4(0x236)+_0x352bf6+'\x20total');const _0x13833c=_0x25e7f0[_0x50d4e4(0x1aa)](_0x3176d1=>({'id':_0x3176d1['id'],'fullName':_0x3176d1[_0x50d4e4(0x1bf)],'username':_0x3176d1[_0x50d4e4(0x225)],'telegramId':_0x3176d1['telegram'],'merchantUrl':_0x3176d1[_0x50d4e4(0x1f5)],'gateways':_0x3176d1['paymentGateways']?JSON['parse'](_0x3176d1[_0x50d4e4(0x19f)]):null,'gatewaySettings':_0x3176d1[_0x50d4e4(0x210)]?JSON[_0x50d4e4(0x18f)](_0x3176d1[_0x50d4e4(0x210)]):null,'publicKey':_0x3176d1[_0x50d4e4(0x209)],'wallets':{'usdtPolygonWallet':_0x3176d1['usdtPolygonWallet'],'usdtTrcWallet':_0x3176d1[_0x50d4e4(0x224)],'usdtErcWallet':_0x3176d1['usdtErcWallet'],'usdcPolygonWallet':_0x3176d1[_0x50d4e4(0x22d)]},'status':_0x3176d1[_0x50d4e4(0x203)],'createdAt':_0x3176d1[_0x50d4e4(0x1ed)]}));return{'users':_0x13833c,'pagination':{'page':_0x1eb4a8,'limit':_0x3d76a4,'total':_0x352bf6,'totalPages':Math[_0x50d4e4(0x1a5)](_0x352bf6/_0x3d76a4)}};}async[a33_0x154fa1(0x1d9)](_0x2921c9){const _0x531257=a33_0x154fa1;return await this[_0x531257(0x21e)]['getUserById'](_0x2921c9);}async[a33_0x154fa1(0x217)](_0x2dec7c){const _0x9807d=a33_0x154fa1;return await this['userService'][_0x9807d(0x217)](_0x2dec7c);}async[a33_0x154fa1(0x233)](_0x5d1b7b,_0x371acc){const _0x1db9e8=a33_0x154fa1;return await this[_0x1db9e8(0x21e)]['updateUser'](_0x5d1b7b,_0x371acc);}async[a33_0x154fa1(0x1dc)](_0x505689){const _0x2649b3=a33_0x154fa1;return await this[_0x2649b3(0x21e)][_0x2649b3(0x1dc)](_0x505689);}async[a33_0x154fa1(0x1e2)](_0x4fcd77){const _0x372d6c=a33_0x154fa1;console['log'](_0x372d6c(0x1e5)+_0x4fcd77);const _0x212d8d=await database_1[_0x372d6c(0x1db)]['shop'][_0x372d6c(0x1ea)]({'where':{'id':_0x4fcd77},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x212d8d)throw new Error('User\x20not\x20found');if(_0x212d8d['status']===_0x372d6c(0x216))throw new Error(_0x372d6c(0x18d));const _0x4946e4=await this[_0x372d6c(0x21e)]['updateUser'](_0x4fcd77,{'status':'SUSPENDED'});return console[_0x372d6c(0x1f6)](_0x372d6c(0x1a8)+_0x212d8d[_0x372d6c(0x225)]+_0x372d6c(0x1d5)),_0x4946e4;}async['activateUser'](_0x2a6d6f){const _0x201bef=a33_0x154fa1;console[_0x201bef(0x1f6)](_0x201bef(0x1fd)+_0x2a6d6f);const _0x13b551=await database_1[_0x201bef(0x1db)][_0x201bef(0x182)][_0x201bef(0x1ea)]({'where':{'id':_0x2a6d6f},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x13b551)throw new Error('User\x20not\x20found');if(_0x13b551[_0x201bef(0x203)]===_0x201bef(0x166))throw new Error(_0x201bef(0x1f2));const _0x5e7d92=await this[_0x201bef(0x21e)]['updateUser'](_0x2a6d6f,{'status':'ACTIVE'});return console[_0x201bef(0x1f6)](_0x201bef(0x1a8)+_0x13b551[_0x201bef(0x225)]+_0x201bef(0x164)),_0x5e7d92;}}exports['AdminService']=AdminService;function a33_0x4915(){const _0x36d68b=['getGatewayNameById','❌\x20Payment\x20not\x20found:\x20','gatewayPaymentId','\x20status\x20to:\x20','lte','split','defineProperty','usdcPolygonWallet','\x20merchants\x20with\x20eligible\x20PAID\x20payments','\x20deleted\x20successfully','Payment\x20not\x20found','\x20total','push','updateUser','customerEmail','✅\x20Payment\x20','\x20users\x20out\x20of\x20','payoutDelay','error','\x20activated\x20successfully','size','ACTIVE','completed','getAllUsers','🗑️\x20Deleting\x20payout:\x20','🔍\x20Getting\x20payout\x20by\x20ID:\x20','awaitingPayout','\x20eligible\x20PAID\x20payments\x20for\x20payout\x20analysis','getMerchantsAwaitingPayout','payment','webhookLogs','round','usdtErcWallet','bankId','currency','\x20USDT','\x20USDT\x20(только\x20PAID\x20платежи)','AdminService','2794785SmKsQz','\x20USDT\x20via\x20','txid','💳\x20Total\x20payments:\x20','amountAfterCommissionUSDT','statusChangedBy','asc','💰\x20Available\x20Balance:\x20','abs','deletePayout','toISOString','shop','availableBalance','📊\x20Calculating\x20admin\x20payout\x20statistics...','❌\x20Payout\x20not\x20found:\x20','UserService','update','telegram','insensitive','sourceCurrency','🔄\x20Marking\x20payments\x20as\x20paid\x20out\x20for\x20shop\x20','gateway','User\x20is\x20already\x20suspended','totalAmountUSDT','parse','\x20USDT\x20(will\x20be\x20deducted\x20from\x20merchant\x20balance)','adminNotes','💸\x20Creating\x20payout\x20for\x20shop\x20','REFUND','📋\x20Getting\x20payments\x20with\x20filters:','14378103OMGeKS','create','usage','1420YMjVKL','FAILED','updateMany','✅\x20Payout\x20statistics\x20calculated:','payments','updatedAt','PAID','paymentGateways','totalPayout','orderId','getDate','\x20merchants\x20out\x20of\x20','1099GUxJMF','ceil','currencyService','join','✅\x20User\x20','getGatewaySettings','map','492452oJfEAy','convertToUSDT','customerName','💸\x20Chargeback\x20amount:\x20','__esModule','30d','date','calculateEffectiveAmount','totalAmountAfterCommissionUSDT','📅\x20This\x20Month:\x20','3333heUZxt','\x20payouts\x20out\x20of\x20','toLowerCase','📊\x20Daily\x20revenue\x20entries:\x20','updatePaymentStatus','paymentMethod','chargebackAmount','createPayout','externalPaymentUrl','getFullYear','name','amountUSDT','cardLast4','📅\x20Processing\x20daily\x20stats\x20for\x20','stringify','isEligibleForPayout','charAt','network','toFixed','__importDefault','\x20payments\x20for\x20analysis\x20(PAID/REFUND/CHARGEBACK)','Error\x20parsing\x20gateway\x20settings:','remitterIban','desc','gte','19050bxEYCH','90d',',\x20amount:\x20','Payout\x20not\x20found','COMPLETED','CHARGEBACK','shopId','\x20suspended\x20successfully','getPaymentById','getSystemStatistics','payout','getUserById','gatewayOrderId','default','deleteUser','set','findMany','\x20USDT\x20(','has','notes','suspendUser','../types/gateway','\x20USDT\x20(включая\x20штрафы\x20chargeback)','🚫\x20Suspending\x20user:\x20','from','markPaymentsAsPaidOut','get','✅\x20Payout\x20created\x20successfully:\x20','findUnique','includes','EXPIRED','createdAt','setDate','all','paidAt','💸\x20Chargeback\x20penalty:\x20','User\x20is\x20already\x20active','💰\x20Total\x20amount:\x20','🔍\x20Getting\x20payment\x20by\x20ID:\x20','shopUrl','log','\x20payments\x20for\x20revenue\x20calculation\x20(PAID/REFUND/CHARGEBACK)','💰\x20Found\x20','\x20payments\x20as\x20paid\x20out','19544vGXlSq','amount','getPeriodDays','✅\x20Activating\x20user:\x20','length','entries','../config/database','📋\x20Getting\x20users\x20with\x20filters:','reduce','status','\x20status\x20updated\x20from\x20','⏳\x20Awaiting\x20Payout:\x20','2832606glDniN','getMonth','calculateAmountAfterCommission','publicKey','\x20payments\x20out\x20of\x20','\x20days)','📊\x20Generating\x20admin\x20statistics\x20for\x20period:\x20','remitterName','webhookLog','Chargeback\x20amount\x20is\x20required\x20and\x20must\x20be\x20positive\x20(amount\x20in\x20USDT)','gatewaySettings','getPayoutStats','delete','merchantPaid','getAllPayouts','✅\x20Found\x20payout:\x20','SUSPENDED','createUser','expiresAt','📊\x20Found\x20','count','Shop\x20is\x20not\x20active','slice','toUpperCase','userService','PROCESSING','status_update','statusChangedAt','commission','✅\x20Admin\x20statistics\x20generated\x20successfully','usdtTrcWallet','username'];a33_0x4915=function(){return _0x36d68b;};return a33_0x4915();}