'use strict';function a35_0x2347(_0x1a36fc,_0x1ed16e){const _0x1a1131=a35_0x1a11();return a35_0x2347=function(_0x2347eb,_0x192089){_0x2347eb=_0x2347eb-0xd9;let _0x12b045=_0x1a1131[_0x2347eb];return _0x12b045;},a35_0x2347(_0x1a36fc,_0x1ed16e);}const a35_0x16c276=a35_0x2347;(function(_0x62231d,_0x227fa7){const _0x83a17a=a35_0x2347,_0x181ff6=_0x62231d();while(!![]){try{const _0x25b3a4=-parseInt(_0x83a17a(0x16b))/0x1+parseInt(_0x83a17a(0x12d))/0x2*(parseInt(_0x83a17a(0x144))/0x3)+-parseInt(_0x83a17a(0x112))/0x4+-parseInt(_0x83a17a(0x118))/0x5+-parseInt(_0x83a17a(0xdd))/0x6+parseInt(_0x83a17a(0x199))/0x7*(parseInt(_0x83a17a(0x1d8))/0x8)+parseInt(_0x83a17a(0x135))/0x9*(parseInt(_0x83a17a(0x107))/0xa);if(_0x25b3a4===_0x227fa7)break;else _0x181ff6['push'](_0x181ff6['shift']());}catch(_0xd223c9){_0x181ff6['push'](_0x181ff6['shift']());}}}(a35_0x1a11,0xf1800));var __importDefault=this&&this[a35_0x16c276(0xf9)]||function(_0x28b6a5){const _0xb4ac7c=a35_0x16c276;return _0x28b6a5&&_0x28b6a5[_0xb4ac7c(0x1aa)]?_0x28b6a5:{'default':_0x28b6a5};};Object[a35_0x16c276(0x1f3)](exports,'__esModule',{'value':!![]}),exports['AdminService']=void 0x0;const database_1=__importDefault(require(a35_0x16c276(0x171))),bcryptjs_1=__importDefault(require(a35_0x16c276(0x1e0))),crypto_1=__importDefault(require(a35_0x16c276(0x12e))),currencyService_1=require(a35_0x16c276(0x145)),gateway_1=require('../types/gateway');function a35_0x1a11(){const _0x5a07ea=['📅\x20Period\x20\x27all\x27:\x20Using\x20start\x20date\x20from\x20first\x20payment:\x20','asc','getFullYear','stringify','📊\x20Sorting\x20payments\x20by\x20','customerEmail','\x27\x20->\x20ID\x20\x27','statusChangedAt','commissionUSDT','\x20balance\x20updated:','log','createPayout','\x20->\x20','dateFrom','paymentGateways','custom','revenue','8wTTTql','periodTo','KLYME\x20DE','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','\x20\x20\x20🖥️\x20User\x20Agent:\x20','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','usdtPolygonWallet','SUSPENDED','bcryptjs','Test\x20Gateway','\x20\x20\x20💸\x20Total\x20payouts\x20(all\x20time):\x20','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','availableBalance','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','createdAt','paymentsCount','90d','🔄\x20Admin\x20updating\x20payment\x20','commission','KLYME\x20GB','\x20\x20\x20Merchant\x20loses:\x20','\x20USDT\x20(without\x20commission)','dailyRevenue','30d','adminNotes','COMPLETED','\x20\x20\x20🌐\x20IP:\x20','defineProperty','getAllPayments','summary','toLowerCase','txid','shopId','all','\x20\x20\x20🔍\x20Calculated\x20after\x20commission:\x20','\x20\x20\x20Gateway:\x20','REFUND','username','totalCommissionRate','usdtTrcWallet','fullName','dateTo','updatePaymentStatus','ceil','%\x20commission)','📅\x20Period:\x20','Open\x20Banking\x202','NONEXISTENT_GATEWAY_FILTER','date','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','5305434pZuMOX','polygon','\x20\x20\x20Full\x20amount:\x20','\x20USDT\x20(','📊\x20Calculating\x20payout\x20statistics...','\x20\x20\x20✅\x20Actual\x20available\x20balance:\x20','turnover','entries','averageCheckUSDT','\x20\x20\x20Transaction\x20hash:\x20','getUserById','customerCountry','period','Noda','customerIp','getGatewayInternalName','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','🔄\x20Gateway\x20mapping\x20(create):','toString','getGatewayNameById','map','wallets','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','💰\x20[PAYOUT]\x20Gateway\x20','gatewayOrderId','localeCompare','customerName','\x20\x20\x20Total\x20paid\x20out:\x20','__importDefault','insensitive','\x20\x20\x20Merchant\x20gets:\x20','noda','🔄\x20Converted\x20gateway\x20name\x20\x27','\x20USDT\x20(theoretical\x20net)','getMerchantsAwaitingPayout','📊\x20Payout\x20statistics\x20calculated:','Plisio','lte','📊\x20Merchant\x20statistics\x20calculated:','balance','customerUa','convertToUSDT','11810SLdFHT','currency','getGatewayDisplayName','💰\x20[PAYOUT]\x20Merchant\x20','not\x20set','toUpperCase','gatewayEarnings','getTime','📊\x20Merchants\x20awaiting\x20payout:\x20','_count','periodFrom','6902668Mfsydy','2020-01-01','\x20USDT\x20(actual\x20balances)','\x27\x20(from\x20\x27','pendingUrl','💱\x20Currency\x20filter\x20applied:\x20','5767940JoAIJg','plisio','🔄\x20Gateway\x20mapping:','parse','totalPayments','\x20PAID\x20payments','$transaction',',\x20successful:\x20','values','get','toISOString','updateUser','polygon_usdc','amount','status','getGatewayIdByName','count','gateways','\x20USDT\x20(after\x20','updatedAt','currencyService','6imzxgi','crypto','create','aggregate','totalPaidOut','klyme_gb','totalAmountAfterCommissionUSDT','cointopay2','35388lSlqPR','desc','📊\x20Final\x20WHERE\x20conditions:','getMerchantStatistics','telegram','\x20balance\x20updated:\x20','deleteUser','findUnique','forEach','cointopay','📋\x20Getting\x20merchants\x20selection\x20list...','name','getMonth','\x20\x20\x20💰\x20Total\x20payments\x20turnover:\x20','failUrl','257313iHIjYO','./currencyService','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','network','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','usdtErcWallet','telegramId','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','💰\x20Shop\x20','totalTurnover','merchantEarnings','🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','round','0000','\x20for\x20shop\x20','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','📊\x20Gateway\x20filter\x20applied:','update','📊\x20Total\x20payments\x20(including\x20failed):\x20','getAllPayouts','activateUser','year','\x20\x20\x20📅\x20This\x20month:\x20','\x20merchants','updateCustomerData','thisMonth','groupBy','awaitingPayout','📊\x20Getting\x20payments\x20with\x20filters:','amountUSDT','statusChangedBy','push','whiteUrl','gatewaySettings','week','Payment\x20not\x20found','not\x20specified','join','PAID','634520gjhgqI','averageCommissionRate','Username\x20already\x20exists','generateDailyStatistics','getAllUsers','shop','../config/database','🔄\x20Converted\x20gateway\x20ID\x20\x27','Shop\x20not\x20found','getSystemStatistics','✅\x20Payout\x20created:\x20',',\x20Commission:\x20','error','\x20USDT)','gateway','findMany','\x20merchants\x20with\x20positive\x20balance','\x20\x20\x20📅\x20Total\x20payouts\x20(this\x20month):\x20','notes','gte','\x20USDT','\x20\x20\x20📊\x20Commission\x20difference:\x20','payout','\x20\x20\x20Current\x20balance:\x20','\x20to\x20','trc20','✅\x20Using\x20gateway\x20filter:\x20\x27','set','test_gateway','\x20\x20\x20💰\x20Total\x20turnover:\x20','ACTIVE','split','Telegram\x20username\x20already\x20exists','\x20\x20\x20�\x20Total\x20payments\x20turnover:\x20','💰\x20Payment\x20','shopUrl','getPayoutById','Insufficient\x20balance.\x20Available:\x20','successUrl','\x20\x20\x20Payout\x20amount:\x20','toFixed','⚠️\x20Gateway\x20\x27','default','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','merchantUrl','turnoverUSDT','3403351VywHND','\x20\x20\x20💰\x20Total\x20payout:\x20','totalAmountUSDT','💸\x20CHARGEBACK:\x20Merchant\x20amount\x20already\x20deducted\x20from\x20balance','\x20no\x20longer\x20PAID:','hash','paidOutUSDT','merchantEarningsUSDT','paidAt','includes','\x20\x20\x20🌍\x20Country:\x20','_sum','externalPaymentUrl','\x20became\x20PAID:','⚠️\x20Payment\x20','\x20\x20\x20🔍\x20Raw\x20balance\x20sum:\x20','usdcPolygonWallet','__esModule','getMerchantsSelection','\x20\x20\x20Balance:\x20','failureMessage','CoinToPay','pk_','hex','chargebackAmount','payment','KLYME\x20EU','length','reduce','getPayoutStats','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','mastercard','findFirst','rapyd','publicKey','totalPayout','klyme_de','password','CHARGEBACK','💰\x20Current\x20shop\x20balance:\x20','orderId','suspendUser','sk_','\x20status:\x20','Error\x20processing\x20payment\x20','AdminService'];a35_0x1a11=function(){return _0x5a07ea;};return a35_0x1a11();}class AdminService{async[a35_0x16c276(0x1b6)](){const _0x409316=a35_0x16c276;console['log'](_0x409316(0xe1));const _0x669e29=await database_1['default'][_0x409316(0x170)]['aggregate']({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':'ACTIVE'}}),_0x3a2e15=await this[_0x409316(0xff)]({'page':0x1,'limit':0x3e8}),_0x363369=await database_1[_0x409316(0x195)][_0x409316(0x1b2)][_0x409316(0x128)]({'where':{'status':_0x409316(0x16a),'gateway':{'not':'test_gateway'}}}),_0x3d60d9=new Date(),_0x577456=new Date(_0x3d60d9[_0x409316(0x1c9)](),_0x3d60d9[_0x409316(0x141)](),0x1),_0x2bac60=new Date(_0x3d60d9[_0x409316(0x1c9)](),_0x3d60d9[_0x409316(0x141)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x3e157c=await database_1[_0x409316(0x195)][_0x409316(0x181)][_0x409316(0x130)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x577456,'lte':_0x2bac60},'status':_0x409316(0x1f1)}}),_0x114663=_0x669e29[_0x409316(0x1a4)][_0x409316(0x131)]||0x0,_0xc33a8a=_0x3a2e15[_0x409316(0x1f5)][_0x409316(0x133)],_0x4f064b=_0x3e157c[_0x409316(0x1a4)]['amount']||0x0,_0x3f6b8c={'totalPayout':Math[_0x409316(0x150)](_0x114663*0x64)/0x64,'awaitingPayout':Math['round'](_0xc33a8a*0x64)/0x64,'thisMonth':Math[_0x409316(0x150)](_0x4f064b*0x64)/0x64,'availableBalance':Math[_0x409316(0x150)](_0xc33a8a*0x64)/0x64,'totalPayments':_0x363369};return console[_0x409316(0x1d1)](_0x409316(0x100)),console[_0x409316(0x1d1)](_0x409316(0x19a)+_0x3f6b8c['totalPayout']+'\x20USDT\x20(total\x20paid\x20to\x20merchants)'),console[_0x409316(0x1d1)](_0x409316(0x1dd)+_0x3f6b8c[_0x409316(0x15f)]+'\x20USDT\x20(with\x20commission\x20deducted)'),console['log']('\x20\x20\x20💵\x20Available\x20balance:\x20'+_0x3f6b8c[_0x409316(0x1e4)]+'\x20USDT\x20(same\x20as\x20awaiting)'),console[_0x409316(0x1d1)](_0x409316(0x15a)+_0x3f6b8c[_0x409316(0x15d)]+_0x409316(0x17f)),console[_0x409316(0x1d1)]('\x20\x20\x20💳\x20Total\x20payments:\x20'+_0x3f6b8c[_0x409316(0x11c)]+_0x409316(0x11d)),console[_0x409316(0x1d1)](_0x409316(0x1a8)+(_0x669e29[_0x409316(0x1a4)]['balance']||0x0)[_0x409316(0x193)](0x2)+_0x409316(0x1ed)),console[_0x409316(0x1d1)](_0x409316(0x180)+((_0x669e29['_sum'][_0x409316(0x104)]||0x0)-_0xc33a8a)[_0x409316(0x193)](0x2)+_0x409316(0x17f)),_0x3f6b8c;}async[a35_0x16c276(0x15c)](_0xfd2593,_0x1210f4){const _0x24c3a4=a35_0x16c276;console[_0x24c3a4(0x1d1)](_0x24c3a4(0x1e3)+_0xfd2593+':',_0x1210f4);const _0x73b162=await database_1[_0x24c3a4(0x195)][_0x24c3a4(0x1b2)][_0x24c3a4(0x13c)]({'where':{'id':_0xfd2593},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x73b162)throw new Error(_0x24c3a4(0x167));const _0x29bfc8={};_0x1210f4[_0x24c3a4(0xe8)]!==undefined&&(_0x29bfc8[_0x24c3a4(0xe8)]=_0x1210f4[_0x24c3a4(0xe8)]||null);_0x1210f4[_0x24c3a4(0xeb)]!==undefined&&(_0x29bfc8[_0x24c3a4(0xeb)]=_0x1210f4[_0x24c3a4(0xeb)]||null);_0x1210f4['customerUa']!==undefined&&(_0x29bfc8[_0x24c3a4(0x105)]=_0x1210f4[_0x24c3a4(0x105)]||null);const _0x505e9a=await database_1['default'][_0x24c3a4(0x1b2)][_0x24c3a4(0x155)]({'where':{'id':_0xfd2593},'data':{..._0x29bfc8,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x24c3a4(0x1d1)]('✅\x20Customer\x20data\x20updated\x20for\x20payment\x20'+_0xfd2593),console[_0x24c3a4(0x1d1)](_0x24c3a4(0x1a3)+_0x73b162[_0x24c3a4(0xe8)]+_0x24c3a4(0x1d3)+_0x505e9a[_0x24c3a4(0xe8)]),console[_0x24c3a4(0x1d1)](_0x24c3a4(0x1f2)+_0x73b162[_0x24c3a4(0xeb)]+_0x24c3a4(0x1d3)+_0x505e9a[_0x24c3a4(0xeb)]),console[_0x24c3a4(0x1d1)](_0x24c3a4(0x1dc)+(_0x73b162['customerUa']?_0x24c3a4(0x186):_0x24c3a4(0x10b))+'\x20->\x20'+(_0x505e9a[_0x24c3a4(0x105)]?'set':'not\x20set')),_0x505e9a;}async[a35_0x16c276(0x174)](_0x410ca3){const _0x84bcdc=a35_0x16c276,_0x1b92f0=new Date();let _0x469674;switch(_0x410ca3){case'7d':_0x469674=new Date(_0x1b92f0[_0x84bcdc(0x10e)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x84bcdc(0x1ef):_0x469674=new Date(_0x1b92f0[_0x84bcdc(0x10e)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x84bcdc(0x1e8):_0x469674=new Date(_0x1b92f0[_0x84bcdc(0x10e)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x84bcdc(0x1f9):const _0x318f7e=await database_1['default'][_0x84bcdc(0x1b2)][_0x84bcdc(0x1b9)]({'where':{'gateway':{'not':_0x84bcdc(0x187)}},'orderBy':{'createdAt':'asc'},'select':{'createdAt':!![]}});_0x469674=_0x318f7e?_0x318f7e['createdAt']:new Date('2020-01-01'),console[_0x84bcdc(0x1d1)](_0x84bcdc(0x1c7)+_0x469674[_0x84bcdc(0x122)]());break;default:_0x469674=new Date(_0x1b92f0[_0x84bcdc(0x10e)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x23425f,_0x308100,_0x56ee14,_0x1543aa,_0x21aa91,_0xf9f852,_0xe84e59]=await Promise['all']([database_1[_0x84bcdc(0x195)][_0x84bcdc(0x170)][_0x84bcdc(0x128)](),database_1[_0x84bcdc(0x195)][_0x84bcdc(0x170)][_0x84bcdc(0x128)]({'where':{'status':_0x84bcdc(0x189)}}),database_1[_0x84bcdc(0x195)][_0x84bcdc(0x1b2)][_0x84bcdc(0x128)]({'where':{'createdAt':{'gte':_0x469674},'gateway':{'not':_0x84bcdc(0x187)}}}),database_1[_0x84bcdc(0x195)][_0x84bcdc(0x1b2)][_0x84bcdc(0x128)]({'where':{'status':_0x84bcdc(0x16a),'createdAt':{'gte':_0x469674},'gateway':{'not':_0x84bcdc(0x187)}}}),database_1[_0x84bcdc(0x195)][_0x84bcdc(0x1b2)][_0x84bcdc(0x17a)]({'where':{'status':_0x84bcdc(0x16a),'createdAt':{'gte':_0x469674},'gateway':{'not':_0x84bcdc(0x187)}},'select':{'amount':!![],'currency':!![]}}),database_1[_0x84bcdc(0x195)][_0x84bcdc(0x1b2)][_0x84bcdc(0x17a)]({'where':{'gateway':{'not':_0x84bcdc(0x187)}},'take':0xa,'orderBy':{'createdAt':_0x84bcdc(0x136)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x84bcdc(0x195)][_0x84bcdc(0x1b2)][_0x84bcdc(0x17a)]({'where':{'createdAt':{'gte':_0x469674},'gateway':{'not':_0x84bcdc(0x187)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x28372c=0x0;for(const _0x5db0f8 of _0x21aa91){const _0xc59e2a=await currencyService_1[_0x84bcdc(0x12c)][_0x84bcdc(0x106)](_0x5db0f8[_0x84bcdc(0x125)],_0x5db0f8[_0x84bcdc(0x108)]);_0x28372c+=_0xc59e2a;}const _0x5a7dde=this[_0x84bcdc(0x16e)](_0xe84e59,_0x469674,_0x1b92f0),_0x562aaa=_0x56ee14>0x0?_0x1543aa/_0x56ee14*0x64:0x0;return{'totalShops':_0x23425f,'activeShops':_0x308100,'totalPayments':_0x56ee14,'successfulPayments':_0x1543aa,'totalRevenue':Math[_0x84bcdc(0x150)](_0x28372c*0x64)/0x64,'conversionRate':Math[_0x84bcdc(0x150)](_0x562aaa*0x64)/0x64,'dailyRevenue':_0x5a7dde[_0x84bcdc(0x1ee)],'dailyPayments':_0x5a7dde['dailyPayments'],'recentPayments':_0xf9f852[_0x84bcdc(0xf1)](_0x8ae810=>({'id':_0x8ae810['id'],'amount':_0x8ae810[_0x84bcdc(0x125)],'currency':_0x8ae810['currency'],'status':_0x8ae810[_0x84bcdc(0x126)],'gateway':_0x8ae810[_0x84bcdc(0x179)],'shop':_0x8ae810[_0x84bcdc(0x170)],'createdAt':_0x8ae810[_0x84bcdc(0x1e6)]}))};}async[a35_0x16c276(0x138)](_0x1b5c42){const _0x574807=a35_0x16c276;console['log'](_0x574807(0xf3),_0x1b5c42);let _0x14fc73,_0x5b4efd=new Date();if(_0x1b5c42['period']===_0x574807(0x1d6)&&_0x1b5c42[_0x574807(0x1d4)]&&_0x1b5c42[_0x574807(0x201)])_0x14fc73=new Date(_0x1b5c42['dateFrom']),_0x5b4efd=new Date(_0x1b5c42['dateTo']);else{const _0x27cd38=new Date();switch(_0x1b5c42[_0x574807(0xe9)]){case _0x574807(0x166):_0x14fc73=new Date(_0x27cd38[_0x574807(0x10e)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'month':_0x14fc73=new Date(_0x27cd38[_0x574807(0x10e)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x574807(0x159):_0x14fc73=new Date(_0x27cd38['getTime']()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case'all':default:_0x14fc73=new Date(_0x574807(0x113));break;}}console[_0x574807(0x1d1)](_0x574807(0x205)+_0x14fc73['toISOString']()+_0x574807(0x183)+_0x5b4efd[_0x574807(0x122)]());const _0x10f5a0={'status':_0x574807(0x16a),'gateway':{'not':_0x574807(0x187)},'paidAt':{'gte':_0x14fc73,'lte':_0x5b4efd}};_0x1b5c42[_0x574807(0x1f8)]&&(_0x10f5a0[_0x574807(0x1f8)]=_0x1b5c42[_0x574807(0x1f8)]);const _0x2fee0c=await database_1[_0x574807(0x195)]['payment']['findMany']({'where':_0x10f5a0,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x574807(0x1d1)]('💰\x20Found\x20'+_0x2fee0c['length']+'\x20paid\x20payments\x20for\x20analysis');const _0x3e2190={'gateway':{'not':'test_gateway'},'createdAt':{'gte':_0x14fc73,'lte':_0x5b4efd}};_0x1b5c42[_0x574807(0x1f8)]&&(_0x3e2190[_0x574807(0x1f8)]=_0x1b5c42['shopId']);const _0x11e5a2=await database_1[_0x574807(0x195)][_0x574807(0x1b2)]['count']({'where':_0x3e2190});console[_0x574807(0x1d1)](_0x574807(0x156)+_0x11e5a2+_0x574807(0x11f)+_0x2fee0c[_0x574807(0x1b4)]);let _0x593ebe=0x0,_0x487a8c=0x0,_0x123821=0x0;const _0x33f244={},_0x4bbe17={},_0x4c22e9={};for(const _0x47d4bf of _0x2fee0c){try{const _0x39c418=await currencyService_1['currencyService'][_0x574807(0x106)](_0x47d4bf['amount'],_0x47d4bf[_0x574807(0x108)]);let _0x2b60ce={};if(_0x47d4bf[_0x574807(0x170)][_0x574807(0x165)])try{_0x2b60ce=JSON['parse'](_0x47d4bf[_0x574807(0x170)]['gatewaySettings']);}catch(_0x31f7ac){console['error'](_0x574807(0x1b7)+_0x47d4bf[_0x574807(0x1f8)]+':',_0x31f7ac);}let _0x123cc2={},_0x4c3d53=0xa;for(const [_0xc62193,_0xb2dc4e]of Object['entries'](_0x2b60ce)){if(_0xc62193[_0x574807(0x1f6)]()===_0x47d4bf[_0x574807(0x179)]['toLowerCase']()){_0x123cc2=_0xb2dc4e,_0x4c3d53=_0xb2dc4e[_0x574807(0x1ea)]||0xa;break;}}const _0x3a7a00=_0x39c418*(_0x4c3d53/0x64),_0x48b910=_0x39c418-_0x3a7a00;_0x593ebe+=_0x39c418,_0x487a8c+=_0x48b910,_0x123821+=_0x3a7a00;!_0x33f244[_0x47d4bf['gateway']]&&(_0x33f244[_0x47d4bf[_0x574807(0x179)]]={'gateway':_0x47d4bf[_0x574807(0x179)],'gatewayDisplayName':this[_0x574807(0x109)](_0x47d4bf['gateway']),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x33f244[_0x47d4bf[_0x574807(0x179)]][_0x574807(0x1e7)]++,_0x33f244[_0x47d4bf[_0x574807(0x179)]][_0x574807(0x198)]+=_0x39c418,_0x33f244[_0x47d4bf['gateway']][_0x574807(0x1cf)]+=_0x3a7a00,_0x33f244[_0x47d4bf[_0x574807(0x179)]][_0x574807(0x1a0)]+=_0x48b910,_0x33f244[_0x47d4bf[_0x574807(0x179)]]['totalCommissionRate']+=_0x4c3d53;!_0x1b5c42[_0x574807(0x1f8)]&&(!_0x4bbe17[_0x47d4bf[_0x574807(0x1f8)]]&&(_0x4bbe17[_0x47d4bf[_0x574807(0x1f8)]]={'shopId':_0x47d4bf[_0x574807(0x1f8)],'shopName':_0x47d4bf['shop'][_0x574807(0x140)],'shopUsername':_0x47d4bf[_0x574807(0x170)][_0x574807(0x1fd)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x4bbe17[_0x47d4bf[_0x574807(0x1f8)]][_0x574807(0x1e7)]++,_0x4bbe17[_0x47d4bf[_0x574807(0x1f8)]][_0x574807(0x198)]+=_0x39c418,_0x4bbe17[_0x47d4bf[_0x574807(0x1f8)]][_0x574807(0x1cf)]+=_0x3a7a00,_0x4bbe17[_0x47d4bf[_0x574807(0x1f8)]][_0x574807(0x1a0)]+=_0x48b910);const _0x1c212b=_0x47d4bf['paidAt']['toISOString']()['split']('T')[0x0];!_0x4c22e9[_0x1c212b]&&(_0x4c22e9[_0x1c212b]={'date':_0x1c212b,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x4c22e9[_0x1c212b][_0x574807(0xe3)]+=_0x39c418,_0x4c22e9[_0x1c212b]['merchantEarnings']+=_0x48b910,_0x4c22e9[_0x1c212b][_0x574807(0x10d)]+=_0x3a7a00,_0x4c22e9[_0x1c212b][_0x574807(0x1e7)]++;}catch(_0x744adf){console[_0x574807(0x177)](_0x574807(0x1c5)+_0x47d4bf['id']+':',_0x744adf);}}Object['values'](_0x33f244)['forEach'](_0x2e2042=>{const _0x7b078=_0x574807;_0x2e2042[_0x7b078(0x16c)]=_0x2e2042[_0x7b078(0x1e7)]>0x0?_0x2e2042[_0x7b078(0x1fe)]/_0x2e2042[_0x7b078(0x1e7)]:0x0,delete _0x2e2042[_0x7b078(0x1fe)];}),Object['values'](_0x4bbe17)[_0x574807(0x13d)](_0x289ee2=>{const _0x38e945=_0x574807;_0x289ee2[_0x38e945(0xe5)]=_0x289ee2['paymentsCount']>0x0?_0x289ee2[_0x38e945(0x198)]/_0x289ee2[_0x38e945(0x1e7)]:0x0;});let _0x1ebe8c=0x0;if(_0x1b5c42['shopId']){const _0x15f352=await database_1[_0x574807(0x195)]['payout'][_0x574807(0x17a)]({'where':{'shopId':_0x1b5c42[_0x574807(0x1f8)],'status':_0x574807(0x1f1),'createdAt':{'gte':_0x14fc73,'lte':_0x5b4efd}},'select':{'amount':!![]}});_0x1ebe8c=_0x15f352[_0x574807(0x1b5)]((_0x1f29cc,_0x7a1a12)=>_0x1f29cc+_0x7a1a12[_0x574807(0x125)],0x0);}const _0x313c5f=_0x11e5a2,_0x172e28=_0x2fee0c[_0x574807(0x1b4)],_0x58440c=_0x172e28>0x0?_0x593ebe/_0x172e28:0x0,_0x5edc4f=_0x313c5f>0x0?Math['round'](_0x172e28/_0x313c5f*0x2710)/0x64:0x0,_0x14310c=Math['ceil']((_0x5b4efd[_0x574807(0x10e)]()-_0x14fc73[_0x574807(0x10e)]())/(0x3e8*0x3c*0x3c*0x18)),_0x57bea3={'totalTurnover':Math[_0x574807(0x150)](_0x593ebe*0x64)/0x64,'merchantEarnings':Math[_0x574807(0x150)](_0x487a8c*0x64)/0x64,'gatewayEarnings':Math['round'](_0x123821*0x64)/0x64,'totalPaidOut':Math[_0x574807(0x150)](_0x1ebe8c*0x64)/0x64,'averageCheck':Math[_0x574807(0x150)](_0x58440c*0x64)/0x64,'totalPayments':_0x313c5f,'successfulPayments':_0x172e28,'conversionRate':_0x5edc4f,'gatewayBreakdown':Object['values'](_0x33f244)[_0x574807(0xf1)](_0x3861a9=>({..._0x3861a9,'turnoverUSDT':Math[_0x574807(0x150)](_0x3861a9[_0x574807(0x198)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x3861a9['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x574807(0x150)](_0x3861a9[_0x574807(0x1a0)]*0x64)/0x64,'averageCommissionRate':Math['round'](_0x3861a9['averageCommissionRate']*0x64)/0x64})),'merchantBreakdown':_0x1b5c42[_0x574807(0x1f8)]?undefined:Object[_0x574807(0x120)](_0x4bbe17)[_0x574807(0xf1)](_0x3b9d05=>({..._0x3b9d05,'turnoverUSDT':Math[_0x574807(0x150)](_0x3b9d05[_0x574807(0x198)]*0x64)/0x64,'commissionUSDT':Math[_0x574807(0x150)](_0x3b9d05[_0x574807(0x1cf)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x3b9d05['merchantEarningsUSDT']*0x64)/0x64,'paidOutUSDT':Math[_0x574807(0x150)](_0x3b9d05[_0x574807(0x19f)]*0x64)/0x64,'averageCheckUSDT':Math[_0x574807(0x150)](_0x3b9d05[_0x574807(0xe5)]*0x64)/0x64})),'dailyData':Object[_0x574807(0x120)](_0x4c22e9)[_0x574807(0xf1)](_0x59939b=>({..._0x59939b,'turnover':Math[_0x574807(0x150)](_0x59939b[_0x574807(0xe3)]*0x64)/0x64,'merchantEarnings':Math[_0x574807(0x150)](_0x59939b[_0x574807(0x14e)]*0x64)/0x64,'gatewayEarnings':Math[_0x574807(0x150)](_0x59939b[_0x574807(0x10d)]*0x64)/0x64}))['sort']((_0x30e8a6,_0x1c290d)=>_0x30e8a6[_0x574807(0xdb)][_0x574807(0xf6)](_0x1c290d[_0x574807(0xdb)])),'periodInfo':{'from':_0x14fc73,'to':_0x5b4efd,'periodType':_0x1b5c42['period']||_0x574807(0x1d6),'daysCount':_0x14310c}};return console[_0x574807(0x1d1)](_0x574807(0x103)),console[_0x574807(0x1d1)](_0x574807(0x188)+_0x57bea3[_0x574807(0x14d)]+_0x574807(0x17f)),console['log'](_0x574807(0x1db)+_0x57bea3[_0x574807(0x14e)]+_0x574807(0x17f)),console[_0x574807(0x1d1)](_0x574807(0x153)+_0x57bea3[_0x574807(0x10d)]+_0x574807(0x17f)),console[_0x574807(0x1d1)]('\x20\x20\x20📊\x20Total\x20payments:\x20'+_0x57bea3['totalPayments']),_0x57bea3;}async[a35_0x16c276(0x1ab)](){const _0x266715=a35_0x16c276;console[_0x266715(0x1d1)](_0x266715(0x13f));const _0x69f573=await database_1[_0x266715(0x195)][_0x266715(0x170)]['findMany']({'where':{'status':_0x266715(0x189)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x266715(0x1c8)}});return console[_0x266715(0x1d1)]('📋\x20Found\x20'+_0x69f573[_0x266715(0x1b4)]+'\x20active\x20merchants\x20for\x20selection'),_0x69f573[_0x266715(0xf1)](_0x368bc4=>({'id':_0x368bc4['id'],'username':_0x368bc4[_0x266715(0x1fd)],'name':_0x368bc4[_0x266715(0x140)]}));}[a35_0x16c276(0x109)](_0x1ccc89){const _0x24e67e=a35_0x16c276,_0xb06461={'test_gateway':_0x24e67e(0x1e1),'plisio':_0x24e67e(0x101),'rapyd':'Rapyd','noda':_0x24e67e(0xea),'cointopay':_0x24e67e(0x1ae),'cointopay2':_0x24e67e(0xd9),'klyme_eu':_0x24e67e(0x1b3),'klyme_gb':_0x24e67e(0x1eb),'klyme_de':_0x24e67e(0x1da),'mastercard':'MasterCard'};return _0xb06461[_0x1ccc89]||_0x1ccc89;}[a35_0x16c276(0xec)](_0x18ec83){const _0x42804d=a35_0x16c276,_0x28527a={'Test\x20Gateway':_0x42804d(0x187),'Plisio':_0x42804d(0x119),'Rapyd':_0x42804d(0x1ba),'Noda':_0x42804d(0xfc),'CoinToPay':_0x42804d(0x13e),'CoinToPay2':_0x42804d(0x134),'KLYME\x20EU':'klyme_eu','KLYME\x20GB':_0x42804d(0x132),'KLYME\x20DE':_0x42804d(0x1bd),'MasterCard':_0x42804d(0x1b8)};return _0x28527a[_0x18ec83]||_0x18ec83[_0x42804d(0x1f6)]();}async[a35_0x16c276(0xff)](_0x9d3290){const _0x1c96ff=a35_0x16c276,{page:_0x46bcf0,limit:_0x566acf,minAmount:_0xb0949a,search:_0x282229}=_0x9d3290,_0x45b9b6=(_0x46bcf0-0x1)*_0x566acf;console[_0x1c96ff(0x1d1)](_0x1c96ff(0xed),_0x9d3290);const _0xacadb7={'balance':{'gt':0x0},'status':_0x1c96ff(0x189)};_0xb0949a&&(_0xacadb7[_0x1c96ff(0x104)][_0x1c96ff(0x17e)]=_0xb0949a);_0x282229&&(_0xacadb7['OR']=[{'name':{'contains':_0x282229,'mode':_0x1c96ff(0xfa)}},{'username':{'contains':_0x282229,'mode':_0x1c96ff(0xfa)}}]);const [_0xc5965e,_0x48a18f]=await Promise[_0x1c96ff(0x1f9)]([database_1[_0x1c96ff(0x195)][_0x1c96ff(0x170)][_0x1c96ff(0x17a)]({'where':_0xacadb7,'skip':_0x45b9b6,'take':_0x566acf,'orderBy':{'balance':_0x1c96ff(0x136)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1['default'][_0x1c96ff(0x170)]['count']({'where':_0xacadb7})]);console[_0x1c96ff(0x1d1)]('💰\x20Found\x20'+_0xc5965e[_0x1c96ff(0x1b4)]+_0x1c96ff(0x17b));const _0x2c99f4=await Promise[_0x1c96ff(0x1f9)](_0xc5965e[_0x1c96ff(0xf1)](async _0x168cf7=>{const _0xe4e5a0=_0x1c96ff,[_0x374723,_0x23f819,_0x41b343]=await Promise[_0xe4e5a0(0x1f9)]([database_1[_0xe4e5a0(0x195)][_0xe4e5a0(0x1b2)]['count']({'where':{'shopId':_0x168cf7['id'],'status':_0xe4e5a0(0x16a),'gateway':{'not':_0xe4e5a0(0x187)}}}),database_1['default'][_0xe4e5a0(0x1b2)][_0xe4e5a0(0x1b9)]({'where':{'shopId':_0x168cf7['id'],'status':_0xe4e5a0(0x16a),'gateway':{'not':_0xe4e5a0(0x187)}},'orderBy':{'paidAt':'asc'},'select':{'paidAt':!![]}}),database_1[_0xe4e5a0(0x195)]['payment']['groupBy']({'by':[_0xe4e5a0(0x179)],'where':{'shopId':_0x168cf7['id'],'status':'PAID','gateway':{'not':_0xe4e5a0(0x187)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x3d0f29=new Date(),_0x417f67=new Date(_0x3d0f29[_0xe4e5a0(0x1c9)](),_0x3d0f29[_0xe4e5a0(0x141)](),0x1),_0x45c4f7=new Date(_0x3d0f29[_0xe4e5a0(0x1c9)](),_0x3d0f29[_0xe4e5a0(0x141)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x69c664,_0x45f4d3]=await Promise[_0xe4e5a0(0x1f9)]([database_1[_0xe4e5a0(0x195)][_0xe4e5a0(0x181)][_0xe4e5a0(0x130)]({'_sum':{'amount':!![]},'where':{'shopId':_0x168cf7['id'],'status':_0xe4e5a0(0x1f1)}}),database_1[_0xe4e5a0(0x195)][_0xe4e5a0(0x181)][_0xe4e5a0(0x130)]({'_sum':{'amount':!![]},'where':{'shopId':_0x168cf7['id'],'status':_0xe4e5a0(0x1f1),'createdAt':{'gte':_0x417f67,'lte':_0x45c4f7}}})]),_0x4295b7=_0x69c664[_0xe4e5a0(0x1a4)][_0xe4e5a0(0x125)]||0x0,_0x3e400b=_0x45f4d3['_sum'][_0xe4e5a0(0x125)]||0x0,_0xcd5e03=await Promise[_0xe4e5a0(0x1f9)](_0x41b343[_0xe4e5a0(0xf1)](async _0x3c5946=>{const _0x312c1f=_0xe4e5a0;let _0x4e8999=0xa;if(_0x168cf7[_0x312c1f(0x165)])try{const _0x53d722=JSON[_0x312c1f(0x11b)](_0x168cf7['gatewaySettings']);for(const [_0xa24f89,_0x2a8f42]of Object['entries'](_0x53d722)){if(_0xa24f89['toLowerCase']()===_0x3c5946[_0x312c1f(0x179)]['toLowerCase']()){_0x4e8999=_0x2a8f42[_0x312c1f(0x1ea)]||0xa,console[_0x312c1f(0x1d1)](_0x312c1f(0xf4)+_0x3c5946[_0x312c1f(0x179)]+_0x312c1f(0x152)+_0x168cf7['id']+':\x20commission\x20=\x20'+_0x4e8999+'%');break;}}}catch(_0x4f5332){console[_0x312c1f(0x177)](_0x312c1f(0x1b7)+_0x168cf7['id']+':',_0x4f5332);}const _0x2fabf9=_0x3c5946['_sum'][_0x312c1f(0x161)]||0x0,_0x5960a1=_0x2fabf9*(0x1-_0x4e8999/0x64);return{'gateway':_0x3c5946['gateway'],'count':_0x3c5946[_0x312c1f(0x110)]['id'],'amountUSDT':Math[_0x312c1f(0x150)](_0x2fabf9*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x312c1f(0x150)](_0x5960a1*0x64)/0x64,'commission':_0x4e8999};})),_0xda9fdc=_0xcd5e03['reduce']((_0x1343db,_0x122d0e)=>_0x1343db+_0x122d0e[_0xe4e5a0(0x161)],0x0),_0x1d2e6f=_0x168cf7[_0xe4e5a0(0x104)];return console[_0xe4e5a0(0x1d1)](_0xe4e5a0(0x10a)+_0x168cf7[_0xe4e5a0(0x1fd)]+':'),console[_0xe4e5a0(0x1d1)](_0xe4e5a0(0x18c)+_0xda9fdc[_0xe4e5a0(0x193)](0x2)+'\x20USDT\x20(gross\x20revenue)'),console[_0xe4e5a0(0x1d1)](_0xe4e5a0(0x1fa)+_0xcd5e03['reduce']((_0x728510,_0x440152)=>_0x728510+_0x440152['amountAfterCommissionUSDT'],0x0)['toFixed'](0x2)+_0xe4e5a0(0xfe)),console[_0xe4e5a0(0x1d1)](_0xe4e5a0(0xe2)+_0x1d2e6f[_0xe4e5a0(0x193)](0x2)+'\x20USDT\x20(after\x20payouts)'),{'id':_0x168cf7['id'],'fullName':_0x168cf7[_0xe4e5a0(0x140)],'username':_0x168cf7['username'],'telegramId':_0x168cf7[_0xe4e5a0(0x139)],'merchantUrl':_0x168cf7[_0xe4e5a0(0x18e)],'wallets':{'usdtPolygonWallet':_0x168cf7[_0xe4e5a0(0x1de)],'usdtTrcWallet':_0x168cf7[_0xe4e5a0(0x1ff)],'usdtErcWallet':_0x168cf7[_0xe4e5a0(0x149)],'usdcPolygonWallet':_0x168cf7[_0xe4e5a0(0x1a9)]},'totalAmountUSDT':Math[_0xe4e5a0(0x150)](_0xda9fdc*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0xe4e5a0(0x150)](_0x1d2e6f*0x64)/0x64,'totalPayout':Math[_0xe4e5a0(0x150)](_0x4295b7*0x64)/0x64,'thisMonth':Math['round'](_0x3e400b*0x64)/0x64,'paymentsCount':_0x374723,'oldestPaymentDate':_0x23f819?.['paidAt']||_0x168cf7[_0xe4e5a0(0x1e6)],'gatewayBreakdown':_0xcd5e03};})),_0x237d0c=_0x2c99f4[_0x1c96ff(0x1b5)]((_0xc78f79,_0x56d5f9)=>_0xc78f79+_0x56d5f9[_0x1c96ff(0x19b)],0x0),_0x2165df=_0x2c99f4[_0x1c96ff(0x1b5)]((_0x4e534f,_0x19de22)=>_0x4e534f+_0x19de22[_0x1c96ff(0x133)],0x0),_0x5added=_0x2c99f4[_0x1c96ff(0x1b5)]((_0x150f57,_0x51b327)=>_0x150f57+_0x51b327[_0x1c96ff(0x1bc)],0x0),_0x34b050=_0x2c99f4[_0x1c96ff(0x1b5)]((_0x2ec3de,_0x44e3b2)=>_0x2ec3de+_0x44e3b2['thisMonth'],0x0);return console['log'](_0x1c96ff(0x10f)+_0x48a18f+_0x1c96ff(0x15b)),console[_0x1c96ff(0x1d1)](_0x1c96ff(0x142)+Math[_0x1c96ff(0x150)](_0x237d0c*0x64)/0x64+'\x20USDT\x20(gross\x20revenue)'),console[_0x1c96ff(0x1d1)]('\x20\x20\x20✅\x20Total\x20available\x20for\x20payout:\x20'+Math[_0x1c96ff(0x150)](_0x2165df*0x64)/0x64+_0x1c96ff(0x114)),console[_0x1c96ff(0x1d1)](_0x1c96ff(0x1e2)+Math[_0x1c96ff(0x150)](_0x5added*0x64)/0x64+_0x1c96ff(0x17f)),console[_0x1c96ff(0x1d1)](_0x1c96ff(0x17c)+Math[_0x1c96ff(0x150)](_0x34b050*0x64)/0x64+'\x20USDT'),{'merchants':_0x2c99f4,'pagination':{'page':_0x46bcf0,'limit':_0x566acf,'total':_0x48a18f,'totalPages':Math['ceil'](_0x48a18f/_0x566acf)},'summary':{'totalMerchants':_0x48a18f,'totalAmountUSDT':Math['round'](_0x237d0c*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x1c96ff(0x150)](_0x2165df*0x64)/0x64,'totalPayout':Math['round'](_0x5added*0x64)/0x64,'thisMonth':Math[_0x1c96ff(0x150)](_0x34b050*0x64)/0x64}};}async[a35_0x16c276(0x1d2)](_0x2a4d2f){const _0x377b1e=a35_0x16c276,{shopId:_0x1d0e23,amount:_0x2d5598,network:_0x2a2b60,wallet:_0x58001e,notes:_0x5e890c,txid:_0x30d9e7,periodFrom:_0x265d7d,periodTo:_0x5aa22b}=_0x2a4d2f,_0x2fa937=await database_1['default']['$transaction'](async _0x382b34=>{const _0x29b77d=a35_0x2347,_0x299af3=await _0x382b34[_0x29b77d(0x170)][_0x29b77d(0x13c)]({'where':{'id':_0x1d0e23},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x299af3)throw new Error(_0x29b77d(0x173));console['log']('💰\x20Creating\x20payout\x20for\x20shop\x20'+_0x299af3[_0x29b77d(0x1fd)]+':'),console[_0x29b77d(0x1d1)](_0x29b77d(0x182)+_0x299af3[_0x29b77d(0x104)]['toFixed'](0x6)+'\x20USDT'),console[_0x29b77d(0x1d1)](_0x29b77d(0x192)+_0x2d5598['toFixed'](0x6)+'\x20USDT'),console[_0x29b77d(0x1d1)](_0x29b77d(0x148)+_0x299af3['totalPaidOut']['toFixed'](0x6)+_0x29b77d(0x17f));if(_0x30d9e7)console[_0x29b77d(0x1d1)](_0x29b77d(0xe6)+_0x30d9e7);if(_0x299af3[_0x29b77d(0x104)]<_0x2d5598)throw new Error(_0x29b77d(0x190)+_0x299af3[_0x29b77d(0x104)][_0x29b77d(0x193)](0x6)+'\x20USDT,\x20Requested:\x20'+_0x2d5598['toFixed'](0x6)+_0x29b77d(0x17f));let _0x3530f2=_0x58001e;if(!_0x3530f2){const _0x160805=await _0x382b34['shop'][_0x29b77d(0x13c)]({'where':{'id':_0x1d0e23},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x160805)switch(_0x2a2b60){case _0x29b77d(0xde):_0x3530f2=_0x160805[_0x29b77d(0x1de)]||undefined;break;case _0x29b77d(0x184):_0x3530f2=_0x160805['usdtTrcWallet']||undefined;break;case'erc20':_0x3530f2=_0x160805[_0x29b77d(0x149)]||undefined;break;case _0x29b77d(0x124):_0x3530f2=_0x160805['usdcPolygonWallet']||undefined;break;}}console[_0x29b77d(0x1d1)]('💳\x20Payout\x20wallet\x20for\x20'+_0x2a2b60+':\x20'+(_0x3530f2||_0x29b77d(0x168)));const _0x5cdc0f=await _0x382b34[_0x29b77d(0x181)][_0x29b77d(0x12f)]({'data':{'shopId':_0x1d0e23,'amount':_0x2d5598,'network':_0x2a2b60,'status':_0x29b77d(0x1f1),'txid':_0x30d9e7,'notes':_0x5e890c,'periodFrom':_0x265d7d?new Date(_0x265d7d):null,'periodTo':_0x5aa22b?new Date(_0x5aa22b):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x4d31c2=_0x299af3['balance']-_0x2d5598,_0x5e4ecc=_0x299af3[_0x29b77d(0x131)]+_0x2d5598;return await _0x382b34['shop']['update']({'where':{'id':_0x1d0e23},'data':{'balance':_0x4d31c2,'totalPaidOut':_0x5e4ecc}}),console[_0x29b77d(0x1d1)](_0x29b77d(0x14c)+_0x299af3['username']+_0x29b77d(0x1d0)),console[_0x29b77d(0x1d1)](_0x29b77d(0x1ac)+_0x299af3[_0x29b77d(0x104)][_0x29b77d(0x193)](0x6)+_0x29b77d(0x1d3)+_0x4d31c2[_0x29b77d(0x193)](0x6)+'\x20USDT\x20(-'+_0x2d5598[_0x29b77d(0x193)](0x6)+')'),console[_0x29b77d(0x1d1)](_0x29b77d(0xf8)+_0x299af3[_0x29b77d(0x131)]['toFixed'](0x6)+_0x29b77d(0x1d3)+_0x5e4ecc[_0x29b77d(0x193)](0x6)+'\x20USDT\x20(+'+_0x2d5598['toFixed'](0x6)+')'),{'payout':_0x5cdc0f,'shop':_0x299af3};});return console[_0x377b1e(0x1d1)](_0x377b1e(0x175)+_0x2fa937[_0x377b1e(0x181)]['id']+_0x377b1e(0x152)+_0x2fa937[_0x377b1e(0x170)][_0x377b1e(0x1fd)]+'\x20('+_0x2d5598+_0x377b1e(0x178)),{'id':_0x2fa937['payout']['id'],'shopId':_0x2fa937['payout'][_0x377b1e(0x1f8)],'shopName':_0x2fa937[_0x377b1e(0x170)][_0x377b1e(0x140)],'shopUsername':_0x2fa937[_0x377b1e(0x170)]['username'],'amount':_0x2fa937[_0x377b1e(0x181)][_0x377b1e(0x125)],'network':_0x2fa937[_0x377b1e(0x181)]['network'],'status':_0x2fa937['payout'][_0x377b1e(0x126)],'txid':_0x2fa937[_0x377b1e(0x181)]['txid'],'notes':_0x2fa937['payout'][_0x377b1e(0x17d)],'periodFrom':_0x2fa937[_0x377b1e(0x181)][_0x377b1e(0x111)],'periodTo':_0x2fa937[_0x377b1e(0x181)]['periodTo'],'createdAt':_0x2fa937['payout'][_0x377b1e(0x1e6)],'paidAt':_0x2fa937['payout'][_0x377b1e(0x1a1)]};}async[a35_0x16c276(0x157)](_0x33da78){const _0x58a36e=a35_0x16c276,{page:_0x561a79,limit:_0x330df1,shopId:_0x429750,network:_0x486984,dateFrom:_0x20c2c7,dateTo:_0x53e85c,search:_0x3ff9c0}=_0x33da78,_0x3d13fe=(_0x561a79-0x1)*_0x330df1,_0x36a633={};_0x429750&&(_0x36a633[_0x58a36e(0x1f8)]=_0x429750);_0x486984&&(_0x36a633['network']=_0x486984);(_0x20c2c7||_0x53e85c)&&(_0x36a633[_0x58a36e(0x1e6)]={},_0x20c2c7&&(_0x36a633[_0x58a36e(0x1e6)][_0x58a36e(0x17e)]=new Date(_0x20c2c7)),_0x53e85c&&(_0x36a633[_0x58a36e(0x1e6)][_0x58a36e(0x102)]=new Date(_0x53e85c)));_0x3ff9c0&&(_0x36a633['OR']=[{'shop':{'name':{'contains':_0x3ff9c0,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x3ff9c0,'mode':'insensitive'}}},{'notes':{'contains':_0x3ff9c0,'mode':_0x58a36e(0xfa)}}]);const [_0x305e92,_0x1ed72d]=await Promise[_0x58a36e(0x1f9)]([database_1[_0x58a36e(0x195)][_0x58a36e(0x181)][_0x58a36e(0x17a)]({'where':_0x36a633,'skip':_0x3d13fe,'take':_0x330df1,'orderBy':{'createdAt':_0x58a36e(0x136)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x58a36e(0x195)][_0x58a36e(0x181)]['count']({'where':_0x36a633})]);return{'payouts':_0x305e92[_0x58a36e(0xf1)](_0x27acb2=>({'id':_0x27acb2['id'],'shopId':_0x27acb2[_0x58a36e(0x1f8)],'shopName':_0x27acb2[_0x58a36e(0x170)]['name'],'shopUsername':_0x27acb2['shop']['username'],'amount':_0x27acb2[_0x58a36e(0x125)],'network':_0x27acb2[_0x58a36e(0x147)],'status':_0x27acb2['status'],'txid':_0x27acb2[_0x58a36e(0x1f7)],'notes':_0x27acb2[_0x58a36e(0x17d)],'periodFrom':_0x27acb2['periodFrom'],'periodTo':_0x27acb2[_0x58a36e(0x1d9)],'createdAt':_0x27acb2['createdAt'],'paidAt':_0x27acb2['paidAt']})),'pagination':{'page':_0x561a79,'limit':_0x330df1,'total':_0x1ed72d,'totalPages':Math[_0x58a36e(0x203)](_0x1ed72d/_0x330df1)}};}async[a35_0x16c276(0x18f)](_0x5c09d2){const _0x2f5337=a35_0x16c276,_0x227832=await database_1[_0x2f5337(0x195)][_0x2f5337(0x181)][_0x2f5337(0x13c)]({'where':{'id':_0x5c09d2},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x227832)return null;return{'id':_0x227832['id'],'shopId':_0x227832['shopId'],'shopName':_0x227832[_0x2f5337(0x170)][_0x2f5337(0x140)],'shopUsername':_0x227832[_0x2f5337(0x170)][_0x2f5337(0x1fd)],'amount':_0x227832[_0x2f5337(0x125)],'network':_0x227832[_0x2f5337(0x147)],'status':_0x227832[_0x2f5337(0x126)],'txid':_0x227832[_0x2f5337(0x1f7)],'notes':_0x227832['notes'],'periodFrom':_0x227832[_0x2f5337(0x111)],'periodTo':_0x227832[_0x2f5337(0x1d9)],'createdAt':_0x227832[_0x2f5337(0x1e6)],'paidAt':_0x227832[_0x2f5337(0x1a1)]};}async['deletePayout'](_0x2b9494){const _0x22909d=a35_0x16c276;await database_1['default'][_0x22909d(0x181)]['delete']({'where':{'id':_0x2b9494}});}async[a35_0x16c276(0x1f4)](_0x442e53){const _0x541092=a35_0x16c276,{page:_0x2aecf0,limit:_0x4e03d5,status:_0x584fb6,gateway:_0x259415,shopId:_0x18abb0,dateFrom:_0x4dae15,dateTo:_0x12c108,search:_0x5a6a3f,currency:_0x4224b3,sortBy:_0x198acc,sortOrder:_0x568c72}=_0x442e53,_0x1bb2d6=(_0x2aecf0-0x1)*_0x4e03d5;console[_0x541092(0x1d1)](_0x541092(0x160),_0x442e53);const _0x587ca0=await database_1[_0x541092(0x195)]['payment'][_0x541092(0x15e)]({'by':['gateway'],'_count':{'gateway':!![]}});console[_0x541092(0x1d1)]('📊\x20Available\x20gateways\x20in\x20database:',_0x587ca0[_0x541092(0xf1)](_0x51add8=>_0x51add8['gateway']+'\x20('+_0x51add8[_0x541092(0x110)][_0x541092(0x179)]+'\x20payments)'));if(_0x259415){const _0x14666b=_0x587ca0['some'](_0x3fb46d=>_0x3fb46d[_0x541092(0x179)][_0x541092(0x1f6)]()===_0x259415[_0x541092(0x1f6)]());!_0x14666b&&_0x259415[_0x541092(0x1f6)]()!==_0x541092(0x187)&&console[_0x541092(0x1d1)]('⚠️\x20Requested\x20gateway\x20\x27'+_0x259415+'\x27\x20not\x20found.\x20Available\x20gateways:\x20'+_0x587ca0[_0x541092(0xf1)](_0x32d839=>_0x32d839['gateway'])[_0x541092(0x169)](',\x20'));}const _0xa158b1={};_0x584fb6&&(_0xa158b1[_0x541092(0x126)]=_0x584fb6[_0x541092(0x10c)]());if(!_0x259415)_0xa158b1[_0x541092(0x179)]={'not':_0x541092(0x187)};else{if(_0x259415&&(_0x259415[_0x541092(0x1f6)]()===_0x541092(0x187)||_0x259415===_0x541092(0x151)))_0xa158b1[_0x541092(0x179)]=_0x541092(0x187);else{let _0x26e126=_0x259415;const _0x4f46a9=(0x0,gateway_1[_0x541092(0xf0)])(_0x259415);if(_0x4f46a9)_0x26e126=_0x4f46a9,console[_0x541092(0x1d1)](_0x541092(0x172)+_0x259415+'\x27\x20to\x20name\x20\x27'+_0x26e126+'\x27');else{const _0x213613=(0x0,gateway_1[_0x541092(0x127)])(_0x259415);if(_0x213613){const _0x1adf1f=(0x0,gateway_1[_0x541092(0xf0)])(_0x213613);_0x1adf1f&&(_0x26e126=_0x1adf1f,console['log'](_0x541092(0xfd)+_0x259415+_0x541092(0x1cd)+_0x213613+'\x27\x20->\x20name\x20\x27'+_0x26e126+'\x27'));}else console[_0x541092(0x1d1)]('🔍\x20Using\x20gateway\x20\x27'+_0x259415+_0x541092(0x14b));}const _0x516516=await database_1[_0x541092(0x195)][_0x541092(0x1b2)]['count']({'where':{'gateway':_0x26e126[_0x541092(0x1f6)]()},'take':0x1});_0x516516===0x0?(console[_0x541092(0x1d1)](_0x541092(0x194)+_0x26e126+'\x27\x20(from\x20\x27'+_0x259415+_0x541092(0x196)),_0xa158b1[_0x541092(0x179)]=_0x541092(0xda)):(_0xa158b1[_0x541092(0x179)]=_0x26e126['toLowerCase'](),console['log'](_0x541092(0x185)+_0x26e126+_0x541092(0x115)+_0x259415+'\x27)'));}}console[_0x541092(0x1d1)](_0x541092(0x154),_0xa158b1[_0x541092(0x179)]);_0x18abb0&&(_0xa158b1[_0x541092(0x1f8)]=_0x18abb0);_0x4224b3&&(_0xa158b1[_0x541092(0x108)]=_0x4224b3[_0x541092(0x10c)](),console[_0x541092(0x1d1)](_0x541092(0x117)+_0x4224b3[_0x541092(0x10c)]()));(_0x4dae15||_0x12c108)&&(_0xa158b1[_0x541092(0x1e6)]={},_0x4dae15&&(_0xa158b1[_0x541092(0x1e6)]['gte']=new Date(_0x4dae15)),_0x12c108&&(_0xa158b1[_0x541092(0x1e6)][_0x541092(0x102)]=new Date(_0x12c108)));_0x5a6a3f&&(_0xa158b1['OR']=[{'id':{'contains':_0x5a6a3f,'mode':_0x541092(0xfa)}},{'orderId':{'contains':_0x5a6a3f,'mode':_0x541092(0xfa)}},{'gatewayOrderId':{'contains':_0x5a6a3f,'mode':_0x541092(0xfa)}},{'customerEmail':{'contains':_0x5a6a3f,'mode':_0x541092(0xfa)}},{'shop':{'name':{'contains':_0x5a6a3f,'mode':_0x541092(0xfa)}}},{'shop':{'username':{'contains':_0x5a6a3f,'mode':_0x541092(0xfa)}}}]);console['log'](_0x541092(0x137),JSON[_0x541092(0x1ca)](_0xa158b1,null,0x2));let _0x4b4675={'createdAt':_0x541092(0x136)};if(_0x198acc){const _0x49054a=[_0x541092(0x125),_0x541092(0x1e6),'updatedAt',_0x541092(0x126),_0x541092(0x179),_0x541092(0x108)],_0x366ff5=[_0x541092(0x1c8),_0x541092(0x136)];if(_0x49054a[_0x541092(0x1a2)](_0x198acc)){const _0x139c69=_0x366ff5['includes'](_0x568c72)?_0x568c72:_0x541092(0x136);_0x4b4675={[_0x198acc]:_0x139c69},console['log'](_0x541092(0x1cb)+_0x198acc+'\x20in\x20'+_0x139c69+'\x20order');}}const [_0x399d8b,_0xc4ce30]=await Promise['all']([database_1[_0x541092(0x195)]['payment'][_0x541092(0x17a)]({'where':_0xa158b1,'skip':_0x1bb2d6,'take':_0x4e03d5,'orderBy':_0x4b4675,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x541092(0x195)][_0x541092(0x1b2)][_0x541092(0x128)]({'where':_0xa158b1})]);return{'payments':_0x399d8b,'pagination':{'page':_0x2aecf0,'limit':_0x4e03d5,'total':_0xc4ce30,'totalPages':Math['ceil'](_0xc4ce30/_0x4e03d5)}};}async['getPaymentById'](_0x3e8acd){const _0x1c8221=a35_0x16c276,_0x5e5ae1=await database_1['default'][_0x1c8221(0x1b2)]['findUnique']({'where':{'id':_0x3e8acd},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x5e5ae1)return null;return{'id':_0x5e5ae1['id'],'shopId':_0x5e5ae1['shopId'],'gateway':_0x5e5ae1[_0x1c8221(0x179)],'amount':_0x5e5ae1[_0x1c8221(0x125)],'currency':_0x5e5ae1[_0x1c8221(0x108)],'status':_0x5e5ae1[_0x1c8221(0x126)],'orderId':_0x5e5ae1[_0x1c8221(0x1c1)],'gatewayOrderId':_0x5e5ae1[_0x1c8221(0xf5)],'customerEmail':_0x5e5ae1[_0x1c8221(0x1cc)],'customerName':_0x5e5ae1[_0x1c8221(0xf7)],'customerCountry':_0x5e5ae1['customerCountry'],'customerIp':_0x5e5ae1[_0x1c8221(0xeb)],'customerUa':_0x5e5ae1['customerUa'],'failureMessage':_0x5e5ae1[_0x1c8221(0x1ad)],'externalPaymentUrl':_0x5e5ae1[_0x1c8221(0x1a5)],'successUrl':_0x5e5ae1[_0x1c8221(0x191)],'failUrl':_0x5e5ae1[_0x1c8221(0x143)],'pendingUrl':_0x5e5ae1[_0x1c8221(0x116)],'whiteUrl':_0x5e5ae1[_0x1c8221(0x164)],'createdAt':_0x5e5ae1[_0x1c8221(0x1e6)],'updatedAt':_0x5e5ae1[_0x1c8221(0x12b)],'shop':_0x5e5ae1[_0x1c8221(0x170)]};}async[a35_0x16c276(0x202)](_0x331692,_0x170d1c,_0x28588d,_0x5e03a3){const _0x48a49c=a35_0x16c276,_0x11a5e0=await database_1['default'][_0x48a49c(0x11e)](async _0x13cef8=>{const _0x3bf115=_0x48a49c,_0x59c6c9=await _0x13cef8['payment']['findUnique']({'where':{'id':_0x331692},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x59c6c9)throw new Error(_0x3bf115(0x167));const _0x1aa205=_0x59c6c9['status'],_0x5412c4=_0x170d1c[_0x3bf115(0x10c)]();console[_0x3bf115(0x1d1)](_0x3bf115(0x1e9)+_0x331692+_0x3bf115(0x1c4)+_0x1aa205+_0x3bf115(0x1d3)+_0x5412c4),console[_0x3bf115(0x1d1)](_0x3bf115(0x1c0)+_0x59c6c9[_0x3bf115(0x170)][_0x3bf115(0x104)]+_0x3bf115(0x17f));const _0x5dafa5={'status':_0x5412c4,'updatedAt':new Date(),'statusChangedBy':'admin','statusChangedAt':new Date()};_0x28588d&&(_0x5dafa5[_0x3bf115(0x1f0)]=_0x28588d);_0x5412c4==='CHARGEBACK'&&_0x5e03a3&&(_0x5dafa5[_0x3bf115(0x1b1)]=_0x5e03a3);let _0x2e5821=0x0,_0x17ef74=_0x59c6c9[_0x3bf115(0x170)]['balance'];if(_0x5412c4===_0x3bf115(0x16a)&&_0x1aa205!==_0x3bf115(0x16a)){_0x5dafa5[_0x3bf115(0x1a1)]=new Date();const _0x4c246c=await currencyService_1[_0x3bf115(0x12c)][_0x3bf115(0x106)](_0x59c6c9[_0x3bf115(0x125)],_0x59c6c9[_0x3bf115(0x108)]);_0x5dafa5[_0x3bf115(0x161)]=_0x4c246c;let _0x437db9=0xa;const _0x328b3a=await _0x13cef8[_0x3bf115(0x170)][_0x3bf115(0x13c)]({'where':{'id':_0x59c6c9[_0x3bf115(0x1f8)]},'select':{'gatewaySettings':!![]}});if(_0x328b3a?.['gatewaySettings'])try{const _0x47586b=JSON[_0x3bf115(0x11b)](_0x328b3a[_0x3bf115(0x165)]);for(const [_0x21be43,_0x2dfbd3]of Object['entries'](_0x47586b)){if(_0x21be43[_0x3bf115(0x1f6)]()===_0x59c6c9['gateway'][_0x3bf115(0x1f6)]()){_0x437db9=_0x2dfbd3[_0x3bf115(0x1ea)]||0xa;break;}}}catch(_0x27d8e9){console[_0x3bf115(0x177)](_0x3bf115(0x1e5)+_0x331692+':',_0x27d8e9);}const _0x14d2cc=_0x4c246c*(0x1-_0x437db9/0x64);_0x2e5821=_0x14d2cc,_0x17ef74+=_0x14d2cc,console[_0x3bf115(0x1d1)](_0x3bf115(0x18d)+_0x331692+_0x3bf115(0x1a6)),console[_0x3bf115(0x1d1)]('\x20\x20\x20Full\x20amount:\x20'+_0x4c246c['toFixed'](0x6)+_0x3bf115(0x17f)),console[_0x3bf115(0x1d1)](_0x3bf115(0x1fb)+_0x59c6c9[_0x3bf115(0x179)]+_0x3bf115(0x176)+_0x437db9+'%'),console['log'](_0x3bf115(0xfb)+_0x14d2cc[_0x3bf115(0x193)](0x6)+_0x3bf115(0x12a)+_0x437db9+_0x3bf115(0x204)),console['log']('\x20\x20\x20Added\x20to\x20balance:\x20+'+_0x14d2cc[_0x3bf115(0x193)](0x6)+'\x20USDT');}else{if(_0x1aa205==='PAID'&&_0x5412c4!==_0x3bf115(0x16a)){if(_0x59c6c9[_0x3bf115(0x161)]){let _0x2500fa=0xa;const _0x3c64ce=await _0x13cef8['shop'][_0x3bf115(0x13c)]({'where':{'id':_0x59c6c9['shopId']},'select':{'gatewaySettings':!![]}});if(_0x3c64ce?.[_0x3bf115(0x165)])try{const _0x2545be=JSON['parse'](_0x3c64ce[_0x3bf115(0x165)]);for(const [_0x2169c6,_0x41c1ca]of Object[_0x3bf115(0xe4)](_0x2545be)){if(_0x2169c6['toLowerCase']()===_0x59c6c9[_0x3bf115(0x179)][_0x3bf115(0x1f6)]()){_0x2500fa=_0x41c1ca[_0x3bf115(0x1ea)]||0xa;break;}}}catch(_0x1b45d7){console[_0x3bf115(0x177)](_0x3bf115(0x1e5)+_0x331692+':',_0x1b45d7);}const _0x25f8ea=_0x59c6c9[_0x3bf115(0x161)]*(0x1-_0x2500fa/0x64);_0x2e5821=-_0x25f8ea,_0x17ef74-=_0x25f8ea,_0x5dafa5[_0x3bf115(0x161)]=null,console[_0x3bf115(0x1d1)](_0x3bf115(0x18d)+_0x331692+_0x3bf115(0x19d)),console[_0x3bf115(0x1d1)](_0x3bf115(0xdf)+_0x59c6c9[_0x3bf115(0x161)][_0x3bf115(0x193)](0x6)+_0x3bf115(0x17f)),console[_0x3bf115(0x1d1)]('\x20\x20\x20Gateway:\x20'+_0x59c6c9[_0x3bf115(0x179)]+_0x3bf115(0x176)+_0x2500fa+'%'),console[_0x3bf115(0x1d1)](_0x3bf115(0x1ec)+_0x25f8ea['toFixed'](0x6)+_0x3bf115(0x12a)+_0x2500fa+_0x3bf115(0x204)),console[_0x3bf115(0x1d1)](_0x3bf115(0x146)+_0x25f8ea[_0x3bf115(0x193)](0x6)+_0x3bf115(0x17f));}}}_0x5412c4===_0x3bf115(0x1bf)&&(_0x1aa205===_0x3bf115(0x16a)&&_0x59c6c9[_0x3bf115(0x161)]&&console['log'](_0x3bf115(0x19c)),_0x5e03a3&&_0x5e03a3>0x0&&(_0x2e5821-=_0x5e03a3,_0x17ef74-=_0x5e03a3,console['log']('💸\x20CHARGEBACK\x20penalty:\x20-'+_0x5e03a3['toFixed'](0x6)+'\x20USDT\x20from\x20balance')));_0x5412c4===_0x3bf115(0x1fc)&&_0x1aa205===_0x3bf115(0x16a)&&console['log'](_0x3bf115(0x14f));const _0x4fd4e5=await _0x13cef8[_0x3bf115(0x1b2)][_0x3bf115(0x155)]({'where':{'id':_0x331692},'data':_0x5dafa5,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x2e5821!==0x0&&(await _0x13cef8[_0x3bf115(0x170)]['update']({'where':{'id':_0x59c6c9[_0x3bf115(0x1f8)]},'data':{'balance':_0x17ef74}}),console[_0x3bf115(0x1d1)](_0x3bf115(0x14c)+_0x59c6c9['shopId']+_0x3bf115(0x13a)+_0x59c6c9[_0x3bf115(0x170)][_0x3bf115(0x104)][_0x3bf115(0x193)](0x6)+_0x3bf115(0x1d3)+_0x17ef74[_0x3bf115(0x193)](0x6)+_0x3bf115(0xe0)+(_0x2e5821>0x0?'+':'')+_0x2e5821[_0x3bf115(0x193)](0x6)+')')),_0x4fd4e5;});return{'id':_0x11a5e0['id'],'shopId':_0x11a5e0[_0x48a49c(0x1f8)],'gateway':_0x11a5e0[_0x48a49c(0x179)],'amount':_0x11a5e0[_0x48a49c(0x125)],'currency':_0x11a5e0[_0x48a49c(0x108)],'status':_0x11a5e0[_0x48a49c(0x126)],'orderId':_0x11a5e0[_0x48a49c(0x1c1)],'gatewayOrderId':_0x11a5e0['gatewayOrderId'],'customerEmail':_0x11a5e0[_0x48a49c(0x1cc)],'customerName':_0x11a5e0['customerName'],'customerCountry':_0x11a5e0[_0x48a49c(0xe8)],'customerIp':_0x11a5e0['customerIp'],'customerUa':_0x11a5e0['customerUa'],'failureMessage':_0x11a5e0[_0x48a49c(0x1ad)],'adminNotes':_0x11a5e0[_0x48a49c(0x1f0)],'chargebackAmount':_0x11a5e0[_0x48a49c(0x1b1)],'statusChangedBy':_0x11a5e0[_0x48a49c(0x162)],'statusChangedAt':_0x11a5e0[_0x48a49c(0x1ce)],'createdAt':_0x11a5e0[_0x48a49c(0x1e6)],'updatedAt':_0x11a5e0[_0x48a49c(0x12b)],'shop':_0x11a5e0['shop']};}async[a35_0x16c276(0x123)](_0x41d80e,_0x4678ad){const _0x1aef68=a35_0x16c276,_0x4217b2={..._0x4678ad};_0x4678ad['password']&&(_0x4217b2[_0x1aef68(0x1be)]=await bcryptjs_1[_0x1aef68(0x195)][_0x1aef68(0x19e)](_0x4678ad['password'],0xc));_0x4678ad['fullName']&&(_0x4217b2['name']=_0x4678ad[_0x1aef68(0x200)],delete _0x4217b2[_0x1aef68(0x200)]);_0x4678ad[_0x1aef68(0x14a)]&&(_0x4217b2[_0x1aef68(0x139)]=_0x4678ad[_0x1aef68(0x14a)],delete _0x4217b2['telegramId']);_0x4678ad['merchantUrl']&&(_0x4217b2['shopUrl']=_0x4678ad[_0x1aef68(0x197)],delete _0x4217b2[_0x1aef68(0x197)]);if(_0x4678ad[_0x1aef68(0x129)]){const _0x56cfea=_0x4678ad[_0x1aef68(0x129)][_0x1aef68(0xf1)](_0xdbc8ba=>this[_0x1aef68(0xec)](_0xdbc8ba));console[_0x1aef68(0x1d1)](_0x1aef68(0x11a),_0x4678ad['gateways'],'->',_0x56cfea),_0x4217b2[_0x1aef68(0x1d5)]=JSON['stringify'](_0x56cfea),delete _0x4217b2[_0x1aef68(0x129)];}_0x4678ad[_0x1aef68(0x165)]&&(_0x4217b2[_0x1aef68(0x165)]=JSON[_0x1aef68(0x1ca)](_0x4678ad['gatewaySettings']),delete _0x4217b2[_0x1aef68(0x165)]);_0x4678ad['wallets']&&(_0x4678ad['wallets'][_0x1aef68(0x1de)]!==undefined&&(_0x4217b2[_0x1aef68(0x1de)]=_0x4678ad[_0x1aef68(0xf2)]['usdtPolygonWallet']||null),_0x4678ad['wallets'][_0x1aef68(0x1ff)]!==undefined&&(_0x4217b2[_0x1aef68(0x1ff)]=_0x4678ad[_0x1aef68(0xf2)]['usdtTrcWallet']||null),_0x4678ad[_0x1aef68(0xf2)][_0x1aef68(0x149)]!==undefined&&(_0x4217b2['usdtErcWallet']=_0x4678ad[_0x1aef68(0xf2)][_0x1aef68(0x149)]||null),_0x4678ad['wallets'][_0x1aef68(0x1a9)]!==undefined&&(_0x4217b2[_0x1aef68(0x1a9)]=_0x4678ad['wallets']['usdcPolygonWallet']||null),delete _0x4217b2[_0x1aef68(0xf2)]);const _0x56e1f3=await database_1[_0x1aef68(0x195)][_0x1aef68(0x170)][_0x1aef68(0x155)]({'where':{'id':_0x41d80e},'data':_0x4217b2,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x56e1f3['id'],'fullName':_0x56e1f3[_0x1aef68(0x140)],'username':_0x56e1f3['username'],'telegramId':_0x56e1f3[_0x1aef68(0x139)],'merchantUrl':_0x56e1f3[_0x1aef68(0x18e)],'gateways':_0x56e1f3[_0x1aef68(0x1d5)]?JSON['parse'](_0x56e1f3[_0x1aef68(0x1d5)]):null,'gatewaySettings':_0x56e1f3[_0x1aef68(0x165)]?JSON[_0x1aef68(0x11b)](_0x56e1f3['gatewaySettings']):null,'publicKey':_0x56e1f3[_0x1aef68(0x1bb)],'wallets':{'usdtPolygonWallet':_0x56e1f3[_0x1aef68(0x1de)],'usdtTrcWallet':_0x56e1f3[_0x1aef68(0x1ff)],'usdtErcWallet':_0x56e1f3[_0x1aef68(0x149)],'usdcPolygonWallet':_0x56e1f3[_0x1aef68(0x1a9)]},'status':_0x56e1f3[_0x1aef68(0x126)],'createdAt':_0x56e1f3[_0x1aef68(0x1e6)]};}async[a35_0x16c276(0x1c2)](_0x565bf3){const _0x170880=a35_0x16c276,_0x1fba21=await database_1[_0x170880(0x195)]['shop'][_0x170880(0x155)]({'where':{'id':_0x565bf3},'data':{'status':_0x170880(0x1df)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x1fba21['id'],'fullName':_0x1fba21[_0x170880(0x140)],'username':_0x1fba21[_0x170880(0x1fd)],'telegramId':_0x1fba21[_0x170880(0x139)],'merchantUrl':_0x1fba21['shopUrl'],'gateways':_0x1fba21[_0x170880(0x1d5)]?JSON[_0x170880(0x11b)](_0x1fba21['paymentGateways']):null,'gatewaySettings':_0x1fba21['gatewaySettings']?JSON[_0x170880(0x11b)](_0x1fba21[_0x170880(0x165)]):null,'publicKey':_0x1fba21[_0x170880(0x1bb)],'wallets':{'usdtPolygonWallet':_0x1fba21['usdtPolygonWallet'],'usdtTrcWallet':_0x1fba21[_0x170880(0x1ff)],'usdtErcWallet':_0x1fba21['usdtErcWallet'],'usdcPolygonWallet':_0x1fba21[_0x170880(0x1a9)]},'status':_0x1fba21['status'],'createdAt':_0x1fba21[_0x170880(0x1e6)]};}async[a35_0x16c276(0x158)](_0x11984e){const _0x3e3f9f=a35_0x16c276,_0x599dec=await database_1['default'][_0x3e3f9f(0x170)][_0x3e3f9f(0x155)]({'where':{'id':_0x11984e},'data':{'status':_0x3e3f9f(0x189)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x599dec['id'],'fullName':_0x599dec[_0x3e3f9f(0x140)],'username':_0x599dec['username'],'telegramId':_0x599dec[_0x3e3f9f(0x139)],'merchantUrl':_0x599dec['shopUrl'],'gateways':_0x599dec['paymentGateways']?JSON[_0x3e3f9f(0x11b)](_0x599dec[_0x3e3f9f(0x1d5)]):null,'gatewaySettings':_0x599dec[_0x3e3f9f(0x165)]?JSON[_0x3e3f9f(0x11b)](_0x599dec[_0x3e3f9f(0x165)]):null,'publicKey':_0x599dec['publicKey'],'wallets':{'usdtPolygonWallet':_0x599dec[_0x3e3f9f(0x1de)],'usdtTrcWallet':_0x599dec[_0x3e3f9f(0x1ff)],'usdtErcWallet':_0x599dec['usdtErcWallet'],'usdcPolygonWallet':_0x599dec[_0x3e3f9f(0x1a9)]},'status':_0x599dec[_0x3e3f9f(0x126)],'createdAt':_0x599dec[_0x3e3f9f(0x1e6)]};}async[a35_0x16c276(0x16f)](_0xb01c9d){const _0xf487b5=a35_0x16c276,{page:_0x2fe3ac,limit:_0xdac01f,status:_0x26b86d}=_0xb01c9d,_0x571b1b=(_0x2fe3ac-0x1)*_0xdac01f,_0x220d4b={};_0x26b86d&&(_0x220d4b['status']=_0x26b86d[_0xf487b5(0x10c)]());const [_0xd18146,_0x4434d4]=await Promise['all']([database_1['default'][_0xf487b5(0x170)][_0xf487b5(0x17a)]({'where':_0x220d4b,'skip':_0x571b1b,'take':_0xdac01f,'orderBy':{'createdAt':_0xf487b5(0x136)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0xf487b5(0x195)][_0xf487b5(0x170)]['count']({'where':_0x220d4b})]);return{'users':_0xd18146['map'](_0x5b94eb=>{const _0x590fce=_0xf487b5,_0x2a441c=_0x5b94eb[_0x590fce(0x1d5)]?JSON['parse'](_0x5b94eb[_0x590fce(0x1d5)]):null,_0x2dc353=_0x2a441c?_0x2a441c[_0x590fce(0xf1)](_0x49bd40=>this[_0x590fce(0x109)](_0x49bd40)):null;return{'id':_0x5b94eb['id'],'fullName':_0x5b94eb[_0x590fce(0x140)],'username':_0x5b94eb['username'],'telegramId':_0x5b94eb[_0x590fce(0x139)],'merchantUrl':_0x5b94eb[_0x590fce(0x18e)],'gateways':_0x2dc353,'gatewaySettings':_0x5b94eb[_0x590fce(0x165)]?JSON[_0x590fce(0x11b)](_0x5b94eb[_0x590fce(0x165)]):null,'publicKey':_0x5b94eb[_0x590fce(0x1bb)],'wallets':{'usdtPolygonWallet':_0x5b94eb[_0x590fce(0x1de)],'usdtTrcWallet':_0x5b94eb[_0x590fce(0x1ff)],'usdtErcWallet':_0x5b94eb[_0x590fce(0x149)],'usdcPolygonWallet':_0x5b94eb['usdcPolygonWallet']},'status':_0x5b94eb['status'],'createdAt':_0x5b94eb[_0x590fce(0x1e6)]};}),'pagination':{'page':_0x2fe3ac,'limit':_0xdac01f,'total':_0x4434d4,'totalPages':Math[_0xf487b5(0x203)](_0x4434d4/_0xdac01f)}};}async[a35_0x16c276(0xe7)](_0x2e41fc){const _0x297523=a35_0x16c276,_0x62a03e=await database_1['default'][_0x297523(0x170)]['findUnique']({'where':{'id':_0x2e41fc},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x62a03e)return null;const _0x2b36aa=_0x62a03e[_0x297523(0x1d5)]?JSON[_0x297523(0x11b)](_0x62a03e[_0x297523(0x1d5)]):null,_0x2c34db=_0x2b36aa?_0x2b36aa[_0x297523(0xf1)](_0x959680=>this[_0x297523(0x109)](_0x959680)):null;return _0x2b36aa&&_0x2c34db&&console[_0x297523(0x1d1)]('🔄\x20Gateway\x20mapping\x20(get):',_0x2b36aa,'->',_0x2c34db),{'id':_0x62a03e['id'],'fullName':_0x62a03e[_0x297523(0x140)],'username':_0x62a03e[_0x297523(0x1fd)],'telegramId':_0x62a03e[_0x297523(0x139)],'merchantUrl':_0x62a03e['shopUrl'],'gateways':_0x2c34db,'gatewaySettings':_0x62a03e[_0x297523(0x165)]?JSON[_0x297523(0x11b)](_0x62a03e[_0x297523(0x165)]):null,'publicKey':_0x62a03e[_0x297523(0x1bb)],'wallets':{'usdtPolygonWallet':_0x62a03e[_0x297523(0x1de)],'usdtTrcWallet':_0x62a03e[_0x297523(0x1ff)],'usdtErcWallet':_0x62a03e[_0x297523(0x149)],'usdcPolygonWallet':_0x62a03e[_0x297523(0x1a9)]},'status':_0x62a03e[_0x297523(0x126)],'createdAt':_0x62a03e[_0x297523(0x1e6)]};}async['createUser'](_0x2b3dc5){const _0x12b1b5=a35_0x16c276,{fullName:_0x12c9ef,username:_0x35f128,password:_0x255306,telegramId:_0x134405,merchantUrl:_0x39a946,gateways:_0x2074d8,gatewaySettings:_0x3f69a7,wallets:_0x3d3f50}=_0x2b3dc5,_0x5ad884=await database_1[_0x12b1b5(0x195)][_0x12b1b5(0x170)][_0x12b1b5(0x13c)]({'where':{'username':_0x35f128}});if(_0x5ad884)throw new Error(_0x12b1b5(0x16d));if(_0x134405){const _0x410418=await database_1[_0x12b1b5(0x195)][_0x12b1b5(0x170)]['findUnique']({'where':{'telegram':_0x134405}});if(_0x410418)throw new Error(_0x12b1b5(0x18b));}const _0xc9e786=await bcryptjs_1[_0x12b1b5(0x195)][_0x12b1b5(0x19e)](_0x255306,0xc),_0x5ab717=_0x12b1b5(0x1af)+crypto_1[_0x12b1b5(0x195)]['randomBytes'](0x20)[_0x12b1b5(0xef)](_0x12b1b5(0x1b0)),_0x3e0eea=_0x12b1b5(0x1c3)+crypto_1[_0x12b1b5(0x195)]['randomBytes'](0x20)[_0x12b1b5(0xef)](_0x12b1b5(0x1b0)),_0x16afd1=_0x2074d8?_0x2074d8[_0x12b1b5(0xf1)](_0x1418f3=>this[_0x12b1b5(0xec)](_0x1418f3)):null;_0x2074d8&&_0x16afd1&&console[_0x12b1b5(0x1d1)](_0x12b1b5(0xee),_0x2074d8,'->',_0x16afd1);const _0x16119f=await database_1[_0x12b1b5(0x195)][_0x12b1b5(0x170)][_0x12b1b5(0x12f)]({'data':{'name':_0x12c9ef,'username':_0x35f128,'password':_0xc9e786,'telegram':_0x134405,'shopUrl':_0x39a946,'paymentGateways':_0x16afd1?JSON['stringify'](_0x16afd1):null,'gatewaySettings':_0x3f69a7?JSON['stringify'](_0x3f69a7):null,'usdtPolygonWallet':_0x3d3f50?.['usdtPolygonWallet']||null,'usdtTrcWallet':_0x3d3f50?.[_0x12b1b5(0x1ff)]||null,'usdtErcWallet':_0x3d3f50?.[_0x12b1b5(0x149)]||null,'usdcPolygonWallet':_0x3d3f50?.[_0x12b1b5(0x1a9)]||null,'publicKey':_0x5ab717,'secretKey':_0x3e0eea,'status':_0x12b1b5(0x189)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x16119f['id'],'fullName':_0x16119f[_0x12b1b5(0x140)],'username':_0x16119f[_0x12b1b5(0x1fd)],'telegramId':_0x16119f['telegram'],'merchantUrl':_0x16119f['shopUrl'],'gateways':_0x16119f['paymentGateways']?JSON[_0x12b1b5(0x11b)](_0x16119f[_0x12b1b5(0x1d5)]):null,'gatewaySettings':_0x16119f[_0x12b1b5(0x165)]?JSON['parse'](_0x16119f[_0x12b1b5(0x165)]):null,'publicKey':_0x16119f['publicKey'],'wallets':{'usdtPolygonWallet':_0x16119f[_0x12b1b5(0x1de)],'usdtTrcWallet':_0x16119f['usdtTrcWallet'],'usdtErcWallet':_0x16119f[_0x12b1b5(0x149)],'usdcPolygonWallet':_0x16119f['usdcPolygonWallet']},'status':_0x16119f[_0x12b1b5(0x126)],'createdAt':_0x16119f['createdAt']};}async[a35_0x16c276(0x13b)](_0x506d40){const _0x2ef241=a35_0x16c276;await database_1[_0x2ef241(0x195)]['shop']['delete']({'where':{'id':_0x506d40}});}['generateDailyStatistics'](_0x228845,_0x1d84d1,_0xfa39a7){const _0x3dc4fd=a35_0x16c276,_0x42e26b=new Map(),_0x1a93b7=new Date(_0x1d84d1);while(_0x1a93b7<=_0xfa39a7){const _0xa7945e=_0x1a93b7[_0x3dc4fd(0x122)]()[_0x3dc4fd(0x18a)]('T')[0x0];_0x42e26b[_0x3dc4fd(0x186)](_0xa7945e,{'revenue':0x0,'count':0x0}),_0x1a93b7['setDate'](_0x1a93b7['getDate']()+0x1);}for(const _0x2d0446 of _0x228845){const _0x31f76b=_0x2d0446[_0x3dc4fd(0x1e6)][_0x3dc4fd(0x122)]()[_0x3dc4fd(0x18a)]('T')[0x0],_0x1a0f01=_0x42e26b[_0x3dc4fd(0x121)](_0x31f76b);_0x1a0f01&&(_0x1a0f01['count']+=0x1,_0x2d0446[_0x3dc4fd(0x126)]===_0x3dc4fd(0x16a)&&(_0x2d0446[_0x3dc4fd(0x161)]?_0x1a0f01['revenue']+=_0x2d0446['amountUSDT']:console[_0x3dc4fd(0x1d1)](_0x3dc4fd(0x1a7)+_0x2d0446['id']+_0x3dc4fd(0xdc))));}const _0xb9790e=[],_0x30ae73=[];for(const [_0x2d6aee,_0x69efac]of _0x42e26b){_0xb9790e[_0x3dc4fd(0x163)]({'date':_0x2d6aee,'amount':Math[_0x3dc4fd(0x150)](_0x69efac[_0x3dc4fd(0x1d7)]*0x64)/0x64}),_0x30ae73['push']({'date':_0x2d6aee,'count':_0x69efac[_0x3dc4fd(0x128)]});}return{'dailyRevenue':_0xb9790e,'dailyPayments':_0x30ae73};}}exports[a35_0x16c276(0x1c6)]=AdminService;