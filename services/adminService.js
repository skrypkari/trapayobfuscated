'use strict';const a36_0x5d61f1=a36_0x1505;function a36_0x1505(_0x3fdebb,_0x121c3a){const _0x317022=a36_0x3170();return a36_0x1505=function(_0x150557,_0x46b5f8){_0x150557=_0x150557-0x81;let _0x1536e0=_0x317022[_0x150557];return _0x1536e0;},a36_0x1505(_0x3fdebb,_0x121c3a);}(function(_0x2b0a99,_0x30281d){const _0x2ac2b4=a36_0x1505,_0x5dc72e=_0x2b0a99();while(!![]){try{const _0x50b7e8=-parseInt(_0x2ac2b4(0x107))/0x1+parseInt(_0x2ac2b4(0x118))/0x2+parseInt(_0x2ac2b4(0xcb))/0x3+parseInt(_0x2ac2b4(0x12d))/0x4*(-parseInt(_0x2ac2b4(0xfa))/0x5)+-parseInt(_0x2ac2b4(0x183))/0x6+-parseInt(_0x2ac2b4(0x1af))/0x7+parseInt(_0x2ac2b4(0x147))/0x8*(parseInt(_0x2ac2b4(0xec))/0x9);if(_0x50b7e8===_0x30281d)break;else _0x5dc72e['push'](_0x5dc72e['shift']());}catch(_0x280953){_0x5dc72e['push'](_0x5dc72e['shift']());}}}(a36_0x3170,0xd9cc6));function a36_0x3170(){const _0x53a853=[',\x20userId:\x20','üìä\x20Getting\x20merchant\x20statistics\x20with\x20filters:','klyme_eu','commissionUSDT','reduce','üìä\x20Payout\x20statistics\x20calculated:','lte','\x20\x20\x20üìÖ\x20This\x20month:\x20','90d','includes','üí≥\x20Payout\x20wallet\x20for\x20','default','getUserById','ceil','3553047BMbSQK','usdtPolygonWallet','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','totalTurnover','üí∞\x20Found\x20','getAllUsers','dailyRevenue','\x20\x20\x20Added\x20to\x20balance:\x20+','error','count','üìä\x20Sorting\x20payments\x20by\x20','\x20USDT\x20(total\x20paid\x20to\x20merchants)','\x20\x20\x20Balance:\x20','split','updateCustomerData','custom','delete','dailyPayments','successUrl','\x20merchants','\x20\x20\x20üîç\x20Calculated\x20after\x20commission:\x20','totalPayout','üí∏\x20CHARGEBACK:\x20Merchant\x20amount\x20already\x20deducted\x20from\x20balance','\x20\x20\x20üí≥\x20Total\x20payments:\x20','thisMonth','üìä\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','Insufficient\x20balance.\x20Available:\x20','shopId','\x20\x20\x20‚è≥\x20Pending\x20payout:\x20','Open\x20Banking\x202','averageCheckUSDT','year','notes','18JhAHCY','gatewayEarnings','availableBalance','üîÑ\x20Updating\x20customer\x20data\x20for\x20payment\x20','\x20\x20\x20üí∞\x20Total\x20payout:\x20','\x27\x20->\x20name\x20\x27','payment','KLYME\x20DE','PENDING','‚ö†Ô∏è\x20Requested\x20gateway\x20\x27','findUnique','admin','username','üìÖ\x20Period:\x20','5TcmIte','customerIp','customerCountry','suspendUser','turnoverUSDT','periodTo','insensitive','txid','üìä\x20Final\x20WHERE\x20conditions:','polygon_usdc','üìä\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','\x20\x20\x20üí∞\x20Total\x20payments\x20turnover:\x20','\x20\x20\x20Gateway:\x20','397258XpFpDD','network','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','\x20balance\x20updated:\x20','\x20\x20\x20ÔøΩüìä\x20Total\x20payments:\x20',',\x20successful:\x20','setDate','\x20\x20\x20‚úÖ\x20Total\x20available\x20for\x20payout:\x20','üí∞\x20[PAYOUT]\x20Merchant\x20','findMany','\x20\x20\x20Full\x20amount:\x20',',\x20Commission:\x20','üìä\x20Available\x20gateways\x20in\x20database:','\x20USDT\x20(after\x20','\x20for\x20shop\x20','\x20\x20\x20Total\x20paid\x20out:\x20','customerName','2844064SfFHzt','customerUa','update','status','getMerchantsAwaitingPayout','\x20to\x20','\x20became\x20PAID:','üìä\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','getGatewayInternalName','totalAmountUSDT','forEach','Username\x20already\x20exists','üîÑ\x20Converted\x20gateway\x20name\x20\x27','usdtErcWallet','sk_','klyme_gb','totalPaidOut','paymentsCount','gatewayOrderId','telegramId','adminNotes','1721172dzioAm','\x20in\x20',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','paymentGateways','get','\x20USDT,\x20Requested:\x20','\x20USDT\x20(theoretical\x20net)','gatewaySettings','hex','üìä\x20Gateway\x20filter\x20applied:','shop','entries','merchantUrl','bcryptjs','\x20\x20\x20üë§\x20Merchant\x20earnings:\x20','groupBy','getGatewayDisplayName','üí∞\x20Current\x20shop\x20balance:\x20','merchantEarningsUSDT','\x20USDT\x20(with\x20commission\x20deducted)','\x20USDT)','\x20\x20\x20Merchant\x20gets:\x20','\x20no\x20longer\x20PAID:','desc','dateTo','balance','8969128rNKasl','\x20USDT\x20(','totalCommissionRate','CHARGEBACK','externalPaymentUrl','commission','Rapyd','random','toFixed','password','getGatewayIdByName','getSystemStatistics','plisio','Plisio','\x20PAID\x20payments','pk_','getAllPayouts','hash','\x27\x20(from\x20\x27','üìä\x20Calculating\x20payout\x20statistics...','$transaction','üîß\x20[','\x20USDT','trim','cointopay','merchantEarnings','üîÑ\x20Admin\x20updating\x20payment\x20','statusChangedBy','ACTIVE','wallets','aggregate','REFUND','Telegram\x20username\x20already\x20exists','toISOString','periodFrom','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','values','set','name','amountAfterCommissionUSDT','create','\x20\x20\x20üí∞\x20Total\x20turnover:\x20','üîÑ\x20Gateway\x20mapping\x20(create):','Noda','failUrl','not\x20set','\x27\x20->\x20ID\x20\x27','üìÖ\x20Period\x20\x27all\x27:\x20Using\x20start\x20date\x20from\x20first\x20payment:\x20','üí∞\x20Payment\x20','\x20\x20\x20üíµ\x20Available\x20balance:\x20','%\x20from\x20','whiteUrl','round','statusChangedAt','currencyService','getPayoutById','Payment\x20not\x20found','updateUser','amountAfterGatewayCommissionUSDT','shopUrl','9628332auJyQI','üìã\x20Getting\x20merchants\x20selection\x20list...','\x20\x20\x20Payout\x20amount:\x20','currency','2020-01-01','Error\x20processing\x20payment\x20','period','\x20USDT\x20from\x20balance','\x20\x20\x20üìä\x20Commission\x20difference:\x20','\x20paid\x20payments\x20for\x20analysis','\x27\x20not\x20found.\x20Available\x20gateways:\x20','getMerchantsSelection','findFirst','üí±\x20Currency\x20filter\x20applied:\x20','\x20USDT\x20(gross\x20revenue)',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','Test\x20Gateway','orderId','defineProperty',':\x20commission\x20=\x20','gateway','‚ö†Ô∏è\x20Payment\x20','üìã\x20Found\x20','getGatewayNameById','\x20\x20\x20üìÖ\x20Total\x20payouts\x20(this\x20month):\x20','\x20USDT\x20(after\x20payouts)','‚úÖ\x20Customer\x20data\x20updated\x20for\x20payment\x20','getDate','üí∏\x20CHARGEBACK\x20penalty:\x20-','üìä\x20Merchant\x20statistics\x20calculated:','averageCommissionRate','\x20\x20\x20üåç\x20Country:\x20','revenue','paidAt','updatedAt','üéØ\x20updateUser\x20called\x20with\x20ID:\x20','noda','stringify','publicKey','COMPLETED','\x20\x20\x20‚úÖ\x20Actual\x20available\x20balance:\x20','map','totalPayments','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','10670016GxlDOY','__importDefault','paidOutUSDT','toLowerCase','chargebackAmount','\x20balance\x20updated:','getTime','getMerchantStatistics','substr','_sum','updatePaymentStatus','\x20active\x20merchants\x20for\x20selection','totalAmountAfterCommissionUSDT','üí∞\x20[PAYOUT]\x20Gateway\x20','parse','\x20\x20\x20üñ•Ô∏è\x20User\x20Agent:\x20','üîê\x20[','rapyd','toString','asc','NONEXISTENT_GATEWAY_FILTER',']\x20Gateway\x20settings\x20JSON\x20string:','createdAt','\x20USDT\x20(+','getAllPayments','gte','trc20','turnover','üîÑ\x20Gateway\x20mapping:','customerEmail','üîç\x20Using\x20gateway\x20\x27','gateways','AdminService','fullName','convertToUSDT','__esModule','payout','\x20\x20\x20üè™\x20Gateway\x20earnings:\x20','\x20USDT\x20(same\x20as\x20awaiting)','\x20status:\x20','getMonth','all','not\x20specified','\x20USDT\x20(actual\x20balances)','üéØ\x20[',']\x20Updating\x20password\x20for\x20user\x20','randomBytes','\x20\x20\x20ÔøΩ\x20Total\x20payments\x20turnover:\x20','length','PAID','cointopay2','usdtTrcWallet','üí∞\x20Shop\x20','\x20USDT\x20for\x20payment\x20','failureMessage','./currencyService','klyme_de','join','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','push','üîÑ\x20Gateway\x20mapping\x20(get):','toUpperCase','telegram','Shop\x20not\x20found','erc20','MasterCard','sort','\x20->\x20','generateDailyStatistics','getFullYear','‚ö†Ô∏è\x20Gateway\x20\x27','_count','amountUSDT','%\x20commission)','üìä\x20Getting\x20payments\x20with\x20filters:','pendingPayout','mastercard','test_gateway','some','usdcPolygonWallet','log','awaitingPayout','üìä\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','\x27\x20to\x20name\x20\x27','amount'];a36_0x3170=function(){return _0x53a853;};return a36_0x3170();}var __importDefault=this&&this[a36_0x5d61f1(0x1b0)]||function(_0x317168){const _0x533941=a36_0x5d61f1;return _0x317168&&_0x317168[_0x533941(0x8b)]?_0x317168:{'default':_0x317168};};Object[a36_0x5d61f1(0x195)](exports,a36_0x5d61f1(0x8b),{'value':!![]}),exports[a36_0x5d61f1(0x88)]=void 0x0;const database_1=__importDefault(require('../config/database')),bcryptjs_1=__importDefault(require(a36_0x5d61f1(0x13a))),crypto_1=__importDefault(require('crypto')),currencyService_1=require(a36_0x5d61f1(0x9f)),gateway_1=require('../types/gateway');class AdminService{async['getPayoutStats'](){const _0x342ee5=a36_0x5d61f1;console[_0x342ee5(0xb8)](_0x342ee5(0x15a));const _0xe22ff7=await database_1['default'][_0x342ee5(0x137)][_0x342ee5(0x165)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x342ee5(0x163)}}),_0x283940=await this[_0x342ee5(0x11c)]({'page':0x1,'limit':0x3e8}),_0x258dee=await database_1['default'][_0x342ee5(0xf2)][_0x342ee5(0xd4)]({'where':{'status':_0x342ee5(0x99),'gateway':{'not':_0x342ee5(0xb5)}}}),_0x18520d=new Date(),_0x2d0f4d=new Date(_0x18520d['getFullYear'](),_0x18520d[_0x342ee5(0x90)](),0x1),_0x4f1ef3=new Date(_0x18520d[_0x342ee5(0xad)](),_0x18520d[_0x342ee5(0x90)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0xfbbf2c=await database_1[_0x342ee5(0xc8)][_0x342ee5(0x8c)][_0x342ee5(0x165)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x2d0f4d,'lte':_0x4f1ef3},'status':_0x342ee5(0x1aa)}}),_0x4775e9=_0xe22ff7[_0x342ee5(0x1b8)][_0x342ee5(0x128)]||0x0,_0x39abcc=_0x283940['summary'][_0x342ee5(0x1bb)],_0xe2879d=_0xfbbf2c['_sum']['amount']||0x0,_0x2350af={'totalPayout':Math[_0x342ee5(0x17b)](_0x4775e9*0x64)/0x64,'awaitingPayout':Math[_0x342ee5(0x17b)](_0x39abcc*0x64)/0x64,'thisMonth':Math['round'](_0xe2879d*0x64)/0x64,'availableBalance':Math[_0x342ee5(0x17b)](_0x39abcc*0x64)/0x64,'totalPayments':_0x258dee};return console[_0x342ee5(0xb8)](_0x342ee5(0xc2)),console[_0x342ee5(0xb8)](_0x342ee5(0xf0)+_0x2350af[_0x342ee5(0xe0)]+_0x342ee5(0xd6)),console[_0x342ee5(0xb8)]('\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20'+_0x2350af[_0x342ee5(0xb9)]+_0x342ee5(0x140)),console['log'](_0x342ee5(0x178)+_0x2350af[_0x342ee5(0xee)]+_0x342ee5(0x8e)),console[_0x342ee5(0xb8)](_0x342ee5(0xc4)+_0x2350af[_0x342ee5(0xe3)]+_0x342ee5(0x15d)),console['log'](_0x342ee5(0xe2)+_0x2350af['totalPayments']+_0x342ee5(0x155)),console[_0x342ee5(0xb8)]('\x20\x20\x20üîç\x20Raw\x20balance\x20sum:\x20'+(_0xe22ff7[_0x342ee5(0x1b8)][_0x342ee5(0x146)]||0x0)[_0x342ee5(0x14f)](0x2)+'\x20USDT\x20(without\x20commission)'),console[_0x342ee5(0xb8)](_0x342ee5(0x18b)+((_0xe22ff7[_0x342ee5(0x1b8)][_0x342ee5(0x146)]||0x0)-_0x39abcc)[_0x342ee5(0x14f)](0x2)+_0x342ee5(0x15d)),_0x2350af;}async[a36_0x5d61f1(0xd9)](_0x273e4d,_0x259272){const _0x14a576=a36_0x5d61f1;console['log'](_0x14a576(0xef)+_0x273e4d+':',_0x259272);const _0x483f66=await database_1[_0x14a576(0xc8)]['payment']['findUnique']({'where':{'id':_0x273e4d},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x483f66)throw new Error(_0x14a576(0x17f));const _0xbcaf1a={};_0x259272['customerCountry']!==undefined&&(_0xbcaf1a['customerCountry']=_0x259272[_0x14a576(0xfc)]||null);_0x259272[_0x14a576(0xfb)]!==undefined&&(_0xbcaf1a[_0x14a576(0xfb)]=_0x259272[_0x14a576(0xfb)]||null);_0x259272['customerUa']!==undefined&&(_0xbcaf1a[_0x14a576(0x119)]=_0x259272[_0x14a576(0x119)]||null);const _0x4844dd=await database_1[_0x14a576(0xc8)][_0x14a576(0xf2)][_0x14a576(0x11a)]({'where':{'id':_0x273e4d},'data':{..._0xbcaf1a,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console['log'](_0x14a576(0x19d)+_0x273e4d),console['log'](_0x14a576(0x1a2)+_0x483f66[_0x14a576(0xfc)]+'\x20->\x20'+_0x4844dd['customerCountry']),console[_0x14a576(0xb8)]('\x20\x20\x20üåê\x20IP:\x20'+_0x483f66['customerIp']+'\x20->\x20'+_0x4844dd[_0x14a576(0xfb)]),console[_0x14a576(0xb8)](_0x14a576(0x1be)+(_0x483f66['customerUa']?_0x14a576(0x16c):_0x14a576(0x174))+_0x14a576(0xab)+(_0x4844dd[_0x14a576(0x119)]?'set':'not\x20set')),_0x4844dd;}async[a36_0x5d61f1(0x152)](_0x48d268){const _0x44312f=a36_0x5d61f1,_0x3e35e9=new Date();let _0x5be27f;switch(_0x48d268){case'7d':_0x5be27f=new Date(_0x3e35e9[_0x44312f(0x1b5)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x5be27f=new Date(_0x3e35e9['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x44312f(0xc5):_0x5be27f=new Date(_0x3e35e9[_0x44312f(0x1b5)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case'all':const _0x4e955a=await database_1[_0x44312f(0xc8)]['payment'][_0x44312f(0x18f)]({'where':{'gateway':{'not':_0x44312f(0xb5)}},'orderBy':{'createdAt':_0x44312f(0x1c2)},'select':{'createdAt':!![]}});_0x5be27f=_0x4e955a?_0x4e955a['createdAt']:new Date(_0x44312f(0x187)),console[_0x44312f(0xb8)](_0x44312f(0x176)+_0x5be27f['toISOString']());break;default:_0x5be27f=new Date(_0x3e35e9[_0x44312f(0x1b5)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x2a800b,_0x23a5ba,_0x1156bc,_0x3b458f,_0x5b685b,_0x46fd60,_0x2980db]=await Promise[_0x44312f(0x91)]([database_1[_0x44312f(0xc8)][_0x44312f(0x137)]['count'](),database_1[_0x44312f(0xc8)][_0x44312f(0x137)]['count']({'where':{'status':_0x44312f(0x163)}}),database_1[_0x44312f(0xc8)][_0x44312f(0xf2)][_0x44312f(0xd4)]({'where':{'createdAt':{'gte':_0x5be27f},'gateway':{'not':_0x44312f(0xb5)}}}),database_1[_0x44312f(0xc8)]['payment'][_0x44312f(0xd4)]({'where':{'status':'PAID','createdAt':{'gte':_0x5be27f},'gateway':{'not':_0x44312f(0xb5)}}}),database_1['default'][_0x44312f(0xf2)]['findMany']({'where':{'status':_0x44312f(0x99),'createdAt':{'gte':_0x5be27f},'gateway':{'not':_0x44312f(0xb5)}},'select':{'amount':!![],'currency':!![]}}),database_1[_0x44312f(0xc8)][_0x44312f(0xf2)]['findMany']({'where':{'gateway':{'not':_0x44312f(0xb5)}},'take':0xa,'orderBy':{'createdAt':_0x44312f(0x144)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x44312f(0xf2)][_0x44312f(0x110)]({'where':{'createdAt':{'gte':_0x5be27f},'gateway':{'not':_0x44312f(0xb5)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x2b5d75=0x0;for(const _0x29467e of _0x5b685b){const _0xf452c6=await currencyService_1[_0x44312f(0x17d)][_0x44312f(0x8a)](_0x29467e[_0x44312f(0xbc)],_0x29467e[_0x44312f(0x186)]);_0x2b5d75+=_0xf452c6;}const _0x1a23de=this[_0x44312f(0xac)](_0x2980db,_0x5be27f,_0x3e35e9),_0x1d11da=_0x1156bc>0x0?_0x3b458f/_0x1156bc*0x64:0x0;return{'totalShops':_0x2a800b,'activeShops':_0x23a5ba,'totalPayments':_0x1156bc,'successfulPayments':_0x3b458f,'totalRevenue':Math[_0x44312f(0x17b)](_0x2b5d75*0x64)/0x64,'conversionRate':Math[_0x44312f(0x17b)](_0x1d11da*0x64)/0x64,'dailyRevenue':_0x1a23de[_0x44312f(0xd1)],'dailyPayments':_0x1a23de[_0x44312f(0xdc)],'recentPayments':_0x46fd60[_0x44312f(0x1ac)](_0x3e69d1=>({'id':_0x3e69d1['id'],'amount':_0x3e69d1['amount'],'currency':_0x3e69d1[_0x44312f(0x186)],'status':_0x3e69d1[_0x44312f(0x11b)],'gateway':_0x3e69d1['gateway'],'shop':_0x3e69d1['shop'],'createdAt':_0x3e69d1[_0x44312f(0x1c5)]}))};}async[a36_0x5d61f1(0x1b6)](_0x22e50a){const _0x5852e5=a36_0x5d61f1;console[_0x5852e5(0xb8)](_0x5852e5(0xbe),_0x22e50a);let _0xe5d17c,_0xa74749=new Date();if(_0x22e50a['period']===_0x5852e5(0xda)&&_0x22e50a['dateFrom']&&_0x22e50a['dateTo'])_0xe5d17c=new Date(_0x22e50a['dateFrom']),_0xa74749=new Date(_0x22e50a[_0x5852e5(0x145)]);else{const _0x508c4a=new Date();switch(_0x22e50a[_0x5852e5(0x189)]){case'week':_0xe5d17c=new Date(_0x508c4a[_0x5852e5(0x1b5)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'month':_0xe5d17c=new Date(_0x508c4a['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x5852e5(0xea):_0xe5d17c=new Date(_0x508c4a[_0x5852e5(0x1b5)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x5852e5(0x91):default:_0xe5d17c=new Date(_0x5852e5(0x187));break;}}console[_0x5852e5(0xb8)](_0x5852e5(0xf9)+_0xe5d17c[_0x5852e5(0x168)]()+_0x5852e5(0x11d)+_0xa74749[_0x5852e5(0x168)]());const _0x2f30ca={'status':_0x5852e5(0x99),'gateway':{'not':_0x5852e5(0xb5)},'paidAt':{'gte':_0xe5d17c,'lte':_0xa74749}};_0x22e50a[_0x5852e5(0xe6)]&&(_0x2f30ca[_0x5852e5(0xe6)]=_0x22e50a[_0x5852e5(0xe6)]);const _0x105ff8=await database_1[_0x5852e5(0xc8)][_0x5852e5(0xf2)][_0x5852e5(0x110)]({'where':_0x2f30ca,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x5852e5(0xb8)]('üí∞\x20Found\x20'+_0x105ff8['length']+_0x5852e5(0x18c));const _0x7a8e2e={'gateway':{'not':'test_gateway'},'createdAt':{'gte':_0xe5d17c,'lte':_0xa74749}};_0x22e50a[_0x5852e5(0xe6)]&&(_0x7a8e2e['shopId']=_0x22e50a[_0x5852e5(0xe6)]);const _0x429700=await database_1[_0x5852e5(0xc8)]['payment'][_0x5852e5(0xd4)]({'where':_0x7a8e2e});console[_0x5852e5(0xb8)]('üìä\x20Total\x20payments\x20(including\x20failed):\x20'+_0x429700+_0x5852e5(0x10c)+_0x105ff8[_0x5852e5(0x98)]);let _0x1b0daa=0x0,_0x332d7f=0x0,_0x1abffe=0x0;const _0x412d89={},_0x2f9754={},_0x2e3407={};for(const _0x7f015f of _0x105ff8){try{const _0x11680d=await currencyService_1[_0x5852e5(0x17d)][_0x5852e5(0x8a)](_0x7f015f['amount'],_0x7f015f[_0x5852e5(0x186)]);let _0x17ded2={};if(_0x7f015f[_0x5852e5(0x137)]['gatewaySettings'])try{_0x17ded2=JSON[_0x5852e5(0x1bd)](_0x7f015f[_0x5852e5(0x137)]['gatewaySettings']);}catch(_0x53eb40){console['error'](_0x5852e5(0x1ae)+_0x7f015f[_0x5852e5(0xe6)]+':',_0x53eb40);}let _0x3a5885={},_0x4629a3=0xa;for(const [_0x48f97e,_0x359ec1]of Object[_0x5852e5(0x138)](_0x17ded2)){if(_0x48f97e['toLowerCase']()===_0x7f015f[_0x5852e5(0x197)][_0x5852e5(0x1b2)]()){_0x3a5885=_0x359ec1,_0x4629a3=_0x359ec1[_0x5852e5(0x14c)]||0xa;break;}}let _0x12f866,_0x5ed84e;_0x7f015f[_0x5852e5(0x181)]!==null&&_0x7f015f[_0x5852e5(0x181)]!==undefined?(_0x12f866=_0x7f015f[_0x5852e5(0x181)],_0x5ed84e=_0x11680d-_0x12f866,console[_0x5852e5(0xb8)]('üìä\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20'+_0x12f866[_0x5852e5(0x14f)](0x6)+_0x5852e5(0x9d)+_0x7f015f['id'])):(_0x5ed84e=_0x11680d*(_0x4629a3/0x64),_0x12f866=_0x11680d-_0x5ed84e,console[_0x5852e5(0xb8)](_0x5852e5(0x104)+_0x7f015f['id']+':\x20'+_0x4629a3+_0x5852e5(0x179)+_0x11680d['toFixed'](0x6)+_0x5852e5(0x15d)));_0x1b0daa+=_0x11680d,_0x332d7f+=_0x12f866,_0x1abffe+=_0x5ed84e;!_0x412d89[_0x7f015f[_0x5852e5(0x197)]]&&(_0x412d89[_0x7f015f[_0x5852e5(0x197)]]={'gateway':_0x7f015f[_0x5852e5(0x197)],'gatewayDisplayName':this['getGatewayDisplayName'](_0x7f015f[_0x5852e5(0x197)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x412d89[_0x7f015f[_0x5852e5(0x197)]][_0x5852e5(0x129)]++,_0x412d89[_0x7f015f[_0x5852e5(0x197)]][_0x5852e5(0xfe)]+=_0x11680d,_0x412d89[_0x7f015f[_0x5852e5(0x197)]]['commissionUSDT']+=_0x5ed84e,_0x412d89[_0x7f015f['gateway']][_0x5852e5(0x13f)]+=_0x12f866,_0x412d89[_0x7f015f[_0x5852e5(0x197)]][_0x5852e5(0x149)]+=_0x4629a3;!_0x22e50a['shopId']&&(!_0x2f9754[_0x7f015f[_0x5852e5(0xe6)]]&&(_0x2f9754[_0x7f015f[_0x5852e5(0xe6)]]={'shopId':_0x7f015f[_0x5852e5(0xe6)],'shopName':_0x7f015f[_0x5852e5(0x137)]['name'],'shopUsername':_0x7f015f[_0x5852e5(0x137)][_0x5852e5(0xf8)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x2f9754[_0x7f015f[_0x5852e5(0xe6)]][_0x5852e5(0x129)]++,_0x2f9754[_0x7f015f[_0x5852e5(0xe6)]][_0x5852e5(0xfe)]+=_0x11680d,_0x2f9754[_0x7f015f['shopId']][_0x5852e5(0xc0)]+=_0x5ed84e,_0x2f9754[_0x7f015f['shopId']][_0x5852e5(0x13f)]+=_0x12f866);const _0x4185c3=_0x7f015f[_0x5852e5(0x1a4)][_0x5852e5(0x168)]()[_0x5852e5(0xd8)]('T')[0x0];!_0x2e3407[_0x4185c3]&&(_0x2e3407[_0x4185c3]={'date':_0x4185c3,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x2e3407[_0x4185c3]['turnover']+=_0x11680d,_0x2e3407[_0x4185c3][_0x5852e5(0x160)]+=_0x12f866,_0x2e3407[_0x4185c3][_0x5852e5(0xed)]+=_0x5ed84e,_0x2e3407[_0x4185c3][_0x5852e5(0x129)]++;}catch(_0x54fbef){console[_0x5852e5(0xd3)](_0x5852e5(0x188)+_0x7f015f['id']+':',_0x54fbef);}}Object[_0x5852e5(0x16b)](_0x412d89)[_0x5852e5(0x122)](_0x149ed2=>{const _0x4f4eb8=_0x5852e5;_0x149ed2['averageCommissionRate']=_0x149ed2[_0x4f4eb8(0x129)]>0x0?_0x149ed2[_0x4f4eb8(0x149)]/_0x149ed2[_0x4f4eb8(0x129)]:0x0,delete _0x149ed2[_0x4f4eb8(0x149)];}),Object['values'](_0x2f9754)[_0x5852e5(0x122)](_0x4f0961=>{const _0x1e927f=_0x5852e5;_0x4f0961[_0x1e927f(0xe9)]=_0x4f0961['paymentsCount']>0x0?_0x4f0961[_0x1e927f(0xfe)]/_0x4f0961['paymentsCount']:0x0;});let _0x2808d9=0x0,_0x2237fa=0x0;if(_0x22e50a['shopId']){const _0xd9af0d=await database_1[_0x5852e5(0xc8)][_0x5852e5(0x8c)][_0x5852e5(0x110)]({'where':{'shopId':_0x22e50a[_0x5852e5(0xe6)],'status':_0x5852e5(0x1aa),'createdAt':{'gte':_0xe5d17c,'lte':_0xa74749}},'select':{'amount':!![]}});_0x2808d9=_0xd9af0d[_0x5852e5(0xc1)]((_0x3a6b9a,_0x13db6e)=>_0x3a6b9a+_0x13db6e[_0x5852e5(0xbc)],0x0);const _0x5eac82=await database_1[_0x5852e5(0xc8)][_0x5852e5(0x8c)][_0x5852e5(0x110)]({'where':{'shopId':_0x22e50a[_0x5852e5(0xe6)],'status':_0x5852e5(0xf4),'createdAt':{'gte':_0xe5d17c,'lte':_0xa74749}},'select':{'amount':!![]}});_0x2237fa=_0x5eac82[_0x5852e5(0xc1)]((_0x5c4553,_0x54dd62)=>_0x5c4553+_0x54dd62[_0x5852e5(0xbc)],0x0);}const _0x58dfc0=_0x429700,_0x5151b5=_0x105ff8[_0x5852e5(0x98)],_0x14ac73=_0x5151b5>0x0?_0x1b0daa/_0x5151b5:0x0,_0x34cc28=_0x58dfc0>0x0?Math[_0x5852e5(0x17b)](_0x5151b5/_0x58dfc0*0x2710)/0x64:0x0,_0x594d69=Math[_0x5852e5(0xca)]((_0xa74749['getTime']()-_0xe5d17c[_0x5852e5(0x1b5)]())/(0x3e8*0x3c*0x3c*0x18)),_0x3febc3={'totalTurnover':Math[_0x5852e5(0x17b)](_0x1b0daa*0x64)/0x64,'merchantEarnings':Math[_0x5852e5(0x17b)](_0x332d7f*0x64)/0x64,'gatewayEarnings':Math['round'](_0x1abffe*0x64)/0x64,'totalPaidOut':Math[_0x5852e5(0x17b)](_0x2808d9*0x64)/0x64,'pendingPayout':Math[_0x5852e5(0x17b)](_0x2237fa*0x64)/0x64,'averageCheck':Math['round'](_0x14ac73*0x64)/0x64,'totalPayments':_0x58dfc0,'successfulPayments':_0x5151b5,'conversionRate':_0x34cc28,'gatewayBreakdown':Object[_0x5852e5(0x16b)](_0x412d89)[_0x5852e5(0x1ac)](_0x34163e=>({..._0x34163e,'turnoverUSDT':Math['round'](_0x34163e['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x5852e5(0x17b)](_0x34163e['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x5852e5(0x17b)](_0x34163e[_0x5852e5(0x13f)]*0x64)/0x64,'averageCommissionRate':Math[_0x5852e5(0x17b)](_0x34163e[_0x5852e5(0x1a1)]*0x64)/0x64})),'merchantBreakdown':_0x22e50a[_0x5852e5(0xe6)]?undefined:Object[_0x5852e5(0x16b)](_0x2f9754)[_0x5852e5(0x1ac)](_0x2f57f6=>({..._0x2f57f6,'turnoverUSDT':Math[_0x5852e5(0x17b)](_0x2f57f6['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x5852e5(0x17b)](_0x2f57f6[_0x5852e5(0xc0)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x2f57f6[_0x5852e5(0x13f)]*0x64)/0x64,'paidOutUSDT':Math['round'](_0x2f57f6[_0x5852e5(0x1b1)]*0x64)/0x64,'averageCheckUSDT':Math[_0x5852e5(0x17b)](_0x2f57f6[_0x5852e5(0xe9)]*0x64)/0x64})),'dailyData':Object['values'](_0x2e3407)['map'](_0x255169=>({..._0x255169,'turnover':Math[_0x5852e5(0x17b)](_0x255169[_0x5852e5(0x83)]*0x64)/0x64,'merchantEarnings':Math['round'](_0x255169[_0x5852e5(0x160)]*0x64)/0x64,'gatewayEarnings':Math[_0x5852e5(0x17b)](_0x255169[_0x5852e5(0xed)]*0x64)/0x64}))[_0x5852e5(0xaa)]((_0x3c416b,_0x52431d)=>_0x3c416b['date']['localeCompare'](_0x52431d['date'])),'periodInfo':{'from':_0xe5d17c,'to':_0xa74749,'periodType':_0x22e50a[_0x5852e5(0x189)]||'custom','daysCount':_0x594d69}};return console[_0x5852e5(0xb8)](_0x5852e5(0x1a0)),console[_0x5852e5(0xb8)](_0x5852e5(0x170)+_0x3febc3[_0x5852e5(0xce)]+_0x5852e5(0x15d)),console[_0x5852e5(0xb8)](_0x5852e5(0x13b)+_0x3febc3[_0x5852e5(0x160)]+'\x20USDT'),console[_0x5852e5(0xb8)](_0x5852e5(0x8d)+_0x3febc3[_0x5852e5(0xed)]+_0x5852e5(0x15d)),console[_0x5852e5(0xb8)]('\x20\x20\x20ÔøΩ\x20Total\x20paid\x20out:\x20'+_0x3febc3[_0x5852e5(0x128)]+_0x5852e5(0x15d)),console[_0x5852e5(0xb8)](_0x5852e5(0xe7)+_0x3febc3[_0x5852e5(0xb3)]+'\x20USDT'),console['log'](_0x5852e5(0x10b)+_0x3febc3[_0x5852e5(0x1ad)]),_0x3febc3;}async[a36_0x5d61f1(0x18e)](){const _0x314ac5=a36_0x5d61f1;console[_0x314ac5(0xb8)](_0x314ac5(0x184));const _0x131d6b=await database_1[_0x314ac5(0xc8)][_0x314ac5(0x137)][_0x314ac5(0x110)]({'where':{'status':_0x314ac5(0x163)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':'asc'}});return console[_0x314ac5(0xb8)](_0x314ac5(0x199)+_0x131d6b[_0x314ac5(0x98)]+_0x314ac5(0x1ba)),_0x131d6b[_0x314ac5(0x1ac)](_0x2b0870=>({'id':_0x2b0870['id'],'username':_0x2b0870[_0x314ac5(0xf8)],'name':_0x2b0870[_0x314ac5(0x16d)]}));}[a36_0x5d61f1(0x13d)](_0x3227dd){const _0x31cca1=a36_0x5d61f1,_0x213bab={'test_gateway':_0x31cca1(0x193),'plisio':_0x31cca1(0x154),'rapyd':_0x31cca1(0x14d),'noda':_0x31cca1(0x172),'cointopay':'CoinToPay','cointopay2':_0x31cca1(0xe8),'klyme_eu':'KLYME\x20EU','klyme_gb':'KLYME\x20GB','klyme_de':_0x31cca1(0xf3),'mastercard':_0x31cca1(0xa9)};return _0x213bab[_0x3227dd]||_0x3227dd;}[a36_0x5d61f1(0x120)](_0x471050){const _0x5741b8=a36_0x5d61f1,_0x1c94b4={'Test\x20Gateway':'test_gateway','Plisio':_0x5741b8(0x153),'Rapyd':_0x5741b8(0x1c0),'Noda':_0x5741b8(0x1a7),'CoinToPay':_0x5741b8(0x15f),'CoinToPay2':_0x5741b8(0x9a),'KLYME\x20EU':_0x5741b8(0xbf),'KLYME\x20GB':_0x5741b8(0x127),'KLYME\x20DE':_0x5741b8(0xa0),'MasterCard':_0x5741b8(0xb4)};return _0x1c94b4[_0x471050]||_0x471050[_0x5741b8(0x1b2)]();}async[a36_0x5d61f1(0x11c)](_0x2608e9){const _0x2defca=a36_0x5d61f1,{page:_0x4ff289,limit:_0x25e967,minAmount:_0x33bd08,search:_0x3f67fd}=_0x2608e9,_0x172ddb=(_0x4ff289-0x1)*_0x25e967;console['log'](_0x2defca(0xe4),_0x2608e9);const _0x13c9ad={'balance':{'gt':0x0},'status':_0x2defca(0x163)};_0x33bd08&&(_0x13c9ad[_0x2defca(0x146)][_0x2defca(0x81)]=_0x33bd08);_0x3f67fd&&(_0x13c9ad['OR']=[{'name':{'contains':_0x3f67fd,'mode':_0x2defca(0x100)}},{'username':{'contains':_0x3f67fd,'mode':'insensitive'}}]);const [_0x244148,_0xa71e76]=await Promise[_0x2defca(0x91)]([database_1[_0x2defca(0xc8)]['shop'][_0x2defca(0x110)]({'where':_0x13c9ad,'skip':_0x172ddb,'take':_0x25e967,'orderBy':{'balance':_0x2defca(0x144)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1[_0x2defca(0xc8)]['shop'][_0x2defca(0xd4)]({'where':_0x13c9ad})]);console[_0x2defca(0xb8)](_0x2defca(0xcf)+_0x244148[_0x2defca(0x98)]+'\x20merchants\x20with\x20positive\x20balance');const _0x47376e=await Promise[_0x2defca(0x91)](_0x244148[_0x2defca(0x1ac)](async _0x2f5484=>{const _0x4aca9e=_0x2defca,[_0x19ac79,_0x339267,_0x1535e3]=await Promise[_0x4aca9e(0x91)]([database_1[_0x4aca9e(0xc8)]['payment']['count']({'where':{'shopId':_0x2f5484['id'],'status':_0x4aca9e(0x99),'gateway':{'not':_0x4aca9e(0xb5)}}}),database_1['default'][_0x4aca9e(0xf2)][_0x4aca9e(0x18f)]({'where':{'shopId':_0x2f5484['id'],'status':_0x4aca9e(0x99),'gateway':{'not':_0x4aca9e(0xb5)}},'orderBy':{'paidAt':'asc'},'select':{'paidAt':!![]}}),database_1[_0x4aca9e(0xc8)]['payment'][_0x4aca9e(0x13c)]({'by':['gateway'],'where':{'shopId':_0x2f5484['id'],'status':_0x4aca9e(0x99),'gateway':{'not':_0x4aca9e(0xb5)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x42b2fb=new Date(),_0x4805a4=new Date(_0x42b2fb[_0x4aca9e(0xad)](),_0x42b2fb[_0x4aca9e(0x90)](),0x1),_0x1a8079=new Date(_0x42b2fb[_0x4aca9e(0xad)](),_0x42b2fb['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x3eb9e1,_0x4cb085]=await Promise['all']([database_1['default'][_0x4aca9e(0x8c)]['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x2f5484['id'],'status':'COMPLETED'}}),database_1[_0x4aca9e(0xc8)]['payout'][_0x4aca9e(0x165)]({'_sum':{'amount':!![]},'where':{'shopId':_0x2f5484['id'],'status':_0x4aca9e(0x1aa),'createdAt':{'gte':_0x4805a4,'lte':_0x1a8079}}})]),_0x45aa5d=_0x3eb9e1[_0x4aca9e(0x1b8)][_0x4aca9e(0xbc)]||0x0,_0x4eeab3=_0x4cb085[_0x4aca9e(0x1b8)][_0x4aca9e(0xbc)]||0x0,_0x34a98d=await Promise[_0x4aca9e(0x91)](_0x1535e3[_0x4aca9e(0x1ac)](async _0x25e7cd=>{const _0x5a8b13=_0x4aca9e;let _0x1ce2c6=0xa;if(_0x2f5484[_0x5a8b13(0x134)])try{const _0x40d9ca=JSON['parse'](_0x2f5484[_0x5a8b13(0x134)]);for(const [_0x4e6bef,_0x29b57f]of Object[_0x5a8b13(0x138)](_0x40d9ca)){if(_0x4e6bef['toLowerCase']()===_0x25e7cd[_0x5a8b13(0x197)][_0x5a8b13(0x1b2)]()){_0x1ce2c6=_0x29b57f[_0x5a8b13(0x14c)]||0xa,console['log'](_0x5a8b13(0x1bc)+_0x25e7cd[_0x5a8b13(0x197)]+_0x5a8b13(0x115)+_0x2f5484['id']+_0x5a8b13(0x196)+_0x1ce2c6+'%');break;}}}catch(_0x1a186f){console[_0x5a8b13(0xd3)](_0x5a8b13(0x1ae)+_0x2f5484['id']+':',_0x1a186f);}const _0x598d49=_0x25e7cd[_0x5a8b13(0x1b8)]?.['amountUSDT']||0x0,_0x419f9e=_0x598d49*(0x1-_0x1ce2c6/0x64);return{'gateway':_0x25e7cd[_0x5a8b13(0x197)],'count':_0x25e7cd[_0x5a8b13(0xaf)]?.['id']||0x0,'amountUSDT':Math[_0x5a8b13(0x17b)](_0x598d49*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x5a8b13(0x17b)](_0x419f9e*0x64)/0x64,'commission':_0x1ce2c6};})),_0x163065=_0x34a98d[_0x4aca9e(0xc1)]((_0x54bd29,_0x283aa1)=>_0x54bd29+_0x283aa1[_0x4aca9e(0xb0)],0x0),_0x417b3e=_0x2f5484[_0x4aca9e(0x146)];return console['log'](_0x4aca9e(0x10f)+_0x2f5484[_0x4aca9e(0xf8)]+':'),console[_0x4aca9e(0xb8)](_0x4aca9e(0x97)+_0x163065[_0x4aca9e(0x14f)](0x2)+'\x20USDT\x20(gross\x20revenue)'),console[_0x4aca9e(0xb8)](_0x4aca9e(0xdf)+_0x34a98d[_0x4aca9e(0xc1)]((_0x5306ca,_0x2270b5)=>_0x5306ca+_0x2270b5[_0x4aca9e(0x16e)],0x0)[_0x4aca9e(0x14f)](0x2)+_0x4aca9e(0x133)),console['log'](_0x4aca9e(0x1ab)+_0x417b3e[_0x4aca9e(0x14f)](0x2)+_0x4aca9e(0x19c)),{'id':_0x2f5484['id'],'fullName':_0x2f5484[_0x4aca9e(0x16d)],'username':_0x2f5484['username'],'telegramId':_0x2f5484[_0x4aca9e(0xa6)],'merchantUrl':_0x2f5484[_0x4aca9e(0x182)],'wallets':{'usdtPolygonWallet':_0x2f5484[_0x4aca9e(0xcc)],'usdtTrcWallet':_0x2f5484['usdtTrcWallet'],'usdtErcWallet':_0x2f5484[_0x4aca9e(0x125)],'usdcPolygonWallet':_0x2f5484[_0x4aca9e(0xb7)]},'totalAmountUSDT':Math[_0x4aca9e(0x17b)](_0x163065*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x4aca9e(0x17b)](_0x417b3e*0x64)/0x64,'totalPayout':Math['round'](_0x45aa5d*0x64)/0x64,'thisMonth':Math[_0x4aca9e(0x17b)](_0x4eeab3*0x64)/0x64,'paymentsCount':_0x19ac79,'oldestPaymentDate':_0x339267?.['paidAt']||_0x2f5484[_0x4aca9e(0x1c5)],'gatewayBreakdown':_0x34a98d};})),_0x29b88e=_0x47376e[_0x2defca(0xc1)]((_0x2f690f,_0x4e7831)=>_0x2f690f+_0x4e7831[_0x2defca(0x121)],0x0),_0x1d9de4=_0x47376e[_0x2defca(0xc1)]((_0x2b7737,_0x59eaf6)=>_0x2b7737+_0x59eaf6['totalAmountAfterCommissionUSDT'],0x0),_0xab6602=_0x47376e['reduce']((_0x2fbaf9,_0x1d8f4f)=>_0x2fbaf9+_0x1d8f4f[_0x2defca(0xe0)],0x0),_0x3f7557=_0x47376e[_0x2defca(0xc1)]((_0x2b9196,_0x370c49)=>_0x2b9196+_0x370c49[_0x2defca(0xe3)],0x0);return console['log']('üìä\x20Merchants\x20awaiting\x20payout:\x20'+_0xa71e76+_0x2defca(0xde)),console[_0x2defca(0xb8)](_0x2defca(0x105)+Math[_0x2defca(0x17b)](_0x29b88e*0x64)/0x64+_0x2defca(0x191)),console[_0x2defca(0xb8)](_0x2defca(0x10e)+Math[_0x2defca(0x17b)](_0x1d9de4*0x64)/0x64+_0x2defca(0x93)),console['log']('\x20\x20\x20üí∏\x20Total\x20payouts\x20(all\x20time):\x20'+Math[_0x2defca(0x17b)](_0xab6602*0x64)/0x64+'\x20USDT'),console[_0x2defca(0xb8)](_0x2defca(0x19b)+Math['round'](_0x3f7557*0x64)/0x64+_0x2defca(0x15d)),{'merchants':_0x47376e,'pagination':{'page':_0x4ff289,'limit':_0x25e967,'total':_0xa71e76,'totalPages':Math[_0x2defca(0xca)](_0xa71e76/_0x25e967)},'summary':{'totalMerchants':_0xa71e76,'totalAmountUSDT':Math[_0x2defca(0x17b)](_0x29b88e*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x1d9de4*0x64)/0x64,'totalPayout':Math['round'](_0xab6602*0x64)/0x64,'thisMonth':Math[_0x2defca(0x17b)](_0x3f7557*0x64)/0x64}};}async['createPayout'](_0x4ac1a2){const _0x367c0e=a36_0x5d61f1,{shopId:_0x1aa809,amount:_0xe4926f,network:_0x56c5ac,wallet:_0x39acce,notes:_0x32caac,txid:_0x4a5acd,periodFrom:_0x59f358,periodTo:_0x2c5595}=_0x4ac1a2,_0x4d0bf5=await database_1['default'][_0x367c0e(0x15b)](async _0x311c23=>{const _0x80f709=_0x367c0e,_0xeb0653=await _0x311c23[_0x80f709(0x137)]['findUnique']({'where':{'id':_0x1aa809},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0xeb0653)throw new Error(_0x80f709(0xa7));console['log']('üí∞\x20Creating\x20payout\x20for\x20shop\x20'+_0xeb0653[_0x80f709(0xf8)]+':'),console[_0x80f709(0xb8)]('\x20\x20\x20Current\x20balance:\x20'+_0xeb0653['balance'][_0x80f709(0x14f)](0x6)+_0x80f709(0x15d)),console[_0x80f709(0xb8)](_0x80f709(0x185)+_0xe4926f[_0x80f709(0x14f)](0x6)+'\x20USDT'),console[_0x80f709(0xb8)]('\x20\x20\x20Current\x20total\x20paid\x20out:\x20'+_0xeb0653[_0x80f709(0x128)]['toFixed'](0x6)+_0x80f709(0x15d));if(_0x4a5acd)console[_0x80f709(0xb8)]('\x20\x20\x20Transaction\x20hash:\x20'+_0x4a5acd);if(_0xeb0653['balance']<_0xe4926f)throw new Error(_0x80f709(0xe5)+_0xeb0653[_0x80f709(0x146)]['toFixed'](0x6)+_0x80f709(0x132)+_0xe4926f[_0x80f709(0x14f)](0x6)+_0x80f709(0x15d));let _0x515fa0=_0x39acce;if(!_0x515fa0){const _0x1d9974=await _0x311c23['shop'][_0x80f709(0xf6)]({'where':{'id':_0x1aa809},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x1d9974)switch(_0x56c5ac){case'polygon':_0x515fa0=_0x1d9974['usdtPolygonWallet']||undefined;break;case _0x80f709(0x82):_0x515fa0=_0x1d9974[_0x80f709(0x9b)]||undefined;break;case _0x80f709(0xa8):_0x515fa0=_0x1d9974[_0x80f709(0x125)]||undefined;break;case _0x80f709(0x103):_0x515fa0=_0x1d9974[_0x80f709(0xb7)]||undefined;break;}}console[_0x80f709(0xb8)](_0x80f709(0xc7)+_0x56c5ac+':\x20'+(_0x515fa0||_0x80f709(0x92)));const _0x12caee=await _0x311c23[_0x80f709(0x8c)][_0x80f709(0x16f)]({'data':{'shopId':_0x1aa809,'amount':_0xe4926f,'network':_0x56c5ac,'status':_0x80f709(0x1aa),'txid':_0x4a5acd,'notes':_0x32caac,'periodFrom':_0x59f358?new Date(_0x59f358):null,'periodTo':_0x2c5595?new Date(_0x2c5595):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x323b65=_0xeb0653[_0x80f709(0x146)]-_0xe4926f,_0x30aa35=_0xeb0653[_0x80f709(0x128)]+_0xe4926f;return await _0x311c23['shop'][_0x80f709(0x11a)]({'where':{'id':_0x1aa809},'data':{'balance':_0x323b65,'totalPaidOut':_0x30aa35}}),console[_0x80f709(0xb8)]('üí∞\x20Shop\x20'+_0xeb0653[_0x80f709(0xf8)]+_0x80f709(0x1b4)),console['log'](_0x80f709(0xd7)+_0xeb0653['balance'][_0x80f709(0x14f)](0x6)+_0x80f709(0xab)+_0x323b65['toFixed'](0x6)+'\x20USDT\x20(-'+_0xe4926f['toFixed'](0x6)+')'),console[_0x80f709(0xb8)](_0x80f709(0x116)+_0xeb0653['totalPaidOut'][_0x80f709(0x14f)](0x6)+'\x20->\x20'+_0x30aa35[_0x80f709(0x14f)](0x6)+_0x80f709(0x1c6)+_0xe4926f[_0x80f709(0x14f)](0x6)+')'),{'payout':_0x12caee,'shop':_0xeb0653};});return console[_0x367c0e(0xb8)]('‚úÖ\x20Payout\x20created:\x20'+_0x4d0bf5[_0x367c0e(0x8c)]['id']+_0x367c0e(0x115)+_0x4d0bf5['shop'][_0x367c0e(0xf8)]+'\x20('+_0xe4926f+_0x367c0e(0x141)),{'id':_0x4d0bf5[_0x367c0e(0x8c)]['id'],'shopId':_0x4d0bf5[_0x367c0e(0x8c)][_0x367c0e(0xe6)],'shopName':_0x4d0bf5[_0x367c0e(0x137)]['name'],'shopUsername':_0x4d0bf5['shop'][_0x367c0e(0xf8)],'amount':_0x4d0bf5['payout'][_0x367c0e(0xbc)],'network':_0x4d0bf5['payout'][_0x367c0e(0x108)],'status':_0x4d0bf5[_0x367c0e(0x8c)]['status'],'txid':_0x4d0bf5['payout'][_0x367c0e(0x101)],'notes':_0x4d0bf5[_0x367c0e(0x8c)][_0x367c0e(0xeb)],'periodFrom':_0x4d0bf5[_0x367c0e(0x8c)][_0x367c0e(0x169)],'periodTo':_0x4d0bf5[_0x367c0e(0x8c)][_0x367c0e(0xff)],'createdAt':_0x4d0bf5[_0x367c0e(0x8c)][_0x367c0e(0x1c5)],'paidAt':_0x4d0bf5[_0x367c0e(0x8c)][_0x367c0e(0x1a4)]};}async[a36_0x5d61f1(0x157)](_0x281925){const _0xbc2459=a36_0x5d61f1,{page:_0x2a56a0,limit:_0x39b3ce,shopId:_0x413661,network:_0x15597e,dateFrom:_0x559ebb,dateTo:_0x59419e,search:_0x1dfe3a}=_0x281925,_0x38a5e1=(_0x2a56a0-0x1)*_0x39b3ce,_0x3d3498={};_0x413661&&(_0x3d3498['shopId']=_0x413661);_0x15597e&&(_0x3d3498['network']=_0x15597e);(_0x559ebb||_0x59419e)&&(_0x3d3498[_0xbc2459(0x1c5)]={},_0x559ebb&&(_0x3d3498[_0xbc2459(0x1c5)][_0xbc2459(0x81)]=new Date(_0x559ebb)),_0x59419e&&(_0x3d3498['createdAt'][_0xbc2459(0xc3)]=new Date(_0x59419e)));_0x1dfe3a&&(_0x3d3498['OR']=[{'shop':{'name':{'contains':_0x1dfe3a,'mode':_0xbc2459(0x100)}}},{'shop':{'username':{'contains':_0x1dfe3a,'mode':_0xbc2459(0x100)}}},{'notes':{'contains':_0x1dfe3a,'mode':_0xbc2459(0x100)}}]);const [_0x3d6048,_0x4b6157]=await Promise[_0xbc2459(0x91)]([database_1[_0xbc2459(0xc8)][_0xbc2459(0x8c)][_0xbc2459(0x110)]({'where':_0x3d3498,'skip':_0x38a5e1,'take':_0x39b3ce,'orderBy':{'createdAt':_0xbc2459(0x144)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0xbc2459(0xc8)]['payout']['count']({'where':_0x3d3498})]);return{'payouts':_0x3d6048[_0xbc2459(0x1ac)](_0xe33b0f=>({'id':_0xe33b0f['id'],'shopId':_0xe33b0f[_0xbc2459(0xe6)],'shopName':_0xe33b0f['shop'][_0xbc2459(0x16d)],'shopUsername':_0xe33b0f[_0xbc2459(0x137)]['username'],'amount':_0xe33b0f[_0xbc2459(0xbc)],'network':_0xe33b0f['network'],'status':_0xe33b0f[_0xbc2459(0x11b)],'txid':_0xe33b0f[_0xbc2459(0x101)],'notes':_0xe33b0f[_0xbc2459(0xeb)],'periodFrom':_0xe33b0f[_0xbc2459(0x169)],'periodTo':_0xe33b0f['periodTo'],'createdAt':_0xe33b0f[_0xbc2459(0x1c5)],'paidAt':_0xe33b0f[_0xbc2459(0x1a4)]})),'pagination':{'page':_0x2a56a0,'limit':_0x39b3ce,'total':_0x4b6157,'totalPages':Math[_0xbc2459(0xca)](_0x4b6157/_0x39b3ce)}};}async[a36_0x5d61f1(0x17e)](_0x213813){const _0x551b21=a36_0x5d61f1,_0x1aa126=await database_1[_0x551b21(0xc8)][_0x551b21(0x8c)]['findUnique']({'where':{'id':_0x213813},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x1aa126)return null;return{'id':_0x1aa126['id'],'shopId':_0x1aa126[_0x551b21(0xe6)],'shopName':_0x1aa126[_0x551b21(0x137)]['name'],'shopUsername':_0x1aa126[_0x551b21(0x137)][_0x551b21(0xf8)],'amount':_0x1aa126['amount'],'network':_0x1aa126[_0x551b21(0x108)],'status':_0x1aa126['status'],'txid':_0x1aa126[_0x551b21(0x101)],'notes':_0x1aa126[_0x551b21(0xeb)],'periodFrom':_0x1aa126['periodFrom'],'periodTo':_0x1aa126[_0x551b21(0xff)],'createdAt':_0x1aa126[_0x551b21(0x1c5)],'paidAt':_0x1aa126[_0x551b21(0x1a4)]};}async['deletePayout'](_0x5c3757){const _0x3630fc=a36_0x5d61f1;await database_1['default'][_0x3630fc(0x8c)][_0x3630fc(0xdb)]({'where':{'id':_0x5c3757}});}async[a36_0x5d61f1(0x1c7)](_0x236c91){const _0x41d6a2=a36_0x5d61f1,{page:_0x307df7,limit:_0x54f8bc,status:_0x10f17a,gateway:_0xf62724,shopId:_0x1bb7d5,dateFrom:_0x2c1080,dateTo:_0x586d96,search:_0x50d936,currency:_0x34f26e,sortBy:_0x4b559e,sortOrder:_0x5a620b}=_0x236c91,_0x57511f=(_0x307df7-0x1)*_0x54f8bc;console['log'](_0x41d6a2(0xb2),_0x236c91);const _0x4c82e5=await database_1['default'][_0x41d6a2(0xf2)][_0x41d6a2(0x13c)]({'by':[_0x41d6a2(0x197)],'_count':{'gateway':!![]}});console[_0x41d6a2(0xb8)](_0x41d6a2(0x113),_0x4c82e5[_0x41d6a2(0x1ac)](_0x31c7a2=>_0x31c7a2[_0x41d6a2(0x197)]+'\x20('+_0x31c7a2[_0x41d6a2(0xaf)][_0x41d6a2(0x197)]+'\x20payments)'));if(_0xf62724){const _0x179754=_0x4c82e5[_0x41d6a2(0xb6)](_0x46cee1=>_0x46cee1[_0x41d6a2(0x197)][_0x41d6a2(0x1b2)]()===_0xf62724['toLowerCase']());!_0x179754&&_0xf62724['toLowerCase']()!==_0x41d6a2(0xb5)&&console[_0x41d6a2(0xb8)](_0x41d6a2(0xf5)+_0xf62724+_0x41d6a2(0x18d)+_0x4c82e5[_0x41d6a2(0x1ac)](_0x2292e0=>_0x2292e0['gateway'])[_0x41d6a2(0xa1)](',\x20'));}const _0x3270ed={};_0x10f17a&&(_0x3270ed[_0x41d6a2(0x11b)]=_0x10f17a[_0x41d6a2(0xa5)]());if(!_0xf62724)_0x3270ed[_0x41d6a2(0x197)]={'not':_0x41d6a2(0xb5)};else{if(_0xf62724&&(_0xf62724[_0x41d6a2(0x1b2)]()===_0x41d6a2(0xb5)||_0xf62724==='0000'))_0x3270ed['gateway']=_0x41d6a2(0xb5);else{let _0xd9e1f1=_0xf62724;const _0x5110ae=(0x0,gateway_1[_0x41d6a2(0x19a)])(_0xf62724);if(_0x5110ae)_0xd9e1f1=_0x5110ae,console[_0x41d6a2(0xb8)]('üîÑ\x20Converted\x20gateway\x20ID\x20\x27'+_0xf62724+_0x41d6a2(0xbb)+_0xd9e1f1+'\x27');else{const _0x4ea988=(0x0,gateway_1[_0x41d6a2(0x151)])(_0xf62724);if(_0x4ea988){const _0x296a72=(0x0,gateway_1[_0x41d6a2(0x19a)])(_0x4ea988);_0x296a72&&(_0xd9e1f1=_0x296a72,console['log'](_0x41d6a2(0x124)+_0xf62724+_0x41d6a2(0x175)+_0x4ea988+_0x41d6a2(0xf1)+_0xd9e1f1+'\x27'));}else console[_0x41d6a2(0xb8)](_0x41d6a2(0x86)+_0xf62724+_0x41d6a2(0xcd));}const _0x1a7156=await database_1[_0x41d6a2(0xc8)][_0x41d6a2(0xf2)]['count']({'where':{'gateway':_0xd9e1f1[_0x41d6a2(0x1b2)]()},'take':0x1});_0x1a7156===0x0?(console[_0x41d6a2(0xb8)](_0x41d6a2(0xae)+_0xd9e1f1+'\x27\x20(from\x20\x27'+_0xf62724+_0x41d6a2(0xa2)),_0x3270ed[_0x41d6a2(0x197)]=_0x41d6a2(0x1c3)):(_0x3270ed['gateway']=_0xd9e1f1[_0x41d6a2(0x1b2)](),console[_0x41d6a2(0xb8)]('‚úÖ\x20Using\x20gateway\x20filter:\x20\x27'+_0xd9e1f1+_0x41d6a2(0x159)+_0xf62724+'\x27)'));}}console[_0x41d6a2(0xb8)](_0x41d6a2(0x136),_0x3270ed[_0x41d6a2(0x197)]);_0x1bb7d5&&(_0x3270ed[_0x41d6a2(0xe6)]=_0x1bb7d5);_0x34f26e&&(_0x3270ed[_0x41d6a2(0x186)]=_0x34f26e['toUpperCase'](),console[_0x41d6a2(0xb8)](_0x41d6a2(0x190)+_0x34f26e[_0x41d6a2(0xa5)]()));(_0x2c1080||_0x586d96)&&(_0x3270ed[_0x41d6a2(0x1c5)]={},_0x2c1080&&(_0x3270ed[_0x41d6a2(0x1c5)][_0x41d6a2(0x81)]=new Date(_0x2c1080)),_0x586d96&&(_0x3270ed['createdAt'][_0x41d6a2(0xc3)]=new Date(_0x586d96)));_0x50d936&&(_0x3270ed['OR']=[{'id':{'contains':_0x50d936,'mode':'insensitive'}},{'orderId':{'contains':_0x50d936,'mode':_0x41d6a2(0x100)}},{'gatewayOrderId':{'contains':_0x50d936,'mode':_0x41d6a2(0x100)}},{'customerEmail':{'contains':_0x50d936,'mode':_0x41d6a2(0x100)}},{'shop':{'name':{'contains':_0x50d936,'mode':_0x41d6a2(0x100)}}},{'shop':{'username':{'contains':_0x50d936,'mode':_0x41d6a2(0x100)}}}]);console[_0x41d6a2(0xb8)](_0x41d6a2(0x102),JSON[_0x41d6a2(0x1a8)](_0x3270ed,null,0x2));let _0x5a1537={'createdAt':_0x41d6a2(0x144)};if(_0x4b559e){const _0x1a0772=[_0x41d6a2(0xbc),_0x41d6a2(0x1c5),_0x41d6a2(0x1a5),_0x41d6a2(0x11b),_0x41d6a2(0x197),'currency'],_0x5c3c3e=[_0x41d6a2(0x1c2),'desc'];if(_0x1a0772[_0x41d6a2(0xc6)](_0x4b559e)){const _0x324beb=_0x5c3c3e[_0x41d6a2(0xc6)](_0x5a620b)?_0x5a620b:'desc';_0x5a1537={[_0x4b559e]:_0x324beb},console[_0x41d6a2(0xb8)](_0x41d6a2(0xd5)+_0x4b559e+_0x41d6a2(0x12e)+_0x324beb+'\x20order');}}const [_0x404e84,_0x30c252]=await Promise['all']([database_1['default']['payment']['findMany']({'where':_0x3270ed,'skip':_0x57511f,'take':_0x54f8bc,'orderBy':_0x5a1537,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x41d6a2(0xc8)][_0x41d6a2(0xf2)][_0x41d6a2(0xd4)]({'where':_0x3270ed})]);return{'payments':_0x404e84,'pagination':{'page':_0x307df7,'limit':_0x54f8bc,'total':_0x30c252,'totalPages':Math[_0x41d6a2(0xca)](_0x30c252/_0x54f8bc)}};}async['getPaymentById'](_0x590f6b){const _0x55ab3e=a36_0x5d61f1,_0x181b18=await database_1['default'][_0x55ab3e(0xf2)][_0x55ab3e(0xf6)]({'where':{'id':_0x590f6b},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x181b18)return null;return{'id':_0x181b18['id'],'shopId':_0x181b18[_0x55ab3e(0xe6)],'gateway':_0x181b18[_0x55ab3e(0x197)],'amount':_0x181b18['amount'],'currency':_0x181b18[_0x55ab3e(0x186)],'status':_0x181b18[_0x55ab3e(0x11b)],'orderId':_0x181b18[_0x55ab3e(0x194)],'gatewayOrderId':_0x181b18[_0x55ab3e(0x12a)],'customerEmail':_0x181b18[_0x55ab3e(0x85)],'customerName':_0x181b18[_0x55ab3e(0x117)],'customerCountry':_0x181b18[_0x55ab3e(0xfc)],'customerIp':_0x181b18[_0x55ab3e(0xfb)],'customerUa':_0x181b18[_0x55ab3e(0x119)],'failureMessage':_0x181b18[_0x55ab3e(0x9e)],'externalPaymentUrl':_0x181b18[_0x55ab3e(0x14b)],'successUrl':_0x181b18[_0x55ab3e(0xdd)],'failUrl':_0x181b18[_0x55ab3e(0x173)],'pendingUrl':_0x181b18['pendingUrl'],'whiteUrl':_0x181b18[_0x55ab3e(0x17a)],'createdAt':_0x181b18[_0x55ab3e(0x1c5)],'updatedAt':_0x181b18['updatedAt'],'shop':_0x181b18[_0x55ab3e(0x137)]};}async[a36_0x5d61f1(0x1b9)](_0x229488,_0x1098ce,_0x3008bc,_0x3644b0){const _0x10d9ec=a36_0x5d61f1,_0xe0f033=await database_1[_0x10d9ec(0xc8)]['$transaction'](async _0x5a438d=>{const _0x140809=_0x10d9ec,_0x19c9c1=await _0x5a438d[_0x140809(0xf2)][_0x140809(0xf6)]({'where':{'id':_0x229488},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x19c9c1)throw new Error(_0x140809(0x17f));const _0x12af9d=_0x19c9c1[_0x140809(0x11b)],_0x3323c8=_0x1098ce[_0x140809(0xa5)]();console['log'](_0x140809(0x161)+_0x229488+_0x140809(0x8f)+_0x12af9d+_0x140809(0xab)+_0x3323c8),console[_0x140809(0xb8)](_0x140809(0x13e)+_0x19c9c1['shop'][_0x140809(0x146)]+_0x140809(0x15d));const _0x1d9121={'status':_0x3323c8,'updatedAt':new Date(),'statusChangedBy':_0x140809(0xf7),'statusChangedAt':new Date()};_0x3008bc&&(_0x1d9121[_0x140809(0x12c)]=_0x3008bc);_0x3323c8===_0x140809(0x14a)&&_0x3644b0&&(_0x1d9121[_0x140809(0x1b3)]=_0x3644b0);let _0x290fa0=0x0,_0x4b315a=_0x19c9c1['shop'][_0x140809(0x146)];if(_0x3323c8===_0x140809(0x99)&&_0x12af9d!==_0x140809(0x99)){_0x1d9121['paidAt']=new Date();const _0x201215=await currencyService_1[_0x140809(0x17d)][_0x140809(0x8a)](_0x19c9c1[_0x140809(0xbc)],_0x19c9c1[_0x140809(0x186)]);_0x1d9121[_0x140809(0xb0)]=_0x201215;let _0x585d43=0xa;const _0x589efc=await _0x5a438d[_0x140809(0x137)][_0x140809(0xf6)]({'where':{'id':_0x19c9c1[_0x140809(0xe6)]},'select':{'gatewaySettings':!![]}});if(_0x589efc?.['gatewaySettings'])try{const _0x1f563f=JSON[_0x140809(0x1bd)](_0x589efc['gatewaySettings']);for(const [_0x15bf70,_0x26ef7b]of Object['entries'](_0x1f563f)){if(_0x15bf70['toLowerCase']()===_0x19c9c1[_0x140809(0x197)][_0x140809(0x1b2)]()){_0x585d43=_0x26ef7b[_0x140809(0x14c)]||0xa;break;}}}catch(_0x44ade4){console[_0x140809(0xd3)](_0x140809(0x109)+_0x229488+':',_0x44ade4);}let _0x10143c;_0x19c9c1['amountAfterGatewayCommissionUSDT']!==null&&_0x19c9c1[_0x140809(0x181)]!==undefined?(_0x10143c=_0x19c9c1['amountAfterGatewayCommissionUSDT'],console[_0x140809(0xb8)](_0x140809(0xba)+_0x10143c[_0x140809(0x14f)](0x6)+_0x140809(0x9d)+_0x229488)):(_0x10143c=_0x201215*(0x1-_0x585d43/0x64),console[_0x140809(0xb8)](_0x140809(0x11f)+_0x229488+':\x20'+_0x585d43+_0x140809(0x179)+_0x201215[_0x140809(0x14f)](0x6)+'\x20USDT'),_0x1d9121[_0x140809(0x181)]=_0x10143c),_0x290fa0=_0x10143c,_0x4b315a+=_0x10143c,console['log']('üí∞\x20Payment\x20'+_0x229488+_0x140809(0x11e)),console['log'](_0x140809(0x111)+_0x201215[_0x140809(0x14f)](0x6)+_0x140809(0x15d)),console[_0x140809(0xb8)](_0x140809(0x106)+_0x19c9c1['gateway']+_0x140809(0x112)+_0x585d43+'%'),console[_0x140809(0xb8)](_0x140809(0x142)+_0x10143c[_0x140809(0x14f)](0x6)+_0x140809(0x114)+_0x585d43+_0x140809(0xb1)),console[_0x140809(0xb8)](_0x140809(0xd2)+_0x10143c[_0x140809(0x14f)](0x6)+_0x140809(0x15d));}else{if(_0x12af9d===_0x140809(0x99)&&_0x3323c8!==_0x140809(0x99)){if(_0x19c9c1[_0x140809(0xb0)]){let _0x16a97e=0xa;const _0x301cd5=await _0x5a438d['shop'][_0x140809(0xf6)]({'where':{'id':_0x19c9c1[_0x140809(0xe6)]},'select':{'gatewaySettings':!![]}});if(_0x301cd5?.[_0x140809(0x134)])try{const _0x10d3f5=JSON[_0x140809(0x1bd)](_0x301cd5[_0x140809(0x134)]);for(const [_0x40e889,_0x274d73]of Object[_0x140809(0x138)](_0x10d3f5)){if(_0x40e889[_0x140809(0x1b2)]()===_0x19c9c1['gateway'][_0x140809(0x1b2)]()){_0x16a97e=_0x274d73[_0x140809(0x14c)]||0xa;break;}}}catch(_0x428410){console[_0x140809(0xd3)](_0x140809(0x109)+_0x229488+':',_0x428410);}const _0x9f3877=_0x19c9c1['amountUSDT']*(0x1-_0x16a97e/0x64);_0x290fa0=-_0x9f3877,_0x4b315a-=_0x9f3877,_0x1d9121['amountUSDT']=null,_0x1d9121[_0x140809(0x181)]=null,console['log'](_0x140809(0x177)+_0x229488+_0x140809(0x143)),console[_0x140809(0xb8)](_0x140809(0x111)+_0x19c9c1[_0x140809(0xb0)][_0x140809(0x14f)](0x6)+_0x140809(0x15d)),console[_0x140809(0xb8)](_0x140809(0x106)+_0x19c9c1[_0x140809(0x197)]+',\x20Commission:\x20'+_0x16a97e+'%'),console['log']('\x20\x20\x20Merchant\x20loses:\x20'+_0x9f3877[_0x140809(0x14f)](0x6)+'\x20USDT\x20(after\x20'+_0x16a97e+_0x140809(0xb1)),console['log'](_0x140809(0x16a)+_0x9f3877[_0x140809(0x14f)](0x6)+_0x140809(0x15d));}}}_0x3323c8===_0x140809(0x14a)&&(_0x12af9d===_0x140809(0x99)&&_0x19c9c1[_0x140809(0xb0)]&&console[_0x140809(0xb8)](_0x140809(0xe1)),_0x3644b0&&_0x3644b0>0x0&&(_0x290fa0-=_0x3644b0,_0x4b315a-=_0x3644b0,console[_0x140809(0xb8)](_0x140809(0x19f)+_0x3644b0[_0x140809(0x14f)](0x6)+_0x140809(0x18a))));_0x3323c8===_0x140809(0x166)&&_0x12af9d===_0x140809(0x99)&&console[_0x140809(0xb8)]('üîÑ\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance');const _0x179109=await _0x5a438d['payment']['update']({'where':{'id':_0x229488},'data':_0x1d9121,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x290fa0!==0x0&&(await _0x5a438d[_0x140809(0x137)][_0x140809(0x11a)]({'where':{'id':_0x19c9c1[_0x140809(0xe6)]},'data':{'balance':_0x4b315a}}),console[_0x140809(0xb8)](_0x140809(0x9c)+_0x19c9c1['shopId']+_0x140809(0x10a)+_0x19c9c1['shop'][_0x140809(0x146)][_0x140809(0x14f)](0x6)+_0x140809(0xab)+_0x4b315a['toFixed'](0x6)+_0x140809(0x148)+(_0x290fa0>0x0?'+':'')+_0x290fa0[_0x140809(0x14f)](0x6)+')')),_0x179109;});return{'id':_0xe0f033['id'],'shopId':_0xe0f033[_0x10d9ec(0xe6)],'gateway':_0xe0f033['gateway'],'amount':_0xe0f033['amount'],'currency':_0xe0f033['currency'],'status':_0xe0f033[_0x10d9ec(0x11b)],'orderId':_0xe0f033[_0x10d9ec(0x194)],'gatewayOrderId':_0xe0f033[_0x10d9ec(0x12a)],'customerEmail':_0xe0f033[_0x10d9ec(0x85)],'customerName':_0xe0f033[_0x10d9ec(0x117)],'customerCountry':_0xe0f033[_0x10d9ec(0xfc)],'customerIp':_0xe0f033[_0x10d9ec(0xfb)],'customerUa':_0xe0f033['customerUa'],'failureMessage':_0xe0f033[_0x10d9ec(0x9e)],'adminNotes':_0xe0f033[_0x10d9ec(0x12c)],'chargebackAmount':_0xe0f033[_0x10d9ec(0x1b3)],'statusChangedBy':_0xe0f033[_0x10d9ec(0x162)],'statusChangedAt':_0xe0f033[_0x10d9ec(0x17c)],'createdAt':_0xe0f033[_0x10d9ec(0x1c5)],'updatedAt':_0xe0f033['updatedAt'],'shop':_0xe0f033['shop']};}async[a36_0x5d61f1(0x180)](_0x3d2481,_0x480771){const _0x22d848=a36_0x5d61f1,_0x588751=Math[_0x22d848(0x14e)]()[_0x22d848(0x1c1)](0x24)[_0x22d848(0x1b7)](0x2,0x9);console[_0x22d848(0xb8)](_0x22d848(0x1a6)+_0x588751+_0x22d848(0xbd)+_0x3d2481);const _0x12ded5={..._0x480771};_0x480771[_0x22d848(0x150)]&&_0x480771[_0x22d848(0x150)][_0x22d848(0x15e)]()!==''?(console[_0x22d848(0xb8)](_0x22d848(0x1bf)+_0x588751+_0x22d848(0x95)+_0x3d2481),_0x12ded5[_0x22d848(0x150)]=await bcryptjs_1[_0x22d848(0xc8)][_0x22d848(0x158)](_0x480771[_0x22d848(0x150)],0xc)):(console[_0x22d848(0xb8)](_0x22d848(0x1bf)+_0x588751+_0x22d848(0x12f)),delete _0x12ded5[_0x22d848(0x150)]);_0x480771[_0x22d848(0x89)]&&(_0x12ded5['name']=_0x480771[_0x22d848(0x89)],delete _0x12ded5[_0x22d848(0x89)]);_0x480771[_0x22d848(0x12b)]&&(_0x12ded5[_0x22d848(0xa6)]=_0x480771[_0x22d848(0x12b)],delete _0x12ded5[_0x22d848(0x12b)]);_0x480771[_0x22d848(0x139)]&&(_0x12ded5[_0x22d848(0x182)]=_0x480771[_0x22d848(0x139)],delete _0x12ded5[_0x22d848(0x139)]);if(_0x480771[_0x22d848(0x87)]){const _0x33b534=_0x480771['gateways'][_0x22d848(0x1ac)](_0x3482e4=>this[_0x22d848(0x120)](_0x3482e4));console[_0x22d848(0xb8)](_0x22d848(0x84),_0x480771[_0x22d848(0x87)],'->',_0x33b534),_0x12ded5[_0x22d848(0x130)]=JSON[_0x22d848(0x1a8)](_0x33b534),delete _0x12ded5[_0x22d848(0x87)];}_0x480771[_0x22d848(0x134)]&&(console[_0x22d848(0xb8)](_0x22d848(0x15c)+_0x588751+']\x20Gateway\x20settings\x20before\x20saving:',_0x480771[_0x22d848(0x134)]),_0x12ded5['gatewaySettings']=JSON[_0x22d848(0x1a8)](_0x480771[_0x22d848(0x134)]),console[_0x22d848(0xb8)](_0x22d848(0x15c)+_0x588751+_0x22d848(0x1c4),_0x12ded5[_0x22d848(0x134)]));_0x480771[_0x22d848(0x164)]&&(_0x480771[_0x22d848(0x164)][_0x22d848(0xcc)]!==undefined&&(_0x12ded5[_0x22d848(0xcc)]=_0x480771[_0x22d848(0x164)][_0x22d848(0xcc)]||null),_0x480771[_0x22d848(0x164)][_0x22d848(0x9b)]!==undefined&&(_0x12ded5['usdtTrcWallet']=_0x480771['wallets'][_0x22d848(0x9b)]||null),_0x480771[_0x22d848(0x164)][_0x22d848(0x125)]!==undefined&&(_0x12ded5[_0x22d848(0x125)]=_0x480771[_0x22d848(0x164)][_0x22d848(0x125)]||null),_0x480771[_0x22d848(0x164)]['usdcPolygonWallet']!==undefined&&(_0x12ded5[_0x22d848(0xb7)]=_0x480771[_0x22d848(0x164)][_0x22d848(0xb7)]||null),delete _0x12ded5[_0x22d848(0x164)]);const _0x2738de=await database_1[_0x22d848(0xc8)]['shop'][_0x22d848(0x11a)]({'where':{'id':_0x3d2481},'data':_0x12ded5,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0x22d848(0xb8)](_0x22d848(0x94)+_0x588751+_0x22d848(0x192),_0x2738de['gatewaySettings']),{'id':_0x2738de['id'],'fullName':_0x2738de[_0x22d848(0x16d)],'username':_0x2738de[_0x22d848(0xf8)],'telegramId':_0x2738de[_0x22d848(0xa6)],'merchantUrl':_0x2738de[_0x22d848(0x182)],'gateways':_0x2738de['paymentGateways']?JSON[_0x22d848(0x1bd)](_0x2738de[_0x22d848(0x130)]):null,'gatewaySettings':_0x2738de['gatewaySettings']?JSON[_0x22d848(0x1bd)](_0x2738de['gatewaySettings']):null,'publicKey':_0x2738de[_0x22d848(0x1a9)],'wallets':{'usdtPolygonWallet':_0x2738de['usdtPolygonWallet'],'usdtTrcWallet':_0x2738de['usdtTrcWallet'],'usdtErcWallet':_0x2738de[_0x22d848(0x125)],'usdcPolygonWallet':_0x2738de[_0x22d848(0xb7)]},'status':_0x2738de[_0x22d848(0x11b)],'createdAt':_0x2738de[_0x22d848(0x1c5)]};}async[a36_0x5d61f1(0xfd)](_0x14b6d3){const _0x2f309c=a36_0x5d61f1,_0x1f2dc0=await database_1['default']['shop']['update']({'where':{'id':_0x14b6d3},'data':{'status':'SUSPENDED'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x1f2dc0['id'],'fullName':_0x1f2dc0['name'],'username':_0x1f2dc0[_0x2f309c(0xf8)],'telegramId':_0x1f2dc0[_0x2f309c(0xa6)],'merchantUrl':_0x1f2dc0[_0x2f309c(0x182)],'gateways':_0x1f2dc0['paymentGateways']?JSON[_0x2f309c(0x1bd)](_0x1f2dc0[_0x2f309c(0x130)]):null,'gatewaySettings':_0x1f2dc0[_0x2f309c(0x134)]?JSON['parse'](_0x1f2dc0[_0x2f309c(0x134)]):null,'publicKey':_0x1f2dc0[_0x2f309c(0x1a9)],'wallets':{'usdtPolygonWallet':_0x1f2dc0[_0x2f309c(0xcc)],'usdtTrcWallet':_0x1f2dc0[_0x2f309c(0x9b)],'usdtErcWallet':_0x1f2dc0[_0x2f309c(0x125)],'usdcPolygonWallet':_0x1f2dc0[_0x2f309c(0xb7)]},'status':_0x1f2dc0[_0x2f309c(0x11b)],'createdAt':_0x1f2dc0[_0x2f309c(0x1c5)]};}async['activateUser'](_0x5bbfba){const _0x2b202f=a36_0x5d61f1,_0x4a2961=await database_1[_0x2b202f(0xc8)][_0x2b202f(0x137)]['update']({'where':{'id':_0x5bbfba},'data':{'status':_0x2b202f(0x163)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4a2961['id'],'fullName':_0x4a2961[_0x2b202f(0x16d)],'username':_0x4a2961[_0x2b202f(0xf8)],'telegramId':_0x4a2961[_0x2b202f(0xa6)],'merchantUrl':_0x4a2961[_0x2b202f(0x182)],'gateways':_0x4a2961[_0x2b202f(0x130)]?JSON['parse'](_0x4a2961[_0x2b202f(0x130)]):null,'gatewaySettings':_0x4a2961['gatewaySettings']?JSON[_0x2b202f(0x1bd)](_0x4a2961[_0x2b202f(0x134)]):null,'publicKey':_0x4a2961['publicKey'],'wallets':{'usdtPolygonWallet':_0x4a2961[_0x2b202f(0xcc)],'usdtTrcWallet':_0x4a2961[_0x2b202f(0x9b)],'usdtErcWallet':_0x4a2961[_0x2b202f(0x125)],'usdcPolygonWallet':_0x4a2961[_0x2b202f(0xb7)]},'status':_0x4a2961[_0x2b202f(0x11b)],'createdAt':_0x4a2961[_0x2b202f(0x1c5)]};}async[a36_0x5d61f1(0xd0)](_0x2933bd){const _0x305fb0=a36_0x5d61f1,{page:_0x519c32,limit:_0x55fc00,status:_0x2d88d4}=_0x2933bd,_0xebb71=(_0x519c32-0x1)*_0x55fc00,_0x2b9bf0={};_0x2d88d4&&(_0x2b9bf0['status']=_0x2d88d4[_0x305fb0(0xa5)]());const [_0x57e727,_0x4809d1]=await Promise[_0x305fb0(0x91)]([database_1[_0x305fb0(0xc8)]['shop']['findMany']({'where':_0x2b9bf0,'skip':_0xebb71,'take':_0x55fc00,'orderBy':{'createdAt':_0x305fb0(0x144)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x305fb0(0xc8)][_0x305fb0(0x137)]['count']({'where':_0x2b9bf0})]);return{'users':_0x57e727['map'](_0x3334c2=>{const _0x3ab64a=_0x305fb0,_0x5b0170=_0x3334c2[_0x3ab64a(0x130)]?JSON[_0x3ab64a(0x1bd)](_0x3334c2[_0x3ab64a(0x130)]):null,_0x3a4b9b=_0x5b0170?_0x5b0170[_0x3ab64a(0x1ac)](_0x20c857=>this[_0x3ab64a(0x13d)](_0x20c857)):null;return{'id':_0x3334c2['id'],'fullName':_0x3334c2[_0x3ab64a(0x16d)],'username':_0x3334c2[_0x3ab64a(0xf8)],'telegramId':_0x3334c2['telegram'],'merchantUrl':_0x3334c2[_0x3ab64a(0x182)],'gateways':_0x3a4b9b,'gatewaySettings':_0x3334c2[_0x3ab64a(0x134)]?JSON[_0x3ab64a(0x1bd)](_0x3334c2[_0x3ab64a(0x134)]):null,'publicKey':_0x3334c2[_0x3ab64a(0x1a9)],'wallets':{'usdtPolygonWallet':_0x3334c2[_0x3ab64a(0xcc)],'usdtTrcWallet':_0x3334c2['usdtTrcWallet'],'usdtErcWallet':_0x3334c2[_0x3ab64a(0x125)],'usdcPolygonWallet':_0x3334c2[_0x3ab64a(0xb7)]},'status':_0x3334c2['status'],'createdAt':_0x3334c2[_0x3ab64a(0x1c5)]};}),'pagination':{'page':_0x519c32,'limit':_0x55fc00,'total':_0x4809d1,'totalPages':Math[_0x305fb0(0xca)](_0x4809d1/_0x55fc00)}};}async[a36_0x5d61f1(0xc9)](_0x56dfe8){const _0x56496a=a36_0x5d61f1,_0x529525=await database_1[_0x56496a(0xc8)][_0x56496a(0x137)][_0x56496a(0xf6)]({'where':{'id':_0x56dfe8},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x529525)return null;const _0x510da4=_0x529525[_0x56496a(0x130)]?JSON[_0x56496a(0x1bd)](_0x529525[_0x56496a(0x130)]):null,_0x78dc9c=_0x510da4?_0x510da4['map'](_0x305ff4=>this[_0x56496a(0x13d)](_0x305ff4)):null;return _0x510da4&&_0x78dc9c&&console[_0x56496a(0xb8)](_0x56496a(0xa4),_0x510da4,'->',_0x78dc9c),{'id':_0x529525['id'],'fullName':_0x529525[_0x56496a(0x16d)],'username':_0x529525[_0x56496a(0xf8)],'telegramId':_0x529525[_0x56496a(0xa6)],'merchantUrl':_0x529525[_0x56496a(0x182)],'gateways':_0x78dc9c,'gatewaySettings':_0x529525[_0x56496a(0x134)]?JSON['parse'](_0x529525[_0x56496a(0x134)]):null,'publicKey':_0x529525[_0x56496a(0x1a9)],'wallets':{'usdtPolygonWallet':_0x529525[_0x56496a(0xcc)],'usdtTrcWallet':_0x529525[_0x56496a(0x9b)],'usdtErcWallet':_0x529525[_0x56496a(0x125)],'usdcPolygonWallet':_0x529525[_0x56496a(0xb7)]},'status':_0x529525[_0x56496a(0x11b)],'createdAt':_0x529525[_0x56496a(0x1c5)]};}async['createUser'](_0x5cc949){const _0x16af66=a36_0x5d61f1,{fullName:_0x403dd9,username:_0x355b0e,password:_0x111e4d,telegramId:_0x381e09,merchantUrl:_0x1aaeb8,gateways:_0x12e54e,gatewaySettings:_0x52391c,wallets:_0x50e65a}=_0x5cc949,_0x21e71a=await database_1['default'][_0x16af66(0x137)]['findUnique']({'where':{'username':_0x355b0e}});if(_0x21e71a)throw new Error(_0x16af66(0x123));if(_0x381e09){const _0x9f6eff=await database_1[_0x16af66(0xc8)]['shop'][_0x16af66(0xf6)]({'where':{'telegram':_0x381e09}});if(_0x9f6eff)throw new Error(_0x16af66(0x167));}const _0x297822=await bcryptjs_1[_0x16af66(0xc8)][_0x16af66(0x158)](_0x111e4d,0xc),_0xba472a=_0x16af66(0x156)+crypto_1[_0x16af66(0xc8)][_0x16af66(0x96)](0x20)[_0x16af66(0x1c1)](_0x16af66(0x135)),_0x52af9d=_0x16af66(0x126)+crypto_1['default'][_0x16af66(0x96)](0x20)[_0x16af66(0x1c1)](_0x16af66(0x135)),_0x369dea=_0x12e54e?_0x12e54e[_0x16af66(0x1ac)](_0x3542d6=>this['getGatewayInternalName'](_0x3542d6)):null;_0x12e54e&&_0x369dea&&console['log'](_0x16af66(0x171),_0x12e54e,'->',_0x369dea);const _0xce869a=await database_1['default']['shop'][_0x16af66(0x16f)]({'data':{'name':_0x403dd9,'username':_0x355b0e,'password':_0x297822,'telegram':_0x381e09,'shopUrl':_0x1aaeb8,'paymentGateways':_0x369dea?JSON[_0x16af66(0x1a8)](_0x369dea):null,'gatewaySettings':_0x52391c?JSON[_0x16af66(0x1a8)](_0x52391c):null,'usdtPolygonWallet':_0x50e65a?.['usdtPolygonWallet']||null,'usdtTrcWallet':_0x50e65a?.[_0x16af66(0x9b)]||null,'usdtErcWallet':_0x50e65a?.[_0x16af66(0x125)]||null,'usdcPolygonWallet':_0x50e65a?.['usdcPolygonWallet']||null,'publicKey':_0xba472a,'secretKey':_0x52af9d,'status':_0x16af66(0x163)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0xce869a['id'],'fullName':_0xce869a['name'],'username':_0xce869a[_0x16af66(0xf8)],'telegramId':_0xce869a[_0x16af66(0xa6)],'merchantUrl':_0xce869a['shopUrl'],'gateways':_0xce869a[_0x16af66(0x130)]?JSON['parse'](_0xce869a['paymentGateways']):null,'gatewaySettings':_0xce869a[_0x16af66(0x134)]?JSON[_0x16af66(0x1bd)](_0xce869a[_0x16af66(0x134)]):null,'publicKey':_0xce869a[_0x16af66(0x1a9)],'wallets':{'usdtPolygonWallet':_0xce869a[_0x16af66(0xcc)],'usdtTrcWallet':_0xce869a[_0x16af66(0x9b)],'usdtErcWallet':_0xce869a[_0x16af66(0x125)],'usdcPolygonWallet':_0xce869a['usdcPolygonWallet']},'status':_0xce869a[_0x16af66(0x11b)],'createdAt':_0xce869a[_0x16af66(0x1c5)]};}async['deleteUser'](_0x4551c7){const _0x59ef4b=a36_0x5d61f1;await database_1[_0x59ef4b(0xc8)]['shop'][_0x59ef4b(0xdb)]({'where':{'id':_0x4551c7}});}['generateDailyStatistics'](_0x164a4d,_0x52f4a8,_0x4a18d6){const _0x300fdb=a36_0x5d61f1,_0x58b783=new Map(),_0x55e314=new Date(_0x52f4a8);while(_0x55e314<=_0x4a18d6){const _0x1d4e0b=_0x55e314[_0x300fdb(0x168)]()[_0x300fdb(0xd8)]('T')[0x0];_0x58b783[_0x300fdb(0x16c)](_0x1d4e0b,{'revenue':0x0,'count':0x0}),_0x55e314[_0x300fdb(0x10d)](_0x55e314[_0x300fdb(0x19e)]()+0x1);}for(const _0xd7d3b7 of _0x164a4d){const _0x330368=_0xd7d3b7['createdAt'][_0x300fdb(0x168)]()['split']('T')[0x0],_0x192ca0=_0x58b783[_0x300fdb(0x131)](_0x330368);_0x192ca0&&(_0x192ca0['count']+=0x1,_0xd7d3b7['status']===_0x300fdb(0x99)&&(_0xd7d3b7['amountUSDT']?_0x192ca0[_0x300fdb(0x1a3)]+=_0xd7d3b7[_0x300fdb(0xb0)]:console[_0x300fdb(0xb8)](_0x300fdb(0x198)+_0xd7d3b7['id']+'\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion')));}const _0x2c0a36=[],_0x5b45f5=[];for(const [_0x24d4b6,_0x23f44e]of _0x58b783){_0x2c0a36[_0x300fdb(0xa3)]({'date':_0x24d4b6,'amount':Math[_0x300fdb(0x17b)](_0x23f44e['revenue']*0x64)/0x64}),_0x5b45f5[_0x300fdb(0xa3)]({'date':_0x24d4b6,'count':_0x23f44e['count']});}return{'dailyRevenue':_0x2c0a36,'dailyPayments':_0x5b45f5};}}exports[a36_0x5d61f1(0x88)]=AdminService;