'use strict';const a35_0x51ad41=a35_0x3dc6;(function(_0x36aad5,_0x82cd4c){const _0xaae6fc=a35_0x3dc6,_0x526a10=_0x36aad5();while(!![]){try{const _0x2b264f=-parseInt(_0xaae6fc(0x1ba))/0x1+parseInt(_0xaae6fc(0x183))/0x2*(parseInt(_0xaae6fc(0x17a))/0x3)+parseInt(_0xaae6fc(0x155))/0x4+parseInt(_0xaae6fc(0x1e9))/0x5+-parseInt(_0xaae6fc(0x1a4))/0x6*(parseInt(_0xaae6fc(0x198))/0x7)+parseInt(_0xaae6fc(0x1a5))/0x8+parseInt(_0xaae6fc(0x221))/0x9*(-parseInt(_0xaae6fc(0x1ae))/0xa);if(_0x2b264f===_0x82cd4c)break;else _0x526a10['push'](_0x526a10['shift']());}catch(_0x30a0a8){_0x526a10['push'](_0x526a10['shift']());}}}(a35_0x1f96,0xcf31f));var __importDefault=this&&this[a35_0x51ad41(0x190)]||function(_0x4aeec6){const _0x5c1bd0=a35_0x51ad41;return _0x4aeec6&&_0x4aeec6[_0x5c1bd0(0x17b)]?_0x4aeec6:{'default':_0x4aeec6};};Object['defineProperty'](exports,a35_0x51ad41(0x17b),{'value':!![]}),exports['AdminService']=void 0x0;function a35_0x3dc6(_0x49c78e,_0x4f4958){const _0x1f9650=a35_0x1f96();return a35_0x3dc6=function(_0x3dc656,_0x643fac){_0x3dc656=_0x3dc656-0x155;let _0x5eb3ef=_0x1f9650[_0x3dc656];return _0x5eb3ef;},a35_0x3dc6(_0x49c78e,_0x4f4958);}const database_1=__importDefault(require(a35_0x51ad41(0x1e3))),bcryptjs_1=__importDefault(require(a35_0x51ad41(0x19b))),crypto_1=__importDefault(require('crypto')),currencyService_1=require(a35_0x51ad41(0x21c));class AdminService{async[a35_0x51ad41(0x218)](){const _0x328af4=a35_0x51ad41;console[_0x328af4(0x1b0)](_0x328af4(0x1be));const _0x1c5509=await database_1[_0x328af4(0x180)][_0x328af4(0x1fa)][_0x328af4(0x21e)]({'where':{'status':_0x328af4(0x157),'paidAt':{'not':null}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'merchantPaid':!![],'paidAt':!![],'createdAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x328af4(0x1b0)]('💰\x20Found\x20'+_0x1c5509[_0x328af4(0x1a8)]+_0x328af4(0x158));let _0x5594cb=0x0,_0x39e07f=0x0,_0x6b7b2a=0x0;for(const _0x20ee59 of _0x1c5509){try{const _0x389873=await currencyService_1[_0x328af4(0x194)][_0x328af4(0x213)](_0x20ee59[_0x328af4(0x20b)],_0x20ee59['currency']);let _0x49f77c={};if(_0x20ee59[_0x328af4(0x18a)][_0x328af4(0x1fd)])try{_0x49f77c=JSON[_0x328af4(0x222)](_0x20ee59[_0x328af4(0x18a)][_0x328af4(0x1fd)]);}catch(_0x2f917c){console[_0x328af4(0x1d9)](_0x328af4(0x17c)+_0x20ee59[_0x328af4(0x184)]+':',_0x2f917c);}const _0x19c2f6=_0x49f77c[_0x328af4(0x1b1)]||0xa,_0x1178da=_0x389873*(0x1-_0x19c2f6/0x64);_0x20ee59[_0x328af4(0x167)]?(_0x5594cb+=_0x1178da,console[_0x328af4(0x1b0)](_0x328af4(0x1b8)+_0x20ee59['id']+':\x20'+_0x1178da['toFixed'](0x2)+_0x328af4(0x1c2))):(_0x39e07f+=_0x1178da,_0x6b7b2a+=_0x389873,console[_0x328af4(0x1b0)](_0x328af4(0x220)+_0x20ee59['id']+':\x20'+_0x1178da[_0x328af4(0x1d7)](0x2)+_0x328af4(0x1d0)));}catch(_0x595ce6){console[_0x328af4(0x1d9)](_0x328af4(0x15d)+_0x20ee59['id']+':',_0x595ce6);}}const _0x186efd=new Date(),_0x2318b3=new Date(_0x186efd['getFullYear'](),_0x186efd[_0x328af4(0x189)](),0x1),_0x5824fc=new Date(_0x186efd[_0x328af4(0x196)](),_0x186efd[_0x328af4(0x189)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x38a607=await database_1[_0x328af4(0x180)]['payout']['findMany']({'where':{'createdAt':{'gte':_0x2318b3,'lte':_0x5824fc},'status':'COMPLETED'},'select':{'amount':!![]}}),_0x2c7a9d=_0x38a607[_0x328af4(0x16a)]((_0x1ea6e4,_0x2be1c5)=>_0x1ea6e4+_0x2be1c5[_0x328af4(0x20b)],0x0),_0x15c262={'totalPayout':Math[_0x328af4(0x1dc)](_0x5594cb*0x64)/0x64,'awaitingPayout':Math['round'](_0x39e07f*0x64)/0x64,'thisMonth':Math[_0x328af4(0x1dc)](_0x2c7a9d*0x64)/0x64,'availableBalance':Math['round'](_0x6b7b2a*0x64)/0x64};return console['log'](_0x328af4(0x1ac)),console['log'](_0x328af4(0x1d5)+_0x15c262[_0x328af4(0x1b4)]+'\x20USDT\x20(paid\x20to\x20merchants)'),console[_0x328af4(0x1b0)]('\x20\x20\x20⏳\x20Awaiting\x20payout:\x20'+_0x15c262[_0x328af4(0x1bd)]+_0x328af4(0x18d)),console[_0x328af4(0x1b0)](_0x328af4(0x1a1)+_0x15c262[_0x328af4(0x205)]+_0x328af4(0x1bc)),console['log']('\x20\x20\x20📅\x20This\x20month:\x20'+_0x15c262[_0x328af4(0x172)]+_0x328af4(0x1ea)),_0x15c262;}async['updateCustomerData'](_0x2cbd4c,_0x3a2186){const _0x1c3077=a35_0x51ad41;console[_0x1c3077(0x1b0)](_0x1c3077(0x1c3)+_0x2cbd4c+':',_0x3a2186);const _0x3262ff=await database_1[_0x1c3077(0x180)][_0x1c3077(0x1fa)]['findUnique']({'where':{'id':_0x2cbd4c},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x3262ff)throw new Error(_0x1c3077(0x177));const _0x3f1f83={};_0x3a2186[_0x1c3077(0x1cb)]!==undefined&&(_0x3f1f83[_0x1c3077(0x1cb)]=_0x3a2186[_0x1c3077(0x1cb)]||null);_0x3a2186['customerIp']!==undefined&&(_0x3f1f83[_0x1c3077(0x214)]=_0x3a2186[_0x1c3077(0x214)]||null);_0x3a2186[_0x1c3077(0x171)]!==undefined&&(_0x3f1f83['customerUa']=_0x3a2186[_0x1c3077(0x171)]||null);const _0x4e9f73=await database_1[_0x1c3077(0x180)][_0x1c3077(0x1fa)][_0x1c3077(0x1f3)]({'where':{'id':_0x2cbd4c},'data':{..._0x3f1f83,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console['log'](_0x1c3077(0x175)+_0x2cbd4c),console[_0x1c3077(0x1b0)](_0x1c3077(0x199)+_0x3262ff[_0x1c3077(0x1cb)]+_0x1c3077(0x1a3)+_0x4e9f73[_0x1c3077(0x1cb)]),console[_0x1c3077(0x1b0)](_0x1c3077(0x173)+_0x3262ff[_0x1c3077(0x214)]+_0x1c3077(0x1a3)+_0x4e9f73[_0x1c3077(0x214)]),console[_0x1c3077(0x1b0)](_0x1c3077(0x1ef)+(_0x3262ff['customerUa']?_0x1c3077(0x19e):'not\x20set')+_0x1c3077(0x1a3)+(_0x4e9f73[_0x1c3077(0x171)]?_0x1c3077(0x19e):_0x1c3077(0x1c1))),_0x4e9f73;}async[a35_0x51ad41(0x15b)](_0x273a80){const _0x5ae137=a35_0x51ad41,_0x333ecb=new Date();let _0x246ed6;switch(_0x273a80){case'7d':_0x246ed6=new Date(_0x333ecb[_0x5ae137(0x187)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x5ae137(0x16d):_0x246ed6=new Date(_0x333ecb[_0x5ae137(0x187)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x5ae137(0x1ee):_0x246ed6=new Date(_0x333ecb[_0x5ae137(0x187)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x246ed6=new Date(_0x333ecb['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x305cb4,_0x5b842b,_0x138b15,_0xa10e7a,_0x310097,_0xe9fff6]=await Promise[_0x5ae137(0x1c8)]([database_1[_0x5ae137(0x180)][_0x5ae137(0x18a)]['count'](),database_1['default'][_0x5ae137(0x18a)][_0x5ae137(0x1e6)]({'where':{'status':'ACTIVE'}}),database_1[_0x5ae137(0x180)][_0x5ae137(0x1fa)]['count']({'where':{'createdAt':{'gte':_0x246ed6},'gateway':{'not':_0x5ae137(0x1b7)}}}),database_1[_0x5ae137(0x180)][_0x5ae137(0x1fa)]['count']({'where':{'status':_0x5ae137(0x157),'createdAt':{'gte':_0x246ed6},'gateway':{'not':_0x5ae137(0x1b7)}}}),database_1['default'][_0x5ae137(0x1fa)][_0x5ae137(0x21e)]({'where':{'status':_0x5ae137(0x157),'createdAt':{'gte':_0x246ed6},'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![]}}),database_1[_0x5ae137(0x180)][_0x5ae137(0x1fa)][_0x5ae137(0x21e)]({'where':{'gateway':{'not':_0x5ae137(0x1b7)}},'take':0xa,'orderBy':{'createdAt':_0x5ae137(0x15a)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}})]);let _0x394623=0x0;for(const _0x1bc437 of _0x310097){const _0x2a74ff=await currencyService_1['currencyService']['convertToUSDT'](_0x1bc437[_0x5ae137(0x20b)],_0x1bc437[_0x5ae137(0x1ab)]);_0x394623+=_0x2a74ff;}const _0x1e6dd1=_0x138b15>0x0?_0xa10e7a/_0x138b15*0x64:0x0;return{'totalShops':_0x305cb4,'activeShops':_0x5b842b,'totalPayments':_0x138b15,'successfulPayments':_0xa10e7a,'totalRevenue':Math[_0x5ae137(0x1dc)](_0x394623*0x64)/0x64,'conversionRate':Math['round'](_0x1e6dd1*0x64)/0x64,'recentPayments':_0xe9fff6['map'](_0x1b86ae=>({'id':_0x1b86ae['id'],'amount':_0x1b86ae[_0x5ae137(0x20b)],'currency':_0x1b86ae[_0x5ae137(0x1ab)],'status':_0x1b86ae['status'],'gateway':_0x1b86ae[_0x5ae137(0x1e1)],'shop':_0x1b86ae[_0x5ae137(0x18a)],'createdAt':_0x1b86ae['createdAt']}))};}async[a35_0x51ad41(0x1f1)](_0xcef434){const _0x2d12f4=a35_0x51ad41;console[_0x2d12f4(0x1b0)](_0x2d12f4(0x1f2),_0xcef434);let _0x1b33fd,_0x4afb36=new Date();if(_0xcef434['period']===_0x2d12f4(0x19d)&&_0xcef434[_0x2d12f4(0x1ff)]&&_0xcef434[_0x2d12f4(0x197)])_0x1b33fd=new Date(_0xcef434[_0x2d12f4(0x1ff)]),_0x4afb36=new Date(_0xcef434[_0x2d12f4(0x197)]);else{const _0x2fb47d=new Date();switch(_0xcef434['period']){case _0x2d12f4(0x1a9):_0x1b33fd=new Date(_0x2fb47d[_0x2d12f4(0x187)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'month':_0x1b33fd=new Date(_0x2fb47d[_0x2d12f4(0x187)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x2d12f4(0x168):_0x1b33fd=new Date(_0x2fb47d[_0x2d12f4(0x187)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x2d12f4(0x1c8):default:_0x1b33fd=new Date('2020-01-01');break;}}console[_0x2d12f4(0x1b0)](_0x2d12f4(0x161)+_0x1b33fd[_0x2d12f4(0x1d1)]()+_0x2d12f4(0x1f4)+_0x4afb36[_0x2d12f4(0x1d1)]());const _0x2fe86d={'status':_0x2d12f4(0x157),'gateway':{'not':_0x2d12f4(0x1b7)},'paidAt':{'gte':_0x1b33fd,'lte':_0x4afb36}};_0xcef434[_0x2d12f4(0x184)]&&(_0x2fe86d[_0x2d12f4(0x184)]=_0xcef434['shopId']);const _0x5c1d21=await database_1['default'][_0x2d12f4(0x1fa)][_0x2d12f4(0x21e)]({'where':_0x2fe86d,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console['log']('💰\x20Found\x20'+_0x5c1d21['length']+_0x2d12f4(0x1eb));let _0x322210=0x0,_0x1acafa=0x0,_0x3fb624=0x0;const _0x334688={},_0x34b7ac={},_0x1de774={};for(const _0x2e20aa of _0x5c1d21){try{const _0xdc7b0b=await currencyService_1[_0x2d12f4(0x194)]['convertToUSDT'](_0x2e20aa['amount'],_0x2e20aa[_0x2d12f4(0x1ab)]);let _0x2923f1={};if(_0x2e20aa[_0x2d12f4(0x18a)]['gatewaySettings'])try{_0x2923f1=JSON[_0x2d12f4(0x222)](_0x2e20aa['shop'][_0x2d12f4(0x1fd)]);}catch(_0x2ca422){console[_0x2d12f4(0x1d9)](_0x2d12f4(0x17c)+_0x2e20aa[_0x2d12f4(0x184)]+':',_0x2ca422);}const _0x58b3ba=_0x2923f1[_0x2d12f4(0x1b1)]||0xa,_0x38a915=_0xdc7b0b*(_0x58b3ba/0x64),_0x5c808c=_0xdc7b0b-_0x38a915;_0x322210+=_0xdc7b0b,_0x1acafa+=_0x5c808c,_0x3fb624+=_0x38a915;!_0x334688[_0x2e20aa[_0x2d12f4(0x1e1)]]&&(_0x334688[_0x2e20aa[_0x2d12f4(0x1e1)]]={'gateway':_0x2e20aa[_0x2d12f4(0x1e1)],'gatewayDisplayName':this[_0x2d12f4(0x204)](_0x2e20aa[_0x2d12f4(0x1e1)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x334688[_0x2e20aa[_0x2d12f4(0x1e1)]][_0x2d12f4(0x182)]++,_0x334688[_0x2e20aa['gateway']][_0x2d12f4(0x19c)]+=_0xdc7b0b,_0x334688[_0x2e20aa['gateway']]['commissionUSDT']+=_0x38a915,_0x334688[_0x2e20aa[_0x2d12f4(0x1e1)]][_0x2d12f4(0x212)]+=_0x5c808c,_0x334688[_0x2e20aa[_0x2d12f4(0x1e1)]][_0x2d12f4(0x1b5)]+=_0x58b3ba;!_0xcef434[_0x2d12f4(0x184)]&&(!_0x34b7ac[_0x2e20aa[_0x2d12f4(0x184)]]&&(_0x34b7ac[_0x2e20aa[_0x2d12f4(0x184)]]={'shopId':_0x2e20aa[_0x2d12f4(0x184)],'shopName':_0x2e20aa['shop'][_0x2d12f4(0x164)],'shopUsername':_0x2e20aa['shop']['username'],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x34b7ac[_0x2e20aa[_0x2d12f4(0x184)]]['paymentsCount']++,_0x34b7ac[_0x2e20aa['shopId']]['turnoverUSDT']+=_0xdc7b0b,_0x34b7ac[_0x2e20aa[_0x2d12f4(0x184)]][_0x2d12f4(0x191)]+=_0x38a915,_0x34b7ac[_0x2e20aa[_0x2d12f4(0x184)]]['merchantEarningsUSDT']+=_0x5c808c);const _0x1a5816=_0x2e20aa[_0x2d12f4(0x165)][_0x2d12f4(0x1d1)]()['split']('T')[0x0];!_0x1de774[_0x1a5816]&&(_0x1de774[_0x1a5816]={'date':_0x1a5816,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x1de774[_0x1a5816][_0x2d12f4(0x1b2)]+=_0xdc7b0b,_0x1de774[_0x1a5816][_0x2d12f4(0x1f0)]+=_0x5c808c,_0x1de774[_0x1a5816][_0x2d12f4(0x18c)]+=_0x38a915,_0x1de774[_0x1a5816][_0x2d12f4(0x182)]++;}catch(_0x36fed5){console[_0x2d12f4(0x1d9)](_0x2d12f4(0x15d)+_0x2e20aa['id']+':',_0x36fed5);}}Object[_0x2d12f4(0x1a7)](_0x334688)['forEach'](_0x24329a=>{const _0x42a0a2=_0x2d12f4;_0x24329a['averageCommissionRate']=_0x24329a['paymentsCount']>0x0?_0x24329a[_0x42a0a2(0x1b5)]/_0x24329a[_0x42a0a2(0x182)]:0x0,delete _0x24329a[_0x42a0a2(0x1b5)];}),Object[_0x2d12f4(0x1a7)](_0x34b7ac)[_0x2d12f4(0x160)](_0x163e8c=>{const _0x5b2fbe=_0x2d12f4;_0x163e8c[_0x5b2fbe(0x1de)]=_0x163e8c[_0x5b2fbe(0x182)]>0x0?_0x163e8c[_0x5b2fbe(0x19c)]/_0x163e8c[_0x5b2fbe(0x182)]:0x0;});let _0x1af4bb=0x0;if(_0xcef434[_0x2d12f4(0x184)]){const _0x52c907=await database_1[_0x2d12f4(0x180)]['payout'][_0x2d12f4(0x21e)]({'where':{'shopId':_0xcef434[_0x2d12f4(0x184)],'status':_0x2d12f4(0x20a),'createdAt':{'gte':_0x1b33fd,'lte':_0x4afb36}},'select':{'amount':!![]}});_0x1af4bb=_0x52c907[_0x2d12f4(0x16a)]((_0x5477c1,_0x56b0d1)=>_0x5477c1+_0x56b0d1[_0x2d12f4(0x20b)],0x0);}const _0x1c47ec=_0x5c1d21[_0x2d12f4(0x1a8)],_0x54c6d2=_0x5c1d21['length'],_0x3b4fdc=_0x1c47ec>0x0?_0x322210/_0x1c47ec:0x0,_0x2ed600=0x64,_0x55c5c5=Math['ceil']((_0x4afb36['getTime']()-_0x1b33fd['getTime']())/(0x3e8*0x3c*0x3c*0x18)),_0x3fe93f={'totalTurnover':Math[_0x2d12f4(0x1dc)](_0x322210*0x64)/0x64,'merchantEarnings':Math[_0x2d12f4(0x1dc)](_0x1acafa*0x64)/0x64,'gatewayEarnings':Math[_0x2d12f4(0x1dc)](_0x3fb624*0x64)/0x64,'totalPaidOut':Math[_0x2d12f4(0x1dc)](_0x1af4bb*0x64)/0x64,'averageCheck':Math[_0x2d12f4(0x1dc)](_0x3b4fdc*0x64)/0x64,'totalPayments':_0x1c47ec,'successfulPayments':_0x54c6d2,'conversionRate':_0x2ed600,'gatewayBreakdown':Object[_0x2d12f4(0x1a7)](_0x334688)[_0x2d12f4(0x1ec)](_0x446928=>({..._0x446928,'turnoverUSDT':Math[_0x2d12f4(0x1dc)](_0x446928[_0x2d12f4(0x19c)]*0x64)/0x64,'commissionUSDT':Math[_0x2d12f4(0x1dc)](_0x446928['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x446928['merchantEarningsUSDT']*0x64)/0x64,'averageCommissionRate':Math[_0x2d12f4(0x1dc)](_0x446928[_0x2d12f4(0x1b6)]*0x64)/0x64})),'merchantBreakdown':_0xcef434[_0x2d12f4(0x184)]?undefined:Object['values'](_0x34b7ac)[_0x2d12f4(0x1ec)](_0x560335=>({..._0x560335,'turnoverUSDT':Math['round'](_0x560335['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x2d12f4(0x1dc)](_0x560335['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x560335[_0x2d12f4(0x212)]*0x64)/0x64,'paidOutUSDT':Math['round'](_0x560335['paidOutUSDT']*0x64)/0x64,'averageCheckUSDT':Math[_0x2d12f4(0x1dc)](_0x560335[_0x2d12f4(0x1de)]*0x64)/0x64})),'dailyData':Object['values'](_0x1de774)[_0x2d12f4(0x1ec)](_0x3f559a=>({..._0x3f559a,'turnover':Math[_0x2d12f4(0x1dc)](_0x3f559a[_0x2d12f4(0x1b2)]*0x64)/0x64,'merchantEarnings':Math['round'](_0x3f559a['merchantEarnings']*0x64)/0x64,'gatewayEarnings':Math[_0x2d12f4(0x1dc)](_0x3f559a['gatewayEarnings']*0x64)/0x64}))[_0x2d12f4(0x16c)]((_0x180efa,_0x4d41e9)=>_0x180efa[_0x2d12f4(0x1da)][_0x2d12f4(0x1d4)](_0x4d41e9[_0x2d12f4(0x1da)])),'periodInfo':{'from':_0x1b33fd,'to':_0x4afb36,'periodType':_0xcef434[_0x2d12f4(0x1d3)]||_0x2d12f4(0x19d),'daysCount':_0x55c5c5}};return console[_0x2d12f4(0x1b0)](_0x2d12f4(0x1cd)),console[_0x2d12f4(0x1b0)](_0x2d12f4(0x206)+_0x3fe93f[_0x2d12f4(0x1d8)]+_0x2d12f4(0x1ea)),console[_0x2d12f4(0x1b0)](_0x2d12f4(0x15c)+_0x3fe93f['merchantEarnings']+_0x2d12f4(0x1ea)),console[_0x2d12f4(0x1b0)](_0x2d12f4(0x208)+_0x3fe93f['gatewayEarnings']+_0x2d12f4(0x1ea)),console['log'](_0x2d12f4(0x1c0)+_0x3fe93f[_0x2d12f4(0x1c7)]),_0x3fe93f;}['getGatewayDisplayName'](_0x59f065){const _0x4bac8f=a35_0x51ad41,_0x32ba22={'plisio':_0x4bac8f(0x216),'rapyd':_0x4bac8f(0x16e),'noda':_0x4bac8f(0x1c9),'cointopay':_0x4bac8f(0x176),'klyme_eu':'KLYME\x20EU','klyme_gb':_0x4bac8f(0x1f9),'klyme_de':_0x4bac8f(0x159)};return _0x32ba22[_0x59f065]||_0x59f065;}async['getMerchantsAwaitingPayout'](_0x765040){const _0x48c14b=a35_0x51ad41,{page:_0x3fe663,limit:_0xa6e8bc,minAmount:_0x52007c,search:_0x855343}=_0x765040,_0x1b54ec=(_0x3fe663-0x1)*_0xa6e8bc;console[_0x48c14b(0x1b0)](_0x48c14b(0x1dd),_0x765040);const _0x3ff515=await database_1['default'][_0x48c14b(0x1fa)][_0x48c14b(0x21e)]({'where':{'status':_0x48c14b(0x157),'merchantPaid':![],'paidAt':{'not':null}},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'gatewaySettings':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}});console[_0x48c14b(0x1b0)](_0x48c14b(0x21d)+_0x3ff515[_0x48c14b(0x1a8)]+_0x48c14b(0x203));const _0x2f863d={};for(const _0x30a399 of _0x3ff515){const _0x42af73=_0x30a399[_0x48c14b(0x184)];!_0x2f863d[_0x42af73]&&(_0x2f863d[_0x42af73]={'id':_0x30a399[_0x48c14b(0x18a)]['id'],'fullName':_0x30a399[_0x48c14b(0x18a)][_0x48c14b(0x164)],'username':_0x30a399['shop'][_0x48c14b(0x1ce)],'telegramId':_0x30a399[_0x48c14b(0x18a)][_0x48c14b(0x215)],'merchantUrl':_0x30a399[_0x48c14b(0x18a)][_0x48c14b(0x202)],'wallets':{'usdtPolygonWallet':_0x30a399[_0x48c14b(0x18a)]['usdtPolygonWallet'],'usdtTrcWallet':_0x30a399['shop'][_0x48c14b(0x1e0)],'usdtErcWallet':_0x30a399[_0x48c14b(0x18a)][_0x48c14b(0x207)],'usdcPolygonWallet':_0x30a399['shop'][_0x48c14b(0x16f)]},'totalAmountUSDT':0x0,'totalAmountAfterCommissionUSDT':0x0,'paymentsCount':0x0,'oldestPaymentDate':_0x30a399[_0x48c14b(0x165)],'gatewayBreakdown':{},'gatewaySettings':_0x30a399[_0x48c14b(0x18a)][_0x48c14b(0x1fd)]});try{const _0x1057a2=await currencyService_1[_0x48c14b(0x194)]['convertToUSDT'](_0x30a399['amount'],_0x30a399[_0x48c14b(0x1ab)]);let _0xb6dbde={};if(_0x30a399[_0x48c14b(0x18a)][_0x48c14b(0x1fd)])try{_0xb6dbde=JSON[_0x48c14b(0x222)](_0x30a399['shop'][_0x48c14b(0x1fd)]);}catch(_0x3c6351){console[_0x48c14b(0x1d9)](_0x48c14b(0x17c)+_0x42af73+':',_0x3c6351);}const _0x2c71bb=_0xb6dbde[_0x48c14b(0x1b1)]||0xa,_0x3dc73a=_0x1057a2*(0x1-_0x2c71bb/0x64);_0x2f863d[_0x42af73][_0x48c14b(0x1c4)]+=_0x1057a2,_0x2f863d[_0x42af73][_0x48c14b(0x1a2)]+=_0x3dc73a,_0x2f863d[_0x42af73][_0x48c14b(0x182)]++,_0x30a399[_0x48c14b(0x165)]<_0x2f863d[_0x42af73][_0x48c14b(0x18b)]&&(_0x2f863d[_0x42af73]['oldestPaymentDate']=_0x30a399[_0x48c14b(0x165)]),!_0x2f863d[_0x42af73][_0x48c14b(0x209)][_0x30a399['gateway']]&&(_0x2f863d[_0x42af73]['gatewayBreakdown'][_0x30a399['gateway']]={'gateway':_0x30a399[_0x48c14b(0x1e1)],'count':0x0,'amountUSDT':0x0,'amountAfterCommissionUSDT':0x0,'commission':_0x2c71bb}),_0x2f863d[_0x42af73][_0x48c14b(0x209)][_0x30a399[_0x48c14b(0x1e1)]][_0x48c14b(0x1e6)]++,_0x2f863d[_0x42af73]['gatewayBreakdown'][_0x30a399['gateway']][_0x48c14b(0x185)]+=_0x1057a2,_0x2f863d[_0x42af73][_0x48c14b(0x209)][_0x30a399['gateway']][_0x48c14b(0x1cc)]+=_0x3dc73a;}catch(_0x1c76cb){console[_0x48c14b(0x1d9)](_0x48c14b(0x15d)+_0x30a399['id']+':',_0x1c76cb);}}let _0x1d06a=Object[_0x48c14b(0x1a7)](_0x2f863d)[_0x48c14b(0x1ec)](_0x416d07=>({..._0x416d07,'totalAmountUSDT':Math[_0x48c14b(0x1dc)](_0x416d07['totalAmountUSDT']*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x48c14b(0x1dc)](_0x416d07[_0x48c14b(0x1a2)]*0x64)/0x64,'gatewayBreakdown':Object['values'](_0x416d07[_0x48c14b(0x209)])[_0x48c14b(0x1ec)](_0x3bc445=>({..._0x3bc445,'amountUSDT':Math[_0x48c14b(0x1dc)](_0x3bc445[_0x48c14b(0x185)]*0x64)/0x64,'amountAfterCommissionUSDT':Math['round'](_0x3bc445['amountAfterCommissionUSDT']*0x64)/0x64}))}));_0x52007c&&(_0x1d06a=_0x1d06a[_0x48c14b(0x1e5)](_0xaa7b84=>_0xaa7b84['totalAmountAfterCommissionUSDT']>=_0x52007c));if(_0x855343){const _0x449aa5=_0x855343[_0x48c14b(0x1d2)]();_0x1d06a=_0x1d06a[_0x48c14b(0x1e5)](_0x51f48a=>_0x51f48a[_0x48c14b(0x19f)][_0x48c14b(0x1d2)]()[_0x48c14b(0x19a)](_0x449aa5)||_0x51f48a['username'][_0x48c14b(0x1d2)]()[_0x48c14b(0x19a)](_0x449aa5));}_0x1d06a[_0x48c14b(0x16c)]((_0x4d23b3,_0x58de37)=>_0x58de37[_0x48c14b(0x1a2)]-_0x4d23b3['totalAmountAfterCommissionUSDT']);const _0x1cfb80=_0x1d06a[_0x48c14b(0x1a8)],_0x170434=_0x1d06a['slice'](_0x1b54ec,_0x1b54ec+_0xa6e8bc),_0x590abf=_0x1d06a[_0x48c14b(0x16a)]((_0x41cdb3,_0x3202df)=>_0x41cdb3+_0x3202df['totalAmountUSDT'],0x0),_0x366535=_0x1d06a[_0x48c14b(0x16a)]((_0x380a88,_0x3fa4d0)=>_0x380a88+_0x3fa4d0[_0x48c14b(0x1a2)],0x0);return console[_0x48c14b(0x1b0)](_0x48c14b(0x1fc)+_0x1cfb80+_0x48c14b(0x156)+Math['round'](_0x366535*0x64)/0x64+'\x20USDT\x20total'),{'merchants':_0x170434,'pagination':{'page':_0x3fe663,'limit':_0xa6e8bc,'total':_0x1cfb80,'totalPages':Math[_0x48c14b(0x1db)](_0x1cfb80/_0xa6e8bc)},'summary':{'totalMerchants':_0x1cfb80,'totalAmountUSDT':Math[_0x48c14b(0x1dc)](_0x590abf*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x366535*0x64)/0x64}};}async[a35_0x51ad41(0x163)](_0x58c3d4){const _0x3271cf=a35_0x51ad41,{shopId:_0x4073d2,amount:_0x59bea2,network:_0x37bcd8,notes:_0x2d1f3d,periodFrom:_0x3fa8bd,periodTo:_0x1fa491}=_0x58c3d4,_0x2db2ce=await database_1[_0x3271cf(0x180)]['shop']['findUnique']({'where':{'id':_0x4073d2},'select':{'id':!![],'name':!![],'username':!![]}});if(!_0x2db2ce)throw new Error('Shop\x20not\x20found');const _0xaf3682=await database_1[_0x3271cf(0x180)][_0x3271cf(0x174)][_0x3271cf(0x192)]({'data':{'shopId':_0x4073d2,'amount':_0x59bea2,'network':_0x37bcd8,'status':_0x3271cf(0x20a),'notes':_0x2d1f3d,'periodFrom':_0x3fa8bd?new Date(_0x3fa8bd):null,'periodTo':_0x1fa491?new Date(_0x1fa491):null,'createdAt':new Date(),'paidAt':new Date()}});return console[_0x3271cf(0x1b0)](_0x3271cf(0x1bb)+_0xaf3682['id']+_0x3271cf(0x1b3)+_0x2db2ce['username']+'\x20('+_0x59bea2+_0x3271cf(0x1b9)),{'id':_0xaf3682['id'],'shopId':_0xaf3682['shopId'],'shopName':_0x2db2ce[_0x3271cf(0x164)],'shopUsername':_0x2db2ce['username'],'amount':_0xaf3682['amount'],'network':_0xaf3682['network'],'status':_0xaf3682[_0x3271cf(0x21f)],'txid':_0xaf3682[_0x3271cf(0x18f)],'notes':_0xaf3682[_0x3271cf(0x1f6)],'periodFrom':_0xaf3682[_0x3271cf(0x162)],'periodTo':_0xaf3682[_0x3271cf(0x1e8)],'createdAt':_0xaf3682[_0x3271cf(0x1df)],'paidAt':_0xaf3682[_0x3271cf(0x165)]};}async['getAllPayouts'](_0x14425d){const _0x25f34c=a35_0x51ad41,{page:_0x254846,limit:_0x1604e5,shopId:_0x125a86,network:_0x2f1cd9,dateFrom:_0x2a5aea,dateTo:_0x50a02c,search:_0x16e890}=_0x14425d,_0x3cabe6=(_0x254846-0x1)*_0x1604e5,_0x12eba5={};_0x125a86&&(_0x12eba5['shopId']=_0x125a86);_0x2f1cd9&&(_0x12eba5[_0x25f34c(0x193)]=_0x2f1cd9);(_0x2a5aea||_0x50a02c)&&(_0x12eba5['createdAt']={},_0x2a5aea&&(_0x12eba5[_0x25f34c(0x1df)][_0x25f34c(0x1d6)]=new Date(_0x2a5aea)),_0x50a02c&&(_0x12eba5['createdAt'][_0x25f34c(0x1e2)]=new Date(_0x50a02c)));_0x16e890&&(_0x12eba5['OR']=[{'shop':{'name':{'contains':_0x16e890,'mode':_0x25f34c(0x1ed)}}},{'shop':{'username':{'contains':_0x16e890,'mode':_0x25f34c(0x1ed)}}},{'notes':{'contains':_0x16e890,'mode':_0x25f34c(0x1ed)}}]);const [_0x8a54a5,_0x266661]=await Promise[_0x25f34c(0x1c8)]([database_1[_0x25f34c(0x180)][_0x25f34c(0x174)][_0x25f34c(0x21e)]({'where':_0x12eba5,'skip':_0x3cabe6,'take':_0x1604e5,'orderBy':{'createdAt':_0x25f34c(0x15a)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x25f34c(0x180)][_0x25f34c(0x174)][_0x25f34c(0x1e6)]({'where':_0x12eba5})]);return{'payouts':_0x8a54a5[_0x25f34c(0x1ec)](_0x1c9d8c=>({'id':_0x1c9d8c['id'],'shopId':_0x1c9d8c[_0x25f34c(0x184)],'shopName':_0x1c9d8c[_0x25f34c(0x18a)][_0x25f34c(0x164)],'shopUsername':_0x1c9d8c[_0x25f34c(0x18a)]['username'],'amount':_0x1c9d8c[_0x25f34c(0x20b)],'network':_0x1c9d8c['network'],'status':_0x1c9d8c[_0x25f34c(0x21f)],'txid':_0x1c9d8c[_0x25f34c(0x18f)],'notes':_0x1c9d8c['notes'],'periodFrom':_0x1c9d8c[_0x25f34c(0x162)],'periodTo':_0x1c9d8c[_0x25f34c(0x1e8)],'createdAt':_0x1c9d8c[_0x25f34c(0x1df)],'paidAt':_0x1c9d8c['paidAt']})),'pagination':{'page':_0x254846,'limit':_0x1604e5,'total':_0x266661,'totalPages':Math[_0x25f34c(0x1db)](_0x266661/_0x1604e5)}};}async[a35_0x51ad41(0x15f)](_0x42f0d4){const _0x3bd564=a35_0x51ad41,_0x31d564=await database_1[_0x3bd564(0x180)][_0x3bd564(0x174)][_0x3bd564(0x1aa)]({'where':{'id':_0x42f0d4},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x31d564)return null;return{'id':_0x31d564['id'],'shopId':_0x31d564[_0x3bd564(0x184)],'shopName':_0x31d564[_0x3bd564(0x18a)][_0x3bd564(0x164)],'shopUsername':_0x31d564[_0x3bd564(0x18a)][_0x3bd564(0x1ce)],'amount':_0x31d564[_0x3bd564(0x20b)],'network':_0x31d564[_0x3bd564(0x193)],'status':_0x31d564['status'],'txid':_0x31d564[_0x3bd564(0x18f)],'notes':_0x31d564[_0x3bd564(0x1f6)],'periodFrom':_0x31d564[_0x3bd564(0x162)],'periodTo':_0x31d564['periodTo'],'createdAt':_0x31d564[_0x3bd564(0x1df)],'paidAt':_0x31d564[_0x3bd564(0x165)]};}async['deletePayout'](_0x36d3d){const _0x369157=a35_0x51ad41;await database_1[_0x369157(0x180)][_0x369157(0x174)][_0x369157(0x20d)]({'where':{'id':_0x36d3d}});}async['getAllPayments'](_0x44bb6e){const _0x22d9f4=a35_0x51ad41,{page:_0x35279a,limit:_0x2e0b20,status:_0x3b1b8a,gateway:_0x30883d,shopId:_0xdfb964,dateFrom:_0x50f60c,dateTo:_0x6800e5,search:_0x2c57fe}=_0x44bb6e,_0x3ad040=(_0x35279a-0x1)*_0x2e0b20,_0x32363d={};_0x3b1b8a&&(_0x32363d[_0x22d9f4(0x21f)]=_0x3b1b8a['toUpperCase']());_0x30883d&&(_0x32363d['gateway']=_0x30883d[_0x22d9f4(0x1d2)]());_0x32363d[_0x22d9f4(0x1e1)]=_0x32363d['gateway']?_0x32363d['gateway']:{'not':_0x22d9f4(0x1b7)};if(typeof _0x32363d[_0x22d9f4(0x1e1)]==='string'&&_0x32363d[_0x22d9f4(0x1e1)]!==_0x22d9f4(0x1b7)){}else{if(typeof _0x32363d['gateway']==='string'&&_0x32363d[_0x22d9f4(0x1e1)]===_0x22d9f4(0x1b7)){}else _0x32363d[_0x22d9f4(0x1e1)]={'not':'test_gateway'};}_0xdfb964&&(_0x32363d[_0x22d9f4(0x184)]=_0xdfb964);(_0x50f60c||_0x6800e5)&&(_0x32363d[_0x22d9f4(0x1df)]={},_0x50f60c&&(_0x32363d[_0x22d9f4(0x1df)][_0x22d9f4(0x1d6)]=new Date(_0x50f60c)),_0x6800e5&&(_0x32363d[_0x22d9f4(0x1df)][_0x22d9f4(0x1e2)]=new Date(_0x6800e5)));_0x2c57fe&&(_0x32363d['OR']=[{'orderId':{'contains':_0x2c57fe,'mode':'insensitive'}},{'gatewayOrderId':{'contains':_0x2c57fe,'mode':'insensitive'}},{'customerEmail':{'contains':_0x2c57fe,'mode':_0x22d9f4(0x1ed)}},{'shop':{'name':{'contains':_0x2c57fe,'mode':_0x22d9f4(0x1ed)}}},{'shop':{'username':{'contains':_0x2c57fe,'mode':'insensitive'}}}]);const [_0x43acff,_0x7e91dc]=await Promise[_0x22d9f4(0x1c8)]([database_1['default'][_0x22d9f4(0x1fa)]['findMany']({'where':_0x32363d,'skip':_0x3ad040,'take':_0x2e0b20,'orderBy':{'createdAt':_0x22d9f4(0x15a)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x22d9f4(0x180)][_0x22d9f4(0x1fa)][_0x22d9f4(0x1e6)]({'where':_0x32363d})]);return{'payments':_0x43acff[_0x22d9f4(0x1ec)](_0x1365b1=>({'id':_0x1365b1['id'],'shopId':_0x1365b1[_0x22d9f4(0x184)],'gateway':_0x1365b1['gateway'],'amount':_0x1365b1[_0x22d9f4(0x20b)],'currency':_0x1365b1['currency'],'status':_0x1365b1['status'],'orderId':_0x1365b1[_0x22d9f4(0x1f5)],'gatewayOrderId':_0x1365b1['gatewayOrderId'],'customerEmail':_0x1365b1[_0x22d9f4(0x181)],'customerName':_0x1365b1[_0x22d9f4(0x17f)],'customerCountry':_0x1365b1['customerCountry'],'customerIp':_0x1365b1[_0x22d9f4(0x214)],'customerUa':_0x1365b1['customerUa'],'failureMessage':_0x1365b1[_0x22d9f4(0x17d)],'createdAt':_0x1365b1['createdAt'],'updatedAt':_0x1365b1[_0x22d9f4(0x201)],'shop':_0x1365b1[_0x22d9f4(0x18a)]})),'pagination':{'page':_0x35279a,'limit':_0x2e0b20,'total':_0x7e91dc,'totalPages':Math['ceil'](_0x7e91dc/_0x2e0b20)}};}async[a35_0x51ad41(0x1a0)](_0x11d2e1){const _0x4991b8=a35_0x51ad41,_0x1b0fe7=await database_1[_0x4991b8(0x180)][_0x4991b8(0x1fa)]['findUnique']({'where':{'id':_0x11d2e1},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x1b0fe7)return null;return{'id':_0x1b0fe7['id'],'shopId':_0x1b0fe7[_0x4991b8(0x184)],'gateway':_0x1b0fe7['gateway'],'amount':_0x1b0fe7['amount'],'currency':_0x1b0fe7[_0x4991b8(0x1ab)],'status':_0x1b0fe7['status'],'orderId':_0x1b0fe7[_0x4991b8(0x1f5)],'gatewayOrderId':_0x1b0fe7[_0x4991b8(0x170)],'customerEmail':_0x1b0fe7[_0x4991b8(0x181)],'customerName':_0x1b0fe7[_0x4991b8(0x17f)],'customerCountry':_0x1b0fe7[_0x4991b8(0x1cb)],'customerIp':_0x1b0fe7[_0x4991b8(0x214)],'customerUa':_0x1b0fe7[_0x4991b8(0x171)],'failureMessage':_0x1b0fe7[_0x4991b8(0x17d)],'externalPaymentUrl':_0x1b0fe7['externalPaymentUrl'],'successUrl':_0x1b0fe7[_0x4991b8(0x210)],'failUrl':_0x1b0fe7['failUrl'],'pendingUrl':_0x1b0fe7[_0x4991b8(0x200)],'whiteUrl':_0x1b0fe7[_0x4991b8(0x1ad)],'createdAt':_0x1b0fe7[_0x4991b8(0x1df)],'updatedAt':_0x1b0fe7['updatedAt'],'shop':_0x1b0fe7['shop']};}async[a35_0x51ad41(0x1ca)](_0x30a5a6,_0x1117f8,_0x31a1ff,_0xfc4d09){const _0x1cf4eb=a35_0x51ad41,_0x3051e4={'status':_0x1117f8[_0x1cf4eb(0x1e4)](),'updatedAt':new Date(),'statusChangedBy':'admin','statusChangedAt':new Date()};_0x31a1ff&&(_0x3051e4[_0x1cf4eb(0x18e)]=_0x31a1ff);_0x1117f8[_0x1cf4eb(0x1e4)]()==='CHARGEBACK'&&_0xfc4d09&&(_0x3051e4['chargebackAmount']=_0xfc4d09);_0x1117f8[_0x1cf4eb(0x1e4)]()===_0x1cf4eb(0x157)&&(_0x3051e4[_0x1cf4eb(0x165)]=new Date());const _0x4112ef=await database_1[_0x1cf4eb(0x180)]['payment'][_0x1cf4eb(0x1f3)]({'where':{'id':_0x30a5a6},'data':_0x3051e4,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return{'id':_0x4112ef['id'],'shopId':_0x4112ef[_0x1cf4eb(0x184)],'gateway':_0x4112ef['gateway'],'amount':_0x4112ef[_0x1cf4eb(0x20b)],'currency':_0x4112ef[_0x1cf4eb(0x1ab)],'status':_0x4112ef[_0x1cf4eb(0x21f)],'orderId':_0x4112ef[_0x1cf4eb(0x1f5)],'gatewayOrderId':_0x4112ef[_0x1cf4eb(0x170)],'customerEmail':_0x4112ef[_0x1cf4eb(0x181)],'customerName':_0x4112ef['customerName'],'customerCountry':_0x4112ef['customerCountry'],'customerIp':_0x4112ef[_0x1cf4eb(0x214)],'customerUa':_0x4112ef[_0x1cf4eb(0x171)],'failureMessage':_0x4112ef[_0x1cf4eb(0x17d)],'adminNotes':_0x4112ef[_0x1cf4eb(0x18e)],'chargebackAmount':_0x4112ef[_0x1cf4eb(0x1fb)],'statusChangedBy':_0x4112ef[_0x1cf4eb(0x166)],'statusChangedAt':_0x4112ef[_0x1cf4eb(0x15e)],'createdAt':_0x4112ef[_0x1cf4eb(0x1df)],'updatedAt':_0x4112ef[_0x1cf4eb(0x201)],'shop':_0x4112ef[_0x1cf4eb(0x18a)]};}async[a35_0x51ad41(0x1f7)](_0x594da8,_0x32617a){const _0x78814f=a35_0x51ad41,_0x119f5b={..._0x32617a};_0x32617a[_0x78814f(0x1a6)]&&(_0x119f5b[_0x78814f(0x1a6)]=await bcryptjs_1['default'][_0x78814f(0x219)](_0x32617a[_0x78814f(0x1a6)],0xc));_0x32617a[_0x78814f(0x19f)]&&(_0x119f5b[_0x78814f(0x164)]=_0x32617a['fullName'],delete _0x119f5b[_0x78814f(0x19f)]);_0x32617a[_0x78814f(0x21b)]&&(_0x119f5b[_0x78814f(0x215)]=_0x32617a[_0x78814f(0x21b)],delete _0x119f5b['telegramId']);_0x32617a[_0x78814f(0x1bf)]&&(_0x119f5b['shopUrl']=_0x32617a[_0x78814f(0x1bf)],delete _0x119f5b['merchantUrl']);_0x32617a[_0x78814f(0x1e7)]&&(_0x119f5b[_0x78814f(0x1cf)]=JSON['stringify'](_0x32617a[_0x78814f(0x1e7)]),delete _0x119f5b[_0x78814f(0x1e7)]);_0x32617a['gatewaySettings']&&(_0x119f5b[_0x78814f(0x1fd)]=JSON[_0x78814f(0x20f)](_0x32617a[_0x78814f(0x1fd)]),delete _0x119f5b[_0x78814f(0x1fd)]);_0x32617a[_0x78814f(0x20e)]&&(_0x32617a['wallets'][_0x78814f(0x17e)]!==undefined&&(_0x119f5b['usdtPolygonWallet']=_0x32617a[_0x78814f(0x20e)][_0x78814f(0x17e)]||null),_0x32617a[_0x78814f(0x20e)][_0x78814f(0x1e0)]!==undefined&&(_0x119f5b[_0x78814f(0x1e0)]=_0x32617a[_0x78814f(0x20e)][_0x78814f(0x1e0)]||null),_0x32617a[_0x78814f(0x20e)][_0x78814f(0x207)]!==undefined&&(_0x119f5b[_0x78814f(0x207)]=_0x32617a[_0x78814f(0x20e)][_0x78814f(0x207)]||null),_0x32617a['wallets']['usdcPolygonWallet']!==undefined&&(_0x119f5b['usdcPolygonWallet']=_0x32617a[_0x78814f(0x20e)][_0x78814f(0x16f)]||null),delete _0x119f5b[_0x78814f(0x20e)]);const _0x4de86b=await database_1[_0x78814f(0x180)][_0x78814f(0x18a)][_0x78814f(0x1f3)]({'where':{'id':_0x594da8},'data':_0x119f5b,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4de86b['id'],'fullName':_0x4de86b[_0x78814f(0x164)],'username':_0x4de86b[_0x78814f(0x1ce)],'telegramId':_0x4de86b[_0x78814f(0x215)],'merchantUrl':_0x4de86b['shopUrl'],'gateways':_0x4de86b['paymentGateways']?JSON['parse'](_0x4de86b[_0x78814f(0x1cf)]):null,'gatewaySettings':_0x4de86b[_0x78814f(0x1fd)]?JSON['parse'](_0x4de86b['gatewaySettings']):null,'publicKey':_0x4de86b[_0x78814f(0x186)],'wallets':{'usdtPolygonWallet':_0x4de86b[_0x78814f(0x17e)],'usdtTrcWallet':_0x4de86b[_0x78814f(0x1e0)],'usdtErcWallet':_0x4de86b[_0x78814f(0x207)],'usdcPolygonWallet':_0x4de86b[_0x78814f(0x16f)]},'status':_0x4de86b[_0x78814f(0x21f)],'createdAt':_0x4de86b[_0x78814f(0x1df)]};}async[a35_0x51ad41(0x16b)](_0x43b384){const _0x186f1d=a35_0x51ad41,_0x1ae46d=await database_1[_0x186f1d(0x180)][_0x186f1d(0x18a)][_0x186f1d(0x1f3)]({'where':{'id':_0x43b384},'data':{'status':_0x186f1d(0x20c)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x1ae46d['id'],'fullName':_0x1ae46d[_0x186f1d(0x164)],'username':_0x1ae46d[_0x186f1d(0x1ce)],'telegramId':_0x1ae46d['telegram'],'merchantUrl':_0x1ae46d['shopUrl'],'gateways':_0x1ae46d[_0x186f1d(0x1cf)]?JSON[_0x186f1d(0x222)](_0x1ae46d[_0x186f1d(0x1cf)]):null,'gatewaySettings':_0x1ae46d[_0x186f1d(0x1fd)]?JSON['parse'](_0x1ae46d[_0x186f1d(0x1fd)]):null,'publicKey':_0x1ae46d[_0x186f1d(0x186)],'wallets':{'usdtPolygonWallet':_0x1ae46d[_0x186f1d(0x17e)],'usdtTrcWallet':_0x1ae46d['usdtTrcWallet'],'usdtErcWallet':_0x1ae46d[_0x186f1d(0x207)],'usdcPolygonWallet':_0x1ae46d[_0x186f1d(0x16f)]},'status':_0x1ae46d[_0x186f1d(0x21f)],'createdAt':_0x1ae46d['createdAt']};}async[a35_0x51ad41(0x1f8)](_0xd94618){const _0x55fbc0=a35_0x51ad41,_0x41e19b=await database_1[_0x55fbc0(0x180)][_0x55fbc0(0x18a)][_0x55fbc0(0x1f3)]({'where':{'id':_0xd94618},'data':{'status':_0x55fbc0(0x1c6)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x41e19b['id'],'fullName':_0x41e19b[_0x55fbc0(0x164)],'username':_0x41e19b[_0x55fbc0(0x1ce)],'telegramId':_0x41e19b['telegram'],'merchantUrl':_0x41e19b[_0x55fbc0(0x202)],'gateways':_0x41e19b[_0x55fbc0(0x1cf)]?JSON[_0x55fbc0(0x222)](_0x41e19b['paymentGateways']):null,'gatewaySettings':_0x41e19b[_0x55fbc0(0x1fd)]?JSON[_0x55fbc0(0x222)](_0x41e19b[_0x55fbc0(0x1fd)]):null,'publicKey':_0x41e19b[_0x55fbc0(0x186)],'wallets':{'usdtPolygonWallet':_0x41e19b[_0x55fbc0(0x17e)],'usdtTrcWallet':_0x41e19b[_0x55fbc0(0x1e0)],'usdtErcWallet':_0x41e19b['usdtErcWallet'],'usdcPolygonWallet':_0x41e19b[_0x55fbc0(0x16f)]},'status':_0x41e19b[_0x55fbc0(0x21f)],'createdAt':_0x41e19b[_0x55fbc0(0x1df)]};}async[a35_0x51ad41(0x217)](_0x20417d){const _0x89d883=a35_0x51ad41,{page:_0x96a502,limit:_0x1a7100,status:_0x54d74a}=_0x20417d,_0x36ac0b=(_0x96a502-0x1)*_0x1a7100,_0x2f1ff4={};_0x54d74a&&(_0x2f1ff4[_0x89d883(0x21f)]=_0x54d74a[_0x89d883(0x1e4)]());const [_0x1735f0,_0x5427fe]=await Promise[_0x89d883(0x1c8)]([database_1[_0x89d883(0x180)][_0x89d883(0x18a)]['findMany']({'where':_0x2f1ff4,'skip':_0x36ac0b,'take':_0x1a7100,'orderBy':{'createdAt':_0x89d883(0x15a)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x89d883(0x180)][_0x89d883(0x18a)][_0x89d883(0x1e6)]({'where':_0x2f1ff4})]);return{'users':_0x1735f0[_0x89d883(0x1ec)](_0x1bc630=>({'id':_0x1bc630['id'],'fullName':_0x1bc630[_0x89d883(0x164)],'username':_0x1bc630['username'],'telegramId':_0x1bc630[_0x89d883(0x215)],'merchantUrl':_0x1bc630[_0x89d883(0x202)],'gateways':_0x1bc630[_0x89d883(0x1cf)]?JSON[_0x89d883(0x222)](_0x1bc630[_0x89d883(0x1cf)]):null,'gatewaySettings':_0x1bc630['gatewaySettings']?JSON[_0x89d883(0x222)](_0x1bc630[_0x89d883(0x1fd)]):null,'publicKey':_0x1bc630['publicKey'],'wallets':{'usdtPolygonWallet':_0x1bc630[_0x89d883(0x17e)],'usdtTrcWallet':_0x1bc630[_0x89d883(0x1e0)],'usdtErcWallet':_0x1bc630[_0x89d883(0x207)],'usdcPolygonWallet':_0x1bc630[_0x89d883(0x16f)]},'status':_0x1bc630[_0x89d883(0x21f)],'createdAt':_0x1bc630[_0x89d883(0x1df)]})),'pagination':{'page':_0x96a502,'limit':_0x1a7100,'total':_0x5427fe,'totalPages':Math['ceil'](_0x5427fe/_0x1a7100)}};}async[a35_0x51ad41(0x178)](_0x465c0b){const _0x17a6e0=a35_0x51ad41,_0x4adbf4=await database_1[_0x17a6e0(0x180)][_0x17a6e0(0x18a)][_0x17a6e0(0x1aa)]({'where':{'id':_0x465c0b},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x4adbf4)return null;return{'id':_0x4adbf4['id'],'fullName':_0x4adbf4['name'],'username':_0x4adbf4[_0x17a6e0(0x1ce)],'telegramId':_0x4adbf4[_0x17a6e0(0x215)],'merchantUrl':_0x4adbf4['shopUrl'],'gateways':_0x4adbf4[_0x17a6e0(0x1cf)]?JSON[_0x17a6e0(0x222)](_0x4adbf4[_0x17a6e0(0x1cf)]):null,'gatewaySettings':_0x4adbf4[_0x17a6e0(0x1fd)]?JSON['parse'](_0x4adbf4[_0x17a6e0(0x1fd)]):null,'publicKey':_0x4adbf4[_0x17a6e0(0x186)],'wallets':{'usdtPolygonWallet':_0x4adbf4['usdtPolygonWallet'],'usdtTrcWallet':_0x4adbf4[_0x17a6e0(0x1e0)],'usdtErcWallet':_0x4adbf4[_0x17a6e0(0x207)],'usdcPolygonWallet':_0x4adbf4[_0x17a6e0(0x16f)]},'status':_0x4adbf4['status'],'createdAt':_0x4adbf4[_0x17a6e0(0x1df)]};}async[a35_0x51ad41(0x195)](_0x29be46){const _0x202ec0=a35_0x51ad41,{fullName:_0x3a8ed0,username:_0x4e4727,password:_0x47b99f,telegramId:_0xda28f6,merchantUrl:_0x4d98f5,gateways:_0x2550cf,gatewaySettings:_0x8722c0,wallets:_0x329212}=_0x29be46,_0x13f72e=await database_1[_0x202ec0(0x180)][_0x202ec0(0x18a)][_0x202ec0(0x1aa)]({'where':{'username':_0x4e4727}});if(_0x13f72e)throw new Error(_0x202ec0(0x1c5));if(_0xda28f6){const _0x4d6d12=await database_1[_0x202ec0(0x180)]['shop'][_0x202ec0(0x1aa)]({'where':{'telegram':_0xda28f6}});if(_0x4d6d12)throw new Error(_0x202ec0(0x188));}const _0x2f4f2f=await bcryptjs_1[_0x202ec0(0x180)][_0x202ec0(0x219)](_0x47b99f,0xc),_0x5bf2b8='pk_'+crypto_1['default'][_0x202ec0(0x1af)](0x20)[_0x202ec0(0x211)](_0x202ec0(0x169)),_0x22ba2d=_0x202ec0(0x21a)+crypto_1[_0x202ec0(0x180)]['randomBytes'](0x20)['toString'](_0x202ec0(0x169)),_0x33ed50=await database_1[_0x202ec0(0x180)][_0x202ec0(0x18a)][_0x202ec0(0x192)]({'data':{'name':_0x3a8ed0,'username':_0x4e4727,'password':_0x2f4f2f,'telegram':_0xda28f6,'shopUrl':_0x4d98f5,'paymentGateways':_0x2550cf?JSON['stringify'](_0x2550cf):null,'gatewaySettings':_0x8722c0?JSON[_0x202ec0(0x20f)](_0x8722c0):null,'usdtPolygonWallet':_0x329212?.['usdtPolygonWallet']||null,'usdtTrcWallet':_0x329212?.[_0x202ec0(0x1e0)]||null,'usdtErcWallet':_0x329212?.['usdtErcWallet']||null,'usdcPolygonWallet':_0x329212?.[_0x202ec0(0x16f)]||null,'publicKey':_0x5bf2b8,'secretKey':_0x22ba2d,'status':_0x202ec0(0x1c6)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x33ed50['id'],'fullName':_0x33ed50[_0x202ec0(0x164)],'username':_0x33ed50[_0x202ec0(0x1ce)],'telegramId':_0x33ed50[_0x202ec0(0x215)],'merchantUrl':_0x33ed50[_0x202ec0(0x202)],'gateways':_0x33ed50['paymentGateways']?JSON[_0x202ec0(0x222)](_0x33ed50[_0x202ec0(0x1cf)]):null,'gatewaySettings':_0x33ed50['gatewaySettings']?JSON['parse'](_0x33ed50[_0x202ec0(0x1fd)]):null,'publicKey':_0x33ed50[_0x202ec0(0x186)],'wallets':{'usdtPolygonWallet':_0x33ed50[_0x202ec0(0x17e)],'usdtTrcWallet':_0x33ed50[_0x202ec0(0x1e0)],'usdtErcWallet':_0x33ed50[_0x202ec0(0x207)],'usdcPolygonWallet':_0x33ed50[_0x202ec0(0x16f)]},'status':_0x33ed50[_0x202ec0(0x21f)],'createdAt':_0x33ed50[_0x202ec0(0x1df)]};}async[a35_0x51ad41(0x1fe)](_0x4a1dd2){const _0xf12b36=a35_0x51ad41;await database_1[_0xf12b36(0x180)][_0xf12b36(0x18a)][_0xf12b36(0x20d)]({'where':{'id':_0x4a1dd2}});}}exports[a35_0x51ad41(0x179)]=AdminService;function a35_0x1f96(){const _0x4ab963=['📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','update','\x20to\x20','orderId','notes','updateUser','activateUser','KLYME\x20GB','payment','chargebackAmount','📊\x20Merchants\x20awaiting\x20payout:\x20','gatewaySettings','deleteUser','dateFrom','pendingUrl','updatedAt','shopUrl','\x20payments\x20awaiting\x20payout','getGatewayDisplayName','availableBalance','\x20\x20\x20💰\x20Total\x20turnover:\x20','usdtErcWallet','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','gatewayBreakdown','COMPLETED','amount','SUSPENDED','delete','wallets','stringify','successUrl','toString','merchantEarningsUSDT','convertToUSDT','customerIp','telegram','Plisio','getAllUsers','getPayoutStats','hash','sk_','telegramId','./currencyService','💰\x20Found\x20','findMany','status','⏳\x20Payment\x20','1604907HgTNmu','parse','3547976LojvLP','\x20merchants,\x20','PAID','\x20paid\x20payments','KLYME\x20DE','desc','getSystemStatistics','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','Error\x20processing\x20payment\x20','statusChangedAt','getPayoutById','forEach','📅\x20Period:\x20','periodFrom','createPayout','name','paidAt','statusChangedBy','merchantPaid','year','hex','reduce','suspendUser','sort','30d','Rapyd','usdcPolygonWallet','gatewayOrderId','customerUa','thisMonth','\x20\x20\x20🌐\x20IP:\x20','payout','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','CoinToPay','Payment\x20not\x20found','getUserById','AdminService','3YtBxgC','__esModule','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','failureMessage','usdtPolygonWallet','customerName','default','customerEmail','paymentsCount','190958sEyBSl','shopId','amountUSDT','publicKey','getTime','Telegram\x20username\x20already\x20exists','getMonth','shop','oldestPaymentDate','gatewayEarnings','\x20USDT\x20(after\x20commission)','adminNotes','txid','__importDefault','commissionUSDT','create','network','currencyService','createUser','getFullYear','dateTo','630IsWxkm','\x20\x20\x20🌍\x20Country:\x20','includes','bcryptjs','turnoverUSDT','custom','set','fullName','getPaymentById','\x20\x20\x20💵\x20Available\x20balance:\x20','totalAmountAfterCommissionUSDT','\x20->\x20','10818PavAwx','12927624FieVSn','password','values','length','week','findUnique','currency','📊\x20Payout\x20statistics\x20calculated:','whiteUrl','30INKIQX','randomBytes','log','commission','turnover','\x20for\x20shop\x20','totalPayout','totalCommissionRate','averageCommissionRate','test_gateway','✅\x20Payment\x20','\x20USDT)','1457333RzEelh','✅\x20Payout\x20created:\x20','\x20USDT\x20(before\x20commission)','awaitingPayout','📊\x20Calculating\x20payout\x20statistics...','merchantUrl','\x20\x20\x20📊\x20Total\x20payments:\x20','not\x20set','\x20USDT\x20(paid\x20out)','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','totalAmountUSDT','Username\x20already\x20exists','ACTIVE','totalPayments','all','Noda','updatePaymentStatus','customerCountry','amountAfterCommissionUSDT','📊\x20Merchant\x20statistics\x20calculated:','username','paymentGateways','\x20USDT\x20(pending\x20payout)','toISOString','toLowerCase','period','localeCompare','\x20\x20\x20💰\x20Total\x20payout:\x20','gte','toFixed','totalTurnover','error','date','ceil','round','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','averageCheckUSDT','createdAt','usdtTrcWallet','gateway','lte','../config/database','toUpperCase','filter','count','gateways','periodTo','2024085tOgABh','\x20USDT','\x20paid\x20payments\x20for\x20analysis','map','insensitive','90d','\x20\x20\x20🖥️\x20User\x20Agent:\x20','merchantEarnings','getMerchantStatistics'];a35_0x1f96=function(){return _0x4ab963;};return a35_0x1f96();}