'use strict';const a53_0x2876e2=a53_0x2ef3;(function(_0xb00593,_0x27fd71){const _0x37c244=a53_0x2ef3,_0x34deda=_0xb00593();while(!![]){try{const _0x5cd193=parseInt(_0x37c244(0x24a))/0x1*(parseInt(_0x37c244(0x218))/0x2)+-parseInt(_0x37c244(0x1d0))/0x3*(-parseInt(_0x37c244(0x1cf))/0x4)+parseInt(_0x37c244(0x24d))/0x5*(-parseInt(_0x37c244(0x1b3))/0x6)+-parseInt(_0x37c244(0x2ad))/0x7*(-parseInt(_0x37c244(0x35c))/0x8)+-parseInt(_0x37c244(0x239))/0x9+-parseInt(_0x37c244(0x1eb))/0xa*(parseInt(_0x37c244(0x2c8))/0xb)+-parseInt(_0x37c244(0x278))/0xc;if(_0x5cd193===_0x27fd71)break;else _0x34deda['push'](_0x34deda['shift']());}catch(_0x5152c4){_0x34deda['push'](_0x34deda['shift']());}}}(a53_0x4225,0xa98df));var __createBinding=this&&this[a53_0x2876e2(0x366)]||(Object['create']?function(_0x4d7694,_0x5f0b24,_0x47a81b,_0x37b7c8){const _0x289445=a53_0x2876e2;if(_0x37b7c8===undefined)_0x37b7c8=_0x47a81b;var _0x568d0b=Object['getOwnPropertyDescriptor'](_0x5f0b24,_0x47a81b);(!_0x568d0b||('get'in _0x568d0b?!_0x5f0b24[_0x289445(0x1d8)]:_0x568d0b['writable']||_0x568d0b[_0x289445(0x201)]))&&(_0x568d0b={'enumerable':!![],'get':function(){return _0x5f0b24[_0x47a81b];}}),Object[_0x289445(0x205)](_0x4d7694,_0x37b7c8,_0x568d0b);}:function(_0x39b6ed,_0x4a54e7,_0x34023b,_0x12d53f){if(_0x12d53f===undefined)_0x12d53f=_0x34023b;_0x39b6ed[_0x12d53f]=_0x4a54e7[_0x34023b];}),__setModuleDefault=this&&this[a53_0x2876e2(0x35e)]||(Object[a53_0x2876e2(0x245)]?function(_0x3819cb,_0x33fa6a){const _0x7cb237=a53_0x2876e2;Object['defineProperty'](_0x3819cb,_0x7cb237(0x228),{'enumerable':!![],'value':_0x33fa6a});}:function(_0x1015ed,_0x285825){const _0x27f539=a53_0x2876e2;_0x1015ed[_0x27f539(0x228)]=_0x285825;}),__importStar=this&&this['__importStar']||(function(){var _0x299a64=function(_0x458b6e){const _0x2834b3=a53_0x2ef3;return _0x299a64=Object[_0x2834b3(0x2c9)]||function(_0x5493d4){const _0x1bf0c2=_0x2834b3;var _0x3ca48a=[];for(var _0xc81d8f in _0x5493d4)if(Object['prototype'][_0x1bf0c2(0x351)][_0x1bf0c2(0x337)](_0x5493d4,_0xc81d8f))_0x3ca48a[_0x3ca48a[_0x1bf0c2(0x1c5)]]=_0xc81d8f;return _0x3ca48a;},_0x299a64(_0x458b6e);};return function(_0xd97d79){const _0x1336a9=a53_0x2ef3;if(_0xd97d79&&_0xd97d79[_0x1336a9(0x1d8)])return _0xd97d79;var _0x5f39df={};if(_0xd97d79!=null){for(var _0x5a8c2b=_0x299a64(_0xd97d79),_0xec4d46=0x0;_0xec4d46<_0x5a8c2b[_0x1336a9(0x1c5)];_0xec4d46++)if(_0x5a8c2b[_0xec4d46]!==_0x1336a9(0x228))__createBinding(_0x5f39df,_0xd97d79,_0x5a8c2b[_0xec4d46]);}return __setModuleDefault(_0x5f39df,_0xd97d79),_0x5f39df;};}()),__importDefault=this&&this[a53_0x2876e2(0x27e)]||function(_0x107349){const _0x1838b8=a53_0x2876e2;return _0x107349&&_0x107349[_0x1838b8(0x1d8)]?_0x107349:{'default':_0x107349};};Object[a53_0x2876e2(0x205)](exports,a53_0x2876e2(0x1d8),{'value':!![]}),exports[a53_0x2876e2(0x1dd)]=void 0x0;const database_1=__importDefault(require('../config/database')),bcryptjs_1=__importDefault(require(a53_0x2876e2(0x362))),crypto_1=__importDefault(require(a53_0x2876e2(0x1e7))),fs_1=__importDefault(require('fs')),path_1=__importDefault(require(a53_0x2876e2(0x200))),speakeasy_1=__importDefault(require(a53_0x2876e2(0x1ef))),qrcode_1=__importDefault(require(a53_0x2876e2(0x1ba))),config_1=require(a53_0x2876e2(0x34c)),currencyService_1=require(a53_0x2876e2(0x37b)),telegramBotService_1=require('./telegramBotService'),gateway_1=require('../types/gateway');function a53_0x4225(){const _0x1e7553=['findUnique','Noda','Current\x20password\x20is\x20incorrect','admin','\x27\x20(from\x20\x27','shopUrl','‚ö†Ô∏è\x20Payment\x20','gatewayCommission','üí≥\x20Final\x20payout\x20wallet\x20for\x20','stringify','üîÑ\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','\x20\x20\x20ÔøΩüìä\x20Total\x20payments:\x20','publicKey','localeCompare','\x20\x20\x20üí∞\x20Total\x20payout:\x20','findMany','\x20USDT\x20(already\x20paid\x20out)','\x20USDT\x20(current\x20balance\x20in\x20DB)','base32','getAllPayments','wallet','insensitive','\x20updated\x20successfully','üîê\x202FA\x20setup\x20initiated\x20for\x20shop:\x20','merchantUrl','üîç\x20No\x20wallet\x20provided,\x20looking\x20up\x20from\x20shop\x20settings...','PAID','warn','ceil','‚úÖ\x20Customer\x20data\x20updated\x20for\x20payment\x20','generateBackupCodes','toUpperCase','shopUrl4','date','randomBytes','groupBy','14098020ygFwre','üìÖ\x20Payout\x20date\x20from\x20filter:\x20','üìä\x20Payout\x20statistics\x20calculated:','\x20USDT\x20(gross\x20revenue)','getGatewayDisplayName','CoinToPay','__importDefault','payout','üìã\x20Getting\x20merchants\x20selection\x20list...','filter','Shop\x20not\x20found','2FA\x20is\x20already\x20enabled','üîê\x202FA\x20disabled\x20for\x20shop:\x20','\x20USDT\x20(+','customerUa','PENDING','\x20paid\x20payments\x20for\x20gateway\x20','üîç\x20Using\x20gateway\x20\x27','%\x20from\x20','ADMIN_2FA_SECRET=','amountUSDT','shopUrl3','polygon_usdc','USDC','üí∞\x20Found\x20','üìä\x20Sorting\x20payments\x20by\x20','getUTCMonth','toFixed','\x20with\x20payout\x20history','sendPayoutNotification','üìä\x20Gateway\x20filter\x20applied:','whiteUrl','üîÑ\x20Updating\x20customer\x20data\x20for\x20payment\x20','getSettingsByGatewayId','ru-RU','üéØ\x20[','mastercard','some','üìä\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','‚úÖ\x20Deposited\x20','\x20balance\x20updated:\x20','_sum','paymentsCount','\x20\x20\x20üí∏\x20Total\x20payouts\x20(all\x20time):\x20','last_month','setDate','periodTo','üí±\x20Currency\x20filter\x20applied:\x20','rapyd','\x20\x20\x20Payout\x20amount:\x20','usdcPolygonWallet','\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)','\x20\x20\x20ü§î\x20Difference:\x20','499198ywmYTu','includes','Invalid\x202FA\x20token','üìä\x20Statistics\x20date\x20range:\x20','UTC','üìä\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','TrapaPay\x20Admin','dateTo','\x20\x20\x20Amount\x20increased\x20by\x20','AmPay\x20TRY',',\x20chargebacks:\x20','getAllUsers','resolve','customerEmail','üìä\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','orderId','\x20\x20\x20Merchant\x20gets:\x20','status','sk_','Payment\x20not\x20found','convertToUSDT','CoinToPay2','\x20USDT\x20(','enableAdmin2FA','dailyRevenue','getShopWallets','gatewayOrderId','2553793qtRuDU','getOwnPropertyNames','KLYME\x20EU','ADMIN_2FA_ENABLED=false','‚úÖ\x20Payout\x20created:\x20','amountAfterGatewayCommissionUSDT','‚ö†Ô∏è\x20CHARGEBACK\x20without\x20penalty\x20amount\x20-\x20no\x20balance\x20change','üìÖ\x20Payout\x20date\x20to\x20filter:\x20','\x27\x20to\x20name\x20\x27','turnover','\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...','\x20USDT,\x20Difference:\x20','üîç\x20Initial\x20wallet\x20from\x20request:\x20','\x20\x20\x20üë§\x20Merchant\x20earnings:\x20','payouts','toLowerCase','lte','üéØ\x20updateUser\x20called\x20with\x20ID:\x20','update','\x20\x20\x20üåê\x20IP:\x20','üí∞\x20Payment\x20amount\x20is\x20NOT\x20deducted\x20(chargeback\x20penalty\x20only)','getUTCFullYear','averageCheckUSDT','name','desc','\x20\x20\x20Tolerance:\x20','üîç\x20Selected\x20trc20\x20wallet:\x20','\x20\x20\x20Current\x20balance:\x20','merchantName','üí∞\x20[PAYOUT]\x20Gateway\x20','\x27\x20not\x20found.\x20Available\x20gateways:\x20','cointopay','gatewaySettings','\x20USDT,\x20Required:\x20','\x20USDT','fullName','üìä\x20Getting\x20merchant\x20statistics\x20with\x20filters:','USDT','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','adminNotes','\x20\x20\x20ÔøΩ\x20Total\x20paid\x20out:\x20','generateSecret','üîê\x20Admin\x20password\x20changed\x20successfully','MaxPara','$transaction','\x20\x20\x20Total\x20paid\x20out:\x20','all','toString','Invalid\x202FA\x20token\x20or\x20backup\x20code','Username\x20already\x20exists','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','averageCommissionRate','üìä\x20Final\x20WHERE\x20conditions:','‚úÖ\x20Using\x20wallet\x20from\x20request:\x20','getUTCDay','TrapaPay','OnRamp','createdAt','currencyService','merchantUrl2','COMPLETED','toDataURL','usdtErcWallet','wallets','asc','activateUser','\x20\x20\x20Amount\x20difference:\x20','Insufficient\x20balance.\x20Available:\x20','enable2FA','min','compare','erc20_usdc','üîê\x20Admin\x202FA\x20disabled','telegram','telegramBotService','\x20\x20\x20Current\x20network:\x20','\x20\x20\x20üìÖ\x20Total\x20payouts\x20(this\x20month):\x20','üîÑ\x20Gateway\x20mapping\x20(create):','2FA\x20not\x20set\x20up.\x20Please\x20call\x20setup\x20endpoint\x20first','entries','%\x20commission)','üí∞\x20Shop\x20','error','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','ADMIN_BACKUP_CODES=','üîê\x20[','then','üìÖ\x20Date\x20from\x20filter:\x20','setUTCDate','turnoverUSDT','password','üí∏\x20CHARGEBACK:\x20Processing\x20penalty-only\x20deduction','commissionUSDT','createPayout','utf8','pendingPayout','_count','parse','passwordHash','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','availableBalance','setup2FA','year','floor','ADMIN_2FA_ENABLED=','merchantId','week','getPayoutStats','‚úÖ\x20Balance\x20check\x20passed\x20(with\x20tolerance)','delete','AmPay','call','random','EXPIRED','üìä\x20Available\x20gateways\x20in\x20database:','totalPayments','existsSync','üí∞\x20Creating\x20payout\x20for\x20shop\x20','üîç\x20Selected\x20polygon_usdc\x20wallet:\x20','amountAfterCommissionUSDT','‚úÖ\x20Using\x20gateway\x20filter:\x20\x27','\x27\x20->\x20name\x20\x27','noda','backupCodes','getGatewayNameById','reduce','\x20-\x20','\x20for\x20shop\x20','balance','gte','totp','hash','../config/config','successUrl','join','trim','gatewayCommissionRate','hasOwnProperty','paymentGateways','from','trc20','abs','updateUser','üìÖ\x20Date\x20to\x20filter:\x20','\x20in\x20','network','ADMIN_PASSWORD_HASH=','Plisio','144WNDJTr','getPayoutById','__setModuleDefault','\x20\x20\x20üí∞\x20Total\x20payments\x20turnover:\x20','custom_','\x20\x20\x20üí≥\x20Total\x20payments:\x20','bcryptjs','\x20\x20\x20Added\x20to\x20balance:\x20+','shop','updatePayout','__createBinding','get','payment','0000','üì±\x20Telegram\x20notification\x20sent\x20for\x20payout\x20','setupAdmin2FA','forEach','toISOString','SquirrelPay','readFileSync','writeFileSync','üîå\x20Gateway:\x20','currency','üí∞\x20Payment\x20','failUrl','‚ö†Ô∏è\x20Gateway\x20\x27','totalAmount','setHours','twoFactorEnabled','\x20\x20\x20üí∞\x20Total\x20turnover:\x20','\x20\x20\x20Current\x20amount:\x20','./currencyService','\x20\x20\x20Amount\x20decreased\x20by\x20','üìÖ\x20Period:\x20','Payout\x20not\x20found','\x20\x20\x20Full\x20amount:\x20','txid','Test\x20Gateway',']\x20Updating\x20password\x20for\x20user\x20','\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)','usdtPolygonWallet','\x20merchants','toLocaleDateString','Insufficient\x20balance\x20for\x20amount\x20increase.\x20Available:\x20','usdcErcWallet','getTime','getMerchantsSelection','\x20USDT\x20for\x20payment\x20','totalCommissionRate',',\x20successful:\x20','üîÑ\x20Admin\x20updating\x20payment\x20','customerCountry','\x20\x20\x20Gateway:\x20','updatePaymentStatus','\x20\x20\x20üè™\x20Gateway\x20earnings:\x20','getFullYear','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','\x20->\x20','üîë\x20Generated\x20','periodFrom','push','24474PTIJFf','üìä\x20Getting\x20payments\x20with\x20filters:','\x20merchants\x20with\x20rounded\x20balance\x20!=\x200.00\x20(excluding\x20balances\x20that\x20round\x20to\x200.00)','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','this_week','paidAt','changeAdminPassword','qrcode','startsWith','getUTCDate','\x20USDT\x20-\x20will\x20return\x20to\x20balance','gateways','lastLoginAt','üîÑ\x20Converted\x20gateway\x20name\x20\x27','üîç\x20Selected\x20erc20_usdc\x20wallet:\x20','cointopay2','üí∏\x20CHARGEBACK\x20penalty\x20ONLY:\x20-','.env','length','map','\x20USDT\x20(same\x20as\x20awaiting)','test_gateway','commission','Amer','this_month','Telegram\x20username\x20already\x20exists','verify','ACTIVE','4432028SZsJuV','3hEwTDT','cwd','\x20became\x20PAID:','üîß\x20[','\x20USDT,\x20merchant:\x20','\x20\x20\x20Balance:\x20','values','period','__esModule','\x20\x20\x20üìÖ\x20This\x20month:\x20','\x20\x20\x20New\x20amount:\x20','split','dateFrom','AdminService','\x20USDT,\x20Requested:\x20','merchantUrl3','custom','\x20USDT\x20(after\x20','splice','üìä\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','MyXSpend','üí∞\x20Updating\x20payout\x20','\x20\x20\x20ÔøΩ\x20Total\x20payments\x20turnover:\x20','crypto','totalTurnover','statusChangedBy','chargebackAmount','10bonoKO','\x20\x20\x20Transaction\x20hash:\x20','round','config','speakeasy','merchantEarnings',']\x20Gateway\x20settings\x20before\x20saving:',':\x20commission\x20=\x20','not\x20set','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notification\x20for\x20payout\x20','\x20\x20\x20üîç\x20Calculated\x20after\x20commission:\x20','\x20USDT\x20(total\x20paid\x20to\x20merchants)','merchantEarningsUSDT','shopId','deletePayout','klyme_gb','\x20payments)','failureMessage','\x20\x20\x20Shop\x20totalPaidOut:\x20','telegramId','../types/gateway','path','configurable','not\x20provided','getGatewayInternalName','totalPaidOut','defineProperty','erc20','KLYME\x20DE','notes','\x20\x20\x20Final\x20payout\x20amount\x20used:\x20','\x20\x20\x20üí∏\x20Total\x20payouts:\x20','TrapaPay\x20(','üìä\x20Total\x20payments\x20(including\x20failed):\x20','üîç\x20Creating\x20payout\x20with\x20data:','\x20balance\x20updated:','replace','Deposit','customerIp','üîÑ\x20Gateway\x20mapping:','‚úÖ\x20Payout\x20','\x20USDT\x20(-','üîÑ\x20Gateway\x20mapping\x20(get):','KLYME\x20GB','disable2FA','4QhYYgF','\x20has\x20zero\x20or\x20null\x20merchant\x20amount,\x20skipping...','2020-01-01','gateway','count','usdtTrcWallet','üîç\x20Total\x20payments\x20matching\x20filters:\x20','getDate','Sepa','hex','disableAdmin2FA','Error\x20processing\x20payment\x20','shopUrl2','\x20status:\x20','gatewayEarnings','Error\x20parsing\x20backup\x20codes:','default','\x20to\x20','üîç\x20Selected\x20polygon\x20wallet:\x20','\x20USDT)','üîê\x20Admin\x202FA\x20enabled','üìã\x20Found\x20','REFUND','totalAmountUSDT','today','üìä\x20Statistics\x20PAID\x20payments\x20count:\x20','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','–ù–µ\x20—É–∫–∞–∑–∞–Ω','\x20\x20\x20üñ•Ô∏è\x20User\x20Agent:\x20','last_week','totalPayout','plisio','CHARGEBACK','2501676iXVwLY','generateDailyStatistics',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','slice','twoFactorSecret','username','InstaXchange','substr','thisMonth','revenue','aggregate','lastMonth','create','getMonth','set','amount','merchantUrl4','312061lxnqFF','updatedAt','üìä\x20Generated\x20reports\x20for\x20','780BFvnnm','pk_','2FA\x20token\x20is\x20required','log','\x20\x20\x20Requested\x20(number):\x20','sort','customerName'];a53_0x4225=function(){return _0x1e7553;};return a53_0x4225();}function a53_0x2ef3(_0x120b50,_0xc448b9){_0x120b50=_0x120b50-0x19f;const _0x422580=a53_0x4225();let _0x2ef3a7=_0x422580[_0x120b50];return _0x2ef3a7;}class AdminService{async[a53_0x2876e2(0x333)](){const _0xa971c6=a53_0x2876e2;console[_0xa971c6(0x250)]('üìä\x20Calculating\x20payout\x20statistics...');const _0x29c515=await database_1[_0xa971c6(0x228)][_0xa971c6(0x364)][_0xa971c6(0x243)]({'_sum':{'balance':!![],'totalPaidOut':!![]}}),_0x10a7e3=await database_1[_0xa971c6(0x228)]['payment'][_0xa971c6(0x21c)]({'where':{'status':'PAID','gateway':{'not':'test_gateway'}}}),_0x50b125=new Date(),_0x5dcb03=new Date(_0x50b125[_0xa971c6(0x1ad)](),_0x50b125[_0xa971c6(0x246)](),0x1),_0x484630=new Date(_0x50b125[_0xa971c6(0x1ad)](),_0x50b125[_0xa971c6(0x246)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x547351=await database_1[_0xa971c6(0x228)][_0xa971c6(0x27f)][_0xa971c6(0x243)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x5dcb03,'lte':_0x484630},'status':_0xa971c6(0x304)}}),_0x1af9d5=_0x29c515[_0xa971c6(0x2a1)][_0xa971c6(0x204)]||0x0,_0x5c0ff9=_0x29c515[_0xa971c6(0x2a1)][_0xa971c6(0x348)]||0x0,_0x2ca0c9=_0x547351['_sum'][_0xa971c6(0x248)]||0x0,_0x275fa0={'totalPayout':Math['round'](_0x1af9d5*0x64)/0x64,'awaitingPayout':Math[_0xa971c6(0x1ed)](_0x5c0ff9*0x64)/0x64,'thisMonth':Math['round'](_0x2ca0c9*0x64)/0x64,'availableBalance':Math[_0xa971c6(0x1ed)](_0x5c0ff9*0x64)/0x64,'totalPayments':_0x10a7e3};return console['log'](_0xa971c6(0x27a)),console[_0xa971c6(0x250)](_0xa971c6(0x262)+_0x275fa0[_0xa971c6(0x236)]+_0xa971c6(0x1f6)),console[_0xa971c6(0x250)]('\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20'+_0x275fa0['awaitingPayout']+_0xa971c6(0x2ab)),console['log']('\x20\x20\x20üíµ\x20Available\x20balance:\x20'+_0x275fa0[_0xa971c6(0x32c)]+_0xa971c6(0x1c7)),console[_0xa971c6(0x250)](_0xa971c6(0x1d9)+_0x275fa0[_0xa971c6(0x241)]+_0xa971c6(0x2ea)),console['log'](_0xa971c6(0x361)+_0x275fa0[_0xa971c6(0x33b)]+'\x20PAID\x20payments'),_0x275fa0;}async['updateCustomerData'](_0x3a8f52,_0x22f01d){const _0x1b6163=a53_0x2876e2;console[_0x1b6163(0x250)](_0x1b6163(0x298)+_0x3a8f52+':',_0x22f01d);const _0x2dfacb=await database_1['default']['payment']['findUnique']({'where':{'id':_0x3a8f52},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x2dfacb)throw new Error(_0x1b6163(0x2c0));const _0x10a178={};_0x22f01d[_0x1b6163(0x1a9)]!==undefined&&(_0x10a178['customerCountry']=_0x22f01d['customerCountry']||null);_0x22f01d[_0x1b6163(0x211)]!==undefined&&(_0x10a178['customerIp']=_0x22f01d[_0x1b6163(0x211)]||null);_0x22f01d[_0x1b6163(0x286)]!==undefined&&(_0x10a178[_0x1b6163(0x286)]=_0x22f01d[_0x1b6163(0x286)]||null);const _0x294e03=await database_1[_0x1b6163(0x228)][_0x1b6163(0x368)][_0x1b6163(0x2da)]({'where':{'id':_0x3a8f52},'data':{..._0x10a178,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x1b6163(0x250)](_0x1b6163(0x271)+_0x3a8f52),console['log']('\x20\x20\x20üåç\x20Country:\x20'+_0x2dfacb[_0x1b6163(0x1a9)]+_0x1b6163(0x1af)+_0x294e03['customerCountry']),console[_0x1b6163(0x250)](_0x1b6163(0x2db)+_0x2dfacb[_0x1b6163(0x211)]+_0x1b6163(0x1af)+_0x294e03[_0x1b6163(0x211)]),console[_0x1b6163(0x250)](_0x1b6163(0x234)+(_0x2dfacb[_0x1b6163(0x286)]?_0x1b6163(0x247):_0x1b6163(0x1f3))+_0x1b6163(0x1af)+(_0x294e03['customerUa']?_0x1b6163(0x247):_0x1b6163(0x1f3))),_0x294e03;}async['getSystemStatistics'](_0xc0217b,_0x4d861a){const _0x5e195a=a53_0x2876e2,_0x599701=_0x4d861a?new Date(_0x4d861a):new Date();let _0x41ac60,_0x1ad7bb;if(_0xc0217b[_0x5e195a(0x1bb)]('custom_')){const _0x527786=_0xc0217b[_0x5e195a(0x20f)](_0x5e195a(0x360),'')[_0x5e195a(0x1db)]('_');if(_0x527786[_0x5e195a(0x1c5)]===0x2){const _0x420e85=new Date(_0x527786[0x0]),_0x23ec77=new Date(_0x527786[0x1]);_0x41ac60=new Date(Date['UTC'](_0x420e85['getUTCFullYear'](),_0x420e85[_0x5e195a(0x292)](),_0x420e85['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x1ad7bb=new Date(Date[_0x5e195a(0x2b1)](_0x23ec77[_0x5e195a(0x2dd)](),_0x23ec77[_0x5e195a(0x292)](),_0x23ec77[_0x5e195a(0x1bc)](),0x17,0x3b,0x3b,0x3e7));}else{const _0x3c6450=new Date(Date[_0x5e195a(0x2b1)](_0x599701['getUTCFullYear'](),_0x599701['getUTCMonth'](),_0x599701[_0x5e195a(0x1bc)]()-0x1e));_0x41ac60=new Date(Date['UTC'](_0x3c6450['getUTCFullYear'](),_0x3c6450['getUTCMonth'](),_0x3c6450['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x1ad7bb=new Date(Date[_0x5e195a(0x2b1)](_0x599701[_0x5e195a(0x2dd)](),_0x599701[_0x5e195a(0x292)](),_0x599701[_0x5e195a(0x1bc)](),0x17,0x3b,0x3b,0x3e7));}}else{switch(_0xc0217b[_0x5e195a(0x2d7)]()){case _0x5e195a(0x230):_0x41ac60=new Date(Date['UTC'](_0x599701[_0x5e195a(0x2dd)](),_0x599701[_0x5e195a(0x292)](),_0x599701[_0x5e195a(0x1bc)](),0x0,0x0,0x0,0x0)),_0x1ad7bb=new Date(Date[_0x5e195a(0x2b1)](_0x599701[_0x5e195a(0x2dd)](),_0x599701[_0x5e195a(0x292)](),_0x599701[_0x5e195a(0x1bc)](),0x17,0x3b,0x3b,0x3e7));break;case'yesterday':const _0x1cb797=new Date(_0x599701);_0x1cb797[_0x5e195a(0x320)](_0x1cb797[_0x5e195a(0x1bc)]()-0x1),_0x41ac60=new Date(Date[_0x5e195a(0x2b1)](_0x1cb797[_0x5e195a(0x2dd)](),_0x1cb797[_0x5e195a(0x292)](),_0x1cb797[_0x5e195a(0x1bc)](),0x0,0x0,0x0,0x0)),_0x1ad7bb=new Date(Date[_0x5e195a(0x2b1)](_0x1cb797[_0x5e195a(0x2dd)](),_0x1cb797[_0x5e195a(0x292)](),_0x1cb797['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case _0x5e195a(0x1b7):const _0x377eba=_0x599701[_0x5e195a(0x2fe)](),_0x63f85f=_0x377eba===0x0?-0x6:0x1-_0x377eba,_0x207616=_0x599701[_0x5e195a(0x1bc)]()+_0x63f85f;_0x41ac60=new Date(Date['UTC'](_0x599701['getUTCFullYear'](),_0x599701['getUTCMonth'](),_0x207616,0x0,0x0,0x0,0x0)),_0x1ad7bb=new Date(Date[_0x5e195a(0x2b1)](_0x599701['getUTCFullYear'](),_0x599701['getUTCMonth'](),_0x599701['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case _0x5e195a(0x235):const _0x1ae086=new Date(Date['UTC'](_0x599701[_0x5e195a(0x2dd)](),_0x599701[_0x5e195a(0x292)](),_0x599701['getUTCDate']()-0x7)),_0x469568=_0x1ae086['getUTCDay'](),_0x437d02=_0x469568===0x0?-0x6:0x1-_0x469568,_0x35d91d=_0x1ae086[_0x5e195a(0x1bc)]()+_0x437d02;_0x41ac60=new Date(Date[_0x5e195a(0x2b1)](_0x1ae086[_0x5e195a(0x2dd)](),_0x1ae086['getUTCMonth'](),_0x35d91d,0x0,0x0,0x0,0x0)),_0x1ad7bb=new Date(Date[_0x5e195a(0x2b1)](_0x1ae086[_0x5e195a(0x2dd)](),_0x1ae086[_0x5e195a(0x292)](),_0x35d91d+0x6,0x17,0x3b,0x3b,0x3e7));break;case _0x5e195a(0x1cb):_0x41ac60=new Date(Date[_0x5e195a(0x2b1)](_0x599701[_0x5e195a(0x2dd)](),_0x599701[_0x5e195a(0x292)](),0x1,0x0,0x0,0x0,0x0)),_0x1ad7bb=new Date(Date['UTC'](_0x599701['getUTCFullYear'](),_0x599701[_0x5e195a(0x292)](),_0x599701['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case _0x5e195a(0x2a4):_0x41ac60=new Date(Date[_0x5e195a(0x2b1)](_0x599701[_0x5e195a(0x2dd)](),_0x599701['getUTCMonth']()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x1ad7bb=new Date(Date[_0x5e195a(0x2b1)](_0x599701[_0x5e195a(0x2dd)](),_0x599701['getUTCMonth'](),0x0,0x17,0x3b,0x3b,0x3e7));break;case'all_time':_0x41ac60=new Date(Date[_0x5e195a(0x2b1)](0x7e9,0x5,0xe,0x0,0x0,0x0,0x0)),_0x1ad7bb=new Date(Date[_0x5e195a(0x2b1)](_0x599701[_0x5e195a(0x2dd)](),_0x599701[_0x5e195a(0x292)](),_0x599701[_0x5e195a(0x1bc)](),0x17,0x3b,0x3b,0x3e7));break;default:_0x41ac60=new Date(_0x599701[_0x5e195a(0x1a3)]()-0x1e*0x18*0x3c*0x3c*0x3e8);const _0x2cdcab=new Date(Date[_0x5e195a(0x2b1)](_0x599701[_0x5e195a(0x2dd)](),_0x599701[_0x5e195a(0x292)](),_0x599701[_0x5e195a(0x1bc)]()-0x1e));_0x41ac60=new Date(Date[_0x5e195a(0x2b1)](_0x2cdcab['getUTCFullYear'](),_0x2cdcab[_0x5e195a(0x292)](),_0x2cdcab[_0x5e195a(0x1bc)](),0x0,0x0,0x0,0x0)),_0x1ad7bb=new Date(Date[_0x5e195a(0x2b1)](_0x599701[_0x5e195a(0x2dd)](),_0x599701['getUTCMonth'](),_0x599701['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}const _0x2b0175={'gte':_0x41ac60,'lte':_0x1ad7bb};console['log'](_0x5e195a(0x2b0)+_0x41ac60['toISOString']()+'\x20to\x20'+_0x1ad7bb[_0x5e195a(0x36d)]());const [_0x45c8aa,_0xfbfa67,_0x2974fb,_0x357ef0,_0x8015ca,_0x4a5f87,_0x4caf62,_0x56fbe1,_0x55285c]=await Promise['all']([database_1[_0x5e195a(0x228)][_0x5e195a(0x364)]['count'](),database_1[_0x5e195a(0x228)][_0x5e195a(0x364)][_0x5e195a(0x21c)]({'where':{'status':_0x5e195a(0x1ce)}}),database_1['default'][_0x5e195a(0x368)][_0x5e195a(0x21c)]({'where':{'status':'PAID','createdAt':_0x2b0175,'gateway':{'not':_0x5e195a(0x1c8)}}}),database_1[_0x5e195a(0x228)][_0x5e195a(0x368)]['count']({'where':{'status':_0x5e195a(0x238),'createdAt':_0x2b0175,'gateway':{'not':_0x5e195a(0x1c8)}}}),database_1[_0x5e195a(0x228)][_0x5e195a(0x368)][_0x5e195a(0x21c)]({'where':{'status':'REFUND','createdAt':_0x2b0175,'gateway':{'not':_0x5e195a(0x1c8)}}}),database_1['default'][_0x5e195a(0x368)][_0x5e195a(0x263)]({'where':{'status':_0x5e195a(0x26e),'createdAt':_0x2b0175,'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gateway':!![]}}),database_1[_0x5e195a(0x228)]['payment'][_0x5e195a(0x263)]({'where':{'gateway':{'not':_0x5e195a(0x1c8)}},'take':0xa,'orderBy':{'createdAt':_0x5e195a(0x2e0)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x5e195a(0x228)]['payment'][_0x5e195a(0x263)]({'where':{'createdAt':_0x2b0175,'gateway':{'not':_0x5e195a(0x1c8)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x5e195a(0x228)][_0x5e195a(0x368)]['findMany']({'where':{'status':_0x5e195a(0x26e),'gateway':{'not':_0x5e195a(0x1c8)}},'select':{'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gateway':!![]}})]);console[_0x5e195a(0x250)](_0x5e195a(0x231)+_0x2974fb);let _0x372f54=0x0,_0xe9c69d=0x0;for(const _0x43f2c5 of _0x4a5f87){const _0x1237dc=_0x43f2c5[_0x5e195a(0x28c)]||0x0;_0x372f54+=_0x1237dc;if(_0x43f2c5[_0x5e195a(0x2cd)]&&_0x43f2c5[_0x5e195a(0x28c)]){const _0x524222=_0x43f2c5['amountUSDT']-_0x43f2c5[_0x5e195a(0x2cd)];_0xe9c69d+=_0x524222;}}const {gatewaySettingsService:_0x28169c}=await Promise[_0x5e195a(0x2b9)]()[_0x5e195a(0x31e)](()=>__importStar(require('./gatewaySettingsService'))),{getGatewayIdByName:_0x18e2d7}=await Promise[_0x5e195a(0x2b9)]()['then'](()=>__importStar(require(_0x5e195a(0x1ff))));let _0x30204f=0x0;for(const _0x47b760 of _0x4a5f87){const _0x5d9d51=_0x18e2d7(_0x47b760[_0x5e195a(0x21b)]);if(_0x5d9d51){const _0x4f9ae0=_0x28169c[_0x5e195a(0x299)](_0x5d9d51),_0x5f5176=_0x4f9ae0?.[_0x5e195a(0x25b)]||0x0,_0x33ca15=_0x47b760[_0x5e195a(0x28c)]||0x0,_0x1fe0cb=_0x33ca15*(_0x5f5176/0x64);_0x30204f+=_0x1fe0cb;}}_0xe9c69d-=_0x30204f;let _0x4dc55c=0x0,_0x455fb2=0x0;for(const _0x28e991 of _0x55285c){if(_0x28e991['amountAfterGatewayCommissionUSDT']&&_0x28e991[_0x5e195a(0x28c)]){const _0x46e1bf=_0x28e991['amountUSDT']-_0x28e991[_0x5e195a(0x2cd)];_0x4dc55c+=_0x46e1bf;}const _0x84ac26=_0x18e2d7(_0x28e991[_0x5e195a(0x21b)]);if(_0x84ac26){const _0x5c245f=_0x28169c[_0x5e195a(0x299)](_0x84ac26),_0x4b48c5=_0x5c245f?.[_0x5e195a(0x25b)]||0x0,_0x1ff6c8=_0x28e991[_0x5e195a(0x28c)]||0x0,_0x1b58bb=_0x1ff6c8*(_0x4b48c5/0x64);_0x455fb2+=_0x1b58bb;}}_0x4dc55c-=_0x455fb2;const _0x1dfc42=_0x2974fb>0x0?_0x372f54/_0x2974fb:0x0,_0x36202b=this[_0x5e195a(0x23a)](_0x56fbe1,_0x41ac60,_0x1ad7bb),_0x296f8c=await database_1['default'][_0x5e195a(0x368)][_0x5e195a(0x21c)]({'where':{'createdAt':_0x2b0175,'gateway':{'not':_0x5e195a(0x1c8)},'status':{'notIn':[_0x5e195a(0x287),_0x5e195a(0x339)]}}}),_0x6cbf6a=_0x296f8c>0x0?_0x2974fb/_0x296f8c*0x64:0x0;return{'totalShops':_0x45c8aa,'activeShops':_0xfbfa67,'totalPayments':_0x296f8c,'successfulPayments':_0x2974fb,'totalAttempts':_0x296f8c,'chargebacks':_0x357ef0,'refunds':_0x8015ca,'totalRevenue':Math['round'](_0x372f54*0x64)/0x64,'trapayEarnings':Math[_0x5e195a(0x1ed)](_0xe9c69d*0x64)/0x64,'trapayEarningsAllTime':Math[_0x5e195a(0x1ed)](_0x4dc55c*0x64)/0x64,'averagePaymentAmount':Math[_0x5e195a(0x1ed)](_0x1dfc42*0x64)/0x64,'conversionRate':Math['round'](_0x6cbf6a*0x64)/0x64,'dailyRevenue':_0x36202b[_0x5e195a(0x2c5)],'dailyPayments':_0x36202b['dailyPayments'],'recentPayments':_0x4caf62[_0x5e195a(0x1c6)](_0x1adfdb=>({'id':_0x1adfdb['id'],'amount':_0x1adfdb[_0x5e195a(0x248)],'currency':_0x1adfdb[_0x5e195a(0x372)],'status':_0x1adfdb[_0x5e195a(0x2be)],'gateway':_0x1adfdb[_0x5e195a(0x21b)],'shop':_0x1adfdb[_0x5e195a(0x364)],'createdAt':_0x1adfdb[_0x5e195a(0x301)]}))};}}async['getMerchantStatistics'](_0x461287){const _0x4c3f29=a53_0x2876e2;console[_0x4c3f29(0x250)](_0x4c3f29(0x2ec),_0x461287);let _0x4a4e5a,_0x31ba84=new Date();if(_0x461287[_0x4c3f29(0x1d7)]==='custom'&&_0x461287[_0x4c3f29(0x1dc)]&&_0x461287[_0x4c3f29(0x2b4)]){const _0x22046c=new Date(_0x461287['dateFrom']),_0x466a40=new Date(_0x461287[_0x4c3f29(0x2b4)]);_0x4a4e5a=new Date(Date[_0x4c3f29(0x2b1)](_0x22046c['getUTCFullYear'](),_0x22046c[_0x4c3f29(0x292)](),_0x22046c[_0x4c3f29(0x1bc)](),0x0,0x0,0x0,0x0)),_0x31ba84=new Date(Date[_0x4c3f29(0x2b1)](_0x466a40[_0x4c3f29(0x2dd)](),_0x466a40[_0x4c3f29(0x292)](),_0x466a40['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}else{const _0xb692fd=new Date();switch(_0x461287['period']){case _0x4c3f29(0x332):_0x4a4e5a=new Date(_0xb692fd['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8),_0x4a4e5a['setHours'](0x0,0x0,0x0,0x0),_0x31ba84['setHours'](0x17,0x3b,0x3b,0x3e7);break;case'month':_0x4a4e5a=new Date(Date[_0x4c3f29(0x2b1)](_0xb692fd['getUTCFullYear'](),_0xb692fd[_0x4c3f29(0x292)](),0x1,0x0,0x0,0x0,0x0)),_0x31ba84=new Date(Date[_0x4c3f29(0x2b1)](_0xb692fd['getUTCFullYear'](),_0xb692fd[_0x4c3f29(0x292)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x4c3f29(0x244):_0x4a4e5a=new Date(Date[_0x4c3f29(0x2b1)](_0xb692fd[_0x4c3f29(0x2dd)](),_0xb692fd[_0x4c3f29(0x292)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x31ba84=new Date(Date[_0x4c3f29(0x2b1)](_0xb692fd[_0x4c3f29(0x2dd)](),_0xb692fd[_0x4c3f29(0x292)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x4c3f29(0x32e):_0x4a4e5a=new Date(_0xb692fd[_0x4c3f29(0x1a3)]()-0x16d*0x18*0x3c*0x3c*0x3e8),_0x4a4e5a[_0x4c3f29(0x377)](0x0,0x0,0x0,0x0),_0x31ba84['setHours'](0x17,0x3b,0x3b,0x3e7);break;case _0x4c3f29(0x2f6):default:_0x4a4e5a=new Date(_0x4c3f29(0x21a)),_0x4a4e5a[_0x4c3f29(0x377)](0x0,0x0,0x0,0x0),_0x31ba84['setHours'](0x17,0x3b,0x3b,0x3e7);break;}}console[_0x4c3f29(0x250)](_0x4c3f29(0x37d)+_0x4a4e5a[_0x4c3f29(0x36d)]()+_0x4c3f29(0x229)+_0x31ba84[_0x4c3f29(0x36d)]());const _0x313446={'status':'PAID','gateway':{'not':_0x4c3f29(0x1c8)},'createdAt':{'gte':_0x4a4e5a,'lte':_0x31ba84}};_0x461287[_0x4c3f29(0x1f8)]&&(_0x313446['shopId']=_0x461287[_0x4c3f29(0x1f8)]);const _0x73d352=await database_1['default'][_0x4c3f29(0x368)][_0x4c3f29(0x263)]({'where':_0x313446,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x4c3f29(0x250)](_0x4c3f29(0x290)+_0x73d352[_0x4c3f29(0x1c5)]+'\x20paid\x20payments\x20for\x20analysis');const _0x245ab8={'gateway':{'not':_0x4c3f29(0x1c8)},'status':{'notIn':[_0x4c3f29(0x287),_0x4c3f29(0x339)]},'createdAt':{'gte':_0x4a4e5a,'lte':_0x31ba84}};_0x461287[_0x4c3f29(0x1f8)]&&(_0x245ab8[_0x4c3f29(0x1f8)]=_0x461287[_0x4c3f29(0x1f8)]);const _0x281453=await database_1[_0x4c3f29(0x228)][_0x4c3f29(0x368)]['count']({'where':_0x245ab8}),_0x163ab4={..._0x245ab8,'status':'CHARGEBACK'},_0x12dca1={..._0x245ab8,'status':_0x4c3f29(0x22e)},[_0x11bdf0,_0x1ef13e]=await Promise[_0x4c3f29(0x2f6)]([database_1[_0x4c3f29(0x228)][_0x4c3f29(0x368)][_0x4c3f29(0x21c)]({'where':_0x163ab4}),database_1[_0x4c3f29(0x228)][_0x4c3f29(0x368)]['count']({'where':_0x12dca1})]);console[_0x4c3f29(0x250)](_0x4c3f29(0x20c)+_0x281453+_0x4c3f29(0x1a7)+_0x73d352[_0x4c3f29(0x1c5)]+_0x4c3f29(0x2b7)+_0x11bdf0+',\x20refunds:\x20'+_0x1ef13e);let _0x38eb41=0x0,_0x18496b=0x0,_0x459d9d=0x0;const _0x3c46d1={},_0x3aa828={},_0x23184b={},_0xe4cdd7=new Date(_0x4a4e5a);while(_0xe4cdd7<=_0x31ba84){const _0x24fc64=_0xe4cdd7[_0x4c3f29(0x36d)]()[_0x4c3f29(0x1db)]('T')[0x0];_0x23184b[_0x24fc64]={'date':_0x24fc64,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0},_0xe4cdd7['setUTCDate'](_0xe4cdd7[_0x4c3f29(0x1bc)]()+0x1);}for(const _0x30618d of _0x73d352){try{const _0x5d6484=_0x30618d[_0x4c3f29(0x28c)]||0x0;if(_0x5d6484<=0x0){console[_0x4c3f29(0x26f)](_0x4c3f29(0x25a)+_0x30618d['id']+_0x4c3f29(0x2d2));continue;}let _0x4e7f98,_0x26c43a;if(_0x30618d['amountAfterGatewayCommissionUSDT']!==null&&_0x30618d[_0x4c3f29(0x2cd)]!==undefined)_0x4e7f98=_0x30618d[_0x4c3f29(0x2cd)],_0x26c43a=_0x5d6484-_0x4e7f98,console['log']('üìä\x20Using\x20saved\x20values\x20for\x20payment\x20'+_0x30618d['id']+':\x20'+_0x5d6484[_0x4c3f29(0x293)](0x6)+_0x4c3f29(0x1d4)+_0x4e7f98[_0x4c3f29(0x293)](0x6)+_0x4c3f29(0x2ea));else{let _0x2d42b1={};if(_0x30618d[_0x4c3f29(0x364)][_0x4c3f29(0x2e8)])try{_0x2d42b1=JSON['parse'](_0x30618d[_0x4c3f29(0x364)][_0x4c3f29(0x2e8)]);}catch(_0x2ef04f){console['error']('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x30618d['shopId']+':',_0x2ef04f);}let _0x5ae075=0x2d;for(const [_0x3e0414,_0x1ea084]of Object['entries'](_0x2d42b1)){if(_0x3e0414[_0x4c3f29(0x2d7)]()===_0x30618d[_0x4c3f29(0x21b)][_0x4c3f29(0x2d7)]()){_0x5ae075=_0x1ea084[_0x4c3f29(0x1c9)]||0x2d;break;}}_0x26c43a=_0x5d6484*(_0x5ae075/0x64),_0x4e7f98=_0x5d6484-_0x26c43a,console[_0x4c3f29(0x250)](_0x4c3f29(0x2bb)+_0x30618d['id']+':\x20'+_0x5ae075+_0x4c3f29(0x28a)+_0x5d6484[_0x4c3f29(0x293)](0x6)+_0x4c3f29(0x2ea));}_0x38eb41+=_0x5d6484,_0x18496b+=_0x4e7f98,_0x459d9d+=_0x26c43a;let _0x175108;_0x30618d[_0x4c3f29(0x350)]!==null&&_0x30618d[_0x4c3f29(0x350)]!==undefined?(_0x175108=_0x30618d[_0x4c3f29(0x350)],console[_0x4c3f29(0x250)]('üìä\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20'+_0x30618d['id']+':\x20'+_0x175108+'%')):(_0x175108=_0x5d6484>0x0?_0x26c43a/_0x5d6484*0x64:0x0,console[_0x4c3f29(0x250)]('üìä\x20Calculated\x20commission\x20rate\x20for\x20payment\x20'+_0x30618d['id']+':\x20'+_0x175108['toFixed'](0x2)+'%'));!_0x3c46d1[_0x30618d[_0x4c3f29(0x21b)]]&&(_0x3c46d1[_0x30618d[_0x4c3f29(0x21b)]]={'gateway':_0x30618d[_0x4c3f29(0x21b)],'gatewayDisplayName':this[_0x4c3f29(0x27c)](_0x30618d['gateway']),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x3c46d1[_0x30618d[_0x4c3f29(0x21b)]][_0x4c3f29(0x2a2)]++,_0x3c46d1[_0x30618d[_0x4c3f29(0x21b)]]['turnoverUSDT']+=_0x5d6484,_0x3c46d1[_0x30618d[_0x4c3f29(0x21b)]][_0x4c3f29(0x324)]+=_0x26c43a,_0x3c46d1[_0x30618d[_0x4c3f29(0x21b)]][_0x4c3f29(0x1f7)]+=_0x4e7f98,_0x3c46d1[_0x30618d[_0x4c3f29(0x21b)]][_0x4c3f29(0x1a6)]+=_0x175108;!_0x461287[_0x4c3f29(0x1f8)]&&(!_0x3aa828[_0x30618d[_0x4c3f29(0x1f8)]]&&(_0x3aa828[_0x30618d[_0x4c3f29(0x1f8)]]={'shopId':_0x30618d[_0x4c3f29(0x1f8)],'shopName':_0x30618d[_0x4c3f29(0x364)][_0x4c3f29(0x2df)],'shopUsername':_0x30618d[_0x4c3f29(0x364)][_0x4c3f29(0x23e)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x3aa828[_0x30618d[_0x4c3f29(0x1f8)]]['paymentsCount']++,_0x3aa828[_0x30618d[_0x4c3f29(0x1f8)]]['turnoverUSDT']+=_0x5d6484,_0x3aa828[_0x30618d['shopId']]['commissionUSDT']+=_0x26c43a,_0x3aa828[_0x30618d[_0x4c3f29(0x1f8)]][_0x4c3f29(0x1f7)]+=_0x4e7f98);const _0x28d2ae=_0x30618d[_0x4c3f29(0x1b8)][_0x4c3f29(0x36d)]()[_0x4c3f29(0x1db)]('T')[0x0];_0x23184b[_0x28d2ae]&&(_0x23184b[_0x28d2ae][_0x4c3f29(0x2d1)]+=_0x5d6484,_0x23184b[_0x28d2ae]['merchantEarnings']+=_0x4e7f98,_0x23184b[_0x28d2ae]['gatewayEarnings']+=_0x26c43a,_0x23184b[_0x28d2ae]['paymentsCount']++);}catch(_0x2a615c){console[_0x4c3f29(0x31a)](_0x4c3f29(0x223)+_0x30618d['id']+':',_0x2a615c);}}Object[_0x4c3f29(0x1d6)](_0x3c46d1)['forEach'](_0x258422=>{const _0x5e1776=_0x4c3f29;_0x258422['averageCommissionRate']=_0x258422[_0x5e1776(0x2a2)]>0x0?_0x258422[_0x5e1776(0x1a6)]/_0x258422['paymentsCount']:0x0,delete _0x258422[_0x5e1776(0x1a6)];}),Object['values'](_0x3aa828)['forEach'](_0x115bc5=>{const _0xff3c40=_0x4c3f29;_0x115bc5[_0xff3c40(0x2de)]=_0x115bc5[_0xff3c40(0x2a2)]>0x0?_0x115bc5[_0xff3c40(0x321)]/_0x115bc5[_0xff3c40(0x2a2)]:0x0;});let _0x36216b=0x0,_0x394c61=0x0;if(_0x461287[_0x4c3f29(0x1f8)]){const _0x2dfa79=await database_1[_0x4c3f29(0x228)][_0x4c3f29(0x27f)][_0x4c3f29(0x263)]({'where':{'shopId':_0x461287['shopId'],'status':'COMPLETED','createdAt':{'gte':_0x4a4e5a,'lte':_0x31ba84}},'select':{'amount':!![]}});_0x36216b=_0x2dfa79[_0x4c3f29(0x345)]((_0x7e2bb9,_0x516f55)=>_0x7e2bb9+_0x516f55[_0x4c3f29(0x248)],0x0);const _0xd50fe7=await database_1[_0x4c3f29(0x228)][_0x4c3f29(0x27f)][_0x4c3f29(0x263)]({'where':{'shopId':_0x461287['shopId'],'status':_0x4c3f29(0x287),'createdAt':{'gte':_0x4a4e5a,'lte':_0x31ba84}},'select':{'amount':!![]}});_0x394c61=_0xd50fe7[_0x4c3f29(0x345)]((_0x1bcc5b,_0xa897a8)=>_0x1bcc5b+_0xa897a8[_0x4c3f29(0x248)],0x0);}const _0x2c0cbb=_0x281453,_0x4f699a=_0x73d352[_0x4c3f29(0x1c5)],_0x5996a3=_0x4f699a>0x0?_0x38eb41/_0x4f699a:0x0,_0x2333ff=_0x2c0cbb>0x0?Math['round'](_0x4f699a/_0x2c0cbb*0x2710)/0x64:0x0,_0x9b4ae9=Math[_0x4c3f29(0x270)]((_0x31ba84[_0x4c3f29(0x1a3)]()-_0x4a4e5a[_0x4c3f29(0x1a3)]())/(0x3e8*0x3c*0x3c*0x18)),_0x1555ce={'totalTurnover':Math[_0x4c3f29(0x1ed)](_0x38eb41*0x64)/0x64,'merchantEarnings':Math[_0x4c3f29(0x1ed)](_0x18496b*0x64)/0x64,'gatewayEarnings':Math[_0x4c3f29(0x1ed)](_0x459d9d*0x64)/0x64,'totalPaidOut':Math[_0x4c3f29(0x1ed)](_0x36216b*0x64)/0x64,'pendingPayout':Math['round'](_0x394c61*0x64)/0x64,'averageCheck':Math[_0x4c3f29(0x1ed)](_0x5996a3*0x64)/0x64,'totalPayments':_0x2c0cbb,'successfulPayments':_0x4f699a,'conversionRate':_0x2333ff,'chargebacks':_0x11bdf0,'refunds':_0x1ef13e,'gatewayBreakdown':Object[_0x4c3f29(0x1d6)](_0x3c46d1)[_0x4c3f29(0x1c6)](_0x7f6b8f=>({..._0x7f6b8f,'turnoverUSDT':Math[_0x4c3f29(0x1ed)](_0x7f6b8f[_0x4c3f29(0x321)]*0x64)/0x64,'commissionUSDT':Math[_0x4c3f29(0x1ed)](_0x7f6b8f[_0x4c3f29(0x324)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x4c3f29(0x1ed)](_0x7f6b8f[_0x4c3f29(0x1f7)]*0x64)/0x64,'averageCommissionRate':Math[_0x4c3f29(0x1ed)](_0x7f6b8f[_0x4c3f29(0x2fb)]*0x64)/0x64})),'merchantBreakdown':_0x461287[_0x4c3f29(0x1f8)]?undefined:Object[_0x4c3f29(0x1d6)](_0x3aa828)[_0x4c3f29(0x1c6)](_0x2878fd=>({..._0x2878fd,'turnoverUSDT':Math['round'](_0x2878fd[_0x4c3f29(0x321)]*0x64)/0x64,'commissionUSDT':Math[_0x4c3f29(0x1ed)](_0x2878fd[_0x4c3f29(0x324)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x2878fd['merchantEarningsUSDT']*0x64)/0x64,'paidOutUSDT':Math[_0x4c3f29(0x1ed)](_0x2878fd['paidOutUSDT']*0x64)/0x64,'averageCheckUSDT':Math['round'](_0x2878fd[_0x4c3f29(0x2de)]*0x64)/0x64})),'dailyData':Object[_0x4c3f29(0x1d6)](_0x23184b)[_0x4c3f29(0x1c6)](_0x419fd3=>({..._0x419fd3,'turnover':Math[_0x4c3f29(0x1ed)](_0x419fd3['turnover']*0x64)/0x64,'merchantEarnings':Math[_0x4c3f29(0x1ed)](_0x419fd3[_0x4c3f29(0x1f0)]*0x64)/0x64,'gatewayEarnings':Math[_0x4c3f29(0x1ed)](_0x419fd3[_0x4c3f29(0x226)]*0x64)/0x64}))[_0x4c3f29(0x252)]((_0x1d761b,_0x1a13a7)=>_0x1d761b[_0x4c3f29(0x275)][_0x4c3f29(0x261)](_0x1a13a7[_0x4c3f29(0x275)])),'periodInfo':{'from':_0x4a4e5a,'to':_0x31ba84,'periodType':_0x461287['period']||_0x4c3f29(0x1e0),'daysCount':_0x9b4ae9}};return console[_0x4c3f29(0x250)]('üìä\x20Merchant\x20statistics\x20calculated:'),console[_0x4c3f29(0x250)](_0x4c3f29(0x379)+_0x1555ce[_0x4c3f29(0x1e8)]+_0x4c3f29(0x2ea)),console[_0x4c3f29(0x250)](_0x4c3f29(0x2d5)+_0x1555ce[_0x4c3f29(0x1f0)]+_0x4c3f29(0x2ea)),console[_0x4c3f29(0x250)](_0x4c3f29(0x1ac)+_0x1555ce[_0x4c3f29(0x226)]+_0x4c3f29(0x2ea)),console[_0x4c3f29(0x250)](_0x4c3f29(0x2f0)+_0x1555ce[_0x4c3f29(0x204)]+_0x4c3f29(0x2ea)),console['log']('\x20\x20\x20‚è≥\x20Pending\x20payout:\x20'+_0x1555ce[_0x4c3f29(0x327)]+_0x4c3f29(0x2ea)),console[_0x4c3f29(0x250)](_0x4c3f29(0x25f)+_0x1555ce['totalPayments']),_0x1555ce;}async[a53_0x2876e2(0x1a4)](_0x40dfde){const _0x209a10=a53_0x2876e2;console[_0x209a10(0x250)](_0x209a10(0x280),{'hasPayoutHistory':_0x40dfde});let _0x2a31fe={};_0x40dfde&&(_0x2a31fe[_0x209a10(0x2d6)]={'some':{}});const _0x1b2704=await database_1[_0x209a10(0x228)][_0x209a10(0x364)]['findMany']({'where':_0x2a31fe,'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x209a10(0x308)}});return console['log'](_0x209a10(0x22d)+_0x1b2704[_0x209a10(0x1c5)]+'\x20merchants\x20for\x20selection'+(_0x40dfde?_0x209a10(0x294):'')),_0x1b2704['map'](_0x909b64=>({'id':_0x909b64['id'],'username':_0x909b64[_0x209a10(0x23e)],'name':_0x909b64[_0x209a10(0x2df)]}));}[a53_0x2876e2(0x27c)](_0x17c3db){const _0x304854=a53_0x2876e2,_0x2dec65={'test_gateway':_0x304854(0x381),'plisio':_0x304854(0x35b),'rapyd':'Rapyd','noda':_0x304854(0x255),'cointopay':_0x304854(0x27d),'cointopay2':_0x304854(0x2c2),'klyme_eu':_0x304854(0x2ca),'klyme_gb':_0x304854(0x216),'klyme_de':_0x304854(0x207),'mastercard':'MasterCard','visa/mastercard':'Visa/MasterCard','amer':_0x304854(0x1ca),'myxspend':_0x304854(0x1e4),'ampay':_0x304854(0x336),'ampay_try':_0x304854(0x2b6),'sepa':_0x304854(0x220),'interac':'Interac','onramp':_0x304854(0x300),'squirrelpay':_0x304854(0x36e),'maxpara':_0x304854(0x2f3),'instaxchange':_0x304854(0x23f),'oxapay':'OxaPay'};return _0x2dec65[_0x17c3db]||_0x17c3db;}['getGatewayInternalName'](_0x5bbd96){const _0x500aaa=a53_0x2876e2,_0x26367c={'Test\x20Gateway':'test_gateway','Plisio':_0x500aaa(0x237),'Rapyd':_0x500aaa(0x2a8),'Noda':_0x500aaa(0x342),'CoinToPay':_0x500aaa(0x2e7),'CoinToPay2':_0x500aaa(0x1c2),'KLYME\x20EU':'klyme_eu','KLYME\x20GB':_0x500aaa(0x1fa),'KLYME\x20DE':'klyme_de','MasterCard':_0x500aaa(0x29c)};return _0x26367c[_0x5bbd96]||_0x5bbd96['toLowerCase']();}async['getMerchantsAwaitingPayout'](_0xe18bec){const _0x76aef3=a53_0x2876e2,{page:_0x4a6287,limit:_0x42edf3,minAmount:_0x3fc0fc,search:_0x4142ce}=_0xe18bec;console[_0x76aef3(0x250)](_0x76aef3(0x1e3),_0xe18bec);let _0x3826cd={};_0x4142ce&&(_0x3826cd[_0x76aef3(0x2df)]={'contains':_0x4142ce,'mode':'insensitive'});const _0x4243a8=await database_1['default'][_0x76aef3(0x364)][_0x76aef3(0x263)]({'where':_0x3826cd,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),_0x29f6be=_0x4243a8[_0x76aef3(0x281)](_0x6a0400=>{const _0x15dad4=_0x76aef3,_0x130c02=Math[_0x15dad4(0x32f)](_0x6a0400[_0x15dad4(0x348)]*0x64)/0x64;if(_0x3fc0fc&&_0x130c02<_0x3fc0fc)return![];return _0x130c02!==0x0;});_0x29f6be['sort']((_0x350ef4,_0x2d96f7)=>_0x2d96f7[_0x76aef3(0x348)]-_0x350ef4[_0x76aef3(0x348)]);const _0x364837=_0x29f6be[_0x76aef3(0x1c5)],_0x3c6e7a=(_0x4a6287-0x1)*_0x42edf3,_0x2d7e68=_0x29f6be[_0x76aef3(0x23c)](_0x3c6e7a,_0x3c6e7a+_0x42edf3);console[_0x76aef3(0x250)](_0x76aef3(0x290)+_0x2d7e68[_0x76aef3(0x1c5)]+_0x76aef3(0x1b5));const _0x2f7f25=await Promise['all'](_0x2d7e68['map'](async _0x568575=>{const _0x2e235d=_0x76aef3,[_0x16f3a6,_0x553010,_0x4a1e75]=await Promise[_0x2e235d(0x2f6)]([database_1[_0x2e235d(0x228)][_0x2e235d(0x368)]['count']({'where':{'shopId':_0x568575['id'],'status':'PAID','gateway':{'not':_0x2e235d(0x1c8)}}}),database_1[_0x2e235d(0x228)][_0x2e235d(0x368)]['findFirst']({'where':{'shopId':_0x568575['id'],'status':_0x2e235d(0x26e),'gateway':{'not':_0x2e235d(0x1c8)}},'orderBy':{'paidAt':_0x2e235d(0x308)},'select':{'paidAt':!![]}}),database_1[_0x2e235d(0x228)]['payment'][_0x2e235d(0x277)]({'by':[_0x2e235d(0x21b)],'where':{'shopId':_0x568575['id'],'status':_0x2e235d(0x26e),'gateway':{'not':_0x2e235d(0x1c8)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x5121a1=new Date(),_0x2ae89f=new Date(_0x5121a1[_0x2e235d(0x1ad)](),_0x5121a1[_0x2e235d(0x246)](),0x1),_0x32cad5=new Date(_0x5121a1[_0x2e235d(0x1ad)](),_0x5121a1['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x293c02,_0x2ff8a5]=await Promise[_0x2e235d(0x2f6)]([database_1[_0x2e235d(0x228)]['payout'][_0x2e235d(0x243)]({'_sum':{'amount':!![]},'where':{'shopId':_0x568575['id'],'status':_0x2e235d(0x304)}}),database_1['default']['payout'][_0x2e235d(0x243)]({'_sum':{'amount':!![]},'where':{'shopId':_0x568575['id'],'status':_0x2e235d(0x304),'createdAt':{'gte':_0x2ae89f,'lte':_0x32cad5}}})]),_0x244ab1=_0x293c02['_sum'][_0x2e235d(0x248)]||0x0,_0x2132e5=_0x2ff8a5[_0x2e235d(0x2a1)][_0x2e235d(0x248)]||0x0,_0x522a5d=await Promise[_0x2e235d(0x2f6)](_0x4a1e75[_0x2e235d(0x1c6)](async _0x9e78c9=>{const _0x253aa7=_0x2e235d,_0x1a8df6=await database_1[_0x253aa7(0x228)]['payment'][_0x253aa7(0x263)]({'where':{'shopId':_0x568575['id'],'status':'PAID','gateway':_0x9e78c9[_0x253aa7(0x21b)]},'select':{'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![]}});let _0x5e11c0=0x2d;if(_0x568575['gatewaySettings'])try{const _0x314d7c=JSON[_0x253aa7(0x329)](_0x568575['gatewaySettings']);for(const [_0x206944,_0x555a19]of Object[_0x253aa7(0x317)](_0x314d7c)){if(_0x206944[_0x253aa7(0x2d7)]()===_0x9e78c9['gateway'][_0x253aa7(0x2d7)]()){_0x5e11c0=_0x555a19[_0x253aa7(0x1c9)]||0xa,console[_0x253aa7(0x250)](_0x253aa7(0x2e5)+_0x9e78c9[_0x253aa7(0x21b)]+'\x20for\x20shop\x20'+_0x568575['id']+_0x253aa7(0x1f2)+_0x5e11c0+'%');break;}}}catch(_0x27583a){console['error'](_0x253aa7(0x2fa)+_0x568575['id']+':',_0x27583a);}const _0x514194=_0x9e78c9[_0x253aa7(0x2a1)]?.[_0x253aa7(0x28c)]||0x0;let _0x4cb3cc=0x0;for(const _0x2fac9c of _0x1a8df6){if(_0x2fac9c[_0x253aa7(0x2cd)]!==null&&_0x2fac9c['amountAfterGatewayCommissionUSDT']!==undefined)_0x4cb3cc+=_0x2fac9c['amountAfterGatewayCommissionUSDT'];else{const _0x1050f7=_0x2fac9c[_0x253aa7(0x28c)]||0x0;_0x4cb3cc+=_0x1050f7*(0x1-_0x5e11c0/0x64);}}return{'gateway':_0x9e78c9[_0x253aa7(0x21b)],'count':_0x9e78c9[_0x253aa7(0x328)]?.['id']||0x0,'amountUSDT':Math[_0x253aa7(0x1ed)](_0x514194*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x253aa7(0x1ed)](_0x4cb3cc*0x64)/0x64,'commission':_0x5e11c0};})),_0x1380fc=_0x522a5d[_0x2e235d(0x345)]((_0x2c4462,_0xdf76c3)=>_0x2c4462+_0xdf76c3['amountUSDT'],0x0),_0x173ef4=_0x522a5d[_0x2e235d(0x345)]((_0x2b9794,_0x5091b9)=>_0x2b9794+_0x5091b9[_0x2e235d(0x33f)],0x0),_0x2dcb17=_0x568575[_0x2e235d(0x348)];return console['log']('üí∞\x20[PAYOUT]\x20Merchant\x20'+_0x568575[_0x2e235d(0x23e)]+':'),console[_0x2e235d(0x250)](_0x2e235d(0x1e6)+_0x1380fc[_0x2e235d(0x293)](0x2)+_0x2e235d(0x27b)),console[_0x2e235d(0x250)](_0x2e235d(0x1f5)+_0x173ef4['toFixed'](0x2)+'\x20USDT\x20(theoretical\x20net)'),console[_0x2e235d(0x250)]('\x20\x20\x20‚úÖ\x20Actual\x20available\x20balance:\x20'+_0x2dcb17['toFixed'](0x2)+_0x2e235d(0x265)),console[_0x2e235d(0x250)](_0x2e235d(0x20a)+_0x244ab1['toFixed'](0x2)+_0x2e235d(0x264)),console[_0x2e235d(0x250)](_0x2e235d(0x2ac)+(_0x173ef4-_0x244ab1-_0x2dcb17)[_0x2e235d(0x293)](0x2)+_0x2e235d(0x383)),{'id':_0x568575['id'],'fullName':_0x568575['name'],'username':_0x568575[_0x2e235d(0x23e)],'telegramId':_0x568575[_0x2e235d(0x311)],'merchantUrl':_0x568575['shopUrl'],'wallets':{'usdtPolygonWallet':_0x568575[_0x2e235d(0x384)],'usdtTrcWallet':_0x568575[_0x2e235d(0x21d)],'usdtErcWallet':_0x568575[_0x2e235d(0x306)],'usdcPolygonWallet':_0x568575[_0x2e235d(0x2aa)],'usdcErcWallet':_0x568575[_0x2e235d(0x1a2)]},'totalAmountUSDT':Math[_0x2e235d(0x1ed)](_0x1380fc*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x2e235d(0x1ed)](_0x173ef4*0x64)/0x64,'currentBalance':Math['floor'](_0x2dcb17*0x64)/0x64,'totalPayout':Math['round'](_0x244ab1*0x64)/0x64,'thisMonth':Math[_0x2e235d(0x1ed)](_0x2132e5*0x64)/0x64,'paymentsCount':_0x16f3a6,'oldestPaymentDate':_0x553010?.[_0x2e235d(0x1b8)]||_0x568575[_0x2e235d(0x301)],'gatewayBreakdown':_0x522a5d};})),_0x5a0970=_0x2f7f25[_0x76aef3(0x345)]((_0x25fe1c,_0x1fde97)=>_0x25fe1c+_0x1fde97[_0x76aef3(0x22f)],0x0),_0x3560f2=_0x2f7f25['reduce']((_0x358277,_0x1002da)=>_0x358277+_0x1002da['totalAmountAfterCommissionUSDT'],0x0),_0x1e051f=_0x2f7f25[_0x76aef3(0x345)]((_0x418098,_0x573843)=>_0x418098+_0x573843[_0x76aef3(0x236)],0x0),_0x3fd014=_0x2f7f25[_0x76aef3(0x345)]((_0x1bfdf3,_0x4eddaf)=>_0x1bfdf3+_0x4eddaf[_0x76aef3(0x241)],0x0);return console[_0x76aef3(0x250)]('üìä\x20Merchants\x20with\x20rounded\x20balance\x20!=\x200.00:\x20'+_0x364837+_0x76aef3(0x19f)),console[_0x76aef3(0x250)](_0x76aef3(0x35f)+Math['round'](_0x5a0970*0x64)/0x64+_0x76aef3(0x27b)),console[_0x76aef3(0x250)]('\x20\x20\x20‚úÖ\x20Total\x20net\x20balances:\x20'+Math['round'](_0x3560f2*0x64)/0x64+'\x20USDT\x20(rounded\x20to\x202\x20decimal\x20places)'),console[_0x76aef3(0x250)](_0x76aef3(0x2a3)+Math[_0x76aef3(0x1ed)](_0x1e051f*0x64)/0x64+_0x76aef3(0x2ea)),console[_0x76aef3(0x250)](_0x76aef3(0x314)+Math['round'](_0x3fd014*0x64)/0x64+_0x76aef3(0x2ea)),{'merchants':_0x2f7f25,'pagination':{'page':_0x4a6287,'limit':_0x42edf3,'total':_0x364837,'totalPages':Math[_0x76aef3(0x270)](_0x364837/_0x42edf3)},'summary':{'totalMerchants':_0x364837,'totalAmountUSDT':Math[_0x76aef3(0x1ed)](_0x5a0970*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x76aef3(0x1ed)](_0x3560f2*0x64)/0x64,'totalPayout':Math['round'](_0x1e051f*0x64)/0x64,'thisMonth':Math[_0x76aef3(0x1ed)](_0x3fd014*0x64)/0x64}};}async[a53_0x2876e2(0x325)](_0x170f5b){const _0x584001=a53_0x2876e2,{shopId:_0x205c34,amount:_0x44a09a,network:_0x4fd6e7,wallet:_0x3306ab,notes:_0x393f21,txid:_0xa2aa01,periodFrom:_0x3c5986,periodTo:_0xd2275d}=_0x170f5b,_0x3b17d4=await database_1[_0x584001(0x228)]['$transaction'](async _0x148808=>{const _0x2f8b3f=_0x584001,_0x387561=await _0x148808['shop']['findUnique']({'where':{'id':_0x205c34},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x387561)throw new Error(_0x2f8b3f(0x282));console[_0x2f8b3f(0x250)](_0x2f8b3f(0x33d)+_0x387561[_0x2f8b3f(0x23e)]+':'),console[_0x2f8b3f(0x250)](_0x2f8b3f(0x2e3)+_0x387561[_0x2f8b3f(0x348)][_0x2f8b3f(0x293)](0x6)+_0x2f8b3f(0x2ea)),console[_0x2f8b3f(0x250)](_0x2f8b3f(0x2a9)+_0x44a09a[_0x2f8b3f(0x293)](0x6)+_0x2f8b3f(0x2ea)),console[_0x2f8b3f(0x250)](_0x2f8b3f(0x1ae)+_0x387561[_0x2f8b3f(0x204)][_0x2f8b3f(0x293)](0x6)+_0x2f8b3f(0x2ea));if(_0xa2aa01)console[_0x2f8b3f(0x250)](_0x2f8b3f(0x1ec)+_0xa2aa01);const _0x2b407f=0.000001,_0x44e458=Number(_0x387561[_0x2f8b3f(0x348)]),_0x503e34=Number(_0x44a09a);console[_0x2f8b3f(0x250)]('üîç\x20Balance\x20check\x20details:'),console['log']('\x20\x20\x20Available\x20(raw):\x20'+_0x387561[_0x2f8b3f(0x348)]),console[_0x2f8b3f(0x250)]('\x20\x20\x20Available\x20(number):\x20'+_0x44e458),console[_0x2f8b3f(0x250)](_0x2f8b3f(0x251)+_0x503e34),console[_0x2f8b3f(0x250)]('\x20\x20\x20Difference:\x20'+(_0x44e458-_0x503e34)),console[_0x2f8b3f(0x250)](_0x2f8b3f(0x2e1)+_0x2b407f);if(_0x44e458<_0x503e34-_0x2b407f)throw new Error(_0x2f8b3f(0x30b)+_0x44e458[_0x2f8b3f(0x293)](0x6)+_0x2f8b3f(0x1de)+_0x503e34[_0x2f8b3f(0x293)](0x6)+_0x2f8b3f(0x2d3)+(_0x44e458-_0x503e34)[_0x2f8b3f(0x293)](0x8)+_0x2f8b3f(0x2ea));console[_0x2f8b3f(0x250)](_0x2f8b3f(0x334));const _0x3397c8=Math[_0x2f8b3f(0x30d)](_0x44e458,_0x503e34);let _0x224bef=_0x3306ab;console[_0x2f8b3f(0x250)](_0x2f8b3f(0x2d4)+(_0x3306ab||_0x2f8b3f(0x202)));if(!_0x224bef){console[_0x2f8b3f(0x250)](_0x2f8b3f(0x26d));const _0x3c5a3b=await _0x148808[_0x2f8b3f(0x364)]['findUnique']({'where':{'id':_0x205c34},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});console[_0x2f8b3f(0x250)]('üîç\x20Shop\x20wallets:',_0x3c5a3b);if(_0x3c5a3b)switch(_0x4fd6e7){case'polygon':_0x224bef=_0x3c5a3b[_0x2f8b3f(0x384)]||undefined,console['log'](_0x2f8b3f(0x22a)+_0x224bef);break;case _0x2f8b3f(0x354):_0x224bef=_0x3c5a3b[_0x2f8b3f(0x21d)]||undefined,console[_0x2f8b3f(0x250)](_0x2f8b3f(0x2e2)+_0x224bef);break;case _0x2f8b3f(0x206):_0x224bef=_0x3c5a3b[_0x2f8b3f(0x306)]||undefined,console[_0x2f8b3f(0x250)]('üîç\x20Selected\x20erc20\x20wallet:\x20'+_0x224bef);break;case _0x2f8b3f(0x28e):_0x224bef=_0x3c5a3b[_0x2f8b3f(0x2aa)]||undefined,console[_0x2f8b3f(0x250)](_0x2f8b3f(0x33e)+_0x224bef);break;case _0x2f8b3f(0x30f):_0x224bef=_0x3c5a3b[_0x2f8b3f(0x1a2)]||undefined,console[_0x2f8b3f(0x250)](_0x2f8b3f(0x1c1)+_0x224bef);break;}}else console[_0x2f8b3f(0x250)](_0x2f8b3f(0x2fd)+_0x224bef);console['log'](_0x2f8b3f(0x25c)+_0x4fd6e7+':\x20'+(_0x224bef||'not\x20specified')),console[_0x2f8b3f(0x250)](_0x2f8b3f(0x20d),{'shopId':_0x205c34,'amount':_0x3397c8,'network':_0x4fd6e7,'wallet':_0x224bef,'status':_0x2f8b3f(0x304),'txid':_0xa2aa01,'notes':_0x393f21,'periodFrom':_0x3c5986?new Date(_0x3c5986):null,'periodTo':_0xd2275d?new Date(_0xd2275d):null});const _0x355ec9=await _0x148808['payout']['create']({'data':{'shopId':_0x205c34,'amount':_0x3397c8,'network':_0x4fd6e7,'wallet':_0x224bef,'status':_0x2f8b3f(0x304),'txid':_0xa2aa01,'notes':_0x393f21,'periodFrom':_0x3c5986?new Date(_0x3c5986):null,'periodTo':_0xd2275d?new Date(_0xd2275d):null,'createdAt':new Date(),'paidAt':new Date()}});console[_0x2f8b3f(0x250)]('‚úÖ\x20Payout\x20created\x20in\x20DB:',{'id':_0x355ec9['id'],'wallet':_0x355ec9['wallet'],'network':_0x355ec9[_0x2f8b3f(0x359)],'amount':_0x355ec9['amount']});const _0xd0f809=_0x44e458-_0x3397c8,_0x4a507d=Number(_0x387561[_0x2f8b3f(0x204)])+_0x3397c8;return await _0x148808[_0x2f8b3f(0x364)][_0x2f8b3f(0x2da)]({'where':{'id':_0x205c34},'data':{'balance':_0xd0f809,'totalPaidOut':_0x4a507d}}),console[_0x2f8b3f(0x250)](_0x2f8b3f(0x319)+_0x387561[_0x2f8b3f(0x23e)]+'\x20balance\x20updated:'),console[_0x2f8b3f(0x250)](_0x2f8b3f(0x1d5)+_0x44e458[_0x2f8b3f(0x293)](0x6)+_0x2f8b3f(0x1af)+_0xd0f809[_0x2f8b3f(0x293)](0x6)+_0x2f8b3f(0x214)+_0x3397c8['toFixed'](0x6)+')'),console[_0x2f8b3f(0x250)](_0x2f8b3f(0x2f5)+_0x387561['totalPaidOut'][_0x2f8b3f(0x293)](0x6)+_0x2f8b3f(0x1af)+_0x4a507d[_0x2f8b3f(0x293)](0x6)+_0x2f8b3f(0x285)+_0x3397c8['toFixed'](0x6)+')'),console[_0x2f8b3f(0x250)](_0x2f8b3f(0x209)+_0x3397c8['toFixed'](0x6)+'\x20USDT'),{'payout':_0x355ec9,'shop':_0x387561};});console[_0x584001(0x250)](_0x584001(0x2cc)+_0x3b17d4[_0x584001(0x27f)]['id']+_0x584001(0x347)+_0x3b17d4[_0x584001(0x364)]['username']+'\x20('+_0x3b17d4[_0x584001(0x27f)][_0x584001(0x248)][_0x584001(0x293)](0x6)+_0x584001(0x22b));try{let _0x42faba=_0x584001(0x233);if(_0x3b17d4['payout'][_0x584001(0x1b1)]&&_0x3b17d4[_0x584001(0x27f)][_0x584001(0x2a6)]){const _0x3b56c3=new Date(_0x3b17d4[_0x584001(0x27f)][_0x584001(0x1b1)])[_0x584001(0x1a0)]('ru-RU'),_0x15791e=new Date(_0x3b17d4['payout'][_0x584001(0x2a6)])[_0x584001(0x1a0)](_0x584001(0x29a));_0x42faba=_0x3b56c3+_0x584001(0x346)+_0x15791e;}await telegramBotService_1[_0x584001(0x312)][_0x584001(0x295)](_0x3b17d4[_0x584001(0x27f)]['shopId'],{'id':_0x3b17d4[_0x584001(0x27f)]['id'],'amount':_0x3b17d4['payout'][_0x584001(0x248)],'network':_0x3b17d4[_0x584001(0x27f)][_0x584001(0x359)],'wallet':_0x3b17d4[_0x584001(0x27f)][_0x584001(0x268)],'period':_0x42faba,'createdAt':_0x3b17d4[_0x584001(0x27f)]['createdAt'],'txid':_0x3b17d4['payout'][_0x584001(0x380)]}),console[_0x584001(0x250)](_0x584001(0x36a)+_0x3b17d4[_0x584001(0x27f)]['id']);}catch(_0x31574b){console['error'](_0x584001(0x1f4)+_0x3b17d4['payout']['id']+':',_0x31574b);}return{'id':_0x3b17d4[_0x584001(0x27f)]['id'],'shopId':_0x3b17d4[_0x584001(0x27f)][_0x584001(0x1f8)],'shopName':_0x3b17d4['shop'][_0x584001(0x2df)],'shopUsername':_0x3b17d4[_0x584001(0x364)][_0x584001(0x23e)],'amount':_0x3b17d4[_0x584001(0x27f)][_0x584001(0x248)],'network':_0x3b17d4[_0x584001(0x27f)][_0x584001(0x359)],'wallet':_0x3b17d4['payout']['wallet'],'status':_0x3b17d4[_0x584001(0x27f)][_0x584001(0x2be)],'txid':_0x3b17d4['payout']['txid'],'notes':_0x3b17d4[_0x584001(0x27f)][_0x584001(0x208)],'periodFrom':_0x3b17d4[_0x584001(0x27f)][_0x584001(0x1b1)],'periodTo':_0x3b17d4['payout'][_0x584001(0x2a6)],'createdAt':_0x3b17d4[_0x584001(0x27f)][_0x584001(0x301)],'paidAt':_0x3b17d4[_0x584001(0x27f)][_0x584001(0x1b8)]};}async['getAllPayouts'](_0x4169f1){const _0x3ffe5f=a53_0x2876e2,{page:_0x3236de,limit:_0x47a24f,shopId:_0x310744,network:_0x2d601d,dateFrom:_0x196468,dateTo:_0x395b1c,search:_0x102406}=_0x4169f1,_0x1aec0f=(_0x3236de-0x1)*_0x47a24f,_0x42a2ef={};_0x310744&&(_0x42a2ef[_0x3ffe5f(0x1f8)]=_0x310744);_0x2d601d&&(_0x42a2ef[_0x3ffe5f(0x359)]=_0x2d601d);if(_0x196468||_0x395b1c){_0x42a2ef[_0x3ffe5f(0x301)]={};if(_0x196468){const _0x38671f=new Date(_0x196468);_0x38671f['setHours'](0x0,0x0,0x0,0x1),_0x42a2ef[_0x3ffe5f(0x301)][_0x3ffe5f(0x349)]=_0x38671f,console[_0x3ffe5f(0x250)](_0x3ffe5f(0x279)+_0x38671f[_0x3ffe5f(0x36d)]());}if(_0x395b1c){const _0x545d94=new Date(_0x395b1c);_0x545d94[_0x3ffe5f(0x377)](0x17,0x3b,0x3b,0x3e7),_0x42a2ef['createdAt'][_0x3ffe5f(0x2d8)]=_0x545d94,console[_0x3ffe5f(0x250)](_0x3ffe5f(0x2cf)+_0x545d94[_0x3ffe5f(0x36d)]());}}_0x102406&&(_0x42a2ef['OR']=[{'shop':{'name':{'contains':_0x102406,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x102406,'mode':'insensitive'}}},{'notes':{'contains':_0x102406,'mode':_0x3ffe5f(0x269)}}]);const [_0xc54089,_0x3c0251]=await Promise[_0x3ffe5f(0x2f6)]([database_1[_0x3ffe5f(0x228)]['payout'][_0x3ffe5f(0x263)]({'where':_0x42a2ef,'skip':_0x1aec0f,'take':_0x47a24f,'orderBy':{'createdAt':_0x3ffe5f(0x2e0)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'wallet':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default']['payout'][_0x3ffe5f(0x21c)]({'where':_0x42a2ef})]);return{'payouts':_0xc54089[_0x3ffe5f(0x1c6)](_0x36e4f4=>({'id':_0x36e4f4['id'],'shopId':_0x36e4f4['shopId'],'shopName':_0x36e4f4['shop'][_0x3ffe5f(0x2df)],'shopUsername':_0x36e4f4[_0x3ffe5f(0x364)][_0x3ffe5f(0x23e)],'amount':_0x36e4f4['amount'],'network':_0x36e4f4['network'],'wallet':_0x36e4f4[_0x3ffe5f(0x268)],'status':_0x36e4f4['status'],'txid':_0x36e4f4[_0x3ffe5f(0x380)],'notes':_0x36e4f4[_0x3ffe5f(0x208)],'periodFrom':_0x36e4f4['periodFrom'],'periodTo':_0x36e4f4[_0x3ffe5f(0x2a6)],'createdAt':_0x36e4f4[_0x3ffe5f(0x301)],'paidAt':_0x36e4f4[_0x3ffe5f(0x1b8)]})),'pagination':{'page':_0x3236de,'limit':_0x47a24f,'total':_0x3c0251,'totalPages':Math[_0x3ffe5f(0x270)](_0x3c0251/_0x47a24f)}};}async[a53_0x2876e2(0x35d)](_0x3cf418){const _0x178568=a53_0x2876e2,_0x5d200f=await database_1[_0x178568(0x228)]['payout'][_0x178568(0x254)]({'where':{'id':_0x3cf418},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x5d200f)return null;return{'id':_0x5d200f['id'],'shopId':_0x5d200f[_0x178568(0x1f8)],'shopName':_0x5d200f[_0x178568(0x364)][_0x178568(0x2df)],'shopUsername':_0x5d200f['shop'][_0x178568(0x23e)],'amount':_0x5d200f[_0x178568(0x248)],'network':_0x5d200f[_0x178568(0x359)],'wallet':_0x5d200f['wallet'],'status':_0x5d200f['status'],'txid':_0x5d200f[_0x178568(0x380)],'notes':_0x5d200f[_0x178568(0x208)],'periodFrom':_0x5d200f[_0x178568(0x1b1)],'periodTo':_0x5d200f[_0x178568(0x2a6)],'createdAt':_0x5d200f[_0x178568(0x301)],'paidAt':_0x5d200f[_0x178568(0x1b8)]};}async[a53_0x2876e2(0x1f9)](_0x41fcb5){const _0x9b664a=a53_0x2876e2;await database_1[_0x9b664a(0x228)][_0x9b664a(0x27f)][_0x9b664a(0x335)]({'where':{'id':_0x41fcb5}});}async[a53_0x2876e2(0x365)](_0x3f3663,_0x4fe0d9){const _0x3c8088=a53_0x2876e2,_0x5177a6=await database_1[_0x3c8088(0x228)][_0x3c8088(0x2f4)](async _0x24c52e=>{const _0x1bcc23=_0x3c8088,_0x2bf42f=await _0x24c52e['payout']['findUnique']({'where':{'id':_0x3f3663},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}}}});if(!_0x2bf42f)throw new Error(_0x1bcc23(0x37e));console[_0x1bcc23(0x250)](_0x1bcc23(0x1e5)+_0x3f3663+_0x1bcc23(0x347)+_0x2bf42f['shop'][_0x1bcc23(0x23e)]+':'),console[_0x1bcc23(0x250)](_0x1bcc23(0x37a)+_0x2bf42f[_0x1bcc23(0x248)]['toFixed'](0x6)+_0x1bcc23(0x2ea)),console[_0x1bcc23(0x250)](_0x1bcc23(0x313)+_0x2bf42f[_0x1bcc23(0x359)]),console['log']('\x20\x20\x20Shop\x20balance:\x20'+_0x2bf42f[_0x1bcc23(0x364)][_0x1bcc23(0x348)][_0x1bcc23(0x293)](0x6)+_0x1bcc23(0x2ea)),console[_0x1bcc23(0x250)](_0x1bcc23(0x1fd)+_0x2bf42f[_0x1bcc23(0x364)][_0x1bcc23(0x204)][_0x1bcc23(0x293)](0x6)+_0x1bcc23(0x2ea));let _0x48615f=0x0;if(_0x4fe0d9[_0x1bcc23(0x248)]!==undefined){const _0x3e9dd4=Number(_0x2bf42f['amount']),_0x11a8bf=Number(_0x4fe0d9[_0x1bcc23(0x248)]);_0x48615f=_0x11a8bf-_0x3e9dd4,console['log'](_0x1bcc23(0x1da)+_0x11a8bf[_0x1bcc23(0x293)](0x6)+_0x1bcc23(0x2ea)),console[_0x1bcc23(0x250)](_0x1bcc23(0x30a)+_0x48615f[_0x1bcc23(0x293)](0x6)+'\x20USDT');if(_0x48615f<0x0)console[_0x1bcc23(0x250)](_0x1bcc23(0x37c)+Math[_0x1bcc23(0x355)](_0x48615f)[_0x1bcc23(0x293)](0x6)+_0x1bcc23(0x1bd));else{if(_0x48615f>0x0){const _0x128476=Number(_0x2bf42f['shop'][_0x1bcc23(0x348)]);console[_0x1bcc23(0x250)](_0x1bcc23(0x2b5)+_0x48615f[_0x1bcc23(0x293)](0x6)+'\x20USDT\x20-\x20will\x20deduct\x20from\x20balance');if(_0x128476<_0x48615f)throw new Error(_0x1bcc23(0x1a1)+_0x128476['toFixed'](0x6)+_0x1bcc23(0x2e9)+_0x48615f['toFixed'](0x6)+_0x1bcc23(0x2ea));}}}const _0x668098={};if(_0x4fe0d9[_0x1bcc23(0x248)]!==undefined)_0x668098[_0x1bcc23(0x248)]=_0x4fe0d9[_0x1bcc23(0x248)];if(_0x4fe0d9['network']!==undefined)_0x668098[_0x1bcc23(0x359)]=_0x4fe0d9[_0x1bcc23(0x359)];if(_0x4fe0d9[_0x1bcc23(0x268)]!==undefined)_0x668098[_0x1bcc23(0x268)]=_0x4fe0d9[_0x1bcc23(0x268)]||null;if(_0x4fe0d9[_0x1bcc23(0x208)]!==undefined)_0x668098['notes']=_0x4fe0d9[_0x1bcc23(0x208)]||null;if(_0x4fe0d9[_0x1bcc23(0x380)]!==undefined)_0x668098['txid']=_0x4fe0d9[_0x1bcc23(0x380)]||null;if(_0x4fe0d9[_0x1bcc23(0x1b1)]!==undefined)_0x668098[_0x1bcc23(0x1b1)]=_0x4fe0d9[_0x1bcc23(0x1b1)]?new Date(_0x4fe0d9[_0x1bcc23(0x1b1)]):null;if(_0x4fe0d9[_0x1bcc23(0x2a6)]!==undefined)_0x668098[_0x1bcc23(0x2a6)]=_0x4fe0d9[_0x1bcc23(0x2a6)]?new Date(_0x4fe0d9['periodTo']):null;const _0x3861b1=await _0x24c52e['payout'][_0x1bcc23(0x2da)]({'where':{'id':_0x3f3663},'data':_0x668098,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(_0x48615f!==0x0){const _0x2f72af=Number(_0x2bf42f[_0x1bcc23(0x364)][_0x1bcc23(0x348)]),_0x2793db=Number(_0x2bf42f[_0x1bcc23(0x364)][_0x1bcc23(0x204)]),_0xf63948=_0x2f72af-_0x48615f,_0x5b1bd0=_0x2793db+_0x48615f;await _0x24c52e[_0x1bcc23(0x364)][_0x1bcc23(0x2da)]({'where':{'id':_0x2bf42f['shopId']},'data':{'balance':_0xf63948,'totalPaidOut':_0x5b1bd0}}),console[_0x1bcc23(0x250)](_0x1bcc23(0x319)+_0x2bf42f[_0x1bcc23(0x364)]['username']+_0x1bcc23(0x20e)),console[_0x1bcc23(0x250)]('\x20\x20\x20Balance:\x20'+_0x2f72af['toFixed'](0x6)+_0x1bcc23(0x1af)+_0xf63948[_0x1bcc23(0x293)](0x6)+_0x1bcc23(0x2ea)),console['log']('\x20\x20\x20Total\x20paid\x20out:\x20'+_0x2793db[_0x1bcc23(0x293)](0x6)+_0x1bcc23(0x1af)+_0x5b1bd0[_0x1bcc23(0x293)](0x6)+_0x1bcc23(0x2ea));}return console[_0x1bcc23(0x250)](_0x1bcc23(0x213)+_0x3f3663+_0x1bcc23(0x26a)),_0x3861b1;});return{'id':_0x5177a6['id'],'shopId':_0x5177a6[_0x3c8088(0x1f8)],'shopName':_0x5177a6[_0x3c8088(0x364)][_0x3c8088(0x2df)],'shopUsername':_0x5177a6[_0x3c8088(0x364)][_0x3c8088(0x23e)],'amount':Number(_0x5177a6[_0x3c8088(0x248)]),'network':_0x5177a6['network'],'wallet':_0x5177a6['wallet'],'status':_0x5177a6[_0x3c8088(0x2be)],'txid':_0x5177a6[_0x3c8088(0x380)],'notes':_0x5177a6['notes'],'periodFrom':_0x5177a6['periodFrom'],'periodTo':_0x5177a6['periodTo'],'createdAt':_0x5177a6[_0x3c8088(0x301)],'paidAt':_0x5177a6[_0x3c8088(0x1b8)]};}async[a53_0x2876e2(0x267)](_0x51a097){const _0xe46850=a53_0x2876e2,{page:_0x18d51f,limit:_0x3f2031,status:_0x3bd529,gateway:_0x44b693,shopId:_0x1791bd,dateFrom:_0x4b13c0,dateTo:_0x22b6f6,search:_0x1f93fb,currency:_0x444fa8,sortBy:_0x57b7eb,sortOrder:_0x4ab98e}=_0x51a097,_0x10af3e=(_0x18d51f-0x1)*_0x3f2031;console['log'](_0xe46850(0x1b4),_0x51a097);const _0x14cc27=await database_1[_0xe46850(0x228)]['payment']['groupBy']({'by':[_0xe46850(0x21b)],'_count':{'gateway':!![]}});console['log'](_0xe46850(0x33a),_0x14cc27[_0xe46850(0x1c6)](_0x59d555=>_0x59d555[_0xe46850(0x21b)]+'\x20('+_0x59d555['_count']['gateway']+_0xe46850(0x1fb)));if(_0x44b693){const _0xf7f699=_0x14cc27[_0xe46850(0x29d)](_0x2542d7=>_0x2542d7[_0xe46850(0x21b)][_0xe46850(0x2d7)]()===_0x44b693[_0xe46850(0x2d7)]());!_0xf7f699&&_0x44b693[_0xe46850(0x2d7)]()!==_0xe46850(0x1c8)&&console['log']('‚ö†Ô∏è\x20Requested\x20gateway\x20\x27'+_0x44b693+_0xe46850(0x2e6)+_0x14cc27['map'](_0x168711=>_0x168711[_0xe46850(0x21b)])[_0xe46850(0x34e)](',\x20'));}const _0x8e418c={};_0x3bd529&&(_0x8e418c['status']=_0x3bd529[_0xe46850(0x273)]());if(!_0x44b693)_0x8e418c[_0xe46850(0x21b)]={'not':_0xe46850(0x1c8)};else{if(_0x44b693&&(_0x44b693[_0xe46850(0x2d7)]()===_0xe46850(0x1c8)||_0x44b693===_0xe46850(0x369)))_0x8e418c[_0xe46850(0x21b)]=_0xe46850(0x1c8);else{let _0x9f7795=_0x44b693;const _0x223205=(0x0,gateway_1[_0xe46850(0x344)])(_0x44b693);if(_0x223205)_0x9f7795=_0x223205,console[_0xe46850(0x250)]('üîÑ\x20Converted\x20gateway\x20ID\x20\x27'+_0x44b693+_0xe46850(0x2d0)+_0x9f7795+'\x27');else{const _0x213ad0=(0x0,gateway_1['getGatewayIdByName'])(_0x44b693);if(_0x213ad0){const _0x2bba82=(0x0,gateway_1[_0xe46850(0x344)])(_0x213ad0);_0x2bba82&&(_0x9f7795=_0x2bba82,console[_0xe46850(0x250)](_0xe46850(0x1c0)+_0x44b693+'\x27\x20->\x20ID\x20\x27'+_0x213ad0+_0xe46850(0x341)+_0x9f7795+'\x27'));}else console[_0xe46850(0x250)](_0xe46850(0x289)+_0x44b693+_0xe46850(0x2ee));}const _0x439177=await database_1[_0xe46850(0x228)][_0xe46850(0x368)]['count']({'where':{'gateway':_0x9f7795[_0xe46850(0x2d7)]()},'take':0x1});_0x439177===0x0?(console[_0xe46850(0x250)](_0xe46850(0x375)+_0x9f7795+_0xe46850(0x258)+_0x44b693+_0xe46850(0x31b)),_0x8e418c['gateway']='NONEXISTENT_GATEWAY_FILTER'):(_0x8e418c[_0xe46850(0x21b)]=_0x9f7795[_0xe46850(0x2d7)](),console[_0xe46850(0x250)](_0xe46850(0x340)+_0x9f7795+_0xe46850(0x258)+_0x44b693+'\x27)'));}}console[_0xe46850(0x250)](_0xe46850(0x296),_0x8e418c['gateway']);_0x1791bd&&(_0x8e418c[_0xe46850(0x1f8)]=_0x1791bd);_0x444fa8&&(_0x8e418c[_0xe46850(0x372)]=_0x444fa8['toUpperCase'](),console[_0xe46850(0x250)](_0xe46850(0x2a7)+_0x444fa8[_0xe46850(0x273)]()));if(_0x4b13c0||_0x22b6f6){_0x8e418c[_0xe46850(0x301)]={};if(_0x4b13c0){const _0x303beb=new Date(_0x4b13c0),_0x2a8841=new Date(Date[_0xe46850(0x2b1)](_0x303beb[_0xe46850(0x2dd)](),_0x303beb[_0xe46850(0x292)](),_0x303beb[_0xe46850(0x1bc)](),0x0,0x0,0x0,0x0));_0x8e418c['createdAt']['gte']=_0x2a8841,console[_0xe46850(0x250)](_0xe46850(0x31f)+_0x2a8841[_0xe46850(0x36d)]());}if(_0x22b6f6){const _0x46a92b=new Date(_0x22b6f6),_0x5e2c71=new Date(Date[_0xe46850(0x2b1)](_0x46a92b[_0xe46850(0x2dd)](),_0x46a92b['getUTCMonth'](),_0x46a92b['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));_0x8e418c['createdAt'][_0xe46850(0x2d8)]=_0x5e2c71,console['log'](_0xe46850(0x357)+_0x5e2c71[_0xe46850(0x36d)]());}}_0x1f93fb&&(_0x8e418c['OR']=[{'id':{'contains':_0x1f93fb,'mode':_0xe46850(0x269)}},{'orderId':{'contains':_0x1f93fb,'mode':_0xe46850(0x269)}},{'gatewayOrderId':{'contains':_0x1f93fb,'mode':_0xe46850(0x269)}},{'customerEmail':{'contains':_0x1f93fb,'mode':'insensitive'}},{'shop':{'name':{'contains':_0x1f93fb,'mode':_0xe46850(0x269)}}},{'shop':{'username':{'contains':_0x1f93fb,'mode':'insensitive'}}}]);console['log'](_0xe46850(0x2fc),JSON[_0xe46850(0x25d)](_0x8e418c,null,0x2));const _0x38119d=await database_1[_0xe46850(0x228)][_0xe46850(0x368)][_0xe46850(0x21c)]({'where':_0x8e418c});console['log'](_0xe46850(0x21e)+_0x38119d);let _0x58b978={'createdAt':_0xe46850(0x2e0)};if(_0x57b7eb){const _0x2be58a=[_0xe46850(0x248),_0xe46850(0x301),_0xe46850(0x24b),_0xe46850(0x2be),'gateway',_0xe46850(0x372)],_0x3d1a5e=['asc',_0xe46850(0x2e0)];if(_0x2be58a[_0xe46850(0x2ae)](_0x57b7eb)){const _0x2b9468=_0x3d1a5e[_0xe46850(0x2ae)](_0x4ab98e)?_0x4ab98e:_0xe46850(0x2e0);_0x58b978={[_0x57b7eb]:_0x2b9468},console['log'](_0xe46850(0x291)+_0x57b7eb+_0xe46850(0x358)+_0x2b9468+'\x20order');}}const [_0x138155,_0x5707b7]=await Promise[_0xe46850(0x2f6)]([database_1['default'][_0xe46850(0x368)][_0xe46850(0x263)]({'where':_0x8e418c,'skip':_0x10af3e,'take':_0x3f2031,'orderBy':_0x58b978,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0xe46850(0x228)]['payment'][_0xe46850(0x21c)]({'where':_0x8e418c})]);let _0x10d3cd,_0x24d2c5;if(_0x4b13c0){const _0x25dae3=new Date(_0x4b13c0);_0x10d3cd=new Date(Date[_0xe46850(0x2b1)](_0x25dae3[_0xe46850(0x2dd)](),_0x25dae3[_0xe46850(0x292)](),_0x25dae3[_0xe46850(0x1bc)](),0x0,0x0,0x0,0x0));}else{const _0x137b77=new Date();_0x10d3cd=new Date(Date[_0xe46850(0x2b1)](_0x137b77[_0xe46850(0x2dd)](),_0x137b77[_0xe46850(0x292)](),_0x137b77[_0xe46850(0x1bc)](),0x0,0x0,0x0,0x0));}if(_0x22b6f6){const _0x38c90a=new Date(_0x22b6f6);_0x24d2c5=new Date(Date[_0xe46850(0x2b1)](_0x38c90a['getUTCFullYear'](),_0x38c90a[_0xe46850(0x292)](),_0x38c90a[_0xe46850(0x1bc)](),0x17,0x3b,0x3b,0x3e7));}else{if(_0x4b13c0){const _0x1ecc44=new Date(_0x4b13c0);_0x24d2c5=new Date(Date['UTC'](_0x1ecc44['getUTCFullYear'](),_0x1ecc44[_0xe46850(0x292)](),_0x1ecc44[_0xe46850(0x1bc)](),0x17,0x3b,0x3b,0x3e7));}else{const _0x13cad1=new Date();_0x24d2c5=new Date(Date[_0xe46850(0x2b1)](_0x13cad1[_0xe46850(0x2dd)](),_0x13cad1[_0xe46850(0x292)](),_0x13cad1[_0xe46850(0x1bc)](),0x17,0x3b,0x3b,0x3e7));}}const _0x15ba75={};{const _0x4911b2={'status':_0x3bd529?_0x3bd529[_0xe46850(0x273)]():_0xe46850(0x26e),'createdAt':{'gte':_0x10d3cd,'lte':_0x24d2c5}};_0x44b693?_0x4911b2[_0xe46850(0x21b)]=_0x8e418c['gateway']:_0x4911b2[_0xe46850(0x21b)]={'not':_0xe46850(0x1c8)};_0x1791bd&&(_0x4911b2[_0xe46850(0x1f8)]=_0x1791bd);_0x444fa8&&(_0x4911b2['currency']=_0x444fa8[_0xe46850(0x273)]());console[_0xe46850(0x250)]('üìä\x20Statistics\x20WHERE\x20conditions:',JSON[_0xe46850(0x25d)](_0x4911b2,null,0x2));const _0x3f29f0=await database_1[_0xe46850(0x228)]['payment'][_0xe46850(0x263)]({'where':_0x4911b2,'select':{'amountUSDT':!![],'currency':!![],'amount':!![]}});let _0x3ae08c=0x0;_0x3f29f0[_0xe46850(0x36c)](_0x1a23b8=>{const _0x538afe=_0xe46850;_0x1a23b8['amountUSDT']&&(_0x3ae08c+=_0x1a23b8[_0x538afe(0x28c)]);if(_0x1a23b8[_0x538afe(0x372)]){const _0x3e8d8b=_0x1a23b8[_0x538afe(0x372)][_0x538afe(0x273)]();!_0x15ba75[_0x3e8d8b]&&(_0x15ba75[_0x3e8d8b]=0x0),_0x15ba75[_0x3e8d8b]+=_0x1a23b8[_0x538afe(0x248)];}}),_0x3ae08c>0x0&&(_0x15ba75[_0xe46850(0x2ed)]=_0x3ae08c);}return{'payments':_0x138155,'pagination':{'page':_0x18d51f,'limit':_0x3f2031,'total':_0x5707b7,'totalPages':Math[_0xe46850(0x270)](_0x5707b7/_0x3f2031)},'statistics':_0x15ba75};}async['getPaymentById'](_0x281975){const _0x2a9bd5=a53_0x2876e2,_0x5c41c0=await database_1[_0x2a9bd5(0x228)][_0x2a9bd5(0x368)]['findUnique']({'where':{'id':_0x281975},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x5c41c0)return null;return{'id':_0x5c41c0['id'],'shopId':_0x5c41c0['shopId'],'gateway':_0x5c41c0['gateway'],'amount':_0x5c41c0['amount'],'currency':_0x5c41c0[_0x2a9bd5(0x372)],'status':_0x5c41c0[_0x2a9bd5(0x2be)],'orderId':_0x5c41c0[_0x2a9bd5(0x2bc)],'gatewayOrderId':_0x5c41c0['gatewayOrderId'],'customerEmail':_0x5c41c0[_0x2a9bd5(0x2ba)],'customerName':_0x5c41c0[_0x2a9bd5(0x253)],'customerCountry':_0x5c41c0[_0x2a9bd5(0x1a9)],'customerIp':_0x5c41c0[_0x2a9bd5(0x211)],'customerUa':_0x5c41c0[_0x2a9bd5(0x286)],'failureMessage':_0x5c41c0[_0x2a9bd5(0x1fc)],'externalPaymentUrl':_0x5c41c0['externalPaymentUrl'],'successUrl':_0x5c41c0[_0x2a9bd5(0x34d)],'failUrl':_0x5c41c0[_0x2a9bd5(0x374)],'pendingUrl':_0x5c41c0['pendingUrl'],'whiteUrl':_0x5c41c0[_0x2a9bd5(0x297)],'createdAt':_0x5c41c0['createdAt'],'updatedAt':_0x5c41c0[_0x2a9bd5(0x24b)],'shop':_0x5c41c0['shop']};}async[a53_0x2876e2(0x1ab)](_0x331dee,_0x3bcbe7,_0x4caebc,_0x10613a){const _0x46107f=a53_0x2876e2,_0xbf6e8f=await database_1[_0x46107f(0x228)][_0x46107f(0x2f4)](async _0x5cfc4d=>{const _0x22338d=_0x46107f,_0x58b1e7=await _0x5cfc4d[_0x22338d(0x368)]['findUnique']({'where':{'id':_0x331dee},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x58b1e7)throw new Error('Payment\x20not\x20found');const _0x24ae3f=_0x58b1e7['status'],_0x5ee3e8=_0x3bcbe7['toUpperCase']();console[_0x22338d(0x250)](_0x22338d(0x1a8)+_0x331dee+_0x22338d(0x225)+_0x24ae3f+_0x22338d(0x1af)+_0x5ee3e8),console[_0x22338d(0x250)]('üí∞\x20Current\x20shop\x20balance:\x20'+_0x58b1e7[_0x22338d(0x364)][_0x22338d(0x348)]+_0x22338d(0x2ea));const _0x594864={'status':_0x5ee3e8,'updatedAt':new Date(),'statusChangedBy':_0x22338d(0x257),'statusChangedAt':new Date()};_0x4caebc&&(_0x594864[_0x22338d(0x2ef)]=_0x4caebc);_0x5ee3e8===_0x22338d(0x238)&&_0x10613a&&(_0x594864['chargebackAmount']=_0x10613a);let _0x265f55=0x0,_0x21103a=_0x58b1e7[_0x22338d(0x364)][_0x22338d(0x348)];if(_0x5ee3e8===_0x22338d(0x26e)&&_0x24ae3f!==_0x22338d(0x26e)){_0x594864['paidAt']=new Date();const _0x123cf6=await currencyService_1[_0x22338d(0x302)][_0x22338d(0x2c1)](_0x58b1e7['amount'],_0x58b1e7[_0x22338d(0x372)]);_0x594864[_0x22338d(0x28c)]=_0x123cf6;let _0x30ee84=0x2d;const _0x137003=await _0x5cfc4d[_0x22338d(0x364)]['findUnique']({'where':{'id':_0x58b1e7['shopId']},'select':{'gatewaySettings':!![]}});if(_0x137003?.['gatewaySettings'])try{const _0x5d0cb5=JSON[_0x22338d(0x329)](_0x137003[_0x22338d(0x2e8)]);for(const [_0x3f22c3,_0x176302]of Object[_0x22338d(0x317)](_0x5d0cb5)){if(_0x3f22c3[_0x22338d(0x2d7)]()===_0x58b1e7['gateway'][_0x22338d(0x2d7)]()){_0x30ee84=_0x176302[_0x22338d(0x1c9)]||0xa;break;}}}catch(_0x597745){console[_0x22338d(0x31a)](_0x22338d(0x1b6)+_0x331dee+':',_0x597745);}let _0x147e51;_0x58b1e7[_0x22338d(0x2cd)]!==null&&_0x58b1e7[_0x22338d(0x2cd)]!==undefined?(_0x147e51=_0x58b1e7[_0x22338d(0x2cd)],console[_0x22338d(0x250)](_0x22338d(0x29e)+_0x147e51[_0x22338d(0x293)](0x6)+_0x22338d(0x1a5)+_0x331dee)):(_0x147e51=_0x123cf6*(0x1-_0x30ee84/0x64),console[_0x22338d(0x250)](_0x22338d(0x2b2)+_0x331dee+':\x20'+_0x30ee84+_0x22338d(0x28a)+_0x123cf6['toFixed'](0x6)+_0x22338d(0x2ea)),_0x594864[_0x22338d(0x2cd)]=_0x147e51,_0x594864['gatewayCommissionRate']=_0x30ee84),_0x265f55=_0x147e51,_0x21103a+=_0x147e51,console[_0x22338d(0x250)](_0x22338d(0x373)+_0x331dee+_0x22338d(0x1d2)),console[_0x22338d(0x250)](_0x22338d(0x37f)+_0x123cf6['toFixed'](0x6)+_0x22338d(0x2ea)),console[_0x22338d(0x250)](_0x22338d(0x1aa)+_0x58b1e7[_0x22338d(0x21b)]+',\x20Commission:\x20'+_0x30ee84+'%'),console['log'](_0x22338d(0x2bd)+_0x147e51['toFixed'](0x6)+_0x22338d(0x1e1)+_0x30ee84+_0x22338d(0x318)),console[_0x22338d(0x250)](_0x22338d(0x363)+_0x147e51['toFixed'](0x6)+'\x20USDT');}else{if(_0x24ae3f===_0x22338d(0x26e)&&_0x5ee3e8!==_0x22338d(0x26e)&&_0x5ee3e8!==_0x22338d(0x238)){if(_0x58b1e7['amountUSDT']){let _0x2dd71a=0x2d;const _0x5dc00a=await _0x5cfc4d[_0x22338d(0x364)]['findUnique']({'where':{'id':_0x58b1e7[_0x22338d(0x1f8)]},'select':{'gatewaySettings':!![]}});if(_0x5dc00a?.[_0x22338d(0x2e8)])try{const _0x401eab=JSON[_0x22338d(0x329)](_0x5dc00a[_0x22338d(0x2e8)]);for(const [_0x23b61b,_0x215bed]of Object['entries'](_0x401eab)){if(_0x23b61b[_0x22338d(0x2d7)]()===_0x58b1e7[_0x22338d(0x21b)][_0x22338d(0x2d7)]()){_0x2dd71a=_0x215bed[_0x22338d(0x1c9)]||0xa;break;}}}catch(_0x35db58){console[_0x22338d(0x31a)](_0x22338d(0x1b6)+_0x331dee+':',_0x35db58);}const _0x21baba=_0x58b1e7[_0x22338d(0x28c)]*(0x1-_0x2dd71a/0x64);_0x265f55=-_0x21baba,_0x21103a-=_0x21baba,console[_0x22338d(0x250)](_0x22338d(0x37f)+_0x58b1e7['amountUSDT'][_0x22338d(0x293)](0x6)+_0x22338d(0x2ea)),console[_0x22338d(0x250)](_0x22338d(0x1aa)+_0x58b1e7[_0x22338d(0x21b)]+',\x20Commission:\x20'+_0x2dd71a+'%'),console[_0x22338d(0x250)]('\x20\x20\x20Merchant\x20loses:\x20'+_0x21baba[_0x22338d(0x293)](0x6)+_0x22338d(0x1e1)+_0x2dd71a+_0x22338d(0x318)),console[_0x22338d(0x250)](_0x22338d(0x32b)+_0x21baba['toFixed'](0x6)+_0x22338d(0x2ea));}}}_0x5ee3e8===_0x22338d(0x238)&&(console[_0x22338d(0x250)](_0x22338d(0x323)),_0x10613a&&_0x10613a>0x0?(_0x265f55=-_0x10613a,_0x21103a-=_0x10613a,console[_0x22338d(0x250)](_0x22338d(0x1c3)+_0x10613a[_0x22338d(0x293)](0x6)+'\x20USDT\x20from\x20balance'),console[_0x22338d(0x250)](_0x22338d(0x2dc))):console[_0x22338d(0x250)](_0x22338d(0x2ce)),_0x594864[_0x22338d(0x1ea)]=_0x10613a||0x0);_0x5ee3e8===_0x22338d(0x22e)&&_0x24ae3f==='PAID'&&console[_0x22338d(0x250)](_0x22338d(0x25e));const _0xbee871=await _0x5cfc4d[_0x22338d(0x368)][_0x22338d(0x2da)]({'where':{'id':_0x331dee},'data':_0x594864,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x265f55!==0x0&&(await _0x5cfc4d[_0x22338d(0x364)][_0x22338d(0x2da)]({'where':{'id':_0x58b1e7[_0x22338d(0x1f8)]},'data':{'balance':_0x21103a}}),console[_0x22338d(0x250)]('üí∞\x20Shop\x20'+_0x58b1e7['shopId']+_0x22338d(0x2a0)+_0x58b1e7[_0x22338d(0x364)][_0x22338d(0x348)][_0x22338d(0x293)](0x6)+_0x22338d(0x1af)+_0x21103a[_0x22338d(0x293)](0x6)+_0x22338d(0x2c3)+(_0x265f55>0x0?'+':'')+_0x265f55[_0x22338d(0x293)](0x6)+')')),_0xbee871;});return{'id':_0xbf6e8f['id'],'shopId':_0xbf6e8f[_0x46107f(0x1f8)],'gateway':_0xbf6e8f['gateway'],'amount':_0xbf6e8f[_0x46107f(0x248)],'currency':_0xbf6e8f[_0x46107f(0x372)],'status':_0xbf6e8f[_0x46107f(0x2be)],'orderId':_0xbf6e8f['orderId'],'gatewayOrderId':_0xbf6e8f[_0x46107f(0x2c7)],'customerEmail':_0xbf6e8f[_0x46107f(0x2ba)],'customerName':_0xbf6e8f['customerName'],'customerCountry':_0xbf6e8f[_0x46107f(0x1a9)],'customerIp':_0xbf6e8f['customerIp'],'customerUa':_0xbf6e8f[_0x46107f(0x286)],'failureMessage':_0xbf6e8f[_0x46107f(0x1fc)],'adminNotes':_0xbf6e8f[_0x46107f(0x2ef)],'chargebackAmount':_0xbf6e8f[_0x46107f(0x1ea)],'statusChangedBy':_0xbf6e8f[_0x46107f(0x1e9)],'statusChangedAt':_0xbf6e8f['statusChangedAt'],'createdAt':_0xbf6e8f[_0x46107f(0x301)],'updatedAt':_0xbf6e8f[_0x46107f(0x24b)],'shop':_0xbf6e8f[_0x46107f(0x364)]};}async[a53_0x2876e2(0x356)](_0x592c10,_0x481f2e){const _0x12fa02=a53_0x2876e2,_0x105760=Math[_0x12fa02(0x338)]()[_0x12fa02(0x2f7)](0x24)[_0x12fa02(0x240)](0x2,0x9);console[_0x12fa02(0x250)](_0x12fa02(0x2d9)+_0x105760+',\x20userId:\x20'+_0x592c10);const _0x1ea6bf={..._0x481f2e};_0x481f2e[_0x12fa02(0x322)]&&_0x481f2e[_0x12fa02(0x322)][_0x12fa02(0x34f)]()!==''?(console[_0x12fa02(0x250)](_0x12fa02(0x31d)+_0x105760+_0x12fa02(0x382)+_0x592c10),_0x1ea6bf[_0x12fa02(0x322)]=await bcryptjs_1['default'][_0x12fa02(0x34b)](_0x481f2e[_0x12fa02(0x322)],0xc)):(console['log'](_0x12fa02(0x31d)+_0x105760+']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update'),delete _0x1ea6bf['password']);_0x481f2e[_0x12fa02(0x2eb)]&&(_0x1ea6bf[_0x12fa02(0x2df)]=_0x481f2e[_0x12fa02(0x2eb)],delete _0x1ea6bf[_0x12fa02(0x2eb)]);_0x481f2e['telegramId']&&(_0x1ea6bf[_0x12fa02(0x311)]=_0x481f2e[_0x12fa02(0x1fe)],delete _0x1ea6bf[_0x12fa02(0x1fe)]);_0x481f2e[_0x12fa02(0x26c)]!==undefined&&(_0x1ea6bf[_0x12fa02(0x259)]=_0x481f2e['merchantUrl']||null,delete _0x1ea6bf['merchantUrl']);_0x481f2e['merchantUrl2']!==undefined&&(_0x1ea6bf[_0x12fa02(0x224)]=_0x481f2e[_0x12fa02(0x303)]||null,delete _0x1ea6bf['merchantUrl2']);_0x481f2e[_0x12fa02(0x1df)]!==undefined&&(_0x1ea6bf[_0x12fa02(0x28d)]=_0x481f2e['merchantUrl3']||null,delete _0x1ea6bf[_0x12fa02(0x1df)]);_0x481f2e[_0x12fa02(0x249)]!==undefined&&(_0x1ea6bf[_0x12fa02(0x274)]=_0x481f2e[_0x12fa02(0x249)]||null,delete _0x1ea6bf[_0x12fa02(0x249)]);if(_0x481f2e[_0x12fa02(0x1be)]){const _0x2892ab=_0x481f2e[_0x12fa02(0x1be)][_0x12fa02(0x1c6)](_0x3fa011=>this[_0x12fa02(0x203)](_0x3fa011));console['log'](_0x12fa02(0x212),_0x481f2e[_0x12fa02(0x1be)],'->',_0x2892ab),_0x1ea6bf[_0x12fa02(0x352)]=JSON[_0x12fa02(0x25d)](_0x2892ab),delete _0x1ea6bf[_0x12fa02(0x1be)];}_0x481f2e[_0x12fa02(0x2e8)]&&(console[_0x12fa02(0x250)]('üîß\x20['+_0x105760+_0x12fa02(0x1f1),_0x481f2e[_0x12fa02(0x2e8)]),_0x1ea6bf[_0x12fa02(0x2e8)]=JSON[_0x12fa02(0x25d)](_0x481f2e[_0x12fa02(0x2e8)]),console[_0x12fa02(0x250)](_0x12fa02(0x1d3)+_0x105760+']\x20Gateway\x20settings\x20JSON\x20string:',_0x1ea6bf['gatewaySettings']));_0x481f2e[_0x12fa02(0x307)]&&(_0x481f2e[_0x12fa02(0x307)][_0x12fa02(0x384)]!==undefined&&(_0x1ea6bf[_0x12fa02(0x384)]=_0x481f2e[_0x12fa02(0x307)][_0x12fa02(0x384)]||null),_0x481f2e['wallets'][_0x12fa02(0x21d)]!==undefined&&(_0x1ea6bf['usdtTrcWallet']=_0x481f2e[_0x12fa02(0x307)][_0x12fa02(0x21d)]||null),_0x481f2e['wallets'][_0x12fa02(0x306)]!==undefined&&(_0x1ea6bf[_0x12fa02(0x306)]=_0x481f2e['wallets'][_0x12fa02(0x306)]||null),_0x481f2e[_0x12fa02(0x307)][_0x12fa02(0x2aa)]!==undefined&&(_0x1ea6bf['usdcPolygonWallet']=_0x481f2e['wallets'][_0x12fa02(0x2aa)]||null),delete _0x1ea6bf[_0x12fa02(0x307)]);const _0x2b1046=await database_1['default'][_0x12fa02(0x364)][_0x12fa02(0x2da)]({'where':{'id':_0x592c10},'data':_0x1ea6bf,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'shopUrl2':!![],'shopUrl3':!![],'shopUrl4':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0x12fa02(0x250)](_0x12fa02(0x29b)+_0x105760+_0x12fa02(0x23b),_0x2b1046[_0x12fa02(0x2e8)]),{'id':_0x2b1046['id'],'fullName':_0x2b1046['name'],'username':_0x2b1046['username'],'telegramId':_0x2b1046[_0x12fa02(0x311)],'merchantUrl':_0x2b1046[_0x12fa02(0x259)],'merchantUrl2':_0x2b1046[_0x12fa02(0x224)],'merchantUrl3':_0x2b1046[_0x12fa02(0x28d)],'merchantUrl4':_0x2b1046[_0x12fa02(0x274)],'gateways':_0x2b1046[_0x12fa02(0x352)]?JSON[_0x12fa02(0x329)](_0x2b1046[_0x12fa02(0x352)]):null,'gatewaySettings':_0x2b1046[_0x12fa02(0x2e8)]?JSON[_0x12fa02(0x329)](_0x2b1046['gatewaySettings']):null,'publicKey':_0x2b1046[_0x12fa02(0x260)],'wallets':{'usdtPolygonWallet':_0x2b1046[_0x12fa02(0x384)],'usdtTrcWallet':_0x2b1046['usdtTrcWallet'],'usdtErcWallet':_0x2b1046[_0x12fa02(0x306)],'usdcPolygonWallet':_0x2b1046[_0x12fa02(0x2aa)]},'status':_0x2b1046[_0x12fa02(0x2be)],'createdAt':_0x2b1046['createdAt']};}async['suspendUser'](_0x5e3e73){const _0x29ab1e=a53_0x2876e2,_0xda17b8=await database_1[_0x29ab1e(0x228)][_0x29ab1e(0x364)]['update']({'where':{'id':_0x5e3e73},'data':{'status':'SUSPENDED'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'shopUrl2':!![],'shopUrl3':!![],'shopUrl4':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0xda17b8['id'],'fullName':_0xda17b8[_0x29ab1e(0x2df)],'username':_0xda17b8[_0x29ab1e(0x23e)],'telegramId':_0xda17b8[_0x29ab1e(0x311)],'merchantUrl':_0xda17b8[_0x29ab1e(0x259)],'merchantUrl2':_0xda17b8[_0x29ab1e(0x224)],'merchantUrl3':_0xda17b8['shopUrl3'],'merchantUrl4':_0xda17b8[_0x29ab1e(0x274)],'gateways':_0xda17b8['paymentGateways']?JSON[_0x29ab1e(0x329)](_0xda17b8['paymentGateways']):null,'gatewaySettings':_0xda17b8[_0x29ab1e(0x2e8)]?JSON[_0x29ab1e(0x329)](_0xda17b8[_0x29ab1e(0x2e8)]):null,'publicKey':_0xda17b8[_0x29ab1e(0x260)],'wallets':{'usdtPolygonWallet':_0xda17b8[_0x29ab1e(0x384)],'usdtTrcWallet':_0xda17b8['usdtTrcWallet'],'usdtErcWallet':_0xda17b8['usdtErcWallet'],'usdcPolygonWallet':_0xda17b8[_0x29ab1e(0x2aa)]},'status':_0xda17b8['status'],'createdAt':_0xda17b8['createdAt']};}async[a53_0x2876e2(0x309)](_0x180977){const _0x579693=a53_0x2876e2,_0x4337d0=await database_1[_0x579693(0x228)]['shop'][_0x579693(0x2da)]({'where':{'id':_0x180977},'data':{'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'shopUrl2':!![],'shopUrl3':!![],'shopUrl4':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4337d0['id'],'fullName':_0x4337d0['name'],'username':_0x4337d0[_0x579693(0x23e)],'telegramId':_0x4337d0[_0x579693(0x311)],'merchantUrl':_0x4337d0[_0x579693(0x259)],'merchantUrl2':_0x4337d0[_0x579693(0x224)],'merchantUrl3':_0x4337d0[_0x579693(0x28d)],'merchantUrl4':_0x4337d0[_0x579693(0x274)],'gateways':_0x4337d0[_0x579693(0x352)]?JSON[_0x579693(0x329)](_0x4337d0[_0x579693(0x352)]):null,'gatewaySettings':_0x4337d0['gatewaySettings']?JSON[_0x579693(0x329)](_0x4337d0[_0x579693(0x2e8)]):null,'publicKey':_0x4337d0[_0x579693(0x260)],'wallets':{'usdtPolygonWallet':_0x4337d0['usdtPolygonWallet'],'usdtTrcWallet':_0x4337d0[_0x579693(0x21d)],'usdtErcWallet':_0x4337d0[_0x579693(0x306)],'usdcPolygonWallet':_0x4337d0['usdcPolygonWallet']},'status':_0x4337d0[_0x579693(0x2be)],'createdAt':_0x4337d0[_0x579693(0x301)]};}async[a53_0x2876e2(0x2b8)](_0x519d20){const _0x91014e=a53_0x2876e2,{page:_0x51fc76,limit:_0x2a4f73,status:_0x40ee82,search:_0x4a993a}=_0x519d20,_0x3d042c=(_0x51fc76-0x1)*_0x2a4f73,_0x5a9fb8={};_0x40ee82&&(_0x5a9fb8[_0x91014e(0x2be)]=_0x40ee82[_0x91014e(0x273)]());_0x4a993a&&(_0x5a9fb8['OR']=[{'name':{'contains':_0x4a993a,'mode':_0x91014e(0x269)}},{'username':{'contains':_0x4a993a,'mode':_0x91014e(0x269)}},{'telegram':{'contains':_0x4a993a,'mode':_0x91014e(0x269)}},{'shopUrl':{'contains':_0x4a993a,'mode':_0x91014e(0x269)}}]);const [_0x46ecb7,_0x4ab0d0]=await Promise[_0x91014e(0x2f6)]([database_1[_0x91014e(0x228)][_0x91014e(0x364)][_0x91014e(0x263)]({'where':_0x5a9fb8,'skip':_0x3d042c,'take':_0x2a4f73,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'shopUrl2':!![],'shopUrl3':!![],'shopUrl4':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'twoFactorEnabled':!![],'createdAt':!![],'lastLoginAt':!![],'_count':{'select':{'telegramUsers':!![]}}}}),database_1[_0x91014e(0x228)][_0x91014e(0x364)][_0x91014e(0x21c)]({'where':_0x5a9fb8})]);return{'users':_0x46ecb7['map'](_0x21e126=>{const _0x4df6a5=_0x91014e,_0xeb442f=_0x21e126[_0x4df6a5(0x352)]?JSON[_0x4df6a5(0x329)](_0x21e126['paymentGateways']):null,_0x49d375=_0xeb442f?_0xeb442f[_0x4df6a5(0x1c6)](_0x58bf66=>this[_0x4df6a5(0x27c)](_0x58bf66)):null;return{'id':_0x21e126['id'],'fullName':_0x21e126[_0x4df6a5(0x2df)],'username':_0x21e126[_0x4df6a5(0x23e)],'telegramId':_0x21e126['telegram'],'merchantUrl':_0x21e126[_0x4df6a5(0x259)],'merchantUrl2':_0x21e126[_0x4df6a5(0x224)],'merchantUrl3':_0x21e126['shopUrl3'],'merchantUrl4':_0x21e126[_0x4df6a5(0x274)],'gateways':_0x49d375,'gatewaySettings':_0x21e126[_0x4df6a5(0x2e8)]?JSON[_0x4df6a5(0x329)](_0x21e126[_0x4df6a5(0x2e8)]):null,'publicKey':_0x21e126[_0x4df6a5(0x260)],'wallets':{'usdtPolygonWallet':_0x21e126[_0x4df6a5(0x384)],'usdtTrcWallet':_0x21e126['usdtTrcWallet'],'usdtErcWallet':_0x21e126[_0x4df6a5(0x306)],'usdcPolygonWallet':_0x21e126[_0x4df6a5(0x2aa)],'usdcErcWallet':_0x21e126[_0x4df6a5(0x1a2)]},'status':_0x21e126[_0x4df6a5(0x2be)],'twoFactorEnabled':_0x21e126[_0x4df6a5(0x378)]||![],'telegramUsersCount':_0x21e126[_0x4df6a5(0x328)]['telegramUsers'],'createdAt':_0x21e126[_0x4df6a5(0x301)],'lastLoginAt':_0x21e126[_0x4df6a5(0x1bf)]};}),'pagination':{'page':_0x51fc76,'limit':_0x2a4f73,'total':_0x4ab0d0,'totalPages':Math['ceil'](_0x4ab0d0/_0x2a4f73)}};}async['getUserById'](_0x43b8d9){const _0x5d8b24=a53_0x2876e2,_0x3427e8=await database_1[_0x5d8b24(0x228)][_0x5d8b24(0x364)][_0x5d8b24(0x254)]({'where':{'id':_0x43b8d9},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'shopUrl2':!![],'shopUrl3':!![],'shopUrl4':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x3427e8)return null;const _0x114efe=_0x3427e8[_0x5d8b24(0x352)]?JSON[_0x5d8b24(0x329)](_0x3427e8['paymentGateways']):null,_0x19f5d4=_0x114efe?_0x114efe[_0x5d8b24(0x1c6)](_0x3e8693=>this[_0x5d8b24(0x27c)](_0x3e8693)):null;return _0x114efe&&_0x19f5d4&&console[_0x5d8b24(0x250)](_0x5d8b24(0x215),_0x114efe,'->',_0x19f5d4),{'id':_0x3427e8['id'],'fullName':_0x3427e8[_0x5d8b24(0x2df)],'username':_0x3427e8[_0x5d8b24(0x23e)],'telegramId':_0x3427e8[_0x5d8b24(0x311)],'merchantUrl':_0x3427e8[_0x5d8b24(0x259)],'merchantUrl2':_0x3427e8[_0x5d8b24(0x224)],'merchantUrl3':_0x3427e8['shopUrl3'],'merchantUrl4':_0x3427e8['shopUrl4'],'gateways':_0x19f5d4,'gatewaySettings':_0x3427e8['gatewaySettings']?JSON['parse'](_0x3427e8[_0x5d8b24(0x2e8)]):null,'publicKey':_0x3427e8[_0x5d8b24(0x260)],'wallets':{'usdtPolygonWallet':_0x3427e8[_0x5d8b24(0x384)],'usdtTrcWallet':_0x3427e8['usdtTrcWallet'],'usdtErcWallet':_0x3427e8[_0x5d8b24(0x306)],'usdcPolygonWallet':_0x3427e8[_0x5d8b24(0x2aa)],'usdcErcWallet':_0x3427e8[_0x5d8b24(0x1a2)]},'status':_0x3427e8[_0x5d8b24(0x2be)],'createdAt':_0x3427e8[_0x5d8b24(0x301)]};}async['createUser'](_0x3d948f){const _0x173b04=a53_0x2876e2,{fullName:_0x264449,username:_0x3c28c6,password:_0x228ab8,telegramId:_0x3e57ad,merchantUrl:_0x6e5ca7,gateways:_0x5310eb,gatewaySettings:_0x5b9af5,wallets:_0x1b577e}=_0x3d948f,_0x1451bd=await database_1[_0x173b04(0x228)][_0x173b04(0x364)][_0x173b04(0x254)]({'where':{'username':_0x3c28c6}});if(_0x1451bd)throw new Error(_0x173b04(0x2f9));if(_0x3e57ad){const _0x14e3a9=await database_1['default'][_0x173b04(0x364)]['findUnique']({'where':{'telegram':_0x3e57ad}});if(_0x14e3a9)throw new Error(_0x173b04(0x1cc));}const _0x13b52f=await bcryptjs_1['default'][_0x173b04(0x34b)](_0x228ab8,0xc),_0xef748a=_0x173b04(0x24e)+crypto_1['default'][_0x173b04(0x276)](0x20)[_0x173b04(0x2f7)](_0x173b04(0x221)),_0x555ec3=_0x173b04(0x2bf)+crypto_1[_0x173b04(0x228)][_0x173b04(0x276)](0x20)[_0x173b04(0x2f7)](_0x173b04(0x221)),_0x3373fd=_0x5310eb?_0x5310eb[_0x173b04(0x1c6)](_0x553ad1=>this[_0x173b04(0x203)](_0x553ad1)):null;_0x5310eb&&_0x3373fd&&console[_0x173b04(0x250)](_0x173b04(0x315),_0x5310eb,'->',_0x3373fd);const _0x2f3113=await database_1[_0x173b04(0x228)][_0x173b04(0x364)][_0x173b04(0x245)]({'data':{'name':_0x264449,'username':_0x3c28c6,'password':_0x13b52f,'telegram':_0x3e57ad,'shopUrl':_0x6e5ca7,'shopUrl2':_0x3d948f[_0x173b04(0x303)]||null,'shopUrl3':_0x3d948f[_0x173b04(0x1df)]||null,'shopUrl4':_0x3d948f[_0x173b04(0x249)]||null,'paymentGateways':_0x3373fd?JSON[_0x173b04(0x25d)](_0x3373fd):null,'gatewaySettings':_0x5b9af5?JSON[_0x173b04(0x25d)](_0x5b9af5):null,'usdtPolygonWallet':_0x1b577e?.[_0x173b04(0x384)]||null,'usdtTrcWallet':_0x1b577e?.[_0x173b04(0x21d)]||null,'usdtErcWallet':_0x1b577e?.['usdtErcWallet']||null,'usdcPolygonWallet':_0x1b577e?.[_0x173b04(0x2aa)]||null,'publicKey':_0xef748a,'secretKey':_0x555ec3,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'shopUrl2':!![],'shopUrl3':!![],'shopUrl4':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2f3113['id'],'fullName':_0x2f3113[_0x173b04(0x2df)],'username':_0x2f3113['username'],'telegramId':_0x2f3113['telegram'],'merchantUrl':_0x2f3113[_0x173b04(0x259)],'merchantUrl2':_0x2f3113[_0x173b04(0x224)],'merchantUrl3':_0x2f3113[_0x173b04(0x28d)],'merchantUrl4':_0x2f3113[_0x173b04(0x274)],'gateways':_0x2f3113[_0x173b04(0x352)]?JSON[_0x173b04(0x329)](_0x2f3113[_0x173b04(0x352)]):null,'gatewaySettings':_0x2f3113['gatewaySettings']?JSON[_0x173b04(0x329)](_0x2f3113[_0x173b04(0x2e8)]):null,'publicKey':_0x2f3113[_0x173b04(0x260)],'wallets':{'usdtPolygonWallet':_0x2f3113[_0x173b04(0x384)],'usdtTrcWallet':_0x2f3113[_0x173b04(0x21d)],'usdtErcWallet':_0x2f3113[_0x173b04(0x306)],'usdcPolygonWallet':_0x2f3113[_0x173b04(0x2aa)]},'status':_0x2f3113[_0x173b04(0x2be)],'createdAt':_0x2f3113[_0x173b04(0x301)]};}async['deleteUser'](_0x3f05dc,_0x5daa54){const _0x5e4018=a53_0x2876e2;if(config_1[_0x5e4018(0x1ee)][_0x5e4018(0x257)][_0x5e4018(0x378)]){if(!_0x5daa54)throw new Error(_0x5e4018(0x24f));const _0x21f965=speakeasy_1[_0x5e4018(0x228)][_0x5e4018(0x34a)][_0x5e4018(0x1cd)]({'secret':config_1[_0x5e4018(0x1ee)][_0x5e4018(0x257)]['twoFactorSecret'],'encoding':_0x5e4018(0x266),'token':_0x5daa54,'window':0x2});if(!_0x21f965){let _0x3792b9=![];if(config_1[_0x5e4018(0x1ee)][_0x5e4018(0x257)]['backupCodes']){const _0x3a6063=JSON[_0x5e4018(0x329)](config_1[_0x5e4018(0x1ee)]['admin'][_0x5e4018(0x343)]);for(let _0x34d921=0x0;_0x34d921<_0x3a6063[_0x5e4018(0x1c5)];_0x34d921++){const _0x54b21f=await bcryptjs_1[_0x5e4018(0x228)]['compare'](_0x5daa54,_0x3a6063[_0x34d921]);if(_0x54b21f){_0x3792b9=!![],_0x3a6063[_0x5e4018(0x1e2)](_0x34d921,0x1),config_1[_0x5e4018(0x1ee)]['admin'][_0x5e4018(0x343)]=JSON['stringify'](_0x3a6063);const _0x32a170=path_1[_0x5e4018(0x228)]['join'](process['cwd'](),_0x5e4018(0x1c4));if(fs_1['default'][_0x5e4018(0x33c)](_0x32a170)){let _0x28cba5=fs_1[_0x5e4018(0x228)][_0x5e4018(0x36f)](_0x32a170,_0x5e4018(0x326));const _0x3fc6b9=_0x28cba5[_0x5e4018(0x1db)]('\x0a');for(let _0x439d6a=0x0;_0x439d6a<_0x3fc6b9[_0x5e4018(0x1c5)];_0x439d6a++){if(_0x3fc6b9[_0x439d6a][_0x5e4018(0x1bb)]('ADMIN_BACKUP_CODES=')){_0x3fc6b9[_0x439d6a]=_0x5e4018(0x31c)+JSON[_0x5e4018(0x25d)](_0x3a6063);break;}}fs_1[_0x5e4018(0x228)][_0x5e4018(0x370)](_0x32a170,_0x3fc6b9[_0x5e4018(0x34e)]('\x0a'),_0x5e4018(0x326));}break;}}}if(!_0x3792b9)throw new Error(_0x5e4018(0x2f8));}}await database_1['default'][_0x5e4018(0x364)][_0x5e4018(0x335)]({'where':{'id':_0x3f05dc}});}async[a53_0x2876e2(0x2c6)](_0x14c50e){const _0x2aeea9=a53_0x2876e2,_0x8efc80=await database_1[_0x2aeea9(0x228)]['shop']['findUnique']({'where':{'id':_0x14c50e},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});if(!_0x8efc80)throw new Error('Shop\x20not\x20found');return{'usdtPolygonWallet':_0x8efc80['usdtPolygonWallet'],'usdtTrcWallet':_0x8efc80[_0x2aeea9(0x21d)],'usdtErcWallet':_0x8efc80['usdtErcWallet'],'usdcPolygonWallet':_0x8efc80['usdcPolygonWallet'],'usdcErcWallet':_0x8efc80[_0x2aeea9(0x1a2)]};}[a53_0x2876e2(0x272)](_0x425514=0x8){const _0x4499e2=a53_0x2876e2,_0x19eed8=[];for(let _0x2868f1=0x0;_0x2868f1<_0x425514;_0x2868f1++){const _0x36ef36=crypto_1[_0x4499e2(0x228)][_0x4499e2(0x276)](0x4)[_0x4499e2(0x2f7)](_0x4499e2(0x221))[_0x4499e2(0x273)]();_0x19eed8['push'](_0x36ef36);}return _0x19eed8;}async[a53_0x2876e2(0x32d)](_0x517eb6){const _0x59f7f9=a53_0x2876e2,_0x1df279=await database_1['default'][_0x59f7f9(0x364)][_0x59f7f9(0x254)]({'where':{'id':_0x517eb6},'select':{'id':!![],'name':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x1df279)throw new Error('Shop\x20not\x20found');const _0x27fad3=speakeasy_1[_0x59f7f9(0x228)][_0x59f7f9(0x2f1)]({'name':_0x59f7f9(0x20b)+_0x1df279[_0x59f7f9(0x23e)]+')','issuer':_0x59f7f9(0x2ff),'length':0x20}),_0x4c86c1=await qrcode_1[_0x59f7f9(0x228)]['toDataURL'](_0x27fad3['otpauth_url']),_0x57e4ae=this[_0x59f7f9(0x272)](0x8),_0x43462e=await Promise[_0x59f7f9(0x2f6)](_0x57e4ae['map'](_0x2806ee=>bcryptjs_1[_0x59f7f9(0x228)][_0x59f7f9(0x34b)](_0x2806ee,0xa)));return await database_1[_0x59f7f9(0x228)][_0x59f7f9(0x364)][_0x59f7f9(0x2da)]({'where':{'id':_0x517eb6},'data':{'twoFactorSecret':_0x27fad3[_0x59f7f9(0x266)],'backupCodes':JSON[_0x59f7f9(0x25d)](_0x43462e)}}),console[_0x59f7f9(0x250)](_0x59f7f9(0x26b)+_0x1df279[_0x59f7f9(0x23e)]),console[_0x59f7f9(0x250)](_0x59f7f9(0x1b0)+_0x57e4ae[_0x59f7f9(0x1c5)]+'\x20backup\x20codes'),{'secret':_0x27fad3[_0x59f7f9(0x266)],'qrCode':_0x4c86c1,'manualEntryKey':_0x27fad3[_0x59f7f9(0x266)],'backupCodes':_0x57e4ae};}async[a53_0x2876e2(0x30c)](_0x2a0ec3,_0x52b959){const _0x196547=a53_0x2876e2,_0x5cb27e=await database_1[_0x196547(0x228)][_0x196547(0x364)][_0x196547(0x254)]({'where':{'id':_0x2a0ec3},'select':{'id':!![],'username':!![],'twoFactorSecret':!![],'twoFactorEnabled':!![]}});if(!_0x5cb27e)throw new Error(_0x196547(0x282));if(!_0x5cb27e[_0x196547(0x23d)])throw new Error(_0x196547(0x316));if(_0x5cb27e['twoFactorEnabled'])throw new Error(_0x196547(0x283));const _0x562928=speakeasy_1[_0x196547(0x228)][_0x196547(0x34a)][_0x196547(0x1cd)]({'secret':_0x5cb27e['twoFactorSecret'],'encoding':'base32','token':_0x52b959,'window':0x2});if(!_0x562928)throw new Error(_0x196547(0x2af));return await database_1['default'][_0x196547(0x364)][_0x196547(0x2da)]({'where':{'id':_0x2a0ec3},'data':{'twoFactorEnabled':!![]}}),console[_0x196547(0x250)]('üîê\x202FA\x20enabled\x20for\x20shop:\x20'+_0x5cb27e[_0x196547(0x23e)]),{'enabled':!![]};}async[a53_0x2876e2(0x217)](_0x2e558c){const _0x30eaa6=a53_0x2876e2,_0xa770f8=await database_1[_0x30eaa6(0x228)][_0x30eaa6(0x364)]['findUnique']({'where':{'id':_0x2e558c},'select':{'id':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0xa770f8)throw new Error('Shop\x20not\x20found');await database_1['default'][_0x30eaa6(0x364)][_0x30eaa6(0x2da)]({'where':{'id':_0x2e558c},'data':{'twoFactorEnabled':![],'twoFactorSecret':null,'backupCodes':null}}),console['log'](_0x30eaa6(0x284)+_0xa770f8[_0x30eaa6(0x23e)]);}async[a53_0x2876e2(0x1b9)](_0x57afa0,_0x5635f9,_0x23c8e5,_0x4a0e8a){const _0x49cf29=a53_0x2876e2;if(_0x5635f9!==_0x23c8e5)throw new Error(_0x49cf29(0x232));if(_0x5635f9[_0x49cf29(0x1c5)]<0x6)throw new Error('New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long');const _0x3a720c=await bcryptjs_1[_0x49cf29(0x228)][_0x49cf29(0x30e)](_0x57afa0,config_1[_0x49cf29(0x1ee)][_0x49cf29(0x257)]['passwordHash']);if(!_0x3a720c)throw new Error(_0x49cf29(0x256));if(config_1['config'][_0x49cf29(0x257)][_0x49cf29(0x378)]){if(!_0x4a0e8a)throw new Error(_0x49cf29(0x24f));const _0x35cf4c=speakeasy_1[_0x49cf29(0x228)][_0x49cf29(0x34a)][_0x49cf29(0x1cd)]({'secret':config_1[_0x49cf29(0x1ee)]['admin'][_0x49cf29(0x23d)],'encoding':_0x49cf29(0x266),'token':_0x4a0e8a,'window':0x2});if(!_0x35cf4c){let _0x18ceeb=![];if(config_1[_0x49cf29(0x1ee)][_0x49cf29(0x257)][_0x49cf29(0x343)]){const _0x105b48=JSON['parse'](config_1[_0x49cf29(0x1ee)][_0x49cf29(0x257)][_0x49cf29(0x343)]);for(let _0x1e9bca=0x0;_0x1e9bca<_0x105b48['length'];_0x1e9bca++){const _0x1f6729=await bcryptjs_1[_0x49cf29(0x228)][_0x49cf29(0x30e)](_0x4a0e8a,_0x105b48[_0x1e9bca]);if(_0x1f6729){_0x18ceeb=!![],_0x105b48[_0x49cf29(0x1e2)](_0x1e9bca,0x1),config_1[_0x49cf29(0x1ee)][_0x49cf29(0x257)]['backupCodes']=JSON[_0x49cf29(0x25d)](_0x105b48);const _0x468c33=path_1[_0x49cf29(0x228)]['join'](process[_0x49cf29(0x1d1)](),_0x49cf29(0x1c4));if(fs_1[_0x49cf29(0x228)][_0x49cf29(0x33c)](_0x468c33)){let _0x36f05b=fs_1['default'][_0x49cf29(0x36f)](_0x468c33,'utf8');const _0x1dd973=_0x36f05b[_0x49cf29(0x1db)]('\x0a');for(let _0x2b5d06=0x0;_0x2b5d06<_0x1dd973[_0x49cf29(0x1c5)];_0x2b5d06++){if(_0x1dd973[_0x2b5d06]['startsWith'](_0x49cf29(0x31c))){_0x1dd973[_0x2b5d06]=_0x49cf29(0x31c)+JSON[_0x49cf29(0x25d)](_0x105b48);break;}}fs_1['default'][_0x49cf29(0x370)](_0x468c33,_0x1dd973['join']('\x0a'),_0x49cf29(0x326));}break;}}}if(!_0x18ceeb)throw new Error('Invalid\x202FA\x20token\x20or\x20backup\x20code');}}const _0x18c015=await bcryptjs_1[_0x49cf29(0x228)]['hash'](_0x5635f9,0xc);config_1['config'][_0x49cf29(0x257)][_0x49cf29(0x32a)]=_0x18c015;const _0x412bce=path_1['default'][_0x49cf29(0x34e)](process['cwd'](),_0x49cf29(0x1c4));let _0x19a5fa='';if(fs_1['default'][_0x49cf29(0x33c)](_0x412bce)){_0x19a5fa=fs_1[_0x49cf29(0x228)][_0x49cf29(0x36f)](_0x412bce,_0x49cf29(0x326));const _0x1ee07c=_0x19a5fa[_0x49cf29(0x1db)]('\x0a');let _0x2a1562=![];for(let _0x45a65a=0x0;_0x45a65a<_0x1ee07c[_0x49cf29(0x1c5)];_0x45a65a++){if(_0x1ee07c[_0x45a65a]['startsWith'](_0x49cf29(0x35a))){_0x1ee07c[_0x45a65a]=_0x49cf29(0x35a)+_0x18c015,_0x2a1562=!![];break;}}!_0x2a1562&&_0x1ee07c['push']('ADMIN_PASSWORD_HASH='+_0x18c015),_0x19a5fa=_0x1ee07c['join']('\x0a'),fs_1[_0x49cf29(0x228)][_0x49cf29(0x370)](_0x412bce,_0x19a5fa,'utf8');}console[_0x49cf29(0x250)](_0x49cf29(0x2f2));}async['get2FASettings'](){const _0x58ebc7=a53_0x2876e2;let _0x157fc9=0x0;if(config_1['config'][_0x58ebc7(0x257)][_0x58ebc7(0x343)])try{const _0x18290c=JSON[_0x58ebc7(0x329)](config_1[_0x58ebc7(0x1ee)]['admin']['backupCodes']);_0x157fc9=_0x18290c[_0x58ebc7(0x1c5)];}catch(_0xc457f8){console[_0x58ebc7(0x31a)](_0x58ebc7(0x227),_0xc457f8);}return{'twoFactorEnabled':config_1[_0x58ebc7(0x1ee)][_0x58ebc7(0x257)][_0x58ebc7(0x378)],'backupCodesCount':_0x157fc9};}async[a53_0x2876e2(0x36b)](){const _0x4db19b=a53_0x2876e2,_0x14aa30=speakeasy_1[_0x4db19b(0x228)]['generateSecret']({'name':'TrapaPay\x20Admin\x20('+config_1[_0x4db19b(0x1ee)]['admin'][_0x4db19b(0x23e)]+')','issuer':_0x4db19b(0x2b3),'length':0x20}),_0x32ec7c=await qrcode_1[_0x4db19b(0x228)][_0x4db19b(0x305)](_0x14aa30['otpauth_url']),_0x5979ac=[];for(let _0x3c8ffb=0x0;_0x3c8ffb<0x8;_0x3c8ffb++){const _0x492974=crypto_1[_0x4db19b(0x228)][_0x4db19b(0x276)](0x4)[_0x4db19b(0x2f7)](_0x4db19b(0x221))[_0x4db19b(0x273)]();_0x5979ac[_0x4db19b(0x1b2)](_0x492974);}const _0xf861d2=await Promise['all'](_0x5979ac[_0x4db19b(0x1c6)](_0x27ae87=>bcryptjs_1[_0x4db19b(0x228)][_0x4db19b(0x34b)](_0x27ae87,0xa)));config_1[_0x4db19b(0x1ee)][_0x4db19b(0x257)][_0x4db19b(0x23d)]=_0x14aa30[_0x4db19b(0x266)],config_1['config'][_0x4db19b(0x257)][_0x4db19b(0x343)]=JSON['stringify'](_0xf861d2);const _0x37f0d1=path_1[_0x4db19b(0x228)][_0x4db19b(0x34e)](process[_0x4db19b(0x1d1)](),_0x4db19b(0x1c4));if(fs_1['default'][_0x4db19b(0x33c)](_0x37f0d1)){let _0x57c480=fs_1[_0x4db19b(0x228)][_0x4db19b(0x36f)](_0x37f0d1,'utf8');const _0x35740d=_0x57c480[_0x4db19b(0x1db)]('\x0a');let _0x2d6541=![],_0x4d690b=![];for(let _0x382729=0x0;_0x382729<_0x35740d[_0x4db19b(0x1c5)];_0x382729++){_0x35740d[_0x382729][_0x4db19b(0x1bb)](_0x4db19b(0x28b))&&(_0x35740d[_0x382729]='ADMIN_2FA_SECRET='+_0x14aa30[_0x4db19b(0x266)],_0x2d6541=!![]),_0x35740d[_0x382729]['startsWith'](_0x4db19b(0x31c))&&(_0x35740d[_0x382729]='ADMIN_BACKUP_CODES='+JSON[_0x4db19b(0x25d)](_0xf861d2),_0x4d690b=!![]);}if(!_0x2d6541)_0x35740d[_0x4db19b(0x1b2)](_0x4db19b(0x28b)+_0x14aa30[_0x4db19b(0x266)]);if(!_0x4d690b)_0x35740d[_0x4db19b(0x1b2)]('ADMIN_BACKUP_CODES='+JSON[_0x4db19b(0x25d)](_0xf861d2));fs_1[_0x4db19b(0x228)]['writeFileSync'](_0x37f0d1,_0x35740d['join']('\x0a'),'utf8');}return console[_0x4db19b(0x250)]('üîê\x20Admin\x202FA\x20setup\x20initiated'),console[_0x4db19b(0x250)](_0x4db19b(0x1b0)+_0x5979ac[_0x4db19b(0x1c5)]+'\x20backup\x20codes'),{'secret':_0x14aa30[_0x4db19b(0x266)],'qrCode':_0x32ec7c,'manualEntryKey':_0x14aa30['base32'],'backupCodes':_0x5979ac};}async[a53_0x2876e2(0x2c4)](_0x4d1633){const _0x5159cb=a53_0x2876e2;if(!config_1[_0x5159cb(0x1ee)]['admin'][_0x5159cb(0x23d)])throw new Error(_0x5159cb(0x316));if(config_1[_0x5159cb(0x1ee)][_0x5159cb(0x257)][_0x5159cb(0x378)])throw new Error(_0x5159cb(0x283));const _0x39ca30=speakeasy_1[_0x5159cb(0x228)][_0x5159cb(0x34a)][_0x5159cb(0x1cd)]({'secret':config_1['config']['admin'][_0x5159cb(0x23d)],'encoding':_0x5159cb(0x266),'token':_0x4d1633,'window':0x2});if(!_0x39ca30)throw new Error(_0x5159cb(0x2af));config_1['config'][_0x5159cb(0x257)][_0x5159cb(0x378)]=!![];const _0x252137=path_1[_0x5159cb(0x228)][_0x5159cb(0x34e)](process['cwd'](),_0x5159cb(0x1c4));if(fs_1[_0x5159cb(0x228)]['existsSync'](_0x252137)){let _0x18c75b=fs_1[_0x5159cb(0x228)][_0x5159cb(0x36f)](_0x252137,_0x5159cb(0x326));const _0x201cd0=_0x18c75b[_0x5159cb(0x1db)]('\x0a');let _0x263109=![];for(let _0x926bba=0x0;_0x926bba<_0x201cd0[_0x5159cb(0x1c5)];_0x926bba++){if(_0x201cd0[_0x926bba][_0x5159cb(0x1bb)]('ADMIN_2FA_ENABLED=')){_0x201cd0[_0x926bba]='ADMIN_2FA_ENABLED=true',_0x263109=!![];break;}}if(!_0x263109)_0x201cd0[_0x5159cb(0x1b2)]('ADMIN_2FA_ENABLED=true');fs_1['default'][_0x5159cb(0x370)](_0x252137,_0x201cd0['join']('\x0a'),_0x5159cb(0x326));}return console[_0x5159cb(0x250)](_0x5159cb(0x22c)),{'enabled':!![]};}async[a53_0x2876e2(0x222)](){const _0x30270d=a53_0x2876e2;config_1[_0x30270d(0x1ee)][_0x30270d(0x257)][_0x30270d(0x378)]=![],config_1[_0x30270d(0x1ee)][_0x30270d(0x257)]['twoFactorSecret']='',config_1[_0x30270d(0x1ee)][_0x30270d(0x257)][_0x30270d(0x343)]='';const _0x240605=path_1[_0x30270d(0x228)]['join'](process['cwd'](),_0x30270d(0x1c4));if(fs_1[_0x30270d(0x228)][_0x30270d(0x33c)](_0x240605)){let _0x3f72bf=fs_1[_0x30270d(0x228)]['readFileSync'](_0x240605,'utf8');const _0xa4f457=_0x3f72bf['split']('\x0a');for(let _0x6c09d=0x0;_0x6c09d<_0xa4f457[_0x30270d(0x1c5)];_0x6c09d++){_0xa4f457[_0x6c09d][_0x30270d(0x1bb)](_0x30270d(0x330))&&(_0xa4f457[_0x6c09d]=_0x30270d(0x2cb)),_0xa4f457[_0x6c09d]['startsWith'](_0x30270d(0x28b))&&(_0xa4f457[_0x6c09d]=_0x30270d(0x28b)),_0xa4f457[_0x6c09d][_0x30270d(0x1bb)](_0x30270d(0x31c))&&(_0xa4f457[_0x6c09d]='ADMIN_BACKUP_CODES=');}fs_1['default'][_0x30270d(0x370)](_0x240605,_0xa4f457[_0x30270d(0x34e)]('\x0a'),_0x30270d(0x326));}console[_0x30270d(0x250)](_0x30270d(0x310));}[a53_0x2876e2(0x23a)](_0x4e6bea,_0x488e96,_0x49ceda){const _0x263af8=a53_0x2876e2,_0x11e464=new Map(),_0x540043=new Date(_0x488e96);while(_0x540043<=_0x49ceda){const _0x2cc8ab=_0x540043[_0x263af8(0x36d)]()[_0x263af8(0x1db)]('T')[0x0];_0x11e464[_0x263af8(0x247)](_0x2cc8ab,{'revenue':0x0,'count':0x0}),_0x540043[_0x263af8(0x2a5)](_0x540043[_0x263af8(0x21f)]()+0x1);}for(const _0x2552ce of _0x4e6bea){const _0x34eb63=_0x2552ce[_0x263af8(0x301)][_0x263af8(0x36d)]()[_0x263af8(0x1db)]('T')[0x0],_0x46d221=_0x11e464[_0x263af8(0x367)](_0x34eb63);_0x46d221&&(_0x46d221[_0x263af8(0x21c)]+=0x1,_0x2552ce[_0x263af8(0x2be)]==='PAID'&&(_0x2552ce[_0x263af8(0x28c)]?_0x46d221[_0x263af8(0x242)]+=_0x2552ce[_0x263af8(0x28c)]:console[_0x263af8(0x250)]('‚ö†Ô∏è\x20Payment\x20'+_0x2552ce['id']+'\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion')));}const _0x314dbc=[],_0x3afbaf=[];for(const [_0x37b37e,_0x28699e]of _0x11e464){_0x314dbc[_0x263af8(0x1b2)]({'date':_0x37b37e,'amount':Math[_0x263af8(0x1ed)](_0x28699e[_0x263af8(0x242)]*0x64)/0x64}),_0x3afbaf[_0x263af8(0x1b2)]({'date':_0x37b37e,'count':_0x28699e[_0x263af8(0x21c)]});}return{'dailyRevenue':_0x314dbc,'dailyPayments':_0x3afbaf};}async['getPayoutReports'](_0x472b43){const _0x37630b=a53_0x2876e2;console['log']('üìä\x20Getting\x20payout\x20reports\x20with\x20filters:',_0x472b43);const _0x229a38=new Date(_0x472b43[_0x37630b(0x1b1)]),_0x45de88=new Date(_0x472b43[_0x37630b(0x2a6)]),_0x2cd262=new Date(Date['UTC'](_0x229a38['getUTCFullYear'](),_0x229a38[_0x37630b(0x292)](),_0x229a38['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x5f510f=new Date(Date[_0x37630b(0x2b1)](_0x45de88['getUTCFullYear'](),_0x45de88[_0x37630b(0x292)](),_0x45de88[_0x37630b(0x1bc)](),0x17,0x3b,0x3b,0x3e7));console[_0x37630b(0x250)]('üìÖ\x20Period:\x20'+_0x2cd262[_0x37630b(0x36d)]()+'\x20to\x20'+_0x5f510f[_0x37630b(0x36d)]()),console[_0x37630b(0x250)](_0x37630b(0x371)+_0x472b43['gateway']);const _0xd2a76f=await database_1[_0x37630b(0x228)]['payment'][_0x37630b(0x263)]({'where':{'status':_0x37630b(0x26e),'gateway':_0x472b43[_0x37630b(0x21b)][_0x37630b(0x2d7)](),'createdAt':{'gte':_0x2cd262,'lte':_0x5f510f}},'select':{'id':!![],'shopId':!![],'amountAfterGatewayCommissionUSDT':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console[_0x37630b(0x250)](_0x37630b(0x290)+_0xd2a76f[_0x37630b(0x1c5)]+_0x37630b(0x288)+_0x472b43[_0x37630b(0x21b)]);const _0x2821c7=new Map();for(const _0x228073 of _0xd2a76f){const _0x3a7f75=_0x228073['amountAfterGatewayCommissionUSDT']||0x0;if(_0x3a7f75<=0x0){console['warn'](_0x37630b(0x25a)+_0x228073['id']+_0x37630b(0x219));continue;}if(_0x2821c7['has'](_0x228073[_0x37630b(0x1f8)])){const _0x58fb83=_0x2821c7[_0x37630b(0x367)](_0x228073[_0x37630b(0x1f8)]);_0x58fb83[_0x37630b(0x376)]+=_0x3a7f75;}else _0x2821c7[_0x37630b(0x247)](_0x228073[_0x37630b(0x1f8)],{'merchantId':_0x228073[_0x37630b(0x364)]['id'],'merchantName':_0x228073[_0x37630b(0x364)][_0x37630b(0x2df)],'merchantUsername':_0x228073[_0x37630b(0x364)]['username'],'totalAmount':_0x3a7f75});}const _0x532e7a=Array[_0x37630b(0x353)](_0x2821c7[_0x37630b(0x1d6)]())[_0x37630b(0x1c6)](_0x2057e0=>({'merchantId':_0x2057e0[_0x37630b(0x331)],'merchantName':_0x2057e0[_0x37630b(0x2e4)],'merchantUsername':_0x2057e0['merchantUsername'],'gateway':_0x472b43[_0x37630b(0x21b)],'periodFrom':_0x472b43['periodFrom'],'periodTo':_0x472b43[_0x37630b(0x2a6)],'totalAmount':Math[_0x37630b(0x1ed)](_0x2057e0['totalAmount']*0x64)/0x64}));return _0x532e7a['sort']((_0x5bb796,_0x4fdd04)=>_0x4fdd04[_0x37630b(0x376)]-_0x5bb796[_0x37630b(0x376)]),console[_0x37630b(0x250)](_0x37630b(0x24c)+_0x532e7a['length']+'\x20merchants'),_0x532e7a;}async['depositBalance'](_0x4fb2e2,_0x558868,_0x279212){const _0x3e556d=a53_0x2876e2,_0x2c186d=await database_1['default'][_0x3e556d(0x364)][_0x3e556d(0x254)]({'where':{'id':_0x4fb2e2}});if(!_0x2c186d)throw new Error('Merchant\x20not\x20found');await database_1[_0x3e556d(0x228)][_0x3e556d(0x2f4)](async _0x5e0f45=>{const _0xe8767d=_0x3e556d;await _0x5e0f45[_0xe8767d(0x368)][_0xe8767d(0x245)]({'data':{'shopId':_0x2c186d['id'],'amount':_0x558868,'amountUSDT':_0x558868,'amountAfterGatewayCommissionUSDT':_0x558868,'sourceCurrency':_0xe8767d(0x28f),'currency':_0xe8767d(0x28f),'status':_0xe8767d(0x26e),'gateway':_0xe8767d(0x210),'customerName':_0x2c186d[_0xe8767d(0x23e)],'customerEmail':'@'+_0x2c186d['telegram'],'paymentMethod':'CRYPTO','adminNotes':_0x279212||null,'successUrl':'-','failUrl':'-','paidAt':new Date()}}),await _0x5e0f45[_0xe8767d(0x364)]['update']({'where':{'id':_0x2c186d['id']},'data':{'balance':{'increment':_0x558868}}});}),console['log'](_0x3e556d(0x29f)+_0x558868+'\x20USDC\x20to\x20merchant\x20'+_0x2c186d[_0x3e556d(0x23e)]);}}exports[a53_0x2876e2(0x1dd)]=AdminService;