'use strict';function a35_0x467c(){const _0x33435d=['delete','periodFrom','dailyRevenue','findFirst','\x20\x20\x20🌍\x20Country:\x20','14206kpybEz','convertToUSDT','\x20USDT','97632uYHrzY','\x20merchants,\x20','findUnique','💰\x20Current\x20shop\x20balance:\x20','localeCompare','\x20merchants\x20with\x20positive\x20balance','create','amountUSDT','averageCheckUSDT','\x20USDT\x20total','\x20\x20\x20Total\x20paid\x20out:\x20','📊\x20Merchants\x20awaiting\x20payout:\x20','104wHoYLG','gte','usdcPolygonWallet','2335870lLkzDI','CHARGEBACK','deletePayout','dateFrom','deleteUser','417966FzqNii','network','commission','totalTurnover','shopId','\x20USDT\x20(','customerUa','ACTIVE','toString','getPaymentById','shopUrl','_sum','SUSPENDED','\x20\x20\x20Payout\x20amount:\x20','📊\x20Payout\x20statistics\x20calculated:','\x20became\x20PAID:\x20+','payment','test_gateway','name','KLYME\x20EU','totalCommissionRate','gatewayEarnings','KLYME\x20DE','shop','round','getMerchantsAwaitingPayout','\x20\x20\x20Balance:\x20','amount','stringify','\x20\x20\x20🖥️\x20User\x20Agent:\x20','customerEmail','pendingUrl','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','hash','\x20\x20\x20💰\x20Total\x20payout:\x20','password','month','getMerchantStatistics','37LzibXE','gatewayOrderId','$transaction','getMonth','getPayoutById','13lBnhsl','generateDailyStatistics','✅\x20Payout\x20created:\x20','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','chargebackAmount','insensitive','PAID','\x20for\x20shop\x20','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','hex','pk_','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','lte','AdminService','paidAt','usdtErcWallet','period','paymentGateways','customerName','\x20\x20\x20🌐\x20IP:\x20','gateways','desc','groupBy','25kcRTIz','createdAt','periodTo','sort','crypto','updatedAt','merchantUrl','updateUser','\x20USDT,\x20Requested:\x20','balance','\x20balance\x20updated:','💰\x20Shop\x20','getAllPayments','KLYME\x20GB','update','date','averageCommissionRate','toISOString','count','181762hmTKOH','wallets','\x20USDT)','telegramId','\x20USDT\x20(total\x20paid\x20to\x20merchants)','activateUser','usdtPolygonWallet','defineProperty','\x20\x20\x20📅\x20This\x20month:\x20','2020-01-01','aggregate','availableBalance','Shop\x20not\x20found','string','\x20to\x20','121WbdxKO','\x20USDT\x20from\x20balance','findMany','error','\x20\x20\x20Current\x20balance:\x20','\x20USDT\x20(+','asc','\x20no\x20longer\x20PAID:\x20-','bcryptjs','paymentsCount','Insufficient\x20balance.\x20Available:\x20','totalPayout','length','COMPLETED','customerIp','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','payout','all','successUrl','getGatewayDisplayName','../config/database','12367922QUoiyh','getAllUsers','updatePaymentStatus','txid','./currencyService','getUserById','toFixed','username','sk_','currency','\x20status:\x20','status','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','default','42516THFspo','values','Rapyd','notes','fullName','totalPaidOut','parse','failureMessage','Plisio','\x20\x20\x20📊\x20Total\x20payments:\x20','year','dateTo','gatewaySettings','push','publicKey','Payment\x20not\x20found','reduce','💰\x20Found\x20','\x20->\x20','__esModule','log','randomBytes','updateCustomerData','usdtTrcWallet','split','📅\x20Period:\x20','getTime','📊\x20Merchant\x20statistics\x20calculated:','90d','customerCountry','revenue','merchantEarnings','orderId','gateway','adminNotes','ceil','💰\x20Payment\x20','commissionUSDT','statusChangedAt','💸\x20CHARGEBACK\x20penalty:\x20-','telegram','turnoverUSDT','externalPaymentUrl','12NCLTnR','💰\x20Creating\x20payout\x20for\x20shop\x20','set','merchantEarningsUSDT','currencyService','toUpperCase','forEach','map','dailyPayments','failUrl','totalPayments','getDate','9tJZxZV','paidOutUSDT','Test\x20Gateway','not\x20set'];a35_0x467c=function(){return _0x33435d;};return a35_0x467c();}const a35_0x4ce9b3=a35_0x180d;function a35_0x180d(_0x4aa6ae,_0x586b88){const _0x467cec=a35_0x467c();return a35_0x180d=function(_0x180d31,_0x5117e5){_0x180d31=_0x180d31-0x94;let _0x284828=_0x467cec[_0x180d31];return _0x284828;},a35_0x180d(_0x4aa6ae,_0x586b88);}(function(_0x4ff537,_0x492228){const _0x19f8c4=a35_0x180d,_0x562d51=_0x4ff537();while(!![]){try{const _0x3cb138=parseInt(_0x19f8c4(0x15b))/0x1*(parseInt(_0x19f8c4(0x11e))/0x2)+parseInt(_0x19f8c4(0xde))/0x3*(parseInt(_0x19f8c4(0x109))/0x4)+parseInt(_0x19f8c4(0x98))/0x5*(-parseInt(_0x19f8c4(0x135))/0x6)+parseInt(_0x19f8c4(0xab))/0x7*(-parseInt(_0x19f8c4(0x12d))/0x8)+parseInt(_0x19f8c4(0x115))/0x9*(-parseInt(_0x19f8c4(0x130))/0xa)+parseInt(_0x19f8c4(0xba))/0xb*(-parseInt(_0x19f8c4(0x121))/0xc)+parseInt(_0x19f8c4(0x160))/0xd*(parseInt(_0x19f8c4(0xd0))/0xe);if(_0x3cb138===_0x492228)break;else _0x562d51['push'](_0x562d51['shift']());}catch(_0xceceee){_0x562d51['push'](_0x562d51['shift']());}}}(a35_0x467c,0x2be5c));var __importDefault=this&&this['__importDefault']||function(_0x4f6021){const _0x2a58c3=a35_0x180d;return _0x4f6021&&_0x4f6021[_0x2a58c3(0xf1)]?_0x4f6021:{'default':_0x4f6021};};Object[a35_0x4ce9b3(0xb2)](exports,a35_0x4ce9b3(0xf1),{'value':!![]}),exports[a35_0x4ce9b3(0x16d)]=void 0x0;const database_1=__importDefault(require(a35_0x4ce9b3(0xcf))),bcryptjs_1=__importDefault(require(a35_0x4ce9b3(0xc2))),crypto_1=__importDefault(require(a35_0x4ce9b3(0x9c))),currencyService_1=require(a35_0x4ce9b3(0xd4));class AdminService{async['getPayoutStats'](){const _0x3b939a=a35_0x4ce9b3;console[_0x3b939a(0xf2)]('📊\x20Calculating\x20payout\x20statistics...');const _0x449ea8=await database_1[_0x3b939a(0xdd)][_0x3b939a(0x14c)][_0x3b939a(0xb5)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x3b939a(0x13c)}}),_0x3b544c=new Date(),_0x419b50=new Date(_0x3b544c['getFullYear'](),_0x3b544c[_0x3b939a(0x15e)](),0x1),_0x13d467=new Date(_0x3b544c['getFullYear'](),_0x3b544c['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x53b049=await database_1[_0x3b939a(0xdd)]['payout']['aggregate']({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x419b50,'lte':_0x13d467},'status':_0x3b939a(0xc7)}}),_0x204bb3=_0x449ea8[_0x3b939a(0x140)][_0x3b939a(0xe3)]||0x0,_0x520fea=_0x449ea8[_0x3b939a(0x140)][_0x3b939a(0xa1)]||0x0,_0x13c75c=_0x53b049[_0x3b939a(0x140)][_0x3b939a(0x150)]||0x0,_0x45e964={'totalPayout':Math[_0x3b939a(0x14d)](_0x204bb3*0x64)/0x64,'awaitingPayout':Math[_0x3b939a(0x14d)](_0x520fea*0x64)/0x64,'thisMonth':Math[_0x3b939a(0x14d)](_0x13c75c*0x64)/0x64,'availableBalance':Math[_0x3b939a(0x14d)](_0x520fea*0x64)/0x64};return console[_0x3b939a(0xf2)](_0x3b939a(0x143)),console['log'](_0x3b939a(0x157)+_0x45e964[_0x3b939a(0xc5)]+_0x3b939a(0xaf)),console['log'](_0x3b939a(0xc9)+_0x45e964['awaitingPayout']+'\x20USDT\x20(total\x20merchant\x20balances)'),console['log']('\x20\x20\x20💵\x20Available\x20balance:\x20'+_0x45e964[_0x3b939a(0xb6)]+'\x20USDT\x20(same\x20as\x20awaiting)'),console[_0x3b939a(0xf2)](_0x3b939a(0xb3)+_0x45e964['thisMonth']+_0x3b939a(0x120)),_0x45e964;}async[a35_0x4ce9b3(0xf4)](_0x1eb6d,_0x41f8b8){const _0x1b48a5=a35_0x4ce9b3;console[_0x1b48a5(0xf2)](_0x1b48a5(0x16b)+_0x1eb6d+':',_0x41f8b8);const _0x28d4c1=await database_1[_0x1b48a5(0xdd)][_0x1b48a5(0x145)][_0x1b48a5(0x123)]({'where':{'id':_0x1eb6d},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x28d4c1)throw new Error(_0x1b48a5(0xed));const _0x59a0ef={};_0x41f8b8[_0x1b48a5(0xfb)]!==undefined&&(_0x59a0ef['customerCountry']=_0x41f8b8['customerCountry']||null);_0x41f8b8['customerIp']!==undefined&&(_0x59a0ef[_0x1b48a5(0xc8)]=_0x41f8b8[_0x1b48a5(0xc8)]||null);_0x41f8b8['customerUa']!==undefined&&(_0x59a0ef['customerUa']=_0x41f8b8[_0x1b48a5(0x13b)]||null);const _0x25d53a=await database_1[_0x1b48a5(0xdd)][_0x1b48a5(0x145)]['update']({'where':{'id':_0x1eb6d},'data':{..._0x59a0ef,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x1b48a5(0xf2)]('✅\x20Customer\x20data\x20updated\x20for\x20payment\x20'+_0x1eb6d),console[_0x1b48a5(0xf2)](_0x1b48a5(0x11d)+_0x28d4c1['customerCountry']+'\x20->\x20'+_0x25d53a['customerCountry']),console[_0x1b48a5(0xf2)](_0x1b48a5(0x94)+_0x28d4c1['customerIp']+'\x20->\x20'+_0x25d53a['customerIp']),console[_0x1b48a5(0xf2)](_0x1b48a5(0x152)+(_0x28d4c1[_0x1b48a5(0x13b)]?'set':_0x1b48a5(0x118))+_0x1b48a5(0xf0)+(_0x25d53a[_0x1b48a5(0x13b)]?_0x1b48a5(0x10b):_0x1b48a5(0x118))),_0x25d53a;}async['getSystemStatistics'](_0x5d011e){const _0x45adce=a35_0x4ce9b3,_0x2591a0=new Date();let _0x54f0a2;switch(_0x5d011e){case'7d':_0x54f0a2=new Date(_0x2591a0[_0x45adce(0xf8)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x54f0a2=new Date(_0x2591a0[_0x45adce(0xf8)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x45adce(0xfa):_0x54f0a2=new Date(_0x2591a0['getTime']()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x54f0a2=new Date(_0x2591a0[_0x45adce(0xf8)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x41d887,_0x44bd6d,_0x521926,_0x545ee8,_0x58bd68,_0x1be51a,_0x4b7f73]=await Promise[_0x45adce(0xcc)]([database_1[_0x45adce(0xdd)][_0x45adce(0x14c)][_0x45adce(0xaa)](),database_1[_0x45adce(0xdd)][_0x45adce(0x14c)]['count']({'where':{'status':_0x45adce(0x13c)}}),database_1[_0x45adce(0xdd)][_0x45adce(0x145)]['count']({'where':{'createdAt':{'gte':_0x54f0a2},'gateway':{'not':_0x45adce(0x146)}}}),database_1['default'][_0x45adce(0x145)][_0x45adce(0xaa)]({'where':{'status':_0x45adce(0x166),'createdAt':{'gte':_0x54f0a2},'gateway':{'not':_0x45adce(0x146)}}}),database_1[_0x45adce(0xdd)][_0x45adce(0x145)][_0x45adce(0xbc)]({'where':{'status':_0x45adce(0x166),'createdAt':{'gte':_0x54f0a2},'gateway':{'not':_0x45adce(0x146)}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x45adce(0xdd)]['payment'][_0x45adce(0xbc)]({'where':{'gateway':{'not':_0x45adce(0x146)}},'take':0xa,'orderBy':{'createdAt':_0x45adce(0x96)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x45adce(0xdd)]['payment']['findMany']({'where':{'createdAt':{'gte':_0x54f0a2},'gateway':{'not':_0x45adce(0x146)}},'select':{'status':!![],'amountUSDT':!![],'amount':!![],'currency':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x45adce(0xc0)}})]);let _0x3d9281=0x0;for(const _0x555173 of _0x58bd68){if(_0x555173[_0x45adce(0x128)])_0x3d9281+=_0x555173[_0x45adce(0x128)];else{const _0x335abd=await currencyService_1[_0x45adce(0x10d)][_0x45adce(0x11f)](_0x555173['amount'],_0x555173['currency']);_0x3d9281+=_0x335abd;}}const _0x246f9b=this[_0x45adce(0x161)](_0x4b7f73,_0x54f0a2,_0x2591a0),_0x4e9010=_0x521926>0x0?_0x545ee8/_0x521926*0x64:0x0;return{'totalShops':_0x41d887,'activeShops':_0x44bd6d,'totalPayments':_0x521926,'successfulPayments':_0x545ee8,'totalRevenue':Math[_0x45adce(0x14d)](_0x3d9281*0x64)/0x64,'conversionRate':Math[_0x45adce(0x14d)](_0x4e9010*0x64)/0x64,'dailyRevenue':_0x246f9b[_0x45adce(0x11b)],'dailyPayments':_0x246f9b[_0x45adce(0x111)],'recentPayments':_0x1be51a[_0x45adce(0x110)](_0xdc342d=>({'id':_0xdc342d['id'],'amount':_0xdc342d[_0x45adce(0x150)],'currency':_0xdc342d[_0x45adce(0xd9)],'status':_0xdc342d[_0x45adce(0xdb)],'gateway':_0xdc342d[_0x45adce(0xff)],'shop':_0xdc342d['shop'],'createdAt':_0xdc342d[_0x45adce(0x99)]}))};}[a35_0x4ce9b3(0x161)](_0x244430,_0x53ed7a,_0x26813d){const _0x104da1=a35_0x4ce9b3,_0xaf785=new Map(),_0x1bb87f=new Date(_0x53ed7a);while(_0x1bb87f<=_0x26813d){const _0x591d1a=_0x1bb87f['toISOString']()['split']('T')[0x0];_0xaf785[_0x104da1(0x10b)](_0x591d1a,{'revenue':0x0,'count':0x0}),_0x1bb87f['setDate'](_0x1bb87f[_0x104da1(0x114)]()+0x1);}for(const _0x140144 of _0x244430){const _0x1408bd=_0x140144[_0x104da1(0x99)][_0x104da1(0xa9)]()['split']('T')[0x0],_0x2ce904=_0xaf785['get'](_0x1408bd);if(_0x2ce904){_0x2ce904[_0x104da1(0xaa)]+=0x1;if(_0x140144[_0x104da1(0xdb)]===_0x104da1(0x166)){if(_0x140144[_0x104da1(0x128)])_0x2ce904[_0x104da1(0xfc)]+=_0x140144[_0x104da1(0x128)];else{}}}}const _0x41e5cc=[],_0x1c8159=[];for(const [_0x2f3ed9,_0x22c80c]of _0xaf785){_0x41e5cc['push']({'date':_0x2f3ed9,'amount':Math[_0x104da1(0x14d)](_0x22c80c[_0x104da1(0xfc)]*0x64)/0x64}),_0x1c8159[_0x104da1(0xeb)]({'date':_0x2f3ed9,'count':_0x22c80c['count']});}return{'dailyRevenue':_0x41e5cc,'dailyPayments':_0x1c8159};}async[a35_0x4ce9b3(0x15a)](_0x19da0d){const _0x490464=a35_0x4ce9b3;console[_0x490464(0xf2)](_0x490464(0xdc),_0x19da0d);let _0x2a6c3c,_0x1a1db4=new Date();if(_0x19da0d['period']==='custom'&&_0x19da0d[_0x490464(0x133)]&&_0x19da0d[_0x490464(0xe9)])_0x2a6c3c=new Date(_0x19da0d['dateFrom']),_0x1a1db4=new Date(_0x19da0d['dateTo']);else{const _0x184a7c=new Date();switch(_0x19da0d[_0x490464(0x170)]){case'week':_0x2a6c3c=new Date(_0x184a7c[_0x490464(0xf8)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x490464(0x159):_0x2a6c3c=new Date(_0x184a7c['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x490464(0xe8):_0x2a6c3c=new Date(_0x184a7c['getTime']()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case'all':default:_0x2a6c3c=new Date(_0x490464(0xb4));break;}}console[_0x490464(0xf2)](_0x490464(0xf7)+_0x2a6c3c['toISOString']()+_0x490464(0xb9)+_0x1a1db4[_0x490464(0xa9)]());const _0xc6ac1e={'status':_0x490464(0x166),'gateway':{'not':_0x490464(0x146)},'paidAt':{'gte':_0x2a6c3c,'lte':_0x1a1db4}};_0x19da0d[_0x490464(0x139)]&&(_0xc6ac1e[_0x490464(0x139)]=_0x19da0d['shopId']);const _0x1fe3ef=await database_1['default'][_0x490464(0x145)]['findMany']({'where':_0xc6ac1e,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x490464(0xf2)]('💰\x20Found\x20'+_0x1fe3ef[_0x490464(0xc6)]+'\x20paid\x20payments\x20for\x20analysis');let _0x5b6ca1=0x0,_0x1fe20f=0x0,_0x5e9b0d=0x0;const _0x174620={},_0xebbdcc={},_0x3f5b68={};for(const _0x211792 of _0x1fe3ef){try{const _0x3c0260=await currencyService_1[_0x490464(0x10d)][_0x490464(0x11f)](_0x211792[_0x490464(0x150)],_0x211792[_0x490464(0xd9)]);let _0x381ca2={};if(_0x211792[_0x490464(0x14c)]['gatewaySettings'])try{_0x381ca2=JSON[_0x490464(0xe4)](_0x211792['shop']['gatewaySettings']);}catch(_0x4fb44e){console[_0x490464(0xbd)](_0x490464(0x163)+_0x211792['shopId']+':',_0x4fb44e);}const _0x1c334f=_0x381ca2[_0x490464(0x137)]||0xa,_0x5dc66b=_0x3c0260*(_0x1c334f/0x64),_0x16d477=_0x3c0260-_0x5dc66b;_0x5b6ca1+=_0x3c0260,_0x1fe20f+=_0x16d477,_0x5e9b0d+=_0x5dc66b;!_0x174620[_0x211792[_0x490464(0xff)]]&&(_0x174620[_0x211792[_0x490464(0xff)]]={'gateway':_0x211792['gateway'],'gatewayDisplayName':this[_0x490464(0xce)](_0x211792[_0x490464(0xff)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x174620[_0x211792[_0x490464(0xff)]]['paymentsCount']++,_0x174620[_0x211792['gateway']]['turnoverUSDT']+=_0x3c0260,_0x174620[_0x211792['gateway']][_0x490464(0x103)]+=_0x5dc66b,_0x174620[_0x211792[_0x490464(0xff)]][_0x490464(0x10c)]+=_0x16d477,_0x174620[_0x211792[_0x490464(0xff)]][_0x490464(0x149)]+=_0x1c334f;!_0x19da0d[_0x490464(0x139)]&&(!_0xebbdcc[_0x211792[_0x490464(0x139)]]&&(_0xebbdcc[_0x211792[_0x490464(0x139)]]={'shopId':_0x211792['shopId'],'shopName':_0x211792[_0x490464(0x14c)][_0x490464(0x147)],'shopUsername':_0x211792[_0x490464(0x14c)][_0x490464(0xd7)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0xebbdcc[_0x211792['shopId']][_0x490464(0xc3)]++,_0xebbdcc[_0x211792[_0x490464(0x139)]][_0x490464(0x107)]+=_0x3c0260,_0xebbdcc[_0x211792['shopId']]['commissionUSDT']+=_0x5dc66b,_0xebbdcc[_0x211792[_0x490464(0x139)]][_0x490464(0x10c)]+=_0x16d477);const _0x26102f=_0x211792[_0x490464(0x16e)][_0x490464(0xa9)]()[_0x490464(0xf6)]('T')[0x0];!_0x3f5b68[_0x26102f]&&(_0x3f5b68[_0x26102f]={'date':_0x26102f,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x3f5b68[_0x26102f]['turnover']+=_0x3c0260,_0x3f5b68[_0x26102f]['merchantEarnings']+=_0x16d477,_0x3f5b68[_0x26102f][_0x490464(0x14a)]+=_0x5dc66b,_0x3f5b68[_0x26102f][_0x490464(0xc3)]++;}catch(_0xea00c6){console[_0x490464(0xbd)]('Error\x20processing\x20payment\x20'+_0x211792['id']+':',_0xea00c6);}}Object[_0x490464(0xdf)](_0x174620)['forEach'](_0x426930=>{const _0x4321fe=_0x490464;_0x426930[_0x4321fe(0xa8)]=_0x426930[_0x4321fe(0xc3)]>0x0?_0x426930[_0x4321fe(0x149)]/_0x426930[_0x4321fe(0xc3)]:0x0,delete _0x426930[_0x4321fe(0x149)];}),Object[_0x490464(0xdf)](_0xebbdcc)[_0x490464(0x10f)](_0x1710fc=>{const _0x33b435=_0x490464;_0x1710fc[_0x33b435(0x129)]=_0x1710fc[_0x33b435(0xc3)]>0x0?_0x1710fc[_0x33b435(0x107)]/_0x1710fc[_0x33b435(0xc3)]:0x0;});let _0x1c6cf7=0x0;if(_0x19da0d['shopId']){const _0x42fda0=await database_1[_0x490464(0xdd)]['payout'][_0x490464(0xbc)]({'where':{'shopId':_0x19da0d[_0x490464(0x139)],'status':_0x490464(0xc7),'createdAt':{'gte':_0x2a6c3c,'lte':_0x1a1db4}},'select':{'amount':!![]}});_0x1c6cf7=_0x42fda0[_0x490464(0xee)]((_0x1ee82a,_0x3adcf9)=>_0x1ee82a+_0x3adcf9[_0x490464(0x150)],0x0);}const _0x179d73=_0x1fe3ef['length'],_0x14cd25=_0x1fe3ef[_0x490464(0xc6)],_0x2f30c1=_0x179d73>0x0?_0x5b6ca1/_0x179d73:0x0,_0x5f0848=0x64,_0x1c1447=Math[_0x490464(0x101)]((_0x1a1db4[_0x490464(0xf8)]()-_0x2a6c3c['getTime']())/(0x3e8*0x3c*0x3c*0x18)),_0x41d2c6={'totalTurnover':Math[_0x490464(0x14d)](_0x5b6ca1*0x64)/0x64,'merchantEarnings':Math[_0x490464(0x14d)](_0x1fe20f*0x64)/0x64,'gatewayEarnings':Math[_0x490464(0x14d)](_0x5e9b0d*0x64)/0x64,'totalPaidOut':Math[_0x490464(0x14d)](_0x1c6cf7*0x64)/0x64,'averageCheck':Math[_0x490464(0x14d)](_0x2f30c1*0x64)/0x64,'totalPayments':_0x179d73,'successfulPayments':_0x14cd25,'conversionRate':_0x5f0848,'gatewayBreakdown':Object['values'](_0x174620)['map'](_0x88491e=>({..._0x88491e,'turnoverUSDT':Math[_0x490464(0x14d)](_0x88491e[_0x490464(0x107)]*0x64)/0x64,'commissionUSDT':Math[_0x490464(0x14d)](_0x88491e['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x490464(0x14d)](_0x88491e[_0x490464(0x10c)]*0x64)/0x64,'averageCommissionRate':Math[_0x490464(0x14d)](_0x88491e[_0x490464(0xa8)]*0x64)/0x64})),'merchantBreakdown':_0x19da0d[_0x490464(0x139)]?undefined:Object['values'](_0xebbdcc)['map'](_0x6f103b=>({..._0x6f103b,'turnoverUSDT':Math[_0x490464(0x14d)](_0x6f103b[_0x490464(0x107)]*0x64)/0x64,'commissionUSDT':Math[_0x490464(0x14d)](_0x6f103b[_0x490464(0x103)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x490464(0x14d)](_0x6f103b[_0x490464(0x10c)]*0x64)/0x64,'paidOutUSDT':Math[_0x490464(0x14d)](_0x6f103b[_0x490464(0x116)]*0x64)/0x64,'averageCheckUSDT':Math[_0x490464(0x14d)](_0x6f103b[_0x490464(0x129)]*0x64)/0x64})),'dailyData':Object[_0x490464(0xdf)](_0x3f5b68)['map'](_0x3299c0=>({..._0x3299c0,'turnover':Math[_0x490464(0x14d)](_0x3299c0['turnover']*0x64)/0x64,'merchantEarnings':Math[_0x490464(0x14d)](_0x3299c0[_0x490464(0xfd)]*0x64)/0x64,'gatewayEarnings':Math[_0x490464(0x14d)](_0x3299c0[_0x490464(0x14a)]*0x64)/0x64}))[_0x490464(0x9b)]((_0x275e8a,_0x3fcdee)=>_0x275e8a[_0x490464(0xa7)][_0x490464(0x125)](_0x3fcdee[_0x490464(0xa7)])),'periodInfo':{'from':_0x2a6c3c,'to':_0x1a1db4,'periodType':_0x19da0d[_0x490464(0x170)]||'custom','daysCount':_0x1c1447}};return console[_0x490464(0xf2)](_0x490464(0xf9)),console[_0x490464(0xf2)]('\x20\x20\x20💰\x20Total\x20turnover:\x20'+_0x41d2c6[_0x490464(0x138)]+'\x20USDT'),console['log'](_0x490464(0x168)+_0x41d2c6[_0x490464(0xfd)]+_0x490464(0x120)),console[_0x490464(0xf2)](_0x490464(0x155)+_0x41d2c6['gatewayEarnings']+_0x490464(0x120)),console[_0x490464(0xf2)](_0x490464(0xe7)+_0x41d2c6[_0x490464(0x113)]),_0x41d2c6;}[a35_0x4ce9b3(0xce)](_0x204b5d){const _0x793f1f=a35_0x4ce9b3,_0x28b58d={'test_gateway':_0x793f1f(0x117),'plisio':_0x793f1f(0xe6),'rapyd':_0x793f1f(0xe0),'noda':'Noda','cointopay':'CoinToPay','klyme_eu':_0x793f1f(0x148),'klyme_gb':_0x793f1f(0xa5),'klyme_de':_0x793f1f(0x14b)};return _0x28b58d[_0x204b5d]||_0x204b5d;}async[a35_0x4ce9b3(0x14e)](_0x531cdb){const _0x40d930=a35_0x4ce9b3,{page:_0xea48f8,limit:_0x367b76,minAmount:_0x116c7a,search:_0x4da498}=_0x531cdb,_0x5c5136=(_0xea48f8-0x1)*_0x367b76;console['log']('📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:',_0x531cdb);const _0x265733={'balance':{'gt':0x0},'status':_0x40d930(0x13c)};_0x116c7a&&(_0x265733[_0x40d930(0xa1)][_0x40d930(0x12e)]=_0x116c7a);_0x4da498&&(_0x265733['OR']=[{'name':{'contains':_0x4da498,'mode':_0x40d930(0x165)}},{'username':{'contains':_0x4da498,'mode':_0x40d930(0x165)}}]);const [_0x2b13a0,_0x106d0e]=await Promise[_0x40d930(0xcc)]([database_1[_0x40d930(0xdd)][_0x40d930(0x14c)][_0x40d930(0xbc)]({'where':_0x265733,'skip':_0x5c5136,'take':_0x367b76,'orderBy':{'balance':_0x40d930(0x96)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'createdAt':!![]}}),database_1['default'][_0x40d930(0x14c)][_0x40d930(0xaa)]({'where':_0x265733})]);console[_0x40d930(0xf2)](_0x40d930(0xef)+_0x2b13a0['length']+_0x40d930(0x126));const _0x491eff=await Promise[_0x40d930(0xcc)](_0x2b13a0[_0x40d930(0x110)](async _0xb1686c=>{const _0x5df962=_0x40d930,[_0x43e120,_0x3bc665,_0x1773e7]=await Promise[_0x5df962(0xcc)]([database_1['default'][_0x5df962(0x145)][_0x5df962(0xaa)]({'where':{'shopId':_0xb1686c['id'],'status':'PAID','amountUSDT':{'not':null}}}),database_1[_0x5df962(0xdd)]['payment'][_0x5df962(0x11c)]({'where':{'shopId':_0xb1686c['id'],'status':_0x5df962(0x166),'amountUSDT':{'not':null}},'orderBy':{'paidAt':_0x5df962(0xc0)},'select':{'paidAt':!![]}}),database_1[_0x5df962(0xdd)]['payment'][_0x5df962(0x97)]({'by':[_0x5df962(0xff)],'where':{'shopId':_0xb1686c['id'],'status':'PAID','amountUSDT':{'not':null}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x4386b9=_0x1773e7[_0x5df962(0x110)](_0x2b8608=>({'gateway':_0x2b8608[_0x5df962(0xff)],'count':_0x2b8608['_count']['id'],'amountUSDT':_0x2b8608[_0x5df962(0x140)][_0x5df962(0x128)]||0x0,'amountAfterCommissionUSDT':_0x2b8608[_0x5df962(0x140)][_0x5df962(0x128)]||0x0,'commission':0x0}));return{'id':_0xb1686c['id'],'fullName':_0xb1686c[_0x5df962(0x147)],'username':_0xb1686c[_0x5df962(0xd7)],'telegramId':_0xb1686c[_0x5df962(0x106)],'merchantUrl':_0xb1686c[_0x5df962(0x13f)],'wallets':{'usdtPolygonWallet':_0xb1686c[_0x5df962(0xb1)],'usdtTrcWallet':_0xb1686c[_0x5df962(0xf5)],'usdtErcWallet':_0xb1686c[_0x5df962(0x16f)],'usdcPolygonWallet':_0xb1686c[_0x5df962(0x12f)]},'totalAmountUSDT':_0xb1686c[_0x5df962(0xa1)],'totalAmountAfterCommissionUSDT':_0xb1686c[_0x5df962(0xa1)],'paymentsCount':_0x43e120,'oldestPaymentDate':_0x3bc665?.[_0x5df962(0x16e)]||_0xb1686c[_0x5df962(0x99)],'gatewayBreakdown':_0x4386b9};})),_0x2a333f=_0x2b13a0[_0x40d930(0xee)]((_0x4eeb07,_0x1f7228)=>_0x4eeb07+_0x1f7228[_0x40d930(0xa1)],0x0),_0x512d03=_0x2a333f;return console['log'](_0x40d930(0x12c)+_0x106d0e+_0x40d930(0x122)+Math['round'](_0x512d03*0x64)/0x64+_0x40d930(0x12a)),{'merchants':_0x491eff,'pagination':{'page':_0xea48f8,'limit':_0x367b76,'total':_0x106d0e,'totalPages':Math[_0x40d930(0x101)](_0x106d0e/_0x367b76)},'summary':{'totalMerchants':_0x106d0e,'totalAmountUSDT':Math[_0x40d930(0x14d)](_0x2a333f*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x40d930(0x14d)](_0x512d03*0x64)/0x64}};}async['createPayout'](_0x7e4f8f){const _0x1c884f=a35_0x4ce9b3,{shopId:_0x2126d4,amount:_0x373570,network:_0x138f72,notes:_0x5411c2,periodFrom:_0xa15a07,periodTo:_0x537ce3}=_0x7e4f8f,_0x14e1fc=await database_1[_0x1c884f(0xdd)][_0x1c884f(0x15d)](async _0x5298c3=>{const _0x3f14cc=_0x1c884f,_0x1a06af=await _0x5298c3[_0x3f14cc(0x14c)][_0x3f14cc(0x123)]({'where':{'id':_0x2126d4},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x1a06af)throw new Error(_0x3f14cc(0xb7));console[_0x3f14cc(0xf2)](_0x3f14cc(0x10a)+_0x1a06af['username']+':'),console[_0x3f14cc(0xf2)](_0x3f14cc(0xbe)+_0x1a06af[_0x3f14cc(0xa1)][_0x3f14cc(0xd6)](0x6)+_0x3f14cc(0x120)),console[_0x3f14cc(0xf2)](_0x3f14cc(0x142)+_0x373570[_0x3f14cc(0xd6)](0x6)+_0x3f14cc(0x120)),console[_0x3f14cc(0xf2)](_0x3f14cc(0xca)+_0x1a06af['totalPaidOut'][_0x3f14cc(0xd6)](0x6)+'\x20USDT');if(_0x1a06af[_0x3f14cc(0xa1)]<_0x373570)throw new Error(_0x3f14cc(0xc4)+_0x1a06af[_0x3f14cc(0xa1)][_0x3f14cc(0xd6)](0x6)+_0x3f14cc(0xa0)+_0x373570[_0x3f14cc(0xd6)](0x6)+'\x20USDT');const _0x579a5a=await _0x5298c3[_0x3f14cc(0xcb)][_0x3f14cc(0x127)]({'data':{'shopId':_0x2126d4,'amount':_0x373570,'network':_0x138f72,'status':_0x3f14cc(0xc7),'notes':_0x5411c2,'periodFrom':_0xa15a07?new Date(_0xa15a07):null,'periodTo':_0x537ce3?new Date(_0x537ce3):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x418c9e=_0x1a06af[_0x3f14cc(0xa1)]-_0x373570,_0x3c1352=_0x1a06af[_0x3f14cc(0xe3)]+_0x373570;return await _0x5298c3['shop'][_0x3f14cc(0xa6)]({'where':{'id':_0x2126d4},'data':{'balance':_0x418c9e,'totalPaidOut':_0x3c1352}}),console[_0x3f14cc(0xf2)](_0x3f14cc(0xa3)+_0x1a06af[_0x3f14cc(0xd7)]+_0x3f14cc(0xa2)),console[_0x3f14cc(0xf2)](_0x3f14cc(0x14f)+_0x1a06af[_0x3f14cc(0xa1)][_0x3f14cc(0xd6)](0x6)+'\x20->\x20'+_0x418c9e[_0x3f14cc(0xd6)](0x6)+'\x20USDT\x20(-'+_0x373570[_0x3f14cc(0xd6)](0x6)+')'),console[_0x3f14cc(0xf2)](_0x3f14cc(0x12b)+_0x1a06af[_0x3f14cc(0xe3)][_0x3f14cc(0xd6)](0x6)+'\x20->\x20'+_0x3c1352['toFixed'](0x6)+_0x3f14cc(0xbf)+_0x373570[_0x3f14cc(0xd6)](0x6)+')'),{'payout':_0x579a5a,'shop':_0x1a06af};});return console[_0x1c884f(0xf2)](_0x1c884f(0x162)+_0x14e1fc[_0x1c884f(0xcb)]['id']+_0x1c884f(0x167)+_0x14e1fc[_0x1c884f(0x14c)][_0x1c884f(0xd7)]+'\x20('+_0x373570+_0x1c884f(0xad)),{'id':_0x14e1fc[_0x1c884f(0xcb)]['id'],'shopId':_0x14e1fc[_0x1c884f(0xcb)][_0x1c884f(0x139)],'shopName':_0x14e1fc[_0x1c884f(0x14c)][_0x1c884f(0x147)],'shopUsername':_0x14e1fc[_0x1c884f(0x14c)]['username'],'amount':_0x14e1fc['payout'][_0x1c884f(0x150)],'network':_0x14e1fc[_0x1c884f(0xcb)][_0x1c884f(0x136)],'status':_0x14e1fc[_0x1c884f(0xcb)][_0x1c884f(0xdb)],'txid':_0x14e1fc[_0x1c884f(0xcb)][_0x1c884f(0xd3)],'notes':_0x14e1fc[_0x1c884f(0xcb)][_0x1c884f(0xe1)],'periodFrom':_0x14e1fc[_0x1c884f(0xcb)][_0x1c884f(0x11a)],'periodTo':_0x14e1fc[_0x1c884f(0xcb)]['periodTo'],'createdAt':_0x14e1fc['payout'][_0x1c884f(0x99)],'paidAt':_0x14e1fc[_0x1c884f(0xcb)][_0x1c884f(0x16e)]};}async['getAllPayouts'](_0x1a04da){const _0x57b3fe=a35_0x4ce9b3,{page:_0x52f7b3,limit:_0x430c43,shopId:_0xbae1ef,network:_0x24ad06,dateFrom:_0x39b80f,dateTo:_0x13ce66,search:_0x461998}=_0x1a04da,_0x110d7d=(_0x52f7b3-0x1)*_0x430c43,_0x4ccb7b={};_0xbae1ef&&(_0x4ccb7b[_0x57b3fe(0x139)]=_0xbae1ef);_0x24ad06&&(_0x4ccb7b[_0x57b3fe(0x136)]=_0x24ad06);(_0x39b80f||_0x13ce66)&&(_0x4ccb7b[_0x57b3fe(0x99)]={},_0x39b80f&&(_0x4ccb7b[_0x57b3fe(0x99)][_0x57b3fe(0x12e)]=new Date(_0x39b80f)),_0x13ce66&&(_0x4ccb7b[_0x57b3fe(0x99)][_0x57b3fe(0x16c)]=new Date(_0x13ce66)));_0x461998&&(_0x4ccb7b['OR']=[{'shop':{'name':{'contains':_0x461998,'mode':_0x57b3fe(0x165)}}},{'shop':{'username':{'contains':_0x461998,'mode':_0x57b3fe(0x165)}}},{'notes':{'contains':_0x461998,'mode':'insensitive'}}]);const [_0x20bde9,_0x12345e]=await Promise[_0x57b3fe(0xcc)]([database_1[_0x57b3fe(0xdd)][_0x57b3fe(0xcb)][_0x57b3fe(0xbc)]({'where':_0x4ccb7b,'skip':_0x110d7d,'take':_0x430c43,'orderBy':{'createdAt':_0x57b3fe(0x96)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x57b3fe(0xdd)][_0x57b3fe(0xcb)][_0x57b3fe(0xaa)]({'where':_0x4ccb7b})]);return{'payouts':_0x20bde9[_0x57b3fe(0x110)](_0x5b002d=>({'id':_0x5b002d['id'],'shopId':_0x5b002d[_0x57b3fe(0x139)],'shopName':_0x5b002d[_0x57b3fe(0x14c)]['name'],'shopUsername':_0x5b002d[_0x57b3fe(0x14c)]['username'],'amount':_0x5b002d['amount'],'network':_0x5b002d[_0x57b3fe(0x136)],'status':_0x5b002d['status'],'txid':_0x5b002d[_0x57b3fe(0xd3)],'notes':_0x5b002d['notes'],'periodFrom':_0x5b002d[_0x57b3fe(0x11a)],'periodTo':_0x5b002d[_0x57b3fe(0x9a)],'createdAt':_0x5b002d[_0x57b3fe(0x99)],'paidAt':_0x5b002d[_0x57b3fe(0x16e)]})),'pagination':{'page':_0x52f7b3,'limit':_0x430c43,'total':_0x12345e,'totalPages':Math[_0x57b3fe(0x101)](_0x12345e/_0x430c43)}};}async[a35_0x4ce9b3(0x15f)](_0x4d11d5){const _0x3cad8f=a35_0x4ce9b3,_0x2a7694=await database_1[_0x3cad8f(0xdd)][_0x3cad8f(0xcb)][_0x3cad8f(0x123)]({'where':{'id':_0x4d11d5},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x2a7694)return null;return{'id':_0x2a7694['id'],'shopId':_0x2a7694['shopId'],'shopName':_0x2a7694[_0x3cad8f(0x14c)][_0x3cad8f(0x147)],'shopUsername':_0x2a7694[_0x3cad8f(0x14c)][_0x3cad8f(0xd7)],'amount':_0x2a7694[_0x3cad8f(0x150)],'network':_0x2a7694[_0x3cad8f(0x136)],'status':_0x2a7694['status'],'txid':_0x2a7694[_0x3cad8f(0xd3)],'notes':_0x2a7694[_0x3cad8f(0xe1)],'periodFrom':_0x2a7694['periodFrom'],'periodTo':_0x2a7694[_0x3cad8f(0x9a)],'createdAt':_0x2a7694[_0x3cad8f(0x99)],'paidAt':_0x2a7694[_0x3cad8f(0x16e)]};}async[a35_0x4ce9b3(0x132)](_0x3addb9){const _0x3df67a=a35_0x4ce9b3;await database_1[_0x3df67a(0xdd)][_0x3df67a(0xcb)][_0x3df67a(0x119)]({'where':{'id':_0x3addb9}});}async[a35_0x4ce9b3(0xa4)](_0x29b75e){const _0x4dbcff=a35_0x4ce9b3,{page:_0x2b4736,limit:_0x572322,status:_0x2b9510,gateway:_0x4c5f9c,shopId:_0x1adcab,dateFrom:_0xc7a2e6,dateTo:_0x54ba03,search:_0x3f3aa5}=_0x29b75e,_0x29a8fb=(_0x2b4736-0x1)*_0x572322,_0x2ddbba={};_0x2b9510&&(_0x2ddbba[_0x4dbcff(0xdb)]=_0x2b9510['toUpperCase']());_0x4c5f9c&&(_0x2ddbba[_0x4dbcff(0xff)]=_0x4c5f9c['toLowerCase']());_0x2ddbba[_0x4dbcff(0xff)]=_0x2ddbba[_0x4dbcff(0xff)]?_0x2ddbba['gateway']:{'not':'test_gateway'};if(typeof _0x2ddbba[_0x4dbcff(0xff)]===_0x4dbcff(0xb8)&&_0x2ddbba[_0x4dbcff(0xff)]!==_0x4dbcff(0x146)){}else{if(typeof _0x2ddbba[_0x4dbcff(0xff)]===_0x4dbcff(0xb8)&&_0x2ddbba['gateway']==='test_gateway'){}else _0x2ddbba[_0x4dbcff(0xff)]={'not':'test_gateway'};}_0x1adcab&&(_0x2ddbba['shopId']=_0x1adcab);(_0xc7a2e6||_0x54ba03)&&(_0x2ddbba['createdAt']={},_0xc7a2e6&&(_0x2ddbba[_0x4dbcff(0x99)][_0x4dbcff(0x12e)]=new Date(_0xc7a2e6)),_0x54ba03&&(_0x2ddbba[_0x4dbcff(0x99)][_0x4dbcff(0x16c)]=new Date(_0x54ba03)));_0x3f3aa5&&(_0x2ddbba['OR']=[{'orderId':{'contains':_0x3f3aa5,'mode':_0x4dbcff(0x165)}},{'gatewayOrderId':{'contains':_0x3f3aa5,'mode':_0x4dbcff(0x165)}},{'customerEmail':{'contains':_0x3f3aa5,'mode':'insensitive'}},{'shop':{'name':{'contains':_0x3f3aa5,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x3f3aa5,'mode':_0x4dbcff(0x165)}}}]);const [_0x2a8d90,_0x27111a]=await Promise[_0x4dbcff(0xcc)]([database_1[_0x4dbcff(0xdd)][_0x4dbcff(0x145)][_0x4dbcff(0xbc)]({'where':_0x2ddbba,'skip':_0x29a8fb,'take':_0x572322,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x4dbcff(0xdd)][_0x4dbcff(0x145)][_0x4dbcff(0xaa)]({'where':_0x2ddbba})]);return{'payments':_0x2a8d90[_0x4dbcff(0x110)](_0x1980f0=>({'id':_0x1980f0['id'],'shopId':_0x1980f0[_0x4dbcff(0x139)],'gateway':_0x1980f0[_0x4dbcff(0xff)],'amount':_0x1980f0['amount'],'currency':_0x1980f0[_0x4dbcff(0xd9)],'status':_0x1980f0['status'],'orderId':_0x1980f0[_0x4dbcff(0xfe)],'gatewayOrderId':_0x1980f0['gatewayOrderId'],'customerEmail':_0x1980f0[_0x4dbcff(0x153)],'customerName':_0x1980f0[_0x4dbcff(0x172)],'customerCountry':_0x1980f0[_0x4dbcff(0xfb)],'customerIp':_0x1980f0['customerIp'],'customerUa':_0x1980f0[_0x4dbcff(0x13b)],'failureMessage':_0x1980f0[_0x4dbcff(0xe5)],'createdAt':_0x1980f0['createdAt'],'updatedAt':_0x1980f0[_0x4dbcff(0x9d)],'shop':_0x1980f0[_0x4dbcff(0x14c)]})),'pagination':{'page':_0x2b4736,'limit':_0x572322,'total':_0x27111a,'totalPages':Math[_0x4dbcff(0x101)](_0x27111a/_0x572322)}};}async[a35_0x4ce9b3(0x13e)](_0x2afe91){const _0x44ac63=a35_0x4ce9b3,_0x3328be=await database_1['default']['payment']['findUnique']({'where':{'id':_0x2afe91},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x3328be)return null;return{'id':_0x3328be['id'],'shopId':_0x3328be['shopId'],'gateway':_0x3328be[_0x44ac63(0xff)],'amount':_0x3328be[_0x44ac63(0x150)],'currency':_0x3328be[_0x44ac63(0xd9)],'status':_0x3328be[_0x44ac63(0xdb)],'orderId':_0x3328be[_0x44ac63(0xfe)],'gatewayOrderId':_0x3328be[_0x44ac63(0x15c)],'customerEmail':_0x3328be['customerEmail'],'customerName':_0x3328be[_0x44ac63(0x172)],'customerCountry':_0x3328be[_0x44ac63(0xfb)],'customerIp':_0x3328be[_0x44ac63(0xc8)],'customerUa':_0x3328be[_0x44ac63(0x13b)],'failureMessage':_0x3328be[_0x44ac63(0xe5)],'externalPaymentUrl':_0x3328be[_0x44ac63(0x108)],'successUrl':_0x3328be[_0x44ac63(0xcd)],'failUrl':_0x3328be[_0x44ac63(0x112)],'pendingUrl':_0x3328be[_0x44ac63(0x154)],'whiteUrl':_0x3328be['whiteUrl'],'createdAt':_0x3328be[_0x44ac63(0x99)],'updatedAt':_0x3328be[_0x44ac63(0x9d)],'shop':_0x3328be[_0x44ac63(0x14c)]};}async[a35_0x4ce9b3(0xd2)](_0x3876c3,_0x2c3066,_0x4ef99b,_0x3f7a3d){const _0x3172a8=a35_0x4ce9b3,_0x3d96db=await database_1['default'][_0x3172a8(0x15d)](async _0x56f217=>{const _0x30cfb0=_0x3172a8,_0x43f76a=await _0x56f217['payment'][_0x30cfb0(0x123)]({'where':{'id':_0x3876c3},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x43f76a)throw new Error('Payment\x20not\x20found');const _0x4da51=_0x43f76a[_0x30cfb0(0xdb)],_0x41d7fa=_0x2c3066[_0x30cfb0(0x10e)]();console[_0x30cfb0(0xf2)]('🔄\x20Admin\x20updating\x20payment\x20'+_0x3876c3+_0x30cfb0(0xda)+_0x4da51+_0x30cfb0(0xf0)+_0x41d7fa),console[_0x30cfb0(0xf2)](_0x30cfb0(0x124)+_0x43f76a[_0x30cfb0(0x14c)][_0x30cfb0(0xa1)]+_0x30cfb0(0x120));const _0x1f4a5c={'status':_0x41d7fa,'updatedAt':new Date(),'statusChangedBy':'admin','statusChangedAt':new Date()};_0x4ef99b&&(_0x1f4a5c[_0x30cfb0(0x100)]=_0x4ef99b);_0x41d7fa===_0x30cfb0(0x131)&&_0x3f7a3d&&(_0x1f4a5c['chargebackAmount']=_0x3f7a3d);let _0x47c35b=0x0,_0x267664=_0x43f76a['shop'][_0x30cfb0(0xa1)];if(_0x41d7fa===_0x30cfb0(0x166)&&_0x4da51!==_0x30cfb0(0x166)){_0x1f4a5c[_0x30cfb0(0x16e)]=new Date();const _0x1bb996=await currencyService_1[_0x30cfb0(0x10d)][_0x30cfb0(0x11f)](_0x43f76a[_0x30cfb0(0x150)],_0x43f76a['currency']);_0x1f4a5c[_0x30cfb0(0x128)]=_0x1bb996,_0x47c35b=_0x1bb996,_0x267664+=_0x1bb996,console[_0x30cfb0(0xf2)](_0x30cfb0(0x102)+_0x3876c3+_0x30cfb0(0x144)+_0x1bb996[_0x30cfb0(0xd6)](0x6)+'\x20USDT\x20to\x20balance');}else _0x4da51==='PAID'&&_0x41d7fa!==_0x30cfb0(0x166)&&(_0x43f76a['amountUSDT']&&(_0x47c35b=-_0x43f76a[_0x30cfb0(0x128)],_0x267664-=_0x43f76a['amountUSDT'],_0x1f4a5c[_0x30cfb0(0x128)]=null,console[_0x30cfb0(0xf2)](_0x30cfb0(0x102)+_0x3876c3+_0x30cfb0(0xc1)+_0x43f76a[_0x30cfb0(0x128)]['toFixed'](0x6)+'\x20USDT\x20from\x20balance')));if(_0x41d7fa===_0x30cfb0(0x131)){if(_0x4da51==='PAID'&&_0x43f76a[_0x30cfb0(0x128)]){}_0x3f7a3d&&_0x3f7a3d>0x0&&(_0x47c35b-=_0x3f7a3d,_0x267664-=_0x3f7a3d,console[_0x30cfb0(0xf2)](_0x30cfb0(0x105)+_0x3f7a3d[_0x30cfb0(0xd6)](0x6)+_0x30cfb0(0xbb)));}_0x41d7fa==='REFUND'&&_0x4da51==='PAID'&&console[_0x30cfb0(0xf2)]('🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance');const _0x2d805a=await _0x56f217[_0x30cfb0(0x145)][_0x30cfb0(0xa6)]({'where':{'id':_0x3876c3},'data':_0x1f4a5c,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x47c35b!==0x0&&(await _0x56f217[_0x30cfb0(0x14c)][_0x30cfb0(0xa6)]({'where':{'id':_0x43f76a[_0x30cfb0(0x139)]},'data':{'balance':_0x267664}}),console[_0x30cfb0(0xf2)](_0x30cfb0(0xa3)+_0x43f76a[_0x30cfb0(0x139)]+'\x20balance\x20updated:\x20'+_0x43f76a['shop'][_0x30cfb0(0xa1)][_0x30cfb0(0xd6)](0x6)+_0x30cfb0(0xf0)+_0x267664[_0x30cfb0(0xd6)](0x6)+_0x30cfb0(0x13a)+(_0x47c35b>0x0?'+':'')+_0x47c35b[_0x30cfb0(0xd6)](0x6)+')')),_0x2d805a;});return{'id':_0x3d96db['id'],'shopId':_0x3d96db[_0x3172a8(0x139)],'gateway':_0x3d96db[_0x3172a8(0xff)],'amount':_0x3d96db[_0x3172a8(0x150)],'currency':_0x3d96db[_0x3172a8(0xd9)],'status':_0x3d96db['status'],'orderId':_0x3d96db['orderId'],'gatewayOrderId':_0x3d96db[_0x3172a8(0x15c)],'customerEmail':_0x3d96db['customerEmail'],'customerName':_0x3d96db[_0x3172a8(0x172)],'customerCountry':_0x3d96db['customerCountry'],'customerIp':_0x3d96db[_0x3172a8(0xc8)],'customerUa':_0x3d96db[_0x3172a8(0x13b)],'failureMessage':_0x3d96db[_0x3172a8(0xe5)],'adminNotes':_0x3d96db[_0x3172a8(0x100)],'chargebackAmount':_0x3d96db[_0x3172a8(0x164)],'statusChangedBy':_0x3d96db['statusChangedBy'],'statusChangedAt':_0x3d96db[_0x3172a8(0x104)],'createdAt':_0x3d96db['createdAt'],'updatedAt':_0x3d96db[_0x3172a8(0x9d)],'shop':_0x3d96db['shop']};}async[a35_0x4ce9b3(0x9f)](_0x5788a5,_0x2e1361){const _0x31bb25=a35_0x4ce9b3,_0x40d6bf={..._0x2e1361};_0x2e1361[_0x31bb25(0x158)]&&(_0x40d6bf[_0x31bb25(0x158)]=await bcryptjs_1[_0x31bb25(0xdd)]['hash'](_0x2e1361['password'],0xc));_0x2e1361['fullName']&&(_0x40d6bf['name']=_0x2e1361['fullName'],delete _0x40d6bf[_0x31bb25(0xe2)]);_0x2e1361[_0x31bb25(0xae)]&&(_0x40d6bf[_0x31bb25(0x106)]=_0x2e1361[_0x31bb25(0xae)],delete _0x40d6bf['telegramId']);_0x2e1361[_0x31bb25(0x9e)]&&(_0x40d6bf[_0x31bb25(0x13f)]=_0x2e1361['merchantUrl'],delete _0x40d6bf['merchantUrl']);_0x2e1361['gateways']&&(_0x40d6bf[_0x31bb25(0x171)]=JSON[_0x31bb25(0x151)](_0x2e1361[_0x31bb25(0x95)]),delete _0x40d6bf[_0x31bb25(0x95)]);_0x2e1361[_0x31bb25(0xea)]&&(_0x40d6bf[_0x31bb25(0xea)]=JSON[_0x31bb25(0x151)](_0x2e1361['gatewaySettings']),delete _0x40d6bf[_0x31bb25(0xea)]);_0x2e1361[_0x31bb25(0xac)]&&(_0x2e1361['wallets'][_0x31bb25(0xb1)]!==undefined&&(_0x40d6bf[_0x31bb25(0xb1)]=_0x2e1361[_0x31bb25(0xac)][_0x31bb25(0xb1)]||null),_0x2e1361[_0x31bb25(0xac)][_0x31bb25(0xf5)]!==undefined&&(_0x40d6bf[_0x31bb25(0xf5)]=_0x2e1361[_0x31bb25(0xac)]['usdtTrcWallet']||null),_0x2e1361[_0x31bb25(0xac)][_0x31bb25(0x16f)]!==undefined&&(_0x40d6bf[_0x31bb25(0x16f)]=_0x2e1361[_0x31bb25(0xac)][_0x31bb25(0x16f)]||null),_0x2e1361[_0x31bb25(0xac)]['usdcPolygonWallet']!==undefined&&(_0x40d6bf['usdcPolygonWallet']=_0x2e1361[_0x31bb25(0xac)]['usdcPolygonWallet']||null),delete _0x40d6bf[_0x31bb25(0xac)]);const _0x1e1025=await database_1[_0x31bb25(0xdd)][_0x31bb25(0x14c)][_0x31bb25(0xa6)]({'where':{'id':_0x5788a5},'data':_0x40d6bf,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x1e1025['id'],'fullName':_0x1e1025[_0x31bb25(0x147)],'username':_0x1e1025[_0x31bb25(0xd7)],'telegramId':_0x1e1025[_0x31bb25(0x106)],'merchantUrl':_0x1e1025['shopUrl'],'gateways':_0x1e1025[_0x31bb25(0x171)]?JSON[_0x31bb25(0xe4)](_0x1e1025[_0x31bb25(0x171)]):null,'gatewaySettings':_0x1e1025[_0x31bb25(0xea)]?JSON[_0x31bb25(0xe4)](_0x1e1025['gatewaySettings']):null,'publicKey':_0x1e1025['publicKey'],'wallets':{'usdtPolygonWallet':_0x1e1025[_0x31bb25(0xb1)],'usdtTrcWallet':_0x1e1025[_0x31bb25(0xf5)],'usdtErcWallet':_0x1e1025[_0x31bb25(0x16f)],'usdcPolygonWallet':_0x1e1025[_0x31bb25(0x12f)]},'status':_0x1e1025['status'],'createdAt':_0x1e1025[_0x31bb25(0x99)]};}async['suspendUser'](_0x35e527){const _0x148921=a35_0x4ce9b3,_0x534c5d=await database_1['default']['shop'][_0x148921(0xa6)]({'where':{'id':_0x35e527},'data':{'status':_0x148921(0x141)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x534c5d['id'],'fullName':_0x534c5d[_0x148921(0x147)],'username':_0x534c5d[_0x148921(0xd7)],'telegramId':_0x534c5d[_0x148921(0x106)],'merchantUrl':_0x534c5d[_0x148921(0x13f)],'gateways':_0x534c5d[_0x148921(0x171)]?JSON[_0x148921(0xe4)](_0x534c5d[_0x148921(0x171)]):null,'gatewaySettings':_0x534c5d[_0x148921(0xea)]?JSON[_0x148921(0xe4)](_0x534c5d['gatewaySettings']):null,'publicKey':_0x534c5d[_0x148921(0xec)],'wallets':{'usdtPolygonWallet':_0x534c5d['usdtPolygonWallet'],'usdtTrcWallet':_0x534c5d[_0x148921(0xf5)],'usdtErcWallet':_0x534c5d[_0x148921(0x16f)],'usdcPolygonWallet':_0x534c5d[_0x148921(0x12f)]},'status':_0x534c5d['status'],'createdAt':_0x534c5d[_0x148921(0x99)]};}async[a35_0x4ce9b3(0xb0)](_0x29340c){const _0x339eef=a35_0x4ce9b3,_0x101a77=await database_1[_0x339eef(0xdd)]['shop']['update']({'where':{'id':_0x29340c},'data':{'status':_0x339eef(0x13c)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x101a77['id'],'fullName':_0x101a77[_0x339eef(0x147)],'username':_0x101a77['username'],'telegramId':_0x101a77[_0x339eef(0x106)],'merchantUrl':_0x101a77[_0x339eef(0x13f)],'gateways':_0x101a77[_0x339eef(0x171)]?JSON[_0x339eef(0xe4)](_0x101a77[_0x339eef(0x171)]):null,'gatewaySettings':_0x101a77['gatewaySettings']?JSON[_0x339eef(0xe4)](_0x101a77[_0x339eef(0xea)]):null,'publicKey':_0x101a77['publicKey'],'wallets':{'usdtPolygonWallet':_0x101a77[_0x339eef(0xb1)],'usdtTrcWallet':_0x101a77[_0x339eef(0xf5)],'usdtErcWallet':_0x101a77[_0x339eef(0x16f)],'usdcPolygonWallet':_0x101a77[_0x339eef(0x12f)]},'status':_0x101a77[_0x339eef(0xdb)],'createdAt':_0x101a77[_0x339eef(0x99)]};}async[a35_0x4ce9b3(0xd1)](_0x4e6cb6){const _0x5b3606=a35_0x4ce9b3,{page:_0x344cc5,limit:_0x5559e7,status:_0x59dcce}=_0x4e6cb6,_0x1e7a9d=(_0x344cc5-0x1)*_0x5559e7,_0x26d0a3={};_0x59dcce&&(_0x26d0a3[_0x5b3606(0xdb)]=_0x59dcce[_0x5b3606(0x10e)]());const [_0x248db1,_0x55de8a]=await Promise[_0x5b3606(0xcc)]([database_1['default'][_0x5b3606(0x14c)][_0x5b3606(0xbc)]({'where':_0x26d0a3,'skip':_0x1e7a9d,'take':_0x5559e7,'orderBy':{'createdAt':_0x5b3606(0x96)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1['default']['shop'][_0x5b3606(0xaa)]({'where':_0x26d0a3})]);return{'users':_0x248db1[_0x5b3606(0x110)](_0x2f1c27=>({'id':_0x2f1c27['id'],'fullName':_0x2f1c27[_0x5b3606(0x147)],'username':_0x2f1c27[_0x5b3606(0xd7)],'telegramId':_0x2f1c27[_0x5b3606(0x106)],'merchantUrl':_0x2f1c27[_0x5b3606(0x13f)],'gateways':_0x2f1c27[_0x5b3606(0x171)]?JSON[_0x5b3606(0xe4)](_0x2f1c27[_0x5b3606(0x171)]):null,'gatewaySettings':_0x2f1c27[_0x5b3606(0xea)]?JSON[_0x5b3606(0xe4)](_0x2f1c27['gatewaySettings']):null,'publicKey':_0x2f1c27[_0x5b3606(0xec)],'wallets':{'usdtPolygonWallet':_0x2f1c27['usdtPolygonWallet'],'usdtTrcWallet':_0x2f1c27['usdtTrcWallet'],'usdtErcWallet':_0x2f1c27[_0x5b3606(0x16f)],'usdcPolygonWallet':_0x2f1c27[_0x5b3606(0x12f)]},'status':_0x2f1c27[_0x5b3606(0xdb)],'createdAt':_0x2f1c27[_0x5b3606(0x99)]})),'pagination':{'page':_0x344cc5,'limit':_0x5559e7,'total':_0x55de8a,'totalPages':Math['ceil'](_0x55de8a/_0x5559e7)}};}async[a35_0x4ce9b3(0xd5)](_0x43efea){const _0x540c2a=a35_0x4ce9b3,_0x5b3164=await database_1['default']['shop'][_0x540c2a(0x123)]({'where':{'id':_0x43efea},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x5b3164)return null;return{'id':_0x5b3164['id'],'fullName':_0x5b3164['name'],'username':_0x5b3164['username'],'telegramId':_0x5b3164['telegram'],'merchantUrl':_0x5b3164[_0x540c2a(0x13f)],'gateways':_0x5b3164[_0x540c2a(0x171)]?JSON[_0x540c2a(0xe4)](_0x5b3164[_0x540c2a(0x171)]):null,'gatewaySettings':_0x5b3164[_0x540c2a(0xea)]?JSON[_0x540c2a(0xe4)](_0x5b3164[_0x540c2a(0xea)]):null,'publicKey':_0x5b3164[_0x540c2a(0xec)],'wallets':{'usdtPolygonWallet':_0x5b3164[_0x540c2a(0xb1)],'usdtTrcWallet':_0x5b3164[_0x540c2a(0xf5)],'usdtErcWallet':_0x5b3164['usdtErcWallet'],'usdcPolygonWallet':_0x5b3164['usdcPolygonWallet']},'status':_0x5b3164[_0x540c2a(0xdb)],'createdAt':_0x5b3164[_0x540c2a(0x99)]};}async['createUser'](_0x33c15f){const _0x34995c=a35_0x4ce9b3,{fullName:_0x29e877,username:_0x3b812c,password:_0x53c95f,telegramId:_0x3e09b4,merchantUrl:_0x333ca5,gateways:_0x2cd1f2,gatewaySettings:_0x7d1f6b,wallets:_0x3d7823}=_0x33c15f,_0x4647a7=await database_1[_0x34995c(0xdd)][_0x34995c(0x14c)]['findUnique']({'where':{'username':_0x3b812c}});if(_0x4647a7)throw new Error('Username\x20already\x20exists');if(_0x3e09b4){const _0x1048b4=await database_1[_0x34995c(0xdd)][_0x34995c(0x14c)]['findUnique']({'where':{'telegram':_0x3e09b4}});if(_0x1048b4)throw new Error('Telegram\x20username\x20already\x20exists');}const _0x2f9695=await bcryptjs_1[_0x34995c(0xdd)][_0x34995c(0x156)](_0x53c95f,0xc),_0x251e74=_0x34995c(0x16a)+crypto_1['default'][_0x34995c(0xf3)](0x20)[_0x34995c(0x13d)](_0x34995c(0x169)),_0x25e4d8=_0x34995c(0xd8)+crypto_1[_0x34995c(0xdd)][_0x34995c(0xf3)](0x20)[_0x34995c(0x13d)]('hex'),_0x4dcb52=await database_1[_0x34995c(0xdd)][_0x34995c(0x14c)][_0x34995c(0x127)]({'data':{'name':_0x29e877,'username':_0x3b812c,'password':_0x2f9695,'telegram':_0x3e09b4,'shopUrl':_0x333ca5,'paymentGateways':_0x2cd1f2?JSON['stringify'](_0x2cd1f2):null,'gatewaySettings':_0x7d1f6b?JSON[_0x34995c(0x151)](_0x7d1f6b):null,'usdtPolygonWallet':_0x3d7823?.[_0x34995c(0xb1)]||null,'usdtTrcWallet':_0x3d7823?.[_0x34995c(0xf5)]||null,'usdtErcWallet':_0x3d7823?.[_0x34995c(0x16f)]||null,'usdcPolygonWallet':_0x3d7823?.['usdcPolygonWallet']||null,'publicKey':_0x251e74,'secretKey':_0x25e4d8,'status':_0x34995c(0x13c)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4dcb52['id'],'fullName':_0x4dcb52[_0x34995c(0x147)],'username':_0x4dcb52[_0x34995c(0xd7)],'telegramId':_0x4dcb52[_0x34995c(0x106)],'merchantUrl':_0x4dcb52[_0x34995c(0x13f)],'gateways':_0x4dcb52[_0x34995c(0x171)]?JSON[_0x34995c(0xe4)](_0x4dcb52[_0x34995c(0x171)]):null,'gatewaySettings':_0x4dcb52[_0x34995c(0xea)]?JSON['parse'](_0x4dcb52[_0x34995c(0xea)]):null,'publicKey':_0x4dcb52[_0x34995c(0xec)],'wallets':{'usdtPolygonWallet':_0x4dcb52[_0x34995c(0xb1)],'usdtTrcWallet':_0x4dcb52[_0x34995c(0xf5)],'usdtErcWallet':_0x4dcb52['usdtErcWallet'],'usdcPolygonWallet':_0x4dcb52[_0x34995c(0x12f)]},'status':_0x4dcb52[_0x34995c(0xdb)],'createdAt':_0x4dcb52[_0x34995c(0x99)]};}async[a35_0x4ce9b3(0x134)](_0x5cc740){const _0xe948e2=a35_0x4ce9b3;await database_1['default'][_0xe948e2(0x14c)]['delete']({'where':{'id':_0x5cc740}});}}exports[a35_0x4ce9b3(0x16d)]=AdminService;