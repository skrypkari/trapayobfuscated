'use strict';const a35_0x2917c7=a35_0x46c6;function a35_0x46c6(_0x522f49,_0x4b5839){const _0x427352=a35_0x4273();return a35_0x46c6=function(_0x46c693,_0x22841e){_0x46c693=_0x46c693-0xfb;let _0x181d3b=_0x427352[_0x46c693];return _0x181d3b;},a35_0x46c6(_0x522f49,_0x4b5839);}(function(_0x4ad967,_0x5c1422){const _0x25d0b8=a35_0x46c6,_0x3a6744=_0x4ad967();while(!![]){try{const _0x34f397=-parseInt(_0x25d0b8(0x19e))/0x1+-parseInt(_0x25d0b8(0x117))/0x2*(-parseInt(_0x25d0b8(0x1ce))/0x3)+parseInt(_0x25d0b8(0x16d))/0x4+parseInt(_0x25d0b8(0x1ae))/0x5*(-parseInt(_0x25d0b8(0x134))/0x6)+-parseInt(_0x25d0b8(0x1d5))/0x7+-parseInt(_0x25d0b8(0x1d1))/0x8+-parseInt(_0x25d0b8(0x13d))/0x9;if(_0x34f397===_0x5c1422)break;else _0x3a6744['push'](_0x3a6744['shift']());}catch(_0x9ab17b){_0x3a6744['push'](_0x3a6744['shift']());}}}(a35_0x4273,0xbb73b));var __importDefault=this&&this[a35_0x2917c7(0x184)]||function(_0x38e01e){const _0x5f4ed1=a35_0x2917c7;return _0x38e01e&&_0x38e01e[_0x5f4ed1(0x106)]?_0x38e01e:{'default':_0x38e01e};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['AdminService']=void 0x0;function a35_0x4273(){const _0x2faedf=['dateFrom',',\x20successful:\x20','availableBalance',':\x20commission\x20=\x20','48237xjlCLs','SUSPENDED','\x27\x20not\x20found.\x20Available\x20gateways:\x20','3057328DBvVEW','\x20for\x20shop\x20','getMonth','\x20\x20\x20üåê\x20IP:\x20','1668926XpOXvx','periodFrom','\x20merchants,\x20','amount','createdAt','telegram','üí∞\x20[PAYOUT]\x20Merchant\x20','üìä\x20Gateway\x20filter\x20applied:','status','üìä\x20Calculating\x20payout\x20statistics...','averageCommissionRate','ACTIVE','üìä\x20Sorting\x20payments\x20by\x20','\x20USDT\x20(after\x20payouts)','network','\x20USDT,\x20Requested:\x20','customerUa','üìä\x20Final\x20WHERE\x20conditions:','getAllPayouts','Telegram\x20username\x20already\x20exists','name','default','shopId','\x20USDT\x20(same\x20as\x20awaiting)','orderId','üí∞\x20Found\x20','year','generateDailyStatistics','‚úÖ\x20Customer\x20data\x20updated\x20for\x20payment\x20','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','üí∏\x20CHARGEBACK\x20penalty:\x20-','hex','pk_','./currencyService','convertToUSDT','dailyPayments','revenue','payout','join','\x20\x20\x20üí∞\x20Total\x20payout:\x20','turnoverUSDT','statusChangedAt','updatedAt','activateUser','chargebackAmount','parse','\x20\x20\x20Transaction\x20hash:\x20','\x27\x20to\x20name\x20\x27','thisMonth','length','deletePayout','test_gateway','üìÖ\x20Period:\x20','customerCountry','polygon_usdc','wallet','gatewaySettings','values','toString','üìä\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','üìã\x20Found\x20','__esModule','2020-01-01','\x20\x20\x20üîç\x20Calculated\x20after\x20commission:\x20','ceil','üìä\x20Getting\x20merchant\x20statistics\x20with\x20filters:','totalAmountUSDT','‚ö†Ô∏è\x20Requested\x20gateway\x20\x27','randomBytes','gatewayOrderId','merchantEarnings','üí∞\x20[PAYOUT]\x20Gateway\x20','push','\x20\x20\x20üîç\x20Raw\x20balance\x20sum:\x20','paidOutUSDT','üìä\x20Total\x20payments\x20(including\x20failed):\x20','balance','groupBy','126zyVXQY','periodTo','usdtTrcWallet','CoinToPay','update','sort','paymentsCount','toFixed','commissionUSDT','CHARGEBACK','\x20\x20\x20üè™\x20Gateway\x20earnings:\x20','getSystemStatistics','asc','\x20USDT\x20(with\x20commission\x20deducted)','round','üí±\x20Currency\x20filter\x20applied:\x20','fullName','\x20payments)','üìä\x20Available\x20gateways\x20in\x20database:','log','totalPaidOut','\x20USDT\x20(+','\x20paid\x20payments\x20for\x20analysis','usdtPolygonWallet','\x20USDT\x20(for\x20reference\x20only)','\x20\x20\x20Total\x20paid\x20out:\x20','üí∞\x20Shop\x20','localeCompare','\x20\x20\x20üí∞\x20Total\x20turnover:\x20','21738qWKQNS','getDate','period','payment','getGatewayDisplayName','custom','stringify','polygon','notes','341883SNWyEu','shopUrl','usdcPolygonWallet','dailyRevenue','updateCustomerData','currency','‚úÖ\x20Using\x20gateway\x20filter:\x20\x27','desc','\x20\x20\x20üìÖ\x20This\x20month:\x20','aggregate','getUserById','amountAfterCommissionUSDT','failureMessage','\x20\x20\x20Current\x20balance:\x20','toISOString','\x20\x20\x20‚úÖ\x20Using\x20actual\x20balance\x20from\x20DB:\x20','commission','_count','totalCommissionRate','error','gatewayEarnings','split','customerName','shop','some','\x20USDT\x20(','customerEmail','erc20','findMany','\x20to\x20','password','30d','\x20USDT)','sk_','../types/gateway','usdtErcWallet','includes','Username\x20already\x20exists','KLYME\x20GB','\x20\x20\x20üåç\x20Country:\x20','\x20status:\x20','crypto','paymentGateways','getMerchantsAwaitingPayout','totalTurnover','username','üí≥\x20Payout\x20wallet\x20for\x20','\x20merchants\x20with\x20positive\x20balance','5546428EzCJir','forEach','week','\x20USDT\x20total\x20(based\x20on\x20actual\x20balances)','count','telegramId','turnover','‚úÖ\x20Payout\x20created:\x20','getTime','totalPayments','üí∞\x20Creating\x20payout\x20for\x20shop\x20','\x20USDT\x20from\x20balance','toLowerCase','whiteUrl','Shop\x20not\x20found','month','txid','currencyService','\x27\x20(from\x20\x27','findFirst','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','\x20\x20\x20üñ•Ô∏è\x20User\x20Agent:\x20','map','__importDefault','üìä\x20Merchants\x20awaiting\x20payout:\x20','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','findUnique','üìä\x20Getting\x20payments\x20with\x20filters:','trc20','üîÑ\x20Converted\x20gateway\x20name\x20\x27','üìã\x20Getting\x20merchants\x20selection\x20list...','amountUSDT','üí∞\x20Current\x20shop\x20balance:\x20','successUrl','delete','dateTo','Plisio','create','COMPLETED','PAID','üîÑ\x20Admin\x20updating\x20payment\x20','gateways','\x20USDT','merchantUrl','publicKey','\x20USDT\x20(total\x20paid\x20to\x20merchants)','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','statusChangedBy','\x20\x20\x20Balance:\x20','936980tuEsCa','entries','$transaction','reduce','KLYME\x20DE','toUpperCase','gte','awaitingPayout','averageCheckUSDT','üîÑ\x20Updating\x20customer\x20data\x20for\x20payment\x20','bcryptjs','totalPayout','merchantEarningsUSDT','Error\x20processing\x20payment\x20','date','set','50mxtxIS','Payment\x20not\x20found','_sum','getMerchantStatistics','\x20USDT\x20(-','Test\x20Gateway','gateway','paidAt','getPayoutById','adminNotes','../config/database','\x20\x20\x20üìä\x20Total\x20payments:\x20','üìä\x20Merchant\x20statistics\x20calculated:','\x20->\x20','\x20USDT\x20(without\x20commission)','REFUND','90d','totalAmountAfterCommissionUSDT','not\x20specified','üîÑ\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','insensitive','not\x20set','wallets','getAllUsers','Insufficient\x20balance.\x20Available:\x20','customerIp','all','\x20balance\x20updated:'];a35_0x4273=function(){return _0x2faedf;};return a35_0x4273();}const database_1=__importDefault(require(a35_0x2917c7(0x1b8))),bcryptjs_1=__importDefault(require(a35_0x2917c7(0x1a8))),crypto_1=__importDefault(require(a35_0x2917c7(0x166))),currencyService_1=require(a35_0x2917c7(0x1f6)),gateway_1=require(a35_0x2917c7(0x15f));class AdminService{async['getPayoutStats'](){const _0x4627ae=a35_0x2917c7;console[_0x4627ae(0x12a)](_0x4627ae(0x1de));const _0x44dc9c=await database_1[_0x4627ae(0x1ea)]['shop'][_0x4627ae(0x146)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':'ACTIVE'}}),_0x36677c=await this[_0x4627ae(0x168)]({'page':0x1,'limit':0x3e8}),_0x45ae24=new Date(),_0x341448=new Date(_0x45ae24['getFullYear'](),_0x45ae24['getMonth'](),0x1),_0x627efc=new Date(_0x45ae24['getFullYear'](),_0x45ae24[_0x4627ae(0x1d3)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x3f581e=await database_1[_0x4627ae(0x1ea)]['payout'][_0x4627ae(0x146)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x341448,'lte':_0x627efc},'status':_0x4627ae(0x193)}}),_0x1c959b=_0x44dc9c[_0x4627ae(0x1b0)]['totalPaidOut']||0x0,_0x16bd5a=_0x36677c['summary']['totalAmountAfterCommissionUSDT'],_0x590b53=_0x3f581e[_0x4627ae(0x1b0)][_0x4627ae(0x1d8)]||0x0,_0x23a181={'totalPayout':Math['round'](_0x1c959b*0x64)/0x64,'awaitingPayout':Math[_0x4627ae(0x125)](_0x16bd5a*0x64)/0x64,'thisMonth':Math[_0x4627ae(0x125)](_0x590b53*0x64)/0x64,'availableBalance':Math[_0x4627ae(0x125)](_0x16bd5a*0x64)/0x64};return console['log']('üìä\x20Payout\x20statistics\x20calculated:'),console['log'](_0x4627ae(0x1fc)+_0x23a181[_0x4627ae(0x1a9)]+_0x4627ae(0x19a)),console['log']('\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20'+_0x23a181[_0x4627ae(0x1a5)]+_0x4627ae(0x124)),console['log']('\x20\x20\x20üíµ\x20Available\x20balance:\x20'+_0x23a181[_0x4627ae(0x1cc)]+_0x4627ae(0x1ec)),console[_0x4627ae(0x12a)](_0x4627ae(0x145)+_0x23a181[_0x4627ae(0x205)]+_0x4627ae(0x197)),console[_0x4627ae(0x12a)](_0x4627ae(0x112)+(_0x44dc9c[_0x4627ae(0x1b0)][_0x4627ae(0x115)]||0x0)[_0x4627ae(0x11e)](0x2)+_0x4627ae(0x1bc)),console[_0x4627ae(0x12a)]('\x20\x20\x20üìä\x20Commission\x20difference:\x20'+((_0x44dc9c['_sum'][_0x4627ae(0x115)]||0x0)-_0x16bd5a)['toFixed'](0x2)+'\x20USDT'),_0x23a181;}async[a35_0x2917c7(0x141)](_0x9a9d93,_0x25cb02){const _0x5c95e1=a35_0x2917c7;console['log'](_0x5c95e1(0x1a7)+_0x9a9d93+':',_0x25cb02);const _0x3205e4=await database_1['default'][_0x5c95e1(0x137)][_0x5c95e1(0x187)]({'where':{'id':_0x9a9d93},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x3205e4)throw new Error('Payment\x20not\x20found');const _0x25da25={};_0x25cb02[_0x5c95e1(0xfe)]!==undefined&&(_0x25da25[_0x5c95e1(0xfe)]=_0x25cb02[_0x5c95e1(0xfe)]||null);_0x25cb02['customerIp']!==undefined&&(_0x25da25[_0x5c95e1(0x1c7)]=_0x25cb02[_0x5c95e1(0x1c7)]||null);_0x25cb02[_0x5c95e1(0x1e5)]!==undefined&&(_0x25da25[_0x5c95e1(0x1e5)]=_0x25cb02[_0x5c95e1(0x1e5)]||null);const _0x299067=await database_1[_0x5c95e1(0x1ea)][_0x5c95e1(0x137)][_0x5c95e1(0x11b)]({'where':{'id':_0x9a9d93},'data':{..._0x25da25,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x5c95e1(0x12a)](_0x5c95e1(0x1f1)+_0x9a9d93),console[_0x5c95e1(0x12a)](_0x5c95e1(0x164)+_0x3205e4[_0x5c95e1(0xfe)]+_0x5c95e1(0x1bb)+_0x299067['customerCountry']),console['log'](_0x5c95e1(0x1d4)+_0x3205e4[_0x5c95e1(0x1c7)]+_0x5c95e1(0x1bb)+_0x299067[_0x5c95e1(0x1c7)]),console[_0x5c95e1(0x12a)](_0x5c95e1(0x182)+(_0x3205e4['customerUa']?_0x5c95e1(0x1ad):_0x5c95e1(0x1c3))+_0x5c95e1(0x1bb)+(_0x299067['customerUa']?_0x5c95e1(0x1ad):_0x5c95e1(0x1c3))),_0x299067;}async[a35_0x2917c7(0x122)](_0x2c5e48){const _0x5e873a=a35_0x2917c7,_0x2321bd=new Date();let _0x15471d;switch(_0x2c5e48){case'7d':_0x15471d=new Date(_0x2321bd[_0x5e873a(0x175)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x5e873a(0x15c):_0x15471d=new Date(_0x2321bd['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x5e873a(0x1be):_0x15471d=new Date(_0x2321bd[_0x5e873a(0x175)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x5e873a(0x1c8):const _0x40f052=await database_1[_0x5e873a(0x1ea)][_0x5e873a(0x137)][_0x5e873a(0x180)]({'where':{'gateway':{'not':'test_gateway'}},'orderBy':{'createdAt':_0x5e873a(0x123)},'select':{'createdAt':!![]}});_0x15471d=_0x40f052?_0x40f052[_0x5e873a(0x1d9)]:new Date(_0x5e873a(0x107)),console[_0x5e873a(0x12a)]('üìÖ\x20Period\x20\x27all\x27:\x20Using\x20start\x20date\x20from\x20first\x20payment:\x20'+_0x15471d[_0x5e873a(0x14b)]());break;default:_0x15471d=new Date(_0x2321bd[_0x5e873a(0x175)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x4d22fc,_0x24bb5b,_0x30f132,_0x59a815,_0x358514,_0x32496a,_0x110ab1]=await Promise[_0x5e873a(0x1c8)]([database_1[_0x5e873a(0x1ea)][_0x5e873a(0x154)][_0x5e873a(0x171)](),database_1['default']['shop'][_0x5e873a(0x171)]({'where':{'status':'ACTIVE'}}),database_1[_0x5e873a(0x1ea)][_0x5e873a(0x137)][_0x5e873a(0x171)]({'where':{'createdAt':{'gte':_0x15471d},'gateway':{'not':'test_gateway'}}}),database_1[_0x5e873a(0x1ea)][_0x5e873a(0x137)][_0x5e873a(0x171)]({'where':{'status':_0x5e873a(0x194),'createdAt':{'gte':_0x15471d},'gateway':{'not':_0x5e873a(0xfc)}}}),database_1[_0x5e873a(0x1ea)][_0x5e873a(0x137)][_0x5e873a(0x159)]({'where':{'status':'PAID','createdAt':{'gte':_0x15471d},'gateway':{'not':_0x5e873a(0xfc)}},'select':{'amount':!![],'currency':!![]}}),database_1[_0x5e873a(0x1ea)][_0x5e873a(0x137)]['findMany']({'where':{'gateway':{'not':_0x5e873a(0xfc)}},'take':0xa,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x5e873a(0x1ea)][_0x5e873a(0x137)]['findMany']({'where':{'createdAt':{'gte':_0x15471d},'gateway':{'not':_0x5e873a(0xfc)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x212aae=0x0;for(const _0x23526e of _0x358514){const _0xa88a83=await currencyService_1[_0x5e873a(0x17e)][_0x5e873a(0x1f7)](_0x23526e[_0x5e873a(0x1d8)],_0x23526e['currency']);_0x212aae+=_0xa88a83;}const _0x3cf845=this['generateDailyStatistics'](_0x110ab1,_0x15471d,_0x2321bd),_0x74701b=_0x30f132>0x0?_0x59a815/_0x30f132*0x64:0x0;return{'totalShops':_0x4d22fc,'activeShops':_0x24bb5b,'totalPayments':_0x30f132,'successfulPayments':_0x59a815,'totalRevenue':Math['round'](_0x212aae*0x64)/0x64,'conversionRate':Math[_0x5e873a(0x125)](_0x74701b*0x64)/0x64,'dailyRevenue':_0x3cf845[_0x5e873a(0x140)],'dailyPayments':_0x3cf845[_0x5e873a(0x1f8)],'recentPayments':_0x32496a['map'](_0x62b654=>({'id':_0x62b654['id'],'amount':_0x62b654[_0x5e873a(0x1d8)],'currency':_0x62b654[_0x5e873a(0x142)],'status':_0x62b654[_0x5e873a(0x1dd)],'gateway':_0x62b654[_0x5e873a(0x1b4)],'shop':_0x62b654[_0x5e873a(0x154)],'createdAt':_0x62b654[_0x5e873a(0x1d9)]}))};}async[a35_0x2917c7(0x1b1)](_0x21142f){const _0x35eeea=a35_0x2917c7;console['log'](_0x35eeea(0x10a),_0x21142f);let _0x54c015,_0x52b1b8=new Date();if(_0x21142f[_0x35eeea(0x136)]===_0x35eeea(0x139)&&_0x21142f[_0x35eeea(0x1ca)]&&_0x21142f[_0x35eeea(0x190)])_0x54c015=new Date(_0x21142f[_0x35eeea(0x1ca)]),_0x52b1b8=new Date(_0x21142f[_0x35eeea(0x190)]);else{const _0x454476=new Date();switch(_0x21142f[_0x35eeea(0x136)]){case _0x35eeea(0x16f):_0x54c015=new Date(_0x454476['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x35eeea(0x17c):_0x54c015=new Date(_0x454476[_0x35eeea(0x175)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x35eeea(0x1ef):_0x54c015=new Date(_0x454476[_0x35eeea(0x175)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x35eeea(0x1c8):default:_0x54c015=new Date(_0x35eeea(0x107));break;}}console[_0x35eeea(0x12a)](_0x35eeea(0xfd)+_0x54c015[_0x35eeea(0x14b)]()+_0x35eeea(0x15a)+_0x52b1b8[_0x35eeea(0x14b)]());const _0x51a102={'status':'PAID','gateway':{'not':_0x35eeea(0xfc)},'paidAt':{'gte':_0x54c015,'lte':_0x52b1b8}};_0x21142f[_0x35eeea(0x1eb)]&&(_0x51a102[_0x35eeea(0x1eb)]=_0x21142f[_0x35eeea(0x1eb)]);const _0x416a41=await database_1[_0x35eeea(0x1ea)]['payment'][_0x35eeea(0x159)]({'where':_0x51a102,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x35eeea(0x12a)](_0x35eeea(0x1ee)+_0x416a41[_0x35eeea(0x206)]+_0x35eeea(0x12d));const _0x5d140f={'gateway':{'not':_0x35eeea(0xfc)},'createdAt':{'gte':_0x54c015,'lte':_0x52b1b8}};_0x21142f[_0x35eeea(0x1eb)]&&(_0x5d140f['shopId']=_0x21142f[_0x35eeea(0x1eb)]);const _0x5b5efc=await database_1[_0x35eeea(0x1ea)]['payment'][_0x35eeea(0x171)]({'where':_0x5d140f});console[_0x35eeea(0x12a)](_0x35eeea(0x114)+_0x5b5efc+_0x35eeea(0x1cb)+_0x416a41['length']);let _0x2837e5=0x0,_0x598fb7=0x0,_0xf68f32=0x0;const _0x3c168a={},_0x69ea11={},_0x14e38a={};for(const _0x447139 of _0x416a41){try{const _0x3c431b=await currencyService_1[_0x35eeea(0x17e)]['convertToUSDT'](_0x447139[_0x35eeea(0x1d8)],_0x447139['currency']);let _0x1629d5={};if(_0x447139[_0x35eeea(0x154)]['gatewaySettings'])try{_0x1629d5=JSON[_0x35eeea(0x202)](_0x447139[_0x35eeea(0x154)][_0x35eeea(0x101)]);}catch(_0x8b3f40){console[_0x35eeea(0x150)](_0x35eeea(0x1f2)+_0x447139[_0x35eeea(0x1eb)]+':',_0x8b3f40);}let _0x115b1c={},_0x41e66e=0xa;for(const [_0x2f5971,_0x23570c]of Object['entries'](_0x1629d5)){if(_0x2f5971[_0x35eeea(0x179)]()===_0x447139[_0x35eeea(0x1b4)]['toLowerCase']()){_0x115b1c=_0x23570c,_0x41e66e=_0x23570c[_0x35eeea(0x14d)]||0xa;break;}}const _0x3362f2=_0x3c431b*(_0x41e66e/0x64),_0x49ec57=_0x3c431b-_0x3362f2;_0x2837e5+=_0x3c431b,_0x598fb7+=_0x49ec57,_0xf68f32+=_0x3362f2;!_0x3c168a[_0x447139['gateway']]&&(_0x3c168a[_0x447139[_0x35eeea(0x1b4)]]={'gateway':_0x447139['gateway'],'gatewayDisplayName':this[_0x35eeea(0x138)](_0x447139['gateway']),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x3c168a[_0x447139[_0x35eeea(0x1b4)]][_0x35eeea(0x11d)]++,_0x3c168a[_0x447139[_0x35eeea(0x1b4)]][_0x35eeea(0x1fd)]+=_0x3c431b,_0x3c168a[_0x447139['gateway']][_0x35eeea(0x11f)]+=_0x3362f2,_0x3c168a[_0x447139[_0x35eeea(0x1b4)]]['merchantEarningsUSDT']+=_0x49ec57,_0x3c168a[_0x447139[_0x35eeea(0x1b4)]][_0x35eeea(0x14f)]+=_0x41e66e;!_0x21142f[_0x35eeea(0x1eb)]&&(!_0x69ea11[_0x447139[_0x35eeea(0x1eb)]]&&(_0x69ea11[_0x447139[_0x35eeea(0x1eb)]]={'shopId':_0x447139[_0x35eeea(0x1eb)],'shopName':_0x447139['shop']['name'],'shopUsername':_0x447139['shop'][_0x35eeea(0x16a)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x69ea11[_0x447139[_0x35eeea(0x1eb)]][_0x35eeea(0x11d)]++,_0x69ea11[_0x447139[_0x35eeea(0x1eb)]][_0x35eeea(0x1fd)]+=_0x3c431b,_0x69ea11[_0x447139['shopId']][_0x35eeea(0x11f)]+=_0x3362f2,_0x69ea11[_0x447139['shopId']][_0x35eeea(0x1aa)]+=_0x49ec57);const _0x26edaa=_0x447139[_0x35eeea(0x1b5)][_0x35eeea(0x14b)]()['split']('T')[0x0];!_0x14e38a[_0x26edaa]&&(_0x14e38a[_0x26edaa]={'date':_0x26edaa,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x14e38a[_0x26edaa][_0x35eeea(0x173)]+=_0x3c431b,_0x14e38a[_0x26edaa][_0x35eeea(0x10f)]+=_0x49ec57,_0x14e38a[_0x26edaa][_0x35eeea(0x151)]+=_0x3362f2,_0x14e38a[_0x26edaa][_0x35eeea(0x11d)]++;}catch(_0x33ed21){console['error'](_0x35eeea(0x1ab)+_0x447139['id']+':',_0x33ed21);}}Object[_0x35eeea(0x102)](_0x3c168a)['forEach'](_0x2d13ef=>{const _0x1470ed=_0x35eeea;_0x2d13ef['averageCommissionRate']=_0x2d13ef['paymentsCount']>0x0?_0x2d13ef[_0x1470ed(0x14f)]/_0x2d13ef['paymentsCount']:0x0,delete _0x2d13ef[_0x1470ed(0x14f)];}),Object[_0x35eeea(0x102)](_0x69ea11)[_0x35eeea(0x16e)](_0x2541c2=>{const _0x1d5e51=_0x35eeea;_0x2541c2['averageCheckUSDT']=_0x2541c2[_0x1d5e51(0x11d)]>0x0?_0x2541c2[_0x1d5e51(0x1fd)]/_0x2541c2[_0x1d5e51(0x11d)]:0x0;});let _0x3b54a4=0x0;if(_0x21142f['shopId']){const _0x47f7a9=await database_1[_0x35eeea(0x1ea)][_0x35eeea(0x1fa)]['findMany']({'where':{'shopId':_0x21142f[_0x35eeea(0x1eb)],'status':_0x35eeea(0x193),'createdAt':{'gte':_0x54c015,'lte':_0x52b1b8}},'select':{'amount':!![]}});_0x3b54a4=_0x47f7a9[_0x35eeea(0x1a1)]((_0x116fc3,_0x1b8dfd)=>_0x116fc3+_0x1b8dfd[_0x35eeea(0x1d8)],0x0);}const _0x36c521=_0x5b5efc,_0x59b390=_0x416a41['length'],_0x7db3c5=_0x59b390>0x0?_0x2837e5/_0x59b390:0x0,_0x276d35=_0x36c521>0x0?Math[_0x35eeea(0x125)](_0x59b390/_0x36c521*0x2710)/0x64:0x0,_0x16dcc4=Math[_0x35eeea(0x109)]((_0x52b1b8[_0x35eeea(0x175)]()-_0x54c015['getTime']())/(0x3e8*0x3c*0x3c*0x18)),_0x266c37={'totalTurnover':Math['round'](_0x2837e5*0x64)/0x64,'merchantEarnings':Math[_0x35eeea(0x125)](_0x598fb7*0x64)/0x64,'gatewayEarnings':Math[_0x35eeea(0x125)](_0xf68f32*0x64)/0x64,'totalPaidOut':Math[_0x35eeea(0x125)](_0x3b54a4*0x64)/0x64,'averageCheck':Math[_0x35eeea(0x125)](_0x7db3c5*0x64)/0x64,'totalPayments':_0x36c521,'successfulPayments':_0x59b390,'conversionRate':_0x276d35,'gatewayBreakdown':Object['values'](_0x3c168a)[_0x35eeea(0x183)](_0x34c9e6=>({..._0x34c9e6,'turnoverUSDT':Math['round'](_0x34c9e6[_0x35eeea(0x1fd)]*0x64)/0x64,'commissionUSDT':Math[_0x35eeea(0x125)](_0x34c9e6['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x35eeea(0x125)](_0x34c9e6[_0x35eeea(0x1aa)]*0x64)/0x64,'averageCommissionRate':Math[_0x35eeea(0x125)](_0x34c9e6[_0x35eeea(0x1df)]*0x64)/0x64})),'merchantBreakdown':_0x21142f[_0x35eeea(0x1eb)]?undefined:Object[_0x35eeea(0x102)](_0x69ea11)['map'](_0x205ce2=>({..._0x205ce2,'turnoverUSDT':Math[_0x35eeea(0x125)](_0x205ce2[_0x35eeea(0x1fd)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x205ce2[_0x35eeea(0x11f)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x35eeea(0x125)](_0x205ce2[_0x35eeea(0x1aa)]*0x64)/0x64,'paidOutUSDT':Math['round'](_0x205ce2[_0x35eeea(0x113)]*0x64)/0x64,'averageCheckUSDT':Math['round'](_0x205ce2[_0x35eeea(0x1a6)]*0x64)/0x64})),'dailyData':Object[_0x35eeea(0x102)](_0x14e38a)[_0x35eeea(0x183)](_0x52b92b=>({..._0x52b92b,'turnover':Math[_0x35eeea(0x125)](_0x52b92b[_0x35eeea(0x173)]*0x64)/0x64,'merchantEarnings':Math['round'](_0x52b92b[_0x35eeea(0x10f)]*0x64)/0x64,'gatewayEarnings':Math['round'](_0x52b92b[_0x35eeea(0x151)]*0x64)/0x64}))[_0x35eeea(0x11c)]((_0x39919b,_0x331e84)=>_0x39919b[_0x35eeea(0x1ac)][_0x35eeea(0x132)](_0x331e84['date'])),'periodInfo':{'from':_0x54c015,'to':_0x52b1b8,'periodType':_0x21142f[_0x35eeea(0x136)]||'custom','daysCount':_0x16dcc4}};return console[_0x35eeea(0x12a)](_0x35eeea(0x1ba)),console[_0x35eeea(0x12a)](_0x35eeea(0x133)+_0x266c37[_0x35eeea(0x169)]+'\x20USDT'),console[_0x35eeea(0x12a)]('\x20\x20\x20üë§\x20Merchant\x20earnings:\x20'+_0x266c37[_0x35eeea(0x10f)]+'\x20USDT'),console[_0x35eeea(0x12a)](_0x35eeea(0x121)+_0x266c37[_0x35eeea(0x151)]+_0x35eeea(0x197)),console['log'](_0x35eeea(0x1b9)+_0x266c37[_0x35eeea(0x176)]),_0x266c37;}async['getMerchantsSelection'](){const _0x389706=a35_0x2917c7;console[_0x389706(0x12a)](_0x389706(0x18b));const _0xda34e1=await database_1['default'][_0x389706(0x154)][_0x389706(0x159)]({'where':{'status':_0x389706(0x1e0)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x389706(0x123)}});return console[_0x389706(0x12a)](_0x389706(0x105)+_0xda34e1['length']+'\x20active\x20merchants\x20for\x20selection'),_0xda34e1[_0x389706(0x183)](_0x5c697f=>({'id':_0x5c697f['id'],'username':_0x5c697f[_0x389706(0x16a)],'name':_0x5c697f[_0x389706(0x1e9)]}));}[a35_0x2917c7(0x138)](_0x4e3373){const _0x42ccbe=a35_0x2917c7,_0x376812={'test_gateway':_0x42ccbe(0x1b3),'plisio':_0x42ccbe(0x191),'rapyd':'Rapyd','noda':'Noda','cointopay':_0x42ccbe(0x11a),'klyme_eu':'KLYME\x20EU','klyme_gb':_0x42ccbe(0x163),'klyme_de':_0x42ccbe(0x1a2)};return _0x376812[_0x4e3373]||_0x4e3373;}async[a35_0x2917c7(0x168)](_0x285690){const _0x51965f=a35_0x2917c7,{page:_0x435717,limit:_0x1beb22,minAmount:_0x50bf64,search:_0x371ad2}=_0x285690,_0x3f9d66=(_0x435717-0x1)*_0x1beb22;console['log'](_0x51965f(0x104),_0x285690);const _0x558e93={'balance':{'gt':0x0},'status':_0x51965f(0x1e0)};_0x50bf64&&(_0x558e93[_0x51965f(0x115)][_0x51965f(0x1a4)]=_0x50bf64);_0x371ad2&&(_0x558e93['OR']=[{'name':{'contains':_0x371ad2,'mode':_0x51965f(0x1c2)}},{'username':{'contains':_0x371ad2,'mode':'insensitive'}}]);const [_0x207c08,_0x1000ce]=await Promise['all']([database_1['default'][_0x51965f(0x154)][_0x51965f(0x159)]({'where':_0x558e93,'skip':_0x3f9d66,'take':_0x1beb22,'orderBy':{'balance':_0x51965f(0x144)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1['default']['shop'][_0x51965f(0x171)]({'where':_0x558e93})]);console[_0x51965f(0x12a)](_0x51965f(0x1ee)+_0x207c08[_0x51965f(0x206)]+_0x51965f(0x16c));const _0x2a68fd=await Promise[_0x51965f(0x1c8)](_0x207c08[_0x51965f(0x183)](async _0x122ff8=>{const _0x16a1e9=_0x51965f,[_0x35fca7,_0x3eb12d,_0x12a44b]=await Promise[_0x16a1e9(0x1c8)]([database_1['default'][_0x16a1e9(0x137)][_0x16a1e9(0x171)]({'where':{'shopId':_0x122ff8['id'],'status':'PAID','amountUSDT':{'not':null}}}),database_1['default']['payment']['findFirst']({'where':{'shopId':_0x122ff8['id'],'status':_0x16a1e9(0x194),'amountUSDT':{'not':null}},'orderBy':{'paidAt':_0x16a1e9(0x123)},'select':{'paidAt':!![]}}),database_1['default'][_0x16a1e9(0x137)][_0x16a1e9(0x116)]({'by':[_0x16a1e9(0x1b4)],'where':{'shopId':_0x122ff8['id'],'status':_0x16a1e9(0x194),'amountUSDT':{'not':null}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x5529f1=await Promise[_0x16a1e9(0x1c8)](_0x12a44b[_0x16a1e9(0x183)](async _0x591d1a=>{const _0x249320=_0x16a1e9;let _0x180424=0xa;if(_0x122ff8[_0x249320(0x101)])try{const _0x24d163=JSON[_0x249320(0x202)](_0x122ff8[_0x249320(0x101)]);for(const [_0x66319c,_0x403d2f]of Object[_0x249320(0x19f)](_0x24d163)){if(_0x66319c[_0x249320(0x179)]()===_0x591d1a['gateway'][_0x249320(0x179)]()){_0x180424=_0x403d2f[_0x249320(0x14d)]||0xa,console[_0x249320(0x12a)](_0x249320(0x110)+_0x591d1a[_0x249320(0x1b4)]+_0x249320(0x1d2)+_0x122ff8['id']+_0x249320(0x1cd)+_0x180424+'%');break;}}}catch(_0x16347b){console[_0x249320(0x150)]('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x122ff8['id']+':',_0x16347b);}const _0x25e1e2=_0x591d1a[_0x249320(0x1b0)]['amountUSDT']||0x0,_0x4d164a=_0x25e1e2*(0x1-_0x180424/0x64);return{'gateway':_0x591d1a[_0x249320(0x1b4)],'count':_0x591d1a[_0x249320(0x14e)]['id'],'amountUSDT':Math[_0x249320(0x125)](_0x25e1e2*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x249320(0x125)](_0x4d164a*0x64)/0x64,'commission':_0x180424};})),_0x49c7a3=_0x122ff8['balance'];return console['log'](_0x16a1e9(0x1db)+_0x122ff8[_0x16a1e9(0x16a)]+':'),console[_0x16a1e9(0x12a)]('\x20\x20\x20üîç\x20Raw\x20total\x20from\x20payments:\x20'+_0x5529f1['reduce']((_0x33ec16,_0xeab5f7)=>_0x33ec16+_0xeab5f7[_0x16a1e9(0x18c)],0x0)+_0x16a1e9(0x12f)),console[_0x16a1e9(0x12a)](_0x16a1e9(0x108)+_0x5529f1[_0x16a1e9(0x1a1)]((_0x3f02ed,_0x3542bb)=>_0x3f02ed+_0x3542bb[_0x16a1e9(0x148)],0x0)+_0x16a1e9(0x12f)),console[_0x16a1e9(0x12a)](_0x16a1e9(0x14c)+_0x49c7a3+_0x16a1e9(0x1e2)),{'id':_0x122ff8['id'],'fullName':_0x122ff8['name'],'username':_0x122ff8[_0x16a1e9(0x16a)],'telegramId':_0x122ff8[_0x16a1e9(0x1da)],'merchantUrl':_0x122ff8[_0x16a1e9(0x13e)],'wallets':{'usdtPolygonWallet':_0x122ff8[_0x16a1e9(0x12e)],'usdtTrcWallet':_0x122ff8[_0x16a1e9(0x119)],'usdtErcWallet':_0x122ff8[_0x16a1e9(0x160)],'usdcPolygonWallet':_0x122ff8[_0x16a1e9(0x13f)]},'totalAmountUSDT':Math['round'](_0x49c7a3*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x49c7a3*0x64)/0x64,'paymentsCount':_0x35fca7,'oldestPaymentDate':_0x3eb12d?.[_0x16a1e9(0x1b5)]||_0x122ff8[_0x16a1e9(0x1d9)],'gatewayBreakdown':_0x5529f1};})),_0x47a735=_0x2a68fd[_0x51965f(0x1a1)]((_0x370f57,_0x26d4ea)=>_0x370f57+_0x26d4ea[_0x51965f(0x10b)],0x0),_0x17df3d=_0x2a68fd[_0x51965f(0x1a1)]((_0x206cfa,_0x15ce1b)=>_0x206cfa+_0x15ce1b[_0x51965f(0x1bf)],0x0);return console['log'](_0x51965f(0x185)+_0x1000ce+_0x51965f(0x1d7)+Math[_0x51965f(0x125)](_0x17df3d*0x64)/0x64+_0x51965f(0x170)),{'merchants':_0x2a68fd,'pagination':{'page':_0x435717,'limit':_0x1beb22,'total':_0x1000ce,'totalPages':Math[_0x51965f(0x109)](_0x1000ce/_0x1beb22)},'summary':{'totalMerchants':_0x1000ce,'totalAmountUSDT':Math[_0x51965f(0x125)](_0x47a735*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x51965f(0x125)](_0x17df3d*0x64)/0x64}};}async['createPayout'](_0x4ec0b9){const _0x1a9250=a35_0x2917c7,{shopId:_0x53dacc,amount:_0x5b4032,network:_0x5d7e91,wallet:_0x39ab1d,notes:_0x3affef,txid:_0x31a6e9,periodFrom:_0x3bc514,periodTo:_0x216001}=_0x4ec0b9,_0x3a5fb3=await database_1['default'][_0x1a9250(0x1a0)](async _0x96422f=>{const _0x170f72=_0x1a9250,_0x301fb9=await _0x96422f['shop'][_0x170f72(0x187)]({'where':{'id':_0x53dacc},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x301fb9)throw new Error(_0x170f72(0x17b));console[_0x170f72(0x12a)](_0x170f72(0x177)+_0x301fb9['username']+':'),console[_0x170f72(0x12a)](_0x170f72(0x14a)+_0x301fb9[_0x170f72(0x115)]['toFixed'](0x6)+_0x170f72(0x197)),console[_0x170f72(0x12a)]('\x20\x20\x20Payout\x20amount:\x20'+_0x5b4032['toFixed'](0x6)+_0x170f72(0x197)),console[_0x170f72(0x12a)](_0x170f72(0x19b)+_0x301fb9[_0x170f72(0x12b)][_0x170f72(0x11e)](0x6)+_0x170f72(0x197));if(_0x31a6e9)console[_0x170f72(0x12a)](_0x170f72(0x203)+_0x31a6e9);if(_0x301fb9[_0x170f72(0x115)]<_0x5b4032)throw new Error(_0x170f72(0x1c6)+_0x301fb9['balance'][_0x170f72(0x11e)](0x6)+_0x170f72(0x1e4)+_0x5b4032[_0x170f72(0x11e)](0x6)+_0x170f72(0x197));let _0x57b6c6=_0x39ab1d;if(!_0x57b6c6){const _0x38cf63=await _0x96422f[_0x170f72(0x154)][_0x170f72(0x187)]({'where':{'id':_0x53dacc},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x38cf63)switch(_0x5d7e91){case _0x170f72(0x13b):_0x57b6c6=_0x38cf63[_0x170f72(0x12e)]||undefined;break;case _0x170f72(0x189):_0x57b6c6=_0x38cf63[_0x170f72(0x119)]||undefined;break;case _0x170f72(0x158):_0x57b6c6=_0x38cf63[_0x170f72(0x160)]||undefined;break;case _0x170f72(0xff):_0x57b6c6=_0x38cf63[_0x170f72(0x13f)]||undefined;break;}}console[_0x170f72(0x12a)](_0x170f72(0x16b)+_0x5d7e91+':\x20'+(_0x57b6c6||_0x170f72(0x1c0)));const _0x435d7f=await _0x96422f['payout'][_0x170f72(0x192)]({'data':{'shopId':_0x53dacc,'amount':_0x5b4032,'network':_0x5d7e91,'status':_0x170f72(0x193),'txid':_0x31a6e9,'notes':_0x3affef,'periodFrom':_0x3bc514?new Date(_0x3bc514):null,'periodTo':_0x216001?new Date(_0x216001):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x384567=_0x301fb9[_0x170f72(0x115)]-_0x5b4032,_0x4fefb0=_0x301fb9[_0x170f72(0x12b)]+_0x5b4032;return await _0x96422f[_0x170f72(0x154)][_0x170f72(0x11b)]({'where':{'id':_0x53dacc},'data':{'balance':_0x384567,'totalPaidOut':_0x4fefb0}}),console[_0x170f72(0x12a)](_0x170f72(0x131)+_0x301fb9['username']+_0x170f72(0x1c9)),console['log'](_0x170f72(0x19d)+_0x301fb9[_0x170f72(0x115)][_0x170f72(0x11e)](0x6)+'\x20->\x20'+_0x384567[_0x170f72(0x11e)](0x6)+_0x170f72(0x1b2)+_0x5b4032[_0x170f72(0x11e)](0x6)+')'),console[_0x170f72(0x12a)](_0x170f72(0x130)+_0x301fb9[_0x170f72(0x12b)][_0x170f72(0x11e)](0x6)+_0x170f72(0x1bb)+_0x4fefb0[_0x170f72(0x11e)](0x6)+_0x170f72(0x12c)+_0x5b4032['toFixed'](0x6)+')'),{'payout':_0x435d7f,'shop':_0x301fb9};});return console[_0x1a9250(0x12a)](_0x1a9250(0x174)+_0x3a5fb3[_0x1a9250(0x1fa)]['id']+_0x1a9250(0x1d2)+_0x3a5fb3[_0x1a9250(0x154)][_0x1a9250(0x16a)]+'\x20('+_0x5b4032+_0x1a9250(0x15d)),{'id':_0x3a5fb3['payout']['id'],'shopId':_0x3a5fb3['payout']['shopId'],'shopName':_0x3a5fb3['shop'][_0x1a9250(0x1e9)],'shopUsername':_0x3a5fb3['shop']['username'],'amount':_0x3a5fb3[_0x1a9250(0x1fa)][_0x1a9250(0x1d8)],'network':_0x3a5fb3['payout'][_0x1a9250(0x1e3)],'status':_0x3a5fb3[_0x1a9250(0x1fa)][_0x1a9250(0x1dd)],'txid':_0x3a5fb3[_0x1a9250(0x1fa)][_0x1a9250(0x17d)],'notes':_0x3a5fb3[_0x1a9250(0x1fa)][_0x1a9250(0x13c)],'periodFrom':_0x3a5fb3[_0x1a9250(0x1fa)][_0x1a9250(0x1d6)],'periodTo':_0x3a5fb3[_0x1a9250(0x1fa)][_0x1a9250(0x118)],'createdAt':_0x3a5fb3[_0x1a9250(0x1fa)][_0x1a9250(0x1d9)],'paidAt':_0x3a5fb3[_0x1a9250(0x1fa)]['paidAt']};}async[a35_0x2917c7(0x1e7)](_0x2a8479){const _0x2601cd=a35_0x2917c7,{page:_0x1130ea,limit:_0x265627,shopId:_0x523669,network:_0x3e766e,dateFrom:_0x309d5d,dateTo:_0x3088ee,search:_0x201b0}=_0x2a8479,_0x4b20ef=(_0x1130ea-0x1)*_0x265627,_0x270091={};_0x523669&&(_0x270091[_0x2601cd(0x1eb)]=_0x523669);_0x3e766e&&(_0x270091[_0x2601cd(0x1e3)]=_0x3e766e);(_0x309d5d||_0x3088ee)&&(_0x270091[_0x2601cd(0x1d9)]={},_0x309d5d&&(_0x270091['createdAt'][_0x2601cd(0x1a4)]=new Date(_0x309d5d)),_0x3088ee&&(_0x270091[_0x2601cd(0x1d9)]['lte']=new Date(_0x3088ee)));_0x201b0&&(_0x270091['OR']=[{'shop':{'name':{'contains':_0x201b0,'mode':_0x2601cd(0x1c2)}}},{'shop':{'username':{'contains':_0x201b0,'mode':_0x2601cd(0x1c2)}}},{'notes':{'contains':_0x201b0,'mode':_0x2601cd(0x1c2)}}]);const [_0x49aca0,_0x3432a4]=await Promise['all']([database_1[_0x2601cd(0x1ea)][_0x2601cd(0x1fa)][_0x2601cd(0x159)]({'where':_0x270091,'skip':_0x4b20ef,'take':_0x265627,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'wallet':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x2601cd(0x1ea)][_0x2601cd(0x1fa)][_0x2601cd(0x171)]({'where':_0x270091})]);return{'payouts':_0x49aca0['map'](_0x3af383=>({'id':_0x3af383['id'],'shopId':_0x3af383[_0x2601cd(0x1eb)],'shopName':_0x3af383['shop']['name'],'shopUsername':_0x3af383[_0x2601cd(0x154)][_0x2601cd(0x16a)],'amount':_0x3af383[_0x2601cd(0x1d8)],'network':_0x3af383['network'],'wallet':_0x3af383[_0x2601cd(0x100)],'status':_0x3af383['status'],'txid':_0x3af383[_0x2601cd(0x17d)],'notes':_0x3af383['notes'],'periodFrom':_0x3af383[_0x2601cd(0x1d6)],'periodTo':_0x3af383[_0x2601cd(0x118)],'createdAt':_0x3af383['createdAt'],'paidAt':_0x3af383['paidAt']})),'pagination':{'page':_0x1130ea,'limit':_0x265627,'total':_0x3432a4,'totalPages':Math[_0x2601cd(0x109)](_0x3432a4/_0x265627)}};}async[a35_0x2917c7(0x1b6)](_0x20e4d2){const _0x520fee=a35_0x2917c7,_0x2c53d5=await database_1['default'][_0x520fee(0x1fa)][_0x520fee(0x187)]({'where':{'id':_0x20e4d2},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x2c53d5)return null;return{'id':_0x2c53d5['id'],'shopId':_0x2c53d5[_0x520fee(0x1eb)],'shopName':_0x2c53d5['shop'][_0x520fee(0x1e9)],'shopUsername':_0x2c53d5[_0x520fee(0x154)]['username'],'amount':_0x2c53d5[_0x520fee(0x1d8)],'network':_0x2c53d5[_0x520fee(0x1e3)],'status':_0x2c53d5['status'],'txid':_0x2c53d5[_0x520fee(0x17d)],'notes':_0x2c53d5[_0x520fee(0x13c)],'periodFrom':_0x2c53d5[_0x520fee(0x1d6)],'periodTo':_0x2c53d5[_0x520fee(0x118)],'createdAt':_0x2c53d5[_0x520fee(0x1d9)],'paidAt':_0x2c53d5[_0x520fee(0x1b5)]};}async[a35_0x2917c7(0xfb)](_0x101781){await database_1['default']['payout']['delete']({'where':{'id':_0x101781}});}async['getAllPayments'](_0x35e5d4){const _0x1c91c5=a35_0x2917c7,{page:_0x44657f,limit:_0x3c8893,status:_0x52bee9,gateway:_0x50d656,shopId:_0x3dea8b,dateFrom:_0x516c59,dateTo:_0x37bace,search:_0x1c2e4f,currency:_0xeb413c,sortBy:_0x9dcd4,sortOrder:_0x77faca}=_0x35e5d4,_0x9ee5bd=(_0x44657f-0x1)*_0x3c8893;console[_0x1c91c5(0x12a)](_0x1c91c5(0x188),_0x35e5d4);const _0x415bd7=await database_1['default']['payment']['groupBy']({'by':[_0x1c91c5(0x1b4)],'_count':{'gateway':!![]}});console[_0x1c91c5(0x12a)](_0x1c91c5(0x129),_0x415bd7['map'](_0xc3b833=>_0xc3b833[_0x1c91c5(0x1b4)]+'\x20('+_0xc3b833['_count']['gateway']+_0x1c91c5(0x128)));if(_0x50d656){const _0xe81cdb=_0x415bd7[_0x1c91c5(0x155)](_0x463d05=>_0x463d05['gateway']['toLowerCase']()===_0x50d656[_0x1c91c5(0x179)]());!_0xe81cdb&&_0x50d656[_0x1c91c5(0x179)]()!=='test_gateway'&&console[_0x1c91c5(0x12a)](_0x1c91c5(0x10c)+_0x50d656+_0x1c91c5(0x1d0)+_0x415bd7[_0x1c91c5(0x183)](_0x12a242=>_0x12a242[_0x1c91c5(0x1b4)])[_0x1c91c5(0x1fb)](',\x20'));}const _0x264bf2={};_0x52bee9&&(_0x264bf2[_0x1c91c5(0x1dd)]=_0x52bee9['toUpperCase']());if(!_0x50d656)_0x264bf2['gateway']={'not':_0x1c91c5(0xfc)};else{if(_0x50d656&&(_0x50d656['toLowerCase']()===_0x1c91c5(0xfc)||_0x50d656==='0000'))_0x264bf2[_0x1c91c5(0x1b4)]=_0x1c91c5(0xfc);else{let _0xf21783=_0x50d656;const _0x112b6c=(0x0,gateway_1['getGatewayNameById'])(_0x50d656);if(_0x112b6c)_0xf21783=_0x112b6c,console[_0x1c91c5(0x12a)]('üîÑ\x20Converted\x20gateway\x20ID\x20\x27'+_0x50d656+_0x1c91c5(0x204)+_0xf21783+'\x27');else{const _0x4c5018=(0x0,gateway_1['getGatewayIdByName'])(_0x50d656);if(_0x4c5018){const _0x2651ac=(0x0,gateway_1['getGatewayNameById'])(_0x4c5018);_0x2651ac&&(_0xf21783=_0x2651ac,console[_0x1c91c5(0x12a)](_0x1c91c5(0x18a)+_0x50d656+'\x27\x20->\x20ID\x20\x27'+_0x4c5018+'\x27\x20->\x20name\x20\x27'+_0xf21783+'\x27'));}else console[_0x1c91c5(0x12a)]('üîç\x20Using\x20gateway\x20\x27'+_0x50d656+'\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)');}const _0x2fcb1d=await database_1['default'][_0x1c91c5(0x137)][_0x1c91c5(0x171)]({'where':{'gateway':_0xf21783[_0x1c91c5(0x179)]()},'take':0x1});_0x2fcb1d===0x0?(console[_0x1c91c5(0x12a)]('‚ö†Ô∏è\x20Gateway\x20\x27'+_0xf21783+'\x27\x20(from\x20\x27'+_0x50d656+_0x1c91c5(0x186)),_0x264bf2[_0x1c91c5(0x1b4)]='NONEXISTENT_GATEWAY_FILTER'):(_0x264bf2['gateway']=_0xf21783[_0x1c91c5(0x179)](),console[_0x1c91c5(0x12a)](_0x1c91c5(0x143)+_0xf21783+_0x1c91c5(0x17f)+_0x50d656+'\x27)'));}}console[_0x1c91c5(0x12a)](_0x1c91c5(0x1dc),_0x264bf2[_0x1c91c5(0x1b4)]);_0x3dea8b&&(_0x264bf2['shopId']=_0x3dea8b);_0xeb413c&&(_0x264bf2[_0x1c91c5(0x142)]=_0xeb413c[_0x1c91c5(0x1a3)](),console[_0x1c91c5(0x12a)](_0x1c91c5(0x126)+_0xeb413c[_0x1c91c5(0x1a3)]()));(_0x516c59||_0x37bace)&&(_0x264bf2['createdAt']={},_0x516c59&&(_0x264bf2[_0x1c91c5(0x1d9)][_0x1c91c5(0x1a4)]=new Date(_0x516c59)),_0x37bace&&(_0x264bf2[_0x1c91c5(0x1d9)]['lte']=new Date(_0x37bace)));_0x1c2e4f&&(_0x264bf2['OR']=[{'id':{'contains':_0x1c2e4f,'mode':_0x1c91c5(0x1c2)}},{'orderId':{'contains':_0x1c2e4f,'mode':_0x1c91c5(0x1c2)}},{'gatewayOrderId':{'contains':_0x1c2e4f,'mode':_0x1c91c5(0x1c2)}},{'customerEmail':{'contains':_0x1c2e4f,'mode':_0x1c91c5(0x1c2)}},{'shop':{'name':{'contains':_0x1c2e4f,'mode':_0x1c91c5(0x1c2)}}},{'shop':{'username':{'contains':_0x1c2e4f,'mode':_0x1c91c5(0x1c2)}}}]);console[_0x1c91c5(0x12a)](_0x1c91c5(0x1e6),JSON[_0x1c91c5(0x13a)](_0x264bf2,null,0x2));let _0x146454={'createdAt':_0x1c91c5(0x144)};if(_0x9dcd4){const _0x170140=['amount',_0x1c91c5(0x1d9),_0x1c91c5(0x1ff),'status',_0x1c91c5(0x1b4),_0x1c91c5(0x142)],_0x1cd035=[_0x1c91c5(0x123),_0x1c91c5(0x144)];if(_0x170140[_0x1c91c5(0x161)](_0x9dcd4)){const _0x5d266d=_0x1cd035[_0x1c91c5(0x161)](_0x77faca)?_0x77faca:_0x1c91c5(0x144);_0x146454={[_0x9dcd4]:_0x5d266d},console[_0x1c91c5(0x12a)](_0x1c91c5(0x1e1)+_0x9dcd4+'\x20in\x20'+_0x5d266d+'\x20order');}}const [_0x12c346,_0x2cee80]=await Promise[_0x1c91c5(0x1c8)]([database_1[_0x1c91c5(0x1ea)][_0x1c91c5(0x137)][_0x1c91c5(0x159)]({'where':_0x264bf2,'skip':_0x9ee5bd,'take':_0x3c8893,'orderBy':_0x146454,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x1c91c5(0x1ea)]['payment'][_0x1c91c5(0x171)]({'where':_0x264bf2})]);return{'payments':_0x12c346['map'](_0x9f79f3=>({'id':_0x9f79f3['id'],'shopId':_0x9f79f3[_0x1c91c5(0x1eb)],'gateway':_0x9f79f3[_0x1c91c5(0x1b4)],'amount':_0x9f79f3[_0x1c91c5(0x1d8)],'currency':_0x9f79f3[_0x1c91c5(0x142)],'status':_0x9f79f3[_0x1c91c5(0x1dd)],'orderId':_0x9f79f3['orderId'],'gatewayOrderId':_0x9f79f3['gatewayOrderId'],'customerEmail':_0x9f79f3[_0x1c91c5(0x157)],'customerName':_0x9f79f3[_0x1c91c5(0x153)],'customerCountry':_0x9f79f3[_0x1c91c5(0xfe)],'customerIp':_0x9f79f3[_0x1c91c5(0x1c7)],'customerUa':_0x9f79f3[_0x1c91c5(0x1e5)],'failureMessage':_0x9f79f3[_0x1c91c5(0x149)],'createdAt':_0x9f79f3[_0x1c91c5(0x1d9)],'updatedAt':_0x9f79f3[_0x1c91c5(0x1ff)],'shop':_0x9f79f3['shop']})),'pagination':{'page':_0x44657f,'limit':_0x3c8893,'total':_0x2cee80,'totalPages':Math[_0x1c91c5(0x109)](_0x2cee80/_0x3c8893)}};}async['getPaymentById'](_0x471f13){const _0x5bcf2b=a35_0x2917c7,_0x2e9281=await database_1[_0x5bcf2b(0x1ea)][_0x5bcf2b(0x137)][_0x5bcf2b(0x187)]({'where':{'id':_0x471f13},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x2e9281)return null;return{'id':_0x2e9281['id'],'shopId':_0x2e9281[_0x5bcf2b(0x1eb)],'gateway':_0x2e9281[_0x5bcf2b(0x1b4)],'amount':_0x2e9281[_0x5bcf2b(0x1d8)],'currency':_0x2e9281[_0x5bcf2b(0x142)],'status':_0x2e9281[_0x5bcf2b(0x1dd)],'orderId':_0x2e9281[_0x5bcf2b(0x1ed)],'gatewayOrderId':_0x2e9281[_0x5bcf2b(0x10e)],'customerEmail':_0x2e9281[_0x5bcf2b(0x157)],'customerName':_0x2e9281[_0x5bcf2b(0x153)],'customerCountry':_0x2e9281[_0x5bcf2b(0xfe)],'customerIp':_0x2e9281[_0x5bcf2b(0x1c7)],'customerUa':_0x2e9281['customerUa'],'failureMessage':_0x2e9281[_0x5bcf2b(0x149)],'externalPaymentUrl':_0x2e9281['externalPaymentUrl'],'successUrl':_0x2e9281[_0x5bcf2b(0x18e)],'failUrl':_0x2e9281['failUrl'],'pendingUrl':_0x2e9281['pendingUrl'],'whiteUrl':_0x2e9281[_0x5bcf2b(0x17a)],'createdAt':_0x2e9281['createdAt'],'updatedAt':_0x2e9281['updatedAt'],'shop':_0x2e9281[_0x5bcf2b(0x154)]};}async['updatePaymentStatus'](_0x36ae0d,_0x36ec0d,_0x5e4e0e,_0x51db7c){const _0x30740a=a35_0x2917c7,_0x31dffe=await database_1[_0x30740a(0x1ea)]['$transaction'](async _0x4e4d34=>{const _0x3619f7=_0x30740a,_0x77effd=await _0x4e4d34['payment'][_0x3619f7(0x187)]({'where':{'id':_0x36ae0d},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x77effd)throw new Error(_0x3619f7(0x1af));const _0x2a0b9b=_0x77effd[_0x3619f7(0x1dd)],_0x2e2a25=_0x36ec0d['toUpperCase']();console[_0x3619f7(0x12a)](_0x3619f7(0x195)+_0x36ae0d+_0x3619f7(0x165)+_0x2a0b9b+'\x20->\x20'+_0x2e2a25),console[_0x3619f7(0x12a)](_0x3619f7(0x18d)+_0x77effd[_0x3619f7(0x154)][_0x3619f7(0x115)]+_0x3619f7(0x197));const _0x5182ee={'status':_0x2e2a25,'updatedAt':new Date(),'statusChangedBy':'admin','statusChangedAt':new Date()};_0x5e4e0e&&(_0x5182ee[_0x3619f7(0x1b7)]=_0x5e4e0e);_0x2e2a25===_0x3619f7(0x120)&&_0x51db7c&&(_0x5182ee[_0x3619f7(0x201)]=_0x51db7c);let _0xe838d9=0x0,_0x136948=_0x77effd[_0x3619f7(0x154)]['balance'];if(_0x2e2a25===_0x3619f7(0x194)&&_0x2a0b9b!==_0x3619f7(0x194)){_0x5182ee[_0x3619f7(0x1b5)]=new Date();const _0xc369e9=await currencyService_1[_0x3619f7(0x17e)][_0x3619f7(0x1f7)](_0x77effd[_0x3619f7(0x1d8)],_0x77effd['currency']);_0x5182ee[_0x3619f7(0x18c)]=_0xc369e9,_0xe838d9=_0xc369e9,_0x136948+=_0xc369e9,console[_0x3619f7(0x12a)]('üí∞\x20Payment\x20'+_0x36ae0d+'\x20became\x20PAID:\x20+'+_0xc369e9[_0x3619f7(0x11e)](0x6)+'\x20USDT\x20to\x20balance');}else _0x2a0b9b==='PAID'&&_0x2e2a25!==_0x3619f7(0x194)&&(_0x77effd['amountUSDT']&&(_0xe838d9=-_0x77effd[_0x3619f7(0x18c)],_0x136948-=_0x77effd['amountUSDT'],_0x5182ee[_0x3619f7(0x18c)]=null,console['log']('üí∞\x20Payment\x20'+_0x36ae0d+'\x20no\x20longer\x20PAID:\x20-'+_0x77effd['amountUSDT'][_0x3619f7(0x11e)](0x6)+_0x3619f7(0x178))));if(_0x2e2a25===_0x3619f7(0x120)){if(_0x2a0b9b==='PAID'&&_0x77effd[_0x3619f7(0x18c)]){}_0x51db7c&&_0x51db7c>0x0&&(_0xe838d9-=_0x51db7c,_0x136948-=_0x51db7c,console[_0x3619f7(0x12a)](_0x3619f7(0x1f3)+_0x51db7c[_0x3619f7(0x11e)](0x6)+_0x3619f7(0x178)));}_0x2e2a25===_0x3619f7(0x1bd)&&_0x2a0b9b===_0x3619f7(0x194)&&console['log'](_0x3619f7(0x1c1));const _0x25b96b=await _0x4e4d34[_0x3619f7(0x137)]['update']({'where':{'id':_0x36ae0d},'data':_0x5182ee,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0xe838d9!==0x0&&(await _0x4e4d34[_0x3619f7(0x154)][_0x3619f7(0x11b)]({'where':{'id':_0x77effd[_0x3619f7(0x1eb)]},'data':{'balance':_0x136948}}),console[_0x3619f7(0x12a)]('üí∞\x20Shop\x20'+_0x77effd[_0x3619f7(0x1eb)]+'\x20balance\x20updated:\x20'+_0x77effd['shop'][_0x3619f7(0x115)]['toFixed'](0x6)+_0x3619f7(0x1bb)+_0x136948[_0x3619f7(0x11e)](0x6)+_0x3619f7(0x156)+(_0xe838d9>0x0?'+':'')+_0xe838d9[_0x3619f7(0x11e)](0x6)+')')),_0x25b96b;});return{'id':_0x31dffe['id'],'shopId':_0x31dffe['shopId'],'gateway':_0x31dffe[_0x30740a(0x1b4)],'amount':_0x31dffe[_0x30740a(0x1d8)],'currency':_0x31dffe[_0x30740a(0x142)],'status':_0x31dffe[_0x30740a(0x1dd)],'orderId':_0x31dffe[_0x30740a(0x1ed)],'gatewayOrderId':_0x31dffe[_0x30740a(0x10e)],'customerEmail':_0x31dffe[_0x30740a(0x157)],'customerName':_0x31dffe[_0x30740a(0x153)],'customerCountry':_0x31dffe[_0x30740a(0xfe)],'customerIp':_0x31dffe[_0x30740a(0x1c7)],'customerUa':_0x31dffe[_0x30740a(0x1e5)],'failureMessage':_0x31dffe['failureMessage'],'adminNotes':_0x31dffe[_0x30740a(0x1b7)],'chargebackAmount':_0x31dffe[_0x30740a(0x201)],'statusChangedBy':_0x31dffe[_0x30740a(0x19c)],'statusChangedAt':_0x31dffe[_0x30740a(0x1fe)],'createdAt':_0x31dffe[_0x30740a(0x1d9)],'updatedAt':_0x31dffe['updatedAt'],'shop':_0x31dffe[_0x30740a(0x154)]};}async['updateUser'](_0x4a0003,_0x5d7d4a){const _0x31f162=a35_0x2917c7,_0x4c6c30={..._0x5d7d4a};_0x5d7d4a['password']&&(_0x4c6c30['password']=await bcryptjs_1[_0x31f162(0x1ea)]['hash'](_0x5d7d4a[_0x31f162(0x15b)],0xc));_0x5d7d4a[_0x31f162(0x127)]&&(_0x4c6c30[_0x31f162(0x1e9)]=_0x5d7d4a[_0x31f162(0x127)],delete _0x4c6c30[_0x31f162(0x127)]);_0x5d7d4a[_0x31f162(0x172)]&&(_0x4c6c30[_0x31f162(0x1da)]=_0x5d7d4a[_0x31f162(0x172)],delete _0x4c6c30[_0x31f162(0x172)]);_0x5d7d4a['merchantUrl']&&(_0x4c6c30[_0x31f162(0x13e)]=_0x5d7d4a[_0x31f162(0x198)],delete _0x4c6c30[_0x31f162(0x198)]);_0x5d7d4a[_0x31f162(0x196)]&&(_0x4c6c30[_0x31f162(0x167)]=JSON['stringify'](_0x5d7d4a[_0x31f162(0x196)]),delete _0x4c6c30[_0x31f162(0x196)]);_0x5d7d4a[_0x31f162(0x101)]&&(_0x4c6c30['gatewaySettings']=JSON[_0x31f162(0x13a)](_0x5d7d4a['gatewaySettings']),delete _0x4c6c30[_0x31f162(0x101)]);_0x5d7d4a[_0x31f162(0x1c4)]&&(_0x5d7d4a[_0x31f162(0x1c4)]['usdtPolygonWallet']!==undefined&&(_0x4c6c30['usdtPolygonWallet']=_0x5d7d4a[_0x31f162(0x1c4)][_0x31f162(0x12e)]||null),_0x5d7d4a['wallets'][_0x31f162(0x119)]!==undefined&&(_0x4c6c30[_0x31f162(0x119)]=_0x5d7d4a['wallets'][_0x31f162(0x119)]||null),_0x5d7d4a[_0x31f162(0x1c4)][_0x31f162(0x160)]!==undefined&&(_0x4c6c30[_0x31f162(0x160)]=_0x5d7d4a[_0x31f162(0x1c4)][_0x31f162(0x160)]||null),_0x5d7d4a['wallets'][_0x31f162(0x13f)]!==undefined&&(_0x4c6c30[_0x31f162(0x13f)]=_0x5d7d4a[_0x31f162(0x1c4)][_0x31f162(0x13f)]||null),delete _0x4c6c30[_0x31f162(0x1c4)]);const _0x1ea349=await database_1[_0x31f162(0x1ea)]['shop'][_0x31f162(0x11b)]({'where':{'id':_0x4a0003},'data':_0x4c6c30,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x1ea349['id'],'fullName':_0x1ea349[_0x31f162(0x1e9)],'username':_0x1ea349['username'],'telegramId':_0x1ea349[_0x31f162(0x1da)],'merchantUrl':_0x1ea349[_0x31f162(0x13e)],'gateways':_0x1ea349[_0x31f162(0x167)]?JSON[_0x31f162(0x202)](_0x1ea349[_0x31f162(0x167)]):null,'gatewaySettings':_0x1ea349[_0x31f162(0x101)]?JSON['parse'](_0x1ea349[_0x31f162(0x101)]):null,'publicKey':_0x1ea349['publicKey'],'wallets':{'usdtPolygonWallet':_0x1ea349[_0x31f162(0x12e)],'usdtTrcWallet':_0x1ea349['usdtTrcWallet'],'usdtErcWallet':_0x1ea349[_0x31f162(0x160)],'usdcPolygonWallet':_0x1ea349[_0x31f162(0x13f)]},'status':_0x1ea349[_0x31f162(0x1dd)],'createdAt':_0x1ea349[_0x31f162(0x1d9)]};}async['suspendUser'](_0x1d547f){const _0x3bcaa4=a35_0x2917c7,_0x43f1b7=await database_1['default'][_0x3bcaa4(0x154)][_0x3bcaa4(0x11b)]({'where':{'id':_0x1d547f},'data':{'status':_0x3bcaa4(0x1cf)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x43f1b7['id'],'fullName':_0x43f1b7[_0x3bcaa4(0x1e9)],'username':_0x43f1b7[_0x3bcaa4(0x16a)],'telegramId':_0x43f1b7[_0x3bcaa4(0x1da)],'merchantUrl':_0x43f1b7['shopUrl'],'gateways':_0x43f1b7[_0x3bcaa4(0x167)]?JSON[_0x3bcaa4(0x202)](_0x43f1b7[_0x3bcaa4(0x167)]):null,'gatewaySettings':_0x43f1b7[_0x3bcaa4(0x101)]?JSON['parse'](_0x43f1b7[_0x3bcaa4(0x101)]):null,'publicKey':_0x43f1b7['publicKey'],'wallets':{'usdtPolygonWallet':_0x43f1b7[_0x3bcaa4(0x12e)],'usdtTrcWallet':_0x43f1b7['usdtTrcWallet'],'usdtErcWallet':_0x43f1b7[_0x3bcaa4(0x160)],'usdcPolygonWallet':_0x43f1b7[_0x3bcaa4(0x13f)]},'status':_0x43f1b7['status'],'createdAt':_0x43f1b7['createdAt']};}async[a35_0x2917c7(0x200)](_0x3c7d60){const _0x47e370=a35_0x2917c7,_0x353381=await database_1['default'][_0x47e370(0x154)][_0x47e370(0x11b)]({'where':{'id':_0x3c7d60},'data':{'status':_0x47e370(0x1e0)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x353381['id'],'fullName':_0x353381[_0x47e370(0x1e9)],'username':_0x353381[_0x47e370(0x16a)],'telegramId':_0x353381[_0x47e370(0x1da)],'merchantUrl':_0x353381['shopUrl'],'gateways':_0x353381[_0x47e370(0x167)]?JSON[_0x47e370(0x202)](_0x353381[_0x47e370(0x167)]):null,'gatewaySettings':_0x353381[_0x47e370(0x101)]?JSON[_0x47e370(0x202)](_0x353381['gatewaySettings']):null,'publicKey':_0x353381[_0x47e370(0x199)],'wallets':{'usdtPolygonWallet':_0x353381[_0x47e370(0x12e)],'usdtTrcWallet':_0x353381['usdtTrcWallet'],'usdtErcWallet':_0x353381['usdtErcWallet'],'usdcPolygonWallet':_0x353381[_0x47e370(0x13f)]},'status':_0x353381[_0x47e370(0x1dd)],'createdAt':_0x353381[_0x47e370(0x1d9)]};}async[a35_0x2917c7(0x1c5)](_0x524597){const _0x11f92a=a35_0x2917c7,{page:_0x178161,limit:_0x5cd8f4,status:_0x34bca3}=_0x524597,_0x2b676b=(_0x178161-0x1)*_0x5cd8f4,_0x46bfec={};_0x34bca3&&(_0x46bfec[_0x11f92a(0x1dd)]=_0x34bca3[_0x11f92a(0x1a3)]());const [_0xf31f42,_0x1f4ab0]=await Promise[_0x11f92a(0x1c8)]([database_1[_0x11f92a(0x1ea)][_0x11f92a(0x154)]['findMany']({'where':_0x46bfec,'skip':_0x2b676b,'take':_0x5cd8f4,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x11f92a(0x1ea)][_0x11f92a(0x154)]['count']({'where':_0x46bfec})]);return{'users':_0xf31f42[_0x11f92a(0x183)](_0x850f04=>({'id':_0x850f04['id'],'fullName':_0x850f04[_0x11f92a(0x1e9)],'username':_0x850f04[_0x11f92a(0x16a)],'telegramId':_0x850f04['telegram'],'merchantUrl':_0x850f04[_0x11f92a(0x13e)],'gateways':_0x850f04[_0x11f92a(0x167)]?JSON['parse'](_0x850f04[_0x11f92a(0x167)]):null,'gatewaySettings':_0x850f04[_0x11f92a(0x101)]?JSON['parse'](_0x850f04[_0x11f92a(0x101)]):null,'publicKey':_0x850f04[_0x11f92a(0x199)],'wallets':{'usdtPolygonWallet':_0x850f04[_0x11f92a(0x12e)],'usdtTrcWallet':_0x850f04['usdtTrcWallet'],'usdtErcWallet':_0x850f04[_0x11f92a(0x160)],'usdcPolygonWallet':_0x850f04[_0x11f92a(0x13f)]},'status':_0x850f04[_0x11f92a(0x1dd)],'createdAt':_0x850f04[_0x11f92a(0x1d9)]})),'pagination':{'page':_0x178161,'limit':_0x5cd8f4,'total':_0x1f4ab0,'totalPages':Math[_0x11f92a(0x109)](_0x1f4ab0/_0x5cd8f4)}};}async[a35_0x2917c7(0x147)](_0x42f393){const _0x259dff=a35_0x2917c7,_0xb246f=await database_1['default'][_0x259dff(0x154)]['findUnique']({'where':{'id':_0x42f393},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0xb246f)return null;return{'id':_0xb246f['id'],'fullName':_0xb246f[_0x259dff(0x1e9)],'username':_0xb246f[_0x259dff(0x16a)],'telegramId':_0xb246f[_0x259dff(0x1da)],'merchantUrl':_0xb246f[_0x259dff(0x13e)],'gateways':_0xb246f[_0x259dff(0x167)]?JSON[_0x259dff(0x202)](_0xb246f[_0x259dff(0x167)]):null,'gatewaySettings':_0xb246f[_0x259dff(0x101)]?JSON[_0x259dff(0x202)](_0xb246f[_0x259dff(0x101)]):null,'publicKey':_0xb246f[_0x259dff(0x199)],'wallets':{'usdtPolygonWallet':_0xb246f[_0x259dff(0x12e)],'usdtTrcWallet':_0xb246f[_0x259dff(0x119)],'usdtErcWallet':_0xb246f[_0x259dff(0x160)],'usdcPolygonWallet':_0xb246f[_0x259dff(0x13f)]},'status':_0xb246f[_0x259dff(0x1dd)],'createdAt':_0xb246f[_0x259dff(0x1d9)]};}async['createUser'](_0x4df092){const _0x23f3cb=a35_0x2917c7,{fullName:_0x131884,username:_0x19ef8b,password:_0x4f1d7d,telegramId:_0x19ef1a,merchantUrl:_0x29a190,gateways:_0x1c72e0,gatewaySettings:_0xe193ad,wallets:_0x910508}=_0x4df092,_0x295048=await database_1[_0x23f3cb(0x1ea)]['shop'][_0x23f3cb(0x187)]({'where':{'username':_0x19ef8b}});if(_0x295048)throw new Error(_0x23f3cb(0x162));if(_0x19ef1a){const _0x506b26=await database_1[_0x23f3cb(0x1ea)][_0x23f3cb(0x154)][_0x23f3cb(0x187)]({'where':{'telegram':_0x19ef1a}});if(_0x506b26)throw new Error(_0x23f3cb(0x1e8));}const _0xb57269=await bcryptjs_1[_0x23f3cb(0x1ea)]['hash'](_0x4f1d7d,0xc),_0x35161f=_0x23f3cb(0x1f5)+crypto_1[_0x23f3cb(0x1ea)][_0x23f3cb(0x10d)](0x20)[_0x23f3cb(0x103)](_0x23f3cb(0x1f4)),_0x3d1a97=_0x23f3cb(0x15e)+crypto_1[_0x23f3cb(0x1ea)]['randomBytes'](0x20)[_0x23f3cb(0x103)]('hex'),_0x5d5486=await database_1['default'][_0x23f3cb(0x154)][_0x23f3cb(0x192)]({'data':{'name':_0x131884,'username':_0x19ef8b,'password':_0xb57269,'telegram':_0x19ef1a,'shopUrl':_0x29a190,'paymentGateways':_0x1c72e0?JSON[_0x23f3cb(0x13a)](_0x1c72e0):null,'gatewaySettings':_0xe193ad?JSON[_0x23f3cb(0x13a)](_0xe193ad):null,'usdtPolygonWallet':_0x910508?.[_0x23f3cb(0x12e)]||null,'usdtTrcWallet':_0x910508?.[_0x23f3cb(0x119)]||null,'usdtErcWallet':_0x910508?.[_0x23f3cb(0x160)]||null,'usdcPolygonWallet':_0x910508?.[_0x23f3cb(0x13f)]||null,'publicKey':_0x35161f,'secretKey':_0x3d1a97,'status':_0x23f3cb(0x1e0)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x5d5486['id'],'fullName':_0x5d5486[_0x23f3cb(0x1e9)],'username':_0x5d5486['username'],'telegramId':_0x5d5486['telegram'],'merchantUrl':_0x5d5486[_0x23f3cb(0x13e)],'gateways':_0x5d5486[_0x23f3cb(0x167)]?JSON[_0x23f3cb(0x202)](_0x5d5486['paymentGateways']):null,'gatewaySettings':_0x5d5486[_0x23f3cb(0x101)]?JSON['parse'](_0x5d5486[_0x23f3cb(0x101)]):null,'publicKey':_0x5d5486[_0x23f3cb(0x199)],'wallets':{'usdtPolygonWallet':_0x5d5486[_0x23f3cb(0x12e)],'usdtTrcWallet':_0x5d5486[_0x23f3cb(0x119)],'usdtErcWallet':_0x5d5486[_0x23f3cb(0x160)],'usdcPolygonWallet':_0x5d5486[_0x23f3cb(0x13f)]},'status':_0x5d5486['status'],'createdAt':_0x5d5486[_0x23f3cb(0x1d9)]};}async['deleteUser'](_0x516e44){const _0xa1d5c7=a35_0x2917c7;await database_1['default'][_0xa1d5c7(0x154)][_0xa1d5c7(0x18f)]({'where':{'id':_0x516e44}});}[a35_0x2917c7(0x1f0)](_0x52bfe5,_0x3924af,_0x332016){const _0x28f161=a35_0x2917c7,_0x9cc4d2=new Map(),_0x4996ee=new Date(_0x3924af);while(_0x4996ee<=_0x332016){const _0x199d09=_0x4996ee['toISOString']()[_0x28f161(0x152)]('T')[0x0];_0x9cc4d2[_0x28f161(0x1ad)](_0x199d09,{'revenue':0x0,'count':0x0}),_0x4996ee['setDate'](_0x4996ee[_0x28f161(0x135)]()+0x1);}for(const _0xa3dfe9 of _0x52bfe5){const _0xf6233c=_0xa3dfe9[_0x28f161(0x1d9)][_0x28f161(0x14b)]()[_0x28f161(0x152)]('T')[0x0],_0x2f8dc1=_0x9cc4d2['get'](_0xf6233c);_0x2f8dc1&&(_0x2f8dc1[_0x28f161(0x171)]+=0x1,_0xa3dfe9[_0x28f161(0x1dd)]===_0x28f161(0x194)&&(_0xa3dfe9[_0x28f161(0x18c)]?_0x2f8dc1['revenue']+=_0xa3dfe9[_0x28f161(0x18c)]:console[_0x28f161(0x12a)]('‚ö†Ô∏è\x20Payment\x20'+_0xa3dfe9['id']+_0x28f161(0x181))));}const _0x2f941b=[],_0xb3acdd=[];for(const [_0x7a3512,_0x4d462b]of _0x9cc4d2){_0x2f941b['push']({'date':_0x7a3512,'amount':Math[_0x28f161(0x125)](_0x4d462b[_0x28f161(0x1f9)]*0x64)/0x64}),_0xb3acdd[_0x28f161(0x111)]({'date':_0x7a3512,'count':_0x4d462b[_0x28f161(0x171)]});}return{'dailyRevenue':_0x2f941b,'dailyPayments':_0xb3acdd};}}exports['AdminService']=AdminService;