'use strict';function a35_0x4f2a(){const _0x2b151d=['\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','11VRcPFD','_sum','2873264zWNUvN','PAID','__esModule','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','⚠️\x20Payment\x20','📋\x20Found\x20','✅\x20Payout\x20created:\x20','customerCountry','AdminService','year','findMany','payment','toFixed','convertToUSDT','lte','awaitingPayout','map','\x20\x20\x20🔍\x20Raw\x20total\x20from\x20payments:\x20','\x20\x20\x20Merchant\x20gets:\x20','_count','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','push','../config/database','📊\x20Sorting\x20payments\x20by\x20','90204bxdFeR','toISOString','averageCommissionRate','\x20USDT)','totalAmountUSDT','gateways','customerUa','notes','getPaymentById','customerName','totalPaidOut','not\x20set','statusChangedAt','values','\x20USDT\x20from\x20balance','summary','balance','\x20->\x20','\x20\x20\x20📊\x20Total\x20payments:\x20','pendingUrl','\x20USDT\x20(after\x20payouts)','\x20\x20\x20🌍\x20Country:\x20','dailyRevenue','period','\x20\x20\x20Transaction\x20hash:\x20','adminNotes','successUrl','customerIp','set','\x20USDT','\x20USDT\x20(with\x20commission\x20deducted)','toLowerCase','name','📅\x20Period:\x20','admin','Error\x20processing\x20payment\x20','updatedAt','createUser','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','get','createPayout','\x20became\x20PAID:','totalCommissionRate','usdcPolygonWallet','turnover','findUnique','\x20USDT\x20(after\x20','some',',\x20Commission:\x20','30d','\x20USDT\x20(same\x20as\x20awaiting)','🔄\x20Converted\x20gateway\x20name\x20\x27','statusChangedBy','paymentsCount','updateUser','📊\x20Getting\x20payments\x20with\x20filters:','📅\x20Period\x20\x27all\x27:\x20Using\x20start\x20date\x20from\x20first\x20payment:\x20','\x20USDT,\x20Requested:\x20','\x20order','./currencyService','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','paidAt','currency','\x20\x20\x20🔍\x20Calculated\x20after\x20commission:\x20','Rapyd','💰\x20Found\x20','🔍\x20Using\x20gateway\x20\x27','deletePayout','REFUND','updatePaymentStatus','💸\x20CHARGEBACK\x20penalty:\x20-','entries','gatewaySettings','💰\x20Shop\x20','commission','getTime','\x20USDT\x20total\x20(based\x20on\x20actual\x20balances)','💱\x20Currency\x20filter\x20applied:\x20','\x20\x20\x20Added\x20to\x20balance:\x20+','merchantUrl','usdtErcWallet','asc','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','polygon','getMerchantsSelection','turnoverUSDT','dateFrom','\x20in\x20','wallets','round','test_gateway','network','Insufficient\x20balance.\x20Available:\x20','CoinToPay','amountUSDT','currencyService','\x20\x20\x20Merchant\x20loses:\x20','merchantEarnings','toUpperCase','💰\x20[PAYOUT]\x20Gateway\x20','\x20status:\x20','Noda','\x20\x20\x20💰\x20Total\x20payout:\x20','💰\x20Payment\x20','telegramId','\x27\x20to\x20name\x20\x27','txid','2020-01-01','chargebackAmount','\x20USDT\x20(','💸\x20CHARGEBACK:\x20Merchant\x20amount\x20already\x20deducted\x20from\x20balance','customerEmail','totalAmountAfterCommissionUSDT','KLYME\x20GB','67166urptgV','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','getAllPayments','231tCHNBS','\x20\x20\x20✅\x20Using\x20actual\x20balance\x20from\x20DB:\x20','setDate','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','insensitive','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','thisMonth','split','getAllPayouts','shopUrl','\x27\x20(from\x20\x27','deleteUser','ACTIVE','\x27\x20->\x20name\x20\x27','password','hex','shopId','month','4988190vyDQCL','includes','trc20','Payment\x20not\x20found','4JfVtxa','createdAt','$transaction','failUrl','count','desc','gatewayOrderId','shop','ceil','updateCustomerData','\x20\x20\x20Payout\x20amount:\x20','length','whiteUrl','gatewayEarnings','groupBy','📊\x20Gateway\x20filter\x20applied:','sort','amount','\x20merchants,\x20','9iEbqoH','🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','custom','error','gateway','\x20payments)','generateDailyStatistics','0000','averageCheckUSDT','getGatewayDisplayName','COMPLETED','getPayoutStats','payout','totalTurnover','getGatewayIdByName','getMonth','📊\x20Available\x20gateways\x20in\x20database:','💳\x20Payout\x20wallet\x20for\x20','create','periodTo','📊\x20Merchants\x20awaiting\x20payout:\x20','CHARGEBACK','dateTo','gte','stringify','externalPaymentUrl','localeCompare','⚠️\x20Requested\x20gateway\x20\x27','Test\x20Gateway','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','randomBytes','KLYME\x20DE','32QVtsMS','📊\x20Merchant\x20statistics\x20calculated:','%\x20commission)','update','90d','\x20USDT\x20(for\x20reference\x20only)','\x20\x20\x20🖥️\x20User\x20Agent:\x20','\x27\x20not\x20found.\x20Available\x20gateways:\x20','periodFrom','polygon_usdc','⚠️\x20Gateway\x20\x27','orderId','\x20\x20\x20Total\x20paid\x20out:\x20','failureMessage','amountAfterCommissionUSDT','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','pk_','default','usdtPolygonWallet','📊\x20Total\x20payments\x20(including\x20failed):\x20','forEach','NONEXISTENT_GATEWAY_FILTER','log','reduce','Plisio','84ErHBXo','fullName','week','KLYME\x20EU','../types/gateway','\x20\x20\x20Balance:\x20','🔄\x20Admin\x20updating\x20payment\x20',',\x20successful:\x20','getGatewayNameById','8854320OTEFyr','hash','erc20','✅\x20Using\x20gateway\x20filter:\x20\x27','username','delete','bcryptjs','merchantEarningsUSDT','870490SwBgoe',':\x20commission\x20=\x20','not\x20specified','\x20\x20\x20Full\x20amount:\x20','defineProperty','\x20\x20\x20💰\x20Total\x20turnover:\x20','parse','📊\x20Calculating\x20payout\x20statistics...','wallet','telegram','publicKey','status','getAllUsers','commissionUSDT','3054701fCqXVW','crypto','usdtTrcWallet','revenue','📋\x20Getting\x20merchants\x20selection\x20list...','all','paymentGateways','aggregate','\x20\x20\x20📅\x20This\x20month:\x20','📊\x20Payout\x20statistics\x20calculated:'];a35_0x4f2a=function(){return _0x2b151d;};return a35_0x4f2a();}function a35_0x528a(_0x1a4a84,_0x567393){const _0x4f2ad0=a35_0x4f2a();return a35_0x528a=function(_0x528ab9,_0x2a16a7){_0x528ab9=_0x528ab9-0xaa;let _0x535493=_0x4f2ad0[_0x528ab9];return _0x535493;},a35_0x528a(_0x1a4a84,_0x567393);}const a35_0x3d503b=a35_0x528a;(function(_0x4eb9b6,_0x284fd2){const _0x434cb7=a35_0x528a,_0x4283a3=_0x4eb9b6();while(!![]){try{const _0x5c2a69=-parseInt(_0x434cb7(0x129))/0x1*(parseInt(_0x434cb7(0xdd))/0x2)+parseInt(_0x434cb7(0xf2))/0x3*(-parseInt(_0x434cb7(0xf6))/0x4)+parseInt(_0x434cb7(0x14b))/0x5+parseInt(_0x434cb7(0x186))/0x6*(parseInt(_0x434cb7(0xe0))/0x7)+-parseInt(_0x434cb7(0x16e))/0x8*(parseInt(_0x434cb7(0x109))/0x9)+parseInt(_0x434cb7(0x153))/0xa*(parseInt(_0x434cb7(0x16c))/0xb)+parseInt(_0x434cb7(0x142))/0xc*(parseInt(_0x434cb7(0x161))/0xd);if(_0x5c2a69===_0x284fd2)break;else _0x4283a3['push'](_0x4283a3['shift']());}catch(_0x5a097d){_0x4283a3['push'](_0x4283a3['shift']());}}}(a35_0x4f2a,0xdc4ba));var __importDefault=this&&this['__importDefault']||function(_0x2ccf98){const _0x56ec34=a35_0x528a;return _0x2ccf98&&_0x2ccf98[_0x56ec34(0x170)]?_0x2ccf98:{'default':_0x2ccf98};};Object[a35_0x3d503b(0x157)](exports,'__esModule',{'value':!![]}),exports[a35_0x3d503b(0x176)]=void 0x0;const database_1=__importDefault(require(a35_0x3d503b(0x184))),bcryptjs_1=__importDefault(require(a35_0x3d503b(0x151))),crypto_1=__importDefault(require(a35_0x3d503b(0x162))),currencyService_1=require(a35_0x3d503b(0x1c1)),gateway_1=require(a35_0x3d503b(0x146));class AdminService{async[a35_0x3d503b(0x114)](){const _0x540f8=a35_0x3d503b;console[_0x540f8(0x13f)](_0x540f8(0x15a));const _0x3c1c73=await database_1[_0x540f8(0x13a)][_0x540f8(0xfd)][_0x540f8(0x168)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x540f8(0xec)}}),_0xcb8ec9=await this['getMerchantsAwaitingPayout']({'page':0x1,'limit':0x3e8}),_0x5bb20b=new Date(),_0x12a68f=new Date(_0x5bb20b['getFullYear'](),_0x5bb20b[_0x540f8(0x118)](),0x1),_0x5118ef=new Date(_0x5bb20b['getFullYear'](),_0x5bb20b[_0x540f8(0x118)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x178332=await database_1[_0x540f8(0x13a)][_0x540f8(0x115)][_0x540f8(0x168)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x12a68f,'lte':_0x5118ef},'status':_0x540f8(0x113)}}),_0x4e5d89=_0x3c1c73[_0x540f8(0x16d)][_0x540f8(0x190)]||0x0,_0x4bfed8=_0xcb8ec9[_0x540f8(0x195)][_0x540f8(0xdb)],_0x5af30c=_0x178332[_0x540f8(0x16d)]['amount']||0x0,_0x375161={'totalPayout':Math[_0x540f8(0xc4)](_0x4e5d89*0x64)/0x64,'awaitingPayout':Math['round'](_0x4bfed8*0x64)/0x64,'thisMonth':Math[_0x540f8(0xc4)](_0x5af30c*0x64)/0x64,'availableBalance':Math['round'](_0x4bfed8*0x64)/0x64};return console[_0x540f8(0x13f)](_0x540f8(0x16a)),console[_0x540f8(0x13f)](_0x540f8(0xd1)+_0x375161['totalPayout']+'\x20USDT\x20(total\x20paid\x20to\x20merchants)'),console[_0x540f8(0x13f)]('\x20\x20\x20⏳\x20Awaiting\x20payout:\x20'+_0x375161[_0x540f8(0x17d)]+_0x540f8(0x1a4)),console[_0x540f8(0x13f)]('\x20\x20\x20💵\x20Available\x20balance:\x20'+_0x375161['availableBalance']+_0x540f8(0x1b8)),console[_0x540f8(0x13f)](_0x540f8(0x169)+_0x375161[_0x540f8(0xe6)]+_0x540f8(0x1a3)),console['log']('\x20\x20\x20🔍\x20Raw\x20balance\x20sum:\x20'+(_0x3c1c73[_0x540f8(0x16d)][_0x540f8(0x196)]||0x0)[_0x540f8(0x17a)](0x2)+'\x20USDT\x20(without\x20commission)'),console[_0x540f8(0x13f)]('\x20\x20\x20📊\x20Commission\x20difference:\x20'+((_0x3c1c73['_sum'][_0x540f8(0x196)]||0x0)-_0x4bfed8)[_0x540f8(0x17a)](0x2)+_0x540f8(0x1a3)),_0x375161;}async[a35_0x3d503b(0xff)](_0x38fabd,_0x708b0a){const _0xaf8fb4=a35_0x3d503b;console['log']('🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20'+_0x38fabd+':',_0x708b0a);const _0x30ec6f=await database_1[_0xaf8fb4(0x13a)][_0xaf8fb4(0x179)][_0xaf8fb4(0x1b3)]({'where':{'id':_0x38fabd},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x30ec6f)throw new Error('Payment\x20not\x20found');const _0x1838de={};_0x708b0a[_0xaf8fb4(0x175)]!==undefined&&(_0x1838de['customerCountry']=_0x708b0a['customerCountry']||null);_0x708b0a[_0xaf8fb4(0x1a1)]!==undefined&&(_0x1838de['customerIp']=_0x708b0a[_0xaf8fb4(0x1a1)]||null);_0x708b0a['customerUa']!==undefined&&(_0x1838de['customerUa']=_0x708b0a[_0xaf8fb4(0x18c)]||null);const _0x1268eb=await database_1[_0xaf8fb4(0x13a)][_0xaf8fb4(0x179)][_0xaf8fb4(0x12c)]({'where':{'id':_0x38fabd},'data':{..._0x1838de,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0xaf8fb4(0x13f)](_0xaf8fb4(0x1ac)+_0x38fabd),console['log'](_0xaf8fb4(0x19b)+_0x30ec6f['customerCountry']+_0xaf8fb4(0x197)+_0x1268eb[_0xaf8fb4(0x175)]),console[_0xaf8fb4(0x13f)]('\x20\x20\x20🌐\x20IP:\x20'+_0x30ec6f[_0xaf8fb4(0x1a1)]+_0xaf8fb4(0x197)+_0x1268eb[_0xaf8fb4(0x1a1)]),console[_0xaf8fb4(0x13f)](_0xaf8fb4(0x12f)+(_0x30ec6f[_0xaf8fb4(0x18c)]?_0xaf8fb4(0x1a2):'not\x20set')+_0xaf8fb4(0x197)+(_0x1268eb[_0xaf8fb4(0x18c)]?'set':_0xaf8fb4(0x191))),_0x1268eb;}async['getSystemStatistics'](_0xd3316b){const _0x285c79=a35_0x3d503b,_0x357992=new Date();let _0x45fc6e;switch(_0xd3316b){case'7d':_0x45fc6e=new Date(_0x357992[_0x285c79(0xb6)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x285c79(0x1b7):_0x45fc6e=new Date(_0x357992[_0x285c79(0xb6)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x285c79(0x12d):_0x45fc6e=new Date(_0x357992[_0x285c79(0xb6)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x285c79(0x166):const _0x2a080a=await database_1[_0x285c79(0x13a)][_0x285c79(0x179)]['findFirst']({'where':{'gateway':{'not':_0x285c79(0xc5)}},'orderBy':{'createdAt':_0x285c79(0xbc)},'select':{'createdAt':!![]}});_0x45fc6e=_0x2a080a?_0x2a080a[_0x285c79(0xf7)]:new Date(_0x285c79(0xd6)),console[_0x285c79(0x13f)](_0x285c79(0x1be)+_0x45fc6e['toISOString']());break;default:_0x45fc6e=new Date(_0x357992[_0x285c79(0xb6)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x5e5045,_0x2cb9e0,_0x4ca145,_0x57e662,_0x479ad0,_0x2b7b29,_0x64bb23]=await Promise['all']([database_1[_0x285c79(0x13a)]['shop'][_0x285c79(0xfa)](),database_1[_0x285c79(0x13a)][_0x285c79(0xfd)]['count']({'where':{'status':_0x285c79(0xec)}}),database_1[_0x285c79(0x13a)][_0x285c79(0x179)][_0x285c79(0xfa)]({'where':{'createdAt':{'gte':_0x45fc6e},'gateway':{'not':_0x285c79(0xc5)}}}),database_1['default'][_0x285c79(0x179)][_0x285c79(0xfa)]({'where':{'status':_0x285c79(0x16f),'createdAt':{'gte':_0x45fc6e},'gateway':{'not':_0x285c79(0xc5)}}}),database_1[_0x285c79(0x13a)][_0x285c79(0x179)]['findMany']({'where':{'status':_0x285c79(0x16f),'createdAt':{'gte':_0x45fc6e},'gateway':{'not':_0x285c79(0xc5)}},'select':{'amount':!![],'currency':!![]}}),database_1[_0x285c79(0x13a)]['payment'][_0x285c79(0x178)]({'where':{'gateway':{'not':'test_gateway'}},'take':0xa,'orderBy':{'createdAt':_0x285c79(0xfb)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x285c79(0x13a)][_0x285c79(0x179)][_0x285c79(0x178)]({'where':{'createdAt':{'gte':_0x45fc6e},'gateway':{'not':_0x285c79(0xc5)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0xaab350=0x0;for(const _0x101b3a of _0x479ad0){const _0x51ccb9=await currencyService_1[_0x285c79(0xca)][_0x285c79(0x17b)](_0x101b3a['amount'],_0x101b3a[_0x285c79(0x1c4)]);_0xaab350+=_0x51ccb9;}const _0x480f81=this[_0x285c79(0x10f)](_0x64bb23,_0x45fc6e,_0x357992),_0x295e46=_0x4ca145>0x0?_0x57e662/_0x4ca145*0x64:0x0;return{'totalShops':_0x5e5045,'activeShops':_0x2cb9e0,'totalPayments':_0x4ca145,'successfulPayments':_0x57e662,'totalRevenue':Math['round'](_0xaab350*0x64)/0x64,'conversionRate':Math[_0x285c79(0xc4)](_0x295e46*0x64)/0x64,'dailyRevenue':_0x480f81[_0x285c79(0x19c)],'dailyPayments':_0x480f81['dailyPayments'],'recentPayments':_0x2b7b29['map'](_0x4c4af7=>({'id':_0x4c4af7['id'],'amount':_0x4c4af7[_0x285c79(0x107)],'currency':_0x4c4af7[_0x285c79(0x1c4)],'status':_0x4c4af7[_0x285c79(0x15e)],'gateway':_0x4c4af7['gateway'],'shop':_0x4c4af7['shop'],'createdAt':_0x4c4af7[_0x285c79(0xf7)]}))};}async['getMerchantStatistics'](_0x317a57){const _0xc5418b=a35_0x3d503b;console['log'](_0xc5418b(0x138),_0x317a57);let _0x212b6e,_0x32a6ca=new Date();if(_0x317a57[_0xc5418b(0x19d)]===_0xc5418b(0x10b)&&_0x317a57[_0xc5418b(0xc1)]&&_0x317a57['dateTo'])_0x212b6e=new Date(_0x317a57['dateFrom']),_0x32a6ca=new Date(_0x317a57[_0xc5418b(0x11f)]);else{const _0x561de8=new Date();switch(_0x317a57[_0xc5418b(0x19d)]){case _0xc5418b(0x144):_0x212b6e=new Date(_0x561de8['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0xc5418b(0xf1):_0x212b6e=new Date(_0x561de8[_0xc5418b(0xb6)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0xc5418b(0x177):_0x212b6e=new Date(_0x561de8[_0xc5418b(0xb6)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case'all':default:_0x212b6e=new Date(_0xc5418b(0xd6));break;}}console[_0xc5418b(0x13f)](_0xc5418b(0x1a7)+_0x212b6e[_0xc5418b(0x187)]()+'\x20to\x20'+_0x32a6ca[_0xc5418b(0x187)]());const _0x19ae73={'status':'PAID','gateway':{'not':_0xc5418b(0xc5)},'paidAt':{'gte':_0x212b6e,'lte':_0x32a6ca}};_0x317a57[_0xc5418b(0xf0)]&&(_0x19ae73['shopId']=_0x317a57[_0xc5418b(0xf0)]);const _0x158d8e=await database_1[_0xc5418b(0x13a)]['payment']['findMany']({'where':_0x19ae73,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console['log'](_0xc5418b(0xac)+_0x158d8e[_0xc5418b(0x101)]+'\x20paid\x20payments\x20for\x20analysis');const _0x4372fe={'gateway':{'not':_0xc5418b(0xc5)},'createdAt':{'gte':_0x212b6e,'lte':_0x32a6ca}};_0x317a57[_0xc5418b(0xf0)]&&(_0x4372fe['shopId']=_0x317a57[_0xc5418b(0xf0)]);const _0x3d37fc=await database_1['default'][_0xc5418b(0x179)][_0xc5418b(0xfa)]({'where':_0x4372fe});console['log'](_0xc5418b(0x13c)+_0x3d37fc+_0xc5418b(0x149)+_0x158d8e['length']);let _0xcd3a0=0x0,_0x34e11c=0x0,_0x363b03=0x0;const _0x13c9fa={},_0x52e8a8={},_0xf2e07f={};for(const _0x403e6e of _0x158d8e){try{const _0x1824b2=await currencyService_1[_0xc5418b(0xca)][_0xc5418b(0x17b)](_0x403e6e['amount'],_0x403e6e['currency']);let _0x3a2fda={};if(_0x403e6e['shop']['gatewaySettings'])try{_0x3a2fda=JSON[_0xc5418b(0x159)](_0x403e6e[_0xc5418b(0xfd)]['gatewaySettings']);}catch(_0x5ab6ae){console[_0xc5418b(0x10c)](_0xc5418b(0x182)+_0x403e6e[_0xc5418b(0xf0)]+':',_0x5ab6ae);}let _0x46b9ba={},_0x1b722a=0xa;for(const [_0x2892b5,_0x3b6b04]of Object[_0xc5418b(0xb2)](_0x3a2fda)){if(_0x2892b5['toLowerCase']()===_0x403e6e[_0xc5418b(0x10d)]['toLowerCase']()){_0x46b9ba=_0x3b6b04,_0x1b722a=_0x3b6b04[_0xc5418b(0xb5)]||0xa;break;}}const _0x3df165=_0x1824b2*(_0x1b722a/0x64),_0x39bd8a=_0x1824b2-_0x3df165;_0xcd3a0+=_0x1824b2,_0x34e11c+=_0x39bd8a,_0x363b03+=_0x3df165;!_0x13c9fa[_0x403e6e[_0xc5418b(0x10d)]]&&(_0x13c9fa[_0x403e6e[_0xc5418b(0x10d)]]={'gateway':_0x403e6e[_0xc5418b(0x10d)],'gatewayDisplayName':this['getGatewayDisplayName'](_0x403e6e[_0xc5418b(0x10d)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x13c9fa[_0x403e6e[_0xc5418b(0x10d)]][_0xc5418b(0x1bb)]++,_0x13c9fa[_0x403e6e[_0xc5418b(0x10d)]]['turnoverUSDT']+=_0x1824b2,_0x13c9fa[_0x403e6e[_0xc5418b(0x10d)]][_0xc5418b(0x160)]+=_0x3df165,_0x13c9fa[_0x403e6e['gateway']]['merchantEarningsUSDT']+=_0x39bd8a,_0x13c9fa[_0x403e6e[_0xc5418b(0x10d)]][_0xc5418b(0x1b0)]+=_0x1b722a;!_0x317a57['shopId']&&(!_0x52e8a8[_0x403e6e['shopId']]&&(_0x52e8a8[_0x403e6e[_0xc5418b(0xf0)]]={'shopId':_0x403e6e[_0xc5418b(0xf0)],'shopName':_0x403e6e[_0xc5418b(0xfd)][_0xc5418b(0x1a6)],'shopUsername':_0x403e6e[_0xc5418b(0xfd)][_0xc5418b(0x14f)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x52e8a8[_0x403e6e[_0xc5418b(0xf0)]][_0xc5418b(0x1bb)]++,_0x52e8a8[_0x403e6e[_0xc5418b(0xf0)]][_0xc5418b(0xc0)]+=_0x1824b2,_0x52e8a8[_0x403e6e[_0xc5418b(0xf0)]]['commissionUSDT']+=_0x3df165,_0x52e8a8[_0x403e6e[_0xc5418b(0xf0)]]['merchantEarningsUSDT']+=_0x39bd8a);const _0x4980ec=_0x403e6e['paidAt']['toISOString']()[_0xc5418b(0xe7)]('T')[0x0];!_0xf2e07f[_0x4980ec]&&(_0xf2e07f[_0x4980ec]={'date':_0x4980ec,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0xf2e07f[_0x4980ec][_0xc5418b(0x1b2)]+=_0x1824b2,_0xf2e07f[_0x4980ec][_0xc5418b(0xcc)]+=_0x39bd8a,_0xf2e07f[_0x4980ec][_0xc5418b(0x103)]+=_0x3df165,_0xf2e07f[_0x4980ec][_0xc5418b(0x1bb)]++;}catch(_0x115fb5){console['error'](_0xc5418b(0x1a9)+_0x403e6e['id']+':',_0x115fb5);}}Object[_0xc5418b(0x193)](_0x13c9fa)[_0xc5418b(0x13d)](_0x5b1065=>{const _0x2238a2=_0xc5418b;_0x5b1065[_0x2238a2(0x188)]=_0x5b1065[_0x2238a2(0x1bb)]>0x0?_0x5b1065[_0x2238a2(0x1b0)]/_0x5b1065[_0x2238a2(0x1bb)]:0x0,delete _0x5b1065[_0x2238a2(0x1b0)];}),Object[_0xc5418b(0x193)](_0x52e8a8)[_0xc5418b(0x13d)](_0x280572=>{const _0x27fe7c=_0xc5418b;_0x280572[_0x27fe7c(0x111)]=_0x280572[_0x27fe7c(0x1bb)]>0x0?_0x280572[_0x27fe7c(0xc0)]/_0x280572[_0x27fe7c(0x1bb)]:0x0;});let _0x14b3ff=0x0;if(_0x317a57['shopId']){const _0x3bbdb4=await database_1['default'][_0xc5418b(0x115)]['findMany']({'where':{'shopId':_0x317a57['shopId'],'status':_0xc5418b(0x113),'createdAt':{'gte':_0x212b6e,'lte':_0x32a6ca}},'select':{'amount':!![]}});_0x14b3ff=_0x3bbdb4['reduce']((_0x279f77,_0x2839f0)=>_0x279f77+_0x2839f0['amount'],0x0);}const _0x4e1b27=_0x3d37fc,_0x4ac4c5=_0x158d8e[_0xc5418b(0x101)],_0xb407b2=_0x4ac4c5>0x0?_0xcd3a0/_0x4ac4c5:0x0,_0x19acb2=_0x4e1b27>0x0?Math[_0xc5418b(0xc4)](_0x4ac4c5/_0x4e1b27*0x2710)/0x64:0x0,_0x17d8b9=Math[_0xc5418b(0xfe)]((_0x32a6ca[_0xc5418b(0xb6)]()-_0x212b6e[_0xc5418b(0xb6)]())/(0x3e8*0x3c*0x3c*0x18)),_0x44a9a1={'totalTurnover':Math[_0xc5418b(0xc4)](_0xcd3a0*0x64)/0x64,'merchantEarnings':Math[_0xc5418b(0xc4)](_0x34e11c*0x64)/0x64,'gatewayEarnings':Math[_0xc5418b(0xc4)](_0x363b03*0x64)/0x64,'totalPaidOut':Math[_0xc5418b(0xc4)](_0x14b3ff*0x64)/0x64,'averageCheck':Math[_0xc5418b(0xc4)](_0xb407b2*0x64)/0x64,'totalPayments':_0x4e1b27,'successfulPayments':_0x4ac4c5,'conversionRate':_0x19acb2,'gatewayBreakdown':Object[_0xc5418b(0x193)](_0x13c9fa)[_0xc5418b(0x17e)](_0x13e5b9=>({..._0x13e5b9,'turnoverUSDT':Math[_0xc5418b(0xc4)](_0x13e5b9[_0xc5418b(0xc0)]*0x64)/0x64,'commissionUSDT':Math[_0xc5418b(0xc4)](_0x13e5b9['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0xc5418b(0xc4)](_0x13e5b9['merchantEarningsUSDT']*0x64)/0x64,'averageCommissionRate':Math[_0xc5418b(0xc4)](_0x13e5b9[_0xc5418b(0x188)]*0x64)/0x64})),'merchantBreakdown':_0x317a57['shopId']?undefined:Object[_0xc5418b(0x193)](_0x52e8a8)[_0xc5418b(0x17e)](_0x5cb5fe=>({..._0x5cb5fe,'turnoverUSDT':Math[_0xc5418b(0xc4)](_0x5cb5fe[_0xc5418b(0xc0)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x5cb5fe['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0xc5418b(0xc4)](_0x5cb5fe[_0xc5418b(0x152)]*0x64)/0x64,'paidOutUSDT':Math[_0xc5418b(0xc4)](_0x5cb5fe['paidOutUSDT']*0x64)/0x64,'averageCheckUSDT':Math['round'](_0x5cb5fe['averageCheckUSDT']*0x64)/0x64})),'dailyData':Object[_0xc5418b(0x193)](_0xf2e07f)[_0xc5418b(0x17e)](_0x256aa1=>({..._0x256aa1,'turnover':Math['round'](_0x256aa1['turnover']*0x64)/0x64,'merchantEarnings':Math['round'](_0x256aa1[_0xc5418b(0xcc)]*0x64)/0x64,'gatewayEarnings':Math[_0xc5418b(0xc4)](_0x256aa1[_0xc5418b(0x103)]*0x64)/0x64}))[_0xc5418b(0x106)]((_0xb279a8,_0x202797)=>_0xb279a8['date'][_0xc5418b(0x123)](_0x202797['date'])),'periodInfo':{'from':_0x212b6e,'to':_0x32a6ca,'periodType':_0x317a57[_0xc5418b(0x19d)]||_0xc5418b(0x10b),'daysCount':_0x17d8b9}};return console[_0xc5418b(0x13f)](_0xc5418b(0x12a)),console['log'](_0xc5418b(0x158)+_0x44a9a1[_0xc5418b(0x116)]+_0xc5418b(0x1a3)),console['log'](_0xc5418b(0xe5)+_0x44a9a1[_0xc5418b(0xcc)]+'\x20USDT'),console[_0xc5418b(0x13f)](_0xc5418b(0xbd)+_0x44a9a1[_0xc5418b(0x103)]+_0xc5418b(0x1a3)),console['log'](_0xc5418b(0x198)+_0x44a9a1['totalPayments']),_0x44a9a1;}async[a35_0x3d503b(0xbf)](){const _0x1b52b3=a35_0x3d503b;console[_0x1b52b3(0x13f)](_0x1b52b3(0x165));const _0x54f358=await database_1['default']['shop'][_0x1b52b3(0x178)]({'where':{'status':_0x1b52b3(0xec)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x1b52b3(0xbc)}});return console[_0x1b52b3(0x13f)](_0x1b52b3(0x173)+_0x54f358[_0x1b52b3(0x101)]+'\x20active\x20merchants\x20for\x20selection'),_0x54f358[_0x1b52b3(0x17e)](_0x58636b=>({'id':_0x58636b['id'],'username':_0x58636b[_0x1b52b3(0x14f)],'name':_0x58636b[_0x1b52b3(0x1a6)]}));}[a35_0x3d503b(0x112)](_0x48a0a0){const _0x1473a8=a35_0x3d503b,_0x29f9f0={'test_gateway':_0x1473a8(0x125),'plisio':_0x1473a8(0x141),'rapyd':_0x1473a8(0xab),'noda':_0x1473a8(0xd0),'cointopay':_0x1473a8(0xc8),'klyme_eu':_0x1473a8(0x145),'klyme_gb':_0x1473a8(0xdc),'klyme_de':_0x1473a8(0x128)};return _0x29f9f0[_0x48a0a0]||_0x48a0a0;}async['getMerchantsAwaitingPayout'](_0x195a47){const _0x599487=a35_0x3d503b,{page:_0x25a42f,limit:_0x49c7e3,minAmount:_0x20abac,search:_0x560c5e}=_0x195a47,_0x13f47e=(_0x25a42f-0x1)*_0x49c7e3;console[_0x599487(0x13f)](_0x599487(0x171),_0x195a47);const _0x565100={'balance':{'gt':0x0},'status':_0x599487(0xec)};_0x20abac&&(_0x565100[_0x599487(0x196)][_0x599487(0x120)]=_0x20abac);_0x560c5e&&(_0x565100['OR']=[{'name':{'contains':_0x560c5e,'mode':_0x599487(0xe4)}},{'username':{'contains':_0x560c5e,'mode':'insensitive'}}]);const [_0x300a58,_0x4918eb]=await Promise[_0x599487(0x166)]([database_1[_0x599487(0x13a)][_0x599487(0xfd)]['findMany']({'where':_0x565100,'skip':_0x13f47e,'take':_0x49c7e3,'orderBy':{'balance':_0x599487(0xfb)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1[_0x599487(0x13a)][_0x599487(0xfd)][_0x599487(0xfa)]({'where':_0x565100})]);console['log'](_0x599487(0xac)+_0x300a58['length']+'\x20merchants\x20with\x20positive\x20balance');const _0x19453d=await Promise[_0x599487(0x166)](_0x300a58[_0x599487(0x17e)](async _0x2b1d7e=>{const _0x43fbe3=_0x599487,[_0x551849,_0x20f524,_0x41399f]=await Promise[_0x43fbe3(0x166)]([database_1[_0x43fbe3(0x13a)]['payment'][_0x43fbe3(0xfa)]({'where':{'shopId':_0x2b1d7e['id'],'status':_0x43fbe3(0x16f),'amountUSDT':{'not':null}}}),database_1[_0x43fbe3(0x13a)]['payment']['findFirst']({'where':{'shopId':_0x2b1d7e['id'],'status':'PAID','amountUSDT':{'not':null}},'orderBy':{'paidAt':_0x43fbe3(0xbc)},'select':{'paidAt':!![]}}),database_1[_0x43fbe3(0x13a)][_0x43fbe3(0x179)][_0x43fbe3(0x104)]({'by':[_0x43fbe3(0x10d)],'where':{'shopId':_0x2b1d7e['id'],'status':'PAID','amountUSDT':{'not':null}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0xe25649=await Promise[_0x43fbe3(0x166)](_0x41399f[_0x43fbe3(0x17e)](async _0x231277=>{const _0x381320=_0x43fbe3;let _0x333d2c=0xa;if(_0x2b1d7e[_0x381320(0xb3)])try{const _0x4cb841=JSON[_0x381320(0x159)](_0x2b1d7e[_0x381320(0xb3)]);for(const [_0x5ac5b2,_0x338a14]of Object['entries'](_0x4cb841)){if(_0x5ac5b2[_0x381320(0x1a5)]()===_0x231277['gateway'][_0x381320(0x1a5)]()){_0x333d2c=_0x338a14[_0x381320(0xb5)]||0xa,console[_0x381320(0x13f)](_0x381320(0xce)+_0x231277[_0x381320(0x10d)]+'\x20for\x20shop\x20'+_0x2b1d7e['id']+_0x381320(0x154)+_0x333d2c+'%');break;}}}catch(_0x3ea5a9){console[_0x381320(0x10c)](_0x381320(0x182)+_0x2b1d7e['id']+':',_0x3ea5a9);}const _0x1735c1=_0x231277[_0x381320(0x16d)][_0x381320(0xc9)]||0x0,_0x1429b1=_0x1735c1*(0x1-_0x333d2c/0x64);return{'gateway':_0x231277['gateway'],'count':_0x231277['_count']['id'],'amountUSDT':Math['round'](_0x1735c1*0x64)/0x64,'amountAfterCommissionUSDT':Math['round'](_0x1429b1*0x64)/0x64,'commission':_0x333d2c};})),_0x2fe545=_0x2b1d7e[_0x43fbe3(0x196)];return console['log']('💰\x20[PAYOUT]\x20Merchant\x20'+_0x2b1d7e[_0x43fbe3(0x14f)]+':'),console[_0x43fbe3(0x13f)](_0x43fbe3(0x17f)+_0xe25649[_0x43fbe3(0x140)]((_0x5aa4c9,_0x29f53b)=>_0x5aa4c9+_0x29f53b[_0x43fbe3(0xc9)],0x0)+_0x43fbe3(0x12e)),console[_0x43fbe3(0x13f)](_0x43fbe3(0xaa)+_0xe25649['reduce']((_0x1e5a45,_0x5d661f)=>_0x1e5a45+_0x5d661f[_0x43fbe3(0x137)],0x0)+_0x43fbe3(0x12e)),console[_0x43fbe3(0x13f)](_0x43fbe3(0xe1)+_0x2fe545+_0x43fbe3(0x19a)),{'id':_0x2b1d7e['id'],'fullName':_0x2b1d7e[_0x43fbe3(0x1a6)],'username':_0x2b1d7e[_0x43fbe3(0x14f)],'telegramId':_0x2b1d7e[_0x43fbe3(0x15c)],'merchantUrl':_0x2b1d7e['shopUrl'],'wallets':{'usdtPolygonWallet':_0x2b1d7e['usdtPolygonWallet'],'usdtTrcWallet':_0x2b1d7e[_0x43fbe3(0x163)],'usdtErcWallet':_0x2b1d7e['usdtErcWallet'],'usdcPolygonWallet':_0x2b1d7e[_0x43fbe3(0x1b1)]},'totalAmountUSDT':Math[_0x43fbe3(0xc4)](_0x2fe545*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x43fbe3(0xc4)](_0x2fe545*0x64)/0x64,'paymentsCount':_0x551849,'oldestPaymentDate':_0x20f524?.[_0x43fbe3(0x1c3)]||_0x2b1d7e['createdAt'],'gatewayBreakdown':_0xe25649};})),_0x195129=_0x19453d[_0x599487(0x140)]((_0x470318,_0x2ebc39)=>_0x470318+_0x2ebc39[_0x599487(0x18a)],0x0),_0x2021dc=_0x19453d[_0x599487(0x140)]((_0x5bf5c3,_0x3f668f)=>_0x5bf5c3+_0x3f668f[_0x599487(0xdb)],0x0);return console[_0x599487(0x13f)](_0x599487(0x11d)+_0x4918eb+_0x599487(0x108)+Math['round'](_0x2021dc*0x64)/0x64+_0x599487(0xb7)),{'merchants':_0x19453d,'pagination':{'page':_0x25a42f,'limit':_0x49c7e3,'total':_0x4918eb,'totalPages':Math['ceil'](_0x4918eb/_0x49c7e3)},'summary':{'totalMerchants':_0x4918eb,'totalAmountUSDT':Math['round'](_0x195129*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x599487(0xc4)](_0x2021dc*0x64)/0x64}};}async[a35_0x3d503b(0x1ae)](_0x5938dd){const _0x480e39=a35_0x3d503b,{shopId:_0xe421e0,amount:_0x7641dc,network:_0x4a0ed6,wallet:_0x2044d7,notes:_0x480091,txid:_0x4d800e,periodFrom:_0x215863,periodTo:_0x108641}=_0x5938dd,_0x1c0f34=await database_1['default'][_0x480e39(0xf8)](async _0x1a0847=>{const _0x5409d5=_0x480e39,_0x2d00dc=await _0x1a0847[_0x5409d5(0xfd)][_0x5409d5(0x1b3)]({'where':{'id':_0xe421e0},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x2d00dc)throw new Error('Shop\x20not\x20found');console['log']('💰\x20Creating\x20payout\x20for\x20shop\x20'+_0x2d00dc[_0x5409d5(0x14f)]+':'),console[_0x5409d5(0x13f)]('\x20\x20\x20Current\x20balance:\x20'+_0x2d00dc[_0x5409d5(0x196)]['toFixed'](0x6)+'\x20USDT'),console[_0x5409d5(0x13f)](_0x5409d5(0x100)+_0x7641dc[_0x5409d5(0x17a)](0x6)+_0x5409d5(0x1a3)),console[_0x5409d5(0x13f)]('\x20\x20\x20Current\x20total\x20paid\x20out:\x20'+_0x2d00dc[_0x5409d5(0x190)][_0x5409d5(0x17a)](0x6)+_0x5409d5(0x1a3));if(_0x4d800e)console[_0x5409d5(0x13f)](_0x5409d5(0x19e)+_0x4d800e);if(_0x2d00dc[_0x5409d5(0x196)]<_0x7641dc)throw new Error(_0x5409d5(0xc7)+_0x2d00dc['balance'][_0x5409d5(0x17a)](0x6)+_0x5409d5(0x1bf)+_0x7641dc['toFixed'](0x6)+_0x5409d5(0x1a3));let _0x2708d5=_0x2044d7;if(!_0x2708d5){const _0x192b0f=await _0x1a0847['shop'][_0x5409d5(0x1b3)]({'where':{'id':_0xe421e0},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x192b0f)switch(_0x4a0ed6){case _0x5409d5(0xbe):_0x2708d5=_0x192b0f['usdtPolygonWallet']||undefined;break;case _0x5409d5(0xf4):_0x2708d5=_0x192b0f[_0x5409d5(0x163)]||undefined;break;case _0x5409d5(0x14d):_0x2708d5=_0x192b0f[_0x5409d5(0xbb)]||undefined;break;case _0x5409d5(0x132):_0x2708d5=_0x192b0f[_0x5409d5(0x1b1)]||undefined;break;}}console[_0x5409d5(0x13f)](_0x5409d5(0x11a)+_0x4a0ed6+':\x20'+(_0x2708d5||_0x5409d5(0x155)));const _0x2eeb59=await _0x1a0847['payout'][_0x5409d5(0x11b)]({'data':{'shopId':_0xe421e0,'amount':_0x7641dc,'network':_0x4a0ed6,'wallet':_0x2708d5,'status':_0x5409d5(0x113),'txid':_0x4d800e,'notes':_0x480091,'periodFrom':_0x215863?new Date(_0x215863):null,'periodTo':_0x108641?new Date(_0x108641):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x13349d=_0x2d00dc['balance']-_0x7641dc,_0x2bfe95=_0x2d00dc['totalPaidOut']+_0x7641dc;return await _0x1a0847[_0x5409d5(0xfd)][_0x5409d5(0x12c)]({'where':{'id':_0xe421e0},'data':{'balance':_0x13349d,'totalPaidOut':_0x2bfe95}}),console[_0x5409d5(0x13f)](_0x5409d5(0xb4)+_0x2d00dc[_0x5409d5(0x14f)]+'\x20balance\x20updated:'),console[_0x5409d5(0x13f)](_0x5409d5(0x147)+_0x2d00dc[_0x5409d5(0x196)][_0x5409d5(0x17a)](0x6)+_0x5409d5(0x197)+_0x13349d[_0x5409d5(0x17a)](0x6)+'\x20USDT\x20(-'+_0x7641dc[_0x5409d5(0x17a)](0x6)+')'),console[_0x5409d5(0x13f)](_0x5409d5(0x135)+_0x2d00dc[_0x5409d5(0x190)][_0x5409d5(0x17a)](0x6)+_0x5409d5(0x197)+_0x2bfe95[_0x5409d5(0x17a)](0x6)+'\x20USDT\x20(+'+_0x7641dc['toFixed'](0x6)+')'),{'payout':_0x2eeb59,'shop':_0x2d00dc};});return console[_0x480e39(0x13f)](_0x480e39(0x174)+_0x1c0f34[_0x480e39(0x115)]['id']+'\x20for\x20shop\x20'+_0x1c0f34[_0x480e39(0xfd)]['username']+'\x20('+_0x7641dc+_0x480e39(0x189)),{'id':_0x1c0f34['payout']['id'],'shopId':_0x1c0f34[_0x480e39(0x115)]['shopId'],'shopName':_0x1c0f34['shop']['name'],'shopUsername':_0x1c0f34[_0x480e39(0xfd)][_0x480e39(0x14f)],'amount':_0x1c0f34[_0x480e39(0x115)][_0x480e39(0x107)],'network':_0x1c0f34[_0x480e39(0x115)][_0x480e39(0xc6)],'status':_0x1c0f34[_0x480e39(0x115)][_0x480e39(0x15e)],'txid':_0x1c0f34[_0x480e39(0x115)][_0x480e39(0xd5)],'notes':_0x1c0f34[_0x480e39(0x115)][_0x480e39(0x18d)],'periodFrom':_0x1c0f34[_0x480e39(0x115)][_0x480e39(0x131)],'periodTo':_0x1c0f34[_0x480e39(0x115)][_0x480e39(0x11c)],'createdAt':_0x1c0f34[_0x480e39(0x115)][_0x480e39(0xf7)],'paidAt':_0x1c0f34['payout'][_0x480e39(0x1c3)]};}async[a35_0x3d503b(0xe8)](_0x2c6ca9){const _0x424fd6=a35_0x3d503b,{page:_0x5c06a2,limit:_0x1a6387,shopId:_0x5aa2d2,network:_0x2a013c,dateFrom:_0x186def,dateTo:_0x3bd87c,search:_0x3251be}=_0x2c6ca9,_0x20fe73=(_0x5c06a2-0x1)*_0x1a6387,_0x12b7d2={};_0x5aa2d2&&(_0x12b7d2[_0x424fd6(0xf0)]=_0x5aa2d2);_0x2a013c&&(_0x12b7d2[_0x424fd6(0xc6)]=_0x2a013c);(_0x186def||_0x3bd87c)&&(_0x12b7d2[_0x424fd6(0xf7)]={},_0x186def&&(_0x12b7d2[_0x424fd6(0xf7)][_0x424fd6(0x120)]=new Date(_0x186def)),_0x3bd87c&&(_0x12b7d2[_0x424fd6(0xf7)][_0x424fd6(0x17c)]=new Date(_0x3bd87c)));_0x3251be&&(_0x12b7d2['OR']=[{'shop':{'name':{'contains':_0x3251be,'mode':_0x424fd6(0xe4)}}},{'shop':{'username':{'contains':_0x3251be,'mode':_0x424fd6(0xe4)}}},{'notes':{'contains':_0x3251be,'mode':_0x424fd6(0xe4)}}]);const [_0x3cb931,_0x22e82e]=await Promise[_0x424fd6(0x166)]([database_1['default']['payout'][_0x424fd6(0x178)]({'where':_0x12b7d2,'skip':_0x20fe73,'take':_0x1a6387,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'wallet':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x424fd6(0x13a)]['payout'][_0x424fd6(0xfa)]({'where':_0x12b7d2})]);return{'payouts':_0x3cb931[_0x424fd6(0x17e)](_0x3b9687=>({'id':_0x3b9687['id'],'shopId':_0x3b9687[_0x424fd6(0xf0)],'shopName':_0x3b9687[_0x424fd6(0xfd)]['name'],'shopUsername':_0x3b9687['shop'][_0x424fd6(0x14f)],'amount':_0x3b9687[_0x424fd6(0x107)],'network':_0x3b9687[_0x424fd6(0xc6)],'wallet':_0x3b9687[_0x424fd6(0x15b)],'status':_0x3b9687[_0x424fd6(0x15e)],'txid':_0x3b9687[_0x424fd6(0xd5)],'notes':_0x3b9687[_0x424fd6(0x18d)],'periodFrom':_0x3b9687[_0x424fd6(0x131)],'periodTo':_0x3b9687[_0x424fd6(0x11c)],'createdAt':_0x3b9687[_0x424fd6(0xf7)],'paidAt':_0x3b9687[_0x424fd6(0x1c3)]})),'pagination':{'page':_0x5c06a2,'limit':_0x1a6387,'total':_0x22e82e,'totalPages':Math[_0x424fd6(0xfe)](_0x22e82e/_0x1a6387)}};}async['getPayoutById'](_0x4cd8c6){const _0x3688e8=a35_0x3d503b,_0x2a4fb3=await database_1[_0x3688e8(0x13a)]['payout']['findUnique']({'where':{'id':_0x4cd8c6},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x2a4fb3)return null;return{'id':_0x2a4fb3['id'],'shopId':_0x2a4fb3['shopId'],'shopName':_0x2a4fb3[_0x3688e8(0xfd)][_0x3688e8(0x1a6)],'shopUsername':_0x2a4fb3[_0x3688e8(0xfd)][_0x3688e8(0x14f)],'amount':_0x2a4fb3[_0x3688e8(0x107)],'network':_0x2a4fb3[_0x3688e8(0xc6)],'status':_0x2a4fb3[_0x3688e8(0x15e)],'txid':_0x2a4fb3['txid'],'notes':_0x2a4fb3[_0x3688e8(0x18d)],'periodFrom':_0x2a4fb3[_0x3688e8(0x131)],'periodTo':_0x2a4fb3[_0x3688e8(0x11c)],'createdAt':_0x2a4fb3['createdAt'],'paidAt':_0x2a4fb3[_0x3688e8(0x1c3)]};}async[a35_0x3d503b(0xae)](_0x2d0d76){const _0x2c7c75=a35_0x3d503b;await database_1[_0x2c7c75(0x13a)][_0x2c7c75(0x115)][_0x2c7c75(0x150)]({'where':{'id':_0x2d0d76}});}async[a35_0x3d503b(0xdf)](_0x1d0f90){const _0x1bcd9a=a35_0x3d503b,{page:_0x460d2d,limit:_0x532540,status:_0xf255c8,gateway:_0x3a0231,shopId:_0x565d46,dateFrom:_0xfbef36,dateTo:_0xa2ca7f,search:_0x4f5f3c,currency:_0x4e5b40,sortBy:_0x4de1f4,sortOrder:_0x386c73}=_0x1d0f90,_0x1edf41=(_0x460d2d-0x1)*_0x532540;console[_0x1bcd9a(0x13f)](_0x1bcd9a(0x1bd),_0x1d0f90);const _0x4835e2=await database_1[_0x1bcd9a(0x13a)]['payment'][_0x1bcd9a(0x104)]({'by':['gateway'],'_count':{'gateway':!![]}});console['log'](_0x1bcd9a(0x119),_0x4835e2[_0x1bcd9a(0x17e)](_0x2b03cf=>_0x2b03cf['gateway']+'\x20('+_0x2b03cf[_0x1bcd9a(0x181)]['gateway']+_0x1bcd9a(0x10e)));if(_0x3a0231){const _0x11af27=_0x4835e2[_0x1bcd9a(0x1b5)](_0x460289=>_0x460289[_0x1bcd9a(0x10d)][_0x1bcd9a(0x1a5)]()===_0x3a0231[_0x1bcd9a(0x1a5)]());!_0x11af27&&_0x3a0231['toLowerCase']()!==_0x1bcd9a(0xc5)&&console[_0x1bcd9a(0x13f)](_0x1bcd9a(0x124)+_0x3a0231+_0x1bcd9a(0x130)+_0x4835e2[_0x1bcd9a(0x17e)](_0x22435c=>_0x22435c[_0x1bcd9a(0x10d)])['join'](',\x20'));}const _0x23f41d={};_0xf255c8&&(_0x23f41d['status']=_0xf255c8[_0x1bcd9a(0xcd)]());if(!_0x3a0231)_0x23f41d[_0x1bcd9a(0x10d)]={'not':_0x1bcd9a(0xc5)};else{if(_0x3a0231&&(_0x3a0231[_0x1bcd9a(0x1a5)]()===_0x1bcd9a(0xc5)||_0x3a0231===_0x1bcd9a(0x110)))_0x23f41d[_0x1bcd9a(0x10d)]=_0x1bcd9a(0xc5);else{let _0x329b0e=_0x3a0231;const _0x2681a3=(0x0,gateway_1['getGatewayNameById'])(_0x3a0231);if(_0x2681a3)_0x329b0e=_0x2681a3,console['log']('🔄\x20Converted\x20gateway\x20ID\x20\x27'+_0x3a0231+_0x1bcd9a(0xd4)+_0x329b0e+'\x27');else{const _0x3a83b6=(0x0,gateway_1[_0x1bcd9a(0x117)])(_0x3a0231);if(_0x3a83b6){const _0x5f5703=(0x0,gateway_1[_0x1bcd9a(0x14a)])(_0x3a83b6);_0x5f5703&&(_0x329b0e=_0x5f5703,console[_0x1bcd9a(0x13f)](_0x1bcd9a(0x1b9)+_0x3a0231+'\x27\x20->\x20ID\x20\x27'+_0x3a83b6+_0x1bcd9a(0xed)+_0x329b0e+'\x27'));}else console[_0x1bcd9a(0x13f)](_0x1bcd9a(0xad)+_0x3a0231+_0x1bcd9a(0x126));}const _0x4e563b=await database_1[_0x1bcd9a(0x13a)][_0x1bcd9a(0x179)][_0x1bcd9a(0xfa)]({'where':{'gateway':_0x329b0e[_0x1bcd9a(0x1a5)]()},'take':0x1});_0x4e563b===0x0?(console[_0x1bcd9a(0x13f)](_0x1bcd9a(0x133)+_0x329b0e+_0x1bcd9a(0xea)+_0x3a0231+_0x1bcd9a(0xde)),_0x23f41d[_0x1bcd9a(0x10d)]=_0x1bcd9a(0x13e)):(_0x23f41d[_0x1bcd9a(0x10d)]=_0x329b0e[_0x1bcd9a(0x1a5)](),console[_0x1bcd9a(0x13f)](_0x1bcd9a(0x14e)+_0x329b0e+_0x1bcd9a(0xea)+_0x3a0231+'\x27)'));}}console[_0x1bcd9a(0x13f)](_0x1bcd9a(0x105),_0x23f41d[_0x1bcd9a(0x10d)]);_0x565d46&&(_0x23f41d[_0x1bcd9a(0xf0)]=_0x565d46);_0x4e5b40&&(_0x23f41d[_0x1bcd9a(0x1c4)]=_0x4e5b40[_0x1bcd9a(0xcd)](),console['log'](_0x1bcd9a(0xb8)+_0x4e5b40[_0x1bcd9a(0xcd)]()));(_0xfbef36||_0xa2ca7f)&&(_0x23f41d['createdAt']={},_0xfbef36&&(_0x23f41d['createdAt'][_0x1bcd9a(0x120)]=new Date(_0xfbef36)),_0xa2ca7f&&(_0x23f41d[_0x1bcd9a(0xf7)][_0x1bcd9a(0x17c)]=new Date(_0xa2ca7f)));_0x4f5f3c&&(_0x23f41d['OR']=[{'id':{'contains':_0x4f5f3c,'mode':_0x1bcd9a(0xe4)}},{'orderId':{'contains':_0x4f5f3c,'mode':_0x1bcd9a(0xe4)}},{'gatewayOrderId':{'contains':_0x4f5f3c,'mode':_0x1bcd9a(0xe4)}},{'customerEmail':{'contains':_0x4f5f3c,'mode':_0x1bcd9a(0xe4)}},{'shop':{'name':{'contains':_0x4f5f3c,'mode':_0x1bcd9a(0xe4)}}},{'shop':{'username':{'contains':_0x4f5f3c,'mode':_0x1bcd9a(0xe4)}}}]);console['log']('📊\x20Final\x20WHERE\x20conditions:',JSON[_0x1bcd9a(0x121)](_0x23f41d,null,0x2));let _0x53d368={'createdAt':_0x1bcd9a(0xfb)};if(_0x4de1f4){const _0x5a3961=[_0x1bcd9a(0x107),_0x1bcd9a(0xf7),_0x1bcd9a(0x1aa),_0x1bcd9a(0x15e),_0x1bcd9a(0x10d),_0x1bcd9a(0x1c4)],_0x135044=[_0x1bcd9a(0xbc),'desc'];if(_0x5a3961[_0x1bcd9a(0xf3)](_0x4de1f4)){const _0xee5c94=_0x135044[_0x1bcd9a(0xf3)](_0x386c73)?_0x386c73:_0x1bcd9a(0xfb);_0x53d368={[_0x4de1f4]:_0xee5c94},console['log'](_0x1bcd9a(0x185)+_0x4de1f4+_0x1bcd9a(0xc2)+_0xee5c94+_0x1bcd9a(0x1c0));}}const [_0x3ee24c,_0x4a0c96]=await Promise[_0x1bcd9a(0x166)]([database_1[_0x1bcd9a(0x13a)][_0x1bcd9a(0x179)][_0x1bcd9a(0x178)]({'where':_0x23f41d,'skip':_0x1edf41,'take':_0x532540,'orderBy':_0x53d368,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x1bcd9a(0x13a)][_0x1bcd9a(0x179)][_0x1bcd9a(0xfa)]({'where':_0x23f41d})]);return{'payments':_0x3ee24c[_0x1bcd9a(0x17e)](_0x3c3e10=>({'id':_0x3c3e10['id'],'shopId':_0x3c3e10[_0x1bcd9a(0xf0)],'gateway':_0x3c3e10[_0x1bcd9a(0x10d)],'amount':_0x3c3e10[_0x1bcd9a(0x107)],'currency':_0x3c3e10[_0x1bcd9a(0x1c4)],'status':_0x3c3e10[_0x1bcd9a(0x15e)],'orderId':_0x3c3e10[_0x1bcd9a(0x134)],'gatewayOrderId':_0x3c3e10[_0x1bcd9a(0xfc)],'customerEmail':_0x3c3e10[_0x1bcd9a(0xda)],'customerName':_0x3c3e10[_0x1bcd9a(0x18f)],'customerCountry':_0x3c3e10[_0x1bcd9a(0x175)],'customerIp':_0x3c3e10[_0x1bcd9a(0x1a1)],'customerUa':_0x3c3e10[_0x1bcd9a(0x18c)],'failureMessage':_0x3c3e10[_0x1bcd9a(0x136)],'createdAt':_0x3c3e10[_0x1bcd9a(0xf7)],'updatedAt':_0x3c3e10[_0x1bcd9a(0x1aa)],'shop':_0x3c3e10[_0x1bcd9a(0xfd)]})),'pagination':{'page':_0x460d2d,'limit':_0x532540,'total':_0x4a0c96,'totalPages':Math['ceil'](_0x4a0c96/_0x532540)}};}async[a35_0x3d503b(0x18e)](_0x2bee55){const _0x3073a3=a35_0x3d503b,_0x29d214=await database_1['default'][_0x3073a3(0x179)]['findUnique']({'where':{'id':_0x2bee55},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x29d214)return null;return{'id':_0x29d214['id'],'shopId':_0x29d214[_0x3073a3(0xf0)],'gateway':_0x29d214[_0x3073a3(0x10d)],'amount':_0x29d214[_0x3073a3(0x107)],'currency':_0x29d214[_0x3073a3(0x1c4)],'status':_0x29d214[_0x3073a3(0x15e)],'orderId':_0x29d214[_0x3073a3(0x134)],'gatewayOrderId':_0x29d214[_0x3073a3(0xfc)],'customerEmail':_0x29d214[_0x3073a3(0xda)],'customerName':_0x29d214[_0x3073a3(0x18f)],'customerCountry':_0x29d214[_0x3073a3(0x175)],'customerIp':_0x29d214[_0x3073a3(0x1a1)],'customerUa':_0x29d214[_0x3073a3(0x18c)],'failureMessage':_0x29d214[_0x3073a3(0x136)],'externalPaymentUrl':_0x29d214[_0x3073a3(0x122)],'successUrl':_0x29d214[_0x3073a3(0x1a0)],'failUrl':_0x29d214[_0x3073a3(0xf9)],'pendingUrl':_0x29d214[_0x3073a3(0x199)],'whiteUrl':_0x29d214[_0x3073a3(0x102)],'createdAt':_0x29d214['createdAt'],'updatedAt':_0x29d214[_0x3073a3(0x1aa)],'shop':_0x29d214[_0x3073a3(0xfd)]};}async[a35_0x3d503b(0xb0)](_0x3f2b87,_0x46da72,_0x2786ab,_0x2d047e){const _0xa614f2=a35_0x3d503b,_0x17f83e=await database_1[_0xa614f2(0x13a)][_0xa614f2(0xf8)](async _0x943990=>{const _0x113b56=_0xa614f2,_0x38ab9f=await _0x943990[_0x113b56(0x179)]['findUnique']({'where':{'id':_0x3f2b87},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x38ab9f)throw new Error(_0x113b56(0xf5));const _0x1b6f07=_0x38ab9f['status'],_0x3fd279=_0x46da72[_0x113b56(0xcd)]();console['log'](_0x113b56(0x148)+_0x3f2b87+_0x113b56(0xcf)+_0x1b6f07+'\x20->\x20'+_0x3fd279),console[_0x113b56(0x13f)]('💰\x20Current\x20shop\x20balance:\x20'+_0x38ab9f['shop'][_0x113b56(0x196)]+'\x20USDT');const _0x23cf0d={'status':_0x3fd279,'updatedAt':new Date(),'statusChangedBy':_0x113b56(0x1a8),'statusChangedAt':new Date()};_0x2786ab&&(_0x23cf0d[_0x113b56(0x19f)]=_0x2786ab);_0x3fd279===_0x113b56(0x11e)&&_0x2d047e&&(_0x23cf0d[_0x113b56(0xd7)]=_0x2d047e);let _0x120cc9=0x0,_0x39bcb3=_0x38ab9f[_0x113b56(0xfd)][_0x113b56(0x196)];if(_0x3fd279===_0x113b56(0x16f)&&_0x1b6f07!==_0x113b56(0x16f)){_0x23cf0d['paidAt']=new Date();const _0x491e48=await currencyService_1['currencyService']['convertToUSDT'](_0x38ab9f[_0x113b56(0x107)],_0x38ab9f[_0x113b56(0x1c4)]);_0x23cf0d[_0x113b56(0xc9)]=_0x491e48;let _0x13f264=0xa;const _0x2a7381=await _0x943990[_0x113b56(0xfd)][_0x113b56(0x1b3)]({'where':{'id':_0x38ab9f[_0x113b56(0xf0)]},'select':{'gatewaySettings':!![]}});if(_0x2a7381?.['gatewaySettings'])try{const _0x2d33ce=JSON[_0x113b56(0x159)](_0x2a7381['gatewaySettings']);for(const [_0x13133a,_0x539464]of Object[_0x113b56(0xb2)](_0x2d33ce)){if(_0x13133a['toLowerCase']()===_0x38ab9f[_0x113b56(0x10d)][_0x113b56(0x1a5)]()){_0x13f264=_0x539464[_0x113b56(0xb5)]||0xa;break;}}}catch(_0x2ef775){console[_0x113b56(0x10c)](_0x113b56(0x1c2)+_0x3f2b87+':',_0x2ef775);}const _0x57da7a=_0x491e48*(0x1-_0x13f264/0x64);_0x120cc9=_0x57da7a,_0x39bcb3+=_0x57da7a,console['log'](_0x113b56(0xd2)+_0x3f2b87+_0x113b56(0x1af)),console[_0x113b56(0x13f)](_0x113b56(0x156)+_0x491e48['toFixed'](0x6)+_0x113b56(0x1a3)),console['log']('\x20\x20\x20Gateway:\x20'+_0x38ab9f['gateway']+_0x113b56(0x1b6)+_0x13f264+'%'),console['log'](_0x113b56(0x180)+_0x57da7a[_0x113b56(0x17a)](0x6)+_0x113b56(0x1b4)+_0x13f264+_0x113b56(0x12b)),console[_0x113b56(0x13f)](_0x113b56(0xb9)+_0x57da7a['toFixed'](0x6)+'\x20USDT');}else{if(_0x1b6f07===_0x113b56(0x16f)&&_0x3fd279!=='PAID'){if(_0x38ab9f['amountUSDT']){let _0x358a82=0xa;const _0x34cc53=await _0x943990[_0x113b56(0xfd)][_0x113b56(0x1b3)]({'where':{'id':_0x38ab9f['shopId']},'select':{'gatewaySettings':!![]}});if(_0x34cc53?.['gatewaySettings'])try{const _0x2de456=JSON[_0x113b56(0x159)](_0x34cc53[_0x113b56(0xb3)]);for(const [_0x4211f9,_0x138618]of Object[_0x113b56(0xb2)](_0x2de456)){if(_0x4211f9[_0x113b56(0x1a5)]()===_0x38ab9f[_0x113b56(0x10d)][_0x113b56(0x1a5)]()){_0x358a82=_0x138618['commission']||0xa;break;}}}catch(_0x5e5062){console[_0x113b56(0x10c)](_0x113b56(0x1c2)+_0x3f2b87+':',_0x5e5062);}const _0x1f0232=_0x38ab9f[_0x113b56(0xc9)]*(0x1-_0x358a82/0x64);_0x120cc9=-_0x1f0232,_0x39bcb3-=_0x1f0232,_0x23cf0d[_0x113b56(0xc9)]=null,console[_0x113b56(0x13f)](_0x113b56(0xd2)+_0x3f2b87+'\x20no\x20longer\x20PAID:'),console[_0x113b56(0x13f)]('\x20\x20\x20Full\x20amount:\x20'+_0x38ab9f['amountUSDT']['toFixed'](0x6)+_0x113b56(0x1a3)),console['log']('\x20\x20\x20Gateway:\x20'+_0x38ab9f['gateway']+_0x113b56(0x1b6)+_0x358a82+'%'),console['log'](_0x113b56(0xcb)+_0x1f0232[_0x113b56(0x17a)](0x6)+_0x113b56(0x1b4)+_0x358a82+_0x113b56(0x12b)),console['log'](_0x113b56(0xe3)+_0x1f0232[_0x113b56(0x17a)](0x6)+_0x113b56(0x1a3));}}}_0x3fd279===_0x113b56(0x11e)&&(_0x1b6f07===_0x113b56(0x16f)&&_0x38ab9f['amountUSDT']&&console['log'](_0x113b56(0xd9)),_0x2d047e&&_0x2d047e>0x0&&(_0x120cc9-=_0x2d047e,_0x39bcb3-=_0x2d047e,console[_0x113b56(0x13f)](_0x113b56(0xb1)+_0x2d047e[_0x113b56(0x17a)](0x6)+_0x113b56(0x194))));_0x3fd279===_0x113b56(0xaf)&&_0x1b6f07===_0x113b56(0x16f)&&console[_0x113b56(0x13f)](_0x113b56(0x10a));const _0x437afa=await _0x943990[_0x113b56(0x179)]['update']({'where':{'id':_0x3f2b87},'data':_0x23cf0d,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x120cc9!==0x0&&(await _0x943990[_0x113b56(0xfd)][_0x113b56(0x12c)]({'where':{'id':_0x38ab9f['shopId']},'data':{'balance':_0x39bcb3}}),console[_0x113b56(0x13f)]('💰\x20Shop\x20'+_0x38ab9f[_0x113b56(0xf0)]+'\x20balance\x20updated:\x20'+_0x38ab9f[_0x113b56(0xfd)][_0x113b56(0x196)][_0x113b56(0x17a)](0x6)+'\x20->\x20'+_0x39bcb3[_0x113b56(0x17a)](0x6)+_0x113b56(0xd8)+(_0x120cc9>0x0?'+':'')+_0x120cc9[_0x113b56(0x17a)](0x6)+')')),_0x437afa;});return{'id':_0x17f83e['id'],'shopId':_0x17f83e[_0xa614f2(0xf0)],'gateway':_0x17f83e[_0xa614f2(0x10d)],'amount':_0x17f83e[_0xa614f2(0x107)],'currency':_0x17f83e[_0xa614f2(0x1c4)],'status':_0x17f83e[_0xa614f2(0x15e)],'orderId':_0x17f83e[_0xa614f2(0x134)],'gatewayOrderId':_0x17f83e[_0xa614f2(0xfc)],'customerEmail':_0x17f83e[_0xa614f2(0xda)],'customerName':_0x17f83e[_0xa614f2(0x18f)],'customerCountry':_0x17f83e[_0xa614f2(0x175)],'customerIp':_0x17f83e[_0xa614f2(0x1a1)],'customerUa':_0x17f83e[_0xa614f2(0x18c)],'failureMessage':_0x17f83e['failureMessage'],'adminNotes':_0x17f83e[_0xa614f2(0x19f)],'chargebackAmount':_0x17f83e[_0xa614f2(0xd7)],'statusChangedBy':_0x17f83e[_0xa614f2(0x1ba)],'statusChangedAt':_0x17f83e[_0xa614f2(0x192)],'createdAt':_0x17f83e[_0xa614f2(0xf7)],'updatedAt':_0x17f83e['updatedAt'],'shop':_0x17f83e['shop']};}async[a35_0x3d503b(0x1bc)](_0x71624d,_0x47ce81){const _0x384eb5=a35_0x3d503b,_0xc46831={..._0x47ce81};_0x47ce81[_0x384eb5(0xee)]&&(_0xc46831[_0x384eb5(0xee)]=await bcryptjs_1['default']['hash'](_0x47ce81[_0x384eb5(0xee)],0xc));_0x47ce81[_0x384eb5(0x143)]&&(_0xc46831[_0x384eb5(0x1a6)]=_0x47ce81['fullName'],delete _0xc46831['fullName']);_0x47ce81[_0x384eb5(0xd3)]&&(_0xc46831['telegram']=_0x47ce81[_0x384eb5(0xd3)],delete _0xc46831[_0x384eb5(0xd3)]);_0x47ce81[_0x384eb5(0xba)]&&(_0xc46831['shopUrl']=_0x47ce81[_0x384eb5(0xba)],delete _0xc46831[_0x384eb5(0xba)]);_0x47ce81[_0x384eb5(0x18b)]&&(_0xc46831[_0x384eb5(0x167)]=JSON[_0x384eb5(0x121)](_0x47ce81[_0x384eb5(0x18b)]),delete _0xc46831[_0x384eb5(0x18b)]);_0x47ce81[_0x384eb5(0xb3)]&&(_0xc46831[_0x384eb5(0xb3)]=JSON['stringify'](_0x47ce81['gatewaySettings']),delete _0xc46831[_0x384eb5(0xb3)]);_0x47ce81[_0x384eb5(0xc3)]&&(_0x47ce81[_0x384eb5(0xc3)]['usdtPolygonWallet']!==undefined&&(_0xc46831['usdtPolygonWallet']=_0x47ce81['wallets']['usdtPolygonWallet']||null),_0x47ce81[_0x384eb5(0xc3)][_0x384eb5(0x163)]!==undefined&&(_0xc46831[_0x384eb5(0x163)]=_0x47ce81[_0x384eb5(0xc3)][_0x384eb5(0x163)]||null),_0x47ce81['wallets'][_0x384eb5(0xbb)]!==undefined&&(_0xc46831['usdtErcWallet']=_0x47ce81['wallets'][_0x384eb5(0xbb)]||null),_0x47ce81[_0x384eb5(0xc3)]['usdcPolygonWallet']!==undefined&&(_0xc46831[_0x384eb5(0x1b1)]=_0x47ce81['wallets'][_0x384eb5(0x1b1)]||null),delete _0xc46831[_0x384eb5(0xc3)]);const _0x582f34=await database_1['default'][_0x384eb5(0xfd)][_0x384eb5(0x12c)]({'where':{'id':_0x71624d},'data':_0xc46831,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x582f34['id'],'fullName':_0x582f34[_0x384eb5(0x1a6)],'username':_0x582f34[_0x384eb5(0x14f)],'telegramId':_0x582f34[_0x384eb5(0x15c)],'merchantUrl':_0x582f34[_0x384eb5(0xe9)],'gateways':_0x582f34[_0x384eb5(0x167)]?JSON[_0x384eb5(0x159)](_0x582f34[_0x384eb5(0x167)]):null,'gatewaySettings':_0x582f34[_0x384eb5(0xb3)]?JSON['parse'](_0x582f34[_0x384eb5(0xb3)]):null,'publicKey':_0x582f34['publicKey'],'wallets':{'usdtPolygonWallet':_0x582f34[_0x384eb5(0x13b)],'usdtTrcWallet':_0x582f34[_0x384eb5(0x163)],'usdtErcWallet':_0x582f34['usdtErcWallet'],'usdcPolygonWallet':_0x582f34[_0x384eb5(0x1b1)]},'status':_0x582f34[_0x384eb5(0x15e)],'createdAt':_0x582f34[_0x384eb5(0xf7)]};}async['suspendUser'](_0x1d6bab){const _0x59ecf8=a35_0x3d503b,_0x2e2509=await database_1[_0x59ecf8(0x13a)][_0x59ecf8(0xfd)][_0x59ecf8(0x12c)]({'where':{'id':_0x1d6bab},'data':{'status':'SUSPENDED'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2e2509['id'],'fullName':_0x2e2509[_0x59ecf8(0x1a6)],'username':_0x2e2509['username'],'telegramId':_0x2e2509['telegram'],'merchantUrl':_0x2e2509[_0x59ecf8(0xe9)],'gateways':_0x2e2509[_0x59ecf8(0x167)]?JSON[_0x59ecf8(0x159)](_0x2e2509[_0x59ecf8(0x167)]):null,'gatewaySettings':_0x2e2509[_0x59ecf8(0xb3)]?JSON[_0x59ecf8(0x159)](_0x2e2509[_0x59ecf8(0xb3)]):null,'publicKey':_0x2e2509[_0x59ecf8(0x15d)],'wallets':{'usdtPolygonWallet':_0x2e2509[_0x59ecf8(0x13b)],'usdtTrcWallet':_0x2e2509[_0x59ecf8(0x163)],'usdtErcWallet':_0x2e2509[_0x59ecf8(0xbb)],'usdcPolygonWallet':_0x2e2509['usdcPolygonWallet']},'status':_0x2e2509[_0x59ecf8(0x15e)],'createdAt':_0x2e2509[_0x59ecf8(0xf7)]};}async['activateUser'](_0x40c8ac){const _0xe5b543=a35_0x3d503b,_0x402a5c=await database_1[_0xe5b543(0x13a)][_0xe5b543(0xfd)][_0xe5b543(0x12c)]({'where':{'id':_0x40c8ac},'data':{'status':_0xe5b543(0xec)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x402a5c['id'],'fullName':_0x402a5c[_0xe5b543(0x1a6)],'username':_0x402a5c[_0xe5b543(0x14f)],'telegramId':_0x402a5c[_0xe5b543(0x15c)],'merchantUrl':_0x402a5c[_0xe5b543(0xe9)],'gateways':_0x402a5c['paymentGateways']?JSON['parse'](_0x402a5c[_0xe5b543(0x167)]):null,'gatewaySettings':_0x402a5c[_0xe5b543(0xb3)]?JSON[_0xe5b543(0x159)](_0x402a5c['gatewaySettings']):null,'publicKey':_0x402a5c[_0xe5b543(0x15d)],'wallets':{'usdtPolygonWallet':_0x402a5c['usdtPolygonWallet'],'usdtTrcWallet':_0x402a5c[_0xe5b543(0x163)],'usdtErcWallet':_0x402a5c['usdtErcWallet'],'usdcPolygonWallet':_0x402a5c[_0xe5b543(0x1b1)]},'status':_0x402a5c[_0xe5b543(0x15e)],'createdAt':_0x402a5c[_0xe5b543(0xf7)]};}async[a35_0x3d503b(0x15f)](_0x219630){const _0x3e7e21=a35_0x3d503b,{page:_0x1c7c4d,limit:_0x3149eb,status:_0x312940}=_0x219630,_0x4f34eb=(_0x1c7c4d-0x1)*_0x3149eb,_0x115e5e={};_0x312940&&(_0x115e5e[_0x3e7e21(0x15e)]=_0x312940['toUpperCase']());const [_0x3ebd53,_0x4eaa76]=await Promise[_0x3e7e21(0x166)]([database_1[_0x3e7e21(0x13a)]['shop'][_0x3e7e21(0x178)]({'where':_0x115e5e,'skip':_0x4f34eb,'take':_0x3149eb,'orderBy':{'createdAt':_0x3e7e21(0xfb)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1['default'][_0x3e7e21(0xfd)]['count']({'where':_0x115e5e})]);return{'users':_0x3ebd53['map'](_0x2aa022=>({'id':_0x2aa022['id'],'fullName':_0x2aa022['name'],'username':_0x2aa022['username'],'telegramId':_0x2aa022[_0x3e7e21(0x15c)],'merchantUrl':_0x2aa022[_0x3e7e21(0xe9)],'gateways':_0x2aa022[_0x3e7e21(0x167)]?JSON[_0x3e7e21(0x159)](_0x2aa022[_0x3e7e21(0x167)]):null,'gatewaySettings':_0x2aa022['gatewaySettings']?JSON[_0x3e7e21(0x159)](_0x2aa022[_0x3e7e21(0xb3)]):null,'publicKey':_0x2aa022[_0x3e7e21(0x15d)],'wallets':{'usdtPolygonWallet':_0x2aa022[_0x3e7e21(0x13b)],'usdtTrcWallet':_0x2aa022[_0x3e7e21(0x163)],'usdtErcWallet':_0x2aa022[_0x3e7e21(0xbb)],'usdcPolygonWallet':_0x2aa022[_0x3e7e21(0x1b1)]},'status':_0x2aa022['status'],'createdAt':_0x2aa022[_0x3e7e21(0xf7)]})),'pagination':{'page':_0x1c7c4d,'limit':_0x3149eb,'total':_0x4eaa76,'totalPages':Math[_0x3e7e21(0xfe)](_0x4eaa76/_0x3149eb)}};}async['getUserById'](_0x56163e){const _0x44abe6=a35_0x3d503b,_0x3eaecc=await database_1[_0x44abe6(0x13a)][_0x44abe6(0xfd)][_0x44abe6(0x1b3)]({'where':{'id':_0x56163e},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x3eaecc)return null;return{'id':_0x3eaecc['id'],'fullName':_0x3eaecc['name'],'username':_0x3eaecc[_0x44abe6(0x14f)],'telegramId':_0x3eaecc[_0x44abe6(0x15c)],'merchantUrl':_0x3eaecc['shopUrl'],'gateways':_0x3eaecc[_0x44abe6(0x167)]?JSON[_0x44abe6(0x159)](_0x3eaecc[_0x44abe6(0x167)]):null,'gatewaySettings':_0x3eaecc[_0x44abe6(0xb3)]?JSON[_0x44abe6(0x159)](_0x3eaecc[_0x44abe6(0xb3)]):null,'publicKey':_0x3eaecc[_0x44abe6(0x15d)],'wallets':{'usdtPolygonWallet':_0x3eaecc['usdtPolygonWallet'],'usdtTrcWallet':_0x3eaecc[_0x44abe6(0x163)],'usdtErcWallet':_0x3eaecc['usdtErcWallet'],'usdcPolygonWallet':_0x3eaecc[_0x44abe6(0x1b1)]},'status':_0x3eaecc[_0x44abe6(0x15e)],'createdAt':_0x3eaecc[_0x44abe6(0xf7)]};}async[a35_0x3d503b(0x1ab)](_0x545055){const _0x1dfb1e=a35_0x3d503b,{fullName:_0x1a0325,username:_0x36f881,password:_0x295d0b,telegramId:_0x46cfd8,merchantUrl:_0x589ce1,gateways:_0x54a0f9,gatewaySettings:_0x527652,wallets:_0x471de8}=_0x545055,_0x5c5cc0=await database_1[_0x1dfb1e(0x13a)][_0x1dfb1e(0xfd)][_0x1dfb1e(0x1b3)]({'where':{'username':_0x36f881}});if(_0x5c5cc0)throw new Error('Username\x20already\x20exists');if(_0x46cfd8){const _0x3294c2=await database_1[_0x1dfb1e(0x13a)][_0x1dfb1e(0xfd)][_0x1dfb1e(0x1b3)]({'where':{'telegram':_0x46cfd8}});if(_0x3294c2)throw new Error('Telegram\x20username\x20already\x20exists');}const _0xa487e7=await bcryptjs_1[_0x1dfb1e(0x13a)][_0x1dfb1e(0x14c)](_0x295d0b,0xc),_0x404280=_0x1dfb1e(0x139)+crypto_1[_0x1dfb1e(0x13a)][_0x1dfb1e(0x127)](0x20)['toString'](_0x1dfb1e(0xef)),_0x1fff1a='sk_'+crypto_1[_0x1dfb1e(0x13a)]['randomBytes'](0x20)['toString']('hex'),_0xd44434=await database_1[_0x1dfb1e(0x13a)][_0x1dfb1e(0xfd)][_0x1dfb1e(0x11b)]({'data':{'name':_0x1a0325,'username':_0x36f881,'password':_0xa487e7,'telegram':_0x46cfd8,'shopUrl':_0x589ce1,'paymentGateways':_0x54a0f9?JSON[_0x1dfb1e(0x121)](_0x54a0f9):null,'gatewaySettings':_0x527652?JSON['stringify'](_0x527652):null,'usdtPolygonWallet':_0x471de8?.[_0x1dfb1e(0x13b)]||null,'usdtTrcWallet':_0x471de8?.[_0x1dfb1e(0x163)]||null,'usdtErcWallet':_0x471de8?.[_0x1dfb1e(0xbb)]||null,'usdcPolygonWallet':_0x471de8?.[_0x1dfb1e(0x1b1)]||null,'publicKey':_0x404280,'secretKey':_0x1fff1a,'status':_0x1dfb1e(0xec)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0xd44434['id'],'fullName':_0xd44434[_0x1dfb1e(0x1a6)],'username':_0xd44434[_0x1dfb1e(0x14f)],'telegramId':_0xd44434[_0x1dfb1e(0x15c)],'merchantUrl':_0xd44434[_0x1dfb1e(0xe9)],'gateways':_0xd44434[_0x1dfb1e(0x167)]?JSON[_0x1dfb1e(0x159)](_0xd44434['paymentGateways']):null,'gatewaySettings':_0xd44434[_0x1dfb1e(0xb3)]?JSON[_0x1dfb1e(0x159)](_0xd44434[_0x1dfb1e(0xb3)]):null,'publicKey':_0xd44434['publicKey'],'wallets':{'usdtPolygonWallet':_0xd44434['usdtPolygonWallet'],'usdtTrcWallet':_0xd44434['usdtTrcWallet'],'usdtErcWallet':_0xd44434[_0x1dfb1e(0xbb)],'usdcPolygonWallet':_0xd44434[_0x1dfb1e(0x1b1)]},'status':_0xd44434[_0x1dfb1e(0x15e)],'createdAt':_0xd44434[_0x1dfb1e(0xf7)]};}async[a35_0x3d503b(0xeb)](_0x1dcfe4){const _0x168b9f=a35_0x3d503b;await database_1[_0x168b9f(0x13a)][_0x168b9f(0xfd)][_0x168b9f(0x150)]({'where':{'id':_0x1dcfe4}});}[a35_0x3d503b(0x10f)](_0x2ea9fd,_0x16fc92,_0x13a9ed){const _0x25747=a35_0x3d503b,_0xe5832f=new Map(),_0x44701c=new Date(_0x16fc92);while(_0x44701c<=_0x13a9ed){const _0x21be19=_0x44701c[_0x25747(0x187)]()[_0x25747(0xe7)]('T')[0x0];_0xe5832f['set'](_0x21be19,{'revenue':0x0,'count':0x0}),_0x44701c[_0x25747(0xe2)](_0x44701c['getDate']()+0x1);}for(const _0x48ce35 of _0x2ea9fd){const _0x3f32d9=_0x48ce35[_0x25747(0xf7)][_0x25747(0x187)]()[_0x25747(0xe7)]('T')[0x0],_0x5e6f71=_0xe5832f[_0x25747(0x1ad)](_0x3f32d9);_0x5e6f71&&(_0x5e6f71[_0x25747(0xfa)]+=0x1,_0x48ce35[_0x25747(0x15e)]===_0x25747(0x16f)&&(_0x48ce35[_0x25747(0xc9)]?_0x5e6f71[_0x25747(0x164)]+=_0x48ce35[_0x25747(0xc9)]:console[_0x25747(0x13f)](_0x25747(0x172)+_0x48ce35['id']+_0x25747(0x16b))));}const _0x34b295=[],_0x3f10e0=[];for(const [_0x3aab73,_0x5a4278]of _0xe5832f){_0x34b295[_0x25747(0x183)]({'date':_0x3aab73,'amount':Math[_0x25747(0xc4)](_0x5a4278[_0x25747(0x164)]*0x64)/0x64}),_0x3f10e0[_0x25747(0x183)]({'date':_0x3aab73,'count':_0x5a4278['count']});}return{'dailyRevenue':_0x34b295,'dailyPayments':_0x3f10e0};}}exports[a35_0x3d503b(0x176)]=AdminService;