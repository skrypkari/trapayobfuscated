'use strict';const a33_0x1dbf14=a33_0x4025;(function(_0x4f991d,_0x41be08){const _0x1f385c=a33_0x4025,_0x3444c5=_0x4f991d();while(!![]){try{const _0x3ccc81=parseInt(_0x1f385c(0x1ab))/0x1+-parseInt(_0x1f385c(0x190))/0x2*(-parseInt(_0x1f385c(0x1a6))/0x3)+-parseInt(_0x1f385c(0x15d))/0x4*(parseInt(_0x1f385c(0x18b))/0x5)+parseInt(_0x1f385c(0x188))/0x6+parseInt(_0x1f385c(0x16d))/0x7*(-parseInt(_0x1f385c(0x1d0))/0x8)+-parseInt(_0x1f385c(0x1db))/0x9*(-parseInt(_0x1f385c(0x1ed))/0xa)+-parseInt(_0x1f385c(0x1be))/0xb*(parseInt(_0x1f385c(0x1f2))/0xc);if(_0x3ccc81===_0x41be08)break;else _0x3444c5['push'](_0x3444c5['shift']());}catch(_0x517a9e){_0x3444c5['push'](_0x3444c5['shift']());}}}(a33_0x4fbe,0x51530));function a33_0x4025(_0x3f4aa3,_0x4cbe03){const _0x4fbe1a=a33_0x4fbe();return a33_0x4025=function(_0x4025ae,_0x3af102){_0x4025ae=_0x4025ae-0x13f;let _0x246115=_0x4fbe1a[_0x4025ae];return _0x246115;},a33_0x4025(_0x3f4aa3,_0x4cbe03);}function a33_0x4fbe(){const _0x2d18a9=['\x20merchants,\x20','Payment\x20not\x20found','randomBytes','getAllPayments','convertToUSDT','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','orderId','forEach','COMPLETED','merchantPaid','totalTurnover','getPaymentById','toLowerCase','totalAmountAfterCommissionUSDT','createUser','📊\x20Merchant\x20statistics\x20calculated:','wallets','getGatewayDisplayName','pk_','__importDefault','customerIp','Shop\x20not\x20found','suspendUser','gateway','username','payment','thisMonth','merchantEarnings','paymentGateways','createPayout','round','4KcDYcW','./currencyService','values','lte','\x20USDT\x20(before\x20commission)','\x20\x20\x20💵\x20Available\x20balance:\x20','month','\x20\x20\x20🌐\x20IP:\x20','createdAt','password','\x20for\x20shop\x20','adminNotes','averageCommissionRate','localeCompare','totalPayout','includes','259yvxhzJ','admin','error','failureMessage','getAllUsers','merchantEarningsUSDT','30d','getUserById','insensitive','payout','not\x20set','getPayoutStats','toFixed','\x20\x20\x20🌍\x20Country:\x20','gte','gatewayEarnings','reduce','getTime','\x20USDT\x20(paid\x20to\x20merchants)','shopUrl','map','Error\x20processing\x20payment\x20','Rapyd','default','\x20USDT\x20(pending\x20payout)','toString','✅\x20Payment\x20','348840laaYaW','ceil','dateTo','151615oZxDmK','paidAt','filter','getAllPayouts','statusChangedAt','330310DQDcRy','KLYME\x20DE','slice','Plisio','crypto','desc','__esModule','merchantUrl','update','telegramId','usdtErcWallet','\x20USDT','custom','90d','externalPaymentUrl','commission','totalPayments','parse','oldestPaymentDate','notes','\x20USDT\x20(paid\x20out)','usdtTrcWallet','6AVYWQT','week','gateways','\x20\x20\x20📅\x20This\x20month:\x20','status','267893uoKXAv','\x20to\x20','totalCommissionRate','name','customerEmail','deletePayout','date','chargebackAmount','averageCheckUSDT','💰\x20Found\x20','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','getMerchantsAwaitingPayout','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','availableBalance','gatewayBreakdown','length','totalAmountUSDT','paidOutUSDT','set','5632ppdZWH','network','📊\x20Calculating\x20payout\x20statistics...','customerCountry','AdminService','currency','toISOString','turnoverUSDT','Noda','telegram','toUpperCase','PAID','shopId','failUrl','\x20USDT\x20total','gatewayOrderId','customerName','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','138096YRTGez','\x20\x20\x20💰\x20Total\x20payout:\x20','\x20USDT\x20(after\x20commission)','sort','count','📊\x20Merchants\x20awaiting\x20payout:\x20','updatedAt','periodFrom','deleteUser','getMerchantStatistics','getFullYear','9dAlWyG','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','turnover','\x20\x20\x20🖥️\x20User\x20Agent:\x20','amountAfterCommissionUSDT','usdcPolygonWallet','all','CHARGEBACK','Username\x20already\x20exists','usdtPolygonWallet','findUnique','sk_','gatewaySettings','whiteUrl','periodTo','fullName','period','✅\x20Payout\x20created:\x20','5029620JRtAOm','2020-01-01','📊\x20Payout\x20statistics\x20calculated:','updateUser','delete','3684jsoZIX','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','txid','\x20->\x20','shop','findMany','commissionUSDT','⏳\x20Payment\x20','📅\x20Period:\x20','paymentsCount','getSystemStatistics','updatePaymentStatus','CoinToPay','SUSPENDED','amountUSDT','hash','ACTIVE','log','customerUa','stringify','publicKey','amount','currencyService','dateFrom','pendingUrl'];a33_0x4fbe=function(){return _0x2d18a9;};return a33_0x4fbe();}var __importDefault=this&&this[a33_0x1dbf14(0x151)]||function(_0x2df926){const _0x515de8=a33_0x1dbf14;return _0x2df926&&_0x2df926[_0x515de8(0x196)]?_0x2df926:{'default':_0x2df926};};Object['defineProperty'](exports,a33_0x1dbf14(0x196),{'value':!![]}),exports[a33_0x1dbf14(0x1c2)]=void 0x0;const database_1=__importDefault(require('../config/database')),bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a33_0x1dbf14(0x194))),currencyService_1=require(a33_0x1dbf14(0x15e));class AdminService{async[a33_0x1dbf14(0x178)](){const _0xc10c9b=a33_0x1dbf14;console['log'](_0xc10c9b(0x1c0));const _0x2faef6=await database_1['default']['payment']['findMany']({'where':{'status':_0xc10c9b(0x1c9),'paidAt':{'not':null}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'merchantPaid':!![],'paidAt':!![],'createdAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0xc10c9b(0x203)](_0xc10c9b(0x1b4)+_0x2faef6[_0xc10c9b(0x1ba)]+'\x20paid\x20payments');let _0x42c854=0x0,_0x2e3c27=0x0,_0x34c916=0x0;for(const _0x1dd942 of _0x2faef6){try{const _0x10af32=await currencyService_1[_0xc10c9b(0x208)][_0xc10c9b(0x142)](_0x1dd942[_0xc10c9b(0x207)],_0x1dd942['currency']);let _0x4fa469={};if(_0x1dd942['shop'][_0xc10c9b(0x1e7)])try{_0x4fa469=JSON[_0xc10c9b(0x1a1)](_0x1dd942[_0xc10c9b(0x1f6)][_0xc10c9b(0x1e7)]);}catch(_0x1e03b8){console[_0xc10c9b(0x16f)](_0xc10c9b(0x143)+_0x1dd942['shopId']+':',_0x1e03b8);}const _0x2cc274=_0x4fa469[_0xc10c9b(0x19f)]||0xa,_0x3dbde4=_0x10af32*(0x1-_0x2cc274/0x64);_0x1dd942[_0xc10c9b(0x147)]?(_0x42c854+=_0x3dbde4,console[_0xc10c9b(0x203)](_0xc10c9b(0x187)+_0x1dd942['id']+':\x20'+_0x3dbde4[_0xc10c9b(0x179)](0x2)+_0xc10c9b(0x1a4))):(_0x2e3c27+=_0x3dbde4,_0x34c916+=_0x10af32,console['log'](_0xc10c9b(0x1f9)+_0x1dd942['id']+':\x20'+_0x3dbde4[_0xc10c9b(0x179)](0x2)+_0xc10c9b(0x185)));}catch(_0x320dbe){console[_0xc10c9b(0x16f)](_0xc10c9b(0x182)+_0x1dd942['id']+':',_0x320dbe);}}const _0x130653=new Date(),_0x2a9543=new Date(_0x130653[_0xc10c9b(0x1da)](),_0x130653['getMonth'](),0x1),_0xc06a38=new Date(_0x130653[_0xc10c9b(0x1da)](),_0x130653['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x10c152=await database_1[_0xc10c9b(0x184)][_0xc10c9b(0x176)]['findMany']({'where':{'createdAt':{'gte':_0x2a9543,'lte':_0xc06a38},'status':_0xc10c9b(0x146)},'select':{'amount':!![]}}),_0x4febb1=_0x10c152[_0xc10c9b(0x17d)]((_0x43087b,_0x5a7700)=>_0x43087b+_0x5a7700[_0xc10c9b(0x207)],0x0),_0x3e1074={'totalPayout':Math[_0xc10c9b(0x15c)](_0x42c854*0x64)/0x64,'awaitingPayout':Math[_0xc10c9b(0x15c)](_0x2e3c27*0x64)/0x64,'thisMonth':Math[_0xc10c9b(0x15c)](_0x4febb1*0x64)/0x64,'availableBalance':Math[_0xc10c9b(0x15c)](_0x34c916*0x64)/0x64};return console[_0xc10c9b(0x203)](_0xc10c9b(0x1ef)),console['log'](_0xc10c9b(0x1d1)+_0x3e1074[_0xc10c9b(0x16b)]+_0xc10c9b(0x17f)),console[_0xc10c9b(0x203)](_0xc10c9b(0x1cf)+_0x3e1074['awaitingPayout']+_0xc10c9b(0x1d2)),console[_0xc10c9b(0x203)](_0xc10c9b(0x162)+_0x3e1074[_0xc10c9b(0x1b8)]+_0xc10c9b(0x161)),console[_0xc10c9b(0x203)](_0xc10c9b(0x1a9)+_0x3e1074[_0xc10c9b(0x158)]+'\x20USDT'),_0x3e1074;}async['updateCustomerData'](_0x5a7400,_0x1a6dae){const _0x23bc5f=a33_0x1dbf14;console[_0x23bc5f(0x203)](_0x23bc5f(0x1b5)+_0x5a7400+':',_0x1a6dae);const _0x357ba8=await database_1[_0x23bc5f(0x184)][_0x23bc5f(0x157)][_0x23bc5f(0x1e5)]({'where':{'id':_0x5a7400},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x357ba8)throw new Error(_0x23bc5f(0x13f));const _0x5f1501={};_0x1a6dae[_0x23bc5f(0x1c1)]!==undefined&&(_0x5f1501[_0x23bc5f(0x1c1)]=_0x1a6dae[_0x23bc5f(0x1c1)]||null);_0x1a6dae[_0x23bc5f(0x152)]!==undefined&&(_0x5f1501[_0x23bc5f(0x152)]=_0x1a6dae[_0x23bc5f(0x152)]||null);_0x1a6dae[_0x23bc5f(0x204)]!==undefined&&(_0x5f1501[_0x23bc5f(0x204)]=_0x1a6dae[_0x23bc5f(0x204)]||null);const _0x3a7c2e=await database_1[_0x23bc5f(0x184)][_0x23bc5f(0x157)][_0x23bc5f(0x198)]({'where':{'id':_0x5a7400},'data':{..._0x5f1501,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x23bc5f(0x203)](_0x23bc5f(0x1dc)+_0x5a7400),console['log'](_0x23bc5f(0x17a)+_0x357ba8['customerCountry']+_0x23bc5f(0x1f5)+_0x3a7c2e[_0x23bc5f(0x1c1)]),console['log'](_0x23bc5f(0x164)+_0x357ba8['customerIp']+_0x23bc5f(0x1f5)+_0x3a7c2e[_0x23bc5f(0x152)]),console[_0x23bc5f(0x203)](_0x23bc5f(0x1de)+(_0x357ba8['customerUa']?'set':_0x23bc5f(0x177))+_0x23bc5f(0x1f5)+(_0x3a7c2e[_0x23bc5f(0x204)]?_0x23bc5f(0x1bd):_0x23bc5f(0x177))),_0x3a7c2e;}async[a33_0x1dbf14(0x1fc)](_0x1daed3){const _0x3dedfb=a33_0x1dbf14,_0x592ce0=new Date();let _0x452186;switch(_0x1daed3){case'7d':_0x452186=new Date(_0x592ce0[_0x3dedfb(0x17e)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x3dedfb(0x173):_0x452186=new Date(_0x592ce0[_0x3dedfb(0x17e)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x3dedfb(0x19d):_0x452186=new Date(_0x592ce0[_0x3dedfb(0x17e)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x452186=new Date(_0x592ce0[_0x3dedfb(0x17e)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x2b6287,_0x1c19fe,_0x580871,_0x4711b0,_0x30b1ed,_0x2b0562]=await Promise['all']([database_1[_0x3dedfb(0x184)][_0x3dedfb(0x1f6)][_0x3dedfb(0x1d4)](),database_1['default'][_0x3dedfb(0x1f6)]['count']({'where':{'status':_0x3dedfb(0x202)}}),database_1[_0x3dedfb(0x184)][_0x3dedfb(0x157)][_0x3dedfb(0x1d4)]({'where':{'createdAt':{'gte':_0x452186}}}),database_1[_0x3dedfb(0x184)]['payment'][_0x3dedfb(0x1d4)]({'where':{'status':'PAID','createdAt':{'gte':_0x452186}}}),database_1[_0x3dedfb(0x184)][_0x3dedfb(0x157)]['findMany']({'where':{'status':_0x3dedfb(0x1c9),'createdAt':{'gte':_0x452186}},'select':{'amount':!![],'currency':!![]}}),database_1['default']['payment'][_0x3dedfb(0x1f7)]({'take':0xa,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}})]);let _0xc98aac=0x0;for(const _0x1b1011 of _0x30b1ed){const _0x404cb3=await currencyService_1[_0x3dedfb(0x208)]['convertToUSDT'](_0x1b1011[_0x3dedfb(0x207)],_0x1b1011['currency']);_0xc98aac+=_0x404cb3;}const _0x420f4a=_0x580871>0x0?_0x4711b0/_0x580871*0x64:0x0;return{'totalShops':_0x2b6287,'activeShops':_0x1c19fe,'totalPayments':_0x580871,'successfulPayments':_0x4711b0,'totalRevenue':Math['round'](_0xc98aac*0x64)/0x64,'conversionRate':Math[_0x3dedfb(0x15c)](_0x420f4a*0x64)/0x64,'recentPayments':_0x2b0562[_0x3dedfb(0x181)](_0x34269a=>({'id':_0x34269a['id'],'amount':_0x34269a[_0x3dedfb(0x207)],'currency':_0x34269a[_0x3dedfb(0x1c3)],'status':_0x34269a['status'],'gateway':_0x34269a['gateway'],'shop':_0x34269a[_0x3dedfb(0x1f6)],'createdAt':_0x34269a['createdAt']}))};}async[a33_0x1dbf14(0x1d9)](_0x47061c){const _0x26c1e6=a33_0x1dbf14;console[_0x26c1e6(0x203)](_0x26c1e6(0x1f3),_0x47061c);let _0x509302,_0x3c578e=new Date();if(_0x47061c[_0x26c1e6(0x1eb)]===_0x26c1e6(0x19c)&&_0x47061c[_0x26c1e6(0x209)]&&_0x47061c['dateTo'])_0x509302=new Date(_0x47061c[_0x26c1e6(0x209)]),_0x3c578e=new Date(_0x47061c[_0x26c1e6(0x18a)]);else{const _0x54df24=new Date();switch(_0x47061c['period']){case _0x26c1e6(0x1a7):_0x509302=new Date(_0x54df24['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x26c1e6(0x163):_0x509302=new Date(_0x54df24[_0x26c1e6(0x17e)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'year':_0x509302=new Date(_0x54df24[_0x26c1e6(0x17e)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x26c1e6(0x1e1):default:_0x509302=new Date(_0x26c1e6(0x1ee));break;}}console['log'](_0x26c1e6(0x1fa)+_0x509302[_0x26c1e6(0x1c4)]()+_0x26c1e6(0x1ac)+_0x3c578e[_0x26c1e6(0x1c4)]());const _0x40d30f={'status':'PAID','paidAt':{'gte':_0x509302,'lte':_0x3c578e}};_0x47061c[_0x26c1e6(0x1ca)]&&(_0x40d30f[_0x26c1e6(0x1ca)]=_0x47061c[_0x26c1e6(0x1ca)]);const _0x48eebf=await database_1[_0x26c1e6(0x184)][_0x26c1e6(0x157)][_0x26c1e6(0x1f7)]({'where':_0x40d30f,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x26c1e6(0x203)](_0x26c1e6(0x1b4)+_0x48eebf[_0x26c1e6(0x1ba)]+'\x20paid\x20payments\x20for\x20analysis');let _0x48a52c=0x0,_0x57c780=0x0,_0x15a9db=0x0;const _0x5924d4={},_0x25c893={},_0x1e1563={};for(const _0x33b484 of _0x48eebf){try{const _0x3cc376=await currencyService_1['currencyService'][_0x26c1e6(0x142)](_0x33b484[_0x26c1e6(0x207)],_0x33b484[_0x26c1e6(0x1c3)]);let _0x138311={};if(_0x33b484[_0x26c1e6(0x1f6)][_0x26c1e6(0x1e7)])try{_0x138311=JSON[_0x26c1e6(0x1a1)](_0x33b484[_0x26c1e6(0x1f6)]['gatewaySettings']);}catch(_0x407b25){console[_0x26c1e6(0x16f)]('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x33b484[_0x26c1e6(0x1ca)]+':',_0x407b25);}const _0x39c098=_0x138311[_0x26c1e6(0x19f)]||0xa,_0x502521=_0x3cc376*(_0x39c098/0x64),_0x580529=_0x3cc376-_0x502521;_0x48a52c+=_0x3cc376,_0x57c780+=_0x580529,_0x15a9db+=_0x502521;!_0x5924d4[_0x33b484['gateway']]&&(_0x5924d4[_0x33b484['gateway']]={'gateway':_0x33b484[_0x26c1e6(0x155)],'gatewayDisplayName':this[_0x26c1e6(0x14f)](_0x33b484[_0x26c1e6(0x155)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x5924d4[_0x33b484[_0x26c1e6(0x155)]][_0x26c1e6(0x1fb)]++,_0x5924d4[_0x33b484[_0x26c1e6(0x155)]]['turnoverUSDT']+=_0x3cc376,_0x5924d4[_0x33b484[_0x26c1e6(0x155)]][_0x26c1e6(0x1f8)]+=_0x502521,_0x5924d4[_0x33b484[_0x26c1e6(0x155)]]['merchantEarningsUSDT']+=_0x580529,_0x5924d4[_0x33b484['gateway']][_0x26c1e6(0x1ad)]+=_0x39c098;!_0x47061c[_0x26c1e6(0x1ca)]&&(!_0x25c893[_0x33b484[_0x26c1e6(0x1ca)]]&&(_0x25c893[_0x33b484['shopId']]={'shopId':_0x33b484[_0x26c1e6(0x1ca)],'shopName':_0x33b484['shop'][_0x26c1e6(0x1ae)],'shopUsername':_0x33b484[_0x26c1e6(0x1f6)]['username'],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x25c893[_0x33b484[_0x26c1e6(0x1ca)]][_0x26c1e6(0x1fb)]++,_0x25c893[_0x33b484[_0x26c1e6(0x1ca)]][_0x26c1e6(0x1c5)]+=_0x3cc376,_0x25c893[_0x33b484[_0x26c1e6(0x1ca)]][_0x26c1e6(0x1f8)]+=_0x502521,_0x25c893[_0x33b484[_0x26c1e6(0x1ca)]][_0x26c1e6(0x172)]+=_0x580529);const _0x12ae64=_0x33b484[_0x26c1e6(0x18c)][_0x26c1e6(0x1c4)]()['split']('T')[0x0];!_0x1e1563[_0x12ae64]&&(_0x1e1563[_0x12ae64]={'date':_0x12ae64,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x1e1563[_0x12ae64]['turnover']+=_0x3cc376,_0x1e1563[_0x12ae64][_0x26c1e6(0x159)]+=_0x580529,_0x1e1563[_0x12ae64][_0x26c1e6(0x17c)]+=_0x502521,_0x1e1563[_0x12ae64]['paymentsCount']++;}catch(_0x1d4ae7){console[_0x26c1e6(0x16f)](_0x26c1e6(0x182)+_0x33b484['id']+':',_0x1d4ae7);}}Object[_0x26c1e6(0x15f)](_0x5924d4)[_0x26c1e6(0x145)](_0x270663=>{const _0x2f538b=_0x26c1e6;_0x270663[_0x2f538b(0x169)]=_0x270663[_0x2f538b(0x1fb)]>0x0?_0x270663[_0x2f538b(0x1ad)]/_0x270663[_0x2f538b(0x1fb)]:0x0,delete _0x270663[_0x2f538b(0x1ad)];}),Object[_0x26c1e6(0x15f)](_0x25c893)[_0x26c1e6(0x145)](_0x73a0f8=>{const _0xa5eb89=_0x26c1e6;_0x73a0f8[_0xa5eb89(0x1b3)]=_0x73a0f8['paymentsCount']>0x0?_0x73a0f8[_0xa5eb89(0x1c5)]/_0x73a0f8['paymentsCount']:0x0;});let _0x42b185=0x0;if(_0x47061c[_0x26c1e6(0x1ca)]){const _0x55f7cb=await database_1[_0x26c1e6(0x184)]['payout'][_0x26c1e6(0x1f7)]({'where':{'shopId':_0x47061c['shopId'],'status':'COMPLETED','createdAt':{'gte':_0x509302,'lte':_0x3c578e}},'select':{'amount':!![]}});_0x42b185=_0x55f7cb[_0x26c1e6(0x17d)]((_0x7c1647,_0x2161e8)=>_0x7c1647+_0x2161e8[_0x26c1e6(0x207)],0x0);}const _0x588caf=_0x48eebf[_0x26c1e6(0x1ba)],_0x388d12=_0x48eebf[_0x26c1e6(0x1ba)],_0x42aa22=_0x588caf>0x0?_0x48a52c/_0x588caf:0x0,_0xfc27f7=0x64,_0x2ebf8e=Math[_0x26c1e6(0x189)]((_0x3c578e[_0x26c1e6(0x17e)]()-_0x509302[_0x26c1e6(0x17e)]())/(0x3e8*0x3c*0x3c*0x18)),_0x4cf65d={'totalTurnover':Math['round'](_0x48a52c*0x64)/0x64,'merchantEarnings':Math[_0x26c1e6(0x15c)](_0x57c780*0x64)/0x64,'gatewayEarnings':Math[_0x26c1e6(0x15c)](_0x15a9db*0x64)/0x64,'totalPaidOut':Math[_0x26c1e6(0x15c)](_0x42b185*0x64)/0x64,'averageCheck':Math[_0x26c1e6(0x15c)](_0x42aa22*0x64)/0x64,'totalPayments':_0x588caf,'successfulPayments':_0x388d12,'conversionRate':_0xfc27f7,'gatewayBreakdown':Object[_0x26c1e6(0x15f)](_0x5924d4)[_0x26c1e6(0x181)](_0x4c4aac=>({..._0x4c4aac,'turnoverUSDT':Math[_0x26c1e6(0x15c)](_0x4c4aac[_0x26c1e6(0x1c5)]*0x64)/0x64,'commissionUSDT':Math[_0x26c1e6(0x15c)](_0x4c4aac[_0x26c1e6(0x1f8)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x26c1e6(0x15c)](_0x4c4aac[_0x26c1e6(0x172)]*0x64)/0x64,'averageCommissionRate':Math['round'](_0x4c4aac[_0x26c1e6(0x169)]*0x64)/0x64})),'merchantBreakdown':_0x47061c[_0x26c1e6(0x1ca)]?undefined:Object[_0x26c1e6(0x15f)](_0x25c893)['map'](_0xdc66f8=>({..._0xdc66f8,'turnoverUSDT':Math[_0x26c1e6(0x15c)](_0xdc66f8[_0x26c1e6(0x1c5)]*0x64)/0x64,'commissionUSDT':Math['round'](_0xdc66f8['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x26c1e6(0x15c)](_0xdc66f8['merchantEarningsUSDT']*0x64)/0x64,'paidOutUSDT':Math[_0x26c1e6(0x15c)](_0xdc66f8[_0x26c1e6(0x1bc)]*0x64)/0x64,'averageCheckUSDT':Math[_0x26c1e6(0x15c)](_0xdc66f8['averageCheckUSDT']*0x64)/0x64})),'dailyData':Object['values'](_0x1e1563)['map'](_0x28f032=>({..._0x28f032,'turnover':Math['round'](_0x28f032[_0x26c1e6(0x1dd)]*0x64)/0x64,'merchantEarnings':Math[_0x26c1e6(0x15c)](_0x28f032[_0x26c1e6(0x159)]*0x64)/0x64,'gatewayEarnings':Math[_0x26c1e6(0x15c)](_0x28f032['gatewayEarnings']*0x64)/0x64}))[_0x26c1e6(0x1d3)]((_0x3a7211,_0x28da2f)=>_0x3a7211[_0x26c1e6(0x1b1)][_0x26c1e6(0x16a)](_0x28da2f[_0x26c1e6(0x1b1)])),'periodInfo':{'from':_0x509302,'to':_0x3c578e,'periodType':_0x47061c[_0x26c1e6(0x1eb)]||_0x26c1e6(0x19c),'daysCount':_0x2ebf8e}};return console[_0x26c1e6(0x203)](_0x26c1e6(0x14d)),console[_0x26c1e6(0x203)]('\x20\x20\x20💰\x20Total\x20turnover:\x20'+_0x4cf65d[_0x26c1e6(0x148)]+_0x26c1e6(0x19b)),console[_0x26c1e6(0x203)]('\x20\x20\x20👤\x20Merchant\x20earnings:\x20'+_0x4cf65d[_0x26c1e6(0x159)]+_0x26c1e6(0x19b)),console['log'](_0x26c1e6(0x1b7)+_0x4cf65d['gatewayEarnings']+_0x26c1e6(0x19b)),console[_0x26c1e6(0x203)]('\x20\x20\x20📊\x20Total\x20payments:\x20'+_0x4cf65d[_0x26c1e6(0x1a0)]),_0x4cf65d;}[a33_0x1dbf14(0x14f)](_0x5d9181){const _0x489a45=a33_0x1dbf14,_0x5cd28b={'plisio':_0x489a45(0x193),'rapyd':_0x489a45(0x183),'noda':_0x489a45(0x1c6),'cointopay':_0x489a45(0x1fe),'klyme_eu':'KLYME\x20EU','klyme_gb':'KLYME\x20GB','klyme_de':_0x489a45(0x191)};return _0x5cd28b[_0x5d9181]||_0x5d9181;}async[a33_0x1dbf14(0x1b6)](_0x45566c){const _0x4413d7=a33_0x1dbf14,{page:_0x567003,limit:_0x382e52,minAmount:_0x4662cc,search:_0x15a04f}=_0x45566c,_0x5b30eb=(_0x567003-0x1)*_0x382e52;console[_0x4413d7(0x203)]('📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:',_0x45566c);const _0x29085c=await database_1[_0x4413d7(0x184)][_0x4413d7(0x157)]['findMany']({'where':{'status':_0x4413d7(0x1c9),'merchantPaid':![],'paidAt':{'not':null}},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'gatewaySettings':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}});console[_0x4413d7(0x203)](_0x4413d7(0x1b4)+_0x29085c['length']+'\x20payments\x20awaiting\x20payout');const _0x2626e6={};for(const _0x3a8d0d of _0x29085c){const _0x1e082c=_0x3a8d0d[_0x4413d7(0x1ca)];!_0x2626e6[_0x1e082c]&&(_0x2626e6[_0x1e082c]={'id':_0x3a8d0d['shop']['id'],'fullName':_0x3a8d0d[_0x4413d7(0x1f6)][_0x4413d7(0x1ae)],'username':_0x3a8d0d[_0x4413d7(0x1f6)][_0x4413d7(0x156)],'telegramId':_0x3a8d0d['shop'][_0x4413d7(0x1c7)],'merchantUrl':_0x3a8d0d[_0x4413d7(0x1f6)][_0x4413d7(0x180)],'wallets':{'usdtPolygonWallet':_0x3a8d0d[_0x4413d7(0x1f6)][_0x4413d7(0x1e4)],'usdtTrcWallet':_0x3a8d0d[_0x4413d7(0x1f6)][_0x4413d7(0x1a5)],'usdtErcWallet':_0x3a8d0d['shop'][_0x4413d7(0x19a)],'usdcPolygonWallet':_0x3a8d0d[_0x4413d7(0x1f6)]['usdcPolygonWallet']},'totalAmountUSDT':0x0,'totalAmountAfterCommissionUSDT':0x0,'paymentsCount':0x0,'oldestPaymentDate':_0x3a8d0d['paidAt'],'gatewayBreakdown':{},'gatewaySettings':_0x3a8d0d['shop'][_0x4413d7(0x1e7)]});try{const _0x18b48e=await currencyService_1[_0x4413d7(0x208)][_0x4413d7(0x142)](_0x3a8d0d[_0x4413d7(0x207)],_0x3a8d0d[_0x4413d7(0x1c3)]);let _0x4a9a27={};if(_0x3a8d0d[_0x4413d7(0x1f6)][_0x4413d7(0x1e7)])try{_0x4a9a27=JSON['parse'](_0x3a8d0d[_0x4413d7(0x1f6)]['gatewaySettings']);}catch(_0x30aeaa){console[_0x4413d7(0x16f)](_0x4413d7(0x143)+_0x1e082c+':',_0x30aeaa);}const _0x49f1a1=_0x4a9a27[_0x4413d7(0x19f)]||0xa,_0x1a501d=_0x18b48e*(0x1-_0x49f1a1/0x64);_0x2626e6[_0x1e082c][_0x4413d7(0x1bb)]+=_0x18b48e,_0x2626e6[_0x1e082c]['totalAmountAfterCommissionUSDT']+=_0x1a501d,_0x2626e6[_0x1e082c][_0x4413d7(0x1fb)]++,_0x3a8d0d[_0x4413d7(0x18c)]<_0x2626e6[_0x1e082c]['oldestPaymentDate']&&(_0x2626e6[_0x1e082c][_0x4413d7(0x1a2)]=_0x3a8d0d['paidAt']),!_0x2626e6[_0x1e082c][_0x4413d7(0x1b9)][_0x3a8d0d[_0x4413d7(0x155)]]&&(_0x2626e6[_0x1e082c]['gatewayBreakdown'][_0x3a8d0d['gateway']]={'gateway':_0x3a8d0d[_0x4413d7(0x155)],'count':0x0,'amountUSDT':0x0,'amountAfterCommissionUSDT':0x0,'commission':_0x49f1a1}),_0x2626e6[_0x1e082c][_0x4413d7(0x1b9)][_0x3a8d0d[_0x4413d7(0x155)]]['count']++,_0x2626e6[_0x1e082c]['gatewayBreakdown'][_0x3a8d0d['gateway']][_0x4413d7(0x200)]+=_0x18b48e,_0x2626e6[_0x1e082c][_0x4413d7(0x1b9)][_0x3a8d0d[_0x4413d7(0x155)]][_0x4413d7(0x1df)]+=_0x1a501d;}catch(_0x270cbb){console[_0x4413d7(0x16f)](_0x4413d7(0x182)+_0x3a8d0d['id']+':',_0x270cbb);}}let _0x48ebdb=Object[_0x4413d7(0x15f)](_0x2626e6)['map'](_0x43251a=>({..._0x43251a,'totalAmountUSDT':Math[_0x4413d7(0x15c)](_0x43251a[_0x4413d7(0x1bb)]*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x43251a[_0x4413d7(0x14b)]*0x64)/0x64,'gatewayBreakdown':Object[_0x4413d7(0x15f)](_0x43251a['gatewayBreakdown'])[_0x4413d7(0x181)](_0x28220c=>({..._0x28220c,'amountUSDT':Math[_0x4413d7(0x15c)](_0x28220c[_0x4413d7(0x200)]*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x4413d7(0x15c)](_0x28220c[_0x4413d7(0x1df)]*0x64)/0x64}))}));_0x4662cc&&(_0x48ebdb=_0x48ebdb['filter'](_0x1fa75c=>_0x1fa75c[_0x4413d7(0x14b)]>=_0x4662cc));if(_0x15a04f){const _0x2d3604=_0x15a04f[_0x4413d7(0x14a)]();_0x48ebdb=_0x48ebdb[_0x4413d7(0x18d)](_0x242184=>_0x242184[_0x4413d7(0x1ea)][_0x4413d7(0x14a)]()[_0x4413d7(0x16c)](_0x2d3604)||_0x242184['username']['toLowerCase']()[_0x4413d7(0x16c)](_0x2d3604));}_0x48ebdb['sort']((_0x22a7dd,_0x2530a7)=>_0x2530a7[_0x4413d7(0x14b)]-_0x22a7dd[_0x4413d7(0x14b)]);const _0x530024=_0x48ebdb[_0x4413d7(0x1ba)],_0x38ea01=_0x48ebdb[_0x4413d7(0x192)](_0x5b30eb,_0x5b30eb+_0x382e52),_0x4ec9ba=_0x48ebdb[_0x4413d7(0x17d)]((_0x254ec2,_0x2a5c2e)=>_0x254ec2+_0x2a5c2e['totalAmountUSDT'],0x0),_0x26041e=_0x48ebdb[_0x4413d7(0x17d)]((_0x10ae0c,_0x3684a5)=>_0x10ae0c+_0x3684a5[_0x4413d7(0x14b)],0x0);return console['log'](_0x4413d7(0x1d5)+_0x530024+_0x4413d7(0x20b)+Math['round'](_0x26041e*0x64)/0x64+_0x4413d7(0x1cc)),{'merchants':_0x38ea01,'pagination':{'page':_0x567003,'limit':_0x382e52,'total':_0x530024,'totalPages':Math[_0x4413d7(0x189)](_0x530024/_0x382e52)},'summary':{'totalMerchants':_0x530024,'totalAmountUSDT':Math[_0x4413d7(0x15c)](_0x4ec9ba*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x4413d7(0x15c)](_0x26041e*0x64)/0x64}};}async[a33_0x1dbf14(0x15b)](_0x2bd83f){const _0x49a2ba=a33_0x1dbf14,{shopId:_0x16abac,amount:_0x3b4406,network:_0x35acc8,notes:_0x46ff08,periodFrom:_0x401528,periodTo:_0x192134}=_0x2bd83f,_0x2e7e80=await database_1[_0x49a2ba(0x184)][_0x49a2ba(0x1f6)][_0x49a2ba(0x1e5)]({'where':{'id':_0x16abac},'select':{'id':!![],'name':!![],'username':!![]}});if(!_0x2e7e80)throw new Error(_0x49a2ba(0x153));const _0x20e1a4=await database_1[_0x49a2ba(0x184)]['payout']['create']({'data':{'shopId':_0x16abac,'amount':_0x3b4406,'network':_0x35acc8,'status':'COMPLETED','notes':_0x46ff08,'periodFrom':_0x401528?new Date(_0x401528):null,'periodTo':_0x192134?new Date(_0x192134):null,'createdAt':new Date(),'paidAt':new Date()}});return console[_0x49a2ba(0x203)](_0x49a2ba(0x1ec)+_0x20e1a4['id']+_0x49a2ba(0x167)+_0x2e7e80['username']+'\x20('+_0x3b4406+'\x20USDT)'),{'id':_0x20e1a4['id'],'shopId':_0x20e1a4['shopId'],'shopName':_0x2e7e80[_0x49a2ba(0x1ae)],'shopUsername':_0x2e7e80[_0x49a2ba(0x156)],'amount':_0x20e1a4[_0x49a2ba(0x207)],'network':_0x20e1a4[_0x49a2ba(0x1bf)],'status':_0x20e1a4['status'],'txid':_0x20e1a4[_0x49a2ba(0x1f4)],'notes':_0x20e1a4[_0x49a2ba(0x1a3)],'periodFrom':_0x20e1a4[_0x49a2ba(0x1d7)],'periodTo':_0x20e1a4['periodTo'],'createdAt':_0x20e1a4[_0x49a2ba(0x165)],'paidAt':_0x20e1a4[_0x49a2ba(0x18c)]};}async[a33_0x1dbf14(0x18e)](_0xcee08d){const _0x4332a9=a33_0x1dbf14,{page:_0x1264c2,limit:_0x30886b,shopId:_0x536c24,network:_0x4c25e4,dateFrom:_0x353925,dateTo:_0x1c80f1,search:_0x4cd0a5}=_0xcee08d,_0xd77321=(_0x1264c2-0x1)*_0x30886b,_0x20bfa5={};_0x536c24&&(_0x20bfa5[_0x4332a9(0x1ca)]=_0x536c24);_0x4c25e4&&(_0x20bfa5[_0x4332a9(0x1bf)]=_0x4c25e4);(_0x353925||_0x1c80f1)&&(_0x20bfa5[_0x4332a9(0x165)]={},_0x353925&&(_0x20bfa5[_0x4332a9(0x165)][_0x4332a9(0x17b)]=new Date(_0x353925)),_0x1c80f1&&(_0x20bfa5[_0x4332a9(0x165)][_0x4332a9(0x160)]=new Date(_0x1c80f1)));_0x4cd0a5&&(_0x20bfa5['OR']=[{'shop':{'name':{'contains':_0x4cd0a5,'mode':_0x4332a9(0x175)}}},{'shop':{'username':{'contains':_0x4cd0a5,'mode':_0x4332a9(0x175)}}},{'notes':{'contains':_0x4cd0a5,'mode':'insensitive'}}]);const [_0xacbd6b,_0x39195c]=await Promise[_0x4332a9(0x1e1)]([database_1[_0x4332a9(0x184)][_0x4332a9(0x176)][_0x4332a9(0x1f7)]({'where':_0x20bfa5,'skip':_0xd77321,'take':_0x30886b,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x4332a9(0x184)][_0x4332a9(0x176)][_0x4332a9(0x1d4)]({'where':_0x20bfa5})]);return{'payouts':_0xacbd6b['map'](_0x3384be=>({'id':_0x3384be['id'],'shopId':_0x3384be[_0x4332a9(0x1ca)],'shopName':_0x3384be['shop'][_0x4332a9(0x1ae)],'shopUsername':_0x3384be[_0x4332a9(0x1f6)][_0x4332a9(0x156)],'amount':_0x3384be[_0x4332a9(0x207)],'network':_0x3384be[_0x4332a9(0x1bf)],'status':_0x3384be['status'],'txid':_0x3384be['txid'],'notes':_0x3384be[_0x4332a9(0x1a3)],'periodFrom':_0x3384be[_0x4332a9(0x1d7)],'periodTo':_0x3384be[_0x4332a9(0x1e9)],'createdAt':_0x3384be[_0x4332a9(0x165)],'paidAt':_0x3384be[_0x4332a9(0x18c)]})),'pagination':{'page':_0x1264c2,'limit':_0x30886b,'total':_0x39195c,'totalPages':Math['ceil'](_0x39195c/_0x30886b)}};}async['getPayoutById'](_0xf2e8b1){const _0x4c7d19=a33_0x1dbf14,_0x32d5fe=await database_1[_0x4c7d19(0x184)][_0x4c7d19(0x176)][_0x4c7d19(0x1e5)]({'where':{'id':_0xf2e8b1},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x32d5fe)return null;return{'id':_0x32d5fe['id'],'shopId':_0x32d5fe[_0x4c7d19(0x1ca)],'shopName':_0x32d5fe['shop'][_0x4c7d19(0x1ae)],'shopUsername':_0x32d5fe['shop']['username'],'amount':_0x32d5fe[_0x4c7d19(0x207)],'network':_0x32d5fe[_0x4c7d19(0x1bf)],'status':_0x32d5fe[_0x4c7d19(0x1aa)],'txid':_0x32d5fe[_0x4c7d19(0x1f4)],'notes':_0x32d5fe[_0x4c7d19(0x1a3)],'periodFrom':_0x32d5fe['periodFrom'],'periodTo':_0x32d5fe[_0x4c7d19(0x1e9)],'createdAt':_0x32d5fe['createdAt'],'paidAt':_0x32d5fe[_0x4c7d19(0x18c)]};}async[a33_0x1dbf14(0x1b0)](_0x31939d){const _0x24ffe0=a33_0x1dbf14;await database_1[_0x24ffe0(0x184)][_0x24ffe0(0x176)][_0x24ffe0(0x1f1)]({'where':{'id':_0x31939d}});}async[a33_0x1dbf14(0x141)](_0x190eb1){const _0xc74bcb=a33_0x1dbf14,{page:_0x192638,limit:_0x419c07,status:_0x28d3e8,gateway:_0x386cf3,shopId:_0x307b8e,dateFrom:_0x33608e,dateTo:_0x18073b,search:_0x2bbd25}=_0x190eb1,_0x473d30=(_0x192638-0x1)*_0x419c07,_0xde5634={};_0x28d3e8&&(_0xde5634[_0xc74bcb(0x1aa)]=_0x28d3e8[_0xc74bcb(0x1c8)]());_0x386cf3&&(_0xde5634[_0xc74bcb(0x155)]=_0x386cf3[_0xc74bcb(0x14a)]());_0x307b8e&&(_0xde5634['shopId']=_0x307b8e);(_0x33608e||_0x18073b)&&(_0xde5634[_0xc74bcb(0x165)]={},_0x33608e&&(_0xde5634['createdAt'][_0xc74bcb(0x17b)]=new Date(_0x33608e)),_0x18073b&&(_0xde5634[_0xc74bcb(0x165)]['lte']=new Date(_0x18073b)));_0x2bbd25&&(_0xde5634['OR']=[{'orderId':{'contains':_0x2bbd25,'mode':_0xc74bcb(0x175)}},{'gatewayOrderId':{'contains':_0x2bbd25,'mode':_0xc74bcb(0x175)}},{'customerEmail':{'contains':_0x2bbd25,'mode':'insensitive'}},{'shop':{'name':{'contains':_0x2bbd25,'mode':_0xc74bcb(0x175)}}},{'shop':{'username':{'contains':_0x2bbd25,'mode':_0xc74bcb(0x175)}}}]);const [_0x439183,_0x444e4e]=await Promise['all']([database_1[_0xc74bcb(0x184)]['payment'][_0xc74bcb(0x1f7)]({'where':_0xde5634,'skip':_0x473d30,'take':_0x419c07,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0xc74bcb(0x184)]['payment'][_0xc74bcb(0x1d4)]({'where':_0xde5634})]);return{'payments':_0x439183['map'](_0x498962=>({'id':_0x498962['id'],'shopId':_0x498962[_0xc74bcb(0x1ca)],'gateway':_0x498962[_0xc74bcb(0x155)],'amount':_0x498962['amount'],'currency':_0x498962['currency'],'status':_0x498962[_0xc74bcb(0x1aa)],'orderId':_0x498962['orderId'],'gatewayOrderId':_0x498962[_0xc74bcb(0x1cd)],'customerEmail':_0x498962[_0xc74bcb(0x1af)],'customerName':_0x498962[_0xc74bcb(0x1ce)],'customerCountry':_0x498962[_0xc74bcb(0x1c1)],'customerIp':_0x498962['customerIp'],'customerUa':_0x498962[_0xc74bcb(0x204)],'failureMessage':_0x498962['failureMessage'],'createdAt':_0x498962[_0xc74bcb(0x165)],'updatedAt':_0x498962[_0xc74bcb(0x1d6)],'shop':_0x498962[_0xc74bcb(0x1f6)]})),'pagination':{'page':_0x192638,'limit':_0x419c07,'total':_0x444e4e,'totalPages':Math[_0xc74bcb(0x189)](_0x444e4e/_0x419c07)}};}async[a33_0x1dbf14(0x149)](_0x1530bb){const _0x147117=a33_0x1dbf14,_0x4a5286=await database_1[_0x147117(0x184)][_0x147117(0x157)][_0x147117(0x1e5)]({'where':{'id':_0x1530bb},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x4a5286)return null;return{'id':_0x4a5286['id'],'shopId':_0x4a5286['shopId'],'gateway':_0x4a5286[_0x147117(0x155)],'amount':_0x4a5286[_0x147117(0x207)],'currency':_0x4a5286['currency'],'status':_0x4a5286[_0x147117(0x1aa)],'orderId':_0x4a5286['orderId'],'gatewayOrderId':_0x4a5286['gatewayOrderId'],'customerEmail':_0x4a5286[_0x147117(0x1af)],'customerName':_0x4a5286[_0x147117(0x1ce)],'customerCountry':_0x4a5286[_0x147117(0x1c1)],'customerIp':_0x4a5286[_0x147117(0x152)],'customerUa':_0x4a5286[_0x147117(0x204)],'failureMessage':_0x4a5286[_0x147117(0x170)],'externalPaymentUrl':_0x4a5286[_0x147117(0x19e)],'successUrl':_0x4a5286['successUrl'],'failUrl':_0x4a5286[_0x147117(0x1cb)],'pendingUrl':_0x4a5286[_0x147117(0x20a)],'whiteUrl':_0x4a5286[_0x147117(0x1e8)],'createdAt':_0x4a5286['createdAt'],'updatedAt':_0x4a5286['updatedAt'],'shop':_0x4a5286[_0x147117(0x1f6)]};}async[a33_0x1dbf14(0x1fd)](_0x5999df,_0x450474,_0x9e018f,_0x3aff79){const _0x46399b=a33_0x1dbf14,_0x5e3ff3={'status':_0x450474[_0x46399b(0x1c8)](),'updatedAt':new Date(),'statusChangedBy':_0x46399b(0x16e),'statusChangedAt':new Date()};_0x9e018f&&(_0x5e3ff3['adminNotes']=_0x9e018f);_0x450474[_0x46399b(0x1c8)]()===_0x46399b(0x1e2)&&_0x3aff79&&(_0x5e3ff3[_0x46399b(0x1b2)]=_0x3aff79);_0x450474['toUpperCase']()===_0x46399b(0x1c9)&&(_0x5e3ff3[_0x46399b(0x18c)]=new Date());const _0x25baea=await database_1[_0x46399b(0x184)][_0x46399b(0x157)][_0x46399b(0x198)]({'where':{'id':_0x5999df},'data':_0x5e3ff3,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return{'id':_0x25baea['id'],'shopId':_0x25baea[_0x46399b(0x1ca)],'gateway':_0x25baea[_0x46399b(0x155)],'amount':_0x25baea[_0x46399b(0x207)],'currency':_0x25baea['currency'],'status':_0x25baea[_0x46399b(0x1aa)],'orderId':_0x25baea[_0x46399b(0x144)],'gatewayOrderId':_0x25baea[_0x46399b(0x1cd)],'customerEmail':_0x25baea[_0x46399b(0x1af)],'customerName':_0x25baea['customerName'],'customerCountry':_0x25baea[_0x46399b(0x1c1)],'customerIp':_0x25baea[_0x46399b(0x152)],'customerUa':_0x25baea['customerUa'],'failureMessage':_0x25baea['failureMessage'],'adminNotes':_0x25baea[_0x46399b(0x168)],'chargebackAmount':_0x25baea[_0x46399b(0x1b2)],'statusChangedBy':_0x25baea['statusChangedBy'],'statusChangedAt':_0x25baea[_0x46399b(0x18f)],'createdAt':_0x25baea['createdAt'],'updatedAt':_0x25baea[_0x46399b(0x1d6)],'shop':_0x25baea[_0x46399b(0x1f6)]};}async[a33_0x1dbf14(0x1f0)](_0x5db36e,_0x1542f1){const _0xcb7c38=a33_0x1dbf14,_0x20fa99={..._0x1542f1};_0x1542f1['password']&&(_0x20fa99[_0xcb7c38(0x166)]=await bcryptjs_1['default'][_0xcb7c38(0x201)](_0x1542f1[_0xcb7c38(0x166)],0xc));_0x1542f1[_0xcb7c38(0x1ea)]&&(_0x20fa99[_0xcb7c38(0x1ae)]=_0x1542f1[_0xcb7c38(0x1ea)],delete _0x20fa99[_0xcb7c38(0x1ea)]);_0x1542f1[_0xcb7c38(0x199)]&&(_0x20fa99['telegram']=_0x1542f1[_0xcb7c38(0x199)],delete _0x20fa99[_0xcb7c38(0x199)]);_0x1542f1[_0xcb7c38(0x197)]&&(_0x20fa99[_0xcb7c38(0x180)]=_0x1542f1[_0xcb7c38(0x197)],delete _0x20fa99[_0xcb7c38(0x197)]);_0x1542f1[_0xcb7c38(0x1a8)]&&(_0x20fa99[_0xcb7c38(0x15a)]=JSON[_0xcb7c38(0x205)](_0x1542f1[_0xcb7c38(0x1a8)]),delete _0x20fa99[_0xcb7c38(0x1a8)]);_0x1542f1[_0xcb7c38(0x1e7)]&&(_0x20fa99[_0xcb7c38(0x1e7)]=JSON[_0xcb7c38(0x205)](_0x1542f1['gatewaySettings']),delete _0x20fa99[_0xcb7c38(0x1e7)]);_0x1542f1[_0xcb7c38(0x14e)]&&(_0x1542f1['wallets']['usdtPolygonWallet']!==undefined&&(_0x20fa99[_0xcb7c38(0x1e4)]=_0x1542f1[_0xcb7c38(0x14e)][_0xcb7c38(0x1e4)]||null),_0x1542f1[_0xcb7c38(0x14e)][_0xcb7c38(0x1a5)]!==undefined&&(_0x20fa99[_0xcb7c38(0x1a5)]=_0x1542f1[_0xcb7c38(0x14e)]['usdtTrcWallet']||null),_0x1542f1[_0xcb7c38(0x14e)]['usdtErcWallet']!==undefined&&(_0x20fa99[_0xcb7c38(0x19a)]=_0x1542f1[_0xcb7c38(0x14e)][_0xcb7c38(0x19a)]||null),_0x1542f1[_0xcb7c38(0x14e)]['usdcPolygonWallet']!==undefined&&(_0x20fa99['usdcPolygonWallet']=_0x1542f1[_0xcb7c38(0x14e)]['usdcPolygonWallet']||null),delete _0x20fa99['wallets']);const _0x537921=await database_1[_0xcb7c38(0x184)][_0xcb7c38(0x1f6)]['update']({'where':{'id':_0x5db36e},'data':_0x20fa99,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x537921['id'],'fullName':_0x537921[_0xcb7c38(0x1ae)],'username':_0x537921[_0xcb7c38(0x156)],'telegramId':_0x537921[_0xcb7c38(0x1c7)],'merchantUrl':_0x537921[_0xcb7c38(0x180)],'gateways':_0x537921['paymentGateways']?JSON[_0xcb7c38(0x1a1)](_0x537921['paymentGateways']):null,'gatewaySettings':_0x537921[_0xcb7c38(0x1e7)]?JSON[_0xcb7c38(0x1a1)](_0x537921[_0xcb7c38(0x1e7)]):null,'publicKey':_0x537921[_0xcb7c38(0x206)],'wallets':{'usdtPolygonWallet':_0x537921[_0xcb7c38(0x1e4)],'usdtTrcWallet':_0x537921[_0xcb7c38(0x1a5)],'usdtErcWallet':_0x537921['usdtErcWallet'],'usdcPolygonWallet':_0x537921[_0xcb7c38(0x1e0)]},'status':_0x537921[_0xcb7c38(0x1aa)],'createdAt':_0x537921[_0xcb7c38(0x165)]};}async[a33_0x1dbf14(0x154)](_0x5b47e2){const _0xf7e1e6=a33_0x1dbf14,_0x6c063a=await database_1['default'][_0xf7e1e6(0x1f6)][_0xf7e1e6(0x198)]({'where':{'id':_0x5b47e2},'data':{'status':_0xf7e1e6(0x1ff)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x6c063a['id'],'fullName':_0x6c063a[_0xf7e1e6(0x1ae)],'username':_0x6c063a['username'],'telegramId':_0x6c063a[_0xf7e1e6(0x1c7)],'merchantUrl':_0x6c063a[_0xf7e1e6(0x180)],'gateways':_0x6c063a[_0xf7e1e6(0x15a)]?JSON['parse'](_0x6c063a[_0xf7e1e6(0x15a)]):null,'gatewaySettings':_0x6c063a[_0xf7e1e6(0x1e7)]?JSON[_0xf7e1e6(0x1a1)](_0x6c063a[_0xf7e1e6(0x1e7)]):null,'publicKey':_0x6c063a[_0xf7e1e6(0x206)],'wallets':{'usdtPolygonWallet':_0x6c063a['usdtPolygonWallet'],'usdtTrcWallet':_0x6c063a[_0xf7e1e6(0x1a5)],'usdtErcWallet':_0x6c063a[_0xf7e1e6(0x19a)],'usdcPolygonWallet':_0x6c063a[_0xf7e1e6(0x1e0)]},'status':_0x6c063a[_0xf7e1e6(0x1aa)],'createdAt':_0x6c063a[_0xf7e1e6(0x165)]};}async['activateUser'](_0x4627bf){const _0x53af87=a33_0x1dbf14,_0x51c796=await database_1[_0x53af87(0x184)][_0x53af87(0x1f6)][_0x53af87(0x198)]({'where':{'id':_0x4627bf},'data':{'status':_0x53af87(0x202)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x51c796['id'],'fullName':_0x51c796[_0x53af87(0x1ae)],'username':_0x51c796[_0x53af87(0x156)],'telegramId':_0x51c796[_0x53af87(0x1c7)],'merchantUrl':_0x51c796[_0x53af87(0x180)],'gateways':_0x51c796[_0x53af87(0x15a)]?JSON['parse'](_0x51c796['paymentGateways']):null,'gatewaySettings':_0x51c796[_0x53af87(0x1e7)]?JSON['parse'](_0x51c796[_0x53af87(0x1e7)]):null,'publicKey':_0x51c796[_0x53af87(0x206)],'wallets':{'usdtPolygonWallet':_0x51c796[_0x53af87(0x1e4)],'usdtTrcWallet':_0x51c796[_0x53af87(0x1a5)],'usdtErcWallet':_0x51c796[_0x53af87(0x19a)],'usdcPolygonWallet':_0x51c796['usdcPolygonWallet']},'status':_0x51c796[_0x53af87(0x1aa)],'createdAt':_0x51c796[_0x53af87(0x165)]};}async[a33_0x1dbf14(0x171)](_0x5c34a3){const _0x13e7fd=a33_0x1dbf14,{page:_0x38519c,limit:_0x46c8b0,status:_0xe00497}=_0x5c34a3,_0x1838ab=(_0x38519c-0x1)*_0x46c8b0,_0x3e8b57={};_0xe00497&&(_0x3e8b57[_0x13e7fd(0x1aa)]=_0xe00497[_0x13e7fd(0x1c8)]());const [_0x25ee74,_0x350b5a]=await Promise[_0x13e7fd(0x1e1)]([database_1[_0x13e7fd(0x184)][_0x13e7fd(0x1f6)][_0x13e7fd(0x1f7)]({'where':_0x3e8b57,'skip':_0x1838ab,'take':_0x46c8b0,'orderBy':{'createdAt':_0x13e7fd(0x195)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x13e7fd(0x184)][_0x13e7fd(0x1f6)][_0x13e7fd(0x1d4)]({'where':_0x3e8b57})]);return{'users':_0x25ee74['map'](_0x3d71da=>({'id':_0x3d71da['id'],'fullName':_0x3d71da['name'],'username':_0x3d71da[_0x13e7fd(0x156)],'telegramId':_0x3d71da[_0x13e7fd(0x1c7)],'merchantUrl':_0x3d71da[_0x13e7fd(0x180)],'gateways':_0x3d71da[_0x13e7fd(0x15a)]?JSON[_0x13e7fd(0x1a1)](_0x3d71da[_0x13e7fd(0x15a)]):null,'gatewaySettings':_0x3d71da[_0x13e7fd(0x1e7)]?JSON[_0x13e7fd(0x1a1)](_0x3d71da[_0x13e7fd(0x1e7)]):null,'publicKey':_0x3d71da[_0x13e7fd(0x206)],'wallets':{'usdtPolygonWallet':_0x3d71da[_0x13e7fd(0x1e4)],'usdtTrcWallet':_0x3d71da[_0x13e7fd(0x1a5)],'usdtErcWallet':_0x3d71da[_0x13e7fd(0x19a)],'usdcPolygonWallet':_0x3d71da['usdcPolygonWallet']},'status':_0x3d71da[_0x13e7fd(0x1aa)],'createdAt':_0x3d71da[_0x13e7fd(0x165)]})),'pagination':{'page':_0x38519c,'limit':_0x46c8b0,'total':_0x350b5a,'totalPages':Math[_0x13e7fd(0x189)](_0x350b5a/_0x46c8b0)}};}async[a33_0x1dbf14(0x174)](_0x562e7b){const _0x393117=a33_0x1dbf14,_0x28bd44=await database_1['default'][_0x393117(0x1f6)][_0x393117(0x1e5)]({'where':{'id':_0x562e7b},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x28bd44)return null;return{'id':_0x28bd44['id'],'fullName':_0x28bd44[_0x393117(0x1ae)],'username':_0x28bd44['username'],'telegramId':_0x28bd44[_0x393117(0x1c7)],'merchantUrl':_0x28bd44[_0x393117(0x180)],'gateways':_0x28bd44[_0x393117(0x15a)]?JSON[_0x393117(0x1a1)](_0x28bd44[_0x393117(0x15a)]):null,'gatewaySettings':_0x28bd44[_0x393117(0x1e7)]?JSON[_0x393117(0x1a1)](_0x28bd44['gatewaySettings']):null,'publicKey':_0x28bd44[_0x393117(0x206)],'wallets':{'usdtPolygonWallet':_0x28bd44['usdtPolygonWallet'],'usdtTrcWallet':_0x28bd44[_0x393117(0x1a5)],'usdtErcWallet':_0x28bd44[_0x393117(0x19a)],'usdcPolygonWallet':_0x28bd44[_0x393117(0x1e0)]},'status':_0x28bd44[_0x393117(0x1aa)],'createdAt':_0x28bd44['createdAt']};}async[a33_0x1dbf14(0x14c)](_0x2d5f9c){const _0x5538aa=a33_0x1dbf14,{fullName:_0x52541d,username:_0x3ac2e0,password:_0x14c151,telegramId:_0x4471cf,merchantUrl:_0x2d5add,gateways:_0x50b125,gatewaySettings:_0x1f16b4,wallets:_0x2dc036}=_0x2d5f9c,_0xff1634=await database_1[_0x5538aa(0x184)][_0x5538aa(0x1f6)]['findUnique']({'where':{'username':_0x3ac2e0}});if(_0xff1634)throw new Error(_0x5538aa(0x1e3));if(_0x4471cf){const _0x22e7e4=await database_1['default'][_0x5538aa(0x1f6)][_0x5538aa(0x1e5)]({'where':{'telegram':_0x4471cf}});if(_0x22e7e4)throw new Error('Telegram\x20username\x20already\x20exists');}const _0x5edd88=await bcryptjs_1['default'][_0x5538aa(0x201)](_0x14c151,0xc),_0x1dee5a=_0x5538aa(0x150)+crypto_1[_0x5538aa(0x184)][_0x5538aa(0x140)](0x20)[_0x5538aa(0x186)]('hex'),_0x9090bc=_0x5538aa(0x1e6)+crypto_1['default'][_0x5538aa(0x140)](0x20)['toString']('hex'),_0x5ed986=await database_1[_0x5538aa(0x184)][_0x5538aa(0x1f6)]['create']({'data':{'name':_0x52541d,'username':_0x3ac2e0,'password':_0x5edd88,'telegram':_0x4471cf,'shopUrl':_0x2d5add,'paymentGateways':_0x50b125?JSON['stringify'](_0x50b125):null,'gatewaySettings':_0x1f16b4?JSON[_0x5538aa(0x205)](_0x1f16b4):null,'usdtPolygonWallet':_0x2dc036?.['usdtPolygonWallet']||null,'usdtTrcWallet':_0x2dc036?.[_0x5538aa(0x1a5)]||null,'usdtErcWallet':_0x2dc036?.[_0x5538aa(0x19a)]||null,'usdcPolygonWallet':_0x2dc036?.['usdcPolygonWallet']||null,'publicKey':_0x1dee5a,'secretKey':_0x9090bc,'status':_0x5538aa(0x202)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x5ed986['id'],'fullName':_0x5ed986[_0x5538aa(0x1ae)],'username':_0x5ed986[_0x5538aa(0x156)],'telegramId':_0x5ed986[_0x5538aa(0x1c7)],'merchantUrl':_0x5ed986[_0x5538aa(0x180)],'gateways':_0x5ed986[_0x5538aa(0x15a)]?JSON[_0x5538aa(0x1a1)](_0x5ed986[_0x5538aa(0x15a)]):null,'gatewaySettings':_0x5ed986[_0x5538aa(0x1e7)]?JSON[_0x5538aa(0x1a1)](_0x5ed986[_0x5538aa(0x1e7)]):null,'publicKey':_0x5ed986[_0x5538aa(0x206)],'wallets':{'usdtPolygonWallet':_0x5ed986[_0x5538aa(0x1e4)],'usdtTrcWallet':_0x5ed986[_0x5538aa(0x1a5)],'usdtErcWallet':_0x5ed986[_0x5538aa(0x19a)],'usdcPolygonWallet':_0x5ed986[_0x5538aa(0x1e0)]},'status':_0x5ed986[_0x5538aa(0x1aa)],'createdAt':_0x5ed986[_0x5538aa(0x165)]};}async[a33_0x1dbf14(0x1d8)](_0x3a6f40){const _0x382cbc=a33_0x1dbf14;await database_1[_0x382cbc(0x184)]['shop'][_0x382cbc(0x1f1)]({'where':{'id':_0x3a6f40}});}}exports['AdminService']=AdminService;