'use strict';function a33_0x4d44(_0x13c3a0,_0x194371){const _0x14582=a33_0x1458();return a33_0x4d44=function(_0x4d44a6,_0x2949f7){_0x4d44a6=_0x4d44a6-0x1ac;let _0x887cf5=_0x14582[_0x4d44a6];return _0x887cf5;},a33_0x4d44(_0x13c3a0,_0x194371);}function a33_0x1458(){const _0xfd427f=['dateTo','reduce','../config/database','payment','round','CHARGEBACK','paidAt','üìä\x20Merchant\x20statistics\x20calculated:','findUnique','deleteUser','customerName','gatewayEarnings','localeCompare','oldestPaymentDate','chargebackAmount','\x20\x20\x20üíµ\x20Available\x20balance:\x20','\x20\x20\x20üè™\x20Gateway\x20earnings:\x20','values','updatedAt','\x20payments\x20awaiting\x20payout','length','üîÑ\x20Updating\x20customer\x20data\x20for\x20payment\x20','getAllUsers','2329218ZRfCyZ','pk_','ACTIVE','\x20\x20\x20üí∞\x20Total\x20payout:\x20','merchantEarningsUSDT','gatewayBreakdown','55749eqkxeM','‚è≥\x20Payment\x20','\x20\x20\x20üë§\x20Merchant\x20earnings:\x20','updateUser','insensitive','getMerchantStatistics','username','admin','parse','orderId','hash','gatewayOrderId','shop','30d','network','toISOString','paymentsCount','gateways','count','getTime','lte','amountAfterCommissionUSDT','‚úÖ\x20Payment\x20','telegramId','log','name','PAID','4106322XmsuHd','default','month','getPayoutStats','convertToUSDT','\x20->\x20','\x20USDT\x20(before\x20commission)','toString','defineProperty','findMany','notes','\x20\x20\x20üåç\x20Country:\x20','gatewaySettings','COMPLETED','getFullYear','dateFrom','\x20\x20\x20üñ•Ô∏è\x20User\x20Agent:\x20','randomBytes','stringify','updateCustomerData','shopUrl','currencyService','password','status','\x20to\x20','1188aughpU','delete','35ArpfuA','__esModule','totalCommissionRate','getSystemStatistics','6YBLDZm','update','615449pAFviq','turnover','slice','KLYME\x20GB','getAllPayments','totalPayout','forEach','createdAt','filter','getMonth','hex','usdtTrcWallet','üìä\x20Payout\x20statistics\x20calculated:','shopId','statusChangedBy','merchantUrl','getPaymentById','üí∞\x20Found\x20','adminNotes','externalPaymentUrl','Shop\x20not\x20found','toUpperCase','create','\x20merchants,\x20','\x20USDT\x20(after\x20commission)','‚úÖ\x20Payout\x20created:\x20','KLYME\x20DE','txid','not\x20set','period','turnoverUSDT','‚úÖ\x20Customer\x20data\x20updated\x20for\x20payment\x20','customerCountry','error','periodTo','Plisio','averageCommissionRate','usdtErcWallet','includes','SUSPENDED','failureMessage','Noda','2020-01-01','\x20USDT\x20(pending\x20payout)','merchantPaid','commission','telegram','usdtPolygonWallet','createUser','\x20\x20\x20üí∞\x20Total\x20turnover:\x20','publicKey','9142UAIyQr','getAllPayouts','customerIp','getUserById','currency','323996kBFQgv','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','updatePaymentStatus','usdcPolygonWallet','\x20USDT\x20(paid\x20out)','pendingUrl','Error\x20processing\x20payment\x20','totalAmountAfterCommissionUSDT','üìÖ\x20Period:\x20','date','map','desc','90d','amount','paymentGateways','bcryptjs','totalAmountUSDT','853200veHJoM','gateway','AdminService','\x20for\x20shop\x20','amountUSDT','ceil','customerUa','fullName','getGatewayDisplayName','\x20paid\x20payments','\x20USDT','Payment\x20not\x20found','merchantEarnings','üìä\x20Calculating\x20payout\x20statistics...','sk_','\x20\x20\x20üåê\x20IP:\x20','sort','paidOutUSDT','averageCheckUSDT','suspendUser','__importDefault','toLowerCase','gte','createPayout','\x20USDT\x20total','deletePayout','10pdMDeK','CoinToPay','customerEmail','KLYME\x20EU','set','wallets','custom','payout','crypto','getMerchantsAwaitingPayout','commissionUSDT','thisMonth','Rapyd','periodFrom','week','all'];a33_0x1458=function(){return _0xfd427f;};return a33_0x1458();}const a33_0x3ca426=a33_0x4d44;(function(_0x3078ec,_0x1897db){const _0x104929=a33_0x4d44,_0x5c9b0e=_0x3078ec();while(!![]){try{const _0x49ceb2=parseInt(_0x104929(0x1d0))/0x1+-parseInt(_0x104929(0x1ce))/0x2*(-parseInt(_0x104929(0x260))/0x3)+parseInt(_0x104929(0x208))/0x4*(-parseInt(_0x104929(0x1ca))/0x5)+parseInt(_0x104929(0x1c8))/0x6*(parseInt(_0x104929(0x203))/0x7)+-parseInt(_0x104929(0x219))/0x8+-parseInt(_0x104929(0x25a))/0x9*(parseInt(_0x104929(0x233))/0xa)+parseInt(_0x104929(0x1af))/0xb;if(_0x49ceb2===_0x1897db)break;else _0x5c9b0e['push'](_0x5c9b0e['shift']());}catch(_0x3f56dc){_0x5c9b0e['push'](_0x5c9b0e['shift']());}}}(a33_0x1458,0x5a7d3));var __importDefault=this&&this[a33_0x3ca426(0x22d)]||function(_0xf67357){const _0x504225=a33_0x3ca426;return _0xf67357&&_0xf67357[_0x504225(0x1cb)]?_0xf67357:{'default':_0xf67357};};Object[a33_0x3ca426(0x1b7)](exports,'__esModule',{'value':!![]}),exports['AdminService']=void 0x0;const database_1=__importDefault(require(a33_0x3ca426(0x245))),bcryptjs_1=__importDefault(require(a33_0x3ca426(0x217))),crypto_1=__importDefault(require(a33_0x3ca426(0x23b))),currencyService_1=require('./currencyService');class AdminService{async[a33_0x3ca426(0x1b2)](){const _0x2bc1b3=a33_0x3ca426;console[_0x2bc1b3(0x1ac)](_0x2bc1b3(0x226));const _0x1ae3f5=await database_1['default']['payment'][_0x2bc1b3(0x1b8)]({'where':{'status':'PAID','paidAt':{'not':null}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'merchantPaid':!![],'paidAt':!![],'createdAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console['log'](_0x2bc1b3(0x1e1)+_0x1ae3f5[_0x2bc1b3(0x257)]+_0x2bc1b3(0x222));let _0x3b36ad=0x0,_0x551912=0x0,_0x5aec93=0x0;for(const _0x419989 of _0x1ae3f5){try{const _0x18147b=await currencyService_1[_0x2bc1b3(0x1c4)]['convertToUSDT'](_0x419989['amount'],_0x419989[_0x2bc1b3(0x207)]);let _0x36fdfb={};if(_0x419989['shop'][_0x2bc1b3(0x1bb)])try{_0x36fdfb=JSON[_0x2bc1b3(0x268)](_0x419989[_0x2bc1b3(0x26c)][_0x2bc1b3(0x1bb)]);}catch(_0x45e23a){console[_0x2bc1b3(0x1f1)](_0x2bc1b3(0x209)+_0x419989[_0x2bc1b3(0x1dd)]+':',_0x45e23a);}const _0x7788b3=_0x36fdfb[_0x2bc1b3(0x1fd)]||0xa,_0x25dd5a=_0x18147b*(0x1-_0x7788b3/0x64);_0x419989[_0x2bc1b3(0x1fc)]?(_0x3b36ad+=_0x25dd5a,console[_0x2bc1b3(0x1ac)](_0x2bc1b3(0x276)+_0x419989['id']+':\x20'+_0x25dd5a['toFixed'](0x2)+_0x2bc1b3(0x20c))):(_0x551912+=_0x25dd5a,_0x5aec93+=_0x18147b,console[_0x2bc1b3(0x1ac)](_0x2bc1b3(0x261)+_0x419989['id']+':\x20'+_0x25dd5a['toFixed'](0x2)+_0x2bc1b3(0x1fb)));}catch(_0x13e924){console['error'](_0x2bc1b3(0x20e)+_0x419989['id']+':',_0x13e924);}}const _0x28e635=new Date(),_0x47a5a5=new Date(_0x28e635[_0x2bc1b3(0x1bd)](),_0x28e635[_0x2bc1b3(0x1d9)](),0x1),_0x25b863=new Date(_0x28e635['getFullYear'](),_0x28e635[_0x2bc1b3(0x1d9)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x4f5270=await database_1['default']['payout']['findMany']({'where':{'createdAt':{'gte':_0x47a5a5,'lte':_0x25b863},'status':'COMPLETED'},'select':{'amount':!![]}}),_0x51cb08=_0x4f5270[_0x2bc1b3(0x244)]((_0x4ff444,_0x4e269e)=>_0x4ff444+_0x4e269e[_0x2bc1b3(0x215)],0x0),_0x5a0d3f={'totalPayout':Math[_0x2bc1b3(0x247)](_0x3b36ad*0x64)/0x64,'awaitingPayout':Math[_0x2bc1b3(0x247)](_0x551912*0x64)/0x64,'thisMonth':Math[_0x2bc1b3(0x247)](_0x51cb08*0x64)/0x64,'availableBalance':Math[_0x2bc1b3(0x247)](_0x5aec93*0x64)/0x64};return console['log'](_0x2bc1b3(0x1dc)),console[_0x2bc1b3(0x1ac)](_0x2bc1b3(0x25d)+_0x5a0d3f[_0x2bc1b3(0x1d5)]+'\x20USDT\x20(paid\x20to\x20merchants)'),console[_0x2bc1b3(0x1ac)]('\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20'+_0x5a0d3f['awaitingPayout']+_0x2bc1b3(0x1e8)),console[_0x2bc1b3(0x1ac)](_0x2bc1b3(0x252)+_0x5a0d3f['availableBalance']+_0x2bc1b3(0x1b5)),console['log']('\x20\x20\x20üìÖ\x20This\x20month:\x20'+_0x5a0d3f[_0x2bc1b3(0x23e)]+'\x20USDT'),_0x5a0d3f;}async[a33_0x3ca426(0x1c2)](_0x503eab,_0x5806c0){const _0x3c2d4c=a33_0x3ca426;console[_0x3c2d4c(0x1ac)](_0x3c2d4c(0x258)+_0x503eab+':',_0x5806c0);const _0x58b1e3=await database_1[_0x3c2d4c(0x1b0)][_0x3c2d4c(0x246)]['findUnique']({'where':{'id':_0x503eab},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x58b1e3)throw new Error(_0x3c2d4c(0x224));const _0x14ab36={};_0x5806c0[_0x3c2d4c(0x1f0)]!==undefined&&(_0x14ab36[_0x3c2d4c(0x1f0)]=_0x5806c0[_0x3c2d4c(0x1f0)]||null);_0x5806c0[_0x3c2d4c(0x205)]!==undefined&&(_0x14ab36[_0x3c2d4c(0x205)]=_0x5806c0[_0x3c2d4c(0x205)]||null);_0x5806c0['customerUa']!==undefined&&(_0x14ab36['customerUa']=_0x5806c0[_0x3c2d4c(0x21f)]||null);const _0x893bdc=await database_1[_0x3c2d4c(0x1b0)]['payment'][_0x3c2d4c(0x1cf)]({'where':{'id':_0x503eab},'data':{..._0x14ab36,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x3c2d4c(0x1ac)](_0x3c2d4c(0x1ef)+_0x503eab),console[_0x3c2d4c(0x1ac)](_0x3c2d4c(0x1ba)+_0x58b1e3[_0x3c2d4c(0x1f0)]+_0x3c2d4c(0x1b4)+_0x893bdc[_0x3c2d4c(0x1f0)]),console[_0x3c2d4c(0x1ac)](_0x3c2d4c(0x228)+_0x58b1e3['customerIp']+_0x3c2d4c(0x1b4)+_0x893bdc['customerIp']),console[_0x3c2d4c(0x1ac)](_0x3c2d4c(0x1bf)+(_0x58b1e3['customerUa']?_0x3c2d4c(0x237):_0x3c2d4c(0x1ec))+_0x3c2d4c(0x1b4)+(_0x893bdc[_0x3c2d4c(0x21f)]?_0x3c2d4c(0x237):_0x3c2d4c(0x1ec))),_0x893bdc;}async[a33_0x3ca426(0x1cd)](_0x4d971f){const _0x5b8254=a33_0x3ca426,_0x2e6541=new Date();let _0x5d34b2;switch(_0x4d971f){case'7d':_0x5d34b2=new Date(_0x2e6541[_0x5b8254(0x273)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x5b8254(0x26d):_0x5d34b2=new Date(_0x2e6541[_0x5b8254(0x273)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x5b8254(0x214):_0x5d34b2=new Date(_0x2e6541[_0x5b8254(0x273)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x5d34b2=new Date(_0x2e6541[_0x5b8254(0x273)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x480622,_0x1c6ddb,_0x28bc7f,_0x5cb512,_0x1f1b76,_0x1447e7]=await Promise[_0x5b8254(0x242)]([database_1[_0x5b8254(0x1b0)][_0x5b8254(0x26c)][_0x5b8254(0x272)](),database_1[_0x5b8254(0x1b0)]['shop'][_0x5b8254(0x272)]({'where':{'status':'ACTIVE'}}),database_1[_0x5b8254(0x1b0)]['payment']['count']({'where':{'createdAt':{'gte':_0x5d34b2}}}),database_1[_0x5b8254(0x1b0)][_0x5b8254(0x246)]['count']({'where':{'status':_0x5b8254(0x1ae),'createdAt':{'gte':_0x5d34b2}}}),database_1['default'][_0x5b8254(0x246)][_0x5b8254(0x1b8)]({'where':{'status':_0x5b8254(0x1ae),'createdAt':{'gte':_0x5d34b2}},'select':{'amount':!![],'currency':!![]}}),database_1['default'][_0x5b8254(0x246)][_0x5b8254(0x1b8)]({'take':0xa,'orderBy':{'createdAt':_0x5b8254(0x213)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}})]);let _0x285ef0=0x0;for(const _0x268b84 of _0x1f1b76){const _0x3b2144=await currencyService_1['currencyService'][_0x5b8254(0x1b3)](_0x268b84[_0x5b8254(0x215)],_0x268b84[_0x5b8254(0x207)]);_0x285ef0+=_0x3b2144;}const _0x550bf0=_0x28bc7f>0x0?_0x5cb512/_0x28bc7f*0x64:0x0;return{'totalShops':_0x480622,'activeShops':_0x1c6ddb,'totalPayments':_0x28bc7f,'successfulPayments':_0x5cb512,'totalRevenue':Math[_0x5b8254(0x247)](_0x285ef0*0x64)/0x64,'conversionRate':Math[_0x5b8254(0x247)](_0x550bf0*0x64)/0x64,'recentPayments':_0x1447e7[_0x5b8254(0x212)](_0x40e2b6=>({'id':_0x40e2b6['id'],'amount':_0x40e2b6[_0x5b8254(0x215)],'currency':_0x40e2b6[_0x5b8254(0x207)],'status':_0x40e2b6[_0x5b8254(0x1c6)],'gateway':_0x40e2b6[_0x5b8254(0x21a)],'shop':_0x40e2b6[_0x5b8254(0x26c)],'createdAt':_0x40e2b6['createdAt']}))};}async[a33_0x3ca426(0x265)](_0x3b8ba8){const _0x46a468=a33_0x3ca426;console[_0x46a468(0x1ac)]('üìä\x20Getting\x20merchant\x20statistics\x20with\x20filters:',_0x3b8ba8);let _0x28a0b4,_0x186757=new Date();if(_0x3b8ba8['period']==='custom'&&_0x3b8ba8['dateFrom']&&_0x3b8ba8[_0x46a468(0x243)])_0x28a0b4=new Date(_0x3b8ba8[_0x46a468(0x1be)]),_0x186757=new Date(_0x3b8ba8[_0x46a468(0x243)]);else{const _0xfb73d6=new Date();switch(_0x3b8ba8[_0x46a468(0x1ed)]){case _0x46a468(0x241):_0x28a0b4=new Date(_0xfb73d6[_0x46a468(0x273)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x46a468(0x1b1):_0x28a0b4=new Date(_0xfb73d6[_0x46a468(0x273)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'year':_0x28a0b4=new Date(_0xfb73d6[_0x46a468(0x273)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x46a468(0x242):default:_0x28a0b4=new Date(_0x46a468(0x1fa));break;}}console['log'](_0x46a468(0x210)+_0x28a0b4[_0x46a468(0x26f)]()+_0x46a468(0x1c7)+_0x186757[_0x46a468(0x26f)]());const _0xee5fc1={'status':_0x46a468(0x1ae),'paidAt':{'gte':_0x28a0b4,'lte':_0x186757}};_0x3b8ba8[_0x46a468(0x1dd)]&&(_0xee5fc1[_0x46a468(0x1dd)]=_0x3b8ba8[_0x46a468(0x1dd)]);const _0x24394e=await database_1['default']['payment'][_0x46a468(0x1b8)]({'where':_0xee5fc1,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console['log'](_0x46a468(0x1e1)+_0x24394e[_0x46a468(0x257)]+'\x20paid\x20payments\x20for\x20analysis');let _0x4492e3=0x0,_0x3e8504=0x0,_0x166def=0x0;const _0xaec25d={},_0x1950fa={},_0x27e490={};for(const _0x401a1e of _0x24394e){try{const _0x44e94f=await currencyService_1[_0x46a468(0x1c4)][_0x46a468(0x1b3)](_0x401a1e[_0x46a468(0x215)],_0x401a1e[_0x46a468(0x207)]);let _0x2a099d={};if(_0x401a1e[_0x46a468(0x26c)][_0x46a468(0x1bb)])try{_0x2a099d=JSON[_0x46a468(0x268)](_0x401a1e[_0x46a468(0x26c)]['gatewaySettings']);}catch(_0x556ac0){console[_0x46a468(0x1f1)](_0x46a468(0x209)+_0x401a1e[_0x46a468(0x1dd)]+':',_0x556ac0);}const _0x5f5069=_0x2a099d[_0x46a468(0x1fd)]||0xa,_0x5594aa=_0x44e94f*(_0x5f5069/0x64),_0x36d2e9=_0x44e94f-_0x5594aa;_0x4492e3+=_0x44e94f,_0x3e8504+=_0x36d2e9,_0x166def+=_0x5594aa;!_0xaec25d[_0x401a1e[_0x46a468(0x21a)]]&&(_0xaec25d[_0x401a1e['gateway']]={'gateway':_0x401a1e[_0x46a468(0x21a)],'gatewayDisplayName':this[_0x46a468(0x221)](_0x401a1e[_0x46a468(0x21a)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0xaec25d[_0x401a1e[_0x46a468(0x21a)]][_0x46a468(0x270)]++,_0xaec25d[_0x401a1e[_0x46a468(0x21a)]][_0x46a468(0x1ee)]+=_0x44e94f,_0xaec25d[_0x401a1e[_0x46a468(0x21a)]]['commissionUSDT']+=_0x5594aa,_0xaec25d[_0x401a1e[_0x46a468(0x21a)]][_0x46a468(0x25e)]+=_0x36d2e9,_0xaec25d[_0x401a1e[_0x46a468(0x21a)]][_0x46a468(0x1cc)]+=_0x5f5069;!_0x3b8ba8['shopId']&&(!_0x1950fa[_0x401a1e[_0x46a468(0x1dd)]]&&(_0x1950fa[_0x401a1e['shopId']]={'shopId':_0x401a1e[_0x46a468(0x1dd)],'shopName':_0x401a1e[_0x46a468(0x26c)][_0x46a468(0x1ad)],'shopUsername':_0x401a1e[_0x46a468(0x26c)][_0x46a468(0x266)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x1950fa[_0x401a1e['shopId']][_0x46a468(0x270)]++,_0x1950fa[_0x401a1e[_0x46a468(0x1dd)]][_0x46a468(0x1ee)]+=_0x44e94f,_0x1950fa[_0x401a1e[_0x46a468(0x1dd)]][_0x46a468(0x23d)]+=_0x5594aa,_0x1950fa[_0x401a1e[_0x46a468(0x1dd)]][_0x46a468(0x25e)]+=_0x36d2e9);const _0x1e8f1f=_0x401a1e[_0x46a468(0x249)][_0x46a468(0x26f)]()['split']('T')[0x0];!_0x27e490[_0x1e8f1f]&&(_0x27e490[_0x1e8f1f]={'date':_0x1e8f1f,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x27e490[_0x1e8f1f][_0x46a468(0x1d1)]+=_0x44e94f,_0x27e490[_0x1e8f1f][_0x46a468(0x225)]+=_0x36d2e9,_0x27e490[_0x1e8f1f][_0x46a468(0x24e)]+=_0x5594aa,_0x27e490[_0x1e8f1f]['paymentsCount']++;}catch(_0xc1eaa9){console[_0x46a468(0x1f1)]('Error\x20processing\x20payment\x20'+_0x401a1e['id']+':',_0xc1eaa9);}}Object['values'](_0xaec25d)[_0x46a468(0x1d6)](_0xffbac3=>{const _0x32602c=_0x46a468;_0xffbac3[_0x32602c(0x1f4)]=_0xffbac3[_0x32602c(0x270)]>0x0?_0xffbac3[_0x32602c(0x1cc)]/_0xffbac3[_0x32602c(0x270)]:0x0,delete _0xffbac3[_0x32602c(0x1cc)];}),Object['values'](_0x1950fa)[_0x46a468(0x1d6)](_0x5d9abe=>{const _0x2f4a86=_0x46a468;_0x5d9abe[_0x2f4a86(0x22b)]=_0x5d9abe[_0x2f4a86(0x270)]>0x0?_0x5d9abe[_0x2f4a86(0x1ee)]/_0x5d9abe[_0x2f4a86(0x270)]:0x0;});let _0x2650b6=0x0;if(_0x3b8ba8[_0x46a468(0x1dd)]){const _0x32fa7a=await database_1[_0x46a468(0x1b0)][_0x46a468(0x23a)][_0x46a468(0x1b8)]({'where':{'shopId':_0x3b8ba8['shopId'],'status':'COMPLETED','createdAt':{'gte':_0x28a0b4,'lte':_0x186757}},'select':{'amount':!![]}});_0x2650b6=_0x32fa7a[_0x46a468(0x244)]((_0x1c29aa,_0xa4047)=>_0x1c29aa+_0xa4047['amount'],0x0);}const _0x435d62=_0x24394e[_0x46a468(0x257)],_0x2e32b0=_0x24394e[_0x46a468(0x257)],_0x322bbb=_0x435d62>0x0?_0x4492e3/_0x435d62:0x0,_0x34dca7=0x64,_0xc45a04=Math[_0x46a468(0x21e)]((_0x186757['getTime']()-_0x28a0b4['getTime']())/(0x3e8*0x3c*0x3c*0x18)),_0x30d9e9={'totalTurnover':Math[_0x46a468(0x247)](_0x4492e3*0x64)/0x64,'merchantEarnings':Math[_0x46a468(0x247)](_0x3e8504*0x64)/0x64,'gatewayEarnings':Math[_0x46a468(0x247)](_0x166def*0x64)/0x64,'totalPaidOut':Math[_0x46a468(0x247)](_0x2650b6*0x64)/0x64,'averageCheck':Math[_0x46a468(0x247)](_0x322bbb*0x64)/0x64,'totalPayments':_0x435d62,'successfulPayments':_0x2e32b0,'conversionRate':_0x34dca7,'gatewayBreakdown':Object[_0x46a468(0x254)](_0xaec25d)[_0x46a468(0x212)](_0x29cb93=>({..._0x29cb93,'turnoverUSDT':Math[_0x46a468(0x247)](_0x29cb93[_0x46a468(0x1ee)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x29cb93[_0x46a468(0x23d)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x46a468(0x247)](_0x29cb93['merchantEarningsUSDT']*0x64)/0x64,'averageCommissionRate':Math[_0x46a468(0x247)](_0x29cb93[_0x46a468(0x1f4)]*0x64)/0x64})),'merchantBreakdown':_0x3b8ba8[_0x46a468(0x1dd)]?undefined:Object[_0x46a468(0x254)](_0x1950fa)[_0x46a468(0x212)](_0x196565=>({..._0x196565,'turnoverUSDT':Math[_0x46a468(0x247)](_0x196565['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x46a468(0x247)](_0x196565['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x46a468(0x247)](_0x196565['merchantEarningsUSDT']*0x64)/0x64,'paidOutUSDT':Math['round'](_0x196565[_0x46a468(0x22a)]*0x64)/0x64,'averageCheckUSDT':Math[_0x46a468(0x247)](_0x196565[_0x46a468(0x22b)]*0x64)/0x64})),'dailyData':Object[_0x46a468(0x254)](_0x27e490)[_0x46a468(0x212)](_0x5930b2=>({..._0x5930b2,'turnover':Math[_0x46a468(0x247)](_0x5930b2[_0x46a468(0x1d1)]*0x64)/0x64,'merchantEarnings':Math['round'](_0x5930b2[_0x46a468(0x225)]*0x64)/0x64,'gatewayEarnings':Math[_0x46a468(0x247)](_0x5930b2[_0x46a468(0x24e)]*0x64)/0x64}))['sort']((_0x294942,_0x18fc15)=>_0x294942[_0x46a468(0x211)][_0x46a468(0x24f)](_0x18fc15[_0x46a468(0x211)])),'periodInfo':{'from':_0x28a0b4,'to':_0x186757,'periodType':_0x3b8ba8[_0x46a468(0x1ed)]||_0x46a468(0x239),'daysCount':_0xc45a04}};return console[_0x46a468(0x1ac)](_0x46a468(0x24a)),console['log'](_0x46a468(0x201)+_0x30d9e9['totalTurnover']+'\x20USDT'),console[_0x46a468(0x1ac)](_0x46a468(0x262)+_0x30d9e9[_0x46a468(0x225)]+_0x46a468(0x223)),console[_0x46a468(0x1ac)](_0x46a468(0x253)+_0x30d9e9[_0x46a468(0x24e)]+'\x20USDT'),console[_0x46a468(0x1ac)]('\x20\x20\x20üìä\x20Total\x20payments:\x20'+_0x30d9e9['totalPayments']),_0x30d9e9;}[a33_0x3ca426(0x221)](_0xd25eb6){const _0x310193=a33_0x3ca426,_0x252df4={'plisio':_0x310193(0x1f3),'rapyd':_0x310193(0x23f),'noda':_0x310193(0x1f9),'cointopay':_0x310193(0x234),'klyme_eu':_0x310193(0x236),'klyme_gb':_0x310193(0x1d3),'klyme_de':_0x310193(0x1ea)};return _0x252df4[_0xd25eb6]||_0xd25eb6;}async[a33_0x3ca426(0x23c)](_0x1106c0){const _0x29102b=a33_0x3ca426,{page:_0x3087e1,limit:_0xa924f1,minAmount:_0x1a6e0e,search:_0x1eb53d}=_0x1106c0,_0x5b4371=(_0x3087e1-0x1)*_0xa924f1;console[_0x29102b(0x1ac)]('üìä\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:',_0x1106c0);const _0x3c9dcd=await database_1[_0x29102b(0x1b0)][_0x29102b(0x246)][_0x29102b(0x1b8)]({'where':{'status':_0x29102b(0x1ae),'merchantPaid':![],'paidAt':{'not':null}},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'gatewaySettings':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}});console['log'](_0x29102b(0x1e1)+_0x3c9dcd[_0x29102b(0x257)]+_0x29102b(0x256));const _0x150359={};for(const _0x39568d of _0x3c9dcd){const _0x11aa1f=_0x39568d[_0x29102b(0x1dd)];!_0x150359[_0x11aa1f]&&(_0x150359[_0x11aa1f]={'id':_0x39568d[_0x29102b(0x26c)]['id'],'fullName':_0x39568d['shop'][_0x29102b(0x1ad)],'username':_0x39568d[_0x29102b(0x26c)][_0x29102b(0x266)],'telegramId':_0x39568d['shop'][_0x29102b(0x1fe)],'merchantUrl':_0x39568d[_0x29102b(0x26c)][_0x29102b(0x1c3)],'wallets':{'usdtPolygonWallet':_0x39568d[_0x29102b(0x26c)][_0x29102b(0x1ff)],'usdtTrcWallet':_0x39568d[_0x29102b(0x26c)]['usdtTrcWallet'],'usdtErcWallet':_0x39568d[_0x29102b(0x26c)][_0x29102b(0x1f5)],'usdcPolygonWallet':_0x39568d[_0x29102b(0x26c)][_0x29102b(0x20b)]},'totalAmountUSDT':0x0,'totalAmountAfterCommissionUSDT':0x0,'paymentsCount':0x0,'oldestPaymentDate':_0x39568d[_0x29102b(0x249)],'gatewayBreakdown':{},'gatewaySettings':_0x39568d[_0x29102b(0x26c)]['gatewaySettings']});try{const _0x59065b=await currencyService_1[_0x29102b(0x1c4)][_0x29102b(0x1b3)](_0x39568d[_0x29102b(0x215)],_0x39568d['currency']);let _0x2f4b11={};if(_0x39568d['shop']['gatewaySettings'])try{_0x2f4b11=JSON['parse'](_0x39568d[_0x29102b(0x26c)][_0x29102b(0x1bb)]);}catch(_0x22a90d){console['error'](_0x29102b(0x209)+_0x11aa1f+':',_0x22a90d);}const _0x12e6f6=_0x2f4b11[_0x29102b(0x1fd)]||0xa,_0x22d7bd=_0x59065b*(0x1-_0x12e6f6/0x64);_0x150359[_0x11aa1f][_0x29102b(0x218)]+=_0x59065b,_0x150359[_0x11aa1f][_0x29102b(0x20f)]+=_0x22d7bd,_0x150359[_0x11aa1f][_0x29102b(0x270)]++,_0x39568d[_0x29102b(0x249)]<_0x150359[_0x11aa1f]['oldestPaymentDate']&&(_0x150359[_0x11aa1f][_0x29102b(0x250)]=_0x39568d['paidAt']),!_0x150359[_0x11aa1f]['gatewayBreakdown'][_0x39568d['gateway']]&&(_0x150359[_0x11aa1f][_0x29102b(0x25f)][_0x39568d['gateway']]={'gateway':_0x39568d['gateway'],'count':0x0,'amountUSDT':0x0,'amountAfterCommissionUSDT':0x0,'commission':_0x12e6f6}),_0x150359[_0x11aa1f][_0x29102b(0x25f)][_0x39568d[_0x29102b(0x21a)]]['count']++,_0x150359[_0x11aa1f][_0x29102b(0x25f)][_0x39568d['gateway']][_0x29102b(0x21d)]+=_0x59065b,_0x150359[_0x11aa1f][_0x29102b(0x25f)][_0x39568d[_0x29102b(0x21a)]][_0x29102b(0x275)]+=_0x22d7bd;}catch(_0x45d552){console[_0x29102b(0x1f1)](_0x29102b(0x20e)+_0x39568d['id']+':',_0x45d552);}}let _0x8c9450=Object[_0x29102b(0x254)](_0x150359)[_0x29102b(0x212)](_0x5a0136=>({..._0x5a0136,'totalAmountUSDT':Math['round'](_0x5a0136[_0x29102b(0x218)]*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x29102b(0x247)](_0x5a0136[_0x29102b(0x20f)]*0x64)/0x64,'gatewayBreakdown':Object['values'](_0x5a0136[_0x29102b(0x25f)])[_0x29102b(0x212)](_0x35f665=>({..._0x35f665,'amountUSDT':Math[_0x29102b(0x247)](_0x35f665[_0x29102b(0x21d)]*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x29102b(0x247)](_0x35f665[_0x29102b(0x275)]*0x64)/0x64}))}));_0x1a6e0e&&(_0x8c9450=_0x8c9450['filter'](_0x4379ab=>_0x4379ab[_0x29102b(0x20f)]>=_0x1a6e0e));if(_0x1eb53d){const _0x385c54=_0x1eb53d['toLowerCase']();_0x8c9450=_0x8c9450[_0x29102b(0x1d8)](_0x2f7010=>_0x2f7010[_0x29102b(0x220)][_0x29102b(0x22e)]()[_0x29102b(0x1f6)](_0x385c54)||_0x2f7010[_0x29102b(0x266)][_0x29102b(0x22e)]()[_0x29102b(0x1f6)](_0x385c54));}_0x8c9450[_0x29102b(0x229)]((_0x38a57a,_0x530546)=>_0x530546[_0x29102b(0x20f)]-_0x38a57a['totalAmountAfterCommissionUSDT']);const _0x38812d=_0x8c9450[_0x29102b(0x257)],_0x366d6c=_0x8c9450[_0x29102b(0x1d2)](_0x5b4371,_0x5b4371+_0xa924f1),_0x165943=_0x8c9450[_0x29102b(0x244)]((_0x46291e,_0xbf183a)=>_0x46291e+_0xbf183a[_0x29102b(0x218)],0x0),_0x4c030e=_0x8c9450[_0x29102b(0x244)]((_0x11ef9c,_0x42ee23)=>_0x11ef9c+_0x42ee23['totalAmountAfterCommissionUSDT'],0x0);return console[_0x29102b(0x1ac)]('üìä\x20Merchants\x20awaiting\x20payout:\x20'+_0x38812d+_0x29102b(0x1e7)+Math[_0x29102b(0x247)](_0x4c030e*0x64)/0x64+_0x29102b(0x231)),{'merchants':_0x366d6c,'pagination':{'page':_0x3087e1,'limit':_0xa924f1,'total':_0x38812d,'totalPages':Math[_0x29102b(0x21e)](_0x38812d/_0xa924f1)},'summary':{'totalMerchants':_0x38812d,'totalAmountUSDT':Math['round'](_0x165943*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x29102b(0x247)](_0x4c030e*0x64)/0x64}};}async[a33_0x3ca426(0x230)](_0x290098){const _0x15ddd1=a33_0x3ca426,{shopId:_0x246809,amount:_0x49b068,network:_0x1df455,notes:_0x150de5,periodFrom:_0x5ba3da,periodTo:_0x10a151}=_0x290098,_0x16d8ac=await database_1[_0x15ddd1(0x1b0)][_0x15ddd1(0x26c)]['findUnique']({'where':{'id':_0x246809},'select':{'id':!![],'name':!![],'username':!![]}});if(!_0x16d8ac)throw new Error(_0x15ddd1(0x1e4));const _0x372217=await database_1[_0x15ddd1(0x1b0)][_0x15ddd1(0x23a)][_0x15ddd1(0x1e6)]({'data':{'shopId':_0x246809,'amount':_0x49b068,'network':_0x1df455,'status':_0x15ddd1(0x1bc),'notes':_0x150de5,'periodFrom':_0x5ba3da?new Date(_0x5ba3da):null,'periodTo':_0x10a151?new Date(_0x10a151):null,'createdAt':new Date(),'paidAt':new Date()}});return console[_0x15ddd1(0x1ac)](_0x15ddd1(0x1e9)+_0x372217['id']+_0x15ddd1(0x21c)+_0x16d8ac[_0x15ddd1(0x266)]+'\x20('+_0x49b068+'\x20USDT)'),{'id':_0x372217['id'],'shopId':_0x372217[_0x15ddd1(0x1dd)],'shopName':_0x16d8ac[_0x15ddd1(0x1ad)],'shopUsername':_0x16d8ac['username'],'amount':_0x372217['amount'],'network':_0x372217[_0x15ddd1(0x26e)],'status':_0x372217[_0x15ddd1(0x1c6)],'txid':_0x372217['txid'],'notes':_0x372217['notes'],'periodFrom':_0x372217[_0x15ddd1(0x240)],'periodTo':_0x372217[_0x15ddd1(0x1f2)],'createdAt':_0x372217[_0x15ddd1(0x1d7)],'paidAt':_0x372217['paidAt']};}async[a33_0x3ca426(0x204)](_0x16589d){const _0x4237ef=a33_0x3ca426,{page:_0x33fd5f,limit:_0x4c280a,shopId:_0x4b7ab3,network:_0xd0c4e9,dateFrom:_0x5bcaf3,dateTo:_0x1167c7,search:_0x2fdc89}=_0x16589d,_0x5d61a6=(_0x33fd5f-0x1)*_0x4c280a,_0x4c9cfd={};_0x4b7ab3&&(_0x4c9cfd[_0x4237ef(0x1dd)]=_0x4b7ab3);_0xd0c4e9&&(_0x4c9cfd[_0x4237ef(0x26e)]=_0xd0c4e9);(_0x5bcaf3||_0x1167c7)&&(_0x4c9cfd['createdAt']={},_0x5bcaf3&&(_0x4c9cfd[_0x4237ef(0x1d7)]['gte']=new Date(_0x5bcaf3)),_0x1167c7&&(_0x4c9cfd[_0x4237ef(0x1d7)]['lte']=new Date(_0x1167c7)));_0x2fdc89&&(_0x4c9cfd['OR']=[{'shop':{'name':{'contains':_0x2fdc89,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x2fdc89,'mode':_0x4237ef(0x264)}}},{'notes':{'contains':_0x2fdc89,'mode':_0x4237ef(0x264)}}]);const [_0x3476f6,_0x46f483]=await Promise[_0x4237ef(0x242)]([database_1[_0x4237ef(0x1b0)]['payout'][_0x4237ef(0x1b8)]({'where':_0x4c9cfd,'skip':_0x5d61a6,'take':_0x4c280a,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default']['payout'][_0x4237ef(0x272)]({'where':_0x4c9cfd})]);return{'payouts':_0x3476f6['map'](_0x1511dd=>({'id':_0x1511dd['id'],'shopId':_0x1511dd[_0x4237ef(0x1dd)],'shopName':_0x1511dd['shop']['name'],'shopUsername':_0x1511dd[_0x4237ef(0x26c)][_0x4237ef(0x266)],'amount':_0x1511dd[_0x4237ef(0x215)],'network':_0x1511dd[_0x4237ef(0x26e)],'status':_0x1511dd[_0x4237ef(0x1c6)],'txid':_0x1511dd[_0x4237ef(0x1eb)],'notes':_0x1511dd['notes'],'periodFrom':_0x1511dd[_0x4237ef(0x240)],'periodTo':_0x1511dd[_0x4237ef(0x1f2)],'createdAt':_0x1511dd[_0x4237ef(0x1d7)],'paidAt':_0x1511dd['paidAt']})),'pagination':{'page':_0x33fd5f,'limit':_0x4c280a,'total':_0x46f483,'totalPages':Math[_0x4237ef(0x21e)](_0x46f483/_0x4c280a)}};}async['getPayoutById'](_0x6ce54){const _0x114220=a33_0x3ca426,_0x1d6ce5=await database_1['default'][_0x114220(0x23a)][_0x114220(0x24b)]({'where':{'id':_0x6ce54},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x1d6ce5)return null;return{'id':_0x1d6ce5['id'],'shopId':_0x1d6ce5['shopId'],'shopName':_0x1d6ce5[_0x114220(0x26c)][_0x114220(0x1ad)],'shopUsername':_0x1d6ce5[_0x114220(0x26c)][_0x114220(0x266)],'amount':_0x1d6ce5[_0x114220(0x215)],'network':_0x1d6ce5[_0x114220(0x26e)],'status':_0x1d6ce5[_0x114220(0x1c6)],'txid':_0x1d6ce5[_0x114220(0x1eb)],'notes':_0x1d6ce5[_0x114220(0x1b9)],'periodFrom':_0x1d6ce5[_0x114220(0x240)],'periodTo':_0x1d6ce5[_0x114220(0x1f2)],'createdAt':_0x1d6ce5[_0x114220(0x1d7)],'paidAt':_0x1d6ce5[_0x114220(0x249)]};}async[a33_0x3ca426(0x232)](_0x5274b0){const _0x2a10bc=a33_0x3ca426;await database_1[_0x2a10bc(0x1b0)][_0x2a10bc(0x23a)][_0x2a10bc(0x1c9)]({'where':{'id':_0x5274b0}});}async[a33_0x3ca426(0x1d4)](_0x3c8280){const _0x41a7f0=a33_0x3ca426,{page:_0x9c4e45,limit:_0xb8a0ea,status:_0x44b4df,gateway:_0x584fd5,shopId:_0x22fd29,dateFrom:_0x1c77e8,dateTo:_0x27cb83,search:_0x7d3bf1}=_0x3c8280,_0x1c158e=(_0x9c4e45-0x1)*_0xb8a0ea,_0x235e77={};_0x44b4df&&(_0x235e77[_0x41a7f0(0x1c6)]=_0x44b4df[_0x41a7f0(0x1e5)]());_0x584fd5&&(_0x235e77['gateway']=_0x584fd5['toLowerCase']());_0x22fd29&&(_0x235e77['shopId']=_0x22fd29);(_0x1c77e8||_0x27cb83)&&(_0x235e77[_0x41a7f0(0x1d7)]={},_0x1c77e8&&(_0x235e77[_0x41a7f0(0x1d7)][_0x41a7f0(0x22f)]=new Date(_0x1c77e8)),_0x27cb83&&(_0x235e77[_0x41a7f0(0x1d7)][_0x41a7f0(0x274)]=new Date(_0x27cb83)));_0x7d3bf1&&(_0x235e77['OR']=[{'orderId':{'contains':_0x7d3bf1,'mode':_0x41a7f0(0x264)}},{'gatewayOrderId':{'contains':_0x7d3bf1,'mode':_0x41a7f0(0x264)}},{'customerEmail':{'contains':_0x7d3bf1,'mode':_0x41a7f0(0x264)}},{'shop':{'name':{'contains':_0x7d3bf1,'mode':_0x41a7f0(0x264)}}},{'shop':{'username':{'contains':_0x7d3bf1,'mode':_0x41a7f0(0x264)}}}]);const [_0xec168b,_0x3b828b]=await Promise['all']([database_1[_0x41a7f0(0x1b0)][_0x41a7f0(0x246)][_0x41a7f0(0x1b8)]({'where':_0x235e77,'skip':_0x1c158e,'take':_0xb8a0ea,'orderBy':{'createdAt':_0x41a7f0(0x213)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x41a7f0(0x1b0)][_0x41a7f0(0x246)][_0x41a7f0(0x272)]({'where':_0x235e77})]);return{'payments':_0xec168b[_0x41a7f0(0x212)](_0x436703=>({'id':_0x436703['id'],'shopId':_0x436703['shopId'],'gateway':_0x436703[_0x41a7f0(0x21a)],'amount':_0x436703[_0x41a7f0(0x215)],'currency':_0x436703['currency'],'status':_0x436703[_0x41a7f0(0x1c6)],'orderId':_0x436703[_0x41a7f0(0x269)],'gatewayOrderId':_0x436703[_0x41a7f0(0x26b)],'customerEmail':_0x436703['customerEmail'],'customerName':_0x436703[_0x41a7f0(0x24d)],'customerCountry':_0x436703['customerCountry'],'customerIp':_0x436703[_0x41a7f0(0x205)],'customerUa':_0x436703[_0x41a7f0(0x21f)],'failureMessage':_0x436703['failureMessage'],'createdAt':_0x436703[_0x41a7f0(0x1d7)],'updatedAt':_0x436703[_0x41a7f0(0x255)],'shop':_0x436703[_0x41a7f0(0x26c)]})),'pagination':{'page':_0x9c4e45,'limit':_0xb8a0ea,'total':_0x3b828b,'totalPages':Math['ceil'](_0x3b828b/_0xb8a0ea)}};}async[a33_0x3ca426(0x1e0)](_0xf48179){const _0x4fa420=a33_0x3ca426,_0x3a55a3=await database_1['default'][_0x4fa420(0x246)][_0x4fa420(0x24b)]({'where':{'id':_0xf48179},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x3a55a3)return null;return{'id':_0x3a55a3['id'],'shopId':_0x3a55a3[_0x4fa420(0x1dd)],'gateway':_0x3a55a3['gateway'],'amount':_0x3a55a3[_0x4fa420(0x215)],'currency':_0x3a55a3['currency'],'status':_0x3a55a3['status'],'orderId':_0x3a55a3['orderId'],'gatewayOrderId':_0x3a55a3[_0x4fa420(0x26b)],'customerEmail':_0x3a55a3[_0x4fa420(0x235)],'customerName':_0x3a55a3[_0x4fa420(0x24d)],'customerCountry':_0x3a55a3[_0x4fa420(0x1f0)],'customerIp':_0x3a55a3[_0x4fa420(0x205)],'customerUa':_0x3a55a3[_0x4fa420(0x21f)],'failureMessage':_0x3a55a3[_0x4fa420(0x1f8)],'externalPaymentUrl':_0x3a55a3[_0x4fa420(0x1e3)],'successUrl':_0x3a55a3['successUrl'],'failUrl':_0x3a55a3['failUrl'],'pendingUrl':_0x3a55a3[_0x4fa420(0x20d)],'whiteUrl':_0x3a55a3['whiteUrl'],'createdAt':_0x3a55a3[_0x4fa420(0x1d7)],'updatedAt':_0x3a55a3[_0x4fa420(0x255)],'shop':_0x3a55a3[_0x4fa420(0x26c)]};}async[a33_0x3ca426(0x20a)](_0xa4d791,_0x46513e,_0x3b6add,_0x3e115f){const _0x1716b1=a33_0x3ca426,_0x37a47b={'status':_0x46513e[_0x1716b1(0x1e5)](),'updatedAt':new Date(),'statusChangedBy':_0x1716b1(0x267),'statusChangedAt':new Date()};_0x3b6add&&(_0x37a47b['adminNotes']=_0x3b6add);_0x46513e[_0x1716b1(0x1e5)]()===_0x1716b1(0x248)&&_0x3e115f&&(_0x37a47b[_0x1716b1(0x251)]=_0x3e115f);_0x46513e['toUpperCase']()==='PAID'&&(_0x37a47b[_0x1716b1(0x249)]=new Date());const _0x71715e=await database_1[_0x1716b1(0x1b0)]['payment'][_0x1716b1(0x1cf)]({'where':{'id':_0xa4d791},'data':_0x37a47b,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return{'id':_0x71715e['id'],'shopId':_0x71715e[_0x1716b1(0x1dd)],'gateway':_0x71715e[_0x1716b1(0x21a)],'amount':_0x71715e[_0x1716b1(0x215)],'currency':_0x71715e['currency'],'status':_0x71715e[_0x1716b1(0x1c6)],'orderId':_0x71715e[_0x1716b1(0x269)],'gatewayOrderId':_0x71715e['gatewayOrderId'],'customerEmail':_0x71715e['customerEmail'],'customerName':_0x71715e[_0x1716b1(0x24d)],'customerCountry':_0x71715e[_0x1716b1(0x1f0)],'customerIp':_0x71715e[_0x1716b1(0x205)],'customerUa':_0x71715e[_0x1716b1(0x21f)],'failureMessage':_0x71715e[_0x1716b1(0x1f8)],'adminNotes':_0x71715e[_0x1716b1(0x1e2)],'chargebackAmount':_0x71715e['chargebackAmount'],'statusChangedBy':_0x71715e[_0x1716b1(0x1de)],'statusChangedAt':_0x71715e['statusChangedAt'],'createdAt':_0x71715e[_0x1716b1(0x1d7)],'updatedAt':_0x71715e[_0x1716b1(0x255)],'shop':_0x71715e[_0x1716b1(0x26c)]};}async[a33_0x3ca426(0x263)](_0x312be9,_0xe267d9){const _0x5155aa=a33_0x3ca426,_0x50c034={..._0xe267d9};_0xe267d9[_0x5155aa(0x1c5)]&&(_0x50c034['password']=await bcryptjs_1[_0x5155aa(0x1b0)]['hash'](_0xe267d9[_0x5155aa(0x1c5)],0xc));_0xe267d9[_0x5155aa(0x220)]&&(_0x50c034[_0x5155aa(0x1ad)]=_0xe267d9[_0x5155aa(0x220)],delete _0x50c034[_0x5155aa(0x220)]);_0xe267d9[_0x5155aa(0x277)]&&(_0x50c034['telegram']=_0xe267d9['telegramId'],delete _0x50c034[_0x5155aa(0x277)]);_0xe267d9[_0x5155aa(0x1df)]&&(_0x50c034[_0x5155aa(0x1c3)]=_0xe267d9[_0x5155aa(0x1df)],delete _0x50c034[_0x5155aa(0x1df)]);_0xe267d9[_0x5155aa(0x271)]&&(_0x50c034[_0x5155aa(0x216)]=JSON[_0x5155aa(0x1c1)](_0xe267d9[_0x5155aa(0x271)]),delete _0x50c034[_0x5155aa(0x271)]);_0xe267d9[_0x5155aa(0x1bb)]&&(_0x50c034['gatewaySettings']=JSON[_0x5155aa(0x1c1)](_0xe267d9[_0x5155aa(0x1bb)]),delete _0x50c034[_0x5155aa(0x1bb)]);_0xe267d9['wallets']&&(_0xe267d9['wallets'][_0x5155aa(0x1ff)]!==undefined&&(_0x50c034[_0x5155aa(0x1ff)]=_0xe267d9['wallets'][_0x5155aa(0x1ff)]||null),_0xe267d9[_0x5155aa(0x238)]['usdtTrcWallet']!==undefined&&(_0x50c034[_0x5155aa(0x1db)]=_0xe267d9[_0x5155aa(0x238)][_0x5155aa(0x1db)]||null),_0xe267d9[_0x5155aa(0x238)][_0x5155aa(0x1f5)]!==undefined&&(_0x50c034[_0x5155aa(0x1f5)]=_0xe267d9[_0x5155aa(0x238)][_0x5155aa(0x1f5)]||null),_0xe267d9[_0x5155aa(0x238)]['usdcPolygonWallet']!==undefined&&(_0x50c034['usdcPolygonWallet']=_0xe267d9[_0x5155aa(0x238)][_0x5155aa(0x20b)]||null),delete _0x50c034['wallets']);const _0x326b55=await database_1[_0x5155aa(0x1b0)]['shop']['update']({'where':{'id':_0x312be9},'data':_0x50c034,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x326b55['id'],'fullName':_0x326b55[_0x5155aa(0x1ad)],'username':_0x326b55[_0x5155aa(0x266)],'telegramId':_0x326b55['telegram'],'merchantUrl':_0x326b55[_0x5155aa(0x1c3)],'gateways':_0x326b55[_0x5155aa(0x216)]?JSON[_0x5155aa(0x268)](_0x326b55['paymentGateways']):null,'gatewaySettings':_0x326b55[_0x5155aa(0x1bb)]?JSON['parse'](_0x326b55[_0x5155aa(0x1bb)]):null,'publicKey':_0x326b55[_0x5155aa(0x202)],'wallets':{'usdtPolygonWallet':_0x326b55[_0x5155aa(0x1ff)],'usdtTrcWallet':_0x326b55['usdtTrcWallet'],'usdtErcWallet':_0x326b55[_0x5155aa(0x1f5)],'usdcPolygonWallet':_0x326b55[_0x5155aa(0x20b)]},'status':_0x326b55[_0x5155aa(0x1c6)],'createdAt':_0x326b55[_0x5155aa(0x1d7)]};}async[a33_0x3ca426(0x22c)](_0x44d703){const _0x2663c2=a33_0x3ca426,_0x108ee4=await database_1[_0x2663c2(0x1b0)][_0x2663c2(0x26c)][_0x2663c2(0x1cf)]({'where':{'id':_0x44d703},'data':{'status':_0x2663c2(0x1f7)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x108ee4['id'],'fullName':_0x108ee4['name'],'username':_0x108ee4['username'],'telegramId':_0x108ee4['telegram'],'merchantUrl':_0x108ee4['shopUrl'],'gateways':_0x108ee4[_0x2663c2(0x216)]?JSON[_0x2663c2(0x268)](_0x108ee4[_0x2663c2(0x216)]):null,'gatewaySettings':_0x108ee4[_0x2663c2(0x1bb)]?JSON[_0x2663c2(0x268)](_0x108ee4['gatewaySettings']):null,'publicKey':_0x108ee4[_0x2663c2(0x202)],'wallets':{'usdtPolygonWallet':_0x108ee4['usdtPolygonWallet'],'usdtTrcWallet':_0x108ee4[_0x2663c2(0x1db)],'usdtErcWallet':_0x108ee4[_0x2663c2(0x1f5)],'usdcPolygonWallet':_0x108ee4['usdcPolygonWallet']},'status':_0x108ee4[_0x2663c2(0x1c6)],'createdAt':_0x108ee4[_0x2663c2(0x1d7)]};}async['activateUser'](_0x42d467){const _0x370b1e=a33_0x3ca426,_0x3d875b=await database_1['default'][_0x370b1e(0x26c)][_0x370b1e(0x1cf)]({'where':{'id':_0x42d467},'data':{'status':_0x370b1e(0x25c)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x3d875b['id'],'fullName':_0x3d875b['name'],'username':_0x3d875b[_0x370b1e(0x266)],'telegramId':_0x3d875b[_0x370b1e(0x1fe)],'merchantUrl':_0x3d875b[_0x370b1e(0x1c3)],'gateways':_0x3d875b[_0x370b1e(0x216)]?JSON[_0x370b1e(0x268)](_0x3d875b[_0x370b1e(0x216)]):null,'gatewaySettings':_0x3d875b[_0x370b1e(0x1bb)]?JSON['parse'](_0x3d875b[_0x370b1e(0x1bb)]):null,'publicKey':_0x3d875b['publicKey'],'wallets':{'usdtPolygonWallet':_0x3d875b[_0x370b1e(0x1ff)],'usdtTrcWallet':_0x3d875b['usdtTrcWallet'],'usdtErcWallet':_0x3d875b['usdtErcWallet'],'usdcPolygonWallet':_0x3d875b['usdcPolygonWallet']},'status':_0x3d875b[_0x370b1e(0x1c6)],'createdAt':_0x3d875b['createdAt']};}async[a33_0x3ca426(0x259)](_0x4bc19a){const _0x59ce78=a33_0x3ca426,{page:_0x25bea8,limit:_0x517788,status:_0x63f35}=_0x4bc19a,_0x9eaafe=(_0x25bea8-0x1)*_0x517788,_0x1cfa9c={};_0x63f35&&(_0x1cfa9c[_0x59ce78(0x1c6)]=_0x63f35[_0x59ce78(0x1e5)]());const [_0x83a8ca,_0x43195c]=await Promise[_0x59ce78(0x242)]([database_1[_0x59ce78(0x1b0)][_0x59ce78(0x26c)][_0x59ce78(0x1b8)]({'where':_0x1cfa9c,'skip':_0x9eaafe,'take':_0x517788,'orderBy':{'createdAt':_0x59ce78(0x213)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x59ce78(0x1b0)]['shop'][_0x59ce78(0x272)]({'where':_0x1cfa9c})]);return{'users':_0x83a8ca[_0x59ce78(0x212)](_0x4f259b=>({'id':_0x4f259b['id'],'fullName':_0x4f259b[_0x59ce78(0x1ad)],'username':_0x4f259b[_0x59ce78(0x266)],'telegramId':_0x4f259b[_0x59ce78(0x1fe)],'merchantUrl':_0x4f259b[_0x59ce78(0x1c3)],'gateways':_0x4f259b[_0x59ce78(0x216)]?JSON[_0x59ce78(0x268)](_0x4f259b[_0x59ce78(0x216)]):null,'gatewaySettings':_0x4f259b[_0x59ce78(0x1bb)]?JSON[_0x59ce78(0x268)](_0x4f259b['gatewaySettings']):null,'publicKey':_0x4f259b['publicKey'],'wallets':{'usdtPolygonWallet':_0x4f259b[_0x59ce78(0x1ff)],'usdtTrcWallet':_0x4f259b[_0x59ce78(0x1db)],'usdtErcWallet':_0x4f259b['usdtErcWallet'],'usdcPolygonWallet':_0x4f259b['usdcPolygonWallet']},'status':_0x4f259b[_0x59ce78(0x1c6)],'createdAt':_0x4f259b[_0x59ce78(0x1d7)]})),'pagination':{'page':_0x25bea8,'limit':_0x517788,'total':_0x43195c,'totalPages':Math[_0x59ce78(0x21e)](_0x43195c/_0x517788)}};}async[a33_0x3ca426(0x206)](_0x2b5392){const _0x2651b3=a33_0x3ca426,_0x4d0b6c=await database_1[_0x2651b3(0x1b0)][_0x2651b3(0x26c)]['findUnique']({'where':{'id':_0x2b5392},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x4d0b6c)return null;return{'id':_0x4d0b6c['id'],'fullName':_0x4d0b6c[_0x2651b3(0x1ad)],'username':_0x4d0b6c[_0x2651b3(0x266)],'telegramId':_0x4d0b6c['telegram'],'merchantUrl':_0x4d0b6c['shopUrl'],'gateways':_0x4d0b6c[_0x2651b3(0x216)]?JSON[_0x2651b3(0x268)](_0x4d0b6c[_0x2651b3(0x216)]):null,'gatewaySettings':_0x4d0b6c[_0x2651b3(0x1bb)]?JSON['parse'](_0x4d0b6c[_0x2651b3(0x1bb)]):null,'publicKey':_0x4d0b6c[_0x2651b3(0x202)],'wallets':{'usdtPolygonWallet':_0x4d0b6c['usdtPolygonWallet'],'usdtTrcWallet':_0x4d0b6c[_0x2651b3(0x1db)],'usdtErcWallet':_0x4d0b6c[_0x2651b3(0x1f5)],'usdcPolygonWallet':_0x4d0b6c[_0x2651b3(0x20b)]},'status':_0x4d0b6c['status'],'createdAt':_0x4d0b6c[_0x2651b3(0x1d7)]};}async[a33_0x3ca426(0x200)](_0xc01840){const _0xbec1e0=a33_0x3ca426,{fullName:_0x82fb31,username:_0x4944b9,password:_0x3a97fa,telegramId:_0x184235,merchantUrl:_0x1946ce,gateways:_0x255133,gatewaySettings:_0x41b10b,wallets:_0x530b0f}=_0xc01840,_0x5a9874=await database_1[_0xbec1e0(0x1b0)]['shop'][_0xbec1e0(0x24b)]({'where':{'username':_0x4944b9}});if(_0x5a9874)throw new Error('Username\x20already\x20exists');if(_0x184235){const _0x22bac0=await database_1[_0xbec1e0(0x1b0)][_0xbec1e0(0x26c)]['findUnique']({'where':{'telegram':_0x184235}});if(_0x22bac0)throw new Error('Telegram\x20username\x20already\x20exists');}const _0x48f614=await bcryptjs_1[_0xbec1e0(0x1b0)][_0xbec1e0(0x26a)](_0x3a97fa,0xc),_0x2e2357=_0xbec1e0(0x25b)+crypto_1[_0xbec1e0(0x1b0)][_0xbec1e0(0x1c0)](0x20)[_0xbec1e0(0x1b6)]('hex'),_0xe1cef=_0xbec1e0(0x227)+crypto_1[_0xbec1e0(0x1b0)][_0xbec1e0(0x1c0)](0x20)['toString'](_0xbec1e0(0x1da)),_0x4cf10f=await database_1['default']['shop'][_0xbec1e0(0x1e6)]({'data':{'name':_0x82fb31,'username':_0x4944b9,'password':_0x48f614,'telegram':_0x184235,'shopUrl':_0x1946ce,'paymentGateways':_0x255133?JSON[_0xbec1e0(0x1c1)](_0x255133):null,'gatewaySettings':_0x41b10b?JSON['stringify'](_0x41b10b):null,'usdtPolygonWallet':_0x530b0f?.[_0xbec1e0(0x1ff)]||null,'usdtTrcWallet':_0x530b0f?.['usdtTrcWallet']||null,'usdtErcWallet':_0x530b0f?.[_0xbec1e0(0x1f5)]||null,'usdcPolygonWallet':_0x530b0f?.['usdcPolygonWallet']||null,'publicKey':_0x2e2357,'secretKey':_0xe1cef,'status':_0xbec1e0(0x25c)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4cf10f['id'],'fullName':_0x4cf10f[_0xbec1e0(0x1ad)],'username':_0x4cf10f[_0xbec1e0(0x266)],'telegramId':_0x4cf10f[_0xbec1e0(0x1fe)],'merchantUrl':_0x4cf10f[_0xbec1e0(0x1c3)],'gateways':_0x4cf10f['paymentGateways']?JSON[_0xbec1e0(0x268)](_0x4cf10f[_0xbec1e0(0x216)]):null,'gatewaySettings':_0x4cf10f[_0xbec1e0(0x1bb)]?JSON[_0xbec1e0(0x268)](_0x4cf10f[_0xbec1e0(0x1bb)]):null,'publicKey':_0x4cf10f['publicKey'],'wallets':{'usdtPolygonWallet':_0x4cf10f[_0xbec1e0(0x1ff)],'usdtTrcWallet':_0x4cf10f['usdtTrcWallet'],'usdtErcWallet':_0x4cf10f['usdtErcWallet'],'usdcPolygonWallet':_0x4cf10f[_0xbec1e0(0x20b)]},'status':_0x4cf10f[_0xbec1e0(0x1c6)],'createdAt':_0x4cf10f[_0xbec1e0(0x1d7)]};}async[a33_0x3ca426(0x24c)](_0x3250b3){const _0x1ee875=a33_0x3ca426;await database_1[_0x1ee875(0x1b0)]['shop'][_0x1ee875(0x1c9)]({'where':{'id':_0x3250b3}});}}exports[a33_0x3ca426(0x21b)]=AdminService;