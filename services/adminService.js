'use strict';const a33_0x530c5f=a33_0x14d9;(function(_0x62ba08,_0x34a953){const _0xd21d94=a33_0x14d9,_0x19b334=_0x62ba08();while(!![]){try{const _0x320183=-parseInt(_0xd21d94(0x162))/0x1*(parseInt(_0xd21d94(0x1e4))/0x2)+parseInt(_0xd21d94(0x1cb))/0x3*(parseInt(_0xd21d94(0x187))/0x4)+parseInt(_0xd21d94(0x1a2))/0x5+parseInt(_0xd21d94(0x1b1))/0x6*(-parseInt(_0xd21d94(0x19d))/0x7)+parseInt(_0xd21d94(0x1d7))/0x8+-parseInt(_0xd21d94(0x194))/0x9+parseInt(_0xd21d94(0x17a))/0xa*(-parseInt(_0xd21d94(0x205))/0xb);if(_0x320183===_0x34a953)break;else _0x19b334['push'](_0x19b334['shift']());}catch(_0x502a44){_0x19b334['push'](_0x19b334['shift']());}}}(a33_0x3641,0xa1be8));function a33_0x3641(){const _0x564b0b=['shop','üìã\x20Getting\x20payouts\x20with\x20filters:','toLowerCase','remitterName','setDate','updateUser','‚úÖ\x20Payout\x20created\x20successfully:\x20','‚úÖ\x20Payout\x20statistics\x20calculated:','paidAt','‚ùå\x20Payout\x20not\x20found:\x20','map','../types/gateway','totalAmountAfterCommissionUSDT','\x20USDT','charAt','User\x20is\x20already\x20suspended','amountAfterCommissionUSDT','üí∞\x20Total\x20amount:\x20','üìà\x20Average\x20payment:\x20','isValidGatewayId','üí∏\x20Chargeback\x20amount:\x20','customerName','üîç\x20Getting\x20payout\x20by\x20ID:\x20','desc','admin','payout','currencyService','getTime','log','‚è≥\x20Awaiting\x20Payout:\x20','payoutDelay','‚úÖ\x20Found\x20payment:\x20','\x20status\x20to:\x20','Error\x20parsing\x20gateway\x20settings:','\x20USDT\x20after\x20commission)','\x20payments\x20for\x20revenue\x20calculation\x20(PAID/REFUND/CHARGEBACK)','\x20total','\x20merchants\x20with\x20eligible\x20PAID\x20payments','createUser','deleteUser','111465BmyshP','generateDateRange','\x20users\x20out\x20of\x20','Failed\x20to\x20send\x20Telegram\x20payout\x20notification:','convertToUSDT','publicKey',',\x20amount:\x20','toISOString','asc','\x20days)','round','completed','shopId','awaitingPayout','remitterIban','shopUrl','paymentMethod','userService','FAILED','count','get','üìä\x20Daily\x20revenue\x20entries:\x20','lte','totalPayout','163550MLOlpj','üìã\x20Getting\x20users\x20with\x20filters:','parse','calculateAmountAfterCommission','has','üí∞\x20Found\x20','gatewayPaymentId','./telegramBotService','from','toUpperCase','customerEmail','üîç\x20Getting\x20payment\x20by\x20ID:\x20','abs','1318652syjpzk','üí∏\x20Total\x20Payout:\x20','expiresAt','__esModule','createPayout','findUnique','Chargeback\x20amount\x20is\x20required\x20and\x20must\x20be\x20positive\x20(amount\x20in\x20USDT)','amountUSDT','telegramBotService','getDate','\x20to\x20','getGatewayNameById','updateMany','7245162itwUBA','Shop\x20not\x20found','stringify','üìä\x20Calculating\x20admin\x20payout\x20statistics...','cardLast4','markPaymentsAsPaidOut','UserService','__importDefault','getAllPayments','22036eIISGj','\x20payments\x20out\x20of\x20','merchantPaid','üí∞\x20Available\x20Balance:\x20','findMany','5720030CBmZLt','getGatewaySettings','split','üö´\x20Suspending\x20user:\x20','\x20USDT\x20(—Ç–æ–ª—å–∫–æ\x20PAID\x20–ø–ª–∞—Ç–µ–∂–∏)','currency','üìÖ\x20This\x20Month:\x20','getPaymentById','User\x20not\x20found','suspendUser','PAID','username','toFixed','default','‚úÖ\x20Marked\x20','2232OPtUKm','sourceCurrency','getUserById','deletePayout','totalAmountUSDT','notes','usage','orderId','\x20suspended\x20successfully','\x20eligible\x20PAID\x20payments\x20for\x20payout\x20analysis','sort','\x20USDT\x20(–≤–∫–ª—é—á–∞—è\x20—à—Ç—Ä–∞—Ñ—ã\x20chargeback)','$queryRaw','payments','\x20payments\x20for\x20analysis\x20(PAID/REFUND/CHARGEBACK)','usdtErcWallet','slice','all','EXPIRED','create','üìã\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','‚úÖ\x20Admin\x20statistics\x20generated\x20successfully','reduce','externalPaymentUrl','‚úÖ\x20Found\x20payout:\x20','gte','9wNJPhC','üîÑ\x20Admin\x20updating\x20payment\x20','‚úÖ\x20User\x20','\x20USDT\x20(will\x20be\x20deducted\x20from\x20merchant\x20balance)','join','getPayoutById','‚úÖ\x20Activating\x20user:\x20','amount','üè™\x20Found\x20','getPeriodDays','SUSPENDED','gateway','6113944DcRikz','ACTIVE','network','calculateEffectiveAmount','‚ùå\x20Payment\x20not\x20found:\x20','‚úÖ\x20Payout\x20','REFUND','getAllPayouts','paymentGateways','date','getFullYear','commission','üìã\x20Getting\x20payments\x20with\x20filters:','2pfOOWN','./currencyService','isEligibleForPayout','bankId','includes','length','insensitive','push','ceil','90d','usdtPolygonWallet','gatewaySettings','gatewayOrderId','error','\x20USDT\x20via\x20','entries','status','chargebackAmount','statusChangedAt','\x20deleted\x20successfully','usdcPolygonWallet','AdminService','30d','CHARGEBACK','telegram','üí∏\x20Chargeback\x20penalty:\x20','createdAt','getAllUsers','payment','statusChangedBy','adminNotes','üîÑ\x20Marking\x20payments\x20as\x20paid\x20out\x20for\x20shop\x20','\x20status\x20updated\x20from\x20','99MbSlFK','set','Shop\x20is\x20not\x20active','updatedAt','name','getMonth','üóëÔ∏è\x20Deleting\x20payout:\x20','getMerchantsAwaitingPayout','üìä\x20Generating\x20admin\x20statistics\x20for\x20period:\x20','COMPLETED','üìä\x20Found\x20','txid'];a33_0x3641=function(){return _0x564b0b;};return a33_0x3641();}var __importDefault=this&&this[a33_0x530c5f(0x19b)]||function(_0x85d4a5){return _0x85d4a5&&_0x85d4a5['__esModule']?_0x85d4a5:{'default':_0x85d4a5};};function a33_0x14d9(_0x99ac85,_0x95bee5){const _0x3641d8=a33_0x3641();return a33_0x14d9=function(_0x14d92b,_0x14b14e){_0x14d92b=_0x14d92b-0x133;let _0x45f7e2=_0x3641d8[_0x14d92b];return _0x45f7e2;},a33_0x14d9(_0x99ac85,_0x95bee5);}Object['defineProperty'](exports,a33_0x530c5f(0x18a),{'value':!![]}),exports[a33_0x530c5f(0x1f9)]=void 0x0;const database_1=__importDefault(require('../config/database')),currencyService_1=require(a33_0x530c5f(0x1e5)),userService_1=require('./userService'),telegramBotService_1=require(a33_0x530c5f(0x181)),gateway_1=require(a33_0x530c5f(0x145));class AdminService{constructor(){const _0x6c02bb=a33_0x530c5f;this[_0x6c02bb(0x173)]=new userService_1[(_0x6c02bb(0x19a))]();}[a33_0x530c5f(0x1d4)](_0x350125){const _0xc7c156=a33_0x530c5f;switch(_0x350125){case'7d':return 0x7;case _0xc7c156(0x1fa):return 0x1e;case _0xc7c156(0x1ed):return 0x5a;case'1y':return 0x16d;default:return 0x1e;}}[a33_0x530c5f(0x163)](_0x4cd7f0,_0x24b2a6){const _0x96b739=a33_0x530c5f,_0x581445=[],_0x1b4aaa=new Date(_0x4cd7f0);while(_0x1b4aaa<=_0x24b2a6){_0x581445[_0x96b739(0x1eb)](_0x1b4aaa[_0x96b739(0x169)]()[_0x96b739(0x1a4)]('T')[0x0]),_0x1b4aaa[_0x96b739(0x13e)](_0x1b4aaa[_0x96b739(0x190)]()+0x1);}return _0x581445;}['getGatewaySettings'](_0x52e880,_0x11ae0e){const _0x2b1801=a33_0x530c5f;if(!_0x52e880['gatewaySettings'])return{'commission':0x0,'payoutDelay':0x0};try{const _0x1c0376=JSON[_0x2b1801(0x17c)](_0x52e880['gatewaySettings']),_0x5c7d63=_0x11ae0e[_0x2b1801(0x148)](0x0)[_0x2b1801(0x183)]()+_0x11ae0e[_0x2b1801(0x1c1)](0x1)['toLowerCase']();if(_0x1c0376&&_0x1c0376[_0x5c7d63])return{'commission':_0x1c0376[_0x5c7d63][_0x2b1801(0x1e2)]||0x0,'payoutDelay':_0x1c0376[_0x5c7d63][_0x2b1801(0x158)]||0x0};}catch(_0x4c093b){console[_0x2b1801(0x1f1)](_0x2b1801(0x15b),_0x4c093b);}return{'commission':0x0,'payoutDelay':0x0};}['isEligibleForPayout'](_0x1a5d92){const _0xec4694=a33_0x530c5f;if(_0x1a5d92[_0xec4694(0x1f4)]!==_0xec4694(0x1ac)||_0x1a5d92[_0xec4694(0x19f)]||!_0x1a5d92[_0xec4694(0x142)])return![];const _0x273c70=this[_0xec4694(0x1a3)](_0x1a5d92[_0xec4694(0x13a)],_0x1a5d92[_0xec4694(0x1d6)]),_0x86d241=_0x273c70[_0xec4694(0x158)]*0x18*0x3c*0x3c*0x3e8,_0x47ad53=new Date(_0x1a5d92[_0xec4694(0x142)][_0xec4694(0x155)]()+_0x86d241);return new Date()>_0x47ad53;}[a33_0x530c5f(0x17d)](_0x400679,_0x1f4e55){return _0x400679*(0x1-_0x1f4e55/0x64);}[a33_0x530c5f(0x1da)](_0x55161a){const _0x1548e3=a33_0x530c5f;switch(_0x55161a['status']){case _0x1548e3(0x1ac):return _0x55161a[_0x1548e3(0x1d2)];case'CHARGEBACK':return-(_0x55161a['chargebackAmount']||0x0);case _0x1548e3(0x1dd):return 0x0;default:return 0x0;}}async[a33_0x530c5f(0x18b)](_0xcbad9c){const _0xc74869=a33_0x530c5f,{shopId:_0x2aa8d5,amount:_0x2f393d,network:_0x9d4c46,notes:_0x58b082}=_0xcbad9c;console[_0xc74869(0x156)]('üí∏\x20Creating\x20payout\x20for\x20shop\x20'+_0x2aa8d5+':\x20'+_0x2f393d+_0xc74869(0x1f2)+_0x9d4c46);const _0x479c42=await database_1[_0xc74869(0x1af)][_0xc74869(0x13a)][_0xc74869(0x18c)]({'where':{'id':_0x2aa8d5},'select':{'id':!![],'name':!![],'username':!![],'status':!![]}});if(!_0x479c42)throw new Error(_0xc74869(0x195));if(_0x479c42[_0xc74869(0x1f4)]!==_0xc74869(0x1d8))throw new Error(_0xc74869(0x207));const _0x58b935=await database_1[_0xc74869(0x1af)][_0xc74869(0x153)]['create']({'data':{'shopId':_0x2aa8d5,'amount':_0x2f393d,'network':_0x9d4c46,'status':_0xc74869(0x137),'notes':_0x58b082||null,'paidAt':new Date()},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});await this[_0xc74869(0x199)](_0x2aa8d5,_0x2f393d);try{await telegramBotService_1[_0xc74869(0x18f)]['sendPayoutNotification'](_0x2aa8d5,_0x58b935,_0xc74869(0x16d));}catch(_0x1ccd8f){console[_0xc74869(0x1f1)](_0xc74869(0x165),_0x1ccd8f);}return console[_0xc74869(0x156)](_0xc74869(0x140)+_0x58b935['id']),{'id':_0x58b935['id'],'shopId':_0x58b935[_0xc74869(0x16e)],'shopName':_0x58b935[_0xc74869(0x13a)][_0xc74869(0x209)],'shopUsername':_0x58b935[_0xc74869(0x13a)][_0xc74869(0x1ad)],'amount':_0x58b935[_0xc74869(0x1d2)],'network':_0x58b935[_0xc74869(0x1d9)],'status':_0x58b935['status'],'txid':_0x58b935[_0xc74869(0x139)],'notes':_0x58b935['notes'],'createdAt':_0x58b935[_0xc74869(0x1fe)],'paidAt':_0x58b935[_0xc74869(0x142)]};}async[a33_0x530c5f(0x199)](_0x49b428,_0x5672f9){const _0x1fc617=a33_0x530c5f;console[_0x1fc617(0x156)](_0x1fc617(0x203)+_0x49b428+_0x1fc617(0x168)+_0x5672f9+_0x1fc617(0x147));const _0x486319=await database_1['default'][_0x1fc617(0x200)][_0x1fc617(0x1a1)]({'where':{'shopId':_0x49b428,'status':_0x1fc617(0x1ac),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'shop':{'select':{'gatewaySettings':!![]}}},'orderBy':{'paidAt':_0x1fc617(0x16a)}});let _0x2c70b6=_0x5672f9;const _0x18441a=[];for(const _0x566613 of _0x486319){const _0x3dc8a4={..._0x566613,'status':_0x1fc617(0x1ac),'merchantPaid':![],'shop':{'gatewaySettings':_0x566613[_0x1fc617(0x13a)]['gatewaySettings']}};if(!this[_0x1fc617(0x1e6)](_0x3dc8a4))continue;const _0x4638c3=await currencyService_1[_0x1fc617(0x154)][_0x1fc617(0x166)](_0x566613[_0x1fc617(0x1d2)],_0x566613[_0x1fc617(0x1a7)]),_0x436109=this[_0x1fc617(0x1a3)](_0x566613[_0x1fc617(0x13a)],_0x566613[_0x1fc617(0x1d6)]),_0x3cf8ed=this[_0x1fc617(0x17d)](_0x4638c3,_0x436109['commission']);if(_0x3cf8ed<=_0x2c70b6){_0x18441a[_0x1fc617(0x1eb)](_0x566613['id']),_0x2c70b6-=_0x3cf8ed;if(_0x2c70b6<=0.01)break;}}_0x18441a[_0x1fc617(0x1e9)]>0x0&&(await database_1['default'][_0x1fc617(0x200)][_0x1fc617(0x193)]({'where':{'id':{'in':_0x18441a}},'data':{'merchantPaid':!![]}}),console['log'](_0x1fc617(0x1b0)+_0x18441a[_0x1fc617(0x1e9)]+'\x20payments\x20as\x20paid\x20out'));}async[a33_0x530c5f(0x1de)](_0x57a8b8){const _0xadb2c1=a33_0x530c5f,{page:_0x3d3cca,limit:_0x2f0d4e,shopId:_0x563b10,network:_0x14fbb8,dateFrom:_0x89ddf3,dateTo:_0x166c26,search:_0x21165d}=_0x57a8b8,_0x3df94a=(_0x3d3cca-0x1)*_0x2f0d4e;console[_0xadb2c1(0x156)](_0xadb2c1(0x13b),_0x57a8b8);const _0x1c7a22={};_0x563b10&&(_0x1c7a22['shopId']=_0x563b10);_0x14fbb8&&(_0x1c7a22[_0xadb2c1(0x1d9)]=_0x14fbb8);(_0x89ddf3||_0x166c26)&&(_0x1c7a22[_0xadb2c1(0x1fe)]={},_0x89ddf3&&(_0x1c7a22[_0xadb2c1(0x1fe)][_0xadb2c1(0x1ca)]=new Date(_0x89ddf3)),_0x166c26&&(_0x1c7a22['createdAt'][_0xadb2c1(0x178)]=new Date(_0x166c26)));_0x21165d&&(_0x1c7a22['OR']=[{'txid':{'contains':_0x21165d,'mode':_0xadb2c1(0x1ea)}},{'notes':{'contains':_0x21165d,'mode':_0xadb2c1(0x1ea)}},{'shop':{'name':{'contains':_0x21165d,'mode':_0xadb2c1(0x1ea)}}},{'shop':{'username':{'contains':_0x21165d,'mode':_0xadb2c1(0x1ea)}}}]);const [_0xb7c5e6,_0x3abce9]=await Promise[_0xadb2c1(0x1c2)]([database_1[_0xadb2c1(0x1af)][_0xadb2c1(0x153)][_0xadb2c1(0x1a1)]({'where':_0x1c7a22,'skip':_0x3df94a,'take':_0x2f0d4e,'orderBy':{'createdAt':_0xadb2c1(0x151)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0xadb2c1(0x153)][_0xadb2c1(0x175)]({'where':_0x1c7a22})]);console[_0xadb2c1(0x156)](_0xadb2c1(0x138)+_0xb7c5e6[_0xadb2c1(0x1e9)]+'\x20payouts\x20out\x20of\x20'+_0x3abce9+_0xadb2c1(0x15e));const _0xff894e=_0xb7c5e6[_0xadb2c1(0x144)](_0x3ea555=>({'id':_0x3ea555['id'],'shopId':_0x3ea555[_0xadb2c1(0x16e)],'shopName':_0x3ea555[_0xadb2c1(0x13a)]['name'],'shopUsername':_0x3ea555[_0xadb2c1(0x13a)][_0xadb2c1(0x1ad)],'amount':_0x3ea555[_0xadb2c1(0x1d2)],'network':_0x3ea555[_0xadb2c1(0x1d9)],'status':_0x3ea555[_0xadb2c1(0x1f4)],'txid':_0x3ea555[_0xadb2c1(0x139)],'notes':_0x3ea555[_0xadb2c1(0x1b6)],'createdAt':_0x3ea555[_0xadb2c1(0x1fe)],'paidAt':_0x3ea555[_0xadb2c1(0x142)]}));return{'payouts':_0xff894e,'pagination':{'page':_0x3d3cca,'limit':_0x2f0d4e,'total':_0x3abce9,'totalPages':Math[_0xadb2c1(0x1ec)](_0x3abce9/_0x2f0d4e)}};}async[a33_0x530c5f(0x1d0)](_0x479f65){const _0xe24be5=a33_0x530c5f;console[_0xe24be5(0x156)](_0xe24be5(0x150)+_0x479f65);const _0x264b4b=await database_1[_0xe24be5(0x1af)][_0xe24be5(0x153)][_0xe24be5(0x18c)]({'where':{'id':_0x479f65},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x264b4b)return console[_0xe24be5(0x156)](_0xe24be5(0x143)+_0x479f65),null;return console[_0xe24be5(0x156)](_0xe24be5(0x1c9)+_0x264b4b['amount']+_0xe24be5(0x1f2)+_0x264b4b[_0xe24be5(0x1d9)]),{'id':_0x264b4b['id'],'shopId':_0x264b4b[_0xe24be5(0x16e)],'shopName':_0x264b4b['shop']['name'],'shopUsername':_0x264b4b[_0xe24be5(0x13a)][_0xe24be5(0x1ad)],'amount':_0x264b4b[_0xe24be5(0x1d2)],'network':_0x264b4b['network'],'status':_0x264b4b[_0xe24be5(0x1f4)],'txid':_0x264b4b[_0xe24be5(0x139)],'notes':_0x264b4b[_0xe24be5(0x1b6)],'createdAt':_0x264b4b[_0xe24be5(0x1fe)],'paidAt':_0x264b4b[_0xe24be5(0x142)]};}async[a33_0x530c5f(0x1b4)](_0x48e191){const _0x234734=a33_0x530c5f;console['log'](_0x234734(0x134)+_0x48e191);const _0x19c309=await database_1['default'][_0x234734(0x153)][_0x234734(0x18c)]({'where':{'id':_0x48e191},'select':{'id':!![],'shopId':!![],'amount':!![]}});if(!_0x19c309)throw new Error('Payout\x20not\x20found');await database_1[_0x234734(0x1af)]['payout']['delete']({'where':{'id':_0x48e191}}),console['log'](_0x234734(0x1dc)+_0x48e191+_0x234734(0x1f7));}async[a33_0x530c5f(0x135)](_0x2b789c){const _0x36050b=a33_0x530c5f,{page:_0x13da9c,limit:_0x4ef72c,minAmount:_0x2ef962,search:_0x24afca}=_0x2b789c;console[_0x36050b(0x156)](_0x36050b(0x1c5),_0x2b789c);const _0xe118ae=await database_1[_0x36050b(0x1af)][_0x36050b(0x200)][_0x36050b(0x1a1)]({'where':{'status':_0x36050b(0x1ac),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'createdAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'gatewaySettings':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}});console[_0x36050b(0x156)](_0x36050b(0x17f)+_0xe118ae['length']+_0x36050b(0x1ba));const _0x459f83=new Map();for(const _0x163bbe of _0xe118ae){const _0x494f53={..._0x163bbe,'status':_0x36050b(0x1ac),'merchantPaid':![],'shop':{'gatewaySettings':_0x163bbe[_0x36050b(0x13a)][_0x36050b(0x1ef)]}},_0x5600b4=this['isEligibleForPayout'](_0x494f53);if(!_0x5600b4)continue;const _0x5c151c=await currencyService_1[_0x36050b(0x154)][_0x36050b(0x166)](_0x163bbe['amount'],_0x163bbe[_0x36050b(0x1a7)]),_0x33d374=this[_0x36050b(0x1a3)](_0x163bbe[_0x36050b(0x13a)],_0x163bbe[_0x36050b(0x1d6)]),_0xe5038=this['calculateAmountAfterCommission'](_0x5c151c,_0x33d374[_0x36050b(0x1e2)]),_0x3b1ffa=_0x163bbe[_0x36050b(0x16e)];!_0x459f83[_0x36050b(0x17e)](_0x3b1ffa)&&_0x459f83[_0x36050b(0x206)](_0x3b1ffa,{'shop':_0x163bbe[_0x36050b(0x13a)],'payments':[]}),_0x459f83[_0x36050b(0x176)](_0x3b1ffa)['payments']['push']({'id':_0x163bbe['id'],'amount':_0x163bbe['amount'],'currency':_0x163bbe[_0x36050b(0x1a7)],'gateway':_0x163bbe[_0x36050b(0x1d6)],'paidAt':_0x163bbe[_0x36050b(0x142)],'createdAt':_0x163bbe[_0x36050b(0x1fe)],'amountUSDT':_0x5c151c,'commission':_0x33d374[_0x36050b(0x1e2)],'amountAfterCommissionUSDT':_0xe5038,'isEligible':!![]});}console['log'](_0x36050b(0x1d3)+_0x459f83['size']+_0x36050b(0x15f));const _0x31f4e2=[];for(const [_0x3f2ae5,_0x35a156]of _0x459f83){const {shop:_0x1f063b,payments:_0x2a9a28}=_0x35a156,_0x456298=_0x2a9a28[_0x36050b(0x1c7)]((_0x50fdbe,_0x1ce49b)=>_0x50fdbe+_0x1ce49b[_0x36050b(0x18e)],0x0),_0xf42498=_0x2a9a28[_0x36050b(0x1c7)]((_0x4765fb,_0x36a559)=>_0x4765fb+_0x36a559[_0x36050b(0x14a)],0x0);if(_0x2ef962&&_0xf42498<_0x2ef962)continue;if(_0x24afca){const _0x254071=_0x24afca[_0x36050b(0x13c)](),_0x7364bf=_0x1f063b[_0x36050b(0x209)][_0x36050b(0x13c)]()[_0x36050b(0x1e8)](_0x254071)||_0x1f063b[_0x36050b(0x1ad)][_0x36050b(0x13c)]()[_0x36050b(0x1e8)](_0x254071)||_0x1f063b[_0x36050b(0x1fc)]&&_0x1f063b['telegram'][_0x36050b(0x13c)]()[_0x36050b(0x1e8)](_0x254071);if(!_0x7364bf)continue;}const _0x345bd7=new Map();for(const _0x1b5503 of _0x2a9a28){const _0x3fc33c=_0x1b5503[_0x36050b(0x1d6)];!_0x345bd7[_0x36050b(0x17e)](_0x3fc33c)&&_0x345bd7[_0x36050b(0x206)](_0x3fc33c,{'count':0x0,'amountUSDT':0x0,'amountAfterCommissionUSDT':0x0,'commission':_0x1b5503[_0x36050b(0x1e2)]});const _0x3b004c=_0x345bd7[_0x36050b(0x176)](_0x3fc33c);_0x3b004c['count']++,_0x3b004c['amountUSDT']+=_0x1b5503[_0x36050b(0x18e)],_0x3b004c[_0x36050b(0x14a)]+=_0x1b5503[_0x36050b(0x14a)];}const _0x174e58=Array[_0x36050b(0x182)](_0x345bd7[_0x36050b(0x1f3)]())['map'](([_0x2b39bb,_0x5383ad])=>({'gateway':_0x2b39bb[_0x36050b(0x148)](0x0)[_0x36050b(0x183)]()+_0x2b39bb[_0x36050b(0x1c1)](0x1),'count':_0x5383ad[_0x36050b(0x175)],'amountUSDT':Math[_0x36050b(0x16c)](_0x5383ad[_0x36050b(0x18e)]*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x36050b(0x16c)](_0x5383ad[_0x36050b(0x14a)]*0x64)/0x64,'commission':_0x5383ad[_0x36050b(0x1e2)]})),_0x2f31de=_0x2a9a28[_0x36050b(0x1c7)]((_0x4ba371,_0x3ce76f)=>{const _0x1974ad=_0x36050b;return _0x3ce76f[_0x1974ad(0x142)]<_0x4ba371?_0x3ce76f[_0x1974ad(0x142)]:_0x4ba371;},_0x2a9a28[0x0][_0x36050b(0x142)]);_0x31f4e2[_0x36050b(0x1eb)]({'id':_0x1f063b['id'],'fullName':_0x1f063b[_0x36050b(0x209)],'username':_0x1f063b[_0x36050b(0x1ad)],'telegramId':_0x1f063b[_0x36050b(0x1fc)],'merchantUrl':_0x1f063b[_0x36050b(0x171)],'wallets':{'usdtPolygonWallet':_0x1f063b[_0x36050b(0x1ee)],'usdtTrcWallet':_0x1f063b['usdtTrcWallet'],'usdtErcWallet':_0x1f063b[_0x36050b(0x1c0)],'usdcPolygonWallet':_0x1f063b[_0x36050b(0x1f8)]},'totalAmountUSDT':Math[_0x36050b(0x16c)](_0x456298*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x36050b(0x16c)](_0xf42498*0x64)/0x64,'paymentsCount':_0x2a9a28[_0x36050b(0x1e9)],'oldestPaymentDate':_0x2f31de,'gatewayBreakdown':_0x174e58});}_0x31f4e2[_0x36050b(0x1bb)]((_0x8ec8ce,_0x556b98)=>_0x556b98[_0x36050b(0x146)]-_0x8ec8ce[_0x36050b(0x146)]);const _0x286e2d=_0x31f4e2['length'],_0x48a333=_0x31f4e2[_0x36050b(0x1c7)]((_0x46272e,_0x13561d)=>_0x46272e+_0x13561d[_0x36050b(0x1b5)],0x0),_0x36ae27=_0x31f4e2[_0x36050b(0x1c7)]((_0x48e437,_0x409522)=>_0x48e437+_0x409522[_0x36050b(0x146)],0x0),_0x2206a6=(_0x13da9c-0x1)*_0x4ef72c,_0x181f37=_0x31f4e2['slice'](_0x2206a6,_0x2206a6+_0x4ef72c);return console['log']('‚úÖ\x20Returning\x20'+_0x181f37['length']+'\x20merchants\x20out\x20of\x20'+_0x286e2d+_0x36050b(0x15e)),console[_0x36050b(0x156)](_0x36050b(0x14b)+_0x48a333[_0x36050b(0x1ae)](0x2)+'\x20USDT\x20('+_0x36ae27[_0x36050b(0x1ae)](0x2)+_0x36050b(0x15c)),{'merchants':_0x181f37,'pagination':{'page':_0x13da9c,'limit':_0x4ef72c,'total':_0x286e2d,'totalPages':Math[_0x36050b(0x1ec)](_0x286e2d/_0x4ef72c)},'summary':{'totalMerchants':_0x286e2d,'totalAmountUSDT':Math[_0x36050b(0x16c)](_0x48a333*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x36050b(0x16c)](_0x36ae27*0x64)/0x64}};}async['getPayoutStats'](){const _0x42b5fc=a33_0x530c5f;console[_0x42b5fc(0x156)](_0x42b5fc(0x197));const _0x209eb4=await database_1[_0x42b5fc(0x1af)]['payment'][_0x42b5fc(0x1a1)]({'where':{'status':{'in':[_0x42b5fc(0x1ac),_0x42b5fc(0x1dd),'CHARGEBACK']}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'status':!![],'gateway':!![],'paidAt':!![],'merchantPaid':!![],'createdAt':!![],'chargebackAmount':!![],'shop':{'select':{'gatewaySettings':!![]}}}});console[_0x42b5fc(0x156)](_0x42b5fc(0x17f)+_0x209eb4[_0x42b5fc(0x1e9)]+_0x42b5fc(0x1bf));const _0x106ef4=new Date(),_0x93e2ef=new Date(_0x106ef4[_0x42b5fc(0x1e1)](),_0x106ef4[_0x42b5fc(0x133)](),0x1),_0x4a6f29=new Date(_0x106ef4[_0x42b5fc(0x1e1)](),_0x106ef4[_0x42b5fc(0x133)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7);let _0xfae934=0x0,_0xbce62b=0x0,_0x28e709=0x0,_0xe8529f=0x0;for(const _0x2c23b1 of _0x209eb4){const _0x4cf4ba=this['calculateEffectiveAmount'](_0x2c23b1);if(_0x4cf4ba===0x0)continue;let _0x10808e,_0x3e2051;if(_0x2c23b1[_0x42b5fc(0x1f4)]===_0x42b5fc(0x1fb))_0x10808e=Math[_0x42b5fc(0x186)](_0x4cf4ba),_0x3e2051=-_0x10808e;else{_0x10808e=await currencyService_1[_0x42b5fc(0x154)]['convertToUSDT'](_0x2c23b1[_0x42b5fc(0x1d2)],_0x2c23b1['currency']);const _0x26f8b2=this[_0x42b5fc(0x1a3)](_0x2c23b1[_0x42b5fc(0x13a)],_0x2c23b1[_0x42b5fc(0x1d6)]);_0x3e2051=this[_0x42b5fc(0x17d)](_0x10808e,_0x26f8b2[_0x42b5fc(0x1e2)]);}_0x2c23b1[_0x42b5fc(0x19f)]&&(_0xfae934+=_0x3e2051,_0x2c23b1[_0x42b5fc(0x142)]&&_0x2c23b1['paidAt']>=_0x93e2ef&&_0x2c23b1[_0x42b5fc(0x142)]<=_0x4a6f29&&(_0x28e709+=_0x3e2051)),_0x2c23b1[_0x42b5fc(0x1f4)]===_0x42b5fc(0x1ac)&&this[_0x42b5fc(0x1e6)](_0x2c23b1)&&(_0xbce62b+=_0x3e2051,_0xe8529f+=_0x10808e);}const _0x1ba02d={'totalPayout':Math[_0x42b5fc(0x16c)](_0xfae934*0x64)/0x64,'awaitingPayout':Math[_0x42b5fc(0x16c)](_0xbce62b*0x64)/0x64,'thisMonth':Math[_0x42b5fc(0x16c)](_0x28e709*0x64)/0x64,'availableBalance':Math['round'](_0xe8529f*0x64)/0x64};return console[_0x42b5fc(0x156)](_0x42b5fc(0x141)),console[_0x42b5fc(0x156)](_0x42b5fc(0x188)+_0x1ba02d[_0x42b5fc(0x179)]+_0x42b5fc(0x1bc)),console[_0x42b5fc(0x156)](_0x42b5fc(0x157)+_0x1ba02d[_0x42b5fc(0x16f)]+_0x42b5fc(0x1a6)),console['log'](_0x42b5fc(0x1a8)+_0x1ba02d['thisMonth']+_0x42b5fc(0x147)),console['log'](_0x42b5fc(0x1a0)+_0x1ba02d['availableBalance']+_0x42b5fc(0x147)),_0x1ba02d;}async['getSystemStatistics'](_0x6ca9e7){const _0x5c2ebb=a33_0x530c5f,_0x2a4b08=this[_0x5c2ebb(0x1d4)](_0x6ca9e7),_0x518dbf=new Date();_0x518dbf['setDate'](_0x518dbf[_0x5c2ebb(0x190)]()-_0x2a4b08),console[_0x5c2ebb(0x156)](_0x5c2ebb(0x136)+_0x6ca9e7+'\x20('+_0x2a4b08+_0x5c2ebb(0x16b));const _0x133bf0=await database_1[_0x5c2ebb(0x1af)]['shop']['count']({'where':{'status':'ACTIVE'}}),_0x2aba6c=await database_1[_0x5c2ebb(0x1af)]['payment'][_0x5c2ebb(0x175)](),_0x35de68=await database_1[_0x5c2ebb(0x1af)][_0x5c2ebb(0x200)][_0x5c2ebb(0x1a1)]({'where':{'status':{'in':[_0x5c2ebb(0x1ac),'REFUND',_0x5c2ebb(0x1fb)]}},'select':{'amount':!![],'currency':!![],'status':!![],'chargebackAmount':!![],'createdAt':!![]}});console[_0x5c2ebb(0x156)](_0x5c2ebb(0x17f)+_0x35de68['length']+_0x5c2ebb(0x15d));const _0x4d58d1=await Promise['all'](_0x35de68['map'](async _0x3b9d8a=>{const _0x50c7fa=_0x5c2ebb,_0x226ea8=this[_0x50c7fa(0x1da)](_0x3b9d8a);if(_0x226ea8===0x0)return{'amount':0x0,'createdAt':_0x3b9d8a[_0x50c7fa(0x1fe)]};let _0x4182ed;return _0x3b9d8a[_0x50c7fa(0x1f4)]===_0x50c7fa(0x1fb)?_0x4182ed=-Math['abs'](_0x226ea8):_0x4182ed=await currencyService_1[_0x50c7fa(0x154)]['convertToUSDT'](_0x3b9d8a[_0x50c7fa(0x1d2)],_0x3b9d8a[_0x50c7fa(0x1a7)]),{'amount':_0x4182ed,'createdAt':_0x3b9d8a[_0x50c7fa(0x1fe)]};})),_0x230838=_0x4d58d1[_0x5c2ebb(0x1c7)]((_0x5a8c4c,_0x35b67d)=>_0x5a8c4c+_0x35b67d[_0x5c2ebb(0x1d2)],0x0),_0x58fba1=_0x2aba6c>0x0?_0x230838/_0x2aba6c:0x0;console[_0x5c2ebb(0x156)]('üíµ\x20Total\x20revenue:\x20'+_0x230838['toFixed'](0x2)+_0x5c2ebb(0x1bc)),console[_0x5c2ebb(0x156)](_0x5c2ebb(0x14c)+_0x58fba1['toFixed'](0x2)+_0x5c2ebb(0x147));const _0x2dd575=await database_1[_0x5c2ebb(0x1af)][_0x5c2ebb(0x1bd)]`
      SELECT 
        DATE(created_at) as date,
        array_agg(
          json_build_object(
            'amount', amount,
            'currency', currency,
            'status', status,
            'chargeback_amount', chargeback_amount
          )
        ) as payments
      FROM payments 
      WHERE created_at >= ${_0x518dbf}
        AND status IN ('PAID', 'REFUND', 'CHARGEBACK')
      GROUP BY DATE(created_at)
      ORDER BY date ASC
    `;console[_0x5c2ebb(0x156)]('üìÖ\x20Processing\x20daily\x20stats\x20for\x20'+_0x2dd575['length']+'\x20days');const _0x54be78=await Promise[_0x5c2ebb(0x1c2)](_0x2dd575['map'](async _0x16265d=>{const _0x120a20=_0x5c2ebb,_0x508cf9=await Promise[_0x120a20(0x1c2)](_0x16265d[_0x120a20(0x1be)][_0x120a20(0x144)](async _0x44dff1=>{const _0x1db9c3=_0x120a20,_0x223e6c=this[_0x1db9c3(0x1da)](_0x44dff1);if(_0x223e6c===0x0)return 0x0;return _0x44dff1[_0x1db9c3(0x1f4)]===_0x1db9c3(0x1fb)?-Math['abs'](_0x223e6c):await currencyService_1['currencyService'][_0x1db9c3(0x166)](_0x44dff1['amount'],_0x44dff1[_0x1db9c3(0x1a7)]);})),_0x108f3d=_0x508cf9['reduce']((_0x5c52e5,_0x20f3d6)=>_0x5c52e5+_0x20f3d6,0x0);return{'date':_0x16265d['date'][_0x120a20(0x169)]()[_0x120a20(0x1a4)]('T')[0x0],'amount':_0x108f3d};})),_0x5816de=this['generateDateRange'](_0x518dbf,new Date()),_0x2f41fc=new Map(_0x54be78[_0x5c2ebb(0x144)](_0x3678cf=>[_0x3678cf[_0x5c2ebb(0x1e0)],_0x3678cf[_0x5c2ebb(0x1d2)]])),_0x47a24e=_0x5816de[_0x5c2ebb(0x144)](_0x35c6ab=>({'date':_0x35c6ab,'amount':_0x2f41fc[_0x5c2ebb(0x176)](_0x35c6ab)||0x0}));return console[_0x5c2ebb(0x156)](_0x5c2ebb(0x1c6)),console['log']('üë•\x20Total\x20users:\x20'+_0x133bf0),console['log']('üí≥\x20Total\x20payments:\x20'+_0x2aba6c),console['log'](_0x5c2ebb(0x177)+_0x47a24e[_0x5c2ebb(0x1e9)]),{'totalRevenue':Math[_0x5c2ebb(0x16c)](_0x230838*0x64)/0x64,'totalUsers':_0x133bf0,'totalPayments':_0x2aba6c,'averagePayment':Math[_0x5c2ebb(0x16c)](_0x58fba1*0x64)/0x64,'dailyRevenue':_0x47a24e};}async[a33_0x530c5f(0x19c)](_0x4f2168){const _0x19eba9=a33_0x530c5f,{page:_0x2f6a74,limit:_0x4fa2f6,status:_0x3d547a,gateway:_0x909140,shopId:_0x3ef3f8,dateFrom:_0x2149b0,dateTo:_0x2a0afb,search:_0x2e8735}=_0x4f2168,_0x18cbdc=(_0x2f6a74-0x1)*_0x4fa2f6;console[_0x19eba9(0x156)](_0x19eba9(0x1e3),_0x4f2168);const _0x10a6bb={};_0x3d547a&&(_0x10a6bb['status']=_0x3d547a[_0x19eba9(0x183)]());if(_0x909140){if((0x0,gateway_1[_0x19eba9(0x14d)])(_0x909140)){const _0x361283=(0x0,gateway_1[_0x19eba9(0x192)])(_0x909140);_0x361283&&(_0x10a6bb[_0x19eba9(0x1d6)]=_0x361283);}else _0x10a6bb[_0x19eba9(0x1d6)]=_0x909140[_0x19eba9(0x13c)]();}_0x3ef3f8&&(_0x10a6bb[_0x19eba9(0x16e)]=_0x3ef3f8);(_0x2149b0||_0x2a0afb)&&(_0x10a6bb[_0x19eba9(0x1fe)]={},_0x2149b0&&(_0x10a6bb[_0x19eba9(0x1fe)][_0x19eba9(0x1ca)]=new Date(_0x2149b0)),_0x2a0afb&&(_0x10a6bb[_0x19eba9(0x1fe)][_0x19eba9(0x178)]=new Date(_0x2a0afb)));_0x2e8735&&(_0x10a6bb['OR']=[{'orderId':{'contains':_0x2e8735,'mode':_0x19eba9(0x1ea)}},{'gatewayOrderId':{'contains':_0x2e8735,'mode':_0x19eba9(0x1ea)}},{'gatewayPaymentId':{'contains':_0x2e8735,'mode':'insensitive'}},{'customerEmail':{'contains':_0x2e8735,'mode':_0x19eba9(0x1ea)}},{'customerName':{'contains':_0x2e8735,'mode':'insensitive'}},{'shop':{'name':{'contains':_0x2e8735,'mode':_0x19eba9(0x1ea)}}},{'shop':{'username':{'contains':_0x2e8735,'mode':'insensitive'}}}]);const [_0x3526bb,_0xc7d993]=await Promise[_0x19eba9(0x1c2)]([database_1[_0x19eba9(0x1af)][_0x19eba9(0x200)][_0x19eba9(0x1a1)]({'where':_0x10a6bb,'skip':_0x18cbdc,'take':_0x4fa2f6,'orderBy':{'createdAt':_0x19eba9(0x151)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x19eba9(0x1af)]['payment']['count']({'where':_0x10a6bb})]);console[_0x19eba9(0x156)](_0x19eba9(0x138)+_0x3526bb[_0x19eba9(0x1e9)]+_0x19eba9(0x19e)+_0xc7d993+_0x19eba9(0x15e));const _0x504137=_0x3526bb['map'](_0x233bb8=>({'id':_0x233bb8['id'],'shopId':_0x233bb8['shopId'],'shopName':_0x233bb8[_0x19eba9(0x13a)][_0x19eba9(0x209)],'shopUsername':_0x233bb8[_0x19eba9(0x13a)][_0x19eba9(0x1ad)],'gateway':_0x233bb8[_0x19eba9(0x1d6)],'orderId':_0x233bb8[_0x19eba9(0x1b8)],'gatewayOrderId':_0x233bb8[_0x19eba9(0x1f0)],'amount':_0x233bb8[_0x19eba9(0x1d2)],'currency':_0x233bb8[_0x19eba9(0x1a7)],'sourceCurrency':_0x233bb8[_0x19eba9(0x1b2)],'status':_0x233bb8['status'],'usage':_0x233bb8[_0x19eba9(0x1b7)],'externalPaymentUrl':_0x233bb8['externalPaymentUrl'],'gatewayPaymentId':_0x233bb8[_0x19eba9(0x180)],'customerEmail':_0x233bb8[_0x19eba9(0x184)],'customerName':_0x233bb8['customerName'],'cardLast4':_0x233bb8[_0x19eba9(0x198)],'paymentMethod':_0x233bb8['paymentMethod'],'bankId':_0x233bb8[_0x19eba9(0x1e7)],'remitterIban':_0x233bb8[_0x19eba9(0x170)],'remitterName':_0x233bb8[_0x19eba9(0x13d)],'chargebackAmount':_0x233bb8[_0x19eba9(0x1f5)],'adminNotes':_0x233bb8[_0x19eba9(0x202)],'statusChangedBy':_0x233bb8['statusChangedBy'],'statusChangedAt':_0x233bb8['statusChangedAt'],'createdAt':_0x233bb8[_0x19eba9(0x1fe)],'updatedAt':_0x233bb8[_0x19eba9(0x208)],'expiresAt':_0x233bb8[_0x19eba9(0x189)]}));return{'payments':_0x504137,'pagination':{'page':_0x2f6a74,'limit':_0x4fa2f6,'total':_0xc7d993,'totalPages':Math[_0x19eba9(0x1ec)](_0xc7d993/_0x4fa2f6)}};}async[a33_0x530c5f(0x1a9)](_0x44dd38){const _0x451175=a33_0x530c5f;console[_0x451175(0x156)](_0x451175(0x185)+_0x44dd38);const _0x4f61b7=await database_1[_0x451175(0x1af)][_0x451175(0x200)][_0x451175(0x18c)]({'where':{'id':_0x44dd38},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}},'webhookLogs':{'orderBy':{'createdAt':'desc'},'take':0xa,'select':{'id':!![],'event':!![],'statusCode':!![],'retryCount':!![],'createdAt':!![]}}}});if(!_0x4f61b7)return console[_0x451175(0x156)](_0x451175(0x1db)+_0x44dd38),null;return console[_0x451175(0x156)](_0x451175(0x159)+_0x4f61b7[_0x451175(0x1b8)]+'\x20('+_0x4f61b7[_0x451175(0x1f4)]+')'),{'id':_0x4f61b7['id'],'shopId':_0x4f61b7[_0x451175(0x16e)],'shopName':_0x4f61b7['shop'][_0x451175(0x209)],'shopUsername':_0x4f61b7[_0x451175(0x13a)][_0x451175(0x1ad)],'gateway':_0x4f61b7[_0x451175(0x1d6)],'orderId':_0x4f61b7[_0x451175(0x1b8)],'gatewayOrderId':_0x4f61b7[_0x451175(0x1f0)],'amount':_0x4f61b7[_0x451175(0x1d2)],'currency':_0x4f61b7['currency'],'sourceCurrency':_0x4f61b7[_0x451175(0x1b2)],'status':_0x4f61b7[_0x451175(0x1f4)],'usage':_0x4f61b7['usage'],'externalPaymentUrl':_0x4f61b7[_0x451175(0x1c8)],'gatewayPaymentId':_0x4f61b7[_0x451175(0x180)],'customerEmail':_0x4f61b7['customerEmail'],'customerName':_0x4f61b7[_0x451175(0x14f)],'cardLast4':_0x4f61b7[_0x451175(0x198)],'paymentMethod':_0x4f61b7[_0x451175(0x172)],'bankId':_0x4f61b7[_0x451175(0x1e7)],'remitterIban':_0x4f61b7['remitterIban'],'remitterName':_0x4f61b7[_0x451175(0x13d)],'chargebackAmount':_0x4f61b7[_0x451175(0x1f5)],'adminNotes':_0x4f61b7[_0x451175(0x202)],'statusChangedBy':_0x4f61b7[_0x451175(0x201)],'statusChangedAt':_0x4f61b7['statusChangedAt'],'createdAt':_0x4f61b7['createdAt'],'updatedAt':_0x4f61b7['updatedAt'],'expiresAt':_0x4f61b7[_0x451175(0x189)],'webhookLogs':_0x4f61b7['webhookLogs']};}async['updatePaymentStatus'](_0x59812b,_0x202cd4,_0x54bc07,_0x4afb5f){const _0x48b85=a33_0x530c5f;console[_0x48b85(0x156)](_0x48b85(0x1cc)+_0x59812b+_0x48b85(0x15a)+_0x202cd4);const _0x4695f2=['PENDING',_0x48b85(0x1ac),_0x48b85(0x1c3),_0x48b85(0x174),_0x48b85(0x1dd),'CHARGEBACK'];if(!_0x4695f2[_0x48b85(0x1e8)](_0x202cd4[_0x48b85(0x183)]()))throw new Error('Invalid\x20status.\x20Valid\x20statuses:\x20'+_0x4695f2[_0x48b85(0x1cf)](',\x20'));const _0x5ee91e=await database_1[_0x48b85(0x1af)][_0x48b85(0x200)][_0x48b85(0x18c)]({'where':{'id':_0x59812b},'select':{'id':!![],'status':!![],'orderId':!![]}});if(!_0x5ee91e)throw new Error('Payment\x20not\x20found');if(_0x202cd4[_0x48b85(0x183)]()===_0x48b85(0x1fb)){if(!_0x4afb5f||_0x4afb5f<=0x0)throw new Error(_0x48b85(0x18d));console[_0x48b85(0x156)](_0x48b85(0x14e)+_0x4afb5f+'\x20USDT\x20(penalty\x20amount)');}const _0x4dd378={'status':_0x202cd4[_0x48b85(0x183)](),'updatedAt':new Date(),'statusChangedBy':_0x48b85(0x152),'statusChangedAt':new Date()};_0x54bc07&&(_0x4dd378[_0x48b85(0x202)]=_0x54bc07);_0x202cd4['toUpperCase']()===_0x48b85(0x1fb)&&_0x4afb5f&&(_0x4dd378[_0x48b85(0x1f5)]=_0x4afb5f);const _0x3c7af9=await database_1['default']['payment']['update']({'where':{'id':_0x59812b},'data':_0x4dd378,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});return await database_1['default']['webhookLog'][_0x48b85(0x1c4)]({'data':{'paymentId':_0x59812b,'shopId':_0x3c7af9[_0x48b85(0x16e)],'event':'admin_status_update','statusCode':0xc8,'responseBody':JSON[_0x48b85(0x196)]({'oldStatus':_0x5ee91e[_0x48b85(0x1f4)],'newStatus':_0x202cd4[_0x48b85(0x183)](),'notes':_0x54bc07||null,'chargebackAmount':_0x4afb5f||null,'updatedBy':'admin','timestamp':new Date()[_0x48b85(0x169)]()})}}),console[_0x48b85(0x156)]('‚úÖ\x20Payment\x20'+_0x5ee91e[_0x48b85(0x1b8)]+_0x48b85(0x204)+_0x5ee91e[_0x48b85(0x1f4)]+_0x48b85(0x191)+_0x202cd4[_0x48b85(0x183)]()),_0x202cd4[_0x48b85(0x183)]()==='CHARGEBACK'&&console[_0x48b85(0x156)](_0x48b85(0x1fd)+_0x4afb5f+_0x48b85(0x1ce)),{'id':_0x3c7af9['id'],'shopId':_0x3c7af9['shopId'],'shopName':_0x3c7af9[_0x48b85(0x13a)]['name'],'shopUsername':_0x3c7af9['shop'][_0x48b85(0x1ad)],'gateway':_0x3c7af9['gateway'],'orderId':_0x3c7af9[_0x48b85(0x1b8)],'gatewayOrderId':_0x3c7af9['gatewayOrderId'],'amount':_0x3c7af9[_0x48b85(0x1d2)],'currency':_0x3c7af9[_0x48b85(0x1a7)],'sourceCurrency':_0x3c7af9[_0x48b85(0x1b2)],'status':_0x3c7af9[_0x48b85(0x1f4)],'usage':_0x3c7af9[_0x48b85(0x1b7)],'externalPaymentUrl':_0x3c7af9[_0x48b85(0x1c8)],'gatewayPaymentId':_0x3c7af9[_0x48b85(0x180)],'customerEmail':_0x3c7af9['customerEmail'],'customerName':_0x3c7af9[_0x48b85(0x14f)],'cardLast4':_0x3c7af9['cardLast4'],'paymentMethod':_0x3c7af9[_0x48b85(0x172)],'bankId':_0x3c7af9[_0x48b85(0x1e7)],'remitterIban':_0x3c7af9[_0x48b85(0x170)],'remitterName':_0x3c7af9[_0x48b85(0x13d)],'chargebackAmount':_0x3c7af9[_0x48b85(0x1f5)],'adminNotes':_0x3c7af9[_0x48b85(0x202)],'statusChangedBy':_0x3c7af9[_0x48b85(0x201)],'statusChangedAt':_0x3c7af9[_0x48b85(0x1f6)],'createdAt':_0x3c7af9[_0x48b85(0x1fe)],'updatedAt':_0x3c7af9['updatedAt'],'expiresAt':_0x3c7af9[_0x48b85(0x189)]};}async[a33_0x530c5f(0x1ff)](_0x5a044f){const _0x2865d0=a33_0x530c5f,{page:_0x2753c7,limit:_0x3d43f5,status:_0x1ed89a}=_0x5a044f,_0x12abea=(_0x2753c7-0x1)*_0x3d43f5,_0x53205c={};_0x1ed89a&&(_0x53205c[_0x2865d0(0x1f4)]=_0x1ed89a[_0x2865d0(0x183)]());console[_0x2865d0(0x156)](_0x2865d0(0x17b),{'page':_0x2753c7,'limit':_0x3d43f5,'status':_0x1ed89a,'where':_0x53205c});const [_0xb19003,_0x3293f4]=await Promise[_0x2865d0(0x1c2)]([database_1[_0x2865d0(0x1af)][_0x2865d0(0x13a)][_0x2865d0(0x1a1)]({'where':_0x53205c,'skip':_0x12abea,'take':_0x3d43f5,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x2865d0(0x151)}}),database_1[_0x2865d0(0x1af)][_0x2865d0(0x13a)][_0x2865d0(0x175)]({'where':_0x53205c})]);console[_0x2865d0(0x156)](_0x2865d0(0x138)+_0xb19003['length']+_0x2865d0(0x164)+_0x3293f4+_0x2865d0(0x15e));const _0x1b2544=_0xb19003[_0x2865d0(0x144)](_0x49cb48=>({'id':_0x49cb48['id'],'fullName':_0x49cb48[_0x2865d0(0x209)],'username':_0x49cb48[_0x2865d0(0x1ad)],'telegramId':_0x49cb48[_0x2865d0(0x1fc)],'merchantUrl':_0x49cb48['shopUrl'],'gateways':_0x49cb48[_0x2865d0(0x1df)]?JSON[_0x2865d0(0x17c)](_0x49cb48[_0x2865d0(0x1df)]):null,'gatewaySettings':_0x49cb48[_0x2865d0(0x1ef)]?JSON[_0x2865d0(0x17c)](_0x49cb48[_0x2865d0(0x1ef)]):null,'publicKey':_0x49cb48[_0x2865d0(0x167)],'wallets':{'usdtPolygonWallet':_0x49cb48[_0x2865d0(0x1ee)],'usdtTrcWallet':_0x49cb48['usdtTrcWallet'],'usdtErcWallet':_0x49cb48['usdtErcWallet'],'usdcPolygonWallet':_0x49cb48['usdcPolygonWallet']},'status':_0x49cb48['status'],'createdAt':_0x49cb48[_0x2865d0(0x1fe)]}));return{'users':_0x1b2544,'pagination':{'page':_0x2753c7,'limit':_0x3d43f5,'total':_0x3293f4,'totalPages':Math[_0x2865d0(0x1ec)](_0x3293f4/_0x3d43f5)}};}async[a33_0x530c5f(0x1b3)](_0x66494a){const _0x1eccca=a33_0x530c5f;return await this[_0x1eccca(0x173)]['getUserById'](_0x66494a);}async[a33_0x530c5f(0x160)](_0xd5a36c){const _0x272948=a33_0x530c5f;return await this[_0x272948(0x173)][_0x272948(0x160)](_0xd5a36c);}async[a33_0x530c5f(0x13f)](_0x442d66,_0x2bd8cd){const _0x11acfb=a33_0x530c5f;return await this[_0x11acfb(0x173)][_0x11acfb(0x13f)](_0x442d66,_0x2bd8cd);}async[a33_0x530c5f(0x161)](_0x7ab4b){const _0x2e9789=a33_0x530c5f;return await this[_0x2e9789(0x173)][_0x2e9789(0x161)](_0x7ab4b);}async[a33_0x530c5f(0x1ab)](_0x3460b9){const _0x56ea8e=a33_0x530c5f;console['log'](_0x56ea8e(0x1a5)+_0x3460b9);const _0x515f0c=await database_1['default']['shop'][_0x56ea8e(0x18c)]({'where':{'id':_0x3460b9},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x515f0c)throw new Error('User\x20not\x20found');if(_0x515f0c[_0x56ea8e(0x1f4)]===_0x56ea8e(0x1d5))throw new Error(_0x56ea8e(0x149));const _0x464898=await this[_0x56ea8e(0x173)]['updateUser'](_0x3460b9,{'status':'SUSPENDED'});return console[_0x56ea8e(0x156)](_0x56ea8e(0x1cd)+_0x515f0c[_0x56ea8e(0x1ad)]+_0x56ea8e(0x1b9)),_0x464898;}async['activateUser'](_0x61f294){const _0x275b7c=a33_0x530c5f;console['log'](_0x275b7c(0x1d1)+_0x61f294);const _0x5967c9=await database_1[_0x275b7c(0x1af)][_0x275b7c(0x13a)][_0x275b7c(0x18c)]({'where':{'id':_0x61f294},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x5967c9)throw new Error(_0x275b7c(0x1aa));if(_0x5967c9[_0x275b7c(0x1f4)]===_0x275b7c(0x1d8))throw new Error('User\x20is\x20already\x20active');const _0x52001d=await this[_0x275b7c(0x173)][_0x275b7c(0x13f)](_0x61f294,{'status':_0x275b7c(0x1d8)});return console['log'](_0x275b7c(0x1cd)+_0x5967c9[_0x275b7c(0x1ad)]+'\x20activated\x20successfully'),_0x52001d;}}exports[a33_0x530c5f(0x1f9)]=AdminService;