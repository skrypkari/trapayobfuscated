'use strict';function a35_0x1367(){const _0x265aee=['Insufficient\x20balance.\x20Available:\x20','name','KLYME\x20EU','__importDefault','status','all','dateTo','\x20\x20\x20Total\x20paid\x20out:\x20','deleteUser','statusChangedBy','\x20merchants\x20with\x20positive\x20balance','\x20USDT,\x20Requested:\x20','week','map','CoinToPay','4BEuysx','ACTIVE','periodFrom','300699QycoWZ','payment','desc','network','usdcPolygonWallet','custom','gateway','_sum','../config/database','usdtTrcWallet','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','totalTurnover','customerUa','orderId','\x20\x20\x20Balance:\x20','7713xQfaNP','\x20\x20\x20üë§\x20Merchant\x20earnings:\x20','customerIp','defineProperty','lte','totalPaidOut','averageCommissionRate','getAllPayments','üí∞\x20Current\x20shop\x20balance:\x20','payout','asc','PAID','\x20USDT','wallets','212gpFnuE','paymentsCount','updateCustomerData','paidAt','\x20merchants,\x20','parse','getFullYear','\x20->\x20','toFixed','getGatewayDisplayName','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','telegramId','\x20\x20\x20üìÖ\x20This\x20month:\x20','388314uqxknJ','currencyService','gatewayOrderId','shop','fullName','ceil','hash','admin','\x20balance\x20updated:','notes','successUrl','count','getAllUsers','turnoverUSDT','\x20USDT\x20(total\x20paid\x20to\x20merchants)','\x20became\x20PAID:\x20+','crypto','usdtErcWallet','getPayoutStats','SUSPENDED','round','getMonth','year','findUnique','convertToUSDT','Rapyd','\x20to\x20','statusChangedAt','createdAt','updatedAt','\x20paid\x20payments\x20for\x20analysis','Error\x20processing\x20payment\x20','awaitingPayout','\x20no\x20longer\x20PAID:\x20-','gatewayEarnings','10738820sFLkgk','groupBy','üîÑ\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','forEach','üí∞\x20Creating\x20payout\x20for\x20shop\x20','findMany','\x20\x20\x20üåç\x20Country:\x20','__esModule','getMerchantStatistics','values','645880QKjsze','create','period','üìÖ\x20Period:\x20','turnover','bcryptjs','availableBalance','‚úÖ\x20Payout\x20created:\x20','\x20USDT\x20(same\x20as\x20awaiting)','\x20\x20\x20üí∞\x20Total\x20turnover:\x20','updatePaymentStatus','username','customerName','password','REFUND','createPayout','log','merchantEarningsUSDT','randomBytes','findFirst','shopUrl','default','update','commissionUSDT','shopId','getMerchantsAwaitingPayout','üí∞\x20Found\x20','Noda','üìä\x20Getting\x20merchant\x20statistics\x20with\x20filters:','merchantEarnings','averageCheckUSDT','publicKey','deletePayout','failUrl','totalPayments','getPayoutById','not\x20set','delete','üìä\x20Payout\x20statistics\x20calculated:','toUpperCase','error','insensitive','reduce','getAllPayouts','hex','stringify','COMPLETED','periodTo','failureMessage','totalCommissionRate','month','üìä\x20Calculating\x20payout\x20statistics...','\x20USDT)','txid','toISOString','gatewaySettings','set','currency','\x20USDT\x20(+','amountUSDT','sk_','balance','date','\x20\x20\x20üìä\x20Total\x20payments:\x20','paymentGateways','toLowerCase','aggregate','KLYME\x20GB','üìä\x20Merchants\x20awaiting\x20payout:\x20','pk_','getSystemStatistics','üí∏\x20CHARGEBACK\x20penalty:\x20-','üí∞\x20Payment\x20','totalPayout','_count','customerEmail','üí∞\x20Shop\x20','length','1593Mreulb','whiteUrl','Telegram\x20username\x20already\x20exists','\x20status:\x20','90d','2020-01-01','./currencyService','customerCountry','\x20\x20\x20Current\x20balance:\x20','test_gateway','328920bGCCZM','\x20USDT\x20(total\x20merchant\x20balances)','gte','\x20USDT\x20(-','merchantUrl','createUser','6880CebIVM','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','30d','usdtPolygonWallet','adminNotes','Plisio','getTime','amount','$transaction','activateUser','paidOutUSDT','\x20\x20\x20üí∞\x20Total\x20payout:\x20','telegram','AdminService','\x20USDT\x20(','gateways'];a35_0x1367=function(){return _0x265aee;};return a35_0x1367();}const a35_0x41be8f=a35_0xaeab;(function(_0x5394ea,_0x4a4dcf){const _0x17f570=a35_0xaeab,_0x13fea8=_0x5394ea();while(!![]){try{const _0x498b29=-parseInt(_0x17f570(0x199))/0x1+-parseInt(_0x17f570(0x1de))/0x2*(parseInt(_0x17f570(0x1d0))/0x3)+parseInt(_0x17f570(0x1be))/0x4*(-parseInt(_0x17f570(0x218))/0x5)+-parseInt(_0x17f570(0x1eb))/0x6+parseInt(_0x17f570(0x1c1))/0x7+-parseInt(_0x17f570(0x19f))/0x8*(parseInt(_0x17f570(0x18f))/0x9)+parseInt(_0x17f570(0x20e))/0xa;if(_0x498b29===_0x4a4dcf)break;else _0x13fea8['push'](_0x13fea8['shift']());}catch(_0x328012){_0x13fea8['push'](_0x13fea8['shift']());}}}(a35_0x1367,0x2953e));var __importDefault=this&&this[a35_0x41be8f(0x1b2)]||function(_0x47e670){const _0x26e1d9=a35_0x41be8f;return _0x47e670&&_0x47e670[_0x26e1d9(0x215)]?_0x47e670:{'default':_0x47e670};};Object[a35_0x41be8f(0x1d3)](exports,a35_0x41be8f(0x215),{'value':!![]}),exports[a35_0x41be8f(0x1ac)]=void 0x0;function a35_0xaeab(_0x37e01b,_0x1694b1){const _0x1367c6=a35_0x1367();return a35_0xaeab=function(_0xaeab3a,_0x5cdfa1){_0xaeab3a=_0xaeab3a-0x182;let _0x216690=_0x1367c6[_0xaeab3a];return _0x216690;},a35_0xaeab(_0x37e01b,_0x1694b1);}const database_1=__importDefault(require(a35_0x41be8f(0x1c9))),bcryptjs_1=__importDefault(require(a35_0x41be8f(0x21d))),crypto_1=__importDefault(require(a35_0x41be8f(0x1fb))),currencyService_1=require(a35_0x41be8f(0x195));class AdminService{async[a35_0x41be8f(0x1fd)](){const _0x143a5d=a35_0x41be8f;console[_0x143a5d(0x228)](_0x143a5d(0x24b));const _0x564631=await database_1[_0x143a5d(0x22d)][_0x143a5d(0x1ee)]['aggregate']({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x143a5d(0x1bf)}}),_0x439b73=new Date(),_0x5065b6=new Date(_0x439b73[_0x143a5d(0x1e4)](),_0x439b73[_0x143a5d(0x200)](),0x1),_0x53d0ae=new Date(_0x439b73['getFullYear'](),_0x439b73[_0x143a5d(0x200)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x142879=await database_1[_0x143a5d(0x22d)][_0x143a5d(0x1d9)][_0x143a5d(0x183)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x5065b6,'lte':_0x53d0ae},'status':_0x143a5d(0x246)}}),_0x57dd25=_0x564631[_0x143a5d(0x1c8)][_0x143a5d(0x1d5)]||0x0,_0x34e929=_0x564631[_0x143a5d(0x1c8)][_0x143a5d(0x255)]||0x0,_0x335b01=_0x142879[_0x143a5d(0x1c8)][_0x143a5d(0x1a6)]||0x0,_0x450d25={'totalPayout':Math['round'](_0x57dd25*0x64)/0x64,'awaitingPayout':Math['round'](_0x34e929*0x64)/0x64,'thisMonth':Math[_0x143a5d(0x1ff)](_0x335b01*0x64)/0x64,'availableBalance':Math[_0x143a5d(0x1ff)](_0x34e929*0x64)/0x64};return console[_0x143a5d(0x228)](_0x143a5d(0x23e)),console['log'](_0x143a5d(0x1aa)+_0x450d25[_0x143a5d(0x18a)]+_0x143a5d(0x1f9)),console['log'](_0x143a5d(0x1a0)+_0x450d25[_0x143a5d(0x20b)]+_0x143a5d(0x19a)),console[_0x143a5d(0x228)]('\x20\x20\x20üíµ\x20Available\x20balance:\x20'+_0x450d25[_0x143a5d(0x21e)]+_0x143a5d(0x220)),console['log'](_0x143a5d(0x1ea)+_0x450d25['thisMonth']+_0x143a5d(0x1dc)),_0x450d25;}async[a35_0x41be8f(0x1e0)](_0x5dd483,_0x4a6bf6){const _0x5432ca=a35_0x41be8f;console[_0x5432ca(0x228)]('üîÑ\x20Updating\x20customer\x20data\x20for\x20payment\x20'+_0x5dd483+':',_0x4a6bf6);const _0x42047c=await database_1[_0x5432ca(0x22d)][_0x5432ca(0x1c2)][_0x5432ca(0x202)]({'where':{'id':_0x5dd483},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x42047c)throw new Error('Payment\x20not\x20found');const _0x304b57={};_0x4a6bf6[_0x5432ca(0x196)]!==undefined&&(_0x304b57[_0x5432ca(0x196)]=_0x4a6bf6[_0x5432ca(0x196)]||null);_0x4a6bf6[_0x5432ca(0x1d2)]!==undefined&&(_0x304b57[_0x5432ca(0x1d2)]=_0x4a6bf6[_0x5432ca(0x1d2)]||null);_0x4a6bf6[_0x5432ca(0x1cd)]!==undefined&&(_0x304b57['customerUa']=_0x4a6bf6[_0x5432ca(0x1cd)]||null);const _0xd64cf3=await database_1['default'][_0x5432ca(0x1c2)]['update']({'where':{'id':_0x5dd483},'data':{..._0x304b57,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console['log']('‚úÖ\x20Customer\x20data\x20updated\x20for\x20payment\x20'+_0x5dd483),console[_0x5432ca(0x228)](_0x5432ca(0x214)+_0x42047c[_0x5432ca(0x196)]+_0x5432ca(0x1e5)+_0xd64cf3['customerCountry']),console[_0x5432ca(0x228)]('\x20\x20\x20üåê\x20IP:\x20'+_0x42047c[_0x5432ca(0x1d2)]+_0x5432ca(0x1e5)+_0xd64cf3[_0x5432ca(0x1d2)]),console[_0x5432ca(0x228)]('\x20\x20\x20üñ•Ô∏è\x20User\x20Agent:\x20'+(_0x42047c[_0x5432ca(0x1cd)]?_0x5432ca(0x250):_0x5432ca(0x23c))+_0x5432ca(0x1e5)+(_0xd64cf3[_0x5432ca(0x1cd)]?_0x5432ca(0x250):_0x5432ca(0x23c))),_0xd64cf3;}async[a35_0x41be8f(0x187)](_0x130e46){const _0x534a65=a35_0x41be8f,_0x44337b=new Date();let _0x27741e;switch(_0x130e46){case'7d':_0x27741e=new Date(_0x44337b[_0x534a65(0x1a5)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x534a65(0x1a1):_0x27741e=new Date(_0x44337b[_0x534a65(0x1a5)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x534a65(0x193):_0x27741e=new Date(_0x44337b[_0x534a65(0x1a5)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;default:_0x27741e=new Date(_0x44337b['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x2dda62,_0x1dce40,_0x5f5c43,_0x4a53f1,_0x455eff,_0x17984d]=await Promise['all']([database_1[_0x534a65(0x22d)][_0x534a65(0x1ee)][_0x534a65(0x1f6)](),database_1[_0x534a65(0x22d)][_0x534a65(0x1ee)][_0x534a65(0x1f6)]({'where':{'status':_0x534a65(0x1bf)}}),database_1[_0x534a65(0x22d)]['payment'][_0x534a65(0x1f6)]({'where':{'createdAt':{'gte':_0x27741e},'gateway':{'not':'test_gateway'}}}),database_1[_0x534a65(0x22d)]['payment'][_0x534a65(0x1f6)]({'where':{'status':_0x534a65(0x1db),'createdAt':{'gte':_0x27741e},'gateway':{'not':_0x534a65(0x198)}}}),database_1[_0x534a65(0x22d)][_0x534a65(0x1c2)]['findMany']({'where':{'status':_0x534a65(0x1db),'createdAt':{'gte':_0x27741e},'gateway':{'not':_0x534a65(0x198)}},'select':{'amount':!![],'currency':!![]}}),database_1[_0x534a65(0x22d)][_0x534a65(0x1c2)][_0x534a65(0x213)]({'where':{'gateway':{'not':_0x534a65(0x198)}},'take':0xa,'orderBy':{'createdAt':_0x534a65(0x1c3)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}})]);let _0x3df636=0x0;for(const _0x269dbb of _0x455eff){const _0x692295=await currencyService_1[_0x534a65(0x1ec)][_0x534a65(0x203)](_0x269dbb[_0x534a65(0x1a6)],_0x269dbb[_0x534a65(0x251)]);_0x3df636+=_0x692295;}const _0x30405d=_0x5f5c43>0x0?_0x4a53f1/_0x5f5c43*0x64:0x0;return{'totalShops':_0x2dda62,'activeShops':_0x1dce40,'totalPayments':_0x5f5c43,'successfulPayments':_0x4a53f1,'totalRevenue':Math['round'](_0x3df636*0x64)/0x64,'conversionRate':Math['round'](_0x30405d*0x64)/0x64,'recentPayments':_0x17984d[_0x534a65(0x1bc)](_0x3434cc=>({'id':_0x3434cc['id'],'amount':_0x3434cc[_0x534a65(0x1a6)],'currency':_0x3434cc[_0x534a65(0x251)],'status':_0x3434cc[_0x534a65(0x1b3)],'gateway':_0x3434cc[_0x534a65(0x1c7)],'shop':_0x3434cc[_0x534a65(0x1ee)],'createdAt':_0x3434cc[_0x534a65(0x207)]}))};}async[a35_0x41be8f(0x216)](_0x1fbcc3){const _0x2e1bf4=a35_0x41be8f;console['log'](_0x2e1bf4(0x234),_0x1fbcc3);let _0x3ae9c7,_0x4588e3=new Date();if(_0x1fbcc3['period']===_0x2e1bf4(0x1c6)&&_0x1fbcc3['dateFrom']&&_0x1fbcc3[_0x2e1bf4(0x1b5)])_0x3ae9c7=new Date(_0x1fbcc3['dateFrom']),_0x4588e3=new Date(_0x1fbcc3['dateTo']);else{const _0x21f178=new Date();switch(_0x1fbcc3[_0x2e1bf4(0x21a)]){case _0x2e1bf4(0x1bb):_0x3ae9c7=new Date(_0x21f178[_0x2e1bf4(0x1a5)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x2e1bf4(0x24a):_0x3ae9c7=new Date(_0x21f178[_0x2e1bf4(0x1a5)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x2e1bf4(0x201):_0x3ae9c7=new Date(_0x21f178['getTime']()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x2e1bf4(0x1b4):default:_0x3ae9c7=new Date(_0x2e1bf4(0x194));break;}}console[_0x2e1bf4(0x228)](_0x2e1bf4(0x21b)+_0x3ae9c7[_0x2e1bf4(0x24e)]()+_0x2e1bf4(0x205)+_0x4588e3[_0x2e1bf4(0x24e)]());const _0x493ef3={'status':_0x2e1bf4(0x1db),'gateway':{'not':_0x2e1bf4(0x198)},'paidAt':{'gte':_0x3ae9c7,'lte':_0x4588e3}};_0x1fbcc3[_0x2e1bf4(0x230)]&&(_0x493ef3[_0x2e1bf4(0x230)]=_0x1fbcc3[_0x2e1bf4(0x230)]);const _0x14d552=await database_1[_0x2e1bf4(0x22d)][_0x2e1bf4(0x1c2)][_0x2e1bf4(0x213)]({'where':_0x493ef3,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x2e1bf4(0x228)](_0x2e1bf4(0x232)+_0x14d552['length']+_0x2e1bf4(0x209));let _0x321f46=0x0,_0x5f5811=0x0,_0x134efa=0x0;const _0x293958={},_0xc9a66={},_0xbfe717={};for(const _0x5c2ac5 of _0x14d552){try{const _0x2f6d46=await currencyService_1[_0x2e1bf4(0x1ec)][_0x2e1bf4(0x203)](_0x5c2ac5['amount'],_0x5c2ac5['currency']);let _0x43feca={};if(_0x5c2ac5['shop'][_0x2e1bf4(0x24f)])try{_0x43feca=JSON['parse'](_0x5c2ac5[_0x2e1bf4(0x1ee)][_0x2e1bf4(0x24f)]);}catch(_0x9de101){console[_0x2e1bf4(0x240)](_0x2e1bf4(0x1cb)+_0x5c2ac5[_0x2e1bf4(0x230)]+':',_0x9de101);}const _0x447733=_0x43feca['commission']||0xa,_0x235dfe=_0x2f6d46*(_0x447733/0x64),_0xdc6bd=_0x2f6d46-_0x235dfe;_0x321f46+=_0x2f6d46,_0x5f5811+=_0xdc6bd,_0x134efa+=_0x235dfe;!_0x293958[_0x5c2ac5[_0x2e1bf4(0x1c7)]]&&(_0x293958[_0x5c2ac5[_0x2e1bf4(0x1c7)]]={'gateway':_0x5c2ac5['gateway'],'gatewayDisplayName':this[_0x2e1bf4(0x1e7)](_0x5c2ac5[_0x2e1bf4(0x1c7)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x293958[_0x5c2ac5[_0x2e1bf4(0x1c7)]][_0x2e1bf4(0x1df)]++,_0x293958[_0x5c2ac5[_0x2e1bf4(0x1c7)]]['turnoverUSDT']+=_0x2f6d46,_0x293958[_0x5c2ac5[_0x2e1bf4(0x1c7)]][_0x2e1bf4(0x22f)]+=_0x235dfe,_0x293958[_0x5c2ac5[_0x2e1bf4(0x1c7)]][_0x2e1bf4(0x229)]+=_0xdc6bd,_0x293958[_0x5c2ac5['gateway']][_0x2e1bf4(0x249)]+=_0x447733;!_0x1fbcc3[_0x2e1bf4(0x230)]&&(!_0xc9a66[_0x5c2ac5[_0x2e1bf4(0x230)]]&&(_0xc9a66[_0x5c2ac5[_0x2e1bf4(0x230)]]={'shopId':_0x5c2ac5[_0x2e1bf4(0x230)],'shopName':_0x5c2ac5[_0x2e1bf4(0x1ee)][_0x2e1bf4(0x1b0)],'shopUsername':_0x5c2ac5[_0x2e1bf4(0x1ee)][_0x2e1bf4(0x223)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0xc9a66[_0x5c2ac5[_0x2e1bf4(0x230)]]['paymentsCount']++,_0xc9a66[_0x5c2ac5[_0x2e1bf4(0x230)]][_0x2e1bf4(0x1f8)]+=_0x2f6d46,_0xc9a66[_0x5c2ac5[_0x2e1bf4(0x230)]][_0x2e1bf4(0x22f)]+=_0x235dfe,_0xc9a66[_0x5c2ac5['shopId']][_0x2e1bf4(0x229)]+=_0xdc6bd);const _0x572dba=_0x5c2ac5[_0x2e1bf4(0x1e1)][_0x2e1bf4(0x24e)]()['split']('T')[0x0];!_0xbfe717[_0x572dba]&&(_0xbfe717[_0x572dba]={'date':_0x572dba,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0xbfe717[_0x572dba][_0x2e1bf4(0x21c)]+=_0x2f6d46,_0xbfe717[_0x572dba][_0x2e1bf4(0x235)]+=_0xdc6bd,_0xbfe717[_0x572dba][_0x2e1bf4(0x20d)]+=_0x235dfe,_0xbfe717[_0x572dba][_0x2e1bf4(0x1df)]++;}catch(_0x155889){console['error'](_0x2e1bf4(0x20a)+_0x5c2ac5['id']+':',_0x155889);}}Object['values'](_0x293958)[_0x2e1bf4(0x211)](_0x17ce10=>{const _0x53900f=_0x2e1bf4;_0x17ce10[_0x53900f(0x1d6)]=_0x17ce10[_0x53900f(0x1df)]>0x0?_0x17ce10['totalCommissionRate']/_0x17ce10[_0x53900f(0x1df)]:0x0,delete _0x17ce10[_0x53900f(0x249)];}),Object[_0x2e1bf4(0x217)](_0xc9a66)['forEach'](_0x27220d=>{const _0x2f0783=_0x2e1bf4;_0x27220d['averageCheckUSDT']=_0x27220d[_0x2f0783(0x1df)]>0x0?_0x27220d[_0x2f0783(0x1f8)]/_0x27220d['paymentsCount']:0x0;});let _0x296f4a=0x0;if(_0x1fbcc3[_0x2e1bf4(0x230)]){const _0x1c4461=await database_1['default'][_0x2e1bf4(0x1d9)][_0x2e1bf4(0x213)]({'where':{'shopId':_0x1fbcc3[_0x2e1bf4(0x230)],'status':_0x2e1bf4(0x246),'createdAt':{'gte':_0x3ae9c7,'lte':_0x4588e3}},'select':{'amount':!![]}});_0x296f4a=_0x1c4461[_0x2e1bf4(0x242)]((_0xd3e0b3,_0x52938e)=>_0xd3e0b3+_0x52938e[_0x2e1bf4(0x1a6)],0x0);}const _0x57ce0b=_0x14d552[_0x2e1bf4(0x18e)],_0x422d02=_0x14d552['length'],_0x42375c=_0x57ce0b>0x0?_0x321f46/_0x57ce0b:0x0,_0x3876a4=0x64,_0x506558=Math[_0x2e1bf4(0x1f0)]((_0x4588e3[_0x2e1bf4(0x1a5)]()-_0x3ae9c7[_0x2e1bf4(0x1a5)]())/(0x3e8*0x3c*0x3c*0x18)),_0xdaaa4f={'totalTurnover':Math[_0x2e1bf4(0x1ff)](_0x321f46*0x64)/0x64,'merchantEarnings':Math['round'](_0x5f5811*0x64)/0x64,'gatewayEarnings':Math['round'](_0x134efa*0x64)/0x64,'totalPaidOut':Math[_0x2e1bf4(0x1ff)](_0x296f4a*0x64)/0x64,'averageCheck':Math['round'](_0x42375c*0x64)/0x64,'totalPayments':_0x57ce0b,'successfulPayments':_0x422d02,'conversionRate':_0x3876a4,'gatewayBreakdown':Object[_0x2e1bf4(0x217)](_0x293958)['map'](_0x5aa8e8=>({..._0x5aa8e8,'turnoverUSDT':Math['round'](_0x5aa8e8['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x2e1bf4(0x1ff)](_0x5aa8e8['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x2e1bf4(0x1ff)](_0x5aa8e8[_0x2e1bf4(0x229)]*0x64)/0x64,'averageCommissionRate':Math[_0x2e1bf4(0x1ff)](_0x5aa8e8[_0x2e1bf4(0x1d6)]*0x64)/0x64})),'merchantBreakdown':_0x1fbcc3['shopId']?undefined:Object[_0x2e1bf4(0x217)](_0xc9a66)[_0x2e1bf4(0x1bc)](_0x23f3ed=>({..._0x23f3ed,'turnoverUSDT':Math[_0x2e1bf4(0x1ff)](_0x23f3ed[_0x2e1bf4(0x1f8)]*0x64)/0x64,'commissionUSDT':Math[_0x2e1bf4(0x1ff)](_0x23f3ed[_0x2e1bf4(0x22f)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x2e1bf4(0x1ff)](_0x23f3ed['merchantEarningsUSDT']*0x64)/0x64,'paidOutUSDT':Math[_0x2e1bf4(0x1ff)](_0x23f3ed[_0x2e1bf4(0x1a9)]*0x64)/0x64,'averageCheckUSDT':Math[_0x2e1bf4(0x1ff)](_0x23f3ed[_0x2e1bf4(0x236)]*0x64)/0x64})),'dailyData':Object[_0x2e1bf4(0x217)](_0xbfe717)['map'](_0x2f0a7d=>({..._0x2f0a7d,'turnover':Math[_0x2e1bf4(0x1ff)](_0x2f0a7d[_0x2e1bf4(0x21c)]*0x64)/0x64,'merchantEarnings':Math['round'](_0x2f0a7d['merchantEarnings']*0x64)/0x64,'gatewayEarnings':Math[_0x2e1bf4(0x1ff)](_0x2f0a7d[_0x2e1bf4(0x20d)]*0x64)/0x64}))['sort']((_0x455cb3,_0x29570)=>_0x455cb3[_0x2e1bf4(0x256)]['localeCompare'](_0x29570[_0x2e1bf4(0x256)])),'periodInfo':{'from':_0x3ae9c7,'to':_0x4588e3,'periodType':_0x1fbcc3['period']||_0x2e1bf4(0x1c6),'daysCount':_0x506558}};return console[_0x2e1bf4(0x228)]('üìä\x20Merchant\x20statistics\x20calculated:'),console[_0x2e1bf4(0x228)](_0x2e1bf4(0x221)+_0xdaaa4f[_0x2e1bf4(0x1cc)]+_0x2e1bf4(0x1dc)),console[_0x2e1bf4(0x228)](_0x2e1bf4(0x1d1)+_0xdaaa4f[_0x2e1bf4(0x235)]+_0x2e1bf4(0x1dc)),console[_0x2e1bf4(0x228)]('\x20\x20\x20üè™\x20Gateway\x20earnings:\x20'+_0xdaaa4f[_0x2e1bf4(0x20d)]+_0x2e1bf4(0x1dc)),console[_0x2e1bf4(0x228)](_0x2e1bf4(0x257)+_0xdaaa4f[_0x2e1bf4(0x23a)]),_0xdaaa4f;}[a35_0x41be8f(0x1e7)](_0x478d4d){const _0x242b15=a35_0x41be8f,_0x4bce10={'test_gateway':'Test\x20Gateway','plisio':_0x242b15(0x1a4),'rapyd':_0x242b15(0x204),'noda':_0x242b15(0x233),'cointopay':_0x242b15(0x1bd),'klyme_eu':_0x242b15(0x1b1),'klyme_gb':_0x242b15(0x184),'klyme_de':'KLYME\x20DE'};return _0x4bce10[_0x478d4d]||_0x478d4d;}async[a35_0x41be8f(0x231)](_0x4b9a3a){const _0x2c3749=a35_0x41be8f,{page:_0x1c21f1,limit:_0x3a882b,minAmount:_0x291028,search:_0x12ec26}=_0x4b9a3a,_0x4e0472=(_0x1c21f1-0x1)*_0x3a882b;console[_0x2c3749(0x228)]('üìä\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:',_0x4b9a3a);const _0x448958={'balance':{'gt':0x0},'status':'ACTIVE'};_0x291028&&(_0x448958[_0x2c3749(0x255)][_0x2c3749(0x19b)]=_0x291028);_0x12ec26&&(_0x448958['OR']=[{'name':{'contains':_0x12ec26,'mode':_0x2c3749(0x241)}},{'username':{'contains':_0x12ec26,'mode':'insensitive'}}]);const [_0x41ad42,_0x4aba7d]=await Promise[_0x2c3749(0x1b4)]([database_1[_0x2c3749(0x22d)][_0x2c3749(0x1ee)]['findMany']({'where':_0x448958,'skip':_0x4e0472,'take':_0x3a882b,'orderBy':{'balance':_0x2c3749(0x1c3)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'createdAt':!![]}}),database_1[_0x2c3749(0x22d)][_0x2c3749(0x1ee)][_0x2c3749(0x1f6)]({'where':_0x448958})]);console['log']('üí∞\x20Found\x20'+_0x41ad42[_0x2c3749(0x18e)]+_0x2c3749(0x1b9));const _0x323d2e=await Promise[_0x2c3749(0x1b4)](_0x41ad42[_0x2c3749(0x1bc)](async _0x3c5817=>{const _0x47b2e3=_0x2c3749,[_0x540c1e,_0x23a7b4,_0x70a3d5]=await Promise['all']([database_1[_0x47b2e3(0x22d)][_0x47b2e3(0x1c2)][_0x47b2e3(0x1f6)]({'where':{'shopId':_0x3c5817['id'],'status':_0x47b2e3(0x1db),'amountUSDT':{'not':null}}}),database_1[_0x47b2e3(0x22d)]['payment'][_0x47b2e3(0x22b)]({'where':{'shopId':_0x3c5817['id'],'status':'PAID','amountUSDT':{'not':null}},'orderBy':{'paidAt':_0x47b2e3(0x1da)},'select':{'paidAt':!![]}}),database_1[_0x47b2e3(0x22d)][_0x47b2e3(0x1c2)][_0x47b2e3(0x20f)]({'by':['gateway'],'where':{'shopId':_0x3c5817['id'],'status':'PAID','amountUSDT':{'not':null}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x15cb61=_0x70a3d5[_0x47b2e3(0x1bc)](_0x48bad7=>({'gateway':_0x48bad7[_0x47b2e3(0x1c7)],'count':_0x48bad7[_0x47b2e3(0x18b)]['id'],'amountUSDT':_0x48bad7[_0x47b2e3(0x1c8)][_0x47b2e3(0x253)]||0x0,'amountAfterCommissionUSDT':_0x48bad7[_0x47b2e3(0x1c8)]['amountUSDT']||0x0,'commission':0x0}));return{'id':_0x3c5817['id'],'fullName':_0x3c5817[_0x47b2e3(0x1b0)],'username':_0x3c5817[_0x47b2e3(0x223)],'telegramId':_0x3c5817[_0x47b2e3(0x1ab)],'merchantUrl':_0x3c5817[_0x47b2e3(0x22c)],'wallets':{'usdtPolygonWallet':_0x3c5817[_0x47b2e3(0x1a2)],'usdtTrcWallet':_0x3c5817[_0x47b2e3(0x1ca)],'usdtErcWallet':_0x3c5817[_0x47b2e3(0x1fc)],'usdcPolygonWallet':_0x3c5817[_0x47b2e3(0x1c5)]},'totalAmountUSDT':_0x3c5817[_0x47b2e3(0x255)],'totalAmountAfterCommissionUSDT':_0x3c5817[_0x47b2e3(0x255)],'paymentsCount':_0x540c1e,'oldestPaymentDate':_0x23a7b4?.[_0x47b2e3(0x1e1)]||_0x3c5817['createdAt'],'gatewayBreakdown':_0x15cb61};})),_0x13cac6=_0x41ad42[_0x2c3749(0x242)]((_0x278726,_0x442e59)=>_0x278726+_0x442e59[_0x2c3749(0x255)],0x0),_0x4cd2dc=_0x13cac6;return console['log'](_0x2c3749(0x185)+_0x4aba7d+_0x2c3749(0x1e2)+Math['round'](_0x4cd2dc*0x64)/0x64+'\x20USDT\x20total'),{'merchants':_0x323d2e,'pagination':{'page':_0x1c21f1,'limit':_0x3a882b,'total':_0x4aba7d,'totalPages':Math[_0x2c3749(0x1f0)](_0x4aba7d/_0x3a882b)},'summary':{'totalMerchants':_0x4aba7d,'totalAmountUSDT':Math[_0x2c3749(0x1ff)](_0x13cac6*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x2c3749(0x1ff)](_0x4cd2dc*0x64)/0x64}};}async[a35_0x41be8f(0x227)](_0x437a71){const _0x2713e4=a35_0x41be8f,{shopId:_0x2c360a,amount:_0x333105,network:_0x1d9cd2,notes:_0x5703b7,periodFrom:_0x54b304,periodTo:_0xc6493e}=_0x437a71,_0x536b45=await database_1[_0x2713e4(0x22d)][_0x2713e4(0x1a7)](async _0x5bf938=>{const _0xd0842a=_0x2713e4,_0xb041e6=await _0x5bf938['shop']['findUnique']({'where':{'id':_0x2c360a},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0xb041e6)throw new Error('Shop\x20not\x20found');console[_0xd0842a(0x228)](_0xd0842a(0x212)+_0xb041e6[_0xd0842a(0x223)]+':'),console['log'](_0xd0842a(0x197)+_0xb041e6[_0xd0842a(0x255)]['toFixed'](0x6)+_0xd0842a(0x1dc)),console[_0xd0842a(0x228)]('\x20\x20\x20Payout\x20amount:\x20'+_0x333105['toFixed'](0x6)+_0xd0842a(0x1dc)),console[_0xd0842a(0x228)](_0xd0842a(0x1e8)+_0xb041e6['totalPaidOut']['toFixed'](0x6)+'\x20USDT');if(_0xb041e6[_0xd0842a(0x255)]<_0x333105)throw new Error(_0xd0842a(0x1af)+_0xb041e6['balance']['toFixed'](0x6)+_0xd0842a(0x1ba)+_0x333105[_0xd0842a(0x1e6)](0x6)+_0xd0842a(0x1dc));const _0x2cb994=await _0x5bf938[_0xd0842a(0x1d9)][_0xd0842a(0x219)]({'data':{'shopId':_0x2c360a,'amount':_0x333105,'network':_0x1d9cd2,'status':_0xd0842a(0x246),'notes':_0x5703b7,'periodFrom':_0x54b304?new Date(_0x54b304):null,'periodTo':_0xc6493e?new Date(_0xc6493e):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x32b95b=_0xb041e6[_0xd0842a(0x255)]-_0x333105,_0x35606b=_0xb041e6['totalPaidOut']+_0x333105;return await _0x5bf938[_0xd0842a(0x1ee)][_0xd0842a(0x22e)]({'where':{'id':_0x2c360a},'data':{'balance':_0x32b95b,'totalPaidOut':_0x35606b}}),console[_0xd0842a(0x228)]('üí∞\x20Shop\x20'+_0xb041e6[_0xd0842a(0x223)]+_0xd0842a(0x1f3)),console[_0xd0842a(0x228)](_0xd0842a(0x1cf)+_0xb041e6['balance'][_0xd0842a(0x1e6)](0x6)+_0xd0842a(0x1e5)+_0x32b95b['toFixed'](0x6)+_0xd0842a(0x19c)+_0x333105['toFixed'](0x6)+')'),console[_0xd0842a(0x228)](_0xd0842a(0x1b6)+_0xb041e6[_0xd0842a(0x1d5)][_0xd0842a(0x1e6)](0x6)+'\x20->\x20'+_0x35606b[_0xd0842a(0x1e6)](0x6)+_0xd0842a(0x252)+_0x333105[_0xd0842a(0x1e6)](0x6)+')'),{'payout':_0x2cb994,'shop':_0xb041e6};});return console[_0x2713e4(0x228)](_0x2713e4(0x21f)+_0x536b45[_0x2713e4(0x1d9)]['id']+'\x20for\x20shop\x20'+_0x536b45[_0x2713e4(0x1ee)][_0x2713e4(0x223)]+'\x20('+_0x333105+_0x2713e4(0x24c)),{'id':_0x536b45['payout']['id'],'shopId':_0x536b45['payout'][_0x2713e4(0x230)],'shopName':_0x536b45[_0x2713e4(0x1ee)][_0x2713e4(0x1b0)],'shopUsername':_0x536b45[_0x2713e4(0x1ee)][_0x2713e4(0x223)],'amount':_0x536b45[_0x2713e4(0x1d9)][_0x2713e4(0x1a6)],'network':_0x536b45[_0x2713e4(0x1d9)][_0x2713e4(0x1c4)],'status':_0x536b45[_0x2713e4(0x1d9)][_0x2713e4(0x1b3)],'txid':_0x536b45[_0x2713e4(0x1d9)][_0x2713e4(0x24d)],'notes':_0x536b45[_0x2713e4(0x1d9)][_0x2713e4(0x1f4)],'periodFrom':_0x536b45[_0x2713e4(0x1d9)][_0x2713e4(0x1c0)],'periodTo':_0x536b45[_0x2713e4(0x1d9)][_0x2713e4(0x247)],'createdAt':_0x536b45[_0x2713e4(0x1d9)][_0x2713e4(0x207)],'paidAt':_0x536b45[_0x2713e4(0x1d9)]['paidAt']};}async[a35_0x41be8f(0x243)](_0x2ca74){const _0xa9d000=a35_0x41be8f,{page:_0x1749ad,limit:_0x20a7b3,shopId:_0x4dd7c7,network:_0x5e66d0,dateFrom:_0x2acd53,dateTo:_0x5bbc96,search:_0x2f5b45}=_0x2ca74,_0x4045d2=(_0x1749ad-0x1)*_0x20a7b3,_0x50f1d9={};_0x4dd7c7&&(_0x50f1d9[_0xa9d000(0x230)]=_0x4dd7c7);_0x5e66d0&&(_0x50f1d9[_0xa9d000(0x1c4)]=_0x5e66d0);(_0x2acd53||_0x5bbc96)&&(_0x50f1d9[_0xa9d000(0x207)]={},_0x2acd53&&(_0x50f1d9[_0xa9d000(0x207)]['gte']=new Date(_0x2acd53)),_0x5bbc96&&(_0x50f1d9[_0xa9d000(0x207)]['lte']=new Date(_0x5bbc96)));_0x2f5b45&&(_0x50f1d9['OR']=[{'shop':{'name':{'contains':_0x2f5b45,'mode':_0xa9d000(0x241)}}},{'shop':{'username':{'contains':_0x2f5b45,'mode':_0xa9d000(0x241)}}},{'notes':{'contains':_0x2f5b45,'mode':_0xa9d000(0x241)}}]);const [_0x1a71be,_0x5beb81]=await Promise[_0xa9d000(0x1b4)]([database_1[_0xa9d000(0x22d)][_0xa9d000(0x1d9)]['findMany']({'where':_0x50f1d9,'skip':_0x4045d2,'take':_0x20a7b3,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0xa9d000(0x22d)][_0xa9d000(0x1d9)][_0xa9d000(0x1f6)]({'where':_0x50f1d9})]);return{'payouts':_0x1a71be[_0xa9d000(0x1bc)](_0x2219a4=>({'id':_0x2219a4['id'],'shopId':_0x2219a4[_0xa9d000(0x230)],'shopName':_0x2219a4[_0xa9d000(0x1ee)]['name'],'shopUsername':_0x2219a4['shop'][_0xa9d000(0x223)],'amount':_0x2219a4['amount'],'network':_0x2219a4[_0xa9d000(0x1c4)],'status':_0x2219a4[_0xa9d000(0x1b3)],'txid':_0x2219a4['txid'],'notes':_0x2219a4[_0xa9d000(0x1f4)],'periodFrom':_0x2219a4[_0xa9d000(0x1c0)],'periodTo':_0x2219a4[_0xa9d000(0x247)],'createdAt':_0x2219a4[_0xa9d000(0x207)],'paidAt':_0x2219a4[_0xa9d000(0x1e1)]})),'pagination':{'page':_0x1749ad,'limit':_0x20a7b3,'total':_0x5beb81,'totalPages':Math['ceil'](_0x5beb81/_0x20a7b3)}};}async[a35_0x41be8f(0x23b)](_0x2a1905){const _0x12ecbd=a35_0x41be8f,_0x3ed33d=await database_1[_0x12ecbd(0x22d)][_0x12ecbd(0x1d9)][_0x12ecbd(0x202)]({'where':{'id':_0x2a1905},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x3ed33d)return null;return{'id':_0x3ed33d['id'],'shopId':_0x3ed33d[_0x12ecbd(0x230)],'shopName':_0x3ed33d[_0x12ecbd(0x1ee)]['name'],'shopUsername':_0x3ed33d[_0x12ecbd(0x1ee)][_0x12ecbd(0x223)],'amount':_0x3ed33d['amount'],'network':_0x3ed33d['network'],'status':_0x3ed33d[_0x12ecbd(0x1b3)],'txid':_0x3ed33d[_0x12ecbd(0x24d)],'notes':_0x3ed33d[_0x12ecbd(0x1f4)],'periodFrom':_0x3ed33d[_0x12ecbd(0x1c0)],'periodTo':_0x3ed33d[_0x12ecbd(0x247)],'createdAt':_0x3ed33d[_0x12ecbd(0x207)],'paidAt':_0x3ed33d[_0x12ecbd(0x1e1)]};}async[a35_0x41be8f(0x238)](_0x4dcf3d){const _0x421412=a35_0x41be8f;await database_1[_0x421412(0x22d)][_0x421412(0x1d9)][_0x421412(0x23d)]({'where':{'id':_0x4dcf3d}});}async[a35_0x41be8f(0x1d7)](_0x5e8175){const _0x1813f2=a35_0x41be8f,{page:_0x5998c1,limit:_0x30e9ee,status:_0x44f965,gateway:_0x3e6b38,shopId:_0x2993ee,dateFrom:_0x1aa8d2,dateTo:_0x327e82,search:_0x1aa486}=_0x5e8175,_0x410ea4=(_0x5998c1-0x1)*_0x30e9ee,_0x1c9549={};_0x44f965&&(_0x1c9549[_0x1813f2(0x1b3)]=_0x44f965['toUpperCase']());_0x3e6b38&&(_0x1c9549[_0x1813f2(0x1c7)]=_0x3e6b38[_0x1813f2(0x182)]());_0x1c9549['gateway']=_0x1c9549[_0x1813f2(0x1c7)]?_0x1c9549[_0x1813f2(0x1c7)]:{'not':_0x1813f2(0x198)};if(typeof _0x1c9549[_0x1813f2(0x1c7)]==='string'&&_0x1c9549[_0x1813f2(0x1c7)]!==_0x1813f2(0x198)){}else{if(typeof _0x1c9549[_0x1813f2(0x1c7)]==='string'&&_0x1c9549[_0x1813f2(0x1c7)]===_0x1813f2(0x198)){}else _0x1c9549['gateway']={'not':'test_gateway'};}_0x2993ee&&(_0x1c9549[_0x1813f2(0x230)]=_0x2993ee);(_0x1aa8d2||_0x327e82)&&(_0x1c9549[_0x1813f2(0x207)]={},_0x1aa8d2&&(_0x1c9549[_0x1813f2(0x207)]['gte']=new Date(_0x1aa8d2)),_0x327e82&&(_0x1c9549[_0x1813f2(0x207)][_0x1813f2(0x1d4)]=new Date(_0x327e82)));_0x1aa486&&(_0x1c9549['OR']=[{'orderId':{'contains':_0x1aa486,'mode':'insensitive'}},{'gatewayOrderId':{'contains':_0x1aa486,'mode':_0x1813f2(0x241)}},{'customerEmail':{'contains':_0x1aa486,'mode':_0x1813f2(0x241)}},{'shop':{'name':{'contains':_0x1aa486,'mode':_0x1813f2(0x241)}}},{'shop':{'username':{'contains':_0x1aa486,'mode':_0x1813f2(0x241)}}}]);const [_0x437ea7,_0x5e5007]=await Promise[_0x1813f2(0x1b4)]([database_1[_0x1813f2(0x22d)][_0x1813f2(0x1c2)][_0x1813f2(0x213)]({'where':_0x1c9549,'skip':_0x410ea4,'take':_0x30e9ee,'orderBy':{'createdAt':_0x1813f2(0x1c3)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x1813f2(0x22d)][_0x1813f2(0x1c2)][_0x1813f2(0x1f6)]({'where':_0x1c9549})]);return{'payments':_0x437ea7['map'](_0x140d07=>({'id':_0x140d07['id'],'shopId':_0x140d07['shopId'],'gateway':_0x140d07[_0x1813f2(0x1c7)],'amount':_0x140d07[_0x1813f2(0x1a6)],'currency':_0x140d07[_0x1813f2(0x251)],'status':_0x140d07[_0x1813f2(0x1b3)],'orderId':_0x140d07['orderId'],'gatewayOrderId':_0x140d07[_0x1813f2(0x1ed)],'customerEmail':_0x140d07['customerEmail'],'customerName':_0x140d07[_0x1813f2(0x224)],'customerCountry':_0x140d07['customerCountry'],'customerIp':_0x140d07[_0x1813f2(0x1d2)],'customerUa':_0x140d07[_0x1813f2(0x1cd)],'failureMessage':_0x140d07[_0x1813f2(0x248)],'createdAt':_0x140d07[_0x1813f2(0x207)],'updatedAt':_0x140d07[_0x1813f2(0x208)],'shop':_0x140d07[_0x1813f2(0x1ee)]})),'pagination':{'page':_0x5998c1,'limit':_0x30e9ee,'total':_0x5e5007,'totalPages':Math[_0x1813f2(0x1f0)](_0x5e5007/_0x30e9ee)}};}async['getPaymentById'](_0x24c63c){const _0x3c00ea=a35_0x41be8f,_0x6bf017=await database_1[_0x3c00ea(0x22d)][_0x3c00ea(0x1c2)]['findUnique']({'where':{'id':_0x24c63c},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x6bf017)return null;return{'id':_0x6bf017['id'],'shopId':_0x6bf017['shopId'],'gateway':_0x6bf017[_0x3c00ea(0x1c7)],'amount':_0x6bf017[_0x3c00ea(0x1a6)],'currency':_0x6bf017[_0x3c00ea(0x251)],'status':_0x6bf017[_0x3c00ea(0x1b3)],'orderId':_0x6bf017[_0x3c00ea(0x1ce)],'gatewayOrderId':_0x6bf017[_0x3c00ea(0x1ed)],'customerEmail':_0x6bf017[_0x3c00ea(0x18c)],'customerName':_0x6bf017[_0x3c00ea(0x224)],'customerCountry':_0x6bf017[_0x3c00ea(0x196)],'customerIp':_0x6bf017['customerIp'],'customerUa':_0x6bf017['customerUa'],'failureMessage':_0x6bf017[_0x3c00ea(0x248)],'externalPaymentUrl':_0x6bf017['externalPaymentUrl'],'successUrl':_0x6bf017[_0x3c00ea(0x1f5)],'failUrl':_0x6bf017[_0x3c00ea(0x239)],'pendingUrl':_0x6bf017['pendingUrl'],'whiteUrl':_0x6bf017[_0x3c00ea(0x190)],'createdAt':_0x6bf017['createdAt'],'updatedAt':_0x6bf017[_0x3c00ea(0x208)],'shop':_0x6bf017[_0x3c00ea(0x1ee)]};}async[a35_0x41be8f(0x222)](_0x26bffd,_0x29f73c,_0x1bf436,_0x13ae2e){const _0x56a67e=a35_0x41be8f,_0x69c691=await database_1[_0x56a67e(0x22d)]['$transaction'](async _0x5a1082=>{const _0x4ee044=_0x56a67e,_0x4f2823=await _0x5a1082[_0x4ee044(0x1c2)]['findUnique']({'where':{'id':_0x26bffd},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x4f2823)throw new Error('Payment\x20not\x20found');const _0x3b4218=_0x4f2823['status'],_0x3944cb=_0x29f73c['toUpperCase']();console[_0x4ee044(0x228)]('üîÑ\x20Admin\x20updating\x20payment\x20'+_0x26bffd+_0x4ee044(0x192)+_0x3b4218+_0x4ee044(0x1e5)+_0x3944cb),console[_0x4ee044(0x228)](_0x4ee044(0x1d8)+_0x4f2823['shop'][_0x4ee044(0x255)]+_0x4ee044(0x1dc));const _0x50d132={'status':_0x3944cb,'updatedAt':new Date(),'statusChangedBy':_0x4ee044(0x1f2),'statusChangedAt':new Date()};_0x1bf436&&(_0x50d132[_0x4ee044(0x1a3)]=_0x1bf436);_0x3944cb==='CHARGEBACK'&&_0x13ae2e&&(_0x50d132['chargebackAmount']=_0x13ae2e);let _0x403dcc=0x0,_0x1eea09=_0x4f2823[_0x4ee044(0x1ee)]['balance'];if(_0x3944cb==='PAID'&&_0x3b4218!=='PAID'){_0x50d132['paidAt']=new Date();const _0x53ebb1=await currencyService_1[_0x4ee044(0x1ec)][_0x4ee044(0x203)](_0x4f2823[_0x4ee044(0x1a6)],_0x4f2823[_0x4ee044(0x251)]);_0x50d132[_0x4ee044(0x253)]=_0x53ebb1,_0x403dcc=_0x53ebb1,_0x1eea09+=_0x53ebb1,console[_0x4ee044(0x228)](_0x4ee044(0x189)+_0x26bffd+_0x4ee044(0x1fa)+_0x53ebb1[_0x4ee044(0x1e6)](0x6)+'\x20USDT\x20to\x20balance');}else _0x3b4218===_0x4ee044(0x1db)&&_0x3944cb!==_0x4ee044(0x1db)&&(_0x4f2823['amountUSDT']&&(_0x403dcc=-_0x4f2823[_0x4ee044(0x253)],_0x1eea09-=_0x4f2823[_0x4ee044(0x253)],_0x50d132[_0x4ee044(0x253)]=null,console[_0x4ee044(0x228)]('üí∞\x20Payment\x20'+_0x26bffd+_0x4ee044(0x20c)+_0x4f2823['amountUSDT'][_0x4ee044(0x1e6)](0x6)+'\x20USDT\x20from\x20balance')));if(_0x3944cb==='CHARGEBACK'){if(_0x3b4218==='PAID'&&_0x4f2823[_0x4ee044(0x253)]){}_0x13ae2e&&_0x13ae2e>0x0&&(_0x403dcc-=_0x13ae2e,_0x1eea09-=_0x13ae2e,console[_0x4ee044(0x228)](_0x4ee044(0x188)+_0x13ae2e[_0x4ee044(0x1e6)](0x6)+'\x20USDT\x20from\x20balance'));}_0x3944cb===_0x4ee044(0x226)&&_0x3b4218==='PAID'&&console['log'](_0x4ee044(0x210));const _0x9e53a9=await _0x5a1082[_0x4ee044(0x1c2)][_0x4ee044(0x22e)]({'where':{'id':_0x26bffd},'data':_0x50d132,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x403dcc!==0x0&&(await _0x5a1082[_0x4ee044(0x1ee)][_0x4ee044(0x22e)]({'where':{'id':_0x4f2823[_0x4ee044(0x230)]},'data':{'balance':_0x1eea09}}),console[_0x4ee044(0x228)](_0x4ee044(0x18d)+_0x4f2823[_0x4ee044(0x230)]+'\x20balance\x20updated:\x20'+_0x4f2823[_0x4ee044(0x1ee)][_0x4ee044(0x255)][_0x4ee044(0x1e6)](0x6)+_0x4ee044(0x1e5)+_0x1eea09['toFixed'](0x6)+_0x4ee044(0x1ad)+(_0x403dcc>0x0?'+':'')+_0x403dcc['toFixed'](0x6)+')')),_0x9e53a9;});return{'id':_0x69c691['id'],'shopId':_0x69c691[_0x56a67e(0x230)],'gateway':_0x69c691['gateway'],'amount':_0x69c691[_0x56a67e(0x1a6)],'currency':_0x69c691[_0x56a67e(0x251)],'status':_0x69c691[_0x56a67e(0x1b3)],'orderId':_0x69c691[_0x56a67e(0x1ce)],'gatewayOrderId':_0x69c691['gatewayOrderId'],'customerEmail':_0x69c691[_0x56a67e(0x18c)],'customerName':_0x69c691[_0x56a67e(0x224)],'customerCountry':_0x69c691[_0x56a67e(0x196)],'customerIp':_0x69c691['customerIp'],'customerUa':_0x69c691['customerUa'],'failureMessage':_0x69c691['failureMessage'],'adminNotes':_0x69c691[_0x56a67e(0x1a3)],'chargebackAmount':_0x69c691['chargebackAmount'],'statusChangedBy':_0x69c691[_0x56a67e(0x1b8)],'statusChangedAt':_0x69c691[_0x56a67e(0x206)],'createdAt':_0x69c691[_0x56a67e(0x207)],'updatedAt':_0x69c691[_0x56a67e(0x208)],'shop':_0x69c691[_0x56a67e(0x1ee)]};}async['updateUser'](_0x498fa5,_0x4e7230){const _0x251597=a35_0x41be8f,_0x3add7f={..._0x4e7230};_0x4e7230[_0x251597(0x225)]&&(_0x3add7f[_0x251597(0x225)]=await bcryptjs_1[_0x251597(0x22d)]['hash'](_0x4e7230['password'],0xc));_0x4e7230['fullName']&&(_0x3add7f[_0x251597(0x1b0)]=_0x4e7230[_0x251597(0x1ef)],delete _0x3add7f[_0x251597(0x1ef)]);_0x4e7230[_0x251597(0x1e9)]&&(_0x3add7f[_0x251597(0x1ab)]=_0x4e7230[_0x251597(0x1e9)],delete _0x3add7f[_0x251597(0x1e9)]);_0x4e7230[_0x251597(0x19d)]&&(_0x3add7f[_0x251597(0x22c)]=_0x4e7230[_0x251597(0x19d)],delete _0x3add7f[_0x251597(0x19d)]);_0x4e7230[_0x251597(0x1ae)]&&(_0x3add7f['paymentGateways']=JSON[_0x251597(0x245)](_0x4e7230[_0x251597(0x1ae)]),delete _0x3add7f[_0x251597(0x1ae)]);_0x4e7230[_0x251597(0x24f)]&&(_0x3add7f[_0x251597(0x24f)]=JSON[_0x251597(0x245)](_0x4e7230[_0x251597(0x24f)]),delete _0x3add7f['gatewaySettings']);_0x4e7230['wallets']&&(_0x4e7230[_0x251597(0x1dd)][_0x251597(0x1a2)]!==undefined&&(_0x3add7f[_0x251597(0x1a2)]=_0x4e7230['wallets']['usdtPolygonWallet']||null),_0x4e7230[_0x251597(0x1dd)]['usdtTrcWallet']!==undefined&&(_0x3add7f['usdtTrcWallet']=_0x4e7230['wallets']['usdtTrcWallet']||null),_0x4e7230[_0x251597(0x1dd)][_0x251597(0x1fc)]!==undefined&&(_0x3add7f[_0x251597(0x1fc)]=_0x4e7230[_0x251597(0x1dd)][_0x251597(0x1fc)]||null),_0x4e7230[_0x251597(0x1dd)][_0x251597(0x1c5)]!==undefined&&(_0x3add7f[_0x251597(0x1c5)]=_0x4e7230['wallets'][_0x251597(0x1c5)]||null),delete _0x3add7f[_0x251597(0x1dd)]);const _0x344d50=await database_1[_0x251597(0x22d)]['shop'][_0x251597(0x22e)]({'where':{'id':_0x498fa5},'data':_0x3add7f,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x344d50['id'],'fullName':_0x344d50[_0x251597(0x1b0)],'username':_0x344d50[_0x251597(0x223)],'telegramId':_0x344d50[_0x251597(0x1ab)],'merchantUrl':_0x344d50[_0x251597(0x22c)],'gateways':_0x344d50[_0x251597(0x258)]?JSON[_0x251597(0x1e3)](_0x344d50['paymentGateways']):null,'gatewaySettings':_0x344d50[_0x251597(0x24f)]?JSON[_0x251597(0x1e3)](_0x344d50['gatewaySettings']):null,'publicKey':_0x344d50[_0x251597(0x237)],'wallets':{'usdtPolygonWallet':_0x344d50[_0x251597(0x1a2)],'usdtTrcWallet':_0x344d50[_0x251597(0x1ca)],'usdtErcWallet':_0x344d50['usdtErcWallet'],'usdcPolygonWallet':_0x344d50['usdcPolygonWallet']},'status':_0x344d50['status'],'createdAt':_0x344d50[_0x251597(0x207)]};}async['suspendUser'](_0x35a800){const _0x57237b=a35_0x41be8f,_0x19efbf=await database_1['default'][_0x57237b(0x1ee)][_0x57237b(0x22e)]({'where':{'id':_0x35a800},'data':{'status':_0x57237b(0x1fe)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x19efbf['id'],'fullName':_0x19efbf[_0x57237b(0x1b0)],'username':_0x19efbf[_0x57237b(0x223)],'telegramId':_0x19efbf['telegram'],'merchantUrl':_0x19efbf[_0x57237b(0x22c)],'gateways':_0x19efbf[_0x57237b(0x258)]?JSON[_0x57237b(0x1e3)](_0x19efbf[_0x57237b(0x258)]):null,'gatewaySettings':_0x19efbf[_0x57237b(0x24f)]?JSON[_0x57237b(0x1e3)](_0x19efbf[_0x57237b(0x24f)]):null,'publicKey':_0x19efbf[_0x57237b(0x237)],'wallets':{'usdtPolygonWallet':_0x19efbf[_0x57237b(0x1a2)],'usdtTrcWallet':_0x19efbf[_0x57237b(0x1ca)],'usdtErcWallet':_0x19efbf[_0x57237b(0x1fc)],'usdcPolygonWallet':_0x19efbf[_0x57237b(0x1c5)]},'status':_0x19efbf[_0x57237b(0x1b3)],'createdAt':_0x19efbf['createdAt']};}async[a35_0x41be8f(0x1a8)](_0x45bcf8){const _0x4376a5=a35_0x41be8f,_0x3e3540=await database_1[_0x4376a5(0x22d)][_0x4376a5(0x1ee)][_0x4376a5(0x22e)]({'where':{'id':_0x45bcf8},'data':{'status':_0x4376a5(0x1bf)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x3e3540['id'],'fullName':_0x3e3540[_0x4376a5(0x1b0)],'username':_0x3e3540[_0x4376a5(0x223)],'telegramId':_0x3e3540[_0x4376a5(0x1ab)],'merchantUrl':_0x3e3540[_0x4376a5(0x22c)],'gateways':_0x3e3540[_0x4376a5(0x258)]?JSON[_0x4376a5(0x1e3)](_0x3e3540[_0x4376a5(0x258)]):null,'gatewaySettings':_0x3e3540[_0x4376a5(0x24f)]?JSON['parse'](_0x3e3540[_0x4376a5(0x24f)]):null,'publicKey':_0x3e3540['publicKey'],'wallets':{'usdtPolygonWallet':_0x3e3540['usdtPolygonWallet'],'usdtTrcWallet':_0x3e3540['usdtTrcWallet'],'usdtErcWallet':_0x3e3540[_0x4376a5(0x1fc)],'usdcPolygonWallet':_0x3e3540[_0x4376a5(0x1c5)]},'status':_0x3e3540[_0x4376a5(0x1b3)],'createdAt':_0x3e3540[_0x4376a5(0x207)]};}async[a35_0x41be8f(0x1f7)](_0x597c7f){const _0x138a9b=a35_0x41be8f,{page:_0x25ab07,limit:_0x462484,status:_0x13df41}=_0x597c7f,_0x560f12=(_0x25ab07-0x1)*_0x462484,_0x1bb42f={};_0x13df41&&(_0x1bb42f[_0x138a9b(0x1b3)]=_0x13df41[_0x138a9b(0x23f)]());const [_0x59915a,_0x4d2203]=await Promise['all']([database_1[_0x138a9b(0x22d)][_0x138a9b(0x1ee)][_0x138a9b(0x213)]({'where':_0x1bb42f,'skip':_0x560f12,'take':_0x462484,'orderBy':{'createdAt':_0x138a9b(0x1c3)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1['default'][_0x138a9b(0x1ee)][_0x138a9b(0x1f6)]({'where':_0x1bb42f})]);return{'users':_0x59915a[_0x138a9b(0x1bc)](_0x430674=>({'id':_0x430674['id'],'fullName':_0x430674[_0x138a9b(0x1b0)],'username':_0x430674['username'],'telegramId':_0x430674['telegram'],'merchantUrl':_0x430674['shopUrl'],'gateways':_0x430674[_0x138a9b(0x258)]?JSON[_0x138a9b(0x1e3)](_0x430674[_0x138a9b(0x258)]):null,'gatewaySettings':_0x430674[_0x138a9b(0x24f)]?JSON[_0x138a9b(0x1e3)](_0x430674[_0x138a9b(0x24f)]):null,'publicKey':_0x430674['publicKey'],'wallets':{'usdtPolygonWallet':_0x430674[_0x138a9b(0x1a2)],'usdtTrcWallet':_0x430674['usdtTrcWallet'],'usdtErcWallet':_0x430674['usdtErcWallet'],'usdcPolygonWallet':_0x430674[_0x138a9b(0x1c5)]},'status':_0x430674[_0x138a9b(0x1b3)],'createdAt':_0x430674[_0x138a9b(0x207)]})),'pagination':{'page':_0x25ab07,'limit':_0x462484,'total':_0x4d2203,'totalPages':Math[_0x138a9b(0x1f0)](_0x4d2203/_0x462484)}};}async['getUserById'](_0x460563){const _0x31e428=a35_0x41be8f,_0x5d7e98=await database_1['default'][_0x31e428(0x1ee)]['findUnique']({'where':{'id':_0x460563},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x5d7e98)return null;return{'id':_0x5d7e98['id'],'fullName':_0x5d7e98[_0x31e428(0x1b0)],'username':_0x5d7e98[_0x31e428(0x223)],'telegramId':_0x5d7e98['telegram'],'merchantUrl':_0x5d7e98[_0x31e428(0x22c)],'gateways':_0x5d7e98['paymentGateways']?JSON['parse'](_0x5d7e98[_0x31e428(0x258)]):null,'gatewaySettings':_0x5d7e98[_0x31e428(0x24f)]?JSON[_0x31e428(0x1e3)](_0x5d7e98['gatewaySettings']):null,'publicKey':_0x5d7e98['publicKey'],'wallets':{'usdtPolygonWallet':_0x5d7e98[_0x31e428(0x1a2)],'usdtTrcWallet':_0x5d7e98[_0x31e428(0x1ca)],'usdtErcWallet':_0x5d7e98[_0x31e428(0x1fc)],'usdcPolygonWallet':_0x5d7e98[_0x31e428(0x1c5)]},'status':_0x5d7e98['status'],'createdAt':_0x5d7e98[_0x31e428(0x207)]};}async[a35_0x41be8f(0x19e)](_0x1cc39a){const _0x1cc7c9=a35_0x41be8f,{fullName:_0x490153,username:_0x29bedb,password:_0x5dcc45,telegramId:_0xee2f36,merchantUrl:_0x52979a,gateways:_0x1c9f1c,gatewaySettings:_0x5e6a4d,wallets:_0x4b5ca6}=_0x1cc39a,_0x126f92=await database_1[_0x1cc7c9(0x22d)][_0x1cc7c9(0x1ee)][_0x1cc7c9(0x202)]({'where':{'username':_0x29bedb}});if(_0x126f92)throw new Error('Username\x20already\x20exists');if(_0xee2f36){const _0x510110=await database_1[_0x1cc7c9(0x22d)][_0x1cc7c9(0x1ee)][_0x1cc7c9(0x202)]({'where':{'telegram':_0xee2f36}});if(_0x510110)throw new Error(_0x1cc7c9(0x191));}const _0x115f70=await bcryptjs_1[_0x1cc7c9(0x22d)][_0x1cc7c9(0x1f1)](_0x5dcc45,0xc),_0x2f3023=_0x1cc7c9(0x186)+crypto_1['default'][_0x1cc7c9(0x22a)](0x20)['toString']('hex'),_0x5818a0=_0x1cc7c9(0x254)+crypto_1['default'][_0x1cc7c9(0x22a)](0x20)['toString'](_0x1cc7c9(0x244)),_0x31cea3=await database_1['default']['shop'][_0x1cc7c9(0x219)]({'data':{'name':_0x490153,'username':_0x29bedb,'password':_0x115f70,'telegram':_0xee2f36,'shopUrl':_0x52979a,'paymentGateways':_0x1c9f1c?JSON[_0x1cc7c9(0x245)](_0x1c9f1c):null,'gatewaySettings':_0x5e6a4d?JSON['stringify'](_0x5e6a4d):null,'usdtPolygonWallet':_0x4b5ca6?.[_0x1cc7c9(0x1a2)]||null,'usdtTrcWallet':_0x4b5ca6?.[_0x1cc7c9(0x1ca)]||null,'usdtErcWallet':_0x4b5ca6?.[_0x1cc7c9(0x1fc)]||null,'usdcPolygonWallet':_0x4b5ca6?.[_0x1cc7c9(0x1c5)]||null,'publicKey':_0x2f3023,'secretKey':_0x5818a0,'status':_0x1cc7c9(0x1bf)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x31cea3['id'],'fullName':_0x31cea3[_0x1cc7c9(0x1b0)],'username':_0x31cea3[_0x1cc7c9(0x223)],'telegramId':_0x31cea3[_0x1cc7c9(0x1ab)],'merchantUrl':_0x31cea3['shopUrl'],'gateways':_0x31cea3['paymentGateways']?JSON[_0x1cc7c9(0x1e3)](_0x31cea3['paymentGateways']):null,'gatewaySettings':_0x31cea3[_0x1cc7c9(0x24f)]?JSON[_0x1cc7c9(0x1e3)](_0x31cea3[_0x1cc7c9(0x24f)]):null,'publicKey':_0x31cea3[_0x1cc7c9(0x237)],'wallets':{'usdtPolygonWallet':_0x31cea3[_0x1cc7c9(0x1a2)],'usdtTrcWallet':_0x31cea3[_0x1cc7c9(0x1ca)],'usdtErcWallet':_0x31cea3[_0x1cc7c9(0x1fc)],'usdcPolygonWallet':_0x31cea3[_0x1cc7c9(0x1c5)]},'status':_0x31cea3[_0x1cc7c9(0x1b3)],'createdAt':_0x31cea3[_0x1cc7c9(0x207)]};}async[a35_0x41be8f(0x1b7)](_0x20293d){const _0x7f1cd3=a35_0x41be8f;await database_1[_0x7f1cd3(0x22d)][_0x7f1cd3(0x1ee)][_0x7f1cd3(0x23d)]({'where':{'id':_0x20293d}});}}exports[a35_0x41be8f(0x1ac)]=AdminService;