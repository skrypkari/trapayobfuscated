'use strict';const a33_0x2ca144=a33_0x561d;(function(_0xd2a45a,_0x22f8ed){const _0x251469=a33_0x561d,_0x307c49=_0xd2a45a();while(!![]){try{const _0x502342=-parseInt(_0x251469(0x216))/0x1*(-parseInt(_0x251469(0x1a0))/0x2)+-parseInt(_0x251469(0x254))/0x3+-parseInt(_0x251469(0x1fa))/0x4*(-parseInt(_0x251469(0x1ed))/0x5)+-parseInt(_0x251469(0x257))/0x6+parseInt(_0x251469(0x241))/0x7+parseInt(_0x251469(0x263))/0x8*(parseInt(_0x251469(0x1ad))/0x9)+-parseInt(_0x251469(0x220))/0xa*(parseInt(_0x251469(0x1c7))/0xb);if(_0x502342===_0x22f8ed)break;else _0x307c49['push'](_0x307c49['shift']());}catch(_0xfd037a){_0x307c49['push'](_0x307c49['shift']());}}}(a33_0xfad6,0x901af));var __importDefault=this&&this[a33_0x2ca144(0x25c)]||function(_0x43531f){const _0x136c17=a33_0x2ca144;return _0x43531f&&_0x43531f[_0x136c17(0x1f1)]?_0x43531f:{'default':_0x43531f};};function a33_0x561d(_0x7668cc,_0x176555){const _0xfad6b0=a33_0xfad6();return a33_0x561d=function(_0x561ddb,_0x2917e1){_0x561ddb=_0x561ddb-0x195;let _0x310dd3=_0xfad6b0[_0x561ddb];return _0x310dd3;},a33_0x561d(_0x7668cc,_0x176555);}Object[a33_0x2ca144(0x1b9)](exports,'__esModule',{'value':!![]}),exports['AdminService']=void 0x0;const database_1=__importDefault(require(a33_0x2ca144(0x196))),currencyService_1=require(a33_0x2ca144(0x1d2)),userService_1=require('./userService'),telegramBotService_1=require('./telegramBotService'),gateway_1=require(a33_0x2ca144(0x21f));function a33_0xfad6(){const _0x2d1aad=['Invalid\x20status.\x20Valid\x20statuses:\x20','amountUSDT','isEligibleForPayout','stringify','📋\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','shopUrl','usdtErcWallet','error','gatewayPaymentId','paymentGateways','calculateEffectiveAmount','getSystemStatistics','📊\x20Calculating\x20admin\x20payout\x20statistics...','✅\x20Payout\x20created\x20successfully:\x20','\x20USDT\x20after\x20commission)','\x20USDT','username','57016ttGjyS','date','\x20eligible\x20PAID\x20payments\x20for\x20payout\x20analysis','count','paymentMethod','User\x20not\x20found','✅\x20Found\x20payout:\x20','\x20payouts\x20out\x20of\x20','🔍\x20Getting\x20payment\x20by\x20ID:\x20','../types/gateway','10ktnAsg','Chargeback\x20amount\x20is\x20required\x20and\x20must\x20be\x20positive\x20(amount\x20in\x20USDT)','CHARGEBACK','updatedAt','✅\x20User\x20','get','parse','FAILED','gte','\x20to\x20','webhookLog','getUserById','💸\x20Chargeback\x20amount:\x20','🏪\x20Found\x20','orderId','merchantPaid','\x20payments\x20for\x20analysis\x20(PAID/REFUND/CHARGEBACK)','\x20days)','reduce','UserService','setDate','amount','generateDateRange','getAllPayments','default','getGatewayNameById','lte','usdcPolygonWallet','from','remitterIban','log','asc','\x20suspended\x20successfully','6077575NUPvSj','shopId','amountAfterCommissionUSDT','PAID','\x20USDT\x20(','🚫\x20Suspending\x20user:\x20','📊\x20Generating\x20admin\x20statistics\x20for\x20period:\x20','💰\x20Total\x20amount:\x20','expiresAt','toISOString','👥\x20Total\x20users:\x20','getPayoutStats','externalPaymentUrl','\x20USDT\x20(включая\x20штрафы\x20chargeback)','getGatewaySettings','createdAt','round','telegramBotService','totalAmountUSDT','2346852QWNQam','thisMonth','includes','1386534owqCwK','split','updateUser','getAllPayouts','remitterName','__importDefault','customerName','getAllUsers','abs','payment','userService','Shop\x20not\x20found','4563376IEisRk','insensitive','usage','AdminService','\x20USDT\x20via\x20','statusChangedAt','chargebackAmount','convertToUSDT','SUSPENDED','sourceCurrency','🔍\x20Getting\x20payout\x20by\x20ID:\x20','toLowerCase','commission','totalAmountAfterCommissionUSDT','📅\x20This\x20Month:\x20','deletePayout','../config/database','admin','🔄\x20Marking\x20payments\x20as\x20paid\x20out\x20for\x20shop\x20','name','\x20merchants\x20out\x20of\x20','status','\x20merchants\x20with\x20eligible\x20PAID\x20payments','\x20status\x20to:\x20','\x20total','suspendUser','30USASYW','📊\x20Daily\x20revenue\x20entries:\x20','gateway','cardLast4',',\x20amount:\x20','📈\x20Average\x20payment:\x20','currencyService','shop','slice','💰\x20Available\x20Balance:\x20','🗑️\x20Deleting\x20payout:\x20','updatePaymentStatus','has','9UlpBew','getPeriodDays','sort','Payout\x20not\x20found','size','paidAt','📅\x20Processing\x20daily\x20stats\x20for\x20','ACTIVE','calculateAmountAfterCommission','markPaymentsAsPaidOut','📊\x20Found\x20','\x20deleted\x20successfully','defineProperty','💳\x20Total\x20payments:\x20','gatewayOrderId','network','✅\x20Returning\x20','\x20status\x20updated\x20from\x20','🔄\x20Admin\x20updating\x20payment\x20','notes','💸\x20Total\x20Payout:\x20','User\x20is\x20already\x20suspended','Error\x20parsing\x20gateway\x20settings:','payments','bankId','findMany','16076357ktNCjU','adminNotes','statusChangedBy','createUser','webhookLogs','telegram','createPayout','💰\x20Found\x20','toUpperCase','payout','📋\x20Getting\x20payments\x20with\x20filters:','./currencyService','💸\x20Creating\x20payout\x20for\x20shop\x20','✅\x20Found\x20payment:\x20','✅\x20Admin\x20statistics\x20generated\x20successfully','✅\x20Marked\x20','map','txid','📋\x20Getting\x20users\x20with\x20filters:','getPayoutById','✅\x20Payout\x20','getFullYear','set','desc','❌\x20Payout\x20not\x20found:\x20','all','\x20users\x20out\x20of\x20','getPaymentById','getMonth','customerEmail','isValidGatewayId','currency','\x20days','✅\x20Payment\x20','create','toFixed','findUnique','deleteUser','4995bguVsW','getDate','\x20payments\x20as\x20paid\x20out','update','__esModule','sendPayoutNotification','Failed\x20to\x20send\x20Telegram\x20payout\x20notification:','ceil','updateMany','REFUND','⏳\x20Awaiting\x20Payout:\x20','📋\x20Getting\x20payouts\x20with\x20filters:','payoutDelay','3088xiExWY','usdtTrcWallet','totalPayout','length','delete','push','activateUser','PENDING','✅\x20Activating\x20user:\x20','❌\x20Payment\x20not\x20found:\x20','gatewaySettings'];a33_0xfad6=function(){return _0x2d1aad;};return a33_0xfad6();}class AdminService{constructor(){const _0x3cccec=a33_0x2ca144;this['userService']=new userService_1[(_0x3cccec(0x233))]();}[a33_0x2ca144(0x1ae)](_0x22aae3){switch(_0x22aae3){case'7d':return 0x7;case'30d':return 0x1e;case'90d':return 0x5a;case'1y':return 0x16d;default:return 0x1e;}}[a33_0x2ca144(0x236)](_0x52bd30,_0x41d6e9){const _0x4456ca=a33_0x2ca144,_0x313d6a=[],_0x4c0b74=new Date(_0x52bd30);while(_0x4c0b74<=_0x41d6e9){_0x313d6a[_0x4456ca(0x1ff)](_0x4c0b74[_0x4456ca(0x24a)]()[_0x4456ca(0x258)]('T')[0x0]),_0x4c0b74[_0x4456ca(0x234)](_0x4c0b74['getDate']()+0x1);}return _0x313d6a;}[a33_0x2ca144(0x24f)](_0x317ba9,_0xaa0724){const _0x210864=a33_0x2ca144;if(!_0x317ba9['gatewaySettings'])return{'commission':0x0,'payoutDelay':0x0};try{const _0x5c7d3f=JSON[_0x210864(0x226)](_0x317ba9[_0x210864(0x204)]),_0xf3a4f0=_0xaa0724['charAt'](0x0)[_0x210864(0x1cf)]()+_0xaa0724['slice'](0x1)['toLowerCase']();if(_0x5c7d3f&&_0x5c7d3f[_0xf3a4f0])return{'commission':_0x5c7d3f[_0xf3a4f0][_0x210864(0x26f)]||0x0,'payoutDelay':_0x5c7d3f[_0xf3a4f0]['payoutDelay']||0x0};}catch(_0x486ef7){console['error'](_0x210864(0x1c3),_0x486ef7);}return{'commission':0x0,'payoutDelay':0x0};}[a33_0x2ca144(0x207)](_0x3c9147){const _0x48f496=a33_0x2ca144;if(_0x3c9147[_0x48f496(0x19b)]!==_0x48f496(0x244)||_0x3c9147[_0x48f496(0x22f)]||!_0x3c9147[_0x48f496(0x1b2)])return![];const _0x43ecc7=this[_0x48f496(0x24f)](_0x3c9147[_0x48f496(0x1a7)],_0x3c9147[_0x48f496(0x1a2)]),_0x2a8471=_0x43ecc7[_0x48f496(0x1f9)]*0x18*0x3c*0x3c*0x3e8,_0x2fca55=new Date(_0x3c9147[_0x48f496(0x1b2)]['getTime']()+_0x2a8471);return new Date()>_0x2fca55;}[a33_0x2ca144(0x1b5)](_0x5195e2,_0x4e6205){return _0x5195e2*(0x1-_0x4e6205/0x64);}[a33_0x2ca144(0x20f)](_0x4ad024){const _0xccd793=a33_0x2ca144;switch(_0x4ad024[_0xccd793(0x19b)]){case'PAID':return _0x4ad024[_0xccd793(0x235)];case _0xccd793(0x222):return-(_0x4ad024[_0xccd793(0x269)]||0x0);case _0xccd793(0x1f6):return 0x0;default:return 0x0;}}async[a33_0x2ca144(0x1cd)](_0x275005){const _0x22628e=a33_0x2ca144,{shopId:_0x16c6de,amount:_0x45b173,network:_0x1fab7d,notes:_0x9d0a0b}=_0x275005;console[_0x22628e(0x23e)](_0x22628e(0x1d3)+_0x16c6de+':\x20'+_0x45b173+_0x22628e(0x267)+_0x1fab7d);const _0xddc5b8=await database_1[_0x22628e(0x238)][_0x22628e(0x1a7)]['findUnique']({'where':{'id':_0x16c6de},'select':{'id':!![],'name':!![],'username':!![],'status':!![]}});if(!_0xddc5b8)throw new Error(_0x22628e(0x262));if(_0xddc5b8[_0x22628e(0x19b)]!==_0x22628e(0x1b4))throw new Error('Shop\x20is\x20not\x20active');const _0x24e9cf=await database_1['default'][_0x22628e(0x1d0)][_0x22628e(0x1e9)]({'data':{'shopId':_0x16c6de,'amount':_0x45b173,'network':_0x1fab7d,'status':'COMPLETED','notes':_0x9d0a0b||null,'paidAt':new Date()},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});await this[_0x22628e(0x1b6)](_0x16c6de,_0x45b173);try{await telegramBotService_1[_0x22628e(0x252)][_0x22628e(0x1f2)](_0x16c6de,_0x24e9cf,'completed');}catch(_0x1ff83b){console[_0x22628e(0x20c)](_0x22628e(0x1f3),_0x1ff83b);}return console[_0x22628e(0x23e)](_0x22628e(0x212)+_0x24e9cf['id']),{'id':_0x24e9cf['id'],'shopId':_0x24e9cf['shopId'],'shopName':_0x24e9cf[_0x22628e(0x1a7)][_0x22628e(0x199)],'shopUsername':_0x24e9cf[_0x22628e(0x1a7)][_0x22628e(0x215)],'amount':_0x24e9cf[_0x22628e(0x235)],'network':_0x24e9cf[_0x22628e(0x1bc)],'status':_0x24e9cf[_0x22628e(0x19b)],'txid':_0x24e9cf['txid'],'notes':_0x24e9cf[_0x22628e(0x1c0)],'createdAt':_0x24e9cf['createdAt'],'paidAt':_0x24e9cf[_0x22628e(0x1b2)]};}async['markPaymentsAsPaidOut'](_0x37da52,_0x2a0287){const _0x35637b=a33_0x2ca144;console[_0x35637b(0x23e)](_0x35637b(0x198)+_0x37da52+_0x35637b(0x1a4)+_0x2a0287+'\x20USDT');const _0x58c15=await database_1['default'][_0x35637b(0x260)][_0x35637b(0x1c6)]({'where':{'shopId':_0x37da52,'status':_0x35637b(0x244),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'shop':{'select':{'gatewaySettings':!![]}}},'orderBy':{'paidAt':_0x35637b(0x23f)}});let _0x2ae122=_0x2a0287;const _0x50a614=[];for(const _0x376764 of _0x58c15){const _0x5b7633={..._0x376764,'status':_0x35637b(0x244),'merchantPaid':![],'shop':{'gatewaySettings':_0x376764[_0x35637b(0x1a7)][_0x35637b(0x204)]}};if(!this[_0x35637b(0x207)](_0x5b7633))continue;const _0x30376f=await currencyService_1[_0x35637b(0x1a6)][_0x35637b(0x26a)](_0x376764[_0x35637b(0x235)],_0x376764['currency']),_0xabfc1c=this[_0x35637b(0x24f)](_0x376764[_0x35637b(0x1a7)],_0x376764[_0x35637b(0x1a2)]),_0x37ec3c=this[_0x35637b(0x1b5)](_0x30376f,_0xabfc1c['commission']);if(_0x37ec3c<=_0x2ae122){_0x50a614[_0x35637b(0x1ff)](_0x376764['id']),_0x2ae122-=_0x37ec3c;if(_0x2ae122<=0.01)break;}}_0x50a614[_0x35637b(0x1fd)]>0x0&&(await database_1[_0x35637b(0x238)][_0x35637b(0x260)][_0x35637b(0x1f5)]({'where':{'id':{'in':_0x50a614}},'data':{'merchantPaid':!![]}}),console[_0x35637b(0x23e)](_0x35637b(0x1d6)+_0x50a614[_0x35637b(0x1fd)]+_0x35637b(0x1ef)));}async[a33_0x2ca144(0x25a)](_0x2897db){const _0x3ae0f0=a33_0x2ca144,{page:_0x5a1d75,limit:_0x1c320d,shopId:_0x16d370,network:_0x537b95,dateFrom:_0x4ee175,dateTo:_0x311857,search:_0x2b1b66}=_0x2897db,_0x249c0a=(_0x5a1d75-0x1)*_0x1c320d;console[_0x3ae0f0(0x23e)](_0x3ae0f0(0x1f8),_0x2897db);const _0x10efbe={};_0x16d370&&(_0x10efbe[_0x3ae0f0(0x242)]=_0x16d370);_0x537b95&&(_0x10efbe[_0x3ae0f0(0x1bc)]=_0x537b95);(_0x4ee175||_0x311857)&&(_0x10efbe[_0x3ae0f0(0x250)]={},_0x4ee175&&(_0x10efbe[_0x3ae0f0(0x250)][_0x3ae0f0(0x228)]=new Date(_0x4ee175)),_0x311857&&(_0x10efbe['createdAt'][_0x3ae0f0(0x23a)]=new Date(_0x311857)));_0x2b1b66&&(_0x10efbe['OR']=[{'txid':{'contains':_0x2b1b66,'mode':_0x3ae0f0(0x264)}},{'notes':{'contains':_0x2b1b66,'mode':_0x3ae0f0(0x264)}},{'shop':{'name':{'contains':_0x2b1b66,'mode':_0x3ae0f0(0x264)}}},{'shop':{'username':{'contains':_0x2b1b66,'mode':_0x3ae0f0(0x264)}}}]);const [_0x75ea20,_0x26e59f]=await Promise[_0x3ae0f0(0x1e0)]([database_1[_0x3ae0f0(0x238)][_0x3ae0f0(0x1d0)]['findMany']({'where':_0x10efbe,'skip':_0x249c0a,'take':_0x1c320d,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x3ae0f0(0x238)][_0x3ae0f0(0x1d0)][_0x3ae0f0(0x219)]({'where':_0x10efbe})]);console['log'](_0x3ae0f0(0x1b7)+_0x75ea20[_0x3ae0f0(0x1fd)]+_0x3ae0f0(0x21d)+_0x26e59f+_0x3ae0f0(0x19e));const _0x23365c=_0x75ea20[_0x3ae0f0(0x1d7)](_0x26250c=>({'id':_0x26250c['id'],'shopId':_0x26250c[_0x3ae0f0(0x242)],'shopName':_0x26250c[_0x3ae0f0(0x1a7)]['name'],'shopUsername':_0x26250c[_0x3ae0f0(0x1a7)]['username'],'amount':_0x26250c[_0x3ae0f0(0x235)],'network':_0x26250c['network'],'status':_0x26250c['status'],'txid':_0x26250c['txid'],'notes':_0x26250c[_0x3ae0f0(0x1c0)],'createdAt':_0x26250c['createdAt'],'paidAt':_0x26250c[_0x3ae0f0(0x1b2)]}));return{'payouts':_0x23365c,'pagination':{'page':_0x5a1d75,'limit':_0x1c320d,'total':_0x26e59f,'totalPages':Math[_0x3ae0f0(0x1f4)](_0x26e59f/_0x1c320d)}};}async[a33_0x2ca144(0x1da)](_0x2aa3d2){const _0x5dde7a=a33_0x2ca144;console[_0x5dde7a(0x23e)](_0x5dde7a(0x26d)+_0x2aa3d2);const _0x2105c9=await database_1[_0x5dde7a(0x238)][_0x5dde7a(0x1d0)]['findUnique']({'where':{'id':_0x2aa3d2},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x2105c9)return console[_0x5dde7a(0x23e)](_0x5dde7a(0x1df)+_0x2aa3d2),null;return console[_0x5dde7a(0x23e)](_0x5dde7a(0x21c)+_0x2105c9[_0x5dde7a(0x235)]+'\x20USDT\x20via\x20'+_0x2105c9[_0x5dde7a(0x1bc)]),{'id':_0x2105c9['id'],'shopId':_0x2105c9[_0x5dde7a(0x242)],'shopName':_0x2105c9[_0x5dde7a(0x1a7)]['name'],'shopUsername':_0x2105c9[_0x5dde7a(0x1a7)][_0x5dde7a(0x215)],'amount':_0x2105c9[_0x5dde7a(0x235)],'network':_0x2105c9['network'],'status':_0x2105c9[_0x5dde7a(0x19b)],'txid':_0x2105c9[_0x5dde7a(0x1d8)],'notes':_0x2105c9['notes'],'createdAt':_0x2105c9[_0x5dde7a(0x250)],'paidAt':_0x2105c9['paidAt']};}async[a33_0x2ca144(0x195)](_0x682a10){const _0x5baa6e=a33_0x2ca144;console['log'](_0x5baa6e(0x1aa)+_0x682a10);const _0x26dce4=await database_1[_0x5baa6e(0x238)][_0x5baa6e(0x1d0)][_0x5baa6e(0x1eb)]({'where':{'id':_0x682a10},'select':{'id':!![],'shopId':!![],'amount':!![]}});if(!_0x26dce4)throw new Error(_0x5baa6e(0x1b0));await database_1[_0x5baa6e(0x238)][_0x5baa6e(0x1d0)][_0x5baa6e(0x1fe)]({'where':{'id':_0x682a10}}),console['log'](_0x5baa6e(0x1db)+_0x682a10+_0x5baa6e(0x1b8));}async['getMerchantsAwaitingPayout'](_0xf3b1bb){const _0x4b4882=a33_0x2ca144,{page:_0x3bbdef,limit:_0x500023,minAmount:_0x89f5d9,search:_0x16fdf2}=_0xf3b1bb;console[_0x4b4882(0x23e)](_0x4b4882(0x209),_0xf3b1bb);const _0x511aee=await database_1[_0x4b4882(0x238)]['payment'][_0x4b4882(0x1c6)]({'where':{'status':_0x4b4882(0x244),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'createdAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'gatewaySettings':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}});console['log'](_0x4b4882(0x1ce)+_0x511aee[_0x4b4882(0x1fd)]+_0x4b4882(0x218));const _0x26b650=new Map();for(const _0x2ccc4f of _0x511aee){const _0x206d18={..._0x2ccc4f,'status':_0x4b4882(0x244),'merchantPaid':![],'shop':{'gatewaySettings':_0x2ccc4f[_0x4b4882(0x1a7)][_0x4b4882(0x204)]}},_0xfae97d=this[_0x4b4882(0x207)](_0x206d18);if(!_0xfae97d)continue;const _0x5794f1=await currencyService_1[_0x4b4882(0x1a6)][_0x4b4882(0x26a)](_0x2ccc4f[_0x4b4882(0x235)],_0x2ccc4f[_0x4b4882(0x1e6)]),_0x5c22a4=this[_0x4b4882(0x24f)](_0x2ccc4f[_0x4b4882(0x1a7)],_0x2ccc4f['gateway']),_0x32fb74=this['calculateAmountAfterCommission'](_0x5794f1,_0x5c22a4[_0x4b4882(0x26f)]),_0x1bcdc7=_0x2ccc4f[_0x4b4882(0x242)];!_0x26b650['has'](_0x1bcdc7)&&_0x26b650['set'](_0x1bcdc7,{'shop':_0x2ccc4f[_0x4b4882(0x1a7)],'payments':[]}),_0x26b650[_0x4b4882(0x225)](_0x1bcdc7)[_0x4b4882(0x1c4)]['push']({'id':_0x2ccc4f['id'],'amount':_0x2ccc4f[_0x4b4882(0x235)],'currency':_0x2ccc4f[_0x4b4882(0x1e6)],'gateway':_0x2ccc4f[_0x4b4882(0x1a2)],'paidAt':_0x2ccc4f['paidAt'],'createdAt':_0x2ccc4f[_0x4b4882(0x250)],'amountUSDT':_0x5794f1,'commission':_0x5c22a4[_0x4b4882(0x26f)],'amountAfterCommissionUSDT':_0x32fb74,'isEligible':!![]});}console[_0x4b4882(0x23e)](_0x4b4882(0x22d)+_0x26b650[_0x4b4882(0x1b1)]+_0x4b4882(0x19c));const _0x103899=[];for(const [_0x533bed,_0x22d8ee]of _0x26b650){const {shop:_0x21c913,payments:_0x57ca6c}=_0x22d8ee,_0x303adf=_0x57ca6c['reduce']((_0x35ceee,_0x276e10)=>_0x35ceee+_0x276e10[_0x4b4882(0x206)],0x0),_0x464f8d=_0x57ca6c[_0x4b4882(0x232)]((_0x1e1aa4,_0x4a8495)=>_0x1e1aa4+_0x4a8495[_0x4b4882(0x243)],0x0);if(_0x89f5d9&&_0x464f8d<_0x89f5d9)continue;if(_0x16fdf2){const _0x4ec43f=_0x16fdf2['toLowerCase'](),_0x267af7=_0x21c913['name']['toLowerCase']()[_0x4b4882(0x256)](_0x4ec43f)||_0x21c913['username'][_0x4b4882(0x26e)]()[_0x4b4882(0x256)](_0x4ec43f)||_0x21c913[_0x4b4882(0x1cc)]&&_0x21c913['telegram'][_0x4b4882(0x26e)]()['includes'](_0x4ec43f);if(!_0x267af7)continue;}const _0x2603e4=new Map();for(const _0x10bfb6 of _0x57ca6c){const _0xd0a245=_0x10bfb6['gateway'];!_0x2603e4[_0x4b4882(0x1ac)](_0xd0a245)&&_0x2603e4[_0x4b4882(0x1dd)](_0xd0a245,{'count':0x0,'amountUSDT':0x0,'amountAfterCommissionUSDT':0x0,'commission':_0x10bfb6[_0x4b4882(0x26f)]});const _0x84f17=_0x2603e4[_0x4b4882(0x225)](_0xd0a245);_0x84f17[_0x4b4882(0x219)]++,_0x84f17[_0x4b4882(0x206)]+=_0x10bfb6[_0x4b4882(0x206)],_0x84f17[_0x4b4882(0x243)]+=_0x10bfb6[_0x4b4882(0x243)];}const _0x41f4a3=Array[_0x4b4882(0x23c)](_0x2603e4['entries']())['map'](([_0x1d094c,_0xc816de])=>({'gateway':_0x1d094c['charAt'](0x0)[_0x4b4882(0x1cf)]()+_0x1d094c['slice'](0x1),'count':_0xc816de[_0x4b4882(0x219)],'amountUSDT':Math[_0x4b4882(0x251)](_0xc816de[_0x4b4882(0x206)]*0x64)/0x64,'amountAfterCommissionUSDT':Math['round'](_0xc816de[_0x4b4882(0x243)]*0x64)/0x64,'commission':_0xc816de[_0x4b4882(0x26f)]})),_0x56df29=_0x57ca6c['reduce']((_0x156d7e,_0x47ba79)=>{const _0x23c6bf=_0x4b4882;return _0x47ba79['paidAt']<_0x156d7e?_0x47ba79[_0x23c6bf(0x1b2)]:_0x156d7e;},_0x57ca6c[0x0]['paidAt']);_0x103899[_0x4b4882(0x1ff)]({'id':_0x21c913['id'],'fullName':_0x21c913[_0x4b4882(0x199)],'username':_0x21c913['username'],'telegramId':_0x21c913[_0x4b4882(0x1cc)],'merchantUrl':_0x21c913['shopUrl'],'wallets':{'usdtPolygonWallet':_0x21c913['usdtPolygonWallet'],'usdtTrcWallet':_0x21c913[_0x4b4882(0x1fb)],'usdtErcWallet':_0x21c913[_0x4b4882(0x20b)],'usdcPolygonWallet':_0x21c913[_0x4b4882(0x23b)]},'totalAmountUSDT':Math['round'](_0x303adf*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x4b4882(0x251)](_0x464f8d*0x64)/0x64,'paymentsCount':_0x57ca6c['length'],'oldestPaymentDate':_0x56df29,'gatewayBreakdown':_0x41f4a3});}_0x103899[_0x4b4882(0x1af)]((_0xfd8906,_0xbb9396)=>_0xbb9396[_0x4b4882(0x270)]-_0xfd8906[_0x4b4882(0x270)]);const _0x5b66fe=_0x103899[_0x4b4882(0x1fd)],_0x254fcf=_0x103899[_0x4b4882(0x232)]((_0x1ef810,_0x57d9c0)=>_0x1ef810+_0x57d9c0[_0x4b4882(0x253)],0x0),_0x2fb324=_0x103899[_0x4b4882(0x232)]((_0x93ace5,_0x476af0)=>_0x93ace5+_0x476af0[_0x4b4882(0x270)],0x0),_0x216620=(_0x3bbdef-0x1)*_0x500023,_0x3d37f3=_0x103899[_0x4b4882(0x1a8)](_0x216620,_0x216620+_0x500023);return console[_0x4b4882(0x23e)](_0x4b4882(0x1bd)+_0x3d37f3['length']+_0x4b4882(0x19a)+_0x5b66fe+_0x4b4882(0x19e)),console['log'](_0x4b4882(0x248)+_0x254fcf[_0x4b4882(0x1ea)](0x2)+_0x4b4882(0x245)+_0x2fb324[_0x4b4882(0x1ea)](0x2)+_0x4b4882(0x213)),{'merchants':_0x3d37f3,'pagination':{'page':_0x3bbdef,'limit':_0x500023,'total':_0x5b66fe,'totalPages':Math['ceil'](_0x5b66fe/_0x500023)},'summary':{'totalMerchants':_0x5b66fe,'totalAmountUSDT':Math[_0x4b4882(0x251)](_0x254fcf*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x4b4882(0x251)](_0x2fb324*0x64)/0x64}};}async[a33_0x2ca144(0x24c)](){const _0x16fb48=a33_0x2ca144;console[_0x16fb48(0x23e)](_0x16fb48(0x211));const _0x1e0356=await database_1[_0x16fb48(0x238)][_0x16fb48(0x260)]['findMany']({'where':{'status':{'in':[_0x16fb48(0x244),_0x16fb48(0x1f6),_0x16fb48(0x222)]}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'status':!![],'gateway':!![],'paidAt':!![],'merchantPaid':!![],'createdAt':!![],'chargebackAmount':!![],'shop':{'select':{'gatewaySettings':!![]}}}});console[_0x16fb48(0x23e)](_0x16fb48(0x1ce)+_0x1e0356[_0x16fb48(0x1fd)]+_0x16fb48(0x230));const _0x4cc736=new Date(),_0x14ff4d=new Date(_0x4cc736[_0x16fb48(0x1dc)](),_0x4cc736[_0x16fb48(0x1e3)](),0x1),_0x4525df=new Date(_0x4cc736['getFullYear'](),_0x4cc736['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7);let _0x4f3589=0x0,_0x5b466f=0x0,_0x1dd3f9=0x0,_0x86977c=0x0;for(const _0x137d6b of _0x1e0356){const _0x520f1d=this['calculateEffectiveAmount'](_0x137d6b);if(_0x520f1d===0x0)continue;let _0x30d7c8,_0x53dd3d;if(_0x137d6b[_0x16fb48(0x19b)]===_0x16fb48(0x222))_0x30d7c8=Math['abs'](_0x520f1d),_0x53dd3d=-_0x30d7c8;else{_0x30d7c8=await currencyService_1['currencyService'][_0x16fb48(0x26a)](_0x137d6b[_0x16fb48(0x235)],_0x137d6b[_0x16fb48(0x1e6)]);const _0x6c4aff=this[_0x16fb48(0x24f)](_0x137d6b['shop'],_0x137d6b[_0x16fb48(0x1a2)]);_0x53dd3d=this[_0x16fb48(0x1b5)](_0x30d7c8,_0x6c4aff[_0x16fb48(0x26f)]);}_0x137d6b[_0x16fb48(0x22f)]&&(_0x4f3589+=_0x53dd3d,_0x137d6b[_0x16fb48(0x1b2)]&&_0x137d6b[_0x16fb48(0x1b2)]>=_0x14ff4d&&_0x137d6b[_0x16fb48(0x1b2)]<=_0x4525df&&(_0x1dd3f9+=_0x53dd3d)),_0x137d6b[_0x16fb48(0x19b)]==='PAID'&&this[_0x16fb48(0x207)](_0x137d6b)&&(_0x5b466f+=_0x53dd3d,_0x86977c+=_0x30d7c8);}const _0x4619c6={'totalPayout':Math[_0x16fb48(0x251)](_0x4f3589*0x64)/0x64,'awaitingPayout':Math['round'](_0x5b466f*0x64)/0x64,'thisMonth':Math[_0x16fb48(0x251)](_0x1dd3f9*0x64)/0x64,'availableBalance':Math[_0x16fb48(0x251)](_0x86977c*0x64)/0x64};return console[_0x16fb48(0x23e)]('✅\x20Payout\x20statistics\x20calculated:'),console[_0x16fb48(0x23e)](_0x16fb48(0x1c1)+_0x4619c6[_0x16fb48(0x1fc)]+_0x16fb48(0x24e)),console[_0x16fb48(0x23e)](_0x16fb48(0x1f7)+_0x4619c6['awaitingPayout']+'\x20USDT\x20(только\x20PAID\x20платежи)'),console[_0x16fb48(0x23e)](_0x16fb48(0x271)+_0x4619c6[_0x16fb48(0x255)]+_0x16fb48(0x214)),console[_0x16fb48(0x23e)](_0x16fb48(0x1a9)+_0x4619c6['availableBalance']+_0x16fb48(0x214)),_0x4619c6;}async[a33_0x2ca144(0x210)](_0x3897be){const _0x67b3c5=a33_0x2ca144,_0x1e177d=this['getPeriodDays'](_0x3897be),_0x5d5547=new Date();_0x5d5547[_0x67b3c5(0x234)](_0x5d5547[_0x67b3c5(0x1ee)]()-_0x1e177d),console[_0x67b3c5(0x23e)](_0x67b3c5(0x247)+_0x3897be+'\x20('+_0x1e177d+_0x67b3c5(0x231));const _0x252538=await database_1[_0x67b3c5(0x238)][_0x67b3c5(0x1a7)][_0x67b3c5(0x219)]({'where':{'status':_0x67b3c5(0x1b4)}}),_0x1b9eca=await database_1[_0x67b3c5(0x238)][_0x67b3c5(0x260)][_0x67b3c5(0x219)](),_0x24c6f0=await database_1['default'][_0x67b3c5(0x260)][_0x67b3c5(0x1c6)]({'where':{'status':{'in':[_0x67b3c5(0x244),_0x67b3c5(0x1f6),_0x67b3c5(0x222)]}},'select':{'amount':!![],'currency':!![],'status':!![],'chargebackAmount':!![],'createdAt':!![]}});console[_0x67b3c5(0x23e)]('💰\x20Found\x20'+_0x24c6f0[_0x67b3c5(0x1fd)]+'\x20payments\x20for\x20revenue\x20calculation\x20(PAID/REFUND/CHARGEBACK)');const _0x3753f3=await Promise[_0x67b3c5(0x1e0)](_0x24c6f0[_0x67b3c5(0x1d7)](async _0x31b50d=>{const _0x12db83=_0x67b3c5,_0x1a1bf6=this['calculateEffectiveAmount'](_0x31b50d);if(_0x1a1bf6===0x0)return{'amount':0x0,'createdAt':_0x31b50d['createdAt']};let _0x2cb7cc;return _0x31b50d[_0x12db83(0x19b)]==='CHARGEBACK'?_0x2cb7cc=-Math['abs'](_0x1a1bf6):_0x2cb7cc=await currencyService_1['currencyService'][_0x12db83(0x26a)](_0x31b50d[_0x12db83(0x235)],_0x31b50d[_0x12db83(0x1e6)]),{'amount':_0x2cb7cc,'createdAt':_0x31b50d[_0x12db83(0x250)]};})),_0x421c70=_0x3753f3['reduce']((_0xba1086,_0x58b93)=>_0xba1086+_0x58b93[_0x67b3c5(0x235)],0x0),_0x2b41ad=_0x1b9eca>0x0?_0x421c70/_0x1b9eca:0x0;console[_0x67b3c5(0x23e)]('💵\x20Total\x20revenue:\x20'+_0x421c70[_0x67b3c5(0x1ea)](0x2)+_0x67b3c5(0x24e)),console[_0x67b3c5(0x23e)](_0x67b3c5(0x1a5)+_0x2b41ad[_0x67b3c5(0x1ea)](0x2)+_0x67b3c5(0x214));const _0x39e7ee=await database_1[_0x67b3c5(0x238)]['$queryRaw']`
      SELECT 
        DATE(created_at) as date,
        array_agg(
          json_build_object(
            'amount', amount,
            'currency', currency,
            'status', status,
            'chargeback_amount', chargeback_amount
          )
        ) as payments
      FROM payments 
      WHERE created_at >= ${_0x5d5547}
        AND status IN ('PAID', 'REFUND', 'CHARGEBACK')
      GROUP BY DATE(created_at)
      ORDER BY date ASC
    `;console['log'](_0x67b3c5(0x1b3)+_0x39e7ee[_0x67b3c5(0x1fd)]+_0x67b3c5(0x1e7));const _0x439dfe=await Promise['all'](_0x39e7ee[_0x67b3c5(0x1d7)](async _0x315401=>{const _0x198473=_0x67b3c5,_0x180159=await Promise[_0x198473(0x1e0)](_0x315401[_0x198473(0x1c4)][_0x198473(0x1d7)](async _0x37d555=>{const _0x29d7b=_0x198473,_0x54d39e=this[_0x29d7b(0x20f)](_0x37d555);if(_0x54d39e===0x0)return 0x0;return _0x37d555['status']===_0x29d7b(0x222)?-Math[_0x29d7b(0x25f)](_0x54d39e):await currencyService_1[_0x29d7b(0x1a6)][_0x29d7b(0x26a)](_0x37d555['amount'],_0x37d555[_0x29d7b(0x1e6)]);})),_0x4753e4=_0x180159[_0x198473(0x232)]((_0x280250,_0x2eb07a)=>_0x280250+_0x2eb07a,0x0);return{'date':_0x315401[_0x198473(0x217)][_0x198473(0x24a)]()['split']('T')[0x0],'amount':_0x4753e4};})),_0x426868=this['generateDateRange'](_0x5d5547,new Date()),_0x4c0f32=new Map(_0x439dfe[_0x67b3c5(0x1d7)](_0x2694c9=>[_0x2694c9['date'],_0x2694c9[_0x67b3c5(0x235)]])),_0x557d7c=_0x426868[_0x67b3c5(0x1d7)](_0x28e9a3=>({'date':_0x28e9a3,'amount':_0x4c0f32[_0x67b3c5(0x225)](_0x28e9a3)||0x0}));return console[_0x67b3c5(0x23e)](_0x67b3c5(0x1d5)),console[_0x67b3c5(0x23e)](_0x67b3c5(0x24b)+_0x252538),console[_0x67b3c5(0x23e)](_0x67b3c5(0x1ba)+_0x1b9eca),console[_0x67b3c5(0x23e)](_0x67b3c5(0x1a1)+_0x557d7c[_0x67b3c5(0x1fd)]),{'totalRevenue':Math[_0x67b3c5(0x251)](_0x421c70*0x64)/0x64,'totalUsers':_0x252538,'totalPayments':_0x1b9eca,'averagePayment':Math['round'](_0x2b41ad*0x64)/0x64,'dailyRevenue':_0x557d7c};}async[a33_0x2ca144(0x237)](_0x32aa27){const _0x2b1c6d=a33_0x2ca144,{page:_0x48c6a1,limit:_0x46c4f0,status:_0x12b1c2,gateway:_0x57eb65,shopId:_0x265cc3,dateFrom:_0x5697af,dateTo:_0x453940,search:_0xf4b504}=_0x32aa27,_0x5aa2dc=(_0x48c6a1-0x1)*_0x46c4f0;console[_0x2b1c6d(0x23e)](_0x2b1c6d(0x1d1),_0x32aa27);const _0xc9ba34={};_0x12b1c2&&(_0xc9ba34[_0x2b1c6d(0x19b)]=_0x12b1c2[_0x2b1c6d(0x1cf)]());if(_0x57eb65){if((0x0,gateway_1[_0x2b1c6d(0x1e5)])(_0x57eb65)){const _0x566eb6=(0x0,gateway_1[_0x2b1c6d(0x239)])(_0x57eb65);_0x566eb6&&(_0xc9ba34[_0x2b1c6d(0x1a2)]=_0x566eb6);}else _0xc9ba34[_0x2b1c6d(0x1a2)]=_0x57eb65[_0x2b1c6d(0x26e)]();}_0x265cc3&&(_0xc9ba34[_0x2b1c6d(0x242)]=_0x265cc3);(_0x5697af||_0x453940)&&(_0xc9ba34[_0x2b1c6d(0x250)]={},_0x5697af&&(_0xc9ba34[_0x2b1c6d(0x250)][_0x2b1c6d(0x228)]=new Date(_0x5697af)),_0x453940&&(_0xc9ba34[_0x2b1c6d(0x250)][_0x2b1c6d(0x23a)]=new Date(_0x453940)));_0xf4b504&&(_0xc9ba34['OR']=[{'orderId':{'contains':_0xf4b504,'mode':_0x2b1c6d(0x264)}},{'gatewayOrderId':{'contains':_0xf4b504,'mode':_0x2b1c6d(0x264)}},{'gatewayPaymentId':{'contains':_0xf4b504,'mode':'insensitive'}},{'customerEmail':{'contains':_0xf4b504,'mode':_0x2b1c6d(0x264)}},{'customerName':{'contains':_0xf4b504,'mode':'insensitive'}},{'shop':{'name':{'contains':_0xf4b504,'mode':_0x2b1c6d(0x264)}}},{'shop':{'username':{'contains':_0xf4b504,'mode':_0x2b1c6d(0x264)}}}]);const [_0x3311b5,_0x12629c]=await Promise[_0x2b1c6d(0x1e0)]([database_1[_0x2b1c6d(0x238)][_0x2b1c6d(0x260)][_0x2b1c6d(0x1c6)]({'where':_0xc9ba34,'skip':_0x5aa2dc,'take':_0x46c4f0,'orderBy':{'createdAt':_0x2b1c6d(0x1de)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default'][_0x2b1c6d(0x260)][_0x2b1c6d(0x219)]({'where':_0xc9ba34})]);console[_0x2b1c6d(0x23e)](_0x2b1c6d(0x1b7)+_0x3311b5['length']+'\x20payments\x20out\x20of\x20'+_0x12629c+'\x20total');const _0x1ea3e3=_0x3311b5['map'](_0x3d7b59=>({'id':_0x3d7b59['id'],'shopId':_0x3d7b59['shopId'],'shopName':_0x3d7b59[_0x2b1c6d(0x1a7)]['name'],'shopUsername':_0x3d7b59[_0x2b1c6d(0x1a7)][_0x2b1c6d(0x215)],'gateway':_0x3d7b59['gateway'],'orderId':_0x3d7b59[_0x2b1c6d(0x22e)],'gatewayOrderId':_0x3d7b59[_0x2b1c6d(0x1bb)],'amount':_0x3d7b59[_0x2b1c6d(0x235)],'currency':_0x3d7b59[_0x2b1c6d(0x1e6)],'sourceCurrency':_0x3d7b59[_0x2b1c6d(0x26c)],'status':_0x3d7b59[_0x2b1c6d(0x19b)],'usage':_0x3d7b59[_0x2b1c6d(0x265)],'externalPaymentUrl':_0x3d7b59[_0x2b1c6d(0x24d)],'gatewayPaymentId':_0x3d7b59['gatewayPaymentId'],'customerEmail':_0x3d7b59[_0x2b1c6d(0x1e4)],'customerName':_0x3d7b59[_0x2b1c6d(0x25d)],'cardLast4':_0x3d7b59['cardLast4'],'paymentMethod':_0x3d7b59[_0x2b1c6d(0x21a)],'bankId':_0x3d7b59['bankId'],'remitterIban':_0x3d7b59[_0x2b1c6d(0x23d)],'remitterName':_0x3d7b59['remitterName'],'chargebackAmount':_0x3d7b59['chargebackAmount'],'adminNotes':_0x3d7b59[_0x2b1c6d(0x1c8)],'statusChangedBy':_0x3d7b59[_0x2b1c6d(0x1c9)],'statusChangedAt':_0x3d7b59[_0x2b1c6d(0x268)],'createdAt':_0x3d7b59['createdAt'],'updatedAt':_0x3d7b59[_0x2b1c6d(0x223)],'expiresAt':_0x3d7b59[_0x2b1c6d(0x249)]}));return{'payments':_0x1ea3e3,'pagination':{'page':_0x48c6a1,'limit':_0x46c4f0,'total':_0x12629c,'totalPages':Math[_0x2b1c6d(0x1f4)](_0x12629c/_0x46c4f0)}};}async[a33_0x2ca144(0x1e2)](_0x7b5a4e){const _0x3cd32d=a33_0x2ca144;console[_0x3cd32d(0x23e)](_0x3cd32d(0x21e)+_0x7b5a4e);const _0x4ea508=await database_1[_0x3cd32d(0x238)]['payment'][_0x3cd32d(0x1eb)]({'where':{'id':_0x7b5a4e},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}},'webhookLogs':{'orderBy':{'createdAt':_0x3cd32d(0x1de)},'take':0xa,'select':{'id':!![],'event':!![],'statusCode':!![],'retryCount':!![],'createdAt':!![]}}}});if(!_0x4ea508)return console[_0x3cd32d(0x23e)](_0x3cd32d(0x203)+_0x7b5a4e),null;return console['log'](_0x3cd32d(0x1d4)+_0x4ea508[_0x3cd32d(0x22e)]+'\x20('+_0x4ea508['status']+')'),{'id':_0x4ea508['id'],'shopId':_0x4ea508[_0x3cd32d(0x242)],'shopName':_0x4ea508['shop'][_0x3cd32d(0x199)],'shopUsername':_0x4ea508['shop'][_0x3cd32d(0x215)],'gateway':_0x4ea508['gateway'],'orderId':_0x4ea508[_0x3cd32d(0x22e)],'gatewayOrderId':_0x4ea508[_0x3cd32d(0x1bb)],'amount':_0x4ea508['amount'],'currency':_0x4ea508[_0x3cd32d(0x1e6)],'sourceCurrency':_0x4ea508['sourceCurrency'],'status':_0x4ea508[_0x3cd32d(0x19b)],'usage':_0x4ea508['usage'],'externalPaymentUrl':_0x4ea508[_0x3cd32d(0x24d)],'gatewayPaymentId':_0x4ea508[_0x3cd32d(0x20d)],'customerEmail':_0x4ea508[_0x3cd32d(0x1e4)],'customerName':_0x4ea508[_0x3cd32d(0x25d)],'cardLast4':_0x4ea508['cardLast4'],'paymentMethod':_0x4ea508[_0x3cd32d(0x21a)],'bankId':_0x4ea508[_0x3cd32d(0x1c5)],'remitterIban':_0x4ea508[_0x3cd32d(0x23d)],'remitterName':_0x4ea508[_0x3cd32d(0x25b)],'chargebackAmount':_0x4ea508['chargebackAmount'],'adminNotes':_0x4ea508[_0x3cd32d(0x1c8)],'statusChangedBy':_0x4ea508[_0x3cd32d(0x1c9)],'statusChangedAt':_0x4ea508[_0x3cd32d(0x268)],'createdAt':_0x4ea508['createdAt'],'updatedAt':_0x4ea508[_0x3cd32d(0x223)],'expiresAt':_0x4ea508[_0x3cd32d(0x249)],'webhookLogs':_0x4ea508[_0x3cd32d(0x1cb)]};}async[a33_0x2ca144(0x1ab)](_0x5b10f9,_0x179c80,_0x44a269,_0x3d5666){const _0x3b100a=a33_0x2ca144;console['log'](_0x3b100a(0x1bf)+_0x5b10f9+_0x3b100a(0x19d)+_0x179c80);const _0x549f66=[_0x3b100a(0x201),_0x3b100a(0x244),'EXPIRED',_0x3b100a(0x227),_0x3b100a(0x1f6),_0x3b100a(0x222)];if(!_0x549f66[_0x3b100a(0x256)](_0x179c80[_0x3b100a(0x1cf)]()))throw new Error(_0x3b100a(0x205)+_0x549f66['join'](',\x20'));const _0x477ce0=await database_1[_0x3b100a(0x238)][_0x3b100a(0x260)][_0x3b100a(0x1eb)]({'where':{'id':_0x5b10f9},'select':{'id':!![],'status':!![],'orderId':!![]}});if(!_0x477ce0)throw new Error('Payment\x20not\x20found');if(_0x179c80[_0x3b100a(0x1cf)]()===_0x3b100a(0x222)){if(!_0x3d5666||_0x3d5666<=0x0)throw new Error(_0x3b100a(0x221));console[_0x3b100a(0x23e)](_0x3b100a(0x22c)+_0x3d5666+'\x20USDT\x20(penalty\x20amount)');}const _0x31a5b6={'status':_0x179c80[_0x3b100a(0x1cf)](),'updatedAt':new Date(),'statusChangedBy':'admin','statusChangedAt':new Date()};_0x44a269&&(_0x31a5b6[_0x3b100a(0x1c8)]=_0x44a269);_0x179c80[_0x3b100a(0x1cf)]()===_0x3b100a(0x222)&&_0x3d5666&&(_0x31a5b6[_0x3b100a(0x269)]=_0x3d5666);const _0x2e3706=await database_1[_0x3b100a(0x238)]['payment'][_0x3b100a(0x1f0)]({'where':{'id':_0x5b10f9},'data':_0x31a5b6,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});return await database_1[_0x3b100a(0x238)][_0x3b100a(0x22a)][_0x3b100a(0x1e9)]({'data':{'paymentId':_0x5b10f9,'shopId':_0x2e3706[_0x3b100a(0x242)],'event':'admin_status_update','statusCode':0xc8,'responseBody':JSON[_0x3b100a(0x208)]({'oldStatus':_0x477ce0[_0x3b100a(0x19b)],'newStatus':_0x179c80[_0x3b100a(0x1cf)](),'notes':_0x44a269||null,'chargebackAmount':_0x3d5666||null,'updatedBy':_0x3b100a(0x197),'timestamp':new Date()[_0x3b100a(0x24a)]()})}}),console[_0x3b100a(0x23e)](_0x3b100a(0x1e8)+_0x477ce0[_0x3b100a(0x22e)]+_0x3b100a(0x1be)+_0x477ce0[_0x3b100a(0x19b)]+_0x3b100a(0x229)+_0x179c80['toUpperCase']()),_0x179c80[_0x3b100a(0x1cf)]()===_0x3b100a(0x222)&&console[_0x3b100a(0x23e)]('💸\x20Chargeback\x20penalty:\x20'+_0x3d5666+'\x20USDT\x20(will\x20be\x20deducted\x20from\x20merchant\x20balance)'),{'id':_0x2e3706['id'],'shopId':_0x2e3706['shopId'],'shopName':_0x2e3706[_0x3b100a(0x1a7)][_0x3b100a(0x199)],'shopUsername':_0x2e3706[_0x3b100a(0x1a7)][_0x3b100a(0x215)],'gateway':_0x2e3706[_0x3b100a(0x1a2)],'orderId':_0x2e3706[_0x3b100a(0x22e)],'gatewayOrderId':_0x2e3706[_0x3b100a(0x1bb)],'amount':_0x2e3706[_0x3b100a(0x235)],'currency':_0x2e3706[_0x3b100a(0x1e6)],'sourceCurrency':_0x2e3706[_0x3b100a(0x26c)],'status':_0x2e3706[_0x3b100a(0x19b)],'usage':_0x2e3706['usage'],'externalPaymentUrl':_0x2e3706[_0x3b100a(0x24d)],'gatewayPaymentId':_0x2e3706[_0x3b100a(0x20d)],'customerEmail':_0x2e3706[_0x3b100a(0x1e4)],'customerName':_0x2e3706['customerName'],'cardLast4':_0x2e3706[_0x3b100a(0x1a3)],'paymentMethod':_0x2e3706['paymentMethod'],'bankId':_0x2e3706['bankId'],'remitterIban':_0x2e3706[_0x3b100a(0x23d)],'remitterName':_0x2e3706[_0x3b100a(0x25b)],'chargebackAmount':_0x2e3706[_0x3b100a(0x269)],'adminNotes':_0x2e3706[_0x3b100a(0x1c8)],'statusChangedBy':_0x2e3706[_0x3b100a(0x1c9)],'statusChangedAt':_0x2e3706[_0x3b100a(0x268)],'createdAt':_0x2e3706[_0x3b100a(0x250)],'updatedAt':_0x2e3706[_0x3b100a(0x223)],'expiresAt':_0x2e3706[_0x3b100a(0x249)]};}async[a33_0x2ca144(0x25e)](_0x4d2983){const _0x568586=a33_0x2ca144,{page:_0x43b193,limit:_0x218fd1,status:_0x352f98}=_0x4d2983,_0x12a68e=(_0x43b193-0x1)*_0x218fd1,_0x2339ca={};_0x352f98&&(_0x2339ca[_0x568586(0x19b)]=_0x352f98[_0x568586(0x1cf)]());console[_0x568586(0x23e)](_0x568586(0x1d9),{'page':_0x43b193,'limit':_0x218fd1,'status':_0x352f98,'where':_0x2339ca});const [_0x57c2ff,_0x3c52f2]=await Promise[_0x568586(0x1e0)]([database_1[_0x568586(0x238)]['shop'][_0x568586(0x1c6)]({'where':_0x2339ca,'skip':_0x12a68e,'take':_0x218fd1,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x568586(0x1de)}}),database_1['default'][_0x568586(0x1a7)][_0x568586(0x219)]({'where':_0x2339ca})]);console[_0x568586(0x23e)]('📊\x20Found\x20'+_0x57c2ff['length']+_0x568586(0x1e1)+_0x3c52f2+'\x20total');const _0x4a1bed=_0x57c2ff['map'](_0x2aaccb=>({'id':_0x2aaccb['id'],'fullName':_0x2aaccb[_0x568586(0x199)],'username':_0x2aaccb['username'],'telegramId':_0x2aaccb['telegram'],'merchantUrl':_0x2aaccb[_0x568586(0x20a)],'gateways':_0x2aaccb['paymentGateways']?JSON[_0x568586(0x226)](_0x2aaccb[_0x568586(0x20e)]):null,'gatewaySettings':_0x2aaccb[_0x568586(0x204)]?JSON[_0x568586(0x226)](_0x2aaccb[_0x568586(0x204)]):null,'publicKey':_0x2aaccb['publicKey'],'wallets':{'usdtPolygonWallet':_0x2aaccb['usdtPolygonWallet'],'usdtTrcWallet':_0x2aaccb[_0x568586(0x1fb)],'usdtErcWallet':_0x2aaccb[_0x568586(0x20b)],'usdcPolygonWallet':_0x2aaccb['usdcPolygonWallet']},'status':_0x2aaccb[_0x568586(0x19b)],'createdAt':_0x2aaccb[_0x568586(0x250)]}));return{'users':_0x4a1bed,'pagination':{'page':_0x43b193,'limit':_0x218fd1,'total':_0x3c52f2,'totalPages':Math['ceil'](_0x3c52f2/_0x218fd1)}};}async[a33_0x2ca144(0x22b)](_0x115c1f){const _0x5aa219=a33_0x2ca144;return await this[_0x5aa219(0x261)][_0x5aa219(0x22b)](_0x115c1f);}async[a33_0x2ca144(0x1ca)](_0x327136){const _0x1248c0=a33_0x2ca144;return await this[_0x1248c0(0x261)]['createUser'](_0x327136);}async[a33_0x2ca144(0x259)](_0x502490,_0x468e00){const _0x3084d1=a33_0x2ca144;return await this[_0x3084d1(0x261)][_0x3084d1(0x259)](_0x502490,_0x468e00);}async['deleteUser'](_0x3dad35){const _0x13557a=a33_0x2ca144;return await this['userService'][_0x13557a(0x1ec)](_0x3dad35);}async[a33_0x2ca144(0x19f)](_0xd264f2){const _0x492802=a33_0x2ca144;console[_0x492802(0x23e)](_0x492802(0x246)+_0xd264f2);const _0x543c72=await database_1[_0x492802(0x238)][_0x492802(0x1a7)][_0x492802(0x1eb)]({'where':{'id':_0xd264f2},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x543c72)throw new Error(_0x492802(0x21b));if(_0x543c72[_0x492802(0x19b)]===_0x492802(0x26b))throw new Error(_0x492802(0x1c2));const _0xd0b0bc=await this[_0x492802(0x261)][_0x492802(0x259)](_0xd264f2,{'status':'SUSPENDED'});return console[_0x492802(0x23e)](_0x492802(0x224)+_0x543c72[_0x492802(0x215)]+_0x492802(0x240)),_0xd0b0bc;}async[a33_0x2ca144(0x200)](_0x390ee4){const _0x42dd56=a33_0x2ca144;console[_0x42dd56(0x23e)](_0x42dd56(0x202)+_0x390ee4);const _0x1618ea=await database_1[_0x42dd56(0x238)]['shop'][_0x42dd56(0x1eb)]({'where':{'id':_0x390ee4},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x1618ea)throw new Error(_0x42dd56(0x21b));if(_0x1618ea['status']===_0x42dd56(0x1b4))throw new Error('User\x20is\x20already\x20active');const _0x4cd57d=await this['userService'][_0x42dd56(0x259)](_0x390ee4,{'status':'ACTIVE'});return console[_0x42dd56(0x23e)]('✅\x20User\x20'+_0x1618ea[_0x42dd56(0x215)]+'\x20activated\x20successfully'),_0x4cd57d;}}exports[a33_0x2ca144(0x266)]=AdminService;