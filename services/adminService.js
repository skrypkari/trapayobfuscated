'use strict';const a36_0x29f0d9=a36_0x134b;(function(_0xe8a69c,_0x17e335){const _0x2d30cf=a36_0x134b,_0x1bd61b=_0xe8a69c();while(!![]){try{const _0x17331c=-parseInt(_0x2d30cf(0x247))/0x1+-parseInt(_0x2d30cf(0x1d5))/0x2*(-parseInt(_0x2d30cf(0x1f7))/0x3)+parseInt(_0x2d30cf(0x272))/0x4*(-parseInt(_0x2d30cf(0x184))/0x5)+-parseInt(_0x2d30cf(0x215))/0x6+-parseInt(_0x2d30cf(0x226))/0x7*(-parseInt(_0x2d30cf(0x193))/0x8)+parseInt(_0x2d30cf(0x245))/0x9*(parseInt(_0x2d30cf(0x291))/0xa)+-parseInt(_0x2d30cf(0x220))/0xb*(parseInt(_0x2d30cf(0x2a9))/0xc);if(_0x17331c===_0x17e335)break;else _0x1bd61b['push'](_0x1bd61b['shift']());}catch(_0x23d9bc){_0x1bd61b['push'](_0x1bd61b['shift']());}}}(a36_0x3206,0xa38fd));var __importDefault=this&&this['__importDefault']||function(_0x35ecdf){const _0x5bbfc9=a36_0x134b;return _0x35ecdf&&_0x35ecdf[_0x5bbfc9(0x1a8)]?_0x35ecdf:{'default':_0x35ecdf};};function a36_0x3206(){const _0x44768e=['🔍\x20Using\x20gateway\x20\x27','warn','turnoverUSDT','toISOString','🔧\x20[','💰\x20Creating\x20payout\x20for\x20shop\x20','date','convertToUSDT','week','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','customerUa','balance','reduce','includes','getGatewayDisplayName','name','admin','getGatewayInternalName','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','\x20\x20\x20�\x20Total\x20paid\x20out:\x20','updatedAt','PENDING','amountAfterGatewayCommissionUSDT','currencyService','noda','asc','\x20\x20\x20💰\x20Total\x20payout:\x20','\x20status:\x20','awaitingPayout','status','\x20USDT\x20for\x20payment\x20','_count','MasterCard','\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)','\x20\x20\x20💳\x20Total\x20payments:\x20','🔐\x20[','shop','amount','💰\x20[PAYOUT]\x20Gateway\x20','2640130MEvgGE','rapyd','_sum','📊\x20Total\x20payments\x20(including\x20failed):\x20','create','💰\x20[PAYOUT]\x20Merchant\x20','🔄\x20Gateway\x20mapping:','not\x20set','\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)','dateFrom','\x20USDT','payment','get','📊\x20Sorting\x20payments\x20by\x20','customerCountry','network','gatewayOrderId',']\x20Gateway\x20settings\x20JSON\x20string:','Username\x20already\x20exists','customerIp','updatePaymentStatus','createdAt','\x20order','bcryptjs','\x20USDT\x20(-','merchantUrl','findMany','\x20active\x20merchants\x20for\x20selection','username','sk_','\x20\x20\x20💵\x20Available\x20balance:\x20','externalPaymentUrl','ACTIVE','30d','3lFiHex','publicKey','\x20\x20\x20Payout\x20amount:\x20','\x20\x20\x20💰\x20Total\x20turnover:\x20','map','getMerchantsAwaitingPayout','substr',',\x20successful:\x20','periodFrom',':\x20commission\x20=\x20','\x20\x20\x20Current\x20balance:\x20','\x20\x20\x20�📊\x20Total\x20payments:\x20','log','erc20','\x20USDT\x20(already\x20paid\x20out)','custom','totalAmountAfterCommissionUSDT','totalCommissionRate','ceil','insensitive','getPaymentById','\x20\x20\x20🌐\x20IP:\x20','averageCheckUSDT','commissionUSDT','toFixed','forEach','\x20\x20\x20💸\x20Total\x20payouts:\x20','📅\x20Period:\x20','💱\x20Currency\x20filter\x20applied:\x20','💰\x20Found\x20','931194wftrhz','set','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','\x20\x20\x20💸\x20Total\x20payouts\x20(all\x20time):\x20','hash','delete','createPayout','statusChangedBy','\x27\x20->\x20name\x20\x27','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','join','27896xQdUgT',']\x20Updating\x20password\x20for\x20user\x20','\x27\x20->\x20ID\x20\x27','amountAfterCommissionUSDT','🎯\x20updateUser\x20called\x20with\x20ID:\x20','\x20\x20\x20⏳\x20Pending\x20payout:\x20','7ZPltWE','random','year','push','getAllPayouts','gateway','update','Test\x20Gateway','✅\x20Payout\x20created:\x20','polygon_usdc','month','currency','deleteUser','gatewaySettings','Shop\x20not\x20found','successUrl','2020-01-01','paidAt','klyme_eu','✅\x20Using\x20gateway\x20filter:\x20\x27','findFirst','usdtErcWallet','getMonth','\x20\x20\x20Merchant\x20loses:\x20','REFUND','⚠️\x20Payment\x20','amountUSDT','📋\x20Getting\x20merchants\x20selection\x20list...','thisMonth','0000','whiteUrl','541800taKYRt','\x20\x20\x20🌍\x20Country:\x20','894774mcXwbz','KLYME\x20EU','\x20merchants\x20with\x20positive\x20balance','Noda','totalPayments','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','chargebackAmount','paymentsCount','password','Telegram\x20username\x20already\x20exists','\x20\x20\x20Gateway:\x20','default','lte','../types/gateway','\x20USDT\x20(same\x20as\x20awaiting)','wallets','totalPaidOut','\x20\x20\x20📅\x20This\x20month:\x20','getUserById','shopUrl','\x20USDT\x20(actual\x20balances)','yesterday','test_gateway','klyme_de','getAllPayments','gatewayCommissionRate','./currencyService','totalPayout','\x20->\x20','toUpperCase','stringify','📊\x20Calculated\x20commission\x20rate\x20for\x20payment\x20','aggregate','hex','setDate','Error\x20processing\x20payment\x20','\x20USDT,\x20merchant:\x20','turnover','entries','getGatewayIdByName','🔄\x20Converted\x20gateway\x20name\x20\x27','\x20\x20\x20Full\x20amount:\x20','52YedEwA','\x20\x20\x20🖥️\x20User\x20Agent:\x20','getPayoutStats','toLowerCase','crypto','cointopay2','shopId','periodTo','error','adminNotes','📊\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','📊\x20Calculating\x20payout\x20statistics...','⚠️\x20Requested\x20gateway\x20\x27','usdcPolygonWallet','\x20USDT\x20(gross\x20revenue)','customerEmail','getGatewayNameById','customerName','randomBytes','\x27\x20not\x20found.\x20Available\x20gateways:\x20','NONEXISTENT_GATEWAY_FILTER','\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...','getMerchantStatistics','\x27\x20to\x20name\x20\x27','Rapyd','🔄\x20Gateway\x20mapping\x20(get):','averageCommissionRate','📊\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','dailyRevenue','🎯\x20[','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','20JxkuhU','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','all','length','telegram','desc','failureMessage','period','payout','📊\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20','\x20USDT\x20(+','orderId','\x20USDT\x20(theoretical\x20net)','\x20\x20\x20Total\x20paid\x20out:\x20','activateUser','setHours','getAllUsers',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','Open\x20Banking\x202','\x20USDT)','📊\x20Gateway\x20filter\x20applied:','totalAmountUSDT','dailyPayments','%\x20commission)','660YOgevS','not\x20specified','klyme_gb','AdminService','groupBy','usdtPolygonWallet','telegramId','usdtTrcWallet','📊\x20Using\x20saved\x20values\x20for\x20payment\x20','\x20USDT\x20from\x20balance','💰\x20Shop\x20','💸\x20CHARGEBACK\x20penalty:\x20-','merchantEarnings','📋\x20Found\x20','🔄\x20Gateway\x20mapping\x20(create):','fullName','CHARGEBACK','paymentGateways','values','\x20USDT\x20(total\x20paid\x20to\x20merchants)','parse','generateDailyStatistics','\x20\x20\x20🔍\x20Calculated\x20after\x20commission:\x20','\x20payments)','count','📊\x20Getting\x20payments\x20with\x20filters:',']\x20Gateway\x20settings\x20before\x20saving:','\x20\x20\x20✅\x20Actual\x20available\x20balance:\x20','KLYME\x20DE','cointopay','gatewayEarnings','$transaction','getFullYear','revenue','27820lVsaQT','day','getDate','gte','dateTo','paidOutUSDT','merchantEarningsUSDT','trim','totalTurnover','💰\x20Payment\x20','gateways','toString','KLYME\x20GB','txid','getSystemStatistics','3930152vqalMs','commission',',\x20userId:\x20','notes','findUnique','trc20','🔄\x20Admin\x20updating\x20payment\x20','some','\x20no\x20longer\x20PAID:','🔄\x20Converted\x20gateway\x20ID\x20\x27','updateCustomerData','../config/database','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','PAID','split','\x20USDT\x20(after\x20','\x20\x20\x20💰\x20Total\x20payments\x20turnover:\x20','pendingPayout',',\x20Commission:\x20','round','getTime','__esModule',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','getMerchantsSelection','📊\x20Available\x20gateways\x20in\x20database:','\x20USDT,\x20Requested:\x20','COMPLETED'];a36_0x3206=function(){return _0x44768e;};return a36_0x3206();}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['AdminService']=void 0x0;function a36_0x134b(_0x47de9c,_0x4180cf){const _0x32061f=a36_0x3206();return a36_0x134b=function(_0x134b4d,_0x33f4e6){_0x134b4d=_0x134b4d-0x179;let _0x31cbf6=_0x32061f[_0x134b4d];return _0x31cbf6;},a36_0x134b(_0x47de9c,_0x4180cf);}const database_1=__importDefault(require(a36_0x29f0d9(0x19e))),bcryptjs_1=__importDefault(require(a36_0x29f0d9(0x1ec))),crypto_1=__importDefault(require(a36_0x29f0d9(0x276))),currencyService_1=require(a36_0x29f0d9(0x262)),gateway_1=require(a36_0x29f0d9(0x255));class AdminService{async[a36_0x29f0d9(0x274)](){const _0x329f9e=a36_0x29f0d9;console[_0x329f9e(0x203)](_0x329f9e(0x27d));const _0x1730e2=await database_1[_0x329f9e(0x253)][_0x329f9e(0x1d2)][_0x329f9e(0x268)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x329f9e(0x1f5)}}),_0x279285=await database_1['default']['payment'][_0x329f9e(0x17a)]({'where':{'status':_0x329f9e(0x1a0),'gateway':{'not':_0x329f9e(0x25e)}}}),_0x3f2560=new Date(),_0x38d3f2=new Date(_0x3f2560[_0x329f9e(0x182)](),_0x3f2560[_0x329f9e(0x23c)](),0x1),_0x4e1336=new Date(_0x3f2560['getFullYear'](),_0x3f2560['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x24860a=await database_1[_0x329f9e(0x253)]['payout'][_0x329f9e(0x268)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x38d3f2,'lte':_0x4e1336},'status':_0x329f9e(0x1ad)}}),_0x529c98=_0x1730e2[_0x329f9e(0x1d7)][_0x329f9e(0x258)]||0x0,_0x3247dd=_0x1730e2[_0x329f9e(0x1d7)][_0x329f9e(0x1b9)]||0x0,_0x980827=_0x24860a[_0x329f9e(0x1d7)]['amount']||0x0,_0xd9c690={'totalPayout':Math[_0x329f9e(0x1a6)](_0x529c98*0x64)/0x64,'awaitingPayout':Math['round'](_0x3247dd*0x64)/0x64,'thisMonth':Math[_0x329f9e(0x1a6)](_0x980827*0x64)/0x64,'availableBalance':Math[_0x329f9e(0x1a6)](_0x3247dd*0x64)/0x64,'totalPayments':_0x279285};return console['log']('📊\x20Payout\x20statistics\x20calculated:'),console[_0x329f9e(0x203)](_0x329f9e(0x1c8)+_0xd9c690[_0x329f9e(0x263)]+_0x329f9e(0x2bc)),console[_0x329f9e(0x203)](_0x329f9e(0x292)+_0xd9c690[_0x329f9e(0x1ca)]+_0x329f9e(0x1dd)),console[_0x329f9e(0x203)](_0x329f9e(0x1f3)+_0xd9c690['availableBalance']+_0x329f9e(0x256)),console[_0x329f9e(0x203)](_0x329f9e(0x259)+_0xd9c690[_0x329f9e(0x242)]+_0x329f9e(0x1df)),console[_0x329f9e(0x203)](_0x329f9e(0x1d0)+_0xd9c690['totalPayments']+'\x20PAID\x20payments'),_0xd9c690;}async[a36_0x29f0d9(0x19d)](_0xbbe856,_0x2adec6){const _0xc6a5c4=a36_0x29f0d9;console[_0xc6a5c4(0x203)](_0xc6a5c4(0x21e)+_0xbbe856+':',_0x2adec6);const _0xa871c1=await database_1[_0xc6a5c4(0x253)][_0xc6a5c4(0x1e0)][_0xc6a5c4(0x197)]({'where':{'id':_0xbbe856},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0xa871c1)throw new Error('Payment\x20not\x20found');const _0x5cc266={};_0x2adec6[_0xc6a5c4(0x1e3)]!==undefined&&(_0x5cc266[_0xc6a5c4(0x1e3)]=_0x2adec6[_0xc6a5c4(0x1e3)]||null);_0x2adec6[_0xc6a5c4(0x1e8)]!==undefined&&(_0x5cc266['customerIp']=_0x2adec6[_0xc6a5c4(0x1e8)]||null);_0x2adec6[_0xc6a5c4(0x1b8)]!==undefined&&(_0x5cc266['customerUa']=_0x2adec6[_0xc6a5c4(0x1b8)]||null);const _0x17b9a3=await database_1[_0xc6a5c4(0x253)][_0xc6a5c4(0x1e0)][_0xc6a5c4(0x22c)]({'where':{'id':_0xbbe856},'data':{..._0x5cc266,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0xc6a5c4(0x203)](_0xc6a5c4(0x1b7)+_0xbbe856),console[_0xc6a5c4(0x203)](_0xc6a5c4(0x246)+_0xa871c1['customerCountry']+'\x20->\x20'+_0x17b9a3[_0xc6a5c4(0x1e3)]),console['log'](_0xc6a5c4(0x20c)+_0xa871c1['customerIp']+_0xc6a5c4(0x264)+_0x17b9a3[_0xc6a5c4(0x1e8)]),console['log'](_0xc6a5c4(0x273)+(_0xa871c1[_0xc6a5c4(0x1b8)]?_0xc6a5c4(0x216):_0xc6a5c4(0x1dc))+_0xc6a5c4(0x264)+(_0x17b9a3['customerUa']?_0xc6a5c4(0x216):'not\x20set')),_0x17b9a3;}async[a36_0x29f0d9(0x192)](_0x256fb5){const _0x4eaa93=a36_0x29f0d9,_0xac8888=new Date();let _0x4c0d6d;switch(_0x256fb5[_0x4eaa93(0x275)]()){case _0x4eaa93(0x185):_0x4c0d6d=new Date(_0xac8888[_0x4eaa93(0x182)](),_0xac8888[_0x4eaa93(0x23c)](),_0xac8888[_0x4eaa93(0x186)](),0x0,0x0,0x0,0x0);break;case'yesterday':const _0x308756=new Date(_0xac8888);_0x308756[_0x4eaa93(0x26a)](_0x308756['getDate']()-0x1),_0x4c0d6d=new Date(_0x308756['getFullYear'](),_0x308756[_0x4eaa93(0x23c)](),_0x308756[_0x4eaa93(0x186)](),0x0,0x0,0x0,0x0);break;case'7d':_0x4c0d6d=new Date(_0xac8888['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x4eaa93(0x1f6):_0x4c0d6d=new Date(_0xac8888['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'90d':_0x4c0d6d=new Date(_0xac8888[_0x4eaa93(0x1a7)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x4eaa93(0x293):const _0x474a5c=await database_1['default']['payment'][_0x4eaa93(0x23a)]({'where':{'gateway':{'not':_0x4eaa93(0x25e)}},'orderBy':{'createdAt':_0x4eaa93(0x1c7)},'select':{'createdAt':!![]}});_0x4c0d6d=_0x474a5c?_0x474a5c[_0x4eaa93(0x1ea)]:new Date(_0x4eaa93(0x236));break;default:_0x4c0d6d=new Date(_0xac8888['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}_0x4c0d6d[_0x4eaa93(0x2a0)](0x0,0x0,0x0,0x0);let _0x471221;if(_0x256fb5[_0x4eaa93(0x275)]()===_0x4eaa93(0x25d)){const _0x4e42d6=new Date(_0xac8888);_0x4e42d6[_0x4eaa93(0x26a)](_0x4e42d6[_0x4eaa93(0x186)]()-0x1),_0x471221=new Date(_0x4e42d6[_0x4eaa93(0x182)](),_0x4e42d6[_0x4eaa93(0x23c)](),_0x4e42d6[_0x4eaa93(0x186)](),0x17,0x3b,0x3b,0x3e7);}const _0x44d34c={'gte':_0x4c0d6d};_0x471221&&(_0x44d34c['lte']=_0x471221);const [_0x4eae7b,_0x42ee03,_0x2ef202,_0x30e35d,_0x4b55f4,_0x1ec54b]=await Promise[_0x4eaa93(0x293)]([database_1[_0x4eaa93(0x253)][_0x4eaa93(0x1d2)][_0x4eaa93(0x17a)](),database_1[_0x4eaa93(0x253)][_0x4eaa93(0x1d2)][_0x4eaa93(0x17a)]({'where':{'status':_0x4eaa93(0x1f5)}}),database_1[_0x4eaa93(0x253)]['payment'][_0x4eaa93(0x17a)]({'where':{'status':_0x4eaa93(0x1a0),'createdAt':_0x44d34c,'gateway':{'not':_0x4eaa93(0x25e)}}}),database_1['default'][_0x4eaa93(0x1e0)][_0x4eaa93(0x1ef)]({'where':{'status':'PAID','createdAt':_0x44d34c,'gateway':{'not':_0x4eaa93(0x25e)}},'select':{'amount':!![],'currency':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x4eaa93(0x253)][_0x4eaa93(0x1e0)][_0x4eaa93(0x1ef)]({'where':{'gateway':{'not':'test_gateway'}},'take':0xa,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x4eaa93(0x253)]['payment'][_0x4eaa93(0x1ef)]({'where':{'createdAt':_0x44d34c,'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x5530e7=0x0,_0xed7d2=0x0;for(const _0x402df9 of _0x30e35d){const _0x430cfc=await currencyService_1[_0x4eaa93(0x1c5)][_0x4eaa93(0x1b5)](_0x402df9[_0x4eaa93(0x1d3)],_0x402df9['currency']);_0x5530e7+=_0x430cfc;if(_0x402df9[_0x4eaa93(0x1c4)]){const _0x22901b=await currencyService_1['currencyService'][_0x4eaa93(0x1b5)](_0x402df9[_0x4eaa93(0x1d3)],_0x402df9['currency']),_0x208014=_0x402df9['amountAfterGatewayCommissionUSDT'],_0x1594bb=_0x22901b-_0x208014;_0xed7d2+=_0x1594bb;}}const _0x13f979=_0x2ef202>0x0?_0x5530e7/_0x2ef202:0x0,_0xa112=this[_0x4eaa93(0x2be)](_0x1ec54b,_0x4c0d6d,_0x471221||_0xac8888),_0x28e2c0=await database_1[_0x4eaa93(0x253)]['payment'][_0x4eaa93(0x17a)]({'where':{'createdAt':_0x44d34c,'gateway':{'not':_0x4eaa93(0x25e)}}}),_0x5413c5=_0x28e2c0>0x0?_0x2ef202/_0x28e2c0*0x64:0x0;return{'totalShops':_0x4eae7b,'activeShops':_0x42ee03,'totalPayments':_0x2ef202,'successfulPayments':_0x2ef202,'totalAttempts':_0x28e2c0,'totalRevenue':Math[_0x4eaa93(0x1a6)](_0x5530e7*0x64)/0x64,'trapayEarnings':Math[_0x4eaa93(0x1a6)](_0xed7d2*0x64)/0x64,'averagePaymentAmount':Math['round'](_0x13f979*0x64)/0x64,'conversionRate':Math[_0x4eaa93(0x1a6)](_0x5413c5*0x64)/0x64,'dailyRevenue':_0xa112[_0x4eaa93(0x28e)],'dailyPayments':_0xa112[_0x4eaa93(0x2a7)],'recentPayments':_0x4b55f4[_0x4eaa93(0x1fb)](_0x2c471f=>({'id':_0x2c471f['id'],'amount':_0x2c471f['amount'],'currency':_0x2c471f['currency'],'status':_0x2c471f[_0x4eaa93(0x1cb)],'gateway':_0x2c471f[_0x4eaa93(0x22b)],'shop':_0x2c471f['shop'],'createdAt':_0x2c471f[_0x4eaa93(0x1ea)]}))};}async[a36_0x29f0d9(0x288)](_0x15e40){const _0x5ab234=a36_0x29f0d9;console[_0x5ab234(0x203)](_0x5ab234(0x24d),_0x15e40);let _0x1b8b06,_0x15fbcd=new Date();if(_0x15e40[_0x5ab234(0x298)]===_0x5ab234(0x206)&&_0x15e40['dateFrom']&&_0x15e40[_0x5ab234(0x188)])_0x1b8b06=new Date(_0x15e40[_0x5ab234(0x1de)]),_0x15fbcd=new Date(_0x15e40[_0x5ab234(0x188)]),_0x1b8b06[_0x5ab234(0x2a0)](0x0,0x0,0x0,0x0),_0x15fbcd[_0x5ab234(0x2a0)](0x17,0x3b,0x3b,0x3e7);else{const _0x161242=new Date();switch(_0x15e40['period']){case _0x5ab234(0x1b6):_0x1b8b06=new Date(_0x161242[_0x5ab234(0x1a7)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x5ab234(0x230):_0x1b8b06=new Date(_0x161242[_0x5ab234(0x1a7)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x5ab234(0x228):_0x1b8b06=new Date(_0x161242['getTime']()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x5ab234(0x293):default:_0x1b8b06=new Date('2020-01-01');break;}_0x1b8b06['setHours'](0x0,0x0,0x0,0x0),_0x15fbcd['setHours'](0x17,0x3b,0x3b,0x3e7);}console[_0x5ab234(0x203)](_0x5ab234(0x212)+_0x1b8b06['toISOString']()+'\x20to\x20'+_0x15fbcd['toISOString']());const _0x5c5ed3={'status':_0x5ab234(0x1a0),'gateway':{'not':_0x5ab234(0x25e)},'paidAt':{'gte':_0x1b8b06,'lte':_0x15fbcd}};_0x15e40[_0x5ab234(0x278)]&&(_0x5c5ed3[_0x5ab234(0x278)]=_0x15e40['shopId']);const _0x46c255=await database_1[_0x5ab234(0x253)][_0x5ab234(0x1e0)][_0x5ab234(0x1ef)]({'where':_0x5c5ed3,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x5ab234(0x203)](_0x5ab234(0x214)+_0x46c255['length']+'\x20paid\x20payments\x20for\x20analysis');const _0x3d9888={'gateway':{'not':_0x5ab234(0x25e)},'createdAt':{'gte':_0x1b8b06,'lte':_0x15fbcd}};_0x15e40['shopId']&&(_0x3d9888[_0x5ab234(0x278)]=_0x15e40[_0x5ab234(0x278)]);const _0x184ef9=await database_1[_0x5ab234(0x253)][_0x5ab234(0x1e0)][_0x5ab234(0x17a)]({'where':_0x3d9888});console[_0x5ab234(0x203)](_0x5ab234(0x1d8)+_0x184ef9+_0x5ab234(0x1fe)+_0x46c255[_0x5ab234(0x294)]);let _0x583484=0x0,_0x349f5a=0x0,_0x2e9858=0x0;const _0x509a26={},_0x48724e={},_0xdc09cf={};for(const _0x2410d0 of _0x46c255){try{const _0x33e70c=_0x2410d0[_0x5ab234(0x240)]||0x0;if(_0x33e70c<=0x0){console[_0x5ab234(0x1af)]('⚠️\x20Payment\x20'+_0x2410d0['id']+_0x5ab234(0x287));continue;}let _0x8e78c3,_0x50f824;if(_0x2410d0['amountAfterGatewayCommissionUSDT']!==null&&_0x2410d0[_0x5ab234(0x1c4)]!==undefined)_0x8e78c3=_0x2410d0[_0x5ab234(0x1c4)],_0x50f824=_0x33e70c-_0x8e78c3,console[_0x5ab234(0x203)](_0x5ab234(0x2b1)+_0x2410d0['id']+':\x20'+_0x33e70c['toFixed'](0x6)+_0x5ab234(0x26c)+_0x8e78c3[_0x5ab234(0x20f)](0x6)+_0x5ab234(0x1df));else{let _0x10af8b={};if(_0x2410d0[_0x5ab234(0x1d2)][_0x5ab234(0x233)])try{_0x10af8b=JSON[_0x5ab234(0x2bd)](_0x2410d0['shop'][_0x5ab234(0x233)]);}catch(_0x18294a){console['error']('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x2410d0[_0x5ab234(0x278)]+':',_0x18294a);}let _0x6be5f8=0x2d;for(const [_0x3cd1ca,_0x327244]of Object[_0x5ab234(0x26e)](_0x10af8b)){if(_0x3cd1ca['toLowerCase']()===_0x2410d0[_0x5ab234(0x22b)][_0x5ab234(0x275)]()){_0x6be5f8=_0x327244[_0x5ab234(0x194)]||0x2d;break;}}_0x50f824=_0x33e70c*(_0x6be5f8/0x64),_0x8e78c3=_0x33e70c-_0x50f824,console[_0x5ab234(0x203)](_0x5ab234(0x27c)+_0x2410d0['id']+':\x20'+_0x6be5f8+'%\x20from\x20'+_0x33e70c[_0x5ab234(0x20f)](0x6)+_0x5ab234(0x1df));}_0x583484+=_0x33e70c,_0x349f5a+=_0x8e78c3,_0x2e9858+=_0x50f824;let _0x4b894d;_0x2410d0[_0x5ab234(0x261)]!==null&&_0x2410d0[_0x5ab234(0x261)]!==undefined?(_0x4b894d=_0x2410d0[_0x5ab234(0x261)],console[_0x5ab234(0x203)](_0x5ab234(0x29a)+_0x2410d0['id']+':\x20'+_0x4b894d+'%')):(_0x4b894d=_0x33e70c>0x0?_0x50f824/_0x33e70c*0x64:0x0,console[_0x5ab234(0x203)](_0x5ab234(0x267)+_0x2410d0['id']+':\x20'+_0x4b894d[_0x5ab234(0x20f)](0x2)+'%'));!_0x509a26[_0x2410d0[_0x5ab234(0x22b)]]&&(_0x509a26[_0x2410d0[_0x5ab234(0x22b)]]={'gateway':_0x2410d0['gateway'],'gatewayDisplayName':this['getGatewayDisplayName'](_0x2410d0['gateway']),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x509a26[_0x2410d0[_0x5ab234(0x22b)]][_0x5ab234(0x24f)]++,_0x509a26[_0x2410d0[_0x5ab234(0x22b)]][_0x5ab234(0x1b0)]+=_0x33e70c,_0x509a26[_0x2410d0[_0x5ab234(0x22b)]]['commissionUSDT']+=_0x50f824,_0x509a26[_0x2410d0[_0x5ab234(0x22b)]][_0x5ab234(0x18a)]+=_0x8e78c3,_0x509a26[_0x2410d0[_0x5ab234(0x22b)]][_0x5ab234(0x208)]+=_0x4b894d;!_0x15e40['shopId']&&(!_0x48724e[_0x2410d0[_0x5ab234(0x278)]]&&(_0x48724e[_0x2410d0[_0x5ab234(0x278)]]={'shopId':_0x2410d0[_0x5ab234(0x278)],'shopName':_0x2410d0['shop']['name'],'shopUsername':_0x2410d0[_0x5ab234(0x1d2)][_0x5ab234(0x1f1)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x48724e[_0x2410d0['shopId']][_0x5ab234(0x24f)]++,_0x48724e[_0x2410d0[_0x5ab234(0x278)]][_0x5ab234(0x1b0)]+=_0x33e70c,_0x48724e[_0x2410d0['shopId']]['commissionUSDT']+=_0x50f824,_0x48724e[_0x2410d0[_0x5ab234(0x278)]]['merchantEarningsUSDT']+=_0x8e78c3);const _0x13bbbd=_0x2410d0[_0x5ab234(0x237)]['toISOString']()[_0x5ab234(0x1a1)]('T')[0x0];!_0xdc09cf[_0x13bbbd]&&(_0xdc09cf[_0x13bbbd]={'date':_0x13bbbd,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0xdc09cf[_0x13bbbd][_0x5ab234(0x26d)]+=_0x33e70c,_0xdc09cf[_0x13bbbd]['merchantEarnings']+=_0x8e78c3,_0xdc09cf[_0x13bbbd][_0x5ab234(0x180)]+=_0x50f824,_0xdc09cf[_0x13bbbd]['paymentsCount']++;}catch(_0x1369a1){console[_0x5ab234(0x27a)](_0x5ab234(0x26b)+_0x2410d0['id']+':',_0x1369a1);}}Object['values'](_0x509a26)['forEach'](_0xc18af=>{const _0x1f9c37=_0x5ab234;_0xc18af['averageCommissionRate']=_0xc18af[_0x1f9c37(0x24f)]>0x0?_0xc18af[_0x1f9c37(0x208)]/_0xc18af[_0x1f9c37(0x24f)]:0x0,delete _0xc18af['totalCommissionRate'];}),Object['values'](_0x48724e)[_0x5ab234(0x210)](_0x26de8a=>{const _0x2c589d=_0x5ab234;_0x26de8a[_0x2c589d(0x20d)]=_0x26de8a[_0x2c589d(0x24f)]>0x0?_0x26de8a[_0x2c589d(0x1b0)]/_0x26de8a[_0x2c589d(0x24f)]:0x0;});let _0x56808a=0x0,_0x21e567=0x0;if(_0x15e40[_0x5ab234(0x278)]){const _0x5244c8=await database_1[_0x5ab234(0x253)][_0x5ab234(0x299)]['findMany']({'where':{'shopId':_0x15e40[_0x5ab234(0x278)],'status':_0x5ab234(0x1ad),'createdAt':{'gte':_0x1b8b06,'lte':_0x15fbcd}},'select':{'amount':!![]}});_0x56808a=_0x5244c8[_0x5ab234(0x1ba)]((_0x75f918,_0x46fb72)=>_0x75f918+_0x46fb72[_0x5ab234(0x1d3)],0x0);const _0x4d244f=await database_1[_0x5ab234(0x253)]['payout'][_0x5ab234(0x1ef)]({'where':{'shopId':_0x15e40[_0x5ab234(0x278)],'status':_0x5ab234(0x1c3),'createdAt':{'gte':_0x1b8b06,'lte':_0x15fbcd}},'select':{'amount':!![]}});_0x21e567=_0x4d244f[_0x5ab234(0x1ba)]((_0x5dead4,_0x4705f0)=>_0x5dead4+_0x4705f0[_0x5ab234(0x1d3)],0x0);}const _0x55012a=_0x184ef9,_0x3a93da=_0x46c255[_0x5ab234(0x294)],_0x1b5dd0=_0x3a93da>0x0?_0x583484/_0x3a93da:0x0,_0x4acead=_0x55012a>0x0?Math[_0x5ab234(0x1a6)](_0x3a93da/_0x55012a*0x2710)/0x64:0x0,_0x47bdd2=Math['ceil']((_0x15fbcd[_0x5ab234(0x1a7)]()-_0x1b8b06[_0x5ab234(0x1a7)]())/(0x3e8*0x3c*0x3c*0x18)),_0x41ae84={'totalTurnover':Math[_0x5ab234(0x1a6)](_0x583484*0x64)/0x64,'merchantEarnings':Math['round'](_0x349f5a*0x64)/0x64,'gatewayEarnings':Math['round'](_0x2e9858*0x64)/0x64,'totalPaidOut':Math['round'](_0x56808a*0x64)/0x64,'pendingPayout':Math[_0x5ab234(0x1a6)](_0x21e567*0x64)/0x64,'averageCheck':Math[_0x5ab234(0x1a6)](_0x1b5dd0*0x64)/0x64,'totalPayments':_0x55012a,'successfulPayments':_0x3a93da,'conversionRate':_0x4acead,'gatewayBreakdown':Object[_0x5ab234(0x2bb)](_0x509a26)['map'](_0x49881b=>({..._0x49881b,'turnoverUSDT':Math['round'](_0x49881b[_0x5ab234(0x1b0)]*0x64)/0x64,'commissionUSDT':Math[_0x5ab234(0x1a6)](_0x49881b[_0x5ab234(0x20e)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x5ab234(0x1a6)](_0x49881b[_0x5ab234(0x18a)]*0x64)/0x64,'averageCommissionRate':Math[_0x5ab234(0x1a6)](_0x49881b[_0x5ab234(0x28c)]*0x64)/0x64})),'merchantBreakdown':_0x15e40[_0x5ab234(0x278)]?undefined:Object['values'](_0x48724e)[_0x5ab234(0x1fb)](_0xcc22a1=>({..._0xcc22a1,'turnoverUSDT':Math[_0x5ab234(0x1a6)](_0xcc22a1[_0x5ab234(0x1b0)]*0x64)/0x64,'commissionUSDT':Math[_0x5ab234(0x1a6)](_0xcc22a1[_0x5ab234(0x20e)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x5ab234(0x1a6)](_0xcc22a1['merchantEarningsUSDT']*0x64)/0x64,'paidOutUSDT':Math[_0x5ab234(0x1a6)](_0xcc22a1[_0x5ab234(0x189)]*0x64)/0x64,'averageCheckUSDT':Math[_0x5ab234(0x1a6)](_0xcc22a1[_0x5ab234(0x20d)]*0x64)/0x64})),'dailyData':Object[_0x5ab234(0x2bb)](_0xdc09cf)[_0x5ab234(0x1fb)](_0x5d08a1=>({..._0x5d08a1,'turnover':Math[_0x5ab234(0x1a6)](_0x5d08a1['turnover']*0x64)/0x64,'merchantEarnings':Math[_0x5ab234(0x1a6)](_0x5d08a1[_0x5ab234(0x2b5)]*0x64)/0x64,'gatewayEarnings':Math[_0x5ab234(0x1a6)](_0x5d08a1[_0x5ab234(0x180)]*0x64)/0x64}))['sort']((_0x271bae,_0x47596)=>_0x271bae[_0x5ab234(0x1b4)]['localeCompare'](_0x47596['date'])),'periodInfo':{'from':_0x1b8b06,'to':_0x15fbcd,'periodType':_0x15e40[_0x5ab234(0x298)]||_0x5ab234(0x206),'daysCount':_0x47bdd2}};return console[_0x5ab234(0x203)]('📊\x20Merchant\x20statistics\x20calculated:'),console['log'](_0x5ab234(0x1fa)+_0x41ae84[_0x5ab234(0x18c)]+_0x5ab234(0x1df)),console[_0x5ab234(0x203)]('\x20\x20\x20👤\x20Merchant\x20earnings:\x20'+_0x41ae84['merchantEarnings']+'\x20USDT'),console[_0x5ab234(0x203)]('\x20\x20\x20🏪\x20Gateway\x20earnings:\x20'+_0x41ae84[_0x5ab234(0x180)]+'\x20USDT'),console[_0x5ab234(0x203)](_0x5ab234(0x1c1)+_0x41ae84['totalPaidOut']+'\x20USDT'),console[_0x5ab234(0x203)](_0x5ab234(0x225)+_0x41ae84[_0x5ab234(0x1a4)]+_0x5ab234(0x1df)),console['log'](_0x5ab234(0x202)+_0x41ae84[_0x5ab234(0x24b)]),_0x41ae84;}async[a36_0x29f0d9(0x1aa)](){const _0x20e73d=a36_0x29f0d9;console[_0x20e73d(0x203)](_0x20e73d(0x241));const _0x2d3bae=await database_1['default'][_0x20e73d(0x1d2)]['findMany']({'where':{'status':_0x20e73d(0x1f5)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':'asc'}});return console[_0x20e73d(0x203)](_0x20e73d(0x2b6)+_0x2d3bae[_0x20e73d(0x294)]+_0x20e73d(0x1f0)),_0x2d3bae['map'](_0x3b1778=>({'id':_0x3b1778['id'],'username':_0x3b1778[_0x20e73d(0x1f1)],'name':_0x3b1778[_0x20e73d(0x1bd)]}));}['getGatewayDisplayName'](_0x5bbfe9){const _0x5bb904=a36_0x29f0d9,_0x5489bd={'test_gateway':_0x5bb904(0x22d),'plisio':'Plisio','rapyd':_0x5bb904(0x28a),'noda':_0x5bb904(0x24a),'cointopay':'CoinToPay','cointopay2':_0x5bb904(0x2a3),'klyme_eu':_0x5bb904(0x248),'klyme_gb':_0x5bb904(0x190),'klyme_de':_0x5bb904(0x17e),'mastercard':_0x5bb904(0x1ce)};return _0x5489bd[_0x5bbfe9]||_0x5bbfe9;}[a36_0x29f0d9(0x1bf)](_0x430287){const _0x360ff6=a36_0x29f0d9,_0x114f5a={'Test\x20Gateway':_0x360ff6(0x25e),'Plisio':'plisio','Rapyd':_0x360ff6(0x1d6),'Noda':_0x360ff6(0x1c6),'CoinToPay':_0x360ff6(0x17f),'CoinToPay2':_0x360ff6(0x277),'KLYME\x20EU':_0x360ff6(0x238),'KLYME\x20GB':_0x360ff6(0x2ab),'KLYME\x20DE':_0x360ff6(0x25f),'MasterCard':'mastercard'};return _0x114f5a[_0x430287]||_0x430287['toLowerCase']();}async[a36_0x29f0d9(0x1fc)](_0x201480){const _0x35034b=a36_0x29f0d9,{page:_0x3b7817,limit:_0x3648c8,minAmount:_0xb1f7d9,search:_0x208a83}=_0x201480,_0x261b7a=(_0x3b7817-0x1)*_0x3648c8;console[_0x35034b(0x203)](_0x35034b(0x24c),_0x201480);const _0xf38aca={'balance':{'gt':0x0},'status':_0x35034b(0x1f5)};_0xb1f7d9&&(_0xf38aca[_0x35034b(0x1b9)][_0x35034b(0x187)]=_0xb1f7d9);_0x208a83&&(_0xf38aca[_0x35034b(0x1bd)]={'contains':_0x208a83,'mode':_0x35034b(0x20a)});const [_0x4b16e4,_0x502b71]=await Promise[_0x35034b(0x293)]([database_1[_0x35034b(0x253)][_0x35034b(0x1d2)][_0x35034b(0x1ef)]({'where':_0xf38aca,'skip':_0x261b7a,'take':_0x3648c8,'orderBy':{'balance':_0x35034b(0x296)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1['default'][_0x35034b(0x1d2)]['count']({'where':_0xf38aca})]);console[_0x35034b(0x203)](_0x35034b(0x214)+_0x4b16e4[_0x35034b(0x294)]+_0x35034b(0x249));const _0x579b29=await Promise[_0x35034b(0x293)](_0x4b16e4[_0x35034b(0x1fb)](async _0x32cbff=>{const _0x400b10=_0x35034b,[_0x98e6b5,_0x4bca9c,_0x1223d1]=await Promise[_0x400b10(0x293)]([database_1['default']['payment'][_0x400b10(0x17a)]({'where':{'shopId':_0x32cbff['id'],'status':'PAID','gateway':{'not':'test_gateway'}}}),database_1[_0x400b10(0x253)][_0x400b10(0x1e0)]['findFirst']({'where':{'shopId':_0x32cbff['id'],'status':_0x400b10(0x1a0),'gateway':{'not':'test_gateway'}},'orderBy':{'paidAt':_0x400b10(0x1c7)},'select':{'paidAt':!![]}}),database_1[_0x400b10(0x253)]['payment']['groupBy']({'by':['gateway'],'where':{'shopId':_0x32cbff['id'],'status':_0x400b10(0x1a0),'gateway':{'not':_0x400b10(0x25e)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x375c63=new Date(),_0xb04110=new Date(_0x375c63[_0x400b10(0x182)](),_0x375c63[_0x400b10(0x23c)](),0x1),_0x4d8a8a=new Date(_0x375c63[_0x400b10(0x182)](),_0x375c63[_0x400b10(0x23c)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x29a011,_0x26745d]=await Promise['all']([database_1[_0x400b10(0x253)]['payout'][_0x400b10(0x268)]({'_sum':{'amount':!![]},'where':{'shopId':_0x32cbff['id'],'status':_0x400b10(0x1ad)}}),database_1[_0x400b10(0x253)][_0x400b10(0x299)]['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x32cbff['id'],'status':'COMPLETED','createdAt':{'gte':_0xb04110,'lte':_0x4d8a8a}}})]),_0x4aba1c=_0x29a011['_sum'][_0x400b10(0x1d3)]||0x0,_0x4109e1=_0x26745d[_0x400b10(0x1d7)]['amount']||0x0,_0x134d48=await Promise[_0x400b10(0x293)](_0x1223d1[_0x400b10(0x1fb)](async _0x28544e=>{const _0xfa45e=_0x400b10;let _0x25a93f=0x2d;if(_0x32cbff[_0xfa45e(0x233)])try{const _0x230710=JSON[_0xfa45e(0x2bd)](_0x32cbff['gatewaySettings']);for(const [_0x5b2e81,_0x1f76b2]of Object[_0xfa45e(0x26e)](_0x230710)){if(_0x5b2e81['toLowerCase']()===_0x28544e[_0xfa45e(0x22b)]['toLowerCase']()){_0x25a93f=_0x1f76b2['commission']||0xa,console['log'](_0xfa45e(0x1d4)+_0x28544e[_0xfa45e(0x22b)]+'\x20for\x20shop\x20'+_0x32cbff['id']+_0xfa45e(0x200)+_0x25a93f+'%');break;}}}catch(_0x598d6c){console['error']('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x32cbff['id']+':',_0x598d6c);}const _0x38fa80=_0x28544e[_0xfa45e(0x1d7)]?.[_0xfa45e(0x240)]||0x0,_0x18115c=_0x38fa80*(0x1-_0x25a93f/0x64);return{'gateway':_0x28544e['gateway'],'count':_0x28544e[_0xfa45e(0x1cd)]?.['id']||0x0,'amountUSDT':Math[_0xfa45e(0x1a6)](_0x38fa80*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0xfa45e(0x1a6)](_0x18115c*0x64)/0x64,'commission':_0x25a93f};})),_0x57514b=_0x134d48['reduce']((_0x4ece8f,_0x458ba1)=>_0x4ece8f+_0x458ba1[_0x400b10(0x240)],0x0),_0x4d1cba=_0x134d48[_0x400b10(0x1ba)]((_0x52ab9c,_0x41f80a)=>_0x52ab9c+_0x41f80a[_0x400b10(0x223)],0x0),_0x39f52e=_0x32cbff['balance'];return console[_0x400b10(0x203)](_0x400b10(0x1da)+_0x32cbff[_0x400b10(0x1f1)]+':'),console['log']('\x20\x20\x20�\x20Total\x20payments\x20turnover:\x20'+_0x57514b['toFixed'](0x2)+'\x20USDT\x20(gross\x20revenue)'),console[_0x400b10(0x203)](_0x400b10(0x2bf)+_0x4d1cba[_0x400b10(0x20f)](0x2)+_0x400b10(0x29d)),console[_0x400b10(0x203)](_0x400b10(0x17d)+_0x39f52e[_0x400b10(0x20f)](0x2)+'\x20USDT\x20(current\x20balance\x20in\x20DB)'),console[_0x400b10(0x203)](_0x400b10(0x211)+_0x4aba1c[_0x400b10(0x20f)](0x2)+_0x400b10(0x205)),console[_0x400b10(0x203)]('\x20\x20\x20🤔\x20Difference:\x20'+(_0x4d1cba-_0x4aba1c-_0x39f52e)['toFixed'](0x2)+_0x400b10(0x1cf)),{'id':_0x32cbff['id'],'fullName':_0x32cbff['name'],'username':_0x32cbff[_0x400b10(0x1f1)],'telegramId':_0x32cbff[_0x400b10(0x295)],'merchantUrl':_0x32cbff[_0x400b10(0x25b)],'wallets':{'usdtPolygonWallet':_0x32cbff[_0x400b10(0x2ae)],'usdtTrcWallet':_0x32cbff['usdtTrcWallet'],'usdtErcWallet':_0x32cbff[_0x400b10(0x23b)],'usdcPolygonWallet':_0x32cbff[_0x400b10(0x27f)]},'totalAmountUSDT':Math['round'](_0x57514b*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x400b10(0x1a6)](_0x4d1cba*0x64)/0x64,'currentBalance':Math[_0x400b10(0x1a6)](_0x39f52e*0x64)/0x64,'totalPayout':Math[_0x400b10(0x1a6)](_0x4aba1c*0x64)/0x64,'thisMonth':Math[_0x400b10(0x1a6)](_0x4109e1*0x64)/0x64,'paymentsCount':_0x98e6b5,'oldestPaymentDate':_0x4bca9c?.[_0x400b10(0x237)]||_0x32cbff[_0x400b10(0x1ea)],'gatewayBreakdown':_0x134d48};})),_0x542be0=_0x579b29['reduce']((_0x586a53,_0x202ba1)=>_0x586a53+_0x202ba1[_0x35034b(0x2a6)],0x0),_0x4528a7=_0x579b29[_0x35034b(0x1ba)]((_0x4ea697,_0x11cef5)=>_0x4ea697+_0x11cef5[_0x35034b(0x207)],0x0),_0x43e16d=_0x579b29[_0x35034b(0x1ba)]((_0x3defce,_0x32d8cd)=>_0x3defce+_0x32d8cd[_0x35034b(0x263)],0x0),_0x84140e=_0x579b29[_0x35034b(0x1ba)]((_0x3e81db,_0x467250)=>_0x3e81db+_0x467250['thisMonth'],0x0);return console['log']('📊\x20Merchants\x20awaiting\x20payout:\x20'+_0x502b71+'\x20merchants'),console[_0x35034b(0x203)](_0x35034b(0x1a3)+Math['round'](_0x542be0*0x64)/0x64+_0x35034b(0x280)),console['log']('\x20\x20\x20✅\x20Total\x20available\x20for\x20payout:\x20'+Math[_0x35034b(0x1a6)](_0x4528a7*0x64)/0x64+_0x35034b(0x25c)),console[_0x35034b(0x203)](_0x35034b(0x218)+Math[_0x35034b(0x1a6)](_0x43e16d*0x64)/0x64+_0x35034b(0x1df)),console[_0x35034b(0x203)]('\x20\x20\x20📅\x20Total\x20payouts\x20(this\x20month):\x20'+Math[_0x35034b(0x1a6)](_0x84140e*0x64)/0x64+'\x20USDT'),{'merchants':_0x579b29,'pagination':{'page':_0x3b7817,'limit':_0x3648c8,'total':_0x502b71,'totalPages':Math[_0x35034b(0x209)](_0x502b71/_0x3648c8)},'summary':{'totalMerchants':_0x502b71,'totalAmountUSDT':Math[_0x35034b(0x1a6)](_0x542be0*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x35034b(0x1a6)](_0x4528a7*0x64)/0x64,'totalPayout':Math[_0x35034b(0x1a6)](_0x43e16d*0x64)/0x64,'thisMonth':Math['round'](_0x84140e*0x64)/0x64}};}async[a36_0x29f0d9(0x21b)](_0x1a2ecf){const _0x32e656=a36_0x29f0d9,{shopId:_0x11e43d,amount:_0x1d1fa3,network:_0x48cd90,wallet:_0x1116df,notes:_0x4e7d04,txid:_0x9aa4f0,periodFrom:_0x72cdac,periodTo:_0x582043}=_0x1a2ecf,_0x35584b=await database_1[_0x32e656(0x253)][_0x32e656(0x181)](async _0x2c9006=>{const _0xaf8e99=_0x32e656,_0x4be79d=await _0x2c9006[_0xaf8e99(0x1d2)][_0xaf8e99(0x197)]({'where':{'id':_0x11e43d},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x4be79d)throw new Error(_0xaf8e99(0x234));console['log'](_0xaf8e99(0x1b3)+_0x4be79d[_0xaf8e99(0x1f1)]+':'),console[_0xaf8e99(0x203)](_0xaf8e99(0x201)+_0x4be79d[_0xaf8e99(0x1b9)]['toFixed'](0x6)+'\x20USDT'),console[_0xaf8e99(0x203)](_0xaf8e99(0x1f9)+_0x1d1fa3[_0xaf8e99(0x20f)](0x6)+'\x20USDT'),console[_0xaf8e99(0x203)](_0xaf8e99(0x19f)+_0x4be79d[_0xaf8e99(0x258)][_0xaf8e99(0x20f)](0x6)+_0xaf8e99(0x1df));if(_0x9aa4f0)console[_0xaf8e99(0x203)]('\x20\x20\x20Transaction\x20hash:\x20'+_0x9aa4f0);if(_0x4be79d[_0xaf8e99(0x1b9)]<_0x1d1fa3)throw new Error('Insufficient\x20balance.\x20Available:\x20'+_0x4be79d[_0xaf8e99(0x1b9)][_0xaf8e99(0x20f)](0x6)+_0xaf8e99(0x1ac)+_0x1d1fa3['toFixed'](0x6)+_0xaf8e99(0x1df));let _0x54c7b2=_0x1116df;if(!_0x54c7b2){const _0x2572ea=await _0x2c9006[_0xaf8e99(0x1d2)][_0xaf8e99(0x197)]({'where':{'id':_0x11e43d},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x2572ea)switch(_0x48cd90){case'polygon':_0x54c7b2=_0x2572ea['usdtPolygonWallet']||undefined;break;case _0xaf8e99(0x198):_0x54c7b2=_0x2572ea[_0xaf8e99(0x2b0)]||undefined;break;case _0xaf8e99(0x204):_0x54c7b2=_0x2572ea['usdtErcWallet']||undefined;break;case _0xaf8e99(0x22f):_0x54c7b2=_0x2572ea['usdcPolygonWallet']||undefined;break;}}console[_0xaf8e99(0x203)]('💳\x20Payout\x20wallet\x20for\x20'+_0x48cd90+':\x20'+(_0x54c7b2||_0xaf8e99(0x2aa)));const _0x388af6=await _0x2c9006[_0xaf8e99(0x299)]['create']({'data':{'shopId':_0x11e43d,'amount':_0x1d1fa3,'network':_0x48cd90,'status':_0xaf8e99(0x1ad),'txid':_0x9aa4f0,'notes':_0x4e7d04,'periodFrom':_0x72cdac?new Date(_0x72cdac):null,'periodTo':_0x582043?new Date(_0x582043):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x3c05b0=_0x4be79d[_0xaf8e99(0x1b9)]-_0x1d1fa3,_0x57d060=_0x4be79d['totalPaidOut']+_0x1d1fa3;return await _0x2c9006[_0xaf8e99(0x1d2)][_0xaf8e99(0x22c)]({'where':{'id':_0x11e43d},'data':{'balance':_0x3c05b0,'totalPaidOut':_0x57d060}}),console['log'](_0xaf8e99(0x2b3)+_0x4be79d[_0xaf8e99(0x1f1)]+'\x20balance\x20updated:'),console[_0xaf8e99(0x203)]('\x20\x20\x20Balance:\x20'+_0x4be79d[_0xaf8e99(0x1b9)]['toFixed'](0x6)+'\x20->\x20'+_0x3c05b0[_0xaf8e99(0x20f)](0x6)+_0xaf8e99(0x1ed)+_0x1d1fa3['toFixed'](0x6)+')'),console[_0xaf8e99(0x203)](_0xaf8e99(0x29e)+_0x4be79d[_0xaf8e99(0x258)][_0xaf8e99(0x20f)](0x6)+'\x20->\x20'+_0x57d060[_0xaf8e99(0x20f)](0x6)+_0xaf8e99(0x29b)+_0x1d1fa3[_0xaf8e99(0x20f)](0x6)+')'),{'payout':_0x388af6,'shop':_0x4be79d};});return console[_0x32e656(0x203)](_0x32e656(0x22e)+_0x35584b[_0x32e656(0x299)]['id']+'\x20for\x20shop\x20'+_0x35584b[_0x32e656(0x1d2)][_0x32e656(0x1f1)]+'\x20('+_0x1d1fa3+_0x32e656(0x2a4)),{'id':_0x35584b['payout']['id'],'shopId':_0x35584b['payout'][_0x32e656(0x278)],'shopName':_0x35584b[_0x32e656(0x1d2)][_0x32e656(0x1bd)],'shopUsername':_0x35584b[_0x32e656(0x1d2)]['username'],'amount':_0x35584b[_0x32e656(0x299)][_0x32e656(0x1d3)],'network':_0x35584b[_0x32e656(0x299)]['network'],'status':_0x35584b[_0x32e656(0x299)]['status'],'txid':_0x35584b['payout']['txid'],'notes':_0x35584b[_0x32e656(0x299)][_0x32e656(0x196)],'periodFrom':_0x35584b[_0x32e656(0x299)][_0x32e656(0x1ff)],'periodTo':_0x35584b['payout'][_0x32e656(0x279)],'createdAt':_0x35584b['payout'][_0x32e656(0x1ea)],'paidAt':_0x35584b['payout'][_0x32e656(0x237)]};}async[a36_0x29f0d9(0x22a)](_0x16487f){const _0x103d8b=a36_0x29f0d9,{page:_0x236390,limit:_0x5efa93,shopId:_0x5eff00,network:_0x585bd1,dateFrom:_0xe9d652,dateTo:_0xd86903,search:_0x18b809}=_0x16487f,_0x1fe5dd=(_0x236390-0x1)*_0x5efa93,_0x59dc0b={};_0x5eff00&&(_0x59dc0b[_0x103d8b(0x278)]=_0x5eff00);_0x585bd1&&(_0x59dc0b[_0x103d8b(0x1e4)]=_0x585bd1);(_0xe9d652||_0xd86903)&&(_0x59dc0b[_0x103d8b(0x1ea)]={},_0xe9d652&&(_0x59dc0b[_0x103d8b(0x1ea)][_0x103d8b(0x187)]=new Date(_0xe9d652)),_0xd86903&&(_0x59dc0b[_0x103d8b(0x1ea)]['lte']=new Date(_0xd86903)));_0x18b809&&(_0x59dc0b['OR']=[{'shop':{'name':{'contains':_0x18b809,'mode':_0x103d8b(0x20a)}}},{'shop':{'username':{'contains':_0x18b809,'mode':'insensitive'}}},{'notes':{'contains':_0x18b809,'mode':_0x103d8b(0x20a)}}]);const [_0xf7762a,_0x5bb7c2]=await Promise[_0x103d8b(0x293)]([database_1['default']['payout'][_0x103d8b(0x1ef)]({'where':_0x59dc0b,'skip':_0x1fe5dd,'take':_0x5efa93,'orderBy':{'createdAt':_0x103d8b(0x296)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default']['payout']['count']({'where':_0x59dc0b})]);return{'payouts':_0xf7762a[_0x103d8b(0x1fb)](_0x3220e4=>({'id':_0x3220e4['id'],'shopId':_0x3220e4[_0x103d8b(0x278)],'shopName':_0x3220e4[_0x103d8b(0x1d2)][_0x103d8b(0x1bd)],'shopUsername':_0x3220e4[_0x103d8b(0x1d2)][_0x103d8b(0x1f1)],'amount':_0x3220e4[_0x103d8b(0x1d3)],'network':_0x3220e4[_0x103d8b(0x1e4)],'status':_0x3220e4[_0x103d8b(0x1cb)],'txid':_0x3220e4['txid'],'notes':_0x3220e4[_0x103d8b(0x196)],'periodFrom':_0x3220e4[_0x103d8b(0x1ff)],'periodTo':_0x3220e4[_0x103d8b(0x279)],'createdAt':_0x3220e4['createdAt'],'paidAt':_0x3220e4[_0x103d8b(0x237)]})),'pagination':{'page':_0x236390,'limit':_0x5efa93,'total':_0x5bb7c2,'totalPages':Math[_0x103d8b(0x209)](_0x5bb7c2/_0x5efa93)}};}async['getPayoutById'](_0x529649){const _0x399b93=a36_0x29f0d9,_0x4b163d=await database_1[_0x399b93(0x253)][_0x399b93(0x299)]['findUnique']({'where':{'id':_0x529649},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x4b163d)return null;return{'id':_0x4b163d['id'],'shopId':_0x4b163d[_0x399b93(0x278)],'shopName':_0x4b163d[_0x399b93(0x1d2)][_0x399b93(0x1bd)],'shopUsername':_0x4b163d[_0x399b93(0x1d2)][_0x399b93(0x1f1)],'amount':_0x4b163d[_0x399b93(0x1d3)],'network':_0x4b163d['network'],'status':_0x4b163d[_0x399b93(0x1cb)],'txid':_0x4b163d[_0x399b93(0x191)],'notes':_0x4b163d[_0x399b93(0x196)],'periodFrom':_0x4b163d[_0x399b93(0x1ff)],'periodTo':_0x4b163d[_0x399b93(0x279)],'createdAt':_0x4b163d['createdAt'],'paidAt':_0x4b163d['paidAt']};}async['deletePayout'](_0xcacf78){const _0x11c481=a36_0x29f0d9;await database_1['default']['payout'][_0x11c481(0x21a)]({'where':{'id':_0xcacf78}});}async[a36_0x29f0d9(0x260)](_0x2923c2){const _0x246622=a36_0x29f0d9,{page:_0x32eb41,limit:_0x385d0b,status:_0xe77b38,gateway:_0x379dd9,shopId:_0x2d9c96,dateFrom:_0x23b29a,dateTo:_0x2f7b07,search:_0xadd3cb,currency:_0x4ccd96,sortBy:_0x225ff0,sortOrder:_0x4ed8f3}=_0x2923c2,_0x2624c8=(_0x32eb41-0x1)*_0x385d0b;console['log'](_0x246622(0x17b),_0x2923c2);const _0xeca34a=await database_1[_0x246622(0x253)][_0x246622(0x1e0)][_0x246622(0x2ad)]({'by':[_0x246622(0x22b)],'_count':{'gateway':!![]}});console[_0x246622(0x203)](_0x246622(0x1ab),_0xeca34a[_0x246622(0x1fb)](_0x4bb5e2=>_0x4bb5e2[_0x246622(0x22b)]+'\x20('+_0x4bb5e2[_0x246622(0x1cd)]['gateway']+_0x246622(0x179)));if(_0x379dd9){const _0x260be4=_0xeca34a[_0x246622(0x19a)](_0x3c2973=>_0x3c2973[_0x246622(0x22b)]['toLowerCase']()===_0x379dd9[_0x246622(0x275)]());!_0x260be4&&_0x379dd9['toLowerCase']()!==_0x246622(0x25e)&&console['log'](_0x246622(0x27e)+_0x379dd9+_0x246622(0x285)+_0xeca34a[_0x246622(0x1fb)](_0x545a75=>_0x545a75[_0x246622(0x22b)])[_0x246622(0x21f)](',\x20'));}const _0x3f13d2={};_0xe77b38&&(_0x3f13d2[_0x246622(0x1cb)]=_0xe77b38[_0x246622(0x265)]());if(!_0x379dd9)_0x3f13d2[_0x246622(0x22b)]={'not':_0x246622(0x25e)};else{if(_0x379dd9&&(_0x379dd9['toLowerCase']()===_0x246622(0x25e)||_0x379dd9===_0x246622(0x243)))_0x3f13d2[_0x246622(0x22b)]=_0x246622(0x25e);else{let _0x17db92=_0x379dd9;const _0x2c8481=(0x0,gateway_1['getGatewayNameById'])(_0x379dd9);if(_0x2c8481)_0x17db92=_0x2c8481,console[_0x246622(0x203)](_0x246622(0x19c)+_0x379dd9+_0x246622(0x289)+_0x17db92+'\x27');else{const _0x1b7f2c=(0x0,gateway_1[_0x246622(0x26f)])(_0x379dd9);if(_0x1b7f2c){const _0x15f7ec=(0x0,gateway_1[_0x246622(0x282)])(_0x1b7f2c);_0x15f7ec&&(_0x17db92=_0x15f7ec,console['log'](_0x246622(0x270)+_0x379dd9+_0x246622(0x222)+_0x1b7f2c+_0x246622(0x21d)+_0x17db92+'\x27'));}else console[_0x246622(0x203)](_0x246622(0x1ae)+_0x379dd9+'\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)');}const _0x18efd4=await database_1['default'][_0x246622(0x1e0)][_0x246622(0x17a)]({'where':{'gateway':_0x17db92[_0x246622(0x275)]()},'take':0x1});_0x18efd4===0x0?(console['log']('⚠️\x20Gateway\x20\x27'+_0x17db92+'\x27\x20(from\x20\x27'+_0x379dd9+'\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result'),_0x3f13d2[_0x246622(0x22b)]=_0x246622(0x286)):(_0x3f13d2['gateway']=_0x17db92[_0x246622(0x275)](),console[_0x246622(0x203)](_0x246622(0x239)+_0x17db92+'\x27\x20(from\x20\x27'+_0x379dd9+'\x27)'));}}console[_0x246622(0x203)](_0x246622(0x2a5),_0x3f13d2[_0x246622(0x22b)]);_0x2d9c96&&(_0x3f13d2[_0x246622(0x278)]=_0x2d9c96);_0x4ccd96&&(_0x3f13d2[_0x246622(0x231)]=_0x4ccd96[_0x246622(0x265)](),console[_0x246622(0x203)](_0x246622(0x213)+_0x4ccd96[_0x246622(0x265)]()));(_0x23b29a||_0x2f7b07)&&(_0x3f13d2[_0x246622(0x1ea)]={},_0x23b29a&&(_0x3f13d2[_0x246622(0x1ea)]['gte']=new Date(_0x23b29a)),_0x2f7b07&&(_0x3f13d2[_0x246622(0x1ea)][_0x246622(0x254)]=new Date(_0x2f7b07)));_0xadd3cb&&(_0x3f13d2['OR']=[{'id':{'contains':_0xadd3cb,'mode':_0x246622(0x20a)}},{'orderId':{'contains':_0xadd3cb,'mode':_0x246622(0x20a)}},{'gatewayOrderId':{'contains':_0xadd3cb,'mode':_0x246622(0x20a)}},{'customerEmail':{'contains':_0xadd3cb,'mode':_0x246622(0x20a)}},{'shop':{'name':{'contains':_0xadd3cb,'mode':_0x246622(0x20a)}}},{'shop':{'username':{'contains':_0xadd3cb,'mode':'insensitive'}}}]);console['log']('📊\x20Final\x20WHERE\x20conditions:',JSON[_0x246622(0x266)](_0x3f13d2,null,0x2));let _0x5eccf0={'createdAt':_0x246622(0x296)};if(_0x225ff0){const _0x121e4a=[_0x246622(0x1d3),_0x246622(0x1ea),'updatedAt',_0x246622(0x1cb),_0x246622(0x22b),_0x246622(0x231)],_0x4864b6=[_0x246622(0x1c7),_0x246622(0x296)];if(_0x121e4a[_0x246622(0x1bb)](_0x225ff0)){const _0x576caf=_0x4864b6[_0x246622(0x1bb)](_0x4ed8f3)?_0x4ed8f3:_0x246622(0x296);_0x5eccf0={[_0x225ff0]:_0x576caf},console[_0x246622(0x203)](_0x246622(0x1e2)+_0x225ff0+'\x20in\x20'+_0x576caf+_0x246622(0x1eb));}}const [_0x265d74,_0x189371]=await Promise[_0x246622(0x293)]([database_1[_0x246622(0x253)]['payment'][_0x246622(0x1ef)]({'where':_0x3f13d2,'skip':_0x2624c8,'take':_0x385d0b,'orderBy':_0x5eccf0,'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x246622(0x253)][_0x246622(0x1e0)][_0x246622(0x17a)]({'where':_0x3f13d2})]);return{'payments':_0x265d74,'pagination':{'page':_0x32eb41,'limit':_0x385d0b,'total':_0x189371,'totalPages':Math[_0x246622(0x209)](_0x189371/_0x385d0b)}};}async[a36_0x29f0d9(0x20b)](_0x489681){const _0x2fa9de=a36_0x29f0d9,_0xefa89=await database_1[_0x2fa9de(0x253)][_0x2fa9de(0x1e0)]['findUnique']({'where':{'id':_0x489681},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0xefa89)return null;return{'id':_0xefa89['id'],'shopId':_0xefa89[_0x2fa9de(0x278)],'gateway':_0xefa89[_0x2fa9de(0x22b)],'amount':_0xefa89['amount'],'currency':_0xefa89[_0x2fa9de(0x231)],'status':_0xefa89['status'],'orderId':_0xefa89['orderId'],'gatewayOrderId':_0xefa89[_0x2fa9de(0x1e5)],'customerEmail':_0xefa89['customerEmail'],'customerName':_0xefa89[_0x2fa9de(0x283)],'customerCountry':_0xefa89[_0x2fa9de(0x1e3)],'customerIp':_0xefa89['customerIp'],'customerUa':_0xefa89[_0x2fa9de(0x1b8)],'failureMessage':_0xefa89[_0x2fa9de(0x297)],'externalPaymentUrl':_0xefa89[_0x2fa9de(0x1f4)],'successUrl':_0xefa89[_0x2fa9de(0x235)],'failUrl':_0xefa89['failUrl'],'pendingUrl':_0xefa89['pendingUrl'],'whiteUrl':_0xefa89[_0x2fa9de(0x244)],'createdAt':_0xefa89[_0x2fa9de(0x1ea)],'updatedAt':_0xefa89['updatedAt'],'shop':_0xefa89[_0x2fa9de(0x1d2)]};}async[a36_0x29f0d9(0x1e9)](_0x1800dd,_0x47401d,_0x27ef66,_0x33db5d){const _0x5d5d4d=a36_0x29f0d9,_0x10f697=await database_1[_0x5d5d4d(0x253)][_0x5d5d4d(0x181)](async _0x38b654=>{const _0x42e2=_0x5d5d4d,_0x24c44d=await _0x38b654[_0x42e2(0x1e0)]['findUnique']({'where':{'id':_0x1800dd},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x24c44d)throw new Error('Payment\x20not\x20found');const _0x208222=_0x24c44d['status'],_0x476952=_0x47401d['toUpperCase']();console[_0x42e2(0x203)](_0x42e2(0x199)+_0x1800dd+_0x42e2(0x1c9)+_0x208222+_0x42e2(0x264)+_0x476952),console[_0x42e2(0x203)]('💰\x20Current\x20shop\x20balance:\x20'+_0x24c44d['shop'][_0x42e2(0x1b9)]+_0x42e2(0x1df));const _0x4a427d={'status':_0x476952,'updatedAt':new Date(),'statusChangedBy':_0x42e2(0x1be),'statusChangedAt':new Date()};_0x27ef66&&(_0x4a427d[_0x42e2(0x27b)]=_0x27ef66);_0x476952===_0x42e2(0x2b9)&&_0x33db5d&&(_0x4a427d[_0x42e2(0x24e)]=_0x33db5d);let _0x5906cc=0x0,_0xf8f8ab=_0x24c44d[_0x42e2(0x1d2)][_0x42e2(0x1b9)];if(_0x476952===_0x42e2(0x1a0)&&_0x208222!==_0x42e2(0x1a0)){_0x4a427d[_0x42e2(0x237)]=new Date();const _0x3401dc=await currencyService_1[_0x42e2(0x1c5)]['convertToUSDT'](_0x24c44d[_0x42e2(0x1d3)],_0x24c44d['currency']);_0x4a427d[_0x42e2(0x240)]=_0x3401dc;let _0x12ec43=0x2d;const _0x48368b=await _0x38b654[_0x42e2(0x1d2)]['findUnique']({'where':{'id':_0x24c44d[_0x42e2(0x278)]},'select':{'gatewaySettings':!![]}});if(_0x48368b?.[_0x42e2(0x233)])try{const _0x1c1cf3=JSON[_0x42e2(0x2bd)](_0x48368b[_0x42e2(0x233)]);for(const [_0x1fa23f,_0x4b10cf]of Object[_0x42e2(0x26e)](_0x1c1cf3)){if(_0x1fa23f[_0x42e2(0x275)]()===_0x24c44d[_0x42e2(0x22b)][_0x42e2(0x275)]()){_0x12ec43=_0x4b10cf[_0x42e2(0x194)]||0xa;break;}}}catch(_0x563d5a){console[_0x42e2(0x27a)](_0x42e2(0x290)+_0x1800dd+':',_0x563d5a);}let _0x2c0d1e;_0x24c44d[_0x42e2(0x1c4)]!==null&&_0x24c44d[_0x42e2(0x1c4)]!==undefined?(_0x2c0d1e=_0x24c44d['amountAfterGatewayCommissionUSDT'],console['log'](_0x42e2(0x28d)+_0x2c0d1e['toFixed'](0x6)+_0x42e2(0x1cc)+_0x1800dd)):(_0x2c0d1e=_0x3401dc*(0x1-_0x12ec43/0x64),console[_0x42e2(0x203)]('📊\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20'+_0x1800dd+':\x20'+_0x12ec43+'%\x20from\x20'+_0x3401dc[_0x42e2(0x20f)](0x6)+'\x20USDT'),_0x4a427d[_0x42e2(0x1c4)]=_0x2c0d1e,_0x4a427d[_0x42e2(0x261)]=_0x12ec43),_0x5906cc=_0x2c0d1e,_0xf8f8ab+=_0x2c0d1e,console[_0x42e2(0x203)](_0x42e2(0x18d)+_0x1800dd+'\x20became\x20PAID:'),console[_0x42e2(0x203)]('\x20\x20\x20Full\x20amount:\x20'+_0x3401dc[_0x42e2(0x20f)](0x6)+_0x42e2(0x1df)),console[_0x42e2(0x203)](_0x42e2(0x252)+_0x24c44d[_0x42e2(0x22b)]+_0x42e2(0x1a5)+_0x12ec43+'%'),console[_0x42e2(0x203)]('\x20\x20\x20Merchant\x20gets:\x20'+_0x2c0d1e['toFixed'](0x6)+_0x42e2(0x1a2)+_0x12ec43+_0x42e2(0x2a8)),console[_0x42e2(0x203)]('\x20\x20\x20Added\x20to\x20balance:\x20+'+_0x2c0d1e[_0x42e2(0x20f)](0x6)+_0x42e2(0x1df));}else{if(_0x208222===_0x42e2(0x1a0)&&_0x476952!==_0x42e2(0x1a0)){if(_0x24c44d['amountUSDT']){let _0xea9fc6=0x2d;const _0xce04be=await _0x38b654[_0x42e2(0x1d2)][_0x42e2(0x197)]({'where':{'id':_0x24c44d['shopId']},'select':{'gatewaySettings':!![]}});if(_0xce04be?.[_0x42e2(0x233)])try{const _0x24e49f=JSON[_0x42e2(0x2bd)](_0xce04be['gatewaySettings']);for(const [_0x5432fc,_0x4547c5]of Object[_0x42e2(0x26e)](_0x24e49f)){if(_0x5432fc['toLowerCase']()===_0x24c44d[_0x42e2(0x22b)]['toLowerCase']()){_0xea9fc6=_0x4547c5[_0x42e2(0x194)]||0xa;break;}}}catch(_0x365be4){console[_0x42e2(0x27a)](_0x42e2(0x290)+_0x1800dd+':',_0x365be4);}const _0xca29fc=_0x24c44d['amountUSDT']*(0x1-_0xea9fc6/0x64);_0x5906cc=-_0xca29fc,_0xf8f8ab-=_0xca29fc,_0x4a427d[_0x42e2(0x240)]=null,_0x4a427d['amountAfterGatewayCommissionUSDT']=null,console[_0x42e2(0x203)](_0x42e2(0x18d)+_0x1800dd+_0x42e2(0x19b)),console['log'](_0x42e2(0x271)+_0x24c44d['amountUSDT'][_0x42e2(0x20f)](0x6)+_0x42e2(0x1df)),console['log'](_0x42e2(0x252)+_0x24c44d[_0x42e2(0x22b)]+_0x42e2(0x1a5)+_0xea9fc6+'%'),console[_0x42e2(0x203)](_0x42e2(0x23d)+_0xca29fc[_0x42e2(0x20f)](0x6)+_0x42e2(0x1a2)+_0xea9fc6+_0x42e2(0x2a8)),console[_0x42e2(0x203)](_0x42e2(0x217)+_0xca29fc[_0x42e2(0x20f)](0x6)+_0x42e2(0x1df));}}}_0x476952==='CHARGEBACK'&&(_0x208222===_0x42e2(0x1a0)&&_0x24c44d[_0x42e2(0x240)]&&console[_0x42e2(0x203)]('💸\x20CHARGEBACK:\x20Merchant\x20amount\x20already\x20deducted\x20from\x20balance'),_0x33db5d&&_0x33db5d>0x0&&(_0x5906cc-=_0x33db5d,_0xf8f8ab-=_0x33db5d,console[_0x42e2(0x203)](_0x42e2(0x2b4)+_0x33db5d[_0x42e2(0x20f)](0x6)+_0x42e2(0x2b2))));_0x476952===_0x42e2(0x23e)&&_0x208222===_0x42e2(0x1a0)&&console[_0x42e2(0x203)]('🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance');const _0x387c4e=await _0x38b654[_0x42e2(0x1e0)][_0x42e2(0x22c)]({'where':{'id':_0x1800dd},'data':_0x4a427d,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x5906cc!==0x0&&(await _0x38b654[_0x42e2(0x1d2)][_0x42e2(0x22c)]({'where':{'id':_0x24c44d['shopId']},'data':{'balance':_0xf8f8ab}}),console['log'](_0x42e2(0x2b3)+_0x24c44d[_0x42e2(0x278)]+'\x20balance\x20updated:\x20'+_0x24c44d['shop']['balance']['toFixed'](0x6)+_0x42e2(0x264)+_0xf8f8ab[_0x42e2(0x20f)](0x6)+'\x20USDT\x20('+(_0x5906cc>0x0?'+':'')+_0x5906cc['toFixed'](0x6)+')')),_0x387c4e;});return{'id':_0x10f697['id'],'shopId':_0x10f697[_0x5d5d4d(0x278)],'gateway':_0x10f697[_0x5d5d4d(0x22b)],'amount':_0x10f697[_0x5d5d4d(0x1d3)],'currency':_0x10f697[_0x5d5d4d(0x231)],'status':_0x10f697[_0x5d5d4d(0x1cb)],'orderId':_0x10f697[_0x5d5d4d(0x29c)],'gatewayOrderId':_0x10f697[_0x5d5d4d(0x1e5)],'customerEmail':_0x10f697[_0x5d5d4d(0x281)],'customerName':_0x10f697[_0x5d5d4d(0x283)],'customerCountry':_0x10f697['customerCountry'],'customerIp':_0x10f697[_0x5d5d4d(0x1e8)],'customerUa':_0x10f697[_0x5d5d4d(0x1b8)],'failureMessage':_0x10f697[_0x5d5d4d(0x297)],'adminNotes':_0x10f697['adminNotes'],'chargebackAmount':_0x10f697[_0x5d5d4d(0x24e)],'statusChangedBy':_0x10f697[_0x5d5d4d(0x21c)],'statusChangedAt':_0x10f697['statusChangedAt'],'createdAt':_0x10f697['createdAt'],'updatedAt':_0x10f697[_0x5d5d4d(0x1c2)],'shop':_0x10f697[_0x5d5d4d(0x1d2)]};}async['updateUser'](_0x3d905f,_0xf0f312){const _0x20da2c=a36_0x29f0d9,_0x539104=Math[_0x20da2c(0x227)]()['toString'](0x24)[_0x20da2c(0x1fd)](0x2,0x9);console['log'](_0x20da2c(0x224)+_0x539104+_0x20da2c(0x195)+_0x3d905f);const _0x583720={..._0xf0f312};_0xf0f312['password']&&_0xf0f312[_0x20da2c(0x250)][_0x20da2c(0x18b)]()!==''?(console['log'](_0x20da2c(0x1d1)+_0x539104+_0x20da2c(0x221)+_0x3d905f),_0x583720[_0x20da2c(0x250)]=await bcryptjs_1[_0x20da2c(0x253)][_0x20da2c(0x219)](_0xf0f312['password'],0xc)):(console[_0x20da2c(0x203)](_0x20da2c(0x1d1)+_0x539104+_0x20da2c(0x2a2)),delete _0x583720[_0x20da2c(0x250)]);_0xf0f312[_0x20da2c(0x2b8)]&&(_0x583720[_0x20da2c(0x1bd)]=_0xf0f312[_0x20da2c(0x2b8)],delete _0x583720[_0x20da2c(0x2b8)]);_0xf0f312[_0x20da2c(0x2af)]&&(_0x583720[_0x20da2c(0x295)]=_0xf0f312[_0x20da2c(0x2af)],delete _0x583720['telegramId']);_0xf0f312['merchantUrl']&&(_0x583720[_0x20da2c(0x25b)]=_0xf0f312[_0x20da2c(0x1ee)],delete _0x583720[_0x20da2c(0x1ee)]);if(_0xf0f312[_0x20da2c(0x18e)]){const _0x3aebb8=_0xf0f312[_0x20da2c(0x18e)][_0x20da2c(0x1fb)](_0x308f7e=>this[_0x20da2c(0x1bf)](_0x308f7e));console[_0x20da2c(0x203)](_0x20da2c(0x1db),_0xf0f312[_0x20da2c(0x18e)],'->',_0x3aebb8),_0x583720[_0x20da2c(0x2ba)]=JSON[_0x20da2c(0x266)](_0x3aebb8),delete _0x583720['gateways'];}_0xf0f312['gatewaySettings']&&(console['log'](_0x20da2c(0x1b2)+_0x539104+_0x20da2c(0x17c),_0xf0f312['gatewaySettings']),_0x583720[_0x20da2c(0x233)]=JSON[_0x20da2c(0x266)](_0xf0f312[_0x20da2c(0x233)]),console[_0x20da2c(0x203)](_0x20da2c(0x1b2)+_0x539104+_0x20da2c(0x1e6),_0x583720['gatewaySettings']));_0xf0f312[_0x20da2c(0x257)]&&(_0xf0f312[_0x20da2c(0x257)][_0x20da2c(0x2ae)]!==undefined&&(_0x583720[_0x20da2c(0x2ae)]=_0xf0f312[_0x20da2c(0x257)][_0x20da2c(0x2ae)]||null),_0xf0f312[_0x20da2c(0x257)][_0x20da2c(0x2b0)]!==undefined&&(_0x583720[_0x20da2c(0x2b0)]=_0xf0f312[_0x20da2c(0x257)][_0x20da2c(0x2b0)]||null),_0xf0f312[_0x20da2c(0x257)]['usdtErcWallet']!==undefined&&(_0x583720['usdtErcWallet']=_0xf0f312['wallets'][_0x20da2c(0x23b)]||null),_0xf0f312[_0x20da2c(0x257)][_0x20da2c(0x27f)]!==undefined&&(_0x583720['usdcPolygonWallet']=_0xf0f312[_0x20da2c(0x257)][_0x20da2c(0x27f)]||null),delete _0x583720[_0x20da2c(0x257)]);const _0x1d574a=await database_1['default']['shop'][_0x20da2c(0x22c)]({'where':{'id':_0x3d905f},'data':_0x583720,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console['log'](_0x20da2c(0x28f)+_0x539104+_0x20da2c(0x1a9),_0x1d574a['gatewaySettings']),{'id':_0x1d574a['id'],'fullName':_0x1d574a['name'],'username':_0x1d574a[_0x20da2c(0x1f1)],'telegramId':_0x1d574a[_0x20da2c(0x295)],'merchantUrl':_0x1d574a[_0x20da2c(0x25b)],'gateways':_0x1d574a[_0x20da2c(0x2ba)]?JSON[_0x20da2c(0x2bd)](_0x1d574a[_0x20da2c(0x2ba)]):null,'gatewaySettings':_0x1d574a['gatewaySettings']?JSON[_0x20da2c(0x2bd)](_0x1d574a[_0x20da2c(0x233)]):null,'publicKey':_0x1d574a[_0x20da2c(0x1f8)],'wallets':{'usdtPolygonWallet':_0x1d574a['usdtPolygonWallet'],'usdtTrcWallet':_0x1d574a['usdtTrcWallet'],'usdtErcWallet':_0x1d574a['usdtErcWallet'],'usdcPolygonWallet':_0x1d574a[_0x20da2c(0x27f)]},'status':_0x1d574a[_0x20da2c(0x1cb)],'createdAt':_0x1d574a['createdAt']};}async['suspendUser'](_0x1cdbc6){const _0x519aac=a36_0x29f0d9,_0x5a60de=await database_1[_0x519aac(0x253)][_0x519aac(0x1d2)]['update']({'where':{'id':_0x1cdbc6},'data':{'status':'SUSPENDED'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x5a60de['id'],'fullName':_0x5a60de[_0x519aac(0x1bd)],'username':_0x5a60de[_0x519aac(0x1f1)],'telegramId':_0x5a60de[_0x519aac(0x295)],'merchantUrl':_0x5a60de['shopUrl'],'gateways':_0x5a60de[_0x519aac(0x2ba)]?JSON['parse'](_0x5a60de[_0x519aac(0x2ba)]):null,'gatewaySettings':_0x5a60de[_0x519aac(0x233)]?JSON['parse'](_0x5a60de[_0x519aac(0x233)]):null,'publicKey':_0x5a60de[_0x519aac(0x1f8)],'wallets':{'usdtPolygonWallet':_0x5a60de[_0x519aac(0x2ae)],'usdtTrcWallet':_0x5a60de['usdtTrcWallet'],'usdtErcWallet':_0x5a60de['usdtErcWallet'],'usdcPolygonWallet':_0x5a60de[_0x519aac(0x27f)]},'status':_0x5a60de[_0x519aac(0x1cb)],'createdAt':_0x5a60de[_0x519aac(0x1ea)]};}async[a36_0x29f0d9(0x29f)](_0x5632cb){const _0x2f13dd=a36_0x29f0d9,_0x53bfc6=await database_1['default'][_0x2f13dd(0x1d2)][_0x2f13dd(0x22c)]({'where':{'id':_0x5632cb},'data':{'status':_0x2f13dd(0x1f5)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x53bfc6['id'],'fullName':_0x53bfc6[_0x2f13dd(0x1bd)],'username':_0x53bfc6['username'],'telegramId':_0x53bfc6[_0x2f13dd(0x295)],'merchantUrl':_0x53bfc6[_0x2f13dd(0x25b)],'gateways':_0x53bfc6['paymentGateways']?JSON['parse'](_0x53bfc6[_0x2f13dd(0x2ba)]):null,'gatewaySettings':_0x53bfc6[_0x2f13dd(0x233)]?JSON[_0x2f13dd(0x2bd)](_0x53bfc6[_0x2f13dd(0x233)]):null,'publicKey':_0x53bfc6[_0x2f13dd(0x1f8)],'wallets':{'usdtPolygonWallet':_0x53bfc6[_0x2f13dd(0x2ae)],'usdtTrcWallet':_0x53bfc6[_0x2f13dd(0x2b0)],'usdtErcWallet':_0x53bfc6['usdtErcWallet'],'usdcPolygonWallet':_0x53bfc6['usdcPolygonWallet']},'status':_0x53bfc6[_0x2f13dd(0x1cb)],'createdAt':_0x53bfc6[_0x2f13dd(0x1ea)]};}async[a36_0x29f0d9(0x2a1)](_0x5ae5b8){const _0x449684=a36_0x29f0d9,{page:_0x242462,limit:_0x55f1fc,status:_0xe7f402}=_0x5ae5b8,_0x41a0fb=(_0x242462-0x1)*_0x55f1fc,_0x5588a7={};_0xe7f402&&(_0x5588a7['status']=_0xe7f402[_0x449684(0x265)]());const [_0x57a482,_0x3a949e]=await Promise['all']([database_1[_0x449684(0x253)][_0x449684(0x1d2)][_0x449684(0x1ef)]({'where':_0x5588a7,'skip':_0x41a0fb,'take':_0x55f1fc,'orderBy':{'createdAt':_0x449684(0x296)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1['default'][_0x449684(0x1d2)][_0x449684(0x17a)]({'where':_0x5588a7})]);return{'users':_0x57a482['map'](_0xbb91d0=>{const _0x143b03=_0x449684,_0x37386c=_0xbb91d0[_0x143b03(0x2ba)]?JSON[_0x143b03(0x2bd)](_0xbb91d0[_0x143b03(0x2ba)]):null,_0x46bada=_0x37386c?_0x37386c[_0x143b03(0x1fb)](_0x5e72c2=>this[_0x143b03(0x1bc)](_0x5e72c2)):null;return{'id':_0xbb91d0['id'],'fullName':_0xbb91d0['name'],'username':_0xbb91d0['username'],'telegramId':_0xbb91d0[_0x143b03(0x295)],'merchantUrl':_0xbb91d0['shopUrl'],'gateways':_0x46bada,'gatewaySettings':_0xbb91d0['gatewaySettings']?JSON[_0x143b03(0x2bd)](_0xbb91d0[_0x143b03(0x233)]):null,'publicKey':_0xbb91d0[_0x143b03(0x1f8)],'wallets':{'usdtPolygonWallet':_0xbb91d0[_0x143b03(0x2ae)],'usdtTrcWallet':_0xbb91d0[_0x143b03(0x2b0)],'usdtErcWallet':_0xbb91d0[_0x143b03(0x23b)],'usdcPolygonWallet':_0xbb91d0['usdcPolygonWallet']},'status':_0xbb91d0[_0x143b03(0x1cb)],'createdAt':_0xbb91d0[_0x143b03(0x1ea)]};}),'pagination':{'page':_0x242462,'limit':_0x55f1fc,'total':_0x3a949e,'totalPages':Math[_0x449684(0x209)](_0x3a949e/_0x55f1fc)}};}async[a36_0x29f0d9(0x25a)](_0x36a17b){const _0x482e2b=a36_0x29f0d9,_0x3a715a=await database_1[_0x482e2b(0x253)][_0x482e2b(0x1d2)][_0x482e2b(0x197)]({'where':{'id':_0x36a17b},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x3a715a)return null;const _0x35c38b=_0x3a715a[_0x482e2b(0x2ba)]?JSON[_0x482e2b(0x2bd)](_0x3a715a[_0x482e2b(0x2ba)]):null,_0x2a7585=_0x35c38b?_0x35c38b[_0x482e2b(0x1fb)](_0x643061=>this['getGatewayDisplayName'](_0x643061)):null;return _0x35c38b&&_0x2a7585&&console[_0x482e2b(0x203)](_0x482e2b(0x28b),_0x35c38b,'->',_0x2a7585),{'id':_0x3a715a['id'],'fullName':_0x3a715a[_0x482e2b(0x1bd)],'username':_0x3a715a['username'],'telegramId':_0x3a715a['telegram'],'merchantUrl':_0x3a715a[_0x482e2b(0x25b)],'gateways':_0x2a7585,'gatewaySettings':_0x3a715a[_0x482e2b(0x233)]?JSON[_0x482e2b(0x2bd)](_0x3a715a['gatewaySettings']):null,'publicKey':_0x3a715a['publicKey'],'wallets':{'usdtPolygonWallet':_0x3a715a['usdtPolygonWallet'],'usdtTrcWallet':_0x3a715a[_0x482e2b(0x2b0)],'usdtErcWallet':_0x3a715a[_0x482e2b(0x23b)],'usdcPolygonWallet':_0x3a715a[_0x482e2b(0x27f)]},'status':_0x3a715a[_0x482e2b(0x1cb)],'createdAt':_0x3a715a[_0x482e2b(0x1ea)]};}async['createUser'](_0x2107bd){const _0x4207b8=a36_0x29f0d9,{fullName:_0x39e772,username:_0x3232f7,password:_0x5959f3,telegramId:_0xe686d9,merchantUrl:_0xa35123,gateways:_0x1fa330,gatewaySettings:_0x57e4a6,wallets:_0x142f70}=_0x2107bd,_0x191273=await database_1[_0x4207b8(0x253)][_0x4207b8(0x1d2)][_0x4207b8(0x197)]({'where':{'username':_0x3232f7}});if(_0x191273)throw new Error(_0x4207b8(0x1e7));if(_0xe686d9){const _0x17b196=await database_1['default']['shop']['findUnique']({'where':{'telegram':_0xe686d9}});if(_0x17b196)throw new Error(_0x4207b8(0x251));}const _0x30764a=await bcryptjs_1[_0x4207b8(0x253)][_0x4207b8(0x219)](_0x5959f3,0xc),_0x48b2ff='pk_'+crypto_1[_0x4207b8(0x253)][_0x4207b8(0x284)](0x20)['toString'](_0x4207b8(0x269)),_0x12604a=_0x4207b8(0x1f2)+crypto_1[_0x4207b8(0x253)][_0x4207b8(0x284)](0x20)[_0x4207b8(0x18f)](_0x4207b8(0x269)),_0x261b74=_0x1fa330?_0x1fa330['map'](_0x1b6a17=>this[_0x4207b8(0x1bf)](_0x1b6a17)):null;_0x1fa330&&_0x261b74&&console[_0x4207b8(0x203)](_0x4207b8(0x2b7),_0x1fa330,'->',_0x261b74);const _0x4151ca=await database_1[_0x4207b8(0x253)][_0x4207b8(0x1d2)][_0x4207b8(0x1d9)]({'data':{'name':_0x39e772,'username':_0x3232f7,'password':_0x30764a,'telegram':_0xe686d9,'shopUrl':_0xa35123,'paymentGateways':_0x261b74?JSON['stringify'](_0x261b74):null,'gatewaySettings':_0x57e4a6?JSON[_0x4207b8(0x266)](_0x57e4a6):null,'usdtPolygonWallet':_0x142f70?.['usdtPolygonWallet']||null,'usdtTrcWallet':_0x142f70?.[_0x4207b8(0x2b0)]||null,'usdtErcWallet':_0x142f70?.['usdtErcWallet']||null,'usdcPolygonWallet':_0x142f70?.[_0x4207b8(0x27f)]||null,'publicKey':_0x48b2ff,'secretKey':_0x12604a,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4151ca['id'],'fullName':_0x4151ca[_0x4207b8(0x1bd)],'username':_0x4151ca[_0x4207b8(0x1f1)],'telegramId':_0x4151ca['telegram'],'merchantUrl':_0x4151ca[_0x4207b8(0x25b)],'gateways':_0x4151ca[_0x4207b8(0x2ba)]?JSON[_0x4207b8(0x2bd)](_0x4151ca[_0x4207b8(0x2ba)]):null,'gatewaySettings':_0x4151ca[_0x4207b8(0x233)]?JSON[_0x4207b8(0x2bd)](_0x4151ca['gatewaySettings']):null,'publicKey':_0x4151ca[_0x4207b8(0x1f8)],'wallets':{'usdtPolygonWallet':_0x4151ca[_0x4207b8(0x2ae)],'usdtTrcWallet':_0x4151ca[_0x4207b8(0x2b0)],'usdtErcWallet':_0x4151ca[_0x4207b8(0x23b)],'usdcPolygonWallet':_0x4151ca['usdcPolygonWallet']},'status':_0x4151ca[_0x4207b8(0x1cb)],'createdAt':_0x4151ca[_0x4207b8(0x1ea)]};}async[a36_0x29f0d9(0x232)](_0x20bfb4){const _0x89fa72=a36_0x29f0d9;await database_1[_0x89fa72(0x253)][_0x89fa72(0x1d2)][_0x89fa72(0x21a)]({'where':{'id':_0x20bfb4}});}[a36_0x29f0d9(0x2be)](_0x117425,_0xf902a6,_0x3a4aed){const _0x33cb76=a36_0x29f0d9,_0x1fbf22=new Map(),_0xe805f6=new Date(_0xf902a6);while(_0xe805f6<=_0x3a4aed){const _0x474ad3=_0xe805f6[_0x33cb76(0x1b1)]()[_0x33cb76(0x1a1)]('T')[0x0];_0x1fbf22[_0x33cb76(0x216)](_0x474ad3,{'revenue':0x0,'count':0x0}),_0xe805f6[_0x33cb76(0x26a)](_0xe805f6[_0x33cb76(0x186)]()+0x1);}for(const _0x2082a0 of _0x117425){const _0x1a3cd5=_0x2082a0[_0x33cb76(0x1ea)][_0x33cb76(0x1b1)]()['split']('T')[0x0],_0x31ee0a=_0x1fbf22[_0x33cb76(0x1e1)](_0x1a3cd5);_0x31ee0a&&(_0x31ee0a[_0x33cb76(0x17a)]+=0x1,_0x2082a0['status']===_0x33cb76(0x1a0)&&(_0x2082a0[_0x33cb76(0x240)]?_0x31ee0a['revenue']+=_0x2082a0[_0x33cb76(0x240)]:console[_0x33cb76(0x203)](_0x33cb76(0x23f)+_0x2082a0['id']+_0x33cb76(0x1c0))));}const _0x352e45=[],_0x5612e8=[];for(const [_0x3d4459,_0x549cac]of _0x1fbf22){_0x352e45[_0x33cb76(0x229)]({'date':_0x3d4459,'amount':Math[_0x33cb76(0x1a6)](_0x549cac[_0x33cb76(0x183)]*0x64)/0x64}),_0x5612e8[_0x33cb76(0x229)]({'date':_0x3d4459,'count':_0x549cac['count']});}return{'dailyRevenue':_0x352e45,'dailyPayments':_0x5612e8};}}exports[a36_0x29f0d9(0x2ac)]=AdminService;