'use strict';const a38_0x24bbe3=a38_0x4aca;function a38_0x4aca(_0x55d3ae,_0x704898){const _0x216043=a38_0x2160();return a38_0x4aca=function(_0x4aca9a,_0x2df687){_0x4aca9a=_0x4aca9a-0x157;let _0xd60cbd=_0x216043[_0x4aca9a];return _0xd60cbd;},a38_0x4aca(_0x55d3ae,_0x704898);}(function(_0x2602a0,_0x28e6d2){const _0x3be16d=a38_0x4aca,_0x43b8c1=_0x2602a0();while(!![]){try{const _0x2e2497=-parseInt(_0x3be16d(0x22f))/0x1+parseInt(_0x3be16d(0x280))/0x2+parseInt(_0x3be16d(0x21b))/0x3+-parseInt(_0x3be16d(0x22a))/0x4*(-parseInt(_0x3be16d(0x1f6))/0x5)+parseInt(_0x3be16d(0x1fd))/0x6*(-parseInt(_0x3be16d(0x175))/0x7)+-parseInt(_0x3be16d(0x184))/0x8+-parseInt(_0x3be16d(0x27b))/0x9*(-parseInt(_0x3be16d(0x19e))/0xa);if(_0x2e2497===_0x28e6d2)break;else _0x43b8c1['push'](_0x43b8c1['shift']());}catch(_0x51437){_0x43b8c1['push'](_0x43b8c1['shift']());}}}(a38_0x2160,0xb2146));function a38_0x2160(){const _0x5c1f8e=['turnover','currencyService','Insufficient\x20balance.\x20Available:\x20','💰\x20Current\x20shop\x20balance:\x20','customerCountry','\x20\x20\x20💸\x20Total\x20payouts\x20(all\x20time):\x20','amount','getGatewayInternalName','lte','updatePaymentStatus','\x20USDT\x20(gross\x20revenue)','shopUrl','values','convertToUSDT','📊\x20Total\x20payments\x20(including\x20failed):\x20','network','MasterCard','\x20USDT\x20(after\x20','orderId','💰\x20Payment\x20','\x20\x20\x20Merchant\x20loses:\x20','date','fullName','gateway','gatewayOrderId','Noda','gateways','\x20USDT\x20(','KLYME\x20EU','\x20USDT\x20for\x20payment\x20','map','gte','paidAt','49nAnHPV','💸\x20CHARGEBACK\x20penalty:\x20-','\x20\x20\x20🌍\x20Country:\x20','🔄\x20Converted\x20gateway\x20name\x20\x27','klyme_de','payment','adminNotes','usdtPolygonWallet','30d','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20','⚠️\x20Payment\x20','💳\x20Payout\x20wallet\x20for\x20','ACTIVE','averageCheckUSDT','\x20for\x20shop\x20','3222000ahKiOC','totalPayments','📊\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','revenue','shop','push',',\x20userId:\x20','\x20USDT,\x20merchant:\x20','amountUSDT','periodFrom','entries','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','📊\x20Available\x20gateways\x20in\x20database:','\x20became\x20PAID:',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','klyme_gb','setDate','create','some','\x20\x20\x20🔍\x20Calculated\x20after\x20commission:\x20','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','✅\x20Using\x20gateway\x20filter:\x20\x27','\x20status:\x20','test_gateway','set','\x20\x20\x20💰\x20Total\x20turnover:\x20','370axvzaB','\x27\x20->\x20ID\x20\x27','hex','turnoverUSDT','\x27\x20->\x20name\x20\x27','getPaymentById','\x20\x20\x20�📊\x20Total\x20payments:\x20','__importDefault',',\x20successful:\x20','getAllUsers','gatewayCommissionRate','\x20no\x20longer\x20PAID:',']\x20Gateway\x20settings\x20JSON\x20string:','Username\x20already\x20exists','currency','\x20USDT\x20(same\x20as\x20awaiting)','txid','\x20USDT\x20(current\x20balance\x20in\x20DB)','not\x20specified','🔄\x20Gateway\x20mapping\x20(create):','warn','📋\x20Found\x20','$transaction','\x20\x20\x20🤔\x20Difference:\x20','cointopay','dailyPayments','getGatewayDisplayName','desc','includes','getPayoutById','🔐\x20[','📊\x20Sorting\x20payments\x20by\x20','\x20PAID\x20payments','NONEXISTENT_GATEWAY_FILTER','update','default','dateFrom','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','periodTo','week','publicKey','__esModule','shopId','usdtErcWallet','updateCustomerData','paymentGateways','\x20\x20\x20💵\x20Available\x20balance:\x20','_count','customerName','\x20->\x20','toLowerCase','successUrl','💱\x20Currency\x20filter\x20applied:\x20','round','💰\x20Found\x20','stringify','totalCommissionRate','split','amountAfterCommissionUSDT','💰\x20[PAYOUT]\x20Gateway\x20','\x20\x20\x20Total\x20paid\x20out:\x20','count','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','\x20\x20\x20💰\x20Total\x20payout:\x20','dateTo','asc','\x20\x20\x20💰\x20Total\x20payments\x20turnover:\x20','getDate','\x20\x20\x20Full\x20amount:\x20','telegramId','toString','cointopay2','_sum','getPayoutStats','🔄\x20Gateway\x20mapping:','averageCommissionRate','erc20_usdc','createPayout','📊\x20Getting\x20payments\x20with\x20filters:','amountAfterGatewayCommissionUSDT','\x20USDT\x20(already\x20paid\x20out)','name','🔄\x20Admin\x20updating\x20payment\x20','usdcErcWallet','mastercard','klyme_eu','dailyRevenue','\x20USDT,\x20Requested:\x20','135jYZOeJ','gatewaySettings','findFirst','notes','\x20\x20\x20⏳\x20Pending\x20payout:\x20','\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)','polygon_usdc','1235298cfWOKp','commissionUSDT','Shop\x20not\x20found','findUnique','getAllPayouts','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','getFullYear','CoinToPay',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','AdminService','totalAmountUSDT','🔄\x20Gateway\x20mapping\x20(get):','COMPLETED','status','getAllPayments','generateDailyStatistics','2020-01-01','usdtTrcWallet','\x20\x20\x20💸\x20Total\x20payouts:\x20','forEach','pendingUrl','reduce','setHours','\x27\x20to\x20name\x20\x27','pendingPayout','💰\x20Shop\x20','PAID','./currencyService','🔍\x20Using\x20gateway\x20\x27','failureMessage','1734648zHCFVz','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','aggregate','randomBytes','REFUND','payout','createUser','activateUser','toFixed','📊\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','username','\x20\x20\x20Gateway:\x20','📊\x20Using\x20saved\x20values\x20for\x20payment\x20','updateUser','\x20\x20\x20�\x20Total\x20paid\x20out:\x20','24628dSLAdH','deleteUser','getMerchantsSelection','findMany','suspendUser','1431971VEmYgk','\x20USDT)','merchantEarningsUSDT','\x20\x20\x20💳\x20Total\x20payments:\x20','\x20\x20\x20📅\x20Total\x20payouts\x20(this\x20month):\x20','sk_','getUserById','insensitive','🔄\x20Converted\x20gateway\x20ID\x20\x27','groupBy','ceil','\x27\x20(from\x20\x27',']\x20Updating\x20password\x20for\x20user\x20','📊\x20Final\x20WHERE\x20conditions:','Payment\x20not\x20found','balance','all','\x20\x20\x20✅\x20Actual\x20available\x20balance:\x20','getMerchantsAwaitingPayout','updatedAt','✅\x20Payout\x20created:\x20','\x20balance\x20updated:','delete','customerUa','random','getMonth','📊\x20Merchants\x20awaiting\x20payout:\x20','🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','Rapyd','yesterday','📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','externalPaymentUrl','localeCompare','not\x20set','availableBalance','paymentsCount','commission','bcryptjs','getTime','custom','failUrl','customerIp','\x20order','join','merchantUrl','KLYME\x20GB','getGatewayIdByName','\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)','\x20\x20\x20Merchant\x20gets:\x20','toISOString','customerEmail','erc20','\x20\x20\x20🌐\x20IP:\x20','⚠️\x20Requested\x20gateway\x20\x27','hash','totalAmountAfterCommissionUSDT','totalPaidOut','createdAt','📊\x20Gateway\x20filter\x20applied:','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','\x20USDT\x20(-','SUSPENDED','getMerchantStatistics','deletePayout','totalPayout','telegram','length','../config/database','gatewayEarnings','📅\x20Period:\x20','polygon','statusChangedAt','toUpperCase','\x20merchants\x20with\x20positive\x20balance','90d','%\x20from\x20','486801RLHuuP','usdcPolygonWallet','\x20balance\x20updated:\x20','\x20USDT','crypto','2519136VnuCen','plisio','password','\x20active\x20merchants\x20for\x20selection','\x20\x20\x20Current\x20balance:\x20','whiteUrl','admin','error','🔧\x20[','parse','chargebackAmount','\x20\x20\x20Transaction\x20hash:\x20','merchantEarnings','CHARGEBACK','wallets','log'];a38_0x2160=function(){return _0x5c1f8e;};return a38_0x2160();}var __importDefault=this&&this[a38_0x24bbe3(0x1a5)]||function(_0x574f31){return _0x574f31&&_0x574f31['__esModule']?_0x574f31:{'default':_0x574f31};};Object['defineProperty'](exports,a38_0x24bbe3(0x1c7),{'value':!![]}),exports[a38_0x24bbe3(0x206)]=void 0x0;const database_1=__importDefault(require(a38_0x24bbe3(0x272))),bcryptjs_1=__importDefault(require(a38_0x24bbe3(0x254))),crypto_1=__importDefault(require(a38_0x24bbe3(0x27f))),currencyService_1=require(a38_0x24bbe3(0x218)),gateway_1=require('../types/gateway');class AdminService{async[a38_0x24bbe3(0x1e7)](){const _0x3deae8=a38_0x24bbe3;console[_0x3deae8(0x28f)]('📊\x20Calculating\x20payout\x20statistics...');const _0xfc95ae=await database_1[_0x3deae8(0x1c1)][_0x3deae8(0x188)][_0x3deae8(0x21d)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x3deae8(0x181)}}),_0x19a9c6=await database_1['default'][_0x3deae8(0x17a)][_0x3deae8(0x1db)]({'where':{'status':_0x3deae8(0x217),'gateway':{'not':_0x3deae8(0x19b)}}}),_0x31062f=new Date(),_0x573770=new Date(_0x31062f[_0x3deae8(0x203)](),_0x31062f[_0x3deae8(0x248)](),0x1),_0x2c9d23=new Date(_0x31062f[_0x3deae8(0x203)](),_0x31062f[_0x3deae8(0x248)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x52135a=await database_1['default'][_0x3deae8(0x220)][_0x3deae8(0x21d)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x573770,'lte':_0x2c9d23},'status':'COMPLETED'}}),_0x1ecf82=_0xfc95ae[_0x3deae8(0x1e6)][_0x3deae8(0x267)]||0x0,_0x3d9eff=_0xfc95ae[_0x3deae8(0x1e6)][_0x3deae8(0x23e)]||0x0,_0x2ac7cd=_0x52135a[_0x3deae8(0x1e6)]['amount']||0x0,_0x27eac5={'totalPayout':Math[_0x3deae8(0x1d3)](_0x1ecf82*0x64)/0x64,'awaitingPayout':Math[_0x3deae8(0x1d3)](_0x3d9eff*0x64)/0x64,'thisMonth':Math[_0x3deae8(0x1d3)](_0x2ac7cd*0x64)/0x64,'availableBalance':Math[_0x3deae8(0x1d3)](_0x3d9eff*0x64)/0x64,'totalPayments':_0x19a9c6};return console[_0x3deae8(0x28f)]('📊\x20Payout\x20statistics\x20calculated:'),console[_0x3deae8(0x28f)](_0x3deae8(0x1dd)+_0x27eac5[_0x3deae8(0x26f)]+'\x20USDT\x20(total\x20paid\x20to\x20merchants)'),console[_0x3deae8(0x28f)]('\x20\x20\x20⏳\x20Awaiting\x20payout:\x20'+_0x27eac5['awaitingPayout']+_0x3deae8(0x25e)),console['log'](_0x3deae8(0x1cc)+_0x27eac5[_0x3deae8(0x251)]+_0x3deae8(0x1ad)),console['log']('\x20\x20\x20📅\x20This\x20month:\x20'+_0x27eac5['thisMonth']+_0x3deae8(0x27e)),console[_0x3deae8(0x28f)](_0x3deae8(0x232)+_0x27eac5[_0x3deae8(0x185)]+_0x3deae8(0x1be)),_0x27eac5;}async[a38_0x24bbe3(0x1ca)](_0x413eb6,_0x2c7095){const _0x30c7bb=a38_0x24bbe3;console['log'](_0x30c7bb(0x17e)+_0x413eb6+':',_0x2c7095);const _0x250c1e=await database_1[_0x30c7bb(0x1c1)]['payment'][_0x30c7bb(0x200)]({'where':{'id':_0x413eb6},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x250c1e)throw new Error(_0x30c7bb(0x23d));const _0x37a1c5={};_0x2c7095[_0x30c7bb(0x158)]!==undefined&&(_0x37a1c5[_0x30c7bb(0x158)]=_0x2c7095[_0x30c7bb(0x158)]||null);_0x2c7095[_0x30c7bb(0x258)]!==undefined&&(_0x37a1c5[_0x30c7bb(0x258)]=_0x2c7095[_0x30c7bb(0x258)]||null);_0x2c7095[_0x30c7bb(0x246)]!==undefined&&(_0x37a1c5[_0x30c7bb(0x246)]=_0x2c7095[_0x30c7bb(0x246)]||null);const _0x185a61=await database_1[_0x30c7bb(0x1c1)][_0x30c7bb(0x17a)][_0x30c7bb(0x1c0)]({'where':{'id':_0x413eb6},'data':{..._0x37a1c5,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x30c7bb(0x28f)]('✅\x20Customer\x20data\x20updated\x20for\x20payment\x20'+_0x413eb6),console[_0x30c7bb(0x28f)](_0x30c7bb(0x177)+_0x250c1e['customerCountry']+_0x30c7bb(0x1cf)+_0x185a61[_0x30c7bb(0x158)]),console[_0x30c7bb(0x28f)](_0x30c7bb(0x263)+_0x250c1e[_0x30c7bb(0x258)]+_0x30c7bb(0x1cf)+_0x185a61[_0x30c7bb(0x258)]),console[_0x30c7bb(0x28f)]('\x20\x20\x20🖥️\x20User\x20Agent:\x20'+(_0x250c1e[_0x30c7bb(0x246)]?_0x30c7bb(0x19c):_0x30c7bb(0x250))+_0x30c7bb(0x1cf)+(_0x185a61['customerUa']?_0x30c7bb(0x19c):_0x30c7bb(0x250))),_0x185a61;}async['getSystemStatistics'](_0x845872){const _0x5983d7=a38_0x24bbe3,_0x1c0e7c=new Date();let _0x5020a0;switch(_0x845872[_0x5983d7(0x1d0)]()){case'day':_0x5020a0=new Date(_0x1c0e7c[_0x5983d7(0x203)](),_0x1c0e7c[_0x5983d7(0x248)](),_0x1c0e7c[_0x5983d7(0x1e1)](),0x0,0x0,0x0,0x0);break;case _0x5983d7(0x24c):const _0x3c06c1=new Date(_0x1c0e7c);_0x3c06c1[_0x5983d7(0x194)](_0x3c06c1[_0x5983d7(0x1e1)]()-0x1),_0x5020a0=new Date(_0x3c06c1[_0x5983d7(0x203)](),_0x3c06c1['getMonth'](),_0x3c06c1[_0x5983d7(0x1e1)](),0x0,0x0,0x0,0x0);break;case'7d':_0x5020a0=new Date(_0x1c0e7c[_0x5983d7(0x255)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x5983d7(0x17d):_0x5020a0=new Date(_0x1c0e7c[_0x5983d7(0x255)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x5983d7(0x279):_0x5020a0=new Date(_0x1c0e7c[_0x5983d7(0x255)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case'all':const _0x556b56=await database_1[_0x5983d7(0x1c1)][_0x5983d7(0x17a)][_0x5983d7(0x1f8)]({'where':{'gateway':{'not':'test_gateway'}},'orderBy':{'createdAt':_0x5983d7(0x1df)},'select':{'createdAt':!![]}});_0x5020a0=_0x556b56?_0x556b56[_0x5983d7(0x268)]:new Date(_0x5983d7(0x20d));break;default:_0x5020a0=new Date(_0x1c0e7c[_0x5983d7(0x255)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}_0x5020a0[_0x5983d7(0x213)](0x0,0x0,0x0,0x0);let _0x4f2044;if(_0x845872[_0x5983d7(0x1d0)]()===_0x5983d7(0x24c)){const _0x2155ec=new Date(_0x1c0e7c);_0x2155ec[_0x5983d7(0x194)](_0x2155ec[_0x5983d7(0x1e1)]()-0x1),_0x4f2044=new Date(_0x2155ec[_0x5983d7(0x203)](),_0x2155ec['getMonth'](),_0x2155ec[_0x5983d7(0x1e1)](),0x17,0x3b,0x3b,0x3e7);}const _0x422bc0={'gte':_0x5020a0};_0x4f2044&&(_0x422bc0[_0x5983d7(0x15c)]=_0x4f2044);const [_0x2d8e7f,_0x4ba48b,_0x2910ba,_0x5dd5b9,_0x2c3434,_0x257006]=await Promise[_0x5983d7(0x23f)]([database_1[_0x5983d7(0x1c1)]['shop'][_0x5983d7(0x1db)](),database_1['default'][_0x5983d7(0x188)]['count']({'where':{'status':'ACTIVE'}}),database_1[_0x5983d7(0x1c1)][_0x5983d7(0x17a)][_0x5983d7(0x1db)]({'where':{'status':'PAID','createdAt':_0x422bc0,'gateway':{'not':_0x5983d7(0x19b)}}}),database_1[_0x5983d7(0x1c1)][_0x5983d7(0x17a)]['findMany']({'where':{'status':_0x5983d7(0x217),'createdAt':_0x422bc0,'gateway':{'not':_0x5983d7(0x19b)}},'select':{'amount':!![],'currency':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1['default'][_0x5983d7(0x17a)][_0x5983d7(0x22d)]({'where':{'gateway':{'not':_0x5983d7(0x19b)}},'take':0xa,'orderBy':{'createdAt':_0x5983d7(0x1b9)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x5983d7(0x1c1)][_0x5983d7(0x17a)]['findMany']({'where':{'createdAt':_0x422bc0,'gateway':{'not':_0x5983d7(0x19b)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x3fe4eb=0x0,_0x2f7ea4=0x0;for(const _0x3c19f9 of _0x5dd5b9){const _0x1335f4=await currencyService_1['currencyService']['convertToUSDT'](_0x3c19f9['amount'],_0x3c19f9[_0x5983d7(0x1ac)]);_0x3fe4eb+=_0x1335f4;if(_0x3c19f9[_0x5983d7(0x1ed)]){const _0x2b237f=await currencyService_1[_0x5983d7(0x291)]['convertToUSDT'](_0x3c19f9[_0x5983d7(0x15a)],_0x3c19f9[_0x5983d7(0x1ac)]),_0x27de0d=_0x3c19f9[_0x5983d7(0x1ed)],_0x9451fe=_0x2b237f-_0x27de0d;_0x2f7ea4+=_0x9451fe;}}const _0x1bd05e=_0x2910ba>0x0?_0x3fe4eb/_0x2910ba:0x0,_0xc24d29=this['generateDailyStatistics'](_0x257006,_0x5020a0,_0x4f2044||_0x1c0e7c),_0x309891=await database_1[_0x5983d7(0x1c1)][_0x5983d7(0x17a)][_0x5983d7(0x1db)]({'where':{'createdAt':_0x422bc0,'gateway':{'not':_0x5983d7(0x19b)}}}),_0x5a44e6=_0x309891>0x0?_0x2910ba/_0x309891*0x64:0x0;return{'totalShops':_0x2d8e7f,'activeShops':_0x4ba48b,'totalPayments':_0x2910ba,'successfulPayments':_0x2910ba,'totalAttempts':_0x309891,'totalRevenue':Math['round'](_0x3fe4eb*0x64)/0x64,'trapayEarnings':Math[_0x5983d7(0x1d3)](_0x2f7ea4*0x64)/0x64,'averagePaymentAmount':Math[_0x5983d7(0x1d3)](_0x1bd05e*0x64)/0x64,'conversionRate':Math['round'](_0x5a44e6*0x64)/0x64,'dailyRevenue':_0xc24d29[_0x5983d7(0x1f4)],'dailyPayments':_0xc24d29[_0x5983d7(0x1b7)],'recentPayments':_0x2c3434['map'](_0x590508=>({'id':_0x590508['id'],'amount':_0x590508[_0x5983d7(0x15a)],'currency':_0x590508[_0x5983d7(0x1ac)],'status':_0x590508[_0x5983d7(0x20a)],'gateway':_0x590508[_0x5983d7(0x16b)],'shop':_0x590508[_0x5983d7(0x188)],'createdAt':_0x590508['createdAt']}))};}async[a38_0x24bbe3(0x26d)](_0x27ab8f){const _0x3badba=a38_0x24bbe3;console[_0x3badba(0x28f)]('📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:',_0x27ab8f);let _0xe0d7ee,_0x2f71eb=new Date();if(_0x27ab8f['period']===_0x3badba(0x256)&&_0x27ab8f[_0x3badba(0x1c2)]&&_0x27ab8f[_0x3badba(0x1de)])_0xe0d7ee=new Date(_0x27ab8f[_0x3badba(0x1c2)]),_0x2f71eb=new Date(_0x27ab8f[_0x3badba(0x1de)]),_0xe0d7ee[_0x3badba(0x213)](0x0,0x0,0x0,0x0),_0x2f71eb[_0x3badba(0x213)](0x17,0x3b,0x3b,0x3e7);else{const _0x278b60=new Date();switch(_0x27ab8f['period']){case _0x3badba(0x1c5):_0xe0d7ee=new Date(_0x278b60[_0x3badba(0x255)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'month':_0xe0d7ee=new Date(_0x278b60[_0x3badba(0x255)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'year':_0xe0d7ee=new Date(_0x278b60[_0x3badba(0x255)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case'all':default:_0xe0d7ee=new Date(_0x3badba(0x20d));break;}_0xe0d7ee[_0x3badba(0x213)](0x0,0x0,0x0,0x0),_0x2f71eb[_0x3badba(0x213)](0x17,0x3b,0x3b,0x3e7);}console[_0x3badba(0x28f)](_0x3badba(0x274)+_0xe0d7ee['toISOString']()+'\x20to\x20'+_0x2f71eb[_0x3badba(0x260)]());const _0x48b247={'status':_0x3badba(0x217),'gateway':{'not':_0x3badba(0x19b)},'paidAt':{'gte':_0xe0d7ee,'lte':_0x2f71eb}};_0x27ab8f[_0x3badba(0x1c8)]&&(_0x48b247[_0x3badba(0x1c8)]=_0x27ab8f['shopId']);const _0x5cb702=await database_1[_0x3badba(0x1c1)][_0x3badba(0x17a)]['findMany']({'where':_0x48b247,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x3badba(0x28f)](_0x3badba(0x1d4)+_0x5cb702[_0x3badba(0x271)]+'\x20paid\x20payments\x20for\x20analysis');const _0x5dff5b={'gateway':{'not':_0x3badba(0x19b)},'createdAt':{'gte':_0xe0d7ee,'lte':_0x2f71eb}};_0x27ab8f[_0x3badba(0x1c8)]&&(_0x5dff5b['shopId']=_0x27ab8f[_0x3badba(0x1c8)]);const _0x5e991e=await database_1[_0x3badba(0x1c1)][_0x3badba(0x17a)][_0x3badba(0x1db)]({'where':_0x5dff5b});console[_0x3badba(0x28f)](_0x3badba(0x162)+_0x5e991e+_0x3badba(0x1a6)+_0x5cb702['length']);let _0x55d94f=0x0,_0x4119e6=0x0,_0x238078=0x0;const _0x643f58={},_0x4af84a={},_0x345a6b={};for(const _0x518ccc of _0x5cb702){try{const _0x43f5dd=_0x518ccc[_0x3badba(0x18c)]||0x0;if(_0x43f5dd<=0x0){console[_0x3badba(0x1b2)](_0x3badba(0x17f)+_0x518ccc['id']+'\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...');continue;}let _0x57b09f,_0x4a8fb4;if(_0x518ccc[_0x3badba(0x1ed)]!==null&&_0x518ccc[_0x3badba(0x1ed)]!==undefined)_0x57b09f=_0x518ccc[_0x3badba(0x1ed)],_0x4a8fb4=_0x43f5dd-_0x57b09f,console[_0x3badba(0x28f)](_0x3badba(0x227)+_0x518ccc['id']+':\x20'+_0x43f5dd['toFixed'](0x6)+_0x3badba(0x18b)+_0x57b09f['toFixed'](0x6)+_0x3badba(0x27e));else{let _0x4716c8={};if(_0x518ccc[_0x3badba(0x188)][_0x3badba(0x1f7)])try{_0x4716c8=JSON[_0x3badba(0x289)](_0x518ccc[_0x3badba(0x188)][_0x3badba(0x1f7)]);}catch(_0x359b79){console['error'](_0x3badba(0x26a)+_0x518ccc[_0x3badba(0x1c8)]+':',_0x359b79);}let _0x566f71=0x2d;for(const [_0x575fe8,_0x434fb9]of Object[_0x3badba(0x18e)](_0x4716c8)){if(_0x575fe8[_0x3badba(0x1d0)]()===_0x518ccc[_0x3badba(0x16b)]['toLowerCase']()){_0x566f71=_0x434fb9['commission']||0x2d;break;}}_0x4a8fb4=_0x43f5dd*(_0x566f71/0x64),_0x57b09f=_0x43f5dd-_0x4a8fb4,console['log'](_0x3badba(0x224)+_0x518ccc['id']+':\x20'+_0x566f71+_0x3badba(0x27a)+_0x43f5dd[_0x3badba(0x223)](0x6)+_0x3badba(0x27e));}_0x55d94f+=_0x43f5dd,_0x4119e6+=_0x57b09f,_0x238078+=_0x4a8fb4;let _0x27a0a9;_0x518ccc['gatewayCommissionRate']!==null&&_0x518ccc['gatewayCommissionRate']!==undefined?(_0x27a0a9=_0x518ccc[_0x3badba(0x1a8)],console[_0x3badba(0x28f)]('📊\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20'+_0x518ccc['id']+':\x20'+_0x27a0a9+'%')):(_0x27a0a9=_0x43f5dd>0x0?_0x4a8fb4/_0x43f5dd*0x64:0x0,console[_0x3badba(0x28f)]('📊\x20Calculated\x20commission\x20rate\x20for\x20payment\x20'+_0x518ccc['id']+':\x20'+_0x27a0a9[_0x3badba(0x223)](0x2)+'%'));!_0x643f58[_0x518ccc[_0x3badba(0x16b)]]&&(_0x643f58[_0x518ccc[_0x3badba(0x16b)]]={'gateway':_0x518ccc[_0x3badba(0x16b)],'gatewayDisplayName':this[_0x3badba(0x1b8)](_0x518ccc[_0x3badba(0x16b)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x643f58[_0x518ccc['gateway']][_0x3badba(0x252)]++,_0x643f58[_0x518ccc[_0x3badba(0x16b)]]['turnoverUSDT']+=_0x43f5dd,_0x643f58[_0x518ccc[_0x3badba(0x16b)]][_0x3badba(0x1fe)]+=_0x4a8fb4,_0x643f58[_0x518ccc['gateway']][_0x3badba(0x231)]+=_0x57b09f,_0x643f58[_0x518ccc[_0x3badba(0x16b)]][_0x3badba(0x1d6)]+=_0x27a0a9;!_0x27ab8f['shopId']&&(!_0x4af84a[_0x518ccc[_0x3badba(0x1c8)]]&&(_0x4af84a[_0x518ccc[_0x3badba(0x1c8)]]={'shopId':_0x518ccc['shopId'],'shopName':_0x518ccc[_0x3badba(0x188)][_0x3badba(0x1ef)],'shopUsername':_0x518ccc['shop'][_0x3badba(0x225)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x4af84a[_0x518ccc['shopId']][_0x3badba(0x252)]++,_0x4af84a[_0x518ccc['shopId']][_0x3badba(0x1a1)]+=_0x43f5dd,_0x4af84a[_0x518ccc[_0x3badba(0x1c8)]][_0x3badba(0x1fe)]+=_0x4a8fb4,_0x4af84a[_0x518ccc[_0x3badba(0x1c8)]][_0x3badba(0x231)]+=_0x57b09f);const _0x150e54=_0x518ccc[_0x3badba(0x174)]['toISOString']()[_0x3badba(0x1d7)]('T')[0x0];!_0x345a6b[_0x150e54]&&(_0x345a6b[_0x150e54]={'date':_0x150e54,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x345a6b[_0x150e54][_0x3badba(0x290)]+=_0x43f5dd,_0x345a6b[_0x150e54][_0x3badba(0x28c)]+=_0x57b09f,_0x345a6b[_0x150e54]['gatewayEarnings']+=_0x4a8fb4,_0x345a6b[_0x150e54]['paymentsCount']++;}catch(_0x98c051){console[_0x3badba(0x287)]('Error\x20processing\x20payment\x20'+_0x518ccc['id']+':',_0x98c051);}}Object[_0x3badba(0x160)](_0x643f58)[_0x3badba(0x210)](_0x5dfa8c=>{const _0x29c693=_0x3badba;_0x5dfa8c[_0x29c693(0x1e9)]=_0x5dfa8c['paymentsCount']>0x0?_0x5dfa8c[_0x29c693(0x1d6)]/_0x5dfa8c['paymentsCount']:0x0,delete _0x5dfa8c[_0x29c693(0x1d6)];}),Object['values'](_0x4af84a)[_0x3badba(0x210)](_0x12a407=>{const _0x3b8347=_0x3badba;_0x12a407[_0x3b8347(0x182)]=_0x12a407[_0x3b8347(0x252)]>0x0?_0x12a407[_0x3b8347(0x1a1)]/_0x12a407[_0x3b8347(0x252)]:0x0;});let _0x1901ec=0x0,_0x9d31b8=0x0;if(_0x27ab8f[_0x3badba(0x1c8)]){const _0x25b7c4=await database_1['default'][_0x3badba(0x220)][_0x3badba(0x22d)]({'where':{'shopId':_0x27ab8f[_0x3badba(0x1c8)],'status':_0x3badba(0x209),'createdAt':{'gte':_0xe0d7ee,'lte':_0x2f71eb}},'select':{'amount':!![]}});_0x1901ec=_0x25b7c4[_0x3badba(0x212)]((_0x48a1e4,_0x1f2018)=>_0x48a1e4+_0x1f2018[_0x3badba(0x15a)],0x0);const _0x1948f6=await database_1[_0x3badba(0x1c1)][_0x3badba(0x220)][_0x3badba(0x22d)]({'where':{'shopId':_0x27ab8f[_0x3badba(0x1c8)],'status':'PENDING','createdAt':{'gte':_0xe0d7ee,'lte':_0x2f71eb}},'select':{'amount':!![]}});_0x9d31b8=_0x1948f6[_0x3badba(0x212)]((_0x17d002,_0x1cdbc0)=>_0x17d002+_0x1cdbc0[_0x3badba(0x15a)],0x0);}const _0x255b4c=_0x5e991e,_0x45ca0d=_0x5cb702[_0x3badba(0x271)],_0x5282ad=_0x45ca0d>0x0?_0x55d94f/_0x45ca0d:0x0,_0x986db7=_0x255b4c>0x0?Math[_0x3badba(0x1d3)](_0x45ca0d/_0x255b4c*0x2710)/0x64:0x0,_0x31457b=Math[_0x3badba(0x239)]((_0x2f71eb['getTime']()-_0xe0d7ee[_0x3badba(0x255)]())/(0x3e8*0x3c*0x3c*0x18)),_0x48c36a={'totalTurnover':Math[_0x3badba(0x1d3)](_0x55d94f*0x64)/0x64,'merchantEarnings':Math['round'](_0x4119e6*0x64)/0x64,'gatewayEarnings':Math[_0x3badba(0x1d3)](_0x238078*0x64)/0x64,'totalPaidOut':Math[_0x3badba(0x1d3)](_0x1901ec*0x64)/0x64,'pendingPayout':Math[_0x3badba(0x1d3)](_0x9d31b8*0x64)/0x64,'averageCheck':Math[_0x3badba(0x1d3)](_0x5282ad*0x64)/0x64,'totalPayments':_0x255b4c,'successfulPayments':_0x45ca0d,'conversionRate':_0x986db7,'gatewayBreakdown':Object[_0x3badba(0x160)](_0x643f58)[_0x3badba(0x172)](_0x1e90ea=>({..._0x1e90ea,'turnoverUSDT':Math['round'](_0x1e90ea[_0x3badba(0x1a1)]*0x64)/0x64,'commissionUSDT':Math[_0x3badba(0x1d3)](_0x1e90ea[_0x3badba(0x1fe)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x3badba(0x1d3)](_0x1e90ea[_0x3badba(0x231)]*0x64)/0x64,'averageCommissionRate':Math['round'](_0x1e90ea['averageCommissionRate']*0x64)/0x64})),'merchantBreakdown':_0x27ab8f[_0x3badba(0x1c8)]?undefined:Object[_0x3badba(0x160)](_0x4af84a)[_0x3badba(0x172)](_0x1b6261=>({..._0x1b6261,'turnoverUSDT':Math[_0x3badba(0x1d3)](_0x1b6261[_0x3badba(0x1a1)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x1b6261[_0x3badba(0x1fe)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x3badba(0x1d3)](_0x1b6261['merchantEarningsUSDT']*0x64)/0x64,'paidOutUSDT':Math['round'](_0x1b6261['paidOutUSDT']*0x64)/0x64,'averageCheckUSDT':Math[_0x3badba(0x1d3)](_0x1b6261[_0x3badba(0x182)]*0x64)/0x64})),'dailyData':Object['values'](_0x345a6b)[_0x3badba(0x172)](_0xc8c2cc=>({..._0xc8c2cc,'turnover':Math[_0x3badba(0x1d3)](_0xc8c2cc[_0x3badba(0x290)]*0x64)/0x64,'merchantEarnings':Math[_0x3badba(0x1d3)](_0xc8c2cc[_0x3badba(0x28c)]*0x64)/0x64,'gatewayEarnings':Math['round'](_0xc8c2cc['gatewayEarnings']*0x64)/0x64}))['sort']((_0x14fc4f,_0x4c5ec3)=>_0x14fc4f[_0x3badba(0x169)][_0x3badba(0x24f)](_0x4c5ec3[_0x3badba(0x169)])),'periodInfo':{'from':_0xe0d7ee,'to':_0x2f71eb,'periodType':_0x27ab8f['period']||_0x3badba(0x256),'daysCount':_0x31457b}};return console['log']('📊\x20Merchant\x20statistics\x20calculated:'),console[_0x3badba(0x28f)](_0x3badba(0x19d)+_0x48c36a['totalTurnover']+_0x3badba(0x27e)),console[_0x3badba(0x28f)](_0x3badba(0x18f)+_0x48c36a[_0x3badba(0x28c)]+_0x3badba(0x27e)),console[_0x3badba(0x28f)](_0x3badba(0x198)+_0x48c36a[_0x3badba(0x273)]+_0x3badba(0x27e)),console['log'](_0x3badba(0x229)+_0x48c36a[_0x3badba(0x267)]+'\x20USDT'),console[_0x3badba(0x28f)](_0x3badba(0x1fa)+_0x48c36a[_0x3badba(0x215)]+_0x3badba(0x27e)),console[_0x3badba(0x28f)](_0x3badba(0x1a4)+_0x48c36a[_0x3badba(0x185)]),_0x48c36a;}async[a38_0x24bbe3(0x22c)](){const _0x58558a=a38_0x24bbe3;console['log']('📋\x20Getting\x20merchants\x20selection\x20list...');const _0x112bf8=await database_1[_0x58558a(0x1c1)][_0x58558a(0x188)][_0x58558a(0x22d)]({'where':{'status':_0x58558a(0x181)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x58558a(0x1df)}});return console[_0x58558a(0x28f)](_0x58558a(0x1b3)+_0x112bf8[_0x58558a(0x271)]+_0x58558a(0x283)),_0x112bf8[_0x58558a(0x172)](_0x5985d2=>({'id':_0x5985d2['id'],'username':_0x5985d2[_0x58558a(0x225)],'name':_0x5985d2[_0x58558a(0x1ef)]}));}[a38_0x24bbe3(0x1b8)](_0x5cf9c4){const _0x327586=a38_0x24bbe3,_0x1c6f26={'test_gateway':'Test\x20Gateway','plisio':'Plisio','rapyd':_0x327586(0x24b),'noda':_0x327586(0x16d),'cointopay':_0x327586(0x204),'cointopay2':'Open\x20Banking\x202','klyme_eu':_0x327586(0x170),'klyme_gb':_0x327586(0x25c),'klyme_de':'KLYME\x20DE','mastercard':_0x327586(0x164)};return _0x1c6f26[_0x5cf9c4]||_0x5cf9c4;}['getGatewayInternalName'](_0x539225){const _0x568206=a38_0x24bbe3,_0x59402f={'Test\x20Gateway':_0x568206(0x19b),'Plisio':_0x568206(0x281),'Rapyd':'rapyd','Noda':'noda','CoinToPay':_0x568206(0x1b6),'CoinToPay2':_0x568206(0x1e5),'KLYME\x20EU':_0x568206(0x1f3),'KLYME\x20GB':_0x568206(0x193),'KLYME\x20DE':_0x568206(0x179),'MasterCard':_0x568206(0x1f2)};return _0x59402f[_0x539225]||_0x539225[_0x568206(0x1d0)]();}async[a38_0x24bbe3(0x241)](_0x50193b){const _0x4e22c2=a38_0x24bbe3,{page:_0x236557,limit:_0x52ab12,minAmount:_0x56110d,search:_0x17c62f}=_0x50193b,_0x365d5f=(_0x236557-0x1)*_0x52ab12;console['log'](_0x4e22c2(0x24d),_0x50193b);const _0x1416c2={'balance':{'gt':0x0},'status':_0x4e22c2(0x181)};_0x56110d&&(_0x1416c2['balance']['gte']=_0x56110d);_0x17c62f&&(_0x1416c2['name']={'contains':_0x17c62f,'mode':_0x4e22c2(0x236)});const [_0x352339,_0x493285]=await Promise[_0x4e22c2(0x23f)]([database_1[_0x4e22c2(0x1c1)][_0x4e22c2(0x188)][_0x4e22c2(0x22d)]({'where':_0x1416c2,'skip':_0x365d5f,'take':_0x52ab12,'orderBy':{'balance':_0x4e22c2(0x1b9)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1[_0x4e22c2(0x1c1)]['shop'][_0x4e22c2(0x1db)]({'where':_0x1416c2})]);console[_0x4e22c2(0x28f)](_0x4e22c2(0x1d4)+_0x352339['length']+_0x4e22c2(0x278));const _0xaaa8dc=await Promise[_0x4e22c2(0x23f)](_0x352339[_0x4e22c2(0x172)](async _0x29770d=>{const _0x4e5008=_0x4e22c2,[_0x397097,_0x2ee577,_0xf04c4f]=await Promise[_0x4e5008(0x23f)]([database_1[_0x4e5008(0x1c1)][_0x4e5008(0x17a)][_0x4e5008(0x1db)]({'where':{'shopId':_0x29770d['id'],'status':_0x4e5008(0x217),'gateway':{'not':_0x4e5008(0x19b)}}}),database_1[_0x4e5008(0x1c1)][_0x4e5008(0x17a)][_0x4e5008(0x1f8)]({'where':{'shopId':_0x29770d['id'],'status':_0x4e5008(0x217),'gateway':{'not':_0x4e5008(0x19b)}},'orderBy':{'paidAt':_0x4e5008(0x1df)},'select':{'paidAt':!![]}}),database_1['default']['payment']['groupBy']({'by':[_0x4e5008(0x16b)],'where':{'shopId':_0x29770d['id'],'status':_0x4e5008(0x217),'gateway':{'not':_0x4e5008(0x19b)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x57e2d1=new Date(),_0x70ad2a=new Date(_0x57e2d1[_0x4e5008(0x203)](),_0x57e2d1['getMonth'](),0x1),_0x3eccf1=new Date(_0x57e2d1[_0x4e5008(0x203)](),_0x57e2d1[_0x4e5008(0x248)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0xa6ad1d,_0x5dee3d]=await Promise['all']([database_1[_0x4e5008(0x1c1)][_0x4e5008(0x220)][_0x4e5008(0x21d)]({'_sum':{'amount':!![]},'where':{'shopId':_0x29770d['id'],'status':_0x4e5008(0x209)}}),database_1['default']['payout'][_0x4e5008(0x21d)]({'_sum':{'amount':!![]},'where':{'shopId':_0x29770d['id'],'status':_0x4e5008(0x209),'createdAt':{'gte':_0x70ad2a,'lte':_0x3eccf1}}})]),_0x57313f=_0xa6ad1d[_0x4e5008(0x1e6)]['amount']||0x0,_0x5ed9ba=_0x5dee3d['_sum'][_0x4e5008(0x15a)]||0x0,_0x15de16=await Promise[_0x4e5008(0x23f)](_0xf04c4f[_0x4e5008(0x172)](async _0x5f30fb=>{const _0x2a02f8=_0x4e5008;let _0x325a45=0x2d;if(_0x29770d[_0x2a02f8(0x1f7)])try{const _0x8c8c0c=JSON[_0x2a02f8(0x289)](_0x29770d[_0x2a02f8(0x1f7)]);for(const [_0x10798f,_0x471e07]of Object[_0x2a02f8(0x18e)](_0x8c8c0c)){if(_0x10798f[_0x2a02f8(0x1d0)]()===_0x5f30fb[_0x2a02f8(0x16b)]['toLowerCase']()){_0x325a45=_0x471e07['commission']||0xa,console[_0x2a02f8(0x28f)](_0x2a02f8(0x1d9)+_0x5f30fb[_0x2a02f8(0x16b)]+_0x2a02f8(0x183)+_0x29770d['id']+':\x20commission\x20=\x20'+_0x325a45+'%');break;}}}catch(_0x339ca4){console[_0x2a02f8(0x287)](_0x2a02f8(0x26a)+_0x29770d['id']+':',_0x339ca4);}const _0x54f6da=_0x5f30fb[_0x2a02f8(0x1e6)]?.[_0x2a02f8(0x18c)]||0x0,_0x3f6bad=_0x54f6da*(0x1-_0x325a45/0x64);return{'gateway':_0x5f30fb['gateway'],'count':_0x5f30fb['_count']?.['id']||0x0,'amountUSDT':Math[_0x2a02f8(0x1d3)](_0x54f6da*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x2a02f8(0x1d3)](_0x3f6bad*0x64)/0x64,'commission':_0x325a45};})),_0x237367=_0x15de16[_0x4e5008(0x212)]((_0x564309,_0x179b08)=>_0x564309+_0x179b08[_0x4e5008(0x18c)],0x0),_0x35749f=_0x15de16['reduce']((_0x382a5f,_0x118703)=>_0x382a5f+_0x118703[_0x4e5008(0x1d8)],0x0),_0x53864e=_0x29770d[_0x4e5008(0x23e)];return console[_0x4e5008(0x28f)]('💰\x20[PAYOUT]\x20Merchant\x20'+_0x29770d['username']+':'),console['log']('\x20\x20\x20�\x20Total\x20payments\x20turnover:\x20'+_0x237367[_0x4e5008(0x223)](0x2)+_0x4e5008(0x15e)),console[_0x4e5008(0x28f)](_0x4e5008(0x197)+_0x35749f['toFixed'](0x2)+'\x20USDT\x20(theoretical\x20net)'),console['log'](_0x4e5008(0x240)+_0x53864e[_0x4e5008(0x223)](0x2)+_0x4e5008(0x1af)),console[_0x4e5008(0x28f)](_0x4e5008(0x20f)+_0x57313f[_0x4e5008(0x223)](0x2)+_0x4e5008(0x1ee)),console[_0x4e5008(0x28f)](_0x4e5008(0x1b5)+(_0x35749f-_0x57313f-_0x53864e)['toFixed'](0x2)+_0x4e5008(0x1fb)),{'id':_0x29770d['id'],'fullName':_0x29770d['name'],'username':_0x29770d[_0x4e5008(0x225)],'telegramId':_0x29770d[_0x4e5008(0x270)],'merchantUrl':_0x29770d[_0x4e5008(0x15f)],'wallets':{'usdtPolygonWallet':_0x29770d[_0x4e5008(0x17c)],'usdtTrcWallet':_0x29770d[_0x4e5008(0x20e)],'usdtErcWallet':_0x29770d[_0x4e5008(0x1c9)],'usdcPolygonWallet':_0x29770d['usdcPolygonWallet'],'usdcErcWallet':_0x29770d[_0x4e5008(0x1f1)]},'totalAmountUSDT':Math['round'](_0x237367*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x35749f*0x64)/0x64,'currentBalance':Math['round'](_0x53864e*0x64)/0x64,'totalPayout':Math['round'](_0x57313f*0x64)/0x64,'thisMonth':Math[_0x4e5008(0x1d3)](_0x5ed9ba*0x64)/0x64,'paymentsCount':_0x397097,'oldestPaymentDate':_0x2ee577?.['paidAt']||_0x29770d[_0x4e5008(0x268)],'gatewayBreakdown':_0x15de16};})),_0x181878=_0xaaa8dc['reduce']((_0x43bd51,_0x1129df)=>_0x43bd51+_0x1129df[_0x4e22c2(0x207)],0x0),_0xdfec89=_0xaaa8dc[_0x4e22c2(0x212)]((_0x15b411,_0x476e4f)=>_0x15b411+_0x476e4f[_0x4e22c2(0x266)],0x0),_0x5cb0b6=_0xaaa8dc[_0x4e22c2(0x212)]((_0x1c6363,_0x3ce2db)=>_0x1c6363+_0x3ce2db[_0x4e22c2(0x26f)],0x0),_0x14d031=_0xaaa8dc['reduce']((_0x4d0e0d,_0x3f62ff)=>_0x4d0e0d+_0x3f62ff['thisMonth'],0x0);return console[_0x4e22c2(0x28f)](_0x4e22c2(0x249)+_0x493285+'\x20merchants'),console[_0x4e22c2(0x28f)](_0x4e22c2(0x1e0)+Math[_0x4e22c2(0x1d3)](_0x181878*0x64)/0x64+_0x4e22c2(0x15e)),console[_0x4e22c2(0x28f)]('\x20\x20\x20✅\x20Total\x20available\x20for\x20payout:\x20'+Math[_0x4e22c2(0x1d3)](_0xdfec89*0x64)/0x64+'\x20USDT\x20(actual\x20balances)'),console[_0x4e22c2(0x28f)](_0x4e22c2(0x159)+Math[_0x4e22c2(0x1d3)](_0x5cb0b6*0x64)/0x64+_0x4e22c2(0x27e)),console['log'](_0x4e22c2(0x233)+Math[_0x4e22c2(0x1d3)](_0x14d031*0x64)/0x64+'\x20USDT'),{'merchants':_0xaaa8dc,'pagination':{'page':_0x236557,'limit':_0x52ab12,'total':_0x493285,'totalPages':Math['ceil'](_0x493285/_0x52ab12)},'summary':{'totalMerchants':_0x493285,'totalAmountUSDT':Math[_0x4e22c2(0x1d3)](_0x181878*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0xdfec89*0x64)/0x64,'totalPayout':Math[_0x4e22c2(0x1d3)](_0x5cb0b6*0x64)/0x64,'thisMonth':Math[_0x4e22c2(0x1d3)](_0x14d031*0x64)/0x64}};}async[a38_0x24bbe3(0x1eb)](_0x1e2207){const _0x23c2bb=a38_0x24bbe3,{shopId:_0x166dda,amount:_0x30c416,network:_0x558ad2,wallet:_0x3fbd19,notes:_0x26b692,txid:_0x521ae0,periodFrom:_0x5245a1,periodTo:_0x283f41}=_0x1e2207,_0x48669a=await database_1[_0x23c2bb(0x1c1)][_0x23c2bb(0x1b4)](async _0x543a6b=>{const _0x1ee7cc=_0x23c2bb,_0x5139cf=await _0x543a6b[_0x1ee7cc(0x188)][_0x1ee7cc(0x200)]({'where':{'id':_0x166dda},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x5139cf)throw new Error(_0x1ee7cc(0x1ff));console[_0x1ee7cc(0x28f)]('💰\x20Creating\x20payout\x20for\x20shop\x20'+_0x5139cf['username']+':'),console[_0x1ee7cc(0x28f)](_0x1ee7cc(0x284)+_0x5139cf[_0x1ee7cc(0x23e)][_0x1ee7cc(0x223)](0x6)+'\x20USDT'),console[_0x1ee7cc(0x28f)]('\x20\x20\x20Payout\x20amount:\x20'+_0x30c416[_0x1ee7cc(0x223)](0x6)+_0x1ee7cc(0x27e)),console[_0x1ee7cc(0x28f)]('\x20\x20\x20Current\x20total\x20paid\x20out:\x20'+_0x5139cf[_0x1ee7cc(0x267)]['toFixed'](0x6)+_0x1ee7cc(0x27e));if(_0x521ae0)console[_0x1ee7cc(0x28f)](_0x1ee7cc(0x28b)+_0x521ae0);if(_0x5139cf[_0x1ee7cc(0x23e)]<_0x30c416)throw new Error(_0x1ee7cc(0x292)+_0x5139cf[_0x1ee7cc(0x23e)][_0x1ee7cc(0x223)](0x6)+_0x1ee7cc(0x1f5)+_0x30c416['toFixed'](0x6)+'\x20USDT');let _0x3b1a00=_0x3fbd19;if(!_0x3b1a00){const _0x32c9b0=await _0x543a6b[_0x1ee7cc(0x188)][_0x1ee7cc(0x200)]({'where':{'id':_0x166dda},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});if(_0x32c9b0)switch(_0x558ad2){case _0x1ee7cc(0x275):_0x3b1a00=_0x32c9b0[_0x1ee7cc(0x17c)]||undefined;break;case'trc20':_0x3b1a00=_0x32c9b0[_0x1ee7cc(0x20e)]||undefined;break;case _0x1ee7cc(0x262):_0x3b1a00=_0x32c9b0[_0x1ee7cc(0x1c9)]||undefined;break;case _0x1ee7cc(0x1fc):_0x3b1a00=_0x32c9b0[_0x1ee7cc(0x27c)]||undefined;break;case _0x1ee7cc(0x1ea):_0x3b1a00=_0x32c9b0['usdcErcWallet']||undefined;break;}}console[_0x1ee7cc(0x28f)](_0x1ee7cc(0x180)+_0x558ad2+':\x20'+(_0x3b1a00||_0x1ee7cc(0x1b0)));const _0x51f150=await _0x543a6b[_0x1ee7cc(0x220)]['create']({'data':{'shopId':_0x166dda,'amount':_0x30c416,'network':_0x558ad2,'status':_0x1ee7cc(0x209),'txid':_0x521ae0,'notes':_0x26b692,'periodFrom':_0x5245a1?new Date(_0x5245a1):null,'periodTo':_0x283f41?new Date(_0x283f41):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x48ea72=_0x5139cf[_0x1ee7cc(0x23e)]-_0x30c416,_0x1c7b1b=_0x5139cf[_0x1ee7cc(0x267)]+_0x30c416;return await _0x543a6b['shop'][_0x1ee7cc(0x1c0)]({'where':{'id':_0x166dda},'data':{'balance':_0x48ea72,'totalPaidOut':_0x1c7b1b}}),console['log'](_0x1ee7cc(0x216)+_0x5139cf['username']+_0x1ee7cc(0x244)),console[_0x1ee7cc(0x28f)]('\x20\x20\x20Balance:\x20'+_0x5139cf[_0x1ee7cc(0x23e)][_0x1ee7cc(0x223)](0x6)+_0x1ee7cc(0x1cf)+_0x48ea72[_0x1ee7cc(0x223)](0x6)+_0x1ee7cc(0x26b)+_0x30c416['toFixed'](0x6)+')'),console[_0x1ee7cc(0x28f)](_0x1ee7cc(0x1da)+_0x5139cf[_0x1ee7cc(0x267)][_0x1ee7cc(0x223)](0x6)+_0x1ee7cc(0x1cf)+_0x1c7b1b[_0x1ee7cc(0x223)](0x6)+'\x20USDT\x20(+'+_0x30c416[_0x1ee7cc(0x223)](0x6)+')'),{'payout':_0x51f150,'shop':_0x5139cf};});return console['log'](_0x23c2bb(0x243)+_0x48669a[_0x23c2bb(0x220)]['id']+_0x23c2bb(0x183)+_0x48669a[_0x23c2bb(0x188)][_0x23c2bb(0x225)]+'\x20('+_0x30c416+_0x23c2bb(0x230)),{'id':_0x48669a[_0x23c2bb(0x220)]['id'],'shopId':_0x48669a[_0x23c2bb(0x220)][_0x23c2bb(0x1c8)],'shopName':_0x48669a[_0x23c2bb(0x188)][_0x23c2bb(0x1ef)],'shopUsername':_0x48669a['shop'][_0x23c2bb(0x225)],'amount':_0x48669a[_0x23c2bb(0x220)]['amount'],'network':_0x48669a[_0x23c2bb(0x220)][_0x23c2bb(0x163)],'status':_0x48669a[_0x23c2bb(0x220)][_0x23c2bb(0x20a)],'txid':_0x48669a[_0x23c2bb(0x220)][_0x23c2bb(0x1ae)],'notes':_0x48669a['payout'][_0x23c2bb(0x1f9)],'periodFrom':_0x48669a[_0x23c2bb(0x220)]['periodFrom'],'periodTo':_0x48669a[_0x23c2bb(0x220)][_0x23c2bb(0x1c4)],'createdAt':_0x48669a[_0x23c2bb(0x220)]['createdAt'],'paidAt':_0x48669a['payout'][_0x23c2bb(0x174)]};}async[a38_0x24bbe3(0x201)](_0x1db65d){const _0x4c59cd=a38_0x24bbe3,{page:_0x285155,limit:_0x5e98c9,shopId:_0x392885,network:_0x5f14a2,dateFrom:_0xe3e91b,dateTo:_0x401d22,search:_0x375c02}=_0x1db65d,_0x367fb0=(_0x285155-0x1)*_0x5e98c9,_0x5d51a9={};_0x392885&&(_0x5d51a9[_0x4c59cd(0x1c8)]=_0x392885);_0x5f14a2&&(_0x5d51a9[_0x4c59cd(0x163)]=_0x5f14a2);(_0xe3e91b||_0x401d22)&&(_0x5d51a9[_0x4c59cd(0x268)]={},_0xe3e91b&&(_0x5d51a9[_0x4c59cd(0x268)][_0x4c59cd(0x173)]=new Date(_0xe3e91b)),_0x401d22&&(_0x5d51a9['createdAt']['lte']=new Date(_0x401d22)));_0x375c02&&(_0x5d51a9['OR']=[{'shop':{'name':{'contains':_0x375c02,'mode':_0x4c59cd(0x236)}}},{'shop':{'username':{'contains':_0x375c02,'mode':_0x4c59cd(0x236)}}},{'notes':{'contains':_0x375c02,'mode':_0x4c59cd(0x236)}}]);const [_0x268985,_0x12df22]=await Promise['all']([database_1[_0x4c59cd(0x1c1)]['payout'][_0x4c59cd(0x22d)]({'where':_0x5d51a9,'skip':_0x367fb0,'take':_0x5e98c9,'orderBy':{'createdAt':_0x4c59cd(0x1b9)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x4c59cd(0x1c1)]['payout'][_0x4c59cd(0x1db)]({'where':_0x5d51a9})]);return{'payouts':_0x268985[_0x4c59cd(0x172)](_0x2d3266=>({'id':_0x2d3266['id'],'shopId':_0x2d3266[_0x4c59cd(0x1c8)],'shopName':_0x2d3266[_0x4c59cd(0x188)][_0x4c59cd(0x1ef)],'shopUsername':_0x2d3266['shop']['username'],'amount':_0x2d3266[_0x4c59cd(0x15a)],'network':_0x2d3266['network'],'status':_0x2d3266[_0x4c59cd(0x20a)],'txid':_0x2d3266['txid'],'notes':_0x2d3266['notes'],'periodFrom':_0x2d3266[_0x4c59cd(0x18d)],'periodTo':_0x2d3266[_0x4c59cd(0x1c4)],'createdAt':_0x2d3266[_0x4c59cd(0x268)],'paidAt':_0x2d3266[_0x4c59cd(0x174)]})),'pagination':{'page':_0x285155,'limit':_0x5e98c9,'total':_0x12df22,'totalPages':Math[_0x4c59cd(0x239)](_0x12df22/_0x5e98c9)}};}async[a38_0x24bbe3(0x1bb)](_0x5c493b){const _0x23d686=a38_0x24bbe3,_0x3f4429=await database_1[_0x23d686(0x1c1)][_0x23d686(0x220)][_0x23d686(0x200)]({'where':{'id':_0x5c493b},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x3f4429)return null;return{'id':_0x3f4429['id'],'shopId':_0x3f4429[_0x23d686(0x1c8)],'shopName':_0x3f4429[_0x23d686(0x188)][_0x23d686(0x1ef)],'shopUsername':_0x3f4429[_0x23d686(0x188)][_0x23d686(0x225)],'amount':_0x3f4429[_0x23d686(0x15a)],'network':_0x3f4429[_0x23d686(0x163)],'status':_0x3f4429[_0x23d686(0x20a)],'txid':_0x3f4429['txid'],'notes':_0x3f4429[_0x23d686(0x1f9)],'periodFrom':_0x3f4429['periodFrom'],'periodTo':_0x3f4429[_0x23d686(0x1c4)],'createdAt':_0x3f4429[_0x23d686(0x268)],'paidAt':_0x3f4429[_0x23d686(0x174)]};}async[a38_0x24bbe3(0x26e)](_0x5de36b){const _0x5a0fa4=a38_0x24bbe3;await database_1['default'][_0x5a0fa4(0x220)][_0x5a0fa4(0x245)]({'where':{'id':_0x5de36b}});}async[a38_0x24bbe3(0x20b)](_0x184044){const _0x2c9b90=a38_0x24bbe3,{page:_0x7759fd,limit:_0x2a2a69,status:_0x193fdf,gateway:_0xcf4cbe,shopId:_0xccdae8,dateFrom:_0x5ecd26,dateTo:_0x4bff6b,search:_0x49a877,currency:_0x24617a,sortBy:_0x8f19dc,sortOrder:_0x15821d}=_0x184044,_0xf1b74b=(_0x7759fd-0x1)*_0x2a2a69;console[_0x2c9b90(0x28f)](_0x2c9b90(0x1ec),_0x184044);const _0x139058=await database_1[_0x2c9b90(0x1c1)][_0x2c9b90(0x17a)][_0x2c9b90(0x238)]({'by':[_0x2c9b90(0x16b)],'_count':{'gateway':!![]}});console['log'](_0x2c9b90(0x190),_0x139058[_0x2c9b90(0x172)](_0x41611f=>_0x41611f[_0x2c9b90(0x16b)]+'\x20('+_0x41611f[_0x2c9b90(0x1cd)][_0x2c9b90(0x16b)]+'\x20payments)'));if(_0xcf4cbe){const _0x3c9100=_0x139058[_0x2c9b90(0x196)](_0x4374d3=>_0x4374d3['gateway'][_0x2c9b90(0x1d0)]()===_0xcf4cbe[_0x2c9b90(0x1d0)]());!_0x3c9100&&_0xcf4cbe['toLowerCase']()!==_0x2c9b90(0x19b)&&console[_0x2c9b90(0x28f)](_0x2c9b90(0x264)+_0xcf4cbe+'\x27\x20not\x20found.\x20Available\x20gateways:\x20'+_0x139058[_0x2c9b90(0x172)](_0x1e8ebb=>_0x1e8ebb['gateway'])[_0x2c9b90(0x25a)](',\x20'));}const _0x9acacd={};_0x193fdf&&(_0x9acacd[_0x2c9b90(0x20a)]=_0x193fdf[_0x2c9b90(0x277)]());if(!_0xcf4cbe)_0x9acacd[_0x2c9b90(0x16b)]={'not':_0x2c9b90(0x19b)};else{if(_0xcf4cbe&&(_0xcf4cbe[_0x2c9b90(0x1d0)]()===_0x2c9b90(0x19b)||_0xcf4cbe==='0000'))_0x9acacd[_0x2c9b90(0x16b)]=_0x2c9b90(0x19b);else{let _0x17501f=_0xcf4cbe;const _0x3165e9=(0x0,gateway_1['getGatewayNameById'])(_0xcf4cbe);if(_0x3165e9)_0x17501f=_0x3165e9,console[_0x2c9b90(0x28f)](_0x2c9b90(0x237)+_0xcf4cbe+_0x2c9b90(0x214)+_0x17501f+'\x27');else{const _0x1c6591=(0x0,gateway_1[_0x2c9b90(0x25d)])(_0xcf4cbe);if(_0x1c6591){const _0x5f14b2=(0x0,gateway_1['getGatewayNameById'])(_0x1c6591);_0x5f14b2&&(_0x17501f=_0x5f14b2,console['log'](_0x2c9b90(0x178)+_0xcf4cbe+_0x2c9b90(0x19f)+_0x1c6591+_0x2c9b90(0x1a2)+_0x17501f+'\x27'));}else console[_0x2c9b90(0x28f)](_0x2c9b90(0x219)+_0xcf4cbe+_0x2c9b90(0x202));}const _0x51e823=await database_1['default'][_0x2c9b90(0x17a)][_0x2c9b90(0x1db)]({'where':{'gateway':_0x17501f[_0x2c9b90(0x1d0)]()},'take':0x1});_0x51e823===0x0?(console[_0x2c9b90(0x28f)]('⚠️\x20Gateway\x20\x27'+_0x17501f+_0x2c9b90(0x23a)+_0xcf4cbe+_0x2c9b90(0x1dc)),_0x9acacd[_0x2c9b90(0x16b)]=_0x2c9b90(0x1bf)):(_0x9acacd[_0x2c9b90(0x16b)]=_0x17501f[_0x2c9b90(0x1d0)](),console[_0x2c9b90(0x28f)](_0x2c9b90(0x199)+_0x17501f+_0x2c9b90(0x23a)+_0xcf4cbe+'\x27)'));}}console['log'](_0x2c9b90(0x269),_0x9acacd[_0x2c9b90(0x16b)]);_0xccdae8&&(_0x9acacd[_0x2c9b90(0x1c8)]=_0xccdae8);_0x24617a&&(_0x9acacd['currency']=_0x24617a[_0x2c9b90(0x277)](),console[_0x2c9b90(0x28f)](_0x2c9b90(0x1d2)+_0x24617a[_0x2c9b90(0x277)]()));(_0x5ecd26||_0x4bff6b)&&(_0x9acacd['createdAt']={},_0x5ecd26&&(_0x9acacd['createdAt'][_0x2c9b90(0x173)]=new Date(_0x5ecd26)),_0x4bff6b&&(_0x9acacd['createdAt'][_0x2c9b90(0x15c)]=new Date(_0x4bff6b)));_0x49a877&&(_0x9acacd['OR']=[{'id':{'contains':_0x49a877,'mode':_0x2c9b90(0x236)}},{'orderId':{'contains':_0x49a877,'mode':_0x2c9b90(0x236)}},{'gatewayOrderId':{'contains':_0x49a877,'mode':_0x2c9b90(0x236)}},{'customerEmail':{'contains':_0x49a877,'mode':_0x2c9b90(0x236)}},{'shop':{'name':{'contains':_0x49a877,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x49a877,'mode':_0x2c9b90(0x236)}}}]);console[_0x2c9b90(0x28f)](_0x2c9b90(0x23c),JSON[_0x2c9b90(0x1d5)](_0x9acacd,null,0x2));let _0x2e61ed={'createdAt':_0x2c9b90(0x1b9)};if(_0x8f19dc){const _0x46dc56=[_0x2c9b90(0x15a),'createdAt',_0x2c9b90(0x242),'status',_0x2c9b90(0x16b),'currency'],_0x23a560=[_0x2c9b90(0x1df),_0x2c9b90(0x1b9)];if(_0x46dc56[_0x2c9b90(0x1ba)](_0x8f19dc)){const _0x138e02=_0x23a560[_0x2c9b90(0x1ba)](_0x15821d)?_0x15821d:_0x2c9b90(0x1b9);_0x2e61ed={[_0x8f19dc]:_0x138e02},console[_0x2c9b90(0x28f)](_0x2c9b90(0x1bd)+_0x8f19dc+'\x20in\x20'+_0x138e02+_0x2c9b90(0x259));}}const [_0x188c30,_0x154778]=await Promise[_0x2c9b90(0x23f)]([database_1[_0x2c9b90(0x1c1)][_0x2c9b90(0x17a)][_0x2c9b90(0x22d)]({'where':_0x9acacd,'skip':_0xf1b74b,'take':_0x2a2a69,'orderBy':_0x2e61ed,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x2c9b90(0x1c1)]['payment'][_0x2c9b90(0x1db)]({'where':_0x9acacd})]);return{'payments':_0x188c30,'pagination':{'page':_0x7759fd,'limit':_0x2a2a69,'total':_0x154778,'totalPages':Math[_0x2c9b90(0x239)](_0x154778/_0x2a2a69)}};}async[a38_0x24bbe3(0x1a3)](_0x2511f9){const _0x143202=a38_0x24bbe3,_0x13978f=await database_1[_0x143202(0x1c1)]['payment'][_0x143202(0x200)]({'where':{'id':_0x2511f9},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x13978f)return null;return{'id':_0x13978f['id'],'shopId':_0x13978f['shopId'],'gateway':_0x13978f['gateway'],'amount':_0x13978f['amount'],'currency':_0x13978f[_0x143202(0x1ac)],'status':_0x13978f[_0x143202(0x20a)],'orderId':_0x13978f['orderId'],'gatewayOrderId':_0x13978f[_0x143202(0x16c)],'customerEmail':_0x13978f[_0x143202(0x261)],'customerName':_0x13978f[_0x143202(0x1ce)],'customerCountry':_0x13978f[_0x143202(0x158)],'customerIp':_0x13978f[_0x143202(0x258)],'customerUa':_0x13978f[_0x143202(0x246)],'failureMessage':_0x13978f['failureMessage'],'externalPaymentUrl':_0x13978f[_0x143202(0x24e)],'successUrl':_0x13978f[_0x143202(0x1d1)],'failUrl':_0x13978f[_0x143202(0x257)],'pendingUrl':_0x13978f[_0x143202(0x211)],'whiteUrl':_0x13978f[_0x143202(0x285)],'createdAt':_0x13978f['createdAt'],'updatedAt':_0x13978f[_0x143202(0x242)],'shop':_0x13978f[_0x143202(0x188)]};}async[a38_0x24bbe3(0x15d)](_0x2c906f,_0x269a0e,_0x44fb95,_0x2b35ca){const _0x5104d9=a38_0x24bbe3,_0x43bf87=await database_1[_0x5104d9(0x1c1)][_0x5104d9(0x1b4)](async _0x3a227e=>{const _0x40d13d=_0x5104d9,_0x10a8c1=await _0x3a227e[_0x40d13d(0x17a)][_0x40d13d(0x200)]({'where':{'id':_0x2c906f},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x10a8c1)throw new Error('Payment\x20not\x20found');const _0xd2b1de=_0x10a8c1[_0x40d13d(0x20a)],_0x5b2840=_0x269a0e[_0x40d13d(0x277)]();console[_0x40d13d(0x28f)](_0x40d13d(0x1f0)+_0x2c906f+_0x40d13d(0x19a)+_0xd2b1de+'\x20->\x20'+_0x5b2840),console[_0x40d13d(0x28f)](_0x40d13d(0x157)+_0x10a8c1[_0x40d13d(0x188)]['balance']+_0x40d13d(0x27e));const _0x11ae93={'status':_0x5b2840,'updatedAt':new Date(),'statusChangedBy':_0x40d13d(0x286),'statusChangedAt':new Date()};_0x44fb95&&(_0x11ae93[_0x40d13d(0x17b)]=_0x44fb95);_0x5b2840===_0x40d13d(0x28d)&&_0x2b35ca&&(_0x11ae93['chargebackAmount']=_0x2b35ca);let _0x58b259=0x0,_0x52dc6c=_0x10a8c1[_0x40d13d(0x188)][_0x40d13d(0x23e)];if(_0x5b2840===_0x40d13d(0x217)&&_0xd2b1de!==_0x40d13d(0x217)){_0x11ae93['paidAt']=new Date();const _0x5208d4=await currencyService_1[_0x40d13d(0x291)][_0x40d13d(0x161)](_0x10a8c1[_0x40d13d(0x15a)],_0x10a8c1[_0x40d13d(0x1ac)]);_0x11ae93[_0x40d13d(0x18c)]=_0x5208d4;let _0x1edaa9=0x2d;const _0x365f9f=await _0x3a227e[_0x40d13d(0x188)]['findUnique']({'where':{'id':_0x10a8c1[_0x40d13d(0x1c8)]},'select':{'gatewaySettings':!![]}});if(_0x365f9f?.[_0x40d13d(0x1f7)])try{const _0x3dc10e=JSON[_0x40d13d(0x289)](_0x365f9f['gatewaySettings']);for(const [_0x4e9ab0,_0x5156f4]of Object[_0x40d13d(0x18e)](_0x3dc10e)){if(_0x4e9ab0[_0x40d13d(0x1d0)]()===_0x10a8c1['gateway'][_0x40d13d(0x1d0)]()){_0x1edaa9=_0x5156f4[_0x40d13d(0x253)]||0xa;break;}}}catch(_0x5c659d){console['error']('Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20'+_0x2c906f+':',_0x5c659d);}let _0x39233a;_0x10a8c1[_0x40d13d(0x1ed)]!==null&&_0x10a8c1[_0x40d13d(0x1ed)]!==undefined?(_0x39233a=_0x10a8c1['amountAfterGatewayCommissionUSDT'],console[_0x40d13d(0x28f)](_0x40d13d(0x186)+_0x39233a[_0x40d13d(0x223)](0x6)+_0x40d13d(0x171)+_0x2c906f)):(_0x39233a=_0x5208d4*(0x1-_0x1edaa9/0x64),console[_0x40d13d(0x28f)]('📊\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20'+_0x2c906f+':\x20'+_0x1edaa9+_0x40d13d(0x27a)+_0x5208d4[_0x40d13d(0x223)](0x6)+_0x40d13d(0x27e)),_0x11ae93[_0x40d13d(0x1ed)]=_0x39233a,_0x11ae93[_0x40d13d(0x1a8)]=_0x1edaa9),_0x58b259=_0x39233a,_0x52dc6c+=_0x39233a,console[_0x40d13d(0x28f)](_0x40d13d(0x167)+_0x2c906f+_0x40d13d(0x191)),console[_0x40d13d(0x28f)](_0x40d13d(0x1e2)+_0x5208d4[_0x40d13d(0x223)](0x6)+'\x20USDT'),console[_0x40d13d(0x28f)](_0x40d13d(0x226)+_0x10a8c1['gateway']+',\x20Commission:\x20'+_0x1edaa9+'%'),console[_0x40d13d(0x28f)](_0x40d13d(0x25f)+_0x39233a[_0x40d13d(0x223)](0x6)+_0x40d13d(0x165)+_0x1edaa9+'%\x20commission)'),console[_0x40d13d(0x28f)]('\x20\x20\x20Added\x20to\x20balance:\x20+'+_0x39233a['toFixed'](0x6)+'\x20USDT');}else{if(_0xd2b1de===_0x40d13d(0x217)&&_0x5b2840!==_0x40d13d(0x217)){if(_0x10a8c1['amountUSDT']){let _0x14613e=0x2d;const _0x56e0d8=await _0x3a227e[_0x40d13d(0x188)]['findUnique']({'where':{'id':_0x10a8c1[_0x40d13d(0x1c8)]},'select':{'gatewaySettings':!![]}});if(_0x56e0d8?.['gatewaySettings'])try{const _0xf1d72f=JSON[_0x40d13d(0x289)](_0x56e0d8['gatewaySettings']);for(const [_0x3ab042,_0x4d2803]of Object[_0x40d13d(0x18e)](_0xf1d72f)){if(_0x3ab042[_0x40d13d(0x1d0)]()===_0x10a8c1['gateway'][_0x40d13d(0x1d0)]()){_0x14613e=_0x4d2803['commission']||0xa;break;}}}catch(_0x24c2a9){console[_0x40d13d(0x287)](_0x40d13d(0x1c3)+_0x2c906f+':',_0x24c2a9);}const _0x5a9c41=_0x10a8c1[_0x40d13d(0x18c)]*(0x1-_0x14613e/0x64);_0x58b259=-_0x5a9c41,_0x52dc6c-=_0x5a9c41,_0x11ae93[_0x40d13d(0x18c)]=null,_0x11ae93['amountAfterGatewayCommissionUSDT']=null,console[_0x40d13d(0x28f)](_0x40d13d(0x167)+_0x2c906f+_0x40d13d(0x1a9)),console[_0x40d13d(0x28f)](_0x40d13d(0x1e2)+_0x10a8c1[_0x40d13d(0x18c)][_0x40d13d(0x223)](0x6)+_0x40d13d(0x27e)),console[_0x40d13d(0x28f)](_0x40d13d(0x226)+_0x10a8c1['gateway']+',\x20Commission:\x20'+_0x14613e+'%'),console[_0x40d13d(0x28f)](_0x40d13d(0x168)+_0x5a9c41['toFixed'](0x6)+_0x40d13d(0x165)+_0x14613e+'%\x20commission)'),console[_0x40d13d(0x28f)](_0x40d13d(0x21c)+_0x5a9c41[_0x40d13d(0x223)](0x6)+'\x20USDT');}}}_0x5b2840===_0x40d13d(0x28d)&&(_0xd2b1de===_0x40d13d(0x217)&&_0x10a8c1[_0x40d13d(0x18c)]&&console[_0x40d13d(0x28f)]('💸\x20CHARGEBACK:\x20Merchant\x20amount\x20already\x20deducted\x20from\x20balance'),_0x2b35ca&&_0x2b35ca>0x0&&(_0x58b259-=_0x2b35ca,_0x52dc6c-=_0x2b35ca,console['log'](_0x40d13d(0x176)+_0x2b35ca['toFixed'](0x6)+'\x20USDT\x20from\x20balance')));_0x5b2840===_0x40d13d(0x21f)&&_0xd2b1de===_0x40d13d(0x217)&&console['log'](_0x40d13d(0x24a));const _0x4b0102=await _0x3a227e['payment']['update']({'where':{'id':_0x2c906f},'data':_0x11ae93,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x58b259!==0x0&&(await _0x3a227e[_0x40d13d(0x188)][_0x40d13d(0x1c0)]({'where':{'id':_0x10a8c1[_0x40d13d(0x1c8)]},'data':{'balance':_0x52dc6c}}),console[_0x40d13d(0x28f)](_0x40d13d(0x216)+_0x10a8c1[_0x40d13d(0x1c8)]+_0x40d13d(0x27d)+_0x10a8c1[_0x40d13d(0x188)][_0x40d13d(0x23e)]['toFixed'](0x6)+_0x40d13d(0x1cf)+_0x52dc6c[_0x40d13d(0x223)](0x6)+_0x40d13d(0x16f)+(_0x58b259>0x0?'+':'')+_0x58b259['toFixed'](0x6)+')')),_0x4b0102;});return{'id':_0x43bf87['id'],'shopId':_0x43bf87[_0x5104d9(0x1c8)],'gateway':_0x43bf87[_0x5104d9(0x16b)],'amount':_0x43bf87[_0x5104d9(0x15a)],'currency':_0x43bf87['currency'],'status':_0x43bf87[_0x5104d9(0x20a)],'orderId':_0x43bf87[_0x5104d9(0x166)],'gatewayOrderId':_0x43bf87[_0x5104d9(0x16c)],'customerEmail':_0x43bf87[_0x5104d9(0x261)],'customerName':_0x43bf87[_0x5104d9(0x1ce)],'customerCountry':_0x43bf87['customerCountry'],'customerIp':_0x43bf87[_0x5104d9(0x258)],'customerUa':_0x43bf87['customerUa'],'failureMessage':_0x43bf87[_0x5104d9(0x21a)],'adminNotes':_0x43bf87['adminNotes'],'chargebackAmount':_0x43bf87[_0x5104d9(0x28a)],'statusChangedBy':_0x43bf87['statusChangedBy'],'statusChangedAt':_0x43bf87[_0x5104d9(0x276)],'createdAt':_0x43bf87[_0x5104d9(0x268)],'updatedAt':_0x43bf87['updatedAt'],'shop':_0x43bf87[_0x5104d9(0x188)]};}async[a38_0x24bbe3(0x228)](_0x5e706e,_0xbfcb0e){const _0x3a137d=a38_0x24bbe3,_0x6b1bcf=Math[_0x3a137d(0x247)]()[_0x3a137d(0x1e4)](0x24)['substr'](0x2,0x9);console[_0x3a137d(0x28f)]('🎯\x20updateUser\x20called\x20with\x20ID:\x20'+_0x6b1bcf+_0x3a137d(0x18a)+_0x5e706e);const _0x147431={..._0xbfcb0e};_0xbfcb0e[_0x3a137d(0x282)]&&_0xbfcb0e[_0x3a137d(0x282)]['trim']()!==''?(console['log'](_0x3a137d(0x1bc)+_0x6b1bcf+_0x3a137d(0x23b)+_0x5e706e),_0x147431[_0x3a137d(0x282)]=await bcryptjs_1[_0x3a137d(0x1c1)][_0x3a137d(0x265)](_0xbfcb0e[_0x3a137d(0x282)],0xc)):(console['log']('🔐\x20['+_0x6b1bcf+_0x3a137d(0x192)),delete _0x147431[_0x3a137d(0x282)]);_0xbfcb0e[_0x3a137d(0x16a)]&&(_0x147431[_0x3a137d(0x1ef)]=_0xbfcb0e[_0x3a137d(0x16a)],delete _0x147431[_0x3a137d(0x16a)]);_0xbfcb0e['telegramId']&&(_0x147431[_0x3a137d(0x270)]=_0xbfcb0e[_0x3a137d(0x1e3)],delete _0x147431[_0x3a137d(0x1e3)]);_0xbfcb0e[_0x3a137d(0x25b)]&&(_0x147431[_0x3a137d(0x15f)]=_0xbfcb0e[_0x3a137d(0x25b)],delete _0x147431[_0x3a137d(0x25b)]);if(_0xbfcb0e[_0x3a137d(0x16e)]){const _0x3f9abb=_0xbfcb0e[_0x3a137d(0x16e)]['map'](_0x2e1ab3=>this[_0x3a137d(0x15b)](_0x2e1ab3));console[_0x3a137d(0x28f)](_0x3a137d(0x1e8),_0xbfcb0e['gateways'],'->',_0x3f9abb),_0x147431['paymentGateways']=JSON[_0x3a137d(0x1d5)](_0x3f9abb),delete _0x147431['gateways'];}_0xbfcb0e[_0x3a137d(0x1f7)]&&(console['log'](_0x3a137d(0x288)+_0x6b1bcf+']\x20Gateway\x20settings\x20before\x20saving:',_0xbfcb0e[_0x3a137d(0x1f7)]),_0x147431[_0x3a137d(0x1f7)]=JSON['stringify'](_0xbfcb0e['gatewaySettings']),console[_0x3a137d(0x28f)](_0x3a137d(0x288)+_0x6b1bcf+_0x3a137d(0x1aa),_0x147431['gatewaySettings']));_0xbfcb0e[_0x3a137d(0x28e)]&&(_0xbfcb0e[_0x3a137d(0x28e)][_0x3a137d(0x17c)]!==undefined&&(_0x147431[_0x3a137d(0x17c)]=_0xbfcb0e[_0x3a137d(0x28e)][_0x3a137d(0x17c)]||null),_0xbfcb0e[_0x3a137d(0x28e)][_0x3a137d(0x20e)]!==undefined&&(_0x147431[_0x3a137d(0x20e)]=_0xbfcb0e['wallets'][_0x3a137d(0x20e)]||null),_0xbfcb0e[_0x3a137d(0x28e)]['usdtErcWallet']!==undefined&&(_0x147431[_0x3a137d(0x1c9)]=_0xbfcb0e['wallets'][_0x3a137d(0x1c9)]||null),_0xbfcb0e['wallets']['usdcPolygonWallet']!==undefined&&(_0x147431[_0x3a137d(0x27c)]=_0xbfcb0e[_0x3a137d(0x28e)][_0x3a137d(0x27c)]||null),delete _0x147431['wallets']);const _0x45452a=await database_1[_0x3a137d(0x1c1)][_0x3a137d(0x188)][_0x3a137d(0x1c0)]({'where':{'id':_0x5e706e},'data':_0x147431,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0x3a137d(0x28f)]('🎯\x20['+_0x6b1bcf+_0x3a137d(0x205),_0x45452a['gatewaySettings']),{'id':_0x45452a['id'],'fullName':_0x45452a[_0x3a137d(0x1ef)],'username':_0x45452a[_0x3a137d(0x225)],'telegramId':_0x45452a[_0x3a137d(0x270)],'merchantUrl':_0x45452a[_0x3a137d(0x15f)],'gateways':_0x45452a['paymentGateways']?JSON[_0x3a137d(0x289)](_0x45452a[_0x3a137d(0x1cb)]):null,'gatewaySettings':_0x45452a[_0x3a137d(0x1f7)]?JSON[_0x3a137d(0x289)](_0x45452a[_0x3a137d(0x1f7)]):null,'publicKey':_0x45452a[_0x3a137d(0x1c6)],'wallets':{'usdtPolygonWallet':_0x45452a['usdtPolygonWallet'],'usdtTrcWallet':_0x45452a['usdtTrcWallet'],'usdtErcWallet':_0x45452a['usdtErcWallet'],'usdcPolygonWallet':_0x45452a['usdcPolygonWallet']},'status':_0x45452a[_0x3a137d(0x20a)],'createdAt':_0x45452a[_0x3a137d(0x268)]};}async[a38_0x24bbe3(0x22e)](_0x3c25c1){const _0x9900b3=a38_0x24bbe3,_0x112107=await database_1['default'][_0x9900b3(0x188)][_0x9900b3(0x1c0)]({'where':{'id':_0x3c25c1},'data':{'status':_0x9900b3(0x26c)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x112107['id'],'fullName':_0x112107[_0x9900b3(0x1ef)],'username':_0x112107[_0x9900b3(0x225)],'telegramId':_0x112107[_0x9900b3(0x270)],'merchantUrl':_0x112107[_0x9900b3(0x15f)],'gateways':_0x112107[_0x9900b3(0x1cb)]?JSON[_0x9900b3(0x289)](_0x112107[_0x9900b3(0x1cb)]):null,'gatewaySettings':_0x112107[_0x9900b3(0x1f7)]?JSON['parse'](_0x112107[_0x9900b3(0x1f7)]):null,'publicKey':_0x112107[_0x9900b3(0x1c6)],'wallets':{'usdtPolygonWallet':_0x112107[_0x9900b3(0x17c)],'usdtTrcWallet':_0x112107[_0x9900b3(0x20e)],'usdtErcWallet':_0x112107['usdtErcWallet'],'usdcPolygonWallet':_0x112107['usdcPolygonWallet']},'status':_0x112107[_0x9900b3(0x20a)],'createdAt':_0x112107[_0x9900b3(0x268)]};}async[a38_0x24bbe3(0x222)](_0x2211f2){const _0x19f6c9=a38_0x24bbe3,_0x228223=await database_1[_0x19f6c9(0x1c1)]['shop']['update']({'where':{'id':_0x2211f2},'data':{'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x228223['id'],'fullName':_0x228223[_0x19f6c9(0x1ef)],'username':_0x228223[_0x19f6c9(0x225)],'telegramId':_0x228223['telegram'],'merchantUrl':_0x228223['shopUrl'],'gateways':_0x228223[_0x19f6c9(0x1cb)]?JSON[_0x19f6c9(0x289)](_0x228223[_0x19f6c9(0x1cb)]):null,'gatewaySettings':_0x228223['gatewaySettings']?JSON['parse'](_0x228223[_0x19f6c9(0x1f7)]):null,'publicKey':_0x228223[_0x19f6c9(0x1c6)],'wallets':{'usdtPolygonWallet':_0x228223[_0x19f6c9(0x17c)],'usdtTrcWallet':_0x228223[_0x19f6c9(0x20e)],'usdtErcWallet':_0x228223[_0x19f6c9(0x1c9)],'usdcPolygonWallet':_0x228223[_0x19f6c9(0x27c)]},'status':_0x228223['status'],'createdAt':_0x228223['createdAt']};}async[a38_0x24bbe3(0x1a7)](_0x21bcaa){const _0x49809a=a38_0x24bbe3,{page:_0x1e8c59,limit:_0x4ff010,status:_0x2415ff}=_0x21bcaa,_0x3886df=(_0x1e8c59-0x1)*_0x4ff010,_0x4bb576={};_0x2415ff&&(_0x4bb576['status']=_0x2415ff[_0x49809a(0x277)]());const [_0x58c685,_0x3bebd0]=await Promise[_0x49809a(0x23f)]([database_1[_0x49809a(0x1c1)][_0x49809a(0x188)][_0x49809a(0x22d)]({'where':_0x4bb576,'skip':_0x3886df,'take':_0x4ff010,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x49809a(0x1c1)][_0x49809a(0x188)][_0x49809a(0x1db)]({'where':_0x4bb576})]);return{'users':_0x58c685['map'](_0x48bdb5=>{const _0x5b9e9b=_0x49809a,_0x5e01f8=_0x48bdb5[_0x5b9e9b(0x1cb)]?JSON['parse'](_0x48bdb5[_0x5b9e9b(0x1cb)]):null,_0x360b5d=_0x5e01f8?_0x5e01f8[_0x5b9e9b(0x172)](_0x4e21f4=>this[_0x5b9e9b(0x1b8)](_0x4e21f4)):null;return{'id':_0x48bdb5['id'],'fullName':_0x48bdb5[_0x5b9e9b(0x1ef)],'username':_0x48bdb5[_0x5b9e9b(0x225)],'telegramId':_0x48bdb5[_0x5b9e9b(0x270)],'merchantUrl':_0x48bdb5[_0x5b9e9b(0x15f)],'gateways':_0x360b5d,'gatewaySettings':_0x48bdb5[_0x5b9e9b(0x1f7)]?JSON[_0x5b9e9b(0x289)](_0x48bdb5[_0x5b9e9b(0x1f7)]):null,'publicKey':_0x48bdb5[_0x5b9e9b(0x1c6)],'wallets':{'usdtPolygonWallet':_0x48bdb5[_0x5b9e9b(0x17c)],'usdtTrcWallet':_0x48bdb5[_0x5b9e9b(0x20e)],'usdtErcWallet':_0x48bdb5['usdtErcWallet'],'usdcPolygonWallet':_0x48bdb5[_0x5b9e9b(0x27c)]},'status':_0x48bdb5[_0x5b9e9b(0x20a)],'createdAt':_0x48bdb5[_0x5b9e9b(0x268)]};}),'pagination':{'page':_0x1e8c59,'limit':_0x4ff010,'total':_0x3bebd0,'totalPages':Math['ceil'](_0x3bebd0/_0x4ff010)}};}async[a38_0x24bbe3(0x235)](_0x4d5360){const _0x19739b=a38_0x24bbe3,_0x189363=await database_1[_0x19739b(0x1c1)]['shop'][_0x19739b(0x200)]({'where':{'id':_0x4d5360},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x189363)return null;const _0x547bde=_0x189363[_0x19739b(0x1cb)]?JSON['parse'](_0x189363[_0x19739b(0x1cb)]):null,_0x4f6e24=_0x547bde?_0x547bde['map'](_0x1fcdcd=>this['getGatewayDisplayName'](_0x1fcdcd)):null;return _0x547bde&&_0x4f6e24&&console[_0x19739b(0x28f)](_0x19739b(0x208),_0x547bde,'->',_0x4f6e24),{'id':_0x189363['id'],'fullName':_0x189363[_0x19739b(0x1ef)],'username':_0x189363[_0x19739b(0x225)],'telegramId':_0x189363[_0x19739b(0x270)],'merchantUrl':_0x189363[_0x19739b(0x15f)],'gateways':_0x4f6e24,'gatewaySettings':_0x189363[_0x19739b(0x1f7)]?JSON[_0x19739b(0x289)](_0x189363[_0x19739b(0x1f7)]):null,'publicKey':_0x189363[_0x19739b(0x1c6)],'wallets':{'usdtPolygonWallet':_0x189363[_0x19739b(0x17c)],'usdtTrcWallet':_0x189363[_0x19739b(0x20e)],'usdtErcWallet':_0x189363['usdtErcWallet'],'usdcPolygonWallet':_0x189363[_0x19739b(0x27c)]},'status':_0x189363[_0x19739b(0x20a)],'createdAt':_0x189363['createdAt']};}async[a38_0x24bbe3(0x221)](_0x530ed3){const _0x38bf1a=a38_0x24bbe3,{fullName:_0x2c3157,username:_0x3401f0,password:_0x2eb164,telegramId:_0x4befb6,merchantUrl:_0x1485cb,gateways:_0x1a9600,gatewaySettings:_0x5c0189,wallets:_0x4222be}=_0x530ed3,_0x37ffa0=await database_1[_0x38bf1a(0x1c1)][_0x38bf1a(0x188)][_0x38bf1a(0x200)]({'where':{'username':_0x3401f0}});if(_0x37ffa0)throw new Error(_0x38bf1a(0x1ab));if(_0x4befb6){const _0x699b7=await database_1[_0x38bf1a(0x1c1)][_0x38bf1a(0x188)][_0x38bf1a(0x200)]({'where':{'telegram':_0x4befb6}});if(_0x699b7)throw new Error('Telegram\x20username\x20already\x20exists');}const _0x1ae2e0=await bcryptjs_1[_0x38bf1a(0x1c1)][_0x38bf1a(0x265)](_0x2eb164,0xc),_0x103271='pk_'+crypto_1['default'][_0x38bf1a(0x21e)](0x20)[_0x38bf1a(0x1e4)](_0x38bf1a(0x1a0)),_0x4a1f59=_0x38bf1a(0x234)+crypto_1[_0x38bf1a(0x1c1)][_0x38bf1a(0x21e)](0x20)[_0x38bf1a(0x1e4)](_0x38bf1a(0x1a0)),_0x48721e=_0x1a9600?_0x1a9600['map'](_0x5109bd=>this[_0x38bf1a(0x15b)](_0x5109bd)):null;_0x1a9600&&_0x48721e&&console[_0x38bf1a(0x28f)](_0x38bf1a(0x1b1),_0x1a9600,'->',_0x48721e);const _0x313b20=await database_1[_0x38bf1a(0x1c1)][_0x38bf1a(0x188)][_0x38bf1a(0x195)]({'data':{'name':_0x2c3157,'username':_0x3401f0,'password':_0x1ae2e0,'telegram':_0x4befb6,'shopUrl':_0x1485cb,'paymentGateways':_0x48721e?JSON[_0x38bf1a(0x1d5)](_0x48721e):null,'gatewaySettings':_0x5c0189?JSON[_0x38bf1a(0x1d5)](_0x5c0189):null,'usdtPolygonWallet':_0x4222be?.[_0x38bf1a(0x17c)]||null,'usdtTrcWallet':_0x4222be?.[_0x38bf1a(0x20e)]||null,'usdtErcWallet':_0x4222be?.[_0x38bf1a(0x1c9)]||null,'usdcPolygonWallet':_0x4222be?.[_0x38bf1a(0x27c)]||null,'publicKey':_0x103271,'secretKey':_0x4a1f59,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x313b20['id'],'fullName':_0x313b20['name'],'username':_0x313b20[_0x38bf1a(0x225)],'telegramId':_0x313b20[_0x38bf1a(0x270)],'merchantUrl':_0x313b20['shopUrl'],'gateways':_0x313b20[_0x38bf1a(0x1cb)]?JSON[_0x38bf1a(0x289)](_0x313b20[_0x38bf1a(0x1cb)]):null,'gatewaySettings':_0x313b20['gatewaySettings']?JSON[_0x38bf1a(0x289)](_0x313b20['gatewaySettings']):null,'publicKey':_0x313b20[_0x38bf1a(0x1c6)],'wallets':{'usdtPolygonWallet':_0x313b20[_0x38bf1a(0x17c)],'usdtTrcWallet':_0x313b20[_0x38bf1a(0x20e)],'usdtErcWallet':_0x313b20[_0x38bf1a(0x1c9)],'usdcPolygonWallet':_0x313b20[_0x38bf1a(0x27c)]},'status':_0x313b20[_0x38bf1a(0x20a)],'createdAt':_0x313b20[_0x38bf1a(0x268)]};}async[a38_0x24bbe3(0x22b)](_0x30aa78){const _0xc6d223=a38_0x24bbe3;await database_1[_0xc6d223(0x1c1)]['shop'][_0xc6d223(0x245)]({'where':{'id':_0x30aa78}});}[a38_0x24bbe3(0x20c)](_0x599c04,_0x3a0647,_0x3aebcf){const _0x7c7bce=a38_0x24bbe3,_0x234140=new Map(),_0x4adf99=new Date(_0x3a0647);while(_0x4adf99<=_0x3aebcf){const _0x6a38f=_0x4adf99['toISOString']()['split']('T')[0x0];_0x234140[_0x7c7bce(0x19c)](_0x6a38f,{'revenue':0x0,'count':0x0}),_0x4adf99[_0x7c7bce(0x194)](_0x4adf99[_0x7c7bce(0x1e1)]()+0x1);}for(const _0x5902af of _0x599c04){const _0x148aa2=_0x5902af['createdAt']['toISOString']()[_0x7c7bce(0x1d7)]('T')[0x0],_0x43e208=_0x234140['get'](_0x148aa2);_0x43e208&&(_0x43e208['count']+=0x1,_0x5902af['status']==='PAID'&&(_0x5902af[_0x7c7bce(0x18c)]?_0x43e208[_0x7c7bce(0x187)]+=_0x5902af[_0x7c7bce(0x18c)]:console[_0x7c7bce(0x28f)](_0x7c7bce(0x17f)+_0x5902af['id']+'\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion')));}const _0x236a63=[],_0x6b7eec=[];for(const [_0x73365d,_0x13da78]of _0x234140){_0x236a63[_0x7c7bce(0x189)]({'date':_0x73365d,'amount':Math['round'](_0x13da78[_0x7c7bce(0x187)]*0x64)/0x64}),_0x6b7eec[_0x7c7bce(0x189)]({'date':_0x73365d,'count':_0x13da78['count']});}return{'dailyRevenue':_0x236a63,'dailyPayments':_0x6b7eec};}}exports[a38_0x24bbe3(0x206)]=AdminService;