'use strict';const a53_0x4a281e=a53_0x49bb;(function(_0x2a4590,_0x3ce226){const _0x51905b=a53_0x49bb,_0x4293c9=_0x2a4590();while(!![]){try{const _0x55d345=parseInt(_0x51905b(0x14f))/0x1*(-parseInt(_0x51905b(0x20a))/0x2)+-parseInt(_0x51905b(0x172))/0x3*(-parseInt(_0x51905b(0x1fd))/0x4)+parseInt(_0x51905b(0x260))/0x5*(-parseInt(_0x51905b(0x154))/0x6)+-parseInt(_0x51905b(0x1e2))/0x7+parseInt(_0x51905b(0x21c))/0x8*(parseInt(_0x51905b(0x199))/0x9)+parseInt(_0x51905b(0x1a4))/0xa*(parseInt(_0x51905b(0xf2))/0xb)+-parseInt(_0x51905b(0x1fa))/0xc*(-parseInt(_0x51905b(0xf4))/0xd);if(_0x55d345===_0x3ce226)break;else _0x4293c9['push'](_0x4293c9['shift']());}catch(_0x3175cd){_0x4293c9['push'](_0x4293c9['shift']());}}}(a53_0x16fa,0xbbb1d));var __importDefault=this&&this['__importDefault']||function(_0x4b8928){return _0x4b8928&&_0x4b8928['__esModule']?_0x4b8928:{'default':_0x4b8928};};Object[a53_0x4a281e(0x1e0)](exports,a53_0x4a281e(0xd5),{'value':!![]}),exports[a53_0x4a281e(0x18a)]=void 0x0;const database_1=__importDefault(require('../config/database')),bcryptjs_1=__importDefault(require(a53_0x4a281e(0x217))),crypto_1=__importDefault(require('crypto')),fs_1=__importDefault(require('fs')),path_1=__importDefault(require('path')),speakeasy_1=__importDefault(require(a53_0x4a281e(0x1f8))),qrcode_1=__importDefault(require(a53_0x4a281e(0x1be))),config_1=require(a53_0x4a281e(0x1ae)),currencyService_1=require(a53_0x4a281e(0x16d)),telegramBotService_1=require('./telegramBotService'),gateway_1=require(a53_0x4a281e(0x170));function a53_0x16fa(){const _0x59ec7f=['TrapaPay','2966280jAGMPV','startsWith','sk_','\x20PAID\x20payments','averageCheckUSDT','\x20\x20\x20Full\x20amount:\x20','MasterCard','backupCodes','split','\x20USDT\x20(after\x20','warn','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','sort','gatewaySettings','‚ùå\x20Failed\x20to\x20send\x20Telegram\x20notification\x20for\x20payout\x20','getShopWallets','enable2FA','üìä\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','all','\x20balance\x20updated:\x20','telegramUsers','üìÖ\x20Period:\x20','fullName','ru-RU','customerIp','./currencyService','payouts','üìã\x20Found\x20','../types/gateway','\x20USDC\x20to\x20merchant\x20','9qJULtk','year','shopUrl','EXPIRED','üìã\x20Getting\x20merchants\x20selection\x20list...','wallet','CoinToPay','\x20\x20\x20Final\x20payout\x20amount\x20used:\x20','hex','availableBalance','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','üìä\x20Total\x20payments\x20(including\x20failed):\x20','Amer','get','\x20USDT\x20(','\x20\x20\x20Gateway:\x20','count','payment','customerCountry','setupAdmin2FA',',\x20Commission:\x20','error','polygon','\x20USDT,\x20merchant:\x20','AdminService','custom_','\x27\x20not\x20found.\x20Available\x20gateways:\x20','commissionUSDT','yesterday','getTime',',\x20userId:\x20','update','aggregate','üîå\x20Gateway:\x20','ADMIN_BACKUP_CODES=','Current\x20password\x20is\x20incorrect','getUserById','üîê\x202FA\x20setup\x20initiated\x20for\x20shop:\x20','\x20\x20\x20üí∏\x20Total\x20payouts\x20(all\x20time):\x20','243MYMLOu','üìä\x20Statistics\x20WHERE\x20conditions:',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','\x20\x20\x20üè™\x20Gateway\x20earnings:\x20','Test\x20Gateway','findMany','cointopay2','payout','merchantId','‚úÖ\x20Payout\x20created\x20in\x20DB:','notes','510820rxsRPJ','CHARGEBACK','\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...','lastMonth','üîÑ\x20Updating\x20customer\x20data\x20for\x20payment\x20','ADMIN_2FA_ENABLED=','dateTo','gatewayEarnings','Telegram\x20username\x20already\x20exists','SUSPENDED','../config/config','awaitingPayout','KLYME\x20GB','\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','getMerchantsAwaitingPayout','KLYME\x20EU','Payment\x20not\x20found','amount','\x20became\x20PAID:','randomBytes','findUnique','Error\x20parsing\x20backup\x20codes:','\x20USDT\x20(current\x20balance\x20in\x20DB)','\x20\x20\x20Requested\x20(number):\x20','toString','qrcode','Insufficient\x20balance\x20for\x20amount\x20increase.\x20Available:\x20','üîê\x20Admin\x202FA\x20enabled','toUpperCase','NONEXISTENT_GATEWAY_FILTER','customerUa','.env','‚úÖ\x20Customer\x20data\x20updated\x20for\x20payment\x20','changeAdminPassword',':\x20commission\x20=\x20','floor','values','enableAdmin2FA','totalTurnover','today','üîç\x20Balance\x20check\x20details:','klyme_de',',\x20successful:\x20','delete','Plisio','New\x20password\x20must\x20be\x20at\x20least\x206\x20characters\x20long','\x20USDT','\x20USDT,\x20Requested:\x20','twoFactorEnabled','name','totalCommissionRate','üìÖ\x20Date\x20from\x20filter:\x20','round','amountUSDT','üìä\x20Available\x20gateways\x20in\x20database:','setUTCDate','disableAdmin2FA','amountAfterGatewayCommissionUSDT','üîç\x20Shop\x20wallets:','defineProperty','ADMIN_PASSWORD_HASH=','372554xHqhcf','MaxPara','dailyPayments','üìä\x20Final\x20WHERE\x20conditions:','$transaction','üìä\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','txid','successUrl','createPayout','ADMIN_2FA_ENABLED=false','üìä\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','password','\x20USDT\x20(-','suspendUser','üîÑ\x20Converted\x20gateway\x20ID\x20\x27','getUTCFullYear','base32','Rapyd','test_gateway','_sum','join','totp','speakeasy','wallets','12kcIzQB','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','totalAmountAfterCommissionUSDT','543820vFMZPS','asc','toLowerCase','üîÑ\x20Gateway\x20mapping\x20(get):','\x20\x20\x20ÔøΩ\x20Total\x20payments\x20turnover:\x20','getAllPayments','‚úÖ\x20Payout\x20','\x20order','telegram','\x20\x20\x20Shop\x20totalPaidOut:\x20','status','last_month','config','2oPmuvQ','deleteUser','currencyService','splice','CoinToPay2','2FA\x20is\x20already\x20enabled','usdtErcWallet','currency','getAllUsers','gatewayCommissionRate','Invalid\x202FA\x20token\x20or\x20backup\x20code','\x20\x20\x20Shop\x20balance:\x20','periodTo','bcryptjs','toLocaleDateString','Invalid\x202FA\x20token','Deposit','this_month','251832WNjoIv','setup2FA','üìä\x20Getting\x20merchant\x20statistics\x20with\x20filters:','customerEmail','network','findFirst','noda','\x20\x20\x20üíµ\x20Available\x20balance:\x20','admin','New\x20password\x20and\x20confirmation\x20do\x20not\x20match','Username\x20already\x20exists','\x20USDT\x20(same\x20as\x20awaiting)','\x20\x20\x20Balance:\x20','getFullYear','\x20\x20\x20üåç\x20Country:\x20','üîê\x202FA\x20enabled\x20for\x20shop:\x20','\x20\x20\x20‚úÖ\x20Actual\x20available\x20balance:\x20','has','‚ö†Ô∏è\x20CHARGEBACK\x20without\x20penalty\x20amount\x20-\x20no\x20balance\x20change','periodFrom','usdtPolygonWallet','erc20_usdc','turnoverUSDT','ceil','mastercard','Noda','forEach','üí∞\x20Payment\x20','\x20USDT\x20-\x20will\x20deduct\x20from\x20balance','\x20USDT)','generateDailyStatistics','üìä\x20Getting\x20payments\x20with\x20filters:','UTC','passwordHash','\x20payments)','\x20\x20\x20ÔøΩüìä\x20Total\x20payments:\x20','gateways','paymentGateways','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','username','USDC','twoFactorSecret','\x27\x20(from\x20\x27','\x20backup\x20codes','reduce','shop',']\x20Updating\x20password\x20for\x20user\x20','\x20\x20\x20üí∞\x20Total\x20payments\x20turnover:\x20','gte','\x20USDT\x20(total\x20paid\x20to\x20merchants)','customerName','AmPay','getGatewayDisplayName','thisMonth','üí±\x20Currency\x20filter\x20applied:\x20','plisio','insensitive','\x20\x20\x20Merchant\x20loses:\x20','PAID','getPayoutReports','SquirrelPay','rapyd','\x20\x20\x20üí∏\x20Total\x20payouts:\x20','üîç\x20Using\x20gateway\x20\x27','\x20\x20\x20Current\x20balance:\x20','Interac','üí∞\x20Creating\x20payout\x20for\x20shop\x20','getGatewayIdByName','5VOOEZg','sendPayoutNotification','failureMessage','üîë\x20Generated\x20','MyXSpend','üìä\x20Using\x20saved\x20values\x20for\x20payment\x20','toISOString','getPaymentById','replace','üîê\x20[','\x20USDT\x20(theoretical\x20net)','üí∞\x20Current\x20shop\x20balance:\x20','writeFileSync','TrapaPay\x20Admin\x20(','USDT','üîÑ\x20Gateway\x20mapping\x20(create):','üîç\x20Selected\x20erc20_usdc\x20wallet:\x20','updatedAt','\x27\x20->\x20name\x20\x27','üîç\x20Selected\x20erc20\x20wallet:\x20','ADMIN_2FA_SECRET=','_count','pk_','‚úÖ\x20Deposited\x20','KLYME\x20DE','generateBackupCodes','gateway','\x20merchants\x20with\x20rounded\x20balance\x20!=\x200.00\x20(excluding\x20balances\x20that\x20round\x20to\x200.00)','2FA\x20token\x20is\x20required','desc','‚úÖ\x20Payout\x20created:\x20','hash','paymentsCount','üìÖ\x20Payout\x20date\x20to\x20filter:\x20','getGatewayInternalName','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','\x20status:\x20','gatewayOrderId','utf8','üéØ\x20[','dailyRevenue','\x20\x20\x20‚úÖ\x20Total\x20net\x20balances:\x20','\x20for\x20shop\x20','merchantName','OxaPay','‚ö†Ô∏è\x20Gateway\x20\x27','ACTIVE','üîç\x20Selected\x20trc20\x20wallet:\x20','verify','üìä\x20Merchants\x20with\x20rounded\x20balance\x20!=\x200.00:\x20','\x20merchants\x20for\x20selection','\x27\x20to\x20name\x20\x27','dateFrom','groupBy','get2FASettings','adminNotes','TrapaPay\x20Admin','statusChangedAt','usdcErcWallet','üîÑ\x20Gateway\x20mapping:','revenue','\x20USDT\x20(+','lte','commission','\x20\x20\x20üí≥\x20Total\x20payments:\x20','trc20','merchantEarnings','\x20\x20\x20Amount\x20difference:\x20','üîß\x20[','üîê\x20Admin\x202FA\x20setup\x20initiated','readFileSync','üí∞\x20Found\x20','üìä\x20Merchant\x20statistics\x20calculated:','üìä\x20Gateway\x20filter\x20applied:','averageCommissionRate','totalPaidOut','setHours','chargebackAmount','cwd','\x20USDT\x20(gross\x20revenue)','üìä\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','getPayoutById','\x20with\x20payout\x20history','cointopay','__esModule','Merchant\x20not\x20found','\x20\x20\x20Merchant\x20gets:\x20','updateUser','\x20to\x20','telegramId','2FA\x20not\x20set\x20up.\x20Please\x20call\x20setup\x20endpoint\x20first','polygon_usdc','getMonth','getUTCDay','üìä\x20Payout\x20statistics\x20calculated:','\x20in\x20','totalAmountUSDT','balance','turnover','TrapaPay\x20(','\x20\x20\x20üñ•Ô∏è\x20User\x20Agent:\x20','getUTCDate','\x20USDT\x20(rounded\x20to\x202\x20decimal\x20places)','createdAt','publicKey','updatePaymentStatus','activateUser','\x20\x20\x20‚è≥\x20Pending\x20payout:\x20','üí∞\x20[PAYOUT]\x20Gateway\x20','usdcPolygonWallet','create','\x20\x20\x20Tolerance:\x20','week','11JSydDQ','merchantEarningsUSDT','15221076mZOqkm','üí∞\x20Shop\x20','generateSecret','entries','üîê\x20Admin\x202FA\x20disabled','totalPayments','\x20\x20\x20Available\x20(number):\x20','map','üí∞\x20[PAYOUT]\x20Merchant\x20','\x20USDT\x20for\x20payment\x20','externalPaymentUrl','üí∏\x20CHARGEBACK\x20penalty\x20ONLY:\x20-',']\x20Gateway\x20settings\x20JSON\x20string:','OnRamp','failUrl','Shop\x20not\x20found','date','üìä\x20Calculating\x20payout\x20statistics...','from','\x20paid\x20payments\x20for\x20gateway\x20','AmPay\x20TRY','abs','merchantUrl','compare','default','\x20updated\x20successfully','\x20\x20\x20New\x20amount:\x20','ADMIN_2FA_ENABLED=true','filter','usdtTrcWallet','\x20USDT,\x20Required:\x20','\x20\x20\x20üîç\x20Calculated\x20after\x20commission:\x20','üí∏\x20CHARGEBACK:\x20Processing\x20penalty-only\x20deduction','üí∞\x20Payment\x20amount\x20is\x20NOT\x20deducted\x20(chargeback\x20penalty\x20only)','klyme_gb','üîÑ\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','üîç\x20Total\x20payments\x20matching\x20filters:\x20','some','orderId','totalAmount','toFixed','set','deletePayout','parse','totalPayout','not\x20set','Insufficient\x20balance.\x20Available:\x20','Payout\x20not\x20found','COMPLETED','getMerchantStatistics','REFUND','whiteUrl','lastLoginAt','\x20\x20\x20üìÖ\x20Total\x20payouts\x20(this\x20month):\x20','üí∞\x20Updating\x20payout\x20','\x20\x20\x20Transaction\x20hash:\x20','üìä\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20','üí≥\x20Final\x20payout\x20wallet\x20for\x20','disable2FA','PENDING','%\x20commission)','otpauth_url','includes','‚ö†Ô∏è\x20Payment\x20','\x20USDT\x20(already\x20paid\x20out)','log','amountAfterCommissionUSDT','\x20-\x20','getUTCMonth','\x20\x20\x20üìÖ\x20This\x20month:\x20','\x20\x20\x20Amount\x20increased\x20by\x20','\x20->\x20','%\x20from\x20','\x20balance\x20updated:','shopId','\x20USDT,\x20Difference:\x20','merchantUsername','getPayoutStats','erc20','min','\x20USDT\x20-\x20will\x20return\x20to\x20balance','paidAt','getGatewayNameById','üîç\x20No\x20wallet\x20provided,\x20looking\x20up\x20from\x20shop\x20settings...','‚úÖ\x20Using\x20gateway\x20filter:\x20\x27','length','push','üì±\x20Telegram\x20notification\x20sent\x20for\x20payout\x20','getMerchantsSelection','stringify','existsSync','1163333GVwxiF','getAllPayouts','period','custom'];a53_0x16fa=function(){return _0x59ec7f;};return a53_0x16fa();}class AdminService{async[a53_0x4a281e(0x141)](){const _0x56e968=a53_0x4a281e;console[_0x56e968(0x135)](_0x56e968(0x105));const _0x159d95=await database_1[_0x56e968(0x10c)][_0x56e968(0x249)][_0x56e968(0x192)]({'_sum':{'balance':!![],'totalPaidOut':!![]}}),_0x512764=await database_1[_0x56e968(0x10c)][_0x56e968(0x183)][_0x56e968(0x182)]({'where':{'status':_0x56e968(0x256),'gateway':{'not':_0x56e968(0x1f4)}}}),_0x14c5a2=new Date(),_0x19e0e5=new Date(_0x14c5a2[_0x56e968(0x229)](),_0x14c5a2[_0x56e968(0xdd)](),0x1),_0x3285fd=new Date(_0x14c5a2[_0x56e968(0x229)](),_0x14c5a2[_0x56e968(0xdd)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x38a833=await database_1['default']['payout'][_0x56e968(0x192)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x19e0e5,'lte':_0x3285fd},'status':'COMPLETED'}}),_0x2e5752=_0x159d95[_0x56e968(0x1f5)][_0x56e968(0xcb)]||0x0,_0x643831=_0x159d95[_0x56e968(0x1f5)]['balance']||0x0,_0x44c4e6=_0x38a833[_0x56e968(0x1f5)][_0x56e968(0x1b6)]||0x0,_0x1842eb={'totalPayout':Math[_0x56e968(0x1d9)](_0x2e5752*0x64)/0x64,'awaitingPayout':Math[_0x56e968(0x1d9)](_0x643831*0x64)/0x64,'thisMonth':Math[_0x56e968(0x1d9)](_0x44c4e6*0x64)/0x64,'availableBalance':Math[_0x56e968(0x1d9)](_0x643831*0x64)/0x64,'totalPayments':_0x512764};return console[_0x56e968(0x135)](_0x56e968(0xdf)),console['log']('\x20\x20\x20üí∞\x20Total\x20payout:\x20'+_0x1842eb[_0x56e968(0x120)]+_0x56e968(0x24d)),console[_0x56e968(0x135)](_0x56e968(0x1b2)+_0x1842eb[_0x56e968(0x1af)]+_0x56e968(0x1b1)),console['log'](_0x56e968(0x223)+_0x1842eb[_0x56e968(0x17b)]+_0x56e968(0x227)),console[_0x56e968(0x135)](_0x56e968(0x139)+_0x1842eb[_0x56e968(0x251)]+_0x56e968(0x1d3)),console[_0x56e968(0x135)](_0x56e968(0x2a0)+_0x1842eb[_0x56e968(0xf9)]+_0x56e968(0x157)),_0x1842eb;}async['updateCustomerData'](_0x42779e,_0x119c99){const _0x32a8df=a53_0x4a281e;console[_0x32a8df(0x135)](_0x32a8df(0x1a8)+_0x42779e+':',_0x119c99);const _0x474770=await database_1[_0x32a8df(0x10c)][_0x32a8df(0x183)][_0x32a8df(0x1b9)]({'where':{'id':_0x42779e},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x474770)throw new Error(_0x32a8df(0x1b5));const _0x20c75a={};_0x119c99[_0x32a8df(0x184)]!==undefined&&(_0x20c75a['customerCountry']=_0x119c99[_0x32a8df(0x184)]||null);_0x119c99[_0x32a8df(0x16c)]!==undefined&&(_0x20c75a[_0x32a8df(0x16c)]=_0x119c99[_0x32a8df(0x16c)]||null);_0x119c99[_0x32a8df(0x1c3)]!==undefined&&(_0x20c75a[_0x32a8df(0x1c3)]=_0x119c99[_0x32a8df(0x1c3)]||null);const _0x1154f9=await database_1[_0x32a8df(0x10c)][_0x32a8df(0x183)][_0x32a8df(0x191)]({'where':{'id':_0x42779e},'data':{..._0x20c75a,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x32a8df(0x135)](_0x32a8df(0x1c5)+_0x42779e),console[_0x32a8df(0x135)](_0x32a8df(0x22a)+_0x474770[_0x32a8df(0x184)]+_0x32a8df(0x13b)+_0x1154f9[_0x32a8df(0x184)]),console['log']('\x20\x20\x20üåê\x20IP:\x20'+_0x474770['customerIp']+_0x32a8df(0x13b)+_0x1154f9[_0x32a8df(0x16c)]),console['log'](_0x32a8df(0xe5)+(_0x474770[_0x32a8df(0x1c3)]?'set':_0x32a8df(0x121))+_0x32a8df(0x13b)+(_0x1154f9[_0x32a8df(0x1c3)]?_0x32a8df(0x11d):_0x32a8df(0x121))),_0x1154f9;}async['getSystemStatistics'](_0x206906,_0x565571){const _0x49d51f=a53_0x4a281e,_0x177a07=_0x565571?new Date(_0x565571):new Date();let _0x16307f,_0x4baad0;if(_0x206906[_0x49d51f(0x155)]('custom_')){const _0x13685d=_0x206906[_0x49d51f(0x268)](_0x49d51f(0x18b),'')['split']('_');if(_0x13685d[_0x49d51f(0x149)]===0x2){const _0x5a16ea=new Date(_0x13685d[0x0]),_0x2fb9f2=new Date(_0x13685d[0x1]);_0x16307f=new Date(Date[_0x49d51f(0x23c)](_0x5a16ea[_0x49d51f(0x1f1)](),_0x5a16ea['getUTCMonth'](),_0x5a16ea['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x4baad0=new Date(Date[_0x49d51f(0x23c)](_0x2fb9f2[_0x49d51f(0x1f1)](),_0x2fb9f2[_0x49d51f(0x138)](),_0x2fb9f2[_0x49d51f(0xe6)](),0x17,0x3b,0x3b,0x3e7));}else{const _0x4dd84a=new Date(Date[_0x49d51f(0x23c)](_0x177a07[_0x49d51f(0x1f1)](),_0x177a07['getUTCMonth'](),_0x177a07[_0x49d51f(0xe6)]()-0x1e));_0x16307f=new Date(Date[_0x49d51f(0x23c)](_0x4dd84a[_0x49d51f(0x1f1)](),_0x4dd84a[_0x49d51f(0x138)](),_0x4dd84a['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x4baad0=new Date(Date[_0x49d51f(0x23c)](_0x177a07[_0x49d51f(0x1f1)](),_0x177a07['getUTCMonth'](),_0x177a07['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}}else{switch(_0x206906[_0x49d51f(0x1ff)]()){case _0x49d51f(0x1cc):_0x16307f=new Date(Date[_0x49d51f(0x23c)](_0x177a07[_0x49d51f(0x1f1)](),_0x177a07[_0x49d51f(0x138)](),_0x177a07[_0x49d51f(0xe6)](),0x0,0x0,0x0,0x0)),_0x4baad0=new Date(Date[_0x49d51f(0x23c)](_0x177a07[_0x49d51f(0x1f1)](),_0x177a07[_0x49d51f(0x138)](),_0x177a07['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case _0x49d51f(0x18e):const _0x17123b=new Date(_0x177a07);_0x17123b[_0x49d51f(0x1dc)](_0x17123b[_0x49d51f(0xe6)]()-0x1),_0x16307f=new Date(Date[_0x49d51f(0x23c)](_0x17123b[_0x49d51f(0x1f1)](),_0x17123b[_0x49d51f(0x138)](),_0x17123b[_0x49d51f(0xe6)](),0x0,0x0,0x0,0x0)),_0x4baad0=new Date(Date[_0x49d51f(0x23c)](_0x17123b['getUTCFullYear'](),_0x17123b[_0x49d51f(0x138)](),_0x17123b[_0x49d51f(0xe6)](),0x17,0x3b,0x3b,0x3e7));break;case'this_week':const _0x465731=_0x177a07[_0x49d51f(0xde)](),_0x65ffa=_0x465731===0x0?-0x6:0x1-_0x465731,_0x5557db=_0x177a07['getUTCDate']()+_0x65ffa;_0x16307f=new Date(Date['UTC'](_0x177a07[_0x49d51f(0x1f1)](),_0x177a07[_0x49d51f(0x138)](),_0x5557db,0x0,0x0,0x0,0x0)),_0x4baad0=new Date(Date[_0x49d51f(0x23c)](_0x177a07['getUTCFullYear'](),_0x177a07[_0x49d51f(0x138)](),_0x177a07[_0x49d51f(0xe6)](),0x17,0x3b,0x3b,0x3e7));break;case'last_week':const _0xec43c9=new Date(Date[_0x49d51f(0x23c)](_0x177a07[_0x49d51f(0x1f1)](),_0x177a07[_0x49d51f(0x138)](),_0x177a07[_0x49d51f(0xe6)]()-0x7)),_0x103bec=_0xec43c9[_0x49d51f(0xde)](),_0x20a0a0=_0x103bec===0x0?-0x6:0x1-_0x103bec,_0x4522fb=_0xec43c9[_0x49d51f(0xe6)]()+_0x20a0a0;_0x16307f=new Date(Date[_0x49d51f(0x23c)](_0xec43c9['getUTCFullYear'](),_0xec43c9[_0x49d51f(0x138)](),_0x4522fb,0x0,0x0,0x0,0x0)),_0x4baad0=new Date(Date[_0x49d51f(0x23c)](_0xec43c9[_0x49d51f(0x1f1)](),_0xec43c9[_0x49d51f(0x138)](),_0x4522fb+0x6,0x17,0x3b,0x3b,0x3e7));break;case _0x49d51f(0x21b):_0x16307f=new Date(Date[_0x49d51f(0x23c)](_0x177a07['getUTCFullYear'](),_0x177a07[_0x49d51f(0x138)](),0x1,0x0,0x0,0x0,0x0)),_0x4baad0=new Date(Date['UTC'](_0x177a07['getUTCFullYear'](),_0x177a07[_0x49d51f(0x138)](),_0x177a07['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case _0x49d51f(0x208):_0x16307f=new Date(Date[_0x49d51f(0x23c)](_0x177a07['getUTCFullYear'](),_0x177a07[_0x49d51f(0x138)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x4baad0=new Date(Date['UTC'](_0x177a07[_0x49d51f(0x1f1)](),_0x177a07[_0x49d51f(0x138)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case'all_time':_0x16307f=new Date(Date['UTC'](0x7e9,0x5,0xe,0x0,0x0,0x0,0x0)),_0x4baad0=new Date(Date[_0x49d51f(0x23c)](_0x177a07[_0x49d51f(0x1f1)](),_0x177a07['getUTCMonth'](),_0x177a07[_0x49d51f(0xe6)](),0x17,0x3b,0x3b,0x3e7));break;default:_0x16307f=new Date(_0x177a07[_0x49d51f(0x18f)]()-0x1e*0x18*0x3c*0x3c*0x3e8);const _0x4dba22=new Date(Date[_0x49d51f(0x23c)](_0x177a07[_0x49d51f(0x1f1)](),_0x177a07['getUTCMonth'](),_0x177a07[_0x49d51f(0xe6)]()-0x1e));_0x16307f=new Date(Date['UTC'](_0x4dba22[_0x49d51f(0x1f1)](),_0x4dba22[_0x49d51f(0x138)](),_0x4dba22[_0x49d51f(0xe6)](),0x0,0x0,0x0,0x0)),_0x4baad0=new Date(Date[_0x49d51f(0x23c)](_0x177a07[_0x49d51f(0x1f1)](),_0x177a07[_0x49d51f(0x138)](),_0x177a07[_0x49d51f(0xe6)](),0x17,0x3b,0x3b,0x3e7));}const _0xfa945e={'gte':_0x16307f,'lte':_0x4baad0};console[_0x49d51f(0x135)]('üìä\x20Statistics\x20date\x20range:\x20'+_0x16307f[_0x49d51f(0x266)]()+_0x49d51f(0xd9)+_0x4baad0['toISOString']());const [_0x493728,_0x3c2fe6,_0x2243be,_0x4227f1,_0x34af1d,_0x4af419,_0x33c90a,_0x14b74d,_0x380263]=await Promise[_0x49d51f(0x166)]([database_1[_0x49d51f(0x10c)][_0x49d51f(0x249)][_0x49d51f(0x182)](),database_1[_0x49d51f(0x10c)][_0x49d51f(0x249)][_0x49d51f(0x182)]({'where':{'status':'ACTIVE'}}),database_1['default'][_0x49d51f(0x183)][_0x49d51f(0x182)]({'where':{'status':_0x49d51f(0x256),'createdAt':_0xfa945e,'gateway':{'not':_0x49d51f(0x1f4)}}}),database_1[_0x49d51f(0x10c)][_0x49d51f(0x183)][_0x49d51f(0x182)]({'where':{'status':_0x49d51f(0x1a5),'createdAt':_0xfa945e,'gateway':{'not':_0x49d51f(0x1f4)}}}),database_1[_0x49d51f(0x10c)][_0x49d51f(0x183)]['count']({'where':{'status':_0x49d51f(0x126),'createdAt':_0xfa945e,'gateway':{'not':_0x49d51f(0x1f4)}}}),database_1[_0x49d51f(0x10c)][_0x49d51f(0x183)][_0x49d51f(0x19e)]({'where':{'status':_0x49d51f(0x256),'createdAt':_0xfa945e,'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x49d51f(0x10c)]['payment']['findMany']({'where':{'gateway':{'not':_0x49d51f(0x1f4)}},'take':0xa,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x49d51f(0x183)]['findMany']({'where':{'createdAt':_0xfa945e,'gateway':{'not':_0x49d51f(0x1f4)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x49d51f(0x10c)][_0x49d51f(0x183)][_0x49d51f(0x19e)]({'where':{'status':_0x49d51f(0x256),'gateway':{'not':_0x49d51f(0x1f4)}},'select':{'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![]}})]);console['log']('üìä\x20Statistics\x20PAID\x20payments\x20count:\x20'+_0x2243be);let _0x377dbe=0x0,_0x1bcae5=0x0;for(const _0x169ec8 of _0x4af419){const _0x570f24=_0x169ec8[_0x49d51f(0x1da)]||0x0;_0x377dbe+=_0x570f24;if(_0x169ec8[_0x49d51f(0x1de)]&&_0x169ec8[_0x49d51f(0x1da)]){const _0x42002f=_0x169ec8[_0x49d51f(0x1da)]-_0x169ec8[_0x49d51f(0x1de)];_0x1bcae5+=_0x42002f;}}let _0x24f99d=0x0;for(const _0x3d29a9 of _0x380263){if(_0x3d29a9[_0x49d51f(0x1de)]&&_0x3d29a9[_0x49d51f(0x1da)]){const _0x34367d=_0x3d29a9[_0x49d51f(0x1da)]-_0x3d29a9['amountAfterGatewayCommissionUSDT'];_0x24f99d+=_0x34367d;}}const _0x1a9952=_0x2243be>0x0?_0x377dbe/_0x2243be:0x0,_0x2248cf=this['generateDailyStatistics'](_0x14b74d,_0x16307f,_0x4baad0),_0x53f4e8=await database_1['default'][_0x49d51f(0x183)][_0x49d51f(0x182)]({'where':{'createdAt':_0xfa945e,'gateway':{'not':_0x49d51f(0x1f4)},'status':{'notIn':[_0x49d51f(0x12f),_0x49d51f(0x175)]}}}),_0x5833ea=_0x53f4e8>0x0?_0x2243be/_0x53f4e8*0x64:0x0;return{'totalShops':_0x493728,'activeShops':_0x3c2fe6,'totalPayments':_0x53f4e8,'successfulPayments':_0x2243be,'totalAttempts':_0x53f4e8,'chargebacks':_0x4227f1,'refunds':_0x34af1d,'totalRevenue':Math[_0x49d51f(0x1d9)](_0x377dbe*0x64)/0x64,'trapayEarnings':Math['round'](_0x1bcae5*0x64)/0x64,'trapayEarningsAllTime':Math[_0x49d51f(0x1d9)](_0x24f99d*0x64)/0x64,'averagePaymentAmount':Math[_0x49d51f(0x1d9)](_0x1a9952*0x64)/0x64,'conversionRate':Math[_0x49d51f(0x1d9)](_0x5833ea*0x64)/0x64,'dailyRevenue':_0x2248cf[_0x49d51f(0x288)],'dailyPayments':_0x2248cf[_0x49d51f(0x1e4)],'recentPayments':_0x33c90a[_0x49d51f(0xfb)](_0x3f51e7=>({'id':_0x3f51e7['id'],'amount':_0x3f51e7[_0x49d51f(0x1b6)],'currency':_0x3f51e7[_0x49d51f(0x211)],'status':_0x3f51e7['status'],'gateway':_0x3f51e7[_0x49d51f(0x27a)],'shop':_0x3f51e7[_0x49d51f(0x249)],'createdAt':_0x3f51e7[_0x49d51f(0xe8)]}))};}}async[a53_0x4a281e(0x125)](_0x1e3930){const _0x4a156f=a53_0x4a281e;console['log'](_0x4a156f(0x21e),_0x1e3930);let _0x211ba5,_0x25d7b5=new Date();if(_0x1e3930[_0x4a156f(0x151)]===_0x4a156f(0x152)&&_0x1e3930[_0x4a156f(0x294)]&&_0x1e3930[_0x4a156f(0x1aa)]){const _0x1a1407=new Date(_0x1e3930[_0x4a156f(0x294)]),_0x24a0c8=new Date(_0x1e3930['dateTo']);_0x211ba5=new Date(Date[_0x4a156f(0x23c)](_0x1a1407[_0x4a156f(0x1f1)](),_0x1a1407[_0x4a156f(0x138)](),_0x1a1407['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x25d7b5=new Date(Date[_0x4a156f(0x23c)](_0x24a0c8['getUTCFullYear'](),_0x24a0c8['getUTCMonth'](),_0x24a0c8[_0x4a156f(0xe6)](),0x17,0x3b,0x3b,0x3e7));}else{const _0x41e181=new Date();switch(_0x1e3930[_0x4a156f(0x151)]){case _0x4a156f(0xf1):_0x211ba5=new Date(_0x41e181[_0x4a156f(0x18f)]()-0x7*0x18*0x3c*0x3c*0x3e8),_0x211ba5[_0x4a156f(0xcc)](0x0,0x0,0x0,0x0),_0x25d7b5['setHours'](0x17,0x3b,0x3b,0x3e7);break;case'month':_0x211ba5=new Date(Date[_0x4a156f(0x23c)](_0x41e181[_0x4a156f(0x1f1)](),_0x41e181[_0x4a156f(0x138)](),0x1,0x0,0x0,0x0,0x0)),_0x25d7b5=new Date(Date[_0x4a156f(0x23c)](_0x41e181[_0x4a156f(0x1f1)](),_0x41e181[_0x4a156f(0x138)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x4a156f(0x1a7):_0x211ba5=new Date(Date[_0x4a156f(0x23c)](_0x41e181[_0x4a156f(0x1f1)](),_0x41e181['getUTCMonth']()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x25d7b5=new Date(Date[_0x4a156f(0x23c)](_0x41e181[_0x4a156f(0x1f1)](),_0x41e181[_0x4a156f(0x138)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x4a156f(0x173):_0x211ba5=new Date(_0x41e181[_0x4a156f(0x18f)]()-0x16d*0x18*0x3c*0x3c*0x3e8),_0x211ba5['setHours'](0x0,0x0,0x0,0x0),_0x25d7b5[_0x4a156f(0xcc)](0x17,0x3b,0x3b,0x3e7);break;case'all':default:_0x211ba5=new Date('2020-01-01'),_0x211ba5[_0x4a156f(0xcc)](0x0,0x0,0x0,0x0),_0x25d7b5['setHours'](0x17,0x3b,0x3b,0x3e7);break;}}console[_0x4a156f(0x135)](_0x4a156f(0x169)+_0x211ba5[_0x4a156f(0x266)]()+_0x4a156f(0xd9)+_0x25d7b5[_0x4a156f(0x266)]());const _0x365543={'status':_0x4a156f(0x256),'gateway':{'not':_0x4a156f(0x1f4)},'createdAt':{'gte':_0x211ba5,'lte':_0x25d7b5}};_0x1e3930[_0x4a156f(0x13e)]&&(_0x365543[_0x4a156f(0x13e)]=_0x1e3930[_0x4a156f(0x13e)]);const _0x582d86=await database_1[_0x4a156f(0x10c)][_0x4a156f(0x183)][_0x4a156f(0x19e)]({'where':_0x365543,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console['log'](_0x4a156f(0xc7)+_0x582d86[_0x4a156f(0x149)]+'\x20paid\x20payments\x20for\x20analysis');const _0x591dc4={'gateway':{'not':_0x4a156f(0x1f4)},'status':{'notIn':['PENDING','EXPIRED']},'createdAt':{'gte':_0x211ba5,'lte':_0x25d7b5}};_0x1e3930[_0x4a156f(0x13e)]&&(_0x591dc4['shopId']=_0x1e3930[_0x4a156f(0x13e)]);const _0x4cda98=await database_1[_0x4a156f(0x10c)][_0x4a156f(0x183)][_0x4a156f(0x182)]({'where':_0x591dc4}),_0x54bf3f={..._0x591dc4,'status':_0x4a156f(0x1a5)},_0x2ad30e={..._0x591dc4,'status':_0x4a156f(0x126)},[_0x7b0cfa,_0x142322]=await Promise['all']([database_1[_0x4a156f(0x10c)][_0x4a156f(0x183)]['count']({'where':_0x54bf3f}),database_1[_0x4a156f(0x10c)][_0x4a156f(0x183)][_0x4a156f(0x182)]({'where':_0x2ad30e})]);console[_0x4a156f(0x135)](_0x4a156f(0x17d)+_0x4cda98+_0x4a156f(0x1cf)+_0x582d86[_0x4a156f(0x149)]+',\x20chargebacks:\x20'+_0x7b0cfa+',\x20refunds:\x20'+_0x142322);let _0x50a9fe=0x0,_0x34ec0b=0x0,_0x537d71=0x0;const _0x17b509={},_0x582cc7={},_0x32f2ea={},_0xc423a5=new Date(_0x211ba5);while(_0xc423a5<=_0x25d7b5){const _0x47d2a5=_0xc423a5[_0x4a156f(0x266)]()[_0x4a156f(0x15c)]('T')[0x0];_0x32f2ea[_0x47d2a5]={'date':_0x47d2a5,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0},_0xc423a5[_0x4a156f(0x1dc)](_0xc423a5[_0x4a156f(0xe6)]()+0x1);}for(const _0x4e3897 of _0x582d86){try{const _0x4fd30b=_0x4e3897[_0x4a156f(0x1da)]||0x0;if(_0x4fd30b<=0x0){console[_0x4a156f(0x15e)](_0x4a156f(0x133)+_0x4e3897['id']+_0x4a156f(0x1a6));continue;}let _0x2e631b,_0x4eeb9c;if(_0x4e3897[_0x4a156f(0x1de)]!==null&&_0x4e3897['amountAfterGatewayCommissionUSDT']!==undefined)_0x2e631b=_0x4e3897[_0x4a156f(0x1de)],_0x4eeb9c=_0x4fd30b-_0x2e631b,console[_0x4a156f(0x135)](_0x4a156f(0x265)+_0x4e3897['id']+':\x20'+_0x4fd30b[_0x4a156f(0x11c)](0x6)+_0x4a156f(0x189)+_0x2e631b['toFixed'](0x6)+_0x4a156f(0x1d3));else{let _0x58f802={};if(_0x4e3897[_0x4a156f(0x249)][_0x4a156f(0x161)])try{_0x58f802=JSON[_0x4a156f(0x11f)](_0x4e3897[_0x4a156f(0x249)][_0x4a156f(0x161)]);}catch(_0x29b09f){console[_0x4a156f(0x187)]('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x4e3897['shopId']+':',_0x29b09f);}let _0x28cfa3=0x2d;for(const [_0x1dafad,_0x3f65df]of Object[_0x4a156f(0xf7)](_0x58f802)){if(_0x1dafad[_0x4a156f(0x1ff)]()===_0x4e3897[_0x4a156f(0x27a)][_0x4a156f(0x1ff)]()){_0x28cfa3=_0x3f65df[_0x4a156f(0x29f)]||0x2d;break;}}_0x4eeb9c=_0x4fd30b*(_0x28cfa3/0x64),_0x2e631b=_0x4fd30b-_0x4eeb9c,console[_0x4a156f(0x135)](_0x4a156f(0x1ec)+_0x4e3897['id']+':\x20'+_0x28cfa3+_0x4a156f(0x13c)+_0x4fd30b[_0x4a156f(0x11c)](0x6)+_0x4a156f(0x1d3));}_0x50a9fe+=_0x4fd30b,_0x34ec0b+=_0x2e631b,_0x537d71+=_0x4eeb9c;let _0x7ac82f;_0x4e3897[_0x4a156f(0x213)]!==null&&_0x4e3897[_0x4a156f(0x213)]!==undefined?(_0x7ac82f=_0x4e3897[_0x4a156f(0x213)],console[_0x4a156f(0x135)](_0x4a156f(0x12c)+_0x4e3897['id']+':\x20'+_0x7ac82f+'%')):(_0x7ac82f=_0x4fd30b>0x0?_0x4eeb9c/_0x4fd30b*0x64:0x0,console[_0x4a156f(0x135)]('üìä\x20Calculated\x20commission\x20rate\x20for\x20payment\x20'+_0x4e3897['id']+':\x20'+_0x7ac82f[_0x4a156f(0x11c)](0x2)+'%'));!_0x17b509[_0x4e3897[_0x4a156f(0x27a)]]&&(_0x17b509[_0x4e3897['gateway']]={'gateway':_0x4e3897[_0x4a156f(0x27a)],'gatewayDisplayName':this[_0x4a156f(0x250)](_0x4e3897['gateway']),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x17b509[_0x4e3897[_0x4a156f(0x27a)]][_0x4a156f(0x280)]++,_0x17b509[_0x4e3897['gateway']][_0x4a156f(0x232)]+=_0x4fd30b,_0x17b509[_0x4e3897[_0x4a156f(0x27a)]][_0x4a156f(0x18d)]+=_0x4eeb9c,_0x17b509[_0x4e3897[_0x4a156f(0x27a)]]['merchantEarningsUSDT']+=_0x2e631b,_0x17b509[_0x4e3897[_0x4a156f(0x27a)]][_0x4a156f(0x1d7)]+=_0x7ac82f;!_0x1e3930['shopId']&&(!_0x582cc7[_0x4e3897[_0x4a156f(0x13e)]]&&(_0x582cc7[_0x4e3897['shopId']]={'shopId':_0x4e3897[_0x4a156f(0x13e)],'shopName':_0x4e3897['shop'][_0x4a156f(0x1d6)],'shopUsername':_0x4e3897[_0x4a156f(0x249)][_0x4a156f(0x243)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x582cc7[_0x4e3897[_0x4a156f(0x13e)]][_0x4a156f(0x280)]++,_0x582cc7[_0x4e3897['shopId']]['turnoverUSDT']+=_0x4fd30b,_0x582cc7[_0x4e3897[_0x4a156f(0x13e)]]['commissionUSDT']+=_0x4eeb9c,_0x582cc7[_0x4e3897['shopId']][_0x4a156f(0xf3)]+=_0x2e631b);const _0x1734e0=_0x4e3897[_0x4a156f(0x145)]['toISOString']()[_0x4a156f(0x15c)]('T')[0x0];_0x32f2ea[_0x1734e0]&&(_0x32f2ea[_0x1734e0][_0x4a156f(0xe3)]+=_0x4fd30b,_0x32f2ea[_0x1734e0]['merchantEarnings']+=_0x2e631b,_0x32f2ea[_0x1734e0][_0x4a156f(0x1ab)]+=_0x4eeb9c,_0x32f2ea[_0x1734e0]['paymentsCount']++);}catch(_0x454c43){console[_0x4a156f(0x187)]('Error\x20processing\x20payment\x20'+_0x4e3897['id']+':',_0x454c43);}}Object[_0x4a156f(0x1c9)](_0x17b509)[_0x4a156f(0x236)](_0x123a60=>{const _0x4bd617=_0x4a156f;_0x123a60[_0x4bd617(0xca)]=_0x123a60[_0x4bd617(0x280)]>0x0?_0x123a60[_0x4bd617(0x1d7)]/_0x123a60[_0x4bd617(0x280)]:0x0,delete _0x123a60[_0x4bd617(0x1d7)];}),Object[_0x4a156f(0x1c9)](_0x582cc7)[_0x4a156f(0x236)](_0x21c5a0=>{const _0x57d0d5=_0x4a156f;_0x21c5a0[_0x57d0d5(0x158)]=_0x21c5a0[_0x57d0d5(0x280)]>0x0?_0x21c5a0[_0x57d0d5(0x232)]/_0x21c5a0['paymentsCount']:0x0;});let _0x29fb4c=0x0,_0x4cb8e0=0x0;if(_0x1e3930[_0x4a156f(0x13e)]){const _0x2d09c5=await database_1[_0x4a156f(0x10c)]['payout'][_0x4a156f(0x19e)]({'where':{'shopId':_0x1e3930['shopId'],'status':_0x4a156f(0x124),'createdAt':{'gte':_0x211ba5,'lte':_0x25d7b5}},'select':{'amount':!![]}});_0x29fb4c=_0x2d09c5[_0x4a156f(0x248)]((_0x4dca21,_0x35437d)=>_0x4dca21+_0x35437d[_0x4a156f(0x1b6)],0x0);const _0x140991=await database_1['default'][_0x4a156f(0x1a0)][_0x4a156f(0x19e)]({'where':{'shopId':_0x1e3930['shopId'],'status':'PENDING','createdAt':{'gte':_0x211ba5,'lte':_0x25d7b5}},'select':{'amount':!![]}});_0x4cb8e0=_0x140991[_0x4a156f(0x248)]((_0x3c087a,_0x4bfeaf)=>_0x3c087a+_0x4bfeaf[_0x4a156f(0x1b6)],0x0);}const _0xf6370d=_0x4cda98,_0x47b3e9=_0x582d86[_0x4a156f(0x149)],_0x145c74=_0x47b3e9>0x0?_0x50a9fe/_0x47b3e9:0x0,_0x3fd24e=_0xf6370d>0x0?Math[_0x4a156f(0x1d9)](_0x47b3e9/_0xf6370d*0x2710)/0x64:0x0,_0x34bceb=Math[_0x4a156f(0x233)]((_0x25d7b5['getTime']()-_0x211ba5[_0x4a156f(0x18f)]())/(0x3e8*0x3c*0x3c*0x18)),_0x3ba656={'totalTurnover':Math[_0x4a156f(0x1d9)](_0x50a9fe*0x64)/0x64,'merchantEarnings':Math[_0x4a156f(0x1d9)](_0x34ec0b*0x64)/0x64,'gatewayEarnings':Math[_0x4a156f(0x1d9)](_0x537d71*0x64)/0x64,'totalPaidOut':Math[_0x4a156f(0x1d9)](_0x29fb4c*0x64)/0x64,'pendingPayout':Math[_0x4a156f(0x1d9)](_0x4cb8e0*0x64)/0x64,'averageCheck':Math[_0x4a156f(0x1d9)](_0x145c74*0x64)/0x64,'totalPayments':_0xf6370d,'successfulPayments':_0x47b3e9,'conversionRate':_0x3fd24e,'chargebacks':_0x7b0cfa,'refunds':_0x142322,'gatewayBreakdown':Object['values'](_0x17b509)[_0x4a156f(0xfb)](_0x11ddbc=>({..._0x11ddbc,'turnoverUSDT':Math['round'](_0x11ddbc[_0x4a156f(0x232)]*0x64)/0x64,'commissionUSDT':Math[_0x4a156f(0x1d9)](_0x11ddbc[_0x4a156f(0x18d)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x4a156f(0x1d9)](_0x11ddbc[_0x4a156f(0xf3)]*0x64)/0x64,'averageCommissionRate':Math[_0x4a156f(0x1d9)](_0x11ddbc[_0x4a156f(0xca)]*0x64)/0x64})),'merchantBreakdown':_0x1e3930[_0x4a156f(0x13e)]?undefined:Object['values'](_0x582cc7)['map'](_0x34ef7e=>({..._0x34ef7e,'turnoverUSDT':Math[_0x4a156f(0x1d9)](_0x34ef7e[_0x4a156f(0x232)]*0x64)/0x64,'commissionUSDT':Math[_0x4a156f(0x1d9)](_0x34ef7e[_0x4a156f(0x18d)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x4a156f(0x1d9)](_0x34ef7e['merchantEarningsUSDT']*0x64)/0x64,'paidOutUSDT':Math[_0x4a156f(0x1d9)](_0x34ef7e['paidOutUSDT']*0x64)/0x64,'averageCheckUSDT':Math[_0x4a156f(0x1d9)](_0x34ef7e['averageCheckUSDT']*0x64)/0x64})),'dailyData':Object['values'](_0x32f2ea)[_0x4a156f(0xfb)](_0x4cf06b=>({..._0x4cf06b,'turnover':Math[_0x4a156f(0x1d9)](_0x4cf06b[_0x4a156f(0xe3)]*0x64)/0x64,'merchantEarnings':Math[_0x4a156f(0x1d9)](_0x4cf06b[_0x4a156f(0xc2)]*0x64)/0x64,'gatewayEarnings':Math['round'](_0x4cf06b['gatewayEarnings']*0x64)/0x64}))['sort']((_0x3fe3f0,_0x3489d6)=>_0x3fe3f0['date']['localeCompare'](_0x3489d6[_0x4a156f(0x104)])),'periodInfo':{'from':_0x211ba5,'to':_0x25d7b5,'periodType':_0x1e3930[_0x4a156f(0x151)]||_0x4a156f(0x152),'daysCount':_0x34bceb}};return console[_0x4a156f(0x135)](_0x4a156f(0xc8)),console[_0x4a156f(0x135)]('\x20\x20\x20üí∞\x20Total\x20turnover:\x20'+_0x3ba656[_0x4a156f(0x1cb)]+_0x4a156f(0x1d3)),console[_0x4a156f(0x135)]('\x20\x20\x20üë§\x20Merchant\x20earnings:\x20'+_0x3ba656[_0x4a156f(0xc2)]+_0x4a156f(0x1d3)),console[_0x4a156f(0x135)](_0x4a156f(0x19c)+_0x3ba656[_0x4a156f(0x1ab)]+'\x20USDT'),console[_0x4a156f(0x135)]('\x20\x20\x20ÔøΩ\x20Total\x20paid\x20out:\x20'+_0x3ba656[_0x4a156f(0xcb)]+_0x4a156f(0x1d3)),console[_0x4a156f(0x135)](_0x4a156f(0xec)+_0x3ba656['pendingPayout']+_0x4a156f(0x1d3)),console[_0x4a156f(0x135)](_0x4a156f(0x23f)+_0x3ba656[_0x4a156f(0xf9)]),_0x3ba656;}async[a53_0x4a281e(0x14c)](_0x5d6105){const _0x4e428f=a53_0x4a281e;console[_0x4e428f(0x135)](_0x4e428f(0x176),{'hasPayoutHistory':_0x5d6105});let _0x4e0ea7={};_0x5d6105&&(_0x4e0ea7[_0x4e428f(0x16e)]={'some':{}});const _0x32f258=await database_1[_0x4e428f(0x10c)][_0x4e428f(0x249)][_0x4e428f(0x19e)]({'where':_0x4e0ea7,'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x4e428f(0x1fe)}});return console[_0x4e428f(0x135)](_0x4e428f(0x16f)+_0x32f258[_0x4e428f(0x149)]+_0x4e428f(0x292)+(_0x5d6105?_0x4e428f(0xd3):'')),_0x32f258['map'](_0x6f56f2=>({'id':_0x6f56f2['id'],'username':_0x6f56f2[_0x4e428f(0x243)],'name':_0x6f56f2[_0x4e428f(0x1d6)]}));}['getGatewayDisplayName'](_0x24f39f){const _0x52c3f4=a53_0x4a281e,_0x107f94={'test_gateway':_0x52c3f4(0x19d),'plisio':_0x52c3f4(0x1d1),'rapyd':_0x52c3f4(0x1f3),'noda':_0x52c3f4(0x235),'cointopay':_0x52c3f4(0x178),'cointopay2':_0x52c3f4(0x20e),'klyme_eu':_0x52c3f4(0x1b4),'klyme_gb':_0x52c3f4(0x1b0),'klyme_de':_0x52c3f4(0x278),'mastercard':_0x52c3f4(0x15a),'visa/mastercard':'Visa/MasterCard','amer':_0x52c3f4(0x17e),'myxspend':_0x52c3f4(0x264),'ampay':_0x52c3f4(0x24f),'ampay_try':_0x52c3f4(0x108),'sepa':'Sepa','interac':_0x52c3f4(0x25d),'onramp':_0x52c3f4(0x101),'squirrelpay':_0x52c3f4(0x258),'maxpara':_0x52c3f4(0x1e3),'instaxchange':'InstaXchange','oxapay':_0x52c3f4(0x28c)};return _0x107f94[_0x24f39f]||_0x24f39f;}[a53_0x4a281e(0x282)](_0x19b93e){const _0x9c505a=a53_0x4a281e,_0x2f00ea={'Test\x20Gateway':_0x9c505a(0x1f4),'Plisio':_0x9c505a(0x253),'Rapyd':_0x9c505a(0x259),'Noda':_0x9c505a(0x222),'CoinToPay':_0x9c505a(0xd4),'CoinToPay2':_0x9c505a(0x19f),'KLYME\x20EU':'klyme_eu','KLYME\x20GB':_0x9c505a(0x116),'KLYME\x20DE':_0x9c505a(0x1ce),'MasterCard':_0x9c505a(0x234)};return _0x2f00ea[_0x19b93e]||_0x19b93e[_0x9c505a(0x1ff)]();}async[a53_0x4a281e(0x1b3)](_0x3b11e0){const _0x515eca=a53_0x4a281e,{page:_0x111bb9,limit:_0x2e2d57,minAmount:_0x130501,search:_0x4bdaa6}=_0x3b11e0;console['log'](_0x515eca(0x1e7),_0x3b11e0);let _0x4f4a36={};_0x4bdaa6&&(_0x4f4a36['name']={'contains':_0x4bdaa6,'mode':_0x515eca(0x254)});const _0x515d27=await database_1['default'][_0x515eca(0x249)][_0x515eca(0x19e)]({'where':_0x4f4a36,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),_0x42d797=_0x515d27[_0x515eca(0x110)](_0x388ced=>{const _0x57a1bc=_0x515eca,_0x31941f=Math[_0x57a1bc(0x1c8)](_0x388ced[_0x57a1bc(0xe2)]*0x64)/0x64;if(_0x130501&&_0x31941f<_0x130501)return![];return _0x31941f!==0x0;});_0x42d797[_0x515eca(0x160)]((_0x4f906b,_0xee2a34)=>_0xee2a34['balance']-_0x4f906b['balance']);const _0x42ceae=_0x42d797[_0x515eca(0x149)],_0xd1190c=(_0x111bb9-0x1)*_0x2e2d57,_0x421957=_0x42d797['slice'](_0xd1190c,_0xd1190c+_0x2e2d57);console[_0x515eca(0x135)](_0x515eca(0xc7)+_0x421957[_0x515eca(0x149)]+_0x515eca(0x27b));const _0x34f1c8=await Promise[_0x515eca(0x166)](_0x421957[_0x515eca(0xfb)](async _0x1c0d79=>{const _0x3ef9d9=_0x515eca,[_0x5cbb55,_0x2bf72d,_0x3d0bd6]=await Promise['all']([database_1[_0x3ef9d9(0x10c)]['payment'][_0x3ef9d9(0x182)]({'where':{'shopId':_0x1c0d79['id'],'status':_0x3ef9d9(0x256),'gateway':{'not':_0x3ef9d9(0x1f4)}}}),database_1[_0x3ef9d9(0x10c)][_0x3ef9d9(0x183)][_0x3ef9d9(0x221)]({'where':{'shopId':_0x1c0d79['id'],'status':'PAID','gateway':{'not':_0x3ef9d9(0x1f4)}},'orderBy':{'paidAt':_0x3ef9d9(0x1fe)},'select':{'paidAt':!![]}}),database_1[_0x3ef9d9(0x10c)]['payment'][_0x3ef9d9(0x295)]({'by':[_0x3ef9d9(0x27a)],'where':{'shopId':_0x1c0d79['id'],'status':_0x3ef9d9(0x256),'gateway':{'not':_0x3ef9d9(0x1f4)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x10e1bd=new Date(),_0x4ab922=new Date(_0x10e1bd[_0x3ef9d9(0x229)](),_0x10e1bd['getMonth'](),0x1),_0x234cba=new Date(_0x10e1bd['getFullYear'](),_0x10e1bd[_0x3ef9d9(0xdd)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x262f58,_0x18fe22]=await Promise[_0x3ef9d9(0x166)]([database_1[_0x3ef9d9(0x10c)][_0x3ef9d9(0x1a0)][_0x3ef9d9(0x192)]({'_sum':{'amount':!![]},'where':{'shopId':_0x1c0d79['id'],'status':'COMPLETED'}}),database_1[_0x3ef9d9(0x10c)]['payout'][_0x3ef9d9(0x192)]({'_sum':{'amount':!![]},'where':{'shopId':_0x1c0d79['id'],'status':_0x3ef9d9(0x124),'createdAt':{'gte':_0x4ab922,'lte':_0x234cba}}})]),_0x44cb2e=_0x262f58[_0x3ef9d9(0x1f5)]['amount']||0x0,_0x3f77d5=_0x18fe22[_0x3ef9d9(0x1f5)][_0x3ef9d9(0x1b6)]||0x0,_0x131287=await Promise[_0x3ef9d9(0x166)](_0x3d0bd6[_0x3ef9d9(0xfb)](async _0x3568b6=>{const _0x46c652=_0x3ef9d9,_0x87a5a4=await database_1[_0x46c652(0x10c)]['payment'][_0x46c652(0x19e)]({'where':{'shopId':_0x1c0d79['id'],'status':_0x46c652(0x256),'gateway':_0x3568b6['gateway']},'select':{'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![]}});let _0x31d20c=0x2d;if(_0x1c0d79[_0x46c652(0x161)])try{const _0x2b58a5=JSON['parse'](_0x1c0d79['gatewaySettings']);for(const [_0x1a663b,_0x150c35]of Object[_0x46c652(0xf7)](_0x2b58a5)){if(_0x1a663b[_0x46c652(0x1ff)]()===_0x3568b6[_0x46c652(0x27a)][_0x46c652(0x1ff)]()){_0x31d20c=_0x150c35['commission']||0xa,console[_0x46c652(0x135)](_0x46c652(0xed)+_0x3568b6[_0x46c652(0x27a)]+_0x46c652(0x28a)+_0x1c0d79['id']+_0x46c652(0x1c7)+_0x31d20c+'%');break;}}}catch(_0x16a03d){console[_0x46c652(0x187)](_0x46c652(0x283)+_0x1c0d79['id']+':',_0x16a03d);}const _0x7f37f5=_0x3568b6['_sum']?.[_0x46c652(0x1da)]||0x0;let _0x2dfd93=0x0;for(const _0x168bb3 of _0x87a5a4){if(_0x168bb3[_0x46c652(0x1de)]!==null&&_0x168bb3[_0x46c652(0x1de)]!==undefined)_0x2dfd93+=_0x168bb3[_0x46c652(0x1de)];else{const _0x8f7903=_0x168bb3[_0x46c652(0x1da)]||0x0;_0x2dfd93+=_0x8f7903*(0x1-_0x31d20c/0x64);}}return{'gateway':_0x3568b6[_0x46c652(0x27a)],'count':_0x3568b6['_count']?.['id']||0x0,'amountUSDT':Math['round'](_0x7f37f5*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x46c652(0x1d9)](_0x2dfd93*0x64)/0x64,'commission':_0x31d20c};})),_0x2ead92=_0x131287[_0x3ef9d9(0x248)]((_0x10e31f,_0xf25621)=>_0x10e31f+_0xf25621['amountUSDT'],0x0),_0x13c441=_0x131287['reduce']((_0x175bbd,_0x3d1fcb)=>_0x175bbd+_0x3d1fcb[_0x3ef9d9(0x136)],0x0),_0x347d28=_0x1c0d79[_0x3ef9d9(0xe2)];return console['log'](_0x3ef9d9(0xfc)+_0x1c0d79[_0x3ef9d9(0x243)]+':'),console['log'](_0x3ef9d9(0x201)+_0x2ead92[_0x3ef9d9(0x11c)](0x2)+_0x3ef9d9(0xcf)),console[_0x3ef9d9(0x135)](_0x3ef9d9(0x113)+_0x13c441['toFixed'](0x2)+_0x3ef9d9(0x26a)),console['log'](_0x3ef9d9(0x22c)+_0x347d28[_0x3ef9d9(0x11c)](0x2)+_0x3ef9d9(0x1bb)),console[_0x3ef9d9(0x135)](_0x3ef9d9(0x25a)+_0x44cb2e['toFixed'](0x2)+_0x3ef9d9(0x134)),console[_0x3ef9d9(0x135)]('\x20\x20\x20ü§î\x20Difference:\x20'+(_0x13c441-_0x44cb2e-_0x347d28)[_0x3ef9d9(0x11c)](0x2)+'\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)'),{'id':_0x1c0d79['id'],'fullName':_0x1c0d79[_0x3ef9d9(0x1d6)],'username':_0x1c0d79['username'],'telegramId':_0x1c0d79[_0x3ef9d9(0x205)],'merchantUrl':_0x1c0d79[_0x3ef9d9(0x174)],'wallets':{'usdtPolygonWallet':_0x1c0d79['usdtPolygonWallet'],'usdtTrcWallet':_0x1c0d79['usdtTrcWallet'],'usdtErcWallet':_0x1c0d79['usdtErcWallet'],'usdcPolygonWallet':_0x1c0d79[_0x3ef9d9(0xee)],'usdcErcWallet':_0x1c0d79[_0x3ef9d9(0x29a)]},'totalAmountUSDT':Math[_0x3ef9d9(0x1d9)](_0x2ead92*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x3ef9d9(0x1d9)](_0x13c441*0x64)/0x64,'currentBalance':Math[_0x3ef9d9(0x1c8)](_0x347d28*0x64)/0x64,'totalPayout':Math[_0x3ef9d9(0x1d9)](_0x44cb2e*0x64)/0x64,'thisMonth':Math['round'](_0x3f77d5*0x64)/0x64,'paymentsCount':_0x5cbb55,'oldestPaymentDate':_0x2bf72d?.[_0x3ef9d9(0x145)]||_0x1c0d79[_0x3ef9d9(0xe8)],'gatewayBreakdown':_0x131287};})),_0x2ee3cb=_0x34f1c8['reduce']((_0xccb140,_0x6f079f)=>_0xccb140+_0x6f079f[_0x515eca(0xe1)],0x0),_0x1015d7=_0x34f1c8['reduce']((_0x477931,_0x5b5cc6)=>_0x477931+_0x5b5cc6[_0x515eca(0x1fc)],0x0),_0x3b6e8f=_0x34f1c8['reduce']((_0x37850b,_0x2f2d80)=>_0x37850b+_0x2f2d80['totalPayout'],0x0),_0x1fc5b9=_0x34f1c8[_0x515eca(0x248)]((_0x30581f,_0x136709)=>_0x30581f+_0x136709[_0x515eca(0x251)],0x0);return console['log'](_0x515eca(0x291)+_0x42ceae+'\x20merchants'),console[_0x515eca(0x135)](_0x515eca(0x24b)+Math[_0x515eca(0x1d9)](_0x2ee3cb*0x64)/0x64+'\x20USDT\x20(gross\x20revenue)'),console[_0x515eca(0x135)](_0x515eca(0x289)+Math[_0x515eca(0x1d9)](_0x1015d7*0x64)/0x64+_0x515eca(0xe7)),console[_0x515eca(0x135)](_0x515eca(0x198)+Math[_0x515eca(0x1d9)](_0x3b6e8f*0x64)/0x64+_0x515eca(0x1d3)),console[_0x515eca(0x135)](_0x515eca(0x129)+Math[_0x515eca(0x1d9)](_0x1fc5b9*0x64)/0x64+_0x515eca(0x1d3)),{'merchants':_0x34f1c8,'pagination':{'page':_0x111bb9,'limit':_0x2e2d57,'total':_0x42ceae,'totalPages':Math['ceil'](_0x42ceae/_0x2e2d57)},'summary':{'totalMerchants':_0x42ceae,'totalAmountUSDT':Math[_0x515eca(0x1d9)](_0x2ee3cb*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x515eca(0x1d9)](_0x1015d7*0x64)/0x64,'totalPayout':Math[_0x515eca(0x1d9)](_0x3b6e8f*0x64)/0x64,'thisMonth':Math[_0x515eca(0x1d9)](_0x1fc5b9*0x64)/0x64}};}async[a53_0x4a281e(0x1ea)](_0x3fe2ad){const _0x230082=a53_0x4a281e,{shopId:_0xcabaf8,amount:_0x56f7c6,network:_0x3bef9b,wallet:_0x90dbd5,notes:_0xaebbdc,txid:_0x2f6f1a,periodFrom:_0x19cfdb,periodTo:_0x1c889a}=_0x3fe2ad,_0x1ac8bb=await database_1[_0x230082(0x10c)][_0x230082(0x1e6)](async _0x35dea5=>{const _0x31ab85=_0x230082,_0x2ba440=await _0x35dea5['shop'][_0x31ab85(0x1b9)]({'where':{'id':_0xcabaf8},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x2ba440)throw new Error(_0x31ab85(0x103));console[_0x31ab85(0x135)](_0x31ab85(0x25e)+_0x2ba440['username']+':'),console[_0x31ab85(0x135)](_0x31ab85(0x25c)+_0x2ba440[_0x31ab85(0xe2)][_0x31ab85(0x11c)](0x6)+_0x31ab85(0x1d3)),console[_0x31ab85(0x135)]('\x20\x20\x20Payout\x20amount:\x20'+_0x56f7c6[_0x31ab85(0x11c)](0x6)+_0x31ab85(0x1d3)),console['log'](_0x31ab85(0x17c)+_0x2ba440[_0x31ab85(0xcb)][_0x31ab85(0x11c)](0x6)+_0x31ab85(0x1d3));if(_0x2f6f1a)console[_0x31ab85(0x135)](_0x31ab85(0x12b)+_0x2f6f1a);const _0x1d90e9=0.000001,_0x5b6992=Number(_0x2ba440['balance']),_0x45f49a=Number(_0x56f7c6);console[_0x31ab85(0x135)](_0x31ab85(0x1cd)),console[_0x31ab85(0x135)]('\x20\x20\x20Available\x20(raw):\x20'+_0x2ba440[_0x31ab85(0xe2)]),console[_0x31ab85(0x135)](_0x31ab85(0xfa)+_0x5b6992),console[_0x31ab85(0x135)](_0x31ab85(0x1bc)+_0x45f49a),console[_0x31ab85(0x135)]('\x20\x20\x20Difference:\x20'+(_0x5b6992-_0x45f49a)),console['log'](_0x31ab85(0xf0)+_0x1d90e9);if(_0x5b6992<_0x45f49a-_0x1d90e9)throw new Error(_0x31ab85(0x122)+_0x5b6992[_0x31ab85(0x11c)](0x6)+_0x31ab85(0x1d4)+_0x45f49a[_0x31ab85(0x11c)](0x6)+_0x31ab85(0x13f)+(_0x5b6992-_0x45f49a)['toFixed'](0x8)+_0x31ab85(0x1d3));console[_0x31ab85(0x135)]('‚úÖ\x20Balance\x20check\x20passed\x20(with\x20tolerance)');const _0x3c2023=Math[_0x31ab85(0x143)](_0x5b6992,_0x45f49a);let _0x3ad54b=_0x90dbd5;console[_0x31ab85(0x135)]('üîç\x20Initial\x20wallet\x20from\x20request:\x20'+(_0x90dbd5||'not\x20provided'));if(!_0x3ad54b){console['log'](_0x31ab85(0x147));const _0x1f8bb3=await _0x35dea5[_0x31ab85(0x249)]['findUnique']({'where':{'id':_0xcabaf8},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});console[_0x31ab85(0x135)](_0x31ab85(0x1df),_0x1f8bb3);if(_0x1f8bb3)switch(_0x3bef9b){case _0x31ab85(0x188):_0x3ad54b=_0x1f8bb3[_0x31ab85(0x230)]||undefined,console['log']('üîç\x20Selected\x20polygon\x20wallet:\x20'+_0x3ad54b);break;case _0x31ab85(0xc1):_0x3ad54b=_0x1f8bb3[_0x31ab85(0x111)]||undefined,console['log'](_0x31ab85(0x28f)+_0x3ad54b);break;case _0x31ab85(0x142):_0x3ad54b=_0x1f8bb3[_0x31ab85(0x210)]||undefined,console[_0x31ab85(0x135)](_0x31ab85(0x273)+_0x3ad54b);break;case _0x31ab85(0xdc):_0x3ad54b=_0x1f8bb3[_0x31ab85(0xee)]||undefined,console[_0x31ab85(0x135)]('üîç\x20Selected\x20polygon_usdc\x20wallet:\x20'+_0x3ad54b);break;case _0x31ab85(0x231):_0x3ad54b=_0x1f8bb3[_0x31ab85(0x29a)]||undefined,console['log'](_0x31ab85(0x270)+_0x3ad54b);break;}}else console['log']('‚úÖ\x20Using\x20wallet\x20from\x20request:\x20'+_0x3ad54b);console[_0x31ab85(0x135)](_0x31ab85(0x12d)+_0x3bef9b+':\x20'+(_0x3ad54b||'not\x20specified')),console[_0x31ab85(0x135)]('üîç\x20Creating\x20payout\x20with\x20data:',{'shopId':_0xcabaf8,'amount':_0x3c2023,'network':_0x3bef9b,'wallet':_0x3ad54b,'status':_0x31ab85(0x124),'txid':_0x2f6f1a,'notes':_0xaebbdc,'periodFrom':_0x19cfdb?new Date(_0x19cfdb):null,'periodTo':_0x1c889a?new Date(_0x1c889a):null});const _0x487f10=await _0x35dea5[_0x31ab85(0x1a0)][_0x31ab85(0xef)]({'data':{'shopId':_0xcabaf8,'amount':_0x3c2023,'network':_0x3bef9b,'wallet':_0x3ad54b,'status':_0x31ab85(0x124),'txid':_0x2f6f1a,'notes':_0xaebbdc,'periodFrom':_0x19cfdb?new Date(_0x19cfdb):null,'periodTo':_0x1c889a?new Date(_0x1c889a):null,'createdAt':new Date(),'paidAt':new Date()}});console[_0x31ab85(0x135)](_0x31ab85(0x1a2),{'id':_0x487f10['id'],'wallet':_0x487f10[_0x31ab85(0x177)],'network':_0x487f10['network'],'amount':_0x487f10[_0x31ab85(0x1b6)]});const _0xe3bef=_0x5b6992-_0x3c2023,_0x15397d=Number(_0x2ba440['totalPaidOut'])+_0x3c2023;return await _0x35dea5[_0x31ab85(0x249)][_0x31ab85(0x191)]({'where':{'id':_0xcabaf8},'data':{'balance':_0xe3bef,'totalPaidOut':_0x15397d}}),console[_0x31ab85(0x135)](_0x31ab85(0xf5)+_0x2ba440[_0x31ab85(0x243)]+_0x31ab85(0x13d)),console['log'](_0x31ab85(0x228)+_0x5b6992['toFixed'](0x6)+'\x20->\x20'+_0xe3bef[_0x31ab85(0x11c)](0x6)+_0x31ab85(0x1ee)+_0x3c2023[_0x31ab85(0x11c)](0x6)+')'),console[_0x31ab85(0x135)]('\x20\x20\x20Total\x20paid\x20out:\x20'+_0x2ba440[_0x31ab85(0xcb)][_0x31ab85(0x11c)](0x6)+'\x20->\x20'+_0x15397d['toFixed'](0x6)+_0x31ab85(0x29d)+_0x3c2023[_0x31ab85(0x11c)](0x6)+')'),console[_0x31ab85(0x135)](_0x31ab85(0x179)+_0x3c2023[_0x31ab85(0x11c)](0x6)+_0x31ab85(0x1d3)),{'payout':_0x487f10,'shop':_0x2ba440};});console[_0x230082(0x135)](_0x230082(0x27e)+_0x1ac8bb[_0x230082(0x1a0)]['id']+_0x230082(0x28a)+_0x1ac8bb[_0x230082(0x249)][_0x230082(0x243)]+'\x20('+_0x1ac8bb[_0x230082(0x1a0)][_0x230082(0x1b6)]['toFixed'](0x6)+_0x230082(0x239));try{let _0x7473c2='–ù–µ\x20—É–∫–∞–∑–∞–Ω';if(_0x1ac8bb[_0x230082(0x1a0)][_0x230082(0x22f)]&&_0x1ac8bb[_0x230082(0x1a0)][_0x230082(0x216)]){const _0x3d8cd6=new Date(_0x1ac8bb['payout'][_0x230082(0x22f)])[_0x230082(0x218)]('ru-RU'),_0x9d9ded=new Date(_0x1ac8bb[_0x230082(0x1a0)][_0x230082(0x216)])[_0x230082(0x218)](_0x230082(0x16b));_0x7473c2=_0x3d8cd6+_0x230082(0x137)+_0x9d9ded;}await telegramBotService_1['telegramBotService'][_0x230082(0x261)](_0x1ac8bb[_0x230082(0x1a0)][_0x230082(0x13e)],{'id':_0x1ac8bb[_0x230082(0x1a0)]['id'],'amount':_0x1ac8bb[_0x230082(0x1a0)][_0x230082(0x1b6)],'network':_0x1ac8bb[_0x230082(0x1a0)]['network'],'wallet':_0x1ac8bb[_0x230082(0x1a0)][_0x230082(0x177)],'period':_0x7473c2,'createdAt':_0x1ac8bb[_0x230082(0x1a0)][_0x230082(0xe8)],'txid':_0x1ac8bb[_0x230082(0x1a0)][_0x230082(0x1e8)]}),console[_0x230082(0x135)](_0x230082(0x14b)+_0x1ac8bb[_0x230082(0x1a0)]['id']);}catch(_0x3a908c){console[_0x230082(0x187)](_0x230082(0x162)+_0x1ac8bb[_0x230082(0x1a0)]['id']+':',_0x3a908c);}return{'id':_0x1ac8bb['payout']['id'],'shopId':_0x1ac8bb[_0x230082(0x1a0)][_0x230082(0x13e)],'shopName':_0x1ac8bb[_0x230082(0x249)][_0x230082(0x1d6)],'shopUsername':_0x1ac8bb[_0x230082(0x249)]['username'],'amount':_0x1ac8bb[_0x230082(0x1a0)][_0x230082(0x1b6)],'network':_0x1ac8bb[_0x230082(0x1a0)][_0x230082(0x220)],'wallet':_0x1ac8bb['payout'][_0x230082(0x177)],'status':_0x1ac8bb['payout'][_0x230082(0x207)],'txid':_0x1ac8bb[_0x230082(0x1a0)][_0x230082(0x1e8)],'notes':_0x1ac8bb['payout'][_0x230082(0x1a3)],'periodFrom':_0x1ac8bb[_0x230082(0x1a0)][_0x230082(0x22f)],'periodTo':_0x1ac8bb[_0x230082(0x1a0)][_0x230082(0x216)],'createdAt':_0x1ac8bb[_0x230082(0x1a0)][_0x230082(0xe8)],'paidAt':_0x1ac8bb[_0x230082(0x1a0)][_0x230082(0x145)]};}async[a53_0x4a281e(0x150)](_0x4a7966){const _0x21a5b5=a53_0x4a281e,{page:_0xd229e5,limit:_0x9869b0,shopId:_0x2f8eee,network:_0x5b5927,dateFrom:_0x785543,dateTo:_0x2b12eb,search:_0x3d2a6b}=_0x4a7966,_0x2eb590=(_0xd229e5-0x1)*_0x9869b0,_0x49ab63={};_0x2f8eee&&(_0x49ab63[_0x21a5b5(0x13e)]=_0x2f8eee);_0x5b5927&&(_0x49ab63[_0x21a5b5(0x220)]=_0x5b5927);if(_0x785543||_0x2b12eb){_0x49ab63[_0x21a5b5(0xe8)]={};if(_0x785543){const _0x58e78e=new Date(_0x785543);_0x58e78e[_0x21a5b5(0xcc)](0x0,0x0,0x0,0x1),_0x49ab63[_0x21a5b5(0xe8)][_0x21a5b5(0x24c)]=_0x58e78e,console['log']('üìÖ\x20Payout\x20date\x20from\x20filter:\x20'+_0x58e78e[_0x21a5b5(0x266)]());}if(_0x2b12eb){const _0x1193e9=new Date(_0x2b12eb);_0x1193e9[_0x21a5b5(0xcc)](0x17,0x3b,0x3b,0x3e7),_0x49ab63[_0x21a5b5(0xe8)]['lte']=_0x1193e9,console[_0x21a5b5(0x135)](_0x21a5b5(0x281)+_0x1193e9['toISOString']());}}_0x3d2a6b&&(_0x49ab63['OR']=[{'shop':{'name':{'contains':_0x3d2a6b,'mode':_0x21a5b5(0x254)}}},{'shop':{'username':{'contains':_0x3d2a6b,'mode':_0x21a5b5(0x254)}}},{'notes':{'contains':_0x3d2a6b,'mode':_0x21a5b5(0x254)}}]);const [_0x42ab9f,_0x1cff7a]=await Promise[_0x21a5b5(0x166)]([database_1[_0x21a5b5(0x10c)]['payout'][_0x21a5b5(0x19e)]({'where':_0x49ab63,'skip':_0x2eb590,'take':_0x9869b0,'orderBy':{'createdAt':_0x21a5b5(0x27d)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'wallet':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x21a5b5(0x10c)]['payout']['count']({'where':_0x49ab63})]);return{'payouts':_0x42ab9f[_0x21a5b5(0xfb)](_0x36488a=>({'id':_0x36488a['id'],'shopId':_0x36488a[_0x21a5b5(0x13e)],'shopName':_0x36488a['shop'][_0x21a5b5(0x1d6)],'shopUsername':_0x36488a['shop'][_0x21a5b5(0x243)],'amount':_0x36488a['amount'],'network':_0x36488a['network'],'wallet':_0x36488a[_0x21a5b5(0x177)],'status':_0x36488a[_0x21a5b5(0x207)],'txid':_0x36488a['txid'],'notes':_0x36488a[_0x21a5b5(0x1a3)],'periodFrom':_0x36488a[_0x21a5b5(0x22f)],'periodTo':_0x36488a['periodTo'],'createdAt':_0x36488a['createdAt'],'paidAt':_0x36488a[_0x21a5b5(0x145)]})),'pagination':{'page':_0xd229e5,'limit':_0x9869b0,'total':_0x1cff7a,'totalPages':Math['ceil'](_0x1cff7a/_0x9869b0)}};}async[a53_0x4a281e(0xd2)](_0x104f62){const _0x35d623=a53_0x4a281e,_0x3c3da5=await database_1[_0x35d623(0x10c)][_0x35d623(0x1a0)][_0x35d623(0x1b9)]({'where':{'id':_0x104f62},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x3c3da5)return null;return{'id':_0x3c3da5['id'],'shopId':_0x3c3da5['shopId'],'shopName':_0x3c3da5[_0x35d623(0x249)][_0x35d623(0x1d6)],'shopUsername':_0x3c3da5[_0x35d623(0x249)][_0x35d623(0x243)],'amount':_0x3c3da5[_0x35d623(0x1b6)],'network':_0x3c3da5['network'],'wallet':_0x3c3da5[_0x35d623(0x177)],'status':_0x3c3da5['status'],'txid':_0x3c3da5[_0x35d623(0x1e8)],'notes':_0x3c3da5[_0x35d623(0x1a3)],'periodFrom':_0x3c3da5['periodFrom'],'periodTo':_0x3c3da5[_0x35d623(0x216)],'createdAt':_0x3c3da5[_0x35d623(0xe8)],'paidAt':_0x3c3da5['paidAt']};}async[a53_0x4a281e(0x11e)](_0x23b2d6){const _0x137a3a=a53_0x4a281e;await database_1[_0x137a3a(0x10c)][_0x137a3a(0x1a0)][_0x137a3a(0x1d0)]({'where':{'id':_0x23b2d6}});}async['updatePayout'](_0x5341e4,_0x5ac783){const _0x4edb72=a53_0x4a281e,_0x936d1c=await database_1[_0x4edb72(0x10c)][_0x4edb72(0x1e6)](async _0x526937=>{const _0x453c80=_0x4edb72,_0x5d4d08=await _0x526937[_0x453c80(0x1a0)][_0x453c80(0x1b9)]({'where':{'id':_0x5341e4},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}}}});if(!_0x5d4d08)throw new Error(_0x453c80(0x123));console['log'](_0x453c80(0x12a)+_0x5341e4+_0x453c80(0x28a)+_0x5d4d08[_0x453c80(0x249)][_0x453c80(0x243)]+':'),console[_0x453c80(0x135)]('\x20\x20\x20Current\x20amount:\x20'+_0x5d4d08[_0x453c80(0x1b6)]['toFixed'](0x6)+'\x20USDT'),console[_0x453c80(0x135)]('\x20\x20\x20Current\x20network:\x20'+_0x5d4d08[_0x453c80(0x220)]),console[_0x453c80(0x135)](_0x453c80(0x215)+_0x5d4d08['shop'][_0x453c80(0xe2)][_0x453c80(0x11c)](0x6)+'\x20USDT'),console[_0x453c80(0x135)](_0x453c80(0x206)+_0x5d4d08['shop'][_0x453c80(0xcb)][_0x453c80(0x11c)](0x6)+_0x453c80(0x1d3));let _0x1fa385=0x0;if(_0x5ac783[_0x453c80(0x1b6)]!==undefined){const _0x2dcee0=Number(_0x5d4d08[_0x453c80(0x1b6)]),_0x5f648a=Number(_0x5ac783[_0x453c80(0x1b6)]);_0x1fa385=_0x5f648a-_0x2dcee0,console[_0x453c80(0x135)](_0x453c80(0x10e)+_0x5f648a[_0x453c80(0x11c)](0x6)+_0x453c80(0x1d3)),console[_0x453c80(0x135)](_0x453c80(0xc3)+_0x1fa385[_0x453c80(0x11c)](0x6)+'\x20USDT');if(_0x1fa385<0x0)console[_0x453c80(0x135)]('\x20\x20\x20Amount\x20decreased\x20by\x20'+Math[_0x453c80(0x109)](_0x1fa385)[_0x453c80(0x11c)](0x6)+_0x453c80(0x144));else{if(_0x1fa385>0x0){const _0x6ebc2=Number(_0x5d4d08['shop'][_0x453c80(0xe2)]);console[_0x453c80(0x135)](_0x453c80(0x13a)+_0x1fa385['toFixed'](0x6)+_0x453c80(0x238));if(_0x6ebc2<_0x1fa385)throw new Error(_0x453c80(0x1bf)+_0x6ebc2['toFixed'](0x6)+_0x453c80(0x112)+_0x1fa385[_0x453c80(0x11c)](0x6)+'\x20USDT');}}}const _0x273ddc={};if(_0x5ac783[_0x453c80(0x1b6)]!==undefined)_0x273ddc[_0x453c80(0x1b6)]=_0x5ac783[_0x453c80(0x1b6)];if(_0x5ac783[_0x453c80(0x220)]!==undefined)_0x273ddc[_0x453c80(0x220)]=_0x5ac783[_0x453c80(0x220)];if(_0x5ac783['wallet']!==undefined)_0x273ddc[_0x453c80(0x177)]=_0x5ac783[_0x453c80(0x177)]||null;if(_0x5ac783[_0x453c80(0x1a3)]!==undefined)_0x273ddc[_0x453c80(0x1a3)]=_0x5ac783['notes']||null;if(_0x5ac783[_0x453c80(0x1e8)]!==undefined)_0x273ddc[_0x453c80(0x1e8)]=_0x5ac783[_0x453c80(0x1e8)]||null;if(_0x5ac783[_0x453c80(0x22f)]!==undefined)_0x273ddc['periodFrom']=_0x5ac783['periodFrom']?new Date(_0x5ac783[_0x453c80(0x22f)]):null;if(_0x5ac783[_0x453c80(0x216)]!==undefined)_0x273ddc[_0x453c80(0x216)]=_0x5ac783['periodTo']?new Date(_0x5ac783[_0x453c80(0x216)]):null;const _0x86a068=await _0x526937['payout']['update']({'where':{'id':_0x5341e4},'data':_0x273ddc,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(_0x1fa385!==0x0){const _0x5c1da8=Number(_0x5d4d08[_0x453c80(0x249)][_0x453c80(0xe2)]),_0x3cd9b2=Number(_0x5d4d08[_0x453c80(0x249)]['totalPaidOut']),_0xbb9b39=_0x5c1da8-_0x1fa385,_0x32de26=_0x3cd9b2+_0x1fa385;await _0x526937['shop'][_0x453c80(0x191)]({'where':{'id':_0x5d4d08[_0x453c80(0x13e)]},'data':{'balance':_0xbb9b39,'totalPaidOut':_0x32de26}}),console[_0x453c80(0x135)](_0x453c80(0xf5)+_0x5d4d08['shop'][_0x453c80(0x243)]+'\x20balance\x20updated:'),console['log'](_0x453c80(0x228)+_0x5c1da8['toFixed'](0x6)+_0x453c80(0x13b)+_0xbb9b39[_0x453c80(0x11c)](0x6)+'\x20USDT'),console['log']('\x20\x20\x20Total\x20paid\x20out:\x20'+_0x3cd9b2[_0x453c80(0x11c)](0x6)+_0x453c80(0x13b)+_0x32de26[_0x453c80(0x11c)](0x6)+_0x453c80(0x1d3));}return console[_0x453c80(0x135)](_0x453c80(0x203)+_0x5341e4+_0x453c80(0x10d)),_0x86a068;});return{'id':_0x936d1c['id'],'shopId':_0x936d1c['shopId'],'shopName':_0x936d1c['shop'][_0x4edb72(0x1d6)],'shopUsername':_0x936d1c[_0x4edb72(0x249)][_0x4edb72(0x243)],'amount':Number(_0x936d1c[_0x4edb72(0x1b6)]),'network':_0x936d1c[_0x4edb72(0x220)],'wallet':_0x936d1c[_0x4edb72(0x177)],'status':_0x936d1c[_0x4edb72(0x207)],'txid':_0x936d1c['txid'],'notes':_0x936d1c['notes'],'periodFrom':_0x936d1c[_0x4edb72(0x22f)],'periodTo':_0x936d1c[_0x4edb72(0x216)],'createdAt':_0x936d1c['createdAt'],'paidAt':_0x936d1c[_0x4edb72(0x145)]};}async[a53_0x4a281e(0x202)](_0x442988){const _0x2c71e4=a53_0x4a281e,{page:_0x52c38d,limit:_0xb98f9b,status:_0x3f4c6c,gateway:_0x1a4680,shopId:_0x2e82c6,dateFrom:_0x5d02e,dateTo:_0x479e93,search:_0x1824e7,currency:_0x273eff,sortBy:_0x3b2325,sortOrder:_0x430010}=_0x442988,_0x374469=(_0x52c38d-0x1)*_0xb98f9b;console['log'](_0x2c71e4(0x23b),_0x442988);const _0x5f2d01=await database_1['default'][_0x2c71e4(0x183)][_0x2c71e4(0x295)]({'by':[_0x2c71e4(0x27a)],'_count':{'gateway':!![]}});console[_0x2c71e4(0x135)](_0x2c71e4(0x1db),_0x5f2d01['map'](_0x422c46=>_0x422c46[_0x2c71e4(0x27a)]+'\x20('+_0x422c46[_0x2c71e4(0x275)][_0x2c71e4(0x27a)]+_0x2c71e4(0x23e)));if(_0x1a4680){const _0x866eba=_0x5f2d01[_0x2c71e4(0x119)](_0x2c4ae1=>_0x2c4ae1['gateway'][_0x2c71e4(0x1ff)]()===_0x1a4680['toLowerCase']());!_0x866eba&&_0x1a4680[_0x2c71e4(0x1ff)]()!=='test_gateway'&&console[_0x2c71e4(0x135)]('‚ö†Ô∏è\x20Requested\x20gateway\x20\x27'+_0x1a4680+_0x2c71e4(0x18c)+_0x5f2d01[_0x2c71e4(0xfb)](_0x369b1a=>_0x369b1a[_0x2c71e4(0x27a)])['join'](',\x20'));}const _0x2d4c4f={};_0x3f4c6c&&(_0x2d4c4f[_0x2c71e4(0x207)]=_0x3f4c6c[_0x2c71e4(0x1c1)]());if(!_0x1a4680)_0x2d4c4f[_0x2c71e4(0x27a)]={'not':_0x2c71e4(0x1f4)};else{if(_0x1a4680&&(_0x1a4680[_0x2c71e4(0x1ff)]()===_0x2c71e4(0x1f4)||_0x1a4680==='0000'))_0x2d4c4f['gateway']=_0x2c71e4(0x1f4);else{let _0x4acffc=_0x1a4680;const _0x85ccb4=(0x0,gateway_1['getGatewayNameById'])(_0x1a4680);if(_0x85ccb4)_0x4acffc=_0x85ccb4,console[_0x2c71e4(0x135)](_0x2c71e4(0x1f0)+_0x1a4680+_0x2c71e4(0x293)+_0x4acffc+'\x27');else{const _0x4c0da5=(0x0,gateway_1[_0x2c71e4(0x25f)])(_0x1a4680);if(_0x4c0da5){const _0x10d2ef=(0x0,gateway_1[_0x2c71e4(0x146)])(_0x4c0da5);_0x10d2ef&&(_0x4acffc=_0x10d2ef,console[_0x2c71e4(0x135)]('üîÑ\x20Converted\x20gateway\x20name\x20\x27'+_0x1a4680+'\x27\x20->\x20ID\x20\x27'+_0x4c0da5+_0x2c71e4(0x272)+_0x4acffc+'\x27'));}else console[_0x2c71e4(0x135)](_0x2c71e4(0x25b)+_0x1a4680+'\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)');}const _0x2f57d6=await database_1[_0x2c71e4(0x10c)][_0x2c71e4(0x183)][_0x2c71e4(0x182)]({'where':{'gateway':_0x4acffc[_0x2c71e4(0x1ff)]()},'take':0x1});_0x2f57d6===0x0?(console['log'](_0x2c71e4(0x28d)+_0x4acffc+_0x2c71e4(0x246)+_0x1a4680+_0x2c71e4(0x1fb)),_0x2d4c4f['gateway']=_0x2c71e4(0x1c2)):(_0x2d4c4f['gateway']=_0x4acffc['toLowerCase'](),console[_0x2c71e4(0x135)](_0x2c71e4(0x148)+_0x4acffc+_0x2c71e4(0x246)+_0x1a4680+'\x27)'));}}console['log'](_0x2c71e4(0xc9),_0x2d4c4f[_0x2c71e4(0x27a)]);_0x2e82c6&&(_0x2d4c4f[_0x2c71e4(0x13e)]=_0x2e82c6);_0x273eff&&(_0x2d4c4f[_0x2c71e4(0x211)]=_0x273eff[_0x2c71e4(0x1c1)](),console[_0x2c71e4(0x135)](_0x2c71e4(0x252)+_0x273eff[_0x2c71e4(0x1c1)]()));if(_0x5d02e||_0x479e93){_0x2d4c4f[_0x2c71e4(0xe8)]={};if(_0x5d02e){const _0x220448=new Date(_0x5d02e),_0x531b6b=new Date(Date['UTC'](_0x220448['getUTCFullYear'](),_0x220448['getUTCMonth'](),_0x220448[_0x2c71e4(0xe6)](),0x0,0x0,0x0,0x0));_0x2d4c4f[_0x2c71e4(0xe8)][_0x2c71e4(0x24c)]=_0x531b6b,console[_0x2c71e4(0x135)](_0x2c71e4(0x1d8)+_0x531b6b[_0x2c71e4(0x266)]());}if(_0x479e93){const _0x4e050f=new Date(_0x479e93),_0x336f07=new Date(Date[_0x2c71e4(0x23c)](_0x4e050f[_0x2c71e4(0x1f1)](),_0x4e050f[_0x2c71e4(0x138)](),_0x4e050f[_0x2c71e4(0xe6)](),0x17,0x3b,0x3b,0x3e7));_0x2d4c4f['createdAt'][_0x2c71e4(0x29e)]=_0x336f07,console[_0x2c71e4(0x135)]('üìÖ\x20Date\x20to\x20filter:\x20'+_0x336f07[_0x2c71e4(0x266)]());}}_0x1824e7&&(_0x2d4c4f['OR']=[{'id':{'contains':_0x1824e7,'mode':_0x2c71e4(0x254)}},{'orderId':{'contains':_0x1824e7,'mode':_0x2c71e4(0x254)}},{'gatewayOrderId':{'contains':_0x1824e7,'mode':'insensitive'}},{'customerEmail':{'contains':_0x1824e7,'mode':_0x2c71e4(0x254)}},{'shop':{'name':{'contains':_0x1824e7,'mode':_0x2c71e4(0x254)}}},{'shop':{'username':{'contains':_0x1824e7,'mode':_0x2c71e4(0x254)}}}]);console['log'](_0x2c71e4(0x1e5),JSON[_0x2c71e4(0x14d)](_0x2d4c4f,null,0x2));const _0x4fc478=await database_1[_0x2c71e4(0x10c)][_0x2c71e4(0x183)][_0x2c71e4(0x182)]({'where':_0x2d4c4f});console[_0x2c71e4(0x135)](_0x2c71e4(0x118)+_0x4fc478);let _0x2bad40={'createdAt':_0x2c71e4(0x27d)};if(_0x3b2325){const _0x3eb14b=[_0x2c71e4(0x1b6),_0x2c71e4(0xe8),_0x2c71e4(0x271),_0x2c71e4(0x207),'gateway',_0x2c71e4(0x211)],_0xaf84c4=[_0x2c71e4(0x1fe),_0x2c71e4(0x27d)];if(_0x3eb14b[_0x2c71e4(0x132)](_0x3b2325)){const _0x4e73c9=_0xaf84c4['includes'](_0x430010)?_0x430010:'desc';_0x2bad40={[_0x3b2325]:_0x4e73c9},console[_0x2c71e4(0x135)]('üìä\x20Sorting\x20payments\x20by\x20'+_0x3b2325+_0x2c71e4(0xe0)+_0x4e73c9+_0x2c71e4(0x204));}}const [_0x17239a,_0x11040e]=await Promise['all']([database_1[_0x2c71e4(0x10c)]['payment']['findMany']({'where':_0x2d4c4f,'skip':_0x374469,'take':_0xb98f9b,'orderBy':_0x2bad40,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x2c71e4(0x183)][_0x2c71e4(0x182)]({'where':_0x2d4c4f})]);let _0x2cda70,_0x49bace;if(_0x5d02e){const _0x155303=new Date(_0x5d02e);_0x2cda70=new Date(Date[_0x2c71e4(0x23c)](_0x155303['getUTCFullYear'](),_0x155303[_0x2c71e4(0x138)](),_0x155303[_0x2c71e4(0xe6)](),0x0,0x0,0x0,0x0));}else{const _0x264ca8=new Date();_0x2cda70=new Date(Date[_0x2c71e4(0x23c)](_0x264ca8['getUTCFullYear'](),_0x264ca8[_0x2c71e4(0x138)](),_0x264ca8['getUTCDate'](),0x0,0x0,0x0,0x0));}if(_0x479e93){const _0x116537=new Date(_0x479e93);_0x49bace=new Date(Date[_0x2c71e4(0x23c)](_0x116537[_0x2c71e4(0x1f1)](),_0x116537[_0x2c71e4(0x138)](),_0x116537[_0x2c71e4(0xe6)](),0x17,0x3b,0x3b,0x3e7));}else{if(_0x5d02e){const _0x3629c6=new Date(_0x5d02e);_0x49bace=new Date(Date[_0x2c71e4(0x23c)](_0x3629c6[_0x2c71e4(0x1f1)](),_0x3629c6[_0x2c71e4(0x138)](),_0x3629c6['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}else{const _0x1eaad9=new Date();_0x49bace=new Date(Date['UTC'](_0x1eaad9['getUTCFullYear'](),_0x1eaad9['getUTCMonth'](),_0x1eaad9[_0x2c71e4(0xe6)](),0x17,0x3b,0x3b,0x3e7));}}const _0x1fdf66={};{const _0x143cc6={'status':_0x3f4c6c?_0x3f4c6c['toUpperCase']():_0x2c71e4(0x256),'createdAt':{'gte':_0x2cda70,'lte':_0x49bace}};_0x1a4680?_0x143cc6[_0x2c71e4(0x27a)]=_0x2d4c4f[_0x2c71e4(0x27a)]:_0x143cc6[_0x2c71e4(0x27a)]={'not':_0x2c71e4(0x1f4)};_0x2e82c6&&(_0x143cc6['shopId']=_0x2e82c6);_0x273eff&&(_0x143cc6[_0x2c71e4(0x211)]=_0x273eff['toUpperCase']());console[_0x2c71e4(0x135)](_0x2c71e4(0x19a),JSON[_0x2c71e4(0x14d)](_0x143cc6,null,0x2));const _0x58697a=await database_1[_0x2c71e4(0x10c)][_0x2c71e4(0x183)][_0x2c71e4(0x19e)]({'where':_0x143cc6,'select':{'amountUSDT':!![],'currency':!![],'amount':!![]}});let _0x2d3591=0x0;_0x58697a['forEach'](_0x49b449=>{const _0x642600=_0x2c71e4;_0x49b449[_0x642600(0x1da)]&&(_0x2d3591+=_0x49b449[_0x642600(0x1da)]);if(_0x49b449[_0x642600(0x211)]){const _0x195610=_0x49b449['currency'][_0x642600(0x1c1)]();!_0x1fdf66[_0x195610]&&(_0x1fdf66[_0x195610]=0x0),_0x1fdf66[_0x195610]+=_0x49b449[_0x642600(0x1b6)];}}),_0x2d3591>0x0&&(_0x1fdf66[_0x2c71e4(0x26e)]=_0x2d3591);}return{'payments':_0x17239a,'pagination':{'page':_0x52c38d,'limit':_0xb98f9b,'total':_0x11040e,'totalPages':Math[_0x2c71e4(0x233)](_0x11040e/_0xb98f9b)},'statistics':_0x1fdf66};}async[a53_0x4a281e(0x267)](_0x5440da){const _0x273bfb=a53_0x4a281e,_0x1056b2=await database_1[_0x273bfb(0x10c)][_0x273bfb(0x183)]['findUnique']({'where':{'id':_0x5440da},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x1056b2)return null;return{'id':_0x1056b2['id'],'shopId':_0x1056b2[_0x273bfb(0x13e)],'gateway':_0x1056b2[_0x273bfb(0x27a)],'amount':_0x1056b2['amount'],'currency':_0x1056b2[_0x273bfb(0x211)],'status':_0x1056b2[_0x273bfb(0x207)],'orderId':_0x1056b2[_0x273bfb(0x11a)],'gatewayOrderId':_0x1056b2['gatewayOrderId'],'customerEmail':_0x1056b2[_0x273bfb(0x21f)],'customerName':_0x1056b2[_0x273bfb(0x24e)],'customerCountry':_0x1056b2['customerCountry'],'customerIp':_0x1056b2[_0x273bfb(0x16c)],'customerUa':_0x1056b2[_0x273bfb(0x1c3)],'failureMessage':_0x1056b2[_0x273bfb(0x262)],'externalPaymentUrl':_0x1056b2[_0x273bfb(0xfe)],'successUrl':_0x1056b2[_0x273bfb(0x1e9)],'failUrl':_0x1056b2[_0x273bfb(0x102)],'pendingUrl':_0x1056b2['pendingUrl'],'whiteUrl':_0x1056b2[_0x273bfb(0x127)],'createdAt':_0x1056b2[_0x273bfb(0xe8)],'updatedAt':_0x1056b2[_0x273bfb(0x271)],'shop':_0x1056b2[_0x273bfb(0x249)]};}async[a53_0x4a281e(0xea)](_0x12efb8,_0x94e2e3,_0x284444,_0x42d9b5){const _0x4ff756=a53_0x4a281e,_0xc85815=await database_1['default'][_0x4ff756(0x1e6)](async _0x271b0b=>{const _0x34fb52=_0x4ff756,_0x421472=await _0x271b0b[_0x34fb52(0x183)][_0x34fb52(0x1b9)]({'where':{'id':_0x12efb8},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x421472)throw new Error(_0x34fb52(0x1b5));const _0x5404f3=_0x421472['status'],_0x114a0e=_0x94e2e3[_0x34fb52(0x1c1)]();console['log']('üîÑ\x20Admin\x20updating\x20payment\x20'+_0x12efb8+_0x34fb52(0x284)+_0x5404f3+_0x34fb52(0x13b)+_0x114a0e),console[_0x34fb52(0x135)](_0x34fb52(0x26b)+_0x421472[_0x34fb52(0x249)][_0x34fb52(0xe2)]+'\x20USDT');const _0x4edb1d={'status':_0x114a0e,'updatedAt':new Date(),'statusChangedBy':_0x34fb52(0x224),'statusChangedAt':new Date()};_0x284444&&(_0x4edb1d[_0x34fb52(0x297)]=_0x284444);_0x114a0e===_0x34fb52(0x1a5)&&_0x42d9b5&&(_0x4edb1d[_0x34fb52(0xcd)]=_0x42d9b5);let _0x490b92=0x0,_0x1bbf1d=_0x421472[_0x34fb52(0x249)][_0x34fb52(0xe2)];if(_0x114a0e===_0x34fb52(0x256)&&_0x5404f3!==_0x34fb52(0x256)){_0x4edb1d['paidAt']=new Date();const _0x19623b=await currencyService_1[_0x34fb52(0x20c)]['convertToUSDT'](_0x421472[_0x34fb52(0x1b6)],_0x421472[_0x34fb52(0x211)]);_0x4edb1d[_0x34fb52(0x1da)]=_0x19623b;let _0x5ef642=0x2d;const _0x2b2736=await _0x271b0b['shop'][_0x34fb52(0x1b9)]({'where':{'id':_0x421472[_0x34fb52(0x13e)]},'select':{'gatewaySettings':!![]}});if(_0x2b2736?.['gatewaySettings'])try{const _0x1c3c28=JSON['parse'](_0x2b2736[_0x34fb52(0x161)]);for(const [_0x2c0b09,_0x46de90]of Object[_0x34fb52(0xf7)](_0x1c3c28)){if(_0x2c0b09[_0x34fb52(0x1ff)]()===_0x421472[_0x34fb52(0x27a)][_0x34fb52(0x1ff)]()){_0x5ef642=_0x46de90[_0x34fb52(0x29f)]||0xa;break;}}}catch(_0x1a260b){console[_0x34fb52(0x187)]('Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20'+_0x12efb8+':',_0x1a260b);}let _0xd3ec48;_0x421472[_0x34fb52(0x1de)]!==null&&_0x421472[_0x34fb52(0x1de)]!==undefined?(_0xd3ec48=_0x421472[_0x34fb52(0x1de)],console[_0x34fb52(0x135)](_0x34fb52(0x165)+_0xd3ec48[_0x34fb52(0x11c)](0x6)+_0x34fb52(0xfd)+_0x12efb8)):(_0xd3ec48=_0x19623b*(0x1-_0x5ef642/0x64),console[_0x34fb52(0x135)](_0x34fb52(0xd0)+_0x12efb8+':\x20'+_0x5ef642+_0x34fb52(0x13c)+_0x19623b[_0x34fb52(0x11c)](0x6)+'\x20USDT'),_0x4edb1d[_0x34fb52(0x1de)]=_0xd3ec48,_0x4edb1d[_0x34fb52(0x213)]=_0x5ef642),_0x490b92=_0xd3ec48,_0x1bbf1d+=_0xd3ec48,console['log'](_0x34fb52(0x237)+_0x12efb8+_0x34fb52(0x1b7)),console[_0x34fb52(0x135)](_0x34fb52(0x159)+_0x19623b[_0x34fb52(0x11c)](0x6)+'\x20USDT'),console[_0x34fb52(0x135)](_0x34fb52(0x181)+_0x421472[_0x34fb52(0x27a)]+_0x34fb52(0x186)+_0x5ef642+'%'),console[_0x34fb52(0x135)](_0x34fb52(0xd7)+_0xd3ec48[_0x34fb52(0x11c)](0x6)+_0x34fb52(0x15d)+_0x5ef642+_0x34fb52(0x130)),console[_0x34fb52(0x135)]('\x20\x20\x20Added\x20to\x20balance:\x20+'+_0xd3ec48[_0x34fb52(0x11c)](0x6)+_0x34fb52(0x1d3));}else{if(_0x5404f3===_0x34fb52(0x256)&&_0x114a0e!=='PAID'&&_0x114a0e!==_0x34fb52(0x1a5)){if(_0x421472[_0x34fb52(0x1da)]){let _0x3ee5a5=0x2d;const _0x4c6e07=await _0x271b0b['shop']['findUnique']({'where':{'id':_0x421472[_0x34fb52(0x13e)]},'select':{'gatewaySettings':!![]}});if(_0x4c6e07?.[_0x34fb52(0x161)])try{const _0x1bd7e0=JSON[_0x34fb52(0x11f)](_0x4c6e07[_0x34fb52(0x161)]);for(const [_0x3fa4d5,_0x469a24]of Object[_0x34fb52(0xf7)](_0x1bd7e0)){if(_0x3fa4d5['toLowerCase']()===_0x421472[_0x34fb52(0x27a)][_0x34fb52(0x1ff)]()){_0x3ee5a5=_0x469a24[_0x34fb52(0x29f)]||0xa;break;}}}catch(_0x472737){console[_0x34fb52(0x187)](_0x34fb52(0xd1)+_0x12efb8+':',_0x472737);}const _0x1a87ec=_0x421472[_0x34fb52(0x1da)]*(0x1-_0x3ee5a5/0x64);_0x490b92=-_0x1a87ec,_0x1bbf1d-=_0x1a87ec,console[_0x34fb52(0x135)](_0x34fb52(0x159)+_0x421472['amountUSDT'][_0x34fb52(0x11c)](0x6)+'\x20USDT'),console[_0x34fb52(0x135)](_0x34fb52(0x181)+_0x421472[_0x34fb52(0x27a)]+',\x20Commission:\x20'+_0x3ee5a5+'%'),console[_0x34fb52(0x135)](_0x34fb52(0x255)+_0x1a87ec[_0x34fb52(0x11c)](0x6)+_0x34fb52(0x15d)+_0x3ee5a5+_0x34fb52(0x130)),console[_0x34fb52(0x135)](_0x34fb52(0x15f)+_0x1a87ec[_0x34fb52(0x11c)](0x6)+_0x34fb52(0x1d3));}}}_0x114a0e===_0x34fb52(0x1a5)&&(console[_0x34fb52(0x135)](_0x34fb52(0x114)),_0x42d9b5&&_0x42d9b5>0x0?(_0x490b92=-_0x42d9b5,_0x1bbf1d-=_0x42d9b5,console['log'](_0x34fb52(0xff)+_0x42d9b5['toFixed'](0x6)+'\x20USDT\x20from\x20balance'),console['log'](_0x34fb52(0x115))):console[_0x34fb52(0x135)](_0x34fb52(0x22e)),_0x4edb1d[_0x34fb52(0xcd)]=_0x42d9b5||0x0);_0x114a0e===_0x34fb52(0x126)&&_0x5404f3===_0x34fb52(0x256)&&console[_0x34fb52(0x135)](_0x34fb52(0x117));const _0x1e64ed=await _0x271b0b[_0x34fb52(0x183)][_0x34fb52(0x191)]({'where':{'id':_0x12efb8},'data':_0x4edb1d,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x490b92!==0x0&&(await _0x271b0b['shop']['update']({'where':{'id':_0x421472['shopId']},'data':{'balance':_0x1bbf1d}}),console[_0x34fb52(0x135)](_0x34fb52(0xf5)+_0x421472[_0x34fb52(0x13e)]+_0x34fb52(0x167)+_0x421472[_0x34fb52(0x249)]['balance'][_0x34fb52(0x11c)](0x6)+'\x20->\x20'+_0x1bbf1d[_0x34fb52(0x11c)](0x6)+_0x34fb52(0x180)+(_0x490b92>0x0?'+':'')+_0x490b92['toFixed'](0x6)+')')),_0x1e64ed;});return{'id':_0xc85815['id'],'shopId':_0xc85815[_0x4ff756(0x13e)],'gateway':_0xc85815[_0x4ff756(0x27a)],'amount':_0xc85815[_0x4ff756(0x1b6)],'currency':_0xc85815[_0x4ff756(0x211)],'status':_0xc85815[_0x4ff756(0x207)],'orderId':_0xc85815[_0x4ff756(0x11a)],'gatewayOrderId':_0xc85815[_0x4ff756(0x285)],'customerEmail':_0xc85815[_0x4ff756(0x21f)],'customerName':_0xc85815[_0x4ff756(0x24e)],'customerCountry':_0xc85815[_0x4ff756(0x184)],'customerIp':_0xc85815[_0x4ff756(0x16c)],'customerUa':_0xc85815['customerUa'],'failureMessage':_0xc85815['failureMessage'],'adminNotes':_0xc85815[_0x4ff756(0x297)],'chargebackAmount':_0xc85815[_0x4ff756(0xcd)],'statusChangedBy':_0xc85815['statusChangedBy'],'statusChangedAt':_0xc85815[_0x4ff756(0x299)],'createdAt':_0xc85815[_0x4ff756(0xe8)],'updatedAt':_0xc85815[_0x4ff756(0x271)],'shop':_0xc85815[_0x4ff756(0x249)]};}async[a53_0x4a281e(0xd8)](_0x3c1026,_0x3ede2c){const _0x3fd23d=a53_0x4a281e,_0x13fdb9=Math['random']()[_0x3fd23d(0x1bd)](0x24)['substr'](0x2,0x9);console[_0x3fd23d(0x135)]('üéØ\x20updateUser\x20called\x20with\x20ID:\x20'+_0x13fdb9+_0x3fd23d(0x190)+_0x3c1026);const _0x379db1={..._0x3ede2c};_0x3ede2c['password']&&_0x3ede2c[_0x3fd23d(0x1ed)]['trim']()!==''?(console[_0x3fd23d(0x135)](_0x3fd23d(0x269)+_0x13fdb9+_0x3fd23d(0x24a)+_0x3c1026),_0x379db1[_0x3fd23d(0x1ed)]=await bcryptjs_1[_0x3fd23d(0x10c)][_0x3fd23d(0x27f)](_0x3ede2c[_0x3fd23d(0x1ed)],0xc)):(console['log'](_0x3fd23d(0x269)+_0x13fdb9+']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update'),delete _0x379db1['password']);_0x3ede2c[_0x3fd23d(0x16a)]&&(_0x379db1['name']=_0x3ede2c[_0x3fd23d(0x16a)],delete _0x379db1['fullName']);_0x3ede2c[_0x3fd23d(0xda)]&&(_0x379db1[_0x3fd23d(0x205)]=_0x3ede2c[_0x3fd23d(0xda)],delete _0x379db1['telegramId']);_0x3ede2c[_0x3fd23d(0x10a)]&&(_0x379db1['shopUrl']=_0x3ede2c[_0x3fd23d(0x10a)],delete _0x379db1[_0x3fd23d(0x10a)]);if(_0x3ede2c['gateways']){const _0xb997eb=_0x3ede2c[_0x3fd23d(0x240)][_0x3fd23d(0xfb)](_0x2abe86=>this[_0x3fd23d(0x282)](_0x2abe86));console['log'](_0x3fd23d(0x29b),_0x3ede2c[_0x3fd23d(0x240)],'->',_0xb997eb),_0x379db1[_0x3fd23d(0x241)]=JSON[_0x3fd23d(0x14d)](_0xb997eb),delete _0x379db1[_0x3fd23d(0x240)];}_0x3ede2c['gatewaySettings']&&(console[_0x3fd23d(0x135)](_0x3fd23d(0xc4)+_0x13fdb9+']\x20Gateway\x20settings\x20before\x20saving:',_0x3ede2c[_0x3fd23d(0x161)]),_0x379db1['gatewaySettings']=JSON[_0x3fd23d(0x14d)](_0x3ede2c[_0x3fd23d(0x161)]),console[_0x3fd23d(0x135)](_0x3fd23d(0xc4)+_0x13fdb9+_0x3fd23d(0x100),_0x379db1[_0x3fd23d(0x161)]));_0x3ede2c[_0x3fd23d(0x1f9)]&&(_0x3ede2c['wallets'][_0x3fd23d(0x230)]!==undefined&&(_0x379db1[_0x3fd23d(0x230)]=_0x3ede2c[_0x3fd23d(0x1f9)][_0x3fd23d(0x230)]||null),_0x3ede2c[_0x3fd23d(0x1f9)][_0x3fd23d(0x111)]!==undefined&&(_0x379db1[_0x3fd23d(0x111)]=_0x3ede2c[_0x3fd23d(0x1f9)][_0x3fd23d(0x111)]||null),_0x3ede2c[_0x3fd23d(0x1f9)][_0x3fd23d(0x210)]!==undefined&&(_0x379db1[_0x3fd23d(0x210)]=_0x3ede2c[_0x3fd23d(0x1f9)][_0x3fd23d(0x210)]||null),_0x3ede2c['wallets']['usdcPolygonWallet']!==undefined&&(_0x379db1[_0x3fd23d(0xee)]=_0x3ede2c[_0x3fd23d(0x1f9)][_0x3fd23d(0xee)]||null),delete _0x379db1[_0x3fd23d(0x1f9)]);const _0x4f5f0f=await database_1[_0x3fd23d(0x10c)]['shop'][_0x3fd23d(0x191)]({'where':{'id':_0x3c1026},'data':_0x379db1,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console['log'](_0x3fd23d(0x287)+_0x13fdb9+_0x3fd23d(0x19b),_0x4f5f0f[_0x3fd23d(0x161)]),{'id':_0x4f5f0f['id'],'fullName':_0x4f5f0f[_0x3fd23d(0x1d6)],'username':_0x4f5f0f[_0x3fd23d(0x243)],'telegramId':_0x4f5f0f[_0x3fd23d(0x205)],'merchantUrl':_0x4f5f0f[_0x3fd23d(0x174)],'gateways':_0x4f5f0f[_0x3fd23d(0x241)]?JSON[_0x3fd23d(0x11f)](_0x4f5f0f[_0x3fd23d(0x241)]):null,'gatewaySettings':_0x4f5f0f['gatewaySettings']?JSON[_0x3fd23d(0x11f)](_0x4f5f0f[_0x3fd23d(0x161)]):null,'publicKey':_0x4f5f0f[_0x3fd23d(0xe9)],'wallets':{'usdtPolygonWallet':_0x4f5f0f[_0x3fd23d(0x230)],'usdtTrcWallet':_0x4f5f0f['usdtTrcWallet'],'usdtErcWallet':_0x4f5f0f[_0x3fd23d(0x210)],'usdcPolygonWallet':_0x4f5f0f[_0x3fd23d(0xee)]},'status':_0x4f5f0f[_0x3fd23d(0x207)],'createdAt':_0x4f5f0f[_0x3fd23d(0xe8)]};}async[a53_0x4a281e(0x1ef)](_0x49a001){const _0x34232a=a53_0x4a281e,_0x959fa3=await database_1['default']['shop'][_0x34232a(0x191)]({'where':{'id':_0x49a001},'data':{'status':_0x34232a(0x1ad)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x959fa3['id'],'fullName':_0x959fa3[_0x34232a(0x1d6)],'username':_0x959fa3[_0x34232a(0x243)],'telegramId':_0x959fa3['telegram'],'merchantUrl':_0x959fa3[_0x34232a(0x174)],'gateways':_0x959fa3[_0x34232a(0x241)]?JSON[_0x34232a(0x11f)](_0x959fa3['paymentGateways']):null,'gatewaySettings':_0x959fa3[_0x34232a(0x161)]?JSON[_0x34232a(0x11f)](_0x959fa3[_0x34232a(0x161)]):null,'publicKey':_0x959fa3[_0x34232a(0xe9)],'wallets':{'usdtPolygonWallet':_0x959fa3['usdtPolygonWallet'],'usdtTrcWallet':_0x959fa3[_0x34232a(0x111)],'usdtErcWallet':_0x959fa3[_0x34232a(0x210)],'usdcPolygonWallet':_0x959fa3[_0x34232a(0xee)]},'status':_0x959fa3['status'],'createdAt':_0x959fa3[_0x34232a(0xe8)]};}async[a53_0x4a281e(0xeb)](_0x28378a){const _0x58d6e4=a53_0x4a281e,_0x3ab302=await database_1[_0x58d6e4(0x10c)][_0x58d6e4(0x249)][_0x58d6e4(0x191)]({'where':{'id':_0x28378a},'data':{'status':_0x58d6e4(0x28e)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x3ab302['id'],'fullName':_0x3ab302[_0x58d6e4(0x1d6)],'username':_0x3ab302[_0x58d6e4(0x243)],'telegramId':_0x3ab302[_0x58d6e4(0x205)],'merchantUrl':_0x3ab302[_0x58d6e4(0x174)],'gateways':_0x3ab302[_0x58d6e4(0x241)]?JSON[_0x58d6e4(0x11f)](_0x3ab302[_0x58d6e4(0x241)]):null,'gatewaySettings':_0x3ab302[_0x58d6e4(0x161)]?JSON[_0x58d6e4(0x11f)](_0x3ab302[_0x58d6e4(0x161)]):null,'publicKey':_0x3ab302[_0x58d6e4(0xe9)],'wallets':{'usdtPolygonWallet':_0x3ab302[_0x58d6e4(0x230)],'usdtTrcWallet':_0x3ab302[_0x58d6e4(0x111)],'usdtErcWallet':_0x3ab302[_0x58d6e4(0x210)],'usdcPolygonWallet':_0x3ab302[_0x58d6e4(0xee)]},'status':_0x3ab302[_0x58d6e4(0x207)],'createdAt':_0x3ab302['createdAt']};}async[a53_0x4a281e(0x212)](_0x4a607c){const _0xa30d8f=a53_0x4a281e,{page:_0x186db7,limit:_0x330488,status:_0x57534a,search:_0x2a6648}=_0x4a607c,_0x35cf78=(_0x186db7-0x1)*_0x330488,_0x5007ae={};_0x57534a&&(_0x5007ae[_0xa30d8f(0x207)]=_0x57534a[_0xa30d8f(0x1c1)]());_0x2a6648&&(_0x5007ae['OR']=[{'name':{'contains':_0x2a6648,'mode':_0xa30d8f(0x254)}},{'username':{'contains':_0x2a6648,'mode':_0xa30d8f(0x254)}},{'telegram':{'contains':_0x2a6648,'mode':'insensitive'}},{'shopUrl':{'contains':_0x2a6648,'mode':_0xa30d8f(0x254)}}]);const [_0xa8cda3,_0x11e9bc]=await Promise[_0xa30d8f(0x166)]([database_1[_0xa30d8f(0x10c)][_0xa30d8f(0x249)][_0xa30d8f(0x19e)]({'where':_0x5007ae,'skip':_0x35cf78,'take':_0x330488,'orderBy':{'createdAt':_0xa30d8f(0x27d)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'twoFactorEnabled':!![],'createdAt':!![],'lastLoginAt':!![],'_count':{'select':{'telegramUsers':!![]}}}}),database_1[_0xa30d8f(0x10c)]['shop'][_0xa30d8f(0x182)]({'where':_0x5007ae})]);return{'users':_0xa8cda3[_0xa30d8f(0xfb)](_0x380dc6=>{const _0x3ee12d=_0xa30d8f,_0x368077=_0x380dc6['paymentGateways']?JSON[_0x3ee12d(0x11f)](_0x380dc6[_0x3ee12d(0x241)]):null,_0xe6cc52=_0x368077?_0x368077[_0x3ee12d(0xfb)](_0x5a50a6=>this[_0x3ee12d(0x250)](_0x5a50a6)):null;return{'id':_0x380dc6['id'],'fullName':_0x380dc6['name'],'username':_0x380dc6[_0x3ee12d(0x243)],'telegramId':_0x380dc6['telegram'],'merchantUrl':_0x380dc6['shopUrl'],'gateways':_0xe6cc52,'gatewaySettings':_0x380dc6[_0x3ee12d(0x161)]?JSON['parse'](_0x380dc6[_0x3ee12d(0x161)]):null,'publicKey':_0x380dc6['publicKey'],'wallets':{'usdtPolygonWallet':_0x380dc6[_0x3ee12d(0x230)],'usdtTrcWallet':_0x380dc6['usdtTrcWallet'],'usdtErcWallet':_0x380dc6['usdtErcWallet'],'usdcPolygonWallet':_0x380dc6[_0x3ee12d(0xee)],'usdcErcWallet':_0x380dc6['usdcErcWallet']},'status':_0x380dc6[_0x3ee12d(0x207)],'twoFactorEnabled':_0x380dc6[_0x3ee12d(0x1d5)]||![],'telegramUsersCount':_0x380dc6[_0x3ee12d(0x275)][_0x3ee12d(0x168)],'createdAt':_0x380dc6[_0x3ee12d(0xe8)],'lastLoginAt':_0x380dc6[_0x3ee12d(0x128)]};}),'pagination':{'page':_0x186db7,'limit':_0x330488,'total':_0x11e9bc,'totalPages':Math['ceil'](_0x11e9bc/_0x330488)}};}async[a53_0x4a281e(0x196)](_0x481fd9){const _0x21d768=a53_0x4a281e,_0x47f202=await database_1[_0x21d768(0x10c)][_0x21d768(0x249)]['findUnique']({'where':{'id':_0x481fd9},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x47f202)return null;const _0x39547e=_0x47f202['paymentGateways']?JSON[_0x21d768(0x11f)](_0x47f202[_0x21d768(0x241)]):null,_0x519dd0=_0x39547e?_0x39547e[_0x21d768(0xfb)](_0x3e15ec=>this[_0x21d768(0x250)](_0x3e15ec)):null;return _0x39547e&&_0x519dd0&&console['log'](_0x21d768(0x200),_0x39547e,'->',_0x519dd0),{'id':_0x47f202['id'],'fullName':_0x47f202['name'],'username':_0x47f202['username'],'telegramId':_0x47f202[_0x21d768(0x205)],'merchantUrl':_0x47f202[_0x21d768(0x174)],'gateways':_0x519dd0,'gatewaySettings':_0x47f202[_0x21d768(0x161)]?JSON['parse'](_0x47f202['gatewaySettings']):null,'publicKey':_0x47f202[_0x21d768(0xe9)],'wallets':{'usdtPolygonWallet':_0x47f202[_0x21d768(0x230)],'usdtTrcWallet':_0x47f202['usdtTrcWallet'],'usdtErcWallet':_0x47f202[_0x21d768(0x210)],'usdcPolygonWallet':_0x47f202['usdcPolygonWallet'],'usdcErcWallet':_0x47f202[_0x21d768(0x29a)]},'status':_0x47f202[_0x21d768(0x207)],'createdAt':_0x47f202[_0x21d768(0xe8)]};}async['createUser'](_0xebbe6d){const _0x266c08=a53_0x4a281e,{fullName:_0xe5e956,username:_0x51be58,password:_0x9a1d98,telegramId:_0x3c338c,merchantUrl:_0x7062f8,gateways:_0x549fa4,gatewaySettings:_0x2a1802,wallets:_0x5cd3cd}=_0xebbe6d,_0x2579d6=await database_1[_0x266c08(0x10c)][_0x266c08(0x249)][_0x266c08(0x1b9)]({'where':{'username':_0x51be58}});if(_0x2579d6)throw new Error(_0x266c08(0x226));if(_0x3c338c){const _0x5331b7=await database_1[_0x266c08(0x10c)]['shop'][_0x266c08(0x1b9)]({'where':{'telegram':_0x3c338c}});if(_0x5331b7)throw new Error(_0x266c08(0x1ac));}const _0x5b901c=await bcryptjs_1[_0x266c08(0x10c)][_0x266c08(0x27f)](_0x9a1d98,0xc),_0x1ce1ff=_0x266c08(0x276)+crypto_1[_0x266c08(0x10c)]['randomBytes'](0x20)[_0x266c08(0x1bd)](_0x266c08(0x17a)),_0x4d0b1f=_0x266c08(0x156)+crypto_1[_0x266c08(0x10c)][_0x266c08(0x1b8)](0x20)[_0x266c08(0x1bd)](_0x266c08(0x17a)),_0x39adb8=_0x549fa4?_0x549fa4['map'](_0x4a1519=>this['getGatewayInternalName'](_0x4a1519)):null;_0x549fa4&&_0x39adb8&&console[_0x266c08(0x135)](_0x266c08(0x26f),_0x549fa4,'->',_0x39adb8);const _0xc1a821=await database_1[_0x266c08(0x10c)][_0x266c08(0x249)][_0x266c08(0xef)]({'data':{'name':_0xe5e956,'username':_0x51be58,'password':_0x5b901c,'telegram':_0x3c338c,'shopUrl':_0x7062f8,'paymentGateways':_0x39adb8?JSON['stringify'](_0x39adb8):null,'gatewaySettings':_0x2a1802?JSON[_0x266c08(0x14d)](_0x2a1802):null,'usdtPolygonWallet':_0x5cd3cd?.[_0x266c08(0x230)]||null,'usdtTrcWallet':_0x5cd3cd?.[_0x266c08(0x111)]||null,'usdtErcWallet':_0x5cd3cd?.[_0x266c08(0x210)]||null,'usdcPolygonWallet':_0x5cd3cd?.[_0x266c08(0xee)]||null,'publicKey':_0x1ce1ff,'secretKey':_0x4d0b1f,'status':_0x266c08(0x28e)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0xc1a821['id'],'fullName':_0xc1a821['name'],'username':_0xc1a821['username'],'telegramId':_0xc1a821[_0x266c08(0x205)],'merchantUrl':_0xc1a821[_0x266c08(0x174)],'gateways':_0xc1a821['paymentGateways']?JSON['parse'](_0xc1a821[_0x266c08(0x241)]):null,'gatewaySettings':_0xc1a821[_0x266c08(0x161)]?JSON['parse'](_0xc1a821[_0x266c08(0x161)]):null,'publicKey':_0xc1a821[_0x266c08(0xe9)],'wallets':{'usdtPolygonWallet':_0xc1a821['usdtPolygonWallet'],'usdtTrcWallet':_0xc1a821[_0x266c08(0x111)],'usdtErcWallet':_0xc1a821[_0x266c08(0x210)],'usdcPolygonWallet':_0xc1a821['usdcPolygonWallet']},'status':_0xc1a821[_0x266c08(0x207)],'createdAt':_0xc1a821[_0x266c08(0xe8)]};}async[a53_0x4a281e(0x20b)](_0x5b2177,_0x11aaa9){const _0x5786ac=a53_0x4a281e;if(config_1[_0x5786ac(0x209)][_0x5786ac(0x224)][_0x5786ac(0x1d5)]){if(!_0x11aaa9)throw new Error(_0x5786ac(0x27c));const _0xe7828f=speakeasy_1[_0x5786ac(0x10c)][_0x5786ac(0x1f7)][_0x5786ac(0x290)]({'secret':config_1['config'][_0x5786ac(0x224)][_0x5786ac(0x245)],'encoding':'base32','token':_0x11aaa9,'window':0x2});if(!_0xe7828f){let _0xf3f893=![];if(config_1['config'][_0x5786ac(0x224)][_0x5786ac(0x15b)]){const _0x263ccc=JSON[_0x5786ac(0x11f)](config_1[_0x5786ac(0x209)][_0x5786ac(0x224)][_0x5786ac(0x15b)]);for(let _0x1a97bd=0x0;_0x1a97bd<_0x263ccc[_0x5786ac(0x149)];_0x1a97bd++){const _0x6711d8=await bcryptjs_1[_0x5786ac(0x10c)][_0x5786ac(0x10b)](_0x11aaa9,_0x263ccc[_0x1a97bd]);if(_0x6711d8){_0xf3f893=!![],_0x263ccc[_0x5786ac(0x20d)](_0x1a97bd,0x1),config_1[_0x5786ac(0x209)][_0x5786ac(0x224)][_0x5786ac(0x15b)]=JSON['stringify'](_0x263ccc);const _0x4eb75e=path_1[_0x5786ac(0x10c)][_0x5786ac(0x1f6)](process[_0x5786ac(0xce)](),_0x5786ac(0x1c4));if(fs_1['default'][_0x5786ac(0x14e)](_0x4eb75e)){let _0x26e4c5=fs_1[_0x5786ac(0x10c)][_0x5786ac(0xc6)](_0x4eb75e,_0x5786ac(0x286));const _0x4ed403=_0x26e4c5['split']('\x0a');for(let _0x5ad727=0x0;_0x5ad727<_0x4ed403[_0x5786ac(0x149)];_0x5ad727++){if(_0x4ed403[_0x5ad727][_0x5786ac(0x155)](_0x5786ac(0x194))){_0x4ed403[_0x5ad727]=_0x5786ac(0x194)+JSON['stringify'](_0x263ccc);break;}}fs_1[_0x5786ac(0x10c)][_0x5786ac(0x26c)](_0x4eb75e,_0x4ed403['join']('\x0a'),_0x5786ac(0x286));}break;}}}if(!_0xf3f893)throw new Error(_0x5786ac(0x214));}}await database_1[_0x5786ac(0x10c)][_0x5786ac(0x249)][_0x5786ac(0x1d0)]({'where':{'id':_0x5b2177}});}async[a53_0x4a281e(0x163)](_0x5dd0b2){const _0x3fea38=a53_0x4a281e,_0x1d7c51=await database_1[_0x3fea38(0x10c)][_0x3fea38(0x249)][_0x3fea38(0x1b9)]({'where':{'id':_0x5dd0b2},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});if(!_0x1d7c51)throw new Error(_0x3fea38(0x103));return{'usdtPolygonWallet':_0x1d7c51[_0x3fea38(0x230)],'usdtTrcWallet':_0x1d7c51[_0x3fea38(0x111)],'usdtErcWallet':_0x1d7c51[_0x3fea38(0x210)],'usdcPolygonWallet':_0x1d7c51[_0x3fea38(0xee)],'usdcErcWallet':_0x1d7c51[_0x3fea38(0x29a)]};}[a53_0x4a281e(0x279)](_0x49af2c=0x8){const _0x795f65=a53_0x4a281e,_0x14ad07=[];for(let _0x19f042=0x0;_0x19f042<_0x49af2c;_0x19f042++){const _0x53f14=crypto_1[_0x795f65(0x10c)][_0x795f65(0x1b8)](0x4)[_0x795f65(0x1bd)]('hex')[_0x795f65(0x1c1)]();_0x14ad07['push'](_0x53f14);}return _0x14ad07;}async[a53_0x4a281e(0x21d)](_0x3ee4d0){const _0x5f4d17=a53_0x4a281e,_0x251a69=await database_1[_0x5f4d17(0x10c)][_0x5f4d17(0x249)][_0x5f4d17(0x1b9)]({'where':{'id':_0x3ee4d0},'select':{'id':!![],'name':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x251a69)throw new Error('Shop\x20not\x20found');const _0x16460a=speakeasy_1[_0x5f4d17(0x10c)][_0x5f4d17(0xf6)]({'name':_0x5f4d17(0xe4)+_0x251a69['username']+')','issuer':_0x5f4d17(0x153),'length':0x20}),_0x7eb90b=await qrcode_1[_0x5f4d17(0x10c)]['toDataURL'](_0x16460a[_0x5f4d17(0x131)]),_0x431dfb=this['generateBackupCodes'](0x8),_0x1a9e9b=await Promise[_0x5f4d17(0x166)](_0x431dfb[_0x5f4d17(0xfb)](_0x346e61=>bcryptjs_1[_0x5f4d17(0x10c)][_0x5f4d17(0x27f)](_0x346e61,0xa)));return await database_1[_0x5f4d17(0x10c)][_0x5f4d17(0x249)][_0x5f4d17(0x191)]({'where':{'id':_0x3ee4d0},'data':{'twoFactorSecret':_0x16460a['base32'],'backupCodes':JSON['stringify'](_0x1a9e9b)}}),console[_0x5f4d17(0x135)](_0x5f4d17(0x197)+_0x251a69[_0x5f4d17(0x243)]),console[_0x5f4d17(0x135)](_0x5f4d17(0x263)+_0x431dfb[_0x5f4d17(0x149)]+_0x5f4d17(0x247)),{'secret':_0x16460a[_0x5f4d17(0x1f2)],'qrCode':_0x7eb90b,'manualEntryKey':_0x16460a[_0x5f4d17(0x1f2)],'backupCodes':_0x431dfb};}async[a53_0x4a281e(0x164)](_0x2dc420,_0x55611b){const _0x1ae713=a53_0x4a281e,_0x5cb31c=await database_1['default'][_0x1ae713(0x249)][_0x1ae713(0x1b9)]({'where':{'id':_0x2dc420},'select':{'id':!![],'username':!![],'twoFactorSecret':!![],'twoFactorEnabled':!![]}});if(!_0x5cb31c)throw new Error(_0x1ae713(0x103));if(!_0x5cb31c[_0x1ae713(0x245)])throw new Error(_0x1ae713(0xdb));if(_0x5cb31c['twoFactorEnabled'])throw new Error('2FA\x20is\x20already\x20enabled');const _0x4a695a=speakeasy_1[_0x1ae713(0x10c)][_0x1ae713(0x1f7)]['verify']({'secret':_0x5cb31c[_0x1ae713(0x245)],'encoding':_0x1ae713(0x1f2),'token':_0x55611b,'window':0x2});if(!_0x4a695a)throw new Error(_0x1ae713(0x219));return await database_1[_0x1ae713(0x10c)][_0x1ae713(0x249)][_0x1ae713(0x191)]({'where':{'id':_0x2dc420},'data':{'twoFactorEnabled':!![]}}),console['log'](_0x1ae713(0x22b)+_0x5cb31c[_0x1ae713(0x243)]),{'enabled':!![]};}async[a53_0x4a281e(0x12e)](_0x3640a1){const _0x26c610=a53_0x4a281e,_0x1d084c=await database_1[_0x26c610(0x10c)][_0x26c610(0x249)][_0x26c610(0x1b9)]({'where':{'id':_0x3640a1},'select':{'id':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x1d084c)throw new Error(_0x26c610(0x103));await database_1[_0x26c610(0x10c)][_0x26c610(0x249)][_0x26c610(0x191)]({'where':{'id':_0x3640a1},'data':{'twoFactorEnabled':![],'twoFactorSecret':null,'backupCodes':null}}),console['log']('üîê\x202FA\x20disabled\x20for\x20shop:\x20'+_0x1d084c[_0x26c610(0x243)]);}async[a53_0x4a281e(0x1c6)](_0x86748d,_0x493683,_0x7c7c9e,_0x3e1a6e){const _0x1b6651=a53_0x4a281e;if(_0x493683!==_0x7c7c9e)throw new Error(_0x1b6651(0x225));if(_0x493683[_0x1b6651(0x149)]<0x6)throw new Error(_0x1b6651(0x1d2));const _0x5d32cf=await bcryptjs_1[_0x1b6651(0x10c)][_0x1b6651(0x10b)](_0x86748d,config_1[_0x1b6651(0x209)][_0x1b6651(0x224)][_0x1b6651(0x23d)]);if(!_0x5d32cf)throw new Error(_0x1b6651(0x195));if(config_1['config'][_0x1b6651(0x224)][_0x1b6651(0x1d5)]){if(!_0x3e1a6e)throw new Error(_0x1b6651(0x27c));const _0xfe363e=speakeasy_1[_0x1b6651(0x10c)]['totp'][_0x1b6651(0x290)]({'secret':config_1[_0x1b6651(0x209)][_0x1b6651(0x224)][_0x1b6651(0x245)],'encoding':'base32','token':_0x3e1a6e,'window':0x2});if(!_0xfe363e){let _0x205891=![];if(config_1[_0x1b6651(0x209)][_0x1b6651(0x224)][_0x1b6651(0x15b)]){const _0x2cd691=JSON['parse'](config_1[_0x1b6651(0x209)][_0x1b6651(0x224)][_0x1b6651(0x15b)]);for(let _0xef9157=0x0;_0xef9157<_0x2cd691['length'];_0xef9157++){const _0x342d8c=await bcryptjs_1[_0x1b6651(0x10c)][_0x1b6651(0x10b)](_0x3e1a6e,_0x2cd691[_0xef9157]);if(_0x342d8c){_0x205891=!![],_0x2cd691[_0x1b6651(0x20d)](_0xef9157,0x1),config_1['config'][_0x1b6651(0x224)][_0x1b6651(0x15b)]=JSON[_0x1b6651(0x14d)](_0x2cd691);const _0x28065d=path_1[_0x1b6651(0x10c)][_0x1b6651(0x1f6)](process[_0x1b6651(0xce)](),'.env');if(fs_1[_0x1b6651(0x10c)][_0x1b6651(0x14e)](_0x28065d)){let _0x48bbcd=fs_1[_0x1b6651(0x10c)]['readFileSync'](_0x28065d,_0x1b6651(0x286));const _0x314455=_0x48bbcd[_0x1b6651(0x15c)]('\x0a');for(let _0xe4bd23=0x0;_0xe4bd23<_0x314455[_0x1b6651(0x149)];_0xe4bd23++){if(_0x314455[_0xe4bd23]['startsWith'](_0x1b6651(0x194))){_0x314455[_0xe4bd23]='ADMIN_BACKUP_CODES='+JSON[_0x1b6651(0x14d)](_0x2cd691);break;}}fs_1[_0x1b6651(0x10c)][_0x1b6651(0x26c)](_0x28065d,_0x314455[_0x1b6651(0x1f6)]('\x0a'),_0x1b6651(0x286));}break;}}}if(!_0x205891)throw new Error(_0x1b6651(0x214));}}const _0x5db09b=await bcryptjs_1[_0x1b6651(0x10c)][_0x1b6651(0x27f)](_0x493683,0xc);config_1['config'][_0x1b6651(0x224)][_0x1b6651(0x23d)]=_0x5db09b;const _0x47782b=path_1[_0x1b6651(0x10c)]['join'](process[_0x1b6651(0xce)](),_0x1b6651(0x1c4));let _0x39bf02='';if(fs_1[_0x1b6651(0x10c)][_0x1b6651(0x14e)](_0x47782b)){_0x39bf02=fs_1[_0x1b6651(0x10c)][_0x1b6651(0xc6)](_0x47782b,_0x1b6651(0x286));const _0x45c851=_0x39bf02[_0x1b6651(0x15c)]('\x0a');let _0x3f1fd3=![];for(let _0x2ecd8c=0x0;_0x2ecd8c<_0x45c851[_0x1b6651(0x149)];_0x2ecd8c++){if(_0x45c851[_0x2ecd8c][_0x1b6651(0x155)]('ADMIN_PASSWORD_HASH=')){_0x45c851[_0x2ecd8c]='ADMIN_PASSWORD_HASH='+_0x5db09b,_0x3f1fd3=!![];break;}}!_0x3f1fd3&&_0x45c851[_0x1b6651(0x14a)](_0x1b6651(0x1e1)+_0x5db09b),_0x39bf02=_0x45c851[_0x1b6651(0x1f6)]('\x0a'),fs_1[_0x1b6651(0x10c)]['writeFileSync'](_0x47782b,_0x39bf02,_0x1b6651(0x286));}console[_0x1b6651(0x135)]('üîê\x20Admin\x20password\x20changed\x20successfully');}async[a53_0x4a281e(0x296)](){const _0x4b67b9=a53_0x4a281e;let _0x375855=0x0;if(config_1[_0x4b67b9(0x209)][_0x4b67b9(0x224)][_0x4b67b9(0x15b)])try{const _0xffa5cd=JSON[_0x4b67b9(0x11f)](config_1[_0x4b67b9(0x209)][_0x4b67b9(0x224)][_0x4b67b9(0x15b)]);_0x375855=_0xffa5cd[_0x4b67b9(0x149)];}catch(_0x308f72){console['error'](_0x4b67b9(0x1ba),_0x308f72);}return{'twoFactorEnabled':config_1['config'][_0x4b67b9(0x224)][_0x4b67b9(0x1d5)],'backupCodesCount':_0x375855};}async[a53_0x4a281e(0x185)](){const _0x22ecd2=a53_0x4a281e,_0xf9533=speakeasy_1[_0x22ecd2(0x10c)][_0x22ecd2(0xf6)]({'name':_0x22ecd2(0x26d)+config_1['config'][_0x22ecd2(0x224)][_0x22ecd2(0x243)]+')','issuer':_0x22ecd2(0x298),'length':0x20}),_0x17809a=await qrcode_1[_0x22ecd2(0x10c)]['toDataURL'](_0xf9533['otpauth_url']),_0x5642d8=[];for(let _0x56b18f=0x0;_0x56b18f<0x8;_0x56b18f++){const _0x34a7c7=crypto_1[_0x22ecd2(0x10c)]['randomBytes'](0x4)[_0x22ecd2(0x1bd)](_0x22ecd2(0x17a))['toUpperCase']();_0x5642d8[_0x22ecd2(0x14a)](_0x34a7c7);}const _0x3966b4=await Promise[_0x22ecd2(0x166)](_0x5642d8[_0x22ecd2(0xfb)](_0xce9331=>bcryptjs_1[_0x22ecd2(0x10c)][_0x22ecd2(0x27f)](_0xce9331,0xa)));config_1[_0x22ecd2(0x209)][_0x22ecd2(0x224)][_0x22ecd2(0x245)]=_0xf9533[_0x22ecd2(0x1f2)],config_1[_0x22ecd2(0x209)]['admin'][_0x22ecd2(0x15b)]=JSON[_0x22ecd2(0x14d)](_0x3966b4);const _0x5bc369=path_1[_0x22ecd2(0x10c)][_0x22ecd2(0x1f6)](process[_0x22ecd2(0xce)](),'.env');if(fs_1[_0x22ecd2(0x10c)][_0x22ecd2(0x14e)](_0x5bc369)){let _0x13f18a=fs_1['default'][_0x22ecd2(0xc6)](_0x5bc369,'utf8');const _0x49f2a4=_0x13f18a[_0x22ecd2(0x15c)]('\x0a');let _0x5b7df8=![],_0xf87e5b=![];for(let _0x30e87a=0x0;_0x30e87a<_0x49f2a4[_0x22ecd2(0x149)];_0x30e87a++){_0x49f2a4[_0x30e87a][_0x22ecd2(0x155)]('ADMIN_2FA_SECRET=')&&(_0x49f2a4[_0x30e87a]='ADMIN_2FA_SECRET='+_0xf9533[_0x22ecd2(0x1f2)],_0x5b7df8=!![]),_0x49f2a4[_0x30e87a]['startsWith'](_0x22ecd2(0x194))&&(_0x49f2a4[_0x30e87a]=_0x22ecd2(0x194)+JSON[_0x22ecd2(0x14d)](_0x3966b4),_0xf87e5b=!![]);}if(!_0x5b7df8)_0x49f2a4[_0x22ecd2(0x14a)](_0x22ecd2(0x274)+_0xf9533[_0x22ecd2(0x1f2)]);if(!_0xf87e5b)_0x49f2a4[_0x22ecd2(0x14a)](_0x22ecd2(0x194)+JSON[_0x22ecd2(0x14d)](_0x3966b4));fs_1[_0x22ecd2(0x10c)]['writeFileSync'](_0x5bc369,_0x49f2a4[_0x22ecd2(0x1f6)]('\x0a'),_0x22ecd2(0x286));}return console[_0x22ecd2(0x135)](_0x22ecd2(0xc5)),console['log'](_0x22ecd2(0x263)+_0x5642d8[_0x22ecd2(0x149)]+_0x22ecd2(0x247)),{'secret':_0xf9533[_0x22ecd2(0x1f2)],'qrCode':_0x17809a,'manualEntryKey':_0xf9533['base32'],'backupCodes':_0x5642d8};}async[a53_0x4a281e(0x1ca)](_0x28efc9){const _0x30915e=a53_0x4a281e;if(!config_1[_0x30915e(0x209)][_0x30915e(0x224)][_0x30915e(0x245)])throw new Error(_0x30915e(0xdb));if(config_1[_0x30915e(0x209)][_0x30915e(0x224)][_0x30915e(0x1d5)])throw new Error(_0x30915e(0x20f));const _0x516c85=speakeasy_1[_0x30915e(0x10c)][_0x30915e(0x1f7)][_0x30915e(0x290)]({'secret':config_1['config']['admin']['twoFactorSecret'],'encoding':'base32','token':_0x28efc9,'window':0x2});if(!_0x516c85)throw new Error(_0x30915e(0x219));config_1['config'][_0x30915e(0x224)]['twoFactorEnabled']=!![];const _0x109f28=path_1['default'][_0x30915e(0x1f6)](process[_0x30915e(0xce)](),_0x30915e(0x1c4));if(fs_1[_0x30915e(0x10c)][_0x30915e(0x14e)](_0x109f28)){let _0x5a6d90=fs_1[_0x30915e(0x10c)][_0x30915e(0xc6)](_0x109f28,_0x30915e(0x286));const _0x5bdd2=_0x5a6d90['split']('\x0a');let _0xe7b63e=![];for(let _0x5f586f=0x0;_0x5f586f<_0x5bdd2[_0x30915e(0x149)];_0x5f586f++){if(_0x5bdd2[_0x5f586f][_0x30915e(0x155)](_0x30915e(0x1a9))){_0x5bdd2[_0x5f586f]='ADMIN_2FA_ENABLED=true',_0xe7b63e=!![];break;}}if(!_0xe7b63e)_0x5bdd2['push'](_0x30915e(0x10f));fs_1[_0x30915e(0x10c)][_0x30915e(0x26c)](_0x109f28,_0x5bdd2['join']('\x0a'),'utf8');}return console[_0x30915e(0x135)](_0x30915e(0x1c0)),{'enabled':!![]};}async[a53_0x4a281e(0x1dd)](){const _0x37b1a5=a53_0x4a281e;config_1[_0x37b1a5(0x209)][_0x37b1a5(0x224)][_0x37b1a5(0x1d5)]=![],config_1['config'][_0x37b1a5(0x224)]['twoFactorSecret']='',config_1['config'][_0x37b1a5(0x224)][_0x37b1a5(0x15b)]='';const _0x1f0a94=path_1['default']['join'](process['cwd'](),_0x37b1a5(0x1c4));if(fs_1[_0x37b1a5(0x10c)][_0x37b1a5(0x14e)](_0x1f0a94)){let _0x42f28e=fs_1[_0x37b1a5(0x10c)][_0x37b1a5(0xc6)](_0x1f0a94,_0x37b1a5(0x286));const _0xb84963=_0x42f28e[_0x37b1a5(0x15c)]('\x0a');for(let _0x4d9aaf=0x0;_0x4d9aaf<_0xb84963[_0x37b1a5(0x149)];_0x4d9aaf++){_0xb84963[_0x4d9aaf]['startsWith'](_0x37b1a5(0x1a9))&&(_0xb84963[_0x4d9aaf]=_0x37b1a5(0x1eb)),_0xb84963[_0x4d9aaf][_0x37b1a5(0x155)](_0x37b1a5(0x274))&&(_0xb84963[_0x4d9aaf]=_0x37b1a5(0x274)),_0xb84963[_0x4d9aaf][_0x37b1a5(0x155)]('ADMIN_BACKUP_CODES=')&&(_0xb84963[_0x4d9aaf]=_0x37b1a5(0x194));}fs_1[_0x37b1a5(0x10c)]['writeFileSync'](_0x1f0a94,_0xb84963['join']('\x0a'),_0x37b1a5(0x286));}console[_0x37b1a5(0x135)](_0x37b1a5(0xf8));}[a53_0x4a281e(0x23a)](_0x2e7d48,_0x2c450b,_0x1d3753){const _0x1d55f9=a53_0x4a281e,_0x53f3d4=new Map(),_0x2cd669=new Date(_0x2c450b);while(_0x2cd669<=_0x1d3753){const _0x1a4596=_0x2cd669[_0x1d55f9(0x266)]()[_0x1d55f9(0x15c)]('T')[0x0];_0x53f3d4['set'](_0x1a4596,{'revenue':0x0,'count':0x0}),_0x2cd669['setDate'](_0x2cd669['getDate']()+0x1);}for(const _0x6a6921 of _0x2e7d48){const _0x296872=_0x6a6921[_0x1d55f9(0xe8)][_0x1d55f9(0x266)]()[_0x1d55f9(0x15c)]('T')[0x0],_0x28602e=_0x53f3d4[_0x1d55f9(0x17f)](_0x296872);_0x28602e&&(_0x28602e['count']+=0x1,_0x6a6921[_0x1d55f9(0x207)]==='PAID'&&(_0x6a6921['amountUSDT']?_0x28602e[_0x1d55f9(0x29c)]+=_0x6a6921[_0x1d55f9(0x1da)]:console[_0x1d55f9(0x135)](_0x1d55f9(0x133)+_0x6a6921['id']+_0x1d55f9(0x242))));}const _0xde095f=[],_0xb953ee=[];for(const [_0x4cd9f2,_0x275c97]of _0x53f3d4){_0xde095f[_0x1d55f9(0x14a)]({'date':_0x4cd9f2,'amount':Math['round'](_0x275c97[_0x1d55f9(0x29c)]*0x64)/0x64}),_0xb953ee[_0x1d55f9(0x14a)]({'date':_0x4cd9f2,'count':_0x275c97[_0x1d55f9(0x182)]});}return{'dailyRevenue':_0xde095f,'dailyPayments':_0xb953ee};}async[a53_0x4a281e(0x257)](_0x55b021){const _0x38b9ad=a53_0x4a281e;console['log']('üìä\x20Getting\x20payout\x20reports\x20with\x20filters:',_0x55b021);const _0xacd7c7=new Date(_0x55b021[_0x38b9ad(0x22f)]),_0x2432dd=new Date(_0x55b021[_0x38b9ad(0x216)]),_0x2108d3=new Date(Date[_0x38b9ad(0x23c)](_0xacd7c7['getUTCFullYear'](),_0xacd7c7[_0x38b9ad(0x138)](),_0xacd7c7[_0x38b9ad(0xe6)](),0x0,0x0,0x0,0x0)),_0x410056=new Date(Date['UTC'](_0x2432dd[_0x38b9ad(0x1f1)](),_0x2432dd[_0x38b9ad(0x138)](),_0x2432dd[_0x38b9ad(0xe6)](),0x17,0x3b,0x3b,0x3e7));console[_0x38b9ad(0x135)]('üìÖ\x20Period:\x20'+_0x2108d3[_0x38b9ad(0x266)]()+_0x38b9ad(0xd9)+_0x410056[_0x38b9ad(0x266)]()),console[_0x38b9ad(0x135)](_0x38b9ad(0x193)+_0x55b021[_0x38b9ad(0x27a)]);const _0x540a6a=await database_1[_0x38b9ad(0x10c)][_0x38b9ad(0x183)][_0x38b9ad(0x19e)]({'where':{'status':_0x38b9ad(0x256),'gateway':_0x55b021['gateway']['toLowerCase'](),'createdAt':{'gte':_0x2108d3,'lte':_0x410056}},'select':{'id':!![],'shopId':!![],'amountAfterGatewayCommissionUSDT':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console[_0x38b9ad(0x135)](_0x38b9ad(0xc7)+_0x540a6a['length']+_0x38b9ad(0x107)+_0x55b021[_0x38b9ad(0x27a)]);const _0x2e689b=new Map();for(const _0x26cae9 of _0x540a6a){const _0x4899d7=_0x26cae9[_0x38b9ad(0x1de)]||0x0;if(_0x4899d7<=0x0){console[_0x38b9ad(0x15e)](_0x38b9ad(0x133)+_0x26cae9['id']+'\x20has\x20zero\x20or\x20null\x20merchant\x20amount,\x20skipping...');continue;}if(_0x2e689b[_0x38b9ad(0x22d)](_0x26cae9[_0x38b9ad(0x13e)])){const _0x568a2d=_0x2e689b[_0x38b9ad(0x17f)](_0x26cae9['shopId']);_0x568a2d[_0x38b9ad(0x11b)]+=_0x4899d7;}else _0x2e689b['set'](_0x26cae9[_0x38b9ad(0x13e)],{'merchantId':_0x26cae9[_0x38b9ad(0x249)]['id'],'merchantName':_0x26cae9['shop'][_0x38b9ad(0x1d6)],'merchantUsername':_0x26cae9[_0x38b9ad(0x249)][_0x38b9ad(0x243)],'totalAmount':_0x4899d7});}const _0x354f1b=Array[_0x38b9ad(0x106)](_0x2e689b['values']())[_0x38b9ad(0xfb)](_0x2e1733=>({'merchantId':_0x2e1733[_0x38b9ad(0x1a1)],'merchantName':_0x2e1733[_0x38b9ad(0x28b)],'merchantUsername':_0x2e1733[_0x38b9ad(0x140)],'gateway':_0x55b021[_0x38b9ad(0x27a)],'periodFrom':_0x55b021[_0x38b9ad(0x22f)],'periodTo':_0x55b021[_0x38b9ad(0x216)],'totalAmount':Math[_0x38b9ad(0x1d9)](_0x2e1733[_0x38b9ad(0x11b)]*0x64)/0x64}));return _0x354f1b[_0x38b9ad(0x160)]((_0x2fc50f,_0x156f7b)=>_0x156f7b['totalAmount']-_0x2fc50f[_0x38b9ad(0x11b)]),console['log']('üìä\x20Generated\x20reports\x20for\x20'+_0x354f1b['length']+'\x20merchants'),_0x354f1b;}async['depositBalance'](_0x55ba4d,_0x537627,_0x479ddb){const _0x52da37=a53_0x4a281e,_0x19b5f7=await database_1[_0x52da37(0x10c)]['shop'][_0x52da37(0x1b9)]({'where':{'id':_0x55ba4d}});if(!_0x19b5f7)throw new Error(_0x52da37(0xd6));await database_1[_0x52da37(0x10c)][_0x52da37(0x1e6)](async _0x4743fe=>{const _0x331765=_0x52da37;await _0x4743fe[_0x331765(0x183)][_0x331765(0xef)]({'data':{'shopId':_0x19b5f7['id'],'amount':_0x537627,'amountUSDT':_0x537627,'amountAfterGatewayCommissionUSDT':_0x537627,'sourceCurrency':_0x331765(0x244),'currency':_0x331765(0x244),'status':_0x331765(0x256),'gateway':_0x331765(0x21a),'customerName':_0x19b5f7[_0x331765(0x243)],'customerEmail':'@'+_0x19b5f7[_0x331765(0x205)],'paymentMethod':'CRYPTO','adminNotes':_0x479ddb||null,'successUrl':'-','failUrl':'-','paidAt':new Date()}}),await _0x4743fe[_0x331765(0x249)][_0x331765(0x191)]({'where':{'id':_0x19b5f7['id']},'data':{'balance':{'increment':_0x537627}}});}),console[_0x52da37(0x135)](_0x52da37(0x277)+_0x537627+_0x52da37(0x171)+_0x19b5f7[_0x52da37(0x243)]);}}function a53_0x49bb(_0x459bbf,_0x516f78){_0x459bbf=_0x459bbf-0xc1;const _0x16fa8c=a53_0x16fa();let _0x49bbca=_0x16fa8c[_0x459bbf];return _0x49bbca;}exports[a53_0x4a281e(0x18a)]=AdminService;