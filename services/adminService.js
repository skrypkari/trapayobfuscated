'use strict';const a38_0x2c3e97=a38_0x58fb;(function(_0x21152c,_0x43449c){const _0x1f438f=a38_0x58fb,_0x30cf83=_0x21152c();while(!![]){try{const _0x585f2e=-parseInt(_0x1f438f(0x213))/0x1+-parseInt(_0x1f438f(0x107))/0x2*(parseInt(_0x1f438f(0x17c))/0x3)+parseInt(_0x1f438f(0x1df))/0x4*(-parseInt(_0x1f438f(0x142))/0x5)+parseInt(_0x1f438f(0x185))/0x6*(parseInt(_0x1f438f(0xff))/0x7)+-parseInt(_0x1f438f(0x234))/0x8+parseInt(_0x1f438f(0x206))/0x9*(-parseInt(_0x1f438f(0x143))/0xa)+parseInt(_0x1f438f(0x171))/0xb;if(_0x585f2e===_0x43449c)break;else _0x30cf83['push'](_0x30cf83['shift']());}catch(_0x1f1cf8){_0x30cf83['push'](_0x30cf83['shift']());}}}(a38_0x41c2,0xa8adb));function a38_0x41c2(){const _0x1c3ed3=['yesterday','✅\x20Customer\x20data\x20updated\x20for\x20payment\x20','toLowerCase','%\x20from\x20','getFullYear','balance','MasterCard','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','\x20merchants\x20with\x20positive\x20balance','\x20\x20\x20💰\x20Total\x20payout:\x20','🔄\x20Gateway\x20mapping:','failureMessage','getAllUsers','findMany','../types/gateway','createUser','telegram','values','\x20\x20\x20Gateway:\x20','\x20\x20\x20Merchant\x20loses:\x20','orderId','\x20\x20\x20Added\x20to\x20balance:\x20+','gatewaySettings','\x20USDT','📊\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','getSystemStatistics',':\x20commission\x20=\x20','groupBy','\x20USDT\x20(same\x20as\x20awaiting)','sort','custom','\x20\x20\x20✅\x20Total\x20available\x20for\x20payout:\x20','shopId','36484052dozsON','\x20\x20\x20💰\x20Total\x20payments\x20turnover:\x20','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','⚠️\x20Payment\x20','\x20\x20\x20Full\x20amount:\x20','\x20\x20\x20🔍\x20Calculated\x20after\x20commission:\x20','deletePayout','\x20USDT,\x20Requested:\x20','commission','trc20',']\x20Updating\x20password\x20for\x20user\x20','5175FVdYKV','gatewayEarnings','customerIp','\x20\x20\x20�\x20Total\x20payments\x20turnover:\x20','\x20\x20\x20Current\x20balance:\x20','\x20\x20\x20💰\x20Total\x20turnover:\x20','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','Error\x20processing\x20payment\x20','📊\x20Sorting\x20payments\x20by\x20','822702QxFxQQ','__importDefault','cointopay2','gateways','rapyd','currencyService','availableBalance','📊\x20Merchant\x20statistics\x20calculated:','💰\x20Current\x20shop\x20balance:\x20','amountUSDT','Payment\x20not\x20found','\x20\x20\x20🌍\x20Country:\x20','some','💰\x20[PAYOUT]\x20Merchant\x20','wallets','awaitingPayout','📊\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20','Noda','payout','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','totalAmountUSDT','\x20balance\x20updated:\x20','getMonth','shop','\x20active\x20merchants\x20for\x20selection','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','Plisio','customerName','pk_','failUrl','commissionUSDT','\x20\x20\x20💵\x20Available\x20balance:\x20','gte','\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)','usdcPolygonWallet','\x20USDT\x20(actual\x20balances)','\x20paid\x20payments\x20for\x20analysis','toFixed','create','warn','chargebackAmount','\x27\x20not\x20found.\x20Available\x20gateways:\x20','get','amountAfterGatewayCommissionUSDT','💱\x20Currency\x20filter\x20applied:\x20','⚠️\x20Requested\x20gateway\x20\x27','\x20for\x20shop\x20','CHARGEBACK','NONEXISTENT_GATEWAY_FILTER','parse','🔄\x20Admin\x20updating\x20payment\x20','getGatewayDisplayName','all','name','substr','localeCompare','push','randomBytes','KLYME\x20GB','Test\x20Gateway','💰\x20Payment\x20','dateTo','SUSPENDED','stringify','defineProperty','thisMonth','shopUrl','trim','📊\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','gatewayCommissionRate','round','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','CoinToPay','💸\x20CHARGEBACK\x20penalty:\x20-','getGatewayInternalName',',\x20successful:\x20','merchantEarnings','getMerchantStatistics','totalPayments','map','plisio','convertToUSDT','Shop\x20not\x20found','📊\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','suspendUser',',\x20Commission:\x20',',\x20userId:\x20','🎯\x20[','currency','\x20\x20\x20🌐\x20IP:\x20','17636vXaexG','paymentGateways','updatedAt','set','findFirst','\x20\x20\x20💸\x20Total\x20payouts:\x20','getGatewayIdByName','getDate','totalCommissionRate','password','\x20USDT\x20(-','PAID','asc','AdminService','setHours','error','🎯\x20updateUser\x20called\x20with\x20ID:\x20','paymentsCount','update','📋\x20Found\x20','\x20balance\x20updated:','dateFrom','merchantUrl','crypto','\x27\x20->\x20name\x20\x27','test_gateway','bcryptjs','\x20\x20\x20📅\x20This\x20month:\x20','amountAfterCommissionUSDT','\x20to\x20','\x20\x20\x20Balance:\x20','\x20\x20\x20🤔\x20Difference:\x20','averageCommissionRate','📊\x20Total\x20payments\x20(including\x20failed):\x20','\x20USDT)','\x20USDT\x20(after\x20','paidOutUSDT','adminNotes','2020-01-01','1697841VMwsdx','publicKey','\x20\x20\x20Merchant\x20gets:\x20','createdAt','📊\x20Gateway\x20filter\x20applied:','ceil','⚠️\x20Gateway\x20\x27','dailyPayments','gateway','aggregate','🔍\x20Using\x20gateway\x20\x27','log','status','1114647FNzLWB','Rapyd','findUnique','_count','entries','\x20USDT\x20(already\x20paid\x20out)','insensitive','💰\x20Creating\x20payout\x20for\x20shop\x20','periodFrom','\x20USDT\x20(gross\x20revenue)','updateUser','totalPayout','\x20\x20\x20💸\x20Total\x20payouts\x20(all\x20time):\x20','externalPaymentUrl','noda','forEach','merchantEarningsUSDT','💸\x20CHARGEBACK:\x20Merchant\x20amount\x20already\x20deducted\x20from\x20balance','📅\x20Period:\x20','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','getPaymentById','totalAmountAfterCommissionUSDT','\x20->\x20','usdtPolygonWallet','toISOString','💰\x20[PAYOUT]\x20Gateway\x20','totalPaidOut','klyme_gb','paidAt','customerEmail','gatewayOrderId','📊\x20Calculating\x20payout\x20statistics...','customerCountry','8464992ptTDFs','period','\x27\x20(from\x20\x27','usdtTrcWallet','setDate','username','sk_','hash','polygon','🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','getGatewayNameById','\x20became\x20PAID:','fullName','49jcuakb','0000','amount','random','__esModule','Username\x20already\x20exists','hex','customerUa','202AncQvB','toUpperCase','reduce','desc','\x20USDT\x20from\x20balance','date','📊\x20Merchants\x20awaiting\x20payout:\x20','🔐\x20[','PENDING','ACTIVE','lte','getTime','split','dailyRevenue','\x20no\x20longer\x20PAID:',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','📋\x20Getting\x20merchants\x20selection\x20list...','telegramId','📊\x20Payout\x20statistics\x20calculated:','🔄\x20Converted\x20gateway\x20name\x20\x27','length','\x20USDT\x20(theoretical\x20net)','💰\x20Found\x20','txid','\x20merchants','toString','notes','KLYME\x20DE','statusChangedAt','%\x20commission)','generateDailyStatistics','day','./currencyService','📊\x20Getting\x20payments\x20with\x20filters:','\x20\x20\x20✅\x20Actual\x20available\x20balance:\x20','klyme_eu','\x20\x20\x20⏳\x20Pending\x20payout:\x20','🔧\x20[','turnoverUSDT','getAllPayouts','Telegram\x20username\x20already\x20exists','klyme_de','activateUser','deleteUser','payment','💰\x20Shop\x20','_sum','revenue','\x20USDT,\x20merchant:\x20','averageCheckUSDT','turnover','default','\x27\x20->\x20ID\x20\x27','COMPLETED','\x20\x20\x20Total\x20paid\x20out:\x20','📊\x20Calculated\x20commission\x20rate\x20for\x20payment\x20','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','network','count','335WFtZiV','50DZuWeA','90d','getPayoutById','successUrl','Insufficient\x20balance.\x20Available:\x20','not\x20set',']\x20Gateway\x20settings\x20JSON\x20string:','\x20\x20\x20📅\x20Total\x20payouts\x20(this\x20month):\x20','periodTo','\x20USDT\x20(',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)','usdtErcWallet'];a38_0x41c2=function(){return _0x1c3ed3;};return a38_0x41c2();}function a38_0x58fb(_0x435cb5,_0x4697d0){const _0x41c245=a38_0x41c2();return a38_0x58fb=function(_0x58fb04,_0x5c54db){_0x58fb04=_0x58fb04-0xfe;let _0x4b8a00=_0x41c245[_0x58fb04];return _0x4b8a00;},a38_0x58fb(_0x435cb5,_0x4697d0);}var __importDefault=this&&this[a38_0x2c3e97(0x186)]||function(_0x5797d1){const _0x144d1c=a38_0x2c3e97;return _0x5797d1&&_0x5797d1[_0x144d1c(0x103)]?_0x5797d1:{'default':_0x5797d1};};Object[a38_0x2c3e97(0x1c5)](exports,a38_0x2c3e97(0x103),{'value':!![]}),exports[a38_0x2c3e97(0x1ec)]=void 0x0;const database_1=__importDefault(require('../config/database')),bcryptjs_1=__importDefault(require(a38_0x2c3e97(0x1f9))),crypto_1=__importDefault(require(a38_0x2c3e97(0x1f6))),currencyService_1=require(a38_0x2c3e97(0x127)),gateway_1=require(a38_0x2c3e97(0x15e));class AdminService{async['getPayoutStats'](){const _0x3847d3=a38_0x2c3e97;console[_0x3847d3(0x211)](_0x3847d3(0x232));const _0xe5dcbd=await database_1[_0x3847d3(0x13a)][_0x3847d3(0x19c)][_0x3847d3(0x20f)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x3847d3(0x110)}}),_0x4d77e9=await database_1[_0x3847d3(0x13a)][_0x3847d3(0x133)][_0x3847d3(0x141)]({'where':{'status':_0x3847d3(0x1ea),'gateway':{'not':_0x3847d3(0x1f8)}}}),_0xab1199=new Date(),_0x39b4fa=new Date(_0xab1199[_0x3847d3(0x154)](),_0xab1199[_0x3847d3(0x19b)](),0x1),_0x3855e9=new Date(_0xab1199[_0x3847d3(0x154)](),_0xab1199[_0x3847d3(0x19b)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x721995=await database_1[_0x3847d3(0x13a)][_0x3847d3(0x197)]['aggregate']({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x39b4fa,'lte':_0x3855e9},'status':'COMPLETED'}}),_0x56b280=_0xe5dcbd[_0x3847d3(0x135)][_0x3847d3(0x22d)]||0x0,_0x193123=_0xe5dcbd[_0x3847d3(0x135)]['balance']||0x0,_0x31753a=_0x721995['_sum'][_0x3847d3(0x101)]||0x0,_0x374212={'totalPayout':Math[_0x3847d3(0x1cb)](_0x56b280*0x64)/0x64,'awaitingPayout':Math[_0x3847d3(0x1cb)](_0x193123*0x64)/0x64,'thisMonth':Math[_0x3847d3(0x1cb)](_0x31753a*0x64)/0x64,'availableBalance':Math[_0x3847d3(0x1cb)](_0x193123*0x64)/0x64,'totalPayments':_0x4d77e9};return console['log'](_0x3847d3(0x119)),console[_0x3847d3(0x211)](_0x3847d3(0x159)+_0x374212[_0x3847d3(0x21e)]+'\x20USDT\x20(total\x20paid\x20to\x20merchants)'),console[_0x3847d3(0x211)](_0x3847d3(0x173)+_0x374212[_0x3847d3(0x194)]+_0x3847d3(0x14e)),console[_0x3847d3(0x211)](_0x3847d3(0x1a4)+_0x374212[_0x3847d3(0x18b)]+_0x3847d3(0x16c)),console[_0x3847d3(0x211)](_0x3847d3(0x1fa)+_0x374212[_0x3847d3(0x1c6)]+_0x3847d3(0x167)),console['log']('\x20\x20\x20💳\x20Total\x20payments:\x20'+_0x374212[_0x3847d3(0x1d3)]+'\x20PAID\x20payments'),_0x374212;}async['updateCustomerData'](_0x23cb3b,_0x521d28){const _0x169244=a38_0x2c3e97;console['log']('🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20'+_0x23cb3b+':',_0x521d28);const _0x521cf7=await database_1[_0x169244(0x13a)]['payment']['findUnique']({'where':{'id':_0x23cb3b},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x521cf7)throw new Error('Payment\x20not\x20found');const _0x3b9f63={};_0x521d28['customerCountry']!==undefined&&(_0x3b9f63[_0x169244(0x233)]=_0x521d28[_0x169244(0x233)]||null);_0x521d28['customerIp']!==undefined&&(_0x3b9f63['customerIp']=_0x521d28[_0x169244(0x17e)]||null);_0x521d28[_0x169244(0x106)]!==undefined&&(_0x3b9f63[_0x169244(0x106)]=_0x521d28[_0x169244(0x106)]||null);const _0x29e71d=await database_1[_0x169244(0x13a)]['payment'][_0x169244(0x1f1)]({'where':{'id':_0x23cb3b},'data':{..._0x3b9f63,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x169244(0x211)](_0x169244(0x151)+_0x23cb3b),console[_0x169244(0x211)](_0x169244(0x190)+_0x521cf7['customerCountry']+'\x20->\x20'+_0x29e71d[_0x169244(0x233)]),console['log'](_0x169244(0x1de)+_0x521cf7['customerIp']+_0x169244(0x229)+_0x29e71d[_0x169244(0x17e)]),console['log']('\x20\x20\x20🖥️\x20User\x20Agent:\x20'+(_0x521cf7[_0x169244(0x106)]?_0x169244(0x1e2):'not\x20set')+'\x20->\x20'+(_0x29e71d['customerUa']?'set':_0x169244(0x148))),_0x29e71d;}async[a38_0x2c3e97(0x169)](_0x20ede6){const _0x3a439c=a38_0x2c3e97,_0x427f66=new Date();let _0x541310;switch(_0x20ede6[_0x3a439c(0x152)]()){case _0x3a439c(0x126):_0x541310=new Date(_0x427f66[_0x3a439c(0x154)](),_0x427f66[_0x3a439c(0x19b)](),_0x427f66['getDate'](),0x0,0x0,0x0,0x0);break;case _0x3a439c(0x150):const _0x4cd4a1=new Date(_0x427f66);_0x4cd4a1[_0x3a439c(0x238)](_0x4cd4a1['getDate']()-0x1),_0x541310=new Date(_0x4cd4a1[_0x3a439c(0x154)](),_0x4cd4a1[_0x3a439c(0x19b)](),_0x4cd4a1[_0x3a439c(0x1e6)](),0x0,0x0,0x0,0x0);break;case'7d':_0x541310=new Date(_0x427f66[_0x3a439c(0x112)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'30d':_0x541310=new Date(_0x427f66[_0x3a439c(0x112)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x3a439c(0x144):_0x541310=new Date(_0x427f66[_0x3a439c(0x112)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x3a439c(0x1b9):const _0x25a81e=await database_1[_0x3a439c(0x13a)][_0x3a439c(0x133)][_0x3a439c(0x1e3)]({'where':{'gateway':{'not':_0x3a439c(0x1f8)}},'orderBy':{'createdAt':_0x3a439c(0x1eb)},'select':{'createdAt':!![]}});_0x541310=_0x25a81e?_0x25a81e[_0x3a439c(0x209)]:new Date(_0x3a439c(0x205));break;default:_0x541310=new Date(_0x427f66['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}_0x541310[_0x3a439c(0x1ed)](0x0,0x0,0x0,0x0);let _0x36dd61;if(_0x20ede6[_0x3a439c(0x152)]()===_0x3a439c(0x150)){const _0x3c89fa=new Date(_0x427f66);_0x3c89fa['setDate'](_0x3c89fa[_0x3a439c(0x1e6)]()-0x1),_0x36dd61=new Date(_0x3c89fa[_0x3a439c(0x154)](),_0x3c89fa[_0x3a439c(0x19b)](),_0x3c89fa[_0x3a439c(0x1e6)](),0x17,0x3b,0x3b,0x3e7);}const _0x5ad18a={'gte':_0x541310};_0x36dd61&&(_0x5ad18a[_0x3a439c(0x111)]=_0x36dd61);const [_0x2ac33d,_0x271789,_0x165449,_0x3a5089,_0x38f09c,_0x36ec86]=await Promise[_0x3a439c(0x1b9)]([database_1[_0x3a439c(0x13a)]['shop'][_0x3a439c(0x141)](),database_1[_0x3a439c(0x13a)][_0x3a439c(0x19c)][_0x3a439c(0x141)]({'where':{'status':_0x3a439c(0x110)}}),database_1['default'][_0x3a439c(0x133)]['count']({'where':{'status':'PAID','createdAt':_0x5ad18a,'gateway':{'not':_0x3a439c(0x1f8)}}}),database_1[_0x3a439c(0x13a)][_0x3a439c(0x133)][_0x3a439c(0x15d)]({'where':{'status':_0x3a439c(0x1ea),'createdAt':_0x5ad18a,'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x3a439c(0x13a)][_0x3a439c(0x133)][_0x3a439c(0x15d)]({'where':{'gateway':{'not':_0x3a439c(0x1f8)}},'take':0xa,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x3a439c(0x13a)][_0x3a439c(0x133)][_0x3a439c(0x15d)]({'where':{'createdAt':_0x5ad18a,'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x2f7efe=0x0,_0x5c783a=0x0;for(const _0x1abf34 of _0x3a5089){const _0x5398cf=await currencyService_1[_0x3a439c(0x18a)][_0x3a439c(0x1d6)](_0x1abf34['amount'],_0x1abf34[_0x3a439c(0x1dd)]);_0x2f7efe+=_0x5398cf;if(_0x1abf34[_0x3a439c(0x1b0)]){const _0x2eb282=await currencyService_1[_0x3a439c(0x18a)][_0x3a439c(0x1d6)](_0x1abf34[_0x3a439c(0x101)],_0x1abf34[_0x3a439c(0x1dd)]),_0x1afe24=_0x1abf34[_0x3a439c(0x1b0)],_0xe3dfb8=_0x2eb282-_0x1afe24;_0x5c783a+=_0xe3dfb8;}}const _0x493034=_0x165449>0x0?_0x2f7efe/_0x165449:0x0,_0x28cc47=this[_0x3a439c(0x125)](_0x36ec86,_0x541310,_0x36dd61||_0x427f66),_0x17bc8a=await database_1[_0x3a439c(0x13a)][_0x3a439c(0x133)]['count']({'where':{'createdAt':_0x5ad18a,'gateway':{'not':_0x3a439c(0x1f8)}}}),_0x3b5506=_0x17bc8a>0x0?_0x165449/_0x17bc8a*0x64:0x0;return{'totalShops':_0x2ac33d,'activeShops':_0x271789,'totalPayments':_0x165449,'successfulPayments':_0x165449,'totalAttempts':_0x17bc8a,'totalRevenue':Math[_0x3a439c(0x1cb)](_0x2f7efe*0x64)/0x64,'trapayEarnings':Math['round'](_0x5c783a*0x64)/0x64,'averagePaymentAmount':Math[_0x3a439c(0x1cb)](_0x493034*0x64)/0x64,'conversionRate':Math[_0x3a439c(0x1cb)](_0x3b5506*0x64)/0x64,'dailyRevenue':_0x28cc47[_0x3a439c(0x114)],'dailyPayments':_0x28cc47[_0x3a439c(0x20d)],'recentPayments':_0x38f09c['map'](_0x436ff0=>({'id':_0x436ff0['id'],'amount':_0x436ff0[_0x3a439c(0x101)],'currency':_0x436ff0[_0x3a439c(0x1dd)],'status':_0x436ff0[_0x3a439c(0x212)],'gateway':_0x436ff0['gateway'],'shop':_0x436ff0[_0x3a439c(0x19c)],'createdAt':_0x436ff0[_0x3a439c(0x209)]}))};}async[a38_0x2c3e97(0x1d2)](_0x45bdc4){const _0x16b149=a38_0x2c3e97;console['log']('📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:',_0x45bdc4);let _0x15f55,_0x11f93c=new Date();if(_0x45bdc4[_0x16b149(0x235)]===_0x16b149(0x16e)&&_0x45bdc4[_0x16b149(0x1f4)]&&_0x45bdc4[_0x16b149(0x1c2)])_0x15f55=new Date(_0x45bdc4[_0x16b149(0x1f4)]),_0x11f93c=new Date(_0x45bdc4[_0x16b149(0x1c2)]),_0x15f55['setHours'](0x0,0x0,0x0,0x0),_0x11f93c[_0x16b149(0x1ed)](0x17,0x3b,0x3b,0x3e7);else{const _0x49a5d5=new Date();switch(_0x45bdc4[_0x16b149(0x235)]){case'week':_0x15f55=new Date(_0x49a5d5[_0x16b149(0x112)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'month':_0x15f55=new Date(_0x49a5d5['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'year':_0x15f55=new Date(_0x49a5d5[_0x16b149(0x112)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x16b149(0x1b9):default:_0x15f55=new Date('2020-01-01');break;}_0x15f55['setHours'](0x0,0x0,0x0,0x0),_0x11f93c['setHours'](0x17,0x3b,0x3b,0x3e7);}console[_0x16b149(0x211)](_0x16b149(0x225)+_0x15f55[_0x16b149(0x22b)]()+_0x16b149(0x1fc)+_0x11f93c[_0x16b149(0x22b)]());const _0x43ca5d={'status':_0x16b149(0x1ea),'gateway':{'not':'test_gateway'},'paidAt':{'gte':_0x15f55,'lte':_0x11f93c}};_0x45bdc4[_0x16b149(0x170)]&&(_0x43ca5d[_0x16b149(0x170)]=_0x45bdc4[_0x16b149(0x170)]);const _0x3e9108=await database_1[_0x16b149(0x13a)][_0x16b149(0x133)][_0x16b149(0x15d)]({'where':_0x43ca5d,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console['log'](_0x16b149(0x11d)+_0x3e9108[_0x16b149(0x11b)]+_0x16b149(0x1a9));const _0x4c2ef2={'gateway':{'not':_0x16b149(0x1f8)},'createdAt':{'gte':_0x15f55,'lte':_0x11f93c}};_0x45bdc4['shopId']&&(_0x4c2ef2[_0x16b149(0x170)]=_0x45bdc4['shopId']);const _0x59e132=await database_1[_0x16b149(0x13a)]['payment'][_0x16b149(0x141)]({'where':_0x4c2ef2});console[_0x16b149(0x211)](_0x16b149(0x200)+_0x59e132+_0x16b149(0x1d0)+_0x3e9108[_0x16b149(0x11b)]);let _0x2e01fc=0x0,_0x52e723=0x0,_0x10846c=0x0;const _0x4b1486={},_0x510750={},_0x47b34f={};for(const _0xe91a04 of _0x3e9108){try{const _0x367f90=_0xe91a04['amountUSDT']||0x0;if(_0x367f90<=0x0){console[_0x16b149(0x1ac)](_0x16b149(0x174)+_0xe91a04['id']+'\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...');continue;}let _0x3514e5,_0x4f0173;if(_0xe91a04[_0x16b149(0x1b0)]!==null&&_0xe91a04[_0x16b149(0x1b0)]!==undefined)_0x3514e5=_0xe91a04[_0x16b149(0x1b0)],_0x4f0173=_0x367f90-_0x3514e5,console['log']('📊\x20Using\x20saved\x20values\x20for\x20payment\x20'+_0xe91a04['id']+':\x20'+_0x367f90[_0x16b149(0x1aa)](0x6)+_0x16b149(0x137)+_0x3514e5[_0x16b149(0x1aa)](0x6)+_0x16b149(0x167));else{let _0x429237={};if(_0xe91a04[_0x16b149(0x19c)][_0x16b149(0x166)])try{_0x429237=JSON[_0x16b149(0x1b6)](_0xe91a04['shop'][_0x16b149(0x166)]);}catch(_0x38ab72){console[_0x16b149(0x1ee)]('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0xe91a04[_0x16b149(0x170)]+':',_0x38ab72);}let _0x569f11=0x2d;for(const [_0x16b189,_0x8c4d1b]of Object['entries'](_0x429237)){if(_0x16b189[_0x16b149(0x152)]()===_0xe91a04[_0x16b149(0x20e)]['toLowerCase']()){_0x569f11=_0x8c4d1b[_0x16b149(0x179)]||0x2d;break;}}_0x4f0173=_0x367f90*(_0x569f11/0x64),_0x3514e5=_0x367f90-_0x4f0173,console[_0x16b149(0x211)](_0x16b149(0x1d8)+_0xe91a04['id']+':\x20'+_0x569f11+_0x16b149(0x153)+_0x367f90[_0x16b149(0x1aa)](0x6)+_0x16b149(0x167));}_0x2e01fc+=_0x367f90,_0x52e723+=_0x3514e5,_0x10846c+=_0x4f0173;let _0x254c0b;_0xe91a04[_0x16b149(0x1ca)]!==null&&_0xe91a04[_0x16b149(0x1ca)]!==undefined?(_0x254c0b=_0xe91a04[_0x16b149(0x1ca)],console[_0x16b149(0x211)](_0x16b149(0x195)+_0xe91a04['id']+':\x20'+_0x254c0b+'%')):(_0x254c0b=_0x367f90>0x0?_0x4f0173/_0x367f90*0x64:0x0,console[_0x16b149(0x211)](_0x16b149(0x13e)+_0xe91a04['id']+':\x20'+_0x254c0b['toFixed'](0x2)+'%'));!_0x4b1486[_0xe91a04[_0x16b149(0x20e)]]&&(_0x4b1486[_0xe91a04[_0x16b149(0x20e)]]={'gateway':_0xe91a04[_0x16b149(0x20e)],'gatewayDisplayName':this[_0x16b149(0x1b8)](_0xe91a04[_0x16b149(0x20e)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x4b1486[_0xe91a04[_0x16b149(0x20e)]][_0x16b149(0x1f0)]++,_0x4b1486[_0xe91a04[_0x16b149(0x20e)]]['turnoverUSDT']+=_0x367f90,_0x4b1486[_0xe91a04['gateway']][_0x16b149(0x1a3)]+=_0x4f0173,_0x4b1486[_0xe91a04[_0x16b149(0x20e)]][_0x16b149(0x223)]+=_0x3514e5,_0x4b1486[_0xe91a04[_0x16b149(0x20e)]][_0x16b149(0x1e7)]+=_0x254c0b;!_0x45bdc4[_0x16b149(0x170)]&&(!_0x510750[_0xe91a04[_0x16b149(0x170)]]&&(_0x510750[_0xe91a04[_0x16b149(0x170)]]={'shopId':_0xe91a04[_0x16b149(0x170)],'shopName':_0xe91a04['shop'][_0x16b149(0x1ba)],'shopUsername':_0xe91a04[_0x16b149(0x19c)]['username'],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x510750[_0xe91a04[_0x16b149(0x170)]][_0x16b149(0x1f0)]++,_0x510750[_0xe91a04['shopId']][_0x16b149(0x12d)]+=_0x367f90,_0x510750[_0xe91a04[_0x16b149(0x170)]][_0x16b149(0x1a3)]+=_0x4f0173,_0x510750[_0xe91a04[_0x16b149(0x170)]][_0x16b149(0x223)]+=_0x3514e5);const _0x3195a5=_0xe91a04[_0x16b149(0x22f)][_0x16b149(0x22b)]()[_0x16b149(0x113)]('T')[0x0];!_0x47b34f[_0x3195a5]&&(_0x47b34f[_0x3195a5]={'date':_0x3195a5,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x47b34f[_0x3195a5]['turnover']+=_0x367f90,_0x47b34f[_0x3195a5][_0x16b149(0x1d1)]+=_0x3514e5,_0x47b34f[_0x3195a5]['gatewayEarnings']+=_0x4f0173,_0x47b34f[_0x3195a5]['paymentsCount']++;}catch(_0x43b48a){console[_0x16b149(0x1ee)](_0x16b149(0x183)+_0xe91a04['id']+':',_0x43b48a);}}Object[_0x16b149(0x161)](_0x4b1486)[_0x16b149(0x222)](_0xf826d=>{const _0x1b9e78=_0x16b149;_0xf826d[_0x1b9e78(0x1ff)]=_0xf826d[_0x1b9e78(0x1f0)]>0x0?_0xf826d[_0x1b9e78(0x1e7)]/_0xf826d[_0x1b9e78(0x1f0)]:0x0,delete _0xf826d[_0x1b9e78(0x1e7)];}),Object['values'](_0x510750)[_0x16b149(0x222)](_0x56cabb=>{const _0x2d138a=_0x16b149;_0x56cabb['averageCheckUSDT']=_0x56cabb[_0x2d138a(0x1f0)]>0x0?_0x56cabb[_0x2d138a(0x12d)]/_0x56cabb['paymentsCount']:0x0;});let _0x1c00e7=0x0,_0x2ab428=0x0;if(_0x45bdc4[_0x16b149(0x170)]){const _0x31a3f7=await database_1[_0x16b149(0x13a)]['payout'][_0x16b149(0x15d)]({'where':{'shopId':_0x45bdc4[_0x16b149(0x170)],'status':_0x16b149(0x13c),'createdAt':{'gte':_0x15f55,'lte':_0x11f93c}},'select':{'amount':!![]}});_0x1c00e7=_0x31a3f7['reduce']((_0xf1ff4c,_0x13a0b3)=>_0xf1ff4c+_0x13a0b3['amount'],0x0);const _0x456fac=await database_1[_0x16b149(0x13a)][_0x16b149(0x197)][_0x16b149(0x15d)]({'where':{'shopId':_0x45bdc4[_0x16b149(0x170)],'status':_0x16b149(0x10f),'createdAt':{'gte':_0x15f55,'lte':_0x11f93c}},'select':{'amount':!![]}});_0x2ab428=_0x456fac[_0x16b149(0x109)]((_0x4f8ce0,_0x2de347)=>_0x4f8ce0+_0x2de347[_0x16b149(0x101)],0x0);}const _0x1abec8=_0x59e132,_0x29f838=_0x3e9108[_0x16b149(0x11b)],_0x4b8ded=_0x29f838>0x0?_0x2e01fc/_0x29f838:0x0,_0xa84e67=_0x1abec8>0x0?Math[_0x16b149(0x1cb)](_0x29f838/_0x1abec8*0x2710)/0x64:0x0,_0x453340=Math[_0x16b149(0x20b)]((_0x11f93c['getTime']()-_0x15f55[_0x16b149(0x112)]())/(0x3e8*0x3c*0x3c*0x18)),_0xfd5cb4={'totalTurnover':Math[_0x16b149(0x1cb)](_0x2e01fc*0x64)/0x64,'merchantEarnings':Math['round'](_0x52e723*0x64)/0x64,'gatewayEarnings':Math[_0x16b149(0x1cb)](_0x10846c*0x64)/0x64,'totalPaidOut':Math[_0x16b149(0x1cb)](_0x1c00e7*0x64)/0x64,'pendingPayout':Math[_0x16b149(0x1cb)](_0x2ab428*0x64)/0x64,'averageCheck':Math[_0x16b149(0x1cb)](_0x4b8ded*0x64)/0x64,'totalPayments':_0x1abec8,'successfulPayments':_0x29f838,'conversionRate':_0xa84e67,'gatewayBreakdown':Object['values'](_0x4b1486)[_0x16b149(0x1d4)](_0x356f60=>({..._0x356f60,'turnoverUSDT':Math[_0x16b149(0x1cb)](_0x356f60[_0x16b149(0x12d)]*0x64)/0x64,'commissionUSDT':Math[_0x16b149(0x1cb)](_0x356f60['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x356f60[_0x16b149(0x223)]*0x64)/0x64,'averageCommissionRate':Math['round'](_0x356f60['averageCommissionRate']*0x64)/0x64})),'merchantBreakdown':_0x45bdc4[_0x16b149(0x170)]?undefined:Object[_0x16b149(0x161)](_0x510750)[_0x16b149(0x1d4)](_0x3450e7=>({..._0x3450e7,'turnoverUSDT':Math[_0x16b149(0x1cb)](_0x3450e7['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x16b149(0x1cb)](_0x3450e7['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x16b149(0x1cb)](_0x3450e7[_0x16b149(0x223)]*0x64)/0x64,'paidOutUSDT':Math[_0x16b149(0x1cb)](_0x3450e7[_0x16b149(0x203)]*0x64)/0x64,'averageCheckUSDT':Math[_0x16b149(0x1cb)](_0x3450e7[_0x16b149(0x138)]*0x64)/0x64})),'dailyData':Object[_0x16b149(0x161)](_0x47b34f)['map'](_0x477444=>({..._0x477444,'turnover':Math[_0x16b149(0x1cb)](_0x477444[_0x16b149(0x139)]*0x64)/0x64,'merchantEarnings':Math[_0x16b149(0x1cb)](_0x477444[_0x16b149(0x1d1)]*0x64)/0x64,'gatewayEarnings':Math[_0x16b149(0x1cb)](_0x477444['gatewayEarnings']*0x64)/0x64}))[_0x16b149(0x16d)]((_0x29320b,_0x1784f5)=>_0x29320b[_0x16b149(0x10c)][_0x16b149(0x1bc)](_0x1784f5[_0x16b149(0x10c)])),'periodInfo':{'from':_0x15f55,'to':_0x11f93c,'periodType':_0x45bdc4[_0x16b149(0x235)]||_0x16b149(0x16e),'daysCount':_0x453340}};return console['log'](_0x16b149(0x18c)),console[_0x16b149(0x211)](_0x16b149(0x181)+_0xfd5cb4['totalTurnover']+'\x20USDT'),console['log'](_0x16b149(0x198)+_0xfd5cb4[_0x16b149(0x1d1)]+_0x16b149(0x167)),console[_0x16b149(0x211)](_0x16b149(0x1cc)+_0xfd5cb4[_0x16b149(0x17d)]+'\x20USDT'),console['log']('\x20\x20\x20�\x20Total\x20paid\x20out:\x20'+_0xfd5cb4['totalPaidOut']+_0x16b149(0x167)),console[_0x16b149(0x211)](_0x16b149(0x12b)+_0xfd5cb4['pendingPayout']+_0x16b149(0x167)),console['log']('\x20\x20\x20�📊\x20Total\x20payments:\x20'+_0xfd5cb4['totalPayments']),_0xfd5cb4;}async['getMerchantsSelection'](){const _0x392539=a38_0x2c3e97;console[_0x392539(0x211)](_0x392539(0x117));const _0x47c67d=await database_1[_0x392539(0x13a)]['shop'][_0x392539(0x15d)]({'where':{'status':_0x392539(0x110)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x392539(0x1eb)}});return console['log'](_0x392539(0x1f2)+_0x47c67d[_0x392539(0x11b)]+_0x392539(0x19d)),_0x47c67d[_0x392539(0x1d4)](_0x4883e6=>({'id':_0x4883e6['id'],'username':_0x4883e6[_0x392539(0x239)],'name':_0x4883e6[_0x392539(0x1ba)]}));}[a38_0x2c3e97(0x1b8)](_0x1628e5){const _0x2010a7=a38_0x2c3e97,_0x5796d5={'test_gateway':_0x2010a7(0x1c0),'plisio':_0x2010a7(0x19f),'rapyd':_0x2010a7(0x214),'noda':_0x2010a7(0x196),'cointopay':_0x2010a7(0x1cd),'cointopay2':'Open\x20Banking\x202','klyme_eu':'KLYME\x20EU','klyme_gb':_0x2010a7(0x1bf),'klyme_de':_0x2010a7(0x122),'mastercard':_0x2010a7(0x156)};return _0x5796d5[_0x1628e5]||_0x1628e5;}[a38_0x2c3e97(0x1cf)](_0x5c3df4){const _0x393f5a=a38_0x2c3e97,_0x1c5806={'Test\x20Gateway':_0x393f5a(0x1f8),'Plisio':_0x393f5a(0x1d5),'Rapyd':_0x393f5a(0x189),'Noda':_0x393f5a(0x221),'CoinToPay':'cointopay','CoinToPay2':_0x393f5a(0x187),'KLYME\x20EU':_0x393f5a(0x12a),'KLYME\x20GB':_0x393f5a(0x22e),'KLYME\x20DE':_0x393f5a(0x130),'MasterCard':'mastercard'};return _0x1c5806[_0x5c3df4]||_0x5c3df4[_0x393f5a(0x152)]();}async['getMerchantsAwaitingPayout'](_0x3937d6){const _0x38dbba=a38_0x2c3e97,{page:_0x10e2a9,limit:_0x59d726,minAmount:_0x2771ce,search:_0x2aeed2}=_0x3937d6,_0x113d54=(_0x10e2a9-0x1)*_0x59d726;console[_0x38dbba(0x211)]('📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:',_0x3937d6);const _0x4e185c={'balance':{'gt':0x0},'status':_0x38dbba(0x110)};_0x2771ce&&(_0x4e185c[_0x38dbba(0x155)][_0x38dbba(0x1a5)]=_0x2771ce);_0x2aeed2&&(_0x4e185c[_0x38dbba(0x1ba)]={'contains':_0x2aeed2,'mode':_0x38dbba(0x219)});const [_0x236444,_0x143796]=await Promise[_0x38dbba(0x1b9)]([database_1['default'][_0x38dbba(0x19c)][_0x38dbba(0x15d)]({'where':_0x4e185c,'skip':_0x113d54,'take':_0x59d726,'orderBy':{'balance':_0x38dbba(0x10a)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1[_0x38dbba(0x13a)][_0x38dbba(0x19c)][_0x38dbba(0x141)]({'where':_0x4e185c})]);console[_0x38dbba(0x211)](_0x38dbba(0x11d)+_0x236444[_0x38dbba(0x11b)]+_0x38dbba(0x158));const _0x8f9610=await Promise['all'](_0x236444['map'](async _0x154b3c=>{const _0x327dd9=_0x38dbba,[_0x10a9c1,_0x29435f,_0x1a41c4]=await Promise[_0x327dd9(0x1b9)]([database_1[_0x327dd9(0x13a)][_0x327dd9(0x133)][_0x327dd9(0x141)]({'where':{'shopId':_0x154b3c['id'],'status':'PAID','gateway':{'not':_0x327dd9(0x1f8)}}}),database_1[_0x327dd9(0x13a)]['payment']['findFirst']({'where':{'shopId':_0x154b3c['id'],'status':'PAID','gateway':{'not':_0x327dd9(0x1f8)}},'orderBy':{'paidAt':_0x327dd9(0x1eb)},'select':{'paidAt':!![]}}),database_1[_0x327dd9(0x13a)][_0x327dd9(0x133)][_0x327dd9(0x16b)]({'by':['gateway'],'where':{'shopId':_0x154b3c['id'],'status':_0x327dd9(0x1ea),'gateway':{'not':_0x327dd9(0x1f8)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x323643=new Date(),_0x5b8993=new Date(_0x323643[_0x327dd9(0x154)](),_0x323643[_0x327dd9(0x19b)](),0x1),_0x3f586e=new Date(_0x323643[_0x327dd9(0x154)](),_0x323643['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x31df26,_0x5d8a5c]=await Promise[_0x327dd9(0x1b9)]([database_1[_0x327dd9(0x13a)][_0x327dd9(0x197)][_0x327dd9(0x20f)]({'_sum':{'amount':!![]},'where':{'shopId':_0x154b3c['id'],'status':_0x327dd9(0x13c)}}),database_1['default'][_0x327dd9(0x197)]['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x154b3c['id'],'status':_0x327dd9(0x13c),'createdAt':{'gte':_0x5b8993,'lte':_0x3f586e}}})]),_0x4aef76=_0x31df26['_sum'][_0x327dd9(0x101)]||0x0,_0x1133a2=_0x5d8a5c[_0x327dd9(0x135)][_0x327dd9(0x101)]||0x0,_0x447de1=await Promise['all'](_0x1a41c4['map'](async _0x1f41d7=>{const _0x408f7a=_0x327dd9;let _0x1b9ba7=0x2d;if(_0x154b3c[_0x408f7a(0x166)])try{const _0x25ed39=JSON[_0x408f7a(0x1b6)](_0x154b3c[_0x408f7a(0x166)]);for(const [_0x2b8ed8,_0x37e7c2]of Object[_0x408f7a(0x217)](_0x25ed39)){if(_0x2b8ed8[_0x408f7a(0x152)]()===_0x1f41d7['gateway']['toLowerCase']()){_0x1b9ba7=_0x37e7c2['commission']||0xa,console[_0x408f7a(0x211)](_0x408f7a(0x22c)+_0x1f41d7['gateway']+_0x408f7a(0x1b3)+_0x154b3c['id']+_0x408f7a(0x16a)+_0x1b9ba7+'%');break;}}}catch(_0x18ea50){console[_0x408f7a(0x1ee)](_0x408f7a(0x182)+_0x154b3c['id']+':',_0x18ea50);}const _0x2cefd0=_0x1f41d7[_0x408f7a(0x135)]?.[_0x408f7a(0x18e)]||0x0,_0x3290e8=_0x2cefd0*(0x1-_0x1b9ba7/0x64);return{'gateway':_0x1f41d7[_0x408f7a(0x20e)],'count':_0x1f41d7[_0x408f7a(0x216)]?.['id']||0x0,'amountUSDT':Math[_0x408f7a(0x1cb)](_0x2cefd0*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x408f7a(0x1cb)](_0x3290e8*0x64)/0x64,'commission':_0x1b9ba7};})),_0x2b5c85=_0x447de1[_0x327dd9(0x109)]((_0x5ca38e,_0x32d13f)=>_0x5ca38e+_0x32d13f[_0x327dd9(0x18e)],0x0),_0x3dc495=_0x447de1[_0x327dd9(0x109)]((_0x2510f2,_0x22ad94)=>_0x2510f2+_0x22ad94[_0x327dd9(0x1fb)],0x0),_0x346855=_0x154b3c[_0x327dd9(0x155)];return console[_0x327dd9(0x211)](_0x327dd9(0x192)+_0x154b3c[_0x327dd9(0x239)]+':'),console[_0x327dd9(0x211)](_0x327dd9(0x17f)+_0x2b5c85['toFixed'](0x2)+_0x327dd9(0x21c)),console[_0x327dd9(0x211)](_0x327dd9(0x176)+_0x3dc495[_0x327dd9(0x1aa)](0x2)+_0x327dd9(0x11c)),console['log'](_0x327dd9(0x129)+_0x346855['toFixed'](0x2)+'\x20USDT\x20(current\x20balance\x20in\x20DB)'),console[_0x327dd9(0x211)](_0x327dd9(0x1e4)+_0x4aef76[_0x327dd9(0x1aa)](0x2)+_0x327dd9(0x218)),console[_0x327dd9(0x211)](_0x327dd9(0x1fe)+(_0x3dc495-_0x4aef76-_0x346855)[_0x327dd9(0x1aa)](0x2)+_0x327dd9(0x1a6)),{'id':_0x154b3c['id'],'fullName':_0x154b3c['name'],'username':_0x154b3c[_0x327dd9(0x239)],'telegramId':_0x154b3c[_0x327dd9(0x160)],'merchantUrl':_0x154b3c['shopUrl'],'wallets':{'usdtPolygonWallet':_0x154b3c['usdtPolygonWallet'],'usdtTrcWallet':_0x154b3c['usdtTrcWallet'],'usdtErcWallet':_0x154b3c['usdtErcWallet'],'usdcPolygonWallet':_0x154b3c['usdcPolygonWallet']},'totalAmountUSDT':Math[_0x327dd9(0x1cb)](_0x2b5c85*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x327dd9(0x1cb)](_0x3dc495*0x64)/0x64,'currentBalance':Math[_0x327dd9(0x1cb)](_0x346855*0x64)/0x64,'totalPayout':Math[_0x327dd9(0x1cb)](_0x4aef76*0x64)/0x64,'thisMonth':Math[_0x327dd9(0x1cb)](_0x1133a2*0x64)/0x64,'paymentsCount':_0x10a9c1,'oldestPaymentDate':_0x29435f?.[_0x327dd9(0x22f)]||_0x154b3c['createdAt'],'gatewayBreakdown':_0x447de1};})),_0x1bb4b5=_0x8f9610[_0x38dbba(0x109)]((_0x1f02d4,_0x31f7c2)=>_0x1f02d4+_0x31f7c2[_0x38dbba(0x199)],0x0),_0x2f553e=_0x8f9610[_0x38dbba(0x109)]((_0x755a6e,_0x46983b)=>_0x755a6e+_0x46983b[_0x38dbba(0x228)],0x0),_0x17c78f=_0x8f9610[_0x38dbba(0x109)]((_0x250f3a,_0x47abe4)=>_0x250f3a+_0x47abe4[_0x38dbba(0x21e)],0x0),_0x274f61=_0x8f9610[_0x38dbba(0x109)]((_0x51e20c,_0x1e64ec)=>_0x51e20c+_0x1e64ec[_0x38dbba(0x1c6)],0x0);return console['log'](_0x38dbba(0x10d)+_0x143796+_0x38dbba(0x11f)),console[_0x38dbba(0x211)](_0x38dbba(0x172)+Math[_0x38dbba(0x1cb)](_0x1bb4b5*0x64)/0x64+'\x20USDT\x20(gross\x20revenue)'),console['log'](_0x38dbba(0x16f)+Math[_0x38dbba(0x1cb)](_0x2f553e*0x64)/0x64+_0x38dbba(0x1a8)),console['log'](_0x38dbba(0x21f)+Math[_0x38dbba(0x1cb)](_0x17c78f*0x64)/0x64+_0x38dbba(0x167)),console[_0x38dbba(0x211)](_0x38dbba(0x14a)+Math[_0x38dbba(0x1cb)](_0x274f61*0x64)/0x64+'\x20USDT'),{'merchants':_0x8f9610,'pagination':{'page':_0x10e2a9,'limit':_0x59d726,'total':_0x143796,'totalPages':Math['ceil'](_0x143796/_0x59d726)},'summary':{'totalMerchants':_0x143796,'totalAmountUSDT':Math[_0x38dbba(0x1cb)](_0x1bb4b5*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x38dbba(0x1cb)](_0x2f553e*0x64)/0x64,'totalPayout':Math[_0x38dbba(0x1cb)](_0x17c78f*0x64)/0x64,'thisMonth':Math[_0x38dbba(0x1cb)](_0x274f61*0x64)/0x64}};}async['createPayout'](_0x1c96c4){const _0x14a06a=a38_0x2c3e97,{shopId:_0x34dd8e,amount:_0x1e0871,network:_0x50489e,wallet:_0x23d629,notes:_0x4dea67,txid:_0x33111e,periodFrom:_0x55ccef,periodTo:_0x31fbab}=_0x1c96c4,_0x14bd45=await database_1[_0x14a06a(0x13a)]['$transaction'](async _0x4cb9a1=>{const _0x314e7f=_0x14a06a,_0x31826b=await _0x4cb9a1['shop'][_0x314e7f(0x215)]({'where':{'id':_0x34dd8e},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x31826b)throw new Error(_0x314e7f(0x1d7));console[_0x314e7f(0x211)](_0x314e7f(0x21a)+_0x31826b['username']+':'),console[_0x314e7f(0x211)](_0x314e7f(0x180)+_0x31826b['balance'][_0x314e7f(0x1aa)](0x6)+_0x314e7f(0x167)),console[_0x314e7f(0x211)]('\x20\x20\x20Payout\x20amount:\x20'+_0x1e0871[_0x314e7f(0x1aa)](0x6)+_0x314e7f(0x167)),console[_0x314e7f(0x211)](_0x314e7f(0x226)+_0x31826b[_0x314e7f(0x22d)][_0x314e7f(0x1aa)](0x6)+_0x314e7f(0x167));if(_0x33111e)console['log']('\x20\x20\x20Transaction\x20hash:\x20'+_0x33111e);if(_0x31826b[_0x314e7f(0x155)]<_0x1e0871)throw new Error(_0x314e7f(0x147)+_0x31826b[_0x314e7f(0x155)][_0x314e7f(0x1aa)](0x6)+_0x314e7f(0x178)+_0x1e0871[_0x314e7f(0x1aa)](0x6)+_0x314e7f(0x167));let _0x109483=_0x23d629;if(!_0x109483){const _0x4cc7ac=await _0x4cb9a1[_0x314e7f(0x19c)]['findUnique']({'where':{'id':_0x34dd8e},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x4cc7ac)switch(_0x50489e){case _0x314e7f(0x23c):_0x109483=_0x4cc7ac['usdtPolygonWallet']||undefined;break;case _0x314e7f(0x17a):_0x109483=_0x4cc7ac[_0x314e7f(0x237)]||undefined;break;case'erc20':_0x109483=_0x4cc7ac[_0x314e7f(0x14f)]||undefined;break;case'polygon_usdc':_0x109483=_0x4cc7ac[_0x314e7f(0x1a7)]||undefined;break;}}console[_0x314e7f(0x211)]('💳\x20Payout\x20wallet\x20for\x20'+_0x50489e+':\x20'+(_0x109483||'not\x20specified'));const _0x5eb81f=await _0x4cb9a1[_0x314e7f(0x197)][_0x314e7f(0x1ab)]({'data':{'shopId':_0x34dd8e,'amount':_0x1e0871,'network':_0x50489e,'status':_0x314e7f(0x13c),'txid':_0x33111e,'notes':_0x4dea67,'periodFrom':_0x55ccef?new Date(_0x55ccef):null,'periodTo':_0x31fbab?new Date(_0x31fbab):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x48fc9a=_0x31826b['balance']-_0x1e0871,_0x52273a=_0x31826b['totalPaidOut']+_0x1e0871;return await _0x4cb9a1[_0x314e7f(0x19c)]['update']({'where':{'id':_0x34dd8e},'data':{'balance':_0x48fc9a,'totalPaidOut':_0x52273a}}),console[_0x314e7f(0x211)](_0x314e7f(0x134)+_0x31826b[_0x314e7f(0x239)]+_0x314e7f(0x1f3)),console[_0x314e7f(0x211)](_0x314e7f(0x1fd)+_0x31826b['balance'][_0x314e7f(0x1aa)](0x6)+'\x20->\x20'+_0x48fc9a[_0x314e7f(0x1aa)](0x6)+_0x314e7f(0x1e9)+_0x1e0871[_0x314e7f(0x1aa)](0x6)+')'),console[_0x314e7f(0x211)](_0x314e7f(0x13d)+_0x31826b[_0x314e7f(0x22d)][_0x314e7f(0x1aa)](0x6)+_0x314e7f(0x229)+_0x52273a[_0x314e7f(0x1aa)](0x6)+'\x20USDT\x20(+'+_0x1e0871[_0x314e7f(0x1aa)](0x6)+')'),{'payout':_0x5eb81f,'shop':_0x31826b};});return console[_0x14a06a(0x211)]('✅\x20Payout\x20created:\x20'+_0x14bd45[_0x14a06a(0x197)]['id']+_0x14a06a(0x1b3)+_0x14bd45[_0x14a06a(0x19c)][_0x14a06a(0x239)]+'\x20('+_0x1e0871+_0x14a06a(0x201)),{'id':_0x14bd45[_0x14a06a(0x197)]['id'],'shopId':_0x14bd45[_0x14a06a(0x197)][_0x14a06a(0x170)],'shopName':_0x14bd45['shop'][_0x14a06a(0x1ba)],'shopUsername':_0x14bd45[_0x14a06a(0x19c)][_0x14a06a(0x239)],'amount':_0x14bd45[_0x14a06a(0x197)][_0x14a06a(0x101)],'network':_0x14bd45[_0x14a06a(0x197)][_0x14a06a(0x140)],'status':_0x14bd45[_0x14a06a(0x197)][_0x14a06a(0x212)],'txid':_0x14bd45[_0x14a06a(0x197)][_0x14a06a(0x11e)],'notes':_0x14bd45[_0x14a06a(0x197)][_0x14a06a(0x121)],'periodFrom':_0x14bd45[_0x14a06a(0x197)]['periodFrom'],'periodTo':_0x14bd45[_0x14a06a(0x197)][_0x14a06a(0x14b)],'createdAt':_0x14bd45['payout'][_0x14a06a(0x209)],'paidAt':_0x14bd45[_0x14a06a(0x197)][_0x14a06a(0x22f)]};}async[a38_0x2c3e97(0x12e)](_0x42d047){const _0x14b954=a38_0x2c3e97,{page:_0x4287b5,limit:_0x5dbf3e,shopId:_0x5cfe4b,network:_0x1a4bfc,dateFrom:_0xd7b7d2,dateTo:_0x17beab,search:_0x33fda3}=_0x42d047,_0x2c287d=(_0x4287b5-0x1)*_0x5dbf3e,_0x2c4afb={};_0x5cfe4b&&(_0x2c4afb['shopId']=_0x5cfe4b);_0x1a4bfc&&(_0x2c4afb[_0x14b954(0x140)]=_0x1a4bfc);(_0xd7b7d2||_0x17beab)&&(_0x2c4afb[_0x14b954(0x209)]={},_0xd7b7d2&&(_0x2c4afb[_0x14b954(0x209)][_0x14b954(0x1a5)]=new Date(_0xd7b7d2)),_0x17beab&&(_0x2c4afb[_0x14b954(0x209)]['lte']=new Date(_0x17beab)));_0x33fda3&&(_0x2c4afb['OR']=[{'shop':{'name':{'contains':_0x33fda3,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x33fda3,'mode':'insensitive'}}},{'notes':{'contains':_0x33fda3,'mode':'insensitive'}}]);const [_0x11644a,_0x8ad2d2]=await Promise[_0x14b954(0x1b9)]([database_1[_0x14b954(0x13a)][_0x14b954(0x197)][_0x14b954(0x15d)]({'where':_0x2c4afb,'skip':_0x2c287d,'take':_0x5dbf3e,'orderBy':{'createdAt':_0x14b954(0x10a)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x14b954(0x13a)][_0x14b954(0x197)][_0x14b954(0x141)]({'where':_0x2c4afb})]);return{'payouts':_0x11644a[_0x14b954(0x1d4)](_0x1e11db=>({'id':_0x1e11db['id'],'shopId':_0x1e11db['shopId'],'shopName':_0x1e11db['shop'][_0x14b954(0x1ba)],'shopUsername':_0x1e11db[_0x14b954(0x19c)][_0x14b954(0x239)],'amount':_0x1e11db[_0x14b954(0x101)],'network':_0x1e11db[_0x14b954(0x140)],'status':_0x1e11db[_0x14b954(0x212)],'txid':_0x1e11db['txid'],'notes':_0x1e11db['notes'],'periodFrom':_0x1e11db['periodFrom'],'periodTo':_0x1e11db[_0x14b954(0x14b)],'createdAt':_0x1e11db[_0x14b954(0x209)],'paidAt':_0x1e11db[_0x14b954(0x22f)]})),'pagination':{'page':_0x4287b5,'limit':_0x5dbf3e,'total':_0x8ad2d2,'totalPages':Math[_0x14b954(0x20b)](_0x8ad2d2/_0x5dbf3e)}};}async[a38_0x2c3e97(0x145)](_0xb6893d){const _0x44af45=a38_0x2c3e97,_0x30083c=await database_1[_0x44af45(0x13a)][_0x44af45(0x197)][_0x44af45(0x215)]({'where':{'id':_0xb6893d},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x30083c)return null;return{'id':_0x30083c['id'],'shopId':_0x30083c[_0x44af45(0x170)],'shopName':_0x30083c[_0x44af45(0x19c)]['name'],'shopUsername':_0x30083c['shop'][_0x44af45(0x239)],'amount':_0x30083c[_0x44af45(0x101)],'network':_0x30083c[_0x44af45(0x140)],'status':_0x30083c[_0x44af45(0x212)],'txid':_0x30083c[_0x44af45(0x11e)],'notes':_0x30083c[_0x44af45(0x121)],'periodFrom':_0x30083c[_0x44af45(0x21b)],'periodTo':_0x30083c[_0x44af45(0x14b)],'createdAt':_0x30083c[_0x44af45(0x209)],'paidAt':_0x30083c[_0x44af45(0x22f)]};}async[a38_0x2c3e97(0x177)](_0xfa2922){const _0xdc51f9=a38_0x2c3e97;await database_1[_0xdc51f9(0x13a)][_0xdc51f9(0x197)]['delete']({'where':{'id':_0xfa2922}});}async['getAllPayments'](_0x30f0f0){const _0xbc86=a38_0x2c3e97,{page:_0x403ec9,limit:_0x8b40b0,status:_0x1bf709,gateway:_0x4e8fe8,shopId:_0x42393f,dateFrom:_0x14b4e3,dateTo:_0x794d8d,search:_0x218fde,currency:_0x531a17,sortBy:_0x45c9b6,sortOrder:_0x5bac20}=_0x30f0f0,_0xf3b59d=(_0x403ec9-0x1)*_0x8b40b0;console[_0xbc86(0x211)](_0xbc86(0x128),_0x30f0f0);const _0x196dd6=await database_1[_0xbc86(0x13a)][_0xbc86(0x133)]['groupBy']({'by':[_0xbc86(0x20e)],'_count':{'gateway':!![]}});console[_0xbc86(0x211)]('📊\x20Available\x20gateways\x20in\x20database:',_0x196dd6['map'](_0x31919d=>_0x31919d[_0xbc86(0x20e)]+'\x20('+_0x31919d[_0xbc86(0x216)][_0xbc86(0x20e)]+'\x20payments)'));if(_0x4e8fe8){const _0x53e050=_0x196dd6[_0xbc86(0x191)](_0xf625cc=>_0xf625cc[_0xbc86(0x20e)][_0xbc86(0x152)]()===_0x4e8fe8[_0xbc86(0x152)]());!_0x53e050&&_0x4e8fe8[_0xbc86(0x152)]()!=='test_gateway'&&console[_0xbc86(0x211)](_0xbc86(0x1b2)+_0x4e8fe8+_0xbc86(0x1ae)+_0x196dd6[_0xbc86(0x1d4)](_0x29e0d0=>_0x29e0d0[_0xbc86(0x20e)])['join'](',\x20'));}const _0x267707={};_0x1bf709&&(_0x267707[_0xbc86(0x212)]=_0x1bf709['toUpperCase']());if(!_0x4e8fe8)_0x267707[_0xbc86(0x20e)]={'not':'test_gateway'};else{if(_0x4e8fe8&&(_0x4e8fe8['toLowerCase']()===_0xbc86(0x1f8)||_0x4e8fe8===_0xbc86(0x100)))_0x267707[_0xbc86(0x20e)]=_0xbc86(0x1f8);else{let _0x6c654c=_0x4e8fe8;const _0x1d0e11=(0x0,gateway_1[_0xbc86(0x23e)])(_0x4e8fe8);if(_0x1d0e11)_0x6c654c=_0x1d0e11,console['log']('🔄\x20Converted\x20gateway\x20ID\x20\x27'+_0x4e8fe8+'\x27\x20to\x20name\x20\x27'+_0x6c654c+'\x27');else{const _0x46b476=(0x0,gateway_1[_0xbc86(0x1e5)])(_0x4e8fe8);if(_0x46b476){const _0x1c3a9c=(0x0,gateway_1[_0xbc86(0x23e)])(_0x46b476);_0x1c3a9c&&(_0x6c654c=_0x1c3a9c,console['log'](_0xbc86(0x11a)+_0x4e8fe8+_0xbc86(0x13b)+_0x46b476+_0xbc86(0x1f7)+_0x6c654c+'\x27'));}else console['log'](_0xbc86(0x210)+_0x4e8fe8+_0xbc86(0x157));}const _0x1777ce=await database_1['default']['payment'][_0xbc86(0x141)]({'where':{'gateway':_0x6c654c[_0xbc86(0x152)]()},'take':0x1});_0x1777ce===0x0?(console[_0xbc86(0x211)](_0xbc86(0x20c)+_0x6c654c+_0xbc86(0x236)+_0x4e8fe8+'\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result'),_0x267707[_0xbc86(0x20e)]=_0xbc86(0x1b5)):(_0x267707['gateway']=_0x6c654c[_0xbc86(0x152)](),console[_0xbc86(0x211)]('✅\x20Using\x20gateway\x20filter:\x20\x27'+_0x6c654c+'\x27\x20(from\x20\x27'+_0x4e8fe8+'\x27)'));}}console['log'](_0xbc86(0x20a),_0x267707[_0xbc86(0x20e)]);_0x42393f&&(_0x267707['shopId']=_0x42393f);_0x531a17&&(_0x267707['currency']=_0x531a17[_0xbc86(0x108)](),console[_0xbc86(0x211)](_0xbc86(0x1b1)+_0x531a17[_0xbc86(0x108)]()));(_0x14b4e3||_0x794d8d)&&(_0x267707['createdAt']={},_0x14b4e3&&(_0x267707[_0xbc86(0x209)][_0xbc86(0x1a5)]=new Date(_0x14b4e3)),_0x794d8d&&(_0x267707[_0xbc86(0x209)][_0xbc86(0x111)]=new Date(_0x794d8d)));_0x218fde&&(_0x267707['OR']=[{'id':{'contains':_0x218fde,'mode':_0xbc86(0x219)}},{'orderId':{'contains':_0x218fde,'mode':_0xbc86(0x219)}},{'gatewayOrderId':{'contains':_0x218fde,'mode':_0xbc86(0x219)}},{'customerEmail':{'contains':_0x218fde,'mode':_0xbc86(0x219)}},{'shop':{'name':{'contains':_0x218fde,'mode':_0xbc86(0x219)}}},{'shop':{'username':{'contains':_0x218fde,'mode':_0xbc86(0x219)}}}]);console['log']('📊\x20Final\x20WHERE\x20conditions:',JSON[_0xbc86(0x1c4)](_0x267707,null,0x2));let _0x245dcf={'createdAt':_0xbc86(0x10a)};if(_0x45c9b6){const _0x38f566=[_0xbc86(0x101),_0xbc86(0x209),_0xbc86(0x1e1),_0xbc86(0x212),'gateway','currency'],_0x102b0b=['asc',_0xbc86(0x10a)];if(_0x38f566['includes'](_0x45c9b6)){const _0x175b31=_0x102b0b['includes'](_0x5bac20)?_0x5bac20:_0xbc86(0x10a);_0x245dcf={[_0x45c9b6]:_0x175b31},console[_0xbc86(0x211)](_0xbc86(0x184)+_0x45c9b6+'\x20in\x20'+_0x175b31+'\x20order');}}const [_0x25a650,_0xbc745e]=await Promise[_0xbc86(0x1b9)]([database_1[_0xbc86(0x13a)]['payment'][_0xbc86(0x15d)]({'where':_0x267707,'skip':_0xf3b59d,'take':_0x8b40b0,'orderBy':_0x245dcf,'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0xbc86(0x133)][_0xbc86(0x141)]({'where':_0x267707})]);return{'payments':_0x25a650,'pagination':{'page':_0x403ec9,'limit':_0x8b40b0,'total':_0xbc745e,'totalPages':Math['ceil'](_0xbc745e/_0x8b40b0)}};}async[a38_0x2c3e97(0x227)](_0x2d6d86){const _0x7c81c3=a38_0x2c3e97,_0x46a6d0=await database_1['default']['payment']['findUnique']({'where':{'id':_0x2d6d86},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x46a6d0)return null;return{'id':_0x46a6d0['id'],'shopId':_0x46a6d0[_0x7c81c3(0x170)],'gateway':_0x46a6d0[_0x7c81c3(0x20e)],'amount':_0x46a6d0[_0x7c81c3(0x101)],'currency':_0x46a6d0[_0x7c81c3(0x1dd)],'status':_0x46a6d0[_0x7c81c3(0x212)],'orderId':_0x46a6d0[_0x7c81c3(0x164)],'gatewayOrderId':_0x46a6d0[_0x7c81c3(0x231)],'customerEmail':_0x46a6d0[_0x7c81c3(0x230)],'customerName':_0x46a6d0['customerName'],'customerCountry':_0x46a6d0[_0x7c81c3(0x233)],'customerIp':_0x46a6d0[_0x7c81c3(0x17e)],'customerUa':_0x46a6d0['customerUa'],'failureMessage':_0x46a6d0[_0x7c81c3(0x15b)],'externalPaymentUrl':_0x46a6d0[_0x7c81c3(0x220)],'successUrl':_0x46a6d0[_0x7c81c3(0x146)],'failUrl':_0x46a6d0[_0x7c81c3(0x1a2)],'pendingUrl':_0x46a6d0['pendingUrl'],'whiteUrl':_0x46a6d0['whiteUrl'],'createdAt':_0x46a6d0[_0x7c81c3(0x209)],'updatedAt':_0x46a6d0[_0x7c81c3(0x1e1)],'shop':_0x46a6d0[_0x7c81c3(0x19c)]};}async['updatePaymentStatus'](_0x1de29a,_0x4056f2,_0x373dfb,_0x140f61){const _0x221f25=a38_0x2c3e97,_0xceba45=await database_1['default']['$transaction'](async _0x1a875c=>{const _0x5752c0=a38_0x58fb,_0x28dd68=await _0x1a875c[_0x5752c0(0x133)][_0x5752c0(0x215)]({'where':{'id':_0x1de29a},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x28dd68)throw new Error(_0x5752c0(0x18f));const _0x1912d0=_0x28dd68[_0x5752c0(0x212)],_0x317a33=_0x4056f2[_0x5752c0(0x108)]();console[_0x5752c0(0x211)](_0x5752c0(0x1b7)+_0x1de29a+'\x20status:\x20'+_0x1912d0+_0x5752c0(0x229)+_0x317a33),console[_0x5752c0(0x211)](_0x5752c0(0x18d)+_0x28dd68['shop'][_0x5752c0(0x155)]+'\x20USDT');const _0x49c795={'status':_0x317a33,'updatedAt':new Date(),'statusChangedBy':'admin','statusChangedAt':new Date()};_0x373dfb&&(_0x49c795[_0x5752c0(0x204)]=_0x373dfb);_0x317a33===_0x5752c0(0x1b4)&&_0x140f61&&(_0x49c795[_0x5752c0(0x1ad)]=_0x140f61);let _0x5b79b0=0x0,_0x4a89b4=_0x28dd68[_0x5752c0(0x19c)][_0x5752c0(0x155)];if(_0x317a33===_0x5752c0(0x1ea)&&_0x1912d0!==_0x5752c0(0x1ea)){_0x49c795['paidAt']=new Date();const _0x4fcfbb=await currencyService_1['currencyService']['convertToUSDT'](_0x28dd68[_0x5752c0(0x101)],_0x28dd68[_0x5752c0(0x1dd)]);_0x49c795[_0x5752c0(0x18e)]=_0x4fcfbb;let _0x1d728b=0x2d;const _0x20c86c=await _0x1a875c[_0x5752c0(0x19c)][_0x5752c0(0x215)]({'where':{'id':_0x28dd68[_0x5752c0(0x170)]},'select':{'gatewaySettings':!![]}});if(_0x20c86c?.[_0x5752c0(0x166)])try{const _0x2e56b7=JSON['parse'](_0x20c86c[_0x5752c0(0x166)]);for(const [_0x452616,_0x5a98dd]of Object[_0x5752c0(0x217)](_0x2e56b7)){if(_0x452616[_0x5752c0(0x152)]()===_0x28dd68[_0x5752c0(0x20e)][_0x5752c0(0x152)]()){_0x1d728b=_0x5a98dd['commission']||0xa;break;}}}catch(_0x4b5902){console[_0x5752c0(0x1ee)](_0x5752c0(0x13f)+_0x1de29a+':',_0x4b5902);}let _0x49a36c;_0x28dd68[_0x5752c0(0x1b0)]!==null&&_0x28dd68[_0x5752c0(0x1b0)]!==undefined?(_0x49a36c=_0x28dd68[_0x5752c0(0x1b0)],console[_0x5752c0(0x211)](_0x5752c0(0x168)+_0x49a36c[_0x5752c0(0x1aa)](0x6)+'\x20USDT\x20for\x20payment\x20'+_0x1de29a)):(_0x49a36c=_0x4fcfbb*(0x1-_0x1d728b/0x64),console[_0x5752c0(0x211)](_0x5752c0(0x1c9)+_0x1de29a+':\x20'+_0x1d728b+_0x5752c0(0x153)+_0x4fcfbb[_0x5752c0(0x1aa)](0x6)+_0x5752c0(0x167)),_0x49c795[_0x5752c0(0x1b0)]=_0x49a36c,_0x49c795['gatewayCommissionRate']=_0x1d728b),_0x5b79b0=_0x49a36c,_0x4a89b4+=_0x49a36c,console[_0x5752c0(0x211)](_0x5752c0(0x1c1)+_0x1de29a+_0x5752c0(0x23f)),console[_0x5752c0(0x211)]('\x20\x20\x20Full\x20amount:\x20'+_0x4fcfbb[_0x5752c0(0x1aa)](0x6)+_0x5752c0(0x167)),console['log'](_0x5752c0(0x162)+_0x28dd68[_0x5752c0(0x20e)]+_0x5752c0(0x1da)+_0x1d728b+'%'),console[_0x5752c0(0x211)](_0x5752c0(0x208)+_0x49a36c[_0x5752c0(0x1aa)](0x6)+'\x20USDT\x20(after\x20'+_0x1d728b+_0x5752c0(0x124)),console[_0x5752c0(0x211)](_0x5752c0(0x165)+_0x49a36c['toFixed'](0x6)+_0x5752c0(0x167));}else{if(_0x1912d0===_0x5752c0(0x1ea)&&_0x317a33!==_0x5752c0(0x1ea)){if(_0x28dd68[_0x5752c0(0x18e)]){let _0x5c2903=0x2d;const _0x42423a=await _0x1a875c[_0x5752c0(0x19c)]['findUnique']({'where':{'id':_0x28dd68[_0x5752c0(0x170)]},'select':{'gatewaySettings':!![]}});if(_0x42423a?.[_0x5752c0(0x166)])try{const _0x529993=JSON[_0x5752c0(0x1b6)](_0x42423a[_0x5752c0(0x166)]);for(const [_0x36541f,_0x2ebd3d]of Object[_0x5752c0(0x217)](_0x529993)){if(_0x36541f[_0x5752c0(0x152)]()===_0x28dd68[_0x5752c0(0x20e)][_0x5752c0(0x152)]()){_0x5c2903=_0x2ebd3d[_0x5752c0(0x179)]||0xa;break;}}}catch(_0x357ff5){console[_0x5752c0(0x1ee)]('Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20'+_0x1de29a+':',_0x357ff5);}const _0x429408=_0x28dd68[_0x5752c0(0x18e)]*(0x1-_0x5c2903/0x64);_0x5b79b0=-_0x429408,_0x4a89b4-=_0x429408,_0x49c795[_0x5752c0(0x18e)]=null,_0x49c795[_0x5752c0(0x1b0)]=null,console['log'](_0x5752c0(0x1c1)+_0x1de29a+_0x5752c0(0x115)),console[_0x5752c0(0x211)](_0x5752c0(0x175)+_0x28dd68['amountUSDT']['toFixed'](0x6)+_0x5752c0(0x167)),console[_0x5752c0(0x211)](_0x5752c0(0x162)+_0x28dd68[_0x5752c0(0x20e)]+_0x5752c0(0x1da)+_0x5c2903+'%'),console[_0x5752c0(0x211)](_0x5752c0(0x163)+_0x429408['toFixed'](0x6)+_0x5752c0(0x202)+_0x5c2903+_0x5752c0(0x124)),console[_0x5752c0(0x211)]('\x20\x20\x20Subtracted\x20from\x20balance:\x20-'+_0x429408['toFixed'](0x6)+'\x20USDT');}}}_0x317a33===_0x5752c0(0x1b4)&&(_0x1912d0===_0x5752c0(0x1ea)&&_0x28dd68[_0x5752c0(0x18e)]&&console[_0x5752c0(0x211)](_0x5752c0(0x224)),_0x140f61&&_0x140f61>0x0&&(_0x5b79b0-=_0x140f61,_0x4a89b4-=_0x140f61,console[_0x5752c0(0x211)](_0x5752c0(0x1ce)+_0x140f61[_0x5752c0(0x1aa)](0x6)+_0x5752c0(0x10b))));_0x317a33==='REFUND'&&_0x1912d0===_0x5752c0(0x1ea)&&console[_0x5752c0(0x211)](_0x5752c0(0x23d));const _0x2ac033=await _0x1a875c['payment'][_0x5752c0(0x1f1)]({'where':{'id':_0x1de29a},'data':_0x49c795,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x5b79b0!==0x0&&(await _0x1a875c[_0x5752c0(0x19c)][_0x5752c0(0x1f1)]({'where':{'id':_0x28dd68[_0x5752c0(0x170)]},'data':{'balance':_0x4a89b4}}),console[_0x5752c0(0x211)](_0x5752c0(0x134)+_0x28dd68[_0x5752c0(0x170)]+_0x5752c0(0x19a)+_0x28dd68[_0x5752c0(0x19c)][_0x5752c0(0x155)][_0x5752c0(0x1aa)](0x6)+_0x5752c0(0x229)+_0x4a89b4[_0x5752c0(0x1aa)](0x6)+_0x5752c0(0x14c)+(_0x5b79b0>0x0?'+':'')+_0x5b79b0['toFixed'](0x6)+')')),_0x2ac033;});return{'id':_0xceba45['id'],'shopId':_0xceba45[_0x221f25(0x170)],'gateway':_0xceba45[_0x221f25(0x20e)],'amount':_0xceba45[_0x221f25(0x101)],'currency':_0xceba45['currency'],'status':_0xceba45[_0x221f25(0x212)],'orderId':_0xceba45[_0x221f25(0x164)],'gatewayOrderId':_0xceba45[_0x221f25(0x231)],'customerEmail':_0xceba45[_0x221f25(0x230)],'customerName':_0xceba45[_0x221f25(0x1a0)],'customerCountry':_0xceba45[_0x221f25(0x233)],'customerIp':_0xceba45['customerIp'],'customerUa':_0xceba45[_0x221f25(0x106)],'failureMessage':_0xceba45[_0x221f25(0x15b)],'adminNotes':_0xceba45[_0x221f25(0x204)],'chargebackAmount':_0xceba45[_0x221f25(0x1ad)],'statusChangedBy':_0xceba45['statusChangedBy'],'statusChangedAt':_0xceba45[_0x221f25(0x123)],'createdAt':_0xceba45['createdAt'],'updatedAt':_0xceba45['updatedAt'],'shop':_0xceba45[_0x221f25(0x19c)]};}async[a38_0x2c3e97(0x21d)](_0x3bcc35,_0x52f611){const _0x4e905d=a38_0x2c3e97,_0x4a0912=Math[_0x4e905d(0x102)]()[_0x4e905d(0x120)](0x24)[_0x4e905d(0x1bb)](0x2,0x9);console[_0x4e905d(0x211)](_0x4e905d(0x1ef)+_0x4a0912+_0x4e905d(0x1db)+_0x3bcc35);const _0x4f691d={..._0x52f611};_0x52f611[_0x4e905d(0x1e8)]&&_0x52f611['password'][_0x4e905d(0x1c8)]()!==''?(console[_0x4e905d(0x211)](_0x4e905d(0x10e)+_0x4a0912+_0x4e905d(0x17b)+_0x3bcc35),_0x4f691d[_0x4e905d(0x1e8)]=await bcryptjs_1[_0x4e905d(0x13a)]['hash'](_0x52f611[_0x4e905d(0x1e8)],0xc)):(console[_0x4e905d(0x211)](_0x4e905d(0x10e)+_0x4a0912+_0x4e905d(0x14d)),delete _0x4f691d['password']);_0x52f611[_0x4e905d(0xfe)]&&(_0x4f691d[_0x4e905d(0x1ba)]=_0x52f611['fullName'],delete _0x4f691d['fullName']);_0x52f611['telegramId']&&(_0x4f691d[_0x4e905d(0x160)]=_0x52f611[_0x4e905d(0x118)],delete _0x4f691d[_0x4e905d(0x118)]);_0x52f611[_0x4e905d(0x1f5)]&&(_0x4f691d[_0x4e905d(0x1c7)]=_0x52f611['merchantUrl'],delete _0x4f691d[_0x4e905d(0x1f5)]);if(_0x52f611['gateways']){const _0x3bd503=_0x52f611[_0x4e905d(0x188)][_0x4e905d(0x1d4)](_0x27913f=>this[_0x4e905d(0x1cf)](_0x27913f));console[_0x4e905d(0x211)](_0x4e905d(0x15a),_0x52f611[_0x4e905d(0x188)],'->',_0x3bd503),_0x4f691d['paymentGateways']=JSON[_0x4e905d(0x1c4)](_0x3bd503),delete _0x4f691d[_0x4e905d(0x188)];}_0x52f611[_0x4e905d(0x166)]&&(console['log']('🔧\x20['+_0x4a0912+']\x20Gateway\x20settings\x20before\x20saving:',_0x52f611[_0x4e905d(0x166)]),_0x4f691d[_0x4e905d(0x166)]=JSON[_0x4e905d(0x1c4)](_0x52f611['gatewaySettings']),console[_0x4e905d(0x211)](_0x4e905d(0x12c)+_0x4a0912+_0x4e905d(0x149),_0x4f691d[_0x4e905d(0x166)]));_0x52f611['wallets']&&(_0x52f611[_0x4e905d(0x193)][_0x4e905d(0x22a)]!==undefined&&(_0x4f691d[_0x4e905d(0x22a)]=_0x52f611[_0x4e905d(0x193)][_0x4e905d(0x22a)]||null),_0x52f611[_0x4e905d(0x193)]['usdtTrcWallet']!==undefined&&(_0x4f691d[_0x4e905d(0x237)]=_0x52f611['wallets'][_0x4e905d(0x237)]||null),_0x52f611[_0x4e905d(0x193)][_0x4e905d(0x14f)]!==undefined&&(_0x4f691d[_0x4e905d(0x14f)]=_0x52f611['wallets']['usdtErcWallet']||null),_0x52f611[_0x4e905d(0x193)][_0x4e905d(0x1a7)]!==undefined&&(_0x4f691d[_0x4e905d(0x1a7)]=_0x52f611[_0x4e905d(0x193)][_0x4e905d(0x1a7)]||null),delete _0x4f691d[_0x4e905d(0x193)]);const _0x43c406=await database_1['default'][_0x4e905d(0x19c)]['update']({'where':{'id':_0x3bcc35},'data':_0x4f691d,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0x4e905d(0x211)](_0x4e905d(0x1dc)+_0x4a0912+_0x4e905d(0x116),_0x43c406[_0x4e905d(0x166)]),{'id':_0x43c406['id'],'fullName':_0x43c406[_0x4e905d(0x1ba)],'username':_0x43c406[_0x4e905d(0x239)],'telegramId':_0x43c406[_0x4e905d(0x160)],'merchantUrl':_0x43c406[_0x4e905d(0x1c7)],'gateways':_0x43c406[_0x4e905d(0x1e0)]?JSON['parse'](_0x43c406[_0x4e905d(0x1e0)]):null,'gatewaySettings':_0x43c406[_0x4e905d(0x166)]?JSON['parse'](_0x43c406[_0x4e905d(0x166)]):null,'publicKey':_0x43c406[_0x4e905d(0x207)],'wallets':{'usdtPolygonWallet':_0x43c406[_0x4e905d(0x22a)],'usdtTrcWallet':_0x43c406['usdtTrcWallet'],'usdtErcWallet':_0x43c406['usdtErcWallet'],'usdcPolygonWallet':_0x43c406[_0x4e905d(0x1a7)]},'status':_0x43c406[_0x4e905d(0x212)],'createdAt':_0x43c406['createdAt']};}async[a38_0x2c3e97(0x1d9)](_0x2dcb0c){const _0x2c6868=a38_0x2c3e97,_0x4402de=await database_1[_0x2c6868(0x13a)]['shop'][_0x2c6868(0x1f1)]({'where':{'id':_0x2dcb0c},'data':{'status':_0x2c6868(0x1c3)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x4402de['id'],'fullName':_0x4402de[_0x2c6868(0x1ba)],'username':_0x4402de[_0x2c6868(0x239)],'telegramId':_0x4402de[_0x2c6868(0x160)],'merchantUrl':_0x4402de[_0x2c6868(0x1c7)],'gateways':_0x4402de['paymentGateways']?JSON[_0x2c6868(0x1b6)](_0x4402de[_0x2c6868(0x1e0)]):null,'gatewaySettings':_0x4402de[_0x2c6868(0x166)]?JSON[_0x2c6868(0x1b6)](_0x4402de[_0x2c6868(0x166)]):null,'publicKey':_0x4402de[_0x2c6868(0x207)],'wallets':{'usdtPolygonWallet':_0x4402de[_0x2c6868(0x22a)],'usdtTrcWallet':_0x4402de['usdtTrcWallet'],'usdtErcWallet':_0x4402de[_0x2c6868(0x14f)],'usdcPolygonWallet':_0x4402de[_0x2c6868(0x1a7)]},'status':_0x4402de[_0x2c6868(0x212)],'createdAt':_0x4402de[_0x2c6868(0x209)]};}async[a38_0x2c3e97(0x131)](_0x4f540d){const _0x190aab=a38_0x2c3e97,_0x371ae0=await database_1[_0x190aab(0x13a)][_0x190aab(0x19c)][_0x190aab(0x1f1)]({'where':{'id':_0x4f540d},'data':{'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x371ae0['id'],'fullName':_0x371ae0['name'],'username':_0x371ae0[_0x190aab(0x239)],'telegramId':_0x371ae0[_0x190aab(0x160)],'merchantUrl':_0x371ae0['shopUrl'],'gateways':_0x371ae0[_0x190aab(0x1e0)]?JSON[_0x190aab(0x1b6)](_0x371ae0[_0x190aab(0x1e0)]):null,'gatewaySettings':_0x371ae0['gatewaySettings']?JSON[_0x190aab(0x1b6)](_0x371ae0['gatewaySettings']):null,'publicKey':_0x371ae0['publicKey'],'wallets':{'usdtPolygonWallet':_0x371ae0[_0x190aab(0x22a)],'usdtTrcWallet':_0x371ae0['usdtTrcWallet'],'usdtErcWallet':_0x371ae0[_0x190aab(0x14f)],'usdcPolygonWallet':_0x371ae0[_0x190aab(0x1a7)]},'status':_0x371ae0['status'],'createdAt':_0x371ae0['createdAt']};}async[a38_0x2c3e97(0x15c)](_0x30cc6e){const _0x1c91ac=a38_0x2c3e97,{page:_0x1f5d25,limit:_0x55461e,status:_0x4e648e}=_0x30cc6e,_0x5c2efe=(_0x1f5d25-0x1)*_0x55461e,_0x63daa9={};_0x4e648e&&(_0x63daa9['status']=_0x4e648e[_0x1c91ac(0x108)]());const [_0x552de8,_0x13a7cf]=await Promise['all']([database_1[_0x1c91ac(0x13a)]['shop'][_0x1c91ac(0x15d)]({'where':_0x63daa9,'skip':_0x5c2efe,'take':_0x55461e,'orderBy':{'createdAt':_0x1c91ac(0x10a)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x1c91ac(0x13a)][_0x1c91ac(0x19c)][_0x1c91ac(0x141)]({'where':_0x63daa9})]);return{'users':_0x552de8['map'](_0x53fa4b=>{const _0x5a1993=_0x1c91ac,_0xba5793=_0x53fa4b[_0x5a1993(0x1e0)]?JSON[_0x5a1993(0x1b6)](_0x53fa4b['paymentGateways']):null,_0x5276e1=_0xba5793?_0xba5793[_0x5a1993(0x1d4)](_0x4fb35d=>this[_0x5a1993(0x1b8)](_0x4fb35d)):null;return{'id':_0x53fa4b['id'],'fullName':_0x53fa4b[_0x5a1993(0x1ba)],'username':_0x53fa4b[_0x5a1993(0x239)],'telegramId':_0x53fa4b['telegram'],'merchantUrl':_0x53fa4b[_0x5a1993(0x1c7)],'gateways':_0x5276e1,'gatewaySettings':_0x53fa4b['gatewaySettings']?JSON[_0x5a1993(0x1b6)](_0x53fa4b[_0x5a1993(0x166)]):null,'publicKey':_0x53fa4b[_0x5a1993(0x207)],'wallets':{'usdtPolygonWallet':_0x53fa4b[_0x5a1993(0x22a)],'usdtTrcWallet':_0x53fa4b['usdtTrcWallet'],'usdtErcWallet':_0x53fa4b['usdtErcWallet'],'usdcPolygonWallet':_0x53fa4b['usdcPolygonWallet']},'status':_0x53fa4b['status'],'createdAt':_0x53fa4b[_0x5a1993(0x209)]};}),'pagination':{'page':_0x1f5d25,'limit':_0x55461e,'total':_0x13a7cf,'totalPages':Math['ceil'](_0x13a7cf/_0x55461e)}};}async['getUserById'](_0x6d1c3c){const _0x2a62c1=a38_0x2c3e97,_0x49b264=await database_1[_0x2a62c1(0x13a)][_0x2a62c1(0x19c)]['findUnique']({'where':{'id':_0x6d1c3c},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x49b264)return null;const _0x438fff=_0x49b264[_0x2a62c1(0x1e0)]?JSON[_0x2a62c1(0x1b6)](_0x49b264[_0x2a62c1(0x1e0)]):null,_0x4975e3=_0x438fff?_0x438fff[_0x2a62c1(0x1d4)](_0x3b36b5=>this[_0x2a62c1(0x1b8)](_0x3b36b5)):null;return _0x438fff&&_0x4975e3&&console['log']('🔄\x20Gateway\x20mapping\x20(get):',_0x438fff,'->',_0x4975e3),{'id':_0x49b264['id'],'fullName':_0x49b264[_0x2a62c1(0x1ba)],'username':_0x49b264['username'],'telegramId':_0x49b264[_0x2a62c1(0x160)],'merchantUrl':_0x49b264[_0x2a62c1(0x1c7)],'gateways':_0x4975e3,'gatewaySettings':_0x49b264[_0x2a62c1(0x166)]?JSON['parse'](_0x49b264[_0x2a62c1(0x166)]):null,'publicKey':_0x49b264[_0x2a62c1(0x207)],'wallets':{'usdtPolygonWallet':_0x49b264[_0x2a62c1(0x22a)],'usdtTrcWallet':_0x49b264[_0x2a62c1(0x237)],'usdtErcWallet':_0x49b264[_0x2a62c1(0x14f)],'usdcPolygonWallet':_0x49b264[_0x2a62c1(0x1a7)]},'status':_0x49b264['status'],'createdAt':_0x49b264[_0x2a62c1(0x209)]};}async[a38_0x2c3e97(0x15f)](_0x3a14ad){const _0x4567b3=a38_0x2c3e97,{fullName:_0x23b1e5,username:_0x1d590e,password:_0x394ca3,telegramId:_0x21f081,merchantUrl:_0x508b89,gateways:_0x65811e,gatewaySettings:_0x262446,wallets:_0x5564f4}=_0x3a14ad,_0x81283f=await database_1[_0x4567b3(0x13a)][_0x4567b3(0x19c)][_0x4567b3(0x215)]({'where':{'username':_0x1d590e}});if(_0x81283f)throw new Error(_0x4567b3(0x104));if(_0x21f081){const _0x1d2ed7=await database_1[_0x4567b3(0x13a)][_0x4567b3(0x19c)][_0x4567b3(0x215)]({'where':{'telegram':_0x21f081}});if(_0x1d2ed7)throw new Error(_0x4567b3(0x12f));}const _0x180bac=await bcryptjs_1[_0x4567b3(0x13a)][_0x4567b3(0x23b)](_0x394ca3,0xc),_0x209dae=_0x4567b3(0x1a1)+crypto_1['default']['randomBytes'](0x20)[_0x4567b3(0x120)](_0x4567b3(0x105)),_0x43818e=_0x4567b3(0x23a)+crypto_1['default'][_0x4567b3(0x1be)](0x20)[_0x4567b3(0x120)](_0x4567b3(0x105)),_0x1eca0a=_0x65811e?_0x65811e[_0x4567b3(0x1d4)](_0x2369f8=>this[_0x4567b3(0x1cf)](_0x2369f8)):null;_0x65811e&&_0x1eca0a&&console['log']('🔄\x20Gateway\x20mapping\x20(create):',_0x65811e,'->',_0x1eca0a);const _0x56da35=await database_1[_0x4567b3(0x13a)]['shop'][_0x4567b3(0x1ab)]({'data':{'name':_0x23b1e5,'username':_0x1d590e,'password':_0x180bac,'telegram':_0x21f081,'shopUrl':_0x508b89,'paymentGateways':_0x1eca0a?JSON[_0x4567b3(0x1c4)](_0x1eca0a):null,'gatewaySettings':_0x262446?JSON[_0x4567b3(0x1c4)](_0x262446):null,'usdtPolygonWallet':_0x5564f4?.[_0x4567b3(0x22a)]||null,'usdtTrcWallet':_0x5564f4?.[_0x4567b3(0x237)]||null,'usdtErcWallet':_0x5564f4?.['usdtErcWallet']||null,'usdcPolygonWallet':_0x5564f4?.['usdcPolygonWallet']||null,'publicKey':_0x209dae,'secretKey':_0x43818e,'status':_0x4567b3(0x110)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x56da35['id'],'fullName':_0x56da35[_0x4567b3(0x1ba)],'username':_0x56da35['username'],'telegramId':_0x56da35[_0x4567b3(0x160)],'merchantUrl':_0x56da35['shopUrl'],'gateways':_0x56da35['paymentGateways']?JSON[_0x4567b3(0x1b6)](_0x56da35['paymentGateways']):null,'gatewaySettings':_0x56da35[_0x4567b3(0x166)]?JSON[_0x4567b3(0x1b6)](_0x56da35[_0x4567b3(0x166)]):null,'publicKey':_0x56da35['publicKey'],'wallets':{'usdtPolygonWallet':_0x56da35[_0x4567b3(0x22a)],'usdtTrcWallet':_0x56da35['usdtTrcWallet'],'usdtErcWallet':_0x56da35[_0x4567b3(0x14f)],'usdcPolygonWallet':_0x56da35[_0x4567b3(0x1a7)]},'status':_0x56da35[_0x4567b3(0x212)],'createdAt':_0x56da35[_0x4567b3(0x209)]};}async[a38_0x2c3e97(0x132)](_0x5b1592){const _0x500502=a38_0x2c3e97;await database_1[_0x500502(0x13a)][_0x500502(0x19c)]['delete']({'where':{'id':_0x5b1592}});}[a38_0x2c3e97(0x125)](_0x40b95d,_0x3dcb95,_0x582b43){const _0x40b174=a38_0x2c3e97,_0x2c15d7=new Map(),_0x41a28e=new Date(_0x3dcb95);while(_0x41a28e<=_0x582b43){const _0x4ba4f1=_0x41a28e['toISOString']()[_0x40b174(0x113)]('T')[0x0];_0x2c15d7['set'](_0x4ba4f1,{'revenue':0x0,'count':0x0}),_0x41a28e[_0x40b174(0x238)](_0x41a28e[_0x40b174(0x1e6)]()+0x1);}for(const _0x40133c of _0x40b95d){const _0x478ea6=_0x40133c[_0x40b174(0x209)][_0x40b174(0x22b)]()['split']('T')[0x0],_0x2997a3=_0x2c15d7[_0x40b174(0x1af)](_0x478ea6);_0x2997a3&&(_0x2997a3[_0x40b174(0x141)]+=0x1,_0x40133c['status']===_0x40b174(0x1ea)&&(_0x40133c['amountUSDT']?_0x2997a3[_0x40b174(0x136)]+=_0x40133c[_0x40b174(0x18e)]:console[_0x40b174(0x211)](_0x40b174(0x174)+_0x40133c['id']+_0x40b174(0x19e))));}const _0x197a2a=[],_0x369428=[];for(const [_0x5708fc,_0x1a1991]of _0x2c15d7){_0x197a2a[_0x40b174(0x1bd)]({'date':_0x5708fc,'amount':Math[_0x40b174(0x1cb)](_0x1a1991[_0x40b174(0x136)]*0x64)/0x64}),_0x369428[_0x40b174(0x1bd)]({'date':_0x5708fc,'count':_0x1a1991[_0x40b174(0x141)]});}return{'dailyRevenue':_0x197a2a,'dailyPayments':_0x369428};}}exports['AdminService']=AdminService;