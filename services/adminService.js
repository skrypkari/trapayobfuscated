'use strict';function a33_0x1c1d(_0x40e812,_0x50d81a){const _0x73094c=a33_0x7309();return a33_0x1c1d=function(_0x1c1d67,_0x213015){_0x1c1d67=_0x1c1d67-0x110;let _0x5b0204=_0x73094c[_0x1c1d67];return _0x5b0204;},a33_0x1c1d(_0x40e812,_0x50d81a);}const a33_0x4eb932=a33_0x1c1d;(function(_0x5d536c,_0x218141){const _0x240c55=a33_0x1c1d,_0x1b35b9=_0x5d536c();while(!![]){try{const _0x45e21d=-parseInt(_0x240c55(0x19d))/0x1*(parseInt(_0x240c55(0x16b))/0x2)+parseInt(_0x240c55(0x1a8))/0x3*(parseInt(_0x240c55(0x14e))/0x4)+-parseInt(_0x240c55(0x140))/0x5*(-parseInt(_0x240c55(0x12a))/0x6)+-parseInt(_0x240c55(0x1c8))/0x7*(-parseInt(_0x240c55(0x1eb))/0x8)+-parseInt(_0x240c55(0x150))/0x9+-parseInt(_0x240c55(0x173))/0xa+-parseInt(_0x240c55(0x131))/0xb*(-parseInt(_0x240c55(0x1b3))/0xc);if(_0x45e21d===_0x218141)break;else _0x1b35b9['push'](_0x1b35b9['shift']());}catch(_0x4135ba){_0x1b35b9['push'](_0x1b35b9['shift']());}}}(a33_0x7309,0x28ba6));function a33_0x7309(){const _0x45e8c0=['UserService','36948iMuRVs','getGatewayNameById','📊\x20Generating\x20admin\x20statistics\x20for\x20period:\x20','username','📅\x20This\x20Month:\x20','💸\x20Chargeback\x20penalty:\x20','Error\x20parsing\x20gateway\x20settings:','findMany','gatewayOrderId','reduce','❌\x20Payout\x20not\x20found:\x20','commission','👥\x20Total\x20users:\x20','toUpperCase','💸\x20Creating\x20payout\x20for\x20shop\x20','💰\x20Total\x20amount:\x20','Payout\x20not\x20found','customerEmail','adminNotes','generateDateRange','\x20payments\x20for\x20analysis\x20(PAID/REFUND/CHARGEBACK)','7UTTEHf','\x20merchants\x20with\x20eligible\x20PAID\x20payments','bankId','Shop\x20is\x20not\x20active','totalAmountAfterCommissionUSDT','__esModule','gateway','amount','network',',\x20amount:\x20','status','\x20suspended\x20successfully','⏳\x20Awaiting\x20Payout:\x20','./userService','💳\x20Total\x20payments:\x20','includes','updateUser','Failed\x20to\x20send\x20Telegram\x20payout\x20notification:','gatewayPaymentId','🔄\x20Marking\x20payments\x20as\x20paid\x20out\x20for\x20shop\x20','round','chargebackAmount','\x20payouts\x20out\x20of\x20','\x20status\x20updated\x20from\x20','__importDefault','statusChangedBy','calculateEffectiveAmount','\x20payments\x20for\x20revenue\x20calculation\x20(PAID/REFUND/CHARGEBACK)','📋\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','../types/gateway','customerName','markPaymentsAsPaidOut','error','\x20USDT\x20(включая\x20штрафы\x20chargeback)','✅\x20Payout\x20statistics\x20calculated:','1818952fIZQue','getUserById','webhookLogs','\x20USDT\x20via\x20','🔍\x20Getting\x20payment\x20by\x20ID:\x20','AdminService','deletePayout','✅\x20Activating\x20user:\x20','COMPLETED','getPayoutById','split','User\x20not\x20found','CHARGEBACK','\x20USDT','abs','paymentGateways','get','getMerchantsAwaitingPayout','toISOString','PENDING','default','\x20users\x20out\x20of\x20','isEligibleForPayout','PAID','statusChangedAt','\x20activated\x20successfully','Payment\x20not\x20found','✅\x20Returning\x20','shopUrl','EXPIRED','slice','parse','getDate','48AayPqJ','admin','map','REFUND','size','./telegramBotService','toFixed','22jOxYkR','\x20payments\x20out\x20of\x20','FAILED','merchantPaid','shopId','externalPaymentUrl','remitterName','getMonth','User\x20is\x20already\x20active','count','length','updatePaymentStatus','\x20days)','getAllPayouts','payoutDelay','188380yltKOr','getFullYear','insensitive','🚫\x20Suspending\x20user:\x20','expiresAt','ceil','charAt','gatewaySettings','name','update','SUSPENDED','✅\x20Payout\x20','getAllPayments','create','232fhOKQf','getPaymentById','1528407rmycdA','currency','getSystemStatistics','paidAt','createdAt','payments','\x20USDT\x20(','usdtTrcWallet','convertToUSDT','💸\x20Chargeback\x20amount:\x20','notes','\x20days','orderId','telegram','📊\x20Daily\x20revenue\x20entries:\x20','join','30d','Chargeback\x20amount\x20is\x20required\x20and\x20must\x20be\x20positive\x20(amount\x20in\x20USDT)','📋\x20Getting\x20payouts\x20with\x20filters:','completed','💰\x20Available\x20Balance:\x20','log','payout','✅\x20Payout\x20created\x20successfully:\x20','calculateAmountAfterCommission','txid','activateUser','768LqwUek','💵\x20Total\x20revenue:\x20','✅\x20Marked\x20','💰\x20Found\x20','📈\x20Average\x20payment:\x20','getGatewaySettings','updateMany','../config/database','774560YsXhpO','suspendUser','\x20USDT\x20after\x20commission)','💸\x20Total\x20Payout:\x20','sourceCurrency','toLowerCase','date','usage','amountAfterCommissionUSDT','remitterIban','awaitingPayout','deleteUser','amountUSDT','\x20USDT\x20(только\x20PAID\x20платежи)','createPayout','currencyService','ACTIVE','🔄\x20Admin\x20updating\x20payment\x20','\x20status\x20to:\x20','getPeriodDays','📊\x20Found\x20','totalPayout','shop','payment','cardLast4','lte','getPayoutStats','✅\x20User\x20','\x20merchants\x20out\x20of\x20','usdtErcWallet','webhookLog','all','📊\x20Calculating\x20admin\x20payout\x20statistics...','updatedAt','from','totalAmountUSDT','has','./currencyService','usdcPolygonWallet','\x20total','\x20to\x20','\x20payments\x20as\x20paid\x20out','355jjyQeo','✅\x20Payment\x20','\x20USDT\x20(penalty\x20amount)','gte','❌\x20Payment\x20not\x20found:\x20','paymentMethod','stringify','defineProperty','\x20deleted\x20successfully','createUser','push','801yHabaZ','asc','admin_status_update','userService','findUnique','📅\x20Processing\x20daily\x20stats\x20for\x20','desc','set','\x20eligible\x20PAID\x20payments\x20for\x20payout\x20analysis','Shop\x20not\x20found'];a33_0x7309=function(){return _0x45e8c0;};return a33_0x7309();}var __importDefault=this&&this[a33_0x4eb932(0x1e0)]||function(_0x5ccf85){const _0x5074d9=a33_0x4eb932;return _0x5ccf85&&_0x5ccf85[_0x5074d9(0x1cd)]?_0x5ccf85:{'default':_0x5ccf85};};Object[a33_0x4eb932(0x1a4)](exports,a33_0x4eb932(0x1cd),{'value':!![]}),exports[a33_0x4eb932(0x1f0)]=void 0x0;const database_1=__importDefault(require(a33_0x4eb932(0x172))),currencyService_1=require(a33_0x4eb932(0x198)),userService_1=require(a33_0x4eb932(0x1d5)),telegramBotService_1=require(a33_0x4eb932(0x12f)),gateway_1=require(a33_0x4eb932(0x1e5));class AdminService{constructor(){const _0xd6efc1=a33_0x4eb932;this[_0xd6efc1(0x1ab)]=new userService_1[(_0xd6efc1(0x1b2))]();}[a33_0x4eb932(0x186)](_0x21a9b8){const _0x5605eb=a33_0x4eb932;switch(_0x21a9b8){case'7d':return 0x7;case _0x5605eb(0x160):return 0x1e;case'90d':return 0x5a;case'1y':return 0x16d;default:return 0x1e;}}[a33_0x4eb932(0x1c6)](_0x2b9ac6,_0x29c09a){const _0x44598d=a33_0x4eb932,_0x39772c=[],_0x512db2=new Date(_0x2b9ac6);while(_0x512db2<=_0x29c09a){_0x39772c[_0x44598d(0x1a7)](_0x512db2['toISOString']()[_0x44598d(0x113)]('T')[0x0]),_0x512db2['setDate'](_0x512db2[_0x44598d(0x129)]()+0x1);}return _0x39772c;}[a33_0x4eb932(0x170)](_0xb1d56f,_0x3496df){const _0x42e822=a33_0x4eb932;if(!_0xb1d56f[_0x42e822(0x147)])return{'commission':0x0,'payoutDelay':0x0};try{const _0xb94670=JSON[_0x42e822(0x128)](_0xb1d56f[_0x42e822(0x147)]),_0x31fbf2=_0x3496df[_0x42e822(0x146)](0x0)['toUpperCase']()+_0x3496df['slice'](0x1)['toLowerCase']();if(_0xb94670&&_0xb94670[_0x31fbf2])return{'commission':_0xb94670[_0x31fbf2][_0x42e822(0x1be)]||0x0,'payoutDelay':_0xb94670[_0x31fbf2][_0x42e822(0x13f)]||0x0};}catch(_0x523bc7){console[_0x42e822(0x1e8)](_0x42e822(0x1b9),_0x523bc7);}return{'commission':0x0,'payoutDelay':0x0};}[a33_0x4eb932(0x11f)](_0x4dc76f){const _0x611ab2=a33_0x4eb932;if(_0x4dc76f['status']!==_0x611ab2(0x120)||_0x4dc76f[_0x611ab2(0x134)]||!_0x4dc76f['paidAt'])return![];const _0x4d1f04=this['getGatewaySettings'](_0x4dc76f[_0x611ab2(0x189)],_0x4dc76f['gateway']),_0x439da4=_0x4d1f04[_0x611ab2(0x13f)]*0x18*0x3c*0x3c*0x3e8,_0x38768c=new Date(_0x4dc76f[_0x611ab2(0x153)]['getTime']()+_0x439da4);return new Date()>_0x38768c;}[a33_0x4eb932(0x168)](_0x2a7704,_0x1ef82b){return _0x2a7704*(0x1-_0x1ef82b/0x64);}[a33_0x4eb932(0x1e2)](_0x2f0724){const _0xda7e2b=a33_0x4eb932;switch(_0x2f0724[_0xda7e2b(0x1d2)]){case _0xda7e2b(0x120):return _0x2f0724['amount'];case'CHARGEBACK':return-(_0x2f0724['chargebackAmount']||0x0);case _0xda7e2b(0x12d):return 0x0;default:return 0x0;}}async[a33_0x4eb932(0x181)](_0xa06597){const _0x2a87e9=a33_0x4eb932,{shopId:_0x5ed26c,amount:_0x363fd3,network:_0x565c76,notes:_0x5a651c}=_0xa06597;console['log'](_0x2a87e9(0x1c1)+_0x5ed26c+':\x20'+_0x363fd3+_0x2a87e9(0x1ee)+_0x565c76);const _0x206455=await database_1['default']['shop'][_0x2a87e9(0x1ac)]({'where':{'id':_0x5ed26c},'select':{'id':!![],'name':!![],'username':!![],'status':!![]}});if(!_0x206455)throw new Error(_0x2a87e9(0x1b1));if(_0x206455[_0x2a87e9(0x1d2)]!==_0x2a87e9(0x183))throw new Error(_0x2a87e9(0x1cb));const _0x32a805=await database_1[_0x2a87e9(0x11d)]['payout'][_0x2a87e9(0x14d)]({'data':{'shopId':_0x5ed26c,'amount':_0x363fd3,'network':_0x565c76,'status':_0x2a87e9(0x111),'notes':_0x5a651c||null,'paidAt':new Date()},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});await this[_0x2a87e9(0x1e7)](_0x5ed26c,_0x363fd3);try{await telegramBotService_1['telegramBotService']['sendPayoutNotification'](_0x5ed26c,_0x32a805,_0x2a87e9(0x163));}catch(_0x42e84a){console[_0x2a87e9(0x1e8)](_0x2a87e9(0x1d9),_0x42e84a);}return console[_0x2a87e9(0x165)](_0x2a87e9(0x167)+_0x32a805['id']),{'id':_0x32a805['id'],'shopId':_0x32a805[_0x2a87e9(0x135)],'shopName':_0x32a805[_0x2a87e9(0x189)][_0x2a87e9(0x148)],'shopUsername':_0x32a805[_0x2a87e9(0x189)][_0x2a87e9(0x1b6)],'amount':_0x32a805[_0x2a87e9(0x1cf)],'network':_0x32a805[_0x2a87e9(0x1d0)],'status':_0x32a805['status'],'txid':_0x32a805[_0x2a87e9(0x169)],'notes':_0x32a805[_0x2a87e9(0x15a)],'createdAt':_0x32a805[_0x2a87e9(0x154)],'paidAt':_0x32a805[_0x2a87e9(0x153)]};}async[a33_0x4eb932(0x1e7)](_0x493e7d,_0x571cea){const _0x160ddd=a33_0x4eb932;console[_0x160ddd(0x165)](_0x160ddd(0x1db)+_0x493e7d+_0x160ddd(0x1d1)+_0x571cea+_0x160ddd(0x116));const _0xa6b064=await database_1['default']['payment']['findMany']({'where':{'shopId':_0x493e7d,'status':'PAID','merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'shop':{'select':{'gatewaySettings':!![]}}},'orderBy':{'paidAt':_0x160ddd(0x1a9)}});let _0x3d1da2=_0x571cea;const _0x3de13a=[];for(const _0x812bd1 of _0xa6b064){const _0x2d614e={..._0x812bd1,'status':_0x160ddd(0x120),'merchantPaid':![],'shop':{'gatewaySettings':_0x812bd1[_0x160ddd(0x189)][_0x160ddd(0x147)]}};if(!this['isEligibleForPayout'](_0x2d614e))continue;const _0x14b901=await currencyService_1[_0x160ddd(0x182)]['convertToUSDT'](_0x812bd1[_0x160ddd(0x1cf)],_0x812bd1[_0x160ddd(0x151)]),_0x447103=this[_0x160ddd(0x170)](_0x812bd1['shop'],_0x812bd1[_0x160ddd(0x1ce)]),_0x18231b=this[_0x160ddd(0x168)](_0x14b901,_0x447103[_0x160ddd(0x1be)]);if(_0x18231b<=_0x3d1da2){_0x3de13a['push'](_0x812bd1['id']),_0x3d1da2-=_0x18231b;if(_0x3d1da2<=0.01)break;}}_0x3de13a[_0x160ddd(0x13b)]>0x0&&(await database_1[_0x160ddd(0x11d)][_0x160ddd(0x18a)][_0x160ddd(0x171)]({'where':{'id':{'in':_0x3de13a}},'data':{'merchantPaid':!![]}}),console['log'](_0x160ddd(0x16d)+_0x3de13a['length']+_0x160ddd(0x19c)));}async[a33_0x4eb932(0x13e)](_0x663cf6){const _0x21438f=a33_0x4eb932,{page:_0xd8c151,limit:_0x3667e3,shopId:_0x509696,network:_0x312cf8,dateFrom:_0x3a265e,dateTo:_0x4f11c2,search:_0xaee075}=_0x663cf6,_0x449860=(_0xd8c151-0x1)*_0x3667e3;console['log'](_0x21438f(0x162),_0x663cf6);const _0x13dcf5={};_0x509696&&(_0x13dcf5[_0x21438f(0x135)]=_0x509696);_0x312cf8&&(_0x13dcf5[_0x21438f(0x1d0)]=_0x312cf8);(_0x3a265e||_0x4f11c2)&&(_0x13dcf5['createdAt']={},_0x3a265e&&(_0x13dcf5['createdAt'][_0x21438f(0x1a0)]=new Date(_0x3a265e)),_0x4f11c2&&(_0x13dcf5[_0x21438f(0x154)][_0x21438f(0x18c)]=new Date(_0x4f11c2)));_0xaee075&&(_0x13dcf5['OR']=[{'txid':{'contains':_0xaee075,'mode':_0x21438f(0x142)}},{'notes':{'contains':_0xaee075,'mode':_0x21438f(0x142)}},{'shop':{'name':{'contains':_0xaee075,'mode':_0x21438f(0x142)}}},{'shop':{'username':{'contains':_0xaee075,'mode':_0x21438f(0x142)}}}]);const [_0x35ce99,_0x38ca64]=await Promise[_0x21438f(0x192)]([database_1[_0x21438f(0x11d)]['payout']['findMany']({'where':_0x13dcf5,'skip':_0x449860,'take':_0x3667e3,'orderBy':{'createdAt':_0x21438f(0x1ae)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x21438f(0x11d)]['payout'][_0x21438f(0x13a)]({'where':_0x13dcf5})]);console[_0x21438f(0x165)](_0x21438f(0x187)+_0x35ce99['length']+_0x21438f(0x1de)+_0x38ca64+'\x20total');const _0x21ff33=_0x35ce99[_0x21438f(0x12c)](_0x352ef5=>({'id':_0x352ef5['id'],'shopId':_0x352ef5[_0x21438f(0x135)],'shopName':_0x352ef5['shop'][_0x21438f(0x148)],'shopUsername':_0x352ef5[_0x21438f(0x189)]['username'],'amount':_0x352ef5[_0x21438f(0x1cf)],'network':_0x352ef5[_0x21438f(0x1d0)],'status':_0x352ef5['status'],'txid':_0x352ef5['txid'],'notes':_0x352ef5[_0x21438f(0x15a)],'createdAt':_0x352ef5[_0x21438f(0x154)],'paidAt':_0x352ef5[_0x21438f(0x153)]}));return{'payouts':_0x21ff33,'pagination':{'page':_0xd8c151,'limit':_0x3667e3,'total':_0x38ca64,'totalPages':Math[_0x21438f(0x145)](_0x38ca64/_0x3667e3)}};}async[a33_0x4eb932(0x112)](_0x5d5d65){const _0x30516c=a33_0x4eb932;console[_0x30516c(0x165)]('🔍\x20Getting\x20payout\x20by\x20ID:\x20'+_0x5d5d65);const _0x11c374=await database_1[_0x30516c(0x11d)][_0x30516c(0x166)][_0x30516c(0x1ac)]({'where':{'id':_0x5d5d65},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x11c374)return console['log'](_0x30516c(0x1bd)+_0x5d5d65),null;return console[_0x30516c(0x165)]('✅\x20Found\x20payout:\x20'+_0x11c374[_0x30516c(0x1cf)]+_0x30516c(0x1ee)+_0x11c374['network']),{'id':_0x11c374['id'],'shopId':_0x11c374[_0x30516c(0x135)],'shopName':_0x11c374['shop'][_0x30516c(0x148)],'shopUsername':_0x11c374[_0x30516c(0x189)][_0x30516c(0x1b6)],'amount':_0x11c374[_0x30516c(0x1cf)],'network':_0x11c374[_0x30516c(0x1d0)],'status':_0x11c374[_0x30516c(0x1d2)],'txid':_0x11c374[_0x30516c(0x169)],'notes':_0x11c374['notes'],'createdAt':_0x11c374['createdAt'],'paidAt':_0x11c374[_0x30516c(0x153)]};}async[a33_0x4eb932(0x1f1)](_0x313ac7){const _0x1d66b3=a33_0x4eb932;console[_0x1d66b3(0x165)]('🗑️\x20Deleting\x20payout:\x20'+_0x313ac7);const _0x40513a=await database_1[_0x1d66b3(0x11d)][_0x1d66b3(0x166)][_0x1d66b3(0x1ac)]({'where':{'id':_0x313ac7},'select':{'id':!![],'shopId':!![],'amount':!![]}});if(!_0x40513a)throw new Error(_0x1d66b3(0x1c3));await database_1['default'][_0x1d66b3(0x166)]['delete']({'where':{'id':_0x313ac7}}),console[_0x1d66b3(0x165)](_0x1d66b3(0x14b)+_0x313ac7+_0x1d66b3(0x1a5));}async[a33_0x4eb932(0x11a)](_0x266d3c){const _0x26770f=a33_0x4eb932,{page:_0x51c5ac,limit:_0xf59774,minAmount:_0x39c8d8,search:_0x3326fc}=_0x266d3c;console['log'](_0x26770f(0x1e4),_0x266d3c);const _0x153df8=await database_1[_0x26770f(0x11d)][_0x26770f(0x18a)][_0x26770f(0x1ba)]({'where':{'status':_0x26770f(0x120),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'createdAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'gatewaySettings':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}});console[_0x26770f(0x165)](_0x26770f(0x16e)+_0x153df8[_0x26770f(0x13b)]+_0x26770f(0x1b0));const _0xa2516f=new Map();for(const _0x1d6576 of _0x153df8){const _0x259f91={..._0x1d6576,'status':_0x26770f(0x120),'merchantPaid':![],'shop':{'gatewaySettings':_0x1d6576[_0x26770f(0x189)][_0x26770f(0x147)]}},_0x37a705=this[_0x26770f(0x11f)](_0x259f91);if(!_0x37a705)continue;const _0x26516b=await currencyService_1[_0x26770f(0x182)]['convertToUSDT'](_0x1d6576[_0x26770f(0x1cf)],_0x1d6576[_0x26770f(0x151)]),_0x5f44d0=this[_0x26770f(0x170)](_0x1d6576[_0x26770f(0x189)],_0x1d6576['gateway']),_0x10e979=this[_0x26770f(0x168)](_0x26516b,_0x5f44d0['commission']),_0x420eb8=_0x1d6576[_0x26770f(0x135)];!_0xa2516f[_0x26770f(0x197)](_0x420eb8)&&_0xa2516f[_0x26770f(0x1af)](_0x420eb8,{'shop':_0x1d6576[_0x26770f(0x189)],'payments':[]}),_0xa2516f[_0x26770f(0x119)](_0x420eb8)['payments'][_0x26770f(0x1a7)]({'id':_0x1d6576['id'],'amount':_0x1d6576[_0x26770f(0x1cf)],'currency':_0x1d6576[_0x26770f(0x151)],'gateway':_0x1d6576[_0x26770f(0x1ce)],'paidAt':_0x1d6576['paidAt'],'createdAt':_0x1d6576[_0x26770f(0x154)],'amountUSDT':_0x26516b,'commission':_0x5f44d0[_0x26770f(0x1be)],'amountAfterCommissionUSDT':_0x10e979,'isEligible':!![]});}console[_0x26770f(0x165)]('🏪\x20Found\x20'+_0xa2516f[_0x26770f(0x12e)]+_0x26770f(0x1c9));const _0x39c4cf=[];for(const [_0x5f3d9f,_0x324d0a]of _0xa2516f){const {shop:_0x30e974,payments:_0x22a487}=_0x324d0a,_0x1eeb7a=_0x22a487[_0x26770f(0x1bc)]((_0x27528b,_0x36e531)=>_0x27528b+_0x36e531[_0x26770f(0x17f)],0x0),_0x2440db=_0x22a487['reduce']((_0x37136d,_0x931ab6)=>_0x37136d+_0x931ab6[_0x26770f(0x17b)],0x0);if(_0x39c8d8&&_0x2440db<_0x39c8d8)continue;if(_0x3326fc){const _0x1f9e30=_0x3326fc[_0x26770f(0x178)](),_0x5c79c3=_0x30e974[_0x26770f(0x148)][_0x26770f(0x178)]()['includes'](_0x1f9e30)||_0x30e974[_0x26770f(0x1b6)][_0x26770f(0x178)]()[_0x26770f(0x1d7)](_0x1f9e30)||_0x30e974['telegram']&&_0x30e974[_0x26770f(0x15d)][_0x26770f(0x178)]()['includes'](_0x1f9e30);if(!_0x5c79c3)continue;}const _0x579643=new Map();for(const _0x430d3e of _0x22a487){const _0x21d995=_0x430d3e[_0x26770f(0x1ce)];!_0x579643[_0x26770f(0x197)](_0x21d995)&&_0x579643[_0x26770f(0x1af)](_0x21d995,{'count':0x0,'amountUSDT':0x0,'amountAfterCommissionUSDT':0x0,'commission':_0x430d3e[_0x26770f(0x1be)]});const _0x3a467f=_0x579643[_0x26770f(0x119)](_0x21d995);_0x3a467f[_0x26770f(0x13a)]++,_0x3a467f[_0x26770f(0x17f)]+=_0x430d3e[_0x26770f(0x17f)],_0x3a467f['amountAfterCommissionUSDT']+=_0x430d3e[_0x26770f(0x17b)];}const _0x1039f3=Array[_0x26770f(0x195)](_0x579643['entries']())[_0x26770f(0x12c)](([_0x58b3da,_0x5032e5])=>({'gateway':_0x58b3da[_0x26770f(0x146)](0x0)[_0x26770f(0x1c0)]()+_0x58b3da['slice'](0x1),'count':_0x5032e5['count'],'amountUSDT':Math['round'](_0x5032e5[_0x26770f(0x17f)]*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x26770f(0x1dc)](_0x5032e5[_0x26770f(0x17b)]*0x64)/0x64,'commission':_0x5032e5[_0x26770f(0x1be)]})),_0x243197=_0x22a487[_0x26770f(0x1bc)]((_0xff2453,_0x4f1c1c)=>{const _0x4d9b46=_0x26770f;return _0x4f1c1c[_0x4d9b46(0x153)]<_0xff2453?_0x4f1c1c[_0x4d9b46(0x153)]:_0xff2453;},_0x22a487[0x0][_0x26770f(0x153)]);_0x39c4cf['push']({'id':_0x30e974['id'],'fullName':_0x30e974[_0x26770f(0x148)],'username':_0x30e974[_0x26770f(0x1b6)],'telegramId':_0x30e974[_0x26770f(0x15d)],'merchantUrl':_0x30e974['shopUrl'],'wallets':{'usdtPolygonWallet':_0x30e974['usdtPolygonWallet'],'usdtTrcWallet':_0x30e974[_0x26770f(0x157)],'usdtErcWallet':_0x30e974[_0x26770f(0x190)],'usdcPolygonWallet':_0x30e974[_0x26770f(0x199)]},'totalAmountUSDT':Math['round'](_0x1eeb7a*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x26770f(0x1dc)](_0x2440db*0x64)/0x64,'paymentsCount':_0x22a487[_0x26770f(0x13b)],'oldestPaymentDate':_0x243197,'gatewayBreakdown':_0x1039f3});}_0x39c4cf['sort']((_0x3f37da,_0x131a74)=>_0x131a74[_0x26770f(0x1cc)]-_0x3f37da['totalAmountAfterCommissionUSDT']);const _0x338b72=_0x39c4cf[_0x26770f(0x13b)],_0x366335=_0x39c4cf[_0x26770f(0x1bc)]((_0x2c8377,_0x304358)=>_0x2c8377+_0x304358[_0x26770f(0x196)],0x0),_0x580018=_0x39c4cf[_0x26770f(0x1bc)]((_0x23ad1b,_0x2793da)=>_0x23ad1b+_0x2793da[_0x26770f(0x1cc)],0x0),_0x52f4b2=(_0x51c5ac-0x1)*_0xf59774,_0x4a6091=_0x39c4cf[_0x26770f(0x127)](_0x52f4b2,_0x52f4b2+_0xf59774);return console['log'](_0x26770f(0x124)+_0x4a6091['length']+_0x26770f(0x18f)+_0x338b72+_0x26770f(0x19a)),console[_0x26770f(0x165)](_0x26770f(0x1c2)+_0x366335[_0x26770f(0x130)](0x2)+_0x26770f(0x156)+_0x580018[_0x26770f(0x130)](0x2)+_0x26770f(0x175)),{'merchants':_0x4a6091,'pagination':{'page':_0x51c5ac,'limit':_0xf59774,'total':_0x338b72,'totalPages':Math[_0x26770f(0x145)](_0x338b72/_0xf59774)},'summary':{'totalMerchants':_0x338b72,'totalAmountUSDT':Math[_0x26770f(0x1dc)](_0x366335*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x26770f(0x1dc)](_0x580018*0x64)/0x64}};}async[a33_0x4eb932(0x18d)](){const _0x50a623=a33_0x4eb932;console[_0x50a623(0x165)](_0x50a623(0x193));const _0x526af3=await database_1['default']['payment'][_0x50a623(0x1ba)]({'where':{'status':{'in':[_0x50a623(0x120),_0x50a623(0x12d),_0x50a623(0x115)]}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'status':!![],'gateway':!![],'paidAt':!![],'merchantPaid':!![],'createdAt':!![],'chargebackAmount':!![],'shop':{'select':{'gatewaySettings':!![]}}}});console[_0x50a623(0x165)](_0x50a623(0x16e)+_0x526af3[_0x50a623(0x13b)]+_0x50a623(0x1c7));const _0xdee5a9=new Date(),_0x53fae8=new Date(_0xdee5a9[_0x50a623(0x141)](),_0xdee5a9['getMonth'](),0x1),_0x2a39aa=new Date(_0xdee5a9['getFullYear'](),_0xdee5a9[_0x50a623(0x138)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7);let _0x54b44d=0x0,_0x10309f=0x0,_0x4cb0a0=0x0,_0x1e25bf=0x0;for(const _0x560a47 of _0x526af3){const _0x44f29d=this[_0x50a623(0x1e2)](_0x560a47);if(_0x44f29d===0x0)continue;let _0x5663cc,_0x368b60;if(_0x560a47[_0x50a623(0x1d2)]==='CHARGEBACK')_0x5663cc=Math[_0x50a623(0x117)](_0x44f29d),_0x368b60=-_0x5663cc;else{_0x5663cc=await currencyService_1[_0x50a623(0x182)][_0x50a623(0x158)](_0x560a47[_0x50a623(0x1cf)],_0x560a47['currency']);const _0x1c6dd2=this['getGatewaySettings'](_0x560a47[_0x50a623(0x189)],_0x560a47['gateway']);_0x368b60=this[_0x50a623(0x168)](_0x5663cc,_0x1c6dd2[_0x50a623(0x1be)]);}_0x560a47[_0x50a623(0x134)]&&(_0x54b44d+=_0x368b60,_0x560a47[_0x50a623(0x153)]&&_0x560a47['paidAt']>=_0x53fae8&&_0x560a47[_0x50a623(0x153)]<=_0x2a39aa&&(_0x4cb0a0+=_0x368b60)),_0x560a47[_0x50a623(0x1d2)]===_0x50a623(0x120)&&this['isEligibleForPayout'](_0x560a47)&&(_0x10309f+=_0x368b60,_0x1e25bf+=_0x5663cc);}const _0x55e739={'totalPayout':Math[_0x50a623(0x1dc)](_0x54b44d*0x64)/0x64,'awaitingPayout':Math[_0x50a623(0x1dc)](_0x10309f*0x64)/0x64,'thisMonth':Math[_0x50a623(0x1dc)](_0x4cb0a0*0x64)/0x64,'availableBalance':Math[_0x50a623(0x1dc)](_0x1e25bf*0x64)/0x64};return console[_0x50a623(0x165)](_0x50a623(0x1ea)),console['log'](_0x50a623(0x176)+_0x55e739[_0x50a623(0x188)]+_0x50a623(0x1e9)),console[_0x50a623(0x165)](_0x50a623(0x1d4)+_0x55e739[_0x50a623(0x17d)]+_0x50a623(0x180)),console[_0x50a623(0x165)](_0x50a623(0x1b7)+_0x55e739['thisMonth']+_0x50a623(0x116)),console['log'](_0x50a623(0x164)+_0x55e739['availableBalance']+_0x50a623(0x116)),_0x55e739;}async[a33_0x4eb932(0x152)](_0x395505){const _0x59a497=a33_0x4eb932,_0x1323a0=this['getPeriodDays'](_0x395505),_0x238ce9=new Date();_0x238ce9['setDate'](_0x238ce9['getDate']()-_0x1323a0),console['log'](_0x59a497(0x1b5)+_0x395505+'\x20('+_0x1323a0+_0x59a497(0x13d));const _0x3cef36=await database_1[_0x59a497(0x11d)][_0x59a497(0x189)]['count']({'where':{'status':_0x59a497(0x183)}}),_0x4560c7=await database_1['default']['payment']['count'](),_0x75d87f=await database_1['default'][_0x59a497(0x18a)]['findMany']({'where':{'status':{'in':[_0x59a497(0x120),_0x59a497(0x12d),_0x59a497(0x115)]}},'select':{'amount':!![],'currency':!![],'status':!![],'chargebackAmount':!![],'createdAt':!![]}});console[_0x59a497(0x165)]('💰\x20Found\x20'+_0x75d87f[_0x59a497(0x13b)]+_0x59a497(0x1e3));const _0x45dc4a=await Promise[_0x59a497(0x192)](_0x75d87f[_0x59a497(0x12c)](async _0x8da4bb=>{const _0x9f34a9=_0x59a497,_0x3f3978=this[_0x9f34a9(0x1e2)](_0x8da4bb);if(_0x3f3978===0x0)return{'amount':0x0,'createdAt':_0x8da4bb['createdAt']};let _0xa48379;return _0x8da4bb[_0x9f34a9(0x1d2)]===_0x9f34a9(0x115)?_0xa48379=-Math[_0x9f34a9(0x117)](_0x3f3978):_0xa48379=await currencyService_1[_0x9f34a9(0x182)][_0x9f34a9(0x158)](_0x8da4bb[_0x9f34a9(0x1cf)],_0x8da4bb['currency']),{'amount':_0xa48379,'createdAt':_0x8da4bb[_0x9f34a9(0x154)]};})),_0x3380b7=_0x45dc4a['reduce']((_0x2e6b5b,_0x7e4b4c)=>_0x2e6b5b+_0x7e4b4c[_0x59a497(0x1cf)],0x0),_0x40b547=_0x4560c7>0x0?_0x3380b7/_0x4560c7:0x0;console[_0x59a497(0x165)](_0x59a497(0x16c)+_0x3380b7[_0x59a497(0x130)](0x2)+_0x59a497(0x1e9)),console[_0x59a497(0x165)](_0x59a497(0x16f)+_0x40b547['toFixed'](0x2)+_0x59a497(0x116));const _0x4adaca=await database_1[_0x59a497(0x11d)]['$queryRaw']`
      SELECT 
        DATE(created_at) as date,
        array_agg(
          json_build_object(
            'amount', amount,
            'currency', currency,
            'status', status,
            'chargeback_amount', chargeback_amount
          )
        ) as payments
      FROM payments 
      WHERE created_at >= ${_0x238ce9}
        AND status IN ('PAID', 'REFUND', 'CHARGEBACK')
      GROUP BY DATE(created_at)
      ORDER BY date ASC
    `;console[_0x59a497(0x165)](_0x59a497(0x1ad)+_0x4adaca[_0x59a497(0x13b)]+_0x59a497(0x15b));const _0x1e9d64=await Promise['all'](_0x4adaca['map'](async _0x1bb6c8=>{const _0x1377a4=_0x59a497,_0x4b90c9=await Promise[_0x1377a4(0x192)](_0x1bb6c8[_0x1377a4(0x155)][_0x1377a4(0x12c)](async _0x135e75=>{const _0x5a37ac=_0x1377a4,_0x44bc6f=this[_0x5a37ac(0x1e2)](_0x135e75);if(_0x44bc6f===0x0)return 0x0;return _0x135e75[_0x5a37ac(0x1d2)]==='CHARGEBACK'?-Math[_0x5a37ac(0x117)](_0x44bc6f):await currencyService_1[_0x5a37ac(0x182)][_0x5a37ac(0x158)](_0x135e75[_0x5a37ac(0x1cf)],_0x135e75[_0x5a37ac(0x151)]);})),_0x5e0d4c=_0x4b90c9[_0x1377a4(0x1bc)]((_0xf8d3cb,_0x33475e)=>_0xf8d3cb+_0x33475e,0x0);return{'date':_0x1bb6c8[_0x1377a4(0x179)][_0x1377a4(0x11b)]()['split']('T')[0x0],'amount':_0x5e0d4c};})),_0x270165=this[_0x59a497(0x1c6)](_0x238ce9,new Date()),_0x46d822=new Map(_0x1e9d64[_0x59a497(0x12c)](_0x249484=>[_0x249484[_0x59a497(0x179)],_0x249484[_0x59a497(0x1cf)]])),_0x568e97=_0x270165[_0x59a497(0x12c)](_0x2d5c9e=>({'date':_0x2d5c9e,'amount':_0x46d822[_0x59a497(0x119)](_0x2d5c9e)||0x0}));return console[_0x59a497(0x165)]('✅\x20Admin\x20statistics\x20generated\x20successfully'),console[_0x59a497(0x165)](_0x59a497(0x1bf)+_0x3cef36),console[_0x59a497(0x165)](_0x59a497(0x1d6)+_0x4560c7),console[_0x59a497(0x165)](_0x59a497(0x15e)+_0x568e97['length']),{'totalRevenue':Math[_0x59a497(0x1dc)](_0x3380b7*0x64)/0x64,'totalUsers':_0x3cef36,'totalPayments':_0x4560c7,'averagePayment':Math[_0x59a497(0x1dc)](_0x40b547*0x64)/0x64,'dailyRevenue':_0x568e97};}async[a33_0x4eb932(0x14c)](_0x32c973){const _0x2159db=a33_0x4eb932,{page:_0x42e7fc,limit:_0x400517,status:_0x1f3e2f,gateway:_0x209fbb,shopId:_0x1aa5d5,dateFrom:_0x1d285b,dateTo:_0x4c19f6,search:_0x30d719}=_0x32c973,_0x112f33=(_0x42e7fc-0x1)*_0x400517;console[_0x2159db(0x165)]('📋\x20Getting\x20payments\x20with\x20filters:',_0x32c973);const _0x4f43ba={};_0x1f3e2f&&(_0x4f43ba[_0x2159db(0x1d2)]=_0x1f3e2f[_0x2159db(0x1c0)]());if(_0x209fbb){if((0x0,gateway_1['isValidGatewayId'])(_0x209fbb)){const _0x4fded4=(0x0,gateway_1[_0x2159db(0x1b4)])(_0x209fbb);_0x4fded4&&(_0x4f43ba[_0x2159db(0x1ce)]=_0x4fded4);}else _0x4f43ba['gateway']=_0x209fbb[_0x2159db(0x178)]();}_0x1aa5d5&&(_0x4f43ba[_0x2159db(0x135)]=_0x1aa5d5);(_0x1d285b||_0x4c19f6)&&(_0x4f43ba[_0x2159db(0x154)]={},_0x1d285b&&(_0x4f43ba[_0x2159db(0x154)]['gte']=new Date(_0x1d285b)),_0x4c19f6&&(_0x4f43ba[_0x2159db(0x154)]['lte']=new Date(_0x4c19f6)));_0x30d719&&(_0x4f43ba['OR']=[{'orderId':{'contains':_0x30d719,'mode':_0x2159db(0x142)}},{'gatewayOrderId':{'contains':_0x30d719,'mode':_0x2159db(0x142)}},{'gatewayPaymentId':{'contains':_0x30d719,'mode':'insensitive'}},{'customerEmail':{'contains':_0x30d719,'mode':_0x2159db(0x142)}},{'customerName':{'contains':_0x30d719,'mode':_0x2159db(0x142)}},{'shop':{'name':{'contains':_0x30d719,'mode':_0x2159db(0x142)}}},{'shop':{'username':{'contains':_0x30d719,'mode':_0x2159db(0x142)}}}]);const [_0x23898a,_0x2a5545]=await Promise[_0x2159db(0x192)]([database_1[_0x2159db(0x11d)][_0x2159db(0x18a)][_0x2159db(0x1ba)]({'where':_0x4f43ba,'skip':_0x112f33,'take':_0x400517,'orderBy':{'createdAt':_0x2159db(0x1ae)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x2159db(0x11d)][_0x2159db(0x18a)][_0x2159db(0x13a)]({'where':_0x4f43ba})]);console[_0x2159db(0x165)](_0x2159db(0x187)+_0x23898a[_0x2159db(0x13b)]+_0x2159db(0x132)+_0x2a5545+_0x2159db(0x19a));const _0x28581d=_0x23898a['map'](_0x4bbf75=>({'id':_0x4bbf75['id'],'shopId':_0x4bbf75[_0x2159db(0x135)],'shopName':_0x4bbf75['shop'][_0x2159db(0x148)],'shopUsername':_0x4bbf75['shop']['username'],'gateway':_0x4bbf75[_0x2159db(0x1ce)],'orderId':_0x4bbf75[_0x2159db(0x15c)],'gatewayOrderId':_0x4bbf75[_0x2159db(0x1bb)],'amount':_0x4bbf75[_0x2159db(0x1cf)],'currency':_0x4bbf75['currency'],'sourceCurrency':_0x4bbf75[_0x2159db(0x177)],'status':_0x4bbf75[_0x2159db(0x1d2)],'usage':_0x4bbf75[_0x2159db(0x17a)],'externalPaymentUrl':_0x4bbf75[_0x2159db(0x136)],'gatewayPaymentId':_0x4bbf75[_0x2159db(0x1da)],'customerEmail':_0x4bbf75[_0x2159db(0x1c4)],'customerName':_0x4bbf75[_0x2159db(0x1e6)],'cardLast4':_0x4bbf75[_0x2159db(0x18b)],'paymentMethod':_0x4bbf75[_0x2159db(0x1a2)],'bankId':_0x4bbf75[_0x2159db(0x1ca)],'remitterIban':_0x4bbf75['remitterIban'],'remitterName':_0x4bbf75[_0x2159db(0x137)],'chargebackAmount':_0x4bbf75[_0x2159db(0x1dd)],'adminNotes':_0x4bbf75[_0x2159db(0x1c5)],'statusChangedBy':_0x4bbf75['statusChangedBy'],'statusChangedAt':_0x4bbf75['statusChangedAt'],'createdAt':_0x4bbf75['createdAt'],'updatedAt':_0x4bbf75[_0x2159db(0x194)],'expiresAt':_0x4bbf75[_0x2159db(0x144)]}));return{'payments':_0x28581d,'pagination':{'page':_0x42e7fc,'limit':_0x400517,'total':_0x2a5545,'totalPages':Math['ceil'](_0x2a5545/_0x400517)}};}async[a33_0x4eb932(0x14f)](_0x4ea6d1){const _0x461e87=a33_0x4eb932;console[_0x461e87(0x165)](_0x461e87(0x1ef)+_0x4ea6d1);const _0x22258a=await database_1['default'][_0x461e87(0x18a)][_0x461e87(0x1ac)]({'where':{'id':_0x4ea6d1},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}},'webhookLogs':{'orderBy':{'createdAt':'desc'},'take':0xa,'select':{'id':!![],'event':!![],'statusCode':!![],'retryCount':!![],'createdAt':!![]}}}});if(!_0x22258a)return console[_0x461e87(0x165)](_0x461e87(0x1a1)+_0x4ea6d1),null;return console[_0x461e87(0x165)]('✅\x20Found\x20payment:\x20'+_0x22258a[_0x461e87(0x15c)]+'\x20('+_0x22258a[_0x461e87(0x1d2)]+')'),{'id':_0x22258a['id'],'shopId':_0x22258a[_0x461e87(0x135)],'shopName':_0x22258a[_0x461e87(0x189)][_0x461e87(0x148)],'shopUsername':_0x22258a[_0x461e87(0x189)]['username'],'gateway':_0x22258a[_0x461e87(0x1ce)],'orderId':_0x22258a['orderId'],'gatewayOrderId':_0x22258a[_0x461e87(0x1bb)],'amount':_0x22258a['amount'],'currency':_0x22258a[_0x461e87(0x151)],'sourceCurrency':_0x22258a[_0x461e87(0x177)],'status':_0x22258a[_0x461e87(0x1d2)],'usage':_0x22258a[_0x461e87(0x17a)],'externalPaymentUrl':_0x22258a['externalPaymentUrl'],'gatewayPaymentId':_0x22258a['gatewayPaymentId'],'customerEmail':_0x22258a['customerEmail'],'customerName':_0x22258a[_0x461e87(0x1e6)],'cardLast4':_0x22258a[_0x461e87(0x18b)],'paymentMethod':_0x22258a['paymentMethod'],'bankId':_0x22258a[_0x461e87(0x1ca)],'remitterIban':_0x22258a['remitterIban'],'remitterName':_0x22258a[_0x461e87(0x137)],'chargebackAmount':_0x22258a['chargebackAmount'],'adminNotes':_0x22258a['adminNotes'],'statusChangedBy':_0x22258a['statusChangedBy'],'statusChangedAt':_0x22258a[_0x461e87(0x121)],'createdAt':_0x22258a[_0x461e87(0x154)],'updatedAt':_0x22258a[_0x461e87(0x194)],'expiresAt':_0x22258a[_0x461e87(0x144)],'webhookLogs':_0x22258a[_0x461e87(0x1ed)]};}async[a33_0x4eb932(0x13c)](_0x5c34df,_0xfe38b3,_0x3352ee,_0x42f75a){const _0x4d3549=a33_0x4eb932;console[_0x4d3549(0x165)](_0x4d3549(0x184)+_0x5c34df+_0x4d3549(0x185)+_0xfe38b3);const _0x5e749c=[_0x4d3549(0x11c),_0x4d3549(0x120),_0x4d3549(0x126),_0x4d3549(0x133),_0x4d3549(0x12d),_0x4d3549(0x115)];if(!_0x5e749c['includes'](_0xfe38b3[_0x4d3549(0x1c0)]()))throw new Error('Invalid\x20status.\x20Valid\x20statuses:\x20'+_0x5e749c[_0x4d3549(0x15f)](',\x20'));const _0x4a5608=await database_1[_0x4d3549(0x11d)][_0x4d3549(0x18a)][_0x4d3549(0x1ac)]({'where':{'id':_0x5c34df},'select':{'id':!![],'status':!![],'orderId':!![]}});if(!_0x4a5608)throw new Error(_0x4d3549(0x123));if(_0xfe38b3['toUpperCase']()===_0x4d3549(0x115)){if(!_0x42f75a||_0x42f75a<=0x0)throw new Error(_0x4d3549(0x161));console[_0x4d3549(0x165)](_0x4d3549(0x159)+_0x42f75a+_0x4d3549(0x19f));}const _0x25985b={'status':_0xfe38b3[_0x4d3549(0x1c0)](),'updatedAt':new Date(),'statusChangedBy':_0x4d3549(0x12b),'statusChangedAt':new Date()};_0x3352ee&&(_0x25985b[_0x4d3549(0x1c5)]=_0x3352ee);_0xfe38b3[_0x4d3549(0x1c0)]()===_0x4d3549(0x115)&&_0x42f75a&&(_0x25985b['chargebackAmount']=_0x42f75a);const _0x4bd899=await database_1[_0x4d3549(0x11d)]['payment'][_0x4d3549(0x149)]({'where':{'id':_0x5c34df},'data':_0x25985b,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});return await database_1[_0x4d3549(0x11d)][_0x4d3549(0x191)][_0x4d3549(0x14d)]({'data':{'paymentId':_0x5c34df,'shopId':_0x4bd899['shopId'],'event':_0x4d3549(0x1aa),'statusCode':0xc8,'responseBody':JSON[_0x4d3549(0x1a3)]({'oldStatus':_0x4a5608[_0x4d3549(0x1d2)],'newStatus':_0xfe38b3['toUpperCase'](),'notes':_0x3352ee||null,'chargebackAmount':_0x42f75a||null,'updatedBy':'admin','timestamp':new Date()[_0x4d3549(0x11b)]()})}}),console[_0x4d3549(0x165)](_0x4d3549(0x19e)+_0x4a5608[_0x4d3549(0x15c)]+_0x4d3549(0x1df)+_0x4a5608[_0x4d3549(0x1d2)]+_0x4d3549(0x19b)+_0xfe38b3['toUpperCase']()),_0xfe38b3['toUpperCase']()===_0x4d3549(0x115)&&console[_0x4d3549(0x165)](_0x4d3549(0x1b8)+_0x42f75a+'\x20USDT\x20(will\x20be\x20deducted\x20from\x20merchant\x20balance)'),{'id':_0x4bd899['id'],'shopId':_0x4bd899[_0x4d3549(0x135)],'shopName':_0x4bd899['shop']['name'],'shopUsername':_0x4bd899['shop'][_0x4d3549(0x1b6)],'gateway':_0x4bd899[_0x4d3549(0x1ce)],'orderId':_0x4bd899[_0x4d3549(0x15c)],'gatewayOrderId':_0x4bd899[_0x4d3549(0x1bb)],'amount':_0x4bd899[_0x4d3549(0x1cf)],'currency':_0x4bd899[_0x4d3549(0x151)],'sourceCurrency':_0x4bd899[_0x4d3549(0x177)],'status':_0x4bd899[_0x4d3549(0x1d2)],'usage':_0x4bd899[_0x4d3549(0x17a)],'externalPaymentUrl':_0x4bd899[_0x4d3549(0x136)],'gatewayPaymentId':_0x4bd899['gatewayPaymentId'],'customerEmail':_0x4bd899[_0x4d3549(0x1c4)],'customerName':_0x4bd899[_0x4d3549(0x1e6)],'cardLast4':_0x4bd899[_0x4d3549(0x18b)],'paymentMethod':_0x4bd899[_0x4d3549(0x1a2)],'bankId':_0x4bd899[_0x4d3549(0x1ca)],'remitterIban':_0x4bd899[_0x4d3549(0x17c)],'remitterName':_0x4bd899[_0x4d3549(0x137)],'chargebackAmount':_0x4bd899[_0x4d3549(0x1dd)],'adminNotes':_0x4bd899[_0x4d3549(0x1c5)],'statusChangedBy':_0x4bd899[_0x4d3549(0x1e1)],'statusChangedAt':_0x4bd899[_0x4d3549(0x121)],'createdAt':_0x4bd899[_0x4d3549(0x154)],'updatedAt':_0x4bd899['updatedAt'],'expiresAt':_0x4bd899[_0x4d3549(0x144)]};}async['getAllUsers'](_0x3491db){const _0x364554=a33_0x4eb932,{page:_0x4e1f96,limit:_0x4489bb,status:_0x129d8e}=_0x3491db,_0x29c4ee=(_0x4e1f96-0x1)*_0x4489bb,_0x3078b3={};_0x129d8e&&(_0x3078b3[_0x364554(0x1d2)]=_0x129d8e[_0x364554(0x1c0)]());console[_0x364554(0x165)]('📋\x20Getting\x20users\x20with\x20filters:',{'page':_0x4e1f96,'limit':_0x4489bb,'status':_0x129d8e,'where':_0x3078b3});const [_0xfdecc2,_0x457ad3]=await Promise['all']([database_1[_0x364554(0x11d)][_0x364554(0x189)]['findMany']({'where':_0x3078b3,'skip':_0x29c4ee,'take':_0x4489bb,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x364554(0x1ae)}}),database_1[_0x364554(0x11d)][_0x364554(0x189)][_0x364554(0x13a)]({'where':_0x3078b3})]);console[_0x364554(0x165)](_0x364554(0x187)+_0xfdecc2['length']+_0x364554(0x11e)+_0x457ad3+_0x364554(0x19a));const _0x55f143=_0xfdecc2['map'](_0x295d5a=>({'id':_0x295d5a['id'],'fullName':_0x295d5a[_0x364554(0x148)],'username':_0x295d5a[_0x364554(0x1b6)],'telegramId':_0x295d5a[_0x364554(0x15d)],'merchantUrl':_0x295d5a[_0x364554(0x125)],'gateways':_0x295d5a[_0x364554(0x118)]?JSON[_0x364554(0x128)](_0x295d5a['paymentGateways']):null,'gatewaySettings':_0x295d5a[_0x364554(0x147)]?JSON[_0x364554(0x128)](_0x295d5a[_0x364554(0x147)]):null,'publicKey':_0x295d5a['publicKey'],'wallets':{'usdtPolygonWallet':_0x295d5a['usdtPolygonWallet'],'usdtTrcWallet':_0x295d5a[_0x364554(0x157)],'usdtErcWallet':_0x295d5a[_0x364554(0x190)],'usdcPolygonWallet':_0x295d5a[_0x364554(0x199)]},'status':_0x295d5a[_0x364554(0x1d2)],'createdAt':_0x295d5a['createdAt']}));return{'users':_0x55f143,'pagination':{'page':_0x4e1f96,'limit':_0x4489bb,'total':_0x457ad3,'totalPages':Math[_0x364554(0x145)](_0x457ad3/_0x4489bb)}};}async[a33_0x4eb932(0x1ec)](_0x4d6b0c){const _0x305108=a33_0x4eb932;return await this['userService'][_0x305108(0x1ec)](_0x4d6b0c);}async[a33_0x4eb932(0x1a6)](_0x1c4b23){const _0x514036=a33_0x4eb932;return await this[_0x514036(0x1ab)][_0x514036(0x1a6)](_0x1c4b23);}async[a33_0x4eb932(0x1d8)](_0x14c6c1,_0x5de926){const _0x39ffd0=a33_0x4eb932;return await this[_0x39ffd0(0x1ab)][_0x39ffd0(0x1d8)](_0x14c6c1,_0x5de926);}async['deleteUser'](_0x58e1f8){const _0x2bfb99=a33_0x4eb932;return await this[_0x2bfb99(0x1ab)][_0x2bfb99(0x17e)](_0x58e1f8);}async[a33_0x4eb932(0x174)](_0x35f711){const _0x23483c=a33_0x4eb932;console[_0x23483c(0x165)](_0x23483c(0x143)+_0x35f711);const _0x137f74=await database_1[_0x23483c(0x11d)][_0x23483c(0x189)][_0x23483c(0x1ac)]({'where':{'id':_0x35f711},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x137f74)throw new Error(_0x23483c(0x114));if(_0x137f74[_0x23483c(0x1d2)]===_0x23483c(0x14a))throw new Error('User\x20is\x20already\x20suspended');const _0x365e26=await this[_0x23483c(0x1ab)][_0x23483c(0x1d8)](_0x35f711,{'status':_0x23483c(0x14a)});return console[_0x23483c(0x165)](_0x23483c(0x18e)+_0x137f74[_0x23483c(0x1b6)]+_0x23483c(0x1d3)),_0x365e26;}async[a33_0x4eb932(0x16a)](_0x390e87){const _0x5ae860=a33_0x4eb932;console[_0x5ae860(0x165)](_0x5ae860(0x110)+_0x390e87);const _0xbc8014=await database_1[_0x5ae860(0x11d)][_0x5ae860(0x189)]['findUnique']({'where':{'id':_0x390e87},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0xbc8014)throw new Error('User\x20not\x20found');if(_0xbc8014[_0x5ae860(0x1d2)]===_0x5ae860(0x183))throw new Error(_0x5ae860(0x139));const _0x45ac5f=await this['userService']['updateUser'](_0x390e87,{'status':_0x5ae860(0x183)});return console[_0x5ae860(0x165)](_0x5ae860(0x18e)+_0xbc8014[_0x5ae860(0x1b6)]+_0x5ae860(0x122)),_0x45ac5f;}}exports[a33_0x4eb932(0x1f0)]=AdminService;