'use strict';const a33_0x36eff5=a33_0x524e;function a33_0x524e(_0x1e00aa,_0x19dffe){const _0x7d369b=a33_0x7d36();return a33_0x524e=function(_0x524ebd,_0x58202e){_0x524ebd=_0x524ebd-0x18a;let _0x34e0dc=_0x7d369b[_0x524ebd];return _0x34e0dc;},a33_0x524e(_0x1e00aa,_0x19dffe);}(function(_0x287689,_0x2a399d){const _0xbd14cf=a33_0x524e,_0x529e2c=_0x287689();while(!![]){try{const _0x488f70=parseInt(_0xbd14cf(0x1e7))/0x1*(parseInt(_0xbd14cf(0x206))/0x2)+-parseInt(_0xbd14cf(0x234))/0x3*(-parseInt(_0xbd14cf(0x1c2))/0x4)+-parseInt(_0xbd14cf(0x18c))/0x5+parseInt(_0xbd14cf(0x1dd))/0x6*(parseInt(_0xbd14cf(0x218))/0x7)+parseInt(_0xbd14cf(0x229))/0x8*(parseInt(_0xbd14cf(0x204))/0x9)+-parseInt(_0xbd14cf(0x1fe))/0xa+parseInt(_0xbd14cf(0x1d3))/0xb*(-parseInt(_0xbd14cf(0x19c))/0xc);if(_0x488f70===_0x2a399d)break;else _0x529e2c['push'](_0x529e2c['shift']());}catch(_0x3df17a){_0x529e2c['push'](_0x529e2c['shift']());}}}(a33_0x7d36,0x4d0f8));var __importDefault=this&&this[a33_0x36eff5(0x21d)]||function(_0x4e9053){const _0x13889c=a33_0x36eff5;return _0x4e9053&&_0x4e9053[_0x13889c(0x20d)]?_0x4e9053:{'default':_0x4e9053};};Object[a33_0x36eff5(0x191)](exports,a33_0x36eff5(0x20d),{'value':!![]}),exports['AdminService']=void 0x0;const database_1=__importDefault(require(a33_0x36eff5(0x1ce))),bcryptjs_1=__importDefault(require(a33_0x36eff5(0x1cd))),crypto_1=__importDefault(require('crypto')),currencyService_1=require('./currencyService');class AdminService{async[a33_0x36eff5(0x1af)](_0x40c1a6){const _0x477eba=a33_0x36eff5;console[_0x477eba(0x1ff)](_0x477eba(0x207),_0x40c1a6);let _0x222691,_0x3671c0;const _0x31b41e=new Date();switch(_0x40c1a6['period']){case _0x477eba(0x21a):_0x222691=new Date(_0x477eba(0x210)),_0x3671c0=_0x31b41e;break;case'year':_0x222691=new Date(_0x31b41e[_0x477eba(0x1ae)](),0x0,0x1),_0x3671c0=_0x31b41e;break;case'month':_0x222691=new Date(_0x31b41e[_0x477eba(0x1ae)](),_0x31b41e['getMonth'](),0x1),_0x3671c0=_0x31b41e;break;case _0x477eba(0x1b7):const _0x263610=new Date(_0x31b41e);_0x263610['setDate'](_0x31b41e[_0x477eba(0x19b)]()-_0x31b41e[_0x477eba(0x217)]()),_0x263610['setHours'](0x0,0x0,0x0,0x0),_0x222691=_0x263610,_0x3671c0=_0x31b41e;break;case _0x477eba(0x1ec):if(!_0x40c1a6[_0x477eba(0x236)]||!_0x40c1a6['dateTo'])throw new Error(_0x477eba(0x1d2));_0x222691=new Date(_0x40c1a6[_0x477eba(0x236)]),_0x3671c0=new Date(_0x40c1a6[_0x477eba(0x1a9)]);break;default:_0x222691=new Date(_0x31b41e[_0x477eba(0x1ae)](),_0x31b41e['getMonth'](),0x1),_0x3671c0=_0x31b41e;break;}console['log'](_0x477eba(0x1fa)+_0x222691[_0x477eba(0x1fc)]()+_0x477eba(0x194)+_0x3671c0[_0x477eba(0x1fc)]());const _0x2109f0=await database_1[_0x477eba(0x1ac)]['payment'][_0x477eba(0x1cb)]({'where':{'createdAt':{'gte':_0x222691,'lte':_0x3671c0},..._0x40c1a6[_0x477eba(0x1cc)]&&{'shopId':_0x40c1a6[_0x477eba(0x1cc)]}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'gateway':!![],'status':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console['log'](_0x477eba(0x1f2)+_0x2109f0[_0x477eba(0x235)]+_0x477eba(0x19a));const _0x5c3910=_0x2109f0['filter'](_0x75e9cd=>_0x75e9cd['status']===_0x477eba(0x214));console['log']('ðŸ’°\x20Found\x20'+_0x5c3910['length']+_0x477eba(0x1ab));const _0x49a3c1={'status':_0x477eba(0x1e0),'paidAt':{'gte':_0x222691,'lte':_0x3671c0}};_0x40c1a6[_0x477eba(0x1cc)]&&(_0x49a3c1[_0x477eba(0x1cc)]=_0x40c1a6[_0x477eba(0x1cc)]);const _0x527a56=await database_1[_0x477eba(0x1ac)]['payout'][_0x477eba(0x1cb)]({'where':_0x49a3c1,'select':{'shopId':!![],'amount':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console[_0x477eba(0x1ff)](_0x477eba(0x208)+_0x527a56[_0x477eba(0x235)]+_0x477eba(0x1a8));let _0x10a300=0x0,_0x1b75db=0x0;const _0x2f876a={},_0x905841={},_0x4b9643={};for(const _0x2518d2 of _0x5c3910){const _0x5e2993=await currencyService_1['currencyService'][_0x477eba(0x1c8)](_0x2518d2[_0x477eba(0x1a1)],_0x2518d2['currency']);_0x10a300+=_0x5e2993;let _0x49ddfd=0xa;if(_0x2518d2[_0x477eba(0x222)][_0x477eba(0x215)])try{const _0x14b8b5=JSON[_0x477eba(0x1b5)](_0x2518d2[_0x477eba(0x222)]['gatewaySettings']),_0x5514fe=this[_0x477eba(0x1a4)](_0x2518d2[_0x477eba(0x1ef)]);_0x14b8b5[_0x5514fe]?.[_0x477eba(0x1f4)]!==undefined&&(_0x49ddfd=_0x14b8b5[_0x5514fe]['commission']);}catch(_0x40e268){console['error'](_0x477eba(0x213),_0x40e268);}const _0x460af6=_0x5e2993*(_0x49ddfd/0x64),_0x57e6dc=_0x5e2993-_0x460af6;_0x1b75db+=_0x460af6;!_0x2f876a[_0x2518d2[_0x477eba(0x1ef)]]&&(_0x2f876a[_0x2518d2[_0x477eba(0x1ef)]]={'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0,'paymentsWithCommission':0x0});_0x2f876a[_0x2518d2[_0x477eba(0x1ef)]][_0x477eba(0x1ed)]++,_0x2f876a[_0x2518d2[_0x477eba(0x1ef)]][_0x477eba(0x1e6)]+=_0x5e2993,_0x2f876a[_0x2518d2[_0x477eba(0x1ef)]][_0x477eba(0x1d4)]+=_0x460af6,_0x2f876a[_0x2518d2['gateway']][_0x477eba(0x192)]+=_0x57e6dc,_0x2f876a[_0x2518d2['gateway']][_0x477eba(0x1be)]+=_0x49ddfd,_0x2f876a[_0x2518d2[_0x477eba(0x1ef)]]['paymentsWithCommission']++;!_0x40c1a6[_0x477eba(0x1cc)]&&(!_0x905841[_0x2518d2['shopId']]&&(_0x905841[_0x2518d2[_0x477eba(0x1cc)]]={'shopId':_0x2518d2[_0x477eba(0x1cc)],'shopName':_0x2518d2[_0x477eba(0x222)][_0x477eba(0x1b8)],'shopUsername':_0x2518d2['shop'][_0x477eba(0x1f7)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x905841[_0x2518d2[_0x477eba(0x1cc)]]['paymentsCount']++,_0x905841[_0x2518d2[_0x477eba(0x1cc)]][_0x477eba(0x1e6)]+=_0x5e2993,_0x905841[_0x2518d2['shopId']][_0x477eba(0x1d4)]+=_0x460af6,_0x905841[_0x2518d2['shopId']][_0x477eba(0x192)]+=_0x57e6dc);const _0x26c955=_0x2518d2['paidAt'][_0x477eba(0x1fc)]()[_0x477eba(0x1a3)]('T')[0x0];!_0x4b9643[_0x26c955]&&(_0x4b9643[_0x26c955]={'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x4b9643[_0x26c955][_0x477eba(0x1d5)]+=_0x5e2993,_0x4b9643[_0x26c955][_0x477eba(0x1df)]+=_0x57e6dc,_0x4b9643[_0x26c955][_0x477eba(0x209)]+=_0x460af6,_0x4b9643[_0x26c955][_0x477eba(0x1ed)]++;}let _0xca838d=0x0;const _0x365223={};for(const _0x316fff of _0x527a56){_0xca838d+=_0x316fff[_0x477eba(0x1a1)],!_0x365223[_0x316fff['shopId']]&&(_0x365223[_0x316fff[_0x477eba(0x1cc)]]=0x0),_0x365223[_0x316fff['shopId']]+=_0x316fff[_0x477eba(0x1a1)];}const _0x397a96=_0x10a300-_0x1b75db,_0x87e4d9=_0x1b75db,_0x134805=_0x2109f0['length']>0x0?_0x5c3910['length']/_0x2109f0[_0x477eba(0x235)]*0x64:0x0;console[_0x477eba(0x1ff)](_0x477eba(0x1f5)+_0x5c3910[_0x477eba(0x235)]+_0x477eba(0x1a5)+_0x2109f0[_0x477eba(0x235)]+'\x20total\x20=\x20'+_0x134805[_0x477eba(0x21e)](0x2)+'%');for(const _0x19749a in _0x905841){_0x905841[_0x19749a]['paidOutUSDT']=_0x365223[_0x19749a]||0x0,_0x905841[_0x19749a]['averageCheckUSDT']=_0x905841[_0x19749a][_0x477eba(0x1ed)]>0x0?_0x905841[_0x19749a][_0x477eba(0x1e6)]/_0x905841[_0x19749a][_0x477eba(0x1ed)]:0x0;}const _0x309aa9={'totalTurnover':Math['round'](_0x10a300*0x64)/0x64,'merchantEarnings':Math[_0x477eba(0x1ba)](_0x397a96*0x64)/0x64,'gatewayEarnings':Math[_0x477eba(0x1ba)](_0x87e4d9*0x64)/0x64,'totalPaidOut':Math['round'](_0xca838d*0x64)/0x64,'averageCheck':_0x5c3910['length']>0x0?Math['round'](_0x10a300/_0x5c3910[_0x477eba(0x235)]*0x64)/0x64:0x0,'totalPayments':_0x2109f0[_0x477eba(0x235)],'successfulPayments':_0x5c3910['length'],'conversionRate':Math[_0x477eba(0x1ba)](_0x134805*0x64)/0x64,'gatewayBreakdown':Object[_0x477eba(0x1f3)](_0x2f876a)[_0x477eba(0x1d9)](([_0x51a067,_0x140b4a])=>({'gateway':_0x51a067,'gatewayDisplayName':this['getGatewayDisplayName'](_0x51a067),'paymentsCount':_0x140b4a[_0x477eba(0x1ed)],'turnoverUSDT':Math[_0x477eba(0x1ba)](_0x140b4a[_0x477eba(0x1e6)]*0x64)/0x64,'commissionUSDT':Math[_0x477eba(0x1ba)](_0x140b4a[_0x477eba(0x1d4)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x477eba(0x1ba)](_0x140b4a[_0x477eba(0x192)]*0x64)/0x64,'averageCommissionRate':_0x140b4a[_0x477eba(0x1ca)]>0x0?Math[_0x477eba(0x1ba)](_0x140b4a[_0x477eba(0x1be)]/_0x140b4a[_0x477eba(0x1ca)]*0x64)/0x64:0x0})),'merchantBreakdown':_0x40c1a6[_0x477eba(0x1cc)]?undefined:Object[_0x477eba(0x203)](_0x905841)[_0x477eba(0x1d9)](_0x29aadf=>({'shopId':_0x29aadf[_0x477eba(0x1cc)],'shopName':_0x29aadf[_0x477eba(0x1f1)],'shopUsername':_0x29aadf[_0x477eba(0x202)],'paymentsCount':_0x29aadf[_0x477eba(0x1ed)],'turnoverUSDT':Math[_0x477eba(0x1ba)](_0x29aadf['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x477eba(0x1ba)](_0x29aadf[_0x477eba(0x1d4)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x29aadf[_0x477eba(0x192)]*0x64)/0x64,'paidOutUSDT':Math['round']((_0x365223[_0x29aadf['shopId']]||0x0)*0x64)/0x64,'averageCheckUSDT':Math[_0x477eba(0x1ba)](_0x29aadf['turnoverUSDT']/_0x29aadf[_0x477eba(0x1ed)]*0x64)/0x64})),'dailyData':Object[_0x477eba(0x1f3)](_0x4b9643)['sort'](([_0x419a43],[_0x134ea7])=>_0x419a43['localeCompare'](_0x134ea7))[_0x477eba(0x1d9)](([_0x610665,_0x577b6e])=>({'date':_0x610665,'turnover':Math[_0x477eba(0x1ba)](_0x577b6e[_0x477eba(0x1d5)]*0x64)/0x64,'merchantEarnings':Math[_0x477eba(0x1ba)](_0x577b6e[_0x477eba(0x1df)]*0x64)/0x64,'gatewayEarnings':Math['round'](_0x577b6e['gatewayEarnings']*0x64)/0x64,'paymentsCount':_0x577b6e[_0x477eba(0x1ed)]})),'periodInfo':{'from':_0x222691,'to':_0x3671c0,'periodType':_0x40c1a6[_0x477eba(0x226)]||'month','daysCount':Math['ceil']((_0x3671c0[_0x477eba(0x238)]()-_0x222691[_0x477eba(0x238)]())/(0x3e8*0x3c*0x3c*0x18))}};return console[_0x477eba(0x1ff)]('ðŸ“Š\x20Merchant\x20statistics\x20calculated:',{'totalTurnover':_0x309aa9[_0x477eba(0x233)],'merchantEarnings':_0x309aa9[_0x477eba(0x1df)],'gatewayEarnings':_0x309aa9[_0x477eba(0x209)],'totalPaidOut':_0x309aa9['totalPaidOut'],'totalPayments':_0x309aa9['totalPayments'],'successfulPayments':_0x309aa9[_0x477eba(0x199)],'conversionRate':_0x309aa9['conversionRate']}),_0x309aa9;}['getGatewayDisplayName'](_0x37f0a1){const _0x5311d5=a33_0x36eff5,_0xfa6340={'plisio':'Plisio','rapyd':_0x5311d5(0x1eb),'noda':_0x5311d5(0x216),'cointopay':'CoinToPay','klyme_eu':_0x5311d5(0x1c7),'klyme_gb':_0x5311d5(0x220),'klyme_de':_0x5311d5(0x1d1)};return _0xfa6340[_0x37f0a1]||_0x37f0a1;}async[a33_0x36eff5(0x1c0)](_0x35be65=a33_0x36eff5(0x1fd)){const _0x378549=a33_0x36eff5,_0x4a5532=new Date();let _0x1227b1;switch(_0x35be65){case'7d':_0x1227b1=new Date(_0x4a5532['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x378549(0x1fd):_0x1227b1=new Date(_0x4a5532[_0x378549(0x238)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x378549(0x1da):_0x1227b1=new Date(_0x4a5532[_0x378549(0x238)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case'1y':_0x1227b1=new Date(_0x4a5532[_0x378549(0x238)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;default:_0x1227b1=new Date(_0x4a5532[_0x378549(0x238)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x36d20a,_0xfcae6a,_0x34df84,_0xba8477,_0x584eba,_0x57b8bc,_0x21db92]=await Promise[_0x378549(0x21a)]([database_1[_0x378549(0x1ac)][_0x378549(0x222)][_0x378549(0x201)](),database_1[_0x378549(0x1ac)][_0x378549(0x222)][_0x378549(0x201)]({'where':{'status':_0x378549(0x196)}}),database_1[_0x378549(0x1ac)]['payment']['count']({'where':{'createdAt':{'gte':_0x1227b1}}}),database_1[_0x378549(0x1ac)][_0x378549(0x1c3)]['count']({'where':{'status':_0x378549(0x214),'createdAt':{'gte':_0x1227b1}}}),database_1[_0x378549(0x1ac)][_0x378549(0x1c3)]['findMany']({'where':{'status':_0x378549(0x214),'createdAt':{'gte':_0x1227b1}},'select':{'amount':!![],'currency':!![]}}),database_1['default'][_0x378549(0x1c3)][_0x378549(0x1cb)]({'take':0xa,'orderBy':{'createdAt':'desc'},'where':{'createdAt':{'gte':_0x1227b1}},'select':{'id':!![],'amount':!![],'currency':!![],'status':!![],'gateway':!![],'createdAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x378549(0x1c3)][_0x378549(0x1cb)]({'where':{'status':_0x378549(0x214),'paidAt':{'gte':_0x1227b1,'lte':_0x4a5532}},'select':{'amount':!![],'currency':!![],'paidAt':!![]},'orderBy':{'paidAt':_0x378549(0x1d6)}})]);let _0x40c501=0x0;for(const _0x202795 of _0x584eba){const _0x5dad62=await currencyService_1['currencyService']['convertToUSDT'](_0x202795[_0x378549(0x1a1)],_0x202795[_0x378549(0x237)]);_0x40c501+=_0x5dad62;}const _0x510e26={};for(const _0x2c4175 of _0x21db92){if(!_0x2c4175[_0x378549(0x1d0)])continue;const _0x1a2f9c=_0x2c4175[_0x378549(0x1d0)][_0x378549(0x1fc)]()[_0x378549(0x1a3)]('T')[0x0],_0x589498=await currencyService_1[_0x378549(0x1c6)][_0x378549(0x1c8)](_0x2c4175[_0x378549(0x1a1)],_0x2c4175['currency']);!_0x510e26[_0x1a2f9c]&&(_0x510e26[_0x1a2f9c]=0x0),_0x510e26[_0x1a2f9c]+=_0x589498;}const _0x310455=Object[_0x378549(0x1f3)](_0x510e26)[_0x378549(0x22f)](([_0x23254c],[_0x548bf3])=>_0x23254c[_0x378549(0x18a)](_0x548bf3))['map'](([_0x5b6e46,_0xd94501])=>({'date':_0x5b6e46,'amount':Math['round'](_0xd94501*0x64)/0x64})),_0x4ba812=_0x34df84>0x0?_0xba8477/_0x34df84*0x64:0x0;return{'overview':{'totalShops':_0x36d20a,'activeShops':_0xfcae6a,'totalPayments':_0x34df84,'successfulPayments':_0xba8477,'totalRevenue':Math[_0x378549(0x1ba)](_0x40c501*0x64)/0x64,'conversionRate':Math[_0x378549(0x1ba)](_0x4ba812*0x64)/0x64},'dailyRevenue':_0x310455,'recentPayments':_0x57b8bc[_0x378549(0x1d9)](_0x402780=>({'id':_0x402780['id'],'amount':_0x402780[_0x378549(0x1a1)],'currency':_0x402780[_0x378549(0x237)],'status':_0x402780['status'],'gateway':_0x402780['gateway'],'shopName':_0x402780[_0x378549(0x222)][_0x378549(0x1b8)],'shopUsername':_0x402780[_0x378549(0x222)]['username'],'createdAt':_0x402780['createdAt']})),'period':_0x35be65};}async[a33_0x36eff5(0x224)](){const _0x1647d2=a33_0x36eff5,_0x44928e=await database_1['default'][_0x1647d2(0x1c3)][_0x1647d2(0x1cb)]({'where':{'status':_0x1647d2(0x214),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'gateway':!![],'shop':{'select':{'gatewaySettings':!![]}}}});let _0x1f4354=0x0,_0x4d6ae7=0x0;for(const _0x3f1940 of _0x44928e){const _0x142cf9=await currencyService_1[_0x1647d2(0x1c6)][_0x1647d2(0x1c8)](_0x3f1940[_0x1647d2(0x1a1)],_0x3f1940[_0x1647d2(0x237)]);_0x4d6ae7+=_0x142cf9;let _0x2e767f=0xa;if(_0x3f1940[_0x1647d2(0x222)]['gatewaySettings'])try{const _0x2012bd=JSON[_0x1647d2(0x1b5)](_0x3f1940[_0x1647d2(0x222)][_0x1647d2(0x215)]),_0x7a3d08=this[_0x1647d2(0x1a4)](_0x3f1940[_0x1647d2(0x1ef)]);_0x2012bd[_0x7a3d08]?.[_0x1647d2(0x1f4)]!==undefined&&(_0x2e767f=_0x2012bd[_0x7a3d08][_0x1647d2(0x1f4)]);}catch(_0x2fc0e8){console[_0x1647d2(0x19d)](_0x1647d2(0x213),_0x2fc0e8);}const _0x4be6f6=_0x142cf9*(0x1-_0x2e767f/0x64);_0x1f4354+=_0x4be6f6;}const [_0xd9485,_0xc15020]=await Promise[_0x1647d2(0x21a)]([database_1[_0x1647d2(0x1ac)][_0x1647d2(0x21b)][_0x1647d2(0x193)]({'where':{'status':_0x1647d2(0x1e0)},'_sum':{'amount':!![]}}),database_1[_0x1647d2(0x1ac)][_0x1647d2(0x21b)][_0x1647d2(0x193)]({'where':{'status':_0x1647d2(0x1e0),'paidAt':{'gte':new Date(new Date()['getFullYear'](),new Date()[_0x1647d2(0x197)](),0x1)}},'_sum':{'amount':!![]}})]);return{'totalPayout':_0xd9485[_0x1647d2(0x1fb)]['amount']||0x0,'awaitingPayout':Math[_0x1647d2(0x1ba)](_0x1f4354*0x64)/0x64,'thisMonth':_0xc15020[_0x1647d2(0x1fb)][_0x1647d2(0x1a1)]||0x0,'availableBalance':Math[_0x1647d2(0x1ba)](_0x4d6ae7*0x64)/0x64};}async[a33_0x36eff5(0x1a2)](_0x33c4ca){const _0x3a8a9a=a33_0x36eff5,{page:_0x2ff5cd,limit:_0x2b54ff,minAmount:_0x38b278,search:_0x368d6b}=_0x33c4ca,_0x57c594=await database_1[_0x3a8a9a(0x1ac)][_0x3a8a9a(0x1c3)][_0x3a8a9a(0x1cb)]({'where':{'status':_0x3a8a9a(0x214),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![]}}}}),_0x27362e={};for(const _0x1a9eda of _0x57c594){!_0x27362e[_0x1a9eda[_0x3a8a9a(0x1cc)]]&&(_0x27362e[_0x1a9eda['shopId']]={'shop':_0x1a9eda['shop'],'payments':[],'totalAmountUSDT':0x0,'totalAmountAfterCommissionUSDT':0x0,'gatewayBreakdown':{},'oldestPaymentDate':_0x1a9eda[_0x3a8a9a(0x1d0)]});const _0x24f458=_0x27362e[_0x1a9eda['shopId']];_0x24f458[_0x3a8a9a(0x1b0)][_0x3a8a9a(0x190)](_0x1a9eda);const _0x5cbca1=await currencyService_1['currencyService']['convertToUSDT'](_0x1a9eda[_0x3a8a9a(0x1a1)],_0x1a9eda[_0x3a8a9a(0x237)]);_0x24f458[_0x3a8a9a(0x1ad)]+=_0x5cbca1;let _0x533ba5=0xa;if(_0x1a9eda[_0x3a8a9a(0x222)][_0x3a8a9a(0x215)])try{const _0x560de3=JSON[_0x3a8a9a(0x1b5)](_0x1a9eda[_0x3a8a9a(0x222)][_0x3a8a9a(0x215)]),_0x2afb19=this['getGatewayDisplayName'](_0x1a9eda['gateway']);_0x560de3[_0x2afb19]?.[_0x3a8a9a(0x1f4)]!==undefined&&(_0x533ba5=_0x560de3[_0x2afb19]['commission']);}catch(_0x522c30){console[_0x3a8a9a(0x19d)](_0x3a8a9a(0x213),_0x522c30);}const _0xa4d1e6=_0x5cbca1*(0x1-_0x533ba5/0x64);_0x24f458[_0x3a8a9a(0x19f)]+=_0xa4d1e6,!_0x24f458[_0x3a8a9a(0x1e5)][_0x1a9eda[_0x3a8a9a(0x1ef)]]&&(_0x24f458['gatewayBreakdown'][_0x1a9eda[_0x3a8a9a(0x1ef)]]={'gateway':_0x1a9eda[_0x3a8a9a(0x1ef)],'count':0x0,'amountUSDT':0x0,'amountAfterCommissionUSDT':0x0,'commission':_0x533ba5}),_0x24f458[_0x3a8a9a(0x1e5)][_0x1a9eda['gateway']][_0x3a8a9a(0x201)]++,_0x24f458[_0x3a8a9a(0x1e5)][_0x1a9eda['gateway']][_0x3a8a9a(0x1e1)]+=_0x5cbca1,_0x24f458[_0x3a8a9a(0x1e5)][_0x1a9eda[_0x3a8a9a(0x1ef)]]['amountAfterCommissionUSDT']+=_0xa4d1e6,_0x1a9eda['paidAt']<_0x24f458['oldestPaymentDate']&&(_0x24f458['oldestPaymentDate']=_0x1a9eda[_0x3a8a9a(0x1d0)]);}let _0x2408df=Object[_0x3a8a9a(0x203)](_0x27362e)['map'](_0x42a61c=>({'id':_0x42a61c['shop']['id'],'fullName':_0x42a61c[_0x3a8a9a(0x222)]['name'],'username':_0x42a61c[_0x3a8a9a(0x222)][_0x3a8a9a(0x1f7)],'telegramId':_0x42a61c[_0x3a8a9a(0x222)][_0x3a8a9a(0x1b1)],'merchantUrl':_0x42a61c[_0x3a8a9a(0x222)]['shopUrl'],'wallets':{'usdtPolygonWallet':_0x42a61c[_0x3a8a9a(0x222)]['usdtPolygonWallet'],'usdtTrcWallet':_0x42a61c[_0x3a8a9a(0x222)]['usdtTrcWallet'],'usdtErcWallet':_0x42a61c['shop']['usdtErcWallet'],'usdcPolygonWallet':_0x42a61c[_0x3a8a9a(0x222)][_0x3a8a9a(0x1cf)]},'totalAmountUSDT':Math[_0x3a8a9a(0x1ba)](_0x42a61c[_0x3a8a9a(0x1ad)]*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x3a8a9a(0x1ba)](_0x42a61c['totalAmountAfterCommissionUSDT']*0x64)/0x64,'paymentsCount':_0x42a61c[_0x3a8a9a(0x1b0)]['length'],'oldestPaymentDate':_0x42a61c[_0x3a8a9a(0x20c)],'gatewayBreakdown':Object[_0x3a8a9a(0x203)](_0x42a61c['gatewayBreakdown'])[_0x3a8a9a(0x1d9)](_0xfd5fed=>({'gateway':_0xfd5fed[_0x3a8a9a(0x1ef)],'count':_0xfd5fed['count'],'amountUSDT':Math['round'](_0xfd5fed['amountUSDT']*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x3a8a9a(0x1ba)](_0xfd5fed[_0x3a8a9a(0x18d)]*0x64)/0x64,'commission':_0xfd5fed[_0x3a8a9a(0x1f4)]}))}));_0x38b278&&(_0x2408df=_0x2408df[_0x3a8a9a(0x18e)](_0x13ca5e=>_0x13ca5e['totalAmountAfterCommissionUSDT']>=_0x38b278));if(_0x368d6b){const _0x9eda26=_0x368d6b['toLowerCase']();_0x2408df=_0x2408df['filter'](_0x5d4337=>_0x5d4337[_0x3a8a9a(0x20a)][_0x3a8a9a(0x227)]()[_0x3a8a9a(0x228)](_0x9eda26)||_0x5d4337['username'][_0x3a8a9a(0x227)]()[_0x3a8a9a(0x228)](_0x9eda26));}_0x2408df['sort']((_0x51afbb,_0x1b6cb0)=>_0x1b6cb0[_0x3a8a9a(0x19f)]-_0x51afbb[_0x3a8a9a(0x19f)]);const _0x416664={'totalMerchants':_0x2408df[_0x3a8a9a(0x235)],'totalAmountUSDT':Math[_0x3a8a9a(0x1ba)](_0x2408df[_0x3a8a9a(0x20e)]((_0x5444ca,_0x525a70)=>_0x5444ca+_0x525a70[_0x3a8a9a(0x1ad)],0x0)*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x3a8a9a(0x1ba)](_0x2408df[_0x3a8a9a(0x20e)]((_0x3a7c39,_0x335459)=>_0x3a7c39+_0x335459[_0x3a8a9a(0x19f)],0x0)*0x64)/0x64},_0x470138=(_0x2ff5cd-0x1)*_0x2b54ff,_0x133880=_0x2408df[_0x3a8a9a(0x19e)](_0x470138,_0x470138+_0x2b54ff);return{'merchants':_0x133880,'pagination':{'page':_0x2ff5cd,'limit':_0x2b54ff,'total':_0x2408df[_0x3a8a9a(0x235)],'totalPages':Math[_0x3a8a9a(0x198)](_0x2408df['length']/_0x2b54ff)},'summary':_0x416664};}async['createPayout'](_0x32c189){const _0xf5f365=a33_0x36eff5,{shopId:_0xd02b40,amount:_0x2c7d12,network:_0x14efcc,notes:_0x3cc846}=_0x32c189,_0x4f12ea=await database_1[_0xf5f365(0x1ac)]['shop'][_0xf5f365(0x1c4)]({'where':{'id':_0xd02b40},'select':{'id':!![],'name':!![],'username':!![]}});if(!_0x4f12ea)throw new Error(_0xf5f365(0x1e4));const _0x4f8c62=await database_1[_0xf5f365(0x1ac)]['payout']['create']({'data':{'shopId':_0xd02b40,'amount':_0x2c7d12,'network':_0x14efcc,'status':_0xf5f365(0x1e0),'notes':_0x3cc846,'paidAt':new Date()}});return{'id':_0x4f8c62['id'],'shopId':_0x4f8c62[_0xf5f365(0x1cc)],'shopName':_0x4f12ea['name'],'shopUsername':_0x4f12ea[_0xf5f365(0x1f7)],'amount':_0x4f8c62[_0xf5f365(0x1a1)],'network':_0x4f8c62['network'],'status':_0x4f8c62[_0xf5f365(0x200)],'txid':_0x4f8c62[_0xf5f365(0x1bc)],'notes':_0x4f8c62[_0xf5f365(0x1b2)],'createdAt':_0x4f8c62[_0xf5f365(0x1ea)],'paidAt':_0x4f8c62[_0xf5f365(0x1d0)]};}async['getAllPayouts'](_0x280b54){const _0x5b30a4=a33_0x36eff5,{page:_0x3be829,limit:_0x140617,shopId:_0x5eea79,network:_0x3d918a,dateFrom:_0x5394d3,dateTo:_0x38d2e7,search:_0xf73188}=_0x280b54,_0x3d07ac=(_0x3be829-0x1)*_0x140617,_0x399100={};_0x5eea79&&(_0x399100[_0x5b30a4(0x1cc)]=_0x5eea79);_0x3d918a&&(_0x399100[_0x5b30a4(0x1db)]=_0x3d918a);(_0x5394d3||_0x38d2e7)&&(_0x399100[_0x5b30a4(0x1d0)]={},_0x5394d3&&(_0x399100['paidAt'][_0x5b30a4(0x20b)]=new Date(_0x5394d3)),_0x38d2e7&&(_0x399100[_0x5b30a4(0x1d0)][_0x5b30a4(0x1f0)]=new Date(_0x38d2e7)));_0xf73188&&(_0x399100['OR']=[{'shop':{'name':{'contains':_0xf73188,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0xf73188,'mode':_0x5b30a4(0x221)}}},{'notes':{'contains':_0xf73188,'mode':'insensitive'}}]);const [_0x3672cd,_0x352204]=await Promise[_0x5b30a4(0x21a)]([database_1[_0x5b30a4(0x1ac)]['payout'][_0x5b30a4(0x1cb)]({'where':_0x399100,'skip':_0x3d07ac,'take':_0x140617,'orderBy':{'createdAt':_0x5b30a4(0x22a)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x5b30a4(0x1ac)][_0x5b30a4(0x21b)][_0x5b30a4(0x201)]({'where':_0x399100})]);return{'payouts':_0x3672cd[_0x5b30a4(0x1d9)](_0x1d2128=>({'id':_0x1d2128['id'],'shopId':_0x1d2128[_0x5b30a4(0x1cc)],'shopName':_0x1d2128['shop'][_0x5b30a4(0x1b8)],'shopUsername':_0x1d2128['shop'][_0x5b30a4(0x1f7)],'amount':_0x1d2128['amount'],'network':_0x1d2128[_0x5b30a4(0x1db)],'status':_0x1d2128['status'],'txid':_0x1d2128[_0x5b30a4(0x1bc)],'notes':_0x1d2128[_0x5b30a4(0x1b2)],'createdAt':_0x1d2128['createdAt'],'paidAt':_0x1d2128[_0x5b30a4(0x1d0)]})),'pagination':{'page':_0x3be829,'limit':_0x140617,'total':_0x352204,'totalPages':Math['ceil'](_0x352204/_0x140617)}};}async['getPayoutById'](_0xd4e954){const _0x1c5fb1=a33_0x36eff5,_0xfa08b=await database_1[_0x1c5fb1(0x1ac)][_0x1c5fb1(0x21b)][_0x1c5fb1(0x1c4)]({'where':{'id':_0xd4e954},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0xfa08b)return null;return{'id':_0xfa08b['id'],'shopId':_0xfa08b[_0x1c5fb1(0x1cc)],'shopName':_0xfa08b[_0x1c5fb1(0x222)][_0x1c5fb1(0x1b8)],'shopUsername':_0xfa08b[_0x1c5fb1(0x222)][_0x1c5fb1(0x1f7)],'amount':_0xfa08b[_0x1c5fb1(0x1a1)],'network':_0xfa08b[_0x1c5fb1(0x1db)],'status':_0xfa08b[_0x1c5fb1(0x200)],'txid':_0xfa08b[_0x1c5fb1(0x1bc)],'notes':_0xfa08b[_0x1c5fb1(0x1b2)],'createdAt':_0xfa08b[_0x1c5fb1(0x1ea)],'paidAt':_0xfa08b[_0x1c5fb1(0x1d0)]};}async[a33_0x36eff5(0x1a7)](_0x5c0c57){const _0x5b33d1=a33_0x36eff5;await database_1[_0x5b33d1(0x1ac)]['payout'][_0x5b33d1(0x225)]({'where':{'id':_0x5c0c57}});}async[a33_0x36eff5(0x1bf)](_0x74032f){const _0x2dead4=a33_0x36eff5,{page:_0x5cb2ab,limit:_0x5122f7,status:_0xf6028a,gateway:_0x4e1ea6,shopId:_0x505f57,dateFrom:_0x4fbb80,dateTo:_0x102152,search:_0x199dd6}=_0x74032f,_0xfc5411=(_0x5cb2ab-0x1)*_0x5122f7,_0x25e1de={};_0xf6028a&&(_0x25e1de[_0x2dead4(0x200)]=_0xf6028a[_0x2dead4(0x211)]());_0x4e1ea6&&(_0x25e1de['gateway']=_0x4e1ea6[_0x2dead4(0x227)]());_0x505f57&&(_0x25e1de[_0x2dead4(0x1cc)]=_0x505f57);(_0x4fbb80||_0x102152)&&(_0x25e1de[_0x2dead4(0x1ea)]={},_0x4fbb80&&(_0x25e1de[_0x2dead4(0x1ea)][_0x2dead4(0x20b)]=new Date(_0x4fbb80)),_0x102152&&(_0x25e1de['createdAt'][_0x2dead4(0x1f0)]=new Date(_0x102152)));_0x199dd6&&(_0x25e1de['OR']=[{'orderId':{'contains':_0x199dd6,'mode':'insensitive'}},{'gatewayOrderId':{'contains':_0x199dd6,'mode':_0x2dead4(0x221)}},{'customerEmail':{'contains':_0x199dd6,'mode':_0x2dead4(0x221)}},{'shop':{'name':{'contains':_0x199dd6,'mode':_0x2dead4(0x221)}}},{'shop':{'username':{'contains':_0x199dd6,'mode':'insensitive'}}}]);const [_0x11f7bd,_0x42531d]=await Promise[_0x2dead4(0x21a)]([database_1[_0x2dead4(0x1ac)][_0x2dead4(0x1c3)]['findMany']({'where':_0x25e1de,'skip':_0xfc5411,'take':_0x5122f7,'orderBy':{'createdAt':_0x2dead4(0x22a)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x2dead4(0x1ac)][_0x2dead4(0x1c3)][_0x2dead4(0x201)]({'where':_0x25e1de})]);return{'payments':_0x11f7bd['map'](_0x50b4fd=>({'id':_0x50b4fd['id'],'shopId':_0x50b4fd[_0x2dead4(0x1cc)],'shopName':_0x50b4fd[_0x2dead4(0x222)][_0x2dead4(0x1b8)],'shopUsername':_0x50b4fd[_0x2dead4(0x222)][_0x2dead4(0x1f7)],'gateway':_0x50b4fd['gateway'],'amount':_0x50b4fd['amount'],'currency':_0x50b4fd[_0x2dead4(0x237)],'status':_0x50b4fd[_0x2dead4(0x200)],'orderId':_0x50b4fd[_0x2dead4(0x223)],'gatewayOrderId':_0x50b4fd[_0x2dead4(0x1f6)],'customerEmail':_0x50b4fd['customerEmail'],'customerName':_0x50b4fd['customerName'],'createdAt':_0x50b4fd[_0x2dead4(0x1ea)],'updatedAt':_0x50b4fd['updatedAt'],'paidAt':_0x50b4fd[_0x2dead4(0x1d0)],'failureMessage':_0x50b4fd['failureMessage'],'txUrls':_0x50b4fd['txUrls']})),'pagination':{'page':_0x5cb2ab,'limit':_0x5122f7,'total':_0x42531d,'totalPages':Math['ceil'](_0x42531d/_0x5122f7)}};}async[a33_0x36eff5(0x230)](_0x430d79){const _0x1d4991=a33_0x36eff5,_0x10f217=await database_1[_0x1d4991(0x1ac)][_0x1d4991(0x1c3)][_0x1d4991(0x1c4)]({'where':{'id':_0x430d79},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x10f217)return null;return{'id':_0x10f217['id'],'shopId':_0x10f217[_0x1d4991(0x1cc)],'shopName':_0x10f217[_0x1d4991(0x222)]['name'],'shopUsername':_0x10f217[_0x1d4991(0x222)][_0x1d4991(0x1f7)],'gateway':_0x10f217[_0x1d4991(0x1ef)],'amount':_0x10f217['amount'],'currency':_0x10f217[_0x1d4991(0x237)],'status':_0x10f217[_0x1d4991(0x200)],'orderId':_0x10f217[_0x1d4991(0x223)],'gatewayOrderId':_0x10f217[_0x1d4991(0x1f6)],'gatewayPaymentId':_0x10f217[_0x1d4991(0x231)],'customerEmail':_0x10f217[_0x1d4991(0x205)],'customerName':_0x10f217['customerName'],'externalPaymentUrl':_0x10f217[_0x1d4991(0x1a6)],'successUrl':_0x10f217[_0x1d4991(0x1b3)],'failUrl':_0x10f217[_0x1d4991(0x18f)],'createdAt':_0x10f217[_0x1d4991(0x1ea)],'updatedAt':_0x10f217[_0x1d4991(0x21f)],'paidAt':_0x10f217['paidAt'],'merchantPaid':_0x10f217['merchantPaid'],'adminNotes':_0x10f217['adminNotes'],'statusChangedBy':_0x10f217[_0x1d4991(0x22e)],'statusChangedAt':_0x10f217[_0x1d4991(0x1bb)]};}async['updatePaymentStatus'](_0x12b66d,_0x4e896e,_0x3f7369,_0x2056be){const _0x445420=a33_0x36eff5,_0x2f1e22={'status':_0x4e896e[_0x445420(0x211)](),'updatedAt':new Date(),'statusChangedBy':_0x445420(0x1de),'statusChangedAt':new Date()};_0x3f7369&&(_0x2f1e22['adminNotes']=_0x3f7369);_0x4e896e[_0x445420(0x211)]()===_0x445420(0x1d7)&&_0x2056be&&(_0x2f1e22[_0x445420(0x22c)]=_0x2056be);_0x4e896e[_0x445420(0x211)]()===_0x445420(0x214)&&(_0x2f1e22['paidAt']=new Date());const _0x29dba0=await database_1[_0x445420(0x1ac)][_0x445420(0x1c3)][_0x445420(0x1dc)]({'where':{'id':_0x12b66d},'data':_0x2f1e22,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return{'id':_0x29dba0['id'],'shopId':_0x29dba0[_0x445420(0x1cc)],'shopName':_0x29dba0[_0x445420(0x222)]['name'],'shopUsername':_0x29dba0[_0x445420(0x222)][_0x445420(0x1f7)],'gateway':_0x29dba0[_0x445420(0x1ef)],'amount':_0x29dba0[_0x445420(0x1a1)],'currency':_0x29dba0[_0x445420(0x237)],'status':_0x29dba0[_0x445420(0x200)],'orderId':_0x29dba0[_0x445420(0x223)],'gatewayOrderId':_0x29dba0[_0x445420(0x1f6)],'gatewayPaymentId':_0x29dba0[_0x445420(0x231)],'customerEmail':_0x29dba0[_0x445420(0x205)],'customerName':_0x29dba0[_0x445420(0x1c1)],'adminNotes':_0x29dba0[_0x445420(0x20f)],'chargebackAmount':_0x29dba0['chargebackAmount'],'createdAt':_0x29dba0[_0x445420(0x1ea)],'updatedAt':_0x29dba0[_0x445420(0x21f)],'paidAt':_0x29dba0[_0x445420(0x1d0)],'statusChangedBy':_0x29dba0[_0x445420(0x22e)],'statusChangedAt':_0x29dba0['statusChangedAt']};}async[a33_0x36eff5(0x212)](_0x1eaeee){const _0x1b2623=a33_0x36eff5,{page:_0x56edaa,limit:_0x56935d,status:_0xf1a2d9}=_0x1eaeee,_0x312f4c=(_0x56edaa-0x1)*_0x56935d,_0x258c8b={};_0xf1a2d9&&(_0x258c8b[_0x1b2623(0x200)]=_0xf1a2d9['toUpperCase']());const [_0x4f00a9,_0x153c3d]=await Promise[_0x1b2623(0x21a)]([database_1[_0x1b2623(0x1ac)]['shop'][_0x1b2623(0x1cb)]({'where':_0x258c8b,'skip':_0x312f4c,'take':_0x56935d,'orderBy':{'createdAt':_0x1b2623(0x22a)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1['default'][_0x1b2623(0x222)][_0x1b2623(0x201)]({'where':_0x258c8b})]);return{'users':_0x4f00a9[_0x1b2623(0x1d9)](_0x5b4de8=>({'id':_0x5b4de8['id'],'fullName':_0x5b4de8[_0x1b2623(0x1b8)],'username':_0x5b4de8[_0x1b2623(0x1f7)],'telegramId':_0x5b4de8[_0x1b2623(0x1b1)],'merchantUrl':_0x5b4de8['shopUrl'],'gateways':_0x5b4de8[_0x1b2623(0x22d)]?JSON[_0x1b2623(0x1b5)](_0x5b4de8[_0x1b2623(0x22d)]):null,'gatewaySettings':_0x5b4de8[_0x1b2623(0x215)]?JSON['parse'](_0x5b4de8[_0x1b2623(0x215)]):null,'publicKey':_0x5b4de8[_0x1b2623(0x1b4)],'wallets':{'usdtPolygonWallet':_0x5b4de8[_0x1b2623(0x1e3)],'usdtTrcWallet':_0x5b4de8['usdtTrcWallet'],'usdtErcWallet':_0x5b4de8['usdtErcWallet'],'usdcPolygonWallet':_0x5b4de8[_0x1b2623(0x1cf)]},'status':_0x5b4de8['status'],'createdAt':_0x5b4de8[_0x1b2623(0x1ea)]})),'pagination':{'page':_0x56edaa,'limit':_0x56935d,'total':_0x153c3d,'totalPages':Math[_0x1b2623(0x198)](_0x153c3d/_0x56935d)}};}async['getUserById'](_0x464aaf){const _0x29c210=a33_0x36eff5,_0x559fa6=await database_1['default']['shop'][_0x29c210(0x1c4)]({'where':{'id':_0x464aaf},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x559fa6)return null;return{'id':_0x559fa6['id'],'fullName':_0x559fa6[_0x29c210(0x1b8)],'username':_0x559fa6[_0x29c210(0x1f7)],'telegramId':_0x559fa6[_0x29c210(0x1b1)],'merchantUrl':_0x559fa6[_0x29c210(0x21c)],'gateways':_0x559fa6[_0x29c210(0x22d)]?JSON[_0x29c210(0x1b5)](_0x559fa6['paymentGateways']):null,'gatewaySettings':_0x559fa6[_0x29c210(0x215)]?JSON[_0x29c210(0x1b5)](_0x559fa6[_0x29c210(0x215)]):null,'publicKey':_0x559fa6[_0x29c210(0x1b4)],'wallets':{'usdtPolygonWallet':_0x559fa6[_0x29c210(0x1e3)],'usdtTrcWallet':_0x559fa6['usdtTrcWallet'],'usdtErcWallet':_0x559fa6[_0x29c210(0x1ee)],'usdcPolygonWallet':_0x559fa6[_0x29c210(0x1cf)]},'status':_0x559fa6[_0x29c210(0x200)],'createdAt':_0x559fa6[_0x29c210(0x1ea)]};}async[a33_0x36eff5(0x1e8)](_0x1d7539){const _0x3914f8=a33_0x36eff5,{fullName:_0x45eb38,username:_0x31c217,password:_0x4d7671,telegramId:_0x2da33b,merchantUrl:_0x2a5679,gateways:_0x10ca65,gatewaySettings:_0x1b8dec,wallets:_0xa2b176}=_0x1d7539,_0x2644e3=await database_1[_0x3914f8(0x1ac)][_0x3914f8(0x222)][_0x3914f8(0x1c4)]({'where':{'username':_0x31c217}});if(_0x2644e3)throw new Error('Username\x20already\x20exists');if(_0x2da33b){const _0x3e69ac=await database_1[_0x3914f8(0x1ac)][_0x3914f8(0x222)][_0x3914f8(0x1c4)]({'where':{'telegram':_0x2da33b}});if(_0x3e69ac)throw new Error(_0x3914f8(0x1bd));}const _0x155520=await bcryptjs_1[_0x3914f8(0x1ac)][_0x3914f8(0x1aa)](_0x4d7671,0xc),_0xd9256a=_0x3914f8(0x18b)+crypto_1[_0x3914f8(0x1ac)]['randomBytes'](0x20)['toString'](_0x3914f8(0x1c9)),_0x17a5c7=_0x3914f8(0x195)+crypto_1[_0x3914f8(0x1ac)][_0x3914f8(0x1e2)](0x20)[_0x3914f8(0x1e9)]('hex'),_0x43a8bf=await database_1[_0x3914f8(0x1ac)][_0x3914f8(0x222)]['create']({'data':{'name':_0x45eb38,'username':_0x31c217,'password':_0x155520,'telegram':_0x2da33b,'shopUrl':_0x2a5679,'paymentGateways':_0x10ca65?JSON[_0x3914f8(0x1b9)](_0x10ca65):null,'gatewaySettings':_0x1b8dec?JSON['stringify'](_0x1b8dec):null,'usdtPolygonWallet':_0xa2b176?.['usdtPolygonWallet']||null,'usdtTrcWallet':_0xa2b176?.['usdtTrcWallet']||null,'usdtErcWallet':_0xa2b176?.[_0x3914f8(0x1ee)]||null,'usdcPolygonWallet':_0xa2b176?.[_0x3914f8(0x1cf)]||null,'publicKey':_0xd9256a,'secretKey':_0x17a5c7,'status':'ACTIVE'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x43a8bf['id'],'fullName':_0x43a8bf['name'],'username':_0x43a8bf[_0x3914f8(0x1f7)],'telegramId':_0x43a8bf[_0x3914f8(0x1b1)],'merchantUrl':_0x43a8bf[_0x3914f8(0x21c)],'gateways':_0x43a8bf[_0x3914f8(0x22d)]?JSON[_0x3914f8(0x1b5)](_0x43a8bf[_0x3914f8(0x22d)]):null,'gatewaySettings':_0x43a8bf['gatewaySettings']?JSON[_0x3914f8(0x1b5)](_0x43a8bf[_0x3914f8(0x215)]):null,'publicKey':_0x43a8bf[_0x3914f8(0x1b4)],'wallets':{'usdtPolygonWallet':_0x43a8bf[_0x3914f8(0x1e3)],'usdtTrcWallet':_0x43a8bf[_0x3914f8(0x22b)],'usdtErcWallet':_0x43a8bf[_0x3914f8(0x1ee)],'usdcPolygonWallet':_0x43a8bf['usdcPolygonWallet']},'status':_0x43a8bf[_0x3914f8(0x200)],'createdAt':_0x43a8bf['createdAt']};}async['updateUser'](_0x22a839,_0x3c57d2){const _0x10870c=a33_0x36eff5,_0x4b94c4={..._0x3c57d2};_0x3c57d2['password']&&(_0x4b94c4[_0x10870c(0x1a0)]=await bcryptjs_1[_0x10870c(0x1ac)][_0x10870c(0x1aa)](_0x3c57d2[_0x10870c(0x1a0)],0xc));_0x3c57d2['fullName']&&(_0x4b94c4[_0x10870c(0x1b8)]=_0x3c57d2[_0x10870c(0x20a)],delete _0x4b94c4[_0x10870c(0x20a)]);_0x3c57d2[_0x10870c(0x1f8)]&&(_0x4b94c4[_0x10870c(0x1b1)]=_0x3c57d2[_0x10870c(0x1f8)],delete _0x4b94c4[_0x10870c(0x1f8)]);_0x3c57d2[_0x10870c(0x1b6)]&&(_0x4b94c4[_0x10870c(0x21c)]=_0x3c57d2['merchantUrl'],delete _0x4b94c4['merchantUrl']);_0x3c57d2[_0x10870c(0x1c5)]&&(_0x4b94c4[_0x10870c(0x22d)]=JSON['stringify'](_0x3c57d2[_0x10870c(0x1c5)]),delete _0x4b94c4[_0x10870c(0x1c5)]);_0x3c57d2[_0x10870c(0x215)]&&(_0x4b94c4[_0x10870c(0x215)]=JSON[_0x10870c(0x1b9)](_0x3c57d2[_0x10870c(0x215)]),delete _0x4b94c4[_0x10870c(0x215)]);_0x3c57d2[_0x10870c(0x219)]&&(_0x3c57d2[_0x10870c(0x219)][_0x10870c(0x1e3)]!==undefined&&(_0x4b94c4[_0x10870c(0x1e3)]=_0x3c57d2[_0x10870c(0x219)][_0x10870c(0x1e3)]||null),_0x3c57d2['wallets'][_0x10870c(0x22b)]!==undefined&&(_0x4b94c4['usdtTrcWallet']=_0x3c57d2[_0x10870c(0x219)][_0x10870c(0x22b)]||null),_0x3c57d2[_0x10870c(0x219)][_0x10870c(0x1ee)]!==undefined&&(_0x4b94c4[_0x10870c(0x1ee)]=_0x3c57d2[_0x10870c(0x219)]['usdtErcWallet']||null),_0x3c57d2[_0x10870c(0x219)][_0x10870c(0x1cf)]!==undefined&&(_0x4b94c4[_0x10870c(0x1cf)]=_0x3c57d2[_0x10870c(0x219)][_0x10870c(0x1cf)]||null),delete _0x4b94c4[_0x10870c(0x219)]);const _0x3f900f=await database_1[_0x10870c(0x1ac)][_0x10870c(0x222)][_0x10870c(0x1dc)]({'where':{'id':_0x22a839},'data':_0x4b94c4,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x3f900f['id'],'fullName':_0x3f900f[_0x10870c(0x1b8)],'username':_0x3f900f[_0x10870c(0x1f7)],'telegramId':_0x3f900f[_0x10870c(0x1b1)],'merchantUrl':_0x3f900f[_0x10870c(0x21c)],'gateways':_0x3f900f[_0x10870c(0x22d)]?JSON[_0x10870c(0x1b5)](_0x3f900f['paymentGateways']):null,'gatewaySettings':_0x3f900f['gatewaySettings']?JSON['parse'](_0x3f900f[_0x10870c(0x215)]):null,'publicKey':_0x3f900f[_0x10870c(0x1b4)],'wallets':{'usdtPolygonWallet':_0x3f900f[_0x10870c(0x1e3)],'usdtTrcWallet':_0x3f900f['usdtTrcWallet'],'usdtErcWallet':_0x3f900f[_0x10870c(0x1ee)],'usdcPolygonWallet':_0x3f900f[_0x10870c(0x1cf)]},'status':_0x3f900f['status'],'createdAt':_0x3f900f['createdAt']};}async['deleteUser'](_0x15762d){const _0xfcc269=a33_0x36eff5;await database_1[_0xfcc269(0x1ac)][_0xfcc269(0x222)]['delete']({'where':{'id':_0x15762d}});}async['suspendUser'](_0x11bcb8){const _0x12832e=a33_0x36eff5,_0x31346d=await database_1[_0x12832e(0x1ac)][_0x12832e(0x222)][_0x12832e(0x1dc)]({'where':{'id':_0x11bcb8},'data':{'status':_0x12832e(0x1f9)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x31346d['id'],'fullName':_0x31346d[_0x12832e(0x1b8)],'username':_0x31346d[_0x12832e(0x1f7)],'telegramId':_0x31346d[_0x12832e(0x1b1)],'merchantUrl':_0x31346d[_0x12832e(0x21c)],'gateways':_0x31346d[_0x12832e(0x22d)]?JSON[_0x12832e(0x1b5)](_0x31346d[_0x12832e(0x22d)]):null,'gatewaySettings':_0x31346d[_0x12832e(0x215)]?JSON['parse'](_0x31346d[_0x12832e(0x215)]):null,'publicKey':_0x31346d[_0x12832e(0x1b4)],'wallets':{'usdtPolygonWallet':_0x31346d[_0x12832e(0x1e3)],'usdtTrcWallet':_0x31346d[_0x12832e(0x22b)],'usdtErcWallet':_0x31346d[_0x12832e(0x1ee)],'usdcPolygonWallet':_0x31346d[_0x12832e(0x1cf)]},'status':_0x31346d[_0x12832e(0x200)],'createdAt':_0x31346d[_0x12832e(0x1ea)]};}async[a33_0x36eff5(0x1d8)](_0x2dc334){const _0x3d56f3=a33_0x36eff5,_0x2843af=await database_1[_0x3d56f3(0x1ac)][_0x3d56f3(0x222)][_0x3d56f3(0x1dc)]({'where':{'id':_0x2dc334},'data':{'status':_0x3d56f3(0x196)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2843af['id'],'fullName':_0x2843af[_0x3d56f3(0x1b8)],'username':_0x2843af[_0x3d56f3(0x1f7)],'telegramId':_0x2843af[_0x3d56f3(0x1b1)],'merchantUrl':_0x2843af[_0x3d56f3(0x21c)],'gateways':_0x2843af[_0x3d56f3(0x22d)]?JSON[_0x3d56f3(0x1b5)](_0x2843af[_0x3d56f3(0x22d)]):null,'gatewaySettings':_0x2843af[_0x3d56f3(0x215)]?JSON['parse'](_0x2843af[_0x3d56f3(0x215)]):null,'publicKey':_0x2843af[_0x3d56f3(0x1b4)],'wallets':{'usdtPolygonWallet':_0x2843af[_0x3d56f3(0x1e3)],'usdtTrcWallet':_0x2843af['usdtTrcWallet'],'usdtErcWallet':_0x2843af[_0x3d56f3(0x1ee)],'usdcPolygonWallet':_0x2843af[_0x3d56f3(0x1cf)]},'status':_0x2843af[_0x3d56f3(0x200)],'createdAt':_0x2843af[_0x3d56f3(0x1ea)]};}}exports[a33_0x36eff5(0x232)]=AdminService;function a33_0x7d36(){const _0xd72c87=['externalPaymentUrl','deletePayout','\x20completed\x20payouts','dateTo','hash','\x20successful\x20payments\x20for\x20revenue\x20calculation','default','totalAmountUSDT','getFullYear','getMerchantStatistics','payments','telegram','notes','successUrl','publicKey','parse','merchantUrl','week','name','stringify','round','statusChangedAt','txid','Telegram\x20username\x20already\x20exists','totalCommissionRate','getAllPayments','getSystemStatistics','customerName','44enJhFX','payment','findUnique','gateways','currencyService','KLYME\x20EU','convertToUSDT','hex','paymentsWithCommission','findMany','shopId','bcryptjs','../config/database','usdcPolygonWallet','paidAt','KLYME\x20DE','dateFrom\x20and\x20dateTo\x20are\x20required\x20for\x20custom\x20period','3117961gkjBEJ','commissionUSDT','turnover','asc','CHARGEBACK','activateUser','map','90d','network','update','6PzseZH','admin','merchantEarnings','COMPLETED','amountUSDT','randomBytes','usdtPolygonWallet','Shop\x20not\x20found','gatewayBreakdown','turnoverUSDT','1znuarw','createUser','toString','createdAt','Rapyd','custom','paymentsCount','usdtErcWallet','gateway','lte','shopName','ðŸ“Š\x20Found\x20','entries','commission','ðŸ“Š\x20Conversion\x20calculation:\x20','gatewayOrderId','username','telegramId','SUSPENDED','ðŸ“…\x20Period:\x20','_sum','toISOString','30d','5556910umibhu','log','status','count','shopUsername','values','1156023DsVGtj','customerEmail','866642RxIJbC','ðŸ“Š\x20Getting\x20merchant\x20statistics\x20with\x20filters:','ðŸ’¸\x20Found\x20','gatewayEarnings','fullName','gte','oldestPaymentDate','__esModule','reduce','adminNotes','2020-01-01','toUpperCase','getAllUsers','Error\x20parsing\x20gateway\x20settings:','PAID','gatewaySettings','Noda','getDay','2670612NwBwDs','wallets','all','payout','shopUrl','__importDefault','toFixed','updatedAt','KLYME\x20GB','insensitive','shop','orderId','getPayoutStats','delete','period','toLowerCase','includes','16YIZFVe','desc','usdtTrcWallet','chargebackAmount','paymentGateways','statusChangedBy','sort','getPaymentById','gatewayPaymentId','AdminService','totalTurnover','111759gymtXt','length','dateFrom','currency','getTime','localeCompare','pk_','1633660oHkONz','amountAfterCommissionUSDT','filter','failUrl','push','defineProperty','merchantEarningsUSDT','aggregate','\x20-\x20','sk_','ACTIVE','getMonth','ceil','successfulPayments','\x20total\x20payments\x20for\x20conversion\x20calculation','getDate','12slgDGY','error','slice','totalAmountAfterCommissionUSDT','password','amount','getMerchantsAwaitingPayout','split','getGatewayDisplayName','\x20paid\x20/\x20'];a33_0x7d36=function(){return _0xd72c87;};return a33_0x7d36();}