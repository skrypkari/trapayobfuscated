'use strict';function a46_0x36a2(_0x563802,_0xa6a9b0){_0x563802=_0x563802-0x88;const _0x1f5f52=a46_0x1f5f();let _0x36a2da=_0x1f5f52[_0x563802];return _0x36a2da;}const a46_0x1d78d3=a46_0x36a2;(function(_0xd95365,_0x2b230e){const _0x32d762=a46_0x36a2,_0x87ba41=_0xd95365();while(!![]){try{const _0x3f80b9=-parseInt(_0x32d762(0x167))/0x1*(-parseInt(_0x32d762(0x14d))/0x2)+parseInt(_0x32d762(0x152))/0x3*(-parseInt(_0x32d762(0x146))/0x4)+-parseInt(_0x32d762(0x8b))/0x5+parseInt(_0x32d762(0x144))/0x6*(parseInt(_0x32d762(0xd5))/0x7)+-parseInt(_0x32d762(0x10f))/0x8+parseInt(_0x32d762(0x136))/0x9+parseInt(_0x32d762(0x13a))/0xa;if(_0x3f80b9===_0x2b230e)break;else _0x87ba41['push'](_0x87ba41['shift']());}catch(_0x26f211){_0x87ba41['push'](_0x87ba41['shift']());}}}(a46_0x1f5f,0xa6d3a));var __importDefault=this&&this[a46_0x1d78d3(0x182)]||function(_0x565a5d){return _0x565a5d&&_0x565a5d['__esModule']?_0x565a5d:{'default':_0x565a5d};};Object[a46_0x1d78d3(0x1e9)](exports,a46_0x1d78d3(0x117),{'value':!![]}),exports[a46_0x1d78d3(0xbc)]=void 0x0;const database_1=__importDefault(require(a46_0x1d78d3(0x1f0))),bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require(a46_0x1d78d3(0x13f))),currencyService_1=require(a46_0x1d78d3(0x123)),telegramBotService_1=require(a46_0x1d78d3(0x190)),gateway_1=require(a46_0x1d78d3(0x1d2));class AdminService{async['getPayoutStats'](){const _0x5a0bf6=a46_0x1d78d3;console[_0x5a0bf6(0x17f)]('ðŸ“Š\x20Calculating\x20payout\x20statistics...');const _0x53fa05=await database_1[_0x5a0bf6(0x153)]['shop'][_0x5a0bf6(0xd4)]({'_sum':{'balance':!![],'totalPaidOut':!![]}}),_0x19bc70=await database_1[_0x5a0bf6(0x153)][_0x5a0bf6(0x115)][_0x5a0bf6(0xa8)]({'where':{'status':'PAID','gateway':{'not':_0x5a0bf6(0x1a1)}}}),_0x55b456=new Date(),_0x1d42d9=new Date(_0x55b456[_0x5a0bf6(0x1bd)](),_0x55b456['getMonth'](),0x1),_0x5ebfc9=new Date(_0x55b456[_0x5a0bf6(0x1bd)](),_0x55b456[_0x5a0bf6(0x9c)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x2f0a4d=await database_1['default']['payout'][_0x5a0bf6(0xd4)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x1d42d9,'lte':_0x5ebfc9},'status':'COMPLETED'}}),_0x4280b2=_0x53fa05[_0x5a0bf6(0x14e)]['totalPaidOut']||0x0,_0x34c243=_0x53fa05[_0x5a0bf6(0x14e)][_0x5a0bf6(0x1d6)]||0x0,_0x32e9fc=_0x2f0a4d[_0x5a0bf6(0x14e)]['amount']||0x0,_0x2b4889={'totalPayout':Math['round'](_0x4280b2*0x64)/0x64,'awaitingPayout':Math['round'](_0x34c243*0x64)/0x64,'thisMonth':Math[_0x5a0bf6(0x166)](_0x32e9fc*0x64)/0x64,'availableBalance':Math[_0x5a0bf6(0x166)](_0x34c243*0x64)/0x64,'totalPayments':_0x19bc70};return console[_0x5a0bf6(0x17f)]('ðŸ“Š\x20Payout\x20statistics\x20calculated:'),console[_0x5a0bf6(0x17f)](_0x5a0bf6(0xe1)+_0x2b4889[_0x5a0bf6(0x1b5)]+_0x5a0bf6(0xda)),console[_0x5a0bf6(0x17f)](_0x5a0bf6(0xf1)+_0x2b4889['awaitingPayout']+_0x5a0bf6(0x1ab)),console[_0x5a0bf6(0x17f)](_0x5a0bf6(0x10b)+_0x2b4889[_0x5a0bf6(0x9a)]+_0x5a0bf6(0x15a)),console[_0x5a0bf6(0x17f)](_0x5a0bf6(0x1e2)+_0x2b4889['thisMonth']+_0x5a0bf6(0x1c5)),console[_0x5a0bf6(0x17f)](_0x5a0bf6(0x150)+_0x2b4889['totalPayments']+'\x20PAID\x20payments'),_0x2b4889;}async[a46_0x1d78d3(0x19e)](_0x3beda6,_0x34e91f){const _0x3646cc=a46_0x1d78d3;console[_0x3646cc(0x17f)](_0x3646cc(0xb3)+_0x3beda6+':',_0x34e91f);const _0x387a23=await database_1[_0x3646cc(0x153)][_0x3646cc(0x115)]['findUnique']({'where':{'id':_0x3beda6},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x387a23)throw new Error(_0x3646cc(0xb6));const _0x4e7007={};_0x34e91f[_0x3646cc(0x19c)]!==undefined&&(_0x4e7007[_0x3646cc(0x19c)]=_0x34e91f[_0x3646cc(0x19c)]||null);_0x34e91f[_0x3646cc(0x145)]!==undefined&&(_0x4e7007['customerIp']=_0x34e91f['customerIp']||null);_0x34e91f[_0x3646cc(0x103)]!==undefined&&(_0x4e7007[_0x3646cc(0x103)]=_0x34e91f[_0x3646cc(0x103)]||null);const _0xc6c9c1=await database_1[_0x3646cc(0x153)]['payment'][_0x3646cc(0xc1)]({'where':{'id':_0x3beda6},'data':{..._0x4e7007,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x3646cc(0x17f)](_0x3646cc(0x178)+_0x3beda6),console[_0x3646cc(0x17f)](_0x3646cc(0xa9)+_0x387a23[_0x3646cc(0x19c)]+'\x20->\x20'+_0xc6c9c1[_0x3646cc(0x19c)]),console[_0x3646cc(0x17f)](_0x3646cc(0x1c8)+_0x387a23[_0x3646cc(0x145)]+_0x3646cc(0x1da)+_0xc6c9c1[_0x3646cc(0x145)]),console[_0x3646cc(0x17f)](_0x3646cc(0xa0)+(_0x387a23['customerUa']?_0x3646cc(0xe8):_0x3646cc(0xd3))+_0x3646cc(0x1da)+(_0xc6c9c1['customerUa']?_0x3646cc(0xe8):_0x3646cc(0xd3))),_0xc6c9c1;}async[a46_0x1d78d3(0x141)](_0x24cc31,_0x27e992){const _0x228eaf=a46_0x1d78d3,_0x33a20f=_0x27e992?new Date(_0x27e992):new Date();let _0x26e83c,_0x3f40be;if(_0x24cc31['startsWith']('custom_')){const _0x4f39bd=_0x24cc31[_0x228eaf(0x1bc)]('custom_','')[_0x228eaf(0x1a0)]('_');if(_0x4f39bd[_0x228eaf(0x1b4)]===0x2){const _0x36cde1=new Date(_0x4f39bd[0x0]),_0x417bf0=new Date(_0x4f39bd[0x1]);_0x26e83c=new Date(Date['UTC'](_0x36cde1[_0x228eaf(0x12a)](),_0x36cde1[_0x228eaf(0x110)](),_0x36cde1[_0x228eaf(0xc5)](),0x0,0x0,0x0,0x0)),_0x3f40be=new Date(Date[_0x228eaf(0x1c3)](_0x417bf0['getUTCFullYear'](),_0x417bf0[_0x228eaf(0x110)](),_0x417bf0[_0x228eaf(0xc5)](),0x17,0x3b,0x3b,0x3e7));}else{const _0x5e8bbc=new Date(Date[_0x228eaf(0x1c3)](_0x33a20f['getUTCFullYear'](),_0x33a20f['getUTCMonth'](),_0x33a20f[_0x228eaf(0xc5)]()-0x1e));_0x26e83c=new Date(Date['UTC'](_0x5e8bbc[_0x228eaf(0x12a)](),_0x5e8bbc['getUTCMonth'](),_0x5e8bbc['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x3f40be=new Date(Date['UTC'](_0x33a20f[_0x228eaf(0x12a)](),_0x33a20f[_0x228eaf(0x110)](),_0x33a20f[_0x228eaf(0xc5)](),0x17,0x3b,0x3b,0x3e7));}}else{switch(_0x24cc31[_0x228eaf(0xd9)]()){case'today':_0x26e83c=new Date(Date['UTC'](_0x33a20f[_0x228eaf(0x12a)](),_0x33a20f[_0x228eaf(0x110)](),_0x33a20f[_0x228eaf(0xc5)](),0x0,0x0,0x0,0x0)),_0x3f40be=new Date(Date[_0x228eaf(0x1c3)](_0x33a20f['getUTCFullYear'](),_0x33a20f[_0x228eaf(0x110)](),_0x33a20f[_0x228eaf(0xc5)](),0x17,0x3b,0x3b,0x3e7));break;case _0x228eaf(0x1a7):const _0xb3bbf7=new Date(_0x33a20f);_0xb3bbf7[_0x228eaf(0x98)](_0xb3bbf7['getUTCDate']()-0x1),_0x26e83c=new Date(Date['UTC'](_0xb3bbf7[_0x228eaf(0x12a)](),_0xb3bbf7['getUTCMonth'](),_0xb3bbf7[_0x228eaf(0xc5)](),0x0,0x0,0x0,0x0)),_0x3f40be=new Date(Date[_0x228eaf(0x1c3)](_0xb3bbf7['getUTCFullYear'](),_0xb3bbf7[_0x228eaf(0x110)](),_0xb3bbf7[_0x228eaf(0xc5)](),0x17,0x3b,0x3b,0x3e7));break;case _0x228eaf(0xfd):const _0xc6ddef=_0x33a20f[_0x228eaf(0x97)](),_0x2872c9=_0xc6ddef===0x0?-0x6:0x1-_0xc6ddef,_0x2737a4=_0x33a20f[_0x228eaf(0xc5)]()+_0x2872c9;_0x26e83c=new Date(Date[_0x228eaf(0x1c3)](_0x33a20f[_0x228eaf(0x12a)](),_0x33a20f[_0x228eaf(0x110)](),_0x2737a4,0x0,0x0,0x0,0x0)),_0x3f40be=new Date(Date[_0x228eaf(0x1c3)](_0x33a20f['getUTCFullYear'](),_0x33a20f[_0x228eaf(0x110)](),_0x33a20f[_0x228eaf(0xc5)](),0x17,0x3b,0x3b,0x3e7));break;case _0x228eaf(0x1e0):const _0x3ea7bc=new Date(Date[_0x228eaf(0x1c3)](_0x33a20f[_0x228eaf(0x12a)](),_0x33a20f[_0x228eaf(0x110)](),_0x33a20f[_0x228eaf(0xc5)]()-0x7)),_0xe83e22=_0x3ea7bc[_0x228eaf(0x97)](),_0x4b59ba=_0xe83e22===0x0?-0x6:0x1-_0xe83e22,_0x468a87=_0x3ea7bc[_0x228eaf(0xc5)]()+_0x4b59ba;_0x26e83c=new Date(Date[_0x228eaf(0x1c3)](_0x3ea7bc[_0x228eaf(0x12a)](),_0x3ea7bc[_0x228eaf(0x110)](),_0x468a87,0x0,0x0,0x0,0x0)),_0x3f40be=new Date(Date[_0x228eaf(0x1c3)](_0x3ea7bc[_0x228eaf(0x12a)](),_0x3ea7bc[_0x228eaf(0x110)](),_0x468a87+0x6,0x17,0x3b,0x3b,0x3e7));break;case _0x228eaf(0x1cf):_0x26e83c=new Date(Date[_0x228eaf(0x1c3)](_0x33a20f[_0x228eaf(0x12a)](),_0x33a20f[_0x228eaf(0x110)](),0x1,0x0,0x0,0x0,0x0)),_0x3f40be=new Date(Date['UTC'](_0x33a20f[_0x228eaf(0x12a)](),_0x33a20f['getUTCMonth'](),_0x33a20f[_0x228eaf(0xc5)](),0x17,0x3b,0x3b,0x3e7));break;case _0x228eaf(0x154):_0x26e83c=new Date(Date[_0x228eaf(0x1c3)](_0x33a20f[_0x228eaf(0x12a)](),_0x33a20f[_0x228eaf(0x110)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x3f40be=new Date(Date[_0x228eaf(0x1c3)](_0x33a20f[_0x228eaf(0x12a)](),_0x33a20f[_0x228eaf(0x110)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x228eaf(0xab):_0x26e83c=new Date(Date[_0x228eaf(0x1c3)](0x7e9,0x5,0xe,0x0,0x0,0x0,0x0)),_0x3f40be=new Date(Date['UTC'](_0x33a20f['getUTCFullYear'](),_0x33a20f[_0x228eaf(0x110)](),_0x33a20f['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;default:_0x26e83c=new Date(_0x33a20f[_0x228eaf(0xe3)]()-0x1e*0x18*0x3c*0x3c*0x3e8);const _0x5771d4=new Date(Date[_0x228eaf(0x1c3)](_0x33a20f[_0x228eaf(0x12a)](),_0x33a20f[_0x228eaf(0x110)](),_0x33a20f[_0x228eaf(0xc5)]()-0x1e));_0x26e83c=new Date(Date[_0x228eaf(0x1c3)](_0x5771d4[_0x228eaf(0x12a)](),_0x5771d4[_0x228eaf(0x110)](),_0x5771d4['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x3f40be=new Date(Date[_0x228eaf(0x1c3)](_0x33a20f[_0x228eaf(0x12a)](),_0x33a20f[_0x228eaf(0x110)](),_0x33a20f['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}const _0xf2bda3={'gte':_0x26e83c,'lte':_0x3f40be},[_0x5aab96,_0x417ad4,_0x3afb0d,_0x4534aa,_0x387dfb,_0x547a72,_0x438a3b,_0x35a43b]=await Promise[_0x228eaf(0x1b9)]([database_1[_0x228eaf(0x153)][_0x228eaf(0x14b)]['count'](),database_1[_0x228eaf(0x153)]['shop'][_0x228eaf(0xa8)]({'where':{'status':_0x228eaf(0x199)}}),database_1[_0x228eaf(0x153)][_0x228eaf(0x115)]['count']({'where':{'status':'PAID','createdAt':_0xf2bda3,'gateway':{'not':_0x228eaf(0x1a1)}}}),database_1[_0x228eaf(0x153)][_0x228eaf(0x115)]['count']({'where':{'status':_0x228eaf(0x105),'createdAt':_0xf2bda3,'gateway':{'not':_0x228eaf(0x1a1)}}}),database_1[_0x228eaf(0x153)][_0x228eaf(0x115)][_0x228eaf(0xa8)]({'where':{'status':_0x228eaf(0xde),'createdAt':_0xf2bda3,'gateway':{'not':_0x228eaf(0x1a1)}}}),database_1[_0x228eaf(0x153)][_0x228eaf(0x115)][_0x228eaf(0x191)]({'where':{'status':_0x228eaf(0x1d4),'createdAt':_0xf2bda3,'gateway':{'not':_0x228eaf(0x1a1)}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x228eaf(0x153)][_0x228eaf(0x115)][_0x228eaf(0x191)]({'where':{'gateway':{'not':'test_gateway'}},'take':0xa,'orderBy':{'createdAt':_0x228eaf(0x1df)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x228eaf(0x153)][_0x228eaf(0x115)]['findMany']({'where':{'createdAt':_0xf2bda3,'gateway':{'not':_0x228eaf(0x1a1)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x4f2107=0x0,_0x323211=0x0;for(const _0x4f931c of _0x547a72){const _0x3f0e83=_0x4f931c[_0x228eaf(0x1c0)]||0x0;_0x4f2107+=_0x3f0e83;if(_0x4f931c['amountAfterGatewayCommissionUSDT']&&_0x4f931c[_0x228eaf(0x1c0)]){const _0x20d17f=_0x4f931c[_0x228eaf(0x1c0)]-_0x4f931c[_0x228eaf(0x11e)];_0x323211+=_0x20d17f;}}const _0x34e0b8=_0x3afb0d>0x0?_0x4f2107/_0x3afb0d:0x0,_0x5d1fdb=this[_0x228eaf(0xfe)](_0x35a43b,_0x26e83c,_0x3f40be),_0x126985=await database_1[_0x228eaf(0x153)]['payment'][_0x228eaf(0xa8)]({'where':{'createdAt':_0xf2bda3,'gateway':{'not':_0x228eaf(0x1a1)},'status':{'notIn':[_0x228eaf(0xe2),_0x228eaf(0x1d8)]}}}),_0x5a4bac=_0x126985>0x0?_0x3afb0d/_0x126985*0x64:0x0;return{'totalShops':_0x5aab96,'activeShops':_0x417ad4,'totalPayments':_0x126985,'successfulPayments':_0x3afb0d,'totalAttempts':_0x126985,'chargebacks':_0x4534aa,'refunds':_0x387dfb,'totalRevenue':Math[_0x228eaf(0x166)](_0x4f2107*0x64)/0x64,'trapayEarnings':Math[_0x228eaf(0x166)](_0x323211*0x64)/0x64,'averagePaymentAmount':Math[_0x228eaf(0x166)](_0x34e0b8*0x64)/0x64,'conversionRate':Math[_0x228eaf(0x166)](_0x5a4bac*0x64)/0x64,'dailyRevenue':_0x5d1fdb['dailyRevenue'],'dailyPayments':_0x5d1fdb['dailyPayments'],'recentPayments':_0x438a3b['map'](_0x1e1cd6=>({'id':_0x1e1cd6['id'],'amount':_0x1e1cd6[_0x228eaf(0x11c)],'currency':_0x1e1cd6[_0x228eaf(0xef)],'status':_0x1e1cd6[_0x228eaf(0x187)],'gateway':_0x1e1cd6[_0x228eaf(0x8e)],'shop':_0x1e1cd6[_0x228eaf(0x14b)],'createdAt':_0x1e1cd6['createdAt']}))};}}async['getMerchantStatistics'](_0x555555){const _0x311421=a46_0x1d78d3;console[_0x311421(0x17f)]('ðŸ“Š\x20Getting\x20merchant\x20statistics\x20with\x20filters:',_0x555555);let _0x1f0242,_0xcdc23e=new Date();if(_0x555555[_0x311421(0x1e5)]===_0x311421(0x180)&&_0x555555[_0x311421(0x1af)]&&_0x555555[_0x311421(0x8c)])_0x1f0242=new Date(_0x555555[_0x311421(0x1af)]),_0xcdc23e=new Date(_0x555555[_0x311421(0x8c)]),_0x1f0242[_0x311421(0x119)](0x0,0x0,0x0,0x0),_0xcdc23e[_0x311421(0x119)](0x17,0x3b,0x3b,0x3e7);else{const _0x5fb293=new Date();switch(_0x555555[_0x311421(0x1e5)]){case _0x311421(0xaa):_0x1f0242=new Date(_0x5fb293[_0x311421(0xe3)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x311421(0xe0):_0x1f0242=new Date(_0x5fb293[_0x311421(0xe3)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x311421(0xd2):_0x1f0242=new Date(_0x5fb293[_0x311421(0xe3)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x311421(0x1b9):default:_0x1f0242=new Date(_0x311421(0xdf));break;}_0x1f0242[_0x311421(0x119)](0x0,0x0,0x0,0x0),_0xcdc23e[_0x311421(0x119)](0x17,0x3b,0x3b,0x3e7);}console[_0x311421(0x17f)]('ðŸ“…\x20Period:\x20'+_0x1f0242[_0x311421(0xbe)]()+_0x311421(0x8f)+_0xcdc23e[_0x311421(0xbe)]());const _0x1873e4={'status':_0x311421(0x1d4),'gateway':{'not':_0x311421(0x1a1)},'paidAt':{'gte':_0x1f0242,'lte':_0xcdc23e}};_0x555555[_0x311421(0x100)]&&(_0x1873e4[_0x311421(0x100)]=_0x555555['shopId']);const _0x148f9e=await database_1[_0x311421(0x153)][_0x311421(0x115)][_0x311421(0x191)]({'where':_0x1873e4,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x311421(0x17f)](_0x311421(0xdb)+_0x148f9e[_0x311421(0x1b4)]+_0x311421(0x177));const _0x5e9dbf={'gateway':{'not':_0x311421(0x1a1)},'status':{'notIn':['PENDING','EXPIRED']},'createdAt':{'gte':_0x1f0242,'lte':_0xcdc23e}};_0x555555[_0x311421(0x100)]&&(_0x5e9dbf['shopId']=_0x555555[_0x311421(0x100)]);const _0x2f314f=await database_1[_0x311421(0x153)]['payment']['count']({'where':_0x5e9dbf}),_0x544373={..._0x5e9dbf,'status':_0x311421(0x105)},_0x1940f5={..._0x5e9dbf,'status':_0x311421(0xde)},[_0x5cd879,_0x217416]=await Promise[_0x311421(0x1b9)]([database_1[_0x311421(0x153)][_0x311421(0x115)][_0x311421(0xa8)]({'where':_0x544373}),database_1[_0x311421(0x153)][_0x311421(0x115)]['count']({'where':_0x1940f5})]);console[_0x311421(0x17f)]('ðŸ“Š\x20Total\x20payments\x20(including\x20failed):\x20'+_0x2f314f+_0x311421(0x18b)+_0x148f9e[_0x311421(0x1b4)]+_0x311421(0x1f4)+_0x5cd879+_0x311421(0x197)+_0x217416);let _0x327e97=0x0,_0x4abebb=0x0,_0x1e25f3=0x0;const _0x44ef7d={},_0x171766={},_0x1d9424={};for(const _0x49fcd3 of _0x148f9e){try{const _0x1e879f=_0x49fcd3[_0x311421(0x1c0)]||0x0;if(_0x1e879f<=0x0){console[_0x311421(0x193)]('âš ï¸\x20Payment\x20'+_0x49fcd3['id']+'\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...');continue;}let _0xbfa4b8,_0x48166a;if(_0x49fcd3[_0x311421(0x11e)]!==null&&_0x49fcd3[_0x311421(0x11e)]!==undefined)_0xbfa4b8=_0x49fcd3['amountAfterGatewayCommissionUSDT'],_0x48166a=_0x1e879f-_0xbfa4b8,console[_0x311421(0x17f)](_0x311421(0x142)+_0x49fcd3['id']+':\x20'+_0x1e879f[_0x311421(0x1a5)](0x6)+_0x311421(0xe6)+_0xbfa4b8[_0x311421(0x1a5)](0x6)+'\x20USDT');else{let _0x529e6b={};if(_0x49fcd3[_0x311421(0x14b)][_0x311421(0x1cb)])try{_0x529e6b=JSON['parse'](_0x49fcd3['shop'][_0x311421(0x1cb)]);}catch(_0x2ddf13){console[_0x311421(0xff)]('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x49fcd3[_0x311421(0x100)]+':',_0x2ddf13);}let _0x2c4c5a=0x2d;for(const [_0x23b692,_0x45ebf4]of Object['entries'](_0x529e6b)){if(_0x23b692[_0x311421(0xd9)]()===_0x49fcd3[_0x311421(0x8e)][_0x311421(0xd9)]()){_0x2c4c5a=_0x45ebf4[_0x311421(0x18a)]||0x2d;break;}}_0x48166a=_0x1e879f*(_0x2c4c5a/0x64),_0xbfa4b8=_0x1e879f-_0x48166a,console[_0x311421(0x17f)](_0x311421(0x9d)+_0x49fcd3['id']+':\x20'+_0x2c4c5a+_0x311421(0xbd)+_0x1e879f[_0x311421(0x1a5)](0x6)+_0x311421(0x1c5));}_0x327e97+=_0x1e879f,_0x4abebb+=_0xbfa4b8,_0x1e25f3+=_0x48166a;let _0x50f8a0;_0x49fcd3[_0x311421(0x149)]!==null&&_0x49fcd3[_0x311421(0x149)]!==undefined?(_0x50f8a0=_0x49fcd3[_0x311421(0x149)],console['log'](_0x311421(0x134)+_0x49fcd3['id']+':\x20'+_0x50f8a0+'%')):(_0x50f8a0=_0x1e879f>0x0?_0x48166a/_0x1e879f*0x64:0x0,console[_0x311421(0x17f)](_0x311421(0xa7)+_0x49fcd3['id']+':\x20'+_0x50f8a0[_0x311421(0x1a5)](0x2)+'%'));!_0x44ef7d[_0x49fcd3[_0x311421(0x8e)]]&&(_0x44ef7d[_0x49fcd3['gateway']]={'gateway':_0x49fcd3[_0x311421(0x8e)],'gatewayDisplayName':this[_0x311421(0x1bb)](_0x49fcd3['gateway']),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x44ef7d[_0x49fcd3['gateway']]['paymentsCount']++,_0x44ef7d[_0x49fcd3['gateway']]['turnoverUSDT']+=_0x1e879f,_0x44ef7d[_0x49fcd3[_0x311421(0x8e)]][_0x311421(0xf3)]+=_0x48166a,_0x44ef7d[_0x49fcd3[_0x311421(0x8e)]][_0x311421(0x1be)]+=_0xbfa4b8,_0x44ef7d[_0x49fcd3[_0x311421(0x8e)]][_0x311421(0x18d)]+=_0x50f8a0;!_0x555555['shopId']&&(!_0x171766[_0x49fcd3[_0x311421(0x100)]]&&(_0x171766[_0x49fcd3[_0x311421(0x100)]]={'shopId':_0x49fcd3['shopId'],'shopName':_0x49fcd3[_0x311421(0x14b)][_0x311421(0x1e4)],'shopUsername':_0x49fcd3[_0x311421(0x14b)][_0x311421(0x1dc)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x171766[_0x49fcd3[_0x311421(0x100)]][_0x311421(0x1d5)]++,_0x171766[_0x49fcd3[_0x311421(0x100)]][_0x311421(0x148)]+=_0x1e879f,_0x171766[_0x49fcd3['shopId']][_0x311421(0xf3)]+=_0x48166a,_0x171766[_0x49fcd3['shopId']][_0x311421(0x1be)]+=_0xbfa4b8);const _0x5ef4d3=_0x49fcd3[_0x311421(0xb4)][_0x311421(0xbe)]()['split']('T')[0x0];!_0x1d9424[_0x5ef4d3]&&(_0x1d9424[_0x5ef4d3]={'date':_0x5ef4d3,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x1d9424[_0x5ef4d3][_0x311421(0x89)]+=_0x1e879f,_0x1d9424[_0x5ef4d3][_0x311421(0x15d)]+=_0xbfa4b8,_0x1d9424[_0x5ef4d3]['gatewayEarnings']+=_0x48166a,_0x1d9424[_0x5ef4d3][_0x311421(0x1d5)]++;}catch(_0x15fe45){console[_0x311421(0xff)](_0x311421(0xf0)+_0x49fcd3['id']+':',_0x15fe45);}}Object['values'](_0x44ef7d)['forEach'](_0xf1328=>{const _0x144da0=_0x311421;_0xf1328[_0x144da0(0x157)]=_0xf1328[_0x144da0(0x1d5)]>0x0?_0xf1328['totalCommissionRate']/_0xf1328['paymentsCount']:0x0,delete _0xf1328[_0x144da0(0x18d)];}),Object['values'](_0x171766)[_0x311421(0x138)](_0x54ff74=>{const _0x341b26=_0x311421;_0x54ff74[_0x341b26(0xcc)]=_0x54ff74['paymentsCount']>0x0?_0x54ff74['turnoverUSDT']/_0x54ff74[_0x341b26(0x1d5)]:0x0;});let _0x5c13c1=0x0,_0x5ee1e2=0x0;if(_0x555555[_0x311421(0x100)]){const _0x491e63=await database_1[_0x311421(0x153)][_0x311421(0x188)]['findMany']({'where':{'shopId':_0x555555[_0x311421(0x100)],'status':_0x311421(0xc7),'createdAt':{'gte':_0x1f0242,'lte':_0xcdc23e}},'select':{'amount':!![]}});_0x5c13c1=_0x491e63[_0x311421(0xb1)]((_0x22cbd4,_0xdba3af)=>_0x22cbd4+_0xdba3af['amount'],0x0);const _0x266518=await database_1[_0x311421(0x153)][_0x311421(0x188)]['findMany']({'where':{'shopId':_0x555555[_0x311421(0x100)],'status':_0x311421(0xe2),'createdAt':{'gte':_0x1f0242,'lte':_0xcdc23e}},'select':{'amount':!![]}});_0x5ee1e2=_0x266518[_0x311421(0xb1)]((_0x3f07a4,_0x514579)=>_0x3f07a4+_0x514579[_0x311421(0x11c)],0x0);}const _0x5a8efa=_0x2f314f,_0x1d24b0=_0x148f9e[_0x311421(0x1b4)],_0xd0abfa=_0x1d24b0>0x0?_0x327e97/_0x1d24b0:0x0,_0x1ba6ac=_0x5a8efa>0x0?Math['round'](_0x1d24b0/_0x5a8efa*0x2710)/0x64:0x0,_0x3c7d08=Math[_0x311421(0x1aa)]((_0xcdc23e[_0x311421(0xe3)]()-_0x1f0242[_0x311421(0xe3)]())/(0x3e8*0x3c*0x3c*0x18)),_0xd30a5e={'totalTurnover':Math[_0x311421(0x166)](_0x327e97*0x64)/0x64,'merchantEarnings':Math[_0x311421(0x166)](_0x4abebb*0x64)/0x64,'gatewayEarnings':Math[_0x311421(0x166)](_0x1e25f3*0x64)/0x64,'totalPaidOut':Math[_0x311421(0x166)](_0x5c13c1*0x64)/0x64,'pendingPayout':Math[_0x311421(0x166)](_0x5ee1e2*0x64)/0x64,'averageCheck':Math[_0x311421(0x166)](_0xd0abfa*0x64)/0x64,'totalPayments':_0x5a8efa,'successfulPayments':_0x1d24b0,'conversionRate':_0x1ba6ac,'chargebacks':_0x5cd879,'refunds':_0x217416,'gatewayBreakdown':Object[_0x311421(0x11a)](_0x44ef7d)[_0x311421(0x1b3)](_0x2e6b71=>({..._0x2e6b71,'turnoverUSDT':Math[_0x311421(0x166)](_0x2e6b71[_0x311421(0x148)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x2e6b71['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x311421(0x166)](_0x2e6b71[_0x311421(0x1be)]*0x64)/0x64,'averageCommissionRate':Math[_0x311421(0x166)](_0x2e6b71[_0x311421(0x157)]*0x64)/0x64})),'merchantBreakdown':_0x555555[_0x311421(0x100)]?undefined:Object[_0x311421(0x11a)](_0x171766)['map'](_0x5b74d6=>({..._0x5b74d6,'turnoverUSDT':Math['round'](_0x5b74d6['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x311421(0x166)](_0x5b74d6[_0x311421(0xf3)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x5b74d6[_0x311421(0x1be)]*0x64)/0x64,'paidOutUSDT':Math['round'](_0x5b74d6[_0x311421(0xa2)]*0x64)/0x64,'averageCheckUSDT':Math[_0x311421(0x166)](_0x5b74d6[_0x311421(0xcc)]*0x64)/0x64})),'dailyData':Object['values'](_0x1d9424)[_0x311421(0x1b3)](_0x262c77=>({..._0x262c77,'turnover':Math['round'](_0x262c77[_0x311421(0x89)]*0x64)/0x64,'merchantEarnings':Math[_0x311421(0x166)](_0x262c77[_0x311421(0x15d)]*0x64)/0x64,'gatewayEarnings':Math[_0x311421(0x166)](_0x262c77[_0x311421(0x159)]*0x64)/0x64}))[_0x311421(0xd0)]((_0x353c62,_0x1a4d93)=>_0x353c62[_0x311421(0x16c)][_0x311421(0x1d9)](_0x1a4d93[_0x311421(0x16c)])),'periodInfo':{'from':_0x1f0242,'to':_0xcdc23e,'periodType':_0x555555[_0x311421(0x1e5)]||_0x311421(0x180),'daysCount':_0x3c7d08}};return console[_0x311421(0x17f)](_0x311421(0xe4)),console[_0x311421(0x17f)](_0x311421(0xa5)+_0xd30a5e[_0x311421(0xd8)]+_0x311421(0x1c5)),console[_0x311421(0x17f)]('\x20\x20\x20ðŸ‘¤\x20Merchant\x20earnings:\x20'+_0xd30a5e[_0x311421(0x15d)]+'\x20USDT'),console[_0x311421(0x17f)](_0x311421(0xad)+_0xd30a5e[_0x311421(0x159)]+_0x311421(0x1c5)),console[_0x311421(0x17f)]('\x20\x20\x20ï¿½\x20Total\x20paid\x20out:\x20'+_0xd30a5e[_0x311421(0x9b)]+_0x311421(0x1c5)),console['log']('\x20\x20\x20â³\x20Pending\x20payout:\x20'+_0xd30a5e[_0x311421(0x120)]+_0x311421(0x1c5)),console[_0x311421(0x17f)](_0x311421(0x198)+_0xd30a5e[_0x311421(0xce)]),_0xd30a5e;}async[a46_0x1d78d3(0x9e)](_0x31fd55){const _0xaf630a=a46_0x1d78d3;console[_0xaf630a(0x17f)]('ðŸ“‹\x20Getting\x20merchants\x20selection\x20list...',{'hasPayoutHistory':_0x31fd55});let _0xa90d5e={};_0x31fd55&&(_0xa90d5e[_0xaf630a(0x1a6)]={'some':{}});const _0x1f97f1=await database_1[_0xaf630a(0x153)]['shop']['findMany']({'where':_0xa90d5e,'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0xaf630a(0x12c)}});return console['log'](_0xaf630a(0x8a)+_0x1f97f1[_0xaf630a(0x1b4)]+'\x20merchants\x20for\x20selection'+(_0x31fd55?_0xaf630a(0x1e1):'')),_0x1f97f1[_0xaf630a(0x1b3)](_0x42c4d2=>({'id':_0x42c4d2['id'],'username':_0x42c4d2[_0xaf630a(0x1dc)],'name':_0x42c4d2['name']}));}[a46_0x1d78d3(0x1bb)](_0x158bca){const _0x4b2441=a46_0x1d78d3,_0x4b29c={'test_gateway':_0x4b2441(0x1ac),'plisio':_0x4b2441(0x113),'rapyd':_0x4b2441(0x106),'noda':_0x4b2441(0x1d7),'cointopay':_0x4b2441(0x172),'cointopay2':_0x4b2441(0x1ae),'klyme_eu':_0x4b2441(0x17e),'klyme_gb':'KLYME\x20GB','klyme_de':'KLYME\x20DE','mastercard':_0x4b2441(0x101)};return _0x4b29c[_0x158bca]||_0x158bca;}[a46_0x1d78d3(0x196)](_0x9fae8){const _0x32c6fa=a46_0x1d78d3,_0x50f097={'Test\x20Gateway':_0x32c6fa(0x1a1),'Plisio':'plisio','Rapyd':'rapyd','Noda':_0x32c6fa(0x1a8),'CoinToPay':_0x32c6fa(0x15f),'CoinToPay2':'cointopay2','KLYME\x20EU':_0x32c6fa(0x1ee),'KLYME\x20GB':_0x32c6fa(0xc9),'KLYME\x20DE':_0x32c6fa(0x1ec),'MasterCard':'mastercard'};return _0x50f097[_0x9fae8]||_0x9fae8[_0x32c6fa(0xd9)]();}async[a46_0x1d78d3(0x1db)](_0x2a10aa){const _0x2e4e0b=a46_0x1d78d3,{page:_0x45c8f4,limit:_0x248090,minAmount:_0x1583a5,search:_0x9bd3ae}=_0x2a10aa;console['log'](_0x2e4e0b(0xa3),_0x2a10aa);let _0x4d5713={};_0x9bd3ae&&(_0x4d5713['name']={'contains':_0x9bd3ae,'mode':_0x2e4e0b(0xcd)});const _0x302b83=await database_1[_0x2e4e0b(0x153)][_0x2e4e0b(0x14b)][_0x2e4e0b(0x191)]({'where':_0x4d5713,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),_0xe590d0=_0x302b83[_0x2e4e0b(0x1c6)](_0x167229=>{const _0x42e335=_0x2e4e0b,_0x63251e=Math['floor'](_0x167229[_0x42e335(0x1d6)]*0x64)/0x64;if(_0x1583a5&&_0x63251e<_0x1583a5)return![];return _0x63251e!==0x0;});_0xe590d0['sort']((_0x1eaaec,_0x270bfc)=>_0x270bfc[_0x2e4e0b(0x1d6)]-_0x1eaaec[_0x2e4e0b(0x1d6)]);const _0x2a8c06=_0xe590d0[_0x2e4e0b(0x1b4)],_0x2210b0=(_0x45c8f4-0x1)*_0x248090,_0x73cb1b=_0xe590d0['slice'](_0x2210b0,_0x2210b0+_0x248090);console[_0x2e4e0b(0x17f)](_0x2e4e0b(0xdb)+_0x73cb1b[_0x2e4e0b(0x1b4)]+_0x2e4e0b(0xf6));const _0x1a07a7=await Promise[_0x2e4e0b(0x1b9)](_0x73cb1b['map'](async _0x15b6f9=>{const _0x1a062a=_0x2e4e0b,[_0x356856,_0x57feb4,_0x8cfcdf]=await Promise[_0x1a062a(0x1b9)]([database_1[_0x1a062a(0x153)][_0x1a062a(0x115)]['count']({'where':{'shopId':_0x15b6f9['id'],'status':_0x1a062a(0x1d4),'gateway':{'not':_0x1a062a(0x1a1)}}}),database_1[_0x1a062a(0x153)][_0x1a062a(0x115)][_0x1a062a(0x195)]({'where':{'shopId':_0x15b6f9['id'],'status':'PAID','gateway':{'not':_0x1a062a(0x1a1)}},'orderBy':{'paidAt':_0x1a062a(0x12c)},'select':{'paidAt':!![]}}),database_1[_0x1a062a(0x153)][_0x1a062a(0x115)]['groupBy']({'by':[_0x1a062a(0x8e)],'where':{'shopId':_0x15b6f9['id'],'status':_0x1a062a(0x1d4),'gateway':{'not':_0x1a062a(0x1a1)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x2bea20=new Date(),_0x1a3058=new Date(_0x2bea20['getFullYear'](),_0x2bea20['getMonth'](),0x1),_0x154de2=new Date(_0x2bea20[_0x1a062a(0x1bd)](),_0x2bea20[_0x1a062a(0x9c)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0xb506f5,_0x4e39f4]=await Promise[_0x1a062a(0x1b9)]([database_1[_0x1a062a(0x153)][_0x1a062a(0x188)]['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x15b6f9['id'],'status':'COMPLETED'}}),database_1[_0x1a062a(0x153)][_0x1a062a(0x188)][_0x1a062a(0xd4)]({'_sum':{'amount':!![]},'where':{'shopId':_0x15b6f9['id'],'status':'COMPLETED','createdAt':{'gte':_0x1a3058,'lte':_0x154de2}}})]),_0x38f00a=_0xb506f5['_sum'][_0x1a062a(0x11c)]||0x0,_0x312006=_0x4e39f4[_0x1a062a(0x14e)]['amount']||0x0,_0x1c86a6=await Promise[_0x1a062a(0x1b9)](_0x8cfcdf[_0x1a062a(0x1b3)](async _0x357cd0=>{const _0x4aeb33=_0x1a062a;let _0x4a7e9b=0x2d;if(_0x15b6f9[_0x4aeb33(0x1cb)])try{const _0x3bfb3c=JSON[_0x4aeb33(0x111)](_0x15b6f9['gatewaySettings']);for(const [_0x26b0fe,_0x235f05]of Object[_0x4aeb33(0x19a)](_0x3bfb3c)){if(_0x26b0fe[_0x4aeb33(0xd9)]()===_0x357cd0['gateway'][_0x4aeb33(0xd9)]()){_0x4a7e9b=_0x235f05[_0x4aeb33(0x18a)]||0xa,console['log'](_0x4aeb33(0x1d3)+_0x357cd0[_0x4aeb33(0x8e)]+_0x4aeb33(0x88)+_0x15b6f9['id']+_0x4aeb33(0x8d)+_0x4a7e9b+'%');break;}}}catch(_0x2b839b){console[_0x4aeb33(0xff)]('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x15b6f9['id']+':',_0x2b839b);}const _0x40bed5=_0x357cd0[_0x4aeb33(0x14e)]?.[_0x4aeb33(0x1c0)]||0x0,_0x28e857=_0x40bed5*(0x1-_0x4a7e9b/0x64);return{'gateway':_0x357cd0[_0x4aeb33(0x8e)],'count':_0x357cd0[_0x4aeb33(0x1a4)]?.['id']||0x0,'amountUSDT':Math['round'](_0x40bed5*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x4aeb33(0x166)](_0x28e857*0x64)/0x64,'commission':_0x4a7e9b};})),_0x4109f1=_0x1c86a6[_0x1a062a(0xb1)]((_0x4b19b8,_0xcc5ff7)=>_0x4b19b8+_0xcc5ff7[_0x1a062a(0x1c0)],0x0),_0xf1c8b6=_0x1c86a6[_0x1a062a(0xb1)]((_0x28fe57,_0x22d2a6)=>_0x28fe57+_0x22d2a6[_0x1a062a(0x99)],0x0),_0x4594b1=_0x15b6f9['balance'];return console[_0x1a062a(0x17f)]('ðŸ’°\x20[PAYOUT]\x20Merchant\x20'+_0x15b6f9[_0x1a062a(0x1dc)]+':'),console['log'](_0x1a062a(0x189)+_0x4109f1[_0x1a062a(0x1a5)](0x2)+_0x1a062a(0x11b)),console['log'](_0x1a062a(0xdd)+_0xf1c8b6['toFixed'](0x2)+_0x1a062a(0x133)),console[_0x1a062a(0x17f)](_0x1a062a(0x11f)+_0x4594b1[_0x1a062a(0x1a5)](0x2)+_0x1a062a(0x15b)),console[_0x1a062a(0x17f)]('\x20\x20\x20ðŸ’¸\x20Total\x20payouts:\x20'+_0x38f00a['toFixed'](0x2)+_0x1a062a(0xb2)),console[_0x1a062a(0x17f)](_0x1a062a(0x186)+(_0xf1c8b6-_0x38f00a-_0x4594b1)['toFixed'](0x2)+_0x1a062a(0x1ed)),{'id':_0x15b6f9['id'],'fullName':_0x15b6f9[_0x1a062a(0x1e4)],'username':_0x15b6f9['username'],'telegramId':_0x15b6f9['telegram'],'merchantUrl':_0x15b6f9[_0x1a062a(0x13c)],'wallets':{'usdtPolygonWallet':_0x15b6f9[_0x1a062a(0x151)],'usdtTrcWallet':_0x15b6f9[_0x1a062a(0x16a)],'usdtErcWallet':_0x15b6f9[_0x1a062a(0xfb)],'usdcPolygonWallet':_0x15b6f9[_0x1a062a(0x17d)],'usdcErcWallet':_0x15b6f9[_0x1a062a(0xf9)]},'totalAmountUSDT':Math[_0x1a062a(0x166)](_0x4109f1*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0xf1c8b6*0x64)/0x64,'currentBalance':Math[_0x1a062a(0xd1)](_0x4594b1*0x64)/0x64,'totalPayout':Math['round'](_0x38f00a*0x64)/0x64,'thisMonth':Math['round'](_0x312006*0x64)/0x64,'paymentsCount':_0x356856,'oldestPaymentDate':_0x57feb4?.[_0x1a062a(0xb4)]||_0x15b6f9[_0x1a062a(0x1c2)],'gatewayBreakdown':_0x1c86a6};})),_0x5b88f2=_0x1a07a7['reduce']((_0x225601,_0xdc3a32)=>_0x225601+_0xdc3a32[_0x2e4e0b(0x109)],0x0),_0x4db33f=_0x1a07a7[_0x2e4e0b(0xb1)]((_0x29ce97,_0x12d597)=>_0x29ce97+_0x12d597[_0x2e4e0b(0x181)],0x0),_0x244d1b=_0x1a07a7[_0x2e4e0b(0xb1)]((_0x462454,_0x12ef08)=>_0x462454+_0x12ef08[_0x2e4e0b(0x1b5)],0x0),_0x3250da=_0x1a07a7[_0x2e4e0b(0xb1)]((_0x5d9fb4,_0x5c7106)=>_0x5d9fb4+_0x5c7106[_0x2e4e0b(0x10d)],0x0);return console[_0x2e4e0b(0x17f)](_0x2e4e0b(0x122)+_0x2a8c06+_0x2e4e0b(0xd7)),console[_0x2e4e0b(0x17f)]('\x20\x20\x20ðŸ’°\x20Total\x20payments\x20turnover:\x20'+Math['round'](_0x5b88f2*0x64)/0x64+_0x2e4e0b(0x11b)),console[_0x2e4e0b(0x17f)](_0x2e4e0b(0x118)+Math[_0x2e4e0b(0x166)](_0x4db33f*0x64)/0x64+_0x2e4e0b(0x184)),console[_0x2e4e0b(0x17f)](_0x2e4e0b(0xb0)+Math[_0x2e4e0b(0x166)](_0x244d1b*0x64)/0x64+_0x2e4e0b(0x1c5)),console[_0x2e4e0b(0x17f)](_0x2e4e0b(0x126)+Math[_0x2e4e0b(0x166)](_0x3250da*0x64)/0x64+_0x2e4e0b(0x1c5)),{'merchants':_0x1a07a7,'pagination':{'page':_0x45c8f4,'limit':_0x248090,'total':_0x2a8c06,'totalPages':Math[_0x2e4e0b(0x1aa)](_0x2a8c06/_0x248090)},'summary':{'totalMerchants':_0x2a8c06,'totalAmountUSDT':Math[_0x2e4e0b(0x166)](_0x5b88f2*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x4db33f*0x64)/0x64,'totalPayout':Math[_0x2e4e0b(0x166)](_0x244d1b*0x64)/0x64,'thisMonth':Math[_0x2e4e0b(0x166)](_0x3250da*0x64)/0x64}};}async[a46_0x1d78d3(0x18c)](_0x6e5595){const _0x207c17=a46_0x1d78d3,{shopId:_0x4d1f43,amount:_0xabad6f,network:_0x5cc28f,wallet:_0x32c2ad,notes:_0x26fde8,txid:_0xa71fac,periodFrom:_0x463dde,periodTo:_0x33ca86}=_0x6e5595,_0x305ccf=await database_1['default'][_0x207c17(0x132)](async _0x318a4b=>{const _0x2369f5=_0x207c17,_0x583baa=await _0x318a4b['shop']['findUnique']({'where':{'id':_0x4d1f43},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x583baa)throw new Error(_0x2369f5(0x1e8));console['log']('ðŸ’°\x20Creating\x20payout\x20for\x20shop\x20'+_0x583baa[_0x2369f5(0x1dc)]+':'),console['log'](_0x2369f5(0x13e)+_0x583baa[_0x2369f5(0x1d6)][_0x2369f5(0x1a5)](0x6)+_0x2369f5(0x1c5)),console['log'](_0x2369f5(0xf5)+_0xabad6f['toFixed'](0x6)+_0x2369f5(0x1c5)),console[_0x2369f5(0x17f)](_0x2369f5(0xaf)+_0x583baa[_0x2369f5(0x9b)][_0x2369f5(0x1a5)](0x6)+_0x2369f5(0x1c5));if(_0xa71fac)console[_0x2369f5(0x17f)](_0x2369f5(0x1de)+_0xa71fac);const _0x19b5e5=0.000001,_0x43ca34=Number(_0x583baa[_0x2369f5(0x1d6)]),_0x2b4211=Number(_0xabad6f);console[_0x2369f5(0x17f)](_0x2369f5(0x143)),console[_0x2369f5(0x17f)]('\x20\x20\x20Available\x20(raw):\x20'+_0x583baa[_0x2369f5(0x1d6)]),console[_0x2369f5(0x17f)](_0x2369f5(0x18f)+_0x43ca34),console['log']('\x20\x20\x20Requested\x20(number):\x20'+_0x2b4211),console[_0x2369f5(0x17f)]('\x20\x20\x20Difference:\x20'+(_0x43ca34-_0x2b4211)),console[_0x2369f5(0x17f)](_0x2369f5(0x1cd)+_0x19b5e5);if(_0x43ca34<_0x2b4211-_0x19b5e5)throw new Error(_0x2369f5(0x108)+_0x43ca34[_0x2369f5(0x1a5)](0x6)+_0x2369f5(0x17a)+_0x2b4211[_0x2369f5(0x1a5)](0x6)+'\x20USDT,\x20Difference:\x20'+(_0x43ca34-_0x2b4211)['toFixed'](0x8)+_0x2369f5(0x1c5));console[_0x2369f5(0x17f)]('âœ…\x20Balance\x20check\x20passed\x20(with\x20tolerance)');const _0x34f8e2=Math[_0x2369f5(0x14a)](_0x43ca34,_0x2b4211);let _0x4f9186=_0x32c2ad;console[_0x2369f5(0x17f)](_0x2369f5(0x194)+(_0x32c2ad||_0x2369f5(0xed)));if(!_0x4f9186){console[_0x2369f5(0x17f)](_0x2369f5(0x170));const _0x5c4460=await _0x318a4b['shop'][_0x2369f5(0x130)]({'where':{'id':_0x4d1f43},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});console[_0x2369f5(0x17f)](_0x2369f5(0xf2),_0x5c4460);if(_0x5c4460)switch(_0x5cc28f){case'polygon':_0x4f9186=_0x5c4460[_0x2369f5(0x151)]||undefined,console[_0x2369f5(0x17f)](_0x2369f5(0xb9)+_0x4f9186);break;case _0x2369f5(0x14c):_0x4f9186=_0x5c4460[_0x2369f5(0x16a)]||undefined,console[_0x2369f5(0x17f)](_0x2369f5(0x1c1)+_0x4f9186);break;case'erc20':_0x4f9186=_0x5c4460[_0x2369f5(0xfb)]||undefined,console[_0x2369f5(0x17f)](_0x2369f5(0x1b7)+_0x4f9186);break;case _0x2369f5(0x17b):_0x4f9186=_0x5c4460[_0x2369f5(0x17d)]||undefined,console[_0x2369f5(0x17f)](_0x2369f5(0xf8)+_0x4f9186);break;case _0x2369f5(0x192):_0x4f9186=_0x5c4460[_0x2369f5(0xf9)]||undefined,console[_0x2369f5(0x17f)](_0x2369f5(0x15c)+_0x4f9186);break;}}else console[_0x2369f5(0x17f)](_0x2369f5(0x1f3)+_0x4f9186);console[_0x2369f5(0x17f)](_0x2369f5(0x94)+_0x5cc28f+':\x20'+(_0x4f9186||_0x2369f5(0x1ef))),console[_0x2369f5(0x17f)]('ðŸ”\x20Creating\x20payout\x20with\x20data:',{'shopId':_0x4d1f43,'amount':_0x34f8e2,'network':_0x5cc28f,'wallet':_0x4f9186,'status':'COMPLETED','txid':_0xa71fac,'notes':_0x26fde8,'periodFrom':_0x463dde?new Date(_0x463dde):null,'periodTo':_0x33ca86?new Date(_0x33ca86):null});const _0x520c7b=await _0x318a4b['payout']['create']({'data':{'shopId':_0x4d1f43,'amount':_0x34f8e2,'network':_0x5cc28f,'wallet':_0x4f9186,'status':_0x2369f5(0xc7),'txid':_0xa71fac,'notes':_0x26fde8,'periodFrom':_0x463dde?new Date(_0x463dde):null,'periodTo':_0x33ca86?new Date(_0x33ca86):null,'createdAt':new Date(),'paidAt':new Date()}});console[_0x2369f5(0x17f)]('âœ…\x20Payout\x20created\x20in\x20DB:',{'id':_0x520c7b['id'],'wallet':_0x520c7b['wallet'],'network':_0x520c7b['network'],'amount':_0x520c7b[_0x2369f5(0x11c)]});const _0x3b4a39=_0x43ca34-_0x34f8e2,_0x4002b7=Number(_0x583baa['totalPaidOut'])+_0x34f8e2;return await _0x318a4b[_0x2369f5(0x14b)][_0x2369f5(0xc1)]({'where':{'id':_0x4d1f43},'data':{'balance':_0x3b4a39,'totalPaidOut':_0x4002b7}}),console['log'](_0x2369f5(0x15e)+_0x583baa[_0x2369f5(0x1dc)]+'\x20balance\x20updated:'),console[_0x2369f5(0x17f)]('\x20\x20\x20Balance:\x20'+_0x43ca34[_0x2369f5(0x1a5)](0x6)+_0x2369f5(0x1da)+_0x3b4a39[_0x2369f5(0x1a5)](0x6)+'\x20USDT\x20(-'+_0x34f8e2['toFixed'](0x6)+')'),console[_0x2369f5(0x17f)](_0x2369f5(0x147)+_0x583baa['totalPaidOut'][_0x2369f5(0x1a5)](0x6)+_0x2369f5(0x1da)+_0x4002b7['toFixed'](0x6)+_0x2369f5(0x171)+_0x34f8e2[_0x2369f5(0x1a5)](0x6)+')'),console[_0x2369f5(0x17f)](_0x2369f5(0x11d)+_0x34f8e2['toFixed'](0x6)+_0x2369f5(0x1c5)),{'payout':_0x520c7b,'shop':_0x583baa};});console[_0x207c17(0x17f)](_0x207c17(0x10e)+_0x305ccf['payout']['id']+_0x207c17(0x88)+_0x305ccf['shop'][_0x207c17(0x1dc)]+'\x20('+_0x305ccf[_0x207c17(0x188)][_0x207c17(0x11c)][_0x207c17(0x1a5)](0x6)+_0x207c17(0xc2));try{let _0x199709=_0x207c17(0xc4);if(_0x305ccf[_0x207c17(0x188)]['periodFrom']&&_0x305ccf[_0x207c17(0x188)]['periodTo']){const _0x5a3991=new Date(_0x305ccf[_0x207c17(0x188)][_0x207c17(0x161)])['toLocaleDateString']('ru-RU'),_0x395831=new Date(_0x305ccf[_0x207c17(0x188)][_0x207c17(0x135)])['toLocaleDateString'](_0x207c17(0x1ce));_0x199709=_0x5a3991+_0x207c17(0x1a2)+_0x395831;}await telegramBotService_1[_0x207c17(0x12b)]['sendPayoutNotification'](_0x305ccf[_0x207c17(0x188)][_0x207c17(0x100)],{'id':_0x305ccf['payout']['id'],'amount':_0x305ccf[_0x207c17(0x188)][_0x207c17(0x11c)],'network':_0x305ccf[_0x207c17(0x188)][_0x207c17(0xe9)],'wallet':_0x305ccf[_0x207c17(0x188)][_0x207c17(0x129)],'period':_0x199709,'createdAt':_0x305ccf[_0x207c17(0x188)][_0x207c17(0x1c2)],'txid':_0x305ccf[_0x207c17(0x188)][_0x207c17(0x124)]}),console[_0x207c17(0x17f)]('ðŸ“±\x20Telegram\x20notification\x20sent\x20for\x20payout\x20'+_0x305ccf[_0x207c17(0x188)]['id']);}catch(_0x164f74){console['error']('âŒ\x20Failed\x20to\x20send\x20Telegram\x20notification\x20for\x20payout\x20'+_0x305ccf[_0x207c17(0x188)]['id']+':',_0x164f74);}return{'id':_0x305ccf['payout']['id'],'shopId':_0x305ccf[_0x207c17(0x188)][_0x207c17(0x100)],'shopName':_0x305ccf['shop'][_0x207c17(0x1e4)],'shopUsername':_0x305ccf[_0x207c17(0x14b)][_0x207c17(0x1dc)],'amount':_0x305ccf[_0x207c17(0x188)][_0x207c17(0x11c)],'network':_0x305ccf[_0x207c17(0x188)][_0x207c17(0xe9)],'wallet':_0x305ccf[_0x207c17(0x188)][_0x207c17(0x129)],'status':_0x305ccf[_0x207c17(0x188)][_0x207c17(0x187)],'txid':_0x305ccf['payout']['txid'],'notes':_0x305ccf[_0x207c17(0x188)][_0x207c17(0xba)],'periodFrom':_0x305ccf[_0x207c17(0x188)][_0x207c17(0x161)],'periodTo':_0x305ccf[_0x207c17(0x188)][_0x207c17(0x135)],'createdAt':_0x305ccf[_0x207c17(0x188)]['createdAt'],'paidAt':_0x305ccf[_0x207c17(0x188)][_0x207c17(0xb4)]};}async['getAllPayouts'](_0x5206c3){const _0x3ed376=a46_0x1d78d3,{page:_0x4f2b1a,limit:_0x5434c2,shopId:_0x13a4d8,network:_0x300cc0,dateFrom:_0x58a38e,dateTo:_0x4df0ff,search:_0x217180}=_0x5206c3,_0x20e9ea=(_0x4f2b1a-0x1)*_0x5434c2,_0x57101d={};_0x13a4d8&&(_0x57101d[_0x3ed376(0x100)]=_0x13a4d8);_0x300cc0&&(_0x57101d[_0x3ed376(0xe9)]=_0x300cc0);if(_0x58a38e||_0x4df0ff){_0x57101d[_0x3ed376(0x1c2)]={};if(_0x58a38e){const _0x5c3bd6=new Date(_0x58a38e);_0x5c3bd6[_0x3ed376(0x119)](0x0,0x0,0x0,0x1),_0x57101d[_0x3ed376(0x1c2)][_0x3ed376(0x96)]=_0x5c3bd6,console['log']('ðŸ“…\x20Payout\x20date\x20from\x20filter:\x20'+_0x5c3bd6[_0x3ed376(0xbe)]());}if(_0x4df0ff){const _0x276d4c=new Date(_0x4df0ff);_0x276d4c['setHours'](0x17,0x3b,0x3b,0x3e7),_0x57101d[_0x3ed376(0x1c2)][_0x3ed376(0x164)]=_0x276d4c,console['log']('ðŸ“…\x20Payout\x20date\x20to\x20filter:\x20'+_0x276d4c[_0x3ed376(0xbe)]());}}_0x217180&&(_0x57101d['OR']=[{'shop':{'name':{'contains':_0x217180,'mode':_0x3ed376(0xcd)}}},{'shop':{'username':{'contains':_0x217180,'mode':'insensitive'}}},{'notes':{'contains':_0x217180,'mode':_0x3ed376(0xcd)}}]);const [_0x39fcbe,_0x2d53ac]=await Promise[_0x3ed376(0x1b9)]([database_1['default']['payout']['findMany']({'where':_0x57101d,'skip':_0x20e9ea,'take':_0x5434c2,'orderBy':{'createdAt':_0x3ed376(0x1df)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'wallet':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x3ed376(0x153)][_0x3ed376(0x188)][_0x3ed376(0xa8)]({'where':_0x57101d})]);return{'payouts':_0x39fcbe['map'](_0x5a966a=>({'id':_0x5a966a['id'],'shopId':_0x5a966a['shopId'],'shopName':_0x5a966a['shop'][_0x3ed376(0x1e4)],'shopUsername':_0x5a966a[_0x3ed376(0x14b)]['username'],'amount':_0x5a966a['amount'],'network':_0x5a966a[_0x3ed376(0xe9)],'wallet':_0x5a966a['wallet'],'status':_0x5a966a[_0x3ed376(0x187)],'txid':_0x5a966a[_0x3ed376(0x124)],'notes':_0x5a966a[_0x3ed376(0xba)],'periodFrom':_0x5a966a[_0x3ed376(0x161)],'periodTo':_0x5a966a[_0x3ed376(0x135)],'createdAt':_0x5a966a[_0x3ed376(0x1c2)],'paidAt':_0x5a966a[_0x3ed376(0xb4)]})),'pagination':{'page':_0x4f2b1a,'limit':_0x5434c2,'total':_0x2d53ac,'totalPages':Math[_0x3ed376(0x1aa)](_0x2d53ac/_0x5434c2)}};}async[a46_0x1d78d3(0xbb)](_0x2d0b34){const _0x3de7af=a46_0x1d78d3,_0x530430=await database_1[_0x3de7af(0x153)][_0x3de7af(0x188)][_0x3de7af(0x130)]({'where':{'id':_0x2d0b34},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x530430)return null;return{'id':_0x530430['id'],'shopId':_0x530430[_0x3de7af(0x100)],'shopName':_0x530430[_0x3de7af(0x14b)][_0x3de7af(0x1e4)],'shopUsername':_0x530430[_0x3de7af(0x14b)][_0x3de7af(0x1dc)],'amount':_0x530430[_0x3de7af(0x11c)],'network':_0x530430[_0x3de7af(0xe9)],'wallet':_0x530430[_0x3de7af(0x129)],'status':_0x530430[_0x3de7af(0x187)],'txid':_0x530430[_0x3de7af(0x124)],'notes':_0x530430['notes'],'periodFrom':_0x530430['periodFrom'],'periodTo':_0x530430[_0x3de7af(0x135)],'createdAt':_0x530430[_0x3de7af(0x1c2)],'paidAt':_0x530430[_0x3de7af(0xb4)]};}async[a46_0x1d78d3(0x1dd)](_0x8253f3){const _0xf0d244=a46_0x1d78d3;await database_1[_0xf0d244(0x153)][_0xf0d244(0x188)][_0xf0d244(0x175)]({'where':{'id':_0x8253f3}});}async[a46_0x1d78d3(0xa4)](_0x37c5b7){const _0xba90bf=a46_0x1d78d3,{page:_0x390889,limit:_0x3494ed,status:_0x1aa05c,gateway:_0x2af7da,shopId:_0x58729a,dateFrom:_0x1c321d,dateTo:_0x3a133c,search:_0x445a66,currency:_0x20c060,sortBy:_0x27a20,sortOrder:_0x5d62a8}=_0x37c5b7,_0x4b4ae7=(_0x390889-0x1)*_0x3494ed;console[_0xba90bf(0x17f)](_0xba90bf(0x92),_0x37c5b7);const _0x435f0e=await database_1['default'][_0xba90bf(0x115)][_0xba90bf(0x1b2)]({'by':['gateway'],'_count':{'gateway':!![]}});console[_0xba90bf(0x17f)](_0xba90bf(0x163),_0x435f0e[_0xba90bf(0x1b3)](_0x46965e=>_0x46965e[_0xba90bf(0x8e)]+'\x20('+_0x46965e[_0xba90bf(0x1a4)][_0xba90bf(0x8e)]+_0xba90bf(0x17c)));if(_0x2af7da){const _0x281250=_0x435f0e[_0xba90bf(0x1ea)](_0x3c0064=>_0x3c0064[_0xba90bf(0x8e)][_0xba90bf(0xd9)]()===_0x2af7da[_0xba90bf(0xd9)]());!_0x281250&&_0x2af7da['toLowerCase']()!==_0xba90bf(0x1a1)&&console[_0xba90bf(0x17f)](_0xba90bf(0x1cc)+_0x2af7da+_0xba90bf(0x9f)+_0x435f0e['map'](_0x333117=>_0x333117[_0xba90bf(0x8e)])['join'](',\x20'));}const _0x1e8f62={};_0x1aa05c&&(_0x1e8f62[_0xba90bf(0x187)]=_0x1aa05c[_0xba90bf(0x19b)]());if(!_0x2af7da)_0x1e8f62[_0xba90bf(0x8e)]={'not':'test_gateway'};else{if(_0x2af7da&&(_0x2af7da[_0xba90bf(0xd9)]()===_0xba90bf(0x1a1)||_0x2af7da===_0xba90bf(0xa1)))_0x1e8f62[_0xba90bf(0x8e)]=_0xba90bf(0x1a1);else{let _0x1c4468=_0x2af7da;const _0x697770=(0x0,gateway_1[_0xba90bf(0x114)])(_0x2af7da);if(_0x697770)_0x1c4468=_0x697770,console['log'](_0xba90bf(0xb5)+_0x2af7da+_0xba90bf(0x1b1)+_0x1c4468+'\x27');else{const _0x4c9975=(0x0,gateway_1[_0xba90bf(0x10c)])(_0x2af7da);if(_0x4c9975){const _0x4e45b8=(0x0,gateway_1[_0xba90bf(0x114)])(_0x4c9975);_0x4e45b8&&(_0x1c4468=_0x4e45b8,console[_0xba90bf(0x17f)]('ðŸ”„\x20Converted\x20gateway\x20name\x20\x27'+_0x2af7da+_0xba90bf(0x140)+_0x4c9975+_0xba90bf(0x1e6)+_0x1c4468+'\x27'));}else console[_0xba90bf(0x17f)](_0xba90bf(0x90)+_0x2af7da+'\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)');}const _0x3a4fd0=await database_1['default'][_0xba90bf(0x115)][_0xba90bf(0xa8)]({'where':{'gateway':_0x1c4468['toLowerCase']()},'take':0x1});_0x3a4fd0===0x0?(console['log']('âš ï¸\x20Gateway\x20\x27'+_0x1c4468+_0xba90bf(0x112)+_0x2af7da+_0xba90bf(0xc3)),_0x1e8f62[_0xba90bf(0x8e)]=_0xba90bf(0x1eb)):(_0x1e8f62[_0xba90bf(0x8e)]=_0x1c4468[_0xba90bf(0xd9)](),console[_0xba90bf(0x17f)](_0xba90bf(0x168)+_0x1c4468+_0xba90bf(0x112)+_0x2af7da+'\x27)'));}}console[_0xba90bf(0x17f)]('ðŸ“Š\x20Gateway\x20filter\x20applied:',_0x1e8f62[_0xba90bf(0x8e)]);_0x58729a&&(_0x1e8f62[_0xba90bf(0x100)]=_0x58729a);_0x20c060&&(_0x1e8f62['currency']=_0x20c060[_0xba90bf(0x19b)](),console[_0xba90bf(0x17f)]('ðŸ’±\x20Currency\x20filter\x20applied:\x20'+_0x20c060[_0xba90bf(0x19b)]()));if(_0x1c321d||_0x3a133c){_0x1e8f62['createdAt']={};if(_0x1c321d){const _0x504550=new Date(_0x1c321d),_0x25cbb2=new Date(Date[_0xba90bf(0x1c3)](_0x504550[_0xba90bf(0x12a)](),_0x504550[_0xba90bf(0x110)](),_0x504550[_0xba90bf(0xc5)](),0x0,0x0,0x0,0x0));_0x1e8f62[_0xba90bf(0x1c2)]['gte']=_0x25cbb2,console[_0xba90bf(0x17f)]('ðŸ“…\x20Date\x20from\x20filter:\x20'+_0x25cbb2[_0xba90bf(0xbe)]());}if(_0x3a133c){const _0x2d82af=new Date(_0x3a133c),_0x8b32b7=new Date(Date['UTC'](_0x2d82af[_0xba90bf(0x12a)](),_0x2d82af['getUTCMonth'](),_0x2d82af['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));_0x1e8f62[_0xba90bf(0x1c2)]['lte']=_0x8b32b7,console['log'](_0xba90bf(0xac)+_0x8b32b7[_0xba90bf(0xbe)]());}}_0x445a66&&(_0x1e8f62['OR']=[{'id':{'contains':_0x445a66,'mode':'insensitive'}},{'orderId':{'contains':_0x445a66,'mode':_0xba90bf(0xcd)}},{'gatewayOrderId':{'contains':_0x445a66,'mode':_0xba90bf(0xcd)}},{'customerEmail':{'contains':_0x445a66,'mode':_0xba90bf(0xcd)}},{'shop':{'name':{'contains':_0x445a66,'mode':_0xba90bf(0xcd)}}},{'shop':{'username':{'contains':_0x445a66,'mode':_0xba90bf(0xcd)}}}]);console[_0xba90bf(0x17f)](_0xba90bf(0x93),JSON['stringify'](_0x1e8f62,null,0x2));let _0x508633={'createdAt':_0xba90bf(0x1df)};if(_0x27a20){const _0x4a73f0=['amount',_0xba90bf(0x1c2),'updatedAt',_0xba90bf(0x187),'gateway',_0xba90bf(0xef)],_0x5edc5a=[_0xba90bf(0x12c),_0xba90bf(0x1df)];if(_0x4a73f0[_0xba90bf(0x13d)](_0x27a20)){const _0x3d82a7=_0x5edc5a[_0xba90bf(0x13d)](_0x5d62a8)?_0x5d62a8:_0xba90bf(0x1df);_0x508633={[_0x27a20]:_0x3d82a7},console['log'](_0xba90bf(0xfc)+_0x27a20+_0xba90bf(0x1c9)+_0x3d82a7+_0xba90bf(0x16e));}}const [_0x21c9fb,_0x51edee]=await Promise[_0xba90bf(0x1b9)]([database_1['default']['payment'][_0xba90bf(0x191)]({'where':_0x1e8f62,'skip':_0x4b4ae7,'take':_0x3494ed,'orderBy':_0x508633,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0xba90bf(0x153)][_0xba90bf(0x115)][_0xba90bf(0xa8)]({'where':_0x1e8f62})]);return{'payments':_0x21c9fb,'pagination':{'page':_0x390889,'limit':_0x3494ed,'total':_0x51edee,'totalPages':Math['ceil'](_0x51edee/_0x3494ed)}};}async[a46_0x1d78d3(0xfa)](_0x1ea9c0){const _0x466d73=a46_0x1d78d3,_0x53e310=await database_1[_0x466d73(0x153)][_0x466d73(0x115)][_0x466d73(0x130)]({'where':{'id':_0x1ea9c0},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x53e310)return null;return{'id':_0x53e310['id'],'shopId':_0x53e310[_0x466d73(0x100)],'gateway':_0x53e310['gateway'],'amount':_0x53e310[_0x466d73(0x11c)],'currency':_0x53e310['currency'],'status':_0x53e310[_0x466d73(0x187)],'orderId':_0x53e310[_0x466d73(0x173)],'gatewayOrderId':_0x53e310['gatewayOrderId'],'customerEmail':_0x53e310[_0x466d73(0x1ca)],'customerName':_0x53e310[_0x466d73(0x1c7)],'customerCountry':_0x53e310['customerCountry'],'customerIp':_0x53e310[_0x466d73(0x145)],'customerUa':_0x53e310['customerUa'],'failureMessage':_0x53e310[_0x466d73(0xa6)],'externalPaymentUrl':_0x53e310['externalPaymentUrl'],'successUrl':_0x53e310[_0x466d73(0x1a9)],'failUrl':_0x53e310[_0x466d73(0x1b8)],'pendingUrl':_0x53e310['pendingUrl'],'whiteUrl':_0x53e310[_0x466d73(0x18e)],'createdAt':_0x53e310[_0x466d73(0x1c2)],'updatedAt':_0x53e310[_0x466d73(0x183)],'shop':_0x53e310['shop']};}async[a46_0x1d78d3(0x174)](_0x1cebf9,_0x471e71,_0x23cbad,_0x55b099){const _0x572cc6=a46_0x1d78d3,_0x5007f3=await database_1['default'][_0x572cc6(0x132)](async _0x46d858=>{const _0x4ee119=_0x572cc6,_0x14f243=await _0x46d858[_0x4ee119(0x115)][_0x4ee119(0x130)]({'where':{'id':_0x1cebf9},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x14f243)throw new Error('Payment\x20not\x20found');const _0x3497f6=_0x14f243[_0x4ee119(0x187)],_0x577b01=_0x471e71[_0x4ee119(0x19b)]();console['log'](_0x4ee119(0x125)+_0x1cebf9+_0x4ee119(0x121)+_0x3497f6+_0x4ee119(0x1da)+_0x577b01),console[_0x4ee119(0x17f)](_0x4ee119(0xdc)+_0x14f243[_0x4ee119(0x14b)]['balance']+'\x20USDT');const _0xa4858d={'status':_0x577b01,'updatedAt':new Date(),'statusChangedBy':_0x4ee119(0x104),'statusChangedAt':new Date()};_0x23cbad&&(_0xa4858d[_0x4ee119(0xca)]=_0x23cbad);_0x577b01==='CHARGEBACK'&&_0x55b099&&(_0xa4858d['chargebackAmount']=_0x55b099);let _0x2dcea8=0x0,_0x4b9e0e=_0x14f243['shop'][_0x4ee119(0x1d6)];if(_0x577b01===_0x4ee119(0x1d4)&&_0x3497f6!==_0x4ee119(0x1d4)){_0xa4858d[_0x4ee119(0xb4)]=new Date();const _0x7c4a4b=await currencyService_1[_0x4ee119(0xee)][_0x4ee119(0xec)](_0x14f243[_0x4ee119(0x11c)],_0x14f243[_0x4ee119(0xef)]);_0xa4858d[_0x4ee119(0x1c0)]=_0x7c4a4b;let _0x446bdd=0x2d;const _0x18a303=await _0x46d858[_0x4ee119(0x14b)][_0x4ee119(0x130)]({'where':{'id':_0x14f243[_0x4ee119(0x100)]},'select':{'gatewaySettings':!![]}});if(_0x18a303?.[_0x4ee119(0x1cb)])try{const _0x5d2180=JSON['parse'](_0x18a303['gatewaySettings']);for(const [_0x29f8e0,_0x4eab57]of Object[_0x4ee119(0x19a)](_0x5d2180)){if(_0x29f8e0[_0x4ee119(0xd9)]()===_0x14f243[_0x4ee119(0x8e)][_0x4ee119(0xd9)]()){_0x446bdd=_0x4eab57[_0x4ee119(0x18a)]||0xa;break;}}}catch(_0x3c5010){console['error'](_0x4ee119(0x1e7)+_0x1cebf9+':',_0x3c5010);}let _0x5d732c;_0x14f243[_0x4ee119(0x11e)]!==null&&_0x14f243[_0x4ee119(0x11e)]!==undefined?(_0x5d732c=_0x14f243[_0x4ee119(0x11e)],console[_0x4ee119(0x17f)](_0x4ee119(0x14f)+_0x5d732c[_0x4ee119(0x1a5)](0x6)+_0x4ee119(0x128)+_0x1cebf9)):(_0x5d732c=_0x7c4a4b*(0x1-_0x446bdd/0x64),console[_0x4ee119(0x17f)]('ðŸ“Š\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20'+_0x1cebf9+':\x20'+_0x446bdd+'%\x20from\x20'+_0x7c4a4b['toFixed'](0x6)+_0x4ee119(0x1c5)),_0xa4858d['amountAfterGatewayCommissionUSDT']=_0x5d732c,_0xa4858d[_0x4ee119(0x149)]=_0x446bdd),_0x2dcea8=_0x5d732c,_0x4b9e0e+=_0x5d732c,console['log']('ðŸ’°\x20Payment\x20'+_0x1cebf9+_0x4ee119(0x12e)),console['log']('\x20\x20\x20Full\x20amount:\x20'+_0x7c4a4b[_0x4ee119(0x1a5)](0x6)+_0x4ee119(0x1c5)),console[_0x4ee119(0x17f)](_0x4ee119(0x16f)+_0x14f243[_0x4ee119(0x8e)]+_0x4ee119(0xea)+_0x446bdd+'%'),console['log'](_0x4ee119(0xeb)+_0x5d732c[_0x4ee119(0x1a5)](0x6)+_0x4ee119(0x12f)+_0x446bdd+_0x4ee119(0x1ba)),console[_0x4ee119(0x17f)](_0x4ee119(0x156)+_0x5d732c[_0x4ee119(0x1a5)](0x6)+_0x4ee119(0x1c5));}else{if(_0x3497f6==='PAID'&&_0x577b01!==_0x4ee119(0x1d4)&&_0x577b01!=='CHARGEBACK'){if(_0x14f243[_0x4ee119(0x1c0)]){let _0x4946a0=0x2d;const _0x2d22b8=await _0x46d858[_0x4ee119(0x14b)][_0x4ee119(0x130)]({'where':{'id':_0x14f243[_0x4ee119(0x100)]},'select':{'gatewaySettings':!![]}});if(_0x2d22b8?.['gatewaySettings'])try{const _0x42f58e=JSON[_0x4ee119(0x111)](_0x2d22b8['gatewaySettings']);for(const [_0x61d42c,_0x4455aa]of Object['entries'](_0x42f58e)){if(_0x61d42c['toLowerCase']()===_0x14f243[_0x4ee119(0x8e)][_0x4ee119(0xd9)]()){_0x4946a0=_0x4455aa['commission']||0xa;break;}}}catch(_0x48891d){console['error'](_0x4ee119(0x1e7)+_0x1cebf9+':',_0x48891d);}const _0x2732c0=_0x14f243[_0x4ee119(0x1c0)]*(0x1-_0x4946a0/0x64);_0x2dcea8=-_0x2732c0,_0x4b9e0e-=_0x2732c0,console[_0x4ee119(0x17f)](_0x4ee119(0xe7)+_0x14f243['amountUSDT'][_0x4ee119(0x1a5)](0x6)+_0x4ee119(0x1c5)),console[_0x4ee119(0x17f)](_0x4ee119(0x16f)+_0x14f243['gateway']+',\x20Commission:\x20'+_0x4946a0+'%'),console['log']('\x20\x20\x20Merchant\x20loses:\x20'+_0x2732c0[_0x4ee119(0x1a5)](0x6)+_0x4ee119(0x12f)+_0x4946a0+_0x4ee119(0x1ba)),console[_0x4ee119(0x17f)](_0x4ee119(0x16b)+_0x2732c0[_0x4ee119(0x1a5)](0x6)+_0x4ee119(0x1c5));}}}_0x577b01==='CHARGEBACK'&&(console[_0x4ee119(0x17f)](_0x4ee119(0x1b6)),_0x55b099&&_0x55b099>0x0?(_0x2dcea8=-_0x55b099,_0x4b9e0e-=_0x55b099,console[_0x4ee119(0x17f)](_0x4ee119(0xf7)+_0x55b099[_0x4ee119(0x1a5)](0x6)+_0x4ee119(0x116)),console[_0x4ee119(0x17f)]('ðŸ’°\x20Payment\x20amount\x20is\x20NOT\x20deducted\x20(chargeback\x20penalty\x20only)')):console['log'](_0x4ee119(0x10a)),_0xa4858d[_0x4ee119(0x127)]=_0x55b099||0x0);_0x577b01===_0x4ee119(0xde)&&_0x3497f6===_0x4ee119(0x1d4)&&console[_0x4ee119(0x17f)]('ðŸ”„\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance');const _0x30200b=await _0x46d858[_0x4ee119(0x115)][_0x4ee119(0xc1)]({'where':{'id':_0x1cebf9},'data':_0xa4858d,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x2dcea8!==0x0&&(await _0x46d858['shop'][_0x4ee119(0xc1)]({'where':{'id':_0x14f243[_0x4ee119(0x100)]},'data':{'balance':_0x4b9e0e}}),console[_0x4ee119(0x17f)](_0x4ee119(0x15e)+_0x14f243['shopId']+'\x20balance\x20updated:\x20'+_0x14f243[_0x4ee119(0x14b)][_0x4ee119(0x1d6)][_0x4ee119(0x1a5)](0x6)+_0x4ee119(0x1da)+_0x4b9e0e[_0x4ee119(0x1a5)](0x6)+_0x4ee119(0x160)+(_0x2dcea8>0x0?'+':'')+_0x2dcea8[_0x4ee119(0x1a5)](0x6)+')')),_0x30200b;});return{'id':_0x5007f3['id'],'shopId':_0x5007f3[_0x572cc6(0x100)],'gateway':_0x5007f3[_0x572cc6(0x8e)],'amount':_0x5007f3[_0x572cc6(0x11c)],'currency':_0x5007f3['currency'],'status':_0x5007f3[_0x572cc6(0x187)],'orderId':_0x5007f3[_0x572cc6(0x173)],'gatewayOrderId':_0x5007f3[_0x572cc6(0x165)],'customerEmail':_0x5007f3['customerEmail'],'customerName':_0x5007f3[_0x572cc6(0x1c7)],'customerCountry':_0x5007f3[_0x572cc6(0x19c)],'customerIp':_0x5007f3['customerIp'],'customerUa':_0x5007f3[_0x572cc6(0x103)],'failureMessage':_0x5007f3[_0x572cc6(0xa6)],'adminNotes':_0x5007f3[_0x572cc6(0xca)],'chargebackAmount':_0x5007f3[_0x572cc6(0x127)],'statusChangedBy':_0x5007f3['statusChangedBy'],'statusChangedAt':_0x5007f3[_0x572cc6(0xcf)],'createdAt':_0x5007f3['createdAt'],'updatedAt':_0x5007f3[_0x572cc6(0x183)],'shop':_0x5007f3[_0x572cc6(0x14b)]};}async[a46_0x1d78d3(0xe5)](_0x353cce,_0x2f7fa4){const _0x3aaded=a46_0x1d78d3,_0x5b35bf=Math[_0x3aaded(0x1c4)]()[_0x3aaded(0xc0)](0x24)[_0x3aaded(0xb7)](0x2,0x9);console['log'](_0x3aaded(0x91)+_0x5b35bf+',\x20userId:\x20'+_0x353cce);const _0x552e38={..._0x2f7fa4};_0x2f7fa4['password']&&_0x2f7fa4['password'][_0x3aaded(0x19f)]()!==''?(console['log'](_0x3aaded(0x1d0)+_0x5b35bf+']\x20Updating\x20password\x20for\x20user\x20'+_0x353cce),_0x552e38['password']=await bcryptjs_1['default'][_0x3aaded(0x139)](_0x2f7fa4['password'],0xc)):(console[_0x3aaded(0x17f)](_0x3aaded(0x1d0)+_0x5b35bf+_0x3aaded(0xc6)),delete _0x552e38[_0x3aaded(0x1e3)]);_0x2f7fa4[_0x3aaded(0x169)]&&(_0x552e38[_0x3aaded(0x1e4)]=_0x2f7fa4[_0x3aaded(0x169)],delete _0x552e38[_0x3aaded(0x169)]);_0x2f7fa4['telegramId']&&(_0x552e38[_0x3aaded(0x1d1)]=_0x2f7fa4[_0x3aaded(0x1ad)],delete _0x552e38['telegramId']);_0x2f7fa4[_0x3aaded(0x1f2)]&&(_0x552e38[_0x3aaded(0x13c)]=_0x2f7fa4[_0x3aaded(0x1f2)],delete _0x552e38['merchantUrl']);if(_0x2f7fa4['gateways']){const _0x2133b2=_0x2f7fa4['gateways'][_0x3aaded(0x1b3)](_0x389220=>this[_0x3aaded(0x196)](_0x389220));console[_0x3aaded(0x17f)]('ðŸ”„\x20Gateway\x20mapping:',_0x2f7fa4[_0x3aaded(0x176)],'->',_0x2133b2),_0x552e38[_0x3aaded(0x1f1)]=JSON['stringify'](_0x2133b2),delete _0x552e38[_0x3aaded(0x176)];}_0x2f7fa4['gatewaySettings']&&(console[_0x3aaded(0x17f)](_0x3aaded(0x1a3)+_0x5b35bf+_0x3aaded(0xb8),_0x2f7fa4[_0x3aaded(0x1cb)]),_0x552e38['gatewaySettings']=JSON['stringify'](_0x2f7fa4[_0x3aaded(0x1cb)]),console[_0x3aaded(0x17f)]('ðŸ”§\x20['+_0x5b35bf+']\x20Gateway\x20settings\x20JSON\x20string:',_0x552e38['gatewaySettings']));_0x2f7fa4[_0x3aaded(0x102)]&&(_0x2f7fa4[_0x3aaded(0x102)]['usdtPolygonWallet']!==undefined&&(_0x552e38[_0x3aaded(0x151)]=_0x2f7fa4[_0x3aaded(0x102)][_0x3aaded(0x151)]||null),_0x2f7fa4['wallets'][_0x3aaded(0x16a)]!==undefined&&(_0x552e38[_0x3aaded(0x16a)]=_0x2f7fa4[_0x3aaded(0x102)][_0x3aaded(0x16a)]||null),_0x2f7fa4[_0x3aaded(0x102)]['usdtErcWallet']!==undefined&&(_0x552e38[_0x3aaded(0xfb)]=_0x2f7fa4[_0x3aaded(0x102)][_0x3aaded(0xfb)]||null),_0x2f7fa4['wallets'][_0x3aaded(0x17d)]!==undefined&&(_0x552e38[_0x3aaded(0x17d)]=_0x2f7fa4[_0x3aaded(0x102)]['usdcPolygonWallet']||null),delete _0x552e38[_0x3aaded(0x102)]);const _0x75b7c2=await database_1[_0x3aaded(0x153)][_0x3aaded(0x14b)][_0x3aaded(0xc1)]({'where':{'id':_0x353cce},'data':_0x552e38,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0x3aaded(0x17f)]('ðŸŽ¯\x20['+_0x5b35bf+_0x3aaded(0xd6),_0x75b7c2[_0x3aaded(0x1cb)]),{'id':_0x75b7c2['id'],'fullName':_0x75b7c2[_0x3aaded(0x1e4)],'username':_0x75b7c2[_0x3aaded(0x1dc)],'telegramId':_0x75b7c2[_0x3aaded(0x1d1)],'merchantUrl':_0x75b7c2[_0x3aaded(0x13c)],'gateways':_0x75b7c2['paymentGateways']?JSON[_0x3aaded(0x111)](_0x75b7c2[_0x3aaded(0x1f1)]):null,'gatewaySettings':_0x75b7c2[_0x3aaded(0x1cb)]?JSON['parse'](_0x75b7c2[_0x3aaded(0x1cb)]):null,'publicKey':_0x75b7c2[_0x3aaded(0x16d)],'wallets':{'usdtPolygonWallet':_0x75b7c2[_0x3aaded(0x151)],'usdtTrcWallet':_0x75b7c2[_0x3aaded(0x16a)],'usdtErcWallet':_0x75b7c2['usdtErcWallet'],'usdcPolygonWallet':_0x75b7c2[_0x3aaded(0x17d)]},'status':_0x75b7c2[_0x3aaded(0x187)],'createdAt':_0x75b7c2[_0x3aaded(0x1c2)]};}async['suspendUser'](_0x3cf0b5){const _0x27e052=a46_0x1d78d3,_0x1cdce3=await database_1[_0x27e052(0x153)][_0x27e052(0x14b)][_0x27e052(0xc1)]({'where':{'id':_0x3cf0b5},'data':{'status':_0x27e052(0x95)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x1cdce3['id'],'fullName':_0x1cdce3[_0x27e052(0x1e4)],'username':_0x1cdce3[_0x27e052(0x1dc)],'telegramId':_0x1cdce3[_0x27e052(0x1d1)],'merchantUrl':_0x1cdce3[_0x27e052(0x13c)],'gateways':_0x1cdce3[_0x27e052(0x1f1)]?JSON[_0x27e052(0x111)](_0x1cdce3[_0x27e052(0x1f1)]):null,'gatewaySettings':_0x1cdce3[_0x27e052(0x1cb)]?JSON['parse'](_0x1cdce3[_0x27e052(0x1cb)]):null,'publicKey':_0x1cdce3['publicKey'],'wallets':{'usdtPolygonWallet':_0x1cdce3['usdtPolygonWallet'],'usdtTrcWallet':_0x1cdce3[_0x27e052(0x16a)],'usdtErcWallet':_0x1cdce3['usdtErcWallet'],'usdcPolygonWallet':_0x1cdce3[_0x27e052(0x17d)]},'status':_0x1cdce3[_0x27e052(0x187)],'createdAt':_0x1cdce3['createdAt']};}async[a46_0x1d78d3(0x19d)](_0x4b84d3){const _0x20e30e=a46_0x1d78d3,_0x256f13=await database_1[_0x20e30e(0x153)]['shop'][_0x20e30e(0xc1)]({'where':{'id':_0x4b84d3},'data':{'status':_0x20e30e(0x199)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x256f13['id'],'fullName':_0x256f13[_0x20e30e(0x1e4)],'username':_0x256f13['username'],'telegramId':_0x256f13[_0x20e30e(0x1d1)],'merchantUrl':_0x256f13[_0x20e30e(0x13c)],'gateways':_0x256f13[_0x20e30e(0x1f1)]?JSON['parse'](_0x256f13[_0x20e30e(0x1f1)]):null,'gatewaySettings':_0x256f13[_0x20e30e(0x1cb)]?JSON[_0x20e30e(0x111)](_0x256f13['gatewaySettings']):null,'publicKey':_0x256f13[_0x20e30e(0x16d)],'wallets':{'usdtPolygonWallet':_0x256f13[_0x20e30e(0x151)],'usdtTrcWallet':_0x256f13['usdtTrcWallet'],'usdtErcWallet':_0x256f13[_0x20e30e(0xfb)],'usdcPolygonWallet':_0x256f13[_0x20e30e(0x17d)]},'status':_0x256f13[_0x20e30e(0x187)],'createdAt':_0x256f13[_0x20e30e(0x1c2)]};}async[a46_0x1d78d3(0x12d)](_0x53b49a){const _0x119d5a=a46_0x1d78d3,{page:_0x46416b,limit:_0x5d30f0,status:_0x2037a0}=_0x53b49a,_0x2d8c57=(_0x46416b-0x1)*_0x5d30f0,_0x1dc616={};_0x2037a0&&(_0x1dc616['status']=_0x2037a0[_0x119d5a(0x19b)]());const [_0x420953,_0x26ad05]=await Promise[_0x119d5a(0x1b9)]([database_1[_0x119d5a(0x153)]['shop'][_0x119d5a(0x191)]({'where':_0x1dc616,'skip':_0x2d8c57,'take':_0x5d30f0,'orderBy':{'createdAt':_0x119d5a(0x1df)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1['default'][_0x119d5a(0x14b)]['count']({'where':_0x1dc616})]);return{'users':_0x420953['map'](_0xe18197=>{const _0x3ebbf5=_0x119d5a,_0x4c568e=_0xe18197[_0x3ebbf5(0x1f1)]?JSON[_0x3ebbf5(0x111)](_0xe18197[_0x3ebbf5(0x1f1)]):null,_0xb477e9=_0x4c568e?_0x4c568e['map'](_0x363a08=>this['getGatewayDisplayName'](_0x363a08)):null;return{'id':_0xe18197['id'],'fullName':_0xe18197[_0x3ebbf5(0x1e4)],'username':_0xe18197[_0x3ebbf5(0x1dc)],'telegramId':_0xe18197[_0x3ebbf5(0x1d1)],'merchantUrl':_0xe18197['shopUrl'],'gateways':_0xb477e9,'gatewaySettings':_0xe18197[_0x3ebbf5(0x1cb)]?JSON[_0x3ebbf5(0x111)](_0xe18197[_0x3ebbf5(0x1cb)]):null,'publicKey':_0xe18197['publicKey'],'wallets':{'usdtPolygonWallet':_0xe18197[_0x3ebbf5(0x151)],'usdtTrcWallet':_0xe18197['usdtTrcWallet'],'usdtErcWallet':_0xe18197[_0x3ebbf5(0xfb)],'usdcPolygonWallet':_0xe18197['usdcPolygonWallet']},'status':_0xe18197['status'],'createdAt':_0xe18197[_0x3ebbf5(0x1c2)]};}),'pagination':{'page':_0x46416b,'limit':_0x5d30f0,'total':_0x26ad05,'totalPages':Math['ceil'](_0x26ad05/_0x5d30f0)}};}async['getUserById'](_0xc37f12){const _0x5eb6de=a46_0x1d78d3,_0xe0ed20=await database_1[_0x5eb6de(0x153)]['shop'][_0x5eb6de(0x130)]({'where':{'id':_0xc37f12},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0xe0ed20)return null;const _0x1d358a=_0xe0ed20[_0x5eb6de(0x1f1)]?JSON[_0x5eb6de(0x111)](_0xe0ed20['paymentGateways']):null,_0x4d8079=_0x1d358a?_0x1d358a[_0x5eb6de(0x1b3)](_0x204d54=>this[_0x5eb6de(0x1bb)](_0x204d54)):null;return _0x1d358a&&_0x4d8079&&console[_0x5eb6de(0x17f)]('ðŸ”„\x20Gateway\x20mapping\x20(get):',_0x1d358a,'->',_0x4d8079),{'id':_0xe0ed20['id'],'fullName':_0xe0ed20['name'],'username':_0xe0ed20[_0x5eb6de(0x1dc)],'telegramId':_0xe0ed20[_0x5eb6de(0x1d1)],'merchantUrl':_0xe0ed20[_0x5eb6de(0x13c)],'gateways':_0x4d8079,'gatewaySettings':_0xe0ed20['gatewaySettings']?JSON[_0x5eb6de(0x111)](_0xe0ed20[_0x5eb6de(0x1cb)]):null,'publicKey':_0xe0ed20['publicKey'],'wallets':{'usdtPolygonWallet':_0xe0ed20['usdtPolygonWallet'],'usdtTrcWallet':_0xe0ed20[_0x5eb6de(0x16a)],'usdtErcWallet':_0xe0ed20[_0x5eb6de(0xfb)],'usdcPolygonWallet':_0xe0ed20[_0x5eb6de(0x17d)]},'status':_0xe0ed20[_0x5eb6de(0x187)],'createdAt':_0xe0ed20[_0x5eb6de(0x1c2)]};}async[a46_0x1d78d3(0x1bf)](_0x2fd3e6){const _0x40fbdd=a46_0x1d78d3,{fullName:_0x324951,username:_0x59ffb8,password:_0x58c96c,telegramId:_0x503abc,merchantUrl:_0x2ed04c,gateways:_0x3ebedd,gatewaySettings:_0x44af5f,wallets:_0x37377d}=_0x2fd3e6,_0x4605b3=await database_1[_0x40fbdd(0x153)][_0x40fbdd(0x14b)][_0x40fbdd(0x130)]({'where':{'username':_0x59ffb8}});if(_0x4605b3)throw new Error(_0x40fbdd(0xae));if(_0x503abc){const _0x455b2d=await database_1[_0x40fbdd(0x153)][_0x40fbdd(0x14b)][_0x40fbdd(0x130)]({'where':{'telegram':_0x503abc}});if(_0x455b2d)throw new Error(_0x40fbdd(0xc8));}const _0x1b3ea8=await bcryptjs_1[_0x40fbdd(0x153)][_0x40fbdd(0x139)](_0x58c96c,0xc),_0x3a2805=_0x40fbdd(0x131)+crypto_1[_0x40fbdd(0x153)][_0x40fbdd(0x162)](0x20)[_0x40fbdd(0xc0)](_0x40fbdd(0x1b0)),_0x246fab=_0x40fbdd(0x13b)+crypto_1[_0x40fbdd(0x153)][_0x40fbdd(0x162)](0x20)[_0x40fbdd(0xc0)](_0x40fbdd(0x1b0)),_0x2e9167=_0x3ebedd?_0x3ebedd[_0x40fbdd(0x1b3)](_0x2138b7=>this[_0x40fbdd(0x196)](_0x2138b7)):null;_0x3ebedd&&_0x2e9167&&console[_0x40fbdd(0x17f)](_0x40fbdd(0x155),_0x3ebedd,'->',_0x2e9167);const _0x21a994=await database_1[_0x40fbdd(0x153)][_0x40fbdd(0x14b)][_0x40fbdd(0x179)]({'data':{'name':_0x324951,'username':_0x59ffb8,'password':_0x1b3ea8,'telegram':_0x503abc,'shopUrl':_0x2ed04c,'paymentGateways':_0x2e9167?JSON[_0x40fbdd(0xcb)](_0x2e9167):null,'gatewaySettings':_0x44af5f?JSON[_0x40fbdd(0xcb)](_0x44af5f):null,'usdtPolygonWallet':_0x37377d?.[_0x40fbdd(0x151)]||null,'usdtTrcWallet':_0x37377d?.[_0x40fbdd(0x16a)]||null,'usdtErcWallet':_0x37377d?.[_0x40fbdd(0xfb)]||null,'usdcPolygonWallet':_0x37377d?.[_0x40fbdd(0x17d)]||null,'publicKey':_0x3a2805,'secretKey':_0x246fab,'status':_0x40fbdd(0x199)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x21a994['id'],'fullName':_0x21a994[_0x40fbdd(0x1e4)],'username':_0x21a994[_0x40fbdd(0x1dc)],'telegramId':_0x21a994[_0x40fbdd(0x1d1)],'merchantUrl':_0x21a994['shopUrl'],'gateways':_0x21a994['paymentGateways']?JSON[_0x40fbdd(0x111)](_0x21a994['paymentGateways']):null,'gatewaySettings':_0x21a994['gatewaySettings']?JSON['parse'](_0x21a994[_0x40fbdd(0x1cb)]):null,'publicKey':_0x21a994[_0x40fbdd(0x16d)],'wallets':{'usdtPolygonWallet':_0x21a994['usdtPolygonWallet'],'usdtTrcWallet':_0x21a994[_0x40fbdd(0x16a)],'usdtErcWallet':_0x21a994[_0x40fbdd(0xfb)],'usdcPolygonWallet':_0x21a994[_0x40fbdd(0x17d)]},'status':_0x21a994[_0x40fbdd(0x187)],'createdAt':_0x21a994['createdAt']};}async[a46_0x1d78d3(0x107)](_0x50a4b0){const _0x4354ee=a46_0x1d78d3;await database_1[_0x4354ee(0x153)][_0x4354ee(0x14b)][_0x4354ee(0x175)]({'where':{'id':_0x50a4b0}});}[a46_0x1d78d3(0xfe)](_0x22ed3a,_0x6fb21e,_0x23b13e){const _0x229c30=a46_0x1d78d3,_0x6ec906=new Map(),_0x26185c=new Date(_0x6fb21e);while(_0x26185c<=_0x23b13e){const _0x5753ea=_0x26185c[_0x229c30(0xbe)]()['split']('T')[0x0];_0x6ec906['set'](_0x5753ea,{'revenue':0x0,'count':0x0}),_0x26185c[_0x229c30(0xbf)](_0x26185c[_0x229c30(0x158)]()+0x1);}for(const _0x4349c4 of _0x22ed3a){const _0x5a7522=_0x4349c4['createdAt'][_0x229c30(0xbe)]()[_0x229c30(0x1a0)]('T')[0x0],_0x479127=_0x6ec906['get'](_0x5a7522);_0x479127&&(_0x479127[_0x229c30(0xa8)]+=0x1,_0x4349c4[_0x229c30(0x187)]===_0x229c30(0x1d4)&&(_0x4349c4[_0x229c30(0x1c0)]?_0x479127['revenue']+=_0x4349c4[_0x229c30(0x1c0)]:console[_0x229c30(0x17f)](_0x229c30(0x185)+_0x4349c4['id']+_0x229c30(0xf4))));}const _0x5da56c=[],_0x16e43d=[];for(const [_0x2c791a,_0x3bd9d5]of _0x6ec906){_0x5da56c['push']({'date':_0x2c791a,'amount':Math[_0x229c30(0x166)](_0x3bd9d5[_0x229c30(0x137)]*0x64)/0x64}),_0x16e43d['push']({'date':_0x2c791a,'count':_0x3bd9d5[_0x229c30(0xa8)]});}return{'dailyRevenue':_0x5da56c,'dailyPayments':_0x16e43d};}}function a46_0x1f5f(){const _0x54080e=['\x20USDT\x20(after\x20','findUnique','pk_','$transaction','\x20USDT\x20(theoretical\x20net)','ðŸ“Š\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20','periodTo','11128473Byanbe','revenue','forEach','hash','17528140ZgiufE','sk_','shopUrl','includes','\x20\x20\x20Current\x20balance:\x20','crypto','\x27\x20->\x20ID\x20\x27','getSystemStatistics','ðŸ“Š\x20Using\x20saved\x20values\x20for\x20payment\x20','ðŸ”\x20Balance\x20check\x20details:','6LMkZcQ','customerIp','28jnGmZE','\x20\x20\x20Total\x20paid\x20out:\x20','turnoverUSDT','gatewayCommissionRate','min','shop','trc20','60364Oiyocr','_sum','ðŸ“Š\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','\x20\x20\x20ðŸ’³\x20Total\x20payments:\x20','usdtPolygonWallet','477690xkirEV','default','last_month','ðŸ”„\x20Gateway\x20mapping\x20(create):','\x20\x20\x20Added\x20to\x20balance:\x20+','averageCommissionRate','getDate','gatewayEarnings','\x20USDT\x20(same\x20as\x20awaiting)','\x20USDT\x20(current\x20balance\x20in\x20DB)','ðŸ”\x20Selected\x20erc20_usdc\x20wallet:\x20','merchantEarnings','ðŸ’°\x20Shop\x20','cointopay','\x20USDT\x20(','periodFrom','randomBytes','ðŸ“Š\x20Available\x20gateways\x20in\x20database:','lte','gatewayOrderId','round','15DXogcM','âœ…\x20Using\x20gateway\x20filter:\x20\x27','fullName','usdtTrcWallet','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','date','publicKey','\x20order','\x20\x20\x20Gateway:\x20','ðŸ”\x20No\x20wallet\x20provided,\x20looking\x20up\x20from\x20shop\x20settings...','\x20USDT\x20(+','CoinToPay','orderId','updatePaymentStatus','delete','gateways','\x20paid\x20payments\x20for\x20analysis','âœ…\x20Customer\x20data\x20updated\x20for\x20payment\x20','create','\x20USDT,\x20Requested:\x20','polygon_usdc','\x20payments)','usdcPolygonWallet','KLYME\x20EU','log','custom','totalAmountAfterCommissionUSDT','__importDefault','updatedAt','\x20USDT\x20(rounded\x20to\x202\x20decimal\x20places)','âš ï¸\x20Payment\x20','\x20\x20\x20ðŸ¤”\x20Difference:\x20','status','payout','\x20\x20\x20ï¿½\x20Total\x20payments\x20turnover:\x20','commission',',\x20successful:\x20','createPayout','totalCommissionRate','whiteUrl','\x20\x20\x20Available\x20(number):\x20','./telegramBotService','findMany','erc20_usdc','warn','ðŸ”\x20Initial\x20wallet\x20from\x20request:\x20','findFirst','getGatewayInternalName',',\x20refunds:\x20','\x20\x20\x20ï¿½ðŸ“Š\x20Total\x20payments:\x20','ACTIVE','entries','toUpperCase','customerCountry','activateUser','updateCustomerData','trim','split','test_gateway','\x20-\x20','ðŸ”§\x20[','_count','toFixed','payouts','yesterday','noda','successUrl','ceil','\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)','Test\x20Gateway','telegramId','Open\x20Banking\x202','dateFrom','hex','\x27\x20to\x20name\x20\x27','groupBy','map','length','totalPayout','ðŸ’¸\x20CHARGEBACK:\x20Processing\x20penalty-only\x20deduction','ðŸ”\x20Selected\x20erc20\x20wallet:\x20','failUrl','all','%\x20commission)','getGatewayDisplayName','replace','getFullYear','merchantEarningsUSDT','createUser','amountUSDT','ðŸ”\x20Selected\x20trc20\x20wallet:\x20','createdAt','UTC','random','\x20USDT','filter','customerName','\x20\x20\x20ðŸŒ\x20IP:\x20','\x20in\x20','customerEmail','gatewaySettings','âš ï¸\x20Requested\x20gateway\x20\x27','\x20\x20\x20Tolerance:\x20','ru-RU','this_month','ðŸ”\x20[','telegram','../types/gateway','ðŸ’°\x20[PAYOUT]\x20Gateway\x20','PAID','paymentsCount','balance','Noda','EXPIRED','localeCompare','\x20->\x20','getMerchantsAwaitingPayout','username','deletePayout','\x20\x20\x20Transaction\x20hash:\x20','desc','last_week','\x20with\x20payout\x20history','\x20\x20\x20ðŸ“…\x20This\x20month:\x20','password','name','period','\x27\x20->\x20name\x20\x27','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','Shop\x20not\x20found','defineProperty','some','NONEXISTENT_GATEWAY_FILTER','klyme_de','\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)','klyme_eu','not\x20specified','../config/database','paymentGateways','merchantUrl','âœ…\x20Using\x20wallet\x20from\x20request:\x20',',\x20chargebacks:\x20','\x20for\x20shop\x20','turnover','ðŸ“‹\x20Found\x20','5542910pBUSug','dateTo',':\x20commission\x20=\x20','gateway','\x20to\x20','ðŸ”\x20Using\x20gateway\x20\x27','ðŸŽ¯\x20updateUser\x20called\x20with\x20ID:\x20','ðŸ“Š\x20Getting\x20payments\x20with\x20filters:','ðŸ“Š\x20Final\x20WHERE\x20conditions:','ðŸ’³\x20Final\x20payout\x20wallet\x20for\x20','SUSPENDED','gte','getUTCDay','setUTCDate','amountAfterCommissionUSDT','availableBalance','totalPaidOut','getMonth','ðŸ“Š\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','getMerchantsSelection','\x27\x20not\x20found.\x20Available\x20gateways:\x20','\x20\x20\x20ðŸ–¥ï¸\x20User\x20Agent:\x20','0000','paidOutUSDT','ðŸ“Š\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','getAllPayments','\x20\x20\x20ðŸ’°\x20Total\x20turnover:\x20','failureMessage','ðŸ“Š\x20Calculated\x20commission\x20rate\x20for\x20payment\x20','count','\x20\x20\x20ðŸŒ\x20Country:\x20','week','all_time','ðŸ“…\x20Date\x20to\x20filter:\x20','\x20\x20\x20ðŸª\x20Gateway\x20earnings:\x20','Username\x20already\x20exists','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','\x20\x20\x20ðŸ’¸\x20Total\x20payouts\x20(all\x20time):\x20','reduce','\x20USDT\x20(already\x20paid\x20out)','ðŸ”„\x20Updating\x20customer\x20data\x20for\x20payment\x20','paidAt','ðŸ”„\x20Converted\x20gateway\x20ID\x20\x27','Payment\x20not\x20found','substr',']\x20Gateway\x20settings\x20before\x20saving:','ðŸ”\x20Selected\x20polygon\x20wallet:\x20','notes','getPayoutById','AdminService','%\x20from\x20','toISOString','setDate','toString','update','\x20USDT)','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','ÐÐµ\x20ÑƒÐºÐ°Ð·Ð°Ð½','getUTCDate',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','COMPLETED','Telegram\x20username\x20already\x20exists','klyme_gb','adminNotes','stringify','averageCheckUSDT','insensitive','totalPayments','statusChangedAt','sort','floor','year','not\x20set','aggregate','5147814wmTViM',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','\x20merchants','totalTurnover','toLowerCase','\x20USDT\x20(total\x20paid\x20to\x20merchants)','ðŸ’°\x20Found\x20','ðŸ’°\x20Current\x20shop\x20balance:\x20','\x20\x20\x20ðŸ”\x20Calculated\x20after\x20commission:\x20','REFUND','2020-01-01','month','\x20\x20\x20ðŸ’°\x20Total\x20payout:\x20','PENDING','getTime','ðŸ“Š\x20Merchant\x20statistics\x20calculated:','updateUser','\x20USDT,\x20merchant:\x20','\x20\x20\x20Full\x20amount:\x20','set','network',',\x20Commission:\x20','\x20\x20\x20Merchant\x20gets:\x20','convertToUSDT','not\x20provided','currencyService','currency','Error\x20processing\x20payment\x20','\x20\x20\x20â³\x20Awaiting\x20payout:\x20','ðŸ”\x20Shop\x20wallets:','commissionUSDT','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','\x20\x20\x20Payout\x20amount:\x20','\x20merchants\x20with\x20rounded\x20balance\x20!=\x200.00\x20(excluding\x20balances\x20that\x20round\x20to\x200.00)','ðŸ’¸\x20CHARGEBACK\x20penalty\x20ONLY:\x20-','ðŸ”\x20Selected\x20polygon_usdc\x20wallet:\x20','usdcErcWallet','getPaymentById','usdtErcWallet','ðŸ“Š\x20Sorting\x20payments\x20by\x20','this_week','generateDailyStatistics','error','shopId','MasterCard','wallets','customerUa','admin','CHARGEBACK','Rapyd','deleteUser','Insufficient\x20balance.\x20Available:\x20','totalAmountUSDT','âš ï¸\x20CHARGEBACK\x20without\x20penalty\x20amount\x20-\x20no\x20balance\x20change','\x20\x20\x20ðŸ’µ\x20Available\x20balance:\x20','getGatewayIdByName','thisMonth','âœ…\x20Payout\x20created:\x20','10167432oFicWI','getUTCMonth','parse','\x27\x20(from\x20\x27','Plisio','getGatewayNameById','payment','\x20USDT\x20from\x20balance','__esModule','\x20\x20\x20âœ…\x20Total\x20net\x20balances:\x20','setHours','values','\x20USDT\x20(gross\x20revenue)','amount','\x20\x20\x20Final\x20payout\x20amount\x20used:\x20','amountAfterGatewayCommissionUSDT','\x20\x20\x20âœ…\x20Actual\x20available\x20balance:\x20','pendingPayout','\x20status:\x20','ðŸ“Š\x20Merchants\x20with\x20rounded\x20balance\x20!=\x200.00:\x20','./currencyService','txid','ðŸ”„\x20Admin\x20updating\x20payment\x20','\x20\x20\x20ðŸ“…\x20Total\x20payouts\x20(this\x20month):\x20','chargebackAmount','\x20USDT\x20for\x20payment\x20','wallet','getUTCFullYear','telegramBotService','asc','getAllUsers','\x20became\x20PAID:'];a46_0x1f5f=function(){return _0x54080e;};return a46_0x1f5f();}exports[a46_0x1d78d3(0xbc)]=AdminService;