'use strict';const a35_0x41c38c=a35_0x2814;(function(_0x16d465,_0x565aaf){const _0x184262=a35_0x2814,_0x381f48=_0x16d465();while(!![]){try{const _0x854150=-parseInt(_0x184262(0xe4))/0x1+-parseInt(_0x184262(0x16c))/0x2*(-parseInt(_0x184262(0x1e1))/0x3)+parseInt(_0x184262(0x1b4))/0x4*(parseInt(_0x184262(0x1c3))/0x5)+-parseInt(_0x184262(0x108))/0x6*(parseInt(_0x184262(0x19e))/0x7)+-parseInt(_0x184262(0x143))/0x8+-parseInt(_0x184262(0x147))/0x9*(parseInt(_0x184262(0x16a))/0xa)+parseInt(_0x184262(0x13f))/0xb;if(_0x854150===_0x565aaf)break;else _0x381f48['push'](_0x381f48['shift']());}catch(_0x523ed4){_0x381f48['push'](_0x381f48['shift']());}}}(a35_0x501e,0x578cd));function a35_0x2814(_0x4a0b7b,_0x15cf15){const _0x501eab=a35_0x501e();return a35_0x2814=function(_0x281447,_0x445587){_0x281447=_0x281447-0xce;let _0x4cd09c=_0x501eab[_0x281447];return _0x4cd09c;},a35_0x2814(_0x4a0b7b,_0x15cf15);}var __importDefault=this&&this[a35_0x41c38c(0x198)]||function(_0x9fdb46){const _0x10193c=a35_0x41c38c;return _0x9fdb46&&_0x9fdb46[_0x10193c(0x1cf)]?_0x9fdb46:{'default':_0x9fdb46};};Object[a35_0x41c38c(0x133)](exports,a35_0x41c38c(0x1cf),{'value':!![]}),exports[a35_0x41c38c(0x16f)]=void 0x0;const database_1=__importDefault(require(a35_0x41c38c(0x113))),bcryptjs_1=__importDefault(require(a35_0x41c38c(0xdc))),crypto_1=__importDefault(require(a35_0x41c38c(0xe6))),currencyService_1=require(a35_0x41c38c(0xd4));function a35_0x501e(){const _0x4983b9=['custom','\x20->\x20','8653920BLFiIk','REFUND','merchantEarningsUSDT','balance','543040sJBOyv','fullName','username','dateTo','72tRmVnL','CHARGEBACK','warn','paymentsCount','network','\x20USDT\x20(-','update','setDate','insensitive','KLYME\x20EU','toUpperCase','orderId','\x20merchants\x20with\x20positive\x20balance','dailyPayments','paymentMethod','round','\x20\x20\x20Commission\x20from\x20shop\x20settings:\x20','../types/gateway','generateDailyStatistics','not\x20found','_sum','bankId','\x20as-is','aggregate','asc','getMerchantsAwaitingPayout','Rapyd','desc','payment','📊\x20Conversion\x20rate\x20calculation:','getSystemStatistics','usdcPolygonWallet','cardLast4','customerEmail','amount','323710acWUAu','updateUser','6406nzfoog','\x20\x20\x20💵\x20Available\x20balance:\x20','ceil','AdminService','Insufficient\x20balance.\x20Available:\x20','lte','shopUrl','Plisio','awaitingPayout','📊\x20Admin\x20getAllPayments\x20results:\x20found\x20','convertToUSDT','customerCountry','reduce','_count','getAllPayments','getFullYear','successUrl','createdAt','\x20\x20\x20Payout\x20amount:\x20','30d','payout','📊\x20Payout\x20statistics\x20calculated:','\x20\x20\x20💰\x20Total\x20turnover:\x20','chargebackAmount','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','deletePayout','year','findFirst','notes','periodTo','txUrls','\x20USDT\x20(total\x20paid\x20to\x20merchants)','sort','\x20for\x20shop\x20','updatedAt','gateway','map','\x20\x20\x20Raw\x20gatewaySettings:\x20','test_gateway','push','\x20\x20\x20Total\x20payments:\x20','getGatewayDisplayName','delete','find','__importDefault','shopId','usdtErcWallet','failureMessage','paidOutUSDT','📅\x20Period:\x20','2681rjxTzn','getPayoutById','activateUser','count','\x20USDT,\x20Requested:\x20','\x20payments\x20for\x20daily\x20statistics','forEach','\x20to\x20name\x20','commission','currencyService','telegram','pendingUrl','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','\x20payments,\x20returning\x20','split','\x20\x20\x20Gateway:\x20','periodFrom','\x20merchants,\x20','period','customerUa','shop','💰\x20[DAILY]\x20Added\x20','23908xDVkaI','getTime','usdtTrcWallet','\x20USDT\x20(total\x20merchant\x20balances)','name','\x20(direct\x20amountUSDT)','lifetime','Shop\x20not\x20found','\x20USDT\x20for\x20payment\x20on\x20','totalPaidOut','merchantEarnings','dailyRevenue','externalPaymentUrl','totalCommissionRate','password','335fyexJl','2020-01-01','getMonth','📊\x20Payment\x20','\x20\x20\x20Balance:\x20','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','\x20USDT\x20total','\x20USDT\x20for\x20','toFixed','customerName','getAllPayouts','pk_','__esModule','default','KLYME\x20GB','💰\x20Current\x20shop\x20balance:\x20','totalPayments','findUnique','⚠️\x20[DAILY]\x20Failed\x20to\x20convert\x20','\x20\x20\x20Shop:\x20','test','txid','date','🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','paidAt','Error\x20processing\x20payment\x20','merchantUrl','\x20\x20\x20Conversion\x20rate:\x20','getPaymentById','✅\x20Payout\x20created:\x20','597dHsqzK','ACTIVE','includes','\x20\x20\x20📊\x20Total\x20payments:\x20','sk_','gateways','get','createPayout','string','failUrl','🔍\x20Admin\x20payments\x20filter:\x20Converting\x20gateway\x20ID\x20','turnoverUSDT','not\x20set','\x20\x20\x20🖥️\x20User\x20Agent:\x20','averageCheckUSDT','values','./currencyService','\x20\x20\x20Gateway\x20key\x20found:\x20','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','📊\x20[DAILY]\x20Processed\x20','conversionRate','KLYME\x20DE','usdtPolygonWallet','create','bcryptjs','\x20PAID\x20payments\x20out\x20of\x20','\x20\x20\x20Username:\x20','all','🔍\x20Admin\x20payments\x20filter:\x20Using\x20gateway\x20name\x20','customerIp','updatePaymentStatus','alltime','705950zjbirz','COMPLETED','crypto','gte','$transaction','getUserById','\x20USDT\x20(','keys','totalTurnover','gatewayOrderId','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','💰\x20Shop\x20','wallets','randomBytes','\x20to\x20','\x20\x20\x20Current\x20balance:\x20','PAID','📊\x20Merchant\x20statistics\x20calculated:','dateFrom','successfulPayments','availableBalance','\x20USDT','\x20no\x20longer\x20PAID:\x20-','📊\x20[ADMIN]\x20Processing\x20','gatewayEarnings','\x20\x20\x20📅\x20This\x20month:\x20','currency','commissionUSDT','toISOString','💰\x20Payment\x20','💰\x20Creating\x20payout\x20for\x20shop\x20','\x20\x20\x20Failed\x20to\x20parse\x20gatewaySettings:\x20','💸\x20CHARGEBACK\x20penalty:\x20-','\x20\x20\x20🌍\x20Country:\x20','\x20USDT)','publicKey','6786txZAIU','📊\x20Shop\x20info\x20for\x20','remitterName','\x20USDT\x20from\x20balance','\x20\x20\x20💰\x20Total\x20payout:\x20','null','SUSPENDED','suspendUser','telegramId','hex','stringify','../config/database','CoinToPay','getMerchantStatistics','error','Username\x20already\x20exists','📊\x20Merchants\x20awaiting\x20payout:\x20','\x20\x20\x20Total\x20paid\x20out:\x20','averageCommissionRate','📊\x20Total\x20payments\x20(all\x20statuses):\x20','groupBy','amountUSDT','month','INACTIVE','\x20for\x20payment\x20on\x20','💰\x20Found\x20','set','✅\x20Successful\x20payments:\x20','\x20items','gatewaySettings','adminNotes','findMany','deleteUser','thisMonth','log','status','\x20USDT\x20(+','\x20\x20\x20Parsed\x20gatewaySettings:','createUser','remitterIban','\x20\x20\x20👤\x20Merchant\x20earnings:\x20','length','Amer\x20Master','defineProperty','Payment\x20not\x20found','paymentGateways','toString','parse','toLowerCase','💱\x20[DAILY]\x20Converted\x20','📊\x20All-time\x20statistics\x20from\x20first\x20payment:\x20','\x20\x20\x20Name:\x20','hash'];a35_0x501e=function(){return _0x4983b9;};return a35_0x501e();}class AdminService{async['getPayoutStats'](){const _0x561aed=a35_0x41c38c;console['log']('📊\x20Calculating\x20payout\x20statistics...');const _0x49e050=await database_1[_0x561aed(0x1d0)][_0x561aed(0x1b2)][_0x561aed(0x15e)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':'ACTIVE'}}),_0x3de9f9=new Date(),_0x2784c8=new Date(_0x3de9f9[_0x561aed(0x17b)](),_0x3de9f9[_0x561aed(0x1c5)](),0x1),_0x4eee9=new Date(_0x3de9f9[_0x561aed(0x17b)](),_0x3de9f9['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x53292b=await database_1[_0x561aed(0x1d0)][_0x561aed(0x180)][_0x561aed(0x15e)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x2784c8,'lte':_0x4eee9},'status':_0x561aed(0xe5)}}),_0x4fa7fa=_0x49e050['_sum'][_0x561aed(0x1bd)]||0x0,_0x42ee6a=_0x49e050[_0x561aed(0x15b)][_0x561aed(0x142)]||0x0,_0x535a3e=_0x53292b[_0x561aed(0x15b)][_0x561aed(0x169)]||0x0,_0xb5058={'totalPayout':Math[_0x561aed(0x156)](_0x4fa7fa*0x64)/0x64,'awaitingPayout':Math[_0x561aed(0x156)](_0x42ee6a*0x64)/0x64,'thisMonth':Math[_0x561aed(0x156)](_0x535a3e*0x64)/0x64,'availableBalance':Math[_0x561aed(0x156)](_0x42ee6a*0x64)/0x64};return console['log'](_0x561aed(0x181)),console[_0x561aed(0x12a)](_0x561aed(0x10c)+_0xb5058['totalPayout']+_0x561aed(0x18b)),console['log'](_0x561aed(0x184)+_0xb5058[_0x561aed(0x174)]+_0x561aed(0x1b7)),console[_0x561aed(0x12a)](_0x561aed(0x16d)+_0xb5058[_0x561aed(0xf8)]+'\x20USDT\x20(same\x20as\x20awaiting)'),console['log'](_0x561aed(0xfd)+_0xb5058[_0x561aed(0x129)]+_0x561aed(0xf9)),_0xb5058;}async['updateCustomerData'](_0x1fc8df,_0x55c2f3){const _0x2b8262=a35_0x41c38c;console[_0x2b8262(0x12a)]('🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20'+_0x1fc8df+':',_0x55c2f3);const _0x43e2db=await database_1[_0x2b8262(0x1d0)][_0x2b8262(0x163)][_0x2b8262(0x1d4)]({'where':{'id':_0x1fc8df},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x43e2db)throw new Error(_0x2b8262(0x134));const _0x4090f2={};_0x55c2f3[_0x2b8262(0x177)]!==undefined&&(_0x4090f2[_0x2b8262(0x177)]=_0x55c2f3[_0x2b8262(0x177)]||null);_0x55c2f3[_0x2b8262(0xe1)]!==undefined&&(_0x4090f2[_0x2b8262(0xe1)]=_0x55c2f3['customerIp']||null);_0x55c2f3['customerUa']!==undefined&&(_0x4090f2[_0x2b8262(0x1b1)]=_0x55c2f3['customerUa']||null);const _0x5371bb=await database_1[_0x2b8262(0x1d0)][_0x2b8262(0x163)][_0x2b8262(0x14d)]({'where':{'id':_0x1fc8df},'data':{..._0x4090f2,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x2b8262(0x12a)]('✅\x20Customer\x20data\x20updated\x20for\x20payment\x20'+_0x1fc8df),console['log'](_0x2b8262(0x105)+_0x43e2db['customerCountry']+_0x2b8262(0x13e)+_0x5371bb['customerCountry']),console['log']('\x20\x20\x20🌐\x20IP:\x20'+_0x43e2db['customerIp']+_0x2b8262(0x13e)+_0x5371bb[_0x2b8262(0xe1)]),console[_0x2b8262(0x12a)](_0x2b8262(0xd1)+(_0x43e2db[_0x2b8262(0x1b1)]?_0x2b8262(0x122):_0x2b8262(0xd0))+_0x2b8262(0x13e)+(_0x5371bb['customerUa']?'set':_0x2b8262(0xd0))),_0x5371bb;}async[a35_0x41c38c(0x165)](_0x4c0ac9){const _0x5cd5d3=a35_0x41c38c,_0x516030=new Date();let _0x1fe49d;switch(_0x4c0ac9){case'7d':_0x1fe49d=new Date(_0x516030[_0x5cd5d3(0x1b5)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x5cd5d3(0x17f):_0x1fe49d=new Date(_0x516030['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'90d':_0x1fe49d=new Date(_0x516030['getTime']()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case'all':case'alltime':case'lifetime':const _0x225746=await database_1['default']['payment'][_0x5cd5d3(0x187)]({'where':{'gateway':{'not':_0x5cd5d3(0x192)}},'orderBy':{'createdAt':_0x5cd5d3(0x15f)},'select':{'createdAt':!![]}});_0x1fe49d=_0x225746?_0x225746[_0x5cd5d3(0x17d)]:new Date(0x0),console[_0x5cd5d3(0x12a)](_0x5cd5d3(0x13a)+_0x1fe49d[_0x5cd5d3(0x100)]());break;default:_0x1fe49d=new Date(_0x516030[_0x5cd5d3(0x1b5)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x5b26bd,_0x80af5b,_0x38f934,_0x8ec85d,_0x2efe51,_0xa18e8f,_0x494fa3]=await Promise[_0x5cd5d3(0xdf)]([database_1[_0x5cd5d3(0x1d0)][_0x5cd5d3(0x1b2)][_0x5cd5d3(0x1a1)](),database_1[_0x5cd5d3(0x1d0)]['shop'][_0x5cd5d3(0x1a1)]({'where':{'status':_0x5cd5d3(0x1e2)}}),database_1[_0x5cd5d3(0x1d0)][_0x5cd5d3(0x163)]['count']({'where':{'createdAt':{'gte':_0x1fe49d},'gateway':{'not':'test_gateway'}}}),database_1[_0x5cd5d3(0x1d0)][_0x5cd5d3(0x163)][_0x5cd5d3(0x1a1)]({'where':{'status':_0x5cd5d3(0xf4),'createdAt':{'gte':_0x1fe49d},'gateway':{'not':_0x5cd5d3(0x192)}}}),database_1[_0x5cd5d3(0x1d0)][_0x5cd5d3(0x163)][_0x5cd5d3(0x127)]({'where':{'status':'PAID','createdAt':{'gte':_0x1fe49d},'gateway':{'not':'test_gateway'}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x5cd5d3(0x1d0)][_0x5cd5d3(0x163)][_0x5cd5d3(0x127)]({'where':{'gateway':{'not':_0x5cd5d3(0x192)}},'take':0xa,'orderBy':{'createdAt':_0x5cd5d3(0x162)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x5cd5d3(0x1d0)][_0x5cd5d3(0x163)][_0x5cd5d3(0x127)]({'where':{'createdAt':{'gte':_0x1fe49d},'gateway':{'not':_0x5cd5d3(0x192)}},'select':{'status':!![],'amountUSDT':!![],'amount':!![],'currency':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x5cd5d3(0x15f)}})]);let _0x3152c6=0x0;for(const _0x46983f of _0x2efe51){if(_0x46983f[_0x5cd5d3(0x11d)])_0x3152c6+=_0x46983f[_0x5cd5d3(0x11d)];else{const _0x87714=await currencyService_1[_0x5cd5d3(0x1a7)][_0x5cd5d3(0x176)](_0x46983f[_0x5cd5d3(0x169)],_0x46983f['currency']);_0x3152c6+=_0x87714;}}console[_0x5cd5d3(0x12a)](_0x5cd5d3(0xfb)+_0x494fa3[_0x5cd5d3(0x131)]+_0x5cd5d3(0x1a3)),console[_0x5cd5d3(0x12a)]('📊\x20[ADMIN]\x20Period:\x20'+_0x1fe49d[_0x5cd5d3(0x100)]()['split']('T')[0x0]+'\x20to\x20'+_0x516030['toISOString']()['split']('T')[0x0]);const _0x239a14=_0x494fa3[_0x5cd5d3(0x178)]((_0x1f3e6b,_0x7dfb6b)=>{const _0xe8cbe0=_0x5cd5d3;return _0x1f3e6b[_0x7dfb6b[_0xe8cbe0(0x12b)]]=(_0x1f3e6b[_0x7dfb6b[_0xe8cbe0(0x12b)]]||0x0)+0x1,_0x1f3e6b;},{});console[_0x5cd5d3(0x12a)]('📊\x20[ADMIN]\x20Status\x20breakdown:',_0x239a14);const _0x10a9f8=await this[_0x5cd5d3(0x159)](_0x494fa3,_0x1fe49d,_0x516030),_0x510e52=_0x38f934>0x0?_0x8ec85d/_0x38f934*0x64:0x0;return{'totalShops':_0x5b26bd,'activeShops':_0x80af5b,'totalPayments':_0x38f934,'successfulPayments':_0x8ec85d,'totalRevenue':Math['round'](_0x3152c6*0x64)/0x64,'conversionRate':Math[_0x5cd5d3(0x156)](_0x510e52*0x64)/0x64,'dailyRevenue':_0x10a9f8[_0x5cd5d3(0x1bf)],'dailyPayments':_0x10a9f8[_0x5cd5d3(0x154)],'recentPayments':_0xa18e8f[_0x5cd5d3(0x190)](_0x565e6a=>({'id':_0x565e6a['id'],'amount':_0x565e6a[_0x5cd5d3(0x169)],'currency':_0x565e6a[_0x5cd5d3(0xfe)],'status':_0x565e6a['status'],'gateway':_0x565e6a[_0x5cd5d3(0x18f)],'shop':_0x565e6a['shop'],'createdAt':_0x565e6a['createdAt']}))};}async[a35_0x41c38c(0x159)](_0x240315,_0x435c8b,_0x5ba889){const _0x56b85d=a35_0x41c38c,_0x285b9a=new Map(),_0x12a81a=new Date(_0x435c8b);while(_0x12a81a<=_0x5ba889){const _0x2c5dee=_0x12a81a[_0x56b85d(0x100)]()['split']('T')[0x0];_0x285b9a[_0x56b85d(0x122)](_0x2c5dee,{'revenue':0x0,'count':0x0}),_0x12a81a[_0x56b85d(0x14e)](_0x12a81a['getDate']()+0x1);}let _0x2e51a1=0x0,_0x27ae2a=0x0;for(const _0x1de9d5 of _0x240315){const _0x3f7056=_0x1de9d5[_0x56b85d(0x17d)][_0x56b85d(0x100)]()['split']('T')[0x0],_0x378d5b=_0x285b9a[_0x56b85d(0x1e7)](_0x3f7056);if(_0x378d5b){_0x378d5b[_0x56b85d(0x1a1)]+=0x1;if(_0x1de9d5[_0x56b85d(0x12b)]==='PAID'){_0x2e51a1++;if(_0x1de9d5[_0x56b85d(0x11d)])_0x378d5b['revenue']+=_0x1de9d5[_0x56b85d(0x11d)],_0x27ae2a+=_0x1de9d5[_0x56b85d(0x11d)],console[_0x56b85d(0x12a)](_0x56b85d(0x1b3)+_0x1de9d5[_0x56b85d(0x11d)]+_0x56b85d(0x1ca)+_0x3f7056+_0x56b85d(0x1b9));else try{const _0x148078=await currencyService_1['currencyService']['convertToUSDT'](_0x1de9d5[_0x56b85d(0x169)],_0x1de9d5['currency']);_0x378d5b['revenue']+=_0x148078,_0x27ae2a+=_0x148078,console[_0x56b85d(0x12a)](_0x56b85d(0x139)+_0x1de9d5[_0x56b85d(0x169)]+'\x20'+_0x1de9d5[_0x56b85d(0xfe)]+'\x20to\x20'+_0x148078+_0x56b85d(0x1bc)+_0x3f7056);}catch(_0x43a0e1){console[_0x56b85d(0x149)](_0x56b85d(0x1d5)+_0x1de9d5[_0x56b85d(0x169)]+'\x20'+_0x1de9d5[_0x56b85d(0xfe)]+_0x56b85d(0x120)+_0x3f7056+':',_0x43a0e1);}}}}console[_0x56b85d(0x12a)](_0x56b85d(0xd7)+_0x2e51a1+_0x56b85d(0xdd)+_0x240315['length']+'\x20total'),console[_0x56b85d(0x12a)]('📊\x20[DAILY]\x20Total\x20revenue\x20processed:\x20'+_0x27ae2a+_0x56b85d(0xf9));const _0x104204=[],_0x5b9be6=[];for(const [_0x108461,_0xd95abc]of _0x285b9a){_0x104204['push']({'date':_0x108461,'amount':Math[_0x56b85d(0x156)](_0xd95abc['revenue']*0x64)/0x64}),_0x5b9be6[_0x56b85d(0x193)]({'date':_0x108461,'count':_0xd95abc[_0x56b85d(0x1a1)]});}return{'dailyRevenue':_0x104204,'dailyPayments':_0x5b9be6};}async[a35_0x41c38c(0x115)](_0x354e89){const _0x41ef96=a35_0x41c38c;console[_0x41ef96(0x12a)](_0x41ef96(0x1aa),_0x354e89);let _0x1f4fc5,_0x2a360a=new Date();if(_0x354e89[_0x41ef96(0x1b0)]===_0x41ef96(0x13d)&&_0x354e89[_0x41ef96(0xf6)]&&_0x354e89[_0x41ef96(0x146)])_0x1f4fc5=new Date(_0x354e89['dateFrom']),_0x2a360a=new Date(_0x354e89[_0x41ef96(0x146)]);else{const _0x51c186=new Date();switch(_0x354e89[_0x41ef96(0x1b0)]){case'week':_0x1f4fc5=new Date(_0x51c186['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x41ef96(0x11e):_0x1f4fc5=new Date(_0x51c186[_0x41ef96(0x1b5)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x41ef96(0x186):_0x1f4fc5=new Date(_0x51c186[_0x41ef96(0x1b5)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case'all':case _0x41ef96(0xe3):case _0x41ef96(0x1ba):const _0x2014c5=_0x354e89[_0x41ef96(0x199)]?{'gateway':{'not':_0x41ef96(0x192)},'shopId':_0x354e89[_0x41ef96(0x199)]}:{'gateway':{'not':_0x41ef96(0x192)}},_0xe360f1=await database_1['default'][_0x41ef96(0x163)][_0x41ef96(0x187)]({'where':_0x2014c5,'orderBy':{'createdAt':_0x41ef96(0x15f)},'select':{'createdAt':!![]}});_0x1f4fc5=_0xe360f1?_0xe360f1[_0x41ef96(0x17d)]:new Date('2020-01-01'),console[_0x41ef96(0x12a)](_0x41ef96(0x13a)+_0x1f4fc5[_0x41ef96(0x100)]());break;default:const _0xf0969=await database_1['default'][_0x41ef96(0x163)][_0x41ef96(0x187)]({'where':{'gateway':{'not':_0x41ef96(0x192)}},'orderBy':{'createdAt':_0x41ef96(0x15f)},'select':{'createdAt':!![]}});_0x1f4fc5=_0xf0969?_0xf0969[_0x41ef96(0x17d)]:new Date(_0x41ef96(0x1c4));break;}}console['log'](_0x41ef96(0x19d)+_0x1f4fc5[_0x41ef96(0x100)]()+_0x41ef96(0xf2)+_0x2a360a[_0x41ef96(0x100)]());if(_0x354e89['shopId']){const _0x2f29e8=await database_1[_0x41ef96(0x1d0)]['shop'][_0x41ef96(0x1d4)]({'where':{'id':_0x354e89[_0x41ef96(0x199)]},'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}});console['log'](_0x41ef96(0x109)+_0x354e89['shopId']+':'),console[_0x41ef96(0x12a)](_0x41ef96(0x13b)+_0x2f29e8?.[_0x41ef96(0x1b8)]),console[_0x41ef96(0x12a)](_0x41ef96(0xde)+_0x2f29e8?.[_0x41ef96(0x145)]),console[_0x41ef96(0x12a)](_0x41ef96(0x191)+(_0x2f29e8?.['gatewaySettings']||_0x41ef96(0x10d)));if(_0x2f29e8?.[_0x41ef96(0x125)])try{const _0x1471a2=JSON[_0x41ef96(0x137)](_0x2f29e8[_0x41ef96(0x125)]);console['log'](_0x41ef96(0x12d),_0x1471a2),console[_0x41ef96(0x12a)](_0x41ef96(0x157)+(_0x1471a2['commission']||'not\x20found'));}catch(_0x1d3a7b){console[_0x41ef96(0x12a)](_0x41ef96(0x103)+_0x1d3a7b);}}const _0x50753e={'status':_0x41ef96(0xf4),'gateway':{'not':'test_gateway'},'paidAt':{'gte':_0x1f4fc5,'lte':_0x2a360a}};_0x354e89[_0x41ef96(0x199)]&&(_0x50753e[_0x41ef96(0x199)]=_0x354e89[_0x41ef96(0x199)]);const _0x33b779=await database_1['default']['payment'][_0x41ef96(0x127)]({'where':_0x50753e,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x41ef96(0x12a)](_0x41ef96(0x121)+_0x33b779[_0x41ef96(0x131)]+'\x20paid\x20payments\x20for\x20analysis');const _0x14c07={'gateway':{'not':'test_gateway'},'createdAt':{'gte':_0x1f4fc5,'lte':_0x2a360a}};_0x354e89[_0x41ef96(0x199)]&&(_0x14c07[_0x41ef96(0x199)]=_0x354e89['shopId']);const _0x1ac0e0=await database_1[_0x41ef96(0x1d0)][_0x41ef96(0x163)]['count']({'where':_0x14c07});console[_0x41ef96(0x12a)](_0x41ef96(0x11b)+_0x1ac0e0),console[_0x41ef96(0x12a)](_0x41ef96(0x123)+_0x33b779['length']);let _0x5d35f0=0x0,_0xbce46b=0x0,_0x2bba07=0x0;const _0x499af7={},_0x101908={},_0x2de27a={};for(const _0x18fdc7 of _0x33b779){try{const _0x3bae52=await currencyService_1[_0x41ef96(0x1a7)]['convertToUSDT'](_0x18fdc7[_0x41ef96(0x169)],_0x18fdc7[_0x41ef96(0xfe)]);let _0x24cf0f={};if(_0x18fdc7[_0x41ef96(0x1b2)][_0x41ef96(0x125)])try{_0x24cf0f=JSON[_0x41ef96(0x137)](_0x18fdc7[_0x41ef96(0x1b2)][_0x41ef96(0x125)]);}catch(_0x26b610){console[_0x41ef96(0x116)](_0x41ef96(0x1c8)+_0x18fdc7[_0x41ef96(0x199)]+':',_0x26b610);}let _0xc84dc2=0xa;const _0x2d9d41=Object[_0x41ef96(0xeb)](_0x24cf0f)[_0x41ef96(0x197)](_0x42e985=>_0x42e985[_0x41ef96(0x138)]()===_0x18fdc7['gateway'][_0x41ef96(0x138)]());_0x2d9d41&&_0x24cf0f[_0x2d9d41]&&_0x24cf0f[_0x2d9d41]['commission']&&(_0xc84dc2=_0x24cf0f[_0x2d9d41][_0x41ef96(0x1a6)]);console[_0x41ef96(0x12a)](_0x41ef96(0x1c6)+_0x18fdc7['id']+'\x20commission\x20analysis:'),console[_0x41ef96(0x12a)](_0x41ef96(0x1d6)+_0x18fdc7[_0x41ef96(0x1b2)][_0x41ef96(0x1b8)]+'\x20('+_0x18fdc7[_0x41ef96(0x199)]+')'),console['log'](_0x41ef96(0x1ad)+_0x18fdc7['gateway']),console[_0x41ef96(0x12a)](_0x41ef96(0x191)+(_0x18fdc7['shop'][_0x41ef96(0x125)]||_0x41ef96(0x10d))),console[_0x41ef96(0x12a)](_0x41ef96(0x12d),_0x24cf0f),console[_0x41ef96(0x12a)](_0x41ef96(0xd5)+(_0x2d9d41||_0x41ef96(0x15a))),console[_0x41ef96(0x12a)]('\x20\x20\x20Commission\x20from\x20settings:\x20'+(_0x2d9d41&&_0x24cf0f[_0x2d9d41]?_0x24cf0f[_0x2d9d41][_0x41ef96(0x1a6)]:_0x41ef96(0x15a))),console['log']('\x20\x20\x20Final\x20commission\x20used:\x20'+_0xc84dc2+'%');const _0x19f775=_0x3bae52*(_0xc84dc2/0x64),_0x56082e=_0x3bae52-_0x19f775;_0x5d35f0+=_0x3bae52,_0xbce46b+=_0x56082e,_0x2bba07+=_0x19f775;!_0x499af7[_0x18fdc7[_0x41ef96(0x18f)]]&&(_0x499af7[_0x18fdc7[_0x41ef96(0x18f)]]={'gateway':_0x18fdc7[_0x41ef96(0x18f)],'gatewayDisplayName':this['getGatewayDisplayName'](_0x18fdc7[_0x41ef96(0x18f)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x499af7[_0x18fdc7[_0x41ef96(0x18f)]][_0x41ef96(0x14a)]++,_0x499af7[_0x18fdc7['gateway']]['turnoverUSDT']+=_0x3bae52,_0x499af7[_0x18fdc7['gateway']][_0x41ef96(0xff)]+=_0x19f775,_0x499af7[_0x18fdc7[_0x41ef96(0x18f)]][_0x41ef96(0x141)]+=_0x56082e,_0x499af7[_0x18fdc7[_0x41ef96(0x18f)]][_0x41ef96(0x1c1)]+=_0xc84dc2;!_0x354e89[_0x41ef96(0x199)]&&(!_0x101908[_0x18fdc7[_0x41ef96(0x199)]]&&(_0x101908[_0x18fdc7['shopId']]={'shopId':_0x18fdc7[_0x41ef96(0x199)],'shopName':_0x18fdc7[_0x41ef96(0x1b2)][_0x41ef96(0x1b8)],'shopUsername':_0x18fdc7[_0x41ef96(0x1b2)]['username'],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x101908[_0x18fdc7[_0x41ef96(0x199)]]['paymentsCount']++,_0x101908[_0x18fdc7[_0x41ef96(0x199)]][_0x41ef96(0xcf)]+=_0x3bae52,_0x101908[_0x18fdc7['shopId']]['commissionUSDT']+=_0x19f775,_0x101908[_0x18fdc7['shopId']][_0x41ef96(0x141)]+=_0x56082e);const _0x5560d4=_0x18fdc7[_0x41ef96(0x1db)][_0x41ef96(0x100)]()[_0x41ef96(0x1ac)]('T')[0x0];!_0x2de27a[_0x5560d4]&&(_0x2de27a[_0x5560d4]={'date':_0x5560d4,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x2de27a[_0x5560d4]['turnover']+=_0x3bae52,_0x2de27a[_0x5560d4][_0x41ef96(0x1be)]+=_0x56082e,_0x2de27a[_0x5560d4]['gatewayEarnings']+=_0x19f775,_0x2de27a[_0x5560d4][_0x41ef96(0x14a)]++;}catch(_0x98057b){console[_0x41ef96(0x116)](_0x41ef96(0x1dc)+_0x18fdc7['id']+':',_0x98057b);}}Object[_0x41ef96(0xd3)](_0x499af7)['forEach'](_0x26be8e=>{const _0xeeca79=_0x41ef96;_0x26be8e[_0xeeca79(0x11a)]=_0x26be8e[_0xeeca79(0x14a)]>0x0?_0x26be8e[_0xeeca79(0x1c1)]/_0x26be8e[_0xeeca79(0x14a)]:0x0,delete _0x26be8e['totalCommissionRate'];}),Object['values'](_0x101908)[_0x41ef96(0x1a4)](_0x3799c7=>{const _0x3a2788=_0x41ef96;_0x3799c7[_0x3a2788(0xd2)]=_0x3799c7[_0x3a2788(0x14a)]>0x0?_0x3799c7[_0x3a2788(0xcf)]/_0x3799c7[_0x3a2788(0x14a)]:0x0;});let _0x1cd605=0x0;if(_0x354e89[_0x41ef96(0x199)]){const _0x83e0bc=await database_1[_0x41ef96(0x1d0)][_0x41ef96(0x180)][_0x41ef96(0x127)]({'where':{'shopId':_0x354e89['shopId'],'status':_0x41ef96(0xe5),'createdAt':{'gte':_0x1f4fc5,'lte':_0x2a360a}},'select':{'amount':!![]}});_0x1cd605=_0x83e0bc[_0x41ef96(0x178)]((_0x3caa64,_0x1b1453)=>_0x3caa64+_0x1b1453[_0x41ef96(0x169)],0x0);}const _0x464f5b=_0x1ac0e0,_0x3b99a3=_0x33b779['length'],_0x51d5b4=_0x3b99a3>0x0?_0x5d35f0/_0x3b99a3:0x0,_0x4164f4=_0x464f5b>0x0?_0x3b99a3/_0x464f5b*0x64:0x0;console[_0x41ef96(0x12a)](_0x41ef96(0x164)),console[_0x41ef96(0x12a)](_0x41ef96(0x194)+_0x464f5b),console[_0x41ef96(0x12a)]('\x20\x20\x20Successful\x20payments:\x20'+_0x3b99a3),console[_0x41ef96(0x12a)](_0x41ef96(0x1de)+_0x4164f4[_0x41ef96(0x1cb)](0x2)+'%');const _0x51be75=Math['ceil']((_0x2a360a['getTime']()-_0x1f4fc5[_0x41ef96(0x1b5)]())/(0x3e8*0x3c*0x3c*0x18)),_0x14aa61={'totalTurnover':Math[_0x41ef96(0x156)](_0x5d35f0*0x64)/0x64,'merchantEarnings':Math['round'](_0xbce46b*0x64)/0x64,'gatewayEarnings':Math[_0x41ef96(0x156)](_0x2bba07*0x64)/0x64,'totalPaidOut':Math[_0x41ef96(0x156)](_0x1cd605*0x64)/0x64,'averageCheck':Math[_0x41ef96(0x156)](_0x51d5b4*0x64)/0x64,'totalPayments':_0x464f5b,'successfulPayments':_0x3b99a3,'conversionRate':Math[_0x41ef96(0x156)](_0x4164f4*0x64)/0x64,'gatewayBreakdown':Object[_0x41ef96(0xd3)](_0x499af7)[_0x41ef96(0x190)](_0x3534ac=>({..._0x3534ac,'turnoverUSDT':Math[_0x41ef96(0x156)](_0x3534ac[_0x41ef96(0xcf)]*0x64)/0x64,'commissionUSDT':Math[_0x41ef96(0x156)](_0x3534ac[_0x41ef96(0xff)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x41ef96(0x156)](_0x3534ac['merchantEarningsUSDT']*0x64)/0x64,'averageCommissionRate':Math[_0x41ef96(0x156)](_0x3534ac[_0x41ef96(0x11a)]*0x64)/0x64})),'merchantBreakdown':_0x354e89['shopId']?undefined:Object['values'](_0x101908)[_0x41ef96(0x190)](_0x452a83=>({..._0x452a83,'turnoverUSDT':Math['round'](_0x452a83[_0x41ef96(0xcf)]*0x64)/0x64,'commissionUSDT':Math['round'](_0x452a83[_0x41ef96(0xff)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x452a83[_0x41ef96(0x141)]*0x64)/0x64,'paidOutUSDT':Math[_0x41ef96(0x156)](_0x452a83[_0x41ef96(0x19c)]*0x64)/0x64,'averageCheckUSDT':Math[_0x41ef96(0x156)](_0x452a83[_0x41ef96(0xd2)]*0x64)/0x64})),'dailyData':Object[_0x41ef96(0xd3)](_0x2de27a)[_0x41ef96(0x190)](_0x41070e=>({..._0x41070e,'turnover':Math[_0x41ef96(0x156)](_0x41070e['turnover']*0x64)/0x64,'merchantEarnings':Math[_0x41ef96(0x156)](_0x41070e[_0x41ef96(0x1be)]*0x64)/0x64,'gatewayEarnings':Math['round'](_0x41070e[_0x41ef96(0xfc)]*0x64)/0x64}))[_0x41ef96(0x18c)]((_0x33cb1b,_0x4791aa)=>_0x33cb1b[_0x41ef96(0x1d9)]['localeCompare'](_0x4791aa[_0x41ef96(0x1d9)])),'periodInfo':{'from':_0x1f4fc5,'to':_0x2a360a,'periodType':_0x354e89[_0x41ef96(0x1b0)]||_0x41ef96(0x13d),'daysCount':_0x51be75}};return console[_0x41ef96(0x12a)](_0x41ef96(0xf5)),console['log'](_0x41ef96(0x182)+_0x14aa61[_0x41ef96(0xec)]+'\x20USDT'),console['log'](_0x41ef96(0x130)+_0x14aa61[_0x41ef96(0x1be)]+_0x41ef96(0xf9)),console[_0x41ef96(0x12a)](_0x41ef96(0xee)+_0x14aa61['gatewayEarnings']+'\x20USDT'),console['log'](_0x41ef96(0x1e4)+_0x14aa61[_0x41ef96(0x1d3)]),console[_0x41ef96(0x12a)]('\x20\x20\x20✅\x20Successful\x20payments:\x20'+_0x14aa61[_0x41ef96(0xf7)]),console['log']('\x20\x20\x20📈\x20Conversion\x20rate:\x20'+_0x14aa61[_0x41ef96(0xd8)]+'%'),_0x14aa61;}[a35_0x41c38c(0x195)](_0x3b6056){const _0x6d5f5=a35_0x41c38c,_0x35d0f3={'test_gateway':'Test\x20Gateway','plisio':_0x6d5f5(0x173),'rapyd':_0x6d5f5(0x161),'noda':'Noda','cointopay':_0x6d5f5(0x114),'mastercard':_0x6d5f5(0x132),'klyme_eu':_0x6d5f5(0x150),'klyme_gb':_0x6d5f5(0x1d1),'klyme_de':_0x6d5f5(0xd9)};return _0x35d0f3[_0x3b6056]||_0x3b6056;}async[a35_0x41c38c(0x160)](_0x37e150){const _0x2b6946=a35_0x41c38c,{page:_0x5cea37,limit:_0x47c4db,minAmount:_0x3ad841,search:_0xbbf969}=_0x37e150,_0x5348e9=(_0x5cea37-0x1)*_0x47c4db;console[_0x2b6946(0x12a)]('📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:',_0x37e150);const _0x5db49d={'balance':{'gt':0x0},'status':_0x2b6946(0x1e2)};_0x3ad841&&(_0x5db49d['balance']['gte']=_0x3ad841);_0xbbf969&&(_0x5db49d['OR']=[{'name':{'contains':_0xbbf969,'mode':'insensitive'}},{'username':{'contains':_0xbbf969,'mode':'insensitive'}}]);const [_0x3cada8,_0x4ea05f]=await Promise[_0x2b6946(0xdf)]([database_1[_0x2b6946(0x1d0)][_0x2b6946(0x1b2)][_0x2b6946(0x127)]({'where':_0x5db49d,'skip':_0x5348e9,'take':_0x47c4db,'orderBy':{'balance':_0x2b6946(0x162)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'createdAt':!![]}}),database_1[_0x2b6946(0x1d0)][_0x2b6946(0x1b2)]['count']({'where':_0x5db49d})]);console['log']('💰\x20Found\x20'+_0x3cada8['length']+_0x2b6946(0x153));const _0x2f3fc8=await Promise[_0x2b6946(0xdf)](_0x3cada8[_0x2b6946(0x190)](async _0x24b372=>{const _0xf0d028=_0x2b6946,[_0x45d7e8,_0x18a858,_0x4338fc]=await Promise[_0xf0d028(0xdf)]([database_1[_0xf0d028(0x1d0)][_0xf0d028(0x163)]['count']({'where':{'shopId':_0x24b372['id'],'status':_0xf0d028(0xf4),'amountUSDT':{'not':null}}}),database_1[_0xf0d028(0x1d0)][_0xf0d028(0x163)]['findFirst']({'where':{'shopId':_0x24b372['id'],'status':_0xf0d028(0xf4),'amountUSDT':{'not':null}},'orderBy':{'paidAt':_0xf0d028(0x15f)},'select':{'paidAt':!![]}}),database_1['default'][_0xf0d028(0x163)][_0xf0d028(0x11c)]({'by':[_0xf0d028(0x18f)],'where':{'shopId':_0x24b372['id'],'status':_0xf0d028(0xf4),'amountUSDT':{'not':null}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x270793=_0x4338fc[_0xf0d028(0x190)](_0x546345=>({'gateway':_0x546345['gateway'],'count':_0x546345[_0xf0d028(0x179)]['id'],'amountUSDT':_0x546345[_0xf0d028(0x15b)]['amountUSDT']||0x0,'amountAfterCommissionUSDT':_0x546345[_0xf0d028(0x15b)][_0xf0d028(0x11d)]||0x0,'commission':0x0}));return{'id':_0x24b372['id'],'fullName':_0x24b372[_0xf0d028(0x1b8)],'username':_0x24b372[_0xf0d028(0x145)],'telegramId':_0x24b372[_0xf0d028(0x1a8)],'merchantUrl':_0x24b372[_0xf0d028(0x172)],'wallets':{'usdtPolygonWallet':_0x24b372[_0xf0d028(0xda)],'usdtTrcWallet':_0x24b372['usdtTrcWallet'],'usdtErcWallet':_0x24b372[_0xf0d028(0x19a)],'usdcPolygonWallet':_0x24b372[_0xf0d028(0x166)]},'totalAmountUSDT':_0x24b372[_0xf0d028(0x142)],'totalAmountAfterCommissionUSDT':_0x24b372['balance'],'paymentsCount':_0x45d7e8,'oldestPaymentDate':_0x18a858?.[_0xf0d028(0x1db)]||_0x24b372['createdAt'],'gatewayBreakdown':_0x270793};})),_0xbc036c=_0x3cada8['reduce']((_0x5c7418,_0x118602)=>_0x5c7418+_0x118602[_0x2b6946(0x142)],0x0),_0x4d721c=_0xbc036c;return console[_0x2b6946(0x12a)](_0x2b6946(0x118)+_0x4ea05f+_0x2b6946(0x1af)+Math[_0x2b6946(0x156)](_0x4d721c*0x64)/0x64+_0x2b6946(0x1c9)),{'merchants':_0x2f3fc8,'pagination':{'page':_0x5cea37,'limit':_0x47c4db,'total':_0x4ea05f,'totalPages':Math[_0x2b6946(0x16e)](_0x4ea05f/_0x47c4db)},'summary':{'totalMerchants':_0x4ea05f,'totalAmountUSDT':Math[_0x2b6946(0x156)](_0xbc036c*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x4d721c*0x64)/0x64}};}async[a35_0x41c38c(0x1e8)](_0x51123f){const _0x138c1b=a35_0x41c38c,{shopId:_0x2bad61,amount:_0x15089b,network:_0x4c3421,notes:_0x5c088f,periodFrom:_0x2599d8,periodTo:_0x505ce9}=_0x51123f,_0xd7394f=await database_1[_0x138c1b(0x1d0)][_0x138c1b(0xe8)](async _0x36f511=>{const _0x2b59f0=_0x138c1b,_0x1225f1=await _0x36f511[_0x2b59f0(0x1b2)][_0x2b59f0(0x1d4)]({'where':{'id':_0x2bad61},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x1225f1)throw new Error(_0x2b59f0(0x1bb));console[_0x2b59f0(0x12a)](_0x2b59f0(0x102)+_0x1225f1['username']+':'),console[_0x2b59f0(0x12a)](_0x2b59f0(0xf3)+_0x1225f1[_0x2b59f0(0x142)][_0x2b59f0(0x1cb)](0x6)+_0x2b59f0(0xf9)),console['log'](_0x2b59f0(0x17e)+_0x15089b[_0x2b59f0(0x1cb)](0x6)+_0x2b59f0(0xf9)),console[_0x2b59f0(0x12a)](_0x2b59f0(0xd6)+_0x1225f1[_0x2b59f0(0x1bd)][_0x2b59f0(0x1cb)](0x6)+_0x2b59f0(0xf9));if(_0x1225f1['balance']<_0x15089b)throw new Error(_0x2b59f0(0x170)+_0x1225f1[_0x2b59f0(0x142)][_0x2b59f0(0x1cb)](0x6)+_0x2b59f0(0x1a2)+_0x15089b[_0x2b59f0(0x1cb)](0x6)+_0x2b59f0(0xf9));const _0x9690a7=await _0x36f511[_0x2b59f0(0x180)]['create']({'data':{'shopId':_0x2bad61,'amount':_0x15089b,'network':_0x4c3421,'status':_0x2b59f0(0xe5),'notes':_0x5c088f,'periodFrom':_0x2599d8?new Date(_0x2599d8):null,'periodTo':_0x505ce9?new Date(_0x505ce9):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x13b255=_0x1225f1['balance']-_0x15089b,_0x2e9f1a=_0x1225f1['totalPaidOut']+_0x15089b;return await _0x36f511[_0x2b59f0(0x1b2)][_0x2b59f0(0x14d)]({'where':{'id':_0x2bad61},'data':{'balance':_0x13b255,'totalPaidOut':_0x2e9f1a}}),console[_0x2b59f0(0x12a)](_0x2b59f0(0xef)+_0x1225f1[_0x2b59f0(0x145)]+'\x20balance\x20updated:'),console[_0x2b59f0(0x12a)](_0x2b59f0(0x1c7)+_0x1225f1[_0x2b59f0(0x142)][_0x2b59f0(0x1cb)](0x6)+'\x20->\x20'+_0x13b255['toFixed'](0x6)+_0x2b59f0(0x14c)+_0x15089b[_0x2b59f0(0x1cb)](0x6)+')'),console[_0x2b59f0(0x12a)](_0x2b59f0(0x119)+_0x1225f1[_0x2b59f0(0x1bd)][_0x2b59f0(0x1cb)](0x6)+_0x2b59f0(0x13e)+_0x2e9f1a['toFixed'](0x6)+_0x2b59f0(0x12c)+_0x15089b['toFixed'](0x6)+')'),{'payout':_0x9690a7,'shop':_0x1225f1};});return console[_0x138c1b(0x12a)](_0x138c1b(0x1e0)+_0xd7394f[_0x138c1b(0x180)]['id']+_0x138c1b(0x18d)+_0xd7394f[_0x138c1b(0x1b2)][_0x138c1b(0x145)]+'\x20('+_0x15089b+_0x138c1b(0x106)),{'id':_0xd7394f[_0x138c1b(0x180)]['id'],'shopId':_0xd7394f['payout'][_0x138c1b(0x199)],'shopName':_0xd7394f['shop'][_0x138c1b(0x1b8)],'shopUsername':_0xd7394f[_0x138c1b(0x1b2)][_0x138c1b(0x145)],'amount':_0xd7394f[_0x138c1b(0x180)][_0x138c1b(0x169)],'network':_0xd7394f[_0x138c1b(0x180)]['network'],'status':_0xd7394f[_0x138c1b(0x180)][_0x138c1b(0x12b)],'txid':_0xd7394f[_0x138c1b(0x180)][_0x138c1b(0x1d8)],'notes':_0xd7394f[_0x138c1b(0x180)][_0x138c1b(0x188)],'periodFrom':_0xd7394f[_0x138c1b(0x180)][_0x138c1b(0x1ae)],'periodTo':_0xd7394f[_0x138c1b(0x180)][_0x138c1b(0x189)],'createdAt':_0xd7394f[_0x138c1b(0x180)][_0x138c1b(0x17d)],'paidAt':_0xd7394f[_0x138c1b(0x180)][_0x138c1b(0x1db)]};}async[a35_0x41c38c(0x1cd)](_0x5dc1df){const _0xb7703c=a35_0x41c38c,{page:_0x7b4959,limit:_0x11caf5,shopId:_0x46e93c,network:_0xa41fd0,dateFrom:_0x3950ac,dateTo:_0x526764,search:_0x272771}=_0x5dc1df,_0x1ba76f=(_0x7b4959-0x1)*_0x11caf5,_0x52cfd0={};_0x46e93c&&(_0x52cfd0[_0xb7703c(0x199)]=_0x46e93c);_0xa41fd0&&(_0x52cfd0[_0xb7703c(0x14b)]=_0xa41fd0);(_0x3950ac||_0x526764)&&(_0x52cfd0[_0xb7703c(0x17d)]={},_0x3950ac&&(_0x52cfd0[_0xb7703c(0x17d)][_0xb7703c(0xe7)]=new Date(_0x3950ac)),_0x526764&&(_0x52cfd0[_0xb7703c(0x17d)][_0xb7703c(0x171)]=new Date(_0x526764)));_0x272771&&(_0x52cfd0['OR']=[{'shop':{'name':{'contains':_0x272771,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x272771,'mode':'insensitive'}}},{'notes':{'contains':_0x272771,'mode':_0xb7703c(0x14f)}}]);const [_0x1dda51,_0x2de872]=await Promise[_0xb7703c(0xdf)]([database_1[_0xb7703c(0x1d0)][_0xb7703c(0x180)]['findMany']({'where':_0x52cfd0,'skip':_0x1ba76f,'take':_0x11caf5,'orderBy':{'createdAt':_0xb7703c(0x162)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0xb7703c(0x1d0)][_0xb7703c(0x180)][_0xb7703c(0x1a1)]({'where':_0x52cfd0})]);return{'payouts':_0x1dda51[_0xb7703c(0x190)](_0x366c25=>({'id':_0x366c25['id'],'shopId':_0x366c25[_0xb7703c(0x199)],'shopName':_0x366c25[_0xb7703c(0x1b2)]['name'],'shopUsername':_0x366c25[_0xb7703c(0x1b2)][_0xb7703c(0x145)],'amount':_0x366c25[_0xb7703c(0x169)],'network':_0x366c25[_0xb7703c(0x14b)],'status':_0x366c25[_0xb7703c(0x12b)],'txid':_0x366c25['txid'],'notes':_0x366c25['notes'],'periodFrom':_0x366c25[_0xb7703c(0x1ae)],'periodTo':_0x366c25['periodTo'],'createdAt':_0x366c25[_0xb7703c(0x17d)],'paidAt':_0x366c25['paidAt']})),'pagination':{'page':_0x7b4959,'limit':_0x11caf5,'total':_0x2de872,'totalPages':Math[_0xb7703c(0x16e)](_0x2de872/_0x11caf5)}};}async[a35_0x41c38c(0x19f)](_0x3c5c19){const _0xcb3a24=a35_0x41c38c,_0x340f1b=await database_1[_0xcb3a24(0x1d0)][_0xcb3a24(0x180)][_0xcb3a24(0x1d4)]({'where':{'id':_0x3c5c19},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x340f1b)return null;return{'id':_0x340f1b['id'],'shopId':_0x340f1b[_0xcb3a24(0x199)],'shopName':_0x340f1b[_0xcb3a24(0x1b2)]['name'],'shopUsername':_0x340f1b[_0xcb3a24(0x1b2)][_0xcb3a24(0x145)],'amount':_0x340f1b['amount'],'network':_0x340f1b[_0xcb3a24(0x14b)],'status':_0x340f1b['status'],'txid':_0x340f1b[_0xcb3a24(0x1d8)],'notes':_0x340f1b[_0xcb3a24(0x188)],'periodFrom':_0x340f1b['periodFrom'],'periodTo':_0x340f1b[_0xcb3a24(0x189)],'createdAt':_0x340f1b[_0xcb3a24(0x17d)],'paidAt':_0x340f1b['paidAt']};}async[a35_0x41c38c(0x185)](_0x350b7c){const _0x3496ad=a35_0x41c38c;await database_1[_0x3496ad(0x1d0)][_0x3496ad(0x180)]['delete']({'where':{'id':_0x350b7c}});}async[a35_0x41c38c(0x17a)](_0x169989){const _0x5def4c=a35_0x41c38c,{page:_0x5ed790,limit:_0x212822,status:_0x1a9bcd,gateway:_0x2b0f69,shopId:_0x450f53,dateFrom:_0x3b9e93,dateTo:_0xfa5c1f,search:_0x3e3bf5}=_0x169989,_0x33a903=(_0x5ed790-0x1)*_0x212822,_0xc9a5e0={};_0x1a9bcd&&(_0xc9a5e0[_0x5def4c(0x12b)]=_0x1a9bcd[_0x5def4c(0x151)]());if(_0x2b0f69){const {getGatewayNameById:_0x300ea5,isValidGatewayId:_0xed7ce3}=require(_0x5def4c(0x158)),_0x29d4e4=/^\d{4}$/[_0x5def4c(0x1d7)](_0x2b0f69);if(_0x29d4e4&&_0xed7ce3(_0x2b0f69)){const _0x11e519=_0x300ea5(_0x2b0f69);console[_0x5def4c(0x12a)](_0x5def4c(0xce)+_0x2b0f69+_0x5def4c(0x1a5)+_0x11e519),_0xc9a5e0[_0x5def4c(0x18f)]=_0x11e519;}else console['log'](_0x5def4c(0xe0)+_0x2b0f69+_0x5def4c(0x15d)),_0xc9a5e0[_0x5def4c(0x18f)]=_0x2b0f69['toLowerCase']();}_0xc9a5e0[_0x5def4c(0x18f)]=_0xc9a5e0[_0x5def4c(0x18f)]?_0xc9a5e0[_0x5def4c(0x18f)]:{'not':'test_gateway'};if(typeof _0xc9a5e0[_0x5def4c(0x18f)]===_0x5def4c(0x1e9)&&_0xc9a5e0[_0x5def4c(0x18f)]!=='test_gateway'){}else{if(typeof _0xc9a5e0['gateway']==='string'&&_0xc9a5e0[_0x5def4c(0x18f)]===_0x5def4c(0x192)){}else _0xc9a5e0[_0x5def4c(0x18f)]={'not':_0x5def4c(0x192)};}_0x450f53&&(_0xc9a5e0[_0x5def4c(0x199)]=_0x450f53);(_0x3b9e93||_0xfa5c1f)&&(_0xc9a5e0[_0x5def4c(0x17d)]={},_0x3b9e93&&(_0xc9a5e0[_0x5def4c(0x17d)][_0x5def4c(0xe7)]=new Date(_0x3b9e93)),_0xfa5c1f&&(_0xc9a5e0[_0x5def4c(0x17d)][_0x5def4c(0x171)]=new Date(_0xfa5c1f)));_0x3e3bf5&&(_0xc9a5e0['OR']=[{'orderId':{'contains':_0x3e3bf5,'mode':'insensitive'}},{'gatewayOrderId':{'contains':_0x3e3bf5,'mode':_0x5def4c(0x14f)}},{'customerEmail':{'contains':_0x3e3bf5,'mode':_0x5def4c(0x14f)}},{'shop':{'name':{'contains':_0x3e3bf5,'mode':_0x5def4c(0x14f)}}},{'shop':{'username':{'contains':_0x3e3bf5,'mode':_0x5def4c(0x14f)}}}]);console[_0x5def4c(0x12a)]('🔍\x20Admin\x20getAllPayments\x20query\x20filters:',JSON[_0x5def4c(0x112)](_0xc9a5e0,null,0x2));const [_0x29a5ad,_0x2e321a]=await Promise[_0x5def4c(0xdf)]([database_1['default'][_0x5def4c(0x163)][_0x5def4c(0x127)]({'where':_0xc9a5e0,'skip':_0x33a903,'take':_0x212822,'orderBy':{'createdAt':_0x5def4c(0x162)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x5def4c(0x163)][_0x5def4c(0x1a1)]({'where':_0xc9a5e0})]);return console['log'](_0x5def4c(0x175)+_0x2e321a+_0x5def4c(0x1ab)+_0x29a5ad[_0x5def4c(0x131)]+_0x5def4c(0x124)),_0x29a5ad[_0x5def4c(0x131)]>0x0&&console[_0x5def4c(0x12a)]('📊\x20First\x20payment\x20gateway:\x20'+_0x29a5ad[0x0]['gateway']),{'payments':_0x29a5ad['map'](_0x29b058=>({'id':_0x29b058['id'],'shopId':_0x29b058[_0x5def4c(0x199)],'gateway':this['getGatewayDisplayName'](_0x29b058['gateway']),'gatewayTechnical':_0x29b058[_0x5def4c(0x18f)],'amount':_0x29b058['amount'],'currency':_0x29b058[_0x5def4c(0xfe)],'status':_0x29b058['status'],'orderId':_0x29b058[_0x5def4c(0x152)],'gatewayOrderId':_0x29b058[_0x5def4c(0xed)],'customerEmail':_0x29b058[_0x5def4c(0x168)],'customerName':_0x29b058['customerName'],'customerCountry':_0x29b058['customerCountry'],'customerIp':_0x29b058[_0x5def4c(0xe1)],'customerUa':_0x29b058['customerUa'],'failureMessage':_0x29b058[_0x5def4c(0x19b)],'cardLast4':_0x29b058[_0x5def4c(0x167)],'paymentMethod':_0x29b058[_0x5def4c(0x155)],'bankId':_0x29b058[_0x5def4c(0x15c)],'remitterIban':_0x29b058[_0x5def4c(0x12f)],'remitterName':_0x29b058[_0x5def4c(0x10a)],'txUrls':_0x29b058[_0x5def4c(0x18a)],'createdAt':_0x29b058[_0x5def4c(0x17d)],'updatedAt':_0x29b058['updatedAt'],'shop':_0x29b058['shop']})),'pagination':{'page':_0x5ed790,'limit':_0x212822,'total':_0x2e321a,'totalPages':Math['ceil'](_0x2e321a/_0x212822)}};}async[a35_0x41c38c(0x1df)](_0x1a11e7){const _0x351455=a35_0x41c38c,_0xde8557=await database_1[_0x351455(0x1d0)][_0x351455(0x163)][_0x351455(0x1d4)]({'where':{'id':_0x1a11e7},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0xde8557)return null;return{'id':_0xde8557['id'],'shopId':_0xde8557[_0x351455(0x199)],'gateway':this[_0x351455(0x195)](_0xde8557[_0x351455(0x18f)]),'gatewayTechnical':_0xde8557[_0x351455(0x18f)],'amount':_0xde8557[_0x351455(0x169)],'currency':_0xde8557[_0x351455(0xfe)],'status':_0xde8557[_0x351455(0x12b)],'orderId':_0xde8557[_0x351455(0x152)],'gatewayOrderId':_0xde8557[_0x351455(0xed)],'customerEmail':_0xde8557[_0x351455(0x168)],'customerName':_0xde8557[_0x351455(0x1cc)],'customerCountry':_0xde8557[_0x351455(0x177)],'customerIp':_0xde8557[_0x351455(0xe1)],'customerUa':_0xde8557['customerUa'],'failureMessage':_0xde8557[_0x351455(0x19b)],'externalPaymentUrl':_0xde8557[_0x351455(0x1c0)],'successUrl':_0xde8557[_0x351455(0x17c)],'failUrl':_0xde8557[_0x351455(0x1ea)],'pendingUrl':_0xde8557[_0x351455(0x1a9)],'whiteUrl':_0xde8557['whiteUrl'],'cardLast4':_0xde8557[_0x351455(0x167)],'paymentMethod':_0xde8557[_0x351455(0x155)],'bankId':_0xde8557['bankId'],'remitterIban':_0xde8557[_0x351455(0x12f)],'remitterName':_0xde8557[_0x351455(0x10a)],'txUrls':_0xde8557[_0x351455(0x18a)],'createdAt':_0xde8557[_0x351455(0x17d)],'updatedAt':_0xde8557[_0x351455(0x18e)],'shop':_0xde8557[_0x351455(0x1b2)]};}async[a35_0x41c38c(0xe2)](_0x1fd752,_0x1ffeea,_0x21b29d,_0x2b0544){const _0x5a2fdd=a35_0x41c38c,_0x86b5ea=await database_1['default'][_0x5a2fdd(0xe8)](async _0x422b13=>{const _0x127982=_0x5a2fdd,_0x3e9b02=await _0x422b13[_0x127982(0x163)][_0x127982(0x1d4)]({'where':{'id':_0x1fd752},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x3e9b02)throw new Error(_0x127982(0x134));const _0x4b4dcc=_0x3e9b02[_0x127982(0x12b)],_0x126636=_0x1ffeea[_0x127982(0x151)]();console['log']('🔄\x20Admin\x20updating\x20payment\x20'+_0x1fd752+'\x20status:\x20'+_0x4b4dcc+_0x127982(0x13e)+_0x126636),console[_0x127982(0x12a)](_0x127982(0x1d2)+_0x3e9b02[_0x127982(0x1b2)]['balance']+_0x127982(0xf9));const _0x2373cc={'status':_0x126636,'updatedAt':new Date(),'statusChangedBy':'admin','statusChangedAt':new Date()};_0x21b29d&&(_0x2373cc[_0x127982(0x126)]=_0x21b29d);_0x126636===_0x127982(0x148)&&_0x2b0544&&(_0x2373cc[_0x127982(0x183)]=_0x2b0544);let _0x272dc7=0x0,_0x5b1d52=_0x3e9b02['shop'][_0x127982(0x142)];if(_0x126636==='PAID'&&_0x4b4dcc!==_0x127982(0xf4)){_0x2373cc['paidAt']=new Date();const _0x1d4b04=await currencyService_1['currencyService'][_0x127982(0x176)](_0x3e9b02[_0x127982(0x169)],_0x3e9b02[_0x127982(0xfe)]);_0x2373cc[_0x127982(0x11d)]=_0x1d4b04,_0x272dc7=_0x1d4b04,_0x5b1d52+=_0x1d4b04,console[_0x127982(0x12a)](_0x127982(0x101)+_0x1fd752+'\x20became\x20PAID:\x20+'+_0x1d4b04[_0x127982(0x1cb)](0x6)+'\x20USDT\x20to\x20balance');}else _0x4b4dcc===_0x127982(0xf4)&&_0x126636!==_0x127982(0xf4)&&(_0x3e9b02['amountUSDT']&&(_0x272dc7=-_0x3e9b02[_0x127982(0x11d)],_0x5b1d52-=_0x3e9b02['amountUSDT'],_0x2373cc['amountUSDT']=null,console[_0x127982(0x12a)]('💰\x20Payment\x20'+_0x1fd752+_0x127982(0xfa)+_0x3e9b02[_0x127982(0x11d)][_0x127982(0x1cb)](0x6)+_0x127982(0x10b))));if(_0x126636==='CHARGEBACK'){if(_0x4b4dcc===_0x127982(0xf4)&&_0x3e9b02[_0x127982(0x11d)]){}_0x2b0544&&_0x2b0544>0x0&&(_0x272dc7-=_0x2b0544,_0x5b1d52-=_0x2b0544,console[_0x127982(0x12a)](_0x127982(0x104)+_0x2b0544[_0x127982(0x1cb)](0x6)+_0x127982(0x10b)));}_0x126636===_0x127982(0x140)&&_0x4b4dcc===_0x127982(0xf4)&&console[_0x127982(0x12a)](_0x127982(0x1da));const _0x42bb4d=await _0x422b13[_0x127982(0x163)][_0x127982(0x14d)]({'where':{'id':_0x1fd752},'data':_0x2373cc,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x272dc7!==0x0&&(await _0x422b13[_0x127982(0x1b2)][_0x127982(0x14d)]({'where':{'id':_0x3e9b02[_0x127982(0x199)]},'data':{'balance':_0x5b1d52}}),console['log'](_0x127982(0xef)+_0x3e9b02[_0x127982(0x199)]+'\x20balance\x20updated:\x20'+_0x3e9b02[_0x127982(0x1b2)][_0x127982(0x142)][_0x127982(0x1cb)](0x6)+_0x127982(0x13e)+_0x5b1d52[_0x127982(0x1cb)](0x6)+_0x127982(0xea)+(_0x272dc7>0x0?'+':'')+_0x272dc7[_0x127982(0x1cb)](0x6)+')')),_0x42bb4d;});return{'id':_0x86b5ea['id'],'shopId':_0x86b5ea[_0x5a2fdd(0x199)],'gateway':_0x86b5ea['gateway'],'amount':_0x86b5ea['amount'],'currency':_0x86b5ea[_0x5a2fdd(0xfe)],'status':_0x86b5ea[_0x5a2fdd(0x12b)],'orderId':_0x86b5ea[_0x5a2fdd(0x152)],'gatewayOrderId':_0x86b5ea['gatewayOrderId'],'customerEmail':_0x86b5ea[_0x5a2fdd(0x168)],'customerName':_0x86b5ea[_0x5a2fdd(0x1cc)],'customerCountry':_0x86b5ea[_0x5a2fdd(0x177)],'customerIp':_0x86b5ea[_0x5a2fdd(0xe1)],'customerUa':_0x86b5ea['customerUa'],'failureMessage':_0x86b5ea[_0x5a2fdd(0x19b)],'adminNotes':_0x86b5ea[_0x5a2fdd(0x126)],'chargebackAmount':_0x86b5ea['chargebackAmount'],'statusChangedBy':_0x86b5ea['statusChangedBy'],'statusChangedAt':_0x86b5ea['statusChangedAt'],'createdAt':_0x86b5ea[_0x5a2fdd(0x17d)],'updatedAt':_0x86b5ea[_0x5a2fdd(0x18e)],'shop':_0x86b5ea[_0x5a2fdd(0x1b2)]};}async[a35_0x41c38c(0x16b)](_0x1ed389,_0x49f178){const _0x59c9c5=a35_0x41c38c,_0xcf54f0={..._0x49f178};_0x49f178[_0x59c9c5(0x1c2)]&&(_0xcf54f0['password']=await bcryptjs_1[_0x59c9c5(0x1d0)][_0x59c9c5(0x13c)](_0x49f178[_0x59c9c5(0x1c2)],0xc));_0x49f178[_0x59c9c5(0x144)]&&(_0xcf54f0[_0x59c9c5(0x1b8)]=_0x49f178[_0x59c9c5(0x144)],delete _0xcf54f0[_0x59c9c5(0x144)]);_0x49f178[_0x59c9c5(0x110)]&&(_0xcf54f0[_0x59c9c5(0x1a8)]=_0x49f178[_0x59c9c5(0x110)],delete _0xcf54f0['telegramId']);_0x49f178[_0x59c9c5(0x1dd)]&&(_0xcf54f0[_0x59c9c5(0x172)]=_0x49f178[_0x59c9c5(0x1dd)],delete _0xcf54f0[_0x59c9c5(0x1dd)]);_0x49f178[_0x59c9c5(0x1e6)]&&(_0xcf54f0[_0x59c9c5(0x135)]=JSON[_0x59c9c5(0x112)](_0x49f178['gateways']),delete _0xcf54f0['gateways']);_0x49f178[_0x59c9c5(0x125)]&&(_0xcf54f0[_0x59c9c5(0x125)]=JSON[_0x59c9c5(0x112)](_0x49f178[_0x59c9c5(0x125)]));_0x49f178['wallets']&&(_0x49f178['wallets']['usdtPolygonWallet']!==undefined&&(_0xcf54f0[_0x59c9c5(0xda)]=_0x49f178[_0x59c9c5(0xf0)][_0x59c9c5(0xda)]||null),_0x49f178['wallets'][_0x59c9c5(0x1b6)]!==undefined&&(_0xcf54f0[_0x59c9c5(0x1b6)]=_0x49f178[_0x59c9c5(0xf0)][_0x59c9c5(0x1b6)]||null),_0x49f178[_0x59c9c5(0xf0)][_0x59c9c5(0x19a)]!==undefined&&(_0xcf54f0['usdtErcWallet']=_0x49f178['wallets'][_0x59c9c5(0x19a)]||null),_0x49f178[_0x59c9c5(0xf0)][_0x59c9c5(0x166)]!==undefined&&(_0xcf54f0['usdcPolygonWallet']=_0x49f178[_0x59c9c5(0xf0)][_0x59c9c5(0x166)]||null),delete _0xcf54f0[_0x59c9c5(0xf0)]);const _0x5d7fd8=await database_1['default'][_0x59c9c5(0x1b2)][_0x59c9c5(0x14d)]({'where':{'id':_0x1ed389},'data':_0xcf54f0,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x5d7fd8['id'],'fullName':_0x5d7fd8['name'],'username':_0x5d7fd8['username'],'telegramId':_0x5d7fd8[_0x59c9c5(0x1a8)],'merchantUrl':_0x5d7fd8[_0x59c9c5(0x172)],'gateways':_0x5d7fd8[_0x59c9c5(0x135)]?JSON[_0x59c9c5(0x137)](_0x5d7fd8[_0x59c9c5(0x135)]):null,'gatewaySettings':_0x5d7fd8[_0x59c9c5(0x125)]?JSON[_0x59c9c5(0x137)](_0x5d7fd8[_0x59c9c5(0x125)]):null,'publicKey':_0x5d7fd8['publicKey'],'wallets':{'usdtPolygonWallet':_0x5d7fd8[_0x59c9c5(0xda)],'usdtTrcWallet':_0x5d7fd8[_0x59c9c5(0x1b6)],'usdtErcWallet':_0x5d7fd8[_0x59c9c5(0x19a)],'usdcPolygonWallet':_0x5d7fd8[_0x59c9c5(0x166)]},'status':_0x5d7fd8[_0x59c9c5(0x12b)],'createdAt':_0x5d7fd8['createdAt']};}async[a35_0x41c38c(0x10f)](_0x1eed89){const _0x37d5f0=a35_0x41c38c,_0x1d6424=await database_1[_0x37d5f0(0x1d0)][_0x37d5f0(0x1b2)]['update']({'where':{'id':_0x1eed89},'data':{'status':'SUSPENDED'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x1d6424['id'],'fullName':_0x1d6424[_0x37d5f0(0x1b8)],'username':_0x1d6424[_0x37d5f0(0x145)],'telegramId':_0x1d6424[_0x37d5f0(0x1a8)],'merchantUrl':_0x1d6424[_0x37d5f0(0x172)],'gateways':_0x1d6424[_0x37d5f0(0x135)]?JSON[_0x37d5f0(0x137)](_0x1d6424['paymentGateways']):null,'gatewaySettings':_0x1d6424[_0x37d5f0(0x125)]?JSON['parse'](_0x1d6424[_0x37d5f0(0x125)]):null,'publicKey':_0x1d6424[_0x37d5f0(0x107)],'wallets':{'usdtPolygonWallet':_0x1d6424[_0x37d5f0(0xda)],'usdtTrcWallet':_0x1d6424[_0x37d5f0(0x1b6)],'usdtErcWallet':_0x1d6424[_0x37d5f0(0x19a)],'usdcPolygonWallet':_0x1d6424['usdcPolygonWallet']},'status':_0x1d6424[_0x37d5f0(0x12b)],'createdAt':_0x1d6424[_0x37d5f0(0x17d)]};}async[a35_0x41c38c(0x1a0)](_0xd595a2){const _0x2b75db=a35_0x41c38c,_0x2f1f6b=await database_1[_0x2b75db(0x1d0)]['shop'][_0x2b75db(0x14d)]({'where':{'id':_0xd595a2},'data':{'status':_0x2b75db(0x1e2)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2f1f6b['id'],'fullName':_0x2f1f6b[_0x2b75db(0x1b8)],'username':_0x2f1f6b[_0x2b75db(0x145)],'telegramId':_0x2f1f6b[_0x2b75db(0x1a8)],'merchantUrl':_0x2f1f6b[_0x2b75db(0x172)],'gateways':_0x2f1f6b[_0x2b75db(0x135)]?JSON[_0x2b75db(0x137)](_0x2f1f6b[_0x2b75db(0x135)]):null,'gatewaySettings':_0x2f1f6b[_0x2b75db(0x125)]?JSON['parse'](_0x2f1f6b[_0x2b75db(0x125)]):null,'publicKey':_0x2f1f6b[_0x2b75db(0x107)],'wallets':{'usdtPolygonWallet':_0x2f1f6b[_0x2b75db(0xda)],'usdtTrcWallet':_0x2f1f6b[_0x2b75db(0x1b6)],'usdtErcWallet':_0x2f1f6b[_0x2b75db(0x19a)],'usdcPolygonWallet':_0x2f1f6b[_0x2b75db(0x166)]},'status':_0x2f1f6b['status'],'createdAt':_0x2f1f6b[_0x2b75db(0x17d)]};}async['getAllUsers'](_0xb40307){const _0x20dfae=a35_0x41c38c,{page:_0x17e4b8,limit:_0x34a438,status:_0x253c6b}=_0xb40307,_0x46c194=(_0x17e4b8-0x1)*_0x34a438,_0x2441be={};_0x253c6b&&(_0x2441be[_0x20dfae(0x12b)]=_0x253c6b['toUpperCase']());const [_0x2407cf,_0x21f8bd]=await Promise[_0x20dfae(0xdf)]([database_1[_0x20dfae(0x1d0)][_0x20dfae(0x1b2)][_0x20dfae(0x127)]({'where':_0x2441be,'skip':_0x46c194,'take':_0x34a438,'orderBy':{'createdAt':_0x20dfae(0x162)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x20dfae(0x1d0)][_0x20dfae(0x1b2)]['count']({'where':_0x2441be})]);return{'users':_0x2407cf['map'](_0xd4f438=>({'id':_0xd4f438['id'],'fullName':_0xd4f438[_0x20dfae(0x1b8)],'username':_0xd4f438[_0x20dfae(0x145)],'telegramId':_0xd4f438[_0x20dfae(0x1a8)],'merchantUrl':_0xd4f438[_0x20dfae(0x172)],'gateways':_0xd4f438[_0x20dfae(0x135)]?JSON[_0x20dfae(0x137)](_0xd4f438[_0x20dfae(0x135)]):null,'gatewaySettings':_0xd4f438[_0x20dfae(0x125)]?JSON[_0x20dfae(0x137)](_0xd4f438['gatewaySettings']):null,'publicKey':_0xd4f438[_0x20dfae(0x107)],'wallets':{'usdtPolygonWallet':_0xd4f438['usdtPolygonWallet'],'usdtTrcWallet':_0xd4f438['usdtTrcWallet'],'usdtErcWallet':_0xd4f438['usdtErcWallet'],'usdcPolygonWallet':_0xd4f438['usdcPolygonWallet']},'status':_0xd4f438[_0x20dfae(0x12b)],'createdAt':_0xd4f438[_0x20dfae(0x17d)]})),'pagination':{'page':_0x17e4b8,'limit':_0x34a438,'total':_0x21f8bd,'totalPages':Math[_0x20dfae(0x16e)](_0x21f8bd/_0x34a438)}};}async[a35_0x41c38c(0xe9)](_0x4a650e){const _0x4741ec=a35_0x41c38c,_0x3de94c=await database_1[_0x4741ec(0x1d0)][_0x4741ec(0x1b2)][_0x4741ec(0x1d4)]({'where':{'id':_0x4a650e},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x3de94c)return null;return{'id':_0x3de94c['id'],'fullName':_0x3de94c[_0x4741ec(0x1b8)],'username':_0x3de94c['username'],'telegramId':_0x3de94c[_0x4741ec(0x1a8)],'merchantUrl':_0x3de94c[_0x4741ec(0x172)],'gateways':_0x3de94c[_0x4741ec(0x135)]?JSON[_0x4741ec(0x137)](_0x3de94c[_0x4741ec(0x135)]):null,'gatewaySettings':_0x3de94c['gatewaySettings']?JSON[_0x4741ec(0x137)](_0x3de94c[_0x4741ec(0x125)]):null,'publicKey':_0x3de94c['publicKey'],'wallets':{'usdtPolygonWallet':_0x3de94c[_0x4741ec(0xda)],'usdtTrcWallet':_0x3de94c[_0x4741ec(0x1b6)],'usdtErcWallet':_0x3de94c['usdtErcWallet'],'usdcPolygonWallet':_0x3de94c[_0x4741ec(0x166)]},'status':_0x3de94c[_0x4741ec(0x12b)],'createdAt':_0x3de94c['createdAt']};}async[a35_0x41c38c(0x12e)](_0x289a04){const _0x363899=a35_0x41c38c,{fullName:_0x360475,username:_0x1955d9,password:_0x513389,telegramId:_0xc0008c,merchantUrl:_0x5ee0a9,gateways:_0x5c3d06,gatewaySettings:_0x4f2409,wallets:_0x3258b9}=_0x289a04,_0x58e040=await database_1[_0x363899(0x1d0)][_0x363899(0x1b2)][_0x363899(0x1d4)]({'where':{'username':_0x1955d9}});if(_0x58e040)throw new Error(_0x363899(0x117));if(_0xc0008c){const _0x4c8d64=await database_1[_0x363899(0x1d0)][_0x363899(0x1b2)]['findUnique']({'where':{'telegram':_0xc0008c}});if(_0x4c8d64)throw new Error('Telegram\x20username\x20already\x20exists');}const _0x31fb38=await bcryptjs_1[_0x363899(0x1d0)][_0x363899(0x13c)](_0x513389,0xc),_0x2a3bef=_0x363899(0x1ce)+crypto_1[_0x363899(0x1d0)][_0x363899(0xf1)](0x20)[_0x363899(0x136)]('hex'),_0x3f1c06=_0x363899(0x1e5)+crypto_1[_0x363899(0x1d0)][_0x363899(0xf1)](0x20)[_0x363899(0x136)](_0x363899(0x111)),_0x5519a3=await database_1[_0x363899(0x1d0)][_0x363899(0x1b2)][_0x363899(0xdb)]({'data':{'name':_0x360475,'username':_0x1955d9,'password':_0x31fb38,'telegram':_0xc0008c,'shopUrl':_0x5ee0a9,'paymentGateways':_0x5c3d06?JSON[_0x363899(0x112)](_0x5c3d06):null,'gatewaySettings':_0x4f2409?JSON[_0x363899(0x112)](_0x4f2409):null,'usdtPolygonWallet':_0x3258b9?.[_0x363899(0xda)]||null,'usdtTrcWallet':_0x3258b9?.['usdtTrcWallet']||null,'usdtErcWallet':_0x3258b9?.[_0x363899(0x19a)]||null,'usdcPolygonWallet':_0x3258b9?.[_0x363899(0x166)]||null,'publicKey':_0x2a3bef,'secretKey':_0x3f1c06,'status':_0x363899(0x1e2)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x5519a3['id'],'fullName':_0x5519a3[_0x363899(0x1b8)],'username':_0x5519a3[_0x363899(0x145)],'telegramId':_0x5519a3[_0x363899(0x1a8)],'merchantUrl':_0x5519a3[_0x363899(0x172)],'gateways':_0x5519a3[_0x363899(0x135)]?JSON['parse'](_0x5519a3[_0x363899(0x135)]):null,'gatewaySettings':_0x5519a3[_0x363899(0x125)]?JSON[_0x363899(0x137)](_0x5519a3[_0x363899(0x125)]):null,'publicKey':_0x5519a3[_0x363899(0x107)],'wallets':{'usdtPolygonWallet':_0x5519a3['usdtPolygonWallet'],'usdtTrcWallet':_0x5519a3[_0x363899(0x1b6)],'usdtErcWallet':_0x5519a3[_0x363899(0x19a)],'usdcPolygonWallet':_0x5519a3[_0x363899(0x166)]},'status':_0x5519a3[_0x363899(0x12b)],'createdAt':_0x5519a3[_0x363899(0x17d)]};}async[a35_0x41c38c(0x128)](_0x5bb6fc){const _0x2c0e52=a35_0x41c38c;await database_1[_0x2c0e52(0x1d0)]['shop'][_0x2c0e52(0x196)]({'where':{'id':_0x5bb6fc}});}async['getMerchantsSelection'](_0x472b05){const _0xa1fe73=a35_0x41c38c,_0x134212={};_0x472b05&&['ACTIVE',_0xa1fe73(0x11f),_0xa1fe73(0x10e)][_0xa1fe73(0x1e3)](_0x472b05[_0xa1fe73(0x151)]())&&(_0x134212[_0xa1fe73(0x12b)]=_0x472b05[_0xa1fe73(0x151)]());const _0x440afc=await database_1[_0xa1fe73(0x1d0)][_0xa1fe73(0x1b2)]['findMany']({'where':_0x134212,'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0xa1fe73(0x15f)}});return _0x440afc;}}exports[a35_0x41c38c(0x16f)]=AdminService;