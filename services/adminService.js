'use strict';const a36_0x2cee07=a36_0x2b29;(function(_0x2636ac,_0x2749bb){const _0x412e56=a36_0x2b29,_0xb3f7fe=_0x2636ac();while(!![]){try{const _0x399d8e=-parseInt(_0x412e56(0x1cc))/0x1*(-parseInt(_0x412e56(0x1ac))/0x2)+parseInt(_0x412e56(0x272))/0x3+parseInt(_0x412e56(0x1e4))/0x4*(-parseInt(_0x412e56(0x175))/0x5)+parseInt(_0x412e56(0x230))/0x6+-parseInt(_0x412e56(0x1c0))/0x7*(parseInt(_0x412e56(0x1d0))/0x8)+-parseInt(_0x412e56(0x20c))/0x9*(parseInt(_0x412e56(0x1e0))/0xa)+parseInt(_0x412e56(0x1a8))/0xb*(parseInt(_0x412e56(0x1d3))/0xc);if(_0x399d8e===_0x2749bb)break;else _0xb3f7fe['push'](_0xb3f7fe['shift']());}catch(_0x5314b5){_0xb3f7fe['push'](_0xb3f7fe['shift']());}}}(a36_0x37e3,0x5cc94));var __importDefault=this&&this['__importDefault']||function(_0x1cd2cf){const _0xc23663=a36_0x2b29;return _0x1cd2cf&&_0x1cd2cf[_0xc23663(0x1b5)]?_0x1cd2cf:{'default':_0x1cd2cf};};Object[a36_0x2cee07(0x280)](exports,a36_0x2cee07(0x1b5),{'value':!![]}),exports['AdminService']=void 0x0;const database_1=__importDefault(require(a36_0x2cee07(0x179))),bcryptjs_1=__importDefault(require(a36_0x2cee07(0x1e6))),crypto_1=__importDefault(require(a36_0x2cee07(0x1ca))),currencyService_1=require('./currencyService'),gateway_1=require(a36_0x2cee07(0x27d));function a36_0x2b29(_0x5f34ef,_0x2679f4){const _0x37e375=a36_0x37e3();return a36_0x2b29=function(_0x2b2953,_0x485089){_0x2b2953=_0x2b2953-0x15d;let _0x1befe6=_0x37e375[_0x2b2953];return _0x1befe6;},a36_0x2b29(_0x5f34ef,_0x2679f4);}function a36_0x37e3(){const _0x571c6e=['gateway','username','hash','\x20\x20\x20üñ•Ô∏è\x20User\x20Agent:\x20','merchantUrl','deletePayout','90d','not\x20set','getMonth','üìã\x20Found\x20','amountAfterCommissionUSDT','\x20\x20\x20ÔøΩ\x20Total\x20paid\x20out:\x20','\x20USDT\x20(same\x20as\x20awaiting)','trim','30d','paidAt','chargebackAmount','Error\x20processing\x20payment\x20','notes','\x20USDT\x20for\x20payment\x20','Noda','entries','merchantEarningsUSDT','üí∏\x20CHARGEBACK:\x20Merchant\x20amount\x20already\x20deducted\x20from\x20balance','üîÑ\x20Gateway\x20mapping:','getUserById','dailyRevenue','\x27\x20to\x20name\x20\x27','$transaction','commissionUSDT','password','summary','currency','866457RwTWow','gte',']\x20Updating\x20password\x20for\x20user\x20','\x20USDT','dateFrom','week','setHours','paymentsCount','polygon_usdc','üîÑ\x20Updating\x20customer\x20data\x20for\x20payment\x20','\x20\x20\x20üåç\x20Country:\x20','../types/gateway','\x20\x20\x20üë§\x20Merchant\x20earnings:\x20',':\x20commission\x20=\x20','defineProperty','üìä\x20Gateway\x20filter\x20applied:','deleteUser','awaitingPayout','Rapyd','Insufficient\x20balance.\x20Available:\x20','currencyService','‚úÖ\x20Payout\x20created:\x20','periodTo','\x20USDT\x20(after\x20','gatewaySettings','\x20in\x20','turnover','push','findFirst','gatewayEarnings','delete','üìä\x20Getting\x20payments\x20with\x20filters:','convertToUSDT','publicKey','‚ö†Ô∏è\x20Gateway\x20\x27','REFUND','Shop\x20not\x20found','\x20for\x20shop\x20','commission','amountAfterGatewayCommissionUSDT','paymentGateways','KLYME\x20DE','\x20\x20\x20Gateway:\x20','üìä\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','getMerchantsSelection','name','KLYME\x20EU','customerName','balance','values','\x20USDT\x20(theoretical\x20net)','getMerchantStatistics','payment','includes','üí∏\x20CHARGEBACK\x20penalty:\x20-','merchantEarnings','\x20USDT\x20(-','üîÑ\x20Admin\x20updating\x20payment\x20','üîÑ\x20Converted\x20gateway\x20ID\x20\x27','\x20\x20\x20üîç\x20Calculated\x20after\x20commission:\x20','üîÑ\x20Converted\x20gateway\x20name\x20\x27','‚úÖ\x20Customer\x20data\x20updated\x20for\x20payment\x20','%\x20from\x20','fullName','1395XethwD','default','\x20\x20\x20Balance:\x20','generateDailyStatistics','../config/database','get','cointopay2','findMany','üîç\x20Using\x20gateway\x20\x27','plisio','AdminService','üîß\x20[','üìä\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','üìÖ\x20Period:\x20','customerIp','parse','%\x20commission)','üìä\x20Merchant\x20statistics\x20calculated:','\x20USDT,\x20Requested:\x20','round','\x27\x20(from\x20\x27','\x20\x20\x20Payout\x20amount:\x20',']\x20Gateway\x20settings\x20JSON\x20string:','orderId','updateUser','adminNotes','\x20USDT\x20(+',']\x20Gateway\x20settings\x20before\x20saving:','COMPLETED','map','date','polygon','\x20\x20\x20üìä\x20Commission\x20difference:\x20','üìä\x20Calculating\x20payout\x20statistics...','\x20->\x20','üí∞\x20Creating\x20payout\x20for\x20shop\x20','üìä\x20Sorting\x20payments\x20by\x20','üìã\x20Getting\x20merchants\x20selection\x20list...','üí∞\x20Payment\x20','getFullYear','üîÑ\x20Gateway\x20mapping\x20(get):','usdtPolygonWallet','Open\x20Banking\x202','externalPaymentUrl','toString','getGatewayDisplayName','dateTo','all','üìä\x20Merchants\x20awaiting\x20payout:\x20','\x20paid\x20payments\x20for\x20analysis','ceil','33bOuojp','getAllPayments','0000','statusChangedBy','108586oODMbs','üîÑ\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','gateways','\x20\x20\x20‚è≥\x20Awaiting\x20payout:\x20','_sum',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','test_gateway','groupBy','\x20USDT\x20(actual\x20balances)','__esModule','count','\x20\x20\x20Added\x20to\x20balance:\x20+','getDate','getGatewayInternalName','\x20\x20\x20üí∏\x20Total\x20payouts\x20(all\x20time):\x20','whiteUrl','log','mastercard','txid','suspendUser','1103473ZgbEKt','createdAt','asc','\x20USDT\x20(gross\x20revenue)','amount','\x20balance\x20updated:','\x20\x20\x20üí∞\x20Total\x20turnover:\x20',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','usdcPolygonWallet','getTime','crypto','DAY','1EXChMu','getPayoutStats','network','üéØ\x20updateUser\x20called\x20with\x20ID:\x20','16byLWcO','usdtErcWallet','create','888732SotpWe','gatewayOrderId','updatedAt','customerUa','\x20active\x20merchants\x20for\x20selection','desc','toLowerCase','\x20merchants','setDate','üìä\x20Getting\x20merchant\x20statistics\x20with\x20filters:','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','forEach','amountUSDT','25030ALzopR','totalPayments','reduce','üéØ\x20[','4444QNzqZc','periodFrom','bcryptjs','üí∞\x20Found\x20','klyme_eu','üìä\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','telegram','üí±\x20Currency\x20filter\x20applied:\x20','ACTIVE','totalPayout','\x20USDT\x20from\x20balance','\x20balance\x20updated:\x20','üí∞\x20Current\x20shop\x20balance:\x20','\x20\x20\x20ÔøΩ\x20Total\x20payments\x20turnover:\x20','shopId','totalCommissionRate','averageCommissionRate','pk_','getGatewayIdByName','\x20\x20\x20üí≥\x20Total\x20payments:\x20','getMerchantsAwaitingPayout','availableBalance','customerEmail','update','totalAmountAfterCommissionUSDT','\x20\x20\x20Full\x20amount:\x20','shop','NONEXISTENT_GATEWAY_FILTER','join','\x27\x20not\x20found.\x20Available\x20gateways:\x20','üí∞\x20[PAYOUT]\x20Gateway\x20','period','error','getPayoutById','failureMessage','klyme_de','updateCustomerData','getPaymentById','PAID','findUnique','243hXLJaD','payout','‚úÖ\x20Using\x20gateway\x20filter:\x20\x27','random','\x20order','Payment\x20not\x20found','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','some','_count','updatePaymentStatus','lte','shopUrl','averageCheckUSDT','trc20','turnoverUSDT','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','admin','\x20\x20\x20üìÖ\x20Total\x20payouts\x20(this\x20month):\x20','Plisio','toISOString','‚ö†Ô∏è\x20Requested\x20gateway\x20\x27','revenue','üí∞\x20[PAYOUT]\x20Merchant\x20','wallets','\x20\x20\x20Merchant\x20gets:\x20','stringify','toUpperCase','getSystemStatistics','\x27\x20->\x20ID\x20\x27','CHARGEBACK','üí∞\x20Shop\x20','Test\x20Gateway','\x20payments)','toFixed','status','üîê\x20[','3045510rDWUMD','set','insensitive','length','split','customerCountry','custom','randomBytes','failUrl','\x27\x20->\x20name\x20\x27','localeCompare','successUrl','getAllUsers','telegramId','\x20\x20\x20Current\x20balance:\x20','totalPaidOut','year','2020-01-01','usdtTrcWallet','MasterCard','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','totalAmountUSDT','\x20merchants\x20with\x20positive\x20balance','hex','\x20\x20\x20üè™\x20Gateway\x20earnings:\x20','\x20USDT\x20(without\x20commission)','not\x20specified','\x20\x20\x20üí∞\x20Total\x20payments\x20turnover:\x20','aggregate','\x20USDT\x20(',',\x20Commission:\x20','\x20USDT\x20(after\x20payouts)','getGatewayNameById'];a36_0x37e3=function(){return _0x571c6e;};return a36_0x37e3();}class AdminService{async[a36_0x2cee07(0x1cd)](){const _0x16f001=a36_0x2cee07;console[_0x16f001(0x1bc)](_0x16f001(0x196));const _0x38e46b=await database_1[_0x16f001(0x176)][_0x16f001(0x1fe)][_0x16f001(0x24c)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x16f001(0x1ec)}}),_0x42b88e=await this['getMerchantsAwaitingPayout']({'page':0x1,'limit':0x3e8}),_0x2f50a4=await database_1[_0x16f001(0x176)][_0x16f001(0x169)][_0x16f001(0x1b6)]({'where':{'status':_0x16f001(0x20a),'gateway':{'not':'test_gateway'}}}),_0x300160=new Date(),_0x1cec89=new Date(_0x300160['getFullYear'](),_0x300160['getMonth'](),0x1),_0x11cc38=new Date(_0x300160[_0x16f001(0x19c)](),_0x300160[_0x16f001(0x259)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x475b99=await database_1[_0x16f001(0x176)][_0x16f001(0x20d)][_0x16f001(0x24c)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x1cec89,'lte':_0x11cc38},'status':'COMPLETED'}}),_0x2a9f25=_0x38e46b[_0x16f001(0x1b0)]['totalPaidOut']||0x0,_0x241364=_0x42b88e[_0x16f001(0x270)][_0x16f001(0x1fc)],_0x3fd214=_0x475b99['_sum']['amount']||0x0,_0x4490fa={'totalPayout':Math[_0x16f001(0x188)](_0x2a9f25*0x64)/0x64,'awaitingPayout':Math[_0x16f001(0x188)](_0x241364*0x64)/0x64,'thisMonth':Math[_0x16f001(0x188)](_0x3fd214*0x64)/0x64,'availableBalance':Math['round'](_0x241364*0x64)/0x64,'totalPayments':_0x2f50a4};return console[_0x16f001(0x1bc)]('üìä\x20Payout\x20statistics\x20calculated:'),console[_0x16f001(0x1bc)]('\x20\x20\x20üí∞\x20Total\x20payout:\x20'+_0x4490fa[_0x16f001(0x1ed)]+'\x20USDT\x20(total\x20paid\x20to\x20merchants)'),console[_0x16f001(0x1bc)](_0x16f001(0x1af)+_0x4490fa[_0x16f001(0x283)]+'\x20USDT\x20(with\x20commission\x20deducted)'),console[_0x16f001(0x1bc)]('\x20\x20\x20üíµ\x20Available\x20balance:\x20'+_0x4490fa[_0x16f001(0x1f9)]+_0x16f001(0x25d)),console[_0x16f001(0x1bc)]('\x20\x20\x20üìÖ\x20This\x20month:\x20'+_0x4490fa['thisMonth']+_0x16f001(0x275)),console[_0x16f001(0x1bc)](_0x16f001(0x1f7)+_0x4490fa[_0x16f001(0x1e1)]+'\x20PAID\x20payments'),console[_0x16f001(0x1bc)]('\x20\x20\x20üîç\x20Raw\x20balance\x20sum:\x20'+(_0x38e46b['_sum'][_0x16f001(0x165)]||0x0)['toFixed'](0x2)+_0x16f001(0x249)),console[_0x16f001(0x1bc)](_0x16f001(0x195)+((_0x38e46b['_sum'][_0x16f001(0x165)]||0x0)-_0x241364)['toFixed'](0x2)+_0x16f001(0x275)),_0x4490fa;}async[a36_0x2cee07(0x208)](_0x30b4aa,_0x3fd956){const _0x43a281=a36_0x2cee07;console['log'](_0x43a281(0x27b)+_0x30b4aa+':',_0x3fd956);const _0x5eac46=await database_1[_0x43a281(0x176)][_0x43a281(0x169)]['findUnique']({'where':{'id':_0x30b4aa},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x5eac46)throw new Error(_0x43a281(0x211));const _0x25e394={};_0x3fd956[_0x43a281(0x235)]!==undefined&&(_0x25e394[_0x43a281(0x235)]=_0x3fd956[_0x43a281(0x235)]||null);_0x3fd956['customerIp']!==undefined&&(_0x25e394[_0x43a281(0x183)]=_0x3fd956['customerIp']||null);_0x3fd956[_0x43a281(0x1d6)]!==undefined&&(_0x25e394['customerUa']=_0x3fd956['customerUa']||null);const _0x149ec1=await database_1['default'][_0x43a281(0x169)][_0x43a281(0x1fb)]({'where':{'id':_0x30b4aa},'data':{..._0x25e394,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console['log'](_0x43a281(0x172)+_0x30b4aa),console['log'](_0x43a281(0x27c)+_0x5eac46[_0x43a281(0x235)]+_0x43a281(0x197)+_0x149ec1[_0x43a281(0x235)]),console[_0x43a281(0x1bc)]('\x20\x20\x20üåê\x20IP:\x20'+_0x5eac46[_0x43a281(0x183)]+_0x43a281(0x197)+_0x149ec1[_0x43a281(0x183)]),console[_0x43a281(0x1bc)](_0x43a281(0x254)+(_0x5eac46[_0x43a281(0x1d6)]?_0x43a281(0x231):'not\x20set')+'\x20->\x20'+(_0x149ec1[_0x43a281(0x1d6)]?_0x43a281(0x231):_0x43a281(0x258))),_0x149ec1;}async[a36_0x2cee07(0x227)](_0x1a20bf){const _0x43d1aa=a36_0x2cee07,_0x1090a5=new Date();let _0x2cc9d9;switch(_0x1a20bf[_0x43d1aa(0x1d9)]()){case'day':case _0x43d1aa(0x1cb):_0x2cc9d9=new Date(_0x1090a5[_0x43d1aa(0x19c)](),_0x1090a5[_0x43d1aa(0x259)](),_0x1090a5[_0x43d1aa(0x1b8)](),0x0,0x0,0x0,0x0);break;case'7d':_0x2cc9d9=new Date(_0x1090a5[_0x43d1aa(0x1c9)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x43d1aa(0x25f):_0x2cc9d9=new Date(_0x1090a5[_0x43d1aa(0x1c9)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x43d1aa(0x257):_0x2cc9d9=new Date(_0x1090a5['getTime']()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case _0x43d1aa(0x1a4):const _0x3d3924=await database_1[_0x43d1aa(0x176)][_0x43d1aa(0x169)][_0x43d1aa(0x28e)]({'where':{'gateway':{'not':_0x43d1aa(0x1b2)}},'orderBy':{'createdAt':'asc'},'select':{'createdAt':!![]}});_0x2cc9d9=_0x3d3924?_0x3d3924['createdAt']:new Date('2020-01-01');break;default:_0x2cc9d9=new Date(_0x1090a5['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);}_0x2cc9d9['setHours'](0x0,0x0,0x0,0x0);const [_0x521c54,_0x5dbad0,_0x5d1a08,_0x47dca1,_0xa2b97e,_0x613bfe]=await Promise[_0x43d1aa(0x1a4)]([database_1[_0x43d1aa(0x176)][_0x43d1aa(0x1fe)]['count'](),database_1[_0x43d1aa(0x176)]['shop']['count']({'where':{'status':_0x43d1aa(0x1ec)}}),database_1[_0x43d1aa(0x176)]['payment'][_0x43d1aa(0x1b6)]({'where':{'status':_0x43d1aa(0x20a),'createdAt':{'gte':_0x2cc9d9},'gateway':{'not':_0x43d1aa(0x1b2)}}}),database_1[_0x43d1aa(0x176)]['payment'][_0x43d1aa(0x17c)]({'where':{'status':'PAID','createdAt':{'gte':_0x2cc9d9},'gateway':{'not':_0x43d1aa(0x1b2)}},'select':{'amount':!![],'currency':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1['default'][_0x43d1aa(0x169)][_0x43d1aa(0x17c)]({'where':{'gateway':{'not':'test_gateway'}},'take':0xa,'orderBy':{'createdAt':_0x43d1aa(0x1d8)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x43d1aa(0x176)]['payment']['findMany']({'where':{'createdAt':{'gte':_0x2cc9d9},'gateway':{'not':_0x43d1aa(0x1b2)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x403ae9=0x0,_0x519227=0x0;for(const _0x59e4c6 of _0x47dca1){const _0x3f2ea7=await currencyService_1[_0x43d1aa(0x286)][_0x43d1aa(0x292)](_0x59e4c6[_0x43d1aa(0x1c4)],_0x59e4c6[_0x43d1aa(0x271)]);_0x403ae9+=_0x3f2ea7;if(_0x59e4c6[_0x43d1aa(0x299)]){const _0x4eb047=await currencyService_1[_0x43d1aa(0x286)][_0x43d1aa(0x292)](_0x59e4c6[_0x43d1aa(0x1c4)],_0x59e4c6[_0x43d1aa(0x271)]),_0x4fbca7=_0x59e4c6[_0x43d1aa(0x299)],_0xe6e130=_0x4eb047-_0x4fbca7;_0x519227+=_0xe6e130;}}const _0x35ead4=_0x5d1a08>0x0?_0x403ae9/_0x5d1a08:0x0,_0x106e9f=this[_0x43d1aa(0x178)](_0x613bfe,_0x2cc9d9,_0x1090a5),_0x44522e=await database_1[_0x43d1aa(0x176)]['payment'][_0x43d1aa(0x1b6)]({'where':{'createdAt':{'gte':_0x2cc9d9},'gateway':{'not':_0x43d1aa(0x1b2)}}}),_0x3e2ef8=_0x44522e>0x0?_0x5d1a08/_0x44522e*0x64:0x0;return{'totalShops':_0x521c54,'activeShops':_0x5dbad0,'totalPayments':_0x5d1a08,'successfulPayments':_0x5d1a08,'totalAttempts':_0x44522e,'totalRevenue':Math[_0x43d1aa(0x188)](_0x403ae9*0x64)/0x64,'trapayEarnings':Math[_0x43d1aa(0x188)](_0x519227*0x64)/0x64,'averagePaymentAmount':Math[_0x43d1aa(0x188)](_0x35ead4*0x64)/0x64,'conversionRate':Math[_0x43d1aa(0x188)](_0x3e2ef8*0x64)/0x64,'dailyRevenue':_0x106e9f[_0x43d1aa(0x26b)],'dailyPayments':_0x106e9f['dailyPayments'],'recentPayments':_0xa2b97e[_0x43d1aa(0x192)](_0x5fc190=>({'id':_0x5fc190['id'],'amount':_0x5fc190[_0x43d1aa(0x1c4)],'currency':_0x5fc190[_0x43d1aa(0x271)],'status':_0x5fc190['status'],'gateway':_0x5fc190[_0x43d1aa(0x251)],'shop':_0x5fc190['shop'],'createdAt':_0x5fc190[_0x43d1aa(0x1c1)]}))};}async[a36_0x2cee07(0x168)](_0x5bdcb2){const _0x20ed89=a36_0x2cee07;console[_0x20ed89(0x1bc)](_0x20ed89(0x1dc),_0x5bdcb2);let _0x135690,_0x2adcff=new Date();if(_0x5bdcb2[_0x20ed89(0x203)]===_0x20ed89(0x236)&&_0x5bdcb2[_0x20ed89(0x276)]&&_0x5bdcb2[_0x20ed89(0x1a3)])_0x135690=new Date(_0x5bdcb2[_0x20ed89(0x276)]),_0x2adcff=new Date(_0x5bdcb2['dateTo']),_0x135690[_0x20ed89(0x278)](0x0,0x0,0x0,0x0),_0x2adcff[_0x20ed89(0x278)](0x17,0x3b,0x3b,0x3e7);else{const _0xbdbaf0=new Date();switch(_0x5bdcb2[_0x20ed89(0x203)]){case _0x20ed89(0x277):_0x135690=new Date(_0xbdbaf0[_0x20ed89(0x1c9)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'month':_0x135690=new Date(_0xbdbaf0[_0x20ed89(0x1c9)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x20ed89(0x240):_0x135690=new Date(_0xbdbaf0[_0x20ed89(0x1c9)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x20ed89(0x1a4):default:_0x135690=new Date(_0x20ed89(0x241));break;}_0x135690[_0x20ed89(0x278)](0x0,0x0,0x0,0x0),_0x2adcff['setHours'](0x17,0x3b,0x3b,0x3e7);}console['log'](_0x20ed89(0x182)+_0x135690['toISOString']()+'\x20to\x20'+_0x2adcff[_0x20ed89(0x21f)]());const _0xa6464b={'status':_0x20ed89(0x20a),'gateway':{'not':_0x20ed89(0x1b2)},'paidAt':{'gte':_0x135690,'lte':_0x2adcff}};_0x5bdcb2[_0x20ed89(0x1f2)]&&(_0xa6464b[_0x20ed89(0x1f2)]=_0x5bdcb2[_0x20ed89(0x1f2)]);const _0x2ceafc=await database_1[_0x20ed89(0x176)][_0x20ed89(0x169)][_0x20ed89(0x17c)]({'where':_0xa6464b,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console['log'](_0x20ed89(0x1e7)+_0x2ceafc[_0x20ed89(0x233)]+_0x20ed89(0x1a6));const _0x2cb07a={'gateway':{'not':_0x20ed89(0x1b2)},'createdAt':{'gte':_0x135690,'lte':_0x2adcff}};_0x5bdcb2['shopId']&&(_0x2cb07a[_0x20ed89(0x1f2)]=_0x5bdcb2[_0x20ed89(0x1f2)]);const _0x1317d6=await database_1[_0x20ed89(0x176)][_0x20ed89(0x169)][_0x20ed89(0x1b6)]({'where':_0x2cb07a});console['log']('üìä\x20Total\x20payments\x20(including\x20failed):\x20'+_0x1317d6+',\x20successful:\x20'+_0x2ceafc[_0x20ed89(0x233)]);let _0x5f4edf=0x0,_0x1c4a4a=0x0,_0x3ca69a=0x0;const _0x40e2e1={},_0x7b5bfd={},_0x1f3467={};for(const _0x1551c5 of _0x2ceafc){try{const _0x3f06e5=await currencyService_1[_0x20ed89(0x286)][_0x20ed89(0x292)](_0x1551c5[_0x20ed89(0x1c4)],_0x1551c5[_0x20ed89(0x271)]);let _0x485fb4={};if(_0x1551c5[_0x20ed89(0x1fe)][_0x20ed89(0x28a)])try{_0x485fb4=JSON[_0x20ed89(0x184)](_0x1551c5[_0x20ed89(0x1fe)][_0x20ed89(0x28a)]);}catch(_0x11cd3d){console[_0x20ed89(0x204)]('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x1551c5['shopId']+':',_0x11cd3d);}let _0x670b95={},_0x710b48=0xa;for(const [_0x2e6b47,_0x42c10a]of Object[_0x20ed89(0x266)](_0x485fb4)){if(_0x2e6b47[_0x20ed89(0x1d9)]()===_0x1551c5[_0x20ed89(0x251)][_0x20ed89(0x1d9)]()){_0x670b95=_0x42c10a,_0x710b48=_0x42c10a[_0x20ed89(0x298)]||0xa;break;}}let _0x4abf48,_0x2c32f4;_0x1551c5['amountAfterGatewayCommissionUSDT']!==null&&_0x1551c5['amountAfterGatewayCommissionUSDT']!==undefined?(_0x4abf48=_0x1551c5[_0x20ed89(0x299)],_0x2c32f4=_0x3f06e5-_0x4abf48,console['log']('üìä\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20'+_0x4abf48[_0x20ed89(0x22d)](0x6)+_0x20ed89(0x264)+_0x1551c5['id'])):(_0x2c32f4=_0x3f06e5*(_0x710b48/0x64),_0x4abf48=_0x3f06e5-_0x2c32f4,console[_0x20ed89(0x1bc)](_0x20ed89(0x1e9)+_0x1551c5['id']+':\x20'+_0x710b48+_0x20ed89(0x173)+_0x3f06e5[_0x20ed89(0x22d)](0x6)+_0x20ed89(0x275)));_0x5f4edf+=_0x3f06e5,_0x1c4a4a+=_0x4abf48,_0x3ca69a+=_0x2c32f4;!_0x40e2e1[_0x1551c5['gateway']]&&(_0x40e2e1[_0x1551c5[_0x20ed89(0x251)]]={'gateway':_0x1551c5['gateway'],'gatewayDisplayName':this[_0x20ed89(0x1a2)](_0x1551c5['gateway']),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x40e2e1[_0x1551c5[_0x20ed89(0x251)]][_0x20ed89(0x279)]++,_0x40e2e1[_0x1551c5[_0x20ed89(0x251)]][_0x20ed89(0x21a)]+=_0x3f06e5,_0x40e2e1[_0x1551c5[_0x20ed89(0x251)]][_0x20ed89(0x26e)]+=_0x2c32f4,_0x40e2e1[_0x1551c5[_0x20ed89(0x251)]]['merchantEarningsUSDT']+=_0x4abf48,_0x40e2e1[_0x1551c5[_0x20ed89(0x251)]][_0x20ed89(0x1f3)]+=_0x710b48;!_0x5bdcb2[_0x20ed89(0x1f2)]&&(!_0x7b5bfd[_0x1551c5[_0x20ed89(0x1f2)]]&&(_0x7b5bfd[_0x1551c5[_0x20ed89(0x1f2)]]={'shopId':_0x1551c5[_0x20ed89(0x1f2)],'shopName':_0x1551c5['shop'][_0x20ed89(0x162)],'shopUsername':_0x1551c5[_0x20ed89(0x1fe)][_0x20ed89(0x252)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x7b5bfd[_0x1551c5['shopId']][_0x20ed89(0x279)]++,_0x7b5bfd[_0x1551c5[_0x20ed89(0x1f2)]][_0x20ed89(0x21a)]+=_0x3f06e5,_0x7b5bfd[_0x1551c5[_0x20ed89(0x1f2)]]['commissionUSDT']+=_0x2c32f4,_0x7b5bfd[_0x1551c5[_0x20ed89(0x1f2)]]['merchantEarningsUSDT']+=_0x4abf48);const _0x20e15a=_0x1551c5[_0x20ed89(0x260)][_0x20ed89(0x21f)]()[_0x20ed89(0x234)]('T')[0x0];!_0x1f3467[_0x20e15a]&&(_0x1f3467[_0x20e15a]={'date':_0x20e15a,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x1f3467[_0x20e15a][_0x20ed89(0x28c)]+=_0x3f06e5,_0x1f3467[_0x20e15a][_0x20ed89(0x16c)]+=_0x4abf48,_0x1f3467[_0x20e15a][_0x20ed89(0x28f)]+=_0x2c32f4,_0x1f3467[_0x20e15a][_0x20ed89(0x279)]++;}catch(_0x4294a2){console[_0x20ed89(0x204)](_0x20ed89(0x262)+_0x1551c5['id']+':',_0x4294a2);}}Object['values'](_0x40e2e1)[_0x20ed89(0x1de)](_0x5eeb93=>{const _0x4d0859=_0x20ed89;_0x5eeb93[_0x4d0859(0x1f4)]=_0x5eeb93[_0x4d0859(0x279)]>0x0?_0x5eeb93[_0x4d0859(0x1f3)]/_0x5eeb93[_0x4d0859(0x279)]:0x0,delete _0x5eeb93['totalCommissionRate'];}),Object[_0x20ed89(0x166)](_0x7b5bfd)[_0x20ed89(0x1de)](_0x5e1447=>{const _0x294e02=_0x20ed89;_0x5e1447[_0x294e02(0x218)]=_0x5e1447[_0x294e02(0x279)]>0x0?_0x5e1447[_0x294e02(0x21a)]/_0x5e1447[_0x294e02(0x279)]:0x0;});let _0x2e5b92=0x0,_0x35eecb=0x0;if(_0x5bdcb2[_0x20ed89(0x1f2)]){const _0x3c7ac3=await database_1[_0x20ed89(0x176)][_0x20ed89(0x20d)][_0x20ed89(0x17c)]({'where':{'shopId':_0x5bdcb2[_0x20ed89(0x1f2)],'status':_0x20ed89(0x191),'createdAt':{'gte':_0x135690,'lte':_0x2adcff}},'select':{'amount':!![]}});_0x2e5b92=_0x3c7ac3[_0x20ed89(0x1e2)]((_0x4b61d2,_0x23ecad)=>_0x4b61d2+_0x23ecad[_0x20ed89(0x1c4)],0x0);const _0x27d71d=await database_1[_0x20ed89(0x176)][_0x20ed89(0x20d)][_0x20ed89(0x17c)]({'where':{'shopId':_0x5bdcb2['shopId'],'status':'PENDING','createdAt':{'gte':_0x135690,'lte':_0x2adcff}},'select':{'amount':!![]}});_0x35eecb=_0x27d71d[_0x20ed89(0x1e2)]((_0x4c8e49,_0x2c4704)=>_0x4c8e49+_0x2c4704['amount'],0x0);}const _0x42a02d=_0x1317d6,_0x279164=_0x2ceafc[_0x20ed89(0x233)],_0x98b64=_0x279164>0x0?_0x5f4edf/_0x279164:0x0,_0x325b89=_0x42a02d>0x0?Math[_0x20ed89(0x188)](_0x279164/_0x42a02d*0x2710)/0x64:0x0,_0x457f6a=Math['ceil']((_0x2adcff['getTime']()-_0x135690[_0x20ed89(0x1c9)]())/(0x3e8*0x3c*0x3c*0x18)),_0xb66d6a={'totalTurnover':Math[_0x20ed89(0x188)](_0x5f4edf*0x64)/0x64,'merchantEarnings':Math[_0x20ed89(0x188)](_0x1c4a4a*0x64)/0x64,'gatewayEarnings':Math['round'](_0x3ca69a*0x64)/0x64,'totalPaidOut':Math['round'](_0x2e5b92*0x64)/0x64,'pendingPayout':Math[_0x20ed89(0x188)](_0x35eecb*0x64)/0x64,'averageCheck':Math[_0x20ed89(0x188)](_0x98b64*0x64)/0x64,'totalPayments':_0x42a02d,'successfulPayments':_0x279164,'conversionRate':_0x325b89,'gatewayBreakdown':Object[_0x20ed89(0x166)](_0x40e2e1)[_0x20ed89(0x192)](_0xbd3f7d=>({..._0xbd3f7d,'turnoverUSDT':Math['round'](_0xbd3f7d[_0x20ed89(0x21a)]*0x64)/0x64,'commissionUSDT':Math[_0x20ed89(0x188)](_0xbd3f7d['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x20ed89(0x188)](_0xbd3f7d[_0x20ed89(0x267)]*0x64)/0x64,'averageCommissionRate':Math[_0x20ed89(0x188)](_0xbd3f7d[_0x20ed89(0x1f4)]*0x64)/0x64})),'merchantBreakdown':_0x5bdcb2[_0x20ed89(0x1f2)]?undefined:Object[_0x20ed89(0x166)](_0x7b5bfd)[_0x20ed89(0x192)](_0x58deaf=>({..._0x58deaf,'turnoverUSDT':Math[_0x20ed89(0x188)](_0x58deaf[_0x20ed89(0x21a)]*0x64)/0x64,'commissionUSDT':Math[_0x20ed89(0x188)](_0x58deaf[_0x20ed89(0x26e)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0x58deaf[_0x20ed89(0x267)]*0x64)/0x64,'paidOutUSDT':Math[_0x20ed89(0x188)](_0x58deaf['paidOutUSDT']*0x64)/0x64,'averageCheckUSDT':Math['round'](_0x58deaf[_0x20ed89(0x218)]*0x64)/0x64})),'dailyData':Object[_0x20ed89(0x166)](_0x1f3467)[_0x20ed89(0x192)](_0x3ded0c=>({..._0x3ded0c,'turnover':Math[_0x20ed89(0x188)](_0x3ded0c['turnover']*0x64)/0x64,'merchantEarnings':Math[_0x20ed89(0x188)](_0x3ded0c[_0x20ed89(0x16c)]*0x64)/0x64,'gatewayEarnings':Math['round'](_0x3ded0c[_0x20ed89(0x28f)]*0x64)/0x64}))['sort']((_0x2d98c0,_0x4cbe4a)=>_0x2d98c0[_0x20ed89(0x193)][_0x20ed89(0x23a)](_0x4cbe4a[_0x20ed89(0x193)])),'periodInfo':{'from':_0x135690,'to':_0x2adcff,'periodType':_0x5bdcb2[_0x20ed89(0x203)]||_0x20ed89(0x236),'daysCount':_0x457f6a}};return console['log'](_0x20ed89(0x186)),console['log'](_0x20ed89(0x1c6)+_0xb66d6a['totalTurnover']+_0x20ed89(0x275)),console[_0x20ed89(0x1bc)](_0x20ed89(0x27e)+_0xb66d6a['merchantEarnings']+_0x20ed89(0x275)),console[_0x20ed89(0x1bc)](_0x20ed89(0x248)+_0xb66d6a['gatewayEarnings']+_0x20ed89(0x275)),console[_0x20ed89(0x1bc)](_0x20ed89(0x25c)+_0xb66d6a[_0x20ed89(0x23f)]+_0x20ed89(0x275)),console[_0x20ed89(0x1bc)]('\x20\x20\x20‚è≥\x20Pending\x20payout:\x20'+_0xb66d6a['pendingPayout']+_0x20ed89(0x275)),console[_0x20ed89(0x1bc)]('\x20\x20\x20ÔøΩüìä\x20Total\x20payments:\x20'+_0xb66d6a['totalPayments']),_0xb66d6a;}async[a36_0x2cee07(0x161)](){const _0x56c264=a36_0x2cee07;console['log'](_0x56c264(0x19a));const _0x236c8f=await database_1[_0x56c264(0x176)]['shop'][_0x56c264(0x17c)]({'where':{'status':_0x56c264(0x1ec)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x56c264(0x1c2)}});return console['log'](_0x56c264(0x25a)+_0x236c8f[_0x56c264(0x233)]+_0x56c264(0x1d7)),_0x236c8f[_0x56c264(0x192)](_0x358fcb=>({'id':_0x358fcb['id'],'username':_0x358fcb[_0x56c264(0x252)],'name':_0x358fcb[_0x56c264(0x162)]}));}[a36_0x2cee07(0x1a2)](_0x188ea7){const _0x32b911=a36_0x2cee07,_0x514a8a={'test_gateway':_0x32b911(0x22b),'plisio':_0x32b911(0x21e),'rapyd':_0x32b911(0x284),'noda':_0x32b911(0x265),'cointopay':'CoinToPay','cointopay2':_0x32b911(0x19f),'klyme_eu':_0x32b911(0x163),'klyme_gb':'KLYME\x20GB','klyme_de':_0x32b911(0x15e),'mastercard':_0x32b911(0x243)};return _0x514a8a[_0x188ea7]||_0x188ea7;}['getGatewayInternalName'](_0x3bb1c0){const _0x76f745=a36_0x2cee07,_0x4f8d48={'Test\x20Gateway':_0x76f745(0x1b2),'Plisio':_0x76f745(0x17e),'Rapyd':'rapyd','Noda':'noda','CoinToPay':'cointopay','CoinToPay2':_0x76f745(0x17b),'KLYME\x20EU':_0x76f745(0x1e8),'KLYME\x20GB':'klyme_gb','KLYME\x20DE':_0x76f745(0x207),'MasterCard':_0x76f745(0x1bd)};return _0x4f8d48[_0x3bb1c0]||_0x3bb1c0['toLowerCase']();}async[a36_0x2cee07(0x1f8)](_0x3cec91){const _0x3e78be=a36_0x2cee07,{page:_0x3bcba4,limit:_0x46d795,minAmount:_0x26d792,search:_0x284e49}=_0x3cec91,_0x4db147=(_0x3bcba4-0x1)*_0x46d795;console[_0x3e78be(0x1bc)](_0x3e78be(0x181),_0x3cec91);const _0x2bcc88={'balance':{'gt':0x0},'status':_0x3e78be(0x1ec)};_0x26d792&&(_0x2bcc88[_0x3e78be(0x165)][_0x3e78be(0x273)]=_0x26d792);_0x284e49&&(_0x2bcc88[_0x3e78be(0x162)]={'contains':_0x284e49,'mode':_0x3e78be(0x232)});const [_0x2a1f62,_0x1bc859]=await Promise['all']([database_1[_0x3e78be(0x176)]['shop'][_0x3e78be(0x17c)]({'where':_0x2bcc88,'skip':_0x4db147,'take':_0x46d795,'orderBy':{'balance':_0x3e78be(0x1d8)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1[_0x3e78be(0x176)][_0x3e78be(0x1fe)][_0x3e78be(0x1b6)]({'where':_0x2bcc88})]);console[_0x3e78be(0x1bc)](_0x3e78be(0x1e7)+_0x2a1f62[_0x3e78be(0x233)]+_0x3e78be(0x246));const _0x3dd37e=await Promise['all'](_0x2a1f62[_0x3e78be(0x192)](async _0x5d19c6=>{const _0x2fb0d0=_0x3e78be,[_0x571163,_0x1f531e,_0xe6a1ba]=await Promise[_0x2fb0d0(0x1a4)]([database_1[_0x2fb0d0(0x176)][_0x2fb0d0(0x169)]['count']({'where':{'shopId':_0x5d19c6['id'],'status':_0x2fb0d0(0x20a),'gateway':{'not':_0x2fb0d0(0x1b2)}}}),database_1[_0x2fb0d0(0x176)][_0x2fb0d0(0x169)][_0x2fb0d0(0x28e)]({'where':{'shopId':_0x5d19c6['id'],'status':_0x2fb0d0(0x20a),'gateway':{'not':_0x2fb0d0(0x1b2)}},'orderBy':{'paidAt':_0x2fb0d0(0x1c2)},'select':{'paidAt':!![]}}),database_1[_0x2fb0d0(0x176)][_0x2fb0d0(0x169)][_0x2fb0d0(0x1b3)]({'by':[_0x2fb0d0(0x251)],'where':{'shopId':_0x5d19c6['id'],'status':_0x2fb0d0(0x20a),'gateway':{'not':'test_gateway'}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x389ec4=new Date(),_0x1c63f6=new Date(_0x389ec4[_0x2fb0d0(0x19c)](),_0x389ec4[_0x2fb0d0(0x259)](),0x1),_0xfda833=new Date(_0x389ec4[_0x2fb0d0(0x19c)](),_0x389ec4[_0x2fb0d0(0x259)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x45df81,_0x5448f9]=await Promise[_0x2fb0d0(0x1a4)]([database_1[_0x2fb0d0(0x176)][_0x2fb0d0(0x20d)]['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x5d19c6['id'],'status':_0x2fb0d0(0x191)}}),database_1[_0x2fb0d0(0x176)]['payout'][_0x2fb0d0(0x24c)]({'_sum':{'amount':!![]},'where':{'shopId':_0x5d19c6['id'],'status':'COMPLETED','createdAt':{'gte':_0x1c63f6,'lte':_0xfda833}}})]),_0x1b7afd=_0x45df81['_sum'][_0x2fb0d0(0x1c4)]||0x0,_0x5f4bc5=_0x5448f9['_sum']['amount']||0x0,_0x4d98d5=await Promise['all'](_0xe6a1ba[_0x2fb0d0(0x192)](async _0x430328=>{const _0x286b9a=_0x2fb0d0;let _0x34a1f5=0xa;if(_0x5d19c6['gatewaySettings'])try{const _0xec9ec7=JSON[_0x286b9a(0x184)](_0x5d19c6['gatewaySettings']);for(const [_0x56ea34,_0x5627da]of Object['entries'](_0xec9ec7)){if(_0x56ea34[_0x286b9a(0x1d9)]()===_0x430328['gateway'][_0x286b9a(0x1d9)]()){_0x34a1f5=_0x5627da[_0x286b9a(0x298)]||0xa,console[_0x286b9a(0x1bc)](_0x286b9a(0x202)+_0x430328[_0x286b9a(0x251)]+'\x20for\x20shop\x20'+_0x5d19c6['id']+_0x286b9a(0x27f)+_0x34a1f5+'%');break;}}}catch(_0x466011){console['error']('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x5d19c6['id']+':',_0x466011);}const _0x56ab37=_0x430328[_0x286b9a(0x1b0)]?.[_0x286b9a(0x1df)]||0x0,_0x1e0b19=_0x56ab37*(0x1-_0x34a1f5/0x64);return{'gateway':_0x430328[_0x286b9a(0x251)],'count':_0x430328[_0x286b9a(0x214)]?.['id']||0x0,'amountUSDT':Math[_0x286b9a(0x188)](_0x56ab37*0x64)/0x64,'amountAfterCommissionUSDT':Math['round'](_0x1e0b19*0x64)/0x64,'commission':_0x34a1f5};})),_0x18406a=_0x4d98d5[_0x2fb0d0(0x1e2)]((_0x41faf2,_0x2c2309)=>_0x41faf2+_0x2c2309[_0x2fb0d0(0x1df)],0x0),_0x27ce15=_0x5d19c6[_0x2fb0d0(0x165)];return console['log'](_0x2fb0d0(0x222)+_0x5d19c6[_0x2fb0d0(0x252)]+':'),console[_0x2fb0d0(0x1bc)](_0x2fb0d0(0x1f1)+_0x18406a[_0x2fb0d0(0x22d)](0x2)+'\x20USDT\x20(gross\x20revenue)'),console['log'](_0x2fb0d0(0x170)+_0x4d98d5[_0x2fb0d0(0x1e2)]((_0x25485f,_0x28f124)=>_0x25485f+_0x28f124[_0x2fb0d0(0x25b)],0x0)[_0x2fb0d0(0x22d)](0x2)+_0x2fb0d0(0x167)),console[_0x2fb0d0(0x1bc)]('\x20\x20\x20‚úÖ\x20Actual\x20available\x20balance:\x20'+_0x27ce15[_0x2fb0d0(0x22d)](0x2)+_0x2fb0d0(0x24f)),{'id':_0x5d19c6['id'],'fullName':_0x5d19c6['name'],'username':_0x5d19c6[_0x2fb0d0(0x252)],'telegramId':_0x5d19c6[_0x2fb0d0(0x1ea)],'merchantUrl':_0x5d19c6[_0x2fb0d0(0x217)],'wallets':{'usdtPolygonWallet':_0x5d19c6[_0x2fb0d0(0x19e)],'usdtTrcWallet':_0x5d19c6[_0x2fb0d0(0x242)],'usdtErcWallet':_0x5d19c6[_0x2fb0d0(0x1d1)],'usdcPolygonWallet':_0x5d19c6[_0x2fb0d0(0x1c8)]},'totalAmountUSDT':Math['round'](_0x18406a*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x27ce15*0x64)/0x64,'totalPayout':Math[_0x2fb0d0(0x188)](_0x1b7afd*0x64)/0x64,'thisMonth':Math[_0x2fb0d0(0x188)](_0x5f4bc5*0x64)/0x64,'paymentsCount':_0x571163,'oldestPaymentDate':_0x1f531e?.[_0x2fb0d0(0x260)]||_0x5d19c6[_0x2fb0d0(0x1c1)],'gatewayBreakdown':_0x4d98d5};})),_0x1ddac9=_0x3dd37e['reduce']((_0x59885c,_0x40f17e)=>_0x59885c+_0x40f17e[_0x3e78be(0x245)],0x0),_0x110f46=_0x3dd37e[_0x3e78be(0x1e2)]((_0x44fe0c,_0x3d3b)=>_0x44fe0c+_0x3d3b['totalAmountAfterCommissionUSDT'],0x0),_0x2c3927=_0x3dd37e[_0x3e78be(0x1e2)]((_0x2a137e,_0xa71ceb)=>_0x2a137e+_0xa71ceb[_0x3e78be(0x1ed)],0x0),_0x5dd5f1=_0x3dd37e[_0x3e78be(0x1e2)]((_0x5a818f,_0x4915df)=>_0x5a818f+_0x4915df['thisMonth'],0x0);return console[_0x3e78be(0x1bc)](_0x3e78be(0x1a5)+_0x1bc859+_0x3e78be(0x1da)),console[_0x3e78be(0x1bc)](_0x3e78be(0x24b)+Math[_0x3e78be(0x188)](_0x1ddac9*0x64)/0x64+_0x3e78be(0x1c3)),console[_0x3e78be(0x1bc)]('\x20\x20\x20‚úÖ\x20Total\x20available\x20for\x20payout:\x20'+Math[_0x3e78be(0x188)](_0x110f46*0x64)/0x64+_0x3e78be(0x1b4)),console[_0x3e78be(0x1bc)](_0x3e78be(0x1ba)+Math[_0x3e78be(0x188)](_0x2c3927*0x64)/0x64+_0x3e78be(0x275)),console[_0x3e78be(0x1bc)](_0x3e78be(0x21d)+Math[_0x3e78be(0x188)](_0x5dd5f1*0x64)/0x64+_0x3e78be(0x275)),{'merchants':_0x3dd37e,'pagination':{'page':_0x3bcba4,'limit':_0x46d795,'total':_0x1bc859,'totalPages':Math[_0x3e78be(0x1a7)](_0x1bc859/_0x46d795)},'summary':{'totalMerchants':_0x1bc859,'totalAmountUSDT':Math['round'](_0x1ddac9*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x3e78be(0x188)](_0x110f46*0x64)/0x64,'totalPayout':Math[_0x3e78be(0x188)](_0x2c3927*0x64)/0x64,'thisMonth':Math[_0x3e78be(0x188)](_0x5dd5f1*0x64)/0x64}};}async['createPayout'](_0x25fb0f){const _0x1b9c8a=a36_0x2cee07,{shopId:_0x51e823,amount:_0x4c76fe,network:_0x5de81f,wallet:_0x1c6e77,notes:_0x4f3951,txid:_0x20a190,periodFrom:_0x175bbc,periodTo:_0x5ec651}=_0x25fb0f,_0x3c4b39=await database_1[_0x1b9c8a(0x176)][_0x1b9c8a(0x26d)](async _0xb2d7f5=>{const _0x8e0a27=_0x1b9c8a,_0x3558ee=await _0xb2d7f5['shop']['findUnique']({'where':{'id':_0x51e823},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x3558ee)throw new Error(_0x8e0a27(0x296));console[_0x8e0a27(0x1bc)](_0x8e0a27(0x198)+_0x3558ee[_0x8e0a27(0x252)]+':'),console[_0x8e0a27(0x1bc)](_0x8e0a27(0x23e)+_0x3558ee[_0x8e0a27(0x165)][_0x8e0a27(0x22d)](0x6)+_0x8e0a27(0x275)),console[_0x8e0a27(0x1bc)](_0x8e0a27(0x18a)+_0x4c76fe['toFixed'](0x6)+_0x8e0a27(0x275)),console[_0x8e0a27(0x1bc)](_0x8e0a27(0x1dd)+_0x3558ee[_0x8e0a27(0x23f)][_0x8e0a27(0x22d)](0x6)+_0x8e0a27(0x275));if(_0x20a190)console['log']('\x20\x20\x20Transaction\x20hash:\x20'+_0x20a190);if(_0x3558ee[_0x8e0a27(0x165)]<_0x4c76fe)throw new Error(_0x8e0a27(0x285)+_0x3558ee['balance']['toFixed'](0x6)+_0x8e0a27(0x187)+_0x4c76fe[_0x8e0a27(0x22d)](0x6)+_0x8e0a27(0x275));let _0x597393=_0x1c6e77;if(!_0x597393){const _0x1f56b0=await _0xb2d7f5[_0x8e0a27(0x1fe)][_0x8e0a27(0x20b)]({'where':{'id':_0x51e823},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x1f56b0)switch(_0x5de81f){case _0x8e0a27(0x194):_0x597393=_0x1f56b0[_0x8e0a27(0x19e)]||undefined;break;case _0x8e0a27(0x219):_0x597393=_0x1f56b0[_0x8e0a27(0x242)]||undefined;break;case'erc20':_0x597393=_0x1f56b0['usdtErcWallet']||undefined;break;case _0x8e0a27(0x27a):_0x597393=_0x1f56b0[_0x8e0a27(0x1c8)]||undefined;break;}}console[_0x8e0a27(0x1bc)]('üí≥\x20Payout\x20wallet\x20for\x20'+_0x5de81f+':\x20'+(_0x597393||_0x8e0a27(0x24a)));const _0xb12e1b=await _0xb2d7f5[_0x8e0a27(0x20d)]['create']({'data':{'shopId':_0x51e823,'amount':_0x4c76fe,'network':_0x5de81f,'status':_0x8e0a27(0x191),'txid':_0x20a190,'notes':_0x4f3951,'periodFrom':_0x175bbc?new Date(_0x175bbc):null,'periodTo':_0x5ec651?new Date(_0x5ec651):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x51d54a=_0x3558ee[_0x8e0a27(0x165)]-_0x4c76fe,_0x4a3702=_0x3558ee[_0x8e0a27(0x23f)]+_0x4c76fe;return await _0xb2d7f5[_0x8e0a27(0x1fe)][_0x8e0a27(0x1fb)]({'where':{'id':_0x51e823},'data':{'balance':_0x51d54a,'totalPaidOut':_0x4a3702}}),console[_0x8e0a27(0x1bc)]('üí∞\x20Shop\x20'+_0x3558ee[_0x8e0a27(0x252)]+_0x8e0a27(0x1c5)),console['log'](_0x8e0a27(0x177)+_0x3558ee[_0x8e0a27(0x165)]['toFixed'](0x6)+_0x8e0a27(0x197)+_0x51d54a[_0x8e0a27(0x22d)](0x6)+_0x8e0a27(0x16d)+_0x4c76fe[_0x8e0a27(0x22d)](0x6)+')'),console[_0x8e0a27(0x1bc)]('\x20\x20\x20Total\x20paid\x20out:\x20'+_0x3558ee[_0x8e0a27(0x23f)][_0x8e0a27(0x22d)](0x6)+_0x8e0a27(0x197)+_0x4a3702[_0x8e0a27(0x22d)](0x6)+_0x8e0a27(0x18f)+_0x4c76fe[_0x8e0a27(0x22d)](0x6)+')'),{'payout':_0xb12e1b,'shop':_0x3558ee};});return console['log'](_0x1b9c8a(0x287)+_0x3c4b39['payout']['id']+_0x1b9c8a(0x297)+_0x3c4b39['shop']['username']+'\x20('+_0x4c76fe+'\x20USDT)'),{'id':_0x3c4b39['payout']['id'],'shopId':_0x3c4b39[_0x1b9c8a(0x20d)]['shopId'],'shopName':_0x3c4b39[_0x1b9c8a(0x1fe)][_0x1b9c8a(0x162)],'shopUsername':_0x3c4b39[_0x1b9c8a(0x1fe)]['username'],'amount':_0x3c4b39['payout'][_0x1b9c8a(0x1c4)],'network':_0x3c4b39[_0x1b9c8a(0x20d)][_0x1b9c8a(0x1ce)],'status':_0x3c4b39[_0x1b9c8a(0x20d)][_0x1b9c8a(0x22e)],'txid':_0x3c4b39['payout']['txid'],'notes':_0x3c4b39[_0x1b9c8a(0x20d)][_0x1b9c8a(0x263)],'periodFrom':_0x3c4b39['payout'][_0x1b9c8a(0x1e5)],'periodTo':_0x3c4b39['payout'][_0x1b9c8a(0x288)],'createdAt':_0x3c4b39[_0x1b9c8a(0x20d)][_0x1b9c8a(0x1c1)],'paidAt':_0x3c4b39[_0x1b9c8a(0x20d)][_0x1b9c8a(0x260)]};}async['getAllPayouts'](_0x1c5237){const _0x12e702=a36_0x2cee07,{page:_0x8b03c8,limit:_0xd04394,shopId:_0x218d6c,network:_0x588af3,dateFrom:_0x140d1e,dateTo:_0x35af06,search:_0x15b4aa}=_0x1c5237,_0x39d33f=(_0x8b03c8-0x1)*_0xd04394,_0x1cef4f={};_0x218d6c&&(_0x1cef4f[_0x12e702(0x1f2)]=_0x218d6c);_0x588af3&&(_0x1cef4f['network']=_0x588af3);(_0x140d1e||_0x35af06)&&(_0x1cef4f[_0x12e702(0x1c1)]={},_0x140d1e&&(_0x1cef4f['createdAt'][_0x12e702(0x273)]=new Date(_0x140d1e)),_0x35af06&&(_0x1cef4f[_0x12e702(0x1c1)][_0x12e702(0x216)]=new Date(_0x35af06)));_0x15b4aa&&(_0x1cef4f['OR']=[{'shop':{'name':{'contains':_0x15b4aa,'mode':_0x12e702(0x232)}}},{'shop':{'username':{'contains':_0x15b4aa,'mode':'insensitive'}}},{'notes':{'contains':_0x15b4aa,'mode':_0x12e702(0x232)}}]);const [_0x5ce6ea,_0x44a248]=await Promise[_0x12e702(0x1a4)]([database_1['default'][_0x12e702(0x20d)][_0x12e702(0x17c)]({'where':_0x1cef4f,'skip':_0x39d33f,'take':_0xd04394,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x12e702(0x176)][_0x12e702(0x20d)][_0x12e702(0x1b6)]({'where':_0x1cef4f})]);return{'payouts':_0x5ce6ea[_0x12e702(0x192)](_0x5aebe1=>({'id':_0x5aebe1['id'],'shopId':_0x5aebe1[_0x12e702(0x1f2)],'shopName':_0x5aebe1[_0x12e702(0x1fe)][_0x12e702(0x162)],'shopUsername':_0x5aebe1['shop'][_0x12e702(0x252)],'amount':_0x5aebe1[_0x12e702(0x1c4)],'network':_0x5aebe1[_0x12e702(0x1ce)],'status':_0x5aebe1['status'],'txid':_0x5aebe1[_0x12e702(0x1be)],'notes':_0x5aebe1[_0x12e702(0x263)],'periodFrom':_0x5aebe1[_0x12e702(0x1e5)],'periodTo':_0x5aebe1[_0x12e702(0x288)],'createdAt':_0x5aebe1[_0x12e702(0x1c1)],'paidAt':_0x5aebe1[_0x12e702(0x260)]})),'pagination':{'page':_0x8b03c8,'limit':_0xd04394,'total':_0x44a248,'totalPages':Math[_0x12e702(0x1a7)](_0x44a248/_0xd04394)}};}async[a36_0x2cee07(0x205)](_0x5e0b85){const _0x386aba=a36_0x2cee07,_0x380ae1=await database_1[_0x386aba(0x176)][_0x386aba(0x20d)]['findUnique']({'where':{'id':_0x5e0b85},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x380ae1)return null;return{'id':_0x380ae1['id'],'shopId':_0x380ae1[_0x386aba(0x1f2)],'shopName':_0x380ae1[_0x386aba(0x1fe)][_0x386aba(0x162)],'shopUsername':_0x380ae1[_0x386aba(0x1fe)][_0x386aba(0x252)],'amount':_0x380ae1[_0x386aba(0x1c4)],'network':_0x380ae1[_0x386aba(0x1ce)],'status':_0x380ae1[_0x386aba(0x22e)],'txid':_0x380ae1[_0x386aba(0x1be)],'notes':_0x380ae1[_0x386aba(0x263)],'periodFrom':_0x380ae1['periodFrom'],'periodTo':_0x380ae1[_0x386aba(0x288)],'createdAt':_0x380ae1[_0x386aba(0x1c1)],'paidAt':_0x380ae1[_0x386aba(0x260)]};}async[a36_0x2cee07(0x256)](_0xcc60e9){const _0x593738=a36_0x2cee07;await database_1[_0x593738(0x176)][_0x593738(0x20d)][_0x593738(0x290)]({'where':{'id':_0xcc60e9}});}async[a36_0x2cee07(0x1a9)](_0x1b7fd3){const _0x47a103=a36_0x2cee07,{page:_0x66c3c,limit:_0x62e2f,status:_0x3fb7ef,gateway:_0x1da3f0,shopId:_0x5aeea0,dateFrom:_0x223a89,dateTo:_0x2a64bf,search:_0x469c,currency:_0x5026c2,sortBy:_0x13a868,sortOrder:_0x2e75ec}=_0x1b7fd3,_0x4c2857=(_0x66c3c-0x1)*_0x62e2f;console['log'](_0x47a103(0x291),_0x1b7fd3);const _0x103f1d=await database_1['default'][_0x47a103(0x169)]['groupBy']({'by':[_0x47a103(0x251)],'_count':{'gateway':!![]}});console[_0x47a103(0x1bc)]('üìä\x20Available\x20gateways\x20in\x20database:',_0x103f1d[_0x47a103(0x192)](_0x223da7=>_0x223da7[_0x47a103(0x251)]+'\x20('+_0x223da7[_0x47a103(0x214)][_0x47a103(0x251)]+_0x47a103(0x22c)));if(_0x1da3f0){const _0x12a72e=_0x103f1d[_0x47a103(0x213)](_0x378b3d=>_0x378b3d[_0x47a103(0x251)][_0x47a103(0x1d9)]()===_0x1da3f0[_0x47a103(0x1d9)]());!_0x12a72e&&_0x1da3f0[_0x47a103(0x1d9)]()!==_0x47a103(0x1b2)&&console[_0x47a103(0x1bc)](_0x47a103(0x220)+_0x1da3f0+_0x47a103(0x201)+_0x103f1d[_0x47a103(0x192)](_0x22a2d0=>_0x22a2d0[_0x47a103(0x251)])[_0x47a103(0x200)](',\x20'));}const _0x34e23c={};_0x3fb7ef&&(_0x34e23c[_0x47a103(0x22e)]=_0x3fb7ef[_0x47a103(0x226)]());if(!_0x1da3f0)_0x34e23c[_0x47a103(0x251)]={'not':_0x47a103(0x1b2)};else{if(_0x1da3f0&&(_0x1da3f0[_0x47a103(0x1d9)]()==='test_gateway'||_0x1da3f0===_0x47a103(0x1aa)))_0x34e23c[_0x47a103(0x251)]=_0x47a103(0x1b2);else{let _0x3edfc6=_0x1da3f0;const _0x2f413b=(0x0,gateway_1[_0x47a103(0x250)])(_0x1da3f0);if(_0x2f413b)_0x3edfc6=_0x2f413b,console['log'](_0x47a103(0x16f)+_0x1da3f0+_0x47a103(0x26c)+_0x3edfc6+'\x27');else{const _0x537e0b=(0x0,gateway_1[_0x47a103(0x1f6)])(_0x1da3f0);if(_0x537e0b){const _0x2d0c79=(0x0,gateway_1[_0x47a103(0x250)])(_0x537e0b);_0x2d0c79&&(_0x3edfc6=_0x2d0c79,console[_0x47a103(0x1bc)](_0x47a103(0x171)+_0x1da3f0+_0x47a103(0x228)+_0x537e0b+_0x47a103(0x239)+_0x3edfc6+'\x27'));}else console[_0x47a103(0x1bc)](_0x47a103(0x17d)+_0x1da3f0+'\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)');}const _0x3a2183=await database_1[_0x47a103(0x176)]['payment'][_0x47a103(0x1b6)]({'where':{'gateway':_0x3edfc6['toLowerCase']()},'take':0x1});_0x3a2183===0x0?(console['log'](_0x47a103(0x294)+_0x3edfc6+_0x47a103(0x189)+_0x1da3f0+_0x47a103(0x244)),_0x34e23c[_0x47a103(0x251)]=_0x47a103(0x1ff)):(_0x34e23c[_0x47a103(0x251)]=_0x3edfc6[_0x47a103(0x1d9)](),console[_0x47a103(0x1bc)](_0x47a103(0x20e)+_0x3edfc6+_0x47a103(0x189)+_0x1da3f0+'\x27)'));}}console[_0x47a103(0x1bc)](_0x47a103(0x281),_0x34e23c[_0x47a103(0x251)]);_0x5aeea0&&(_0x34e23c[_0x47a103(0x1f2)]=_0x5aeea0);_0x5026c2&&(_0x34e23c['currency']=_0x5026c2[_0x47a103(0x226)](),console[_0x47a103(0x1bc)](_0x47a103(0x1eb)+_0x5026c2[_0x47a103(0x226)]()));(_0x223a89||_0x2a64bf)&&(_0x34e23c[_0x47a103(0x1c1)]={},_0x223a89&&(_0x34e23c[_0x47a103(0x1c1)][_0x47a103(0x273)]=new Date(_0x223a89)),_0x2a64bf&&(_0x34e23c[_0x47a103(0x1c1)][_0x47a103(0x216)]=new Date(_0x2a64bf)));_0x469c&&(_0x34e23c['OR']=[{'id':{'contains':_0x469c,'mode':_0x47a103(0x232)}},{'orderId':{'contains':_0x469c,'mode':'insensitive'}},{'gatewayOrderId':{'contains':_0x469c,'mode':'insensitive'}},{'customerEmail':{'contains':_0x469c,'mode':'insensitive'}},{'shop':{'name':{'contains':_0x469c,'mode':_0x47a103(0x232)}}},{'shop':{'username':{'contains':_0x469c,'mode':_0x47a103(0x232)}}}]);console[_0x47a103(0x1bc)]('üìä\x20Final\x20WHERE\x20conditions:',JSON['stringify'](_0x34e23c,null,0x2));let _0x33d9ae={'createdAt':'desc'};if(_0x13a868){const _0x265ad8=['amount',_0x47a103(0x1c1),_0x47a103(0x1d5),_0x47a103(0x22e),_0x47a103(0x251),_0x47a103(0x271)],_0x538040=[_0x47a103(0x1c2),'desc'];if(_0x265ad8['includes'](_0x13a868)){const _0x177da1=_0x538040[_0x47a103(0x16a)](_0x2e75ec)?_0x2e75ec:_0x47a103(0x1d8);_0x33d9ae={[_0x13a868]:_0x177da1},console[_0x47a103(0x1bc)](_0x47a103(0x199)+_0x13a868+_0x47a103(0x28b)+_0x177da1+_0x47a103(0x210));}}const [_0x4a0756,_0x4eb1b0]=await Promise[_0x47a103(0x1a4)]([database_1[_0x47a103(0x176)][_0x47a103(0x169)][_0x47a103(0x17c)]({'where':_0x34e23c,'skip':_0x4c2857,'take':_0x62e2f,'orderBy':_0x33d9ae,'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x47a103(0x176)][_0x47a103(0x169)][_0x47a103(0x1b6)]({'where':_0x34e23c})]);return{'payments':_0x4a0756,'pagination':{'page':_0x66c3c,'limit':_0x62e2f,'total':_0x4eb1b0,'totalPages':Math['ceil'](_0x4eb1b0/_0x62e2f)}};}async[a36_0x2cee07(0x209)](_0x32648c){const _0x174718=a36_0x2cee07,_0x5b810b=await database_1[_0x174718(0x176)][_0x174718(0x169)][_0x174718(0x20b)]({'where':{'id':_0x32648c},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x5b810b)return null;return{'id':_0x5b810b['id'],'shopId':_0x5b810b[_0x174718(0x1f2)],'gateway':_0x5b810b[_0x174718(0x251)],'amount':_0x5b810b['amount'],'currency':_0x5b810b[_0x174718(0x271)],'status':_0x5b810b[_0x174718(0x22e)],'orderId':_0x5b810b[_0x174718(0x18c)],'gatewayOrderId':_0x5b810b[_0x174718(0x1d4)],'customerEmail':_0x5b810b[_0x174718(0x1fa)],'customerName':_0x5b810b[_0x174718(0x164)],'customerCountry':_0x5b810b[_0x174718(0x235)],'customerIp':_0x5b810b['customerIp'],'customerUa':_0x5b810b[_0x174718(0x1d6)],'failureMessage':_0x5b810b[_0x174718(0x206)],'externalPaymentUrl':_0x5b810b[_0x174718(0x1a0)],'successUrl':_0x5b810b[_0x174718(0x23b)],'failUrl':_0x5b810b[_0x174718(0x238)],'pendingUrl':_0x5b810b['pendingUrl'],'whiteUrl':_0x5b810b[_0x174718(0x1bb)],'createdAt':_0x5b810b[_0x174718(0x1c1)],'updatedAt':_0x5b810b[_0x174718(0x1d5)],'shop':_0x5b810b[_0x174718(0x1fe)]};}async[a36_0x2cee07(0x215)](_0x2ecce4,_0x56e512,_0x2158c2,_0x4fe022){const _0x2e36d3=a36_0x2cee07,_0x177030=await database_1[_0x2e36d3(0x176)]['$transaction'](async _0x49459d=>{const _0x461fba=_0x2e36d3,_0x4b7deb=await _0x49459d[_0x461fba(0x169)]['findUnique']({'where':{'id':_0x2ecce4},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x4b7deb)throw new Error(_0x461fba(0x211));const _0x2986d2=_0x4b7deb[_0x461fba(0x22e)],_0x723f42=_0x56e512['toUpperCase']();console[_0x461fba(0x1bc)](_0x461fba(0x16e)+_0x2ecce4+'\x20status:\x20'+_0x2986d2+_0x461fba(0x197)+_0x723f42),console[_0x461fba(0x1bc)](_0x461fba(0x1f0)+_0x4b7deb[_0x461fba(0x1fe)][_0x461fba(0x165)]+_0x461fba(0x275));const _0x674888={'status':_0x723f42,'updatedAt':new Date(),'statusChangedBy':_0x461fba(0x21c),'statusChangedAt':new Date()};_0x2158c2&&(_0x674888[_0x461fba(0x18e)]=_0x2158c2);_0x723f42===_0x461fba(0x229)&&_0x4fe022&&(_0x674888[_0x461fba(0x261)]=_0x4fe022);let _0x351bf8=0x0,_0x57de06=_0x4b7deb[_0x461fba(0x1fe)][_0x461fba(0x165)];if(_0x723f42==='PAID'&&_0x2986d2!==_0x461fba(0x20a)){_0x674888[_0x461fba(0x260)]=new Date();const _0x144ed4=await currencyService_1[_0x461fba(0x286)][_0x461fba(0x292)](_0x4b7deb['amount'],_0x4b7deb[_0x461fba(0x271)]);_0x674888[_0x461fba(0x1df)]=_0x144ed4;let _0x44d2cc=0xa;const _0x93d077=await _0x49459d[_0x461fba(0x1fe)][_0x461fba(0x20b)]({'where':{'id':_0x4b7deb[_0x461fba(0x1f2)]},'select':{'gatewaySettings':!![]}});if(_0x93d077?.[_0x461fba(0x28a)])try{const _0x2d5ee6=JSON['parse'](_0x93d077['gatewaySettings']);for(const [_0x2e3bd4,_0x351f9f]of Object[_0x461fba(0x266)](_0x2d5ee6)){if(_0x2e3bd4[_0x461fba(0x1d9)]()===_0x4b7deb['gateway'][_0x461fba(0x1d9)]()){_0x44d2cc=_0x351f9f[_0x461fba(0x298)]||0xa;break;}}}catch(_0x1d37ef){console['error'](_0x461fba(0x21b)+_0x2ecce4+':',_0x1d37ef);}let _0x22f59f;_0x4b7deb[_0x461fba(0x299)]!==null&&_0x4b7deb['amountAfterGatewayCommissionUSDT']!==undefined?(_0x22f59f=_0x4b7deb[_0x461fba(0x299)],console['log'](_0x461fba(0x160)+_0x22f59f[_0x461fba(0x22d)](0x6)+_0x461fba(0x264)+_0x2ecce4)):(_0x22f59f=_0x144ed4*(0x1-_0x44d2cc/0x64),console[_0x461fba(0x1bc)]('üìä\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20'+_0x2ecce4+':\x20'+_0x44d2cc+_0x461fba(0x173)+_0x144ed4[_0x461fba(0x22d)](0x6)+_0x461fba(0x275)),_0x674888[_0x461fba(0x299)]=_0x22f59f),_0x351bf8=_0x22f59f,_0x57de06+=_0x22f59f,console[_0x461fba(0x1bc)](_0x461fba(0x19b)+_0x2ecce4+'\x20became\x20PAID:'),console[_0x461fba(0x1bc)](_0x461fba(0x1fd)+_0x144ed4[_0x461fba(0x22d)](0x6)+'\x20USDT'),console[_0x461fba(0x1bc)](_0x461fba(0x15f)+_0x4b7deb[_0x461fba(0x251)]+_0x461fba(0x24e)+_0x44d2cc+'%'),console['log'](_0x461fba(0x224)+_0x22f59f[_0x461fba(0x22d)](0x6)+_0x461fba(0x289)+_0x44d2cc+_0x461fba(0x185)),console['log'](_0x461fba(0x1b7)+_0x22f59f[_0x461fba(0x22d)](0x6)+_0x461fba(0x275));}else{if(_0x2986d2===_0x461fba(0x20a)&&_0x723f42!==_0x461fba(0x20a)){if(_0x4b7deb[_0x461fba(0x1df)]){let _0xc514bb=0xa;const _0x1c038e=await _0x49459d[_0x461fba(0x1fe)][_0x461fba(0x20b)]({'where':{'id':_0x4b7deb[_0x461fba(0x1f2)]},'select':{'gatewaySettings':!![]}});if(_0x1c038e?.[_0x461fba(0x28a)])try{const _0x4686d2=JSON[_0x461fba(0x184)](_0x1c038e[_0x461fba(0x28a)]);for(const [_0x173a49,_0x44012a]of Object[_0x461fba(0x266)](_0x4686d2)){if(_0x173a49['toLowerCase']()===_0x4b7deb[_0x461fba(0x251)][_0x461fba(0x1d9)]()){_0xc514bb=_0x44012a[_0x461fba(0x298)]||0xa;break;}}}catch(_0x4787de){console[_0x461fba(0x204)]('Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20'+_0x2ecce4+':',_0x4787de);}const _0x1da7ac=_0x4b7deb[_0x461fba(0x1df)]*(0x1-_0xc514bb/0x64);_0x351bf8=-_0x1da7ac,_0x57de06-=_0x1da7ac,_0x674888['amountUSDT']=null,_0x674888[_0x461fba(0x299)]=null,console['log'](_0x461fba(0x19b)+_0x2ecce4+'\x20no\x20longer\x20PAID:'),console[_0x461fba(0x1bc)]('\x20\x20\x20Full\x20amount:\x20'+_0x4b7deb[_0x461fba(0x1df)][_0x461fba(0x22d)](0x6)+_0x461fba(0x275)),console[_0x461fba(0x1bc)]('\x20\x20\x20Gateway:\x20'+_0x4b7deb[_0x461fba(0x251)]+_0x461fba(0x24e)+_0xc514bb+'%'),console[_0x461fba(0x1bc)]('\x20\x20\x20Merchant\x20loses:\x20'+_0x1da7ac['toFixed'](0x6)+'\x20USDT\x20(after\x20'+_0xc514bb+'%\x20commission)'),console[_0x461fba(0x1bc)]('\x20\x20\x20Subtracted\x20from\x20balance:\x20-'+_0x1da7ac['toFixed'](0x6)+'\x20USDT');}}}_0x723f42===_0x461fba(0x229)&&(_0x2986d2===_0x461fba(0x20a)&&_0x4b7deb[_0x461fba(0x1df)]&&console[_0x461fba(0x1bc)](_0x461fba(0x268)),_0x4fe022&&_0x4fe022>0x0&&(_0x351bf8-=_0x4fe022,_0x57de06-=_0x4fe022,console[_0x461fba(0x1bc)](_0x461fba(0x16b)+_0x4fe022[_0x461fba(0x22d)](0x6)+_0x461fba(0x1ee))));_0x723f42===_0x461fba(0x295)&&_0x2986d2===_0x461fba(0x20a)&&console[_0x461fba(0x1bc)](_0x461fba(0x1ad));const _0x59f1d6=await _0x49459d[_0x461fba(0x169)]['update']({'where':{'id':_0x2ecce4},'data':_0x674888,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x351bf8!==0x0&&(await _0x49459d[_0x461fba(0x1fe)][_0x461fba(0x1fb)]({'where':{'id':_0x4b7deb['shopId']},'data':{'balance':_0x57de06}}),console[_0x461fba(0x1bc)](_0x461fba(0x22a)+_0x4b7deb[_0x461fba(0x1f2)]+_0x461fba(0x1ef)+_0x4b7deb[_0x461fba(0x1fe)][_0x461fba(0x165)][_0x461fba(0x22d)](0x6)+_0x461fba(0x197)+_0x57de06[_0x461fba(0x22d)](0x6)+_0x461fba(0x24d)+(_0x351bf8>0x0?'+':'')+_0x351bf8[_0x461fba(0x22d)](0x6)+')')),_0x59f1d6;});return{'id':_0x177030['id'],'shopId':_0x177030[_0x2e36d3(0x1f2)],'gateway':_0x177030[_0x2e36d3(0x251)],'amount':_0x177030[_0x2e36d3(0x1c4)],'currency':_0x177030['currency'],'status':_0x177030[_0x2e36d3(0x22e)],'orderId':_0x177030[_0x2e36d3(0x18c)],'gatewayOrderId':_0x177030['gatewayOrderId'],'customerEmail':_0x177030[_0x2e36d3(0x1fa)],'customerName':_0x177030[_0x2e36d3(0x164)],'customerCountry':_0x177030[_0x2e36d3(0x235)],'customerIp':_0x177030[_0x2e36d3(0x183)],'customerUa':_0x177030[_0x2e36d3(0x1d6)],'failureMessage':_0x177030[_0x2e36d3(0x206)],'adminNotes':_0x177030['adminNotes'],'chargebackAmount':_0x177030['chargebackAmount'],'statusChangedBy':_0x177030[_0x2e36d3(0x1ab)],'statusChangedAt':_0x177030['statusChangedAt'],'createdAt':_0x177030[_0x2e36d3(0x1c1)],'updatedAt':_0x177030['updatedAt'],'shop':_0x177030[_0x2e36d3(0x1fe)]};}async[a36_0x2cee07(0x18d)](_0x1f1497,_0x5c2ace){const _0x3aaf1c=a36_0x2cee07,_0x39f891=Math[_0x3aaf1c(0x20f)]()[_0x3aaf1c(0x1a1)](0x24)['substr'](0x2,0x9);console[_0x3aaf1c(0x1bc)](_0x3aaf1c(0x1cf)+_0x39f891+',\x20userId:\x20'+_0x1f1497);const _0x8c985e={..._0x5c2ace};_0x5c2ace['password']&&_0x5c2ace[_0x3aaf1c(0x26f)][_0x3aaf1c(0x25e)]()!==''?(console['log'](_0x3aaf1c(0x22f)+_0x39f891+_0x3aaf1c(0x274)+_0x1f1497),_0x8c985e[_0x3aaf1c(0x26f)]=await bcryptjs_1[_0x3aaf1c(0x176)][_0x3aaf1c(0x253)](_0x5c2ace[_0x3aaf1c(0x26f)],0xc)):(console[_0x3aaf1c(0x1bc)]('üîê\x20['+_0x39f891+_0x3aaf1c(0x1c7)),delete _0x8c985e[_0x3aaf1c(0x26f)]);_0x5c2ace['fullName']&&(_0x8c985e[_0x3aaf1c(0x162)]=_0x5c2ace[_0x3aaf1c(0x174)],delete _0x8c985e[_0x3aaf1c(0x174)]);_0x5c2ace[_0x3aaf1c(0x23d)]&&(_0x8c985e['telegram']=_0x5c2ace['telegramId'],delete _0x8c985e[_0x3aaf1c(0x23d)]);_0x5c2ace[_0x3aaf1c(0x255)]&&(_0x8c985e['shopUrl']=_0x5c2ace[_0x3aaf1c(0x255)],delete _0x8c985e['merchantUrl']);if(_0x5c2ace[_0x3aaf1c(0x1ae)]){const _0x2dba9c=_0x5c2ace[_0x3aaf1c(0x1ae)][_0x3aaf1c(0x192)](_0xe52a2b=>this['getGatewayInternalName'](_0xe52a2b));console['log'](_0x3aaf1c(0x269),_0x5c2ace[_0x3aaf1c(0x1ae)],'->',_0x2dba9c),_0x8c985e[_0x3aaf1c(0x15d)]=JSON[_0x3aaf1c(0x225)](_0x2dba9c),delete _0x8c985e['gateways'];}_0x5c2ace['gatewaySettings']&&(console['log'](_0x3aaf1c(0x180)+_0x39f891+_0x3aaf1c(0x190),_0x5c2ace[_0x3aaf1c(0x28a)]),_0x8c985e['gatewaySettings']=JSON[_0x3aaf1c(0x225)](_0x5c2ace[_0x3aaf1c(0x28a)]),console[_0x3aaf1c(0x1bc)](_0x3aaf1c(0x180)+_0x39f891+_0x3aaf1c(0x18b),_0x8c985e[_0x3aaf1c(0x28a)]));_0x5c2ace[_0x3aaf1c(0x223)]&&(_0x5c2ace[_0x3aaf1c(0x223)]['usdtPolygonWallet']!==undefined&&(_0x8c985e[_0x3aaf1c(0x19e)]=_0x5c2ace['wallets'][_0x3aaf1c(0x19e)]||null),_0x5c2ace[_0x3aaf1c(0x223)][_0x3aaf1c(0x242)]!==undefined&&(_0x8c985e[_0x3aaf1c(0x242)]=_0x5c2ace[_0x3aaf1c(0x223)][_0x3aaf1c(0x242)]||null),_0x5c2ace[_0x3aaf1c(0x223)][_0x3aaf1c(0x1d1)]!==undefined&&(_0x8c985e[_0x3aaf1c(0x1d1)]=_0x5c2ace[_0x3aaf1c(0x223)][_0x3aaf1c(0x1d1)]||null),_0x5c2ace[_0x3aaf1c(0x223)][_0x3aaf1c(0x1c8)]!==undefined&&(_0x8c985e[_0x3aaf1c(0x1c8)]=_0x5c2ace[_0x3aaf1c(0x223)][_0x3aaf1c(0x1c8)]||null),delete _0x8c985e['wallets']);const _0x26dc4b=await database_1[_0x3aaf1c(0x176)][_0x3aaf1c(0x1fe)][_0x3aaf1c(0x1fb)]({'where':{'id':_0x1f1497},'data':_0x8c985e,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console['log'](_0x3aaf1c(0x1e3)+_0x39f891+_0x3aaf1c(0x1b1),_0x26dc4b['gatewaySettings']),{'id':_0x26dc4b['id'],'fullName':_0x26dc4b[_0x3aaf1c(0x162)],'username':_0x26dc4b[_0x3aaf1c(0x252)],'telegramId':_0x26dc4b[_0x3aaf1c(0x1ea)],'merchantUrl':_0x26dc4b[_0x3aaf1c(0x217)],'gateways':_0x26dc4b[_0x3aaf1c(0x15d)]?JSON[_0x3aaf1c(0x184)](_0x26dc4b[_0x3aaf1c(0x15d)]):null,'gatewaySettings':_0x26dc4b[_0x3aaf1c(0x28a)]?JSON[_0x3aaf1c(0x184)](_0x26dc4b[_0x3aaf1c(0x28a)]):null,'publicKey':_0x26dc4b[_0x3aaf1c(0x293)],'wallets':{'usdtPolygonWallet':_0x26dc4b['usdtPolygonWallet'],'usdtTrcWallet':_0x26dc4b[_0x3aaf1c(0x242)],'usdtErcWallet':_0x26dc4b['usdtErcWallet'],'usdcPolygonWallet':_0x26dc4b['usdcPolygonWallet']},'status':_0x26dc4b[_0x3aaf1c(0x22e)],'createdAt':_0x26dc4b[_0x3aaf1c(0x1c1)]};}async[a36_0x2cee07(0x1bf)](_0x5d68f8){const _0x15ad48=a36_0x2cee07,_0x208604=await database_1['default'][_0x15ad48(0x1fe)]['update']({'where':{'id':_0x5d68f8},'data':{'status':'SUSPENDED'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x208604['id'],'fullName':_0x208604['name'],'username':_0x208604[_0x15ad48(0x252)],'telegramId':_0x208604[_0x15ad48(0x1ea)],'merchantUrl':_0x208604['shopUrl'],'gateways':_0x208604['paymentGateways']?JSON[_0x15ad48(0x184)](_0x208604['paymentGateways']):null,'gatewaySettings':_0x208604[_0x15ad48(0x28a)]?JSON[_0x15ad48(0x184)](_0x208604[_0x15ad48(0x28a)]):null,'publicKey':_0x208604[_0x15ad48(0x293)],'wallets':{'usdtPolygonWallet':_0x208604[_0x15ad48(0x19e)],'usdtTrcWallet':_0x208604['usdtTrcWallet'],'usdtErcWallet':_0x208604[_0x15ad48(0x1d1)],'usdcPolygonWallet':_0x208604[_0x15ad48(0x1c8)]},'status':_0x208604[_0x15ad48(0x22e)],'createdAt':_0x208604[_0x15ad48(0x1c1)]};}async['activateUser'](_0x4e9041){const _0x313e69=a36_0x2cee07,_0x1228d3=await database_1[_0x313e69(0x176)][_0x313e69(0x1fe)]['update']({'where':{'id':_0x4e9041},'data':{'status':_0x313e69(0x1ec)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x1228d3['id'],'fullName':_0x1228d3['name'],'username':_0x1228d3['username'],'telegramId':_0x1228d3[_0x313e69(0x1ea)],'merchantUrl':_0x1228d3[_0x313e69(0x217)],'gateways':_0x1228d3['paymentGateways']?JSON[_0x313e69(0x184)](_0x1228d3[_0x313e69(0x15d)]):null,'gatewaySettings':_0x1228d3[_0x313e69(0x28a)]?JSON[_0x313e69(0x184)](_0x1228d3[_0x313e69(0x28a)]):null,'publicKey':_0x1228d3[_0x313e69(0x293)],'wallets':{'usdtPolygonWallet':_0x1228d3['usdtPolygonWallet'],'usdtTrcWallet':_0x1228d3['usdtTrcWallet'],'usdtErcWallet':_0x1228d3[_0x313e69(0x1d1)],'usdcPolygonWallet':_0x1228d3[_0x313e69(0x1c8)]},'status':_0x1228d3[_0x313e69(0x22e)],'createdAt':_0x1228d3[_0x313e69(0x1c1)]};}async[a36_0x2cee07(0x23c)](_0xe6f581){const _0x277715=a36_0x2cee07,{page:_0xed7ca2,limit:_0x5313eb,status:_0xc061f4}=_0xe6f581,_0x45a3b7=(_0xed7ca2-0x1)*_0x5313eb,_0x4a42c4={};_0xc061f4&&(_0x4a42c4[_0x277715(0x22e)]=_0xc061f4[_0x277715(0x226)]());const [_0x4f42bb,_0x258aef]=await Promise[_0x277715(0x1a4)]([database_1[_0x277715(0x176)][_0x277715(0x1fe)]['findMany']({'where':_0x4a42c4,'skip':_0x45a3b7,'take':_0x5313eb,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x277715(0x176)]['shop'][_0x277715(0x1b6)]({'where':_0x4a42c4})]);return{'users':_0x4f42bb[_0x277715(0x192)](_0x586d3a=>{const _0x3ddd26=_0x277715,_0x129d93=_0x586d3a[_0x3ddd26(0x15d)]?JSON[_0x3ddd26(0x184)](_0x586d3a[_0x3ddd26(0x15d)]):null,_0x5e1762=_0x129d93?_0x129d93['map'](_0x1a8966=>this[_0x3ddd26(0x1a2)](_0x1a8966)):null;return{'id':_0x586d3a['id'],'fullName':_0x586d3a[_0x3ddd26(0x162)],'username':_0x586d3a[_0x3ddd26(0x252)],'telegramId':_0x586d3a[_0x3ddd26(0x1ea)],'merchantUrl':_0x586d3a['shopUrl'],'gateways':_0x5e1762,'gatewaySettings':_0x586d3a[_0x3ddd26(0x28a)]?JSON[_0x3ddd26(0x184)](_0x586d3a[_0x3ddd26(0x28a)]):null,'publicKey':_0x586d3a['publicKey'],'wallets':{'usdtPolygonWallet':_0x586d3a[_0x3ddd26(0x19e)],'usdtTrcWallet':_0x586d3a['usdtTrcWallet'],'usdtErcWallet':_0x586d3a[_0x3ddd26(0x1d1)],'usdcPolygonWallet':_0x586d3a[_0x3ddd26(0x1c8)]},'status':_0x586d3a[_0x3ddd26(0x22e)],'createdAt':_0x586d3a[_0x3ddd26(0x1c1)]};}),'pagination':{'page':_0xed7ca2,'limit':_0x5313eb,'total':_0x258aef,'totalPages':Math[_0x277715(0x1a7)](_0x258aef/_0x5313eb)}};}async[a36_0x2cee07(0x26a)](_0x33ca7a){const _0x58e48d=a36_0x2cee07,_0x2d4269=await database_1['default'][_0x58e48d(0x1fe)]['findUnique']({'where':{'id':_0x33ca7a},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x2d4269)return null;const _0x5029f4=_0x2d4269[_0x58e48d(0x15d)]?JSON[_0x58e48d(0x184)](_0x2d4269[_0x58e48d(0x15d)]):null,_0x6f159c=_0x5029f4?_0x5029f4[_0x58e48d(0x192)](_0x4f6ece=>this[_0x58e48d(0x1a2)](_0x4f6ece)):null;return _0x5029f4&&_0x6f159c&&console[_0x58e48d(0x1bc)](_0x58e48d(0x19d),_0x5029f4,'->',_0x6f159c),{'id':_0x2d4269['id'],'fullName':_0x2d4269[_0x58e48d(0x162)],'username':_0x2d4269['username'],'telegramId':_0x2d4269[_0x58e48d(0x1ea)],'merchantUrl':_0x2d4269['shopUrl'],'gateways':_0x6f159c,'gatewaySettings':_0x2d4269[_0x58e48d(0x28a)]?JSON['parse'](_0x2d4269[_0x58e48d(0x28a)]):null,'publicKey':_0x2d4269[_0x58e48d(0x293)],'wallets':{'usdtPolygonWallet':_0x2d4269[_0x58e48d(0x19e)],'usdtTrcWallet':_0x2d4269[_0x58e48d(0x242)],'usdtErcWallet':_0x2d4269['usdtErcWallet'],'usdcPolygonWallet':_0x2d4269[_0x58e48d(0x1c8)]},'status':_0x2d4269[_0x58e48d(0x22e)],'createdAt':_0x2d4269['createdAt']};}async['createUser'](_0x597f47){const _0x176f1c=a36_0x2cee07,{fullName:_0x2496ba,username:_0x1e04ac,password:_0x52eb78,telegramId:_0x2cf4fa,merchantUrl:_0x227aa3,gateways:_0x1c5858,gatewaySettings:_0x22eacf,wallets:_0x458ec2}=_0x597f47,_0x3b4092=await database_1[_0x176f1c(0x176)][_0x176f1c(0x1fe)][_0x176f1c(0x20b)]({'where':{'username':_0x1e04ac}});if(_0x3b4092)throw new Error('Username\x20already\x20exists');if(_0x2cf4fa){const _0x24b081=await database_1[_0x176f1c(0x176)][_0x176f1c(0x1fe)][_0x176f1c(0x20b)]({'where':{'telegram':_0x2cf4fa}});if(_0x24b081)throw new Error('Telegram\x20username\x20already\x20exists');}const _0x20b6aa=await bcryptjs_1['default'][_0x176f1c(0x253)](_0x52eb78,0xc),_0x5291c5=_0x176f1c(0x1f5)+crypto_1[_0x176f1c(0x176)][_0x176f1c(0x237)](0x20)[_0x176f1c(0x1a1)]('hex'),_0x3b0fbe='sk_'+crypto_1[_0x176f1c(0x176)]['randomBytes'](0x20)[_0x176f1c(0x1a1)](_0x176f1c(0x247)),_0x487e59=_0x1c5858?_0x1c5858[_0x176f1c(0x192)](_0x4e3cb6=>this[_0x176f1c(0x1b9)](_0x4e3cb6)):null;_0x1c5858&&_0x487e59&&console[_0x176f1c(0x1bc)]('üîÑ\x20Gateway\x20mapping\x20(create):',_0x1c5858,'->',_0x487e59);const _0x1461cd=await database_1[_0x176f1c(0x176)][_0x176f1c(0x1fe)][_0x176f1c(0x1d2)]({'data':{'name':_0x2496ba,'username':_0x1e04ac,'password':_0x20b6aa,'telegram':_0x2cf4fa,'shopUrl':_0x227aa3,'paymentGateways':_0x487e59?JSON['stringify'](_0x487e59):null,'gatewaySettings':_0x22eacf?JSON[_0x176f1c(0x225)](_0x22eacf):null,'usdtPolygonWallet':_0x458ec2?.[_0x176f1c(0x19e)]||null,'usdtTrcWallet':_0x458ec2?.[_0x176f1c(0x242)]||null,'usdtErcWallet':_0x458ec2?.[_0x176f1c(0x1d1)]||null,'usdcPolygonWallet':_0x458ec2?.[_0x176f1c(0x1c8)]||null,'publicKey':_0x5291c5,'secretKey':_0x3b0fbe,'status':_0x176f1c(0x1ec)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x1461cd['id'],'fullName':_0x1461cd[_0x176f1c(0x162)],'username':_0x1461cd[_0x176f1c(0x252)],'telegramId':_0x1461cd[_0x176f1c(0x1ea)],'merchantUrl':_0x1461cd[_0x176f1c(0x217)],'gateways':_0x1461cd[_0x176f1c(0x15d)]?JSON['parse'](_0x1461cd[_0x176f1c(0x15d)]):null,'gatewaySettings':_0x1461cd['gatewaySettings']?JSON[_0x176f1c(0x184)](_0x1461cd[_0x176f1c(0x28a)]):null,'publicKey':_0x1461cd[_0x176f1c(0x293)],'wallets':{'usdtPolygonWallet':_0x1461cd['usdtPolygonWallet'],'usdtTrcWallet':_0x1461cd['usdtTrcWallet'],'usdtErcWallet':_0x1461cd['usdtErcWallet'],'usdcPolygonWallet':_0x1461cd[_0x176f1c(0x1c8)]},'status':_0x1461cd[_0x176f1c(0x22e)],'createdAt':_0x1461cd[_0x176f1c(0x1c1)]};}async[a36_0x2cee07(0x282)](_0x4fbdc3){const _0x147f44=a36_0x2cee07;await database_1[_0x147f44(0x176)]['shop'][_0x147f44(0x290)]({'where':{'id':_0x4fbdc3}});}[a36_0x2cee07(0x178)](_0x5e8e80,_0x2c64ca,_0x2e5b66){const _0x43874b=a36_0x2cee07,_0x42d1a0=new Map(),_0x44d152=new Date(_0x2c64ca);while(_0x44d152<=_0x2e5b66){const _0x435b9c=_0x44d152[_0x43874b(0x21f)]()[_0x43874b(0x234)]('T')[0x0];_0x42d1a0[_0x43874b(0x231)](_0x435b9c,{'revenue':0x0,'count':0x0}),_0x44d152[_0x43874b(0x1db)](_0x44d152[_0x43874b(0x1b8)]()+0x1);}for(const _0x435ff0 of _0x5e8e80){const _0x392fb7=_0x435ff0[_0x43874b(0x1c1)][_0x43874b(0x21f)]()[_0x43874b(0x234)]('T')[0x0],_0x358cb1=_0x42d1a0[_0x43874b(0x17a)](_0x392fb7);_0x358cb1&&(_0x358cb1[_0x43874b(0x1b6)]+=0x1,_0x435ff0[_0x43874b(0x22e)]===_0x43874b(0x20a)&&(_0x435ff0['amountUSDT']?_0x358cb1[_0x43874b(0x221)]+=_0x435ff0['amountUSDT']:console[_0x43874b(0x1bc)]('‚ö†Ô∏è\x20Payment\x20'+_0x435ff0['id']+_0x43874b(0x212))));}const _0xd0c3a2=[],_0x3bdab7=[];for(const [_0x182bad,_0x3847df]of _0x42d1a0){_0xd0c3a2[_0x43874b(0x28d)]({'date':_0x182bad,'amount':Math[_0x43874b(0x188)](_0x3847df[_0x43874b(0x221)]*0x64)/0x64}),_0x3bdab7['push']({'date':_0x182bad,'count':_0x3847df[_0x43874b(0x1b6)]});}return{'dailyRevenue':_0xd0c3a2,'dailyPayments':_0x3bdab7};}}exports[a36_0x2cee07(0x17f)]=AdminService;