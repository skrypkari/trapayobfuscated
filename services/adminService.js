'use strict';const a48_0x50653f=a48_0x5030;function a48_0x5030(_0x23fb44,_0x494deb){_0x23fb44=_0x23fb44-0xea;const _0x56147f=a48_0x5614();let _0x503022=_0x56147f[_0x23fb44];return _0x503022;}(function(_0x5bb3ba,_0x5b9c37){const _0x3202f5=a48_0x5030,_0x406a5e=_0x5bb3ba();while(!![]){try{const _0x1bd647=parseInt(_0x3202f5(0x260))/0x1*(-parseInt(_0x3202f5(0x140))/0x2)+parseInt(_0x3202f5(0xf4))/0x3+parseInt(_0x3202f5(0x1d6))/0x4*(-parseInt(_0x3202f5(0x155))/0x5)+parseInt(_0x3202f5(0x162))/0x6*(parseInt(_0x3202f5(0x12e))/0x7)+-parseInt(_0x3202f5(0x1f0))/0x8+-parseInt(_0x3202f5(0x1a0))/0x9+parseInt(_0x3202f5(0x138))/0xa*(parseInt(_0x3202f5(0xfa))/0xb);if(_0x1bd647===_0x5b9c37)break;else _0x406a5e['push'](_0x406a5e['shift']());}catch(_0x1a174c){_0x406a5e['push'](_0x406a5e['shift']());}}}(a48_0x5614,0xe36cd));function a48_0x5614(){const _0x1e5fef=['15356fbfwgf','password','paidAt','getUTCDate','not\x20set','payment','ðŸ”\x202FA\x20disabled\x20for\x20shop:\x20','paymentsCount','ceil','lastMonth','hex','2020-01-01','pendingUrl','\x20USDT\x20-\x20will\x20deduct\x20from\x20balance','\x20\x20\x20âœ…\x20Actual\x20available\x20balance:\x20','\x27\x20->\x20name\x20\x27','\x20backup\x20codes','ðŸ“Š\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','dateTo','revenue','averageCheckUSDT','setDate','createUser','ðŸ“Š\x20Merchant\x20statistics\x20calculated:','./currencyService','Insufficient\x20balance\x20for\x20amount\x20increase.\x20Available:\x20','\x20\x20\x20ðŸ‘¤\x20Merchant\x20earnings:\x20','\x20USDT\x20(-','totalAmountAfterCommissionUSDT','2FA\x20is\x20already\x20enabled','\x20balance\x20updated:\x20','gatewayCommissionRate','ðŸ“Š\x20Statistics\x20date\x20range:\x20','âœ…\x20Customer\x20data\x20updated\x20for\x20payment\x20','getPayoutStats','EXPIRED','deleteUser','\x20merchants\x20for\x20selection','startsWith','this_month','disable2FA','slice','date',',\x20chargebacks:\x20','totalPayout','gte',':\x20commission\x20=\x20','2FA\x20not\x20set\x20up.\x20Please\x20call\x20setup\x20endpoint\x20first','split','amountAfterCommissionUSDT','turnover','Noda','53886KWfZvY','âœ…\x20Payout\x20created\x20in\x20DB:','ðŸ”„\x20Admin\x20updating\x20payment\x20','twoFactorSecret','Test\x20Gateway','../types/gateway','join','twoFactorEnabled','random','\x20USDT\x20(+','23510HXIRhY','getUTCDay',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','merchantUrl','admin','some','dateFrom','getGatewayIdByName','3496RzMmDI','%\x20commission)','\x20USDT\x20from\x20balance','log','trc20','error','gatewaySettings','customerEmail','klyme_de','round','\x20PAID\x20payments','\x20merchants\x20with\x20rounded\x20balance\x20!=\x200.00\x20(excluding\x20balances\x20that\x20round\x20to\x200.00)','\x27\x20(from\x20\x27','base32','TrapaPay','today','ðŸ“Š\x20Calculating\x20payout\x20statistics...','\x20\x20\x20Total\x20paid\x20out:\x20','âœ…\x20Payout\x20','customerIp','\x20\x20\x20Gateway:\x20','37795yRUiMa','availableBalance','amountAfterGatewayCommissionUSDT','map','custom_','Username\x20already\x20exists','cointopay','\x20to\x20','otpauth_url','klyme_eu','KLYME\x20EU','REFUND','ðŸ“…\x20Date\x20from\x20filter:\x20','1176mDMMHj','averageCommissionRate','abs','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','\x20with\x20payout\x20history','\x20USDT,\x20Required:\x20','\x20\x20\x20Transaction\x20hash:\x20','payout','qrcode','getTime','\x20\x20\x20Full\x20amount:\x20','Open\x20Banking\x202','ðŸ”„\x20Updating\x20customer\x20data\x20for\x20payment\x20','erc20_usdc','getAllUsers','currencyService','getDate','updatedAt','amount','getAllPayments','\x20\x20\x20ðŸ–¥ï¸\x20User\x20Agent:\x20','\x20USDT,\x20Requested:\x20','not\x20provided','%\x20from\x20','toFixed','commission','get','Invalid\x202FA\x20token','filter','usdtPolygonWallet','setUTCDate','length','ðŸ’±\x20Currency\x20filter\x20applied:\x20','count','mastercard','customerCountry','CHARGEBACK','whiteUrl','name','failUrl','stringify','ðŸ”\x202FA\x20setup\x20initiated\x20for\x20shop:\x20','\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)','ðŸ’¸\x20CHARGEBACK:\x20Processing\x20penalty-only\x20deduction','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','ðŸ’°\x20Found\x20','forEach','\x20\x20\x20Current\x20balance:\x20','ðŸ“Š\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','ðŸ”\x20Total\x20payments\x20matching\x20filters:\x20','asc','usdtTrcWallet','NONEXISTENT_GATEWAY_FILTER','successUrl','custom','customerUa','getGatewayNameById','getFullYear','\x20in\x20','ðŸŽ¯\x20[','shop','getGatewayDisplayName','8724924ZrrVeu','\x20\x20\x20Current\x20network:\x20','wallets','\x20-\x20','generateDailyStatistics','\x20USDT\x20(same\x20as\x20awaiting)','\x20\x20\x20ðŸ’¸\x20Total\x20payouts\x20(all\x20time):\x20','ðŸ’°\x20[PAYOUT]\x20Gateway\x20','\x20USDT\x20(','\x20\x20\x20Amount\x20increased\x20by\x20','ðŸ”\x20Selected\x20trc20\x20wallet:\x20','Telegram\x20username\x20already\x20exists','statusChangedAt','ðŸ”\x20Balance\x20check\x20details:','gateway','ðŸ“Š\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','__esModule','toLocaleDateString','\x20USDT\x20(current\x20balance\x20in\x20DB)','âœ…\x20Using\x20wallet\x20from\x20request:\x20','paidOutUSDT','\x20USDT\x20(after\x20','push','ðŸ“…\x20Date\x20to\x20filter:\x20','merchantEarnings','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','toLowerCase','ACTIVE','ðŸ“Š\x20Sorting\x20payments\x20by\x20','commissionUSDT','insensitive','ðŸ“Š\x20Using\x20saved\x20values\x20for\x20payment\x20','ðŸ’°\x20[PAYOUT]\x20Merchant\x20','Payment\x20not\x20found','reduce','_sum','Insufficient\x20balance.\x20Available:\x20','toUpperCase','\x20\x20\x20ðŸ¤”\x20Difference:\x20','\x20USDT\x20for\x20payment\x20','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','periodTo','usdcPolygonWallet','\x20USDT\x20(rounded\x20to\x202\x20decimal\x20places)','desc','last_week','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','failureMessage','PAID','min','ðŸ“Š\x20Statistics\x20PAID\x20payments\x20count:\x20','getPaymentById','COMPLETED','period','808WyPrcz','getUserById','ðŸ”\x20Selected\x20erc20\x20wallet:\x20','\x20\x20\x20ðŸ’°\x20Total\x20payments\x20turnover:\x20','âŒ\x20Failed\x20to\x20send\x20Telegram\x20notification\x20for\x20payout\x20','getAllPayouts','ðŸ’°\x20Payment\x20amount\x20is\x20NOT\x20deducted\x20(chargeback\x20penalty\x20only)','\x20\x20\x20Final\x20payout\x20amount\x20used:\x20','ðŸ’°\x20Current\x20shop\x20balance:\x20','./telegramBotService','localeCompare','totp','gatewayEarnings','KLYME\x20DE','getMerchantsSelection','hash','\x20\x20\x20ï¿½\x20Total\x20payments\x20turnover:\x20','toDataURL','\x20\x20\x20Available\x20(number):\x20','\x20USDT\x20(total\x20paid\x20to\x20merchants)','\x20USDT)','customerName','notes','erc20','_count','$transaction','10461160qnaUNr','totalPaidOut','findMany','getPayoutById','amountUSDT','verify','sort','\x20USDT\x20-\x20will\x20return\x20to\x20balance','entries','\x20\x20\x20âœ…\x20Total\x20net\x20balances:\x20','ðŸ“…\x20Payout\x20date\x20to\x20filter:\x20','USDT','getSystemStatistics','Error\x20processing\x20payment\x20','createdAt','\x20\x20\x20Current\x20amount:\x20','ðŸ“Š\x20Statistics\x20WHERE\x20conditions:','ðŸ“Š\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','network','shopUrl','\x20USDT','\x20\x20\x20Merchant\x20gets:\x20','\x20\x20\x20New\x20amount:\x20','\x20payments)','orderId','polygon','publicKey','getMonth','txid','create','values','UTC','payouts','ðŸ“Š\x20Getting\x20payments\x20with\x20filters:','telegramId','\x20USDT\x20(already\x20paid\x20out)','ðŸ”\x20Selected\x20erc20_usdc\x20wallet:\x20','telegram','getMerchantsAwaitingPayout','ðŸ“Š\x20Total\x20payments\x20(including\x20failed):\x20','suspendUser','randomBytes','getUTCMonth','username','all_time','default','getGatewayInternalName','\x20USDT,\x20merchant:\x20','gateways','pendingPayout','toISOString','\x20\x20\x20Shop\x20balance:\x20','\x20\x20\x20ðŸ’³\x20Total\x20payments:\x20','ðŸ”„\x20Gateway\x20mapping:','enable2FA','deletePayout','floor','setHours','groupBy','ðŸ”\x202FA\x20enabled\x20for\x20shop:\x20',',\x20Commission:\x20','update','paymentGateways','âš ï¸\x20Payment\x20','getMerchantStatistics','awaitingPayout','merchantEarningsUSDT','0000','month','\x20\x20\x20â³\x20Pending\x20payout:\x20','chargebackAmount','ðŸ’°\x20Updating\x20payout\x20','ðŸ”„\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','\x20\x20\x20Available\x20(raw):\x20','\x20USDT\x20(gross\x20revenue)','getShopWallets','getUTCFullYear','Plisio','ðŸ“Š\x20Final\x20WHERE\x20conditions:','ðŸ“‹\x20Getting\x20merchants\x20selection\x20list...','this_week','AdminService','KLYME\x20GB','ðŸ”\x20Creating\x20payout\x20with\x20data:','not\x20specified','trim','\x20order','sendPayoutNotification','status','updateUser','ðŸ”\x20No\x20wallet\x20provided,\x20looking\x20up\x20from\x20shop\x20settings...','convertToUSDT','PENDING','week','warn','generateBackupCodes','totalCommissionRate','parse','ðŸ“Š\x20Available\x20gateways\x20in\x20database:','totalPayments','plisio','\x27\x20->\x20ID\x20\x27','ðŸ“Š\x20Gateway\x20filter\x20applied:','usdcErcWallet','ðŸ”\x20Initial\x20wallet\x20from\x20request:\x20','\x20\x20\x20ðŸ“…\x20Total\x20payouts\x20(this\x20month):\x20','ðŸ’°\x20Shop\x20','\x20\x20\x20Requested\x20(number):\x20','ðŸ”\x20[','substr','\x20USDT\x20(theoretical\x20net)','totalTurnover','588pEegZy','currency','ðŸ”„\x20Gateway\x20mapping\x20(create):','\x20\x20\x20â³\x20Awaiting\x20payout:\x20','\x20\x20\x20Added\x20to\x20balance:\x20+','set','ðŸ“Š\x20Calculated\x20commission\x20rate\x20for\x20payment\x20','ðŸ”\x20Using\x20gateway\x20\x27','ðŸ“±\x20Telegram\x20notification\x20sent\x20for\x20payout\x20','includes','âœ…\x20Using\x20gateway\x20filter:\x20\x27','generateSecret','âš ï¸\x20Requested\x20gateway\x20\x27','wallet','usdtErcWallet','CoinToPay','\x20\x20\x20Amount\x20decreased\x20by\x20','\x20\x20\x20ðŸ’°\x20Total\x20payout:\x20','noda','\x20\x20\x20ðŸŒ\x20Country:\x20','ðŸ“Š\x20Payout\x20statistics\x20calculated:','shopId','ðŸ”\x20Selected\x20polygon\x20wallet:\x20','toString','rapyd','aggregate','\x20->\x20','test_gateway','\x20for\x20shop\x20','setup2FA','MasterCard','turnoverUSDT','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','all','\x20\x20\x20ðŸŒ\x20IP:\x20','updateCustomerData','Shop\x20not\x20found','ðŸ’³\x20Final\x20payout\x20wallet\x20for\x20','replace','delete','fullName','\x20\x20\x20Payout\x20amount:\x20','\x20\x20\x20Shop\x20totalPaidOut:\x20','lte','year','updatePayout','\x27\x20to\x20name\x20\x27','periodFrom',',\x20userId:\x20','sk_','ðŸ”„\x20Gateway\x20mapping\x20(get):','2917656LKxjsC','\x20status:\x20','balance','gatewayOrderId','findUnique','thisMonth'];a48_0x5614=function(){return _0x1e5fef;};return a48_0x5614();}var __importDefault=this&&this['__importDefault']||function(_0x589c0e){const _0x444310=a48_0x5030;return _0x589c0e&&_0x589c0e[_0x444310(0x1b0)]?_0x589c0e:{'default':_0x589c0e};};Object['defineProperty'](exports,a48_0x50653f(0x1b0),{'value':!![]}),exports[a48_0x50653f(0x241)]=void 0x0;const database_1=__importDefault(require('../config/database')),bcryptjs_1=__importDefault(require('bcryptjs')),crypto_1=__importDefault(require('crypto')),speakeasy_1=__importDefault(require('speakeasy')),qrcode_1=__importDefault(require(a48_0x50653f(0x16a))),currencyService_1=require(a48_0x50653f(0x112)),telegramBotService_1=require(a48_0x50653f(0x1df)),gateway_1=require(a48_0x50653f(0x133));class AdminService{async[a48_0x50653f(0x11c)](){const _0x4730dc=a48_0x50653f;console[_0x4730dc(0x143)](_0x4730dc(0x150));const _0x2302c8=await database_1['default']['shop'][_0x4730dc(0x279)]({'_sum':{'balance':!![],'totalPaidOut':!![]}}),_0x1e2ef7=await database_1[_0x4730dc(0x21d)][_0x4730dc(0xff)][_0x4730dc(0x183)]({'where':{'status':_0x4730dc(0x1d0),'gateway':{'not':'test_gateway'}}}),_0xc9d0e9=new Date(),_0x469bcb=new Date(_0xc9d0e9[_0x4730dc(0x19b)](),_0xc9d0e9['getMonth'](),0x1),_0x2c3081=new Date(_0xc9d0e9[_0x4730dc(0x19b)](),_0xc9d0e9[_0x4730dc(0x20b)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x4784d3=await database_1['default'][_0x4730dc(0x169)][_0x4730dc(0x279)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x469bcb,'lte':_0x2c3081},'status':_0x4730dc(0x1d4)}}),_0x2be8ca=_0x2302c8[_0x4730dc(0x1c3)][_0x4730dc(0x1f1)]||0x0,_0x5b39f7=_0x2302c8[_0x4730dc(0x1c3)][_0x4730dc(0xf6)]||0x0,_0x384475=_0x4784d3['_sum'][_0x4730dc(0x174)]||0x0,_0x17c0f1={'totalPayout':Math[_0x4730dc(0x149)](_0x2be8ca*0x64)/0x64,'awaitingPayout':Math[_0x4730dc(0x149)](_0x5b39f7*0x64)/0x64,'thisMonth':Math['round'](_0x384475*0x64)/0x64,'availableBalance':Math[_0x4730dc(0x149)](_0x5b39f7*0x64)/0x64,'totalPayments':_0x1e2ef7};return console[_0x4730dc(0x143)](_0x4730dc(0x274)),console[_0x4730dc(0x143)](_0x4730dc(0x271)+_0x17c0f1[_0x4730dc(0x126)]+_0x4730dc(0x1e9)),console[_0x4730dc(0x143)](_0x4730dc(0x263)+_0x17c0f1[_0x4730dc(0x231)]+'\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)'),console[_0x4730dc(0x143)]('\x20\x20\x20ðŸ’µ\x20Available\x20balance:\x20'+_0x17c0f1[_0x4730dc(0x156)]+_0x4730dc(0x1a5)),console[_0x4730dc(0x143)]('\x20\x20\x20ðŸ“…\x20This\x20month:\x20'+_0x17c0f1[_0x4730dc(0xf9)]+_0x4730dc(0x204)),console[_0x4730dc(0x143)](_0x4730dc(0x224)+_0x17c0f1['totalPayments']+_0x4730dc(0x14a)),_0x17c0f1;}async[a48_0x50653f(0x283)](_0x5bc945,_0x4d55f8){const _0x580a9d=a48_0x50653f;console[_0x580a9d(0x143)](_0x580a9d(0x16e)+_0x5bc945+':',_0x4d55f8);const _0x431a3e=await database_1[_0x580a9d(0x21d)][_0x580a9d(0xff)][_0x580a9d(0xf8)]({'where':{'id':_0x5bc945},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x431a3e)throw new Error('Payment\x20not\x20found');const _0x1dd5f9={};_0x4d55f8['customerCountry']!==undefined&&(_0x1dd5f9[_0x580a9d(0x185)]=_0x4d55f8[_0x580a9d(0x185)]||null);_0x4d55f8[_0x580a9d(0x153)]!==undefined&&(_0x1dd5f9[_0x580a9d(0x153)]=_0x4d55f8[_0x580a9d(0x153)]||null);_0x4d55f8[_0x580a9d(0x199)]!==undefined&&(_0x1dd5f9['customerUa']=_0x4d55f8[_0x580a9d(0x199)]||null);const _0x5cfb6d=await database_1[_0x580a9d(0x21d)][_0x580a9d(0xff)]['update']({'where':{'id':_0x5bc945},'data':{..._0x1dd5f9,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x580a9d(0x143)](_0x580a9d(0x11b)+_0x5bc945),console['log'](_0x580a9d(0x273)+_0x431a3e['customerCountry']+'\x20->\x20'+_0x5cfb6d[_0x580a9d(0x185)]),console[_0x580a9d(0x143)](_0x580a9d(0x282)+_0x431a3e[_0x580a9d(0x153)]+'\x20->\x20'+_0x5cfb6d[_0x580a9d(0x153)]),console[_0x580a9d(0x143)](_0x580a9d(0x176)+(_0x431a3e[_0x580a9d(0x199)]?_0x580a9d(0x265):'not\x20set')+_0x580a9d(0x27a)+(_0x5cfb6d[_0x580a9d(0x199)]?_0x580a9d(0x265):_0x580a9d(0xfe))),_0x5cfb6d;}async[a48_0x50653f(0x1fc)](_0x425e69,_0x575454){const _0x24c751=a48_0x50653f,_0xa14993=_0x575454?new Date(_0x575454):new Date();let _0x531ca7,_0x5a2f81;if(_0x425e69[_0x24c751(0x120)](_0x24c751(0x159))){const _0x597abb=_0x425e69[_0x24c751(0x286)]('custom_','')[_0x24c751(0x12a)]('_');if(_0x597abb['length']===0x2){const _0x30ad39=new Date(_0x597abb[0x0]),_0x49645f=new Date(_0x597abb[0x1]);_0x531ca7=new Date(Date[_0x24c751(0x20f)](_0x30ad39[_0x24c751(0x23c)](),_0x30ad39[_0x24c751(0x21a)](),_0x30ad39[_0x24c751(0xfd)](),0x0,0x0,0x0,0x0)),_0x5a2f81=new Date(Date[_0x24c751(0x20f)](_0x49645f[_0x24c751(0x23c)](),_0x49645f[_0x24c751(0x21a)](),_0x49645f[_0x24c751(0xfd)](),0x17,0x3b,0x3b,0x3e7));}else{const _0x7beb83=new Date(Date[_0x24c751(0x20f)](_0xa14993[_0x24c751(0x23c)](),_0xa14993['getUTCMonth'](),_0xa14993[_0x24c751(0xfd)]()-0x1e));_0x531ca7=new Date(Date[_0x24c751(0x20f)](_0x7beb83['getUTCFullYear'](),_0x7beb83[_0x24c751(0x21a)](),_0x7beb83[_0x24c751(0xfd)](),0x0,0x0,0x0,0x0)),_0x5a2f81=new Date(Date[_0x24c751(0x20f)](_0xa14993[_0x24c751(0x23c)](),_0xa14993[_0x24c751(0x21a)](),_0xa14993[_0x24c751(0xfd)](),0x17,0x3b,0x3b,0x3e7));}}else{switch(_0x425e69[_0x24c751(0x1ba)]()){case _0x24c751(0x14f):_0x531ca7=new Date(Date[_0x24c751(0x20f)](_0xa14993[_0x24c751(0x23c)](),_0xa14993['getUTCMonth'](),_0xa14993[_0x24c751(0xfd)](),0x0,0x0,0x0,0x0)),_0x5a2f81=new Date(Date[_0x24c751(0x20f)](_0xa14993[_0x24c751(0x23c)](),_0xa14993['getUTCMonth'](),_0xa14993['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case'yesterday':const _0x20500d=new Date(_0xa14993);_0x20500d[_0x24c751(0x180)](_0x20500d[_0x24c751(0xfd)]()-0x1),_0x531ca7=new Date(Date[_0x24c751(0x20f)](_0x20500d['getUTCFullYear'](),_0x20500d['getUTCMonth'](),_0x20500d['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x5a2f81=new Date(Date[_0x24c751(0x20f)](_0x20500d['getUTCFullYear'](),_0x20500d[_0x24c751(0x21a)](),_0x20500d['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case _0x24c751(0x240):const _0x10c34d=_0xa14993[_0x24c751(0x139)](),_0x406e96=_0x10c34d===0x0?-0x6:0x1-_0x10c34d,_0x7f228a=_0xa14993[_0x24c751(0xfd)]()+_0x406e96;_0x531ca7=new Date(Date[_0x24c751(0x20f)](_0xa14993[_0x24c751(0x23c)](),_0xa14993[_0x24c751(0x21a)](),_0x7f228a,0x0,0x0,0x0,0x0)),_0x5a2f81=new Date(Date[_0x24c751(0x20f)](_0xa14993[_0x24c751(0x23c)](),_0xa14993[_0x24c751(0x21a)](),_0xa14993[_0x24c751(0xfd)](),0x17,0x3b,0x3b,0x3e7));break;case _0x24c751(0x1cd):const _0x1fabd6=new Date(Date[_0x24c751(0x20f)](_0xa14993[_0x24c751(0x23c)](),_0xa14993[_0x24c751(0x21a)](),_0xa14993[_0x24c751(0xfd)]()-0x7)),_0x17570d=_0x1fabd6[_0x24c751(0x139)](),_0xfc2685=_0x17570d===0x0?-0x6:0x1-_0x17570d,_0xc33253=_0x1fabd6[_0x24c751(0xfd)]()+_0xfc2685;_0x531ca7=new Date(Date[_0x24c751(0x20f)](_0x1fabd6['getUTCFullYear'](),_0x1fabd6['getUTCMonth'](),_0xc33253,0x0,0x0,0x0,0x0)),_0x5a2f81=new Date(Date['UTC'](_0x1fabd6[_0x24c751(0x23c)](),_0x1fabd6[_0x24c751(0x21a)](),_0xc33253+0x6,0x17,0x3b,0x3b,0x3e7));break;case _0x24c751(0x121):_0x531ca7=new Date(Date[_0x24c751(0x20f)](_0xa14993[_0x24c751(0x23c)](),_0xa14993['getUTCMonth'](),0x1,0x0,0x0,0x0,0x0)),_0x5a2f81=new Date(Date[_0x24c751(0x20f)](_0xa14993['getUTCFullYear'](),_0xa14993[_0x24c751(0x21a)](),_0xa14993['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case'last_month':_0x531ca7=new Date(Date[_0x24c751(0x20f)](_0xa14993[_0x24c751(0x23c)](),_0xa14993['getUTCMonth']()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x5a2f81=new Date(Date[_0x24c751(0x20f)](_0xa14993['getUTCFullYear'](),_0xa14993[_0x24c751(0x21a)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x24c751(0x21c):_0x531ca7=new Date(Date[_0x24c751(0x20f)](0x7e9,0x5,0xe,0x0,0x0,0x0,0x0)),_0x5a2f81=new Date(Date['UTC'](_0xa14993[_0x24c751(0x23c)](),_0xa14993[_0x24c751(0x21a)](),_0xa14993[_0x24c751(0xfd)](),0x17,0x3b,0x3b,0x3e7));break;default:_0x531ca7=new Date(_0xa14993[_0x24c751(0x16b)]()-0x1e*0x18*0x3c*0x3c*0x3e8);const _0x563483=new Date(Date[_0x24c751(0x20f)](_0xa14993[_0x24c751(0x23c)](),_0xa14993[_0x24c751(0x21a)](),_0xa14993[_0x24c751(0xfd)]()-0x1e));_0x531ca7=new Date(Date['UTC'](_0x563483[_0x24c751(0x23c)](),_0x563483[_0x24c751(0x21a)](),_0x563483[_0x24c751(0xfd)](),0x0,0x0,0x0,0x0)),_0x5a2f81=new Date(Date[_0x24c751(0x20f)](_0xa14993[_0x24c751(0x23c)](),_0xa14993['getUTCMonth'](),_0xa14993[_0x24c751(0xfd)](),0x17,0x3b,0x3b,0x3e7));}const _0x2323e8={'gte':_0x531ca7,'lte':_0x5a2f81};console[_0x24c751(0x143)](_0x24c751(0x11a)+_0x531ca7[_0x24c751(0x222)]()+_0x24c751(0x15c)+_0x5a2f81[_0x24c751(0x222)]());const [_0x1e43ac,_0x52c10a,_0xf75ccc,_0x56e5fd,_0x50566c,_0x214ec0,_0x231e17,_0x77677a,_0x8cca43]=await Promise[_0x24c751(0x281)]([database_1[_0x24c751(0x21d)][_0x24c751(0x19e)][_0x24c751(0x183)](),database_1[_0x24c751(0x21d)][_0x24c751(0x19e)][_0x24c751(0x183)]({'where':{'status':_0x24c751(0x1bb)}}),database_1['default'][_0x24c751(0xff)][_0x24c751(0x183)]({'where':{'status':_0x24c751(0x1d0),'createdAt':_0x2323e8,'gateway':{'not':'test_gateway'}}}),database_1[_0x24c751(0x21d)]['payment'][_0x24c751(0x183)]({'where':{'status':_0x24c751(0x186),'createdAt':_0x2323e8,'gateway':{'not':_0x24c751(0x27b)}}}),database_1['default']['payment'][_0x24c751(0x183)]({'where':{'status':_0x24c751(0x160),'createdAt':_0x2323e8,'gateway':{'not':'test_gateway'}}}),database_1['default'][_0x24c751(0xff)]['findMany']({'where':{'status':_0x24c751(0x1d0),'createdAt':_0x2323e8,'gateway':{'not':_0x24c751(0x27b)}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x24c751(0x21d)][_0x24c751(0xff)][_0x24c751(0x1f2)]({'where':{'gateway':{'not':_0x24c751(0x27b)}},'take':0xa,'orderBy':{'createdAt':_0x24c751(0x1cc)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x24c751(0x21d)][_0x24c751(0xff)]['findMany']({'where':{'createdAt':_0x2323e8,'gateway':{'not':_0x24c751(0x27b)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x24c751(0x21d)]['payment'][_0x24c751(0x1f2)]({'where':{'status':'PAID','gateway':{'not':'test_gateway'}},'select':{'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![]}})]);console['log'](_0x24c751(0x1d2)+_0xf75ccc);let _0x4cd6ac=0x0,_0x39ff07=0x0;for(const _0x3f3bdc of _0x214ec0){const _0x2ce271=_0x3f3bdc[_0x24c751(0x1f4)]||0x0;_0x4cd6ac+=_0x2ce271;if(_0x3f3bdc[_0x24c751(0x157)]&&_0x3f3bdc['amountUSDT']){const _0x517fcf=_0x3f3bdc[_0x24c751(0x1f4)]-_0x3f3bdc['amountAfterGatewayCommissionUSDT'];_0x39ff07+=_0x517fcf;}}let _0x28f555=0x0;for(const _0x2c78e7 of _0x8cca43){if(_0x2c78e7[_0x24c751(0x157)]&&_0x2c78e7[_0x24c751(0x1f4)]){const _0x1c5a06=_0x2c78e7['amountUSDT']-_0x2c78e7[_0x24c751(0x157)];_0x28f555+=_0x1c5a06;}}const _0x574526=_0xf75ccc>0x0?_0x4cd6ac/_0xf75ccc:0x0,_0x136065=this['generateDailyStatistics'](_0x77677a,_0x531ca7,_0x5a2f81),_0x17016d=await database_1[_0x24c751(0x21d)][_0x24c751(0xff)][_0x24c751(0x183)]({'where':{'createdAt':_0x2323e8,'gateway':{'not':'test_gateway'},'status':{'notIn':['PENDING',_0x24c751(0x11d)]}}}),_0x5f4034=_0x17016d>0x0?_0xf75ccc/_0x17016d*0x64:0x0;return{'totalShops':_0x1e43ac,'activeShops':_0x52c10a,'totalPayments':_0x17016d,'successfulPayments':_0xf75ccc,'totalAttempts':_0x17016d,'chargebacks':_0x56e5fd,'refunds':_0x50566c,'totalRevenue':Math[_0x24c751(0x149)](_0x4cd6ac*0x64)/0x64,'trapayEarnings':Math[_0x24c751(0x149)](_0x39ff07*0x64)/0x64,'trapayEarningsAllTime':Math[_0x24c751(0x149)](_0x28f555*0x64)/0x64,'averagePaymentAmount':Math['round'](_0x574526*0x64)/0x64,'conversionRate':Math[_0x24c751(0x149)](_0x5f4034*0x64)/0x64,'dailyRevenue':_0x136065['dailyRevenue'],'dailyPayments':_0x136065['dailyPayments'],'recentPayments':_0x231e17[_0x24c751(0x158)](_0x1c7d1c=>({'id':_0x1c7d1c['id'],'amount':_0x1c7d1c[_0x24c751(0x174)],'currency':_0x1c7d1c[_0x24c751(0x261)],'status':_0x1c7d1c[_0x24c751(0x248)],'gateway':_0x1c7d1c[_0x24c751(0x1ae)],'shop':_0x1c7d1c[_0x24c751(0x19e)],'createdAt':_0x1c7d1c[_0x24c751(0x1fe)]}))};}}async[a48_0x50653f(0x230)](_0x5de944){const _0x3b01ef=a48_0x50653f;console[_0x3b01ef(0x143)]('ðŸ“Š\x20Getting\x20merchant\x20statistics\x20with\x20filters:',_0x5de944);let _0x104679,_0x2d9cc2=new Date();if(_0x5de944['period']===_0x3b01ef(0x198)&&_0x5de944[_0x3b01ef(0x13e)]&&_0x5de944[_0x3b01ef(0x10c)]){const _0x1e212e=new Date(_0x5de944['dateFrom']),_0x2e70a4=new Date(_0x5de944[_0x3b01ef(0x10c)]);_0x104679=new Date(Date[_0x3b01ef(0x20f)](_0x1e212e[_0x3b01ef(0x23c)](),_0x1e212e['getUTCMonth'](),_0x1e212e[_0x3b01ef(0xfd)](),0x0,0x0,0x0,0x0)),_0x2d9cc2=new Date(Date[_0x3b01ef(0x20f)](_0x2e70a4[_0x3b01ef(0x23c)](),_0x2e70a4[_0x3b01ef(0x21a)](),_0x2e70a4['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}else{const _0x55e756=new Date();switch(_0x5de944[_0x3b01ef(0x1d5)]){case _0x3b01ef(0x24d):_0x104679=new Date(_0x55e756[_0x3b01ef(0x16b)]()-0x7*0x18*0x3c*0x3c*0x3e8),_0x104679['setHours'](0x0,0x0,0x0,0x0),_0x2d9cc2['setHours'](0x17,0x3b,0x3b,0x3e7);break;case _0x3b01ef(0x234):_0x104679=new Date(Date['UTC'](_0x55e756[_0x3b01ef(0x23c)](),_0x55e756[_0x3b01ef(0x21a)](),0x1,0x0,0x0,0x0,0x0)),_0x2d9cc2=new Date(Date['UTC'](_0x55e756[_0x3b01ef(0x23c)](),_0x55e756[_0x3b01ef(0x21a)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x3b01ef(0x103):_0x104679=new Date(Date[_0x3b01ef(0x20f)](_0x55e756[_0x3b01ef(0x23c)](),_0x55e756['getUTCMonth']()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x2d9cc2=new Date(Date[_0x3b01ef(0x20f)](_0x55e756[_0x3b01ef(0x23c)](),_0x55e756[_0x3b01ef(0x21a)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x3b01ef(0xed):_0x104679=new Date(_0x55e756[_0x3b01ef(0x16b)]()-0x16d*0x18*0x3c*0x3c*0x3e8),_0x104679[_0x3b01ef(0x229)](0x0,0x0,0x0,0x0),_0x2d9cc2[_0x3b01ef(0x229)](0x17,0x3b,0x3b,0x3e7);break;case _0x3b01ef(0x281):default:_0x104679=new Date(_0x3b01ef(0x105)),_0x104679[_0x3b01ef(0x229)](0x0,0x0,0x0,0x0),_0x2d9cc2[_0x3b01ef(0x229)](0x17,0x3b,0x3b,0x3e7);break;}}console[_0x3b01ef(0x143)]('ðŸ“…\x20Period:\x20'+_0x104679[_0x3b01ef(0x222)]()+_0x3b01ef(0x15c)+_0x2d9cc2[_0x3b01ef(0x222)]());const _0x414802={'status':_0x3b01ef(0x1d0),'gateway':{'not':'test_gateway'},'createdAt':{'gte':_0x104679,'lte':_0x2d9cc2}};_0x5de944[_0x3b01ef(0x275)]&&(_0x414802[_0x3b01ef(0x275)]=_0x5de944[_0x3b01ef(0x275)]);const _0x43e79b=await database_1[_0x3b01ef(0x21d)][_0x3b01ef(0xff)][_0x3b01ef(0x1f2)]({'where':_0x414802,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x3b01ef(0x143)]('ðŸ’°\x20Found\x20'+_0x43e79b[_0x3b01ef(0x181)]+'\x20paid\x20payments\x20for\x20analysis');const _0x7b65a7={'gateway':{'not':'test_gateway'},'status':{'notIn':[_0x3b01ef(0x24c),_0x3b01ef(0x11d)]},'createdAt':{'gte':_0x104679,'lte':_0x2d9cc2}};_0x5de944['shopId']&&(_0x7b65a7[_0x3b01ef(0x275)]=_0x5de944['shopId']);const _0x165be8=await database_1['default']['payment']['count']({'where':_0x7b65a7}),_0xa5fbfd={..._0x7b65a7,'status':'CHARGEBACK'},_0x1b9d66={..._0x7b65a7,'status':_0x3b01ef(0x160)},[_0x483529,_0x5b9475]=await Promise[_0x3b01ef(0x281)]([database_1[_0x3b01ef(0x21d)][_0x3b01ef(0xff)][_0x3b01ef(0x183)]({'where':_0xa5fbfd}),database_1[_0x3b01ef(0x21d)][_0x3b01ef(0xff)][_0x3b01ef(0x183)]({'where':_0x1b9d66})]);console[_0x3b01ef(0x143)](_0x3b01ef(0x217)+_0x165be8+',\x20successful:\x20'+_0x43e79b[_0x3b01ef(0x181)]+_0x3b01ef(0x125)+_0x483529+',\x20refunds:\x20'+_0x5b9475);let _0xb69a34=0x0,_0xbe6dff=0x0,_0x392417=0x0;const _0x177011={},_0x4b6a2c={},_0x5309b8={},_0x221927=new Date(_0x104679);while(_0x221927<=_0x2d9cc2){const _0x5e5815=_0x221927[_0x3b01ef(0x222)]()['split']('T')[0x0];_0x5309b8[_0x5e5815]={'date':_0x5e5815,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0},_0x221927[_0x3b01ef(0x180)](_0x221927[_0x3b01ef(0xfd)]()+0x1);}for(const _0x110bfc of _0x43e79b){try{const _0xab7e6b=_0x110bfc[_0x3b01ef(0x1f4)]||0x0;if(_0xab7e6b<=0x0){console[_0x3b01ef(0x24e)](_0x3b01ef(0x22f)+_0x110bfc['id']+'\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...');continue;}let _0x4e5c4,_0x649082;if(_0x110bfc['amountAfterGatewayCommissionUSDT']!==null&&_0x110bfc[_0x3b01ef(0x157)]!==undefined)_0x4e5c4=_0x110bfc[_0x3b01ef(0x157)],_0x649082=_0xab7e6b-_0x4e5c4,console[_0x3b01ef(0x143)](_0x3b01ef(0x1bf)+_0x110bfc['id']+':\x20'+_0xab7e6b[_0x3b01ef(0x17a)](0x6)+_0x3b01ef(0x21f)+_0x4e5c4[_0x3b01ef(0x17a)](0x6)+'\x20USDT');else{let _0x572ea9={};if(_0x110bfc['shop'][_0x3b01ef(0x146)])try{_0x572ea9=JSON[_0x3b01ef(0x251)](_0x110bfc[_0x3b01ef(0x19e)][_0x3b01ef(0x146)]);}catch(_0x246409){console[_0x3b01ef(0x145)](_0x3b01ef(0x1c8)+_0x110bfc[_0x3b01ef(0x275)]+':',_0x246409);}let _0x12e824=0x2d;for(const [_0x4df033,_0x4866c8]of Object[_0x3b01ef(0x1f8)](_0x572ea9)){if(_0x4df033[_0x3b01ef(0x1ba)]()===_0x110bfc[_0x3b01ef(0x1ae)]['toLowerCase']()){_0x12e824=_0x4866c8[_0x3b01ef(0x17b)]||0x2d;break;}}_0x649082=_0xab7e6b*(_0x12e824/0x64),_0x4e5c4=_0xab7e6b-_0x649082,console[_0x3b01ef(0x143)](_0x3b01ef(0x10b)+_0x110bfc['id']+':\x20'+_0x12e824+_0x3b01ef(0x179)+_0xab7e6b[_0x3b01ef(0x17a)](0x6)+_0x3b01ef(0x204));}_0xb69a34+=_0xab7e6b,_0xbe6dff+=_0x4e5c4,_0x392417+=_0x649082;let _0x5b05fa;_0x110bfc[_0x3b01ef(0x119)]!==null&&_0x110bfc[_0x3b01ef(0x119)]!==undefined?(_0x5b05fa=_0x110bfc[_0x3b01ef(0x119)],console[_0x3b01ef(0x143)]('ðŸ“Š\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20'+_0x110bfc['id']+':\x20'+_0x5b05fa+'%')):(_0x5b05fa=_0xab7e6b>0x0?_0x649082/_0xab7e6b*0x64:0x0,console[_0x3b01ef(0x143)](_0x3b01ef(0x266)+_0x110bfc['id']+':\x20'+_0x5b05fa['toFixed'](0x2)+'%'));!_0x177011[_0x110bfc[_0x3b01ef(0x1ae)]]&&(_0x177011[_0x110bfc[_0x3b01ef(0x1ae)]]={'gateway':_0x110bfc[_0x3b01ef(0x1ae)],'gatewayDisplayName':this[_0x3b01ef(0x19f)](_0x110bfc['gateway']),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x177011[_0x110bfc[_0x3b01ef(0x1ae)]]['paymentsCount']++,_0x177011[_0x110bfc[_0x3b01ef(0x1ae)]][_0x3b01ef(0x27f)]+=_0xab7e6b,_0x177011[_0x110bfc['gateway']][_0x3b01ef(0x1bd)]+=_0x649082,_0x177011[_0x110bfc['gateway']]['merchantEarningsUSDT']+=_0x4e5c4,_0x177011[_0x110bfc[_0x3b01ef(0x1ae)]][_0x3b01ef(0x250)]+=_0x5b05fa;!_0x5de944[_0x3b01ef(0x275)]&&(!_0x4b6a2c[_0x110bfc[_0x3b01ef(0x275)]]&&(_0x4b6a2c[_0x110bfc[_0x3b01ef(0x275)]]={'shopId':_0x110bfc['shopId'],'shopName':_0x110bfc[_0x3b01ef(0x19e)][_0x3b01ef(0x188)],'shopUsername':_0x110bfc[_0x3b01ef(0x19e)]['username'],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x4b6a2c[_0x110bfc[_0x3b01ef(0x275)]]['paymentsCount']++,_0x4b6a2c[_0x110bfc[_0x3b01ef(0x275)]][_0x3b01ef(0x27f)]+=_0xab7e6b,_0x4b6a2c[_0x110bfc[_0x3b01ef(0x275)]][_0x3b01ef(0x1bd)]+=_0x649082,_0x4b6a2c[_0x110bfc[_0x3b01ef(0x275)]][_0x3b01ef(0x232)]+=_0x4e5c4);const _0x5e2fd8=_0x110bfc['paidAt'][_0x3b01ef(0x222)]()[_0x3b01ef(0x12a)]('T')[0x0];_0x5309b8[_0x5e2fd8]&&(_0x5309b8[_0x5e2fd8][_0x3b01ef(0x12c)]+=_0xab7e6b,_0x5309b8[_0x5e2fd8][_0x3b01ef(0x1b8)]+=_0x4e5c4,_0x5309b8[_0x5e2fd8]['gatewayEarnings']+=_0x649082,_0x5309b8[_0x5e2fd8][_0x3b01ef(0x101)]++);}catch(_0x50d77a){console[_0x3b01ef(0x145)](_0x3b01ef(0x1fd)+_0x110bfc['id']+':',_0x50d77a);}}Object[_0x3b01ef(0x20e)](_0x177011)[_0x3b01ef(0x190)](_0x13c4f1=>{const _0x25385c=_0x3b01ef;_0x13c4f1[_0x25385c(0x163)]=_0x13c4f1['paymentsCount']>0x0?_0x13c4f1['totalCommissionRate']/_0x13c4f1[_0x25385c(0x101)]:0x0,delete _0x13c4f1[_0x25385c(0x250)];}),Object['values'](_0x4b6a2c)[_0x3b01ef(0x190)](_0xb4164=>{const _0x343506=_0x3b01ef;_0xb4164['averageCheckUSDT']=_0xb4164[_0x343506(0x101)]>0x0?_0xb4164[_0x343506(0x27f)]/_0xb4164[_0x343506(0x101)]:0x0;});let _0xfe69c4=0x0,_0x22d3f7=0x0;if(_0x5de944[_0x3b01ef(0x275)]){const _0x4bf5b5=await database_1['default']['payout'][_0x3b01ef(0x1f2)]({'where':{'shopId':_0x5de944['shopId'],'status':_0x3b01ef(0x1d4),'createdAt':{'gte':_0x104679,'lte':_0x2d9cc2}},'select':{'amount':!![]}});_0xfe69c4=_0x4bf5b5[_0x3b01ef(0x1c2)]((_0xc865e3,_0x1c88ed)=>_0xc865e3+_0x1c88ed['amount'],0x0);const _0x4f3d3d=await database_1[_0x3b01ef(0x21d)]['payout'][_0x3b01ef(0x1f2)]({'where':{'shopId':_0x5de944['shopId'],'status':_0x3b01ef(0x24c),'createdAt':{'gte':_0x104679,'lte':_0x2d9cc2}},'select':{'amount':!![]}});_0x22d3f7=_0x4f3d3d['reduce']((_0x143d56,_0x1c1759)=>_0x143d56+_0x1c1759['amount'],0x0);}const _0x39946e=_0x165be8,_0x1e9553=_0x43e79b[_0x3b01ef(0x181)],_0x124ee6=_0x1e9553>0x0?_0xb69a34/_0x1e9553:0x0,_0x3257d9=_0x39946e>0x0?Math[_0x3b01ef(0x149)](_0x1e9553/_0x39946e*0x2710)/0x64:0x0,_0x1564fb=Math['ceil']((_0x2d9cc2[_0x3b01ef(0x16b)]()-_0x104679[_0x3b01ef(0x16b)]())/(0x3e8*0x3c*0x3c*0x18)),_0x119758={'totalTurnover':Math[_0x3b01ef(0x149)](_0xb69a34*0x64)/0x64,'merchantEarnings':Math[_0x3b01ef(0x149)](_0xbe6dff*0x64)/0x64,'gatewayEarnings':Math[_0x3b01ef(0x149)](_0x392417*0x64)/0x64,'totalPaidOut':Math['round'](_0xfe69c4*0x64)/0x64,'pendingPayout':Math[_0x3b01ef(0x149)](_0x22d3f7*0x64)/0x64,'averageCheck':Math[_0x3b01ef(0x149)](_0x124ee6*0x64)/0x64,'totalPayments':_0x39946e,'successfulPayments':_0x1e9553,'conversionRate':_0x3257d9,'chargebacks':_0x483529,'refunds':_0x5b9475,'gatewayBreakdown':Object['values'](_0x177011)[_0x3b01ef(0x158)](_0x261088=>({..._0x261088,'turnoverUSDT':Math['round'](_0x261088['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math[_0x3b01ef(0x149)](_0x261088[_0x3b01ef(0x1bd)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x3b01ef(0x149)](_0x261088[_0x3b01ef(0x232)]*0x64)/0x64,'averageCommissionRate':Math[_0x3b01ef(0x149)](_0x261088[_0x3b01ef(0x163)]*0x64)/0x64})),'merchantBreakdown':_0x5de944[_0x3b01ef(0x275)]?undefined:Object['values'](_0x4b6a2c)[_0x3b01ef(0x158)](_0x1f0390=>({..._0x1f0390,'turnoverUSDT':Math[_0x3b01ef(0x149)](_0x1f0390['turnoverUSDT']*0x64)/0x64,'commissionUSDT':Math['round'](_0x1f0390['commissionUSDT']*0x64)/0x64,'merchantEarningsUSDT':Math[_0x3b01ef(0x149)](_0x1f0390['merchantEarningsUSDT']*0x64)/0x64,'paidOutUSDT':Math[_0x3b01ef(0x149)](_0x1f0390[_0x3b01ef(0x1b4)]*0x64)/0x64,'averageCheckUSDT':Math[_0x3b01ef(0x149)](_0x1f0390[_0x3b01ef(0x10e)]*0x64)/0x64})),'dailyData':Object['values'](_0x5309b8)[_0x3b01ef(0x158)](_0x3db8b8=>({..._0x3db8b8,'turnover':Math[_0x3b01ef(0x149)](_0x3db8b8[_0x3b01ef(0x12c)]*0x64)/0x64,'merchantEarnings':Math[_0x3b01ef(0x149)](_0x3db8b8['merchantEarnings']*0x64)/0x64,'gatewayEarnings':Math[_0x3b01ef(0x149)](_0x3db8b8['gatewayEarnings']*0x64)/0x64}))[_0x3b01ef(0x1f6)]((_0x527594,_0x3d58c4)=>_0x527594[_0x3b01ef(0x124)][_0x3b01ef(0x1e0)](_0x3d58c4[_0x3b01ef(0x124)])),'periodInfo':{'from':_0x104679,'to':_0x2d9cc2,'periodType':_0x5de944['period']||_0x3b01ef(0x198),'daysCount':_0x1564fb}};return console['log'](_0x3b01ef(0x111)),console[_0x3b01ef(0x143)]('\x20\x20\x20ðŸ’°\x20Total\x20turnover:\x20'+_0x119758[_0x3b01ef(0x25f)]+'\x20USDT'),console[_0x3b01ef(0x143)](_0x3b01ef(0x114)+_0x119758[_0x3b01ef(0x1b8)]+'\x20USDT'),console[_0x3b01ef(0x143)]('\x20\x20\x20ðŸª\x20Gateway\x20earnings:\x20'+_0x119758[_0x3b01ef(0x1e2)]+_0x3b01ef(0x204)),console[_0x3b01ef(0x143)]('\x20\x20\x20ï¿½\x20Total\x20paid\x20out:\x20'+_0x119758[_0x3b01ef(0x1f1)]+_0x3b01ef(0x204)),console['log'](_0x3b01ef(0x235)+_0x119758[_0x3b01ef(0x221)]+_0x3b01ef(0x204)),console[_0x3b01ef(0x143)]('\x20\x20\x20ï¿½ðŸ“Š\x20Total\x20payments:\x20'+_0x119758[_0x3b01ef(0x253)]),_0x119758;}async[a48_0x50653f(0x1e4)](_0x15a661){const _0x378d55=a48_0x50653f;console[_0x378d55(0x143)](_0x378d55(0x23f),{'hasPayoutHistory':_0x15a661});let _0x3b360b={};_0x15a661&&(_0x3b360b[_0x378d55(0x210)]={'some':{}});const _0x240efa=await database_1[_0x378d55(0x21d)]['shop'][_0x378d55(0x1f2)]({'where':_0x3b360b,'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':_0x378d55(0x194)}});return console[_0x378d55(0x143)]('ðŸ“‹\x20Found\x20'+_0x240efa[_0x378d55(0x181)]+_0x378d55(0x11f)+(_0x15a661?_0x378d55(0x166):'')),_0x240efa[_0x378d55(0x158)](_0xb10408=>({'id':_0xb10408['id'],'username':_0xb10408[_0x378d55(0x21b)],'name':_0xb10408[_0x378d55(0x188)]}));}[a48_0x50653f(0x19f)](_0x467cf9){const _0x3f2dcd=a48_0x50653f,_0x25d179={'test_gateway':_0x3f2dcd(0x132),'plisio':_0x3f2dcd(0x23d),'rapyd':'Rapyd','noda':_0x3f2dcd(0x12d),'cointopay':_0x3f2dcd(0x26f),'cointopay2':_0x3f2dcd(0x16d),'klyme_eu':_0x3f2dcd(0x15f),'klyme_gb':_0x3f2dcd(0x242),'klyme_de':_0x3f2dcd(0x1e3),'mastercard':_0x3f2dcd(0x27e)};return _0x25d179[_0x467cf9]||_0x467cf9;}[a48_0x50653f(0x21e)](_0x47f71f){const _0x35f5b7=a48_0x50653f,_0x1a4407={'Test\x20Gateway':_0x35f5b7(0x27b),'Plisio':_0x35f5b7(0x254),'Rapyd':_0x35f5b7(0x278),'Noda':_0x35f5b7(0x272),'CoinToPay':_0x35f5b7(0x15b),'CoinToPay2':'cointopay2','KLYME\x20EU':_0x35f5b7(0x15e),'KLYME\x20GB':'klyme_gb','KLYME\x20DE':_0x35f5b7(0x148),'MasterCard':_0x35f5b7(0x184)};return _0x1a4407[_0x47f71f]||_0x47f71f[_0x35f5b7(0x1ba)]();}async[a48_0x50653f(0x216)](_0x5add3d){const _0x4c4106=a48_0x50653f,{page:_0x32ce65,limit:_0x403ce2,minAmount:_0x12bd15,search:_0x15c120}=_0x5add3d;console[_0x4c4106(0x143)](_0x4c4106(0x1af),_0x5add3d);let _0x5b81e9={};_0x15c120&&(_0x5b81e9[_0x4c4106(0x188)]={'contains':_0x15c120,'mode':_0x4c4106(0x1be)});const _0x1ba497=await database_1[_0x4c4106(0x21d)][_0x4c4106(0x19e)][_0x4c4106(0x1f2)]({'where':_0x5b81e9,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),_0x912fb7=_0x1ba497[_0x4c4106(0x17e)](_0x12f436=>{const _0x2ce632=_0x4c4106,_0xefc627=Math[_0x2ce632(0x228)](_0x12f436[_0x2ce632(0xf6)]*0x64)/0x64;if(_0x12bd15&&_0xefc627<_0x12bd15)return![];return _0xefc627!==0x0;});_0x912fb7[_0x4c4106(0x1f6)]((_0x5a6f55,_0x34c4e8)=>_0x34c4e8['balance']-_0x5a6f55[_0x4c4106(0xf6)]);const _0x54af15=_0x912fb7[_0x4c4106(0x181)],_0x488a79=(_0x32ce65-0x1)*_0x403ce2,_0x466d32=_0x912fb7[_0x4c4106(0x123)](_0x488a79,_0x488a79+_0x403ce2);console[_0x4c4106(0x143)](_0x4c4106(0x18f)+_0x466d32[_0x4c4106(0x181)]+_0x4c4106(0x14b));const _0x3f0117=await Promise[_0x4c4106(0x281)](_0x466d32[_0x4c4106(0x158)](async _0x30f42c=>{const _0x4e63ad=_0x4c4106,[_0x2eea4f,_0x46ae8,_0x1c47bf]=await Promise['all']([database_1[_0x4e63ad(0x21d)][_0x4e63ad(0xff)][_0x4e63ad(0x183)]({'where':{'shopId':_0x30f42c['id'],'status':_0x4e63ad(0x1d0),'gateway':{'not':'test_gateway'}}}),database_1['default'][_0x4e63ad(0xff)]['findFirst']({'where':{'shopId':_0x30f42c['id'],'status':'PAID','gateway':{'not':_0x4e63ad(0x27b)}},'orderBy':{'paidAt':_0x4e63ad(0x194)},'select':{'paidAt':!![]}}),database_1[_0x4e63ad(0x21d)][_0x4e63ad(0xff)][_0x4e63ad(0x22a)]({'by':[_0x4e63ad(0x1ae)],'where':{'shopId':_0x30f42c['id'],'status':_0x4e63ad(0x1d0),'gateway':{'not':_0x4e63ad(0x27b)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x275cf1=new Date(),_0x5702bf=new Date(_0x275cf1[_0x4e63ad(0x19b)](),_0x275cf1[_0x4e63ad(0x20b)](),0x1),_0x376d25=new Date(_0x275cf1['getFullYear'](),_0x275cf1[_0x4e63ad(0x20b)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x1e4eb0,_0x1b54c9]=await Promise['all']([database_1[_0x4e63ad(0x21d)][_0x4e63ad(0x169)][_0x4e63ad(0x279)]({'_sum':{'amount':!![]},'where':{'shopId':_0x30f42c['id'],'status':'COMPLETED'}}),database_1['default'][_0x4e63ad(0x169)][_0x4e63ad(0x279)]({'_sum':{'amount':!![]},'where':{'shopId':_0x30f42c['id'],'status':_0x4e63ad(0x1d4),'createdAt':{'gte':_0x5702bf,'lte':_0x376d25}}})]),_0xb8b4f1=_0x1e4eb0[_0x4e63ad(0x1c3)][_0x4e63ad(0x174)]||0x0,_0x3b0317=_0x1b54c9[_0x4e63ad(0x1c3)][_0x4e63ad(0x174)]||0x0,_0x37e205=await Promise[_0x4e63ad(0x281)](_0x1c47bf[_0x4e63ad(0x158)](async _0xbbab75=>{const _0x51093e=_0x4e63ad;let _0x1dc82e=0x2d;if(_0x30f42c[_0x51093e(0x146)])try{const _0x5589de=JSON[_0x51093e(0x251)](_0x30f42c[_0x51093e(0x146)]);for(const [_0x41c90e,_0x27c3b9]of Object[_0x51093e(0x1f8)](_0x5589de)){if(_0x41c90e['toLowerCase']()===_0xbbab75['gateway'][_0x51093e(0x1ba)]()){_0x1dc82e=_0x27c3b9[_0x51093e(0x17b)]||0xa,console[_0x51093e(0x143)](_0x51093e(0x1a7)+_0xbbab75[_0x51093e(0x1ae)]+_0x51093e(0x27c)+_0x30f42c['id']+_0x51093e(0x128)+_0x1dc82e+'%');break;}}}catch(_0x516f78){console[_0x51093e(0x145)](_0x51093e(0x1c8)+_0x30f42c['id']+':',_0x516f78);}const _0x45caf8=_0xbbab75[_0x51093e(0x1c3)]?.['amountUSDT']||0x0,_0x53114d=_0x45caf8*(0x1-_0x1dc82e/0x64);return{'gateway':_0xbbab75[_0x51093e(0x1ae)],'count':_0xbbab75[_0x51093e(0x1ee)]?.['id']||0x0,'amountUSDT':Math[_0x51093e(0x149)](_0x45caf8*0x64)/0x64,'amountAfterCommissionUSDT':Math['round'](_0x53114d*0x64)/0x64,'commission':_0x1dc82e};})),_0x4337c3=_0x37e205['reduce']((_0x2ca701,_0x5e14d7)=>_0x2ca701+_0x5e14d7[_0x4e63ad(0x1f4)],0x0),_0x3ee1db=_0x37e205['reduce']((_0x3b3dcd,_0x346420)=>_0x3b3dcd+_0x346420[_0x4e63ad(0x12b)],0x0),_0x499c76=_0x30f42c[_0x4e63ad(0xf6)];return console[_0x4e63ad(0x143)](_0x4e63ad(0x1c0)+_0x30f42c[_0x4e63ad(0x21b)]+':'),console['log'](_0x4e63ad(0x1e6)+_0x4337c3[_0x4e63ad(0x17a)](0x2)+_0x4e63ad(0x23a)),console[_0x4e63ad(0x143)]('\x20\x20\x20ðŸ”\x20Calculated\x20after\x20commission:\x20'+_0x3ee1db[_0x4e63ad(0x17a)](0x2)+_0x4e63ad(0x25e)),console[_0x4e63ad(0x143)](_0x4e63ad(0x108)+_0x499c76[_0x4e63ad(0x17a)](0x2)+_0x4e63ad(0x1b2)),console[_0x4e63ad(0x143)]('\x20\x20\x20ðŸ’¸\x20Total\x20payouts:\x20'+_0xb8b4f1[_0x4e63ad(0x17a)](0x2)+_0x4e63ad(0x213)),console[_0x4e63ad(0x143)](_0x4e63ad(0x1c6)+(_0x3ee1db-_0xb8b4f1-_0x499c76)[_0x4e63ad(0x17a)](0x2)+_0x4e63ad(0x18c)),{'id':_0x30f42c['id'],'fullName':_0x30f42c['name'],'username':_0x30f42c[_0x4e63ad(0x21b)],'telegramId':_0x30f42c[_0x4e63ad(0x215)],'merchantUrl':_0x30f42c['shopUrl'],'wallets':{'usdtPolygonWallet':_0x30f42c[_0x4e63ad(0x17f)],'usdtTrcWallet':_0x30f42c[_0x4e63ad(0x195)],'usdtErcWallet':_0x30f42c[_0x4e63ad(0x26e)],'usdcPolygonWallet':_0x30f42c[_0x4e63ad(0x1ca)],'usdcErcWallet':_0x30f42c[_0x4e63ad(0x257)]},'totalAmountUSDT':Math[_0x4e63ad(0x149)](_0x4337c3*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x3ee1db*0x64)/0x64,'currentBalance':Math['floor'](_0x499c76*0x64)/0x64,'totalPayout':Math[_0x4e63ad(0x149)](_0xb8b4f1*0x64)/0x64,'thisMonth':Math['round'](_0x3b0317*0x64)/0x64,'paymentsCount':_0x2eea4f,'oldestPaymentDate':_0x46ae8?.[_0x4e63ad(0xfc)]||_0x30f42c[_0x4e63ad(0x1fe)],'gatewayBreakdown':_0x37e205};})),_0x48329b=_0x3f0117['reduce']((_0x214a48,_0xad9cdd)=>_0x214a48+_0xad9cdd['totalAmountUSDT'],0x0),_0x440a6b=_0x3f0117[_0x4c4106(0x1c2)]((_0x2b72bc,_0x169f65)=>_0x2b72bc+_0x169f65[_0x4c4106(0x116)],0x0),_0x4cb3c5=_0x3f0117['reduce']((_0x37fae6,_0x49196b)=>_0x37fae6+_0x49196b[_0x4c4106(0x126)],0x0),_0x59753b=_0x3f0117[_0x4c4106(0x1c2)]((_0x1d3255,_0x528788)=>_0x1d3255+_0x528788[_0x4c4106(0xf9)],0x0);return console[_0x4c4106(0x143)]('ðŸ“Š\x20Merchants\x20with\x20rounded\x20balance\x20!=\x200.00:\x20'+_0x54af15+'\x20merchants'),console['log'](_0x4c4106(0x1d9)+Math[_0x4c4106(0x149)](_0x48329b*0x64)/0x64+'\x20USDT\x20(gross\x20revenue)'),console['log'](_0x4c4106(0x1f9)+Math[_0x4c4106(0x149)](_0x440a6b*0x64)/0x64+_0x4c4106(0x1cb)),console[_0x4c4106(0x143)](_0x4c4106(0x1a6)+Math[_0x4c4106(0x149)](_0x4cb3c5*0x64)/0x64+_0x4c4106(0x204)),console['log'](_0x4c4106(0x259)+Math[_0x4c4106(0x149)](_0x59753b*0x64)/0x64+_0x4c4106(0x204)),{'merchants':_0x3f0117,'pagination':{'page':_0x32ce65,'limit':_0x403ce2,'total':_0x54af15,'totalPages':Math[_0x4c4106(0x102)](_0x54af15/_0x403ce2)},'summary':{'totalMerchants':_0x54af15,'totalAmountUSDT':Math[_0x4c4106(0x149)](_0x48329b*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x4c4106(0x149)](_0x440a6b*0x64)/0x64,'totalPayout':Math[_0x4c4106(0x149)](_0x4cb3c5*0x64)/0x64,'thisMonth':Math[_0x4c4106(0x149)](_0x59753b*0x64)/0x64}};}async['createPayout'](_0x40aa1f){const _0x38c9c4=a48_0x50653f,{shopId:_0x4a9975,amount:_0x106f1b,network:_0x33fcea,wallet:_0xd544c5,notes:_0x11f531,txid:_0x5c6e0b,periodFrom:_0x28c0e3,periodTo:_0x1f8c76}=_0x40aa1f,_0x5d4915=await database_1[_0x38c9c4(0x21d)][_0x38c9c4(0x1ef)](async _0xca4306=>{const _0xe57f19=_0x38c9c4,_0x48f75a=await _0xca4306[_0xe57f19(0x19e)][_0xe57f19(0xf8)]({'where':{'id':_0x4a9975},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x48f75a)throw new Error(_0xe57f19(0x284));console[_0xe57f19(0x143)]('ðŸ’°\x20Creating\x20payout\x20for\x20shop\x20'+_0x48f75a[_0xe57f19(0x21b)]+':'),console[_0xe57f19(0x143)](_0xe57f19(0x191)+_0x48f75a[_0xe57f19(0xf6)][_0xe57f19(0x17a)](0x6)+_0xe57f19(0x204)),console[_0xe57f19(0x143)](_0xe57f19(0xea)+_0x106f1b['toFixed'](0x6)+_0xe57f19(0x204)),console[_0xe57f19(0x143)](_0xe57f19(0x165)+_0x48f75a[_0xe57f19(0x1f1)][_0xe57f19(0x17a)](0x6)+_0xe57f19(0x204));if(_0x5c6e0b)console[_0xe57f19(0x143)](_0xe57f19(0x168)+_0x5c6e0b);const _0x2e8555=0.000001,_0xdaadfc=Number(_0x48f75a[_0xe57f19(0xf6)]),_0x3c2411=Number(_0x106f1b);console[_0xe57f19(0x143)](_0xe57f19(0x1ad)),console['log'](_0xe57f19(0x239)+_0x48f75a[_0xe57f19(0xf6)]),console[_0xe57f19(0x143)](_0xe57f19(0x1e8)+_0xdaadfc),console[_0xe57f19(0x143)](_0xe57f19(0x25b)+_0x3c2411),console[_0xe57f19(0x143)]('\x20\x20\x20Difference:\x20'+(_0xdaadfc-_0x3c2411)),console[_0xe57f19(0x143)]('\x20\x20\x20Tolerance:\x20'+_0x2e8555);if(_0xdaadfc<_0x3c2411-_0x2e8555)throw new Error(_0xe57f19(0x1c4)+_0xdaadfc[_0xe57f19(0x17a)](0x6)+_0xe57f19(0x177)+_0x3c2411[_0xe57f19(0x17a)](0x6)+'\x20USDT,\x20Difference:\x20'+(_0xdaadfc-_0x3c2411)[_0xe57f19(0x17a)](0x8)+_0xe57f19(0x204));console[_0xe57f19(0x143)]('âœ…\x20Balance\x20check\x20passed\x20(with\x20tolerance)');const _0x564af4=Math[_0xe57f19(0x1d1)](_0xdaadfc,_0x3c2411);let _0x335d6b=_0xd544c5;console[_0xe57f19(0x143)](_0xe57f19(0x258)+(_0xd544c5||_0xe57f19(0x178)));if(!_0x335d6b){console[_0xe57f19(0x143)](_0xe57f19(0x24a));const _0x187435=await _0xca4306[_0xe57f19(0x19e)][_0xe57f19(0xf8)]({'where':{'id':_0x4a9975},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});console[_0xe57f19(0x143)]('ðŸ”\x20Shop\x20wallets:',_0x187435);if(_0x187435)switch(_0x33fcea){case _0xe57f19(0x209):_0x335d6b=_0x187435['usdtPolygonWallet']||undefined,console[_0xe57f19(0x143)](_0xe57f19(0x276)+_0x335d6b);break;case _0xe57f19(0x144):_0x335d6b=_0x187435[_0xe57f19(0x195)]||undefined,console[_0xe57f19(0x143)](_0xe57f19(0x1aa)+_0x335d6b);break;case _0xe57f19(0x1ed):_0x335d6b=_0x187435['usdtErcWallet']||undefined,console[_0xe57f19(0x143)](_0xe57f19(0x1d8)+_0x335d6b);break;case'polygon_usdc':_0x335d6b=_0x187435[_0xe57f19(0x1ca)]||undefined,console['log']('ðŸ”\x20Selected\x20polygon_usdc\x20wallet:\x20'+_0x335d6b);break;case _0xe57f19(0x16f):_0x335d6b=_0x187435[_0xe57f19(0x257)]||undefined,console[_0xe57f19(0x143)](_0xe57f19(0x214)+_0x335d6b);break;}}else console[_0xe57f19(0x143)](_0xe57f19(0x1b3)+_0x335d6b);console[_0xe57f19(0x143)](_0xe57f19(0x285)+_0x33fcea+':\x20'+(_0x335d6b||_0xe57f19(0x244))),console[_0xe57f19(0x143)](_0xe57f19(0x243),{'shopId':_0x4a9975,'amount':_0x564af4,'network':_0x33fcea,'wallet':_0x335d6b,'status':_0xe57f19(0x1d4),'txid':_0x5c6e0b,'notes':_0x11f531,'periodFrom':_0x28c0e3?new Date(_0x28c0e3):null,'periodTo':_0x1f8c76?new Date(_0x1f8c76):null});const _0x196a6b=await _0xca4306[_0xe57f19(0x169)]['create']({'data':{'shopId':_0x4a9975,'amount':_0x564af4,'network':_0x33fcea,'wallet':_0x335d6b,'status':'COMPLETED','txid':_0x5c6e0b,'notes':_0x11f531,'periodFrom':_0x28c0e3?new Date(_0x28c0e3):null,'periodTo':_0x1f8c76?new Date(_0x1f8c76):null,'createdAt':new Date(),'paidAt':new Date()}});console[_0xe57f19(0x143)](_0xe57f19(0x12f),{'id':_0x196a6b['id'],'wallet':_0x196a6b['wallet'],'network':_0x196a6b['network'],'amount':_0x196a6b[_0xe57f19(0x174)]});const _0x90253=_0xdaadfc-_0x564af4,_0x976b83=Number(_0x48f75a[_0xe57f19(0x1f1)])+_0x564af4;return await _0xca4306[_0xe57f19(0x19e)][_0xe57f19(0x22d)]({'where':{'id':_0x4a9975},'data':{'balance':_0x90253,'totalPaidOut':_0x976b83}}),console[_0xe57f19(0x143)](_0xe57f19(0x25a)+_0x48f75a[_0xe57f19(0x21b)]+'\x20balance\x20updated:'),console[_0xe57f19(0x143)]('\x20\x20\x20Balance:\x20'+_0xdaadfc[_0xe57f19(0x17a)](0x6)+_0xe57f19(0x27a)+_0x90253[_0xe57f19(0x17a)](0x6)+_0xe57f19(0x115)+_0x564af4[_0xe57f19(0x17a)](0x6)+')'),console[_0xe57f19(0x143)](_0xe57f19(0x151)+_0x48f75a['totalPaidOut'][_0xe57f19(0x17a)](0x6)+_0xe57f19(0x27a)+_0x976b83[_0xe57f19(0x17a)](0x6)+_0xe57f19(0x137)+_0x564af4[_0xe57f19(0x17a)](0x6)+')'),console[_0xe57f19(0x143)](_0xe57f19(0x1dd)+_0x564af4[_0xe57f19(0x17a)](0x6)+_0xe57f19(0x204)),{'payout':_0x196a6b,'shop':_0x48f75a};});console[_0x38c9c4(0x143)]('âœ…\x20Payout\x20created:\x20'+_0x5d4915[_0x38c9c4(0x169)]['id']+_0x38c9c4(0x27c)+_0x5d4915['shop']['username']+'\x20('+_0x5d4915[_0x38c9c4(0x169)][_0x38c9c4(0x174)][_0x38c9c4(0x17a)](0x6)+_0x38c9c4(0x1ea));try{let _0x199833='ÐÐµ\x20ÑƒÐºÐ°Ð·Ð°Ð½';if(_0x5d4915['payout'][_0x38c9c4(0xf0)]&&_0x5d4915[_0x38c9c4(0x169)][_0x38c9c4(0x1c9)]){const _0x39c8c6=new Date(_0x5d4915[_0x38c9c4(0x169)][_0x38c9c4(0xf0)])['toLocaleDateString']('ru-RU'),_0x209b52=new Date(_0x5d4915['payout']['periodTo'])[_0x38c9c4(0x1b1)]('ru-RU');_0x199833=_0x39c8c6+_0x38c9c4(0x1a3)+_0x209b52;}await telegramBotService_1['telegramBotService'][_0x38c9c4(0x247)](_0x5d4915[_0x38c9c4(0x169)]['shopId'],{'id':_0x5d4915['payout']['id'],'amount':_0x5d4915[_0x38c9c4(0x169)][_0x38c9c4(0x174)],'network':_0x5d4915['payout'][_0x38c9c4(0x202)],'wallet':_0x5d4915[_0x38c9c4(0x169)][_0x38c9c4(0x26d)],'period':_0x199833,'createdAt':_0x5d4915[_0x38c9c4(0x169)][_0x38c9c4(0x1fe)],'txid':_0x5d4915[_0x38c9c4(0x169)][_0x38c9c4(0x20c)]}),console[_0x38c9c4(0x143)](_0x38c9c4(0x268)+_0x5d4915[_0x38c9c4(0x169)]['id']);}catch(_0x407cc1){console[_0x38c9c4(0x145)](_0x38c9c4(0x1da)+_0x5d4915['payout']['id']+':',_0x407cc1);}return{'id':_0x5d4915['payout']['id'],'shopId':_0x5d4915[_0x38c9c4(0x169)][_0x38c9c4(0x275)],'shopName':_0x5d4915['shop']['name'],'shopUsername':_0x5d4915['shop']['username'],'amount':_0x5d4915['payout'][_0x38c9c4(0x174)],'network':_0x5d4915[_0x38c9c4(0x169)][_0x38c9c4(0x202)],'wallet':_0x5d4915[_0x38c9c4(0x169)][_0x38c9c4(0x26d)],'status':_0x5d4915[_0x38c9c4(0x169)]['status'],'txid':_0x5d4915['payout'][_0x38c9c4(0x20c)],'notes':_0x5d4915[_0x38c9c4(0x169)][_0x38c9c4(0x1ec)],'periodFrom':_0x5d4915[_0x38c9c4(0x169)][_0x38c9c4(0xf0)],'periodTo':_0x5d4915[_0x38c9c4(0x169)][_0x38c9c4(0x1c9)],'createdAt':_0x5d4915['payout'][_0x38c9c4(0x1fe)],'paidAt':_0x5d4915['payout'][_0x38c9c4(0xfc)]};}async[a48_0x50653f(0x1db)](_0x1ab01b){const _0x4d18ab=a48_0x50653f,{page:_0xff8d70,limit:_0x2c1d39,shopId:_0x4458ff,network:_0x27001c,dateFrom:_0x515dfc,dateTo:_0x3bca52,search:_0x3ff24d}=_0x1ab01b,_0x4a345d=(_0xff8d70-0x1)*_0x2c1d39,_0x319cc4={};_0x4458ff&&(_0x319cc4['shopId']=_0x4458ff);_0x27001c&&(_0x319cc4[_0x4d18ab(0x202)]=_0x27001c);if(_0x515dfc||_0x3bca52){_0x319cc4['createdAt']={};if(_0x515dfc){const _0x395e26=new Date(_0x515dfc);_0x395e26[_0x4d18ab(0x229)](0x0,0x0,0x0,0x1),_0x319cc4['createdAt'][_0x4d18ab(0x127)]=_0x395e26,console['log']('ðŸ“…\x20Payout\x20date\x20from\x20filter:\x20'+_0x395e26[_0x4d18ab(0x222)]());}if(_0x3bca52){const _0x645667=new Date(_0x3bca52);_0x645667[_0x4d18ab(0x229)](0x17,0x3b,0x3b,0x3e7),_0x319cc4[_0x4d18ab(0x1fe)][_0x4d18ab(0xec)]=_0x645667,console[_0x4d18ab(0x143)](_0x4d18ab(0x1fa)+_0x645667['toISOString']());}}_0x3ff24d&&(_0x319cc4['OR']=[{'shop':{'name':{'contains':_0x3ff24d,'mode':_0x4d18ab(0x1be)}}},{'shop':{'username':{'contains':_0x3ff24d,'mode':_0x4d18ab(0x1be)}}},{'notes':{'contains':_0x3ff24d,'mode':_0x4d18ab(0x1be)}}]);const [_0x5ecfad,_0x4360eb]=await Promise[_0x4d18ab(0x281)]([database_1[_0x4d18ab(0x21d)][_0x4d18ab(0x169)][_0x4d18ab(0x1f2)]({'where':_0x319cc4,'skip':_0x4a345d,'take':_0x2c1d39,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'wallet':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x4d18ab(0x169)][_0x4d18ab(0x183)]({'where':_0x319cc4})]);return{'payouts':_0x5ecfad[_0x4d18ab(0x158)](_0x20e74c=>({'id':_0x20e74c['id'],'shopId':_0x20e74c[_0x4d18ab(0x275)],'shopName':_0x20e74c['shop'][_0x4d18ab(0x188)],'shopUsername':_0x20e74c[_0x4d18ab(0x19e)][_0x4d18ab(0x21b)],'amount':_0x20e74c[_0x4d18ab(0x174)],'network':_0x20e74c[_0x4d18ab(0x202)],'wallet':_0x20e74c['wallet'],'status':_0x20e74c[_0x4d18ab(0x248)],'txid':_0x20e74c[_0x4d18ab(0x20c)],'notes':_0x20e74c['notes'],'periodFrom':_0x20e74c[_0x4d18ab(0xf0)],'periodTo':_0x20e74c['periodTo'],'createdAt':_0x20e74c['createdAt'],'paidAt':_0x20e74c[_0x4d18ab(0xfc)]})),'pagination':{'page':_0xff8d70,'limit':_0x2c1d39,'total':_0x4360eb,'totalPages':Math[_0x4d18ab(0x102)](_0x4360eb/_0x2c1d39)}};}async[a48_0x50653f(0x1f3)](_0xa24e79){const _0x27964c=a48_0x50653f,_0x3c9b2c=await database_1['default'][_0x27964c(0x169)][_0x27964c(0xf8)]({'where':{'id':_0xa24e79},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x3c9b2c)return null;return{'id':_0x3c9b2c['id'],'shopId':_0x3c9b2c[_0x27964c(0x275)],'shopName':_0x3c9b2c[_0x27964c(0x19e)][_0x27964c(0x188)],'shopUsername':_0x3c9b2c[_0x27964c(0x19e)][_0x27964c(0x21b)],'amount':_0x3c9b2c[_0x27964c(0x174)],'network':_0x3c9b2c[_0x27964c(0x202)],'wallet':_0x3c9b2c[_0x27964c(0x26d)],'status':_0x3c9b2c[_0x27964c(0x248)],'txid':_0x3c9b2c[_0x27964c(0x20c)],'notes':_0x3c9b2c[_0x27964c(0x1ec)],'periodFrom':_0x3c9b2c[_0x27964c(0xf0)],'periodTo':_0x3c9b2c[_0x27964c(0x1c9)],'createdAt':_0x3c9b2c[_0x27964c(0x1fe)],'paidAt':_0x3c9b2c[_0x27964c(0xfc)]};}async[a48_0x50653f(0x227)](_0x24befc){const _0x166aa7=a48_0x50653f;await database_1['default'][_0x166aa7(0x169)]['delete']({'where':{'id':_0x24befc}});}async[a48_0x50653f(0xee)](_0x54e8cc,_0x22a3b8){const _0x207598=a48_0x50653f,_0x2c86a2=await database_1[_0x207598(0x21d)]['$transaction'](async _0x1473c0=>{const _0xf1178d=_0x207598,_0x3164a3=await _0x1473c0[_0xf1178d(0x169)]['findUnique']({'where':{'id':_0x54e8cc},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}}}});if(!_0x3164a3)throw new Error('Payout\x20not\x20found');console['log'](_0xf1178d(0x237)+_0x54e8cc+_0xf1178d(0x27c)+_0x3164a3[_0xf1178d(0x19e)][_0xf1178d(0x21b)]+':'),console['log'](_0xf1178d(0x1ff)+_0x3164a3['amount'][_0xf1178d(0x17a)](0x6)+_0xf1178d(0x204)),console['log'](_0xf1178d(0x1a1)+_0x3164a3[_0xf1178d(0x202)]),console[_0xf1178d(0x143)](_0xf1178d(0x223)+_0x3164a3['shop'][_0xf1178d(0xf6)][_0xf1178d(0x17a)](0x6)+_0xf1178d(0x204)),console[_0xf1178d(0x143)](_0xf1178d(0xeb)+_0x3164a3[_0xf1178d(0x19e)][_0xf1178d(0x1f1)]['toFixed'](0x6)+_0xf1178d(0x204));let _0x252b58=0x0;if(_0x22a3b8[_0xf1178d(0x174)]!==undefined){const _0x160073=Number(_0x3164a3[_0xf1178d(0x174)]),_0xaf8d1c=Number(_0x22a3b8[_0xf1178d(0x174)]);_0x252b58=_0xaf8d1c-_0x160073,console[_0xf1178d(0x143)](_0xf1178d(0x206)+_0xaf8d1c[_0xf1178d(0x17a)](0x6)+_0xf1178d(0x204)),console[_0xf1178d(0x143)]('\x20\x20\x20Amount\x20difference:\x20'+_0x252b58[_0xf1178d(0x17a)](0x6)+_0xf1178d(0x204));if(_0x252b58<0x0)console['log'](_0xf1178d(0x270)+Math[_0xf1178d(0x164)](_0x252b58)[_0xf1178d(0x17a)](0x6)+_0xf1178d(0x1f7));else{if(_0x252b58>0x0){const _0x1427d1=Number(_0x3164a3[_0xf1178d(0x19e)][_0xf1178d(0xf6)]);console[_0xf1178d(0x143)](_0xf1178d(0x1a9)+_0x252b58[_0xf1178d(0x17a)](0x6)+_0xf1178d(0x107));if(_0x1427d1<_0x252b58)throw new Error(_0xf1178d(0x113)+_0x1427d1['toFixed'](0x6)+_0xf1178d(0x167)+_0x252b58['toFixed'](0x6)+_0xf1178d(0x204));}}}const _0x5f1aea={};if(_0x22a3b8[_0xf1178d(0x174)]!==undefined)_0x5f1aea['amount']=_0x22a3b8[_0xf1178d(0x174)];if(_0x22a3b8['network']!==undefined)_0x5f1aea[_0xf1178d(0x202)]=_0x22a3b8[_0xf1178d(0x202)];if(_0x22a3b8[_0xf1178d(0x26d)]!==undefined)_0x5f1aea[_0xf1178d(0x26d)]=_0x22a3b8[_0xf1178d(0x26d)]||null;if(_0x22a3b8[_0xf1178d(0x1ec)]!==undefined)_0x5f1aea[_0xf1178d(0x1ec)]=_0x22a3b8[_0xf1178d(0x1ec)]||null;if(_0x22a3b8['txid']!==undefined)_0x5f1aea['txid']=_0x22a3b8[_0xf1178d(0x20c)]||null;if(_0x22a3b8[_0xf1178d(0xf0)]!==undefined)_0x5f1aea[_0xf1178d(0xf0)]=_0x22a3b8[_0xf1178d(0xf0)]?new Date(_0x22a3b8[_0xf1178d(0xf0)]):null;if(_0x22a3b8['periodTo']!==undefined)_0x5f1aea[_0xf1178d(0x1c9)]=_0x22a3b8[_0xf1178d(0x1c9)]?new Date(_0x22a3b8[_0xf1178d(0x1c9)]):null;const _0x49be76=await _0x1473c0[_0xf1178d(0x169)][_0xf1178d(0x22d)]({'where':{'id':_0x54e8cc},'data':_0x5f1aea,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(_0x252b58!==0x0){const _0xe39105=Number(_0x3164a3[_0xf1178d(0x19e)]['balance']),_0x274e5c=Number(_0x3164a3[_0xf1178d(0x19e)][_0xf1178d(0x1f1)]),_0x5b3b58=_0xe39105-_0x252b58,_0x5c10b2=_0x274e5c+_0x252b58;await _0x1473c0[_0xf1178d(0x19e)][_0xf1178d(0x22d)]({'where':{'id':_0x3164a3[_0xf1178d(0x275)]},'data':{'balance':_0x5b3b58,'totalPaidOut':_0x5c10b2}}),console['log']('ðŸ’°\x20Shop\x20'+_0x3164a3['shop'][_0xf1178d(0x21b)]+'\x20balance\x20updated:'),console[_0xf1178d(0x143)]('\x20\x20\x20Balance:\x20'+_0xe39105[_0xf1178d(0x17a)](0x6)+_0xf1178d(0x27a)+_0x5b3b58[_0xf1178d(0x17a)](0x6)+'\x20USDT'),console[_0xf1178d(0x143)](_0xf1178d(0x151)+_0x274e5c[_0xf1178d(0x17a)](0x6)+'\x20->\x20'+_0x5c10b2[_0xf1178d(0x17a)](0x6)+'\x20USDT');}return console[_0xf1178d(0x143)](_0xf1178d(0x152)+_0x54e8cc+'\x20updated\x20successfully'),_0x49be76;});return{'id':_0x2c86a2['id'],'shopId':_0x2c86a2[_0x207598(0x275)],'shopName':_0x2c86a2['shop'][_0x207598(0x188)],'shopUsername':_0x2c86a2[_0x207598(0x19e)]['username'],'amount':Number(_0x2c86a2[_0x207598(0x174)]),'network':_0x2c86a2['network'],'wallet':_0x2c86a2['wallet'],'status':_0x2c86a2[_0x207598(0x248)],'txid':_0x2c86a2[_0x207598(0x20c)],'notes':_0x2c86a2[_0x207598(0x1ec)],'periodFrom':_0x2c86a2[_0x207598(0xf0)],'periodTo':_0x2c86a2[_0x207598(0x1c9)],'createdAt':_0x2c86a2['createdAt'],'paidAt':_0x2c86a2[_0x207598(0xfc)]};}async[a48_0x50653f(0x175)](_0x238541){const _0x417145=a48_0x50653f,{page:_0x41a404,limit:_0x599bc7,status:_0xb94ae3,gateway:_0x4a2dab,shopId:_0x56dfbc,dateFrom:_0x1aa7c1,dateTo:_0x4bc4d2,search:_0x590f0e,currency:_0x356b2b,sortBy:_0x3a2dac,sortOrder:_0x3c0077}=_0x238541,_0x269876=(_0x41a404-0x1)*_0x599bc7;console[_0x417145(0x143)](_0x417145(0x211),_0x238541);const _0x329c58=await database_1['default'][_0x417145(0xff)]['groupBy']({'by':[_0x417145(0x1ae)],'_count':{'gateway':!![]}});console[_0x417145(0x143)](_0x417145(0x252),_0x329c58[_0x417145(0x158)](_0x1140a2=>_0x1140a2[_0x417145(0x1ae)]+'\x20('+_0x1140a2['_count'][_0x417145(0x1ae)]+_0x417145(0x207)));if(_0x4a2dab){const _0x47d119=_0x329c58[_0x417145(0x13d)](_0x2e2a2f=>_0x2e2a2f[_0x417145(0x1ae)][_0x417145(0x1ba)]()===_0x4a2dab[_0x417145(0x1ba)]());!_0x47d119&&_0x4a2dab[_0x417145(0x1ba)]()!=='test_gateway'&&console[_0x417145(0x143)](_0x417145(0x26c)+_0x4a2dab+'\x27\x20not\x20found.\x20Available\x20gateways:\x20'+_0x329c58[_0x417145(0x158)](_0x3e6c90=>_0x3e6c90[_0x417145(0x1ae)])[_0x417145(0x134)](',\x20'));}const _0x2b4b44={};_0xb94ae3&&(_0x2b4b44[_0x417145(0x248)]=_0xb94ae3[_0x417145(0x1c5)]());if(!_0x4a2dab)_0x2b4b44[_0x417145(0x1ae)]={'not':'test_gateway'};else{if(_0x4a2dab&&(_0x4a2dab[_0x417145(0x1ba)]()==='test_gateway'||_0x4a2dab===_0x417145(0x233)))_0x2b4b44[_0x417145(0x1ae)]=_0x417145(0x27b);else{let _0x1b76fe=_0x4a2dab;const _0xd5c6ca=(0x0,gateway_1[_0x417145(0x19a)])(_0x4a2dab);if(_0xd5c6ca)_0x1b76fe=_0xd5c6ca,console['log']('ðŸ”„\x20Converted\x20gateway\x20ID\x20\x27'+_0x4a2dab+_0x417145(0xef)+_0x1b76fe+'\x27');else{const _0x51e4eb=(0x0,gateway_1[_0x417145(0x13f)])(_0x4a2dab);if(_0x51e4eb){const _0x22ed03=(0x0,gateway_1[_0x417145(0x19a)])(_0x51e4eb);_0x22ed03&&(_0x1b76fe=_0x22ed03,console[_0x417145(0x143)]('ðŸ”„\x20Converted\x20gateway\x20name\x20\x27'+_0x4a2dab+_0x417145(0x255)+_0x51e4eb+_0x417145(0x109)+_0x1b76fe+'\x27'));}else console[_0x417145(0x143)](_0x417145(0x267)+_0x4a2dab+'\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)');}const _0x44c766=await database_1[_0x417145(0x21d)]['payment'][_0x417145(0x183)]({'where':{'gateway':_0x1b76fe['toLowerCase']()},'take':0x1});_0x44c766===0x0?(console[_0x417145(0x143)]('âš ï¸\x20Gateway\x20\x27'+_0x1b76fe+_0x417145(0x14c)+_0x4a2dab+_0x417145(0x18e)),_0x2b4b44[_0x417145(0x1ae)]=_0x417145(0x196)):(_0x2b4b44[_0x417145(0x1ae)]=_0x1b76fe[_0x417145(0x1ba)](),console[_0x417145(0x143)](_0x417145(0x26a)+_0x1b76fe+_0x417145(0x14c)+_0x4a2dab+'\x27)'));}}console['log'](_0x417145(0x256),_0x2b4b44[_0x417145(0x1ae)]);_0x56dfbc&&(_0x2b4b44[_0x417145(0x275)]=_0x56dfbc);_0x356b2b&&(_0x2b4b44[_0x417145(0x261)]=_0x356b2b['toUpperCase'](),console['log'](_0x417145(0x182)+_0x356b2b[_0x417145(0x1c5)]()));if(_0x1aa7c1||_0x4bc4d2){_0x2b4b44['createdAt']={};if(_0x1aa7c1){const _0x4773c8=new Date(_0x1aa7c1),_0x3d637f=new Date(Date['UTC'](_0x4773c8[_0x417145(0x23c)](),_0x4773c8[_0x417145(0x21a)](),_0x4773c8[_0x417145(0xfd)](),0x0,0x0,0x0,0x0));_0x2b4b44[_0x417145(0x1fe)][_0x417145(0x127)]=_0x3d637f,console['log'](_0x417145(0x161)+_0x3d637f['toISOString']());}if(_0x4bc4d2){const _0x167acc=new Date(_0x4bc4d2),_0x2f325c=new Date(Date[_0x417145(0x20f)](_0x167acc[_0x417145(0x23c)](),_0x167acc[_0x417145(0x21a)](),_0x167acc[_0x417145(0xfd)](),0x17,0x3b,0x3b,0x3e7));_0x2b4b44['createdAt'][_0x417145(0xec)]=_0x2f325c,console[_0x417145(0x143)](_0x417145(0x1b7)+_0x2f325c[_0x417145(0x222)]());}}_0x590f0e&&(_0x2b4b44['OR']=[{'id':{'contains':_0x590f0e,'mode':_0x417145(0x1be)}},{'orderId':{'contains':_0x590f0e,'mode':_0x417145(0x1be)}},{'gatewayOrderId':{'contains':_0x590f0e,'mode':_0x417145(0x1be)}},{'customerEmail':{'contains':_0x590f0e,'mode':_0x417145(0x1be)}},{'shop':{'name':{'contains':_0x590f0e,'mode':_0x417145(0x1be)}}},{'shop':{'username':{'contains':_0x590f0e,'mode':'insensitive'}}}]);console[_0x417145(0x143)](_0x417145(0x23e),JSON[_0x417145(0x18a)](_0x2b4b44,null,0x2));const _0x2897bc=await database_1[_0x417145(0x21d)][_0x417145(0xff)][_0x417145(0x183)]({'where':_0x2b4b44});console[_0x417145(0x143)](_0x417145(0x193)+_0x2897bc);let _0x8fdf6a={'createdAt':'desc'};if(_0x3a2dac){const _0x22309c=[_0x417145(0x174),'createdAt',_0x417145(0x173),'status',_0x417145(0x1ae),_0x417145(0x261)],_0x3afdfd=['asc',_0x417145(0x1cc)];if(_0x22309c[_0x417145(0x269)](_0x3a2dac)){const _0x2e79c5=_0x3afdfd[_0x417145(0x269)](_0x3c0077)?_0x3c0077:_0x417145(0x1cc);_0x8fdf6a={[_0x3a2dac]:_0x2e79c5},console[_0x417145(0x143)](_0x417145(0x1bc)+_0x3a2dac+_0x417145(0x19c)+_0x2e79c5+_0x417145(0x246));}}const [_0x55e415,_0x2d837f]=await Promise[_0x417145(0x281)]([database_1[_0x417145(0x21d)][_0x417145(0xff)][_0x417145(0x1f2)]({'where':_0x2b4b44,'skip':_0x269876,'take':_0x599bc7,'orderBy':_0x8fdf6a,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x417145(0x21d)][_0x417145(0xff)]['count']({'where':_0x2b4b44})]);let _0x24864f,_0x3de860;if(_0x1aa7c1){const _0x270428=new Date(_0x1aa7c1);_0x24864f=new Date(Date[_0x417145(0x20f)](_0x270428[_0x417145(0x23c)](),_0x270428[_0x417145(0x21a)](),_0x270428['getUTCDate'](),0x0,0x0,0x0,0x0));}else{const _0x3223b3=new Date();_0x24864f=new Date(Date[_0x417145(0x20f)](_0x3223b3['getUTCFullYear'](),_0x3223b3['getUTCMonth'](),_0x3223b3[_0x417145(0xfd)](),0x0,0x0,0x0,0x0));}if(_0x4bc4d2){const _0x233331=new Date(_0x4bc4d2);_0x3de860=new Date(Date[_0x417145(0x20f)](_0x233331[_0x417145(0x23c)](),_0x233331['getUTCMonth'](),_0x233331['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}else{if(_0x1aa7c1){const _0x28fb51=new Date(_0x1aa7c1);_0x3de860=new Date(Date[_0x417145(0x20f)](_0x28fb51['getUTCFullYear'](),_0x28fb51[_0x417145(0x21a)](),_0x28fb51[_0x417145(0xfd)](),0x17,0x3b,0x3b,0x3e7));}else{const _0x5cb2b8=new Date();_0x3de860=new Date(Date[_0x417145(0x20f)](_0x5cb2b8[_0x417145(0x23c)](),_0x5cb2b8[_0x417145(0x21a)](),_0x5cb2b8[_0x417145(0xfd)](),0x17,0x3b,0x3b,0x3e7));}}const _0x5de60={'status':'PAID','createdAt':{'gte':_0x24864f,'lte':_0x3de860}};_0x4a2dab?_0x5de60[_0x417145(0x1ae)]=_0x2b4b44['gateway']:_0x5de60[_0x417145(0x1ae)]={'not':'test_gateway'};_0x56dfbc&&(_0x5de60[_0x417145(0x275)]=_0x56dfbc);_0x356b2b&&(_0x5de60[_0x417145(0x261)]=_0x356b2b[_0x417145(0x1c5)]());console[_0x417145(0x143)](_0x417145(0x200),JSON[_0x417145(0x18a)](_0x5de60,null,0x2));const _0x27cd31=await database_1[_0x417145(0x21d)][_0x417145(0xff)][_0x417145(0x1f2)]({'where':_0x5de60,'select':{'amountUSDT':!![],'currency':!![],'amount':!![]}}),_0x3357e0={};let _0x5493e1=0x0;return _0x27cd31[_0x417145(0x190)](_0x3ec6f4=>{const _0x79d60c=_0x417145;_0x3ec6f4[_0x79d60c(0x1f4)]&&(_0x5493e1+=_0x3ec6f4[_0x79d60c(0x1f4)]);if(_0x3ec6f4[_0x79d60c(0x261)]){const _0x144f8a=_0x3ec6f4['currency'][_0x79d60c(0x1c5)]();!_0x3357e0[_0x144f8a]&&(_0x3357e0[_0x144f8a]=0x0),_0x3357e0[_0x144f8a]+=_0x3ec6f4[_0x79d60c(0x174)];}}),_0x5493e1>0x0&&(_0x3357e0[_0x417145(0x1fb)]=_0x5493e1),{'payments':_0x55e415,'pagination':{'page':_0x41a404,'limit':_0x599bc7,'total':_0x2d837f,'totalPages':Math[_0x417145(0x102)](_0x2d837f/_0x599bc7)},'statistics':_0x3357e0};}async[a48_0x50653f(0x1d3)](_0x43621f){const _0x56be3a=a48_0x50653f,_0x1c1f67=await database_1['default']['payment'][_0x56be3a(0xf8)]({'where':{'id':_0x43621f},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x1c1f67)return null;return{'id':_0x1c1f67['id'],'shopId':_0x1c1f67[_0x56be3a(0x275)],'gateway':_0x1c1f67[_0x56be3a(0x1ae)],'amount':_0x1c1f67[_0x56be3a(0x174)],'currency':_0x1c1f67[_0x56be3a(0x261)],'status':_0x1c1f67['status'],'orderId':_0x1c1f67['orderId'],'gatewayOrderId':_0x1c1f67[_0x56be3a(0xf7)],'customerEmail':_0x1c1f67[_0x56be3a(0x147)],'customerName':_0x1c1f67[_0x56be3a(0x1eb)],'customerCountry':_0x1c1f67[_0x56be3a(0x185)],'customerIp':_0x1c1f67[_0x56be3a(0x153)],'customerUa':_0x1c1f67[_0x56be3a(0x199)],'failureMessage':_0x1c1f67[_0x56be3a(0x1cf)],'externalPaymentUrl':_0x1c1f67['externalPaymentUrl'],'successUrl':_0x1c1f67[_0x56be3a(0x197)],'failUrl':_0x1c1f67[_0x56be3a(0x189)],'pendingUrl':_0x1c1f67[_0x56be3a(0x106)],'whiteUrl':_0x1c1f67[_0x56be3a(0x187)],'createdAt':_0x1c1f67[_0x56be3a(0x1fe)],'updatedAt':_0x1c1f67['updatedAt'],'shop':_0x1c1f67[_0x56be3a(0x19e)]};}async['updatePaymentStatus'](_0x5ec713,_0x444dc7,_0x3a0da8,_0x36770f){const _0x3a11f2=a48_0x50653f,_0x55eb2f=await database_1[_0x3a11f2(0x21d)][_0x3a11f2(0x1ef)](async _0x48d582=>{const _0x4272b0=_0x3a11f2,_0x5d45cb=await _0x48d582[_0x4272b0(0xff)][_0x4272b0(0xf8)]({'where':{'id':_0x5ec713},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x5d45cb)throw new Error(_0x4272b0(0x1c1));const _0x36de27=_0x5d45cb[_0x4272b0(0x248)],_0x5941f1=_0x444dc7[_0x4272b0(0x1c5)]();console[_0x4272b0(0x143)](_0x4272b0(0x130)+_0x5ec713+_0x4272b0(0xf5)+_0x36de27+_0x4272b0(0x27a)+_0x5941f1),console[_0x4272b0(0x143)](_0x4272b0(0x1de)+_0x5d45cb[_0x4272b0(0x19e)][_0x4272b0(0xf6)]+_0x4272b0(0x204));const _0x441e14={'status':_0x5941f1,'updatedAt':new Date(),'statusChangedBy':_0x4272b0(0x13c),'statusChangedAt':new Date()};_0x3a0da8&&(_0x441e14['adminNotes']=_0x3a0da8);_0x5941f1==='CHARGEBACK'&&_0x36770f&&(_0x441e14['chargebackAmount']=_0x36770f);let _0x2b57bf=0x0,_0xc4ce75=_0x5d45cb[_0x4272b0(0x19e)][_0x4272b0(0xf6)];if(_0x5941f1===_0x4272b0(0x1d0)&&_0x36de27!==_0x4272b0(0x1d0)){_0x441e14[_0x4272b0(0xfc)]=new Date();const _0x44376b=await currencyService_1[_0x4272b0(0x171)][_0x4272b0(0x24b)](_0x5d45cb[_0x4272b0(0x174)],_0x5d45cb[_0x4272b0(0x261)]);_0x441e14[_0x4272b0(0x1f4)]=_0x44376b;let _0x10fb91=0x2d;const _0x42cb5b=await _0x48d582[_0x4272b0(0x19e)][_0x4272b0(0xf8)]({'where':{'id':_0x5d45cb[_0x4272b0(0x275)]},'select':{'gatewaySettings':!![]}});if(_0x42cb5b?.[_0x4272b0(0x146)])try{const _0x1ee44d=JSON[_0x4272b0(0x251)](_0x42cb5b[_0x4272b0(0x146)]);for(const [_0x503455,_0x1d3165]of Object[_0x4272b0(0x1f8)](_0x1ee44d)){if(_0x503455['toLowerCase']()===_0x5d45cb[_0x4272b0(0x1ae)][_0x4272b0(0x1ba)]()){_0x10fb91=_0x1d3165[_0x4272b0(0x17b)]||0xa;break;}}}catch(_0x2bae2e){console[_0x4272b0(0x145)](_0x4272b0(0x280)+_0x5ec713+':',_0x2bae2e);}let _0x2e769a;_0x5d45cb[_0x4272b0(0x157)]!==null&&_0x5d45cb['amountAfterGatewayCommissionUSDT']!==undefined?(_0x2e769a=_0x5d45cb[_0x4272b0(0x157)],console[_0x4272b0(0x143)](_0x4272b0(0x192)+_0x2e769a['toFixed'](0x6)+_0x4272b0(0x1c7)+_0x5ec713)):(_0x2e769a=_0x44376b*(0x1-_0x10fb91/0x64),console[_0x4272b0(0x143)](_0x4272b0(0x201)+_0x5ec713+':\x20'+_0x10fb91+_0x4272b0(0x179)+_0x44376b[_0x4272b0(0x17a)](0x6)+_0x4272b0(0x204)),_0x441e14[_0x4272b0(0x157)]=_0x2e769a,_0x441e14[_0x4272b0(0x119)]=_0x10fb91),_0x2b57bf=_0x2e769a,_0xc4ce75+=_0x2e769a,console[_0x4272b0(0x143)]('ðŸ’°\x20Payment\x20'+_0x5ec713+'\x20became\x20PAID:'),console[_0x4272b0(0x143)](_0x4272b0(0x16c)+_0x44376b[_0x4272b0(0x17a)](0x6)+_0x4272b0(0x204)),console[_0x4272b0(0x143)]('\x20\x20\x20Gateway:\x20'+_0x5d45cb['gateway']+',\x20Commission:\x20'+_0x10fb91+'%'),console[_0x4272b0(0x143)](_0x4272b0(0x205)+_0x2e769a[_0x4272b0(0x17a)](0x6)+_0x4272b0(0x1b5)+_0x10fb91+_0x4272b0(0x141)),console[_0x4272b0(0x143)](_0x4272b0(0x264)+_0x2e769a['toFixed'](0x6)+'\x20USDT');}else{if(_0x36de27===_0x4272b0(0x1d0)&&_0x5941f1!==_0x4272b0(0x1d0)&&_0x5941f1!=='CHARGEBACK'){if(_0x5d45cb[_0x4272b0(0x1f4)]){let _0x1b04f2=0x2d;const _0x5a111b=await _0x48d582['shop'][_0x4272b0(0xf8)]({'where':{'id':_0x5d45cb['shopId']},'select':{'gatewaySettings':!![]}});if(_0x5a111b?.[_0x4272b0(0x146)])try{const _0x1a9bbe=JSON[_0x4272b0(0x251)](_0x5a111b[_0x4272b0(0x146)]);for(const [_0x269224,_0x290b84]of Object['entries'](_0x1a9bbe)){if(_0x269224['toLowerCase']()===_0x5d45cb['gateway'][_0x4272b0(0x1ba)]()){_0x1b04f2=_0x290b84[_0x4272b0(0x17b)]||0xa;break;}}}catch(_0x533943){console[_0x4272b0(0x145)](_0x4272b0(0x280)+_0x5ec713+':',_0x533943);}const _0x5e41a9=_0x5d45cb[_0x4272b0(0x1f4)]*(0x1-_0x1b04f2/0x64);_0x2b57bf=-_0x5e41a9,_0xc4ce75-=_0x5e41a9,console[_0x4272b0(0x143)](_0x4272b0(0x16c)+_0x5d45cb[_0x4272b0(0x1f4)]['toFixed'](0x6)+_0x4272b0(0x204)),console[_0x4272b0(0x143)](_0x4272b0(0x154)+_0x5d45cb[_0x4272b0(0x1ae)]+_0x4272b0(0x22c)+_0x1b04f2+'%'),console[_0x4272b0(0x143)]('\x20\x20\x20Merchant\x20loses:\x20'+_0x5e41a9[_0x4272b0(0x17a)](0x6)+'\x20USDT\x20(after\x20'+_0x1b04f2+_0x4272b0(0x141)),console[_0x4272b0(0x143)](_0x4272b0(0x1b9)+_0x5e41a9['toFixed'](0x6)+'\x20USDT');}}}_0x5941f1===_0x4272b0(0x186)&&(console[_0x4272b0(0x143)](_0x4272b0(0x18d)),_0x36770f&&_0x36770f>0x0?(_0x2b57bf=-_0x36770f,_0xc4ce75-=_0x36770f,console[_0x4272b0(0x143)]('ðŸ’¸\x20CHARGEBACK\x20penalty\x20ONLY:\x20-'+_0x36770f[_0x4272b0(0x17a)](0x6)+_0x4272b0(0x142)),console[_0x4272b0(0x143)](_0x4272b0(0x1dc))):console[_0x4272b0(0x143)]('âš ï¸\x20CHARGEBACK\x20without\x20penalty\x20amount\x20-\x20no\x20balance\x20change'),_0x441e14[_0x4272b0(0x236)]=_0x36770f||0x0);_0x5941f1===_0x4272b0(0x160)&&_0x36de27==='PAID'&&console[_0x4272b0(0x143)](_0x4272b0(0x238));const _0x11eda2=await _0x48d582[_0x4272b0(0xff)][_0x4272b0(0x22d)]({'where':{'id':_0x5ec713},'data':_0x441e14,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x2b57bf!==0x0&&(await _0x48d582['shop'][_0x4272b0(0x22d)]({'where':{'id':_0x5d45cb[_0x4272b0(0x275)]},'data':{'balance':_0xc4ce75}}),console[_0x4272b0(0x143)](_0x4272b0(0x25a)+_0x5d45cb[_0x4272b0(0x275)]+_0x4272b0(0x118)+_0x5d45cb[_0x4272b0(0x19e)][_0x4272b0(0xf6)][_0x4272b0(0x17a)](0x6)+_0x4272b0(0x27a)+_0xc4ce75['toFixed'](0x6)+_0x4272b0(0x1a8)+(_0x2b57bf>0x0?'+':'')+_0x2b57bf[_0x4272b0(0x17a)](0x6)+')')),_0x11eda2;});return{'id':_0x55eb2f['id'],'shopId':_0x55eb2f[_0x3a11f2(0x275)],'gateway':_0x55eb2f[_0x3a11f2(0x1ae)],'amount':_0x55eb2f['amount'],'currency':_0x55eb2f[_0x3a11f2(0x261)],'status':_0x55eb2f[_0x3a11f2(0x248)],'orderId':_0x55eb2f[_0x3a11f2(0x208)],'gatewayOrderId':_0x55eb2f[_0x3a11f2(0xf7)],'customerEmail':_0x55eb2f[_0x3a11f2(0x147)],'customerName':_0x55eb2f[_0x3a11f2(0x1eb)],'customerCountry':_0x55eb2f[_0x3a11f2(0x185)],'customerIp':_0x55eb2f[_0x3a11f2(0x153)],'customerUa':_0x55eb2f['customerUa'],'failureMessage':_0x55eb2f[_0x3a11f2(0x1cf)],'adminNotes':_0x55eb2f['adminNotes'],'chargebackAmount':_0x55eb2f['chargebackAmount'],'statusChangedBy':_0x55eb2f['statusChangedBy'],'statusChangedAt':_0x55eb2f[_0x3a11f2(0x1ac)],'createdAt':_0x55eb2f[_0x3a11f2(0x1fe)],'updatedAt':_0x55eb2f[_0x3a11f2(0x173)],'shop':_0x55eb2f['shop']};}async[a48_0x50653f(0x249)](_0x148d43,_0x18091e){const _0x2c3a36=a48_0x50653f,_0x40171c=Math[_0x2c3a36(0x136)]()[_0x2c3a36(0x277)](0x24)[_0x2c3a36(0x25d)](0x2,0x9);console[_0x2c3a36(0x143)]('ðŸŽ¯\x20updateUser\x20called\x20with\x20ID:\x20'+_0x40171c+_0x2c3a36(0xf1)+_0x148d43);const _0x341653={..._0x18091e};_0x18091e[_0x2c3a36(0xfb)]&&_0x18091e[_0x2c3a36(0xfb)][_0x2c3a36(0x245)]()!==''?(console[_0x2c3a36(0x143)](_0x2c3a36(0x25c)+_0x40171c+']\x20Updating\x20password\x20for\x20user\x20'+_0x148d43),_0x341653[_0x2c3a36(0xfb)]=await bcryptjs_1[_0x2c3a36(0x21d)][_0x2c3a36(0x1e5)](_0x18091e[_0x2c3a36(0xfb)],0xc)):(console[_0x2c3a36(0x143)](_0x2c3a36(0x25c)+_0x40171c+']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update'),delete _0x341653[_0x2c3a36(0xfb)]);_0x18091e[_0x2c3a36(0x288)]&&(_0x341653[_0x2c3a36(0x188)]=_0x18091e['fullName'],delete _0x341653[_0x2c3a36(0x288)]);_0x18091e[_0x2c3a36(0x212)]&&(_0x341653[_0x2c3a36(0x215)]=_0x18091e['telegramId'],delete _0x341653['telegramId']);_0x18091e['merchantUrl']&&(_0x341653[_0x2c3a36(0x203)]=_0x18091e[_0x2c3a36(0x13b)],delete _0x341653[_0x2c3a36(0x13b)]);if(_0x18091e[_0x2c3a36(0x220)]){const _0x500efb=_0x18091e[_0x2c3a36(0x220)][_0x2c3a36(0x158)](_0x3cf2d9=>this[_0x2c3a36(0x21e)](_0x3cf2d9));console['log'](_0x2c3a36(0x225),_0x18091e['gateways'],'->',_0x500efb),_0x341653[_0x2c3a36(0x22e)]=JSON['stringify'](_0x500efb),delete _0x341653[_0x2c3a36(0x220)];}_0x18091e[_0x2c3a36(0x146)]&&(console['log']('ðŸ”§\x20['+_0x40171c+']\x20Gateway\x20settings\x20before\x20saving:',_0x18091e[_0x2c3a36(0x146)]),_0x341653[_0x2c3a36(0x146)]=JSON[_0x2c3a36(0x18a)](_0x18091e[_0x2c3a36(0x146)]),console[_0x2c3a36(0x143)]('ðŸ”§\x20['+_0x40171c+']\x20Gateway\x20settings\x20JSON\x20string:',_0x341653[_0x2c3a36(0x146)]));_0x18091e['wallets']&&(_0x18091e[_0x2c3a36(0x1a2)][_0x2c3a36(0x17f)]!==undefined&&(_0x341653[_0x2c3a36(0x17f)]=_0x18091e['wallets'][_0x2c3a36(0x17f)]||null),_0x18091e[_0x2c3a36(0x1a2)][_0x2c3a36(0x195)]!==undefined&&(_0x341653[_0x2c3a36(0x195)]=_0x18091e[_0x2c3a36(0x1a2)]['usdtTrcWallet']||null),_0x18091e[_0x2c3a36(0x1a2)][_0x2c3a36(0x26e)]!==undefined&&(_0x341653[_0x2c3a36(0x26e)]=_0x18091e[_0x2c3a36(0x1a2)]['usdtErcWallet']||null),_0x18091e['wallets'][_0x2c3a36(0x1ca)]!==undefined&&(_0x341653['usdcPolygonWallet']=_0x18091e['wallets'][_0x2c3a36(0x1ca)]||null),delete _0x341653['wallets']);const _0x1b294d=await database_1[_0x2c3a36(0x21d)]['shop'][_0x2c3a36(0x22d)]({'where':{'id':_0x148d43},'data':_0x341653,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console[_0x2c3a36(0x143)](_0x2c3a36(0x19d)+_0x40171c+_0x2c3a36(0x13a),_0x1b294d['gatewaySettings']),{'id':_0x1b294d['id'],'fullName':_0x1b294d['name'],'username':_0x1b294d[_0x2c3a36(0x21b)],'telegramId':_0x1b294d[_0x2c3a36(0x215)],'merchantUrl':_0x1b294d['shopUrl'],'gateways':_0x1b294d[_0x2c3a36(0x22e)]?JSON[_0x2c3a36(0x251)](_0x1b294d[_0x2c3a36(0x22e)]):null,'gatewaySettings':_0x1b294d['gatewaySettings']?JSON[_0x2c3a36(0x251)](_0x1b294d[_0x2c3a36(0x146)]):null,'publicKey':_0x1b294d[_0x2c3a36(0x20a)],'wallets':{'usdtPolygonWallet':_0x1b294d[_0x2c3a36(0x17f)],'usdtTrcWallet':_0x1b294d['usdtTrcWallet'],'usdtErcWallet':_0x1b294d[_0x2c3a36(0x26e)],'usdcPolygonWallet':_0x1b294d[_0x2c3a36(0x1ca)]},'status':_0x1b294d[_0x2c3a36(0x248)],'createdAt':_0x1b294d[_0x2c3a36(0x1fe)]};}async[a48_0x50653f(0x218)](_0x92fed1){const _0x135e09=a48_0x50653f,_0x3088f4=await database_1[_0x135e09(0x21d)][_0x135e09(0x19e)][_0x135e09(0x22d)]({'where':{'id':_0x92fed1},'data':{'status':'SUSPENDED'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x3088f4['id'],'fullName':_0x3088f4[_0x135e09(0x188)],'username':_0x3088f4['username'],'telegramId':_0x3088f4[_0x135e09(0x215)],'merchantUrl':_0x3088f4[_0x135e09(0x203)],'gateways':_0x3088f4[_0x135e09(0x22e)]?JSON[_0x135e09(0x251)](_0x3088f4[_0x135e09(0x22e)]):null,'gatewaySettings':_0x3088f4[_0x135e09(0x146)]?JSON['parse'](_0x3088f4['gatewaySettings']):null,'publicKey':_0x3088f4[_0x135e09(0x20a)],'wallets':{'usdtPolygonWallet':_0x3088f4[_0x135e09(0x17f)],'usdtTrcWallet':_0x3088f4[_0x135e09(0x195)],'usdtErcWallet':_0x3088f4[_0x135e09(0x26e)],'usdcPolygonWallet':_0x3088f4['usdcPolygonWallet']},'status':_0x3088f4[_0x135e09(0x248)],'createdAt':_0x3088f4[_0x135e09(0x1fe)]};}async['activateUser'](_0x3de378){const _0x2bb2af=a48_0x50653f,_0x77128e=await database_1[_0x2bb2af(0x21d)]['shop'][_0x2bb2af(0x22d)]({'where':{'id':_0x3de378},'data':{'status':_0x2bb2af(0x1bb)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x77128e['id'],'fullName':_0x77128e[_0x2bb2af(0x188)],'username':_0x77128e['username'],'telegramId':_0x77128e[_0x2bb2af(0x215)],'merchantUrl':_0x77128e['shopUrl'],'gateways':_0x77128e[_0x2bb2af(0x22e)]?JSON[_0x2bb2af(0x251)](_0x77128e[_0x2bb2af(0x22e)]):null,'gatewaySettings':_0x77128e[_0x2bb2af(0x146)]?JSON[_0x2bb2af(0x251)](_0x77128e[_0x2bb2af(0x146)]):null,'publicKey':_0x77128e['publicKey'],'wallets':{'usdtPolygonWallet':_0x77128e[_0x2bb2af(0x17f)],'usdtTrcWallet':_0x77128e[_0x2bb2af(0x195)],'usdtErcWallet':_0x77128e['usdtErcWallet'],'usdcPolygonWallet':_0x77128e['usdcPolygonWallet']},'status':_0x77128e[_0x2bb2af(0x248)],'createdAt':_0x77128e[_0x2bb2af(0x1fe)]};}async[a48_0x50653f(0x170)](_0x401890){const _0x3c485a=a48_0x50653f,{page:_0x4a18b9,limit:_0x15bb13,status:_0x1b319}=_0x401890,_0x3c6580=(_0x4a18b9-0x1)*_0x15bb13,_0xb3ead9={};_0x1b319&&(_0xb3ead9[_0x3c485a(0x248)]=_0x1b319[_0x3c485a(0x1c5)]());const [_0x321971,_0xa8728e]=await Promise[_0x3c485a(0x281)]([database_1[_0x3c485a(0x21d)][_0x3c485a(0x19e)]['findMany']({'where':_0xb3ead9,'skip':_0x3c6580,'take':_0x15bb13,'orderBy':{'createdAt':_0x3c485a(0x1cc)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'twoFactorEnabled':!![],'createdAt':!![]}}),database_1[_0x3c485a(0x21d)][_0x3c485a(0x19e)][_0x3c485a(0x183)]({'where':_0xb3ead9})]);return{'users':_0x321971[_0x3c485a(0x158)](_0x3d2558=>{const _0x3b0160=_0x3c485a,_0x4d0267=_0x3d2558[_0x3b0160(0x22e)]?JSON[_0x3b0160(0x251)](_0x3d2558[_0x3b0160(0x22e)]):null,_0x271c34=_0x4d0267?_0x4d0267[_0x3b0160(0x158)](_0x36a8ba=>this[_0x3b0160(0x19f)](_0x36a8ba)):null;return{'id':_0x3d2558['id'],'fullName':_0x3d2558[_0x3b0160(0x188)],'username':_0x3d2558[_0x3b0160(0x21b)],'telegramId':_0x3d2558[_0x3b0160(0x215)],'merchantUrl':_0x3d2558['shopUrl'],'gateways':_0x271c34,'gatewaySettings':_0x3d2558[_0x3b0160(0x146)]?JSON[_0x3b0160(0x251)](_0x3d2558[_0x3b0160(0x146)]):null,'publicKey':_0x3d2558[_0x3b0160(0x20a)],'wallets':{'usdtPolygonWallet':_0x3d2558[_0x3b0160(0x17f)],'usdtTrcWallet':_0x3d2558[_0x3b0160(0x195)],'usdtErcWallet':_0x3d2558['usdtErcWallet'],'usdcPolygonWallet':_0x3d2558[_0x3b0160(0x1ca)],'usdcErcWallet':_0x3d2558[_0x3b0160(0x257)]},'status':_0x3d2558[_0x3b0160(0x248)],'twoFactorEnabled':_0x3d2558[_0x3b0160(0x135)]||![],'createdAt':_0x3d2558[_0x3b0160(0x1fe)]};}),'pagination':{'page':_0x4a18b9,'limit':_0x15bb13,'total':_0xa8728e,'totalPages':Math[_0x3c485a(0x102)](_0xa8728e/_0x15bb13)}};}async[a48_0x50653f(0x1d7)](_0x2bd42){const _0x39b218=a48_0x50653f,_0x31e8f7=await database_1[_0x39b218(0x21d)]['shop'][_0x39b218(0xf8)]({'where':{'id':_0x2bd42},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x31e8f7)return null;const _0x36ec7e=_0x31e8f7['paymentGateways']?JSON['parse'](_0x31e8f7[_0x39b218(0x22e)]):null,_0x86f783=_0x36ec7e?_0x36ec7e[_0x39b218(0x158)](_0x2e6e61=>this[_0x39b218(0x19f)](_0x2e6e61)):null;return _0x36ec7e&&_0x86f783&&console[_0x39b218(0x143)](_0x39b218(0xf3),_0x36ec7e,'->',_0x86f783),{'id':_0x31e8f7['id'],'fullName':_0x31e8f7[_0x39b218(0x188)],'username':_0x31e8f7[_0x39b218(0x21b)],'telegramId':_0x31e8f7[_0x39b218(0x215)],'merchantUrl':_0x31e8f7[_0x39b218(0x203)],'gateways':_0x86f783,'gatewaySettings':_0x31e8f7[_0x39b218(0x146)]?JSON[_0x39b218(0x251)](_0x31e8f7[_0x39b218(0x146)]):null,'publicKey':_0x31e8f7[_0x39b218(0x20a)],'wallets':{'usdtPolygonWallet':_0x31e8f7[_0x39b218(0x17f)],'usdtTrcWallet':_0x31e8f7[_0x39b218(0x195)],'usdtErcWallet':_0x31e8f7['usdtErcWallet'],'usdcPolygonWallet':_0x31e8f7[_0x39b218(0x1ca)],'usdcErcWallet':_0x31e8f7[_0x39b218(0x257)]},'status':_0x31e8f7['status'],'createdAt':_0x31e8f7[_0x39b218(0x1fe)]};}async[a48_0x50653f(0x110)](_0x2dfdde){const _0x544340=a48_0x50653f,{fullName:_0x1d9458,username:_0x3b92bd,password:_0x48d9d,telegramId:_0x39d5ab,merchantUrl:_0xf71a3b,gateways:_0x3db27f,gatewaySettings:_0x52c344,wallets:_0x42db56}=_0x2dfdde,_0x165a5f=await database_1[_0x544340(0x21d)]['shop'][_0x544340(0xf8)]({'where':{'username':_0x3b92bd}});if(_0x165a5f)throw new Error(_0x544340(0x15a));if(_0x39d5ab){const _0x1882d9=await database_1[_0x544340(0x21d)][_0x544340(0x19e)][_0x544340(0xf8)]({'where':{'telegram':_0x39d5ab}});if(_0x1882d9)throw new Error(_0x544340(0x1ab));}const _0x399023=await bcryptjs_1['default'][_0x544340(0x1e5)](_0x48d9d,0xc),_0x34cd1f='pk_'+crypto_1[_0x544340(0x21d)][_0x544340(0x219)](0x20)[_0x544340(0x277)](_0x544340(0x104)),_0x19b511=_0x544340(0xf2)+crypto_1[_0x544340(0x21d)][_0x544340(0x219)](0x20)['toString']('hex'),_0x4c5355=_0x3db27f?_0x3db27f['map'](_0xab932d=>this['getGatewayInternalName'](_0xab932d)):null;_0x3db27f&&_0x4c5355&&console['log'](_0x544340(0x262),_0x3db27f,'->',_0x4c5355);const _0x2314c6=await database_1['default'][_0x544340(0x19e)][_0x544340(0x20d)]({'data':{'name':_0x1d9458,'username':_0x3b92bd,'password':_0x399023,'telegram':_0x39d5ab,'shopUrl':_0xf71a3b,'paymentGateways':_0x4c5355?JSON[_0x544340(0x18a)](_0x4c5355):null,'gatewaySettings':_0x52c344?JSON[_0x544340(0x18a)](_0x52c344):null,'usdtPolygonWallet':_0x42db56?.[_0x544340(0x17f)]||null,'usdtTrcWallet':_0x42db56?.[_0x544340(0x195)]||null,'usdtErcWallet':_0x42db56?.['usdtErcWallet']||null,'usdcPolygonWallet':_0x42db56?.[_0x544340(0x1ca)]||null,'publicKey':_0x34cd1f,'secretKey':_0x19b511,'status':_0x544340(0x1bb)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2314c6['id'],'fullName':_0x2314c6[_0x544340(0x188)],'username':_0x2314c6[_0x544340(0x21b)],'telegramId':_0x2314c6[_0x544340(0x215)],'merchantUrl':_0x2314c6[_0x544340(0x203)],'gateways':_0x2314c6['paymentGateways']?JSON[_0x544340(0x251)](_0x2314c6[_0x544340(0x22e)]):null,'gatewaySettings':_0x2314c6[_0x544340(0x146)]?JSON[_0x544340(0x251)](_0x2314c6['gatewaySettings']):null,'publicKey':_0x2314c6[_0x544340(0x20a)],'wallets':{'usdtPolygonWallet':_0x2314c6[_0x544340(0x17f)],'usdtTrcWallet':_0x2314c6[_0x544340(0x195)],'usdtErcWallet':_0x2314c6['usdtErcWallet'],'usdcPolygonWallet':_0x2314c6[_0x544340(0x1ca)]},'status':_0x2314c6[_0x544340(0x248)],'createdAt':_0x2314c6[_0x544340(0x1fe)]};}async[a48_0x50653f(0x11e)](_0x2e041e){const _0x26fd88=a48_0x50653f;await database_1[_0x26fd88(0x21d)][_0x26fd88(0x19e)][_0x26fd88(0x287)]({'where':{'id':_0x2e041e}});}async[a48_0x50653f(0x23b)](_0x15318e){const _0x5a577c=a48_0x50653f,_0x1c274b=await database_1[_0x5a577c(0x21d)][_0x5a577c(0x19e)][_0x5a577c(0xf8)]({'where':{'id':_0x15318e},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});if(!_0x1c274b)throw new Error(_0x5a577c(0x284));return{'usdtPolygonWallet':_0x1c274b[_0x5a577c(0x17f)],'usdtTrcWallet':_0x1c274b[_0x5a577c(0x195)],'usdtErcWallet':_0x1c274b[_0x5a577c(0x26e)],'usdcPolygonWallet':_0x1c274b[_0x5a577c(0x1ca)],'usdcErcWallet':_0x1c274b['usdcErcWallet']};}[a48_0x50653f(0x24f)](_0x5639dc=0x8){const _0x5cb317=a48_0x50653f,_0x1d52d5=[];for(let _0x43dc17=0x0;_0x43dc17<_0x5639dc;_0x43dc17++){const _0x2e17cb=crypto_1['default'][_0x5cb317(0x219)](0x4)[_0x5cb317(0x277)](_0x5cb317(0x104))[_0x5cb317(0x1c5)]();_0x1d52d5[_0x5cb317(0x1b6)](_0x2e17cb);}return _0x1d52d5;}async[a48_0x50653f(0x27d)](_0x3ac056){const _0x5a10e8=a48_0x50653f,_0x4fb768=await database_1[_0x5a10e8(0x21d)][_0x5a10e8(0x19e)]['findUnique']({'where':{'id':_0x3ac056},'select':{'id':!![],'name':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x4fb768)throw new Error('Shop\x20not\x20found');const _0xa5aa9a=speakeasy_1['default'][_0x5a10e8(0x26b)]({'name':'TrapaPay\x20('+_0x4fb768[_0x5a10e8(0x21b)]+')','issuer':_0x5a10e8(0x14e),'length':0x20}),_0x50bb3e=await qrcode_1['default'][_0x5a10e8(0x1e7)](_0xa5aa9a[_0x5a10e8(0x15d)]),_0x397838=this[_0x5a10e8(0x24f)](0x8),_0x38042c=await Promise[_0x5a10e8(0x281)](_0x397838[_0x5a10e8(0x158)](_0x483dec=>bcryptjs_1['default'][_0x5a10e8(0x1e5)](_0x483dec,0xa)));return await database_1[_0x5a10e8(0x21d)]['shop']['update']({'where':{'id':_0x3ac056},'data':{'twoFactorSecret':_0xa5aa9a[_0x5a10e8(0x14d)],'backupCodes':JSON[_0x5a10e8(0x18a)](_0x38042c)}}),console[_0x5a10e8(0x143)](_0x5a10e8(0x18b)+_0x4fb768[_0x5a10e8(0x21b)]),console['log']('ðŸ”‘\x20Generated\x20'+_0x397838['length']+_0x5a10e8(0x10a)),{'secret':_0xa5aa9a[_0x5a10e8(0x14d)],'qrCode':_0x50bb3e,'manualEntryKey':_0xa5aa9a[_0x5a10e8(0x14d)],'backupCodes':_0x397838};}async[a48_0x50653f(0x226)](_0x58cb3e,_0xd33775){const _0x129249=a48_0x50653f,_0xa28dfc=await database_1[_0x129249(0x21d)][_0x129249(0x19e)]['findUnique']({'where':{'id':_0x58cb3e},'select':{'id':!![],'username':!![],'twoFactorSecret':!![],'twoFactorEnabled':!![]}});if(!_0xa28dfc)throw new Error(_0x129249(0x284));if(!_0xa28dfc[_0x129249(0x131)])throw new Error(_0x129249(0x129));if(_0xa28dfc[_0x129249(0x135)])throw new Error(_0x129249(0x117));const _0xec9cec=speakeasy_1['default'][_0x129249(0x1e1)][_0x129249(0x1f5)]({'secret':_0xa28dfc['twoFactorSecret'],'encoding':'base32','token':_0xd33775,'window':0x2});if(!_0xec9cec)throw new Error(_0x129249(0x17d));return await database_1[_0x129249(0x21d)][_0x129249(0x19e)][_0x129249(0x22d)]({'where':{'id':_0x58cb3e},'data':{'twoFactorEnabled':!![]}}),console[_0x129249(0x143)](_0x129249(0x22b)+_0xa28dfc[_0x129249(0x21b)]),{'enabled':!![]};}async[a48_0x50653f(0x122)](_0x16376d){const _0x167169=a48_0x50653f,_0x27a3b7=await database_1[_0x167169(0x21d)][_0x167169(0x19e)][_0x167169(0xf8)]({'where':{'id':_0x16376d},'select':{'id':!![],'username':!![],'twoFactorEnabled':!![]}});if(!_0x27a3b7)throw new Error(_0x167169(0x284));await database_1[_0x167169(0x21d)][_0x167169(0x19e)][_0x167169(0x22d)]({'where':{'id':_0x16376d},'data':{'twoFactorEnabled':![],'twoFactorSecret':null,'backupCodes':null}}),console[_0x167169(0x143)](_0x167169(0x100)+_0x27a3b7[_0x167169(0x21b)]);}[a48_0x50653f(0x1a4)](_0x2f0613,_0x100c14,_0x21bc15){const _0x119752=a48_0x50653f,_0x4367e3=new Map(),_0x51808d=new Date(_0x100c14);while(_0x51808d<=_0x21bc15){const _0x4fa52b=_0x51808d[_0x119752(0x222)]()[_0x119752(0x12a)]('T')[0x0];_0x4367e3['set'](_0x4fa52b,{'revenue':0x0,'count':0x0}),_0x51808d[_0x119752(0x10f)](_0x51808d[_0x119752(0x172)]()+0x1);}for(const _0x128860 of _0x2f0613){const _0x1286f5=_0x128860[_0x119752(0x1fe)][_0x119752(0x222)]()[_0x119752(0x12a)]('T')[0x0],_0x504730=_0x4367e3[_0x119752(0x17c)](_0x1286f5);_0x504730&&(_0x504730[_0x119752(0x183)]+=0x1,_0x128860[_0x119752(0x248)]==='PAID'&&(_0x128860[_0x119752(0x1f4)]?_0x504730['revenue']+=_0x128860[_0x119752(0x1f4)]:console[_0x119752(0x143)]('âš ï¸\x20Payment\x20'+_0x128860['id']+_0x119752(0x1ce))));}const _0x302ca2=[],_0x28443b=[];for(const [_0x4633de,_0x2572e3]of _0x4367e3){_0x302ca2['push']({'date':_0x4633de,'amount':Math['round'](_0x2572e3[_0x119752(0x10d)]*0x64)/0x64}),_0x28443b[_0x119752(0x1b6)]({'date':_0x4633de,'count':_0x2572e3[_0x119752(0x183)]});}return{'dailyRevenue':_0x302ca2,'dailyPayments':_0x28443b};}}exports['AdminService']=AdminService;