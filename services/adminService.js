'use strict';function a33_0x1354(){const _0x4ee8a0=['successUrl','amountIsEditable','\x20payments\x20as\x20paid\x20for\x20period\x20','toUpperCase','Error\x20parsing\x20gateway\x20settings\x20for\x20merchant:','minAmount','gatewayPaymentId','username','notes','qrUrl','paymentsCount','AdminService','adminNotes','updateCustomerData','all','4533000BYdnrh','round','getPaymentById','search','slice','getGatewayDisplayName','toString','updateMany','commissionRates','usdtPolygonWallet','createUser','getAllUsers','Rapyd','137220IwRTMd','90d','periodFrom','__importDefault','activateUser','customerCountry','Noda','generateDailyData','successfulPayments','PENDING','crypto','KLYME\x20EU','defineProperty','ceil','gateways','SUSPENDED','totalAmountAfterCommissionUSDT','customerIp','PAID','rapydCustomer','failureMessage','page','updateUser','language','KLYME\x20GB','parse','remitterIban','convertToUSDT','push','getUserById','amountAfterCommissionUSDT','hash','bankId','\x20payments\x20for\x20analysis','periodTo','paymentMethod','bcryptjs','status','COMPLETED','getMerchantsAwaitingPayout','ðŸ“Š\x20Found\x20','amountUSDT','deletePayout','aggregate','getMerchantStatistics','fullName','currencyService','findMany','paidAt','totalAmountUSDT','year','2020-01-01','ðŸ”„\x20Updating\x20customer\x20data\x20for\x20payment\x20','values','network','ACTIVE','payout','txid','suspendUser','sk_','update','calculateTotalRevenue','remitterName','randomBytes','calculateTotalPayoutAmount','count','split','delete','176gvQSxS','shopId','shop','failUrl','usdtErcWallet','usdcPolygonWallet','expiresAt','customerEmail','12816200fMdlDr','commissionUSDT','statusChangedBy','turnoverUSDT','stringify','amount','Period\x20start\x20date\x20must\x20be\x20before\x20end\x20date','updatedAt','limit','dateFrom','createdAt','1271090azuBDz','Period\x20end\x20date\x20cannot\x20be\x20in\x20the\x20future','name','30d','ðŸ“Š\x20Getting\x20merchant\x20statistics\x20with\x20filters:','lte','gateway','getAllPayouts','\x20USDT\x20via\x20','externalPaymentUrl','customerUa','insensitive','ðŸ“Š\x20Merchant\x20statistics\x20calculated:','entries','qrCode','month','\x20-\x20','invoiceTotalSum','txUrls','hex','findUnique','cardLast4','whiteUrl','pendingUrl','Shop\x20not\x20found','payments','merchantEarningsUSDT','215698AHQWsp','admin','totalTurnover','ðŸ’°\x20Merchants\x20awaiting\x20payout\x20summary:','payment','133reIWPL','4HIjBBg','country','usage','commission','error','desc','period','shopUrl','Error\x20parsing\x20gateway\x20settings:','\x20for\x20shop\x20','ðŸ“Š\x20Period:\x20','statusChangedAt','getPayoutById','maxPayments','length','toISOString','totalPayments','__esModule','4203756OQPRjp','getAllPayments','merchantEarnings','log','orderId','gatewayOrderId','week','telegramId','setDate','usdtTrcWallet','deleteUser','paymentGateways','publicKey','gte','default','calculateTotalPayouts','reduce','calculateCompletedPayoutAmount','telegram','createPayout','ðŸ’°\x20Creating\x20payout\x20for\x20period:\x20','ðŸ’°\x20Marked\x20','password','âœ…\x20Customer\x20data\x20updated\x20for\x20payment\x20','currency','create','getTime','CoinToPay','sourceCurrency','ðŸ’°\x20Found\x20','chargebackAmount','map','wallets','_sum','KLYME\x20DE','CHARGEBACK','gatewaySettings','13449CjOXIg','merchantPaid','\x20merchants\x20with\x20unpaid\x20payments','customerName','merchantUrl'];a33_0x1354=function(){return _0x4ee8a0;};return a33_0x1354();}const a33_0x3230bc=a33_0x201c;(function(_0x5d99a8,_0x334e41){const _0x4a7cbc=a33_0x201c,_0x23c75c=_0x5d99a8();while(!![]){try{const _0x1a958c=-parseInt(_0x4a7cbc(0xfc))/0x1*(-parseInt(_0x4a7cbc(0x102))/0x2)+parseInt(_0x4a7cbc(0x139))/0x3*(-parseInt(_0x4a7cbc(0xce))/0x4)+parseInt(_0x4a7cbc(0xe1))/0x5+parseInt(_0x4a7cbc(0x15a))/0x6*(-parseInt(_0x4a7cbc(0x101))/0x7)+-parseInt(_0x4a7cbc(0x14d))/0x8+-parseInt(_0x4a7cbc(0x114))/0x9+parseInt(_0x4a7cbc(0xd6))/0xa;if(_0x1a958c===_0x334e41)break;else _0x23c75c['push'](_0x23c75c['shift']());}catch(_0xfb0ba){_0x23c75c['push'](_0x23c75c['shift']());}}}(a33_0x1354,0x49aaf));function a33_0x201c(_0x1ee860,_0x199490){const _0x13547e=a33_0x1354();return a33_0x201c=function(_0x201cbe,_0x26f982){_0x201cbe=_0x201cbe-0xb9;let _0x5e9722=_0x13547e[_0x201cbe];return _0x5e9722;},a33_0x201c(_0x1ee860,_0x199490);}var __importDefault=this&&this[a33_0x3230bc(0x15d)]||function(_0x34e000){const _0x46565f=a33_0x3230bc;return _0x34e000&&_0x34e000[_0x46565f(0x113)]?_0x34e000:{'default':_0x34e000};};Object[a33_0x3230bc(0x166)](exports,a33_0x3230bc(0x113),{'value':!![]}),exports[a33_0x3230bc(0x149)]=void 0x0;const database_1=__importDefault(require('../config/database')),currencyService_1=require('./currencyService'),bcryptjs_1=__importDefault(require(a33_0x3230bc(0x17e))),crypto_1=__importDefault(require(a33_0x3230bc(0x164)));class AdminService{async['getSystemStatistics'](_0xbe6b2a){const _0x5c4c55=a33_0x3230bc,_0x32380b=new Date();let _0x15a2e7;switch(_0xbe6b2a){case'7d':_0x15a2e7=new Date(_0x32380b[_0x5c4c55(0x12e)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x5c4c55(0xe4):_0x15a2e7=new Date(_0x32380b[_0x5c4c55(0x12e)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x5c4c55(0x15b):_0x15a2e7=new Date(_0x32380b[_0x5c4c55(0x12e)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case'1y':_0x15a2e7=new Date(_0x32380b[_0x5c4c55(0x12e)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;default:_0x15a2e7=new Date(_0x32380b[_0x5c4c55(0x12e)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x3ccfd0,_0x347053,_0x3aebb4,_0x38b15d,_0x58b476,_0x559c61,_0x7674d0]=await Promise[_0x5c4c55(0x14c)]([database_1[_0x5c4c55(0x122)][_0x5c4c55(0xd0)]['count'](),database_1[_0x5c4c55(0x122)][_0x5c4c55(0xd0)][_0x5c4c55(0xcb)]({'where':{'status':'ACTIVE'}}),database_1[_0x5c4c55(0x122)]['payment'][_0x5c4c55(0xcb)]({'where':{'createdAt':{'gte':_0x15a2e7}}}),database_1[_0x5c4c55(0x122)][_0x5c4c55(0x100)]['count']({'where':{'status':_0x5c4c55(0x16c),'createdAt':{'gte':_0x15a2e7}}}),this[_0x5c4c55(0xc7)](_0x15a2e7),this[_0x5c4c55(0x123)](_0x15a2e7),database_1[_0x5c4c55(0x122)]['payment'][_0x5c4c55(0xb9)]({'take':0xa,'orderBy':{'createdAt':_0x5c4c55(0x107)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}})]),_0x45282e=_0x3aebb4>0x0?_0x38b15d/_0x3aebb4*0x64:0x0;return{'overview':{'totalShops':_0x3ccfd0,'activeShops':_0x347053,'totalPayments':_0x3aebb4,'successfulPayments':_0x38b15d,'conversionRate':Math['round'](_0x45282e*0x64)/0x64,'totalRevenue':Math[_0x5c4c55(0x14e)](_0x58b476*0x64)/0x64,'totalPayouts':Math[_0x5c4c55(0x14e)](_0x559c61*0x64)/0x64},'recentPayments':_0x7674d0[_0x5c4c55(0x133)](_0x1392ba=>({'id':_0x1392ba['id'],'amount':_0x1392ba['amount'],'currency':_0x1392ba[_0x5c4c55(0x12c)],'status':_0x1392ba[_0x5c4c55(0x17f)],'gateway':_0x1392ba[_0x5c4c55(0xe7)],'shop':_0x1392ba[_0x5c4c55(0xd0)],'createdAt':_0x1392ba[_0x5c4c55(0xe0)]}))};}async[a33_0x3230bc(0x186)](_0x335726){const _0x5770dd=a33_0x3230bc;console[_0x5770dd(0x117)](_0x5770dd(0xe5),_0x335726);const _0x3567ef=new Date();let _0x15ed71,_0x293b70=_0x3567ef;if(_0x335726[_0x5770dd(0x108)]==='custom'&&_0x335726['dateFrom']&&_0x335726['dateTo'])_0x15ed71=new Date(_0x335726[_0x5770dd(0xdf)]),_0x293b70=new Date(_0x335726['dateTo']);else switch(_0x335726[_0x5770dd(0x108)]){case _0x5770dd(0x11a):_0x15ed71=new Date(_0x3567ef['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x5770dd(0xf0):_0x15ed71=new Date(_0x3567ef['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x5770dd(0xbc):_0x15ed71=new Date(_0x3567ef[_0x5770dd(0x12e)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x5770dd(0x14c):default:_0x15ed71=new Date(_0x5770dd(0xbd));break;}console[_0x5770dd(0x117)](_0x5770dd(0x10c)+_0x15ed71[_0x5770dd(0x111)]()+_0x5770dd(0xf1)+_0x293b70['toISOString']());const _0x2dc352={'createdAt':{'gte':_0x15ed71,'lte':_0x293b70}};_0x335726[_0x5770dd(0xcf)]&&(_0x2dc352[_0x5770dd(0xcf)]=_0x335726[_0x5770dd(0xcf)]);const _0x13785b=await database_1[_0x5770dd(0x122)]['payment']['findMany']({'where':_0x2dc352,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x5770dd(0x117)](_0x5770dd(0x182)+_0x13785b[_0x5770dd(0x110)]+_0x5770dd(0x17b));let _0x59f506=0x0,_0x2a8e63=0x0,_0x195f53=0x0,_0x58d799=0x0,_0x1d1db5=_0x13785b[_0x5770dd(0x110)],_0x5e0567=0x0;const _0x2aff6c={},_0x7fb7ac={};for(const _0x22f321 of _0x13785b){if(_0x22f321['status']===_0x5770dd(0x16c)){_0x5e0567++;const _0x4ab3e6=await currencyService_1[_0x5770dd(0x188)][_0x5770dd(0x175)](_0x22f321[_0x5770dd(0xdb)],_0x22f321[_0x5770dd(0x12c)]);_0x59f506+=_0x4ab3e6;let _0x200209=0xa;if(_0x22f321[_0x5770dd(0xd0)][_0x5770dd(0x138)])try{const _0x3bf2d8=JSON[_0x5770dd(0x173)](_0x22f321['shop'][_0x5770dd(0x138)]),_0x34ce26=this[_0x5770dd(0x152)](_0x22f321[_0x5770dd(0xe7)]);_0x3bf2d8[_0x34ce26]?.[_0x5770dd(0x105)]!==undefined&&(_0x200209=_0x3bf2d8[_0x34ce26][_0x5770dd(0x105)]);}catch(_0x260b31){console[_0x5770dd(0x106)](_0x5770dd(0x10a),_0x260b31);}const _0x57f5ed=_0x4ab3e6*(_0x200209/0x64),_0x427d13=_0x4ab3e6-_0x57f5ed;_0x2a8e63+=_0x427d13,_0x195f53+=_0x57f5ed,!_0x2aff6c[_0x22f321[_0x5770dd(0xe7)]]&&(_0x2aff6c[_0x22f321[_0x5770dd(0xe7)]]={'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'commissionRates':[]}),_0x2aff6c[_0x22f321[_0x5770dd(0xe7)]][_0x5770dd(0x148)]++,_0x2aff6c[_0x22f321[_0x5770dd(0xe7)]][_0x5770dd(0xd9)]+=_0x4ab3e6,_0x2aff6c[_0x22f321['gateway']]['commissionUSDT']+=_0x57f5ed,_0x2aff6c[_0x22f321[_0x5770dd(0xe7)]]['merchantEarningsUSDT']+=_0x427d13,_0x2aff6c[_0x22f321[_0x5770dd(0xe7)]][_0x5770dd(0x155)][_0x5770dd(0x176)](_0x200209),!_0x335726['shopId']&&(!_0x7fb7ac[_0x22f321[_0x5770dd(0xcf)]]&&(_0x7fb7ac[_0x22f321[_0x5770dd(0xcf)]]={'shopId':_0x22f321[_0x5770dd(0xcf)],'shopName':_0x22f321[_0x5770dd(0xd0)]['name'],'shopUsername':_0x22f321[_0x5770dd(0xd0)][_0x5770dd(0x145)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0}),_0x7fb7ac[_0x22f321[_0x5770dd(0xcf)]][_0x5770dd(0x148)]++,_0x7fb7ac[_0x22f321[_0x5770dd(0xcf)]][_0x5770dd(0xd9)]+=_0x4ab3e6,_0x7fb7ac[_0x22f321[_0x5770dd(0xcf)]][_0x5770dd(0xd7)]+=_0x57f5ed,_0x7fb7ac[_0x22f321[_0x5770dd(0xcf)]][_0x5770dd(0xfb)]+=_0x427d13);}}const _0x511946={'createdAt':{'gte':_0x15ed71,'lte':_0x293b70}};_0x335726[_0x5770dd(0xcf)]&&(_0x511946[_0x5770dd(0xcf)]=_0x335726['shopId']);const _0x46a62f=await database_1[_0x5770dd(0x122)][_0x5770dd(0xc2)][_0x5770dd(0xb9)]({'where':_0x511946});for(const _0xbfc85b of _0x46a62f){_0x58d799+=_0xbfc85b[_0x5770dd(0xdb)];}const _0x31a6ae=_0x5e0567>0x0?_0x59f506/_0x5e0567:0x0,_0x5aa6e9=_0x1d1db5>0x0?_0x5e0567/_0x1d1db5*0x64:0x0,_0x521c6e=Object[_0x5770dd(0xee)](_0x2aff6c)['map'](([_0x58a754,_0xd2a6d4])=>({'gateway':_0x58a754,'gatewayDisplayName':this[_0x5770dd(0x152)](_0x58a754),'paymentsCount':_0xd2a6d4['paymentsCount'],'turnoverUSDT':Math['round'](_0xd2a6d4[_0x5770dd(0xd9)]*0x64)/0x64,'commissionUSDT':Math[_0x5770dd(0x14e)](_0xd2a6d4[_0x5770dd(0xd7)]*0x64)/0x64,'merchantEarningsUSDT':Math['round'](_0xd2a6d4[_0x5770dd(0xfb)]*0x64)/0x64,'averageCommissionRate':_0xd2a6d4['commissionRates'][_0x5770dd(0x110)]>0x0?Math[_0x5770dd(0x14e)](_0xd2a6d4[_0x5770dd(0x155)][_0x5770dd(0x124)]((_0x596812,_0x187419)=>_0x596812+_0x187419,0x0)/_0xd2a6d4[_0x5770dd(0x155)][_0x5770dd(0x110)]*0x64)/0x64:0xa}));let _0x3373a9;!_0x335726[_0x5770dd(0xcf)]&&(_0x3373a9=Object[_0x5770dd(0xbf)](_0x7fb7ac)[_0x5770dd(0x133)](_0x40da18=>{const _0x2c4254=_0x5770dd,_0x29028b=_0x46a62f['filter'](_0x2e7fea=>_0x2e7fea[_0x2c4254(0xcf)]===_0x40da18[_0x2c4254(0xcf)]),_0x574a38=_0x29028b[_0x2c4254(0x124)]((_0x5ddcc6,_0x52628c)=>_0x5ddcc6+_0x52628c[_0x2c4254(0xdb)],0x0);return{..._0x40da18,'turnoverUSDT':Math[_0x2c4254(0x14e)](_0x40da18[_0x2c4254(0xd9)]*0x64)/0x64,'commissionUSDT':Math[_0x2c4254(0x14e)](_0x40da18[_0x2c4254(0xd7)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x2c4254(0x14e)](_0x40da18[_0x2c4254(0xfb)]*0x64)/0x64,'paidOutUSDT':Math['round'](_0x574a38*0x64)/0x64,'averageCheckUSDT':_0x40da18[_0x2c4254(0x148)]>0x0?Math[_0x2c4254(0x14e)](_0x40da18['turnoverUSDT']/_0x40da18[_0x2c4254(0x148)]*0x64)/0x64:0x0};}));const _0x30419f=await this[_0x5770dd(0x161)](_0x15ed71,_0x293b70,_0x335726[_0x5770dd(0xcf)]),_0x3775e2={'totalTurnover':Math['round'](_0x59f506*0x64)/0x64,'merchantEarnings':Math['round'](_0x2a8e63*0x64)/0x64,'gatewayEarnings':Math[_0x5770dd(0x14e)](_0x195f53*0x64)/0x64,'totalPaidOut':Math['round'](_0x58d799*0x64)/0x64,'averageCheck':Math['round'](_0x31a6ae*0x64)/0x64,'totalPayments':_0x1d1db5,'successfulPayments':_0x5e0567,'conversionRate':Math[_0x5770dd(0x14e)](_0x5aa6e9*0x64)/0x64,'gatewayBreakdown':_0x521c6e,'merchantBreakdown':_0x3373a9,'dailyData':_0x30419f,'periodInfo':{'from':_0x15ed71,'to':_0x293b70,'periodType':_0x335726[_0x5770dd(0x108)]||_0x5770dd(0xf0),'daysCount':Math['ceil']((_0x293b70[_0x5770dd(0x12e)]()-_0x15ed71[_0x5770dd(0x12e)]())/(0x3e8*0x3c*0x3c*0x18))}};return console[_0x5770dd(0x117)](_0x5770dd(0xed),{'totalTurnover':_0x3775e2[_0x5770dd(0xfe)],'merchantEarnings':_0x3775e2[_0x5770dd(0x116)],'gatewayEarnings':_0x3775e2['gatewayEarnings'],'totalPayments':_0x3775e2[_0x5770dd(0x112)],'successfulPayments':_0x3775e2[_0x5770dd(0x162)]}),_0x3775e2;}async[a33_0x3230bc(0x161)](_0x193eb1,_0x4dda24,_0x12fdce){const _0x2e1dfa=a33_0x3230bc,_0x125701=[],_0x119872=new Date(_0x193eb1);while(_0x119872<=_0x4dda24){const _0xe8c1db=new Date(_0x119872),_0x6fe9f=new Date(_0x119872);_0x6fe9f['setHours'](0x17,0x3b,0x3b,0x3e7);const _0x229858={'createdAt':{'gte':_0xe8c1db,'lte':_0x6fe9f},'status':_0x2e1dfa(0x16c)};_0x12fdce&&(_0x229858[_0x2e1dfa(0xcf)]=_0x12fdce);const _0x15336f=await database_1['default']['payment']['findMany']({'where':_0x229858,'include':{'shop':{'select':{'gatewaySettings':!![]}}}});let _0x50845a=0x0,_0x1d039f=0x0,_0x28dd8e=0x0;for(const _0x6a0a10 of _0x15336f){const _0x4ca749=await currencyService_1[_0x2e1dfa(0x188)][_0x2e1dfa(0x175)](_0x6a0a10['amount'],_0x6a0a10[_0x2e1dfa(0x12c)]);_0x50845a+=_0x4ca749;let _0x9fea4c=0xa;if(_0x6a0a10[_0x2e1dfa(0xd0)]['gatewaySettings'])try{const _0x524a30=JSON[_0x2e1dfa(0x173)](_0x6a0a10[_0x2e1dfa(0xd0)][_0x2e1dfa(0x138)]),_0x1bc004=this['getGatewayDisplayName'](_0x6a0a10[_0x2e1dfa(0xe7)]);_0x524a30[_0x1bc004]?.['commission']!==undefined&&(_0x9fea4c=_0x524a30[_0x1bc004][_0x2e1dfa(0x105)]);}catch(_0x28fed1){}const _0x5c7c5a=_0x4ca749*(_0x9fea4c/0x64),_0x4ee32b=_0x4ca749-_0x5c7c5a;_0x1d039f+=_0x4ee32b,_0x28dd8e+=_0x5c7c5a;}_0x125701[_0x2e1dfa(0x176)]({'date':_0x119872[_0x2e1dfa(0x111)]()[_0x2e1dfa(0xcc)]('T')[0x0],'turnover':Math[_0x2e1dfa(0x14e)](_0x50845a*0x64)/0x64,'merchantEarnings':Math['round'](_0x1d039f*0x64)/0x64,'gatewayEarnings':Math[_0x2e1dfa(0x14e)](_0x28dd8e*0x64)/0x64,'paymentsCount':_0x15336f[_0x2e1dfa(0x110)]}),_0x119872[_0x2e1dfa(0x11c)](_0x119872['getDate']()+0x1);}return _0x125701;}['getGatewayDisplayName'](_0x24f735){const _0x567f93=a33_0x3230bc,_0x3d1088={'plisio':'Plisio','rapyd':_0x567f93(0x159),'noda':_0x567f93(0x160),'cointopay':_0x567f93(0x12f),'klyme_eu':_0x567f93(0x165),'klyme_gb':_0x567f93(0x172),'klyme_de':_0x567f93(0x136)};return _0x3d1088[_0x24f735]||_0x24f735;}async['getPayoutStats'](){const _0x53bec6=a33_0x3230bc,[_0x3377b5,_0x2d3958,_0x525bd5,_0x2e6577,_0x5ca4c5]=await Promise[_0x53bec6(0x14c)]([database_1[_0x53bec6(0x122)][_0x53bec6(0xc2)][_0x53bec6(0xcb)](),database_1[_0x53bec6(0x122)]['payout'][_0x53bec6(0xcb)]({'where':{'status':_0x53bec6(0x180)}}),database_1['default']['payout'][_0x53bec6(0xcb)]({'where':{'status':_0x53bec6(0x163)}}),this['calculateTotalPayoutAmount'](),this[_0x53bec6(0x125)]()]);return{'totalPayouts':_0x3377b5,'completedPayouts':_0x2d3958,'pendingPayouts':_0x525bd5,'rejectedPayouts':_0x3377b5-_0x2d3958-_0x525bd5,'totalAmount':Math[_0x53bec6(0x14e)](_0x2e6577*0x64)/0x64,'completedAmount':Math[_0x53bec6(0x14e)](_0x5ca4c5*0x64)/0x64,'pendingAmount':Math['round']((_0x2e6577-_0x5ca4c5)*0x64)/0x64};}async[a33_0x3230bc(0x181)](_0x55a8f2){const _0x457176=a33_0x3230bc;console[_0x457176(0x117)]('ðŸ’°\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:',_0x55a8f2);const _0x2bda00=await database_1[_0x457176(0x122)][_0x457176(0xd0)][_0x457176(0xb9)]({'where':{'payments':{'some':{'status':_0x457176(0x16c),'merchantPaid':![],'paidAt':{'not':null}}},..._0x55a8f2[_0x457176(0x150)]?{'OR':[{'name':{'contains':_0x55a8f2[_0x457176(0x150)],'mode':_0x457176(0xec)}},{'username':{'contains':_0x55a8f2[_0x457176(0x150)],'mode':_0x457176(0xec)}}]}:{}},'include':{'payments':{'where':{'status':_0x457176(0x16c),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'createdAt':!![]}}}});console[_0x457176(0x117)](_0x457176(0x131)+_0x2bda00[_0x457176(0x110)]+_0x457176(0x13b));const _0x5d2ac0=[];for(const _0x494d4b of _0x2bda00){let _0x4448c7=0x0,_0x5f2f35=0x0;const _0x3124da={};let _0x141c5e={};if(_0x494d4b[_0x457176(0x138)])try{_0x141c5e=JSON['parse'](_0x494d4b['gatewaySettings']);}catch(_0x1af54c){console[_0x457176(0x106)](_0x457176(0x142),_0x494d4b[_0x457176(0x145)],_0x1af54c);}let _0x1fa62c=new Date();for(const _0x54a25b of _0x494d4b[_0x457176(0xfa)]){const _0x2b4520=await currencyService_1['currencyService']['convertToUSDT'](_0x54a25b[_0x457176(0xdb)],_0x54a25b[_0x457176(0x12c)]);_0x4448c7+=_0x2b4520;const _0x55c711=this[_0x457176(0x152)](_0x54a25b[_0x457176(0xe7)]);let _0x29883c=0xa;_0x141c5e[_0x55c711]?.['commission']!==undefined&&(_0x29883c=_0x141c5e[_0x55c711][_0x457176(0x105)]);const _0xc28377=_0x2b4520*(0x1-_0x29883c/0x64);_0x5f2f35+=_0xc28377,!_0x3124da[_0x54a25b[_0x457176(0xe7)]]&&(_0x3124da[_0x54a25b[_0x457176(0xe7)]]={'count':0x0,'amountUSDT':0x0,'amountAfterCommissionUSDT':0x0,'commission':_0x29883c}),_0x3124da[_0x54a25b[_0x457176(0xe7)]][_0x457176(0xcb)]++,_0x3124da[_0x54a25b[_0x457176(0xe7)]]['amountUSDT']+=_0x2b4520,_0x3124da[_0x54a25b[_0x457176(0xe7)]][_0x457176(0x178)]+=_0xc28377,_0x54a25b[_0x457176(0xba)]&&_0x54a25b[_0x457176(0xba)]<_0x1fa62c&&(_0x1fa62c=_0x54a25b[_0x457176(0xba)]);}if(_0x55a8f2[_0x457176(0x143)]&&_0x5f2f35<_0x55a8f2[_0x457176(0x143)])continue;_0x5d2ac0[_0x457176(0x176)]({'id':_0x494d4b['id'],'fullName':_0x494d4b['name'],'username':_0x494d4b['username'],'telegramId':_0x494d4b[_0x457176(0x126)],'merchantUrl':_0x494d4b[_0x457176(0x109)],'wallets':{'usdtPolygonWallet':_0x494d4b['usdtPolygonWallet'],'usdtTrcWallet':_0x494d4b[_0x457176(0x11d)],'usdtErcWallet':_0x494d4b[_0x457176(0xd2)],'usdcPolygonWallet':_0x494d4b[_0x457176(0xd3)]},'totalAmountUSDT':Math['round'](_0x4448c7*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x457176(0x14e)](_0x5f2f35*0x64)/0x64,'paymentsCount':_0x494d4b[_0x457176(0xfa)][_0x457176(0x110)],'oldestPaymentDate':_0x1fa62c,'gatewayBreakdown':Object[_0x457176(0xee)](_0x3124da)['map'](([_0x103e7b,_0x1f8877])=>({'gateway':_0x103e7b,'count':_0x1f8877[_0x457176(0xcb)],'amountUSDT':Math['round'](_0x1f8877[_0x457176(0x183)]*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x457176(0x14e)](_0x1f8877[_0x457176(0x178)]*0x64)/0x64,'commission':_0x1f8877[_0x457176(0x105)]}))});}_0x5d2ac0['sort']((_0x432a55,_0x5adf87)=>_0x5adf87[_0x457176(0x16a)]-_0x432a55['totalAmountAfterCommissionUSDT']);const _0x435a75=_0x5d2ac0[_0x457176(0x110)],_0x1ab6e5=(_0x55a8f2['page']-0x1)*_0x55a8f2[_0x457176(0xde)],_0x10354d=_0x5d2ac0[_0x457176(0x151)](_0x1ab6e5,_0x1ab6e5+_0x55a8f2[_0x457176(0xde)]),_0x312046={'totalMerchants':_0x435a75,'totalAmountUSDT':Math[_0x457176(0x14e)](_0x5d2ac0[_0x457176(0x124)]((_0x32babd,_0x4eaaaa)=>_0x32babd+_0x4eaaaa[_0x457176(0xbb)],0x0)*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x457176(0x14e)](_0x5d2ac0[_0x457176(0x124)]((_0x2f5270,_0x1673e1)=>_0x2f5270+_0x1673e1[_0x457176(0x16a)],0x0)*0x64)/0x64};return console[_0x457176(0x117)](_0x457176(0xff),_0x312046),{'merchants':_0x10354d,'pagination':{'page':_0x55a8f2[_0x457176(0x16f)],'limit':_0x55a8f2[_0x457176(0xde)],'total':_0x435a75,'totalPages':Math['ceil'](_0x435a75/_0x55a8f2[_0x457176(0xde)])},'summary':_0x312046};}async[a33_0x3230bc(0x127)](_0x23bbcb){const _0x43df0f=a33_0x3230bc,{shopId:_0x16e527,amount:_0x370e75,network:_0x5746a5,notes:_0x34af6a,periodFrom:_0x1cd24c,periodTo:_0x5f599d}=_0x23bbcb,_0x507564=await database_1[_0x43df0f(0x122)][_0x43df0f(0xd0)][_0x43df0f(0xf5)]({'where':{'id':_0x16e527},'select':{'id':!![],'name':!![],'username':!![]}});if(!_0x507564)throw new Error(_0x43df0f(0xf9));let _0x4fc621,_0x23791b;if(_0x1cd24c&&_0x5f599d){_0x4fc621=new Date(_0x1cd24c),_0x23791b=new Date(_0x5f599d);if(_0x4fc621>=_0x23791b)throw new Error(_0x43df0f(0xdc));if(_0x23791b>new Date())throw new Error(_0x43df0f(0xe2));console[_0x43df0f(0x117)](_0x43df0f(0x128)+_0x4fc621[_0x43df0f(0x111)]()+_0x43df0f(0xf1)+_0x23791b['toISOString']());}const _0x48187f=await database_1[_0x43df0f(0x122)]['payout'][_0x43df0f(0x12d)]({'data':{'shopId':_0x16e527,'amount':_0x370e75,'network':_0x5746a5,'status':'COMPLETED','notes':_0x34af6a,'periodFrom':_0x4fc621,'periodTo':_0x23791b,'paidAt':new Date()}});console['log']('ðŸ’°\x20Payout\x20created:\x20'+_0x48187f['id']+_0x43df0f(0x10b)+_0x507564[_0x43df0f(0x145)]+'\x20('+_0x370e75+_0x43df0f(0xe9)+_0x5746a5+')');if(_0x4fc621&&_0x23791b){const _0x1c6f29=await database_1[_0x43df0f(0x122)]['payment'][_0x43df0f(0x154)]({'where':{'shopId':_0x16e527,'status':_0x43df0f(0x16c),'merchantPaid':![],'paidAt':{'gte':_0x4fc621,'lte':_0x23791b}},'data':{'merchantPaid':!![]}});console[_0x43df0f(0x117)](_0x43df0f(0x129)+_0x1c6f29[_0x43df0f(0xcb)]+_0x43df0f(0x140)+_0x4fc621['toISOString']()+'\x20-\x20'+_0x23791b[_0x43df0f(0x111)]());}return{'id':_0x48187f['id'],'shopId':_0x48187f[_0x43df0f(0xcf)],'shopName':_0x507564[_0x43df0f(0xe3)],'shopUsername':_0x507564[_0x43df0f(0x145)],'amount':_0x48187f[_0x43df0f(0xdb)],'network':_0x48187f[_0x43df0f(0xc0)],'status':_0x48187f[_0x43df0f(0x17f)],'txid':_0x48187f[_0x43df0f(0xc3)],'notes':_0x48187f[_0x43df0f(0x146)],'periodFrom':_0x48187f['periodFrom'],'periodTo':_0x48187f[_0x43df0f(0x17c)],'createdAt':_0x48187f['createdAt'],'paidAt':_0x48187f[_0x43df0f(0xba)]};}async[a33_0x3230bc(0xe8)](_0x313dc3){const _0x734952=a33_0x3230bc,{page:_0x4cb8f0,limit:_0x246948,shopId:_0x27f11b,network:_0x59a5f5,dateFrom:_0x304ec3,dateTo:_0x3023dc,search:_0x5928e0}=_0x313dc3,_0x25bbbf=(_0x4cb8f0-0x1)*_0x246948,_0x3149e9={};_0x27f11b&&(_0x3149e9[_0x734952(0xcf)]=_0x27f11b);_0x59a5f5&&(_0x3149e9[_0x734952(0xc0)]=_0x59a5f5);(_0x304ec3||_0x3023dc)&&(_0x3149e9['createdAt']={},_0x304ec3&&(_0x3149e9[_0x734952(0xe0)][_0x734952(0x121)]=new Date(_0x304ec3)),_0x3023dc&&(_0x3149e9[_0x734952(0xe0)][_0x734952(0xe6)]=new Date(_0x3023dc)));_0x5928e0&&(_0x3149e9['OR']=[{'shop':{'name':{'contains':_0x5928e0,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x5928e0,'mode':'insensitive'}}},{'notes':{'contains':_0x5928e0,'mode':_0x734952(0xec)}},{'txid':{'contains':_0x5928e0,'mode':_0x734952(0xec)}}]);const [_0x4f47a1,_0x10d8f0]=await Promise[_0x734952(0x14c)]([database_1[_0x734952(0x122)][_0x734952(0xc2)]['findMany']({'where':_0x3149e9,'skip':_0x25bbbf,'take':_0x246948,'orderBy':{'createdAt':_0x734952(0x107)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x734952(0x122)][_0x734952(0xc2)]['count']({'where':_0x3149e9})]);return{'payouts':_0x4f47a1[_0x734952(0x133)](_0x1595df=>({'id':_0x1595df['id'],'shopId':_0x1595df['shopId'],'shopName':_0x1595df[_0x734952(0xd0)]['name'],'shopUsername':_0x1595df[_0x734952(0xd0)][_0x734952(0x145)],'amount':_0x1595df[_0x734952(0xdb)],'network':_0x1595df[_0x734952(0xc0)],'status':_0x1595df[_0x734952(0x17f)],'txid':_0x1595df['txid'],'notes':_0x1595df[_0x734952(0x146)],'periodFrom':_0x1595df[_0x734952(0x15c)],'periodTo':_0x1595df[_0x734952(0x17c)],'createdAt':_0x1595df[_0x734952(0xe0)],'paidAt':_0x1595df['paidAt']})),'pagination':{'page':_0x4cb8f0,'limit':_0x246948,'total':_0x10d8f0,'totalPages':Math[_0x734952(0x167)](_0x10d8f0/_0x246948)}};}async[a33_0x3230bc(0x10e)](_0x4827c8){const _0x29134b=a33_0x3230bc,_0x46df5b=await database_1[_0x29134b(0x122)]['payout'][_0x29134b(0xf5)]({'where':{'id':_0x4827c8},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x46df5b)return null;return{'id':_0x46df5b['id'],'shopId':_0x46df5b[_0x29134b(0xcf)],'shopName':_0x46df5b[_0x29134b(0xd0)]['name'],'shopUsername':_0x46df5b[_0x29134b(0xd0)]['username'],'amount':_0x46df5b['amount'],'network':_0x46df5b[_0x29134b(0xc0)],'status':_0x46df5b[_0x29134b(0x17f)],'txid':_0x46df5b[_0x29134b(0xc3)],'notes':_0x46df5b[_0x29134b(0x146)],'periodFrom':_0x46df5b['periodFrom'],'periodTo':_0x46df5b[_0x29134b(0x17c)],'createdAt':_0x46df5b['createdAt'],'paidAt':_0x46df5b['paidAt']};}async[a33_0x3230bc(0x184)](_0x95d779){const _0x17550c=a33_0x3230bc;await database_1[_0x17550c(0x122)]['payout'][_0x17550c(0xcd)]({'where':{'id':_0x95d779}});}async[a33_0x3230bc(0x115)](_0x242957){const _0x1a48ca=a33_0x3230bc,{page:_0x58760f,limit:_0x3f52d5,status:_0x1d8860,gateway:_0x41ee5a,shopId:_0x19de56,dateFrom:_0x2cb3e9,dateTo:_0x4fecb2,search:_0x15f5f4}=_0x242957,_0x3b7970=(_0x58760f-0x1)*_0x3f52d5,_0x2f4ad0={};_0x1d8860&&(_0x2f4ad0[_0x1a48ca(0x17f)]=_0x1d8860[_0x1a48ca(0x141)]());_0x41ee5a&&(_0x2f4ad0[_0x1a48ca(0xe7)]=_0x41ee5a);_0x19de56&&(_0x2f4ad0[_0x1a48ca(0xcf)]=_0x19de56);(_0x2cb3e9||_0x4fecb2)&&(_0x2f4ad0[_0x1a48ca(0xe0)]={},_0x2cb3e9&&(_0x2f4ad0['createdAt'][_0x1a48ca(0x121)]=new Date(_0x2cb3e9)),_0x4fecb2&&(_0x2f4ad0[_0x1a48ca(0xe0)][_0x1a48ca(0xe6)]=new Date(_0x4fecb2)));_0x15f5f4&&(_0x2f4ad0['OR']=[{'id':{'contains':_0x15f5f4,'mode':_0x1a48ca(0xec)}},{'orderId':{'contains':_0x15f5f4,'mode':'insensitive'}},{'gatewayOrderId':{'contains':_0x15f5f4,'mode':_0x1a48ca(0xec)}},{'gatewayPaymentId':{'contains':_0x15f5f4,'mode':'insensitive'}},{'customerEmail':{'contains':_0x15f5f4,'mode':_0x1a48ca(0xec)}},{'customerName':{'contains':_0x15f5f4,'mode':_0x1a48ca(0xec)}},{'shop':{'name':{'contains':_0x15f5f4,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x15f5f4,'mode':_0x1a48ca(0xec)}}}]);const [_0x1f7222,_0x4e92c7]=await Promise[_0x1a48ca(0x14c)]([database_1[_0x1a48ca(0x122)][_0x1a48ca(0x100)][_0x1a48ca(0xb9)]({'where':_0x2f4ad0,'skip':_0x3b7970,'take':_0x3f52d5,'orderBy':{'createdAt':'desc'},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x1a48ca(0x100)][_0x1a48ca(0xcb)]({'where':_0x2f4ad0})]);return{'payments':_0x1f7222['map'](_0x52301b=>({'id':_0x52301b['id'],'shopId':_0x52301b['shopId'],'gateway':_0x52301b[_0x1a48ca(0xe7)],'amount':_0x52301b[_0x1a48ca(0xdb)],'currency':_0x52301b[_0x1a48ca(0x12c)],'sourceCurrency':_0x52301b[_0x1a48ca(0x130)],'usage':_0x52301b[_0x1a48ca(0x104)],'status':_0x52301b['status'],'externalPaymentUrl':_0x52301b[_0x1a48ca(0xea)],'successUrl':_0x52301b[_0x1a48ca(0x13e)],'failUrl':_0x52301b[_0x1a48ca(0xd1)],'pendingUrl':_0x52301b[_0x1a48ca(0xf8)],'whiteUrl':_0x52301b['whiteUrl'],'expiresAt':_0x52301b[_0x1a48ca(0xd4)],'orderId':_0x52301b[_0x1a48ca(0x118)],'gatewayOrderId':_0x52301b[_0x1a48ca(0x119)],'gatewayPaymentId':_0x52301b[_0x1a48ca(0x144)],'customerEmail':_0x52301b[_0x1a48ca(0xd5)],'customerName':_0x52301b[_0x1a48ca(0x13c)],'customerCountry':_0x52301b[_0x1a48ca(0x15f)],'customerIp':_0x52301b[_0x1a48ca(0x16b)],'customerUa':_0x52301b[_0x1a48ca(0xeb)],'invoiceTotalSum':_0x52301b[_0x1a48ca(0xf2)],'qrCode':_0x52301b[_0x1a48ca(0xef)],'qrUrl':_0x52301b[_0x1a48ca(0x147)],'txUrls':_0x52301b[_0x1a48ca(0xf3)],'country':_0x52301b[_0x1a48ca(0x103)],'language':_0x52301b[_0x1a48ca(0x171)],'amountIsEditable':_0x52301b[_0x1a48ca(0x13f)],'maxPayments':_0x52301b['maxPayments'],'rapydCustomer':_0x52301b[_0x1a48ca(0x16d)],'cardLast4':_0x52301b[_0x1a48ca(0xf6)],'paymentMethod':_0x52301b['paymentMethod'],'bankId':_0x52301b[_0x1a48ca(0x17a)],'remitterIban':_0x52301b[_0x1a48ca(0x174)],'remitterName':_0x52301b[_0x1a48ca(0xc8)],'paidAt':_0x52301b[_0x1a48ca(0xba)],'merchantPaid':_0x52301b['merchantPaid'],'chargebackAmount':_0x52301b[_0x1a48ca(0x132)],'adminNotes':_0x52301b[_0x1a48ca(0x14a)],'statusChangedBy':_0x52301b['statusChangedBy'],'statusChangedAt':_0x52301b[_0x1a48ca(0x10d)],'failureMessage':_0x52301b[_0x1a48ca(0x16e)],'createdAt':_0x52301b[_0x1a48ca(0xe0)],'updatedAt':_0x52301b[_0x1a48ca(0xdd)],'shop':_0x52301b['shop']})),'pagination':{'page':_0x58760f,'limit':_0x3f52d5,'total':_0x4e92c7,'totalPages':Math[_0x1a48ca(0x167)](_0x4e92c7/_0x3f52d5)}};}async[a33_0x3230bc(0x14f)](_0x406d8b){const _0x531b59=a33_0x3230bc,_0x282475=await database_1[_0x531b59(0x122)][_0x531b59(0x100)]['findUnique']({'where':{'id':_0x406d8b},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x282475)return null;return{'id':_0x282475['id'],'shopId':_0x282475[_0x531b59(0xcf)],'gateway':_0x282475[_0x531b59(0xe7)],'amount':_0x282475[_0x531b59(0xdb)],'currency':_0x282475['currency'],'sourceCurrency':_0x282475['sourceCurrency'],'usage':_0x282475[_0x531b59(0x104)],'status':_0x282475['status'],'externalPaymentUrl':_0x282475[_0x531b59(0xea)],'successUrl':_0x282475[_0x531b59(0x13e)],'failUrl':_0x282475[_0x531b59(0xd1)],'pendingUrl':_0x282475[_0x531b59(0xf8)],'whiteUrl':_0x282475[_0x531b59(0xf7)],'expiresAt':_0x282475[_0x531b59(0xd4)],'orderId':_0x282475['orderId'],'gatewayOrderId':_0x282475['gatewayOrderId'],'gatewayPaymentId':_0x282475[_0x531b59(0x144)],'customerEmail':_0x282475['customerEmail'],'customerName':_0x282475[_0x531b59(0x13c)],'customerCountry':_0x282475[_0x531b59(0x15f)],'customerIp':_0x282475[_0x531b59(0x16b)],'customerUa':_0x282475['customerUa'],'invoiceTotalSum':_0x282475[_0x531b59(0xf2)],'qrCode':_0x282475['qrCode'],'qrUrl':_0x282475[_0x531b59(0x147)],'txUrls':_0x282475[_0x531b59(0xf3)],'country':_0x282475['country'],'language':_0x282475[_0x531b59(0x171)],'amountIsEditable':_0x282475[_0x531b59(0x13f)],'maxPayments':_0x282475[_0x531b59(0x10f)],'rapydCustomer':_0x282475['rapydCustomer'],'cardLast4':_0x282475['cardLast4'],'paymentMethod':_0x282475[_0x531b59(0x17d)],'bankId':_0x282475[_0x531b59(0x17a)],'remitterIban':_0x282475[_0x531b59(0x174)],'remitterName':_0x282475[_0x531b59(0xc8)],'paidAt':_0x282475[_0x531b59(0xba)],'merchantPaid':_0x282475[_0x531b59(0x13a)],'chargebackAmount':_0x282475[_0x531b59(0x132)],'adminNotes':_0x282475[_0x531b59(0x14a)],'statusChangedBy':_0x282475[_0x531b59(0xd8)],'statusChangedAt':_0x282475[_0x531b59(0x10d)],'failureMessage':_0x282475[_0x531b59(0x16e)],'createdAt':_0x282475[_0x531b59(0xe0)],'updatedAt':_0x282475['updatedAt'],'shop':_0x282475[_0x531b59(0xd0)]};}async['updatePaymentStatus'](_0x2f8c41,_0x14c5e2,_0xc97ebd,_0x990ffb){const _0x1d1e34=a33_0x3230bc,_0x5de3b5={'status':_0x14c5e2[_0x1d1e34(0x141)](),'updatedAt':new Date(),'statusChangedBy':_0x1d1e34(0xfd),'statusChangedAt':new Date()};_0xc97ebd&&(_0x5de3b5[_0x1d1e34(0x14a)]=_0xc97ebd);_0x14c5e2['toUpperCase']()===_0x1d1e34(0x137)&&_0x990ffb&&(_0x5de3b5[_0x1d1e34(0x132)]=_0x990ffb);_0x14c5e2[_0x1d1e34(0x141)]()==='PAID'&&(_0x5de3b5['paidAt']=new Date());const _0x5860e7=await database_1[_0x1d1e34(0x122)]['payment']['update']({'where':{'id':_0x2f8c41},'data':_0x5de3b5,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return{'id':_0x5860e7['id'],'shopId':_0x5860e7[_0x1d1e34(0xcf)],'gateway':_0x5860e7[_0x1d1e34(0xe7)],'amount':_0x5860e7[_0x1d1e34(0xdb)],'currency':_0x5860e7[_0x1d1e34(0x12c)],'sourceCurrency':_0x5860e7[_0x1d1e34(0x130)],'usage':_0x5860e7['usage'],'status':_0x5860e7[_0x1d1e34(0x17f)],'externalPaymentUrl':_0x5860e7[_0x1d1e34(0xea)],'successUrl':_0x5860e7[_0x1d1e34(0x13e)],'failUrl':_0x5860e7[_0x1d1e34(0xd1)],'pendingUrl':_0x5860e7[_0x1d1e34(0xf8)],'whiteUrl':_0x5860e7[_0x1d1e34(0xf7)],'expiresAt':_0x5860e7[_0x1d1e34(0xd4)],'orderId':_0x5860e7[_0x1d1e34(0x118)],'gatewayOrderId':_0x5860e7[_0x1d1e34(0x119)],'gatewayPaymentId':_0x5860e7[_0x1d1e34(0x144)],'customerEmail':_0x5860e7[_0x1d1e34(0xd5)],'customerName':_0x5860e7['customerName'],'customerCountry':_0x5860e7['customerCountry'],'customerIp':_0x5860e7[_0x1d1e34(0x16b)],'customerUa':_0x5860e7[_0x1d1e34(0xeb)],'invoiceTotalSum':_0x5860e7['invoiceTotalSum'],'qrCode':_0x5860e7[_0x1d1e34(0xef)],'qrUrl':_0x5860e7[_0x1d1e34(0x147)],'txUrls':_0x5860e7[_0x1d1e34(0xf3)],'country':_0x5860e7[_0x1d1e34(0x103)],'language':_0x5860e7[_0x1d1e34(0x171)],'amountIsEditable':_0x5860e7['amountIsEditable'],'maxPayments':_0x5860e7[_0x1d1e34(0x10f)],'rapydCustomer':_0x5860e7['rapydCustomer'],'cardLast4':_0x5860e7[_0x1d1e34(0xf6)],'paymentMethod':_0x5860e7['paymentMethod'],'bankId':_0x5860e7[_0x1d1e34(0x17a)],'remitterIban':_0x5860e7[_0x1d1e34(0x174)],'remitterName':_0x5860e7[_0x1d1e34(0xc8)],'paidAt':_0x5860e7['paidAt'],'merchantPaid':_0x5860e7[_0x1d1e34(0x13a)],'chargebackAmount':_0x5860e7[_0x1d1e34(0x132)],'adminNotes':_0x5860e7[_0x1d1e34(0x14a)],'statusChangedBy':_0x5860e7['statusChangedBy'],'statusChangedAt':_0x5860e7[_0x1d1e34(0x10d)],'failureMessage':_0x5860e7[_0x1d1e34(0x16e)],'createdAt':_0x5860e7['createdAt'],'updatedAt':_0x5860e7[_0x1d1e34(0xdd)],'shop':_0x5860e7[_0x1d1e34(0xd0)]};}async[a33_0x3230bc(0x14b)](_0x408879,_0x473333){const _0x13aeac=a33_0x3230bc;console[_0x13aeac(0x117)](_0x13aeac(0xbe)+_0x408879+':',_0x473333);const _0x4f2508={'updatedAt':new Date()};_0x473333[_0x13aeac(0x15f)]!==undefined&&(_0x4f2508[_0x13aeac(0x15f)]=_0x473333[_0x13aeac(0x15f)]||null);_0x473333[_0x13aeac(0x16b)]!==undefined&&(_0x4f2508[_0x13aeac(0x16b)]=_0x473333[_0x13aeac(0x16b)]||null);_0x473333['customerUa']!==undefined&&(_0x4f2508[_0x13aeac(0xeb)]=_0x473333[_0x13aeac(0xeb)]||null);const _0x322f7c=await database_1[_0x13aeac(0x122)][_0x13aeac(0x100)][_0x13aeac(0xc6)]({'where':{'id':_0x408879},'data':_0x4f2508,'select':{'id':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x13aeac(0x117)](_0x13aeac(0x12b)+_0x408879+':',{'customerCountry':_0x322f7c['customerCountry'],'customerIp':_0x322f7c[_0x13aeac(0x16b)],'customerUa':_0x322f7c[_0x13aeac(0xeb)]}),{'id':_0x322f7c['id'],'customerCountry':_0x322f7c['customerCountry'],'customerIp':_0x322f7c[_0x13aeac(0x16b)],'customerUa':_0x322f7c[_0x13aeac(0xeb)],'updatedAt':_0x322f7c['updatedAt']};}async[a33_0x3230bc(0x158)](_0x419b20){const _0x3bfc77=a33_0x3230bc,{page:_0x5106eb,limit:_0x245939,status:_0x1be99e}=_0x419b20,_0x2225d2=(_0x5106eb-0x1)*_0x245939,_0x897ab5={};_0x1be99e&&(_0x897ab5['status']=_0x1be99e[_0x3bfc77(0x141)]());const [_0x24cd21,_0x422db4]=await Promise[_0x3bfc77(0x14c)]([database_1['default'][_0x3bfc77(0xd0)]['findMany']({'where':_0x897ab5,'skip':_0x2225d2,'take':_0x245939,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x3bfc77(0x122)][_0x3bfc77(0xd0)][_0x3bfc77(0xcb)]({'where':_0x897ab5})]);return{'users':_0x24cd21[_0x3bfc77(0x133)](_0x24b96e=>({'id':_0x24b96e['id'],'fullName':_0x24b96e[_0x3bfc77(0xe3)],'username':_0x24b96e[_0x3bfc77(0x145)],'telegramId':_0x24b96e[_0x3bfc77(0x126)],'merchantUrl':_0x24b96e[_0x3bfc77(0x109)],'gateways':_0x24b96e['paymentGateways']?JSON[_0x3bfc77(0x173)](_0x24b96e[_0x3bfc77(0x11f)]):null,'gatewaySettings':_0x24b96e[_0x3bfc77(0x138)]?JSON[_0x3bfc77(0x173)](_0x24b96e['gatewaySettings']):null,'publicKey':_0x24b96e[_0x3bfc77(0x120)],'wallets':{'usdtPolygonWallet':_0x24b96e[_0x3bfc77(0x156)],'usdtTrcWallet':_0x24b96e[_0x3bfc77(0x11d)],'usdtErcWallet':_0x24b96e[_0x3bfc77(0xd2)],'usdcPolygonWallet':_0x24b96e[_0x3bfc77(0xd3)]},'status':_0x24b96e['status'],'createdAt':_0x24b96e[_0x3bfc77(0xe0)]})),'pagination':{'page':_0x5106eb,'limit':_0x245939,'total':_0x422db4,'totalPages':Math[_0x3bfc77(0x167)](_0x422db4/_0x245939)}};}async[a33_0x3230bc(0x177)](_0x4763b2){const _0x4b7a9c=a33_0x3230bc,_0x2eb358=await database_1[_0x4b7a9c(0x122)]['shop'][_0x4b7a9c(0xf5)]({'where':{'id':_0x4763b2},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x2eb358)return null;return{'id':_0x2eb358['id'],'fullName':_0x2eb358['name'],'username':_0x2eb358[_0x4b7a9c(0x145)],'telegramId':_0x2eb358[_0x4b7a9c(0x126)],'merchantUrl':_0x2eb358['shopUrl'],'gateways':_0x2eb358[_0x4b7a9c(0x11f)]?JSON['parse'](_0x2eb358['paymentGateways']):null,'gatewaySettings':_0x2eb358[_0x4b7a9c(0x138)]?JSON['parse'](_0x2eb358[_0x4b7a9c(0x138)]):null,'publicKey':_0x2eb358[_0x4b7a9c(0x120)],'wallets':{'usdtPolygonWallet':_0x2eb358[_0x4b7a9c(0x156)],'usdtTrcWallet':_0x2eb358[_0x4b7a9c(0x11d)],'usdtErcWallet':_0x2eb358['usdtErcWallet'],'usdcPolygonWallet':_0x2eb358[_0x4b7a9c(0xd3)]},'status':_0x2eb358[_0x4b7a9c(0x17f)],'createdAt':_0x2eb358[_0x4b7a9c(0xe0)]};}async[a33_0x3230bc(0x157)](_0x189b57){const _0x332e1d=a33_0x3230bc,{fullName:_0x4abd44,username:_0x1b50ea,password:_0x1d7f8e,telegramId:_0x4cb2c3,merchantUrl:_0x35582d,gateways:_0x32b46f,gatewaySettings:_0x4d6323,wallets:_0x378e69}=_0x189b57,_0x50ac84=await database_1[_0x332e1d(0x122)][_0x332e1d(0xd0)]['findUnique']({'where':{'username':_0x1b50ea}});if(_0x50ac84)throw new Error('Username\x20already\x20exists');if(_0x4cb2c3){const _0x3c9a14=await database_1['default'][_0x332e1d(0xd0)]['findUnique']({'where':{'telegram':_0x4cb2c3}});if(_0x3c9a14)throw new Error('Telegram\x20username\x20already\x20exists');}const _0x4535f5=await bcryptjs_1[_0x332e1d(0x122)][_0x332e1d(0x179)](_0x1d7f8e,0xc),_0x21a00b='pk_'+crypto_1[_0x332e1d(0x122)][_0x332e1d(0xc9)](0x20)['toString'](_0x332e1d(0xf4)),_0x48bbb9=_0x332e1d(0xc5)+crypto_1[_0x332e1d(0x122)][_0x332e1d(0xc9)](0x20)[_0x332e1d(0x153)](_0x332e1d(0xf4)),_0x358025=await database_1[_0x332e1d(0x122)][_0x332e1d(0xd0)][_0x332e1d(0x12d)]({'data':{'name':_0x4abd44,'username':_0x1b50ea,'password':_0x4535f5,'telegram':_0x4cb2c3,'shopUrl':_0x35582d,'paymentGateways':_0x32b46f?JSON['stringify'](_0x32b46f):null,'gatewaySettings':_0x4d6323?JSON[_0x332e1d(0xda)](_0x4d6323):null,'usdtPolygonWallet':_0x378e69?.[_0x332e1d(0x156)]||null,'usdtTrcWallet':_0x378e69?.['usdtTrcWallet']||null,'usdtErcWallet':_0x378e69?.[_0x332e1d(0xd2)]||null,'usdcPolygonWallet':_0x378e69?.[_0x332e1d(0xd3)]||null,'publicKey':_0x21a00b,'secretKey':_0x48bbb9,'status':_0x332e1d(0xc1)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x358025['id'],'fullName':_0x358025[_0x332e1d(0xe3)],'username':_0x358025[_0x332e1d(0x145)],'telegramId':_0x358025[_0x332e1d(0x126)],'merchantUrl':_0x358025[_0x332e1d(0x109)],'gateways':_0x358025[_0x332e1d(0x11f)]?JSON[_0x332e1d(0x173)](_0x358025['paymentGateways']):null,'gatewaySettings':_0x358025['gatewaySettings']?JSON[_0x332e1d(0x173)](_0x358025[_0x332e1d(0x138)]):null,'publicKey':_0x358025[_0x332e1d(0x120)],'wallets':{'usdtPolygonWallet':_0x358025[_0x332e1d(0x156)],'usdtTrcWallet':_0x358025[_0x332e1d(0x11d)],'usdtErcWallet':_0x358025['usdtErcWallet'],'usdcPolygonWallet':_0x358025['usdcPolygonWallet']},'status':_0x358025[_0x332e1d(0x17f)],'createdAt':_0x358025[_0x332e1d(0xe0)]};}async[a33_0x3230bc(0x170)](_0x1e0c88,_0x8abbff){const _0x6ec4ec=a33_0x3230bc,_0x33b3f9={..._0x8abbff};_0x8abbff[_0x6ec4ec(0x12a)]&&(_0x33b3f9['password']=await bcryptjs_1[_0x6ec4ec(0x122)][_0x6ec4ec(0x179)](_0x8abbff['password'],0xc));_0x8abbff[_0x6ec4ec(0x187)]&&(_0x33b3f9[_0x6ec4ec(0xe3)]=_0x8abbff[_0x6ec4ec(0x187)],delete _0x33b3f9[_0x6ec4ec(0x187)]);_0x8abbff[_0x6ec4ec(0x11b)]&&(_0x33b3f9[_0x6ec4ec(0x126)]=_0x8abbff[_0x6ec4ec(0x11b)],delete _0x33b3f9['telegramId']);_0x8abbff[_0x6ec4ec(0x13d)]&&(_0x33b3f9[_0x6ec4ec(0x109)]=_0x8abbff[_0x6ec4ec(0x13d)],delete _0x33b3f9[_0x6ec4ec(0x13d)]);_0x8abbff[_0x6ec4ec(0x168)]&&(_0x33b3f9[_0x6ec4ec(0x11f)]=JSON[_0x6ec4ec(0xda)](_0x8abbff['gateways']),delete _0x33b3f9['gateways']);_0x8abbff[_0x6ec4ec(0x138)]&&(_0x33b3f9[_0x6ec4ec(0x138)]=JSON[_0x6ec4ec(0xda)](_0x8abbff['gatewaySettings']),delete _0x33b3f9[_0x6ec4ec(0x138)]);_0x8abbff['wallets']&&(_0x8abbff[_0x6ec4ec(0x134)][_0x6ec4ec(0x156)]!==undefined&&(_0x33b3f9[_0x6ec4ec(0x156)]=_0x8abbff[_0x6ec4ec(0x134)]['usdtPolygonWallet']||null),_0x8abbff['wallets'][_0x6ec4ec(0x11d)]!==undefined&&(_0x33b3f9[_0x6ec4ec(0x11d)]=_0x8abbff[_0x6ec4ec(0x134)][_0x6ec4ec(0x11d)]||null),_0x8abbff['wallets']['usdtErcWallet']!==undefined&&(_0x33b3f9[_0x6ec4ec(0xd2)]=_0x8abbff[_0x6ec4ec(0x134)][_0x6ec4ec(0xd2)]||null),_0x8abbff['wallets'][_0x6ec4ec(0xd3)]!==undefined&&(_0x33b3f9[_0x6ec4ec(0xd3)]=_0x8abbff[_0x6ec4ec(0x134)][_0x6ec4ec(0xd3)]||null),delete _0x33b3f9[_0x6ec4ec(0x134)]);const _0x7d5ee5=await database_1[_0x6ec4ec(0x122)][_0x6ec4ec(0xd0)]['update']({'where':{'id':_0x1e0c88},'data':_0x33b3f9,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x7d5ee5['id'],'fullName':_0x7d5ee5[_0x6ec4ec(0xe3)],'username':_0x7d5ee5['username'],'telegramId':_0x7d5ee5['telegram'],'merchantUrl':_0x7d5ee5['shopUrl'],'gateways':_0x7d5ee5[_0x6ec4ec(0x11f)]?JSON[_0x6ec4ec(0x173)](_0x7d5ee5[_0x6ec4ec(0x11f)]):null,'gatewaySettings':_0x7d5ee5[_0x6ec4ec(0x138)]?JSON[_0x6ec4ec(0x173)](_0x7d5ee5[_0x6ec4ec(0x138)]):null,'publicKey':_0x7d5ee5[_0x6ec4ec(0x120)],'wallets':{'usdtPolygonWallet':_0x7d5ee5[_0x6ec4ec(0x156)],'usdtTrcWallet':_0x7d5ee5[_0x6ec4ec(0x11d)],'usdtErcWallet':_0x7d5ee5[_0x6ec4ec(0xd2)],'usdcPolygonWallet':_0x7d5ee5['usdcPolygonWallet']},'status':_0x7d5ee5['status'],'createdAt':_0x7d5ee5[_0x6ec4ec(0xe0)]};}async[a33_0x3230bc(0x11e)](_0x5c3ed6){const _0x417f30=a33_0x3230bc;await database_1[_0x417f30(0x122)][_0x417f30(0xd0)]['delete']({'where':{'id':_0x5c3ed6}});}async[a33_0x3230bc(0xc4)](_0x1a11ea){const _0xe533e8=a33_0x3230bc,_0x3b212b=await database_1[_0xe533e8(0x122)][_0xe533e8(0xd0)][_0xe533e8(0xc6)]({'where':{'id':_0x1a11ea},'data':{'status':_0xe533e8(0x169)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x3b212b['id'],'fullName':_0x3b212b['name'],'username':_0x3b212b[_0xe533e8(0x145)],'telegramId':_0x3b212b[_0xe533e8(0x126)],'merchantUrl':_0x3b212b[_0xe533e8(0x109)],'gateways':_0x3b212b[_0xe533e8(0x11f)]?JSON[_0xe533e8(0x173)](_0x3b212b[_0xe533e8(0x11f)]):null,'gatewaySettings':_0x3b212b[_0xe533e8(0x138)]?JSON[_0xe533e8(0x173)](_0x3b212b[_0xe533e8(0x138)]):null,'publicKey':_0x3b212b['publicKey'],'wallets':{'usdtPolygonWallet':_0x3b212b[_0xe533e8(0x156)],'usdtTrcWallet':_0x3b212b['usdtTrcWallet'],'usdtErcWallet':_0x3b212b[_0xe533e8(0xd2)],'usdcPolygonWallet':_0x3b212b[_0xe533e8(0xd3)]},'status':_0x3b212b[_0xe533e8(0x17f)],'createdAt':_0x3b212b[_0xe533e8(0xe0)]};}async[a33_0x3230bc(0x15e)](_0x27cdff){const _0x573e27=a33_0x3230bc,_0x3df8a2=await database_1['default'][_0x573e27(0xd0)][_0x573e27(0xc6)]({'where':{'id':_0x27cdff},'data':{'status':_0x573e27(0xc1)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x3df8a2['id'],'fullName':_0x3df8a2[_0x573e27(0xe3)],'username':_0x3df8a2['username'],'telegramId':_0x3df8a2[_0x573e27(0x126)],'merchantUrl':_0x3df8a2['shopUrl'],'gateways':_0x3df8a2[_0x573e27(0x11f)]?JSON['parse'](_0x3df8a2[_0x573e27(0x11f)]):null,'gatewaySettings':_0x3df8a2[_0x573e27(0x138)]?JSON[_0x573e27(0x173)](_0x3df8a2['gatewaySettings']):null,'publicKey':_0x3df8a2[_0x573e27(0x120)],'wallets':{'usdtPolygonWallet':_0x3df8a2[_0x573e27(0x156)],'usdtTrcWallet':_0x3df8a2[_0x573e27(0x11d)],'usdtErcWallet':_0x3df8a2[_0x573e27(0xd2)],'usdcPolygonWallet':_0x3df8a2['usdcPolygonWallet']},'status':_0x3df8a2[_0x573e27(0x17f)],'createdAt':_0x3df8a2['createdAt']};}async[a33_0x3230bc(0xc7)](_0x1cc837){const _0x50bafb=a33_0x3230bc,_0x174506=await database_1[_0x50bafb(0x122)][_0x50bafb(0x100)][_0x50bafb(0xb9)]({'where':{'status':_0x50bafb(0x16c),'createdAt':{'gte':_0x1cc837}},'select':{'amount':!![],'currency':!![]}});let _0xda66c4=0x0;for(const _0x197299 of _0x174506){const _0x4e974a=await currencyService_1[_0x50bafb(0x188)][_0x50bafb(0x175)](_0x197299[_0x50bafb(0xdb)],_0x197299[_0x50bafb(0x12c)]);_0xda66c4+=_0x4e974a;}return _0xda66c4;}async[a33_0x3230bc(0x123)](_0x20ee7e){const _0x5aca12=a33_0x3230bc,_0x3d7d31=await database_1[_0x5aca12(0x122)]['payout']['aggregate']({'where':{'createdAt':{'gte':_0x20ee7e}},'_sum':{'amount':!![]}});return _0x3d7d31['_sum'][_0x5aca12(0xdb)]||0x0;}async[a33_0x3230bc(0xca)](){const _0x4e11c9=a33_0x3230bc,_0x364b1d=await database_1[_0x4e11c9(0x122)]['payout'][_0x4e11c9(0x185)]({'_sum':{'amount':!![]}});return _0x364b1d[_0x4e11c9(0x135)][_0x4e11c9(0xdb)]||0x0;}async[a33_0x3230bc(0x125)](){const _0x27e53d=a33_0x3230bc,_0x426048=await database_1[_0x27e53d(0x122)][_0x27e53d(0xc2)]['aggregate']({'where':{'status':'COMPLETED'},'_sum':{'amount':!![]}});return _0x426048['_sum'][_0x27e53d(0xdb)]||0x0;}}exports[a33_0x3230bc(0x149)]=AdminService;