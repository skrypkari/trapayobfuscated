'use strict';const a48_0x1493df=a48_0x315f;(function(_0x3cf697,_0x5ccade){const _0x39ecba=a48_0x315f,_0x3427d0=_0x3cf697();while(!![]){try{const _0x295c1c=parseInt(_0x39ecba(0x189))/0x1*(parseInt(_0x39ecba(0x2a3))/0x2)+-parseInt(_0x39ecba(0x18b))/0x3*(-parseInt(_0x39ecba(0x21c))/0x4)+parseInt(_0x39ecba(0x29e))/0x5+parseInt(_0x39ecba(0x2ac))/0x6*(-parseInt(_0x39ecba(0x204))/0x7)+-parseInt(_0x39ecba(0x2bc))/0x8*(parseInt(_0x39ecba(0x2c1))/0x9)+parseInt(_0x39ecba(0x208))/0xa+-parseInt(_0x39ecba(0x2d3))/0xb*(parseInt(_0x39ecba(0x29a))/0xc);if(_0x295c1c===_0x5ccade)break;else _0x3427d0['push'](_0x3427d0['shift']());}catch(_0x14dce1){_0x3427d0['push'](_0x3427d0['shift']());}}}(a48_0x1431,0x37a5c));var __importDefault=this&&this[a48_0x1493df(0x267)]||function(_0x582f65){return _0x582f65&&_0x582f65['__esModule']?_0x582f65:{'default':_0x582f65};};function a48_0x315f(_0x42bb02,_0x440896){_0x42bb02=_0x42bb02-0x17e;const _0x1431eb=a48_0x1431();let _0x315f81=_0x1431eb[_0x42bb02];return _0x315f81;}function a48_0x1431(){const _0x3d7b73=['polygon','usdtPolygonWallet','merchantEarningsUSDT','updatePaymentStatus','customerCountry','split','ðŸ“Š\x20Sorting\x20payments\x20by\x20','customerEmail','\x20\x20\x20ðŸ’³\x20Total\x20payments:\x20','ceil','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','REFUND','\x20\x20\x20Added\x20to\x20balance:\x20+','toLocaleDateString','custom_','update','\x20\x20\x20Full\x20amount:\x20','\x20USDT\x20(-','noda','totalAmountAfterCommissionUSDT','deleteUser','gatewayEarnings','password','\x20\x20\x20ðŸŒ\x20Country:\x20','COMPLETED','trim','merchantUrl','pendingPayout','updatedAt','\x20has\x20zero\x20or\x20null\x20amountUSDT,\x20skipping...','cointopay','replace','\x27\x20->\x20name\x20\x27','hash','awaitingPayout','ðŸ”„\x20Converted\x20gateway\x20name\x20\x27','ðŸ“Š\x20Getting\x20merchant\x20statistics\x20with\x20filters:','getMonth','ru-RU','\x20\x20\x20Requested\x20(number):\x20','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','currencyService','Telegram\x20username\x20already\x20exists','getPayoutStats','\x20USDT\x20(current\x20balance\x20in\x20DB)','\x20\x20\x20Difference:\x20','ðŸ”§\x20[','getMerchantsSelection','customerName','totalAmountUSDT','periodTo','forEach','\x20\x20\x20Tolerance:\x20','getUTCDay','\x20\x20\x20Merchant\x20gets:\x20','notes','ðŸ’°\x20Shop\x20','\x20USDT','payout','\x20\x20\x20ðŸ’°\x20Total\x20payments\x20turnover:\x20','\x20\x20\x20ðŸ’°\x20Total\x20payout:\x20','\x20with\x20payout\x20history','\x20paid\x20payments\x20for\x20analysis','ðŸ“…\x20Payout\x20date\x20from\x20filter:\x20','balance','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','min','\x20\x20\x20Final\x20payout\x20amount\x20used:\x20','payment','updateCustomerData','ðŸ’°\x20Payment\x20','push','thisMonth','getUTCDate','ðŸ’°\x20[PAYOUT]\x20Gateway\x20','getMerchantsAwaitingPayout','getGatewayDisplayName',',\x20Commission:\x20','commission','random','7PPGFeC','gte','ðŸ”\x20No\x20wallet\x20provided,\x20looking\x20up\x20from\x20shop\x20settings...','shopId','3745410eycPLt','adminNotes','createdAt','chargebackAmount','\x20\x20\x20Available\x20(number):\x20','getAllPayments','\x20\x20\x20ðŸ“…\x20This\x20month:\x20','telegram',']\x20User\x20updated,\x20gatewaySettings\x20from\x20DB:','sk_','gatewayCommissionRate','\x20order','rapyd','periodFrom','CHARGEBACK','error','setHours','\x20balance\x20updated:','0000','getMerchantStatistics','94876uZLcUt','all','getTime','\x20->\x20','log','not\x20set','_sum','username','telegramId','this_month','Payment\x20not\x20found','\x20\x20\x20âœ…\x20Total\x20net\x20balances:\x20','\x20\x20\x20ðŸ‘¤\x20Merchant\x20earnings:\x20','toString','\x27\x20(from\x20\x27','successUrl','generateDailyStatistics','ðŸ’°\x20[PAYOUT]\x20Merchant\x20','getUTCMonth','randomBytes','groupBy','currency',',\x20userId:\x20','KLYME\x20EU','\x20\x20\x20ï¿½\x20Total\x20paid\x20out:\x20','\x20\x20\x20ï¿½ðŸ“Š\x20Total\x20payments:\x20','values','ðŸ“Š\x20Statistics\x20date\x20range:\x20','pendingUrl','plisio','%\x20commission)','whiteUrl','\x20merchants','reduce','MasterCard','getAllUsers','not\x20provided',',\x20successful:\x20','paymentGateways','amount','ðŸ“Š\x20Total\x20payments\x20(including\x20failed):\x20','deletePayout','default','warn','shop','averageCommissionRate','Plisio','getGatewayNameById','\x20\x20\x20Gateway:\x20','âœ…\x20Using\x20gateway\x20filter:\x20\x27','getPayoutById','fullName','ðŸ”\x20Using\x20gateway\x20\x27','getSystemStatistics','amountAfterGatewayCommissionUSDT','toUpperCase','toLowerCase','floor','turnover','ðŸ’°\x20Current\x20shop\x20balance:\x20','ðŸ”„\x20Admin\x20updating\x20payment\x20','substr','usdcErcWallet','\x27\x20not\x20found.\x20Available\x20gateways:\x20','ðŸ’¸\x20CHARGEBACK:\x20Processing\x20penalty-only\x20deduction','UTC','\x20USDT,\x20Requested:\x20','klyme_eu','filter','\x20\x20\x20Transaction\x20hash:\x20','gatewaySettings','ðŸ’°\x20Creating\x20payout\x20for\x20shop\x20','\x20USDT,\x20Difference:\x20',']\x20Updating\x20password\x20for\x20user\x20','ðŸ“Š\x20Using\x20saved\x20commission\x20rate\x20for\x20payment\x20','__importDefault','ðŸ”\x20Selected\x20erc20\x20wallet:\x20','ðŸ“…\x20Date\x20from\x20filter:\x20','updateUser','trc20','slice','ÐÐµ\x20ÑƒÐºÐ°Ð·Ð°Ð½','paymentsCount','âœ…\x20Using\x20wallet\x20from\x20request:\x20','length','ðŸ“Š\x20Using\x20saved\x20values\x20for\x20payment\x20','ðŸ”\x20Initial\x20wallet\x20from\x20request:\x20','customerUa','statusChangedAt','Noda','year','dailyRevenue','period','ðŸ”\x20Balance\x20check\x20details:','telegramBotService','entries','parse','klyme_gb','ðŸ“Š\x20Available\x20gateways\x20in\x20database:','ðŸ“Š\x20Merchant\x20statistics\x20calculated:','âŒ\x20Failed\x20to\x20send\x20Telegram\x20notification\x20for\x20payout\x20','gatewayOrderId','ðŸ’±\x20Currency\x20filter\x20applied:\x20','NONEXISTENT_GATEWAY_FILTER','insensitive','erc20','toFixed','\x20\x20\x20â³\x20Pending\x20payout:\x20','\x20\x20\x20âœ…\x20Actual\x20available\x20balance:\x20','yesterday','averageCheckUSDT','ðŸ“Š\x20Calculating\x20payout\x20statistics...','ðŸ“±\x20Telegram\x20notification\x20sent\x20for\x20payout\x20','count','name','Insufficient\x20balance.\x20Available:\x20','findMany','gateway','getUserById','ðŸ“Š\x20Gateway\x20filter\x20applied:','\x20USDT\x20(total\x20paid\x20to\x20merchants)','\x20\x20\x20Payout\x20amount:\x20','\x20\x20\x20ðŸ”\x20Calculated\x20after\x20commission:\x20','last_month','custom','EXPIRED','12QTvZWt','getAllPayouts','hex','ðŸ”\x20Shop\x20wallets:','1223990vhcoen','ðŸ“‹\x20Found\x20','crypto','desc','ðŸ“Š\x20[ADMIN]\x20Calculating\x20commission\x20manually\x20for\x20payment\x20','772156GPiSXe','getFullYear','2020-01-01','ðŸ”\x20[','\x20balance\x20updated:\x20','status','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','week','usdtErcWallet','306510uBveML','totalCommissionRate','\x27\x20->\x20ID\x20\x27','not\x20specified','convertToUSDT','ðŸ“Š\x20[ADMIN]\x20Using\x20saved\x20amountAfterGatewayCommissionUSDT:\x20','stringify','$transaction','wallet','\x20PAID\x20payments',']\x20Gateway\x20settings\x20before\x20saving:','test_gateway','ðŸ“Š\x20Merchants\x20with\x20rounded\x20balance\x20!=\x200.00:\x20','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','cointopay2','totalPaidOut','56XkJPBw','\x20USDT\x20for\x20payment\x20','ðŸ“Š\x20Calculated\x20commission\x20rate\x20for\x20payment\x20','\x20for\x20shop\x20','\x20\x20\x20ðŸ–¥ï¸\x20User\x20Agent:\x20','159399bQjwkC','setDate','statusChangedBy','paidAt','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','failureMessage','\x20USDT\x20(gross\x20revenue)','\x20\x20\x20ðŸ’µ\x20Available\x20balance:\x20','createUser','date','\x20\x20\x20ðŸ¤”\x20Difference:\x20','getGatewayInternalName','usdtTrcWallet','toISOString','findUnique','asc','createPayout','some','9496652DiWjRt','customerIp','âš ï¸\x20CHARGEBACK\x20without\x20penalty\x20amount\x20-\x20no\x20balance\x20change','ðŸ”„\x20Gateway\x20mapping\x20(get):','commissionUSDT','ðŸ“Š\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','KLYME\x20GB','\x20-\x20','network','usdcPolygonWallet','PAID',']\x20Gateway\x20settings\x20JSON\x20string:','create','\x20\x20\x20â³\x20Awaiting\x20payout:\x20','publicKey',']\x20Password\x20not\x20provided\x20or\x20empty,\x20skipping\x20password\x20update','\x20\x20\x20Total\x20paid\x20out:\x20','month','ðŸ“Š\x20Payout\x20statistics\x20calculated:','lte','Username\x20already\x20exists','getGatewayIdByName','ðŸ”\x20Selected\x20polygon\x20wallet:\x20','\x20USDT\x20(after\x20','shopUrl','amountUSDT','ACTIVE','\x20\x20\x20ðŸ’¸\x20Total\x20payouts:\x20','\x20USDT\x20(already\x20paid\x20out)','ðŸŽ¯\x20updateUser\x20called\x20with\x20ID:\x20',',\x20chargebacks:\x20','bcryptjs','ðŸ”„\x20Gateway\x20mapping:','dateTo','\x20\x20\x20Balance:\x20','gateways','map','\x20USDT,\x20merchant:\x20','ðŸ“…\x20Period:\x20','admin','orderId','1WsibGC','setUTCDate','33SrYMAZ','ðŸŽ¯\x20[','polygon_usdc','%\x20from\x20','getPaymentById','payouts','\x20to\x20','\x20USDT\x20(+','âš ï¸\x20Payment\x20','amountAfterCommissionUSDT','\x20USDT\x20(','\x20merchants\x20with\x20rounded\x20balance\x20!=\x200.00\x20(excluding\x20balances\x20that\x20round\x20to\x200.00)','last_week','totalPayments',':\x20commission\x20=\x20','findFirst','set',',\x20refunds:\x20','aggregate','dateFrom','ðŸ“Š\x20Statistics\x20PAID\x20payments\x20count:\x20','defineProperty','__esModule','this_week','wallets','PENDING','failUrl','merchantEarnings','turnoverUSDT','getUTCFullYear','includes','AdminService','../types/gateway','sort','\x27\x20to\x20name\x20\x27','ðŸ’°\x20Found\x20','Error\x20processing\x20payment\x20','today','txid','round','../config/database'];a48_0x1431=function(){return _0x3d7b73;};return a48_0x1431();}Object[a48_0x1493df(0x1a0)](exports,a48_0x1493df(0x1a1),{'value':!![]}),exports[a48_0x1493df(0x1aa)]=void 0x0;const database_1=__importDefault(require(a48_0x1493df(0x1b3))),bcryptjs_1=__importDefault(require(a48_0x1493df(0x17f))),crypto_1=__importDefault(require(a48_0x1493df(0x2a0))),currencyService_1=require('./currencyService'),telegramBotService_1=require('./telegramBotService'),gateway_1=require(a48_0x1493df(0x1ab));class AdminService{async[a48_0x1493df(0x1df)](){const _0x4b43be=a48_0x1493df;console[_0x4b43be(0x220)](_0x4b43be(0x28b));const _0x168110=await database_1[_0x4b43be(0x246)]['shop'][_0x4b43be(0x19d)]({'_sum':{'balance':!![],'totalPaidOut':!![]}}),_0x52fa20=await database_1['default'][_0x4b43be(0x1f8)][_0x4b43be(0x28d)]({'where':{'status':_0x4b43be(0x2dd),'gateway':{'not':_0x4b43be(0x2b7)}}}),_0x4a5e71=new Date(),_0x5eab89=new Date(_0x4a5e71['getFullYear'](),_0x4a5e71[_0x4b43be(0x1d9)](),0x1),_0x1a32e1=new Date(_0x4a5e71[_0x4b43be(0x2a4)](),_0x4a5e71['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x374912=await database_1['default'][_0x4b43be(0x1ee)][_0x4b43be(0x19d)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x5eab89,'lte':_0x1a32e1},'status':_0x4b43be(0x1cc)}}),_0x33b60e=_0x168110[_0x4b43be(0x222)][_0x4b43be(0x2bb)]||0x0,_0x33d35b=_0x168110['_sum'][_0x4b43be(0x1f4)]||0x0,_0x5c5aa3=_0x374912['_sum']['amount']||0x0,_0x2941cc={'totalPayout':Math[_0x4b43be(0x1b2)](_0x33b60e*0x64)/0x64,'awaitingPayout':Math[_0x4b43be(0x1b2)](_0x33d35b*0x64)/0x64,'thisMonth':Math['round'](_0x5c5aa3*0x64)/0x64,'availableBalance':Math[_0x4b43be(0x1b2)](_0x33d35b*0x64)/0x64,'totalPayments':_0x52fa20};return console[_0x4b43be(0x220)](_0x4b43be(0x2e5)),console['log'](_0x4b43be(0x1f0)+_0x2941cc['totalPayout']+_0x4b43be(0x294)),console[_0x4b43be(0x220)](_0x4b43be(0x2e0)+_0x2941cc[_0x4b43be(0x1d6)]+'\x20USDT\x20(sum\x20of\x20all\x20merchant\x20balances)'),console['log'](_0x4b43be(0x2c8)+_0x2941cc['availableBalance']+'\x20USDT\x20(same\x20as\x20awaiting)'),console[_0x4b43be(0x220)](_0x4b43be(0x20e)+_0x2941cc[_0x4b43be(0x1fc)]+_0x4b43be(0x1ed)),console[_0x4b43be(0x220)](_0x4b43be(0x1bc)+_0x2941cc['totalPayments']+_0x4b43be(0x2b5)),_0x2941cc;}async[a48_0x1493df(0x1f9)](_0x21b58e,_0x11193c){const _0x38257f=a48_0x1493df;console[_0x38257f(0x220)]('ðŸ”„\x20Updating\x20customer\x20data\x20for\x20payment\x20'+_0x21b58e+':',_0x11193c);const _0x589320=await database_1[_0x38257f(0x246)][_0x38257f(0x1f8)][_0x38257f(0x2cf)]({'where':{'id':_0x21b58e},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x589320)throw new Error('Payment\x20not\x20found');const _0x28e58e={};_0x11193c[_0x38257f(0x1b8)]!==undefined&&(_0x28e58e['customerCountry']=_0x11193c[_0x38257f(0x1b8)]||null);_0x11193c[_0x38257f(0x2d4)]!==undefined&&(_0x28e58e[_0x38257f(0x2d4)]=_0x11193c[_0x38257f(0x2d4)]||null);_0x11193c[_0x38257f(0x273)]!==undefined&&(_0x28e58e['customerUa']=_0x11193c[_0x38257f(0x273)]||null);const _0x3b8d55=await database_1[_0x38257f(0x246)][_0x38257f(0x1f8)]['update']({'where':{'id':_0x21b58e},'data':{..._0x28e58e,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console[_0x38257f(0x220)]('âœ…\x20Customer\x20data\x20updated\x20for\x20payment\x20'+_0x21b58e),console['log'](_0x38257f(0x1cb)+_0x589320[_0x38257f(0x1b8)]+_0x38257f(0x21f)+_0x3b8d55['customerCountry']),console[_0x38257f(0x220)]('\x20\x20\x20ðŸŒ\x20IP:\x20'+_0x589320['customerIp']+_0x38257f(0x21f)+_0x3b8d55[_0x38257f(0x2d4)]),console[_0x38257f(0x220)](_0x38257f(0x2c0)+(_0x589320[_0x38257f(0x273)]?_0x38257f(0x19b):_0x38257f(0x221))+'\x20->\x20'+(_0x3b8d55[_0x38257f(0x273)]?_0x38257f(0x19b):_0x38257f(0x221))),_0x3b8d55;}async[a48_0x1493df(0x251)](_0x33ec97,_0x3f153e){const _0x3af010=a48_0x1493df,_0x44eacb=_0x3f153e?new Date(_0x3f153e):new Date();let _0x398103,_0x53d88e;if(_0x33ec97['startsWith'](_0x3af010(0x1c2))){const _0x3f6906=_0x33ec97[_0x3af010(0x1d3)](_0x3af010(0x1c2),'')[_0x3af010(0x1b9)]('_');if(_0x3f6906[_0x3af010(0x270)]===0x2){const _0x4aecb3=new Date(_0x3f6906[0x0]),_0x26167d=new Date(_0x3f6906[0x1]);_0x398103=new Date(Date[_0x3af010(0x25d)](_0x4aecb3[_0x3af010(0x1a8)](),_0x4aecb3[_0x3af010(0x22e)](),_0x4aecb3['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x53d88e=new Date(Date['UTC'](_0x26167d[_0x3af010(0x1a8)](),_0x26167d['getUTCMonth'](),_0x26167d['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}else{const _0x388344=new Date(Date['UTC'](_0x44eacb[_0x3af010(0x1a8)](),_0x44eacb[_0x3af010(0x22e)](),_0x44eacb[_0x3af010(0x1fd)]()-0x1e));_0x398103=new Date(Date['UTC'](_0x388344[_0x3af010(0x1a8)](),_0x388344[_0x3af010(0x22e)](),_0x388344['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x53d88e=new Date(Date['UTC'](_0x44eacb[_0x3af010(0x1a8)](),_0x44eacb[_0x3af010(0x22e)](),_0x44eacb['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}}else{switch(_0x33ec97[_0x3af010(0x254)]()){case _0x3af010(0x1b0):_0x398103=new Date(Date[_0x3af010(0x25d)](_0x44eacb[_0x3af010(0x1a8)](),_0x44eacb['getUTCMonth'](),_0x44eacb[_0x3af010(0x1fd)](),0x0,0x0,0x0,0x0)),_0x53d88e=new Date(Date['UTC'](_0x44eacb[_0x3af010(0x1a8)](),_0x44eacb['getUTCMonth'](),_0x44eacb[_0x3af010(0x1fd)](),0x17,0x3b,0x3b,0x3e7));break;case _0x3af010(0x289):const _0x17b9e1=new Date(_0x44eacb);_0x17b9e1['setUTCDate'](_0x17b9e1['getUTCDate']()-0x1),_0x398103=new Date(Date['UTC'](_0x17b9e1[_0x3af010(0x1a8)](),_0x17b9e1[_0x3af010(0x22e)](),_0x17b9e1[_0x3af010(0x1fd)](),0x0,0x0,0x0,0x0)),_0x53d88e=new Date(Date['UTC'](_0x17b9e1['getUTCFullYear'](),_0x17b9e1[_0x3af010(0x22e)](),_0x17b9e1[_0x3af010(0x1fd)](),0x17,0x3b,0x3b,0x3e7));break;case _0x3af010(0x1a2):const _0x625b44=_0x44eacb[_0x3af010(0x1e9)](),_0x437dc5=_0x625b44===0x0?-0x6:0x1-_0x625b44,_0x5b1b5f=_0x44eacb[_0x3af010(0x1fd)]()+_0x437dc5;_0x398103=new Date(Date[_0x3af010(0x25d)](_0x44eacb[_0x3af010(0x1a8)](),_0x44eacb[_0x3af010(0x22e)](),_0x5b1b5f,0x0,0x0,0x0,0x0)),_0x53d88e=new Date(Date[_0x3af010(0x25d)](_0x44eacb[_0x3af010(0x1a8)](),_0x44eacb['getUTCMonth'](),_0x44eacb[_0x3af010(0x1fd)](),0x17,0x3b,0x3b,0x3e7));break;case _0x3af010(0x197):const _0x14038f=new Date(Date['UTC'](_0x44eacb['getUTCFullYear'](),_0x44eacb[_0x3af010(0x22e)](),_0x44eacb['getUTCDate']()-0x7)),_0x3b5165=_0x14038f[_0x3af010(0x1e9)](),_0x198950=_0x3b5165===0x0?-0x6:0x1-_0x3b5165,_0x24502d=_0x14038f[_0x3af010(0x1fd)]()+_0x198950;_0x398103=new Date(Date['UTC'](_0x14038f[_0x3af010(0x1a8)](),_0x14038f[_0x3af010(0x22e)](),_0x24502d,0x0,0x0,0x0,0x0)),_0x53d88e=new Date(Date[_0x3af010(0x25d)](_0x14038f[_0x3af010(0x1a8)](),_0x14038f[_0x3af010(0x22e)](),_0x24502d+0x6,0x17,0x3b,0x3b,0x3e7));break;case _0x3af010(0x225):_0x398103=new Date(Date[_0x3af010(0x25d)](_0x44eacb['getUTCFullYear'](),_0x44eacb['getUTCMonth'](),0x1,0x0,0x0,0x0,0x0)),_0x53d88e=new Date(Date[_0x3af010(0x25d)](_0x44eacb[_0x3af010(0x1a8)](),_0x44eacb['getUTCMonth'](),_0x44eacb['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));break;case _0x3af010(0x297):_0x398103=new Date(Date[_0x3af010(0x25d)](_0x44eacb[_0x3af010(0x1a8)](),_0x44eacb['getUTCMonth']()-0x1,0x1,0x0,0x0,0x0,0x0)),_0x53d88e=new Date(Date[_0x3af010(0x25d)](_0x44eacb[_0x3af010(0x1a8)](),_0x44eacb[_0x3af010(0x22e)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case'all_time':_0x398103=new Date(Date['UTC'](0x7e9,0x5,0xe,0x0,0x0,0x0,0x0)),_0x53d88e=new Date(Date[_0x3af010(0x25d)](_0x44eacb['getUTCFullYear'](),_0x44eacb['getUTCMonth'](),_0x44eacb[_0x3af010(0x1fd)](),0x17,0x3b,0x3b,0x3e7));break;default:_0x398103=new Date(_0x44eacb[_0x3af010(0x21e)]()-0x1e*0x18*0x3c*0x3c*0x3e8);const _0x53cac7=new Date(Date[_0x3af010(0x25d)](_0x44eacb['getUTCFullYear'](),_0x44eacb[_0x3af010(0x22e)](),_0x44eacb[_0x3af010(0x1fd)]()-0x1e));_0x398103=new Date(Date['UTC'](_0x53cac7['getUTCFullYear'](),_0x53cac7['getUTCMonth'](),_0x53cac7['getUTCDate'](),0x0,0x0,0x0,0x0)),_0x53d88e=new Date(Date[_0x3af010(0x25d)](_0x44eacb['getUTCFullYear'](),_0x44eacb['getUTCMonth'](),_0x44eacb['getUTCDate'](),0x17,0x3b,0x3b,0x3e7));}const _0xd833bf={'gte':_0x398103,'lte':_0x53d88e};console[_0x3af010(0x220)](_0x3af010(0x237)+_0x398103[_0x3af010(0x2ce)]()+_0x3af010(0x191)+_0x53d88e['toISOString']());const [_0x35f10b,_0x258736,_0x5b1c47,_0x3d8966,_0x575b88,_0x3b0389,_0x2c86ab,_0x299f30,_0x2b9161]=await Promise[_0x3af010(0x21d)]([database_1[_0x3af010(0x246)][_0x3af010(0x248)]['count'](),database_1[_0x3af010(0x246)][_0x3af010(0x248)][_0x3af010(0x28d)]({'where':{'status':_0x3af010(0x2ed)}}),database_1[_0x3af010(0x246)][_0x3af010(0x1f8)][_0x3af010(0x28d)]({'where':{'status':_0x3af010(0x2dd),'createdAt':_0xd833bf,'gateway':{'not':_0x3af010(0x2b7)}}}),database_1[_0x3af010(0x246)][_0x3af010(0x1f8)]['count']({'where':{'status':_0x3af010(0x216),'createdAt':_0xd833bf,'gateway':{'not':_0x3af010(0x2b7)}}}),database_1['default'][_0x3af010(0x1f8)][_0x3af010(0x28d)]({'where':{'status':'REFUND','createdAt':_0xd833bf,'gateway':{'not':_0x3af010(0x2b7)}}}),database_1[_0x3af010(0x246)][_0x3af010(0x1f8)][_0x3af010(0x290)]({'where':{'status':_0x3af010(0x2dd),'createdAt':_0xd833bf,'gateway':{'not':_0x3af010(0x2b7)}},'select':{'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![]}}),database_1[_0x3af010(0x246)]['payment'][_0x3af010(0x290)]({'where':{'gateway':{'not':'test_gateway'}},'take':0xa,'orderBy':{'createdAt':_0x3af010(0x2a1)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x3af010(0x246)][_0x3af010(0x1f8)][_0x3af010(0x290)]({'where':{'createdAt':_0xd833bf,'gateway':{'not':_0x3af010(0x2b7)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}}),database_1[_0x3af010(0x246)][_0x3af010(0x1f8)][_0x3af010(0x290)]({'where':{'status':_0x3af010(0x2dd),'gateway':{'not':_0x3af010(0x2b7)}},'select':{'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![]}})]);console['log'](_0x3af010(0x19f)+_0x5b1c47);let _0x269155=0x0,_0x1074ca=0x0;for(const _0x153868 of _0x3b0389){const _0x139513=_0x153868[_0x3af010(0x2ec)]||0x0;_0x269155+=_0x139513;if(_0x153868[_0x3af010(0x252)]&&_0x153868[_0x3af010(0x2ec)]){const _0x38f67e=_0x153868[_0x3af010(0x2ec)]-_0x153868[_0x3af010(0x252)];_0x1074ca+=_0x38f67e;}}let _0x46bd00=0x0;for(const _0x5d4c32 of _0x2b9161){if(_0x5d4c32[_0x3af010(0x252)]&&_0x5d4c32['amountUSDT']){const _0x2f7c49=_0x5d4c32[_0x3af010(0x2ec)]-_0x5d4c32[_0x3af010(0x252)];_0x46bd00+=_0x2f7c49;}}const _0x43296e=_0x5b1c47>0x0?_0x269155/_0x5b1c47:0x0,_0x54cae0=this['generateDailyStatistics'](_0x299f30,_0x398103,_0x53d88e),_0x4b7aa6=await database_1[_0x3af010(0x246)][_0x3af010(0x1f8)][_0x3af010(0x28d)]({'where':{'createdAt':_0xd833bf,'gateway':{'not':_0x3af010(0x2b7)},'status':{'notIn':[_0x3af010(0x1a4),_0x3af010(0x299)]}}}),_0x4826d0=_0x4b7aa6>0x0?_0x5b1c47/_0x4b7aa6*0x64:0x0;return{'totalShops':_0x35f10b,'activeShops':_0x258736,'totalPayments':_0x4b7aa6,'successfulPayments':_0x5b1c47,'totalAttempts':_0x4b7aa6,'chargebacks':_0x3d8966,'refunds':_0x575b88,'totalRevenue':Math[_0x3af010(0x1b2)](_0x269155*0x64)/0x64,'trapayEarnings':Math[_0x3af010(0x1b2)](_0x1074ca*0x64)/0x64,'trapayEarningsAllTime':Math[_0x3af010(0x1b2)](_0x46bd00*0x64)/0x64,'averagePaymentAmount':Math[_0x3af010(0x1b2)](_0x43296e*0x64)/0x64,'conversionRate':Math[_0x3af010(0x1b2)](_0x4826d0*0x64)/0x64,'dailyRevenue':_0x54cae0[_0x3af010(0x277)],'dailyPayments':_0x54cae0['dailyPayments'],'recentPayments':_0x2c86ab['map'](_0x1d9dc7=>({'id':_0x1d9dc7['id'],'amount':_0x1d9dc7['amount'],'currency':_0x1d9dc7[_0x3af010(0x231)],'status':_0x1d9dc7[_0x3af010(0x2a8)],'gateway':_0x1d9dc7['gateway'],'shop':_0x1d9dc7[_0x3af010(0x248)],'createdAt':_0x1d9dc7[_0x3af010(0x20a)]}))};}}async[a48_0x1493df(0x21b)](_0x21ca86){const _0x554168=a48_0x1493df;console[_0x554168(0x220)](_0x554168(0x1d8),_0x21ca86);let _0x5b61ca,_0xde010b=new Date();if(_0x21ca86[_0x554168(0x278)]===_0x554168(0x298)&&_0x21ca86[_0x554168(0x19e)]&&_0x21ca86[_0x554168(0x181)]){const _0x1c8d3b=new Date(_0x21ca86[_0x554168(0x19e)]),_0x8d4b18=new Date(_0x21ca86[_0x554168(0x181)]);_0x5b61ca=new Date(Date[_0x554168(0x25d)](_0x1c8d3b['getUTCFullYear'](),_0x1c8d3b['getUTCMonth'](),_0x1c8d3b['getUTCDate'](),0x0,0x0,0x0,0x0)),_0xde010b=new Date(Date[_0x554168(0x25d)](_0x8d4b18['getUTCFullYear'](),_0x8d4b18[_0x554168(0x22e)](),_0x8d4b18[_0x554168(0x1fd)](),0x17,0x3b,0x3b,0x3e7));}else{const _0x35895f=new Date();switch(_0x21ca86[_0x554168(0x278)]){case _0x554168(0x2aa):_0x5b61ca=new Date(_0x35895f[_0x554168(0x21e)]()-0x7*0x18*0x3c*0x3c*0x3e8),_0x5b61ca[_0x554168(0x218)](0x0,0x0,0x0,0x0),_0xde010b['setHours'](0x17,0x3b,0x3b,0x3e7);break;case _0x554168(0x2e4):_0x5b61ca=new Date(Date[_0x554168(0x25d)](_0x35895f['getUTCFullYear'](),_0x35895f['getUTCMonth'](),0x1,0x0,0x0,0x0,0x0)),_0xde010b=new Date(Date['UTC'](_0x35895f[_0x554168(0x1a8)](),_0x35895f['getUTCMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7));break;case'lastMonth':_0x5b61ca=new Date(Date['UTC'](_0x35895f[_0x554168(0x1a8)](),_0x35895f[_0x554168(0x22e)]()-0x1,0x1,0x0,0x0,0x0,0x0)),_0xde010b=new Date(Date[_0x554168(0x25d)](_0x35895f[_0x554168(0x1a8)](),_0x35895f[_0x554168(0x22e)](),0x0,0x17,0x3b,0x3b,0x3e7));break;case _0x554168(0x276):_0x5b61ca=new Date(_0x35895f[_0x554168(0x21e)]()-0x16d*0x18*0x3c*0x3c*0x3e8),_0x5b61ca[_0x554168(0x218)](0x0,0x0,0x0,0x0),_0xde010b[_0x554168(0x218)](0x17,0x3b,0x3b,0x3e7);break;case _0x554168(0x21d):default:_0x5b61ca=new Date(_0x554168(0x2a5)),_0x5b61ca[_0x554168(0x218)](0x0,0x0,0x0,0x0),_0xde010b[_0x554168(0x218)](0x17,0x3b,0x3b,0x3e7);break;}}console[_0x554168(0x220)](_0x554168(0x186)+_0x5b61ca[_0x554168(0x2ce)]()+_0x554168(0x191)+_0xde010b['toISOString']());const _0x4459de={'status':'PAID','gateway':{'not':_0x554168(0x2b7)},'createdAt':{'gte':_0x5b61ca,'lte':_0xde010b}};_0x21ca86[_0x554168(0x207)]&&(_0x4459de[_0x554168(0x207)]=_0x21ca86[_0x554168(0x207)]);const _0x1aa02e=await database_1[_0x554168(0x246)]['payment'][_0x554168(0x290)]({'where':_0x4459de,'select':{'id':!![],'amount':!![],'currency':!![],'amountUSDT':!![],'amountAfterGatewayCommissionUSDT':!![],'gatewayCommissionRate':!![],'gateway':!![],'shopId':!![],'paidAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x554168(0x220)](_0x554168(0x1ae)+_0x1aa02e[_0x554168(0x270)]+_0x554168(0x1f2));const _0xe33f13={'gateway':{'not':_0x554168(0x2b7)},'status':{'notIn':[_0x554168(0x1a4),_0x554168(0x299)]},'createdAt':{'gte':_0x5b61ca,'lte':_0xde010b}};_0x21ca86['shopId']&&(_0xe33f13[_0x554168(0x207)]=_0x21ca86[_0x554168(0x207)]);const _0x5630f8=await database_1[_0x554168(0x246)][_0x554168(0x1f8)]['count']({'where':_0xe33f13}),_0x3e5e63={..._0xe33f13,'status':_0x554168(0x216)},_0x314c9c={..._0xe33f13,'status':_0x554168(0x1bf)},[_0x6c672a,_0x9b5882]=await Promise['all']([database_1[_0x554168(0x246)][_0x554168(0x1f8)][_0x554168(0x28d)]({'where':_0x3e5e63}),database_1[_0x554168(0x246)][_0x554168(0x1f8)][_0x554168(0x28d)]({'where':_0x314c9c})]);console[_0x554168(0x220)](_0x554168(0x244)+_0x5630f8+_0x554168(0x241)+_0x1aa02e['length']+_0x554168(0x17e)+_0x6c672a+_0x554168(0x19c)+_0x9b5882);let _0x5c6b17=0x0,_0x344ced=0x0,_0x10913f=0x0;const _0x2244a9={},_0xe3bc07={},_0x10d2a1={},_0xcdfad4=new Date(_0x5b61ca);while(_0xcdfad4<=_0xde010b){const _0x2ee000=_0xcdfad4[_0x554168(0x2ce)]()[_0x554168(0x1b9)]('T')[0x0];_0x10d2a1[_0x2ee000]={'date':_0x2ee000,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0},_0xcdfad4[_0x554168(0x18a)](_0xcdfad4['getUTCDate']()+0x1);}for(const _0x2e21f5 of _0x1aa02e){try{const _0x383417=_0x2e21f5[_0x554168(0x2ec)]||0x0;if(_0x383417<=0x0){console[_0x554168(0x247)](_0x554168(0x193)+_0x2e21f5['id']+_0x554168(0x1d1));continue;}let _0x49d43e,_0x24de13;if(_0x2e21f5[_0x554168(0x252)]!==null&&_0x2e21f5[_0x554168(0x252)]!==undefined)_0x49d43e=_0x2e21f5[_0x554168(0x252)],_0x24de13=_0x383417-_0x49d43e,console[_0x554168(0x220)](_0x554168(0x271)+_0x2e21f5['id']+':\x20'+_0x383417[_0x554168(0x286)](0x6)+_0x554168(0x185)+_0x49d43e[_0x554168(0x286)](0x6)+'\x20USDT');else{let _0x51fb9d={};if(_0x2e21f5[_0x554168(0x248)]['gatewaySettings'])try{_0x51fb9d=JSON[_0x554168(0x27c)](_0x2e21f5['shop'][_0x554168(0x262)]);}catch(_0x1c7392){console[_0x554168(0x217)](_0x554168(0x1dc)+_0x2e21f5[_0x554168(0x207)]+':',_0x1c7392);}let _0x50a0f0=0x2d;for(const [_0x21ba09,_0x354a5c]of Object['entries'](_0x51fb9d)){if(_0x21ba09[_0x554168(0x254)]()===_0x2e21f5[_0x554168(0x291)]['toLowerCase']()){_0x50a0f0=_0x354a5c['commission']||0x2d;break;}}_0x24de13=_0x383417*(_0x50a0f0/0x64),_0x49d43e=_0x383417-_0x24de13,console[_0x554168(0x220)]('ðŸ“Š\x20Calculating\x20commission\x20manually\x20for\x20payment\x20'+_0x2e21f5['id']+':\x20'+_0x50a0f0+'%\x20from\x20'+_0x383417[_0x554168(0x286)](0x6)+_0x554168(0x1ed));}_0x5c6b17+=_0x383417,_0x344ced+=_0x49d43e,_0x10913f+=_0x24de13;let _0x4eb6f1;_0x2e21f5['gatewayCommissionRate']!==null&&_0x2e21f5['gatewayCommissionRate']!==undefined?(_0x4eb6f1=_0x2e21f5[_0x554168(0x212)],console[_0x554168(0x220)](_0x554168(0x266)+_0x2e21f5['id']+':\x20'+_0x4eb6f1+'%')):(_0x4eb6f1=_0x383417>0x0?_0x24de13/_0x383417*0x64:0x0,console[_0x554168(0x220)](_0x554168(0x2be)+_0x2e21f5['id']+':\x20'+_0x4eb6f1['toFixed'](0x2)+'%'));!_0x2244a9[_0x2e21f5[_0x554168(0x291)]]&&(_0x2244a9[_0x2e21f5[_0x554168(0x291)]]={'gateway':_0x2e21f5[_0x554168(0x291)],'gatewayDisplayName':this[_0x554168(0x200)](_0x2e21f5[_0x554168(0x291)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x2244a9[_0x2e21f5['gateway']][_0x554168(0x26e)]++,_0x2244a9[_0x2e21f5[_0x554168(0x291)]][_0x554168(0x1a7)]+=_0x383417,_0x2244a9[_0x2e21f5[_0x554168(0x291)]]['commissionUSDT']+=_0x24de13,_0x2244a9[_0x2e21f5[_0x554168(0x291)]][_0x554168(0x1b6)]+=_0x49d43e,_0x2244a9[_0x2e21f5['gateway']][_0x554168(0x2ad)]+=_0x4eb6f1;!_0x21ca86[_0x554168(0x207)]&&(!_0xe3bc07[_0x2e21f5[_0x554168(0x207)]]&&(_0xe3bc07[_0x2e21f5[_0x554168(0x207)]]={'shopId':_0x2e21f5['shopId'],'shopName':_0x2e21f5[_0x554168(0x248)][_0x554168(0x28e)],'shopUsername':_0x2e21f5[_0x554168(0x248)][_0x554168(0x223)],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0xe3bc07[_0x2e21f5[_0x554168(0x207)]][_0x554168(0x26e)]++,_0xe3bc07[_0x2e21f5['shopId']][_0x554168(0x1a7)]+=_0x383417,_0xe3bc07[_0x2e21f5[_0x554168(0x207)]]['commissionUSDT']+=_0x24de13,_0xe3bc07[_0x2e21f5['shopId']][_0x554168(0x1b6)]+=_0x49d43e);const _0x147641=_0x2e21f5['paidAt'][_0x554168(0x2ce)]()[_0x554168(0x1b9)]('T')[0x0];_0x10d2a1[_0x147641]&&(_0x10d2a1[_0x147641][_0x554168(0x256)]+=_0x383417,_0x10d2a1[_0x147641]['merchantEarnings']+=_0x49d43e,_0x10d2a1[_0x147641][_0x554168(0x1c9)]+=_0x24de13,_0x10d2a1[_0x147641][_0x554168(0x26e)]++);}catch(_0x158afd){console['error'](_0x554168(0x1af)+_0x2e21f5['id']+':',_0x158afd);}}Object[_0x554168(0x236)](_0x2244a9)[_0x554168(0x1e7)](_0x15ab1d=>{const _0x457b5d=_0x554168;_0x15ab1d[_0x457b5d(0x249)]=_0x15ab1d['paymentsCount']>0x0?_0x15ab1d[_0x457b5d(0x2ad)]/_0x15ab1d[_0x457b5d(0x26e)]:0x0,delete _0x15ab1d[_0x457b5d(0x2ad)];}),Object[_0x554168(0x236)](_0xe3bc07)[_0x554168(0x1e7)](_0x15eaa8=>{const _0x3b6f3d=_0x554168;_0x15eaa8[_0x3b6f3d(0x28a)]=_0x15eaa8[_0x3b6f3d(0x26e)]>0x0?_0x15eaa8[_0x3b6f3d(0x1a7)]/_0x15eaa8['paymentsCount']:0x0;});let _0x402b2e=0x0,_0x22ee04=0x0;if(_0x21ca86[_0x554168(0x207)]){const _0x57dc38=await database_1[_0x554168(0x246)][_0x554168(0x1ee)][_0x554168(0x290)]({'where':{'shopId':_0x21ca86[_0x554168(0x207)],'status':_0x554168(0x1cc),'createdAt':{'gte':_0x5b61ca,'lte':_0xde010b}},'select':{'amount':!![]}});_0x402b2e=_0x57dc38[_0x554168(0x23d)]((_0x3465e8,_0x45aeec)=>_0x3465e8+_0x45aeec[_0x554168(0x243)],0x0);const _0x23a0a8=await database_1[_0x554168(0x246)]['payout'][_0x554168(0x290)]({'where':{'shopId':_0x21ca86[_0x554168(0x207)],'status':_0x554168(0x1a4),'createdAt':{'gte':_0x5b61ca,'lte':_0xde010b}},'select':{'amount':!![]}});_0x22ee04=_0x23a0a8['reduce']((_0x21441c,_0x52f3ef)=>_0x21441c+_0x52f3ef[_0x554168(0x243)],0x0);}const _0x25e1e2=_0x5630f8,_0x544945=_0x1aa02e[_0x554168(0x270)],_0x37592c=_0x544945>0x0?_0x5c6b17/_0x544945:0x0,_0x3df66c=_0x25e1e2>0x0?Math[_0x554168(0x1b2)](_0x544945/_0x25e1e2*0x2710)/0x64:0x0,_0x43f8b7=Math[_0x554168(0x1bd)]((_0xde010b['getTime']()-_0x5b61ca['getTime']())/(0x3e8*0x3c*0x3c*0x18)),_0x5a022f={'totalTurnover':Math[_0x554168(0x1b2)](_0x5c6b17*0x64)/0x64,'merchantEarnings':Math[_0x554168(0x1b2)](_0x344ced*0x64)/0x64,'gatewayEarnings':Math[_0x554168(0x1b2)](_0x10913f*0x64)/0x64,'totalPaidOut':Math[_0x554168(0x1b2)](_0x402b2e*0x64)/0x64,'pendingPayout':Math[_0x554168(0x1b2)](_0x22ee04*0x64)/0x64,'averageCheck':Math[_0x554168(0x1b2)](_0x37592c*0x64)/0x64,'totalPayments':_0x25e1e2,'successfulPayments':_0x544945,'conversionRate':_0x3df66c,'chargebacks':_0x6c672a,'refunds':_0x9b5882,'gatewayBreakdown':Object[_0x554168(0x236)](_0x2244a9)['map'](_0x2e5a6e=>({..._0x2e5a6e,'turnoverUSDT':Math[_0x554168(0x1b2)](_0x2e5a6e[_0x554168(0x1a7)]*0x64)/0x64,'commissionUSDT':Math[_0x554168(0x1b2)](_0x2e5a6e[_0x554168(0x2d7)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x554168(0x1b2)](_0x2e5a6e[_0x554168(0x1b6)]*0x64)/0x64,'averageCommissionRate':Math[_0x554168(0x1b2)](_0x2e5a6e['averageCommissionRate']*0x64)/0x64})),'merchantBreakdown':_0x21ca86['shopId']?undefined:Object['values'](_0xe3bc07)['map'](_0x5a17fc=>({..._0x5a17fc,'turnoverUSDT':Math['round'](_0x5a17fc[_0x554168(0x1a7)]*0x64)/0x64,'commissionUSDT':Math[_0x554168(0x1b2)](_0x5a17fc[_0x554168(0x2d7)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x554168(0x1b2)](_0x5a17fc['merchantEarningsUSDT']*0x64)/0x64,'paidOutUSDT':Math[_0x554168(0x1b2)](_0x5a17fc['paidOutUSDT']*0x64)/0x64,'averageCheckUSDT':Math['round'](_0x5a17fc['averageCheckUSDT']*0x64)/0x64})),'dailyData':Object['values'](_0x10d2a1)[_0x554168(0x184)](_0x25d64e=>({..._0x25d64e,'turnover':Math['round'](_0x25d64e['turnover']*0x64)/0x64,'merchantEarnings':Math[_0x554168(0x1b2)](_0x25d64e['merchantEarnings']*0x64)/0x64,'gatewayEarnings':Math[_0x554168(0x1b2)](_0x25d64e[_0x554168(0x1c9)]*0x64)/0x64}))['sort']((_0x4caf4b,_0x47f549)=>_0x4caf4b[_0x554168(0x2ca)]['localeCompare'](_0x47f549['date'])),'periodInfo':{'from':_0x5b61ca,'to':_0xde010b,'periodType':_0x21ca86[_0x554168(0x278)]||_0x554168(0x298),'daysCount':_0x43f8b7}};return console[_0x554168(0x220)](_0x554168(0x27f)),console['log']('\x20\x20\x20ðŸ’°\x20Total\x20turnover:\x20'+_0x5a022f['totalTurnover']+_0x554168(0x1ed)),console[_0x554168(0x220)](_0x554168(0x228)+_0x5a022f[_0x554168(0x1a6)]+_0x554168(0x1ed)),console[_0x554168(0x220)]('\x20\x20\x20ðŸª\x20Gateway\x20earnings:\x20'+_0x5a022f[_0x554168(0x1c9)]+'\x20USDT'),console[_0x554168(0x220)](_0x554168(0x234)+_0x5a022f[_0x554168(0x2bb)]+_0x554168(0x1ed)),console[_0x554168(0x220)](_0x554168(0x287)+_0x5a022f[_0x554168(0x1cf)]+_0x554168(0x1ed)),console[_0x554168(0x220)](_0x554168(0x235)+_0x5a022f[_0x554168(0x198)]),_0x5a022f;}async[a48_0x1493df(0x1e3)](_0x5319f8){const _0x5a17eb=a48_0x1493df;console[_0x5a17eb(0x220)]('ðŸ“‹\x20Getting\x20merchants\x20selection\x20list...',{'hasPayoutHistory':_0x5319f8});let _0x35976d={};_0x5319f8&&(_0x35976d[_0x5a17eb(0x190)]={'some':{}});const _0xe43920=await database_1['default'][_0x5a17eb(0x248)][_0x5a17eb(0x290)]({'where':_0x35976d,'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':'asc'}});return console['log'](_0x5a17eb(0x29f)+_0xe43920['length']+'\x20merchants\x20for\x20selection'+(_0x5319f8?_0x5a17eb(0x1f1):'')),_0xe43920[_0x5a17eb(0x184)](_0x1a123e=>({'id':_0x1a123e['id'],'username':_0x1a123e[_0x5a17eb(0x223)],'name':_0x1a123e[_0x5a17eb(0x28e)]}));}[a48_0x1493df(0x200)](_0x47dfb4){const _0x47d752=a48_0x1493df,_0x347732={'test_gateway':'Test\x20Gateway','plisio':_0x47d752(0x24a),'rapyd':'Rapyd','noda':_0x47d752(0x275),'cointopay':'CoinToPay','cointopay2':'Open\x20Banking\x202','klyme_eu':_0x47d752(0x233),'klyme_gb':_0x47d752(0x2d9),'klyme_de':'KLYME\x20DE','mastercard':_0x47d752(0x23e)};return _0x347732[_0x47dfb4]||_0x47dfb4;}[a48_0x1493df(0x2cc)](_0x16965a){const _0x265ced=a48_0x1493df,_0xdf25d={'Test\x20Gateway':_0x265ced(0x2b7),'Plisio':_0x265ced(0x239),'Rapyd':_0x265ced(0x214),'Noda':_0x265ced(0x1c6),'CoinToPay':_0x265ced(0x1d2),'CoinToPay2':_0x265ced(0x2ba),'KLYME\x20EU':_0x265ced(0x25f),'KLYME\x20GB':_0x265ced(0x27d),'KLYME\x20DE':'klyme_de','MasterCard':'mastercard'};return _0xdf25d[_0x16965a]||_0x16965a[_0x265ced(0x254)]();}async[a48_0x1493df(0x1ff)](_0x10bea5){const _0x44f904=a48_0x1493df,{page:_0x484924,limit:_0x48f9d9,minAmount:_0x1e6f7a,search:_0x1c63dd}=_0x10bea5;console[_0x44f904(0x220)](_0x44f904(0x2d8),_0x10bea5);let _0x3e82e7={};_0x1c63dd&&(_0x3e82e7[_0x44f904(0x28e)]={'contains':_0x1c63dd,'mode':_0x44f904(0x284)});const _0x3b8726=await database_1[_0x44f904(0x246)][_0x44f904(0x248)]['findMany']({'where':_0x3e82e7,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),_0x1859af=_0x3b8726[_0x44f904(0x260)](_0xac3b62=>{const _0x162d1c=_0x44f904,_0x141aa0=Math[_0x162d1c(0x255)](_0xac3b62[_0x162d1c(0x1f4)]*0x64)/0x64;if(_0x1e6f7a&&_0x141aa0<_0x1e6f7a)return![];return _0x141aa0!==0x0;});_0x1859af[_0x44f904(0x1ac)]((_0x24ef2f,_0x4693a5)=>_0x4693a5[_0x44f904(0x1f4)]-_0x24ef2f[_0x44f904(0x1f4)]);const _0x40b856=_0x1859af['length'],_0x38e608=(_0x484924-0x1)*_0x48f9d9,_0x595c86=_0x1859af[_0x44f904(0x26c)](_0x38e608,_0x38e608+_0x48f9d9);console['log'](_0x44f904(0x1ae)+_0x595c86[_0x44f904(0x270)]+_0x44f904(0x196));const _0x3e9f94=await Promise[_0x44f904(0x21d)](_0x595c86[_0x44f904(0x184)](async _0x208441=>{const _0x869691=_0x44f904,[_0x4c87cd,_0x216aff,_0x1f92be]=await Promise['all']([database_1[_0x869691(0x246)][_0x869691(0x1f8)][_0x869691(0x28d)]({'where':{'shopId':_0x208441['id'],'status':_0x869691(0x2dd),'gateway':{'not':'test_gateway'}}}),database_1['default'][_0x869691(0x1f8)][_0x869691(0x19a)]({'where':{'shopId':_0x208441['id'],'status':_0x869691(0x2dd),'gateway':{'not':_0x869691(0x2b7)}},'orderBy':{'paidAt':'asc'},'select':{'paidAt':!![]}}),database_1[_0x869691(0x246)][_0x869691(0x1f8)][_0x869691(0x230)]({'by':['gateway'],'where':{'shopId':_0x208441['id'],'status':_0x869691(0x2dd),'gateway':{'not':'test_gateway'}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0xcf9b15=new Date(),_0x4bea5e=new Date(_0xcf9b15['getFullYear'](),_0xcf9b15['getMonth'](),0x1),_0x238976=new Date(_0xcf9b15['getFullYear'](),_0xcf9b15[_0x869691(0x1d9)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x44c91f,_0x4e38e4]=await Promise[_0x869691(0x21d)]([database_1[_0x869691(0x246)]['payout'][_0x869691(0x19d)]({'_sum':{'amount':!![]},'where':{'shopId':_0x208441['id'],'status':_0x869691(0x1cc)}}),database_1['default']['payout']['aggregate']({'_sum':{'amount':!![]},'where':{'shopId':_0x208441['id'],'status':_0x869691(0x1cc),'createdAt':{'gte':_0x4bea5e,'lte':_0x238976}}})]),_0x59960a=_0x44c91f['_sum']['amount']||0x0,_0x3b6e35=_0x4e38e4[_0x869691(0x222)][_0x869691(0x243)]||0x0,_0x1b7ce8=await Promise[_0x869691(0x21d)](_0x1f92be['map'](async _0x415e12=>{const _0x53d544=_0x869691;let _0x131303=0x2d;if(_0x208441[_0x53d544(0x262)])try{const _0x4223b5=JSON[_0x53d544(0x27c)](_0x208441[_0x53d544(0x262)]);for(const [_0x29eba5,_0x838500]of Object[_0x53d544(0x27b)](_0x4223b5)){if(_0x29eba5[_0x53d544(0x254)]()===_0x415e12[_0x53d544(0x291)][_0x53d544(0x254)]()){_0x131303=_0x838500[_0x53d544(0x202)]||0xa,console['log'](_0x53d544(0x1fe)+_0x415e12[_0x53d544(0x291)]+_0x53d544(0x2bf)+_0x208441['id']+_0x53d544(0x199)+_0x131303+'%');break;}}}catch(_0x26a192){console['error'](_0x53d544(0x1dc)+_0x208441['id']+':',_0x26a192);}const _0x2a5a9e=_0x415e12[_0x53d544(0x222)]?.[_0x53d544(0x2ec)]||0x0,_0x7c7452=_0x2a5a9e*(0x1-_0x131303/0x64);return{'gateway':_0x415e12[_0x53d544(0x291)],'count':_0x415e12['_count']?.['id']||0x0,'amountUSDT':Math['round'](_0x2a5a9e*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x53d544(0x1b2)](_0x7c7452*0x64)/0x64,'commission':_0x131303};})),_0x3df5fd=_0x1b7ce8['reduce']((_0x9a172f,_0x1cb924)=>_0x9a172f+_0x1cb924[_0x869691(0x2ec)],0x0),_0x3b4eeb=_0x1b7ce8[_0x869691(0x23d)]((_0x252b38,_0x3bd747)=>_0x252b38+_0x3bd747[_0x869691(0x194)],0x0),_0x293e44=_0x208441[_0x869691(0x1f4)];return console['log'](_0x869691(0x22d)+_0x208441[_0x869691(0x223)]+':'),console['log']('\x20\x20\x20ï¿½\x20Total\x20payments\x20turnover:\x20'+_0x3df5fd['toFixed'](0x2)+_0x869691(0x2c7)),console[_0x869691(0x220)](_0x869691(0x296)+_0x3b4eeb[_0x869691(0x286)](0x2)+'\x20USDT\x20(theoretical\x20net)'),console[_0x869691(0x220)](_0x869691(0x288)+_0x293e44['toFixed'](0x2)+_0x869691(0x1e0)),console[_0x869691(0x220)](_0x869691(0x2ee)+_0x59960a['toFixed'](0x2)+_0x869691(0x2ef)),console[_0x869691(0x220)](_0x869691(0x2cb)+(_0x3b4eeb-_0x59960a-_0x293e44)[_0x869691(0x286)](0x2)+'\x20USDT\x20(calculated\x20-\x20payouts\x20-\x20balance)'),{'id':_0x208441['id'],'fullName':_0x208441[_0x869691(0x28e)],'username':_0x208441['username'],'telegramId':_0x208441[_0x869691(0x20f)],'merchantUrl':_0x208441[_0x869691(0x2eb)],'wallets':{'usdtPolygonWallet':_0x208441[_0x869691(0x1b5)],'usdtTrcWallet':_0x208441[_0x869691(0x2cd)],'usdtErcWallet':_0x208441['usdtErcWallet'],'usdcPolygonWallet':_0x208441[_0x869691(0x2dc)],'usdcErcWallet':_0x208441[_0x869691(0x25a)]},'totalAmountUSDT':Math['round'](_0x3df5fd*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x869691(0x1b2)](_0x3b4eeb*0x64)/0x64,'currentBalance':Math[_0x869691(0x255)](_0x293e44*0x64)/0x64,'totalPayout':Math[_0x869691(0x1b2)](_0x59960a*0x64)/0x64,'thisMonth':Math[_0x869691(0x1b2)](_0x3b6e35*0x64)/0x64,'paymentsCount':_0x4c87cd,'oldestPaymentDate':_0x216aff?.[_0x869691(0x2c4)]||_0x208441[_0x869691(0x20a)],'gatewayBreakdown':_0x1b7ce8};})),_0x3b8fb5=_0x3e9f94[_0x44f904(0x23d)]((_0x4201a0,_0x186ccf)=>_0x4201a0+_0x186ccf[_0x44f904(0x1e5)],0x0),_0x38a3e8=_0x3e9f94[_0x44f904(0x23d)]((_0x3e56ac,_0x352b4b)=>_0x3e56ac+_0x352b4b[_0x44f904(0x1c7)],0x0),_0x578372=_0x3e9f94[_0x44f904(0x23d)]((_0x50c695,_0x3fbfde)=>_0x50c695+_0x3fbfde['totalPayout'],0x0),_0xcbd180=_0x3e9f94[_0x44f904(0x23d)]((_0x2627be,_0x34200b)=>_0x2627be+_0x34200b['thisMonth'],0x0);return console[_0x44f904(0x220)](_0x44f904(0x2b8)+_0x40b856+_0x44f904(0x23c)),console[_0x44f904(0x220)](_0x44f904(0x1ef)+Math[_0x44f904(0x1b2)](_0x3b8fb5*0x64)/0x64+'\x20USDT\x20(gross\x20revenue)'),console[_0x44f904(0x220)](_0x44f904(0x227)+Math[_0x44f904(0x1b2)](_0x38a3e8*0x64)/0x64+'\x20USDT\x20(rounded\x20to\x202\x20decimal\x20places)'),console[_0x44f904(0x220)]('\x20\x20\x20ðŸ’¸\x20Total\x20payouts\x20(all\x20time):\x20'+Math[_0x44f904(0x1b2)](_0x578372*0x64)/0x64+_0x44f904(0x1ed)),console[_0x44f904(0x220)]('\x20\x20\x20ðŸ“…\x20Total\x20payouts\x20(this\x20month):\x20'+Math[_0x44f904(0x1b2)](_0xcbd180*0x64)/0x64+'\x20USDT'),{'merchants':_0x3e9f94,'pagination':{'page':_0x484924,'limit':_0x48f9d9,'total':_0x40b856,'totalPages':Math[_0x44f904(0x1bd)](_0x40b856/_0x48f9d9)},'summary':{'totalMerchants':_0x40b856,'totalAmountUSDT':Math[_0x44f904(0x1b2)](_0x3b8fb5*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x44f904(0x1b2)](_0x38a3e8*0x64)/0x64,'totalPayout':Math[_0x44f904(0x1b2)](_0x578372*0x64)/0x64,'thisMonth':Math['round'](_0xcbd180*0x64)/0x64}};}async[a48_0x1493df(0x2d1)](_0xc28f70){const _0x11c0cb=a48_0x1493df,{shopId:_0x101b1c,amount:_0x1c082e,network:_0xb94b3b,wallet:_0x4acbee,notes:_0x1133d0,txid:_0x51d4c6,periodFrom:_0x244009,periodTo:_0x1f9d01}=_0xc28f70,_0x3bb4e3=await database_1[_0x11c0cb(0x246)][_0x11c0cb(0x2b3)](async _0x5410d3=>{const _0x14fbca=_0x11c0cb,_0x2a6836=await _0x5410d3['shop']['findUnique']({'where':{'id':_0x101b1c},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x2a6836)throw new Error('Shop\x20not\x20found');console[_0x14fbca(0x220)](_0x14fbca(0x263)+_0x2a6836[_0x14fbca(0x223)]+':'),console[_0x14fbca(0x220)]('\x20\x20\x20Current\x20balance:\x20'+_0x2a6836[_0x14fbca(0x1f4)]['toFixed'](0x6)+'\x20USDT'),console[_0x14fbca(0x220)](_0x14fbca(0x295)+_0x1c082e['toFixed'](0x6)+'\x20USDT'),console['log'](_0x14fbca(0x2c5)+_0x2a6836[_0x14fbca(0x2bb)]['toFixed'](0x6)+_0x14fbca(0x1ed));if(_0x51d4c6)console['log'](_0x14fbca(0x261)+_0x51d4c6);const _0x5e887a=0.000001,_0x2be69c=Number(_0x2a6836[_0x14fbca(0x1f4)]),_0x22da70=Number(_0x1c082e);console[_0x14fbca(0x220)](_0x14fbca(0x279)),console[_0x14fbca(0x220)]('\x20\x20\x20Available\x20(raw):\x20'+_0x2a6836[_0x14fbca(0x1f4)]),console[_0x14fbca(0x220)](_0x14fbca(0x20c)+_0x2be69c),console[_0x14fbca(0x220)](_0x14fbca(0x1db)+_0x22da70),console['log'](_0x14fbca(0x1e1)+(_0x2be69c-_0x22da70)),console[_0x14fbca(0x220)](_0x14fbca(0x1e8)+_0x5e887a);if(_0x2be69c<_0x22da70-_0x5e887a)throw new Error(_0x14fbca(0x28f)+_0x2be69c[_0x14fbca(0x286)](0x6)+_0x14fbca(0x25e)+_0x22da70[_0x14fbca(0x286)](0x6)+_0x14fbca(0x264)+(_0x2be69c-_0x22da70)[_0x14fbca(0x286)](0x8)+_0x14fbca(0x1ed));console[_0x14fbca(0x220)]('âœ…\x20Balance\x20check\x20passed\x20(with\x20tolerance)');const _0x275d5c=Math[_0x14fbca(0x1f6)](_0x2be69c,_0x22da70);let _0x4a860f=_0x4acbee;console['log'](_0x14fbca(0x272)+(_0x4acbee||_0x14fbca(0x240)));if(!_0x4a860f){console[_0x14fbca(0x220)](_0x14fbca(0x206));const _0x53808a=await _0x5410d3[_0x14fbca(0x248)][_0x14fbca(0x2cf)]({'where':{'id':_0x101b1c},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![]}});console['log'](_0x14fbca(0x29d),_0x53808a);if(_0x53808a)switch(_0xb94b3b){case _0x14fbca(0x1b4):_0x4a860f=_0x53808a['usdtPolygonWallet']||undefined,console[_0x14fbca(0x220)](_0x14fbca(0x2e9)+_0x4a860f);break;case _0x14fbca(0x26b):_0x4a860f=_0x53808a[_0x14fbca(0x2cd)]||undefined,console[_0x14fbca(0x220)]('ðŸ”\x20Selected\x20trc20\x20wallet:\x20'+_0x4a860f);break;case _0x14fbca(0x285):_0x4a860f=_0x53808a[_0x14fbca(0x2ab)]||undefined,console[_0x14fbca(0x220)](_0x14fbca(0x268)+_0x4a860f);break;case _0x14fbca(0x18d):_0x4a860f=_0x53808a['usdcPolygonWallet']||undefined,console[_0x14fbca(0x220)]('ðŸ”\x20Selected\x20polygon_usdc\x20wallet:\x20'+_0x4a860f);break;case'erc20_usdc':_0x4a860f=_0x53808a[_0x14fbca(0x25a)]||undefined,console['log']('ðŸ”\x20Selected\x20erc20_usdc\x20wallet:\x20'+_0x4a860f);break;}}else console['log'](_0x14fbca(0x26f)+_0x4a860f);console[_0x14fbca(0x220)]('ðŸ’³\x20Final\x20payout\x20wallet\x20for\x20'+_0xb94b3b+':\x20'+(_0x4a860f||_0x14fbca(0x2af))),console['log']('ðŸ”\x20Creating\x20payout\x20with\x20data:',{'shopId':_0x101b1c,'amount':_0x275d5c,'network':_0xb94b3b,'wallet':_0x4a860f,'status':_0x14fbca(0x1cc),'txid':_0x51d4c6,'notes':_0x1133d0,'periodFrom':_0x244009?new Date(_0x244009):null,'periodTo':_0x1f9d01?new Date(_0x1f9d01):null});const _0x26a1da=await _0x5410d3[_0x14fbca(0x1ee)][_0x14fbca(0x2df)]({'data':{'shopId':_0x101b1c,'amount':_0x275d5c,'network':_0xb94b3b,'wallet':_0x4a860f,'status':_0x14fbca(0x1cc),'txid':_0x51d4c6,'notes':_0x1133d0,'periodFrom':_0x244009?new Date(_0x244009):null,'periodTo':_0x1f9d01?new Date(_0x1f9d01):null,'createdAt':new Date(),'paidAt':new Date()}});console['log']('âœ…\x20Payout\x20created\x20in\x20DB:',{'id':_0x26a1da['id'],'wallet':_0x26a1da[_0x14fbca(0x2b4)],'network':_0x26a1da['network'],'amount':_0x26a1da['amount']});const _0x526a65=_0x2be69c-_0x275d5c,_0x22753e=Number(_0x2a6836[_0x14fbca(0x2bb)])+_0x275d5c;return await _0x5410d3[_0x14fbca(0x248)][_0x14fbca(0x1c3)]({'where':{'id':_0x101b1c},'data':{'balance':_0x526a65,'totalPaidOut':_0x22753e}}),console[_0x14fbca(0x220)](_0x14fbca(0x1ec)+_0x2a6836[_0x14fbca(0x223)]+_0x14fbca(0x219)),console[_0x14fbca(0x220)](_0x14fbca(0x182)+_0x2be69c['toFixed'](0x6)+_0x14fbca(0x21f)+_0x526a65[_0x14fbca(0x286)](0x6)+_0x14fbca(0x1c5)+_0x275d5c[_0x14fbca(0x286)](0x6)+')'),console[_0x14fbca(0x220)](_0x14fbca(0x2e3)+_0x2a6836['totalPaidOut'][_0x14fbca(0x286)](0x6)+_0x14fbca(0x21f)+_0x22753e[_0x14fbca(0x286)](0x6)+_0x14fbca(0x192)+_0x275d5c[_0x14fbca(0x286)](0x6)+')'),console[_0x14fbca(0x220)](_0x14fbca(0x1f7)+_0x275d5c['toFixed'](0x6)+_0x14fbca(0x1ed)),{'payout':_0x26a1da,'shop':_0x2a6836};});console[_0x11c0cb(0x220)]('âœ…\x20Payout\x20created:\x20'+_0x3bb4e3['payout']['id']+_0x11c0cb(0x2bf)+_0x3bb4e3[_0x11c0cb(0x248)]['username']+'\x20('+_0x3bb4e3['payout']['amount']['toFixed'](0x6)+'\x20USDT)');try{let _0x439478=_0x11c0cb(0x26d);if(_0x3bb4e3[_0x11c0cb(0x1ee)][_0x11c0cb(0x215)]&&_0x3bb4e3[_0x11c0cb(0x1ee)][_0x11c0cb(0x1e6)]){const _0x316d77=new Date(_0x3bb4e3[_0x11c0cb(0x1ee)]['periodFrom'])[_0x11c0cb(0x1c1)](_0x11c0cb(0x1da)),_0x373c1a=new Date(_0x3bb4e3['payout'][_0x11c0cb(0x1e6)])[_0x11c0cb(0x1c1)](_0x11c0cb(0x1da));_0x439478=_0x316d77+_0x11c0cb(0x2da)+_0x373c1a;}await telegramBotService_1[_0x11c0cb(0x27a)]['sendPayoutNotification'](_0x3bb4e3[_0x11c0cb(0x1ee)][_0x11c0cb(0x207)],{'id':_0x3bb4e3[_0x11c0cb(0x1ee)]['id'],'amount':_0x3bb4e3[_0x11c0cb(0x1ee)][_0x11c0cb(0x243)],'network':_0x3bb4e3[_0x11c0cb(0x1ee)][_0x11c0cb(0x2db)],'wallet':_0x3bb4e3[_0x11c0cb(0x1ee)]['wallet'],'period':_0x439478,'createdAt':_0x3bb4e3[_0x11c0cb(0x1ee)][_0x11c0cb(0x20a)],'txid':_0x3bb4e3['payout'][_0x11c0cb(0x1b1)]}),console['log'](_0x11c0cb(0x28c)+_0x3bb4e3[_0x11c0cb(0x1ee)]['id']);}catch(_0x5553f9){console['error'](_0x11c0cb(0x280)+_0x3bb4e3[_0x11c0cb(0x1ee)]['id']+':',_0x5553f9);}return{'id':_0x3bb4e3[_0x11c0cb(0x1ee)]['id'],'shopId':_0x3bb4e3[_0x11c0cb(0x1ee)][_0x11c0cb(0x207)],'shopName':_0x3bb4e3['shop'][_0x11c0cb(0x28e)],'shopUsername':_0x3bb4e3[_0x11c0cb(0x248)][_0x11c0cb(0x223)],'amount':_0x3bb4e3[_0x11c0cb(0x1ee)][_0x11c0cb(0x243)],'network':_0x3bb4e3[_0x11c0cb(0x1ee)]['network'],'wallet':_0x3bb4e3[_0x11c0cb(0x1ee)][_0x11c0cb(0x2b4)],'status':_0x3bb4e3[_0x11c0cb(0x1ee)][_0x11c0cb(0x2a8)],'txid':_0x3bb4e3[_0x11c0cb(0x1ee)][_0x11c0cb(0x1b1)],'notes':_0x3bb4e3[_0x11c0cb(0x1ee)][_0x11c0cb(0x1eb)],'periodFrom':_0x3bb4e3['payout'][_0x11c0cb(0x215)],'periodTo':_0x3bb4e3['payout'][_0x11c0cb(0x1e6)],'createdAt':_0x3bb4e3[_0x11c0cb(0x1ee)]['createdAt'],'paidAt':_0x3bb4e3['payout'][_0x11c0cb(0x2c4)]};}async[a48_0x1493df(0x29b)](_0x99ffc0){const _0x58a530=a48_0x1493df,{page:_0x25b86b,limit:_0x2c76bb,shopId:_0x28f906,network:_0xd1bb9b,dateFrom:_0x337b25,dateTo:_0x157de1,search:_0x248ab8}=_0x99ffc0,_0xf89a12=(_0x25b86b-0x1)*_0x2c76bb,_0x3d7d79={};_0x28f906&&(_0x3d7d79['shopId']=_0x28f906);_0xd1bb9b&&(_0x3d7d79['network']=_0xd1bb9b);if(_0x337b25||_0x157de1){_0x3d7d79[_0x58a530(0x20a)]={};if(_0x337b25){const _0x15eb9c=new Date(_0x337b25);_0x15eb9c[_0x58a530(0x218)](0x0,0x0,0x0,0x1),_0x3d7d79[_0x58a530(0x20a)][_0x58a530(0x205)]=_0x15eb9c,console[_0x58a530(0x220)](_0x58a530(0x1f3)+_0x15eb9c[_0x58a530(0x2ce)]());}if(_0x157de1){const _0x5b07af=new Date(_0x157de1);_0x5b07af['setHours'](0x17,0x3b,0x3b,0x3e7),_0x3d7d79[_0x58a530(0x20a)][_0x58a530(0x2e6)]=_0x5b07af,console[_0x58a530(0x220)]('ðŸ“…\x20Payout\x20date\x20to\x20filter:\x20'+_0x5b07af[_0x58a530(0x2ce)]());}}_0x248ab8&&(_0x3d7d79['OR']=[{'shop':{'name':{'contains':_0x248ab8,'mode':_0x58a530(0x284)}}},{'shop':{'username':{'contains':_0x248ab8,'mode':_0x58a530(0x284)}}},{'notes':{'contains':_0x248ab8,'mode':_0x58a530(0x284)}}]);const [_0x17ee5f,_0x33a615]=await Promise[_0x58a530(0x21d)]([database_1[_0x58a530(0x246)][_0x58a530(0x1ee)][_0x58a530(0x290)]({'where':_0x3d7d79,'skip':_0xf89a12,'take':_0x2c76bb,'orderBy':{'createdAt':_0x58a530(0x2a1)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'wallet':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x58a530(0x1ee)][_0x58a530(0x28d)]({'where':_0x3d7d79})]);return{'payouts':_0x17ee5f['map'](_0x39d57a=>({'id':_0x39d57a['id'],'shopId':_0x39d57a[_0x58a530(0x207)],'shopName':_0x39d57a[_0x58a530(0x248)][_0x58a530(0x28e)],'shopUsername':_0x39d57a[_0x58a530(0x248)][_0x58a530(0x223)],'amount':_0x39d57a['amount'],'network':_0x39d57a[_0x58a530(0x2db)],'wallet':_0x39d57a[_0x58a530(0x2b4)],'status':_0x39d57a[_0x58a530(0x2a8)],'txid':_0x39d57a['txid'],'notes':_0x39d57a[_0x58a530(0x1eb)],'periodFrom':_0x39d57a[_0x58a530(0x215)],'periodTo':_0x39d57a['periodTo'],'createdAt':_0x39d57a[_0x58a530(0x20a)],'paidAt':_0x39d57a['paidAt']})),'pagination':{'page':_0x25b86b,'limit':_0x2c76bb,'total':_0x33a615,'totalPages':Math['ceil'](_0x33a615/_0x2c76bb)}};}async[a48_0x1493df(0x24e)](_0x461913){const _0x3a1791=a48_0x1493df,_0x2c6b2e=await database_1[_0x3a1791(0x246)][_0x3a1791(0x1ee)][_0x3a1791(0x2cf)]({'where':{'id':_0x461913},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x2c6b2e)return null;return{'id':_0x2c6b2e['id'],'shopId':_0x2c6b2e['shopId'],'shopName':_0x2c6b2e[_0x3a1791(0x248)][_0x3a1791(0x28e)],'shopUsername':_0x2c6b2e[_0x3a1791(0x248)][_0x3a1791(0x223)],'amount':_0x2c6b2e[_0x3a1791(0x243)],'network':_0x2c6b2e['network'],'wallet':_0x2c6b2e[_0x3a1791(0x2b4)],'status':_0x2c6b2e[_0x3a1791(0x2a8)],'txid':_0x2c6b2e[_0x3a1791(0x1b1)],'notes':_0x2c6b2e['notes'],'periodFrom':_0x2c6b2e[_0x3a1791(0x215)],'periodTo':_0x2c6b2e[_0x3a1791(0x1e6)],'createdAt':_0x2c6b2e[_0x3a1791(0x20a)],'paidAt':_0x2c6b2e['paidAt']};}async[a48_0x1493df(0x245)](_0x313ba5){const _0x43c1d0=a48_0x1493df;await database_1[_0x43c1d0(0x246)][_0x43c1d0(0x1ee)]['delete']({'where':{'id':_0x313ba5}});}async[a48_0x1493df(0x20d)](_0x17b240){const _0x20f620=a48_0x1493df,{page:_0xa780f9,limit:_0x4744bb,status:_0x13426d,gateway:_0xb1348,shopId:_0x5d95b6,dateFrom:_0x275a44,dateTo:_0x5397f2,search:_0x1d4fdb,currency:_0x37ea97,sortBy:_0x10e06a,sortOrder:_0x47fba3}=_0x17b240,_0x51af5c=(_0xa780f9-0x1)*_0x4744bb;console[_0x20f620(0x220)]('ðŸ“Š\x20Getting\x20payments\x20with\x20filters:',_0x17b240);const _0x18b4ea=await database_1[_0x20f620(0x246)][_0x20f620(0x1f8)][_0x20f620(0x230)]({'by':[_0x20f620(0x291)],'_count':{'gateway':!![]}});console[_0x20f620(0x220)](_0x20f620(0x27e),_0x18b4ea['map'](_0x3c8c14=>_0x3c8c14[_0x20f620(0x291)]+'\x20('+_0x3c8c14['_count'][_0x20f620(0x291)]+'\x20payments)'));if(_0xb1348){const _0x5e485e=_0x18b4ea[_0x20f620(0x2d2)](_0x14452b=>_0x14452b['gateway'][_0x20f620(0x254)]()===_0xb1348[_0x20f620(0x254)]());!_0x5e485e&&_0xb1348[_0x20f620(0x254)]()!==_0x20f620(0x2b7)&&console['log']('âš ï¸\x20Requested\x20gateway\x20\x27'+_0xb1348+_0x20f620(0x25b)+_0x18b4ea[_0x20f620(0x184)](_0x18f6ff=>_0x18f6ff[_0x20f620(0x291)])['join'](',\x20'));}const _0x274a7f={};_0x13426d&&(_0x274a7f[_0x20f620(0x2a8)]=_0x13426d[_0x20f620(0x253)]());if(!_0xb1348)_0x274a7f['gateway']={'not':_0x20f620(0x2b7)};else{if(_0xb1348&&(_0xb1348[_0x20f620(0x254)]()===_0x20f620(0x2b7)||_0xb1348===_0x20f620(0x21a)))_0x274a7f[_0x20f620(0x291)]=_0x20f620(0x2b7);else{let _0x44eb74=_0xb1348;const _0x2a2e5d=(0x0,gateway_1['getGatewayNameById'])(_0xb1348);if(_0x2a2e5d)_0x44eb74=_0x2a2e5d,console[_0x20f620(0x220)]('ðŸ”„\x20Converted\x20gateway\x20ID\x20\x27'+_0xb1348+_0x20f620(0x1ad)+_0x44eb74+'\x27');else{const _0xda6482=(0x0,gateway_1[_0x20f620(0x2e8)])(_0xb1348);if(_0xda6482){const _0x207c8b=(0x0,gateway_1[_0x20f620(0x24b)])(_0xda6482);_0x207c8b&&(_0x44eb74=_0x207c8b,console[_0x20f620(0x220)](_0x20f620(0x1d7)+_0xb1348+_0x20f620(0x2ae)+_0xda6482+_0x20f620(0x1d4)+_0x44eb74+'\x27'));}else console[_0x20f620(0x220)](_0x20f620(0x250)+_0xb1348+_0x20f620(0x1be));}const _0x150b76=await database_1[_0x20f620(0x246)][_0x20f620(0x1f8)][_0x20f620(0x28d)]({'where':{'gateway':_0x44eb74[_0x20f620(0x254)]()},'take':0x1});_0x150b76===0x0?(console[_0x20f620(0x220)]('âš ï¸\x20Gateway\x20\x27'+_0x44eb74+_0x20f620(0x22a)+_0xb1348+_0x20f620(0x2b9)),_0x274a7f[_0x20f620(0x291)]=_0x20f620(0x283)):(_0x274a7f[_0x20f620(0x291)]=_0x44eb74[_0x20f620(0x254)](),console[_0x20f620(0x220)](_0x20f620(0x24d)+_0x44eb74+_0x20f620(0x22a)+_0xb1348+'\x27)'));}}console[_0x20f620(0x220)](_0x20f620(0x293),_0x274a7f[_0x20f620(0x291)]);_0x5d95b6&&(_0x274a7f[_0x20f620(0x207)]=_0x5d95b6);_0x37ea97&&(_0x274a7f[_0x20f620(0x231)]=_0x37ea97['toUpperCase'](),console[_0x20f620(0x220)](_0x20f620(0x282)+_0x37ea97[_0x20f620(0x253)]()));if(_0x275a44||_0x5397f2){_0x274a7f[_0x20f620(0x20a)]={};if(_0x275a44){const _0x5bb744=new Date(_0x275a44),_0x409b68=new Date(Date[_0x20f620(0x25d)](_0x5bb744['getUTCFullYear'](),_0x5bb744['getUTCMonth'](),_0x5bb744[_0x20f620(0x1fd)](),0x0,0x0,0x0,0x0));_0x274a7f['createdAt'][_0x20f620(0x205)]=_0x409b68,console['log'](_0x20f620(0x269)+_0x409b68[_0x20f620(0x2ce)]());}if(_0x5397f2){const _0x261e38=new Date(_0x5397f2),_0x37c1cf=new Date(Date[_0x20f620(0x25d)](_0x261e38[_0x20f620(0x1a8)](),_0x261e38['getUTCMonth'](),_0x261e38[_0x20f620(0x1fd)](),0x17,0x3b,0x3b,0x3e7));_0x274a7f[_0x20f620(0x20a)][_0x20f620(0x2e6)]=_0x37c1cf,console['log']('ðŸ“…\x20Date\x20to\x20filter:\x20'+_0x37c1cf[_0x20f620(0x2ce)]());}}_0x1d4fdb&&(_0x274a7f['OR']=[{'id':{'contains':_0x1d4fdb,'mode':_0x20f620(0x284)}},{'orderId':{'contains':_0x1d4fdb,'mode':_0x20f620(0x284)}},{'gatewayOrderId':{'contains':_0x1d4fdb,'mode':_0x20f620(0x284)}},{'customerEmail':{'contains':_0x1d4fdb,'mode':_0x20f620(0x284)}},{'shop':{'name':{'contains':_0x1d4fdb,'mode':_0x20f620(0x284)}}},{'shop':{'username':{'contains':_0x1d4fdb,'mode':_0x20f620(0x284)}}}]);console[_0x20f620(0x220)]('ðŸ“Š\x20Final\x20WHERE\x20conditions:',JSON[_0x20f620(0x2b2)](_0x274a7f,null,0x2));const _0x33d1c6=await database_1[_0x20f620(0x246)][_0x20f620(0x1f8)][_0x20f620(0x28d)]({'where':_0x274a7f});console[_0x20f620(0x220)]('ðŸ”\x20Total\x20payments\x20matching\x20filters:\x20'+_0x33d1c6);let _0x5dffe3={'createdAt':_0x20f620(0x2a1)};if(_0x10e06a){const _0x4cd885=[_0x20f620(0x243),_0x20f620(0x20a),_0x20f620(0x1d0),_0x20f620(0x2a8),_0x20f620(0x291),_0x20f620(0x231)],_0x519916=[_0x20f620(0x2d0),_0x20f620(0x2a1)];if(_0x4cd885[_0x20f620(0x1a9)](_0x10e06a)){const _0x51a0b6=_0x519916['includes'](_0x47fba3)?_0x47fba3:_0x20f620(0x2a1);_0x5dffe3={[_0x10e06a]:_0x51a0b6},console[_0x20f620(0x220)](_0x20f620(0x1ba)+_0x10e06a+'\x20in\x20'+_0x51a0b6+_0x20f620(0x213));}}const [_0x424a11,_0x335115]=await Promise[_0x20f620(0x21d)]([database_1[_0x20f620(0x246)][_0x20f620(0x1f8)]['findMany']({'where':_0x274a7f,'skip':_0x51af5c,'take':_0x4744bb,'orderBy':_0x5dffe3,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x20f620(0x246)][_0x20f620(0x1f8)]['count']({'where':_0x274a7f})]);return{'payments':_0x424a11,'pagination':{'page':_0xa780f9,'limit':_0x4744bb,'total':_0x335115,'totalPages':Math[_0x20f620(0x1bd)](_0x335115/_0x4744bb)}};}async[a48_0x1493df(0x18f)](_0x3820f3){const _0x1b5873=a48_0x1493df,_0x3e1360=await database_1[_0x1b5873(0x246)]['payment'][_0x1b5873(0x2cf)]({'where':{'id':_0x3820f3},'select':{'id':!![],'shopId':!![],'amount':!![],'amountAfterGatewayCommissionUSDT':!![],'currency':!![],'sourceCurrency':!![],'status':!![],'gateway':!![],'orderId':!![],'gatewayOrderId':!![],'gatewayPaymentId':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'externalPaymentUrl':!![],'successUrl':!![],'failUrl':!![],'pendingUrl':!![],'whiteUrl':!![],'expiresAt':!![],'invoiceTotalSum':!![],'qrCode':!![],'qrUrl':!![],'country':!![],'language':!![],'amountIsEditable':!![],'maxPayments':!![],'rapydCustomer':!![],'cardLast4':!![],'paymentMethod':!![],'bankId':!![],'remitterIban':!![],'remitterName':!![],'failureMessage':!![],'usage':!![],'createdAt':!![],'updatedAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x3e1360)return null;return{'id':_0x3e1360['id'],'shopId':_0x3e1360[_0x1b5873(0x207)],'gateway':_0x3e1360['gateway'],'amount':_0x3e1360[_0x1b5873(0x243)],'currency':_0x3e1360['currency'],'status':_0x3e1360['status'],'orderId':_0x3e1360['orderId'],'gatewayOrderId':_0x3e1360[_0x1b5873(0x281)],'customerEmail':_0x3e1360[_0x1b5873(0x1bb)],'customerName':_0x3e1360[_0x1b5873(0x1e4)],'customerCountry':_0x3e1360['customerCountry'],'customerIp':_0x3e1360[_0x1b5873(0x2d4)],'customerUa':_0x3e1360['customerUa'],'failureMessage':_0x3e1360[_0x1b5873(0x2c6)],'externalPaymentUrl':_0x3e1360['externalPaymentUrl'],'successUrl':_0x3e1360[_0x1b5873(0x22b)],'failUrl':_0x3e1360[_0x1b5873(0x1a5)],'pendingUrl':_0x3e1360[_0x1b5873(0x238)],'whiteUrl':_0x3e1360[_0x1b5873(0x23b)],'createdAt':_0x3e1360[_0x1b5873(0x20a)],'updatedAt':_0x3e1360[_0x1b5873(0x1d0)],'shop':_0x3e1360[_0x1b5873(0x248)]};}async[a48_0x1493df(0x1b7)](_0x1f01ca,_0x1b0894,_0x3c19ad,_0x2bf650){const _0x12798e=a48_0x1493df,_0x354ab3=await database_1[_0x12798e(0x246)]['$transaction'](async _0x35db00=>{const _0x2f6bfd=_0x12798e,_0x49bca7=await _0x35db00[_0x2f6bfd(0x1f8)]['findUnique']({'where':{'id':_0x1f01ca},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x49bca7)throw new Error(_0x2f6bfd(0x226));const _0x11522f=_0x49bca7[_0x2f6bfd(0x2a8)],_0x59ce0b=_0x1b0894[_0x2f6bfd(0x253)]();console[_0x2f6bfd(0x220)](_0x2f6bfd(0x258)+_0x1f01ca+'\x20status:\x20'+_0x11522f+_0x2f6bfd(0x21f)+_0x59ce0b),console[_0x2f6bfd(0x220)](_0x2f6bfd(0x257)+_0x49bca7['shop']['balance']+_0x2f6bfd(0x1ed));const _0x5cd7d0={'status':_0x59ce0b,'updatedAt':new Date(),'statusChangedBy':_0x2f6bfd(0x187),'statusChangedAt':new Date()};_0x3c19ad&&(_0x5cd7d0[_0x2f6bfd(0x209)]=_0x3c19ad);_0x59ce0b===_0x2f6bfd(0x216)&&_0x2bf650&&(_0x5cd7d0[_0x2f6bfd(0x20b)]=_0x2bf650);let _0x97091e=0x0,_0x5c3876=_0x49bca7[_0x2f6bfd(0x248)][_0x2f6bfd(0x1f4)];if(_0x59ce0b==='PAID'&&_0x11522f!==_0x2f6bfd(0x2dd)){_0x5cd7d0[_0x2f6bfd(0x2c4)]=new Date();const _0x415cad=await currencyService_1[_0x2f6bfd(0x1dd)][_0x2f6bfd(0x2b0)](_0x49bca7[_0x2f6bfd(0x243)],_0x49bca7[_0x2f6bfd(0x231)]);_0x5cd7d0[_0x2f6bfd(0x2ec)]=_0x415cad;let _0x30de31=0x2d;const _0x46ca1f=await _0x35db00['shop'][_0x2f6bfd(0x2cf)]({'where':{'id':_0x49bca7['shopId']},'select':{'gatewaySettings':!![]}});if(_0x46ca1f?.['gatewaySettings'])try{const _0x1caad4=JSON[_0x2f6bfd(0x27c)](_0x46ca1f[_0x2f6bfd(0x262)]);for(const [_0x373658,_0x4c0ccd]of Object[_0x2f6bfd(0x27b)](_0x1caad4)){if(_0x373658[_0x2f6bfd(0x254)]()===_0x49bca7[_0x2f6bfd(0x291)][_0x2f6bfd(0x254)]()){_0x30de31=_0x4c0ccd[_0x2f6bfd(0x202)]||0xa;break;}}}catch(_0x2f541d){console[_0x2f6bfd(0x217)](_0x2f6bfd(0x1f5)+_0x1f01ca+':',_0x2f541d);}let _0x50b80a;_0x49bca7[_0x2f6bfd(0x252)]!==null&&_0x49bca7[_0x2f6bfd(0x252)]!==undefined?(_0x50b80a=_0x49bca7['amountAfterGatewayCommissionUSDT'],console['log'](_0x2f6bfd(0x2b1)+_0x50b80a['toFixed'](0x6)+_0x2f6bfd(0x2bd)+_0x1f01ca)):(_0x50b80a=_0x415cad*(0x1-_0x30de31/0x64),console[_0x2f6bfd(0x220)](_0x2f6bfd(0x2a2)+_0x1f01ca+':\x20'+_0x30de31+_0x2f6bfd(0x18e)+_0x415cad[_0x2f6bfd(0x286)](0x6)+_0x2f6bfd(0x1ed)),_0x5cd7d0[_0x2f6bfd(0x252)]=_0x50b80a,_0x5cd7d0['gatewayCommissionRate']=_0x30de31),_0x97091e=_0x50b80a,_0x5c3876+=_0x50b80a,console[_0x2f6bfd(0x220)](_0x2f6bfd(0x1fa)+_0x1f01ca+'\x20became\x20PAID:'),console[_0x2f6bfd(0x220)]('\x20\x20\x20Full\x20amount:\x20'+_0x415cad['toFixed'](0x6)+_0x2f6bfd(0x1ed)),console['log']('\x20\x20\x20Gateway:\x20'+_0x49bca7['gateway']+_0x2f6bfd(0x201)+_0x30de31+'%'),console[_0x2f6bfd(0x220)](_0x2f6bfd(0x1ea)+_0x50b80a['toFixed'](0x6)+'\x20USDT\x20(after\x20'+_0x30de31+_0x2f6bfd(0x23a)),console['log'](_0x2f6bfd(0x1c0)+_0x50b80a[_0x2f6bfd(0x286)](0x6)+_0x2f6bfd(0x1ed));}else{if(_0x11522f===_0x2f6bfd(0x2dd)&&_0x59ce0b!==_0x2f6bfd(0x2dd)&&_0x59ce0b!=='CHARGEBACK'){if(_0x49bca7[_0x2f6bfd(0x2ec)]){let _0x2a1ea1=0x2d;const _0x23781c=await _0x35db00['shop'][_0x2f6bfd(0x2cf)]({'where':{'id':_0x49bca7['shopId']},'select':{'gatewaySettings':!![]}});if(_0x23781c?.[_0x2f6bfd(0x262)])try{const _0x2bb2b4=JSON[_0x2f6bfd(0x27c)](_0x23781c[_0x2f6bfd(0x262)]);for(const [_0x47cf32,_0x24e0a8]of Object['entries'](_0x2bb2b4)){if(_0x47cf32[_0x2f6bfd(0x254)]()===_0x49bca7[_0x2f6bfd(0x291)]['toLowerCase']()){_0x2a1ea1=_0x24e0a8[_0x2f6bfd(0x202)]||0xa;break;}}}catch(_0xadf9b2){console[_0x2f6bfd(0x217)](_0x2f6bfd(0x1f5)+_0x1f01ca+':',_0xadf9b2);}const _0x416499=_0x49bca7[_0x2f6bfd(0x2ec)]*(0x1-_0x2a1ea1/0x64);_0x97091e=-_0x416499,_0x5c3876-=_0x416499,console[_0x2f6bfd(0x220)](_0x2f6bfd(0x1c4)+_0x49bca7['amountUSDT']['toFixed'](0x6)+_0x2f6bfd(0x1ed)),console[_0x2f6bfd(0x220)](_0x2f6bfd(0x24c)+_0x49bca7[_0x2f6bfd(0x291)]+_0x2f6bfd(0x201)+_0x2a1ea1+'%'),console[_0x2f6bfd(0x220)]('\x20\x20\x20Merchant\x20loses:\x20'+_0x416499[_0x2f6bfd(0x286)](0x6)+_0x2f6bfd(0x2ea)+_0x2a1ea1+_0x2f6bfd(0x23a)),console[_0x2f6bfd(0x220)]('\x20\x20\x20Subtracted\x20from\x20balance:\x20-'+_0x416499['toFixed'](0x6)+_0x2f6bfd(0x1ed));}}}_0x59ce0b===_0x2f6bfd(0x216)&&(console['log'](_0x2f6bfd(0x25c)),_0x2bf650&&_0x2bf650>0x0?(_0x97091e=-_0x2bf650,_0x5c3876-=_0x2bf650,console[_0x2f6bfd(0x220)]('ðŸ’¸\x20CHARGEBACK\x20penalty\x20ONLY:\x20-'+_0x2bf650[_0x2f6bfd(0x286)](0x6)+'\x20USDT\x20from\x20balance'),console[_0x2f6bfd(0x220)]('ðŸ’°\x20Payment\x20amount\x20is\x20NOT\x20deducted\x20(chargeback\x20penalty\x20only)')):console['log'](_0x2f6bfd(0x2d5)),_0x5cd7d0[_0x2f6bfd(0x20b)]=_0x2bf650||0x0);_0x59ce0b===_0x2f6bfd(0x1bf)&&_0x11522f===_0x2f6bfd(0x2dd)&&console[_0x2f6bfd(0x220)]('ðŸ”„\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance');const _0x23833c=await _0x35db00[_0x2f6bfd(0x1f8)]['update']({'where':{'id':_0x1f01ca},'data':_0x5cd7d0,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x97091e!==0x0&&(await _0x35db00[_0x2f6bfd(0x248)]['update']({'where':{'id':_0x49bca7[_0x2f6bfd(0x207)]},'data':{'balance':_0x5c3876}}),console[_0x2f6bfd(0x220)](_0x2f6bfd(0x1ec)+_0x49bca7[_0x2f6bfd(0x207)]+_0x2f6bfd(0x2a7)+_0x49bca7['shop'][_0x2f6bfd(0x1f4)][_0x2f6bfd(0x286)](0x6)+_0x2f6bfd(0x21f)+_0x5c3876[_0x2f6bfd(0x286)](0x6)+_0x2f6bfd(0x195)+(_0x97091e>0x0?'+':'')+_0x97091e[_0x2f6bfd(0x286)](0x6)+')')),_0x23833c;});return{'id':_0x354ab3['id'],'shopId':_0x354ab3[_0x12798e(0x207)],'gateway':_0x354ab3[_0x12798e(0x291)],'amount':_0x354ab3[_0x12798e(0x243)],'currency':_0x354ab3['currency'],'status':_0x354ab3[_0x12798e(0x2a8)],'orderId':_0x354ab3[_0x12798e(0x188)],'gatewayOrderId':_0x354ab3[_0x12798e(0x281)],'customerEmail':_0x354ab3[_0x12798e(0x1bb)],'customerName':_0x354ab3['customerName'],'customerCountry':_0x354ab3[_0x12798e(0x1b8)],'customerIp':_0x354ab3[_0x12798e(0x2d4)],'customerUa':_0x354ab3[_0x12798e(0x273)],'failureMessage':_0x354ab3['failureMessage'],'adminNotes':_0x354ab3[_0x12798e(0x209)],'chargebackAmount':_0x354ab3['chargebackAmount'],'statusChangedBy':_0x354ab3[_0x12798e(0x2c3)],'statusChangedAt':_0x354ab3[_0x12798e(0x274)],'createdAt':_0x354ab3[_0x12798e(0x20a)],'updatedAt':_0x354ab3[_0x12798e(0x1d0)],'shop':_0x354ab3[_0x12798e(0x248)]};}async[a48_0x1493df(0x26a)](_0x2859be,_0x3e5709){const _0x1a8dcb=a48_0x1493df,_0x59929c=Math[_0x1a8dcb(0x203)]()[_0x1a8dcb(0x229)](0x24)[_0x1a8dcb(0x259)](0x2,0x9);console['log'](_0x1a8dcb(0x2f0)+_0x59929c+_0x1a8dcb(0x232)+_0x2859be);const _0x1d5ee3={..._0x3e5709};_0x3e5709[_0x1a8dcb(0x1ca)]&&_0x3e5709[_0x1a8dcb(0x1ca)][_0x1a8dcb(0x1cd)]()!==''?(console[_0x1a8dcb(0x220)](_0x1a8dcb(0x2a6)+_0x59929c+_0x1a8dcb(0x265)+_0x2859be),_0x1d5ee3['password']=await bcryptjs_1['default'][_0x1a8dcb(0x1d5)](_0x3e5709[_0x1a8dcb(0x1ca)],0xc)):(console[_0x1a8dcb(0x220)]('ðŸ”\x20['+_0x59929c+_0x1a8dcb(0x2e2)),delete _0x1d5ee3[_0x1a8dcb(0x1ca)]);_0x3e5709[_0x1a8dcb(0x24f)]&&(_0x1d5ee3[_0x1a8dcb(0x28e)]=_0x3e5709[_0x1a8dcb(0x24f)],delete _0x1d5ee3[_0x1a8dcb(0x24f)]);_0x3e5709['telegramId']&&(_0x1d5ee3['telegram']=_0x3e5709['telegramId'],delete _0x1d5ee3[_0x1a8dcb(0x224)]);_0x3e5709[_0x1a8dcb(0x1ce)]&&(_0x1d5ee3['shopUrl']=_0x3e5709['merchantUrl'],delete _0x1d5ee3[_0x1a8dcb(0x1ce)]);if(_0x3e5709[_0x1a8dcb(0x183)]){const _0x395b73=_0x3e5709[_0x1a8dcb(0x183)][_0x1a8dcb(0x184)](_0x293bf6=>this[_0x1a8dcb(0x2cc)](_0x293bf6));console[_0x1a8dcb(0x220)](_0x1a8dcb(0x180),_0x3e5709['gateways'],'->',_0x395b73),_0x1d5ee3[_0x1a8dcb(0x242)]=JSON['stringify'](_0x395b73),delete _0x1d5ee3[_0x1a8dcb(0x183)];}_0x3e5709['gatewaySettings']&&(console[_0x1a8dcb(0x220)](_0x1a8dcb(0x1e2)+_0x59929c+_0x1a8dcb(0x2b6),_0x3e5709[_0x1a8dcb(0x262)]),_0x1d5ee3[_0x1a8dcb(0x262)]=JSON[_0x1a8dcb(0x2b2)](_0x3e5709[_0x1a8dcb(0x262)]),console['log'](_0x1a8dcb(0x1e2)+_0x59929c+_0x1a8dcb(0x2de),_0x1d5ee3[_0x1a8dcb(0x262)]));_0x3e5709['wallets']&&(_0x3e5709[_0x1a8dcb(0x1a3)][_0x1a8dcb(0x1b5)]!==undefined&&(_0x1d5ee3['usdtPolygonWallet']=_0x3e5709['wallets'][_0x1a8dcb(0x1b5)]||null),_0x3e5709['wallets'][_0x1a8dcb(0x2cd)]!==undefined&&(_0x1d5ee3[_0x1a8dcb(0x2cd)]=_0x3e5709['wallets'][_0x1a8dcb(0x2cd)]||null),_0x3e5709[_0x1a8dcb(0x1a3)][_0x1a8dcb(0x2ab)]!==undefined&&(_0x1d5ee3[_0x1a8dcb(0x2ab)]=_0x3e5709[_0x1a8dcb(0x1a3)]['usdtErcWallet']||null),_0x3e5709[_0x1a8dcb(0x1a3)][_0x1a8dcb(0x2dc)]!==undefined&&(_0x1d5ee3[_0x1a8dcb(0x2dc)]=_0x3e5709['wallets']['usdcPolygonWallet']||null),delete _0x1d5ee3['wallets']);const _0x5e9d43=await database_1['default']['shop'][_0x1a8dcb(0x1c3)]({'where':{'id':_0x2859be},'data':_0x1d5ee3,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return console['log'](_0x1a8dcb(0x18c)+_0x59929c+_0x1a8dcb(0x210),_0x5e9d43[_0x1a8dcb(0x262)]),{'id':_0x5e9d43['id'],'fullName':_0x5e9d43[_0x1a8dcb(0x28e)],'username':_0x5e9d43[_0x1a8dcb(0x223)],'telegramId':_0x5e9d43['telegram'],'merchantUrl':_0x5e9d43[_0x1a8dcb(0x2eb)],'gateways':_0x5e9d43[_0x1a8dcb(0x242)]?JSON[_0x1a8dcb(0x27c)](_0x5e9d43[_0x1a8dcb(0x242)]):null,'gatewaySettings':_0x5e9d43[_0x1a8dcb(0x262)]?JSON[_0x1a8dcb(0x27c)](_0x5e9d43['gatewaySettings']):null,'publicKey':_0x5e9d43[_0x1a8dcb(0x2e1)],'wallets':{'usdtPolygonWallet':_0x5e9d43[_0x1a8dcb(0x1b5)],'usdtTrcWallet':_0x5e9d43[_0x1a8dcb(0x2cd)],'usdtErcWallet':_0x5e9d43[_0x1a8dcb(0x2ab)],'usdcPolygonWallet':_0x5e9d43[_0x1a8dcb(0x2dc)]},'status':_0x5e9d43[_0x1a8dcb(0x2a8)],'createdAt':_0x5e9d43[_0x1a8dcb(0x20a)]};}async['suspendUser'](_0xd77ddf){const _0x2c3933=a48_0x1493df,_0x510cdf=await database_1['default'][_0x2c3933(0x248)][_0x2c3933(0x1c3)]({'where':{'id':_0xd77ddf},'data':{'status':'SUSPENDED'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x510cdf['id'],'fullName':_0x510cdf['name'],'username':_0x510cdf[_0x2c3933(0x223)],'telegramId':_0x510cdf[_0x2c3933(0x20f)],'merchantUrl':_0x510cdf[_0x2c3933(0x2eb)],'gateways':_0x510cdf[_0x2c3933(0x242)]?JSON[_0x2c3933(0x27c)](_0x510cdf[_0x2c3933(0x242)]):null,'gatewaySettings':_0x510cdf['gatewaySettings']?JSON[_0x2c3933(0x27c)](_0x510cdf[_0x2c3933(0x262)]):null,'publicKey':_0x510cdf['publicKey'],'wallets':{'usdtPolygonWallet':_0x510cdf[_0x2c3933(0x1b5)],'usdtTrcWallet':_0x510cdf[_0x2c3933(0x2cd)],'usdtErcWallet':_0x510cdf[_0x2c3933(0x2ab)],'usdcPolygonWallet':_0x510cdf['usdcPolygonWallet']},'status':_0x510cdf[_0x2c3933(0x2a8)],'createdAt':_0x510cdf[_0x2c3933(0x20a)]};}async['activateUser'](_0x137a18){const _0x960001=a48_0x1493df,_0x26ea79=await database_1[_0x960001(0x246)][_0x960001(0x248)][_0x960001(0x1c3)]({'where':{'id':_0x137a18},'data':{'status':_0x960001(0x2ed)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x26ea79['id'],'fullName':_0x26ea79[_0x960001(0x28e)],'username':_0x26ea79[_0x960001(0x223)],'telegramId':_0x26ea79[_0x960001(0x20f)],'merchantUrl':_0x26ea79[_0x960001(0x2eb)],'gateways':_0x26ea79[_0x960001(0x242)]?JSON['parse'](_0x26ea79[_0x960001(0x242)]):null,'gatewaySettings':_0x26ea79[_0x960001(0x262)]?JSON['parse'](_0x26ea79[_0x960001(0x262)]):null,'publicKey':_0x26ea79[_0x960001(0x2e1)],'wallets':{'usdtPolygonWallet':_0x26ea79[_0x960001(0x1b5)],'usdtTrcWallet':_0x26ea79['usdtTrcWallet'],'usdtErcWallet':_0x26ea79['usdtErcWallet'],'usdcPolygonWallet':_0x26ea79[_0x960001(0x2dc)]},'status':_0x26ea79[_0x960001(0x2a8)],'createdAt':_0x26ea79[_0x960001(0x20a)]};}async[a48_0x1493df(0x23f)](_0x4e8355){const _0x41094b=a48_0x1493df,{page:_0x39cc0e,limit:_0xf67f80,status:_0x5d0777}=_0x4e8355,_0x29ab89=(_0x39cc0e-0x1)*_0xf67f80,_0x53430b={};_0x5d0777&&(_0x53430b[_0x41094b(0x2a8)]=_0x5d0777['toUpperCase']());const [_0xf768ed,_0x54ddf9]=await Promise[_0x41094b(0x21d)]([database_1[_0x41094b(0x246)][_0x41094b(0x248)][_0x41094b(0x290)]({'where':_0x53430b,'skip':_0x29ab89,'take':_0xf67f80,'orderBy':{'createdAt':_0x41094b(0x2a1)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x41094b(0x246)]['shop']['count']({'where':_0x53430b})]);return{'users':_0xf768ed[_0x41094b(0x184)](_0xb8d131=>{const _0x17dd15=_0x41094b,_0xcda08f=_0xb8d131[_0x17dd15(0x242)]?JSON['parse'](_0xb8d131[_0x17dd15(0x242)]):null,_0x57f3c0=_0xcda08f?_0xcda08f[_0x17dd15(0x184)](_0x570eb6=>this[_0x17dd15(0x200)](_0x570eb6)):null;return{'id':_0xb8d131['id'],'fullName':_0xb8d131[_0x17dd15(0x28e)],'username':_0xb8d131[_0x17dd15(0x223)],'telegramId':_0xb8d131['telegram'],'merchantUrl':_0xb8d131[_0x17dd15(0x2eb)],'gateways':_0x57f3c0,'gatewaySettings':_0xb8d131[_0x17dd15(0x262)]?JSON['parse'](_0xb8d131[_0x17dd15(0x262)]):null,'publicKey':_0xb8d131[_0x17dd15(0x2e1)],'wallets':{'usdtPolygonWallet':_0xb8d131[_0x17dd15(0x1b5)],'usdtTrcWallet':_0xb8d131[_0x17dd15(0x2cd)],'usdtErcWallet':_0xb8d131[_0x17dd15(0x2ab)],'usdcPolygonWallet':_0xb8d131[_0x17dd15(0x2dc)],'usdcErcWallet':_0xb8d131[_0x17dd15(0x25a)]},'status':_0xb8d131[_0x17dd15(0x2a8)],'createdAt':_0xb8d131[_0x17dd15(0x20a)]};}),'pagination':{'page':_0x39cc0e,'limit':_0xf67f80,'total':_0x54ddf9,'totalPages':Math[_0x41094b(0x1bd)](_0x54ddf9/_0xf67f80)}};}async[a48_0x1493df(0x292)](_0x29f5b5){const _0xf383e3=a48_0x1493df,_0x51b838=await database_1[_0xf383e3(0x246)]['shop'][_0xf383e3(0x2cf)]({'where':{'id':_0x29f5b5},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'usdcErcWallet':!![],'status':!![],'createdAt':!![]}});if(!_0x51b838)return null;const _0x5d02ae=_0x51b838[_0xf383e3(0x242)]?JSON['parse'](_0x51b838['paymentGateways']):null,_0x527f27=_0x5d02ae?_0x5d02ae[_0xf383e3(0x184)](_0x23cc08=>this[_0xf383e3(0x200)](_0x23cc08)):null;return _0x5d02ae&&_0x527f27&&console[_0xf383e3(0x220)](_0xf383e3(0x2d6),_0x5d02ae,'->',_0x527f27),{'id':_0x51b838['id'],'fullName':_0x51b838[_0xf383e3(0x28e)],'username':_0x51b838[_0xf383e3(0x223)],'telegramId':_0x51b838[_0xf383e3(0x20f)],'merchantUrl':_0x51b838[_0xf383e3(0x2eb)],'gateways':_0x527f27,'gatewaySettings':_0x51b838[_0xf383e3(0x262)]?JSON['parse'](_0x51b838[_0xf383e3(0x262)]):null,'publicKey':_0x51b838['publicKey'],'wallets':{'usdtPolygonWallet':_0x51b838[_0xf383e3(0x1b5)],'usdtTrcWallet':_0x51b838[_0xf383e3(0x2cd)],'usdtErcWallet':_0x51b838[_0xf383e3(0x2ab)],'usdcPolygonWallet':_0x51b838[_0xf383e3(0x2dc)],'usdcErcWallet':_0x51b838[_0xf383e3(0x25a)]},'status':_0x51b838[_0xf383e3(0x2a8)],'createdAt':_0x51b838[_0xf383e3(0x20a)]};}async[a48_0x1493df(0x2c9)](_0x3271df){const _0x34a118=a48_0x1493df,{fullName:_0x4bf03d,username:_0x464e94,password:_0x3d4c17,telegramId:_0x439768,merchantUrl:_0x1bc13b,gateways:_0x40a6a2,gatewaySettings:_0x2bfb66,wallets:_0x565670}=_0x3271df,_0x5bc9ea=await database_1[_0x34a118(0x246)][_0x34a118(0x248)]['findUnique']({'where':{'username':_0x464e94}});if(_0x5bc9ea)throw new Error(_0x34a118(0x2e7));if(_0x439768){const _0x235c46=await database_1[_0x34a118(0x246)][_0x34a118(0x248)][_0x34a118(0x2cf)]({'where':{'telegram':_0x439768}});if(_0x235c46)throw new Error(_0x34a118(0x1de));}const _0x64316f=await bcryptjs_1[_0x34a118(0x246)][_0x34a118(0x1d5)](_0x3d4c17,0xc),_0x2a749f='pk_'+crypto_1[_0x34a118(0x246)][_0x34a118(0x22f)](0x20)[_0x34a118(0x229)](_0x34a118(0x29c)),_0xe575c9=_0x34a118(0x211)+crypto_1[_0x34a118(0x246)]['randomBytes'](0x20)[_0x34a118(0x229)](_0x34a118(0x29c)),_0x49d9c9=_0x40a6a2?_0x40a6a2[_0x34a118(0x184)](_0x474877=>this[_0x34a118(0x2cc)](_0x474877)):null;_0x40a6a2&&_0x49d9c9&&console[_0x34a118(0x220)]('ðŸ”„\x20Gateway\x20mapping\x20(create):',_0x40a6a2,'->',_0x49d9c9);const _0x47ccde=await database_1[_0x34a118(0x246)][_0x34a118(0x248)][_0x34a118(0x2df)]({'data':{'name':_0x4bf03d,'username':_0x464e94,'password':_0x64316f,'telegram':_0x439768,'shopUrl':_0x1bc13b,'paymentGateways':_0x49d9c9?JSON[_0x34a118(0x2b2)](_0x49d9c9):null,'gatewaySettings':_0x2bfb66?JSON[_0x34a118(0x2b2)](_0x2bfb66):null,'usdtPolygonWallet':_0x565670?.[_0x34a118(0x1b5)]||null,'usdtTrcWallet':_0x565670?.[_0x34a118(0x2cd)]||null,'usdtErcWallet':_0x565670?.[_0x34a118(0x2ab)]||null,'usdcPolygonWallet':_0x565670?.['usdcPolygonWallet']||null,'publicKey':_0x2a749f,'secretKey':_0xe575c9,'status':_0x34a118(0x2ed)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x47ccde['id'],'fullName':_0x47ccde[_0x34a118(0x28e)],'username':_0x47ccde[_0x34a118(0x223)],'telegramId':_0x47ccde['telegram'],'merchantUrl':_0x47ccde[_0x34a118(0x2eb)],'gateways':_0x47ccde['paymentGateways']?JSON[_0x34a118(0x27c)](_0x47ccde['paymentGateways']):null,'gatewaySettings':_0x47ccde[_0x34a118(0x262)]?JSON[_0x34a118(0x27c)](_0x47ccde[_0x34a118(0x262)]):null,'publicKey':_0x47ccde[_0x34a118(0x2e1)],'wallets':{'usdtPolygonWallet':_0x47ccde[_0x34a118(0x1b5)],'usdtTrcWallet':_0x47ccde[_0x34a118(0x2cd)],'usdtErcWallet':_0x47ccde[_0x34a118(0x2ab)],'usdcPolygonWallet':_0x47ccde[_0x34a118(0x2dc)]},'status':_0x47ccde[_0x34a118(0x2a8)],'createdAt':_0x47ccde['createdAt']};}async[a48_0x1493df(0x1c8)](_0x420a08){const _0x69ff0a=a48_0x1493df;await database_1[_0x69ff0a(0x246)]['shop']['delete']({'where':{'id':_0x420a08}});}[a48_0x1493df(0x22c)](_0x158d1f,_0x39477b,_0x5d916a){const _0x53ffb9=a48_0x1493df,_0x4d2be1=new Map(),_0x3693af=new Date(_0x39477b);while(_0x3693af<=_0x5d916a){const _0x461c56=_0x3693af[_0x53ffb9(0x2ce)]()[_0x53ffb9(0x1b9)]('T')[0x0];_0x4d2be1['set'](_0x461c56,{'revenue':0x0,'count':0x0}),_0x3693af[_0x53ffb9(0x2c2)](_0x3693af['getDate']()+0x1);}for(const _0x123225 of _0x158d1f){const _0x510f7e=_0x123225[_0x53ffb9(0x20a)][_0x53ffb9(0x2ce)]()['split']('T')[0x0],_0x1b606a=_0x4d2be1['get'](_0x510f7e);_0x1b606a&&(_0x1b606a['count']+=0x1,_0x123225[_0x53ffb9(0x2a8)]==='PAID'&&(_0x123225[_0x53ffb9(0x2ec)]?_0x1b606a['revenue']+=_0x123225['amountUSDT']:console[_0x53ffb9(0x220)]('âš ï¸\x20Payment\x20'+_0x123225['id']+_0x53ffb9(0x2a9))));}const _0x4ab68d=[],_0x282b3e=[];for(const [_0x26d017,_0x14cd3a]of _0x4d2be1){_0x4ab68d[_0x53ffb9(0x1fb)]({'date':_0x26d017,'amount':Math[_0x53ffb9(0x1b2)](_0x14cd3a['revenue']*0x64)/0x64}),_0x282b3e[_0x53ffb9(0x1fb)]({'date':_0x26d017,'count':_0x14cd3a[_0x53ffb9(0x28d)]});}return{'dailyRevenue':_0x4ab68d,'dailyPayments':_0x282b3e};}}exports['AdminService']=AdminService;