'use strict';const a35_0x3266cf=a35_0x3d52;(function(_0x3ad6de,_0x48bd70){const _0x20333e=a35_0x3d52,_0x3faf74=_0x3ad6de();while(!![]){try{const _0x322bdc=-parseInt(_0x20333e(0x2cd))/0x1*(-parseInt(_0x20333e(0x2ff))/0x2)+-parseInt(_0x20333e(0x241))/0x3*(-parseInt(_0x20333e(0x214))/0x4)+-parseInt(_0x20333e(0x2a0))/0x5*(parseInt(_0x20333e(0x29f))/0x6)+parseInt(_0x20333e(0x287))/0x7*(-parseInt(_0x20333e(0x219))/0x8)+parseInt(_0x20333e(0x275))/0x9*(parseInt(_0x20333e(0x1cd))/0xa)+-parseInt(_0x20333e(0x2ef))/0xb*(-parseInt(_0x20333e(0x2e2))/0xc)+parseInt(_0x20333e(0x2c9))/0xd;if(_0x322bdc===_0x48bd70)break;else _0x3faf74['push'](_0x3faf74['shift']());}catch(_0x1f9a4d){_0x3faf74['push'](_0x3faf74['shift']());}}}(a35_0x23ef,0xd0018));function a35_0x3d52(_0x3341dd,_0x25c80d){const _0x23ef49=a35_0x23ef();return a35_0x3d52=function(_0x3d52d6,_0x4c7396){_0x3d52d6=_0x3d52d6-0x1cb;let _0x1a0178=_0x23ef49[_0x3d52d6];return _0x1a0178;},a35_0x3d52(_0x3341dd,_0x25c80d);}var __importDefault=this&&this['__importDefault']||function(_0x3e5faa){const _0x2cd2b9=a35_0x3d52;return _0x3e5faa&&_0x3e5faa[_0x2cd2b9(0x218)]?_0x3e5faa:{'default':_0x3e5faa};};Object[a35_0x3266cf(0x204)](exports,a35_0x3266cf(0x218),{'value':!![]}),exports[a35_0x3266cf(0x1e9)]=void 0x0;const database_1=__importDefault(require('../config/database')),bcryptjs_1=__importDefault(require(a35_0x3266cf(0x27e))),crypto_1=__importDefault(require(a35_0x3266cf(0x270))),currencyService_1=require('./currencyService'),gateway_1=require('../types/gateway');class AdminService{async[a35_0x3266cf(0x266)](){const _0x1aaf50=a35_0x3266cf;console[_0x1aaf50(0x1de)](_0x1aaf50(0x203));const _0x2f2827=await database_1[_0x1aaf50(0x200)][_0x1aaf50(0x2ea)][_0x1aaf50(0x2ae)]({'_sum':{'balance':!![],'totalPaidOut':!![]},'where':{'status':_0x1aaf50(0x290)}}),_0x1f86a9=await this['getMerchantsAwaitingPayout']({'page':0x1,'limit':0x3e8}),_0x81045a=await database_1[_0x1aaf50(0x200)][_0x1aaf50(0x27f)][_0x1aaf50(0x248)]({'where':{'status':_0x1aaf50(0x243),'gateway':{'not':_0x1aaf50(0x294)}}}),_0x37c44f=new Date(),_0x33556d=new Date(_0x37c44f[_0x1aaf50(0x2ce)](),_0x37c44f[_0x1aaf50(0x234)](),0x1),_0x25349e=new Date(_0x37c44f[_0x1aaf50(0x2ce)](),_0x37c44f[_0x1aaf50(0x234)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),_0x8b56b8=await database_1[_0x1aaf50(0x200)][_0x1aaf50(0x23f)][_0x1aaf50(0x2ae)]({'_sum':{'amount':!![]},'where':{'createdAt':{'gte':_0x33556d,'lte':_0x25349e},'status':_0x1aaf50(0x291)}}),_0x3149d0=_0x2f2827[_0x1aaf50(0x20c)]['totalPaidOut']||0x0,_0x38fab2=_0x1f86a9['summary'][_0x1aaf50(0x1f3)],_0x429ca9=_0x8b56b8[_0x1aaf50(0x20c)][_0x1aaf50(0x263)]||0x0,_0x30db0b={'totalPayout':Math[_0x1aaf50(0x258)](_0x3149d0*0x64)/0x64,'awaitingPayout':Math[_0x1aaf50(0x258)](_0x38fab2*0x64)/0x64,'thisMonth':Math[_0x1aaf50(0x258)](_0x429ca9*0x64)/0x64,'availableBalance':Math[_0x1aaf50(0x258)](_0x38fab2*0x64)/0x64,'totalPayments':_0x81045a};return console[_0x1aaf50(0x1de)](_0x1aaf50(0x205)),console['log'](_0x1aaf50(0x2a4)+_0x30db0b['totalPayout']+_0x1aaf50(0x23e)),console[_0x1aaf50(0x1de)](_0x1aaf50(0x29a)+_0x30db0b[_0x1aaf50(0x247)]+'\x20USDT\x20(with\x20commission\x20deducted)'),console[_0x1aaf50(0x1de)](_0x1aaf50(0x2dd)+_0x30db0b[_0x1aaf50(0x26f)]+_0x1aaf50(0x26e)),console[_0x1aaf50(0x1de)](_0x1aaf50(0x2af)+_0x30db0b[_0x1aaf50(0x1ea)]+_0x1aaf50(0x1f7)),console[_0x1aaf50(0x1de)](_0x1aaf50(0x246)+_0x30db0b[_0x1aaf50(0x21f)]+'\x20PAID\x20payments'),console[_0x1aaf50(0x1de)](_0x1aaf50(0x233)+(_0x2f2827['_sum']['balance']||0x0)['toFixed'](0x2)+'\x20USDT\x20(without\x20commission)'),console[_0x1aaf50(0x1de)](_0x1aaf50(0x2c3)+((_0x2f2827[_0x1aaf50(0x20c)][_0x1aaf50(0x226)]||0x0)-_0x38fab2)['toFixed'](0x2)+_0x1aaf50(0x1f7)),_0x30db0b;}async[a35_0x3266cf(0x1e7)](_0x165db4,_0x27318c){const _0x543dbc=a35_0x3266cf;console[_0x543dbc(0x1de)](_0x543dbc(0x269)+_0x165db4+':',_0x27318c);const _0x2ded36=await database_1['default'][_0x543dbc(0x27f)][_0x543dbc(0x238)]({'where':{'id':_0x165db4},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![]}});if(!_0x2ded36)throw new Error(_0x543dbc(0x1fb));const _0x37bc8a={};_0x27318c[_0x543dbc(0x256)]!==undefined&&(_0x37bc8a[_0x543dbc(0x256)]=_0x27318c[_0x543dbc(0x256)]||null);_0x27318c[_0x543dbc(0x1cb)]!==undefined&&(_0x37bc8a[_0x543dbc(0x1cb)]=_0x27318c[_0x543dbc(0x1cb)]||null);_0x27318c[_0x543dbc(0x213)]!==undefined&&(_0x37bc8a[_0x543dbc(0x213)]=_0x27318c[_0x543dbc(0x213)]||null);const _0x458ca0=await database_1['default'][_0x543dbc(0x27f)][_0x543dbc(0x2df)]({'where':{'id':_0x165db4},'data':{..._0x37bc8a,'updatedAt':new Date()},'select':{'id':!![],'customerEmail':!![],'customerName':!![],'customerCountry':!![],'customerIp':!![],'customerUa':!![],'updatedAt':!![]}});return console['log']('✅\x20Customer\x20data\x20updated\x20for\x20payment\x20'+_0x165db4),console[_0x543dbc(0x1de)](_0x543dbc(0x2dc)+_0x2ded36[_0x543dbc(0x256)]+_0x543dbc(0x232)+_0x458ca0['customerCountry']),console[_0x543dbc(0x1de)]('\x20\x20\x20🌐\x20IP:\x20'+_0x2ded36[_0x543dbc(0x1cb)]+_0x543dbc(0x232)+_0x458ca0[_0x543dbc(0x1cb)]),console[_0x543dbc(0x1de)]('\x20\x20\x20🖥️\x20User\x20Agent:\x20'+(_0x2ded36['customerUa']?_0x543dbc(0x222):_0x543dbc(0x227))+_0x543dbc(0x232)+(_0x458ca0[_0x543dbc(0x213)]?_0x543dbc(0x222):_0x543dbc(0x227))),_0x458ca0;}async[a35_0x3266cf(0x29b)](_0x960287){const _0x4ff353=a35_0x3266cf,_0x27f66b=new Date();let _0x110bdc;switch(_0x960287){case'7d':_0x110bdc=new Date(_0x27f66b['getTime']()-0x7*0x18*0x3c*0x3c*0x3e8);break;case _0x4ff353(0x1db):_0x110bdc=new Date(_0x27f66b[_0x4ff353(0x215)]()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case _0x4ff353(0x1ef):_0x110bdc=new Date(_0x27f66b[_0x4ff353(0x215)]()-0x5a*0x18*0x3c*0x3c*0x3e8);break;case'all':const _0x5271ad=await database_1[_0x4ff353(0x200)]['payment'][_0x4ff353(0x22c)]({'where':{'gateway':{'not':_0x4ff353(0x294)}},'orderBy':{'createdAt':_0x4ff353(0x2fd)},'select':{'createdAt':!![]}});_0x110bdc=_0x5271ad?_0x5271ad[_0x4ff353(0x2da)]:new Date(_0x4ff353(0x28c)),console[_0x4ff353(0x1de)](_0x4ff353(0x28f)+_0x110bdc[_0x4ff353(0x211)]());break;default:_0x110bdc=new Date(_0x27f66b[_0x4ff353(0x215)]()-0x1e*0x18*0x3c*0x3c*0x3e8);}const [_0x543f20,_0x1ae40a,_0x3d75f7,_0x2eeff8,_0x19b211,_0x34066d,_0x5dbe5a]=await Promise[_0x4ff353(0x2cf)]([database_1[_0x4ff353(0x200)][_0x4ff353(0x2ea)][_0x4ff353(0x248)](),database_1['default'][_0x4ff353(0x2ea)][_0x4ff353(0x248)]({'where':{'status':'ACTIVE'}}),database_1[_0x4ff353(0x200)][_0x4ff353(0x27f)]['count']({'where':{'createdAt':{'gte':_0x110bdc},'gateway':{'not':'test_gateway'}}}),database_1[_0x4ff353(0x200)][_0x4ff353(0x27f)][_0x4ff353(0x248)]({'where':{'status':'PAID','createdAt':{'gte':_0x110bdc},'gateway':{'not':_0x4ff353(0x294)}}}),database_1[_0x4ff353(0x200)][_0x4ff353(0x27f)][_0x4ff353(0x2cc)]({'where':{'status':_0x4ff353(0x243),'createdAt':{'gte':_0x110bdc},'gateway':{'not':_0x4ff353(0x294)}},'select':{'amount':!![],'currency':!![]}}),database_1['default']['payment'][_0x4ff353(0x2cc)]({'where':{'gateway':{'not':_0x4ff353(0x294)}},'take':0xa,'orderBy':{'createdAt':_0x4ff353(0x272)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x4ff353(0x200)][_0x4ff353(0x27f)]['findMany']({'where':{'createdAt':{'gte':_0x110bdc},'gateway':{'not':_0x4ff353(0x294)}},'select':{'amount':!![],'currency':!![],'status':!![],'amountUSDT':!![],'createdAt':!![]}})]);let _0x1a40a2=0x0;for(const _0x60a3db of _0x19b211){const _0x1b392d=await currencyService_1[_0x4ff353(0x1ff)]['convertToUSDT'](_0x60a3db['amount'],_0x60a3db[_0x4ff353(0x2fe)]);_0x1a40a2+=_0x1b392d;}const _0x4fd4ac=this[_0x4ff353(0x25b)](_0x5dbe5a,_0x110bdc,_0x27f66b),_0x3dd592=_0x3d75f7>0x0?_0x2eeff8/_0x3d75f7*0x64:0x0;return{'totalShops':_0x543f20,'activeShops':_0x1ae40a,'totalPayments':_0x3d75f7,'successfulPayments':_0x2eeff8,'totalRevenue':Math[_0x4ff353(0x258)](_0x1a40a2*0x64)/0x64,'conversionRate':Math[_0x4ff353(0x258)](_0x3dd592*0x64)/0x64,'dailyRevenue':_0x4fd4ac[_0x4ff353(0x1f8)],'dailyPayments':_0x4fd4ac[_0x4ff353(0x223)],'recentPayments':_0x34066d[_0x4ff353(0x1d0)](_0x244581=>({'id':_0x244581['id'],'amount':_0x244581[_0x4ff353(0x263)],'currency':_0x244581[_0x4ff353(0x2fe)],'status':_0x244581[_0x4ff353(0x2b6)],'gateway':_0x244581[_0x4ff353(0x2e4)],'shop':_0x244581[_0x4ff353(0x2ea)],'createdAt':_0x244581[_0x4ff353(0x2da)]}))};}async['getMerchantStatistics'](_0x2aef47){const _0x4a3dda=a35_0x3266cf;console[_0x4a3dda(0x1de)](_0x4a3dda(0x2f3),_0x2aef47);let _0x3709ff,_0x31c2f6=new Date();if(_0x2aef47[_0x4a3dda(0x283)]===_0x4a3dda(0x1ec)&&_0x2aef47['dateFrom']&&_0x2aef47[_0x4a3dda(0x2c2)])_0x3709ff=new Date(_0x2aef47['dateFrom']),_0x31c2f6=new Date(_0x2aef47[_0x4a3dda(0x2c2)]);else{const _0x5be248=new Date();switch(_0x2aef47['period']){case _0x4a3dda(0x1cc):_0x3709ff=new Date(_0x5be248[_0x4a3dda(0x215)]()-0x7*0x18*0x3c*0x3c*0x3e8);break;case'month':_0x3709ff=new Date(_0x5be248['getTime']()-0x1e*0x18*0x3c*0x3c*0x3e8);break;case'year':_0x3709ff=new Date(_0x5be248[_0x4a3dda(0x215)]()-0x16d*0x18*0x3c*0x3c*0x3e8);break;case _0x4a3dda(0x2cf):default:_0x3709ff=new Date(_0x4a3dda(0x28c));break;}}console[_0x4a3dda(0x1de)](_0x4a3dda(0x24a)+_0x3709ff['toISOString']()+_0x4a3dda(0x264)+_0x31c2f6[_0x4a3dda(0x211)]());const _0x20157d={'status':_0x4a3dda(0x243),'gateway':{'not':_0x4a3dda(0x294)},'paidAt':{'gte':_0x3709ff,'lte':_0x31c2f6}};_0x2aef47[_0x4a3dda(0x1e5)]&&(_0x20157d[_0x4a3dda(0x1e5)]=_0x2aef47[_0x4a3dda(0x1e5)]);const _0x498a74=await database_1[_0x4a3dda(0x200)]['payment'][_0x4a3dda(0x2cc)]({'where':_0x20157d,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'gatewaySettings':!![]}}}});console[_0x4a3dda(0x1de)]('💰\x20Found\x20'+_0x498a74['length']+_0x4a3dda(0x1f1));const _0x59ff85={'gateway':{'not':_0x4a3dda(0x294)},'createdAt':{'gte':_0x3709ff,'lte':_0x31c2f6}};_0x2aef47[_0x4a3dda(0x1e5)]&&(_0x59ff85[_0x4a3dda(0x1e5)]=_0x2aef47['shopId']);const _0x2aebec=await database_1['default'][_0x4a3dda(0x27f)][_0x4a3dda(0x248)]({'where':_0x59ff85});console[_0x4a3dda(0x1de)](_0x4a3dda(0x255)+_0x2aebec+_0x4a3dda(0x2f8)+_0x498a74[_0x4a3dda(0x2d7)]);let _0x5e8a18=0x0,_0x373b7e=0x0,_0xf6d2b0=0x0;const _0x366931={},_0x26ff7f={},_0x14f434={};for(const _0x27c938 of _0x498a74){try{const _0x3f2d05=await currencyService_1[_0x4a3dda(0x1ff)][_0x4a3dda(0x27d)](_0x27c938[_0x4a3dda(0x263)],_0x27c938[_0x4a3dda(0x2fe)]);let _0x467ad7={};if(_0x27c938[_0x4a3dda(0x2ea)][_0x4a3dda(0x25d)])try{_0x467ad7=JSON['parse'](_0x27c938['shop'][_0x4a3dda(0x25d)]);}catch(_0x43786c){console['error'](_0x4a3dda(0x201)+_0x27c938[_0x4a3dda(0x1e5)]+':',_0x43786c);}let _0x2044a8={},_0x2ea1f5=0xa;for(const [_0x4c5a9b,_0x591106]of Object[_0x4a3dda(0x2b9)](_0x467ad7)){if(_0x4c5a9b['toLowerCase']()===_0x27c938[_0x4a3dda(0x2e4)][_0x4a3dda(0x21a)]()){_0x2044a8=_0x591106,_0x2ea1f5=_0x591106[_0x4a3dda(0x224)]||0xa;break;}}const _0xfde790=_0x3f2d05*(_0x2ea1f5/0x64),_0x4e64a4=_0x3f2d05-_0xfde790;_0x5e8a18+=_0x3f2d05,_0x373b7e+=_0x4e64a4,_0xf6d2b0+=_0xfde790;!_0x366931[_0x27c938[_0x4a3dda(0x2e4)]]&&(_0x366931[_0x27c938[_0x4a3dda(0x2e4)]]={'gateway':_0x27c938[_0x4a3dda(0x2e4)],'gatewayDisplayName':this[_0x4a3dda(0x22e)](_0x27c938[_0x4a3dda(0x2e4)]),'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'totalCommissionRate':0x0});_0x366931[_0x27c938['gateway']][_0x4a3dda(0x1d1)]++,_0x366931[_0x27c938['gateway']][_0x4a3dda(0x250)]+=_0x3f2d05,_0x366931[_0x27c938[_0x4a3dda(0x2e4)]]['commissionUSDT']+=_0xfde790,_0x366931[_0x27c938['gateway']][_0x4a3dda(0x1f9)]+=_0x4e64a4,_0x366931[_0x27c938[_0x4a3dda(0x2e4)]][_0x4a3dda(0x29e)]+=_0x2ea1f5;!_0x2aef47[_0x4a3dda(0x1e5)]&&(!_0x26ff7f[_0x27c938[_0x4a3dda(0x1e5)]]&&(_0x26ff7f[_0x27c938['shopId']]={'shopId':_0x27c938[_0x4a3dda(0x1e5)],'shopName':_0x27c938['shop'][_0x4a3dda(0x1d7)],'shopUsername':_0x27c938[_0x4a3dda(0x2ea)]['username'],'paymentsCount':0x0,'turnoverUSDT':0x0,'commissionUSDT':0x0,'merchantEarningsUSDT':0x0,'paidOutUSDT':0x0,'averageCheckUSDT':0x0}),_0x26ff7f[_0x27c938[_0x4a3dda(0x1e5)]][_0x4a3dda(0x1d1)]++,_0x26ff7f[_0x27c938[_0x4a3dda(0x1e5)]][_0x4a3dda(0x250)]+=_0x3f2d05,_0x26ff7f[_0x27c938[_0x4a3dda(0x1e5)]]['commissionUSDT']+=_0xfde790,_0x26ff7f[_0x27c938[_0x4a3dda(0x1e5)]][_0x4a3dda(0x1f9)]+=_0x4e64a4);const _0x4319c9=_0x27c938[_0x4a3dda(0x1d6)][_0x4a3dda(0x211)]()[_0x4a3dda(0x2b2)]('T')[0x0];!_0x14f434[_0x4319c9]&&(_0x14f434[_0x4319c9]={'date':_0x4319c9,'turnover':0x0,'merchantEarnings':0x0,'gatewayEarnings':0x0,'paymentsCount':0x0}),_0x14f434[_0x4319c9][_0x4a3dda(0x2e5)]+=_0x3f2d05,_0x14f434[_0x4319c9][_0x4a3dda(0x2a6)]+=_0x4e64a4,_0x14f434[_0x4319c9][_0x4a3dda(0x2d3)]+=_0xfde790,_0x14f434[_0x4319c9][_0x4a3dda(0x1d1)]++;}catch(_0x4a1803){console[_0x4a3dda(0x22d)]('Error\x20processing\x20payment\x20'+_0x27c938['id']+':',_0x4a1803);}}Object[_0x4a3dda(0x2c6)](_0x366931)[_0x4a3dda(0x292)](_0x4ffb9d=>{const _0x5a19ab=_0x4a3dda;_0x4ffb9d[_0x5a19ab(0x254)]=_0x4ffb9d[_0x5a19ab(0x1d1)]>0x0?_0x4ffb9d[_0x5a19ab(0x29e)]/_0x4ffb9d[_0x5a19ab(0x1d1)]:0x0,delete _0x4ffb9d[_0x5a19ab(0x29e)];}),Object['values'](_0x26ff7f)['forEach'](_0x457bd2=>{const _0x22e9b6=_0x4a3dda;_0x457bd2[_0x22e9b6(0x2e6)]=_0x457bd2[_0x22e9b6(0x1d1)]>0x0?_0x457bd2[_0x22e9b6(0x250)]/_0x457bd2[_0x22e9b6(0x1d1)]:0x0;});let _0x2a4239=0x0;if(_0x2aef47['shopId']){const _0x914930=await database_1[_0x4a3dda(0x200)][_0x4a3dda(0x23f)]['findMany']({'where':{'shopId':_0x2aef47[_0x4a3dda(0x1e5)],'status':'COMPLETED','createdAt':{'gte':_0x3709ff,'lte':_0x31c2f6}},'select':{'amount':!![]}});_0x2a4239=_0x914930[_0x4a3dda(0x212)]((_0x18590a,_0x115da3)=>_0x18590a+_0x115da3[_0x4a3dda(0x263)],0x0);}const _0x2d5e95=_0x2aebec,_0x18ca9c=_0x498a74[_0x4a3dda(0x2d7)],_0xbdc4b6=_0x18ca9c>0x0?_0x5e8a18/_0x18ca9c:0x0,_0x2e7f3b=_0x2d5e95>0x0?Math[_0x4a3dda(0x258)](_0x18ca9c/_0x2d5e95*0x2710)/0x64:0x0,_0x1de195=Math[_0x4a3dda(0x2cb)]((_0x31c2f6['getTime']()-_0x3709ff['getTime']())/(0x3e8*0x3c*0x3c*0x18)),_0x4075c2={'totalTurnover':Math[_0x4a3dda(0x258)](_0x5e8a18*0x64)/0x64,'merchantEarnings':Math[_0x4a3dda(0x258)](_0x373b7e*0x64)/0x64,'gatewayEarnings':Math['round'](_0xf6d2b0*0x64)/0x64,'totalPaidOut':Math[_0x4a3dda(0x258)](_0x2a4239*0x64)/0x64,'averageCheck':Math['round'](_0xbdc4b6*0x64)/0x64,'totalPayments':_0x2d5e95,'successfulPayments':_0x18ca9c,'conversionRate':_0x2e7f3b,'gatewayBreakdown':Object[_0x4a3dda(0x2c6)](_0x366931)['map'](_0x54ab6d=>({..._0x54ab6d,'turnoverUSDT':Math[_0x4a3dda(0x258)](_0x54ab6d[_0x4a3dda(0x250)]*0x64)/0x64,'commissionUSDT':Math[_0x4a3dda(0x258)](_0x54ab6d[_0x4a3dda(0x1f0)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x4a3dda(0x258)](_0x54ab6d[_0x4a3dda(0x1f9)]*0x64)/0x64,'averageCommissionRate':Math[_0x4a3dda(0x258)](_0x54ab6d[_0x4a3dda(0x254)]*0x64)/0x64})),'merchantBreakdown':_0x2aef47[_0x4a3dda(0x1e5)]?undefined:Object[_0x4a3dda(0x2c6)](_0x26ff7f)[_0x4a3dda(0x1d0)](_0x5e4be3=>({..._0x5e4be3,'turnoverUSDT':Math[_0x4a3dda(0x258)](_0x5e4be3[_0x4a3dda(0x250)]*0x64)/0x64,'commissionUSDT':Math[_0x4a3dda(0x258)](_0x5e4be3[_0x4a3dda(0x1f0)]*0x64)/0x64,'merchantEarningsUSDT':Math[_0x4a3dda(0x258)](_0x5e4be3['merchantEarningsUSDT']*0x64)/0x64,'paidOutUSDT':Math['round'](_0x5e4be3[_0x4a3dda(0x261)]*0x64)/0x64,'averageCheckUSDT':Math['round'](_0x5e4be3[_0x4a3dda(0x2e6)]*0x64)/0x64})),'dailyData':Object[_0x4a3dda(0x2c6)](_0x14f434)[_0x4a3dda(0x1d0)](_0x4aa43f=>({..._0x4aa43f,'turnover':Math[_0x4a3dda(0x258)](_0x4aa43f[_0x4a3dda(0x2e5)]*0x64)/0x64,'merchantEarnings':Math[_0x4a3dda(0x258)](_0x4aa43f['merchantEarnings']*0x64)/0x64,'gatewayEarnings':Math[_0x4a3dda(0x258)](_0x4aa43f[_0x4a3dda(0x2d3)]*0x64)/0x64}))[_0x4a3dda(0x2c7)]((_0x118f15,_0x2ddcf5)=>_0x118f15['date']['localeCompare'](_0x2ddcf5[_0x4a3dda(0x2f7)])),'periodInfo':{'from':_0x3709ff,'to':_0x31c2f6,'periodType':_0x2aef47['period']||_0x4a3dda(0x1ec),'daysCount':_0x1de195}};return console[_0x4a3dda(0x1de)](_0x4a3dda(0x2d5)),console[_0x4a3dda(0x1de)](_0x4a3dda(0x2d9)+_0x4075c2[_0x4a3dda(0x1dd)]+'\x20USDT'),console[_0x4a3dda(0x1de)]('\x20\x20\x20👤\x20Merchant\x20earnings:\x20'+_0x4075c2[_0x4a3dda(0x2a6)]+_0x4a3dda(0x1f7)),console['log'](_0x4a3dda(0x1d3)+_0x4075c2['gatewayEarnings']+_0x4a3dda(0x1f7)),console[_0x4a3dda(0x1de)]('\x20\x20\x20📊\x20Total\x20payments:\x20'+_0x4075c2[_0x4a3dda(0x21f)]),_0x4075c2;}async[a35_0x3266cf(0x1d9)](){const _0x1277a9=a35_0x3266cf;console['log'](_0x1277a9(0x27c));const _0x206176=await database_1[_0x1277a9(0x200)][_0x1277a9(0x2ea)][_0x1277a9(0x2cc)]({'where':{'status':_0x1277a9(0x290)},'select':{'id':!![],'username':!![],'name':!![]},'orderBy':{'name':'asc'}});return console['log'](_0x1277a9(0x29c)+_0x206176[_0x1277a9(0x2d7)]+_0x1277a9(0x1ed)),_0x206176[_0x1277a9(0x1d0)](_0x1e9c64=>({'id':_0x1e9c64['id'],'username':_0x1e9c64[_0x1277a9(0x2f5)],'name':_0x1e9c64['name']}));}[a35_0x3266cf(0x22e)](_0x1cfa20){const _0x4042a4=a35_0x3266cf,_0x383125={'test_gateway':'Test\x20Gateway','plisio':_0x4042a4(0x288),'rapyd':_0x4042a4(0x220),'noda':_0x4042a4(0x2d6),'cointopay':_0x4042a4(0x209),'cointopay2':_0x4042a4(0x25a),'klyme_eu':'KLYME\x20EU','klyme_gb':_0x4042a4(0x2bf),'klyme_de':'KLYME\x20DE','mastercard':_0x4042a4(0x2be)};return _0x383125[_0x1cfa20]||_0x1cfa20;}['getGatewayInternalName'](_0x2a7b3a){const _0x154f1e=a35_0x3266cf,_0x5e8a95={'Test\x20Gateway':_0x154f1e(0x294),'Plisio':_0x154f1e(0x28d),'Rapyd':_0x154f1e(0x2bc),'Noda':_0x154f1e(0x23a),'CoinToPay':_0x154f1e(0x221),'CoinToPay2':_0x154f1e(0x2c0),'KLYME\x20EU':'klyme_eu','KLYME\x20GB':_0x154f1e(0x27b),'KLYME\x20DE':_0x154f1e(0x236),'MasterCard':_0x154f1e(0x2d1)};return _0x5e8a95[_0x2a7b3a]||_0x2a7b3a[_0x154f1e(0x21a)]();}async[a35_0x3266cf(0x2ba)](_0x22bb7c){const _0x5cbb95=a35_0x3266cf,{page:_0x5af0e7,limit:_0xaf5e5d,minAmount:_0x219bb5,search:_0x2eb8f9}=_0x22bb7c,_0x2e6feb=(_0x5af0e7-0x1)*_0xaf5e5d;console[_0x5cbb95(0x1de)]('📊\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:',_0x22bb7c);const _0x5d380d={'balance':{'gt':0x0},'status':'ACTIVE'};_0x219bb5&&(_0x5d380d[_0x5cbb95(0x226)][_0x5cbb95(0x228)]=_0x219bb5);_0x2eb8f9&&(_0x5d380d['OR']=[{'name':{'contains':_0x2eb8f9,'mode':_0x5cbb95(0x2f4)}},{'username':{'contains':_0x2eb8f9,'mode':_0x5cbb95(0x2f4)}}]);const [_0xa4717a,_0x2dbe71]=await Promise[_0x5cbb95(0x2cf)]([database_1['default'][_0x5cbb95(0x2ea)][_0x5cbb95(0x2cc)]({'where':_0x5d380d,'skip':_0x2e6feb,'take':_0xaf5e5d,'orderBy':{'balance':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'balance':!![],'totalPaidOut':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'gatewaySettings':!![],'createdAt':!![]}}),database_1[_0x5cbb95(0x200)][_0x5cbb95(0x2ea)][_0x5cbb95(0x248)]({'where':_0x5d380d})]);console[_0x5cbb95(0x1de)](_0x5cbb95(0x2fc)+_0xa4717a[_0x5cbb95(0x2d7)]+_0x5cbb95(0x2b0));const _0x56f2c4=await Promise['all'](_0xa4717a[_0x5cbb95(0x1d0)](async _0x35bccc=>{const _0x594ffb=_0x5cbb95,[_0x488511,_0x277bc9,_0x3ec4ec]=await Promise['all']([database_1[_0x594ffb(0x200)]['payment'][_0x594ffb(0x248)]({'where':{'shopId':_0x35bccc['id'],'status':_0x594ffb(0x243),'gateway':{'not':_0x594ffb(0x294)}}}),database_1[_0x594ffb(0x200)]['payment'][_0x594ffb(0x22c)]({'where':{'shopId':_0x35bccc['id'],'status':'PAID','gateway':{'not':_0x594ffb(0x294)}},'orderBy':{'paidAt':_0x594ffb(0x2fd)},'select':{'paidAt':!![]}}),database_1[_0x594ffb(0x200)]['payment'][_0x594ffb(0x2fb)]({'by':[_0x594ffb(0x2e4)],'where':{'shopId':_0x35bccc['id'],'status':'PAID','gateway':{'not':_0x594ffb(0x294)}},'_count':{'id':!![]},'_sum':{'amountUSDT':!![]}})]),_0x37619a=new Date(),_0x5f3151=new Date(_0x37619a[_0x594ffb(0x2ce)](),_0x37619a[_0x594ffb(0x234)](),0x1),_0x389604=new Date(_0x37619a[_0x594ffb(0x2ce)](),_0x37619a['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7),[_0x3924ad,_0x1c9c78]=await Promise[_0x594ffb(0x2cf)]([database_1[_0x594ffb(0x200)]['payout'][_0x594ffb(0x2ae)]({'_sum':{'amount':!![]},'where':{'shopId':_0x35bccc['id'],'status':_0x594ffb(0x291)}}),database_1[_0x594ffb(0x200)][_0x594ffb(0x23f)][_0x594ffb(0x2ae)]({'_sum':{'amount':!![]},'where':{'shopId':_0x35bccc['id'],'status':_0x594ffb(0x291),'createdAt':{'gte':_0x5f3151,'lte':_0x389604}}})]),_0x245cc3=_0x3924ad['_sum']['amount']||0x0,_0x32eff4=_0x1c9c78['_sum'][_0x594ffb(0x263)]||0x0,_0x2b73b3=await Promise['all'](_0x3ec4ec[_0x594ffb(0x1d0)](async _0x23464a=>{const _0x2bfa8c=_0x594ffb;let _0x9db5a9=0xa;if(_0x35bccc[_0x2bfa8c(0x25d)])try{const _0x5da24e=JSON['parse'](_0x35bccc[_0x2bfa8c(0x25d)]);for(const [_0x2ce5f9,_0x26f7e3]of Object['entries'](_0x5da24e)){if(_0x2ce5f9[_0x2bfa8c(0x21a)]()===_0x23464a[_0x2bfa8c(0x2e4)]['toLowerCase']()){_0x9db5a9=_0x26f7e3[_0x2bfa8c(0x224)]||0xa,console[_0x2bfa8c(0x1de)](_0x2bfa8c(0x20b)+_0x23464a[_0x2bfa8c(0x2e4)]+_0x2bfa8c(0x235)+_0x35bccc['id']+_0x2bfa8c(0x2bd)+_0x9db5a9+'%');break;}}}catch(_0x4897c1){console['error']('Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20'+_0x35bccc['id']+':',_0x4897c1);}const _0x577cdf=_0x23464a[_0x2bfa8c(0x20c)][_0x2bfa8c(0x2f6)]||0x0,_0x4e5532=_0x577cdf*(0x1-_0x9db5a9/0x64);return{'gateway':_0x23464a[_0x2bfa8c(0x2e4)],'count':_0x23464a[_0x2bfa8c(0x1cf)]['id'],'amountUSDT':Math[_0x2bfa8c(0x258)](_0x577cdf*0x64)/0x64,'amountAfterCommissionUSDT':Math['round'](_0x4e5532*0x64)/0x64,'commission':_0x9db5a9};})),_0x20dad2=_0x2b73b3[_0x594ffb(0x212)]((_0x28dbc3,_0x7b0533)=>_0x28dbc3+_0x7b0533['amountUSDT'],0x0),_0x336564=_0x35bccc[_0x594ffb(0x226)];return console['log']('💰\x20[PAYOUT]\x20Merchant\x20'+_0x35bccc[_0x594ffb(0x2f5)]+':'),console[_0x594ffb(0x1de)](_0x594ffb(0x29d)+_0x20dad2['toFixed'](0x2)+_0x594ffb(0x2b3)),console['log'](_0x594ffb(0x21b)+_0x2b73b3[_0x594ffb(0x212)]((_0x5702da,_0x957072)=>_0x5702da+_0x957072[_0x594ffb(0x27a)],0x0)[_0x594ffb(0x225)](0x2)+'\x20USDT\x20(theoretical\x20net)'),console['log'](_0x594ffb(0x245)+_0x336564[_0x594ffb(0x225)](0x2)+_0x594ffb(0x2f9)),{'id':_0x35bccc['id'],'fullName':_0x35bccc['name'],'username':_0x35bccc['username'],'telegramId':_0x35bccc['telegram'],'merchantUrl':_0x35bccc[_0x594ffb(0x208)],'wallets':{'usdtPolygonWallet':_0x35bccc[_0x594ffb(0x285)],'usdtTrcWallet':_0x35bccc[_0x594ffb(0x26a)],'usdtErcWallet':_0x35bccc[_0x594ffb(0x249)],'usdcPolygonWallet':_0x35bccc['usdcPolygonWallet']},'totalAmountUSDT':Math[_0x594ffb(0x258)](_0x20dad2*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x336564*0x64)/0x64,'totalPayout':Math[_0x594ffb(0x258)](_0x245cc3*0x64)/0x64,'thisMonth':Math['round'](_0x32eff4*0x64)/0x64,'paymentsCount':_0x488511,'oldestPaymentDate':_0x277bc9?.[_0x594ffb(0x1d6)]||_0x35bccc['createdAt'],'gatewayBreakdown':_0x2b73b3};})),_0x2bbcaf=_0x56f2c4[_0x5cbb95(0x212)]((_0x31a0a1,_0x17e42b)=>_0x31a0a1+_0x17e42b[_0x5cbb95(0x262)],0x0),_0x3d95b0=_0x56f2c4['reduce']((_0x22fbfe,_0x9a1218)=>_0x22fbfe+_0x9a1218['totalAmountAfterCommissionUSDT'],0x0),_0x1b7533=_0x56f2c4[_0x5cbb95(0x212)]((_0x4ffd5e,_0x4a931d)=>_0x4ffd5e+_0x4a931d[_0x5cbb95(0x259)],0x0),_0x3c8e88=_0x56f2c4[_0x5cbb95(0x212)]((_0x8b1451,_0x2a7c1b)=>_0x8b1451+_0x2a7c1b[_0x5cbb95(0x1ea)],0x0);return console[_0x5cbb95(0x1de)](_0x5cbb95(0x2ab)+_0x2dbe71+_0x5cbb95(0x2fa)),console[_0x5cbb95(0x1de)](_0x5cbb95(0x1f2)+Math['round'](_0x2bbcaf*0x64)/0x64+_0x5cbb95(0x2b3)),console[_0x5cbb95(0x1de)]('\x20\x20\x20✅\x20Total\x20available\x20for\x20payout:\x20'+Math[_0x5cbb95(0x258)](_0x3d95b0*0x64)/0x64+_0x5cbb95(0x202)),console[_0x5cbb95(0x1de)](_0x5cbb95(0x2f2)+Math[_0x5cbb95(0x258)](_0x1b7533*0x64)/0x64+_0x5cbb95(0x1f7)),console[_0x5cbb95(0x1de)](_0x5cbb95(0x22a)+Math[_0x5cbb95(0x258)](_0x3c8e88*0x64)/0x64+'\x20USDT'),{'merchants':_0x56f2c4,'pagination':{'page':_0x5af0e7,'limit':_0xaf5e5d,'total':_0x2dbe71,'totalPages':Math['ceil'](_0x2dbe71/_0xaf5e5d)},'summary':{'totalMerchants':_0x2dbe71,'totalAmountUSDT':Math['round'](_0x2bbcaf*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x3d95b0*0x64)/0x64,'totalPayout':Math[_0x5cbb95(0x258)](_0x1b7533*0x64)/0x64,'thisMonth':Math[_0x5cbb95(0x258)](_0x3c8e88*0x64)/0x64}};}async['createPayout'](_0x49b118){const _0x1e9da3=a35_0x3266cf,{shopId:_0x4056ec,amount:_0x4a8739,network:_0x5a9fda,wallet:_0x22c3ad,notes:_0x243215,txid:_0x51f72a,periodFrom:_0x2ed2a8,periodTo:_0x4722f4}=_0x49b118,_0x53fbc1=await database_1[_0x1e9da3(0x200)][_0x1e9da3(0x2e1)](async _0x130616=>{const _0x521bc2=_0x1e9da3,_0x241b3d=await _0x130616['shop']['findUnique']({'where':{'id':_0x4056ec},'select':{'id':!![],'name':!![],'username':!![],'balance':!![],'totalPaidOut':!![]}});if(!_0x241b3d)throw new Error('Shop\x20not\x20found');console[_0x521bc2(0x1de)](_0x521bc2(0x2c8)+_0x241b3d[_0x521bc2(0x2f5)]+':'),console[_0x521bc2(0x1de)]('\x20\x20\x20Current\x20balance:\x20'+_0x241b3d[_0x521bc2(0x226)][_0x521bc2(0x225)](0x6)+_0x521bc2(0x1f7)),console[_0x521bc2(0x1de)]('\x20\x20\x20Payout\x20amount:\x20'+_0x4a8739[_0x521bc2(0x225)](0x6)+_0x521bc2(0x1f7)),console['log'](_0x521bc2(0x2f1)+_0x241b3d[_0x521bc2(0x2d8)][_0x521bc2(0x225)](0x6)+_0x521bc2(0x1f7));if(_0x51f72a)console[_0x521bc2(0x1de)](_0x521bc2(0x206)+_0x51f72a);if(_0x241b3d[_0x521bc2(0x226)]<_0x4a8739)throw new Error('Insufficient\x20balance.\x20Available:\x20'+_0x241b3d[_0x521bc2(0x226)][_0x521bc2(0x225)](0x6)+_0x521bc2(0x267)+_0x4a8739[_0x521bc2(0x225)](0x6)+_0x521bc2(0x1f7));let _0x2899bc=_0x22c3ad;if(!_0x2899bc){const _0x41e3a3=await _0x130616[_0x521bc2(0x2ea)]['findUnique']({'where':{'id':_0x4056ec},'select':{'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}});if(_0x41e3a3)switch(_0x5a9fda){case _0x521bc2(0x2f0):_0x2899bc=_0x41e3a3[_0x521bc2(0x285)]||undefined;break;case _0x521bc2(0x1e2):_0x2899bc=_0x41e3a3[_0x521bc2(0x26a)]||undefined;break;case _0x521bc2(0x2c4):_0x2899bc=_0x41e3a3[_0x521bc2(0x249)]||undefined;break;case _0x521bc2(0x28b):_0x2899bc=_0x41e3a3[_0x521bc2(0x20d)]||undefined;break;}}console[_0x521bc2(0x1de)]('💳\x20Payout\x20wallet\x20for\x20'+_0x5a9fda+':\x20'+(_0x2899bc||'not\x20specified'));const _0x5ddf74=await _0x130616[_0x521bc2(0x23f)][_0x521bc2(0x2c1)]({'data':{'shopId':_0x4056ec,'amount':_0x4a8739,'network':_0x5a9fda,'status':_0x521bc2(0x291),'txid':_0x51f72a,'notes':_0x243215,'periodFrom':_0x2ed2a8?new Date(_0x2ed2a8):null,'periodTo':_0x4722f4?new Date(_0x4722f4):null,'createdAt':new Date(),'paidAt':new Date()}}),_0x583931=_0x241b3d[_0x521bc2(0x226)]-_0x4a8739,_0xb4b726=_0x241b3d[_0x521bc2(0x2d8)]+_0x4a8739;return await _0x130616[_0x521bc2(0x2ea)][_0x521bc2(0x2df)]({'where':{'id':_0x4056ec},'data':{'balance':_0x583931,'totalPaidOut':_0xb4b726}}),console[_0x521bc2(0x1de)](_0x521bc2(0x2b1)+_0x241b3d[_0x521bc2(0x2f5)]+'\x20balance\x20updated:'),console[_0x521bc2(0x1de)](_0x521bc2(0x265)+_0x241b3d['balance']['toFixed'](0x6)+_0x521bc2(0x232)+_0x583931[_0x521bc2(0x225)](0x6)+_0x521bc2(0x296)+_0x4a8739['toFixed'](0x6)+')'),console['log'](_0x521bc2(0x23d)+_0x241b3d[_0x521bc2(0x2d8)][_0x521bc2(0x225)](0x6)+_0x521bc2(0x232)+_0xb4b726['toFixed'](0x6)+_0x521bc2(0x1e1)+_0x4a8739[_0x521bc2(0x225)](0x6)+')'),{'payout':_0x5ddf74,'shop':_0x241b3d};});return console[_0x1e9da3(0x1de)](_0x1e9da3(0x252)+_0x53fbc1[_0x1e9da3(0x23f)]['id']+'\x20for\x20shop\x20'+_0x53fbc1['shop'][_0x1e9da3(0x2f5)]+'\x20('+_0x4a8739+_0x1e9da3(0x237)),{'id':_0x53fbc1[_0x1e9da3(0x23f)]['id'],'shopId':_0x53fbc1[_0x1e9da3(0x23f)][_0x1e9da3(0x1e5)],'shopName':_0x53fbc1[_0x1e9da3(0x2ea)][_0x1e9da3(0x1d7)],'shopUsername':_0x53fbc1[_0x1e9da3(0x2ea)][_0x1e9da3(0x2f5)],'amount':_0x53fbc1[_0x1e9da3(0x23f)][_0x1e9da3(0x263)],'network':_0x53fbc1['payout'][_0x1e9da3(0x2a1)],'status':_0x53fbc1[_0x1e9da3(0x23f)][_0x1e9da3(0x2b6)],'txid':_0x53fbc1['payout'][_0x1e9da3(0x1fc)],'notes':_0x53fbc1[_0x1e9da3(0x23f)]['notes'],'periodFrom':_0x53fbc1['payout'][_0x1e9da3(0x2e8)],'periodTo':_0x53fbc1[_0x1e9da3(0x23f)][_0x1e9da3(0x20a)],'createdAt':_0x53fbc1[_0x1e9da3(0x23f)]['createdAt'],'paidAt':_0x53fbc1[_0x1e9da3(0x23f)][_0x1e9da3(0x1d6)]};}async[a35_0x3266cf(0x271)](_0x556eb9){const _0x5170ff=a35_0x3266cf,{page:_0x27b1ad,limit:_0x273b0e,shopId:_0xba2c07,network:_0x391db0,dateFrom:_0x69eded,dateTo:_0x32f0cc,search:_0x1f3620}=_0x556eb9,_0x6f684e=(_0x27b1ad-0x1)*_0x273b0e,_0x45a352={};_0xba2c07&&(_0x45a352['shopId']=_0xba2c07);_0x391db0&&(_0x45a352[_0x5170ff(0x2a1)]=_0x391db0);(_0x69eded||_0x32f0cc)&&(_0x45a352[_0x5170ff(0x2da)]={},_0x69eded&&(_0x45a352[_0x5170ff(0x2da)]['gte']=new Date(_0x69eded)),_0x32f0cc&&(_0x45a352['createdAt'][_0x5170ff(0x253)]=new Date(_0x32f0cc)));_0x1f3620&&(_0x45a352['OR']=[{'shop':{'name':{'contains':_0x1f3620,'mode':_0x5170ff(0x2f4)}}},{'shop':{'username':{'contains':_0x1f3620,'mode':_0x5170ff(0x2f4)}}},{'notes':{'contains':_0x1f3620,'mode':_0x5170ff(0x2f4)}}]);const [_0x9c06a0,_0x41d029]=await Promise[_0x5170ff(0x2cf)]([database_1['default'][_0x5170ff(0x23f)][_0x5170ff(0x2cc)]({'where':_0x45a352,'skip':_0x6f684e,'take':_0x273b0e,'orderBy':{'createdAt':_0x5170ff(0x272)},'select':{'id':!![],'shopId':!![],'amount':!![],'network':!![],'status':!![],'txid':!![],'notes':!![],'periodFrom':!![],'periodTo':!![],'createdAt':!![],'paidAt':!![],'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x5170ff(0x200)][_0x5170ff(0x23f)][_0x5170ff(0x248)]({'where':_0x45a352})]);return{'payouts':_0x9c06a0[_0x5170ff(0x1d0)](_0x43c374=>({'id':_0x43c374['id'],'shopId':_0x43c374[_0x5170ff(0x1e5)],'shopName':_0x43c374[_0x5170ff(0x2ea)][_0x5170ff(0x1d7)],'shopUsername':_0x43c374[_0x5170ff(0x2ea)]['username'],'amount':_0x43c374[_0x5170ff(0x263)],'network':_0x43c374[_0x5170ff(0x2a1)],'status':_0x43c374[_0x5170ff(0x2b6)],'txid':_0x43c374[_0x5170ff(0x1fc)],'notes':_0x43c374[_0x5170ff(0x274)],'periodFrom':_0x43c374[_0x5170ff(0x2e8)],'periodTo':_0x43c374['periodTo'],'createdAt':_0x43c374['createdAt'],'paidAt':_0x43c374[_0x5170ff(0x1d6)]})),'pagination':{'page':_0x27b1ad,'limit':_0x273b0e,'total':_0x41d029,'totalPages':Math[_0x5170ff(0x2cb)](_0x41d029/_0x273b0e)}};}async[a35_0x3266cf(0x1e6)](_0x377d7f){const _0x3505bc=a35_0x3266cf,_0x5b58c8=await database_1[_0x3505bc(0x200)][_0x3505bc(0x23f)][_0x3505bc(0x238)]({'where':{'id':_0x377d7f},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x5b58c8)return null;return{'id':_0x5b58c8['id'],'shopId':_0x5b58c8[_0x3505bc(0x1e5)],'shopName':_0x5b58c8[_0x3505bc(0x2ea)][_0x3505bc(0x1d7)],'shopUsername':_0x5b58c8['shop'][_0x3505bc(0x2f5)],'amount':_0x5b58c8[_0x3505bc(0x263)],'network':_0x5b58c8[_0x3505bc(0x2a1)],'status':_0x5b58c8[_0x3505bc(0x2b6)],'txid':_0x5b58c8[_0x3505bc(0x1fc)],'notes':_0x5b58c8['notes'],'periodFrom':_0x5b58c8[_0x3505bc(0x2e8)],'periodTo':_0x5b58c8[_0x3505bc(0x20a)],'createdAt':_0x5b58c8[_0x3505bc(0x2da)],'paidAt':_0x5b58c8['paidAt']};}async[a35_0x3266cf(0x2b5)](_0x678abc){const _0x3c2d1d=a35_0x3266cf;await database_1[_0x3c2d1d(0x200)][_0x3c2d1d(0x23f)][_0x3c2d1d(0x24e)]({'where':{'id':_0x678abc}});}async[a35_0x3266cf(0x2a3)](_0x4fcafb){const _0x26787c=a35_0x3266cf,{page:_0xfe034,limit:_0x236b4,status:_0x4d064a,gateway:_0x2f37b5,shopId:_0x52a3f2,dateFrom:_0x14679d,dateTo:_0x5637f0,search:_0x2c225d,currency:_0x4c61ef,sortBy:_0x3c40e6,sortOrder:_0x4bbd3a}=_0x4fcafb,_0x65d256=(_0xfe034-0x1)*_0x236b4;console[_0x26787c(0x1de)]('📊\x20Getting\x20payments\x20with\x20filters:',_0x4fcafb);const _0x23a662=await database_1[_0x26787c(0x200)]['payment']['groupBy']({'by':[_0x26787c(0x2e4)],'_count':{'gateway':!![]}});console[_0x26787c(0x1de)](_0x26787c(0x1fa),_0x23a662[_0x26787c(0x1d0)](_0x280663=>_0x280663['gateway']+'\x20('+_0x280663[_0x26787c(0x1cf)]['gateway']+_0x26787c(0x289)));if(_0x2f37b5){const _0x2cdf14=_0x23a662[_0x26787c(0x2bb)](_0x295b98=>_0x295b98['gateway'][_0x26787c(0x21a)]()===_0x2f37b5[_0x26787c(0x21a)]());!_0x2cdf14&&_0x2f37b5[_0x26787c(0x21a)]()!==_0x26787c(0x294)&&console[_0x26787c(0x1de)](_0x26787c(0x2e0)+_0x2f37b5+_0x26787c(0x230)+_0x23a662[_0x26787c(0x1d0)](_0x4438c9=>_0x4438c9[_0x26787c(0x2e4)])['join'](',\x20'));}const _0x4356f0={};_0x4d064a&&(_0x4356f0[_0x26787c(0x2b6)]=_0x4d064a[_0x26787c(0x260)]());if(!_0x2f37b5)_0x4356f0[_0x26787c(0x2e4)]={'not':'test_gateway'};else{if(_0x2f37b5&&(_0x2f37b5[_0x26787c(0x21a)]()==='test_gateway'||_0x2f37b5===_0x26787c(0x2de)))_0x4356f0[_0x26787c(0x2e4)]=_0x26787c(0x294);else{let _0x50a35a=_0x2f37b5;const _0x5f05a9=(0x0,gateway_1[_0x26787c(0x2e9)])(_0x2f37b5);if(_0x5f05a9)_0x50a35a=_0x5f05a9,console[_0x26787c(0x1de)](_0x26787c(0x2b4)+_0x2f37b5+_0x26787c(0x280)+_0x50a35a+'\x27');else{const _0x293f2f=(0x0,gateway_1[_0x26787c(0x1f4)])(_0x2f37b5);if(_0x293f2f){const _0xd2c42d=(0x0,gateway_1['getGatewayNameById'])(_0x293f2f);_0xd2c42d&&(_0x50a35a=_0xd2c42d,console[_0x26787c(0x1de)](_0x26787c(0x2ca)+_0x2f37b5+_0x26787c(0x2b7)+_0x293f2f+_0x26787c(0x257)+_0x50a35a+'\x27'));}else console[_0x26787c(0x1de)](_0x26787c(0x24b)+_0x2f37b5+_0x26787c(0x268));}const _0x4d6546=await database_1[_0x26787c(0x200)]['payment'][_0x26787c(0x248)]({'where':{'gateway':_0x50a35a[_0x26787c(0x21a)]()},'take':0x1});_0x4d6546===0x0?(console[_0x26787c(0x1de)]('⚠️\x20Gateway\x20\x27'+_0x50a35a+_0x26787c(0x2eb)+_0x2f37b5+_0x26787c(0x28a)),_0x4356f0[_0x26787c(0x2e4)]=_0x26787c(0x300)):(_0x4356f0['gateway']=_0x50a35a[_0x26787c(0x21a)](),console[_0x26787c(0x1de)](_0x26787c(0x295)+_0x50a35a+_0x26787c(0x2eb)+_0x2f37b5+'\x27)'));}}console[_0x26787c(0x1de)](_0x26787c(0x242),_0x4356f0[_0x26787c(0x2e4)]);_0x52a3f2&&(_0x4356f0['shopId']=_0x52a3f2);_0x4c61ef&&(_0x4356f0[_0x26787c(0x2fe)]=_0x4c61ef[_0x26787c(0x260)](),console['log']('💱\x20Currency\x20filter\x20applied:\x20'+_0x4c61ef[_0x26787c(0x260)]()));(_0x14679d||_0x5637f0)&&(_0x4356f0['createdAt']={},_0x14679d&&(_0x4356f0[_0x26787c(0x2da)][_0x26787c(0x228)]=new Date(_0x14679d)),_0x5637f0&&(_0x4356f0[_0x26787c(0x2da)]['lte']=new Date(_0x5637f0)));_0x2c225d&&(_0x4356f0['OR']=[{'id':{'contains':_0x2c225d,'mode':_0x26787c(0x2f4)}},{'orderId':{'contains':_0x2c225d,'mode':_0x26787c(0x2f4)}},{'gatewayOrderId':{'contains':_0x2c225d,'mode':'insensitive'}},{'customerEmail':{'contains':_0x2c225d,'mode':_0x26787c(0x2f4)}},{'shop':{'name':{'contains':_0x2c225d,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x2c225d,'mode':'insensitive'}}}]);console[_0x26787c(0x1de)](_0x26787c(0x2ec),JSON[_0x26787c(0x2b8)](_0x4356f0,null,0x2));let _0x240f59={'createdAt':'desc'};if(_0x3c40e6){const _0x10af76=['amount',_0x26787c(0x2da),'updatedAt',_0x26787c(0x2b6),'gateway',_0x26787c(0x2fe)],_0x5189b5=[_0x26787c(0x2fd),_0x26787c(0x272)];if(_0x10af76[_0x26787c(0x21d)](_0x3c40e6)){const _0x1604b0=_0x5189b5[_0x26787c(0x21d)](_0x4bbd3a)?_0x4bbd3a:_0x26787c(0x272);_0x240f59={[_0x3c40e6]:_0x1604b0},console['log']('📊\x20Sorting\x20payments\x20by\x20'+_0x3c40e6+_0x26787c(0x22f)+_0x1604b0+_0x26787c(0x2d4));}}const [_0x5192c4,_0x5da651]=await Promise['all']([database_1[_0x26787c(0x200)][_0x26787c(0x27f)][_0x26787c(0x2cc)]({'where':_0x4356f0,'skip':_0x65d256,'take':_0x236b4,'orderBy':_0x240f59,'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default'][_0x26787c(0x27f)][_0x26787c(0x248)]({'where':_0x4356f0})]);return{'payments':_0x5192c4,'pagination':{'page':_0xfe034,'limit':_0x236b4,'total':_0x5da651,'totalPages':Math[_0x26787c(0x2cb)](_0x5da651/_0x236b4)}};}async[a35_0x3266cf(0x20e)](_0x36719e){const _0xbc0bf6=a35_0x3266cf,_0x48d6c1=await database_1['default'][_0xbc0bf6(0x27f)][_0xbc0bf6(0x238)]({'where':{'id':_0x36719e},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x48d6c1)return null;return{'id':_0x48d6c1['id'],'shopId':_0x48d6c1[_0xbc0bf6(0x1e5)],'gateway':_0x48d6c1[_0xbc0bf6(0x2e4)],'amount':_0x48d6c1[_0xbc0bf6(0x263)],'currency':_0x48d6c1['currency'],'status':_0x48d6c1[_0xbc0bf6(0x2b6)],'orderId':_0x48d6c1[_0xbc0bf6(0x25f)],'gatewayOrderId':_0x48d6c1['gatewayOrderId'],'customerEmail':_0x48d6c1[_0xbc0bf6(0x1ee)],'customerName':_0x48d6c1['customerName'],'customerCountry':_0x48d6c1[_0xbc0bf6(0x256)],'customerIp':_0x48d6c1[_0xbc0bf6(0x1cb)],'customerUa':_0x48d6c1[_0xbc0bf6(0x213)],'failureMessage':_0x48d6c1['failureMessage'],'externalPaymentUrl':_0x48d6c1[_0xbc0bf6(0x2a7)],'successUrl':_0x48d6c1[_0xbc0bf6(0x217)],'failUrl':_0x48d6c1[_0xbc0bf6(0x281)],'pendingUrl':_0x48d6c1[_0xbc0bf6(0x1e0)],'whiteUrl':_0x48d6c1[_0xbc0bf6(0x231)],'createdAt':_0x48d6c1[_0xbc0bf6(0x2da)],'updatedAt':_0x48d6c1[_0xbc0bf6(0x1d8)],'shop':_0x48d6c1['shop']};}async[a35_0x3266cf(0x286)](_0x5ca64c,_0x4fb1a1,_0x1dffc7,_0x56e3a6){const _0x2c562e=a35_0x3266cf,_0x29d43e=await database_1[_0x2c562e(0x200)][_0x2c562e(0x2e1)](async _0x20025f=>{const _0x168ab9=_0x2c562e,_0x3a5f37=await _0x20025f['payment'][_0x168ab9(0x238)]({'where':{'id':_0x5ca64c},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![],'balance':!![]}}}});if(!_0x3a5f37)throw new Error(_0x168ab9(0x1fb));const _0x578653=_0x3a5f37[_0x168ab9(0x2b6)],_0xf4ccdc=_0x4fb1a1['toUpperCase']();console[_0x168ab9(0x1de)](_0x168ab9(0x2a2)+_0x5ca64c+'\x20status:\x20'+_0x578653+'\x20->\x20'+_0xf4ccdc),console[_0x168ab9(0x1de)](_0x168ab9(0x298)+_0x3a5f37[_0x168ab9(0x2ea)]['balance']+'\x20USDT');const _0x3c7435={'status':_0xf4ccdc,'updatedAt':new Date(),'statusChangedBy':_0x168ab9(0x240),'statusChangedAt':new Date()};_0x1dffc7&&(_0x3c7435[_0x168ab9(0x2ac)]=_0x1dffc7);_0xf4ccdc===_0x168ab9(0x2d2)&&_0x56e3a6&&(_0x3c7435[_0x168ab9(0x2e7)]=_0x56e3a6);let _0x48aa95=0x0,_0x4206c9=_0x3a5f37[_0x168ab9(0x2ea)][_0x168ab9(0x226)];if(_0xf4ccdc===_0x168ab9(0x243)&&_0x578653!==_0x168ab9(0x243)){_0x3c7435['paidAt']=new Date();const _0x3580d8=await currencyService_1[_0x168ab9(0x1ff)]['convertToUSDT'](_0x3a5f37[_0x168ab9(0x263)],_0x3a5f37[_0x168ab9(0x2fe)]);_0x3c7435[_0x168ab9(0x2f6)]=_0x3580d8;let _0x23fff5=0xa;const _0x16040b=await _0x20025f[_0x168ab9(0x2ea)][_0x168ab9(0x238)]({'where':{'id':_0x3a5f37[_0x168ab9(0x1e5)]},'select':{'gatewaySettings':!![]}});if(_0x16040b?.[_0x168ab9(0x25d)])try{const _0x1fe528=JSON[_0x168ab9(0x284)](_0x16040b[_0x168ab9(0x25d)]);for(const [_0x26b820,_0x42b162]of Object[_0x168ab9(0x2b9)](_0x1fe528)){if(_0x26b820[_0x168ab9(0x21a)]()===_0x3a5f37[_0x168ab9(0x2e4)][_0x168ab9(0x21a)]()){_0x23fff5=_0x42b162[_0x168ab9(0x224)]||0xa;break;}}}catch(_0x3d860c){console[_0x168ab9(0x22d)](_0x168ab9(0x1fe)+_0x5ca64c+':',_0x3d860c);}const _0x4a2cbd=_0x3580d8*(0x1-_0x23fff5/0x64);_0x48aa95=_0x4a2cbd,_0x4206c9+=_0x4a2cbd,console[_0x168ab9(0x1de)](_0x168ab9(0x210)+_0x5ca64c+_0x168ab9(0x2ad)),console['log']('\x20\x20\x20Full\x20amount:\x20'+_0x3580d8[_0x168ab9(0x225)](0x6)+_0x168ab9(0x1f7)),console['log'](_0x168ab9(0x21e)+_0x3a5f37[_0x168ab9(0x2e4)]+_0x168ab9(0x244)+_0x23fff5+'%'),console[_0x168ab9(0x1de)](_0x168ab9(0x2a9)+_0x4a2cbd[_0x168ab9(0x225)](0x6)+_0x168ab9(0x1e8)+_0x23fff5+_0x168ab9(0x21c)),console[_0x168ab9(0x1de)](_0x168ab9(0x20f)+_0x4a2cbd['toFixed'](0x6)+_0x168ab9(0x1f7));}else{if(_0x578653===_0x168ab9(0x243)&&_0xf4ccdc!==_0x168ab9(0x243)){if(_0x3a5f37[_0x168ab9(0x2f6)]){let _0x15fd5c=0xa;const _0x3d43a2=await _0x20025f[_0x168ab9(0x2ea)][_0x168ab9(0x238)]({'where':{'id':_0x3a5f37[_0x168ab9(0x1e5)]},'select':{'gatewaySettings':!![]}});if(_0x3d43a2?.[_0x168ab9(0x25d)])try{const _0x4721fb=JSON[_0x168ab9(0x284)](_0x3d43a2[_0x168ab9(0x25d)]);for(const [_0x35482d,_0x28295d]of Object[_0x168ab9(0x2b9)](_0x4721fb)){if(_0x35482d[_0x168ab9(0x21a)]()===_0x3a5f37[_0x168ab9(0x2e4)]['toLowerCase']()){_0x15fd5c=_0x28295d[_0x168ab9(0x224)]||0xa;break;}}}catch(_0x4bbd9b){console[_0x168ab9(0x22d)](_0x168ab9(0x1fe)+_0x5ca64c+':',_0x4bbd9b);}const _0x51cb10=_0x3a5f37[_0x168ab9(0x2f6)]*(0x1-_0x15fd5c/0x64);_0x48aa95=-_0x51cb10,_0x4206c9-=_0x51cb10,_0x3c7435[_0x168ab9(0x2f6)]=null,console[_0x168ab9(0x1de)](_0x168ab9(0x210)+_0x5ca64c+_0x168ab9(0x23b)),console[_0x168ab9(0x1de)](_0x168ab9(0x2c5)+_0x3a5f37[_0x168ab9(0x2f6)]['toFixed'](0x6)+_0x168ab9(0x1f7)),console['log']('\x20\x20\x20Gateway:\x20'+_0x3a5f37['gateway']+_0x168ab9(0x244)+_0x15fd5c+'%'),console['log'](_0x168ab9(0x1d2)+_0x51cb10[_0x168ab9(0x225)](0x6)+_0x168ab9(0x1e8)+_0x15fd5c+'%\x20commission)'),console[_0x168ab9(0x1de)](_0x168ab9(0x26d)+_0x51cb10['toFixed'](0x6)+'\x20USDT');}}}_0xf4ccdc===_0x168ab9(0x2d2)&&(_0x578653==='PAID'&&_0x3a5f37[_0x168ab9(0x2f6)]&&console['log'](_0x168ab9(0x2db)),_0x56e3a6&&_0x56e3a6>0x0&&(_0x48aa95-=_0x56e3a6,_0x4206c9-=_0x56e3a6,console['log'](_0x168ab9(0x299)+_0x56e3a6['toFixed'](0x6)+_0x168ab9(0x273))));_0xf4ccdc===_0x168ab9(0x24c)&&_0x578653===_0x168ab9(0x243)&&console[_0x168ab9(0x1de)](_0x168ab9(0x279));const _0x557c3b=await _0x20025f[_0x168ab9(0x27f)]['update']({'where':{'id':_0x5ca64c},'data':_0x3c7435,'include':{'shop':{'select':{'name':!![],'username':!![]}}}});return _0x48aa95!==0x0&&(await _0x20025f['shop'][_0x168ab9(0x2df)]({'where':{'id':_0x3a5f37['shopId']},'data':{'balance':_0x4206c9}}),console[_0x168ab9(0x1de)](_0x168ab9(0x2b1)+_0x3a5f37[_0x168ab9(0x1e5)]+_0x168ab9(0x26c)+_0x3a5f37[_0x168ab9(0x2ea)][_0x168ab9(0x226)]['toFixed'](0x6)+_0x168ab9(0x232)+_0x4206c9['toFixed'](0x6)+_0x168ab9(0x278)+(_0x48aa95>0x0?'+':'')+_0x48aa95[_0x168ab9(0x225)](0x6)+')')),_0x557c3b;});return{'id':_0x29d43e['id'],'shopId':_0x29d43e[_0x2c562e(0x1e5)],'gateway':_0x29d43e[_0x2c562e(0x2e4)],'amount':_0x29d43e[_0x2c562e(0x263)],'currency':_0x29d43e[_0x2c562e(0x2fe)],'status':_0x29d43e[_0x2c562e(0x2b6)],'orderId':_0x29d43e['orderId'],'gatewayOrderId':_0x29d43e[_0x2c562e(0x1ce)],'customerEmail':_0x29d43e[_0x2c562e(0x1ee)],'customerName':_0x29d43e[_0x2c562e(0x23c)],'customerCountry':_0x29d43e[_0x2c562e(0x256)],'customerIp':_0x29d43e['customerIp'],'customerUa':_0x29d43e['customerUa'],'failureMessage':_0x29d43e[_0x2c562e(0x216)],'adminNotes':_0x29d43e[_0x2c562e(0x2ac)],'chargebackAmount':_0x29d43e[_0x2c562e(0x2e7)],'statusChangedBy':_0x29d43e[_0x2c562e(0x282)],'statusChangedAt':_0x29d43e[_0x2c562e(0x229)],'createdAt':_0x29d43e[_0x2c562e(0x2da)],'updatedAt':_0x29d43e['updatedAt'],'shop':_0x29d43e[_0x2c562e(0x2ea)]};}async[a35_0x3266cf(0x28e)](_0x9a405d,_0x20ce58){const _0x85231=a35_0x3266cf,_0x16f0c4={..._0x20ce58};_0x20ce58[_0x85231(0x1d4)]&&(_0x16f0c4[_0x85231(0x1d4)]=await bcryptjs_1[_0x85231(0x200)][_0x85231(0x207)](_0x20ce58[_0x85231(0x1d4)],0xc));_0x20ce58['fullName']&&(_0x16f0c4[_0x85231(0x1d7)]=_0x20ce58[_0x85231(0x1df)],delete _0x16f0c4[_0x85231(0x1df)]);_0x20ce58[_0x85231(0x293)]&&(_0x16f0c4[_0x85231(0x2d0)]=_0x20ce58['telegramId'],delete _0x16f0c4['telegramId']);_0x20ce58[_0x85231(0x1eb)]&&(_0x16f0c4[_0x85231(0x208)]=_0x20ce58[_0x85231(0x1eb)],delete _0x16f0c4[_0x85231(0x1eb)]);if(_0x20ce58['gateways']){const _0x2b8d3b=_0x20ce58['gateways'][_0x85231(0x1d0)](_0x3980f7=>this[_0x85231(0x2ee)](_0x3980f7));console[_0x85231(0x1de)](_0x85231(0x24d),_0x20ce58[_0x85231(0x1e3)],'->',_0x2b8d3b),_0x16f0c4[_0x85231(0x1fd)]=JSON['stringify'](_0x2b8d3b),delete _0x16f0c4[_0x85231(0x1e3)];}_0x20ce58[_0x85231(0x25d)]&&(_0x16f0c4[_0x85231(0x25d)]=JSON[_0x85231(0x2b8)](_0x20ce58[_0x85231(0x25d)]),delete _0x16f0c4['gatewaySettings']);_0x20ce58[_0x85231(0x2ed)]&&(_0x20ce58[_0x85231(0x2ed)][_0x85231(0x285)]!==undefined&&(_0x16f0c4[_0x85231(0x285)]=_0x20ce58[_0x85231(0x2ed)]['usdtPolygonWallet']||null),_0x20ce58[_0x85231(0x2ed)][_0x85231(0x26a)]!==undefined&&(_0x16f0c4[_0x85231(0x26a)]=_0x20ce58[_0x85231(0x2ed)][_0x85231(0x26a)]||null),_0x20ce58[_0x85231(0x2ed)][_0x85231(0x249)]!==undefined&&(_0x16f0c4[_0x85231(0x249)]=_0x20ce58[_0x85231(0x2ed)]['usdtErcWallet']||null),_0x20ce58[_0x85231(0x2ed)][_0x85231(0x20d)]!==undefined&&(_0x16f0c4[_0x85231(0x20d)]=_0x20ce58[_0x85231(0x2ed)][_0x85231(0x20d)]||null),delete _0x16f0c4[_0x85231(0x2ed)]);const _0x15dae6=await database_1[_0x85231(0x200)][_0x85231(0x2ea)]['update']({'where':{'id':_0x9a405d},'data':_0x16f0c4,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x15dae6['id'],'fullName':_0x15dae6[_0x85231(0x1d7)],'username':_0x15dae6[_0x85231(0x2f5)],'telegramId':_0x15dae6[_0x85231(0x2d0)],'merchantUrl':_0x15dae6['shopUrl'],'gateways':_0x15dae6[_0x85231(0x1fd)]?JSON[_0x85231(0x284)](_0x15dae6[_0x85231(0x1fd)]):null,'gatewaySettings':_0x15dae6['gatewaySettings']?JSON['parse'](_0x15dae6[_0x85231(0x25d)]):null,'publicKey':_0x15dae6[_0x85231(0x2aa)],'wallets':{'usdtPolygonWallet':_0x15dae6[_0x85231(0x285)],'usdtTrcWallet':_0x15dae6['usdtTrcWallet'],'usdtErcWallet':_0x15dae6[_0x85231(0x249)],'usdcPolygonWallet':_0x15dae6[_0x85231(0x20d)]},'status':_0x15dae6[_0x85231(0x2b6)],'createdAt':_0x15dae6[_0x85231(0x2da)]};}async[a35_0x3266cf(0x1da)](_0x805809){const _0x5706e5=a35_0x3266cf,_0x2b5b16=await database_1['default'][_0x5706e5(0x2ea)][_0x5706e5(0x2df)]({'where':{'id':_0x805809},'data':{'status':_0x5706e5(0x25c)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x2b5b16['id'],'fullName':_0x2b5b16[_0x5706e5(0x1d7)],'username':_0x2b5b16['username'],'telegramId':_0x2b5b16[_0x5706e5(0x2d0)],'merchantUrl':_0x2b5b16['shopUrl'],'gateways':_0x2b5b16[_0x5706e5(0x1fd)]?JSON['parse'](_0x2b5b16[_0x5706e5(0x1fd)]):null,'gatewaySettings':_0x2b5b16['gatewaySettings']?JSON[_0x5706e5(0x284)](_0x2b5b16[_0x5706e5(0x25d)]):null,'publicKey':_0x2b5b16[_0x5706e5(0x2aa)],'wallets':{'usdtPolygonWallet':_0x2b5b16['usdtPolygonWallet'],'usdtTrcWallet':_0x2b5b16[_0x5706e5(0x26a)],'usdtErcWallet':_0x2b5b16['usdtErcWallet'],'usdcPolygonWallet':_0x2b5b16[_0x5706e5(0x20d)]},'status':_0x2b5b16[_0x5706e5(0x2b6)],'createdAt':_0x2b5b16['createdAt']};}async[a35_0x3266cf(0x297)](_0x18a248){const _0xbb69b7=a35_0x3266cf,_0x3e8aee=await database_1[_0xbb69b7(0x200)][_0xbb69b7(0x2ea)][_0xbb69b7(0x2df)]({'where':{'id':_0x18a248},'data':{'status':_0xbb69b7(0x290)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x3e8aee['id'],'fullName':_0x3e8aee[_0xbb69b7(0x1d7)],'username':_0x3e8aee[_0xbb69b7(0x2f5)],'telegramId':_0x3e8aee['telegram'],'merchantUrl':_0x3e8aee[_0xbb69b7(0x208)],'gateways':_0x3e8aee[_0xbb69b7(0x1fd)]?JSON[_0xbb69b7(0x284)](_0x3e8aee['paymentGateways']):null,'gatewaySettings':_0x3e8aee[_0xbb69b7(0x25d)]?JSON[_0xbb69b7(0x284)](_0x3e8aee['gatewaySettings']):null,'publicKey':_0x3e8aee['publicKey'],'wallets':{'usdtPolygonWallet':_0x3e8aee['usdtPolygonWallet'],'usdtTrcWallet':_0x3e8aee[_0xbb69b7(0x26a)],'usdtErcWallet':_0x3e8aee[_0xbb69b7(0x249)],'usdcPolygonWallet':_0x3e8aee[_0xbb69b7(0x20d)]},'status':_0x3e8aee[_0xbb69b7(0x2b6)],'createdAt':_0x3e8aee[_0xbb69b7(0x2da)]};}async['getAllUsers'](_0x1eaaa4){const _0x59cc61=a35_0x3266cf,{page:_0x4c9a5e,limit:_0xd553c0,status:_0x256348}=_0x1eaaa4,_0xbca739=(_0x4c9a5e-0x1)*_0xd553c0,_0x36582a={};_0x256348&&(_0x36582a[_0x59cc61(0x2b6)]=_0x256348[_0x59cc61(0x260)]());const [_0x372009,_0x24599e]=await Promise['all']([database_1[_0x59cc61(0x200)][_0x59cc61(0x2ea)][_0x59cc61(0x2cc)]({'where':_0x36582a,'skip':_0xbca739,'take':_0xd553c0,'orderBy':{'createdAt':'desc'},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}}),database_1[_0x59cc61(0x200)][_0x59cc61(0x2ea)][_0x59cc61(0x248)]({'where':_0x36582a})]);return{'users':_0x372009[_0x59cc61(0x1d0)](_0x3d9c1a=>{const _0x5b6d20=_0x59cc61,_0x15a558=_0x3d9c1a[_0x5b6d20(0x1fd)]?JSON[_0x5b6d20(0x284)](_0x3d9c1a[_0x5b6d20(0x1fd)]):null,_0x457ed8=_0x15a558?_0x15a558['map'](_0x44c056=>this[_0x5b6d20(0x22e)](_0x44c056)):null;return{'id':_0x3d9c1a['id'],'fullName':_0x3d9c1a[_0x5b6d20(0x1d7)],'username':_0x3d9c1a['username'],'telegramId':_0x3d9c1a[_0x5b6d20(0x2d0)],'merchantUrl':_0x3d9c1a[_0x5b6d20(0x208)],'gateways':_0x457ed8,'gatewaySettings':_0x3d9c1a['gatewaySettings']?JSON[_0x5b6d20(0x284)](_0x3d9c1a['gatewaySettings']):null,'publicKey':_0x3d9c1a[_0x5b6d20(0x2aa)],'wallets':{'usdtPolygonWallet':_0x3d9c1a[_0x5b6d20(0x285)],'usdtTrcWallet':_0x3d9c1a[_0x5b6d20(0x26a)],'usdtErcWallet':_0x3d9c1a[_0x5b6d20(0x249)],'usdcPolygonWallet':_0x3d9c1a['usdcPolygonWallet']},'status':_0x3d9c1a[_0x5b6d20(0x2b6)],'createdAt':_0x3d9c1a['createdAt']};}),'pagination':{'page':_0x4c9a5e,'limit':_0xd553c0,'total':_0x24599e,'totalPages':Math[_0x59cc61(0x2cb)](_0x24599e/_0xd553c0)}};}async['getUserById'](_0xdc7f8b){const _0xe54e40=a35_0x3266cf,_0xf43f26=await database_1['default'][_0xe54e40(0x2ea)]['findUnique']({'where':{'id':_0xdc7f8b},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});if(!_0xf43f26)return null;const _0x3406f6=_0xf43f26[_0xe54e40(0x1fd)]?JSON[_0xe54e40(0x284)](_0xf43f26[_0xe54e40(0x1fd)]):null,_0x22818c=_0x3406f6?_0x3406f6[_0xe54e40(0x1d0)](_0xff3e90=>this['getGatewayDisplayName'](_0xff3e90)):null;return _0x3406f6&&_0x22818c&&console[_0xe54e40(0x1de)](_0xe54e40(0x239),_0x3406f6,'->',_0x22818c),{'id':_0xf43f26['id'],'fullName':_0xf43f26[_0xe54e40(0x1d7)],'username':_0xf43f26['username'],'telegramId':_0xf43f26['telegram'],'merchantUrl':_0xf43f26[_0xe54e40(0x208)],'gateways':_0x22818c,'gatewaySettings':_0xf43f26[_0xe54e40(0x25d)]?JSON[_0xe54e40(0x284)](_0xf43f26[_0xe54e40(0x25d)]):null,'publicKey':_0xf43f26['publicKey'],'wallets':{'usdtPolygonWallet':_0xf43f26[_0xe54e40(0x285)],'usdtTrcWallet':_0xf43f26['usdtTrcWallet'],'usdtErcWallet':_0xf43f26[_0xe54e40(0x249)],'usdcPolygonWallet':_0xf43f26[_0xe54e40(0x20d)]},'status':_0xf43f26[_0xe54e40(0x2b6)],'createdAt':_0xf43f26[_0xe54e40(0x2da)]};}async[a35_0x3266cf(0x2e3)](_0x47579c){const _0x50522e=a35_0x3266cf,{fullName:_0x27257a,username:_0x22c131,password:_0x281f07,telegramId:_0x442c3c,merchantUrl:_0x1437c3,gateways:_0x1c6a34,gatewaySettings:_0x2cf925,wallets:_0x56daa3}=_0x47579c,_0x1c65d3=await database_1[_0x50522e(0x200)][_0x50522e(0x2ea)][_0x50522e(0x238)]({'where':{'username':_0x22c131}});if(_0x1c65d3)throw new Error(_0x50522e(0x1dc));if(_0x442c3c){const _0x4ca27a=await database_1[_0x50522e(0x200)]['shop']['findUnique']({'where':{'telegram':_0x442c3c}});if(_0x4ca27a)throw new Error(_0x50522e(0x277));}const _0x133406=await bcryptjs_1[_0x50522e(0x200)][_0x50522e(0x207)](_0x281f07,0xc),_0x4d76e2=_0x50522e(0x251)+crypto_1[_0x50522e(0x200)][_0x50522e(0x22b)](0x20)[_0x50522e(0x2a5)](_0x50522e(0x24f)),_0x1d2953=_0x50522e(0x1f5)+crypto_1[_0x50522e(0x200)][_0x50522e(0x22b)](0x20)['toString'](_0x50522e(0x24f)),_0x911e51=_0x1c6a34?_0x1c6a34[_0x50522e(0x1d0)](_0x353c71=>this[_0x50522e(0x2ee)](_0x353c71)):null;_0x1c6a34&&_0x911e51&&console[_0x50522e(0x1de)]('🔄\x20Gateway\x20mapping\x20(create):',_0x1c6a34,'->',_0x911e51);const _0x403927=await database_1[_0x50522e(0x200)][_0x50522e(0x2ea)][_0x50522e(0x2c1)]({'data':{'name':_0x27257a,'username':_0x22c131,'password':_0x133406,'telegram':_0x442c3c,'shopUrl':_0x1437c3,'paymentGateways':_0x911e51?JSON[_0x50522e(0x2b8)](_0x911e51):null,'gatewaySettings':_0x2cf925?JSON[_0x50522e(0x2b8)](_0x2cf925):null,'usdtPolygonWallet':_0x56daa3?.[_0x50522e(0x285)]||null,'usdtTrcWallet':_0x56daa3?.['usdtTrcWallet']||null,'usdtErcWallet':_0x56daa3?.['usdtErcWallet']||null,'usdcPolygonWallet':_0x56daa3?.[_0x50522e(0x20d)]||null,'publicKey':_0x4d76e2,'secretKey':_0x1d2953,'status':_0x50522e(0x290)},'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]}});return{'id':_0x403927['id'],'fullName':_0x403927['name'],'username':_0x403927[_0x50522e(0x2f5)],'telegramId':_0x403927[_0x50522e(0x2d0)],'merchantUrl':_0x403927[_0x50522e(0x208)],'gateways':_0x403927['paymentGateways']?JSON[_0x50522e(0x284)](_0x403927[_0x50522e(0x1fd)]):null,'gatewaySettings':_0x403927['gatewaySettings']?JSON['parse'](_0x403927[_0x50522e(0x25d)]):null,'publicKey':_0x403927[_0x50522e(0x2aa)],'wallets':{'usdtPolygonWallet':_0x403927[_0x50522e(0x285)],'usdtTrcWallet':_0x403927[_0x50522e(0x26a)],'usdtErcWallet':_0x403927[_0x50522e(0x249)],'usdcPolygonWallet':_0x403927['usdcPolygonWallet']},'status':_0x403927[_0x50522e(0x2b6)],'createdAt':_0x403927[_0x50522e(0x2da)]};}async[a35_0x3266cf(0x2a8)](_0x1c340a){const _0x101277=a35_0x3266cf;await database_1[_0x101277(0x200)]['shop'][_0x101277(0x24e)]({'where':{'id':_0x1c340a}});}[a35_0x3266cf(0x25b)](_0x315e67,_0x2690fa,_0x50169a){const _0x4e7b22=a35_0x3266cf,_0x48ccef=new Map(),_0x19a807=new Date(_0x2690fa);while(_0x19a807<=_0x50169a){const _0x240152=_0x19a807[_0x4e7b22(0x211)]()['split']('T')[0x0];_0x48ccef[_0x4e7b22(0x222)](_0x240152,{'revenue':0x0,'count':0x0}),_0x19a807[_0x4e7b22(0x1e4)](_0x19a807[_0x4e7b22(0x26b)]()+0x1);}for(const _0x4f2d92 of _0x315e67){const _0x16e09f=_0x4f2d92['createdAt']['toISOString']()[_0x4e7b22(0x2b2)]('T')[0x0],_0x530eb0=_0x48ccef['get'](_0x16e09f);_0x530eb0&&(_0x530eb0[_0x4e7b22(0x248)]+=0x1,_0x4f2d92[_0x4e7b22(0x2b6)]==='PAID'&&(_0x4f2d92[_0x4e7b22(0x2f6)]?_0x530eb0['revenue']+=_0x4f2d92[_0x4e7b22(0x2f6)]:console['log'](_0x4e7b22(0x1d5)+_0x4f2d92['id']+_0x4e7b22(0x1f6))));}const _0x119ec4=[],_0x113410=[];for(const [_0x59975d,_0x2fff16]of _0x48ccef){_0x119ec4[_0x4e7b22(0x276)]({'date':_0x59975d,'amount':Math[_0x4e7b22(0x258)](_0x2fff16[_0x4e7b22(0x25e)]*0x64)/0x64}),_0x113410[_0x4e7b22(0x276)]({'date':_0x59975d,'count':_0x2fff16[_0x4e7b22(0x248)]});}return{'dailyRevenue':_0x119ec4,'dailyPayments':_0x113410};}}exports[a35_0x3266cf(0x1e9)]=AdminService;function a35_0x23ef(){const _0xe55a02=['usdtTrcWallet','getDate','\x20balance\x20updated:\x20','\x20\x20\x20Subtracted\x20from\x20balance:\x20-','\x20USDT\x20(same\x20as\x20awaiting)','availableBalance','crypto','getAllPayouts','desc','\x20USDT\x20from\x20balance','notes','9IHdfKM','push','Telegram\x20username\x20already\x20exists','\x20USDT\x20(','🔄\x20REFUND:\x20Payment\x20amount\x20already\x20deducted\x20from\x20balance','amountAfterCommissionUSDT','klyme_gb','📋\x20Getting\x20merchants\x20selection\x20list...','convertToUSDT','bcryptjs','payment','\x27\x20to\x20name\x20\x27','failUrl','statusChangedBy','period','parse','usdtPolygonWallet','updatePaymentStatus','105oZrgmS','Plisio','\x20payments)','\x27)\x20not\x20found\x20in\x20database,\x20returning\x20empty\x20result','polygon_usdc','2020-01-01','plisio','updateUser','📅\x20Period\x20\x27all\x27:\x20Using\x20start\x20date\x20from\x20first\x20payment:\x20','ACTIVE','COMPLETED','forEach','telegramId','test_gateway','✅\x20Using\x20gateway\x20filter:\x20\x27','\x20USDT\x20(-','activateUser','💰\x20Current\x20shop\x20balance:\x20','💸\x20CHARGEBACK\x20penalty:\x20-','\x20\x20\x20⏳\x20Awaiting\x20payout:\x20','getSystemStatistics','📋\x20Found\x20','\x20\x20\x20�\x20Total\x20payments\x20turnover:\x20','totalCommissionRate','6YcwccY','1189505TYSbCG','network','🔄\x20Admin\x20updating\x20payment\x20','getAllPayments','\x20\x20\x20💰\x20Total\x20payout:\x20','toString','merchantEarnings','externalPaymentUrl','deleteUser','\x20\x20\x20Merchant\x20gets:\x20','publicKey','📊\x20Merchants\x20awaiting\x20payout:\x20','adminNotes','\x20became\x20PAID:','aggregate','\x20\x20\x20📅\x20This\x20month:\x20','\x20merchants\x20with\x20positive\x20balance','💰\x20Shop\x20','split','\x20USDT\x20(gross\x20revenue)','🔄\x20Converted\x20gateway\x20ID\x20\x27','deletePayout','status','\x27\x20->\x20ID\x20\x27','stringify','entries','getMerchantsAwaitingPayout','some','rapyd',':\x20commission\x20=\x20','MasterCard','KLYME\x20GB','cointopay2','create','dateTo','\x20\x20\x20📊\x20Commission\x20difference:\x20','erc20','\x20\x20\x20Full\x20amount:\x20','values','sort','💰\x20Creating\x20payout\x20for\x20shop\x20','2327013MpQmAY','🔄\x20Converted\x20gateway\x20name\x20\x27','ceil','findMany','1MOIeGF','getFullYear','all','telegram','mastercard','CHARGEBACK','gatewayEarnings','\x20order','📊\x20Merchant\x20statistics\x20calculated:','Noda','length','totalPaidOut','\x20\x20\x20💰\x20Total\x20turnover:\x20','createdAt','💸\x20CHARGEBACK:\x20Merchant\x20amount\x20already\x20deducted\x20from\x20balance','\x20\x20\x20🌍\x20Country:\x20','\x20\x20\x20💵\x20Available\x20balance:\x20','0000','update','⚠️\x20Requested\x20gateway\x20\x27','$transaction','382404Ioaszq','createUser','gateway','turnover','averageCheckUSDT','chargebackAmount','periodFrom','getGatewayNameById','shop','\x27\x20(from\x20\x27','📊\x20Final\x20WHERE\x20conditions:','wallets','getGatewayInternalName','11yoQzxP','polygon','\x20\x20\x20Current\x20total\x20paid\x20out:\x20','\x20\x20\x20💸\x20Total\x20payouts\x20(all\x20time):\x20','📊\x20Getting\x20merchant\x20statistics\x20with\x20filters:','insensitive','username','amountUSDT','date',',\x20successful:\x20','\x20USDT\x20(after\x20payouts)','\x20merchants','groupBy','💰\x20Found\x20','asc','currency','1624918jGQKWX','NONEXISTENT_GATEWAY_FILTER','customerIp','week','4568520oOgTUK','gatewayOrderId','_count','map','paymentsCount','\x20\x20\x20Merchant\x20loses:\x20','\x20\x20\x20🏪\x20Gateway\x20earnings:\x20','password','⚠️\x20Payment\x20','paidAt','name','updatedAt','getMerchantsSelection','suspendUser','30d','Username\x20already\x20exists','totalTurnover','log','fullName','pendingUrl','\x20USDT\x20(+','trc20','gateways','setDate','shopId','getPayoutById','updateCustomerData','\x20USDT\x20(after\x20','AdminService','thisMonth','merchantUrl','custom','\x20active\x20merchants\x20for\x20selection','customerEmail','90d','commissionUSDT','\x20paid\x20payments\x20for\x20analysis','\x20\x20\x20💰\x20Total\x20payments\x20turnover:\x20','totalAmountAfterCommissionUSDT','getGatewayIdByName','sk_','\x20missing\x20amountUSDT,\x20using\x20fallback\x20conversion','\x20USDT','dailyRevenue','merchantEarningsUSDT','📊\x20Available\x20gateways\x20in\x20database:','Payment\x20not\x20found','txid','paymentGateways','Error\x20parsing\x20gateway\x20settings\x20for\x20payment\x20','currencyService','default','Error\x20parsing\x20gateway\x20settings\x20for\x20shop\x20','\x20USDT\x20(actual\x20balances)','📊\x20Calculating\x20payout\x20statistics...','defineProperty','📊\x20Payout\x20statistics\x20calculated:','\x20\x20\x20Transaction\x20hash:\x20','hash','shopUrl','CoinToPay','periodTo','💰\x20[PAYOUT]\x20Gateway\x20','_sum','usdcPolygonWallet','getPaymentById','\x20\x20\x20Added\x20to\x20balance:\x20+','💰\x20Payment\x20','toISOString','reduce','customerUa','3505436uVxKOu','getTime','failureMessage','successUrl','__esModule','675544gMgPmU','toLowerCase','\x20\x20\x20🔍\x20Calculated\x20after\x20commission:\x20','%\x20commission)','includes','\x20\x20\x20Gateway:\x20','totalPayments','Rapyd','cointopay','set','dailyPayments','commission','toFixed','balance','not\x20set','gte','statusChangedAt','\x20\x20\x20📅\x20Total\x20payouts\x20(this\x20month):\x20','randomBytes','findFirst','error','getGatewayDisplayName','\x20in\x20','\x27\x20not\x20found.\x20Available\x20gateways:\x20','whiteUrl','\x20->\x20','\x20\x20\x20🔍\x20Raw\x20balance\x20sum:\x20','getMonth','\x20for\x20shop\x20','klyme_de','\x20USDT)','findUnique','🔄\x20Gateway\x20mapping\x20(get):','noda','\x20no\x20longer\x20PAID:','customerName','\x20\x20\x20Total\x20paid\x20out:\x20','\x20USDT\x20(total\x20paid\x20to\x20merchants)','payout','admin','3lKaLFx','📊\x20Gateway\x20filter\x20applied:','PAID',',\x20Commission:\x20','\x20\x20\x20✅\x20Actual\x20available\x20balance:\x20','\x20\x20\x20💳\x20Total\x20payments:\x20','awaitingPayout','count','usdtErcWallet','📅\x20Period:\x20','🔍\x20Using\x20gateway\x20\x27','REFUND','🔄\x20Gateway\x20mapping:','delete','hex','turnoverUSDT','pk_','✅\x20Payout\x20created:\x20','lte','averageCommissionRate','📊\x20Total\x20payments\x20(including\x20failed):\x20','customerCountry','\x27\x20->\x20name\x20\x27','round','totalPayout','Open\x20Banking\x202','generateDailyStatistics','SUSPENDED','gatewaySettings','revenue','orderId','toUpperCase','paidOutUSDT','totalAmountUSDT','amount','\x20to\x20','\x20\x20\x20Balance:\x20','getPayoutStats','\x20USDT,\x20Requested:\x20','\x27\x20as\x20is\x20(not\x20found\x20in\x20mappings)','🔄\x20Updating\x20customer\x20data\x20for\x20payment\x20'];a35_0x23ef=function(){return _0xe55a02;};return a35_0x23ef();}