'use strict';const a33_0x51f586=a33_0x11e2;(function(_0x16e69b,_0x3e0552){const _0x2fec84=a33_0x11e2,_0x2e7882=_0x16e69b();while(!![]){try{const _0xd7014a=-parseInt(_0x2fec84(0x164))/0x1+parseInt(_0x2fec84(0x11d))/0x2*(-parseInt(_0x2fec84(0x1bd))/0x3)+-parseInt(_0x2fec84(0x102))/0x4+-parseInt(_0x2fec84(0x199))/0x5*(-parseInt(_0x2fec84(0x183))/0x6)+-parseInt(_0x2fec84(0x1c8))/0x7*(-parseInt(_0x2fec84(0x124))/0x8)+parseInt(_0x2fec84(0x10f))/0x9+-parseInt(_0x2fec84(0x11b))/0xa*(parseInt(_0x2fec84(0x134))/0xb);if(_0xd7014a===_0x3e0552)break;else _0x2e7882['push'](_0x2e7882['shift']());}catch(_0x196016){_0x2e7882['push'](_0x2e7882['shift']());}}}(a33_0x408d,0x9601a));var __importDefault=this&&this[a33_0x51f586(0x18a)]||function(_0x3ececc){const _0x29963f=a33_0x51f586;return _0x3ececc&&_0x3ececc[_0x29963f(0x153)]?_0x3ececc:{'default':_0x3ececc};};Object[a33_0x51f586(0xf9)](exports,'__esModule',{'value':!![]}),exports[a33_0x51f586(0x135)]=void 0x0;function a33_0x11e2(_0x1b8a0a,_0x5add1c){const _0x408d86=a33_0x408d();return a33_0x11e2=function(_0x11e2e2,_0x32413b){_0x11e2e2=_0x11e2e2-0xf3;let _0x2043b9=_0x408d86[_0x11e2e2];return _0x2043b9;},a33_0x11e2(_0x1b8a0a,_0x5add1c);}function a33_0x408d(){const _0x1de1ba=['network','remitterIban','error','abs','length','desc','updatedAt','adminNotes','6605802dvnwta','CHARGEBACK','createUser','ceil','Payment\x20not\x20found','‚úÖ\x20Payout\x20statistics\x20calculated:','üîÑ\x20Admin\x20updating\x20payment\x20','‚úÖ\x20Payment\x20','30d','üîç\x20Getting\x20payment\x20by\x20ID:\x20','üìä\x20Found\x20','size','9170cWBmQw','Chargeback\x20amount\x20is\x20required\x20and\x20must\x20be\x20positive\x20(amount\x20in\x20USDT)','368Zkbbma','\x20status\x20updated\x20from\x20','\x20total','getMonth','getAllUsers','getGatewayNameById','90d','24ejwVcZ','ACTIVE','asc','customerName','\x20merchants\x20with\x20eligible\x20PAID\x20payments','userService','amountUSDT','\x20USDT\x20via\x20','calculateEffectiveAmount','gatewaySettings','slice','REFUND','‚ùå\x20Payment\x20not\x20found:\x20','\x20merchants\x20out\x20of\x20','getDate','notes','4631gKicEP','AdminService','chargebackAmount','usdtTrcWallet','convertToUSDT','log','currency','amountAfterCommissionUSDT','Invalid\x20status.\x20Valid\x20statuses:\x20','all','delete','\x20days','üí∞\x20Found\x20','createPayout','EXPIRED','paidAt','amount','telegram','getPayoutById','name','deletePayout','calculateAmountAfterCommission','payoutDelay','generateDateRange','split','UserService','‚úÖ\x20Found\x20payout:\x20','PAID','lte','toUpperCase','üè™\x20Found\x20','__esModule','publicKey','usdcPolygonWallet','shop','shopId','expiresAt','totalAmountUSDT','getSystemStatistics','üí∞\x20Total\x20amount:\x20','bankId','./currencyService',',\x20amount:\x20','üìã\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','üìä\x20Generating\x20admin\x20statistics\x20for\x20period:\x20','has','count','getFullYear','466518WgcnrW','merchantPaid','includes','üîÑ\x20Marking\x20payments\x20as\x20paid\x20out\x20for\x20shop\x20','./telegramBotService','üí∏\x20Total\x20Payout:\x20','\x20USDT\x20(—Ç–æ–ª—å–∫–æ\x20PAID\x20–ø–ª–∞—Ç–µ–∂–∏)','cardLast4','orderId','payment','activateUser','sort','\x20suspended\x20successfully','‚úÖ\x20Activating\x20user:\x20','toFixed','toISOString','externalPaymentUrl','Payout\x20not\x20found','updateUser','\x20USDT\x20(–≤–∫–ª—é—á–∞—è\x20—à—Ç—Ä–∞—Ñ—ã\x20chargeback)','usdtPolygonWallet','\x20eligible\x20PAID\x20payments\x20for\x20payout\x20analysis','User\x20is\x20already\x20suspended','map','üîç\x20Getting\x20payout\x20by\x20ID:\x20','‚úÖ\x20User\x20','\x20days)','../config/database','update','\x20USDT\x20after\x20commission)','üìà\x20Average\x20payment:\x20','26790nYExGo','User\x20not\x20found','txid','statusChangedAt','sourceCurrency','currencyService','get','__importDefault','Error\x20parsing\x20gateway\x20settings:','$queryRaw','\x20USDT\x20(will\x20be\x20deducted\x20from\x20merchant\x20balance)','getUserById','webhookLog','webhookLogs','getGatewaySettings','parse','updateMany','payments','‚úÖ\x20Found\x20payment:\x20','date','üí∞\x20Available\x20Balance:\x20','\x20status\x20to:\x20','1250SsTKKk','gatewayOrderId','admin_status_update','customerEmail','‚úÖ\x20Returning\x20','createdAt','markPaymentsAsPaidOut','getTime','totalPayout','set','üí∏\x20Chargeback\x20penalty:\x20','toLowerCase','getAllPayments','totalAmountAfterCommissionUSDT','PENDING','isEligibleForPayout','Failed\x20to\x20send\x20Telegram\x20payout\x20notification:','awaitingPayout','paymentGateways','findUnique','getMerchantsAwaitingPayout','create','gateway','SUSPENDED','insensitive','gte','updatePaymentStatus','üö´\x20Suspending\x20user:\x20','reduce','\x20payments\x20for\x20analysis\x20(PAID/REFUND/CHARGEBACK)','admin','\x20deleted\x20successfully','default','\x20payments\x20as\x20paid\x20out','stringify','completed','7032DPSUak','üíµ\x20Total\x20revenue:\x20','payout','üìÖ\x20Processing\x20daily\x20stats\x20for\x20','deleteUser','\x20USDT\x20(','üìã\x20Getting\x20users\x20with\x20filters:','commission','round','findMany','üí≥\x20Total\x20payments:\x20','337862EKOmlu','isValidGatewayId','gatewayPaymentId','suspendUser','getPaymentById','getPayoutStats','availableBalance','defineProperty','remitterName','getAllPayouts','\x20USDT','statusChangedBy','\x20USDT\x20(penalty\x20amount)','status','push','setDate','386916GPJZax','User\x20is\x20already\x20active','username','\x20payments\x20out\x20of\x20','üìã\x20Getting\x20payments\x20with\x20filters:'];a33_0x408d=function(){return _0x1de1ba;};return a33_0x408d();}const database_1=__importDefault(require(a33_0x51f586(0x17f))),currencyService_1=require(a33_0x51f586(0x15d)),userService_1=require('./userService'),telegramBotService_1=require(a33_0x51f586(0x168)),gateway_1=require('../types/gateway');class AdminService{constructor(){const _0x5c87c7=a33_0x51f586;this[_0x5c87c7(0x129)]=new userService_1[(_0x5c87c7(0x14d))]();}['getPeriodDays'](_0x3ac713){const _0x5a6c39=a33_0x51f586;switch(_0x3ac713){case'7d':return 0x7;case _0x5a6c39(0x117):return 0x1e;case _0x5a6c39(0x123):return 0x5a;case'1y':return 0x16d;default:return 0x1e;}}[a33_0x51f586(0x14b)](_0x126f1b,_0x208c2b){const _0x2692c2=a33_0x51f586,_0x340041=[],_0x1504a0=new Date(_0x126f1b);while(_0x1504a0<=_0x208c2b){_0x340041[_0x2692c2(0x100)](_0x1504a0[_0x2692c2(0x173)]()[_0x2692c2(0x14c)]('T')[0x0]),_0x1504a0[_0x2692c2(0x101)](_0x1504a0['getDate']()+0x1);}return _0x340041;}[a33_0x51f586(0x191)](_0x42e2b5,_0x305a19){const _0x2f309c=a33_0x51f586;if(!_0x42e2b5['gatewaySettings'])return{'commission':0x0,'payoutDelay':0x0};try{const _0xe0124=JSON['parse'](_0x42e2b5[_0x2f309c(0x12d)]),_0x2eb79d=_0x305a19['charAt'](0x0)['toUpperCase']()+_0x305a19[_0x2f309c(0x12e)](0x1)[_0x2f309c(0x1a4)]();if(_0xe0124&&_0xe0124[_0x2eb79d])return{'commission':_0xe0124[_0x2eb79d]['commission']||0x0,'payoutDelay':_0xe0124[_0x2eb79d][_0x2f309c(0x14a)]||0x0};}catch(_0x310a74){console['error'](_0x2f309c(0x18b),_0x310a74);}return{'commission':0x0,'payoutDelay':0x0};}[a33_0x51f586(0x1a8)](_0x3d2ee7){const _0x31b43a=a33_0x51f586;if(_0x3d2ee7[_0x31b43a(0xff)]!==_0x31b43a(0x14f)||_0x3d2ee7[_0x31b43a(0x165)]||!_0x3d2ee7[_0x31b43a(0x143)])return![];const _0x5cd608=this['getGatewaySettings'](_0x3d2ee7[_0x31b43a(0x156)],_0x3d2ee7[_0x31b43a(0x1af)]),_0x33c157=_0x5cd608[_0x31b43a(0x14a)]*0x18*0x3c*0x3c*0x3e8,_0x5f0f99=new Date(_0x3d2ee7[_0x31b43a(0x143)][_0x31b43a(0x1a0)]()+_0x33c157);return new Date()>_0x5f0f99;}['calculateAmountAfterCommission'](_0x3b71c1,_0x2dc7a9){return _0x3b71c1*(0x1-_0x2dc7a9/0x64);}[a33_0x51f586(0x12c)](_0x2cdea0){const _0x31c226=a33_0x51f586;switch(_0x2cdea0[_0x31c226(0xff)]){case _0x31c226(0x14f):return _0x2cdea0['amount'];case _0x31c226(0x110):return-(_0x2cdea0[_0x31c226(0x136)]||0x0);case _0x31c226(0x12f):return 0x0;default:return 0x0;}}async[a33_0x51f586(0x141)](_0x9e3529){const _0x5c6d36=a33_0x51f586,{shopId:_0x55645d,amount:_0x230b00,network:_0x344aa6,notes:_0x2afaed}=_0x9e3529;console[_0x5c6d36(0x139)]('üí∏\x20Creating\x20payout\x20for\x20shop\x20'+_0x55645d+':\x20'+_0x230b00+_0x5c6d36(0x12b)+_0x344aa6);const _0x423bde=await database_1[_0x5c6d36(0x1b9)][_0x5c6d36(0x156)]['findUnique']({'where':{'id':_0x55645d},'select':{'id':!![],'name':!![],'username':!![],'status':!![]}});if(!_0x423bde)throw new Error('Shop\x20not\x20found');if(_0x423bde[_0x5c6d36(0xff)]!==_0x5c6d36(0x125))throw new Error('Shop\x20is\x20not\x20active');const _0x21bd7e=await database_1[_0x5c6d36(0x1b9)][_0x5c6d36(0x1bf)][_0x5c6d36(0x1ae)]({'data':{'shopId':_0x55645d,'amount':_0x230b00,'network':_0x344aa6,'status':'COMPLETED','notes':_0x2afaed||null,'paidAt':new Date()},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});await this[_0x5c6d36(0x19f)](_0x55645d,_0x230b00);try{await telegramBotService_1['telegramBotService']['sendPayoutNotification'](_0x55645d,_0x21bd7e,_0x5c6d36(0x1bc));}catch(_0x2be1ea){console[_0x5c6d36(0x109)](_0x5c6d36(0x1a9),_0x2be1ea);}return console[_0x5c6d36(0x139)]('‚úÖ\x20Payout\x20created\x20successfully:\x20'+_0x21bd7e['id']),{'id':_0x21bd7e['id'],'shopId':_0x21bd7e[_0x5c6d36(0x157)],'shopName':_0x21bd7e[_0x5c6d36(0x156)][_0x5c6d36(0x147)],'shopUsername':_0x21bd7e[_0x5c6d36(0x156)][_0x5c6d36(0x104)],'amount':_0x21bd7e[_0x5c6d36(0x144)],'network':_0x21bd7e[_0x5c6d36(0x107)],'status':_0x21bd7e[_0x5c6d36(0xff)],'txid':_0x21bd7e[_0x5c6d36(0x185)],'notes':_0x21bd7e[_0x5c6d36(0x133)],'createdAt':_0x21bd7e[_0x5c6d36(0x19e)],'paidAt':_0x21bd7e[_0x5c6d36(0x143)]};}async[a33_0x51f586(0x19f)](_0x25d557,_0x1155dc){const _0xa1a38a=a33_0x51f586;console[_0xa1a38a(0x139)](_0xa1a38a(0x167)+_0x25d557+_0xa1a38a(0x15e)+_0x1155dc+'\x20USDT');const _0x150611=await database_1[_0xa1a38a(0x1b9)]['payment'][_0xa1a38a(0x1c6)]({'where':{'shopId':_0x25d557,'status':_0xa1a38a(0x14f),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'shop':{'select':{'gatewaySettings':!![]}}},'orderBy':{'paidAt':_0xa1a38a(0x126)}});let _0x46303b=_0x1155dc;const _0x10bed7=[];for(const _0xb91375 of _0x150611){const _0x5d045a={..._0xb91375,'status':'PAID','merchantPaid':![],'shop':{'gatewaySettings':_0xb91375['shop'][_0xa1a38a(0x12d)]}};if(!this[_0xa1a38a(0x1a8)](_0x5d045a))continue;const _0x399f54=await currencyService_1[_0xa1a38a(0x188)][_0xa1a38a(0x138)](_0xb91375[_0xa1a38a(0x144)],_0xb91375['currency']),_0x14db35=this[_0xa1a38a(0x191)](_0xb91375[_0xa1a38a(0x156)],_0xb91375[_0xa1a38a(0x1af)]),_0x333a59=this[_0xa1a38a(0x149)](_0x399f54,_0x14db35[_0xa1a38a(0x1c4)]);if(_0x333a59<=_0x46303b){_0x10bed7[_0xa1a38a(0x100)](_0xb91375['id']),_0x46303b-=_0x333a59;if(_0x46303b<=0.01)break;}}_0x10bed7[_0xa1a38a(0x10b)]>0x0&&(await database_1[_0xa1a38a(0x1b9)]['payment'][_0xa1a38a(0x193)]({'where':{'id':{'in':_0x10bed7}},'data':{'merchantPaid':!![]}}),console[_0xa1a38a(0x139)]('‚úÖ\x20Marked\x20'+_0x10bed7[_0xa1a38a(0x10b)]+_0xa1a38a(0x1ba)));}async[a33_0x51f586(0xfb)](_0x51b19a){const _0x2fa96d=a33_0x51f586,{page:_0x52726a,limit:_0x2fbfe0,shopId:_0x49faf9,network:_0x48fcd7,dateFrom:_0x5d76dd,dateTo:_0x26bae2,search:_0x1f572b}=_0x51b19a,_0x4d99fd=(_0x52726a-0x1)*_0x2fbfe0;console[_0x2fa96d(0x139)]('üìã\x20Getting\x20payouts\x20with\x20filters:',_0x51b19a);const _0x235863={};_0x49faf9&&(_0x235863[_0x2fa96d(0x157)]=_0x49faf9);_0x48fcd7&&(_0x235863[_0x2fa96d(0x107)]=_0x48fcd7);(_0x5d76dd||_0x26bae2)&&(_0x235863[_0x2fa96d(0x19e)]={},_0x5d76dd&&(_0x235863[_0x2fa96d(0x19e)]['gte']=new Date(_0x5d76dd)),_0x26bae2&&(_0x235863[_0x2fa96d(0x19e)][_0x2fa96d(0x150)]=new Date(_0x26bae2)));_0x1f572b&&(_0x235863['OR']=[{'txid':{'contains':_0x1f572b,'mode':_0x2fa96d(0x1b1)}},{'notes':{'contains':_0x1f572b,'mode':_0x2fa96d(0x1b1)}},{'shop':{'name':{'contains':_0x1f572b,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x1f572b,'mode':_0x2fa96d(0x1b1)}}}]);const [_0x24d16b,_0x4836b5]=await Promise[_0x2fa96d(0x13d)]([database_1[_0x2fa96d(0x1b9)]['payout'][_0x2fa96d(0x1c6)]({'where':_0x235863,'skip':_0x4d99fd,'take':_0x2fbfe0,'orderBy':{'createdAt':_0x2fa96d(0x10c)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1[_0x2fa96d(0x1b9)][_0x2fa96d(0x1bf)][_0x2fa96d(0x162)]({'where':_0x235863})]);console[_0x2fa96d(0x139)](_0x2fa96d(0x119)+_0x24d16b[_0x2fa96d(0x10b)]+'\x20payouts\x20out\x20of\x20'+_0x4836b5+_0x2fa96d(0x11f));const _0x17c90b=_0x24d16b[_0x2fa96d(0x17b)](_0x6d5531=>({'id':_0x6d5531['id'],'shopId':_0x6d5531[_0x2fa96d(0x157)],'shopName':_0x6d5531['shop']['name'],'shopUsername':_0x6d5531[_0x2fa96d(0x156)][_0x2fa96d(0x104)],'amount':_0x6d5531['amount'],'network':_0x6d5531['network'],'status':_0x6d5531[_0x2fa96d(0xff)],'txid':_0x6d5531[_0x2fa96d(0x185)],'notes':_0x6d5531[_0x2fa96d(0x133)],'createdAt':_0x6d5531[_0x2fa96d(0x19e)],'paidAt':_0x6d5531['paidAt']}));return{'payouts':_0x17c90b,'pagination':{'page':_0x52726a,'limit':_0x2fbfe0,'total':_0x4836b5,'totalPages':Math[_0x2fa96d(0x112)](_0x4836b5/_0x2fbfe0)}};}async[a33_0x51f586(0x146)](_0xe0cb18){const _0x55c76b=a33_0x51f586;console[_0x55c76b(0x139)](_0x55c76b(0x17c)+_0xe0cb18);const _0x50e6ce=await database_1[_0x55c76b(0x1b9)][_0x55c76b(0x1bf)][_0x55c76b(0x1ac)]({'where':{'id':_0xe0cb18},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x50e6ce)return console[_0x55c76b(0x139)]('‚ùå\x20Payout\x20not\x20found:\x20'+_0xe0cb18),null;return console[_0x55c76b(0x139)](_0x55c76b(0x14e)+_0x50e6ce['amount']+_0x55c76b(0x12b)+_0x50e6ce['network']),{'id':_0x50e6ce['id'],'shopId':_0x50e6ce[_0x55c76b(0x157)],'shopName':_0x50e6ce[_0x55c76b(0x156)][_0x55c76b(0x147)],'shopUsername':_0x50e6ce[_0x55c76b(0x156)]['username'],'amount':_0x50e6ce['amount'],'network':_0x50e6ce[_0x55c76b(0x107)],'status':_0x50e6ce['status'],'txid':_0x50e6ce[_0x55c76b(0x185)],'notes':_0x50e6ce[_0x55c76b(0x133)],'createdAt':_0x50e6ce['createdAt'],'paidAt':_0x50e6ce[_0x55c76b(0x143)]};}async[a33_0x51f586(0x148)](_0x2ee1fe){const _0x1bd567=a33_0x51f586;console[_0x1bd567(0x139)]('üóëÔ∏è\x20Deleting\x20payout:\x20'+_0x2ee1fe);const _0x309f78=await database_1[_0x1bd567(0x1b9)][_0x1bd567(0x1bf)][_0x1bd567(0x1ac)]({'where':{'id':_0x2ee1fe},'select':{'id':!![],'shopId':!![],'amount':!![]}});if(!_0x309f78)throw new Error(_0x1bd567(0x175));await database_1['default'][_0x1bd567(0x1bf)][_0x1bd567(0x13e)]({'where':{'id':_0x2ee1fe}}),console[_0x1bd567(0x139)]('‚úÖ\x20Payout\x20'+_0x2ee1fe+_0x1bd567(0x1b8));}async[a33_0x51f586(0x1ad)](_0x5db040){const _0x2b9ee1=a33_0x51f586,{page:_0x329c84,limit:_0x53ce28,minAmount:_0x9f7276,search:_0x495800}=_0x5db040;console[_0x2b9ee1(0x139)](_0x2b9ee1(0x15f),_0x5db040);const _0x274c73=await database_1[_0x2b9ee1(0x1b9)]['payment']['findMany']({'where':{'status':_0x2b9ee1(0x14f),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'createdAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'gatewaySettings':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}});console[_0x2b9ee1(0x139)](_0x2b9ee1(0x140)+_0x274c73['length']+_0x2b9ee1(0x179));const _0xe1884d=new Map();for(const _0x2cd152 of _0x274c73){const _0x20b37d={..._0x2cd152,'status':_0x2b9ee1(0x14f),'merchantPaid':![],'shop':{'gatewaySettings':_0x2cd152[_0x2b9ee1(0x156)][_0x2b9ee1(0x12d)]}},_0x91803=this[_0x2b9ee1(0x1a8)](_0x20b37d);if(!_0x91803)continue;const _0x1d7765=await currencyService_1[_0x2b9ee1(0x188)]['convertToUSDT'](_0x2cd152[_0x2b9ee1(0x144)],_0x2cd152[_0x2b9ee1(0x13a)]),_0x4a58f6=this[_0x2b9ee1(0x191)](_0x2cd152[_0x2b9ee1(0x156)],_0x2cd152['gateway']),_0x1fadef=this['calculateAmountAfterCommission'](_0x1d7765,_0x4a58f6[_0x2b9ee1(0x1c4)]),_0x5d0f46=_0x2cd152['shopId'];!_0xe1884d[_0x2b9ee1(0x161)](_0x5d0f46)&&_0xe1884d[_0x2b9ee1(0x1a2)](_0x5d0f46,{'shop':_0x2cd152[_0x2b9ee1(0x156)],'payments':[]}),_0xe1884d[_0x2b9ee1(0x189)](_0x5d0f46)[_0x2b9ee1(0x194)]['push']({'id':_0x2cd152['id'],'amount':_0x2cd152['amount'],'currency':_0x2cd152[_0x2b9ee1(0x13a)],'gateway':_0x2cd152['gateway'],'paidAt':_0x2cd152['paidAt'],'createdAt':_0x2cd152[_0x2b9ee1(0x19e)],'amountUSDT':_0x1d7765,'commission':_0x4a58f6[_0x2b9ee1(0x1c4)],'amountAfterCommissionUSDT':_0x1fadef,'isEligible':!![]});}console[_0x2b9ee1(0x139)](_0x2b9ee1(0x152)+_0xe1884d[_0x2b9ee1(0x11a)]+_0x2b9ee1(0x128));const _0x16aba2=[];for(const [_0x42344e,_0x317f4d]of _0xe1884d){const {shop:_0x3842b4,payments:_0x5aab85}=_0x317f4d,_0x377ae9=_0x5aab85['reduce']((_0x2525eb,_0x4193c9)=>_0x2525eb+_0x4193c9['amountUSDT'],0x0),_0x8feca2=_0x5aab85[_0x2b9ee1(0x1b5)]((_0x2bf0df,_0x492794)=>_0x2bf0df+_0x492794[_0x2b9ee1(0x13b)],0x0);if(_0x9f7276&&_0x8feca2<_0x9f7276)continue;if(_0x495800){const _0x1a4ae9=_0x495800[_0x2b9ee1(0x1a4)](),_0x2c493f=_0x3842b4[_0x2b9ee1(0x147)][_0x2b9ee1(0x1a4)]()['includes'](_0x1a4ae9)||_0x3842b4[_0x2b9ee1(0x104)][_0x2b9ee1(0x1a4)]()[_0x2b9ee1(0x166)](_0x1a4ae9)||_0x3842b4[_0x2b9ee1(0x145)]&&_0x3842b4[_0x2b9ee1(0x145)][_0x2b9ee1(0x1a4)]()[_0x2b9ee1(0x166)](_0x1a4ae9);if(!_0x2c493f)continue;}const _0x39223b=new Map();for(const _0x31af67 of _0x5aab85){const _0x24e601=_0x31af67['gateway'];!_0x39223b['has'](_0x24e601)&&_0x39223b[_0x2b9ee1(0x1a2)](_0x24e601,{'count':0x0,'amountUSDT':0x0,'amountAfterCommissionUSDT':0x0,'commission':_0x31af67[_0x2b9ee1(0x1c4)]});const _0x2d7e0a=_0x39223b[_0x2b9ee1(0x189)](_0x24e601);_0x2d7e0a[_0x2b9ee1(0x162)]++,_0x2d7e0a[_0x2b9ee1(0x12a)]+=_0x31af67[_0x2b9ee1(0x12a)],_0x2d7e0a['amountAfterCommissionUSDT']+=_0x31af67[_0x2b9ee1(0x13b)];}const _0xe25fd9=Array['from'](_0x39223b['entries']())[_0x2b9ee1(0x17b)](([_0x1ff6a6,_0x26646f])=>({'gateway':_0x1ff6a6['charAt'](0x0)[_0x2b9ee1(0x151)]()+_0x1ff6a6[_0x2b9ee1(0x12e)](0x1),'count':_0x26646f[_0x2b9ee1(0x162)],'amountUSDT':Math[_0x2b9ee1(0x1c5)](_0x26646f[_0x2b9ee1(0x12a)]*0x64)/0x64,'amountAfterCommissionUSDT':Math['round'](_0x26646f['amountAfterCommissionUSDT']*0x64)/0x64,'commission':_0x26646f[_0x2b9ee1(0x1c4)]})),_0x2b8d47=_0x5aab85[_0x2b9ee1(0x1b5)]((_0x381900,_0x2d8a48)=>{const _0xbe1502=_0x2b9ee1;return _0x2d8a48[_0xbe1502(0x143)]<_0x381900?_0x2d8a48[_0xbe1502(0x143)]:_0x381900;},_0x5aab85[0x0][_0x2b9ee1(0x143)]);_0x16aba2['push']({'id':_0x3842b4['id'],'fullName':_0x3842b4['name'],'username':_0x3842b4[_0x2b9ee1(0x104)],'telegramId':_0x3842b4[_0x2b9ee1(0x145)],'merchantUrl':_0x3842b4['shopUrl'],'wallets':{'usdtPolygonWallet':_0x3842b4[_0x2b9ee1(0x178)],'usdtTrcWallet':_0x3842b4[_0x2b9ee1(0x137)],'usdtErcWallet':_0x3842b4['usdtErcWallet'],'usdcPolygonWallet':_0x3842b4['usdcPolygonWallet']},'totalAmountUSDT':Math['round'](_0x377ae9*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x2b9ee1(0x1c5)](_0x8feca2*0x64)/0x64,'paymentsCount':_0x5aab85[_0x2b9ee1(0x10b)],'oldestPaymentDate':_0x2b8d47,'gatewayBreakdown':_0xe25fd9});}_0x16aba2[_0x2b9ee1(0x16f)]((_0x3a1874,_0x2b766c)=>_0x2b766c['totalAmountAfterCommissionUSDT']-_0x3a1874[_0x2b9ee1(0x1a6)]);const _0x2e3187=_0x16aba2['length'],_0x547293=_0x16aba2[_0x2b9ee1(0x1b5)]((_0x4ce618,_0x9cf5f9)=>_0x4ce618+_0x9cf5f9[_0x2b9ee1(0x159)],0x0),_0x1e32ac=_0x16aba2[_0x2b9ee1(0x1b5)]((_0x22d4ce,_0x4e9d23)=>_0x22d4ce+_0x4e9d23['totalAmountAfterCommissionUSDT'],0x0),_0x107d56=(_0x329c84-0x1)*_0x53ce28,_0x558939=_0x16aba2[_0x2b9ee1(0x12e)](_0x107d56,_0x107d56+_0x53ce28);return console[_0x2b9ee1(0x139)](_0x2b9ee1(0x19d)+_0x558939['length']+_0x2b9ee1(0x131)+_0x2e3187+_0x2b9ee1(0x11f)),console[_0x2b9ee1(0x139)](_0x2b9ee1(0x15b)+_0x547293['toFixed'](0x2)+_0x2b9ee1(0x1c2)+_0x1e32ac['toFixed'](0x2)+_0x2b9ee1(0x181)),{'merchants':_0x558939,'pagination':{'page':_0x329c84,'limit':_0x53ce28,'total':_0x2e3187,'totalPages':Math[_0x2b9ee1(0x112)](_0x2e3187/_0x53ce28)},'summary':{'totalMerchants':_0x2e3187,'totalAmountUSDT':Math['round'](_0x547293*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x2b9ee1(0x1c5)](_0x1e32ac*0x64)/0x64}};}async[a33_0x51f586(0xf7)](){const _0x289d7d=a33_0x51f586;console[_0x289d7d(0x139)]('üìä\x20Calculating\x20admin\x20payout\x20statistics...');const _0x3b53fd=await database_1[_0x289d7d(0x1b9)][_0x289d7d(0x16d)][_0x289d7d(0x1c6)]({'where':{'status':{'in':[_0x289d7d(0x14f),_0x289d7d(0x12f),_0x289d7d(0x110)]}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'status':!![],'gateway':!![],'paidAt':!![],'merchantPaid':!![],'createdAt':!![],'chargebackAmount':!![],'shop':{'select':{'gatewaySettings':!![]}}}});console[_0x289d7d(0x139)](_0x289d7d(0x140)+_0x3b53fd['length']+_0x289d7d(0x1b6));const _0x575aea=new Date(),_0x15b80b=new Date(_0x575aea[_0x289d7d(0x163)](),_0x575aea[_0x289d7d(0x120)](),0x1),_0x370fdf=new Date(_0x575aea[_0x289d7d(0x163)](),_0x575aea['getMonth']()+0x1,0x0,0x17,0x3b,0x3b,0x3e7);let _0x1829a5=0x0,_0x8a5a03=0x0,_0x5ebb24=0x0,_0x38eadf=0x0;for(const _0x1a63d8 of _0x3b53fd){const _0x168dd4=this[_0x289d7d(0x12c)](_0x1a63d8);if(_0x168dd4===0x0)continue;let _0x5f0837,_0x30be2c;if(_0x1a63d8[_0x289d7d(0xff)]===_0x289d7d(0x110))_0x5f0837=Math['abs'](_0x168dd4),_0x30be2c=-_0x5f0837;else{_0x5f0837=await currencyService_1[_0x289d7d(0x188)][_0x289d7d(0x138)](_0x1a63d8['amount'],_0x1a63d8[_0x289d7d(0x13a)]);const _0x5148f9=this[_0x289d7d(0x191)](_0x1a63d8[_0x289d7d(0x156)],_0x1a63d8[_0x289d7d(0x1af)]);_0x30be2c=this[_0x289d7d(0x149)](_0x5f0837,_0x5148f9[_0x289d7d(0x1c4)]);}_0x1a63d8[_0x289d7d(0x165)]&&(_0x1829a5+=_0x30be2c,_0x1a63d8['paidAt']&&_0x1a63d8[_0x289d7d(0x143)]>=_0x15b80b&&_0x1a63d8[_0x289d7d(0x143)]<=_0x370fdf&&(_0x5ebb24+=_0x30be2c)),_0x1a63d8['status']===_0x289d7d(0x14f)&&this[_0x289d7d(0x1a8)](_0x1a63d8)&&(_0x8a5a03+=_0x30be2c,_0x38eadf+=_0x5f0837);}const _0x26021e={'totalPayout':Math[_0x289d7d(0x1c5)](_0x1829a5*0x64)/0x64,'awaitingPayout':Math['round'](_0x8a5a03*0x64)/0x64,'thisMonth':Math[_0x289d7d(0x1c5)](_0x5ebb24*0x64)/0x64,'availableBalance':Math[_0x289d7d(0x1c5)](_0x38eadf*0x64)/0x64};return console[_0x289d7d(0x139)](_0x289d7d(0x114)),console[_0x289d7d(0x139)](_0x289d7d(0x169)+_0x26021e[_0x289d7d(0x1a1)]+_0x289d7d(0x177)),console[_0x289d7d(0x139)]('‚è≥\x20Awaiting\x20Payout:\x20'+_0x26021e[_0x289d7d(0x1aa)]+_0x289d7d(0x16a)),console[_0x289d7d(0x139)]('üìÖ\x20This\x20Month:\x20'+_0x26021e['thisMonth']+_0x289d7d(0xfc)),console[_0x289d7d(0x139)](_0x289d7d(0x197)+_0x26021e[_0x289d7d(0xf8)]+_0x289d7d(0xfc)),_0x26021e;}async[a33_0x51f586(0x15a)](_0x5bb352){const _0x467570=a33_0x51f586,_0x48ccef=this['getPeriodDays'](_0x5bb352),_0x3061f7=new Date();_0x3061f7[_0x467570(0x101)](_0x3061f7[_0x467570(0x132)]()-_0x48ccef),console['log'](_0x467570(0x160)+_0x5bb352+'\x20('+_0x48ccef+_0x467570(0x17e));const _0x1e8835=await database_1[_0x467570(0x1b9)][_0x467570(0x156)][_0x467570(0x162)]({'where':{'status':_0x467570(0x125)}}),_0x533843=await database_1[_0x467570(0x1b9)]['payment'][_0x467570(0x162)](),_0x445de5=await database_1[_0x467570(0x1b9)][_0x467570(0x16d)][_0x467570(0x1c6)]({'where':{'status':{'in':[_0x467570(0x14f),'REFUND',_0x467570(0x110)]}},'select':{'amount':!![],'currency':!![],'status':!![],'chargebackAmount':!![],'createdAt':!![]}});console[_0x467570(0x139)](_0x467570(0x140)+_0x445de5[_0x467570(0x10b)]+'\x20payments\x20for\x20revenue\x20calculation\x20(PAID/REFUND/CHARGEBACK)');const _0x3f0947=await Promise[_0x467570(0x13d)](_0x445de5[_0x467570(0x17b)](async _0x52797c=>{const _0x4cb008=_0x467570,_0x26cf0b=this[_0x4cb008(0x12c)](_0x52797c);if(_0x26cf0b===0x0)return{'amount':0x0,'createdAt':_0x52797c['createdAt']};let _0x465e94;return _0x52797c[_0x4cb008(0xff)]===_0x4cb008(0x110)?_0x465e94=-Math[_0x4cb008(0x10a)](_0x26cf0b):_0x465e94=await currencyService_1['currencyService']['convertToUSDT'](_0x52797c[_0x4cb008(0x144)],_0x52797c['currency']),{'amount':_0x465e94,'createdAt':_0x52797c[_0x4cb008(0x19e)]};})),_0x555c60=_0x3f0947['reduce']((_0x3991cf,_0x11f29c)=>_0x3991cf+_0x11f29c[_0x467570(0x144)],0x0),_0x4eb119=_0x533843>0x0?_0x555c60/_0x533843:0x0;console[_0x467570(0x139)](_0x467570(0x1be)+_0x555c60[_0x467570(0x172)](0x2)+_0x467570(0x177)),console[_0x467570(0x139)](_0x467570(0x182)+_0x4eb119['toFixed'](0x2)+'\x20USDT');const _0x293aae=await database_1[_0x467570(0x1b9)][_0x467570(0x18c)]`
      SELECT 
        DATE(created_at) as date,
        array_agg(
          json_build_object(
            'amount', amount,
            'currency', currency,
            'status', status,
            'chargeback_amount', chargeback_amount
          )
        ) as payments
      FROM payments 
      WHERE created_at >= ${_0x3061f7}
        AND status IN ('PAID', 'REFUND', 'CHARGEBACK')
      GROUP BY DATE(created_at)
      ORDER BY date ASC
    `;console['log'](_0x467570(0x1c0)+_0x293aae[_0x467570(0x10b)]+_0x467570(0x13f));const _0x5ad6be=await Promise['all'](_0x293aae[_0x467570(0x17b)](async _0x4988a3=>{const _0x42c5ee=_0x467570,_0x33a0f3=await Promise[_0x42c5ee(0x13d)](_0x4988a3[_0x42c5ee(0x194)]['map'](async _0x30c2c4=>{const _0x494fc4=_0x42c5ee,_0x3cc907=this[_0x494fc4(0x12c)](_0x30c2c4);if(_0x3cc907===0x0)return 0x0;return _0x30c2c4[_0x494fc4(0xff)]===_0x494fc4(0x110)?-Math[_0x494fc4(0x10a)](_0x3cc907):await currencyService_1[_0x494fc4(0x188)]['convertToUSDT'](_0x30c2c4[_0x494fc4(0x144)],_0x30c2c4[_0x494fc4(0x13a)]);})),_0x2ed77b=_0x33a0f3[_0x42c5ee(0x1b5)]((_0x27db95,_0x4676b3)=>_0x27db95+_0x4676b3,0x0);return{'date':_0x4988a3[_0x42c5ee(0x196)][_0x42c5ee(0x173)]()[_0x42c5ee(0x14c)]('T')[0x0],'amount':_0x2ed77b};})),_0x34ffd0=this[_0x467570(0x14b)](_0x3061f7,new Date()),_0x3a477b=new Map(_0x5ad6be[_0x467570(0x17b)](_0xa2a5ee=>[_0xa2a5ee[_0x467570(0x196)],_0xa2a5ee[_0x467570(0x144)]])),_0x4b35c0=_0x34ffd0[_0x467570(0x17b)](_0x25a786=>({'date':_0x25a786,'amount':_0x3a477b[_0x467570(0x189)](_0x25a786)||0x0}));return console[_0x467570(0x139)]('‚úÖ\x20Admin\x20statistics\x20generated\x20successfully'),console[_0x467570(0x139)]('üë•\x20Total\x20users:\x20'+_0x1e8835),console[_0x467570(0x139)](_0x467570(0x1c7)+_0x533843),console[_0x467570(0x139)]('üìä\x20Daily\x20revenue\x20entries:\x20'+_0x4b35c0['length']),{'totalRevenue':Math[_0x467570(0x1c5)](_0x555c60*0x64)/0x64,'totalUsers':_0x1e8835,'totalPayments':_0x533843,'averagePayment':Math[_0x467570(0x1c5)](_0x4eb119*0x64)/0x64,'dailyRevenue':_0x4b35c0};}async[a33_0x51f586(0x1a5)](_0x370feb){const _0x48ce5f=a33_0x51f586,{page:_0x58a821,limit:_0x3902ed,status:_0x510ad5,gateway:_0x52ef33,shopId:_0x408d95,dateFrom:_0x5f44f2,dateTo:_0xfeba07,search:_0x423cdd}=_0x370feb,_0xa35a6b=(_0x58a821-0x1)*_0x3902ed;console[_0x48ce5f(0x139)](_0x48ce5f(0x106),_0x370feb);const _0x381551={};_0x510ad5&&(_0x381551[_0x48ce5f(0xff)]=_0x510ad5['toUpperCase']());if(_0x52ef33){if((0x0,gateway_1[_0x48ce5f(0xf3)])(_0x52ef33)){const _0x5bb016=(0x0,gateway_1[_0x48ce5f(0x122)])(_0x52ef33);_0x5bb016&&(_0x381551[_0x48ce5f(0x1af)]=_0x5bb016);}else _0x381551['gateway']=_0x52ef33['toLowerCase']();}_0x408d95&&(_0x381551[_0x48ce5f(0x157)]=_0x408d95);(_0x5f44f2||_0xfeba07)&&(_0x381551[_0x48ce5f(0x19e)]={},_0x5f44f2&&(_0x381551[_0x48ce5f(0x19e)][_0x48ce5f(0x1b2)]=new Date(_0x5f44f2)),_0xfeba07&&(_0x381551[_0x48ce5f(0x19e)][_0x48ce5f(0x150)]=new Date(_0xfeba07)));_0x423cdd&&(_0x381551['OR']=[{'orderId':{'contains':_0x423cdd,'mode':_0x48ce5f(0x1b1)}},{'gatewayOrderId':{'contains':_0x423cdd,'mode':_0x48ce5f(0x1b1)}},{'gatewayPaymentId':{'contains':_0x423cdd,'mode':_0x48ce5f(0x1b1)}},{'customerEmail':{'contains':_0x423cdd,'mode':_0x48ce5f(0x1b1)}},{'customerName':{'contains':_0x423cdd,'mode':_0x48ce5f(0x1b1)}},{'shop':{'name':{'contains':_0x423cdd,'mode':_0x48ce5f(0x1b1)}}},{'shop':{'username':{'contains':_0x423cdd,'mode':'insensitive'}}}]);const [_0x4c4bad,_0x289926]=await Promise[_0x48ce5f(0x13d)]([database_1[_0x48ce5f(0x1b9)][_0x48ce5f(0x16d)][_0x48ce5f(0x1c6)]({'where':_0x381551,'skip':_0xa35a6b,'take':_0x3902ed,'orderBy':{'createdAt':_0x48ce5f(0x10c)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1[_0x48ce5f(0x1b9)][_0x48ce5f(0x16d)][_0x48ce5f(0x162)]({'where':_0x381551})]);console[_0x48ce5f(0x139)](_0x48ce5f(0x119)+_0x4c4bad[_0x48ce5f(0x10b)]+_0x48ce5f(0x105)+_0x289926+_0x48ce5f(0x11f));const _0x3f4817=_0x4c4bad[_0x48ce5f(0x17b)](_0x194400=>({'id':_0x194400['id'],'shopId':_0x194400[_0x48ce5f(0x157)],'shopName':_0x194400['shop'][_0x48ce5f(0x147)],'shopUsername':_0x194400[_0x48ce5f(0x156)]['username'],'gateway':_0x194400[_0x48ce5f(0x1af)],'orderId':_0x194400[_0x48ce5f(0x16c)],'gatewayOrderId':_0x194400[_0x48ce5f(0x19a)],'amount':_0x194400[_0x48ce5f(0x144)],'currency':_0x194400[_0x48ce5f(0x13a)],'sourceCurrency':_0x194400[_0x48ce5f(0x187)],'status':_0x194400['status'],'usage':_0x194400['usage'],'externalPaymentUrl':_0x194400['externalPaymentUrl'],'gatewayPaymentId':_0x194400['gatewayPaymentId'],'customerEmail':_0x194400[_0x48ce5f(0x19c)],'customerName':_0x194400[_0x48ce5f(0x127)],'cardLast4':_0x194400[_0x48ce5f(0x16b)],'paymentMethod':_0x194400['paymentMethod'],'bankId':_0x194400[_0x48ce5f(0x15c)],'remitterIban':_0x194400[_0x48ce5f(0x108)],'remitterName':_0x194400[_0x48ce5f(0xfa)],'chargebackAmount':_0x194400['chargebackAmount'],'adminNotes':_0x194400[_0x48ce5f(0x10e)],'statusChangedBy':_0x194400[_0x48ce5f(0xfd)],'statusChangedAt':_0x194400['statusChangedAt'],'createdAt':_0x194400['createdAt'],'updatedAt':_0x194400[_0x48ce5f(0x10d)],'expiresAt':_0x194400[_0x48ce5f(0x158)]}));return{'payments':_0x3f4817,'pagination':{'page':_0x58a821,'limit':_0x3902ed,'total':_0x289926,'totalPages':Math[_0x48ce5f(0x112)](_0x289926/_0x3902ed)}};}async[a33_0x51f586(0xf6)](_0x358e10){const _0x1fabd6=a33_0x51f586;console['log'](_0x1fabd6(0x118)+_0x358e10);const _0x2b52be=await database_1[_0x1fabd6(0x1b9)][_0x1fabd6(0x16d)][_0x1fabd6(0x1ac)]({'where':{'id':_0x358e10},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}},'webhookLogs':{'orderBy':{'createdAt':'desc'},'take':0xa,'select':{'id':!![],'event':!![],'statusCode':!![],'retryCount':!![],'createdAt':!![]}}}});if(!_0x2b52be)return console['log'](_0x1fabd6(0x130)+_0x358e10),null;return console['log'](_0x1fabd6(0x195)+_0x2b52be[_0x1fabd6(0x16c)]+'\x20('+_0x2b52be['status']+')'),{'id':_0x2b52be['id'],'shopId':_0x2b52be[_0x1fabd6(0x157)],'shopName':_0x2b52be['shop'][_0x1fabd6(0x147)],'shopUsername':_0x2b52be['shop'][_0x1fabd6(0x104)],'gateway':_0x2b52be[_0x1fabd6(0x1af)],'orderId':_0x2b52be[_0x1fabd6(0x16c)],'gatewayOrderId':_0x2b52be[_0x1fabd6(0x19a)],'amount':_0x2b52be[_0x1fabd6(0x144)],'currency':_0x2b52be[_0x1fabd6(0x13a)],'sourceCurrency':_0x2b52be['sourceCurrency'],'status':_0x2b52be[_0x1fabd6(0xff)],'usage':_0x2b52be['usage'],'externalPaymentUrl':_0x2b52be[_0x1fabd6(0x174)],'gatewayPaymentId':_0x2b52be['gatewayPaymentId'],'customerEmail':_0x2b52be[_0x1fabd6(0x19c)],'customerName':_0x2b52be[_0x1fabd6(0x127)],'cardLast4':_0x2b52be[_0x1fabd6(0x16b)],'paymentMethod':_0x2b52be['paymentMethod'],'bankId':_0x2b52be[_0x1fabd6(0x15c)],'remitterIban':_0x2b52be['remitterIban'],'remitterName':_0x2b52be['remitterName'],'chargebackAmount':_0x2b52be[_0x1fabd6(0x136)],'adminNotes':_0x2b52be['adminNotes'],'statusChangedBy':_0x2b52be[_0x1fabd6(0xfd)],'statusChangedAt':_0x2b52be['statusChangedAt'],'createdAt':_0x2b52be['createdAt'],'updatedAt':_0x2b52be['updatedAt'],'expiresAt':_0x2b52be[_0x1fabd6(0x158)],'webhookLogs':_0x2b52be[_0x1fabd6(0x190)]};}async[a33_0x51f586(0x1b3)](_0x45b3dc,_0x13787d,_0x469d81,_0x3d315e){const _0x13f81b=a33_0x51f586;console[_0x13f81b(0x139)](_0x13f81b(0x115)+_0x45b3dc+_0x13f81b(0x198)+_0x13787d);const _0x414225=[_0x13f81b(0x1a7),_0x13f81b(0x14f),_0x13f81b(0x142),'FAILED',_0x13f81b(0x12f),_0x13f81b(0x110)];if(!_0x414225[_0x13f81b(0x166)](_0x13787d[_0x13f81b(0x151)]()))throw new Error(_0x13f81b(0x13c)+_0x414225['join'](',\x20'));const _0x3841e1=await database_1['default'][_0x13f81b(0x16d)][_0x13f81b(0x1ac)]({'where':{'id':_0x45b3dc},'select':{'id':!![],'status':!![],'orderId':!![]}});if(!_0x3841e1)throw new Error(_0x13f81b(0x113));if(_0x13787d['toUpperCase']()===_0x13f81b(0x110)){if(!_0x3d315e||_0x3d315e<=0x0)throw new Error(_0x13f81b(0x11c));console['log']('üí∏\x20Chargeback\x20amount:\x20'+_0x3d315e+_0x13f81b(0xfe));}const _0x3d0918={'status':_0x13787d[_0x13f81b(0x151)](),'updatedAt':new Date(),'statusChangedBy':_0x13f81b(0x1b7),'statusChangedAt':new Date()};_0x469d81&&(_0x3d0918[_0x13f81b(0x10e)]=_0x469d81);_0x13787d['toUpperCase']()===_0x13f81b(0x110)&&_0x3d315e&&(_0x3d0918['chargebackAmount']=_0x3d315e);const _0x4256af=await database_1[_0x13f81b(0x1b9)][_0x13f81b(0x16d)][_0x13f81b(0x180)]({'where':{'id':_0x45b3dc},'data':_0x3d0918,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});return await database_1[_0x13f81b(0x1b9)][_0x13f81b(0x18f)]['create']({'data':{'paymentId':_0x45b3dc,'shopId':_0x4256af[_0x13f81b(0x157)],'event':_0x13f81b(0x19b),'statusCode':0xc8,'responseBody':JSON[_0x13f81b(0x1bb)]({'oldStatus':_0x3841e1[_0x13f81b(0xff)],'newStatus':_0x13787d[_0x13f81b(0x151)](),'notes':_0x469d81||null,'chargebackAmount':_0x3d315e||null,'updatedBy':_0x13f81b(0x1b7),'timestamp':new Date()['toISOString']()})}}),console[_0x13f81b(0x139)](_0x13f81b(0x116)+_0x3841e1['orderId']+_0x13f81b(0x11e)+_0x3841e1['status']+'\x20to\x20'+_0x13787d['toUpperCase']()),_0x13787d[_0x13f81b(0x151)]()===_0x13f81b(0x110)&&console[_0x13f81b(0x139)](_0x13f81b(0x1a3)+_0x3d315e+_0x13f81b(0x18d)),{'id':_0x4256af['id'],'shopId':_0x4256af[_0x13f81b(0x157)],'shopName':_0x4256af['shop']['name'],'shopUsername':_0x4256af['shop'][_0x13f81b(0x104)],'gateway':_0x4256af[_0x13f81b(0x1af)],'orderId':_0x4256af[_0x13f81b(0x16c)],'gatewayOrderId':_0x4256af[_0x13f81b(0x19a)],'amount':_0x4256af[_0x13f81b(0x144)],'currency':_0x4256af[_0x13f81b(0x13a)],'sourceCurrency':_0x4256af[_0x13f81b(0x187)],'status':_0x4256af[_0x13f81b(0xff)],'usage':_0x4256af['usage'],'externalPaymentUrl':_0x4256af['externalPaymentUrl'],'gatewayPaymentId':_0x4256af[_0x13f81b(0xf4)],'customerEmail':_0x4256af[_0x13f81b(0x19c)],'customerName':_0x4256af[_0x13f81b(0x127)],'cardLast4':_0x4256af[_0x13f81b(0x16b)],'paymentMethod':_0x4256af['paymentMethod'],'bankId':_0x4256af[_0x13f81b(0x15c)],'remitterIban':_0x4256af[_0x13f81b(0x108)],'remitterName':_0x4256af[_0x13f81b(0xfa)],'chargebackAmount':_0x4256af[_0x13f81b(0x136)],'adminNotes':_0x4256af[_0x13f81b(0x10e)],'statusChangedBy':_0x4256af[_0x13f81b(0xfd)],'statusChangedAt':_0x4256af[_0x13f81b(0x186)],'createdAt':_0x4256af['createdAt'],'updatedAt':_0x4256af[_0x13f81b(0x10d)],'expiresAt':_0x4256af[_0x13f81b(0x158)]};}async[a33_0x51f586(0x121)](_0x2fd206){const _0x1890ca=a33_0x51f586,{page:_0x4ec3f8,limit:_0x5e7896,status:_0x42c4fb}=_0x2fd206,_0x201a20=(_0x4ec3f8-0x1)*_0x5e7896,_0x1b97a9={};_0x42c4fb&&(_0x1b97a9[_0x1890ca(0xff)]=_0x42c4fb[_0x1890ca(0x151)]());console[_0x1890ca(0x139)](_0x1890ca(0x1c3),{'page':_0x4ec3f8,'limit':_0x5e7896,'status':_0x42c4fb,'where':_0x1b97a9});const [_0x2a7d62,_0xa7eb1b]=await Promise[_0x1890ca(0x13d)]([database_1[_0x1890ca(0x1b9)][_0x1890ca(0x156)]['findMany']({'where':_0x1b97a9,'skip':_0x201a20,'take':_0x5e7896,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x1890ca(0x10c)}}),database_1[_0x1890ca(0x1b9)][_0x1890ca(0x156)][_0x1890ca(0x162)]({'where':_0x1b97a9})]);console['log']('üìä\x20Found\x20'+_0x2a7d62['length']+'\x20users\x20out\x20of\x20'+_0xa7eb1b+_0x1890ca(0x11f));const _0x4a870a=_0x2a7d62[_0x1890ca(0x17b)](_0x5a9c5b=>({'id':_0x5a9c5b['id'],'fullName':_0x5a9c5b[_0x1890ca(0x147)],'username':_0x5a9c5b[_0x1890ca(0x104)],'telegramId':_0x5a9c5b[_0x1890ca(0x145)],'merchantUrl':_0x5a9c5b['shopUrl'],'gateways':_0x5a9c5b[_0x1890ca(0x1ab)]?JSON['parse'](_0x5a9c5b[_0x1890ca(0x1ab)]):null,'gatewaySettings':_0x5a9c5b[_0x1890ca(0x12d)]?JSON[_0x1890ca(0x192)](_0x5a9c5b[_0x1890ca(0x12d)]):null,'publicKey':_0x5a9c5b[_0x1890ca(0x154)],'wallets':{'usdtPolygonWallet':_0x5a9c5b['usdtPolygonWallet'],'usdtTrcWallet':_0x5a9c5b[_0x1890ca(0x137)],'usdtErcWallet':_0x5a9c5b['usdtErcWallet'],'usdcPolygonWallet':_0x5a9c5b[_0x1890ca(0x155)]},'status':_0x5a9c5b[_0x1890ca(0xff)],'createdAt':_0x5a9c5b[_0x1890ca(0x19e)]}));return{'users':_0x4a870a,'pagination':{'page':_0x4ec3f8,'limit':_0x5e7896,'total':_0xa7eb1b,'totalPages':Math[_0x1890ca(0x112)](_0xa7eb1b/_0x5e7896)}};}async['getUserById'](_0x297040){const _0x17e1bf=a33_0x51f586;return await this[_0x17e1bf(0x129)][_0x17e1bf(0x18e)](_0x297040);}async[a33_0x51f586(0x111)](_0x4705ca){const _0x3edc5a=a33_0x51f586;return await this[_0x3edc5a(0x129)][_0x3edc5a(0x111)](_0x4705ca);}async[a33_0x51f586(0x176)](_0xb5fb19,_0x1a5440){const _0x4be45e=a33_0x51f586;return await this[_0x4be45e(0x129)][_0x4be45e(0x176)](_0xb5fb19,_0x1a5440);}async[a33_0x51f586(0x1c1)](_0x385e24){const _0x55fd4e=a33_0x51f586;return await this[_0x55fd4e(0x129)]['deleteUser'](_0x385e24);}async[a33_0x51f586(0xf5)](_0x2b46d3){const _0x30d8f0=a33_0x51f586;console[_0x30d8f0(0x139)](_0x30d8f0(0x1b4)+_0x2b46d3);const _0x3a4f5a=await database_1[_0x30d8f0(0x1b9)][_0x30d8f0(0x156)][_0x30d8f0(0x1ac)]({'where':{'id':_0x2b46d3},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x3a4f5a)throw new Error(_0x30d8f0(0x184));if(_0x3a4f5a['status']==='SUSPENDED')throw new Error(_0x30d8f0(0x17a));const _0x363cf9=await this[_0x30d8f0(0x129)][_0x30d8f0(0x176)](_0x2b46d3,{'status':_0x30d8f0(0x1b0)});return console[_0x30d8f0(0x139)](_0x30d8f0(0x17d)+_0x3a4f5a[_0x30d8f0(0x104)]+_0x30d8f0(0x170)),_0x363cf9;}async[a33_0x51f586(0x16e)](_0x23faaa){const _0x461328=a33_0x51f586;console[_0x461328(0x139)](_0x461328(0x171)+_0x23faaa);const _0x5de54b=await database_1['default'][_0x461328(0x156)][_0x461328(0x1ac)]({'where':{'id':_0x23faaa},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x5de54b)throw new Error(_0x461328(0x184));if(_0x5de54b[_0x461328(0xff)]===_0x461328(0x125))throw new Error(_0x461328(0x103));const _0x238c31=await this['userService'][_0x461328(0x176)](_0x23faaa,{'status':_0x461328(0x125)});return console['log']('‚úÖ\x20User\x20'+_0x5de54b[_0x461328(0x104)]+'\x20activated\x20successfully'),_0x238c31;}}exports[a33_0x51f586(0x135)]=AdminService;