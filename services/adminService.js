'use strict';const a33_0x50134e=a33_0x20aa;(function(_0x5e79c7,_0x216db7){const _0x2c4237=a33_0x20aa,_0x43ae11=_0x5e79c7();while(!![]){try{const _0x594133=parseInt(_0x2c4237(0xb8))/0x1+-parseInt(_0x2c4237(0x16e))/0x2+parseInt(_0x2c4237(0xbb))/0x3*(parseInt(_0x2c4237(0xea))/0x4)+-parseInt(_0x2c4237(0x10b))/0x5*(parseInt(_0x2c4237(0x106))/0x6)+parseInt(_0x2c4237(0xfa))/0x7+-parseInt(_0x2c4237(0x144))/0x8*(parseInt(_0x2c4237(0x132))/0x9)+-parseInt(_0x2c4237(0x143))/0xa*(parseInt(_0x2c4237(0x13d))/0xb);if(_0x594133===_0x216db7)break;else _0x43ae11['push'](_0x43ae11['shift']());}catch(_0x3f7b65){_0x43ae11['push'](_0x43ae11['shift']());}}}(a33_0x56f2,0xc04c0));function a33_0x20aa(_0x28cf27,_0x3ab0f4){const _0x56f21a=a33_0x56f2();return a33_0x20aa=function(_0x20aa15,_0xd56b0){_0x20aa15=_0x20aa15-0x9a;let _0x243580=_0x56f21a[_0x20aa15];return _0x243580;},a33_0x20aa(_0x28cf27,_0x3ab0f4);}var __importDefault=this&&this[a33_0x50134e(0xae)]||function(_0x14dd2b){const _0x24e7e5=a33_0x50134e;return _0x14dd2b&&_0x14dd2b[_0x24e7e5(0xf7)]?_0x14dd2b:{'default':_0x14dd2b};};Object[a33_0x50134e(0xa8)](exports,'__esModule',{'value':!![]}),exports[a33_0x50134e(0x126)]=void 0x0;function a33_0x56f2(){const _0x23303a=['getPeriodDays','getGatewayNameById','1142512exkxwW','amountAfterCommissionUSDT','✅\x20Activating\x20user:\x20','3AqASZP','📋\x20Getting\x20users\x20with\x20filters:','paidAt','findUnique','updatedAt','✅\x20User\x20','📊\x20Generating\x20admin\x20statistics\x20for\x20period:\x20','\x20USDT\x20(включая\x20штрафы\x20chargeback)','Payment\x20not\x20found','calculateEffectiveAmount','\x20to\x20','createdAt','deleteUser','markPaymentsAsPaidOut','status','thisMonth','awaitingPayout','ACTIVE','payoutDelay','User\x20is\x20already\x20suspended','telegramBotService','chargebackAmount','amount','customerEmail','getAllPayments','toFixed','deletePayout','getPayoutStats','✅\x20Found\x20payment:\x20','\x20status\x20to:\x20','🔄\x20Marking\x20payments\x20as\x20paid\x20out\x20for\x20shop\x20','getFullYear','delete','Chargeback\x20amount\x20is\x20required\x20and\x20must\x20be\x20positive\x20(amount\x20in\x20USDT)','📅\x20This\x20Month:\x20','toISOString','split','error','usdtTrcWallet','FAILED','set','gte','asc','create','webhookLog','30d','✅\x20Payment\x20','1317732WOvqWd','admin_status_update','✅\x20Marked\x20','✅\x20Payout\x20','shop','gatewayOrderId','activateUser','charAt','generateDateRange','notes','PAID','shopId','usdcPolygonWallet','__esModule','default','publicKey','10077536CZIUYf','🔍\x20Getting\x20payment\x20by\x20ID:\x20','suspendUser','✅\x20Payout\x20statistics\x20calculated:','updateUser','txid','statusChangedAt','EXPIRED','webhookLogs','lte','gatewaySettings','\x20eligible\x20PAID\x20payments\x20for\x20payout\x20analysis','15636SJENRG','findMany','✅\x20Admin\x20statistics\x20generated\x20successfully','round','getSystemStatistics','1270szTKas','\x20payments\x20for\x20analysis\x20(PAID/REFUND/CHARGEBACK)','gatewayPaymentId','\x20USDT\x20(','has','calculateAmountAfterCommission','updateMany','💸\x20Chargeback\x20penalty:\x20','📈\x20Average\x20payment:\x20','getDate','parse','bankId','sourceCurrency','💰\x20Found\x20','map','name','💵\x20Total\x20revenue:\x20','payments','remitterName','totalAmountUSDT','getGatewaySettings','paymentGateways','gateway','desc','log','📊\x20Found\x20','SUSPENDED','AdminService','getMonth','currency','usage','Payout\x20not\x20found','\x20days','\x20USDT\x20via\x20','💳\x20Total\x20payments:\x20','join','telegram','push','usdtPolygonWallet','9qLfEjP','✅\x20Payout\x20created\x20successfully:\x20','getPaymentById','length','createPayout','\x20merchants\x20out\x20of\x20','count','statusChangedBy','adminNotes','../config/database','slice','33akJiIl','ceil','👥\x20Total\x20users:\x20','updatePaymentStatus','amountUSDT','isEligibleForPayout','41780ZRcarh','4051568wCoaQt','✅\x20Found\x20payout:\x20','REFUND','includes','UserService','abs','\x20USDT\x20after\x20commission)','getUserById','$queryRaw','getTime','💸\x20Total\x20Payout:\x20','📋\x20Getting\x20payments\x20with\x20filters:','createUser','getAllPayouts','all','\x20USDT\x20(только\x20PAID\x20платежи)','totalAmountAfterCommissionUSDT','💰\x20Total\x20amount:\x20','remitterIban','📊\x20Daily\x20revenue\x20entries:\x20','date','username','currencyService','userService','\x20days)','sendPayoutNotification','📅\x20Processing\x20daily\x20stats\x20for\x20','insensitive','./currencyService','Invalid\x20status.\x20Valid\x20statuses:\x20','COMPLETED','⏳\x20Awaiting\x20Payout:\x20','cardLast4','📋\x20Getting\x20merchants\x20awaiting\x20payout\x20with\x20filters:','💰\x20Available\x20Balance:\x20','toLowerCase','❌\x20Payment\x20not\x20found:\x20','expiresAt','❌\x20Payout\x20not\x20found:\x20','toUpperCase','reduce','get','1886082hwjVpM','./userService','merchantPaid','totalPayout','commission','payment','convertToUSDT','\x20USDT','\x20payments\x20for\x20revenue\x20calculation\x20(PAID/REFUND/CHARGEBACK)','CHARGEBACK','payout','User\x20not\x20found','network','orderId','stringify','isValidGatewayId','defineProperty','update','📊\x20Calculating\x20admin\x20payout\x20statistics...','📋\x20Getting\x20payouts\x20with\x20filters:','setDate','externalPaymentUrl','__importDefault','User\x20is\x20already\x20active','customerName','Shop\x20not\x20found','\x20total','\x20USDT\x20(will\x20be\x20deducted\x20from\x20merchant\x20balance)','usdtErcWallet','🔄\x20Admin\x20updating\x20payment\x20'];a33_0x56f2=function(){return _0x23303a;};return a33_0x56f2();}const database_1=__importDefault(require(a33_0x50134e(0x13b))),currencyService_1=require(a33_0x50134e(0x160)),userService_1=require(a33_0x50134e(0x16f)),telegramBotService_1=require('./telegramBotService'),gateway_1=require('../types/gateway');class AdminService{constructor(){const _0x2962ed=a33_0x50134e;this[_0x2962ed(0x15b)]=new userService_1[(_0x2962ed(0x148))]();}['getPeriodDays'](_0x1c1599){const _0x29d850=a33_0x50134e;switch(_0x1c1599){case'7d':return 0x7;case _0x29d850(0xe8):return 0x1e;case'90d':return 0x5a;case'1y':return 0x16d;default:return 0x1e;}}[a33_0x50134e(0xf2)](_0x393324,_0x2c1f02){const _0x5e95e1=a33_0x50134e,_0x4d56b8=[],_0x9cafe=new Date(_0x393324);while(_0x9cafe<=_0x2c1f02){_0x4d56b8[_0x5e95e1(0x130)](_0x9cafe[_0x5e95e1(0xde)]()['split']('T')[0x0]),_0x9cafe[_0x5e95e1(0xac)](_0x9cafe[_0x5e95e1(0x114)]()+0x1);}return _0x4d56b8;}[a33_0x50134e(0x11f)](_0x53d13f,_0x28e5fb){const _0x2bf548=a33_0x50134e;if(!_0x53d13f['gatewaySettings'])return{'commission':0x0,'payoutDelay':0x0};try{const _0x3b8f1a=JSON[_0x2bf548(0x115)](_0x53d13f[_0x2bf548(0x104)]),_0x13b2d2=_0x28e5fb[_0x2bf548(0xf1)](0x0)[_0x2bf548(0x16b)]()+_0x28e5fb[_0x2bf548(0x13c)](0x1)[_0x2bf548(0x167)]();if(_0x3b8f1a&&_0x3b8f1a[_0x13b2d2])return{'commission':_0x3b8f1a[_0x13b2d2][_0x2bf548(0x9c)]||0x0,'payoutDelay':_0x3b8f1a[_0x13b2d2][_0x2bf548(0xcd)]||0x0};}catch(_0x5a97ec){console[_0x2bf548(0xe0)]('Error\x20parsing\x20gateway\x20settings:',_0x5a97ec);}return{'commission':0x0,'payoutDelay':0x0};}[a33_0x50134e(0x142)](_0xa409b7){const _0xde2a0e=a33_0x50134e;if(_0xa409b7[_0xde2a0e(0xc9)]!==_0xde2a0e(0xf4)||_0xa409b7[_0xde2a0e(0x9a)]||!_0xa409b7[_0xde2a0e(0xbd)])return![];const _0x545f4f=this['getGatewaySettings'](_0xa409b7[_0xde2a0e(0xee)],_0xa409b7[_0xde2a0e(0x121)]),_0x516556=_0x545f4f[_0xde2a0e(0xcd)]*0x18*0x3c*0x3c*0x3e8,_0x2e0691=new Date(_0xa409b7[_0xde2a0e(0xbd)][_0xde2a0e(0x14d)]()+_0x516556);return new Date()>_0x2e0691;}[a33_0x50134e(0x110)](_0xea32f9,_0x2ca816){return _0xea32f9*(0x1-_0x2ca816/0x64);}[a33_0x50134e(0xc4)](_0xddfb84){const _0x14357b=a33_0x50134e;switch(_0xddfb84[_0x14357b(0xc9)]){case _0x14357b(0xf4):return _0xddfb84[_0x14357b(0xd1)];case _0x14357b(0xa1):return-(_0xddfb84[_0x14357b(0xd0)]||0x0);case'REFUND':return 0x0;default:return 0x0;}}async[a33_0x50134e(0x136)](_0xa9935b){const _0x8e10ed=a33_0x50134e,{shopId:_0xea727b,amount:_0x401fac,network:_0x39c096,notes:_0x1d0729}=_0xa9935b;console['log']('💸\x20Creating\x20payout\x20for\x20shop\x20'+_0xea727b+':\x20'+_0x401fac+'\x20USDT\x20via\x20'+_0x39c096);const _0x5c6332=await database_1[_0x8e10ed(0xf8)][_0x8e10ed(0xee)][_0x8e10ed(0xbe)]({'where':{'id':_0xea727b},'select':{'id':!![],'name':!![],'username':!![],'status':!![]}});if(!_0x5c6332)throw new Error(_0x8e10ed(0xb1));if(_0x5c6332[_0x8e10ed(0xc9)]!==_0x8e10ed(0xcc))throw new Error('Shop\x20is\x20not\x20active');const _0x5bda1a=await database_1[_0x8e10ed(0xf8)][_0x8e10ed(0xa2)][_0x8e10ed(0xe6)]({'data':{'shopId':_0xea727b,'amount':_0x401fac,'network':_0x39c096,'status':_0x8e10ed(0x162),'notes':_0x1d0729||null,'paidAt':new Date()},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});await this[_0x8e10ed(0xc8)](_0xea727b,_0x401fac);try{await telegramBotService_1[_0x8e10ed(0xcf)][_0x8e10ed(0x15d)](_0xea727b,_0x5bda1a,'completed');}catch(_0x37d816){console[_0x8e10ed(0xe0)]('Failed\x20to\x20send\x20Telegram\x20payout\x20notification:',_0x37d816);}return console[_0x8e10ed(0x123)](_0x8e10ed(0x133)+_0x5bda1a['id']),{'id':_0x5bda1a['id'],'shopId':_0x5bda1a['shopId'],'shopName':_0x5bda1a[_0x8e10ed(0xee)][_0x8e10ed(0x11a)],'shopUsername':_0x5bda1a[_0x8e10ed(0xee)][_0x8e10ed(0x159)],'amount':_0x5bda1a[_0x8e10ed(0xd1)],'network':_0x5bda1a[_0x8e10ed(0xa4)],'status':_0x5bda1a['status'],'txid':_0x5bda1a['txid'],'notes':_0x5bda1a[_0x8e10ed(0xf3)],'createdAt':_0x5bda1a[_0x8e10ed(0xc6)],'paidAt':_0x5bda1a[_0x8e10ed(0xbd)]};}async[a33_0x50134e(0xc8)](_0x405cff,_0x48335e){const _0x530dab=a33_0x50134e;console[_0x530dab(0x123)](_0x530dab(0xd9)+_0x405cff+',\x20amount:\x20'+_0x48335e+_0x530dab(0x9f));const _0xa3a8d=await database_1[_0x530dab(0xf8)][_0x530dab(0x9d)][_0x530dab(0x107)]({'where':{'shopId':_0x405cff,'status':_0x530dab(0xf4),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'shop':{'select':{'gatewaySettings':!![]}}},'orderBy':{'paidAt':_0x530dab(0xe5)}});let _0xbec703=_0x48335e;const _0x580139=[];for(const _0x4b4d85 of _0xa3a8d){const _0x910113={..._0x4b4d85,'status':_0x530dab(0xf4),'merchantPaid':![],'shop':{'gatewaySettings':_0x4b4d85[_0x530dab(0xee)][_0x530dab(0x104)]}};if(!this['isEligibleForPayout'](_0x910113))continue;const _0x5bdd73=await currencyService_1[_0x530dab(0x15a)][_0x530dab(0x9e)](_0x4b4d85['amount'],_0x4b4d85[_0x530dab(0x128)]),_0x168d98=this[_0x530dab(0x11f)](_0x4b4d85[_0x530dab(0xee)],_0x4b4d85[_0x530dab(0x121)]),_0x45a616=this[_0x530dab(0x110)](_0x5bdd73,_0x168d98['commission']);if(_0x45a616<=_0xbec703){_0x580139['push'](_0x4b4d85['id']),_0xbec703-=_0x45a616;if(_0xbec703<=0.01)break;}}_0x580139[_0x530dab(0x135)]>0x0&&(await database_1['default']['payment'][_0x530dab(0x111)]({'where':{'id':{'in':_0x580139}},'data':{'merchantPaid':!![]}}),console[_0x530dab(0x123)](_0x530dab(0xec)+_0x580139['length']+'\x20payments\x20as\x20paid\x20out'));}async[a33_0x50134e(0x151)](_0x8d86b6){const _0x54408d=a33_0x50134e,{page:_0x73792e,limit:_0x53907a,shopId:_0x42bfb8,network:_0x4a293a,dateFrom:_0x287e74,dateTo:_0x3d23ef,search:_0x1074c0}=_0x8d86b6,_0x13e0b3=(_0x73792e-0x1)*_0x53907a;console[_0x54408d(0x123)](_0x54408d(0xab),_0x8d86b6);const _0x43d66c={};_0x42bfb8&&(_0x43d66c[_0x54408d(0xf5)]=_0x42bfb8);_0x4a293a&&(_0x43d66c['network']=_0x4a293a);(_0x287e74||_0x3d23ef)&&(_0x43d66c[_0x54408d(0xc6)]={},_0x287e74&&(_0x43d66c[_0x54408d(0xc6)][_0x54408d(0xe4)]=new Date(_0x287e74)),_0x3d23ef&&(_0x43d66c[_0x54408d(0xc6)][_0x54408d(0x103)]=new Date(_0x3d23ef)));_0x1074c0&&(_0x43d66c['OR']=[{'txid':{'contains':_0x1074c0,'mode':_0x54408d(0x15f)}},{'notes':{'contains':_0x1074c0,'mode':'insensitive'}},{'shop':{'name':{'contains':_0x1074c0,'mode':'insensitive'}}},{'shop':{'username':{'contains':_0x1074c0,'mode':_0x54408d(0x15f)}}}]);const [_0x4dc31e,_0xc0291d]=await Promise['all']([database_1[_0x54408d(0xf8)]['payout']['findMany']({'where':_0x43d66c,'skip':_0x13e0b3,'take':_0x53907a,'orderBy':{'createdAt':_0x54408d(0x122)},'include':{'shop':{'select':{'name':!![],'username':!![]}}}}),database_1['default']['payout'][_0x54408d(0x138)]({'where':_0x43d66c})]);console['log'](_0x54408d(0x124)+_0x4dc31e[_0x54408d(0x135)]+'\x20payouts\x20out\x20of\x20'+_0xc0291d+_0x54408d(0xb2));const _0x21aaa7=_0x4dc31e['map'](_0x5e1e96=>({'id':_0x5e1e96['id'],'shopId':_0x5e1e96[_0x54408d(0xf5)],'shopName':_0x5e1e96[_0x54408d(0xee)][_0x54408d(0x11a)],'shopUsername':_0x5e1e96[_0x54408d(0xee)]['username'],'amount':_0x5e1e96[_0x54408d(0xd1)],'network':_0x5e1e96['network'],'status':_0x5e1e96[_0x54408d(0xc9)],'txid':_0x5e1e96['txid'],'notes':_0x5e1e96[_0x54408d(0xf3)],'createdAt':_0x5e1e96[_0x54408d(0xc6)],'paidAt':_0x5e1e96['paidAt']}));return{'payouts':_0x21aaa7,'pagination':{'page':_0x73792e,'limit':_0x53907a,'total':_0xc0291d,'totalPages':Math[_0x54408d(0x13e)](_0xc0291d/_0x53907a)}};}async['getPayoutById'](_0x2b99a7){const _0x20a270=a33_0x50134e;console[_0x20a270(0x123)]('🔍\x20Getting\x20payout\x20by\x20ID:\x20'+_0x2b99a7);const _0x1f717e=await database_1[_0x20a270(0xf8)][_0x20a270(0xa2)][_0x20a270(0xbe)]({'where':{'id':_0x2b99a7},'include':{'shop':{'select':{'name':!![],'username':!![]}}}});if(!_0x1f717e)return console[_0x20a270(0x123)](_0x20a270(0x16a)+_0x2b99a7),null;return console[_0x20a270(0x123)](_0x20a270(0x145)+_0x1f717e['amount']+_0x20a270(0x12c)+_0x1f717e[_0x20a270(0xa4)]),{'id':_0x1f717e['id'],'shopId':_0x1f717e['shopId'],'shopName':_0x1f717e['shop'][_0x20a270(0x11a)],'shopUsername':_0x1f717e[_0x20a270(0xee)][_0x20a270(0x159)],'amount':_0x1f717e[_0x20a270(0xd1)],'network':_0x1f717e[_0x20a270(0xa4)],'status':_0x1f717e['status'],'txid':_0x1f717e[_0x20a270(0xff)],'notes':_0x1f717e[_0x20a270(0xf3)],'createdAt':_0x1f717e[_0x20a270(0xc6)],'paidAt':_0x1f717e['paidAt']};}async[a33_0x50134e(0xd5)](_0x589b26){const _0x283f53=a33_0x50134e;console[_0x283f53(0x123)]('🗑️\x20Deleting\x20payout:\x20'+_0x589b26);const _0x3d246a=await database_1['default'][_0x283f53(0xa2)]['findUnique']({'where':{'id':_0x589b26},'select':{'id':!![],'shopId':!![],'amount':!![]}});if(!_0x3d246a)throw new Error(_0x283f53(0x12a));await database_1['default'][_0x283f53(0xa2)][_0x283f53(0xdb)]({'where':{'id':_0x589b26}}),console[_0x283f53(0x123)](_0x283f53(0xed)+_0x589b26+'\x20deleted\x20successfully');}async['getMerchantsAwaitingPayout'](_0x2e3f5e){const _0x1a31e9=a33_0x50134e,{page:_0xcbd0cf,limit:_0x484866,minAmount:_0xdb38f9,search:_0x115f83}=_0x2e3f5e;console[_0x1a31e9(0x123)](_0x1a31e9(0x165),_0x2e3f5e);const _0x7028ff=await database_1['default'][_0x1a31e9(0x9d)][_0x1a31e9(0x107)]({'where':{'status':_0x1a31e9(0xf4),'merchantPaid':![],'paidAt':{'not':null}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'gateway':!![],'paidAt':!![],'createdAt':!![],'shop':{'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'gatewaySettings':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![]}}}});console['log']('💰\x20Found\x20'+_0x7028ff[_0x1a31e9(0x135)]+_0x1a31e9(0x105));const _0x5ee80f=new Map();for(const _0x13dab3 of _0x7028ff){const _0x40e91a={..._0x13dab3,'status':_0x1a31e9(0xf4),'merchantPaid':![],'shop':{'gatewaySettings':_0x13dab3[_0x1a31e9(0xee)][_0x1a31e9(0x104)]}},_0x416990=this[_0x1a31e9(0x142)](_0x40e91a);if(!_0x416990)continue;const _0x6f08f8=await currencyService_1[_0x1a31e9(0x15a)]['convertToUSDT'](_0x13dab3['amount'],_0x13dab3[_0x1a31e9(0x128)]),_0x524353=this[_0x1a31e9(0x11f)](_0x13dab3[_0x1a31e9(0xee)],_0x13dab3[_0x1a31e9(0x121)]),_0x4a05eb=this[_0x1a31e9(0x110)](_0x6f08f8,_0x524353['commission']),_0x4493bc=_0x13dab3[_0x1a31e9(0xf5)];!_0x5ee80f[_0x1a31e9(0x10f)](_0x4493bc)&&_0x5ee80f[_0x1a31e9(0xe3)](_0x4493bc,{'shop':_0x13dab3[_0x1a31e9(0xee)],'payments':[]}),_0x5ee80f['get'](_0x4493bc)[_0x1a31e9(0x11c)][_0x1a31e9(0x130)]({'id':_0x13dab3['id'],'amount':_0x13dab3[_0x1a31e9(0xd1)],'currency':_0x13dab3[_0x1a31e9(0x128)],'gateway':_0x13dab3['gateway'],'paidAt':_0x13dab3[_0x1a31e9(0xbd)],'createdAt':_0x13dab3['createdAt'],'amountUSDT':_0x6f08f8,'commission':_0x524353[_0x1a31e9(0x9c)],'amountAfterCommissionUSDT':_0x4a05eb,'isEligible':!![]});}console['log']('🏪\x20Found\x20'+_0x5ee80f['size']+'\x20merchants\x20with\x20eligible\x20PAID\x20payments');const _0x6019a6=[];for(const [_0x1e06d5,_0x23ce03]of _0x5ee80f){const {shop:_0x467530,payments:_0x143cd9}=_0x23ce03,_0x5cbf65=_0x143cd9['reduce']((_0x4ad4fb,_0x45361d)=>_0x4ad4fb+_0x45361d[_0x1a31e9(0x141)],0x0),_0x3267ac=_0x143cd9[_0x1a31e9(0x16c)]((_0x3da578,_0x31da66)=>_0x3da578+_0x31da66[_0x1a31e9(0xb9)],0x0);if(_0xdb38f9&&_0x3267ac<_0xdb38f9)continue;if(_0x115f83){const _0x2114fd=_0x115f83[_0x1a31e9(0x167)](),_0x4d858b=_0x467530['name']['toLowerCase']()[_0x1a31e9(0x147)](_0x2114fd)||_0x467530[_0x1a31e9(0x159)][_0x1a31e9(0x167)]()['includes'](_0x2114fd)||_0x467530[_0x1a31e9(0x12f)]&&_0x467530[_0x1a31e9(0x12f)][_0x1a31e9(0x167)]()['includes'](_0x2114fd);if(!_0x4d858b)continue;}const _0x3346ff=new Map();for(const _0xa6026c of _0x143cd9){const _0x1894b1=_0xa6026c[_0x1a31e9(0x121)];!_0x3346ff['has'](_0x1894b1)&&_0x3346ff['set'](_0x1894b1,{'count':0x0,'amountUSDT':0x0,'amountAfterCommissionUSDT':0x0,'commission':_0xa6026c[_0x1a31e9(0x9c)]});const _0x3f3147=_0x3346ff[_0x1a31e9(0x16d)](_0x1894b1);_0x3f3147[_0x1a31e9(0x138)]++,_0x3f3147[_0x1a31e9(0x141)]+=_0xa6026c[_0x1a31e9(0x141)],_0x3f3147[_0x1a31e9(0xb9)]+=_0xa6026c[_0x1a31e9(0xb9)];}const _0x46178e=Array['from'](_0x3346ff['entries']())[_0x1a31e9(0x119)](([_0x1f0b69,_0x58de66])=>({'gateway':_0x1f0b69[_0x1a31e9(0xf1)](0x0)[_0x1a31e9(0x16b)]()+_0x1f0b69[_0x1a31e9(0x13c)](0x1),'count':_0x58de66[_0x1a31e9(0x138)],'amountUSDT':Math['round'](_0x58de66[_0x1a31e9(0x141)]*0x64)/0x64,'amountAfterCommissionUSDT':Math[_0x1a31e9(0x109)](_0x58de66['amountAfterCommissionUSDT']*0x64)/0x64,'commission':_0x58de66[_0x1a31e9(0x9c)]})),_0x5de447=_0x143cd9[_0x1a31e9(0x16c)]((_0x40b4c4,_0x240b62)=>{const _0x5bf2d3=_0x1a31e9;return _0x240b62[_0x5bf2d3(0xbd)]<_0x40b4c4?_0x240b62['paidAt']:_0x40b4c4;},_0x143cd9[0x0]['paidAt']);_0x6019a6[_0x1a31e9(0x130)]({'id':_0x467530['id'],'fullName':_0x467530[_0x1a31e9(0x11a)],'username':_0x467530['username'],'telegramId':_0x467530['telegram'],'merchantUrl':_0x467530['shopUrl'],'wallets':{'usdtPolygonWallet':_0x467530[_0x1a31e9(0x131)],'usdtTrcWallet':_0x467530[_0x1a31e9(0xe1)],'usdtErcWallet':_0x467530[_0x1a31e9(0xb4)],'usdcPolygonWallet':_0x467530[_0x1a31e9(0xf6)]},'totalAmountUSDT':Math[_0x1a31e9(0x109)](_0x5cbf65*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math['round'](_0x3267ac*0x64)/0x64,'paymentsCount':_0x143cd9['length'],'oldestPaymentDate':_0x5de447,'gatewayBreakdown':_0x46178e});}_0x6019a6['sort']((_0x287601,_0x432069)=>_0x432069[_0x1a31e9(0x154)]-_0x287601[_0x1a31e9(0x154)]);const _0xeddedc=_0x6019a6[_0x1a31e9(0x135)],_0x39437c=_0x6019a6['reduce']((_0x5df06b,_0x5c82f7)=>_0x5df06b+_0x5c82f7[_0x1a31e9(0x11e)],0x0),_0x399982=_0x6019a6[_0x1a31e9(0x16c)]((_0x352226,_0x222180)=>_0x352226+_0x222180[_0x1a31e9(0x154)],0x0),_0x3cbbf2=(_0xcbd0cf-0x1)*_0x484866,_0x1c48f2=_0x6019a6[_0x1a31e9(0x13c)](_0x3cbbf2,_0x3cbbf2+_0x484866);return console['log']('✅\x20Returning\x20'+_0x1c48f2[_0x1a31e9(0x135)]+_0x1a31e9(0x137)+_0xeddedc+_0x1a31e9(0xb2)),console[_0x1a31e9(0x123)](_0x1a31e9(0x155)+_0x39437c[_0x1a31e9(0xd4)](0x2)+_0x1a31e9(0x10e)+_0x399982[_0x1a31e9(0xd4)](0x2)+_0x1a31e9(0x14a)),{'merchants':_0x1c48f2,'pagination':{'page':_0xcbd0cf,'limit':_0x484866,'total':_0xeddedc,'totalPages':Math[_0x1a31e9(0x13e)](_0xeddedc/_0x484866)},'summary':{'totalMerchants':_0xeddedc,'totalAmountUSDT':Math[_0x1a31e9(0x109)](_0x39437c*0x64)/0x64,'totalAmountAfterCommissionUSDT':Math[_0x1a31e9(0x109)](_0x399982*0x64)/0x64}};}async[a33_0x50134e(0xd6)](){const _0x52efd4=a33_0x50134e;console[_0x52efd4(0x123)](_0x52efd4(0xaa));const _0x225689=await database_1[_0x52efd4(0xf8)][_0x52efd4(0x9d)][_0x52efd4(0x107)]({'where':{'status':{'in':[_0x52efd4(0xf4),_0x52efd4(0x146),_0x52efd4(0xa1)]}},'select':{'id':!![],'shopId':!![],'amount':!![],'currency':!![],'status':!![],'gateway':!![],'paidAt':!![],'merchantPaid':!![],'createdAt':!![],'chargebackAmount':!![],'shop':{'select':{'gatewaySettings':!![]}}}});console[_0x52efd4(0x123)](_0x52efd4(0x118)+_0x225689['length']+_0x52efd4(0x10c));const _0x425b27=new Date(),_0x380d7=new Date(_0x425b27[_0x52efd4(0xda)](),_0x425b27[_0x52efd4(0x127)](),0x1),_0x27e8c4=new Date(_0x425b27['getFullYear'](),_0x425b27[_0x52efd4(0x127)]()+0x1,0x0,0x17,0x3b,0x3b,0x3e7);let _0xa61860=0x0,_0x459626=0x0,_0x2c1fb2=0x0,_0x2735bf=0x0;for(const _0x5de0b0 of _0x225689){const _0x468819=this[_0x52efd4(0xc4)](_0x5de0b0);if(_0x468819===0x0)continue;let _0x4abf08,_0x5654e0;if(_0x5de0b0[_0x52efd4(0xc9)]===_0x52efd4(0xa1))_0x4abf08=Math[_0x52efd4(0x149)](_0x468819),_0x5654e0=-_0x4abf08;else{_0x4abf08=await currencyService_1[_0x52efd4(0x15a)]['convertToUSDT'](_0x5de0b0['amount'],_0x5de0b0['currency']);const _0x350b81=this['getGatewaySettings'](_0x5de0b0['shop'],_0x5de0b0[_0x52efd4(0x121)]);_0x5654e0=this[_0x52efd4(0x110)](_0x4abf08,_0x350b81[_0x52efd4(0x9c)]);}_0x5de0b0[_0x52efd4(0x9a)]&&(_0xa61860+=_0x5654e0,_0x5de0b0[_0x52efd4(0xbd)]&&_0x5de0b0[_0x52efd4(0xbd)]>=_0x380d7&&_0x5de0b0[_0x52efd4(0xbd)]<=_0x27e8c4&&(_0x2c1fb2+=_0x5654e0)),_0x5de0b0[_0x52efd4(0xc9)]===_0x52efd4(0xf4)&&this[_0x52efd4(0x142)](_0x5de0b0)&&(_0x459626+=_0x5654e0,_0x2735bf+=_0x4abf08);}const _0x4ce95e={'totalPayout':Math[_0x52efd4(0x109)](_0xa61860*0x64)/0x64,'awaitingPayout':Math[_0x52efd4(0x109)](_0x459626*0x64)/0x64,'thisMonth':Math[_0x52efd4(0x109)](_0x2c1fb2*0x64)/0x64,'availableBalance':Math[_0x52efd4(0x109)](_0x2735bf*0x64)/0x64};return console[_0x52efd4(0x123)](_0x52efd4(0xfd)),console[_0x52efd4(0x123)](_0x52efd4(0x14e)+_0x4ce95e[_0x52efd4(0x9b)]+_0x52efd4(0xc2)),console[_0x52efd4(0x123)](_0x52efd4(0x163)+_0x4ce95e[_0x52efd4(0xcb)]+_0x52efd4(0x153)),console[_0x52efd4(0x123)](_0x52efd4(0xdd)+_0x4ce95e[_0x52efd4(0xca)]+_0x52efd4(0x9f)),console[_0x52efd4(0x123)](_0x52efd4(0x166)+_0x4ce95e['availableBalance']+'\x20USDT'),_0x4ce95e;}async[a33_0x50134e(0x10a)](_0x19f26d){const _0x22f142=a33_0x50134e,_0x3068a8=this[_0x22f142(0xb6)](_0x19f26d),_0x378112=new Date();_0x378112[_0x22f142(0xac)](_0x378112['getDate']()-_0x3068a8),console[_0x22f142(0x123)](_0x22f142(0xc1)+_0x19f26d+'\x20('+_0x3068a8+_0x22f142(0x15c));const _0x732357=await database_1['default'][_0x22f142(0xee)][_0x22f142(0x138)]({'where':{'status':_0x22f142(0xcc)}}),_0x2af174=await database_1[_0x22f142(0xf8)][_0x22f142(0x9d)][_0x22f142(0x138)](),_0xddb43c=await database_1[_0x22f142(0xf8)][_0x22f142(0x9d)][_0x22f142(0x107)]({'where':{'status':{'in':[_0x22f142(0xf4),_0x22f142(0x146),_0x22f142(0xa1)]}},'select':{'amount':!![],'currency':!![],'status':!![],'chargebackAmount':!![],'createdAt':!![]}});console['log'](_0x22f142(0x118)+_0xddb43c[_0x22f142(0x135)]+_0x22f142(0xa0));const _0x4e8061=await Promise['all'](_0xddb43c[_0x22f142(0x119)](async _0x5330f3=>{const _0xc3dfac=_0x22f142,_0x351059=this[_0xc3dfac(0xc4)](_0x5330f3);if(_0x351059===0x0)return{'amount':0x0,'createdAt':_0x5330f3[_0xc3dfac(0xc6)]};let _0x30c84f;return _0x5330f3[_0xc3dfac(0xc9)]==='CHARGEBACK'?_0x30c84f=-Math[_0xc3dfac(0x149)](_0x351059):_0x30c84f=await currencyService_1[_0xc3dfac(0x15a)][_0xc3dfac(0x9e)](_0x5330f3[_0xc3dfac(0xd1)],_0x5330f3[_0xc3dfac(0x128)]),{'amount':_0x30c84f,'createdAt':_0x5330f3[_0xc3dfac(0xc6)]};})),_0x496680=_0x4e8061[_0x22f142(0x16c)]((_0x1c6cd9,_0x35841e)=>_0x1c6cd9+_0x35841e[_0x22f142(0xd1)],0x0),_0x2f142b=_0x2af174>0x0?_0x496680/_0x2af174:0x0;console['log'](_0x22f142(0x11b)+_0x496680[_0x22f142(0xd4)](0x2)+_0x22f142(0xc2)),console[_0x22f142(0x123)](_0x22f142(0x113)+_0x2f142b[_0x22f142(0xd4)](0x2)+_0x22f142(0x9f));const _0x66cc9f=await database_1[_0x22f142(0xf8)][_0x22f142(0x14c)]`
      SELECT 
        DATE(created_at) as date,
        array_agg(
          json_build_object(
            'amount', amount,
            'currency', currency,
            'status', status,
            'chargeback_amount', chargeback_amount
          )
        ) as payments
      FROM payments 
      WHERE created_at >= ${_0x378112}
        AND status IN ('PAID', 'REFUND', 'CHARGEBACK')
      GROUP BY DATE(created_at)
      ORDER BY date ASC
    `;console[_0x22f142(0x123)](_0x22f142(0x15e)+_0x66cc9f['length']+_0x22f142(0x12b));const _0x243bab=await Promise[_0x22f142(0x152)](_0x66cc9f['map'](async _0x397d46=>{const _0x4c6521=_0x22f142,_0x4e4afe=await Promise[_0x4c6521(0x152)](_0x397d46[_0x4c6521(0x11c)][_0x4c6521(0x119)](async _0x279eba=>{const _0x4fc9a4=_0x4c6521,_0x5593a1=this[_0x4fc9a4(0xc4)](_0x279eba);if(_0x5593a1===0x0)return 0x0;return _0x279eba[_0x4fc9a4(0xc9)]==='CHARGEBACK'?-Math['abs'](_0x5593a1):await currencyService_1[_0x4fc9a4(0x15a)][_0x4fc9a4(0x9e)](_0x279eba['amount'],_0x279eba[_0x4fc9a4(0x128)]);})),_0x475037=_0x4e4afe[_0x4c6521(0x16c)]((_0x3536d4,_0x25fbbc)=>_0x3536d4+_0x25fbbc,0x0);return{'date':_0x397d46[_0x4c6521(0x158)][_0x4c6521(0xde)]()[_0x4c6521(0xdf)]('T')[0x0],'amount':_0x475037};})),_0x1cc83d=this[_0x22f142(0xf2)](_0x378112,new Date()),_0x2ef67e=new Map(_0x243bab[_0x22f142(0x119)](_0x52e8d4=>[_0x52e8d4[_0x22f142(0x158)],_0x52e8d4[_0x22f142(0xd1)]])),_0x10b794=_0x1cc83d[_0x22f142(0x119)](_0x282fa1=>({'date':_0x282fa1,'amount':_0x2ef67e[_0x22f142(0x16d)](_0x282fa1)||0x0}));return console[_0x22f142(0x123)](_0x22f142(0x108)),console[_0x22f142(0x123)](_0x22f142(0x13f)+_0x732357),console[_0x22f142(0x123)](_0x22f142(0x12d)+_0x2af174),console[_0x22f142(0x123)](_0x22f142(0x157)+_0x10b794['length']),{'totalRevenue':Math[_0x22f142(0x109)](_0x496680*0x64)/0x64,'totalUsers':_0x732357,'totalPayments':_0x2af174,'averagePayment':Math[_0x22f142(0x109)](_0x2f142b*0x64)/0x64,'dailyRevenue':_0x10b794};}async[a33_0x50134e(0xd3)](_0x3211b1){const _0x90e49a=a33_0x50134e,{page:_0x1d4e1e,limit:_0x37eda4,status:_0x3a2b52,gateway:_0x4d7d58,shopId:_0x70d54a,dateFrom:_0x14c662,dateTo:_0x43b882,search:_0x28c577}=_0x3211b1,_0x20b305=(_0x1d4e1e-0x1)*_0x37eda4;console['log'](_0x90e49a(0x14f),_0x3211b1);const _0x1d5f35={};_0x3a2b52&&(_0x1d5f35[_0x90e49a(0xc9)]=_0x3a2b52[_0x90e49a(0x16b)]());if(_0x4d7d58){if((0x0,gateway_1[_0x90e49a(0xa7)])(_0x4d7d58)){const _0x4315c5=(0x0,gateway_1[_0x90e49a(0xb7)])(_0x4d7d58);_0x4315c5&&(_0x1d5f35[_0x90e49a(0x121)]=_0x4315c5);}else _0x1d5f35['gateway']=_0x4d7d58[_0x90e49a(0x167)]();}_0x70d54a&&(_0x1d5f35[_0x90e49a(0xf5)]=_0x70d54a);(_0x14c662||_0x43b882)&&(_0x1d5f35[_0x90e49a(0xc6)]={},_0x14c662&&(_0x1d5f35['createdAt'][_0x90e49a(0xe4)]=new Date(_0x14c662)),_0x43b882&&(_0x1d5f35['createdAt'][_0x90e49a(0x103)]=new Date(_0x43b882)));_0x28c577&&(_0x1d5f35['OR']=[{'orderId':{'contains':_0x28c577,'mode':'insensitive'}},{'gatewayOrderId':{'contains':_0x28c577,'mode':_0x90e49a(0x15f)}},{'gatewayPaymentId':{'contains':_0x28c577,'mode':_0x90e49a(0x15f)}},{'customerEmail':{'contains':_0x28c577,'mode':_0x90e49a(0x15f)}},{'customerName':{'contains':_0x28c577,'mode':_0x90e49a(0x15f)}},{'shop':{'name':{'contains':_0x28c577,'mode':_0x90e49a(0x15f)}}},{'shop':{'username':{'contains':_0x28c577,'mode':'insensitive'}}}]);const [_0x409b23,_0x42e3da]=await Promise[_0x90e49a(0x152)]([database_1[_0x90e49a(0xf8)][_0x90e49a(0x9d)][_0x90e49a(0x107)]({'where':_0x1d5f35,'skip':_0x20b305,'take':_0x37eda4,'orderBy':{'createdAt':_0x90e49a(0x122)},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}}),database_1['default'][_0x90e49a(0x9d)][_0x90e49a(0x138)]({'where':_0x1d5f35})]);console[_0x90e49a(0x123)](_0x90e49a(0x124)+_0x409b23[_0x90e49a(0x135)]+'\x20payments\x20out\x20of\x20'+_0x42e3da+_0x90e49a(0xb2));const _0x2486a0=_0x409b23[_0x90e49a(0x119)](_0xd4492e=>({'id':_0xd4492e['id'],'shopId':_0xd4492e['shopId'],'shopName':_0xd4492e[_0x90e49a(0xee)][_0x90e49a(0x11a)],'shopUsername':_0xd4492e[_0x90e49a(0xee)][_0x90e49a(0x159)],'gateway':_0xd4492e['gateway'],'orderId':_0xd4492e[_0x90e49a(0xa5)],'gatewayOrderId':_0xd4492e['gatewayOrderId'],'amount':_0xd4492e['amount'],'currency':_0xd4492e[_0x90e49a(0x128)],'sourceCurrency':_0xd4492e[_0x90e49a(0x117)],'status':_0xd4492e[_0x90e49a(0xc9)],'usage':_0xd4492e[_0x90e49a(0x129)],'externalPaymentUrl':_0xd4492e[_0x90e49a(0xad)],'gatewayPaymentId':_0xd4492e[_0x90e49a(0x10d)],'customerEmail':_0xd4492e[_0x90e49a(0xd2)],'customerName':_0xd4492e[_0x90e49a(0xb0)],'cardLast4':_0xd4492e[_0x90e49a(0x164)],'paymentMethod':_0xd4492e['paymentMethod'],'bankId':_0xd4492e[_0x90e49a(0x116)],'remitterIban':_0xd4492e['remitterIban'],'remitterName':_0xd4492e['remitterName'],'chargebackAmount':_0xd4492e[_0x90e49a(0xd0)],'adminNotes':_0xd4492e[_0x90e49a(0x13a)],'statusChangedBy':_0xd4492e[_0x90e49a(0x139)],'statusChangedAt':_0xd4492e[_0x90e49a(0x100)],'createdAt':_0xd4492e[_0x90e49a(0xc6)],'updatedAt':_0xd4492e[_0x90e49a(0xbf)],'expiresAt':_0xd4492e[_0x90e49a(0x169)]}));return{'payments':_0x2486a0,'pagination':{'page':_0x1d4e1e,'limit':_0x37eda4,'total':_0x42e3da,'totalPages':Math[_0x90e49a(0x13e)](_0x42e3da/_0x37eda4)}};}async[a33_0x50134e(0x134)](_0x210c7f){const _0x280976=a33_0x50134e;console[_0x280976(0x123)](_0x280976(0xfb)+_0x210c7f);const _0x2af00a=await database_1[_0x280976(0xf8)][_0x280976(0x9d)][_0x280976(0xbe)]({'where':{'id':_0x210c7f},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}},'webhookLogs':{'orderBy':{'createdAt':'desc'},'take':0xa,'select':{'id':!![],'event':!![],'statusCode':!![],'retryCount':!![],'createdAt':!![]}}}});if(!_0x2af00a)return console[_0x280976(0x123)](_0x280976(0x168)+_0x210c7f),null;return console[_0x280976(0x123)](_0x280976(0xd7)+_0x2af00a[_0x280976(0xa5)]+'\x20('+_0x2af00a[_0x280976(0xc9)]+')'),{'id':_0x2af00a['id'],'shopId':_0x2af00a[_0x280976(0xf5)],'shopName':_0x2af00a['shop'][_0x280976(0x11a)],'shopUsername':_0x2af00a[_0x280976(0xee)][_0x280976(0x159)],'gateway':_0x2af00a['gateway'],'orderId':_0x2af00a[_0x280976(0xa5)],'gatewayOrderId':_0x2af00a[_0x280976(0xef)],'amount':_0x2af00a[_0x280976(0xd1)],'currency':_0x2af00a[_0x280976(0x128)],'sourceCurrency':_0x2af00a[_0x280976(0x117)],'status':_0x2af00a[_0x280976(0xc9)],'usage':_0x2af00a[_0x280976(0x129)],'externalPaymentUrl':_0x2af00a[_0x280976(0xad)],'gatewayPaymentId':_0x2af00a[_0x280976(0x10d)],'customerEmail':_0x2af00a[_0x280976(0xd2)],'customerName':_0x2af00a[_0x280976(0xb0)],'cardLast4':_0x2af00a[_0x280976(0x164)],'paymentMethod':_0x2af00a['paymentMethod'],'bankId':_0x2af00a[_0x280976(0x116)],'remitterIban':_0x2af00a[_0x280976(0x156)],'remitterName':_0x2af00a[_0x280976(0x11d)],'chargebackAmount':_0x2af00a[_0x280976(0xd0)],'adminNotes':_0x2af00a['adminNotes'],'statusChangedBy':_0x2af00a[_0x280976(0x139)],'statusChangedAt':_0x2af00a[_0x280976(0x100)],'createdAt':_0x2af00a[_0x280976(0xc6)],'updatedAt':_0x2af00a[_0x280976(0xbf)],'expiresAt':_0x2af00a[_0x280976(0x169)],'webhookLogs':_0x2af00a[_0x280976(0x102)]};}async[a33_0x50134e(0x140)](_0x49eda5,_0xdd6678,_0x394d0b,_0x5bc13f){const _0x2f53e5=a33_0x50134e;console[_0x2f53e5(0x123)](_0x2f53e5(0xb5)+_0x49eda5+_0x2f53e5(0xd8)+_0xdd6678);const _0x3c455f=['PENDING','PAID',_0x2f53e5(0x101),_0x2f53e5(0xe2),_0x2f53e5(0x146),_0x2f53e5(0xa1)];if(!_0x3c455f[_0x2f53e5(0x147)](_0xdd6678[_0x2f53e5(0x16b)]()))throw new Error(_0x2f53e5(0x161)+_0x3c455f[_0x2f53e5(0x12e)](',\x20'));const _0x411a2a=await database_1[_0x2f53e5(0xf8)][_0x2f53e5(0x9d)][_0x2f53e5(0xbe)]({'where':{'id':_0x49eda5},'select':{'id':!![],'status':!![],'orderId':!![]}});if(!_0x411a2a)throw new Error(_0x2f53e5(0xc3));if(_0xdd6678[_0x2f53e5(0x16b)]()===_0x2f53e5(0xa1)){if(!_0x5bc13f||_0x5bc13f<=0x0)throw new Error(_0x2f53e5(0xdc));console[_0x2f53e5(0x123)]('💸\x20Chargeback\x20amount:\x20'+_0x5bc13f+'\x20USDT\x20(penalty\x20amount)');}const _0x1ea5ad={'status':_0xdd6678[_0x2f53e5(0x16b)](),'updatedAt':new Date(),'statusChangedBy':'admin','statusChangedAt':new Date()};_0x394d0b&&(_0x1ea5ad[_0x2f53e5(0x13a)]=_0x394d0b);_0xdd6678[_0x2f53e5(0x16b)]()==='CHARGEBACK'&&_0x5bc13f&&(_0x1ea5ad['chargebackAmount']=_0x5bc13f);const _0x653151=await database_1[_0x2f53e5(0xf8)]['payment'][_0x2f53e5(0xa9)]({'where':{'id':_0x49eda5},'data':_0x1ea5ad,'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});return await database_1['default'][_0x2f53e5(0xe7)][_0x2f53e5(0xe6)]({'data':{'paymentId':_0x49eda5,'shopId':_0x653151[_0x2f53e5(0xf5)],'event':_0x2f53e5(0xeb),'statusCode':0xc8,'responseBody':JSON[_0x2f53e5(0xa6)]({'oldStatus':_0x411a2a[_0x2f53e5(0xc9)],'newStatus':_0xdd6678[_0x2f53e5(0x16b)](),'notes':_0x394d0b||null,'chargebackAmount':_0x5bc13f||null,'updatedBy':'admin','timestamp':new Date()[_0x2f53e5(0xde)]()})}}),console[_0x2f53e5(0x123)](_0x2f53e5(0xe9)+_0x411a2a['orderId']+'\x20status\x20updated\x20from\x20'+_0x411a2a[_0x2f53e5(0xc9)]+_0x2f53e5(0xc5)+_0xdd6678['toUpperCase']()),_0xdd6678[_0x2f53e5(0x16b)]()===_0x2f53e5(0xa1)&&console[_0x2f53e5(0x123)](_0x2f53e5(0x112)+_0x5bc13f+_0x2f53e5(0xb3)),{'id':_0x653151['id'],'shopId':_0x653151[_0x2f53e5(0xf5)],'shopName':_0x653151[_0x2f53e5(0xee)][_0x2f53e5(0x11a)],'shopUsername':_0x653151[_0x2f53e5(0xee)][_0x2f53e5(0x159)],'gateway':_0x653151[_0x2f53e5(0x121)],'orderId':_0x653151[_0x2f53e5(0xa5)],'gatewayOrderId':_0x653151[_0x2f53e5(0xef)],'amount':_0x653151[_0x2f53e5(0xd1)],'currency':_0x653151[_0x2f53e5(0x128)],'sourceCurrency':_0x653151['sourceCurrency'],'status':_0x653151['status'],'usage':_0x653151[_0x2f53e5(0x129)],'externalPaymentUrl':_0x653151[_0x2f53e5(0xad)],'gatewayPaymentId':_0x653151[_0x2f53e5(0x10d)],'customerEmail':_0x653151[_0x2f53e5(0xd2)],'customerName':_0x653151[_0x2f53e5(0xb0)],'cardLast4':_0x653151[_0x2f53e5(0x164)],'paymentMethod':_0x653151['paymentMethod'],'bankId':_0x653151[_0x2f53e5(0x116)],'remitterIban':_0x653151[_0x2f53e5(0x156)],'remitterName':_0x653151['remitterName'],'chargebackAmount':_0x653151[_0x2f53e5(0xd0)],'adminNotes':_0x653151[_0x2f53e5(0x13a)],'statusChangedBy':_0x653151[_0x2f53e5(0x139)],'statusChangedAt':_0x653151['statusChangedAt'],'createdAt':_0x653151[_0x2f53e5(0xc6)],'updatedAt':_0x653151['updatedAt'],'expiresAt':_0x653151['expiresAt']};}async['getAllUsers'](_0x22cd2b){const _0x3610c9=a33_0x50134e,{page:_0x862279,limit:_0x58a336,status:_0x15743a}=_0x22cd2b,_0x52e25f=(_0x862279-0x1)*_0x58a336,_0x37a961={};_0x15743a&&(_0x37a961['status']=_0x15743a['toUpperCase']());console[_0x3610c9(0x123)](_0x3610c9(0xbc),{'page':_0x862279,'limit':_0x58a336,'status':_0x15743a,'where':_0x37a961});const [_0x2fc03d,_0x1dc5cf]=await Promise[_0x3610c9(0x152)]([database_1[_0x3610c9(0xf8)][_0x3610c9(0xee)][_0x3610c9(0x107)]({'where':_0x37a961,'skip':_0x52e25f,'take':_0x58a336,'select':{'id':!![],'name':!![],'username':!![],'telegram':!![],'shopUrl':!![],'paymentGateways':!![],'gatewaySettings':!![],'publicKey':!![],'usdtPolygonWallet':!![],'usdtTrcWallet':!![],'usdtErcWallet':!![],'usdcPolygonWallet':!![],'status':!![],'createdAt':!![]},'orderBy':{'createdAt':_0x3610c9(0x122)}}),database_1[_0x3610c9(0xf8)][_0x3610c9(0xee)][_0x3610c9(0x138)]({'where':_0x37a961})]);console['log'](_0x3610c9(0x124)+_0x2fc03d['length']+'\x20users\x20out\x20of\x20'+_0x1dc5cf+_0x3610c9(0xb2));const _0x534ee6=_0x2fc03d[_0x3610c9(0x119)](_0x3a0058=>({'id':_0x3a0058['id'],'fullName':_0x3a0058[_0x3610c9(0x11a)],'username':_0x3a0058[_0x3610c9(0x159)],'telegramId':_0x3a0058[_0x3610c9(0x12f)],'merchantUrl':_0x3a0058['shopUrl'],'gateways':_0x3a0058[_0x3610c9(0x120)]?JSON[_0x3610c9(0x115)](_0x3a0058[_0x3610c9(0x120)]):null,'gatewaySettings':_0x3a0058[_0x3610c9(0x104)]?JSON[_0x3610c9(0x115)](_0x3a0058[_0x3610c9(0x104)]):null,'publicKey':_0x3a0058[_0x3610c9(0xf9)],'wallets':{'usdtPolygonWallet':_0x3a0058[_0x3610c9(0x131)],'usdtTrcWallet':_0x3a0058['usdtTrcWallet'],'usdtErcWallet':_0x3a0058[_0x3610c9(0xb4)],'usdcPolygonWallet':_0x3a0058[_0x3610c9(0xf6)]},'status':_0x3a0058['status'],'createdAt':_0x3a0058['createdAt']}));return{'users':_0x534ee6,'pagination':{'page':_0x862279,'limit':_0x58a336,'total':_0x1dc5cf,'totalPages':Math['ceil'](_0x1dc5cf/_0x58a336)}};}async[a33_0x50134e(0x14b)](_0x35ed19){const _0x3af470=a33_0x50134e;return await this[_0x3af470(0x15b)][_0x3af470(0x14b)](_0x35ed19);}async[a33_0x50134e(0x150)](_0x5a75f0){const _0x815bfa=a33_0x50134e;return await this[_0x815bfa(0x15b)][_0x815bfa(0x150)](_0x5a75f0);}async[a33_0x50134e(0xfe)](_0x30fbc4,_0x4aed5a){const _0xec0d8f=a33_0x50134e;return await this[_0xec0d8f(0x15b)][_0xec0d8f(0xfe)](_0x30fbc4,_0x4aed5a);}async[a33_0x50134e(0xc7)](_0x1c1130){return await this['userService']['deleteUser'](_0x1c1130);}async[a33_0x50134e(0xfc)](_0x112c38){const _0x2eda50=a33_0x50134e;console[_0x2eda50(0x123)]('🚫\x20Suspending\x20user:\x20'+_0x112c38);const _0x340e0a=await database_1[_0x2eda50(0xf8)]['shop'][_0x2eda50(0xbe)]({'where':{'id':_0x112c38},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x340e0a)throw new Error(_0x2eda50(0xa3));if(_0x340e0a['status']===_0x2eda50(0x125))throw new Error(_0x2eda50(0xce));const _0x63efc5=await this[_0x2eda50(0x15b)]['updateUser'](_0x112c38,{'status':_0x2eda50(0x125)});return console[_0x2eda50(0x123)](_0x2eda50(0xc0)+_0x340e0a[_0x2eda50(0x159)]+'\x20suspended\x20successfully'),_0x63efc5;}async[a33_0x50134e(0xf0)](_0x2836cf){const _0x7c3a41=a33_0x50134e;console[_0x7c3a41(0x123)](_0x7c3a41(0xba)+_0x2836cf);const _0x1dd59d=await database_1['default']['shop'][_0x7c3a41(0xbe)]({'where':{'id':_0x2836cf},'select':{'id':!![],'username':!![],'status':!![]}});if(!_0x1dd59d)throw new Error(_0x7c3a41(0xa3));if(_0x1dd59d[_0x7c3a41(0xc9)]===_0x7c3a41(0xcc))throw new Error(_0x7c3a41(0xaf));const _0x52a0fd=await this['userService'][_0x7c3a41(0xfe)](_0x2836cf,{'status':_0x7c3a41(0xcc)});return console['log']('✅\x20User\x20'+_0x1dd59d['username']+'\x20activated\x20successfully'),_0x52a0fd;}}exports[a33_0x50134e(0x126)]=AdminService;